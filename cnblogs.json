{
  "title": "主页 - 博客园",
  "link": "https://www.cnblogs.com/",
  "description": "主页 - 博客园 RSS",
  "entries": [
    {
      "title": "unity性能优化-实际开发中需要注意的点",
      "link": "https://www.cnblogs.com/pipicfan/p/19503936",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/pipicfan/p/19503936\" id=\"cb_post_title_url\" title=\"发布于 2026-01-19 22:55\">\n    <span>unity性能优化-实际开发中需要注意的点</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p><strong>unity性能优化-实际开发中需要注意的点</strong></p>\n<p><a id=\"heading_0\"></a><strong>性能优化建议</strong></p>\n<p>在进行下面优化之前，建议先使用 <strong>Unity Profiler</strong> 定位真实的瓶颈。</p>\n<p><strong>优化核心原则：</strong></p>\n<p><strong>能缓存的就缓存</strong>（变量、组件、材质）。</p>\n<p><strong>能不更新就不更新</strong>（降低 update 频率，使用事件驱动或Coroutine）。</p>\n<p><strong>避免在循环中分配内存</strong>（减少 new 关键字，使用对象池）。</p>\n<p><a id=\"heading_1\"></a><strong>1.复杂数学计算，比如mesh顶点数据的创建，大小和归一化属性都非常耗费 CPU（都涉及计算平方根）</strong></p>\n<p>可以使用对象池来空间换时间处理，涉及开根号的用平方比较</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119225507554-1515541958.png\" /></p>\n<p><a id=\"heading_2\"></a><strong>2.shader的合批处理</strong></p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119230139424-582581237.png\" /></p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119230139503-1658596290.png\" /></p>\n<p><a id=\"heading_3\"></a><strong>3.一些List，Vector不要用集合，而是指定它的大小</strong></p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119230139380-946016432.png\" /></p>\n<p><a id=\"heading_4\"></a><strong>4.不要再update里面去大量调用Component（新手容易忽略重要）</strong></p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119225506870-1113031628.png\" /></p>\n<p><a id=\"heading_5\"></a><strong>5.优化字符串对比</strong></p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119230139483-820107562.png\" /></p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119230139441-648476313.png\" /></p>\n<p><a id=\"heading_6\"></a><strong>6.常量的字符串写成类的成员变量</strong></p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119225506734-1746349249.png\" /></p>\n<p><a id=\"heading_7\"></a><strong>7.裁剪引擎，去掉音频</strong></p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119225507500-1539839110.png\" /></p>\n<p><a id=\"heading_8\"></a><strong>8.裁剪引擎，去掉物理，注意此时包括包围盒都不能使用</strong></p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119230139347-1887459637.png\" /></p>\n<p><a id=\"heading_9\"></a><strong>9.固定帧率，减少帧率</strong></p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119230139518-121341222.png\" /></p>\n<p><a id=\"heading_10\"></a><strong>10.避免使用拆箱装箱</strong></p>\n<p>在C#中，装箱（Boxing）和拆箱（Unboxing）是指值类型与引用类型之间的转换。装箱是将值类型转换为对象类型（通常是将值类型包装在堆上），而拆箱则是从对象类型还原为值类型。</p>\n<p><a id=\"heading_11\"></a><strong>装箱（Boxing）开销</strong></p>\n<p><strong>内存分配</strong>：</p>\n<p>装箱过程中，会在堆上分配内存来存储值类型的数据。堆内存的分配通常比栈内存的分配慢，因为堆内存需要处理垃圾回收（Garbage Collection），而且堆内存分配涉及更多的管理操作。</p>\n<p><strong>数据复制</strong>：</p>\n<p>装箱需要将值类型的数据从栈上复制到新分配的堆对象中。这涉及到数据的复制操作，增加了额外的开销。</p>\n<p><strong>垃圾回收</strong>：</p>\n<p>装箱产生的堆对象最终会由垃圾回收器（GC）回收。垃圾回收是一个耗时的过程，会影响应用程序的性能。</p>\n<p><a id=\"heading_12\"></a><strong>拆箱（Unboxing）开销</strong></p>\n<p><strong>类型检查</strong>：</p>\n<p>拆箱过程中，需要进行类型检查，以确保对象确实是预期的值类型。这涉及到运行时的类型元数据访问和检查，增加了开销。</p>\n<p><strong>数据复制</strong>：</p>\n<p>拆箱需要将堆上的数据复制回栈上。这同样涉及数据的复制操作，带来了额外的性能开销。</p>\n<p><a id=\"heading_13\"></a><strong>避免装箱和拆箱的方法</strong></p>\n<p><strong>使用泛型</strong>：泛型可以减少装箱和拆箱的需要，因为泛型可以在编译时确定类型，而不需要在运行时进行类型转换，但是泛型带来另一个问题，即转换为il2cpp的时候，代码会膨胀，这个后面可以再说</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 使用泛型避免装箱和拆箱</span>\nList&lt;intnumbers = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">();\nnumbers.Add(</span><span style=\"color: rgba(128, 0, 128, 1);\">42</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 0, 255, 1);\">int</span> number = numbers[<span style=\"color: rgba(128, 0, 128, 1);\">0</span>];</pre>\n</div>\n<p>&nbsp;</p>\n<br />\n<p><strong>避免频繁的值类型到引用类型的转换</strong>：在设计程序时，尽量减少值类型与引用类型之间的转换。如果可能，尽量使用值类型本身来进行计算和处理。</p>\n<p><strong>使用struct而不是类</strong>：在某些情况下，可以使用struct来代替类，因为struct是值类型，不需要装箱和拆箱。</p>\n<p><strong>避免接口调用</strong>：接口调用通常需要装箱，特别是在接口接受值类型参数时。尽量避免在接口方法中使用值类型参数</p>\n<p><a id=\"heading_14\"></a><strong>11.GameObject.Instantiate  和 SetParent</strong></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> ESDRoadEdgePool\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span> <span style=\"color: rgba(0, 0, 0, 1);\">{\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 3</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">public int amountToPool = 100; </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 池中对象的数量 </span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> amountToPool = <span style=\"color: rgba(128, 0, 128, 1);\">25</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 5</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>     pooledObjects = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> List&lt;GameObject&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 8</span>     <span style=\"color: rgba(0, 0, 255, 1);\">for</span> (<span style=\"color: rgba(0, 0, 255, 1);\">int</span> i = <span style=\"color: rgba(128, 0, 128, 1);\">0</span>; i &lt; amountToPool; i++<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 9</span> <span style=\"color: rgba(0, 0, 0, 1);\">    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span>         GameObject obj = Instantiate(objectToPool); <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 实例化可以缩减</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">11</span>         obj.SetActive(<span style=\"color: rgba(0, 0, 255, 1);\">false</span>);                       <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 可以预先设置预制体的activeSelf</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">12</span>         obj.transform.parent = <span style=\"color: rgba(0, 0, 255, 1);\">this</span>.transform;      <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 可以合并到Instantiate中</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">13</span> <span style=\"color: rgba(0, 0, 0, 1);\">        pooledObjects.Add(obj);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">14</span>         \n<span style=\"color: rgba(0, 128, 128, 1);\">15</span>            \n<span style=\"color: rgba(0, 128, 128, 1);\">16</span>         GameObject obj =<span style=\"color: rgba(0, 0, 0, 1);\"> Instantiate(objectToPool, transform);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">17</span> <span style=\"color: rgba(0, 0, 0, 1);\">        pooledObjects.Add(obj);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">18</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">19</span> }</pre>\n</div>\n<p>&nbsp;</p>\n<p><a id=\"heading_15\"></a><strong>12.嵌套循环中new Vector3等</strong></p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:csharp;gutter:true;\">　</pre>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 255, 1);\">for</span>(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> i = <span style=\"color: rgba(128, 0, 128, 1);\">0</span>; i &lt; count; i++<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span> <span style=\"color: rgba(0, 0, 0, 1);\">{\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 3</span> <span style=\"color: rgba(0, 0, 0, 1);\">    ...\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     Vector2 p1l_uv = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Vector2(offest.x, uvStart /<span style=\"color: rgba(0, 0, 0, 1);\"> 10f);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 5</span>     Vector2 p1r_uv = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Vector2(offest.y, uvStart /<span style=\"color: rgba(0, 0, 0, 1);\"> 10f);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>     Vector2 p2l_uv = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Vector2(offest.x, (uvStart + distance) / <span style=\"color: rgba(128, 0, 128, 1);\">10</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>     Vector2 p2r_uv = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Vector2(offest.y, (uvStart + distance) / <span style=\"color: rgba(128, 0, 128, 1);\">10</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 8</span> <span style=\"color: rgba(0, 0, 0, 1);\">    ...\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 9</span> <span style=\"color: rgba(0, 0, 0, 1);\">}\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">11</span> <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 可以将对象创建挪到循环外进行复用</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">12</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">13</span> Vector2 p1l_uv = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> Vector2();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">14</span> Vector2 p1r_uv = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> Vector2();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">15</span> Vector2 p2l_uv = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> Vector2();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">16</span> Vector2 p2r_uv = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> Vector2();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">17</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">18</span> <span style=\"color: rgba(0, 0, 255, 1);\">for</span>(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> i = <span style=\"color: rgba(128, 0, 128, 1);\">0</span>; i &lt; count; i++<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">19</span> <span style=\"color: rgba(0, 0, 0, 1);\">{\n</span><span style=\"color: rgba(0, 128, 128, 1);\">20</span> <span style=\"color: rgba(0, 0, 0, 1);\">    ...\n</span><span style=\"color: rgba(0, 128, 128, 1);\">21</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 同时可以使用Vector3.Set来一次性对向量的每个分量进行赋值</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">22</span>     p1l_uv.Set(offest.x, uvStart /<span style=\"color: rgba(0, 0, 0, 1);\"> 10f);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">23</span>     p1r_uv.Set(offest.y, uvStart /<span style=\"color: rgba(0, 0, 0, 1);\"> 10f);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">24</span>     p2l_uv.Set(offest.x, (uvStart + distance) / <span style=\"color: rgba(128, 0, 128, 1);\">10</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">25</span>     p2r_uv.Set(offest.y, (uvStart + distance) / <span style=\"color: rgba(128, 0, 128, 1);\">10</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">26</span> <span style=\"color: rgba(0, 0, 0, 1);\">    ...\n</span><span style=\"color: rgba(0, 128, 128, 1);\">27</span> }</pre>\n</div>\n<p>&nbsp;</p>\n</div>\n<p><a id=\"heading_16\"></a><strong>13.每帧循环调用的计算逻辑，可以使用对象池替代</strong></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 255, 1);\">for</span> (<span style=\"color: rgba(0, 0, 255, 1);\">int</span> i = <span style=\"color: rgba(128, 0, 128, 1);\">0</span>; i &lt; len - <span style=\"color: rgba(128, 0, 128, 1);\">1</span>; i++<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span> <span style=\"color: rgba(0, 0, 0, 1);\">{\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 3</span> <span style=\"color: rgba(0, 0, 0, 1);\">    ...\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     SquareCell cell = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> SquareCell();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 5</span> <span style=\"color: rgba(0, 0, 0, 1);\">    ...\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 6</span> <span style=\"color: rgba(0, 0, 0, 1);\"> }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>  \n<span style=\"color: rgba(0, 128, 128, 1);\"> 8</span>  <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 加入对象池</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 9</span>  <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> SquareCellPool\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span> <span style=\"color: rgba(0, 0, 0, 1);\"> {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">11</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span><span style=\"color: rgba(0, 0, 0, 1);\"> SquareCell Allocate()\n</span><span style=\"color: rgba(0, 128, 128, 1);\">12</span> <span style=\"color: rgba(0, 0, 0, 1);\">    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">13</span>         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (pool.TryDequeue(<span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">var</span><span style=\"color: rgba(0, 0, 0, 1);\"> cell))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">14</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">15</span>             totalCount--<span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">16</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> cell;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">17</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">18</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">19</span>         <span style=\"color: rgba(0, 0, 255, 1);\">for</span> (<span style=\"color: rgba(0, 0, 255, 1);\">int</span> i = <span style=\"color: rgba(128, 0, 128, 1);\">0</span>; i &lt; poolInterval; i++<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">20</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">21</span>             SquareCell newCell = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> SquareCell();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">22</span> <span style=\"color: rgba(0, 0, 0, 1);\">            pool.Enqueue(newCell);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">23</span>             totalCount++<span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">24</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">25</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">26</span>         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (totalCount &gt; <span style=\"color: rgba(128, 0, 128, 1);\">65535</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">27</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">28</span>             Debug.LogError(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Pool Out of Count!</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> +<span style=\"color: rgba(0, 0, 0, 1);\"> totalCount);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">29</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span> <span style=\"color: rgba(0, 0, 255, 1);\">null</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">30</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">31</span>         cell =<span style=\"color: rgba(0, 0, 0, 1);\"> pool.Dequeue();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">32</span>         totalCount--<span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">33</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> cell;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">34</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">35</span>  }</pre>\n</div>\n<p>&nbsp;</p>\n<br />\n<p><a id=\"heading_17\"></a><strong>14.Shader中处理逻辑能不使用高精度可以使用低精度的</strong></p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119225508259-375921676.png\" /></p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119225507827-2125826982.png\" /></p>\n<p><a id=\"heading_18\"></a><strong>15.避免 Camera.main</strong></p>\n<p>在 Unity 中，Camera.main 实际上是调用了 GameObject.FindWithTag(\"MainCamera\")，这是一个非常耗时的操作</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119225502907-593523569.png\" /></p>\n<p>发现unity文档里面,这块其实也是做了缓存gameobject</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/357310/202601/357310-20260119225506505-1590491376.jpg\" /></p>\n<p>但是缓存肯定还是最快的,因为gameobject也有开销</p>\n<p><strong>本文档会陆续补充更新，优化无止境</strong></p>\n</div>\n<div id=\"MySignature\">\n    我自豪 我是一名软件工程师。\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-19 22:55</span>&nbsp;\n<a href=\"https://www.cnblogs.com/pipicfan\">pipicfan</a>&nbsp;\n阅读(<span id=\"post_view_count\">3</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "DeploySharp 全面支持 YOLO26 系列，助力开发者快速部署落地应用",
      "link": "https://www.cnblogs.com/guojin-blogs/p/19503930",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/guojin-blogs/p/19503930\" id=\"cb_post_title_url\" title=\"发布于 2026-01-19 22:47\">\n    <span>DeploySharp 全面支持 YOLO26 系列，助力开发者快速部署落地应用</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        <img alt=\"DeploySharp 全面支持 YOLO26 系列，助力开发者快速部署落地应用\" class=\"desc_img\" src=\"https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260119224728680-943487144.png\" />\n        DeploySharp是一个专为C#开发者设计的跨平台模型部署框架，全面支持YOLOv26系列模型，包括目标检测、实例分割、姿态估计和旋转框检测。该框架提供多引擎支持(OpenVINO/ONNX Runtime/TensorRT)、两种图像处理库选择(ImageSharp/OpenCvSharp)以及跨平台运行时兼容性。通过模块化架构和NuGet包生态，开发者可以快速部署YOLOv26模型，实现从模型加载到推理执行的端到端解决方案。项目开源且支持多种硬件设备，为计算机视觉应用落地提供高效工具。\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"deploysharp-全面支持-yolo26-系列助力开发者快速部署落地应用\">DeploySharp 全面支持 YOLO26 系列，助力开发者快速部署落地应用</h1>\n<h2 id=\"一deploysharp-简介\">一、DeploySharp 简介</h2>\n<p>DeploySharp 是一个专为 C# 开发者设计的跨平台模型部署框架，旨在提供从模型加载、配置管理到推理执行的端到端解决方案。该项目由 椒颜皮皮虾开发并开源，遵循 Apache 2.0 许可协议，目前在 GitHub 上获得了广泛关注。</p>\n<p>DeploySharp 采用了清晰的模块化架构设计：</p>\n<ul>\n<li><strong>根命名空间</strong>：<code>DeploySharp</code> 作为统一入口，集成模型加载、推理执行等核心功能</li>\n<li><strong>子命名空间</strong>：通过 <code>DeploySharp.Engine</code>、<code>DeploySharp.Data</code>、<code>DeploySharp.Model</code> 等子命名空间实现模块化分层</li>\n<li><strong>泛型设计</strong>：关键类采用泛型设计，支持图像处理、分类、检测等多任务标准数据交互</li>\n</ul>\n<p><strong>项目地址</strong>：</p>\n<pre><code>https://github.com/guojin-yan/DeploySharp.git\n</code></pre>\n<h3 id=\"1-多引擎支持\">1. 多引擎支持</h3>\n<p>DeploySharp 原生支持三种主流推理引擎：</p>\n<table>\n<thead>\n<tr>\n<th>推理引擎</th>\n<th>状态</th>\n<th>支持设备</th>\n<th>性能特点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>OpenVINO</td>\n<td>完成</td>\n<td>CPU、GPU0(集显)、GPU1(独显)、NPU</td>\n<td>Intel 硬件优化</td>\n</tr>\n<tr>\n<td>ONNX Runtime</td>\n<td>完成</td>\n<td>CPU、GPU(CUDA/DML)</td>\n<td>跨平台兼容性好</td>\n</tr>\n<tr>\n<td>TensorRT</td>\n<td>完成</td>\n<td>GPU(TensorRT)</td>\n<td>NVIDIA GPU 极致性能</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"2-图像处理支持\">2. 图像处理支持</h3>\n<p>框架提供了两种图像处理库的选择：</p>\n<table>\n<thead>\n<tr>\n<th>图像处理库</th>\n<th>特点</th>\n<th>适用场景</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ImageSharp</td>\n<td>纯 C# 实现，跨平台兼容性好，无原生依赖</td>\n<td>跨平台应用、Web 应用</td>\n</tr>\n<tr>\n<td>OpenCvSharp</td>\n<td>OpenCV 的 C# 封装，功能强大，性能优异</td>\n<td>桌面应用、高性能场景</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"3-跨平台运行时支持\">3. 跨平台运行时支持</h3>\n<p>DeploySharp 兼容了广泛的 .NET 运行时环境：</p>\n<ul>\n<li>.NET Framework 4.8 / 4.8.1</li>\n<li>.NET Core 3.1</li>\n<li>.NET 5.0</li>\n<li>.NET 6.0</li>\n<li>.NET 7.0</li>\n<li>.NET 8.0</li>\n<li>.NET 9.0</li>\n<li>.NET 10.0</li>\n</ul>\n<h3 id=\"4-nuget-包生态\">4. NuGet 包生态</h3>\n<h4 id=\"41-核心包\">4.1 核心包</h4>\n<table>\n<thead>\n<tr>\n<th>包名</th>\n<th>描述</th>\n<th>NuGet 链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JYPPX.DeploySharp</td>\n<td>DeploySharp API 核心库</td>\n<td><a href=\"https://www.nuget.org/packages/JYPPX.DeploySharp/\" rel=\"noopener nofollow\" target=\"_blank\"><img alt=\"NuGet\" class=\"lazyload\" /></a></td>\n</tr>\n</tbody>\n</table>\n<p><strong>核心包功能</strong>：</p>\n<ul>\n<li>推理引擎抽象接口</li>\n<li>数据结构定义</li>\n<li>模型配置基类</li>\n<li>性能分析工具</li>\n<li>日志系统</li>\n<li>可视化基础功能</li>\n</ul>\n<h4 id=\"42-图像处理扩展包\">4.2 图像处理扩展包</h4>\n<table>\n<thead>\n<tr>\n<th>包名</th>\n<th>描述</th>\n<th>NuGet 链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JYPPX.DeploySharp.ImageSharp</td>\n<td>使用 ImageSharp 的图像处理扩展</td>\n<td><a href=\"https://www.nuget.org/packages/JYPPX.DeploySharp.ImageSharp/\" rel=\"noopener nofollow\" target=\"_blank\"><img alt=\"NuGet\" class=\"lazyload\" /></a></td>\n</tr>\n<tr>\n<td>JYPPX.DeploySharp.OpenCvSharp</td>\n<td>使用 OpenCvSharp 的图像处理扩展</td>\n<td><a href=\"https://www.nuget.org/packages/JYPPX.DeploySharp.OpenCvSharp/\" rel=\"noopener nofollow\" target=\"_blank\"><img alt=\"NuGet\" class=\"lazyload\" /></a></td>\n</tr>\n</tbody>\n</table>\n<p><strong>扩展包功能</strong>：</p>\n<ul>\n<li>图像加载和保存</li>\n<li>图像预处理实现</li>\n<li>可视化功能实现</li>\n<li>批量处理支持</li>\n</ul>\n<h3 id=\"5--模型支持列表\">5.  模型支持列表</h3>\n<p>截至目前，DeploySharp 已经完成了以下模型的封装，更多模型持续更新中：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: center;\">Model Name</th>\n<th style=\"text-align: center;\">Model Type</th>\n<th style=\"text-align: center;\">OpenVINO</th>\n<th style=\"text-align: center;\">ONNX Runtime</th>\n<th style=\"text-align: center;\">TensorRT</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv5</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv5</strong></td>\n<td style=\"text-align: center;\">Segmentation</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv6</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv7</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv8</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv8</strong></td>\n<td style=\"text-align: center;\">Segmentation</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv8</strong></td>\n<td style=\"text-align: center;\">Pose</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv8</strong></td>\n<td style=\"text-align: center;\">Oriented Bounding Boxes</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv9</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv9</strong></td>\n<td style=\"text-align: center;\">Segmentation</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv10</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv11</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv11</strong></td>\n<td style=\"text-align: center;\">Segmentation</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv11</strong></td>\n<td style=\"text-align: center;\">Pose</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv11</strong></td>\n<td style=\"text-align: center;\">Oriented Bounding Boxes</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLOv12</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>Anomalib</strong></td>\n<td style=\"text-align: center;\">Segmentation</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>PP-YOLOE</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>DEIMv2</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>RFDETR</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>RFDETR</strong></td>\n<td style=\"text-align: center;\">Segmentation</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>RTDETR</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLO26</strong></td>\n<td style=\"text-align: center;\">Detection</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLO26</strong></td>\n<td style=\"text-align: center;\">Segmentation</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLO26</strong></td>\n<td style=\"text-align: center;\">Pose</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><strong>YOLO26</strong></td>\n<td style=\"text-align: center;\">Oriented Bounding Boxes</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n<td style=\"text-align: center;\">✅</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"二deploysharp-对-yolov26-的全面支持\">二、DeploySharp 对 YOLOv26 的全面支持</h2>\n<p>DeploySharp 框架为 YOLOv26 系列模型提供了全方位的支持，涵盖了目标检测、实例分割、姿态估计和旋转框检测四种主要任务类型。</p>\n<h3 id=\"21-支持的-yolov26-模型类型\">2.1 支持的 YOLOv26 模型类型</h3>\n<table>\n<thead>\n<tr>\n<th>模型类型</th>\n<th>功能描述</th>\n<th>枚举值</th>\n<th>配置类</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>YOLOv26Det</td>\n<td>目标检测</td>\n<td><code>ModelType.YOLOv26Det</code></td>\n<td><code>Yolov26DetConfig</code></td>\n</tr>\n<tr>\n<td>YOLOv26Seg</td>\n<td>实例分割</td>\n<td><code>ModelType.YOLOv26Seg</code></td>\n<td><code>Yolov26SegConfig</code></td>\n</tr>\n<tr>\n<td>YOLOv26Pose</td>\n<td>人体姿态估计</td>\n<td><code>ModelType.YOLOv26Pose</code></td>\n<td><code>Yolov26PoseConfig</code></td>\n</tr>\n<tr>\n<td>YOLOv26Obb</td>\n<td>旋转框检测</td>\n<td><code>ModelType.YOLOv26Obb</code></td>\n<td><code>Yolov26ObbConfig</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"22-架构设计\">2.2 架构设计</h3>\n<p>DeploySharp 为 YOLOv26 提供了三层架构设计：</p>\n<h4 id=\"接口层-iyolov26xxxmodel\">接口层 (IYolov26XxxModel)</h4>\n<p>在核心库 <code>DeploySharp</code> 中定义了统一的接口：</p>\n<pre><code class=\"language-csharp\">// YOLOv26 检测接口\n// IYolov26DetModel 继承自 IYolov10DetModel\n// 这种设计使得 YOLOv26 可以复用 YOLOv10 的成熟实现\npublic abstract class IYolov26DetModel : IYolov10DetModel\n{\n    /// &lt;summary&gt;\n    /// 构造函数，接收模型配置\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"config\"&gt;YOLOv26 检测模型配置对象&lt;/param&gt;\n    public IYolov26DetModel(Yolov26DetConfig config) : base(config)\n    {\n        // 使用日志系统记录模型初始化信息\n        MyLogger.Log.Info($\"Initializing {this.GetType().Name}, Config:\\n{config}\");\n    }\n}\n</code></pre>\n<h4 id=\"配置层-yolov26xxxconfig\">配置层 (Yolov26XxxConfig)</h4>\n<p>每种模型类型都有对应的配置类，提供灵活的参数设置：</p>\n<pre><code class=\"language-csharp\">// YOLOv26 检测配置类\n// 继承自 Yolov10DetConfig，复用 YOLOv10 的成熟配置\npublic class Yolov26DetConfig : Yolov10DetConfig\n{\n    /// &lt;summary&gt;\n    /// 默认构造函数\n    /// &lt;/summary&gt;\n    public Yolov26DetConfig() { }\n\n    /// &lt;summary&gt;\n    /// 带模型路径的构造函数\n    /// 自动设置合理的默认参数\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"modelPath\"&gt;模型文件路径&lt;/param&gt;\n    public Yolov26DetConfig(string modelPath)\n    {\n\t\t...\n    }\n}\n</code></pre>\n<h4 id=\"实现层-yolov26xxxmodel\">实现层 (Yolov26XxxModel)</h4>\n<p>分别提供 ImageSharp 和 OpenCvSharp 两种实现，开发者可以根据需求选择。</p>\n<h3 id=\"23-类继承关系图\">2.3 类继承关系图</h3>\n<pre><code>YoloDetConfig (基类)\n    ├── Yolov8DetConfig\n    ├── Yolov10DetConfig\n    └── Yolov26DetConfig (继承自 Yolov10DetConfig)\n\nYoloModel (基类)\n    ├── Yolov8DetModel\n    ├── Yolov10DetModel\n    └── Yolov26DetModel (继承自 Yolov10DetModel)\n</code></pre>\n<p>这种继承设计的优势：</p>\n<ol>\n<li><strong>代码复用</strong>：YOLOv26 可以复用 YOLOv10 的成熟实现</li>\n<li><strong>一致性</strong>：保持与其他 YOLO 版本的 API 一致性</li>\n<li><strong>易维护</strong>：共享的代码逻辑集中管理</li>\n</ol>\n<h2 id=\"三yolov26-目标检测代码实现\">三、YOLOv26 目标检测代码实现</h2>\n<h3 id=\"31-使用-imagesharp-作为图像处理库--tensorrt-推理后端\">3.1 使用 ImageSharp 作为图像处理库 + TensorRT 推理后端</h3>\n<h4 id=\"1nuget-包安装\">（1）NuGet 包安装</h4>\n<p>使用 ImageSharp 作为图像处理库、TensorRT 作为推理后端时，需要安装以下核心包：</p>\n<p><strong>DeploySharp 基础库及扩展库</strong>：</p>\n<pre><code>JYPPX.DeploySharp\nJYPPX.DeploySharp.ImageSharp\n</code></pre>\n<p><strong>TensorRT Runtime 库</strong>：</p>\n<pre><code>JYPPX.TensorRT.CSharp.API.runtime.win-x64.cuda11\n或\nJYPPX.TensorRT.CSharp.API.runtime.win-x64.cuda12\n</code></pre>\n<p><strong>注意</strong>：TensorRT Runtime 库的版本需根据本地设备安装的 CUDA 版本进行选择。</p>\n<h4 id=\"2代码实现\">（2）代码实现</h4>\n<p>以下代码可直接复制运行：</p>\n<pre><code class=\"language-csharp\">using DeploySharp.Model;       // 引入模型相关定义\nusing DeploySharp.Data;        // 引入数据处理相关\nusing DeploySharp.Engine;      // 引入推理引擎核心\nusing DeploySharp;             // 引入 DeploySharp 主库\nusing SixLabors.ImageSharp;    // ImageSharp 图像处理库\nusing SixLabors.ImageSharp.PixelFormats; // ImageSharp 像素格式\n\nnamespace DeploySharp.ImageSharp.Demo\n{\n    /// &lt;summary&gt;\n    /// YOLO26目标检测演示类\n    /// 该类展示了如何加载 TensorRT 引擎文件，对图像进行推理并可视化结果。\n    /// &lt;/summary&gt;\n    public class YOLOv26DetDemo\n    {\n        public static void Run()\n        {\n            // ==========================================\n            // 1. 路径配置\n            // ==========================================\n            \n            // 模型下载提示：模型和测试图片可以前往QQ群(945057948)下载\n            // 设置 .engine 文件路径。\n            // 注意：TensorRT 的 .engine 文件是硬件相关的，即在 RTX 3090 上生成的 engine 通常不能在 RTX 4090 上运行。\n            string modelPath = @\"D:\\Program Files\\TensorRT-10.13.0.35-cu11\\bin\\yolo26s.engine\";\n            \n            // 设置待推理的图片路径\n            string imagePath = @\"E:\\Data\\image\\bus.jpg\";\n            // ==========================================\n            // 2. 模型配置初始化\n            // ==========================================\n            \n            // 创建  YOLO26 的配置对象，传入模型路径\n            Yolov26DetConfig config = new Yolov26DetConfig(modelPath);\n            \n            // 设置最大批处理大小。\n            // 即使只推理一张图片，设置适当的 BatchSize 有时也能利用 GPU 并行能力。\n            // 此处设为 2 表示引擎内部最大可以一次处理 2 张图，但要首先保证模型支持。\n            config.MaxBatchSize = 2;\n            \n            // 显式指定推理后端为 TensorRT。\n            // DeploySharp 支持多种后端（如 ONNX Runtime, OpenVINO 等），这里强制使用 TensorRT 以获得最佳性能。\n            config.SetTargetInferenceBackend(InferenceBackend.TensorRT);\n            // ==========================================\n            // 3. 类别字典定义\n            // ==========================================\n            \n            // COCO 数据集的 80 个类别名称列表\n            // YOLO 模型通常输出的是类别的索引（0-79），我们需要将其映射为人类可读的字符串。\n            List&lt;string&gt; d = new List&lt;string&gt; { \"person\", \"bicycle\", \"car\", \"motorcycle\", \"airplane\", \"bus\",\n                \"train\", \"truck\", \"boat\", \"traffic light\", \"fire hydrant\", \"stop sign\", \"parking meter\", \"bench\",\n                \"bird\", \"cat\", \"dog\", \"horse\", \"sheep\", \"cow\", \"elephant\", \"bear\", \"zebra\", \"giraffe\", \"backpack\",\n                \"umbrella\", \"handbag\", \"tie\", \"suitcase\", \"frisbee\", \"skis\", \"snowboard\", \"sports ball\", \"kite\",\n                \"baseball bat\", \"baseball glove\", \"skateboard\", \"surfboard\", \"tennis racket\", \"bottle\", \"wine glass\",\n                \"cup\", \"fork\", \"knife\", \"spoon\", \"bowl\", \"banana\", \"apple\", \"sandwich\", \"orange\", \"broccoli\", \"carrot\",\n                \"hot dog\", \"pizza\", \"donut\", \"cake\", \"chair\", \"couch\", \"potted plant\", \"bed\", \"dining table\", \"toilet\",\n                \"tv\", \"laptop\", \"mouse\", \"remote\", \"keyboard\", \"cell phone\", \"microwave\", \"oven\", \"toaster\", \"sink\",\n                \"refrigerator\", \"book\", \"clock\", \"vase\", \"scissors\", \"teddy bear\", \"hair drier\", \"toothbrush\" };\n            // 将列表转换为字典，Key 为索引，Value 为类别名称\n            Dictionary&lt;int, string&gt; CategoryDict = new Dictionary&lt;int, string&gt;();\n            for (int i = 0; i &lt; d.Count; i++)\n            {\n                CategoryDict[i] = d[i];\n            }\n            \n            // 将类别字典赋值给配置对象，用于后续结果解析\n            config.CategoryDict = CategoryDict;\n            // ==========================================\n            // 4. 模型实例化\n            // ==========================================\n            \n            // 根据配置初始化检测器模型。\n            // 此步骤会加载 engine 文件到内存，并初始化 GPU 上下文。\n            Yolov26DetModel model = new Yolov26DetModel(config);\n            \n            // 使用 SixLabors.ImageSharp 加载图片。\n            // Image.Load 会自动根据文件扩展名解码图片。\n            var img = Image.Load(imagePath);\n            // ==========================================\n            // 5. 模型推理与性能测试\n            // ==========================================\n            \n            // 执行第一次推理。\n            // 注意：TensorRT 的首次推理通常包含 Kernel 初始化等开销，速度会比后续推理慢。\n            DetResult[] result = model.Predict(img);\n            \n            // 执行第二次推理。\n            // 这次推理的时间更能代表模型在实际场景中的平均推理速度。\n            result = model.Predict(img);\n            \n            // 执行第三次推理（可选），用于进一步取平均值或确保稳定性。\n            result = model.Predict(img);\n            \n            // 打印推理性能分析记录。\n            // 这通常会输出预处理、推理、后端处理各阶段的耗时（毫秒级）。\n            model.ModelInferenceProfiler.PrintAllRecords();\n            \n            // 初始化一个列表，虽然本例未直接使用，但在处理多图结果时可能会用到。\n            List&lt;Image&lt;Rgb24&gt;&gt; resultsMat = new List&lt;Image&lt;Rgb24&gt;&gt;();\n            // ==========================================\n            // 6. 结果可视化与保存\n            // ==========================================\n            \n            // 将推理结果绘制在原图上。\n            // Visualize.DrawDetResult 会根据 DetResult 中的坐标和置信度画框和文字。\n            // 需要将 img 强制转换为 Image&lt;Rgb24&gt;，因为 DrawDetResult 通常需要特定的像素格式。\n            var resultImg = Visualize.DrawDetResult(result, (Image&lt;Rgb24&gt;)img, new VisualizeOptions(1.0f));\n            // 保存带有检测框的图片到当前目录下。\n            // 文件名包含配置的模型类型，便于区分不同模型的结果。\n            resultImg.Save(@$\"./result_{config.ModelType}.jpg\");\n        }\n    }\n}\n</code></pre>\n<h4 id=\"3代码详解\">（3）代码详解</h4>\n<ol>\n<li>\n<p><strong>配置模型参数</strong>：</p>\n<pre><code class=\"language-csharp\">Yolov26DetConfig config = new Yolov26DetConfig(modelPath);\nconfig.MaxBatchSize = 2;\nconfig.SetTargetInferenceBackend(InferenceBackend.TensorRT);\n</code></pre>\n<ul>\n<li>创建配置对象，使用 TensorRT 引擎进行推理</li>\n<li>设置最大批量大小为 2，支持最多 2 张图片的批量推理</li>\n</ul>\n</li>\n<li>\n<p><strong>创建模型实例</strong>：</p>\n<pre><code class=\"language-csharp\">Yolov26DetModel model = new Yolov26DetModel(config);\n</code></pre>\n<p>模型实例化时会自动加载 .engine 文件并初始化 TensorRT 引擎。</p>\n</li>\n<li>\n<p><strong>执行推理</strong>：</p>\n<pre><code class=\"language-csharp\">DetResult[] result = model.Predict(img);\n</code></pre>\n<p><code>Predict()</code> 方法返回检测结果数组，每个元素包含边界框、置信度和类别信息。</p>\n</li>\n<li>\n<p><strong>性能分析</strong>：</p>\n<pre><code class=\"language-csharp\">model.ModelInferenceProfiler.PrintAllRecords();\n</code></pre>\n<p>打印详细的性能统计，包括预处理、推理、后处理各阶段的耗时。</p>\n</li>\n</ol>\n<h4 id=\"4结果展示\">（4）结果展示</h4>\n<p>控制台打印输出：</p>\n<p><img alt=\"image-20260116231024791\" class=\"lazyload\" /></p>\n<p>推理结果图片：</p>\n<p><img alt=\"result_YOLOv26Det\" class=\"lazyload\" /></p>\n<h3 id=\"32-使用-opencvsharp做图像处理库onnx-runtime推理后端\">3.2 使用 OpenCvSharp做图像处理库+ONNX Runtime推理后端</h3>\n<h4 id=\"1nuget-包安装-1\">（1）NuGet 包安装</h4>\n<p>使用 OpenCvSharp 作为图像处理库、ONNX Runtime 作为推理后端时，需要安装以下核心包：</p>\n<p><strong>DeploySharp 基础库及扩展库</strong>：</p>\n<pre><code>JYPPX.DeploySharp\nJYPPX.DeploySharp.OpenCvSharp\n</code></pre>\n<p><strong>OpenCvSharp Runtime 库</strong>：</p>\n<pre><code>OpenCvSharp4.runtime.win\n</code></pre>\n<p><strong>可选加速包</strong>：ONNX Runtime 支持多种推理加速方式，除默认 CPU 加速外，可根据需求安装以下 NuGet 包：</p>\n<table>\n<thead>\n<tr>\n<th>加速方式</th>\n<th>NuGet 包名</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>OpenVINO 加速</td>\n<td>Intel.ML.OnnxRuntime.OpenVino</td>\n</tr>\n<tr>\n<td>DirectML 加速</td>\n<td>Microsoft.AI.DirectML</td>\n</tr>\n<tr>\n<td>CUDA 加速</td>\n<td>Microsoft.ML.OnnxRuntime.Gpu</td>\n</tr>\n</tbody>\n</table>\n<p>更多加速方式请参考 ONNX Runtime 官方文档。本节以 DirectML 为例进行演示。</p>\n<h4 id=\"2代码实现-1\">（2）代码实现</h4>\n<p>推理代码如下所示，可直接复制运行：</p>\n<pre><code class=\"language-csharp\">using OpenCvSharp;            // 引入 OpenCvSharp，用于图像的读取、显示和矩阵操作\nusing DeploySharp.Model;      // 引入模型定义和配置类\nusing DeploySharp.Data;       // 引入数据处理相关的类\nusing DeploySharp.Engine;     // 引入推理引擎核心接口和枚举\nusing DeploySharp;            // 引入 DeploySharp 主库和可视化工具\nnamespace DeploySharp.OpenCvSharp.Demo\n{\n    /// &lt;summary&gt;\n    ///  YOLO26 目标检测演示 (基于 ONNX Runtime + OpenCvSharp)\n    /// 本示例展示了如何加载 ONNX 模型，并配置使用 DirectML 在 GPU 上进行推理。\n    /// &lt;/summary&gt;\n    public class Yolov26DetDemo\n    {\n        public static void Run()\n        {\n            // ==========================================\n            // 1. 路径配置\n            // ==========================================\n            \n            // 模型下载提示：模型和测试图片可以前往QQ群(945057948)下载\n            // 注意：此处加载的是标准的 .onnx 模型文件，而不是 TensorRT 的 .engine 文件。\n            // ONNX 模型具有良好的跨平台特性。\n            string modelPath = @\"E:\\Model\\yolov28\\yolo26s.onnx\";\n            \n            // 设置待检测的图片路径\n            string imagePath = @\"E:\\Data\\image\\bus.jpg\";\n            // ==========================================\n            // 2. 模型配置与推理后端设置\n            // ==========================================\n            \n            // 创建  YOLO26 的配置对象，传入模型路径\n            Yolov26DetConfig config = new Yolov26DetConfig(modelPath);\n            \n            // [关键步骤] 设置推理后端为 ONNX Runtime。\n            // 这意味着模型将通过 ONNX Runtime 进行加载和执行，而不是 TensorRT。\n            config.SetTargetInferenceBackend(InferenceBackend.OnnxRuntime);\n            \n            // 设置目标设备类型为 GPU 0。\n            // 这是一个逻辑设定，具体执行取决于 ONNX Runtime 的提供程序。\n            config.SetTargetDeviceType(DeviceType.GPU0);\n            \n            // [关键步骤] 设置 ONNX Runtime 的具体执行提供程序为 DML (DirectML)。\n            // DirectML 是 Windows 上的高性能硬件加速接口，支持 AMD、NVIDIA 和 Intel 显卡。\n            // 如果不加这一行，ONNX Runtime 可能默认使用 CPU 进行推理，速度较慢。\n            config.SetTargetOnnxRuntimeDeviceType(OnnxRuntimeDeviceType.DML);\n            // ==========================================\n            // 3. 类别字典定义 (COCO 80类)\n            // ==========================================\n            \n            // 定义 COCO 数据集的 80 个类别名称\n            // 这些名称将用于在结果可视化时标注检测到的物体\n            List&lt;string&gt; d = new List&lt;string&gt; { \"person\", \"bicycle\", \"car\", \"motorcycle\", \"airplane\", \"bus\",\n                \"train\", \"truck\", \"boat\", \"traffic light\", \"fire hydrant\", \"stop sign\", \"parking meter\", \"bench\",\n                \"bird\", \"cat\", \"dog\", \"horse\", \"sheep\", \"cow\", \"elephant\", \"bear\", \"zebra\", \"giraffe\", \"backpack\",\n                \"umbrella\", \"handbag\", \"tie\", \"suitcase\", \"frisbee\", \"skis\", \"snowboard\", \"sports ball\", \"kite\",\n                \"baseball bat\", \"baseball glove\", \"skateboard\", \"surfboard\", \"tennis racket\", \"bottle\", \"wine glass\",\n                \"cup\", \"fork\", \"knife\", \"spoon\", \"bowl\", \"banana\", \"apple\", \"sandwich\", \"orange\", \"broccoli\", \"carrot\",\n                \"hot dog\", \"pizza\", \"donut\", \"cake\", \"chair\", \"couch\", \"potted plant\", \"bed\", \"dining table\", \"toilet\",\n                \"tv\", \"laptop\", \"mouse\", \"remote\", \"keyboard\", \"cell phone\", \"microwave\", \"oven\", \"toaster\", \"sink\",\n                \"refrigerator\", \"book\", \"clock\", \"vase\", \"scissors\", \"teddy bear\", \"hair drier\", \"toothbrush\" };\n            // 构建&lt;索引, 类别名&gt;字典\n            Dictionary&lt;int, string&gt; CategoryDict = new Dictionary&lt;int, string&gt;();\n            for (int i = 0; i &lt; d.Count; i++)\n            {\n                CategoryDict[i] = d[i];\n            }\n            \n            // 将类别字典赋值给配置对象\n            config.CategoryDict = CategoryDict;\n            // ==========================================\n            // 4. 模型初始化\n            // ==========================================\n            \n            // 实例化模型，传入配置。\n            // 此时 DeploySharp 会根据配置加载 ONNX 模型，并初始化 DirectML 会话。\n            Yolov26DetModel model = new Yolov26DetModel(config);\n            \n            // 使用 OpenCvSharp 读取图片到 Mat 对象中\n            // Mat 是 OpenCV 中用于存储图像数据的核心矩阵结构\n            Mat img = Cv2.ImRead(imagePath);\n            // ==========================================\n            // 5. 模型推理 (预热与测试)\n            // ==========================================\n            \n            // 执行多次推理。\n            // 第一次推理通常包含模型加载、内存分配等初始化开销，耗时较长。\n            Result[] result = model.Predict(img);\n            \n            // 后续推理用于测试稳定的推理速度。\n            result = model.Predict(img);\n            result = model.Predict(img);\n            result = model.Predict(img);\n            \n            // 打印性能分析记录。\n            // 这将输出推理过程中各阶段（如预处理、推理执行、后处理）的耗时统计。\n            model.ModelInferenceProfiler.PrintAllRecords();\n            \n            // 初始化列表，用于存储处理后的图像（本例主要用于演示）\n            List&lt;Mat&gt; resultsMat = new List&lt;Mat&gt;();\n            // ==========================================\n            // 6. 结果可视化与显示\n            // ==========================================\n            \n            // 调用可视化工具，将检测框（矩形框）和类别标签绘制在原图上。\n            // VisualizeOptions(1.0f) 可能指定了缩放比例或字体大小等参数。\n            var resultImg = Visualize.DrawDetResult(result, img, new VisualizeOptions(1.0f));\n            \n            // 将绘制好的图像加入列表\n            resultsMat.Add(resultImg);\n            \n            // 使用 OpenCV 的窗口显示结果图像。\n            // \"image\" 是窗口的标题。\n            Cv2.ImShow(\"image\", resultImg);\n            \n            // 等待按键输入。\n            // 参数 0 表示无限期等待，直到用户按下键盘任意键。\n            // 这是为了防止控制台程序执行完毕后窗口立即闪退。\n            Cv2.WaitKey();\n        }\n    \n    }\n}\n</code></pre>\n<h4 id=\"3代码详解-1\">（3）代码详解</h4>\n<p>上述代码与 3.1 节的代码结构基本相似，主要区别在于推理后端的配置：</p>\n<ol>\n<li>\n<p><strong>设置推理后端为 ONNX Runtime</strong>：</p>\n<pre><code class=\"language-csharp\">config.SetTargetInferenceBackend(InferenceBackend.OnnxRuntime);\n</code></pre>\n</li>\n<li>\n<p><strong>设置推理设备为 GPU</strong>（此处使用独显设备）：</p>\n<pre><code class=\"language-csharp\">config.SetTargetDeviceType(DeviceType.GPU0);\n</code></pre>\n</li>\n<li>\n<p><strong>配置 DirectML 加速</strong>：DirectML 是 Windows 上的高性能硬件加速接口，支持 AMD、NVIDIA 和 Intel 显卡，使用简单且无需复杂配置。</p>\n<pre><code class=\"language-csharp\">config.SetTargetOnnxRuntimeDeviceType(OnnxRuntimeDeviceType.DML);\n</code></pre>\n</li>\n</ol>\n<h4 id=\"4结果展示-1\">（4）结果展示</h4>\n<p>控制台输出如下。使用 DirectML 调用显卡加速，虽在速度上与 TensorRT 相比有所差距，但其配置简单、无需复杂设置的优势依然明显，适合快速开发验证。</p>\n<p><img alt=\"image-20260116221718516\" class=\"lazyload\" /></p>\n<h3 id=\"33-使用-opencvsharp-作为图像处理库--openvino-推理后端\">3.3 使用 OpenCvSharp 作为图像处理库 + OpenVINO 推理后端</h3>\n<h4 id=\"1nuget-包安装-2\">（1）NuGet 包安装</h4>\n<p>使用 OpenCvSharp 作为图像处理库、OpenVINO 作为推理后端时，需要安装以下核心包：</p>\n<p><strong>DeploySharp 基础库及扩展库</strong>：</p>\n<pre><code>JYPPX.DeploySharp\nJYPPX.DeploySharp.OpenCvSharp\n</code></pre>\n<p><strong>Runtime 库</strong>：</p>\n<pre><code>OpenCvSharp4.runtime.win\nOpenVINO.runtime.win\n</code></pre>\n<h4 id=\"2代码实现-2\">（2）代码实现</h4>\n<p>推理代码如下所示，可直接复制运行：</p>\n<pre><code class=\"language-csharp\">using OpenCvSharp;            // 引入 OpenCvSharp，用于图像的读取、显示和矩阵操作\nusing DeploySharp.Model;      // 引入模型定义和配置类\nusing DeploySharp.Data;       // 引入数据处理相关的类\nusing DeploySharp.Engine;     // 引入推理引擎核心接口和枚举\nusing DeploySharp;            // 引入 DeploySharp 主库和可视化工具\nnamespace DeploySharp.OpenCvSharp.Demo\n{\n    /// &lt;summary&gt;\n    ///  YOLO26 目标检测演示 (基于OpenVINO  + OpenCvSharp)\n    /// &lt;/summary&gt;\n    public class Yolov26DetDemo\n    {\n        public static void Run()\n        {\n            // ==========================================\n            // 1. 路径配置\n            // ==========================================\n            \n            // 模型下载提示：模型和测试图片可以前往QQ群(945057948)下载\n            // 注意：此处加载的是标准的 .onnx 模型文件，而不是 TensorRT 的 .engine 文件。\n            // ONNX 模型具有良好的跨平台特性。\n            string modelPath = @\"E:\\Model\\yolov28\\yolo26s.onnx\";\n            \n            // 设置待检测的图片路径\n            string imagePath = @\"E:\\Data\\image\\bus.jpg\";\n            // ==========================================\n            // 2. 模型配置\n            // ==========================================\n            \n            // 创建 YOLO26Det 的配置对象，传入模型路径\n            Yolov26DetConfig config = new Yolov26DetConfig(modelPath);\n            \n            // ==========================================\n            // 3. 类别字典定义 (COCO 80类)\n            // ==========================================\n            \n            // 定义 COCO 数据集的 80 个类别名称\n            // 这些名称将用于在结果可视化时标注检测到的物体\n            List&lt;string&gt; d = new List&lt;string&gt; { \"person\", \"bicycle\", \"car\", \"motorcycle\", \"airplane\", \"bus\",\n                \"train\", \"truck\", \"boat\", \"traffic light\", \"fire hydrant\", \"stop sign\", \"parking meter\", \"bench\",\n                \"bird\", \"cat\", \"dog\", \"horse\", \"sheep\", \"cow\", \"elephant\", \"bear\", \"zebra\", \"giraffe\", \"backpack\",\n                \"umbrella\", \"handbag\", \"tie\", \"suitcase\", \"frisbee\", \"skis\", \"snowboard\", \"sports ball\", \"kite\",\n                \"baseball bat\", \"baseball glove\", \"skateboard\", \"surfboard\", \"tennis racket\", \"bottle\", \"wine glass\",\n                \"cup\", \"fork\", \"knife\", \"spoon\", \"bowl\", \"banana\", \"apple\", \"sandwich\", \"orange\", \"broccoli\", \"carrot\",\n                \"hot dog\", \"pizza\", \"donut\", \"cake\", \"chair\", \"couch\", \"potted plant\", \"bed\", \"dining table\", \"toilet\",\n                \"tv\", \"laptop\", \"mouse\", \"remote\", \"keyboard\", \"cell phone\", \"microwave\", \"oven\", \"toaster\", \"sink\",\n                \"refrigerator\", \"book\", \"clock\", \"vase\", \"scissors\", \"teddy bear\", \"hair drier\", \"toothbrush\" };\n            // 构建&lt;索引, 类别名&gt;字典\n            Dictionary&lt;int, string&gt; CategoryDict = new Dictionary&lt;int, string&gt;();\n            for (int i = 0; i &lt; d.Count; i++)\n            {\n                CategoryDict[i] = d[i];\n            }\n            \n            // 将类别字典赋值给配置对象\n            config.CategoryDict = CategoryDict;\n            // ==========================================\n            // 4. 模型初始化\n            // ==========================================\n            \n            // 实例化模型，传入配置。\n            // 此时 DeploySharp 会根据配置加载 ONNX 模型，并初始化 DirectML 会话。\n            Yolov26DetModel model = new Yolov26DetModel(config);\n            \n            // 使用 OpenCvSharp 读取图片到 Mat 对象中\n            // Mat 是 OpenCV 中用于存储图像数据的核心矩阵结构\n            Mat img = Cv2.ImRead(imagePath);\n            // ==========================================\n            // 5. 模型推理 (预热与测试)\n            // ==========================================\n            \n            // 执行多次推理。\n            // 第一次推理通常包含模型加载、内存分配等初始化开销，耗时较长。\n            Result[] result = model.Predict(img);\n            \n            // 后续推理用于测试稳定的推理速度。\n            result = model.Predict(img);\n            result = model.Predict(img);\n            result = model.Predict(img);\n            \n            // 打印性能分析记录。\n            // 这将输出推理过程中各阶段（如预处理、推理执行、后处理）的耗时统计。\n            model.ModelInferenceProfiler.PrintAllRecords();\n            \n            // 初始化列表，用于存储处理后的图像（本例主要用于演示）\n            List&lt;Mat&gt; resultsMat = new List&lt;Mat&gt;();\n            // ==========================================\n            // 6. 结果可视化与显示\n            // ==========================================\n            \n            // 调用可视化工具，将检测框（矩形框）和类别标签绘制在原图上。\n            // VisualizeOptions(1.0f) 可能指定了缩放比例或字体大小等参数。\n            var resultImg = Visualize.DrawDetResult(result, img, new VisualizeOptions(1.0f));\n            \n            // 将绘制好的图像加入列表\n            resultsMat.Add(resultImg);\n            \n            // 使用 OpenCV 的窗口显示结果图像。\n            // \"image\" 是窗口的标题。\n            Cv2.ImShow(\"image\", resultImg);\n            \n            // 等待按键输入。\n            // 参数 0 表示无限期等待，直到用户按下键盘任意键。\n            // 这是为了防止控制台程序执行完毕后窗口立即闪退。\n            Cv2.WaitKey();\n        }\n    \n    }\n}\n</code></pre>\n<h4 id=\"3代码详解-2\">（3）代码详解</h4>\n<p>上述代码与 3.2 节的代码结构基本相似。使用 OpenVINO 作为推理后端时，通常无需额外设置，因为 DeploySharp 默认支持 OpenVINO。</p>\n<p>若设备配备英特尔的集成显卡、独立显卡或 NPU，可通过以下代码指定推理设备以获得更好的性能：</p>\n<pre><code class=\"language-csharp\">config.SetTargetInferenceBackend(InferenceBackend.OpenVINO);\nconfig.SetTargetDeviceType(DeviceType.GPU0);   // 设置设备为集显\n// 或\nconfig.SetTargetDeviceType(DeviceType.GPU1);  // 设置推理设备为独立显卡\n// 或\nconfig.SetTargetDeviceType(DeviceType.NPU);  // 设置推理设备为 NPU\n</code></pre>\n<h4 id=\"4结果展示-2\">（4）结果展示</h4>\n<p>控制台输出如下。使用 OpenVINO 在 CPU 上进行推理时，虽因设备限制推理速度有限，但 OpenVINO 已是 CPU 环境下推理速度最快的工具之一，且配置简单，全面支持英特尔全系设备，欢迎开发者使用。</p>\n<p><img alt=\"image-20260116223936848\" class=\"lazyload\" /></p>\n<h2 id=\"四yolov26-实例分割\">四、YOLOv26 实例分割</h2>\n<h3 id=\"41-代码使用示例\">4.1 代码使用示例</h3>\n<pre><code class=\"language-csharp\">using OpenCvSharp;            // 引入 OpenCvSharp，用于图像读取、显示及矩阵操作\nusing DeploySharp.Model;      // 引入模型配置相关的类\nusing DeploySharp.Data;       // 引入数据结果定义相关的类\nusing DeploySharp.Engine;     // 引入推理引擎核心接口\nusing DeploySharp;            // 引入 DeploySharp 主库及可视化工具\n\nnamespace DeploySharp.OpenCvSharp.Demo\n{\n    /// &lt;summary&gt;\n    /// YOLO26Seg 实例分割演示类\n    /// 本示例展示如何加载 TensorRT 引擎文件，对图像进行实例分割推理，并将掩码绘制在原图上。\n    /// &lt;/summary&gt;\n    public class Yolov26SegDemo\n    {\n        public static void Run()\n        {\n            // ==========================================\n            // 1. 路径配置\n            // ==========================================\n            \n            // 模型下载提示：模型和测试图片可以前往QQ群(945057948)下载\n            // 设置 TensorRT 引擎文件路径。\n            // 注意：这里使用的是 .engine 文件，它是针对特定 GPU 和 TensorRT 版本编译的。\n            // 文件名中的 '-seg' 表示这是一个带有分割头的实例分割模型。\n            string modelPath = @\"D:\\Program Files\\TensorRT-10.13.0.35-cu11\\bin\\yolo26s-seg.engine\";\n            \n            // 设置待推理的图片路径\n            string imagePath = @\"E:\\Data\\image\\bus.jpg\";\n\n\n            // ==========================================\n            // 2. 模型配置与初始化\n            // ==========================================\n            \n            // 创建 YOLO26Seg (实例分割) 的配置对象，传入模型路径\n            Yolov26SegConfig config = new Yolov26SegConfig(modelPath);\n            \n            // [关键设置] 指定推理后端为 TensorRT。\n            // 利用 TensorRT 可以在 NVIDIA GPU 上获得极高的推理速度。\n            config.SetTargetInferenceBackend(InferenceBackend.TensorRT);\n            \n            // 实例化模型。\n            // 此时会加载引擎文件，初始化 GPU 显存上下文。\n            Yolov26SegModel model = new Yolov26SegModel(config);\n\n\n            // ==========================================\n            // 3. 图像加载\n            // ==========================================\n            \n            // 使用 OpenCvSharp 读取图片。\n            // img 是一个 Mat 对象，包含了图像的像素数据。\n            Mat img = Cv2.ImRead(imagePath);\n\n\n            // ==========================================\n            // 4. 模型推理 (预热与性能测试)\n            // ==========================================\n            \n            // 执行第一次推理。\n            // 首次运行通常包含模型加载、显存分配等开销，耗时较长。\n            var result = model.Predict(img);\n            \n            // 执行后续多次推理。\n            // 这是为了排除初始化开销，测试模型在稳定状态下的推理速度。\n            result = model.Predict(img);\n            result = model.Predict(img);\n            result = model.Predict(img);\n            \n            // 打印推理性能分析记录。\n            // 这将输出预处理、推理计算、后处理（包括掩码生成）各阶段的耗时。\n            model.ModelInferenceProfiler.PrintAllRecords();\n\n\n            // ==========================================\n            // 5. 结果可视化\n            // ==========================================\n            \n            // 调用可视化工具，绘制分割结果。\n            // 注意这里使用的是 DrawSegResult (绘制分割结果)，而不是 DrawDetResult (绘制检测框)。\n            // 该函数会将检测到的物体框、类别标签以及彩色的半透明掩码绘制在原图上。\n            var resultImg = Visualize.DrawSegResult(result, img, new VisualizeOptions(1.0f));\n            \n            // 使用 OpenCV 窗口显示渲染后的结果图像。\n            Cv2.ImShow(\"image\", resultImg);\n            \n            // 等待按键输入，防止窗口闪退。\n            Cv2.WaitKey();\n        }\n    }\n}\n\n</code></pre>\n<h3 id=\"42-代码详解\">4.2 代码详解</h3>\n<ol>\n<li>\n<p><strong>创建分割配置</strong>：</p>\n<pre><code class=\"language-csharp\">Yolov26SegConfig config = new Yolov26SegConfig(modelPath);\nconfig.SetTargetInferenceBackend(InferenceBackend.TensorRT);\n</code></pre>\n<p><code>Yolov26SegConfig</code> 是 YOLOv26 分割模型的配置类。</p>\n</li>\n<li>\n<p><strong>执行分割推理</strong>：</p>\n<pre><code class=\"language-csharp\">var result = model.Predict(img);\n</code></pre>\n<p>分割推理返回 <code>SegResult[]</code> 数组，每个元素包含边界框、置信度、类别和分割掩码。</p>\n</li>\n<li>\n<p><strong>可视化分割结果</strong>：</p>\n<pre><code class=\"language-csharp\">var resultImg = Visualize.DrawSegResult(result, img, new VisualizeOptions(1.0f));\n</code></pre>\n<p><code>DrawSegResult</code> 会为每个检测到的对象绘制不同颜色的掩码，叠加在原图上。</p>\n</li>\n</ol>\n<h3 id=\"43-分割结果展示\">4.3 分割结果展示</h3>\n<h4 id=\"控制台输出\">控制台输出</h4>\n<p>以下三张截图分别展示了在 TensorRT GPU、ONNX Runtime(DirectML) GPU、OpenVINO CPU 设备下的推理性能。不同引擎各有优势，开发者可根据自身硬件环境选择最适合的方案。</p>\n<p><strong>TensorRT GPU：</strong></p>\n<p><img alt=\"image-20260116231515663\" class=\"lazyload\" /></p>\n<p><strong>ONNX Runtime (DirectML) GPU：</strong></p>\n<p><img alt=\"image-20260116231805014\" class=\"lazyload\" /></p>\n<p><strong>OpenVINO CPU：</strong></p>\n<p><img alt=\"image-20260116231630904\" class=\"lazyload\" /></p>\n<h4 id=\"推理结果绘制\">推理结果绘制</h4>\n<p>下图为官方预训练模型导出后的推理结果示例：</p>\n<p><img alt=\"image-20260116231431298\" class=\"lazyload\" /></p>\n<h2 id=\"五yolov26-人体姿态估计\">五、YOLOv26 人体姿态估计</h2>\n<h3 id=\"51-功能介绍\">5.1 功能介绍</h3>\n<p>YOLO26 Pose 模型用于检测人体关键点，通常支持 17 个关键点（头部、颈部、肩膀、手肘、手腕、臀部、膝盖、脚踝等）。</p>\n<p><strong>关键点定义</strong>（COCO 格式）：</p>\n<table>\n<thead>\n<tr>\n<th>关键点</th>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0</td>\n<td>nose</td>\n<td>鼻子</td>\n</tr>\n<tr>\n<td>1</td>\n<td>left_eye</td>\n<td>左眼</td>\n</tr>\n<tr>\n<td>2</td>\n<td>right_eye</td>\n<td>右眼</td>\n</tr>\n<tr>\n<td>3</td>\n<td>left_ear</td>\n<td>左耳</td>\n</tr>\n<tr>\n<td>4</td>\n<td>right_ear</td>\n<td>右耳</td>\n</tr>\n<tr>\n<td>5</td>\n<td>left_shoulder</td>\n<td>左肩</td>\n</tr>\n<tr>\n<td>6</td>\n<td>right_shoulder</td>\n<td>右肩</td>\n</tr>\n<tr>\n<td>7</td>\n<td>left_elbow</td>\n<td>左肘</td>\n</tr>\n<tr>\n<td>8</td>\n<td>right_elbow</td>\n<td>右肘</td>\n</tr>\n<tr>\n<td>9</td>\n<td>left_wrist</td>\n<td>左腕</td>\n</tr>\n<tr>\n<td>10</td>\n<td>right_wrist</td>\n<td>右腕</td>\n</tr>\n<tr>\n<td>11</td>\n<td>left_hip</td>\n<td>左髋</td>\n</tr>\n<tr>\n<td>12</td>\n<td>right_hip</td>\n<td>右髋</td>\n</tr>\n<tr>\n<td>13</td>\n<td>left_knee</td>\n<td>左膝</td>\n</tr>\n<tr>\n<td>14</td>\n<td>right_knee</td>\n<td>右膝</td>\n</tr>\n<tr>\n<td>15</td>\n<td>left_ankle</td>\n<td>左踝</td>\n</tr>\n<tr>\n<td>16</td>\n<td>right_ankle</td>\n<td>右踝</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"52-代码使用示例\">5.2 代码使用示例</h3>\n<pre><code class=\"language-csharp\">using OpenCvSharp;            // 引入 OpenCvSharp，用于图像的读取、显示和矩阵操作\nusing DeploySharp.Model;      // 引入模型定义和配置类\nusing DeploySharp.Data;       // 引入数据结果相关的类\nusing DeploySharp.Engine;     // 引入推理引擎核心接口\nusing DeploySharp;            // 引入 DeploySharp 主库和可视化工具\nusing System;                 // 引入 System 命名空间以使用 Console\n\nnamespace DeploySharp.OpenCvSharp.Demo\n{\n    /// &lt;summary&gt;\n    /// YOLO26Pose 姿态估计演示类\n    /// 本示例展示了如何加载 ONNX 模型进行人体关键点检测，并可视化骨骼连接。\n    /// &lt;/summary&gt;\n    public class Yolov26PoseDemo\n    {\n        public static void Run()\n        {\n            // ==========================================\n            // 1. 路径配置\n            // ==========================================\n            \n            // 模型下载提示：模型和测试图片可以前往QQ群(945057948)下载\n            // 设置 ONNX 模型文件路径。\n            // '-pose' 后缀表示这是一个专门用于姿态估计（关键点检测）的模型。\n            string modelPath = @\"E:\\Model\\yolov28\\yolo26s-pose.onnx\";\n            \n            // 设置待推理的图片路径\n            string imagePath = @\"E:\\Data\\image\\demo_9.jpg\";\n\n\n            // ==========================================\n            // 2. 模型配置与初始化\n            // ==========================================\n            \n            // 创建 YOLO26Pose (姿态估计) 的配置对象，传入模型路径\n            Yolov26PoseConfig config = new Yolov26PoseConfig(modelPath);\n            \n            // [关键设置] 设置推理后端为 ONNX Runtime。\n            // 这使得模型可以跨平台运行，不仅限于 NVIDIA GPU（取决于 ONNX Runtime 的安装提供程序）。\n            config.SetTargetInferenceBackend(InferenceBackend.OnnxRuntime);\n            \n            // 实例化姿态估计模型。\n            // 模型加载时会解析 ONNX 图结构，准备好输入输出节点。\n            Yolov26PoseModel model = new Yolov26PoseModel(config);\n\n\n            // ==========================================\n            // 3. 图像加载\n            // ==========================================\n            \n            // 使用 OpenCvSharp 读取图片。\n            Mat img = Cv2.ImRead(imagePath);\n\n\n            // ==========================================\n            // 4. 模型推理与结果查看\n            // ==========================================\n            \n            // 执行推理。\n            // 第一次推理通常较慢，包含初始化开销。\n            var result = model.Predict(img);\n            \n            // 执行多次推理以测试稳定状态下的性能。\n            result = model.Predict(img);\n            result = model.Predict(img);\n            result = model.Predict(img);\n            \n            // 打印第一个结果的详细信息到控制台。\n            // 姿态估计的 Result 对象通常包含检测框信息以及一个关键点数组。\n            // 这一行有助于开发者调试，查看模型输出的原始数据结构。\n            Console.WriteLine(result[0].ToString());\n            \n            // 打印性能分析记录，查看各阶段耗时。\n            model.ModelInferenceProfiler.PrintAllRecords();\n\n\n            // ==========================================\n            // 5. 结果可视化\n            // ==========================================\n            \n            // 调用可视化工具，绘制姿态估计结果。\n            // 注意这里使用的是 DrawPoses，它会自动将识别出的关键点（如眼睛、肩膀、肘部等）\n            // 用圆点标出，并根据人体结构连接成骨架。\n            // VisualizeOptions(1.0f) 可能指定了绘制时的线条粗细或字体缩放比例。\n            var resultImg = Visualize.DrawPoses(result, img, new VisualizeOptions(1.0f));\n            \n            // 显示结果图像。\n            Cv2.ImShow(\"image\", resultImg);\n            \n            // 等待按键，防止窗口闪退。\n            Cv2.WaitKey();\n        }\n    }\n}\n\n</code></pre>\n<h3 id=\"53-代码详解\">5.3 代码详解</h3>\n<ol>\n<li>\n<p><strong>创建姿态估计配置</strong>：</p>\n<pre><code class=\"language-csharp\">Yolov26PoseConfig config = new Yolov26PoseConfig(modelPath);\nconfig.SetTargetInferenceBackend(InferenceBackend.OnnxRuntime);\n</code></pre>\n<p><code>Yolov26PoseConfig</code> 是 YOLOv26 姿态估计模型的配置类。</p>\n</li>\n<li>\n<p><strong>执行姿态估计推理</strong>：</p>\n<pre><code class=\"language-csharp\">var result = model.Predict(img);\n</code></pre>\n<p>姿态估计推理返回 <code>KeyPointResult[]</code> 数组，每个元素包含人体边界框、置信度和 17 个关键点坐标。</p>\n</li>\n<li>\n<p><strong>可视化姿态估计结果</strong>：</p>\n<pre><code class=\"language-csharp\">var resultImg = Visualize.DrawPoses(result, img, new VisualizeOptions(1.0f));\n</code></pre>\n<p><code>DrawPoses</code> 会绘制人体骨架（连接关键点）和关键点标记。</p>\n</li>\n</ol>\n<h3 id=\"54-结果展示\">5.4 结果展示</h3>\n<h4 id=\"控制台输出-1\">控制台输出</h4>\n<p>以下截图展示了在 ONNX Runtime CPU 设备下的推理性能：</p>\n<p><img alt=\"image-20260116232926313\" class=\"lazyload\" /></p>\n<h4 id=\"推理结果绘制-1\">推理结果绘制</h4>\n<p>下图为官方预训练模型导出后的推理结果示例：</p>\n<p><img alt=\"image-20260116232942723\" class=\"lazyload\" /></p>\n<h2 id=\"六yolov26-旋转框检测\">六、YOLOv26 旋转框检测</h2>\n<p>YOLOv26 OBB (Oriented Bounding Box) 模型用于检测旋转物体，生成带有旋转角度的边界框。这对于检测航空影像中的建筑物、遥感图像中的车辆等场景非常重要。</p>\n<h3 id=\"61-代码使用示例\">6.1 代码使用示例</h3>\n<p>以下代码演示如何使用 TensorRT 引擎进行旋转目标检测：</p>\n<pre><code class=\"language-csharp\">using OpenCvSharp;            // 引入 OpenCvSharp，用于图像读取、显示及绘图\nusing DeploySharp.Model;      // 引入模型配置相关的类\nusing DeploySharp.Data;       // 引入数据结果定义相关的类\nusing DeploySharp.Engine;     // 引入推理引擎核心接口\nusing DeploySharp;            // 引入 DeploySharp 主库及可视化工具\nnamespace DeploySharp.OpenCvSharp.Demo\n{\n    /// &lt;summary&gt;\n    /// YOLOv26 OBB 旋转目标检测演示类\n    /// 本示例展示如何加载 TensorRT 引擎文件，对图像进行旋转目标检测，并绘制旋转框。\n    /// &lt;/summary&gt;\n    public class Yolov26ObbDemo\n    {\n        public static void Run()\n        {\n            // ==========================================\n            // 1. 路径配置\n            // ==========================================\n            \n            // 模型下载提示：模型和测试图片可以前往 QQ 群（945057948）下载\n            // '-obb' 表示该模型用于输出旋转边界框\n            string modelPath = @\"D:\\Program Files\\TensorRT-10.13.0.35-cu11\\bin\\yolo26s-obb.engine\";\n            \n            // 设置待推理的图片路径\n            // plane.png 是旋转目标检测的经典测试图（飞机停机坪通常包含各种角度的飞机）。\n            string imagePath = @\"E:\\Data\\image\\plane.png\";\n            // ==========================================\n            // 2. 模型配置与初始化\n            // ==========================================\n            \n            // 创建 YOLOv26 OBB (旋转目标检测) 的配置对象，传入模型路径\n            Yolov26ObbConfig config = new Yolov26ObbConfig(modelPath);\n            \n            // [关键设置] 指定推理后端为 TensorRT。\n            // 这将调用 NVIDIA GPU 进行高性能计算。\n            // 注意：因为使用的是 .engine 文件，所以必须选择 TensorRT 后端。\n            config.SetTargetInferenceBackend(InferenceBackend.TensorRT);\n            \n            // 实例化旋转目标检测模型。\n            Yolov26ObbModel model = new Yolov26ObbModel(config);\n            // ==========================================\n            // 3. 图像加载\n            // ==========================================\n            \n            // 使用 OpenCvSharp 读取图片。\n            Mat img = Cv2.ImRead(imagePath);\n            // ==========================================\n            // 4. 模型推理\n            // ==========================================\n            \n            // 执行推理。\n            var result = model.Predict(img);\n            \n     \n            // 如果需要测试纯推理速度（排除初始化开销），可以取消注释进行多次循环。\n            result = model.Predict(img);\n            result = model.Predict(img);\n            result = model.Predict(img);\n            \n            // 打印性能分析记录。\n            // 这将显示预处理、TensorRT 推理、后处理（包含 OBB 解码）的耗时。\n            model.ModelInferenceProfiler.PrintAllRecords();\n            // ==========================================\n            // 5. 结果可视化\n            // ==========================================\n            \n            // 调用可视化工具，绘制旋转检测结果。\n            // DrawObbResult 会根据检测到的 x, y, w, h 和 angle (角度) 绘制旋转矩形。\n            var resultImg = Visualize.DrawObbResult(result, img, new VisualizeOptions(1.0f));\n            \n            // [可选] 调整图片大小以适应屏幕\n            // 航拍图通常分辨率很大，可以缩小显示。\n            //Cv2.Resize(resultImg, resultImg, new Size(resultImg.Width / 4, resultImg.Height / 4));\n            \n            // 显示结果图像。\n            Cv2.ImShow(\"image\", resultImg);\n            \n            // 等待按键，防止窗口闪退。\n            Cv2.WaitKey();\n        }\n    }\n}\n</code></pre>\n<h3 id=\"62-代码详解\">6.2 代码详解</h3>\n<ol>\n<li>\n<p><strong>创建旋转框检测配置</strong>：</p>\n<pre><code class=\"language-csharp\">Yolov26ObbConfig config = new Yolov26ObbConfig(modelPath);\nconfig.SetTargetInferenceBackend(InferenceBackend.TensorRT);\n</code></pre>\n<p><code>Yolov26ObbConfig</code> 是 YOLOv26 旋转框检测模型的配置类。</p>\n</li>\n<li>\n<p><strong>执行旋转框检测推理</strong>：</p>\n<pre><code class=\"language-csharp\">ObbResult[] result = model.Predict(img);\n</code></pre>\n<p>旋转框检测推理返回 <code>ObbResult[]</code> 数组，每个元素包含中心点、宽度、高度、旋转角度和类别信息。</p>\n</li>\n<li>\n<p><strong>可视化旋转框检测结果</strong>：</p>\n<pre><code class=\"language-csharp\">var resultImg = Visualize.DrawObbResult(result, img, new VisualizeOptions(1.0f));\n</code></pre>\n<p><code>DrawObbResult</code> 会绘制旋转的边界框（四边形），而不是普通的轴对齐矩形。</p>\n</li>\n</ol>\n<h3 id=\"63-旋转框检测结果展示\">6.3 旋转框检测结果展示</h3>\n<h4 id=\"控制台输出-2\">控制台输出</h4>\n<p>以下截图展示了在 TensorRT GPU 设备下的推理性能：</p>\n<p><img alt=\"image-20260116233931296\" class=\"lazyload\" /></p>\n<h4 id=\"推理结果绘制-2\">推理结果绘制</h4>\n<p>下图为官方预训练模型导出后的推理结果示例：</p>\n<p><img alt=\"image-20260116233543902\" class=\"lazyload\" /></p>\n<h2 id=\"七跨引擎支持\">七、跨引擎支持</h2>\n<p>DeploySharp 原生支持 OpenVINO、ONNX Runtime、TensorRT 三大主流推理引擎，为开发者在 CPU、GPU、NPU 等不同硬件设备上部署模型提供了最全面的解决方案。集成的 YOLOv26 系列默认支持所有推理引擎，开发者可根据实际硬件环境选择最优的推理方案。</p>\n<h3 id=\"71-引擎性能对比\">7.1 引擎性能对比</h3>\n<table>\n<thead>\n<tr>\n<th>引擎</th>\n<th>优势</th>\n<th>适用场景</th>\n<th>性能特点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>OpenVINO</td>\n<td>Intel 硬件优化，支持多种设备（CPU、GPU0、GPU1、NPU）</td>\n<td>Intel CPU、Intel GPU、NPU</td>\n<td>Intel 硬件加速</td>\n</tr>\n<tr>\n<td>ONNX Runtime</td>\n<td>广泛支持，跨平台，兼容性好</td>\n<td>CPU、GPU(CUDA/DML)、移动端</td>\n<td>平衡性能与兼容性</td>\n</tr>\n<tr>\n<td>TensorRT</td>\n<td>NVIDIA GPU 极致性能，经过专门优化</td>\n<td>NVIDIA GPU 高性能场景</td>\n<td>最佳 GPU 性能</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"72-引擎选择建议\">7.2 引擎选择建议</h3>\n<p>根据硬件环境和应用场景选择合适的推理引擎：</p>\n<table>\n<thead>\n<tr>\n<th>硬件环境</th>\n<th>推荐引擎</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Intel CPU/GPU</td>\n<td>OpenVINO</td>\n<td>Intel 硬件优化，性能最佳</td>\n</tr>\n<tr>\n<td>NVIDIA GPU</td>\n<td>TensorRT</td>\n<td>极致性能，适合高频推理</td>\n</tr>\n<tr>\n<td>NVIDIA GPU (需要灵活性)</td>\n<td>ONNX Runtime (CUDA)</td>\n<td>兼容性好，易于切换</td>\n</tr>\n<tr>\n<td>通用 CPU</td>\n<td>ONNX Runtime</td>\n<td>跨平台兼容性好</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"73-引擎切换示例\">7.3 引擎切换示例</h3>\n<pre><code class=\"language-csharp\">// 切换到 OpenVINO\nconfig.SetTargetInferenceBackend(InferenceBackend.OpenVINO);\nconfig.TargetDeviceType = DeviceType.CPU;\n\n// 切换到 ONNX Runtime (CUDA)\nconfig.SetTargetInferenceBackend(InferenceBackend.OnnxRuntime);\nconfig.TargetDeviceType = DeviceType.GPU;\n\n// 切换到 TensorRT\nconfig.SetTargetInferenceBackend(InferenceBackend.TensorRT);\nconfig.TargetDeviceType = DeviceType.GPU;\n</code></pre>\n<p><strong>注意</strong>：切换推理引擎可能需要重新加载模型，建议在应用启动时确定使用的引擎。</p>\n<h2 id=\"八性能优化建议\">八、性能优化建议</h2>\n<h3 id=\"81-预热机制\">8.1 预热机制</h3>\n<p>首次推理通常较慢，因为需要加载模型、初始化推理引擎、编译计算图等。建议执行几次预热推理。</p>\n<pre><code class=\"language-csharp\">// 预热模型（执行 3 次推理）\nfor (int i = 0; i &lt; 3; i++)\n{\n    model.Predict(img);\n}\n\n// 实际推理\nvar result = model.Predict(img);\n</code></pre>\n<h3 id=\"82-批量推理\">8.2 批量推理</h3>\n<p>对于大量图像，使用批量推理可以提高吞吐量，前提是模型支持多 Batch Size。</p>\n<pre><code class=\"language-csharp\">// 设置批量大小为 4\nconfig.InferBatch = 4;\n\n// 准备批量图像\nvar imageList = new List&lt;Image&lt;Rgb24&gt;&gt;();\nimageList.Add(Image.Load&lt;Rgb24&gt;(@\"path1.jpg\"));\nimageList.Add(Image.Load&lt;Rgb24&gt;(@\"path2.jpg\"));\nimageList.Add(Image.Load&lt;Rgb24&gt;(@\"path3.jpg\"));\nimageList.Add(Image.Load&lt;Rgb24&gt;(@\"path4.jpg\"));\n\n// 执行批量推理\nvar results = model.Predict(imageList);\n</code></pre>\n<h3 id=\"83-设备选择\">8.3 设备选择</h3>\n<p>根据硬件选择最优设备：</p>\n<pre><code class=\"language-csharp\">// Intel 环境：使用 OpenVINO\nconfig.SetTargetInferenceBackend(InferenceBackend.OpenVINO);\n\n// NVIDIA 环境：使用 TensorRT 或 ONNX Runtime (CUDA)\nconfig.SetTargetInferenceBackend(InferenceBackend.TensorRT);\nconfig.TargetDeviceType = DeviceType.GPU;\n</code></pre>\n<h2 id=\"九总结\">九、总结</h2>\n<p>DeploySharp 对 YOLOv26 系列提供了全面而深入的支持，包括：</p>\n<ol>\n<li><strong>四种任务类型全覆盖</strong>：检测、分割、姿态估计、旋转框检测</li>\n<li><strong>双图像处理库支持</strong>：ImageSharp 和 OpenCvSharp</li>\n<li><strong>三推理引擎兼容</strong>：OpenVINO、ONNX Runtime、TensorRT</li>\n<li><strong>完善的配置系统</strong>：灵活的参数设置</li>\n<li><strong>详细的性能分析</strong>：内置性能分析器</li>\n<li><strong>丰富的可视化选项</strong>：支持多种结果展示方式</li>\n</ol>\n<p>YOLOv26 的简化的输出格式和优化的架构，结合 DeploySharp 的封装和优化，使得开发者可以轻松地将 YOLOv26 集成到各种 C# 应用中，构建高效、准确的计算机视觉解决方案。</p>\n<p>随着 YOLO 系列的持续发展，DeploySharp 也将持续跟进，为开发者提供最新模型的支持。期待 YOLOv26 及未来版本的更多创新和突破。</p>\n<h2 id=\"技术支持\">技术支持</h2>\n<p>如有问题或建议，欢迎通过以下方式交流：</p>\n<ul>\n<li>📧 <strong>GitHub Issues</strong>：在项目仓库提 Issue 或 Pull Request</li>\n<li>💬 <strong>QQ 交流群</strong>：加入 <strong>945057948</strong>，回复更方便更快哦</li>\n</ul>\n<p><img alt=\"QQ群二维码\" class=\"lazyload\" /></p>\n<hr />\n<p><em>作者：Guojin Yan</em><br />\n<em>版本：0.0.6.1</em><br />\n<em>最后更新：2026年1月</em></p>\n<hr />\n<p><strong>【文章声明】</strong></p>\n<p>本文主要内容基于作者的研究与实践，部分表述借助AI工具进行了辅助优化。由于技术局限性，文中可能存在错误或疏漏之处，恳请各位读者批评指正。如果内容无意中侵犯了您的权益，请及时通过公众号后台与我们联系，我们将第一时间核实并妥善处理。感谢您的理解与支持！</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-19 22:47</span>&nbsp;\n<a href=\"https://www.cnblogs.com/guojin-blogs\">椒颜皮皮虾</a>&nbsp;\n阅读(<span id=\"post_view_count\">10</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "吴恩达深度学习课程五：自然语言处理  第二周：词嵌入（二）词嵌入模型原理",
      "link": "https://www.cnblogs.com/Goblinscholar/p/19503620",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/Goblinscholar/p/19503620\" id=\"cb_post_title_url\" title=\"发布于 2026-01-19 20:35\">\n    <span>吴恩达深度学习课程五：自然语言处理  第二周：词嵌入（二）词嵌入模型原理</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>此分类用于记录吴恩达深度学习课程的学习笔记。<br />\n课程相关信息链接如下：</p>\n<ol>\n<li>原课程视频链接：<a href=\"https://www.bilibili.com/video/BV1FT4y1E74V?buvid=XU762317353676D786954061C192FE625463B&amp;from_spmid=playlist.playlist-detail.0.0&amp;is_story_h5=false&amp;mid=zqernykrmpf7XfIorMR%2FnA%3D%3D&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=ce0bc526-db69-428a-962e-c65ed8c267bc&amp;share_source=COPY&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1713085655&amp;unique_k=DfBgvFW&amp;up_id=8654113&amp;vd_source=e035e9878d32f414b4354b839a4c31a4\" rel=\"noopener nofollow\" target=\"_blank\">[双语字幕]吴恩达深度学习deeplearning.ai</a></li>\n<li>github课程资料，含课件与笔记:<a href=\"https://github.com/robbertliu/deeplearning.ai-andrewNG\" rel=\"noopener nofollow\" target=\"_blank\">吴恩达深度学习教学资料</a></li>\n<li>课程配套练习（中英）与答案：<a href=\"https://blog.csdn.net/u013733326/article/details/79827273\" rel=\"noopener nofollow\" target=\"_blank\">吴恩达深度学习课后习题与答案</a></li>\n</ol>\n<p>本篇为第五课的第二周内容，<a href=\"https://www.bilibili.com/video/BV1FT4y1E74V?spm_id_from=333.788.videopod.episodes&amp;vd_source=e035e9878d32f414b4354b839a4c31a4&amp;p=166\" rel=\"noopener nofollow\" target=\"_blank\">2.4</a>到<a href=\"https://www.bilibili.com/video/BV1FT4y1E74V?spm_id_from=333.788.videopod.episodes&amp;vd_source=e035e9878d32f414b4354b839a4c31a4&amp;p=167\" rel=\"noopener nofollow\" target=\"_blank\">2.5</a>的内容以及一些相关知识的补充。</p>\n<hr />\n<p>本周为第五课的第二周内容，与 CV 相对应的，这一课所有内容的中心只有一个：<strong>自然语言处理（Natural Language Processing，NLP）</strong>。<br />\n应用在深度学习里，它是专门用来进行<strong>文本与序列信息建模</strong>的模型和技术，本质上是在全连接网络与统计语言模型基础上的一次“结构化特化”，也是人工智能中<strong>最贴近人类思维表达方式</strong>的重要研究方向之一。<br />\n<strong>这一整节课同样涉及大量需要反复消化的内容，横跨机器学习、概率统计、线性代数以及语言学直觉。</strong><br />\n语言不像图像那样“直观可见”，更多是抽象符号与上下文关系的组合，因此<strong>理解门槛反而更高</strong>。<br />\n因此，我同样会尽量补足必要的背景知识，尽可能用比喻和实例降低理解难度。<br />\n本周的内容关于词嵌入，是一种<strong>相对于独热编码，更能保留语义信息的文本编码方式</strong>。通过词嵌入，模型不再只是“记住”词本身，而是能够<strong>基于语义关系进行泛化</strong>，在一定程度上实现类似“<strong>举一反三</strong>”的效果。词嵌入是 NLP 领域中最重要的基础技术之一。</p>\n<p>本篇的内容关于<strong>词嵌入模型原理</strong>，是了解基础内容后的下一步引入。</p>\n<h1 id=\"1-词嵌入矩阵\">1. 词嵌入矩阵</h1>\n<p>在<a href=\"https://www.cnblogs.com/Goblinscholar/p/19494158\" target=\"_blank\">上一篇</a>中，我们知道通过词嵌入可以实现词汇的特征化表示，这种序列信息编码方式相比独热编码不仅节约了存储和时间成本，而且可以量化词汇的语义来提升模型性能。<br />\n那么要如何训练一个可以输出对词汇合适编码的词嵌入模型呢？<br />\n实际上，词嵌入模型的原理和我们之前介绍过的<a href=\"https://www.cnblogs.com/Goblinscholar/p/19423276\" target=\"_blank\">图像风格转换</a>有些类似，就像其首先要随机初始化目标图像一样，词嵌入模型的第一步，并不是“理解语义”，而是<strong>先给每个词一个可以被学习的数值载体</strong>。<br />\n具体来说是这样的：<br />\n<img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260119203403821-212247932.png\" /></p>\n<p>如图所示，假设我们的词表大小为 <span class=\"math inline\">\\(|V|\\)</span>，词向量维度设为 <span class=\"math inline\">\\(d\\)</span>，那么词嵌入本质上就是一个矩阵，每一行对应词表中的一个词，我们称之为<strong>词嵌入矩阵</strong>。</p>\n<p></p><div class=\"math display\">\\[\\mathbf{E}\n=\n\\begin{bmatrix}\nv_{1,1} &amp; v_{1,2} &amp; v_{1,3} &amp; \\cdots &amp; v_{1,d} \\\\\nv_{2,1} &amp; v_{2,2} &amp; v_{2,3} &amp; \\cdots &amp; v_{2,d} \\\\\nv_{3,1} &amp; v_{3,2} &amp; v_{3,3} &amp; \\cdots &amp; v_{3,d} \\\\\n\\vdots  &amp; \\vdots  &amp; \\vdots  &amp; \\ddots &amp; \\vdots  \\\\\nv_{|V|,1} &amp; v_{|V|,2} &amp; v_{|V|,3} &amp; \\cdots &amp; v_{|V|,d}\n\\end{bmatrix}\n\\]</div><p></p><p>这里需要强调的是，在课程中，吴恩达老师常在词嵌入矩阵中使用列向量来表示词向量，以匹配矩阵乘法的约定。但在实际工程代码中，通常视作行向量（矩阵行对应词向量）。<strong>这只是约定问题</strong>，取决于实现方式：教学中列向量便于公式推导，代码中行向量更高效。了解后，根据场景选择即可。<br />\n回到正题，在模型初始化阶段，词嵌入矩阵<strong>并不包含任何语义信息</strong>，通常采用随机初始化，或者服从均值为 0 的正态分布。<br />\n我们之前就说过，词向量并不是我们手工设定的，而是在模型学习得到的，在我们完成词嵌入矩阵的初始化后，<strong>词嵌入模型的目的就是不断传播和优化词嵌入矩阵，得到对语义编码合理的词向量</strong>，从而进行下一步应用。</p>\n<p>到这里就会发现，学习词嵌入矩阵的过程和图像风格转换的过程非常相似：一开始是随机噪声，但在损失函数的约束下，逐步学习得到结构化、有意义的结果。</p>\n<p>在完成词嵌入矩阵的初始化后，<strong>模型训练的核心任务就是设计合理的上下文预测目标，让矩阵中每一行（词向量）逐步调整位置，从而携带语义信息。</strong></p>\n<h1 id=\"2-早期词嵌入模型\">2. 早期词嵌入模型</h1>\n<p>在 2003 年，一篇论文 <a href=\"https://www.jmlr.org/papers/volume3/bengio03a/bengio03a.pdf\" rel=\"noopener nofollow\" target=\"_blank\">A Neural Probabilistic Language Model</a>，首次展示了一个神经网络语言模型，它不仅预测下一个词的概率分布，还通过一个嵌入层将词索引映射为实值向量。这些向量成为了词的稠密表示，也就是我们今天所说的<strong>词嵌入（word embeddings）</strong>。<br />\n尽管当时论文中并没有直接使用“word embedding”这个术语，但其核心思想：<strong>通过神经网络学习词的分布式向量表示</strong>——正是现代词嵌入模型的理论源头。</p>\n<h2 id=\"21-词嵌入模型原理\">2.1 词嵌入模型原理</h2>\n<p>这一部分我们展开一下，用早期的模型介绍一下最经典的一类词嵌入模型：<strong>预测型词嵌入模型</strong>的基本逻辑：<br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260119202257923-2120601282.png\" /><br />\n图中简要描述了该模型的传播逻辑，补充一些细节如下：</p>\n<ol>\n<li><strong>嵌入层（Embedding Layer）</strong>：在图中的左半部分，完成的是<strong>存储词嵌入矩阵和根据索引查找机制提取词向量</strong>的工作，我们称完成这部分内容的结构为<strong>嵌入层</strong>。</li>\n<li><strong>窗口大小 <span class=\"math inline\">\\(t\\)</span></strong>：这是一个超参数，当预测序列中第 <span class=\"math inline\">\\(n\\)</span> 个词汇时，我们使用其之前 <span class=\"math inline\">\\(t\\)</span> 个词汇作为序列信息。<strong>在现代，前文如果不足 <span class=\"math inline\">\\(t\\)</span> 个，则会使用特殊符号填充。</strong></li>\n<li><strong>联合更新</strong>：在反向传播过程中，<strong>嵌入层和网络的其他参数同时更新</strong>。这意味着每次看到训练样本，嵌入矩阵中涉及的<strong>词向量会和网络参数一起沿梯度方向调整</strong>，使其更有利于下一个词的预测。</li>\n</ol>\n<p>那词向量具体是怎么更新来学习语义的呢？我们展开说说：</p>\n<h2 id=\"22-词向量的语义学习\">2.2 词向量的语义学习</h2>\n<p>举个例子来理解一下词向量的更新逻辑：<br />\n假设训练语料中出现了许多关于水果的句子，比如：</p>\n<pre><code>I like to eat apple.\nShe bought a banana yesterday.\nOrange juice is tasty.\n</code></pre>\n<p>现在，模型的任务是<strong>根据上下文预测下一个词</strong>。当看到句子 <code>\"I like to eat apple\"</code> 时，模型会预测下一个词可能是 <code>\"apple\"</code>。<br />\n这时，反向传播时，模型会调整 <strong>“apple”对应的词向量</strong>以及上下文中其他词的向量，使得网络更容易正确预测 <code>\"apple\"</code>。</p>\n<p>同理，当训练样本中出现 <code>\"banana\"</code> 或 <code>\"orange\"</code> 时，这些词的向量也会因为相似的上下文而被调整到<strong>相互靠近的位置</strong>：<code>\"apple\"</code>, <code>\"banana\"</code>, <code>\"orange\"</code> <strong>这些同类型的词常出现在类似的上下文</strong>（如 eat、juice、like 等）<br />\n最终模型通过梯度更新，让这些词向量在向量空间中<strong>彼此靠近</strong>，从而自然捕捉到语义相似性。</p>\n<p>这样的效果就是：即使模型从未显式告知“它们都是水果”，词向量也会因为上下文模式相似而自动聚集在一起，形成<strong>语义簇（semantic cluster）</strong>，即向量空间中，语义相近的词自然聚在一起形成的群体。<br />\n这时，面对下面这两句话：</p>\n<pre><code>训练：I like orange juice.\n测试：I love apple _____. \n</code></pre>\n<p>模型即使<strong>没见过测试语句，也可以通过<code>\"love 和 like\"</code>、<code>\"apple 和 orange\"</code> 在向量空间的距离相近得到更可靠的答案，从而提高模型性能。</strong></p>\n<p>用一句话总结一下：<strong>同类型的词汇往往出现在相似的上下文中，因此在更新后更加相似，最终在向量空间中形成语义簇，极大增强了模型的泛化能力。</strong></p>\n<p>你会发现，<strong>在词嵌入模型中，词向量的语义结构并不是显式教给模型的，而是在上下文预测任务中自然而然学到的，模型并没有专门去“训练合适编码”，而是在预测中让相似的词不断靠近。</strong><br />\n同样是对数据进行编码，词嵌入和我们之前介绍的<a href=\"https://www.cnblogs.com/Goblinscholar/p/19418306\" target=\"_blank\">人脸识别</a>又有所不同。</p>\n<p>当然，既然是早期模型，自然有值得优化的地方，我们继续：</p>\n<h2 id=\"23-早期词嵌入模型的局限\">2.3 早期词嵌入模型的局限</h2>\n<p>尽管 A Neural Probabilistic Language Model 成功提出了通过神经网络学习词向量的思路，但作为早期模型，它在实际应用和理论上存在一些明显的局限性：</p>\n<table>\n<thead>\n<tr>\n<th>局限类别</th>\n<th>具体说明</th>\n<th>影响</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>计算开销大</strong></td>\n<td>输入是 <span class=\"math inline\">\\(t\\)</span> 个词独热向量拼接，输出是词表大小 <span class=\"math inline\">\\(V\\)</span> 的 softmax</td>\n<td>词表大时计算量高，训练预测速度慢</td>\n</tr>\n<tr>\n<td><strong>上下文窗口固定</strong></td>\n<td>每次预测只使用前 <span class=\"math inline\">\\(t\\)</span> 个词</td>\n<td>无法捕捉长距离依赖，语义建模受限</td>\n</tr>\n<tr>\n<td><strong>梯度更新效率低</strong></td>\n<td>嵌入矩阵和网络参数同时更新，每个样本只涉及部分词向量</td>\n<td>收敛慢，低频词向量质量不稳定</td>\n</tr>\n<tr>\n<td><strong>没有显式建模语义规律</strong></td>\n<td>语义相似性完全依赖上下文共现</td>\n<td>稀有词或低频词向量质量差，泛化能力有限，无法处理多义词</td>\n</tr>\n</tbody>\n</table>\n<p>因此，为了解决这些问题，自然有人发明新的技术和模型，我们在之后几篇就来详细介绍这些内容。</p>\n<h1 id=\"3-总结\">3. 总结</h1>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>原理</th>\n<th>比喻</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>词嵌入矩阵（Embedding Matrix）</strong></td>\n<td>将词表中每个词映射为可学习的稠密向量，矩阵行（或列）对应词向量。初始化随机或正态分布，通过梯度更新学习语义信息。</td>\n<td>类似图像风格转换中的“随机噪声图像”，逐步在训练中形成结构化图像。</td>\n</tr>\n<tr>\n<td><strong>嵌入层（Embedding Layer）</strong></td>\n<td>存储词嵌入矩阵并提供索引查找功能，将词索引映射为词向量。</td>\n<td>就像一本“词向量字典”，根据索引直接查到对应的向量。</td>\n</tr>\n<tr>\n<td><strong>上下文预测训练</strong></td>\n<td>利用前 <span class=\"math inline\">\\(t\\)</span> 个词预测下一个词，通过反向传播更新嵌入矩阵和网络参数，使语义相似的词向量靠近。</td>\n<td>好比让水果类词（apple, banana, orange）在向量空间里自然聚成一簇，通过相似上下文学习它们的关系。</td>\n</tr>\n<tr>\n<td><strong>语义簇（Semantic Cluster）</strong></td>\n<td>在向量空间中，语义相近的词自然聚集，捕捉词汇之间的语义关系。</td>\n<td>词向量像朋友一样，常在同一圈子（上下文）出现就靠近在一起。</td>\n</tr>\n<tr>\n<td><strong>早期词嵌入模型局限</strong></td>\n<td>计算开销大（softmax over 大词表）上下文窗口固定、 梯度更新效率低 、无显式语义建模（如多义词）。</td>\n<td>模型像老式拼字游戏，效率低且只能看到局部信息，难以捕捉远距离或复杂规律。</td>\n</tr>\n</tbody>\n</table>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-19 20:35</span>&nbsp;\n<a href=\"https://www.cnblogs.com/Goblinscholar\">哥布林学者</a>&nbsp;\n阅读(<span id=\"post_view_count\">16</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "使用 AI 编程工具的一点实践体会：为什么要减少对话轮次、一次把需求说清楚",
      "link": "https://www.cnblogs.com/YpEng-Codeme/p/19503631",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/YpEng-Codeme/p/19503631\" id=\"cb_post_title_url\" title=\"发布于 2026-01-19 20:25\">\n    <span>使用 AI 编程工具的一点实践体会：为什么要减少对话轮次、一次把需求说清楚</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        在使用 Cursor、ChatGPT 等 AI 编程工具的过程中，我逐渐意识到：\n相比多轮对话不断修补需求，用更少的对话轮次一次性描述清楚核心需求，\n反而更容易得到符合预期的实现。\n本文结合实际使用经验，分析了对话轮次过多导致结果偏离的原因，\n以及在什么情况下应当重新编辑问题而不是继续对话修补。\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"使用-ai-编程工具的一点实践体会为什么要减少对话轮次一次把需求说清楚\">使用 AI 编程工具的一点实践体会：为什么要减少对话轮次、一次把需求说清楚</h1>\n<h2 id=\"一背景\">一、背景</h2>\n<p>随着 Cursor、Copilot、ChatGPT 等 AI 编程工具在日常开发中的普及，<br />\n越来越多的开发者开始尝试用 AI 来完成：</p>\n<ul>\n<li>单个功能模块</li>\n<li>小型系统原型</li>\n<li>重复性或模板化代码</li>\n</ul>\n<p>我自己在实际使用这些工具的过程中，也逐渐形成了一些使用习惯。<br />\n其中<strong>最重要的一点体会是：</strong></p>\n<blockquote>\n<p><strong>在让 AI 写代码时，应尽量减少对话轮次，用尽可能清晰、完整的描述一次性说明核心需求。</strong></p>\n</blockquote>\n<p>这篇文章主要记录我在实践中总结出的原因、经验以及适用边界。</p>\n<hr />\n<h2 id=\"二常见的错误使用方式\">二、常见的错误使用方式</h2>\n<p>在刚开始使用 AI 编程工具时，我（以及身边不少同事）都会下意识采用类似下面的方式：</p>\n<ol>\n<li>先描述一个比较模糊的需求</li>\n<li>看 AI 生成的代码</li>\n<li>发现不符合预期</li>\n<li>继续在当前对话中补充或修改需求</li>\n<li>重复上述过程</li>\n</ol>\n<p>这种方式在<strong>简单问题</strong>上通常没什么问题，<br />\n但在以下场景中，很容易出现偏差：</p>\n<ul>\n<li>模块之间存在关联</li>\n<li>功能有前后依赖关系</li>\n<li>有较多隐含约束（性能、扩展性、结构等）</li>\n</ul>\n<p>最终结果往往是：</p>\n<blockquote>\n<p><strong>代码越来越“补丁化”，整体实现逐渐偏离最初的目标。</strong></p>\n</blockquote>\n<hr />\n<h2 id=\"三为什么对话轮次越多结果越容易偏离\">三、为什么对话轮次越多，结果越容易偏离？</h2>\n<h3 id=\"31-模型理解是上下文驱动的\">3.1 模型理解是“上下文驱动”的</h3>\n<p>AI 模型并不是像人一样“始终记得最初的目标”，而是：</p>\n<ul>\n<li>基于当前上下文进行概率推断</li>\n<li>更倾向于满足<strong>最近一轮对话中的显式要求</strong></li>\n</ul>\n<p>当我们不断追加新指令时：</p>\n<ul>\n<li>新需求可能与旧需求存在隐性冲突</li>\n<li>模型会尝试“局部修补”，而不是整体重构</li>\n</ul>\n<p>久而久之，最初的设计目标就会被逐渐稀释。</p>\n<hr />\n<h3 id=\"32-人在补充需求时往往是局部视角\">3.2 人在补充需求时，往往是“局部视角”</h3>\n<p>在多轮对话中，人通常是在<strong>针对当前不满意的点进行修正</strong>，例如：</p>\n<ul>\n<li>“这里能不能换成异步？”</li>\n<li>“这个字段我不想要了”</li>\n<li>“这个函数再加一个参数”</li>\n</ul>\n<p>但问题在于：</p>\n<ul>\n<li>这些修改<strong>可能影响其它模块</strong></li>\n<li>AI 并不知道你是否接受连带变化</li>\n<li>你自己也未必在当下考虑到了所有影响</li>\n</ul>\n<p>最终就会出现：</p>\n<ul>\n<li>功能能跑</li>\n<li>结构却越来越奇怪</li>\n</ul>\n<hr />\n<h3 id=\"33-模型限制--问题拆解方式的叠加效应\">3.3 模型限制 + 问题拆解方式的叠加效应</h3>\n<p>偏离预期，往往不是单一原因造成的，而是：</p>\n<ul>\n<li>模型在长对话中的抽象能力下降</li>\n<li>人在提问时逐渐变成“修 bug 式提问”</li>\n<li>缺乏一次“全局视角”的重新校准</li>\n</ul>\n<p>这三点叠加在一起，就很容易让结果走偏。</p>\n<hr />\n<h2 id=\"四更推荐的使用方式少轮次--高质量输入\">四、更推荐的使用方式：少轮次 + 高质量输入</h2>\n<h3 id=\"41-一次性描述清楚核心需求\">4.1 一次性描述清楚“核心需求”</h3>\n<p>这里说的“一次性”，并不是要求把所有细节都写死，而是至少要说明清楚：</p>\n<ul>\n<li>这个模块/系统<strong>要解决什么问题</strong></li>\n<li>有哪些核心功能</li>\n<li>功能之间是否有关联</li>\n<li>哪些点是<strong>不能随意改动的约束</strong></li>\n</ul>\n<p>示例思路：</p>\n<pre><code class=\"language-text\">我要实现一个 XXX 系统，主要包含 A / B / C 三个功能。\n其中：\n- A 和 B 之间存在依赖关系\n- C 的实现不能影响 A 的调用方式\n- 性能优先级高于代码简洁性\n</code></pre>\n<hr />\n<h3 id=\"42-接受非核心问题的逐步优化\">4.2 接受“非核心问题”的逐步优化</h3>\n<p>在一次高质量描述后，AI 生成的结果通常会：</p>\n<ul>\n<li>核心结构基本正确</li>\n<li>功能逻辑大体符合预期</li>\n<li>细节上存在一些小问题</li>\n</ul>\n<p>这些小问题通常包括：</p>\n<ul>\n<li>命名不够优雅</li>\n<li>局部代码不够简洁</li>\n<li>样式或美观问题</li>\n</ul>\n<p>👉 <strong>这些问题是适合通过“少量追加对话”来优化的。</strong></p>\n<hr />\n<h2 id=\"五什么时候应该停止对话重新编辑问题\">五、什么时候应该“停止对话，重新编辑问题”？</h2>\n<p>这是一个非常关键的判断点。</p>\n<h3 id=\"51-明确应该重来的一些信号\">5.1 明确应该重来的一些信号</h3>\n<p>如果出现以下情况之一，<strong>强烈建议重新编辑需求，而不是继续对话修补</strong>：</p>\n<ul>\n<li>新需求会影响多个已有功能</li>\n<li>修改一个功能，会连带影响其它模块</li>\n<li>你发现自己在“打补丁”而不是在设计</li>\n<li>你已经很难用一句话说明当前代码结构</li>\n</ul>\n<p>此时继续对话，大概率只会让问题更复杂。</p>\n<hr />\n<h3 id=\"52-正确的做法\">5.2 正确的做法</h3>\n<p>更好的方式是：</p>\n<ol>\n<li>停止当前对话</li>\n<li>回顾当前代码和真实需求</li>\n<li>在<strong>新的对话中重新整理描述</strong></li>\n<li>把之前暴露出的缺陷明确写进去</li>\n</ol>\n<p>例如：</p>\n<pre><code class=\"language-text\">在之前的实现中，我发现 A 和 B 的设计存在耦合问题。\n这次希望：\n- 明确拆分 A / B 的职责\n- 保证后续扩展 C 功能时不需要修改 A\n</code></pre>\n<hr />\n<h2 id=\"六关于一次性描述和灵活调整的平衡\">六、关于“一次性描述”和“灵活调整”的平衡</h2>\n<p>需要强调的是：</p>\n<blockquote>\n<p><strong>减少对话轮次 ≠ 一次性把一切写到极致完美</strong></p>\n</blockquote>\n<p>更合理的平衡是：</p>\n<ul>\n<li>核心设计、关键约束：一次说明清楚</li>\n<li>非核心细节、体验优化：允许少量调整</li>\n<li>结构性缺陷、系统性问题：直接重来</li>\n</ul>\n<p>把 AI 当成一个：</p>\n<blockquote>\n<p><strong>执行能力很强，但不具备全局自省能力的助手</strong></p>\n</blockquote>\n<p>而不是一个会自动“帮你纠偏”的高级工程师。</p>\n<hr />\n<h2 id=\"七总结\">七、总结</h2>\n<p>结合自己的实际使用经验，我目前形成的结论是：</p>\n<ol>\n<li>AI 编程工具非常依赖输入质量</li>\n<li>对话轮次越多，越容易偏离最初目标</li>\n<li>核心问题应一次性描述清楚</li>\n<li>结构性问题不要通过“补丁式对话”修复</li>\n<li>重新编辑问题，往往比继续对话更高效</li>\n</ol>\n<p>后续我也会结合具体案例（包括错误示范和正确示范）进一步补充说明。</p>\n<hr />\n<blockquote>\n<p><strong>这篇文章并不是否定多轮对话的价值，而是希望在合适的场景下，用更合理的方式使用 AI。</strong></p>\n</blockquote>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-19 20:25</span>&nbsp;\n<a href=\"https://www.cnblogs.com/YpEng-Codeme\">YounGp_oo</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "WebDataset使用指南：构建高效深度学习数据管道",
      "link": "https://www.cnblogs.com/aurora-zzm/p/19503592/webdataset_usage",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/aurora-zzm/p/19503592/webdataset_usage\" id=\"cb_post_title_url\" title=\"发布于 2026-01-19 20:04\">\n    <span>WebDataset使用指南：构建高效深度学习数据管道</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<blockquote>\n<p>在深度学习项目实践中，数据加载往往成为限制训练速度的关键瓶颈。当数据集规模达到数百万甚至数十亿样本时，传统的文件系统随机访问方式会导致I/O效率急剧下降，让昂贵的GPU资源处于闲置等待状态。WebDataset通过<strong>流式处理</strong>和<strong>顺序读取</strong>的设计理念，可以极大提升数据加载性能。</p>\n</blockquote>\n<h2 id=\"什么是webdataset\">什么是WebDataset？</h2>\n<p>WebDataset是一个基于TAR归档格式的深度学习数据加载库，专为处理超大规模数据集而设计。其核心思想是将<strong>大量小文件打包成较大的TAR文件</strong>，通过顺序读取替代随机访问，极大提升I/O效率。</p>\n<p>本质上，<em><strong>wds格式文件就是遵循了额外约定的tar文件，并且一般不压缩，使得可以实现流式读取。</strong></em></p>\n<h3 id=\"与传统方式的对比\">与传统方式的对比</h3>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>传统文件系统</th>\n<th>WebDataset</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>访问模式</strong></td>\n<td>随机访问，高延迟</td>\n<td>顺序读取，高吞吐</td>\n</tr>\n<tr>\n<td><strong>存储效率</strong></td>\n<td>文件系统元数据开销大</td>\n<td>TAR容器减少元数据</td>\n</tr>\n<tr>\n<td><strong>分布式支持</strong></td>\n<td>需要复杂协调机制</td>\n<td>天然支持分片和数据并行</td>\n</tr>\n<tr>\n<td><strong>网络传输</strong></td>\n<td>小文件传输效率低</td>\n<td>大文件流式传输</td>\n</tr>\n<tr>\n<td><strong>使用便捷性</strong></td>\n<td>需要解压和预处理</td>\n<td>直接读取，无需解压</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"webdataset的核心原理\">WebDataset的核心原理</h2>\n<h3 id=\"顺序读取的优势\">顺序读取的优势</h3>\n<p>传统深度学习数据集由数百万个小文件组成，训练时需要随机访问这些文件。机械硬盘的随机读取速度通常只有顺序读取的1/100，即使固态硬盘也存在明显差距。WebDataset通过将相关文件打包成TAR归档，将随机I/O转换为顺序I/O，充分利用现代存储系统的吞吐能力。</p>\n<h3 id=\"分片机制\">分片机制</h3>\n<p>WebDataset将大数据集分割为多个TAR文件（分片），每个分片包含数千个样本。这种设计带来多重好处：</p>\n<ul>\n<li><strong>并行加载</strong>：不同分片可由不同工作进程并行读取</li>\n<li><strong>分布式训练</strong>：每个训练节点可处理不同的分片子集</li>\n<li><strong>容错性</strong>：单个分片损坏不影响整个数据集</li>\n</ul>\n<h3 id=\"样本组织规范\">样本组织规范</h3>\n<p>WebDataset遵循严格的命名约定：<em><strong>同一样本的所有文件共享相同的前缀key，通过扩展名区分数据类型。</strong></em></p>\n<blockquote>\n<p>前缀key：tar文件内部，某个文件的路径的第一个句点之前的部分</p>\n</blockquote>\n<p>文件可以有多个后缀，甚至没有后缀（这样在字典中的键就是空字符）；而且相同前缀key的（同一样本中的）文件数量可以不固定。<br />\n示例TAR文件内容结构：</p>\n<pre><code>images17/image194.left.jpg  \nimages17/image194.right.jpg  \nimages17/image194.json  \nimages17/image12.left.jpg  \nimages17/image12.json  \nimages3/image14  \n</code></pre>\n<p>读取之后，会得到像这样的字典</p>\n<pre><code class=\"language-python\">[\n{ “__key__”: “images17/image194”, “left.jpg”: b”...”, “right.jpg”: b”...”, “json”: b”...”}  \n{ “__key__”: “images17/image12”, “left.jpg”: b”...”, “json”: b”...”}  \n{ “__key__”: “images3/image14”, “”: b””}  \n]\n</code></pre>\n<h2 id=\"创建webdataset格式数据集\">创建WebDataset格式数据集</h2>\n<h3 id=\"使用tarwriter-api\">使用TarWriter API</h3>\n<pre><code class=\"language-python\">import webdataset as wds\nimport json\n\ndef create_webdataset(output_path, samples):\n    \"\"\"创建WebDataset格式数据集\"\"\"\n    with wds.TarWriter(output_path) as sink:\n        for i, (image_data, label, metadata) in enumerate(samples):\n            sink.write({\n                \"__key__\": f\"sample{i:06d}\",      # 样本唯一标识\n                \"jpg\": image_data,               # 图像数据（字节格式）\n                \"cls\": str(label).encode(),      # 类别标签\n                \"json\": json.dumps(metadata).encode()  # 元数据\n            })\n</code></pre>\n<h2 id=\"读取和处理webdataset数据集\">读取和处理WebDataset数据集</h2>\n<h3 id=\"基础数据管道\">基础数据管道</h3>\n<pre><code class=\"language-python\">import webdataset as wds\nimport torch\nfrom torchvision import transforms\n\n# 定义数据预处理\npreprocess = transforms.Compose([\n    transforms.RandomResizedCrop(224),\n    transforms.RandomHorizontalFlip(),\n    transforms.ToTensor(),\n    transforms.Normalize(mean=[0.485, 0.456, 0.406], \n                         std=[0.229, 0.224, 0.225])\n])\n\n# 创建WebDataset数据管道\ndataset = (wds.WebDataset(\"dataset-{000000..000099}.tar\")  # 100个分片\n    .shuffle(1000)                    # 样本级打乱\n    .decode(\"pil\")                    # 解码为PIL图像\n    .to_tuple(\"jpg\", \"cls\")           # 提取图像和标签\n    .map_tuple(preprocess, lambda x: int(x))  # 应用预处理\n    .batched(32)                      # 批处理\n\t)\n\n# 创建DataLoader\ndataloader = torch.utils.data.DataLoader(\n    dataset, \n    batch_size=None,  # 批处理已在管道中完成\n    num_workers=4\n)\n</code></pre>\n<h3 id=\"高级数据处理技巧\">高级数据处理技巧</h3>\n<p>WebDataset支持复杂的数据处理管道，包括多模态数据融合和动态增强：</p>\n<pre><code class=\"language-python\">def create_advanced_pipeline():\n    \"\"\"创建高级数据处理管道\"\"\"\n    \n    # 图像增强\n    image_augmentation = transforms.Compose([\n        transforms.RandomChoice([\n            transforms.ColorJitter(brightness=0.2, contrast=0.2),\n            transforms.GaussianBlur(3),\n            transforms.RandomAffine(degrees=15, scale=(0.9, 1.1))\n        ]),\n        transforms.RandomHorizontalFlip(),\n    ])\n    \n    # 文本预处理\n    def text_preprocessing(text_bytes):\n        text = text_bytes.decode(\"utf-8\").lower().strip()\n        # 应用文本清洗和分词逻辑\n        return text\n    \n    dataset = (wds.WebDataset(\"multimodal-{000000..000050}.tar\")\n        .shuffle(5000)  # 大缓冲区提高随机性\n        .decode(\"pil\", handler=wds.warn_and_continue)  # 错误处理\n        .rename(image=\"jpg;png;jpeg\", text=\"txt;json\", caption=\"caption;text\")\n        .map_dict(  # 对不同字段应用不同处理\n            image=image_augmentation,\n            text=text_preprocessing,\n            caption=text_preprocessing\n        )\n        .to_tuple(\"image\", \"text\", \"caption\")  # 多模态输出\n        .batched(16, partial=False)  # 精确批大小控制\n    )\n    \n    return dataset\n</code></pre>\n<h2 id=\"分布式训练集成\">分布式训练集成</h2>\n<h3 id=\"单机多gpu训练\">单机多GPU训练</h3>\n<pre><code class=\"language-python\">import webdataset as wds\nimport torch.distributed as dist\n\ndef setup_distributed_training():\n    \"\"\"设置分布式训练环境\"\"\"\n    \n    # 初始化进程组\n    dist.init_process_group(backend=\"nccl\")\n    local_rank = int(os.environ[\"LOCAL_RANK\"])\n    world_size = dist.get_world_size()\n    \n    # 根据rank配置设备\n    torch.cuda.set_device(local_rank)\n    \n    return local_rank, world_size\n\ndef create_distributed_loader(url_pattern, batch_size=32):\n    \"\"\"创建分布式数据加载器\"\"\"\n    \n    local_rank, world_size = setup_distributed_training()\n    \n    dataset = (wds.WebDataset(\n            url_pattern, \n            resampled=True,  # 启用重采样以支持无限数据流\n            nodesplitter=wds.split_by_node,\n            splitter=wds.split_by_worker\n        )\n        .shuffle(1000)\n        .decode(\"pil\")\n        .to_tuple(\"jpg\", \"cls\")\n        .batched(batch_size)\n    )\n    \n    loader = wds.WebLoader(\n        dataset,\n        batch_size=None,\n        num_workers=4,\n        shuffle=False  # 打乱已在数据管道中处理\n    )\n    \n    # 设置epoch长度\n    loader = loader.with_epoch(10000)  # 每个epoch处理10000个批次\n    \n    return loader\n</code></pre>\n<h3 id=\"多节点训练配置\">多节点训练配置</h3>\n<p>对于跨多个服务器的训练任务，WebDataset提供完整的多节点支持：</p>\n<pre><code class=\"language-python\">def multi_node_training_setup():\n    \"\"\"多节点训练配置\"\"\"\n    \n    dataset = (wds.WebDataset(\"dataset-{000000..012345}.tar\")\n        .shuffle(10000)\n        .decode(\"torchrgb\")  # 直接解码为PyTorch张量\n        .split_by_node  # 自动按节点分割数据\n        .split_by_worker  # 按工作进程分割\n        .to_tuple(\"image\", \"label\")\n        .batched(64)\n    )\n    \n    # 使用WebLoader优化性能\n    loader = wds.WebLoader(\n        dataset,\n        batch_size=None,\n        num_workers=8,\n        persistent_workers=True  # 保持工作进程活跃\n    )\n    \n    return loader\n</code></pre>\n<h2 id=\"性能优化最佳实践\">性能优化最佳实践</h2>\n<h3 id=\"分片策略优化\">分片策略优化</h3>\n<p>分片大小对性能有显著影响，建议根据存储类型选择：</p>\n<ul>\n<li><strong>本地硬盘</strong>：256MB-1GB/分片</li>\n<li><strong>网络存储</strong>：1-4GB/分片</li>\n<li><strong>云对象存储</strong>：4-16GB/分片</li>\n</ul>\n<pre><code class=\"language-python\">def optimize_shard_size(base_url, target_size_mb=1024):\n    \"\"\"根据目标大小优化分片策略\"\"\"\n    # 计算样本平均大小\n    sample_size = estimate_average_sample_size()\n    samples_per_shard = (target_size_mb * 1024 * 1024) // sample_size\n    \n    return f\"{base_url}-{{000000..999999}}.tar\", samples_per_shard\n</code></pre>\n<h3 id=\"缓存策略\">缓存策略</h3>\n<p>对于远程数据集，使用缓存可以显著减少网络传输：</p>\n<pre><code class=\"language-python\">dataset = (wds.WebDataset(\"https://example.com/dataset-{000000..000999}.tar\")\n    .cache_dir(\"./cache\")  # 本地缓存目录\n    .cache_size(10 * 1024 ** 3)  # 10GB缓存大小\n    .shuffle(10000)\n    .decode(\"pil\")\n)\n</code></pre>\n<h3 id=\"内存优化技巧\">内存优化技巧</h3>\n<p>处理超大图像或视频时，使用流式解码避免内存溢出：</p>\n<pre><code class=\"language-python\">def streamed_video_processing():\n    \"\"\"流式视频处理避免内存溢出\"\"\"\n    \n    dataset = (wds.WebDataset(\"video-dataset.tar\")\n        .shuffle(100)\n        .decode(\"rgb8\", handler=wds.ignore_and_continue)  # 流式解码\n        .map(video_frame_sampling)  # 帧采样\n        .slice(0, 100)  # 限制序列长度\n        .batched(1)  # 视频批处理大小为1\n    )\n    \n    return dataset\n</code></pre>\n<h2 id=\"故障排除与调试\">故障排除与调试</h2>\n<h3 id=\"常见问题解决\">常见问题解决</h3>\n<ol>\n<li><strong>内存不足</strong>：减少批大小或使用流式解码</li>\n<li><strong>数据加载慢</strong>：增加分片大小或调整工作进程数</li>\n<li><strong>样本不匹配</strong>：检查TAR文件中同一样本的文件命名一致性</li>\n</ol>\n<h3 id=\"调试技巧\">调试技巧</h3>\n<pre><code class=\"language-python\"># 启用详细日志\nimport os\nos.environ[\"WDS_VERBOSE_CACHE\"] = \"1\"\nos.environ[\"GOPEN_VERBOSE\"] = \"1\"\n\n# 检查数据样本\ndataset = wds.WebDataset(\"dataset.tar\")\nfor sample in dataset.take(5):  # 只取前5个样本\n    print(\"Sample keys:\", list(sample.keys()))\n    for key, value in sample.items():\n        print(f\"{key}: {type(value)}, size: {len(value) if hasattr(value, '__len__') else 'N/A'}\")\n</code></pre>\n<h2 id=\"随机读取\">随机读取</h2>\n<p>虽然wds格式是为了流式读取而设计的，随机读取有些违背其使用理念，但是只能流式读取也有些不方便。比如当想随机查找第n个样本（比如bad case）时，随机读取还是更加方便快捷。<br />\n在安装官方的webdataset python库时，还会同步安装 wids 这个库，会可以帮助wds格式数据集实现随机读取。<a href=\"https://www.bing.com/ck/a?!&amp;&amp;p=8c306290ed0a41aeda3ad41f03f82846e4e663c8ea4b25152258d8546b6dc558JmltdHM9MTc2ODc4MDgwMA&amp;ptn=3&amp;ver=2&amp;hsh=4&amp;fclid=18e4bf87-a076-62ee-3329-aa52a19c6398&amp;u=a1aHR0cHM6Ly9weXBpLm9yZy9wcm9qZWN0L3dpZHMv&amp;ntb=1\" rel=\"noopener nofollow\" target=\"_blank\">wids · PyPI</a> 中给出了一个DEMO.</p>\n<p>但是如果可以获取样本所在tar文件路径和key，直接基于webdataset的接口读取也不会很慢，不应该使用wids；另外，我发现wids的相关资料很少，，很久都不更新了，官方好像也不在意这个功能，我自己尝试了一下感觉意义不大。</p>\n<h2 id=\"结论\">结论</h2>\n<p>WebDataset通过创新的流式数据加载范式，彻底解决了大规模深度学习训练中的数据I/O瓶颈。其核心优势在于：</p>\n<ol>\n<li><strong>卓越性能</strong>：顺序读取相比随机访问带来3-10倍的性能提升</li>\n<li><strong>分布式友好</strong>：天然支持多节点、多GPU训练场景</li>\n<li><strong>灵活性</strong>：支持任意数据类型和复杂的多模态场景</li>\n<li><strong>易用性</strong>：与PyTorch生态无缝集成，API设计简洁直观</li>\n</ol>\n<p>随着深度学习数据集规模的不断增长，WebDataset已成为处理TB级甚至PB级数据的标准工具。掌握WebDataset的使用技巧，对于构建高效、可扩展的深度学习系统至关重要。</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-19 20:04</span>&nbsp;\n<a href=\"https://www.cnblogs.com/aurora-zzm\">一苇江湖</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "AI新手入门：10分钟用Spring AI打造你的第一个智能心理咨询师",
      "link": "https://www.cnblogs.com/freshman118/p/19503473",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/freshman118/p/19503473\" id=\"cb_post_title_url\" title=\"发布于 2026-01-19 18:57\">\n    <span>AI新手入门：10分钟用Spring AI打造你的第一个智能心理咨询师</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>大家好！我是你们的 AI 技术向导。今天带来一篇超级实用的 Spring AI 上手教程，专为零基础的 AI 爱好者设计。无需高深技术背景，只需 10 分钟，你就能创建一个能对话的智能体！</p>\n<h2 id=\"什么是-spring-ai\">什么是 Spring AI？</h2>\n<p>Spring AI 是 Spring 生态中用于简化 AI 应用开发的框架，让开发者能轻松集成大语言模型。今天的 Demo 将基于阿里云的 DashScope 平台，创建一个专业的心理咨询师智能体。</p>\n<h2 id=\"环境准备\">环境准备</h2>\n<p>首先，我们需要创建一个 Spring 项目。推荐使用 IDEA 开发工具：</p>\n<ol>\n<li>打开 IDEA，选择新建 Spring 项目</li>\n</ol>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<ol>\n<li>设置 Spring Boot 版本以及依赖</li>\n</ol>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<ol>\n<li>项目创建成功后，进入下一步</li>\n</ol>\n<h2 id=\"添加关键依赖\">添加关键依赖</h2>\n<p>在项目的 pom.xml 文件中，添加以下两个核心依赖：</p>\n<pre><code class=\"language-xml\">&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba.cloud.ai&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-ai-alibaba-agent-framework&lt;/artifactId&gt;\n    &lt;version&gt;1.1.0.0-M5&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba.cloud.ai&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-ai-alibaba-starter-dashscope&lt;/artifactId&gt;\n    &lt;version&gt;1.1.0.0-M5&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>这两个依赖分别提供了智能体框架和 DashScope 模型的支持。</p>\n<h2 id=\"编写核心代码\">编写核心代码</h2>\n<p>在 com.jackson.aiagent 包下创建 AgentExample.java 文件：</p>\n<pre><code class=\"language-java\">package com.jackson.aiagent;\n\n// 导入必要的类\npublic class AgentExample {\n    public static void main(String[] args) throws Exception {\n        // 1. 创建模型实例（记得替换成你自己的API Key）\n        DashScopeApi dashScopeApi = DashScopeApi.builder()\n                .apiKey(\"sk-309xxxxxxxxxxxxxxxxxxxxxxxx\")\n                .build();\n        ChatModel chatModel = DashScopeChatModel.builder()\n                .dashScopeApi(dashScopeApi)\n                .build();\n\n        // 2. 创建智能体角色\n        ReactAgent agent = ReactAgent.builder()\n                .name(\"智能心理咨询师\")\n                .model(chatModel)\n                .instruction(\"你是一名10年经验的资深心理咨询师.\")\n                .build();\n\n        // 3. 与智能体对话\n        var response = agent.call(\"抑郁症有些什么症状？该如何缓解？\");\n        System.out.println(response.getText());\n    }\n}\n</code></pre>\n<h2 id=\"运行你的第一个-ai-智能体\">运行你的第一个 AI 智能体</h2>\n<p>代码编写完成后，直接运行 main 方法。你会看到控制台输出类似以下内容：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"技术要点解析\">技术要点解析</h2>\n<ul>\n<li>​<strong>API Key 配置</strong>​：需要到 DashScope 平台申请自己的 API Key</li>\n<li>​<strong>智能体定制</strong>​：通过 instruction 参数定义智能体的专业背景</li>\n<li>​<strong>对话交互</strong>​：使用 call 方法即可与智能体进行对话</li>\n</ul>\n<h2 id=\"拓展思路\">拓展思路</h2>\n<p>这个 Demo 虽然简单，但已经包含了 AI 智能体的核心要素。你可以尝试：</p>\n<ul>\n<li>更换不同的专业角色（如法律顾问、编程助手等）</li>\n<li>设计更复杂的对话流程</li>\n<li>集成到 Web 应用中提供在线服务</li>\n</ul>\n<h2 id=\"总结\">总结</h2>\n<p>通过这个教程，我们见证了 Spring AI 的强大之处——用极简的代码实现智能对话功能。作为 AI 新手，这是一个完美的起点。未来你可以在此基础上探索更复杂的 AI 应用场景。</p>\n<p><strong>动手试试吧！</strong> 在评论区分享你的第一个智能体作品，遇到问题随时提问哦~</p>\n<hr />\n<p><em>本文基于技术文档整理，适合 AI 入门学习。实际开发中请参考官方最新文档。</em></p>\n<p>_Reference: _https://github.com/alibaba/spring-ai-alibaba</p>\n\n</div>\n<div id=\"MySignature\">\n    <p>本文来自博客园，作者：<a href=\"https://www.cnblogs.com/freshman118/\" target=\"_blank\">90后小陈老师</a>，转载请注明原文链接：<a href=\"https://www.cnblogs.com/freshman118/p/19503473\" target=\"_blank\">https://www.cnblogs.com/freshman118/p/19503473</a></p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-19 18:57</span>&nbsp;\n<a href=\"https://www.cnblogs.com/freshman118\">90后小陈老师</a>&nbsp;\n阅读(<span id=\"post_view_count\">36</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "[python] python-docx-template模板化Word文档生成指北",
      "link": "https://www.cnblogs.com/luohenyueji/p/19503461",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/luohenyueji/p/19503461\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäºŽ 2026-01-19 18:51\">\n    <span>[python] python-docx-templateæ¨¡æ¿åŒ–Wordæ–‡æ¡£ç”ŸæˆæŒ‡åŒ—</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>python-docxåº“çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ç¨‹åºåŒ–åˆ›å»ºå…¨æ–°çš„Wordæ–‡æ¡£ï¼Œä½†åœ¨åŸºäºŽå·²æœ‰æ¨¡æ¿æ›¿æ¢å…¶éƒ¨åˆ†å†…å®¹æ—¶ï¼Œå…¶æ“ä½œä¼šéžå¸¸ç¹çã€‚ç”¨æˆ·éœ€è¦å…ˆè§£æžæ–‡æ¡£ç»“æž„ã€å®šä½å…·ä½“ä½ç½®ã€æ‰‹åŠ¨æ›¿æ¢å†…å®¹ï¼Œå¹¶ç»´æŠ¤åŽŸæœ‰æ ¼å¼ä¸Žå¸ƒå±€ï¼Œå¯¼è‡´å¼€å‘æ•ˆçŽ‡è¾ƒä½Žã€‚ç›¸å…³ä½¿ç”¨æ–¹æ³•å¯å‚è€ƒï¼š<a href=\"https://www.cnblogs.com/luohenyueji/p/19479110\" target=\"_blank\">åŸºäºŽpython-docxåº“çš„Wordæ–‡æ¡£è‡ªåŠ¨å¤„ç†å…¨è§£</a>ã€‚</p>\n<p>python-docx-templateæ­£æ˜¯ä¸ºè§£å†³è¿™ä¸€ç—›ç‚¹è€Œè®¾è®¡çš„ã€‚å®ƒå€Ÿé‰´Jinja2æ¨¡æ¿å¼•æ“Žçš„æ€è·¯ï¼Œå…è®¸åœ¨Wordæ–‡æ¡£ä¸­ç›´æŽ¥æ’å…¥ç±»ä¼¼<code>{{variable}}</code>çš„å ä½ç¬¦ï¼ŒéšåŽä»…ç”¨å‡ è¡Œä»£ç å³å¯å®Œæˆæ•°æ®å¡«å……ï¼Œæ— éœ€å…³å¿ƒåº•å±‚æ–‡æ¡£ç»“æž„ï¼Œå®Œç¾Žé€‚é…åŸºäºŽæ¨¡æ¿ä¿®æ”¹æ–‡æ¡£çš„åœºæ™¯ã€‚</p>\n<p><img alt=\"\" src=\"https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E6%A8%A1%E6%9D%BF%E5%8C%96Word%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90%E6%8C%87%E5%8C%97/imgs/1.jpg\" /></p>\n<p>python-docx-templateåŸºäºŽpython-docxå®žçŽ°æ–‡æ¡£è¯»å†™åŠŸèƒ½ï¼Œå¹¶å€ŸåŠ©jinja2æä¾›çµæ´»çš„æ¨¡æ¿æ ‡ç­¾æ”¯æŒï¼Œå…¶è®¾è®¡æ€è·¯å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>\n<p>ç”¨Wordåˆ¶ä½œæ¨¡æ¿<br />\nåœ¨Microsoft Wordä¸­è‡ªç”±è®¾è®¡æ–‡æ¡£æ ¼å¼ï¼Œå¦‚æ’å…¥å›¾ç‰‡ã€è®¾ç½®é¡µçœ‰é¡µè„šã€è°ƒæ•´è¡¨æ ¼æ ·å¼ï¼Œå……åˆ†åˆ©ç”¨Wordå¼ºå¤§çš„æŽ’ç‰ˆåŠŸèƒ½ã€‚</p>\n</li>\n<li>\n<p>æ’å…¥æ¨¡æ¿å˜é‡<br />\nåœ¨éœ€è¦åŠ¨æ€å†…å®¹çš„ä½ç½®ï¼Œç›´æŽ¥è¾“å…¥Jinja2é£Žæ ¼çš„æ ‡ç­¾ï¼Œä¾‹å¦‚<code>{{company_name}}</code>æˆ–<code>{%for item in list%}</code>ã€‚</p>\n</li>\n<li>\n<p>ä¿å­˜ä¸ºæ¨¡æ¿æ–‡ä»¶<br />\nå°†æ–‡æ¡£ä¿å­˜ä¸ºæ™®é€šçš„.docxæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å³æˆä¸ºå¯å¤ç”¨çš„æ¨¡æ¿ã€‚</p>\n</li>\n<li>\n<p>ç”¨Pythonæ‰¹é‡ç”Ÿæˆ<br />\nåŠ è½½æ¨¡æ¿å¹¶ä¼ å…¥å­—å…¸æˆ–å¯¹è±¡ï¼Œpython-docx-templateä¼šè‡ªåŠ¨æ›¿æ¢æ ‡ç­¾ï¼Œç”Ÿæˆæœ€ç»ˆæ–‡æ¡£ã€‚</p>\n</li>\n</ol>\n<p>python-docx-templateçš„å®˜æ–¹ä»£ç ä»“åº“åœ°å€ä¸ºï¼š<a href=\"https://github.com/elapouya/python-docx-template\" rel=\"noopener nofollow\" target=\"_blank\">python-docx-template</a>ï¼Œè¯¦ç»†æ–‡æ¡£å¯å‚é˜…ï¼š<a href=\"https://docxtpl.readthedocs.io/\" rel=\"noopener nofollow\" target=\"_blank\">python-docx-template doc</a>ã€‚æœ¬æ–‡ä½¿ç”¨çš„python-docx-templateç‰ˆæœ¬ä¸º0.20.2ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p>\n<blockquote>\n<p>pip install docxtpl</p>\n</blockquote>\n<p>å…¶ä¸­ï¼Œdocxtplæ˜¯python-docx-templateåº“çš„æ­£å¼åˆ†å‘åç§°ï¼ŒäºŒè€…æŒ‡ä»£åŒä¸€å·¥å…·ã€‚</p>\n<p></p><div class=\"toc\"><div class=\"toc-container-header\">ç›®å½•</div><ul><li><a href=\"#1-ä½¿ç”¨è¯´æ˜Ž\" rel=\"noopener nofollow\">1 ä½¿ç”¨è¯´æ˜Ž</a><ul><li><a href=\"#11-æ ¸å¿ƒæ¦‚å¿µ\" rel=\"noopener nofollow\">1.1 æ ¸å¿ƒæ¦‚å¿µ</a><ul><li><a href=\"#111-æ ‡ç­¾è¯´æ˜Ž\" rel=\"noopener nofollow\">1.1.1 æ ‡ç­¾è¯´æ˜Ž</a></li><li><a href=\"#112-å¸¸è§å…ƒç´\" rel=\"noopener nofollow\">1.1.2 å¸¸è§å…ƒç´ </a></li></ul></li><li><a href=\"#12-å¤æ‚å…ƒç´\" rel=\"noopener nofollow\">1.2 å¤æ‚å…ƒç´ </a><ul><li><a href=\"#121-å¯Œæ–‡æœ¬\" rel=\"noopener nofollow\">1.2.1 å¯Œæ–‡æœ¬</a></li><li><a href=\"#122-å¯Œæ–‡æœ¬æ®µè½\" rel=\"noopener nofollow\">1.2.2 å¯Œæ–‡æœ¬æ®µè½</a></li><li><a href=\"#123-æµ®åŠ¨å¯¹è±¡\" rel=\"noopener nofollow\">1.2.3 æµ®åŠ¨å¯¹è±¡</a></li><li><a href=\"#124-å­æ–‡æ¡£\" rel=\"noopener nofollow\">1.2.4 å­æ–‡æ¡£</a></li></ul></li><li><a href=\"#13-è¡¥å……æ“ä½œ\" rel=\"noopener nofollow\">1.3 è¡¥å……æ“ä½œ</a><ul><li><a href=\"#131-è½¬ä¹‰æ“ä½œ\" rel=\"noopener nofollow\">1.3.1 è½¬ä¹‰æ“ä½œ</a></li><li><a href=\"#132-èŽ·å–æœªå®šä¹‰å˜é‡\" rel=\"noopener nofollow\">1.3.2 èŽ·å–æœªå®šä¹‰å˜é‡</a></li><li><a href=\"#133-jinjaè‡ªå®šä¹‰è¿‡æ»¤å™¨\" rel=\"noopener nofollow\">1.3.3 Jinjaè‡ªå®šä¹‰è¿‡æ»¤å™¨</a></li><li><a href=\"#134-microsoft-word-2016ç‰¹æ®Šè¡Œä¸ºè¯´æ˜Ž\" rel=\"noopener nofollow\">1.3.4 Microsoft Word 2016ç‰¹æ®Šè¡Œä¸ºè¯´æ˜Ž</a></li></ul></li></ul></li><li><a href=\"#2-å‚è€ƒ\" rel=\"noopener nofollow\">2 å‚è€ƒ</a></li></ul></div><p></p>\n<h1 id=\"1-ä½¿ç”¨è¯´æ˜Ž\">1 ä½¿ç”¨è¯´æ˜Ž</h1>\n<h2 id=\"11-æ ¸å¿ƒæ¦‚å¿µ\">1.1 æ ¸å¿ƒæ¦‚å¿µ</h2>\n<h3 id=\"111-æ ‡ç­¾è¯´æ˜Ž\">1.1.1 æ ‡ç­¾è¯´æ˜Ž</h3>\n<p>python-docx-templateå…è®¸åœ¨Wordæ–‡æ¡£ä¸­ä½¿ç”¨Jinja2æ ‡ç­¾å’Œè¿‡æ»¤å™¨ã€‚ä½†ä¸ºç¡®ä¿å…¶åœ¨Wordä¸­æ­£å¸¸è¿ä½œï¼Œéœ€éµå¾ªè‹¥å¹²é™åˆ¶ã€‚</p>\n<p>å¸¸è§„Jinja2æ ‡ç­¾ä»…èƒ½åœ¨åŒä¸€æ®µè½å†…ä¸”åŒä¸€æ–‡æœ¬è¿è¡Œä¸­ä½¿ç”¨ï¼Œè‹¥éœ€æŽ§åˆ¶æ®µè½ã€è¡¨æ ¼è¡Œæˆ–åŒ…å«æ ·å¼çš„å®Œæ•´æ–‡æœ¬è¿è¡Œï¼Œåˆ™å¿…é¡»ä½¿ç”¨åŽç»­ç« èŠ‚ä»‹ç»çš„å¤æ‚å…ƒç´ æ ‡ç­¾è¯­æ³•ã€‚</p>\n<p>ä¸¾ä¾‹è€Œè¨€ï¼Œè‹¥åˆ›å»ºä¸€ä¸ªæ‰€æœ‰å­—ç¬¦æ ·å¼ç›¸åŒçš„æ®µè½ï¼ŒWordå†…éƒ¨åªä¼šç”Ÿæˆä¸€ä¸ªæ–‡æœ¬è¿è¡Œå¯¹è±¡ã€‚ä½†è‹¥åœ¨è¯¥æ®µè½ä¸­å°†éƒ¨åˆ†æ–‡å­—è®¾ç½®ä¸ºåŠ ç²—ï¼ŒWordä¼šå°†åŽŸæœ‰æ–‡æœ¬è¿è¡Œæ‹†åˆ†ä¸ºä¸‰ä¸ªç‹¬ç«‹éƒ¨åˆ†ï¼Œåˆ†åˆ«å¯¹åº”æ™®é€šæ ·å¼ã€åŠ ç²—æ ·å¼åŠæ¢å¤åŽçš„æ™®é€šæ ·å¼ã€‚</p>\n<p><strong>æ ‡ç­¾</strong></p>\n<p>è‹¥è¦å¯¹æ®µè½ã€è¡¨æ ¼è¡Œã€è¡¨æ ¼åˆ—ä»¥åŠæ–‡æœ¬æ®µè¿›è¡Œç®¡ç†ï¼Œéœ€ä½¿ç”¨ä»¥ä¸‹ä¸“ç”¨è¯­æ³•ï¼š</p>\n<ul>\n<li>æ®µè½æ ‡ç­¾ï¼š<code>{%p jinja2_tag %}</code></li>\n<li>è¡¨æ ¼è¡Œæ ‡ç­¾ï¼š<code>{%tr jinja2_tag %}</code></li>\n<li>è¡¨æ ¼åˆ—æ ‡ç­¾ï¼š<code>{%tc jinja2_tag %}</code></li>\n<li>æ–‡æœ¬æ®µæ ‡ç­¾ï¼š<code>{%r jinja2_tag %}</code></li>\n</ul>\n<p>è¿™äº›ä»¥<code>{% %}</code>åŒ…è£¹çš„å†…å®¹æ˜¯Jinja2æ¨¡æ¿è¯­æ³•æ ‡ç­¾ï¼Œå¼•æ“Žä¼šè¯†åˆ«å¹¶æ‰§è¡Œå…¶ä¸­çš„é€»è¾‘ã€‚ä¸€ä¸ªå®Œæ•´çš„æ¨¡æ¿æ ‡ç­¾åŸºæœ¬ç»“æž„å¦‚ä¸‹ï¼š</p>\n<pre><code>{% æŒ‡ä»¤å…³é”®å­— å‚æ•°/æ¡ä»¶ %}  // èµ·å§‹æ ‡ç­¾\nå†…å®¹                      // è¢«æ ‡ç­¾æŽ§åˆ¶çš„æ–‡æœ¬\n{% ç»“æŸå…³é”®å­— %}          // ç»“æŸæ ‡ç­¾\n</code></pre>\n<p>é€šè¿‡æ­¤ç±»æ ‡ç­¾ï¼Œpython-docx-templateå¯è‡ªåŠ¨å°†æ ‡å‡†Jinja2æ ‡ç­¾ï¼Œå³åŽ»é™¤å‰ç¼€<code>p</code>ã€<code>tr</code>ã€<code>tc</code>ã€<code>r</code>åŽçš„å†…å®¹ï¼Œç²¾ç¡®åµŒå…¥åˆ°æ–‡æ¡£XMLæºç çš„ç›¸åº”ä½ç½®ã€‚</p>\n<p><img alt=\"\" src=\"https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E6%A8%A1%E6%9D%BF%E5%8C%96Word%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90%E6%8C%87%E5%8C%97/imgs/2.jpg\" /></p>\n<p>å‡è®¾æ¨¡æ¿å†…å®¹å¦‚ä¸‹ï¼š</p>\n<pre><code>{%p if display_paragraph %}\nä¸€æ®µæˆ–å¤šæ®µæ–‡æœ¬å†…å®¹\n{%p endif %}\n</code></pre>\n<p>æ— è®ºdisplay_paragraphå˜é‡å–å€¼å¦‚ä½•ï¼Œé¦–å°¾ä¸¤ä¸ªåŒ…å«<code>{%p ... %}</code>æ ‡ç­¾çš„æ®µè½ï¼Œéƒ½ä¸ä¼šå‡ºçŽ°åœ¨æœ€ç»ˆç”Ÿæˆçš„docxæ–‡æ¡£ä¸­ã€‚<br />\nåªæœ‰å½“display_paragraphçš„å€¼ä¸ºTrueæ—¶ï¼Œä»¥ä¸‹å†…å®¹æ‰ä¼šè¢«ä¿ç•™åœ¨ç”Ÿæˆçš„æ–‡æ¡£é‡Œï¼š</p>\n<pre><code>ä¸€æ®µæˆ–å¤šæ®µæ–‡æœ¬å†…å®¹\n</code></pre>\n<p>å¯¹äºŽæ¨¡æ¿é‡Œçš„æ ‡ç­¾æ ¼å¼éœ€éµå¾ªå¦‚ä¸‹è¦æ±‚ï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆæ­£ç¡®ç»“æžœï¼š</p>\n<ul>\n<li>èµ·å§‹æ ‡ç­¾åˆ†éš”ç¬¦åŽå¿…é¡»åŠ ç©ºæ ¼ï¼Œç»“æŸæ ‡ç­¾åˆ†éš”ç¬¦å‰å¿…é¡»åŠ ç©ºæ ¼ï¼š\n<ul>\n<li>é”™è¯¯ç¤ºä¾‹ï¼š<pre><code>{%if something%}\n{%pif display_paragraph%}\n</code></pre>\n</li>\n<li>æ­£ç¡®ç¤ºä¾‹ï¼š<pre><code>{% if something %}\n{%p if display_paragraph %}\n</code></pre>\n</li>\n</ul>\n</li>\n<li>åŒä¸€æ®µè½ã€è¡Œã€åˆ—æˆ–æ–‡æœ¬æ®µå†…ï¼Œç¦æ­¢è¿žç»­ä½¿ç”¨æ ‡ç­¾åˆ†éš”ç¬¦ï¼š\n<ul>\n<li>é”™è¯¯ç¤ºä¾‹ï¼š<pre><code>{%p{%tr{%tc{%r\n</code></pre>\n</li>\n</ul>\n</li>\n<li>æ ‡ç­¾ä¸Žå†…å®¹ä¸å¯å†™åœ¨åŒä¸€è¡Œï¼Œéœ€æ¢è¡ŒæŽ’ç‰ˆï¼š\n<ul>\n<li>é”™è¯¯ç¤ºä¾‹ï¼š<pre><code>{%p if display_paragraph %}Here is my paragraph {%p endif %}\n</code></pre>\n</li>\n<li>æ­£ç¡®ç¤ºä¾‹ï¼š<pre><code>{%p if display_paragraph %}\nHere is my paragraph\n{%p endif %}\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"112-å¸¸è§å…ƒç´ \">1.1.2 å¸¸è§å…ƒç´ </h3>\n<p><strong>æ˜¾ç¤ºå˜é‡</strong></p>\n<p>Jinja2æ¨¡æ¿é‡Œï¼Œå¯ä»¥ç”¨åŒå¤§æ‹¬å·æ¥æ˜¾ç¤ºå˜é‡ï¼š</p>\n<pre><code>{{ &lt;å˜é‡å&gt; }}\n</code></pre>\n<p>å¦‚æžœå˜é‡æ˜¯æ™®é€šå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²é‡Œçš„ç‰¹æ®Šç¬¦å·ä¼šè‡ªåŠ¨è½¬æ¢æˆå¯¹åº”çš„æ ¼å¼ï¼š</p>\n<ul>\n<li><code>\\n</code> â†’ æ¢è¡Œ</li>\n<li><code>\\a</code> â†’ åˆ†æ®µ</li>\n<li><code>\\t</code> â†’ åˆ¶è¡¨ç¬¦ï¼ˆæŒ‰ä¸€ä¸‹ Tab é”®çš„æ•ˆæžœï¼‰</li>\n<li><code>\\f</code> â†’ åˆ†é¡µç¬¦</li>\n</ul>\n<p>å¦‚æžœå˜é‡æ˜¯å¯Œæ–‡æœ¬ï¼ˆRichTextï¼‰å¯¹è±¡ï¼Œå¿…é¡»åœ¨å˜é‡åå‰åŠ ä¸€ä¸ª<code>r</code>ï¼Œæ˜Žç¡®è¡¨ç¤ºè¦æ¸²æŸ“è¿™ä¸ªå¯Œæ–‡æœ¬å†…å®¹ï¼š</p>\n<pre><code>{{r &lt;å˜é‡å&gt; }}\n</code></pre>\n<p>æ³¨æ„ï¼Œ<code>r</code>è¦ç´§è·Ÿåœ¨å·¦å¤§æ‹¬å·çš„åŽé¢ã€‚</p>\n<p>æ­¤å¤–ï¼Œå˜é‡åä¸­ç¦æ­¢ç›´æŽ¥ä½¿ç”¨<code>&lt;</code>,<code>&gt;</code>, <code>&amp;</code>è¿™ç±»å­—ç¬¦ï¼Œé™¤éžç”¨äº†è½¬ä¹‰è¯­æ³•ã€‚</p>\n<p><strong>æ³¨é‡Š</strong></p>\n<p>å¯ä»¥åœ¨æ¨¡æ¿ä¸­æ·»åŠ ç±»Jinja2é£Žæ ¼çš„æ³¨é‡Šï¼Œæ³¨é‡Šä¸ä¼šè¢«æ¸²æŸ“åˆ°æœ€ç»ˆæ–‡ä»¶ï¼š</p>\n<pre><code>{#p è¿™æ˜¯ä¸€ä¸ªæ®µè½ç±»åž‹çš„æ³¨é‡Š #}\n{#tr è¿™æ˜¯ä¸€ä¸ªè¡¨æ ¼è¡Œç±»åž‹çš„æ³¨é‡Š #}\n{#tc è¿™æ˜¯ä¸€ä¸ªè¡¨æ ¼å•å…ƒæ ¼ç±»åž‹çš„æ³¨é‡Š #}\n</code></pre>\n<p>åœ¨æ‰§è¡Œå¦‚ä¸‹ä»£ç å¯¹æ¨¡æ¿æ–‡ä»¶è¿›è¡Œæ¸²æŸ“æ“ä½œæ—¶ï¼Œæ¨¡æ¿ä¸­åŽŸæœ‰çš„æ‰€æœ‰æ³¨é‡Šä¿¡æ¯å‡ä¼šè¢«æ¸…é™¤ï¼Œä¸ä¼šä¿ç•™åœ¨æœ€ç»ˆçš„æ¸²æŸ“ç»“æžœä¸­ï¼š</p>\n<pre><code class=\"language-python\"># https://github.com/elapouya/python-docx-template/blob/master/tests/comments.py\nfrom docxtpl import DocxTemplate\nimport os\n\n# data: https://github.com/elapouya/python-docx-template/blob/master/tests/templates/comments_tpl.docx\ntpl = DocxTemplate(\"templates/comments_tpl.docx\")\n\ntpl.render({})\nos.makedirs(\"output\",exist_ok=True)\ntpl.save(\"output/comments.docx\")\n</code></pre>\n<p><strong>æ–‡æœ¬çš„æ‹†åˆ†ä¸Žåˆå¹¶</strong></p>\n<p>è‹¥åŒ…å«Jinja2æ ‡ç­¾çš„æ–‡æœ¬è¿‡é•¿ï¼Œä¼šå¯¼è‡´å¯è¯»æ€§ä¸‹é™ï¼Œä¾‹å¦‚ï¼š</p>\n<pre><code>æˆ‘çš„æˆ¿å­ä½äºŽ{% if living_in_town %}åŸŽå¸‚åŒºåŸŸ{% else %}ä¹¡æ‘åœ°åŒº{% endif %}ï¼Œæˆ‘éžå¸¸å–œæ¬¢å®ƒã€‚\n</code></pre>\n<p>å€ŸåŠ©<code>{%-</code>è¯­æ³•ï¼Œå¯å°†Jinja2æ ‡ç­¾ä¸Žä¸Šä¸€è¡Œå†…å®¹åˆå¹¶ï¼ŒåŒæ—¶å€ŸåŠ©<code>-%}</code>è¯­æ³•ï¼Œå¯å°†Jinja2æ ‡ç­¾ä¸Žä¸‹ä¸€è¡Œå†…å®¹åˆå¹¶ã€‚æ­¤æ—¶å¯ä½¿ç”¨å›žè½¦é”®ï¼ˆEnterï¼‰æˆ–Shift+Enterå¯¹æ–‡æœ¬è¿›è¡Œæ‹†åˆ†æŽ’ç‰ˆï¼Œå†é€šè¿‡ä¸Šè¿°çš„æ ‡ç­¾è¯­æ³•å°†æ‹†åˆ†åŽçš„å†…å®¹åˆå¹¶ä¸ºä¸€ä¸ªæ•´ä½“ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>\n<pre><code>æˆ‘çš„æˆ¿å­ä½äºŽ\n{%- if living_in_town -%}\nåŸŽå¸‚åŒºåŸŸ\n{%- else -%}\nä¹¡æ‘åœ°åŒº\n{%- endif -%}\nï¼Œæˆ‘éžå¸¸å–œæ¬¢å®ƒã€‚\n</code></pre>\n<p>æ¸²æŸ“ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\">from docxtpl import DocxTemplate\ntpl = DocxTemplate(\"template.docx\")\ncontext = {\"living_in_town\": True}\n\ntpl.render(context)\ntpl.save(\"output/output.docx\")\n</code></pre>\n<p><strong>è¡¨æ ¼</strong></p>\n<p>å¯ä»¥ä½¿ç”¨<code>colspan</code>æ ‡ç­¾å®žçŽ°è¡¨æ ¼å•å…ƒæ ¼çš„æ°´å¹³åˆå¹¶ï¼š</p>\n<pre><code>{% colspan &lt;var&gt; %}\n</code></pre>\n<p><code>&lt;var&gt;</code>å¿…é¡»ä¸ºæ•´æ•°ï¼Œç”¨äºŽæŒ‡å®šéœ€è¦åˆå¹¶çš„åˆ—æ•°ã€‚ä¹Ÿå¯é€šè¿‡Jinja2æ¨¡æ¿å¼•æ“Žè‡ªåŠ¨è®¡ç®—ï¼Œå¦‚å†…ç½®è¿‡æ»¤å™¨counté€šè¿‡ç®¡é“ç¬¦|æŽ¥æ”¶col_labelsï¼Œç”¨äºŽç»Ÿè®¡å…¶å…ƒç´ æ•°é‡ï¼š</p>\n<pre><code>{% colspan col_labels|count %}\n</code></pre>\n<p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨<code>colspan</code>æ ‡ç­¾ã€<code>tr</code>å’Œ<code>tc</code>æ ‡ç­¾åŠ¨æ€å¡«å……ä¸€ä¸ªè¡¨æ ¼ï¼š</p>\n<pre><code class=\"language-python\"># https://github.com/elapouya/python-docx-template/blob/master/tests/dynamic_table.py\nfrom docxtpl import DocxTemplate\nimport os\n# data: https://github.com/elapouya/python-docx-template/blob/master/tests/templates/dynamic_table_tpl.docx\ntpl = DocxTemplate(\"templates/dynamic_table_tpl.docx\")\n\ncontext = {\n    \"col_labels\": [\"fruit\", \"vegetable\", \"stone\", \"thing\"],\n    \"tbl_contents\": [\n        {\"label\": \"yellow\", \"cols\": [\"banana\", \"capsicum\", \"pyrite\", \"taxi\"]},\n        {\"label\": \"red\", \"cols\": [\"apple\", \"tomato\", \"cinnabar\", \"doubledecker\"]},\n        {\"label\": \"green\", \"cols\": [\"guava\", \"cucumber\", \"aventurine\", \"card\"]},\n    ],\n}\n\ntpl.render(context)\nos.makedirs(\"output\",exist_ok=True)\ntpl.save(\"output/dynamic_table.docx\")\n</code></pre>\n<p>ä¹Ÿå¯ä»¥åœ¨forå¾ªçŽ¯ä¸­å®žçŽ°å•å…ƒæ ¼æ°´å¹³åˆå¹¶ï¼š</p>\n<pre><code>{% hm %}\n</code></pre>\n<p>ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨<code>hm</code>æ ‡ç­¾å®žçŽ°å•å…ƒæ ¼æ°´å¹³åˆå¹¶ï¼š</p>\n<pre><code class=\"language-python\"># https://github.com/elapouya/python-docx-template/blob/master/tests/horizontal_merge.py\nfrom docxtpl import DocxTemplate\nimport os\n# data: https://github.com/elapouya/python-docx-template/blob/master/tests/templates/horizontal_merge_tpl.docx\ntpl = DocxTemplate(\"templates/horizontal_merge_tpl.docx\")\ntpl.render({})\nos.makedirs(\"output\",exist_ok=True)\ntpl.save(\"output/horizontal_merge.docx\")\n</code></pre>\n<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥åœ¨forå¾ªçŽ¯ä¸­å®žçŽ°å•å…ƒæ ¼åž‚ç›´åˆå¹¶ï¼š</p>\n<pre><code>{% vm %}\n</code></pre>\n<p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å®žçŽ°è¡¨æ ¼å•å…ƒæ ¼çš„åž‚ç›´åˆå¹¶æ•ˆæžœï¼š</p>\n<pre><code class=\"language-python\"># https://github.com/elapouya/python-docx-template/blob/master/tests/vertical_merge.py\nfrom docxtpl import DocxTemplate\n\n# data: https://github.com/elapouya/python-docx-template/blob/master/tests/templates/vertical_merge_tpl.docx\ntpl = DocxTemplate(\"templates/vertical_merge_tpl.docx\")\n\ncontext = {\n    \"items\": [\n        {\"desc\": \"Python interpreters\", \"qty\": 2, \"price\": \"FREE\"},\n        {\"desc\": \"Django projects\", \"qty\": 5403, \"price\": \"FREE\"},\n        {\"desc\": \"Guido\", \"qty\": 1, \"price\": \"100,000,000.00\"},\n    ],\n    \"total_price\": \"100,000,000.00\",\n    \"category\": \"Book\",\n}\n\ntpl.render(context)\ntpl.save(\"output/vertical_merge.docx\")\n</code></pre>\n<p>è‹¥éœ€è¦ä¿®æ”¹è¡¨æ ¼å•å…ƒæ ¼çš„èƒŒæ™¯è‰²ï¼Œå¿…é¡»å°†ä»¥ä¸‹æ ‡ç­¾æ”¾ç½®åœ¨å•å…ƒæ ¼å†…å®¹çš„æœ€å¼€å¤´ä½ç½®ï¼š</p>\n<pre><code>{% cellbg &lt;var&gt; %}\n</code></pre>\n<p><code>&lt;var&gt;</code>å¿…é¡»å¡«å†™é¢œè‰²çš„åå…­è¿›åˆ¶ç¼–ç ï¼Œä¸”æ— éœ€åŒ…å«äº•å·ï¼ˆ#ï¼‰ã€‚</p>\n<h2 id=\"12-å¤æ‚å…ƒç´ \">1.2 å¤æ‚å…ƒç´ </h2>\n<p><img alt=\"\" src=\"https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E6%A8%A1%E6%9D%BF%E5%8C%96Word%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90%E6%8C%87%E5%8C%97/imgs/3.jpg\" /></p>\n<h3 id=\"121-å¯Œæ–‡æœ¬\">1.2.1 å¯Œæ–‡æœ¬</h3>\n<p>å¯Œæ–‡æœ¬ï¼ˆRich Textï¼‰æ˜¯ç›¸å¯¹äºŽçº¯æ–‡æœ¬ï¼ˆPlain Textï¼‰è€Œè¨€çš„ä¸€ç§æ–‡æœ¬æ ¼å¼ã€‚å®ƒä¸ä»…åŒ…å«æ–‡å­—å†…å®¹ï¼Œè¿˜æ”¯æŒä¸ºæ–‡å­—æ·»åŠ å„ç§æ ¼å¼å±žæ€§åŠå¤šåª’ä½“å…ƒç´ ï¼Œä»Žè€Œå‘ˆçŽ°å‡ºæ›´ä¸ºä¸°å¯Œçš„è§†è§‰æ•ˆæžœã€‚è¿™ç§æ ¼å¼çš„ç¼–è¾‘å’Œå¤„ç†ä¹Ÿå¯ä»¥é€šè¿‡åœ¨Microsoft Wordè½¯ä»¶ä¸­é¢„å…ˆå®šä¹‰å­—ç¬¦æ ·å¼æ¥å®žçŽ°ã€‚</p>\n<p>åœ¨python-docx-templateä¸­ä½¿ç”¨å¯Œæ–‡æœ¬çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>åœ¨Wordæ¨¡æ¿ä¸­ï¼Œä¸ºå¯Œæ–‡æœ¬å®šä¹‰ä¸€ä¸ªå ä½ç¬¦ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨<code>{{r rich_text_var}}</code>ï¼Œå…¶ä¸­çš„rè¡¨ç¤ºå¯Œæ–‡æœ¬ã€‚</li>\n<li>åœ¨Pythonä»£ç ä¸­ï¼Œåˆ©ç”¨RichTextç±»æž„å»ºå¸¦æœ‰æ ¼å¼çš„æ–‡æœ¬å†…å®¹ã€‚</li>\n<li>æ¸²æŸ“æ¨¡æ¿æ—¶ï¼Œå ä½ç¬¦ä¼šè¢«æ›¿æ¢ä¸ºå¯Œæ–‡æœ¬å†…å®¹ï¼Œå¹¶ä¿ç•™æ‰€æœ‰å·²å®šä¹‰çš„æ ¼å¼æ ·å¼ã€‚</li>\n</ol>\n<p>åœ¨ä»£ç ä¸­ä½¿ç”¨RichTextç±»æ—¶ï¼Œè¿˜å¯é€šè¿‡ä»¥ä¸‹æ ‡è®°æŽ§åˆ¶æ–‡æœ¬æ ¼å¼ï¼š</p>\n<ul>\n<li>æ¢è¡Œï¼š<code>\\n</code>ï¼›</li>\n<li>æ¢æ®µï¼š<code>\\a</code>ï¼›</li>\n<li>åˆ†é¡µï¼š<code>\\f</code>ã€‚</li>\n</ul>\n<p>ä»¥ä¸‹ä¸ºç”Ÿæˆå¯Œæ–‡æœ¬Wordæ–‡æ¡£çš„ç¤ºä¾‹ï¼š</p>\n<pre><code class=\"language-python\"># https://github.com/elapouya/python-docx-template/blob/master/tests/richtext.py\nfrom docxtpl import DocxTemplate, RichText\n\n# data: https://github.com/elapouya/python-docx-template/blob/master/tests/templates/richtext_tpl.docx\ntpl = DocxTemplate(\"templates/richtext_tpl.docx\")\n\nrt = RichText()\n\n# å‘å¯Œæ–‡æœ¬å¯¹è±¡ä¸­æ·»åŠ å†…å®¹ï¼Œä¾æ¬¡æ¼”ç¤ºä¸åŒçš„æ–‡æœ¬æ ¼å¼è®¾ç½®\nrt.add(\"a rich text\", style=\"myrichtextstyle\")  # ä½¿ç”¨è‡ªå®šä¹‰æ ·å¼\nrt.add(\" with \")                                \nrt.add(\"some italic\", italic=True)              # æ–œä½“æ–‡æœ¬\nrt.add(\" and \")\nrt.add(\"some violet\", color=\"#ff00ff\")          # ç´«è‰²æ–‡æœ¬ï¼ˆåå…­è¿›åˆ¶é¢œè‰²ç ï¼‰\nrt.add(\" and \")\nrt.add(\"some striked\", strike=True)             # åˆ é™¤çº¿æ–‡æœ¬\nrt.add(\" and \")\nrt.add(\"some Highlighted\", highlight=\"#ffff00\") # é»„è‰²é«˜äº®æ–‡æœ¬\nrt.add(\" and \")\nrt.add(\"some small\", size=14)                   # å°å­—å·æ–‡æœ¬ï¼ˆ14ç£…ï¼‰\nrt.add(\" or \")\nrt.add(\"big\", size=60)                          # å¤§å­—å·æ–‡æœ¬ï¼ˆ60ç£…ï¼‰\nrt.add(\" text.\")\nrt.add(\"\\nYou can add an hyperlink, here to \")\n# æ·»åŠ å¸¦è¶…é“¾æŽ¥çš„æ–‡æœ¬ï¼Œbuild_url_id ç”¨äºŽåˆ›å»ºURLæ ‡è¯†å¹¶å…³è”åˆ°æŒ‡å®šé“¾æŽ¥\nrt.add(\"bing\", url_id=tpl.build_url_id(\"http://bing.com\"))\nrt.add(\"\\nEt voilÃ  ! \")\n# æ¼”ç¤ºæ¢è¡Œç¬¦æ•ˆæžœ\nrt.add(\"\\n1st line\")\nrt.add(\"\\n2nd line\")\nrt.add(\"\\n3rd line\")\n# \\a ç”¨äºŽåˆ›å»ºæ–°æ®µè½\nrt.add(\"\\aA new paragraph : &lt;cool&gt;\\a\")\n# \\f ç”¨äºŽæ’å…¥åˆ†é¡µç¬¦\nrt.add(\"--- A page break here (see next page) ---\\f\")\n\n# å¾ªçŽ¯æ¼”ç¤ºä¸åŒç±»åž‹çš„ä¸‹åˆ’çº¿æ ·å¼\nfor ul in [\n    \"single\",       # å•ä¸‹åˆ’çº¿\n    \"double\",       # åŒä¸‹åˆ’çº¿\n    \"thick\",        # ç²—ä¸‹åˆ’çº¿\n    \"dotted\",       # ç‚¹ä¸‹åˆ’çº¿\n    \"dash\",         # çŸ­åˆ’çº¿ä¸‹åˆ’çº¿\n    \"dotDash\",      # ç‚¹åˆ’çº¿ä¸‹åˆ’çº¿\n    \"dotDotDash\",   # åŒç‚¹åˆ’çº¿ä¸‹åˆ’çº¿\n    \"wave\",         # æ³¢æµªçº¿ä¸‹åˆ’çº¿\n]:\n    rt.add(\"\\nUnderline : \" + ul + \" \\n\", underline=ul)\n\n# æ¼”ç¤ºä¸åŒå­—ä½“çš„è®¾ç½®\nrt.add(\"\\nFonts :\\n\", underline=True)\nrt.add(\"Arial\\n\", font=\"Arial\")                \nrt.add(\"Courier New\\n\", font=\"Courier New\")    \nrt.add(\"Times New Roman\\n\", font=\"Times New Roman\") \n\n# æ¼”ç¤ºä¸Šæ ‡å’Œä¸‹æ ‡æ–‡æœ¬\nrt.add(\"\\n\\nHere some\")\nrt.add(\"superscript\", superscript=True)        # ä¸Šæ ‡æ–‡æœ¬\nrt.add(\" and some\")\nrt.add(\"subscript\", subscript=True)            # ä¸‹æ ‡æ–‡æœ¬\n\n# åˆ›å»ºä¸€ä¸ªæ–°çš„å¯Œæ–‡æœ¬å¯¹è±¡ï¼Œå¹¶å°†ä¹‹å‰åˆ›å»ºçš„rtå¯¹è±¡åµŒå…¥å…¶ä¸­ï¼Œå®žçŽ°å¯Œæ–‡æœ¬åµŒå¥—\nrt_embedded = RichText(\"an example of \")\nrt_embedded.add(rt)\n\n# æž„å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ï¼Œå°†åµŒå¥—çš„å¯Œæ–‡æœ¬å¯¹è±¡èµ‹å€¼ç»™æ¨¡æ¿ä¸­çš„ \"example\" å˜é‡\ncontext = {\n    \"example\": rt_embedded,\n}\n\n# å°†ä¸Šä¸‹æ–‡æ•°æ®æ¸²æŸ“åˆ°Wordæ¨¡æ¿ä¸­\ntpl.render(context)\n# ä¿å­˜æ¸²æŸ“åŽçš„Wordæ–‡æ¡£åˆ°æŒ‡å®šè·¯å¾„\ntpl.save(\"output/richtext.docx\")\n</code></pre>\n<h3 id=\"122-å¯Œæ–‡æœ¬æ®µè½\">1.2.2 å¯Œæ–‡æœ¬æ®µè½</h3>\n<p>è‹¥è¦ç²¾ç»†æŽ§åˆ¶å•ä¸ªæ®µè½çš„æ ·å¼ï¼Œå¯åœ¨ä»£ç ä¸­ä½¿ç”¨<code>RichTextParagraph()</code>æˆ–<code>RP()</code>å¯¹è±¡ã€‚æ­¤å¯¹è±¡éœ€é€šè¿‡<code>{{p &lt;var&gt; }}</code>è¯­æ³•æ·»åŠ è‡³æ¨¡æ¿ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\"># https://github.com/elapouya/python-docx-template/blob/master/tests/richtextparagraph.py\nfrom docxtpl import DocxTemplate, RichText, RichTextParagraph\n\n# data: https://github.com/elapouya/python-docx-template/blob/master/tests/templates/richtext_paragraph_tpl.docx\ntpl = DocxTemplate(\"templates/richtext_paragraph_tpl.docx\")\n\n# åˆ›å»ºå¯Œæ–‡æœ¬æ®µè½å¯¹è±¡ç»„åˆä¸åŒæ ·å¼çš„æ®µè½\nrtp = RichTextParagraph()\n# åˆ›å»ºå¯Œæ–‡æœ¬å¯¹è±¡ï¼Œç”¨äºŽè®¾ç½®æ–‡æœ¬çš„å­—ç¬¦æ ·å¼\nrt = RichText()\n\n# å‘å¯Œæ–‡æœ¬æ®µè½ä¸­æ·»åŠ æ–‡æœ¬ï¼Œå¹¶æŒ‡å®šè‡ªå®šä¹‰æ ·å¼myrichparastyle\nrtp.add(\n    \"The rich text paragraph function allows paragraph styles to be added to text\",\n    parastyle=\"myrichparastyle\",\n)\n# æ·»åŠ æ–‡æœ¬å¹¶ä½¿ç”¨å†…ç½®æ®µè½æ ·å¼IntenseQuote\nrtp.add(\"Any built in paragraph style can be used\", parastyle=\"IntenseQuote\")\n# æ·»åŠ æ–‡æœ¬å¹¶ä½¿ç”¨è‡ªå®šä¹‰æ ·å¼createdStyle\nrtp.add(\n    \"or you can add your own, unlocking all style options\", parastyle=\"createdStyle\"\n)\n# æ·»åŠ æ–‡æœ¬å¹¶ä½¿ç”¨é»˜è®¤æ™®é€šæ®µè½æ ·å¼normal\nrtp.add(\n    \"To use, just create a style in your template word doc with the formatting you want \"\n    \"and call it in the code.\",\n    parastyle=\"normal\",\n)\n\n# æ¼”ç¤ºä¸åŒåˆ—è¡¨æ ·å¼çš„ä½¿ç”¨\nrtp.add(\"This allows for the use of\")\nrtp.add(\"custom bullet\\apoints\", parastyle=\"SquareBullet\")  # æ–¹å½¢é¡¹ç›®ç¬¦å·æ ·å¼\nrtp.add(\"Numbered Bullet Points\", parastyle=\"BasicNumbered\")  # æ•°å­—ç¼–å·æ ·å¼\nrtp.add(\"and Alpha Bullet Points.\", parastyle=\"alphaBracketNumbering\")  # å­—æ¯ç¼–å·æ ·å¼\n\n# æ¼”ç¤ºæ–‡æœ¬å¯¹é½æ–¹å¼çš„è®¾ç½®\nrtp.add(\"You can\", parastyle=\"normal\")  # é»˜è®¤å·¦å¯¹é½\nrtp.add(\"set the\", parastyle=\"centerAlign\")  # åº”ç”¨è‡ªå®šä¹‰æ ·å¼å±…ä¸­å¯¹é½\nrtp.add(\"text alignment\", parastyle=\"rightAlign\")  # åº”ç”¨è‡ªå®šä¹‰æ ·å¼å³å¯¹é½\n\n# æ¼”ç¤ºè¡Œé—´è·æ ·å¼ï¼šç´§å‡‘è¡Œé—´è·\nrtp.add(\n    \"as well as the spacing between lines of text. Like this for example, \"\n    \"this text has very tight spacing between the lines.\\aIt also has no space between \"\n    \"paragraphs of the same style.\",\n    parastyle=\"TightLineSpacing\",\n)\n# æ¼”ç¤ºè¡Œé—´è·æ ·å¼ï¼šå®½è¡Œé—´è·\nrtp.add(\n    \"Unlike this one, which has extra large spacing between lines for when you want to \"\n    \"space things out a bit or just write a little less.\",\n    parastyle=\"WideLineSpacing\",\n)\n# æ¼”ç¤ºæ®µè½èƒŒæ™¯è‰²æ ·å¼ï¼šç»¿è‰²èƒŒæ™¯\nrtp.add(\n    \"You can also set the background colour of a line.\", parastyle=\"LineShadingGreen\"\n)\n\n# æž„å»ºå¯Œæ–‡æœ¬å­—ç¬¦ä¸²ï¼Œæ¼”ç¤ºå­—ç¬¦çº§æ ·å¼\nrt.add(\"This works with \")\nrt.add(\"Rich \", bold=True)  # åŠ ç²—\nrt.add(\"Text \", italic=True)  # æ–œä½“\nrt.add(\"Strings\", underline=\"single\")  # å•ä¸‹åˆ’çº¿\nrt.add(\" too.\")\n\n# å°†å¯Œæ–‡æœ¬å¯¹è±¡æ·»åŠ åˆ°å¯Œæ–‡æœ¬æ®µè½ä¸­ï¼Œå¹¶æŒ‡å®šæ–¹å½¢é¡¹ç›®ç¬¦å·æ ·å¼\nrtp.add(rt, parastyle=\"SquareBullet\")\n\n# æž„å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ï¼Œå°†å¯Œæ–‡æœ¬æ®µè½å¯¹è±¡ç»‘å®šåˆ°æ¨¡æ¿ä¸­çš„exampleå˜é‡\ncontext = {\n    \"example\": rtp,\n}\n\n# å°†ä¸Šä¸‹æ–‡æ•°æ®æ¸²æŸ“åˆ° Word æ¨¡æ¿ä¸­\ntpl.render(context)\n# ä¿å­˜æ¸²æŸ“åŽçš„ Word æ–‡æ¡£åˆ°æŒ‡å®šè·¯å¾„\ntpl.save(\"output/richtext_paragraph.docx\")\n</code></pre>\n<h3 id=\"123-æµ®åŠ¨å¯¹è±¡\">1.2.3 æµ®åŠ¨å¯¹è±¡</h3>\n<p><strong>å›¾ç‰‡æ’å…¥</strong></p>\n<p>å¯åœ¨æ–‡æ¡£ä¸­åŠ¨æ€æ’å…¥å•å¼ æˆ–å¤šå¼ å›¾ç‰‡ï¼Œå½“å‰å·²æ”¯æŒJPEGå’ŒPNGæ ¼å¼ã€‚åªéœ€åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨<code>{{ &lt;var&gt; }}</code>æ ¼å¼çš„æ ‡ç­¾å³å¯ã€‚å›¾ç‰‡åµŒå…¥ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\">myimage = InlineImage(tpl, image_descriptor='test_files/python_logo.png', width=Mm(20), height=Mm(10))\n</code></pre>\n<p>ä½¿ç”¨æ—¶åº”ä¼ å…¥æ¨¡æ¿å¯¹è±¡ä¸Žå›¾ç‰‡æ–‡ä»¶è·¯å¾„ï¼Œå®½é«˜ä¸ºå¯é€‰å‚æ•°ã€‚å®½åº¦å’Œé«˜åº¦éœ€é€šè¿‡<code>Mm</code>ï¼ˆæ¯«ç±³ï¼‰ã€<code>Inches</code>ï¼ˆè‹±å¯¸ï¼‰æˆ– <code>Pt</code>ï¼ˆç£…ï¼‰ç­‰ç±»è¿›è¡Œå•ä½å®šä¹‰ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\"># https://github.com/elapouya/python-docx-template/blob/master/tests/inline_image.py\nfrom docxtpl import DocxTemplate, InlineImage\nfrom docx.shared import Mm\nimport jinja2\n# data: https://github.com/elapouya/python-docx-template/blob/master/tests/templates/inline_image_tpl.docx\ntpl = DocxTemplate(\"templates/inline_image_tpl.docx\")\n\n# å®šä¹‰æ¸²æŸ“æ¨¡æ¿æ‰€éœ€çš„ä¸Šä¸‹æ–‡æ•°æ®\ncontext = {\n    # åªè®¾ç½®å®½æˆ–è€…é«˜ï¼Œåˆ™å›¾ç‰‡è‡ªé€‚åº”å˜åŒ–\n    \"myimage\": InlineImage(tpl, \"templates/python_logo.png\", width=Mm(20)),\n    # æ‰‹åŠ¨æŒ‡å®šå®½é«˜åº¦\n    \"myimageratio\": InlineImage(\n        tpl, \"templates/python_jpeg.jpg\", width=Mm(30), height=Mm(60)\n    ),\n    # å®šä¹‰å›¾ç‰‡+æè¿°\n    \"frameworks\": [\n        {\n            \"image\": InlineImage(tpl, \"templates/django.png\", height=Mm(10)),\n            \"desc\": \"The web framework for perfectionists with deadlines\",\n        },\n        {\n            \"image\": InlineImage(tpl, \"templates/zope.png\", height=Mm(10)),\n            \"desc\": \"Zope is a leading Open Source Application Server \"\n            \"and Content Management Framework\",\n        },\n        {\n            \"image\": InlineImage(tpl, \"templates/pyramid.png\", height=Mm(10)),\n            \"desc\": \"Pyramid is a lightweight Python web framework aimed at taking \"\n            \"small web apps into big web apps.\",\n        },\n        {\n            \"image\": InlineImage(tpl, \"templates/bottle.png\", height=Mm(10)),\n            \"desc\": \"Bottle is a fast, simple and lightweight WSGI micro web-framework \"\n            \"for Python\",\n        },\n        {\n            \"image\": InlineImage(tpl, \"templates/tornado.png\", height=Mm(10)),\n            \"desc\": \"Tornado is a Python web framework and asynchronous networking \"\n            \"library.\",\n        },\n    ],\n}\n\n# autoescapeæ˜¯å¦å¼€å¯è‡ªåŠ¨è½¬ä¹‰ï¼ŒæŠŠæ¨¡æ¿å˜é‡ä¸­çš„ç‰¹æ®Šå­—ç¬¦è½¬æ¢æˆæ— å®³çš„HTMå®žä½“\njinja_env = jinja2.Environment(autoescape=True)\n# ä½¿ç”¨ä¸Šä¸‹æ–‡æ•°æ®å’Œè‡ªå®šä¹‰çš„jinja2çŽ¯å¢ƒæ¸²æŸ“Wordæ¨¡æ¿\ntpl.render(context, jinja_env)\ntpl.save(\"output/inline_image.docx\")\n</code></pre>\n<p><strong>æ›¿æ¢æ–‡æ¡£ä¸­çš„å›¾ç‰‡</strong></p>\n<p>å¯å¯¹æ–‡æ¡£ä¸­çš„çŽ°æœ‰å›¾ç‰‡è¿›è¡Œæ›¿æ¢ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼šå…ˆåœ¨æ¨¡æ¿ä¸­æ’å…¥ä¸€å¼ å ä½å›¾ï¼ŒæŒ‰å¸¸è§„æµç¨‹æ¸²æŸ“æ¨¡æ¿ï¼Œä¹‹åŽå†å°†å ä½å›¾æ›¿æ¢ä¸ºç›®æ ‡å›¾ç‰‡ã€‚è¯¥æ–¹æ³•æ”¯æŒæ‰¹é‡å¤„ç†æ–‡æ¡£å†…çš„æ‰€æœ‰åª’ä½“æ–‡ä»¶ï¼Œä¸”æ›¿æ¢åŽçš„å›¾ç‰‡å°†ç»´æŒåŽŸå ä½å›¾çš„çºµæ¨ªæ¯”ã€‚åœ¨æ¨¡æ¿ä¸­æ’å…¥å›¾ç‰‡æ—¶ï¼Œåªéœ€æŒ‡å®šæ–‡ä»¶åå³å¯ã€‚è¯¥æ›¿æ¢æ“ä½œåŒæ—¶å¯¹é¡µçœ‰ã€é¡µè„šåŠæ­£æ–‡åŒºåŸŸç”Ÿæ•ˆã€‚</p>\n<p>ä¾‹å¦‚ï¼Œæ›¿æ¢å ä½å›¾<code>dummy_header_pic.jpg</code>çš„è¯­æ³•ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\">tpl.replace_pic('dummy_header_pic.jpg', 'header_pic_i_want.jpg')\n</code></pre>\n<p>æ³¨æ„ï¼Œåœ¨å°†å›¾ç‰‡æ‰‹åŠ¨æ’å…¥Wordæ¨¡æ¿æ—¶ï¼ŒæŸäº›ç‰ˆæœ¬çš„Wordä¼šè‡ªåŠ¨å¯¹å…¶é‡å‘½åå¹¶å­˜å‚¨ã€‚è¿™å¯¼è‡´å›¾ç‰‡åœ¨docxæ–‡ä»¶å†…çš„å®žé™…æ–‡ä»¶åä¸ŽåŽŸæ–‡ä»¶åå®Œå…¨ä¸åŒï¼Œä»Žè€Œå¯èƒ½å¼•å‘æ‰¾ä¸åˆ°å›¾ç‰‡çš„é—®é¢˜ã€‚è‹¥ä¸ç¡®å®šå›¾ç‰‡çš„å…·ä½“ä½ç½®ï¼Œå¯å°†docxæ–‡ä»¶è§†ä¸ºzipåŽ‹ç¼©åŒ…è¿›è¡Œè§£åŽ‹ï¼ŒéšåŽåœ¨<code>word\\document.xml</code>æ–‡ä»¶ä¸­ï¼Œé€šè¿‡æŸ¥æ‰¾<code>pic:nvPicPr</code>èŠ‚ç‚¹æ¥å®šä½å›¾ç‰‡ä¿¡æ¯ã€‚å…·ä½“æ­¥éª¤å¯å‚è€ƒï¼š<a href=\"https://blog.csdn.net/qq_42780731/article/details/106946284\" rel=\"noopener nofollow\" target=\"_blank\">pythonä½¿ç”¨docxtplåº“å¯¹å›¾ç‰‡è¿›è¡Œæ›¿æ¢</a>ã€‚</p>\n<p>åœ¨æ‰¾åˆ°ç›®æ ‡å›¾ç‰‡å¯¹åº”çš„<code>pic:nvPicPr</code>èŠ‚ç‚¹åŽï¼Œå…¶<code>name</code>å±žæ€§çš„å€¼å³ä¸ºå›¾ç‰‡åœ¨æ–‡æ¡£ä¸­å®žé™…å­˜å‚¨çš„æ–‡ä»¶åã€‚æ­¤å¤„çš„æ–‡ä»¶åå¯èƒ½ä¸åŒ…å«å›¾ç‰‡æ ¼å¼åŽç¼€ï¼Œæ›¿æ¢å›¾ç‰‡çš„ç¤ºä¾‹ä»£ç å¯èƒ½å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\">tpl.replace_pic('Picture 1','header_pic_i_want.jpg')\n</code></pre>\n<h3 id=\"124-å­æ–‡æ¡£\">1.2.4 å­æ–‡æ¡£</h3>\n<p>æ¨¡æ¿å˜é‡å¯åŒ…å«å¤æ‚çš„å­æ–‡æ¡£å¯¹è±¡ï¼Œä¸”èƒ½é€šè¿‡python-docxçš„æ–‡æ¡£æ“ä½œæ–¹æ³•ä»Žé›¶æž„å»ºã€‚å…·ä½“æ­¥éª¤ä¸ºï¼šå…ˆä»Žæ¨¡æ¿å¯¹è±¡ä¸­èŽ·å–å­æ–‡æ¡£å¯¹è±¡ï¼Œå†å°†å…¶å½“ä½œpython-docxæ–‡æ¡£å¯¹è±¡ä½¿ç”¨ã€‚è¯¥åŠŸèƒ½éœ€è¦å®‰è£…é¢å¤–ä¾èµ–ï¼š</p>\n<blockquote>\n<p>pip install \"docxtpl[subdoc]\"</p>\n</blockquote>\n<p>ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºå­æ–‡æ¡£ï¼Œå¹¶å°†è¯¥å­æ–‡æ¡£åµŒå…¥åˆ°ä¸»æ¨¡æ¿ä¸­ï¼Œæœ€ç»ˆç”Ÿæˆå¹¶ä¿å­˜æ–°çš„æ–‡æ¡£ï¼š</p>\n<pre><code class=\"language-python\"># https://github.com/elapouya/python-docx-template/blob/master/tests/subdoc.py\nfrom docxtpl import DocxTemplate\nfrom docx.shared import Inches\n\n# data: https://github.com/elapouya/python-docx-template/blob/master/tests/templates/subdoc_tpl.docx\n# 1. åŠ è½½Wordæ¨¡æ¿æ–‡ä»¶ï¼ˆæŒ‡å®šæ¨¡æ¿æ–‡ä»¶è·¯å¾„ï¼‰\ntpl = DocxTemplate(\"templates/subdoc_tpl.docx\")\n\n# 2. åˆ›å»ºä¸€ä¸ªæ–°çš„å­æ–‡æ¡£å¯¹è±¡\nsd = tpl.new_subdoc()\n\n# 3. å‘ä¸‹æ–‡æ¡£ä¸­æ·»åŠ æ®µè½å†…å®¹\np = sd.add_paragraph(\"This is a sub-document inserted into a bigger one\")\np = sd.add_paragraph(\"It has been \")\n# ä¸ºæ–‡æœ¬ç‰‡æ®µè®¾ç½®è‡ªå®šä¹‰æ ·å¼\np.add_run(\"dynamically\").style = \"dynamic\"\np.add_run(\" generated with python by using \")\n# ä¸ºæ–‡æœ¬ç‰‡æ®µè®¾ç½®æ–œä½“æ ·å¼\np.add_run(\"python-docx\").italic = True\np.add_run(\" library\")\n\n# 4. å‘ä¸‹æ–‡æ¡£æ·»åŠ æ ‡é¢˜\nsd.add_heading(\"Heading, level 1\", level=1)\n# å‘ä¸‹æ–‡æ¡£æ·»åŠ å¸¦æ ·å¼çš„æ®µè½ï¼ˆIntenseQuoteæ ·å¼ä¸ºå†…ç½®æ ·å¼ï¼‰\nsd.add_paragraph(\"This is an Intense quote\", style=\"IntenseQuote\")\n\n# 5. å‘ä¸‹æ–‡æ¡£æ’å…¥å›¾ç‰‡\nsd.add_paragraph(\"A picture :\")\nsd.add_picture(\"templates/python_logo.png\", width=Inches(1.25))\n\n# 6. å‘ä¸‹æ–‡æ¡£æ’å…¥è¡¨æ ¼\nsd.add_paragraph(\"A Table :\")\n# åˆ›å»ºè¡¨æ ¼ï¼ˆåˆå§‹1è¡Œ3åˆ—ï¼Œä½œä¸ºè¡¨å¤´ï¼‰\ntable = sd.add_table(rows=1, cols=3)\n# èŽ·å–è¡¨å¤´å•å…ƒæ ¼å¹¶è®¾ç½®å†…å®¹\nhdr_cells = table.rows[0].cells\nhdr_cells[0].text = \"Qty\"\nhdr_cells[1].text = \"Id\"\nhdr_cells[2].text = \"Desc\"\n\n# å®šä¹‰è¡¨æ ¼æ•°æ®\nrecordset = ((1, 101, \"Spam\"), (2, 42, \"Eggs\"), (3, 631, \"Spam,spam, eggs, and ham\"))\n# å¾ªçŽ¯æ·»åŠ æ•°æ®è¡Œåˆ°è¡¨æ ¼\nfor item in recordset:\n    row_cells = table.add_row().cells\n    row_cells[0].text = str(item[0])  # æ•°é‡ï¼ˆè½¬ä¸ºå­—ç¬¦ä¸²ï¼‰\n    row_cells[1].text = str(item[1])  # IDï¼ˆè½¬ä¸ºå­—ç¬¦ä¸²ï¼‰\n    row_cells[2].text = item[2]       # æè¿°\n\ncontext = {\n    \"mysubdoc\": sd,\n}\n\ntpl.render(context)\ntpl.save(\"output/subdoc.docx\")\n</code></pre>\n<p>æ­¤å¤–è‡ªpython-docx-template V0.12.0ç‰ˆæœ¬èµ·ï¼Œæ”¯æŒå°†å·²æœ‰çš„.docxæ–‡ä»¶ä½œä¸ºå­æ–‡æ¡£è¿›è¡Œåˆå¹¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code class=\"language-python\"># https://github.com/elapouya/python-docx-template/blob/master/tests/merge_docx.py\nfrom docxtpl import DocxTemplate\n\n# data: https://github.com/elapouya/python-docx-template/blob/master/tests/templates\ntpl = DocxTemplate(\"templates/merge_docx_master_tpl.docx\")\nsd = tpl.new_subdoc(\"templates/merge_docx_subdoc.docx\")\n\ncontext = {\n    \"mysubdoc\": sd,\n}\n\ntpl.render(context)\ntpl.save(\"output/merge_docx.docx\")\n</code></pre>\n<h2 id=\"13-è¡¥å……æ“ä½œ\">1.3 è¡¥å……æ“ä½œ</h2>\n<p><img alt=\"\" src=\"https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E6%A8%A1%E6%9D%BF%E5%8C%96Word%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90%E6%8C%87%E5%8C%97/imgs/4.jpg\" /></p>\n<h3 id=\"131-è½¬ä¹‰æ“ä½œ\">1.3.1 è½¬ä¹‰æ“ä½œ</h3>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œpython-docx-templateä¸ä¼šå¯¹å†…å®¹è¿›è¡Œè½¬ä¹‰ã€‚è¿™æ˜¯å› ä¸ºåœ¨ä½¿ç”¨æ¨¡æ¿è¯­æ³•ä¿®æ”¹Wordæ–‡æ¡£æ—¶ï¼Œåº•å±‚å®žé™…ä¸Šæ˜¯åœ¨å¤„ç†XMLç»“æž„ï¼Œè€Œåƒ<code>&lt;</code>ã€<code>&gt;</code> å’Œ<code>&amp;</code>è¿™æ ·çš„å­—ç¬¦åœ¨XMLä¸­å…·æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå¿…é¡»ç»è¿‡è½¬ä¹‰æ‰èƒ½æ­£ç¡®æ˜¾ç¤ºã€‚ä»¥ä¸‹æä¾›å‡ ç§å®žçŽ°è½¬ä¹‰çš„æ–¹æ³•ï¼š</p>\n<ol>\n<li>\n<p>ä¸Šä¸‹æ–‡å®šä¹‰æ—¶ä½¿ç”¨<code>R()</code>åŒ…è£¹å†…å®¹ï¼Œæ¨¡æ¿ä¸­æ·»åŠ <code>r</code>æ ‡è®°ï¼š</p>\n<pre><code class=\"language-python\">context = { 'var': R('my text') }\n</code></pre>\n<p>æ¨¡æ¿ä¸­å†™æ³•ï¼š<code>{{r &lt;var&gt; }}</code></p>\n</li>\n<li>\n<p>ä¸Šä¸‹æ–‡ä¿æŒåŽŸå§‹å­—ç¬¦ä¸²ï¼Œæ¨¡æ¿ä¸­ä½¿ç”¨<code>|e</code>è¿‡æ»¤å™¨ï¼š</p>\n<pre><code class=\"language-python\">context = { 'var':'my text' }\n</code></pre>\n<p>æ¨¡æ¿ä¸­å†™æ³•ï¼š<code>{{ &lt;var&gt;|e }}</code></p>\n</li>\n<li>\n<p>ä¸Šä¸‹æ–‡ä½¿ç”¨<code>escape()</code>å‡½æ•°å¤„ç†å†…å®¹ï¼Œæ¨¡æ¿ç›´æŽ¥å¼•ç”¨ï¼š</p>\n<pre><code class=\"language-python\">context = { 'var': escape('my text') }\n</code></pre>\n<p>æ¨¡æ¿ä¸­å†™æ³•ï¼š<code>{{ &lt;var&gt; }}</code></p>\n</li>\n<li>\n<p>è°ƒç”¨<code>render</code>æ–¹æ³•æ—¶å¯ç”¨è‡ªåŠ¨è½¬ä¹‰ï¼Œé»˜è®¤å€¼ä¸º<code>autoescape=False</code>ï¼š</p>\n<pre><code class=\"language-python\">tpl.render(context, autoescape=True)\n</code></pre>\n</li>\n</ol>\n<p>åœ¨æ–‡æ¡£ä¸­æ’å…¥ä»£ç æ¸…å•æ—¶ï¼Œå¦‚æžœéœ€è¦åŒæ—¶è½¬ä¹‰æ–‡æœ¬å¹¶å¤„ç†æ¢è¡Œç¬¦ï¼ˆ<code>\\n</code>ï¼‰ã€æ®µè½ç¬¦ï¼ˆ<code>\\a</code>ï¼‰å’Œæ¢é¡µç¬¦ï¼ˆ<code>\\f</code>ï¼‰ï¼Œå¯ä»¥åœ¨Pythonä»£ç ä¸­ä½¿ç”¨<code>Listing</code>ç±»ã€‚</p>\n<p>ä¾‹å¦‚ï¼š</p>\n<pre><code class=\"language-python\">context = { \n    'mylisting': Listing('the listing\\nwith\\nsome\\nlines \\a and some paragraph \\a and special chars : &lt;&gt;&amp;') \n}\n</code></pre>\n<p>åœ¨æ¨¡æ¿ä¸­ç›´æŽ¥å¼•ç”¨å³å¯ï¼š</p>\n<pre><code>{{ mylisting }}\n</code></pre>\n<p>ä½¿ç”¨<code>Listing()</code>èƒ½å¤Ÿä¿æŒå½“å‰å­—ç¬¦æ ·å¼ï¼Œé™¤éžé‡åˆ°<code>\\a</code>åˆ†éš”ç¬¦ï¼Œå®ƒä¼šåœ¨è¯¥ä½ç½®å¼€å§‹ä¸€ä¸ªæ–°çš„æ®µè½ã€‚</p>\n<p>ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\"># https://github.com/elapouya/python-docx-template/blob/master/tests/escape.py\nfrom docxtpl import DocxTemplate, R, Listing\n# data: https://github.com/elapouya/python-docx-template/blob/master/tests/templates/escape_tpl.docx\ntpl = DocxTemplate(\"templates/escape_tpl.docx\")\n\ncontext = {\n    \"myvar\": R(\n        '\"less than\" must be escaped : &lt;, this can be done with RichText() or R()'\n    ),\n    \"myescvar\": 'It can be escaped with a \"|e\" jinja filter in the template too : &lt; ',\n    \"nlnp\": R(\n        \"Here is a multiple\\nlines\\nstring\\aand some\\aother\\aparagraphs\",\n        color=\"#ff00ff\",\n    ),\n    \"mylisting\": Listing(\"the listing\\nwith\\nsome\\nlines\\nand special chars : &lt;&gt;&amp; ...\"),\n    \"page_break\": R(\"\\f\"),\n    \"new_listing\": \"\"\"\nThis is a new listing\nHere is a \\t tab\\a\nHere is a page break : \\f\nThat's it\n\"\"\",\n    \"some_html\": (\n        \"HTTP/1.1 200 OK\\n\"\n        \"Server: Apache-Coyote/1.1\\n\"\n        \"Cache-Control: no-store\\n\"\n    ),\n}\n\ntpl.render(context)\ntpl.save(\"output/escape.docx\")\n</code></pre>\n<p>æ­¤å¤–ï¼Œè‹¥éœ€åœ¨æœ€ç»ˆç”Ÿæˆçš„Wordæ–‡æ¡£ä¸­æ˜¾ç¤ºç”±Jinja2æ¸²æŸ“åŽçš„ç‰¹æ®Šå­—ç¬¦<code>%</code>ã€<code>{</code>æˆ–<code>}</code>ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è¿›è¡Œè½¬ä¹‰ï¼š</p>\n<ul>\n<li>æ˜¾ç¤º<code>%%</code> â†’ ä½¿ç”¨<code>{_% %_}</code></li>\n<li>æ˜¾ç¤º<code>{{ }}</code> â†’ ä½¿ç”¨<code>{_{ }_}</code></li>\n</ul>\n<h3 id=\"132-èŽ·å–æœªå®šä¹‰å˜é‡\">1.3.2 èŽ·å–æœªå®šä¹‰å˜é‡</h3>\n<p>è¦èŽ·å–æ¨¡æ¿æ¸²æŸ“æ—¶æ‰€éœ€çš„æœªå®šä¹‰å˜é‡ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>\n<pre><code class=\"language-python\">from docxtpl import DocxTemplate\ntpl = DocxTemplate('template.docx')\n\ncontext = {'name': 'å¼ ä¸‰', 'age': 30}\n# æ³¨æ„ï¼šdepartmentå˜é‡æœªå®šä¹‰\n\n# æ£€æµ‹ç¼ºå¤±å˜é‡\nmissing = tpl.get_undeclared_template_variables(context=context)\nprint(f\"ç¼ºå¤±çš„å˜é‡: {missing}\")\n\n# èŽ·å–æ‰€æœ‰å˜é‡ï¼ˆä¸ä¼ contextï¼‰\nall_vars = tpl.get_undeclared_template_variables()\nprint(f\"æ¨¡æ¿æ‰€æœ‰å˜é‡: {all_vars}\")\n</code></pre>\n<p>æ¨¡æ¿æ–‡æ¡£çš„å†…å®¹åŒ…å«ï¼š</p>\n<pre><code>å§“åï¼š{{name}}\nå¹´é¾„ï¼š{{age}}\néƒ¨é—¨ï¼š{{department}}\n</code></pre>\n<p>è‹¥æœªä¼ é€’ <code>context</code> å‚æ•°ï¼Œè¯¥æ–¹æ³•å°†è¿”å›žæ¨¡æ¿ä¸­æ‰€æœ‰éœ€è¦èµ‹å€¼çš„å˜é‡åçš„é›†åˆã€‚æ­¤ç»“æžœå¯ç”¨äºŽå‘ç”¨æˆ·æç¤ºè¾“å…¥ï¼Œæˆ–å†™å…¥æ–‡ä»¶ä¾›åŽç»­æ‰‹åŠ¨å¤„ç†ã€‚</p>\n<h3 id=\"133-jinjaè‡ªå®šä¹‰è¿‡æ»¤å™¨\">1.3.3 Jinjaè‡ªå®šä¹‰è¿‡æ»¤å™¨</h3>\n<p>Python-docx-templateçš„renderæ–¹æ³•æ”¯æŒä¸€ä¸ªå¯é€‰å‚æ•°jinja_envï¼Œä½œä¸ºå…¶ç¬¬äºŒä¸ªå‚æ•°ã€‚é€šè¿‡ä¼ é€’è‡ªå®šä¹‰çš„JinjaçŽ¯å¢ƒå¯¹è±¡ï¼Œå¯ä»¥å®žçŽ°è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„æ·»åŠ ï¼Œä»Žè€Œçµæ´»æ‰©å±•æ•°æ®å¤„ç†é€»è¾‘ã€‚ä»¥ä¸‹ä¸ºå…·ä½“ç¤ºä¾‹ã€‚</p>\n<p>æ¨¡æ¿wordå†…å®¹å¦‚ä¸‹ï¼š</p>\n<pre><code>=== å§“åå±•ç¤ºå¯¹æ¯” ===\nåŽŸå§‹åå­—: {{ name }}\næ–¹æ³•A (Pythonå¤„ç†): {{ name_upper }}\næ–¹æ³•B (æ¨¡æ¿è¿‡æ»¤å™¨): {{ name|upper }}\n</code></pre>\n<p>å¯¹åº”çš„Pythonæ¸²æŸ“ä»£ç ï¼š</p>\n<pre><code class=\"language-python\">from docxtpl import DocxTemplate\nimport jinja2\n\n# å‡†å¤‡æ•°æ®\ndata = {'name': 'zhangsan'}\n\n# Pythonä¸­å¤„ç†\ndata['name_upper'] = data['name'].upper()\n\n# å®šä¹‰è¿‡æ»¤å™¨\ndef my_upper(text):\n    return text.upper()\n\ndoc = DocxTemplate(\"template.docx\")\n\n#åˆ›å»ºçŽ¯å¢ƒå¹¶æ³¨å†Œè¿‡æ»¤å™¨\nenv = jinja2.Environment()\nenv.filters['upper'] = my_upper \n\ndoc.render(data, env) \ndoc.save(\"output/compare.docx\")\nprint(f\"åŽŸå§‹æ•°æ®: {data['name']}\")\nprint(f\"Pythonå¤„ç†ç»“æžœ: {data['name_upper']}\")\nprint(f\"æ¨¡æ¿è¿‡æ»¤å™¨ç»“æžœ: {data['name'].upper()}\")\n</code></pre>\n<h3 id=\"134-microsoft-word-2016ç‰¹æ®Šè¡Œä¸ºè¯´æ˜Ž\">1.3.4 Microsoft Word 2016ç‰¹æ®Šè¡Œä¸ºè¯´æ˜Ž</h3>\n<p>MS Word 2016ä¼šå¿½ç•¥æ–‡æ¡£ä¸­çš„åˆ¶è¡¨ç¬¦ï¼Œè¿™æ˜¯è¯¥ç‰ˆæœ¬ç‰¹æœ‰çš„æƒ…å†µã€‚ç±»ä¼¼LibreOfficeæˆ–WordPadç­‰å…¶ä»–ç¼–è¾‘å·¥å…·åˆ™æ— æ­¤é—®é¢˜ã€‚åŒæ ·ï¼Œä»¥Jinja2æ ‡ç­¾å¼€å¤´ä¸”å¸¦æœ‰å‰å¯¼ç©ºæ ¼çš„è¡Œï¼Œå…¶ç©ºæ ¼ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚</p>\n<p>ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¯ä½¿ç”¨<code>RichText</code>è¿›è¡Œå¤„ç†ï¼š</p>\n<pre><code class=\"language-python\">tpl.render({\n    'test_space_r': RichText('          '),\n    'test_tabs_r': RichText(5 * '\\t'),\n})\n</code></pre>\n<p>åœ¨æ¨¡æ¿ä¸­ï¼Œé€šè¿‡<code>{{r ... }}</code>è¯­æ³•è°ƒç”¨ï¼š</p>\n<pre><code>{{r test_space_r}} ç©ºæ ¼å°†è¢«ä¿ç•™\n{{r test_tabs_r}} åˆ¶è¡¨ç¬¦å°†æ­£å¸¸æ˜¾ç¤º\n</code></pre>\n<h1 id=\"2-å‚è€ƒ\">2 å‚è€ƒ</h1>\n<ul>\n<li><a href=\"https://www.cnblogs.com/luohenyueji/p/19479110\" target=\"_blank\">åŸºäºŽpython-docxåº“çš„Wordæ–‡æ¡£è‡ªåŠ¨å¤„ç†å…¨è§£</a></li>\n<li><a href=\"https://github.com/elapouya/python-docx-template\" rel=\"noopener nofollow\" target=\"_blank\">python-docx-template</a></li>\n<li><a href=\"https://docxtpl.readthedocs.io/\" rel=\"noopener nofollow\" target=\"_blank\">python-docx-template doc</a></li>\n<li><a href=\"https://blog.csdn.net/qq_42780731/article/details/106946284\" rel=\"noopener nofollow\" target=\"_blank\">pythonä½¿ç”¨docxtplåº“å¯¹å›¾ç‰‡è¿›è¡Œæ›¿æ¢</a></li>\n</ul>\n\n</div>\n<div id=\"MySignature\">\n    <p>æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š<a href=\"https://www.cnblogs.com/luohenyueji/\" target=\"_blank\">è½ç—•çš„å¯’å‡</a>ï¼Œè½¬è½½è¯·æ³¨æ˜ŽåŽŸæ–‡é“¾æŽ¥ï¼š<a href=\"https://www.cnblogs.com/luohenyueji/p/19503461\" target=\"_blank\">https://www.cnblogs.com/luohenyueji/p/19503461</a></p>\n\n<div style=\"text-align: center;\">\n    <img src=\"https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/wechat/content/%E5%8A%A0%E6%B2%B9%E9%B8%AD.gif\" />\n</div>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-19 18:51</span>&nbsp;\n<a href=\"https://www.cnblogs.com/luohenyueji\">è½ç—•çš„å¯’å‡</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">16</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "MAF快速入门（12）主工作流+子工作流",
      "link": "https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper12",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper12\" id=\"cb_post_title_url\" title=\"发布于 2026-01-19 18:30\">\n    <span>MAF快速入门（12）主工作流+子工作流</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        <img alt=\"MAF快速入门（12）主工作流+子工作流\" class=\"desc_img\" src=\"https://img2024.cnblogs.com/blog/381412/202601/381412-20260116201534655-550888663.png\" />\n        在实际业务场景中，往往需要在主工作流中根据工单类型分发或移交到不同的标准化子流程中进行后续处理。本文介绍了MAF中主工作流 + 子工作流的工作模式，最后通过一个企业客服中心处理投诉工单的案例介绍了这种模式的代码实现。\n    </div>\n<div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p><span><span>大家好，我是Edison。</span></span></p>\n<p><span><span>最近我一直在跟着圣杰的《<a class=\"normal_text_link mp_article_text_link\" href=\"https://mp.weixin.qq.com/s?__biz=MzA4NzQzNTg4Ng==&amp;mid=2651744458&amp;idx=1&amp;sn=139f7584e81aeecd0945133bdc2b4791&amp;scene=21#wechat_redirect\" rel=\"noopener nofollow\" target=\"_blank\"><span>.NET+AI智能体开发进阶</span></a><span>》课程学习MAF开发多智能体工作流，我强烈推荐你也上车跟我一起出发！</span></span></span></p>\n<p><span><a class=\"normal_text_link mp_article_text_link\" href=\"https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper11\" target=\"_blank\"><span>上一篇</span></a><span>，我们学习了MAF中如何进行并行工作流<span>。本篇，我们来了解下在MAF中如何开启 主工作流 + 自工作流 的模式，相信这会是大家可能会碰到的场景。</span></span></span></p>\n<h1><strong>1 子工作流模式介绍</strong></h1>\n<p><span><span><span><span><span><span>在实际业务场景中，往往需要在主工作流中根据工单类型分发或移交到不同的标准化子流程中进行后续处理<span>。</span></span></span></span></span></span></span></p>\n<p><span><span><span><span><span><span>在MAF中，我们可以使用 Sub-Worklfow 模式来实现这个目的<span>，如下代码片段所示。</span></span></span></span></span></span></span></p>\n<p><span><span><span><span><span><span>首先，将子工作流转换为一个Executor：</span></span></span></span></span></span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">var</span> logisticsSubExecutor =<span style=\"color: rgba(0, 0, 0, 1);\"> \n  logisticsSubWorkflow.BindAsExecutor(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">LogisticsSubWorkflow</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> productQualitySubExecutor =<span style=\"color: rgba(0, 0, 0, 1);\"> \n  productQualitySubWorkflow.BindAsExecutor(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">ProductQualitySubWorkflow</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>);</pre>\n</div>\n<p><span><span><span><span><span><span>然后，构建主工作流并根据条件路由到子工作流Executor：</span></span></span></span></span></span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">var</span> mainWorkflow = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> WorkflowBuilder(classifierExecutor)\n    .AddEdge</span>&lt;ComplaintProcessingRecord&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(classifierExecutor, productQualitySubExecutor, \n        condition: record </span>=&gt; record.Category == <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">产品质量</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    .AddEdge</span>&lt;ComplaintProcessingRecord&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(classifierExecutor, logisticsSubExecutor, \n        condition: record </span>=&gt; record.Category == <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">物流问题</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    .AddEdge(productQualitySubExecutor, complianceExecutor)\n    .AddEdge(logisticsSubExecutor, complianceExecutor)\n    .AddEdge(complianceExecutor, sentimentExecutor)\n    .WithOutputFrom(sentimentExecutor)\n    .Build();</span></pre>\n</div>\n<p><span><span><span><span><span><span><span>这样就实现了：<span><strong>主工作流进行分类转发，自工作流进行详细处理</strong><span>。</span></span></span></span></span></span></span></span></span></p>\n<h1><strong>2 主工作流+子工作流实验案例</strong></h1>\n<p><span><span><span><span><span><span><span><span><span><span>假设我们是一个企业的客服中心，每天都会收到大量的工单，需要根据工单类型（比如是 产品质量话题 还是 物流话题）分发到不同的标准化子流程去做后续处理，最后生成一个用户友好 且 满足合规要求 的回复给用户。</span></span></span></span></span></span></span></span></span></span></p>\n<p><span><span><span><span><span><span><span><span><span><span><span>因此，我们的目标是：配置&nbsp;<span>1个主工作流 + 2个子工作流<span>&nbsp;来覆盖这个需求。</span></span></span></span></span></span></span></span></span></span></span></span></span></p>\n<h3><strong><span><span>2.1 关键依赖包引入</span></span></strong></h3>\n<p><span><span><span><span><span><span><span><span><span><span><span><span><span><span>在今天的这个案例中，我们仍然创建了一个.NET控制台应用程序，安装了以下NuGet包：</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>\n<ul class=\"list-paddingleft-1\">\n<li><span>Microsoft.Agents.AI.OpenAI</span></li>\n<li><span>Microsoft.Agents.AI.Workflows</span></li>\n<li><span>Microsoft.Extensions.AI.OpenAI</span></li>\n</ul>\n<h3><span><span>2.2 定义数据传输模型</span></span></h3>\n<p><span><span>首先，我们定义一下在这个工作流中需要生成传递的数据模型：</span></span></p>\n<p><span><span>投诉数据模型 及 共享状态</span></span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">namespace</span><span style=\"color: rgba(0, 0, 0, 1);\"> SubWorkflow.Models;\n</span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 共享状态：投诉处理记录（各执行器会更新此对象）</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">internal</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> ComplaintProcessingRecord\n{\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> CustomerComplaint Original { <span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">; }\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span> Category { <span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span>; } = <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">未分类</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span> Handler { <span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span>; } = <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">待分配</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt; ProcessingSteps { <span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span>; } = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\">();\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span> AIGeneratedResponse { <span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span>; } = <span style=\"color: rgba(128, 0, 0, 1);\">\"\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span> ComplianceStatus { <span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span>; } = <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">待审核</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span> SentimentScore { <span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span>; } = <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">未评估</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n}\n</span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 投诉数据模型</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">internal</span><span style=\"color: rgba(0, 0, 0, 1);\"> record CustomerComplaint(\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\"> OrderId,\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\"> CustomerName,\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\"> ComplaintText,\n    DateTime SubmittedAt\n);</span></pre>\n</div>\n<h3><span><span>2.3 定义产品质量处理子工作流</span></span></h3>\n<p><strong><strong><span><span>（1）<span>问题评估<span>：</span></span></span></span></strong></strong><span>封装产品质量评估的逻辑，这里仅仅做演示用无实际逻辑。</span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">internal</span> <span style=\"color: rgba(0, 0, 255, 1);\">sealed</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span> ProductEvaluationExecutor() : Executor&lt;ComplaintProcessingRecord, ComplaintProcessingRecord&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(nameof(ProductEvaluationExecutor))\n{\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">override</span> ValueTask&lt;ComplaintProcessingRecord&gt; HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = <span style=\"color: rgba(0, 0, 255, 1);\">default</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    {\n        Console.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">🔍 正在评估产品质量问题...</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        record.ProcessingSteps.Add(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[产品评估] 检测到屏幕外观缺陷，符合质量问题定义</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        record.Handler </span>= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">产品质量团队</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> ValueTask.FromResult(record);\n    }\n}</span></pre>\n</div>\n<p><strong><span><span>（2）<span>退/换货判定<span>：</span></span></span></span></strong><span>负责判定是退货 还是 换货 处理。</span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">internal</span> <span style=\"color: rgba(0, 0, 255, 1);\">sealed</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span> ReturnPolicyExecutor() : Executor&lt;ComplaintProcessingRecord, ComplaintProcessingRecord&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(nameof(ReturnPolicyExecutor))\n{\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">override</span> ValueTask&lt;ComplaintProcessingRecord&gt; HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = <span style=\"color: rgba(0, 0, 255, 1);\">default</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    {\n        Console.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">📦 判定退换货政策...</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> daysFromOrder = (DateTime.Now -<span style=\"color: rgba(0, 0, 0, 1);\"> record.Original.SubmittedAt).Days;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (daysFromOrder &lt;= <span style=\"color: rgba(128, 0, 128, 1);\">7</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n        {\n            record.ProcessingSteps.Add(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[退换货判定] 符合7天无理由退货政策，批准全额退款</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        }\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n        {\n            record.ProcessingSteps.Add(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[退换货判定] 超过退货期限，建议换货或部分补偿</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        }\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> ValueTask.FromResult(record);\n    }\n}</span></pre>\n</div>\n<p><span><strong><strong><span><span>（3）<span>AI回复<span>：</span></span></span></span></strong></strong><span>在投诉内容和判定结果的基础上生成友好的回复返回给用户。</span></span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">internal</span> <span style=\"color: rgba(0, 0, 255, 1);\">sealed</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span> AIResponseGeneratorExecutor(IChatClient chatClient) : Executor&lt;ComplaintProcessingRecord, ComplaintProcessingRecord&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(nameof(AIResponseGeneratorExecutor))\n{\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">override</span> <span style=\"color: rgba(0, 0, 255, 1);\">async</span> ValueTask&lt;ComplaintProcessingRecord&gt; HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = <span style=\"color: rgba(0, 0, 255, 1);\">default</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    {\n        Console.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">🤖 AI 正在生成客户回复...</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> prompt = $<span style=\"color: rgba(128, 0, 0, 1);\">@\"</span><span style=\"color: rgba(128, 0, 0, 1);\">你是专业的客服主管。根据以下投诉处理信息，生成一封正式、有同理心的客户回复邮件（150字内）：\n\n客户：{record.Original.CustomerName}\n订单号：{record.Original.OrderId}\n投诉内容：{record.Original.ComplaintText}\n处理步骤：\n{string.Join(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>\\n<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">, record.ProcessingSteps)}</span>\n<span style=\"color: rgba(0, 0, 0, 1);\">\n要求：\n</span><span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">. 表达歉意和理解\n</span><span style=\"color: rgba(128, 0, 128, 1);\">2</span><span style=\"color: rgba(0, 0, 0, 1);\">. 说明处理方案\n</span><span style=\"color: rgba(128, 0, 128, 1);\">3</span><span style=\"color: rgba(0, 0, 0, 1);\">. 提供后续联系方式\n</span><span style=\"color: rgba(128, 0, 128, 1);\">4</span>. 语气真诚、专业<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">;</span>\n\n        <span style=\"color: rgba(0, 0, 255, 1);\">var</span> response = <span style=\"color: rgba(0, 0, 255, 1);\">await</span><span style=\"color: rgba(0, 0, 0, 1);\"> chatClient.GetResponseAsync(prompt, cancellationToken: cancellationToken);\n        record.AIGeneratedResponse </span>= response.Text ?? <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">AI 生成失败</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        record.ProcessingSteps.Add($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[AI 回复] 已生成客户回复模板（{record.AIGeneratedResponse.Length}字）</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> record;\n    }\n}</span></pre>\n</div>\n<p><span>最后，构建子工作流并将其转换为一个Executor以便后续集成到主工作流中：</span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">var</span> productEvalExecutor = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> ProductEvaluationExecutor();\n</span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> returnPolicyExecutor = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> ReturnPolicyExecutor();\n</span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> aiResponseExecutor = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> AIResponseGeneratorExecutor(chatClient);\n</span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> productQualitySubWorkflow = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> WorkflowBuilder(productEvalExecutor)\n    .AddEdge(productEvalExecutor, returnPolicyExecutor)\n    .AddEdge(returnPolicyExecutor, aiResponseExecutor)\n    .WithOutputFrom(aiResponseExecutor)\n    .Build();\n</span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> productQualitySubExecutor =<span style=\"color: rgba(0, 0, 0, 1);\"> \n  productQualitySubWorkflow.BindAsExecutor(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">ProductQualitySubWorkflow</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>);</pre>\n</div>\n<h3><span><span>2.4 定义物流问题处理子工作流</span></span></h3>\n<p><strong><strong><span><span>（1）<span>物流追踪<span>：</span></span></span></span></strong></strong><span>封装物流查询逻辑，这里仅仅做演示用无实际逻辑。</span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">internal</span> <span style=\"color: rgba(0, 0, 255, 1);\">sealed</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span> LogisticsTrackingExecutor() : Executor&lt;ComplaintProcessingRecord, ComplaintProcessingRecord&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(nameof(LogisticsTrackingExecutor))\n{\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">override</span> ValueTask&lt;ComplaintProcessingRecord&gt; HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = <span style=\"color: rgba(0, 0, 255, 1);\">default</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    {\n        Console.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">🚚 正在查询物流信息...</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        record.ProcessingSteps.Add(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[物流追踪] 包裹在中转站滞留3天，当前状态：运输中</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        record.Handler </span>= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">物流运营团队</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> ValueTask.FromResult(record);\n    }\n}</span></pre>\n</div>\n<p><strong><strong><span><span>（2）<span>延迟分析<span>：</span></span></span></span></strong></strong><span>封装延迟分析逻辑，这里仅仅做演示用无实际逻辑。</span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">internal</span> <span style=\"color: rgba(0, 0, 255, 1);\">sealed</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span> DelayAnalysisExecutor() : Executor&lt;ComplaintProcessingRecord, ComplaintProcessingRecord&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(nameof(DelayAnalysisExecutor))\n{\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">override</span> ValueTask&lt;ComplaintProcessingRecord&gt; HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = <span style=\"color: rgba(0, 0, 255, 1);\">default</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    {\n        Console.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">📊 分析延迟原因...</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        record.ProcessingSteps.Add(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[延迟分析] 延迟原因：暴雨导致道路封闭，预计2天内恢复配送</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        record.ProcessingSteps.Add(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[补偿方案] 提供50元优惠券 + 免运费</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> ValueTask.FromResult(record);\n    }\n}</span></pre>\n</div>\n<p><span>最后，构建子工作流并将其转换为一个Executor以便后续集成到主工作流中：</span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">var</span> logisticsTrackExecutor = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> LogisticsTrackingExecutor();\n</span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> delayAnalysisExecutor = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> DelayAnalysisExecutor();\n</span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> logisticsAIResponseExecutor = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> AIResponseGeneratorExecutor(chatClient);\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> logisticsSubWorkflow = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> WorkflowBuilder(logisticsTrackExecutor)\n    .AddEdge(logisticsTrackExecutor, delayAnalysisExecutor)\n    .AddEdge(delayAnalysisExecutor, logisticsAIResponseExecutor)\n    .WithOutputFrom(logisticsAIResponseExecutor)\n    .Build();\n</span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> logisticsSubExecutor =<span style=\"color: rgba(0, 0, 0, 1);\"> \n  logisticsSubWorkflow.BindAsExecutor(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">LogisticsSubWorkflow</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>);</pre>\n</div>\n<h3><strong><span><span>2.5 构建主工作流</span></span></strong></h3>\n<p>现在开始构建主工作流：</p>\n<p>Step1: 获取ChatClient</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">var</span> chatClient = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> OpenAIClient(\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> ApiKeyCredential(openAIProvider.ApiKey),\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">new</span> OpenAIClientOptions { Endpoint = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> Uri(openAIProvider.Endpoint) })\n    .GetChatClient(openAIProvider.ModelId)\n    .AsIChatClient();</span></pre>\n</div>\n<p>Step2: 创建工单分类<span>Executor,&nbsp;</span>合规审核Executor 以及 情绪评估Executor</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 1. 工单分类执行器</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">internal</span> <span style=\"color: rgba(0, 0, 255, 1);\">sealed</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span> ComplaintClassifierExecutor() : Executor&lt;ComplaintProcessingRecord, ComplaintProcessingRecord&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(nameof(ComplaintClassifierExecutor))\n{\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">override</span> ValueTask&lt;ComplaintProcessingRecord&gt; HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = <span style=\"color: rgba(0, 0, 255, 1);\">default</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    {\n        Console.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">🏷️ 正在分类投诉类型...</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 简单规则分类（实际可用 AI 分类）</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (record.Original.ComplaintText.Contains(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">划痕</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>) || record.Original.ComplaintText.Contains(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">质量</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>) || record.Original.ComplaintText.Contains(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">退货</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n        {\n            record.Category </span>= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">产品质量</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        }\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (record.Original.ComplaintText.Contains(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">延迟</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>) || record.Original.ComplaintText.Contains(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">物流</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>) || record.Original.ComplaintText.Contains(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">配送</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n        {\n            record.Category </span>= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">物流问题</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        }\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n        {\n            record.Category </span>= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">其他</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        }\n        record.ProcessingSteps.Add($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[分类器] 投诉类型识别为：{record.Category}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> ValueTask.FromResult(record);\n    }\n}\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 2. 合规审核执行器</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">internal</span> <span style=\"color: rgba(0, 0, 255, 1);\">sealed</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span> ComplianceCheckExecutor() : Executor&lt;ComplaintProcessingRecord, ComplaintProcessingRecord&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(nameof(ComplianceCheckExecutor))\n{\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">override</span> ValueTask&lt;ComplaintProcessingRecord&gt; HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = <span style=\"color: rgba(0, 0, 255, 1);\">default</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    {\n        Console.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">🛡️ 合规审核中...</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> checks = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (record.AIGeneratedResponse.Contains(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">歉意</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>)) checks.Add(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">✅ 包含道歉</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (record.AIGeneratedResponse.Length &lt;= <span style=\"color: rgba(128, 0, 128, 1);\">300</span>) checks.Add(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">✅ 字数合规</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!record.AIGeneratedResponse.Contains(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">法律</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>) &amp;&amp; !record.AIGeneratedResponse.Contains(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">诉讼</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n            checks.Add(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">✅ 无敏感法律词汇</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n\n        record.ComplianceStatus </span>= checks.Count &gt;= <span style=\"color: rgba(128, 0, 128, 1);\">2</span> ? <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">✅ 审核通过</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> : <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">⚠️ 需人工复审</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        record.ProcessingSteps.Add($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[合规审核] {record.ComplianceStatus} - {string.Join(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">, checks)}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> ValueTask.FromResult(record);\n    }\n}\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 3. 情绪评估执行器（使用 AI）</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">internal</span> <span style=\"color: rgba(0, 0, 255, 1);\">sealed</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span> SentimentAnalysisExecutor(IChatClient chatClient) : Executor&lt;ComplaintProcessingRecord, ComplaintProcessingRecord&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(nameof(SentimentAnalysisExecutor))\n{\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">override</span> <span style=\"color: rgba(0, 0, 255, 1);\">async</span> ValueTask&lt;ComplaintProcessingRecord&gt; HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = <span style=\"color: rgba(0, 0, 255, 1);\">default</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    {\n        Console.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">😊 AI 情绪评估中...</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> prompt = $<span style=\"color: rgba(128, 0, 0, 1);\">@\"</span><span style=\"color: rgba(128, 0, 0, 1);\">分析以下客服回复的情绪基调，用一个词概括（如：友好、专业、冷淡、热情）：\n\n{record.AIGeneratedResponse}\n\n只返回一个词，不要解释。</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> response = <span style=\"color: rgba(0, 0, 255, 1);\">await</span><span style=\"color: rgba(0, 0, 0, 1);\"> chatClient.GetResponseAsync(prompt, cancellationToken: cancellationToken);\n        record.SentimentScore </span>= response.Text?.Trim() ?? <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">中性</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        record.ProcessingSteps.Add($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[情绪评估] AI 评估语气为：{record.SentimentScore}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> record;\n    }\n}</span></pre>\n</div>\n<p>NOTE：前面的子工作流均生成了AI回复，这里需要对其进行合规审核以防止不合规的回复到用户那里。</p>\n<p><span>Step3: 创建主工作流</span></p>\n<p>&nbsp;</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">var</span> classifierExecutor = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> ComplaintClassifierExecutor();\n</span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> complianceExecutor = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> ComplianceCheckExecutor();\n</span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> sentimentExecutor = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> SentimentAnalysisExecutor(chatClient);\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 主工作流：分类 → 条件路由到子流程 → 合规 → 情绪</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">var</span> mainWorkflow = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> WorkflowBuilder(classifierExecutor)\n    .AddEdge</span>&lt;ComplaintProcessingRecord&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(classifierExecutor, productQualitySubExecutor,\n        condition: record </span>=&gt; record.Category == <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">产品质量</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    .AddEdge</span>&lt;ComplaintProcessingRecord&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(classifierExecutor, logisticsSubExecutor,\n        condition: record </span>=&gt; record.Category == <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">物流问题</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    .AddEdge(productQualitySubExecutor, complianceExecutor)\n    .AddEdge(logisticsSubExecutor, complianceExecutor)\n    .AddEdge(complianceExecutor, sentimentExecutor)\n    .WithOutputFrom(sentimentExecutor)\n    .Build();\nConsole.OutputEncoding </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> Encoding.UTF8;\nConsole.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">✅ Main + Sub Workflow 构建完成</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>);</pre>\n</div>\n<h3><span><span>2.6 测试工作流</span></span></h3>\n<p><span><span>定义投诉的工单内容如下：<span><span>这是一个<span>产品质量相关<span>的投诉。</span></span></span></span></span></span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">var</span> processingRecord = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> ComplaintProcessingRecord \n{ \n    Original </span>= <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> CustomerComplaint(\n        OrderId: </span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">ORD-2025-8821</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n        CustomerName: </span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">张先生</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n        ComplaintText: </span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">收到的手机屏幕有明显划痕，要求退货退款</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n        SubmittedAt: DateTime.Now)\n};</span></pre>\n</div>\n<p>通过Streaming流式执行：</p>\n<div class=\"cnblogs_code\">\n<pre>Console.WriteLine(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">🚀 开始执行投诉处理流水线...</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\nConsole.WriteLine(</span><span style=\"color: rgba(0, 0, 255, 1);\">new</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span>(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">━</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>, <span style=\"color: rgba(128, 0, 128, 1);\">60</span><span style=\"color: rgba(0, 0, 0, 1);\">));\n</span><span style=\"color: rgba(0, 0, 255, 1);\">await</span> <span style=\"color: rgba(0, 0, 255, 1);\">using</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> streaming = <span style=\"color: rgba(0, 0, 255, 1);\">await</span><span style=\"color: rgba(0, 0, 0, 1);\"> InProcessExecution.StreamAsync(mainWorkflow, processingRecord))\n{\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">await</span> <span style=\"color: rgba(0, 0, 255, 1);\">foreach</span> (WorkflowEvent evt <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> streaming.WatchStreamAsync())\n    {\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (evt)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> ExecutorInvokedEvent started:\n                Console.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\n🔹 {started.ExecutorId} 开始执行</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span> ExecutorCompletedEvent completed when completed.Data <span style=\"color: rgba(0, 0, 255, 1);\">is</span><span style=\"color: rgba(0, 0, 0, 1);\"> ComplaintProcessingRecord rec:\n                Console.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">   共享状态更新 → 处理步骤数：{rec.ProcessingSteps.Count}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span> WorkflowOutputEvent outputEvt when outputEvt.Data <span style=\"color: rgba(0, 0, 255, 1);\">is</span><span style=\"color: rgba(0, 0, 0, 1);\"> ComplaintProcessingRecord finalRecord:\n                Console.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\n</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> + <span style=\"color: rgba(0, 0, 255, 1);\">new</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span>(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">━</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>, <span style=\"color: rgba(128, 0, 128, 1);\">60</span><span style=\"color: rgba(0, 0, 0, 1);\">));\n                Console.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">🎉 投诉处理完成！最终处理记录:\\n</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                Console.WriteLine(JsonSerializer.Serialize(finalRecord));\n                Console.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\n📝 处理步骤详情：</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">foreach</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> step <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> finalRecord.ProcessingSteps)\n                {\n                    Console.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">  {step}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                }\n\n                Console.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\n💬 AI 生成的客户回复：</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                Console.WriteLine(</span><span style=\"color: rgba(0, 0, 255, 1);\">new</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span>(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">─</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>, <span style=\"color: rgba(128, 0, 128, 1);\">60</span><span style=\"color: rgba(0, 0, 0, 1);\">));\n                Console.WriteLine(finalRecord.AIGeneratedResponse);\n                Console.WriteLine(</span><span style=\"color: rgba(0, 0, 255, 1);\">new</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span>(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">─</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>, <span style=\"color: rgba(128, 0, 128, 1);\">60</span><span style=\"color: rgba(0, 0, 0, 1);\">));\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        }\n    }\n}</span></pre>\n</div>\n<p><span><span>测试结果如下图所示：</span></span></p>\n<p><span><span>首先，可以通过监控日志发现准确地进入到了产品质量子流程：</span></span></p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/381412/202601/381412-20260116201359984-901569605.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></p>\n<p><span>其次，最后由AI生成的回复内容也很友好，同时也满足合规审核的要求：</span></p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/381412/202601/381412-20260116201408277-1480451793.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></p>\n<h1><strong><span>3 小结</span></strong></h1>\n<p>本文介绍了MAF中主工作流 + 子工作流的工作模式，最后通过一个企业客服中心处理投诉工单的案例介绍了这种模式的代码实现。</p>\n<p><span><span>需要注意的是：</span></span></p>\n<ul class=\"list-paddingleft-1\">\n<li><span><span>建议每个子工作流都是用<span><strong>标准统一</strong><span>的状态模型，以便在主工作流中复用 和 传递。</span></span></span></span></li>\n<li><span><span>建议每个子工作流只保持3~4个步骤，<span><strong>单一职责</strong><span>在工作流中同样适用！</span></span></span></span></li>\n</ul>\n<p>下一篇，我们将继续学习MAF中智能体的几种常见编排模式 -&nbsp;顺序，并发 和 移交。</p>\n<h1>示例源码</h1>\n<p>GitHub:&nbsp;<a href=\"https://github.com/EdisonTalk/MAFD\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/EdisonTalk/MAFD</a></p>\n<h1>参考资料</h1>\n<p><span><span>圣杰，《<a href=\"https://www.cnblogs.com/sheng-jie/p/19200934\" target=\"_blank\">.NET + AI 智能体开发进阶</a>》（推荐指数：★★★★★）</span></span></p>\n<p><span><span>Microsoft Learn，<span>《<a href=\"https://learn.microsoft.com/en-us/agent-framework/overview/agent-framework-overview?wt.mc_id=MVP_397012\" rel=\"noopener nofollow\" target=\"_blank\">Agent Framework Tutorials</a>》</span></span></span></p>\n<div><span><span>&nbsp;</span></span></div>\n<p style=\"text-align: center;\"><img alt=\"\" src=\"https://images.cnblogs.com/cnblogs_com/edisonchou/1647700/o_200902144330EdisonTalk-Footer.jpg\" /></p>\n<div id=\"Copyright\">\n<p>作者：<span style=\"text-decoration: underline;\">爱迪生</span></p>\n<p>出处：<a href=\"https://edisontalk.cnblogs.com\" target=\"_blank\" title=\"from\">https://edisontalk.cnblogs.com</a></p>\n<p>本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文链接。</p>\n</div>\n</div>\n<div id=\"MySignature\">\n    <div align=\"center\"><a href=\"https://weibo.com/u/2068032061?s=6uyXnP\" target=\"_blank\"><img border=\"0\" src=\"http://service.t.sina.com.cn/widget/qmd/2068032061/d643d182/10.png\" /></a></div>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-19 18:30</span>&nbsp;\n<a href=\"https://www.cnblogs.com/edisontalk\">EdisonZhou</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "OpenSpec 功能详解：5 分钟搞懂 AI 编程的\"规范驱动\"核心",
      "link": "https://www.cnblogs.com/zh94/p/19503921",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/zh94/p/19503921\" id=\"cb_post_title_url\" title=\"发布于 2026-01-19 22:41\">\n    <span>OpenSpec 功能详解：5 分钟搞懂 AI 编程的\"规范驱动\"核心</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>为什么有时候让 AI 发起提案\"时灵时不灵\"？</p>\n<p>前两天有朋友看了我写的<a href=\"https://mp.weixin.qq.com/s/CJPCsYoQOo5Ib1Q8f0IZBA\" rel=\"noopener nofollow\" target=\"_blank\">《如何用 AI + OpenSpec 驱动团队迭代开发》</a>后，问我一个很有趣的问题：</p>\n<p>\"为什么有时候我让 AI 发起 OpenSpec 提案，时灵时不灵？\"</p>\n<p>其实这个问题很简单，答案就藏在 OpenSpec 的工作原理中。</p>\n<p>今天这篇文章，5 分钟的时间帮你快速了解 OpenSpec 的核心原理——它究竟是如何让 AI\"听话\"地按照规范来工作的。</p>\n<h2 id=\"2-快速认识-openspec\">2 快速认识 OpenSpec</h2>\n<p>OpenSpec 是一个规范驱动开发工具，核心理念极其简单：</p>\n<p>“让 AI 明确知道\"知识在哪、如何用、为什么这样做”</p>\n<p>官网：<a href=\"https://openspec.dev/\" rel=\"noopener nofollow\" target=\"_blank\">https://openspec.dev/</a></p>\n<h3 id=\"21-安装与初始化\">2.1 安装与初始化</h3>\n<pre><code class=\"language-bash\"># 全局安装 OpenSpec\nnpm install -g @fission-ai/openspec@latest\n# 在项目目录下初始化\ncd /path/to/your-project\nopenspec init\n</code></pre>\n<p>初始化时，OpenSpec 会提示你选择使用的 AI 工具（Claude Code、Cursor、Trae、Qoder 等）。</p>\n<h2 id=\"3-openspec-如何教ai-工作\">3 OpenSpec 如何\"教\"AI 工作？</h2>\n<p>OpenSpec 的核心机制，是通过一套规范注入系统，让 AI 在每次对话前先\"学习\"项目规范。</p>\n<h3 id=\"31-不同-ai-工具的初始化差异\">3.1 不同 AI 工具的初始化差异</h3>\n<p>根据你使用的 AI 工具不同，OpenSpec 会生成不同的目录结构。这背后的设计理念是：最大限度地适配各工具的特性。</p>\n<h3 id=\"32--场景-1claude-code\">3.2 📍 场景 1：Claude Code</h3>\n<p>Claude Code 在执行了 OpenSpec Init 后的目录结构如下：</p>\n<pre><code>.claude/\n├── commands/\n│   └── openspec/      \n│       ├── apply.md   \n│       ├── archive.md \n│       └── proposal.md\n├── AGENTS.md          \n└── CLAUDE.md          \n</code></pre>\n<p>commands/openspec 这个目录定义了三个不同的命令，每个命令文件中所写的提示词，都是 AI 在执行该命令时需要参考的\"规范\"。上述三个命令分别是：</p>\n<ul>\n<li>apply.md：表示执行已批准的变更</li>\n<li>archive.md：归档已完成的变更</li>\n<li>proposal.md：发起新变更提案</li>\n</ul>\n<p>当我们需要发起新的提案时，可以直接使用：<code>/openspec:proposal</code> 就可以触发该指令，此时 AI 就会根据 proposal.md 中所定义的规范，来创建一个新的变更提案。</p>\n<p><strong>核心文件解读：AGENTS.md</strong></p>\n<p>这个文件是 Claude Code 每次对话时的\"第一课\"，内容如下：</p>\n<pre><code>&lt;!-- OPENSPEC:START --&gt;\n# OpenSpec 说明\n这些指令是针对参与本项目的人工智能助手。\n当请求中包含以下内容时，请务必打开 `@/openspec/AGENTS.md`：\n- 提及规划或提案（如提案、规范、变更、计划等字眼）\n- 引入新功能、重大变更、架构调整或重大的性能/安全工作\n- 听起来含糊不清，且在编码前需要权威规范\n使用 `@/openspec/AGENTS.md` 来学习：\n- 如何创建和应用变更提案\n- 规范格式和约定\n- 项目结构和指南\n保留此托管块，以便\"openspec update\"可以刷新指令。\n&lt;!-- OPENSPEC:END --&gt;\n</code></pre>\n<p><strong>工作原理：</strong></p>\n<ol>\n<li>Claude Code 启动时自动读取 AGENTS.md</li>\n<li>判断用户请求是否触\"提案/变更\"等关键词</li>\n<li>如果触发，自动加载 openspec/AGENTS.md 中的详细规范</li>\n<li>AI 按照规范执行任务</li>\n</ol>\n<h3 id=\"33--场景-2trae字节跳动\">3.3 📍 场景 2：Trae（字节跳动）</h3>\n<p>OpenSpec 在初始化时可选择的AI 工具中是不支持 Trae 的，但是很多朋友是基于 Trae 在开发。</p>\n<p>所以对于使用 Trae 的朋友，我们在执行 OpenSpec Init 的时候，可以选择最后一个选项 Other Tools (适用于 VsCode 等）</p>\n<p>此时初始化后的目录结构如下：</p>\n<pre><code>项目根目录/\n├── AGENT.md           # 项目级规范（需手动配置）\n└── openspec/\n    ├── AGENTS.md      # OpenSpec 详细规范\n    ├── project.md     # 项目知识库\n    ├── specs/         # 已实现能力规范\n    └── changes/       # 变更提案\n</code></pre>\n<p><strong>关键差异：需要手动配置</strong></p>\n<p>与 Claude Code 不同，老版本的 Trae 不会自动读取 AGENT.md。此时你需要手动将规范内容添加到 Trae 的\"项目规则\"中。</p>\n<p>但是对于Trae 2026 年 1 月份最新的一次版本变更中，也已经兼容了读取 AGENT.md 文件作为项目规则来使用。</p>\n<p>所以使用老版本 Trae 的朋友需要基于下述步骤进行配置：</p>\n<ol>\n<li>打开 Trae 的项目设置</li>\n<li>找到\"项目规则\"配置</li>\n<li>将 AGENT.md 的内容粘贴进去</li>\n<li>保存后，Trae 每次对话都会加载该规则</li>\n</ol>\n<p>配置完成后，Trae 的工作流程与 Claude Code 类似：</p>\n<ol>\n<li>每次对话自动加载项目规则</li>\n<li>判断是否触发 OpenSpec 规范</li>\n<li>根据规范执行对应任务</li>\n</ol>\n<h2 id=\"3-openspec-规范核心要点\">3 OpenSpec 规范核心要点</h2>\n<p>无论使用哪种 AI 工具，OpenSpec 的核心工作流都是一致的。理解这套规范，你就能更好地与 AI 协作。</p>\n<p><strong>三阶段工作流：</strong></p>\n<pre><code>阶段1：创建变更（Proposal）\n    ↓\n阶段2：实现变更（Apply）\n    ↓\n阶段3：归档变更（Archive）\n</code></pre>\n<p><strong>何时必须创建提案？</strong></p>\n<table>\n<thead>\n<tr>\n<th>场景</th>\n<th>是否需要提案</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>新增功能或能力</td>\n<td>✅ 必须</td>\n</tr>\n<tr>\n<td>破坏性变更（API/Schema）</td>\n<td>✅ 必须</td>\n</tr>\n<tr>\n<td>架构或模式调整</td>\n<td>✅ 必须</td>\n</tr>\n<tr>\n<td>Bug 修复（恢复既有行为）</td>\n<td>❌ 跳过</td>\n</tr>\n<tr>\n<td>拼写、格式、注释修正</td>\n<td>❌ 跳过</td>\n</tr>\n<tr>\n<td>非破坏性依赖升级</td>\n<td>❌ 跳过</td>\n</tr>\n</tbody>\n</table>\n<p><strong>常用命令：</strong></p>\n<pre><code class=\"language-bash\">openspec list              # 列出所有变更\nopenspec list --specs      # 列出所有规范\nopenspec validate &lt;id&gt;     # 校验变更\nopenspec archive &lt;id&gt;      # 归档变更\n</code></pre>\n<p>💡 小贴士：作为人类开发者，你无需记忆这些命令。AI 会自动执行相应的操作来检查和管理变更提案。你只需要理解这套规范的工作流程，就能与 AI 配合无间。</p>\n<p><strong>openspec/project.md 的作用</strong></p>\n<p>这个文件是项目的\"知识库\"，用于存放：</p>\n<ul>\n<li>项目目标和背景</li>\n<li>核心业务术语</li>\n<li>技术栈说明</li>\n<li>详细文档索引</li>\n</ul>\n<h2 id=\"4-常见问题解答\">4 常见问题解答</h2>\n<h3 id=\"41-q1为什么有时候-ai-不触发-openspec-规范\">4.1 Q1：为什么有时候 AI 不触发 OpenSpec 规范？</h3>\n<p>A：这通常是因为触发条件未被满足。</p>\n<p>OpenSpec 的触发机制基于关键词匹配（如\"提案\"、\"变更\"、\"规范\"等）。如果你的请求不包含这些关键词，AI 则不会加载 OpenSpec 规范。</p>\n<p><strong>解决方案：</strong></p>\n<ol>\n<li>明确使用触发词：\"帮我创建一个变更提案\"</li>\n<li>直接指定文件：\"先阅读 openspec/project.md 再回答\"</li>\n<li>使用斜杠命令：<code>/openspec:proposal</code>（如果工具支持）</li>\n</ol>\n<h3 id=\"52-q2projectmd-中的业务知识什么时候生效\">5.2 Q2：project.md 中的业务知识什么时候生效？</h3>\n<p>A：只有触发 OpenSpec 规范后才会读取。</p>\n<p>这是一个重要的设计权衡：</p>\n<table>\n<thead>\n<tr>\n<th>知识类型</th>\n<th>存放位置</th>\n<th>触发条件</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>通用开发规范</td>\n<td>/AGENTS.md</td>\n<td>每次对话自动加载</td>\n</tr>\n<tr>\n<td>OpenSpec 工作流</td>\n<td>openspec/AGENTS.md</td>\n<td>触发关键词后加载</td>\n</tr>\n<tr>\n<td>业务上下文</td>\n<td>openspec/project.md</td>\n<td>通过规范索引间接加载</td>\n</tr>\n</tbody>\n</table>\n<p><strong>实践建议：</strong></p>\n<ul>\n<li>将通用规则（如项目结构、编码风格）放在 /AGENTS.md 中</li>\n<li>将业务知识索引也写在 /AGENTS.md 中，便于日常对话触发</li>\n<li>或者在对话中明确要求 AI 先阅读特定文档</li>\n</ul>\n<h3 id=\"53-q3如何让-ai-自动检索相关背景知识\">5.3 Q3：如何让 AI 自动检索相关背景知识？</h3>\n<p>A：这是 OpenSpec 的进化方向。</p>\n<p>目前最佳实践是：</p>\n<ol>\n<li>在 /AGENTS.md 中建立业务知识索引</li>\n<li>采用提案方式讨论业务逻辑（自动触发规范）</li>\n<li>对话中明确指定：\"先阅读 docs/xxx.md 再回答\"</li>\n</ol>\n<h2 id=\"6-五总结openspec-的核心价值\">6 五、总结：OpenSpec 的核心价值</h2>\n<p>回到开篇的问题：为什么有时候让 AI 发起提案\"时灵时不灵\"？</p>\n<p>答案现在很清楚了：</p>\n<ol>\n<li><strong>触发机制</strong>：AI 需要识别到特定关键词才会加载 OpenSpec 规范</li>\n<li><strong>工具差异</strong>：不同 AI 工具对规范文件的支持程度不同</li>\n<li><strong>知识分层</strong>：业务知识与开发规范需要合理分层存放</li>\n</ol>\n<p>OpenSpec 的核心价值在于：通过\"规范注入\"让 AI 从\"项目小白\"成长为\"熟悉业务的开发伙伴\"。</p>\n<p>它不是银弹，但当你理解了它的工作原理后，就能让 AI 在团队协作中发挥真正的作用。</p>\n<p>当然，在有需要的时候，我们也可以修改 OpenSpec 初始化时所生成的一系列.md文件，直接变更规范，使其更加符合企业内的业务流程。</p>\n<h2 id=\"欢迎日常交流\">欢迎日常交流</h2>\n<p>AI 驱动团队开发是这个时代的新命题，欢迎大家加微信互相交流心得。</p>\n<p>👉 想要进群的朋友，扫码时备注 “AI实验群”，看到消息后会第一时间拉你进群。</p>\n<p>群定位：AI工具提效/实战经验互助</p>\n<p>群规则：不水群、不广告、干货优先</p>\n<p>欢迎访问该链接获取群信息：<a href=\"https://zhaozhihao.com/archives/KRMxDLo4\" rel=\"noopener nofollow\" target=\"_blank\">https://zhaozhihao.com/archives/KRMxDLo4</a></p>\n<p>好文章值得被更多人看见！既然看到这里了，随手点个赞👍和关注，并转发给更多的朋友吧！感谢。</p>\n<blockquote>\n<p>作者：数字生命贾克斯、微信：x_h886688</p>\n</blockquote>\n<p>公众号原文地址：<a href=\"https://mp.weixin.qq.com/s/wyUdxh2T_M30YfAPlv0QSQ\" rel=\"noopener nofollow\" target=\"_blank\">OpenSpec 功能详解：5 分钟搞懂 AI 编程的\"规范驱动\"核心</a></p>\n\n</div>\n<div id=\"MySignature\">\n    <br />\n<fieldset style=\"padding: 10px; margin: 10px; background-color: #fff; width: 850px; border: 1px solid black; font-size: blod;\">\n<p><span style=\"color: black;\">版权声明</span></p>\n<hr style=\"color: black;\" />\n<p><span style=\"color: black;\">作者：陈咬金</span></p>\n<p><span style=\"color: black;\">出处：</span><a href=\"https://www.cnblogs.com/zh94/\" style=\"color: black;\" target=\"_blank\">陈咬金的技术博客--https://www.cnblogs.com/zh94/</a></p>\n<p><span style=\"color: black;\">您的支持是对博主最大的鼓励，感谢您的认真阅读。</span></p>\n<p><span style=\"color: black;\">本文版权归作者所有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留任何追究法律责任的权利。</span></p>\n</fieldset>\n\n<div style=\"padding: 10px; margin: 10px; background-color: #fff; width: 850px; border: 0px solid black; font-size: blod;\">\n     <img src=\"https://images.cnblogs.com/cnblogs_com/zh94/1586631/o_211225012748_weixin_saoma.png\" />&nbsp;&nbsp;&nbsp;&nbsp;<img src=\"https://images.cnblogs.com/cnblogs_com/zh94/1586631/o_211225012748_weixin_saoma.png\" />\n</div>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-19 22:41</span>&nbsp;\n<a href=\"https://www.cnblogs.com/zh94\">陈咬金</a>&nbsp;\n阅读(<span id=\"post_view_count\">7</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "痞子衡嵌入式：如果你在找针对i.MX RT系列的OTA参考设计，可以持续关注Tiny OTA",
      "link": "https://www.cnblogs.com/henjay724/p/19503837",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/henjay724/p/19503837\" id=\"cb_post_title_url\" title=\"发布于 2026-01-19 21:56\">\n    <span>痞子衡嵌入式：如果你在找针对i.MX RT系列的OTA参考设计，可以持续关注Tiny OTA</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<hr />\n<p>　　Tiny OTA 是一个针对 i.MX RT 系列的 OTA 参考设计，其包含 MCU 端固件（tota_sbl 和 tota_app）和 PC 端 GUI 工具（MCU-TinyOtaUtility）两部分。</p>\n<p><img alt=\"\" src=\"https://raw.githubusercontent.com/JayHeng/MCU-TinyOtaUtility/main/doc/v1.0/block_diagram.png\" /></p>\n<p>　　tota_sbl 是示例 bootloader 程序，其由 MCU ROM 引导启动，该程序负责检查 OTA 标志、校验两个 Slot 位置的 tota_app 完整性并选择高版本跳转执行，其也支持通过 blhost 协议与上位机通信以更新 tota_app。</p>\n<p>　　tota_app 是示例 application 程序，其就是一个基于 SDK hello world XIP 工程的模板，用户可以基于此模板开发自己的应用。无论 Slot 0 还是 Slot 1 位置的 application 均共享同一个链接文件（即永远被搬移到 Slot 0 位置处运行）。</p>\n<p>　　MCU-TinyOtaUtility 是基于 PyQT5 的上位机工具，其支持 tota_sbl 和 tota_app 的加 OTA 头操作，还能与 MCU ROM 进行通信以实现 tota_sbl 和 tota_app 的烧写，同时也支持对 Flash 进行一般读写擦操作。</p>\n<h3 id=\"一特性概述\">一、特性概述</h3>\n<p>Tiny OTA 工具：</p>\n<pre><code class=\"language-text\">1. 支持i.MXRT117x\n2. 支持i.MXRT118x\n3. 支持NOR Flash一般读写擦操作\n4. 支持UART&amp;USB blhost协议与MCU ROM通信\n5. 支持bootloader程序加头(slot0,1 app start, Magic)与下载\n6. 支持application程序加头(Len, CRC32, Version, Magic)与下载\n</code></pre>\n<p>Tiny OTA 固件：</p>\n<pre><code class=\"language-text\">1. 支持i.MXRT117x\n2. 支持i.MXRT118x\n4. 支持主核示例程序（对于双核MCU而言）\n4. BL: 仅支持FlexSPI1 XIP application程序管理 (永远从slot 0位置启动)\n5. BL: 支持CRC32-MPEG2校验以判断application完整性\n6. BL: 复用软件reliable update流程(来自于Kinetis Bootloader)\n7. BL: 5秒超时内通过UART&amp;USB blhost与上位机通信，否则跳转进application执行\n</code></pre>\n<h3 id=\"二mcu端固件\">二、MCU端固件</h3>\n<pre><code class=\"language-text\">固件地址 https://github.com/JayHeng/imxrt-tiny-ota-fw/archive/refs/tags/v1.0.zip\nIDE版本：IAR EWARM v9.70.1\n</code></pre>\n<h4 id=\"21-tota_app\">2.1 tota_app</h4>\n<p>　　使用 IAR 打开 \\imxrt-tiny-ota-fw\\targets\\imxrt1180\\apps\\tota_app\\cm33 工程（基于SDK hello world XIP 工程），切换到 flex_nor_debug target（工程选项里已经设置了 XIP_BOOT_HEADER_ENABLE=0，即生成的 binary 就是裸的 ARM 程序），当前在其链接文件里设定 ARM 程序起始地址在 FlexSPI1 Flash 的 0x28080000 处，编译生成 tota_app_cm33.bin（bin 起始地址就是 0x28080000），用户可根据需要修改 tota_app 工程链接文件里的 app_image_offset 值。</p>\n<pre><code class=\"language-text\">define symbol m_flash_start            = 0x28000000;\ndefine symbol app_image_offset         = 0x00080000;\ndefine symbol m_text_start             = m_flash_start + app_image_offset;\n</code></pre>\n<p><img alt=\"\" src=\"https://raw.githubusercontent.com/JayHeng/MCU-TinyOtaUtility/main/doc/v1.0/rt1180_tota_app_proj.png\" /></p>\n<p>　　有了 tota_app_cm33.bin 之后，后续再通过 MCU-TinyOtaUtility 工具加上 OTA 头（包含 Length、CRC32、Version、Magic）并将其烧写到 Flash Slot0 或者 Slot1 位置（注意 Slot 0 对应偏移应与 app_image_offset 一致），OTA 信息位置复用了 ARM Vector Table 里保留的如下几个 Vector。</p>\n<p><img alt=\"\" src=\"https://raw.githubusercontent.com/JayHeng/MCU-TinyOtaUtility/main/doc/v1.0/app_image_header.png\" /></p>\n<h4 id=\"22-tota_sbl\">2.2 tota_sbl</h4>\n<p>　　使用 IAR 打开 \\imxrt-tiny-ota-fw\\targets\\imxrt1180\\apps\\tota_sbl\\cm33 工程（基于SDK flashloader 工程，但是对工程做了一些改动，增加了 ROM boot header，链接文件也从 RAM target 改成了标准 XIP target，此外还使能了黑科技，即利用 IDE 特性将除了 init_data_bss 代码之外的 RO 段全部搬移到 RAM 执行，这样方便运行后续因 application 搬移需要的 Flash 擦写操作），当前在其链接文件里设定 ARM 程序起始地址在 FlexSPI1 Flash 的 0x2800B000 处，编译生成 tota_sbl_cm33.bin（注意 bin 起始地址是 0x28000400，因为包含 fcb 等启动头），一般来说我们无需修改 tota_sbl 工程链接文件。</p>\n<pre><code class=\"language-text\">define symbol m_flash_start            = 0x28000000;\ndefine symbol app_image_offset         = 0x0000B000;\ndefine symbol m_text_start             = m_flash_start + app_image_offset;\n\ndefine symbol m_fcb_offset             = 0x400;\ndefine symbol m_fcb_start              = m_flash_start + m_fcb_offset;\n\ndefine symbol m_interrupts_ram_start   = 0x304A0000;\n</code></pre>\n<p>　　因为 RT1180 独特的 TRDC 权限管理，在 tota_sbl 工程配套的 container 里的 image_entry.size 长度需要覆盖从 Flash 起始地址一直覆盖到 Slot 0 全部空间，否则会影响 ROM 跳转至 tota_sbl 以及 tota_sbl 跳转到 tota_app 执行。这一点后续可改进为在 tota_sbl 里设置 TRDC 权限来解决 tota_app 跳转权限问题，这样可以减小 container 里的 image_entry.size 长度（仅需覆盖 tota_sbl 空间即可）。</p>\n<p><img alt=\"\" src=\"https://raw.githubusercontent.com/JayHeng/MCU-TinyOtaUtility/main/doc/v1.0/rt1180_tota_sbl_proj.png\" /></p>\n<p>　　有了 tota_sbl_cm33.bin 之后，后续再通过 MCU-TinyOtaUtility 工具加上 OTA 头（包含 slot0,1 app start, Magic）并将其烧写到 Flash 起始位置（从 fcb 位置开始），OTA 信息位置依然复用了 ARM Vector Table 里保留的如下几个 Vector。这里的 app load addr 参数功能暂时还未实现，后续可用于拓展支持灵活的 application 加载地址配置。</p>\n<p><img alt=\"\" src=\"https://raw.githubusercontent.com/JayHeng/MCU-TinyOtaUtility/main/doc/v1.0/sbl_image_header.png\" /></p>\n<p>　　当 Flash Slot 0,1 处分别有了可用的 application，为了调试方便，我们也可以直接手动修改 tota_sbl 工程的 startup 文件里的如下参数值，这样可以直接在线下载调试 tota_sbl 工程，无需通过上位机工具来添加 OTA 头以及烧写。</p>\n<p><img alt=\"\" src=\"https://raw.githubusercontent.com/JayHeng/MCU-TinyOtaUtility/main/doc/v1.0/rt1180_tota_sbl_proj2.png\" /></p>\n<h4 id=\"23-sbl里reliable-update流程\">2.3 SBL里Reliable Update流程</h4>\n<p>　　当 SBL 里 OTA 头 Magic 校验通过，且 slot 0,1 地址有效时，SBL 会执行 Reliable Update 流程。</p>\n<pre><code class=\"language-text\">1. 如果 slot 0,1 程序均无效（无 Magic 或者 CRC 校验失败），直接进入 ISP 模式等待上位机下载\n2. 如果 slot 0 程序有效，slot 1 程序无效，5s 超时后跳转至 slot 0 程序执行\n3. 如果 slot 0 程序无效，slot 1 程序有效，将 slot 1 程序拷贝至 slot 0 位置，5s 超时后跳转至 slot 0 程序执行\n4. 如果 slot 0,1 程序均有效，判断两者的程序版本：\n  - 如果 slot 0 版本不低于 slot 1 版本，5s 超时后跳转至 slot 0 程序执行\n  - 如果 slot 0 版本低于 slot 1 版本，将 slot 1 程序拷贝至 slot 0 位置，5s 超时后跳转至 slot 0 程序执行\n</code></pre>\n<h3 id=\"三pc端gui工具\">三、PC端GUI工具</h3>\n<pre><code class=\"language-text\">工具地址 https://github.com/JayHeng/MCU-TinyOtaUtility/archive/refs/tags/v1.0.zip\n</code></pre>\n<h4 id=\"31-建立连接\">3.1 建立连接</h4>\n<p>　　双击 \\MCU-TinyOtaUtility\\bin\\MCU-TinyOtaUtility.exe 打开工具，根据目标板 Flash 连接情况做相应设置，将 RT1180-EVK 开发板启动模式设置为 ISP 模式，然后连接上 UART 或者 USB cable，点击 'Connect' 按钮可在左下角信息框里看到连接信息。</p>\n<p><img alt=\"\" src=\"https://raw.githubusercontent.com/JayHeng/MCU-TinyOtaUtility/main/doc/v1.0/tool_connect.png\" /></p>\n<h4 id=\"32-ota下载\">3.2 OTA下载</h4>\n<p>　　准备好了 tota_sbl_cm33.bin 以及 tota_app_cm33.bin 之后，可先点击界面篮圈指示里 'Stage1 BL File', 'Slot0/1 App File' 按钮分别指向对应的路径，这里 Slot0/1 可用同一个 application binary 文件。然后设置红框里的 'start' 以及 'version' 参数，这里 Stage1 BL 对应的偏移 0x400，以及 Slot0 App 对应的偏移 0x80000 应与对应工程链接文件设置匹配，而 Slot1 App 对应的偏移位置可自由设置；至于 Version 设置，目前最大支持 V255.255 即 2bytes 存储。设置好了之后，最后点击 'All In One' 按钮即可完成三个文件的 OTA 头添加以及下载（也可分步操作）。</p>\n<p><img alt=\"\" src=\"https://raw.githubusercontent.com/JayHeng/MCU-TinyOtaUtility/main/doc/v1.0/tool_ota.png\" /></p>\n<p>　　下载完成之后将 RT1180-EVK 开发板启动模式设置为 Flash Boot 模式，打开串口调试助手可看如下打印信息，这里设置的 slot 1 版本高于 slot 0，所以我们看到 sbl 将 slot 1 app 拷贝到了 slot 0 位置并跳转执行。</p>\n<p><img alt=\"\" src=\"https://raw.githubusercontent.com/JayHeng/MCU-TinyOtaUtility/main/doc/v1.0/ota_res.png\" /></p>\n<h4 id=\"33-一般flash操作\">3.3 一般Flash操作</h4>\n<p>　　成功建立连接之后，可对 Flash 指定范围进行一般读写擦操作，注意当前写操作仅支持 binary 文件格式（.bin）。</p>\n<p><img alt=\"\" src=\"https://raw.githubusercontent.com/JayHeng/MCU-TinyOtaUtility/main/doc/v1.0/tool_flash_ewr.png\" /></p>\n\n</div>\n<div id=\"MySignature\">\n    <div class=\"autograph\"> \n  <p>&nbsp;&nbsp;最后欢迎关注痞子衡个人微信公众号【痞子衡嵌入式】，一个专注嵌入式技术的公众号，跟着痞子衡一起玩转嵌入式。</p>\n\n  <img alt=\"痞子衡嵌入式-微信二维码\" class=\"img_avatar\" src=\"https://img2022.cnblogs.com/blog/623659/202211/623659-20221116165755872-427238307.jpg\" style=\"float: left;\" />\n\n  <img alt=\"痞子衡嵌入式-微信收款二维码\" class=\"img_avatar\" src=\"http://henjay724.com/image/cnblogs/baogeMcu_payment_wechat_150x150.png\" style=\"float: right;\" />\n\n  <img alt=\"痞子衡嵌入式-支付宝收款二维码\" class=\"img_avatar\" src=\"http://henjay724.com/image/cnblogs/baogeMcu_payment_alipay_150x150.jpg\" style=\"float: right;\" />\n\n<br />\n  <p>&nbsp;&nbsp;衡杰(痞子衡)，目前就职于恩智浦(NXP)半导体MCU系统应用部门，担任高级嵌入式系统应用工程师。</p>\n\n  <p>&nbsp;&nbsp;专栏内所有文章的转载请注明出处：<a href=\"http://www.cnblogs.com/henjay724/\" target=\"_blank\">http://www.cnblogs.com/henjay724/</a></p>\n\n  <p>&nbsp;&nbsp;与痞子衡进一步交流或咨询业务合作请发邮件至 <a href=\"hengjie1989@foxmail.com\" target=\"_blank\">hengjie1989@foxmail.com</a></p>\n\n  <p>&nbsp;&nbsp;可以关注痞子衡的Github主页 <a href=\"https://github.com/JayHeng\" target=\"_blank\">https://github.com/JayHeng</a>，有很多好玩的嵌入式项目。</p>\n\n  <p><font color=\"yellow\">&nbsp;&nbsp;关于专栏文章有任何疑问请直接在博客下面留言，痞子衡会及时回复免费(划重点)答疑。</font></p>\n\n  <p><font color=\"red\">&nbsp;&nbsp;痞子衡邮箱已被私信挤爆，技术问题不推荐私信，坚持私信请先扫码付款(5元起步)再发。</font></p>\n<br />\n</div>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-19 21:56</span>&nbsp;\n<a href=\"https://www.cnblogs.com/henjay724\">痞子衡</a>&nbsp;\n阅读(<span id=\"post_view_count\">4</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    }
  ]
}