{
  "title": "ä¸»é¡µ - åšå®¢å›­",
  "link": "https://www.cnblogs.com/",
  "description": "ä¸»é¡µ - åšå®¢å›­ RSS",
  "entries": [
    {
      "title": "C++å°ç™½è®­ç»ƒç¬¬åä¸‰å¤©",
      "link": "https://www.cnblogs.com/godjian/p/19594585",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/godjian/p/19594585\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-09 12:13\">\n    <span>C++å°ç™½è®­ç»ƒç¬¬åä¸‰å¤©</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h2 id=\"cå°ç™½è®­ç»ƒç¬¬åä¸‰å¤©\">C++å°ç™½è®­ç»ƒç¬¬åä¸‰å¤©</h2>\n<p>ä»¥ä¸‹ä¸ºç‰›å®¢æŒ‘æˆ˜</p>\n<h2 id=\"ä»Šæ—¥æ”¶è·\">ä»Šæ—¥æ”¶è·</h2>\n<pre><code> vector&lt;pair&lt;int,int&gt;&gt;v;ç”¨äºå­˜å‚¨åæ ‡ï¼Œå¦‚æœåæ ‡ï¼š\n æ–¹å¼ï¼šv.push_back({i,j}),v.emplace_back(i,j);\n \n v.push_back(make_pair(i, j));\n\ndpè”æƒ³çš„åˆä¸€ä¸ªæ¡ä»¶ï¼Œå°±æ˜¯å› ä¸ºé™åˆ¶åªå­˜åœ¨ä¸ç›¸é‚»ï¼Œé‚£å°±å’Œåé¢æ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥è€ƒè™‘dp\n\n\nç†è§£äº†ç½®æ¢ç¯ï¼šn-ç¯æ•°ç­‰äºæ“ä½œæ•°ã€‚\n</code></pre>\n<h2 id=\"ç‰›å®¢å‘¨èµ›-round-130\">ç‰›å®¢å‘¨èµ› Round 130</h2>\n<h3 id=\"çº¢ç¾é“ƒçš„è®¿å®¢ç™»è®°\">çº¢ç¾é“ƒçš„è®¿å®¢ç™»è®°</h3>\n<p><a href=\"https://ac.nowcoder.com/acm/contest/127702/A\" rel=\"noopener nofollow\" target=\"_blank\">A-çº¢ç¾é“ƒçš„è®¿å®¢ç™»è®°_ç‰›å®¢å‘¨èµ› Round 130 (nowcoder.com)</a></p>\n<p><img alt=\"image-20260209082136953\" src=\"https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121302221-750510719.png\" /></p>\n<h4 id=\"è§£é¢˜ä»£ç \">è§£é¢˜ä»£ç </h4>\n<pre><code class=\"language-c++\">#include&lt;bits/stdc++.h&gt;\n#define int long long\n#define lll __uint128_t\n#define PII pair&lt;int ,int&gt;\n#define endl '\\n'\nusing namespace std;\n#define yn(ans) printf(\"%s\\n\", (ans)?\"Yes\":\"No\");//å¿«é€Ÿæ‰“å°\n#define YN(ans) printf(\"%s\\n\", (ans)?\"YES\":\"NO\");\n#define REP(i, e) for (int i = 0; i &lt; (e); ++i)\n#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)\n#define TESTS int t; cin &gt;&gt; t; while (t--)\n#define TEST\nconst int N=2e5+10,M=1e3+10,mod=1e9+7;\nint a[N],b[N],c[N],pre[N];\n\nsigned main(){\n\n\tstd::ios::sync_with_stdio(false);\n    cin.tie(0);\n    cout.tie(0);\n    string s;\n    cin&gt;&gt;s;\n    int count=0;\n    for(int i=0;i&lt;s.size();i++){\n        if(s[i]!='0'){\n            count=i;\n            break;\n        }\n    }\n    for(int i=count;i&lt;s.size();i++){\n        cout&lt;&lt;s[i];\n    }\n    \n\n\treturn 0;\n}\n</code></pre>\n<h3 id=\"çˆ±ä¸½ä¸çš„é­”åŠ›é›¶ä»¶åˆ†ç±»\">çˆ±ä¸½ä¸çš„é­”åŠ›é›¶ä»¶åˆ†ç±»</h3>\n<p><a href=\"https://ac.nowcoder.com/acm/contest/127702/B\" rel=\"noopener nofollow\" target=\"_blank\">B-çˆ±ä¸½ä¸çš„é­”åŠ›é›¶ä»¶åˆ†ç±»_ç‰›å®¢å‘¨èµ› Round 130 (nowcoder.com)</a></p>\n<p><img alt=\"image-20260209084218695\" src=\"https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121303147-1985436397.png\" /></p>\n<pre><code>3\n5\n.....\n.....\n.***.\n..*..\n.....\n5\n.....\n..*..\n..*..\n.**..\n.....\n6\n......\n..*...\n.**...\n..*...\n......\n......\n</code></pre>\n<pre><code>T\nL\nT\n</code></pre>\n<p><strong>é¢˜è§£</strong></p>\n<h4 id=\"è§£é¢˜ä»£ç -1\">è§£é¢˜ä»£ç </h4>\n<p>å¯ä»¥å…ˆæŠŠè¿™äº›ä¸º*çš„ç‚¹å…ˆå­˜èµ·æ¥ï¼Œç„¶åå»åˆ¤æ–­ä»–ä»¬çš„åº¦æ•°åŒé‡å¾ªç¯ï¼Œæ¥åˆ¤æ–­ï¼Œå½“æˆ‘ä»¬å‘ç°æœ€å¤šåº¦æ•°ä¸º3çš„æ—¶å€™å°±å°±æ˜¯tï¼Œå…¶ä»–çš„å°±ä¸æ˜¯tï¼Œæ˜¯l</p>\n<pre><code class=\"language-c++\">#include&lt;bits/stdc++.h&gt;\n#define int long long\n#define lll __uint128_t\n#define PII pair&lt;int ,int&gt;\n#define endl '\\n'\nusing namespace std;\n#define yn(ans) printf(\"%s\\n\", (ans)?\"Yes\":\"No\");//å¿«é€Ÿæ‰“å°\n#define YN(ans) printf(\"%s\\n\", (ans)?\"YES\":\"NO\");\n#define REP(i, e) for (int i = 0; i &lt; (e); ++i)\n#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)\n#define TESTS int t; cin &gt;&gt; t; while (t--)\n#define TEST\nconst int N=2e5+10,M=1e3+10,mod=1e9+7;\nint a[N],b[N],c[N],pre[N];\nvoid solve(){\n    int n;\n    cin&gt;&gt;n;\n    vector&lt;pair&lt;int,int&gt;&gt;v;\n    for(int i=1;i&lt;=n;i++){\n        for(int j=1;j&lt;=n;j++){\n            char m;\n            cin&gt;&gt;m;\n            if(m=='*'){\n                v.emplace_back(i,j);\n            }\n        }\n    }\n    int mx=0;\n    for(auto [x,y]:v){\n        int degree=0;\n        for(auto [nx,ny]:v){\n            if(abs(x-nx)+abs(y-ny)==1){\n                degree++;\n            }\n        }\n        mx=max(degree,mx);\n    }\n    if(mx==3){\n        cout&lt;&lt;\"T\"&lt;&lt;endl;\n    }else{\n        cout&lt;&lt;\"L\"&lt;&lt;endl;\n    }\n\n};\nsigned main(){\n\n\tstd::ios::sync_with_stdio(false);\n    cin.tie(0);\n    cout.tie(0);\n    TESTS{\n        solve();\n    };\n\n\treturn 0;\n}\n</code></pre>\n<h3 id=\"åšä¸½å¤§ç»“ç•Œçš„ç¨³å®šè½´å¿ƒ\">åšä¸½å¤§ç»“ç•Œçš„ç¨³å®šè½´å¿ƒ</h3>\n<p><a href=\"https://ac.nowcoder.com/acm/contest/127702/C\" rel=\"noopener nofollow\" target=\"_blank\">C-åšä¸½å¤§ç»“ç•Œçš„ç¨³å®šè½´å¿ƒ_ç‰›å®¢å‘¨èµ› Round 130 (nowcoder.com)</a></p>\n<p><img alt=\"image-20260209090135699\" src=\"https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121303545-355177775.png\" /></p>\n<pre><code>5\n1 2\n1 3\n1 4\n4 5\n</code></pre>\n<pre><code>4\n</code></pre>\n<p>æˆ‘ä»¬å¯ä»¥å»åˆ†æä¸€ä¸‹äºŒå‰æ ‘çš„ç‰¹ç‚¹ï¼Œæ˜¯ä¸æ˜¯æœ€å¤šçš„èŠ‚ç‚¹æ•°åœ¨3ä¸ªä»¥ä¸‹ï¼Œä¸”è¿™ä¸ª3ä¸ªçš„èŠ‚ç‚¹ä¸ä¼šä½œä¸ºè½´å¿ƒç‚¹ã€‚</p>\n<p>ä¸¤ä¸ªçš„å’Œä¸€ä¸ªçš„éƒ½å¯ä»¥ä½œä¸ºè½´å¿ƒç‚¹ã€‚</p>\n<p>æ‰€æœ‰æˆ‘ä»¬å¯ä»¥å»å…ˆåˆ¤æ–­åˆ°åº•å“ªä¸ªæœ€å¤§çš„ç‚¹æ•°æœ‰å¤šå¤§ã€‚å¤§äº3å°±ç›´æ¥æ˜¯é›¶ï¼Œå°äºçš„3å°±å¯ä»¥ä½œä¸ºè½´å¿ƒç‚¹ã€‚</p>\n<h4 id=\"è§£é¢˜ä»£ç -2\">è§£é¢˜ä»£ç </h4>\n<pre><code class=\"language-c++\">#include&lt;bits/stdc++.h&gt;\n#define int long long\n#define lll __uint128_t\n#define PII pair&lt;int ,int&gt;\n#define endl '\\n'\nusing namespace std;\n#define yn(ans) printf(\"%s\\n\", (ans)?\"Yes\":\"No\");//å¿«é€Ÿæ‰“å°\n#define YN(ans) printf(\"%s\\n\", (ans)?\"YES\":\"NO\");\n#define REP(i, e) for (int i = 0; i &lt; (e); ++i)\n#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)\n#define TESTS int t; cin &gt;&gt; t; while (t--)\n#define TEST\nconst int N=2e5+10,M=1e3+10,mod=1e9+7;\nint a[N],b[N],c[N],pre[N];\n\nsigned main(){\n\n\tstd::ios::sync_with_stdio(false);\n    cin.tie(0);\n    cout.tie(0);\n    int n;\n    cin&gt;&gt;n;\n    vector&lt;vector&lt;int&gt;&gt;g(n+1);\n    for(int i=1;i&lt;n;i++){\n        int u,v;\n        cin&gt;&gt;u&gt;&gt;v;\n        g[u].push_back(v);\n        g[v].push_back(u);\n    }\n    int mx=0;\n    int ans=0;\n    for(int i=1;i&lt;=n;i++){\n        mx=max(mx,(int)g[i].size());\n    }\n    if(mx&lt;=3){\n        for(int i=1;i&lt;=n;i++){\n            if(g[i].size()&lt;=2){\n                ans++;\n            }\n        }\n    }\n    cout&lt;&lt;ans&lt;&lt;endl;\n\n\treturn 0;\n}\n</code></pre>\n<h3 id=\"é­”æ³•äººå¶çš„åè¿›åˆ¶æ ¡å‡†\">é­”æ³•äººå¶çš„åè¿›åˆ¶æ ¡å‡†</h3>\n<p><img alt=\"image-20260209094949846\" src=\"https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121303963-2021372242.png\" /></p>\n<pre><code>3\n1 5\n2 3\n5 7\n</code></pre>\n<pre><code>1 2\n1 3\n3 7\n</code></pre>\n<p>é¦–å…ˆæˆ‘ä»¬é€šè¿‡æ‰“æ ‡ç¡®å®šä¸€ä¸‹è§„å¾‹ã€‚</p>\n<pre><code class=\"language-c++\">for(double y=2;y&lt;=1000;y++){\n\tcout&lt;&lt;fixed&lt;&lt;setprecision(10)&lt;&lt;(1.0/y)&lt;&lt;endl;\n}\n</code></pre>\n<p><img alt=\"image-20260209095354057\" src=\"https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121304411-1460739702.png\" /></p>\n<p>å¯ä»¥å‘ç°ç‰¹æ®Šçš„</p>\n<pre><code>1/9----ã€‹å¾—åˆ°è¿™ä¸ªã€‚0.1111111ï¼Œè¿™ä¸ªæˆ‘ä»¬å°±å¯ä»¥å»æ„é€ ä¸€ä¸‹äº†ï¼Œä½†æ˜¯ï¼Œb/9\n\nç„¶åç‰¹åˆ¤åˆ«çš„ï¼Œåº”ä¸ºæ²¡æœ‰9/9ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°0.9090...\næˆ‘ä»¬å¯ä»¥é€šè¿‡å¥‡å¶ä»£æ¢Ã—ä¸€ä¸ª10å°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬ç›´æ¥9å¾—åˆ°è¿™ä¸ªæ•°.\nç„¶åç‰¹åˆ¤ä¸€äº›0ï¼Œå’Œå¯ä»¥è¢«3ï¼Œ6çš„æƒ…å†µå°±è¡Œäº†\n</code></pre>\n<h4 id=\"è§£é¢˜ä»£ç -3\">è§£é¢˜ä»£ç </h4>\n<pre><code class=\"language-c++\">#include&lt;bits/stdc++.h&gt;\n#define int long long\n#define lll __uint128_t\n#define PII pair&lt;int ,int&gt;\n#define endl '\\n'\nusing namespace std;\n#define yn(ans) printf(\"%s\\n\", (ans)?\"Yes\":\"No\");//å¿«é€Ÿæ‰“å°\n#define YN(ans) printf(\"%s\\n\", (ans)?\"YES\":\"NO\");\n#define REP(i, e) for (int i = 0; i &lt; (e); ++i)\n#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)\n#define TESTS int t; cin &gt;&gt; t; while (t--)\n#define TEST\nconst int N=2e5+10,M=1e3+10,mod=1e9+7;\n\nvoid solve(){\n    int a,b;\n    cin&gt;&gt;a&gt;&gt;b;\n    if(b==0){\n        if(a==1){\n            cout&lt;&lt;1&lt;&lt;\" \"&lt;&lt;1000&lt;&lt;endl;\n        }else{\n            cout&lt;&lt;1&lt;&lt;\" \"&lt;&lt;2&lt;&lt;endl;\n        }\n        return;\n    }else if(b==9){\n        if(a%2){\n            cout&lt;&lt;10&lt;&lt;\" \"&lt;&lt;11&lt;&lt;endl;\n        }else{\n            cout&lt;&lt;1&lt;&lt;\" \"&lt;&lt;11&lt;&lt;endl;\n        }\n        return;\n    }\n    if(b==3){\n        cout&lt;&lt;1&lt;&lt;\" \"&lt;&lt;3&lt;&lt;endl;\n        return;\n    }\n    if(b==6){\n        cout&lt;&lt;2&lt;&lt;\" \"&lt;&lt;3&lt;&lt;endl;\n        return;\n    }\n    cout&lt;&lt;b&lt;&lt;\" \"&lt;&lt;9&lt;&lt;endl;\n};\nsigned main(){\n\n\tstd::ios::sync_with_stdio(false);\n    cin.tie(0);\n    cout.tie(0);\n    TESTS{\n        solve();\n    };\n\n\treturn 0;\n}\n</code></pre>\n<h3 id=\"çˆ±ä¸½ä¸çš„äººå¶åœ†èˆæ›²\">çˆ±ä¸½ä¸çš„äººå¶åœ†èˆæ›²</h3>\n<p><a href=\"https://ac.nowcoder.com/acm/contest/127702/E\" rel=\"noopener nofollow\" target=\"_blank\">E-çˆ±ä¸½ä¸çš„äººå¶åœ†èˆæ›²_ç‰›å®¢å‘¨èµ› Round 130 (nowcoder.com)</a></p>\n<p><img alt=\"image-20260209112816198\" src=\"https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121304824-570108632.png\" /></p>\n<pre><code>abca\n</code></pre>\n<pre><code>1\n</code></pre>\n<p>å› ä¸ºé™åˆ¶åªå­˜åœ¨ä¸ç›¸é‚»ã€‚æˆ‘ä»¬å°±å¯ä»¥å»è€ƒè™‘dpçš„åšæ³•</p>\n<p>è¿™ä¸ªæ˜¯ä¸€ä¸ªçº¿æ€§dpçš„é¢˜ç›®ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª</p>\n<p>å› ä¸ºdæ²¡æœ‰ç¡®è®¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å»æšä¸¾d</p>\n<pre><code>f[i][j]---&gt;è¡¨ç¤ºå‰iä¸ªä½ç½®å‡åˆæ³•ï¼Œä¸”si=jçš„æœ€å°æ¬¡æ•°\n\nä½ ä»¬è½¬ç§»å°±æ˜¯\nminï¼ˆf[i-1][(j-d+26)%26],f[(i+d)%26]ï¼‰+è¿™ä¸ªæ•°åˆ°åº•æ˜¯ä¸æ˜¯ç­‰äºjï¼Œä¸ç­‰äºå°±è¦ç”¨ä¸€æ¬¡ï¼Œæœ€åå†ç®—å‡ºæœ€å°å€¼ã€‚\n</code></pre>\n<h4 id=\"è§£é¢˜ä»£ç -4\">è§£é¢˜ä»£ç </h4>\n<pre><code class=\"language-c++\">#include&lt;bits/stdc++.h&gt;\n#define int long long\n#define lll __uint128_t\n#define PII pair&lt;int ,int&gt;\n#define endl '\\n'\nusing namespace std;\n#define yn(ans) printf(\"%s\\n\", (ans)?\"Yes\":\"No\");//å¿«é€Ÿæ‰“å°\n#define YN(ans) printf(\"%s\\n\", (ans)?\"YES\":\"NO\");\n#define REP(i, e) for (int i = 0; i &lt; (e); ++i)\n#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)\n#define TESTS int t; cin &gt;&gt; t; while (t--)\n#define TEST\nconst int N=2e5+10,M=1e3+10,mod=1e9+7;\nint a[N],b[N],c[N],pre[N];\n\nsigned main(){\n\n\tstd::ios::sync_with_stdio(false);\n    cin.tie(0);\n    cout.tie(0);\n    string s;\n    cin&gt;&gt;s;\n\n    int n=s.size();\n    s=\" \"+s;\n\n    //dpåˆå§‹åŒ–ã€‚\n    int mx=2e8;\n    for(int d=0;d&lt;=25;d++){\n        vector&lt;vector&lt;int&gt;&gt;f(n+1,vector&lt;int&gt;(26,2e8));\n        for(int j=0;j&lt;=25;j++){\n            if(j==s[1]-'a'){\n                f[1][j]=0;\n            }else{\n                f[1][j]=1;\n            }\n        }\n        for(int i=2;i&lt;=n;i++){\n            for(int j=0;j&lt;=25;j++){\n                f[i][j]=min(f[i-1][(j-d+26)%26],f[i-1][(j+d)%26])+(j!=s[i]-'a');\n            }\n        }\n\n        for(int i=0;i&lt;=25;i++){\n            mx=min(mx,f[n][i]);\n        }\n\n    }\n    cout&lt;&lt;mx&lt;&lt;endl;\n\n\n\n\n\treturn 0;\n}\n</code></pre>\n<h3 id=\"çº¢é­”é¦†çš„å¾®ç‘•åºä½\">çº¢é­”é¦†çš„å¾®ç‘•åºä½</h3>\n<p><a href=\"https://ac.nowcoder.com/acm/contest/127702/F\" rel=\"noopener nofollow\" target=\"_blank\">F-çº¢é­”é¦†çš„å¾®ç‘•åºä½_ç‰›å®¢å‘¨èµ› Round 130 (nowcoder.com)</a></p>\n<p><img alt=\"image-20260209120106423\" src=\"https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121305276-651327063.png\" /></p>\n<pre><code>2\n5\n1 2 4 3 5\n2\n1 2\n</code></pre>\n<pre><code>0\n1\n</code></pre>\n<p>æœ¬é¢˜è€ƒçš„ä¸€ä¸ªç»å…¸ç½®æ¢ç¯</p>\n<pre><code>å¦‚æœä¸€ä¸ª1-nçš„æ’åˆ—ï¼Œè¦äº¤æ¢å‡ æ¬¡æ‰èƒ½ä½¿å¾—å®ƒæ˜¯ä¸€ä¸ªæ’åˆ—ã€‚\nç»“è®ºæ˜¯\nn-ç¯çš„ä¸ªæ•°ï¼Œç›¸å½“äºæ‹†ç¯ã€‚\n</code></pre>\n<p><img alt=\"image-20260209120521887\" src=\"https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121305664-904288544.png\" /></p>\n<p>å¦‚å›¾æ˜¯4å…ƒç¯</p>\n<p>æˆ‘ä»¬é‚€å¾—åˆ°2ï¼Œè‚¯å®šå¾—ä¸€ä¸ªä¸¤ä¸ªç›¸é‚»çš„å…ƒç´ ä¹‹é—´æ²¡æœ‰å»äº¤æ¢</p>\n<pre><code>1 2 4 3 5\n</code></pre>\n<p>é‚£æˆ‘ä»¬å…ˆæŠŠäº¤æ¢çš„æ¬¡æ•°ç®—å‡ºæ¥ï¼Œå†è€ƒè™‘åŸæ¥åˆ°åº•å­˜ä¸å­˜åœ¨ç›¸é‚»çš„ç¯ã€‚</p>\n<h4 id=\"è§£é¢˜ä»£ç -5\">è§£é¢˜ä»£ç </h4>\n<pre><code class=\"language-c++\">#include&lt;bits/stdc++.h&gt;\n#define int long long\n#define lll __uint128_t\n#define PII pair&lt;int ,int&gt;\n#define endl '\\n'\nusing namespace std;\n#define yn(ans) printf(\"%s\\n\", (ans)?\"Yes\":\"No\");//å¿«é€Ÿæ‰“å°\n#define YN(ans) printf(\"%s\\n\", (ans)?\"YES\":\"NO\");\n#define REP(i, e) for (int i = 0; i &lt; (e); ++i)\n#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)\n#define TESTS int t; cin &gt;&gt; t; while (t--)\n#define TEST\nconst int N=2e5+10,M=1e3+10,mod=1e9+7;\nint a[N],b[N],c[N],pre[N];\nvoid solve(){\n    int n;\n    cin&gt;&gt;n;\n    vector&lt;int&gt;v(n+1);\n    for(int i=1;i&lt;=n;i++){\n        cin&gt;&gt;a[i];\n    }\n    int loop=0;\n    for(int i=1;i&lt;=n;i++){\n        if(v[i])continue;\n        int j=i;\n        loop++;\n        while (!v[j]){\n            v[j]=loop;\n            j=a[j];\n        }\n    }\n    int ans=n-loop+1;\n    for(int i=2;i&lt;=n;i++){//åˆ¤æ–­æ˜¯ä¸æ˜¯ç›¸é‚»çš„ç¯\n        if(v[i-1]==v[i]){\n            ans-=2;\n            break;\n        }\n    }\n    cout&lt;&lt;ans&lt;&lt;endl;\n};\nsigned main(){\n\n\tstd::ios::sync_with_stdio(false);\n    cin.tie(0);\n    cout.tie(0);\n    TESTS{\n        solve();\n    };\n\n\treturn 0;\n}\n</code></pre>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-09 12:13</span>&nbsp;\n<a href=\"https://www.cnblogs.com/godjian\">Godjian</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "æ‰£å­Cozeå®æˆ˜ï¼šä»0åˆ°1æ­å»ºå°çº¢ä¹¦å›¾æ–‡æ”¹å†™æ™ºèƒ½ä½“",
      "link": "https://www.cnblogs.com/tangshiye/p/19594522",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/tangshiye/p/19594522\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-09 11:59\">\n    <span>æ‰£å­Cozeå®æˆ˜ï¼šä»0åˆ°1æ­å»ºå°çº¢ä¹¦å›¾æ–‡æ”¹å†™æ™ºèƒ½ä½“</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ±¤å¸ˆçˆ·ï¼Œä¸“æ³¨AIæ™ºèƒ½ä½“åˆ†äº«ï¼Œè‡´åŠ›äºå¸®åŠ©100Wäººç”¨æ™ºèƒ½ä½“åˆ›å¯Œ~</p>\n<p>è¿˜åœ¨ä¸ºå°çº¢ä¹¦ç¬”è®°åˆ›ä½œå‘æ„å—ï¼Ÿ</p>\n<p>æ¯å¤©éƒ½è¦ç»å°½è„‘æ±æƒ³æ–‡æ¡ˆï¼Œçœ‹ç€åˆ«äººçš„çˆ†æ¬¾ç¬”è®°å´ä¸çŸ¥é“å¦‚ä½•æ¨¡ä»¿ï¼Ÿ</p>\n<p>ä»Šå¤©ï¼Œæˆ‘å°±æ•™ä½ å¦‚ä½•åˆ©ç”¨AIæ™ºèƒ½ä½“ï¼Œè½»æ¾å®ç°å°çº¢ä¹¦å›¾æ–‡æ”¹å†™ï¼Œè®©åˆ›ä½œæ•ˆç‡æå‡10å€ï¼</p>\n<p>æˆ‘ä»¬å…ˆçœ‹ä¸‹æ™ºèƒ½ä½“çš„æ‰§è¡Œæ•ˆæœï¼š</p>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<h2 id=\"1æ•´ä½“å·¥ä½œæµ\">1.æ•´ä½“å·¥ä½œæµ</h2>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<p>1.è·å–å°çº¢ä¹¦ç¬”è®°è¯¦æƒ…</p>\n<p>2.ä½¿ç”¨OCRæŠ€æœ¯ï¼Œæå–å›¾ç‰‡ä¸­çš„æ–‡å­—</p>\n<p>3.å°†å›¾ç‰‡æ–‡æ¡ˆè¿›è¡Œæ•´ç†</p>\n<p>4.å›¾ç‰‡æ–‡æ¡ˆä»¿å†™</p>\n<h2 id=\"2è¯¦ç»†å·¥ä½œæµèŠ‚ç‚¹\">2.è¯¦ç»†å·¥ä½œæµèŠ‚ç‚¹</h2>\n<h3 id=\"21-å¼€å§‹èŠ‚ç‚¹\">2.1 å¼€å§‹èŠ‚ç‚¹</h3>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<p>å¼€å§‹èŠ‚ç‚¹æœ‰ä¸¤ä¸ªè¾“å…¥å˜é‡ã€‚</p>\n<ul>\n<li>è¾“å…¥ï¼š\n<ul>\n<li>noteUrlï¼šå°çº¢ä¹¦ç¬”è®°é“¾æ¥</li>\n<li>cookieStrï¼šå°çº¢ä¹¦cookie</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"22-å¦‚ä½•è·å–å°çº¢ä¹¦cookie\">2.2 å¦‚ä½•è·å–å°çº¢ä¹¦cookieï¼Ÿ</h3>\n<p>1.ç™»é™†<a href=\"https://www.xiaohongshu.com/\" rel=\"noopener nofollow\" target=\"_blank\">https://www.xiaohongshu.com/</a></p>\n<p>2.åœ¨é¡µé¢ç©ºç™½å¤„å³å‡»é¼ æ ‡ï¼Œé€‰æ‹©ã€Œæ£€æŸ¥ã€</p>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<p>3.åœ¨åˆšåˆšæ‰“å¼€çš„é¢æ¿ä¸­ï¼Œç‚¹å‡»ã€Œç½‘ç»œã€é€‰é¡¹å¡</p>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<p>4.åˆ·æ–°å½“å‰é¡µé¢</p>\n<p>5.ç‚¹å‡»ç¬¬ä¸€æ¡è®°å½•ï¼Œåœ¨å³ä¾§ã€Œæ ‡å¤´ã€éƒ¨åˆ†å‘ä¸‹æ»šåŠ¨ï¼Œæ‰¾åˆ°cookieä¸€è¡Œï¼Œå°†å…¶å†…å®¹å¤åˆ¶ä¸‹ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„cookieStr</p>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<h3 id=\"23-è·å–å°çº¢ä¹¦ç¬”è®°è¯¦æƒ…\">2.3 è·å–å°çº¢ä¹¦ç¬”è®°è¯¦æƒ…</h3>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<p>æˆ‘ä»¬å°†ä½¿ç”¨ã€å°çº¢ä¹¦ã€‘æ’ä»¶çš„xhs_note_detailåŠŸèƒ½ã€‚</p>\n<p>é€šè¿‡è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç¬”è®°é“¾æ¥è·å–ç¬”è®°è¯¦æƒ…ã€‚</p>\n<ul>\n<li>è¾“å…¥ï¼š\n<ul>\n<li>cookieStrï¼šå¼€å§‹ - cookieStr</li>\n<li>noteUrlï¼šå¼€å§‹ - noteUrl</li>\n</ul>\n</li>\n</ul>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<h3 id=\"24-ä½¿ç”¨ocræŠ€æœ¯æå–å›¾ç‰‡ä¸­çš„æ–‡å­—\">2.4 ä½¿ç”¨OCRæŠ€æœ¯ï¼Œæå–å›¾ç‰‡ä¸­çš„æ–‡å­—</h3>\n<p><strong>1.æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨å¾ªç¯èŠ‚ç‚¹ï¼Œæ‰¹é‡æå–å›¾ç‰‡ä¸­çš„æ–‡å­—ã€‚</strong></p>\n<ul>\n<li>è¾“å…¥ï¼š\n<ul>\n<li>inputï¼šè·å–å°çº¢ä¹¦ç¬”è®°è¯¦æƒ…-note_image_list</li>\n</ul>\n</li>\n<li>è¾“å‡º\n<ul>\n<li>outputï¼šä»å›¾ç‰‡ä¸­æå–æ–‡å­—-data</li>\n</ul>\n</li>\n</ul>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<p><strong>2.ä½¿ç”¨å¾ªç¯ä½“ï¼Œæ‰¹é‡æå–å›¾ç‰‡çš„æ–‡å­—</strong></p>\n<p>æˆ‘ä»¬ä¼šä½¿ç”¨ã€ŒOCRã€æ’ä»¶ï¼Œæå–å›¾ç‰‡çš„æ–‡å­—ã€‚</p>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<p>è¾“å…¥å‚æ•°å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<h3 id=\"25-ä½¿ç”¨å¤§æ¨¡å‹å°†æ–‡æ¡ˆå†…å®¹è¿›è¡Œæ•´ç†æ’ç‰ˆ\">2.5 ä½¿ç”¨å¤§æ¨¡å‹å°†æ–‡æ¡ˆå†…å®¹è¿›è¡Œæ•´ç†ã€æ’ç‰ˆ</h3>\n<p>åœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å¤§æ¨¡å‹èŠ‚ç‚¹ï¼Œå¯¹æ–‡æ¡ˆå†…å®¹è¿›è¡Œæ•´ç†ã€æ’ç‰ˆã€‚</p>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<p>å¤§æ¨¡å‹èŠ‚ç‚¹çš„ç³»ç»Ÿæç¤ºè¯å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-markdown\">## è§’è‰²ï¼ˆRoleï¼‰\nä½ æ˜¯ä¸€ä½ç²¾é€šå†…å®¹æ•´ç†å’Œ Markdown æ’ç‰ˆçš„ AI åŠ©æ‰‹ã€‚ä½ æ“…é•¿é˜…è¯»å’Œç†è§£éç»“æ„åŒ–çš„æ–‡æœ¬å†…å®¹ï¼Œå¹¶èƒ½å¤Ÿå°†å…¶è½¬åŒ–ä¸ºç»“æ„æ¸…æ™°ã€æ ¼å¼ä¼˜ç¾çš„ Markdown æ–‡æ¡£ã€‚\n\n## èƒŒæ™¯ï¼ˆBackgroundï¼‰\néšç€ç¤¾äº¤åª’ä½“å¹³å°çš„æ™®åŠï¼Œå¤§é‡çš„å›¾æ–‡å†…å®¹è¢«åˆ›ä½œå’Œåˆ†äº«ã€‚ç„¶è€Œï¼Œè¿™äº›å†…å®¹å¾€å¾€ç¼ºä¹è‰¯å¥½çš„ç»“æ„å’Œæ ¼å¼ï¼Œä¸åˆ©äºé˜…è¯»å’Œç†è§£ã€‚å°†è¿™äº›å†…å®¹æ•´ç†æˆç»“æ„åŒ–çš„ Markdown æ–‡æ¡£ï¼Œå¯ä»¥å¤§å¤§æé«˜å†…å®¹çš„å¯è¯»æ€§å’Œä»·å€¼ã€‚\n\n## ä»»åŠ¡ï¼ˆTaskï¼‰\nä½ çš„ä»»åŠ¡æ˜¯æ¥æ”¶ä¸€æ®µä»æ’ä»¶è¾“å‡ºçš„éç»“æ„åŒ–æ–‡æœ¬å†…å®¹ï¼ˆä¸»è¦æ˜¯æŠ–éŸ³å›¾æ–‡ä¸­çš„æ–‡å­—ï¼‰ï¼Œä»”ç»†é˜…è¯»å¹¶ç†è§£å†…å®¹ï¼Œç„¶åå°†å…¶è½¬åŒ–ä¸ºç»“æ„æ¸…æ™°ã€æ ¼å¼è§„èŒƒçš„ Markdown æ–‡æ¡£ã€‚ä½ éœ€è¦ï¼š\n\n1. è¯†åˆ«å¹¶æå–æ–‡æœ¬ä¸­çš„å…³é”®ä¿¡æ¯ï¼Œå¦‚æ ‡é¢˜ã€ä½œè€…ã€ä¸»è¦å†…å®¹ç­‰\n2. æ ¹æ®å†…å®¹çš„é€»è¾‘å…³ç³»ï¼Œå¯¹æ–‡æœ¬è¿›è¡Œåˆ†ç±»å’Œæ•´ç†\n3. ä½¿ç”¨ Markdown è¯­æ³•è¿›è¡Œæ’ç‰ˆï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä½¿ç”¨æ ‡é¢˜ã€ç²—ä½“ã€æ–œä½“ã€åˆ—è¡¨ç­‰æ ¼å¼\n4. ç¡®ä¿æ‰€æœ‰åŸå§‹å†…å®¹éƒ½è¢«åŒ…å«åœ¨æœ€ç»ˆçš„ Markdown æ–‡æ¡£ä¸­ï¼Œä¸é—æ¼ä»»ä½•ä¿¡æ¯\n\n## è§„åˆ™ä¸é™åˆ¶ï¼ˆRules &amp; Restrictionsï¼‰\n1. å¿…é¡»ä½¿ç”¨ Markdown è¯­æ³•è¿›è¡Œæ’ç‰ˆ\n2. ä½¿ç”¨ #ã€##ã€### ç­‰è¿›è¡Œæ ‡é¢˜åˆ’åˆ†ï¼Œå±‚çº§ä¸è¶…è¿‡ 3 çº§\n3. ä½¿ç”¨ - æˆ– * è¿›è¡Œæ— åºåˆ—è¡¨ç¼–å†™ï¼Œä½¿ç”¨ 1. 2. 3. ç­‰è¿›è¡Œæœ‰åºåˆ—è¡¨ç¼–å†™\n4. é‡è¦å†…å®¹ä½¿ç”¨ç²—ä½“ï¼ˆ**æ–‡å­—**ï¼‰æ ‡æ³¨ï¼Œéœ€è¦å¼ºè°ƒçš„å†…å®¹ä½¿ç”¨æ–œä½“ï¼ˆ*æ–‡å­—*ï¼‰æ ‡æ³¨\n5. ä¿æŒåŸæ–‡çš„ä¸»è¦ç»“æ„å’Œé¡ºåºï¼Œä½†å¯ä»¥é€‚å½“è°ƒæ•´ä»¥æé«˜å¯è¯»æ€§\n6. ä¸å¾—æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹åŸæ–‡çš„å®è´¨å†…å®¹\n7. å¦‚é‡åˆ°ä¸ç¡®å®šçš„å†…å®¹ï¼Œä¿ç•™åŸæ ·å¹¶ç”¨æ‹¬å·æ ‡æ³¨\n\n## å‚è€ƒçŸ­è¯­ï¼ˆReference sentencesï¼‰\n- å†…å®¹å®Œæ•´ï¼Œä¸é—æ¼ä»»ä½•ä¿¡æ¯\n- ç»“æ„æ¸…æ™°ï¼Œå±‚æ¬¡åˆ†æ˜\n- æ ¼å¼è§„èŒƒï¼Œç¾è§‚å®ç”¨\n- é€»è¾‘ä¸¥å¯†ï¼Œæ¡ç†æ¸…æ™°\n- é‡ç‚¹çªå‡ºï¼Œæ˜“äºé˜…è¯»\n\n## æ¡ˆä¾‹å±•ç¤ºï¼ˆCase Showï¼‰\n### è¾“å…¥ï¼š\n{\n  \"code\": 0,\n  \"data\": {\n    \"results\": [\n      {\n        \"words\": [\n          {\n            \"lang\": \"auto\",\n            \"text\": \"æ±‚å¤§è¿è¿™ä¸¤ä¸ª\"\n          },\n          {\n            \"lang\": \"auto\",\n            \"text\": \"åœ°æ–¹æœ‰å•¥\"\n          },\n          {\n            \"lang\": \"auto\",\n            \"text\": \"åŒºåˆ«å•Šï¼Ÿï¼Ÿ\"\n          }\n        ]\n      }\n    ]\n  },\n  \"log_id\": \"20250325123913080C6F506498C6F581B7\",\n  \"msg\": \"success\"\n}\n\n## é£æ ¼å’Œè¯­æ°”ï¼ˆStyle &amp; Toneï¼‰\n- ä¿æŒä¸“ä¸šã€æ¸…æ™°çš„è¯­æ°”\n- ä½¿ç”¨ç®€æ´ã€ç›´æ¥çš„è¡¨è¾¾æ–¹å¼\n- ä¿æŒåŸæ–‡çš„é‡ç‚¹å’Œå¼ºè°ƒ\n\n## å—ä¼—ç¾¤ä½“ï¼ˆAudienceï¼‰\n- å°çº¢ä¹¦ç”µå•†æ–°æ‰‹å–å®¶\n- å¯¹å¼€è®¾å°çº¢ä¹¦åº—é“ºæ„Ÿå…´è¶£çš„äººç¾¤\n- æƒ³è¦äº†è§£å°çº¢ä¹¦ç”µå•†è¿è¥çš„äººç¾¤\n\n## è¾“å‡ºæ ¼å¼ï¼ˆOutput formatï¼‰\nä½¿ç”¨ Markdown æ ¼å¼è¾“å‡ºï¼ŒåŒ…æ‹¬ï¼š\n1. ä¸€çº§æ ‡é¢˜ï¼ˆ#ï¼‰ç”¨äºæ–‡ç« ä¸»æ ‡é¢˜\n2. äºŒçº§æ ‡é¢˜ï¼ˆ##ï¼‰ç”¨äºä¸»è¦ç« èŠ‚\n3. ä¸‰çº§æ ‡é¢˜ï¼ˆ###ï¼‰ç”¨äºå­ç« èŠ‚\n4. æ— åºåˆ—è¡¨ä½¿ç”¨ - æˆ– *\n5. æœ‰åºåˆ—è¡¨ä½¿ç”¨ 1. 2. 3. ç­‰\n6. é‡è¦å†…å®¹ä½¿ç”¨ç²—ä½“ï¼ˆ**æ–‡å­—**ï¼‰\n7. éœ€è¦å¼ºè°ƒçš„å†…å®¹ä½¿ç”¨æ–œä½“ï¼ˆ*æ–‡å­—*ï¼‰\n\n## å·¥ä½œæµç¨‹ï¼ˆWorkflowï¼‰\n1. ä»”ç»†é˜…è¯»è¾“å…¥çš„æ–‡æœ¬å†…å®¹ï¼Œç†è§£å…¶ç»“æ„å’Œä¸»è¦ä¿¡æ¯ç‚¹\n2. æå–æ ‡é¢˜ã€ä½œè€…ã€æ ‡ç­¾ç­‰å…ƒä¿¡æ¯\n3. è¯†åˆ«ä¸»è¦ç« èŠ‚å’Œå­ç« èŠ‚ï¼Œè§„åˆ’æ–‡æ¡£ç»“æ„\n4. æŒ‰ç…§è§„åˆ’çš„ç»“æ„ï¼Œä½¿ç”¨ Markdown è¯­æ³•é‡æ–°æ’ç‰ˆå†…å®¹\n5. ä½¿ç”¨ç²—ä½“å’Œæ–œä½“çªå‡ºé‡è¦ä¿¡æ¯å’Œéœ€è¦å¼ºè°ƒçš„å†…å®¹\n6. æ£€æŸ¥ç¡®ä¿æ‰€æœ‰åŸå§‹å†…å®¹éƒ½è¢«åŒ…å«ï¼Œæ²¡æœ‰é—æ¼\n7. æœ€åæ£€æŸ¥ Markdown æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œè°ƒæ•´ä»¥ç¡®ä¿æœ€ä½³å¯è¯»æ€§\n\n## åˆå§‹åŒ–ï¼ˆInitializationï¼‰\n\nä¸‹é¢æ˜¯ä½ éœ€è¦æ•´ç†å’Œæ ¼å¼åŒ–çš„æ–‡æœ¬å†…å®¹ï¼š\n\n&lt;è¯„ä»·å†…å®¹&gt;\n\nè¯·æä¾›éœ€è¦æ•´ç†å’Œæ ¼å¼åŒ–çš„æ–‡æœ¬å†…å®¹ã€‚æˆ‘ä¼šä»”ç»†é˜…è¯»å¹¶æŒ‰ç…§ä¸Šè¿°è¦æ±‚å°†å…¶è½¬åŒ–ä¸ºç»“æ„æ¸…æ™°çš„ Markdown æ–‡æ¡£ã€‚ä¸éœ€è¦è¾“å‡ºé¢å¤–é™¤å›¾ç‰‡è¯†åˆ«æ–‡å­—ä»¥å¤–çš„å†…å®¹ã€‚\n</code></pre>\n<h3 id=\"26-å›¾ç‰‡æ–‡æ¡ˆä»¿å†™\">2.6 å›¾ç‰‡æ–‡æ¡ˆä»¿å†™</h3>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å¤§æ¨¡å‹èŠ‚ç‚¹é€€å›¾ç‰‡æ–‡æ¡ˆè¿›è¡Œä»¿å†™ã€‚</p>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<p>å¤§æ¨¡å‹èŠ‚ç‚¹çš„ç³»ç»Ÿæç¤ºè¯å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-markdown\"># è§’è‰²è¯´æ˜\nä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å›¾æ–‡å†…å®¹ä»¿å†™åŠ©æ‰‹ï¼Œè´Ÿè´£æ ¹æ®å›¾ç‰‡ä¸­æå–çš„æ–‡å­—å†…å®¹ï¼Œç»“åˆè§†è§‰å…ƒç´ å’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œåˆ›ä½œé£æ ¼ä¸€è‡´çš„ä»¿å†™å†…å®¹ã€‚\n\n# èƒŒæ™¯è¯´æ˜\nå¤„ç†ç”¨æˆ·æä¾›çš„å›¾ç‰‡æ–‡å­—å†…å®¹æ—¶ï¼Œä½ éœ€è¦ï¼š\n1. ç†è§£å›¾ç‰‡çš„æ•´ä½“é£æ ¼å’ŒèƒŒæ™¯ï¼ˆäº§å“ä»‹ç»ã€æ•™ç¨‹æ­¥éª¤ã€ä½¿ç”¨å¿ƒå¾—ç­‰ï¼‰\n2. åˆ†ææ–‡å­—çš„è¯­è¨€ç‰¹ç‚¹ï¼ˆæ­£å¼/å£è¯­åŒ–ã€å¥å¼ç‰¹å¾ã€ä¸“ä¸šæœ¯è¯­ç­‰ï¼‰\n3. ç»“åˆå›¾ç‰‡å‘ˆç°çš„è§†è§‰ä¿¡æ¯ï¼ˆäº§å“å¤–è§‚ã€ä½¿ç”¨åœºæ™¯ç­‰ï¼‰\n4. åœ¨ä¿æŒåŸæ„çš„åŸºç¡€ä¸Šè¿›è¡Œè‡ªç„¶çš„ä»¿å†™æ‰©å±•\n\n# ä»¿å†™åŸåˆ™\n1. ä¿æŒåŸæ„å®Œæ•´æ€§\n2. åŒ¹é…åŸæ–‡è¯­è¨€é£æ ¼\n3. è¡¥å……æ°å½“çš„ç»†èŠ‚\n4. ä¸å›¾ç‰‡å†…å®¹ä¿æŒä¸€è‡´\n5. é¿å…æ·»åŠ è™šå‡ä¿¡æ¯\n\n# å·¥ä½œæµç¨‹\n1. æ¥æ”¶å›¾ç‰‡æ–‡å­—å†…å®¹\n2. åˆ†æå›¾ç‰‡èƒŒæ™¯ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰\n3. åˆ†æåŸæ–‡ç‰¹ç‚¹ï¼š\n   - è¯­è¨€é£æ ¼\n   - å†…å®¹ç»“æ„\n   - å…³é”®è¯ä½¿ç”¨\n4. åˆ›ä½œä¸‰ä¸ªç‰ˆæœ¬ï¼š\n   - è´´è¿‘åŸæ–‡çš„ä¿å®ˆç‰ˆ\n   - é€‚åº¦ä¼˜åŒ–çš„æ”¹è¿›ç‰ˆ\n   - åˆ›æ„åŠ å¼ºçš„äº®ç‚¹ç‰ˆ\n\n# è¾“å‡ºç¤ºä¾‹\n## åŸæ–‡ï¼š\n\"å¤æ—¥å¿…å¤‡é˜²æ™’éœœ\nSPF50+ PA++++\næ¸…çˆ½ä¸æ²¹è…»\"\n\n## ä»¿å†™ç‰ˆæœ¬ï¼š\n1. ã€ä¿å®ˆç‰ˆã€‘\n\"å¤å­£å¿…å¤‡é˜²æ™’äº§å“\né˜²æ™’æŒ‡æ•°SPF50+ PA++++\nè´¨åœ°æ¸…çˆ½ä¸æ²¹è…»\"\n\n2. ã€ä¼˜åŒ–ç‰ˆã€‘\n\"å¤æ—¥é˜²æ™’æ¨è\né«˜å€é˜²æŠ¤SPF50+ PA++++\nè½»è–„æ°´æ„Ÿè´¨åœ°ï¼Œè‚Œè‚¤é›¶è´Ÿæ‹…\"\n\n3. ã€åˆ›æ„ç‰ˆã€‘\n\"ä»Šå¤é˜²æ™’å¤©èŠ±æ¿ï¼\nSPF50+ PA++++è¶…å¼ºé˜²æŠ¤\nä¸€æŠ¹åŒ–æ°´ï¼Œæ¸…çˆ½ä¸é»è…»\"\n\n# æ‰§è¡Œè¦æ±‚\nè¯·æä¾›ï¼š\n1. å›¾ç‰‡æ–‡å­—æå–å†…å®¹\n2. å›¾ç‰‡èƒŒæ™¯è¯´æ˜ï¼ˆå¦‚æœ‰ï¼‰\n\næˆ‘å°†æŒ‰ç…§ä»¥ä¸Šè§„èŒƒè¿›è¡Œä»¿å†™åˆ›ä½œã€‚\n</code></pre>\n<h3 id=\"27-ä½¿ç”¨æ–‡æœ¬å¤„ç†æ’ä»¶æ‹¼æ¥å­—ç¬¦ä¸²\">2.7 ä½¿ç”¨æ–‡æœ¬å¤„ç†æ’ä»¶æ‹¼æ¥å­—ç¬¦ä¸²</h3>\n<ul>\n<li>è¾“å…¥ï¼š\n<ul>\n<li>String1ï¼šè·å–å°çº¢ä¹¦ç¬”è®°è¯¦æƒ…-note</li>\n<li>String2ï¼šå›¾ç‰‡æ–‡æ¡ˆå†…å®¹æ•´ç†-output</li>\n<li>String3ï¼šå›¾ç‰‡æ–‡æ¡ˆä»¿å†™-output</li>\n</ul>\n</li>\n</ul>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<h3 id=\"28-ç»“æŸèŠ‚ç‚¹\">2.8 ç»“æŸèŠ‚ç‚¹</h3>\n<p><img alt=\"image.png\" class=\"lazyload\" /></p>\n<h2 id=\"3æ€»ç»“\">3.æ€»ç»“</h2>\n<p>é€šè¿‡ä»¥ä¸Šä»‹ç»ï¼Œç›¸ä¿¡ä½ äº†è§£äº†å¦‚ä½•åˆ©ç”¨DeepSeek+Cozeæ¥æ„å»ºé«˜æ•ˆçš„å°çº¢ä¹¦å›¾ç‰‡æ–‡æ¡ˆæ”¹å†™æ™ºèƒ½ä½“ã€‚</p>\n<p>åœ¨AIæ—¶ä»£ï¼ŒæŠ€æœ¯é—¨æ§›å°†è¶Šæ¥è¶Šä½ï¼Œå°ç™½ä¹Ÿèƒ½æ­å»ºæ™ºèƒ½ä½“ï¼Œç”¨AIå·¥å…·æ¥æå‡å·¥ä½œæ•ˆç‡ã€‚</p>\n<p>ç”¨AIæ™ºèƒ½ä½“ä¸æ˜¯æœªæ¥ï¼Œè€Œæ˜¯AIæ—¶ä»£æ¯ä¸ªäººçš„ç”Ÿå­˜æŠ€èƒ½ï¼Œå­¦ä¼šAIæ™ºèƒ½ä½“ï¼Œäººäººéƒ½æ˜¯è¶…çº§ä¸ªä½“ã€‚</p>\n<p>å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ï¼Œåˆ«å¿˜äº†ç‚¹èµã€å…³æ³¨ã€æ”¶è—ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ï¼</p>\n<blockquote>\n<p>å¯¹äº†ï¼Œæˆ‘æ•´ç†äº†ä¸€ä»½å¼€æºã€Šæ™ºèƒ½ä½“å­¦ä¹ æ‰‹å†Œã€‹ï¼Œçˆ†è‚ 10 ä¸‡å­—ï¼Œä»·å€¼ 999 å…ƒã€‚é™æ—¶å¼€æ”¾é¢†å–ğŸ‘‰ï¼š<a href=\"https://tangshiye.cn\" rel=\"noopener nofollow\" target=\"_blank\">tangshiye.cn</a></p>\n</blockquote>\n\n\n</div>\n<div id=\"MySignature\">\n    <p>æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š<a href=\"https://www.cnblogs.com/tangshiye/\" target=\"_blank\">AIæ¶æ„å¸ˆæ±¤å¸ˆçˆ·</a>ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š<a href=\"https://www.cnblogs.com/tangshiye/p/19594522\" target=\"_blank\">https://www.cnblogs.com/tangshiye/p/19594522</a></p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-09 11:59</span>&nbsp;\n<a href=\"https://www.cnblogs.com/tangshiye\">AIæ¶æ„å¸ˆæ±¤å¸ˆçˆ·</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">2</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "FastAPIä¸æ­¢äºAPIï¼šæ‰‹æŠŠæ‰‹æ•™ä½ ç”¨Jinja2æ‰“é€ åŠ¨æ€Webé¡µé¢",
      "link": "https://www.cnblogs.com/ymtianyu/p/19594466",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/ymtianyu/p/19594466\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-09 11:48\">\n    <span>FastAPIä¸æ­¢äºAPIï¼šæ‰‹æŠŠæ‰‹æ•™ä½ ç”¨Jinja2æ‰“é€ åŠ¨æ€Webé¡µé¢</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        æœ¬æ–‡ç³»ç»Ÿä»‹ç»äº†å¦‚ä½•åœ¨FastAPIæ¡†æ¶ä¸­é›†æˆJinja2æ¨¡æ¿å¼•æ“æ¥æ„å»ºåŠ¨æ€Webé¡µé¢ã€‚å†…å®¹æ¶µç›–ä»å®‰è£…é…ç½®ã€æ¨¡æ¿ä¸Šä¸‹æ–‡æ•°æ®ä¼ é€’ï¼ˆåŒ…æ‹¬è¯·æ±‚çº§å’Œå…¨å±€ä¸¤ç§æ–¹å¼ï¼‰ã€é™æ€æ–‡ä»¶æ­£ç¡®å¼•å…¥ï¼Œåˆ°å®Œæ•´å®æˆ˜æ¼”ç¤ºä¸å¸¸è§é¿å‘æŒ‡å—ã€‚å¸®åŠ©å¼€å‘è€…å¿«é€ŸæŒæ¡åˆ©ç”¨FastAPIæœåŠ¡ç«¯æ¸²æŸ“é¡µé¢çš„æŠ€èƒ½ï¼Œé€‚ç”¨äºå¿«é€ŸåŸå‹ã€ç®¡ç†åå°ç­‰åœºæ™¯ã€‚\n    </div>\n<div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<div>\n<p>ä½ æ˜¯ä¸æ˜¯ä¹Ÿè§‰å¾—ï¼Œç”¨FastAPIå†™æ¥å£çˆ½åˆ°é£èµ·ï¼Œä½†ä¸€æƒ³åˆ°è¦è¿”å›ä¸ªå¸¦æ•°æ®çš„HTMLé¡µé¢ï¼Œå°±ç¬é—´å¤´å¤§ï¼ŸğŸ¯</p>\n<p>æˆ‘åˆšç”¨FastAPIé‚£ä¼šå„¿ä¹Ÿè¿™æ ·ï¼Œä»¥ä¸ºå®ƒå°±æ˜¯ä¸ªâ€œAPIä¸“ç”¨æ¡†æ¶â€ï¼Œæ¸²æŸ“é¡µé¢ï¼Ÿé‚£ä¸æ˜¯Djangoå’ŒFlaskçš„æ´»å„¿å—ï¼Ÿç›´åˆ°æˆ‘åœ¨ä¸€ä¸ªç´§æ€¥é¡¹ç›®é‡Œï¼Œéœ€è¦å¿«é€Ÿç»™å†…éƒ¨ç³»ç»Ÿåšä¸ªå¸¦æ•°æ®çœ‹æ¿çš„ç®¡ç†åå°ï¼Œæˆ‘æ‰å‘ç°ï¼Œ<strong style=\"color: rgba(186, 55, 42, 1);\">FastAPIé…åˆJinja2æ¨¡æ¿ï¼ŒåŸæ¥å¯ä»¥è¿™ä¹ˆé¦™ï¼</strong> ä»Šå¤©å°±è·Ÿä½ å” æ˜ç™½è¿™äº‹å„¿ï¼Œä¿ä½ 10åˆ†é’Ÿä¸Šæ‰‹ï¼Œå‘Šåˆ«â€œå‰åç«¯åˆ†ç¦»å¼ºè¿«ç—‡â€åœ¨ç®€å•åœºæ™¯ä¸‹çš„çº ç»“ã€‚</p>\n<h2 style=\"color: rgba(52, 152, 219, 1); padding-bottom: 5px;\">ğŸ“Œ æœ¬æ–‡èƒ½å¸®ä½ è§£å†³</h2>\n<div style=\"background-color: rgba(248, 249, 250, 1); padding: 15px; margin: 20px 0;\">\n<p>1. åœ¨FastAPIä¸­å¦‚ä½•å®‰è£…ã€é…ç½®Jinja2æ¨¡æ¿å¼•æ“ã€‚</p>\n<p>2. å¦‚ä½•æŠŠåå°æ•°æ®ï¼ˆä¸Šä¸‹æ–‡ï¼‰å®‰å…¨åˆæ–¹ä¾¿åœ°â€œå¡â€ç»™å‰ç«¯æ¨¡æ¿ã€‚</p>\n<p>3. å¦‚ä½•åœ¨æ¨¡æ¿é‡Œæ­£ç¡®å¼•å…¥CSSã€JSç­‰é™æ€æ–‡ä»¶ï¼Œé¿å…â€œ404æƒ¨æ¡ˆâ€ã€‚</p>\n<p>4. æˆ‘è¸©è¿‡çš„å‡ ä¸ªå‘å’Œæœ€ä½³å®è·µï¼Œè®©ä½ ä¸€æ¬¡å†™å¯¹ã€‚</p>\n</div>\n<h2>ğŸš€ ä¸»è¦å†…å®¹è„‰ç»œ</h2>\n<p>ğŸ‘‰ å…ˆèŠèŠï¼šä¸ºä»€ä¹ˆéœ€è¦æ¨¡æ¿å¼•æ“ï¼Ÿï¼ˆä¸åªæ˜¯ä¸ºäº†çœäº‹ï¼‰</p>\n<p>ğŸ‘‰ æ ¸å¿ƒæ“ä½œï¼šå®‰è£…ã€é…ç½®ã€ä¼ é€’æ•°æ®çš„â€œä¸¤æ¡è·¯å¾„â€ã€‚</p>\n<p>ğŸ‘‰ å®æˆ˜æ¼”ç¤ºï¼šä¸€ä¸ªåŒ…å«ç”¨æˆ·åˆ—è¡¨å’Œæ ·å¼çš„å°é¡¹ç›®ã€‚</p>\n<p>ğŸ‘‰ é¿å‘æŒ‡å—ï¼šé™æ€æ–‡ä»¶é‚£äº›â€œè·¯å¾„ç„å­¦â€ä¸è¿›é˜¶æ€è€ƒã€‚</p>\n<hr style=\"border: none; height: 1px; background-color: rgba(238, 238, 238, 1); margin: 30px 0;\" />\n<h2>ğŸ” ä¸€ã€é—®é¢˜ä¸èƒŒæ™¯ï¼šFastAPIåªèƒ½â€œåƒâ€JSONï¼Ÿ</h2>\n<p>FastAPIä»¥æ„å»ºé«˜æ€§èƒ½APIé—»åï¼Œ<code style=\"color: rgba(186, 55, 42, 1);\">return JSONResponse</code> å‡ ä¹æ˜¯è‚Œè‚‰è®°å¿†ã€‚ä½†å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæ¯”å¦‚ï¼š</p>\n<div>\n<p>- å¿«é€ŸåŸå‹å¼€å‘ï¼Œæä¸ªå¸¦é¡µé¢çš„demoã€‚</p>\n<p>- å†…éƒ¨ç®¡ç†åå°ï¼Œå¤æ‚åº¦ä¸é«˜ï¼Œä¸æƒ³åŠ¨ç”¨å‰ç«¯æ¡†æ¶ã€‚</p>\n<p>- éœ€è¦æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰çš„ç®€å•é¡µé¢ã€‚</p>\n</div>\n<p>è¿™æ—¶å€™ï¼Œä½ ç¡¬è¦å‰åç«¯å½»åº•åˆ†ç¦»ï¼Œåè€Œæœ‰ç§â€œæ€é¸¡ç”¨ç‰›åˆ€â€çš„ç¹çã€‚å°±å¥½æ¯”ä½ åªæƒ³åœ¨å®¶é—¨å£åƒç¢—é¢ï¼Œç»“æœéè¦å¼€è½¦å»å¸‚ä¸­å¿ƒçš„é«˜çº§é¤å…ç‚¹å•ã€ç­‰é¤ã€æ‰“åŒ…å†å›æ¥ã€‚</p>\n<p><strong style=\"color: rgba(186, 55, 42, 1);\">æ¨¡æ¿å¼•æ“ï¼Œå°±æ˜¯è®©ä½ åœ¨FastAPIè¿™ä¸ªâ€œé«˜æ€§èƒ½å¨æˆ¿â€é‡Œï¼Œç›´æ¥å¼€ä¸ªâ€œå ‚é£Ÿçª—å£â€ã€‚</strong> Jinja2å°±æ˜¯è¿™ä¸ªçª—å£æœ€å¾—åŠ›çš„ä¼™è®¡ï¼Œå®ƒèƒ½æŠŠä½ çš„æ•°æ®ï¼ˆè‚‰ã€èœï¼‰å’ŒHTMLæ¨¡æ¿ï¼ˆç¢—ã€æ±¤åº•ï¼‰å¿«é€Ÿç»„åˆæˆä¸€ç¢—çƒ­è…¾è…¾çš„é¢ï¼ˆæœ€ç»ˆé¡µé¢ï¼‰ã€‚</p>\n<h2>ğŸ§  äºŒã€æ ¸å¿ƒåŸç†ä¸æ­¥éª¤ï¼šâ€œä¸¤æ¡è…¿â€èµ°è·¯</h2>\n<p>å¥½ï¼Œå’±ä»¬å…ˆæ¥è§£å†³æœ€æ ¸å¿ƒçš„é—®é¢˜ï¼šæ•°æ®æ€ä¹ˆä»åç«¯â€œèµ°â€åˆ°æ¨¡æ¿é‡Œï¼Ÿ</p>\n<p>æ ¸å¿ƒå°±ä¸¤æ­¥ï¼š1. é…ç½®å¼•æ“ï¼›2. ä¼ é€’æ•°æ®ã€‚æ•°æ®ä¼ é€’æœ‰ä¸¤æ¡å…³é”®â€œè·¯å¾„â€ï¼Œæˆ‘ç”»ä¸ªçµé­‚å›¾ç¤ºç»™ä½ çœ‹ï¼š</p>\n<div style=\"background-color: rgba(248, 249, 250, 1); padding: 15px; border-radius: 5px; margin: 20px 0;\">\n<p><strong>è·¯å¾„Aï¼šä¾èµ–é¡¹æ³¨å…¥ï¼ˆå…¨å±€/è¯·æ±‚çº§ä¸Šä¸‹æ–‡ï¼‰</strong></p>\n<p>åœ¨è·¯ç”±å¤„ç†å‡½æ•°é‡Œï¼Œé€šè¿‡ <code style=\"color: rgba(186, 55, 42, 1);\">TemplateResponse</code> çš„ <code style=\"color: rgba(186, 55, 42, 1);\">context</code> å‚æ•°ä¼ é€’ã€‚è¿™æ˜¯<strong style=\"color: rgba(186, 55, 42, 1);\">æœ€å¸¸ç”¨ã€æœ€çµæ´»</strong>çš„æ–¹å¼ï¼Œæ•°æ®é’ˆå¯¹æ¯æ¬¡è¯·æ±‚ã€‚</p>\n<p><strong>è·¯å¾„Bï¼šå…¨å±€æ¨¡æ¿ä¸Šä¸‹æ–‡ï¼ˆæ¯ä¸ªæ¨¡æ¿éƒ½èƒ½ç”¨ï¼‰</strong></p>\n<p>åœ¨åˆå§‹åŒ– <code style=\"color: rgba(186, 55, 42, 1);\">Jinja2Templates</code> æ—¶ï¼Œé€šè¿‡ <code style=\"color: rgba(186, 55, 42, 1);\">context</code> å‚æ•°ä¼ é€’ã€‚æ¯”å¦‚ç«™ç‚¹åã€å½“å‰å¹´ä»½ç­‰<strong style=\"color: rgba(186, 55, 42, 1);\">å…¨å±€é€šç”¨æ•°æ®</strong>ã€‚</p>\n</div>\n<p>æ˜¯ä¸æ˜¯æœ‰ç‚¹æŠ½è±¡ï¼Ÿåˆ«æ€¥ï¼Œå’±ä»¬æ¥ç€çœ‹å®æˆ˜ï¼Œä»£ç ä¸€å†™ä½ å°±å…¨æ˜ç™½äº†ã€‚</p>\n<h2>ğŸ’» ä¸‰ã€å®æˆ˜æ¼”ç¤ºï¼šä»é›¶æ­å»ºä¸€ä¸ªç”¨æˆ·åˆ—è¡¨é¡µ</h2>\n<p>æ¥ä¸‹æ¥é‡ç‚¹æ¥äº†ï¼Œå’±ä»¬ä¸€æ­¥æ­¥æ¥ã€‚å‡è®¾æˆ‘ä»¬è¦åšä¸€ä¸ªæ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨çš„é¡µé¢ã€‚</p>\n<h3>1ï¸âƒ£ å®‰è£…ä¸é¡¹ç›®ç»“æ„</h3>\n<p>å…ˆå®‰è£…å¿…å¤‡åº“ï¼š</p>\n<pre class=\"language-powershell highlighter-hljs\"><code>pip install fastapi jinja2 uvicorn</code></pre>\n<p>é¡¹ç›®ç›®å½•ç»“æ„å»ºè®®è¿™æ ·å®‰æ’ï¼Œæ¸…æ™°æ˜äº†ï¼š</p>\n<div>\n<pre class=\"language-powershell highlighter-hljs\"><code>ğŸ“ your_project/\nâ”œâ”€â”€ ğŸ“ templates/ # å­˜æ”¾æ‰€æœ‰Jinja2 HTMLæ¨¡æ¿\nâ”‚     â””â”€â”€ index.html\nâ”œâ”€â”€ ğŸ“ static/ # å­˜æ”¾CSS, JS, å›¾ç‰‡ç­‰é™æ€æ–‡ä»¶\nâ”‚     â””â”€â”€ style.css\nâ””â”€â”€ main.py # FastAPI ä¸»åº”ç”¨æ–‡ä»¶</code></pre>\n</div>\n<h3>2ï¸âƒ£ é…ç½®FastAPIä¸Jinja2</h3>\n<p>åœ¨ <code style=\"color: rgba(186, 55, 42, 1);\">main.py</code> é‡Œè¿›è¡Œåˆå§‹åŒ–ã€‚è¿™é‡Œæœ‰ä¸ª<strong style=\"color: rgba(186, 55, 42, 1);\">å…³é”®ç‚¹</strong>ï¼š<code style=\"color: rgba(186, 55, 42, 1);\">directory</code> å‚æ•°å¿…é¡»æ˜¯<strong style=\"color: rgba(186, 55, 42, 1);\">å­—ç¬¦ä¸²è·¯å¾„</strong>ï¼Œä¸èƒ½æ˜¯Pathå¯¹è±¡ï¼ˆJinja2çš„è€è§„çŸ©ï¼‰ã€‚</p>\n<pre class=\"language-python highlighter-hljs\"><code>from fastapi import FastAPI, Request\nfrom fastapi.responses import HTMLResponse\nfrom fastapi.templating import Jinja2Templates\nfrom fastapi.staticfiles import StaticFiles\n\napp = FastAPI(title=\"FastAPI+Jinja2 Demo\")\n\n# é…ç½®æ¨¡æ¿å¼•æ“ï¼Œå‘Šè¯‰å®ƒæ¨¡æ¿æ–‡ä»¶åœ¨å“ª\ntemplates = Jinja2Templates(directory=\"templates\")\n\n# é…ç½®é™æ€æ–‡ä»¶æœåŠ¡ï¼ŒæŒ‚è½½åˆ°`/static`è·¯å¾„\napp.mount(\"/static\", StaticFiles(directory=\"static\"), name=\"static\")</code></pre>\n<h3>3ï¸âƒ£ å®šä¹‰è·¯ç”±ä¸ä¼ é€’æ•°æ®ï¼ˆè·¯å¾„Aï¼‰</h3>\n<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè·¯ç”±ï¼Œæ¨¡æ‹Ÿä»æ•°æ®åº“è·å–ç”¨æˆ·åˆ—è¡¨ï¼Œå¹¶ä¼ é€’ç»™æ¨¡æ¿ï¼š</p>\n<pre class=\"language-python highlighter-hljs\"><code>@app.get(\"/\", response_class=HTMLResponse)\nasync def read_users(request: Request):\n    # æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…ä¸­å¯èƒ½æ¥è‡ªæ•°æ®åº“\n    user_list = [\n        {\"id\": 1, \"name\": \"å¼ ä¸‰\", \"role\": \"ç®¡ç†å‘˜\"},\n        {\"id\": 2, \"name\": \"æå››\", \"role\": \"ç¼–è¾‘\"},\n        {\"id\": 3, \"name\": \"ç‹äº”\", \"role\": \"è®¢é˜…ç”¨æˆ·\"},\n    ]\n    # ç½‘ç«™æ ‡é¢˜ï¼Œä½œä¸ºé¢å¤–æ•°æ®ä¼ é€’\n    site_title = \"å†…éƒ¨ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ\"\n    \n    # æ ¸å¿ƒæ“ä½œï¼šæ¸²æŸ“æ¨¡æ¿ï¼Œå¹¶é€šè¿‡contextä¼ é€’æ•°æ®\n    return templates.TemplateResponse(\n        request=request,\n        name=\"index.html\", # æ¨¡æ¿æ–‡ä»¶å\n        context={\n            \"request\": request, # è¿™ä¸ªå¿…é¡»æœ‰ï¼Jinja2Templatesè¦æ±‚\n            \"users\": user_list,\n            \"title\": site_title\n        }\n    )</code></pre>\n<p><strong style=\"color: rgba(186, 55, 42, 1);\">åƒä¸‡æ³¨æ„</strong>ï¼š<code style=\"color: rgba(186, 55, 42, 1);\">context</code> å­—å…¸é‡Œ<strong style=\"color: rgba(186, 55, 42, 1);\">å¿…é¡»åŒ…å« \"request\" é”®</strong>ï¼è¿™æ˜¯ <code style=\"color: rgba(186, 55, 42, 1);\">Jinja2Templates</code> çš„å·¥ä½œæœºåˆ¶è¦æ±‚çš„ï¼Œä¸ç„¶æ¨¡æ¿é‡Œä¸€äº›åŸºäºè¯·æ±‚çš„åŠŸèƒ½ä¼šå¤±æ•ˆã€‚</p>\n<h3>4ï¸âƒ£ ç¼–å†™æ¨¡æ¿æ–‡ä»¶ (templates/index.html)</h3>\n<p>çœ‹çœ‹æ•°æ®åœ¨æ¨¡æ¿é‡Œæ€ä¹ˆç”¨ï¼š</p>\n<pre class=\"language-html highlighter-hljs\"><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"zh-CN\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;{{ title }}&lt;/title&gt;\n    &lt;!-- é‡ç‚¹ï¼å¼•å…¥é™æ€CSSæ–‡ä»¶ --&gt;\n    &lt;link rel=\"stylesheet\" href=\"{{ url_for('static', path='/style.css') }}\"&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h1&gt;æ¬¢è¿ä½¿ç”¨ {{ title }}&lt;/h1&gt;\n    &lt;table border=\"1\"&gt;\n        &lt;thead&gt;\n            &lt;tr&gt;\n                &lt;th&gt;ID&lt;/th&gt;\n                &lt;th&gt;å§“å&lt;/th&gt;\n                &lt;th&gt;è§’è‰²&lt;/th&gt;\n            &lt;/tr&gt;\n        &lt;/thead&gt;\n        &lt;tbody&gt;\n            {% for user in users %}\n            &lt;tr&gt;\n                &lt;td&gt;{{ user.id }}&lt;/td&gt;\n                &lt;td&gt;{{ user.name }}&lt;/td&gt;\n                &lt;td&gt;{{ user.role }}&lt;/td&gt;\n            &lt;/tr&gt;\n            {% endfor %}\n        &lt;/tbody&gt;\n    &lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;</code></pre>\n<p><strong style=\"color: rgba(186, 55, 42, 1);\">æ•²é»‘æ¿</strong>ï¼šå¼•å…¥é™æ€æ–‡ä»¶ç”¨çš„æ˜¯ <code style=\"color: rgba(186, 55, 42, 1);\">url_for('static', path='/style.css')</code>ã€‚è¿™é‡Œçš„ <code style=\"color: rgba(186, 55, 42, 1);\">'static'</code> å¯¹åº”æˆ‘ä»¬ <code style=\"color: rgba(186, 55, 42, 1);\">app.mount</code> æ—¶è®¾ç½®çš„ <code style=\"color: rgba(186, 55, 42, 1);\">name=\"static\"</code>ã€‚è¿™æ˜¯æˆ‘åˆæœŸå¸¸é…é”™çš„åœ°æ–¹ï¼Œ<strong style=\"color: rgba(186, 55, 42, 1);\">nameå¿…é¡»ä¸€è‡´</strong>ï¼</p>\n<h3>5ï¸âƒ£ ç¼–å†™é™æ€æ–‡ä»¶ (static/style.css)</h3>\n<p>éšä¾¿å†™ç‚¹æ ·å¼ï¼Œç¡®è®¤å®ƒèƒ½è¢«åŠ è½½ï¼š</p>\n<pre class=\"language-css highlighter-hljs\"><code>body {\n    font-family: sans-serif;\n    padding: 20px;\n    background-color: #f5f5f5;\n}\nh1 {\n    color: #2c3e50;\n}\ntable {\n    width: 100%;\n    border-collapse: collapse;\n    margin-top: 20px;\n}\nth, td {\n    padding: 10px;\n    text-align: left;\n}\nthead {\n    background-color: #3498db;\n    color: white;\n}</code></pre>\n<p>å¥½äº†ï¼ç°åœ¨è¿è¡Œ <code style=\"color: rgba(186, 55, 42, 1);\">uvicorn main:app --reload</code>ï¼Œæ‰“å¼€ <code style=\"color: rgba(186, 55, 42, 1);\">http://127.0.0.1:8000</code>ï¼Œä¸€ä¸ªå¸¦æ ·å¼å’ŒåŠ¨æ€æ•°æ®çš„ç”¨æˆ·åˆ—è¡¨é¡µé¢å°±å‡ºæ¥äº†ï¼æ•°æ®ä»åç«¯â€œæµâ€åˆ°äº†å‰ç«¯ï¼Œé™æ€æ–‡ä»¶ä¹Ÿæ­£å¸¸åŠ è½½ã€‚</p>\n<h2>âš ï¸ å››ã€æ³¨æ„äº‹é¡¹ä¸è¿›é˜¶æ€è€ƒ</h2>\n<p>æ˜¯ä¸æ˜¯ä»¥ä¸ºè¿™æ ·å°±å®Œäº†ï¼Ÿå†è¯´å‡ ä¸ªå®¹æ˜“ç¿»è½¦çš„ç‚¹ã€‚</p>\n<h3>ğŸ¯ é¿å‘æŒ‡å—</h3>\n<div>\n<p><strong>1. é™æ€æ–‡ä»¶404ï¼Ÿ</strong></p>\n<p>- æ£€æŸ¥ <code style=\"color: rgba(186, 55, 42, 1);\">app.mount</code> çš„ <code style=\"color: rgba(186, 55, 42, 1);\">directory</code> è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼ˆç›¸å¯¹è·¯å¾„ä»é¡¹ç›®æ ¹ç›®å½•ç®—èµ·ï¼‰ã€‚</p>\n<p>- æ£€æŸ¥æ¨¡æ¿ä¸­ <code style=\"color: rgba(186, 55, 42, 1);\">url_for</code> çš„ <code style=\"color: rgba(186, 55, 42, 1);\">name</code> å‚æ•°æ˜¯å¦ä¸ <code style=\"color: rgba(186, 55, 42, 1);\">mount</code> çš„ <code style=\"color: rgba(186, 55, 42, 1);\">name</code> ä¸€è‡´ã€‚</p>\n<p>- ç”Ÿäº§ç¯å¢ƒé€šå¸¸ç”¨Nginxç­‰ä¸“é—¨å¤„ç†é™æ€æ–‡ä»¶ï¼Œå¼€å‘æ—¶ç”¨ <code style=\"color: rgba(186, 55, 42, 1);\">StaticFiles</code> å¾ˆæ–¹ä¾¿ã€‚</p>\n<p><strong>2. å…¨å±€ä¸Šä¸‹æ–‡ï¼ˆè·¯å¾„Bï¼‰æ€ä¹ˆç”¨ï¼Ÿ</strong></p>\n<p>æ¯”å¦‚ä½ æƒ³åœ¨æ¯ä¸ªé¡µé¢éƒ½æ˜¾ç¤ºç‰ˆæƒå¹´ä»½ï¼š</p>\n</div>\n<pre class=\"language-python highlighter-hljs\"><code>templates = Jinja2Templates(\n    directory=\"templates\",\n    context={\"current_year\": 2024} # å…¨å±€æ³¨å…¥\n)\n# ç„¶åï¼Œåœ¨ä»»ä½•æ¨¡æ¿é‡Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ {{ current_year }}</code></pre>\n<h3>ğŸš€ è¿›é˜¶æ€è€ƒ</h3>\n<p><strong>æ¨¡æ¿ç»§æ‰¿æ˜¯ç‹ç‰Œï¼š</strong> ç”¨ <code style=\"color: rgba(186, 55, 42, 1);\">{% extends \"base.html\" %}</code> å’Œ <code style=\"color: rgba(186, 55, 42, 1);\">{% block content %}...{% endblock %}</code> æ¥å¤ç”¨å¸ƒå±€ï¼ˆå¦‚å¯¼èˆªæ ã€é¡µè„šï¼‰ï¼Œèƒ½è®©ä½ çš„æ¨¡æ¿ä»£ç å¹²å‡€åå€ã€‚å¼ºçƒˆå»ºè®®ä½ ç”¨èµ·æ¥ã€‚</p>\n<p><strong>ä¸Šä¸‹æ–‡å¤„ç†å™¨ï¼š</strong> å¦‚æœä½ æƒ³åœ¨æ¯ä¸ªè¯·æ±‚çš„æ¨¡æ¿é‡Œéƒ½è‡ªåŠ¨æ³¨å…¥ä¸€äº›æ•°æ®ï¼ˆæ¯”å¦‚å½“å‰ç™»å½•ç”¨æˆ·ï¼‰ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¾èµ–é¡¹ï¼Œå¹¶åœ¨æ¯ä¸ªè·¯ç”±çš„ <code style=\"color: rgba(186, 55, 42, 1);\">TemplateResponse</code> é‡Œè°ƒç”¨ã€‚è™½ç„¶æœ‰ç‚¹ç»•ï¼Œä½†ç»“æ„æ›´æ¸…æ™°ã€‚</p>\n<p><strong>ä½•æ—¶ç”¨ï¼Ÿä½•æ—¶ä¸ç”¨ï¼Ÿ</strong> å¯¹äºå¤æ‚çš„ã€äº¤äº’æ€§å¼ºçš„ç°ä»£Webåº”ç”¨ï¼Œå‰åç«¯åˆ†ç¦»ï¼ˆReact/Vue + FastAPI APIï¼‰ä»æ˜¯é¦–é€‰ã€‚ä½†å¯¹äºå·¥å…·ç±»ã€ç®¡ç†ç±»ã€éœ€è¦SEOçš„ç®€å•å†…å®¹é¡µï¼Œ<strong style=\"color: rgba(186, 55, 42, 1);\">FastAPI + Jinja2 çš„ç»„åˆèƒ½è®©ä½ ä¸€äººé¡¶ä¸€ä¸ªå…¨æ ˆå›¢é˜Ÿï¼Œå¼€å‘é€Ÿåº¦é£å¿«</strong>ã€‚</p>\n<hr />\n<p>å¥½äº†ï¼Œä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™å„¿ã€‚å¸Œæœ›è¿™ç¯‡â€œè¸©å‘ç»éªŒæ€»ç»“â€èƒ½å¸®ä½ æŠŠFastAPIçš„â€œå¦ä¸€é¢â€ä¹Ÿåˆ©ç”¨èµ·æ¥ã€‚</p>\n<p>æŠ€æœ¯é€‰å‹æ²¡æœ‰é“¶å¼¹ï¼Œ<strong style=\"color: rgba(186, 55, 42, 1);\">æœ€å¥½çš„å·¥å…·æ˜¯é‚£ä¸ªèƒ½å¸®ä½ é«˜æ•ˆã€ç¨³å®šè§£å†³é—®é¢˜çš„å·¥å…·</strong>ã€‚ä¸‹æ¬¡å½“ä½ éœ€è¦å¿«é€Ÿæ£é¼“ä¸ªå¸¦ç•Œé¢çš„å°å·¥å…·æ—¶ï¼Œä¸å¦¨è¯•è¯•è¿™ä¸ªç»„åˆã€‚</p>\n<p>ä½ åœ¨ç”¨FastAPIåšWebé¡µé¢æ—¶è¿˜é‡åˆ°è¿‡ä»€ä¹ˆå¥‡è‘©é—®é¢˜ï¼Ÿæˆ–è€…æœ‰æ›´ä¼˜é›…çš„å®è·µï¼Ÿ<strong style=\"color: rgba(186, 55, 42, 1);\">æ¬¢è¿åœ¨è¯„è®ºåŒºä¸€èµ·èŠèŠ</strong>ï¼Œä½ çš„ç»éªŒå¾ˆå¯èƒ½ä¹Ÿèƒ½å¸®åˆ°åˆ«äººã€‚</p>\n<p style=\"text-align: center; color: rgba(127, 140, 141, 1); font-size: 0.9em;\">è§‰å¾—æœ‰ç”¨çš„è¯ï¼Œè®°å¾—æ”¶è—ã€ç‚¹èµã€å…³æ³¨å“¦~ å’±ä»¬ä¸‹æœŸè§ï¼</p>\n</div>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-09 11:48</span>&nbsp;\n<a href=\"https://www.cnblogs.com/ymtianyu\">ä¸€åç¨‹åºåª›å‘€</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "é¸¿è’™åº”ç”¨å¼€å‘UIåŸºç¡€ç¬¬å››èŠ‚ï¼šUIAbility å¯åŠ¨æ¨¡å¼è¯¦è§£",
      "link": "https://www.cnblogs.com/san-xiu/p/19594371",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/san-xiu/p/19594371\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-09 11:33\">\n    <span>é¸¿è’™åº”ç”¨å¼€å‘UIåŸºç¡€ç¬¬å››èŠ‚ï¼šUIAbility å¯åŠ¨æ¨¡å¼è¯¦è§£</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h2 id=\"å­¦ä¹ ç›®æ ‡\">ã€å­¦ä¹ ç›®æ ‡ã€‘</h2>\n<ol>\n<li>æŒæ¡ multitonã€singletonã€specified ä¸‰ç§å¯åŠ¨æ¨¡å¼çš„æ ¸å¿ƒå®šä¹‰ä¸å·®å¼‚</li>\n<li>ç†è§£ä¸åŒæ¨¡å¼ä¸‹ UIAbility å®ä¾‹çš„<strong>åˆ›å»º/å¤ç”¨è§„åˆ™</strong>åŠç”Ÿå‘½å‘¨æœŸè”åŠ¨é€»è¾‘</li>\n<li>æŒæ¡ AbilityStage çš„æ ¸å¿ƒä½œç”¨åŠä¸ specified æ¨¡å¼çš„å…³è”å…³ç³»</li>\n<li>å­¦ä¼šåœ¨ module.json5 ä¸­é…ç½®å¯åŠ¨æ¨¡å¼ï¼ŒåŠå¤š Ability å·¥ç¨‹çš„æ ‡å‡†åŒ–æ­å»º</li>\n<li>èƒ½é€šè¿‡å®æ“å®ç°ä¸‰ç§æ¨¡å¼ï¼Œå¹¶éªŒè¯å®ä¾‹åˆ›å»º/å¤ç”¨çš„è¡Œä¸ºå·®å¼‚</li>\n</ol>\n<h2 id=\"è¯¾å‰é“ºå«\">ã€è¯¾å‰é“ºå«ã€‘</h2>\n<p>ä¸Šä¸€èŠ‚æˆ‘ä»¬å·²æŒæ¡ UIAbility çš„åŸºç¡€ç”Ÿå‘½å‘¨æœŸåŠé¡µé¢è·³è½¬é€»è¾‘ï¼Œå…¶é»˜è®¤å¯åŠ¨æ¨¡å¼ä¸º <strong>singletonï¼ˆå•å®ä¾‹ï¼‰</strong>ã€‚</p>\n<p>å®é™…å¼€å‘ä¸­ï¼Œä¸åŒä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚å¤šæ ‡ç­¾é¡µã€å”¯ä¸€ä¸ªäººä¸­å¿ƒã€æŒ‰ä¸šåŠ¡ç»´åº¦å¤ç”¨å®ä¾‹ï¼‰éœ€è¦ä¸åŒçš„å®ä¾‹ç®¡ç†ç­–ç•¥ï¼Œå› æ­¤é¸¿è’™æä¾›äº†ä¸‰ç§å¯åŠ¨æ¨¡å¼ï¼Œæ ¸å¿ƒè§£å†³<strong>ã€Œé‡å¤å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿæ˜¯åˆ›å»ºæ–°å®ä¾‹è¿˜æ˜¯å¤ç”¨å·²æœ‰å®ä¾‹ã€</strong>çš„é—®é¢˜ã€‚</p>\n<h2 id=\"æ ¸å¿ƒé—®é¢˜å¯¼å…¥\">ã€æ ¸å¿ƒé—®é¢˜å¯¼å…¥ã€‘</h2>\n<ul>\n<li>ä¸ºä»€ä¹ˆæµè§ˆå™¨æ‰“å¼€æ–°æ ‡ç­¾æ˜¯æ–°çª—å£ï¼Œè€Œæ‰“å¼€ä¸ªäººä¸­å¿ƒå§‹ç»ˆæ˜¯åŒä¸€ä¸ªçª—å£ï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆéƒ¨åˆ†é¡µé¢è·³è½¬è§¦å‘ onCreateï¼Œéƒ¨åˆ†ä»…è§¦å‘ onNewWantï¼Ÿ</li>\n<li>specified æ¨¡å¼çš„ instanceKey ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä½•å¿…é¡»ä¾èµ– AbilityStageï¼Ÿ</li>\n<li>å¦‚ä½•æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„å¯åŠ¨æ¨¡å¼ï¼Ÿ</li>\n</ul>\n<h2 id=\"ä¸€æ ¸å¿ƒæ¦‚å¿µuiability-ä¸‰ç§å¯åŠ¨æ¨¡å¼\">ä¸€ã€æ ¸å¿ƒæ¦‚å¿µï¼šUIAbility ä¸‰ç§å¯åŠ¨æ¨¡å¼</h2>\n<p>UIAbility çš„å¯åŠ¨æ¨¡å¼å†³å®šäº†<strong>ç³»ç»Ÿå¯¹å®ä¾‹çš„ç®¡ç†ç­–ç•¥</strong>ï¼Œé¸¿è’™å®˜æ–¹æä¾›ä¸‰ç§æ ‡å‡†åŒ–æ¨¡å¼ï¼Œè¦†ç›–æ‰€æœ‰ä¸šåŠ¡åœºæ™¯ï¼Œæ ¸å¿ƒå·®å¼‚é›†ä¸­åœ¨<strong>å®ä¾‹æ•°é‡</strong>å’Œ<strong>å¤ç”¨è§„åˆ™</strong>ä¸Šï¼š</p>\n<h3 id=\"1-singletonå•å®ä¾‹æ¨¡å¼--å…¨å±€å”¯ä¸€\">1. singletonï¼ˆå•å®ä¾‹æ¨¡å¼ï¼‰- å…¨å±€å”¯ä¸€</h3>\n<ul>\n<li><strong>æ ¸å¿ƒå®šä¹‰</strong>ï¼šè¯¥ç±»å‹ UIAbility å…¨å±€ä»…å­˜åœ¨<strong>ä¸€ä¸ªå®ä¾‹</strong>ï¼Œæ— è®ºå¤šå°‘æ¬¡å¯åŠ¨ï¼Œç³»ç»Ÿéƒ½ä¼šå¤ç”¨å·²æœ‰å®ä¾‹</li>\n<li><strong>æ ¸å¿ƒè§„åˆ™</strong>ï¼šé¦–æ¬¡å¯åŠ¨åˆ›å»ºå®ä¾‹ï¼Œåç»­æ‰€æœ‰å¯åŠ¨è¯·æ±‚å‡è·¯ç”±åˆ°å·²æœ‰å®ä¾‹</li>\n<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåº”ç”¨ä¸»ç•Œé¢ã€ä¸ªäººä¸­å¿ƒã€è´­ç‰©è½¦ç­‰<strong>éœ€è¦å…¨å±€å”¯ä¸€çŠ¶æ€</strong>çš„é¡µé¢</li>\n</ul>\n<h3 id=\"2-multitonå¤šå®ä¾‹æ¨¡å¼--æ¯æ¬¡æ–°å»º\">2. multitonï¼ˆå¤šå®ä¾‹æ¨¡å¼ï¼‰- æ¯æ¬¡æ–°å»º</h3>\n<ul>\n<li><strong>æ ¸å¿ƒå®šä¹‰</strong>ï¼šæ¯æ¬¡å¯åŠ¨è¯¥ç±»å‹ UIAbilityï¼Œç³»ç»Ÿéƒ½ä¼š<strong>åˆ›å»ºæ–°çš„å®ä¾‹</strong>ï¼Œå®ä¾‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹</li>\n<li><strong>æ ¸å¿ƒè§„åˆ™</strong>ï¼šæ— å¤ç”¨é€»è¾‘ï¼Œæ¯æ¬¡å¯åŠ¨å‡èµ°å®Œæ•´çš„å®ä¾‹åˆ›å»ºç”Ÿå‘½å‘¨æœŸ</li>\n<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæµè§ˆå™¨å¤šæ ‡ç­¾é¡µã€å¤šçª—å£æ–‡æ¡£ç¼–è¾‘ã€å¤šä»»åŠ¡å¤„ç†ç­‰<strong>éœ€è¦ç‹¬ç«‹çŠ¶æ€</strong>çš„é¡µé¢</li>\n</ul>\n<blockquote>\n<p>è¯´æ˜ï¼šstandard æ˜¯ multiton çš„æ›¾ç”¨åï¼Œé¸¿è’™ä½ç‰ˆæœ¬ä¸­ä½¿ç”¨ï¼ŒåŠŸèƒ½ä¸ multiton å®Œå…¨ä¸€è‡´</p>\n</blockquote>\n<h3 id=\"3-specifiedæŒ‡å®šå®ä¾‹æ¨¡å¼--æŒ‰æ ‡è¯†å¤ç”¨\">3. specifiedï¼ˆæŒ‡å®šå®ä¾‹æ¨¡å¼ï¼‰- æŒ‰æ ‡è¯†å¤ç”¨</h3>\n<ul>\n<li><strong>æ ¸å¿ƒå®šä¹‰</strong>ï¼šç³»ç»Ÿæ ¹æ®<strong>å”¯ä¸€æ ‡è¯†</strong>åˆ¤æ–­å®ä¾‹å¤ç”¨é€»è¾‘ï¼Œç›¸åŒæ ‡è¯†å¤ç”¨å®ä¾‹ï¼Œä¸åŒæ ‡è¯†åˆ›å»ºæ–°å®ä¾‹</li>\n<li><strong>æ ¸å¿ƒè§„åˆ™</strong>ï¼šæ ‡è¯†ç”± AbilityStage çš„ onAcceptWant æ–¹æ³•ç”Ÿæˆï¼Œé€šå¸¸ç»‘å®šä¸šåŠ¡å”¯ä¸€å€¼ï¼ˆå¦‚ instanceKeyï¼‰</li>\n<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šèŠå¤©çª—å£ï¼ˆæŒ‰è”ç³»äººIDå¤ç”¨ï¼‰ã€å•†å“è¯¦æƒ…é¡µï¼ˆæŒ‰å•†å“IDå¤ç”¨ï¼‰ã€æŒ‰ä¸šåŠ¡ç»´åº¦éš”ç¦»çš„å®ä¾‹åœºæ™¯</li>\n</ul>\n<h2 id=\"äºŒabilitystage-æ ¸å¿ƒä½œç”¨ä¸æ ¸å¿ƒæ–¹æ³•\">äºŒã€AbilityStage æ ¸å¿ƒä½œç”¨ä¸æ ¸å¿ƒæ–¹æ³•</h2>\n<h3 id=\"1-abilitystage-åŸºç¡€è®¤çŸ¥\">1. AbilityStage åŸºç¡€è®¤çŸ¥</h3>\n<ul>\n<li>AbilityStage æ˜¯<strong>æ¨¡å—çº§çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨</strong>ï¼Œæ¯ä¸ª HAP æ¨¡å—å¯¹åº”ä¸€ä¸ª AbilityStage å®ä¾‹ï¼Œç”±ç³»ç»Ÿé¦–æ¬¡åŠ è½½æ¨¡å—æ—¶è‡ªåŠ¨åˆ›å»º</li>\n<li>è‹¥æ— éœ€ç›‘å¬æ¨¡å—ç”Ÿå‘½å‘¨æœŸæˆ–å¤„ç† specified æ¨¡å¼ï¼Œæ— éœ€æ‰‹åŠ¨åˆ›å»ºï¼Œç³»ç»Ÿä½¿ç”¨é»˜è®¤å®ä¾‹ï¼›è‹¥éœ€å®ç° specified æ¨¡å¼ï¼Œ<strong>å¿…é¡»æ‰‹åŠ¨åˆ›å»ºå¹¶é…ç½®è‡ªå®šä¹‰ AbilityStage</strong></li>\n</ul>\n<h3 id=\"2-abilitystage-ä¸-specified-æ¨¡å¼çš„å…³è”\">2. AbilityStage ä¸ specified æ¨¡å¼çš„å…³è”</h3>\n<p>specified æ¨¡å¼æ˜¯<strong>å”¯ä¸€ä¾èµ– AbilityStage çš„å¯åŠ¨æ¨¡å¼</strong>ï¼ŒåŸå› æ˜¯ï¼šç³»ç»Ÿæœ¬èº«æ— æ³•è¯†åˆ«ã€Œå“ªäº›å¯åŠ¨è¯·æ±‚éœ€è¦å¤ç”¨å®ä¾‹ã€ï¼Œéœ€é€šè¿‡ AbilityStage æä¾›<strong>å®ä¾‹å”¯ä¸€æ ‡è¯†</strong>ï¼Œç³»ç»Ÿæ ¹æ®è¯¥æ ‡è¯†å®ŒæˆåŒ¹é…/å¤ç”¨ã€‚</p>\n<h3 id=\"3-abilitystage-æ ¸å¿ƒæ–¹æ³•onacceptwant\">3. AbilityStage æ ¸å¿ƒæ–¹æ³•ï¼šonAcceptWant</h3>\n<ul>\n<li>ä½œç”¨ï¼š<strong>ç”Ÿæˆå¹¶è¿”å› specified æ¨¡å¼çš„å®ä¾‹å”¯ä¸€æ ‡è¯†</strong>ï¼Œç³»ç»Ÿæ ¹æ®è¯¥æ ‡è¯†åˆ¤æ–­æ˜¯å¦å¤ç”¨å®ä¾‹</li>\n<li>å…¥å‚ï¼šWant å¯¹è±¡ï¼ˆåŒ…å«å¯åŠ¨è¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¦‚ abilityNameã€parameters ç­‰ï¼‰</li>\n<li>è¿”å›å€¼ï¼šå­—ç¬¦ä¸²ç±»å‹çš„å”¯ä¸€æ ‡è¯†ï¼ˆç›¸åŒæ ‡è¯†å¤ç”¨å®ä¾‹ï¼Œä¸åŒæ ‡è¯†/ç©ºå­—ç¬¦ä¸²åˆ›å»ºæ–°å®ä¾‹ï¼‰</li>\n<li>æ ¸å¿ƒé€»è¾‘ï¼šä» Want å‚æ•°ä¸­æå–ä¸šåŠ¡å”¯ä¸€å€¼ï¼ˆå¦‚ instanceKeyï¼‰ï¼Œæ‹¼æ¥æˆå…¨å±€å”¯ä¸€çš„æ ‡è¯†å­—ç¬¦ä¸²</li>\n</ul>\n<h2 id=\"ä¸‰å·¥ç¨‹æ­å»ºä¸ä¸‰ç§æ¨¡å¼è½åœ°\">ä¸‰ã€å·¥ç¨‹æ­å»ºä¸ä¸‰ç§æ¨¡å¼è½åœ°</h2>\n<h3 id=\"ä¸€å·¥ç¨‹ç»“æ„è§„åˆ’\">ï¼ˆä¸€ï¼‰å·¥ç¨‹ç»“æ„è§„åˆ’</h3>\n<p>åŸºäº <code>FirstApplication</code> å·¥ç¨‹ï¼Œæ–°å¢ 2 ä¸ª UIAbilityï¼ˆåˆ†åˆ«å¯¹åº” multiton/specified æ¨¡å¼ï¼‰åŠå¯¹åº”é¡µé¢ï¼Œä¿ç•™åŸæœ‰ EntryAbilityï¼ˆsingleton æ¨¡å¼ï¼‰ï¼Œæ ‡å‡†åŒ–å·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼ˆæ–°å¢ç›®å½•/æ–‡ä»¶æ ‡æ³¨â˜…ï¼‰ï¼š</p>\n<pre><code>FirstApplication\nâ”œâ”€â”€ AppScope                 # åº”ç”¨å…¨å±€é…ç½®ç›®å½•\nâ”‚   â””â”€â”€ app.json5            # å…¨å±€é…ç½®ï¼ˆåŒ…åï¼šcom.sanxiu.firstappï¼‰\nâ”œâ”€â”€ entry                    # ä¸»æ¨¡å—ç›®å½•ï¼ˆEntry HAPï¼‰\nâ”‚   â”œâ”€â”€ src/main\nâ”‚   â”‚   â”œâ”€â”€ ets              # ArkTSä»£ç æ ¸å¿ƒç›®å½•\nâ”‚   â”‚   â”œâ”€â”€ applicationâ˜…     # è‡ªå®šä¹‰AbilityStageç›®å½•ï¼ˆspecifiedæ¨¡å¼æ ¸å¿ƒï¼‰\nâ”‚   â”‚   â”‚   â””â”€â”€ MyAbilityStage.etsâ˜… # è‡ªå®šä¹‰AbilityStageï¼ˆå®ç°onAcceptWantï¼‰\nâ”‚   â”‚   â”œâ”€â”€ entryability     # å•å®ä¾‹Abilityç›®å½•ï¼ˆsingletonæ¨¡å¼ï¼‰\nâ”‚   â”‚   â”‚   â””â”€â”€ EntryAbility.ets       # é»˜è®¤Abilityï¼ˆå¯åŠ¨å…¥å£ï¼‰\nâ”‚   â”‚   â”œâ”€â”€ multitonabilityâ˜… # å¤šå®ä¾‹Abilityç›®å½•ï¼ˆmultitonæ¨¡å¼ï¼‰\nâ”‚   â”‚   â”‚   â””â”€â”€ MultitonAbility.etsâ˜…   # multitonæ¨¡å¼Ability\nâ”‚   â”‚   â”œâ”€â”€ specifiedabilityâ˜…# æŒ‡å®šå®ä¾‹Abilityç›®å½•ï¼ˆspecifiedæ¨¡å¼ï¼‰\nâ”‚   â”‚   â”‚   â””â”€â”€ SpecifiedAbility.etsâ˜…  # specifiedæ¨¡å¼Ability\nâ”‚   â”‚   â”œâ”€â”€ pages            # Pageé¡µé¢ç›®å½•\nâ”‚   â”‚   â”‚   â”œâ”€â”€ Index.ets              # å¤‡ç”¨é¦–é¡µ\nâ”‚   â”‚   â”‚   â”œâ”€â”€ Home.etsâ˜…               # æµ‹è¯•é¦–é¡µï¼ˆå¯åŠ¨å„æ¨¡å¼Abilityï¼‰\nâ”‚   â”‚   â”‚   â”œâ”€â”€ MultitonPage.etsâ˜…       # multitonæ¨¡å¼å¯¹åº”é¡µé¢\nâ”‚   â”‚   â”‚   â””â”€â”€ SpecifiedPage.etsâ˜…      # specifiedæ¨¡å¼å¯¹åº”é¡µé¢\nâ”‚   â”‚   â”œâ”€â”€ resources        # é™æ€èµ„æºç›®å½•ï¼ˆæ— ä¿®æ”¹ï¼‰\nâ”‚   â”‚   â””â”€â”€ module.json5     # æ¨¡å—é…ç½®æ–‡ä»¶ï¼ˆæ–°å¢Ability+é…ç½®å¯åŠ¨æ¨¡å¼+AbilityStageï¼‰\nâ””â”€â”€ å…¶ä»–ç›®å½•ï¼ˆæ„å»º/æµ‹è¯•ç›¸å…³ï¼Œæ— ä¿®æ”¹ï¼‰\n</code></pre>\n<h3 id=\"äºŒç¬¬ä¸€æ­¥åˆ›å»ºè‡ªå®šä¹‰-abilitystage\">ï¼ˆäºŒï¼‰ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè‡ªå®šä¹‰ AbilityStage</h3>\n<h4 id=\"1-åˆ›å»ºæ­¥éª¤\">1. åˆ›å»ºæ­¥éª¤</h4>\n<p>â‘  é€‰ä¸­ <code>src/main/ets</code> ç›®å½• â†’ å³é”® â†’ New â†’ Directory â†’ å‘½åä¸º <code>application</code>ï¼›<br />\nâ‘¡ è¿›å…¥ <code>application</code> ç›®å½• â†’ å³é”® â†’ New â†’ ArkTS File â†’ å‘½åä¸º <code>MyAbilityStage.ets</code>ã€‚</p>\n<h4 id=\"2-ä»£ç å®ç°\">2. ä»£ç å®ç°</h4>\n<pre><code class=\"language-javascript\">import { AbilityStage, Want } from '@kit.AbilityKit';\nimport { hilog } from '@kit.PerformanceAnalysisKit';\n\nconst TAG = '[Sample_StartMode]';\nconst DOMAIN = 0x0000;\n\n// ç»§æ‰¿ç³»ç»ŸAbilityStageï¼Œå®ç°è‡ªå®šä¹‰é€»è¾‘\nexport default class MyAbilityStage extends AbilityStage {\n    // AbilityStageåˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸï¼ˆæ¨¡å—åŠ è½½æ—¶è§¦å‘ï¼‰\n    onCreate() {\n        hilog.info(DOMAIN, TAG, 'MyAbilityStage åˆå§‹åŒ–æˆåŠŸ');\n    }\n\n    // æ ¸å¿ƒæ–¹æ³•ï¼šä¸ºspecifiedæ¨¡å¼ç”Ÿæˆå®ä¾‹å”¯ä¸€æ ‡è¯†\n    onAcceptWant(want: Want): string {\n        hilog.info(DOMAIN, TAG, 'å¼€å§‹å¤„ç†specifiedæ¨¡å¼å®ä¾‹æ ‡è¯†');\n        \n        // ä»…å¯¹SpecifiedAbilityåšæ ‡è¯†å¤„ç†ï¼Œé¿å…å½±å“å…¶ä»–Ability\n        if (want &amp;&amp; want.abilityName === 'SpecifiedAbility') {\n            // ä»Wantå‚æ•°ä¸­æå–ä¸šåŠ¡å”¯ä¸€æ ‡è¯†instanceKey\n            const instanceKey = want.parameters?.instanceKey;\n            // æœ‰æœ‰æ•ˆKeyåˆ™æ‹¼æ¥å”¯ä¸€æ ‡è¯†ï¼Œæ— åˆ™è¿”å›ç©ºï¼ˆåˆ›å»ºæ–°å®ä¾‹ï¼‰\n            if (instanceKey) {\n                return `SpecifiedAbility_${instanceKey}`;\n            }\n        }\n        \n        // éspecifiedæ¨¡å¼/æ— æœ‰æ•ˆKeyï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²\n        return '';\n    }\n}\n</code></pre>\n<h3 id=\"ä¸‰ç¬¬äºŒæ­¥åˆ›å»ºä¸‰ç§æ¨¡å¼çš„-uiability-åŠå¯¹åº”é¡µé¢\">ï¼ˆä¸‰ï¼‰ç¬¬äºŒæ­¥ï¼šåˆ›å»ºä¸‰ç§æ¨¡å¼çš„ UIAbility åŠå¯¹åº”é¡µé¢</h3>\n<h4 id=\"1-singleton-æ¨¡å¼entryabilityé»˜è®¤æ— éœ€ä¿®æ”¹\">1. singleton æ¨¡å¼ï¼šEntryAbilityï¼ˆé»˜è®¤æ— éœ€ä¿®æ”¹ï¼‰</h4>\n<ul>\n<li>å¯åŠ¨æ¨¡å¼é»˜è®¤ä¸º singletonï¼Œæ— éœ€åœ¨ module.json5 ä¸­é¢å¤–é…ç½®</li>\n<li>æ ¸å¿ƒä¿®æ”¹ï¼šå°†é»˜è®¤é¡µé¢æ”¹ä¸ºæµ‹è¯•é¦–é¡µ <code>pages/Home</code>ï¼Œä½œä¸ºæ‰€æœ‰æ¨¡å¼çš„å¯åŠ¨å…¥å£</li>\n</ul>\n<pre><code class=\"language-javascript\">// entryability/EntryAbility.ets å…³é”®ä»£ç \nonWindowStageCreate(windowStage: window.WindowStage): void {\n    windowStage.loadContent('pages/Home'); // æ”¹ä¸ºæµ‹è¯•é¦–é¡µ\n}\n</code></pre>\n<h4 id=\"2-multiton-æ¨¡å¼multitonability--multitonpage\">2. multiton æ¨¡å¼ï¼šMultitonAbility + MultitonPage</h4>\n<h5 id=\"1åˆ›å»º-multitonability\">ï¼ˆ1ï¼‰åˆ›å»º MultitonAbility</h5>\n<p>é€‰ä¸­ <code>src/main/ets</code> â†’ å³é”® â†’ New â†’ Ability â†’ å‘½åä¸º <code>MultitonAbility</code>ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼ˆæ ¸å¿ƒï¼šæ¯æ¬¡å¯åŠ¨è§¦å‘ onCreateï¼‰ï¼š</p>\n<pre><code class=\"language-javascript\">import { UIAbility, AbilityConstant, Want } from '@kit.AbilityKit';\nimport { window } from '@kit.ArkUI';\nimport { hilog } from '@kit.PerformanceAnalysisKit';\nimport { BusinessError } from '@ohos.base';\n\nconst TAG = 'MultitonAbility';\nconst DOMAIN = 0x0000;\n\nexport default class MultitonAbility extends UIAbility {\n    // æ¯æ¬¡å¯åŠ¨éƒ½ä¼šè§¦å‘ï¼ˆå¤šå®ä¾‹æ¨¡å¼æ ¸å¿ƒç‰¹å¾ï¼‰\n    onCreate(want: Want, launchParam: AbilityConstant.LaunchParam) {\n        // ç”Ÿæˆæ—¶é—´æˆ³ä½œä¸ºå®ä¾‹å”¯ä¸€IDï¼ŒåŒºåˆ†ä¸åŒå®ä¾‹\n        const instanceId = `å®ä¾‹ID_${Date.now()}`;\n        hilog.info(DOMAIN, TAG, `å¤šå®ä¾‹åˆ›å»ºæˆåŠŸï¼š${instanceId}`);\n    }\n\n    // åŠ è½½å¤šå®ä¾‹å¯¹åº”é¡µé¢\n    onWindowStageCreate(windowStage: window.WindowStage): void {\n        windowStage.loadContent('pages/MultitonPage')\n            .catch((err: BusinessError) =&gt; {\n                hilog.error(DOMAIN, TAG, `é¡µé¢åŠ è½½å¤±è´¥ï¼š${err.message}`);\n            });\n    }\n}\n</code></pre>\n<h5 id=\"2åˆ›å»º-multitonpage\">ï¼ˆ2ï¼‰åˆ›å»º MultitonPage</h5>\n<p>é€‰ä¸­ <code>src/main/ets/pages</code> â†’ å³é”® â†’ New â†’ Page â†’ å‘½åä¸º <code>MultitonPage</code>ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-javascript\">@Entry\n@Component\nstruct MultitonPage {\n    @State message: string = 'å¤šå®ä¾‹ï¼ˆmultitonï¼‰æ¨¡å¼é¡µé¢';\n    // æ˜¾ç¤ºå½“å‰å®ä¾‹åˆ›å»ºæ—¶é—´ï¼Œç›´è§‚åŒºåˆ†ä¸åŒå®ä¾‹\n    @State createTime: string = `åˆ›å»ºæ—¶é—´ï¼š${new Date().toLocaleTimeString()}`;\n\n    build() {\n        Column({ space: 20, alignItems: ItemAlign.Center }) {\n            Text(this.message)\n                .fontSize(30)\n                .fontWeight(FontWeight.Bold);\n                \n            Text(this.createTime)\n                .fontSize(20)\n                .fontColor(Color.Blue);\n                \n            Text('æ¯æ¬¡ç‚¹å‡»å¯åŠ¨éƒ½ä¼šåˆ›å»ºæ–°å®ä¾‹ï¼Œå®ä¾‹ç›¸äº’ç‹¬ç«‹')\n                .fontSize(16)\n                .fontColor(Color.Grey);\n        }\n        .width('100%')\n        .height('100%')\n        .justifyContent(FlexAlign.Center);\n    }\n}\n</code></pre>\n<h4 id=\"3-specified-æ¨¡å¼specifiedability--specifiedpage\">3. specified æ¨¡å¼ï¼šSpecifiedAbility + SpecifiedPage</h4>\n<h5 id=\"1åˆ›å»º-specifiedability\">ï¼ˆ1ï¼‰åˆ›å»º SpecifiedAbility</h5>\n<p>é€‰ä¸­ <code>src/main/ets</code> â†’ å³é”® â†’ New â†’ Ability â†’ å‘½åä¸º <code>SpecifiedAbility</code>ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼ˆæ ¸å¿ƒï¼šå¤ç”¨å®ä¾‹æ—¶è§¦å‘ onNewWantï¼‰ï¼š</p>\n<pre><code class=\"language-javascript\">import { UIAbility, AbilityConstant, Want } from '@kit.AbilityKit';\nimport { window, AppStorage } from '@kit.ArkUI';\nimport { hilog } from '@kit.PerformanceAnalysisKit';\nimport { BusinessError } from '@ohos.base';\n\nconst TAG = 'SpecifiedAbility';\nconst DOMAIN = 0x0000;\n\nexport default class SpecifiedAbility extends UIAbility {\n    private currentInstanceKey: string = 'default';\n\n    // æ–°æ ‡è¯†ï¼šåˆ›å»ºå®ä¾‹æ—¶è§¦å‘\n    onCreate(want: Want, launchParam: AbilityConstant.LaunchParam) {\n        this.currentInstanceKey = `${want.parameters?.instanceKey}` || 'default';\n        // åŒæ­¥æ ‡è¯†åˆ°é¡µé¢ï¼Œç”¨äºå±•ç¤º\n        AppStorage.setOrCreate('instanceKey', `å½“å‰å®ä¾‹Keyï¼š${this.currentInstanceKey}`);\n        hilog.info(DOMAIN, TAG, `æŒ‡å®šå®ä¾‹åˆ›å»ºæˆåŠŸï¼š${this.currentInstanceKey}`);\n    }\n\n    // åŒæ ‡è¯†ï¼šå¤ç”¨å®ä¾‹æ—¶è§¦å‘ï¼ˆæ ¸å¿ƒï¼Œæ›¿ä»£onCreateï¼‰\n    onNewWant(want: Want, launchParam: AbilityConstant.LaunchParam) {\n        this.currentInstanceKey = `${want.parameters?.instanceKey}` || 'default';\n        AppStorage.setOrCreate('instanceKey', `å½“å‰å®ä¾‹Keyï¼š${this.currentInstanceKey}`);\n        hilog.info(DOMAIN, TAG, `æŒ‡å®šå®ä¾‹å¤ç”¨æˆåŠŸï¼š${this.currentInstanceKey}`);\n    }\n\n    // åŠ è½½æŒ‡å®šå®ä¾‹å¯¹åº”é¡µé¢\n    onWindowStageCreate(windowStage: window.WindowStage): void {\n        windowStage.loadContent('pages/SpecifiedPage')\n            .catch((err: BusinessError) =&gt; {\n                hilog.error(DOMAIN, TAG, `é¡µé¢åŠ è½½å¤±è´¥ï¼š${err.message}`);\n            });\n    }\n}\n</code></pre>\n<h5 id=\"2åˆ›å»º-specifiedpage\">ï¼ˆ2ï¼‰åˆ›å»º SpecifiedPage</h5>\n<p>é€‰ä¸­ <code>src/main/ets/pages</code> â†’ å³é”® â†’ New â†’ Page â†’ å‘½åä¸º <code>SpecifiedPage</code>ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼ˆé€šè¿‡ AppStorage åŒæ­¥å®ä¾‹æ ‡è¯†ï¼‰ï¼š</p>\n<pre><code class=\"language-javascript\">@Entry\n@Component\nstruct SpecifiedPage {\n    @State message: string = 'æŒ‡å®šå®ä¾‹ï¼ˆspecifiedï¼‰æ¨¡å¼é¡µé¢';\n    // åŒå‘ç»‘å®šAbilityä¸­çš„å®ä¾‹æ ‡è¯†ï¼Œå®æ—¶æ›´æ–°\n    @StorageLink('instanceKey') instanceKey: string = 'å½“å‰å®ä¾‹Keyï¼šdefault';\n\n    build() {\n        Column({ space: 20, alignItems: ItemAlign.Center }) {\n            Text(this.message)\n                .fontSize(30)\n                .fontWeight(FontWeight.Bold);\n                \n            Text(this.instanceKey)\n                .fontSize(20)\n                .fontColor(Color.Green);\n                \n            Text('ç›¸åŒKeyå¤ç”¨å®ä¾‹ï¼Œä¸åŒKeyåˆ›å»ºæ–°å®ä¾‹')\n                .fontSize(16)\n                .fontColor(Color.Grey);\n        }\n        .width('100%')\n        .height('100%')\n        .justifyContent(FlexAlign.Center);\n    }\n}\n</code></pre>\n<h4 id=\"4-æµ‹è¯•é¦–é¡µhomepageå¯åŠ¨å„æ¨¡å¼-ability-å…¥å£\">4. æµ‹è¯•é¦–é¡µï¼šHomePageï¼ˆå¯åŠ¨å„æ¨¡å¼ Ability å…¥å£ï¼‰</h4>\n<p>ä¿®æ”¹ <code>src/main/ets/pages/Home.ets</code>ï¼Œå®ç°ä¸‰ä¸ªæ¨¡å¼çš„å¯åŠ¨æŒ‰é’®ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-javascript\">import { common, Want } from '@kit.AbilityKit';\nimport { getContext } from '@kit.ArkUI';\nimport { BusinessError } from '@ohos.base';\n\n@Entry\n@Component\nstruct Home {\n    @State message: string = 'UIAbility å¯åŠ¨æ¨¡å¼æµ‹è¯•';\n    // è·å–é¡µé¢ä¸Šä¸‹æ–‡ï¼Œç”¨äºå¯åŠ¨Ability\n    private context: common.UIAbilityContext = getContext(this) as common.UIAbilityContext;\n\n    // å¯åŠ¨multitonæ¨¡å¼ï¼ˆå¤šå®ä¾‹ï¼‰\n    private launchMultiton() {\n        const want: Want = {\n            bundleName: 'com.sanxiu.firstapp',\n            abilityName: 'MultitonAbility',\n            parameters: { timestamp: Date.now().toString() }\n        };\n        this.context.startAbility(want).catch((err: BusinessError) =&gt; {\n            console.error('å¯åŠ¨å¤šå®ä¾‹å¤±è´¥ï¼š', err);\n        });\n    }\n\n    // å¯åŠ¨specifiedæ¨¡å¼ï¼ˆæŒ‡å®šå®ä¾‹ï¼Œä¼ å‚instanceKeyï¼‰\n    private launchSpecified(key: string) {\n        const want: Want = {\n            bundleName: 'com.sanxiu.firstapp',\n            abilityName: 'SpecifiedAbility',\n            parameters: { instanceKey: key }\n        };\n        this.context.startAbility(want).catch((err: BusinessError) =&gt; {\n            console.error(`å¯åŠ¨æŒ‡å®šå®ä¾‹${key}å¤±è´¥ï¼š`, err);\n        });\n    }\n\n    build() {\n        Column({ space: 15, alignItems: ItemAlign.Center }) {\n            Text(this.message)\n                .fontSize(30)\n                .fontWeight(FontWeight.Bold)\n                .margin(20);\n            \n            // å•å®ä¾‹æ¨¡å¼ï¼ˆé»˜è®¤EntryAbilityï¼Œæ­¤å¤„ä»…ä½œè¯´æ˜ï¼‰\n            Text('singletonï¼šå…¨å±€å”¯ä¸€ï¼ˆå½“å‰é¦–é¡µï¼‰')\n                .fontSize(16)\n                .fontColor(Color.Grey);\n            \n            // å¤šå®ä¾‹æ¨¡å¼å¯åŠ¨æŒ‰é’®\n            Button('å¯åŠ¨multitonï¼ˆå¤šå®ä¾‹ï¼‰', { type: ButtonType.Capsule })\n                .width('80%')\n                .height(50)\n                .onClick(() =&gt; this.launchMultiton());\n            \n            // æŒ‡å®šå®ä¾‹æ¨¡å¼å¯åŠ¨æŒ‰é’®ï¼ˆä¸åŒKeyï¼‰\n            Button('å¯åŠ¨specifiedï¼ˆKey=chat_1001ï¼‰', { type: ButtonType.Capsule })\n                .width('80%')\n                .height(50)\n                .onClick(() =&gt; this.launchSpecified('chat_1001'));\n                \n            Button('å¯åŠ¨specifiedï¼ˆKey=chat_1002ï¼‰', { type: ButtonType.Capsule })\n                .width('80%')\n                .height(50)\n                .onClick(() =&gt; this.launchSpecified('chat_1002'));\n                \n            Button('å†æ¬¡å¯åŠ¨specifiedï¼ˆKey=chat_1001ï¼‰', { type: ButtonType.Capsule })\n                .width('80%')\n                .height(50)\n                .onClick(() =&gt; this.launchSpecified('chat_1001'));\n        }\n        .width('100%')\n        .height('100%')\n        .justifyContent(FlexAlign.Center);\n    }\n}\n</code></pre>\n<h3 id=\"å››ç¬¬ä¸‰æ­¥é…ç½®æ–‡ä»¶ä¿®æ”¹æ ¸å¿ƒå¯åŠ¨æ¨¡å¼--abilitystage\">ï¼ˆå››ï¼‰ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ–‡ä»¶ä¿®æ”¹ï¼ˆæ ¸å¿ƒï¼šå¯åŠ¨æ¨¡å¼ + AbilityStageï¼‰</h3>\n<h4 id=\"1-é¡µé¢è·¯ç”±æ³¨å†Œmain_pagesjson\">1. é¡µé¢è·¯ç”±æ³¨å†Œï¼šmain_pages.json</h4>\n<p>é€šè¿‡pageåˆ›å»ºçš„é¡µé¢ï¼Œè·¯ç”±è·¯å¾„è‡ªåŠ¨ç”Ÿæˆï¼Œé€šè¿‡ArkTS File åˆ›å»ºéœ€æ‰‹åŠ¨ç®¡ç†è·¯ç”±ã€‚<br />\nè·¯ç”±è·¯å¾„ï¼š<code>src/main/resources/base/profile/main_pages.json</code></p>\n<pre><code class=\"language-json\">{\n  \"src\": [\n    \"pages/Index\",\n    \"pages/Home\",\n    \"pages/MultitonPage\",\n    \"pages/SpecifiedPage\"\n  ]\n}\n</code></pre>\n<h4 id=\"2-æ¨¡å—æ ¸å¿ƒé…ç½®modulejson5å¯åŠ¨æ¨¡å¼--abilitystage-é…ç½®\">2. æ¨¡å—æ ¸å¿ƒé…ç½®ï¼šmodule.json5ï¼ˆå¯åŠ¨æ¨¡å¼ + AbilityStage é…ç½®ï¼‰</h4>\n<p>åˆ›å»ºAbilityçš„æ—¶å€™ç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨<code>abilities</code>åˆ›å»ºå¯¹åº”çš„é…ç½®ï¼Œä½†éœ€è¦æ‰‹åŠ¨ä¿®æ”¹å¯åŠ¨æ¨¡å¼ã€‚è‡ªå®šä¹‰AbilityStageéœ€æ‰‹åŠ¨é…ç½®åŠ è½½è·¯å¾„ã€‚ä¿®æ”¹å®Œæˆåæ‰‹åŠ¨Sync NowåŒæ­¥é…ç½®.</p>\n<pre><code class=\"language-json\">{\n  \"module\": {\n    \"name\": \"entry\",\n    \"type\": \"entry\",\n    \"description\": \"$string:module_desc\",\n    \"srcEntry\": \"./ets/application/MyAbilityStage.ets\", // æ‰‹åŠ¨æ–°å¢\n    \"mainElement\": \"EntryAbility\",\n    \"deviceTypes\": [\n      \"phone\"\n    ],\n    \"deliveryWithInstall\": true,\n    \"installationFree\": false,\n    \"pages\": \"$profile:main_pages\",\n    \"abilities\": [\n      {\n        \"name\": \"EntryAbility\",\n        \"srcEntry\": \"./ets/entryability/EntryAbility.ets\",\n        \"description\": \"$string:EntryAbility_desc\",\n        \"icon\": \"$media:layered_image\",\n//        \"label\": \"$string:EntryAbility_label\",\n        \"startWindowIcon\": \"$media:app_module_icon\",\n        \"startWindowBackground\": \"$color:start_window_background\",\n        \"exported\": true,\n        \"launchType\": \"singleton\",  // é»˜è®¤çš„å¯åŠ¨æ¨¡å¼ï¼Œå¯ä»¥ä¸å†™\n\n        \"skills\": [\n          {\n            \"entities\": [\n              \"entity.system.home\"\n            ],\n            \"actions\": [\n              \"ohos.want.action.home\"\n            ]\n          }\n        ]\n      },\n      {\n        \"name\": \"MultitonAbility\",\n        \"launchType\": \"multiton\", // å¤šå®ä¾‹æ¨¡å¼\n        \"srcEntry\": \"./ets/multitonability/MultitonAbility.ets\",\n        \"description\": \"$string:MultitonAbility_desc\",\n        \"icon\": \"$media:layered_image\",\n        \"label\": \"$string:MultitonAbility_label\",\n        \"startWindowIcon\": \"$media:startIcon\",\n        \"startWindowBackground\": \"$color:start_window_background\"\n      },\n      {\n        \"name\": \"SpecifiedAbility\",\n        \"launchType\": \"specified\", // æŒ‡å®šæ¨¡å¼\n        \"srcEntry\": \"./ets/specifiedability/SpecifiedAbility.ets\",\n        \"description\": \"$string:SpecifiedAbility_desc\",\n        \"icon\": \"$media:layered_image\",\n        \"label\": \"$string:SpecifiedAbility_label\",\n        \"startWindowIcon\": \"$media:startIcon\",\n        \"startWindowBackground\": \"$color:start_window_background\"\n      }\n    ],\n    \"extensionAbilities\": [\n      {\n        \"name\": \"EntryBackupAbility\",\n        \"srcEntry\": \"./ets/entrybackupability/EntryBackupAbility.ets\",\n        \"type\": \"backup\",\n        \"exported\": false,\n        \"metadata\": [\n          {\n            \"name\": \"ohos.extension.backup\",\n            \"resource\": \"$profile:backup_config\"\n          }\n        ],\n      }\n    ]\n  }\n}\n</code></pre>\n<h3 id=\"äº”ç¬¬å››æ­¥é…ç½®ä¸åŠŸèƒ½éªŒè¯\">ï¼ˆäº”ï¼‰ç¬¬å››æ­¥ï¼šé…ç½®ä¸åŠŸèƒ½éªŒè¯</h3>\n<h4 id=\"1-abilitystage-é…ç½®éªŒè¯\">1. AbilityStage é…ç½®éªŒè¯</h4>\n<p>è¿è¡Œé¡¹ç›®åï¼ŒæŸ¥çœ‹æ—¥å¿—æ§åˆ¶å°ï¼Œè‹¥è¾“å‡ºä»¥ä¸‹æ—¥å¿—ï¼Œè¯´æ˜è‡ªå®šä¹‰ AbilityStage åˆå§‹åŒ–æˆåŠŸï¼š</p>\n<pre><code>[Sample_StartMode] MyAbilityStage åˆå§‹åŒ–æˆåŠŸ\n</code></pre>\n<h4 id=\"2-ä¸‰ç§æ¨¡å¼è¡Œä¸ºéªŒè¯\">2. ä¸‰ç§æ¨¡å¼è¡Œä¸ºéªŒè¯</h4>\n<table>\n<thead>\n<tr>\n<th>æ“ä½œ</th>\n<th>é¢„æœŸç°è±¡</th>\n<th>éªŒè¯ç‚¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å¤šæ¬¡ç‚¹å‡»ã€Œå¯åŠ¨multitonã€</td>\n<td>æ¯æ¬¡ç”Ÿæˆæ–°çª—å£ï¼Œåˆ›å»ºæ—¶é—´ä¸åŒ</td>\n<td>å¤šå®ä¾‹æ¨¡å¼æ¯æ¬¡è§¦å‘onCreate</td>\n</tr>\n<tr>\n<td>é¦–æ¬¡ç‚¹å‡»ã€ŒKey=chat_1001ã€</td>\n<td>ç”Ÿæˆæ–°çª—å£ï¼Œæ˜¾ç¤ºKey=chat_1001</td>\n<td>æŒ‡å®šå®ä¾‹æ–°æ ‡è¯†è§¦å‘onCreate</td>\n</tr>\n<tr>\n<td>å†æ¬¡ç‚¹å‡»ã€ŒKey=chat_1001ã€</td>\n<td>å¤ç”¨åŸæœ‰çª—å£ï¼Œæ—¥å¿—è¾“å‡ºâ€œå¤ç”¨æˆåŠŸâ€</td>\n<td>æŒ‡å®šå®ä¾‹åŒæ ‡è¯†è§¦å‘onNewWant</td>\n</tr>\n<tr>\n<td>ç‚¹å‡»ã€ŒKey=chat_1002ã€</td>\n<td>ç”Ÿæˆæ–°çª—å£ï¼Œæ˜¾ç¤ºKey=chat_1002</td>\n<td>æŒ‡å®šå®ä¾‹ä¸åŒæ ‡è¯†è§¦å‘onCreate</td>\n</tr>\n<tr>\n<td>é‡å¤è¿”å›é¦–é¡µå†æ‰“å¼€</td>\n<td>singletonæ¨¡å¼å§‹ç»ˆä¸ºåŒä¸€ä¸ªçª—å£</td>\n<td>å•å®ä¾‹æ¨¡å¼å…¨å±€å”¯ä¸€</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å››æ ¸å¿ƒå·®å¼‚æ€»ç»“ä¸‰ç§å¯åŠ¨æ¨¡å¼å¯¹æ¯”\">å››ã€æ ¸å¿ƒå·®å¼‚æ€»ç»“ï¼šä¸‰ç§å¯åŠ¨æ¨¡å¼å¯¹æ¯”</h2>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>singletonï¼ˆå•å®ä¾‹ï¼‰</th>\n<th>multitonï¼ˆå¤šå®ä¾‹ï¼‰</th>\n<th>specifiedï¼ˆæŒ‡å®šå®ä¾‹ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å®ä¾‹æ•°é‡</td>\n<td>å…¨å±€å”¯ä¸€</td>\n<td>æ— é™åˆ¶ï¼Œæ¯æ¬¡æ–°å»º</td>\n<td>æŒ‰æ ‡è¯†åˆ†ç»„ï¼Œæ¯ç»„ä¸€ä¸ª</td>\n</tr>\n<tr>\n<td>å¤ç”¨è§„åˆ™</td>\n<td>å§‹ç»ˆå¤ç”¨å·²æœ‰å®ä¾‹</td>\n<td>æ°¸ä¸å¤ç”¨ï¼Œæ¯æ¬¡æ–°å»º</td>\n<td>ç›¸åŒæ ‡è¯†å¤ç”¨ï¼Œä¸åŒæ ‡è¯†æ–°å»º</td>\n</tr>\n<tr>\n<td>æ ¸å¿ƒç”Ÿå‘½å‘¨æœŸ</td>\n<td>é¦–æ¬¡onCreateï¼Œåç»­onNewWant</td>\n<td>æ¯æ¬¡å¯åŠ¨å‡onCreate</td>\n<td>æ–°æ ‡è¯†onCreateï¼ŒåŒæ ‡è¯†onNewWant</td>\n</tr>\n<tr>\n<td>ä¾èµ–AbilityStage</td>\n<td>å¦</td>\n<td>å¦</td>\n<td>æ˜¯ï¼ˆå¿…é¡»è‡ªå®šä¹‰å®ç°ï¼‰</td>\n</tr>\n<tr>\n<td>å…³é”®å‚æ•°</td>\n<td>æ— </td>\n<td>æ— </td>\n<td>instanceKeyï¼ˆä¸šåŠ¡å”¯ä¸€æ ‡è¯†ï¼‰</td>\n</tr>\n<tr>\n<td>é€‚ç”¨åœºæ™¯</td>\n<td>ä¸»ç•Œé¢ã€ä¸ªäººä¸­å¿ƒã€è´­ç‰©è½¦</td>\n<td>å¤šæ ‡ç­¾é¡µã€å¤šæ–‡æ¡£ç¼–è¾‘</td>\n<td>èŠå¤©çª—å£ã€å•†å“è¯¦æƒ…é¡µã€æŒ‰ä¸šåŠ¡éš”ç¦»</td>\n</tr>\n<tr>\n<td>é”™è¯¯ç æ³¨æ„</td>\n<td>å¯åŠ¨ä¸­é‡å¤è°ƒç”¨è¿”å›16000082</td>\n<td>æ— </td>\n<td>æ ‡è¯†ä¸å”¯ä¸€ä¼šå¯¼è‡´å®ä¾‹é”™è¯¯å¤ç”¨</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"äº”å®æ“å…³é”®æ³¨æ„äº‹é¡¹\">äº”ã€å®æ“å…³é”®æ³¨æ„äº‹é¡¹</h2>\n<ol>\n<li><strong>é…ç½®ç”Ÿæ•ˆè§„åˆ™</strong>ï¼šä¿®æ”¹ module.json5ï¼ˆå¯åŠ¨æ¨¡å¼/AbilityStageï¼‰ æˆ– AbilityStage ä»£ç åï¼Œ<strong>çƒ­é‡è½½/çƒ­æ›´æ–°å‡ä¸ç”Ÿæ•ˆ</strong>ï¼Œå¿…é¡»<strong>åœæ­¢åº”ç”¨è¿›ç¨‹ â†’ é‡æ–°è¿è¡Œé¡¹ç›®</strong>ï¼Œå¦åˆ™ç³»ç»Ÿæ— æ³•è¯†åˆ«é…ç½®å˜æ›´ã€‚</li>\n<li><strong>AbilityStage è·¯å¾„æ ¡éªŒ</strong>ï¼š<code>srcEntry</code> è·¯å¾„å¿…é¡»ä¸å®é™…æ–‡ä»¶è·¯å¾„å®Œå…¨ä¸€è‡´ï¼Œé¸¿è’™ç³»ç»Ÿ<strong>ä¸¥æ ¼åŒºåˆ†å¤§å°å†™</strong>ï¼Œè·¯å¾„é”™è¯¯ä¼šå¯¼è‡´ AbilityStage åˆå§‹åŒ–å¤±è´¥ã€‚</li>\n<li><strong>instanceKey åˆ¤ç©º</strong>ï¼šåœ¨ AbilityStage çš„ onAcceptWant æ–¹æ³•ä¸­ï¼Œå¿…é¡»å¯¹ instanceKey åšç©ºå€¼åˆ¤æ–­ï¼Œé¿å…å› å‚æ•°ç¼ºå¤±å¯¼è‡´æ ‡è¯†ç”Ÿæˆå¤±è´¥ã€‚</li>\n<li><strong>æ ‡è¯†å”¯ä¸€æ€§</strong>ï¼šonAcceptWant è¿”å›çš„æ ‡è¯†å¿…é¡»<strong>å…¨å±€å”¯ä¸€</strong>ï¼Œå»ºè®®æ‹¼æ¥ AbilityName + ä¸šåŠ¡å”¯ä¸€å€¼ï¼Œé¿å…ä¸åŒ Ability çš„æ ‡è¯†å†²çªã€‚</li>\n<li><strong>AppStorage ä½œç”¨</strong>ï¼šspecified æ¨¡å¼ä¸­ï¼Œé€šè¿‡ AppStorage + @StorageLink å®ç° Ability ä¸é¡µé¢çš„<strong>çŠ¶æ€åŒå‘åŒæ­¥</strong>ï¼Œå¤ç”¨å®ä¾‹æ—¶é¡µé¢èƒ½å®æ—¶æ›´æ–°ä¸šåŠ¡æ ‡è¯†ã€‚</li>\n<li><strong>onNewWant æ ¸å¿ƒ</strong>ï¼šspecified/singleton æ¨¡å¼ä¸­ï¼Œå¤ç”¨å®ä¾‹æ—¶ä¸ä¼šè§¦å‘ onCreateï¼Œæ‰€æœ‰å¯åŠ¨å‚æ•°çš„å¤„ç†å¿…é¡»æ”¾åœ¨ <strong>onNewWant</strong> æ–¹æ³•ä¸­ï¼Œå¦åˆ™ä¼šå¯¼è‡´å‚æ•°ä¸¢å¤±ã€‚</li>\n</ol>\n<h2 id=\"å…­å†…å®¹æ€»ç»“\">å…­ã€å†…å®¹æ€»ç»“</h2>\n<ol>\n<li>å¯åŠ¨æ¨¡å¼çš„<strong>æœ¬è´¨</strong>æ˜¯ã€Œç³»ç»Ÿå¯¹ UIAbility å®ä¾‹çš„ç®¡ç†ç­–ç•¥ã€ï¼Œæ ¸å¿ƒè§£å†³â€œåˆ›å»ºæ–°å®ä¾‹è¿˜æ˜¯å¤ç”¨å·²æœ‰å®ä¾‹â€çš„é—®é¢˜ã€‚</li>\n<li>ä¸‰ç§æ¨¡å¼å„æœ‰é€‚ç”¨åœºæ™¯ï¼Œæ ¸å¿ƒé€‰æ‹©ä¾æ®æ˜¯<strong>ã€Œä¸šåŠ¡æ˜¯å¦éœ€è¦å”¯ä¸€å®ä¾‹ã€</strong>å’Œ<strong>ã€Œæ˜¯å¦éœ€è¦æŒ‰ä¸šåŠ¡ç»´åº¦éš”ç¦»å®ä¾‹ã€</strong>ã€‚</li>\n<li>AbilityStage æ˜¯<strong>æ¨¡å—çº§ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨</strong>ï¼Œä¹Ÿæ˜¯ specified æ¨¡å¼çš„<strong>å¿…è¦æ¡ä»¶</strong>ï¼Œå…¶æ ¸å¿ƒä½œç”¨æ˜¯ä¸º specified æ¨¡å¼ç”Ÿæˆ<strong>å®ä¾‹å”¯ä¸€æ ‡è¯†</strong>ã€‚</li>\n<li>specified æ¨¡å¼çš„æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š<strong>å¯åŠ¨ä¼ å‚ instanceKey â†’ AbilityStage ç”Ÿæˆå”¯ä¸€æ ‡è¯† â†’ ç³»ç»ŸæŒ‰æ ‡è¯†åŒ¹é…/å¤ç”¨å®ä¾‹ â†’ å¤ç”¨è§¦å‘ onNewWant</strong>ã€‚</li>\n<li>ç”Ÿå‘½å‘¨æœŸè”åŠ¨çš„æ ¸å¿ƒè§„åˆ™ï¼š<strong>åˆ›å»ºå®ä¾‹è§¦å‘ onCreateï¼Œå¤ç”¨å®ä¾‹è§¦å‘ onNewWant</strong>ï¼ŒonWindowStageCreate/onForeground ç­‰æ–¹æ³•ä¸å—å¯åŠ¨æ¨¡å¼å½±å“ï¼ŒæŒ‰éœ€è§¦å‘ã€‚</li>\n</ol>\n<h2 id=\"ä¸ƒä»£ç ä»“åº“\">ä¸ƒã€ä»£ç ä»“åº“</h2>\n<ul>\n<li>å·¥ç¨‹åç§°ï¼šFirstApplication</li>\n<li>ä»“åº“åœ°å€ï¼š<a href=\"https://gitee.com/HarmonyOS-UI-Basics/harmony-os-ui-basics.git\" rel=\"noopener nofollow\" target=\"_blank\">https://gitee.com/HarmonyOS-UI-Basics/harmony-os-ui-basics.git</a></li>\n</ul>\n<h2 id=\"å…«ä¸‹èŠ‚é¢„å‘Š\">å…«ã€ä¸‹èŠ‚é¢„å‘Š</h2>\n<p>ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†å­¦ä¹  <strong>Contextä¸Šä¸‹æ–‡æ ¸å¿ƒè®²è§£ä¸å®æˆ˜</strong>ï¼Œé‡ç‚¹æŒæ¡ï¼š</p>\n<ol>\n<li>ç†è§£ Context æ ¸å¿ƒå®šä½åŠâ€œåº”ç”¨â†’æ¨¡å—â†’ç»„ä»¶â†’UIå®ä¾‹â€å±‚çº§å…³ç³»ï¼Œèƒ½ç²¾å‡†è·å–å„å±‚çº§ Context å®ä¾‹ï¼›</li>\n<li>æŒæ¡ 5 ç±» Context é«˜é¢‘æ ¸å¿ƒèƒ½åŠ›ï¼ˆæ–‡ä»¶è®¿é—®ã€ç¯å¢ƒç›‘å¬ã€åŠ å¯†åˆ†åŒºã€UIäº¤äº’ã€æ‰©å±•èƒ½åŠ›ï¼‰ï¼Œå®ç°åŸºç¡€ä¸šåŠ¡é—­ç¯ï¼›</li>\n<li>æ˜ç¡® Context èƒ½åŠ›è¾¹ç•Œä¸æ ¸å¿ƒçº¦æŸï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œè§„é¿å¼€å‘è¸©å‘ï¼›</li>\n<li>åŒºåˆ†ä¸åŒ Context é€‚ç”¨åœºæ™¯ï¼Œèƒ½ç»“åˆå®é™…ä¸šåŠ¡é€‰æ‹©æœ€ä¼˜ä¸Šä¸‹æ–‡ã€‚</li>\n</ol>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-09 11:33</span>&nbsp;\n<a href=\"https://www.cnblogs.com/san-xiu\">é¸¿è’™-æ•£ä¿®</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">6</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨#11-ImmutableçŠ¶æ€ç»´æŠ¤ä¸å¢é‡æ¸²æŸ“",
      "link": "https://www.cnblogs.com/WindrunnerMax/p/19594114",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/WindrunnerMax/p/19594114\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-09 10:51\">\n    <span>ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨#11-ImmutableçŠ¶æ€ç»´æŠ¤ä¸å¢é‡æ¸²æŸ“</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>åœ¨å…ˆå‰æˆ‘ä»¬è®¨è®ºäº†è§†å›¾å±‚çš„é€‚é…å™¨è®¾è®¡ï¼Œä¸»è¦æ˜¯å…¨é‡çš„è§†å›¾åˆå§‹åŒ–æ¸²æŸ“ï¼ŒåŒ…æ‹¬ç”Ÿå‘½å‘¨æœŸåŒæ­¥ã€çŠ¶æ€ç®¡ç†ã€æ¸²æŸ“æ¨¡å¼ã€<code>DOM</code>æ˜ å°„çŠ¶æ€ç­‰ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å¤„ç†å˜æ›´çš„å¢é‡æ›´æ–°ï¼Œè¿™å±äºæ€§èƒ½æ–¹é¢çš„è€ƒé‡ï¼Œéœ€è¦è€ƒè™‘å¦‚ä½•å®ç°ä¸å¯å˜çš„çŠ¶æ€å¯¹è±¡ï¼Œä»¥æ­¤æ¥å®ç°<code>Op</code>æ“ä½œä»¥åŠæœ€å°åŒ–<code>DOM</code>å˜æ›´ã€‚</p>\n<ul>\n<li>å¼€æºåœ°å€: <a href=\"https://github.com/WindRunnerMax/BlockKit\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/WindRunnerMax/BlockKit</a></li>\n<li>åœ¨çº¿ç¼–è¾‘: <a href=\"https://windrunnermax.github.io/BlockKit/\" rel=\"noopener nofollow\" target=\"_blank\">https://windrunnermax.github.io/BlockKit/</a></li>\n<li>é¡¹ç›®ç¬”è®°: <a href=\"https://github.com/WindRunnerMax/BlockKit/blob/master/NOTE.md\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/WindRunnerMax/BlockKit/blob/master/NOTE.md</a></li>\n</ul>\n<details>\n<strong>ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ç³»åˆ—æ–‡ç« </strong>\n<ul>\n<li><a href=\"https://www.cnblogs.com/WindrunnerMax/p/18816107\" target=\"_blank\">æ·±æ„Ÿä¸€æ— æ‰€é•¿ï¼Œå‡†å¤‡è¯•ç€ä»é›¶å¼€å§‹å†™ä¸ªå¯Œæ–‡æœ¬ç¼–è¾‘å™¨</a></li>\n<li><a href=\"https://www.cnblogs.com/WindrunnerMax/p/18826249\" target=\"_blank\">ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨#2-åŸºäºMVCæ¨¡å¼çš„ç¼–è¾‘å™¨æ¶æ„è®¾è®¡</a></li>\n<li><a href=\"https://www.cnblogs.com/WindrunnerMax/p/18840221\" target=\"_blank\">ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨#3-åŸºäºDeltaçš„çº¿æ€§æ•°æ®ç»“æ„æ¨¡å‹</a></li>\n<li><a href=\"https://www.cnblogs.com/WindrunnerMax/p/18899981\" target=\"_blank\">ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨#4-æµè§ˆå™¨é€‰åŒºæ¨¡å‹çš„æ ¸å¿ƒäº¤äº’ç­–ç•¥</a></li>\n<li><a href=\"https://www.cnblogs.com/WindrunnerMax/p/18921725\" target=\"_blank\">ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨#5-ç¼–è¾‘å™¨é€‰åŒºæ¨¡å‹çš„çŠ¶æ€ç»“æ„è¡¨è¾¾</a></li>\n<li><a href=\"https://www.cnblogs.com/WindrunnerMax/p/19022750\" target=\"_blank\">ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨#6-æµè§ˆå™¨é€‰åŒºä¸ç¼–è¾‘å™¨é€‰åŒºæ¨¡å‹åŒæ­¥</a></li>\n<li><a href=\"https://www.cnblogs.com/WindrunnerMax/p/19069539\" target=\"_blank\">ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨#7-åŸºäºç»„åˆäº‹ä»¶çš„åŠå—æ§è¾“å…¥æ¨¡å¼</a></li>\n<li><a href=\"https://www.cnblogs.com/WindrunnerMax/p/19152103\" target=\"_blank\">ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨#8-æµè§ˆå™¨è¾“å…¥æ¨¡å¼çš„éå—æ§DOMè¡Œä¸º</a></li>\n<li><a href=\"https://www.cnblogs.com/WindrunnerMax/p/19381254\" target=\"_blank\">ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨#9-ç¼–è¾‘å™¨æ–‡æœ¬ç»“æ„å˜æ›´çš„å—æ§å¤„ç†</a></li>\n<li><a href=\"https://www.cnblogs.com/WindrunnerMax/p/19470679\" target=\"_blank\">ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨#10-Reactè§†å›¾å±‚é€‚é…å™¨çš„æ¨¡å¼æ‰©å±•</a></li>\n<li><a href=\"\" rel=\"noopener nofollow\">ä»é›¶å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨#11-ImmutableçŠ¶æ€ç»´æŠ¤ä¸å¢é‡æ¸²æŸ“</a></li>\n</ul>\n</details>\n<h2 id=\"è¡Œçº§ä¸å¯å˜çŠ¶æ€\">è¡Œçº§ä¸å¯å˜çŠ¶æ€</h2>\n<p>åœ¨è¿™é‡Œæˆ‘ä»¬å…ˆä¸å¼•å…¥è§†å›¾å±‚çš„æ¸²æŸ“é—®é¢˜ï¼Œè€Œæ˜¯ä»…åœ¨<code>Model</code>å±‚é¢ä¸Šå®ç°ç²¾ç»†åŒ–çš„å¤„ç†ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯å®ç°ä¸å¯å˜çš„çŠ¶æ€å¯¹è±¡ï¼Œä»…æ›´æ–°çš„èŠ‚ç‚¹æ‰ä¼šè¢«é‡æ–°åˆ›å»ºï¼Œå…¶ä»–èŠ‚ç‚¹åˆ™ç›´æ¥å¤ç”¨ã€‚ç”±æ­¤æƒ³æ¥æ­¤æ¨¡å—çš„å®ç°é¢‡ä¸ºå¤æ‚ï¼Œä¹Ÿå¹¶æœªå¼•å…¥<code>immer</code>ç­‰æ¡†æ¶ï¼Œè€Œæ˜¯ç›´æ¥å¤„ç†çš„çŠ¶æ€å¯¹è±¡ï¼Œå› æ­¤å…ˆä»ç®€å•çš„æ›´æ–°æ¨¡å¼å¼€å§‹è€ƒè™‘ã€‚</p>\n<p>å›åˆ°æœ€å¼€å§‹å®ç°çš„<code>State</code>æ¨¡å—æ›´æ–°æ–‡æ¡£å†…å®¹ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥é‡å»ºäº†æ‰€æœ‰çš„<code>LineState</code>ä»¥åŠ<code>LeafState</code>å¯¹è±¡ï¼Œç„¶ååœ¨<code>React</code>è§†å›¾å±‚çš„<code>BlockModel</code>ä¸­ç›‘å¬äº†<code>OnContentChange</code>äº‹ä»¶ï¼Œä»¥æ­¤æ¥å°†<code>BlockState</code>çš„æ›´æ–°åº”ç”¨åˆ°è§†å›¾å±‚ã€‚</p>\n<pre><code class=\"language-js\">delta.eachLine((line, attributes, index) =&gt; {\n  const lineState = new LineState(line, attributes, this);\n  lineState.index = index;\n  lineState.start = offset;\n  lineState.key = Key.getId(lineState);\n  offset = offset + lineState.length;\n  this.lines[index] = lineState;\n});\n</code></pre>\n<p>è¿™ç§æ–¹å¼ç®€å•ç›´æ¥ï¼Œå…¨é‡æ›´æ–°çŠ¶æ€èƒ½å¤Ÿä¿è¯åœ¨<code>React</code>çš„çŠ¶æ€æ›´æ–°ï¼Œç„¶è€Œè¿™ç§æ–¹å¼çš„é—®é¢˜åœ¨äºæ€§èƒ½ã€‚å½“æ–‡æ¡£å†…å®¹éå¸¸å¤§çš„æ—¶å€™ï¼Œå…¨é‡è®¡ç®—å°†ä¼šå¯¼è‡´å¤§é‡çš„çŠ¶æ€é‡å»ºï¼Œå¹¶ä¸”å…¶æœ¬èº«çš„æ”¹å˜ä¹Ÿä¼šå¯¼è‡´<code>React</code>çš„<code>diff</code>å·®å¼‚è¿›è€Œå…¨é‡æ›´æ–°æ–‡æ¡£è§†å›¾ï¼Œè¿™æ ·çš„æ€§èƒ½å¼€é”€é€šå¸¸æ˜¯ä¸å¯æ¥å—çš„ã€‚</p>\n<p>é‚£ä¹ˆé€šå¸¸æ¥è¯´æˆ‘ä»¬å°±éœ€è¦åŸºäºå˜æ›´æ¥ç¡®å®šçŠ¶æ€çš„æ›´æ–°ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®å®šæ›´æ–°çš„ç²’åº¦ï¼Œä¾‹å¦‚ä»¥è¡Œä¸ºåŸºå‡†åˆ™æœªå˜æ›´çš„æ—¶å€™å°±ç›´æ¥å–åŸæœ‰çš„<code>LineState</code>ã€‚ç›¸å½“äºå°½å¯èƒ½å¤ç”¨<code>Origin List</code>ç„¶åç”Ÿæˆ<code>Target List</code>ï¼Œè¿™æ ·çš„æ–¹å¼è‡ªç„¶å¯ä»¥é¿å…éƒ¨åˆ†çŠ¶æ€çš„é‡å»ºï¼Œå°½å¯èƒ½å¤ç”¨åŸæœ¬çš„å¯¹è±¡ã€‚</p>\n<p>æ•´ä½“æ€è·¯å¤§æ¦‚æ˜¯å…ˆæ‰§è¡Œå˜æˆç”Ÿæˆæœ€æ–°çš„åˆ—è¡¨ï¼Œç„¶ååˆ†åˆ«è®¾ç½®æ—§åˆ—è¡¨å’Œæ–°åˆ—è¡¨çš„<code>row</code>å’Œ<code>col</code>ä¸¤ä¸ªæŒ‡é’ˆå€¼ï¼Œç„¶åæ›´æ–°æ—¶è®°å½•èµ·å§‹<code>row</code>ï¼Œåˆ é™¤å’Œæ–°å¢è‡ªç„¶æ˜¯æ­£å¸¸å¤„ç†ï¼Œå¯¹äºæ›´æ–°åˆ™è®¤ä¸ºæ˜¯å…ˆåˆ åå¢ã€‚å¯¹äºå†…å®¹çš„å¤„ç†åˆ™éœ€è¦åˆ†åˆ«è®¨è®ºå•è¡Œå’Œè·¨è¡Œçš„é—®é¢˜ï¼Œä¸­é—´éƒ¨åˆ†çš„å†…å®¹å°±ä½œä¸ºé‡å»ºçš„æ“ä½œã€‚</p>\n<p>æœ€åå¯ä»¥å°†è¿™éƒ¨åˆ†å¢åˆ <code>LineState</code>æ•°æ®æ”¾ç½®äº<code>Changes</code>ä¸­ï¼Œå°±å¯ä»¥å¾—åˆ°å®é™…å¢åˆ çš„<code>Ops</code>äº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¼˜åŒ–éƒ¨åˆ†çš„æ€§èƒ½ï¼Œå› ä¸ºä»…åŸåˆ—è¡¨å’Œç›®æ ‡åˆ—è¡¨çš„ä¸­é—´éƒ¨åˆ†æ‰ä¼šé‡å»ºï¼Œå…¶ä»–éƒ¨åˆ†çš„è¡ŒçŠ¶æ€ç›´æ¥å¤ç”¨ã€‚æ­¤å¤–è¿™éƒ¨åˆ†æ•°æ®åœ¨<code>apply</code>çš„<code>delta</code>ä¸­æ˜¯ä¸å­˜åœ¨çš„ï¼ŒåŒæ ·å¯ä»¥è®¤ä¸ºæ˜¯æ•°æ®çš„è¡¥å……ã€‚</p>\n<pre><code class=\"language-js\">  Origin List (Old)                          Target List (New)\n+-------------------+                      +-------------------+\n| [0] LineState A   | &lt;---- Retain ------&gt; | [0] LineState A   | (Reused)\n+-------------------+                      +-------------------+\n| [1] LineState B   |          |           | [1] LineState B2  | (Update)\n+-------------------+       Changes        |     (Modified)    | (Del C)\n| [2] LineState C   |          |           +-------------------+\n+-------------------+          V           | [2] NewState X    | (Inserted)\n| [3] LineState D   | ---------------\\     +-------------------+\n+-------------------+                 \\--&gt; | [3] LineState D   | (Reused)\n| [4] LineState E   | &lt;---- Retain ------&gt; | [4] LineState E   | (Reused)\n+-------------------+                      +-------------------+\n</code></pre>\n<p>é‚£ä¹ˆè¿™é‡Œå®é™…ä¸Šæ˜¯å­˜åœ¨éå¸¸éœ€è¦å…³æ³¨çš„ç‚¹ï¼Œæˆ‘ä»¬ç°åœ¨ç»´æŠ¤çš„æ˜¯çŠ¶æ€æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„æ›´æ–°å°±ä¸å†æ˜¯ç›´æ¥çš„<code>compose</code>ï¼Œè€Œæ˜¯æ“ä½œæˆ‘ä»¬å®ç°çš„çŠ¶æ€å¯¹è±¡ã€‚æœ¬è´¨ä¸Šæˆ‘ä»¬æ˜¯éœ€è¦å®ç°è¡Œçº§åˆ«çš„<code>compose</code>æ–¹æ³•ï¼Œè¿™é‡Œçš„å®ç°éå¸¸é‡è¦ï¼Œå‡å¦‚æˆ‘ä»¬å¯¹äºæ•°æ®çš„å¤„ç†å­˜åœ¨åå·®çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´çŠ¶æ€å‡ºç°é—®é¢˜ã€‚</p>\n<p>æ­¤å¤–åœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬åˆ¤æ–­<code>LineState</code>æ˜¯å¦éœ€è¦æ–°å»ºåˆ™æ˜¯æ ¹æ®æ•´ä¸ªè¡Œå†…çš„æ‰€æœ‰<code>LeafState</code>æ¥é‡å»ºçš„ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ç§æ—¶å€™æˆ‘ä»¬æ˜¯éœ€è¦å†æ¬¡å°†æ‰€æœ‰çš„<code>op</code>éå†ä¸€éï¼Œå½“ç„¶å®é™…ä¸Šç”±äºæœ€åè¿˜éœ€è¦å°†<code>compose</code>åçš„<code>Delta</code>åˆ‡å‰²ä¸ºè¡Œçº§åˆ«çš„å†…å®¹ï¼Œæ‰€ä»¥å…¶å®å³ä½¿åœ¨åº”ç”¨å˜æ›´åä¹Ÿæœ€å°‘éœ€è¦å†éå†ä¸¤æ¬¡ã€‚</p>\n<p>é‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬éœ€è¦æ€è€ƒä¼˜åŒ–æ–¹å‘ï¼Œé¦–å…ˆæ˜¯é¦–ä¸ª<code>retain</code>ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åº”è¯¥ç›´æ¥å®Œæ•´å¤ç”¨åŸæœ¬çš„<code>LineState</code>ï¼ŒåŒ…æ‹¬å¤„ç†åçš„å‰©ä½™èŠ‚ç‚¹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è€Œå¯¹äºä¸­é—´çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸ºå…¶ç‹¬ç«‹è®¾è®¡æ›´æ–°ç­–ç•¥ï¼Œè¿™éƒ¨åˆ†ç†è®ºä¸Šæ¥è¯´æ˜¯éœ€è¦å®Œå…¨ç‹¬ç«‹å¤„ç†ä¸ºæ–°çš„çŠ¶æ€å¯¹è±¡çš„ï¼Œè¿™æ ·å¯ä»¥å‡å°‘éƒ¨åˆ†<code>Leaf Op</code>çš„éå†ã€‚</p>\n<pre><code class=\"language-js\">new Delta().retain(5).insert(\"xx\")\ninsert(\"123\"), insert(\"\\n\") // skip \ninsert(\"456\"), insert(\"\\n\") // new line state\n</code></pre>\n<p>å…¶ä¸­ï¼Œå¦‚æœæ˜¯æ–°å»ºçš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ç›´æ¥æ„å»ºæ–°çš„<code>LineState</code>å³å¯ï¼Œåˆ é™¤çš„èŠ‚ç‚¹åˆ™ä¸ä»åŸæœ¬çš„<code>LineState</code>ä¸­æ”¾ç½®äºæ–°çš„åˆ—è¡¨ã€‚è€Œå¯¹äºæ›´æ–°çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°åŸæœ¬çš„<code>LineState</code>å¯¹è±¡ï¼Œå› ä¸ºå®é™…ä¸Šè¡Œæ˜¯å­˜åœ¨æ›´æ–°çš„ï¼Œè€Œé‡ç‚¹æ˜¯æˆ‘ä»¬éœ€è¦å°†åŸæœ¬çš„<code>LineState</code>çš„<code>key</code>å€¼å¤ç”¨ã€‚</p>\n<p>è¿™é‡Œæˆ‘ä»¬å…ˆç®€å•å®ç°å®ç°æè¿°ä¸€ä¸‹å¤ç”¨çš„é—®é¢˜ï¼Œæ¯”è¾ƒæ–¹ä¾¿çš„å®ç°åˆ™æ˜¯ç›´æ¥ä»¥<code>\\n</code>çš„æ ‡è¯†ä¸ºç›®æ ‡çš„<code>State</code>ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬è¦ç‹¬ç«‹<code>\\n</code>ä¸ºç‹¬ç«‹çš„çŠ¶æ€ã€‚å³å¦‚æœåœ¨<code>123|456\\n</code>çš„<code>|</code>ä½ç½®æ’å…¥<code>\\n</code>çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ˜¯<code>123</code>æ˜¯æ–°çš„<code>LineState</code>ï¼Œ<code>456</code>æ˜¯åŸæœ¬çš„<code>LineState</code>ï¼Œä»¥æ­¤æ¥å®ç°<code>key</code>çš„å¤ç”¨ã€‚</p>\n<pre><code class=\"language-js\">[\n  insert(\"123\"), insert(\"\\n\"), \n  insert(\"456\"), insert(\"\\n\")\n]\n// ===&gt;\n[ \n  LineState(LeafState(\"123\"), LeafState(\"\\n\")), \n  LineState(LeafState(\"456\"), LeafState(\"\\n\"))\n]\n</code></pre>\n<p>å…¶å®è¿™é‡Œæœ‰ä¸ªéå¸¸å€¼å¾—å…³æ³¨çš„ç‚¹æ˜¯ï¼Œ<code>LineState</code>åœ¨<code>Delta</code>ä¸­æ˜¯æ²¡æœ‰å…·ä½“å¯¹åº”çš„<code>Op</code>çš„ï¼Œè€Œç›¸å¯¹åº”çš„<code>LeafState</code>åˆ™æ˜¯æœ‰å…·ä½“çš„<code>Op</code>çš„ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬åœ¨å¤„ç†<code>LineState</code>çš„æ›´æ–°æ—¶ï¼Œæ˜¯ä¸èƒ½ç›´æ¥æ ¹æ®å˜æ›´æ§åˆ¶çš„ï¼Œå› æ­¤å¿…é¡»è¦æ‰¾åˆ°èƒ½å¤Ÿæ˜ å°„çš„çŠ¶æ€ï¼Œå› æ­¤æœ€ç®€å•çš„æ–¹æ¡ˆå³æ ¹æ®<code>\\n</code>èŠ‚ç‚¹æ˜ å°„ã€‚</p>\n<pre><code class=\"language-js\">LeafState(\"\\n\", key=\"1\") &lt;=&gt; LineState(key=\"L1\")\n</code></pre>\n<p>å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€ä¸‹ï¼Œæœ€å¼€å§‹æˆ‘ä»¬è€ƒè™‘å…ˆæ›´æ–°å†<code>diff</code>ï¼Œåæ¥è€ƒè™‘çš„æ˜¯è¾¹æ›´æ–°è¾¹è®°å½•ã€‚è¾¹æ›´æ–°è¾¹è®°å½•çš„ä¼˜ç‚¹åœ¨äºï¼Œå¯ä»¥é¿å…å†æ¬¡éå†ä¸€è¾¹æ‰€æœ‰<code>Leaf</code>èŠ‚ç‚¹çš„æ¶ˆè€—ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é¿å…<code>diff</code>çš„å¤æ‚æ€§ã€‚ä½†æ˜¯è¿™é‡Œä¹Ÿå­˜åœ¨ä¸ªé—®é¢˜ï¼Œå¦‚æœå†…éƒ¨è¿›è¡Œäº†å¤šæ¬¡<code>retain</code>æ“ä½œï¼Œåˆ™æ— æ³•ç›´æ¥å¤ç”¨<code>LineState</code>ã€‚</p>\n<p>ä¸è¿‡é€šå¸¸æ¥è¯´ï¼Œæœ€é«˜é¢‘çš„æ“ä½œæ˜¯è¾“å…¥å†…å®¹ï¼Œè¿™ç§æƒ…å†µä¸‹é¦–æ“ä½œä¸€èˆ¬éƒ½æ˜¯<code>retain</code>ï¼Œå°¾æ“ä½œä¸ºç©ºä¼šæ”¶é›†å‰©ä½™æ–‡æ¡£å†…å®¹ï¼Œå› æ­¤è¿™éƒ¨åˆ†ä¼˜åŒ–æ˜¯ä¼šè¢«é«˜é¢‘è§¦å‘çš„ã€‚è€Œå¦‚æœæ˜¯å¤šæ¬¡çš„å†…å®¹éƒ¨åˆ†å˜æ›´æ“ä½œï¼Œè¿™éƒ¨åˆ†è™½ç„¶å¯ä»¥é€šè¿‡åˆ¤æ–­è¡Œå†…çš„å¶å­ç»“ç‚¹æ˜¯å¦å˜æ›´ï¼Œæ¥åˆ¤æ–­æ˜¯å¦å¤ç”¨è¡Œå¯¹è±¡ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€å®šå¤æ‚æ€§ã€‚</p>\n<p>å…³äºè¿™éƒ¨åˆ†çš„å…·ä½“å®ç°ï¼Œåœ¨ç¼–è¾‘å™¨çš„çŠ¶æ€æ¨¡å—é‡Œå­˜åœ¨ç‹¬ç«‹çš„<code>Mutate</code>æ¨¡å—ï¼Œè¿™éƒ¨åˆ†å®ç°åœ¨åè¾¹å®ç°å„ä¸ªæ¨¡å—æ—¶ä¼šç‹¬ç«‹ä»‹ç»ã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„<code>Immutable</code>çŠ¶æ€ç»´æŠ¤ï¼Œå¦‚æœ<code>Leaf</code>èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ä¹‹åï¼Œå…¶çˆ¶èŠ‚ç‚¹<code>Line</code>ä¼šè§¦å‘æ›´æ–°ï¼Œè€Œå…¶ä»–èŠ‚ç‚¹åˆ™å¯ä»¥ç›´æ¥å¤ç”¨ã€‚</p>\n<h2 id=\"key-å€¼ç»´æŠ¤\">Key å€¼ç»´æŠ¤</h2>\n<p>è‡³æ­¤æˆ‘ä»¬å®ç°äº†ä¸€å¥—ç®€å•çš„<code>Immutable Delta+Iterator</code>æ¥å¤„ç†æ›´æ–°ï¼Œè¿™ç§æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ©ä¸å¯å˜çš„æ–¹å¼æ¥å®ç°<code>React</code>è§†å›¾çš„æ›´æ–°ï¼Œé‚£ä¹ˆåœ¨<code>React</code>çš„æ¸²æŸ“æ¨¡å¼ä¸­ï¼Œ<code>key</code>å€¼çš„ç®¡ç†ä¹Ÿæ˜¯ä¸ªå€¼çš„æ¢è®¨çš„é—®é¢˜ã€‚</p>\n<p>åœ¨è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®çŠ¶æ€ä¸å¯å˜æ¥ç”Ÿæˆ<code>key</code>å€¼ï¼Œå€ŸåŠ©<code>WeakMap</code>æ˜ å°„å…³ç³»è·å–å¯¹åº”çš„å­—ç¬¦ä¸²<code>id</code>å€¼ï¼Œæ­¤æ—¶å°±å¯ä»¥å€ŸåŠ©<code>key</code>çš„ç®¡ç†ä»¥åŠ<code>React.memo</code>æ¥å®ç°è§†å›¾çš„å¤ç”¨ã€‚å…¶å®åœ¨è¿™é‡Œåˆæ­¥çœ‹èµ·æ¥<code>key</code>å€¼åº”è¯¥æ˜¯éœ€è¦ä¸»åŠ¨æ§åˆ¶å¼ºåˆ¶åˆ·æ–°çš„æ—¶å€™ï¼Œä»¥åŠå®Œå…¨æ˜¯æ–°èŠ‚ç‚¹æ‰ä¼šç”¨å¾—åˆ°çš„ã€‚</p>\n<p>ä½†æ˜¯è¿™ç§æ–¹å¼ä¹Ÿæ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºæ­¤æ—¶æˆ‘ä»¬å³ä½¿è¾“å…¥ç®€å•çš„å†…å®¹ï¼Œä¹Ÿä¼šå¯¼è‡´æ•´ä¸ªè¡Œçš„<code>key</code>å‘ç”Ÿæ”¹å˜ï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬æ˜¯ä¸å¿…è¦æ›´æ–°æ­¤æ—¶çš„<code>key</code>çš„ã€‚å› æ­¤<code>key</code>å€¼æ˜¯éœ€è¦å•ç‹¬ç»´æŠ¤çš„ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ä¸å¯å˜çš„å¯¹è±¡æ¥ç´¢å¼•<code>key</code>å€¼ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯ç›´æ¥ä½¿ç”¨<code>index</code>ä½œä¸º<code>key</code>å€¼çš„è¯ï¼Œå°±ä¼šå­˜åœ¨æ½œåœ¨çš„åŸåœ°å¤ç”¨é—®é¢˜ã€‚</p>\n<p><code>key</code>å€¼åŸåœ°å¤ç”¨ä¼šå¯¼è‡´ç»„ä»¶çš„çŠ¶æ€è¢«é”™è¯¯ä¿ç•™ï¼Œä¾‹å¦‚æ­¤æ—¶æœ‰ä¸ªéå—æ§ç®¡ç†çš„<code>input</code>ç»„ä»¶åˆ—è¡¨ï¼Œåœ¨æŸä¸ªè¾“å…¥æ¡†å†…å·²ç»è¾“å…¥äº†å†…å®¹ï¼Œå½“å…¶å‘ç”Ÿé¡ºåºå˜åŒ–æ—¶ï¼ŒåŸå§‹è¾“å…¥å†…å®¹ä¼šè·Ÿéšç€åŸåœ°å¤ç”¨çš„ç­–ç•¥ç•™åœ¨åŸå§‹çš„ä½ç½®ï¼Œè€Œä¸æ˜¯è·Ÿéšåˆ°æ–°çš„ä½ç½®ï¼Œå› ä¸ºå…¶æ•´ä½“åˆ—è¡¨é¡ºåº<code>key</code>æœªå‘ç”Ÿå˜åŒ–å¯¼è‡´<code>React</code>ç›´æ¥å¤ç”¨èŠ‚ç‚¹ã€‚</p>\n<p>åœ¨<code>LineState</code>èŠ‚ç‚¹çš„<code>key</code>å€¼ç»´æŠ¤ä¸­ï¼Œå¦‚æœæ˜¯åˆå§‹å€¼åˆ™æ˜¯æ ¹æ®<code>state</code>å¼•ç”¨è‡ªå¢çš„å€¼ï¼Œåœ¨å˜æ›´çš„æ—¶å€™åˆ™æ˜¯å°½å¯èƒ½åœ°å¤ç”¨åŸå§‹è¡Œçš„<code>key</code>ï¼Œè¿™æ ·å¯ä»¥é¿å…è¿‡å¤šçš„è¡ŒèŠ‚ç‚¹é‡å»ºå¹¶ä¸”å¯ä»¥æ§åˆ¶æ•´è¡Œçš„å¼ºåˆ¶åˆ·æ–°ã€‚</p>\n<p>è€Œå¯¹äº<code>LeafState</code>èŠ‚ç‚¹çš„<code>key</code>å€¼æœ€å¼€å§‹æ˜¯ç›´æ¥ä½¿ç”¨<code>index</code>å€¼ï¼Œè¿™æ ·å®é™…ä¸Šä¼šå­˜åœ¨éšæ€§çš„é—®é¢˜ï¼Œè€Œå¦‚æœç›´æ¥æ ¹æ®<code>Immutable</code>æ¥ç”Ÿæˆ<code>key</code>å€¼çš„è¯ï¼Œä»»ä½•æ–‡æœ¬å†…å®¹çš„æ›´æ”¹éƒ½ä¼šå¯¼è‡´<code>key</code>å€¼æ”¹å˜è¿›è€Œå¯¼è‡´<code>DOM</code>èŠ‚ç‚¹çš„é¢‘ç¹é‡å»ºã€‚</p>\n<pre><code class=\"language-js\">export const NODE_TO_KEY = new WeakMap&lt;Object.Any, Key&gt;();\nexport class Key {\n  /** å½“å‰èŠ‚ç‚¹ id */\n  public id: string;\n  /** è‡ªåŠ¨é€’å¢æ ‡è¯†ç¬¦ */\n  public static n = 0;\n\n  constructor() {\n    this.id = `${Key.n++}`;\n  }\n\n  /**\n   * æ ¹æ®èŠ‚ç‚¹è·å– id\n   * @param node\n   */\n  public static getId(node: Object.Any): string {\n    let key = NODE_TO_KEY.get(node);\n    if (!key) {\n      key = new Key();\n      NODE_TO_KEY.set(node, key);\n    }\n    return key.id;\n  }\n}\n</code></pre>\n<p>é€šå¸¸ä½¿ç”¨<code>index</code>ä½œä¸º<code>key</code>æ˜¯å¯è¡Œçš„ï¼Œç„¶è€Œåœ¨ä¸€äº›éå—æ§åœºæ™¯ä¸‹åˆ™ä¼šç”±äºåŸåœ°å¤ç”¨é€ æˆæ¸²æŸ“é—®é¢˜ï¼Œ<code>diff</code>ç®—æ³•å¯¼è‡´çš„æ€§èƒ½é—®é¢˜æˆ‘ä»¬æš‚æ—¶å…ˆä¸è€ƒè™‘ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ¯æ¬¡æˆ‘ä»¬éƒ½æ˜¯ä»æ•°ç»„é¡¶éƒ¨åˆ é™¤å…ƒç´ ï¼Œè€Œå®é™…çš„<code>input</code>å€¼æ•ˆæœè¡¨ç°å‡ºæ¥åˆ™æ˜¯åˆ é™¤äº†å°¾éƒ¨çš„å…ƒç´ ï¼Œè¿™å°±æ˜¯åŸåœ°å¤ç”¨çš„é—®é¢˜ã€‚åœ¨éå—æ§åœºæ™¯ä¸‹æ¯”è¾ƒæ˜æ˜¾ï¼Œè€Œæˆ‘ä»¬çš„<code>ContentEditable</code>ç»„ä»¶å°±æ˜¯ä¸€ä¸ªéå—æ§åœºæ™¯ï¼Œå› æ­¤è¿™é‡Œçš„<code>key</code>å€¼éœ€è¦å†è€ƒè™‘ä¸€ä¸‹ã€‚</p>\n<pre><code class=\"language-js\">const { useState, Fragment, useRef, useEffect } = React;\nfunction App() {\n  const ref = useRef&lt;HTMLParagraphElement&gt;(null);\n  const [nodes, setNodes] = useState(() =&gt; Array.from({ length: 10 }, (_, i) =&gt; i));\n\n  const onClick = () =&gt; {\n    const [_, ...rest] = nodes;\n    console.log(rest);\n    setNodes(rest);\n  };\n\n  useEffect(() =&gt; {\n    const el = ref.current;\n    el &amp;&amp; Array.from(el.children).forEach((it, i) =&gt; ((it as HTMLInputElement).value = i + \"\"));\n  }, []);\n\n  return (\n    &lt;Fragment&gt;\n      &lt;p ref={ref}&gt;\n        {nodes.map((_, i) =&gt; (&lt;input key={i}&gt;&lt;/input&gt;))}\n      &lt;/p&gt;\n      &lt;button onClick={onClick}&gt;slice&lt;/button&gt;\n    &lt;/Fragment&gt;\n  );\n}\n</code></pre>\n<p>è€ƒè™‘åˆ°å…ˆå‰æåˆ°çš„æˆ‘ä»¬ä¸å¸Œæœ›ä»»ä½•æ–‡æœ¬å†…å®¹çš„æ›´æ”¹éƒ½å¯¼è‡´<code>key</code>å€¼æ”¹å˜å¼•å‘é‡å»ºï¼Œå› æ­¤å°±ä¸èƒ½ç›´æ¥ä½¿ç”¨è®¡ç®—çš„<code>immutable</code>å¯¹è±¡å¼•ç”¨æ¥å¤„ç†<code>key</code>å€¼ï¼Œè€Œæè¿°å•ä¸ª<code>op</code>çš„æ–¹æ³•é™¤äº†<code>insert</code>å°±åªå‰©ä¸‹<code>attributes</code>äº†ã€‚</p>\n<p>ä½†æ˜¯å¦‚æœåŸºäº<code>attributes</code>æ¥è·å¾—å°±éœ€è¦ç²¾å‡†æ§åˆ¶åˆå¹¶<code>insert</code>çš„æ—¶å€™å–éœ€è¦å–æ—§çš„å¯¹è±¡å¼•ç”¨ï¼Œä¸”æ²¡æœ‰å±æ€§çš„<code>op</code>å°±ä¸å¥½å¤„ç†äº†ï¼Œå› æ­¤è¿™é‡Œå¯èƒ½åªèƒ½å°†å…¶è½¬ä¸ºå­—ç¬¦ä¸²å¤„ç†ï¼Œä½†æ˜¯è¿™æ ·åŒæ ·ä¸èƒ½ä¿æŒ<code>key</code>çš„å®Œå…¨ç¨³å®šï¼Œå› æ­¤å‰å€¼çš„ç´¢å¼•æ”¹å˜å°±ä¼šå¯¼è‡´åç»­çš„å€¼å‡ºç°å˜æ›´ã€‚</p>\n<pre><code class=\"language-js\">const prefix = new WeakMap&lt;LineState, Record&lt;string, number&gt;&gt;();\nconst suffix = new WeakMap&lt;LineState, Record&lt;string, number&gt;&gt;();\nconst mapToString = (map: Record&lt;string, string&gt;): string =&gt; {\n  return Object.keys(map)\n    .map(key =&gt; `${key}:${map[key]}`)\n    .join(\",\");\n};\nconst toKey = (state: LineState, op: Op): string =&gt; {\n  const key = op.attributes ? mapToString(op.attributes) : \"\";\n  const prefixMap = prefix.get(state) || {};\n  prefix.set(state, prefixMap);\n  const suffixMap = suffix.get(state) || {};\n  suffix.set(state, suffixMap);\n  const prefixKey = prefixMap[key] ? prefixMap[key] + 1 : 0;\n  const suffixKey = suffixMap[key] ? suffixMap[key] + 1 : 0;\n  prefixMap[key] = prefixKey;\n  suffixMap[key] = suffixKey;\n  return `${prefixKey}-${suffixKey}`;\n};\n</code></pre>\n<p>åœ¨<code>slate</code>ä¸­æˆ‘å…ˆå‰è®¤ä¸ºç”Ÿæˆçš„<code>key</code>è·ŸèŠ‚ç‚¹æ˜¯å®Œå…¨ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œä¾‹å¦‚å½“<code>A</code>èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œå…¶ä»£è¡¨çš„å±‚çº§<code>key</code>å¿…ç„¶ä¼šå‘ç”Ÿå˜åŒ–ã€‚ç„¶è€Œåœ¨å…³æ³¨è¿™ä¸ªé—®é¢˜ä¹‹åï¼Œæˆ‘å‘ç°å…¶åœ¨æ›´æ–°ç”Ÿæˆæ–°çš„<code>Node</code>ä¹‹åï¼Œä¼šåŒæ­¥æ›´æ–°<code>Path</code>ä»¥åŠ<code>PathRef</code>å¯¹åº”çš„<code>Node</code>èŠ‚ç‚¹æ‰€å¯¹åº”çš„<code>key</code>å€¼ã€‚</p>\n<pre><code class=\"language-js\">for (const [pathRef, key] of pathRefMatches) {\n  if (pathRef.current) {\n    const [node] = Editor.node(e, pathRef.current)\n    NODE_TO_KEY.set(node, key)\n  }\n  pathRef.unref()\n}\n</code></pre>\n<p>åœ¨åç»­è§‚å¯Ÿ<code>Lexical</code>å®ç°çš„é€‰åŒºæ¨¡å‹æ—¶ï¼Œå‘ç°å…¶æ˜¯ç”¨<code>key</code>å€¼å”¯ä¸€åœ°æ ‡è¯†æ¯ä¸ªå¶å­ç»“ç‚¹çš„ï¼Œé€‰åŒºä¹Ÿæ˜¯åŸºäº<code>key</code>å€¼æ¥æè¿°çš„ã€‚æ•´ä½“è¡¨è¾¾ä¸Šæ¯”è¾ƒç±»ä¼¼äº<code>Slate</code>çš„é€‰åŒºç»“æ„ï¼Œæˆ–è€…è¯´æ˜¯<code>DOM</code>æ ‘çš„ç»“æ„ã€‚è¿™é‡Œä»…ä»…æ˜¯å€¼å¾—<code>Range</code>é€‰åŒºï¼Œ<code>Lexical</code>å®é™…ä¸Šè¿˜æœ‰å…¶ä»–ä¸‰ç§é€‰åŒºç±»å‹ã€‚</p>\n<pre><code class=\"language-js\">{\n  anchor: { key: \"51\", offset: 2, type: \"text\" },\n  focus: { key: \"51\", offset: 3, type: \"text\" }\n}\n</code></pre>\n<p>åœ¨è¿™é‡Œæ¯”è¾ƒé‡è¦çš„æ˜¯<code>key</code>å€¼å˜æ›´æ—¶çš„çŠ¶æ€ä¿æŒï¼Œå› ä¸ºç¼–è¾‘å™¨çš„å†…å®¹å®é™…ä¸Šæ˜¯éœ€è¦ç¼–è¾‘çš„ã€‚ç„¶è€Œå¦‚æœåšåˆ°<code>immutable</code>è¯ï¼Œå¾ˆæ˜æ˜¾ç›´æ¥æ ¹æ®çŠ¶æ€å¯¹è±¡çš„å¼•ç”¨æ¥æ˜ å°„<code>key</code>ä¼šå¯¼è‡´æ•´ä¸ªç¼–è¾‘å™¨<code>DOM</code>æ— æ•ˆçš„é‡å»ºã€‚ä¾‹å¦‚è°ƒæ•´æ ‡é¢˜çš„ç­‰çº§ï¼Œå°±ç”±äºæ•´ä¸ªè¡Œ<code>key</code>çš„å˜åŒ–å¯¼è‡´æ•´è¡Œé‡å»ºã€‚</p>\n<p>é‚£ä¹ˆå¦‚ä½•å°½å¯èƒ½åœ°å¤ç”¨<code>key</code>å€¼å°±æˆäº†éœ€è¦ç ”ç©¶çš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„ç¼–è¾‘å™¨è¡Œçº§åˆ«çš„<code>key</code>æ˜¯è¢«ç‰¹æ®Šç»´æŠ¤çš„ï¼Œå³å®ç°äº†<code>immutable</code>ä»¥åŠ<code>key</code>å€¼å¤ç”¨ã€‚è€Œç›®å‰å¶å­çŠ¶æ€çš„<code>key</code>ä¾èµ–äº†<code>index</code>å€¼ï¼Œå› æ­¤å¦‚æœè°ƒç ”<code>Lexical</code>çš„å®ç°ï¼ŒåŒæ ·å¯ä»¥å°†å…¶åº”ç”¨åˆ°æˆ‘ä»¬çš„<code>key</code>å€¼ç»´æŠ¤ä¸­ã€‚</p>\n<p>é€šè¿‡åœ¨<code>playground</code>ä¸­è°ƒè¯•å¯ä»¥å‘ç°ï¼Œå³ä½¿æˆ‘ä»¬ä¸èƒ½å¾—çŸ¥å…¶æ˜¯å¦ä¸º<code>immutable</code>çš„å®ç°ï¼Œä¾ç„¶å¯ä»¥å‘ç°<code>Lexical</code>çš„<code>key</code>æ˜¯ä»¥ä¸€ç§åå·¦çš„æ–¹å¼ç»´æŠ¤ã€‚å› æ­¤åœ¨æˆ‘ä»¬çš„ç¼–è¾‘å™¨å®ç°ä¸­ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©åŒæ ·çš„æ–¹å¼ï¼Œåˆå¹¶ç›´æ¥ä»¥å·¦å€¼ä¸ºå‡†å¤ç”¨ï¼Œæ‹†åˆ†æ—¶è‹¥ä»¥<code>0</code>èµ·å§‹ç›´æ¥å¤ç”¨ï¼Œèµ·å§‹é<code>0</code>åˆ™åˆ›å»ºæ–°<code>key</code>ã€‚</p>\n<ol>\n<li><code>[123456(key1)][789(bold-key2)]</code>æ–‡æœ¬ï¼Œå°†<code>789</code>çš„åŠ ç²—å–æ¶ˆï¼Œæ•´æ®µæ–‡æœ¬çš„<code>key</code>å€¼ä¿æŒä¸º<code>key1</code>ã€‚</li>\n<li><code>[123456789(key1)]]</code>æ–‡æœ¬ï¼Œå°†<code>789</code>è¿™æ®µæ–‡æœ¬åŠ ç²—ï¼Œå·¦ä¾§<code>123456</code>æ–‡æœ¬çš„<code>key</code>å€¼ä¿æŒä¸º<code>key1</code>ï¼Œ<code>789</code>åˆ™æ˜¯æ–°çš„<code>key</code>ã€‚</li>\n<li><code>[123456789(key1)]]</code>æ–‡æœ¬ï¼Œå°†<code>123</code>è¿™æ®µæ–‡æœ¬åŠ ç²—ï¼Œå·¦ä¾§<code>123</code>æ–‡æœ¬çš„<code>key</code>å€¼ä¿æŒä¸º<code>key1</code>ï¼Œ<code>456789</code>åˆ™æ˜¯æ–°çš„<code>key</code>ã€‚</li>\n<li><code>[123456789(key1)]]</code>æ–‡æœ¬ï¼Œå°†<code>456</code>è¿™æ®µæ–‡æœ¬åŠ ç²—ï¼Œå·¦ä¾§<code>123</code>æ–‡æœ¬çš„<code>key</code>å€¼ä¿æŒä¸º<code>key1</code>ï¼Œ<code>456</code>å’Œ<code>789</code>åˆ†åˆ«æ˜¯æ–°çš„<code>key</code>ã€‚</li>\n</ol>\n<p>å› æ­¤ï¼Œæ­¤æ—¶åœ¨ç¼–è¾‘å™¨ä¸­æˆ‘ä»¬ä¹Ÿæ˜¯ç”¨ç±»ä¼¼åå·¦çš„æ–¹å¼ç»´æŠ¤<code>key</code>ï¼Œç”±äºæˆ‘ä»¬éœ€è¦ä¿æŒ<code>immutable</code>ï¼Œæ‰€ä»¥è¿™é‡Œçš„è¡¨è¾¾å®é™…ä¸Šæ˜¯å°½å¯èƒ½å¤ç”¨å…ˆå‰çš„<code>key</code>çŠ¶æ€ã€‚è¿™é‡Œä¸<code>LineState</code>çš„<code>key</code>å€¼ç»´æŠ¤æ–¹å¼ç±»ä¼¼ï¼Œéƒ½æ˜¯å…ˆåˆ›å»ºçŠ¶æ€ç„¶åæ›´æ–°å…¶<code>key</code>å€¼ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹éœ€è¦å¤„ç†ã€‚</p>\n<pre><code class=\"language-js\">// èµ·å§‹ä¸è£å‰ªä½ç½®ç­‰åŒ NextOp =&gt; Immutable åŸåœ°å¤ç”¨ State\nif (offset === 0 &amp;&amp; op.insert.length &lt;= length) {\n  return nextLeaf;\n}\nconst newLeaf = new LeafState(retOp, nextLeaf.parent);\n// è‹¥ offset æ˜¯ 0, åˆ™ç›´æ¥å¤ç”¨åŸå§‹çš„ key å€¼\noffset === 0 &amp;&amp; newLeaf.updateKey(nextLeaf.key);\n</code></pre>\n<p>è¿™é‡Œè¿˜å­˜åœ¨å¦ä¸€ä¸ªå°é—®é¢˜ï¼Œæˆ‘ä»¬åˆ›å»º<code>LeafState</code>å°±ç«‹å³å»è·å¾—å¯¹åº”çš„<code>key</code>å€¼ï¼Œç„¶åå†è€ƒè™‘å»å¤ç”¨åŸå§‹çš„<code>key</code>å€¼ã€‚è¿™æ ·å…¶å®å°±ä¼šå¯¼è‡´å¾ˆå¤šä¸å†ä½¿ç”¨çš„<code>key</code>å€¼è¢«åˆ›å»ºï¼Œå¯¼è‡´æ¯æ¬¡æ›´æ–°çš„æ—¶å€™çœ‹èµ·æ¥<code>key</code>çš„æ•°å­—å·®å€¼æ¯”è¾ƒå¤§ã€‚å½“ç„¶è¿™å¹¶ä¸å½±å“æ•´ä½“çš„åŠŸèƒ½ä¸æ€§èƒ½ï¼Œåªæ˜¯è°ƒè¯•çš„æ—¶å€™çœ‹èµ·æ¥æ¯”è¾ƒæ€ªã€‚</p>\n<p>å› æ­¤æˆ‘ä»¬åœ¨è¿™é‡Œè¿˜å¯ä»¥ä¼˜åŒ–è¿™éƒ¨åˆ†è¡¨ç°ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨åˆ›å»ºçš„æ—¶å€™ä¸ä¼šå»ç«‹å³åˆ›å»º<code>key</code>å€¼ï¼Œè€Œæ˜¯åœ¨åˆå§‹åŒ–ä»¥åŠæ›´æ–°çš„æ—¶å€™å†ä»å¤–éƒ¨è®¾ç½®å…¶<code>key</code>å€¼ã€‚è¿™ä¸ªå®ç°å…¶å®è·Ÿ<code>index</code>ã€<code>offset</code>çš„å¤„ç†æ–¹å¼æ¯”è¾ƒç±»ä¼¼ï¼Œæˆ‘ä»¬æ•´ä½“åœ¨<code>update</code>æ—¶å¤„ç†æ‰€æœ‰çš„ç›¸å…³å€¼ï¼Œä¸”å¼€å‘æ¨¡å¼æ¸²æŸ“æ—¶è¿›è¡Œäº†ä¸¥æ ¼æ£€æŸ¥ã€‚</p>\n<pre><code class=\"language-js\">// BlockState\nlet offset = 0;\nthis.lines.forEach((line, index) =&gt; {\n  line.index = index;\n  line.start = offset;\n  line.key = line.key || Key.getId(line);\n  const size = line.isDirty ? line.updateLeaves() : line.length;\n  offset = offset + size;\n});\nthis.length = offset;\nthis.size = this.lines.length;\n</code></pre>\n<pre><code class=\"language-js\">// LineState\nlet offset = 0;\nconst ops: Op[] = [];\nthis.leaves.forEach((leaf, index) =&gt; {\n  ops.push(leaf.op);\n  leaf.offset = offset;\n  leaf.parent = this;\n  leaf.index = index;\n  offset = offset + leaf.length;\n  leaf.key = leaf.key || Key.getId(leaf);\n});\nthis._ops = ops;\nthis.length = offset;\nthis.isDirty = false;\nthis.size = this.leaves.length;\n</code></pre>\n<p>æ­¤å¤–ï¼Œåœ¨å®ç°å•å…ƒæµ‹è¯•æ—¶è¿˜å‘ç°ï¼Œåœ¨<code>leaf</code>ä¸Šç‹¬ç«‹ç»´æŠ¤äº†<code>key</code>å€¼ï¼Œé‚£ä¹ˆ<code>\\n</code>è¿™ä¸ªç‰¹æ®Šçš„èŠ‚ç‚¹è‡ªç„¶ä¹Ÿä¼šæœ‰ç‹¬ç«‹çš„<code>key</code>å€¼ã€‚è¿™ç§æƒ…å†µä¸‹åœ¨<code>line</code>çº§åˆ«ä¸Šç»´æŠ¤çš„<code>key</code>å€¼å€’æ˜¯ä¹Ÿå¯ä»¥ç›´æ¥å¤ç”¨<code>\\n</code>è¿™ä¸ª<code>leaf</code>çš„<code>key</code>å€¼ã€‚å½“ç„¶è¿™åªæ˜¯ç†è®ºä¸Šçš„å®ç°ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ„æƒ³ä¸åˆ°çš„åˆ·æ–°é—®é¢˜ã€‚</p>\n<h2 id=\"è§†å›¾å¢é‡æ¸²æŸ“\">è§†å›¾å¢é‡æ¸²æŸ“</h2>\n<p>åœ¨è§†å›¾æ¨¡å—æœ€å¼€å§‹çš„è®¾è®¡ä¸Šï¼Œæˆ‘ä»¬çš„çŠ¶æ€ç®¡ç†å½¢å¼æ˜¯ç›´æ¥å…¨é‡æ›´æ–°<code>Delta</code>ï¼Œç„¶åä½¿ç”¨<code>EachLine</code>éå†é‡å»ºæ‰€æœ‰çš„çŠ¶æ€ã€‚å¹¶ä¸”å®é™…ä¸Šæˆ‘ä»¬ç»´æŠ¤äº†<code>Delta</code>ä¸<code>State</code>ä¸¤ä¸ªæ•°æ®æ¨¡å‹ï¼Œå»ºç«‹å…¶å…³ç³»æ˜ å°„å…³ç³»æœ¬èº«ä¹Ÿæ˜¯ä¸€ç§æŸè€—ï¼Œæ¸²æŸ“çš„æ—¶å€™çš„ç›®æ ‡çŠ¶æ€æ˜¯<code>Delta</code>è€Œé<code>State</code>ã€‚</p>\n<p>è¿™æ ·çš„æ¨¡å‹å¿…ç„¶æ˜¯è€—è´¹æ€§èƒ½çš„ï¼Œæ¯æ¬¡<code>Apply</code>çš„æ—¶å€™éƒ½éœ€è¦å…¨é‡æ›´æ–°æ–‡æ¡£å¹¶ä¸”å†æ¬¡éå†åˆ†å‰²è¡ŒçŠ¶æ€ã€‚å½“ç„¶å®é™…ä¸Šåªæ˜¯è®¡ç®—è¿­ä»£çš„è¯ï¼Œå®é™…ä¸Šæ˜¯ä¸ä¼šå¤ªè¿‡äºè€—è´¹æ€§èƒ½ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æ¯æ¬¡éƒ½æ˜¯æ–°çš„å¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨æ›´æ–°è§†å›¾çš„æ—¶å€™ï¼Œæ›´å®¹æ˜“é€ æˆæ€§èƒ½çš„æŸè€—ï¼Œè®¡ç®—çš„æ€§èƒ½é€šå¸¸å¯æ¥å—ï¼Œè€Œè§†å›¾æ›´æ–°æ“ä½œ<code>DOM</code>æˆæœ¬æ›´é«˜ã€‚</p>\n<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¸Šè¾¹å¤ç”¨å…¶<code>key</code>å€¼ï¼Œè§£å†³çš„é—®é¢˜æ˜¯é¿å…æ•´ä¸ªè¡ŒçŠ¶æ€è§†å›¾<code>re-mount</code>ã€‚è€Œå³ä½¿å¤ç”¨äº†<code>key</code>å€¼ï¼Œå› ä¸ºé‡å»ºäº†æ•´ä¸ª<code>State</code>å®ä¾‹ï¼Œ<code>React</code>ä¹Ÿä¼šç»§ç»­åè¾¹çš„<code>re-render</code>æµç¨‹ã€‚å› æ­¤æˆ‘ä»¬åœ¨è¿™é‡Œéœ€è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•åœ¨æ— å˜æ›´çš„æƒ…å†µä¸‹å°½å¯èƒ½é¿å…å…¶è§†å›¾<code>re-render</code>ã€‚</p>\n<p>ç”±äºæˆ‘ä»¬å®ç°äº†è¡Œçº§ä¸å¯å˜çŠ¶æ€ç»´æŠ¤ï¼Œé‚£ä¹ˆåœ¨è§†å›¾ä¸­å°±å¯ä»¥ç›´æ¥å¯¹æ¯”çŠ¶æ€å¯¹è±¡çš„å¼•ç”¨æ˜¯å¦å˜åŒ–æ¥å†³å®šæ˜¯å¦éœ€è¦é‡æ¸²æŸ“ã€‚å› æ­¤åªéœ€è¦å¯¹äº<code>ViewModel</code>çš„èŠ‚ç‚¹è¡¥å……äº†<code>React.memo</code>ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹ç”šè‡³äºä¸éœ€è¦é‡å†™å¯¹æ¯”å‡½æ•°ï¼Œåªéœ€è¦ä¾èµ–æˆ‘ä»¬çš„<code>immutable</code>çŠ¶æ€å¤ç”¨èƒ½å¤Ÿæ­£å¸¸èµ·åˆ°æ•ˆæœã€‚</p>\n<pre><code class=\"language-js\">const LeafView: FC&lt;{ editor: Editor; leafState: LeafState; }&gt; = props =&gt; {\n  return (\n    &lt;span {...{ [LEAF_KEY]: true }} &gt;\n      {runtime.children}\n    &lt;/span&gt;\n  );\n}\nexport const LeafModel = React.memo(LeafView);\n</code></pre>\n<p>åŒæ ·çš„ï¼Œé’ˆå¯¹<code>LineView</code>ä¹Ÿéœ€è¦è¡¥å……<code>memo</code>ï¼Œè€Œä¸”ç”±äºç»„ä»¶å†…æœ¬èº«å¯èƒ½å­˜åœ¨çŠ¶æ€å˜åŒ–ï¼Œä¾‹å¦‚<code>Composing</code>ç»„åˆè¾“å…¥çš„æ§åˆ¶ï¼Œæ‰€ä»¥é’ˆå¯¹äºå†…éƒ¨èŠ‚ç‚¹çš„è®¡ç®—ä¹Ÿä¼šé‡‡ç”¨<code>useMemo</code>æ¥ç¼“å­˜ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—ã€‚</p>\n<pre><code class=\"language-js\">const LineView: FC&lt;{ editor: Editor; lineState: LineState; }&gt; = props =&gt; {\n  const elements = useMemo(() =&gt; {\n     // ...\n    return nodes;\n  }, [editor, lineState]);\n  return (\n    &lt;div {...{ [NODE_KEY]: true }} &gt;\n      {elements}\n    &lt;/div&gt;\n  );\n}\nexport const LineModel = React.memo(LineView);\n</code></pre>\n<p>è€Œè§†å›¾åˆ·æ–°ä»ç„¶è¿˜æ˜¯ç›´æ¥æ§åˆ¶<code>lines</code>è¿™ä¸ªçŠ¶æ€çš„å¼•ç”¨å³å¯ï¼Œç›¸å½“äºæ ¸å¿ƒå±‚çš„å†…å®¹å˜åŒ–ä¸è§†å›¾å±‚çš„é‡æ¸²æŸ“ï¼Œæ˜¯ç›´æ¥ä¾èµ–äºäº‹ä»¶æ¨¡å—é€šä¿¡å°±å¯ä»¥å®ç°çš„ã€‚ç”±äºæ¯æ¬¡å–<code>lines</code>çŠ¶æ€æ—¶éƒ½æ˜¯æ–°çš„å¼•ç”¨ï¼Œæ‰€ä»¥<code>React</code>ä¼šè®¤ä¸ºçŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œä»è€Œè§¦å‘é‡æ¸²æŸ“ã€‚</p>\n<pre><code class=\"language-js\">const onContentChange = useMemoFn(() =&gt; {\n  if (flushing.current) return void 0;\n  flushing.current = true;\n  Promise.resolve().then(() =&gt; {\n    flushing.current = false;\n    setLines(state.getLines());\n  });\n});\n</code></pre>\n<p>è€Œè™½ç„¶è§¦å‘äº†æ¸²æŸ“ï¼Œä½†æ˜¯ç”±äº<code>key</code>ä»¥åŠ<code>memo</code>çš„å­˜åœ¨ï¼Œä¼šä»¥<code>line</code>çš„çŠ¶æ€ä¸ºåŸºå‡†è¿›è¡Œå¯¹æ¯”ã€‚åªæœ‰<code>LineState</code>å¯¹è±¡çš„å¼•ç”¨å‘ç”Ÿäº†å˜åŒ–ï¼Œ<code>LineModel</code>è§†å›¾æ‰ä¼šè§¦å‘æ›´æ–°é€»è¾‘ï¼Œå¦åˆ™ä¼šå¤ç”¨åŸæœ‰çš„è§†å›¾ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¾èµ–<code>React</code>çš„<code>devtools</code>å½•åˆ¶æˆ–<code>Highlight</code>å°±å¯ä»¥è§‚å¯Ÿåˆ°ã€‚</p>\n<p>è§†å›¾å¢é‡æ›´æ–°è¿™éƒ¨åˆ†å…¶å®æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯å®ç°ä¸å¯å˜å¯¹è±¡ä»¥åŠ<code>key</code>å€¼ç»´æŠ¤çš„é€»è¾‘éƒ½åœ¨æ ¸å¿ƒå±‚å®ç°ï¼Œè§†å›¾å±‚ä¸»è¦æ˜¯ä¾èµ–å…¶åšè®¡ç®—ï¼Œå¯¹æ¯”æ˜¯å¦éœ€è¦é‡æ¸²æŸ“ã€‚å…¶å®ç±»ä¼¼çš„å®ç°åœ¨ä½ä»£ç çš„åœºæ™¯ä¸­ä¹Ÿå¯ä»¥åº”ç”¨ï¼Œæ¯•ç«Ÿå®é™…ä¸Šå¯Œæ–‡æœ¬ä¹Ÿå°±æ˜¯ç›¸å½“äºä¸€ä¸ªé›¶ä»£ç çš„ç¼–è¾‘å™¨ï¼Œåªä¸è¿‡ç»„è£…çš„ä¸æ˜¯ç»„ä»¶è€Œæ˜¯æ–‡æœ¬ã€‚</p>\n<h2 id=\"æ€»ç»“\">æ€»ç»“</h2>\n<p>åœ¨å…ˆå‰æˆ‘ä»¬ä¸»è¦è®¨è®ºäº†è§†å›¾å±‚çš„é€‚é…å™¨è®¾è®¡ï¼Œä¸»è¦æ˜¯å…¨é‡çš„è§†å›¾åˆå§‹åŒ–æ¸²æŸ“ï¼Œä»¥åŠçŠ¶æ€æ¨¡å‹åˆ°<code>DOM</code>ç»“æ„æ€§çš„è§„åˆ™è®¾å®šã€‚åœ¨è¿™é‡Œåˆ™ä¸»è¦è€ƒè™‘æ›´æ–°å¤„ç†æ—¶æ€§èƒ½çš„ä¼˜åŒ–ï¼Œä¸»è¦æ˜¯åœ¨å¢é‡æ›´æ–°æ—¶ï¼Œå¦‚ä½•æœ€å°åŒ–<code>DOM</code>ä»¥åŠ<code>Op</code>æ“ä½œã€<code>key</code>å€¼çš„ç»´æŠ¤ã€ä»¥åŠåœ¨<code>React</code>ä¸­å®ç°å¢é‡æ¸²æŸ“çš„æ–¹å¼ã€‚</p>\n<p>å…¶å®æ¥ä¸‹æ¥éœ€è¦è€ƒè™‘è¾“å…¥å†…å®¹æ—¶ï¼Œå¦‚ä½•é¿å…è§„å®šçš„<code>DOM</code>çš„ç»“æ„è¢«ç ´åï¼Œä¸»è¦æ¶‰åŠè„<code>DOM</code>æ£€æŸ¥ã€é€‰åŒºæ›´æ–°ã€æ¸²æŸ“<code>Hook</code>ç­‰ï¼Œè¿™éƒ¨åˆ†å†…å®¹åœ¨<code>#8</code>å’Œ<code>#9</code>çš„è¾“å…¥æ³•å¤„ç†ä¸­å·²ç»æœ‰äº†è¯¦ç»†çš„è®¨è®ºï¼Œå› æ­¤è¿™é‡Œå°±ä¸å†æ¬¡å±•å¼€äº†ã€‚</p>\n<p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦è®¨è®ºçš„æ˜¯ç¼–è¾‘èŠ‚ç‚¹çš„ç»„ä»¶é¢„è®¾ï¼Œä¾‹å¦‚é›¶å®½å­—ç¬¦ã€<code>Embed</code>èŠ‚ç‚¹ã€<code>Void</code>èŠ‚ç‚¹ç­‰ã€‚ä¸»è¦æ˜¯ä¸ºç¼–è¾‘å™¨çš„æ’ä»¶æ‰©å±•æä¾›é¢„è®¾çš„ç»„ä»¶ï¼Œåœ¨è¿™äº›ç»„ä»¶å†…å­˜åœ¨ä¸€äº›é»˜è®¤çš„è¡Œä¸ºï¼Œå¹¶ä¸”åŒæ ·é¢„è®¾äº†éƒ¨åˆ†<code>DOM</code>ç»“æ„ï¼Œä»¥æ­¤æ¥å®ç°åœ¨è§„å®šèŒƒå›´å†…çš„ç¼–è¾‘å™¨æ“ä½œã€‚</p>\n<h2 id=\"æ¯æ—¥ä¸€é¢˜\">æ¯æ—¥ä¸€é¢˜</h2>\n<ul>\n<li><a href=\"https://github.com/WindRunnerMax/EveryDay\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/WindRunnerMax/EveryDay</a></li>\n</ul>\n<h2 id=\"å‚è€ƒ\">å‚è€ƒ</h2>\n<ul>\n<li><a href=\"https://18.react.dev/\" rel=\"noopener nofollow\" target=\"_blank\">https://18.react.dev/</a></li>\n<li><a href=\"https://18.react.dev/reference/react/memo\" rel=\"noopener nofollow\" target=\"_blank\">https://18.react.dev/reference/react/memo</a></li>\n<li><a href=\"https://18.react.dev/reference/react/useMemo\" rel=\"noopener nofollow\" target=\"_blank\">https://18.react.dev/reference/react/useMemo</a></li>\n</ul>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-09 10:51</span>&nbsp;\n<a href=\"https://www.cnblogs.com/WindrunnerMax\">WindRunnerMax</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">6</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "AIå¼€å‘-python-langchainæ¡†æ¶ï¼ˆ1-13 è¿”å›xml-æ ¼å¼è§£æå™¨ï¼‰",
      "link": "https://www.cnblogs.com/yclh/p/19594030",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/yclh/p/19594030\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-09 10:34\">\n    <span>AIå¼€å‘-python-langchainæ¡†æ¶ï¼ˆ1-13 è¿”å›xml-æ ¼å¼è§£æå™¨ï¼‰</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p>æœ‰çš„æ—¶å€™xmlæ ¼å¼ä¹Ÿæ˜¯å¼€å‘ä¸­æ˜¯æ¯”è¾ƒæ™®éçš„æ•°æ®æ ¼å¼ï¼Œå¦‚ä½•è®©å¤§æ¨¡å‹è¿”å›çš„æ•°æ®æ˜¯æ ‡å‡†çš„xmlæ ¼å¼ï¼Ÿ</p>\n<p>çœ‹å¦‚ä¸‹ä»£ç ï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">from langchain.prompts import PromptTemplate\nfrom langchain_openai import ChatOpenAI\nfrom langchain.output_parsers import XMLOutputParser\nimport os\n\nllm = ChatOpenAI(\n    api_key=os.getenv(\"DEEPSEEK_API_KEY\"),\n    base_url=os.getenv(\"BASE_URL\"),\n    model=\"deepseek-v3:671b\",\n    temperature=0.7,\n    max_tokens=1024\n)\n\n# ä¿®æ­£ XML æ ¼å¼æŒ‡ä»¤ï¼šç»“æŸæ ‡ç­¾å¿…é¡»æ˜¯ &lt;/xml&gt;\nformat_instructions = \"\"\"è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹XMLæ ¼å¼è¿”å›ç»“æœï¼Œä»…è¾“å‡ºXMLå†…å®¹ï¼Œä¸è¦åŒ…å«ä»»ä½•å…¶ä»–æ–‡å­—æˆ–è¯´æ˜ï¼š\n\n&lt;xml&gt;\n  &lt;movie&gt;ç”µå½±åç§°1&lt;/movie&gt;\n  &lt;movie&gt;ç”µå½±åç§°2&lt;/movie&gt;\n  &lt;!-- å¯åŒ…å«å¤šä¸ª movie æ ‡ç­¾ --&gt;\n&lt;/xml&gt;\"\"\"\n\nprompt = PromptTemplate(\n    template=\"{format_instructions}\\n\\nç”¨æˆ·è¯·æ±‚ï¼š{query}\",\n    input_variables=[\"query\"],\n    partial_variables={\"format_instructions\": format_instructions},\n)\n\nactor_query = \"ç”Ÿæˆé™ˆé“æ˜çš„ç”µå½±ç›®å½•ã€‚\"\n\n#è¾“å‡ºæç¤ºè¯\nprint('#######################')\nprint(prompt.invoke({\"query\": actor_query}).text)\nprint('#######################')\n\n\n\nchain = prompt | llm | XMLOutputParser()\n\n\nresult = chain.invoke({\"query\": actor_query})\nprint('----------------------')\nprint(\"è§£ææˆåŠŸï¼Œç»“æœï¼š\")\nprint(result)\n</pre>\n</div>\n<p>&nbsp;è¿”ç»“æœï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">#######################\nè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹XMLæ ¼å¼è¿”å›ç»“æœï¼Œä»…è¾“å‡ºXMLå†…å®¹ï¼Œä¸è¦åŒ…å«ä»»ä½•å…¶ä»–æ–‡å­—æˆ–è¯´æ˜ï¼š\n\n&lt;xml&gt;\n  &lt;movie&gt;ç”µå½±åç§°1&lt;/movie&gt;\n  &lt;movie&gt;ç”µå½±åç§°2&lt;/movie&gt;\n  &lt;!-- å¯åŒ…å«å¤šä¸ª movie æ ‡ç­¾ --&gt;\n&lt;/xml&gt;\n\nç”¨æˆ·è¯·æ±‚ï¼šç”Ÿæˆé™ˆé“æ˜çš„ç”µå½±ç›®å½•ã€‚\n#######################\n----------------------\nè§£ææˆåŠŸï¼Œç»“æœï¼š\n{'xml': [{'movie': 'è‹±é›„'}, {'movie': 'æ— é—´é“3ï¼šç»ˆææ— é—´'}, {'movie': 'å½’æ¥'}, {'movie': 'å”å±±å¤§åœ°éœ‡'}, {'movie': 'åº·ç†™ç‹æœ'}, {'movie': 'å›´åŸ'}, {'movie': 'æˆ‘çš„1919'}, {'movie': 'æ¥šæ±‰ä¼ å¥‡'}]}\n</pre>\n</div>\n<p>&nbsp;ä¸€ä¸ªæ ‡å‡†çš„xmlæ ¼å¼è¿”å›</p>\n<p>æ›´å¤šå­¦ä¹ èµ„æ–™å°½åœ¨è€è™ç½‘ç›˜èµ„æºï¼šhttp://resources.kittytiger.cn/ <a href=\"http://resources.kittytiger.cn/\" rel=\"noopener nofollow\" target=\"_blank\">è€è™ç½‘ç›˜èµ„æº</a></p>\n<p><span style=\"font-size: 18pt;\"><strong>é‡ç‚¹çŸ¥è¯†ï¼š</strong></span></p>\n<h3 class=\"qwen-markdown-heading\"><span class=\"qwen-markdown-text\">ä»£ç ç»“æ„ä¸åŠŸèƒ½æ¦‚è¿°</span></h3>\n<div class=\"qwen-markdown-paragraph\"><span class=\"qwen-markdown-text\">æœ¬æ®µä»£ç æ„å»ºäº†ä¸€ä¸ªåŸºäº LangChain çš„ç»“æ„åŒ–æ•°æ®ç”Ÿæˆç®¡é“ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯è®©å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä»¥<strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">ä¸¥æ ¼æ ‡å‡†çš„ XML æ ¼å¼</span></strong><span class=\"qwen-markdown-text\">è¿”å›é™ˆé“æ˜å‚æ¼”çš„ç”µå½±åˆ—è¡¨ã€‚æ•´ä¸ªæµç¨‹é€šè¿‡æç¤ºè¯å·¥ç¨‹ã€æ¨¡å‹è°ƒç”¨ä¸è¾“å‡ºè§£æä¸‰æ­¥ååŒï¼Œç¡®ä¿æœ€ç»ˆç»“æœå¯ç›´æ¥è¢«ç¨‹åºè§£æä½¿ç”¨ï¼Œé¿å…éç»“æ„åŒ–æ–‡æœ¬å¸¦æ¥çš„å¤„ç†è´Ÿæ‹…ã€‚</span></span></div>\n&nbsp;\n<h3 class=\"qwen-markdown-heading\"><span class=\"qwen-markdown-text\">æç¤ºè¯æ¨¡æ¿ï¼šå¼ºåˆ¶ XML æ ¼å¼è¾“å‡º</span></h3>\n<div class=\"qwen-markdown-paragraph\"><span class=\"qwen-markdown-text\">ä»£ç é€šè¿‡ <code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">PromptTemplate</code><span class=\"qwen-markdown-text\"> æ˜¾å¼å®šä¹‰æ ¼å¼æŒ‡ä»¤ï¼ˆ<code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">format_instructions</code><span class=\"qwen-markdown-text\">ï¼‰ï¼Œè¦æ±‚æ¨¡å‹ï¼š </span></span></span></div>\n<ol class=\"qwen-markdown-list\" dir=\"auto\" start=\"1\">\n<li><strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">ä»…è¾“å‡º XML å†…å®¹</span></strong><span class=\"qwen-markdown-text\">ï¼Œç¦æ­¢é™„åŠ è¯´æ˜ã€æ³¨é‡Šæˆ–å¤šä½™æ–‡å­—ï¼› </span></li>\n<li><strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">ä½¿ç”¨æ ‡å‡† XML æ ‡ç­¾ç»“æ„</span></strong><span class=\"qwen-markdown-text\">ï¼Œä»¥ <code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">&lt;xml&gt;</code><span class=\"qwen-markdown-text\"> ä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ¯ä¸ªç”µå½±åç§°åŒ…è£¹åœ¨ç‹¬ç«‹çš„ <code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">&lt;movie&gt;</code><span class=\"qwen-markdown-text\"> å­æ ‡ç­¾ä¸­ï¼› </span></span></span></li>\n<li><strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">ä¸¥æ ¼é—­åˆæ ‡ç­¾</span></strong><span class=\"qwen-markdown-text\">ï¼Œå¦‚ <code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">&lt;/xml&gt;</code><span class=\"qwen-markdown-text\"> ç»“æŸæ ¹èŠ‚ç‚¹ï¼Œé¿å…æ ¼å¼é”™è¯¯ã€‚<br /><span class=\"qwen-markdown-text\">è¿™ç§è®¾è®¡ä»æºå¤´çº¦æŸæ¨¡å‹è¡Œä¸ºï¼Œå¤§å¹…é™ä½åç»­è§£æå¤±è´¥é£é™©ã€‚</span></span></span></li>\n\n</ol><br />\n<h3 class=\"qwen-markdown-heading\"><span class=\"qwen-markdown-text\">æ¨¡å‹è°ƒç”¨ï¼šå®šå‘ç”Ÿæˆç»“æ„åŒ–å†…å®¹</span></h3>\n<div class=\"qwen-markdown-paragraph\"><span class=\"qwen-markdown-text\">é€‰ç”¨ <code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">deepseek-v3:671b</code><span class=\"qwen-markdown-text\"> æ¨¡å‹å¹¶è®¾ç½® <code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">temperature=0.7</code><span class=\"qwen-markdown-text\">ï¼Œåœ¨ä¿è¯åˆ›é€ æ€§çš„åŒæ—¶ç»´æŒè¾“å‡ºç¨³å®šæ€§ã€‚å…³é”®ç‚¹åœ¨äºï¼š  </span></span></span></div>\n<ul class=\"qwen-markdown-list\" dir=\"auto\">\n<li><span class=\"qwen-markdown-text\">æç¤ºè¯ä¸­æ˜ç¡®ç”¨æˆ·è¯·æ±‚ï¼ˆâ€œç”Ÿæˆé™ˆé“æ˜çš„ç”µå½±ç›®å½•â€ï¼‰ä¸æ ¼å¼æŒ‡ä»¤åˆ†ç¦»ï¼Œä½¿æ¨¡å‹èšç„¦äº<strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">å†…å®¹ç”Ÿæˆ</span></strong><span class=\"qwen-markdown-text\">ä¸<strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">æ ¼å¼éµå¾ª</span></strong><span class=\"qwen-markdown-text\">åŒé‡ä»»åŠ¡ï¼›  </span></span></span></li>\n<li><span class=\"qwen-markdown-text\">é€šè¿‡ <code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">max_tokens=1024</code><span class=\"qwen-markdown-text\"> é™åˆ¶è¾“å‡ºé•¿åº¦ï¼Œé¿å…å†—ä½™ä¿¡æ¯å¹²æ‰° XML ç»“æ„å®Œæ•´æ€§ã€‚</span></span></li>\n\n</ul>\n<br />\n<h3 class=\"qwen-markdown-heading\"><span class=\"qwen-markdown-text\">è¾“å‡ºè§£æå™¨ï¼šéªŒè¯å¹¶è½¬æ¢ XML æ•°æ®</span></h3>\n<div class=\"qwen-markdown-paragraph\"><code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">XMLOutputParser</code><span class=\"qwen-markdown-text\"> ä½œä¸ºé“¾å¼è°ƒç”¨çš„æœ€ç»ˆç¯èŠ‚ï¼Œæ‰¿æ‹…åŒé‡èŒè´£ï¼š  </span></div>\n<ol class=\"qwen-markdown-list\" dir=\"auto\" start=\"1\"><ol class=\"qwen-markdown-list\" dir=\"auto\" start=\"1\">\n<li><strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">æ ¼å¼æ ¡éªŒ</span></strong><span class=\"qwen-markdown-text\">ï¼šè‡ªåŠ¨æ£€æµ‹ XML æ ‡ç­¾é—­åˆæ€§ã€åµŒå¥—åˆæ³•æ€§ï¼Œè‹¥æ¨¡å‹è¾“å‡ºä¸ç¬¦åˆæ ‡å‡†ï¼ˆå¦‚ç¼ºå¤±ç»“æŸæ ‡ç­¾ï¼‰ï¼Œå°†æŠ›å‡ºè§£æå¼‚å¸¸ï¼›  </span></li>\n<li><strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">ç»“æ„åŒ–è½¬æ¢</span></strong><span class=\"qwen-markdown-text\">ï¼šå°†åŸå§‹ XML å­—ç¬¦ä¸²è½¬æ¢ä¸º Python å­—å…¸ï¼ˆå¦‚ <code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">{'xml': {'movie': ['ç”µå½±A', 'ç”µå½±B']}}</code><span class=\"qwen-markdown-text\">ï¼‰ï¼Œä¾¿äºç¨‹åºç›´æ¥æå–æ•°æ®ï¼Œæ— éœ€æ‰‹åŠ¨æ­£åˆ™åŒ¹é…ã€‚</span></span></li>\n\n</ol></ol>\n<p>&nbsp;</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-09 10:34</span>&nbsp;\n<a href=\"https://www.cnblogs.com/yclh\">ä¸‡ç¬‘ä½›</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">13</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "Dapperè½»é‡çº§æ‰©å±•åº“SmartDapper",
      "link": "https://www.cnblogs.com/mumaren/p/19593895",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/mumaren/p/19593895\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-09 10:16\">\n    <span>Dapperè½»é‡çº§æ‰©å±•åº“SmartDapper</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h2 id=\"smartdapper\">SmartDapper</h2>\n<p>SmartDapper æ˜¯ä¸€ä¸ªåŸºäº Dapper çš„è½»é‡çº§æ‰©å±•åº“ï¼Œæä¾› <strong>è¡¨è¾¾å¼æ ‘è½¬ SQL</strong>ã€<strong>é“¾å¼æ„å»ºå™¨ï¼ˆFluent Builderï¼šQuerySet/InsertSet/UpdateSet/DeleteSetï¼Œæ”¯æŒ Where/Select/Join/GroupBy/OrderBy/Union/Set/Fill ç­‰ï¼‰</strong>ã€<strong>é€šç”¨ CRUD</strong>ã€<strong>åˆ†é¡µæŸ¥è¯¢</strong> ä¸ <strong>å¤šæ•°æ®åº“é€‚é…</strong>ï¼ˆSQL Server / MySQL / SQLiteï¼‰ã€‚é»˜è®¤å‚æ•°åŒ–æ‰§è¡Œï¼Œä»¥é™ä½ SQL æ³¨å…¥é£é™©ã€‚</p>\n<h3 id=\"å®‰è£…\">å®‰è£…</h3>\n<pre><code class=\"language-bash\">dotnet add package SmartDapper\n</code></pre>\n<h3 id=\"å¿«é€Ÿå¼€å§‹sql-ç”Ÿæˆ--dapper-æ‰§è¡Œ\">å¿«é€Ÿå¼€å§‹ï¼ˆSQL ç”Ÿæˆ + Dapper æ‰§è¡Œï¼‰</h3>\n<pre><code class=\"language-csharp\">using System.ComponentModel.DataAnnotations;\nusing System.ComponentModel.DataAnnotations.Schema;\nusing Dapper;\nusing Microsoft.Data.SqlClient;\nusing SmartDapper.SqlGenerator;\n\n[Table(\"Users\")]\npublic class User\n{\n    [Key]\n    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]\n    public int Id { get; set; }\n\n    public string UserName { get; set; } = string.Empty;\n    public bool IsActive { get; set; }\n}\n\nvar generator = SqlGeneratorFactory.CreateSqlServer&lt;User&gt;();\nvar (sql, parameters) = generator.GetSelectAll(u =&gt; u.IsActive);\n\nusing var conn = new SqlConnection(\"Server=.;Database=MyDb;Trusted_Connection=True;TrustServerCertificate=True;\");\nvar users = conn.Query&lt;User&gt;(sql, parameters).ToList();\n</code></pre>\n<h3 id=\"ä½¿ç”¨æ‰©å±•æ–¹æ³•idbconnection\">ä½¿ç”¨æ‰©å±•æ–¹æ³•ï¼ˆ<code>IDbConnection</code>ï¼‰</h3>\n<pre><code class=\"language-csharp\">using Microsoft.Data.SqlClient;\nusing SmartDapper.Extensions;\n\nusing var conn = new SqlConnection(\"Server=.;Database=MyDb;Trusted_Connection=True;TrustServerCertificate=True;\");\n\n// ---------------------------\n// ç»“æœæ˜ å°„ï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼šåˆ—å/å±æ€§åä¸ä¸€è‡´æ—¶ï¼‰\n// ---------------------------\n// è®© Dapper åœ¨ materializeï¼ˆç»“æœé›†-&gt;å®ä½“ï¼‰æ—¶ä¼˜å…ˆä½¿ç”¨ [Column(\"DbColumn\")] æ˜ å°„ï¼Œ\n// å¹¶å¯é€‰å¼€å¯ä¸‹åˆ’çº¿åŒ¹é…ï¼ˆuser_name -&gt; UserNameï¼‰ã€‚\n//\n// æ³¨æ„ï¼šè¿™æ˜¯ Dapper çš„å…¨å±€è®¾ç½®ï¼ˆè¿›ç¨‹å†…å¯¹è¯¥å®ä½“ç±»å‹çš„æ‰€æœ‰æŸ¥è¯¢éƒ½ä¼šå—å½±å“ï¼‰ï¼Œå»ºè®®åªåœ¨å¯åŠ¨é˜¶æ®µæ‰§è¡Œä¸€æ¬¡ã€‚\nDapperMappingExtensions.UseColumnAttributeTypeMap&lt;User&gt;(matchNamesWithUnderscores: true);\n\n// æˆ–è€…ï¼šä¸€æ¬¡æ€§å¯¹â€œå®ä½“æ‰€åœ¨ç¨‹åºé›†â€å†…çš„ç±»å‹æ‰¹é‡æ³¨å†Œï¼ˆé»˜è®¤æŒ‰ [Table]/[Key]/[Column] è¯†åˆ«å®ä½“ï¼‰\n// DapperMappingExtensions.UseColumnAttributeTypeMap(matchNamesWithUnderscores: true, typeof(User).Assembly);\n\n// ---------------------------\n// æŸ¥è¯¢ï¼ˆéé“¾å¼ / é Fluentï¼‰\n// ---------------------------\nvar list = await conn.GetAllListAsync&lt;User&gt;(u =&gt; u.IsActive);\nvar (items, total) = await conn.GetPagedListAsync&lt;User&gt;(skip: 0, take: 20);\n\n// æŒ‰ä¸»é”®æŸ¥å•æ¡ï¼ˆä¸å­˜åœ¨è¿”å› nullï¼‰\nvar one = await conn.GetAsync&lt;User&gt;(id: 1);\n\n// First / Singleï¼ˆæ³¨æ„ï¼šSingle åœ¨å¤šæ¡å‘½ä¸­æ—¶ä¼šæŠ›å¼‚å¸¸ï¼‰\nvar first = await conn.FirstOrDefaultAsync&lt;User&gt;(u =&gt; u.IsActive);\nvar single = await conn.SingleOrDefaultAsync&lt;User&gt;(u =&gt; u.Id == 1);\n\n// æ˜¯å¦å­˜åœ¨ / è®¡æ•°\nvar exists = await conn.AnyAsync&lt;User&gt;(u =&gt; u.IsActive);\nvar count = await conn.CountAsync&lt;User&gt;(u =&gt; u.IsActive);\n\n// ---------------------------\n// æ–°å¢ï¼ˆéé“¾å¼ï¼‰\n// ---------------------------\nvar newUser = new User { UserName = \"Alice\", IsActive = true };\nawait conn.InsertAsync(newUser);\n\n// æ’å…¥å¹¶è¿”å›è‡ªå¢IDï¼ˆè¦æ±‚å®ä½“ä¸»é”®æ ‡æ³¨ [Key] ä¸”ä¸º Identityï¼‰\nvar newId = await conn.InsertAndGetIdAsync(newUser);\n\n// ---------------------------\n// æ›´æ–°ï¼ˆéé“¾å¼ï¼‰\n// ---------------------------\n// 1) æŒ‰ä¸»é”®æ›´æ–°æŒ‡å®šå­—æ®µ\nawait conn.UpdateAsync&lt;User&gt;(\n    updateFields: u =&gt; new { IsActive = false },\n    keyValue: 1);\n\n// 2) æŒ‰æ¡ä»¶æ›´æ–°æŒ‡å®šå­—æ®µ\nawait conn.UpdateAsync&lt;User&gt;(\n    updateFields: u =&gt; new { IsActive = true },\n    predicate: u =&gt; u.UserName == \"Alice\");\n\n// ---------------------------\n// åˆ é™¤ï¼ˆéé“¾å¼ï¼‰\n// ---------------------------\n// æŒ‰ä¸»é”®åˆ é™¤\nawait conn.DeleteAsync&lt;User&gt;(id: 1);\n\n// æŒ‰æ¡ä»¶åˆ é™¤\nawait conn.DeleteAsync&lt;User&gt;(u =&gt; u.IsActive == false);\n\n// ---------------------------\n// è½¯åˆ é™¤ï¼ˆSoftDeleteï¼Œéé“¾å¼ï¼‰\n// ---------------------------\n// å‰æï¼šå®ä½“éœ€è¦æ ‡æ³¨ [SoftDelete]ï¼ˆå¯æ ‡åœ¨å®ä½“ç±»ä¸Šæˆ– IsDeleted å­—æ®µå±æ€§ä¸Šï¼‰ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ï¼ˆé¿å…è¯¯ä»¥ä¸ºâ€œå·²è½¯åˆ â€ï¼‰ã€‚\n//\n// 1) å¯é€‰ï¼šå¼€å¯æŸ¥è¯¢è‡ªåŠ¨è¿‡æ»¤å·²åˆ é™¤æ•°æ®ï¼ˆå…¨å±€å¼€å…³ï¼‰\nDapperExtensions.ConfigureSoftDelete(o =&gt;\n{\n    o.FilterSoftDeleted = true;\n});\n\n// 2) é€»è¾‘åˆ é™¤ / æ¢å¤ï¼šæŒ‰ä¸»é”®\nawait conn.SoftDeleteAsync&lt;User&gt;(id: 1);\nawait conn.RestoreAsync&lt;User&gt;(id: 1);\n\n// 3) é€»è¾‘åˆ é™¤ / æ¢å¤ï¼šæŒ‰æ¡ä»¶\nawait conn.SoftDeleteAsync&lt;User&gt;(u =&gt; u.UserName == \"Alice\");\nawait conn.RestoreAsync&lt;User&gt;(u =&gt; u.UserName == \"Alice\");\n</code></pre>\n<h3 id=\"å¤šè¿æ¥ç»Ÿä¸€æ³¨å†Œå¯é€‰di-åœºæ™¯\">å¤šè¿æ¥ç»Ÿä¸€æ³¨å†Œï¼ˆå¯é€‰ï¼ŒDI åœºæ™¯ï¼‰</h3>\n<p>SmartDapper æ ¸å¿ƒæ˜¯â€œä»¥ä½ ä¼ å…¥çš„ <code>IDbConnection</code> ä¸ºå‡†â€ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªé¡¹ç›®é‡Œè‡ªç”±åˆ›å»º/ä½¿ç”¨å¤šä¸ªè¿æ¥ã€‚<br />\nå¦‚æœä½ å¸Œæœ›åœ¨ DI ä¸­<strong>ç»Ÿä¸€æ³¨å†Œå¤šä¸ªè¿æ¥é…ç½®</strong>ï¼Œå¯ä»¥ä½¿ç”¨ <code>AddSmartDapperConnections(...)</code> æ³¨å†Œä¸€ä¸ªæŒ‰ key åˆ›å»ºè¿æ¥çš„å·¥å‚ï¼š</p>\n<pre><code class=\"language-csharp\">using System.Data;\nusing Microsoft.Data.SqlClient;\nusing SmartDapper.Extensions;\n\nvar builder = WebApplication.CreateBuilder(args);\n\nbuilder.Services.AddSmartDapperConnections(o =&gt;\n{\n    // æ–¹å¼ 1ï¼šæŒ‰è¿æ¥å­—ç¬¦ä¸² + å·¥å‚\n    o.Add(\"Main\", builder.Configuration.GetConnectionString(\"Main\")!, cs =&gt; new SqlConnection(cs));\n    o.Add(\"Log\", builder.Configuration.GetConnectionString(\"Log\")!, cs =&gt; new SqlConnection(cs));\n\n    // å¯é€‰ï¼šæŒ‡å®šé»˜è®¤ keyï¼ˆä¸è®¾åˆ™é»˜è®¤å–ç¬¬ä¸€ä¸ª Add çš„ keyï¼‰\n    o.DefaultKey = \"Main\";\n});\n\n// ä½¿ç”¨ï¼šæŒ‰ key åˆ›å»ºè¿æ¥ï¼ˆè¿æ¥ç”±ä½ è´Ÿè´£é‡Šæ”¾ï¼›å¯æ‰‹å†™ usingï¼Œä¹Ÿå¯ç”¨è¾…åŠ©æ–¹æ³•è‡ªåŠ¨ usingï¼‰\n// var factory = sp.GetRequiredService&lt;ISmartDapperConnectionFactory&gt;();\n//\n// æ–¹å¼ 1ï¼šæ‰‹å†™ using\n// using var conn = factory.Create(\"Main\");\n// var users = await conn.GetAllListAsync&lt;User&gt;();\n//\n// æ–¹å¼ 2ï¼šè¾…åŠ©æ–¹æ³•ï¼ˆå†…éƒ¨ Create + Disposeï¼Œå‡å°‘é‡å¤ä»£ç ï¼‰\n// var users2 = await factory.UseConnectionAsync(\"Main\", c =&gt; c.GetAllListAsync&lt;User&gt;());\n//\n// é»˜è®¤è¿æ¥ï¼ˆç­‰ä»·äº factory.CreateDefault() / factory.UseDefaultXxx...ï¼‰\n// var usersDefault = await factory.UseDefaultConnectionAsync(c =&gt; c.GetAllListAsync&lt;User&gt;());\n//\n// æ–¹å¼ 3ï¼šäº‹åŠ¡è¾…åŠ©æ–¹æ³•ï¼ˆå†…éƒ¨ BeginTransaction + Commit/Rollback + Disposeï¼‰\n// await factory.UseTransactionAsync(\"Main\", async (c, tx) =&gt;\n// {\n//     await c.InsertAsync(new User { /* ... */ }, transaction: tx);\n//     await c.UpdateAsync(new User { /* ... */ }, transaction: tx);\n// });\n//\n// é»˜è®¤è¿æ¥çš„äº‹åŠ¡ç‰ˆæœ¬\n// await factory.UseDefaultTransactionAsync(async (c, tx) =&gt;\n// {\n//     await c.InsertAsync(new User { /* ... */ }, transaction: tx);\n//     await c.UpdateAsync(new User { /* ... */ }, transaction: tx);\n// });\n</code></pre>\n<h3 id=\"sql-æ—¥å¿—è¾“å‡ºé…ç½®å¯é€‰æ¨èåœ¨å¯åŠ¨æ—¶è®¾ç½®\">SQL æ—¥å¿—è¾“å‡ºé…ç½®ï¼ˆå¯é€‰ï¼Œæ¨èåœ¨å¯åŠ¨æ—¶è®¾ç½®ï¼‰</h3>\n<p>SmartDapper åœ¨æ‰§è¡Œ CRUD/æŸ¥è¯¢æ—¶ä¼šè®°å½•â€œç”Ÿæˆçš„ SQLâ€ã€‚<strong>é»˜è®¤ç­–ç•¥</strong>ï¼š</p>\n<ul>\n<li><strong>Information</strong>ï¼šä»…è¾“å‡º SQLï¼ˆä¸è¾“å‡ºå‚æ•°ï¼Œé¿å…æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼‰</li>\n<li><strong>Debug</strong>ï¼šè¾“å‡º SQL + å‚æ•°ï¼ˆä¾¿äºæœ¬åœ°/æµ‹è¯•ç¯å¢ƒæ’æŸ¥ï¼‰</li>\n</ul>\n<p>ä½ å¯ä»¥åœ¨ç¨‹åºåˆå§‹åŒ–é˜¶æ®µé€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œé…ç½®ï¼š</p>\n<h4 id=\"æ–¹å¼-1di-é£æ ¼æ¨è\">æ–¹å¼ 1ï¼šDI é£æ ¼ï¼ˆæ¨èï¼‰</h4>\n<pre><code class=\"language-csharp\">using Microsoft.Extensions.Logging;\nusing SmartDapper.Extensions;\n\nvar builder = WebApplication.CreateBuilder(args);\n\n// 1) é»˜è®¤æ— éœ€é…ç½®ï¼šInfo åªè¾“å‡º SQLï¼›Debug è¾“å‡º SQL + å‚æ•°\n\n// 2) å¦‚éœ€åœ¨ Info çº§åˆ«ä¹Ÿè¾“å‡ºå‚æ•°ï¼ˆæ³¨æ„æ•æ„Ÿä¿¡æ¯é£é™©ï¼‰\nbuilder.Services.AddSmartDapper(configureSqlLogging: o =&gt;\n{\n    o.SqlLogLevel = LogLevel.Information;\n    o.ParameterLogLevel = LogLevel.Information;\n});\n\n// 3) å¦‚éœ€å½»åº•ç¦ç”¨å‚æ•°è¾“å‡ºï¼ˆå³ä½¿ Debugï¼‰\nbuilder.Services.AddSmartDapper(configureSqlLogging: o =&gt;\n{\n    o.ParameterLogLevel = LogLevel.None;\n});\n</code></pre>\n<h4 id=\"æ–¹å¼-11ç»Ÿä¸€æ³¨å…¥æ—¥å¿—--è½¯åˆ ä¸€èµ·é…ç½®æ¨è\">æ–¹å¼ 1.1ï¼šç»Ÿä¸€æ³¨å…¥ï¼ˆæ—¥å¿— + è½¯åˆ ä¸€èµ·é…ç½®ï¼Œæ¨èï¼‰</h4>\n<pre><code class=\"language-csharp\">using Microsoft.Extensions.Logging;\nusing SmartDapper.Extensions;\n\nvar builder = WebApplication.CreateBuilder(args);\n\nbuilder.Services.AddSmartDapper(\n    configureSqlLogging: o =&gt;\n    {\n        o.SqlLogLevel = LogLevel.Information;\n        o.ParameterLogLevel = LogLevel.Information;\n    },\n    configureSoftDelete: o =&gt;\n    {\n        o.FilterSoftDeleted = true;\n    },\n    configureSqlServer: o =&gt;\n    {\n        // SQL Serverï¼šæ˜¯å¦åœ¨ SELECT çš„ FROM è¡¨ååè¿½åŠ  WITH (NOLOCK)\n        o.UseNoLock = true;\n    });\n</code></pre>\n<h3 id=\"ç»“æœæ˜ å°„typemapæ³¨å†Œå¯é€‰di-åœºæ™¯æ¨è\">ç»“æœæ˜ å°„ï¼ˆTypeMapï¼‰æ³¨å†Œï¼ˆå¯é€‰ï¼ŒDI åœºæ™¯æ¨èï¼‰</h3>\n<p>å½“ä½ çš„â€œæ•°æ®åº“åˆ—åâ€å’Œâ€œå®ä½“å±æ€§åâ€ä¸ä¸€è‡´æ—¶ï¼ˆä¾‹å¦‚ <code>user_name</code> vs <code>UserName</code>ï¼‰ï¼Œå»ºè®®åœ¨å¯åŠ¨é˜¶æ®µæ³¨å†Œä¸€æ¬¡æ˜ å°„è§„åˆ™ï¼š</p>\n<pre><code class=\"language-csharp\">using SmartDapper.Extensions;\n\nvar builder = WebApplication.CreateBuilder(args);\n\n// æŒ‰â€œå®ä½“æ‰€åœ¨ç¨‹åºé›†â€æ‰¹é‡æ³¨å†Œï¼ˆé»˜è®¤æŒ‰ [Table]/[Key]/[Column] è¯†åˆ«å®ä½“ï¼‰\nbuilder.Services.AddSmartDapperColumnMapping(\n    matchNamesWithUnderscores: true,\n    typeof(User).Assembly);\n</code></pre>\n<h3 id=\"å…¨å±€-queryfilterå¯é€‰ç±»ä¼¼å…¶å®ƒ-orm-çš„å…¨å±€è¿‡æ»¤\">å…¨å±€ QueryFilterï¼ˆå¯é€‰ï¼Œç±»ä¼¼å…¶å®ƒ ORM çš„å…¨å±€è¿‡æ»¤ï¼‰</h3>\n<p>SmartDapper æ”¯æŒæ³¨å†Œâ€œå…¨å±€ QueryFilterâ€ï¼Œåœ¨æŸ¥è¯¢æ—¶è‡ªåŠ¨æŠŠè¿‡æ»¤æ¡ä»¶æ³¨å…¥åˆ° <code>WHERE</code>ï¼ˆå¹¶ä¸ç”¨æˆ·ä¼ å…¥çš„ <code>Where(...)</code> æ¡ä»¶ç”¨ <code>AND</code> ç»„åˆï¼‰ã€‚</p>\n<p>å…¸å‹ç”¨é€”ï¼š</p>\n<ul>\n<li><strong>è½¯åˆ é™¤ï¼ˆæ¥å£é£æ ¼ï¼‰</strong>ï¼š<code>ISoftDelete</code>ï¼ˆå¯é€‰æ¥å£ï¼‰+ <code>it =&gt; it.IsDeleted == false</code></li>\n<li><strong>å¤šç§Ÿæˆ·/æ•°æ®éš”ç¦»</strong>ï¼š<code>IHasTenant</code> + <code>it =&gt; it.TenantId == tenantId</code></li>\n<li><strong>æ•°æ®æƒé™/åªçœ‹æœ‰æ•ˆæ•°æ®</strong>ï¼š<code>IHasCompany</code> / <code>IIsActive</code> ç­‰</li>\n</ul>\n<blockquote>\n<p>å…¼å®¹è¯´æ˜ï¼šQueryFilter ä¸ç°æœ‰è½¯åˆ å¼€å…³ <code>FilterSoftDeleted</code> <strong>å®Œå…¨å…¼å®¹</strong>ï¼Œå¯ä»¥åŒæ—¶å¼€å¯ï¼›æœ€ç»ˆä¼šä¸€èµ· <code>AND</code> åˆ° <code>WHERE</code> é‡Œã€‚<br />\næç¤ºï¼šå¦‚æœä½ åŒæ—¶å¼€å¯äº† <code>FilterSoftDeleted=true</code>ï¼Œåˆé€šè¿‡ QueryFilter å†™äº†åŒæ ·çš„è½¯åˆ æ¡ä»¶ï¼Œä¼šäº§ç”Ÿâ€œé‡å¤æ¡ä»¶â€ï¼ˆä¸å½±å“ç»“æœï¼Œåªæ˜¯å†—ä½™ï¼‰ã€‚</p>\n</blockquote>\n<h4 id=\"æ–¹å¼-1di-é£æ ¼æ¨è-1\">æ–¹å¼ 1ï¼šDI é£æ ¼ï¼ˆæ¨èï¼‰</h4>\n<blockquote>\n<p>æ³¨æ„ï¼š<code>AddSmartDapper(...)</code> çš„å‚æ•°è¾ƒå¤šï¼Œå»ºè®®ä½¿ç”¨<strong>å‘½åå‚æ•°</strong>ï¼Œé¿å…é¡ºåºè¯¯ç”¨ã€‚</p>\n</blockquote>\n<pre><code class=\"language-csharp\">using SmartDapper.Extensions;\n\nbuilder.Services.AddSmartDapper(\n    configureQueryFilters: o =&gt;\n    {\n        // ä¾‹ï¼šæ¥å£è½¯åˆ é™¤ï¼ˆéœ€è¦å®ä½“å®ç° ISoftDeleteï¼Œæˆ–ä½ è‡ªå®šä¹‰çš„æ¥å£/åŸºç±»ï¼‰\n        o.AddTableFilter&lt;ISoftDelete&gt;(it =&gt; it.IsDeleted == false);\n    });\n</code></pre>\n<h4 id=\"æ–¹å¼-2é-di-åœºæ™¯ç›´æ¥é…ç½®\">æ–¹å¼ 2ï¼šé DI åœºæ™¯ï¼ˆç›´æ¥é…ç½®ï¼‰</h4>\n<pre><code class=\"language-csharp\">using SmartDapper.Extensions;\n\nDapperExtensions.ConfigureQueryFilters(o =&gt;\n{\n    o.AddTableFilter&lt;ISoftDelete&gt;(it =&gt; it.IsDeleted == false);\n});\n</code></pre>\n<h4 id=\"æ–¹å¼-3idbconnection-è¯­æ³•ç³–æ›´æ¥è¿‘-dbqueryfilter\">æ–¹å¼ 3ï¼š<code>IDbConnection</code> è¯­æ³•ç³–ï¼ˆæ›´æ¥è¿‘ <code>db.QueryFilter...</code>ï¼‰</h4>\n<blockquote>\n<p>è¯´æ˜ï¼šC# ä¸æ”¯æŒæ‰©å±•â€œå±æ€§â€ï¼Œå› æ­¤è°ƒç”¨å½¢æ€ä¸º <code>db.QueryFilter().AddTableFilter(...)</code>ã€‚</p>\n</blockquote>\n<pre><code class=\"language-csharp\">using SmartDapper.Extensions;\n\nusing var conn = new SqlConnection(\"...\");\n\nconn.QueryFilter()\n    .AddTableFilter&lt;ISoftDelete&gt;(it =&gt; it.IsDeleted == false);\n</code></pre>\n<h4 id=\"æ–¹å¼-2é-di-åœºæ™¯ç›´æ¥é…ç½®-1\">æ–¹å¼ 2ï¼šé DI åœºæ™¯ï¼ˆç›´æ¥é…ç½®ï¼‰</h4>\n<pre><code class=\"language-csharp\">using Microsoft.Extensions.Logging;\nusing SmartDapper.Extensions;\n\n// SQL æ—¥å¿—\nDapperExtensions.ConfigureSqlLogging(o =&gt;\n{\n    o.SqlLogLevel = LogLevel.Information;\n    o.ParameterLogLevel = LogLevel.Debug; // é»˜è®¤å€¼\n});\n\n// è½¯åˆ ï¼ˆæŸ¥è¯¢æ˜¯å¦è‡ªåŠ¨è¿‡æ»¤å·²åˆ é™¤ï¼‰\nDapperExtensions.ConfigureSoftDelete(o =&gt;\n{\n    o.FilterSoftDeleted = true;\n});\n\n// SQL Server\nDapperExtensions.ConfigureSqlServer(o =&gt;\n{\n    o.UseNoLock = true;\n});\n</code></pre>\n<h3 id=\"è¡¨è¾¾å¼æ ‘æ”¯æŒèŒƒå›´where--in--like--update-set\">è¡¨è¾¾å¼æ ‘æ”¯æŒèŒƒå›´ï¼ˆWHERE / IN / LIKE / UPDATE SETï¼‰</h3>\n<p>SmartDapper çš„â€œè¡¨è¾¾å¼æ ‘è½¬ SQLâ€ä¸»è¦ç”¨äº <code>Expression&lt;Func&lt;T, bool&gt;&gt;</code>ï¼ˆWHERE è°“è¯ï¼‰ï¼Œä»¥åŠæ›´æ–°åœºæ™¯çš„ <code>Expression&lt;Func&lt;T, object&gt;&gt;</code>ï¼ˆSET å­—æ®µé€‰æ‹©/èµ‹å€¼ï¼‰ã€‚</p>\n<h4 id=\"whereexpressionfunct-boolæ”¯æŒé¡¹\">WHEREï¼ˆ<code>Expression&lt;Func&lt;T, bool&gt;&gt;</code>ï¼‰æ”¯æŒé¡¹</h4>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>ç¤ºä¾‹è¡¨è¾¾å¼ï¼ˆC#ï¼‰</th>\n<th>SQL å½¢æ€ï¼ˆæ¦‚å¿µï¼‰</th>\n<th>å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ç­‰å€¼ / ä¸ç­‰</strong></td>\n<td><code>x =&gt; x.Id == 1</code> / <code>x =&gt; x.Id != 1</code></td>\n<td><code>Id = @Id</code> / <code>Id &lt;&gt; @Id</code></td>\n<td>å‚æ•°åé»˜è®¤æŒ‰å­—æ®µåç”Ÿæˆ</td>\n</tr>\n<tr>\n<td><strong>æ¯”è¾ƒ</strong></td>\n<td><code>x =&gt; x.Age &gt; 18</code> / <code>&gt;=</code> / <code>&lt;</code> / <code>&lt;=</code></td>\n<td><code>Age &gt; @Age</code> ç­‰</td>\n<td>ä»…æ”¯æŒæ¯”è¾ƒè¿ç®—ç¬¦é›†åˆ</td>\n</tr>\n<tr>\n<td><strong>é€»è¾‘ç»„åˆ</strong></td>\n<td><code>x =&gt; x.IsActive &amp;&amp; x.Age &gt;= 18</code></td>\n<td><code>(... ) AND (... )</code></td>\n<td>æ”¯æŒ <code>&amp;&amp;</code> / `</td>\n</tr>\n<tr>\n<td><strong>NULL åˆ¤æ–­</strong></td>\n<td><code>x =&gt; x.Name == null</code> / <code>!= null</code></td>\n<td><code>Name IS NULL</code> / <code>IS NOT NULL</code></td>\n<td>ä»…å¯¹ <code>== null</code> / <code>!= null</code> ç‰¹åˆ¤</td>\n</tr>\n<tr>\n<td><strong>bool ç›´æ¥ä½¿ç”¨</strong></td>\n<td><code>x =&gt; x.IsActive</code></td>\n<td><code>IsActive = @IsActive</code>ï¼ˆtrueï¼‰</td>\n<td>é¿å…ç”Ÿæˆè£¸åˆ—åå¯¼è‡´ SQL ä¸å¯æ‰§è¡Œ</td>\n</tr>\n<tr>\n<td><strong>bool å–å</strong></td>\n<td><code>x =&gt; !x.IsDeleted</code></td>\n<td><code>IsDeleted = 0</code></td>\n<td>ä»…å¯¹å®ä½“ bool å­—æ®µå–ååšä¼˜åŒ–</td>\n</tr>\n<tr>\n<td><strong>å­—ç¬¦ä¸² Like</strong></td>\n<td><code>Contains/StartsWith/EndsWith</code></td>\n<td><code>LIKE @p</code></td>\n<td>ä»…æ”¯æŒ <code>x =&gt; x.Column.Contains(value)</code> è¿™ç±»â€œå®ä½“å­—æ®µåœ¨å·¦ä¾§â€å½¢æ€</td>\n</tr>\n<tr>\n<td><strong>INï¼ˆé›†åˆåŒ…å«ï¼‰</strong></td>\n<td><code>x =&gt; ids.Contains(x.Id)</code></td>\n<td><code>Id IN (@Id_0, @Id_1, ...)</code></td>\n<td>ä»…æ”¯æŒ <code>list.Contains(x.Property)</code>ï¼›ç©ºé›†åˆä¼šç”Ÿæˆ <code>1 = 0</code></td>\n</tr>\n<tr>\n<td><strong>Allï¼ˆå…¨æ»¡è¶³ï¼‰</strong></td>\n<td><code>x =&gt; ages.All(a =&gt; x.Age &gt;= a)</code></td>\n<td>å±•å¼€ä¸º <code>AND</code> ä¸²</td>\n<td><code>All(empty)</code> ä¼šç”Ÿæˆ <code>1 = 1</code>ï¼ˆè§ä¸‹æ–¹å®‰å…¨é™åˆ¶ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"update-çš„-setexpressionfunct-objectæ”¯æŒå†™æ³•\">UPDATE çš„ SETï¼ˆ<code>Expression&lt;Func&lt;T, object&gt;&gt;</code>ï¼‰æ”¯æŒå†™æ³•</h4>\n<blockquote>\n<p>é€‚ç”¨äºï¼š<code>conn.UpdateSet&lt;T&gt;().Set(...)</code> / <code>conn.Update(updateFields, predicate)</code> ç­‰ã€‚</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>å†™æ³•</th>\n<th>ç¤ºä¾‹</th>\n<th>å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å¯¹è±¡åˆå§‹åŒ–å™¨ï¼ˆæ¨èï¼‰</strong></td>\n<td><code>x =&gt; new User { Name = name, IsActive = true }</code></td>\n<td>è¡¨è¾¾åŠ›æœ€å¼ºï¼Œæ”¯æŒå¸¸é‡/é—­åŒ…å˜é‡</td>\n</tr>\n<tr>\n<td><strong>å•å­—æ®µ</strong></td>\n<td><code>x =&gt; x.Name</code></td>\n<td>æ”¯æŒï¼Œä½†é€šå¸¸ä»éœ€æ­é…æ˜ç¡®èµ‹å€¼ï¼ˆæ›´æ¨èå¯¹è±¡åˆå§‹åŒ–å™¨ï¼‰</td>\n</tr>\n<tr>\n<td><strong>åŒ¿å new</strong></td>\n<td><code>x =&gt; new { x.Name, x.IsActive }</code></td>\n<td>å¯ç”¨ï¼Œä½†æ›´åƒâ€œå­—æ®µé€‰æ‹©â€ï¼Œä¸å¦‚å¯¹è±¡åˆå§‹åŒ–å™¨è¯­ä¹‰æ¸…æ™°</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"å…¸å‹ä¸æ”¯æŒæ…ç”¨\">å…¸å‹ä¸æ”¯æŒ/æ…ç”¨</h4>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>ç¤ºä¾‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ç®—æœ¯è¿ç®—</strong></td>\n<td><code>x =&gt; x.Age + 1 &gt; 18</code></td>\n<td>ä¸æ”¯æŒï¼ˆWHERE äºŒå…ƒè¿ç®—ä»…å¤„ç†æ¯”è¾ƒä¸ AND/ORï¼‰</td>\n</tr>\n<tr>\n<td><strong>æœªçŸ¥æ–¹æ³•è°ƒç”¨</strong></td>\n<td><code>x =&gt; x.Name.ToLower() == \"a\"</code></td>\n<td>ä¸æ”¯æŒï¼ˆä»…æ”¯æŒ string çš„ Contains/StartsWith/EndsWithï¼‰</td>\n</tr>\n<tr>\n<td><strong>åå‘ Contains</strong></td>\n<td><code>x =&gt; x.Tags.Contains(\"a\")</code></td>\n<td>ä¸æ”¯æŒï¼ˆä»…æ”¯æŒ <code>list.Contains(x.Prop)</code>ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"å®‰å…¨é™åˆ¶é‡è¦\">å®‰å…¨é™åˆ¶ï¼ˆé‡è¦ï¼‰</h4>\n<ul>\n<li><strong>UPDATE/DELETE ç¦æ­¢æ’çœŸæ¡ä»¶</strong>ï¼šä¾‹å¦‚ <code>x =&gt; true</code>ã€æˆ– <code>All(empty)</code> å¯¼è‡´çš„ <code>1 = 1</code>ï¼Œä¼šè¢«æ‹¦æˆªï¼ˆé˜²æ­¢è¯¯å…¨è¡¨æ“ä½œï¼‰ã€‚</li>\n<li><strong>Fluent æŸ¥è¯¢é™åˆ¶</strong>ï¼š\n<ul>\n<li><code>Paging(skip, take)</code> <strong>ä¸èƒ½</strong>ä¸è‡ªå®šä¹‰ <code>OrderBy(...)</code> ç»„åˆä½¿ç”¨ï¼ˆåˆ†é¡µ SQL å·²å†…ç½®æ’åºè§„åˆ™ï¼‰ã€‚</li>\n<li>æŠ•å½±æŸ¥è¯¢ï¼ˆ<code>Select(projection)</code>ï¼‰<strong>ä¸æ”¯æŒ</strong> <code>Paging(...)</code>ï¼Œä¹Ÿ<strong>ä¸æ”¯æŒ</strong>ä¸ <code>SelectColumns(...)</code> æ··ç”¨ï¼ˆ<code>SelectColumns</code> å·²æ ‡è®° Obsoleteï¼Œä»…ä¸ºå…¼å®¹ä¿ç•™ï¼‰ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"é“¾å¼æ‰©å±•fluent-builder\">é“¾å¼æ‰©å±•ï¼ˆFluent Builderï¼‰</h3>\n<p>SmartDapper æä¾›äº†ä¸€ç»„é¢å‘ <code>IDbConnection</code> çš„<strong>é“¾å¼æ„å»ºå™¨</strong>ï¼Œç”¨äºä»¥â€œå‘½ä»¤å¼é“¾å¼ APIâ€ç»„ç»‡æŸ¥è¯¢/æ’å…¥/æ›´æ–°/åˆ é™¤ï¼Œå¹¶åœ¨å†…éƒ¨å¤ç”¨ SmartDapper çš„ SQL ç”Ÿæˆèƒ½åŠ›ã€‚</p>\n<blockquote>\n<p>å‘½åçº¦å®šï¼š<code>QuerySet&lt;T&gt;() / InsertSet&lt;T&gt;() / UpdateSet&lt;T&gt;() / DeleteSet&lt;T&gt;()</code>ã€‚æ„å»ºå™¨å¯¹è±¡<strong>éçº¿ç¨‹å®‰å…¨</strong>ï¼Œå»ºè®®æŒ‰ä¸€æ¬¡è¯·æ±‚/ä¸€æ¬¡æ“ä½œåˆ›å»ºå¹¶ä½¿ç”¨ä¸€æ¬¡ã€‚</p>\n</blockquote>\n<h4 id=\"çº¿ç¨‹å®‰å…¨è¯´æ˜é‡è¦\">çº¿ç¨‹å®‰å…¨è¯´æ˜ï¼ˆé‡è¦ï¼‰</h4>\n<ul>\n<li><strong>ä¸ºä»€ä¹ˆâ€œçº¿ç¨‹ä¸å®‰å…¨â€</strong>ï¼šæ„å»ºå™¨å†…éƒ¨ä¼šä¿å­˜å¯å˜çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼š<code>Where</code> è°“è¯ã€<code>Select</code> åˆ—ã€<code>OrderBy</code> æ’åºã€åˆ†é¡µã€äº‹åŠ¡ã€è¶…æ—¶ç­‰ï¼‰ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹/ä»»åŠ¡å…±äº«åŒä¸€ä¸ªæ„å»ºå™¨å®ä¾‹å¹¶å¹¶å‘ä¿®æ”¹ï¼Œä¼šäº’ç›¸è¦†ç›–è¿™äº›çŠ¶æ€ï¼Œå¯¼è‡´ç”Ÿæˆçš„ SQL/å‚æ•°æ··ä¹±ã€‚</li>\n<li><strong>æ¨èç”¨æ³•</strong>ï¼šæ¯æ¬¡æ“ä½œéƒ½ä» <code>conn.QuerySet&lt;T&gt;() / InsertSet&lt;T&gt;() / ...</code> æ–°å»ºä¸€ä¸ªæ„å»ºå™¨ï¼Œç”¨å®Œå³å¼ƒï¼›ä¸è¦æŠŠæ„å»ºå™¨ç¼“å­˜ä¸ºé™æ€/å•ä¾‹ï¼Œä¹Ÿä¸è¦åœ¨å¹¶å‘åœºæ™¯å…±äº«åŒä¸€ä¸ªå®ä¾‹ã€‚</li>\n</ul>\n<h4 id=\"æŸ¥è¯¢select\">æŸ¥è¯¢ï¼ˆSelectï¼‰</h4>\n<pre><code class=\"language-csharp\">using SmartDapper.Extensions;\n\npublic sealed class UserBriefDto\n{\n    public int Id { get; set; }\n    public string UserName { get; set; } = string.Empty;\n}\n\n// 1) å…¨å­—æ®µæŸ¥è¯¢ + Where + OrderBy\nvar list = await conn.QuerySet&lt;User&gt;()\n    .Where(u =&gt; u.IsActive &amp;&amp; u.Age &gt;= 18)\n    .OrderBy(u =&gt; u.Id)\n    .ToListAsync();\n\n// 1.3) DISTINCTï¼ˆæŸ¥è¯¢å»é‡ï¼‰\nvar distinctList = await conn.QuerySet&lt;User&gt;()\n    .Distinct()\n    .Where(u =&gt; u.IsActive)\n    .ToListAsync();\n\n// 1.1) å¤šå­—æ®µæ’åºï¼ˆæ”¯æŒ new { ... }ï¼‰\nvar list2 = await conn.QuerySet&lt;User&gt;()\n    .Where(u =&gt; u.IsActive)\n    .OrderBy(u =&gt; new { u.Age, u.Id })\n    .ToListAsync();\n\n// 1.2) é™åºæ’åºï¼ˆç‹¬ç«‹æ–¹æ³•ï¼‰\nvar list3 = await conn.QuerySet&lt;User&gt;()\n    .Where(u =&gt; u.IsActive)\n    .OrderByDescending(u =&gt; u.Id)\n    .ToListAsync();\n\n// 2) æŠ•å½±ï¼ˆæ¨èï¼šDTO/åŒ¿åç±»å‹ï¼‰\nvar dtoList = await conn.QuerySet&lt;User&gt;()\n    .Select(u =&gt; new { u.Id, u.UserName })\n    .Distinct()\n    .Where(u =&gt; u.IsActive)\n    .OrderBy(u =&gt; u.Id)\n    .ToListAsync();\n\n// 2.1) æŠ•å½±åˆ° DTOï¼ˆå¯¹è±¡åˆå§‹åŒ–å™¨ï¼‰\nvar dtoList2 = await conn.QuerySet&lt;User&gt;()\n    .Select(u =&gt; new UserBriefDto { Id = u.Id, UserName = u.UserName })\n    .Where(u =&gt; u.IsActive)\n    .ToListAsync();\n\n// 3) æŒ‡å®šåˆ—ï¼ˆå­—ç¬¦ä¸²ï¼šä»è¿”å›å®ä½“ Tï¼Œä½†è¯·æ³¨æ„æœªé€‰åˆ—å°†ä¸ºé»˜è®¤å€¼ï¼‰\nvar columns = await conn.QuerySet&lt;User&gt;()\n    .Select(\"Id\", \"UserName\")\n    .ToListAsync();\n\n// 3.1) å­—ç¬¦ä¸²åˆ—åæ’åºï¼ˆå‡åº/é™åºï¼‰\nvar columns2 = await conn.QuerySet&lt;User&gt;()\n    .Select(\"Id\", \"UserName\")\n    .OrderBy(\"Id\", \"UserName\")\n    .ToListAsync();\n\nvar columns3 = await conn.QuerySet&lt;User&gt;()\n    .Select(\"Id\", \"UserName\")\n    .OrderByDescending(\"Id\", \"UserName\")\n    .ToListAsync();\n\n// 3.2) GroupByï¼ˆåˆ†ç»„ï¼‰\n// æ³¨æ„ï¼šGroupBy å¿…é¡»é…åˆ Select(\"Col1\", ...) æˆ– Select(projection) æŒ‡å®šè¿”å›åˆ—\nvar grouped = await conn.QuerySet&lt;User&gt;()\n    .Select(\"Age\")\n    .GroupBy(u =&gt; u.Age)\n    .ToListAsync();\n\n// 3.3) èšåˆ + Havingï¼ˆæ¨èï¼šæŠ•å½± + SqlFuncï¼‰\n// æ³¨æ„ï¼šèšåˆå‡½æ•°é€šè¿‡ SqlFunc.* åœ¨è¡¨è¾¾å¼ä¸­å£°æ˜ï¼Œç”¨äºç”Ÿæˆ SQLï¼ˆä¸ä¼šåœ¨è¿è¡Œæ—¶æ‰§è¡Œï¼‰ã€‚\n// å…¸å‹ç”Ÿæˆ SQL å½¢æ€ï¼š\n// SELECT [Age] AS [Age], COUNT(*) AS [Cnt] FROM [Users] GROUP BY [Age] HAVING (COUNT(*) &gt; @value)\nvar grouped2 = await conn.QuerySet&lt;User&gt;()\n    .Select(u =&gt; new { u.Age, Cnt = SqlFunc.Count() })\n    .GroupBy(u =&gt; u.Age)\n    .Having(u =&gt; SqlFunc.Count() &gt; 1)\n    .ToListAsync();\n\n// 4) å…¼å®¹æ–¹å¼ï¼ˆä¸æ¨èï¼‰ï¼šSelectColumns(...) å·²æ ‡è®° Obsoleteï¼Œè¿”å›â€œéƒ¨åˆ†å­—æ®µâ€çš„å®ä½“ï¼Œæ˜“è¯¯ç”¨\nvar legacyColumns = await conn.QuerySet&lt;User&gt;()\n    .SelectColumns(u =&gt; new { u.Id, u.UserName })\n    .ToListAsync();\n\n// 5) JOINï¼ˆInner / Left / Rightï¼‰\n// æ³¨æ„ï¼šJOIN éœ€è¦ä½ æä¾› ON æ¡ä»¶ï¼ˆè¡¨è¾¾å¼æ ‘æˆ–åŸç”Ÿ SQL ç‰‡æ®µï¼‰\nvar joined = await conn.QuerySet&lt;User&gt;()\n    .InnerJoin&lt;Role&gt;((u, r) =&gt; u.RoleId == r.Id)\n    .Where&lt;Role&gt;((u, r) =&gt; u.IsActive &amp;&amp; r.IsEnabled) // åŒè¡¨ WHERE\n    .Select&lt;Role&gt;((u, r) =&gt; new { u.Id, u.UserName, r.RoleName }) // JOIN æŠ•å½±ï¼ˆåŒæ—¶å¼•ç”¨ä¸¤å¼ è¡¨ï¼›åŒ¿åç±»å‹æ— éœ€å†™ objectï¼‰\n    .Distinct()\n    .ToListAsync();\n\n// 5.1) JOIN + åŸç”Ÿ SQL WHEREï¼ˆå¤æ‚åœºæ™¯å…œåº•ï¼‰\nvar joined2 = await conn.QuerySet&lt;User&gt;()\n    .LeftJoin&lt;Role&gt;((u, r) =&gt; u.RoleId == r.Id)\n    .Where(\"[Role].[RoleName] LIKE @name\", new { name = \"%Admin%\" })\n    .ToListAsync();\n\n// 5.2) ä¸¤æ¬¡ JOIN + ä¸‰è¡¨æŠ•å½± + ä¸‰è¡¨ WHERE\n// æ³¨æ„ï¼šç¬¬äºŒæ¬¡ JOIN å¯ä»¥ç”¨â€œå·² Join çš„è¡¨â€ä½œä¸ºå·¦è¡¨ï¼ˆä¾‹å¦‚ Role -&gt; Deptï¼‰\nvar joined3 = await conn.QuerySet&lt;User&gt;()\n    .InnerJoin&lt;Role&gt;((u, r) =&gt; u.RoleId == r.Id)\n    .InnerJoin&lt;Role, Dept&gt;((r, d) =&gt; r.DeptId == d.Id) // ä»¥ Role ä½œä¸ºå·¦è¡¨å…³è” Dept\n    .Select&lt;Role, Dept&gt;((u, r, d) =&gt; new { u.Id, u.UserName, r.RoleName, d.DeptName })\n    .Where&lt;Role, Dept&gt;((u, r, d) =&gt; u.IsActive &amp;&amp; r.IsEnabled &amp;&amp; d.IsEnabled)\n    .ToListAsync();\n\n// 6) UNION / UNION ALLï¼ˆåˆå¹¶ç»“æœé›†ï¼‰\n// æ³¨æ„ï¼šUNION è¦æ±‚ä¸¤ä¾§ SELECT çš„åˆ—æ•°é‡/ç±»å‹å¯å…¼å®¹ï¼›åº“ä¸ä¼šè‡ªåŠ¨å¯¹é½åˆ—ã€‚\n// å¦å¤–ï¼Œä¸ºé¿å…ä¸¤ä¾§å‚æ•°åå†²çªï¼ˆä¾‹å¦‚éƒ½ç”Ÿæˆ @Age / @w0_0ï¼‰ï¼ŒUNION ä¼šè‡ªåŠ¨å¯¹æ¯ä¸ªå­æŸ¥è¯¢åšå‚æ•°å‰ç¼€éš”ç¦»ã€‚\nvar unionList = await conn.QuerySet&lt;User&gt;()\n    .Where(u =&gt; u.Age &gt; 18)\n    .UnionAll(\n        conn.QuerySet&lt;User&gt;().Where(u =&gt; u.Age &gt; 20))\n    .OrderBy(\"Id\")   // UNION ç»“æœé›†åˆ—å/åˆ«åï¼ˆåªå…è®¸â€œç®€å•æ ‡è¯†ç¬¦â€ï¼‰\n    .Paging(0, 20)   // SqlServer/Oracleï¼šUNION åˆ†é¡µå¿…é¡»å…ˆ OrderBy(...)\n    .ToListAsync();\n</code></pre>\n<h4 id=\"åˆ é™¤delete\">åˆ é™¤ï¼ˆDeleteï¼‰</h4>\n<pre><code class=\"language-csharp\">// 1) æ¡ä»¶åˆ é™¤\nvar affected = await conn.DeleteSet&lt;User&gt;()\n    .Where(u =&gt; u.IsActive == false)\n    .ExecuteAsync();\n\n// 2) æŒ‰ä¸»é”®åˆ é™¤\nvar affected2 = await conn.DeleteSet&lt;User&gt;()\n    .ByKey(1)\n    .ExecuteAsync();\n</code></pre>\n<h4 id=\"è½¯åˆ é™¤soft-delete\">è½¯åˆ é™¤ï¼ˆSoft Deleteï¼‰</h4>\n<p>ç®€åŒ–ç­–ç•¥ï¼ˆæ¨èï¼‰ï¼š</p>\n<ul>\n<li><strong>ç‰©ç†åˆ é™¤</strong>ï¼š<code>Delete(...) / DeleteSet&lt;T&gt;()</code> æ°¸è¿œæ‰§è¡Œ <code>DELETE</code>ã€‚</li>\n<li><strong>é€»è¾‘åˆ é™¤ï¼ˆè½¯åˆ ï¼‰</strong>ï¼šæ˜¾å¼è°ƒç”¨ <code>SoftDelete(...) / SoftDeleteSet&lt;T&gt;()</code>ï¼Œå¹¶ä¸”å®ä½“å¿…é¡»æ ‡æ³¨ <code>[SoftDelete]</code>ï¼›å¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆé¿å…è¯¯ä»¥ä¸ºå·²è½¯åˆ ï¼‰ã€‚</li>\n<li><strong>æŸ¥è¯¢è¿‡æ»¤</strong>ï¼šå…¨å±€å¼€å…³ <code>FilterSoftDeleted</code> æ§åˆ¶æ˜¯å¦è¿‡æ»¤å·²åˆ é™¤æ•°æ®ï¼›é»˜è®¤ä¸è¿‡æ»¤ï¼ˆæŸ¥è¯¢åŒ…å«å·²åˆ é™¤æ•°æ®ï¼‰ã€‚è¿‡æ»¤ä»…å¯¹æ ‡æ³¨äº† <code>[SoftDelete]</code> çš„å®ä½“ç”Ÿæ•ˆã€‚</li>\n</ul>\n<pre><code class=\"language-csharp\">// 0) å®ä½“å£°æ˜è½¯åˆ é™¤ï¼šå¯ä»¥æ ‡åœ¨â€œå®ä½“ç±»â€æˆ–â€œè½¯åˆ å­—æ®µå±æ€§â€ä¸Š\n// - æ¨èæ ‡åœ¨å±æ€§ä¸Šï¼šæ— éœ€é…ç½® ColumnNameï¼Œé»˜è®¤ä½¿ç”¨å±æ€§åï¼ˆæˆ– [Column] æ˜ å°„åï¼‰\n// - Flag æ¨¡å¼é»˜è®¤å€¼ï¼šNotDeletedValue=0ï¼ŒDeletedValue=1\n//\n// class User\n// {\n//     [Key]\n//     public int Id { get; set; }\n//\n//     [SoftDelete] // é»˜è®¤ Mode=Flagï¼ŒNotDeletedValue=0ï¼ŒDeletedValue=1\n//     public int IsDeleted { get; set; }\n// }\n\n// 1) å¯ç”¨è½¯åˆ é™¤ï¼ˆå»ºè®®åœ¨å¯åŠ¨é˜¶æ®µé…ç½®ä¸€æ¬¡ï¼‰\n// - DI é£æ ¼ï¼ˆæ¨èï¼‰ï¼šåœ¨ Program.cs é‡Œé…ç½®ï¼Œå¯ä¸ SQL æ—¥å¿—ä¸€èµ·é›†ä¸­é…ç½®\n//   builder.Services.AddSmartDapper(configureSoftDelete: o =&gt;\n//   {\n//       o.FilterSoftDeleted = true; // å¼€å¯åï¼šæŸ¥è¯¢ä¼šè‡ªåŠ¨æ’é™¤â€œå·²åˆ é™¤â€ï¼ˆä»…å¯¹æ ‡æ³¨äº† [SoftDelete] çš„å®ä½“ç”Ÿæ•ˆï¼‰\n//   });\n//\n// - é DI åœºæ™¯ï¼šç›´æ¥é…ç½®\nDapperExtensions.ConfigureSoftDelete(o =&gt;\n{\n    o.FilterSoftDeleted = true; // å¼€å¯åï¼šæŸ¥è¯¢ä¼šè‡ªåŠ¨æ’é™¤â€œå·²åˆ é™¤â€ï¼ˆä»…å¯¹æ ‡æ³¨äº† [SoftDelete] çš„å®ä½“ç”Ÿæ•ˆï¼‰\n});\n\n// 2) æŸ¥è¯¢ï¼šé»˜è®¤åŒ…å«å·²åˆ é™¤ï¼›å½“ FilterSoftDeleted=true æ—¶è‡ªåŠ¨æ’é™¤å·²åˆ é™¤\nvar list = await conn.QuerySet&lt;User&gt;()\n    .Where(u =&gt; u.IsActive)\n    .ToListAsync();\n\n// 3) ç‰©ç†åˆ é™¤ï¼ˆDELETEï¼‰\nawait conn.DeleteSet&lt;User&gt;().ByKey(1).ExecuteAsync();\n\n// 4) é€»è¾‘åˆ é™¤ï¼ˆSoftDeleteï¼‰ï¼šå®ä½“å¿…é¡»æ ‡æ³¨ [SoftDelete]ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸\nawait conn.SoftDeleteSet&lt;User&gt;().ByKey(1).ExecuteAsync();\n\n// 5) æ¢å¤ï¼ˆåè½¯åˆ ï¼‰\nawait conn.RestoreSet&lt;User&gt;().ByKey(1).ExecuteAsync();\n</code></pre>\n<h4 id=\"æ’å…¥insert\">æ’å…¥ï¼ˆInsertï¼‰</h4>\n<pre><code class=\"language-csharp\">// 1) è‡ªåŠ¨åˆ›å»ºå®ä½“å¹¶å¡«å……\nvar newId = await conn.InsertSet&lt;User&gt;()\n    .Fill(u =&gt; { u.UserName = \"Alice\"; u.IsActive = true; })\n    .ExecuteAndGetIdAsync();\n\n// 2) åŸºäºå·²æœ‰å®ä½“å®ä¾‹\nvar user = new User { UserName = \"Bob\", IsActive = true };\nawait conn.InsertSet(user).ExecuteAsync();\n</code></pre>\n<h4 id=\"æ›´æ–°update\">æ›´æ–°ï¼ˆUpdateï¼‰</h4>\n<pre><code class=\"language-csharp\">// 1) æ¨èï¼šå¯¹è±¡åˆå§‹åŒ–å™¨ï¼ˆè¡¨è¾¾å¼æ ‘æå–å€¼ï¼‰\nvar rows = await conn.UpdateSet&lt;User&gt;()\n    .Set(u =&gt; new User { UserName = \"Alice\", IsActive = true })\n    .Where(u =&gt; u.Id == 1)\n    .ExecuteAsync();\n\n// 2) ä¹Ÿæ”¯æŒï¼šåŒ¿åå¯¹è±¡ï¼ˆå­—æ®µåæŒ‰â€œå±æ€§å/åˆ—åâ€å¤„ç†ï¼‰\nvar rows2 = await conn.UpdateSet&lt;User&gt;()\n    .Set(new { UserName = \"Alice\", IsActive = true })\n    .Where(u =&gt; u.Id == 1)\n    .ExecuteAsync();\n</code></pre>\n<h4 id=\"fluent-çš„å·²çŸ¥é™åˆ¶æ³¨æ„äº‹é¡¹\">Fluent çš„å·²çŸ¥é™åˆ¶/æ³¨æ„äº‹é¡¹</h4>\n<ul>\n<li><strong>åˆ†é¡µä¸æ’åº</strong>ï¼š<code>QuerySet&lt;T&gt;().Paging(skip, take)</code> ç›®å‰<strong>ä¸æ”¯æŒ</strong>ä¸è‡ªå®šä¹‰ <code>OrderBy(...)</code> åŒç”¨ï¼ˆåˆ†é¡µ SQL å·²å†…ç½®æ’åºè§„åˆ™ï¼‰ã€‚</li>\n<li><strong>åˆ†é¡µä¸æ’åºï¼ˆé™åºï¼‰</strong>ï¼šåŒæ ·ä¸æ”¯æŒä¸ <code>OrderByDescending(...)</code> åŒç”¨ã€‚</li>\n<li><strong>åˆ†é¡µä¸åˆ†ç»„</strong>ï¼š<code>QuerySet&lt;T&gt;().Paging(skip, take)</code> ç›®å‰<strong>ä¸æ”¯æŒ</strong>ä¸ <code>GroupBy(...)</code> åŒç”¨ã€‚</li>\n<li><strong>DISTINCT æ³¨æ„äº‹é¡¹</strong>ï¼š<code>Distinct()</code> ä¼šå¯¹æ•´è¡Œå»é‡ï¼Œå¯èƒ½å¸¦æ¥é¢å¤–å¼€é”€ï¼›å¹¶ä¸”åœ¨ä¸åŒæ•°æ®åº“ä¸Šä¸ <code>ORDER BY</code>/åˆ†é¡µç»„åˆæ—¶å­˜åœ¨è¯­ä¹‰å·®å¼‚ï¼Œè¯·æŒ‰ä¸šåŠ¡è°¨æ…ä½¿ç”¨ã€‚</li>\n<li><strong>åˆ†ç»„é™åˆ¶</strong>ï¼š<code>GroupBy(...)</code> éœ€è¦æ˜¾å¼æŒ‡å®šè¿”å›åˆ—ï¼ˆ<code>Select(\"Col1\", ...)</code> æˆ– <code>Select(projection)</code>ï¼‰ï¼›ä¸æ”¯æŒâ€œå…¨å­—æ®µ + GroupByâ€ã€‚</li>\n<li><strong>Having é™åˆ¶</strong>ï¼š<code>Having(...)</code> éœ€è¦æ˜¾å¼æŒ‡å®šè¿”å›åˆ—ï¼ˆ<code>Select(\"Col1\", ...)</code> æˆ– <code>Select(projection)</code>ï¼‰ï¼›é€šå¸¸åº”ä¸ <code>GroupBy(...)</code> é…åˆä½¿ç”¨ã€‚\n<ul>\n<li>è¡¨è¾¾å¼ç‰ˆ <code>Having(predicate)</code> æ”¯æŒ <code>SqlFunc.Count/Sum/Avg/Min/Max/CountDistinct</code> ç­‰èšåˆå‡½æ•°å£°æ˜ï¼›</li>\n<li>å¤æ‚åœºæ™¯å¯ç”¨ <code>Having(\"COUNT(*) &gt; @min\", new { min = 1 })</code> ç›´æ¥å†™ SQL ç‰‡æ®µï¼ˆæ³¨æ„è‡ªè¡Œä¿è¯å®‰å…¨ï¼‰ã€‚</li>\n</ul>\n</li>\n<li><strong>æŠ•å½±é™åˆ¶</strong>ï¼šæŠ•å½±é“¾ï¼ˆ<code>Select(projection)</code>ï¼‰ç›®å‰<strong>ä¸æ”¯æŒ</strong> <code>Paging(...)</code>ï¼Œä¹Ÿ<strong>ä¸æ”¯æŒ</strong>ä¸ <code>SelectColumns(...)</code> æ··ç”¨ï¼ˆ<code>SelectColumns</code> å·²æ ‡è®° Obsoleteï¼Œä»…ä¸ºå…¼å®¹ä¿ç•™ï¼‰ã€‚</li>\n<li><strong>JOIN æŠ•å½±é™åˆ¶</strong>ï¼š\n<ul>\n<li><code>Select&lt;TJoin&gt;((t, j) =&gt; ...)</code>ï¼šæ”¯æŒ <strong>1 ä¸ª JOIN</strong>ï¼›</li>\n<li><code>Select&lt;TJoin1, TJoin2&gt;((t, j1, j2) =&gt; ...)</code>ï¼šæ”¯æŒ <strong>2 ä¸ª JOIN</strong>ï¼›</li>\n<li>å½“å‰ç‰ˆæœ¬ <code>Where(predicate)</code> çš„å¤šè¡¨è°“è¯ä»…æ”¯æŒ <strong>2 è¡¨/3 è¡¨</strong>ï¼Œä¸”ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸»è¡¨ <code>T</code>ã€‚</li>\n</ul>\n</li>\n<li><strong>UNION é™åˆ¶/æ³¨æ„</strong>ï¼š\n<ul>\n<li><code>Union/UnionAll</code> è¦æ±‚ä¸¤ä¾§æŸ¥è¯¢çš„åˆ—åˆ—è¡¨ç»“æ„å…¼å®¹ï¼ˆæ•°é‡/ç±»å‹ï¼‰ï¼Œåº“ä¸ä¼šè‡ªåŠ¨è¡¥é½/å¯¹é½åˆ—ï¼›</li>\n<li>UNION çš„ <code>OrderBy(\"Col\")</code> ä»…æ”¯æŒ<strong>ç®€å•åˆ—å/åˆ«å</strong>ï¼ˆä¸æ”¯æŒ <code>Table.Col</code> è¿™ç±»å¸¦ç‚¹å·å½¢å¼ï¼‰ï¼›</li>\n<li>SqlServer/Oracle ä¸‹ UNION çš„ <code>Paging(skip,take)</code> éœ€è¦å…ˆ <code>OrderBy(...)</code>ï¼ˆå¦åˆ™æ— æ³•ç”Ÿæˆ OFFSET/FETCHï¼‰ã€‚</li>\n</ul>\n</li>\n<li><strong>First/Single</strong>ï¼š<code>FirstOrDefault()/SingleOrDefault()</code> ä¸ä¼šå¼ºåˆ¶åŠ  <code>TOP/LIMIT</code>ï¼Œä»…å¯¹ç»“æœé›†åšâ€œå–ç¬¬ä¸€æ¡/å•æ¡â€çš„è¡Œä¸ºï¼ˆå¤šæ¡å‘½ä¸­æ—¶ <code>SingleOrDefault</code> ä¼šæŠ›å¼‚å¸¸ï¼‰ã€‚</li>\n</ul>\n<h3 id=\"å¤šæ•°æ®åº“æ”¯æŒ\">å¤šæ•°æ®åº“æ”¯æŒ</h3>\n<ul>\n<li>SQL Serverï¼š<code>SqlGeneratorFactory.CreateSqlServer&lt;T&gt;()</code></li>\n<li>MySQLï¼š<code>SqlGeneratorFactory.CreateMySql&lt;T&gt;()</code></li>\n<li>SQLiteï¼š<code>SqlGeneratorFactory.CreateSqlite&lt;T&gt;()</code></li>\n</ul>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-09 10:16</span>&nbsp;\n<a href=\"https://www.cnblogs.com/mumaren\">ç‰§é©¬äººwin</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">133</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "ã€MongoDBã€‘MongoDB æ¦‚è¿°",
      "link": "https://www.cnblogs.com/MeteorSeed/p/19588943",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/MeteorSeed/p/19588943\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-09 10:09\">\n    <span>ã€MongoDBã€‘MongoDB æ¦‚è¿°</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p><span>ã€€ã€€MongoDB æ˜¯ä¸€æ¬¾å¼€æºçš„ NoSQL æ–‡æ¡£å‹æ•°æ®åº“ï¼Œä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚&nbsp;<span>PostgreSQLï¼‰çš„è¡¨ç»“æ„ä¸åŒï¼ŒMongoDB ä»¥ç±»ä¼¼ JSON çš„ BSONï¼ˆBinary JSONï¼‰æ ¼å¼å­˜å‚¨æ•°æ®ï¼Œæ”¯æŒåŠ¨æ€æ‰©å±•æ•°æ®ç»“æ„ï¼Œéå¸¸é€‚åˆå¤„ç†éç»“æ„åŒ–ã€åŠç»“æ„åŒ–æ•°æ®åŠé«˜å¹¶å‘ã€å¤§æ•°æ®é‡çš„ä¸šåŠ¡åœºæ™¯ã€‚</span></span></p>\n<p><span>ã€€ã€€BSON ä½œä¸º MongoDB çš„æ ¸å¿ƒæ•°æ®æ ¼å¼ï¼Œä¸ä»…å…¼å®¹ JSON çš„æ•°æ®ç»“æ„ï¼Œè¿˜æ”¯æŒäºŒè¿›åˆ¶æ•°æ®ã€æ—¥æœŸã€æ—¶é—´æˆ³ç­‰æ‰©å±•ç±»å‹ï¼Œèƒ½æ›´é«˜æ•ˆåœ°æ»¡è¶³å¤æ‚æ•°æ®å­˜å‚¨éœ€æ±‚ã€‚æ¯ä¸ªæ•°æ®è®°å½•è¢«ç§°ä¸ºâ€œæ–‡æ¡£â€ï¼Œå¤šä¸ªæ–‡æ¡£ç»„æˆâ€œé›†åˆâ€ï¼Œé›†åˆå¯¹åº”å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ï¼Œä½†æ— éœ€éµå¾ªç»Ÿä¸€çš„å­—æ®µç»“æ„ï¼ŒåŒä¸€é›†åˆä¸­çš„æ–‡æ¡£å¯æ‹¥æœ‰ä¸åŒçš„å­—æ®µå’Œæ•°æ®ç±»å‹ã€‚</span></p>\n<h1><span><span>MongoDB æ ¸å¿ƒç‰¹æ€§</span></span></h1>\n<p><span><span>ã€€ã€€- çµæ´»çš„æ–‡æ¡£æ¨¡å‹ï¼šæ–‡æ¡£ç»“æ„ä¸åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡æ¨¡å‹å¤©ç„¶å¥‘åˆï¼Œæ— éœ€å¤æ‚çš„å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰ï¼ŒåµŒå…¥å¼æ–‡æ¡£å’Œæ•°ç»„å¯å‡å°‘è·¨è¡¨å…³è”æŸ¥è¯¢ï¼Œæå‡æ•°æ®è®¿é—®æ•ˆç‡ã€‚</span></span></p>\n<p><span><span>ã€€ã€€- é«˜æ€§èƒ½ï¼šåœ¨æµ·é‡æ•°æ®å¤„ç†æ–¹é¢ï¼ŒæŸ¥è¯¢é€Ÿåº¦å¿«ï¼›æ”¯æŒå¤šç§ç±»å‹ç´¢å¼•ï¼Œèƒ½é«˜æ•ˆå¤„ç†é«˜ååé‡è¯·æ±‚ã€‚æ”¯æŒåˆ†å¸ƒå¼è®¡ç®—èƒ½åŠ›ã€‚</span></span></p>\n<p><span><span>ã€€ã€€- é«˜å¯ç”¨æ€§ï¼šé€šè¿‡å‰¯æœ¬é›†å®ç°æ•°æ®å†—ä½™å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œå½“ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œé›†ç¾¤å¯è‡ªåŠ¨é€‰ä¸¾æ–°ä¸»èŠ‚ç‚¹ï¼Œç¡®ä¿æœåŠ¡æŒç»­å¯ç”¨ã€‚</span></span></p>\n<p><span><span>ã€€ã€€- æ°´å¹³æ‰©å±•æ€§ï¼šé€šè¿‡åˆ†ç‰‡æŠ€æœ¯å°†æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ï¼Œå¯æ ¹æ®æ•°æ®é‡å’Œå¹¶å‘éœ€æ±‚åŠ¨æ€æ‰©å±•é›†ç¾¤å®¹é‡ï¼Œçªç ´å•èŠ‚ç‚¹æ€§èƒ½ç“¶é¢ˆã€‚</span></span></p>\n<p><span><span>ã€€ã€€- äº‹åŠ¡æ”¯æŒï¼šMongoDB æœ€åˆå¹¶ä¸æ”¯æŒäº‹åŠ¡ã€‚ç„¶è€Œï¼Œéšç€ç‰ˆæœ¬è¿­ä»£ï¼ŒMongoDB åœ¨å…¶ 4.0 ç‰ˆ æœ¬ä¸­å¼€å§‹æ”¯æŒå¤šæ–‡æ¡£äº‹åŠ¡ã€‚</span></span></p>\n<p><span><span>ã€€ã€€- ä¸°å¯Œçš„æŸ¥è¯¢èƒ½åŠ›ï¼šæ”¯æŒèŒƒå›´æŸ¥è¯¢ã€æ¨¡ç³ŠæŸ¥è¯¢ã€åœ°ç†ç©ºé—´æŸ¥è¯¢ã€å…¨æ–‡æœç´¢ç­‰å¤šç§æŸ¥è¯¢æ–¹å¼ï¼Œé…åˆå¼ºå¤§çš„èšåˆè®¡ç®—èƒ½åŠ›å®ç°å¤æ‚æ•°æ®ç»Ÿè®¡åˆ†æï¼ˆé€‚åˆéç»“æ„åŒ–æ•°æ®ï¼‰ã€‚</span></span></p>\n<p><span><span>ã€€ã€€- è·¨å¹³å°ï¼šæ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿã€‚</span></span></p>\n<p><span><span>ã€€ã€€- ç®€å•æ˜“ç”¨ï¼š<span>MongoDB æ˜¯é€šç”¨å‹æ–‡æ¡£æ•°æ®åº“ï¼Œè®¾è®¡åˆè¡·å°±æ˜¯è´´è¿‘å¼€å‘ä¹ æƒ¯ã€é™ä½å­˜å‚¨å’Œé€šç”¨æŸ¥è¯¢çš„ä½¿ç”¨æˆæœ¬ï¼Œç›¸æ¯”äº Elasticsearchï¼ŒMongoDB åœ¨å¼€å‘ã€æŸ¥è¯¢è¯­å¥ã€éƒ¨ç½²è¿ç»´ç­‰æ–¹é¢éƒ½æ›´ç®€å•ï¼Œå­¦ä¹ æˆæœ¬ä¹Ÿæ›´ä½ã€‚</span></span></span></p>\n<h1><span><span>MongoDB çš„è®¾è®¡æ€è·¯</span></span></h1>\n<p><span>ã€€ã€€MongoDB ä¸åŒäº PostgreSQL è¿™ç±»å…³ç³»å‹æ•°æ®åº“ï¼Œä¸¤è€…çš„è®¾è®¡åˆè¡·æœ¬è´¨å°±ä¸åŒ â€”â€” å…³ç³»å‹æ•°æ®åº“æ˜¯å¼ºä¸€è‡´æ€§ã€äº‹åŠ¡å®‰å…¨ä¼˜å…ˆçš„æ•°æ®åº“ï¼Œ<span>ä¸º â€œæ•°æ®å…³è”ç´§å¯†ã€äº‹åŠ¡è¦æ±‚é«˜ã€æŸ¥è¯¢å¤æ‚â€ çš„ä¸šåŠ¡è€Œç”Ÿï¼Œ<span>ç‰ºç‰²éƒ¨åˆ†æ€§èƒ½æ¢æ•°æ®å¯é æ€§ï¼Œå› æ­¤ï¼Œåœ¨æµ·é‡æ•°æ®æƒ…å†µä¸‹ä¼šå¼•å‘æ€§èƒ½é—®é¢˜<span>ï¼›è€Œ MongoDB æ˜¯é«˜å¹¶å‘ã€æ°´å¹³æ‰©å±•ä¼˜å…ˆçš„æ•°æ®åº“ï¼Œ<span>æ˜¯ä¸ºçµæ´»ã€æ‰©å±•ã€é«˜æ€§èƒ½å†™å…¥è®¾è®¡çš„æ–‡æ¡£å‹ NoSQLï¼Œä¸º â€œæ•°æ®ç»“æ„å¤šå˜ã€æµ·é‡æ•°æ®ã€é«˜å¹¶å‘å†™å…¥ã€æ°´å¹³æ‰©å±•â€ çš„äº’è”ç½‘ä¸šåŠ¡è€Œç”Ÿã€‚ä¸ºäº†ä¸å…³ç³»å‹æ•°æ®åº“å¯¹é½ï¼Œå…¶äº‹åŠ¡åŠŸèƒ½æ˜¯<span>åç»­ç‰ˆæœ¬é€šè¿‡è¿­ä»£è¡¥å…¨çš„ç‰¹æ€§ï¼Œå› å…¶å¼•æ“æœ¬è´¨ä¸å˜ï¼Œä»æœ‰å…ˆå¤©å±€é™æ€§ï¼Œä¼šåœ¨æ€§èƒ½å’ŒåŠŸèƒ½ä¸Šå­˜åœ¨ä¸è¶³ã€‚</span></span></span></span></span></span></p>\n<h1><span><span>MongoDB é€‚ç”¨åœºæ™¯</span></span></h1>\n<p><span>ã€€ã€€MongoDB å‡­å€Ÿå…¶çµæ´»æ€§å’Œé«˜æ€§èƒ½ï¼Œå¹¿æ³›åº”ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</span></p>\n<p><span><span>ã€€ã€€- äº’è”ç½‘åº”ç”¨ï¼šç”¨æˆ·ç”»åƒã€æ—¥å¿—å­˜å‚¨ã€ç¤¾äº¤ç½‘ç»œåŠ¨æ€ç­‰éç»“æ„åŒ–æ•°æ®å­˜å‚¨ã€‚</span></span></p>\n<p><span><span>ã€€ã€€- æ¸¸æˆå¼€å‘ï¼šæ–‡æ¡£æ¨¡å‹ä¸æ•°æ®ç»“æ„å¤©ç„¶åŒ¹é…ï¼Œå®Œç¾æ˜ å°„æ¸¸æˆå¤æ‚æ•°æ®ï¼Œå•æ–‡æ¡£å­˜å‚¨è§’è‰²ã€è£…å¤‡ã€æŠ€èƒ½ã€ä»»åŠ¡ç­‰å…¨é‡æ•°æ®ï¼Œèƒ½æœ‰æ•ˆé¿å…å¤šè¡¨ JOINï¼Œ<span>é«˜å¹¶å‘ï¼Œæ€§èƒ½å¥½<span>ã€‚</span></span></span></span></p>\n<p><span>ã€€ã€€-<span>&nbsp;ç”µå•†å¹³å°ï¼šå•†å“ä¿¡æ¯ã€è®¢å•æ•°æ®ã€ç”¨æˆ·è¡Œä¸ºè½¨è¿¹åˆ†æã€‚</span></span></p>\n<p><span><span>ã€€ã€€- ç‰©è”ç½‘ï¼šè®¾å¤‡ç›‘æ§æ•°æ®ã€ä¼ æ„Ÿå™¨é‡‡é›†æ•°æ®ç­‰æ•°æ®çš„å­˜å‚¨ä¸å®æ—¶åˆ†æã€‚</span></span></p>\n<p><span><span>ã€€ã€€- å¤§æ•°æ®åœºæ™¯ï¼šæ”¯æŒæµ·é‡æ•°æ®çš„å¿«é€Ÿå†™å…¥å’ŒæŸ¥è¯¢ã€‚</span></span></p>\n<h1><span><span>MongoDB ä¸é€‚ç”¨åœºæ™¯</span></span></h1>\n<h2><span><span>é«˜å¹¶å‘å¼ºäº‹åŠ¡æ•°æ®ä¸€è‡´æ€§åœºæ™¯</span></span></h2>\n<p><span><span>ã€€ã€€æ¯”å¦‚é‡‘èç³»ç»Ÿä¸­çš„è´¦æˆ·è½¬è´¦ã€æ”¯ä»˜ç»“ç®—ã€ä¿¡è´·æ”¾æ¬¾ã€è´¦åŠ¡æ¸…ç®—ï¼›ç”µå•†çš„è®¢å•æ”¯ä»˜ + åº“å­˜æ‰£å‡ + ä¼˜æƒ åˆ¸æ ¸é”€çš„è”åŠ¨æ“ä½œç­‰ã€‚è™½ç„¶ MongoD<span>B<span>&nbsp;ä¹Ÿæ”¯æŒäº‹åŠ¡ï¼Œä½†å±äºâ€œèƒ½ç”¨ä½†ä¸å¥½ç”¨â€çš„<span>çŠ¶æ€ï¼ˆé”ç²’åº¦å¯¼è‡´äº‹åŠ¡æ€§èƒ½ä¸ä½³ï¼‰<span>ã€‚</span></span></span></span></span></span></p>\n<h2><span><span>å¤æ‚å¤šè¡¨å…³è”çš„å¯†é›†æŸ¥è¯¢åœºæ™¯</span></span></h2>\n<p><span>ã€€ã€€æ¯”å¦‚ï¼šå¤æ‚æŠ¥è¡¨åˆ†æ ã€å¤šç»´åº¦è”è¡¨æŸ¥è¯¢ã€å¤§è§„æ¨¡æ•°æ®ç»Ÿè®¡åˆ†æã€‚</span></p>\n<h2><span><span>ä¸šåŠ¡ä¾èµ–é«˜çº§ç‰¹æ€§æ”¯æŒ</span></span></h2>\n<p><span>ã€€ã€€å¯¹äºéœ€è¦é«˜çº§ç‰¹æ€§æ”¯æŒçš„åº”ç”¨ï¼Œæ¯”å¦‚<span>ï¼Œå…¶<span>åœ°ç†ç©ºé—´æ”¯æŒè™½å¯ç”¨ï¼Œä½†ç›¸æ¯”å…¶ä»–æ•°æ®åº“ï¼ˆå¦‚ PostgreSQL çš„ PostGIS ï¼‰è¡¨ç°ä¸è¶³<span>ã€‚</span></span></span></span></p>\n<h2><span><span>æœªæ¥æœ‰å›½äº§åŒ–éœ€æ±‚çš„é¡¹ç›®</span></span></h2>\n<p><span><span>ã€€ã€€MongoDB å·²ç»æœ‰å¯¹åº”çš„å›½äº§åŒ–ç‰ˆæœ¬ï¼Œèƒ½å¤Ÿæ— ç¼å¹³æ›¿ï¼Œä½†å›½äº§åŒ– MongoDB çš„æˆæœ¬é«˜ï¼Œä¸”å°ä¼—ï¼Œä¸ä¸€å®šèƒ½é€‚ç”¨äºæ‰€æœ‰å›½äº§åŒ–é¡¹ç›®ã€‚MongoDB æ•°æ®åˆ°å…³ç³»å‹æ•°æ®è¿ç§»ï¼Œè™½ç„¶å¯è¡Œï¼Œä½†å› ä¸ºè®¾è®¡æ€è·¯ä¸åŒï¼Œå¦‚æœä¸æ˜¯é¢„å…ˆå°±è§„åˆ’è¿‡è¿ç§»åˆ°å…³ç³»å‹æ•°æ®åº“çš„éœ€æ±‚ï¼Œå¹¶æŒ‰ E-R å…³ç³»è®¾è®¡ç»“æ„ï¼Œå°±ä¼šå¯¼è‡´åæœŸéœ€è¦æ‹†è¡¨ï¼Œè¿ç§»æˆæœ¬å¤§å¹…æé«˜ï¼Œè½¯ä»¶æ¶æ„ä¸é€‚é…ç­‰é—®é¢˜ã€‚</span></span></p>\n<h1><span><span>å°èŠ‚</span></span></h1>\n<p><span><span>ã€€ã€€MongoDB æ˜¯ä¸€æ¬¾å¼€æºã€çµæ´»ã€é«˜æ€§èƒ½çš„æ–‡æ¡£å‹ NoSQL æ•°æ®åº“ï¼Œä»¥ BSON æ ¼å¼å­˜å‚¨æ•°æ®ï¼Œæ ¸å¿ƒä¼˜åŠ¿åœ¨äºçµæ´»çš„æ–‡æ¡£æ¨¡å‹ã€ä¼˜å¼‚çš„é«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€ä¾¿æ·çš„æ°´å¹³æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§ï¼Œè´´è¿‘å¼€å‘ä¹ æƒ¯ï¼Œå­¦ä¹ å’Œè¿ç»´æˆæœ¬è¾ƒä½ã€‚å…¶è®¾è®¡åˆè¡·èšç„¦äºæ•°æ®ç»“æ„å¤šå˜ã€æµ·é‡æ•°æ®ã€é«˜å¹¶å‘å†™å…¥çš„äº’è”ç½‘ç±»åœºæ™¯ï¼Œå¹¿æ³›åº”ç”¨äºäº’è”ç½‘ã€æ¸¸æˆã€ç”µå•†ã€ç‰©è”ç½‘ç­‰é¢†åŸŸã€‚åŒæ—¶ï¼ŒMongoDB ä¹Ÿå­˜åœ¨æ˜æ˜¾å±€é™ï¼Œåœ¨å¼ºäº‹åŠ¡ä¸€è‡´æ€§ã€å¤æ‚å¤šè¡¨å…³è”æŸ¥è¯¢ã€é«˜çº§ä¼ä¸šçº§ç‰¹æ€§æ”¯æŒç­‰åœºæ™¯ä¸­è¡¨ç°ä¸è¶³ï¼Œä¸”å›½äº§åŒ–é€‚é…ä»æœ‰æå‡ç©ºé—´ã€‚</span></span></p>\n<p><span> ã€€ã€€æ•´ä½“è€Œè¨€ï¼ŒMongoDB è™½éâ€œä¸‡èƒ½æ•°æ®åº“â€ï¼Œä½†ä»æœ‰æŒæ¡çš„å¿…è¦ï¼Œè‹¥ä¸šåŠ¡ä»¥éç»“æ„åŒ–/åŠç»“æ„åŒ–æ•°æ®ä¸ºä¸»ã€è¿½æ±‚é«˜å¹¶å‘å’Œæ‰©å±•æ€§ï¼Œä¸æ¶‰åŠå¼ºäº‹åŠ¡ï¼Œæ•°æ®é‡ç‰¹åˆ«å·¨å¤§<span>æ—¶<span>ï¼ŒMongoDB æ˜¯ä¼˜é€‰ã€‚</span></span></span></p>\n<p><span>ã€€ã€€åœ¨ä¸­å¤§å‹é¡¹ç›®ä¸­ï¼Œå¤šä¸ºå…³ç³»å‹ä¸éå…³ç³»å‹æ··åˆä½¿ç”¨ï¼Œç›¸æ¯” <span>Elasticsearchï¼Œ<span>MongoDB&nbsp;<span>å¥‘åˆä¸ªäºº â€œå¿«é€Ÿä¸Šæ‰‹ã€ä½æˆæœ¬å­¦ä¹ â€ å’Œå°å¾®ä¼ä¸š â€œäººåŠ›æœ‰é™ã€èµ„æºä¸è¶³ã€éœ€æ±‚ç®€å•â€ çš„æ ¸å¿ƒè¯‰æ±‚ï¼Œå› æ­¤å­¦ä¹ å’Œè¿ç»´æˆæœ¬æ›´ä½ï¼Œæ›´é€‚åˆä½œä¸ºä¸ªäººåŠå°å¾®ä¼ä¸šçš„ NoSQL é¦–é€‰æ•°æ®åº“ã€‚</span></span></span></span></p>\n<p>&nbsp;</p>\n<p><span><span><span><span>ã€€ã€€æˆ‘å¸Œæœ›æ‚¨å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œå¹¶ä¸€å¦‚æ—¢å¾€åœ°æ„Ÿè°¢æ‚¨é˜…è¯»å¹¶ä¸æœ‹å‹å’ŒåŒäº‹åˆ†äº«æˆ‘çš„æ–‡ç« ã€‚</span></span></span></span></p>\n<p><span><span><span><span><img alt=\"me\" src=\"https://img2024.cnblogs.com/blog/270073/202509/270073-20250926105511928-738986494.webp\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></span></span></span></span></p>\n<p>&nbsp;</p>\n\n</div>\n<div id=\"MySignature\">\n    <blockquote>\n<p><strong>ä½œè€…ï¼š</strong><a href=\"http://www.cnblogs.com/MeteorSeed\">MeteorSeed</a></p>\n<p><strong>æˆ‘å¸Œæœ›æ‚¨å–œæ¬¢è¿™ç¯‡åšæ–‡ï¼Œå¹¶ä¸€å¦‚æ—¢å¾€åœ°æ„Ÿè°¢æ‚¨é˜…è¯»å¹¶ä¸æœ‹å‹å’ŒåŒäº‹åˆ†äº«æˆ‘çš„åšæ–‡ã€‚</strong></p>\n<p><strong>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</strong></p>\n</blockquote>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-09 10:09</span>&nbsp;\n<a href=\"https://www.cnblogs.com/MeteorSeed\">MeteorSeed</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">38</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "Antigravity-Managerï¼šAI å¤šè´¦å·ç®¡å®¶ + API åä»£",
      "link": "https://www.cnblogs.com/bugshare/p/19593797",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/bugshare/p/19593797\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-09 10:08\">\n    <span>Antigravity-Managerï¼šAI å¤šè´¦å·ç®¡å®¶ + API åä»£</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>åœ¨ AI åº”ç”¨æ—¥ç›Šå¢é•¿çš„ä»Šå¤©ï¼Œå¼€å‘è€…å¾€å¾€éœ€è¦åŒæ—¶ç®¡ç†å¤šä¸ªæœåŠ¡è´¦å·ï¼ˆå¦‚ OpenAIã€Claudeã€Gemini ç­‰ï¼‰ï¼Œå¹¶æœŸæœ›å°†è¿™äº›æœåŠ¡ç»Ÿä¸€è°ƒåº¦ã€å¹¶åœ¨æœ¬åœ°æˆ–æœåŠ¡å™¨ä¸Šç¨³å®šè¿è¡Œã€‚<br />\n<strong>Antigravity-Manager</strong> æ­£æ˜¯è¿™æ ·ä¸€æ¬¾å¼ºå¤§çš„å¼€æºå·¥å…·ï¼Œå®ƒä¸ä»…å…·å¤‡ä¸“ä¸šçš„è´¦å·ç®¡ç†åŠŸèƒ½ï¼Œè¿˜æ”¯æŒåè®®è½¬æ¢ã€ä¸­ç»§ä»£ç†ç­‰é«˜çº§åŠŸèƒ½ï¼Œå¯ä»¥ä¸ Claude Code CLI ç­‰å®¢æˆ·ç«¯æ— ç¼é›†æˆï¼Œè®©ä½ çš„ AI è°ƒç”¨æ›´ç¨³å®šã€æ›´æ™ºèƒ½ã€‚</p>\n<hr />\n<h1 id=\"ä¸€antigravity-manager-æ˜¯ä»€ä¹ˆ\">ä¸€ã€Antigravity-Manager æ˜¯ä»€ä¹ˆï¼Ÿ</h1>\n<p><strong>Antigravity-Manager</strong> æ˜¯ç”±ç¤¾åŒºå¼€å‘çš„ä¸€æ¬¾è·¨å¹³å°ï¼ˆWindows / macOS / Linuxï¼‰æ¡Œé¢åº”ç”¨ï¼Œç”¨äºï¼š</p>\n<ul>\n<li>ğŸ§  <strong>è´¦å·ç®¡ç†ä¸ä¸€é”®åˆ‡æ¢</strong> å¤šä¸ª AI æœåŠ¡è´¦å·ï¼›</li>\n<li>ğŸš€ <strong>åè®®è½¬æ¢ä¸åä»£ä»£ç†</strong>ï¼Œå…¼å®¹ OpenAIã€Anthropicï¼ˆClaude CLIï¼‰å’Œ Gemini ç­‰ï¼›</li>\n<li>âš™ï¸ <strong>æ™ºèƒ½è°ƒåº¦ä¸æ¨¡å‹è·¯ç”±</strong>ï¼Œå®ç°é…é¢ç®¡ç†å’Œè¯·æ±‚ä¼˜å…ˆçº§è°ƒåº¦ã€‚</li>\n</ul>\n<p>ç®€è€Œè¨€ä¹‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªâ€œå…¨èƒ½ AI è´¦å·ç®¡å®¶ + æœ¬åœ°åä»£æœåŠ¡ç«¯â€ï¼Œå¸®åŠ©ä½ æ„å»ºä¸ªäººæˆ–å›¢é˜Ÿçº§çš„ AI è°ƒç”¨ç½‘å…³ã€‚</p>\n<hr />\n<h1 id=\"äºŒä¸ºä½•ä½¿ç”¨è´¦å·ç®¡ç†\">äºŒã€ä¸ºä½•ä½¿ç”¨â€œè´¦å·ç®¡ç†â€ï¼Ÿ</h1>\n<p>åœ¨å¤šä¸ª AI å¹³å°åŒæ—¶ä½¿ç”¨æ—¶ï¼Œä½ å¯èƒ½é¢ä¸´è¿™äº›ç—›ç‚¹ï¼š</p>\n<ul>\n<li>ğŸ“‰ å•ä¸€è´¦å·é…é¢è€—å°½å¯¼è‡´è¯·æ±‚å¤±è´¥ï¼›</li>\n<li>ğŸ” åˆ‡æ¢è´¦å·ç¹çã€ç¼ºå°‘ä¸€ä½“åŒ–ç®¡ç†ï¼›</li>\n<li>ğŸ”’ éš¾ä»¥å®æ—¶æŸ¥çœ‹æ¯ä¸ªè´¦å·çš„é…é¢ä¸çŠ¶æ€ï¼›</li>\n<li>ğŸ§  ç»“åˆ CLI å·¥å…·æ—¶ï¼Œæ²¡æœ‰ç»Ÿä¸€åä»£å…¥å£ã€‚</li>\n</ul>\n<p><strong>Antigravity-Manager çš„è´¦å·ç®¡ç†ï¼ˆAccount Managementï¼‰æ¨¡å—</strong>æ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜è®¾è®¡çš„ï¼Œå®ƒæä¾›äº† <strong>OAuth æˆæƒã€Token å¯¼å…¥ã€403 è‡ªåŠ¨æ ‡æ³¨ã€è´¦å·çŠ¶æ€å¥åº·ç›‘æ§ç­‰å…¨å¥—åŠŸèƒ½</strong>ã€‚</p>\n<hr />\n<h1 id=\"ä¸‰å®‰è£…-antigravity-manager\">ä¸‰ã€å®‰è£… Antigravity-Manager</h1>\n<p>å®‰è£…æ–¹å¼éå¸¸çµæ´»ï¼Œè¦†ç›–æ¡Œé¢ä»¥åŠæœåŠ¡å™¨ç¯å¢ƒã€‚</p>\n<h2 id=\"ï¸-æ–¹å¼-1æ¡Œé¢å®‰è£…æ¨è\">âœ”ï¸ æ–¹å¼ 1ï¼šæ¡Œé¢å®‰è£…ï¼ˆæ¨èï¼‰</h2>\n<p>macOS / Linuxï¼ˆæ¨èï¼‰</p>\n<p>å¦‚æœä½ å·²å®‰è£… <strong>Homebrew</strong>ï¼š</p>\n<pre><code class=\"language-bash\">brew tap lbjlaq/antigravity-manager https://github.com/lbjlaq/Antigravity-Manager\nbrew install --cask antigravity-tools\n</code></pre>\n<p>å®‰è£…å®Œæˆåç›´æ¥è¿è¡Œå®¢æˆ·ç«¯è¿›å…¥å¯è§†åŒ–ç®¡ç†ç•Œé¢ã€‚</p>\n<hr />\n<h2 id=\"-æ–¹å¼-2æ‰‹åŠ¨ä¸‹è½½å®‰è£…\">ğŸªŸ æ–¹å¼ 2ï¼šæ‰‹åŠ¨ä¸‹è½½å®‰è£…</h2>\n<p>è®¿é—® GitHub Releases é¡µé¢ï¼Œä¸‹è½½å¯¹åº”ç³»ç»Ÿçš„å®‰è£…åŒ…ï¼š</p>\n<p>ğŸ“¦ macOSï¼š<code>.dmg</code><br />\nğŸ’» Windowsï¼š<code>.msi</code> / <code>.zip</code><br />\nğŸ§ Linuxï¼š<code>.deb</code> / <code>AppImage</code><br />\nï¼ˆæ”¯æŒ Apple Siliconã€Intel ç­‰ä¸»æµæ¶æ„ï¼‰</p>\n<hr />\n<h2 id=\"-æ–¹å¼-3docker-éƒ¨ç½²æœåŠ¡å™¨--nas\">ğŸ³ æ–¹å¼ 3ï¼šDocker éƒ¨ç½²ï¼ˆæœåŠ¡å™¨ &amp; NASï¼‰</h2>\n<p>å¦‚æœå¸Œæœ›åœ¨NAS/æœåŠ¡å™¨é•¿æœŸè¿è¡Œï¼Œå¯å‚è€ƒï¼š</p>\n<pre><code class=\"language-bash\">docker run -d \\\n\t--name antigravity-manager \\\n  -p 8045:8045 \\\n  -e API_KEY=sk-your-api-key \\\n  -e WEB_PASSWORD=your-login-password \\\n  -v ~/.antigravity_tools:/root/.antigravity_tools \\\n  lbjlaq/antigravity-manager:latest\n\n#### ğŸ” é‰´æƒé€»è¾‘è¯´æ˜\n*   **åœºæ™¯ Aï¼šä»…è®¾ç½®äº† `API_KEY`**\n    - **Web ç™»å½•**ï¼šä½¿ç”¨ `API_KEY` è¿›å…¥åå°ã€‚\n    - **API è°ƒç”¨**ï¼šä½¿ç”¨ `API_KEY` è¿›è¡Œ AI è¯·æ±‚é‰´æƒã€‚\n*   **åœºæ™¯ Bï¼šåŒæ—¶è®¾ç½®äº† `API_KEY` å’Œ `WEB_PASSWORD` (æ¨è)**\n    - **Web ç™»å½•**ï¼š**å¿…é¡»**ä½¿ç”¨ `WEB_PASSWORD`ï¼Œä½¿ç”¨ API Key å°†è¢«æ‹’ç»ï¼ˆæ›´å®‰å…¨ï¼‰ã€‚\n    - **API è°ƒç”¨**ï¼šç»Ÿä¸€ä½¿ç”¨ `API_KEY`ã€‚è¿™æ ·æ‚¨å¯ä»¥å°† API Key åˆ†å‘ç»™æˆå‘˜ï¼Œè€Œä¿ç•™å¯†ç ä»…ä¾›ç®¡ç†å‘˜ä½¿ç”¨ã€‚\n</code></pre>\n<p>è¿™æ · Antigravity-Manager ä¼šåœ¨å®¹å™¨å†…è‡ªåŠ¨å¯åŠ¨å‰ç«¯æœåŠ¡å’Œåä»£ä»£ç†ã€‚</p>\n<p><img alt=\"PixPin_2026-02-07_19-53-26.png\" class=\"lazyload\" /></p>\n<hr />\n<h1 id=\"å››ç®¡ç†è´¦å·ä¸æ¥å…¥-claude-code-cli\">å››ã€ç®¡ç†è´¦å·ä¸æ¥å…¥ Claude Code CLI</h1>\n<h2 id=\"-1-æ·»åŠ è´¦å·oauth--token\">ğŸ”‘ 1. æ·»åŠ è´¦å·ï¼ˆOAuth / Tokenï¼‰</h2>\n<p>æ‰“å¼€å®¢æˆ·ç«¯ â†’ â€œAccounts / è´¦å·â€ â†’ â€œæ·»åŠ è´¦å·â€ï¼Œä½ å¯ä»¥ï¼š</p>\n<ul>\n<li>ä½¿ç”¨ <strong>OAuth 2.0 æˆæƒ</strong> æ·»åŠ è´¦å·ï¼Œå·¥å…·ä¼šæå‰ç”Ÿæˆæˆæƒé“¾æ¥ï¼Œåœ¨æµè§ˆå™¨å®Œæˆç™»å½•æˆæƒåè‡ªåŠ¨ä¿å­˜ï¼›</li>\n<li>æˆ–è€…é€šè¿‡ <strong>Token / JSON æ‰¹é‡å¯¼å…¥</strong> å·²æœ‰çš„ API Key/Sessionï¼Œé€‚åˆå·²æœ‰è´¦å·å¤‡ä»½è¿ç§»ã€‚</li>\n</ul>\n<p><img alt=\"1770467416323.png\" class=\"lazyload\" /></p>\n<hr />\n<h2 id=\"-2-è´¦å·ä»ªè¡¨ç›˜ä¸å¥åº·ç›‘æ§\">ğŸ“Š 2. è´¦å·ä»ªè¡¨ç›˜ä¸å¥åº·ç›‘æ§</h2>\n<p>åœ¨ä»ªè¡¨ç›˜ä¸­ï¼Œä½ å¯ä»¥ï¼š</p>\n<ul>\n<li>å®æ—¶æŸ¥çœ‹è´¦å·ç±»å‹ã€å‰©ä½™é…é¢ã€æ˜¯å¦è¢«ç¦ç”¨ï¼›</li>\n<li>ç³»ç»Ÿè‡ªåŠ¨æ ‡æ³¨å¼‚å¸¸è´¦å·ï¼ˆä¾‹å¦‚ 403 ç¦ç”¨ï¼‰ï¼Œå¹¶è·³è¿‡è¿™äº›è´¦å·ï¼›</li>\n<li>ä¸€é”®åˆ‡æ¢æ´»è·ƒè´¦å·ï¼Œå¿«é€Ÿè°ƒåº¦è°ƒç”¨é“¾è·¯ã€‚</li>\n</ul>\n<p>è¿™å¯¹ç®¡ç†å¤šä¸ªä»˜è´¹ / å…è´¹è´¦å·æä¸ºå®ç”¨ã€‚</p>\n<p><img alt=\"PixPin_2026-02-07_20-28-11.png\" class=\"lazyload\" /></p>\n<hr />\n<h2 id=\"-3-æ¥å…¥-claude-code-cli-åä»£\">ğŸ›  3. æ¥å…¥ Claude Code CLI åä»£</h2>\n<p>Antigravity-Manager å†…ç½®äº† <strong>Anthropic åè®®çš„åä»£æ”¯æŒ</strong>ï¼Œå¯ä»¥è®© Claude Code CLI ç›´æ¥èµ°æœ¬åœ°ä»£ç†ã€‚</p>\n<p><img alt=\"PixPin_2026-02-07_20-33-42.png\" class=\"lazyload\" /></p>\n<h3 id=\"-æ–¹å¼1ç¯å¢ƒå˜é‡æ–¹å¼\">ğŸ“Œ æ–¹å¼1ï¼šç¯å¢ƒå˜é‡æ–¹å¼</h3>\n<ol>\n<li>åœ¨ Antigravity-Manager å†…å¯ç”¨ <strong>API åä»£æœåŠ¡</strong>ï¼›</li>\n<li>åœ¨ç»ˆç«¯è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</li>\n</ol>\n<pre><code class=\"language-bash\">export ANTHROPIC_API_KEY=\"sk-antigravity\"\nexport ANTHROPIC_BASE_URL=\"http://127.0.0.1:8045\"\n</code></pre>\n<ol start=\"3\">\n<li>å¯åŠ¨ <strong>Claude Code CLI</strong>ï¼š</li>\n</ol>\n<pre><code class=\"language-bash\">claude\n</code></pre>\n<h3 id=\"-æ–¹å¼2ç›´æ¥ç‚¹åŒæ­¥æŒ‰é’®æ›´çˆ½\">ğŸ“Œ æ–¹å¼2ï¼šç›´æ¥ç‚¹åŒæ­¥æŒ‰é’®ï¼ˆæ›´çˆ½ï¼‰</h3>\n<p>æ›´è´´å¿ƒçš„æ˜¯ä½œè€…è¿˜æä¾›äº†é€šè¿‡ç•Œé¢â€œç«‹å³åŒæ­¥é…ç½®â€ã€‚</p>\n<p><img alt=\"1770467877401.png\" class=\"lazyload\" /></p>\n<p>æ­¤æ—¶æ‰€æœ‰ CLI è¯·æ±‚å°†é€šè¿‡ Antigravity-Manager çš„åä»£æœåŠ¡å‘å‡ºï¼Œä½ å¯ä»¥ç»“åˆè´¦å·æ± è°ƒåº¦ï¼Œæé«˜ç¨³å®šæ€§å¹¶ç»Ÿä¸€ç®¡ç†æ—¥å¿—ä¸é…é¢ç»Ÿè®¡ã€‚</p>\n<p>ğŸ’¡ è¿™ç§æ–¹å¼å°¤å…¶é€‚ç”¨äºå¼€å‘è€…å¸Œæœ›åœ¨æœ¬åœ°ç»ˆç«¯ç¯å¢ƒä½¿ç”¨ Claude CLI å·¥å…·æ—¶ï¼Œæœ‰ä¸€ä¸ªç»Ÿä¸€çš„ä»£ç†å±‚è¿›è¡Œè´¦å·è½®æ¢å’Œå¤±è´¥é‡è¯•ã€‚</p>\n<p>â–¶ï¸ <strong>é™¤äº†Claude Code CLIï¼Œè¿˜æ”¯æŒæ¥å…¥OpenCodeã€Kilo Codeã€Python</strong>ï¼ˆå¯ä»¥æ„‰å¿«çš„å¼€å‘äº†ï¼‰</p>\n<h2 id=\"-4-ä¹Ÿå¯ä»¥å¯ç”¨å›½å†…æ™ºè°±æ¨¡å‹\">âš¡ 4. ä¹Ÿå¯ä»¥å¯ç”¨å›½å†…æ™ºè°±æ¨¡å‹</h2>\n<p>å¦‚æœä½ éœ€è¦æ··ç”¨å›½å†…æ¨¡å‹ï¼Œåªè¦å¡« Key å³å¯ã€‚</p>\n<p><img alt=\"PixPin_2026-02-07_20-49-10.png\" class=\"lazyload\" /></p>\n<hr />\n<h1 id=\"äº”ä½¿ç”¨å»ºè®®ä¸å®æˆ˜æŠ€å·§\">äº”ã€ä½¿ç”¨å»ºè®®ä¸å®æˆ˜æŠ€å·§</h1>\n<p>âœ¨ <strong>ä¼˜åŒ–è´¦å·æ± </strong>ï¼šå°†é«˜é…é¢è´¦å·ç½®äºä¼˜å…ˆé˜Ÿåˆ—ï¼Œå¹¶æ ¹æ®ä½¿ç”¨åœºæ™¯åŠ¨æ€åˆ‡æ¢ï¼Œæå‡æˆåŠŸç‡ã€‚</p>\n<p>âœ¨ <strong>æ‰¹é‡å¯¼å…¥</strong>ï¼šå¯¹äºå¤§é‡è´¦å·å¯ä»¥æå‰é€šè¿‡ JSON å¯¼å…¥ï¼Œé¿å…é‡å¤æ‰‹åŠ¨è¾“å…¥ã€‚</p>\n<p>âœ¨ <strong>ç»“åˆ CLI ç›‘æ§æ—¥å¿—</strong>ï¼šåœ¨åä»£è¿è¡Œä¸­ï¼ŒåŠ¡å¿…ç›‘æ§ HTTP è¿”å›ç ï¼ˆå¦‚ 429/401ï¼‰ä»¥è°ƒæ•´è¯·æ±‚ç­–ç•¥ã€‚</p>\n<p>âš ï¸ <strong>æ³¨æ„å®‰å…¨</strong>ï¼šOAuth å›è°ƒæ˜¯é€šè¿‡æœ¬åœ°ç›‘å¬å®ç°çš„ï¼Œç¡®ä¿é˜²ç«å¢™å…è®¸æœ¬åœ°å›ç¯è®¿é—®ï¼Œé¿å…æˆæƒå¤±è´¥ã€‚</p>\n<hr />\n<h1 id=\"å…­æ€»ç»“\">å…­ã€æ€»ç»“</h1>\n<p>ğŸš€ <strong>Antigravity-Manager</strong> ä¸ä»…æ˜¯ä¸€æ¬¾å¼ºå¤§çš„ <strong>AI è´¦å·ç®¡ç†å·¥å…·</strong>ï¼Œè¿˜å…·å¤‡åè®®åä»£ã€æ¨¡å‹è·¯ç”±ã€å¥åº·ç›‘æ§ç­‰ä¸°å¯ŒåŠŸèƒ½ã€‚é€šè¿‡å®ƒï¼Œä½ å¯ä»¥ï¼š</p>\n<p>âœ”ï¸ ä¸€ç«™å¼ç®¡ç†å¤šä¸ª AI å¹³å°è´¦å·ï¼›<br />\nâœ”ï¸ å®ç°è´¦å·é…é¢ä¼˜å…ˆçº§è°ƒåº¦å’Œè‡ªåŠ¨å¼‚å¸¸è·³è¿‡ï¼›<br />\nâœ”ï¸ åœ¨æœ¬åœ°é€šè¿‡åä»£æ¥å…¥ <strong>Claude Code CLI</strong> ç­‰å®¢æˆ·ç«¯ï¼›<br />\nâœ”ï¸ æå‡ç¨³å®šæ€§ã€å¯è§†åŒ–ç®¡ç†ä½“éªŒã€é¿å…æ‰‹åŠ¨åˆ‡æ¢è¯¯æ“ä½œã€‚</p>\n<p>æ— è®ºä½ æ˜¯ AI å¼€å‘è€…ã€ç ”ç©¶è€…ï¼Œè¿˜æ˜¯éœ€è¦åœ¨ç»ˆç«¯é«˜æ•ˆä½¿ç”¨ Claude å·¥å…·çš„ç”¨æˆ·ï¼Œéƒ½å¯ä»¥ä» Antigravity-Manager ä¸­å—ç›Šã€‚</p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-09 10:08</span>&nbsp;\n<a href=\"https://www.cnblogs.com/bugshare\">BugShare</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "spring6-ä»£ç†æ¨¡å¼å’ŒAOP",
      "link": "https://www.cnblogs.com/alineverstop/p/19593787",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/alineverstop/p/19593787\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-09 10:07\">\n    <span>spring6-ä»£ç†æ¨¡å¼å’ŒAOP</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"jdbctemplate\">jdbcTemplate</h1>\n<p>jdbcTemplateæ˜¯springæä¾›çš„ä¸€ä¸ªjdbcæ¨¡æ¿ç±»ï¼Œæ˜¯å¯¹jdbcçš„å°è£…ã€‚</p>\n<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ¡†æ¶èå…¥MyBatisã€Hibernateã€‚</p>\n<h1 id=\"gofä¹‹ä»£ç†æ¨¡å¼\">GoFä¹‹ä»£ç†æ¨¡å¼</h1>\n<h2 id=\"ä»£ç†æ¨¡å¼çš„ä½œç”¨\">ä»£ç†æ¨¡å¼çš„ä½œç”¨</h2>\n<ol>\n<li>å½“ä¸€ä¸ªå¯¹è±¡éœ€è¦å—åˆ°ä¿æŠ¤çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ä»£ç†å¯¹è±¡å»å®ŒæˆæŸä¸ªè¡Œä¸ºã€‚</li>\n<li>éœ€è¦ç»™æŸä¸ªå¯¹è±¡è¿›è¡ŒåŠŸèƒ½å¢å¼ºçš„æ—¶å€™ï¼Œå¯ä»¥æ‰¾ä¸€ä¸ªä»£ç†è¿›è¡Œå¢å¼ºã€‚</li>\n<li>Aå¯¹è±¡å’ŒBå¯¹è±¡æ— æ³•ç›´æ¥äº¤äº’æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä»£ç†æ¨¡å¼æ¥å®Œæˆã€‚</li>\n</ol>\n<p>ä»£ç†æ¨¡å¼ä¸­çš„ä¸‰ä¸ªè§’è‰²ï¼š</p>\n<ol>\n<li>ç›®æ ‡å¯¹è±¡</li>\n<li>ä»£ç†å¯¹è±¡</li>\n<li>ç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡çš„å…¬å…±æ¥å£</li>\n</ol>\n<p>å¦‚æœä½¿ç”¨ä»£ç†æ¨¡å¼çš„è¯ï¼Œå®¢æˆ·ç«¯ç¨‹åºæ˜¯æ— æ³•å¯Ÿè§‰çš„ï¼Œå®¢æˆ·ç«¯åœ¨ä½¿ç”¨ä»£ç†å¯¹è±¡çš„æ—¶å€™å°±åƒåœ¨ä½¿ç”¨ç›®æ ‡å¯¹è±¡ã€‚</p>\n<p>ä»£ç†æ¨¡å¼åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚</p>\n<h2 id=\"é™æ€ä»£ç†\">é™æ€ä»£ç†</h2>\n<p>ç›®æ ‡å¯¹è±¡ç±»ï¼š</p>\n<pre><code class=\"language-java\">// ç›®æ ‡å¯¹è±¡\npublic class OrderServiceImpl implements OrderService{\n    @Override\n    public void generateOrder() {\n        System.out.println(\"ç”Ÿæˆè®¢å•\");\n    }\n\n    @Override\n    public void modifyOrder() {\n        System.out.println(\"ä¿®æ”¹è®¢å•\");\n    }\n\n    @Override\n    public void detailOrder() {\n        System.out.println(\"æŸ¥çœ‹è®¢å•è¯¦æƒ…\");\n\n    }\n}\n</code></pre>\n<p>ä»£ç†å¯¹è±¡ç±»ï¼š</p>\n<pre><code class=\"language-java\">// ä»£ç†å¯¹è±¡\npublic class OrderServiceProxy implements OrderService{\n    // ä»£ç†å¯¹è±¡ä¸­å«æœ‰ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨\n    // è¿™é‡Œä½¿ç”¨OrderServiceç±»å‹ï¼Œå› ä¸ºä»–è€¦åˆåº¦ä½\n    private OrderService orderService;\n\n    // æ„é€ æ–¹æ³•ä¼ å…¥ç›®æ ‡å¯¹è±¡\n    public OrderServiceProxy(OrderService orderService) {\n        this.orderService = orderService;\n    }\n\n    @Override\n    public void generateOrder() {\n        // åŠŸèƒ½å¢å¼ºï¼šç»Ÿè®¡æ–¹æ³•æ‰§è¡Œæ—¶é—´\n        long begin = System.currentTimeMillis();\n        orderService.generateOrder();\n        long end = System.currentTimeMillis();\n        System.out.println(\"ç”Ÿæˆè®¢å•è€—æ—¶ï¼š\" + (end - begin) + \"ms\");\n    }\n\n    @Override\n    public void modifyOrder() {\n        long begin = System.currentTimeMillis();\n        orderService.modifyOrder();\n        long end = System.currentTimeMillis();\n        System.out.println(\"ä¿®æ”¹è®¢å•è€—æ—¶ï¼š\" + (end - begin) + \"ms\");\n    }\n\n    @Override\n    public void detailOrder() {\n        long begin = System.currentTimeMillis();\n        orderService.detailOrder();\n        long end = System.currentTimeMillis();\n        System.out.println(\"æŸ¥çœ‹è®¢å•è¯¦æƒ…è€—æ—¶ï¼š\" + (end - begin) + \"ms\");\n    }\n}\n</code></pre>\n<p>å…¬å…±æ¥å£ï¼š</p>\n<pre><code class=\"language-java\">// è®¢å•æœåŠ¡æ¥å£\n// ç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡çš„å…¬å…±æ¥å£\npublic interface OrderService {\n\n    // ç”Ÿæˆè®¢å•\n    void generateOrder();\n\n    // ä¿®æ”¹è®¢å•\n    void modifyOrder();\n\n    // æŸ¥çœ‹è®¢å•è¯¦æƒ…\n    void detailOrder();\n}\n</code></pre>\n<p>æµ‹è¯•ï¼š</p>\n<pre><code class=\"language-java\">// å®ç°ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œæ—¶é—´çš„ç»Ÿè®¡\npublic static void main(String[] args) {\n    // åˆ›å»ºç›®æ ‡å¯¹è±¡\n    OrderService orderService = new OrderServiceImpl();\n    // åˆ›å»ºä»£ç†å¯¹è±¡ï¼ŒåŒæ—¶å°†ç›®æ ‡å¯¹è±¡ä¼ å…¥ä»£ç†å¯¹è±¡ä¸­\n    OrderServiceProxy orderServiceProxy = new OrderServiceProxy(orderService);\n    // é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•\n    orderServiceProxy.generateOrder();\n    orderServiceProxy.modifyOrder();\n    orderServiceProxy.detailOrder();\n}\n</code></pre>\n<p>é™æ€ä»£ç†ä¼˜ç‚¹ï¼š1.è§£å†³äº†ocpé—®é¢˜  2.é‡‡ç”¨ä»£ç†æ¨¡å¼çš„has aã€‚é™ä½äº†è€¦åˆåº¦ã€‚</p>\n<p>é™æ€ä»£ç†çš„ç¼ºç‚¹ï¼šå‡è®¾ç³»ç»Ÿä¸­æœ‰ä¸Šåƒä¸ªæ¥å£ï¼Œæ¯ä¸ªæ¥å£éƒ½éœ€è¦å†™ä»£ç†ç±»ï¼Œè¿™æ ·ç±»çš„æ•°é‡ä¼šæ€¥å‰§è†¨èƒ€ï¼Œä¸å¥½ç»´æŠ¤ã€‚</p>\n<p>é‚£æ€ä¹ˆè§£å†³ç±»çˆ†ç‚¸çš„é—®é¢˜å‘¢ï¼Ÿ</p>\n<p>é‡‡ç”¨åŠ¨æ€ä»£ç†ã€‚  åŠ¨æ€ä»£ç†è¿˜æ˜¯ä»£ç†æ¨¡å¼ï¼Œåªä¸è¿‡æ˜¯åœ¨å†…å­˜ä¸­ä¸ºæˆ‘ä»¬åŠ¨æ€çš„ç”Ÿæˆä¸€ä¸ªclasså­—èŠ‚ç ï¼Œè¿™ä¸ªå­—èŠ‚ç å°±æ˜¯ä»£ç†ç±»ã€‚</p>\n<h2 id=\"åŠ¨æ€ä»£ç†\">åŠ¨æ€ä»£ç†</h2>\n<p>åœ¨ç¨‹åºè¿è¡Œé˜¶æ®µï¼Œåœ¨å†…å­˜ä¸­åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼Œæˆä¸ºåŠ¨æ€ä»£ç†ã€‚ç›®çš„æ˜¯å‡å°‘ä»£ç†ç±»çš„æ•°é‡ã€‚</p>\n<p>å¸¸è§çš„åŠ¨æ€ä»£ç†æŠ€æœ¯æœ‰ï¼šJDKåŠ¨æ€ä»£ç†ï¼ˆåªèƒ½ä»£ç†æ¥å£ï¼‰ã€CGLIBåŠ¨æ€ä»£ç†ã€JavassiståŠ¨æ€ä»£ç†ã€‚</p>\n<h3 id=\"jdkåŠ¨æ€ä»£ç†\">JDKåŠ¨æ€ä»£ç†</h3>\n<p>å…¬å…±æ¥å£ å’Œç›®æ ‡å¯¹è±¡ç±»å¼•ç”¨ ä¸Šé¢çš„ä»£ç ã€‚JdkåŠ¨æ€ä»£ç†ä¸éœ€è¦å†™ä»£ç†ç±»ï¼Œjdkä¼šåœ¨å†…å­˜ä¸­è‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»ï¼Œå› æ­¤ç›´æ¥åœ¨å®¢æˆ·ç«¯ä»£ç é‡Œç›´æ¥è°ƒç”¨ï¼š</p>\n<p>å®¢æˆ·ç«¯ä»£ç ï¼š</p>\n<pre><code class=\"language-java\">public class Client {\n    public void main() {\n        // 1. åˆ›å»ºç›®æ ‡å¯¹è±¡\n        OrderService orderService = new OrderServiceImpl();\n        // 2. åˆ›å»ºInvocationHandlerå¯¹è±¡\n\n        // 3. åˆ›å»ºä»£ç†å¯¹è±¡\n        //    1. Proxy.newProxyInstance çš„ä½œç”¨æ˜¯åˆ›å»ºä»£ç†å¯¹è±¡ã€‚å…¶å®åšäº†ä¸¤ä»¶äº‹:\n        //     1). åœ¨å†…å­˜ä¸­åŠ¨æ€çš„æ„å»ºä¸€ä¸ªç±»,\n        //     2). è¿™ä¸ªç±»è¦å®ç°æ¥å£, è¿™ä¸ªæ¥å£å°±æ˜¯ç›®æ ‡å¯¹è±¡çš„æ¥å£,å¹¶ä¸”newäº†ä¸€ä¸ªå¯¹è±¡\n        //  2. è¿™ä¸ªæ–¹æ³•çš„ä¸‰ä¸ªå‚æ•°:\n        //    1). ClassLoader: ç±»åŠ è½½å™¨, ç”¨äºåŠ è½½å†…å­˜ä¸­çš„ä»£ç†å¯¹è±¡ç±». å’Œç›®æ ‡å¯¹è±¡ä½¿ç”¨ç›¸åŒçš„ç±»åŠ è½½å™¨\n        //   2). Class[]: å­—èŠ‚ç æ•°ç»„, ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å®ç°ç›¸åŒçš„æ¥å£. ç”¨äºè®©ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å…·æœ‰ç›¸åŒçš„æ–¹æ³•\n        //  3). InvocationHandler: è°ƒç”¨å¤„ç†å™¨å¯¹è±¡,ä»–æ˜¯ä¸€ä¸ªæ¥å£ï¼Œ è¿™ä¸ªè°ƒç”¨å¤„ç†å™¨ç”¨äºç¼–å†™å¢å¼ºä»£ç \n        OrderService o = (OrderService)Proxy.newProxyInstance(OrderService.class.getClassLoader(), \t\t\t                                                 orderService.getClass().getInterfaces(), \n                            new TimerInvocationHandler(orderService));\n        // 4. é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•\n        // è°ƒç”¨ä»£ç†å¯¹è±¡çš„ä»£ç†æ–¹æ³•æ—¶ï¼Œå¦‚æœä»£ç†æ–¹æ³•çš„ä½œç”¨æ˜¯åŠŸèƒ½å¢å¼ºï¼Œé‚£ç›®æ ‡å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•å¿…é¡»æ‰§è¡Œã€‚\n        o.generateOrder();\n    }\n}\n</code></pre>\n<p>è°ƒç”¨å¤„ç†å™¨ç±»ï¼š</p>\n<pre><code class=\"language-java\">/**\n * è´Ÿè´£è®¡æ—¶çš„ä¸€ä¸ªè°ƒç”¨å¤„ç†å™¨ç±»\n * åœ¨è¿™ä¸ªè°ƒç”¨å¤„ç†å™¨ä¸­ç¼–å†™å¢å¼ºä»£ç \n * è¿™ä¸ªè°ƒç”¨å¤„ç†å™¨åªéœ€è¦ä¸€ä¸ªå°±å¥½\n */\npublic class TimerInvocationHandler implements InvocationHandler {\n\n    // ç›®æ ‡å¯¹è±¡,å°±æ˜¯è¦è¢«å¢å¼ºçš„å¯¹è±¡\n    private Object target;\n\t// æ„é€ æ–¹æ³•ä¼ å…¥ç›®æ ‡å¯¹è±¡\n    public TimerInvocationHandler(Object target) {\n            this.target = target;\n    }\n\n    // è¿™ä¸ªæ–¹æ³•å¿…é¡»æ˜¯invoke()æ–¹æ³•,å› ä¸ºjdkåœ¨åº•å±‚ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•\n    // è¿™ä¸ªæ–¹æ³•ä»€ä¹ˆæ—¶å€™è°ƒç”¨?\n    //    ä»€ä¹ˆæ—¶å€™é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•çš„æ—¶å€™å°±ä¼šè°ƒç”¨è¿™ä¸ªinvoke()æ–¹æ³•\n    // è¿™ä¸ªæ–¹æ³•çš„å‚æ•°:\n    //    proxy: ä»£ç†å¯¹è±¡,å°±æ˜¯é€šè¿‡Proxy.newProxyInstance()æ–¹æ³•åˆ›å»ºçš„ä»£ç†å¯¹è±¡\n    //    method: ç›®æ ‡å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•,è¿™å°±æ˜¯è¦æ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•\n    //    args: ç›®æ ‡æ–¹æ³•ä¸Šçš„å‚æ•°\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        // åŠŸèƒ½å¢å¼ºï¼š\n        Long begin = System.currentTimeMillis();\n        Object invoke = method.invoke(target, args);\n        Long end = System.currentTimeMillis();\n        System.out.println(\"æ–¹æ³•æ‰§è¡Œè€—æ—¶ï¼š\" + (end - begin) + \"ms\");\n        return invoke;\n    }\n}\n</code></pre>\n<h3 id=\"cglibåŠ¨æ€ä»£ç†\">CGLIBåŠ¨æ€ä»£ç†</h3>\n<p>æ—¢å¯ä»¥ä»£ç†æ¥å£ï¼Œä¹Ÿå¯ä»¥ä»£ç†ç±»ã€‚åº•å±‚é‡‡ç”¨ç»§æ‰¿çš„æ–¹å¼å®ç°ï¼Œå› æ­¤<strong>è¢«ä»£ç†çš„ç›®æ ‡ç±»ä¸èƒ½è¢«finalä¿®é¥°</strong>ã€‚</p>\n<p>ç›®æ ‡ç±»ï¼š</p>\n<pre><code class=\"language-java\">// ç›®æ ‡ç±»\npublic class UserService {\n    public boolean login(String username, String password) {\n        System.out.println(\"ç”¨æˆ·ç™»å½•ï¼Œç”¨æˆ·åï¼š\" + username + \"ï¼Œå¯†ç ï¼š\" + password);\n        return \"admin\".equals(username) &amp;&amp; \"123456\".equals(password);\n    }\n\n    public void logout(String username) {\n        System.out.println(\"ç”¨æˆ·é€€å‡ºç™»å½•ï¼Œç”¨æˆ·åï¼š\" + username);\n    }\n}\n</code></pre>\n<p>å®¢æˆ·ç«¯ä»£ç ï¼š</p>\n<pre><code class=\"language-java\">public static void main(String[] args) {\n    // åˆ›å»ºå­—èŠ‚ç å¢å¼ºå¯¹è±¡\n    // è¿™ä¸ªå¯¹è±¡æ˜¯cglibçš„æ ¸å¿ƒå¯¹è±¡ï¼Œä¾é å®ƒæ¥ç”Ÿæˆä»£ç†ç±»\n    Enhancer enhancer = new Enhancer();\n    // è®¾ç½®çˆ¶ç±»ï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡ç±»\n    enhancer.setSuperclass(UserService.class);\n    // è®¾ç½®å›è°ƒå‡½æ•°ï¼ˆç­‰åŒäºjdkåŠ¨æ€ä»£ç†çš„ä¸­çš„è°ƒç”¨å¤„ç†å™¨ï¼‰\n    // åœ¨cglibä¸­æ˜¯å®ç°æ–¹æ³•æ‹¦æˆªå™¨MethodInterceptoræ¥å£\n    enhancer.setCallback(new TimerMethodInterceptor());\n\n    UserService userServiceProxy = (UserService)enhancer.create();\n    boolean login = userServiceProxy.login(\"admin\", \"123456\");\n    System.out.println(login?\"ç™»å½•æˆåŠŸ\":\"ç™»å½•å¤±è´¥\");\n    userServiceProxy.logout(\"admin\");\n}\n</code></pre>\n<p>å¢å¼ºä»£ç å†™åœ¨æ–¹æ³•æ‹¦æˆªå™¨é‡Œé¢</p>\n<pre><code class=\"language-java\">public class TimerMethodInterceptor implements MethodInterceptor {\n\n    @Override\n    public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {\n        Long startTime = System.currentTimeMillis();\n        Object o1 = methodProxy.invokeSuper(o, objects);\n        Long endTime = System.currentTimeMillis();\n        System.out.println(\"æ–¹æ³• \" + method.getName() + \" æ‰§è¡Œè€—æ—¶ï¼š\" + (endTime - startTime) + \"ms\");\n        return o1;\n    }\n}\n</code></pre>\n<p>æ³¨æ„:åœ¨jdk17ç¯å¢ƒä¸‹ï¼ŒcglibåŠ¨æ€ä»£ç†åŠŸèƒ½å¯åŠ¨æ—¶ä¼šæŠ¥é”™ï¼Œéœ€è¦æ·»åŠ å¯åŠ¨æ—¶å‚æ•°è®¾ç½®:</p>\n<p>vm å‚æ•°ï¼š--add-opens java.base/java.lang=ALL-UNNAMED</p>\n<p>program å‚æ•°:--add-opens java.base/sun.net.util=ALL-UNNAMED</p>\n<p><img alt=\"3-1\" class=\"lazyload\" /></p>\n<h1 id=\"é¢å‘åˆ‡é¢ç¼–ç¨‹aop\">é¢å‘åˆ‡é¢ç¼–ç¨‹AOP</h1>\n<p>åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ä¸€èˆ¬ä¼šæœ‰è®¸å¤šç³»ç»ŸæœåŠ¡ï¼Œå¦‚ï¼šæ—¥å¿—ï¼Œäº‹åŠ¡ç®¡ç†ã€å®‰å…¨ç­‰ã€‚è¿™äº›æœåŠ¡æˆä¸ºäº¤å‰ä¸šåŠ¡ã€‚</p>\n<p>è¿™äº›äº¤å‰ä¸šåŠ¡æ˜¯é€šç”¨çš„ã€‚</p>\n<p>å¦‚æœåœ¨æ¯ä¸€ä¸ªä¸šåŠ¡å¤„ç†è¿‡ç¨‹ä¸­ï¼Œéƒ½æºæ‚è¿™äº›äº¤å‰ä¸šåŠ¡ä»£ç ä¼šå‡ºç°2ä¸ªé—®é¢˜ï¼š</p>\n<ol>\n<li>äº¤å‰ä¸šåŠ¡ä»£ç åœ¨å¤šä¸ªä¸šåŠ¡ä¸­åå¤å‡ºç°ã€‚ä»£ç æ²¡æœ‰å¾—åˆ°å¤ç”¨ï¼Œä¿®æ”¹è¿™äº›ä»£ç ä¼šéå¸¸å›°éš¾ã€‚</li>\n<li>å¼€å‘äººå‘˜æ— æ³•ä¸“ä¸šæ ¸å¿ƒä¸šåŠ¡ä»£ç ï¼Œåœ¨ç¼–å†™æ ¸å¿ƒä¸šåŠ¡ä»£ç æ—¶è¿˜è¦å¤„ç†è¿™äº›äº¤å‰ä¸šåŠ¡ä»£ç ã€‚</li>\n</ol>\n<p>è¿™å°±éœ€è¦ä½¿ç”¨AOPæ¥è§£å†³ä»¥ä¸Šé—®é¢˜ã€‚</p>\n<p><img alt=\"3-2\" class=\"lazyload\" /></p>\n<p><strong>æ€»ä¹‹ï¼ŒAOPå°±æ˜¯å°†ä¸æ ¸å¿ƒä¸šåŠ¡æ— å…³çš„ä»£ç ç‹¬ç«‹çš„æŠ½å–å‡ºæ¥ã€‚å½¢æˆä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼Œç„¶åä»¥æ¨ªå‘äº¤å‰çš„æ–¹å¼åº”ç”¨åˆ°ä¸šåŠ¡æµç¨‹å½“ä¸­çš„è¿‡ç¨‹ã€‚</strong></p>\n<p>aopåº•å±‚ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯å®ç°ã€‚</p>\n<p>spring AOP ä½¿ç”¨çš„æ—¶jdkåŠ¨æ€ä»£ç†+cglibåŠ¨æ€ä»£ç†ã€‚spring åœ¨è¿™2ç§åŠ¨æ€ä»£ç†ç§çµæ´»åˆ‡æ¢ã€‚å¦‚æœæ˜¯ä»£ç†æ¥å£ï¼Œåˆ™ä½¿ç”¨jdkåŠ¨æ€ä»£ç†ï¼Œå¦‚æœä»£ç†æŸä¸ªç±»ï¼Œåˆ™ä½¿ç”¨cglibã€‚å½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨é…ç½®æ¥å¼ºåˆ¶ä½¿ç”¨cglibã€‚</p>\n<h2 id=\"aopçš„ä¸ƒå¤§æœ¯è¯­\">AOPçš„ä¸ƒå¤§æœ¯è¯­</h2>\n<h3 id=\"è¿æ¥ç‚¹joinpoint\">è¿æ¥ç‚¹Joinpoint</h3>\n<p>åœ¨ç¨‹åºæ‰§è¡Œæµç¨‹ä¸­ï¼Œå¯ä»¥ç»‡å…¥åˆ‡é¢çš„ä½ç½®ã€‚æ–¹æ³•çš„æ‰§è¡Œå‰åï¼Œå¼‚å¸¸æŠ›å‡ºä¹‹åç­‰ä½ç½®ã€‚</p>\n<p>è¿æ¥ç‚¹æè¿°çš„æ˜¯ä½ç½®ã€‚</p>\n<h3 id=\"åˆ‡ç‚¹pointcut\">åˆ‡ç‚¹Pointcut</h3>\n<p>åœ¨ç¨‹åºæ‰§è¡Œæµç¨‹ä¸­ï¼ŒçœŸæ­£ç»‡å…¥åˆ‡é¢çš„æ–¹æ³•ã€‚ï¼ˆä¸€ä¸ªåˆ‡ç‚¹å¯¹åº”å¤šä¸ªè¿æ¥ç‚¹ï¼‰</p>\n<p>åˆ‡ç‚¹æè¿°çš„æ˜¯æ–¹æ³•ã€‚</p>\n<h3 id=\"é€šçŸ¥advice\">é€šçŸ¥Advice</h3>\n<p>é€šçŸ¥åˆå«å¢å¼ºï¼Œå°±æ˜¯å…·ä½“ä½ è¦ç»‡å…¥çš„çš„<strong>ä»£ç </strong>ã€‚</p>\n<p>é€šçŸ¥åŒ…æ‹¬ï¼šå‰ç½®é€šçŸ¥ã€åç½®é€šçŸ¥ã€ç¯ç»•é€šçŸ¥ã€å¼‚å¸¸é€šçŸ¥ã€æœ€ç»ˆé€šçŸ¥ã€‚</p>\n<p>é€šçŸ¥æè¿°çš„æ˜¯ä»£ç ã€‚</p>\n<h3 id=\"åˆ‡é¢aspect\">åˆ‡é¢Aspect</h3>\n<p>åˆ‡ç‚¹+é€šçŸ¥å°±æ˜¯åˆ‡é¢ã€‚</p>\n<h3 id=\"ç»‡å…¥weaving\">ç»‡å…¥Weaving</h3>\n<p>æŠŠé€šçŸ¥åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡ä¸Šçš„è¿‡ç¨‹ã€‚</p>\n<h3 id=\"ä»£ç†å¯¹è±¡proxy\">ä»£ç†å¯¹è±¡Proxy</h3>\n<p>ä¸€ä¸ªç›®æ ‡å¯¹è±¡è¢«ç»‡å…¥é€šçŸ¥åäº§ç”Ÿçš„æ–°å¯¹è±¡ã€‚</p>\n<h3 id=\"ç›®æ ‡å¯¹è±¡target\">ç›®æ ‡å¯¹è±¡Target</h3>\n<p>è¢«ç»‡å…¥é€šçŸ¥çš„å¯¹è±¡ã€‚</p>\n<pre><code class=\"language-java\">public void main(String[] args) {\n    try {\n        // Joint point  è¿æ¥ç‚¹\n        do1(); // Pointcut åˆ‡ç‚¹\n        // Joint point  è¿æ¥ç‚¹\n        do2();// Pointcut åˆ‡ç‚¹\n        // Joint point  è¿æ¥ç‚¹\n        do3();// Pointcut åˆ‡ç‚¹\n        // Joint point  è¿æ¥ç‚¹\n        do4();// Pointcut åˆ‡ç‚¹\n        // Joint point  è¿æ¥ç‚¹\n        do5();// Pointcut åˆ‡ç‚¹\n        // Joint point  è¿æ¥ç‚¹\n    } catch (Exception e) {\n        // Joint point  è¿æ¥ç‚¹\n    }\n}\n</code></pre>\n<h2 id=\"åˆ‡ç‚¹è¡¨è¾¾å¼\">åˆ‡ç‚¹è¡¨è¾¾å¼</h2>\n<p>åˆ‡ç‚¹è¡¨è¾¾å¼ç”¨æ¥å®šä¹‰é€šçŸ¥ï¼ˆAdviceï¼‰å¾€å“ªäº›æ–¹æ³•ä¸Šåˆ‡å…¥</p>\n<h2 id=\"ä½¿ç”¨springçš„aop\">ä½¿ç”¨Springçš„AOP</h2>\n<p>Springå¯¹AOPçš„å®ç°åŒ…æ‹¬ä¸‰ç§æ–¹å¼ï¼š</p>\n<ol>\n<li>Springç»“åˆAspectJæ¡†æ¶å®ç°çš„AOPï¼ŒåŸºäºæ³¨è§£æ–¹å¼</li>\n<li>Springç»“åˆAspectJæ¡†æ¶å®ç°çš„AOPï¼ŒåŸºäºXMLæ–¹å¼</li>\n<li>springè‡ªå·±å®ç°çš„AOPï¼ŒåŸºäºxmlé…ç½®æ–¹å¼</li>\n</ol>\n<p>å¸¸ç”¨çš„æ˜¯å‰2ç§æ–¹å¼ã€‚</p>\n<h3 id=\"å‡†å¤‡å·¥ä½œ\">å‡†å¤‡å·¥ä½œ</h3>\n<p>â€‹\tå¼•å…¥ä¾èµ–</p>\n<pre><code class=\"language-xml\">&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;\n    &lt;version&gt;6.0.4&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;\n    &lt;version&gt;6.0.4&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>å¼•å…¥å‘½åç©ºé—´ï¼ˆcontextå’Œaopï¼‰å’Œé…ç½®xmlæ–‡ä»¶</p>\n<pre><code class=\"language-xml\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xmlns:aop=\"http://www.springframework.org/schema/aop\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd\n                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd\" &gt;\n\n&lt;!--    ç»„ä»¶æ‰«æ--&gt;\n    &lt;context:component-scan base-package=\"com.ali.service\" /&gt;\n&lt;!--    å¼€å¯aspectjè‡ªåŠ¨ä»£ç†ï¼Œspringå®¹å™¨åœ¨æ‰«æç±»çš„æ—¶å€™ï¼Œä¼šæŸ¥çœ‹ç±»ä¸Šæ˜¯å¦æœ‰@Aspectæ³¨è§£\n        å¦‚æœæœ‰ã€‚å°±ç»™è¿™ä¸ªç±»ç”Ÿæˆä»£ç†å¯¹è±¡ ã€‚\n        proxy-target-class=\"true\" è¡¨ç¤ºå¼ºåˆ¶ä½¿ç”¨cglibåŠ¨æ€ä»£ç†\n        proxy-target-class=\"false\" é»˜è®¤å€¼ï¼Œè¡¨ç¤ºæ¥å£ä½¿ç”¨jdkåŠ¨æ€ä»£ç†ï¼Œåä¹‹ä½¿ç”¨cglibåŠ¨æ€ä»£ç†--&gt;\n    &lt;aop:aspectj-autoproxy proxy-target-class=\"true\"/&gt;\n&lt;/beans&gt;\n</code></pre>\n<p>ç¼–å†™ç›®æ ‡ç±»</p>\n<pre><code class=\"language-java\">// ç›®æ ‡ç±»\n@Service\npublic class UserService {\n    // ç›®æ ‡æ–¹æ³•\n    public void login() {\n        System.out.println(\"UserService login....\");\n    }\n}\n</code></pre>\n<p>ç¼–å†™åˆ‡é¢ç±»</p>\n<pre><code class=\"language-java\">// åˆ‡é¢ç±»,éœ€è¦@Aspect æ ‡æ³¨\n@Aspect\n@Component(\"logAspect\")\npublic class LogAspect {\n\n    // åˆ‡é¢ = é€šçŸ¥+åˆ‡ç‚¹\n    // é€šçŸ¥å°±æ˜¯å¢å¼ºï¼Œå°±æ˜¯å…·ä½“è¦ç¼–å†™çš„å¢å¼ºä»£ç \n    // è¿™é‡Œé€šçŸ¥ä»¥æ–¹æ³•çš„å½¢å¼å‡ºç°ã€‚\n    // @Before æ ‡æ³¨çš„æ–¹æ³•å°±æ˜¯ä¸€ä¸ªå‰ç½®é€šçŸ¥\n    @Before(\"execution(* com.ali.service.UserService.*(..))\")\n    public void advice( ) {\n        System.out.println(\"è¿™æ˜¯ä¸€ä¸ªå‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œ....\");\n    }\n    \n    // ç¯ç»•é€šçŸ¥æ˜¯æœ€å¤§çš„é€šçŸ¥ï¼Œåœ¨å‰ç½®é€šçŸ¥ä¹‹å‰ï¼Œåœ¨åç½®é€šçŸ¥ä¹‹å\n    @Around(\"execution(* com.ali.service.UserService.*(..))\")\n    public void around(ProceedingJoinPoint joinPoint) throws Throwable {\n        System.out.println(\"around start\");\n        // æ‰§è¡Œç›®æ ‡æ–¹æ³•\n        joinPoint.proceed();\n        System.out.println(\"around end\");\n    }\n}\n</code></pre>\n<p>æµ‹è¯•ä»£ç ï¼š</p>\n<pre><code class=\"language-java\">@Test\npublic void test() {\n    ApplicationContext context = new ClassPathXmlApplicationContext(\"spring.xml\");\n    UserService userService = context.getBean(\"userService\", UserService.class);\n    userService.login();\n}\n</code></pre>\n<p>æ³¨æ„ï¼šå½“æœ‰å¤šä¸ªåˆ‡é¢ç±»æ—¶ï¼Œå¯ä»¥ä½¿ç”¨@Orderï¼ˆï¼‰æ³¨è§£è¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œå°±å…ˆæ‰§è¡Œã€‚æ¯”å¦‚ï¼š@Order(2) æ¯”@Orderï¼ˆ3ï¼‰ å…ˆæ‰§è¡Œã€‚</p>\n<p>åœ¨æ¯ä¸ªæ–¹æ³•ä¸Šéƒ½å†™ä¸€éåˆ‡ç‚¹è¡¨è¾¾å¼å¾ˆéº»çƒ¦ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªé€šç”¨çš„åˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œç„¶ååœ¨æ–¹æ³•ä¸Šä½¿ç”¨è¿™ä¸ªé€šç”¨çš„è¡¨è¾¾å¼å³å¯ã€‚</p>\n<pre><code class=\"language-java\">// å®šä¹‰é€šç”¨çš„åˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œåç»­é€šçŸ¥ç›´æ¥ä½¿ç”¨æ–¹æ³•åæ¥å¼•ç”¨åˆ‡ç‚¹è¡¨è¾¾å¼\n// åˆ‡ç‚¹å°±æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®šä¹‰äº†åœ¨å“ªäº›è¿æ¥ç‚¹ä¸Šæ‰§è¡Œé€šçŸ¥\n@Pointcut(\"execution(* com.ali.service.UserService.*(..))\")\npublic void commmonPointcut() {\n    // è¿™ä¸ªæ–¹æ³•åªæ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œæ–¹æ³•ä½“ä¸éœ€è¦ç¼–å†™ä»»ä½•ä»£ç \n}\n\n@AfterReturning(\"commmonPointcut()\")\npublic void afterAdvice( ) {\n    System.out.println(\"è¿™æ˜¯ä¸€ä¸ªå‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œ....\");\n}\n</code></pre>\n<h3 id=\"joinpointçš„ä½¿ç”¨\">JoinPointçš„ä½¿ç”¨</h3>\n<p>é€šçŸ¥æ–¹æ³•å¯ä»¥åŠ å…¥å‚æ•°JoinPointï¼Œè¿™ä¸ªæ˜¯springå®¹å™¨è‡ªåŠ¨ä¼ å…¥çš„ã€‚</p>\n<pre><code class=\"language-java\">@Before(\"execution(* com.ali.service.UserService.*(..))\")\npublic void advice(JoinPoint joinPoint) {\n    System.out.println(\"è¿™æ˜¯ä¸€ä¸ªå‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œ....\");\n    // ä½¿ç”¨JoinPointå¯¹è±¡è·å–è¿æ¥ç‚¹çš„ä¿¡æ¯\n    // joinPoint.getSignature() è·å–è¿æ¥ç‚¹çš„æ–¹æ³•ç­¾å\n    // é€šè¿‡æ–¹æ³•ç­¾åå¯ä»¥è·å–åˆ°è¿™ä¸ªæ–¹æ³•çš„å…·ä½“ä¿¡æ¯\n    // è·å–æ–¹æ³•å\n    String methodName = joinPoint.getSignature().getName();\n    System.out.println(\"æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•æ˜¯ï¼š\" + methodName);\n}\n</code></pre>\n\n\n</div>\n<div id=\"MySignature\">\n    <p>æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š<a href=\"https://www.cnblogs.com/alineverstop/\" target=\"_blank\">NE_STOP</a>ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š<a href=\"https://www.cnblogs.com/alineverstop/p/19593787\" target=\"_blank\">https://www.cnblogs.com/alineverstop/p/19593787</a></p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-09 10:07</span>&nbsp;\n<a href=\"https://www.cnblogs.com/alineverstop\">NE_STOP</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    }
  ]
}