{
  "title": "ä¸»é¡µ - åšå®¢å›­",
  "link": "https://www.cnblogs.com/",
  "description": "ä¸»é¡µ - åšå®¢å›­ RSS",
  "entries": [
    {
      "title": "ä¸Šå‘¨çƒ­ç‚¹å›é¡¾ï¼ˆ1.26-2.1ï¼‰",
      "link": "https://www.cnblogs.com/cmt/p/19562421",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/cmt/p/19562421\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-02 09:03\">\n    <span>ä¸Šå‘¨çƒ­ç‚¹å›é¡¾ï¼ˆ1.26-2.1ï¼‰</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p>çƒ­ç‚¹éšç¬”ï¼š</p>\n<p>Â· <a href=\"https://www.cnblogs.com/bu-huo/archive/2026/01/27/19537153.html\" rel=\"noopener\" target=\"_blank\">Clawdbotéƒ¨ç½²æ•™ç¨‹ï¼Œ10åˆ†é’Ÿç™½å«–Qwenï¼Œç»™è‡ªå·±æ­ä¸ª7x24å°æ—¶AIåŠ©ç†</a> (<a href=\"https://www.cnblogs.com/bu-huo/\" rel=\"noopener\" target=\"_blank\">å¼ ä¸æƒ‘</a>) <br />Â· <a href=\"https://www.cnblogs.com/catchadmin/archive/2026/01/28/19545341.html\" rel=\"noopener\" target=\"_blank\">Clawdbot å®Œæ•´å¯¹æ¥é£ä¹¦æ•™ç¨‹ æ‰‹æŠŠæ‰‹æ­å»ºä½ çš„ä¸“å± AI åŠ©æ‰‹</a> (<a href=\"https://www.cnblogs.com/catchadmin/\" rel=\"noopener\" target=\"_blank\">JaguarJack</a>) <br />Â· <a href=\"https://www.cnblogs.com/philry/archive/2026/01/26/19534679.html\" rel=\"noopener\" target=\"_blank\">ç ´é˜²äº†ï¼2026å¼€å¹´3ä½ç¨‹åºå‘˜æ¥è¿çŒæ­»ï¼Œæœ€å¹´è½»26å²ï¼Œ29å²ç”·ä¸»ç¦»ä¸–æ—¶ï¼Œå¦»å­æ­£æ€€äºŒèƒ7ä¸ªæœˆâ€¦</a> (<a href=\"https://www.cnblogs.com/philry/\" rel=\"noopener\" target=\"_blank\">å¤§èŠ’æœ2ç‚¹0</a>) <br />Â· <a href=\"https://www.cnblogs.com/ChenAI-TGF/archive/2026/01/29/19545952.html\" rel=\"noopener\" target=\"_blank\">é›¶é—¨æ§›éƒ¨ç½²æœ¬åœ° AI åŠ©æ‰‹ï¼šClawdbot/Meltbot éƒ¨ç½²æ·±åº¦ä¿å§†çº§æ•™ç¨‹</a> (<a href=\"https://www.cnblogs.com/ChenAI-TGF/\" rel=\"noopener\" target=\"_blank\">TTGF</a>) <br />Â· <a href=\"https://www.cnblogs.com/xueweihan/archive/2026/01/28/19535889.html\" rel=\"noopener\" target=\"_blank\">ã€ŠHelloGitHubã€‹ç¬¬ 118 æœŸ</a> (<a href=\"https://www.cnblogs.com/xueweihan/\" rel=\"noopener\" target=\"_blank\">å‰Šå¾®å¯’</a>) <br />Â· <a href=\"https://www.cnblogs.com/zer0Black/archive/2026/01/26/19535695.html\" rel=\"noopener\" target=\"_blank\">OpenCodeå’Œoh-my-opencodeå®‰è£…</a> (<a href=\"https://www.cnblogs.com/zer0Black/\" rel=\"noopener\" target=\"_blank\">é”…æ€»çš„ç¨‹åºäººç”Ÿ</a>) <br />Â· <a href=\"https://www.cnblogs.com/yupi/archive/2026/01/27/19537546.html\" rel=\"noopener\" target=\"_blank\">Agent Skills å‚»ç“œå¼æ•™ç¨‹ï¼Œ26 å¹´æœ€ç« AI æŠ€æœ¯å°±è¿™ï¼Ÿ</a> (<a href=\"https://www.cnblogs.com/yupi/\" rel=\"noopener\" target=\"_blank\">ç¨‹åºå‘˜é±¼çš®</a>) <br />Â· <a href=\"https://www.cnblogs.com/xiangcaoacao/archive/2026/01/30/19550609.html\" rel=\"noopener\" target=\"_blank\">Moltbotçš„å®‰è£…è¸©å‘ä¸åˆä½“éªŒ</a> (<a href=\"https://www.cnblogs.com/xiangcaoacao/\" rel=\"noopener\" target=\"_blank\">vanillaé˜¿è‰</a>) <br />Â· <a href=\"https://www.cnblogs.com/Can-daydayup/archive/2026/01/29/19550484.html\" rel=\"noopener\" target=\"_blank\">ä¸€æ¬¾åŸºäº .NET Avalonia å¼€æºå…è´¹ã€å¿«é€Ÿã€è·¨å¹³å°çš„å›¾ç‰‡æŸ¥çœ‹å™¨</a> (<a href=\"https://www.cnblogs.com/Can-daydayup/\" rel=\"noopener\" target=\"_blank\">è¿½é€æ—¶å…‰è€…</a>) <br />Â· <a href=\"https://www.cnblogs.com/catchadmin/archive/2026/01/30/19553102.html\" rel=\"noopener\" target=\"_blank\">ç›®å‰æœ€ç«çš„ AI åŠ©æ‰‹ Clawdbot åˆåˆåˆæ”¹åäº† å¹¶ä¸”å‘å¸ƒæ–°ç‰ˆæœ¬</a> (<a href=\"https://www.cnblogs.com/catchadmin/\" rel=\"noopener\" target=\"_blank\">JaguarJack</a>) <br />Â· <a href=\"https://www.cnblogs.com/haibindev/archive/2026/01/29/19547739.html\" rel=\"noopener\" target=\"_blank\">å›½å†…AIç¼–ç¨‹IDEå¯¹æ¯”ï¼ˆäºŒï¼‰ï¼šä»é›¶æ„å»ºæ¡Œé¢åº”ç”¨å®æµ‹</a> (<a href=\"https://www.cnblogs.com/haibindev/\" rel=\"noopener\" target=\"_blank\">haibindev</a>) <br />Â· <a href=\"https://www.cnblogs.com/sdcb/archive/2026/01/26/chats-1-10.html\" rel=\"noopener\" target=\"_blank\">å¤åˆ» ChatGPT é«˜çº§æ•°æ®åˆ†æï¼Sdcb Chats 1.10 é‡ç£…å‘å¸ƒï¼šèƒ½åˆ†æExcelã€åšPPT</a> (<a href=\"https://www.cnblogs.com/sdcb/\" rel=\"noopener\" target=\"_blank\">.NETéªšæ“ä½œ</a>)</p>\n<p>çƒ­ç‚¹æ–°é—»ï¼š</p>\n<p>Â· <a href=\"https://news.cnblogs.com/n/813590/\" rel=\"noopener\" target=\"_blank\">Redisä¹‹çˆ¶ï¼šæ‰‹å†™ä»£ç ï¼Ÿé†’é†’å§é™¤éä½ å›¾ä¸€ä¹</a><br />Â· <a href=\"https://news.cnblogs.com/n/813609/\" rel=\"noopener\" target=\"_blank\">Claudeç»Ÿæ²»ä¸€åˆ‡ï¼åä¸‹è¿™é¢—çº¢è¯ä¸¸ï¼Œç„Šå·¥ä¹Ÿæ˜¯é¡¶å°–ç¨‹åºå‘˜</a><br />Â· <a href=\"https://news.cnblogs.com/n/813732/\" rel=\"noopener\" target=\"_blank\">ã€Œ360doc ä¸ªäººå›¾ä¹¦é¦†ã€å®£å¸ƒæ— å¿è½¬è®©ï¼Œåˆ›å§‹äººç§°ä¸ºå¹³å°å¯»æ‰¾ã€Œæ–°å®¶ã€</a><br />Â· <a href=\"https://news.cnblogs.com/n/813688/\" rel=\"noopener\" target=\"_blank\">æŒ‰æ¯”ä¾‹è¡¥å……è¿™ä¸‰ç§æ°¨åŸºé…¸ï¼Œ6ä¸ªæœˆèƒ½å¹´è½»1.4å²</a><br />Â· <a href=\"https://news.cnblogs.com/n/813567/\" rel=\"noopener\" target=\"_blank\">Clawdbotä¸€å¤œçˆ†çº¢ï¼Œé¦–ä¸ª0å‘˜å·¥å…¬å¸è¯ç”Ÿï¼7Ã—24hæ°¸ä¸ä¸‹ç­</a><br />Â· <a href=\"https://news.cnblogs.com/n/813795/\" rel=\"noopener\" target=\"_blank\">å®ƒæ˜¯ç¥ï¼Œä¹Ÿæ˜¯æ¯’ï¼Clawdbotæ”¹åå·å…¥åƒä¸‡è¯ˆéª—ï¼Œæ›´è®©ä½ çš„ç”µè„‘â€œè£¸å¥”â€</a><br />Â· <a href=\"https://news.cnblogs.com/n/813844/\" rel=\"noopener\" target=\"_blank\">Clawdbotç›®å‰æ²¡æœ‰å•†ä¸šä»·å€¼ï¼Œä½†ç»™â€œé¸¡è‚‹â€çš„AI PCä»¬ä¸Šäº†ä¸€è¯¾</a><br />Â· <a href=\"https://news.cnblogs.com/n/813575/\" rel=\"noopener\" target=\"_blank\">ä»…å”®55å…ƒçš„iPhone 4Sï¼Œåœ¨æ‹¼å¤šå¤šå½»åº•å–çˆ†</a><br />Â· <a href=\"https://news.cnblogs.com/n/813679/\" rel=\"noopener\" target=\"_blank\">èµ·åº•32å²ç¨‹åºå‘˜çŒæ­»èƒŒåå…¬å¸ï¼šä¸é…åˆå·¥ä¼¤è®¤å®š æ›¾ç»™39ä¸‡â€œå°å£è´¹â€</a><br />Â· <a href=\"https://news.cnblogs.com/n/813772/\" rel=\"noopener\" target=\"_blank\">å„¿ç«¥æ‰‹è¡¨å¸‚åœºâ€œå¤§å˜å¤©â€</a><br />Â· <a href=\"https://news.cnblogs.com/n/813858/\" rel=\"noopener\" target=\"_blank\">é©¬æ–¯å…‹è¢«æ›åˆå¹¶SpaceXå’ŒxAIï¼ä¼°å€¼1.5ä¸‡äº¿ç¾å…ƒï¼Œå·¦æ‰‹ç«ç®­å³æ‰‹AI</a><br />Â· <a href=\"https://news.cnblogs.com/n/813741/\" rel=\"noopener\" target=\"_blank\">å¾•å¡10äº¿æ¬§å…ƒå–èº«ï¼Œä¸ºä»€ä¹ˆå°ç±³ä¸€å®šä¸èƒ½ä¹°ï¼Ÿ</a></p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-02 09:03</span>&nbsp;\n<a href=\"https://www.cnblogs.com/cmt\">åšå®¢å›­å›¢é˜Ÿ</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "Docusaurus 3.x åˆ° Astro 5.x è¿ç§»å®æˆ˜ï¼šåˆ©ç”¨ Islands æ¶æ„å®ç°æ€§èƒ½ä¸æ„å»ºé€Ÿåº¦åŒé‡æå‡",
      "link": "https://www.cnblogs.com/newbe36524/p/19562414",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/newbe36524/p/19562414\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-02 09:01\">\n    <span>Docusaurus 3.x åˆ° Astro 5.x è¿ç§»å®æˆ˜ï¼šåˆ©ç”¨ Islands æ¶æ„å®ç°æ€§èƒ½ä¸æ„å»ºé€Ÿåº¦åŒé‡æå‡</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"ä»-docusaurus-3x-åˆ°-astro-5xhagicode-ç«™ç‚¹è¿ç§»å®æˆ˜å¤ç›˜\">ä» Docusaurus 3.x åˆ° Astro 5.xï¼šHagiCode ç«™ç‚¹è¿ç§»å®æˆ˜å¤ç›˜</h1>\n<blockquote>\n<p>æœ¬æ–‡å¤ç›˜äº†æˆ‘ä»¬å°† HagiCode å®˜æ–¹ç½‘ç«™ä» Docusaurus 3.x è¿ç§»è‡³ Astro 5.x çš„å…¨è¿‡ç¨‹ã€‚æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¦‚ä½•é€šè¿‡ Astro çš„ Islands æ¶æ„è§£å†³æ€§èƒ½ç“¶é¢ˆï¼ŒåŒæ—¶ä¿ç•™ç°æœ‰çš„ React ç»„ä»¶èµ„äº§ï¼Œå®ç°æ„å»ºé€Ÿåº¦ä¸åŠ è½½æ€§èƒ½çš„åŒé‡æå‡ã€‚</p>\n</blockquote>\n\n<h2 id=\"èƒŒæ™¯\">èƒŒæ™¯</h2>\n<p>2026 å¹´ 1 æœˆï¼Œæˆ‘ä»¬å¯¹ HagiCode çš„å®˜æ–¹ç«™ç‚¹è¿›è¡Œäº†ä¸€æ¬¡\"å¿ƒè„ç§»æ¤æ‰‹æœ¯\"â€”â€”å°†æ ¸å¿ƒæ¡†æ¶ä» Docusaurus 3.x å…¨é¢è¿ç§»è‡³ Astro 5.xã€‚è¿™ä¸æ˜¯ä¸€æ¬¡å†²åŠ¨çš„å¤§é‡æ„ï¼Œè€Œæ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘çš„æŠ€æœ¯æŠ‰æ‹©ã€‚</p>\n<p>åœ¨è¿ç§»å‰ï¼Œæˆ‘ä»¬çš„ç«™ç‚¹è™½ç„¶åŠŸèƒ½å®Œå–„ï¼Œä½†é€æ¸æ˜¾éœ²å‡ºä¸€äº›\"å¯Œè´µç—…\"ï¼šæ„å»ºäº§ç‰©ä½“ç§¯è‡ƒè‚¿ã€JavaScript è´Ÿè½½è¿‡é«˜ï¼Œä¸”é¡µé¢åŠ è½½é€Ÿåº¦åœ¨å¤æ‚æ–‡æ¡£é¡µé¢ä¸‹ä¸å¤Ÿç†æƒ³ã€‚ä½œä¸ºä¸€ä¸ª AI ä»£ç åŠ©æ‰‹é¡¹ç›®ï¼ŒHagiCode éœ€è¦é¢‘ç¹æ›´æ–°æ–‡æ¡£å’ŒåŠŸèƒ½ä»‹ç»ï¼Œæ„å»ºæ•ˆç‡ç›´æ¥å½±å“å‘å¸ƒé€Ÿåº¦ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ç«™ç‚¹å¯¹æœç´¢å¼•æ“ï¼ˆSEOï¼‰æ›´åŠ å‹å¥½ï¼Œä»¥ä¾¿è®©æ›´å¤šå¼€å‘è€…å‘ç°è¿™ä¸ªé¡¹ç›®ã€‚</p>\n<p>ä¸ºäº†è§£å†³è¿™äº›ç—›ç‚¹ï¼Œæˆ‘ä»¬åšäº†ä¸€ä¸ªå¤§èƒ†çš„å†³å®šï¼šæ•´ä¸ªæ„å»ºç³»ç»Ÿæ¨å€’é‡æ¥ï¼Œè¿ç§»åˆ° Astroã€‚è¿™ä¸ªå†³å®šå¸¦æ¥çš„å˜åŒ–ï¼Œå¯èƒ½æ¯”ä½ æƒ³è±¡çš„è¿˜è¦å¤§â€”â€”ç¨åæˆ‘ä¼šå…·ä½“è¯´ã€‚</p>\n<h2 id=\"å…³äº-hagicode\">å…³äº HagiCode</h2>\n<p>æœ¬æ–‡åˆ†äº«çš„ç«™ç‚¹è¿ç§»æ–¹æ¡ˆï¼Œæ¥è‡ªæˆ‘ä»¬åœ¨ <a href=\"https://github.com/HagiCode-org/site\" rel=\"noopener nofollow\" target=\"_blank\">HagiCode</a> é¡¹ç›®ä¸­çš„å®è·µç»éªŒã€‚</p>\n<p>HagiCode æ˜¯ä¸€æ¬¾è‡´åŠ›äºæå‡å¼€å‘æ•ˆç‡çš„ AI ä»£ç åŠ©æ‰‹ï¼Œæˆ‘ä»¬ä¸ä»…å…³æ³¨æ ¸å¿ƒåŠŸèƒ½çš„è¿­ä»£ï¼ŒåŒæ ·é‡è§†å¼€å‘è€…ä½“éªŒã€‚è¿™æ¬¡ç«™ç‚¹çš„é‡æ„ï¼Œä¹Ÿæ˜¯ä¸ºäº†è®©ç”¨æˆ·åœ¨æµè§ˆæ–‡æ¡£å’Œå®˜ç½‘æ—¶èƒ½è·å¾—æè‡´çš„åŠ è½½é€Ÿåº¦ã€‚</p>\n<h2 id=\"ä¸ºä»€ä¹ˆè¦æ”¾å¼ƒæˆç†Ÿçš„-docusaurus\">ä¸ºä»€ä¹ˆè¦æ”¾å¼ƒæˆç†Ÿçš„ Docusaurusï¼Ÿ</h2>\n<p>åœ¨ React ç”Ÿæ€ä¸­ï¼ŒDocusaurus ä¸€ç›´æ˜¯æ–‡æ¡£ç«™ç‚¹çš„\"æ ‡å‡†ç­”æ¡ˆ\"ã€‚å®ƒå¼€ç®±å³ç”¨ï¼Œæ’ä»¶ä¸°å¯Œï¼Œç¤¾åŒºæ´»è·ƒã€‚ä½†æ˜¯ï¼Œéšç€ HagiCode åŠŸèƒ½çš„å¢åŠ ï¼Œæˆ‘ä»¬ä¹Ÿæ„Ÿå—åˆ°äº†å®ƒçš„å±€é™æ€§ï¼š</p>\n<ol>\n<li><strong>æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šDocusaurus æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª React SPAï¼ˆå•é¡µåº”ç”¨ï¼‰ã€‚å“ªæ€•ä½ æ˜¯å†™çº¯é™æ€é¡µé¢ï¼Œå®¢æˆ·ç«¯ä¹Ÿéœ€è¦åŠ è½½ React è¿è¡Œæ—¶å¹¶è¿›è¡Œæ°´åˆï¼Œè¿™å¯¹äºç®€å•çš„æ–‡æ¡£é¡µé¢æ¥è¯´å¤ªé‡äº†ã€‚</li>\n<li><strong>èµ„æºä½“ç§¯</strong>ï¼šå³ä¾¿é¡µé¢å†…å®¹å¾ˆå°‘ï¼Œæ‰“åŒ…åçš„ JS ä½“ç§¯ä¹Ÿç›¸å¯¹å›ºå®šï¼Œè¿™å¯¹ç§»åŠ¨ç«¯ç”¨æˆ·å’Œç½‘ç»œè¾ƒå·®çš„ç¯å¢ƒä¸å¤Ÿå‹å¥½ã€‚</li>\n<li><strong>çµæ´»æ€§ä¸è¶³</strong>ï¼šè™½ç„¶ä¹Ÿèƒ½æ‰©å±•ï¼Œä½†åœ¨æ„å»ºæµç¨‹çš„å®šåˆ¶ä¸Šï¼Œæˆ‘ä»¬æ¸´æœ›æ‹¥æœ‰æ›´åº•å±‚çš„æ§åˆ¶æƒã€‚</li>\n</ol>\n<p>Astro çš„å‡ºç°æ­£å¥½è§£å†³äº†è¿™äº›é—®é¢˜ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå…¨æ–°çš„\"å²›å±¿æ¶æ„\"ï¼ˆIslands Architectureï¼‰ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒAstro ç”Ÿæˆé›¶ JavaScript çš„é™æ€ HTMLï¼Œåªæœ‰éœ€è¦äº¤äº’çš„ç»„ä»¶æ‰ä¼š\"æ¿€æ´»\"å¹¶åŠ è½½ JSã€‚è¿™æ„å‘³ç€æˆ‘ä»¬çš„ç«™ç‚¹å¤§éƒ¨åˆ†å†…å®¹éƒ½æ˜¯çº¯ HTMLï¼Œé€Ÿåº¦æå¿«ã€‚</p>\n<h2 id=\"è¿ç§»æ ¸å¿ƒç­–ç•¥æ¶æ„å¹³æ»‘è¿‡æ¸¡\">è¿ç§»æ ¸å¿ƒç­–ç•¥ï¼šæ¶æ„å¹³æ»‘è¿‡æ¸¡</h2>\n<p>è¿ç§»ä¸æ˜¯ç®€å•çš„å¤åˆ¶ç²˜è´´ï¼Œè€Œæ˜¯æ€ç»´æ¨¡å¼çš„è½¬å˜ã€‚æˆ‘ä»¬ä» Docusaurus çš„\"å…¨ React æ¨¡å¼\"åˆ‡æ¢åˆ°äº† Astro çš„\"Core + Islands\"æ¨¡å¼ã€‚</p>\n<h3 id=\"1-é…ç½®ç³»ç»Ÿçš„é‡æ„\">1. é…ç½®ç³»ç»Ÿçš„é‡æ„</h3>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä» <code>docusaurus.config.ts</code> è½¬å‘ <code>astro.config.mjs</code>ã€‚è¿™ä¸ä»…æ˜¯æ–‡ä»¶åçš„å˜åŒ–ï¼Œæ›´æ˜¯è·¯ç”±å’Œæ„å»ºé€»è¾‘çš„é‡å†™ã€‚</p>\n<p>åœ¨ Docusaurus ä¸­ï¼Œä¸€åˆ‡çš†æ’ä»¶ï¼›è€Œåœ¨ Astro ä¸­ï¼Œä¸€åˆ‡çš†é›†æˆã€‚æˆ‘ä»¬éœ€è¦é‡æ–°å®šä¹‰ç«™ç‚¹çš„åŸºç¡€è·¯å¾„ã€æ„å»ºè¾“å‡ºæ¨¡å¼ï¼ˆé™æ€ vs SSRï¼‰ä»¥åŠèµ„æºå‹ç¼©ç­–ç•¥ã€‚</p>\n<p><strong>è¿ç§»å‰ï¼š</strong></p>\n<pre><code class=\"language-typescript\">// docusaurus.config.ts\nexport default {\n  title: 'HagiCode',\n  url: 'https://hagicode.com',\n  baseUrl: '/',\n  // ... æ›´å¤šé…ç½®\n};\n</code></pre>\n<p><strong>è¿ç§»åï¼š</strong></p>\n<pre><code class=\"language-javascript\">// astro.config.mjs\nimport { defineConfig } from 'astro/config';\nimport react from '@astrojs/react';\n\nexport default defineConfig({\n  integrations: [react()],\n  site: 'https://hagicode.com',\n  base: '/',\n  // é’ˆå¯¹é™æ€èµ„æºçš„ä¼˜åŒ–é…ç½®\n  build: {\n    inlineStylesheets: 'auto',\n  },\n});\n</code></pre>\n<h3 id=\"2-react-ç»„ä»¶çš„å»ç•™ä¸æ”¹é€ \">2. React ç»„ä»¶çš„å»ç•™ä¸æ”¹é€ </h3>\n<p>è¿™æ˜¯è¿ç§»ä¸­æœ€å¤´ç–¼çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬ç°æœ‰çš„ç«™ç‚¹æœ‰å¾ˆå¤š React ç»„ä»¶ï¼ˆæ¯”å¦‚ Tabs ç»„ä»¶ã€ä»£ç é«˜äº®ã€åé¦ˆæŒ‰é’®ç­‰ï¼‰ã€‚ç›´æ¥æ‰”æ‰å¤ªå¯æƒœï¼Œå…¨éƒ½ä¿ç•™åˆä¼šå¯¼è‡´ JS è´Ÿè½½è¿‡é‡ã€‚</p>\n<p>HagiCode é‡‡ç”¨äº†<strong>æ¸è¿›å¼æ°´åˆ</strong>ç­–ç•¥ï¼š</p>\n<ul>\n<li><strong>çº¯é™æ€ç»„ä»¶</strong>ï¼šå¯¹äºå±•ç¤ºå‹å†…å®¹ï¼ˆå¦‚é¡µçœ‰ã€é¡µè„šã€çº¯æ–‡æœ¬æ–‡æ¡£ï¼‰ï¼Œé‡å†™ä¸º Astro ç»„ä»¶ï¼ˆ<code>.astro</code> æ–‡ä»¶ï¼‰ï¼Œåœ¨æ„å»ºæ—¶ç›´æ¥æ¸²æŸ“ä¸º HTMLã€‚</li>\n<li><strong>äº¤äº’å¼å²›å±¿</strong>ï¼šå¯¹äºå¿…é¡»ä¿ç•™äº¤äº’çš„ç»„ä»¶ï¼ˆå¦‚ä¸»é¢˜åˆ‡æ¢å™¨ã€Tabs åˆ‡æ¢ã€ä»£ç å—å¤åˆ¶æŒ‰é’®ï¼‰ï¼Œä¿ç•™ React å®ç°ï¼Œå¹¶æ·»åŠ  <code>client:load</code> æˆ– <code>client:visible</code> æŒ‡ä»¤ã€‚</li>\n</ul>\n<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„æ–‡æ¡£ä¸­å¸¸ç”¨çš„ Tabs ç»„ä»¶ï¼š</p>\n<pre><code class=\"language-jsx\">// src/components/Tabs.jsx\nimport { useState } from 'react';\nimport './Tabs.css'; // å¼•å…¥æ ·å¼\n\nexport default function Tabs({ items }) {\n  const [activeIndex, setActiveIndex] = useState(0);\n  // ... çŠ¶æ€é€»è¾‘\n  return (\n    &lt;div className=\"tabs-wrapper\"&gt;\n      {/* æ¸²æŸ“é€»è¾‘ */}\n    &lt;/div&gt;\n  );\n}\n</code></pre>\n<p>åœ¨ Markdown ä¸­ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬æ˜ç¡®å‘Šè¯‰ Astroï¼š\"è¿™ä¸ªç»„ä»¶éœ€è¦ JS\"ï¼š</p>\n<pre><code class=\"language-markdown\">// src/content/docs/example.mdx\nimport Tabs from '../../components/Tabs.jsx';\n\n&lt;!-- åªåœ¨ç»„ä»¶è¿›å…¥è§†å£æ—¶æ‰åŠ è½½ JS --&gt;\n&lt;Tabs client:visible items={...} /&gt;\n</code></pre>\n<p>è¿™æ ·ï¼Œéè§†å£å†…çš„äº¤äº’ç»„ä»¶ä¸ä¼šæŠ¢å å¸¦å®½ï¼Œæå¤§åœ°ä¼˜åŒ–äº†é¦–å±åŠ è½½é€Ÿåº¦ã€‚</p>\n<h3 id=\"3-æ ·å¼ç³»ç»Ÿçš„é€‚é…css-modules-åˆ°-scoped\">3. æ ·å¼ç³»ç»Ÿçš„é€‚é…ï¼šCSS Modules åˆ° Scoped</h3>\n<p>Docusaurus é»˜è®¤æ”¯æŒ CSS Modulesï¼Œè€Œ Astro æ¨å´‡ä½¿ç”¨ Scoped CSSï¼ˆé€šè¿‡ <code>&lt;style&gt;</code> æ ‡ç­¾ï¼‰ã€‚ä¸¤è€…çš„æ ¸å¿ƒæ€æƒ³éƒ½æ˜¯éš”ç¦»æ ·å¼ï¼Œä½†è¯­æ³•ä¸åŒã€‚</p>\n<p>åœ¨ HagiCode çš„è¿ç§»ä¸­ï¼Œæˆ‘ä»¬å°†å¤§éƒ¨åˆ†å¤æ‚çš„ CSS Modules æ‹†è§£ä¸º Astro çš„ Scoped æ ·å¼ã€‚è¿™å…¶å®æ˜¯ä»¶å¥½äº‹ï¼Œå› ä¸ºåœ¨ <code>.astro</code> æ–‡ä»¶ä¸­ï¼Œæ ·å¼å’Œæ¨¡æ¿å†™åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œç»´æŠ¤èµ·æ¥æ›´åŠ ç›´è§‚ã€‚</p>\n<p><strong>æ”¹é€ å‰ï¼š</strong></p>\n<pre><code class=\"language-css\">/* Tabs.module.css */\n.wrapper { background: var(--ifm-background-color); }\n</code></pre>\n<p><strong>æ”¹é€ å (Astro Scoped):</strong></p>\n<pre><code class=\"language-html\">&lt;!-- Tabs.astro --&gt;\n&lt;div class=\"tabs-wrapper\"&gt;\n  &lt;slot /&gt;\n&lt;/div&gt;\n\n&lt;style&gt;\n  .tabs-wrapper {\n    /* ç›´æ¥ä½¿ç”¨ CSS å˜é‡ï¼Œé€‚é…ä¸»é¢˜ */\n    background: var(--bg-color);\n    padding: 1rem;\n  }\n&lt;/style&gt;\n</code></pre>\n<p>åŒæ—¶ï¼Œæˆ‘ä»¬ç»Ÿä¸€äº†å…¨å±€ CSS å˜é‡ç³»ç»Ÿï¼Œåˆ©ç”¨ Astro çš„ç¯å¢ƒæ„ŸçŸ¥èƒ½åŠ›ï¼Œç¡®ä¿æš—è‰²æ¨¡å¼åœ¨ä¸åŒé¡µé¢é—´çš„åˆ‡æ¢æ— ç¼è¡”æ¥ã€‚</p>\n<h2 id=\"å®è·µä¸­çš„å‘ä¸è§£å†³æ–¹æ¡ˆ\">å®è·µä¸­çš„å‘ä¸è§£å†³æ–¹æ¡ˆ</h2>\n<p>åœ¨ HagiCode çš„å®é™…è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸å°‘å‘ï¼Œè¿™é‡ŒæŒ‘å‡ ä¸ªæœ€å…¸å‹çš„åˆ†äº«ä¸€ä¸‹ã€‚</p>\n<h3 id=\"1-è·¯å¾„ä¸ç¯å¢ƒå˜é‡çš„ç—›ç‚¹\">1. è·¯å¾„ä¸ç¯å¢ƒå˜é‡çš„ç—›ç‚¹</h3>\n<p>HagiCode æ”¯æŒå­è·¯å¾„éƒ¨ç½²ï¼ˆæ¯”å¦‚éƒ¨ç½²åˆ° GitHub Pages çš„å­ç›®å½•ï¼‰ã€‚åœ¨ Docusaurus ä¸­ï¼Œå®ƒè‡ªåŠ¨å¤„ç† <code>baseUrl</code>ã€‚ä½†åœ¨ Astro ä¸­ï¼Œå¤„ç†å›¾ç‰‡é“¾æ¥å’Œ API è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ›´å°å¿ƒã€‚</p>\n<p>æˆ‘ä»¬å¼•å…¥äº†ç¯å¢ƒå˜é‡æœºåˆ¶æ¥ç»Ÿä¸€ç®¡ç†ï¼š</p>\n<pre><code class=\"language-javascript\">// åœ¨æ„å»ºè„šæœ¬ä¸­å¤„ç†è·¯å¾„\nconst getBasePath = () =&gt; import.meta.env.VITE_SITE_BASE || '/';\n</code></pre>\n<p>åˆ‡è®°ï¼Œä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  <code>/</code> å¼€å¤´çš„è·¯å¾„ã€‚åœ¨å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒï¼Œæˆ–è€…é…ç½®äº† <code>base</code> è·¯å¾„åï¼Œè¿™ä¼šå¯¼è‡´èµ„æº 404ã€‚</p>\n<h3 id=\"2-commonjs-è„šæœ¬çš„å…¼å®¹\">2. CommonJS è„šæœ¬çš„å…¼å®¹</h3>\n<p>æˆ‘ä»¬çš„æ—§ç«™ç‚¹æœ‰ä¸€äº› Node.js è„šæœ¬ï¼ˆç”¨äºè‡ªåŠ¨æŠ“å– Metrics æ•°æ®ã€æ›´æ–° sitemap ç­‰ï¼‰ï¼Œå®ƒä»¬æ˜¯ç”¨ CommonJS (<code>require</code>) å†™çš„ã€‚Astro å’Œç°ä»£æ„å»ºå·¥å…·å…¨é¢æ‹¥æŠ± ES Modules (<code>import</code>/<code>export</code>)ã€‚</p>\n<p>å¦‚æœä½ ä¹Ÿæœ‰ç±»ä¼¼çš„è„šæœ¬ï¼Œè®°å¾—æŠŠå®ƒä»¬å…¨éƒ¨é‡æ„ä¸º ES Modulesã€‚è¿™æ˜¯å¤§åŠ¿æ‰€è¶‹ï¼Œæ—©ç‚¹æ”¹äº†æ—©ç‚¹çœå¿ƒã€‚</p>\n<pre><code class=\"language-javascript\">// æ—§æ–¹å¼\nconst fs = require('fs');\n\n// æ–°æ–¹å¼\nimport fs from 'fs';\n</code></pre>\n<h3 id=\"3-åˆ«å¿˜äº†-seo-ä¸é‡å®šå‘\">3. åˆ«å¿˜äº† SEO ä¸é‡å®šå‘</h3>\n<p>æœç´¢å¼•æ“å·²ç»æ”¶å½•äº† HagiCode æ—§çš„ Docusaurus é¡µé¢ã€‚å¦‚æœç›´æ¥åˆ‡åˆ° Astroï¼ŒURL ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œä¼šå¯¼è‡´å¤§é‡ 404ï¼Œæƒé‡å¤§è·Œã€‚</p>\n<p>æˆ‘ä»¬åœ¨ Astro ä¸­é…ç½®äº†é‡å®šå‘è§„åˆ™ï¼š</p>\n<pre><code class=\"language-javascript\">// astro.config.mjs\nexport default defineConfig({\n  redirects: {\n    '/docs/old-path': '/docs/new-path',\n    // æ‰¹é‡æ˜ å°„æ—§é“¾æ¥åˆ°æ–°é“¾æ¥\n  }\n});\n</code></pre>\n<p>æˆ–è€…åœ¨æœåŠ¡å™¨é…ç½®å±‚é¢å¤„ç†ã€‚ç¡®ä¿æ—§é“¾æ¥èƒ½ 301 é‡å®šå‘åˆ°æ–°åœ°å€ï¼Œè¿™å¯¹ SEO è‡³å…³é‡è¦ã€‚</p>\n<h2 id=\"æ€»ç»“\">æ€»ç»“</h2>\n<p>ä» Docusaurus è¿ç§»åˆ° Astroï¼Œå¯¹ HagiCode æ¥è¯´ï¼Œä¸ä»…ä»…æ˜¯ä¸€æ¬¡æ¡†æ¶å‡çº§ï¼Œæ›´æ˜¯ä¸€æ¬¡å¯¹\"æ€§èƒ½ä¼˜å…ˆ\"ç†å¿µçš„å®è·µã€‚</p>\n<p><strong>æˆ‘ä»¬çš„æ”¶è·ï¼š</strong></p>\n<ul>\n<li><strong>æè‡´çš„ Lighthouse åˆ†æ•°</strong>ï¼šè¿ç§»åï¼ŒHagiCode ç«™ç‚¹çš„æ€§èƒ½è¯„åˆ†è½»æ¾æ¥è¿‘æ»¡åˆ†ã€‚</li>\n<li><strong>æ›´å¿«çš„æ„å»ºé€Ÿåº¦</strong>ï¼šAstro çš„å¢é‡æ„å»ºè®©æˆ‘ä»¬æ–‡æ¡£æ›´æ–°çš„å‘å¸ƒæ—¶é—´ç¼©çŸ­äº†ä¸€åŠã€‚</li>\n<li><strong>ä¿ç•™äº†çµæ´»æ€§</strong>ï¼šé€šè¿‡ Islands æ¶æ„ï¼Œæˆ‘ä»¬æ²¡æœ‰ç‰ºç‰²ä»»ä½•äº¤äº’åŠŸèƒ½ï¼Œä¾ç„¶å¯ä»¥åœ¨éœ€è¦çš„åœ°æ–¹ä½¿ç”¨ Reactã€‚</li>\n</ul>\n<p>å¦‚æœä½ ä¹Ÿåœ¨ç»´æŠ¤æ–‡æ¡£å‹ç«™ç‚¹ï¼Œå¹¶ä¸”æ·±å—æ‰“åŒ…ä½“ç§¯æˆ–åŠ è½½é€Ÿåº¦çš„å›°æ‰°ï¼Œä¸å¦¨è¯•è¯• Astroã€‚è™½ç„¶è¿ç§»è¿‡ç¨‹éœ€è¦åŠ¨åŠ¨æ‰‹æœ¯ï¼ˆæ¯”å¦‚æŠŠ PCode çš„åå­—æ”¹æˆ HagiCodeï¼ŒæŠŠç»„ä»¶ä¸€ä¸ªä¸ªæŒ–è¿‡æ¥ï¼‰ï¼Œä½†æ¢æ¥çš„æ˜¯å¦‚ä¸èˆ¬é¡ºæ»‘çš„ç”¨æˆ·ä½“éªŒï¼Œç»å¯¹å€¼å¾—ã€‚</p>\n<p>æœ¬æ–‡åˆ†äº«çš„æ„å»ºç³»ç»Ÿï¼Œæ­£æ˜¯æˆ‘ä»¬åœ¨å¼€å‘ HagiCode è¿‡ç¨‹ä¸­å®é™…è¸©å‘ã€å®é™…ä¼˜åŒ–å‡ºæ¥çš„æ–¹æ¡ˆã€‚å¦‚æœä½ è§‰å¾—è¿™å¥—æ–¹æ¡ˆæœ‰ä»·å€¼ï¼Œè¯´æ˜æˆ‘ä»¬çš„å·¥ç¨‹å®åŠ›è¿˜ä¸é”™â€”â€”é‚£ä¹ˆ HagiCode æœ¬èº«ä¹Ÿå€¼å¾—å…³æ³¨ä¸€ä¸‹ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\">å‚è€ƒèµ„æ–™</h2>\n<ul>\n<li><a href=\"https://docs.astro.build\" rel=\"noopener nofollow\" target=\"_blank\">Astro å®˜æ–¹æ–‡æ¡£</a></li>\n<li><a href=\"https://docs.astro.build/en/guides/migrate-to-astro/migrate-from-docusaurus/\" rel=\"noopener nofollow\" target=\"_blank\">ä» Docusaurus è¿ç§»æŒ‡å—</a></li>\n<li><a href=\"https://docs.astro.build/en/core-concepts/islands/\" rel=\"noopener nofollow\" target=\"_blank\">Islands æ¶æ„è¯¦è§£</a></li>\n<li><strong>HagiCode é¡¹ç›®åœ°å€</strong>ï¼š<a href=\"https://github.com/HagiCode-org/site\" rel=\"noopener nofollow\" target=\"_blank\">github.com/HagiCode-org/site</a></li>\n<li><strong>HagiCode å®˜ç½‘</strong>ï¼š<a href=\"https://hagicode-org.github.io/site\" rel=\"noopener nofollow\" target=\"_blank\">hagicode-org.github.io/site</a></li>\n<li><strong>ä¸€é”®å®‰è£…ä½“éªŒ</strong>ï¼š<a href=\"https://hagicode-org.github.io/site/docs/installation/docker-compose\" rel=\"noopener nofollow\" target=\"_blank\">hagicode-org.github.io/site/docs/installation/docker-compose</a></li>\n</ul>\n<p>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿æ¥ GitHub ç»™ä¸ª Starï¼Œå…¬æµ‹å·²ç»å¼€å§‹å•¦ï¼</p>\n<hr />\n<p>æ„Ÿè°¢æ‚¨çš„é˜…è¯»,å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡æœ‰ç”¨,å¿«ç‚¹å‡»ä¸‹æ–¹ç‚¹èµæŒ‰é’®ğŸ‘,è®©æ›´å¤šçš„äººçœ‹åˆ°æœ¬æ–‡ã€‚</p>\n<p>æœ¬å†…å®¹é‡‡ç”¨äººå·¥æ™ºèƒ½è¾…åŠ©åä½œ,ç»æœ¬äººå®¡æ ¸,ç¬¦åˆæœ¬äººè§‚ç‚¹ä¸ç«‹åœºã€‚</p>\n<ul>\n<li><strong>æœ¬æ–‡ä½œè€…:</strong> <a href=\"https://www.newbe.pro\" rel=\"noopener nofollow\" target=\"_blank\">newbe36524</a></li>\n<li><strong>æœ¬æ–‡é“¾æ¥:</strong> <a href=\"https://hagicode-org.github.io/site/blog/2026-01-31-migrate-docusaurus-to-astro-with-islands-architecture/\" rel=\"noopener nofollow\" target=\"_blank\">https://hagicode-org.github.io/site/blog/2026-01-31-migrate-docusaurus-to-astro-with-islands-architecture/</a></li>\n<li><strong>ç‰ˆæƒå£°æ˜:</strong> æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–,å‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„!</li>\n</ul>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-02 09:01</span>&nbsp;\n<a href=\"https://www.cnblogs.com/newbe36524\">Newbe36524</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "çº¿ç¨‹å¦‚ä½•åœæ­¢ï¼Ÿçº¿ç¨‹ä¹‹é—´å¦‚ä½•åä½œï¼Ÿçº¿ç¨‹ä¹‹é—´çš„å¼‚å¸¸å¦‚ä½•å¤„ç†ï¼Ÿ",
      "link": "https://www.cnblogs.com/sevencoding/p/19557016",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/sevencoding/p/19557016\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-02 09:00\">\n    <span>çº¿ç¨‹å¦‚ä½•åœæ­¢ï¼Ÿçº¿ç¨‹ä¹‹é—´å¦‚ä½•åä½œï¼Ÿçº¿ç¨‹ä¹‹é—´çš„å¼‚å¸¸å¦‚ä½•å¤„ç†ï¼Ÿ</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h2 id=\"çº¿ç¨‹åœæ­¢\">çº¿ç¨‹åœæ­¢</h2>\n<h3 id=\"stopæ–¹æ³•\">stopæ–¹æ³•</h3>\n<p>stop æ–¹æ³•è™½ç„¶å¯ä»¥åœæ­¢çº¿ç¨‹ï¼Œä½†å®ƒå·²ç»æ˜¯ä¸å»ºè®®ä½¿ç”¨çš„åºŸå¼ƒæ–¹æ³•äº†ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡ Thread ç±»ä¸­çš„æºç å‘ç°ï¼Œstop æºç å¦‚ä¸‹ï¼š</p>\n<p><img alt=\"\" src=\"https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202404251004858.gif\" /></p>\n<p>stop æ–¹æ³•æ˜¯è¢« @Deprecated ä¿®é¥°çš„ä¸å»ºè®®ä½¿ç”¨çš„è¿‡æœŸæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨æ³¨é‡Šçš„ç¬¬ä¸€å¥è¯å°±è¯´æ˜äº† stop æ–¹æ³•ä¸ºéå®‰å…¨çš„æ–¹æ³•ã€‚</p>\n<p>åŸå› åœ¨äºå®ƒåœ¨ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹æ—¶ä¼šå¼ºåˆ¶ä¸­æ–­çº¿ç¨‹çš„æ‰§è¡Œï¼Œä¸ç®¡runæ–¹æ³•æ˜¯å¦æ‰§è¡Œå®Œäº†ï¼Œå¹¶ä¸”è¿˜ä¼šé‡Šæ”¾è¿™ä¸ªçº¿ç¨‹æ‰€æŒæœ‰çš„æ‰€æœ‰çš„é”å¯¹è±¡ã€‚è¿™ä¸€ç°è±¡ä¼šè¢«å…¶å®ƒå› ä¸ºè¯·æ±‚é”è€Œé˜»å¡çš„çº¿ç¨‹çœ‹åˆ°ï¼Œä½¿ä»–ä»¬ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚è¿™å°±ä¼šé€ æˆæ•°æ®çš„ä¸ä¸€è‡´ã€‚</p>\n<p>æ¯”å¦‚é“¶è¡Œè½¬è´¦ï¼Œä»Aè´¦æˆ·å‘Bè´¦æˆ·è½¬è´¦500å…ƒï¼Œè¿™ä¸€è¿‡ç¨‹åˆ†ä¸ºä¸‰æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯ä»Aè´¦æˆ·ä¸­å‡å»500å…ƒï¼Œå‡å¦‚åˆ°è¿™æ—¶çº¿ç¨‹å°±è¢«stopäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±ä¼šé‡Šæ”¾å®ƒæ‰€å–å¾—é”ï¼Œç„¶åå…¶ä»–çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œè¿™æ ·Aè´¦æˆ·å°±è«åå…¶å¦™çš„å°‘äº†500å…ƒè€ŒBè´¦æˆ·ä¹Ÿæ²¡æœ‰æ”¶åˆ°é’±ã€‚è¿™å°±æ˜¯stopæ–¹æ³•çš„ä¸å®‰å…¨æ€§ã€‚</p>\n<h3 id=\"è®¾ç½®æ ‡å¿—ä½\">è®¾ç½®æ ‡å¿—ä½</h3>\n<p>å¦‚æœçº¿ç¨‹çš„runæ–¹æ³•ä¸­æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªé‡å¤æ‰§è¡Œçš„å¾ªç¯ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªæ ‡è®°æ¥æ§åˆ¶å¾ªç¯æ˜¯å¦ç»§ç»­</p>\n<pre><code class=\"language-java\">class FlagThread extends Thread {\n    // è‡ªå®šä¹‰ä¸­æ–­æ ‡è¯†ç¬¦\n    public volatile boolean isInterrupt = false;\n    @Override\n    public void run() {\n        // å¦‚æœä¸º true -&gt; ä¸­æ–­æ‰§è¡Œ\n        while (!isInterrupt) {\n            // ä¸šåŠ¡é€»è¾‘å¤„ç†\n        }\n    }\n}\n</code></pre>\n<p>ä½†è‡ªå®šä¹‰ä¸­æ–­æ ‡è¯†ç¬¦çš„é—®é¢˜åœ¨äºï¼šçº¿ç¨‹ä¸­æ–­çš„ä¸å¤ŸåŠæ—¶ã€‚å› ä¸ºçº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ— æ³•è°ƒç”¨ while(!isInterrupt) æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸ºç»ˆæ­¢çŠ¶æ€ï¼Œå®ƒåªèƒ½åœ¨ä¸‹ä¸€è½®è¿è¡Œæ—¶åˆ¤æ–­æ˜¯å¦è¦ç»ˆæ­¢å½“å‰çº¿ç¨‹ï¼Œæ‰€ä»¥å®ƒä¸­æ–­çº¿ç¨‹ä¸å¤ŸåŠæ—¶ï¼Œæ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š</p>\n<pre><code class=\"language-java\">class InterruptFlag {\n    // è‡ªå®šä¹‰çš„ä¸­æ–­æ ‡è¯†ç¬¦\n    private static volatile boolean isInterrupt = false;\n\n    public static void main(String[] args) throws InterruptedException {\n        // åˆ›å»ºå¯ä¸­æ–­çš„çº¿ç¨‹å®ä¾‹\n        Thread thread = new Thread(() -&gt; {\n            while (!isInterrupt) { // å¦‚æœ isInterrupt=true åˆ™åœæ­¢çº¿ç¨‹\n                System.out.println(\"thread æ‰§è¡Œæ­¥éª¤1ï¼šçº¿ç¨‹å³å°†è¿›å…¥ä¼‘çœ çŠ¶æ€\");\n                try {\n                    // ä¼‘çœ  1s\n                    Thread.sleep(1000);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                System.out.println(\"thread æ‰§è¡Œæ­¥éª¤2ï¼šçº¿ç¨‹æ‰§è¡Œäº†ä»»åŠ¡\");\n            }\n        });\n        thread.start(); // å¯åŠ¨çº¿ç¨‹\n\n        // ä¼‘çœ  100msï¼Œç­‰å¾… thread çº¿ç¨‹è¿è¡Œèµ·æ¥\n        Thread.sleep(100);\n        System.out.println(\"ä¸»çº¿ç¨‹ï¼šè¯•å›¾ç»ˆæ­¢çº¿ç¨‹ thread\");\n        // ä¿®æ”¹ä¸­æ–­æ ‡è¯†ç¬¦ï¼Œä¸­æ–­çº¿ç¨‹\n        isInterrupt = true;\n    }\n}\n</code></pre>\n<p>è¾“å‡ºï¼šæˆ‘ä»¬æœŸæœ›çš„æ˜¯ï¼šçº¿ç¨‹æ‰§è¡Œäº†æ­¥éª¤ 1 ä¹‹åï¼Œæ”¶åˆ°ä¸­æ–­çº¿ç¨‹çš„æŒ‡ä»¤ï¼Œç„¶åå°±ä¸è¦å†æ‰§è¡Œæ­¥éª¤ 2 äº†ï¼Œä½†ä»ä¸Šè¿°æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨è‡ªå®šä¹‰ä¸­æ–­æ ‡è¯†ç¬¦æ˜¯æ²¡åŠæ³•å®ç°æˆ‘ä»¬é¢„æœŸçš„ç»“æœçš„ï¼Œè¿™å°±æ˜¯è‡ªå®šä¹‰ä¸­æ–­æ ‡è¯†ç¬¦ï¼Œå“åº”ä¸å¤ŸåŠæ—¶çš„é—®é¢˜ã€‚</p>\n<p><img alt=\"\" src=\"https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202404251004853.gif\" /></p>\n<h3 id=\"interruptedä¸­æ–­\">interruptedä¸­æ–­</h3>\n<p>è¿™ç§æ–¹å¼éœ€è¦åœ¨whileå¾ªç¯ä¸­åˆ¤æ–­ä½¿ç”¨</p>\n<p>ä½¿ç”¨ interrupt æ–¹æ³•å¯ä»¥ç»™æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼Œå‘é€ä¸€ä¸ªä¸­æ–­çº¿ç¨‹çš„æŒ‡ä»¤ï¼Œå®ƒå¹¶ä¸ç›´æ¥ä¸­æ–­çº¿ç¨‹ï¼Œè€Œæ˜¯å‘é€ä¸€ä¸ªä¸­æ–­çº¿ç¨‹çš„ä¿¡å·ï¼ŒæŠŠæ˜¯å¦æ­£åœ¨ä¸­æ–­çº¿ç¨‹çš„ä¸»åŠ¨æƒäº¤ç»™ä»£ç ç¼–å†™è€…ã€‚ç›¸æ¯”äºè‡ªå®šä¹‰ä¸­æ–­æ ‡è¯†ç¬¦è€Œç„¶ï¼Œå®ƒèƒ½æ›´åŠæ—¶çš„æ¥æ”¶åˆ°ä¸­æ–­æŒ‡ä»¤ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>\n<pre><code class=\"language-java\">public static void main(String[] args) throws InterruptedException {\n    // åˆ›å»ºå¯ä¸­æ–­çš„çº¿ç¨‹å®ä¾‹\n    Thread thread = new Thread(() -&gt; {\n        while (!Thread.currentThread().isInterrupted()) {\n            System.out.println(\"thread æ‰§è¡Œæ­¥éª¤1ï¼šçº¿ç¨‹å³å°†è¿›å…¥ä¼‘çœ çŠ¶æ€\");\n            try {\n                // ä¼‘çœ  1s\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                System.out.println(\"thread çº¿ç¨‹æ¥æ”¶åˆ°ä¸­æ–­æŒ‡ä»¤ï¼Œæ‰§è¡Œä¸­æ–­æ“ä½œ\");\n                // ä¸­æ–­å½“å‰çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œ\n                break;\n            }\n            System.out.println(\"thread æ‰§è¡Œæ­¥éª¤2ï¼šçº¿ç¨‹æ‰§è¡Œäº†ä»»åŠ¡\");\n        }\n    });\n    thread.start(); // å¯åŠ¨çº¿ç¨‹\n\n    // ä¼‘çœ  100msï¼Œç­‰å¾… thread çº¿ç¨‹è¿è¡Œèµ·æ¥\n    Thread.sleep(100);\n    System.out.println(\"ä¸»çº¿ç¨‹ï¼šè¯•å›¾ç»ˆæ­¢çº¿ç¨‹ thread\");\n    // ä¿®æ”¹ä¸­æ–­æ ‡è¯†ç¬¦ï¼Œä¸­æ–­çº¿ç¨‹\n    thread.interrupt();\n}\n</code></pre>\n<p>è¾“å‡ºï¼š</p>\n<p><img alt=\"\" src=\"https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202404251004555.gif\" /></p>\n<p>ä»ä¸Šè¿°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œçº¿ç¨‹åœ¨æ¥æ”¶åˆ°ä¸­æ–­æŒ‡ä»¤ä¹‹åï¼Œç«‹å³ä¸­æ–­äº†çº¿ç¨‹ï¼Œç›¸æ¯”äºä¸Šä¸€ç§è‡ªå®šä¹‰ä¸­æ–­æ ‡è¯†ç¬¦çš„æ–¹æ³•æ¥è¯´ï¼Œå®ƒèƒ½æ›´åŠæ—¶çš„å“åº”ä¸­æ–­çº¿ç¨‹æŒ‡ä»¤ã€‚</p>\n<h3 id=\"åˆ©ç”¨interruptedexception\">åˆ©ç”¨interruptedException</h3>\n<p>è¿™ç§æ–¹å¼ ä¸ éœ€è¦åœ¨whileå¾ªç¯ä¸­åˆ¤æ–­ä½¿ç”¨</p>\n<p>å¦‚æœçº¿ç¨‹å› ä¸ºæ‰§è¡Œjoin()ï¼Œsleepæˆ–è€…wait()è€Œè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œæ­¤æ—¶æƒ³è¦åœæ­¢å®ƒï¼Œå¯ä»¥è°ƒç”¨interrupt()ï¼Œç¨‹åºä¼šæŠ›å‡ºinterruptedExceptionå¼‚å¸¸ã€‚å¯ä»¥åˆ©ç”¨è¿™ä¸ªå¼‚å¸¸ç»ˆæ­¢çº¿ç¨‹</p>\n<pre><code class=\"language-java\">public void run() {\n    System.out.println(this.getName() + \"start\");\n    int i=0;\n    //while (!Thread.interrupted()){\n    while (!Thread.currentThread().isInterrupted()){\n        try {\n            Thread.sleep(10000);\n        } catch (InterruptedException e) {\n            //e.printStackTrace();\n            System.out.println(\"ä¸­æ–­çº¿ç¨‹\");\n            break;//é€šè¿‡è¯†åˆ«åˆ°å¼‚å¸¸æ¥ä¸­æ–­\n        }\n        System.out.println(this.getName() + \" \"+ i);\n        i++;\n    }\n    System.out.println(this.getName() + \"end\");\n}\n</code></pre>\n<p><img alt=\"\" src=\"https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202404251004577.gif\" /></p>\n<h3 id=\"executor-çš„ä¸­æ–­æ“ä½œ\">Executor çš„ä¸­æ–­æ“ä½œ</h3>\n<p>è°ƒç”¨ Executor çš„ shutdown() æ–¹æ³•ä¼šç­‰å¾…çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åå†å…³é—­ï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨çš„æ˜¯ shutdownNow() æ–¹æ³•ï¼Œåˆ™ç›¸å½“äºè°ƒç”¨æ¯ä¸ªçº¿ç¨‹çš„ interrupt() æ–¹æ³•ã€‚</p>\n<p>ä»¥ä¸‹ä½¿ç”¨ Lambda åˆ›å»ºçº¿ç¨‹ï¼Œç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªåŒ¿åå†…éƒ¨çº¿ç¨‹ã€‚</p>\n<pre><code class=\"language-java\">public static void main(String[] args) {\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -&gt; {\n        try {\n            Thread.sleep(2000);\n            System.out.println(\"Thread run\");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    });\n    executorService.shutdownNow();\n    System.out.println(\"Main run\");\n}\n</code></pre>\n<pre><code class=\"language-java\">Main run\njava.lang.InterruptedException: sleep interrupted\n    at java.lang.Thread.sleep(Native Method)\n    at ExecutorInterruptExample.lambda$main$0(ExecutorInterruptExample.java:9)\n    at ExecutorInterruptExample$$Lambda$1/1160460865.run(Unknown Source)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n</code></pre>\n<p>å¦‚æœåªæƒ³ä¸­æ–­ Executor ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ submit() æ–¹æ³•æ¥æäº¤ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª <code>Future&lt;?&gt;</code> å¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨è¯¥å¯¹è±¡çš„ cancel(true) æ–¹æ³•å°±å¯ä»¥ä¸­æ–­çº¿ç¨‹ã€‚</p>\n<pre><code class=\"language-java\">Future&lt;?&gt; future = executorService.submit(() -&gt; {\n    // ..\n});\nfuture.cancel(true);\n</code></pre>\n<h2 id=\"çº¿ç¨‹ä¹‹é—´çš„åä½œ\">çº¿ç¨‹ä¹‹é—´çš„åä½œ</h2>\n<p>å½“å¤šä¸ªçº¿ç¨‹å¯ä»¥ä¸€èµ·å·¥ä½œå»è§£å†³æŸä¸ªé—®é¢˜æ—¶ï¼Œå¦‚æœæŸäº›éƒ¨åˆ†å¿…é¡»åœ¨å…¶å®ƒéƒ¨åˆ†ä¹‹å‰å®Œæˆï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹çº¿ç¨‹è¿›è¡Œåè°ƒã€‚</p>\n<h3 id=\"join\">join()</h3>\n<h4 id=\"æ¡ˆä¾‹\">æ¡ˆä¾‹</h4>\n<p>åœ¨çº¿ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œä¼šå°†å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œè€Œä¸æ˜¯å¿™ç­‰å¾…ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹ç»“æŸã€‚</p>\n<p>å¯¹äºä»¥ä¸‹ä»£ç ï¼Œè™½ç„¶ b çº¿ç¨‹å…ˆå¯åŠ¨ï¼Œä½†æ˜¯å› ä¸ºåœ¨ b çº¿ç¨‹ä¸­è°ƒç”¨äº† a çº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œb çº¿ç¨‹ä¼šç­‰å¾… a çº¿ç¨‹ç»“æŸæ‰ç»§ç»­æ‰§è¡Œï¼Œå› æ­¤æœ€åèƒ½å¤Ÿä¿è¯ a çº¿ç¨‹çš„è¾“å‡ºå…ˆäº b çº¿ç¨‹çš„è¾“å‡ºã€‚</p>\n<pre><code class=\"language-java\">public class JoinExample {\n\n    private class A extends Thread {\n        @Override\n        public void run() {\n            System.out.println(\"A\");\n        }\n    }\n\n    private class B extends Thread {\n\n        private A a;\n\n        B(A a) {\n            this.a = a;\n        }\n\n        @Override\n        public void run() {\n            try {\n                a.join();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(\"B\");\n        }\n    }\n\n    public void test() {\n        A a = new A();\n        B b = new B(a);\n        b.start();\n        a.start();\n    }\n}\n</code></pre>\n<pre><code class=\"language-java\">public static void main(String[] args) {\n    JoinExample example = new JoinExample();\n    example.test();\n}\n</code></pre>\n<pre><code class=\"language-java\">A\nB\n</code></pre>\n<h4 id=\"åŸç†\">åŸç†</h4>\n<p><img alt=\"\" src=\"https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202404251004601.gif\" /></p>\n<pre><code class=\"language-java\">public final synchronized void join(long millis)\nthrows InterruptedException {\n    long base = System.currentTimeMillis();\n    long now = 0;\n\n    if (millis &lt; 0) {\n        throw new IllegalArgumentException(\"timeout value is negative\");\n    }\n\n    if (millis == 0) {\n        while (isAlive()) {//æ£€æŸ¥çº¿ç¨‹æ˜¯å¦å­˜æ´»ï¼Œåªè¦çº¿ç¨‹è¿˜æ²¡ç»“æŸï¼Œä¸»çº¿ç¨‹å°±ä¼šä¸€ç›´é˜»å¡\n            wait(0);//è¿™é‡Œçš„waitè°ƒç”¨çš„æœ¬åœ°æ–¹æ³•ã€‚\n        }\n    } else {//ç­‰å¾…ä¸€æ®µæŒ‡å®šçš„æ—¶é—´\n        while (isAlive()) {\n            long delay = millis - now;\n            if (delay &lt;= 0) {\n                break;\n            }\n            wait(delay);\n            now = System.currentTimeMillis() - base;\n        }\n    }\n}\n</code></pre>\n<p>ä»æºç æ¥çœ‹ï¼Œå®é™…ä¸Šjoinæ–¹æ³•å°±æ˜¯è°ƒç”¨äº†waitæ–¹æ³•æ¥ä½¿å¾—çº¿ç¨‹é˜»å¡ï¼Œä¸€ç›´åˆ°çº¿ç¨‹ç»“æŸè¿è¡Œã€‚æ³¨æ„åˆ°ï¼Œjoinæ–¹æ³•å‰çš„synchronizedä¿®é¥°ç¬¦ï¼Œå®ƒç›¸å½“äºï¼š</p>\n<pre><code class=\"language-java\">public final void join(long millis){\n synchronized(this){\n        //ä»£ç å—\n    }\n}\n</code></pre>\n<p>ä¹Ÿå°±æ˜¯è¯´åŠ é”çš„å¯¹è±¡å³è°ƒç”¨è¿™ä¸ªé”çš„çº¿ç¨‹å¯¹è±¡ï¼Œåœ¨main()æ–¹æ³•ä¸­å³ä¸ºt1ï¼ŒæŒæœ‰è¿™ä¸ªé”çš„æ˜¯ä¸»çº¿ç¨‹å³main()æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ä»£ç ç›¸å½“äºå¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-java\">//t1.join()å‰çš„ä»£ç \nsynchronized (t1) {\n // è°ƒç”¨è€…çº¿ç¨‹è¿›å…¥ t1 çš„ waitSet ç­‰å¾…, ç›´åˆ° t1 è¿è¡Œç»“æŸ\n while (t1.isAlive()) {\n  t1.wait(0);\n }\n}\n//t1.join()åçš„ä»£ç \n</code></pre>\n<p>ä¹Ÿå› æ­¤ä¸»çº¿ç¨‹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œç›´åˆ° t1 çº¿ç¨‹ç»“æŸã€‚</p>\n<blockquote>\n<p>è¿™é‡Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šäººä¼šæœ‰ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆt1.waitäº†ï¼Œé˜»å¡çš„ä¸æ˜¯t1ï¼Œè€Œæ˜¯ä¸»çº¿ç¨‹ï¼Ÿ</p>\n<p>å®é™…ä¸Šï¼Œå¦‚æœè¦é˜»å¡t1ï¼Œé‚£ä¹ˆå°±åº”è¯¥åœ¨t1çš„run æ–¹æ³•é‡Œè¿›è¡Œé˜»å¡ï¼Œå¦‚åœ¨runæ–¹æ³•é‡Œå†™wait()ï¼›ï¼ˆå½“ç„¶è¿˜æœ‰suspendæ–¹æ³•ï¼Œè¿™å±äºéJavaå±‚é¢ï¼Œå¦è¯´ï¼‰</p>\n<p>è€Œè¿™é‡Œçš„ wait æ–¹æ³•è¢«è°ƒç”¨ä»¥åï¼Œæ˜¯è®©æŒæœ‰é”çš„çº¿ç¨‹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå³ä¸»çº¿ç¨‹è°ƒç”¨ï¼Œå› æ­¤ t1 çº¿ç¨‹å¹¶ä¸ä¼šè¢«é˜»å¡ï¼Œé˜»å¡çš„æ˜¯ä¸»çº¿ç¨‹ã€‚</p>\n</blockquote>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œjoinæ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼Œå½“ä¸»çº¿ç¨‹è°ƒç”¨t1.join()æ–¹æ³•æ—¶ï¼Œä¸»çº¿ç¨‹å…ˆè·å¾—äº†t1å¯¹è±¡çš„é”ï¼Œéšåè¿›å…¥æ–¹æ³•ï¼Œè°ƒç”¨äº†t1å¯¹è±¡çš„wait()æ–¹æ³•ï¼Œä½¿ä¸»çº¿ç¨‹è¿›å…¥äº†t1å¯¹è±¡çš„ç­‰å¾…æ± ã€‚</p>\n<p>é‚£ä¹ˆé—®é¢˜åœ¨äºï¼Œè¿™é‡Œåªçœ‹åˆ°äº†waitæ–¹æ³•ï¼Œå´å¹¶æ²¡æœ‰çœ‹åˆ°notifyæˆ–è€…æ˜¯notifyAllæ–¹æ³•ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹åœ¨é‚£é‡Œè¢«å”¤é†’å‘¢ï¼Ÿ</p>\n<p>è¿™é‡Œå‚è€ƒjvmçš„ä»£ç ï¼š</p>\n<pre><code class=\"language-java\">static void ensure_join(JavaThread* thread) {\n\n Handle threadObj(thread, thread-&gt;threadObj());\n\n ObjectLocker lock(threadObj, thread);\n\n hread-&gt;clear_pending_exception();\n\n //è¿™ä¸€å¥ä¸­çš„TERMINATEDè¡¨ç¤ºè¿™æ˜¯çº¿ç¨‹ç»“æŸä»¥åè¿è¡Œçš„\n java_lang_Thread::set_thread_status(threadObj(), java_lang_Thread::TERMINATED);\n\n    //è¿™é‡Œä¼šæ¸…æ¥šnativeçº¿ç¨‹ï¼ŒisAlive()æ–¹æ³•ä¼šè¿”å›false\n    java_lang_Thread::set_thread(threadObj(), NULL);\n\n //threadå°±æ˜¯å½“å‰çº¿ç¨‹ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚\n lock.notify_all(thread);\n\n hread-&gt;clear_pending_exception();\n\n}\n</code></pre>\n<p>å…¶å®æ˜¯jvmè™šæ‹Ÿæœºä¸­å­˜åœ¨æ–¹æ³•lock.notify_all(thread)ï¼Œåœ¨t1çº¿ç¨‹ç»“æŸä»¥åï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œæœ€åå”¤é†’ä¸»çº¿ç¨‹ã€‚</p>\n<p>æ‰€ä»¥ç®€åŒ–ä¸€ä¸‹ï¼Œæµç¨‹å³ï¼š</p>\n<p><img alt=\"\" src=\"https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202404251004626.gif\" /></p>\n<h3 id=\"wait-notify-notifyall\">wait() notify() notifyAll()</h3>\n<p>è°ƒç”¨ wait() ä½¿å¾—çº¿ç¨‹ç­‰å¾…æŸä¸ªæ¡ä»¶æ»¡è¶³ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…æ—¶ä¼šè¢«æŒ‚èµ·ï¼Œå½“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œä½¿å¾—è¿™ä¸ªæ¡ä»¶æ»¡è¶³æ—¶ï¼Œå…¶å®ƒçº¿ç¨‹ä¼šè°ƒç”¨ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ã€‚</p>\n<p>å®ƒä»¬éƒ½å±äº Object çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸å±äº Threadã€‚</p>\n<p>åªèƒ½ç”¨åœ¨åŒæ­¥æ–¹æ³•synchronizedæˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡º IllegalMonitorStateExeceptionã€‚</p>\n<p>ä½¿ç”¨ wait() æŒ‚èµ·æœŸé—´ï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾é”ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœæ²¡æœ‰é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±æ— æ³•è¿›å…¥å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ï¼Œé‚£ä¹ˆå°±æ— æ³•æ‰§è¡Œ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ï¼Œé€ æˆæ­»é”ã€‚</p>\n<pre><code class=\"language-java\">public class WaitNotifyExample {\n    public synchronized void before() {\n        System.out.println(\"before\");\n        notifyAll();\n    }\n\n    public synchronized void after() {\n        try {\n            wait();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println(\"after\");\n    }\n}\n</code></pre>\n<pre><code class=\"language-java\">public static void main(String[] args) {\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    WaitNotifyExample example = new WaitNotifyExample();\n    executorService.execute(() -&gt; example.after());\n    executorService.execute(() -&gt; example.before());\n}\n</code></pre>\n<pre><code class=\"language-java\">before\nafter\n</code></pre>\n<p><strong>wait() å’Œ sleep() çš„åŒºåˆ«</strong></p>\n<ul>\n<li>\n<p>wait() æ˜¯ Object çš„æ–¹æ³•ï¼Œè€Œ sleep() æ˜¯ Thread çš„é™æ€æ–¹æ³•ï¼›</p>\n</li>\n<li>\n<p>wait() ä¼šé‡Šæ”¾é”ï¼Œsleep() ä¸ä¼šã€‚</p>\n</li>\n</ul>\n<h3 id=\"await-signal-signalall\">await() signal() signalAll()</h3>\n<p>java.util.concurrent ç±»åº“ä¸­æä¾›äº† Condition ç±»æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åè°ƒï¼Œå¯ä»¥åœ¨ Condition ä¸Šè°ƒç”¨ await() æ–¹æ³•ä½¿çº¿ç¨‹ç­‰å¾…ï¼Œå…¶å®ƒçº¿ç¨‹è°ƒç”¨ signal() æˆ– signalAll() æ–¹æ³•å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚ç›¸æ¯”äº wait() è¿™ç§ç­‰å¾…æ–¹å¼ï¼Œawait() å¯ä»¥æŒ‡å®šç­‰å¾…çš„æ¡ä»¶ï¼Œå› æ­¤æ›´åŠ çµæ´»ã€‚</p>\n<p>ä½¿ç”¨ Lock æ¥è·å–ä¸€ä¸ª Condition å¯¹è±¡ã€‚</p>\n<pre><code class=\"language-java\">public class AwaitSignalExample {\n    private Lock lock = new ReentrantLock();\n    private Condition condition = lock.newCondition();\n\n    public void before() {\n        lock.lock();\n        try {\n            System.out.println(\"before\");\n            condition.signalAll();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public void after() {\n        lock.lock();\n        try {\n            condition.await();\n            System.out.println(\"after\");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n</code></pre>\n<pre><code class=\"language-java\">public static void main(String[] args) {\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    AwaitSignalExample example = new AwaitSignalExample();\n    executorService.execute(() -&gt; example.after());\n    executorService.execute(() -&gt; example.before());\n}\n</code></pre>\n<pre><code class=\"language-java\">before\nafter\n</code></pre>\n<h2 id=\"çº¿ç¨‹ä¸­çš„å¼‚å¸¸å¤„ç†\">çº¿ç¨‹ä¸­çš„å¼‚å¸¸å¤„ç†</h2>\n<h3 id=\"runnableä¸­å¼‚å¸¸å¦‚ä½•è¢«åæ‰\">Runnableä¸­å¼‚å¸¸å¦‚ä½•è¢«åæ‰</h3>\n<p><code>Runnable</code> æ¥å£çš„ <code>run()</code> æ–¹æ³•ä¸å…è®¸æŠ›å‡ºä»»ä½•è¢«æ£€æŸ¥çš„å¼‚å¸¸ï¼ˆchecked exceptionsï¼‰ï¼Œåªèƒ½å¤„ç†æˆ–æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆunchecked exceptionsï¼‰ã€‚å½“åœ¨ <code>run()</code> æ–¹æ³•å†…å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼åœ°æ•è·å’Œå¤„ç†è¿™äº›å¼‚å¸¸ï¼Œå®ƒä»¬é€šå¸¸ä¼šåœ¨æ‰§è¡Œè¯¥ <code>Runnable</code> çš„çº¿ç¨‹ä¸­è¢«â€œåæ‰â€ï¼Œå³å¼‚å¸¸ä¼šå¯¼è‡´çº¿ç¨‹ç»ˆæ­¢ï¼Œä½†ä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œã€‚</p>\n<pre><code class=\"language-java\">public void uncaughtException(Thread t, Throwable e) {\n   if (parent != null) {\n        parent.uncaughtException(t, e);\n   } else {\n        Thread.UncaughtExceptionHandler ueh =\n            Thread.getDefaultUncaughtExceptionHandler();\n        if (ueh != null) {\n            ueh.uncaughtException(t, e);\n        } else if (!(e instanceof ThreadDeath)) {\n            System.err.print(\"Exception in thread \\\"\"\n                             + t.getName() + \"\\\" \");\n            e.printStackTrace(System.err);\n        }\n    }\n}\n</code></pre>\n<p>è§£å†³æ–¹æ¡ˆï¼š</p>\n<ol>\n<li>\n<p>åœ¨runæ–¹æ³•ä¸­æ˜¾ç¤ºçš„æ•è·å¼‚å¸¸</p>\n<pre><code class=\"language-java\">public void run() {\n    try {\n        // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç \n    } catch (Exception e) {\n        // è®°å½•æ—¥å¿—æˆ–å¤„ç†å¼‚å¸¸\n        throw new RuntimeException(e);\n    }\n}\n</code></pre>\n</li>\n<li>\n<p>ä¸ºåˆ›å»ºçš„çº¿ç¨‹è®¾ç½®ä¸€ä¸ª<code>UncaughtExceptionHandler</code></p>\n<pre><code class=\"language-java\">Thread t = new Thread(() -&gt; {\n   int i = 1 / 0;\n}, \"t1\");\nt.setUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {\n   @Override\n   public void uncaughtException(Thread t, Throwable e) {\n        logger.error('---', e);\n   }\n});\n</code></pre>\n</li>\n<li>\n<p>ä½¿ç”¨<code>Callable</code>ä»£æ›¿<code>Runnable</code>ï¼Œ<code>Callable</code>çš„<code>call</code>æ–¹æ³•å…è®¸æŠ›å‡ºå¼‚å¸¸ï¼Œç„¶åå¯ä»¥é€šè¿‡æäº¤ç»™<code>ExecutorService</code>è¿”å›çš„<code>Future</code>æ¥æ•è·å’Œå¤„ç†è¿™äº›å¼‚å¸¸</p>\n<pre><code class=\"language-java\">ExecutorService executor = Executors.newFixedThreadPool(1);\nFuture&lt;?&gt; future = executor.submit(() -&gt; {\n    // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç \n});\n\ntry {\n    future.get(); // è¿™é‡Œä¼šæ•è·åˆ°Callableä¸­çš„å¼‚å¸¸\n} catch (ExecutionException e) {\n    Throwable cause = e.getCause(); // è·å–åŸå§‹å¼‚å¸¸\n}\n</code></pre>\n</li>\n</ol>\n<h3 id=\"callableä¸­å¼‚å¸¸å¦‚ä½•è¢«åæ‰\">Callableä¸­å¼‚å¸¸å¦‚ä½•è¢«åæ‰</h3>\n<pre><code class=\"language-java\">class MyCallable implements Callable&lt;String&gt; {\n    @Override\n    public String call() throws Exception {\n        System.out.println(\"===&gt; å¼€å§‹æ‰§è¡Œcallable\");\n        int i = 1 / 0; //å¼‚å¸¸çš„åœ°æ–¹\n        return \"callableçš„ç»“æœ\";\n    }\n}\n\npublic class CallableAndRunnableTest {\n\n    public static void main(String[] args) {\n        System.out.println(\" =========&gt; main start \");\n        ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(3, 5, 1, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;&gt;(100));\n        Future&lt;String&gt; submit = threadPoolExecutor.submit(new MyCallable());\n        try {\n            TimeUnit.SECONDS.sleep(2);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println(\" =========&gt; main end \");\n    }\n}\n</code></pre>\n<p>è¿è¡Œç»“æœ</p>\n<pre><code class=\"language-java\"> =========&gt; main start \n ===&gt; å¼€å§‹æ‰§è¡Œcallable\n =========&gt; main end \n</code></pre>\n<p>æºç å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-java\">public &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task) {\n    if (task == null) throw new NullPointerException();\n    RunnableFuture&lt;T&gt; ftask = newTaskFor(task);\n    execute(ftask);\n    return ftask;\n}\n\nprotected &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Callable&lt;T&gt; callable) {\n    return new FutureTask&lt;T&gt;(callable);\n}\n</code></pre>\n<p><code>RunableFuture&lt;T&gt;</code> æ˜¯ä¸ªæ¥å£ï¼Œä½†æ˜¯å®ƒç»§æ‰¿äº†Runnable æ¥å£ ï¼Œ å®ç°ç±»æ˜¯ FutureTask ï¼Œå› æ­¤å°±éœ€è¦çœ‹ä¸‹ FutureTaské‡Œçš„runæ–¹æ³• æ˜¯ä¸æ˜¯å’Œ æ„é€ æ—¶çš„Callable æœ‰å…³ç³»ï¼š</p>\n<pre><code class=\"language-java\">public void run() {\n     // çŠ¶æ€ä¸å±äºåˆå§‹çŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œä¸è¿›è¡Œåç»­é€»è¾‘å¤„ç†\n     // é‚£ä¹Ÿå°±æ˜¯run æ–¹æ³•åªèƒ½æ‰§è¡Œä¸€æ¬¡\n     if (state != NEW ||\n        !UNSAFE.compareAndSwapObject(this, runnerOffset,\n                                   null, Thread.currentThread()))\n        return;\n    try { \n        Callable&lt;V&gt; c = callable;\n        if (c != null &amp;&amp; state == NEW) {\n            V result;\n            // \n            boolean ran;\n            try {\n                // æ‰§è¡Œ Callable é‡Œçš„ call æ–¹æ³• ï¼Œå°†ç»“æœå­˜å…¥resultå˜é‡ä¸­\n                result = c.call();\n                ran = true;\n            } catch (Throwable ex) {\n                result = null;\n                ran = false;\n                 // call æ–¹æ³•å¼‚å¸¸ ï¼Œ è®°å½•ä¸‹å¼‚å¸¸ç»“æœ\n                setException(ex);\n            }\n            // call æ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯• ï¼Œè¿›è¡Œç»“æœå­˜å‚¨\n            if (ran)\n                set(result);\n        }\n    } finally {\n        // runner must be non-null until state is settled to\n        // prevent concurrent calls to run()\n        runner = null;\n        // state must be re-read after nulling runner to prevent\n        // leaked interrupts\n        int s = state;\n        if (s &gt;= INTERRUPTING)\n            handlePossibleCancellationInterrupt(s);\n    }\n}\n</code></pre>\n<p>æ¥ä¸‹æ¥å°±è¦çœ‹ï¼Œå¦‚æœå­˜å‚¨æ­£å¸¸ç»“æœçš„<code>set(result)</code>æ–¹æ³• å’Œå­˜å‚¨å¼‚å¸¸ç»“æœçš„ <code>setException(ex)</code> æ–¹æ³•</p>\n<pre><code class=\"language-java\">protected void setException(Throwable t) {\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        outcome = t;\n        UNSAFE.putOrderedInt(this, stateOffset, EXCEPTIONAL); // final state\n        finishCompletion();\n    }\n}\n\nprotected void set(V v) {\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        outcome = v;\n        UNSAFE.putOrderedInt(this, stateOffset, NORMAL); // final state\n        finishCompletion();\n    }\n}\n</code></pre>\n<p>è¿™ä¸¤ä¸ªä»£ç éƒ½åšäº†ä¸€ä¸ªæ“ä½œï¼Œå°±æ˜¯å°†æ­£å¸¸ç»“æœ<code>result</code> å’Œ å¼‚å¸¸ç»“æœ <code>exception</code> éƒ½èµ‹å€¼ç»™äº† <code>outcome</code> è¿™ä¸ªå˜é‡ ã€‚</p>\n<p>æ¥ç€å†çœ‹ä¸‹futureçš„getæ–¹æ³•</p>\n<pre><code class=\"language-java\">//è¿™é‡Œæœ‰å¿…é¡»çœ‹ä¸‹Taskçš„ç»“æŸæ—¶çš„çŠ¶æ€ï¼Œå¦‚æœæ­£å¸¸ç»“æŸï¼ŒçŠ¶æ€ä¸º NORMAL ï¼Œ å¼‚å¸¸ç»“æœï¼ŒçŠ¶æ€ä¸ºEXCEPTIONAL ã€‚ çœ‹ä¸‹å‡ ä¸ªçŠ¶æ€çš„å®šä¹‰ï¼Œå¦‚ä¸‹ï¼š  \nprivate volatile int state;\nprivate static final int NEW          = 0;\nprivate static final int COMPLETING   = 1;\nprivate static final int NORMAL       = 2;\nprivate static final int EXCEPTIONAL  = 3;\nprivate static final int CANCELLED    = 4;\nprivate static final int INTERRUPTING = 5;\nprivate static final int INTERRUPTED  = 6;\n\n/**\n* @throws CancellationException {@inheritDoc}\n*/\npublic V get() throws InterruptedException, ExecutionException {\n    int s = state;\n    // NORMAL(2) ã€EXCEPTIONAL(3) éƒ½å¤§äº COMPLETINGï¼ˆ1ï¼‰,æ‰€ä»¥Taskç»“æŸä¹‹åï¼Œä¸ä¼šèµ°è¯¥if\n    if (s &lt;= COMPLETING)\n         s = awaitDone(false, 0L);\n    // é‡ç‚¹ï¼š è¿”å›ç»“æœ\n    return report(s);\n}\n\nprivate V report(int s) throws ExecutionException {\n    // ä¹‹å‰æ­£å¸¸ç»“æœæˆ–è€…å¼‚å¸¸éƒ½å­˜æ”¾åœ¨Object outcomme ä¸­äº†\n    Object x = outcome;\n    // æ­£å¸¸è¿”å›\n    if (s == NORMAL)\n        return (V)x;\n    // EXCEPTIONAL(3) å°äº CANCELLED(4) ï¼Œæ‰€ä»¥ä¸ä¼šèµ°è¯¥ifåˆ†æ”¯ï¼Œç›´æ¥åç»­çš„throw æŠ›å¼‚å¸¸çš„é€»è¾‘\n    if (s &gt;= CANCELLED)\n        throw new CancellationException();\n    // ä¸ç­‰äºNORMAL ä¸” å¤§äºç­‰äº CANCELLED  ,  å†ç»“åˆ è°ƒç”¨ report(int s ) ä¹‹å‰ä¹Ÿåšäº†state çš„è¿‡æ»¤\n    //åˆ°è¿™ä¸€æ­¥ï¼Œé‚£åªèƒ½æ˜¯EXCEPTIONAL(3) \n    throw new ExecutionException((Throwable)x);\n}\n</code></pre>\n<p>å› æ­¤å¯ä»¥é€šè¿‡getæ–¹æ³•è·å–åˆ°å¼‚å¸¸ç»“æœ</p>\n\n\n</div>\n<div id=\"MySignature\">\n    <p>æœ¬æ–‡æ¥è‡ªåœ¨çº¿ç½‘ç«™ï¼šsevençš„èœé¸Ÿæˆé•¿ä¹‹è·¯ï¼Œä½œè€…ï¼šsevenï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼šwww.seven97.top</p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-02 09:00</span>&nbsp;\n<a href=\"https://www.cnblogs.com/sevencoding\">ç¨‹åºå‘˜Seven</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "PHP ç°åœ¨å¯ä»¥é›¶æˆæœ¬æ„å»ºåŸç”Ÿ iOS å’Œ Android åº”ç”¨ NativePHP for Mobile v3 å‘å¸ƒ",
      "link": "https://www.cnblogs.com/catchadmin/p/19562251",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/catchadmin/p/19562251\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-02 07:50\">\n    <span>PHP ç°åœ¨å¯ä»¥é›¶æˆæœ¬æ„å»ºåŸç”Ÿ iOS å’Œ Android åº”ç”¨ NativePHP for Mobile v3 å‘å¸ƒ</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"php-ç°åœ¨å¯ä»¥é›¶æˆæœ¬æ„å»ºåŸç”Ÿ-ios-å’Œ-android-åº”ç”¨-nativephp-for-mobile-v3-å‘å¸ƒ\">PHP ç°åœ¨å¯ä»¥é›¶æˆæœ¬æ„å»ºåŸç”Ÿ iOS å’Œ Android åº”ç”¨ NativePHP for Mobile v3 å‘å¸ƒ</h1>\n<p>NativePHP for Mobile ä» v3 ç‰ˆæœ¬å¼€å§‹ï¼Œæ ¸å¿ƒæ¡†æ¶é‡‡ç”¨ MIT åè®®å…è´¹å¼€æºã€‚Laravel/PHP å¼€å‘è€…ç°åœ¨å¯ä»¥é›¶æˆæœ¬æ„å»ºåŸç”Ÿ iOS å’Œ Android åº”ç”¨ã€‚</p>\n<p>å¦‚æœä½¿ç”¨ nativePHP å¼€å‘ç§»åŠ¨åº”ç”¨çš„è¯ï¼Œå¯ä»¥çœ‹<a href=\"https://nativephp-doc.catchadmin.com\" rel=\"noopener nofollow\" target=\"_blank\">nativephp mobile v3 ä¸­æ–‡æ–‡æ¡£</a></p>\n<h2 id=\"æ’ä»¶åŒ–æ¶æ„\">æ’ä»¶åŒ–æ¶æ„</h2>\n<p>v3 ç‰ˆæœ¬æœ€å¤§çš„å˜åŒ–æ˜¯å¼•å…¥äº†æ¨¡å—åŒ–æ’ä»¶ç³»ç»Ÿã€‚æ­¤å‰ç‰ˆæœ¬ä¸­é›†æˆåœ¨æ ¸å¿ƒåŒ…é‡Œçš„åŸç”ŸåŠŸèƒ½ï¼Œç°åœ¨è¢«æ‹†åˆ†æˆç‹¬ç«‹çš„æ’ä»¶ã€‚</p>\n<p>æ¯ä¸ªæ’ä»¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Composer åŒ…ï¼ŒåŒ…å« Swift å’Œ Kotlin ä»£ç ã€æƒé™æ¸…å•ä»¥åŠåŸç”Ÿä¾èµ–ã€‚å¼€å‘è€…åªéœ€å®‰è£…å®é™…ç”¨åˆ°çš„æ’ä»¶ï¼Œè¿™äº›æ’ä»¶ä¼šåœ¨æ„å»ºè¿‡ç¨‹ä¸­ç›´æ¥ç¼–è¯‘è¿›åº”ç”¨ã€‚</p>\n<p>æ’ä»¶å®‰è£…éå¸¸ç®€å•ï¼Œé€šè¿‡ <code>composer require</code> å®‰è£…åŒ…åï¼Œåœ¨ <code>NativeServiceProvider</code> ä¸­æ³¨å†Œå³å¯ã€‚åªæœ‰æ³¨å†Œçš„æ’ä»¶æ‰ä¼šè¢«ç¼–è¯‘è¿›æœ€ç»ˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥ä¿æŒåº”ç”¨ä½“ç§¯ç²¾ç®€ï¼Œä¹Ÿæœ‰åŠ©äºé€šè¿‡åº”ç”¨å•†åº—å®¡æ ¸ã€‚</p>\n<h3 id=\"åˆ›å»ºæ’ä»¶\">åˆ›å»ºæ’ä»¶</h3>\n<p>æ’ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ Composer åŒ…ï¼Œåªæ˜¯å¤šäº†ä¸€äº›é¢å¤–é…ç½®ã€‚é€šè¿‡æ·»åŠ  <code>nativephp.json</code> æ–‡ä»¶ï¼Œå¼€å‘è€…å¯ä»¥å®šä¹‰ PHP ç±»ã€è§†å›¾æ–‡ä»¶ã€æ¡¥æ¥å‡½æ•°ã€åŸç”Ÿä¾èµ–ï¼ˆCocoaPodsã€Swift Packagesã€Gradleï¼‰ã€æƒé™å£°æ˜ã€JavaScript æ–‡ä»¶ç­‰ã€‚</p>\n<p>NativePHP æ ¸å¿ƒæä¾›äº†æ„å»ºé’©å­ã€ç”Ÿå‘½å‘¨æœŸé’©å­ã€æœåŠ¡æä¾›è€…æ³¨å†Œç­‰æœºåˆ¶ï¼Œè®©æ’ä»¶å¼€å‘ä½“éªŒæ›´åŠ é¡ºç•…ã€‚</p>\n<p>æ’ä»¶å¯ä»¥å‘å¸ƒåˆ° Packagistï¼Œä¹Ÿå¯ä»¥ä½œä¸ºé¡¹ç›®å†…éƒ¨ä»£ç ä½¿ç”¨ï¼Œæ— éœ€å‘å¸ƒåˆ°å…¬å…±ä»“åº“ã€‚è¿™æ„å‘³ç€åº”ç”¨çš„ Laravel ä»£ç åº“å¯ä»¥åŒ…å«æ„å»ºåŸç”Ÿåº”ç”¨æ‰€éœ€çš„ä¸€åˆ‡ã€‚</p>\n<h2 id=\"å…è´¹æ ¸å¿ƒ\">å…è´¹æ ¸å¿ƒ</h2>\n<p>æ–°æ¶æ„å°†æ ¸å¿ƒåŒ…ç²¾ç®€åˆ°æœ€å°åŒ–ï¼Œåº”ç”¨åªéœ€åŒ…å«å®é™…ä½¿ç”¨çš„åŠŸèƒ½ã€‚è¿™è®©åº”ç”¨é»˜è®¤å°±æ›´å°ã€æ›´é«˜æ•ˆï¼Œä¹Ÿé¿å…äº†åº”ç”¨å•†åº—å®¡æ ¸æ—¶å› åŒ…å«æœªä½¿ç”¨åŠŸèƒ½è€Œè¢«æ‹’çš„é—®é¢˜ã€‚</p>\n<p>NativePHP å›¢é˜Ÿå°† v3 ç‰ˆæœ¬å‘½åä¸º NativePHP Airï¼Œå¹¶å°†å…¶è½¬ä¸º MIT å¼€æºåè®®ã€‚v3 ä¹‹å‰çš„ç‰ˆæœ¬ä»ç„¶éµå¾ªåŸæœ‰çš„ Business Source Licenseã€‚</p>\n<p>æ ¸å¿ƒæ¡†æ¶å¼€æºåï¼Œç¤¾åŒºå¯ä»¥å‚ä¸è´¡çŒ®ï¼Œå›¢é˜Ÿæ¬¢è¿é’ˆå¯¹ iOS å’Œ Android æ ¸å¿ƒåº”ç”¨çš„ PRã€‚</p>\n<h3 id=\"å…è´¹æ’ä»¶\">å…è´¹æ’ä»¶</h3>\n<p>ä»¥ä¸‹æ’ä»¶å®Œå…¨å…è´¹å¼€æºï¼ˆMIT åè®®ï¼‰ï¼š</p>\n<ul>\n<li><strong>Browser</strong> - æµè§ˆå™¨åŠŸèƒ½</li>\n<li><strong>Camera</strong> - ç›¸æœºè°ƒç”¨</li>\n<li><strong>Device</strong> - è®¾å¤‡ä¿¡æ¯è·å–</li>\n<li><strong>Dialog</strong> - åŸç”Ÿå¯¹è¯æ¡†</li>\n<li><strong>File</strong> - æ–‡ä»¶æ“ä½œ</li>\n<li><strong>Microphone</strong> - éº¦å…‹é£è°ƒç”¨</li>\n<li><strong>Network</strong> - ç½‘ç»œçŠ¶æ€æ£€æµ‹</li>\n<li><strong>Share</strong> - ç³»ç»Ÿåˆ†äº«åŠŸèƒ½</li>\n<li><strong>System</strong> - ç³»ç»Ÿä¿¡æ¯</li>\n</ul>\n<h3 id=\"ä»˜è´¹æ’ä»¶\">ä»˜è´¹æ’ä»¶</h3>\n<p>ä»¥ä¸‹åŠŸèƒ½éœ€è¦å•ç‹¬è´­ä¹°æ’ä»¶ï¼ˆä¸€æ¬¡æ€§ä»˜è´¹ï¼Œå¯ç”¨äºæ— é™é¡¹ç›®ï¼‰ï¼š</p>\n<ul>\n<li><strong>Biometrics</strong> - ç”Ÿç‰©è¯†åˆ«ï¼ˆFace IDã€æŒ‡çº¹ï¼‰</li>\n<li><strong>Geolocation</strong> - åœ°ç†ä½ç½®</li>\n<li><strong>Push Notifications</strong> - æ¨é€é€šçŸ¥ï¼ˆåŸºäº Firebaseï¼‰</li>\n<li><strong>Scanner</strong> - æ‰«æå™¨</li>\n<li><strong>Secure Storage</strong> - å®‰å…¨å­˜å‚¨</li>\n</ul>\n<h2 id=\"æ’ä»¶å¸‚åœº\">æ’ä»¶å¸‚åœº</h2>\n<p>æ’ä»¶å¸‚åœºï¼ˆPlugin Marketplaceï¼‰å°†æ‰€æœ‰ NativePHP æ’ä»¶é›†ä¸­å±•ç¤ºï¼Œå¼€å‘è€…å¯ä»¥å‘ç°å…è´¹å’Œä»˜è´¹æ’ä»¶ã€‚</p>\n<p>æœªæ¥å‡ å‘¨ï¼Œå¸‚åœºå°†å‘ç¬¬ä¸‰æ–¹å¼€å‘è€…å¼€æ”¾ï¼Œå±Šæ—¶å¼€å‘è€…å¯ä»¥åœ¨ nativephp.com ä¸Šæ¶è‡ªå·±çš„æ’ä»¶ï¼Œç”šè‡³å¯ä»¥é”€å”®è‡ªå·±å¼€å‘çš„æ’ä»¶ã€‚ä¾‹å¦‚ç›¸æœºæ»¤é•œæ’ä»¶ã€æ”¯ä»˜ç½‘å…³é›†æˆã€ç¤¾äº¤ç™»å½•åŒ…ç­‰ã€‚</p>\n<h2 id=\"jumpå³æ—¶è®¾å¤‡æµ‹è¯•\">Jumpï¼šå³æ—¶è®¾å¤‡æµ‹è¯•</h2>\n<p>åœ¨çœŸæœºä¸Šæµ‹è¯•åº”ç”¨é€šå¸¸æ˜¯ä¸€ä¸ªç¼“æ…¢ä¸”ç¹ççš„è¿‡ç¨‹ï¼Œéœ€è¦å®‰è£…æ•° GB çš„è½¯ä»¶ã€æ¨¡æ‹Ÿå™¨å’Œæ¡†æ¶ã€‚è€Œä¸”ï¼Œæ²¡æœ‰ Mac å°±æ— æ³•ä¸º iPhone æ„å»ºå’Œæµ‹è¯•åº”ç”¨ã€‚</p>\n<p>Jump æ”¹å˜äº†è¿™ä¸€åˆ‡ã€‚</p>\n<p>Jump æ˜¯ä¸€ä¸ªå®‰è£…åœ¨æ‰‹æœºä¸Šçš„åº”ç”¨ï¼ˆæ”¯æŒ Android å’Œ iOSï¼‰ï¼Œå¯ä»¥åœ¨çœŸæœºä¸Šæµ‹è¯• NativePHP åº”ç”¨ï¼Œæ— éœ€ç¼–è¯‘ä»»ä½•ä¸œè¥¿ï¼Œä¹Ÿä¸éœ€è¦å¼€å¯å¼€å‘è€…æ¨¡å¼ã€‚</p>\n<p>åªéœ€è¿è¡Œ <code>native:jump</code> Artisan å‘½ä»¤ï¼Œæ‰“å¼€æ‰‹æœºä¸Šçš„ Jump åº”ç”¨æ‰«æäºŒç»´ç ï¼ŒLaravel åº”ç”¨å°±ä¼šç›´æ¥åŠ è½½åˆ°è®¾å¤‡ä¸Šï¼Œè¿æ¥åˆ°æœ¬åœ°å¼€å‘æœåŠ¡å™¨ã€‚</p>\n<pre><code class=\"language-shell\">php artisan native:jump\n\n# æˆ–è€…\n\n./native jump\n</code></pre>\n<p>NativePHP æ„å»ºé€Ÿåº¦å¾ˆå¿«ï¼Œæœ¬åœ°å¼€å‘ç¯å¢ƒçš„æ”¹åŠ¨å‡ ä¹å¯ä»¥å®æ—¶åæ˜ åˆ°è®¾å¤‡ä¸Šã€‚æœªæ¥è¿˜è®¡åˆ’æ”¯æŒå®Œæ•´çš„ HMRï¼ˆçƒ­æ¨¡å—æ›¿æ¢ï¼‰ã€‚</p>\n<p>Jump åº”ç”¨å®Œå…¨å…è´¹ï¼Œ<code>nativephp/mobile</code> v3 å·²åŒ…å«è¿è¡Œ Jump æ‰€éœ€çš„ä¸€åˆ‡ã€‚</p>\n<p>Jump åŒ…å«æ‰€æœ‰å®˜æ–¹ NativePHP æ’ä»¶ï¼ˆåŒ…æ‹¬ä»˜è´¹æ’ä»¶ï¼‰ï¼Œå¼€å‘è€…å¯ä»¥å…è´¹è¯•ç”¨å’Œå­¦ä¹ æ‰€æœ‰åŠŸèƒ½ã€‚å”¯ä¸€çš„é™åˆ¶æ˜¯ Jump æ— æ³•æµ‹è¯•ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚</p>\n<h2 id=\"mimiai-è¾…åŠ©ç¼–ç \">Mimiï¼šAI è¾…åŠ©ç¼–ç </h2>\n<p>Mimiï¼ˆå–è‡ªåŒ—æ¬§æ™ºæ…§ä¹‹ç¥ Mimirï¼‰æ˜¯ NativePHP æä¾›çš„ AI è¾…åŠ©ç¼–ç åŠŸèƒ½ï¼Œå¯ä»¥è®© AI æ¨¡å‹å¸®åŠ©ç¼–å†™ NativePHP åº”ç”¨ï¼š</p>\n<ul>\n<li>ç›´æ¥åœ¨æµè§ˆå™¨ä¸­åˆ›å»ºæ–°çš„ NativePHP é¡¹ç›®ï¼ˆç§»åŠ¨ç«¯ä¹Ÿå¯ä»¥ï¼‰</li>\n<li>ç”¨è‡ªç„¶è¯­è¨€æè¿°æƒ³è¦æ„å»ºçš„å†…å®¹ï¼Œæ”¯æŒè¯­éŸ³è¾“å…¥</li>\n<li>ç›´æ¥åœ¨ Jump ä¸­æµ‹è¯•åº”ç”¨</li>\n<li>è¿æ¥ GitHub ä»“åº“ï¼Œç«‹å³è·å–æ‰€æœ‰åº”ç”¨ä»£ç </li>\n</ul>\n<p>è¿™æ˜¯ä»æƒ³æ³•åˆ°å¯è¿è¡Œç§»åŠ¨åº”ç”¨çš„æœ€å¿«è·¯å¾„ï¼Œå®Œå…¨åŸºäº Laravelã€‚</p>\n<h2 id=\"å‡çº§æŒ‡å—\">å‡çº§æŒ‡å—</h2>\n<p>å¦‚æœå·²ç»å®‰è£…äº† <code>nativephp/mobile</code>ï¼Œå‡çº§åˆ° v3 çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>ä» <code>composer.json</code> ä¸­ç§»é™¤ NativePHP ä»“åº“ï¼ˆ<code>https://nativephp.composer.sh</code>ï¼‰</li>\n<li>è¿è¡Œ <code>composer remove nativephp/mobile</code> å¸è½½æ—§ç‰ˆæœ¬</li>\n<li>è¿è¡Œ <code>composer require nativephp/mobile</code> ä» Packagist å®‰è£… v3</li>\n<li>å®‰è£…åº”ç”¨ä¸­ä½¿ç”¨çš„åŠŸèƒ½å¯¹åº”çš„æ’ä»¶</li>\n</ol>\n<p>é™¤äº†æ³¨å†Œæ–°æ’ä»¶å¤–ï¼Œåº”ç”¨ä»£ç åŸºæœ¬ä¸éœ€è¦ä¿®æ”¹ã€‚å®‰è£…æ’ä»¶åå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ³¨å†Œï¼š</p>\n<pre><code class=\"language-shell\">php artisan native:plugin:register vendor/plugin\n\n# æˆ–è€…\n\n./native plugin:register vendor/plugin\n</code></pre>\n<h2 id=\"å¿«é€Ÿå¼€å§‹\">å¿«é€Ÿå¼€å§‹</h2>\n<p>NativePHP for Mobile v3 ç°å·²å‘å¸ƒã€‚åœ¨æ‰‹æœºä¸Šå®‰è£… Jumpï¼Œç„¶ååœ¨å¼€å‘ç¯å¢ƒä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n<pre><code class=\"language-shell\">laravel new my-mobile-app\ncd my-mobile-app\ncomposer require nativephp/mobile\nphp artisan native:jump\n</code></pre>\n<p>è¿™é‡Œé¢æœ‰å‡ ä¸ªå°å‘</p>\n<ul>\n<li>PHP è¦æ±‚ <code>&gt;=8.3</code></li>\n<li>åœ¨ windows ä¸Šæµ‹è¯•ï¼Œéœ€è¦å…ˆå®‰è£… <a href=\"https://www.7-zip.org/\" rel=\"noopener nofollow\" target=\"_blank\">7-zip</a></li>\n<li>æˆ‘åœ¨ IOS æ‰‹æœºæµ‹è¯•å¾—ï¼Œä½¿ç”¨ <code>php artisan native:jump</code> ä¹‹åä¼šå¼¹å‡ºä¸€ä¸ªäºŒç»´ç ï¼Œç”¨æ‰‹æœºä¸Šçš„ Jump æ‰«æå³å¯ã€‚è¿™ä¸ª Jump ç›®å‰åªèƒ½åœ¨ <code>TestFlight</code> ä¸Šå®‰è£…ï¼Œæ‰“å¼€è¿™ä¸ª<a href=\"https://testflight.apple.com/join/RuzFs4rJ\" rel=\"noopener nofollow\" target=\"_blank\">å®‰è£…é“¾æ¥</a>å³å¯ã€‚</li>\n</ul>\n<p>å¾ˆå®Œç¾ï¼Œè‡³å°‘ä»å®‰è£…ä¸Šåˆ°æµ‹è¯•æ•ˆæœéƒ½å¾ˆå¿«äº†ã€‚æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>\n<p><img alt=\"Laravel ç°åœ¨å¯ä»¥é›¶æˆæœ¬æ„å»ºåŸç”Ÿ iOS å’Œ Android åº”ç”¨ NativePHP for Mobile v3 å‘å¸ƒ\" class=\"lazyload\" /></p>\n<p><a href=\"https://catchadmin.com/post/2026-02/nativephp-mobile-free\" rel=\"noopener nofollow\" target=\"_blank\">åŸæ–‡ PHP ç°åœ¨å¯ä»¥é›¶æˆæœ¬æ„å»ºåŸç”Ÿ iOS å’Œ Android åº”ç”¨ NativePHP for Mobile v3 å‘å¸ƒ</a></p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-02 07:50</span>&nbsp;\n<a href=\"https://www.cnblogs.com/catchadmin\">JaguarJack</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">39</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": ".NET AI ç”Ÿæ€ç³»ç»Ÿçš„é‡æ„ä¸æ¼”è¿›ï¼šMicrosoft Agent Framework å¯¹ Semantic Kernel çš„ç»§æ‰¿ã€è¶…è¶Šä¸æˆ˜ç•¥æ•´åˆ",
      "link": "https://www.cnblogs.com/shanyou/p/19562239",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/shanyou/p/19562239\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-02 07:45\">\n    <span>.NET AI ç”Ÿæ€ç³»ç»Ÿçš„é‡æ„ä¸æ¼”è¿›ï¼šMicrosoft Agent Framework å¯¹ Semantic Kernel çš„ç»§æ‰¿ã€è¶…è¶Šä¸æˆ˜ç•¥æ•´åˆ</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        é€šè¿‡å¯¹ Microsoft Agent Framework çš„æ·±åº¦è°ƒæŸ¥å¯ä»¥å‘ç°ï¼Œ.NET AI ç”Ÿæ€ç³»ç»Ÿæ­£åœ¨ç»å†ä¸€åœºä»â€œåŠŸèƒ½é›†æˆâ€å‘â€œä»£ç†åŸç”Ÿâ€çš„èœ•å˜ã€‚å¾®è½¯é€šè¿‡æ•´åˆ Semantic Kernel çš„å·¥ç¨‹åŸºå› ä¸ AutoGen çš„åˆ›æ–°çµé­‚ï¼Œä¸ä»…æä¾›äº†ä¸€ä¸ªæ›´å¼ºå¤§çš„å¼€å‘å·¥å…·ï¼Œæ›´æ˜¯åœ¨.NET å¹³å°ä¸Šç¡®ç«‹äº†ä¸€å¥—å…³äº AI ä»£ç†å¦‚ä½•æ€è€ƒã€åä½œã€è®°å¿†å’Œæ‰§è¡Œçš„æ ‡å‡†ã€‚\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h2 id=\"1-æ™ºèƒ½è½¯ä»¶å·¥ç¨‹çš„èŒƒå¼è½¬ç§»ä»åº“é›†æˆåˆ°åŸç”Ÿæ¡†æ¶æ¼”è¿›\"><strong>1. æ™ºèƒ½è½¯ä»¶å·¥ç¨‹çš„èŒƒå¼è½¬ç§»ï¼šä»åº“é›†æˆåˆ°åŸç”Ÿæ¡†æ¶æ¼”è¿›</strong></h2>\n<p>åœ¨ç”Ÿæˆå¼äººå·¥æ™ºèƒ½ï¼ˆGenerative AIï¼‰ä»å•çº¯çš„æ–‡æœ¬ç”Ÿæˆå‘å…·å¤‡è‡ªä¸»è§„åˆ’ä¸æ‰§è¡Œèƒ½åŠ›çš„â€œä»£ç†åŒ–ï¼ˆAgenticï¼‰â€ç³»ç»Ÿè·¨è¶Šçš„è¿‡ç¨‹ä¸­ï¼Œ.NET ç”Ÿæ€ç³»ç»Ÿæ­£åœ¨ç»å†ä¸€åœºè‡ªè¯¥å¹³å°è¯ç”Ÿä»¥æ¥æœ€æ·±åˆ»çš„æ¶æ„é‡æ„ã€‚è¿™ç§é‡æ„ä¸ä»…ä½“ç°åœ¨å·¥å…·é“¾çš„æ›´æ–°ä¸Šï¼Œæ›´ä½“ç°åœ¨åº•å±‚è®¾è®¡å“²å­¦çš„æ ¹æœ¬è½¬å˜ï¼šä»å°†äººå·¥æ™ºèƒ½è§†ä¸ºä¸€ç§â€œå¤–éƒ¨è°ƒç”¨çš„åº“ï¼ˆLibraryï¼‰â€ï¼Œæ¼”è¿›ä¸ºå°† AI ä»£ç†è§†ä¸ºä¸€ç§â€œåŸç”Ÿçš„ä¸€ç­‰å…¬æ°‘ï¼ˆFirst-class Citizenï¼‰â€è½¯ä»¶ç»„ä»¶ ã€‚</p>\n<p>å›é¡¾è¿‡å»ä¸¤å¹´çš„å‘å±•ï¼Œ.NET å¼€å‘è€…åœ¨æ„å»º AI åº”ç”¨æ—¶é•¿æœŸé¢ä¸´ç€ä¸¥é‡çš„å·¥å…·é“¾ç¢ç‰‡åŒ–é—®é¢˜ã€‚æ—©æœŸç”±å¾®è½¯æ¨å‡ºçš„ Semantic Kernel è™½ç„¶åœ¨ä¼ä¸šçº§é›†æˆä¸­å æ®äº†å…ˆæœºï¼Œä½†éšç€ç ”ç©¶é¢†åŸŸå¦‚ AutoGen ç­‰å¤šä»£ç†ååŒæ¨¡å¼çš„å…´èµ·ï¼Œå¼€å‘è€…ä¸å¾—ä¸é¢ä¸´åœ¨â€œç¨³å®šé›†æˆâ€ä¸â€œå‰æ²¿ç ”ç©¶â€ä¹‹é—´çš„è‰°éš¾é€‰æ‹©ã€‚è¿™ç§ç¢ç‰‡åŒ–å¯¼è‡´äº†æé«˜çš„å·¥ç¨‹æˆæœ¬ï¼Œç›¸å…³è¡Œä¸šè°ƒæŸ¥æ˜¾ç¤ºï¼Œçº¦æœ‰ 50% çš„å¼€å‘è€…æ¯å‘¨å› å·¥å…·é“¾çš„ä¸è¿ç»­æ€§å’Œ API çš„ä¸ä¸€è‡´æ€§è€ŒæŸå¤±è¶…è¿‡ 10 ä¸ªå°æ—¶çš„ç”Ÿäº§åŠ›ã€‚</p>\n<p>ä¸ºäº†æ¶ˆé™¤è¿™ç§ç¢ç‰‡åŒ–ï¼Œå¾®è½¯åœ¨ 2025 å¹´åº•æ­£å¼æ¨å‡ºäº† Microsoft Agent Frameworkï¼ˆä»¥ä¸‹ç®€ç§° MAFï¼‰ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ–°æ¡†æ¶çš„å‘å¸ƒï¼Œæ›´æ˜¯.NET AI ç”Ÿæ€ç³»ç»Ÿçš„ä¸€æ¬¡æˆ˜ç•¥æ€§å¤§ä¸€ç»Ÿã€‚å®ƒå°† Semantic Kernel çš„ä¼ä¸šçº§å·¥ç¨‹åº•åº§ä¸ AutoGen çš„åˆ›æ–°æ€§å¤šä»£ç†ç¼–æ’æ¨¡å¼è¿›è¡Œäº†æ·±åº¦èåˆï¼Œæ ‡å¿—ç€.NET å¹³å°ä¸Šçš„ AI ä»£ç†å¼€å‘å·²ä»â€œå®éªŒæ€§åŸå‹â€é˜¶æ®µæ­£å¼è¿›å…¥â€œå·¥ä¸šåŒ–ç”Ÿäº§â€é˜¶æ®µ ã€‚è¿™ç§æ¼”è¿›èƒŒåéšè—ç€ä¸€ä¸ªæ˜ç¡®çš„ä¿¡å·ï¼šæœªæ¥çš„ AI å¼€å‘å°†ä¸å†ä¾èµ–äºå­¤ç«‹çš„ã€å‚å•†ç»‘å®šçš„ SDKï¼Œè€Œæ˜¯åŸºäºä¸€ç³»åˆ—æ ‡å‡†åŒ–çš„ã€å¯äº’æ“ä½œçš„ BCLï¼ˆåŸºç±»åº“ï¼‰æ‰©å±•ã€‚</p>\n<h2 id=\"2-æ ¸å¿ƒäº‰ç«¯è§£æmicrosoft-agent-framework-æ˜¯å¦å·²å–ä»£-semantic-kernel\"><strong>2. æ ¸å¿ƒäº‰ç«¯è§£æï¼šMicrosoft Agent Framework æ˜¯å¦å·²å–ä»£ Semantic Kernel</strong></h2>\n<p>é’ˆå¯¹ä¸šç•Œå…³äº Microsoft Agent Framework ä¸ Semantic Kernel å…³ç³»çš„ç–‘è™‘ï¼Œç›®å‰çš„è¯æ®å’Œå®˜æ–¹é™ˆè¿°æä¾›äº†ä¸€ä¸ªæ¸…æ™°çš„ç»“è®ºï¼š<strong>Microsoft Agent Framework æ˜¯ Semantic Kernel åœ¨ AI ä»£ç†æ„å»ºé¢†åŸŸçš„å®˜æ–¹ç»§ä»»è€…ï¼Œå…¶æœ¬è´¨ä¸Šåº”è¢«è§†ä¸º Semantic Kernel çš„ 2.0 ç‰ˆæœ¬æˆ–ä»£ç†æ ¸å¿ƒçš„æ·±åº¦é‡æ„ç‰ˆ</strong>ã€‚</p>\n<h3 id=\"21-æ¡†æ¶åœ°ä½çš„æˆ˜ç•¥æ€§æ›´æ›¿\"><strong>2.1 æ¡†æ¶åœ°ä½çš„æˆ˜ç•¥æ€§æ›´æ›¿</strong></h3>\n<p>å¾®è½¯å®˜æ–¹å·²æ˜ç¡®å°† Microsoft Agent Framework å®šä¹‰ä¸ºæ„å»ºã€éƒ¨ç½²å’Œç®¡ç† AI ä»£ç†çš„ç»Ÿä¸€ã€ä¼ä¸šçº§å¹³å°ã€‚å¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œæœ€å…³é”®çš„å˜åŒ–åœ¨äº Semantic Kernel åŸæœ‰çš„å…³äºä»£ç†ï¼ˆAgentï¼‰å’Œå¤šä»£ç†ç¼–æ’ï¼ˆOrchestrationï¼‰çš„åŠŸèƒ½æ¨¡å—å·²ç»æ•´ä½“è¿ç§»å¹¶æ¼”è¿›åˆ°äº† MAF ä¸­ã€‚è™½ç„¶ Semantic Kernel ä½œä¸ºä¸€ä¸ª SDK ä¾ç„¶å­˜åœ¨ï¼Œä½†å…¶å®šä½å·²ä»â€œä¸‡èƒ½çš„ AI SDKâ€è½¬å˜ä¸ºæ›´ä¾§é‡äºåŸºç¡€ AI åŠŸèƒ½é›†æˆå’Œæ—§ç‰ˆåº”ç”¨ç»´æŠ¤çš„å·¥å…·ã€‚</p>\n<p>åœ¨è¿™ä¸€è½¬å˜è¿‡ç¨‹ä¸­ï¼Œå¾®è½¯é‡‡ç”¨äº†å…¸å‹çš„è½¯ä»¶ç”Ÿå‘½å‘¨æœŸæ›´è¿­ç­–ç•¥ã€‚Semantic Kernel v1.x å·²æ­£å¼è¿›å…¥ç»´æŠ¤æ¨¡å¼ã€‚è¿™æ„å‘³ç€è™½ç„¶å¾®è½¯ä»ä¼šç»§ç»­è§£å†³ v1.x ä¸­çš„å…³é”®æ¼æ´å’Œå®‰å…¨é—®é¢˜ï¼Œå¹¶ç¡®ä¿ç°æœ‰åŠŸèƒ½è¾¾åˆ°æ­£å¼å‘å¸ƒï¼ˆGAï¼‰çŠ¶æ€ï¼Œä½†æœªæ¥çš„ç»å¤§å¤šæ•°æ–°åŠŸèƒ½å¼€å‘éƒ½å°†é›†ä¸­åœ¨ Microsoft Agent Framework å¹³å°ä¸Š ã€‚è¿™ç§â€œæ–°è€äº¤æ›¿â€çš„æ€åŠ¿ä¸‹è¡¨è¿›è¡Œäº†è¯¦ç»†å¯¹æ¯”ï¼š</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: left;\">ç»´åº¦</th>\n<th style=\"text-align: left;\">Semantic Kernel (v1.x)</th>\n<th style=\"text-align: left;\">Microsoft Agent Framework (MAF)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\"><strong>æˆ˜ç•¥å®šä½</strong></td>\n<td style=\"text-align: left;\">è½»é‡çº§ã€æ¨¡å‹ä¸å¯çŸ¥çš„ AI é›†æˆ SDK</td>\n<td style=\"text-align: left;\">ç»Ÿä¸€çš„ã€å·¥ä¸šçº§ä»£ç†ä¸å¤šä»£ç†å·¥ä½œæµå¹³å°</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>æ ¸å¿ƒè¡€ç»Ÿ</strong></td>\n<td style=\"text-align: left;\">ä¼ä¸šçº§å·¥ç¨‹åŒ–æ¨¡å¼</td>\n<td style=\"text-align: left;\">Semantic Kernel ä¼ä¸šåœ°åŸº + AutoGen ç ”ç©¶åŸºå› </td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>ç»´æŠ¤çŠ¶æ€</strong></td>\n<td style=\"text-align: left;\">ç»´æŠ¤æ¨¡å¼ï¼šè§£å†³æ¼æ´ä¸å®‰å…¨æ€§ï¼Œä¸å†å¢åŠ é‡å¤§åŠŸèƒ½</td>\n<td style=\"text-align: left;\">æ´»è·ƒå¼€å‘ï¼šä½œä¸ºå¾®è½¯ AI æˆ˜ç•¥çš„å”¯ä¸€ä»£ç†å¼€å‘å…¥å£</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>åº•å±‚æŠ½è±¡</strong></td>\n<td style=\"text-align: left;\">æ—©æœŸä¸ºè‡ªå®šä¹‰æŠ½è±¡ï¼Œåé€æ­¥å‘ MEAI é æ‹¢</td>\n<td style=\"text-align: left;\">åŸç”Ÿæ„å»ºåœ¨ Microsoft.Extensions.AI (MEAI) ä¹‹ä¸Š</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>ä¸»è¦åº”ç”¨åœºæ™¯</strong></td>\n<td style=\"text-align: left;\">ç°æœ‰ä¸šåŠ¡ç³»ç»Ÿçš„ç®€å• AI åŠŸèƒ½å¢å¼º</td>\n<td style=\"text-align: left;\">å¤æ‚çš„ã€å…·å¤‡çŠ¶æ€æ„ŸçŸ¥å’Œå¤šä»£ç†ååŒçš„è‡ªä¸»ç³»ç»Ÿ</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"22-ç»´æŠ¤æ‰¿è¯ºä¸è¿‡æ¸¡çª—å£\"><strong>2.2 ç»´æŠ¤æ‰¿è¯ºä¸è¿‡æ¸¡çª—å£</strong></h3>\n<p>ä¸ºäº†ä¿æŠ¤ä¼ä¸šç”¨æˆ·çš„æ—©æœŸæŠ•èµ„ï¼Œå¾®è½¯æ‰¿è¯ºåœ¨ Microsoft Agent Framework ç¦»å¼€é¢„è§ˆç‰ˆå¹¶è¿›å…¥ GA é˜¶æ®µåï¼Œä»å°†ä¸º Semantic Kernel v1.x æä¾›è‡³å°‘ä¸€å¹´çš„æŒç»­æ”¯æŒã€‚å¯¹äºç°æœ‰çš„ Semantic Kernel é¡¹ç›®ï¼Œå¼€å‘è€…å¹¶ä¸éœ€è¦ç«‹å³è¿›è¡Œé«˜é£é™©çš„ä»£ç é‡æ„ï¼›ä½†å¯¹äºä»»ä½•æ–°å¯åŠ¨çš„ã€æ—¨åœ¨æ„å»ºå…·å¤‡è‡ªä¸»è¡Œä¸ºå’Œå¤æ‚é€»è¾‘çš„ AI ç³»ç»Ÿé¡¹ç›®ï¼ŒMAF å·²æˆä¸ºå”¯ä¸€çš„å®˜æ–¹æ¨èè·¯å¾„ã€‚</p>\n<h2 id=\"3net-ai-ç”Ÿæ€ç³»ç»Ÿçš„æ ¸å¿ƒæ„å»ºæ¨¡å—ä¸æœ€æ–°æ¼”è¿›\"><strong>3..NET AI ç”Ÿæ€ç³»ç»Ÿçš„æ ¸å¿ƒæ„å»ºæ¨¡å—ä¸æœ€æ–°æ¼”è¿›</strong></h2>\n<p>åœ¨ MAF ä½œä¸ºåº”ç”¨å±‚æ¡†æ¶å´›èµ·çš„èƒŒåï¼Œæ˜¯.NET åº•å±‚åŸºç¡€è®¾æ–½çš„ä¸€æ¬¡â€œé™é»˜é©å‘½â€ã€‚å¾®è½¯æ­£åœ¨é€šè¿‡ä¸€ç³»åˆ— Microsoft.Extensions å‘½åç©ºé—´ä¸‹çš„åº“ï¼Œå°† AI çš„æ ¸å¿ƒèƒ½åŠ›ï¼ˆå¦‚å¯¹è¯ã€å‘é‡å¤„ç†ã€æ€§èƒ½è®¡ç®—ï¼‰æ ‡å‡†åŒ–ï¼Œè¿™ä½¿å¾—.NET å¼€å‘è€…èƒ½å¤Ÿæ‘†è„±å¯¹ç‰¹å®š AI å‚å•† SDK çš„ä¾èµ–ã€‚</p>\n<h3 id=\"31-microsoftextensionsai-meaiæ ‡å‡†åŒ–çš„-llm-æ¥å…¥åè®®\"><strong>3.1 Microsoft.Extensions.AI (MEAI)ï¼šæ ‡å‡†åŒ–çš„ LLM æ¥å…¥åè®®</strong></h3>\n<p>MEAI çš„å¼•å…¥æ˜¯.NET AI ç”Ÿæ€æ¼”è¿›ä¸­æœ€å…·é‡Œç¨‹ç¢‘æ„ä¹‰çš„äº‹ä»¶ä¹‹ä¸€ã€‚å®ƒå°†åŸæœ¬åœ¨å„ä¸ªæ¡†æ¶ï¼ˆå¦‚ Semantic Kernelã€LangChain.NETï¼‰ä¸­å„è‡ªä¸ºæ”¿çš„æ¨¡å‹äº¤äº’åŸè¯­æå–å‡ºæ¥ï¼Œå½¢æˆäº†ä¸€å¥—ç»Ÿä¸€çš„ BCL æ‰©å±•ã€‚</p>\n<p>MEAI çš„æ ¸å¿ƒæ˜¯ IChatClient æ¥å£ï¼Œå®ƒä¸ä»…å®šä¹‰äº†å¯¹è¯è¡¥å…¨ã€æµå¼å¤„ç†å’Œå·¥å…·è°ƒç”¨çš„æ ‡å‡†è·¯å¾„ï¼Œè¿˜å¼•å…¥äº†å¼ºå¤§çš„ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰æ¨¡å¼ ã€‚é€šè¿‡è¿™ç§æ¨¡å¼ï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾åœ°åœ¨è¯·æ±‚æµæ°´çº¿ä¸­æ’å…¥é¥æµ‹ï¼ˆTelemetryï¼‰ã€æ—¥å¿—ï¼ˆLoggingï¼‰ã€ç¼“å­˜ï¼ˆCachingï¼‰ä»¥åŠå†…å®¹è¿‡æ»¤ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œè€Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ 6ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒMEAI å·²ç»è·å¾—äº†åŒ…æ‹¬ OpenAIã€Azure OpenAIã€Ollama ç­‰ä¸»æµæä¾›å•†çš„é€‚é…å™¨æ”¯æŒï¼Œè¿™çœŸæ­£å®ç°äº†â€œç¼–å†™ä¸€æ¬¡ï¼Œéšå¤„è¿è¡Œâ€çš„è·¨æ¨¡å‹äº’æ“ä½œæ€§ã€‚</p>\n<h3 id=\"32-microsoftextensionsvectordata-mevdç»Ÿä¸€çš„è¯­ä¹‰å­˜å‚¨æŠ½è±¡\"><strong>3.2 Microsoft.Extensions.VectorData (MEVD)ï¼šç»Ÿä¸€çš„è¯­ä¹‰å­˜å‚¨æŠ½è±¡</strong></h3>\n<p>éšç€æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æˆä¸ºä¼ä¸šçº§ AI åº”ç”¨çš„æ ‡é…ï¼Œå‘é‡æ•°æ®åº“çš„é›†æˆå¤æ‚åº¦æ—¥ç›Šå¢åŠ ã€‚MEVD çš„å‡ºç°æ—¨åœ¨è§£å†³å‘é‡å­˜å‚¨ API çš„ä¸¥é‡ç¢ç‰‡åŒ–é—®é¢˜ã€‚</p>\n<p>MEVD å®šä¹‰äº†ä¸€å¥—ç±»ä¼¼äº ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰çš„æŠ½è±¡ï¼Œå…è®¸å¼€å‘è€…ä½¿ç”¨ C# ç‰¹æ€§æ ‡æ³¨ï¼ˆAttributeï¼‰æ¥å®šä¹‰æ•°æ®æ¨¡å‹ä¸­çš„å‘é‡å±æ€§ã€ä¸»é”®å’Œæ•°æ®å­—æ®µã€‚è¯¥æ¨¡å—çš„æ ¸å¿ƒä»·å€¼åœ¨äºå®ƒå°†â€œæ–‡æœ¬åˆ°å‘é‡çš„è½¬æ¢â€ä¸â€œå‘é‡å­˜å‚¨çš„ CRUD æ“ä½œâ€è¿›è¡Œäº†è§£è€¦ã€‚é€šè¿‡ä¸ IEmbeddingGenerator æ¥å£çš„é…åˆï¼Œç³»ç»Ÿå¯ä»¥è‡ªåŠ¨å¤„ç†åµŒå…¥å‘é‡çš„ç”Ÿæˆä¸åŒæ­¥ï¼Œå¼€å‘è€…åªéœ€å…³æ³¨é«˜çº§åˆ«çš„æœç´¢æ¥å£ï¼ˆå¦‚æ··åˆæœç´¢ã€å…³é”®è¯è¿‡æ»¤ç­‰ï¼‰ã€‚ä¸‹è¡¨å±•ç¤ºäº† MEVD ç›®å‰åœ¨.NET ç”Ÿæ€ä¸­çš„ä¸»æµé€‚é…æƒ…å†µï¼š</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: left;\">é€‚é…æ•°æ®åº“</th>\n<th style=\"text-align: left;\">çŠ¶æ€</th>\n<th style=\"text-align: left;\">å¼€å‘è€…æ”¶ç›Š</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\"><strong>Azure AI Search</strong></td>\n<td style=\"text-align: left;\">GA å®ç°</td>\n<td style=\"text-align: left;\">ä¼ä¸šçº§ã€é«˜å¯ç”¨ã€é›†æˆå®‰å…¨æ€§çš„æœç´¢æœåŠ¡æ”¯æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>Qdrant</strong></td>\n<td style=\"text-align: left;\">GA å®ç°</td>\n<td style=\"text-align: left;\">é’ˆå¯¹é«˜æ€§èƒ½ã€å¤§è§„æ¨¡å‘é‡æ£€ç´¢çš„ä¸“ä¸šåŒ–å¼•æ“æ”¯æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>Cosmos DB</strong></td>\n<td style=\"text-align: left;\">é¢„è§ˆ/é›†æˆ</td>\n<td style=\"text-align: left;\">åœ¨ç°æœ‰çš„ NoSQL æ•°æ®åº“ä¸­æ— ç¼æ‰©å±•è¯­ä¹‰æœç´¢</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>In-Memory</strong></td>\n<td style=\"text-align: left;\">é¢„è§ˆ</td>\n<td style=\"text-align: left;\">æé€Ÿçš„æœ¬åœ°å¼€å‘ä¸å•å…ƒæµ‹è¯•ä½“éªŒ</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"33-ç®—åŠ›ä¸æ€§èƒ½ä¼˜åŒ–systemnumericstensors-çš„çªç ´\"><strong>3.3 ç®—åŠ›ä¸æ€§èƒ½ä¼˜åŒ–ï¼šSystem.Numerics.Tensors çš„çªç ´</strong></h3>\n<p>åœ¨.NET 9 åŠ.NET 10 ä¸­ï¼Œå¹³å°å±‚é¢å¯¹ AI è®¡ç®—çš„åº•å±‚ä¼˜åŒ–è¾¾åˆ°äº†æ–°çš„é«˜åº¦ã€‚System.Numerics.Tensors åº“å¼•å…¥äº† TensorPrimitivesï¼Œä¸ºè·¨ Span çš„æ•°å­¦è¿ç®—æä¾›äº†ç¡¬ä»¶çº§åˆ«çš„ AVX10 åŠ é€Ÿã€‚è¿™ç§ä¼˜åŒ–ç›´æ¥æå‡äº†åœ¨.NET ä¸­æœ¬åœ°è¿è¡Œå°å‹è¯­è¨€æ¨¡å‹ï¼ˆSLMï¼‰æˆ–è¿›è¡Œå¤§è§„æ¨¡å‘é‡ç›¸ä¼¼åº¦è®¡ç®—çš„æ•ˆç‡ã€‚æ­¤å¤–ï¼Œæ–°çš„å®éªŒæ€§ Tensor&lt;T&gt; ç±»å‹æä¾›äº†æ›´é«˜æ•ˆçš„å¤šç»´æ•°æ®æ“ä½œèƒ½åŠ›ï¼Œå¤§å¹…å‡å°‘äº†åœ¨ä¸ ONNX Runtime æˆ– ML.NET äº¤äº’è¿‡ç¨‹ä¸­çš„å†…å­˜æ‹·è´å¼€é”€ã€‚</p>\n<h2 id=\"4-microsoft-agent-framework-çš„æ¶æ„æ·±æ½œ\"><strong>4. Microsoft Agent Framework çš„æ¶æ„æ·±æ½œ</strong></h2>\n<p>Microsoft Agent Framework çš„è®¾è®¡ç›®æ ‡æ˜¯è§£å†³å¤æ‚ AI ç³»ç»Ÿåœ¨ä»â€œå®éªŒå®¤å†…ç ”ç©¶â€è½¬å‘â€œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²â€æ—¶é¢ä¸´çš„å››å¤§æŒ‘æˆ˜ï¼šäº’æ“ä½œæ€§ã€ç ”ç©¶å‘ç”Ÿäº§çš„è½¬åŒ–æ•ˆç‡ã€å¯æ‰©å±•æ€§ä»¥åŠå¯è§‚å¯Ÿæ€§ ã€‚</p>\n<h3 id=\"41-ä»£ç†æ¨¡å‹çš„è¿›åŒ–aiagent-ä¸-chatclientagent\"><strong>4.1 ä»£ç†æ¨¡å‹çš„è¿›åŒ–ï¼šAIAgent ä¸ ChatClientAgent</strong></h3>\n<p>åœ¨ MAF æ¶æ„ä¸­ï¼Œä»£ç†è¢«å®šä¹‰ä¸ºå…·å¤‡æ¨ç†ã€è§„åˆ’å’Œæ‰§è¡Œèƒ½åŠ›çš„è‡ªä¸»è½¯ä»¶ç»„ä»¶ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªå°è£…äº†æç¤ºè¯çš„å‡½æ•°ã€‚MAF å¼•å…¥äº† AIAgent è¿™ä¸€æ ¸å¿ƒæŠ½è±¡ï¼Œå…¶è®¾è®¡ç›¸æ¯” Semantic Kernel çš„ Agent ç±»æ›´åŠ æ¨¡å—åŒ–ä¸”ä¸å†å¼ºä¾èµ–äº Kernel å¯¹è±¡ã€‚</p>\n<p>æœ€å¸¸ç”¨çš„å®ç°ç±»æ˜¯ ChatClientAgentï¼Œå®ƒåŸºäº IChatClient æ„å»ºï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥åˆ©ç”¨ä»»ä½•ç¬¦åˆ MEAI æ ‡å‡†çš„æ¨¡å‹ ã€‚è¿™ç§è®¾è®¡å¸¦æ¥çš„ä¸€ä¸ªå·¨å¤§ä¼˜åŠ¿æ˜¯ä»£ç†çš„ç®€åŒ–å®šä¹‰ï¼šå¼€å‘è€…å¯ä»¥é€šè¿‡å¯¥å¯¥æ•°è¡Œä»£ç ï¼Œä¸ºä¸€ä¸ªä»£ç†é…ç½®æŒ‡ä»¤ã€å·¥å…·é›†ä»¥åŠç‰¹å®šçš„ä¸­é—´ä»¶é€»è¾‘ 4ã€‚</p>\n<h3 id=\"42-è§£å†³ai-å¥å¿˜ç—‡agentthread-ä¸æŒä¹…åŒ–çŠ¶æ€ç®¡ç†\"><strong>4.2 è§£å†³â€œAI å¥å¿˜ç—‡â€ï¼šAgentThread ä¸æŒä¹…åŒ–çŠ¶æ€ç®¡ç†</strong></h3>\n<p>ä¼ ç»Ÿçš„ AI èŠå¤©åº”ç”¨å¾€å¾€ä¾èµ–äºæ˜“å¤±æ€§çš„å¯¹è¯å†å²ç®¡ç†ï¼Œè¿™åœ¨å¤æ‚çš„é•¿ç¨‹ä»»åŠ¡ä¸­ä¼šå¯¼è‡´ä¸¥é‡çš„ä¸Šä¸‹æ–‡ä¸¢å¤±é—®é¢˜ã€‚MAF é€šè¿‡ AgentThread å¯¹è±¡å½»åº•è§£å†³äº†è¿™ä¸€ç—›ç‚¹ ã€‚</p>\n<p>AgentThread ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ¶ˆæ¯åˆ—è¡¨ï¼Œå®ƒå°è£…äº†æ•´ä¸ªå¯¹è¯çš„ç”Ÿå‘½å‘¨æœŸå’Œä¸Šä¸‹æ–‡çŠ¶æ€ã€‚MAF æ”¯æŒå°† AgentThread çš„çŠ¶æ€è¿›è¡Œåºåˆ—åŒ–å¹¶æŒä¹…åŒ–åˆ°å¤–éƒ¨æ•°æ®åº“ï¼ˆå¦‚ Cosmos DBï¼‰ä¸­ ã€‚è¿™ç§â€œå¿«ç…§ä¸æ¢å¤â€æœºåˆ¶å…·æœ‰æå¼ºçš„å·¥ç¨‹æ„ä¹‰ï¼šä¸€ä¸ªéœ€è¦è€—æ—¶æ•°å°æ—¶ç”šè‡³æ•°å¤©çš„å¤æ‚ä¸šåŠ¡æµç¨‹ï¼ˆä¾‹å¦‚è´¢åŠ¡æŠ¥å‘Šç”Ÿæˆæˆ–ä¾›åº”é“¾åˆ†æï¼‰ï¼Œå¯ä»¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éšæ—¶æŒ‚èµ·ï¼Œå¹¶åœ¨æœåŠ¡å™¨é‡å¯æˆ–ç¯å¢ƒè¿ç§»åä»ç²¾ç¡®çš„æ–­ç‚¹å¤„é‡æ–°æ¿€æ´»ã€‚</p>\n<h3 id=\"43-å·¥å…·ä¸å‡½æ•°è°ƒç”¨çš„è§£è€¦\"><strong>4.3 å·¥å…·ä¸å‡½æ•°è°ƒç”¨çš„è§£è€¦</strong></h3>\n<p>åœ¨ Semantic Kernel ä¸­ï¼Œå‡½æ•°è°ƒç”¨é«˜åº¦ä¾èµ–äº [KernelFunction] ç‰¹æ€§å’Œå¤æ‚çš„æ’ä»¶æ³¨å†Œé€»è¾‘ã€‚MAF æå¤§åœ°ç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ï¼Œå…è®¸å¼€å‘è€…ç›´æ¥å°†æ ‡å‡†çš„ C# å‡½æ•°ä½œä¸ºä»£ç†å·¥å…·ï¼ˆAIFunctionï¼‰è¿›è¡Œæ³¨å†Œï¼Œä¸”æ— éœ€åœ¨ä¸šåŠ¡ä»£ç ä¸­æ•£å¸ƒæ¡†æ¶ç‰¹å®šçš„ Attributeã€‚è¿™ç§æ”¹è¿›ä¸ä»…å¢å¼ºäº†ä»£ç çš„çº¯å‡€åº¦ï¼Œä¹Ÿä½¿å¾—å•å…ƒæµ‹è¯•å’Œæ¨¡å—é‡ç”¨å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p>\n<h2 id=\"5-ç¼–æ’çš„è‰ºæœ¯ä»å•ä¸€ä»£ç†åˆ°å¤šä»£ç†å·¥ä½œæµ\"><strong>5. ç¼–æ’çš„è‰ºæœ¯ï¼šä»å•ä¸€ä»£ç†åˆ°å¤šä»£ç†å·¥ä½œæµ</strong></h2>\n<p>éšç€ä»»åŠ¡å¤æ‚åº¦çš„æå‡ï¼Œå•ä¸€ä»£ç†å¾€å¾€ä¼šé¢ä¸´â€œè®¤çŸ¥è´Ÿè·â€è¿‡é‡çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å½“å·¥å…·æ•°é‡è¶…è¿‡ 20 ä¸ªæ—¶ï¼Œæ¨¡å‹çš„è§„åˆ’æˆåŠŸç‡ä¼šæ˜¾è‘—ä¸‹é™ ã€‚ä¸ºæ­¤ï¼ŒMAF å¼•å…¥äº†ä¸¤å¥—äº’è¡¥çš„ç¼–æ’æœºåˆ¶ï¼šåŸºäº LLM æ¨ç†çš„åŠ¨æ€ä»£ç†åä½œå’ŒåŸºäºä¸šåŠ¡é€»è¾‘çš„ç¡®å®šæ€§å·¥ä½œæµã€‚</p>\n<h3 id=\"51-å¤šä»£ç†åä½œæ¨¡å¼-orchestration-patterns\"><strong>5.1 å¤šä»£ç†åä½œæ¨¡å¼ (Orchestration Patterns)</strong></h3>\n<p>MAF æ·±åº¦æ•´åˆäº† AutoGen é¡¹ç›®ä¸­æœ€å…·åˆ›æ–°æ€§çš„å¤šä»£ç†äº¤äº’æ¨¡å¼ï¼Œå¹¶ä¸ºå…¶æä¾›äº†ä¼ä¸šçº§çš„åŠ å›º 1ã€‚</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: left;\">æ¨¡å¼</th>\n<th style=\"text-align: left;\">æ ¸å¿ƒé€»è¾‘</th>\n<th style=\"text-align: left;\">å…¸å‹åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\"><strong>é¡ºåºæ¨¡å¼ (Sequential)</strong></td>\n<td style=\"text-align: left;\">ä»£ç†é—´å½¢æˆå›ºå®šçš„æ¥åŠ›é“¾è·¯ï¼Œè¾“å‡ºè‡ªåŠ¨è½¬ä¸ºä¸‹ä¸€ç¯èŠ‚è¾“å…¥</td>\n<td style=\"text-align: left;\">å†…å®¹å®¡æ ¸æµæ°´çº¿ï¼šå†™ä½œä»£ç† -&gt; è¯­æ³•æ£€æŸ¥ä»£ç† -&gt; åˆè§„å®¡æŸ¥ä»£ç†</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>å¹¶å‘æ¨¡å¼ (Concurrent)</strong></td>\n<td style=\"text-align: left;\">ä»»åŠ¡è¢«æ‹†è§£å¹¶åˆ†å‘ç»™å¤šä¸ªä¸“å®¶ä»£ç†å¹¶è¡Œå¤„ç†ï¼Œæœ€åç”±æ±‡æ€»ä»£ç†æ•´åˆ 25</td>\n<td style=\"text-align: left;\">æ³•å¾‹åˆè§„æ€§åˆ†æï¼šå¤šä¸ªä»£ç†åˆ†åˆ«æ£€æŸ¥ä¸åŒçš„æ³•å¾‹æ¡æ–‡</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>ç§»äº¤æ¨¡å¼ (Handoff)</strong></td>\n<td style=\"text-align: left;\">ä»£ç†æ ¹æ®å¯¹è¯æ„å›¾ä¸»åŠ¨å°†æ§åˆ¶æƒè½¬äº¤ç»™å¦ä¸€ä¸ªæ›´ä¸“ä¸šçš„ä»£ç†</td>\n<td style=\"text-align: left;\">å®¢æˆ·æœåŠ¡åˆ†æ‹¨ï¼šåˆçº§ä»£ç†è¯†åˆ«æ„å›¾åè½¬äº¤ç»™è´¢åŠ¡æˆ–æŠ€æœ¯ä¸“å®¶</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>ç¾¤èŠæ¨¡å¼ (Group Chat)</strong></td>\n<td style=\"text-align: left;\">åœ¨ç®¡ç†å™¨åè°ƒä¸‹ï¼Œå¤šä¸ªä»£ç†é€šè¿‡å¤šè½®å¯¹è¯å…±åŒè§£å†³å¼€æ”¾æ€§é—®é¢˜</td>\n<td style=\"text-align: left;\">å¤æ‚çš„æ¶æ„è®¾è®¡æˆ–å¤´è„‘é£æš´ä»»åŠ¡</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"52-magentic-oneé€šç”¨å¤šä»£ç†ç³»ç»Ÿçš„å·…å³°\"><strong>5.2 Magentic-Oneï¼šé€šç”¨å¤šä»£ç†ç³»ç»Ÿçš„å·…å³°</strong></h3>\n<p>Magentic-One æ˜¯ MAF ä¸­æœ€å—ç©ç›®çš„ç¼–æ’æ¨¡å¼ï¼Œä»£è¡¨äº†ç›®å‰å¾®è½¯åœ¨å¤šä»£ç†ååŒé¢†åŸŸçš„æœ€é«˜æ°´å¹³ ã€‚å®ƒé‡‡ç”¨ä¸€ç§â€œä¸»å¯¼è€…-ä¸“å®¶â€æ¶æ„ï¼Œç”±ä¸€ä¸ª Magentic ç®¡ç†å™¨ï¼ˆManagerï¼‰æŒ‡æŒ¥ä¸€ç»„é«˜åº¦ä¸“ä¸šåŒ–çš„ä»£ç†ï¼Œå¦‚ WebSurferï¼ˆè´Ÿè´£ç½‘é¡µæµè§ˆï¼‰ã€FileSurferï¼ˆè´Ÿè´£æ–‡ä»¶å¤„ç†ï¼‰å’Œ Coderï¼ˆè´Ÿè´£ä»£ç æ‰§è¡Œï¼‰ ã€‚</p>\n<p>Magentic ç®¡ç†å™¨çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºå…¶åŒç¯è§„åˆ’æœºåˆ¶ï¼š</p>\n<ul>\n<li><strong>å¤–ç¯ï¼šä»»åŠ¡è´¦æœ¬ (Task Ledger)</strong>ã€‚è´Ÿè´£ç»´æŠ¤å…¨å±€ç›®æ ‡ã€å·²çŸ¥äº‹å®å’Œæ€»ä½“è§„åˆ’ ã€‚</li>\n<li><strong>å†…ç¯ï¼šè¿›åº¦è´¦æœ¬ (Progress Ledger)</strong>ã€‚åœ¨æ¯ä¸€æ­¥æ‰§è¡Œåè¿›è¡Œè‡ªæˆ‘åæ€ï¼Œè¯„ä¼°å½“å‰æ­¥éª¤æ˜¯å¦æˆåŠŸè¾¾æˆé¢„å®šå­ç›®æ ‡ï¼Œå¹¶åŠ¨æ€è°ƒæ•´åç»­è¡ŒåŠ¨ 27ã€‚</li>\n</ul>\n<p>è¿™ç§æ¨¡å¼éå¸¸é€‚åˆäºé‚£äº›è§£å†³æ–¹æ¡ˆè·¯å¾„æœªçŸ¥ã€éœ€è¦å¤šå›åˆæ¨ç†å’Œå¤–éƒ¨å·¥å…·åå¤äº¤äº’çš„å¤æ‚å¼€æ”¾å¼ä»»åŠ¡ã€‚</p>\n<h2 id=\"6-åŸºäºå›¾çš„å·¥ä½œæµ-workflowsä¼ä¸šçº§ç¡®å®šæ€§çš„ä¿éšœ\"><strong>6. åŸºäºå›¾çš„å·¥ä½œæµ (Workflows)ï¼šä¼ä¸šçº§ç¡®å®šæ€§çš„ä¿éšœ</strong></h2>\n<p>å¦‚æœè¯´å¤šä»£ç†ç¼–æ’ä½“ç°äº† AI çš„â€œçµæ€§â€ï¼Œé‚£ä¹ˆ MAF çš„å·¥ä½œæµç³»ç»Ÿåˆ™ä½“ç°äº†ä¼ä¸šåº”ç”¨æ‰€éœ€çš„â€œä¸¥è°¨â€ã€‚å·¥ä½œæµå…è®¸å¼€å‘è€…é€šè¿‡å›¾å½¢ç»“æ„æ˜¾å¼åœ°å®šä¹‰ä»»åŠ¡æ‰§è¡Œè·¯å¾„ã€‚</p>\n<h3 id=\"61-å›¾å½¢ç¼–æ’ä¸ç±»å‹å®‰å…¨\"><strong>6.1 å›¾å½¢ç¼–æ’ä¸ç±»å‹å®‰å…¨</strong></h3>\n<p>MAF å·¥ä½œæµé‡‡ç”¨ Directed Graphï¼ˆæœ‰å‘å›¾ï¼‰æ¨¡å‹ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ‰§è¡Œå™¨ï¼ˆExecutorï¼‰ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ª AIAgent æˆ–è€…æ˜¯ä»»ä½•è‡ªå®šä¹‰çš„ C# é€»è¾‘ï¼›èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥åˆ™ç”±è¾¹ç¼˜ï¼ˆEdgeï¼‰å®šä¹‰ã€‚</p>\n<p>è¿™ç§è®¾è®¡çš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºâ€œç±»å‹å®‰å…¨ï¼ˆType Safetyï¼‰â€ã€‚åœ¨å·¥ä½œæµæ‰§è¡Œå‰ï¼Œæ¡†æ¶ä¼šéªŒè¯æ¶ˆæ¯åœ¨èŠ‚ç‚¹é—´æµåŠ¨çš„å¥‘çº¦ä¸€è‡´æ€§ï¼Œä»è€Œé˜²æ­¢åœ¨é•¿ç¨‹ä»»åŠ¡ä¸­å‡ºç°è¿è¡Œæ—¶é”™è¯¯ ã€‚å¼€å‘è€…å¯ä»¥ä½¿ç”¨ WorkflowBuilder ä»¥å£°æ˜å¼çš„æ–¹å¼æ„å»ºå¤æ‚çš„éçº¿æ€§é€»è¾‘ï¼ŒåŒ…æ‹¬æ¡ä»¶è·¯ç”±ã€å¾ªç¯è¿­ä»£å’Œå¼‚å¸¸å¤„ç†ã€‚</p>\n<h3 id=\"62-æ£€æŸ¥ç‚¹-checkpointing-ä¸é•¿æ•ˆä»»åŠ¡æ¢å¤\"><strong>6.2 æ£€æŸ¥ç‚¹ (Checkpointing) ä¸é•¿æ•ˆä»»åŠ¡æ¢å¤</strong></h3>\n<p>å·¥ä½œæµç³»ç»Ÿæœ€å…³é”®çš„ç”Ÿäº§ç‰¹æ€§æ˜¯æ£€æŸ¥ç‚¹æœºåˆ¶ã€‚åœ¨æ¯ä¸€ä¸ªâ€œè¶…çº§æ­¥ï¼ˆSuper Stepï¼‰â€è¾¹ç•Œï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨æ•è·å½“å‰æ‰€æœ‰æ‰§è¡Œå™¨çš„çŠ¶æ€å¹¶å°†å…¶æŒä¹…åŒ–ã€‚</p>\n<p>è¿™ç§æœºåˆ¶å¯¹äºéœ€è¦â€œäººç±»å‚ä¸ï¼ˆHuman-in-the-Loopï¼‰â€çš„ä»»åŠ¡è‡³å…³é‡è¦ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªé‡‡è´­å®¡æ‰¹æµç¨‹ä¸­ï¼Œä»£ç†å¯ä»¥å¤„ç†åˆæœŸçš„ä¾›åº”å•†å¯¹æ¯”å’Œé£é™©è¯„ä¼°ï¼Œç„¶åå·¥ä½œæµåœ¨â€œç­‰å¾…è´¢åŠ¡æ€»ç›‘å®¡æ‰¹â€è¿™ä¸€èŠ‚ç‚¹è‡ªåŠ¨è¿›å…¥ä¼‘çœ çŠ¶æ€å¹¶åˆ›å»ºæ£€æŸ¥ç‚¹ã€‚å³ä¾¿å®¡æ‰¹è¿‡ç¨‹æŒç»­æ•°å¤©ï¼Œç³»ç»Ÿä¹Ÿå¯ä»¥åœ¨è·å¾—æ‰¹å‡†ä¿¡å·åï¼Œé€šè¿‡â€œé‡æ–°è¡¥æ°´ï¼ˆRehydrationï¼‰â€ä»ç²¾ç¡®çš„æ£€æŸ¥ç‚¹å¤„ç¬é—´æ¢å¤ï¼Œè€Œæ— éœ€é‡æ–°è¿è¡Œä¹‹å‰çš„è€—æ—¶æ¨ç†æ­¥éª¤ ã€‚</p>\n<h2 id=\"7-æ ‡å‡†åŒ–åè®®ä¸äº’æ“ä½œæ€§mcp-ä¸-a2a\"><strong>7. æ ‡å‡†åŒ–åè®®ä¸äº’æ“ä½œæ€§ï¼šMCP ä¸ A2A</strong></h2>\n<p>å¾®è½¯åœ¨ MAF ä¸­å¹¶æ²¡æœ‰èµ°å°é—­ç”Ÿæ€çš„è·¯çº¿ï¼Œè€Œæ˜¯æåŠ›æ¨åŠ¨æ ‡å‡†çš„å»ºç«‹ï¼Œä»¥è§£å†³ä»£ç†ä¸å¤–ç•Œç¯å¢ƒã€ä»£ç†ä¸ä»£ç†ä¹‹é—´çš„æ²Ÿé€šéšœç¢ã€‚</p>\n<h3 id=\"71-æ¨¡å‹ä¸Šä¸‹æ–‡åè®®-mcp\"><strong>7.1 æ¨¡å‹ä¸Šä¸‹æ–‡åè®® (MCP)</strong></h3>\n<p>MCP æ˜¯ MAF ä¸­å¼•å…¥çš„ä¸€ä¸ªåˆ’æ—¶ä»£çš„æ ‡å‡†ã€‚å®ƒå…è®¸ä»£ç†åŠ¨æ€åœ°å‘ç°å’Œè¿æ¥åˆ°å¤–éƒ¨å·¥å…·æœåŠ¡å™¨ï¼Œè€Œæ— éœ€ä¸ºæ¯ä¸€ä¸ª API ç¼–å†™è‡ªå®šä¹‰é©±åŠ¨ã€‚åœ¨ MAF ä¸­ï¼Œä¸€ä¸ªä»£ç†å¯ä»¥ä½œä¸ºä¸€ä¸ª MCP Clientï¼Œå®æ—¶æŸ¥è¯¢ MCP Server æš´éœ²çš„å·¥å…·åˆ—è¡¨ã€èµ„æºå’Œæç¤ºè¯æ¨¡æ¿ã€‚è¿™ç§è§£è€¦æå¤§åœ°å¢å¼ºäº†ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œä½¿å¾—åŒä¸€ä¸ªä»£ç†å¯ä»¥åœ¨ä¸åŒçš„ä¼ä¸šç¯å¢ƒä¸­å¿«é€Ÿåˆ‡æ¢å…¶å¯è°ƒç”¨çš„èµ„æºã€‚</p>\n<h3 id=\"72-ä»£ç†é—´åè®®-a2a\"><strong>7.2 ä»£ç†é—´åè®® (A2A)</strong></h3>\n<p>ä¸ºäº†å®ç°è·¨è¿è¡Œæ—¶ã€è·¨åœ°åŸŸçš„å¤šä»£ç†åä½œï¼ŒMAF å®ç°äº† A2A åè®®ã€‚è¯¥åè®®å®šä¹‰äº†ä¸€å¥—æ ‡å‡†çš„ã€åŸºäºæ¶ˆæ¯çš„é€šè®¯è§„èŒƒï¼Œä½¿å¾—è¿è¡Œåœ¨ Azure AI Foundry ä¸Šçš„.NET ä»£ç†å¯ä»¥ä¸è¿è¡Œåœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šçš„ Python ä»£ç†è¿›è¡Œæ— ç¼å¯¹è¯ ã€‚è¿™ç§äº’æ“ä½œæ€§ç¡®ä¿äº†ä¼ä¸šå¯ä»¥åˆ©ç”¨ä¸åŒæŠ€æœ¯æ ˆçš„ä¼˜åŠ¿ï¼Œæ„å»ºèµ·ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šçš„â€œä»£ç†ç½‘ç»œâ€ã€‚</p>\n<h2 id=\"8-ç”Ÿäº§çº§è§‚æµ‹ä¸æ²»ç†å¯è§‚å¯Ÿæ€§ä¸è´Ÿè´£ä»»çš„-ai\"><strong>8. ç”Ÿäº§çº§è§‚æµ‹ä¸æ²»ç†ï¼šå¯è§‚å¯Ÿæ€§ä¸è´Ÿè´£ä»»çš„ AI</strong></h2>\n<p>åœ¨ä¼ä¸šçº§éƒ¨ç½²ä¸­ï¼ŒAI çš„â€œå¯æ§æ€§â€å¾€å¾€ä¼˜äºâ€œåˆ›é€ åŠ›â€ã€‚MAF åœ¨è®¾è®¡ä¹‹åˆå°±å°†ç›‘æ§å’Œæ²»ç†æ•´åˆè¿›äº†è¿è¡Œæ—¶ã€‚</p>\n<h3 id=\"81-åŸºäº-opentelemetry-çš„åˆ†å¸ƒå¼è¿½è¸ª\"><strong>8.1 åŸºäº OpenTelemetry çš„åˆ†å¸ƒå¼è¿½è¸ª</strong></h3>\n<p>MAF åŸç”Ÿæ”¯æŒ OpenTelemetryï¼Œè¿™æ„å‘³ç€ä»£ç†çš„æ¯ä¸€æ¬¡æ€è€ƒã€æ¯ä¸€æ¬¡å·¥å…·è°ƒç”¨ä»¥åŠæ¯ä¸€ä¸ª Token çš„æ¶ˆè€—ï¼Œéƒ½å¯ä»¥è¢«å®æ—¶è®°å½•å¹¶ä¼ è¾“åˆ° Azure Monitor æˆ– Jaeger ç­‰è§‚æµ‹å¹³å° 32ã€‚å¼€å‘è€…å¯ä»¥ç›´è§‚åœ°æŸ¥çœ‹â€œä»£ç†å¯¹è¯æµå›¾â€ï¼Œåˆ†æç“¶é¢ˆï¼Œå¹¶å¯¹ç”±äºæ¨¡å‹é€‰æ‹©ä¸å½“æˆ–æç¤ºè¯è¿‡é•¿å¯¼è‡´çš„æˆæœ¬å¼‚å¸¸è¿›è¡Œå¿«é€Ÿå“åº” ã€‚</p>\n<h3 id=\"82-è´Ÿè´£ä»»çš„-ai-ä¸å®‰å…¨é˜²æŠ¤\"><strong>8.2 è´Ÿè´£ä»»çš„ AI ä¸å®‰å…¨é˜²æŠ¤</strong></h3>\n<p>ä¸ºäº†é˜²æ­¢ä»£ç†åœ¨è‡ªä¸»æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°â€œå¹»è§‰â€æˆ–è¢«æ¶æ„åˆ©ç”¨ï¼ŒMAF å¼•å…¥äº†å¤šé¡¹å®‰å…¨é˜²æŠ¤æªæ–½ï¼š</p>\n<ul>\n<li><strong>ä»»åŠ¡ä¾ä»æ€§ç›‘æµ‹ (Task Adherence)</strong>ï¼šå®æ—¶è¯„ä¼°ä»£ç†çš„è¾“å‡ºæ˜¯å¦ç¬¦åˆå…¶è®¾å®šçš„åŸå§‹æŒ‡ä»¤ï¼Œé˜²æ­¢å…¶è¢«å¼•å¯¼è‡³æ— å…³é¢†åŸŸ 3ã€‚</li>\n<li><strong>æç¤ºè¯æŠ¤ç›¾ (Prompt Shields)</strong>ï¼šåˆ©ç”¨ Spotlighting ç­‰å…ˆè¿›æŠ€æœ¯ï¼Œè¯†åˆ«å¹¶æ‹¦æˆªæ½œåœ¨çš„æç¤ºè¯æ³¨å…¥æ”»å‡»ï¼Œç¡®ä¿æ ¸å¿ƒæŒ‡ä»¤ä¸è¢«ç¯¡æ”¹ 3ã€‚</li>\n<li><strong>PII éšç§æ£€æµ‹</strong>ï¼šåœ¨å‘é€ç»™å…¬æœ‰äº‘æ¨¡å‹ä¹‹å‰ï¼Œè‡ªåŠ¨æ‰«æå¹¶é®ç›–æ–‡æœ¬ä¸­çš„ä¸ªäººèº«ä»½ä¿¡æ¯ï¼Œç¡®ä¿æ•°æ®åˆè§„ 3ã€‚</li>\n</ul>\n<h2 id=\"9net-ai-æ¡†æ¶é€‰æ‹©å†³ç­–å»ºè®®\"><strong>9..NET AI æ¡†æ¶é€‰æ‹©å†³ç­–å»ºè®®</strong></h2>\n<p>é¢å¯¹å¿«é€Ÿæ¼”è¿›çš„ç”Ÿæ€ç³»ç»Ÿï¼ŒæŠ€æœ¯å†³ç­–è€…åº”æ ¹æ®é¡¹ç›®å…·ä½“çš„ç”Ÿå‘½å‘¨æœŸå’Œä¸šåŠ¡å¤æ‚åº¦è¿›è¡Œé€‰æ‹©ã€‚</p>\n<h3 id=\"91-å†³ç­–çŸ©é˜µä»€ä¹ˆæ—¶å€™é€‰æ‹©ä»€ä¹ˆæ¡†æ¶\"><strong>9.1 å†³ç­–çŸ©é˜µï¼šä»€ä¹ˆæ—¶å€™é€‰æ‹©ä»€ä¹ˆæ¡†æ¶ï¼Ÿ</strong></h3>\n<p>ä¸‹è¡¨æ ¹æ®å½“å‰.NET AI ç”Ÿæ€çš„æœ€æ–°çŠ¶æ€ï¼Œä¸ºå¼€å‘è€…æä¾›äº†å…·ä½“çš„é€‰æ‹©å»ºè®®ï¼š</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: left;\">éœ€æ±‚ç‰¹å¾</th>\n<th style=\"text-align: left;\">æ¨èé€‰æ‹©</th>\n<th style=\"text-align: left;\">ç†ç”±</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\"><strong>æ–°å¯åŠ¨çš„ã€æ—¨åœ¨æ„å»ºè‡ªä¸» AI ç³»ç»Ÿçš„é¡¹ç›®</strong></td>\n<td style=\"text-align: left;\"><strong>Microsoft Agent Framework (MAF)</strong></td>\n<td style=\"text-align: left;\">å®ƒæ˜¯å®˜æ–¹ç»§ä»»è€…ï¼Œæ‹¥æœ‰æœ€å…¨çš„å¤šä»£ç†ç¼–æ’å’ŒæŒä¹…åŒ–åŠŸèƒ½ï¼Œä»£è¡¨æœªæ¥æŠ€æœ¯æ–¹å‘ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>å·²æœ‰çš„ã€å¤„äºç¨³å®šè¿è¡ŒæœŸçš„ä¼ä¸šçº§ AI å¢å¼ºåº”ç”¨</strong></td>\n<td style=\"text-align: left;\"><strong>Semantic Kernel (v1.x)</strong></td>\n<td style=\"text-align: left;\">ä¿æŒç¨³å®šæ€§ï¼Œé™¤éæœ‰å¤æ‚çš„å¤šä»£ç†åä½œæˆ–é•¿ç¨‹ä»»åŠ¡æ¢å¤éœ€æ±‚ï¼Œå¦åˆ™ä¸å»ºè®®ç«‹å³é‡æ„ ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>ä»…éœ€è¿›è¡ŒåŸºç¡€èŠå¤©æˆ–ç®€å• RAG åŠŸèƒ½å¼€å‘</strong></td>\n<td style=\"text-align: left;\"><strong>Microsoft.Extensions.AI/VectorData</strong></td>\n<td style=\"text-align: left;\">ç›´æ¥ä½¿ç”¨åº•å±‚æŠ½è±¡å¯è·å¾—æœ€ä½çš„æ¡†æ¶å¼€é”€å’Œæœ€é«˜çš„çµæ´»æ€§ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>é«˜åº¦æœºå¯†çš„ã€éœ€è¦å¯¹ä»£ç† compute è¿›è¡Œå®Œå…¨æ§åˆ¶çš„åœºæ™¯</strong></td>\n<td style=\"text-align: left;\"><strong>MAF + Azure Container Apps</strong></td>\n<td style=\"text-align: left;\">MAF çš„å®¹å™¨åŒ–æ”¯æŒå…è®¸åœ¨å—æ§ç¯å¢ƒä¸‹è¿è¡Œå¤æ‚çš„ä»£ç†ç¼–æ’ä»£ç  1ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>éœ€è¦è·¨è¯­è¨€ï¼ˆPython +.NETï¼‰åä½œçš„å¤æ‚ç³»ç»Ÿ</strong></td>\n<td style=\"text-align: left;\"><strong>MAF (åˆ©ç”¨ A2A åè®®)</strong></td>\n<td style=\"text-align: left;\">å®ƒæ˜¯ç›®å‰å”¯ä¸€æä¾›è·¨å¹³å°ã€æ ‡å‡†åŒ–é€šä¿¡å¥‘çº¦çš„æˆç†Ÿæ¡†æ¶ ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"92-è¿ç§»è·¯çº¿å›¾ä»-semantic-kernel-è½¬å‘-maf\"><strong>9.2 è¿ç§»è·¯çº¿å›¾ï¼šä» Semantic Kernel è½¬å‘ MAF</strong></h3>\n<p>å¯¹äºå†³å®šè¿ç§»çš„å¼€å‘å›¢é˜Ÿï¼Œå»ºè®®é‡‡ç”¨æ¸è¿›å¼çš„ç­–ç•¥ã€‚ç”±äº MAF çš„ ChatClientAgent ä¸ Semantic Kernel çš„ ChatCompletionAgent åœ¨æ¦‚å¿µä¸Šé«˜åº¦å¥‘åˆï¼Œè¿ç§»çš„ç¬¬ä¸€æ­¥é€šå¸¸æ˜¯æ›´æ¢å‘½åç©ºé—´ï¼Œå¹¶åˆ©ç”¨ Microsoft.Extensions.AI çš„é€‚é…å™¨æ¥å°è£…ç°æœ‰çš„æ¨¡å‹è¿æ¥ ã€‚</p>\n<p>æœ€é‡è¦çš„å˜åŒ–åœ¨äºç§»é™¤å¯¹å…¨å±€ Kernel å¯¹è±¡çš„ä¾èµ–ï¼Œè½¬è€Œé‡‡ç”¨ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¨¡å¼ç®¡ç†å…·ä½“çš„ IChatClientã€‚æ­¤å¤–ï¼Œå¯¹äºåŸæœ¬ä½¿ç”¨å¤æ‚ Plugin ç³»ç»Ÿçš„ä»£ç ï¼Œå¯ä»¥é€æ­¥ç®€åŒ–ä¸ºç›´æ¥æ³¨å†Œ C# å‡½æ•°ï¼Œåˆ©ç”¨ MAF çš„ AIFunctionFactory å®ç°æ›´è½»é‡çº§çš„å·¥å…·é›†æˆ ã€‚</p>\n<h2 id=\"10-æ€»ç»“ä¸å±•æœ›è¿ˆå‘ä»£ç†åŸç”Ÿagent-nativeçš„æœªæ¥\"><strong>10. æ€»ç»“ä¸å±•æœ›ï¼šè¿ˆå‘ä»£ç†åŸç”Ÿï¼ˆAgent-Nativeï¼‰çš„æœªæ¥</strong></h2>\n<p>é€šè¿‡å¯¹ Microsoft Agent Framework çš„æ·±åº¦è°ƒæŸ¥å¯ä»¥å‘ç°ï¼Œ.NET AI ç”Ÿæ€ç³»ç»Ÿæ­£åœ¨ç»å†ä¸€åœºä»â€œåŠŸèƒ½é›†æˆâ€å‘â€œä»£ç†åŸç”Ÿâ€çš„èœ•å˜ã€‚å¾®è½¯é€šè¿‡æ•´åˆ Semantic Kernel çš„å·¥ç¨‹åŸºå› ä¸ AutoGen çš„åˆ›æ–°çµé­‚ï¼Œä¸ä»…æä¾›äº†ä¸€ä¸ªæ›´å¼ºå¤§çš„å¼€å‘å·¥å…·ï¼Œæ›´æ˜¯åœ¨.NET å¹³å°ä¸Šç¡®ç«‹äº†ä¸€å¥—å…³äº AI ä»£ç†å¦‚ä½•æ€è€ƒã€åä½œã€è®°å¿†å’Œæ‰§è¡Œçš„æ ‡å‡†ã€‚</p>\n<p>æœªæ¥ï¼Œéšç€.NET 10 å¯¹å¼ é‡è®¡ç®—çš„è¿›ä¸€æ­¥åŠ é€Ÿï¼Œä»¥åŠæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰åœ¨æ•´ä¸ªè½¯ä»¶å·¥ä¸šç•Œçš„æ™®åŠï¼Œæˆ‘ä»¬å¯ä»¥é¢„è§ï¼ŒAI ä»£ç†å°†ä»å­¤ç«‹çš„å®éªŒé¡¹ç›®è½¬å˜ä¸ºä¼ä¸š IT æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„ç»„æˆéƒ¨åˆ†ã€‚Microsoft Agent Framework çš„å‡ºç°ï¼Œæ­£æ˜¯ä¸ºè¿™ä¸€å¤©çš„åˆ°æ¥æ­å»ºå¥½äº†æœ€åšå®çš„å·¥ä¸šçº§åº•åº§ã€‚å¯¹äºå¹¿å¤§.NET å¼€å‘è€…è€Œè¨€ï¼Œç°åœ¨çš„ä»»åŠ¡æ˜¯ç§¯ææ‹¥æŠ±è¿™äº›æ ‡å‡†åŒ–çš„æŠ½è±¡ï¼Œä»ç®€å•çš„å¯¹è¯é€»è¾‘ä¸­è§£æ”¾å‡ºæ¥ï¼Œå»æ„å»ºé‚£äº›çœŸæ­£èƒ½å¤Ÿç†è§£ä¸šåŠ¡ç›®æ ‡ã€è‡ªä¸»ååŒå¹¶åˆ›é€ å®é™…ä¸šåŠ¡ä»·å€¼çš„æ™ºèƒ½ç³»ç»Ÿ ã€‚</p>\n<h4 id=\"å¼•ç”¨çš„æ–‡ç« \"><strong>å¼•ç”¨çš„æ–‡ç« </strong></h4>\n<ol>\n<li>Introducing Microsoft Agent Framework: The Open-Source Engine for Agentic AI Apps <a href=\"https://devblogs.microsoft.com/foundry/introducing-microsoft-agent-framework-the-open-source-engine-for-agentic-ai-apps/\" rel=\"noopener nofollow\" target=\"_blank\">https://devblogs.microsoft.com/foundry/introducing-microsoft-agent-framework-the-open-source-engine-for-agentic-ai-apps/</a></li>\n<li>The .NET GenAI Stack - by Building AI Agents in .NET <a href=\"https://substack.com/home/post/p-184440125\" rel=\"noopener nofollow\" target=\"_blank\">https://substack.com/home/post/p-184440125</a></li>\n<li>Introducing Microsoft Agent Framework | Microsoft Azure Blog <a href=\"https://azure.microsoft.com/en-us/blog/introducing-microsoft-agent-framework/\" rel=\"noopener nofollow\" target=\"_blank\">https://azure.microsoft.com/en-us/blog/introducing-microsoft-agent-framework/</a></li>\n<li>Microsoft Agent Framework: The production-ready convergence of AutoGen and Semantic Kernel - European AI &amp; Cloud Summit  <a href=\"https://cloudsummit.eu/blog/microsoft-agent-framework-production-ready-convergence-autogen-semantic-kernel\" rel=\"noopener nofollow\" target=\"_blank\">https://cloudsummit.eu/blog/microsoft-agent-framework-production-ready-convergence-autogen-semantic-kernel</a></li>\n<li>Finally We have answer between AutoGen and Semantic Kernel â€” Its Microsoft Agent Framework | by Akshay Kokane | Data Science Collective | Medium <a href=\"https://medium.com/data-science-collective/finally-we-have-answer-between-autogen-and-semantic-kernel-its-microsoft-agent-framework-071e84e0923b\" rel=\"noopener nofollow\" target=\"_blank\">https://medium.com/data-science-collective/finally-we-have-answer-between-autogen-and-semantic-kernel-its-microsoft-agent-framework-071e84e0923b</a></li>\n<li>.NET AI Essentials - The Core Building Blocks Explained - .NET Blog <a href=\"https://devblogs.microsoft.com/dotnet/dotnet-ai-essentials-the-core-building-blocks-explained/\" rel=\"noopener nofollow\" target=\"_blank\">https://devblogs.microsoft.com/dotnet/dotnet-ai-essentials-the-core-building-blocks-explained/</a></li>\n<li>AI and Vector Data Extensions are now Generally Available (GA) - <a href=\"https://devblogs.microsoft.com/dotnet/ai-vector-data-dotnet-extensions-ga/\" rel=\"noopener nofollow\" target=\"_blank\">https://devblogs.microsoft.com/dotnet/ai-vector-data-dotnet-extensions-ga/</a></li>\n<li>Semantic Kernel and Microsoft Agent Framework | Semantic Kernel, <a href=\"https://devblogs.microsoft.com/semantic-kernel/semantic-kernel-and-microsoft-agent-framework/\" rel=\"noopener nofollow\" target=\"_blank\">https://devblogs.microsoft.com/semantic-kernel/semantic-kernel-and-microsoft-agent-framework/</a></li>\n<li>.NET + AI ecosystem tools and SDKs - .NET | Microsoft Learn,   <a href=\"https://learn.microsoft.com/en-us/dotnet/ai/dotnet-ai-ecosystem\" rel=\"noopener nofollow\" target=\"_blank\">https://learn.microsoft.com/en-us/dotnet/ai/dotnet-ai-ecosystem</a></li>\n<li>Semantic Kernel + AutoGen = Open-Source 'Microsoft Agent Framework' <a href=\"https://visualstudiomagazine.com/articles/2025/10/01/semantic-kernel-autogen--open-source-microsoft-agent-framework.aspx\" rel=\"noopener nofollow\" target=\"_blank\">https://visualstudiomagazine.com/articles/2025/10/01/semantic-kernel-autogen--open-source-microsoft-agent-framework.aspx</a></li>\n<li>Semantic Kernel vs AutoGen: Which Microsoft Framework Builds Better AI Agents   <a href=\"https://www.zenml.io/blog/semantic-kernel-vs-autogen\" rel=\"noopener nofollow\" target=\"_blank\">https://www.zenml.io/blog/semantic-kernel-vs-autogen</a></li>\n<li>Microsoft.Agents.AI (Agent Framework) | ABP.IO Documentation <a href=\"https://abp.io/docs/latest/framework/infrastructure/artificial-intelligence/microsoft-agent-framework\" rel=\"noopener nofollow\" target=\"_blank\">https://abp.io/docs/latest/framework/infrastructure/artificial-intelligence/microsoft-agent-framework</a></li>\n<li>Introduction to Microsoft Agent Framework <a href=\"https://learn.microsoft.com/en-us/agent-framework/overview/agent-framework-overview\" rel=\"noopener nofollow\" target=\"_blank\">https://learn.microsoft.com/en-us/agent-framework/overview/agent-framework-overview</a></li>\n<li>Hello Microsoft Agent Framework (Bye Bye AutoGen!)  <a href=\"https://www.gettingstarted.ai/microsoft-agent-framework-replaces-autogen/\" rel=\"noopener nofollow\" target=\"_blank\">https://www.gettingstarted.ai/microsoft-agent-framework-replaces-autogen/</a></li>\n<li>Build a .NET AI vector search app -  <a href=\"https://learn.microsoft.com/en-us/dotnet/ai/quickstarts/build-vector-search-app\" rel=\"noopener nofollow\" target=\"_blank\">https://learn.microsoft.com/en-us/dotnet/ai/quickstarts/build-vector-search-app</a></li>\n<li>Exploring Microsoft.Extensions.VectorData with Qdrant and Azure AI Search  <a href=\"https://devblogs.microsoft.com/dotnet/vector-data-qdrant-ai-search-dotnet/\" rel=\"noopener nofollow\" target=\"_blank\">https://devblogs.microsoft.com/dotnet/vector-data-qdrant-ai-search-dotnet/</a></li>\n<li>Announcing .NET 10 - Microsoft Dev Blogs <a href=\"https://devblogs.microsoft.com/dotnet/announcing-dotnet-10/\" rel=\"noopener nofollow\" target=\"_blank\">https://devblogs.microsoft.com/dotnet/announcing-dotnet-10/</a></li>\n<li>Introducing Microsoft Agent Framework (Preview): Making AI Agents Simple for Every Developer <a href=\"https://devblogs.microsoft.com/dotnet/introducing-microsoft-agent-framework-preview/\" rel=\"noopener nofollow\" target=\"_blank\">https://devblogs.microsoft.com/dotnet/introducing-microsoft-agent-framework-preview/</a></li>\n<li>Semantic Kernel to Microsoft Agent Framework Migration Guide ..., <a href=\"https://learn.microsoft.com/en-us/agent-framework/migration-guide/from-semantic-kernel/\" rel=\"noopener nofollow\" target=\"_blank\">https://learn.microsoft.com/en-us/agent-framework/migration-guide/from-semantic-kernel/</a></li>\n<li>AI Agents with Microsoft Agent Framework and Elsa Workflows  <a href=\"https://sipkeschoorstra.medium.com/ai-agents-with-microsoft-agent-framework-and-elsa-workflows-4870e33a7134\" rel=\"noopener nofollow\" target=\"_blank\">https://sipkeschoorstra.medium.com/ai-agents-with-microsoft-agent-framework-and-elsa-workflows-4870e33a7134</a></li>\n<li>4 Game-Changing Features in Microsoftâ€™s New AI Agent Framework-You Need to Know About <a href=\"https://srinivas-mahakud.medium.com/4-game-changing-features-in-microsofts-new-ai-agent-framework-you-need-to-know-about-e7fbcf4fae72\" rel=\"noopener nofollow\" target=\"_blank\">https://srinivas-mahakud.medium.com/4-game-changing-features-in-microsofts-new-ai-agent-framework-you-need-to-know-about-e7fbcf4fae72</a></li>\n<li>Building Enterprise-Grade AI Agents with Microsoft's Agent Framework - <a href=\"https://www.pondhouse-data.com/blog/enterprise-ai-with-microsoft-agent-framework\" rel=\"noopener nofollow\" target=\"_blank\">https://www.pondhouse-data.com/blog/enterprise-ai-with-microsoft-agent-framework</a></li>\n<li>Build Long-Running AI Agents on Azure App Service with Microsoft Agent Framework <a href=\"https://techcommunity.microsoft.com/blog/appsonazureblog/build-long-running-ai-agents-on-azure-app-service-with-microsoft-agent-framework/4463159\" rel=\"noopener nofollow\" target=\"_blank\">https://techcommunity.microsoft.com/blog/appsonazureblog/build-long-running-ai-agents-on-azure-app-service-with-microsoft-agent-framework/4463159</a></li>\n<li>Microsoft Agent Framework (Preview): Build AI Agents in .NET | Syncfusion Blogs, <a href=\"https://www.syncfusion.com/blogs/post/microsoft-agent-framework-preview-ai\" rel=\"noopener nofollow\" target=\"_blank\">https://www.syncfusion.com/blogs/post/microsoft-agent-framework-preview-ai</a></li>\n<li>agent-framework-dotnet-mcp 1.0.7 on npm - <a href=\"http://Libraries.io\" rel=\"noopener nofollow\" target=\"_blank\">Libraries.io</a>  <a href=\"https://libraries.io/npm/agent-framework-dotnet-mcp\" rel=\"noopener nofollow\" target=\"_blank\">https://libraries.io/npm/agent-framework-dotnet-mcp</a></li>\n<li>Microsoft Agent Framework Workflows Orchestrations - Magentic,  <a href=\"https://learn.microsoft.com/en-us/agent-framework/user-guide/workflows/orchestrations/magentic\" rel=\"noopener nofollow\" target=\"_blank\">https://learn.microsoft.com/en-us/agent-framework/user-guide/workflows/orchestrations/magentic</a></li>\n<li>Magentic-One â€” AutoGen - Microsoft Open Source <a href=\"https://microsoft.github.io/autogen/stable//user-guide/agentchat-user-guide/magentic-one.html\" rel=\"noopener nofollow\" target=\"_blank\">https://microsoft.github.io/autogen/stable//user-guide/agentchat-user-guide/magentic-one.html</a></li>\n<li>Exploring Semanti Kernel Magentic Agent Orchestratio <a href=\"https://medium.com/@sainitesh/exploring-semanti-kernel-magentic-agent-orchestration-146deecc4c41\" rel=\"noopener nofollow\" target=\"_blank\">https://medium.com/@sainitesh/exploring-semanti-kernel-magentic-agent-orchestration-146deecc4c41</a></li>\n<li>Microsoft Agent Framework Workflows | Microsoft Learn <a href=\"https://learn.microsoft.com/en-us/agent-framework/user-guide/workflows/overview\" rel=\"noopener nofollow\" target=\"_blank\">https://learn.microsoft.com/en-us/agent-framework/user-guide/workflows/overview</a></li>\n<li>Checkpointing and Resuming Workflows  <a href=\"https://learn.microsoft.com/en-us/agent-framework/tutorials/workflows/checkpointing-and-resuming\" rel=\"noopener nofollow\" target=\"_blank\">https://learn.microsoft.com/en-us/agent-framework/tutorials/workflows/checkpointing-and-resuming</a></li>\n<li>microsoft/agent-framework dotnet-1.0.0-nightly-251001.2  <a href=\"https://newreleases.io/project/github/microsoft/agent-framework/release/dotnet-1.0.0-nightly-251001.2\" rel=\"noopener nofollow\" target=\"_blank\">https://newreleases.io/project/github/microsoft/agent-framework/release/dotnet-1.0.0-nightly-251001.2</a></li>\n<li>Microsoft.Agents.AI 1.0.0-preview.251001.3   <a href=\"https://www.nuget.org/packages/Microsoft.Agents.AI/1.0.0-preview.251001.3\" rel=\"noopener nofollow\" target=\"_blank\">https://www.nuget.org/packages/Microsoft.Agents.AI/1.0.0-preview.251001.3</a></li>\n<li>Build a Multiple-Agent Workflow Automation Solution by using Microsoft Agent Framework - Azure Architecture Center <a href=\"https://learn.microsoft.com/en-us/azure/architecture/ai-ml/idea/multiple-agent-workflow-automation\" rel=\"noopener nofollow\" target=\"_blank\">https://learn.microsoft.com/en-us/azure/architecture/ai-ml/idea/multiple-agent-workflow-automation</a></li>\n<li>Microsoft Agent Framework: Advancing The Agentic DevOps Vision - The Futurum Group <a href=\"https://futurumgroup.com/insights/microsoft-agent-framework-advancing-the-agentic-devops-vision/\" rel=\"noopener nofollow\" target=\"_blank\">https://futurumgroup.com/insights/microsoft-agent-framework-advancing-the-agentic-devops-vision/</a></li>\n</ol>\n\n\n</div>\n<div id=\"MySignature\">\n    <p>æ¬¢è¿å¤§å®¶æ‰«æä¸‹é¢äºŒç»´ç æˆä¸ºæˆ‘çš„å®¢æˆ·ï¼Œæ‰¶ä½ ä¸Šäº‘</p>\n<img src=\"https://images.cnblogs.com/cnblogs_com/shanyou/57459/o_220125090408_%E9%82%80%E8%AF%B7%E4%BA%8C%E7%BB%B4%E7%A0%81-258px.jpeg\" width=\"170\" />\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-02 07:45</span>&nbsp;\n<a href=\"https://www.cnblogs.com/shanyou\">å¼ å–„å‹</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">115</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "Debian 13åŸºäºkubeadmå’Œcontainerdéƒ¨ç½²å•èŠ‚ç‚¹kubernetes",
      "link": "https://www.cnblogs.com/XY-Heruo/p/19560948",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/XY-Heruo/p/19560948\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-01 16:03\">\n    <span>Debian 13åŸºäºkubeadmå’Œcontainerdéƒ¨ç½²å•èŠ‚ç‚¹kubernetes</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        åœ¨æœ¬åœ°è™šæ‹Ÿæœºç¯å¢ƒä¸­ä½¿ç”¨ kubeadm+containerd+harbor+cilium æ­å»º Kubernetes é›†ç¾¤\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h2 id=\"å‰è¨€\">å‰è¨€</h2>\n<p>åœ¨æœ¬åœ°è™šæ‹Ÿæœºç¯å¢ƒä¸­ä½¿ç”¨ kubeadm æ­å»º Kubernetes é›†ç¾¤æ˜¯å­¦ä¹ å’Œå®éªŒçš„ç†æƒ³é€‰æ‹©ã€‚è€ƒè™‘åˆ°å®é™…åº”ç”¨åœºæ™¯ä¸­å¯èƒ½å­˜åœ¨çš„ç½‘ç»œé™åˆ¶ä»¥åŠé•œåƒæ„å»ºéœ€æ±‚ï¼Œæœ¬æ–‡è¯¦ç»†è®°å½•äº†åœ¨å®Œå…¨ç¦»çº¿ç¯å¢ƒä¸‹éƒ¨ç½²å•èŠ‚ç‚¹ Kubernetes é›†ç¾¤çš„å®Œæ•´è¿‡ç¨‹ã€‚é€šè¿‡é›†æˆ Harbor ç§æœ‰é•œåƒä»“åº“ï¼Œæ‰€æœ‰ Kubernetes ç»„ä»¶é•œåƒå‡ä»æœ¬åœ° Harbor å®ä¾‹æ‹‰å–ï¼Œç¡®ä¿éƒ¨ç½²è¿‡ç¨‹çš„å¯é æ€§å’Œå¯é‡å¤æ€§ã€‚</p>\n<p>æœ¬æŒ‡å—é€‚ç”¨äºå¸Œæœ›åœ¨å—é™ç½‘ç»œç¯å¢ƒä¸­å¿«é€Ÿæ­å»º Kubernetes å®éªŒç¯å¢ƒçš„æŠ€æœ¯äººå‘˜ï¼Œæ¶µç›–äº†ä»ç³»ç»Ÿåˆå§‹åŒ–åˆ° Cilium ç½‘ç»œæ’ä»¶é…ç½®çš„å…¨æµç¨‹ã€‚</p>\n<h2 id=\"ç¯å¢ƒå’Œç‰ˆæœ¬ä¿¡æ¯\">ç¯å¢ƒå’Œç‰ˆæœ¬ä¿¡æ¯</h2>\n<h3 id=\"åŸºç¡€ç¯å¢ƒé…ç½®\">åŸºç¡€ç¯å¢ƒé…ç½®</h3>\n<ul>\n<li><strong>æ“ä½œç³»ç»Ÿ</strong>ï¼šDebian 13 (ä»£å· \"Trixie\")</li>\n<li><strong>ç¡¬ä»¶è§„æ ¼</strong>ï¼š4 æ ¸ CPU / 4GB å†…å­˜ / 40GB å­˜å‚¨ç©ºé—´</li>\n<li><strong>ç½‘ç»œæ‹“æ‰‘</strong>ï¼šå•èŠ‚ç‚¹éƒ¨ç½²ï¼ˆControl Plane + Worker åˆä¸€ï¼‰</li>\n</ul>\n<h3 id=\"è½¯ä»¶ç‰ˆæœ¬æ¸…å•\">è½¯ä»¶ç‰ˆæœ¬æ¸…å•</h3>\n<table>\n<thead>\n<tr>\n<th>ç»„ä»¶</th>\n<th>ç‰ˆæœ¬</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Kubernetes</td>\n<td>v1.33.7</td>\n<td>å®¹å™¨ç¼–æ’å¹³å°</td>\n</tr>\n<tr>\n<td>containerd</td>\n<td>2.2.1</td>\n<td>å®¹å™¨è¿è¡Œæ—¶</td>\n</tr>\n<tr>\n<td>runc</td>\n<td>1.4.0</td>\n<td>OCI è¿è¡Œæ—¶è§„èŒƒå®ç°</td>\n</tr>\n<tr>\n<td>CNI Plugins</td>\n<td>1.9.0</td>\n<td>å®¹å™¨ç½‘ç»œæ¥å£æ’ä»¶</td>\n</tr>\n<tr>\n<td>Harbor</td>\n<td>v2.14.2</td>\n<td>ä¼ä¸šçº§å®¹å™¨é•œåƒä»“åº“</td>\n</tr>\n<tr>\n<td>Cilium</td>\n<td>v1.18.6</td>\n<td>eBPF é©±åŠ¨çš„ç½‘ç»œå’Œå®‰å…¨è§£å†³æ–¹æ¡ˆ</td>\n</tr>\n<tr>\n<td>Helm</td>\n<td>3.19.5</td>\n<td>Kubernetes åŒ…ç®¡ç†å™¨</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ç½‘ç»œè§„åˆ’\">ç½‘ç»œè§„åˆ’</h3>\n<table>\n<thead>\n<tr>\n<th>IP åœ°å€</th>\n<th>ä¸»æœºå</th>\n<th>è§’è‰²</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>192.168.0.22</td>\n<td>deb13-k8s-node1</td>\n<td>Kubernetes èŠ‚ç‚¹</td>\n</tr>\n<tr>\n<td>192.168.0.42</td>\n<td>deb13-harbor</td>\n<td>Harbor é•œåƒä»“åº“</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p><strong>æ³¨æ„</strong>ï¼šæœ¬æ–‡æ¡£å‡è®¾ä¸¤å°ä¸»æœºä½äºåŒä¸€å†…ç½‘ç¯å¢ƒä¸­ï¼Œä¸”ç½‘ç»œè¿é€šæ€§å·²éªŒè¯ã€‚</p>\n</blockquote>\n<h2 id=\"ç³»ç»Ÿåˆå§‹åŒ–\">ç³»ç»Ÿåˆå§‹åŒ–</h2>\n<p>åœ¨å¼€å§‹ Kubernetes ç»„ä»¶å®‰è£…ä¹‹å‰ï¼Œéœ€è¦å¯¹ç³»ç»Ÿè¿›è¡Œå¿…è¦çš„åˆå§‹åŒ–é…ç½®ï¼Œä»¥æ»¡è¶³ Kubernetes çš„è¿è¡Œè¦æ±‚ã€‚</p>\n<h3 id=\"1-å®‰è£…-ipvs-ç›¸å…³å·¥å…·åŒ…\">1. å®‰è£… IPVS ç›¸å…³å·¥å…·åŒ…</h3>\n<p>IPVSï¼ˆIP Virtual Serverï¼‰æ˜¯ Linux å†…æ ¸çš„è´Ÿè½½å‡è¡¡å®ç°ï¼ŒKubernetes åœ¨ IPVS æ¨¡å¼ä¸‹è¿è¡Œ kube-proxy æ—¶éœ€è¦ç›¸å…³å·¥å…·æ”¯æŒã€‚</p>\n<pre><code class=\"language-bash\"># ä»…åœ¨ Kubernetes èŠ‚ç‚¹æ‰§è¡Œ\nsudo apt update\nsudo apt install -y ipvsadm ipset\n</code></pre>\n<h3 id=\"2-é…ç½®ä¸»æœºå\">2. é…ç½®ä¸»æœºå</h3>\n<p>ä¸ºä¾¿äºç®¡ç†å’Œè¯†åˆ«ï¼Œå»ºè®®ä¸ºæ¯å°ä¸»æœºè®¾ç½®æœ‰æ„ä¹‰çš„ä¸»æœºåã€‚</p>\n<pre><code class=\"language-bash\"># Harbor æœåŠ¡å™¨\nhostnamectl set-hostname deb13-harbor\n\n# Kubernetes èŠ‚ç‚¹\nhostnamectl set-hostname deb13-k8s-node1\n</code></pre>\n<h3 id=\"3-é…ç½®æœ¬åœ°-dns-è§£æ\">3. é…ç½®æœ¬åœ° DNS è§£æ</h3>\n<p>ç¼–è¾‘ <code>/etc/hosts</code> æ–‡ä»¶ï¼Œæ·»åŠ ä¸»æœºåä¸ IP åœ°å€çš„æ˜ å°„å…³ç³»ï¼š</p>\n<pre><code class=\"language-bash\">cat &gt;&gt; /etc/hosts &lt;&lt; EOF\n192.168.0.22 deb13-k8s-node1\n192.168.0.42 deb13-harbor\nEOF\n</code></pre>\n<h3 id=\"4-åŠ è½½å¿…è¦çš„å†…æ ¸æ¨¡å—\">4. åŠ è½½å¿…è¦çš„å†…æ ¸æ¨¡å—</h3>\n<p>Kubernetes ä¾èµ–ç‰¹å®šçš„å†…æ ¸æ¨¡å—æ¥æ”¯æŒå®¹å™¨ç½‘ç»œåŠŸèƒ½ã€‚åˆ›å»ºæ¨¡å—åŠ è½½é…ç½®å¹¶ç«‹å³ç”Ÿæ•ˆï¼š</p>\n<pre><code class=\"language-bash\"># åˆ›å»ºæ¨¡å—åŠ è½½é…ç½®æ–‡ä»¶\ncat &lt;&lt; EOF &gt; /etc/modules-load.d/containerd.conf\noverlay\nbr_netfilter\nEOF\n\n# ç«‹å³åŠ è½½æ¨¡å—\nsudo modprobe overlay\nsudo modprobe br_netfilter\n\n# éªŒè¯æ¨¡å—åŠ è½½çŠ¶æ€\nlsmod | grep -E \"(overlay|br_netfilter)\"\n</code></pre>\n<h3 id=\"5-é…ç½®ç³»ç»Ÿå†…æ ¸å‚æ•°\">5. é…ç½®ç³»ç»Ÿå†…æ ¸å‚æ•°</h3>\n<p>è°ƒæ•´å†…æ ¸å‚æ•°ä»¥ä¼˜åŒ–å®¹å™¨è¿è¡Œç¯å¢ƒï¼š</p>\n<pre><code class=\"language-bash\">cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF\nnet.ipv4.ip_forward=1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nvm.swappiness = 0\nEOF\n\n# åº”ç”¨é…ç½®\nsudo sysctl --system\n</code></pre>\n<blockquote>\n<p><strong>é‡è¦æç¤º</strong>ï¼šå¦‚æœç³»ç»Ÿå¯ç”¨äº† swap åˆ†åŒºï¼Œå¿…é¡»åœ¨ Kubernetes å¯åŠ¨å‰å°†å…¶å…³é—­ï¼Œå¦åˆ™ kubelet å°†æ— æ³•æ­£å¸¸å¯åŠ¨ã€‚å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤ä¸´æ—¶å…³é—­ï¼š</p>\n</blockquote>\n<pre><code class=\"language-bash\">sudo swapoff -a\n# æ°¸ä¹…å…³é—­éœ€æ³¨é‡Š /etc/fstab ä¸­çš„ swap ç›¸å…³è¡Œ\n</code></pre>\n<h2 id=\"harbor-ç§æœ‰é•œåƒä»“åº“éƒ¨ç½²\">Harbor ç§æœ‰é•œåƒä»“åº“éƒ¨ç½²</h2>\n<p>Harbor ä½œä¸ºä¼ä¸šçº§å®¹å™¨é•œåƒä»“åº“ï¼Œä¸ºç¦»çº¿ç¯å¢ƒä¸‹çš„ Kubernetes éƒ¨ç½²æä¾›äº†å¯é çš„é•œåƒåˆ†å‘èƒ½åŠ›ã€‚</p>\n<h3 id=\"1-å‡†å¤‡-harbor-å®‰è£…åŒ…\">1. å‡†å¤‡ Harbor å®‰è£…åŒ…</h3>\n<p>ä» <a href=\"https://github.com/goharbor/harbor/releases\" rel=\"noopener nofollow\" target=\"_blank\">Harbor GitHub Releases</a> é¡µé¢ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…ï¼ˆçº¦ 600MBï¼‰ã€‚å®‰è£… Harbor å‰éœ€ç¡®ä¿ Docker å’Œ Docker Compose å·²æ­£ç¡®å®‰è£…ã€‚</p>\n<h3 id=\"2-ç”Ÿæˆè‡ªç­¾å-tls-è¯ä¹¦\">2. ç”Ÿæˆè‡ªç­¾å TLS è¯ä¹¦</h3>\n<p>ç”±äº Harbor å¼ºåˆ¶è¦æ±‚ HTTPS è¿æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸º Harbor æœåŠ¡å™¨ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ã€‚åˆ›å»ºè¯ä¹¦ç”Ÿæˆè„šæœ¬ï¼š</p>\n<pre><code class=\"language-bash\"># åˆ›å»ºè¯ä¹¦ç›®å½•\nmkdir -p ~/apps/harbor/certs\ncd ~/apps/harbor/certs\n\n# åˆ›å»ºè¯ä¹¦ç”Ÿæˆè„šæœ¬\ncat &gt; gen-harbor-crt.sh &lt;&lt; 'EOF'\n#!/bin/bash\n\n# --- é…ç½®å‚æ•° ---\nDOMAIN=\"deb13-harbor\"       # Harbor åŸŸå\nIP=\"192.168.0.42\"           # Harbor æœåŠ¡å™¨å†…ç½‘ IP\nDAYS=3650                   # æœ‰æ•ˆæœŸ 10 å¹´\n\n# 1. ç”Ÿæˆç§é’¥ (æ— å¯†ç )\nopenssl genrsa -out harbor.key 2048\n\n# 2. åˆ›å»º OpenSSL é…ç½®æ–‡ä»¶ä»¥åŒ…å« SAN\ncat &gt; harbor.conf &lt;&lt; CONF_EOF\n[req]\ndistinguished_name = req_distinguished_name\nx509_extensions = v3_req\nprompt = no\n\n[req_distinguished_name]\nCN = ${DOMAIN}\n\n[v3_req]\nkeyUsage = critical, digitalSignature, keyEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1 = ${DOMAIN}\nIP.1 = ${IP}\nCONF_EOF\n\n# 3. ç”Ÿæˆè‡ªç­¾åè¯ä¹¦\nopenssl req -x509 -nodes -days ${DAYS} -key harbor.key -out harbor.crt -config harbor.conf -extensions v3_req\n\n# 4. éªŒè¯è¯ä¹¦ï¼ˆæŸ¥çœ‹æ˜¯å¦æœ‰ Subject Alternative Name å­—æ®µï¼‰\necho \"--------------------------------------------------\"\necho \"è¯ä¹¦ä¿¡æ¯éªŒè¯ï¼š\"\nopenssl x509 -in harbor.crt -text -noout | grep -A 1 \"Subject Alternative Name\"\n\necho \"--------------------------------------------------\"\necho \"ç”ŸæˆæˆåŠŸï¼\"\necho \"æœåŠ¡ç«¯ä½¿ç”¨: harbor.crt, harbor.key\"\necho \"å®¢æˆ·ç«¯ (K8s èŠ‚ç‚¹) ä½¿ç”¨: harbor.crt\"\nEOF\n\n# æ‰§è¡Œè¯ä¹¦ç”Ÿæˆ\nchmod +x gen-harbor-crt.sh\n./gen-harbor-crt.sh\n</code></pre>\n<h3 id=\"3-é…ç½®-harbor\">3. é…ç½® Harbor</h3>\n<p>ä»æ¨¡æ¿æ–‡ä»¶å¤åˆ¶å¹¶ä¿®æ”¹ Harbor é…ç½®ï¼š</p>\n<pre><code class=\"language-bash\"># å¤åˆ¶é…ç½®æ¨¡æ¿\ncp harbor.yml.tmpl harbor.yml\n\n# ä¿®æ”¹å…³é”®é…ç½®é¡¹\n</code></pre>\n<p>ä¸»è¦é…ç½®é¡¹å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-yaml\"># Harbor è®¿é—®åœ°å€\nhostname: 192.168.0.42\n\n# HTTPS é…ç½®\nhttps:\n  port: 443\n  certificate: /home/rainux/apps/harbor/certs/harbor.crt\n  private_key: /home/rainux/apps/harbor/certs/harbor.key\n\n# ç®¡ç†å‘˜å¯†ç ï¼ˆè¯·è®¾ç½®å¼ºå¯†ç ï¼‰\nharbor_admin_password: your-harbor-password\n\n# æ•°æ®åº“å¯†ç \ndatabase:\n  password: your-db-password\n\n# æ•°æ®å­˜å‚¨è·¯å¾„\ndata_volume: /home/rainux/apps/harbor/data\n\n# æ—¥å¿—é…ç½®\nlog:\n  location: /home/rainux/apps/harbor/logs\n\n# å¯ç”¨æŒ‡æ ‡ç›‘æ§\nmetric:\n  enabled: true\n  port: 9090\n  path: /metrics\n</code></pre>\n<h3 id=\"4-å¯åŠ¨-harbor-æœåŠ¡\">4. å¯åŠ¨ Harbor æœåŠ¡</h3>\n<pre><code class=\"language-bash\">cd ~/apps/harbor\nsudo ./install.sh\n</code></pre>\n<h3 id=\"5-åˆå§‹åŒ–-harbor-é¡¹ç›®\">5. åˆå§‹åŒ– Harbor é¡¹ç›®</h3>\n<p>é€šè¿‡ Web ç•Œé¢è®¿é—® Harborï¼ˆ<a href=\"https://192.168.0.42\" rel=\"noopener nofollow\" target=\"_blank\">https://192.168.0.42</a>ï¼‰ï¼Œä½¿ç”¨é…ç½®çš„ç®¡ç†å‘˜å¯†ç ç™»å½•åï¼Œåˆ›å»ºä»¥ä¸‹ä¸¤ä¸ªå…¬å¼€é¡¹ç›®ï¼š</p>\n<ul>\n<li><code>google_containers</code>ï¼šç”¨äºå­˜å‚¨ Kubernetes æ ¸å¿ƒç»„ä»¶é•œåƒ</li>\n<li><code>cilium</code>ï¼šç”¨äºå­˜å‚¨ Cilium ç½‘ç»œæ’ä»¶ç›¸å…³é•œåƒ</li>\n</ul>\n<blockquote>\n<p><strong>é…ç½®æ›´æ–°è¯´æ˜</strong>ï¼šå¦‚éœ€ä¿®æ”¹ Harbor é…ç½®ï¼Œå¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆï¼š</p>\n<pre><code class=\"language-bash\">sudo ./prepare\ndocker-compose down -v\nsudo docker-compose up -d\n</code></pre>\n</blockquote>\n<h2 id=\"containerd-å®¹å™¨è¿è¡Œæ—¶é…ç½®\">Containerd å®¹å™¨è¿è¡Œæ—¶é…ç½®</h2>\n<p>Containerd ä½œä¸ºè½»é‡çº§å®¹å™¨è¿è¡Œæ—¶ï¼Œæ˜¯ Kubernetes æ¨èçš„è¿è¡Œæ—¶é€‰é¡¹ä¹‹ä¸€ã€‚</p>\n<h3 id=\"1-ä¸‹è½½å¿…è¦ç»„ä»¶\">1. ä¸‹è½½å¿…è¦ç»„ä»¶</h3>\n<p>ä»å®˜æ–¹ GitHub ä»“åº“ä¸‹è½½ä»¥ä¸‹ç»„ä»¶ï¼š</p>\n<ul>\n<li><a href=\"https://github.com/containerd/containerd/releases\" rel=\"noopener nofollow\" target=\"_blank\">containerd</a></li>\n<li><a href=\"https://github.com/opencontainers/runc/releases\" rel=\"noopener nofollow\" target=\"_blank\">runc</a></li>\n<li><a href=\"https://github.com/containernetworking/plugins/releases\" rel=\"noopener nofollow\" target=\"_blank\">CNI Plugins</a></li>\n</ul>\n<h3 id=\"2-å®‰è£…-runc\">2. å®‰è£… runc</h3>\n<pre><code class=\"language-bash\"># æ³¨æ„ï¼šåŸæ–‡ä¸­çš„æ–‡ä»¶åå¯èƒ½å­˜åœ¨ç¬”è¯¯ï¼Œåº”ä¸º runc.amd64\nchmod +x runc.amd64\nsudo mv runc.amd64 /usr/local/bin/runc\n</code></pre>\n<h3 id=\"3-å®‰è£…-cni-æ’ä»¶\">3. å®‰è£… CNI æ’ä»¶</h3>\n<pre><code class=\"language-bash\">sudo mkdir -p /opt/cni/bin/\nsudo tar xf cni-plugins-linux-amd64-v1.9.0.tgz -C /opt/cni/bin/\n</code></pre>\n<h3 id=\"4-å®‰è£…-containerd\">4. å®‰è£… containerd</h3>\n<pre><code class=\"language-bash\">sudo tar xf containerd-2.2.1-linux-amd64.tar.gz\nsudo mv bin/* /usr/local/bin/\n</code></pre>\n<h3 id=\"5-é…ç½®-containerd\">5. é…ç½® containerd</h3>\n<p>ç”Ÿæˆé»˜è®¤é…ç½®å¹¶è¿›è¡Œå¿…è¦çš„ä¿®æ”¹ï¼š</p>\n<pre><code class=\"language-bash\"># åˆ›å»º Harbor è¯ä¹¦ç›®å½•\nsudo mkdir -p /etc/containerd/certs.d/192.168.0.42/\n\n# ç”Ÿæˆé»˜è®¤é…ç½®\nsudo containerd config default &gt; /etc/containerd/config.toml\n\n# å¤åˆ¶ Harbor è¯ä¹¦\nsudo cp ~/apps/harbor/certs/harbor.crt /etc/containerd/certs.d/192.168.0.42/ca.crt\n</code></pre>\n<p>å…³é”®é…ç½®ä¿®æ”¹ï¼š</p>\n<pre><code class=\"language-toml\"># è®¾ç½® Pod æ²™ç®±é•œåƒæº\n[plugins.'io.containerd.cri.v1.images'.pinned_images]\n  sandbox = '192.168.0.42/google_containers/pause:3.10'\n\n# é…ç½®ç§æœ‰é•œåƒä»“åº“\n[plugins.'io.containerd.cri.v1.images'.registry]\n  config_path = '/etc/containerd/certs.d'\n\n# å¯ç”¨ systemd cgroup é©±åŠ¨\n[plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.runc.options]\n  SystemdCgroup = true\n</code></pre>\n<h3 id=\"6-é…ç½®-systemd-æœåŠ¡\">6. é…ç½® systemd æœåŠ¡</h3>\n<p>ä» <a href=\"https://raw.githubusercontent.com/containerd/containerd/main/containerd.service\" rel=\"noopener nofollow\" target=\"_blank\">å®˜æ–¹ä»“åº“</a> è·å– service æ–‡ä»¶ï¼š</p>\n<pre><code class=\"language-bash\">sudo curl -o /usr/lib/systemd/system/containerd.service https://raw.githubusercontent.com/containerd/containerd/main/containerd.service\n</code></pre>\n<h3 id=\"7-å¯åŠ¨-containerd-æœåŠ¡\">7. å¯åŠ¨ containerd æœåŠ¡</h3>\n<pre><code class=\"language-bash\">sudo systemctl daemon-reload\nsudo systemctl enable --now containerd\n</code></pre>\n<h2 id=\"kubernetes-ç»„ä»¶éƒ¨ç½²\">Kubernetes ç»„ä»¶éƒ¨ç½²</h2>\n<h3 id=\"1-å®‰è£…-kubernetes-äºŒè¿›åˆ¶æ–‡ä»¶\">1. å®‰è£… Kubernetes äºŒè¿›åˆ¶æ–‡ä»¶</h3>\n<p>ä» <a href=\"https://github.com/kubernetes/kubernetes/releases\" rel=\"noopener nofollow\" target=\"_blank\">Kubernetes GitHub Releases</a> ä¸‹è½½ <code>kubernetes-server-linux-amd64.tar.gz</code>ï¼Œæå–æ ¸å¿ƒç»„ä»¶ï¼š</p>\n<pre><code class=\"language-bash\"># è§£å‹å¹¶å®‰è£…æ ¸å¿ƒç»„ä»¶\ntar xf kubernetes-server-linux-amd64.tar.gz\nsudo cp kubernetes/server/bin/{kubeadm,kubelet,kubectl} /usr/local/bin/\n\n# éªŒè¯æ‰€éœ€é•œåƒåˆ—è¡¨\nkubeadm config images list --kubernetes-version v1.33.7\n</code></pre>\n<p>å°†åˆ—å‡ºçš„æ‰€æœ‰é•œåƒï¼ˆåŒ…æ‹¬ pauseã€corednsã€etcd ç­‰ï¼‰ä»å®˜æ–¹æºæ‹‰å–åé‡æ–°æ‰“æ ‡ç­¾å¹¶æ¨é€åˆ° Harbor çš„ <code>google_containers</code> é¡¹ç›®ä¸­ã€‚</p>\n<h3 id=\"2-é…ç½®-kubelet-systemd-æœåŠ¡\">2. é…ç½® kubelet systemd æœåŠ¡</h3>\n<p>åˆ›å»ºä¸»æœåŠ¡æ–‡ä»¶ <code>/usr/lib/systemd/system/kubelet.service</code>ï¼š</p>\n<pre><code class=\"language-ini\">[Unit]\nDescription=kubelet: The Kubernetes Node Agent\nDocumentation=https://kubernetes.io/docs/\nWants=network-online.target\nAfter=network-online.target\n\n[Service]\nExecStart=/usr/local/bin/kubelet\nRestart=always\nStartLimitInterval=0\nRestartSec=10\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<h3 id=\"3-åˆ›å»º-kubeadm-é…ç½®ç›®å½•\">3. åˆ›å»º kubeadm é…ç½®ç›®å½•</h3>\n<pre><code class=\"language-bash\">sudo mkdir -p /usr/lib/systemd/system/kubelet.service.d/\n</code></pre>\n<h3 id=\"4-é…ç½®-kubeadm-drop-in-æ–‡ä»¶\">4. é…ç½® kubeadm drop-in æ–‡ä»¶</h3>\n<p>åˆ›å»º <code>/usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf</code>ï¼š</p>\n<pre><code class=\"language-ini\"># Note: This dropin only works with kubeadm and kubelet v1.11+\n[Service]\nEnvironment=\"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf\"\nEnvironment=\"KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml\"\n# This is a file that \"kubeadm init\" and \"kubeadm join\" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically\nEnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env\n# This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use\n# the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.\nEnvironmentFile=-/etc/sysconfig/kubelet\nExecStart=\nExecStart=/usr/local/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS\n</code></pre>\n<h3 id=\"5-å¯åŠ¨-kubelet-æœåŠ¡\">5. å¯åŠ¨ kubelet æœåŠ¡</h3>\n<pre><code class=\"language-bash\">sudo systemctl daemon-reload\nsudo systemctl enable --now kubelet\n</code></pre>\n<h2 id=\"é›†ç¾¤åˆå§‹åŒ–\">é›†ç¾¤åˆå§‹åŒ–</h2>\n<h3 id=\"1-åˆ›å»º-kubeadm-é…ç½®æ–‡ä»¶\">1. åˆ›å»º kubeadm é…ç½®æ–‡ä»¶</h3>\n<p>åˆ›å»º <code>kubeadm-config.yaml</code> é…ç½®æ–‡ä»¶ï¼š</p>\n<pre><code class=\"language-yaml\">apiVersion: kubeadm.k8s.io/v1beta4\nkind: ClusterConfiguration\nkubernetesVersion: v1.33.7\nimageRepository: 192.168.0.42/google_containers  # æŒ‡å‘æœ¬åœ° Harbor ä»“åº“\nnetworking:\n  podSubnet: \"10.10.0.0/16\"   # Cilium é»˜è®¤ Pod ç½‘æ®µ\n  serviceSubnet: \"10.96.0.0/12\"\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\ncgroupDriver: systemd\nimageGCHighThresholdPercent: 70   # ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡ 70% æ—¶å¼€å§‹æ¸…ç†é•œåƒ\nimageGCLowThresholdPercent: 60    # æ¸…ç†è‡³ç£ç›˜ä½¿ç”¨ç‡ 60% æ—¶åœæ­¢\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: \"ipvs\"  # è™½ç„¶åç»­ä¼šä½¿ç”¨ Cilium æ›¿ä»£ kube-proxyï¼Œä½†åˆå§‹åŒ–é˜¶æ®µä»éœ€é…ç½®\n</code></pre>\n<h3 id=\"2-æ‰§è¡Œé›†ç¾¤åˆå§‹åŒ–\">2. æ‰§è¡Œé›†ç¾¤åˆå§‹åŒ–</h3>\n<pre><code class=\"language-bash\">sudo kubeadm init --config kubeadm-config.yaml --ignore-preflight-errors=ImagePull\n</code></pre>\n<h3 id=\"3-æ¸…ç†-kube-proxyä½¿ç”¨-cilium-æ›¿ä»£\">3. æ¸…ç† kube-proxyï¼ˆä½¿ç”¨ Cilium æ›¿ä»£ï¼‰</h3>\n<p>ç”±äºæˆ‘ä»¬å°†ä½¿ç”¨ Cilium ä½œä¸ºç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ç§»é™¤ kube-proxyï¼š</p>\n<pre><code class=\"language-bash\"># åˆ é™¤ kube-proxy DaemonSet\nkubectl delete ds kube-proxy -n kube-system\n\n# åœ¨æ‰€æœ‰èŠ‚ç‚¹æ¸…ç† iptables è§„åˆ™æ®‹ç•™\nsudo kube-proxy --cleanup\n</code></pre>\n<h3 id=\"4-éªŒè¯åˆå§‹åŒ–çŠ¶æ€\">4. éªŒè¯åˆå§‹åŒ–çŠ¶æ€</h3>\n<p>åˆå§‹åŒ–å®Œæˆåï¼Œé…ç½® kubectl å¹¶æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼š</p>\n<pre><code class=\"language-bash\"># é…ç½® kubectl\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n# æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€ï¼ˆæ­¤æ—¶åº”æ˜¾ç¤º NotReadyï¼Œå› ä¸º CNI å°šæœªå®‰è£…ï¼‰\nkubectl get nodes\nkubectl get namespaces\n</code></pre>\n<h2 id=\"cilium-ç½‘ç»œæ’ä»¶éƒ¨ç½²\">Cilium ç½‘ç»œæ’ä»¶éƒ¨ç½²</h2>\n<p>Cilium åŸºäº eBPF æŠ€æœ¯æä¾›é«˜æ€§èƒ½çš„ç½‘ç»œã€å®‰å…¨å’Œå¯è§‚æµ‹æ€§åŠŸèƒ½ã€‚</p>\n<h3 id=\"1-å®‰è£…-cilium-cli\">1. å®‰è£… cilium-cli</h3>\n<p>ä» <a href=\"https://github.com/cilium/cilium-cli/releases\" rel=\"noopener nofollow\" target=\"_blank\">Cilium CLI Releases</a> ä¸‹è½½å¹¶å®‰è£…å‘½ä»¤è¡Œå·¥å…·ã€‚</p>\n<h3 id=\"2-å‡†å¤‡-cilium-é•œåƒ\">2. å‡†å¤‡ Cilium é•œåƒ</h3>\n<p>å°† Cilium æ‰€éœ€çš„é•œåƒæ¨é€åˆ° Harbor ä»“åº“ï¼š</p>\n<pre><code class=\"language-bash\">#!/bin/bash\n\nset -euo pipefail\n\nimages=(\n    cilium/cilium:v1.18.6\n    cilium/hubble-relay:v1.18.6\n    cilium/hubble-ui-backend:v0.13.3\n    cilium/hubble-ui:v0.13.3\n    cilium/cilium-envoy:v1.35.9-1767794330-db497dd19e346b39d81d7b5c0dedf6c812bcc5c9\n    cilium/certgen:v0.3.1\n    cilium/startup-script:1755531540-60ee83e\n)\n\nsrc_registry=\"quay.io\"\ntarget_registry=\"192.168.0.42\"\n\nfor image in \"${images[@]}\"; do\n    echo \"Processing image: ${image}\"\n    docker pull \"${src_registry}/${image}\"\n    docker tag \"${src_registry}/${image}\" \"${target_registry}/${image}\"\n    docker push \"${target_registry}/${image}\"\ndone\n</code></pre>\n<h3 id=\"3-è·å–-helm-chart\">3. è·å– Helm Chart</h3>\n<pre><code class=\"language-bash\">helm repo add cilium https://helm.cilium.io/\nhelm pull cilium/cilium --version 1.18.6\ntar xf cilium-1.18.6.tgz\nmv cilium cilium-chart\n</code></pre>\n<h3 id=\"4-é…ç½®-chart-values\">4. é…ç½® Chart Values</h3>\n<p>é¦–å…ˆæ›¿æ¢æ‰€æœ‰é•œåƒæºåœ°å€ï¼š</p>\n<pre><code class=\"language-bash\">sed -i 's#quay.io#192.168.0.42#g' ./cilium-chart/values.yaml\n</code></pre>\n<p>å…³é”®é…ç½®é¡¹è°ƒæ•´ï¼š</p>\n<pre><code class=\"language-yaml\"># å¯ç”¨ kube-proxy æ›¿ä»£æ¨¡å¼\nkubeProxyReplacement: true\n\n# æŒ‡å®š Kubernetes API æœåŠ¡å™¨åœ°å€\nk8sServiceHost: \"192.168.0.22\"\nk8sServicePort: 6443\n\n# å•èŠ‚ç‚¹éƒ¨ç½²ï¼Œoperator å‰¯æœ¬æ•°è®¾ä¸º 1\noperator:\n  replicas: 1\n\n# å¯ç”¨ Hubble å¯è§‚æµ‹æ€§ç»„ä»¶\nhubble:\n  enabled: true\n  relay:\n    enabled: true\n  ui:\n    enabled: true\n\n# é…ç½® IPAM CIDR èŒƒå›´\nipam:\n  operator:\n    clusterPoolIPv4PodCIDRList:\n      - \"10.10.0.0/16\"\n</code></pre>\n<blockquote>\n<p><strong>é•œåƒ Digest æ³¨æ„äº‹é¡¹</strong>ï¼šé€šè¿‡ docker pull å† push çš„æ–¹å¼å¯èƒ½å¯¼è‡´é•œåƒ digest å‘ç”Ÿå˜åŒ–ã€‚å¦‚é‡é•œåƒæ‹‰å–å¤±è´¥ï¼Œå¯å°† <code>values.yaml</code> ä¸­çš„ <code>useDigest</code> è®¾ç½®ä¸º <code>false</code>ã€‚</p>\n</blockquote>\n<h3 id=\"5-å®‰è£…-cilium\">5. å®‰è£… Cilium</h3>\n<pre><code class=\"language-bash\"># æ‰§è¡Œå®‰è£…\ncilium install --chart-directory ./cilium-chart\n\n# æ£€æŸ¥å®‰è£…çŠ¶æ€\ncilium status\n\n# ç§»é™¤ control-plane æ±¡ç‚¹ä»¥å…è®¸ Pod è°ƒåº¦\nkubectl taint nodes --all node-role.kubernetes.io/control-plane-\n</code></pre>\n<h3 id=\"6-éªŒè¯é›†ç¾¤çŠ¶æ€\">6. éªŒè¯é›†ç¾¤çŠ¶æ€</h3>\n<p>ç­‰å¾…æ‰€æœ‰ Pod æ­£å¸¸è¿è¡Œåï¼ŒéªŒè¯é›†ç¾¤å°±ç»ªçŠ¶æ€ï¼š</p>\n<pre><code class=\"language-bash\"># æ£€æŸ¥æ‰€æœ‰å‘½åç©ºé—´çš„ Pod çŠ¶æ€\nkubectl get pods -A\n\n# éªŒè¯èŠ‚ç‚¹çŠ¶æ€ï¼ˆåº”æ˜¾ç¤º Readyï¼‰\nkubectl get nodes\n\n# æ£€æŸ¥ Cilium ç»„ä»¶çŠ¶æ€\ncilium status --verbose\n</code></pre>\n<h2 id=\"æ·»åŠ å·¥ä½œèŠ‚ç‚¹æ‰©å±•éƒ¨ç½²\">æ·»åŠ å·¥ä½œèŠ‚ç‚¹ï¼ˆæ‰©å±•éƒ¨ç½²ï¼‰</h2>\n<p>å®Œæˆå•èŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²åï¼Œå¦‚éœ€æ‰©å±•ä¸ºå¤šèŠ‚ç‚¹é›†ç¾¤ï¼Œå¯åœ¨æ–°èŠ‚ç‚¹ä¸Šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>\n<p><em>åœ¨æ–°èŠ‚ç‚¹ä¸Šéœ€è¦å…ˆå®Œæˆä¸Šé¢çš„ç³»ç»Ÿåˆå§‹åŒ–ã€Containerdé…ç½®ã€kubeç»„ä»¶é…ç½®</em></p>\n<h3 id=\"1-ç”ŸæˆèŠ‚ç‚¹åŠ å…¥ä»¤ç‰Œ\">1. ç”ŸæˆèŠ‚ç‚¹åŠ å…¥ä»¤ç‰Œ</h3>\n<p>åœ¨ Control Plane èŠ‚ç‚¹ä¸Šç”Ÿæˆ 24 å°æ—¶æœ‰æ•ˆçš„åŠ å…¥ä»¤ç‰Œï¼š</p>\n<pre><code class=\"language-bash\">kubeadm token create --print-join-command\n</code></pre>\n<p>è¯¥å‘½ä»¤å°†è¾“å‡ºç±»ä¼¼ä»¥ä¸‹æ ¼å¼çš„åŠ å…¥å‘½ä»¤ï¼š</p>\n<pre><code class=\"language-bash\">kubeadm join 192.168.0.22:6443 --token &lt;token&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;\n</code></pre>\n<h3 id=\"2-åœ¨æ–°èŠ‚ç‚¹æ‰§è¡ŒåŠ å…¥å‘½ä»¤\">2. åœ¨æ–°èŠ‚ç‚¹æ‰§è¡ŒåŠ å…¥å‘½ä»¤</h3>\n<p>åœ¨æ–°èŠ‚ç‚¹ä¸Šæ‰§è¡Œä¸Šè¿°å‘½ä»¤ï¼Œå¹¶å¿½ç•¥é•œåƒé¢„æ£€é”™è¯¯ï¼š</p>\n<pre><code class=\"language-bash\">sudo kubeadm join 192.168.0.22:6443 \\\n  --token &lt;token&gt; \\\n  --discovery-token-ca-cert-hash sha256:&lt;hash&gt; \\\n  --ignore-preflight-errors=ImagePull\n</code></pre>\n<h3 id=\"3-éªŒè¯èŠ‚ç‚¹åŠ å…¥çŠ¶æ€\">3. éªŒè¯èŠ‚ç‚¹åŠ å…¥çŠ¶æ€</h3>\n<pre><code class=\"language-bash\"># æ£€æŸ¥èŠ‚ç‚¹åˆ—è¡¨\nkubectl get nodes\n\n# éªŒè¯ Cilium çŠ¶æ€\ncilium status\n\n# æ¸…ç† iptables è§„åˆ™ï¼ˆå¦‚å·²ç¦ç”¨ kube-proxyï¼‰\nsudo iptables -F\n</code></pre>\n<p>Cilium ä¼šè‡ªåŠ¨åœ¨æ–°èŠ‚ç‚¹ä¸Šéƒ¨ç½²ä»£ç† Podï¼Œç¡®ä¿ç½‘ç»œè¿é€šæ€§ã€‚</p>\n<h2 id=\"ç§æœ‰é•œåƒä»“åº“è®¤è¯é…ç½®\">ç§æœ‰é•œåƒä»“åº“è®¤è¯é…ç½®</h2>\n<p>å¯¹äº Harbor ä¸­éå…¬å¼€é¡¹ç›®çš„é•œåƒæ‹‰å–ï¼Œéœ€è¦é…ç½®ç›¸åº”çš„è®¤è¯æœºåˆ¶ã€‚</p>\n<h3 id=\"æ–¹å¼ä¸€pod-çº§åˆ«-imagepullsecretsæ¨è\">æ–¹å¼ä¸€ï¼šPod çº§åˆ« imagePullSecretsï¼ˆæ¨èï¼‰</h3>\n<p>é€‚ç”¨äºéœ€è¦ç²¾ç»†åŒ–æ§åˆ¶é•œåƒæ‹‰å–æƒé™çš„åœºæ™¯ã€‚</p>\n<h4 id=\"1-åˆ›å»º-docker-registry-secret\">1. åˆ›å»º Docker Registry Secret</h4>\n<pre><code class=\"language-bash\">kubectl create secret docker-registry harbor-pull-secret \\\n  --docker-server=192.168.0.42 \\\n  --docker-username=&lt;your-username&gt; \\\n  --docker-password=&lt;your-password&gt; \\\n  --docker-email=&lt;your-email&gt;\n</code></pre>\n<h4 id=\"2-åœ¨-pod-å®šä¹‰ä¸­å¼•ç”¨-secret\">2. åœ¨ Pod å®šä¹‰ä¸­å¼•ç”¨ Secret</h4>\n<pre><code class=\"language-yaml\">apiVersion: v1\nkind: Pod\nspec:\n  containers:\n  - name: my-app\n    image: 192.168.0.42/private-project/my-image:v1\n  imagePullSecrets:\n  - name: harbor-pull-secret\n</code></pre>\n<h3 id=\"æ–¹å¼äºŒserviceaccount-ç»‘å®šä¾¿æ·æ–¹æ¡ˆ\">æ–¹å¼äºŒï¼šServiceAccount ç»‘å®šï¼ˆä¾¿æ·æ–¹æ¡ˆï¼‰</h3>\n<p>é€‚ç”¨äºå‘½åç©ºé—´å†…æ‰€æœ‰ Pod éƒ½éœ€è¦è®¿é—®ç§æœ‰é•œåƒä»“åº“çš„åœºæ™¯ã€‚</p>\n<pre><code class=\"language-bash\"># å°† Secret ç»‘å®šåˆ° default ServiceAccount\nkubectl patch serviceaccount default -p '{\"imagePullSecrets\": [{\"name\": \"harbor-pull-secret\"}]}'\n</code></pre>\n<p>æ­¤é…ç½®å°†ä½¿è¯¥å‘½åç©ºé—´ä¸‹æ‰€æœ‰æ–°å»ºçš„ Pod è‡ªåŠ¨ç»§æ‰¿é•œåƒæ‹‰å–æƒé™ã€‚</p>\n<h3 id=\"æ–¹å¼ä¸‰containerd-å…¨å±€è®¤è¯å®éªŒç¯å¢ƒé€‚ç”¨\">æ–¹å¼ä¸‰ï¼šContainerd å…¨å±€è®¤è¯ï¼ˆå®éªŒç¯å¢ƒé€‚ç”¨ï¼‰</h3>\n<p>åœ¨ Containerd å±‚é¢é…ç½®å…¨å±€è®¤è¯ï¼Œé€‚ç”¨äºä¸ªäººå®éªŒç¯å¢ƒã€‚</p>\n<p>ç¼–è¾‘ <code>/etc/containerd/config.toml</code>ï¼š</p>\n<pre><code class=\"language-toml\">[plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"192.168.0.42\".auth]\n  username = \"your-username\"\n  password = \"your-password\"\n  # æˆ–ä½¿ç”¨ base64 ç¼–ç çš„å‡­è¯ï¼šauth = \"base64(username:password)\"\n</code></pre>\n<blockquote>\n<p><strong>å®‰å…¨æé†’</strong>ï¼šæ–¹å¼ä¸‰å°†å‡­æ®æ˜æ–‡å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p>\n</blockquote>\n<h2 id=\"è¡¥å……\">è¡¥å……</h2>\n<p>ç›¸è¾ƒäºä½¿ç”¨äºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²ï¼Œç”¨kubeadmèµ·ç çœå»äº†æ‰‹åŠ¨ç»´æŠ¤è¯ä¹¦çš„æ“ä½œï¼Œåç»­æ·»åŠ èŠ‚ç‚¹ä¹Ÿæ›´ç®€å•äº›ã€‚æœ‰ç©ºæ•´ä¸ªansibleè®©æ·»åŠ èŠ‚ç‚¹æ›´æ–¹ä¾¿ã€‚</p>\n\n\n</div>\n<div id=\"MySignature\">\n    <p>æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š<a href=\"https://www.cnblogs.com/XY-Heruo/\" target=\"_blank\">èŠ±é…’é”„ä½œç”°</a>ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š<a href=\"https://www.cnblogs.com/XY-Heruo/p/19560948\" target=\"_blank\">https://www.cnblogs.com/XY-Heruo/p/19560948</a></p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-01 16:03</span>&nbsp;\n<a href=\"https://www.cnblogs.com/XY-Heruo\">èŠ±é…’é”„ä½œç”°</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">51</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "å°†SignalRç§»æ¤åˆ°Esp32â€”è®©å°æ™ºè®¾å¤‡æ— ç¼è¿æ¥.NETåŠŸèƒ½æ‹“å±•MCPæœåŠ¡",
      "link": "https://www.cnblogs.com/GreenShade/p/19560338",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/GreenShade/p/19560338\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-01 15:33\">\n    <span>å°†SignalRç§»æ¤åˆ°Esp32â€”è®©å°æ™ºè®¾å¤‡æ— ç¼è¿æ¥.NETåŠŸèƒ½æ‹“å±•MCPæœåŠ¡</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h2 id=\"å‰è¨€\">å‰è¨€</h2>\n<p>è¿™æ®µæ—¶é—´è¿·ä¸Šäº†æ‰‹æ“Esp32çš„å°æ™ºèŠå¤©æœºå™¨äººï¼Œä¹Ÿç”¨.NETä¸ºå°æ™ºAIå¼€å‘äº†ä¸€äº›MCPè½¬æ¥å¹³å°å’ŒMCPæœåŠ¡ã€‚å°æ™ºESP32æœ¬èº«å°±å…·å¤‡MCPèƒ½åŠ›ï¼Œå¯ä»¥è°ƒç”¨æœ¬åœ°MCPå·¥å…·å’ŒæœåŠ¡ç«¯MCPå·¥å…·ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™è®¾å¤‡ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸€ç›´éƒ½æœ‰ã€‚</p>\n<p>å¦‚æœä½ æœ‰æ‰‹æ“Esp32çš„ç¡¬ä»¶ç©å…·æ‰“ç®—ï¼Œå¯ä»¥å…³æ³¨æˆ‘çš„Bç«™è´¦å·ï¼ˆç»¿è«é˜¿å¹¿ï¼‰<a href=\"https://space.bilibili.com/25228512\" rel=\"noopener nofollow\" target=\"_blank\">https://space.bilibili.com/25228512</a><br />\nå¸¦ä½ æ‰‹æ“ç©å…·ã€‚</p>\n<p>å°æ™ºåŸæœ¬è¿™å¥—æ¶æ„æœ‰ä¸ªå±€é™æ€§ï¼š<strong>MCPå·¥å…·æ‰§è¡Œå®Œä¹‹åï¼Œåªèƒ½åŒæ­¥è¿”å›ç»“æœæˆ–è€…é€šè¿‡å¼‚æ­¥é‚®ä»¶é€šçŸ¥ï¼Œè®¾å¤‡æ— æ³•è¢«åŠ¨æ¥æ”¶æœåŠ¡ç«¯çš„æ¶ˆæ¯</strong>ã€‚æ¯”å¦‚æˆ‘æƒ³è®©æœåŠ¡ç«¯ä¸»åŠ¨ç»™è®¾å¤‡æ¨é€ä¸€å¼ å›¾ç‰‡ã€æ’­æ”¾ä¸€æ®µè¯­éŸ³ã€æˆ–è€…å‘é€ä¸€ä¸ªæ–‡æœ¬é€šçŸ¥ï¼Œåœ¨ä¹‹å‰çš„æ¶æ„ä¸‹æ˜¯åšä¸åˆ°çš„ã€‚</p>\n<p>æ‰€ä»¥æˆ‘å°±å†³å®šæ”¹é€ å°æ™ºå®¢æˆ·ç«¯ï¼Œé›†æˆSignalRå®æ—¶é€šä¿¡æ¡†æ¶ã€‚è¿™æ¬¡æ”¹é€ çš„æ ¸å¿ƒä»·å€¼æ˜¯ï¼š<strong>é€šè¿‡SignalRæ¶ˆæ¯é€šé“ï¼Œè®©è®¾å¤‡å¯ä»¥æ¥æ”¶å„ç§ç±»å‹çš„æ¶ˆæ¯ï¼ˆå£°éŸ³ã€å›¾ç‰‡ã€æ–‡æœ¬é€šçŸ¥ï¼‰ï¼ŒæœåŠ¡ç«¯çš„MCPå·¥å…·æ‰§è¡ŒæˆåŠŸåï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·IDæ¨é€æ•°æ®åˆ°å¯¹åº”çš„ç”¨æˆ·é€šé“</strong>ã€‚</p>\n<p>æ•´ä¸ªæ”¹é€ æ¶‰åŠSignalR C++å®¢æˆ·ç«¯çš„é›†æˆã€JWT Tokenè®¤è¯ã€æ‰«ç ç™»å½•ï¼ˆåŸºäºESP32æœ¬åœ°MCPå·¥å…·å®ç°ï¼‰ã€ä»¥åŠæœåŠ¡ç«¯æ¶ˆæ¯æ¨é€é€»è¾‘ã€‚å®¢æˆ·ç«¯ä»£ç éƒ½æ˜¯C++å®ç°çš„ï¼Œä¸è¿‡ç°åœ¨AIè¾…åŠ©ç¼–ç¨‹å¾ˆå¼ºå¤§ï¼Œå¸®æˆ‘èŠ‚çœäº†å¤§é‡æ—¶é—´ã€‚</p>\n<p><img alt=\"img\" src=\"https://img2024.cnblogs.com/blog/1690009/202602/1690009-20260201121657114-327485878.png\" /></p>\n<h2 id=\"é—®é¢˜è§£ç­”\">é—®é¢˜è§£ç­”</h2>\n<p><strong>Q: ä¸ºä»€ä¹ˆé€‰æ‹©SignalRè€Œä¸æ˜¯ç›´æ¥ç”¨WebSocketï¼Ÿ</strong></p>\n<p>A: èµ·åˆæˆ‘ç¡®å®è€ƒè™‘è¿‡ç›´æ¥ç”¨WebSocketï¼Œä½†SignalRæä¾›äº†å¾ˆå¤šå¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼š</p>\n<ul>\n<li><strong>HubæŠ½è±¡</strong>ï¼šæœåŠ¡ç«¯å¯ä»¥è½»æ¾å®ç°ç¾¤ç»„ç®¡ç†ï¼ŒæŒ‰ç”¨æˆ·IDæ¨é€æ¶ˆæ¯ï¼Œæ¯”å¦‚<code>Clients.Group($\"Users:{userId}\").SendAsync(\"Notification\", message)</code></li>\n<li><strong>æ¶ˆæ¯è·¯ç”±</strong>ï¼šä¸éœ€è¦è‡ªå·±å†™æ¶ˆæ¯åˆ†å‘é€»è¾‘ï¼ŒSignalRçš„Hubæ–¹æ³•è°ƒç”¨å’Œäº‹ä»¶æ¨é€å·²ç»å¾ˆå®Œå–„äº†</li>\n<li><strong>ç±»å‹åŒ–è°ƒç”¨</strong>ï¼šç›¸æ¯”åŸå§‹WebSocketçš„å­—ç¬¦ä¸²æ¶ˆæ¯ï¼ŒSignalRæä¾›äº†ç±»ä¼¼RPCçš„è°ƒç”¨ä½“éªŒï¼Œä»£ç æ›´æ¸…æ™°</li>\n</ul>\n<p>è™½ç„¶ESP32æ²¡æœ‰ç°æˆçš„SignalRåº“ï¼Œä½†æˆ‘æ‰¾åˆ°äº†å¾®è½¯å®˜æ–¹çš„C++ SignalRå®¢æˆ·ç«¯ï¼ˆåŠæˆå“ï¼‰ï¼Œå°†å®ƒä¸ESP32çš„WebSocketç»„ä»¶æ•´åˆåï¼Œå°±èƒ½ç”¨ä¸ŠSignalRçš„è¿™äº›ç‰¹æ€§äº†ã€‚è‡³äºSignalRè‡ªå¸¦çš„é‡è¿æœºåˆ¶ï¼Œæˆ‘æ²¡ç”¨ï¼Œå°æ™ºæœ‰è‡ªå·±çš„å¾ªç¯é‡è¿é€»è¾‘ï¼Œæ›´å¯æ§ä¸€äº›ã€‚</p>\n<p><strong>Q: æ”¹é€ çš„æ ¸å¿ƒä»·å€¼æ˜¯ä»€ä¹ˆï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>\n<p>A: æ”¹é€ å‰ï¼ŒESP32çš„MCPå·¥å…·è°ƒç”¨å®Œæˆåï¼Œåªèƒ½é€šè¿‡ä¸¤ç§æ–¹å¼é€šçŸ¥ï¼š</p>\n<ol>\n<li><strong>åŒæ­¥è¿”å›</strong>ï¼šå·¥å…·æ‰§è¡Œç»“æœç›´æ¥è¿”å›ç»™è°ƒç”¨æ–¹</li>\n<li><strong>å¼‚æ­¥é‚®ä»¶</strong>ï¼šé€šè¿‡é‚®ä»¶å‘é€æ‰§è¡Œç»“æœ</li>\n</ol>\n<p>è¿™ä¸¤ç§æ–¹å¼éƒ½æ— æ³•æ»¡è¶³å®æ—¶æ¨é€çš„éœ€æ±‚ã€‚æ¯”å¦‚æˆ‘æƒ³è®©æœåŠ¡ç«¯åœ¨ç”Ÿå›¾å®Œæˆåç«‹å³æ¨é€å›¾ç‰‡ç»™è®¾å¤‡æ˜¾ç¤ºï¼Œæˆ–è€…æ’­æ”¾ä¸€æ®µè¯­éŸ³æç¤ºï¼Œä¹‹å‰çš„æ¶æ„åšä¸åˆ°ã€‚</p>\n<p>æ”¹é€ åï¼Œé€šè¿‡SignalRå»ºç«‹äº†ä¸€æ¡<strong>æœåŠ¡ç«¯åˆ°è®¾å¤‡çš„å®æ—¶æ¶ˆæ¯é€šé“</strong>ï¼š</p>\n<ul>\n<li>æœåŠ¡ç«¯çš„MCPå·¥å…·æ‰§è¡ŒæˆåŠŸåï¼Œå¯ä»¥è°ƒç”¨<code>_hubContext.Clients.Group($\"Users:{userId}\").SendAsync(\"ShowImage\", imageData)</code>å°†å›¾ç‰‡æ¨é€ç»™è®¾å¤‡</li>\n<li>è®¾å¤‡é€šè¿‡SignalRçš„äº‹ä»¶ç›‘å¬æ¥æ”¶æ¶ˆæ¯ï¼š<code>connection-&gt;on(\"ShowImage\", [](const std::vector&lt;signalr::value&gt;&amp; args) { ... })</code></li>\n<li>æ”¯æŒæ¨é€ä»»æ„ç±»å‹çš„æ•°æ®ï¼šæ–‡æœ¬ã€å›¾ç‰‡ï¼ˆBase64ï¼‰ã€è¯­éŸ³URLã€JSONé€šçŸ¥ç­‰</li>\n</ul>\n<p>è¿™æ‰æ˜¯è¿™æ¬¡æ”¹é€ çš„æ ¸å¿ƒä»·å€¼ï¼š<strong>è®©è®¾å¤‡å…·å¤‡è¢«åŠ¨æ¥æ”¶æœåŠ¡ç«¯æ¶ˆæ¯çš„èƒ½åŠ›</strong>ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸»åŠ¨è°ƒç”¨å’ŒåŒæ­¥è¿”å›ã€‚</p>\n<p><strong>Q: æ‰«ç ç™»å½•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</strong></p>\n<p>A: æ‰«ç ç™»å½•åŠŸèƒ½æ˜¯åŸºäºESP32æœ¬åœ°MCPå·¥å…·å®ç°çš„ï¼Œè¿™æ˜¯å°æ™ºçš„å›ºæœ‰åŠŸèƒ½ï¼Œæˆ‘åªæ˜¯è¿›è¡Œäº†æ‹“å±•ï¼š</p>\n<ol>\n<li>è®¾å¤‡å¯åŠ¨æ—¶æ£€æŸ¥æ˜¯å¦æœ‰JWT Token</li>\n<li>å¦‚æœæ²¡æœ‰Tokenï¼Œè°ƒç”¨æœ¬åœ°MCPå·¥å…·<code>display_qrcode</code>åœ¨å±å¹•ä¸Šæ˜¾ç¤ºäºŒç»´ç </li>\n<li>äºŒç»´ç å†…å®¹åŒ…å«è®¾å¤‡IDå’ŒæœåŠ¡ç«¯åœ°å€ï¼š<code>https://mcp-server.com/device-login?deviceId=xxx</code></li>\n<li>ç”¨æˆ·ç”¨æ‰‹æœºæ‰«ç ï¼Œå®Œæˆæˆæƒã€‚</li>\n<li>è®¾å¤‡è·å–Tokenåä¿å­˜åˆ°NVSï¼ˆNon-Volatile Storageï¼‰ï¼Œä¸‹æ¬¡å¯åŠ¨ç›´æ¥ä½¿ç”¨</li>\n</ol>\n<p>è¿™æ ·å°±å®ç°äº†è®¾å¤‡çš„å¿«é€Ÿè®¤è¯ï¼Œç”¨æˆ·ä½“éªŒå¾ˆå¥½ã€‚æ‰«ç è®¤è¯çš„æœåŠ¡ç«¯æ˜¯ä½¿ç”¨å¼€æºçš„keycloakåšçš„ï¼Œå¯¹æ¥äº†è®¾å¤‡è®¤è¯ç±»å‹ã€‚</p>\n<p><img alt=\"img\" src=\"https://img2024.cnblogs.com/blog/1690009/202602/1690009-20260201121907430-924035727.png\" /></p>\n<h2 id=\"åè¯è§£é‡Š\">åè¯è§£é‡Š</h2>\n<h3 id=\"æ ¸å¿ƒæ¦‚å¿µ\">æ ¸å¿ƒæ¦‚å¿µ</h3>\n<ul>\n<li>\n<p><strong>SignalR</strong>ï¼šå¾®è½¯æä¾›çš„å®æ—¶é€šä¿¡æ¡†æ¶ï¼Œå°è£…äº†WebSocketã€Serverâ€‘Sent Eventså’Œé•¿è½®è¯¢ç­‰ä¼ è¾“æ–¹å¼ï¼Œæ”¯æŒHubæ¨¡å‹ã€è‡ªåŠ¨é‡è¿ä¸æ¶ˆæ¯åºåˆ—åŒ–ã€‚é€‚åˆå®ç°åŒå‘ã€ä½å»¶è¿Ÿçš„å®æ—¶æ¶ˆæ¯ç³»ç»Ÿã€‚å°†å®ƒç§»æ¤åˆ°åµŒå…¥å¼è®¾å¤‡æ—¶éœ€è€ƒè™‘å®¢æˆ·ç«¯å®ç°çš„ä½“ç§¯ã€å†…å­˜æ¶ˆè€—ä¸çº¿ç¨‹æ¨¡å‹ã€‚</p>\n</li>\n<li>\n<p><strong>Hubï¼ˆé›†çº¿å™¨ï¼‰</strong>ï¼šSignalRçš„æ ¸å¿ƒæŠ½è±¡ï¼Œç±»ä¼¼äºMVCä¸­çš„Controllerã€‚æœåŠ¡ç«¯é€šè¿‡Hubå®šä¹‰æ–¹æ³•ä¾›å®¢æˆ·ç«¯è°ƒç”¨ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥æ³¨å†Œäº‹ä»¶ç›‘å¬æœåŠ¡ç«¯æ¨é€ã€‚ä¾‹å¦‚<code>ChatHub.SendMessage(user, message)</code>å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„Hubæ–¹æ³•ã€‚</p>\n</li>\n<li>\n<p><strong>MCPï¼ˆModel Context Protocolï¼‰</strong>ï¼šä¸€ç§åŸºäºJSON-RPC 2.0çš„åè®®ï¼Œç”¨äºå®šä¹‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„å·¥å…·è°ƒç”¨è§„èŒƒã€‚åœ¨IoTåœºæ™¯ä¸­ï¼Œè®¾å¤‡å¯ä»¥ä½œä¸ºMCP Serveræš´éœ²èƒ½åŠ›ï¼ˆå¦‚é‡å¯ã€æ˜¾ç¤ºå›¾ç‰‡ï¼‰ï¼Œè€Œäº‘ç«¯æœåŠ¡ä½œä¸ºMCP Clientè°ƒç”¨è¿™äº›èƒ½åŠ›ã€‚</p>\n</li>\n<li>\n<p><strong>JSON-RPC 2.0</strong>ï¼šä¸€ç§è½»é‡çº§çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®ï¼Œä½¿ç”¨JSONç¼–ç ã€‚MCPåè®®åŸºäºæ­¤æ ‡å‡†ï¼Œå®šä¹‰äº†<code>initialize</code>ã€<code>tools/list</code>ã€<code>tools/call</code>ç­‰æ–¹æ³•ã€‚æ¯ä¸ªè¯·æ±‚å¿…é¡»åŒ…å«<code>jsonrpc: \"2.0\"</code>ã€<code>method</code>ã€<code>id</code>å­—æ®µã€‚</p>\n</li>\n</ul>\n<h3 id=\"esp32ç›¸å…³\">ESP32ç›¸å…³</h3>\n<ul>\n<li>\n<p><strong>FreeRTOS</strong>ï¼šä¸€ä¸ªå¼€æºã€è½»é‡çº§çš„å®æ—¶æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå¸¸ç”¨äºå¾®æ§åˆ¶å™¨å¹³å°ï¼ˆå¦‚ESP32ï¼‰ã€‚æä¾›ä»»åŠ¡è°ƒåº¦ã€ä¼˜å…ˆçº§ã€äº’æ–¥é”ã€ä¿¡å·é‡ã€é˜Ÿåˆ—ã€è½¯ä»¶å®šæ—¶å™¨ç­‰å®æ—¶ç‰¹æ€§ï¼Œä¾¿äºåœ¨èµ„æºå—é™è®¾å¤‡ä¸Šå®ç°å¹¶å‘ä¸ç¡®å®šæ€§è¡Œä¸ºã€‚ä½¿ç”¨æ—¶éœ€æ³¨æ„å †æ ˆå¤§å°ã€ä¸­æ–­å®‰å…¨å’Œä»»åŠ¡ä¼˜å…ˆçº§è®¾è®¡ã€‚</p>\n</li>\n<li>\n<p><strong>ESP32 PSRAM</strong>ï¼šESP32å¯é€‰çš„å¤–éƒ¨ä¼ªé™æ€RAMï¼ˆPseudo-SRAMï¼‰ï¼Œç”¨äºæ‰©å±•è®¾å¤‡å¯ç”¨å†…å­˜ï¼ˆå¸¸è§4MB/8MB/16MBï¼‰ã€‚é€‚åˆå­˜æ”¾å¤§å¯¹è±¡ã€å›¾åƒç¼“å­˜ã€ç½‘ç»œç¼“å†²å’ŒåŠ¨æ€åˆ†é…æ•°æ®ã€‚åœ¨ESP-IDFä¸­éœ€å¯ç”¨å¹¶æ­£ç¡®é…ç½®ï¼Œåˆ†é…æ—¶ä¹Ÿå¯ä½¿ç”¨ä¸åŒçš„å †åŒºåŸŸï¼ˆå¦‚<code>heap_caps_malloc(size, MALLOC_CAP_SPIRAM)</code>ï¼‰æ¥æ§åˆ¶æ”¾ç½®ä¸æ€§èƒ½ï¼DMAé™åˆ¶ã€‚</p>\n</li>\n<li>\n<p><strong>WebSocket</strong>ï¼šä¸€ç§åŸºäºTCPçš„å…¨åŒå·¥é€šä¿¡åè®®ï¼Œé€šè¿‡HTTPæ¡æ‰‹å‡çº§å»ºç«‹è¿æ¥ã€‚SignalRé»˜è®¤ä¼˜å…ˆä½¿ç”¨WebSocketä½œä¸ºä¼ è¾“å±‚ï¼Œåœ¨ESP32ä¸Šé€šè¿‡<code>esp_websocket_client</code>ç»„ä»¶å®ç°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ESP32çš„WebSocketå®¢æˆ·ç«¯ä¸æ”¯æŒè‡ªåŠ¨é‡è¿ï¼Œéœ€è¦åœ¨åº”ç”¨å±‚å®ç°ã€‚</p>\n</li>\n</ul>\n<h3 id=\"è®¤è¯ç›¸å…³\">è®¤è¯ç›¸å…³</h3>\n<ul>\n<li>\n<p><strong>Bearer Token</strong>ï¼šä¸€ç§HTTPè®¤è¯æ–¹æ¡ˆï¼Œå°†Tokenæ”¾åœ¨Authorizationå¤´ä¸­ï¼š<code>Authorization: Bearer &lt;token&gt;</code>ã€‚åœ¨SignalRä¸­ï¼Œé€šå¸¸å°†Tokenä½œä¸ºæŸ¥è¯¢å‚æ•°ä¼ é€’ï¼š<code>/hub?access_token=YOUR_TOKEN</code></p>\n</li>\n<li>\n<p><strong>JWTï¼ˆJSON Web Tokenï¼‰</strong>ï¼šä¸€ç§å¼€æ”¾æ ‡å‡†ï¼ˆRFC 7512ï¼‰ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚åœ¨Verdure MCPä¸­ï¼Œä½¿ç”¨Keycloakç­¾å‘çš„JWTè¿›è¡Œç”¨æˆ·è®¤è¯ï¼ŒTokenä¸­åŒ…å«ç”¨æˆ·IDã€è§’è‰²ã€è¿‡æœŸæ—¶é—´ç­‰Claimä¿¡æ¯ã€‚</p>\n</li>\n<li>\n<p><strong>API Token</strong>ï¼šä¸€ç§ç®€å•çš„è®¤è¯æ–¹å¼ï¼Œåç»­è¿æ¥æ—¶æºå¸¦æ­¤TokenéªŒè¯èº«ä»½ã€‚Verdure MCPåŒæ—¶æ”¯æŒAPI Tokenå’ŒJWTä¸¤ç§æ–¹å¼ã€‚</p>\n</li>\n</ul>\n<p><img alt=\"img\" src=\"https://img2024.cnblogs.com/blog/1690009/202602/1690009-20260201152548041-1540521880.png\" /></p>\n<h2 id=\"æ ¸å¿ƒæŠ€æœ¯æ¶æ„\">æ ¸å¿ƒæŠ€æœ¯æ¶æ„</h2>\n<p>æ•´ä¸ªæ”¹é€ çš„æ¶æ„å¯ä»¥ç”¨ä¸€å¼ å›¾è¯´æ˜ï¼š</p>\n<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   .NET MCP Service   â”‚                          â”‚   ESP32 Device       â”‚\nâ”‚   (Verdure MCP)      â”‚â—„â”€â”€â”€â”€â”€SignalR Hubâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   (å°æ™ºå®¢æˆ·ç«¯)       â”‚\nâ”‚                      â”‚                          â”‚                      â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â‘  JWT Tokenè®¤è¯         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  DeviceHub.cs  â”‚  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚  æ‰«ç ç™»å½•      â”‚  â”‚\nâ”‚  â”‚                â”‚  â”‚                          â”‚  â”‚  (æœ¬åœ°MCPå·¥å…·) â”‚  â”‚\nâ”‚  â”‚ OnConnected    â”‚  â”‚                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚  â”‚ (éªŒè¯Token)    â”‚  â”‚                          â”‚          â†“           â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â‘¡ å»ºç«‹è¿æ¥               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚          â†“           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚ SignalR Client â”‚  â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                          â”‚  â”‚ - connection   â”‚  â”‚\nâ”‚  â”‚  ç¾¤ç»„ç®¡ç†      â”‚  â”‚                          â”‚  â”‚ - on() events  â”‚  â”‚\nâ”‚  â”‚ Users:{userId} â”‚  â”‚                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚                      â”‚\nâ”‚          â†“           â”‚                          â”‚                      â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â‘¢ MCPå·¥å…·æ‰§è¡Œåæ¨é€     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  æ¶ˆæ¯æ¨é€      â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  â”‚ æ¶ˆæ¯æ¥æ”¶å¤„ç†   â”‚  â”‚\nâ”‚  â”‚ SendAsync()    â”‚  â”‚  ShowImage(imageData)    â”‚  â”‚ - æ˜¾ç¤ºå›¾ç‰‡     â”‚  â”‚\nâ”‚  â”‚                â”‚  â”‚  PlayAudio(audioUrl)     â”‚  â”‚ - æ’­æ”¾è¯­éŸ³     â”‚  â”‚\nâ”‚  â”‚                â”‚  â”‚  Notification(text)      â”‚  â”‚ - æ˜¾ç¤ºé€šçŸ¥     â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n</code></pre>\n<p>å…³é”®æµç¨‹ï¼š</p>\n<ol>\n<li><strong>æ‰«ç ç™»å½•</strong>ï¼šè®¾å¤‡å¯åŠ¨åï¼Œå¦‚æœæ²¡æœ‰Tokenï¼Œè°ƒç”¨æœ¬åœ°MCPå·¥å…·æ˜¾ç¤ºäºŒç»´ç ï¼Œç”¨æˆ·æ‰«ç åè·å–JWT Token</li>\n<li><strong>å»ºç«‹è¿æ¥</strong>ï¼šæºå¸¦JWT Tokenè¿æ¥SignalR Hubï¼ŒæœåŠ¡ç«¯éªŒè¯ååŠ å…¥ç”¨æˆ·ç¾¤ç»„<code>Users:{userId}</code></li>\n<li><strong>æ¶ˆæ¯æ¨é€</strong>ï¼šæœåŠ¡ç«¯MCPå·¥å…·æ‰§è¡Œå®Œæˆåï¼Œé€šè¿‡SignalRå°†ç»“æœæ¨é€ç»™è®¾å¤‡\n<ul>\n<li><code>_hubContext.Clients.Group($\"Users:{userId}\").SendAsync(\"ShowImage\", imageData)</code></li>\n<li>è®¾å¤‡ç›‘å¬äº‹ä»¶å¹¶å¤„ç†ï¼š<code>connection-&gt;on(\"ShowImage\", handler)</code></li>\n</ul>\n</li>\n</ol>\n<p>è¿™å¥—æ¶æ„çš„æ ¸å¿ƒä»·å€¼å°±æ˜¯<strong>è®©æœåŠ¡ç«¯å¯ä»¥ä¸»åŠ¨æ¨é€æ¶ˆæ¯ç»™è®¾å¤‡</strong>ï¼Œè€Œä¸ä»…ä»…æ˜¯ç­‰å¾…è®¾å¤‡è½®è¯¢æˆ–åŒæ­¥è¿”å›ã€‚</p>\n<h2 id=\"å¼€å‘ç¯å¢ƒå‡†å¤‡\">å¼€å‘ç¯å¢ƒå‡†å¤‡</h2>\n<h3 id=\"esp32å¼€å‘ç¯å¢ƒvs-codeæ–¹å¼\">ESP32å¼€å‘ç¯å¢ƒï¼ˆVS Codeæ–¹å¼ï¼‰</h3>\n<p>æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨VS Codeçš„ESP-IDFæ’ä»¶ï¼š</p>\n<ol>\n<li>\n<p><strong>å®‰è£…VS Codeå’Œæ’ä»¶</strong></p>\n<ul>\n<li>ä¸‹è½½å®‰è£… <a href=\"https://code.visualstudio.com/\" rel=\"noopener nofollow\" target=\"_blank\">Visual Studio Code</a></li>\n<li>å®‰è£…æ‰©å±•ï¼š<code>Espressif IDF</code> (æœç´¢ <code>esp-idf</code>)</li>\n</ul>\n</li>\n<li>\n<p><strong>é…ç½®ESP-IDF</strong></p>\n<ul>\n<li>æŒ‰<code>F1</code>æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œè¾“å…¥ <code>ESP-IDF: Configure ESP-IDF Extension</code></li>\n<li>é€‰æ‹© <code>Express</code> å¿«é€Ÿé…ç½®</li>\n<li>é€‰æ‹©ESP-IDFç‰ˆæœ¬ï¼ˆæ¨èv5.1æˆ–æ›´é«˜ï¼‰</li>\n<li>ç­‰å¾…å®‰è£…å®Œæˆï¼ˆä¼šè‡ªåŠ¨ä¸‹è½½å·¥å…·é“¾ã€Pythonç¯å¢ƒç­‰ï¼‰</li>\n</ul>\n</li>\n<li>\n<p><strong>åˆ›å»º/æ‰“å¼€é¡¹ç›®</strong></p>\n<ul>\n<li><code>F1</code> â†’ <code>ESP-IDF: Show Examples Projects</code></li>\n<li>æˆ–ç›´æ¥æ‰“å¼€ esp-signalr-example é¡¹ç›®æ–‡ä»¶å¤¹</li>\n</ul>\n</li>\n<li>\n<p><strong>ç¼–è¯‘å’Œçƒ§å½•</strong></p>\n<ul>\n<li>ç‚¹å‡»åº•éƒ¨çŠ¶æ€æ çš„ <code>Build</code>ã€<code>Flash</code>ã€<code>Monitor</code> æŒ‰é’®</li>\n<li>æˆ–æŒ‰å¿«æ·é”®ï¼š<code>Ctrl+E B</code>ï¼ˆç¼–è¯‘ï¼‰ã€<code>Ctrl+E F</code>ï¼ˆçƒ§å½•ï¼‰</li>\n</ul>\n</li>\n</ol>\n<p>è¿™ç§æ–¹å¼æ¯”å‘½ä»¤è¡Œç®€å•å¾ˆå¤šï¼Œé€‚åˆ.NETå¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹ESP32å¼€å‘ã€‚</p>\n<p><img alt=\"img\" src=\"https://img2024.cnblogs.com/blog/1690009/202602/1690009-20260201122055040-2075015821.png\" /></p>\n<h3 id=\"netå¼€å‘ç¯å¢ƒ\">.NETå¼€å‘ç¯å¢ƒ</h3>\n<p>æœåŠ¡ç«¯ä½¿ç”¨.NET 10å¼€å‘ï¼š</p>\n<pre><code class=\"language-bash\"># Windows: ä¸‹è½½å®‰è£…å™¨ https://dotnet.microsoft.com/download/dotnet/10.0\n\n# éªŒè¯å®‰è£…\ndotnet --version  # åº”è¯¥è¾“å‡º 10.0.x\n\n</code></pre>\n<h2 id=\"æ ¸å¿ƒä»£ç å®ç°\">æ ¸å¿ƒä»£ç å®ç°</h2>\n<p>æœ¬ç« èŠ‚å°†ä»£ç åˆ†ä¸º<strong>ç¤ºä¾‹ä»£ç </strong>å’Œ<strong>å®é™…æ•´åˆä»£ç </strong>ä¸¤ä¸ªéƒ¨åˆ†è¿›è¡Œè®²è§£ï¼š</p>\n<ul>\n<li><strong>ç¤ºä¾‹ä»£ç </strong>ï¼šç”¨äºç†è§£æ ¸å¿ƒæ¦‚å¿µçš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä¾¿äºå­¦ä¹ å’Œå¿«é€Ÿä¸Šæ‰‹</li>\n<li><strong>å®é™…æ•´åˆä»£ç </strong>ï¼šç”Ÿäº§ç¯å¢ƒä¸­çš„å®Œæ•´å®ç°ï¼ŒåŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†ã€çŠ¶æ€ç®¡ç†ç­‰</li>\n</ul>\n<h3 id=\"å…³äºç¤ºä¾‹ä»“åº“\">å…³äºç¤ºä¾‹ä»“åº“</h3>\n<p>ä¸ºäº†å¸®åŠ©å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹ESP32çš„SignalRé›†æˆï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ä»“åº“ï¼š</p>\n<p><strong>ğŸ”— ä»“åº“åœ°å€</strong>ï¼š<a href=\"https://github.com/maker-community/esp-signalr-example\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/maker-community/esp-signalr-example</a></p>\n<p><strong>ğŸ“¦ ä»“åº“ç»“æ„</strong>ï¼š</p>\n<pre><code>esp-signalr-example/\nâ”œâ”€â”€ main/                    # ESP32 C++å®¢æˆ·ç«¯ä»£ç \nâ”‚   â”œâ”€â”€ main.cpp            # ä¸»ç¨‹åºï¼ˆWiFiè¿æ¥ã€SignalRåˆå§‹åŒ–ï¼‰\nâ”‚   â””â”€â”€ CMakeLists.txt      # ESP-IDFæ„å»ºé…ç½®\nâ”œâ”€â”€ signalr-server/         # .NET C# æœåŠ¡ç«¯ä»£ç \nâ”‚   â”œâ”€â”€ Program.cs          # ASP.NET CoreæœåŠ¡å™¨é…ç½®\nâ”‚   â”œâ”€â”€ ChatHub.cs          # SignalR Hubå®ç°\nâ”‚   â””â”€â”€ signalr-server.csproj\nâ”œâ”€â”€ docs/                   # æ–‡æ¡£\nâ”‚   â”œâ”€â”€ QUICKSTART.md       # 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹æŒ‡å—\nâ”‚   â”œâ”€â”€ TEST_SERVER_SETUP.md # æµ‹è¯•æœåŠ¡å™¨è¯¦ç»†è®¾ç½®\nâ”‚   â””â”€â”€ TROUBLESHOOTING.md  # å¸¸è§é—®é¢˜æ’æŸ¥\nâ””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜\n</code></pre>\n<p><strong>âœ¨ ä¸»è¦ç‰¹æ€§</strong>ï¼š</p>\n<ol>\n<li>\n<p><strong>å¼€ç®±å³ç”¨çš„æœåŠ¡å™¨</strong>ï¼š</p>\n<ul>\n<li>åŸºäºASP.NET Coreå’ŒSignalRæ„å»º</li>\n<li>æ”¯æŒæ¶ˆæ¯å¹¿æ’­</li>\n<li>å®Œæ•´çš„è¿æ¥ç®¡ç†å’Œæ—¥å¿—è¾“å‡º</li>\n<li>æä¾›RESTful APIç”¨äºè®¾å¤‡æ§åˆ¶</li>\n</ul>\n</li>\n<li>\n<p><strong>ç®€åŒ–çš„ESP32å®¢æˆ·ç«¯</strong>ï¼š</p>\n<ul>\n<li>ä½¿ç”¨Microsoftå®˜æ–¹çš„C++ SignalRå®¢æˆ·ç«¯åº“ç§»æ¤ç‰ˆ</li>\n<li>é€šè¿‡menuconfigé…ç½®WiFiå’ŒæœåŠ¡å™¨åœ°å€</li>\n<li>æ¼”ç¤ºæ¶ˆæ¯å‘é€/æ¥æ”¶ã€ä¼ æ„Ÿå™¨æ•°æ®ä¸ŠæŠ¥</li>\n<li>æ¸…æ™°çš„æ—¥å¿—è¾“å‡ºå’Œé”™è¯¯å¤„ç†</li>\n</ul>\n</li>\n</ol>\n<p><strong>ğŸš€ å¿«é€Ÿå¼€å§‹ç¤ºä¾‹</strong>ï¼ˆ5åˆ†é’Ÿè¿è¡Œï¼‰ï¼š</p>\n<pre><code class=\"language-bash\"># 1. å…‹éš†ä»“åº“\ngit clone https://github.com/maker-community/esp-signalr-example.git\ncd esp-signalr-example\n\n# 2. å¯åŠ¨æœåŠ¡å™¨ï¼ˆéœ€è¦.NET 9.0+ï¼‰\ncd signalr-server\ndotnet run --urls \"http://+:5000\" è¿™ä¸ªè¿è¡Œå¯ä»¥ç”¨ipè®¿é—®\n# æœåŠ¡å™¨è¿è¡Œåœ¨: http://0.0.0.0:5000/chatHub\n\n# 3. é…ç½®å¹¶çƒ§å½•ESP32\ncd ../\nidf.py menuconfig\n# é…ç½®WiFi SSIDã€å¯†ç å’ŒæœåŠ¡å™¨åœ°å€\nidf.py build flash monitor\n</code></pre>\n<p>esp32çš„é…ç½®å¦‚ä¸‹ï¼š</p>\n<p><img alt=\"img\" src=\"https://img2024.cnblogs.com/blog/1690009/202602/1690009-20260201134357961-636085039.png\" /></p>\n<p><strong>ğŸ“Š è¿è¡Œæ•ˆæœ</strong>ï¼š</p>\n<p>æœåŠ¡å™¨è¾“å‡ºï¼š<br />\n<img alt=\"img\" src=\"https://img2024.cnblogs.com/blog/1690009/202602/1690009-20260201135020573-402562452.png\" /></p>\n<pre><code>âœ“ Client connected: abc123\n  IP Address: 192.168.1.100\n  Total Connections: 1\n\n[10:30:25] Received from ESP32-Device: Test message #1 from ESP32\n[10:30:35] Sensor Update - Temperature: 25.50\n</code></pre>\n<p>ESP32ä¸²å£è¾“å‡ºï¼š<br />\n<img alt=\"img\" src=\"https://img2024.cnblogs.com/blog/1690009/202602/1690009-20260201134940520-565577362.png\" /></p>\n<pre><code>I (3520) SIGNALR_EXAMPLE: âœ“âœ“âœ“ Connected to SignalR Hub! âœ“âœ“âœ“\nI (3525) SIGNALR_EXAMPLE: ğŸ”” Notification: Welcome!\nI (14640) S\n</code></pre>\n<p><strong>ğŸ¯ ç¤ºä¾‹ä»“åº“çš„ä»·å€¼</strong>ï¼š</p>\n<ul>\n<li><strong>å­¦ä¹ è·¯å¾„æ¸…æ™°</strong>ï¼šä»ç®€å•çš„è¿æ¥åˆ°å¤æ‚çš„æ•°æ®ä¼ è¾“ï¼Œå¾ªåºæ¸è¿›</li>\n<li><strong>å¯ç›´æ¥è¿è¡Œ</strong>ï¼šä¸éœ€è¦ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼Œæœ¬åœ°å³å¯æµ‹è¯•å®Œæ•´æµç¨‹</li>\n<li><strong>ä»£ç æ³¨é‡Šè¯¦ç»†</strong>ï¼šå…³é”®éƒ¨åˆ†éƒ½æœ‰ä¸­è‹±æ–‡æ³¨é‡Šè¯´æ˜</li>\n<li><strong>æ˜“äºæ‰©å±•</strong>ï¼šåŸºäºè¿™ä¸ªç¤ºä¾‹å¯ä»¥å¿«é€Ÿå¼€å‘è‡ªå·±çš„åº”ç”¨</li>\n</ul>\n<p>æ¥ä¸‹æ¥çš„ 5.1 èŠ‚å°†åŸºäºè¿™ä¸ªç¤ºä¾‹ä»“åº“çš„ä»£ç è¿›è¡Œè®²è§£ã€‚</p>\n<h3 id=\"51-ç¤ºä¾‹ä»£ç æ•™å­¦ç®€åŒ–ç‰ˆ\">5.1 ç¤ºä¾‹ä»£ç ï¼ˆæ•™å­¦ç®€åŒ–ç‰ˆï¼‰</h3>\n<blockquote>\n<p><strong>è¯´æ˜</strong>ï¼šä»¥ä¸‹ä»£ç æ¥è‡ªå¼€æºç¤ºä¾‹ä»“åº“ <a href=\"https://github.com/maker-community/esp-signalr-example\" rel=\"noopener nofollow\" target=\"_blank\">esp-signalr-example</a>ï¼Œç»è¿‡ç²¾ç®€çªå‡ºæ ¸å¿ƒæ¦‚å¿µï¼Œæ–¹ä¾¿ç†è§£SignalRä¸ESP32é›†æˆçš„åŸºæœ¬åŸç†ã€‚å®Œæ•´ä»£ç è¯·å‚è€ƒä»“åº“æºç ã€‚</p>\n</blockquote>\n<h4 id=\"511-æœåŠ¡ç«¯signalr-hubåŸºç¡€å®ç°\">5.1.1 æœåŠ¡ç«¯ï¼šSignalR HubåŸºç¡€å®ç°</h4>\n<p>è¿™æ˜¯æœåŠ¡ç«¯çš„æ ¸å¿ƒä»£ç ï¼Œå®ç°äº†è¿æ¥ç®¡ç†ã€æ¶ˆæ¯å¹¿æ’­å’Œè®¾å¤‡çŠ¶æ€è·Ÿè¸ªï¼š</p>\n<p><strong>ChatHub.cs - Hubæ ¸å¿ƒå®ç°</strong>ï¼š</p>\n<pre><code class=\"language-csharp\">using Microsoft.AspNetCore.SignalR;\n\npublic class ChatHub : Hub\n{\n    private readonly ILogger&lt;ChatHub&gt; _logger;\n    private static int _connectionCount = 0;\n    \n    // å­˜å‚¨è¿æ¥çš„è®¾å¤‡ä¿¡æ¯\n    private static readonly Dictionary&lt;string, DeviceInfo&gt; _connectedDevices = new();\n    private static readonly object _devicesLock = new();\n\n    public ChatHub(ILogger&lt;ChatHub&gt; logger)\n    {\n        _logger = logger;\n    }\n\n    /// &lt;summary&gt;\n    /// å¤„ç†æ¥è‡ªESP32çš„æ¶ˆæ¯\n    /// &lt;/summary&gt;\n    public async Task SendMessage(string user, string message)\n    {\n        _logger.LogInformation(\"[{Time}] Received from {User}: {Message}\", \n            DateTime.Now.ToString(\"HH:mm:ss\"), user, message);\n        \n        // å¹¿æ’­åˆ°æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯\n        await Clients.All.SendAsync(\"ReceiveMessage\", user, message);\n    }\n\n    /// &lt;summary&gt;\n    /// å¤„ç†ä¼ æ„Ÿå™¨æ•°æ®æ›´æ–°\n    /// &lt;/summary&gt;\n    public async Task UpdateSensor(string sensorId, double value)\n    {\n        _logger.LogInformation(\"[{Time}] Sensor Update - {SensorId}: {Value:F2}\", \n            DateTime.Now.ToString(\"HH:mm:ss\"), sensorId, value);\n        \n        // å¹¿æ’­ä¼ æ„Ÿå™¨æ•°æ®åˆ°æ‰€æœ‰å®¢æˆ·ç«¯\n        await Clients.All.SendAsync(\"UpdateSensorData\", sensorId, value);\n    }\n\n    /// &lt;summary&gt;\n    /// å¤„ç†ESP32çŠ¶æ€æ›´æ–°\n    /// &lt;/summary&gt;\n    public async Task UpdateDeviceStatus(string deviceId, string status, int freeHeap)\n    {\n        _logger.LogInformation(\"[{Time}] Device Status - {DeviceId}: {Status}, Free Heap: {FreeHeap} bytes\", \n            DateTime.Now.ToString(\"HH:mm:ss\"), deviceId, status, freeHeap);\n        \n        await Clients.All.SendAsync(\"DeviceStatusUpdate\", deviceId, status, freeHeap);\n    }\n\n    /// &lt;summary&gt;\n    /// å®¢æˆ·ç«¯è¿æ¥æ—¶è§¦å‘\n    /// &lt;/summary&gt;\n    public override async Task OnConnectedAsync()\n    {\n        Interlocked.Increment(ref _connectionCount);\n        \n        var connectionId = Context.ConnectionId;\n        var httpContext = Context.GetHttpContext();\n        var ipAddress = httpContext?.Connection.RemoteIpAddress?.ToString();\n        var userAgent = httpContext?.Request.Headers[\"User-Agent\"].ToString();\n        \n        // ä¿å­˜è®¾å¤‡ä¿¡æ¯\n        lock (_devicesLock)\n        {\n            _connectedDevices[connectionId] = new DeviceInfo\n            {\n                ConnectionId = connectionId,\n                IpAddress = ipAddress,\n                UserAgent = userAgent,\n                ConnectedAt = DateTime.UtcNow\n            };\n        }\n        \n        _logger.LogInformation(\"âœ“ Client connected: {ConnectionId}\", connectionId);\n        _logger.LogInformation(\"  IP Address: {IpAddress}\", ipAddress);\n        _logger.LogInformation(\"  Total Connections: {Count}\", _connectionCount);\n        \n        await base.OnConnectedAsync();\n        \n        // å‘é€æ¬¢è¿æ¶ˆæ¯ï¼ˆESP32é€šè¿‡æ­¤æ¶ˆæ¯ç¡®è®¤è¿æ¥æˆåŠŸï¼‰\n        await Clients.Caller.SendAsync(\"Notification\", \n            \"Welcome to SignalR Test Server!\");\n    }\n\n    /// &lt;summary&gt;\n    /// å®¢æˆ·ç«¯æ–­å¼€æ—¶è§¦å‘\n    /// &lt;/summary&gt;\n    public override async Task OnDisconnectedAsync(Exception? exception)\n    {\n        Interlocked.Decrement(ref _connectionCount);\n        \n        var connectionId = Context.ConnectionId;\n        \n        // ç§»é™¤è®¾å¤‡ä¿¡æ¯\n        lock (_devicesLock)\n        {\n            _connectedDevices.Remove(connectionId);\n        }\n        \n        _logger.LogInformation(\"âœ— Client disconnected: {ConnectionId}\", connectionId);\n        if (exception != null)\n        {\n            _logger.LogWarning(\"  Disconnection reason: {Message}\", exception.Message);\n        }\n        _logger.LogInformation(\"  Remaining Connections: {Count}\", _connectionCount);\n        \n        await base.OnDisconnectedAsync(exception);\n    }\n}\n\n/// &lt;summary&gt;\n/// è®¾å¤‡è¿æ¥ä¿¡æ¯\n/// &lt;/summary&gt;\npublic class DeviceInfo\n{\n    public string ConnectionId { get; set; } = \"\";\n    public string? IpAddress { get; set; }\n    public string? UserAgent { get; set; }\n    public DateTime ConnectedAt { get; set; }\n}\n</code></pre>\n<p><strong>Program.cs - SignalRæœåŠ¡é…ç½®</strong>ï¼š</p>\n<pre><code class=\"language-csharp\">var builder = WebApplication.CreateBuilder(args);\n\n// æ·»åŠ SignalRæœåŠ¡\nbuilder.Services.AddSignalR(options =&gt;\n{\n    options.EnableDetailedErrors = true;  // å¼€å‘ç¯å¢ƒå¯ç”¨\n    options.ClientTimeoutInterval = TimeSpan.FromSeconds(30);  // å®¢æˆ·ç«¯è¶…æ—¶\n    options.KeepAliveInterval = TimeSpan.FromSeconds(15);  // å¿ƒè·³é—´éš”\n});\n\n// æ·»åŠ CORSæ”¯æŒï¼ˆå…è®¸ESP32è·¨åŸŸè¿æ¥ï¼‰\nbuilder.Services.AddCors(options =&gt;\n{\n    options.AddDefaultPolicy(policy =&gt;\n    {\n        policy.AllowAnyOrigin()\n              .AllowAnyHeader()\n              .AllowAnyMethod();\n    });\n});\n\nvar app = builder.Build();\n\napp.UseCors();\napp.MapHub&lt;ChatHub&gt;(\"/chatHub\");\n\n// ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼ˆé‡è¦ï¼šå±€åŸŸç½‘å†…ESP32èƒ½è®¿é—®ï¼‰\napp.Urls.Add(\"http://0.0.0.0:5000\");\n\nConsole.WriteLine(\"SignalR Server: http://0.0.0.0:5000/chatHub\");\napp.Run();\n</code></pre>\n<p><strong>å…³é”®ç‚¹è¯´æ˜</strong>ï¼š</p>\n<ol>\n<li><strong>è¿æ¥ç¡®è®¤æœºåˆ¶</strong>ï¼šæœåŠ¡å™¨åœ¨ <code>OnConnectedAsync</code> ä¸­å‘é€ <code>Notification</code> æ¶ˆæ¯ï¼ŒESP32æ”¶åˆ°æ­¤æ¶ˆæ¯æ‰è®¤ä¸ºè¿æ¥æˆåŠŸ</li>\n<li><strong>æ¶ˆæ¯å¹¿æ’­</strong>ï¼šä½¿ç”¨ <code>Clients.All.SendAsync()</code> å‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯å¹¿æ’­æ¶ˆæ¯</li>\n<li><strong>è¿æ¥è·Ÿè¸ª</strong>ï¼šä½¿ç”¨é™æ€å­—å…¸ <code>_connectedDevices</code> è·Ÿè¸ªæ‰€æœ‰è¿æ¥çš„è®¾å¤‡ä¿¡æ¯</li>\n</ol>\n<h4 id=\"512-æœåŠ¡ç«¯è®¾å¤‡æ§åˆ¶apié€šè¿‡signalræ¨é€æ¶ˆæ¯\">5.1.2 æœåŠ¡ç«¯ï¼šè®¾å¤‡æ§åˆ¶APIï¼ˆé€šè¿‡SignalRæ¨é€æ¶ˆæ¯ï¼‰</h4>\n<p>ç¤ºä¾‹ä»“åº“æä¾›äº†å®Œæ•´çš„è®¾å¤‡æ§åˆ¶APIï¼Œæ¼”ç¤ºå¦‚ä½•é€šè¿‡SignalRå‘ESP32æ¨é€å„ç§ç±»å‹çš„æ¶ˆæ¯ï¼š</p>\n<p><strong>Program.cs - è®¾å¤‡æ§åˆ¶APIç«¯ç‚¹</strong>ï¼š</p>\n<pre><code class=\"language-csharp\">// ============================================================================\n// è®¾å¤‡æ§åˆ¶ API - ç”¨äºå‘è®¾å¤‡å‘é€ CustomMessage\n// ============================================================================\n\n// è·å–æ‰€æœ‰è¿æ¥çš„è®¾å¤‡\napp.MapGet(\"/api/device/connections\", () =&gt;\n{\n    return Results.Ok(ChatHub.ConnectedDevices);\n})\n.WithName(\"GetConnections\")\n.WithDescription(\"è·å–æ‰€æœ‰è¿æ¥çš„è®¾å¤‡åˆ—è¡¨\");\n\n// å‘é€é€šçŸ¥\napp.MapPost(\"/api/device/notification\", async (\n    NotificationRequest request, \n    IHubContext&lt;ChatHub&gt; hubContext, \n    ILogger&lt;Program&gt; logger) =&gt;\n{\n    var message = new\n    {\n        action = \"notification\",\n        title = request.Title ?? \"é€šçŸ¥\",\n        content = request.Content ?? \"\",\n        emotion = request.Emotion ?? \"bell\",\n        sound = request.Sound ?? \"popup\"\n    };\n\n    await SendCustomMessage(hubContext, logger, request.ConnectionId, message);\n    return Results.Ok(new { success = true, message = \"Notification sent\" });\n})\n.WithDescription(\"å‘é€é€šçŸ¥åˆ°è®¾å¤‡ (sound: popup/success/vibration/exclamation/low_battery/none)\");\n\n// å‘é€å›¾ç‰‡\napp.MapPost(\"/api/device/image\", async (\n    ImageRequest request, \n    IHubContext&lt;ChatHub&gt; hubContext, \n    ILogger&lt;Program&gt; logger) =&gt;\n{\n    var message = new\n    {\n        action = \"image\",\n        url = request.Url\n    };\n\n    await SendCustomMessage(hubContext, logger, request.ConnectionId, message);\n    return Results.Ok(new { success = true, message = \"Image sent\" });\n})\n.WithDescription(\"å‘é€å›¾ç‰‡URLåˆ°è®¾å¤‡æ˜¾ç¤º (æ”¯æŒJPG/PNG, æœ€å¤§1MB)\");\n\n// å‘é€éŸ³é¢‘\napp.MapPost(\"/api/device/audio\", async (\n    AudioRequest request, \n    IHubContext&lt;ChatHub&gt; hubContext, \n    ILogger&lt;Program&gt; logger) =&gt;\n{\n    var message = new\n    {\n        action = \"audio\",\n        url = request.Url\n    };\n\n    await SendCustomMessage(hubContext, logger, request.ConnectionId, message);\n    return Results.Ok(new { success = true, message = \"Audio sent\" });\n})\n.WithDescription(\"å‘é€éŸ³é¢‘URLåˆ°è®¾å¤‡æ’­æ”¾ (OGGæ ¼å¼, æœ€å¤§512KB)\");\n\n// å‘é€å‘½ä»¤\napp.MapPost(\"/api/device/command\", async (\n    CommandRequest request, \n    IHubContext&lt;ChatHub&gt; hubContext, \n    ILogger&lt;Program&gt; logger) =&gt;\n{\n    var message = new\n    {\n        action = \"command\",\n        command = request.Command\n    };\n\n    await SendCustomMessage(hubContext, logger, request.ConnectionId, message);\n    return Results.Ok(new { success = true, message = \"Command sent\" });\n})\n.WithDescription(\"å‘é€å‘½ä»¤åˆ°è®¾å¤‡ (command: reboot/wake/listen/stop)\");\n\n// æ˜¾ç¤ºäºŒç»´ç \napp.MapPost(\"/api/device/qrcode\", async (\n    QRCodeRequest request, \n    IHubContext&lt;ChatHub&gt; hubContext, \n    ILogger&lt;Program&gt; logger) =&gt;\n{\n    var message = new\n    {\n        action = \"qrcode\",\n        content = request.Content,\n        title = request.Title ?? \"æ‰«ç \"\n    };\n\n    await SendCustomMessage(hubContext, logger, request.ConnectionId, message);\n    return Results.Ok(new { success = true, message = \"QRCode sent\" });\n})\n.WithDescription(\"æ˜¾ç¤ºäºŒç»´ç åˆ°è®¾å¤‡å±å¹•\");\n\n// è¾…åŠ©æ–¹æ³•ï¼šå‘é€ CustomMessage\nasync Task SendCustomMessage(\n    IHubContext&lt;ChatHub&gt; hubContext, \n    ILogger&lt;Program&gt; logger, \n    string? connectionId, \n    object message)\n{\n    var json = JsonSerializer.Serialize(message);\n    logger.LogInformation(\"ğŸ“¤ Sending CustomMessage to {Target}: {Message}\", \n        string.IsNullOrEmpty(connectionId) ? \"ALL\" : connectionId, json);\n\n    if (string.IsNullOrEmpty(connectionId))\n    {\n        // å‘é€ç»™æ‰€æœ‰è¿æ¥çš„è®¾å¤‡\n        await hubContext.Clients.All.SendAsync(\"CustomMessage\", json);\n    }\n    else\n    {\n        // å‘é€ç»™æŒ‡å®šè¿æ¥\n        await hubContext.Clients.Client(connectionId).SendAsync(\"CustomMessage\", json);\n    }\n}\n\n// ============================================================================\n// è¯·æ±‚æ¨¡å‹\n// ============================================================================\n\nrecord NotificationRequest\n{\n    public string? ConnectionId { get; init; }\n    public string? Title { get; init; }\n    public string Content { get; init; } = \"\";\n    public string? Emotion { get; init; }\n    public string? Sound { get; init; }\n}\n\nrecord ImageRequest\n{\n    public string? ConnectionId { get; init; }\n    public string Url { get; init; } = \"\";\n}\n\nrecord AudioRequest\n{\n    public string? ConnectionId { get; init; }\n    public string Url { get; init; } = \"\";\n}\n\nrecord CommandRequest\n{\n    public string? ConnectionId { get; init; }\n    public string Command { get; init; } = \"\";\n}\n\nrecord QRCodeRequest\n{\n    public string? ConnectionId { get; init; }\n    public string Content { get; init; } = \"\";\n    public string? Title { get; init; }\n}\n</code></pre>\n<p><strong>å…³é”®ç‚¹è¯´æ˜</strong>ï¼š</p>\n<ol>\n<li><strong>IHubContextæ³¨å…¥</strong>ï¼šä½¿ç”¨ <code>IHubContext&lt;ChatHub&gt;</code> åœ¨éHubç±»ä¸­å‘é€SignalRæ¶ˆæ¯</li>\n<li><strong>æ¶ˆæ¯æ ¼å¼</strong>ï¼šä½¿ç”¨JSONæ ¼å¼çš„ <code>CustomMessage</code> äº‹ä»¶ï¼ŒåŒ…å« <code>action</code> å­—æ®µæ ‡è¯†æ¶ˆæ¯ç±»å‹</li>\n<li><strong>å®šå‘æ¨é€</strong>ï¼š\n<ul>\n<li><code>Clients.All.SendAsync()</code> - å¹¿æ’­ç»™æ‰€æœ‰è¿æ¥çš„è®¾å¤‡</li>\n<li><code>Clients.Client(connectionId).SendAsync()</code> - å‘é€ç»™æŒ‡å®šè®¾å¤‡</li>\n<li><code>Clients.Group(groupName).SendAsync()</code> - å‘é€ç»™ç¾¤ç»„ï¼ˆå¦‚ <code>Users:{userId}</code>ï¼‰</li>\n</ul>\n</li>\n<li><strong>RESTful APIè®¾è®¡</strong>ï¼šæä¾›HTTPç«¯ç‚¹æ§åˆ¶è®¾å¤‡ï¼Œä¾¿äºå…¶ä»–æœåŠ¡è°ƒç”¨</li>\n</ol>\n<p>æœåŠ¡ç«¯çš„æ¥å£å›¾ç‰‡å¦‚ä¸‹å¯ä»¥ç›´æ¥æ“ä½œæµ‹è¯•ï¼š</p>\n<p><img alt=\"img\" src=\"https://img2024.cnblogs.com/blog/1690009/202602/1690009-20260201134534230-1496642342.png\" /></p>\n<h4 id=\"513-å®¢æˆ·ç«¯esp32è¿æ¥signalrå¹¶æ¥æ”¶æ¶ˆæ¯\">5.1.3 å®¢æˆ·ç«¯ï¼ˆESP32ï¼‰ï¼šè¿æ¥SignalRå¹¶æ¥æ”¶æ¶ˆæ¯</h4>\n<p>è¿™æ˜¯ESP32ç«¯çš„æ ¸å¿ƒä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•è¿æ¥SignalR Hubå¹¶æ¥æ”¶å„ç§ç±»å‹çš„æ¶ˆæ¯ï¼š</p>\n<p><strong>main.cpp - SignalRè¿æ¥ä¸æ¶ˆæ¯å¤„ç†</strong>ï¼š</p>\n<pre><code class=\"language-cpp\">#include &lt;stdio.h&gt;\n#include &lt;memory&gt;\n#include \"freertos/FreeRTOS.h\"\n#include \"freertos/task.h\"\n#include \"esp_system.h\"\n#include \"esp_log.h\"\n#include \"nvs_flash.h\"\n\n#include \"hub_connection_builder.h\"\n#include \"esp32_websocket_client.h\"\n#include \"esp32_http_client.h\"\n\n// =============================================================================\n// é…ç½®é¡¹ï¼ˆé€šè¿‡menuconfigè®¾ç½®ï¼‰\n// =============================================================================\n\n#define WIFI_SSID      CONFIG_EXAMPLE_WIFI_SSID\n#define WIFI_PASSWORD  CONFIG_EXAMPLE_WIFI_PASSWORD\n#define SIGNALR_HUB_URL CONFIG_EXAMPLE_SIGNALR_HUB_URL\n\nstatic const char* TAG = \"SIGNALR_EXAMPLE\";\n\n// SignalRè¿æ¥å¯¹è±¡\nstatic std::unique_ptr&lt;signalr::hub_connection&gt; g_connection;\nstatic bool g_is_connected = false;\n\n// =============================================================================\n// æ¶ˆæ¯å¤„ç†å™¨\n// =============================================================================\n\n/**\n * å¤„ç†æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯\n */\nstatic void on_receive_message(const std::vector&lt;signalr::value&gt;&amp; args)\n{\n    ESP_LOGI(TAG, \"==============================================\");\n    ESP_LOGI(TAG, \"ğŸ“© Message received from server:\");\n    \n    if (args.size() &gt;= 2) {\n        std::string user = args[0].as_string();\n        std::string message = args[1].as_string();\n        \n        ESP_LOGI(TAG, \"   From: %s\", user.c_str());\n        ESP_LOGI(TAG, \"   Text: %s\", message.c_str());\n    } else if (args.size() == 1) {\n        ESP_LOGI(TAG, \"   Message: %s\", args[0].as_string().c_str());\n    }\n    \n    ESP_LOGI(TAG, \"==============================================\");\n}\n\n/**\n * å¤„ç†é€šçŸ¥æ¶ˆæ¯ï¼ˆè¿æ¥ç¡®è®¤ï¼‰\n */\nstatic void on_notification(const std::vector&lt;signalr::value&gt;&amp; args)\n{\n    if (args.empty()) return;\n    \n    std::string notification = args[0].as_string();\n    ESP_LOGI(TAG, \"ğŸ”” Notification: %s\", notification.c_str());\n    \n    // é€šè¿‡Notificationæ¶ˆæ¯ç¡®è®¤è¿æ¥æˆåŠŸ\n    if (!g_is_connected) {\n        g_is_connected = true;\n        ESP_LOGI(TAG, \"==============================================\");\n        ESP_LOGI(TAG, \"âœ“âœ“âœ“ Connected to SignalR Hub! âœ“âœ“âœ“\");\n        ESP_LOGI(TAG, \"==============================================\");\n    }\n}\n\n/**\n * å¤„ç†ä¼ æ„Ÿå™¨æ•°æ®æ›´æ–°\n */\nstatic void on_sensor_update(const std::vector&lt;signalr::value&gt;&amp; args)\n{\n    if (args.size() &lt; 2) return;\n    \n    std::string sensor_id = args[0].as_string();\n    double value = args[1].as_double();\n    \n    ESP_LOGI(TAG, \"ğŸ“Š Sensor Update: %s = %.2f\", sensor_id.c_str(), value);\n}\n\n/**\n * å¤„ç†è®¾å¤‡çŠ¶æ€æ›´æ–°\n */\nstatic void on_device_status(const std::vector&lt;signalr::value&gt;&amp; args)\n{\n    if (args.size() &lt; 3) return;\n    \n    std::string device_id = args[0].as_string();\n    std::string status = args[1].as_string();\n    int free_heap = static_cast&lt;int&gt;(args[2].as_double());\n    \n    ESP_LOGI(TAG, \"ğŸ“± Device Status: %s - %s (Free Heap: %d bytes)\", \n             device_id.c_str(), status.c_str(), free_heap);\n}\n\n// =============================================================================\n// SignalRè¿æ¥ç®¡ç†\n// =============================================================================\n\n/**\n * åˆå§‹åŒ–SignalRè¿æ¥\n */\nstatic void init_signalr(void)\n{\n    ESP_LOGI(TAG, \"Initializing SignalR connection to: %s\", SIGNALR_HUB_URL);\n\n    try {\n        // åˆ›å»ºhub_connectionï¼ˆä½¿ç”¨make_uniqueï¼‰\n        g_connection = std::make_unique&lt;signalr::hub_connection&gt;(\n            signalr::hub_connection_builder::create(SIGNALR_HUB_URL)\n                .with_websocket_factory([](const signalr::signalr_client_config&amp; config) {\n                    return std::make_shared&lt;signalr::esp32_websocket_client&gt;(config);\n                })\n                .with_http_client_factory([](const signalr::signalr_client_config&amp; config) {\n                    return std::make_shared&lt;signalr::esp32_http_client&gt;(config);\n                })\n                .with_automatic_reconnect()  // å¯ç”¨è‡ªåŠ¨é‡è¿\n                .skip_negotiation(true)      // è·³è¿‡åå•†ï¼Œç›´æ¥WebSocket\n                .build());\n\n        ESP_LOGI(TAG, \"âœ“ SignalR connection object created\");\n        \n    } catch (const std::exception&amp; e) {\n        ESP_LOGE(TAG, \"Failed to create SignalR connection: %s\", e.what());\n    }\n}\n\n/**\n * æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨\n */\nstatic void setup_message_handlers(void)\n{\n    if (!g_connection) {\n        ESP_LOGE(TAG, \"Connection not initialized\");\n        return;\n    }\n\n    // æ³¨å†Œ \"ReceiveMessage\" äº‹ä»¶\n    g_connection-&gt;on(\"ReceiveMessage\", on_receive_message);\n    ESP_LOGI(TAG, \"âœ“ Registered handler: ReceiveMessage\");\n\n    // æ³¨å†Œ \"Notification\" äº‹ä»¶ï¼ˆç”¨äºè¿æ¥ç¡®è®¤ï¼‰\n    g_connection-&gt;on(\"Notification\", on_notification);\n    ESP_LOGI(TAG, \"âœ“ Registered handler: Notification\");\n\n    // æ³¨å†Œ \"UpdateSensorData\" äº‹ä»¶\n    g_connection-&gt;on(\"UpdateSensorData\", on_sensor_update);\n    ESP_LOGI(TAG, \"âœ“ Registered handler: UpdateSensorData\");\n\n    // æ³¨å†Œ \"DeviceStatusUpdate\" äº‹ä»¶\n    g_connection-&gt;on(\"DeviceStatusUpdate\", on_device_status);\n    ESP_LOGI(TAG, \"âœ“ Registered handler: DeviceStatusUpdate\");\n}\n\n/**\n * å¯åŠ¨SignalRè¿æ¥\n */\nstatic void start_signalr_connection(void)\n{\n    if (!g_connection) {\n        ESP_LOGE(TAG, \"Connection not initialized\");\n        return;\n    }\n    \n    ESP_LOGI(TAG, \"Starting SignalR connection...\");\n\n    try {\n        // å¯åŠ¨è¿æ¥ï¼ˆå¼‚æ­¥ï¼‰\n        g_connection-&gt;start([](std::exception_ptr exception) {\n            if (exception) {\n                ESP_LOGE(TAG, \"Connection failed in callback\");\n            } else {\n                ESP_LOGI(TAG, \"Connection started successfully\");\n            }\n        });\n        \n        ESP_LOGI(TAG, \"Waiting for Notification message to confirm connection...\");\n\n    } catch (const std::exception&amp; e) {\n        ESP_LOGE(TAG, \"Exception starting connection: %s\", e.what());\n    }\n}\n\n// =============================================================================\n// æµ‹è¯•ä»»åŠ¡ï¼šå®šæœŸå‘é€æ¶ˆæ¯\n// =============================================================================\n\nstatic void signalr_test_task(void* param)\n{\n    int message_count = 1;\n    \n    while (true) {\n        // ç­‰å¾…10ç§’\n        vTaskDelay(pdMS_TO_TICKS(10000));\n        \n        // æ£€æŸ¥è¿æ¥çŠ¶æ€\n        if (!g_connection || !g_is_connected) {\n            ESP_LOGW(TAG, \"Not connected, skipping message send\");\n            continue;\n        }\n        \n        // å‘é€æ¶ˆæ¯åˆ°æœåŠ¡å™¨\n        std::string message = \"Test message #\" + std::to_string(message_count++) + \" from ESP32\";\n        \n        ESP_LOGI(TAG, \"ğŸ“¤ Sending message...\");\n        ESP_LOGI(TAG, \"   User: ESP32-Device\");\n        ESP_LOGI(TAG, \"   Message: %s\", message.c_str());\n        \n        try {\n            std::vector&lt;signalr::value&gt; args;\n            args.push_back(signalr::value(\"ESP32-Device\"));\n            args.push_back(signalr::value(message));\n            \n            // è°ƒç”¨æœåŠ¡å™¨çš„ SendMessage æ–¹æ³•\n            g_connection-&gt;invoke(\"SendMessage\", args, \n                [](const signalr::value&amp; result, std::exception_ptr exception) {\n                    if (exception) {\n                        ESP_LOGE(TAG, \"âœ— Failed to send message\");\n                    } else {\n                        ESP_LOGI(TAG, \"âœ“ Message sent successfully!\");\n                    }\n                });\n                \n        } catch (const std::exception&amp; e) {\n            ESP_LOGE(TAG, \"Exception sending message: %s\", e.what());\n        }\n    }\n}\n\n// =============================================================================\n// ä¸»ç¨‹åº\n// =============================================================================\n\nextern \"C\" void app_main(void)\n{\n    ESP_LOGI(TAG, \"========================================\");\n    ESP_LOGI(TAG, \" ESP32 SignalR Client Test Example\");\n    ESP_LOGI(TAG, \"========================================\");\n    \n    // 1. åˆå§‹åŒ–WiFiï¼ˆçœç•¥WiFiè¿æ¥ä»£ç ï¼Œå‚è€ƒå®Œæ•´ç¤ºä¾‹ï¼‰\n    // wifi_init_sta();\n    \n    // 2. åˆå§‹åŒ–SignalRè¿æ¥å¯¹è±¡\n    ESP_LOGI(TAG, \"Step 1: Initializing SignalR...\");\n    init_signalr();\n    \n    // 3. æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨\n    ESP_LOGI(TAG, \"Step 2: Setting up message handlers...\");\n    setup_message_handlers();\n    \n    // 4. å¯åŠ¨è¿æ¥\n    ESP_LOGI(TAG, \"Step 3: Starting connection...\");\n    start_signalr_connection();\n    \n    // 5. åˆ›å»ºæµ‹è¯•ä»»åŠ¡ï¼ˆå®šæœŸå‘é€æ¶ˆæ¯ï¼‰\n    ESP_LOGI(TAG, \"Step 4: Creating test task...\");\n    xTaskCreate(signalr_test_task, \"signalr_test\", 8192, NULL, 5, NULL);\n    \n    ESP_LOGI(TAG, \"Setup complete. Check logs for connection status.\");\n}\n</code></pre>\n<p><strong>å…³é”®ç‚¹è¯´æ˜</strong>ï¼š</p>\n<ol>\n<li><strong>è¿æ¥åˆ›å»º</strong>ï¼šä½¿ç”¨ <code>hub_connection_builder</code> æ„å»ºè¿æ¥ï¼Œé…ç½®WebSocketå®¢æˆ·ç«¯å·¥å‚</li>\n<li><strong>è·³è¿‡åå•†</strong>ï¼š<code>skip_negotiation(true)</code> ç›´æ¥ä½¿ç”¨WebSocketï¼Œæé«˜è¿æ¥é€Ÿåº¦</li>\n<li><strong>æ¶ˆæ¯å¤„ç†å™¨æ³¨å†Œ</strong>ï¼šä½¿ç”¨ <code>connection-&gt;on(\"EventName\", handler)</code> æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨</li>\n<li><strong>è¿æ¥ç¡®è®¤</strong>ï¼šé€šè¿‡æ¥æ”¶ <code>Notification</code> æ¶ˆæ¯åˆ¤æ–­è¿æ¥æˆåŠŸï¼ˆæœåŠ¡å™¨åœ¨ <code>OnConnectedAsync</code> ä¸­å‘é€ï¼‰</li>\n<li><strong>è°ƒç”¨æœåŠ¡å™¨æ–¹æ³•</strong>ï¼šä½¿ç”¨ <code>invoke()</code> è°ƒç”¨Hubæ–¹æ³•ï¼Œå¦‚ <code>SendMessage</code></li>\n</ol>\n<p><strong>å®Œæ•´è¿è¡Œæµç¨‹</strong>ï¼š</p>\n<pre><code>1. WiFiè¿æ¥æˆåŠŸ\n   â†“\n2. åˆ›å»ºSignalRè¿æ¥å¯¹è±¡\n   â†“\n3. æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨ï¼ˆReceiveMessageã€Notificationç­‰ï¼‰\n   â†“\n4. è°ƒç”¨ connection-&gt;start() å¯åŠ¨è¿æ¥\n   â†“\n5. ç­‰å¾…æœåŠ¡å™¨å‘é€ Notification æ¶ˆæ¯\n   â†“\n6. æ”¶åˆ° Notificationï¼Œæ ‡è®°è¿æ¥æˆåŠŸ\n   â†“\n7. å®šæœŸè°ƒç”¨ invoke(\"SendMessage\") å‘é€æ¶ˆæ¯\n   â†“\n8. æ¥æ”¶æœåŠ¡å™¨å¹¿æ’­çš„æ¶ˆæ¯ï¼Œè§¦å‘å¯¹åº”å¤„ç†å™¨\n</code></pre>\n<p><strong>ç¤ºä¾‹è¾“å‡º</strong>ï¼š</p>\n<pre><code>I (3480) SIGNALR_EXAMPLE: âœ“ Registered handler: ReceiveMessage\nI (3485) SIGNALR_EXAMPLE: âœ“ Registered handler: Notification\nI (3490) SIGNALR_EXAMPLE: Starting SignalR connection...\nI (4520) SIGNALR_EXAMPLE: ==============================================\nI (4520) SIGNALR_EXAMPLE: âœ“âœ“âœ“ Connected to SignalR Hub! âœ“âœ“âœ“\nI (4525) SIGNALR_EXAMPLE: ==============================================\nI (4530) SIGNALR_EXAMPLE: ğŸ”” Notification: Welcome to SignalR!\nI (14530) SIGNALR_EXAMPLE: ğŸ“¤ Sending message...\nI (14640) SIGNALR_EXAMPLE: âœ“ Message sent successfully!\nI (14650) SIGNALR_EXAMPLE: ğŸ“© Message received from server:\nI (14655) SIGNALR_EXAMPLE:    From: ESP32-Device\nI (14660) SIGNALR_EXAMPLE:    Text: Test message #1 from ESP32\n</code></pre>\n<h3 id=\"52-å®é™…æ•´åˆä»£ç ç”Ÿäº§ç¯å¢ƒå®Œæ•´å®ç°\">5.2 å®é™…æ•´åˆä»£ç ï¼ˆç”Ÿäº§ç¯å¢ƒå®Œæ•´å®ç°ï¼‰</h3>\n<blockquote>\n<p><strong>è¯´æ˜</strong>ï¼šä»¥ä¸‹ä»£ç æ¥è‡ªå°æ™ºAIé¡¹ç›®çš„å®é™…ç”Ÿäº§ä»£ç ï¼ŒåŒ…å«äº†å®Œæ•´çš„é”™è¯¯å¤„ç†ã€çŠ¶æ€ç®¡ç†ã€JWTè®¤è¯å’Œè‡ªåŠ¨é‡è¿æœºåˆ¶ã€‚</p>\n</blockquote>\n<p>å®é™…é¡¹ç›®ä»£ç åˆ†ä¸ºä¸‰ä¸ªä¸»è¦ä»“åº“ï¼š</p>\n<h4 id=\"521-å°æ™ºesp32è®¾å¤‡ä»£ç \">5.2.1 å°æ™ºESP32è®¾å¤‡ä»£ç </h4>\n<p><strong>ä»“åº“åœ°å€</strong>ï¼š</p>\n<ul>\n<li>ä¸»ä»“åº“ï¼š<a href=\"https://github.com/maker-community/xiaozhi-esp32\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/maker-community/xiaozhi-esp32</a></li>\n<li>SignalRé›†æˆåˆ†æ”¯ï¼š<code>signalr</code> å’Œ <code>signalr-update-audio</code></li>\n<li>å®Œæ•´ç¤ºä¾‹å·¥ç¨‹ï¼š<a href=\"https://github.com/maker-community/esp-signalr-example\" rel=\"noopener nofollow\" target=\"_blank\">esp-signalr-example</a></li>\n</ul>\n<blockquote>\n<p><strong>æ³¨æ„</strong>ï¼šSignalRåŠŸèƒ½ä¸»è¦åœ¨ <code>signalr</code> å’Œ <code>signalr-update-audio</code> ä¸¤ä¸ªåˆ†æ”¯ä¸­å®ç°ï¼Œè¿™ä¸¤ä¸ªåˆ†æ”¯éƒ½æ˜¯SignalRé›†æˆç›¸å…³çš„å¼€å‘åˆ†æ”¯ã€‚</p>\n</blockquote>\n<p><strong>æ ¸å¿ƒæ–‡ä»¶</strong>ï¼š</p>\n<ul>\n<li><code>main/signalr_client.cc</code> / <code>main/signalr_client.h</code> - <strong>SignalRå®¢æˆ·ç«¯æ ¸å¿ƒå®ç°</strong></li>\n<li><code>main/application.cc</code> / <code>main/application.h</code> - ä¸»åº”ç”¨ç¨‹åºé€»è¾‘å’ŒçŠ¶æ€ç®¡ç†</li>\n<li><code>main/protocols/websocket_protocol.cc</code> - WebSocketåè®®å®ç°</li>\n<li><code>main/protocols/mqtt_protocol.cc</code> - MQTTåè®®å®ç°</li>\n<li><code>main/mcp_server.cc</code> - MCPæœåŠ¡å™¨å®ç°</li>\n</ul>\n<p><strong>å®é™…å®ç°ç‰¹ç‚¹</strong>ï¼š</p>\n<p>ä¸ç¤ºä¾‹ä»£ç ç›¸æ¯”,ç”Ÿäº§ç¯å¢ƒå®ç°å¢åŠ äº†ï¼š</p>\n<ol>\n<li>\n<p><strong>å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></p>\n<ul>\n<li>è¿æ¥å»ºç«‹ã€æ–­å¼€é‡è¿ã€èµ„æºæ¸…ç†</li>\n<li>è®¾å¤‡çŠ¶æ€æœºç®¡ç†ï¼ˆç©ºé—²ã€è¿æ¥ä¸­ã€ç›‘å¬ã€è¯´è¯ç­‰ï¼‰</li>\n</ul>\n</li>\n<li>\n<p><strong>åè®®ç‰ˆæœ¬æ”¯æŒ</strong></p>\n<ul>\n<li>æ”¯æŒWebSocketå’ŒMQTTä¸¤ç§ä¼ è¾“åè®®</li>\n<li>åè®®å±‚æŠ½è±¡,æ˜“äºæ‰©å±•æ–°åè®®</li>\n</ul>\n</li>\n<li>\n<p><strong>éŸ³é¢‘æµå¤„ç†</strong></p>\n<ul>\n<li>å®æ—¶éŸ³é¢‘æ•°æ®çš„ç¼–ç ã€ä¼ è¾“å’Œæ¥æ”¶</li>\n<li><strong>éŸ³é¢‘åˆ†å—ä¼ è¾“</strong>ï¼ˆé‡è¦ï¼ï¼‰- è§£å†³å¤§æ•°æ®ä¼ è¾“å¯¼è‡´è¿æ¥æ–­å¼€çš„é—®é¢˜</li>\n<li>æ”¯æŒOpusç¼–è§£ç </li>\n</ul>\n</li>\n<li>\n<p><strong>MCPå·¥å…·é›†æˆ</strong></p>\n<ul>\n<li>å®Œæ•´çš„MCP Serverå®ç°</li>\n<li>å·¥å…·æ³¨å†Œã€è°ƒç”¨å’Œå“åº”æœºåˆ¶</li>\n<li>æ”¯æŒå¼‚æ­¥å·¥å…·æ‰§è¡Œ</li>\n</ul>\n</li>\n<li>\n<p><strong>SignalRå®¢æˆ·ç«¯å°è£…</strong></p>\n<ul>\n<li>å®Œæ•´çš„è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†</li>\n<li>JWT Tokenè®¤è¯</li>\n<li>è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼ˆæŒ‡æ•°é€€é¿ï¼‰</li>\n<li>è®¾å¤‡æ³¨å†Œå’Œå¿ƒè·³ä¿æŒ</li>\n<li>è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†</li>\n</ul>\n</li>\n</ol>\n<h5 id=\"signalrå®¢æˆ·ç«¯æ ¸å¿ƒå®ç°-signalr_clientcc\">SignalRå®¢æˆ·ç«¯æ ¸å¿ƒå®ç° (signalr_client.cc)</h5>\n<p>è¿™æ˜¯æ•´ä¸ªSignalRé›†æˆçš„æ ¸å¿ƒä»£ç ï¼Œå°è£…äº†æ‰€æœ‰ä¸SignalRé€šä¿¡ç›¸å…³çš„é€»è¾‘ã€‚</p>\n<p><strong>å®Œæ•´ä»£ç </strong>ï¼š<a href=\"https://github.com/maker-community/xiaozhi-esp32/blob/signalr-update-audio/main/signalr_client.cc\" rel=\"noopener nofollow\" target=\"_blank\">signalr_client.cc</a> ï¼ˆ850è¡Œï¼‰</p>\n<p><strong>å…³é”®å®ç°è¦ç‚¹</strong>ï¼š</p>\n<p><strong>1. å•ä¾‹æ¨¡å¼ç®¡ç†</strong> - å…¨å±€å”¯ä¸€å®ä¾‹</p>\n<pre><code class=\"language-cpp\">SignalRClient&amp; SignalRClient::GetInstance() {\n    static SignalRClient instance;\n    return instance;\n}\n</code></pre>\n<p><strong>2. JWT Tokenè®¤è¯</strong> - é€šè¿‡Query Stringä¼ é€’</p>\n<pre><code class=\"language-cpp\">bool SignalRClient::Initialize(const std::string&amp; hub_url, const std::string&amp; token) {\n    // ğŸ” Build URL with token as query parameter (ASP.NET Core SignalR standard method)\n    std::string final_hub_url = hub_url;\n    if (!token.empty()) {\n        ESP_LOGI(TAG, \"========== SignalR Token Authentication ==========\");\n        \n        // Remove \"Bearer \" prefix if present\n        std::string token_value = token;\n        if (token_value.find(\"Bearer \") == 0) {\n            token_value = token_value.substr(7);\n        }\n        \n        // Append token to URL\n        final_hub_url += \"?access_token=\" + token_value;\n    }\n    \n    // Create hub connection builder\n    auto builder = signalr::hub_connection_builder::create(final_hub_url);\n    \n    // Set WebSocket factory (ä½¿ç”¨ESP32çš„WebSocketå®ç°)\n    builder.with_websocket_factory([](const signalr::signalr_client_config&amp; config) {\n        auto client = std::make_shared&lt;signalr::esp32_websocket_client&gt;(config);\n        return client;\n    });\n    \n    // Skip negotiation (direct WebSocket connection)\n    builder.skip_negotiation(true);\n    \n    // Build connection\n    connection_ = std::make_unique&lt;signalr::hub_connection&gt;(builder.build());\n}\n</code></pre>\n<p><strong>3. è¶…æ—¶å’Œå¿ƒè·³é…ç½®</strong></p>\n<pre><code class=\"language-cpp\">signalr::signalr_client_config cfg;\ncfg.set_server_timeout(std::chrono::seconds(60));     // server expects 60s idle\ncfg.set_keepalive_interval(std::chrono::seconds(15)); // send ping every 15s\ncfg.set_handshake_timeout(std::chrono::seconds(5));   // short handshake timeout\n\n// IMPORTANT: Disable library's auto-reconnect! It has race condition bugs\ncfg.enable_auto_reconnect(false);\nconnection_-&gt;set_client_config(cfg);\n</code></pre>\n<p><strong>4. è¿æ¥ç¡®è®¤å’Œè‡ªåŠ¨æ³¨å†Œ</strong></p>\n<pre><code class=\"language-cpp\">// Register Notification handler to confirm connection\nconnection_-&gt;on(\"Notification\", [this](const std::vector&lt;signalr::value&gt;&amp; args) {\n    if (args.empty()) return;\n    \n    std::string message = args[0].as_string();\n    ESP_LOGI(TAG, \"ğŸ”” Notification from server: %s\", message.c_str());\n    \n    if (!connection_confirmed_) {\n        connection_confirmed_ = true;\n        ESP_LOGI(TAG, \"âœ“âœ“âœ“ SIGNALR CONNECTION CONFIRMED BY SERVER! âœ“âœ“âœ“\");\n        \n        // ğŸ”„ Auto-register device info after connection confirmed\n        std::string mac_address = DeviceInfo::GetMacAddress();\n        std::string metadata = DeviceInfo::BuildMetadataJson();\n        \n        RegisterDevice(mac_address, \"\", metadata, [](bool success, const std::string&amp; result) {\n            if (success) {\n                ESP_LOGI(TAG, \"âœ… Device auto-registration successful\");\n            }\n        });\n    }\n});\n</code></pre>\n<p><strong>5. è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†</strong></p>\n<pre><code class=\"language-cpp\">connection_-&gt;on(\"CustomMessage\", [this](const std::vector&lt;signalr::value&gt;&amp; args) {\n    if (args.empty()) return;\n    \n    try {\n        std::string json_str = args[0].as_string();\n        ESP_LOGI(TAG, \"ğŸ“¨ Received CustomMessage: %s\", json_str.c_str());\n        \n        auto root = cJSON_Parse(json_str.c_str());\n        if (root) {\n            if (on_custom_message_) {\n                on_custom_message_(root);  // è°ƒç”¨ç”¨æˆ·è®¾ç½®çš„å›è°ƒ\n            }\n            cJSON_Delete(root);\n        }\n    } catch (const std::exception&amp; e) {\n        ESP_LOGE(TAG, \"Exception handling CustomMessage: %s\", e.what());\n    }\n});\n</code></pre>\n<p><strong>6. è‡ªåŠ¨é‡è¿æœºåˆ¶</strong> - ä½¿ç”¨PSRAMæ ˆçš„åå°ä»»åŠ¡</p>\n<pre><code class=\"language-cpp\">void SignalRClient::StartReconnectTask() {\n    ESP_LOGI(TAG, \"Starting SignalR reconnect background task (PSRAM stack)...\");\n    reconnect_task_running_.store(true, std::memory_order_release);\n    \n    // Allocate task stack from PSRAM (reusable)\n    reconnect_task_stack_ = (StackType_t*)heap_caps_malloc(\n        RECONNECT_TASK_STACK_SIZE, MALLOC_CAP_SPIRAM);\n    \n    // Create task with static allocation (stack in PSRAM)\n    reconnect_task_handle_ = xTaskCreateStatic(\n        ReconnectTaskEntry, \"signalr_reconn\",\n        RECONNECT_TASK_STACK_SIZE / sizeof(StackType_t),\n        this, 2, reconnect_task_stack_, reconnect_task_buffer_\n    );\n}\n\nvoid SignalRClient::ReconnectTaskLoop() {\n    while (reconnect_task_running_.load(std::memory_order_acquire)) {\n        vTaskDelay(pdMS_TO_TICKS(1000));\n        \n        if (!reconnect_requested_.load() || IsConnected()) {\n            continue;\n        }\n        \n        // Apply exponential backoff\n        ESP_LOGI(TAG, \"Attempting connection (backoff=%dms)...\", reconnect_backoff_ms_);\n        \n        if (Connect() &amp;&amp; IsConnected()) {\n            reconnect_backoff_ms_ = 1000;  // Reset backoff on success\n        } else {\n            vTaskDelay(pdMS_TO_TICKS(reconnect_backoff_ms_));\n            reconnect_backoff_ms_ = std::min(reconnect_backoff_ms_ * 2, \n                MAX_RECONNECT_BACKOFF_MS);  // Exponential backoff\n        }\n    }\n}\n</code></pre>\n<p><strong>7. è®¾å¤‡æ³¨å†Œå’Œå¿ƒè·³</strong></p>\n<pre><code class=\"language-cpp\">void SignalRClient::RegisterDevice(\n    const std::string&amp; mac_address,\n    const std::string&amp; device_token,\n    const std::string&amp; metadata,\n    std::function&lt;void(bool, const std::string&amp;)&gt; callback) {\n    \n    if (!IsConnected()) {\n        if (callback) callback(false, \"Not connected\");\n        return;\n    }\n    \n    std::vector&lt;signalr::value&gt; args;\n    args.push_back(signalr::value(mac_address));\n    args.push_back(signalr::value(device_token));\n    args.push_back(signalr::value(metadata));\n    \n    connection_-&gt;invoke(\"RegisterDevice\", args,\n        [callback](const signalr::value&amp; result, std::exception_ptr ex) {\n            if (ex) {\n                if (callback) callback(false, \"Registration failed\");\n            } else {\n                if (callback) callback(true, \"Registration sent\");\n            }\n        });\n}\n\nvoid SignalRClient::SendHeartbeat(\n    std::function&lt;void(bool, const std::string&amp;)&gt; callback) {\n    \n    if (!IsConnected()) {\n        if (callback) callback(false, \"Not connected\");\n        return;\n    }\n    \n    std::vector&lt;signalr::value&gt; args;\n    connection_-&gt;invoke(\"Heartbeat\", args,\n        [callback](const signalr::value&amp; result, std::exception_ptr ex) {\n            if (!ex) {\n                ESP_LOGD(TAG, \"ğŸ’“ Heartbeat sent\");\n                if (callback) callback(true, \"Success\");\n            }\n        });\n}\n</code></pre>\n<p><strong>SignalRå®¢æˆ·ç«¯ç±»å®šä¹‰</strong> (signalr_client.h):</p>\n<pre><code class=\"language-cpp\">class SignalRClient {\npublic:\n    static SignalRClient&amp; GetInstance();\n    \n    // è¿æ¥ç®¡ç†\n    bool Initialize(const std::string&amp; hub_url, const std::string&amp; token);\n    bool Connect();\n    void Disconnect();\n    void Reset();\n    void RequestReconnect();\n    \n    // çŠ¶æ€æŸ¥è¯¢\n    bool IsInitialized() const;\n    bool IsConnecting() const;\n    bool IsConnected() const;\n    std::string GetConnectionState() const;\n    \n    // å›è°ƒè®¾ç½®\n    void OnCustomMessage(std::function&lt;void(const cJSON*)&gt; callback);\n    void OnDeviceRegistered(std::function&lt;void(const cJSON*)&gt; callback);\n    \n    // Hubæ–¹æ³•è°ƒç”¨\n    void RegisterDevice(const std::string&amp; mac_address,\n                       const std::string&amp; device_token,\n                       const std::string&amp; metadata,\n                       std::function&lt;void(bool, const std::string&amp;)&gt; callback);\n    void SendHeartbeat(std::function&lt;void(bool, const std::string&amp;)&gt; callback);\n    void InvokeHubMethod(const std::string&amp; method_name,\n                        const std::string&amp; args_json,\n                        std::function&lt;void(bool, const std::string&amp;)&gt; callback);\n\nprivate:\n    SignalRClient();\n    ~SignalRClient();\n    \n    std::unique_ptr&lt;signalr::hub_connection&gt; connection_;\n    std::string hub_url_;\n    std::string token_;\n    bool initialized_ = false;\n    bool connection_confirmed_ = false;\n    std::atomic&lt;bool&gt; reconnect_requested_{false};\n    \n    // å›è°ƒå‡½æ•°\n    std::function&lt;void(const cJSON*)&gt; on_custom_message_;\n    std::function&lt;void(const cJSON*)&gt; on_device_registered_;\n    \n    // é‡è¿ä»»åŠ¡\n    TaskHandle_t reconnect_task_handle_ = nullptr;\n    int reconnect_backoff_ms_ = 1000;\n};\n</code></pre>\n<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p>\n<pre><code class=\"language-cpp\">// åœ¨ä¸»åº”ç”¨ä¸­ä½¿ç”¨SignalRå®¢æˆ·ç«¯\nvoid Application::InitializeSignalR() {\n    auto&amp; client = SignalRClient::GetInstance();\n    \n    // è®¾ç½®æ¶ˆæ¯å›è°ƒ\n    client.OnCustomMessage([this](const cJSON* json) {\n        ESP_LOGI(TAG, \"Received message from server\");\n        HandleServerMessage(json);\n    });\n    \n    // åˆå§‹åŒ–å¹¶è¿æ¥\n    std::string hub_url = \"wss://your-server.com/devicehub\";\n    std::string token = GetJwtToken();  // ä»NVSè¯»å–æˆ–æ‰«ç è·å–\n    \n    if (client.Initialize(hub_url, token)) {\n        if (client.Connect()) {\n            client.RequestReconnect();  // å¯åŠ¨è‡ªåŠ¨é‡è¿ä»»åŠ¡\n        }\n    }\n}\n</code></pre>\n<h5 id=\"applicationå±‚é›†æˆä»£ç \">Applicationå±‚é›†æˆä»£ç </h5>\n<p><strong>æ ¸å¿ƒä»£ç ç‰‡æ®µ</strong> (application.cc):</p>\n<pre><code class=\"language-cpp\">\nvoid Application::HandleSignalRMessage(const std::string&amp; message) {\n    ESP_LOGI(TAG, \"Handling SignalR message: %s\", message.c_str());\n    \n    auto root = cJSON_Parse(message.c_str());\n    if (!root) {\n        ESP_LOGE(TAG, \"Failed to parse SignalR message JSON\");\n        return;\n    }\n    \n    auto display = Board::GetInstance().GetDisplay();\n    \n    // Check message action/type\n    auto action = cJSON_GetObjectItem(root, \"action\");\n    if (cJSON_IsString(action)) {\n        if (strcmp(action-&gt;valuestring, \"notification\") == 0) {\n            // Handle notification\n            // JSON: {\"action\":\"notification\", \"title\":\"æ ‡é¢˜\", \"content\":\"å†…å®¹\", \"emotion\":\"bell\", \"sound\":\"popup\"}\n            auto title = cJSON_GetObjectItem(root, \"title\");\n            auto content = cJSON_GetObjectItem(root, \"content\");\n            auto emotion = cJSON_GetObjectItem(root, \"emotion\");\n            auto sound = cJSON_GetObjectItem(root, \"sound\");\n            \n            const char* title_str = cJSON_IsString(title) ? title-&gt;valuestring : Lang::Strings::INFO;\n            const char* content_str = cJSON_IsString(content) ? content-&gt;valuestring : \"\";\n            const char* emotion_str = cJSON_IsString(emotion) ? emotion-&gt;valuestring : \"bell\";\n            \n            // Select sound based on \"sound\" field\n            std::string_view sound_view = Lang::Sounds::OGG_POPUP;\n            if (cJSON_IsString(sound)) {\n                if (strcmp(sound-&gt;valuestring, \"success\") == 0) {\n                    sound_view = Lang::Sounds::OGG_SUCCESS;\n                } else if (strcmp(sound-&gt;valuestring, \"vibration\") == 0) {\n                    sound_view = Lang::Sounds::OGG_VIBRATION;\n                } else if (strcmp(sound-&gt;valuestring, \"exclamation\") == 0) {\n                    sound_view = Lang::Sounds::OGG_EXCLAMATION;\n                } else if (strcmp(sound-&gt;valuestring, \"low_battery\") == 0) {\n                    sound_view = Lang::Sounds::OGG_LOW_BATTERY;\n                } else if (strcmp(sound-&gt;valuestring, \"none\") == 0) {\n                    sound_view = \"\";\n                }\n                // default: popup\n            }\n            \n            Alert(title_str, content_str, emotion_str, sound_view);\n            \n        } else if (strcmp(action-&gt;valuestring, \"command\") == 0) {\n            // Handle command\n            // JSON: {\"action\":\"command\", \"command\":\"reboot|wake|listen|stop\"}\n            auto cmd = cJSON_GetObjectItem(root, \"command\");\n            if (cJSON_IsString(cmd)) {\n                if (strcmp(cmd-&gt;valuestring, \"reboot\") == 0) {\n                    Reboot();\n                } else if (strcmp(cmd-&gt;valuestring, \"wake\") == 0) {\n                    // Trigger wake word detection\n                    xEventGroupSetBits(event_group_, MAIN_EVENT_WAKE_WORD_DETECTED);\n                } else if (strcmp(cmd-&gt;valuestring, \"listen\") == 0) {\n                    StartListening();\n                } else if (strcmp(cmd-&gt;valuestring, \"stop\") == 0) {\n                    StopListening();\n                } else {\n                    ESP_LOGW(TAG, \"Unknown SignalR command: %s\", cmd-&gt;valuestring);\n                }\n            }\n            \n        } else if (strcmp(action-&gt;valuestring, \"display\") == 0) {\n            // Display custom content\n            // JSON: {\"action\":\"display\", \"content\":\"æ–‡æœ¬å†…å®¹\", \"role\":\"system\"}\n            auto content = cJSON_GetObjectItem(root, \"content\");\n            auto role = cJSON_GetObjectItem(root, \"role\");\n            const char* role_str = cJSON_IsString(role) ? role-&gt;valuestring : \"system\";\n            if (cJSON_IsString(content)) {\n                display-&gt;SetChatMessage(role_str, content-&gt;valuestring);\n            }\n            \n        } else if (strcmp(action-&gt;valuestring, \"emotion\") == 0) {\n            // Change emotion/expression\n            // JSON: {\"action\":\"emotion\", \"emotion\":\"happy\"}\n            auto emotion = cJSON_GetObjectItem(root, \"emotion\");\n            if (cJSON_IsString(emotion)) {\n                display-&gt;SetEmotion(emotion-&gt;valuestring);\n            }\n            \n        } else if (strcmp(action-&gt;valuestring, \"image\") == 0) {\n            // Display image from URL\n            // JSON: {\"action\":\"image\", \"url\":\"https://example.com/image.jpg\"}\n            auto url = cJSON_GetObjectItem(root, \"url\");\n            if (cJSON_IsString(url)) {\n                HandleSignalRImageMessage(url-&gt;valuestring);\n            } else {\n                ESP_LOGW(TAG, \"Image action requires 'url' field\");\n            }\n            \n        } else if (strcmp(action-&gt;valuestring, \"audio\") == 0) {\n            // Play audio from URL (OGG format)\n            // JSON: {\"action\":\"audio\", \"url\":\"https://example.com/sound.ogg\"}\n            auto url = cJSON_GetObjectItem(root, \"url\");\n            if (cJSON_IsString(url)) {\n                HandleSignalRAudioMessage(url-&gt;valuestring);\n            } else {\n                ESP_LOGW(TAG, \"Audio action requires 'url' field\");\n            }\n            \n        } else if (strcmp(action-&gt;valuestring, \"qrcode\") == 0) {\n            // Show QR code\n            // JSON: {\"action\":\"qrcode\", \"data\":\"https://...\", \"title\":\"æ ‡é¢˜\", \"subtitle\":\"å‰¯æ ‡é¢˜\"}\n            auto data = cJSON_GetObjectItem(root, \"data\");\n            auto title = cJSON_GetObjectItem(root, \"title\");\n            auto subtitle = cJSON_GetObjectItem(root, \"subtitle\");\n            if (cJSON_IsString(data)) {\n                const char* title_str = cJSON_IsString(title) ? title-&gt;valuestring : nullptr;\n                const char* subtitle_str = cJSON_IsString(subtitle) ? subtitle-&gt;valuestring : nullptr;\n                display-&gt;ShowQRCode(data-&gt;valuestring, title_str, subtitle_str);\n            } else {\n                ESP_LOGW(TAG, \"QRCode action requires 'data' field\");\n            }\n            \n        } else if (strcmp(action-&gt;valuestring, \"hide_qrcode\") == 0) {\n            // Hide QR code\n            // JSON: {\"action\":\"hide_qrcode\"}\n            display-&gt;HideQRCode();\n            \n        } else {\n            // Default: display as system message\n            char* display_str = cJSON_Print(root);\n            if (display_str) {\n                display-&gt;SetChatMessage(\"system\", display_str);\n                cJSON_free(display_str);\n            }\n        }\n    } else {\n        // No action specified, display raw message\n        char* display_str = cJSON_Print(root);\n        if (display_str) {\n            display-&gt;SetChatMessage(\"system\", display_str);\n            cJSON_free(display_str);\n        }\n    }\n    \n    cJSON_Delete(root);\n}\n\n</code></pre>\n<p><strong>å®Œæ•´çš„Applicationç±»åŠŸèƒ½</strong>ï¼š</p>\n<ul>\n<li>âœ… è®¾å¤‡çŠ¶æ€ç®¡ç† (çŠ¶æ€æœº)</li>\n<li>âœ… ç½‘ç»œäº‹ä»¶å¤„ç† (è¿æ¥/æ–­å¼€)</li>\n<li>âœ… éŸ³é¢‘æœåŠ¡é›†æˆ (ç¼–è§£ç ã€æµå¤„ç†)</li>\n<li>âœ… å”¤é†’è¯æ£€æµ‹</li>\n<li>âœ… åè®®å±‚æŠ½è±¡ (WebSocket/MQTT)</li>\n<li>âœ… MCPæ¶ˆæ¯è·¯ç”±</li>\n<li>âœ… é”™è¯¯å¤„ç†å’Œæ¢å¤</li>\n<li>âœ… èµ„æºç®¡ç†å’Œæ¸…ç†</li>\n<li>âœ… çº¿ç¨‹å®‰å…¨çš„æ¶ˆæ¯è°ƒåº¦</li>\n</ul>\n<h4 id=\"522-mcpæœåŠ¡å™¨ä»£ç -verdure-mcp\">5.2.2 MCPæœåŠ¡å™¨ä»£ç  (verdure-mcp)</h4>\n<p><strong>ä»“åº“åœ°å€</strong>ï¼š<a href=\"https://github.com/maker-community/verdure-mcp\" rel=\"noopener nofollow\" target=\"_blank\">verdure-mcp</a></p>\n<p><strong>ç›®å½•ç»“æ„</strong>ï¼š</p>\n<pre><code>src/Verdure.Mcp.Server/\nâ”œâ”€â”€ Hubs/\nâ”‚   â””â”€â”€ DeviceHub.cs          # SignalR Hubå®ç°\nâ”œâ”€â”€ Tools/\nâ”‚   â”œâ”€â”€ MusicTool.cs          # éŸ³ä¹æ’­æ”¾æ§åˆ¶\nâ”‚   â”œâ”€â”€ EmailTool.cs          # é‚®ä»¶å‘é€\nâ”‚   â”œâ”€â”€ WeatherTool.cs        # å¤©æ°”æŸ¥è¯¢\nâ”‚   â””â”€â”€ SmartHomeTool.cs      # æ™ºèƒ½å®¶å±…æ§åˆ¶\nâ”œâ”€â”€ Services/\nâ”‚   â”œâ”€â”€ DeviceService.cs      # è®¾å¤‡ç®¡ç†æœåŠ¡\nâ”‚   â”œâ”€â”€ McpExecutor.cs        # MCPå·¥å…·æ‰§è¡Œå™¨\nâ”‚   â””â”€â”€ TokenService.cs       # JWTä»¤ç‰ŒæœåŠ¡\nâ””â”€â”€ Models/\n    â”œâ”€â”€ DeviceConnection.cs   # è®¾å¤‡è¿æ¥è®°å½•\n    â”œâ”€â”€ DeviceInfo.cs         # è®¾å¤‡ä¿¡æ¯\n    â””â”€â”€ McpToolLog.cs         # å·¥å…·è°ƒç”¨æ—¥å¿—\n</code></pre>\n<p><strong>DeviceHubå®Œæ•´å®ç°</strong> (Hubs/DeviceHub.cs):</p>\n<p>ç”Ÿäº§ç¯å¢ƒçš„DeviceHubå®é™…å®ç°ç‰¹ç‚¹ï¼š</p>\n<ul>\n<li>âœ… æ•°æ®åº“æŒä¹…åŒ– (Entity Framework Core + PostgreSQL)</li>\n<li>âœ… è®¾å¤‡æ³¨å†Œå’ŒçŠ¶æ€è·Ÿè¸ª</li>\n<li>âœ… ç”¨æˆ·å’Œè®¾å¤‡åˆ†ç»„ç®¡ç†</li>\n<li>âœ… å¿ƒè·³æ£€æµ‹</li>\n<li>âœ… åŒé‡è®¤è¯ (JWT + API Token)</li>\n<li>âœ… å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—</li>\n</ul>\n<pre><code class=\"language-csharp\">using Microsoft.AspNetCore.SignalR;\nusing Verdure.Mcp.Infrastructure.Database;\nusing Verdure.Mcp.Infrastructure.Services;\n\nnamespace Verdure.Mcp.Server.Hubs;\n\n/// &lt;summary&gt;\n/// è®¾å¤‡è¿æ¥Hub - å¤„ç†ESP32ç­‰IoTè®¾å¤‡çš„SignalRè¿æ¥\n/// &lt;/summary&gt;\npublic class DeviceHub : Hub\n{\n    private readonly McpDbContext _dbContext;\n    private readonly ITokenValidationService _tokenValidationService;\n    private readonly ILogger&lt;DeviceHub&gt; _logger;\n\n    public DeviceHub(\n        McpDbContext dbContext,\n        ITokenValidationService tokenValidationService,\n        ILogger&lt;DeviceHub&gt; logger)\n    {\n        _dbContext = dbContext;\n        _tokenValidationService = tokenValidationService;\n        _logger = logger;\n    }\n\n    /// &lt;summary&gt;\n    /// è®¾å¤‡è¿æ¥ - æ”¯æŒJWTå’ŒAPI TokenåŒé‡è®¤è¯\n    /// &lt;/summary&gt;\n    public override async Task OnConnectedAsync()\n    {\n        try\n        {\n            var httpContext = Context.GetHttpContext();\n            if (httpContext == null)\n            {\n                _logger.LogWarning(\"HttpContext is null\");\n                Context.Abort();\n                return;\n            }\n\n            // ä»æŸ¥è¯¢å‚æ•°è·å–token\n            var token = httpContext.Request.Query[\"access_token\"].ToString();\n            if (string.IsNullOrEmpty(token))\n            {\n                _logger.LogWarning(\"Connection attempt without token\");\n                Context.Abort();\n                return;\n            }\n\n            // éªŒè¯token - æ”¯æŒJWTå’ŒAPI Token\n            var validationResult = await _tokenValidationService.ValidateTokenAsync(token);\n            if (!validationResult.IsValid)\n            {\n                _logger.LogWarning(\"Invalid token: {Reason}\", validationResult.FailureReason);\n                Context.Abort();\n                return;\n            }\n\n            var userId = validationResult.UserId;\n            if (string.IsNullOrEmpty(userId))\n            {\n                _logger.LogWarning(\"Token valid but userId is missing\");\n                Context.Abort();\n                return;\n            }\n\n            // å°†è¿æ¥åŠ å…¥ç”¨æˆ·ç»„ (æ ¼å¼: Users:{userId})\n            await Groups.AddToGroupAsync(Context.ConnectionId, $\"Users:{userId}\");\n\n            _logger.LogInformation(\n                \"Device connected: ConnectionId={ConnectionId}, UserId={UserId}\",\n                Context.ConnectionId, userId);\n\n            // å‘é€æ¬¢è¿é€šçŸ¥\n            await Clients.Caller.SendAsync(\"Notification\", \n                $\"Welcome! Connected to Verdure MCP Server at {DateTime.UtcNow:yyyy-MM-dd HH:mm:ss}\");\n\n            await base.OnConnectedAsync();\n        }\n        catch (Exception ex)\n        {\n            _logger.LogError(ex, \"Error in OnConnectedAsync\");\n            Context.Abort();\n        }\n    }\n\n    /// &lt;summary&gt;\n    /// è®¾å¤‡æ–­å¼€è¿æ¥\n    /// &lt;/summary&gt;\n    public override async Task OnDisconnectedAsync(Exception? exception)\n    {\n        if (exception != null)\n        {\n            _logger.LogWarning(exception, \n                \"Device disconnected with error: ConnectionId={ConnectionId}\",\n                Context.ConnectionId);\n        }\n        else\n        {\n            _logger.LogInformation(\n                \"Device disconnected normally: ConnectionId={ConnectionId}\",\n                Context.ConnectionId);\n        }\n\n        await base.OnDisconnectedAsync(exception);\n    }\n\n    /// &lt;summary&gt;\n    /// è®¾å¤‡æ³¨å†Œ - ä¿å­˜è®¾å¤‡MACåœ°å€å’Œå…ƒæ•°æ®\n    /// &lt;/summary&gt;\n    public async Task RegisterDevice(string macAddress, string deviceToken, string metadata)\n    {\n        try\n        {\n            var userId = Context.Items[\"UserId\"]?.ToString();\n            if (string.IsNullOrEmpty(userId))\n            {\n                _logger.LogWarning(\"RegisterDevice called without userId\");\n                return;\n            }\n\n            _logger.LogInformation(\n                \"Device registration: UserId={UserId}, MAC={MacAddress}, Metadata={Metadata}\",\n                userId, macAddress, metadata);\n\n            // å°†è®¾å¤‡åŠ å…¥è®¾å¤‡ç»„ (æ ¼å¼: Device:{macAddress})\n            await Groups.AddToGroupAsync(Context.ConnectionId, $\"Device:{macAddress}\");\n\n            // ä¿å­˜è®¾å¤‡ä¿¡æ¯åˆ°æ•°æ®åº“\n            var existingDevice = await _dbContext.Devices\n                .FirstOrDefaultAsync(d =&gt; d.MacAddress == macAddress);\n\n            if (existingDevice != null)\n            {\n                existingDevice.LastSeenAt = DateTime.UtcNow;\n                existingDevice.Metadata = metadata;\n                existingDevice.IsOnline = true;\n            }\n            else\n            {\n                _dbContext.Devices.Add(new Device\n                {\n                    MacAddress = macAddress,\n                    UserId = userId,\n                    Metadata = metadata,\n                    IsOnline = true,\n                    CreatedAt = DateTime.UtcNow,\n                    LastSeenAt = DateTime.UtcNow\n                });\n            }\n\n            await _dbContext.SaveChangesAsync();\n\n            // ç¡®è®¤æ³¨å†ŒæˆåŠŸ\n            await Clients.Caller.SendAsync(\"Notification\", \n                $\"Device registered successfully: {macAddress}\");\n        }\n        catch (Exception ex)\n        {\n            _logger.LogError(ex, \"Error in RegisterDevice\");\n        }\n    }\n\n    /// &lt;summary&gt;\n    /// å¿ƒè·³ä¿æŒ\n    /// &lt;/summary&gt;\n    public async Task Heartbeat()\n    {\n        _logger.LogDebug(\"Heartbeat from ConnectionId={ConnectionId}\", Context.ConnectionId);\n        \n        // æ›´æ–°æœ€åæ´»è·ƒæ—¶é—´\n        // æ³¨æ„ï¼šå®é™…ä»£ç ä¸­å¯ä»¥æ ¹æ®ConnectionIdæŸ¥æ‰¾è®¾å¤‡å¹¶æ›´æ–°LastSeenAt\n        await Task.CompletedTask;\n    }\n}\n</code></pre>\n<p><strong>å®é™…çš„MCPå·¥å…·å®ç°</strong> (ä¸ä½¿ç”¨åŸºç±»):</p>\n<p>åœ¨verdure-mcpä¸­ï¼ŒMCPå·¥å…·<strong>ä¸ç»§æ‰¿ä»»ä½•åŸºç±»</strong>ï¼Œè€Œæ˜¯ï¼š</p>\n<ol>\n<li>ä½¿ç”¨ <code>[McpServerToolType]</code> ç‰¹æ€§æ ‡è®°</li>\n<li>é€šè¿‡ä¾èµ–æ³¨å…¥è·å– <code>IDevicePushService</code> æœåŠ¡</li>\n<li>ä½¿ç”¨ <code>IDevicePushService</code> çš„æ–¹æ³•æ¨é€æ¶ˆæ¯ç»™è®¾å¤‡</li>\n</ol>\n<p><strong>DevicePushServiceæ¥å£</strong> (Infrastructure/Services/DevicePushService.cs):</p>\n<pre><code class=\"language-csharp\">namespace Verdure.Mcp.Infrastructure.Services;\n\n/// &lt;summary&gt;\n/// è®¾å¤‡æ¨é€æœåŠ¡æ¥å£\n/// &lt;/summary&gt;\npublic interface IDevicePushService\n{\n    /// &lt;summary&gt;\n    /// å‘ç”¨æˆ·çš„æ‰€æœ‰è®¾å¤‡å‘é€æ¶ˆæ¯\n    /// &lt;/summary&gt;\n    Task SendToUserAsync(string userId, string method, object message, \n        CancellationToken cancellationToken = default);\n\n    /// &lt;summary&gt;\n    /// å‘æŒ‡å®šè®¾å¤‡å‘é€æ¶ˆæ¯\n    /// &lt;/summary&gt;\n    Task SendToDeviceAsync(string deviceId, string method, object message, \n        CancellationToken cancellationToken = default);\n\n    /// &lt;summary&gt;\n    /// å‘é€è‡ªå®šä¹‰æ¶ˆæ¯ (xiaozhiåè®®æ ¼å¼)\n    /// &lt;/summary&gt;\n    Task SendCustomMessageAsync(string userId, object message, \n        CancellationToken cancellationToken = default);\n\n    /// &lt;summary&gt;\n    /// å‘é€é€šçŸ¥æ¶ˆæ¯\n    /// &lt;/summary&gt;\n    Task SendNotificationAsync(string userId, string notificationMessage, \n        CancellationToken cancellationToken = default);\n}\n</code></pre>\n<p><strong>DevicePushServiceå®ç°</strong> (Server/Services/DevicePushServiceImpl.cs):</p>\n<pre><code class=\"language-csharp\">using Microsoft.AspNetCore.SignalR;\nusing Verdure.Mcp.Server.Hubs;\nusing Verdure.Mcp.Infrastructure.Services;\nusing System.Text.Json;\n\nnamespace Verdure.Mcp.Server.Services;\n\npublic class DevicePushServiceImpl : IDevicePushService\n{\n    private readonly IHubContext&lt;DeviceHub&gt; _hubContext;\n    private readonly ILogger&lt;DevicePushServiceImpl&gt; _logger;\n\n    public DevicePushServiceImpl(\n        IHubContext&lt;DeviceHub&gt; hubContext,\n        ILogger&lt;DevicePushServiceImpl&gt; logger)\n    {\n        _hubContext = hubContext;\n        _logger = logger;\n    }\n\n    public async Task SendToUserAsync(string userId, string method, object message, \n        CancellationToken cancellationToken = default)\n    {\n        var groupName = $\"Users:{userId}\";\n        await _hubContext.Clients.Group(groupName)\n            .SendAsync(method, message, cancellationToken);\n        \n        _logger.LogInformation(\"Sent {Method} to user {UserId}\", method, userId);\n    }\n\n    public async Task SendToDeviceAsync(string deviceId, string method, object message, \n        CancellationToken cancellationToken = default)\n    {\n        var groupName = $\"Device:{deviceId}\";\n        await _hubContext.Clients.Group(groupName)\n            .SendAsync(method, message, cancellationToken);\n        \n        _logger.LogInformation(\"Sent {Method} to device {DeviceId}\", method, deviceId);\n    }\n\n    public async Task SendCustomMessageAsync(string userId, object message, \n        CancellationToken cancellationToken = default)\n    {\n        var groupName = $\"Users:{userId}\";\n        \n        // é‡è¦ï¼ESP32å®¢æˆ·ç«¯æœŸæœ›æ¥æ”¶JSONå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å¯¹è±¡\n        var jsonString = JsonSerializer.Serialize(message);\n        \n        await _hubContext.Clients.Group(groupName)\n            .SendAsync(\"CustomMessage\", jsonString, cancellationToken);\n        \n        _logger.LogInformation(\"Sent CustomMessage to user {UserId}: {Message}\", \n            userId, jsonString);\n    }\n\n    public async Task SendNotificationAsync(string userId, string notificationMessage, \n        CancellationToken cancellationToken = default)\n    {\n        var groupName = $\"Users:{userId}\";\n        await _hubContext.Clients.Group(groupName)\n            .SendAsync(\"Notification\", notificationMessage, cancellationToken);\n        \n        _logger.LogInformation(\"Sent notification to user {UserId}: {Message}\", \n            userId, notificationMessage);\n    }\n}\n</code></pre>\n<p><strong>éŸ³ä¹æ’­æ”¾å·¥å…·å®é™…å®ç°</strong> (Tools/MusicTool.cs):</p>\n<pre><code class=\"language-csharp\">using System;\nusing System.ComponentModel;\nusing System.IO;\nusing System.Linq;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing Microsoft.AspNetCore.Hosting;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.Extensions.Logging;\nusing Microsoft.Extensions.Options;\nusing Verdure.Mcp.Server.Settings;\nusing ModelContextProtocol.Server;\nusing Verdure.Mcp.Infrastructure.Services;\nusing Verdure.Mcp.Server.Services;\nusing Hangfire;\n\nnamespace Verdure.Mcp.Server.Tools;\n\n/// &lt;summary&gt;\n/// MCP Tool to pick a random audio file from wwwroot and push its URL to device(s).\n/// &lt;/summary&gt;\n[McpServerToolType]\npublic class MusicTool\n{\n    private readonly IHttpContextAccessor _httpContextAccessor;\n    private readonly IWebHostEnvironment _env;\n    private readonly IDevicePushService _devicePushService;\n    private readonly ILogger&lt;MusicTool&gt; _logger;\n    private readonly IBackgroundJobClient _backgroundJobClient;\n    private readonly ImageStorageSettings _imageStorageSettings;\n\n    public MusicTool(\n        IHttpContextAccessor httpContextAccessor,\n        IWebHostEnvironment env,\n        IDevicePushService devicePushService,\n        ILogger&lt;MusicTool&gt; logger,\n        IBackgroundJobClient backgroundJobClient,\n        IOptions&lt;ImageStorageSettings&gt;? imageSettings = null)\n    {\n        _httpContextAccessor = httpContextAccessor;\n        _env = env;\n        _devicePushService = devicePushService;\n        _logger = logger;\n        _backgroundJobClient = backgroundJobClient;\n        _imageStorageSettings = imageSettings?.Value ?? new ImageStorageSettings();\n    }\n\n    /// &lt;summary&gt;\n    /// Select a random audio file from the `wwwroot/audio` folder and push it to the user\n    /// identified by the `X-User-Id` request header.\n    /// The pushed message follows the same shape as used in `test-send-message.ps1` (action = \"audio\", url = \"...\").\n    /// &lt;/summary&gt;\n    [McpServerTool(Name = \"play_random_music\")]\n    [Description(\"Plays a random audio file from wwwroot/audio by pushing an audio message to the user's devices\")]\n    public async Task&lt;MusicResponse&gt; PlayRandomMusic(CancellationToken cancellationToken = default)\n    {\n        try\n        {\n            var httpContext = _httpContextAccessor.HttpContext;\n            var effectiveUserId = httpContext?.Request.Headers[\"X-User-Id\"].FirstOrDefault();\n            if (string.IsNullOrEmpty(effectiveUserId))\n            {\n                _logger.LogWarning(\"No userId provided and X-User-Id header is missing\");\n                return new MusicResponse { Success = false, Message = \"Missing userId or X-User-Id header\" };\n            }\n\n            var webRoot = _env.WebRootPath ?? _env.ContentRootPath;\n            var folder = \"audios\";\n            var audioFolder = Path.Combine(webRoot, folder);\n\n            if (!Directory.Exists(audioFolder))\n            {\n                _logger.LogWarning(\"Audio folder does not exist: {AudioFolder}\", audioFolder);\n                return new MusicResponse { Success = false, Message = $\"Audio folder not found: {folder}\" };\n            }\n\n            // Find audio files (ogg, mp3) and pick a random one\n            var files = Directory.GetFiles(audioFolder)\n                .Where(f =&gt; f.EndsWith('.' + \"ogg\") || f.EndsWith('.' + \"mp3\") || f.EndsWith('.' + \"wav\"))\n                .ToArray();\n\n            if (files.Length == 0)\n            {\n                _logger.LogWarning(\"No audio files found in {AudioFolder}\", audioFolder);\n                return new MusicResponse { Success = false, Message = \"No audio files found\" };\n            }\n\n            var rnd = new Random();\n            var chosen = files[rnd.Next(files.Length)];\n            var fileName = Path.GetFileName(chosen);\n\n            string url;\n            // Prefer configured ImageStorage BaseUrl (keeps image and audio base URL consistent)\n            if (!string.IsNullOrWhiteSpace(_imageStorageSettings.BaseUrl))\n            {\n                var cfgBase = _imageStorageSettings.BaseUrl.TrimEnd('/');\n                url = $\"{cfgBase}/{folder}/{Uri.EscapeDataString(fileName)}\";\n            }\n            else\n            {\n                var req = httpContext?.Request;\n                var hostBase = req != null ? $\"{req.Scheme}://{req.Host.Value}\" : string.Empty;\n                url = string.IsNullOrEmpty(hostBase)\n                    ? $\"/{folder}/{Uri.EscapeDataString(fileName)}\"\n                    : $\"{hostBase}/{folder}/{Uri.EscapeDataString(fileName)}\";\n            }\n\n            var title = Path.GetFileNameWithoutExtension(fileName);\n\n            var message = new\n            {\n                action = \"audio\",\n                url,\n                title\n            };\n\n            // Schedule push as a delayed background job so device can play result first.\n            try\n            {\n\n                var jobDelay = TimeSpan.FromSeconds(5);\n\n                _logger.LogInformation(\"Scheduling audio push to user {UserId} after {Delay}s: {Url}\",\n                    effectiveUserId, jobDelay.TotalSeconds, url);\n\n                _backgroundJobClient.Schedule&lt;MusicPushBackgroundJob&gt;(\n                    job =&gt; job.ExecuteAsync(effectiveUserId, url, title, CancellationToken.None),\n                    jobDelay);\n\n                return new MusicResponse { Success = true, Message = \"Audio scheduled\", Url = url, FileName = fileName };\n            }\n            catch (Exception ex)\n            {\n                _logger.LogError(ex, \"Failed to schedule audio push for user {UserId}\", effectiveUserId);\n                return new MusicResponse { Success = false, Message = ex.Message };\n            }\n        }\n        catch (Exception ex)\n        {\n            _logger.LogError(ex, \"Failed to play random music\");\n            return new MusicResponse { Success = false, Message = ex.Message };\n        }\n    }\n}\n\npublic class MusicResponse\n{\n    public bool Success { get; set; }\n    public required string Message { get; set; }\n    public string? Url { get; set; }\n    public string? FileName { get; set; }\n}\n\n</code></pre>\n<p><strong>å»¶è¿Ÿæ¨é€åå°ä»»åŠ¡</strong> (Tools/MusicPushBackgroundJob.cs):</p>\n<pre><code class=\"language-csharp\">using Verdure.Mcp.Infrastructure.Services;\nusing Verdure.Mcp.Server.Services;\n\nnamespace Verdure.Mcp.Server.Tools;\n\n/// &lt;summary&gt;\n/// Background job to push music/audio messages to user devices after a delay.\n/// &lt;/summary&gt;\npublic class MusicPushBackgroundJob\n{\n    private readonly IDevicePushService _devicePushService;\n    private readonly ILogger&lt;MusicPushBackgroundJob&gt; _logger;\n\n    public MusicPushBackgroundJob(IDevicePushService devicePushService, ILogger&lt;MusicPushBackgroundJob&gt; logger)\n    {\n        _devicePushService = devicePushService;\n        _logger = logger;\n    }\n\n    public async Task ExecuteAsync(string userId, string url, string title, CancellationToken cancellationToken)\n    {\n        _logger.LogInformation(\"Executing MusicPushBackgroundJob: user={UserId}, url={Url}\", userId, url);\n\n        var message = new\n        {\n            action = \"audio\",\n            url,\n            title\n        };\n\n        try\n        {\n            await _devicePushService.SendCustomMessageAsync(userId, message, cancellationToken);\n            _logger.LogInformation(\"Music pushed to user {UserId}\", userId);\n        }\n        catch (Exception ex)\n        {\n            _logger.LogError(ex, \"Failed to push music to user {UserId}\", userId);\n        }\n    }\n}\n\n</code></pre>\n<h4 id=\"523-å›¾ç‰‡ç”Ÿæˆå·¥å…·å®ç°ç¤ºä¾‹\">5.2.3 å›¾ç‰‡ç”Ÿæˆå·¥å…·å®ç°ç¤ºä¾‹</h4>\n<p><strong>ä»“åº“åœ°å€</strong>ï¼š<a href=\"https://github.com/maker-community/verdure-mcp/blob/main/src/Verdure.Mcp.Server/Tools/GenerateImageTool.cs\" rel=\"noopener nofollow\" target=\"_blank\">verdure-mcp - GenerateImageTool</a></p>\n<p>è¿™ä¸ªå·¥å…·å±•ç¤ºäº†å¦‚ä½•ç”Ÿæˆå›¾ç‰‡å¹¶æ¨é€åˆ°è®¾å¤‡ï¼š</p>\n<pre><code class=\"language-csharp\">using System.ComponentModel;\nusing System.Net;\nusing Hangfire;\nusing Microsoft.EntityFrameworkCore;\nusing ModelContextProtocol.Server;\nusing Verdure.Mcp.Domain.Entities;\nusing Verdure.Mcp.Domain.Enums;\nusing Verdure.Mcp.Infrastructure.Data;\nusing Verdure.Mcp.Infrastructure.Services;\nusing Verdure.Mcp.Server.Services;\n\nnamespace Verdure.Mcp.Server.Tools;\n\n/// &lt;summary&gt;\n/// ä½¿ç”¨ Azure OpenAI DALL-E ç”Ÿæˆå›¾ç‰‡çš„ MCP å·¥å…·\n/// &lt;/summary&gt;\n[McpServerToolType]\npublic class GenerateImageTool\n{\n    private readonly IImageGenerationService _imageGenerationService;\n    private readonly IEmailService _emailService;\n    private readonly McpDbContext _dbContext;\n    private readonly IBackgroundJobClient _backgroundJobClient;\n    private readonly IHttpContextAccessor _httpContextAccessor;\n    private readonly IImageStorageService _imageStorageService;\n    private readonly IDevicePushService _devicePushService;\n    private readonly ILogger&lt;GenerateImageTool&gt; _logger;\n\n    public GenerateImageTool(\n        IImageGenerationService imageGenerationService,\n        IEmailService emailService,\n        McpDbContext dbContext,\n        IBackgroundJobClient backgroundJobClient,\n        IHttpContextAccessor httpContextAccessor,\n        IImageStorageService imageStorageService,\n        IDevicePushService devicePushService,\n        ILogger&lt;GenerateImageTool&gt; logger)\n    {\n        _imageGenerationService = imageGenerationService;\n        _emailService = emailService;\n        _dbContext = dbContext;\n        _backgroundJobClient = backgroundJobClient;\n        _httpContextAccessor = httpContextAccessor;\n        _imageStorageService = imageStorageService;\n        _devicePushService = devicePushService;\n        _logger = logger;\n    }\n\n    /// &lt;summary&gt;\n    /// ä½¿ç”¨ Azure OpenAI DALL-E æ ¹æ®æç¤ºè¯ç”Ÿæˆå›¾ç‰‡ã€‚\n    /// å¦‚æœæä¾›é‚®ç®±åœ°å€ï¼Œä¼šå°†ç”Ÿæˆçš„å›¾ç‰‡å‘é€åˆ°æŒ‡å®šé‚®ç®±ã€‚\n    /// å¦‚æœè¯·æ±‚å¤´ä¸­åŒ…å«ç”¨æˆ·ä¿¡æ¯ï¼ˆX-User-Email å’Œ X-User-Idï¼‰ï¼Œä»»åŠ¡å°†å¼‚æ­¥è¿è¡Œã€‚\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"prompt\"&gt;æè¿°è¦ç”Ÿæˆå›¾ç‰‡çš„æ–‡æœ¬æç¤ºè¯&lt;/param&gt;\n    /// &lt;param name=\"size\"&gt;å›¾ç‰‡å°ºå¯¸ï¼š\"1024x1024\"ã€\"1792x1024\" æˆ– \"1024x1792\"ï¼Œé»˜è®¤ä¸º \"1024x1024\"&lt;/param&gt;\n    /// &lt;param name=\"quality\"&gt;å›¾ç‰‡è´¨é‡ï¼š\"standard\" æˆ– \"hd\"ï¼Œé»˜è®¤ä¸º \"standard\"&lt;/param&gt;\n    /// &lt;param name=\"style\"&gt;å›¾ç‰‡é£æ ¼ï¼š\"vivid\" æˆ– \"natural\"ï¼Œé»˜è®¤ä¸º \"vivid\"&lt;/param&gt;\n    /// &lt;param name=\"cancellationToken\"&gt;&lt;/param&gt;\n    /// &lt;returns&gt;åŒ…å«ä»»åŠ¡ä¿¡æ¯å’Œå›¾ç‰‡æ•°æ®çš„ JSON å¯¹è±¡ï¼ˆåŒæ­¥æ¨¡å¼ä¸‹ï¼‰&lt;/returns&gt;\n    [McpServerTool(Name = \"generate_image\")]\n    [Description(\"ä½¿ç”¨ DALL-E æ¨¡å‹ï¼Œæ ¹æ®æ–‡æœ¬æç¤ºè¯ç”Ÿæˆå›¾ç‰‡ã€‚æ”¯æŒé‚®ä»¶é€šçŸ¥å’Œå¼‚æ­¥å¤„ç†ã€‚\")]\n    public async Task&lt;ImageGenerationResponse&gt; GenerateImage(\n        [Description(\"æè¿°è¦ç”Ÿæˆå›¾ç‰‡çš„æ–‡æœ¬æç¤ºè¯\")] string prompt,\n        [Description(\"å›¾ç‰‡å°ºå¯¸ï¼š'1024x1024'ã€'1792x1024' æˆ– '1024x1792'ï¼Œé»˜è®¤ä¸º '1024x1024'\")] string? size = null,\n        [Description(\"å›¾ç‰‡è´¨é‡ï¼š'standard' æˆ– 'hd'ï¼Œé»˜è®¤ä¸º 'standard'\")] string? quality = null,\n        [Description(\"å›¾ç‰‡é£æ ¼ï¼š'vivid' æˆ– 'natural'ï¼Œé»˜è®¤ä¸º 'vivid'\")] string? style = null,\n        CancellationToken cancellationToken = default)\n    {\n        var httpContext = _httpContextAccessor.HttpContext;\n        \n        // ä»è¯·æ±‚å¤´æå–é‚®ç®±åœ°å€ (X-User-Email)\n        var email = httpContext?.Request.Headers[\"X-User-Email\"].FirstOrDefault();\n        \n        // ä»è¯·æ±‚å¤´æå–ç”¨æˆ· ID (X-User-Id)\n        var userId = httpContext?.Request.Headers[\"X-User-Id\"].FirstOrDefault();\n\n        _logger.LogInformation(\"æ”¶åˆ°å›¾ç‰‡ç”Ÿæˆè¯·æ±‚ã€‚æç¤ºè¯: {Prompt}, é‚®ç®±: {Email}, ç”¨æˆ·ID: {UserId}\", \n            prompt, email ?? \"æ— \", userId ?? \"æ— \");\n\n        // åˆ›å»ºä»»åŠ¡è®°å½•\n        var task = new ImageGenerationTask\n        {\n            Id = Guid.NewGuid(),\n            Prompt = prompt,\n            Size = size ?? \"1024x1024\",\n            Quality = quality ?? \"standard\",\n            Style = style ?? \"vivid\",\n            Status = ImageTaskStatus.Pending,\n            Email = email,\n            UserId = userId,\n            CreatedAt = DateTime.UtcNow\n        };\n\n        _dbContext.ImageGenerationTasks.Add(task);\n        await _dbContext.SaveChangesAsync(cancellationToken);\n\n        // å¦‚æœå­˜åœ¨ç”¨æˆ·ä¿¡æ¯ï¼ˆX-User-Email å’Œ X-User-Idï¼‰ï¼Œä½¿ç”¨ Hangfire å¼‚æ­¥å¤„ç†\n        if (!string.IsNullOrEmpty(email) &amp;&amp; !string.IsNullOrEmpty(userId))\n        {\n            _logger.LogInformation(\"æ£€æµ‹åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œä½¿ç”¨å¼‚æ­¥å¤„ç†ä»»åŠ¡ {TaskId}\", task.Id);\n            \n            var jobId = _backgroundJobClient.Enqueue&lt;ImageGenerationBackgroundJob&gt;(\n                job =&gt; job.ExecuteAsync(task.Id, CancellationToken.None));\n            \n            task.HangfireJobId = jobId;\n            task.Status = ImageTaskStatus.Processing;\n            await _dbContext.SaveChangesAsync(cancellationToken);\n\n            return new ImageGenerationResponse\n            {\n                TaskId = task.Id,\n                Status = \"å¤„ç†ä¸­\",\n                Message = \"å›¾ç‰‡ç”Ÿæˆä»»åŠ¡å·²åŠ å…¥é˜Ÿåˆ—ã€‚å¦‚æœæ‚¨æä¾›äº†é‚®ç®±åœ°å€ï¼Œç¨åä¼šæ”¶åˆ°ç”Ÿæˆç»“æœã€‚\",\n                IsAsync = true\n            };\n        }\n        else\n        {\n            // åŒæ­¥å¤„ç†\n            _logger.LogInformation(\"æœªæ£€æµ‹åˆ°å®Œæ•´ç”¨æˆ·ä¿¡æ¯ï¼Œä½¿ç”¨åŒæ­¥å¤„ç†ä»»åŠ¡ {TaskId}\", task.Id);\n            \n            task.Status = ImageTaskStatus.Processing;\n            await _dbContext.SaveChangesAsync(cancellationToken);\n\n            try\n            {\n                var result = await _imageGenerationService.GenerateImageAsync(\n                    prompt, size, quality, style, cancellationToken);\n\n                if (result.Success)\n                {\n                    task.Status = ImageTaskStatus.Completed;\n                    task.ImageData = result.ImageBase64;\n                    task.CompletedAt = DateTime.UtcNow;\n                    task.UpdatedAt = DateTime.UtcNow;\n\n                    // ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼ˆPNG + JPEGï¼‰\n                    ImageStorageResult? storageResult = null;\n                    if (!string.IsNullOrEmpty(result.ImageBase64))\n                    {\n                        try\n                        {\n                            storageResult = await _imageStorageService.SaveImageAsync(\n                                result.ImageBase64, \n                                task.Id, \n                                cancellationToken);\n                            task.ImageUrl = storageResult.PngUrl; // æ•°æ®åº“ä¿å­˜ PNG URL\n                            _logger.LogInformation(\n                                \"å›¾ç‰‡å·²ä¿å­˜ - PNG: {PngUrl}, JPEG: {JpegUrl}, å‹ç¼©ç‡: {CompressionRatio:F1}%\",\n                                storageResult.PngUrl, storageResult.JpegUrl, storageResult.CompressionRatio);\n                        }\n                        catch (Exception ex)\n                        {\n                            _logger.LogError(ex, \"ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°å¤±è´¥ï¼Œä»»åŠ¡ {TaskId}\", task.Id);\n                            // å³ä½¿ä¿å­˜å¤±è´¥ï¼Œä»ç„¶ç»§ç»­æµç¨‹\n                        }\n                    }\n\n                    await _dbContext.SaveChangesAsync(cancellationToken);\n\n                    // å¦‚æœæä¾›äº†é‚®ç®±ï¼Œå‘é€é‚®ä»¶\n                    if (!string.IsNullOrEmpty(email) &amp;&amp; !string.IsNullOrEmpty(result.ImageBase64))\n                    {\n                        try\n                        {\n                            var imageBytes = Convert.FromBase64String(result.ImageBase64);\n                            var encodedPrompt = WebUtility.HtmlEncode(prompt);\n                            var encodedRevisedPrompt = WebUtility.HtmlEncode(result.RevisedPrompt ?? \"æ— \");\n                            await _emailService.SendImageEmailAsync(\n                                email,\n                                \"æ‚¨çš„å›¾ç‰‡å·²ç”Ÿæˆ\",\n                                $\"&lt;h1&gt;æ‚¨çš„å›¾ç‰‡å·²æˆåŠŸç”Ÿæˆï¼&lt;/h1&gt;&lt;p&gt;æç¤ºè¯ï¼š{encodedPrompt}&lt;/p&gt;&lt;p&gt;ä¿®è®¢åçš„æç¤ºè¯ï¼š{encodedRevisedPrompt}&lt;/p&gt;\",\n                                imageBytes,\n                                $\"image_{task.Id}.png\",\n                                cancellationToken);\n                            \n                            task.EmailSent = true;\n                            await _dbContext.SaveChangesAsync(cancellationToken);\n                        }\n                        catch (Exception ex)\n                        {\n                            _logger.LogError(ex, \"å‘é€é‚®ä»¶å¤±è´¥ï¼Œä»»åŠ¡ {TaskId}\", task.Id);\n                        }\n                    }\n\n                    // å¦‚æœæœ‰ç”¨æˆ· IDï¼Œæ¨é€åˆ°ç”¨æˆ·è®¾å¤‡ï¼ˆä½¿ç”¨ JPEG ç‰ˆæœ¬ï¼Œç¬¦åˆ xiaozhi åè®®ï¼‰\n                    if (!string.IsNullOrEmpty(userId) &amp;&amp; storageResult != null)\n                    {\n                        try\n                        {\n                            // 1. å…ˆå‘é€é€šçŸ¥æ¶ˆæ¯\n                            var notificationMessage = new\n                            {\n                                action = \"notification\",\n                                title = \"å›¾ç‰‡ç”Ÿæˆå®Œæˆ\",\n                                content = $\"æ‚¨çš„å›¾ç‰‡å·²ç”Ÿæˆï¼š{prompt.Substring(0, Math.Min(30, prompt.Length))}...\",\n                                emotion = \"happy\",\n                                sound = \"success\"\n                            };\n                            await _devicePushService.SendCustomMessageAsync(userId, notificationMessage, cancellationToken);\n                            \n                            // 2. å†å‘é€å›¾ç‰‡æ¶ˆæ¯ï¼ˆESP32 æœŸæœ›çš„æ ¼å¼ - xiaozhi åè®®ï¼‰\n                            var imageMessage = new\n                            {\n                                action = \"image\",\n                                url = storageResult.JpegUrl,  // ä½¿ç”¨ JPEG URLï¼ˆä½“ç§¯å°ï¼‰\n                                // æ‰©å±•ä¿¡æ¯ï¼ˆå¯é€‰ï¼ŒESP32 å¯ä»¥å¿½ç•¥ï¼‰\n                                taskId = task.Id.ToString(),\n                                pngUrl = storageResult.PngUrl,\n                                prompt = prompt,\n                                jpegSize = storageResult.JpegSize,\n                                timestamp = DateTime.UtcNow\n                            };\n\n                            await _devicePushService.SendCustomMessageAsync(userId, imageMessage, cancellationToken);\n                            _logger.LogInformation(\n                                \"å·²æ¨é€å›¾ç‰‡åˆ°ç”¨æˆ· {UserId} çš„è®¾å¤‡ï¼Œä»»åŠ¡ {TaskId}ï¼ŒJPEG URL: {JpegUrl} ({JpegSize} bytes)\", \n                                userId, task.Id, storageResult.JpegUrl, storageResult.JpegSize);\n                        }\n                        catch (Exception ex)\n                        {\n                            _logger.LogError(ex, \"æ¨é€æ¶ˆæ¯åˆ°è®¾å¤‡å¤±è´¥ï¼Œç”¨æˆ· {UserId}ï¼Œä»»åŠ¡ {TaskId}\", userId, task.Id);\n                        }\n                    }\n\n                    // åŒæ­¥æ¨¡å¼ï¼šè¿”å› PNG URLï¼ˆå®Œæ•´è´¨é‡ï¼‰\n                    return new ImageGenerationResponse\n                    {\n                        TaskId = task.Id,\n                        Status = \"å·²å®Œæˆ\",\n                        Message = \"å›¾ç‰‡ç”ŸæˆæˆåŠŸ\",\n                        ImageUrl = storageResult?.PngUrl ?? result.ImageUrl,\n                        RevisedPrompt = result.RevisedPrompt,\n                        IsAsync = false\n                    };\n                }\n                else\n                {\n                    task.Status = ImageTaskStatus.Failed;\n                    task.ErrorMessage = result.ErrorMessage;\n                    task.UpdatedAt = DateTime.UtcNow;\n                    await _dbContext.SaveChangesAsync(cancellationToken);\n\n                    return new ImageGenerationResponse\n                    {\n                        TaskId = task.Id,\n                        Status = \"å¤±è´¥\",\n                        Message = result.ErrorMessage ?? \"å›¾ç‰‡ç”Ÿæˆå¤±è´¥\",\n                        IsAsync = false\n                    };\n                }\n            }\n            catch (Exception ex)\n            {\n                _logger.LogError(ex, \"åŒæ­¥ç”Ÿæˆå›¾ç‰‡æ—¶å‡ºé”™ï¼Œä»»åŠ¡ {TaskId}\", task.Id);\n                \n                task.Status = ImageTaskStatus.Failed;\n                task.ErrorMessage = ex.Message;\n                task.UpdatedAt = DateTime.UtcNow;\n                await _dbContext.SaveChangesAsync(cancellationToken);\n\n                return new ImageGenerationResponse\n                {\n                    TaskId = task.Id,\n                    Status = \"å¤±è´¥\",\n                    Message = ex.Message,\n                    IsAsync = false\n                };\n            }\n        }\n    }\n\n    /// &lt;summary&gt;\n    /// è·å–å›¾ç‰‡ç”Ÿæˆä»»åŠ¡çš„çŠ¶æ€\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"taskId\"&gt;è¦æŸ¥è¯¢çš„ä»»åŠ¡ ID&lt;/param&gt;\n    /// &lt;returns&gt;ä»»åŠ¡çŠ¶æ€å’Œç»“æœï¼ˆå¦‚æœå·²å®Œæˆï¼‰&lt;/returns&gt;\n    [McpServerTool(Name = \"get_image_task_status\")]\n    [Description(\"è·å–å›¾ç‰‡ç”Ÿæˆä»»åŠ¡çš„çŠ¶æ€\")]\n    public async Task&lt;ImageGenerationResponse&gt; GetImageTaskStatus(\n        [Description(\"è¦æŸ¥è¯¢çš„ä»»åŠ¡ ID\")] string taskId,\n        CancellationToken cancellationToken = default)\n    {\n        if (!Guid.TryParse(taskId, out var id))\n        {\n            return new ImageGenerationResponse\n            {\n                Status = \"é”™è¯¯\",\n                Message = \"ä»»åŠ¡ ID æ ¼å¼æ— æ•ˆ\"\n            };\n        }\n\n        var task = await _dbContext.ImageGenerationTasks.FindAsync(new object[] { id }, cancellationToken);\n        \n        if (task == null)\n        {\n            return new ImageGenerationResponse\n            {\n                Status = \"é”™è¯¯\",\n                Message = \"æœªæ‰¾åˆ°ä»»åŠ¡\"\n            };\n        }\n\n        return new ImageGenerationResponse\n        {\n            TaskId = task.Id,\n            Status = task.Status.ToString().ToLowerInvariant(),\n            Message = task.ErrorMessage ?? GetStatusMessage(task.Status),\n            ImageBase64 = task.ImageData,\n            ImageUrl = task.ImageUrl,\n            IsAsync = !string.IsNullOrEmpty(task.HangfireJobId)\n        };\n    }\n\n    private static string GetStatusMessage(ImageTaskStatus status)\n    {\n        return status switch\n        {\n            ImageTaskStatus.Pending =&gt; \"ä»»åŠ¡ç­‰å¾…ä¸­\",\n            ImageTaskStatus.Processing =&gt; \"ä»»åŠ¡å¤„ç†ä¸­\",\n            ImageTaskStatus.Completed =&gt; \"å›¾ç‰‡ç”ŸæˆæˆåŠŸ\",\n            ImageTaskStatus.Failed =&gt; \"å›¾ç‰‡ç”Ÿæˆå¤±è´¥\",\n            ImageTaskStatus.Cancelled =&gt; \"ä»»åŠ¡å·²å–æ¶ˆ\",\n            _ =&gt; \"æœªçŸ¥çŠ¶æ€\"\n        };\n    }\n}\n\n/// &lt;summary&gt;\n/// å›¾ç‰‡ç”Ÿæˆå“åº”æ¨¡å‹\n/// &lt;/summary&gt;\npublic class ImageGenerationResponse\n{\n    public Guid? TaskId { get; set; }\n    public required string Status { get; set; }\n    public string? Message { get; set; }\n    public string? ImageBase64 { get; set; }\n    public string? ImageUrl { get; set; }\n    public string? RevisedPrompt { get; set; }\n    public bool IsAsync { get; set; }\n}\n\n</code></pre>\n<p><strong>å®é™…é¡¹ç›®ç‰¹ç‚¹</strong>ï¼š</p>\n<ol>\n<li>\n<p><strong>åŒæ¨¡å¼æ”¯æŒ</strong>ï¼š</p>\n<ul>\n<li>åŒæ­¥æ¨¡å¼ï¼šç«‹å³ç”Ÿæˆå¹¶è¿”å›ç»“æœ</li>\n<li>å¼‚æ­¥æ¨¡å¼ï¼šä½¿ç”¨Hangfireåå°ä»»åŠ¡ï¼Œå®Œæˆåé€šè¿‡é‚®ä»¶é€šçŸ¥</li>\n</ul>\n</li>\n<li>\n<p><strong>å¤šæ¸ é“æ¨é€</strong>ï¼š</p>\n<ul>\n<li>é€šè¿‡SignalRæ¨é€åˆ°è®¾å¤‡ï¼ˆCustomMessageï¼‰</li>\n<li>é€šè¿‡é‚®ä»¶å‘é€é“¾æ¥</li>\n</ul>\n</li>\n<li>\n<p><strong>å›¾ç‰‡å­˜å‚¨</strong>ï¼š</p>\n<ul>\n<li>åŒæ—¶ä¿å­˜PNGå’ŒJPEGä¸¤ç§æ ¼å¼</li>\n<li>å­˜å‚¨åˆ°Azure Blob Storageæˆ–æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</li>\n</ul>\n</li>\n<li>\n<p><strong>å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•</strong></p>\n</li>\n</ol>\n<p><strong>è·å–å®Œæ•´ä»£ç </strong>ï¼š</p>\n<ul>\n<li>\n<p>ğŸ”§ ESP32è®¾å¤‡ç«¯ (å°æ™ºå®Œæ•´å®ç°):<br />\n<a href=\"https://github.com/maker-community/xiaozhi-esp32\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/maker-community/xiaozhi-esp32</a></p>\n<ul>\n<li>SignalRé›†æˆåˆ†æ”¯ï¼š<code>signalr</code> å’Œ <code>signalr-update-audio</code></li>\n</ul>\n</li>\n<li>\n<p>ğŸ”§ ESP32ç¤ºä¾‹å·¥ç¨‹ (åŒ…å«å®Œæ•´çš„SignalRé›†æˆç¤ºä¾‹):<br />\n<a href=\"https://github.com/maker-community/esp-signalr-example\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/maker-community/esp-signalr-example</a></p>\n</li>\n<li>\n<p>ğŸ”§ SignalR C++å®¢æˆ·ç«¯åº“:<br />\n<a href=\"https://github.com/maker-community/esp-signalr\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/maker-community/esp-signalr</a><br />\n<a href=\"https://github.com/maker-community/esp-signalr-example\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/maker-community/esp-signalr-example</a></p>\n</li>\n<li>\n<p>ğŸŒ MCPæœåŠ¡å™¨ç«¯:<br />\n<a href=\"https://github.com/maker-community/verdure-mcp\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/maker-community/verdure-mcp</a></p>\n</li>\n</ul>\n<h2 id=\"å®é™…ä½¿ç”¨åœºæ™¯ç¤ºä¾‹\">å®é™…ä½¿ç”¨åœºæ™¯ç¤ºä¾‹</h2>\n<h3 id=\"åœºæ™¯1aiç”Ÿå›¾åæ¨é€åˆ°è®¾å¤‡\">åœºæ™¯1ï¼šAIç”Ÿå›¾åæ¨é€åˆ°è®¾å¤‡</h3>\n<p>ç”¨æˆ·é€šè¿‡å°æ™ºå¯¹è¯ï¼š\"å¸®æˆ‘ç”Ÿæˆä¸€å¼ çŒ«å’ªçš„å›¾ç‰‡\"</p>\n<ol>\n<li>å¯¹è¯å‘é€åˆ°.NET MCPæœåŠ¡</li>\n<li>MCPæœåŠ¡è°ƒç”¨APIç”Ÿæˆå›¾ç‰‡</li>\n<li>ç”Ÿæˆå®Œæˆåï¼Œåå°ä»»åŠ¡è°ƒç”¨hubå‘é€æ¶ˆæ¯</li>\n<li>æœåŠ¡ç«¯é€šè¿‡SignalRæ¨é€å›¾ç‰‡ç»™è¯¥ç”¨æˆ·çš„æ‰€æœ‰è®¾å¤‡</li>\n<li>ESP32è®¾å¤‡æ¥æ”¶åˆ°<code>è‡ªå®šä¹‰æ¶ˆæ¯</code>äº‹ä»¶ï¼Œä¸‹è½½å¹¶æ˜¾ç¤ºåœ¨å±å¹•ä¸Š</li>\n</ol>\n<h3 id=\"åœºæ™¯2æ’­æ”¾éŸ³ä¹\">åœºæ™¯2ï¼šæ’­æ”¾éŸ³ä¹</h3>\n<p>ç”¨æˆ·é€šè¿‡è¯­éŸ³è¯´æƒ³è¦æ’­æ”¾éŸ³ä¹ï¼Œmcpè¢«è§¦å‘ï¼Œéšæœºé€‰æ‹©éŸ³ä¹urlæ¨é€åˆ°è®¾å¤‡</p>\n<ol>\n<li>å¯¹è¯å‘é€åˆ°.NET MCPæœåŠ¡</li>\n<li>æœåŠ¡ç«¯é€šè¿‡SignalRæ¨é€éŸ³ä¹ç»™è¯¥ç”¨æˆ·çš„æ‰€æœ‰è®¾å¤‡</li>\n<li>ESP32è®¾å¤‡æ¥æ”¶åˆ°<code>è‡ªå®šä¹‰æ¶ˆæ¯</code>äº‹ä»¶ï¼Œä¸‹è½½å¹¶æ’­æ”¾è¯­éŸ³</li>\n</ol>\n<h2 id=\"å†…å­˜ä¼˜åŒ–ç»éªŒåˆ†äº«\">å†…å­˜ä¼˜åŒ–ç»éªŒåˆ†äº«</h2>\n<blockquote>\n<p><strong>è¯´æ˜</strong>ï¼šæœ¬ç« èŠ‚å†…å®¹å¯¹äºåœ¨ESP32ä¸Šè¿è¡ŒSignalRå®¢æˆ·ç«¯éå¸¸é‡è¦ï¼Œè¿™äº›éƒ½æ˜¯å®è·µä¸­æ€»ç»“å‡ºçš„ç»éªŒã€‚</p>\n</blockquote>\n<p>åœ¨ESP32ä¸Šé›†æˆSignalRç¡®å®é‡åˆ°äº†å†…å­˜é—®é¢˜ï¼Œåˆ†äº«ä¸€äº›ä¼˜åŒ–ç»éªŒï¼š</p>\n<h3 id=\"1-ä½¿ç”¨psramå­˜å‚¨å¤§å¯¹è±¡\">1. ä½¿ç”¨PSRAMå­˜å‚¨å¤§å¯¹è±¡</h3>\n<pre><code class=\"language-cpp\">// ä¸ºå›¾ç‰‡æ•°æ®åˆ†é…PSRAMå†…å­˜\nvoid* imageBuffer = heap_caps_malloc(imageSize, MALLOC_CAP_SPIRAM);\nif (imageBuffer == NULL) {\n    // é™çº§åˆ°å†…éƒ¨RAM\n    imageBuffer = malloc(imageSize);\n}\n</code></pre>\n<p>åœ¨VS Codeçš„menuconfigä¸­å¯ç”¨PSRAMï¼š</p>\n<ul>\n<li><code>F1</code> â†’ <code>ESP-IDF: SDK Configuration editor</code></li>\n<li><code>Component config</code> â†’ <code>ESP32-specific</code> â†’ <code>Support for external, SPI-connected RAM</code></li>\n</ul>\n<h3 id=\"2-å‡å°‘jsonåºåˆ—åŒ–æ¬¡æ•°\">2. å‡å°‘JSONåºåˆ—åŒ–æ¬¡æ•°</h3>\n<pre><code class=\"language-cpp\">// é”™è¯¯åšæ³•ï¼šé¢‘ç¹åˆ›å»º/é”€æ¯cJSONå¯¹è±¡\nfor (int i = 0; i &lt; 100; i++) {\n    cJSON* root = cJSON_Parse(jsonString);\n    // å¤„ç†...\n    cJSON_Delete(root);  // äº§ç”Ÿå†…å­˜ç¢ç‰‡\n}\n\n// æ­£ç¡®åšæ³•ï¼šå¤ç”¨å¯¹è±¡\ncJSON* root = cJSON_Parse(jsonString);\nfor (int i = 0; i &lt; 100; i++) {\n    // å¤„ç†...\n}\ncJSON_Delete(root);\n</code></pre>\n<h3 id=\"3-å¢åŠ ä»»åŠ¡æ ˆå¤§å°\">3. å¢åŠ ä»»åŠ¡æ ˆå¤§å°</h3>\n<p>SignalRçš„å›è°ƒåµŒå¥—è¾ƒæ·±ï¼Œéœ€è¦å¢åŠ æ ˆï¼š</p>\n<p>åœ¨menuconfigä¸­ï¼š<code>Component config</code> â†’ <code>ESP32-specific</code> â†’ <code>Main task stack size</code> â†’ è®¾ç½®ä¸º<code>8192</code></p>\n<p>æˆ–åœ¨ä»£ç ä¸­ï¼š</p>\n<pre><code class=\"language-cpp\">xTaskCreatePinnedToCore(\n    signalr_task,\n    \"signalr\",\n    8192,  // æ ˆå¤§å°ï¼ˆå­—èŠ‚ï¼‰\n    NULL,\n    5,     // ä¼˜å…ˆçº§\n    NULL,\n    1      // CPUæ ¸å¿ƒ\n);\n</code></pre>\n<h2 id=\"æ€»ç»“ä¸æ„Ÿæ‚Ÿ\">æ€»ç»“ä¸æ„Ÿæ‚Ÿ</h2>\n<p>é€šè¿‡è¿™æ¬¡SignalRç§»æ¤å’Œé›†æˆçš„å®è·µï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°ï¼š</p>\n<ol>\n<li>\n<p><strong>é€‰å¯¹æ¡†æ¶å¾ˆé‡è¦</strong>ï¼šSignalRçš„ç¾¤ç»„ç®¡ç†ã€æ¶ˆæ¯è·¯ç”±ç­‰ç‰¹æ€§ï¼Œçœå»äº†å¤§é‡åŸºç¡€è®¾æ–½ä»£ç ã€‚å¦‚æœä»å¤´æ‰‹å†™WebSocketï¼Œè¿™äº›åŠŸèƒ½å¾—èŠ±å‡ å‘¨æ—¶é—´ã€‚</p>\n</li>\n<li>\n<p><strong>å†…å­˜ç®¡ç†æ˜¯åµŒå…¥å¼æ°¸æ’çš„ä¸»é¢˜</strong>ï¼šESP32çš„RAMé™åˆ¶è®©æˆ‘å¯¹æ¯ä¸€ä¸ªmallocéƒ½æ ¼å¤–å°å¿ƒã€‚åˆç†ä½¿ç”¨PSRAMã€é¿å…å†…å­˜ç¢ç‰‡ã€åŠæ—¶é‡Šæ”¾èµ„æºï¼Œè¿™äº›åœ¨PCä¸Šä¸ç”¨careçš„é—®é¢˜ï¼Œåœ¨åµŒå…¥å¼ä¸Šéƒ½æ˜¯å‘ã€‚</p>\n</li>\n<li>\n<p><strong>AIè¾…åŠ©ç¼–ç¨‹çœŸé¦™</strong>ï¼šè¿™æ¬¡é¡¹ç›®ä¸­ï¼ŒSignalR C++å®¢æˆ·ç«¯çš„ç§»æ¤ã€æ¶ˆæ¯å¤„ç†ç­‰å¤§é‡ä»£ç éƒ½æ˜¯å€ŸåŠ©AIç”Ÿæˆçš„ã€‚è™½ç„¶ç”Ÿæˆçš„ä»£ç éœ€è¦è°ƒè¯•å’Œä¼˜åŒ–ï¼Œä½†ç¡®å®å¤§å¹…æé«˜äº†å¼€å‘æ•ˆç‡ã€‚</p>\n</li>\n<li>\n<p><strong>æ¶ˆæ¯æ¨é€è§£å†³å®é™…é—®é¢˜</strong>ï¼šä¹‹å‰MCPå·¥å…·åªèƒ½åŒæ­¥è¿”å›ç»“æœï¼Œç°åœ¨é€šè¿‡SignalRï¼ŒæœåŠ¡ç«¯å¯ä»¥ä¸»åŠ¨æ¨é€å›¾ç‰‡ã€è¯­éŸ³ã€é€šçŸ¥ç»™è®¾å¤‡ï¼Œç”¨æˆ·ä½“éªŒæå‡æ˜æ˜¾ã€‚</p>\n</li>\n<li>\n<p><strong>.NETç”Ÿæ€çš„å¼ºå¤§</strong>ï¼šSignalRã€EF Coreã€JWTè®¤è¯â€¦â€¦å¾®è½¯è¿™å¥—ç”Ÿæ€çœŸçš„å¾ˆå®Œå–„ã€‚ä½œä¸º.NETå¼€å‘è€…ï¼Œèƒ½ç”¨ç†Ÿæ‚‰çš„æŠ€æœ¯æ ˆå¿«é€Ÿæ­å»ºç”Ÿäº§çº§æœåŠ¡ã€‚</p>\n</li>\n</ol>\n<p>è¿™ä¸ªé¡¹ç›®è¿˜æœ‰å¾ˆå¤šä¼˜åŒ–ç©ºé—´ï¼Œæ¯”å¦‚ï¼š</p>\n<ul>\n<li>WebSocket Binary Protocolæ›¿ä»£JSONå‡å°‘å¸¦å®½</li>\n<li>å¼•å…¥Rediså­˜å‚¨ç¾¤ç»„ä¿¡æ¯ï¼Œæ”¯æŒæœåŠ¡ç«¯æ¨ªå‘æ‰©å±•</li>\n<li>ç»§ç»­å®Œå–„ä»£ç è´¨é‡ï¼Œè®©åº“èƒ½å¤Ÿè¢«æ›´å¤šçš„äººå…³æ³¨å’Œå‚ä¸ï¼Œå¸Œæœ›æœ‰æ›´å¤šçš„äººæ¥å®é™…ä½¿ç”¨å’Œä¼˜åŒ–ã€‚</li>\n</ul>\n<p>ä½†ä½œä¸ºä¸€ä¸ªåˆæ­¥èƒ½ç”¨çš„æ–¹æ¡ˆï¼Œå·²ç»è¶³å¤Ÿæ”¯æ’‘å°æ™ºæœºå™¨äººçš„åŠŸèƒ½æ‰©å±•äº†ã€‚åç»­æˆ‘ä¼šç»§ç»­å®Œå–„è¿™å¥—æ¶æ„ï¼Œæ¬¢è¿å¤§å®¶ä¸€èµ·æ¢è®¨å’Œè´¡çŒ®ä»£ç ï¼</p>\n<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½ç»™å¤§å®¶åœ¨.NET IoTå¼€å‘ã€SignalRå®æ—¶é€šä¿¡æ–¹é¢å¸¦æ¥ä¸€äº›å¯å‘ã€‚å¦‚æœæœ‰é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢.NETåœ¨IoTé¢†åŸŸçš„æ›´å¤šå¯èƒ½æ€§ï¼</p>\n<h2 id=\"æ‰‹æ“esp32å°æœºå™¨äºº\">æ‰‹æ“ESP32å°æœºå™¨äºº</h2>\n<p>å¦‚æœä½ æœ‰æ‰‹æ“Esp32çš„ç¡¬ä»¶æ‰“ç®—ï¼Œå¯ä»¥å…³æ³¨æˆ‘çš„Bç«™è´¦å·ï¼ˆç»¿è«é˜¿å¹¿ï¼‰<br />\n<a href=\"https://space.bilibili.com/25228512\" rel=\"noopener nofollow\" target=\"_blank\">https://space.bilibili.com/25228512</a></p>\n<p><img alt=\"img\" src=\"https://img2024.cnblogs.com/blog/1690009/202602/1690009-20260201141614219-406532144.png\" /></p>\n<h2 id=\"é¡¹ç›®åœ°å€\">é¡¹ç›®åœ°å€</h2>\n<h3 id=\"esp32ç›¸å…³-1\">ESP32ç›¸å…³</h3>\n<ul>\n<li>\n<p><strong>SignalR C++å®¢æˆ·ç«¯åº“</strong>ï¼š<br />\n<a href=\"https://github.com/maker-community/esp-signalr\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/maker-community/esp-signalr</a></p>\n</li>\n<li>\n<p><strong>å°æ™ºESP32å®Œæ•´å®ç°</strong> (signalr-update-audioåˆ†æ”¯):<br />\n<a href=\"https://github.com/maker-community/xiaozhi-esp32\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/maker-community/xiaozhi-esp32</a></p>\n</li>\n<li>\n<p><strong>ESP32 SignalRå®Œæ•´ç¤ºä¾‹å·¥ç¨‹</strong> (åŒ…å«éŸ³é¢‘åˆ†å—ã€è®¾å¤‡æ§åˆ¶APIç­‰):<br />\n<a href=\"https://github.com/maker-community/esp-signalr-example\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/maker-community/esp-signalr-example</a></p>\n<ul>\n<li><a href=\"https://github.com/maker-community/esp-signalr-example/tree/main/signalr-server\" rel=\"noopener nofollow\" target=\"_blank\">æœåŠ¡ç«¯ä»£ç </a></li>\n<li><a href=\"https://github.com/maker-community/esp-signalr-example/tree/main/main\" rel=\"noopener nofollow\" target=\"_blank\">å®¢æˆ·ç«¯ä»£ç </a></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"netæœåŠ¡ç«¯\">.NETæœåŠ¡ç«¯</h3>\n<ul>\n<li><strong>Verdure MCPæœåŠ¡</strong> (åŒ…å«å®Œæ•´çš„Hubã€Toolsã€Serviceså®ç°):<br />\n<a href=\"https://github.com/maker-community/verdure-mcp\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/maker-community/verdure-mcp</a></li>\n<li><strong>å°æ™ºmcpè½¬æ¥å¹³å°</strong>ï¼š</li>\n<li><a href=\"https://github.com/maker-community/verdure-mcp-for-xiaozhi\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/maker-community/verdure-mcp-for-xiaozhi</a></li>\n</ul>\n<h3 id=\"å‚è€ƒèµ„æ–™\">å‚è€ƒèµ„æ–™</h3>\n<ul>\n<li><strong>SignalR Client C++ (å¾®è½¯å®˜æ–¹)</strong>:<br />\n<a href=\"https://github.com/aspnet/SignalR-Client-Cpp\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/aspnet/SignalR-Client-Cpp</a></li>\n<li><strong>SignalR Client C# nanoframework</strong>:<br />\n<a href=\"https://github.com/nanoframework/nanoFramework.SignalR.Client\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/nanoframework/nanoFramework.SignalR.Client</a></li>\n</ul>\n<h2 id=\"å‚è€ƒæ–‡æ¡£\">å‚è€ƒæ–‡æ¡£</h2>\n<ol>\n<li><a href=\"https://docs.microsoft.com/zh-cn/aspnet/core/signalr/\" rel=\"noopener nofollow\" target=\"_blank\">ASP.NET Core SignalR å®˜æ–¹æ–‡æ¡£</a></li>\n<li><a href=\"https://github.com/dotnet/aspnetcore/blob/main/src/SignalR/docs/specs/HubProtocol.md\" rel=\"noopener nofollow\" target=\"_blank\">SignalR Hub åè®®è§„èŒƒ</a></li>\n<li><a href=\"https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/\" rel=\"noopener nofollow\" target=\"_blank\">ESP-IDF ç¼–ç¨‹æŒ‡å—</a></li>\n<li><a href=\"https://github.com/espressif/vscode-esp-idf-extension\" rel=\"noopener nofollow\" target=\"_blank\">VS Code ESP-IDF æ’ä»¶</a></li>\n<li><a href=\"https://jwt.io/introduction\" rel=\"noopener nofollow\" target=\"_blank\">JWT è®¤è¯æœ€ä½³å®è·µ</a></li>\n<li><a href=\"https://www.keycloak.org/docs/latest/securing_apps/\" rel=\"noopener nofollow\" target=\"_blank\">Keycloak è®¤è¯é›†æˆæŒ‡å—</a></li>\n</ol>\n<hr />\n<p><em>æœ¬æ–‡é¦–å‘äºä¸ªäººæŠ€æœ¯åšå®¢ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚å¦‚æœå¯¹.NET IoTå¼€å‘ã€SignalRå®æ—¶é€šä¿¡æ„Ÿå…´è¶£ï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„åšå®¢è·å–æ›´å¤šæŠ€æœ¯åˆ†äº«ï¼</em></p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-01 15:33</span>&nbsp;\n<a href=\"https://www.cnblogs.com/GreenShade\">ç»¿è«é˜¿å¹¿</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">81</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "LLVM Passå¿«é€Ÿå…¥é—¨(ä¸€)ï¼šæ„å»ºç¼–è¯‘ç¯å¢ƒ",
      "link": "https://www.cnblogs.com/ClownLMe/p/19560726",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/ClownLMe/p/19560726\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-01 14:36\">\n    <span>LLVM Passå¿«é€Ÿå…¥é—¨(ä¸€)ï¼šæ„å»ºç¼–è¯‘ç¯å¢ƒ</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"ç®€ä»‹\">ç®€ä»‹</h1>\n<p><strong>LLVM</strong> æ˜¯ä¸€ä¸ªç¼–è¯‘æ¡†æ¶å·¥å…·ï¼Œæ˜¯æŠŠç¼–è¯‘è¿‡ç¨‹æ‹†è§£æˆäº†é«˜åº¦æ ‡å‡†åŒ–çš„ç»„ä»¶ã€‚</p>\n<p><strong>æœ¬æ•™ç¨‹æ‰€ä½¿ç”¨çš„ç¯å¢ƒæ˜¯windows11, vs2022</strong></p>\n<h1 id=\"è®¤è¯†llvm\">è®¤è¯†LLVM</h1>\n<p>LLVM æœ€æˆåŠŸçš„åœ°æ–¹åœ¨äºå®ƒå®šä¹‰äº†ä¸€ç§æå…¶å®Œç¾çš„ä¸­é—´è¯­è¨€<strong>LLVM IR</strong>ï¼ŒLLVMåˆ†ä¸ºå‰ç«¯ï¼Œä¼˜åŒ–å™¨ï¼Œåç«¯ï¼š</p>\n<ul>\n<li><strong>å‰ç«¯</strong>ï¼šè´Ÿè´£æŠŠæºä»£ç ï¼ˆC/C++ã€Rustã€Goï¼‰ç¿»è¯‘æˆ LLVM IRã€‚æ¯”å¦‚ <code>Clang</code>ã€‚</li>\n<li><strong>ä¼˜åŒ–å™¨</strong>ï¼šè¿™æ˜¯ LLVM çš„çµé­‚ã€‚å®ƒåªå¤„ç† IRï¼Œä¸å…³å¿ƒæºç æ˜¯ä»€ä¹ˆè¯­è¨€ï¼Œä¹Ÿä¸å…³å¿ƒç›®æ ‡æ˜¯ä»€ä¹ˆæœºå™¨ã€‚ä½ å†™çš„ <strong>Pass</strong> å°±è¿è¡Œåœ¨è¿™é‡Œã€‚</li>\n<li><strong>åç«¯</strong>ï¼šè´Ÿè´£æŠŠä¼˜åŒ–åçš„ IR ç¿»è¯‘æˆå…·ä½“çš„æœºå™¨ç ï¼ˆx86ã€ARMã€RISC-Vï¼‰ã€‚æ¯”å¦‚ <code>LLC</code>ã€‚</li>\n</ul>\n<p>LLVMçš„ä¸‰ç«¯æ¶æ„ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾ˆæ–¹ä¾¿çš„è‡ªå®šä¹‰ç¼–è¯‘å™¨ï¼Œ<strong>æœ¬ç³»ç±»æ•™ç¨‹ä¸»è¦æ•™å­¦ä¼˜åŒ–å™¨çš„passç¼–å†™</strong></p>\n<h1 id=\"ç¯å¢ƒé…ç½®\">ç¯å¢ƒé…ç½®</h1>\n<h3 id=\"éœ€è¦å‡†å¤‡çš„å·¥å…·\">éœ€è¦å‡†å¤‡çš„å·¥å…·</h3>\n<ol>\n<li><strong>git</strong> : <a href=\"https://git-scm.com/install/\" rel=\"noopener nofollow\" target=\"_blank\">https://git-scm.com/install/</a> æ‹‰å–é¡¹ç›®</li>\n<li><strong>visual studio</strong> : <a href=\"https://visualstudio.microsoft.com/zh-hans/\" rel=\"noopener nofollow\" target=\"_blank\">https://visualstudio.microsoft.com/zh-hans/</a> éœ€è¦å®‰è£…<code>c/c++æ¡Œé¢å¼€å‘</code>ç»„ä»¶ï¼Œç¼–è¯‘ç¯å¢ƒ</li>\n<li><strong>cmake</strong>ï¼š <a href=\"https://cmake.org/\" rel=\"noopener nofollow\" target=\"_blank\">https://cmake.org/</a> æ„å»ºé¡¹ç›®</li>\n<li><strong>ninja</strong> : <a href=\"https://github.com/ninja-build/ninja\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/ninja-build/ninja</a> åŠ é€Ÿç¼–è¯‘</li>\n</ol>\n<h3 id=\"æ‹‰å–llvmå¹¶é…ç½®\">æ‹‰å–LLVMå¹¶é…ç½®</h3>\n<p>è¿™é‡Œæˆ‘ä¿å­˜åœ¨Dç›˜</p>\n<pre><code class=\"language-bash\">#åˆ›å»ºæ–‡ä»¶å¤¹\nmkdir D:\\LLVM \ncd D:\\LLVM \n#æ‹‰å–æºç  (åªæ‹‰å–æ ¸å¿ƒä»“åº“ï¼Œä¸éœ€è¦ submoduleï¼Œç°åœ¨ LLVM æ˜¯ monorepo) \n#è¿™ä¸€æ­¥æ¯”è¾ƒå¤§ï¼Œç½‘ç»œä¸å¥½è¯·æŒ‚æ¢¯å­ \ngit clone --depth=1 https://github.com/llvm/llvm-project.git\n#åˆ›å»ºæ„å»ºç›®å½•\ncd llvm-project \nmkdir build \ncd build\n</code></pre>\n<h3 id=\"æ„å»ºå¹¶ç¼–è¯‘\">æ„å»ºå¹¶ç¼–è¯‘</h3>\n<p><strong>è¿™é‡Œéœ€è¦æ‰“å¼€åˆšåˆšä¸‹è½½å¥½<code>visual studio</code>çš„å·¥ä½œå°ï¼Œæˆ‘è¿™é‡Œæ˜¯<code>x64 Native Tools Command Prompt for VS 2022</code></strong><br />\n<strong>æ³¨æ„ï¼šå¼€å§‹ç¼–è¯‘éœ€è¦é¢„ç•™30-60Gç¡¬ç›˜ç©ºé—´ï¼Œç¼–è¯‘éœ€è¦30åˆ†é’Ÿå·¦å³</strong></p>\n<pre><code class=\"language-bash\">#åˆ©ç”¨cmakeæ„å»ºé¡¹ç›®\ncmake -G \"Ninja\" ^ #ä½¿ç”¨ninjaç¼–è¯‘\n-DLLVM_ENABLE_PROJECTS=\"clang\" ^ #åªç¼–è¯‘clangèŠ‚çœç©ºé—´\n-DLLVM_TARGETS_TO_BUILD=\"X86\" ^ #åªç¼–è¯‘x86åç«¯ï¼Œè¿™èŠ‚çœå¤§éƒ¨åˆ†ç¼–è¯‘æ—¶é—´ï¼Œé™¤éè¦æarmæˆ–è€…å®‰å“\n-DCMAKE_BUILD_TYPE=\"RelWithDebInfo\" ^ #Relaseç‰ˆæœ¬æ— æ³•è°ƒè¯•ï¼Œdebugç‰ˆæœ¬å¤ªå¤§å¤ªæ…¢äº†ï¼Œè¿™é‡Œé€‰æ‹©å¸¦è°ƒè¯•ç¬¦å·çš„relaseç‰ˆæœ¬\n-DLLVM_OPTIMIZED_TABLEGEN=ON ^ \n-DLLVM_ENABLE_ASSERTIONS=ON ^ #å¼€å¯ä»£ç æ–­è¨€ã€‚å½“passå†™é”™æ—¶ï¼Œä¼šæŠ¥é”™è€Œä¸æ˜¯ç›´æ¥å´©æºƒ\n../llvm\n#ç¼–è¯‘\nninja\n</code></pre>\n<h3 id=\"æ·»åŠ ç¯å¢ƒå˜é‡\">æ·»åŠ ç¯å¢ƒå˜é‡</h3>\n<p>è¿™ä¸€æ­¥æ–¹ä¾¿ä¹‹åçš„ä½¿ç”¨</p>\n<pre><code class=\"language-bash\">#å°†åˆšåˆšç¼–è¯‘å¥½çš„ç¯å¢ƒåŠ å…¥ç¯å¢ƒå˜é‡\nD:\\LLVM\\llvm-project\\build\\bin\n</code></pre>\n<h3 id=\"ç®€å•éªŒè¯ç¯å¢ƒ\">ç®€å•éªŒè¯ç¯å¢ƒ</h3>\n<pre><code class=\"language-bash\">clang --version\nopt --version\n</code></pre>\n<p>ä¸€èˆ¬æ¥è¯´ï¼Œè·Ÿç€ä¸Šé¢æ­¥éª¤èµ° å¹¶ä¸” ç³»ç»Ÿå’Œvsç‰ˆæœ¬ä¸€æ ·åˆ°è¿™æ˜¯ä¸ä¼šæŠ¥é”™çš„ã€‚</p>\n<h1 id=\"éªŒè¯ç¯å¢ƒ\">éªŒè¯ç¯å¢ƒ</h1>\n<p>ä¸‹é¢ç¼–è¯‘ä¸€ä¸ª<code>test.c</code>æ¥éªŒè¯ç¯å¢ƒæ˜¯å¦æ­£å¸¸ã€‚</p>\n<pre><code class=\"language-c\">#include &lt;stdio.h&gt;\n\nint add(int a, int b) {\n&nbsp; &nbsp; return a + b + 5;\n}\n\nint main(){\n&nbsp; &nbsp; printf(\"add(1, 2) = %d\\n\", add(1, 2));\n&nbsp; &nbsp; return 0;\n}\n</code></pre>\n<h3 id=\"ç¼–è¯‘ä»£ç \">ç¼–è¯‘ä»£ç </h3>\n<h5 id=\"c-ç¼–è¯‘ä¸ºllvm-ir\">C ç¼–è¯‘ä¸ºLLVM IR</h5>\n<pre><code class=\"language-bash\">clang -S -emit-llvm -O0 test.c -o test.ll\n</code></pre>\n<p>è§‚å¯ŸIRï¼š</p>\n<pre><code class=\"language-c\">......\ndefine dso_local i32 @main() #0 {\nentry:\n&nbsp; %retval = alloca i32, align 4\n&nbsp; store i32 0, ptr %retval, align 4\n&nbsp; %call = call i32 @add(i32 noundef 1, i32 noundef 2)\n&nbsp; %call1 = call i32 (ptr, ...) @printf(ptr noundef @\"??_C@_0BA@OMPDDIF@add?$CI1?0?52?$CJ?5?$DN?5?$CFd?6?$AA@\", i32 noundef %call)\n&nbsp; ret i32 0\n}\n......\n</code></pre>\n<h5 id=\"llvm-ir-ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶\">LLVM IR ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶</h5>\n<p>ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶å¹¶æ­£å¸¸è¿è¡Œ</p>\n<pre><code class=\"language-bash\">clang test.c -o test.exe\n</code></pre>\n<p><strong>å¦‚æœâ¤å–œæ¬¢â¤æœ¬ç³»åˆ—æ•™ç¨‹ï¼Œå°±ç‚¹ä¸ªå…³æ³¨å§ï¼Œåç»­ä¸å®šæœŸæ›´æ–°~</strong></p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-01 14:36</span>&nbsp;\n<a href=\"https://www.cnblogs.com/ClownLMe\">ClownLMe</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">35</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "nginx locationæ²¡å­¦å¥½ï¼ŒæŠŠè‡ªå·±å‘äº†ä¸€æŠŠ",
      "link": "https://www.cnblogs.com/grey-wolf/p/19560342",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/grey-wolf/p/19560342\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-01 11:28\">\n    <span>nginx locationæ²¡å­¦å¥½ï¼ŒæŠŠè‡ªå·±å‘äº†ä¸€æŠŠ</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"èƒŒæ™¯\">èƒŒæ™¯</h1>\n<p>å‰å‡ å¤©åœ¨éƒ¨ç½²ä¸€å¥—ç¯å¢ƒçš„æ—¶å€™ï¼Œæ¶‰åŠnginxè¿™å—ï¼Œå½“æ—¶ä»¥ä¸ºåˆ†åˆ†é’Ÿæå®šï¼Œæ²¡ç›¸å¯¹è¿˜è´¹äº†å¥½äº›åŠŸå¤«ï¼Œç”šè‡³ä»¥ä¸ºæ˜¯nginxçš„bugäº†ã€‚</p>\n<p>æˆ‘å…ˆä¸Šä¸ªå›¾ï¼š</p>\n<p>æˆ‘ä»¬æœ‰ä¸ªæ ¡ä¼åˆä½œçš„é¡¹ç›®ï¼Œç”±äºé¡¹ç›®çš„å‚ä¸æ–¹æ¶‰åŠå­¦æ ¡å­¦ç”Ÿï¼Œç½‘ç»œå› æ­¤æ˜¯å•ç‹¬åˆ’äº†ä¸€ä¸ªåŒºåŸŸï¼Œå°±ç›¸å½“äºä¸€ä¸ªç‹¬ç«‹ç½‘æ®µï¼Œé‡Œé¢æœ‰å­¦ç”ŸåŠå…¬pcã€linuxæœåŠ¡å™¨ç­‰ç­‰ã€‚æˆ‘ä»¬è¿™æ¬¡ç»„é‡Œå¼€å‘äº†ä¸€ä¸ªå°çš„å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œå¼€å‘å®Œäº†åï¼Œæˆ‘å°±å‡†å¤‡éƒ¨ç½²ã€‚</p>\n<p>éƒ¨ç½²çš„è¯ï¼Œæˆ‘æ˜¯é€šè¿‡ç±»ä¼¼äºwindowsè¿œç¨‹æ¡Œé¢çš„æœºåˆ¶ï¼ˆå®é™…æ˜¯æŸå‚å•†çš„VDIï¼Œç›¸æ¯”äºwindowsè¿œç¨‹æ¡Œé¢ï¼Œåº”è¯¥æ˜¯å¤šäº†æ›´å¤šæ–‡ä»¶è¿›å‡ºçš„ç®¡æ§æœºåˆ¶ï¼Œæ¯”å¦‚æ²¡æƒé™çš„è¯ï¼Œè¿œç¨‹ä¸»æœºé‡Œçš„æ–‡ä»¶é»˜è®¤æ˜¯æ‹·è´ä¸å‡ºæ¥çš„ï¼‰ã€‚</p>\n<p>é€šè¿‡è¿œç¨‹æ¡Œé¢è¿›å…¥è¿œç¨‹windowsåï¼Œåœ¨é‡Œé¢å†sshè¿æ¥linuxæœåŠ¡å™¨ï¼Œåœ¨ä¸Šé¢éƒ¨ç½²nginxã€å‰ç«¯åŒ…ï¼Œç”±äºæœåŠ¡å™¨æœ‰é™ï¼Œç›´æ¥æŠŠåç«¯spring bootåŒ…ä¹Ÿæ˜¯éƒ¨ç½²åœ¨äº†è¿™ä¸€å°æœºå™¨ä¸Šï¼Œæ¶æ„å¦‚ä¸‹ã€‚</p>\n<p><img alt=\"image-20260201104040556\" src=\"https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260201104040556.png\" /></p>\n<p>åˆšå¼€å§‹éƒ¨ç½²å®Œæˆåï¼Œåº”ç”¨æœåŠ¡å™¨ä¸Šï¼ˆå‡è®¾ipä¸º1.1.1.1ï¼‰çš„nginxï¼Œç›‘å¬80ç«¯å£ï¼Œé‚£ä¹ˆï¼Œåœ¨è¿œç¨‹windowsä¸Šçš„æµè§ˆå™¨ï¼Œæ˜¯å¯ä»¥è®¿é—®ï¼šhttp://1.1.1.1:80æ¥æ‰“å¼€ç³»ç»Ÿçš„ï¼Œä½†æ˜¯ï¼Œåœ¨æˆ‘çš„åŠå…¬pcä¸Šä¸è¡Œã€‚</p>\n<p>ç”±äºè¿™ç§ä¸€èˆ¬æ˜¯éœ€è¦ç»™é¢†å¯¼æ¼”ç¤ºçš„ï¼Œé‚£è‡ªç„¶è¦æŠŠ1.1.1.1:80ç«¯å£æš´éœ²å‡ºæ¥ï¼Œè®©åŠå…¬pcç½‘ç»œå¯ä»¥è®¿é—®ã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œè¿™ç§ä¸€èˆ¬åªå¼€æ”¾å¿…è¦çš„ç«¯å£ï¼Œå¦‚ä¸Šé¢å°±åªå¼€æ”¾80ç«¯å£ã€‚å°±åƒæˆ‘ä»¬å¹³æ—¶ç³»ç»Ÿå¯¹äº’è”ç½‘ä»…å¼€æ”¾443ç«¯å£ä¸€æ ·ã€‚</p>\n<h1 id=\"é—®é¢˜\">é—®é¢˜</h1>\n<p>ç”±äºç‰ˆæœ¬åˆšå¼€å§‹ä¸ç¨³å®šï¼Œè‡ªç„¶æ˜¯ä¼šå‘ç°ä¸€äº›bugï¼Œå‘ç°bugå°±éœ€è¦çœ‹æ—¥å¿—ï¼Œæˆ‘ä»¬è¿™è¾¹çœ‹æ—¥å¿—è¿˜æ˜¯æ¯”è¾ƒåŸå§‹çš„ï¼Œä¹Ÿæ²¡æä»€ä¹ˆelkè¿™ç±»ã€‚spring bootæœåŠ¡çš„æ—¥å¿—ï¼Œå°±åœ¨ä¸Šè¿°çš„1.1.1.1è¿™å°æœåŠ¡å™¨çš„ç‰¹å®šç›®å½•ä¸‹ï¼Œæˆ‘å°±æƒ³ç€ï¼Œé€šè¿‡80ç«¯å£ï¼Œnginxé‡Œé¢å†é…ä¸ªlocationï¼ŒæŠŠlogæš´éœ²å‡ºæ¥ï¼Œæ–¹ä¾¿ç»„å†…åŒäº‹çœ‹æ—¥å¿—ï¼Œåº”è¯¥æ›´æ–¹ä¾¿ä¸€äº›ã€‚</p>\n<p>åŸå§‹çš„nginxé…ç½®å¦‚ä¸‹ï¼Œå°±ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„é…ç½®ï¼š</p>\n<pre><code class=\"language-shell\">server {\n    listen 80;\n    server_name localhost;\n    location / {\n        root /usr/local/nginx/html/quantify-trade-platform-frontend/dist;\n        index index.html  index.htm;\n        try_files $uri $uri/ /index.html;\n    }\n    location ~ /quantify-trade-platform-admin {\n        proxy_pass http://localhost:8093;\n   }\n}\n</code></pre>\n<p>æˆ‘ä»¬javaæœåŠ¡å‘¢ï¼Œæ—¥å¿—æ˜¯åœ¨:</p>\n<p>/opt/quantify-trade-platform-admin/quantify-trade-platform-admin-0.1-SNAPSHOT/logs</p>\n<p><img alt=\"image-20260201105400498\" src=\"https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260201105400498.png\" /></p>\n<p>æ‰€ä»¥ï¼Œæˆ‘å°±åŠ äº†ä¸€æ®µé…ç½®ï¼š</p>\n<pre><code class=\"language-shell\">    location /mylog/ {\n      alias /opt/quantify-trade-platform-admin/quantify-trade-platform-admin-0.1-SNAPSHOT/logs/;\n      autoindex on;\n    }\n</code></pre>\n<p>å®Œæ•´å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-shell\">    server {\n        listen 80;\n        server_name localhost;\n        location / {\n            root /usr/local/nginx/html/quantify-trade-platform-frontend/dist;\n            index index.html  index.htm;\n            try_files $uri $uri/ /index.html;\n        }\n        location ~ /quantify-trade-platform-admin {\n            proxy_pass http://localhost:8093;\n        }\n\t\t-- æ–°å¢å¦‚ä¸‹:\n\t    location /mylog/ {\n\t      alias /opt/quantify-trade-platform-admin/quantify-trade-platform-admin-0.1-SNAPSHOT/logs/;\n          autoindex on;\n        }\n   }\n</code></pre>\n<p>åŠ å¥½åï¼Œæˆ‘è¯•äº†ä¸‹, <a href=\"http://1.1.1.1/mylog/%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%AD%A3%E5%B8%B8%E8%AE%BF%E9%97%AE%EF%BC%9A%EF%BC%88%E5%AE%9E%E9%99%85%E4%B8%8A%EF%BC%8C%E6%8A%98%E8%85%BE%E8%BF%99%E4%B8%AAautoindex%E8%BF%99%E4%B8%AAlocation%EF%BC%8C%E4%B9%9F%E8%8A%B1%E4%BA%86%E4%B8%8D%E5%B0%91%E6%97%B6%E9%97%B4%EF%BC%8C%E8%A6%81%E4%B8%8D%E8%A6%81%E5%8A%A0/%E4%B9%8B%E7%B1%BB%E7%9A%84%EF%BC%89\" rel=\"noopener nofollow\" target=\"_blank\">http://1.1.1.1/mylog/ï¼Œå¯ä»¥æ­£å¸¸è®¿é—®ï¼šï¼ˆå®é™…ä¸Šï¼ŒæŠ˜è…¾è¿™ä¸ªautoindexè¿™ä¸ªlocationï¼Œä¹ŸèŠ±äº†ä¸å°‘æ—¶é—´ï¼Œè¦ä¸è¦åŠ /ä¹‹ç±»çš„ï¼‰</a></p>\n<p><img alt=\"image-20260201105622188\" src=\"https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260201105622188.png\" /></p>\n<p>ä½†æ˜¯å‘¢ï¼Œæˆ‘åœ¨ç‚¹å‡»é‡Œé¢çš„æ–‡ä»¶çš„æ—¶å€™ï¼Œå‘ç°æŠ¥404ï¼š</p>\n<p><a href=\"http://1.1.1.1/mylog/quantify-trade-platform-admin.log\" rel=\"noopener nofollow\" target=\"_blank\">http://1.1.1.1/mylog/quantify-trade-platform-admin.log</a></p>\n<p><img alt=\"image-20260201105804252\" src=\"https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260201105804252.png\" /></p>\n<p>è¿™ä¸ªé—®é¢˜æŠŠæˆ‘æŠ˜è…¾çš„å¤Ÿå‘›ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºæ˜¯æˆ‘autoindexè¿™å—ï¼Œæ˜¯ä¸æ˜¯å“ªé‡Œé…ç½®æ²¡å¯¹ï¼Œå°±è¿™ä¸ªåœ°æ–¹ï¼Œåå¤æŠ˜è…¾ï¼Œåå¤æŠ˜è…¾ï¼š</p>\n<pre><code class=\"language-shell\">location /mylog/ {\n  alias /opt/quantify-trade-platform-admin/quantify-trade-platform-admin-0.1-SNAPSHOT/logs/;\n  autoindex on;\n}\n</code></pre>\n<p>å¿«ä¸‹ç­çš„æ—¶å€™ï¼Œæˆ‘å‘ç°å¦‚æœæˆ‘æŠŠadminæ”¹æˆaminã€adinï¼Œå°±æ‹¼é”™ä¸€ä¸¤ä¸ªå­—æ¯ï¼Œå°±èƒ½ä¸‹è½½ä¸‹æ¥äº†ã€‚å½“æ—¶ä»¥ä¸ºï¼Œæ˜¯autoindexè¿™ç§é™æ€æ–‡ä»¶æœºåˆ¶ï¼Œä¼šä¸ä¼šæ˜¯ä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œæ–‡ä»¶ååŒ¹é…åˆ°adminè¿™ä¸ªå…³é”®å­—å•¥çš„ï¼Œå°±404.</p>\n<p><img alt=\"image-20260201110908710\" src=\"https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260201110908710.png\" /></p>\n<p>ä½†åé¢ï¼Œæˆ‘æŠŠlogæ‹·è´ä¸€ä¸‹ï¼Œå»æ‰ä¸­é—´çš„ä¸­åˆ’çº¿ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½ä¸‹æ¥ï¼š</p>\n<p><img alt=\"image-20260201110108269\" src=\"https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260201110108269.png\" /></p>\n<p>ç„¶åç½‘ä¸Šä¸€é¡¿ä¹±æœï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯ä¸­åˆ’çº¿å¯¼è‡´çš„é—®é¢˜å•¥çš„ï¼Œæˆ–è€…æ˜¯å› ä¸ºå«æœ‰adminå…³é”®å­—å¯¼è‡´çš„ï¼Œç»“æœéƒ½æ²¡æŸ¥åˆ°æœ‰äººé‡åˆ°è¿™ç§é—®é¢˜ã€‚</p>\n<p>ä¸€é¡¿æœç´¢çŒ›å¦‚è™ï¼Œä»¥ä¸ºæ˜¯nginxçš„ä»€ä¹ˆå°bugï¼ˆå½“æ—¶æ„Ÿè§‰autoindexè¿™ç§é™æ€æ–‡ä»¶æœºåˆ¶ï¼Œå¯èƒ½ç”¨çš„äººå°‘ï¼Œæ˜¯ä¸æ˜¯æœ‰å•¥å°bugæ­£å¥½è¢«æˆ‘æ’è§äº†ï¼‰</p>\n<h1 id=\"æ¬¡æ—¥æ’æŸ¥\">æ¬¡æ—¥æ’æŸ¥</h1>\n<p>ç¬¬äºŒå¤©æ—©ä¸Šæ¥äº†åï¼Œæ‰¾äº†å°æœåŠ¡å™¨ï¼Œæ–°æ­å»ºï¼Œç»“æœå‘ç°admin.txtå¯ä»¥æ­£å¸¸ä¸‹è½½ï¼Œä¸ºå•¥åœ¨é‚£å°æœºå™¨ä¸Šå°±ä¸è¡Œå‘¢ï¼Ÿ</p>\n<p>æˆ‘æƒ³èµ·æ¥straceå‘½ä»¤ï¼Œé‚£å°±çœ‹çœ‹æœ‰æ²¡æœ‰çº¿ç´¢å§ï¼š</p>\n<pre><code class=\"language-shell\">strace -p 121920 -s 1000  -t -e trace=network,file,desc,process\n</code></pre>\n<p>ç»“æœè¯·æ±‚http://1.1.1.1/mylog/quantify-trade-platform-admin.log æ—¶ï¼Œå‘ç°ä¿¡æ¯æ˜¾ç¤ºå‡ºï¼šå‘èµ·äº†socketæ“ä½œï¼Œè¯·æ±‚äº†springbootæœåŠ¡çš„ç«¯å£ã€‚</p>\n<p>å½“æ—¶å¾ˆå¥‡æ€ªï¼Œç¬¬ä¸€æ¬¡è¿˜æ²¡æ”¾åˆ°å¿ƒä¸Šï¼Œç„¶åå¤æµ‹äº†ä¸€éï¼Œå‘ç°è¿˜æ˜¯è¿™æ ·ã€‚ç„¶åå°±å“ŸtcpdumpæŠ“äº†ä¸ªåŒ…ï¼Œå’¦ï¼Œè¿™ä¸ªæ—¥å¿—æ–‡ä»¶çš„è¯·æ±‚æ€ä¹ˆè¢«å‘åˆ°åç«¯æœåŠ¡å»äº†ã€‚</p>\n<p>ç„¶åå†ä¸€çœ‹locationï¼š</p>\n<p><img alt=\"image-20260201111403498\" src=\"https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260201111403498.png\" /></p>\n<p>è¡Œå§ï¼Œä¸€çœ‹è‚¯å®šæ˜¯locationä¸­çš„é‚£ä¸ª<sub>çš„é—®é¢˜äº†ï¼Œç”±äºæ—¥å¿—æ–‡ä»¶åå’Œæˆ‘ä»¬åç«¯æ¥å£çš„å‰ç¼€æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åŒ¹é…åˆ°äº†ä¸Šå›¾çš„é‚£ä¸ªlocationï¼Œç„¶å</sub>åˆæ˜¯æ­£åˆ™åŒ¹é…ï¼ˆè¿™å—è¿™å‡ ä¸ªç¬¦å·ä¸€ç›´è®°ä¸æ¸…æ¥šï¼Œè¿™ä¸‹æŠŠè‡ªå·±å‘äº†ï¼‰</p>\n<h1 id=\"è§£å†³æ–¹æ³•å¦‚ä½•çŸ¥é“urlåŒ¹é…ä¸Šäº†å“ªä¸ªlocation\">è§£å†³æ–¹æ³•ï¼šå¦‚ä½•çŸ¥é“urlåŒ¹é…ä¸Šäº†å“ªä¸ªlocation</h1>\n<p>å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼Œç½‘ä¸Šæœç´¢äº†ä¸‹ï¼Œå‘ç°æœ‰è¿™ä¹ˆä¸€ä¸ªæŠ€å·§ï¼š</p>\n<p><a href=\"https://stackoverflow.com/questions/12703702/nginx-test-which-location-used-to-process-request#:~:text=If%20you%20just%20want%20to,3%20Comments\" rel=\"noopener nofollow\" target=\"_blank\">https://stackoverflow.com/questions/12703702/nginx-test-which-location-used-to-process-request#:~:text=If you just want to,3 Comments</a></p>\n<p><a href=\"https://stackoverflow.com/questions/12703702/nginx-test-which-location-used-to-process-request\" rel=\"noopener nofollow\" target=\"_blank\">https://stackoverflow.com/questions/12703702/nginx-test-which-location-used-to-process-request</a></p>\n<p>å°±æ˜¯åœ¨æ¯ä¸ªlocationä¸­åŠ ä¸€ä¸ªè¯­å¥ï¼Œåœ¨è¿”å›çš„http headerä¸­åŠ ä¸€ä¸ªï¼š</p>\n<pre><code class=\"language-shell\">add_header location 1 always;\n</code></pre>\n<p>æ³¨æ„ï¼Œè¿™é‡Œè¦åŠ alwaysï¼Œä¸ç„¶åƒæˆ‘è¿™ç§404æƒ…å†µä¸‹ï¼Œä¸åŠ alwaysæ˜¯ä¸ä¼šæœ‰è¿™ä¸ªheaderçš„ã€‚</p>\n<p><img alt=\"image-20260201111900000\" src=\"https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260201111900000.png\" /></p>\n<p>åŠ äº†alwaysï¼Œæ‰ä¼šåƒä¸‹é¢è¿™æ ·ï¼š</p>\n<p><img alt=\"image-20260201112049861\" src=\"https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260201112049861.png\" /></p>\n<p>å¦å¤–ï¼Œç”±äºlocationæ˜¯ä¸€ä¸ªhttpè§„èŒƒä¸­é¢„å®šä¹‰çš„headerï¼Œå’Œ403é‡å®šå‘é…åˆä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ¢ä¸ªåå­—ï¼š</p>\n<pre><code class=\"language-shell\">    add_header mylocation 2 always;\n</code></pre>\n<p><img alt=\"image-20260201112228298\" src=\"https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260201112228298.png\" /></p>\n<h1 id=\"å¢åŠ æ—¥å¿—\">å¢åŠ æ—¥å¿—</h1>\n<p>å¦å¤–ä¸€ä¸ªæ–¹å¼ï¼Œå°±æ˜¯æŠŠæ—¥å¿—å¤šæ‰“ä¸€ç‚¹ï¼Œæˆ‘è¯•è¿‡ä¸¤ç§ï¼š</p>\n<h2 id=\"error_log\">error_log</h2>\n<pre><code class=\"language-shell\">error_log  logs/my_error.log  info;\n</code></pre>\n<p><a href=\"https://nginx.org/en/docs/ngx_core_module.html#error_log\" rel=\"noopener nofollow\" target=\"_blank\">https://nginx.org/en/docs/ngx_core_module.html#error_log</a></p>\n<p>vim /usr/local/nginx/logs/my_error.log</p>\n<p>ä½†å‘ç°æ²¡å•¥ç”¨ï¼Œè¿˜æ˜¯æ²¡æœ‰è¯¦ç»†æ—¥å¿—ã€‚</p>\n<h2 id=\"access-log\">access log</h2>\n<p><img alt=\"image-20260201112452079\" src=\"https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260201112452079.png\" /></p>\n<pre><code class=\"language-shell\">    log_format upstream_time '$remote_addr - $remote_user [$time_local] '\n                             '\"$request\" $status $body_bytes_sent '\n                             '\"$http_referer\" \"$http_user_agent\"'\n                             'rt=\"$request_time\" $upstream_addr uct=\"$upstream_connect_time\" uht=\"$upstream_header_time\" urt=\"$upstream_response_time\"';\n\n    server {\n        listen       80;\n        server_name  localhost;\n\n\n        access_log  logs/my.access.log  upstream_time;\n</code></pre>\n<p>é€šè¿‡ä¸Šé¢è¿™ç±»æ—¥å¿—ï¼Œä¹Ÿèƒ½å¸®æˆ‘ä»¬çœ‹åˆ°ï¼Œåˆ°åº•èµ°åˆ°äº†å“ªä¸ªlocationï¼Œåå‘ä»£ç†åˆ°äº†å“ªå°åç«¯æœåŠ¡å™¨ã€‚</p>\n<h2 id=\"debug-log\">debug log</h2>\n<p><a href=\"https://nginx.org/en/docs/debugging_log.html\" rel=\"noopener nofollow\" target=\"_blank\">https://nginx.org/en/docs/debugging_log.html</a></p>\n<p>è¿™ä¸ªè¦åœ¨ç¼–è¯‘æ—¶æ‰“å¼€ï¼š</p>\n<pre><code class=\"language-shell\">./configure --with-debug ...\n</code></pre>\n<p>è¿™ä¸ªæˆ‘å°±æ²¡è¯•äº†ï¼Œåç»­æœ‰ç©ºå†è¯´ã€‚</p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-01 11:28</span>&nbsp;\n<a href=\"https://www.cnblogs.com/grey-wolf\">ä¸‰å›½æ¢¦å›</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">75</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "ä»0åˆ°1ï¼Œå¿«é€Ÿè®­ç»ƒå¹¶ä½¿ç”¨YOLOæ¨¡å‹",
      "link": "https://www.cnblogs.com/ClownLMe/p/19559180",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/ClownLMe/p/19559180\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-31 21:54\">\n    <span>ä»0åˆ°1ï¼Œå¿«é€Ÿè®­ç»ƒå¹¶ä½¿ç”¨YOLOæ¨¡å‹</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"ç®€ä»‹\">ç®€ä»‹</h1>\n<p><strong>YOLO</strong>æ˜¯ç›®å‰è®¡ç®—æœºè§†è§‰é¢†åŸŸæœ€å‰æ²¿ã€åº”ç”¨æœ€å¹¿æ³›çš„<strong>ç›®æ ‡æ£€æµ‹</strong>ç®—æ³•æ¡†æ¶ï¼Œä»–èƒ½å¿«é€Ÿè¯†åˆ«åŒºåˆ†ç›®æ ‡ï¼Œå¹¿æ³›åº”ç”¨äºæ¸¸æˆï¼Œæ— äººé©¾é©¶ï¼Œå·¥ä¸šç­‰é¢†åŸŸã€‚</p>\n<p>ä»¥è¯†åˆ«èº²é¿æ‰è½æ»‘å—çš„æ¸¸æˆçš„ç‰©ä½“å›¾ç‰‡ä½œä¸ºä¾‹å­ã€‚</p>\n<h1 id=\"ä¸€ç¯å¢ƒé…ç½®\">ä¸€ï¼Œç¯å¢ƒé…ç½®</h1>\n<pre><code class=\"language-bash\">pip install ultralytics\n</code></pre>\n<h1 id=\"äºŒå‡†å¤‡æ•°æ®é›†\">äºŒï¼Œå‡†å¤‡æ•°æ®é›†</h1>\n<p>è¿™ä¸ªæ ¼å¼ç›®å½•å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-bash\">my_dataset/\nâ”œâ”€â”€ data.yaml # é…ç½®æ–‡ä»¶ï¼ˆå®šä¹‰è·¯å¾„å’Œç±»åˆ«ï¼‰\nâ”œâ”€â”€ train/ #è®­ç»ƒæ•°æ®é›†\nâ”‚   â”œâ”€â”€ images/ # è®­ç»ƒå›¾ç‰‡\nâ”‚   â””â”€â”€ labels/ # æ ‡æ³¨æ–‡ä»¶ (.txt)\nâ””â”€â”€ val/ #éªŒè¯æ•°æ®é›†\n    â”œâ”€â”€ images/ \n    â””â”€â”€ labels/ \n</code></pre>\n<h3 id=\"datayml\">data.yml</h3>\n<pre><code class=\"language-yaml\">path: D:\\D_MyProject\\Ai\\game_ai\\my_dataset #æ•°æ®é›†è·¯å¾„\ntrain: train/images #è®­ç»ƒé›†å›¾ç‰‡è·¯å¾„\nval: val/images #éªŒè¯é›†å›¾ç‰‡è·¯å¾„\n\nnc: 3 #æ ‡è®°ä¸ªæ•°\nnames:  #æ¯ä¸ªæ ‡è®°çš„åç§°\n&nbsp; 0: player\n&nbsp; 1: enemy\n&nbsp; 2: game_over\n</code></pre>\n<h3 id=\"ä¸‹é¢æ˜¯ç”¨aiç”Ÿæˆäº†æ•°æ®é›†çš„ç”Ÿæˆè„šæœ¬\">ä¸‹é¢æ˜¯ç”¨AIç”Ÿæˆäº†æ•°æ®é›†çš„ç”Ÿæˆè„šæœ¬</h3>\n<p>æ•°æ®é‡å¤ªå¤šäº†ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæˆ–è€…å­¦ä¹ ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢è„šæœ¬</p>\n<pre><code class=\"language-python\">import pygame\nimport random\nimport sys\nimport os\nimport shutil\n\n# =================é…ç½®åŒºåŸŸ=================\n# æ•°æ®é›†æ ¹ç›®å½•åç§°\nDATASET_ROOT = \"my_dataset\"\n# é‡‡é›†æ€»æ•°é‡\nMAX_IMAGES = 1000\n# è®­ç»ƒé›†å æ¯” (0.8 = 80% è®­ç»ƒ, 20% éªŒè¯)\nTRAIN_RATIO = 0.8\n\n# ================= 1. ç¯å¢ƒæ¸…ç†ä¸ç›®å½•åˆ›å»º =================\nprint(f\"ğŸš€ æ­£åœ¨åˆå§‹åŒ–æ•°æ®é›†ç›®å½•: {DATASET_ROOT} ...\")\n\n# å¦‚æœç›®å½•å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤ï¼ˆé˜²æ­¢æ—§æ•°æ®æ··å…¥ï¼‰ï¼Œç¡®ä¿æ•°æ®çº¯å‡€\nif os.path.exists(DATASET_ROOT):\n    shutil.rmtree(DATASET_ROOT)\n\n# åˆ›å»º YOLO æ ‡å‡†ç›®å½•ç»“æ„\nfor split in ['train', 'val']:\n    os.makedirs(os.path.join(DATASET_ROOT, split, 'images'), exist_ok=True)\n    os.makedirs(os.path.join(DATASET_ROOT, split, 'labels'), exist_ok=True)\n\n# ================= 2. è‡ªåŠ¨ç”Ÿæˆ data.yaml =================\nyaml_content = f\"\"\"\npath: {os.path.abspath(DATASET_ROOT)} # ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œé˜²æ­¢æŠ¥é”™\ntrain: train/images\nval: val/images\n\nnc: 3\nnames:\n  0: player\n  1: enemy\n  2: game_over\n\"\"\"\nwith open(os.path.join(DATASET_ROOT, \"data.yaml\"), \"w\", encoding='utf-8') as f:\n    f.write(yaml_content)\nprint(\"âœ… data.yaml é…ç½®æ–‡ä»¶å·²ç”Ÿæˆã€‚\")\n\n# ================= 3. æ¸¸æˆä¸é‡‡é›†é€»è¾‘ =================\npygame.init()\nWIDTH, HEIGHT = 800, 600\n# ä½¿ç”¨ hidden æ¨¡å¼æˆ–æ­£å¸¸æ¨¡å¼å‡å¯ï¼Œè¿™é‡Œç”¨æ­£å¸¸æ¨¡å¼æ–¹ä¾¿ä½ çœ‹åˆ°è¿›åº¦\nscreen = pygame.display.set_mode((WIDTH, HEIGHT))\npygame.display.set_caption(\"Auto Data Generator\")\nclock = pygame.time.Clock()\n\nfont_big = pygame.font.SysFont(\"monospace\", 50)\nfont_small = pygame.font.SysFont(\"monospace\", 35)\n\n# æ¸¸æˆçŠ¶æ€\nplayer_size, enemy_size = 50, 50\nplayer_x = WIDTH // 2\nplayer_y = HEIGHT - player_size - 10\nenemies = []\n\nimg_count = 0\nGAMEPLAY_LIMIT = int(MAX_IMAGES * 0.9) # 90% æ­£å¸¸æ¸¸æˆï¼Œ10% Game Over\n\nprint(f\"ğŸ“¸ å¼€å§‹é‡‡é›† {MAX_IMAGES} å¼ å›¾ç‰‡ (è‡ªåŠ¨åˆ’åˆ† Train/Val)...\")\n\nwhile img_count &lt; MAX_IMAGES:\n    # å¤„ç†é€€å‡ºäº‹ä»¶ï¼Œé˜²æ­¢å¡æ­»\n    for event in pygame.event.get():\n        if event.type == pygame.QUIT:\n            pygame.quit()\n            sys.exit()\n\n    screen.fill((0, 0, 0))\n    labels = [] # å­˜å‚¨å½“å‰å¸§çš„æ ‡ç­¾\n    dw, dh = 1.0 / WIDTH, 1.0 / HEIGHT # å½’ä¸€åŒ–ç³»æ•°\n\n    # --- é€»è¾‘åˆ†æ”¯ï¼šæ­£å¸¸æ¸¸æˆ vs Game Over ---\n    if img_count &lt; GAMEPLAY_LIMIT:\n        # A. æ­£å¸¸æ¸¸æˆç”»é¢\n        # 1. ç©å®¶ç§»åŠ¨\n        if random.random() &lt; 0.2: # å¢åŠ ç§»åŠ¨é¢‘ç‡\n            player_x += random.choice([-15, 15])\n            player_x = max(0, min(WIDTH - player_size, player_x))\n\n        # 2. æ•Œäººç”Ÿæˆä¸ç§»åŠ¨\n        if random.randint(0, 20) == 0: # å¢åŠ æ•Œäººå¯†åº¦\n            enemies.append([random.randint(0, WIDTH - enemy_size), 0])\n        \n        for enemy in enemies: enemy[1] += 15 # åŠ å¿«ä¸‹è½é€Ÿåº¦\n        enemies = [e for e in enemies if e[1] &lt; HEIGHT]\n\n        # 3. ç»˜åˆ¶ç©å®¶ (Class 0)\n        pygame.draw.rect(screen, (50, 150, 255), (player_x, player_y, player_size, player_size))\n        # è®¡ç®— YOLO åæ ‡ (class x_center y_center width height)\n        px, py = (player_x + player_size/2) * dw, (player_y + player_size/2) * dh\n        labels.append(f\"0 {px:.6f} {py:.6f} {player_size*dw:.6f} {player_size*dh:.6f}\")\n\n        # 4. ç»˜åˆ¶æ•Œäºº (Class 1)\n        for e in enemies:\n            pygame.draw.rect(screen, (255, 50, 50), (e[0], e[1], enemy_size, enemy_size))\n            ex, ey = (e[0] + enemy_size/2) * dw, (e[1] + enemy_size/2) * dh\n            labels.append(f\"1 {ex:.6f} {ey:.6f} {enemy_size*dw:.6f} {enemy_size*dh:.6f}\")\n\n    else:\n        # B. Game Over ç”»é¢ (Class 2)\n        text_surf = font_big.render(\"GAME OVER\", True, (255, 50, 50))\n        \n        # éšæœºæŠ–åŠ¨ä½ç½®ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ\n        off_x, off_y = random.randint(-50, 50), random.randint(-50, 50)\n        text_x = WIDTH // 2 - text_surf.get_width() // 2 + off_x\n        text_y = HEIGHT // 2 - 100 + off_y\n        screen.blit(text_surf, (text_x, text_y))\n\n        # å¹²æ‰°é¡¹\n        score_surf = font_small.render(f\"Score: {random.randint(0,999)}\", True, (255,255,255))\n        screen.blit(score_surf, (WIDTH//2 - score_surf.get_width()//2, HEIGHT//2 + 50))\n\n        # è®°å½•æ ‡ç­¾\n        tw, th = text_surf.get_width(), text_surf.get_height()\n        tx, ty = (text_x + tw/2) * dw, (text_y + th/2) * dh\n        labels.append(f\"2 {tx:.6f} {ty:.6f} {tw*dw:.6f} {th*dh:.6f}\")\n\n    # ================= 4. ä¿å­˜é€»è¾‘ (æ ¸å¿ƒä¿®æ”¹) =================\n    pygame.display.flip()\n    \n    # é‡‡æ ·ç‡ï¼šä¸æ˜¯æ¯ä¸€å¸§éƒ½ä¿å­˜ï¼Œé˜²æ­¢é‡å¤åº¦è¿‡é«˜ (è¿™é‡Œè®¾ä¸º 30% æ¦‚ç‡ä¿å­˜)\n    if random.random() &lt; 0.3:\n        # A. å†³å®šæ˜¯å» Train è¿˜æ˜¯ Val\n        split_folder = \"train\" if random.random() &lt; TRAIN_RATIO else \"val\"\n        \n        # B. ç”Ÿæˆæ–‡ä»¶å\n        filename = f\"{img_count:06d}\"\n        img_save_path = os.path.join(DATASET_ROOT, split_folder, \"images\", f\"{filename}.jpg\")\n        lbl_save_path = os.path.join(DATASET_ROOT, split_folder, \"labels\", f\"{filename}.txt\")\n\n        # C. ä¿å­˜å›¾ç‰‡\n        pygame.image.save(screen, img_save_path)\n\n        # D. ä¿å­˜æ ‡ç­¾\n        with open(lbl_save_path, \"w\") as f:\n            f.write(\"\\n\".join(labels))\n\n        img_count += 1\n        \n        # æ‰“å°è¿›åº¦æ¡\n        print(f\"[{split_folder.upper()}] è¿›åº¦: {img_count}/{MAX_IMAGES}\", end=\"\\r\")\n\n    # åŠ é€Ÿæ¨¡æ‹Ÿï¼Œä¸è¦å‚ç›´åŒæ­¥ï¼Œè¶Šå¿«è¶Šå¥½\n    clock.tick(0) \n\npygame.quit()\nprint(f\"\\n\\nâœ¨ å…¨éƒ¨å®Œæˆï¼æ•°æ®é›†å·²å°±ç»ªï¼š{os.path.abspath(DATASET_ROOT)}\")\nprint(\"ğŸ’¡ ä¸‹ä¸€æ­¥ï¼šç›´æ¥è¿è¡Œ model.train(data='my_dataset/data.yaml')\")\n</code></pre>\n<h1 id=\"ä¸‰è®­ç»ƒyoloæ¨¡å‹\">ä¸‰ï¼Œè®­ç»ƒYOLOæ¨¡å‹</h1>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨<code>ultralytics</code>æ¡†æ¶è®­ç»ƒYOLOçš„ä»£ç éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ è¡Œ<br />\n<strong>æ³¨æ„ï¼šè¿™é‡ŒYOLOä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹å¹¶è®­ç»ƒï¼Œä¸‹è½½æ—¶å¤±è´¥å¯èƒ½éœ€è¦æŒ‚æ¢¯å­</strong></p>\n<pre><code class=\"language-python\">from ultralytics import YOLO\n\ndef train_model():\n    #åŠ è½½æ¨¡å‹\n    model = YOLO(\"yolo11n.pt\") \n\n    #å¼€å§‹è®­ç»ƒ\n    print(\"å¼€å§‹è®­ç»ƒ...\")\n    results = model.train(\n        data=\"my_dataset/data.yaml\", #æ•°æ®é›†é…ç½®æ–‡ä»¶\n        epochs=30, #è®­ç»ƒè½®æ•°\n        imgsz=640, #å›¾ç‰‡è¾“å…¥å°ºå¯¸\n        batch=16, #æ˜¾å­˜å¤Ÿå¤§å¯ä»¥æ”¹å¤§ï¼Œæ¯”å¦‚ 32 æˆ– 64\n        device=0, #å¼ºåˆ¶ä½¿ç”¨ç¬¬ä¸€å¼ æ˜¾å¡ (éœ€è¦CUDA)\n        workers=0, #Windowsä¸‹è®¾ä¸º0é˜²æ­¢å¤šè¿›ç¨‹æŠ¥é”™\n        project=\"dodge_project\",#ä¿å­˜è·¯å¾„\n        name=\"ai_model\" #è®­ç»ƒè¿è¡Œåç§°\n    )\n    print(f\"è®­ç»ƒå®Œæˆï¼æœ€ä½³æ¨¡å‹ä¿å­˜åœ¨: {results.save_dir}/weights/best.pt\")\n\nif __name__ == \"__main__\":\n    train_model()\n</code></pre>\n<h1 id=\"å››ä½¿ç”¨yoloæ¨¡å‹\">å››ï¼Œä½¿ç”¨YOLOæ¨¡å‹</h1>\n<pre><code class=\"language-python\">from ultralytics import YOLO\n\n#é…ç½®è·¯å¾„\nMODEL_PATH = \"dodge_project/ai_model/weights/best.pt\" \nPIC_PATH = \"my_dataset/val/images/000045.jpg\"\n\n#åŠ è½½æ¨¡å‹\nmodel = YOLO(MODEL_PATH)\nprint(f\"æ¨¡å‹åŠ è½½æˆåŠŸ\")\n\n#è¯†åˆ«å›¾ç‰‡\nresults = model.predict(PIC_PATH, verbose=False, conf=0.4, imgsz=640)\nresult = results[0]\n\n#è·å–ä¿¡æ¯å¹¶æ‰“å°\nfor box in result.boxes:\n    # è·å–åæ ‡ (x1, y1, x2, y2)ã€ç±»åˆ« ID å’Œç½®ä¿¡åº¦\n    x1, y1, x2, y2 = map(int, box.xyxy[0])\n    cls_id = int(box.cls[0])\n    conf = float(box.conf[0])\n    \n    # ç±»åˆ«åç§°æ˜ å°„\n    names = {0: \"Player\", 1: \"Enemy\", 2: \"Game Over\"}\n    label = names.get(cls_id, f\"Unknown({cls_id})\")\n    print(f\"æ‰¾åˆ°ç‰©ä½“: [{label:10}] | ç½®ä¿¡åº¦: {conf:.2f} | åæ ‡: ({x1}, {y1}) -&gt; ({x2}, {y2})\")\n\n#å±•ç¤ºå›¾ç‰‡\nresult.show()\n</code></pre>\n<p><strong>å¦‚æœâ¤å–œæ¬¢â¤æœ¬ç³»åˆ—æ•™ç¨‹ï¼Œå°±ç‚¹ä¸ªå…³æ³¨å§ï¼Œåç»­ä¸å®šæœŸæ›´æ–°~</strong></p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 21:54</span>&nbsp;\n<a href=\"https://www.cnblogs.com/ClownLMe\">ClownLMe</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">133</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    }
  ]
}