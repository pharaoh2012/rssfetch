{
  "title": "ä¸»é¡µ - åšå®¢å›­",
  "link": "https://www.cnblogs.com/",
  "description": "ä¸»é¡µ - åšå®¢å›­ RSS",
  "entries": [
    {
      "title": "`i` å’Œ `e` å†™åå¼•å‘çš„è¡€æ¡ˆï¼šå½“ AI çš„â€œçº é”™ç™–â€é‡ä¸Š NexusContract çš„â€œç…§å¦–é•œâ€",
      "link": "https://www.cnblogs.com/jieky/p/19481961",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/jieky/p/19481961\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 14:19\">\n    <span>`i` å’Œ `e` å†™åå¼•å‘çš„è¡€æ¡ˆï¼šå½“ AI çš„â€œçº é”™ç™–â€é‡ä¸Š NexusContract çš„â€œç…§å¦–é•œâ€</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        åœ¨å¯¹æ¥æŸå¤´éƒ¨æ”¯ä»˜ç½‘å…³æ—¶ï¼Œæˆ‘é­é‡äº†ä¸€æ¬¡å®Œç¾çš„â€œé™ç»´æ‰“å‡»â€ã€‚å®˜æ–¹æ–‡æ¡£é‡Œä¸€ä¸ªæŠŠ `ei` å†™æˆ `ie` çš„è‹±è¯­è¯­æ³•é”™è¯¯ï¼Œéª—è¿‡äº† AI çš„è¯­æ³•æ£€æŸ¥ï¼Œä¹Ÿéª—è¿‡äº†æˆ‘çš„è‚‰çœ¼ Reviewã€‚æœ¬æ–‡å°†æ¢è®¨ NexusContract å¦‚ä½•é€šè¿‡**å…ƒæ•°æ®éš”ç¦»**æœºåˆ¶ï¼Œåœ¨æ··ä¹±çš„é—ç•™æ¥å£ä¸ç°ä»£åŒ–çš„æ•´æ´ä»£ç ä¹‹é—´å»ºç«‹ä¸€é“é˜²çº¿ã€‚\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"i-å’Œ-e-å†™åå¼•å‘çš„è¡€æ¡ˆå½“-ai-çš„çº é”™ç™–é‡ä¸Š-nexuscontract-çš„ç…§å¦–é•œ\"><code>i</code> å’Œ <code>e</code> å†™åå¼•å‘çš„è¡€æ¡ˆï¼šå½“ AI çš„â€œçº é”™ç™–â€é‡ä¸Š NexusContract çš„â€œç…§å¦–é•œâ€</h1>\n<blockquote>\n<p><strong>æ‘˜è¦</strong>ï¼šåœ¨å¯¹æ¥æŸå¤´éƒ¨æ”¯ä»˜ç½‘å…³æ—¶ï¼Œæˆ‘é­é‡äº†ä¸€æ¬¡å®Œç¾çš„â€œé™ç»´æ‰“å‡»â€ã€‚å®˜æ–¹æ–‡æ¡£é‡Œä¸€ä¸ªæŠŠ <code>ei</code> å†™æˆ <code>ie</code> çš„è‹±è¯­è¯­æ³•é”™è¯¯ï¼Œéª—è¿‡äº† AI çš„è¯­æ³•æ£€æŸ¥ï¼Œä¹Ÿéª—è¿‡äº†æˆ‘çš„è‚‰çœ¼ Reviewã€‚æœ¬æ–‡å°†æ¢è®¨ NexusContract å¦‚ä½•é€šè¿‡<strong>å…ƒæ•°æ®éš”ç¦»</strong>æœºåˆ¶ï¼Œåœ¨æ··ä¹±çš„é—ç•™æ¥å£ä¸ç°ä»£åŒ–çš„æ•´æ´ä»£ç ä¹‹é—´å»ºç«‹ä¸€é“é˜²çº¿ã€‚</p>\n</blockquote>\n<h2 id=\"1-è¯¡å¼‚çš„-parameter_missing\">1. è¯¡å¼‚çš„ <code>PARAMETER_MISSING</code></h2>\n<p>æ•…äº‹å‘ç”Ÿåœ¨ä¸ä¹…å‰ï¼Œæˆ‘ä»¬æ­£åœ¨é‡æ„å†…éƒ¨çš„ä¸€ä¸ªè¿è¡Œäº†å‡ å¹´çš„è€æ—§æ”¯ä»˜ç½‘å…³ã€‚</p>\n<p>ä¸ºäº†æé«˜é‡æ„æ•ˆç‡ï¼Œæˆ‘æŠŠæ—§çš„æ–‡æ¡£æˆªå›¾å–‚ç»™äº† AIï¼ˆæŸçŸ¥åå¤§æ¨¡å‹ï¼‰ï¼Œè®©å®ƒå¸®æˆ‘ç”Ÿæˆç¬¦åˆ NexusContract è§„èŒƒçš„ C# DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰ã€‚AI çš„è¡¨ç°å ªç§°å®Œç¾ï¼Œç¬é—´åå‡ºäº†ç»“æ„æ¸…æ™°çš„ä»£ç ï¼š</p>\n<pre><code class=\"language-csharp\">public string ReceiverId { get; set; } // æ”¶æ¬¾æ–¹ID\n\n</code></pre>\n<p>ä»£ç çœ‹ç€æ²¡æ¯›ç—…ï¼Œå‘½åä¹Ÿè§„èŒƒã€‚æˆ‘æ»¡æ€€ä¿¡å¿ƒåœ°å¯åŠ¨æœåŠ¡ï¼Œå¼€å§‹<strong>æœ¬åœ°è”è°ƒ</strong>ã€‚</p>\n<p><strong>ç»“æœï¼Œæ¥å£æ­»æ´»ä¸é€šã€‚</strong></p>\n<p>ä¸Šæ¸¸ç½‘å…³ä¸€ç›´è¿”å›å†·å†°å†°çš„é”™è¯¯ï¼š<code>PARAMETER_MISSING</code>ã€‚</p>\n<p>è¿™å°±å¾ˆé‚ªé—¨äº†ã€‚<br />\næˆ‘æ‰“äº†æ–­ç‚¹ï¼Œæ•°æ®åœ¨ï¼›<br />\næŠ“äº†åŒ…ï¼ŒJSON å­—æ®µä¹Ÿæœ‰ï¼›<br />\næˆ‘è‚‰çœ¼æ£€æŸ¥äº†ä¸‰éï¼Œ<code>ReceiverId</code> æ‹¼å†™ç»å¯¹æ²¡é—®é¢˜ï¼›<br />\næˆ‘åˆè®© AI æ£€æŸ¥äº†ä¸€éä»£ç ï¼Œå®ƒä¹Ÿä¿¡èª“æ—¦æ—¦åœ°è¯´æ²¡æœ‰è¯­æ³•é”™è¯¯ã€‚</p>\n<p><strong>æ•´æ•´ä¸¤ä¸ªå°æ—¶ï¼Œæˆ‘å°±å¡åœ¨è¿™ä¸ªè«åå…¶å¦™çš„é”™è¯¯ä¸Šï¼Œç”šè‡³å¼€å§‹æ€€ç–‘æ˜¯ä¸æ˜¯ HTTP åè®®å¤´çš„é—®é¢˜ï¼Œæˆ–è€…æ˜¯ JSON åºåˆ—åŒ–åº“çš„ Bugã€‚</strong></p>\n<p>ç›´åˆ°æˆ‘å®åœ¨æ²¡æ‹›äº†ï¼Œå†æ¬¡æ‰“å¼€é‚£ä»½æ–‡æ¡£ï¼Œå¼ºè¿«è‡ªå·±ä¸€ä¸ªå­—æ¯ä¸€ä¸ªå­—æ¯åœ°è·Ÿæˆ‘çš„ä»£ç æ¯”å¯¹æ—¶ï¼Œæˆ‘æ‰å‘ç°äº†ä¸€ä¸ªä»¤äººçª’æ¯çš„ç»†èŠ‚ï¼š</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/45234/202601/45234-20260114141433336-590884100.png\" /></p>\n<p><strong>æ–‡æ¡£é‡Œå†™çš„å­—æ®µåï¼Œæ˜¯ <code>recieverId</code>ã€‚</strong></p>\n<p>æ³¨æ„åˆ°äº†å—ï¼Ÿ<strong><code>i</code> å’Œ <code>e</code> å†™åäº†ï¼</strong></p>\n<p>æ­£ç¡®çš„è‹±è¯­å•è¯æ˜¯ <code>Receiver</code>ï¼ˆc åé¢æ¥ eiï¼‰ï¼Œä½†æ–‡æ¡£é‡Œå†™æˆäº† <code>Reciever</code>ï¼ˆieï¼‰ã€‚è¿™ç§â€œé•¿å¾—æåƒâ€çš„é”™è¯¯ï¼Œæå…¶å®¹æ˜“å‘ç”Ÿè§†é”™è§‰ã€‚</p>\n<p>é‚£ä¸€åˆ»æˆ‘ç®€ç›´æƒ³æ‘”é”®ç›˜ï¼š<strong>AI å¤ªâ€œèªæ˜â€äº†ã€‚</strong> å®ƒè¯†åˆ«å‡ºè¿™æ˜¯â€œæ”¶æ¬¾æ–¹â€çš„æ„æ€ï¼Œå‘ç°äº†è¿™ä¸ªè¯­æ³•é”™è¯¯ï¼Œäºæ˜¯<strong>å¥½å¿ƒåœ°åœ¨ç”Ÿæˆä»£ç æ—¶å¸®æˆ‘æŠŠå®ƒâ€œæ”¹å¯¹â€äº†</strong>ã€‚è€Œæˆ‘ï¼Œä½œä¸ºä¸€ä¸ªæ­£å¸¸çš„äººç±»ç¨‹åºå‘˜ï¼Œå¤§è„‘ä¹Ÿè‡ªåŠ¨è¿‡æ»¤äº†è¿™ä¸ªæ‹¼å†™é”™è¯¯ã€‚</p>\n<p>åœ¨é—ç•™ç³»ç»Ÿçš„é›†æˆä¸­ï¼Œ<strong>â€œå†å²çš„é”™è¯¯â€å¾€å¾€æ¯”â€œæ­£ç¡®çš„è¯­æ³•â€æ›´é‡è¦</strong>ã€‚</p>\n<h2 id=\"2-æ¶æ„çš„åå‡»ä»£ç æ´ç™–ä¸è‚®è„ç°å®\">2. æ¶æ„çš„åå‡»ï¼šä»£ç æ´ç™–ä¸è‚®è„ç°å®</h2>\n<p>é¢å¯¹è¿™ç§åœºæ™¯ï¼Œä¼ ç»Ÿåšæ³•é€šå¸¸æœ‰ä¸¤ç§ï¼š</p>\n<ol>\n<li><strong>åŒæµåˆæ±¡æ´¾ï¼š</strong> ç›´æ¥æŠŠ C# å±æ€§åä¹Ÿå†™é”™ã€‚</li>\n</ol>\n<pre><code class=\"language-csharp\">public string RecieverId { get; set; } // çœ‹ç€å°±éš¾å—ï¼Œé€¼æ­»å¼ºè¿«ç—‡\n\n</code></pre>\n<p>è¿™æœ‰ä¸ªå·¨å¤§çš„éšæ‚£ï¼šæ–°æ¥çš„åŒäº‹æˆ–è€…åæ¥ç»´æŠ¤çš„ AIï¼Œçœ‹åˆ°è¿™ä¸ªâ€œé”™è¯¯æ‹¼å†™â€ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šé¡ºæ‰‹æŠŠå®ƒâ€œä¿®å¤â€æˆæ­£ç¡®çš„ <code>ReceiverId</code>ï¼Œç„¶å<strong>ç °ï¼ç³»ç»ŸåˆæŒ‚äº†ã€‚</strong><br />\n2. <strong>æ‰‹åŠ¨æ˜ å°„æ´¾ï¼š</strong> åœ¨ä¸šåŠ¡ä»£ç é‡Œæ‰‹åŠ¨å†™ <code>json[\"recieverId\"] = request.ReceiverId</code>ã€‚<br />\nè¿™ä¼šå¯¼è‡´ä¸šåŠ¡é€»è¾‘é‡Œå……æ–¥ç€å¤§é‡çš„å­—ç¬¦ä¸²ç¡¬ç¼–ç ï¼Œç»´æŠ¤æˆæœ¬æé«˜ã€‚</p>\n<p><strong>NexusContract çš„å“²å­¦æ˜¯ï¼š</strong> æˆ‘ä»¬æ”¹å˜ä¸äº†å¤–éƒ¨ä¸–ç•Œçš„â€œæ–‡ç›²â€æ‹¼å†™ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¶æ„æ‰‹æ®µï¼Œä¸è®©è¿™äº›â€œè„ä¸œè¥¿â€æ±¡æŸ“æˆ‘ä»¬çš„æ ¸å¿ƒä»£ç ã€‚</p>\n<p>æˆ‘ä»¬é‡‡ç”¨äº† <strong>[ApiField]</strong> ç‰¹æ€§æ¥å®ç° <strong>ç‰©ç†éš”ç¦»</strong>ï¼š</p>\n<pre><code class=\"language-csharp\">[ApiOperation(\"payment.gateway.pay\", HttpVerb.POST)]\npublic class PaymentRequest : IApiRequest\n{\n    // ç»™å¯¹æ–¹çœ‹çš„ï¼ˆå¿…é¡»é”™ï¼‰ï¼šæ˜ å°„åˆ°é‚£ä¸ªæŠŠ ie å†™åçš„è„å­—æ®µ\n    [ApiField(\"recieverId\", IsRequired = true)]\n    \n    // ç»™è‡ªå·±çœ‹çš„ï¼ˆå¿…é¡»å¯¹ï¼‰ï¼šä¿æŒå†…éƒ¨é¢†åŸŸè¯­è¨€çš„çº¯æ´æ€§\n    public string ReceiverId { get; set; }\n}\n\n</code></pre>\n<p>è¿™ä¸ä»…æ˜¯ç®€å•çš„é‡å‘½åï¼Œè¿™æ˜¯ <strong>è¯­ä¹‰è§£è€¦ (Semantic Decoupling)</strong>ã€‚</p>\n<ul>\n<li><strong>å±æ€§å (Property):</strong> æœåŠ¡äºå†…éƒ¨é€»è¾‘ï¼Œä½¿ç”¨ <strong>Ubiquitous Language (é€šç”¨è¯­è¨€)</strong>ï¼Œå¿…é¡»æ­£ç¡®ã€å¯è¯»ã€‚</li>\n<li><strong>ç‰¹æ€§å (Attribute):</strong> æœåŠ¡äºå¤–éƒ¨å¥‘çº¦ï¼Œæ˜¯å¯¹å†å²äº‹å®çš„ <strong>å¿«ç…§</strong>ï¼Œå¿…é¡»çœŸå®ã€å“ªæ€•æ˜¯é”™çš„ã€‚</li>\n</ul>\n<h2 id=\"3-æ·±åº¦è§£å¯†nexuscontractcore-çš„é»‘ç›’\">3. æ·±åº¦è§£å¯†ï¼šNexusContract.Core çš„é»‘ç›’</h2>\n<p>è¿™æ—¶ä½ å¯èƒ½ä¼šé—®ï¼š<em>â€œå¸‚é¢ä¸Šå¾ˆå¤š JSON åº“éƒ½æœ‰ <code>JsonProperty</code>ï¼Œè¿™æœ‰ä»€ä¹ˆç¨€å¥‡çš„ï¼Ÿâ€</em></p>\n<p>åŒºåˆ«åœ¨äº <strong>å¤„ç†æ—¶æœº</strong> å’Œ <strong>ç¡®å®šæ€§</strong>ã€‚</p>\n<p>NexusContract åœ¨ <strong>ç³»ç»Ÿå¯åŠ¨ (Startup)</strong> æ—¶ï¼Œä¼šæ‰§è¡Œä¸€ä¸ª <strong>[å†³ç­– A-301] å…ƒæ•°æ®å†·å†» (Metadata Freezing)</strong> æµç¨‹ã€‚</p>\n<p>è™½ç„¶æ¡†æ¶åœ¨å¯åŠ¨æ—¶æ— æ³•çŸ¥é“å¤–éƒ¨æ¥å£åˆ°åº•å« <code>recieverId</code> è¿˜æ˜¯ <code>receiverId</code>ï¼ˆé™¤éæˆ‘ä»¬æœ‰ Schema æ–‡ä»¶ï¼‰ï¼Œä½†å®ƒåšäº†ä¸€ä»¶æ›´é‡è¦çš„äº‹ï¼š<strong>ç¡®ç«‹å¥‘çº¦çš„ç»å¯¹æƒå¨</strong>ã€‚</p>\n<h3 id=\"æ ¸å¿ƒä»£ç å±•ç¤º\">æ ¸å¿ƒä»£ç å±•ç¤º</h3>\n<pre><code class=\"language-csharp\">// Copyright (c) 2026 NexusContract. All rights reserved.\n\nusing System.Collections.Concurrent;\nusing System.Reflection;\nusing NexusContract.Abstractions.Exceptions;\n\nnamespace NexusContract.Core.Reflection\n{\n    /// &lt;summary&gt;\n    /// ã€å†³ç­– A-301ã€‘NexusContractMetadataRegistryï¼ˆå¥‘çº¦å…ƒæ•°æ®æ³¨å†Œè¡¨ï¼‰\n    /// \n    /// æ ¸å¿ƒèŒèƒ½ï¼š\n    /// 1. å‘ç°ï¼ˆDiscoveryï¼‰ï¼šå¯åŠ¨æ—¶æ‰«ææ‰€æœ‰å¥‘çº¦ç±»çš„ Attribute ç»“æ„\n    /// 2. éªŒè¯ï¼ˆValidationï¼‰ï¼šæ‰§è¡Œ ContractValidator ç¡®ä¿å†…éƒ¨çº¦æŸï¼ˆå¦‚ Getter/Setter å®Œæ•´æ€§ï¼‰\n    /// 3. å†»ç»“ï¼ˆFreezingï¼‰ï¼šå°†åå°„ç»“æœè½¬ä¸ºä¸å¯å˜å¯¹è±¡ï¼Œè¿è¡ŒæœŸé›¶åå°„æŸè€—\n    /// &lt;/summary&gt;\n    public sealed class NexusContractMetadataRegistry\n    {\n        // å•ä¾‹æ¨¡å¼ï¼šç¡®ä¿å…¨å±€å”¯ä¸€æ³¨å†Œè¡¨\n        private static readonly Lazy&lt;NexusContractMetadataRegistry&gt; _instance = new(() =&gt; new NexusContractMetadataRegistry());\n        public static NexusContractMetadataRegistry Instance =&gt; _instance.Value;\n\n        // ã€å†³ç­– A-302ã€‘æ ¸å¿ƒå†·å†»åº“\n        // Key: å¥‘çº¦ç±»å‹, Value: é¢„ç¼–è¯‘å¥½çš„å…ƒæ•°æ®ï¼ˆåŒ…å« Expression Tree å§”æ‰˜ï¼‰\n        private readonly ConcurrentDictionary&lt;Type, ContractMetadata&gt; _cache = new();\n\n        private NexusContractMetadataRegistry() { }\n\n        /// &lt;summary&gt;\n        /// ã€å†³ç­– A-308ã€‘å¯åŠ¨æœŸä½“æ£€ï¼ˆStartup Health Checkï¼‰\n        /// è¿™ä¸æ˜¯ç®€å•çš„åŠ è½½ï¼Œè€Œæ˜¯ä¸€æ¬¡å…¨é‡çš„â€œCTæ‰«æâ€ã€‚\n        /// ç¡®ä¿æ‰€æœ‰å¥‘çº¦åœ¨ç‰©ç†ä¸Šæ˜¯åˆæ³•çš„ï¼ˆä¾‹å¦‚é˜²æ­¢ Attribute é‡å¤å®šä¹‰ï¼‰ã€‚\n        /// &lt;/summary&gt;\n        public DiagnosticReport Preload(IEnumerable&lt;Type&gt; types)\n        {\n            var globalReport = new DiagnosticReport();\n\n            foreach (var type in types)\n            {\n                // 1. é™æ€éªŒè¯ï¼ˆå­—æ®µæ‹¼å†™ã€Attribute å†²çªç­‰ï¼‰\n                var perTypeReport = new DiagnosticReport();\n                ContractValidator.Validate(type, perTypeReport);\n\n                // 2. å¦‚æœéªŒè¯é€šè¿‡ï¼Œæ„å»ºä¸å¯å˜å…ƒæ•°æ®\n                if (!perTypeReport.HasErrors)\n                {\n                    try \n                    {\n                        var metadata = BuildMetadata(type, perTypeReport);\n                        _cache.TryAdd(type, metadata); // å†»ç»“å…¥åº“\n                    }\n                    catch (Exception ex)\n                    {\n                        perTypeReport.AddCritical(type.Name, $\"Metadata freeze failed: {ex.Message}\");\n                    }\n                }\n                globalReport.Merge(perTypeReport);\n            }\n            return globalReport; // è¿”å›ä½“æ£€æŠ¥å‘Š\n        }\n\n        /// &lt;summary&gt;\n        /// æ„å»ºå…ƒæ•°æ®æ ¸å¿ƒæµï¼šå®¡è®¡ -&gt; ç¼–è¯‘ -&gt; å°è£…\n        /// &lt;/summary&gt;\n        private ContractMetadata BuildMetadata(Type type, DiagnosticReport report)\n        {\n            // ... (çœç•¥éƒ¨åˆ†ä»£ç ) ...\n\n            // ã€å†³ç­– A-309ã€‘å¯ç”¨ Expression Tree é¢„ç¼–è¯‘ï¼ˆçœŸæ­£é›¶åå°„ï¼‰\n            // å°†åå°„è¯»å†™è½¬æ¢ä¸ºå¼ºç±»å‹å§”æ‰˜ï¼Œæ€§èƒ½æå‡ 10 å€\n            var projector = ContractMetadataCompiler.CompileProjector(type, propertyMetadatas);\n            var hydrator = ContractMetadataCompiler.CompileHydrator(type, propertyMetadatas);\n\n            return new ContractMetadata(type, opAttr, propertyMetadatas.AsReadOnly(), projector, hydrator);\n        }\n    }\n}\n\n</code></pre>\n<h3 id=\"æŠ€æœ¯åŸç†è§£è¯»\">æŠ€æœ¯åŸç†è§£è¯»</h3>\n<p><strong>ä¸ºä»€ä¹ˆè¿™å¯¹æ’æŸ¥ Bug å¾ˆæœ‰ç”¨ï¼Ÿ</strong></p>\n<p>è™½ç„¶ <code>PARAMETER_MISSING</code> æ˜¯åœ¨è¿è¡Œæ—¶æŠ¥å‡ºæ¥çš„ï¼Œä½† NexusContract çš„æœºåˆ¶ä¿è¯äº†<strong>ä¿®å¤çš„å»‰ä»·æ€§ä¸ç¡®å®šæ€§</strong>ã€‚</p>\n<ol>\n<li><strong>Expression Tree é¢„ç¼–è¯‘ï¼š</strong><br />\nä¸€æ—¦æˆ‘ä»¬åœ¨ Attribute é‡ŒæŠŠåå­—ä¿®æ­£ä¸º <code>[ApiField(\"recieverId\")]</code>ï¼Œæ¡†æ¶åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶ï¼Œä¼šé€šè¿‡ <strong>Expression Tree</strong> æŠŠè¿™ä¸ªæ˜ å°„å…³ç³»ç¼–è¯‘æˆé«˜æ•ˆçš„ Delegateã€‚<br />\nè¿™æ„å‘³ç€ï¼šå³ä½¿ä¸ºäº†å…¼å®¹è€æ¥å£è€ŒåŠ äº† Attributeï¼Œ<strong>è¿è¡Œæ—¶æ€§èƒ½ä¾ç„¶ç­‰åŒäºæ‰‹å†™ä»£ç </strong>ï¼Œå®Œå…¨æ²¡æœ‰åå°„çš„é¢å¤–å¼€é”€ã€‚</li>\n<li><strong>å¥‘çº¦çš„æ˜¾å¼åŒ–ï¼š</strong><br />\nè¿™ç§å†™æ³•å¼ºè¿«å¼€å‘è€…å»ç¡®è®¤æ¯ä¸€ä¸ªå­—æ®µçš„æ˜ å°„å…³ç³»ã€‚ä»£ç é‡Œçš„ <code>[ApiField]</code> å°±åƒä¸€ä¸ªä¸ªè­¦ç¤ºç‰Œï¼Œæ—¶åˆ»æé†’ç€åæ¥è€…ï¼š<strong>â€œæ³¨æ„ï¼Œè¿™é‡Œæœ‰ä¸ªå‘ï¼Œåˆ«åŠ¨ï¼â€</strong></li>\n</ol>\n<h2 id=\"4-ç»“è¯­\">4. ç»“è¯­</h2>\n<p>ä»¥å‰æˆ‘ä»¬æ€• AI çç¼–ä»£ç ï¼ˆå¹»è§‰ï¼‰ï¼Œç°åœ¨æˆ‘ä»¬æ€• AI <strong>ä»£ç å†™å¾—å¤ªå¯¹</strong>ã€‚</p>\n<p>é¢å¯¹æŸè”ã€æŸé“¶è¡Œã€æŸæ”¯ä»˜é‚£äº›åå‡ å¹´å‰çš„â€œè€ƒå¤çº§â€æ¥å£ï¼ŒAI è¿™ç§æ‹¿ç‰›æ´¥è¯å…¸å½“æ ‡å‡†çš„â€œé«˜æç”Ÿâ€æ ¹æœ¬æ°´åœŸä¸æœã€‚å®ƒä¸çŸ¥é“ <code>recieverId</code> åœ¨è¿™é‡Œä¸æ˜¯æ‹¼å†™é”™è¯¯ï¼Œå®ƒæ˜¯<strong>æ³•å¾‹</strong>ï¼Œæ˜¯<strong>ä¸å¯åŠ¨æ‘‡çš„å¥‘çº¦</strong>ã€‚</p>\n<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ NexusContract â€”â€” <strong>å®ƒå…è®¸æˆ‘ä»¬åœ¨ä»£ç é‡Œä¼˜é›…åœ°â€œæŒ‡é¹¿ä¸ºé©¬â€ï¼Œå¹¶ç”¨æœ€åº•å±‚çš„æŠ€æœ¯æ‰‹æ®µï¼ˆå…ƒæ•°æ®å†·å†»ï¼‰ï¼Œå°†è¿™ä»½â€œè‚®è„çš„ç°å®â€é«˜æ€§èƒ½åœ°å°è£…èµ·æ¥ã€‚</strong></p>\n<hr />\n\n</div>\n<div id=\"MySignature\">\n    <p>______________________________________<br />ç”Ÿæ´»ï¼Œè¦ç”¨åœ£äººçš„èƒ¸æ€€é¢å¯¹ï¼Œç”¨ç§‘å­¦çš„æ–¹æ³•æ”¯é…ï¼Œ <br />&nbsp; &nbsp; &nbsp; &nbsp; ç”¨çš‡å¸çš„å¾¡è†³å…»èƒƒï¼Œç”¨æ¸…æ´çš„ç©ºæ°”æ´—è‚ºï¼Œ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ç”¨å°çŒªçš„æ„Ÿè§‰å»ç¡ï¼Œç”¨å¤ªé˜³çš„çƒ­æƒ…çŒæ°´ã€‚<br />______________________________________</p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 14:19</span>&nbsp;\n<a href=\"https://www.cnblogs.com/jieky\">æ¶ˆå¤±è€…</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">45</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "FastAPIæ•°æ®åº“å®æˆ˜ï¼šä»SQLAlchemyåŸç†åˆ°é«˜æ•ˆè¿æ¥ç®¡ç†ï¼Œå‘Šåˆ«æ€§èƒ½ç“¶é¢ˆ",
      "link": "https://www.cnblogs.com/ymtianyu/p/19480142",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/ymtianyu/p/19480142\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 11:13\">\n    <span>FastAPIæ•°æ®åº“å®æˆ˜ï¼šä»SQLAlchemyåŸç†åˆ°é«˜æ•ˆè¿æ¥ç®¡ç†ï¼Œå‘Šåˆ«æ€§èƒ½ç“¶é¢ˆ</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        æœ¬æ–‡ä»FastAPIå¼€å‘ä¸­æ•°æ®åº“æ“ä½œçš„å¸¸è§ç—›ç‚¹åˆ‡å…¥ï¼Œæ·±å…¥æµ…å‡ºåœ°è§£æäº†SQLAlchemyçš„æ ¸å¿ƒåŸç†ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„SQLiteæ“ä½œå®ä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•æ„å»ºé«˜æ•ˆã€å¥å£®çš„æ•°æ®åº“è¿æ¥ä¸å­˜å–æ–¹æ¡ˆã€‚é‡ç‚¹å‰–æäº†è¿æ¥æ± æœºåˆ¶ä¸ä¾èµ–æ³¨å…¥çš„æœ€ä½³å®è·µï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…å†™å‡ºæ€§èƒ½æ›´ä¼˜ã€æ›´æ˜“ç»´æŠ¤çš„Web APIã€‚\n    </div>\n<div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p>ä½ æ˜¯å¦ä¹Ÿæ›¾è¢«Web APIä¸­æ‚ä¹±æ— ç« çš„æ•°æ®åº“è¿æ¥ä»£ç æå¾—ç„¦å¤´çƒ‚é¢ï¼Ÿæ€§èƒ½ä¸Šä¸å»ï¼ŒBugå´ä¸å°‘ã€‚</p>\n<p>è¯•æƒ³åœ¨ä¸€ä¸ªä¸­å‹é¡¹ç›®ä¸­ï¼ŒåˆæœŸä¸ºäº†å›¾å¿«ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ–°å»ºæ•°æ®åº“è¿æ¥ï¼Œç»“æœåœ¨å¹¶å‘æµ‹è¯•æ—¶ï¼ŒAPIå“åº”æ—¶é—´ä»50msé£™å‡åˆ°2ç§’ä»¥ä¸Šï¼Œæ•°æ®åº“è¿æ¥æ•°ç¬é—´æ‰“æ»¡ï¼ŒæœåŠ¡ç›´æ¥é›ªå´©ã€‚è¿™ç»ä¸æ˜¯ä¸ªä¾‹ï¼Œ<strong style=\"color: rgba(186, 55, 42, 1);\">ä½æ•ˆçš„æ•°æ®åº“è¿æ¥ç®¡ç†ï¼Œæ˜¯Webåº”ç”¨ä¸­æœ€å¸¸è§å´ä¹Ÿæœ€å®¹æ˜“è¢«å¿½è§†çš„æ€§èƒ½æ€æ‰‹ä¹‹ä¸€ã€‚</strong></p>\n<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ä»¥FastAPI + SQLite + SQLAlchemyè¿™å¥—è½»é‡ä¸”å¼ºå¤§çš„ç»„åˆä¸ºä¾‹ï¼Œå½»åº•è®²æ¸…æ¥šå¦‚ä½•é«˜æ•ˆã€ä¼˜é›…åœ°æ“ä½œæ•°æ®åº“ã€‚</p>\n<h2>ğŸ¯ ä¸€ã€æ ¸å¿ƒå›°å¢ƒï¼šæˆ‘ä»¬åˆ°åº•åœ¨è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2>\n<p>åœ¨Webå¼€å‘ä¸­ï¼Œæ•°æ®åº“æ“ä½œçœ‹ä¼¼ç®€å•ï¼Œæ— éâ€œè¿æ¥ã€æ‰§è¡Œã€å…³é—­â€ã€‚ä½†ä¸€æ—¦æ”¾åˆ°é«˜å¹¶å‘ã€é•¿ç”Ÿå‘½å‘¨æœŸçš„WebæœåŠ¡å™¨ç¯å¢ƒä¸­ï¼Œé—®é¢˜å°±å¤æ‚äº†ï¼š</p>\n<div>\n<p>- ğŸ¢ <strong>æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šé¢‘ç¹åˆ›å»ºå’Œé”€æ¯æ•°æ®åº“è¿æ¥å¼€é”€å·¨å¤§ã€‚</p>\n<p>- ğŸ’¥ <strong>èµ„æºè€—å°½</strong>ï¼šè¿æ¥ä¸åŠæ—¶é‡Šæ”¾ï¼Œå¯¼è‡´è¿æ¥æ± è€—å°½ï¼ŒæœåŠ¡ä¸å¯ç”¨ã€‚</p>\n<p>- ğŸ¤¯ <strong>ä»£ç æ··ä¹±</strong>ï¼šä¸šåŠ¡é€»è¾‘å’Œæ•°æ®åº“è¿æ¥ä»£ç çº ç¼ ä¸æ¸…ï¼Œéš¾ä»¥ç»´æŠ¤å’Œæµ‹è¯•ã€‚</p>\n<p>- ğŸ”€ <strong>å¹¶å‘éšæ‚£</strong>ï¼šåœ¨å¤šçº¿ç¨‹/å¼‚æ­¥ç¯å¢ƒä¸‹ï¼Œè¿æ¥å…±äº«å¯èƒ½å¼•å‘æ•°æ®é”™ä¹±ã€‚</p>\n</div>\n<p>FastAPIçš„å¼‚æ­¥ç‰¹æ€§è®©äº‹æƒ…å˜å¾—æ›´â€œå¾®å¦™â€ã€‚ç›´æ¥ç”¨ä¼ ç»Ÿçš„åŒæ­¥æ•°æ®åº“é©±åŠ¨ï¼ˆå¦‚<code style=\"color: rgba(186, 55, 42, 1);\">sqlite3</code>æ¨¡å—ï¼‰ä¼šé˜»å¡æ•´ä¸ªäº‹ä»¶å¾ªç¯ï¼Œ<strong style=\"color: rgba(186, 55, 42, 1);\">å¼‚æ­¥ä¼˜åŠ¿è¡ç„¶æ— å­˜</strong>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ—¢èƒ½ç®¡ç†è¿æ¥ç”Ÿå‘½å‘¨æœŸï¼Œåˆèƒ½ä¸å¼‚æ­¥æ¡†æ¶å‹å¥½åä½œçš„è§£å†³æ–¹æ¡ˆã€‚</p>\n<h2>ğŸ§  äºŒã€åŸç†é€è§†ï¼šSQLAlchemyï¼Œä¸åªæ˜¯ORM</h2>\n<p>å¾ˆå¤šäººæŠŠSQLAlchemyç­‰åŒäºä¸€æ¬¾ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰å·¥å…·ã€‚è¿™æ²¡é”™ï¼Œä½†å®ƒçš„æ ¸å¿ƒä»·å€¼è¿œä¸æ­¢äºæ­¤ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ª<strong style=\"color: rgba(186, 55, 42, 1);\">å¼ºå¤§çš„â€œæ•°æ®åº“è¿æ¥ä¸æŸ¥è¯¢æ„å»ºå·¥å‚â€</strong>ã€‚</p>\n<p>æƒ³è±¡ä¸€ä¸‹é¤å…çš„åå¨ï¼š</p>\n<div>\n<p>- ğŸ› ï¸ <strong>å¼•æ“ï¼ˆEngineï¼‰</strong>ï¼šé¤å…çš„â€œä¸­å¤®å¨æˆ¿â€ã€‚å®ƒæ˜¯æ•°æ®åº“è¿æ¥çš„å·¥å‚å’Œè¿æ¥æ± çš„æŒæœ‰è€…ã€‚ä½ é…ç½®å¥½ä¸€æ¬¡ï¼ˆæ•°æ®åº“åœ°å€ã€è¿æ¥å‚æ•°ã€æ± å¤§å°ï¼‰ï¼Œæ•´ä¸ªåº”ç”¨éƒ½ä»è¿™é‡Œâ€œå–ç”¨â€è¿æ¥ã€‚å®ƒæ˜¯å…¨å±€çš„ã€é‡é‡çº§çš„ã€‚</p>\n<p>- ğŸ§¾ <strong>ä¼šè¯ï¼ˆSessionï¼‰</strong>ï¼šå¨å¸ˆæ‰‹ä¸­çš„â€œè®¢å•ç¯®â€ã€‚ä¸€ä¸ªSessionä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“æ“ä½œâ€œå·¥ä½œå•å…ƒâ€ã€‚å®ƒä»Engineè·å–ä¸€ä¸ªç‰©ç†è¿æ¥ï¼Œç®¡ç†ä¸€ç³»åˆ—ç›¸å…³çš„å¢åˆ æ”¹æŸ¥ï¼Œå¹¶åœ¨å®Œæˆåâ€œå½’è¿˜â€è¿æ¥ã€‚å®ƒæ˜¯å±€éƒ¨çš„ã€è½»é‡çº§çš„ï¼Œ<strong style=\"color: rgba(186, 55, 42, 1);\">å¹¶ä¸”ç»å¯¹ä¸åº”è¯¥è·¨è¯·æ±‚å…±äº«</strong>ã€‚</p>\n<p>- ğŸ <strong>ORMï¼ˆDeclarative Baseï¼‰</strong>ï¼šæ ‡å‡†åŒ–çš„â€œèœè°±â€ã€‚å®ƒå®šä¹‰äº†æ•°æ®æ¨¡å‹ï¼ˆè¡¨ç»“æ„ï¼‰å’Œä¸šåŠ¡å¯¹è±¡ï¼ˆPythonç±»ï¼‰çš„æ˜ å°„å…³ç³»ï¼Œè®©ä½ èƒ½ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼æ“ä½œæ•°æ®åº“ã€‚</p>\n</div>\n<p><strong style=\"color: rgba(186, 55, 42, 1);\">å…³é”®ç»“è®ºï¼šé«˜æ€§èƒ½å­˜å–çš„æ ¸å¿ƒï¼Œåœ¨äºæ­£ç¡®ç®¡ç†Engineå’ŒSessionçš„ç”Ÿå‘½å‘¨æœŸã€‚</strong> Engineé€šå¸¸åº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºï¼Œå…³é—­æ—¶é”€æ¯ã€‚è€ŒSessionå¿…é¡»<strong style=\"color: rgba(186, 55, 42, 1);\">â€œå³ç”¨å³åˆ›ï¼Œç”¨å®Œå³å…³â€</strong>ï¼Œä¸”æ¯ä¸ªè¯·æ±‚ç‹¬ç«‹ã€‚</p>\n<h2>âš™ï¸ ä¸‰ã€å®æˆ˜æ¼”ç»ƒï¼šä¸‰æ­¥æ„å»ºé«˜æ•ˆæ•°æ®å±‚</h2>\n<p>ç†è®ºè¯´å†å¤šï¼Œä¸å¦‚ä»£ç æ¥å¾—å®åœ¨ã€‚ä¸‹é¢æˆ‘ä»¬ä¸€æ­¥æ­¥æ­å»ºä¸€ä¸ªå¯ç”¨çš„æ¡†æ¶ã€‚</p>\n<h3>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ ¸å¿ƒå¼•æ“ä¸æ¨¡å‹</h3>\n<p>æˆ‘ä»¬å…ˆåˆ›å»ºæ•°æ®åº“è¿æ¥çš„æ ¸å¿ƒï¼ˆEngineï¼‰å’Œæ•°æ®æ¨¡å‹çš„åŸºç±»ã€‚</p>\n<pre class=\"highlighter-hljs\" style=\"background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px;\"><code># database.py\nfrom sqlalchemy import create_engine\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker\nimport os\n\n# å®šä¹‰æ•°æ®åº“æ–‡ä»¶è·¯å¾„\nSQLALCHEMY_DATABASE_URL = f\"sqlite:///./test.db\"\n\n# åˆ›å»ºå¼•æ“ (æ ¸å¿ƒ)\n# `connect_args={\"check_same_thread\": False}` å¯¹äºSQLiteå¤šçº¿ç¨‹æ˜¯å¿…é¡»çš„\n# `echo=True` å¼€å‘æ—¶å¼€å¯ï¼Œå¯ä»¥æŸ¥çœ‹ç”Ÿæˆçš„SQLï¼Œç”Ÿäº§ç¯å¢ƒè¯·å…³é—­\n# `pool_pre_ping=True` è¿æ¥æ± å–å‡ºè¿æ¥å‰è¿›è¡Œå¥åº·æ£€æŸ¥ï¼Œé¿å…ä½¿ç”¨å¤±æ•ˆè¿æ¥\nengine = create_engine(\n    SQLALCHEMY_DATABASE_URL,\n    connect_args={\"check_same_thread\": False},\n    echo=False, # ç”Ÿäº§ç¯å¢ƒè®¾ä¸ºFalse\n    pool_pre_ping=True,\n    pool_size=5, # è¿æ¥æ± å¤§å°\n    max_overflow=10 # å…è®¸è¶…å‡ºpool_sizeçš„ä¸´æ—¶è¿æ¥æ•°\n)\n\n# åˆ›å»ºä¼šè¯å·¥å‚ï¼Œç»‘å®šåˆ°å¼•æ“\n# `autocommit=False, autoflush=False` æ˜¯æ¨èè®¾ç½®ï¼Œä¾¿äºäº‹åŠ¡æ§åˆ¶\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\n\n# å£°æ˜æ€§åŸºç±»ï¼Œæ‰€æœ‰æ¨¡å‹ç±»éƒ½å°†ç»§æ‰¿è‡ªæ­¤\nBase = declarative_base()</code></pre>\n<h3>ç¬¬äºŒæ­¥ï¼šå®šä¹‰æ•°æ®æ¨¡å‹ä¸ä¾èµ–æ³¨å…¥</h3>\n<p>æ¥ç€ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç”¨æˆ·æ¨¡å‹ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªè·å–æ•°æ®åº“ä¼šè¯çš„FastAPIä¾èµ–é¡¹ã€‚è¿™æ˜¯å®ç°â€œ<span style=\"color: rgba(186, 55, 42, 1);\">è¯·æ±‚çº§åˆ«Session</span>â€çš„å…³é”®ï¼</p>\n<pre class=\"highlighter-hljs\" style=\"background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px;\"><code># models.py\nfrom sqlalchemy import Column, Integer, String\nfrom database import Base\n\nclass User(Base):\n    __tablename__ = \"users\"\n    id = Column(Integer, primary_key=True, index=True)\n    username = Column(String, unique=True, index=True, nullable=False)\n    email = Column(String, unique=True, index=True)\n\n# åˆ›å»ºè¡¨ï¼ˆé€šå¸¸åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ä¸€æ¬¡ï¼‰\n# Base.metadata.create_all(bind=engine)\n\n# dependencies.py\nfrom database import SessionLocal\nfrom fastapi import Depends\nfrom typing import Generator\n\ndef get_db() -&gt; Generator:\n    \"\"\"\n    æ•°æ®åº“ä¼šè¯ä¾èµ–é¡¹ã€‚\n    æ¯ä¸ªè¯·æ±‚è·å–ä¸€ä¸ªç‹¬ç«‹Sessionï¼Œè¯·æ±‚ç»“æŸåç¡®ä¿å…³é—­ã€‚\n    \"\"\"\n    db = SessionLocal()\n    try:\n        yield db # å°†dbæ³¨å…¥åˆ°è·¯ç”±å‡½æ•°ä¸­\n    finally:\n        db.close() # æ— è®ºè¯·æ±‚æˆåŠŸä¸å¦ï¼Œæœ€ç»ˆéƒ½ä¼šå…³é—­ä¼šè¯</code></pre>\n<h3>ç¬¬ä¸‰æ­¥ï¼šåœ¨è·¯ç”±ä¸­å®ç°CRUD</h3>\n<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨APIè·¯ç”±ä¸­æ„‰å¿«åœ°ä½¿ç”¨æ•°æ®åº“äº†ã€‚æ³¨æ„çœ‹<code style=\"color: rgba(186, 55, 42, 1);\">db: Session = Depends(get_db)</code>è¿™è¡Œé­”æ³•ã€‚</p>\n<pre class=\"highlighter-hljs\" style=\"background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px;\"><code># main.py\nfrom fastapi import FastAPI, Depends, HTTPException\nfrom sqlalchemy.orm import Session\nfrom pydantic import BaseModel\nfrom typing import List\nfrom models import User\nfrom dependencies import get_db\n\napp = FastAPI()\n\n# Pydanticæ¨¡å‹ï¼Œç”¨äºè¯·æ±‚/å“åº”éªŒè¯\nclass UserCreate(BaseModel):\n    username: str\n    email: str\n\nclass UserResponse(BaseModel):\n    id: int\n    username: str\n    email: str\n\n    class Config:\n        orm_mode = True # å…è®¸ä»ORMå¯¹è±¡è½¬æ¢\n\n@app.post(\"/users/\", response_model=UserResponse)\ndef create_user(user: UserCreate, db: Session = Depends(get_db)):\n    # æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨\n    db_user = db.query(User).filter(User.username == user.username).first()\n    if db_user:\n        raise HTTPException(status_code=400, detail=\"Username already registered\")\n    # åˆ›å»ºORMå¯¹è±¡\n    db_user = User(username=user.username, email=user.email)\n    # æ·»åŠ åˆ°ä¼šè¯\n    db.add(db_user)\n    # æäº¤äº‹åŠ¡\n    db.commit()\n    # åˆ·æ–°ï¼Œä½¿å¯¹è±¡è·å¾—æ•°æ®åº“ç”Ÿæˆçš„IDç­‰æ•°æ®\n    db.refresh(db_user)\n    return db_user\n\n@app.get(\"/users/\", response_model=List[UserResponse])\ndef read_users(skip: int = 0, limit: int = 10, db: Session = Depends(get_db)):\n    users = db.query(User).offset(skip).limit(limit).all()\n    return users</code></pre>\n<h2>ğŸš¨ å››ã€æ³¨æ„äº‹é¡¹ä¸è¿›é˜¶æ€è€ƒ</h2>\n<p>æ­å–œä½ ï¼Œä¸€ä¸ªç»“æ„æ¸…æ™°ã€è¿æ¥é«˜æ•ˆçš„æ•°æ®å±‚å·²ç»æ­å»ºå®Œæˆã€‚ä½†åœ¨æŠ•å…¥ç”Ÿäº§å‰ï¼Œè¯·åŠ¡å¿…ç•™æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>\n<div>\n<p>1. <strong style=\"color: rgba(186, 55, 42, 1);\">è¿æ¥æ± é…ç½®æ˜¯è‰ºæœ¯</strong>ï¼š<code style=\"color: rgba(186, 55, 42, 1);\">pool_size</code>å’Œ<code style=\"color: rgba(186, 55, 42, 1);\">max_overflow</code>æ²¡æœ‰é“¶å¼¹ã€‚è®¾ç½®å¤ªå°ï¼Œé«˜å¹¶å‘æ—¶è¯·æ±‚æ’é˜Ÿï¼›è®¾ç½®å¤ªå¤§ï¼Œæµªè´¹èµ„æºç”šè‡³æ‹–å®æ•°æ®åº“ã€‚éœ€è¦æ ¹æ®å®é™…è´Ÿè½½å‹åŠ›æµ‹è¯•è°ƒæ•´ã€‚</p>\n<p>2. <strong style=\"color: rgba(186, 55, 42, 1);\">Sessionçš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚ä¸€ä¸ªå¤æ‚çš„ä¸šåŠ¡æ“ä½œåº”è¯¥åœ¨åŒä¸€ä¸ªSessionä¸­å®Œæˆï¼Œä»¥ä¿è¯äº‹åŠ¡ä¸€è‡´æ€§ã€‚ä¸è¦åœ¨ä¸åŒè¯·æ±‚é—´å…±äº«Sessionã€‚</p>\n<p>3. <strong style=\"color: rgba(186, 55, 42, 1);\">å¼‚æ­¥æ•°æ®åº“é©±åŠ¨</strong>ï¼šå¯¹äºè¿½æ±‚æè‡´æ€§èƒ½æˆ–åŸç”Ÿå¼‚æ­¥æ•°æ®åº“ï¼ˆå¦‚PostgreSQLï¼‰ï¼Œè€ƒè™‘ä½¿ç”¨<code style=\"color: rgba(186, 55, 42, 1);\">asyncpg</code> + <code style=\"color: rgba(186, 55, 42, 1);\">SQLAlchemy 1.4+</code>çš„å¼‚æ­¥æ¨¡å¼ã€‚è¿™æ—¶ï¼ŒEngineå’ŒSessionéƒ½éœ€è¦æ¢æˆå¼‚æ­¥ç‰ˆæœ¬ï¼ˆ<code style=\"color: rgba(186, 55, 42, 1);\">AsyncEngine</code>, <code style=\"color: rgba(186, 55, 42, 1);\">AsyncSession</code>ï¼‰ï¼Œä¾èµ–é¡¹ä¹Ÿè¦ç”¨<code style=\"color: rgba(186, 55, 42, 1);\">async with</code>ç®¡ç†ã€‚</p>\n<p>4. <strong style=\"color: rgba(186, 55, 42, 1);\">ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨SQLite</strong>ï¼ˆé™¤éæ˜¯æå°è§„æ¨¡åº”ç”¨ï¼‰ã€‚SQLiteåœ¨é«˜å¹¶å‘å†™å…¥ã€åˆ†å¸ƒå¼éƒ¨ç½²æ–¹é¢æœ‰å¤©ç„¶é™åˆ¶ã€‚å®ƒéå¸¸é€‚åˆåŸå‹å¼€å‘ã€æµ‹è¯•å’Œå°å‹åªè¯»åº”ç”¨ã€‚</p>\n</div>\n<p>å‡åä¸€ä¸‹ï¼š<strong style=\"color: rgba(186, 55, 42, 1);\">æˆ‘ä»¬å€ŸåŠ©SQLAlchemyï¼Œä¸ä»…ä»…æ˜¯å†™æ›´å°‘çš„SQLï¼Œæ›´æ˜¯å¼•å…¥äº†ä¸€å¥—æˆç†Ÿã€å¯æ§çš„æ•°æ®åº“è®¿é—®æ¨¡å¼ã€‚</strong>å®ƒå°†ä½çº§çš„è¿æ¥ç®¡ç†ã€äº‹åŠ¡æ§åˆ¶æŠ½è±¡å‡ºæ¥ï¼Œè®©æˆ‘ä»¬èƒ½æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘æœ¬èº«ã€‚è€ŒFastAPIçš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿï¼Œå®Œç¾åœ°å°†è¿™å¥—æ¨¡å¼æ•´åˆåˆ°è¯·æ±‚ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå®ç°äº†èµ„æºç®¡ç†çš„è‡ªåŠ¨åŒ–ä¸ä¼˜é›…åŒ–ã€‚</p>\n<hr />\n<p style=\"text-align: center;\">---<strong>å†™åœ¨æœ€å</strong>---<br />å¸Œæœ›è¿™ä»½æ€»ç»“èƒ½å¸®ä½ é¿å¼€ä¸€äº›å‘ã€‚å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œä¸å¦¨ç‚¹ä¸ª èµğŸ‘ æˆ– æ”¶è—â­ æ ‡è®°ä¸€ä¸‹ï¼Œæ–¹ä¾¿éšæ—¶å›é¡¾ã€‚ä¹Ÿæ¬¢è¿å…³æ³¨æˆ‘ï¼Œåç»­ä¸ºä½ å¸¦æ¥æ›´å¤šç±»ä¼¼çš„å®æˆ˜è§£æã€‚æœ‰ä»»ä½•ç–‘é—®æˆ–æƒ³æ³•ï¼Œæˆ‘ä»¬è¯„è®ºåŒºè§ï¼Œä¸€èµ·äº¤æµå¼€å‘ä¸­çš„å„ç§å¿ƒå¾—ä¸é—®é¢˜ã€‚</p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 11:13</span>&nbsp;\n<a href=\"https://www.cnblogs.com/ymtianyu\">ä¸€åç¨‹åºåª›å‘€</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">92</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "æ–°çš„ä¸€å¹´ï¼Œå†™ç»™åšå®¢å›­çš„å¤§å®¶ï¼Œä¹Ÿå†™ç»™è‡ªå·±",
      "link": "https://www.cnblogs.com/zxlh1529/p/19480754",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/zxlh1529/p/19480754\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 11:12\">\n    <span>æ–°çš„ä¸€å¹´ï¼Œå†™ç»™åšå®¢å›­çš„å¤§å®¶ï¼Œä¹Ÿå†™ç»™è‡ªå·±</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>2026 å¹´ï¼Œå·²ç»è¿‡å»åŠä¸ªæœˆï¼Œæœ¬æ¥å¹´å‰å¹´åæƒ³æ‰¾ä¸€äº›æŠ€æœ¯ç‚¹æ¥ä½œä¸ºé¦–ç¯‡å‘è¡¨ï¼Œåé¢çœ‹äº†çœ‹ï¼Œæƒ³äº†æƒ³ï¼Œæ²¡æ‰¾åˆ°å¥½çš„ç‚¹ï¼Œå½“ç„¶è¿™ä¹Ÿæœ‰å› ä¸ºæˆ‘çš„æŠ€æœ¯èƒ½åŠ›é—®é¢˜ï¼Œæ·±çš„è°ˆä¸äº†ï¼Œæµ…çš„åˆè§‰å¾—åš¼ä¹‹æ— å‘³ï¼Œå·²ç»æœ‰å¤ªå¤šå¤§ä½¬å‘äº†ï¼Œå¾ˆå¤šå†æ·±æŒ–å°±å¾—å›å½’å»è¯´ 0110 äº†ã€‚</p>\n<p>æ–°å¹´åˆšå¼€å§‹ï¼Œæ—¶é—´çº¿å·²ç»è¢«å„ç§é¢„æµ‹å æ»¡äº†ã€‚é©¬æ–¯å…‹å››å¤§é¢„è¨€ï¼Œé»„é‡‘ä¸Šæ¶¨çš„é¢„æµ‹ï¼ˆå¸Œæœ›è¯„è®ºåŒºå¤§ä½¬è·Ÿæˆ‘è¯´å•¥æ—¶å€™ä¼šæ‰ï¼‰ã€‚</p>\n<p>æœ‰äººé¢„æµ‹æŠ€æœ¯è¶‹åŠ¿ï¼Œæœ‰äººé¢„æµ‹è¡Œä¸šèµ°å‘ï¼Œä¹Ÿæœ‰äººè¯•å›¾ç”¨å‡ å¥è¯å‹¾å‹’å‡ºæœªæ¥å‡ å¹´çš„ç­”æ¡ˆã€‚é¢„æµ‹æœ¬èº«å¹¶ä¸ç½•è§ï¼Œç”šè‡³å·²ç»æˆäº†ä¸€ç§â€œæ–°å¹´ä»ªå¼â€ã€‚</p>\n<p>ä½†æˆ‘æƒ³åœ¨æ–°å¹´çš„ç¬¬ä¸€ç¯‡åšå®¢é‡Œï¼Œåˆ»æ„ä¸è°ˆè¿™äº›ï¼Œéšä¾¿è¯´è¯´ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡ä¸å†™æŠ€æœ¯äº†ï¼Œä»¥å‰åœ¨å­¦æ ¡å¤§ä¸€è¿˜ä¸“é—¨æäº†ä¸ªå…¬ä¼—å·å†™æƒ…æ„Ÿç±»çš„å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆğŸ˜€ã€‚</p>\n<hr />\n<h2 id=\"å…³äºèŠ‚å¥\">å…³äºèŠ‚å¥</h2>\n<p>è¿‡å»ä¸€å¹´ï¼Œæˆ‘æ˜æ˜¾æ„Ÿå—åˆ°ä¸€ç§å˜åŒ–ï¼š<br />\nä¿¡æ¯åœ¨åŠ é€Ÿï¼Œè§‚ç‚¹åœ¨å‹ç¼©ï¼Œç»“è®ºåœ¨å‰ç½®ã€‚</p>\n<p>å¾ˆå¤šå†…å®¹å·²ç»ä¸å†è¯•å›¾â€œè§£é‡Šâ€ï¼Œè€Œæ˜¯ç›´æ¥ç»™å‡ºæ€åº¦ï¼›<br />\n<strong>ä¸å†è®¨è®ºè¿‡ç¨‹ï¼Œè€Œæ˜¯åªä¿ç•™ç»“æœã€‚</strong></p>\n<p>åœ¨è¿™æ ·çš„ç¯å¢ƒä¸‹ï¼Œæ…¢ä¸‹æ¥åè€Œæˆäº†ä¸€ç§éœ€è¦åˆ»æ„åšæŒçš„é€‰æ‹©ã€‚</p>\n<p>å†™åšå®¢ä¹Ÿæ˜¯ã€‚<br />\nå®ƒä¸æ˜¯æœ€å¿«çš„è¡¨è¾¾æ–¹å¼ï¼Œä¹Ÿä¸æ˜¯æœ€å®¹æ˜“è·å¾—åé¦ˆçš„æ–¹å¼ï¼Œä½†å®ƒè®©æˆ‘ä¿ç•™äº†ä¸€ç‚¹<strong>å®Œæ•´æ€è€ƒçš„èŠ‚å¥</strong>â€”â€”è€Œä¸æ˜¯è¢«æ¨ç€èµ°ã€‚</p>\n<hr />\n<h2 id=\"å…³äºä¸ç¡®å®šæ€§\">å…³äºä¸ç¡®å®šæ€§</h2>\n<p>é¢„æµ‹æµè¡Œï¼Œæœ¬è´¨ä¸Šæ˜¯æˆ‘ä»¬å¯¹ä¸ç¡®å®šæ€§çš„æŠ—æ‹’ã€‚</p>\n<p>ä½†æ¯•ä¸šåè¿™ä¸€å¹´å¤šå·¥ä½œä¹‹åè®©æˆ‘è¶Šæ¥è¶Šæ¸…æ¥šï¼š<br />\n<strong>ä¸ç¡®å®šæ€§ä¸æ˜¯é—®é¢˜æœ¬èº«ï¼Œå®ƒæ˜¯ç¯å¢ƒçš„å¸¸æ€ã€‚</strong></p>\n<p>çœŸæ­£æœ‰ä»·å€¼çš„èƒ½åŠ›ï¼Œå¹¶ä¸æ˜¯â€œçŒœå¯¹æœªæ¥â€ï¼Œè€Œæ˜¯ï¼š</p>\n<ul>\n<li>å½“å‡è®¾å¤±æ•ˆæ—¶ï¼Œèƒ½å¦åŠæ—¶è°ƒæ•´</li>\n<li>å½“è·¯å¾„å˜åŒ–æ—¶ï¼Œæ˜¯å¦ä»ç„¶å…·å¤‡é€‰æ‹©ç©ºé—´</li>\n<li>å½“ç­”æ¡ˆä¸å­˜åœ¨æ—¶ï¼Œæ˜¯å¦è¿˜èƒ½ç»§ç»­å‰è¿›</li>\n</ul>\n<p>æŠ€æœ¯æ ˆä¼šå˜ï¼Œæ¡†æ¶ä¼šå˜ï¼ŒèŒƒå¼ä¼šå˜ã€‚<br />\nä½†é¢å¯¹å˜åŒ–æ—¶çš„åˆ¤æ–­åŠ›å’Œä¿®æ­£èƒ½åŠ›ï¼Œå¾ˆå°‘è¢«è¶‹åŠ¿æœ¬èº«æ·˜æ±°ã€‚</p>\n<hr />\n<h2 id=\"å…³äºé•¿æœŸä¸»ä¹‰\">å…³äºé•¿æœŸä¸»ä¹‰</h2>\n<p>å¦‚æœè¯´æœ‰ä»€ä¹ˆä¸œè¥¿åœ¨æŠ€æœ¯ä¸–ç•Œé‡Œå˜å¾—è¶Šæ¥è¶Šç¨€ç¼ºï¼Œé‚£ä¸€å®šä¸æ˜¯ä¿¡æ¯ï¼Œè€Œæ˜¯<strong>æŒç»­æ€§</strong>ã€‚</p>\n<p>æŒç»­å­¦ä¹ ä¸éš¾ï¼ŒæŒç»­è¾“å‡ºä¸éš¾ï¼Œ<br />\néš¾çš„æ˜¯åœ¨æ²¡æœ‰æŒå£°ã€æ²¡æœ‰çƒ­ç‚¹ã€æ²¡æœ‰â€œæ­£ç¡®ç­”æ¡ˆâ€çš„æƒ…å†µä¸‹ï¼Œä¾ç„¶æ„¿æ„ç»§ç»­ã€‚</p>\n<p>å†™åšå®¢å¯¹æˆ‘æ¥è¯´ï¼Œæ›´åƒæ˜¯ä¸€ç§é•¿æœŸè¡Œä¸ºï¼š</p>\n<ul>\n<li>ä¸è¿½çƒ­ç‚¹</li>\n<li>ä¸åˆ»æ„åˆ¶é€ ç»“è®º</li>\n<li>ä¸æ€¥ç€è¯æ˜ä»€ä¹ˆ</li>\n</ul>\n<p>å‡ å¹´åå†å›å¤´çœ‹ï¼Œå®ƒå¯èƒ½å¹¶ä¸èƒ½è¯´æ˜æˆ‘â€œå¤šå…ˆè¿›â€ï¼Œä½†è‡³å°‘èƒ½è¯æ˜æˆ‘<strong>æ²¡æœ‰å®Œå…¨è¢«çŸ­æœŸå™ªå£°å¸¦èµ°</strong>ï¼Œä¹Ÿæ˜¯æˆ‘å­¦ä¹ çš„ç•™ç—•ï¼Œå›è¿‡å¤´èƒ½å¤Ÿæ„Ÿæ¦‚å˜²ç¬‘ä¸€ä¸‹æ­¤æ—¶çš„æˆ‘ã€‚</p>\n<hr />\n<h2 id=\"å…³äºè¾¹ç•Œ\">å…³äºè¾¹ç•Œ</h2>\n<p>æŠ€æœ¯å¾ˆé‡è¦ï¼Œä½†æŠ€æœ¯ä¸æ˜¯å…¨éƒ¨ã€‚</p>\n<p>å½“æ‰€æœ‰é—®é¢˜éƒ½è¢«åŒ…è£…æˆâ€œæ•ˆç‡é—®é¢˜â€â€œæˆé•¿é—®é¢˜â€â€œè·¯çº¿é€‰æ‹©é—®é¢˜â€æ—¶ï¼Œåè€Œå®¹æ˜“å¿½ç•¥ä¸€äº›æ›´åŸºç¡€çš„ä¸œè¥¿ï¼š</p>\n<ul>\n<li>ä½ æ˜¯å¦è¿˜èƒ½ä¿æŒä¸“æ³¨</li>\n<li>ä½ æ˜¯å¦è¿˜èƒ½äº«å—è§£å†³é—®é¢˜çš„è¿‡ç¨‹</li>\n<li>ä½ æ˜¯å¦è¿˜çŸ¥é“è‡ªå·±ä¸ºä»€ä¹ˆèµ°åœ¨è¿™æ¡è·¯ä¸Š</li>\n<li>ä½ æ˜¯å¦è¿˜çƒ­çˆ±ç”Ÿæ´»</li>\n</ul>\n<p>ç»™æŠ€æœ¯ç•™è¾¹ç•Œï¼Œå…¶å®ä¹Ÿæ˜¯åœ¨ç»™è‡ªå·±ç•™ç©ºé—´ã€‚</p>\n<hr />\n<h2 id=\"æœ€å\">æœ€å</h2>\n<p>è¿™å››ä¸ªå…³äºä¸ä¼šç»™å‡ºç­”æ¡ˆï¼Œä¹Ÿæ²¡æœ‰å›ºå®šç­”æ¡ˆï¼Œç¯‡å¹…å¾ˆçŸ­ï¼Œäººç”Ÿå¾ˆé•¿ï¼Œå¹¶ä¸èƒ½å¯¥å¯¥æ¦‚æ‹¬ã€‚</p>\n<p>å®ƒæ›´åƒæ˜¯ä¸€æ¬¡åˆ»æ„çš„åœé¡¿ã€‚</p>\n<p>æ–°çš„ä¸€å¹´ï¼Œæˆ‘ä¾ç„¶ä¼šå†™ä»£ç ã€å†™æ¶æ„ã€å†™å·¥ç¨‹å®è·µã€å†™ç”Ÿæ´»ã€å†™æ„Ÿæ‚Ÿï¼›<br />\nä½†åœ¨è¿™äº›ä¹‹å‰ï¼Œæˆ‘å¸Œæœ›è‡ªå·±èƒ½è®°ä½ï¼š</p>\n<ul>\n<li>èŠ‚å¥æ¯”é€Ÿåº¦é‡è¦</li>\n<li>é€‚åº”æ¯”é¢„æµ‹é‡è¦</li>\n<li>æŒç»­æ¯”çˆ†å‘é‡è¦</li>\n<li>è¾¹ç•Œæ¯”æ— é™æ‰©å¼ é‡è¦</li>\n</ul>\n<p>æ–°å¹´ç¬¬ä¸€ç¯‡ï¼Œå†™ç»™è‡ªå·±ï¼Œä¹Ÿå†™ç»™ä»ç„¶æ„¿æ„æ…¢æ…¢è¯»å®Œæ¯ä¸€ç¯‡åšå®¢çš„äººã€‚</p>\n<p>å¸Œæœ›æ¥ä¸‹æ¥çš„ä½ ï¼Œçƒ­çˆ±æŠ€æœ¯ï¼Œä¹Ÿçƒ­çˆ±ç”Ÿæ´»ï¼Œçƒ­çˆ±è¿‡å¾€çš„ä½ ï¼Œç°åœ¨çš„ä½ ï¼Œæœªæ¥çš„ä½ ï¼Œä¸ç®¡å‘ç”Ÿä»€ä¹ˆã€‚</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 11:12</span>&nbsp;\n<a href=\"https://www.cnblogs.com/zxlh1529\">å¹¼å„¿å›­æŠ€æœ¯å®¶</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">635</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">2</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "å·¥ä½œä¸­æœ€å¸¸ç”¨çš„5ç§æœ¬åœ°ç¼“å­˜",
      "link": "https://www.cnblogs.com/12lisu/p/19480472",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/12lisu/p/19480472\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 09:55\">\n    <span>å·¥ä½œä¸­æœ€å¸¸ç”¨çš„5ç§æœ¬åœ°ç¼“å­˜</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h2 id=\"å‰è¨€\">å‰è¨€</h2>\n<p>ä»Šå¤©å’Œå¤§å®¶èŠèŠä¸€ä¸ªå‡ ä¹æ‰€æœ‰Javaå¼€å‘è€…éƒ½ä¼šç”¨åˆ°ï¼Œä½†å¾ˆå¤šäººå¯¹å…¶ç†è§£ä¸å¤Ÿæ·±å…¥çš„æŠ€æœ¯â€”â€”<strong>æœ¬åœ°ç¼“å­˜</strong>ã€‚</p>\n<p>æœ‰äº›å°ä¼™ä¼´åœ¨å·¥ä½œä¸­å¯èƒ½é‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯ï¼šç³»ç»Ÿæ€§èƒ½æµ‹è¯•æ—¶ï¼Œå‘ç°æŸä¸ªæ¥å£å“åº”æ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œä¸€æŸ¥å‘ç°æ˜¯æ•°æ®åº“æŸ¥è¯¢å¤ªé¢‘ç¹ã€‚</p>\n<p>åŠ äº†Redisåˆ†å¸ƒå¼ç¼“å­˜åæœ‰æ‰€æ”¹å–„ï¼Œä½†ç½‘ç»œIOçš„å¼€é”€ä¾ç„¶å­˜åœ¨ï¼Œç‰¹åˆ«æ˜¯å¯¹æ—¶æ•ˆæ€§è¦æ±‚é«˜çš„æ•°æ®ã€‚</p>\n<p>è¿™æ—¶å€™ï¼Œæœ¬åœ°ç¼“å­˜çš„ä»·å€¼å°±å‡¸æ˜¾å‡ºæ¥äº†ã€‚</p>\n<p>æœ¬åœ°ç¼“å­˜æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<p>ç®€å•è¯´å°±æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨<strong>åº”ç”¨è¿›ç¨‹çš„å†…å­˜ä¸­</strong>ï¼Œå®ç°æ•°æ®çš„å¿«é€Ÿè®¿é—®ã€‚</p>\n<p>å®ƒçš„è®¿é—®é€Ÿåº¦é€šå¸¸æ˜¯çº³ç§’çº§ï¼Œè€Œåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¦‚Redisï¼‰æ˜¯æ¯«ç§’çº§ï¼Œæ•°æ®åº“æŸ¥è¯¢æ›´æ˜¯æ¯«ç§’åˆ°ç§’çº§ã€‚</p>\n<h2 id=\"01-ä¸ºä»€ä¹ˆéœ€è¦æœ¬åœ°ç¼“å­˜\">01 ä¸ºä»€ä¹ˆéœ€è¦æœ¬åœ°ç¼“å­˜ï¼Ÿ</h2>\n<p>åœ¨æ·±å…¥å…·ä½“æ–¹æ¡ˆå‰ï¼Œæˆ‘ä»¬å…ˆææ¸…æ¥šæœ¬åœ°ç¼“å­˜çš„æ ¸å¿ƒä»·å€¼ã€‚</p>\n<p>æ¥çœ‹ä¸€ä¸ªæ²¡æœ‰ç¼“å­˜çš„åœºæ™¯ï¼š</p>\n<pre><code class=\"language-java\">// æ²¡æœ‰ç¼“å­˜çš„ç”¨æˆ·æŸ¥è¯¢æœåŠ¡\n@Service\npublic class CategoryServiceWithoutCache {\n    \n    @Autowired\n    private CategoryMapper categoryMapper;\n    \n    public Category getCategoryById(Long categoryId) {\n        // æ¯æ¬¡è°ƒç”¨éƒ½ç›´æ¥æŸ¥è¯¢æ•°æ®åº“\n        return categoryMapper.selectById(categoryId);\n    }\n    \n    // å‡è®¾è¿™ä¸ªæ¥å£æ¯ç§’è¢«è°ƒç”¨1000æ¬¡\n    // æ•°æ®åº“å°±è¦æ‰¿å—1000QPSçš„å‹åŠ›\n}\n</code></pre>\n<p>è¿™ç§è®¾è®¡çš„é—®é¢˜å¾ˆæ˜æ˜¾ï¼š</p>\n<ol>\n<li><strong>æ•°æ®åº“å‹åŠ›å¤§</strong>ï¼šæ¯æ¬¡è¯·æ±‚éƒ½è¦æŸ¥è¯¢æ•°æ®åº“</li>\n<li><strong>å“åº”æ—¶é—´é•¿</strong>ï¼šæ•°æ®åº“æŸ¥è¯¢é€šå¸¸éœ€è¦å‡ æ¯«ç§’åˆ°å‡ åæ¯«ç§’</li>\n<li><strong>ç³»ç»Ÿå¯æ‰©å±•æ€§å·®</strong>ï¼šæ•°æ®åº“æˆä¸ºå•ç‚¹ç“¶é¢ˆ</li>\n</ol>\n<p>å¼•å…¥æœ¬åœ°ç¼“å­˜åï¼Œæƒ…å†µä¼šå¤§å¤§æ”¹å–„ï¼š</p>\n<pre><code class=\"language-java\">// ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„ç”¨æˆ·æŸ¥è¯¢æœåŠ¡\n@Service\npublic class CategoryServiceWithCache {\n    \n    @Autowired\n    private CategoryMapper categoryMapper;\n    \n    // ä½¿ç”¨ConcurrentHashMapä½œä¸ºæœ¬åœ°ç¼“å­˜\n    private final Map&lt;Long, Category&gt; categoryCache = new ConcurrentHashMap&lt;&gt;();\n    \n    public Category getCategoryById(Long categoryId) {\n        // 1. å…ˆæŸ¥ç¼“å­˜\n        Category category = categoryCache.get(categoryId);\n        if (category != null) {\n            return category;  // ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›\n        }\n        \n        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“\n        category = categoryMapper.selectById(categoryId);\n        if (category != null) {\n            // 3. å°†æ•°æ®æ”¾å…¥ç¼“å­˜\n            categoryCache.put(categoryId, category);\n        }\n        \n        return category;\n    }\n}\n</code></pre>\n<p>è¿™æ ·æ”¹é€ åï¼Œå¯¹äºåŒä¸€ä¸ªåˆ†ç±»çš„å¤šæ¬¡æŸ¥è¯¢ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ä¼šè®¿é—®æ•°æ®åº“ï¼Œåç»­æŸ¥è¯¢éƒ½ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼Œæ€§èƒ½æå‡å‡ ä¸ªæ•°é‡çº§ã€‚</p>\n<p>ä½†æ˜¯ï¼Œç®€å•çš„<code>ConcurrentHashMap</code>åªæ˜¯æœ¬åœ°ç¼“å­˜çš„æœ€åŸºç¡€å½¢æ€ã€‚</p>\n<p>åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘æ›´å¤šé—®é¢˜ï¼š<strong>å†…å­˜ç®¡ç†ã€è¿‡æœŸç­–ç•¥ã€ç¼“å­˜æ·˜æ±°ã€å¹¶å‘æ§åˆ¶</strong>ç­‰ã€‚</p>\n<p>è¿™å°±æ˜¯å„ç§æœ¬åœ°ç¼“å­˜æ¡†æ¶å­˜åœ¨çš„æ„ä¹‰ã€‚</p>\n<h2 id=\"02-æœ¬åœ°ç¼“å­˜æ ¸å¿ƒè¦ç´ \">02 æœ¬åœ°ç¼“å­˜æ ¸å¿ƒè¦ç´ </h2>\n<p>åœ¨ä»‹ç»å…·ä½“æ–¹æ¡ˆå‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªä¼˜ç§€æœ¬åœ°ç¼“å­˜åº”è¯¥å…·å¤‡çš„ç‰¹æ€§ï¼š</p>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n<p>ç†è§£äº†è¿™äº›æ ¸å¿ƒè¦ç´ ï¼Œæˆ‘ä»¬å°±èƒ½æ›´å¥½åœ°è¯„ä¼°å„ç§ç¼“å­˜æ–¹æ¡ˆã€‚</p>\n<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥åˆ†æ5ç§æœ€å¸¸ç”¨çš„æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆã€‚</p>\n<h2 id=\"03-æ–¹æ¡ˆä¸€concurrenthashmap\">03 æ–¹æ¡ˆä¸€ï¼šConcurrentHashMap</h2>\n<h3 id=\"åŸç†ä¸ç‰¹ç‚¹\">åŸç†ä¸ç‰¹ç‚¹</h3>\n<p><code>ConcurrentHashMap</code>æ˜¯JDKè‡ªå‘çš„çº¿ç¨‹å®‰å…¨çš„å“ˆå¸Œè¡¨ï¼Œå®ƒé€šè¿‡<strong>åˆ†æ®µé”</strong>æŠ€æœ¯å®ç°é«˜å¹¶å‘è®¿é—®ã€‚</p>\n<p>ä½œä¸ºç¼“å­˜ä½¿ç”¨æ—¶ï¼Œå®ƒæ˜¯æœ€ç®€å•ã€æœ€è½»é‡çº§çš„é€‰æ‹©ã€‚</p>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n<p><strong>æ ¸å¿ƒæœºåˆ¶</strong>ï¼š</p>\n<ul>\n<li><strong>åˆ†æ®µé”</strong>ï¼šå°†æ•´ä¸ªMapåˆ†æˆå¤šä¸ªSegmentï¼Œæ¯ä¸ªSegmentç‹¬ç«‹åŠ é”</li>\n<li><strong>å¹¶å‘åº¦</strong>ï¼šé»˜è®¤16ä¸ªSegmentï¼Œå¯æ”¯æŒ16ä¸ªçº¿ç¨‹å¹¶å‘å†™</li>\n<li><strong>Java 8ä¼˜åŒ–</strong>ï¼šåœ¨Java 8ä¸­æ”¹ä¸ºä½¿ç”¨<code>synchronized</code>+<code>CAS</code>+çº¢é»‘æ ‘ï¼Œæ€§èƒ½æ›´å¥½</li>\n</ul>\n<h3 id=\"å®æˆ˜ä»£ç ç¤ºä¾‹\">å®æˆ˜ä»£ç ç¤ºä¾‹</h3>\n<pre><code class=\"language-java\">import java.util.concurrent.*;\n\n/**\n * åŸºäºConcurrentHashMapçš„ç®€æ˜“æœ¬åœ°ç¼“å­˜\n * ç‰¹ç‚¹ï¼šç®€å•ã€è½»é‡ã€æ— è¿‡æœŸç­–ç•¥\n */\npublic class ConcurrentHashMapCache&lt;K, V&gt; {\n    \n    // æ ¸å¿ƒç¼“å­˜å­˜å‚¨\n    private final ConcurrentHashMap&lt;K, V&gt; cache;\n    \n    // å¯é€‰çš„ç¼“å­˜åŠ è½½å™¨\n    private final CacheLoader&lt;K, V&gt; loader;\n    \n    public ConcurrentHashMapCache() {\n        this.cache = new ConcurrentHashMap&lt;&gt;();\n        this.loader = null;\n    }\n    \n    public ConcurrentHashMapCache(CacheLoader&lt;K, V&gt; loader) {\n        this.cache = new ConcurrentHashMap&lt;&gt;();\n        this.loader = loader;\n    }\n    \n    /**\n     * è·å–ç¼“å­˜å€¼\n     * å¦‚æœä¸å­˜åœ¨ä¸”é…ç½®äº†loaderï¼Œåˆ™åŠ è½½æ•°æ®\n     */\n    public V get(K key) {\n        V value = cache.get(key);\n        \n        if (value == null &amp;&amp; loader != null) {\n            // åŒé‡æ£€æŸ¥é”ï¼Œé˜²æ­¢å¹¶å‘åŠ è½½\n            synchronized (this) {\n                value = cache.get(key);\n                if (value == null) {\n                    value = loader.load(key);\n                    if (value != null) {\n                        cache.put(key, value);\n                    }\n                }\n            }\n        }\n        \n        return value;\n    }\n    \n    /**\n     * æ”¾å…¥ç¼“å­˜\n     */\n    public void put(K key, V value) {\n        cache.put(key, value);\n    }\n    \n    /**\n     * ç§»é™¤ç¼“å­˜\n     */\n    public V remove(K key) {\n        return cache.remove(key);\n    }\n    \n    /**\n     * æ¸…ç©ºç¼“å­˜\n     */\n    public void clear() {\n        cache.clear();\n    }\n    \n    /**\n     * è·å–ç¼“å­˜å¤§å°\n     */\n    public int size() {\n        return cache.size();\n    }\n    \n    /**\n     * åˆ¤æ–­æ˜¯å¦åŒ…å«key\n     */\n    public boolean containsKey(K key) {\n        return cache.containsKey(key);\n    }\n    \n    /**\n     * ç¼“å­˜åŠ è½½å™¨æ¥å£\n     */\n    @FunctionalInterface\n    public interface CacheLoader&lt;K, V&gt; {\n        V load(K key);\n    }\n}\n\n/**\n * ä½¿ç”¨ç¤ºä¾‹ï¼šç”¨æˆ·ä¿¡æ¯ç¼“å­˜\n */\n@Service\npublic class UserServiceWithConcurrentHashMap {\n    \n    @Autowired\n    private UserMapper userMapper;\n    \n    // ä½¿ç”¨è‡ªå®šä¹‰çš„ConcurrentHashMapç¼“å­˜\n    private final ConcurrentHashMapCache&lt;Long, User&gt; userCache;\n    \n    public UserServiceWithConcurrentHashMap() {\n        // åˆå§‹åŒ–ç¼“å­˜ï¼Œé…ç½®ç¼“å­˜åŠ è½½å™¨\n        userCache = new ConcurrentHashMapCache&lt;&gt;(userId -&gt; {\n            // å½“ç¼“å­˜ä¸å­˜åœ¨æ—¶ï¼Œè°ƒç”¨æ­¤æ–¹æ³•åŠ è½½æ•°æ®\n            System.out.println(\"ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“åŠ è½½ç”¨æˆ·: \" + userId);\n            return userMapper.selectById(userId);\n        });\n    }\n    \n    /**\n     * è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆå¸¦ç¼“å­˜ï¼‰\n     */\n    public User getUserById(Long userId) {\n        return userCache.get(userId);\n    }\n    \n    /**\n     * æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆåŒæ—¶æ›´æ–°ç¼“å­˜ï¼‰\n     */\n    public void updateUser(User user) {\n        // 1. æ›´æ–°æ•°æ®åº“\n        userMapper.updateById(user);\n        \n        // 2. æ›´æ–°ç¼“å­˜\n        userCache.put(user.getId(), user);\n    }\n    \n    /**\n     * åˆ é™¤ç”¨æˆ·ï¼ˆåŒæ—¶åˆ é™¤ç¼“å­˜ï¼‰\n     */\n    public void deleteUser(Long userId) {\n        // 1. åˆ é™¤æ•°æ®åº“è®°å½•\n        userMapper.deleteById(userId);\n        \n        // 2. åˆ é™¤ç¼“å­˜\n        userCache.remove(userId);\n    }\n    \n    /**\n     * æ‰¹é‡è·å–ç”¨æˆ·ï¼ˆä¼˜åŒ–N+1æŸ¥è¯¢ï¼‰\n     */\n    public Map&lt;Long, User&gt; getUsersByIds(List&lt;Long&gt; userIds) {\n        Map&lt;Long, User&gt; result = new HashMap&lt;&gt;();\n        List&lt;Long&gt; missingIds = new ArrayList&lt;&gt;();\n        \n        // 1. å…ˆä»ç¼“å­˜è·å–\n        for (Long userId : userIds) {\n            User user = userCache.get(userId);\n            if (user != null) {\n                result.put(userId, user);\n            } else {\n                missingIds.add(userId);\n            }\n        }\n        \n        // 2. æ‰¹é‡æŸ¥è¯¢ç¼ºå¤±çš„æ•°æ®\n        if (!missingIds.isEmpty()) {\n            List&lt;User&gt; dbUsers = userMapper.selectBatchIds(missingIds);\n            for (User user : dbUsers) {\n                result.put(user.getId(), user);\n                userCache.put(user.getId(), user);  // æ”¾å…¥ç¼“å­˜\n            }\n        }\n        \n        return result;\n    }\n}\n</code></pre>\n<h3 id=\"ä¼˜ç¼ºç‚¹åˆ†æ\">ä¼˜ç¼ºç‚¹åˆ†æ</h3>\n<p><strong>ä¼˜ç‚¹ï¼š</strong></p>\n<ol>\n<li><strong>JDKåŸç”Ÿæ”¯æŒ</strong>ï¼šæ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–</li>\n<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šåˆ†æ®µé”/CASä¿è¯å¹¶å‘å®‰å…¨</li>\n<li><strong>æ€§èƒ½ä¼˜ç§€</strong>ï¼šè¯»æ“ä½œå®Œå…¨æ— é”ï¼Œå†™æ“ä½œé”ç²’åº¦å°</li>\n<li><strong>ç®€å•è½»é‡</strong>ï¼šä»£ç ç®€å•ï¼Œèµ„æºæ¶ˆè€—å°</li>\n</ol>\n<p><strong>ç¼ºç‚¹ï¼š</strong></p>\n<ol>\n<li><strong>åŠŸèƒ½æœ‰é™</strong>ï¼šç¼ºä¹è¿‡æœŸã€æ·˜æ±°ç­‰é«˜çº§åŠŸèƒ½</li>\n<li><strong>å†…å­˜æ— æ³•é™åˆ¶</strong>ï¼šå¯èƒ½é€ æˆå†…å­˜æº¢å‡º</li>\n<li><strong>éœ€è¦æ‰‹åŠ¨ç®¡ç†</strong>ï¼šç¼“å­˜ç­–ç•¥éœ€è¦è‡ªå·±å®ç°</li>\n</ol>\n<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>\n<ul>\n<li>ç¼“å­˜æ•°æ®é‡å°ä¸”å›ºå®š</li>\n<li>ä¸éœ€è¦è‡ªåŠ¨è¿‡æœŸåŠŸèƒ½</li>\n<li>ä½œä¸ºæ›´å¤æ‚ç¼“å­˜çš„åº•å±‚å®ç°</li>\n<li>ä¸´æ—¶æ€§ã€ç®€å•çš„ç¼“å­˜éœ€æ±‚</li>\n</ul>\n<p>æœ‰äº›å°ä¼™ä¼´åœ¨é¡¹ç›®åˆæœŸå–œæ¬¢ç”¨<code>ConcurrentHashMap</code>åšç¼“å­˜ï¼Œå› ä¸ºå®ƒç®€å•ç›´æ¥ã€‚</p>\n<p>ä½†éšç€ä¸šåŠ¡å¤æ‚åŒ–ï¼Œå¾€å¾€ä¼šé‡åˆ°å†…å­˜æº¢å‡ºã€ç¼“å­˜æ¸…ç†ç­‰é—®é¢˜ï¼Œè¿™æ—¶å€™å°±éœ€è¦æ›´ä¸“ä¸šçš„ç¼“å­˜æ–¹æ¡ˆäº†ã€‚</p>\n<h2 id=\"04-æ–¹æ¡ˆäºŒlruç¼“å­˜\">04 æ–¹æ¡ˆäºŒï¼šLRUç¼“å­˜</h2>\n<h3 id=\"åŸç†ä¸ç‰¹ç‚¹-1\">åŸç†ä¸ç‰¹ç‚¹</h3>\n<p>LRUï¼ˆLeast Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰æ˜¯ä¸€ç§ç»å…¸çš„ç¼“å­˜æ·˜æ±°ç®—æ³•ã€‚</p>\n<p>å½“ç¼“å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼˜å…ˆæ·˜æ±°<strong>æœ€ä¹…æœªè¢«è®¿é—®</strong>çš„æ•°æ®ã€‚</p>\n<p><code>LinkedHashMap</code>æ˜¯JDKæä¾›çš„å®ç°äº†LRUç‰¹æ€§çš„Mapå®ç°ã€‚</p>\n<p>å®ƒé€šè¿‡ç»´æŠ¤ä¸€ä¸ª<strong>åŒå‘é“¾è¡¨</strong>æ¥è®°å½•è®¿é—®é¡ºåºã€‚</p>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n<p><strong>æ ¸å¿ƒæœºåˆ¶</strong>ï¼š</p>\n<ul>\n<li><strong>è®¿é—®é¡ºåº</strong>ï¼š<code>accessOrder=true</code>æ—¶ï¼Œæ¯æ¬¡è®¿é—®ä¼šå°†èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨</li>\n<li><strong>æ·˜æ±°ç­–ç•¥</strong>ï¼šé“¾è¡¨å°¾éƒ¨çš„èŠ‚ç‚¹æ˜¯æœ€ä¹…æœªè®¿é—®çš„</li>\n<li><strong>é‡å†™removeEldestEntry</strong>ï¼šæ§åˆ¶ä½•æ—¶åˆ é™¤æœ€è€èŠ‚ç‚¹</li>\n</ul>\n<h3 id=\"å®æˆ˜ä»£ç ç¤ºä¾‹-1\">å®æˆ˜ä»£ç ç¤ºä¾‹</h3>\n<pre><code class=\"language-java\">import java.util.*;\n\n/**\n * åŸºäºLinkedHashMapçš„LRUç¼“å­˜\n * ç‰¹ç‚¹ï¼šè‡ªåŠ¨æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®\n */\npublic class LRUCache&lt;K, V&gt; extends LinkedHashMap&lt;K, V&gt; {\n    \n    private final int maxCapacity;\n    \n    /**\n     * åˆ›å»ºLRUç¼“å­˜\n     * @param maxCapacity æœ€å¤§å®¹é‡\n     */\n    public LRUCache(int maxCapacity) {\n        // ç¬¬ä¸‰ä¸ªå‚æ•°accessOrderä¸ºtrueè¡¨ç¤ºæŒ‰è®¿é—®é¡ºåºæ’åº\n        super(16, 0.75f, true);\n        this.maxCapacity = maxCapacity;\n    }\n    \n    /**\n     * é‡å†™æ­¤æ–¹æ³•å†³å®šä½•æ—¶åˆ é™¤æœ€è€çš„æ¡ç›®\n     * @param eldest æœ€è€çš„æ¡ç›®ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰\n     * @return trueè¡¨ç¤ºåº”è¯¥åˆ é™¤æœ€è€çš„æ¡ç›®\n     */\n    @Override\n    protected boolean removeEldestEntry(Map.Entry&lt;K, V&gt; eldest) {\n        // å½“å¤§å°è¶…è¿‡æœ€å¤§å®¹é‡æ—¶ï¼Œåˆ é™¤æœ€è€çš„æ¡ç›®\n        return size() &gt; maxCapacity;\n    }\n    \n    /**\n     * è·å–ç¼“å­˜å€¼ï¼ˆä¼šæ›´æ–°è®¿é—®é¡ºåºï¼‰\n     */\n    @Override\n    public V get(Object key) {\n        synchronized (this) {\n            return super.get(key);\n        }\n    }\n    \n    /**\n     * æ”¾å…¥ç¼“å­˜å€¼\n     */\n    @Override\n    public V put(K key, V value) {\n        synchronized (this) {\n            return super.put(key, value);\n        }\n    }\n    \n    /**\n     * è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯\n     */\n    public CacheStats getStats() {\n        return new CacheStats(size(), maxCapacity);\n    }\n    \n    /**\n     * è·å–æœ€è¿‘è®¿é—®çš„Nä¸ªé”®\n     */\n    public List&lt;K&gt; getRecentlyAccessed(int n) {\n        List&lt;K&gt; result = new ArrayList&lt;&gt;();\n        Iterator&lt;K&gt; iterator = keySet().iterator();\n        \n        for (int i = 0; i &lt; n &amp;&amp; iterator.hasNext(); i++) {\n            result.add(iterator.next());\n        }\n        \n        return result;\n    }\n    \n    /**\n     * ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯\n     */\n    public static class CacheStats {\n        private final int currentSize;\n        private final int maxCapacity;\n        private final double usageRatio;\n        \n        public CacheStats(int currentSize, int maxCapacity) {\n            this.currentSize = currentSize;\n            this.maxCapacity = maxCapacity;\n            this.usageRatio = maxCapacity &gt; 0 ? (double) currentSize / maxCapacity : 0;\n        }\n        \n        // getters...\n    }\n}\n\n/**\n * çº¿ç¨‹å®‰å…¨çš„LRUç¼“å­˜å®ç°\n */\npublic class ConcurrentLRUCache&lt;K, V&gt; {\n    \n    private final LRUCache&lt;K, V&gt; cache;\n    \n    public ConcurrentLRUCache(int maxCapacity) {\n        this.cache = new LRUCache&lt;&gt;(maxCapacity);\n    }\n    \n    /**\n     * è·å–ç¼“å­˜å€¼\n     */\n    public V get(K key) {\n        synchronized (cache) {\n            return cache.get(key);\n        }\n    }\n    \n    /**\n     * æ”¾å…¥ç¼“å­˜å€¼\n     */\n    public V put(K key, V value) {\n        synchronized (cache) {\n            return cache.put(key, value);\n        }\n    }\n    \n    /**\n     * æ‰¹é‡æ”¾å…¥ç¼“å­˜\n     */\n    public void putAll(Map&lt;? extends K, ? extends V&gt; map) {\n        synchronized (cache) {\n            cache.putAll(map);\n        }\n    }\n    \n    /**\n     * ç§»é™¤ç¼“å­˜\n     */\n    public V remove(K key) {\n        synchronized (cache) {\n            return cache.remove(key);\n        }\n    }\n    \n    /**\n     * æ¸…ç©ºç¼“å­˜\n     */\n    public void clear() {\n        synchronized (cache) {\n            cache.clear();\n        }\n    }\n    \n    /**\n     * è·å–ç¼“å­˜å¤§å°\n     */\n    public int size() {\n        synchronized (cache) {\n            return cache.size();\n        }\n    }\n    \n    /**\n     * æ£€æŸ¥ç¼“å­˜æ˜¯å¦åŒ…å«key\n     */\n    public boolean containsKey(K key) {\n        synchronized (cache) {\n            return cache.containsKey(key);\n        }\n    }\n    \n    /**\n     * è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯\n     */\n    public LRUCache.CacheStats getStats() {\n        synchronized (cache) {\n            return cache.getStats();\n        }\n    }\n}\n\n/**\n * ä½¿ç”¨ç¤ºä¾‹ï¼šå•†å“ä¿¡æ¯ç¼“å­˜\n */\n@Service\npublic class ProductServiceWithLRUCache {\n    \n    @Autowired\n    private ProductMapper productMapper;\n    \n    // LRUç¼“å­˜ï¼Œæœ€å¤šç¼“å­˜1000ä¸ªå•†å“\n    private final ConcurrentLRUCache&lt;Long, Product&gt; productCache;\n    \n    // çƒ­é—¨å•†å“ç¼“å­˜ï¼ˆæ›´å°çš„LRUç¼“å­˜ï¼‰\n    private final ConcurrentLRUCache&lt;Long, Product&gt; hotProductCache;\n    \n    public ProductServiceWithLRUCache() {\n        // ä¸»ç¼“å­˜ï¼š1000ä¸ªå•†å“\n        productCache = new ConcurrentLRUCache&lt;&gt;(1000);\n        \n        // çƒ­é—¨å•†å“ç¼“å­˜ï¼š100ä¸ªå•†å“\n        hotProductCache = new ConcurrentLRUCache&lt;&gt;(100);\n    }\n    \n    /**\n     * è·å–å•†å“ä¿¡æ¯\n     */\n    public Product getProductById(Long productId) {\n        // 1. å…ˆæŸ¥çƒ­é—¨å•†å“ç¼“å­˜\n        Product product = hotProductCache.get(productId);\n        if (product != null) {\n            recordCacheHit(\"hot\");  // è®°å½•å‘½ä¸­\n            return product;\n        }\n        \n        // 2. æŸ¥ä¸»ç¼“å­˜\n        product = productCache.get(productId);\n        if (product != null) {\n            // å¦‚æœå•†å“è¢«é¢‘ç¹è®¿é—®ï¼Œç§»åˆ°çƒ­é—¨ç¼“å­˜\n            if (isFrequentlyAccessed(productId)) {\n                hotProductCache.put(productId, product);\n            }\n            recordCacheHit(\"main\");\n            return product;\n        }\n        \n        // 3. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“\n        product = productMapper.selectById(productId);\n        if (product != null) {\n            // æ”¾å…¥ä¸»ç¼“å­˜\n            productCache.put(productId, product);\n            recordCacheMiss();\n        }\n        \n        return product;\n    }\n    \n    /**\n     * è·å–çƒ­é—¨å•†å“åˆ—è¡¨\n     */\n    public List&lt;Product&gt; getHotProducts(int limit) {\n        // ç›´æ¥ä»çƒ­é—¨ç¼“å­˜è·å–æœ€è¿‘è®¿é—®çš„å•†å“\n        // æ³¨æ„ï¼šè¿™åªæ˜¯ç®€åŒ–ç¤ºä¾‹ï¼Œå®é™…éœ€è¦æ›´å¤æ‚çš„çƒ­é—¨åº¦è®¡ç®—\n        \n        List&lt;Product&gt; hotProducts = new ArrayList&lt;&gt;();\n        \n        synchronized (hotProductCache) {\n            // è¿™é‡Œéœ€è¦æ‰©å±•ConcurrentLRUCacheä»¥æ”¯æŒè·å–æ‰€æœ‰å€¼\n            // å®é™…å®ç°ä¸­éœ€è¦ç»´æŠ¤é¢å¤–çš„æ•°æ®ç»“æ„\n        }\n        \n        return hotProducts;\n    }\n    \n    /**\n     * æ›´æ–°å•†å“ä¿¡æ¯ï¼ˆåŒæ—¶æ›´æ–°ä¸¤ä¸ªç¼“å­˜ï¼‰\n     */\n    public void updateProduct(Product product) {\n        Long productId = product.getId();\n        \n        // 1. æ›´æ–°æ•°æ®åº“\n        productMapper.updateById(product);\n        \n        // 2. æ›´æ–°ç¼“å­˜\n        productCache.put(productId, product);\n        hotProductCache.put(productId, product);\n        \n        // 3. è®°å½•æ›´æ–°æ—¥å¿—\n        logProductUpdate(productId);\n    }\n    \n    /**\n     * æ‰¹é‡å¤±æ•ˆç¼“å­˜ï¼ˆå½“å•†å“åˆ†ç±»æ›´æ–°æ—¶ï¼‰\n     */\n    public void invalidateProductsByCategory(Long categoryId) {\n        // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œéœ€è¦éå†ç¼“å­˜å¹¶åˆ é™¤å¯¹åº”åˆ†ç±»çš„å•†å“\n        // ä¸ºäº†æ€§èƒ½ï¼Œå¯ä»¥ï¼š\n        // 1. ä½¿ç”¨åˆ†ä»£ç¼“å­˜\n        // 2. ä½¿ç”¨å¼‚æ­¥æ¸…ç†\n        // 3. ä½¿ç”¨æ›´ç»†ç²’åº¦çš„ç¼“å­˜é”®\n        \n        System.out.println(\"å•†å“åˆ†ç±»æ›´æ–°ï¼Œéœ€è¦æ¸…ç†ç›¸å…³ç¼“å­˜: \" + categoryId);\n        // è¿™é‡Œç®€åŒ–å¤„ç†ï¼šæ¸…ç©ºæ‰€æœ‰ç¼“å­˜ï¼ˆç”Ÿäº§ç¯å¢ƒä¸æ¨èï¼‰\n        // productCache.clear();\n        // hotProductCache.clear();\n    }\n    \n    private boolean isFrequentlyAccessed(Long productId) {\n        // ç®€åŒ–å®ç°ï¼šæ€»æ˜¯è¿”å›true\n        // å®é™…éœ€è¦åŸºäºè®¿é—®é¢‘ç‡çš„çƒ­åº¦ç®—æ³•\n        return true;\n    }\n    \n    private void recordCacheHit(String cacheType) {\n        // è®°å½•ç¼“å­˜å‘½ä¸­ï¼Œç”¨äºç›‘æ§å’Œè°ƒä¼˜\n        System.out.println(\"ç¼“å­˜å‘½ä¸­ [\" + cacheType + \"]: \" + System.currentTimeMillis());\n    }\n    \n    private void recordCacheMiss() {\n        // è®°å½•ç¼“å­˜æœªå‘½ä¸­\n        System.out.println(\"ç¼“å­˜æœªå‘½ä¸­: \" + System.currentTimeMillis());\n    }\n    \n    private void logProductUpdate(Long productId) {\n        // è®°å½•å•†å“æ›´æ–°\n        System.out.println(\"å•†å“æ›´æ–°: \" + productId + \" at \" + System.currentTimeMillis());\n    }\n}\n</code></pre>\n<h3 id=\"ä¼˜ç¼ºç‚¹åˆ†æ-1\">ä¼˜ç¼ºç‚¹åˆ†æ</h3>\n<p><strong>ä¼˜ç‚¹ï¼š</strong></p>\n<ol>\n<li><strong>è‡ªåŠ¨æ·˜æ±°</strong>ï¼šæ— éœ€æ‰‹åŠ¨æ¸…ç†ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º</li>\n<li><strong>è®¿é—®æ¨¡å¼ä¼˜åŒ–</strong>ï¼šè‡ªåŠ¨å°†çƒ­é—¨æ•°æ®ä¿æŒåœ¨ç¼“å­˜ä¸­</li>\n<li><strong>JDKåŸç”Ÿ</strong>ï¼šåŸºäºLinkedHashMapï¼Œæ— éœ€é¢å¤–ä¾èµ–</li>\n<li><strong>ç®€å•æœ‰æ•ˆ</strong>ï¼šå¯¹äºè®¿é—®æ¨¡å¼æœ‰æ˜æ˜¾çƒ­ç‚¹çš„åœºæ™¯æ•ˆæœæ˜¾è‘—</li>\n</ol>\n<p><strong>ç¼ºç‚¹ï¼š</strong></p>\n<ol>\n<li><strong>æ·˜æ±°ç­–ç•¥å•ä¸€</strong>ï¼šåªåŸºäºè®¿é—®æ—¶é—´ï¼Œä¸è€ƒè™‘è®¿é—®é¢‘ç‡</li>\n<li><strong>å¯èƒ½æ·˜æ±°çƒ­ç‚¹æ•°æ®</strong>ï¼šå¦‚æœç¼“å­˜å¤ªå°ï¼Œå¯èƒ½è¯¯æ·˜æ±°</li>\n<li><strong>å¹¶å‘æ€§èƒ½</strong>ï¼šéœ€è¦é¢å¤–åŒæ­¥æ¥ä¿è¯çº¿ç¨‹å®‰å…¨</li>\n<li><strong>åŠŸèƒ½æœ‰é™</strong>ï¼šç¼ºä¹è¿‡æœŸæ—¶é—´ç­‰é«˜çº§åŠŸèƒ½</li>\n</ol>\n<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>\n<ul>\n<li>æ•°æ®è®¿é—®æœ‰æ˜æ˜¾çƒ­ç‚¹</li>\n<li>ç¼“å­˜å®¹é‡æœ‰é™ï¼Œéœ€è¦è‡ªåŠ¨æ·˜æ±°</li>\n<li>æ•°æ®é‡è¦æ€§ç›¸å¯¹å‡åŒ€</li>\n<li>ä½œä¸ºç¼“å­˜ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†</li>\n</ul>\n<p>æœ‰äº›å°ä¼™ä¼´ä¼šå‘ç°ï¼ŒLRUç¼“å­˜èƒ½è§£å†³å†…å­˜æº¢å‡ºçš„é—®é¢˜ï¼Œä½†å¯¹äºâ€œçªç„¶è¢«å¤§é‡è®¿é—®çš„å†·æ•°æ®â€åœºæ™¯ï¼Œå¯èƒ½ä¼šæ·˜æ±°æ‰çœŸæ­£çš„çƒ­ç‚¹æ•°æ®ã€‚</p>\n<p>è¿™æ—¶å€™å°±éœ€è¦æ›´æ™ºèƒ½çš„æ·˜æ±°ç­–ç•¥äº†ã€‚</p>\n<h2 id=\"05-æ–¹æ¡ˆä¸‰ehcache---ä¼ä¸šçº§æœ¬åœ°ç¼“å­˜\">05 æ–¹æ¡ˆä¸‰ï¼šEhcache - ä¼ä¸šçº§æœ¬åœ°ç¼“å­˜</h2>\n<h3 id=\"åŸç†ä¸ç‰¹ç‚¹-2\">åŸç†ä¸ç‰¹ç‚¹</h3>\n<p>Ehcacheæ˜¯ä¸€ä¸ªæˆç†Ÿçš„ã€åŠŸèƒ½ä¸°å¯Œçš„Javaç¼“å­˜æ¡†æ¶ï¼Œæœ€åˆä½œä¸ºHibernateçš„ç¼“å­˜æä¾›è€…è€Œé—»åã€‚</p>\n<p>å®ƒæ”¯æŒ<strong>å†…å­˜+ç£ç›˜</strong>çš„å¤šçº§ç¼“å­˜ï¼Œé€‚åˆç¼“å­˜å¤§é‡æ•°æ®ã€‚</p>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>\n<ul>\n<li><strong>å¤šçº§å­˜å‚¨</strong>ï¼šå †å†…å­˜ â†’ å †å¤–å†…å­˜ â†’ ç£ç›˜</li>\n<li><strong>ä¸°å¯Œçš„æ·˜æ±°ç­–ç•¥</strong>ï¼šLRUã€LFUã€FIFO</li>\n<li><strong>é›†ç¾¤æ”¯æŒ</strong>ï¼šé€šè¿‡Terracottaå®ç°åˆ†å¸ƒå¼ç¼“å­˜</li>\n<li><strong>ç›‘æ§ç®¡ç†</strong>ï¼šJMXæ”¯æŒï¼Œå®Œå–„çš„ç›‘æ§æŒ‡æ ‡</li>\n</ul>\n<h3 id=\"å®æˆ˜ä»£ç ç¤ºä¾‹-2\">å®æˆ˜ä»£ç ç¤ºä¾‹</h3>\n<p>ç”±äºEhcacheåŠŸèƒ½ä¸°å¯Œï¼Œé…ç½®ç›¸å¯¹å¤æ‚ï¼Œè¿™é‡Œå±•ç¤ºå…¶æ ¸å¿ƒç”¨æ³•ï¼š</p>\n<pre><code class=\"language-java\">import net.sf.ehcache.Cache;\nimport net.sf.ehcache.CacheManager;\nimport net.sf.ehcache.Element;\nimport net.sf.ehcache.config.CacheConfiguration;\nimport net.sf.ehcache.config.PersistenceConfiguration;\nimport net.sf.ehcache.store.MemoryStoreEvictionPolicy;\n\nimport java.io.Serializable;\n\n/**\n * Ehcacheç¼“å­˜å·¥å…·ç±»\n */\npublic class EhcacheUtil {\n    \n    private static CacheManager cacheManager;\n    \n    static {\n        // 1. åˆ›å»ºCacheManagerï¼ˆé€šå¸¸ä»é…ç½®æ–‡ä»¶åŠ è½½ï¼‰\n        cacheManager = CacheManager.create();\n        \n        // 2. æˆ–è€…ä»¥ç¼–ç¨‹æ–¹å¼é…ç½®\n        createUserCache();\n        createProductCache();\n    }\n    \n    /**\n     * åˆ›å»ºç”¨æˆ·ç¼“å­˜\n     */\n    private static void createUserCache() {\n        // ç¼“å­˜é…ç½®\n        CacheConfiguration cacheConfig = new CacheConfiguration()\n            .name(\"userCache\")  // ç¼“å­˜åç§°\n            .maxEntriesLocalHeap(1000)  // å †å†…å­˜æœ€å¤§æ¡ç›®æ•°\n            .memoryStoreEvictionPolicy(MemoryStoreEvictionPolicy.LRU)  // æ·˜æ±°ç­–ç•¥\n            .timeToLiveSeconds(3600)  // å­˜æ´»æ—¶é—´ï¼ˆç§’ï¼‰\n            .timeToIdleSeconds(600)  // ç©ºé—²æ—¶é—´ï¼ˆç§’ï¼‰\n            .diskExpiryThreadIntervalSeconds(120)  // ç£ç›˜è¿‡æœŸæ£€æŸ¥é—´éš”\n            .persistence(new PersistenceConfiguration()\n                .strategy(PersistenceConfiguration.Strategy.LOCALTEMPSWAP));  // æŒä¹…åŒ–ç­–ç•¥\n        \n        // åˆ›å»ºç¼“å­˜\n        Cache cache = new Cache(cacheConfig);\n        \n        // æ·»åŠ åˆ°CacheManager\n        cacheManager.addCache(cache);\n    }\n    \n    /**\n     * åˆ›å»ºå•†å“ç¼“å­˜ï¼ˆä½¿ç”¨å †å¤–å†…å­˜ï¼‰\n     */\n    private static void createProductCache() {\n        CacheConfiguration cacheConfig = new CacheConfiguration()\n            .name(\"productCache\")\n            .maxEntriesLocalHeap(5000)  // å †å†…å­˜æ¡ç›®æ•°\n            .maxBytesLocalOffHeap(256, MemoryUnit.MEGABYTES)  // å †å¤–å†…å­˜256MB\n            .maxBytesLocalDisk(2, MemoryUnit.GIGABYTES)  // ç£ç›˜ç¼“å­˜2GB\n            .memoryStoreEvictionPolicy(MemoryStoreEvictionPolicy.LFU)  // LFUæ·˜æ±°ç­–ç•¥\n            .timeToLiveSeconds(1800)\n            .timeToIdleSeconds(300)\n            .persistence(new PersistenceConfiguration()\n                .strategy(PersistenceConfiguration.Strategy.LOCALTEMPSWAP));\n        \n        Cache cache = new Cache(cacheConfig);\n        cacheManager.addCache(cache);\n    }\n    \n    /**\n     * è·å–ç¼“å­˜å®ä¾‹\n     */\n    public static Cache getCache(String cacheName) {\n        return cacheManager.getCache(cacheName);\n    }\n    \n    /**\n     * æ”¾å…¥ç¼“å­˜\n     */\n    public static void put(String cacheName, Serializable key, Serializable value) {\n        Cache cache = getCache(cacheName);\n        if (cache != null) {\n            Element element = new Element(key, value);\n            cache.put(element);\n        }\n    }\n    \n    /**\n     * è·å–ç¼“å­˜å€¼\n     */\n    public static Object get(String cacheName, Serializable key) {\n        Cache cache = getCache(cacheName);\n        if (cache != null) {\n            Element element = cache.get(key);\n            return element != null ? element.getObjectValue() : null;\n        }\n        return null;\n    }\n    \n    /**\n     * ç§»é™¤ç¼“å­˜\n     */\n    public static boolean remove(String cacheName, Serializable key) {\n        Cache cache = getCache(cacheName);\n        if (cache != null) {\n            return cache.remove(key);\n        }\n        return false;\n    }\n    \n    /**\n     * è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯\n     */\n    public static String getStats(String cacheName) {\n        Cache cache = getCache(cacheName);\n        if (cache != null) {\n            return String.format(\n                \"ç¼“å­˜: %s, å¤§å°: %d, å‘½ä¸­æ•°: %d, æœªå‘½ä¸­æ•°: %d, å‘½ä¸­ç‡: %.2f%%\",\n                cacheName,\n                cache.getSize(),\n                cache.getStatistics().cacheHitCount(),\n                cache.getStatistics().cacheMissCount(),\n                cache.getStatistics().cacheHitRatio() * 100\n            );\n        }\n        return \"ç¼“å­˜ä¸å­˜åœ¨: \" + cacheName;\n    }\n}\n\n/**\n * ä½¿ç”¨ç¤ºä¾‹ï¼šè®¢å•æœåŠ¡\n */\n@Service\npublic class OrderServiceWithEhcache {\n    \n    @Autowired\n    private OrderMapper orderMapper;\n    \n    /**\n     * è·å–è®¢å•è¯¦æƒ…ï¼ˆä½¿ç”¨Ehcacheï¼‰\n     */\n    public OrderDetail getOrderDetail(Long orderId) {\n        String cacheName = \"orderCache\";\n        \n        // 1. å…ˆä»ç¼“å­˜è·å–\n        OrderDetail detail = (OrderDetail) EhcacheUtil.get(cacheName, orderId);\n        if (detail != null) {\n            System.out.println(\"Ehcacheç¼“å­˜å‘½ä¸­: \" + orderId);\n            return detail;\n        }\n        \n        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“\n        System.out.println(\"Ehcacheç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“: \" + orderId);\n        detail = orderMapper.selectOrderDetail(orderId);\n        \n        if (detail != null) {\n            // 3. æ”¾å…¥ç¼“å­˜\n            EhcacheUtil.put(cacheName, orderId, detail);\n            \n            // 4. å¼‚æ­¥åŠ è½½ç›¸å…³æ•°æ®åˆ°ç¼“å­˜\n            loadRelatedDataToCache(detail);\n        }\n        \n        return detail;\n    }\n    \n    /**\n     * æ‰¹é‡è·å–è®¢å•ï¼ˆç¼“å­˜ä¼˜åŒ–ï¼‰\n     */\n    public List&lt;OrderDetail&gt; getOrderDetails(List&lt;Long&gt; orderIds) {\n        List&lt;OrderDetail&gt; result = new ArrayList&lt;&gt;();\n        List&lt;Long&gt; missingIds = new ArrayList&lt;&gt;();\n        \n        // 1. æ‰¹é‡ä»ç¼“å­˜è·å–\n        for (Long orderId : orderIds) {\n            OrderDetail detail = (OrderDetail) EhcacheUtil.get(\"orderCache\", orderId);\n            if (detail != null) {\n                result.add(detail);\n            } else {\n                missingIds.add(orderId);\n            }\n        }\n        \n        // 2. æ‰¹é‡æŸ¥è¯¢ç¼ºå¤±çš„æ•°æ®\n        if (!missingIds.isEmpty()) {\n            List&lt;OrderDetail&gt; dbDetails = orderMapper.selectOrderDetails(missingIds);\n            result.addAll(dbDetails);\n            \n            // 3. æ‰¹é‡æ”¾å…¥ç¼“å­˜\n            for (OrderDetail detail : dbDetails) {\n                EhcacheUtil.put(\"orderCache\", detail.getOrderId(), detail);\n            }\n        }\n        \n        return result;\n    }\n    \n    /**\n     * æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆåŒæ—¶æ›´æ–°ç¼“å­˜ï¼‰\n     */\n    @Transactional\n    public void updateOrderStatus(Long orderId, String status) {\n        // 1. æ›´æ–°æ•°æ®åº“\n        orderMapper.updateOrderStatus(orderId, status);\n        \n        // 2. ä½¿ç¼“å­˜å¤±æ•ˆï¼ˆæˆ–æ›´æ–°ç¼“å­˜ï¼‰\n        EhcacheUtil.remove(\"orderCache\", orderId);\n        \n        // 3. å¯ä»¥é€‰æ‹©é‡æ–°åŠ è½½åˆ°ç¼“å­˜\n        OrderDetail detail = orderMapper.selectOrderDetail(orderId);\n        if (detail != null) {\n            EhcacheUtil.put(\"orderCache\", orderId, detail);\n        }\n    }\n    \n    /**\n     * å¼‚æ­¥åŠ è½½ç›¸å…³æ•°æ®åˆ°ç¼“å­˜\n     */\n    private void loadRelatedDataToCache(OrderDetail orderDetail) {\n        // è¿™é‡Œå¯ä»¥å¼‚æ­¥åŠ è½½ç”¨æˆ·ä¿¡æ¯ã€å•†å“ä¿¡æ¯ç­‰\n        // å‡å°‘åç»­æŸ¥è¯¢çš„ç¼“å­˜æœªå‘½ä¸­\n        \n        CompletableFuture.runAsync(() -&gt; {\n            try {\n                // ç¼“å­˜ç”¨æˆ·ä¿¡æ¯\n                EhcacheUtil.put(\"userCache\", orderDetail.getUserId(), orderDetail.getUserInfo());\n                \n                // ç¼“å­˜å•†å“ä¿¡æ¯\n                for (OrderItem item : orderDetail.getItems()) {\n                    EhcacheUtil.put(\"productCache\", item.getProductId(), item.getProductInfo());\n                }\n            } catch (Exception e) {\n                // å¼‚æ­¥æ“ä½œï¼Œè®°å½•æ—¥å¿—ä½†ä¸å½±å“ä¸»æµç¨‹\n                System.err.println(\"å¼‚æ­¥åŠ è½½ç¼“å­˜å¤±è´¥: \" + e.getMessage());\n            }\n        });\n    }\n    \n    /**\n     * è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯\n     */\n    public void printCacheStats() {\n        System.out.println(\"=== ç¼“å­˜ç»Ÿè®¡ ===\");\n        System.out.println(EhcacheUtil.getStats(\"orderCache\"));\n        System.out.println(EhcacheUtil.getStats(\"userCache\"));\n        System.out.println(EhcacheUtil.getStats(\"productCache\"));\n    }\n}\n</code></pre>\n<h3 id=\"ä¼˜ç¼ºç‚¹åˆ†æ-2\">ä¼˜ç¼ºç‚¹åˆ†æ</h3>\n<p><strong>ä¼˜ç‚¹ï¼š</strong></p>\n<ol>\n<li><strong>åŠŸèƒ½å…¨é¢</strong>ï¼šæ”¯æŒå¤šçº§ç¼“å­˜ã€å¤šç§æ·˜æ±°ç­–ç•¥</li>\n<li><strong>ä¼ä¸šçº§ç‰¹æ€§</strong>ï¼šé›†ç¾¤æ”¯æŒã€æŒä¹…åŒ–ã€äº‹åŠ¡æ”¯æŒ</li>\n<li><strong>æˆç†Ÿç¨³å®š</strong>ï¼šç»è¿‡å¤šå¹´ç”Ÿäº§éªŒè¯</li>\n<li><strong>ç›‘æ§å®Œå–„</strong>ï¼šJMXæ”¯æŒï¼Œä¾¿äºç›‘æ§ç®¡ç†</li>\n</ol>\n<p><strong>ç¼ºç‚¹ï¼š</strong></p>\n<ol>\n<li><strong>é…ç½®å¤æ‚</strong>ï¼šåŠŸèƒ½å¤šå¯¼è‡´é…ç½®å¤æ‚</li>\n<li><strong>è¾ƒé‡</strong>ï¼šä¾èµ–è¾ƒå¤šï¼Œå¯åŠ¨è¾ƒæ…¢</li>\n<li><strong>APIè¾ƒè€</strong>ï¼šéƒ¨åˆ†APIè®¾è®¡ä¸å¤Ÿç°ä»£</li>\n<li><strong>ç¤¾åŒºæ´»è·ƒåº¦ä¸‹é™</strong>ï¼šç›¸æ¯”Caffeineç­‰æ–°æ¡†æ¶</li>\n</ol>\n<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>\n<ul>\n<li>éœ€è¦ç¼“å­˜å¤§é‡æ•°æ®ï¼ˆå†…å­˜+ç£ç›˜ï¼‰</li>\n<li>éœ€è¦é›†ç¾¤ç¼“å­˜æ”¯æŒ</li>\n<li>ä¼ä¸šçº§åº”ç”¨ï¼Œéœ€è¦å®Œæ•´è§£å†³æ–¹æ¡ˆ</li>\n<li>å·²æœ‰Ehcacheä½¿ç”¨ç»éªŒçš„é¡¹ç›®</li>\n</ul>\n<p>æœ‰äº›å°ä¼™ä¼´åœ¨ä¼ä¸šçº§é¡¹ç›®ä¸­æ¥è§¦è¿‡Ehcacheï¼Œå®ƒçš„åŠŸèƒ½ç¡®å®å¼ºå¤§ï¼Œä½†å¯¹äºç®€å•çš„ç¼“å­˜éœ€æ±‚æ¥è¯´å¯èƒ½è¿‡äºé‡é‡çº§äº†ã€‚</p>\n<h2 id=\"06-æ–¹æ¡ˆå››caffeine---é«˜æ€§èƒ½ç°ä»£ç¼“å­˜\">06 æ–¹æ¡ˆå››ï¼šCaffeine - é«˜æ€§èƒ½ç°ä»£ç¼“å­˜</h2>\n<h3 id=\"åŸç†ä¸ç‰¹ç‚¹-3\">åŸç†ä¸ç‰¹ç‚¹</h3>\n<p>Caffeineæ˜¯ä¸€ä¸ªåŸºäºJava 8çš„é«˜æ€§èƒ½ç¼“å­˜åº“ï¼Œç”±Guava Cacheçš„åŸä½œè€…å¼€å‘ã€‚å®ƒæä¾›äº†<strong>è¿‘ä¹æœ€ä¼˜çš„å‘½ä¸­ç‡</strong>å’Œ<strong>å“è¶Šçš„å¹¶å‘æ€§èƒ½</strong>ã€‚</p>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n<p><strong>æ ¸å¿ƒä¼˜åŒ–</strong>ï¼š</p>\n<ul>\n<li><strong>Window-TinyLFU</strong>ï¼šç»“åˆLFUå’ŒLRUä¼˜ç‚¹ï¼Œæä¾›æ›´å¥½çš„å‘½ä¸­ç‡</li>\n<li><strong>é¢‘ç‡ç´ æ</strong>ï¼šç”¨æå°ç©ºé—´ç»Ÿè®¡è®¿é—®é¢‘ç‡</li>\n<li><strong>å¼‚æ­¥æ“ä½œ</strong>ï¼šè¯»ä¸é˜»å¡å†™ï¼Œå†™ä¸é˜»å¡è¯»</li>\n<li><strong>Java 8ä¼˜åŒ–</strong>ï¼šå¤§é‡ä½¿ç”¨<code>CompletableFuture</code>å’Œ<code>StampedLock</code></li>\n</ul>\n<h3 id=\"å®æˆ˜ä»£ç ç¤ºä¾‹-3\">å®æˆ˜ä»£ç ç¤ºä¾‹</h3>\n<pre><code class=\"language-java\">import com.github.benmanes.caffeine.cache.*;\nimport org.springframework.stereotype.Service;\n\nimport java.time.Duration;\nimport java.util.concurrent.CompletableFuture;\nimport java.util.concurrent.Executor;\nimport java.util.concurrent.TimeUnit;\n\n/**\n * Caffeineç¼“å­˜ç¤ºä¾‹\n */\n@Service\npublic class CaffeineCacheService {\n    \n    // 1. åŸºç¡€ç¼“å­˜ç¤ºä¾‹\n    private final Cache&lt;Long, User&gt; userCache = Caffeine.newBuilder()\n        .maximumSize(1000)  // æœ€å¤§å®¹é‡\n        .expireAfterWrite(Duration.ofMinutes(10))  // å†™å…¥å10åˆ†é’Ÿè¿‡æœŸ\n        .expireAfterAccess(Duration.ofMinutes(5))  // è®¿é—®å5åˆ†é’Ÿè¿‡æœŸ\n        .recordStats()  // å¼€å¯ç»Ÿè®¡\n        .build();\n    \n    // 2. å¼‚æ­¥åŠ è½½ç¼“å­˜\n    private final AsyncLoadingCache&lt;Long, Product&gt; productCache = \n        Caffeine.newBuilder()\n            .maximumSize(5000)\n            .expireAfterWrite(Duration.ofHours(1))\n            .refreshAfterWrite(Duration.ofMinutes(30))  // å†™å…¥30åˆ†é’Ÿååˆ·æ–°\n            .recordStats()\n            .buildAsync(new AsyncCacheLoader&lt;Long, Product&gt;() {\n                @Override\n                public CompletableFuture&lt;Product&gt; asyncLoad(Long productId, \n                        Executor executor) {\n                    return CompletableFuture.supplyAsync(() -&gt; \n                        loadProductFromDB(productId), executor);\n                }\n                \n                @Override\n                public CompletableFuture&lt;Product&gt; asyncReload(Long productId, \n                        Product oldValue, Executor executor) {\n                    return CompletableFuture.supplyAsync(() -&gt; \n                        reloadProductFromDB(productId), executor);\n                }\n            });\n    \n    // 3. å¸¦æƒé‡ç¼“å­˜çš„ä¾‹å­ï¼ˆæŒ‰å¯¹è±¡å¤§å°ç¼“å­˜ï¼‰\n    private final Cache&lt;String, byte[]&gt; largeDataCache = Caffeine.newBuilder()\n        .maximumWeight(100 * 1024 * 1024)  // æœ€å¤§100MB\n        .weigher((String key, byte[] value) -&gt; value.length)  // æƒé‡è®¡ç®—å™¨\n        .expireAfterWrite(Duration.ofHours(2))\n        .recordStats()\n        .build();\n    \n    /**\n     * ä½¿ç”¨ç¼“å­˜è·å–ç”¨æˆ·ä¿¡æ¯\n     */\n    public User getUserWithCache(Long userId) {\n        // æ–¹å¼1ï¼šæ‰‹åŠ¨å¤„ç†\n        User user = userCache.getIfPresent(userId);\n        if (user == null) {\n            user = loadUserFromDB(userId);\n            if (user != null) {\n                userCache.put(userId, user);\n            }\n        }\n        return user;\n    }\n    \n    /**\n     * ä½¿ç”¨LoadingCacheè‡ªåŠ¨åŠ è½½\n     */\n    public User getUserAutoLoad(Long userId) {\n        LoadingCache&lt;Long, User&gt; loadingCache = Caffeine.newBuilder()\n            .maximumSize(1000)\n            .expireAfterWrite(Duration.ofMinutes(10))\n            .build(this::loadUserFromDB);  // ç¼“å­˜æœªå‘½ä¸­æ—¶è°ƒç”¨\n        \n        return loadingCache.get(userId);\n    }\n    \n    /**\n     * ä½¿ç”¨å¼‚æ­¥ç¼“å­˜è·å–å•†å“ä¿¡æ¯\n     */\n    public CompletableFuture&lt;Product&gt; getProductAsync(Long productId) {\n        return productCache.get(productId);\n    }\n    \n    /**\n     * æ‰¹é‡è·å–å•†å“\n     */\n    public CompletableFuture&lt;Iterable&lt;Product&gt;&gt; getProductsAsync(\n            Iterable&lt;Long&gt; productIds) {\n        return productCache.getAll(productIds);\n    }\n    \n    /**\n     * è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯\n     */\n    public String getCacheStats() {\n        CacheStats stats = userCache.stats();\n        \n        return String.format(\n            \"å‘½ä¸­ç‡: %.2f%%, å‘½ä¸­æ•°: %d, æœªå‘½ä¸­æ•°: %d, åŠ è½½æˆåŠŸ: %d, åŠ è½½å¤±è´¥: %d, æ€»åŠ è½½æ—¶é—´: %dms\",\n            stats.hitRate() * 100,\n            stats.hitCount(),\n            stats.missCount(),\n            stats.loadSuccessCount(),\n            stats.loadFailureCount(),\n            stats.totalLoadTime()\n        );\n    }\n    \n    /**\n     * é«˜çº§ç”¨æ³•ï¼šäº‹ä»¶ç›‘å¬\n     */\n    public void setupCacheWithListener() {\n        Cache&lt;Long, Order&gt; orderCache = Caffeine.newBuilder()\n            .maximumSize(1000)\n            .expireAfterWrite(Duration.ofMinutes(30))\n            .removalListener((Long key, Order order, RemovalCause cause) -&gt; {\n                // ç¼“å­˜æ¡ç›®è¢«ç§»é™¤æ—¶çš„å›è°ƒ\n                System.out.printf(\"ç¼“å­˜ç§»é™¤: key=%s, cause=%s%n\", key, cause);\n                \n                // å¯ä»¥æ ¹æ®ä¸åŒçš„åŸå› å¤„ç†\n                switch (cause) {\n                    case EXPLICIT:  // æ˜¾å¼ç§»é™¤\n                        System.out.println(\"æ˜¾å¼ç§»é™¤ç¼“å­˜: \" + key);\n                        break;\n                    case REPLACED:  // è¢«æ›¿æ¢\n                        System.out.println(\"ç¼“å­˜è¢«æ›¿æ¢: \" + key);\n                        break;\n                    case COLLECTED:  // åƒåœ¾å›æ”¶\n                        System.out.println(\"ç¼“å­˜è¢«GCå›æ”¶: \" + key);\n                        break;\n                    case EXPIRED:  // è¿‡æœŸ\n                        System.out.println(\"ç¼“å­˜è¿‡æœŸ: \" + key);\n                        break;\n                    case SIZE:  // å¤§å°é™åˆ¶\n                        System.out.println(\"å› å¤§å°é™åˆ¶ç§»é™¤: \" + key);\n                        break;\n                }\n            })\n            .recordStats()\n            .build();\n        \n        // ä½¿ç”¨ç¼“å­˜\n        orderCache.put(1L, new Order(1L, \"å¾…æ”¯ä»˜\"));\n        \n        // ç§»é™¤ç¼“å­˜ï¼ˆä¼šè§¦å‘EXPLICITäº‹ä»¶ï¼‰\n        orderCache.invalidate(1L);\n    }\n    \n    /**\n     * å¤æ‚åœºæ™¯ï¼šåˆ†å±‚ç¼“å­˜ç­–ç•¥\n     */\n    public void layeredCacheStrategy() {\n        // ç¬¬ä¸€å±‚ï¼šå°å®¹é‡ï¼Œè¶…å¿«è®¿é—®ï¼ˆä½¿ç”¨ConcurrentHashMapï¼‰\n        Cache&lt;Long, User&gt; L1Cache = Caffeine.newBuilder()\n            .maximumSize(100)\n            .expireAfterWrite(Duration.ofSeconds(30))\n            .build();\n        \n        // ç¬¬äºŒå±‚ï¼šå¤§å®¹é‡ï¼Œè¾ƒæ…¢è®¿é—®ï¼ˆä½¿ç”¨Caffeineï¼‰\n        Cache&lt;Long, User&gt; L2Cache = Caffeine.newBuilder()\n            .maximumSize(10000)\n            .expireAfterWrite(Duration.ofMinutes(10))\n            .build();\n        \n        // ç¬¬ä¸‰å±‚ï¼šå¼‚æ­¥åŠ è½½ï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€\n        AsyncLoadingCache&lt;Long, User&gt; L3Cache = Caffeine.newBuilder()\n            .maximumSize(50000)\n            .expireAfterWrite(Diration.ofHours(1))\n            .buildAsync(key -&gt; loadUserFromDB(key));\n        \n        // ä½¿ç”¨åˆ†å±‚ç¼“å­˜çš„ç¤ºä¾‹\n        public User getUserMultiLevel(Long userId) {\n            // 1. æŸ¥L1ç¼“å­˜\n            User user = L1Cache.getIfPresent(userId);\n            if (user != null) {\n                recordHit(\"L1\");\n                return user;\n            }\n            \n            // 2. æŸ¥L2ç¼“å­˜\n            user = L2Cache.getIfPresent(userId);\n            if (user != null) {\n                // å›å¡«L1ç¼“å­˜\n                L1Cache.put(userId, user);\n                recordHit(\"L2\");\n                return user;\n            }\n            \n            // 3. æŸ¥L3ç¼“å­˜ï¼ˆå¼‚æ­¥åŠ è½½ï¼‰\n            try {\n                user = L3Cache.get(userId).get(2, TimeUnit.SECONDS);\n                \n                // å›å¡«L1å’ŒL2\n                L1Cache.put(userId, user);\n                L2Cache.put(userId, user);\n                \n                recordHit(\"L3\");\n                return user;\n            } catch (Exception e) {\n                // ç¼“å­˜åŠ è½½å¤±è´¥\n                recordMiss();\n                return loadUserFromDB(userId);  // é™çº§åˆ°ç›´æ¥æŸ¥DB\n            }\n        }\n    }\n    \n    private User loadUserFromDB(Long userId) {\n        System.out.println(\"ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·: \" + userId);\n        // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢\n        return new User(userId, \"ç”¨æˆ·\" + userId);\n    }\n    \n    private Product loadProductFromDB(Long productId) {\n        System.out.println(\"ä»æ•°æ®åº“åŠ è½½å•†å“: \" + productId);\n        return new Product(productId, \"å•†å“\" + productId);\n    }\n    \n    private Product reloadProductFromDB(Long productId) {\n        System.out.println(\"åˆ·æ–°å•†å“ç¼“å­˜: \" + productId);\n        return new Product(productId, \"åˆ·æ–°åçš„å•†å“\" + productId);\n    }\n    \n    private void recordHit(String cacheLevel) {\n        // è®°å½•å‘½ä¸­ç»Ÿè®¡\n        System.out.println(\"ç¼“å­˜å‘½ä¸­ [\" + cacheLevel + \"]\");\n    }\n    \n    private void recordMiss() {\n        // è®°å½•æœªå‘½ä¸­\n        System.out.println(\"ç¼“å­˜æœªå‘½ä¸­\");\n    }\n}\n</code></pre>\n<h3 id=\"ä¼˜ç¼ºç‚¹åˆ†æ-3\">ä¼˜ç¼ºç‚¹åˆ†æ</h3>\n<p><strong>ä¼˜ç‚¹ï¼š</strong></p>\n<ol>\n<li><strong>æ€§èƒ½å“è¶Š</strong>ï¼šè¯»æ€§èƒ½æ¥è¿‘<code>ConcurrentHashMap</code></li>\n<li><strong>é«˜å‘½ä¸­ç‡</strong>ï¼šWindow-TinyLFUç®—æ³•æ˜¾è‘—æå‡å‘½ä¸­ç‡</li>\n<li><strong>ç°ä»£API</strong>ï¼šåŸºäºJava 8ï¼Œæ”¯æŒå¼‚æ­¥ã€å‡½æ•°å¼ç¼–ç¨‹</li>\n<li><strong>å†…å­˜å‹å¥½</strong>ï¼šæ™ºèƒ½çš„æƒé‡æ§åˆ¶å’Œæ·˜æ±°ç­–ç•¥</li>\n</ol>\n<p><strong>ç¼ºç‚¹ï¼š</strong></p>\n<ol>\n<li><strong>è¾ƒæ–°</strong>ï¼šç”Ÿæ€ä¸å¦‚Guava Cacheæˆç†Ÿ</li>\n<li><strong>å­¦ä¹ æ›²çº¿</strong>ï¼šé«˜çº§åŠŸèƒ½éœ€è¦ç†è§£å…¶ç®—æ³•åŸç†</li>\n<li><strong>åŠŸèƒ½ä¸“æ³¨</strong>ï¼šä¸»è¦å…³æ³¨å†…å­˜ç¼“å­˜ï¼Œä¸åƒEhcacheæ”¯æŒç£ç›˜</li>\n</ol>\n<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>\n<ul>\n<li>å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯</li>\n<li>éœ€è¦é«˜å‘½ä¸­ç‡çš„ç¼“å­˜ç­–ç•¥</li>\n<li>ç°ä»£Javaé¡¹ç›®ï¼ˆJava 8+ï¼‰</li>\n<li>ä½œä¸ºGuava Cacheçš„å‡çº§æ›¿ä»£</li>\n</ul>\n<p>æœ‰äº›å°ä¼™ä¼´ä»Guava Cacheè¿ç§»åˆ°Caffeineåï¼Œä¼šå‘ç°å‘½ä¸­ç‡æœ‰æ˜æ˜¾æå‡ï¼Œç‰¹åˆ«æ˜¯åœ¨æ•°æ®è®¿é—®æ¨¡å¼å¤æ‚å¤šå˜çš„åœºæ™¯ä¸‹ã€‚</p>\n<h2 id=\"07-æ–¹æ¡ˆäº”guava-cache---ç»å…¸çš„é€‰æ‹©\">07 æ–¹æ¡ˆäº”ï¼šGuava Cache - ç»å…¸çš„é€‰æ‹©</h2>\n<h3 id=\"åŸç†ä¸ç‰¹ç‚¹-4\">åŸç†ä¸ç‰¹ç‚¹</h3>\n<p>Guava Cacheæ˜¯Google Guavaåº“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ä¸€ä¸ªè®¾è®¡ä¼˜é›…ã€åŠŸèƒ½å®Œå–„çš„æœ¬åœ°ç¼“å­˜å®ç°ã€‚</p>\n<p>å®ƒæä¾›äº†<strong>ä¸°å¯Œçš„æ„å»ºé€‰é¡¹</strong>å’Œ<strong>çµæ´»çš„è¿‡æœŸç­–ç•¥</strong>ã€‚</p>\n<h3 id=\"å®æˆ˜ä»£ç ç¤ºä¾‹-4\">å®æˆ˜ä»£ç ç¤ºä¾‹</h3>\n<pre><code class=\"language-java\">import com.google.common.cache.*;\nimport org.springframework.stereotype.Service;\n\nimport java.util.concurrent.ExecutionException;\nimport java.util.concurrent.TimeUnit;\n\n/**\n * Guava Cacheä½¿ç”¨ç¤ºä¾‹\n */\n@Service\npublic class GuavaCacheService {\n    \n    // 1. åŸºç¡€ç¼“å­˜ç¤ºä¾‹\n    private final Cache&lt;Long, User&gt; userCache = CacheBuilder.newBuilder()\n        .maximumSize(1000)  // æœ€å¤§å®¹é‡\n        .expireAfterWrite(10, TimeUnit.MINUTES)  // å†™å…¥å10åˆ†é’Ÿè¿‡æœŸ\n        .expireAfterAccess(5, TimeUnit.MINUTES)  // è®¿é—®å5åˆ†é’Ÿè¿‡æœŸ\n        .concurrencyLevel(8)  // å¹¶å‘çº§åˆ«\n        .recordStats()  // å¼€å¯ç»Ÿè®¡\n        .build();\n    \n    // 2. å¸¦æƒé‡ç¼“å­˜çš„ä¾‹å­\n    private final Cache&lt;String, byte[]&gt; weightedCache = CacheBuilder.newBuilder()\n        .maximumWeight(100 * 1024 * 1024)  // æœ€å¤§100MB\n        .weigher(new Weigher&lt;String, byte[]&gt;() {\n            @Override\n            public int weigh(String key, byte[] value) {\n                return value.length;  // æŒ‰å­—èŠ‚æ•°ç»„é•¿åº¦è®¡ç®—æƒé‡\n            }\n        })\n        .expireAfterWrite(2, TimeUnit.HOURS)\n        .build();\n    \n    // 3. ä½¿ç”¨CacheLoaderè‡ªåŠ¨åŠ è½½\n    private final LoadingCache&lt;Long, Product&gt; productCache = CacheBuilder.newBuilder()\n        .maximumSize(5000)\n        .expireAfterWrite(1, TimeUnit.HOURS)\n        .refreshAfterWrite(30, TimeUnit.MINUTES)  // å†™å…¥30åˆ†é’Ÿååˆ·æ–°\n        .build(new CacheLoader&lt;Long, Product&gt;() {\n            @Override\n            public Product load(Long productId) {\n                // ç¼“å­˜æœªå‘½ä¸­æ—¶è°ƒç”¨\n                return loadProductFromDB(productId);\n            }\n            \n            @Override\n            public Product reload(Long productId, Product oldValue) {\n                // åˆ·æ–°æ—¶è°ƒç”¨ï¼ˆé»˜è®¤å®ç°è°ƒç”¨loadï¼‰\n                return reloadProductFromDB(productId);\n            }\n        });\n    \n    /**\n     * åŸºæœ¬ç”¨æ³•ï¼šæ‰‹åŠ¨put/get\n     */\n    public User getUserManual(Long userId) {\n        // å°è¯•è·å–ç¼“å­˜\n        User user = userCache.getIfPresent(userId);\n        \n        if (user == null) {\n            // ç¼“å­˜æœªå‘½ä¸­ï¼ŒåŠ è½½æ•°æ®\n            user = loadUserFromDB(userId);\n            if (user != null) {\n                userCache.put(userId, user);\n            }\n        }\n        \n        return user;\n    }\n    \n    /**\n     * ä½¿ç”¨CacheLoaderè‡ªåŠ¨åŠ è½½\n     */\n    public Product getProductAutoLoad(Long productId) {\n        try {\n            // å¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨CacheLoader.load()\n            return productCache.get(productId);\n        } catch (ExecutionException e) {\n            // å¤„ç†åŠ è½½å¼‚å¸¸\n            System.err.println(\"åŠ è½½äº§å“å¤±è´¥: \" + productId);\n            return null;\n        }\n    }\n    \n    /**\n     * æ‰¹é‡è·å–\n     */\n    public Iterable&lt;Product&gt; getProductsAutoLoad(Iterable&lt;Long&gt; productIds) {\n        try {\n            // æ‰¹é‡è·å–ï¼Œè‡ªåŠ¨åŠ è½½ç¼ºå¤±çš„æ•°æ®\n            return productCache.getAll(productIds).values();\n        } catch (ExecutionException e) {\n            System.err.println(\"æ‰¹é‡åŠ è½½äº§å“å¤±è´¥\");\n            return null;\n        }\n    }\n    \n    /**\n     * ç¼“å­˜åˆ·æ–°ç¤ºä¾‹\n     */\n    public void refreshProduct(Long productId) {\n        // å•ä¸ªåˆ·æ–°\n        productCache.refresh(productId);\n        \n        // æˆ–è€…æ‰¹é‡åˆ·æ–°\n        // for (Long id : productIds) {\n        //     productCache.refresh(id);\n        // }\n    }\n    \n    /**\n     * äº‹ä»¶ç›‘å¬å™¨\n     */\n    public void setupCacheWithListener() {\n        RemovalListener&lt;Long, User&gt; removalListener = new RemovalListener&lt;Long, User&gt;() {\n            @Override\n            public void onRemoval(RemovalNotification&lt;Long, User&gt; notification) {\n                RemovalCause cause = notification.getCause();\n                Long userId = notification.getKey();\n                User user = notification.getValue();\n                \n                System.out.printf(\"ç¼“å­˜ç§»é™¤: userId=%s, cause=%s%n\", userId, cause);\n                \n                // æ ¹æ®ä¸åŒçš„ç§»é™¤åŸå› å¤„ç†\n                switch (cause) {\n                    case EXPLICIT:  // æ˜¾å¼ç§»é™¤\n                        System.out.println(\"ä¸»åŠ¨ç§»é™¤ç”¨æˆ·ç¼“å­˜: \" + userId);\n                        break;\n                    case REPLACED:  // è¢«æ›¿æ¢\n                        System.out.println(\"ç”¨æˆ·ç¼“å­˜è¢«æ›¿æ¢: \" + userId);\n                        break;\n                    case COLLECTED:  // åƒåœ¾å›æ”¶\n                        System.out.println(\"ç”¨æˆ·ç¼“å­˜è¢«GC: \" + userId);\n                        break;\n                    case EXPIRED:  // è¿‡æœŸ\n                        System.out.println(\"ç”¨æˆ·ç¼“å­˜è¿‡æœŸ: \" + userId);\n                        // å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œ\n                        cleanupUserResources(user);\n                        break;\n                    case SIZE:  // å¤§å°é™åˆ¶\n                        System.out.println(\"å› å®¹é‡é™åˆ¶ç§»é™¤ç”¨æˆ·: \" + userId);\n                        break;\n                }\n            }\n            \n            private void cleanupUserResources(User user) {\n                // æ¸…ç†ç”¨æˆ·ç›¸å…³èµ„æº\n                if (user != null) {\n                    System.out.println(\"æ¸…ç†ç”¨æˆ·èµ„æº: \" + user.getId());\n                }\n            }\n        };\n        \n        // åˆ›å»ºå¸¦ç›‘å¬å™¨çš„ç¼“å­˜\n        Cache&lt;Long, User&gt; cacheWithListener = CacheBuilder.newBuilder()\n            .maximumSize(1000)\n            .expireAfterWrite(10, TimeUnit.MINUTES)\n            .removalListener(removalListener)\n            .build();\n        \n        // ä½¿ç”¨ç¼“å­˜\n        cacheWithListener.put(1L, new User(1L, \"æµ‹è¯•ç”¨æˆ·\"));\n        cacheWithListener.invalidate(1L);  // è§¦å‘EXPLICITç§»é™¤\n    }\n    \n    /**\n     * ç»Ÿè®¡ä¿¡æ¯\n     */\n    public void printCacheStats() {\n        CacheStats stats = userCache.stats();\n        \n        System.out.println(\"=== Guava Cache ç»Ÿè®¡ ===\");\n        System.out.println(\"å‘½ä¸­ç‡: \" + stats.hitRate());\n        System.out.println(\"å‘½ä¸­æ•°: \" + stats.hitCount());\n        System.out.println(\"æœªå‘½ä¸­æ•°: \" + stats.missCount());\n        System.out.println(\"åŠ è½½æˆåŠŸæ•°: \" + stats.loadSuccessCount());\n        System.out.println(\"åŠ è½½å¼‚å¸¸æ•°: \" + stats.loadExceptionCount());\n        System.out.println(\"æ€»åŠ è½½æ—¶é—´: \" + stats.totalLoadTime() + \"ns\");\n        System.out.println(\"é©±é€æ•°: \" + stats.evictionCount());\n    }\n    \n    /**\n     * å¤æ‚åœºæ™¯ï¼šå¤šçº§ç¼“å­˜ç­–ç•¥\n     */\n    public void multiLevelCacheExample() {\n        // ç¬¬ä¸€çº§ï¼šé«˜é¢‘å°ç¼“å­˜\n        LoadingCache&lt;Long, String&gt; L1Cache = CacheBuilder.newBuilder()\n            .maximumSize(100)\n            .expireAfterWrite(30, TimeUnit.SECONDS)\n            .build(new CacheLoader&lt;Long, String&gt;() {\n                @Override\n                public String load(Long key) {\n                    // L1æœªå‘½ä¸­ï¼ŒæŸ¥L2\n                    return L2Cache.get(key);\n                }\n            });\n        \n        // ç¬¬äºŒçº§ï¼šä½é¢‘å¤§ç¼“å­˜\n        LoadingCache&lt;Long, String&gt; L2Cache = CacheBuilder.newBuilder()\n            .maximumSize(10000)\n            .expireAfterWrite(10, TimeUnit.MINUTES)\n            .build(new CacheLoader&lt;Long, String&gt;() {\n                @Override\n                public String load(Long key) {\n                    // L2æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®æº\n                    return loadFromDataSource(key);\n                }\n            });\n        \n        // ä½¿ç”¨å¤šçº§ç¼“å­˜\n        public String getValueMultiLevel(Long key) {\n            try {\n                return L1Cache.get(key);\n            } catch (ExecutionException e) {\n                System.err.println(\"å¤šçº§ç¼“å­˜è·å–å¤±è´¥: \" + key);\n                return loadFromDataSource(key);\n            }\n        }\n    }\n    \n    // è¾…åŠ©æ–¹æ³•\n    private User loadUserFromDB(Long userId) {\n        System.out.println(\"ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·: \" + userId);\n        return new User(userId, \"ç”¨æˆ·\" + userId);\n    }\n    \n    private Product loadProductFromDB(Long productId) {\n        System.out.println(\"ä»æ•°æ®åº“åŠ è½½å•†å“: \" + productId);\n        return new Product(productId, \"å•†å“\" + productId);\n    }\n    \n    private Product reloadProductFromDB(Long productId) {\n        System.out.println(\"åˆ·æ–°å•†å“æ•°æ®: \" + productId);\n        return new Product(productId, \"åˆ·æ–°åçš„å•†å“\" + productId);\n    }\n    \n    private String loadFromDataSource(Long key) {\n        System.out.println(\"ä»æ•°æ®æºåŠ è½½: \" + key);\n        return \"æ•°æ®\" + key;\n    }\n}\n</code></pre>\n<h3 id=\"ä¼˜ç¼ºç‚¹åˆ†æ-4\">ä¼˜ç¼ºç‚¹åˆ†æ</h3>\n<p><strong>ä¼˜ç‚¹ï¼š</strong></p>\n<ol>\n<li><strong>è®¾è®¡ä¼˜é›…</strong>ï¼šAPIè®¾è®¡ä¸€è‡´ä¸”æ˜“äºä½¿ç”¨</li>\n<li><strong>åŠŸèƒ½å®Œå–„</strong>ï¼šæ”¯æŒæƒé‡ã€åˆ·æ–°ã€ç›‘å¬å™¨ç­‰é«˜çº§åŠŸèƒ½</li>\n<li><strong>Googleç»´æŠ¤</strong>ï¼šè´¨é‡æœ‰ä¿éšœï¼Œæ–‡æ¡£å®Œå–„</li>\n<li><strong>ç”Ÿæ€ä¸°å¯Œ</strong>ï¼šGuavaåº“çš„å…¶ä»–åŠŸèƒ½å¯ä»¥ååŒå·¥ä½œ</li>\n</ol>\n<p><strong>ç¼ºç‚¹ï¼š</strong></p>\n<ol>\n<li><strong>æ€§èƒ½ä¸å¦‚Caffeine</strong>ï¼šåœ¨å¹¶å‘æé«˜åœºæ™¯ä¸‹æ€§èƒ½ç¨å·®</li>\n<li><strong>åœæ­¢æ¼”è¿›</strong>ï¼šæ–°åŠŸèƒ½å¼€å‘åŸºæœ¬åœæ­¢</li>\n<li><strong>å†…å­˜å ç”¨</strong>ï¼šç»Ÿè®¡ä¿¡æ¯ç­‰å¼€é”€è¾ƒå¤§</li>\n<li><strong>Java 8ç‰¹æ€§åˆ©ç”¨ä¸è¶³</strong>ï¼šåŸºäºè¾ƒè€çš„Javaç‰ˆæœ¬è®¾è®¡</li>\n</ol>\n<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>\n<ul>\n<li>å·²ç»ä½¿ç”¨Guavaåº“çš„é¡¹ç›®</li>\n<li>å¯¹APIè®¾è®¡ä¼˜é›…æ€§è¦æ±‚é«˜çš„åœºæ™¯</li>\n<li>ä¸éœ€è¦æè‡´æ€§èƒ½çš„ä¸€èˆ¬ç¼“å­˜éœ€æ±‚</li>\n<li>ä½œä¸ºCaffeineçš„è¿‡æ¸¡æ–¹æ¡ˆ</li>\n</ul>\n<p>æœ‰äº›å°ä¼™ä¼´çš„é¡¹ç›®å› ä¸ºå†å²åŸå› ä¸€ç›´åœ¨ç”¨Guava Cacheï¼Œå®ƒçš„ç¨³å®šæ€§å’ŒåŠŸèƒ½æ€§ç¡®å®èƒ½æ»¡è¶³å¤§å¤šæ•°éœ€æ±‚ã€‚ä½†å¦‚æœæ˜¯æ–°é¡¹ç›®ï¼ŒCaffeineå¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>\n<h2 id=\"08-ç»¼åˆå¯¹æ¯”ä¸é€‰å‹æŒ‡å—\">08 ç»¼åˆå¯¹æ¯”ä¸é€‰å‹æŒ‡å—</h2>\n<p>ç°åœ¨æˆ‘ä»¬å·²ç»æ·±å…¥äº†è§£äº†5ç§æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆï¼Œå¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­é€‰æ‹©å‘¢ï¼Ÿä¸‹é¢çš„å¯¹æ¯”å›¾å’Œé€‰å‹æŒ‡å—å¯ä»¥å¸®åŠ©ä½ åšå‡ºå†³ç­–ã€‚</p>\n<h3 id=\"æ–¹æ¡ˆå¯¹æ¯”æ€»è§ˆ\">æ–¹æ¡ˆå¯¹æ¯”æ€»è§ˆ</h3>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n<h3 id=\"è¯¦ç»†å¯¹æ¯”è¡¨\">è¯¦ç»†å¯¹æ¯”è¡¨</h3>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th><strong>ConcurrentHashMap</strong></th>\n<th><strong>LRUç¼“å­˜</strong></th>\n<th><strong>Ehcache</strong></th>\n<th><strong>Caffeine</strong></th>\n<th><strong>Guava Cache</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ˜“ç”¨æ€§</strong></td>\n<td>æç®€ â­â­â­â­â­</td>\n<td>ç®€å• â­â­â­â­â˜†</td>\n<td>å¤æ‚ â­â­â˜†â˜†â˜†</td>\n<td>ä¸­ç­‰ â­â­â­â˜†â˜†</td>\n<td>è‰¯å¥½ â­â­â­â­â˜†</td>\n</tr>\n<tr>\n<td><strong>åŠŸèƒ½å®Œæ•´æ€§</strong></td>\n<td>åŸºç¡€ â­â˜†â˜†â˜†â˜†</td>\n<td>åŸºæœ¬ â­â­â˜†â˜†â˜†</td>\n<td>å…¨é¢ â­â­â­â­â­</td>\n<td>ä¸°å¯Œ â­â­â­â­â˜†</td>\n<td>å®Œå–„ â­â­â­â­â˜†</td>\n</tr>\n<tr>\n<td><strong>æ€§èƒ½</strong></td>\n<td>æä¼˜ â­â­â­â­â­</td>\n<td>è‰¯å¥½ â­â­â­â˜†â˜†</td>\n<td>ä¸­ç­‰ â­â­â­â˜†â˜†</td>\n<td>å“è¶Š â­â­â­â­â­</td>\n<td>ä¼˜ç§€ â­â­â­â­â˜†</td>\n</tr>\n<tr>\n<td><strong>å†…å­˜ç®¡ç†</strong></td>\n<td>æ— è‡ªåŠ¨ç®¡ç† â­â˜†â˜†â˜†â˜†</td>\n<td>LRUæ·˜æ±° â­â­â­â˜†â˜†</td>\n<td>å¤šçº§ç®¡ç† â­â­â­â­â­</td>\n<td>æ™ºèƒ½æ·˜æ±° â­â­â­â­â˜†</td>\n<td>å®Œå–„ç®¡ç† â­â­â­â­â˜†</td>\n</tr>\n<tr>\n<td><strong>ç¤¾åŒºç”Ÿæ€</strong></td>\n<td>JDKè‡ªå¸¦ â­â­â­â­â­</td>\n<td>JDKè‡ªå¸¦ â­â­â­â­â­</td>\n<td>æˆç†Ÿä½†è€ â­â­â­â˜†â˜†</td>\n<td>æ´»è·ƒå¢é•¿ â­â­â­â­â˜†</td>\n<td>ç¨³å®šä½†åœæ» â­â­â­â˜†â˜†</td>\n</tr>\n<tr>\n<td><strong>é€‚ç”¨è§„æ¨¡</strong></td>\n<td>å°å‹ â­â­â˜†â˜†â˜†</td>\n<td>ä¸­å°å‹ â­â­â­â˜†â˜†</td>\n<td>ä¸­å¤§å‹ â­â­â­â­â˜†</td>\n<td>å…¨è§„æ¨¡ â­â­â­â­â­</td>\n<td>ä¸­å°å‹ â­â­â­â˜†â˜†</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"é€‰å‹å†³ç­–æŒ‡å—\">é€‰å‹å†³ç­–æŒ‡å—</h3>\n<p>æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯å’ŒæŠ€æœ¯è¦æ±‚ï¼Œæˆ‘ç»™å‡ºä»¥ä¸‹é€‰å‹å»ºè®®ï¼š</p>\n<ol>\n<li>\n<p><strong>åˆåˆ›é¡¹ç›®/åŸå‹éªŒè¯</strong> â†’ <strong>ConcurrentHashMap</strong> æˆ– <strong>LRUç¼“å­˜</strong></p>\n<ul>\n<li>ç†ç”±ï¼šå¿«é€Ÿå®ç°ï¼Œæ— éœ€å¼•å…¥å¤–éƒ¨ä¾èµ–</li>\n<li>æ³¨æ„ï¼šéšç€ä¸šåŠ¡å¢é•¿ï¼Œéœ€è¦é‡æ„ä¸ºæ›´ä¸“ä¸šçš„æ–¹æ¡ˆ</li>\n</ul>\n</li>\n<li>\n<p><strong>é«˜æ€§èƒ½è¦æ±‚/ç°ä»£Javaé¡¹ç›®</strong> â†’ <strong>Caffeine</strong></p>\n<ul>\n<li>ç†ç”±ï¼šæœ€ä¼˜çš„æ€§èƒ½å’Œå‘½ä¸­ç‡</li>\n<li>æ³¨æ„ï¼šéœ€è¦Java 8+ç¯å¢ƒ</li>\n</ul>\n</li>\n<li>\n<p><strong>ä¼ä¸šçº§å¤æ‚éœ€æ±‚</strong> â†’ <strong>Ehcache</strong></p>\n<ul>\n<li>ç†ç”±ï¼šåŠŸèƒ½å…¨é¢ï¼Œæ”¯æŒé›†ç¾¤å’ŒæŒä¹…åŒ–</li>\n<li>æ³¨æ„ï¼šé…ç½®è¾ƒå¤æ‚ï¼Œå­¦ä¹ æˆæœ¬é«˜</li>\n</ul>\n</li>\n<li>\n<p><strong>å·²æœ‰Guavaç”Ÿæ€/APIè®¾è®¡ä¼˜å…ˆ</strong> â†’ <strong>Guava Cache</strong></p>\n<ul>\n<li>ç†ç”±ï¼šä¼˜é›…çš„APIï¼Œè‰¯å¥½çš„å¼€å‘è€…ä½“éªŒ</li>\n<li>æ³¨æ„ï¼šæ€§èƒ½ä¸æ˜¯æœ€ä¼˜ï¼Œä¸”ä¸å†ç§¯æå¼€å‘</li>\n</ul>\n</li>\n<li>\n<p><strong>ç‰¹å®šåœºæ™¯éœ€æ±‚</strong>ï¼š</p>\n<ul>\n<li><strong>è®¿é—®æœ‰æ˜æ˜¾çƒ­ç‚¹</strong> â†’ LRUç¼“å­˜</li>\n<li><strong>éœ€è¦è‡ªå®šä¹‰æ·˜æ±°ç­–ç•¥</strong> â†’ åŸºäºConcurrentHashMapè‡ªå®ç°</li>\n<li><strong>å†…å­˜æ•æ„Ÿåœºæ™¯</strong> â†’ Caffeineï¼ˆæ™ºèƒ½æƒé‡æ§åˆ¶ï¼‰</li>\n<li><strong>éœ€è¦ç›‘æ§ç»Ÿè®¡</strong> â†’ Ehcacheæˆ–Caffeine</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"æ€»ç»“\">æ€»ç»“</h2>\n<p>æœ¬åœ°ç¼“å­˜æ˜¯Javaåº”ç”¨ä¸­æå‡æ€§èƒ½çš„åˆ©å™¨ï¼Œé€‰æ‹©æ­£ç¡®çš„æ–¹æ¡ˆå¯ä»¥è®©ç³»ç»Ÿæ€§èƒ½å¾—åˆ°è´¨çš„æå‡ã€‚</p>\n<p>è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æ ¸å¿ƒè¦ç‚¹ï¼š</p>\n<ol>\n<li>\n<p><strong>ConcurrentHashMap</strong>æ˜¯æœ€åŸºç¡€çš„æ–¹æ¡ˆï¼Œé€‚åˆç®€å•åœºæ™¯æˆ–ä½œä¸ºè‡ªå®šä¹‰ç¼“å­˜çš„åŸºç¡€ã€‚</p>\n</li>\n<li>\n<p><strong>LRUç¼“å­˜</strong>åŸºäºLinkedHashMapï¼Œè§£å†³äº†è‡ªåŠ¨æ·˜æ±°çš„é—®é¢˜ï¼Œé€‚åˆè®¿é—®æœ‰çƒ­ç‚¹çš„åœºæ™¯ã€‚</p>\n</li>\n<li>\n<p><strong>Ehcache</strong>æ˜¯ä¼ä¸šçº§é€‰æ‹©ï¼ŒåŠŸèƒ½å…¨é¢ä½†è¾ƒé‡ï¼Œé€‚åˆå¤æ‚çš„ä¼ä¸šåº”ç”¨ã€‚</p>\n</li>\n<li>\n<p><strong>Caffeine</strong>æ˜¯ç°ä»£é«˜æ€§èƒ½ç¼“å­˜åº“ï¼Œæä¾›äº†æœ€ä¼˜çš„å‘½ä¸­ç‡å’Œå¹¶å‘æ€§èƒ½ï¼Œæ˜¯æ–°é¡¹ç›®çš„é¦–é€‰ã€‚</p>\n</li>\n<li>\n<p><strong>Guava Cache</strong>è®¾è®¡ä¼˜é›…ï¼ŒAPIå‹å¥½ï¼Œé€‚åˆå·²ç»ä½¿ç”¨Guavaåº“æˆ–å¯¹APIè®¾è®¡æœ‰è¦æ±‚çš„é¡¹ç›®ã€‚</p>\n</li>\n</ol>\n<p>**è®°ä½ï¼Œæ²¡æœ‰æœ€å¥½çš„ç¼“å­˜æ–¹æ¡ˆï¼Œåªæœ‰æœ€é€‚åˆçš„ç¼“å­˜æ–¹æ¡ˆã€‚</p>\n<p>æˆ‘ä¸ªäººçš„å€¾å‘æ˜¯ï¼šå¯¹äºæ–°é¡¹ç›®ï¼Œä¼˜å…ˆè€ƒè™‘<strong>Caffeine</strong>ï¼›å¯¹äºå·²æœ‰Guavaçš„é¡¹ç›®ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨<strong>Guava Cache</strong>ï¼›å¯¹äºç‰¹åˆ«ç®€å•çš„éœ€æ±‚ï¼Œç”¨<strong>ConcurrentHashMap</strong>æˆ–<strong>LRUç¼“å­˜</strong>ï¼›å¯¹äºéœ€è¦ä¼ä¸šçº§ç‰¹æ€§çš„åœºæ™¯ï¼Œé€‰æ‹©<strong>Ehcache</strong>ã€‚</p>\n<p>ç¼“å­˜è™½å¥½ï¼Œä½†ä¹Ÿè¦åˆç†ä½¿ç”¨ã€‚è¿‡åº¦ç¼“å­˜ä¼šå¢åŠ ç³»ç»Ÿå¤æ‚æ€§ï¼Œç¼“å­˜ä¸ä¸€è‡´ä¼šå¯¼è‡´ä¸šåŠ¡é—®é¢˜ã€‚</p>\n<h2 id=\"æœ€åè¯´ä¸€å¥æ±‚å…³æ³¨åˆ«ç™½å«–æˆ‘\">æœ€åè¯´ä¸€å¥(æ±‚å…³æ³¨ï¼Œåˆ«ç™½å«–æˆ‘)</h2>\n<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œæˆ–è€…æœ‰æ‰€å¯å‘çš„è¯ï¼Œå¸®å¿™å…³æ³¨ä¸€ä¸‹æˆ‘çš„åŒåå…¬ä¼—å·ï¼šè‹ä¸‰è¯´æŠ€æœ¯ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘åšæŒå†™ä½œæœ€å¤§çš„åŠ¨åŠ›ã€‚</p>\n<p>æ±‚ä¸€é”®ä¸‰è¿ï¼šç‚¹èµã€è½¬å‘ã€åœ¨çœ‹ã€‚</p>\n<p>å…³æ³¨å…¬ä¼—å·ï¼šã€è‹ä¸‰è¯´æŠ€æœ¯ã€‘ï¼Œåœ¨å…¬ä¼—å·ä¸­å›å¤ï¼šè¿›å¤§å‚ï¼Œå¯ä»¥å…è´¹è·å–æˆ‘æœ€è¿‘æ•´ç†çš„10ä¸‡å­—çš„é¢è¯•å®å…¸ï¼Œå¥½å¤šå°ä¼™ä¼´é è¿™ä¸ªå®å…¸æ‹¿åˆ°äº†å¤šå®¶å¤§å‚çš„offerã€‚</p>\n<p>æ›´å¤šé¡¹ç›®å®æˆ˜åœ¨æˆ‘çš„æŠ€æœ¯ç½‘ç«™ï¼š<a href=\"http://www.susan.net.cn/project\" rel=\"noopener nofollow\" target=\"_blank\">http://www.susan.net.cn/project</a></p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 09:55</span>&nbsp;\n<a href=\"https://www.cnblogs.com/12lisu\">è‹ä¸‰è¯´æŠ€æœ¯</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">237</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">1</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "C#/.NET/.NET CoreæŠ€æœ¯å‰æ²¿å‘¨åˆŠ | ç¬¬ 65 æœŸï¼ˆ2026å¹´1.1-1.11ï¼‰",
      "link": "https://www.cnblogs.com/Can-daydayup/p/19479370",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/Can-daydayup/p/19479370\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-13 22:12\">\n    <span>C#/.NET/.NET CoreæŠ€æœ¯å‰æ²¿å‘¨åˆŠ | ç¬¬ 65 æœŸï¼ˆ2026å¹´1.1-1.11ï¼‰</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1336199/202509/1336199-20250902130707396-140987169.png\" /></p>\n<h2><span>å‰è¨€</span></h2>\n<p><span>C#/.NET/.NET CoreæŠ€æœ¯å‰æ²¿å‘¨åˆŠï¼Œä½ çš„æ¯å‘¨æŠ€æœ¯æŒ‡å—é’ˆï¼è®°å½•ã€è¿½è¸ªC#/.NET/.NET Coreé¢†åŸŸã€ç”Ÿæ€çš„æ¯å‘¨æœ€æ–°ã€æœ€å®ç”¨ã€æœ€æœ‰ä»·å€¼çš„æŠ€æœ¯æ–‡ç« ã€ç¤¾åŒºåŠ¨æ€ã€ä¼˜è´¨é¡¹ç›®å’Œå­¦ä¹ èµ„æºç­‰ã€‚è®©ä½ æ—¶åˆ»ç«™åœ¨æŠ€æœ¯å‰æ²¿ï¼ŒåŠ©åŠ›æŠ€æœ¯æˆé•¿ä¸è§†é‡æ‹“å®½ã€‚</span></p>\n<blockquote>\n<p><span>æ¬¢è¿æŠ•ç¨¿ã€æ¨èæˆ–è‡ªèä¼˜è´¨æ–‡ç« ã€é¡¹ç›®ã€å­¦ä¹ èµ„æºç­‰ã€‚</span></p>\n</blockquote>\n<ul class=\"list-paddingleft-1\">\n<li><strong>ğŸ†æŠ€æœ¯å‰æ²¿å‘¨åˆŠGiteeå¼€æºåœ°å€ï¼š</strong><span>https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetWeekly.md</span></li>\n<li><strong>ğŸ“°æŠ€æœ¯å‰æ²¿å‘¨åˆŠGitHubå¼€æºåœ°å€ï¼š</strong><span>https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetWeekly.md</span></li>\n</ul>\n<h2><span><span>TIOBE å…¬å¸ƒ C# æ˜¯ 2025 å¹´åº¦ç¼–ç¨‹è¯­è¨€</span></span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;TIOBE å…¬å¸ƒçš„æ•°æ®æ˜¾ç¤ºï¼ŒC# ä»¥ 2.94% çš„å¹´åº¦æœ€å¤§æ¶¨å¹…å†åº¦è·è¯„2025 å¹´åº¦ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨è¿‘ä¸‰å¹´å†…ï¼ŒC# ç¬¬äºŒæ¬¡è¢« TIOBE æŒ‡æ•°è¯„ä¸ºå¹´åº¦ç¼–ç¨‹è¯­è¨€ã€‚è¿™ä¸€è£èª‰æˆäºˆäº†åœ¨å¹´åº¦æ’åä¸­æ¶¨å¹…æœ€å¤§çš„ç¼–ç¨‹è¯­è¨€ï¼Œè€Œ C# æ­£æ˜¯å‡­å€Ÿè¿™ä¸€æœ€å¤§å¢å¹…è·æ­¤æ®Šè£ã€‚å¤šå¹´æ¥ï¼ŒC# ç»å†äº†æ ¹æœ¬æ€§çš„å˜é©ï¼šä»è¯­è¨€è®¾è®¡çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒå¸¸å¸¸æ˜¯ä¸»æµç¼–ç¨‹è¯­è¨€ä¸­ç‡å…ˆé‡‡çº³æ–°è¶‹åŠ¿çš„å…ˆè¡Œè€…ã€‚ä¸æ­¤åŒæ—¶ï¼ŒC# æˆåŠŸå®ç°äº†ä¸¤æ¬¡é‡å¤§è½¬å‹ï¼šä¸€æ˜¯ä»ä»…é™ Windows å¹³å°è½¬å‘è·¨å¹³å°æ”¯æŒï¼ŒäºŒæ˜¯ä»å¾®è½¯ä¸“å±èµ°å‘å¼€æºã€‚C# æ€»èƒ½åœ¨å…³é”®æ—¶åˆ»åŠæ—¶æ¼”è¿›ï¼ŒæŒç»­ä¿æŒæ´»åŠ›ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span><a class=\"normal_text_link mp_article_text_link\" href=\"https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519243&amp;idx=1&amp;sn=4f8f058fff3a4cef01ff37453aeb2ce9&amp;scene=21#wechat_redirect\" rel=\"noopener nofollow\" target=\"_blank\">https://mp.weixin.qq.com/s/Fd71l1ino3oTWA_ZKyttnA</a></span></li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1336199/202601/1336199-20260113221107944-1279102449.png\" /></p>\n<h2><span>2026 å¹´ C<a class=\"wx_topic_link\">#ä¸­å¸¦æœ‰å¤§å‹è¯­è¨€æ¨¡å‹çš„ç”Ÿæˆå¼äººå·¥æ™ºèƒ½</a></span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;ç”Ÿæˆå¼äººå·¥æ™ºèƒ½æˆä¸ºå†å²ä¸Šå¢é•¿æœ€å¿«çš„æ¶ˆè´¹æŠ€æœ¯ï¼Œè¶…è¿‡äº† Instagram å’Œ TikTokï¼Œåœ¨ä¸åˆ°ä¸¤ä¸ªæœˆçš„æ—¶é—´å†…è¾¾åˆ°äº† 1 äº¿ç”¨æˆ·ã€‚2022 å¹´åº•ï¼ŒOpenAI å‘å¸ƒäº† GPT-3.5 çš„å…è´¹é¢„è§ˆç‰ˆï¼Œä½œä¸ºå¯¹è¯å¼èŠå¤©å®¢æˆ·ç«¯ ChatGPTã€‚è¯¥æ¨¡å‹é€šè¿‡äººç±»åé¦ˆå¼ºåŒ–å­¦ä¹ ï¼ˆ<span>RLHFï¼‰è¿›è¡Œäº†å¾®è°ƒï¼Œæ ‡å¿—ç€ç”Ÿæˆå¼äººå·¥æ™ºèƒ½è¿›å…¥ä¸»æµè®¤çŸ¥çš„æ—¶åˆ»ã€‚2023 å¹´åˆï¼ŒMicrosoft é€šè¿‡æ¨å‡º Azure OpenAI æœåŠ¡ä½œå‡ºå›åº”ï¼Œå…è®¸å¼€å‘è€…åœ¨ Azure ç®¡ç†ç«¯ç‚¹åå®‰å…¨é…ç½®å’Œä½¿ç”¨å…¼å®¹ OpenAI çš„æ¨¡å‹ã€‚</span></span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span>&nbsp;https://devblogs.microsoft.com/dotnet/generative-ai-with-large-language-models-in-dotnet-and-csharp/</span></li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1336199/202601/1336199-20260113221119628-1072141145.png\" /></p>\n<h2><span>å®‰å…¨ä¸æ™ºèƒ½ï¼šMongoDB EF Core Provider ä¸­çš„å¯æŸ¥è¯¢åŠ å¯†ä¸çŸ¢é‡æœç´¢</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;MongoDB å®ä½“æ¡†æ¶ï¼ˆEFï¼‰æ ¸å¿ƒæä¾›è€…è‡ª 2024 å¹´ 5 æœˆèµ·å·²æ­£å¼å‘å¸ƒã€‚è‡ªå‘å¸ƒä»¥æ¥ï¼Œæˆ‘ä»¬å¯¹ .NET å¼€å‘è€…ç¤¾åŒºçš„ç§¯æåå“ä»¥åŠå…¶åœ¨å¹¿æ³›åº”ç”¨ä¸­çš„æ—¥ç›Šæ™®åŠæ„Ÿåˆ°éå¸¸å…´å¥‹ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span>&nbsp;https://devblogs.microsoft.com/dotnet/mongodb-efcore-provider-queryable-encryption-vector-search/</span></li>\n</ul>\n<h2><span>C#/.NET/.NET Coreä¼˜ç§€é¡¹ç›®å’Œæ¡†æ¶2025å¹´12æœˆç®€æŠ¥</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;å…¬ä¼—å·æ¯æœˆå®šæœŸæ¨å¹¿å’Œåˆ†äº«çš„C#/.NET/.NET Coreä¼˜ç§€é¡¹ç›®å’Œæ¡†æ¶ï¼ˆæ¯å‘¨è‡³å°‘ä¼šæ¨èä¸¤ä¸ªä¼˜ç§€çš„é¡¹ç›®å’Œæ¡†æ¶å½“ç„¶èŠ‚å‡æ—¥é™¤å¤–ï¼‰ï¼Œå…¬ä¼—å·æ¨æ–‡ä¸­æœ‰é¡¹ç›®å’Œæ¡†æ¶çš„è¯¦ç»†ä»‹ç»ã€åŠŸèƒ½ç‰¹ç‚¹ã€ä½¿ç”¨æ–¹å¼ä»¥åŠéƒ¨åˆ†åŠŸèƒ½æˆªå›¾ç­‰ï¼ˆæ‰“ä¸å¼€æˆ–è€…æ‰“å¼€GitHubå¾ˆæ…¢çš„åŒå­¦å¯ä»¥ä¼˜å…ˆæŸ¥çœ‹å…¬ä¼—å·æ¨æ–‡ï¼Œæ–‡æœ«ä¸€å®šä¼šé™„å¸¦é¡¹ç›®å’Œæ¡†æ¶æºç åœ°å€ï¼‰ã€‚æ³¨æ„ï¼šæ’åä¸åˆ†å…ˆåï¼Œéƒ½æ˜¯ååˆ†ä¼˜ç§€çš„å¼€æºé¡¹ç›®å’Œæ¡†æ¶ï¼Œæ¯å‘¨å®šæœŸæ›´æ–°åˆ†äº«ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span><a class=\"normal_text_link mp_article_text_link\" href=\"https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519171&amp;idx=1&amp;sn=9ce33aa68158372f1beec564643e0f9a&amp;scene=21#wechat_redirect\" rel=\"noopener nofollow\" target=\"_blank\">https://mp.weixin.qq.com/s/t4Mv4g8WbHbTWeZJjb3tzw</a></span></li>\n</ul>\n<h2><span>è®© WinForm.NET å†æ¬¡ä¼Ÿå¤§ï¼ä¸€ä¸ªä¸“é—¨è®¾è®¡ç”¨äºå¸®åŠ© WinForms åº”ç”¨ç¨‹åºè¿ç§»åˆ° Blazor WASM å¹³å°çš„é¡¹ç›®</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;MWGAï¼ˆMake WinForms Great Againï¼‰ æ˜¯ä¸€ä¸ªä¸“é—¨è®¾è®¡ç”¨äºå¸®åŠ© WinForms åº”ç”¨ç¨‹åºè¿ç§»åˆ° Blazor WASM å¹³å°çš„é¡¹ç›®ï¼Œå³ä½¿è¿™äº› WinForms åº”ç”¨ç¨‹åºä½¿ç”¨ GDI+ åŠŸèƒ½ï¼ŒMWGA é¡¹ç›®ä¹Ÿé¢„æœŸå°†å¯¹è¿™äº›ç¨‹åºæºç çš„ä¿®æ”¹é‡ä¸è¶…è¿‡10%ã€‚è¿™æå¤§çš„é™ä½ WinForms è½¯ä»¶ç°ä»£åŒ–çš„æˆæœ¬å’Œé£é™©ã€‚æ³¨æ„è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªå·¨å¤§çš„å·¥ç¨‹ç›®å‰è¿˜åœ¨é€æ­¥è§„åˆ’ã€å®Œå–„ä¸­ï¼Œå½“å‰å·²å¼€æºæ¼”ç¤ºé¡¹ç›®ï¼Œä¸»è¦ç”¨äºç»™å¤§å®¶æ¼”ç¤ºè¿ç§»æµç¨‹ä¸éªŒè¯å…¼å®¹æ€§ï¼ˆå¤§å®¶æœ‰æ›´å¥½çš„æƒ³æ³•æˆ–è§£å†³æ–¹æ¡ˆæ¬¢è¿å‰å¾€å¼€æºåœ°å€æIssuesï¼‰ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span><a class=\"normal_text_link mp_article_text_link\" href=\"https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519200&amp;idx=1&amp;sn=0c792aba422e0c8b327627a50bbdc852&amp;scene=21#wechat_redirect\" rel=\"noopener nofollow\" target=\"_blank\">https://mp.weixin.qq.com/s/2-JM1l6avTtjqhyPjgYr3g</a></span></li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1336199/202601/1336199-20260113221133397-1718029011.png\" /></p>\n<h2><span>ä¸€ä¸ªåŸºäº C# ç¼–å†™ã€å¤šåŠŸèƒ½çš„ä¸Šä½æœºè½¯ä»¶ï¼Œé›†æˆäº†ä¸²å£åŠ©æ‰‹ã€è™šæ‹Ÿç¤ºæ³¢å™¨ä»¥åŠæ‘„åƒå¤´å›¾åƒæ˜¾ç¤ºç­‰å¤šç§å®ç”¨åŠŸèƒ½ï¼</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;é€é£åŠ©æ‰‹æ˜¯ä¸€ä¸ªåŸºäºC<a class=\"wx_topic_link\">#ç¼–å†™çš„å¤šåŠŸèƒ½ä¸Šä½æœºè½¯ä»¶</a>ã€‚è¯¥è½¯ä»¶é›†æˆäº†ä¸²å£åŠ©æ‰‹ã€è™šæ‹Ÿç¤ºæ³¢å™¨ä»¥åŠæ‘„åƒå¤´å›¾åƒæ˜¾ç¤ºç­‰å¤šç§å®ç”¨åŠŸèƒ½ï¼Œæ—¨åœ¨ä¸ºç”¨æˆ·æä¾›ä¾¿æ·ã€é«˜æ•ˆçš„æ•°æ®è°ƒè¯•ä¸ç›‘æ§è§£å†³æ–¹æ¡ˆã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span><a class=\"normal_text_link mp_article_text_link\" href=\"https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519244&amp;idx=2&amp;sn=0b8a409743f5e18bb2211ad347e4a3fa&amp;scene=21#wechat_redirect\" rel=\"noopener nofollow\" target=\"_blank\">https://mp.weixin.qq.com/s/kIWtt1OsojIg7A5MTO3xXA</a></span></li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1336199/202601/1336199-20260113221146684-2612195.png\" /></p>\n<h2><span>dotnet 10 run file æ”¯æŒå¤šæ–‡ä»¶</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;dotnet 10 run file æ”¯æŒå¤šæ–‡ä»¶ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span><a class=\"normal_text_link mp_article_text_link\" href=\"https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519244&amp;idx=3&amp;sn=9dda0fa330566ba7d29cf7a6f6103806&amp;scene=21#wechat_redirect\" rel=\"noopener nofollow\" target=\"_blank\">https://mp.weixin.qq.com/s/p8Za-HrjSLxOhc1Qp5lCuA</a></span></li>\n</ul>\n<h2><span>ä¸€æ¬¾å¼€æºã€å…è´¹çš„ WPF è‡ªå®šä¹‰æ§ä»¶é›†</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;PropertyTools æ˜¯ä¸€æ¬¾å¼€æºï¼ˆMIT licenseï¼‰ã€å…è´¹çš„ WPF è‡ªå®šä¹‰æ§ä»¶é›†ï¼Œè¯¥æ§ä»¶é›†æ¶µç›–äº† PropertyGridã€DataGridã€æ”¯æŒå¤šé€‰çš„ TreeViewã€ColorPicker ç­‰å¸¸ç”¨æ§ä»¶ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span><a class=\"normal_text_link mp_article_text_link\" href=\"https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519334&amp;idx=1&amp;sn=e163b6f037627858c7ddd0fa8befb76b&amp;scene=21#wechat_redirect\" rel=\"noopener nofollow\" target=\"_blank\">https://mp.weixin.qq.com/s/fLsTZWyY1W7UFJWCmIa4mQ</a></span></li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1336199/202601/1336199-20260113221158997-22872837.png\" /></p>\n<h2><span>ä¸€ä¸ªåŸºäº C# å’Œ Halcon æœºå™¨è§†è§‰å¼€å‘çš„è½¦ç‰Œè¯†åˆ«å·¥å…·</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;halcon_chepaiä¸€æ¬¾åŸºäºC<a class=\"wx_topic_link\">#ç¼–ç¨‹è¯­è¨€ä¸Halconæœºå™¨è§†è§‰åº“çš„è½¦ç‰Œè¯†åˆ«ç³»ç»Ÿ</a>ã€‚è¯¥ç³»ç»Ÿåˆ©ç”¨Halconå¼ºå¤§çš„å›¾åƒå¤„ç†èƒ½åŠ›ï¼Œç»“åˆC<a class=\"wx_topic_link\">#çš„çµæ´»æ€§ä¸æ˜“ç”¨æ€§</a>ï¼Œå®ç°äº†é«˜æ•ˆã€å‡†ç¡®çš„è½¦ç‰Œè¯†åˆ«åŠŸèƒ½ã€‚è¯†åˆ«æˆåŠŸç‡é«˜è¾¾90%ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span><a class=\"normal_text_link mp_article_text_link\" href=\"https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519334&amp;idx=2&amp;sn=b2929b41edecf59aa2fb578d28f99ec3&amp;scene=21#wechat_redirect\" rel=\"noopener nofollow\" target=\"_blank\">https://mp.weixin.qq.com/s/Bpz36wWHhK2MPQ9YR6y8TA</a></span></li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1336199/202601/1336199-20260113221209763-194195567.png\" /></p>\n<h2><span>ç²¾é€‰ 10 æ¬¾ .NET å¼€æºå…è´¹ã€åŠŸèƒ½å¼ºå¤§çš„ Windows æ•ˆç‡è½¯ä»¶</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;åœ¨å½“ä»Šå¿«èŠ‚å¥çš„æ•°å­—å·¥ä½œç¯å¢ƒä¸­ï¼Œæ•ˆç‡å·¥å…·å·²æˆä¸ºå¼€å‘è€…ã€ITä¸“ä¸šäººå£«ä¹ƒè‡³æ™®é€šç”¨æˆ·æå‡ç”Ÿäº§åŠ›çš„å…³é”®åŠ©åŠ›ã€‚ä»Šå¤©å¤§å§šç»™å¤§å®¶åˆ†äº« 10 æ¬¾ .NET å¼€æºå…è´¹ã€åŠŸèƒ½å¼ºå¤§çš„ Windows æ•ˆç‡è½¯ä»¶ï¼Œå¼€å‘å·¥ä½œæå‡åˆ©å™¨ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°æœ‰éœ€è¦çš„å°ä¼™ä¼´ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span><a class=\"normal_text_link mp_article_text_link\" href=\"https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519364&amp;idx=1&amp;sn=f5b8f0ece898b9087f03c5ba58fcad86&amp;scene=21#wechat_redirect\" rel=\"noopener nofollow\" target=\"_blank\">https://mp.weixin.qq.com/s/QvF0X_dR85ISeeWJcbSmdg</a></span></li>\n</ul>\n<h2><span>C<a class=\"wx_topic_link\">#ä¸­çš„7ç§æ„é€ å‡½æ•°</a>ï¼Œä½ éƒ½ç”¨è¿‡å—ï¼Ÿ</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;åœ¨ C# ä¸­ï¼Œæ„é€ å‡½æ•°æ˜¯å¯¹è±¡åˆ›å»ºæ—¶è‡ªåŠ¨æ‰§è¡Œçš„ç‰¹æ®Šæ–¹æ³•ï¼Œç”¨äºåˆå§‹åŒ–å®ä¾‹çŠ¶æ€ã€‚å®ƒä¸è¿”å›å€¼ï¼Œåç§°å¿…é¡»ä¸ç±»åä¸€è‡´ã€‚æ ¹æ®ä½¿ç”¨åœºæ™¯ä¸åŒï¼ŒC# æ”¯æŒå¤šç§æ„é€ å‡½æ•°å½¢å¼ï¼Œæ¯ç§éƒ½æœåŠ¡äºç‰¹å®šçš„åˆå§‹åŒ–éœ€æ±‚ã€‚æŒæ¡è¿™äº›ç±»å‹ï¼Œæœ‰åŠ©äºå†™å‡ºæ›´æ¸…æ™°ã€çµæ´»ä¸”å¯ç»´æŠ¤çš„ä»£ç ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span><a class=\"normal_text_link mp_article_text_link\" href=\"https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519364&amp;idx=2&amp;sn=ec78c18a7d94de1797fb5e38ec06a621&amp;scene=21#wechat_redirect\" rel=\"noopener nofollow\" target=\"_blank\">https://mp.weixin.qq.com/s/C9UazT3ytk-VbGy3qzSYPw</a></span></li>\n</ul>\n<h2><span>ä¸€ä¸ªé’ˆå¯¹ Microsoft Office åº”ç”¨ç¨‹åºçš„ .NET å°è£…åº“ï¼Œæ—¨åœ¨ç®€åŒ– Office COM ç»„ä»¶çš„ä½¿ç”¨</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;OfficeInterop æ˜¯ä¸€ä¸ªé’ˆå¯¹ Microsoft Office åº”ç”¨ç¨‹åºçš„ .NET å°è£…åº“ï¼Œå…¶æ ¸å¿ƒç›®æ ‡æ˜¯ç®€åŒ– Office COM ç»„ä»¶çš„ä½¿ç”¨ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿæ›´æ–¹ä¾¿ã€æ›´é«˜æ•ˆåœ°åœ¨ .NET ç¯å¢ƒä¸­æ“ä½œ Office åº”ç”¨ç¨‹åºï¼Œå¦‚ Excelã€Word ç­‰ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span><a class=\"normal_text_link mp_article_text_link\" href=\"https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519132&amp;idx=1&amp;sn=30d44be5bd462bdee250a3c7b2b9861e&amp;scene=21#wechat_redirect\" rel=\"noopener nofollow\" target=\"_blank\">https://mp.weixin.qq.com/s/SOJdHwrP-X1suv0v8PNEcg</a></span></li>\n</ul>\n<h2><span>è®°ä¸€æ¬¡ .NET æŸMESä¸Šä½æœºæ‹ç…§ç³»ç»Ÿ å†…å­˜æš´æ¶¨åˆ†æ</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;è¿™æ˜¯è®­ç»ƒè¥é‡Œçš„ä¸€ä½æœ‹å‹æ‰¾åˆ°æˆ‘çš„ï¼Œè¯´ä»–ä»¬çš„ç³»ç»Ÿä¼šæœ‰å¶å‘çš„å†…å­˜æš´æ¶¨æƒ…å†µï¼Œè‡ªå·±ä¹Ÿæ²¡åˆ†æå‡ºæ¥ï¼Œè®©æˆ‘å¸®å¿™çœ‹ä¸‹æ€ä¹ˆå›äº‹ï¼Œæ‹¿äº†ä¸€ä¸ª20G+çš„dumpæ–‡ä»¶ï¼Œè¿™æ–‡ä»¶æ˜¯å¤Ÿå¤§çš„ï¼Œæˆ‘ä¸ªäººå»ºè®®ä¸€èˆ¬æ˜¯ä¸è¶…è¿‡10Gï¼Œä¸ç„¶çš„è¯windbgåˆ†æèµ·æ¥å¾ˆåƒåŠ›ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span>&nbsp;https://www.cnblogs.com/huangxincheng/p/19450501</span></li>\n</ul>\n<h2><span>ã€è¯‘ã€‘Visual Studio 11 æœˆæ›´æ–° â€”â€” Visual Studio 2026ã€Cloud Agent Preview åŠæ›´å¤šå†…å®¹</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;å¦‚æœæ‚¨è¿˜æ²¡å¬è¯´è¿™ä¸ªæ¶ˆæ¯ï¼Œæˆ‘ä»¬å¾ˆå…´å¥‹åœ°å’Œæ‚¨åˆ†äº«ï¼šVisual Studio 2026 ç°å·²å…¨é¢å‘å¸ƒï¼è¿™ä¸ªæ–°ç‰ˆæœ¬åœ¨å¤šé¡¹æ€§èƒ½æ”¹è¿›ã€é‡æ–°è®¾è®¡çš„ç”¨æˆ·ä½“éªŒä»¥åŠäººå·¥æ™ºèƒ½é©±åŠ¨çš„å¼€å‘æ–¹é¢å®ç°äº†é‡å¤§é£è·ƒï¼Œèƒ½ä¸ºæ‚¨æä¾›æ›´å¥½çš„å¸®åŠ©ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span>&nbsp;https://www.cnblogs.com/MeteorSeed/p/19441728</span></li>\n</ul>\n<h2><span>ä½¿ç”¨ C# å’Œ SQL Server è‡ªåŠ¨åŒ–é‚®ä»¶ä¸­çš„ç”¨æˆ·åˆ†é…æ•°æ®å¤„ç†</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;åœ¨é‡‘èåº”ç”¨é¢†åŸŸï¼Œé€šè¿‡ç”µå­é‚®ä»¶æ‰‹åŠ¨ç®¡ç†ç”¨æˆ·åˆ†é…æ•°æ®ä¸ä»…è€—æ—¶è€Œä¸”å®¹æ˜“å‡ºé”™ã€‚ä¼ ç»Ÿçš„äººå·¥å¤„ç†æ–¹å¼éœ€è¦å·¥ä½œäººå‘˜æ¯å¤©æ£€æŸ¥é‚®ä»¶ã€ä¸‹è½½é™„ä»¶ã€è§£ææ•°æ®å¹¶æ›´æ–°æ•°æ®åº“ï¼Œè¿™ä¸€ç³»åˆ—é‡å¤æ€§å·¥ä½œæ—¢ä½æ•ˆåˆå­˜åœ¨æ•°æ®å½•å…¥é”™è¯¯çš„é£é™©ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åˆ©ç”¨ C# å’Œ SQL Server æ„å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆï¼Œå®ç°ä»é‚®ä»¶è¯»å–ã€é™„ä»¶ä¸‹è½½åˆ°æ•°æ®åº“æ›´æ–°çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–å¤„ç†ã€‚è¯¥ç³»ç»Ÿç‰¹åˆ«é€‚ç”¨äºå¤„ç†ä¸»é¢˜åŒ…å«\"AllotmentsFiles\"çš„é‚®ä»¶ï¼Œå¹¶æ›´æ–° SQL Server ä¸­çš„ bidfiledetails è¡¨ï¼Œæ˜¾è‘—æé«˜æ•°æ®å¤„ç†æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span>&nbsp;https://www.cnblogs.com/powertoolsteam/p/19444281</span></li>\n</ul>\n<h2><span>Zenith.NET v0.0.2 å‘å¸ƒ ğŸ‰ â€” ç»Ÿä¸€çš„ .NET GPU ç¼–ç¨‹åº“ï¼Œæ”¯æŒ DX12/Vulkan + 6 å¤§ UI æ¡†æ¶</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;Zenith.NET æ˜¯ä¸€ä¸ªç°ä»£çš„ã€è·¨å¹³å°çš„ .NET å›¾å½¢ä¸è®¡ç®—åº“ï¼Œæ—¨åœ¨ä¸º .NET å¼€å‘è€…æä¾›ç»Ÿä¸€çš„ GPU ç¼–ç¨‹æ¥å£ã€‚æ— è®ºä½ æ˜¯è¦åšé«˜æ€§èƒ½æ¸²æŸ“ã€å›¾å½¢åº”ç”¨ï¼Œè¿˜æ˜¯ GPU é€šç”¨è®¡ç®—ï¼ŒZenith.NET éƒ½èƒ½å¸®ä½ å±è”½åº•å±‚ API çš„å·®å¼‚ï¼Œè®©ä»£ç åœ¨ä¸åŒå¹³å°ä¸Šæ— ç¼è¿è¡Œã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span>&nbsp;https://www.cnblogs.com/xymfblogs/p/19443277</span></li>\n</ul>\n<h2><span>.NET 10 New feature æ–°å¢åŠŸèƒ½ä»‹ç»-WebSocketåŠŸèƒ½å¢å¼º</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;.NET 10 æ–°å¢äº† WebSocketStreamä¸€ä¸ªæ–°çš„ APIï¼Œç”¨äºç®€åŒ– .NET ä¸­ä¸€äº›æœ€å¸¸è§çš„WebSocket çš„æµå¼å¤„ç†æ–¹æ¡ˆã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span>&nbsp;https://www.cnblogs.com/tianqing/p/19439916</span></li>\n</ul>\n<h2><span>.NET+AI | åŸºäº Microsoft Agent Framework ä¸€æ­¥æ­¥é›†æˆ Agent Skillsï¼Œè®©ä½ çš„ <span>AI Agent æ›´æ™ºèƒ½</span></span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;éšç€ AI Agent æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼Œå¦‚ä½•è®© Agent å…·å¤‡å¯å¤ç”¨ã€å¯æ‰©å±•çš„ä¸“ä¸šèƒ½åŠ›æˆä¸ºä¸€ä¸ªé‡è¦è¯¾é¢˜ã€‚Agent Skills è§„èŒƒæä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹å¼æ¥å®šä¹‰å’Œåˆ†å‘ Agent æŠ€èƒ½ï¼Œè€Œ Microsoft Agent Framework (<span>MAF) åˆ™æä¾›äº†æ„å»º AI Agent çš„å¼ºå¤§åŸºç¡€è®¾æ–½ã€‚æœ¬æ–‡å°†æ·±å…¥ä»‹ç»å¦‚ä½•åŸºäº MAF çš„ä¸Šä¸‹æ–‡æ‰©å±•ï¼ˆAIContextProviderï¼‰å®ç° Agent Skills çš„é›†æˆï¼ŒåŒ…æ‹¬æ ¸å¿ƒæ¶æ„è®¾è®¡ã€å…³é”®ç»„ä»¶å®ç°ä»¥åŠå®é™…åº”ç”¨ç¤ºä¾‹ã€‚</span></span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span>&nbsp;https://www.cnblogs.com/sheng-jie/p/19442149</span></li>\n</ul>\n<h2><span>ä» TIOBE 2025 å¹´åº¦è¯­è¨€åˆ° 2026 å¹´ C# æ™ºèƒ½ä½“ç”Ÿæ€çš„å…¨é¢å´›èµ·</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;2026 å¹´ 1 æœˆï¼Œéšç€ TIOBE æŒ‡æ•°æ­£å¼å®£å¸ƒ C# ä¸º 2025 å¹´åº¦ç¼–ç¨‹è¯­è¨€ï¼Œå…¨çƒè½¯ä»¶å·¥ç¨‹é¢†åŸŸè¿æ¥äº†ä¸€ä¸ªå†³å®šæ€§çš„è½¬æŠ˜ç‚¹ã€‚è¿™ä¸€è£èª‰ä¸ä»…æ˜¯å¯¹ C# è¿‡å»ä¸€å¹´åœ¨æœç´¢çƒ­åº¦å’Œå¼€å‘è€…æ´»è·ƒåº¦ä¸Šå–å¾—æœ€å¤§å¢å¹…çš„è®¤å¯ï¼Œæ›´æ˜¯ä¸€ä¸ªæ»åæŒ‡æ ‡ï¼Œæ­ç¤ºäº†åº•å±‚æŠ€æœ¯èŒƒå¼çš„æ·±åˆ»å˜è¿ã€‚å¦‚æœè¯´è¿‡å»åå¹´æ˜¯ Python ä¾é æ•°æ®ç§‘å­¦å’Œæ¨¡å‹è®­ç»ƒç¡®ç«‹éœ¸æƒçš„æ—¶ä»£ï¼Œé‚£ä¹ˆ 2025 å¹´çš„æ•°æ®è¡¨æ˜ï¼Œè¡Œä¸šé‡å¿ƒæ­£åœ¨ä»â€œæ¨¡å‹æ„å»ºâ€å‘â€œç³»ç»Ÿç¼–æ’â€è½¬ç§»ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span>&nbsp;https://www.cnblogs.com/shanyou/p/19441004</span></li>\n</ul>\n<h2><span>2026ï¼šè®©.NETå†æ¬¡ä¼Ÿå¤§</span></h2>\n<ul class=\"list-paddingleft-1\">\n<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong><span>&nbsp;2026å¹´ï¼Œåº”è¯¥è€ƒè™‘ä¸€ä¸ªæˆ˜ç•¥å†³ç­–â€”â€”å°†.NET SDKçº³å…¥æ“ä½œç³»ç»Ÿï¼Œè¿™å°†å¯¹æ•´ä¸ªå¼€å‘ç”Ÿæ€äº§ç”Ÿæ·±è¿œå½±å“ã€‚</span></li>\n<li><strong>æ–‡ç« åœ°å€ï¼š</strong><span>&nbsp;https://www.cnblogs.com/msdeveloper/p/19427679/make-dotnet-great-again-2026</span></li>\n</ul>\n</div>\n<div id=\"MySignature\">\n    <blockquote>\n<p style=\"font-family: YouYuan; font-size: 16px; margin: 0 auto 0.01em auto;\"><span style=\"font-size: 17px;\">ä½œè€…åç§°ï¼š</span><a href=\"https://www.cnblogs.com/Can-daydayup/\" target=\"_blank\">è¿½é€æ—¶å…‰è€…</a></p>\n<p style=\"font-family: YouYuan; font-size: 16px; margin: 0 auto 0.01em auto;\"><span style=\"font-size: 17px;\">ä½œè€…ç®€ä»‹ï¼š</span>ä¸€ä¸ªçƒ­çˆ±ç¼–ç¨‹ã€å–„äºåˆ†äº«ã€å–œæ¬¢å­¦ä¹ ã€æ¢ç´¢ã€å°è¯•æ–°äº‹ç‰©å’Œæ–°æŠ€æœ¯çš„å…¨æ ˆè½¯ä»¶å·¥ç¨‹å¸ˆã€‚</p>\n<p style=\"font-family: YouYuan; font-size: 16px; margin: 0 auto 0.01em auto;\">\næœ¬æ–‡ç‰ˆæƒå½’ä½œè€…å’Œåšå®¢å›­å…±æœ‰ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„å¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼Œä¸”åœ¨æ–‡ç« é¡µé¢æ˜æ˜¾ä½ç½®ç»™å‡ºåŸæ–‡é“¾æ¥ï¼Œå¦åˆ™ä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»çš„æƒåˆ©ã€‚å¦‚æœè¯¥ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©çš„è¯ï¼Œå¯ä»¥ç‚¹ä¸€ä¸‹å³ä¸‹è§’çš„<a href=\"\" style=\"color: red;\">ã€â™¥æ¨èâ™¥ã€‘</a>ï¼Œå¸Œæœ›èƒ½å¤ŸæŒç»­çš„ä¸ºå¤§å®¶å¸¦æ¥å¥½çš„æŠ€æœ¯æ–‡ç« ï¼Œæ–‡ä¸­å¯èƒ½å­˜åœ¨æè¿°ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£æˆ–è¡¥å……ï¼Œä¸èƒœæ„Ÿæ¿€ã€‚\n</p>\n</blockquote>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-13 22:12</span>&nbsp;\n<a href=\"https://www.cnblogs.com/Can-daydayup\">è¿½é€æ—¶å…‰è€…</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">294</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "Spring IOC æºç å­¦ä¹  ä¸€æ–‡å­¦ä¹ å®Œæ•´çš„åŠ è½½æµç¨‹",
      "link": "https://www.cnblogs.com/dddy/p/19479364",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/dddy/p/19479364\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-13 22:09\">\n    <span>Spring IOC æºç å­¦ä¹  ä¸€æ–‡å­¦ä¹ å®Œæ•´çš„åŠ è½½æµç¨‹</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"ioc-çš„å…¥å£è¯´æ˜\">IOC çš„å…¥å£è¯´æ˜</h1>\n<h2 id=\"applicationcontext-å¯¹è±¡\">ApplicationContext å¯¹è±¡</h2>\n<p><strong>in short å¯ä»¥ç†è§£ä¸ºä½œä¸ºå…·ç°åŒ–çš„ IOC çš„å¯¹è±¡æ ¹æ¥å£, å®ƒæ˜¯ä¸€ä¸ªé‡é‡çº§çš„å¯¹è±¡, æ•´ä¸ªåº”ç”¨æœŸé—´åº”è¯¥ä¿æŒå•ä¾‹</strong></p>\n<p>å®˜æ–‡ Container Overview: <a href=\"https://docs.spring.io/spring-framework/reference/core/beans/basics.html\" rel=\"noopener nofollow\" target=\"_blank\">https://docs.spring.io/spring-framework/reference/core/beans/basics.html</a></p>\n<blockquote>\n<p>The&nbsp;<code>org.springframework.context.ApplicationContext</code>&nbsp;interface represents the Spring IoC container and is responsible for instantiating, configuring, and assembling the beans. The container gets its instructions on the components to instantiate, configure, and assemble by reading configuration metadata. The configuration metadata can be represented as annotated component classes, configuration classes with factory methods, or external XML files or Groovy scripts.</p>\n</blockquote>\n<blockquote>\n<p><code>org.springframework.context.ApplicationContext</code>&nbsp;æ¥å£ä»£è¡¨ Spring IoC å®¹å™¨ï¼Œè´Ÿè´£å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£… beanã€‚å®¹å™¨é€šè¿‡è¯»å–é…ç½®å…ƒæ•°æ®æ¥è·å–å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…ç»„ä»¶çš„æŒ‡ä»¤ã€‚é…ç½®å…ƒæ•°æ®å¯ä»¥è¡¨ç¤ºä¸ºå¸¦æ³¨è§£çš„ç»„ä»¶ç±»ã€å…·æœ‰å·¥å‚æ–¹æ³•çš„é…ç½®ç±»ï¼Œæˆ–å¤–éƒ¨ XML æ–‡ä»¶æˆ– Groovy è„šæœ¬ã€‚</p>\n</blockquote>\n<p>Several implementations of the&nbsp;<code>ApplicationContext</code>&nbsp;interface are part of core Spring. In stand-alone applications, it is common to create an instance of&nbsp;<a href=\"https://docs.spring.io/spring-framework/docs/7.0.1/javadoc-api/org/springframework/context/annotation/AnnotationConfigApplicationContext.html\" rel=\"noopener nofollow\" target=\"_blank\"><code>AnnotationConfigApplicationContext</code></a>&nbsp;or&nbsp;<a href=\"https://docs.spring.io/spring-framework/docs/7.0.1/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html\" rel=\"noopener nofollow\" target=\"_blank\"><code>ClassPathXmlApplicationContext</code></a>.</p>\n<blockquote>\n<p><code>ApplicationContext</code>&nbsp;æ¥å£æœ‰å¤šä¸ªå®ç° , æ˜¯Spring æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ã€‚åœ¨ç‹¬ç«‹åº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸åˆ›å»º&nbsp;<a href=\"https://docs.spring.io/spring-framework/docs/7.0.1/javadoc-api/org/springframework/context/annotation/AnnotationConfigApplicationContext.html\" rel=\"noopener nofollow\" target=\"_blank\"><code>AnnotationConfigApplicationContext</code></a>&nbsp;or&nbsp;<a href=\"https://docs.spring.io/spring-framework/docs/7.0.1/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html\" rel=\"noopener nofollow\" target=\"_blank\"><code>ClassPathXmlApplicationContext</code></a>&nbsp;çš„å®ä¾‹ã€‚</p>\n</blockquote>\n<h2 id=\"xmlå’Œæ³¨è§£-é…ç½®çš„-applicationcontext\">XMLå’Œæ³¨è§£ é…ç½®çš„ ApplicationContext</h2>\n<p>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ Spring IOC é…ç½®å®¹å™¨çš„æ–¹å¼ä¸€èˆ¬æœ‰ä¸¤ç§: 1. é€šè¿‡XMLé…ç½®æ–‡ä»¶,  2. åŸºäºæ³¨è§£çš„å½¢å¼é…ç½®, å®ƒä»¬åˆ†åˆ«æ˜¯å…¥å£ç±»ä¸ä¸€æ ·.</p>\n<ol>\n<li>\n<p>åŸºäºXMLé…ç½®, å®é™…æœ‰ä¸¤ä¸ªç±»å®ç°  <strong>ClassPathXmlApplicationContext</strong> è¿˜æœ‰ä¸€ä¸ªæ˜¯ <strong>FileSystemXmlApplicationContext</strong> <s>(å¾ˆå°‘ç”¨å°±æ˜¯äº†)</s> å®ƒä»¬ä¸»è¦çš„ä»£ç é€»è¾‘éƒ½æ˜¯åœ¨å®ƒçˆ¶ <code>AbstractXmlApplicationContext</code> ä¸­.</p>\n</li>\n<li>\n<p>åŸºäºæ³¨è§£çš„å½¢å¼é…ç½®,  <a href=\"https://docs.spring.io/spring-framework/reference/core/beans/annotation-config.html\" rel=\"noopener nofollow\" target=\"_blank\">Annotation-based configuration</a>  åŸºäº Spring è‡ªå®šä¹‰, ä½¿ç”¨<a href=\"https://docs.spring.io/spring-framework/reference/core/beans/factory-extension.html#beans-factory-extension-bpp-examples-aabpp\" rel=\"noopener nofollow\" target=\"_blank\"><code>AutowiredAnnotationBeanPostProcessor</code></a> å¤„ç†è§£æç›¸å…³æ³¨è§£çš„å®ç°, å¦å¤– JSR 330 ä¸­æ ‡å‡†çš„æ³¨è§£ä¹Ÿæ˜¯å®ƒå¤„ç†çš„.</p>\n</li>\n</ol>\n<p>æœ¬åšæ–‡ä»¥ XML åŠ è½½ä½œä¸ºæºç å…¥å£ç‚¹è¿›è¡Œåˆ†æ:</p>\n<h1 id=\"ä¸Šæ±‡æ€»å¤§å›¾\">ä¸Šæ±‡æ€»å¤§å›¾</h1>\n<p>çœŸçš„å¾ˆå¤§çš„å¤§å›¾..</p>\n<p><img alt=\"Spring IOC å®¹å™¨åŠ è½½çš„è¯¦ç»†æµç¨‹\" class=\"lazyload\" /></p>\n<p>çœ‹ä¸æ¸…, è¯·ä½¿ç”¨åŸç”Ÿæµè§ˆå™¨æ‰“å¼€é“¾æ¥: <a href=\"https://img2024.cnblogs.com/blog/3723410/202601/3723410-20260113220603061-1916535706.jpg\" target=\"_blank\">https://img2024.cnblogs.com/blog/3723410/202601/3723410-20260113220603061-1916535706.jpg</a></p>\n<h1 id=\"xml-å®ä¾‹å…¥å£\">XML å®ä¾‹å…¥å£</h1>\n<h2 id=\"å®ä¾‹ä»£ç \">å®ä¾‹ä»£ç </h2>\n<p><code>org.yang.learn.spring.dto.Address</code></p>\n<pre><code class=\"language-java\">package org.yang.learn.spring.dto;\n\nimport org.springframework.beans.BeansException;\nimport org.springframework.beans.factory.config.BeanPostProcessor;\n\n/**\n * @author yangfh\n * @date 2023-12-14 21:30\n **/\npublic class Address  {\n\tString city;\n\tString country;\n\tString street;\n\n\tpublic Address() {\n\t\tSystem.out.println(\"Address æ— å‚æ„é€ å‡½æ•°: \"+ this.toString());\n\t}\n\n\tpublic Address(String city, String country, String street) {\n\t\tthis.city = city;\n\t\tthis.country = country;\n\t\tthis.street = street;\n\t\tSystem.out.println(\"Address æ„é€ å‡½æ•°: \"+ this.toString());\n\t}\n\t... getter  setter ...\n}\n\n</code></pre>\n<p><code>org.yang.learn.spring.dto.User</code></p>\n<pre><code class=\"language-java\">package org.yang.learn.spring.dto;\n\nimport org.springframework.beans.BeansException;\nimport org.springframework.beans.factory.DisposableBean;\nimport org.springframework.beans.factory.InitializingBean;\nimport org.springframework.beans.factory.config.BeanFactoryPostProcessor;\nimport org.springframework.beans.factory.config.BeanPostProcessor;\nimport org.springframework.core.PriorityOrdered;\nimport org.springframework.lang.Nullable;\n\n/**\n * @author yangfh\n * @date 2023-12-14 21:30\n **/\npublic class User implements InitializingBean, DisposableBean {\n\tprivate Long id;\n\tprivate String username;\n\tprivate String email;\n\tprivate Address address;\n\tprivate Long age;\n\n\tpublic User() {\n\t\tSystem.out.println(\"User æ— å‚æ„é€ å‡½æ•°: \"+ this.toString());\n\t}\n\n\tpublic User(Long id, String username, String email, Address address) {\n\t\tthis.id = id;\n\t\tthis.username = username;\n\t\tthis.email = email;\n\t\tthis.address = address;\n\t\tSystem.out.println(\"User æœ‰å‚æ„é€ å‡½æ•°: \"+ this.toString());\n\t}\n\n\tpublic void initMethod(){\n\t\tSystem.out.println(\"User initMethod\");\n\t}\n\n\tpublic void destroyMethod(){\n\t\tSystem.out.println(\"User destroyMethod\");\n\t}\n\n\t@Override\n\tpublic void afterPropertiesSet() throws Exception {\n\t\tSystem.out.println(\"User afterPropertiesSet\");\n\t}\n\n\t@Override\n\tpublic void destroy() throws Exception {\n\t\tSystem.out.println(\"User destroy\");\n\t}\n\t\n\t\n\t... getter  setter ...\n}\n</code></pre>\n<p><code>org.yang.learn.spring.dto.UserServiceImpl</code></p>\n<pre><code class=\"language-java\">public class UserServiceImpl implements BeanPostProcessor, BeanFactoryPostProcessor, ApplicationContextAware {\n\tpublic UserServiceImpl(){\n\t\tSystem.out.println(\"UserServiceImpl æ— å‚æ„é€ \");\n\t}\n\n\t@Override\n\tpublic Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\n\t\tSystem.out.println(\"UserServiceImpl postProcessBeforeInitialization å¢å¼ºå¤„ç† [\"+beanName+\"]\");\n\t\treturn BeanPostProcessor.super.postProcessBeforeInitialization(bean, beanName);\n\t}\n\n\t@Override\n\tpublic Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n\t\tSystem.out.println(\"UserServiceImpl postProcessAfterInitialization å¢å¼ºå¤„ç† [\"+beanName+\"]\");\n\t\treturn BeanPostProcessor.super.postProcessAfterInitialization(bean, beanName);\n\t}\n\n\t@Override\n\tpublic void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {\n\t\tSystem.out.println(\"UserServiceImpl postProcessBeanFactory beanFactory å¢å¼ºå¤„ç† [\"+beanFactory+\"]\");\n\t}\n\n\t@Override\n\tpublic void setApplicationContext(ApplicationContext applicationContext) throws BeansException {\n\t\tSystem.out.println(\"UserServiceImpl setApplicationContext \");\n\t}\n}\n</code></pre>\n<p><code>application.xml</code></p>\n<pre><code class=\"language-xml\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n\t   xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\t   xmlns:context=\"http://www.springframework.org/schema/context\"\n\t   xmlns:aop=\"http://www.springframework.org/schema/cache\"\n\t   xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n\t\thttps://www.springframework.org/schema/beans/spring-beans.xsd\n\t\thttp://www.springframework.org/schema/context\n\t\thttps://www.springframework.org/schema/context/spring-context.xsd\n\t\thttp://www.springframework.org/schema/cache\n\t\thttp://www.springframework.org/schema/cache/spring-cache.xsd\"&gt;\n\n\t&lt;bean id=\"address\" class=\"org.yang.learn.spring.dto.Address\" &gt;\n\t\t&lt;constructor-arg value=\"æ·±åœ³\"/&gt;\n\t\t&lt;constructor-arg value=\"ç½—æ¹–\"/&gt;\n\t\t&lt;constructor-arg value=\"xxxè¡—é“101å·\"/&gt;\n\t&lt;/bean&gt;\n\t&lt;bean id=\"user\" class=\"org.yang.learn.spring.dto.User\" init-method=\"initMethod\" destroy-method=\"destroyMethod\" &gt;\n\t\t&lt;property name=\"username\" value=\"å¼ ä¸‰\"&gt;&lt;/property&gt;\n\t\t&lt;property name=\"age\" value=\"9764534\"&gt;&lt;/property&gt;\n\t&lt;/bean&gt;\n\t&lt;bean id=\"userService\" class=\"org.yang.learn.spring.dto.UserServiceImpl\" &gt;\n\t&lt;/bean&gt;\n\n&lt;/beans&gt;\n\n\n</code></pre>\n<pre><code class=\"language-java\">public static void main(String[] args) throws Exception {\n\tSystem.out.println(\"===========================å®¹å™¨å¯åŠ¨===============================\\n\");\n\tClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"application.xml\");\n\tSystem.out.println(\"\\n==========================å®¹å™¨å®Œæˆ================================\");\n\tUser user = context.getBean(\"user\", User.class);\n\tSystem.out.println(\"è·å–å®¹å™¨çš„user Bean: \"+user);\n\tcontext.close();\n}\n</code></pre>\n<h2 id=\"å®¹å™¨çš„åˆ›å»º-classpathxmlapplicationcontext\">å®¹å™¨çš„åˆ›å»º (ClassPathXmlApplicationContext)</h2>\n<p><code>org.springframework.context.support.ClassPathXmlApplicationContext#ClassPathXmlApplicationContext(java.lang.String)</code><br />\n<code>org.springframework.context.support.ClassPathXmlApplicationContext#ClassPathXmlApplicationContext(java.lang.String[], boolean, org.springframework.context.ApplicationContext)</code></p>\n<pre><code class=\"language-java\">/**\n * Create a new ClassPathXmlApplicationContext with the given parent,\n * loading the definitions from the given XML files.\n * @param configLocations array of resource locations\n * @param refresh whether to automatically refresh the context,\n * loading all bean definitions and creating all singletons.\n * Alternatively, call refresh manually after further configuring the context.\n * @param parent the parent context\n * @throws BeansException if context creation failed\n * @see #refresh()\n */\npublic ClassPathXmlApplicationContext(\n\t\tString[] configLocations, boolean refresh, @Nullable ApplicationContext parent)\n\t\tthrows BeansException {\n\t/**\n\t * è°ƒç”¨çˆ¶ç±»æ„é€ , åˆå§‹äº†ä¸€äº›å¯¹è±¡å’Œå­—æ®µå±æ€§, ä¾‹å¦‚:\n\t *  1. å½“å‰ context çš„å±æ€§åˆå§‹åŒ–:\n\t *   - å­˜å‚¨BeanFactoryPostProcessor(BFPP)çš„é›†åˆ  {@link org.springframework.context.support.AbstractApplicationContext#beanFactoryPostProcessors}\n\t *\t - id å®¹å™¨ID, displayName å®¹å™¨åç§°,  closed, active å®¹å™¨å…³é—­å¯åŠ¨ æ´»åŠ¨çš„ AtomicBooleanæ ‡è¯†ç¬¦ ; {@link org.springframework.context.support.AbstractApplicationContext#id}\n\t *   - startupShutdownMonitor å®¹å™¨é”å¯¹è±¡, åœ¨å®¹å™¨'åˆ·æ–°'å’Œ'é”€æ¯'æ—¶éœ€è¦é”ä½(åŒæ­¥)çš„ {@link AbstractApplicationContext#startupShutdownMonitor}\n\t *    shutdownHook; JVM çš„ HOOK {@link AbstractApplicationContext#shutdownHook}\n\t *\n\t *  2. å¦‚æœæœ‰çˆ¶å®¹å™¨,åˆ™è®¾ç½®çˆ¶å®¹å™¨,è¿˜ä¼šåˆå¹¶é…ç½®;\n\t *  {@link org.springframework.context.support.AbstractApplicationContext#setParent(org.springframework.context.ApplicationContext)}\n\t *\n\t *  3. åˆ›å»ºæ”¯æŒanté£æ ¼è§£æçš„èµ„æºè§£æå™¨,æ”¯æŒé€šé…ç¬¦çš„ç±»ä¼¼`\"classpath*:applicationContext-*.xml\"` è¿™ç§, è§£æå®¹å™¨æ‰€éœ€è¦çš„ xml, yml, properties ç­‰é…ç½®æ–‡ä»¶; `spring.profiles.active` çš„å˜é‡ ä¹Ÿæ˜¯ç”±è¿™ä¸ªè§£æå™¨è¿›è¡Œå¤„ç†\n\t * \tè§£æå®¹å™¨æ‰€éœ€è¦çš„ xml, yml, properties ç­‰é…ç½®æ–‡ä»¶;  {@link AbstractApplicationContext#AbstractApplicationContext()}\n\t */\n\tsuper(parent);\n\t/**\n\t * è§£æè·¯å¾„, è·¯å¾„ä¸­æ”¯æŒè¡¨è¾¾å¼çš„å˜é‡, ä¾‹å¦‚: æ–‡ä»¶å application-${env}.xml ç¯å¢ƒå¯¹è±¡é‡Œé¢æœ‰envå˜é‡ä¼šæ›¿æ¢ä¹‹\n\t */\n\tsetConfigLocations(configLocations);\n\tif (refresh) {\n\t\trefresh();\n\t}\n}\n</code></pre>\n<h3 id=\"æ€»ç»“\">æ€»ç»“</h3>\n<p>è°ƒç”¨çˆ¶ç±»æ„é€ , åˆå§‹äº†ä¸€äº›å¯¹è±¡å’Œå­—æ®µå±æ€§, ä¾‹å¦‚:</p>\n<ol>\n<li>å½“å‰ context çš„å±æ€§åˆå§‹åŒ–:</li>\n</ol>\n<ul>\n<li>å­˜å‚¨ BeanFactoryPostProcessor(BFPP) çš„é›†åˆ </li>\n<li>id å®¹å™¨ID, displayName å®¹å™¨åç§°,  closed, active å®¹å™¨å…³é—­å¯åŠ¨ æ´»åŠ¨çš„ AtomicBooleanæ ‡è¯†ç¬¦ ;</li>\n<li><code>startupShutdownMonitor</code> å®¹å™¨é”å¯¹è±¡, åœ¨å®¹å™¨'åˆ·æ–°'å’Œ'é”€æ¯'æ—¶éœ€è¦é”ä½(åŒæ­¥)çš„</li>\n<li>shutdownHook; JVM çš„ HOOK</li>\n</ul>\n<ol start=\"2\">\n<li>å¦‚æœæœ‰çˆ¶å®¹å™¨,åˆ™è®¾ç½®çˆ¶å®¹å™¨,è¿˜ä¼šåˆå¹¶é…ç½®;</li>\n</ol>\n<ul>\n<li></li>\n</ul>\n<ol start=\"3\">\n<li>åˆ›å»ºæ”¯æŒanté£æ ¼è§£æçš„èµ„æºè§£æå™¨,æ”¯æŒé€šé…ç¬¦çš„ç±»ä¼¼<code>\"classpath*:applicationContext-*.xml\"</code> è¿™ç§, è§£æå®¹å™¨æ‰€éœ€è¦çš„ xml, yml, properties ç­‰é…ç½®æ–‡ä»¶; <code>spring.profiles.active</code> çš„å˜é‡ ä¹Ÿæ˜¯ç”±è¿™ä¸ªè§£æå™¨è¿›è¡Œå¤„ç†<br />\nè§£æå®¹å™¨æ‰€éœ€è¦çš„ xml, yml, properties ç­‰é…ç½®æ–‡ä»¶; </li>\n</ol>\n<h2 id=\"refresh-æ–¹æ³•\">refresh() æ–¹æ³•</h2>\n<p>è¿™ä¸ªæ˜¯é‡ç‚¹æ–¹æ³•,  å‡ ä¹æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„ä»£ç , éƒ½å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•å†…æ‰¾åˆ°, æ‰€ä»¥ä»£ç æ–­ç‚¹ ä¹¦ç­¾ è°ƒè¯•, éƒ½ç»™å®ƒå¹²ä¸Š..</p>\n<p><code>org.springframework.context.support.AbstractApplicationContext#refresh</code></p>\n<pre><code class=\"language-java\">\n\t@Override\n\tpublic void refresh() throws BeansException, IllegalStateException {\n\t\t// å®¹å™¨åˆ·æ–°, æ‰§è¡Œæ—¶, éœ€è¦é”ä½\n\t\tsynchronized (this.startupShutdownMonitor) {\n\t\t\t//è®°å½•å®¹å™¨ å¯åŠ¨æ—¶é—´, æ­¥éª¤ ç”¨äºåˆ†ææ€§èƒ½çš„ (ä¸é‡è¦)\n\t\t\tStartupStep contextRefresh = this.applicationStartup.start(\"spring.context.refresh\");\n\n\t\t\t// Prepare this context for refreshing.\n\t\t\t/**\n\t\t\t * ä¸€, (ApplicationContext)çš„é¢„å‡†å¤‡å·¥ä½œ;\n\t\t\t * å®¹å™¨åˆ·æ–°å‰çš„å‡†å¤‡å·¥ä½œ\n\t\t\t * 1. è®¾ç½®å®¹å™¨çš„ä¸€äº›çŠ¶æ€æ ‡å¿—ç¬¦;è®¾ç½®å¯åŠ¨æ—¶é—´, æ´»åŠ¨æ ‡å¿—ç¬¦; {@link AbstractApplicationContext#prepareRefresh()}\n\t\t\t * 2. è·å–æˆ–è€…åˆ›å»º Environment å¯¹è±¡; åŠ è½½ System.getProperties(); {@see AbstractApplicationContext#environment}\n\t\t\t * 3. éªŒè¯ç¯å¢ƒæ˜¯å¦åŒ…å«æŸé…ç½®; æ‰‹åŠ¨æ·»åŠ é…ç½®. {@link AbstractApplicationContext#initPropertySources()}\n\t\t\t * 4. å‡†å¤‡å­˜å‚¨ äº‹ä»¶ç›‘å¬å™¨ å’Œ äº‹ä»¶ çš„é›†åˆå®¹å™¨, é»˜è®¤ä¸ºç©º {@link AbstractApplicationContext#prepareRefresh()};\n\t\t\t */\n\t\t\tprepareRefresh();\n\n\t\t\t// Tell the subclass to refresh the internal bean factory.\n\t\t\t/**\n\t\t\t * äºŒ, åˆ›å»º BeanFactory;\n\t\t\t * 1. é”€æ¯ä¹‹å‰çš„ beanFactory (å¦‚æœæœ‰çš„è¯) {@link AbstractRefreshableApplicationContext#refreshBeanFactory()}\n\t\t\t * 2. å®ä¾‹åŒ–/åˆ›å»º beanFactory, è¿™é‡Œæ˜¯å®ä¾‹ç±»æ˜¯ `DefaultListableBeanFactory` {@link org.springframework.context.support.AbstractRefreshableApplicationContext#createBeanFactory}\n\t\t\t * 3. è®¾ç½® beanFactory å¿½ç•¥  BeanNameAware, BeanClassLoaderAware, BeanFactoryAwareè¿™ä¸‰ä¸ªAwareçš„æ¥å£ {@link AbstractAutowireCapableBeanFactory#AbstractAutowireCapableBeanFactory()}\n\t\t\t * \t\tå› ä¸ºåœ¨åˆå§‹åŒ–Beanæ—¶, ä¼šç›´æ¥è°ƒç”¨å®ƒä»¬(è€Œä¸æ˜¯é€šè¿‡é€šè¿‡ BeanPostProcessoræ‰©å±•çš„Awareæœºåˆ¶è°ƒç”¨) {@link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#initializeBean(java.lang.String, java.lang.Object, org.springframework.beans.factory.support.RootBeanDefinition)}\n\t\t\t * 4. è®¾ç½® beanFactory åºåˆ—åŒ–ID, åç§° {@link AbstractRefreshableApplicationContext#refreshBeanFactory()}\n\t\t\t * 5. æ‰©å±•ç‚¹, å®šåˆ¶åŒ–è¿™ä¸ª BeanFactory ä¾‹å¦‚: æ˜¯å¦å…è®¸ BeanDefinition è¦†ç›–; æ˜¯å¦è‡ªåŠ¨å¤„ç†å¾ªç¯ä¾èµ–;\n\t\t\t * 6. åˆ›å»º(XMLè§£æå™¨/è¯»å–å™¨) XmlBeanDefinitionReader, å¹¶åˆå§‹åŒ–; ç•™ä¸‹æ‰©å±•ç‚¹, æ‰©å±•Reader ä¾‹å¦‚ æ˜¯å¦éªŒè¯xmlç­‰ {@link AbstractXmlApplicationContext#loadBeanDefinitions(DefaultListableBeanFactory)}\n\t\t\t * 7. åˆ›å»ºç›¸å…³å¯¹è±¡DocumentLoader, BeanDefinitionDocumentReader,BeanDefinitionParserDelegate {@link org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions(org.w3c.dom.Document, org.springframework.core.io.Resource)}\n\t\t\t * \t\t{@link DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions(Element)}\n\t\t\t *    åŠ è½½/è§£æ XMLæ ‡ç­¾/å…ƒç´ /å±æ€§ç­‰å°†å…¶å°è£…ä¸º ä¸€ä¸ªä¸ª BeanDefinition å¯¹è±¡\n\t\t\t * 8. å°† BeanDefinitions æ³¨å†Œåˆ° registry {@link BeanDefinitionReaderUtils#registerBeanDefinition(BeanDefinitionHolder, BeanDefinitionRegistry)}\n\t\t\t */\n\t\t\tConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();\n\n\t\t\t/**\n\t\t\t * ä¸‰,(BeanFactory)é¢„å‡†å¤‡å·¥ä½œ;\n\t\t\t * {@link AbstractApplicationContext#prepareBeanFactory(ConfigurableListableBeanFactory)}\n\t\t\t * 1. ä¸º beanFactory è®¾ç½® bean çš„ç±»åŠ è½½å™¨ {@link ConfigurableBeanFactory#setBeanClassLoader(ClassLoader)}\n\t\t\t * 2. ä¸º beanFactory è®¾ç½® bean çš„ StandardBeanExpressionResolver (è¡¨è¾¾å¼(Spring EL)è§£æå™¨) {@link ConfigurableBeanFactory#setBeanExpressionResolver(BeanExpressionResolver)}\n\t\t\t *   å…³äº (Spring EL)è§£æå™¨: StandardBeanExpressionResolver çš„è®¾è®¡æ˜¯ç»„åˆä¼˜äºç»§æ‰¿, å†…éƒ¨æœ‰ä¸¤ä¸ª SpelExpressionParser(çœŸæ­£è§£æçš„) SpelParserConfiguration(é…ç½®ç±»)\n\t\t\t * 3. ä¸º beanFactory è®¾ç½® PropertyEditorRegistrar (ä¸»è¦ä¸º Bean è®¾ç½®å±æ€§çš„ç®¡ç†ç±»){@link ConfigurableBeanFactory#addPropertyEditorRegistrar(PropertyEditorRegistrar)}\n\t\t\t * \t\t *  PropertyEditorRegistrar è¿™ä¸ªä¸»è¦ä¸º Bean è®¾ç½®å±æ€§çš„ç®¡ç†ç±», æ¯”å¦‚, æ—¥æœŸç±»å‹çš„æ•°æ®: å¯ä»¥æ˜¯ç‰¹å®šæ ¼å¼çš„å­—ç¬¦ä¸², æ•°å­—, è¿˜å¯ä»¥æ˜¯æ—¶é—´æˆ³...\n\t\t\t * \t\t *  Spring ä¸º bean å¡«å……å±æ€§, ä½¿ç”¨ BeanWrapperImpl åŒ…è£…äº†ä¸€ä¸‹(è£…é¥°æ¨¡å¼)\n\t\t\t * \t\t *  BeanWrapperImpl å®ç°äº† PropertyEditorRegistry, å¯ä»¥å¾€é‡Œé¢æ³¨å†Œ PropertyEditor, å¯ä»¥è‡ªå®šä¹‰å±æ€§çš„è½¬æ¢, ç¼–è¾‘é€»è¾‘\n\t\t\t * 4. ç»™ beanFactory æ·»åŠ ä¸€ä¸ª å¤„ç†Awareçš„ BeanPostProcessor (ApplicationContextAwareProcessor) å¹¶å¿½ç•¥æ‰è¿™7ä¸ªæ¥å£çš„è‡ªåŠ¨æ³¨å…¥:{@link ConfigurableBeanFactory#addBeanPostProcessor(BeanPostProcessor)}\n\t\t\t * \t\tEnvironmentAware.class, EmbeddedValueResolverAware.class, ResourceLoaderAware.class, ApplicationEventPublisherAware.class, MessageSourceAware.class, ApplicationContextAware.class, ApplicationStartupAware.class\n\t\t\t * 5. æŒ‡å®šå†…ç½®çš„ BeanFactory,ResourceLoader,ApplicationEventPublisher,ApplicationContext {@link ConfigurableListableBeanFactory#registerResolvableDependency(Class, Object)}\n\t\t\t * \t\tè¿™å‡ ä¸ªBeanå¯¹è±¡,  è‡ªåŠ¨æ³¨å…¥çš„ Primary\n\t\t\t * 6. ç»™ beanFactory æ·»åŠ ä¸€ä¸ª BeanPostProcessor (ApplicationListenerDetector)TODO (äº‹ä»¶ç›‘å¬ç›¸å…³)\n\t\t\t * 7. ç»™ beanFactory æ·»åŠ ä¸€ä¸ª BeanPostProcessor(LoadTimeWeaverAwareProcessor) TODO (AOP AspectJ ç»‡å…¥å¤„ç†ç›¸å…³çš„)\n\t\t\t * 8. beanFactoryä¸­å¦‚æœæ²¡æœ‰ä»¥ä¸‹åç§°çš„ bean, åˆ™ç›´æ¥ç»™ BeanFactory çš„ä¸€çº§ç¼“å­˜, æ³¨å†Œå‡ ä¸ªç¯å¢ƒå¯¹è±¡ Bean {@link SingletonBeanRegistry#registerSingleton(String, Object)}\n\t\t\t *  åç§°å¸¸é‡åˆ†åˆ«æ˜¯:\n\t\t\t *  org.springframework.context.ConfigurableApplicationContext#ENVIRONMENT_BEAN_NAME\n\t\t\t *  org.springframework.context.ConfigurableApplicationContext#SYSTEM_PROPERTIES_BEAN_NAME\n\t\t\t *  org.springframework.context.ConfigurableApplicationContext#SYSTEM_ENVIRONMENT_BEAN_NAME\n\t\t\t *  org.springframework.context.ConfigurableApplicationContext#APPLICATION_STARTUP_BEAN_NAME\n\t\t\t *\n\t\t\t */\n\t\t\t// Prepare the bean factory for use in this context.\n\t\t\tprepareBeanFactory(beanFactory);\n\n\t\t\ttry {\n\t\t\t\t// Allows post-processing of the bean factory in context subclasses.\n\t\t\t\t/**\n\t\t\t\t * å››, beanFactory å·²ç»å‡†å¤‡å¥½äº†, è®¾è®¡ç›®çš„æ˜¯ç»™(Context)å­ç±»é¢„ç•™ä¸€ä¸ªæ‰©å±•ç‚¹, åœ¨æ­¤æ—¶è¿™é‡Œæ‰€æœ‰çš„ Bean å·²ç»è¢«æ³¨å†Œäº†, å°šæœªå®ä¾‹åŒ–ä»»ä½•bean;\n\t\t\t\t * BeanPostProcessors\n\t\t\t\t * (è¿™é‡Œæ˜¯ç©ºå®ç°)\n\t\t\t\t */\n\t\t\t\tpostProcessBeanFactory(beanFactory);\n\n\t\t\t\tStartupStep beanPostProcess = this.applicationStartup.start(\"spring.context.beans.post-process\");\n\n\t\t\t\t// Invoke factory processors registered as beans in the context.\n\t\t\t\t/**\n\t\t\t\t * äº”, è°ƒç”¨ BeanFactoryPostProcessor å’Œ BeanDefinitionRegistryPostProcessor\n\t\t\t\t * è‹¥æ˜¯æ³¨å†Œçš„bean definition å®ç°äº†è¿™ä¸¤ä¸ªæ¥å£, åˆ™ä¼šè°ƒç”¨(getBean)å®ä¾‹åŒ–å®ƒ, å†è°ƒç”¨ç›¸åº”çš„æ¥å£æ–¹æ³•;\n\t\t\t\t * (æ³¨æ„ä¸€ä¸‹ BeanDefinitionRegistryPostProcessor æ˜¯ç»§æ‰¿è‡ª BeanFactoryPostProcessorçš„)\n\t\t\t\t * æ€»çš„æ¥è¯´ è°ƒç”¨çš„ä¼˜å…ˆçº§æ˜¯:\n\t\t\t\t * 1. è°ƒç”¨æ¥å£çš„ä¼˜å…ˆçº§:\n\t\t\t\t *    1. ä¼˜å…ˆè°ƒç”¨(å­ç±») BeanDefinitionRegistryPostProcessor\n\t\t\t\t *    2. å†è°ƒç”¨(çˆ¶ç±») BeanFactoryPostProcessor\n\t\t\t\t * 2. è°ƒç”¨æ·»åŠ çš„æ–¹å¼çš„ä¼˜å…ˆçº§:\n\t\t\t\t *    1. ä¼˜å…ˆè°ƒç”¨å¤–éƒ¨å…¥å‚, å³ç›´æ¥é€šè¿‡{@link AbstractApplicationContext#addBeanFactoryPostProcessor(org.springframework.beans.factory.config.BeanFactoryPostProcessor)} ä»£ç æ·»åŠ çš„\n\t\t\t\t *    2. å†è°ƒç”¨å®¹å™¨ä¸­å®ç° BeanFactoryPostProcessor æˆ–è€… BeanDefinitionRegistryPostProcessor çš„ Bean\n\t\t\t\t * è§: {@link org.springframework.context.support.PostProcessorRegistrationDelegate#invokeBeanFactoryPostProcessors(org.springframework.beans.factory.config.ConfigurableListableBeanFactory, java.util.List)}\n\t\t\t\t *\n\t\t\t\t * å€¼å¾—ä¸€æçš„æ˜¯:  Spring å¯¹äºæ”¯æŒ SPELè¡¨è¾¾å¼, å°±æ˜¯é€šè¿‡ `PropertySourcesPlaceholderConfigurer` è¿™ç§æ–¹å¼æ‰©å±•å®ç°çš„\n\t\t\t\t * {@link org.springframework.context.support.PropertySourcesPlaceholderConfigurer}\n\t\t\t\t */\n\t\t\t\tinvokeBeanFactoryPostProcessors(beanFactory);\n\n\t\t\t\t// Register bean processors that intercept bean creation.\n\t\t\t\t/**\n\t\t\t\t *  å…­, æ³¨å†Œ BeanPostProcessor (BPP)å¤„ç†å™¨;\n\t\t\t\t *\n\t\t\t\t *  1. æ‹¿åˆ°æ‰€æœ‰ BeanPostProcessor ç±»å‹çš„ bean\n\t\t\t\t *  2. å®ä¾‹åŒ– BeanPostProcessor\n\t\t\t\t *  \tä¼˜å…ˆå®ä¾‹åŒ– å®ç°äº† PriorityOrdered æ¥å£çš„, åœ¨å®ä¾‹åŒ–å…¶å®ƒçš„(BPP)\n\t\t\t\t *  3. è¿›è¡Œåˆ†ç±»å­˜åˆ°é›†åˆ {@link PostProcessorRegistrationDelegate#registerBeanPostProcessors(ConfigurableListableBeanFactory, AbstractApplicationContext)}\n\t\t\t\t *   \t* å¯¹ BeanPostProcessor è¿›è¡Œåˆ†ç±»å­˜èµ·æ¥,  å†è°ƒç”¨, æ¯ä¸ªé›†åˆåˆ†åˆ«æ˜¯\n\t\t\t\t * \t\t * 1. priorityOrderedPostProcessors //æœ‰å®ç°(PriorityOrdered)æ’åºæ¥å£çš„\n\t\t\t\t * \t\t * 2. internalPostProcessors //Springå†…éƒ¨çš„bean, è§: Springå°†beanåˆ†ä¸ºä¸‰ç§è§’è‰²\n\t\t\t\t * \t\t * 3. orderedPostProcessorNames //å®ç° Ordered æ¥å£\n\t\t\t\t * \t\t * 4. nonOrderedPostProcessorNames //æ²¡æœ‰æŒ‡å®šé¡ºåº, æ— åºçš„\n\t\t\t\t *  è¿™æœ‰ä¸€ç‚¹, Spring å¯¹ BeanDefinition åˆ†æˆä¸‰ç§è§’è‰²:\n\t\t\t\t *  \t1. ç”¨æˆ·å®šä¹‰çš„ ä¸šåŠ¡ç›¸å…³çš„ Bean Bean (ROLE_APPLICATION)\n\t\t\t\t *      2. è¾ƒå¤æ‚çš„ (ROLE_SUPPORT) è¾ƒå¤æ‚çš„, æ”¯æŒ AOPã€äº‹åŠ¡ç­‰åŠŸèƒ½çš„å†…éƒ¨å®ç°?  (ä¸é‡è¦, ä¸è¦æ¯ä¸€ä¸ªç»†èŠ‚éƒ½æ‰£...)\n\t\t\t\t *      3. Spring å†…ç½®çš„(ROLE_INFRASTRUCTURE)\n\t\t\t\t *\n\t\t\t\t *  4. æ’åºå¹¶æ³¨å†Œåˆ° beanFactory\n\t\t\t\t *    \t1. è¿™é‡ŒæŒ‰å®ç°(PriorityOrdered)æ’åºæ¥å£çš„ã€@Orderedæ³¨è§£çš„ ç­‰æ’åºå­˜èµ·æ¥. å®é™…è°ƒç”¨çš„é¡ºåº å…¶å®å°±æ˜¯å­˜èµ·æ¥çš„é¡ºåº\n\t\t\t\t *      2. å¦å¤– BeanPostProcessor æ¥å£ç²—ç²’åº¦å¤ªå¤§äº†, Spring è¿˜ç»†åˆ†ä¸€äº›å­æ¥å£:\n\t\t\t\t *         1. SmartInstantiationAwareBeanPostProcessor å®ƒæä¾›äº†æ›´é«˜çº§çš„Beanå®ä¾‹åŒ–æ§åˆ¶æ–¹æ³•ã€‚ä¸»è¦ä½œç”¨åœ¨äºå…è®¸å¯¹Beançš„å®ä¾‹åŒ–è¿‡ç¨‹è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶å’Œå®šåˆ¶ã€‚\n\t\t\t\t *         2. MergedBeanDefinitionPostProcessor åœ¨åˆå¹¶Beanå®šä¹‰ï¼ˆMergedBeanDefinitionï¼‰ä¹‹åä½†åœ¨å®ä¾‹åŒ–Beanä¹‹å‰ï¼Œå…è®¸å¯¹åˆå¹¶åçš„Beanå®šä¹‰è¿›è¡Œä¿®æ”¹ã€è°ƒæ•´æˆ–é™„åŠ å…ƒæ•°æ®ã€‚\n\t\t\t\t *         3. DestructionAwareBeanPostProcessor å®ƒå…è®¸åœ¨Beanè¢«é”€æ¯ä¹‹å‰ï¼ˆä¾‹å¦‚ï¼Œå®¹å™¨å…³é—­æˆ–ç‰¹å®šä½œç”¨åŸŸçš„Beané”€æ¯ï¼‰æ‰§è¡Œä¸€äº›æ“ä½œã€‚\n\t\t\t\t *         ç­‰ç­‰ä»¥ä¸Šä¹Ÿä¼šå­˜èµ·æ¥\n\t\t\t\t *      3. æœ€ç»ˆè°ƒç”¨ BPPæ˜¯åœ¨ {@link AbstractApplicationContext#finishBeanFactoryInitialization(ConfigurableListableBeanFactory)} å®ä¾‹åˆå§‹åŒ–å…¶ä»–Beanè°ƒç”¨\n\t\t\t\t */\n\t\t\t\tregisterBeanPostProcessors(beanFactory);\n\n\t\t\t\tbeanPostProcess.end();\n\n\t\t\t\t// Initialize message source for this context.\n\t\t\t\t/**\n\t\t\t\t * ä¸ƒ, åˆå§‹åŒ–å›½é™…åŒ–(I18N) ä¿¡æ¯æº;\n\t\t\t\t * é‡Œé¢å¾ˆç®€å•:\n\t\t\t\t * 1. å¦‚æœbeanFactoryä¸­æœ‰åç§°ä¸º messageSource çš„Beanå®šä¹‰ ï¼Œå°±ä½¿ç”¨è¿™beanä½œç‰©å›½é™…åŒ–æ¶ˆæ¯æº\n\t\t\t\t * å¦‚æœæ²¡æœ‰åˆ™é»˜è®¤ä½¿ç”¨ org.springframework.context.support.DelegatingMessageSource å¹¶æ³¨å†Œåˆ° beanFactory\n\t\t\t\t */\n\t\t\t\tinitMessageSource();\n\n\t\t\t\t// Initialize event multicaster for this context.\n\t\t\t\t/**\n\t\t\t\t * å…«, åˆå§‹åŒ–äº‹ä»¶å¤šæ’­å™¨;\n\t\t\t\t * 1. å¦‚æœ beanFactory ä¸­åŒ…å«åç§°ä¸º applicationEventMulticaster çš„beanå®šä¹‰, åˆ™ä½¿ç”¨è¿™ä¸ªBeanä½œä¸ºäº‹ä»¶å¤šæ’­å™¨;\n\t\t\t\t *   å¦‚æœä¸åŒ…å«åˆ™åˆ›å»º SimpleApplicationEventMulticasterä½œä¸ºäº‹ä»¶å¤šæ’­å™¨;\n\t\t\t\t * 2.åˆ›å»ºSimpleApplicationEventMulticasterå…¶å®å°±æ˜¯åˆå§‹åŒ–äº†ä¸€ä¸ª,ç”¨äºå­˜æ”¾/ç®¡ç† ApplicationListener ç›‘å¬å™¨(è§‚å¯Ÿè€…)çš„ç±», å¹¶æ³¨å†Œåˆ° beanFactory\n\t\t\t\t * \tä¸»è¦æ˜¯ {@link org.springframework.context.event.AbstractApplicationEventMulticaster#defaultRetriever} ç”¨äºå­˜æ”¾/ç®¡ç† å„ä¸ªç›‘å¬å™¨çš„(è§‚å¯Ÿè€…)\n\t\t\t\t *  {@link org.springframework.context.event.SimpleApplicationEventMulticaster#multicastEvent(org.springframework.context.ApplicationEvent, org.springframework.core.ResolvableType) }è°ƒç”¨å®¹å™¨å‘å¸ƒäº‹ä»¶\n\t\t\t\t */\n\t\t\t\tinitApplicationEventMulticaster();\n\n\t\t\t\t// Initialize other special beans in specific context subclasses.\n\t\t\t\t/**\n\t\t\t\t * ä¹, ç»™å­ç±»(Context)ç•™ä¸‹ä¸€ä¸ªæ‰©å±•ç‚¹\n\t\t\t\t * æ²¡ä»€ä¹ˆå¥½è¯´çš„, è¿™é‡Œæ˜¯ç©ºå®ç°\n\t\t\t\t */\n\t\t\t\tonRefresh();\n\n\t\t\t\t// Check for listener beans and register them.\n\t\t\t\t/**\n\t\t\t\t * å, å‘å¤šæ’­å™¨æ³¨å†Œç›‘å¬å™¨;\n\t\t\t\t * 1. å‘å¤šæ’­å™¨ä¸­æ³¨å†Œ åœ¨contextä¸­çš„ç›‘å¬å™¨(è§‚å¯Ÿè€…);\n\t\t\t\t * 2. å‘å¤šæ’­å™¨ä¸­æ³¨å†Œ åœ¨beanFactoryä¸­çš„beanæ˜¯ç›‘å¬å™¨(ApplicationListener.class)çš„(è§‚å¯Ÿè€…)\n\t\t\t\t * 3. å¹¿æ’­ this.earlyApplicationEvents å±æ€§ä¸­çš„äº‹ä»¶;\n\t\t\t\t * ä¸ºä»€ä¹ˆ?\n\t\t\t\t * å› ä¸ºæœ‰å¯èƒ½ åœ¨å®¹å™¨ç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨äº†å½“å‰ `AbstractApplicationContext#publishEvent` å‘å¸ƒäº‹ä»¶, ä½†æ˜¯å¤šæ’­å™¨æ²¡æœ‰åˆå§‹åŒ–å®Œæˆ, æ‰€ä»¥ä¼šå°†äº‹ä»¶å­˜åœ¨this.earlyApplicationEvents ä¸­;\n\t\t\t\t * å¾…å®¹å™¨åˆå§‹åŒ–å®Œæˆååœ¨æµç¨‹  {@link org.springframework.context.support.AbstractApplicationContext#registerListeners()} ä¸­ä¼šå‘å¸ƒå­˜åœ¨è¿™é‡Œé¢çš„äº‹ä»¶\n\t\t\t\t * (ä¾‹å¦‚: åœ¨ BeanFactoryPostProcessor çš„ä¸šåŠ¡é€»è¾‘è§¦å‘å®¹å™¨çš„å¹¿æ’­äº‹ä»¶, è¿™æ—¶å€™å¤šæ’­å™¨éƒ½ä¸å­˜åœ¨)\n\t\t\t\t * @see AbstractApplicationContext#prepareRefresh()\n\t\t\t\t */\n\t\t\t\tregisterListeners();\n\n\t\t\t\t// Instantiate all remaining (non-lazy-init) singletons.\n\t\t\t\t/**\n\t\t\t\t * åä¸€, å®ä¾‹åŒ–å‰©ä¸‹çš„æ‰€æœ‰å•ä¾‹bean\n\t\t\t\t *\n\t\t\t\t * 1. ä¸º beanFactory è®¾ç½®ç±»å‹è½¬æ¢å™¨(ConversionService) å±æ€§å¡«å……æ—¶ä¼šç”¨åˆ° {@link AbstractApplicationContext#finishBeanFactoryInitialization(ConfigurableListableBeanFactory)}\n\t\t\t\t * 2. ä¸º beanFactory æ·»åŠ å˜é‡è§£æå™¨ (StringValueResolver)\n\t\t\t\t * \tå¦‚æœ beanFactory ä¸Šä¸‹æ–‡ä¸­ä¸åŒ…å« \"é»˜è®¤çš„å˜é‡è§£æå™¨ (ç±»ä¼¼ PropertySourcesPlaceholderConfigurer) è§£æç±»ä¼¼ '${}' è¿™æ ·çš„å˜é‡ \"\n\t\t\t\t * \tåˆ™ä½¿ç”¨ç¯å¢ƒå¯¹è±¡(ConfigurableEnvironment)ä¸­çš„ ConfigurablePropertyResolverå®ç°æ¥ä½œä¸º StringValueResolver æ·»åŠ è¿›å»\n\t\t\t\t * 3. å†»ç»“é…ç½®, æ­¤åå°±ä¸å†å…è®¸æ›´æ”¹ beanDefinition äº†\n\t\t\t\t * 4. å®ä¾‹åŒ–æ‰€æœ‰å‰©ä½™çš„ (élazy-init) å•ä¾‹ Bean\n\t\t\t\t * 5. å¤„ç† FactoryBean ç±»å‹çš„bean {@link DefaultListableBeanFactory#preInstantiateSingletons()}\n\t\t\t\t * \tå¦‚æœè¯¥beanæ˜¯ FactoryBean, åˆ™åœ¨ bean name å‰é¢åŠ ä¸€ä¸ª '&amp;' å‰ç¼€, å…ˆè·å–/å®ä¾‹åŒ– FactoryBean æœ¬èº«;\n\t\t\t\t * \t(æ³¨æ„ä¸€ä¸‹ FactoryBean ç”Ÿæˆå¯¹è±¡æ˜¯ä¸éµå¾ª Spring çš„beanç”Ÿå‘½å‘¨æœŸçš„)\n\t\t\t\t * \tè¿™æœ‰ä¸¤ä¸ªå¯¹è±¡, å¦‚ä½•è·å–? getBean(beanName) :\n\t\t\t\t * \t1. ä¼ å…¥ FactoryBean çš„ name è¿”å›çš„æ˜¯å…¶ getObject çš„ç›®æ ‡å¯¹è±¡å®ä¾‹;\n\t\t\t\t * \t2. å¦‚æœæƒ³è·å– FactoryBean æœ¬èº«å®ä¾‹, åˆ™å‰é¢éœ€è¦åŠ ä¸€ä¸ª '&amp;' å‰ç¼€;\n\t\t\t\t * 6. å°è¯•ä»å½“å‰å®¹å™¨ ä¸€ äºŒ ä¸‰çº§ç¼“å­˜è·å– {@link AbstractBeanFactory#doGetBean(String, Class, Object[], boolean)}\n\t\t\t\t * 7. å¤„ç† AOP ä»£ç†å¯¹è±¡ç”Ÿæˆ {@link AbstractAutowireCapableBeanFactory#createBean(String, RootBeanDefinition, Object[])}\n\t\t\t\t * 8. åœ¨JVMå±‚é¢å®ä¾‹åŒ–å¯¹è±¡ {@link AbstractAutowireCapableBeanFactory#doCreateBean(String, RootBeanDefinition, Object[])}\n\t\t\t\t * \t1.çœŸæ­£åœ¨jvmå±‚é¢å®ä¾‹åŒ–å¯¹è±¡;\n\t\t\t\t * \t\t1. å¦‚æœè¯¥ BeanDefinition æœ‰é…ç½® instanceSupplierå±æ€§(java.util.function.Supplier),\n\t\t\t\t * \t\t å°†ä½¿ç”¨å…¶Supplier#getæ–¹æ³•çš„è¿”å›, ä½œä¸ºå®ä¾‹å¯¹è±¡\n\t\t\t\t * \t\t2. å¦‚æœè¯¥ BeanDefinition æœ‰é…ç½® factory-method å°†ä½¿ç”¨è¯¥æ–¹æ³•è¿”å›çš„, ä½œä¸ºå®ä¾‹å¯¹è±¡\n\t\t\t\t * \t\t è¿™é‡Œè¿™é‡ŒåŒ…æ‹¬'é™æ€å·¥å‚'å’Œ'å®ä¾‹å·¥å‚'çš„å¤„ç†(é€šè¿‡bdçš„factoryBeanName è¿›è¡Œåˆ¤æ–­, å¦‚æœå­˜åœ¨åˆ™æ˜¯'å®ä¾‹å·¥å‚')\n\t\t\t\t * \t\t3. ä½¿ç”¨åå°„å®ä¾‹åŒ–, æ ¹æ®ç­–ç•¥å®ä¾‹åŒ–Beanå¯¹è±¡ {@link org.springframework.beans.factory.support.SimpleInstantiationStrategy}\n\t\t\t\t * \t\t- ä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°æ³¨å…¥,åˆ›å»º (new)\n\t\t\t\t * \t\t- ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°åˆ›å»º (new)\n\t\t\t\t * \t\t- å·¥å‚æ–¹æ³•å®ä¾‹åŒ– ('é™æ€å·¥å‚' 'å®ä¾‹å·¥å‚' )\n\t\t\t\t * \t\t`&lt;bean  factory-bean=\"bookFactoryBean\"  factory-method=\"getBook()\"/&gt;`\n\t\t\t\t * \t\té™æ€å·¥å‚: factory-bean è‹¥æ˜¯ å…¨é™å®šç±»å åˆ™ä½¿ç”¨ BookFactoryBean::getBook çš„é™æ€æ–¹æ³•è¿”å›çš„å¯¹è±¡\n\t\t\t\t * \t\tå®ä¾‹å·¥å‚:  factory-bean è‹¥æ˜¯ bean å åˆ™ä½¿ç”¨è¯¥å®ä¾‹æ–¹æ³•è¿”å›çš„å¯¹è±¡\n\t\t\t\t * \t2. ç”¨ BeanWrapper åŒ…è£…åŸå§‹bean (è£…é¥°æ¨¡å¼)\n\t\t\t\t * \t3. åˆå§‹åŒ– BeanWrapper\n\t\t\t\t * \t\t1. ç»™ BeanWrapper è®¾ç½®äº†, ConversionService\n\t\t\t\t * \t\t2. ç»™ BeanWrapper æ³¨å†Œäº†, å½“å‰ bean factory (propertyEditorRegistrars)ä¸­çš„å…¨éƒ¨ PropertyEditor\n\t\t\t\t * \t\t3. å¤„ç† MergedBeanDefinitionPostProcessor çš„æ¥å£å›è°ƒ {@link AbstractAutowireCapableBeanFactory#applyMergedBeanDefinitionPostProcessors(RootBeanDefinition, Class, String)}\n\t\t\t\t * \t\tè°ƒç”¨ æ·»åŠ åœ¨ context ä¸­ BeanPostProcessor çš„ MergedBeanDefinitionPostProcessor çš„æ¥å£å›è°ƒ\n\t\t\t\t * \t\tè§£æåˆ°è¯¸å¦‚`@Autowired`ä¹‹ç±»çš„æ³¨è§£ (Metadata)å…ƒä¿¡æ¯,åˆå¹¶åˆ°BeanDefinitionä¸­\n\t\t\t\t * \t4. å¡«å……Beanå±æ€§ {@link AbstractAutowireCapableBeanFactory#populateBean(String, RootBeanDefinition, BeanWrapper)}\n\t\t\t\t * \t\t1. å¦‚æœæ˜¯AOP, pointcut, adviceç›¸å…³çš„, synthetic ä¼šé…ç½®ä¸º true  è°ƒç”¨ BeanPostProcessor çš„å­æ¥å£ InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation\n\t\t\t\t * \t\t(ä½œç”¨æ˜¯ åœ¨å®ä¾‹åŒ–ä¹‹åï¼Œå±æ€§å¡«å……ä¹‹å‰æ‰§è¡Œæ“ä½œ, å¯ä»¥æ‹¦æˆªå±æ€§å¡«å……æ“ä½œ)\n\t\t\t\t * \t\t2. å¤„ç†æ³¨è§£çš„  byName æˆ–è€… byType æ³¨å…¥çš„å±æ€§\n\t\t\t\t * \t\t3. å›è°ƒæ‰€æœ‰ InstantiationAwareBeanPostProcessor#postProcessProperties æ–¹æ³•\n\t\t\t\t * \t\tæ¯”å¦‚, `@Autowired` çš„å¤„ç†å¯¹åº”å®ç°ç±»: {@link org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor}\n\t\t\t\t * \t\t(ä½œç”¨æ˜¯: åœ¨å·¥å‚å°†å±æ€§å€¼åº”ç”¨åˆ°ç»™å®šbeanä¹‹å‰ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¤„ç†)\n\t\t\t\t * \t\tæ³¨æ„è¿™é‡Œä¹Ÿåªæ˜¯è§£æ, å¹¶æ²¡æœ‰è®¾ç½®è¿›å», å®é™…èµ‹å€¼æ–¹æ³•è§: {@link AbstractAutowireCapableBeanFactory#applyPropertyValues(java.lang.String, org.springframework.beans.factory.config.BeanDefinition, org.springframework.beans.BeanWrapper, org.springframework.beans.PropertyValues)}\n\t\t\t\t * \t5.åˆå§‹åŒ–Beanå¯¹è±¡ {@link AbstractAutowireCapableBeanFactory#initializeBean(String, Object, RootBeanDefinition)}\n\t\t\t\t * \t\t1. å…ˆè°ƒç”¨è¿™ä¸‰ä¸ª BeanNameAware, BeanClassLoaderAware, BeanFactoryAware {@link AbstractAutowireCapableBeanFactory#invokeAwareMethods(String, Object)}\n\t\t\t\t * \t\tè¿™ä¸‰ä¸ªæ˜¯åœ¨åˆ›å»ºBeanFactory æ—¶å¿½ç•¥çš„ä¸‰ä¸ª Aware æ¥å£\n\t\t\t\t * \t\t2. è°ƒç”¨æ‰€æœ‰ BeanPostProcessors#postProcessBeforeInitialization (ä½œç”¨: åœ¨Beanåˆå§‹åŒ–ä¹‹å‰è°ƒç”¨) {@link AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsBeforeInitialization(Object, String)}\n\t\t\t\t * \t\t3. è°ƒç”¨ init-method æ–¹æ³• {@link AbstractAutowireCapableBeanFactory#invokeInitMethods(String, Object, RootBeanDefinition)}\n\t\t\t\t * \t\t4. è°ƒç”¨æ‰€æœ‰ BeanPostProcessors#postProcessAfterInitialization (ä½œç”¨: åœ¨Beanåˆå§‹åŒ–ä¹‹åè°ƒç”¨) {@link AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsAfterInitialization(Object, String)}\n\t\t\t\t * \t6. æ³¨å†Œ beané”€æ¯çš„å·¥ä½œ(å¦‚æœéœ€è¦){@link AbstractBeanFactory#registerDisposableBeanIfNecessary(String, Object, RootBeanDefinition)}\n\t\t\t\t * \t\t\t1. org.springframework.beans.factory.config.DestructionAwareBeanPostProcessor#postProcessBeforeDestruction(Object,String) BPPæ¥å£\n\t\t\t\t * \t\t\t2. org.springframework.beans.factory.DisposableBean æ¥å£\n\t\t\t\t * \t\t\t3. è‡ªå®šä¹‰ destroyæ–¹æ³•\n\t\t\t\t * \t\t\t(åœ¨å®¹å™¨å…³é—­æ—¶ä¼šè°ƒç”¨ä¼šæŒ‰è¿™ä¸ªé¡ºåºè°ƒç”¨)\n\t\t\t\t *\n\t\t\t\t */\n\t\t\t\tfinishBeanFactoryInitialization(beanFactory);\n\n\t\t\t\t// Last step: publish corresponding event.\n\t\t\t\t/**\n\t\t\t\t * åäºŒ, å®Œæˆå®¹å™¨åˆ·æ–°\n\t\t\t\t * 1. æ¸…ç†å„ç§ç¼“å­˜èµ„æº\n\t\t\t\t * 2. ä¸ºå½“å‰ä¸Šä¸‹æ–‡åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨\n\t\t\t\t * 3. å‘å¸ƒ ContextRefreshedEvent (Context å®Œæˆåˆ·æ–°)äº‹ä»¶\n\t\t\t\t */\n\t\t\t\tfinishRefresh();\n\t\t\t}\n\n\t\t\tcatch (RuntimeException | Error ex ) {\n\t\t\t\tif (logger.isWarnEnabled()) {\n\t\t\t\t\tlogger.warn(\"Exception encountered during context initialization - \" +\n\t\t\t\t\t\t\t\"cancelling refresh attempt: \" + ex);\n\t\t\t\t}\n\t\t\t\t// Destroy already created singletons to avoid dangling resources.\n\t\t\t\tdestroyBeans();\n\n\t\t\t\t// Reset 'active' flag.\n\t\t\t\tcancelRefresh(ex);\n\n\t\t\t\t// Propagate exception to caller.\n\t\t\t\tthrow ex;\n\t\t\t}\n\n\t\t\tfinally {\n\t\t\t\tcontextRefresh.end();\n\t\t\t}\n\t\t}\n\t}\n</code></pre>\n<h2 id=\"ä¸€--applicationcontextçš„é¢„å‡†å¤‡å·¥ä½œ\">ä¸€.  (ApplicationContext)çš„é¢„å‡†å¤‡å·¥ä½œ</h2>\n<p>ApplicationContext çš„é¢„å‡†å¤‡å·¥ä½œ, å®¹å™¨åˆ·æ–°å‰çš„å‡†å¤‡å·¥ä½œ<br />\n<code>org.springframework.context.support.AbstractApplicationContext#prepareRefresh</code></p>\n<pre><code class=\"language-java\">/**\n\t * Prepare this context for refreshing, setting its startup date and\n\t * active flag as well as performing any initialization of property sources.\n\t * å®¹å™¨åˆ·æ–°å‰çš„å‡†å¤‡å·¥ä½œ\n\t * 1. è®¾ç½®å®¹å™¨çš„ä¸€äº›çŠ¶æ€æ ‡å¿—ç¬¦;è®¾ç½®å¯åŠ¨æ—¶é—´, æ´»åŠ¨æ ‡å¿—ç¬¦; {@link AbstractApplicationContext#prepareRefresh()}\n\t * 2. è·å–æˆ–è€…åˆ›å»º Environment å¯¹è±¡; åŠ è½½ System.getProperties(); {@see AbstractApplicationContext#environment}\n\t * 3. éªŒè¯ç¯å¢ƒæ˜¯å¦åŒ…å«æŸé…ç½®; æ‰‹åŠ¨æ·»åŠ é…ç½®. {@link AbstractApplicationContext#initPropertySources()}\n\t * 4. å‡†å¤‡å­˜å‚¨ äº‹ä»¶ç›‘å¬å™¨ å’Œ äº‹ä»¶ çš„é›†åˆå®¹å™¨, é»˜è®¤ä¸ºç©º {@link AbstractApplicationContext#prepareRefresh()};\n\t */\n\tprotected void prepareRefresh() {\n\t\t// è®¾ç½®å®¹å™¨çš„ä¸€äº›çŠ¶æ€æ ‡å¿—ç¬¦;è®¾ç½®å¯åŠ¨æ—¶é—´, æ´»åŠ¨æ ‡å¿—ç¬¦;\n\t\t// Switch to active.\n\t\tthis.startupDate = System.currentTimeMillis();\n\t\tthis.closed.set(false);\n\t\tthis.active.set(true);\n\n\t\tif (logger.isDebugEnabled()) {\n\t\t\tif (logger.isTraceEnabled()) {\n\t\t\t\tlogger.trace(\"Refreshing \" + this);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlogger.debug(\"Refreshing \" + getDisplayName());\n\t\t\t}\n\t\t}\n\n\t\t// Initialize any placeholder property sources in the context environment.\n\t\t//ç•™ç»™å­ç±»æ‰©å±•çš„æ–¹æ³•: éªŒè¯ç¯å¢ƒæ˜¯å¦åŒ…å«æŸé…ç½®; æ‰‹åŠ¨æ·»åŠ é…ç½®;...\n\t\tinitPropertySources();\n\n\t\t// Validate that all properties marked as required are resolvable:\n\t\t/**\n\t\t *  éªŒè¯å¿…é¡»çš„å­˜åœ¨çš„é…ç½®. ä¾‹å¦‚è°ƒç”¨ `setRequiredProperties(\"iot.config.thread\")`ä¹‹å, åœ¨è¿™é‡Œä¼šéªŒè¯æ˜¯å¦å­˜åœ¨ iot.config.thread é…ç½®,å¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ MissingRequiredPropertiesException\n\t\t * \t {@link ConfigurablePropertyResolver#setRequiredProperties(String...) }\n\t\t */\n\t\tgetEnvironment().validateRequiredProperties();\n\n\t\t// s tore pre-refresh ApplicationListeners...\n\t\t//å­˜å‚¨ç›‘å¬å™¨çš„é›†åˆåˆå§‹åŒ–; this.earlyApplicationEvents(åˆ·æ–°å‰çš„ç›‘å¬å™¨)\n\t\tif (this.earlyApplicationListeners == null) {\n\t\t\t//å¦‚æœä¸ºç©º,åˆ™æ·»åŠ  this.applicationListeners åœ¨bootä¸­æ˜¯æœ‰å€¼çš„\n\t\t\tthis.earlyApplicationListeners = new LinkedHashSet&lt;&gt;(this.applicationListeners);\n\t\t}\n\t\telse {\n\t\t\t// å¦‚æœä¸ä¸ºç©º, åˆ™æ¸…ç©º; æ³¨æ„è¿™æ˜¯ content çš„å¤ç”¨æ–¹æ³• Refresh()\n\t\t\t// Reset local application listeners to pre-refresh state.\n\t\t\tthis.applicationListeners.clear();\n\t\t\tthis.applicationListeners.addAll(this.earlyApplicationListeners);\n\t\t}\n\n\t\t// Allow for the collection of early ApplicationEvents,\n\t\t// to be published once the multicaster is available...\n\t\tthis.earlyApplicationEvents = new LinkedHashSet&lt;&gt;();\n\t}\n</code></pre>\n<h3 id=\"æ€»ç»“-1\">æ€»ç»“</h3>\n<ol>\n<li>è®¾ç½®å®¹å™¨çš„ä¸€äº›çŠ¶æ€æ ‡å¿—ç¬¦;è®¾ç½®å¯åŠ¨æ—¶é—´, æ´»åŠ¨æ ‡å¿—ç¬¦;</li>\n<li>è·å–æˆ–è€…åˆ›å»º Environment å¯¹è±¡; åŠ è½½ System.getProperties();</li>\n<li>éªŒè¯ç¯å¢ƒæ˜¯å¦åŒ…å«æŸé…ç½®; æ‰‹åŠ¨æ·»åŠ é…ç½®.</li>\n<li>å‡†å¤‡å­˜å‚¨ äº‹ä»¶ç›‘å¬å™¨ å’Œ äº‹ä»¶ çš„é›†åˆå®¹å™¨, é»˜è®¤ä¸ºç©º {@link AbstractApplicationContext#prepareRefresh()};</li>\n</ol>\n<h2 id=\"äºŒ-åˆ›å»º-beanfactory---obtainfreshbeanfactory\">äºŒ. åˆ›å»º BeanFactory - obtainFreshBeanFactory()</h2>\n<h3 id=\"åˆ›å»º-beanfactory\">åˆ›å»º BeanFactory</h3>\n<p>ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯åˆ›å»ºå­˜å‚¨Beançš„å®¹å™¨å•¦..<br />\n<code>org.springframework.context.support.AbstractApplicationContext#obtainFreshBeanFactory</code><br />\n<code>org.springframework.context.support.AbstractRefreshableApplicationContext#refreshBeanFactory</code></p>\n<pre><code class=\"language-java\">\n\t/**\n\t * This implementation performs an actual refresh of this context's underlying\n\t * bean factory, shutting down the previous bean factory (if any) and\n\t * initializing a fresh bean factory for the next phase of the context's lifecycle.\n\t *  {@link org.springframework.context.support.AbstractRefreshableApplicationContext#refreshBeanFactory}\n\t */\n\t@Override\n\tprotected final void refreshBeanFactory() throws BeansException {\n\t\t// å¦‚æœæœ‰ åˆ™é”€æ¯ä¹‹å‰çš„ BeanFactory\n\t\tif (hasBeanFactory()) {\n\t\t\tdestroyBeans();\n\t\t\tcloseBeanFactory();\n\t\t}\n\t\ttry {\n\t\t\t/**\n\t\t\t * &lt;!&gt; åˆ›å»º DefaultListableBeanFactory {@link org.springframework.context.support.AbstractRefreshableApplicationContext#createBeanFactory}\n\t\t\t *  è®¾ç½® beanFactory å¿½ç•¥  BeanNameAware, BeanClassLoaderAware, BeanFactoryAwareè¿™ä¸‰ä¸ªAwareçš„æ¥å£ {@link AbstractAutowireCapableBeanFactory#AbstractAutowireCapableBeanFactory()}\n\t\t\t *  å› ä¸ºåœ¨åˆå§‹åŒ–Beanæ—¶, ä¼šç›´æ¥è°ƒç”¨å®ƒä»¬(è€Œä¸æ˜¯é€šè¿‡é€šè¿‡ BeanPostProcessoræ‰©å±•çš„Awareæœºåˆ¶è°ƒç”¨) {@link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#initializeBean(java.lang.String, java.lang.Object, org.springframework.beans.factory.support.RootBeanDefinition)}\n\t\t\t */\n\t\t\tDefaultListableBeanFactory beanFactory = createBeanFactory();\n\t\t\t// è®¾ç½® beanFactory åºåˆ—åŒ–ID\n\t\t\tbeanFactory.setSerializationId(getId());\n\t\t\t/**\n\t\t\t *  å®šåˆ¶åŒ– BeanFactory &lt;!&gt; å¯æ‰©å±•ç‚¹\n\t\t\t *  {@link org.springframework.context.support.AbstractRefreshableApplicationContext#customizeBeanFactory(org.springframework.beans.factory.support.DefaultListableBeanFactory)}\n\t\t\t *  1. æ˜¯å¦å…è®¸ BeanDefinition è¦†ç›–; å¦‚æœä¸æ˜¯null,åˆ™è¦†ç›–é»˜è®¤å€¼, å¯ä»¥ç•™ç»™å­ç±»æ‰©å±•çš„\n\t\t\t *  2. æ˜¯å¦è‡ªåŠ¨å¤„ç†å¾ªç¯ä¾èµ–; å¯ä»¥ç•™ç»™å­ç±»æ‰©å±•çš„\n\t\t\t */\n\t\t\tcustomizeBeanFactory(beanFactory);\n\t\t\t/**\n\t\t\t * åŠ è½½ BeanDefinitions &lt;!&gt;é‡ç‚¹ {@link AbstractRefreshableApplicationContext#loadBeanDefinitions(DefaultListableBeanFactory)}\n\t\t\t * 1. åˆ›å»º(XMLè§£æå™¨/è¯»å–å™¨) XmlBeanDefinitionReader, å¹¶åˆå§‹åŒ–; ç•™ä¸‹æ‰©å±•ç‚¹, æ‰©å±•Reader ä¾‹å¦‚ æ˜¯å¦éªŒè¯xmlç­‰\n\t\t\t * 2. åˆ›å»ºç›¸å…³å¯¹è±¡ DocumentLoader, BeanDefinitionDocumentReader, BeanDefinitionParserDelegate\n\t\t\t *    åŠ è½½è§£æ XMLçš„æ ‡ç­¾/å…ƒç´ /å±æ€§ ç­‰å¹¶ä¸”å°†å…¶å°è£…ä¸º ä¸€ä¸ªä¸ª BeanDefinition å¯¹è±¡\n\t\t\t * 3. å°† BeanDefinitions æ³¨å†Œåˆ° registry\n\t\t\t */\n\t\t\tloadBeanDefinitions(beanFactory);\n\t\t\tthis.beanFactory = beanFactory;\n\t\t}\n\t\tcatch (IOException ex) {\n\t\t\tthrow new ApplicationContextException(\"I/O error parsing bean definition source for \" + getDisplayName(), ex);\n\t\t}\n\t}\n</code></pre>\n<p><code>org.springframework.context.support.AbstractRefreshableApplicationContext#createBeanFactory</code></p>\n<pre><code class=\"language-java\">/**\n\t * Create an internal bean factory for this context.\n\t * Called for each {@link #refresh()} attempt.\n\t * &lt;p&gt;The default implementation creates a\n\t * {@link org.springframework.beans.factory.support.DefaultListableBeanFactory}\n\t * with the {@linkplain #getInternalParentBeanFactory() internal bean factory} of this\n\t * context's parent as parent bean factory. Can be overridden in subclasses,\n\t * for example to customize DefaultListableBeanFactory's settings.\n\t * @return the bean factory for this context\n\t * @see org.springframework.beans.factory.support.DefaultListableBeanFactory#setAllowBeanDefinitionOverriding\n\t * @see org.springframework.beans.factory.support.DefaultListableBeanFactory#setAllowEagerClassLoading\n\t * @see org.springframework.beans.factory.support.DefaultListableBeanFactory#setAllowCircularReferences\n\t * @see org.springframework.beans.factory.support.DefaultListableBeanFactory#setAllowRawInjectionDespiteWrapping\n\t */\n\tprotected DefaultListableBeanFactory createBeanFactory() {\n\t\treturn new DefaultListableBeanFactory(getInternalParentBeanFactory());\n\t}\n</code></pre>\n<p>åˆ›å»ºçš„å®ä¾‹æ˜¯ <code>DefaultListableBeanFactory</code></p>\n<h3 id=\"åˆ›å»º-xmlbeandefinitionreader\">åˆ›å»º XmlBeanDefinitionReader</h3>\n<p><code>XmlBeanDefinitionReader</code> è¿™ä¸ªå¯¹è±¡æ˜¯ç”¨æ¥è¯»å– xml é…ç½®çš„</p>\n<p><code>org.springframework.context.support.AbstractXmlApplicationContext#loadBeanDefinitions(org.springframework.beans.factory.support.DefaultListableBeanFactory)</code></p>\n<pre><code class=\"language-java\">/**\n * Loads the bean definitions via an XmlBeanDefinitionReader.\n *\n *  1. åˆ›å»º(XMLè§£æå™¨/è¯»å–å™¨) XmlBeanDefinitionReader {@link AbstractXmlApplicationContext#loadBeanDefinitions(DefaultListableBeanFactory)}\n *    - ç»™ beanDefinitionReader è®¾ç½®ç¯å¢ƒå¯¹è±¡, å¯ä»¥è®© XmlBeanDefinitionReader åšå˜é‡è¡¨è¾¾å¼è§£ææ¯”å¦‚ ${jdbc.url}\n *    - ç»™ beanDefinitionReader è®¾ç½® BeanFactory\n * \t  - ç»™ beanDefinitionReader è®¾ç½® è¦ç”¨äºè§£æçš„SAXå®ä½“è§£æå™¨; (SAXå…¨ç§° Simple API for XMLï¼Œæ—¢æ˜¯ä¸€ç§æ¥å£ï¼Œä¹Ÿæ˜¯ä¸€ç§è½¯ä»¶åŒ…ã€‚å®ƒæ˜¯ä¸€ç§XMLè§£æçš„æ›¿ä»£æ–¹æ³•)\n * \t\t\tæ³¨æ„è¿™é‡ŒåŠ è½½äº†ä¸¤ä¸ªå¯¹è±¡: 1. BeansDtdResolver (XSD,DTDè§£æå™¨); 2. PluggableSchemaResolver  æ˜ å°„(æœ¬åœ°æ–‡ä»¶xsdæ£€éªŒ) 'META-INF/spring.schemas'æ–‡ä»¶ä¿¡æ¯\n * \t\t\tä¾‹å¦‚, context å‘½åç©ºé—´xmlæ£€éªŒçš„æ˜ å°„:\n * \t\t\t&lt;code&gt; http\\://www.springframework.org/schema/context/spring-context.xsd=org/springframework/context/config/spring-context.xsd&lt;/code&gt;\n * \t\t\t@see DelegatingEntityResolver#DelegatingEntityResolver(java.lang.ClassLoader)\n * {@link AbstractXmlApplicationContext#initBeanDefinitionReader(XmlBeanDefinitionReader)}\n *  2. è°ƒç”¨æ‰©å±•ç‚¹æ–¹æ³•, æ‰©å±•/å®šåˆ¶ XmlBeanDefinitionReader\n *  3. åŠ è½½ BeanDefinitions &lt;!&gt;\n *\n * @see org.springframework.beans.factory.xml.XmlBeanDefinitionReader\n * @see #initBeanDefinitionReader\n * @see #loadBeanDefinitions\n */\n@Override\nprotected void loadBeanDefinitions(DefaultListableBeanFactory beanFactory) throws BeansException, IOException {\n\t// Create a new XmlBeanDefinitionReader for the given BeanFactory.\n\t/**\n\t * åˆ›å»º(XMLè§£æå™¨/è¯»å–å™¨) XmlBeanDefinitionReader {@link AbstractXmlApplicationContext#loadBeanDefinitions(DefaultListableBeanFactory)}\n\t * æ³¨æ„ä¼ è¿‡å»çš„ DefaultListableBeanFactory å®ƒå®ç°äº† BeanDefinitionRegistry ä½œä¸º Registry ä¼ é€’è¿›å»\n\t * æœ€åè§£æå‡ºæ¥çš„ BeanDefinition, ä½¿ç”¨è¯¥ Registry ä½œä¸ºæ³¨å†Œä¸­å¿ƒ\n\t */\n\tXmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory);\n\t// Configure the bean definition reader with this context's\n\t// resource loading environment.\n\t// ç»™ beanDefinitionReader è®¾ç½®ç¯å¢ƒå¯¹è±¡, å¯ä»¥è®© XmlBeanDefinitionReader åšå˜é‡è¡¨è¾¾å¼è§£ææ¯”å¦‚ ${jdbc.url}\n\tbeanDefinitionReader.setEnvironment(getEnvironment());\n\t// ç»™ beanDefinitionReader è®¾ç½® BeanFactory\n\tbeanDefinitionReader.setResourceLoader(this);\n\t/**\n\t * ç»™ beanDefinitionReader è®¾ç½® è¦ç”¨äºè§£æçš„SAXå®ä½“è§£æå™¨; (SAXå…¨ç§° Simple API for XMLï¼Œæ—¢æ˜¯ä¸€ç§æ¥å£ï¼Œä¹Ÿæ˜¯ä¸€ç§è½¯ä»¶åŒ…ã€‚å®ƒæ˜¯ä¸€ç§XMLè§£æçš„æ›¿ä»£æ–¹æ³•)\n\t * \t\tæ³¨æ„è¿™é‡ŒåŠ è½½äº†ä¸¤ä¸ªå¯¹è±¡: 1. BeansDtdResolver (XSD,DTDè§£æå™¨); 2. PluggableSchemaResolver  æ˜ å°„(æœ¬åœ°æ–‡ä»¶xsdæ£€éªŒ) 'META-INF/spring.schemas'æ–‡ä»¶ä¿¡æ¯\n\t * \t\t\t\tä¾‹å¦‚, context å‘½åç©ºé—´xmlæ£€éªŒçš„æ˜ å°„: `http\\://www.springframework.org/schema/context/spring-context.xsd=org/springframework/context/config/spring-context.xsd`\n\t * \t\tä½¿ç”¨è¿™ä¸¤ä¸ªè§£æå™¨é¿å…ä»ç½‘ç»œä¸‹è½½DTDæˆ–XSD,è§£æå™¨ä¼šæ ¹æ®è¿™äº›æ¨¡å¼å®šä¹‰éªŒè¯é…ç½®æ–‡ä»¶çš„ç»“æ„æ˜¯å¦æ­£ç¡®ã€‚å¦‚æœéªŒè¯å¤±è´¥ï¼Œå®¹å™¨å°†æ— æ³•å¯åŠ¨\n\t * @see DelegatingEntityResolver#DelegatingEntityResolver(java.lang.ClassLoader)\n\t */\n\tbeanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this));\n\n\t// Allow a subclass to provide custom initialization of the reader,\n\t// then proceed with actually loading the bean definitions.\n\t/**\n\t * è°ƒç”¨æ‰©å±•ç‚¹æ–¹æ³•, æ‰©å±•/å®šåˆ¶ XmlBeanDefinitionReader {@link AbstractXmlApplicationContext#initBeanDefinitionReader(XmlBeanDefinitionReader)}\n\t */\n\tinitBeanDefinitionReader(beanDefinitionReader);\n\t\n\t/**\n\t * åŠ è½½ BeanDefinitions, å¹¶æ³¨å†Œåˆ° Registry ä¸­, è¿™ä¸ªæ­¥éª¤, ä¸ºäº†å¤ç”¨ä»£ç åµŒå¥—çš„æ–¹æ³•éå¸¸å¤š, æ€»ç»“ä¸€ä¸‹å…³é”®ç‚¹\n\t * 1. ä¸ºäº†ä»£ç å¤ç”¨,å¤šä¸ªæ–¹æ³•é‡è½½ é…ç½®æ–‡ä»¶è·¯å¾„ (Stringå‚æ•°), å¤šé…ç½®æ–‡ä»¶(æ•°ç»„å‚æ•°) , åœ¨ç»Ÿä¸€è½¬ä¸º `org.springframework.core.io.Resource` å¯¹è±¡å»è¿­ä»£\n\t * \t\tæœ€ç»ˆè¯»å–é…ç½®æ–‡ä»¶çš„è¾“å…¥æµåœ¨ {@link org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.support.EncodedResource)}\n\t * 2.\n\t */\n\tloadBeanDefinitions(beanDefinitionReader);\n}\n</code></pre>\n<h4 id=\"è‡ªå®šä¹‰å‘½åç©ºé—´å¤„ç†å™¨\">è‡ªå®šä¹‰å‘½åç©ºé—´å¤„ç†å™¨</h4>\n<p>æ³¨æ„ä¸€ç‚¹  <code>XmlBeanDefinitionReader</code> æŒæœ‰ ä¸€ä¸ª <code>namespaceHandlerResolver</code>, é»˜è®¤å®ƒçš„åˆ›å»ºé€»è¾‘æ˜¯åœ¨<br />\n<code>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#createDefaultNamespaceHandlerResolver</code></p>\n<pre><code class=\"language-java\">\n/**\n\t * Create the default implementation of {@link NamespaceHandlerResolver} used if none is specified.\n\t * &lt;p&gt;The default implementation returns an instance of {@link DefaultNamespaceHandlerResolver}.\n\t * @see DefaultNamespaceHandlerResolver#DefaultNamespaceHandlerResolver(ClassLoader)\n\t */\n\tprotected NamespaceHandlerResolver createDefaultNamespaceHandlerResolver() {\n\t\tResourceLoader resourceLoader = getResourceLoader();\n\t\tClassLoader cl = (resourceLoader != null ? resourceLoader.getClassLoader() : getBeanClassLoader());\n\t\t// è§£æè‡ªå®šä¹‰æ ‡ç­¾çš„ NamespaceHandlerResolver å‘½åç©ºé—´ handle æ˜ å°„\n\t\t//\n\t\treturn new DefaultNamespaceHandlerResolver(cl);\n\t}\n</code></pre>\n<h3 id=\"åŠ è½½-beandefinition-åˆ°å®¹å™¨\">åŠ è½½ BeanDefinition åˆ°å®¹å™¨</h3>\n<p>è¿™ä¸€æ­¥ ä¸ºäº†å¤ç”¨, åµŒå¥—çš„æ–¹æ³•éå¸¸å¤š, è¿™é‡Œåˆ—å‡ºå…³é”®æ–¹æ³•</p>\n<h4 id=\"è½¬ä¸ºæ•°ç»„å‚æ•°è¿­ä»£\">è½¬ä¸ºæ•°ç»„å‚æ•°è¿­ä»£</h4>\n<p>æ•°ç»„æ–¹å¼è¿­ä»£ä»¥æ”¯æŒå¤šé…ç½®æ–‡ä»¶</p>\n<pre><code class=\"language-java\">\t/**\n\t * Load the bean definitions with the given XmlBeanDefinitionReader.\n\t * &lt;p&gt;The lifecycle of the bean factory is handled by the {@link #refreshBeanFactory}\n\t * method; hence this method is just supposed to load and/or register bean definitions.\n\t *\n\t * æ ¹æ®èµ„æºæ–‡ä»¶æ•°ç»„è¿­ä»£åŠ è½½è§£æ\n\t * \t\tåŠ è½½ Resource[] å½¢å¼çš„é…ç½®æ–‡ä»¶\n\t * \t\tåŠ è½½ String[] å½¢å¼çš„é…ç½®æ–‡ä»¶\n\t *\n\t * @param reader the XmlBeanDefinitionReader to use\n\t * @throws BeansException in case of bean registration errors\n\t * @throws IOException if the required XML document isn't found\n\t * @see #refreshBeanFactory\n\t * @see #getConfigLocations\n\t * @see #getResources\n\t * @see #getResourcePatternResolver\n\t */\n\tprotected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws BeansException, IOException {\n\t\t//åŠ è½½ Resource[] å½¢å¼çš„é…ç½®æ–‡ä»¶\n\t\tResource[] configResources = getConfigResources();\n\t\tif (configResources != null) {\n\t\t\treader.loadBeanDefinitions(configResources);\n\t\t}\n\t\t//åŠ è½½ String[] å½¢å¼çš„é…ç½®æ–‡ä»¶\n\t\tString[] configLocations = getConfigLocations();\n\t\tif (configLocations != null) {\n\t\t\treader.loadBeanDefinitions(configLocations);\n\t\t}\n\t}\n</code></pre>\n<h4 id=\"è½¬ä¸º-resource\">è½¬ä¸º Resource</h4>\n<p>ç»Ÿä¸€è½¬ä¸º <code>Resource</code> å¯¹è±¡ä»¥æ–¹ä¾¿åŠ è½½</p>\n<pre><code class=\"language-java\">\t/**\n\t * Load bean definitions from the specified resource location.\n\t * &lt;p&gt;The location can also be a location pattern, provided that the\n\t * ResourceLoader of this bean definition reader is a ResourcePatternResolver.\n\t * @param location the resource location, to be loaded with the ResourceLoader\n\t * (or ResourcePatternResolver) of this bean definition reader\n\t * @param actualResources a Set to be filled with the actual Resource objects\n\t * that have been resolved during the loading process. May be {@code null}\n\t * to indicate that the caller is not interested in those Resource objects.\n\t * @return the number of bean definitions found\n\t * @throws BeanDefinitionStoreException in case of loading or parsing errors\n\t * @see #getResourceLoader()\n\t * @see #loadBeanDefinitions(org.springframework.core.io.Resource)\n\t * @see #loadBeanDefinitions(org.springframework.core.io.Resource[])\n\t */\n\tpublic int loadBeanDefinitions(String location, @Nullable Set&lt;Resource&gt; actualResources) throws BeanDefinitionStoreException {\n\t\tResourceLoader resourceLoader = getResourceLoader();\n\t\tif (resourceLoader == null) {\n\t\t\tthrow new BeanDefinitionStoreException(\n\t\t\t\t\t\"Cannot load bean definitions from location [\" + location + \"]: no ResourceLoader available\");\n\t\t}\n\t\tif (resourceLoader instanceof ResourcePatternResolver resourcePatternResolver) {\n\t\t\t// Resource pattern matching available.\n\t\t\ttry {\n\t\t\t\t/**\n\t\t\t\t * å¯¹äºå˜é‡å¤„ç† åœ¨ {@link org.springframework.context.support.AbstractRefreshableConfigApplicationContext#setConfigLocations(String...)} å·²ç»å¤„ç†è¿‡ä¸€éäº†, è¿™é‡Œåˆå¤„ç†ä¸€é?\n\t\t\t\t *\n\t\t\t\t * è¿™é‡Œçš„é‡ç‚¹æ˜¯: å°† String è·¯å¾„ è½¬ä¸ºResourcedå¯¹è±¡, å¤„ä¸å¤„ç†å˜é‡æ— æ‰€è°“, ä¸æ˜¯é‡ç‚¹\n\t\t\t\t * å¤„ç†æ–‡ä»¶ååŒ…å«å˜é‡è¡¨è¾¾å¼çš„, ä¾‹å¦‚: application-${active}.xml, ç”¨ç¯å¢ƒå¯¹è±¡å˜é‡æ›¿æ¢ä¹‹\n\t\t\t\t */\n\t\t\t\tResource[] resources = resourcePatternResolver.getResources(location);\n\t\t\t\tint count = loadBeanDefinitions(resources);\n\t\t\t\tif (actualResources != null) {\n\t\t\t\t\tCollections.addAll(actualResources, resources);\n\t\t\t\t}\n\t\t\t\tif (logger.isTraceEnabled()) {\n\t\t\t\t\tlogger.trace(\"Loaded \" + count + \" bean definitions from location pattern [\" + location + \"]\");\n\t\t\t\t}\n\t\t\t\treturn count;\n\t\t\t}\n\t\t\tcatch (IOException ex) {\n\t\t\t\tthrow new BeanDefinitionStoreException(\n\t\t\t\t\t\t\"Could not resolve bean definition resource pattern [\" + location + \"]\", ex);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// Can only load single resources by absolute URL.\n\t\t\tResource resource = resourceLoader.getResource(location);\n\t\t\tint count = loadBeanDefinitions(resource);\n\t\t\tif (actualResources != null) {\n\t\t\t\tactualResources.add(resource);\n\t\t\t}\n\t\t\tif (logger.isTraceEnabled()) {\n\t\t\t\tlogger.trace(\"Loaded \" + count + \" bean definitions from location [\" + location + \"]\");\n\t\t\t}\n\t\t\treturn count;\n\t\t}\n\t}\n</code></pre>\n<h4 id=\"è½¬ä¸º-encodedresource\">è½¬ä¸º EncodedResource</h4>\n<p>è½¬ä¸º <code>EncodedResource</code> å¯¹è±¡ä»¥è§£å†³ç¼–ç <br />\n<code>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.Resource)</code></p>\n<pre><code class=\"language-java\">/**  \n * å°† Resource åŒ…è£…ä¸º EncodedResource åŠ è½½, åº”è¯¥ä¸»è¦æ˜¯è§£å†³ç¼–ç çš„é—®é¢˜  \n * Load bean definitions from the specified XML file.  \n * @param resource the resource descriptor for the XML file  \n * @return the number of bean definitions found  \n * @throws BeanDefinitionStoreException in case of loading or parsing errors  \n */@Override  \npublic int loadBeanDefinitions(Resource resource) throws BeanDefinitionStoreException {  \n    return loadBeanDefinitions(new EncodedResource(resource));  \n}\n\n</code></pre>\n<h4 id=\"è¯»å–é…ç½®æ–‡ä»¶è¾“å…¥æµ\">è¯»å–é…ç½®æ–‡ä»¶è¾“å…¥æµ</h4>\n<p><code>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.support.EncodedResource)</code></p>\n<pre><code class=\"language-java\">/**\n\t * æ ¡éªŒä¸€ä¸‹, è¿™é‡Œè§£å†³å¾ªç¯å¯¼å…¥\n\t * Load bean definitions from the specified XML file.\n\t * @param encodedResource the resource descriptor for the XML file,\n\t * allowing to specify an encoding to use for parsing the file\n\t * @return the number of bean definitions found\n\t * @throws BeanDefinitionStoreException in case of loading or parsing errors\n\t */\n\tpublic int loadBeanDefinitions(EncodedResource encodedResource) throws BeanDefinitionStoreException {\n\t\tAssert.notNull(encodedResource, \"EncodedResource must not be null\");\n\t\tif (logger.isTraceEnabled()) {\n\t\t\tlogger.trace(\"Loading XML bean definitions from \" + encodedResource);\n\t\t}\n\n\t\t//ä½¿ç”¨Setå­˜å‚¨å·²åŠ è½½çš„é…ç½®èµ„æº\n\t\tSet&lt;EncodedResource&gt; currentResources = this.resourcesCurrentlyBeingLoaded.get();\n\n\t\t// å½“é‡åˆ°å¾ªç¯ import definitions æ—¶æŠ›å‡ºå¼‚å¸¸\n\t\tif (!currentResources.add(encodedResource)) {\n\t\t\tthrow new BeanDefinitionStoreException(\n\t\t\t\t\t\"Detected cyclic loading of \" + encodedResource + \" - check your import definitions!\");\n\t\t}\n\t\t// è·å¾—é…ç½®æ–‡ä»¶çš„è¾“å…¥æµ; è¿™é‡ŒçœŸæ­£çš„å¼€å§‹è¯»\n\t\ttry (InputStream inputStream = encodedResource.getResource().getInputStream()) {\n\t\t\tInputSource inputSource = new InputSource(inputStream);\n\t\t\tif (encodedResource.getEncoding() != null) {\n\t\t\t\tinputSource.setEncoding(encodedResource.getEncoding());\n\t\t\t}\n\t\t\treturn doLoadBeanDefinitions(inputSource, encodedResource.getResource());\n\t\t}\n\t\tcatch (IOException ex) {\n\t\t\tthrow new BeanDefinitionStoreException(\n\t\t\t\t\t\"IOException parsing XML document from \" + encodedResource.getResource(), ex);\n\t\t}\n\t\tfinally {\n\t\t\tcurrentResources.remove(encodedResource);\n\t\t\tif (currentResources.isEmpty()) {\n\t\t\t\tthis.resourcesCurrentlyBeingLoaded.remove();\n\t\t\t}\n\t\t}\n\t}\n</code></pre>\n<h4 id=\"åˆ›å»º--beandefinitiondocumentreader\">åˆ›å»º  BeanDefinitionDocumentReader</h4>\n<p><code>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions</code></p>\n<pre><code class=\"language-java\">/**\n\t * Register the bean definitions contained in the given DOM document.\n\t * Called by {@code loadBeanDefinitions}.\n\t * &lt;p&gt;Creates a new instance of the parser class and invokes\n\t * {@code registerBeanDefinitions} on it.\n\t * @param doc the DOM document\n\t * @param resource the resource descriptor (for context information)\n\t * @return the number of bean definitions found\n\t * @throws BeanDefinitionStoreException in case of parsing errors\n\t * @see #loadBeanDefinitions\n\t * @see #setDocumentReaderClass\n\t * @see BeanDefinitionDocumentReader#registerBeanDefinitions\n\t */\n\tpublic int registerBeanDefinitions(Document doc, Resource resource) throws BeanDefinitionStoreException {\n\t\t/**\n\t\t *  è¿™é‡Œåˆåˆ›å»ºäº†ä¸€ä¸ª BeanDefinitionDocumentReader å¯¹è±¡, ç”¨æ¥è¯»å–/è§£æ Document\n\t\t */\n\t\tBeanDefinitionDocumentReader documentReader = createBeanDefinitionDocumentReader();\n\t\tint countBefore = getRegistry().getBeanDefinitionCount();\n\n\t\t/**\n\t\t * è§£æå¹¶æ³¨å†Œ bean definitions åˆ° Registry ä¸­\n\t\t * &lt;br /&gt;\n\t\t * è§£æXMLè‡ªå®šä¹‰æ ‡ç­¾ éœ€è¦æ³¨æ„ä¸€ä¸‹, è¿™é‡Œçš„ç¬¬2ä¸ªå‚æ•°åˆ›å»ºçš„ XmlReaderContext;\n\t\t * \t\tå®ƒä»è¿™é‡Œåˆ›å»ºäº† {@link XmlBeanDefinitionReader#getNamespaceHandlerResolver()} å‘½åç©ºé—´å¤„ç†å™¨è§£æå™¨, åç»­è§£æåˆ°å¯¹åº”çš„å‘½åç©ºé—´å¤„ç†, è°ƒç”¨å…¶ NamespaceHandler#parse è¿›è¡Œè§£æ\n\t\t * \t\tå®ƒé»˜è®¤è¯»å–çš„é…ç½®æ˜¯ `META-INF/spring.handlers`\n\t\t * \t\tä¾‹å¦‚:\n\t\t * \t\tspring-context æ¨¡å—çš„ä¸­ `META-INF/spring.handlers` å®šä¹‰çš„handlesæœ‰å¦‚ä¸‹è¿™äº›\n\t\t * http\\://www.springframework.org/schema/context=org.springframework.context.config.ContextNamespaceHandler\n\t\t * http\\://www.springframework.org/schema/jee=org.springframework.ejb.config.JeeNamespaceHandler\n\t\t * http\\://www.springframework.org/schema/lang=org.springframework.scripting.config.LangNamespaceHandler\n\t\t * http\\://www.springframework.org/schema/task=org.springframework.scheduling.config.TaskNamespaceHandler\n\t\t * http\\://www.springframework.org/schema/cache=org.springframework.cache.config.CacheNamespaceHandler\n\t\t *\n\t\t * \t\tspring-aop æ¨¡å—çš„ä¸­ `META-INF/spring.handlers` å®šä¹‰çš„handlesæœ‰å¦‚ä¸‹è¿™äº›\n\t\t * http\\://www.springframework.org/schema/aop=org.springframework.aop.config.AopNamespaceHandler\n\t\t */\n\t\tdocumentReader.registerBeanDefinitions(doc, createReaderContext(resource));\n\t\t// è¿”å›è§£æ bean definitions çš„æ•°é‡\n\t\treturn getRegistry().getBeanDefinitionCount() - countBefore;\n\t}\n</code></pre>\n<h4 id=\"é€’å½’åµŒå¥—åŠ è½½\">é€’å½’åµŒå¥—åŠ è½½</h4>\n<p><code>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions</code></p>\n<pre><code class=\"language-java\">/**\n\t * Register each bean definition within the given root {@code &lt;beans/&gt;} element.\n\t *  åœ¨ç»™å®šçš„(beans)æ ¹å…ƒç´ ä¸­æ³¨å†Œæ¯ä¸ªbeanå®šä¹‰, è¿™é‡Œçš„ Element æ˜¯ xml æ ¹å…ƒç´ \n\t */\n\t@SuppressWarnings(\"deprecation\")  // for Environment.acceptsProfiles(String...)\n\tprotected void doRegisterBeanDefinitions(Element root) {\n\t\t// Any nested &lt;beans&gt; elements will cause recursion in this method. In\n\t\t// order to propagate and preserve &lt;beans&gt; default-* attributes correctly,\n\t\t// keep track of the current (parent) delegate, which may be null. Create\n\t\t// the new (child) delegate with a reference to the parent for fallback purposes,\n\t\t// then ultimately reset this.delegate back to its original (parent) reference.\n\t\t// this behavior emulates a stack of delegates without actually necessitating one.\n\t\t/**\n\t\t * åœ¨æ­¤æ–¹æ³•ä¸­ï¼Œä»»ä½•åµŒå¥—çš„&lt;beans&gt;å…ƒç´ éƒ½å°†å¯¼è‡´é€’å½’è°ƒç”¨\n\t\t *   ä¸ºäº†æ­£ç¡®åœ°ä¼ æ’­å’Œä¿å­˜&lt;beans&gt;é»˜è®¤å±æ€§ï¼Œè¯·è·Ÿè¸ªå½“å‰(çˆ¶)å§”æ‰˜(å®ƒå¯èƒ½ä¸ºç©º)ã€‚\n\t\t *   åˆ›å»ºæ–°çš„(å­)å§”æ‰˜ï¼Œå¹¶å°†å…¶å¼•ç”¨åˆ°çˆ¶(çˆ¶)å§”æ‰˜ç”¨äºå›é€€ç›®çš„ï¼Œç„¶åæœ€ç»ˆå°† this.delegateé‡ç½®ä¸ºå…¶åŸå§‹(çˆ¶)å¼•ç”¨ã€‚\n\t\t *   æ­¤è¡Œä¸ºæ¨¡æ‹Ÿå§”æ‰˜å †æ ˆï¼Œè€Œå®é™…ä¸Šä¸éœ€è¦å§”æ‰˜å †æ ˆã€‚\n\t\t *\n\t\t * åº”è¯¥æ˜¯åµŒå¥—è§£æ/é€’å½’æ—¶, éƒ½ç”¨è¿™ä¸€ä¸ª delegateè§£æ, ä¿å­˜çŠ¶æ€, ç”¨äºä¼ é€’ä¸Šä¸‹æ–‡çš„å‚æ•°;\n\t\t */\n\t\tBeanDefinitionParserDelegate parent = this.delegate;\n\t\t/**\n\t\t * å§”æ‰˜ namespaceHandlerResolver\n\t\t */\n\t\tthis.delegate = createDelegate(getReaderContext(), root, parent);//parent å§”æ´¾, ä¸Šçº§çš„parent\n\n\t\t/**\n\t\t * æ˜¯å¦é»˜è®¤å‘½åç©ºé—´; è¿™é‡Œæ˜¯ xml çš„å‘½åç©ºé—´è§£æåˆ¤æ–­\n\t\t *    ç®€è€Œè¨€ä¹‹é»˜è®¤å‘½åç©ºé—´åˆ¤å®šæ˜¯: http://www.springframework.org/schema/beans æˆ–è€…æ˜¯ org/springframework/beans/factory/xml/spring-beans.dtd å…¶DTDå®šä¹‰çš„æ ‡ç­¾\n\t\t *    å¦‚:\n\t\t *    &lt;beans..&gt;&lt;/beans&gt;, &lt;bean&gt;&lt;/bean&gt;, &lt;import resource=\"\" /&gt; è¿™äº›æ ‡ç­¾æ˜¯é»˜è®¤å‘½åç©ºé—´\n\t\t *    &lt;tx:TAG ...&gt; , &lt;aop:TAG ...&gt; è¿™äº›æ ‡ç­¾ä¸æ˜¯é»˜è®¤å‘½åç©ºé—´\n\t\t */\n\t\tif (this.delegate.isDefaultNamespace(root)) {\n\t\t\tString profileSpec = root.getAttribute(PROFILE_ATTRIBUTE);\n\t\t\tif (StringUtils.hasText(profileSpec)) {\n\t\t\t\tString[] specifiedProfiles = StringUtils.tokenizeToStringArray(\n\t\t\t\t\t\tprofileSpec, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS);\n\t\t\t\t// We cannot use Profiles.of(...) since profile expressions are not supported\n\t\t\t\t// in XML config. See SPR-12458 for details.\n\t\t\t\tif (!getReaderContext().getEnvironment().acceptsProfiles(specifiedProfiles)) {\n\t\t\t\t\tif (logger.isDebugEnabled()) {\n\t\t\t\t\t\tlogger.debug(\"Skipped XML bean definition file due to specified profiles [\" + profileSpec +\n\t\t\t\t\t\t\t\t\"] not matching: \" + getReaderContext().getResource());\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// å‰ç½®-é’©å­æ–¹æ³•, é¢„ç•™æ‰©å±•, è¿™é‡Œæ˜¯ç©ºå®ç°\n\t\tpreProcessXml(root);\n\t\t// çœŸæ­£è§£æé€»è¾‘\n\t\tparseBeanDefinitions(root, this.delegate);\n\t\t// åç½®-é’©å­æ–¹æ³•, é¢„ç•™æ‰©å±•, è¿™é‡Œæ˜¯ç©ºå®ç°\n\t\tpostProcessXml(root);\n\n\t\tthis.delegate = parent;\n\t}\n</code></pre>\n<h4 id=\"è§£æé»˜è®¤å‘½åç©ºé—´\">è§£æé»˜è®¤å‘½åç©ºé—´</h4>\n<pre><code class=\"language-java\">/**\n\t * Parse the elements at the root level in the document:\n\t * \"import\", \"alias\", \"bean\".\n\t * @param root the DOM root element of the document\n\t */\n\tprotected void parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) {\n\t\tif (delegate.isDefaultNamespace(root)) {\n\t\t\tNodeList nl = root.getChildNodes();\n\t\t\tfor (int i = 0; i &lt; nl.getLength(); i++) {\n\t\t\t\tNode node = nl.item(i);\n\t\t\t\tif (node instanceof Element ele) {//æ˜¯å¦ æ˜¯å…ƒç´ æ ‡ç­¾\n\t\t\t\t\t/**\n\t\t\t\t\t * å¤„ç†é»˜è®¤å‘½åç©ºé—´çš„æ ‡ç­¾, æœ‰å¦‚ä¸‹å››ä¸ª\n\t\t\t\t\t * &lt;import&gt;&lt;/import&gt;, &lt;alias&gt;&lt;/alias&gt;, &lt;bean&gt;&lt;/bean&gt;, &lt;beans&gt;&lt;/beans&gt;\n\t\t\t\t\t *\n\t\t\t\t\t */\n\t\t\t\t\tif (delegate.isDefaultNamespace(ele)) {\n\t\t\t\t\t\tparseDefaultElement(ele, delegate);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * å¤„ç† éé»˜è®¤å‘½åç©ºé—´çš„æ ‡ç­¾;\n\t\t\t\t\t\t * \tæ³¨æ„è¿™é‡ŒåŒ…æ‹¬ &lt;context:bean ...&gt; &lt;aop:xx ...&gt; &lt;tx:xx ...&gt; ç­‰ç­‰æ‰€æœ‰æŒ‡å®šå‘½åç©ºé—´çš„xmlé…ç½®\n\t\t\t\t\t\t */\n\t\t\t\t\t\tdelegate.parseCustomElement(ele);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tdelegate.parseCustomElement(root);\n\t\t}\n\t}\n</code></pre>\n<p><code>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#parseDefaultElement</code></p>\n<pre><code class=\"language-java\">/**\n\t * é»˜è®¤å‘½åç©ºé—´çš„å¤„ç†\n\t * @param ele\n\t * @param delegate\n\t */\n\tprivate void parseDefaultElement(Element ele, BeanDefinitionParserDelegate delegate) {\n\t\t// é»˜è®¤å‘½åç©ºé—´çš„ import å…ƒç´ å¤„ç†\n\t\tif (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) {\n\t\t\timportBeanDefinitionResource(ele);\n\t\t}\n\t\t// é»˜è®¤å‘½åç©ºé—´çš„ alias å…ƒç´ å¤„ç†\n\t\telse if (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) {\n\t\t\tprocessAliasRegistration(ele);\n\t\t}\n\t\t// é»˜è®¤å‘½åç©ºé—´çš„ bean å…ƒç´ å¤„ç†\n\t\telse if (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) {\n\t\t\tprocessBeanDefinition(ele, delegate);\n\t\t}\n\t\t// é»˜è®¤å‘½åç©ºé—´çš„ beans å…ƒç´ å¤„ç†\n\t\telse if (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) {\n\t\t\t// recurse\n\t\t\tdoRegisterBeanDefinitions(ele);\n\t\t}\n\t}\n</code></pre>\n<h4 id=\"è§£æè‡ªå®šä¹‰æ ‡ç­¾\">è§£æè‡ªå®šä¹‰æ ‡ç­¾</h4>\n<p><code>org.springframework.beans.factory.xml.BeanDefinitionParserDelegate#parseCustomElement(org.w3c.dom.Element, org.springframework.beans.factory.config.BeanDefinition)</code></p>\n<pre><code class=\"language-java\">\t/**\n\t * ä¸»è¦é€»è¾‘æ˜¯ æ‹¿åˆ°å…ƒç´ çš„å‘½åç©ºé—´URI, å†ä» XmlReaderContext æ‰¾åˆ°å¯¹åº”çš„ NamespaceHandler è°ƒç”¨è§£æ `parse`æ–¹æ³•è§£æåˆ° BeanDefinition è¿”å›\n\t *  Parse a custom element (outside the default namespace).\n\t * @param ele the element to parse\n\t * @param containingBd the containing bean definition (if any)\n\t * @return the resulting bean definition\n\t */\n\t@Nullable\n\tpublic BeanDefinition parseCustomElement(Element ele, @Nullable BeanDefinition containingBd) {\n\t\t//æ‹¿åˆ° å‘½åç©ºé—´URI\n\t\tString namespaceUri = getNamespaceURI(ele);\n\t\tif (namespaceUri == null) {\n\t\t\treturn null;\n\t\t}\n\t\t/**\n\t\t * æ‹¿åˆ°å¯¹åº”å‘½åç©ºé—´çš„ Handler , this.readerContext æ˜¯åœ¨\n\t\t * @see org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions(org.w3c.dom.Document, org.springframework.core.io.Resource) åˆ›å»ºçš„\n\t\t * \t\tå®ƒä¼šä»çˆ¶å±æ€§çš„ namespaceHandlerResolver ä¸­æ‹¿åˆ°å‘½åç©ºé—´å¤„ç†å™¨, è°ƒç”¨NamespaceHandler#parse è¿›è¡Œè§£æ\n\t\t * \t\tå®ƒé»˜è®¤è¯»å–çš„é…ç½®æ˜¯ `META-INF/spring.handlers` æ–‡ä»¶\n\t\t *\n\t\t * spring å¯¹äº æ³¨è§£ AOP TXäº‹åŠ¡ çš„æ”¯æŒ, å‡æ˜¯åŒä¸ªè¿™ç§æ–¹å¼æ‰©å±•çš„, ä½†è¿™äº›ä¸å±IOCå†…å®¹, æœ¬ç¯‡ä¸ä½œè¯´æ˜..\n\t\t */\n\t\tNamespaceHandler handler = this.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);\n\t\tif (handler == null) {\n\t\t\terror(\"Unable to locate Spring NamespaceHandler for XML schema namespace [\" + namespaceUri + \"]\", ele);\n\t\t\treturn null;\n\t\t}\n\t\t// è°ƒç”¨ Handler è§£æ, è¿”å›çš„æ˜¯ BeanDefinition;\n\t\treturn handler.parse(ele, new ParserContext(this.readerContext, this, containingBd));\n\t}\n</code></pre>\n<h4 id=\"æ³¨å†Œ-beandefinition-åˆ°-registry\">æ³¨å†Œ BeanDefinition åˆ° Registry</h4>\n<p><code>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#processBeanDefinition</code></p>\n<pre><code class=\"language-java\">/**\n\t * Process the given bean element, parsing the bean definition\n\t * and registering it with the registry.\n\t *\n\t * - å¤„ç†beanå…ƒç´ ï¼Œè§£æ BeanDefinition å¹¶å°†å…¶æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒã€‚\n\t * - å…¶å®å°±æ˜¯å¾€ DefaultListableBeanFactory çš„è¿™ä¸¤ä¸ªé›†åˆå±æ€§æ·»åŠ :\n\t * \t\t1. è¿™ä¸ªlist å­˜å‚¨æ‰€æœ‰çš„ bean definition åç§° {@link org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionNames}\n\t * \t\t2. è¿™ä¸ªmapå­˜å‚¨æ‰€æœ‰çš„BeanDefinition, keyæ˜¯beanä¸»name, valueæ˜¯BeanDefinition {@link org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionMap}\n\t */\n\tprotected void processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate) {\n\t\t/**\n\t\t * å¯¹äº BeanDefinitionHolder å…¶å®å®ƒå°±æ˜¯ä¸€ä¸ªDTOå¯¹è±¡, å®ƒåŒ…å«ä»¥ä¸‹å±æ€§:\n\t\t * \tprivate final BeanDefinition beanDefinition;//Bean  beanDefinition\n\t\t * \tprivate final String beanName; \t\t\t\t//Bean åç§°\n\t\t *  private final String[] aliases;\t\t\t\t//Bean åˆ«ååˆ—è¡¨\n\t\t *\n\t\t */\n\t\tBeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele);\n\n\t\t// æ­¤æ—¶, å°±å®Œæˆäº† å¯¹ BeanDefinition è§£æäº†\n\t\tif (bdHolder != null) {\n\t\t\t/**\n\t\t\t * è£…é¥° BeanDefinitionï¼ˆå¦‚æœéœ€è¦ï¼‰, ç±»ä¼¼äº:\n\t\t\t * \t\t&lt;bean id=\"user\" class=\"..\"&gt;\n\t\t\t *  \t\t&lt;myBean:user username=\"è¿™æ˜¯ Spring\"/&gt;\n\t\t\t * \t\t&lt;/bean&gt;\n\t\t\t *  å¯¹åº”`myBean:user` è¿™ç§è‡ªå®šä¹‰æ ‡ç­¾è¿›è¡Œå¤„ç†;\n\t\t\t *  åé¢ä¼šæ‰¾åˆ°å¯¹åº”çš„å‘½åç©ºé—´ Handler (NamespaceHandler) è¿›è¡Œå¤„ç† : NamespaceHandler handler = this.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);\n\t\t\t */\n\t\t\tbdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder);\n\t\t\ttry {\n\t\t\t\t/**\n\t\t\t\t * æ³¨å†Œåˆ° Registry\n\t\t\t\t */\n\t\t\t\t// Register the final decorated instance.\n\t\t\t\tBeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());\n\t\t\t}\n\t\t\tcatch (BeanDefinitionStoreException ex) {\n\t\t\t\tgetReaderContext().error(\"Failed to register bean definition with name '\" +\n\t\t\t\t\t\tbdHolder.getBeanName() + \"'\", ele, ex);\n\t\t\t}\n\t\t\t// Send registration event.\n\t\t\tgetReaderContext().fireComponentRegistered(new BeanComponentDefinition(bdHolder));\n\t\t}\n\t}\n</code></pre>\n<p><code>org.springframework.beans.factory.support.BeanDefinitionReaderUtils#registerBeanDefinition</code></p>\n<pre><code class=\"language-java\">/**\n\t * Register the given bean definition with the given bean factory.\n\t * @param definitionHolder the bean definition including name and aliases\n\t * @param registry the bean factory to register with\n\t * @throws BeanDefinitionStoreException if registration failed\n\t */\n\tpublic static void registerBeanDefinition(\n\t\t\tBeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry)\n\t\t\tthrows BeanDefinitionStoreException {\n\n\t\t// Register bean definition under primary name.\n\t\t/**\n\t\t * ä»¥ beanName å‘ Register æ³¨å†Œ\n\t\t * å…¶å®å°±æ˜¯å¾€ DefaultListableBeanFactory çš„è¿™ä¸¤ä¸ªé›†åˆå±æ€§æ·»åŠ :\n\t\t * 1. è¿™ä¸ªlist å­˜å‚¨æ‰€æœ‰çš„ bean definition åç§° {@link org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionNames}\n\t\t * 2. è¿™ä¸ªmapå­˜å‚¨æ‰€æœ‰çš„BeanDefinition, keyæ˜¯beanä¸»name, valueæ˜¯BeanDefinition {@link org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionMap}\n\t\t */\n\t\tString beanName = definitionHolder.getBeanName();\n\t\tregistry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition());\n\n\t\t/**\n\t\t * å‘ Register æ³¨å†Œåˆ«ååˆ—è¡¨\n\t\t * å…¶å®å°±æ˜¯ {@link org.springframework.core.SimpleAliasRegistry#aliasMap}\n\t\t * åœ¨è¿™ä¸ª mapå­˜å‚¨bean çš„åˆ«å, keyæ˜¯åˆ«å, value æ˜¯beanä¸»name;\n\t\t */\n\t\t// Register aliases for bean name, if any.\n\t\tString[] aliases = definitionHolder.getAliases();\n\t\tif (aliases != null) {\n\t\t\tfor (String alias : aliases) {\n\t\t\t\tregistry.registerAlias(beanName, alias);\n\t\t\t}\n\t\t}\n\t}\n</code></pre>\n<p>è‡³æ­¤, BeanDefinition ç®—æ˜¯æˆåŠŸè§£æ, å¹¶æ³¨å†Œåˆ° Register ä¸­äº†</p>\n<h3 id=\"æ€»ç»“-2\">æ€»ç»“</h3>\n<ol>\n<li>é”€æ¯ä¹‹å‰çš„ beanFactory (å¦‚æœæœ‰çš„è¯)</li>\n<li>å®ä¾‹åŒ–/åˆ›å»º beanFactory, è¿™é‡Œæ˜¯å®ä¾‹ç±»æ˜¯ <code>DefaultListableBeanFactory</code></li>\n<li>è®¾ç½® beanFactory å¿½ç•¥  BeanNameAware, BeanClassLoaderAware, BeanFactoryAwareè¿™ä¸‰ä¸ªAwareçš„æ¥å£ {@link AbstractAutowireCapableBeanFactory#AbstractAutowireCapableBeanFactory()}<br />\nå› ä¸ºåœ¨åˆå§‹åŒ–Beanæ—¶, ä¼šç›´æ¥è°ƒç”¨å®ƒä»¬(è€Œä¸æ˜¯é€šè¿‡é€šè¿‡ BeanPostProcessoræ‰©å±•çš„Awareæœºåˆ¶è°ƒç”¨)</li>\n<li>è®¾ç½® beanFactory åºåˆ—åŒ–ID, åç§°</li>\n<li>æ‰©å±•ç‚¹, å®šåˆ¶åŒ–è¿™ä¸ª BeanFactory ä¾‹å¦‚: æ˜¯å¦å…è®¸ BeanDefinition è¦†ç›–; æ˜¯å¦è‡ªåŠ¨å¤„ç†å¾ªç¯ä¾èµ–;</li>\n<li>åˆ›å»º(XMLè§£æå™¨/è¯»å–å™¨) XmlBeanDefinitionReader, å¹¶åˆå§‹åŒ–; ç•™ä¸‹æ‰©å±•ç‚¹, æ‰©å±•Reader ä¾‹å¦‚ æ˜¯å¦éªŒè¯xmlç­‰</li>\n<li>åˆ›å»ºç›¸å…³å¯¹è±¡DocumentLoader, BeanDefinitionDocumentReader,BeanDefinitionParserDelegate {@link org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions(org.w3c.dom.Document, org.springframework.core.io.Resource)}<br />\n{@link DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions(Element)}<br />\nåŠ è½½/è§£æ XMLæ ‡ç­¾/å…ƒç´ /å±æ€§ç­‰å°†å…¶å°è£…ä¸º ä¸€ä¸ªä¸ª BeanDefinition å¯¹è±¡</li>\n<li>å°† BeanDefinitions æ³¨å†Œåˆ° registry</li>\n</ol>\n<h2 id=\"ä¸‰-beanfactoryé¢„å‡†å¤‡å·¥ä½œ\">ä¸‰. (BeanFactory)é¢„å‡†å¤‡å·¥ä½œ</h2>\n<p><code>org.springframework.context.support.AbstractApplicationContext#prepareBeanFactory</code></p>\n<pre><code class=\"language-java\">\t/**\n\t * Configure the factory's standard context characteristics,\n\t * such as the context's ClassLoader and post-processors.\n\t * @param beanFactory the BeanFactory to configure\n\t */\n\tprotected void prepareBeanFactory(ConfigurableListableBeanFactory beanFactory) {\n\t\t// Tell the internal bean factory to use the context's class loader etc.\n\t\t/**\n\t\t * ä¸º beanFactory è®¾ç½® bean çš„ç±»åŠ è½½å™¨\n\t\t */\n\t\tbeanFactory.setBeanClassLoader(getClassLoader());\n\t\t/**\n\t\t * ä¸º beanFactory è®¾ç½® bean çš„è¡¨è¾¾å¼(Spring EL)è§£æå™¨\n\t\t * é»˜è®¤é£æ ¼æ˜¯: `#{var}`  å½“ç„¶è¿™äº› å‰ç¼€ åç¼€éƒ½æ˜¯å¯ä»¥è‡ªå®šä¹‰\n\t\t * å…³äº (Spring EL)è§£æå™¨: StandardBeanExpressionResolver çš„è®¾è®¡æ˜¯ç»„åˆä¼˜äºç»§æ‰¿, å†…éƒ¨æœ‰ä¸¤ä¸ª SpelExpressionParser(çœŸæ­£è§£æçš„) SpelParserConfiguration(é…ç½®ç±»)\n\t\t */\n\t\tbeanFactory.setBeanExpressionResolver(new StandardBeanExpressionResolver(beanFactory.getBeanClassLoader()));\n\n\t\t/**\n\t\t *  ä¸º beanFactory è®¾ç½® PropertyEditorRegistrar\n\t\t *  è¿™ä¸ªä¸»è¦ä¸º Bean è®¾ç½®å±æ€§çš„ç®¡ç†ç±», æ¯”å¦‚, æ—¥æœŸç±»å‹çš„æ•°æ®: å¯ä»¥æ˜¯ç‰¹å®šæ ¼å¼çš„å­—ç¬¦ä¸², æ•°å­—, è¿˜å¯ä»¥æ˜¯æ—¶é—´æˆ³...\n\t\t *  Spring ä¸º bean å¡«å……å±æ€§, ä½¿ç”¨ BeanWrapperImpl åŒ…è£…äº†ä¸€ä¸‹(è£…é¥°æ¨¡å¼)\n\t\t *  BeanWrapperImpl å®ç°äº† PropertyEditorRegistry, å¯ä»¥å¾€é‡Œé¢æ³¨å†Œ PropertyEditor, å¯ä»¥è‡ªå®šä¹‰å±æ€§çš„è½¬æ¢, ç¼–è¾‘é€»è¾‘\n\t\t */\n\t\tbeanFactory.addPropertyEditorRegistrar(new ResourceEditorRegistrar(this, getEnvironment()));\n\n\t\t/**\n\t\t * æ·»åŠ ä¸€ä¸ª BeanPostProcessor å›è°ƒ, ä½œç”¨æ˜¯å¦‚æœBeanå®ç°è¿™äº›æ¥å£:\n\t\t * (bean instanceof EnvironmentAware || bean instanceof EmbeddedValueResolverAware ||\n\t\t * \t\t\t\tbean instanceof ResourceLoaderAware || bean instanceof ApplicationEventPublisherAware ||\n\t\t * \t\t\t\tbean instanceof MessageSourceAware || bean instanceof ApplicationContextAware ||\n\t\t * \t\t\t\tbean instanceof ApplicationStartupAware)\n\t\t *  å®ƒè´Ÿè´£è°ƒç”¨å…¶å¯¹åº” Aware çš„æ–¹æ³•, ç»™Bean æ³¨å…¥å¯¹è±¡\n\t\t *\n\t\t * in short å°±æ˜¯ç»™ bean è®¾ç½® ä¸Šä¸‹æ–‡, å†…ç½®çš„å¯¹è±¡; æ³¨æ„æ˜¯ (postProcessBeforeInitialization)\n\t\t */\n\t\t// Configure the bean factory with context callbacks.\n\t\tbeanFactory.addBeanPostProcessor(new ApplicationContextAwareProcessor(this));\n\n\t\t/**\n\t\t * å› ä¸ºä¸Šé¢ç”± ApplicationContextAwareProcessor è´Ÿè´£æ³¨å…¥ 7ä¸ªæ¥å£\n\t\t * è¿™é‡Œå°±å¿½ç•¥æ‰è¿™7ä¸ªæ¥å£çš„è‡ªåŠ¨æ³¨å…¥\n\t\t * \t\tEnvironmentAware.class, EmbeddedValueResolverAware.class, ResourceLoaderAware.class,\n\t\t * \t\tApplicationEventPublisherAware.class, MessageSourceAware.class, ApplicationContextAware.class, ApplicationStartupAware.class\n\t\t */\n\t\tbeanFactory.ignoreDependencyInterface(EnvironmentAware.class);\n\t\tbeanFactory.ignoreDependencyInterface(EmbeddedValueResolverAware.class);\n\t\tbeanFactory.ignoreDependencyInterface(ResourceLoaderAware.class);\n\t\tbeanFactory.ignoreDependencyInterface(ApplicationEventPublisherAware.class);\n\t\tbeanFactory.ignoreDependencyInterface(MessageSourceAware.class);\n\t\tbeanFactory.ignoreDependencyInterface(ApplicationContextAware.class);\n\t\tbeanFactory.ignoreDependencyInterface(ApplicationStartupAware.class);\n\n\t\t/**\n\t\t * ç±»ä¼¼ @Primary, å½“æœ‰å¤šä¸ªçš„ç›¸åŒç±»å‹çš„æ—¶å€™, æŒ‡å®šè°ä¼˜å…ˆæ³¨å…¥\n\t\t * æŒ‡å®šå†…ç½®çš„ BeanFactory,ResourceLoader,ApplicationEventPublisher,ApplicationContext\n\t\t *  å‡ ä¸ªBeanå¯¹è±¡,  è‡ªåŠ¨æ³¨å…¥çš„ Primary\n\t\t * registerResolvableDependency\n\t\t */\n\t\t// BeanFactory interface not registered as resolvable type in a plain factory.\n\t\t// MessageSource registered (and found for autowiring) as a bean.\n\t\tbeanFactory.registerResolvableDependency(BeanFactory.class, beanFactory);\n\t\tbeanFactory.registerResolvableDependency(ResourceLoader.class, this);\n\t\tbeanFactory.registerResolvableDependency(ApplicationEventPublisher.class, this);\n\t\tbeanFactory.registerResolvableDependency(ApplicationContext.class, this);\n\n\t\t// Register early post-processor for detecting inner beans as ApplicationListeners.\n\t\t/**\n\t\t * TODO æ—¶é—´ç›‘å¬å™¨ç›¸å…³\n\t\t */\n\t\tbeanFactory.addBeanPostProcessor(new ApplicationListenerDetector(this));\n\n\t\t/**\n\t\t * TODO  è¿™é‡Œæ˜¯ AOP AspectJå¤„ç†\n\t\t * LoadTimeWeaver (AOPçš„åŠ è½½æ—¶ç»‡å…¥)\n\t\t */\n\t\t// Detect a LoadTimeWeaver and prepare for weaving, if found.\n\t\tif (!NativeDetector.inNativeImage() &amp;&amp; beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) {\n\t\t\tbeanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory));\n\t\t\t// Set a temporary ClassLoader for type matching.\n\t\t\tbeanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));\n\t\t}\n\n\t\t/**\n\t\t * beanFactory ä¸­å¦‚æœæ²¡æœ‰ä»¥ä¸‹è¿™äº›åç§°çš„ bean åˆ™ ç›´æ¥ç»™ BeanFactory çš„ä¸€çº§ç¼“å­˜, æ³¨å†Œå‡ ä¸ªé»˜è®¤ç¯å¢ƒ Bean\n\t\t */\n\t\t// Register default environment beans.\n\t\tif (!beanFactory.containsLocalBean(ENVIRONMENT_BEAN_NAME)) {\n\t\t\tbeanFactory.registerSingleton(ENVIRONMENT_BEAN_NAME, getEnvironment());\n\t\t}\n\t\tif (!beanFactory.containsLocalBean(SYSTEM_PROPERTIES_BEAN_NAME)) {\n\t\t\tbeanFactory.registerSingleton(SYSTEM_PROPERTIES_BEAN_NAME, getEnvironment().getSystemProperties());\n\t\t}\n\t\tif (!beanFactory.containsLocalBean(SYSTEM_ENVIRONMENT_BEAN_NAME)) {\n\t\t\tbeanFactory.registerSingleton(SYSTEM_ENVIRONMENT_BEAN_NAME, getEnvironment().getSystemEnvironment());\n\t\t}\n\t\tif (!beanFactory.containsLocalBean(APPLICATION_STARTUP_BEAN_NAME)) {\n\t\t\tbeanFactory.registerSingleton(APPLICATION_STARTUP_BEAN_NAME, getApplicationStartup());\n\t\t}\n\t}\n</code></pre>\n<h3 id=\"æ€»ç»“-3\">æ€»ç»“</h3>\n<p>{@link AbstractApplicationContext#prepareBeanFactory(ConfigurableListableBeanFactory)}</p>\n<ol>\n<li>ä¸º beanFactory è®¾ç½® bean çš„ç±»åŠ è½½å™¨</li>\n<li>ä¸º beanFactory è®¾ç½® bean çš„ StandardBeanExpressionResolver (è¡¨è¾¾å¼(Spring EL)è§£æå™¨) {@link ConfigurableBeanFactory#setBeanExpressionResolver(BeanExpressionResolver)}<br />\nå…³äº (Spring EL)è§£æå™¨: StandardBeanExpressionResolver çš„è®¾è®¡æ˜¯ç»„åˆä¼˜äºç»§æ‰¿, å†…éƒ¨æœ‰ä¸¤ä¸ª SpelExpressionParser(çœŸæ­£è§£æçš„) SpelParserConfiguration(é…ç½®ç±»)</li>\n<li>ä¸º beanFactory è®¾ç½® PropertyEditorRegistrar (ä¸»è¦ä¸º Bean è®¾ç½®å±æ€§çš„ç®¡ç†ç±»){@link ConfigurableBeanFactory#addPropertyEditorRegistrar(PropertyEditorRegistrar)}<br />\nPropertyEditorRegistrar è¿™ä¸ªä¸»è¦ä¸º Bean è®¾ç½®å±æ€§çš„ç®¡ç†ç±», æ¯”å¦‚, æ—¥æœŸç±»å‹çš„æ•°æ®: å¯ä»¥æ˜¯ç‰¹å®šæ ¼å¼çš„å­—ç¬¦ä¸², æ•°å­—, è¿˜å¯ä»¥æ˜¯æ—¶é—´æˆ³...<br />\nSpring ä¸º bean å¡«å……å±æ€§, ä½¿ç”¨ BeanWrapperImpl åŒ…è£…äº†ä¸€ä¸‹(è£…é¥°æ¨¡å¼)<br />\nBeanWrapperImpl å®ç°äº† PropertyEditorRegistry, å¯ä»¥å¾€é‡Œé¢æ³¨å†Œ PropertyEditor, å¯ä»¥è‡ªå®šä¹‰å±æ€§çš„è½¬æ¢, ç¼–è¾‘é€»è¾‘</li>\n<li>ç»™ beanFactory æ·»åŠ ä¸€ä¸ª å¤„ç†Awareçš„ BeanPostProcessor (ApplicationContextAwareProcessor) å¹¶å¿½ç•¥æ‰è¿™7ä¸ªæ¥å£çš„è‡ªåŠ¨æ³¨å…¥:{@link ConfigurableBeanFactory#addBeanPostProcessor(BeanPostProcessor)}<br />\nEnvironmentAware.class, EmbeddedValueResolverAware.class, ResourceLoaderAware.class, ApplicationEventPublisherAware.class, MessageSourceAware.class, ApplicationContextAware.class, ApplicationStartupAware.class</li>\n<li>æŒ‡å®šå†…ç½®çš„ BeanFactory,ResourceLoader,ApplicationEventPublisher,ApplicationContext {@link ConfigurableListableBeanFactory#registerResolvableDependency(Class, Object)}<br />\nè¿™å‡ ä¸ªBeanå¯¹è±¡,  è‡ªåŠ¨æ³¨å…¥çš„ Primary</li>\n<li>ç»™ beanFactory æ·»åŠ ä¸€ä¸ª BeanPostProcessor (ApplicationListenerDetector)TODO (äº‹ä»¶ç›‘å¬ç›¸å…³)</li>\n<li>ç»™ beanFactory æ·»åŠ ä¸€ä¸ª BeanPostProcessor(LoadTimeWeaverAwareProcessor) TODO (AOP AspectJ ç»‡å…¥å¤„ç†ç›¸å…³çš„)</li>\n<li>beanFactoryä¸­å¦‚æœæ²¡æœ‰ä»¥ä¸‹åç§°çš„bean, åˆ™ç›´æ¥ç»™ BeanFactory çš„ä¸€çº§ç¼“å­˜, æ³¨å†Œå‡ ä¸ªç¯å¢ƒå¯¹è±¡ Bean {@link SingletonBeanRegistry#registerSingleton(String, Object)}<br />\nåç§°å¸¸é‡åˆ†åˆ«æ˜¯:<br />\norg.springframework.context.ConfigurableApplicationContext#ENVIRONMENT_BEAN_NAME<br />\norg.springframework.context.ConfigurableApplicationContext#SYSTEM_PROPERTIES_BEAN_NAME<br />\norg.springframework.context.ConfigurableApplicationContext#SYSTEM_ENVIRONMENT_BEAN_NAME<br />\norg.springframework.context.ConfigurableApplicationContext#APPLICATION_STARTUP_BEAN_NAME</li>\n</ol>\n<h2 id=\"å››-postprocessbeanfactory-æ‰©å±•ç‚¹è°ƒç”¨\">å››. postProcessBeanFactory æ‰©å±•ç‚¹è°ƒç”¨</h2>\n<p>beanFactory å·²ç»å‡†å¤‡å¥½äº†, ç»™å­ç±»(Context)é¢„ç•™ä¸€ä¸ªæ‰©å±•ç‚¹;</p>\n<p><code>org.springframework.context.support.AbstractApplicationContext#postProcessBeanFactory</code> (è¿™é‡Œæ˜¯ç©ºå®ç°)</p>\n<pre><code class=\"language-java\">/**\n * Modify the application context's internal bean factory after its standard\n * initialization. The initial definition resources will have been loaded but no\n * post-processors will have run and no derived bean definitions will have been\n * registered, and most importantly, no beans will have been instantiated yet.\n * &lt;p&gt;This template method allows for registering special BeanPostProcessors\n * etc in certain AbstractApplicationContext subclasses.\n * @param beanFactory the bean factory used by the application context\n */\nprotected void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {\n}\n</code></pre>\n<h2 id=\"äº”-è°ƒç”¨-beanfactorypostprocessor-å¤„ç†å™¨\">äº”. è°ƒç”¨ BeanFactoryPostProcessor å¤„ç†å™¨</h2>\n<p><code>org.springframework.context.support.AbstractApplicationContext#invokeBeanFactoryPostProcessors</code></p>\n<pre><code class=\"language-java\">/**\n\t * Instantiate and invoke all registered BeanFactoryPostProcessor beans,\n\t * respecting explicit order if given.\n\t * &lt;p&gt;Must be called before singleton instantiation.\n\t */\n\tprotected void invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory beanFactory) {\n\t\t/**\n\t\t * è°ƒç”¨ BeanFactory å†…çš„æ‰€æœ‰ BeanFactoryPostProcessor å’Œ BeanDefinitionRegistryPostProcessor\n\t\t */\n\t\tPostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());\n\n\t\t/**\n\t\t * LOAD_TIME_WEAVER_BEAN_NAME bean æ˜¯AOPç›¸å…³çš„.\n\t\t * åœ¨ GraalVM ä¸­èƒ½ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç , ä¸æ”¯æŒAOPçš„\n\t\t */\n\t\t// Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime\n\t\t// (e.g. through an @Bean method registered by ConfigurationClassPostProcessor)\n\t\tif (!NativeDetector.inNativeImage() &amp;&amp; beanFactory.getTempClassLoader() == null &amp;&amp;\n\t\t\t\tbeanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) {//è¿™é‡Œ beanFactory ä¸åŒ…å« LOAD_TIME_WEAVER_BEAN_NAME\n\t\t\tbeanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory));\n\t\t\tbeanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));\n\t\t}\n\t}\n</code></pre>\n<p><code>org.springframework.context.support.PostProcessorRegistrationDelegate#invokeBeanFactoryPostProcessors(org.springframework.beans.factory.config.ConfigurableListableBeanFactory, java.util.List&lt;org.springframework.beans.factory.config.BeanFactoryPostProcessor&gt;)</code></p>\n<pre><code class=\"language-java\">\t/**\n\t * æ³¨æ„ä¸€ç‚¹ BeanDefinitionRegistryPostProcessor æ˜¯ç»§æ‰¿è‡ª BeanFactoryPostProcessorçš„\n\t * æ€»çš„æ¥è¯´, è°ƒç”¨çš„æ—¶å€™ä¼˜å…ˆçº§æ˜¯:\n\t * 1. è°ƒç”¨æ¥å£çš„ä¼˜å…ˆçº§\n\t * ä¼˜å…ˆè°ƒç”¨(å­ç±») BeanDefinitionRegistryPostProcessor\n\t * å†è°ƒç”¨(çˆ¶ç±») BeanFactoryPostProcessor\n\t *\n\t * 2. è°ƒç”¨æ·»åŠ çš„æ–¹å¼çš„ä¼˜å…ˆçº§\n\t * ä¼˜å…ˆè°ƒç”¨å¤–éƒ¨å…¥å‚ç±», å³ç›´æ¥é€šè¿‡ {@link AbstractApplicationContext#addBeanFactoryPostProcessor(org.springframework.beans.factory.config.BeanFactoryPostProcessor)} ä»£ç æ·»åŠ çš„\n\t * å†è°ƒç”¨å®¹å™¨ä¸­ å®ç° BeanFactoryPostProcessoræˆ–è€… BeanDefinitionRegistryPostProcessor çš„ Bean\n\t */\n\tpublic static void invokeBeanFactoryPostProcessors(\n\t\t\tConfigurableListableBeanFactory beanFactory, List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors) {\n\n\t\t// WARNING: Although it may appear that the body of this method can be easily\n\t\t// refactored to avoid the use of multiple loops and multiple lists, the use\n\t\t// of multiple lists and multiple passes over the names of processors is\n\t\t// intentional. We must ensure that we honor the contracts for PriorityOrdered\n\t\t// and Ordered processors. Specifically, we must NOT cause processors to be\n\t\t// instantiated (via getBean() invocations) or registered in the ApplicationContext\n\t\t// in the wrong order.\n\t\t//\n\t\t// Before submitting a pull request (PR) to change this method, please review the\n\t\t// list of all declined PRs involving changes to PostProcessorRegistrationDelegate\n\t\t// to ensure that your proposal does not result in a breaking change:\n\t\t// https://github.com/spring-projects/spring-framework/issues?q=PostProcessorRegistrationDelegate+is%3Aclosed+label%3A%22status%3A+declined%22\n\n\t\t// Invoke BeanDefinitionRegistryPostProcessors first, if any.\n\t\t/**\n\t\t * å­˜å‚¨å·²ç»è°ƒç”¨ BeanDefinitionRegistryPostProcessor è¿‡çš„ bean name\n\t\t * é¿å…é‡å¤å¤„ç†\n\t\t */\n\t\tSet&lt;String&gt; processedBeans = new HashSet&lt;&gt;();\n\n\t\tif (beanFactory instanceof BeanDefinitionRegistry registry) {\n\n\t\t\t/**\n\t\t\t * å­˜å‚¨ BeanFactoryPostProcessor çš„é›†åˆ, åé¢ç»Ÿä¸€è°ƒç”¨\n\t\t\t */\n\t\t\tList&lt;BeanFactoryPostProcessor&gt; regularPostProcessors = new ArrayList&lt;&gt;();\n\n\t\t\t/**\n\t\t\t * å­˜å‚¨å·²ç»è°ƒç”¨è¿‡çš„ BeanDefinitionRegistryPostProcessor é›†åˆ\n\t\t\t */\n\t\t\tList&lt;BeanDefinitionRegistryPostProcessor&gt; registryProcessors = new ArrayList&lt;&gt;();\n\n\t\t\t/**\n\t\t\t * å…ˆè°ƒç”¨å¤–éƒ¨å…¥å‚çš„ BeanDefinitionRegistryPostProcessor (ä»£ç æ·»åŠ çš„)\n\t\t\t */\n\t\t\tfor (BeanFactoryPostProcessor postProcessor : beanFactoryPostProcessors) {\n\t\t\t\tif (postProcessor instanceof BeanDefinitionRegistryPostProcessor registryProcessor) {\n\t\t\t\t\t// è¿™å°±è°ƒäº†\n\t\t\t\t\tregistryProcessor.postProcessBeanDefinitionRegistry(registry);\n\t\t\t\t\t// æ˜¯ BeanDefinitionRegistryPostProcessor æ¥å£ å­˜å…¥registryProcessors\n\t\t\t\t\tregistryProcessors.add(registryProcessor);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// ä¸æ˜¯ BDRPP  æ˜¯ BeanFactoryPostProcessor(BFPP) å­˜å…¥regularPostProcessors, åé¢åœ¨ç»Ÿä¸€è°ƒç”¨\n\t\t\t\t\tregularPostProcessors.add(postProcessor);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Do not initialize FactoryBeans here: We need to leave all regular beans\n\t\t\t// uninitialized to let the bean factory post-processors apply to them!\n\t\t\t// Separate between BeanDefinitionRegistryPostProcessors that implement\n\t\t\t// PriorityOrdered, Ordered, and the rest.\n\t\t\t/**\n\t\t\t * å½“å‰å°†è°ƒç”¨çš„ BeanDefinitionRegistryPostProcessor é›†åˆ\n\t\t\t */\n\t\t\tList&lt;BeanDefinitionRegistryPostProcessor&gt; currentRegistryProcessors = new ArrayList&lt;&gt;();\n\n\t\t\t// First, invoke the BeanDefinitionRegistryPostProcessors that implement PriorityOrdered.\n\t\t\t// 1. å…ˆè°ƒç”¨ å®ç°PriorityOrdered (æ’åº)çš„ BDRPP\n\t\t\tString[] postProcessorNames =\n\t\t\t\t\tbeanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);\n\t\t\tfor (String ppName : postProcessorNames) {\n\t\t\t\tif (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) {\n\t\t\t\t\t//&lt;!&gt; beanFactory.getBean, å…ˆèµ°å®ä¾‹åŒ–beanæµç¨‹;\n\t\t\t\t\tcurrentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));\n\t\t\t\t\tprocessedBeans.add(ppName);\n\t\t\t\t}\n\t\t\t}\n\t\t\t//æ’åº\n\t\t\tsortPostProcessors(currentRegistryProcessors, beanFactory);\n\t\t\tregistryProcessors.addAll(currentRegistryProcessors);\n\t\t\t//è°ƒç”¨ BDRPP\n\t\t\tinvokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());\n\t\t\t//è°ƒå®Œäº†å°±æ¸…è°ƒ\n\t\t\tcurrentRegistryProcessors.clear();\n\n\t\t\t// Next, invoke the BeanDefinitionRegistryPostProcessors that implement Ordered.\n\t\t\t// 2. å†è°ƒç”¨ å®ç° Ordered (æ’åº)çš„ BDRPP\n\t\t\tpostProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);\n\t\t\tfor (String ppName : postProcessorNames) {\n\t\t\t\tif (!processedBeans.contains(ppName) &amp;&amp; beanFactory.isTypeMatch(ppName, Ordered.class)) {\n\t\t\t\t\tcurrentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));\n\t\t\t\t\tprocessedBeans.add(ppName);\n\t\t\t\t}\n\t\t\t}\n\t\t\tsortPostProcessors(currentRegistryProcessors, beanFactory);\n\t\t\tregistryProcessors.addAll(currentRegistryProcessors);\n\t\t\tinvokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());\n\t\t\tcurrentRegistryProcessors.clear();\n\n\t\t\t// Finally, invoke all other BeanDefinitionRegistryPostProcessors until no further ones appear.\n\t\t\t// 3. å†è°ƒç”¨åœ¨å®¹å™¨ä¸­å®ç° BeanDefinitionRegistryPostProcessors (BDRPP)çš„\n\t\t\tboolean reiterate = true;\n\t\t\twhile (reiterate) {\n\t\t\t\treiterate = false;\n\t\t\t\tpostProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);\n\t\t\t\tfor (String ppName : postProcessorNames) {\n\t\t\t\t\tif (!processedBeans.contains(ppName)) {\n\t\t\t\t\t\tcurrentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));\n\t\t\t\t\t\tprocessedBeans.add(ppName);\n\t\t\t\t\t\treiterate = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsortPostProcessors(currentRegistryProcessors, beanFactory);\n\t\t\t\tregistryProcessors.addAll(currentRegistryProcessors);\n\t\t\t\tinvokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());\n\t\t\t\tcurrentRegistryProcessors.clear();\n\t\t\t}\n\t\t\t// Now, invoke the postProcessBeanFactory callback of all processors handled so far.\n\t\t\tinvokeBeanFactoryPostProcessors(registryProcessors, beanFactory);\n\t\t\t// 3. æœ€åå†è°ƒç”¨BeanFactoryPostProcessor(BFPP)\n\t\t\tinvokeBeanFactoryPostProcessors(regularPostProcessors, beanFactory);\n\t\t}\n\n\t\telse {\n\t\t\t// Invoke factory processors registered with the context instance.\n\t\t\tinvokeBeanFactoryPostProcessors(beanFactoryPostProcessors, beanFactory);\n\t\t}\n\n\t\t// Do not initialize FactoryBeans here: We need to leave all regular beans\n\t\t// uninitialized to let the bean factory post-processors apply to them!\n\t\tString[] postProcessorNames =\n\t\t\t\tbeanFactory.getBeanNamesForType(BeanFactoryPostProcessor.class, true, false);\n\n\t\t// Separate between BeanFactoryPostProcessors that implement PriorityOrdered,\n\t\t// Ordered, and the rest.\n\t\tList&lt;BeanFactoryPostProcessor&gt; priorityOrderedPostProcessors = new ArrayList&lt;&gt;();\n\t\tList&lt;String&gt; orderedPostProcessorNames = new ArrayList&lt;&gt;();\n\t\tList&lt;String&gt; nonOrderedPostProcessorNames = new ArrayList&lt;&gt;();\n\t\tfor (String ppName : postProcessorNames) {\n\t\t\tif (processedBeans.contains(ppName)) {\n\t\t\t\t// skip - already processed in first phase above\n\t\t\t}\n\t\t\telse if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) {\n\t\t\t\tpriorityOrderedPostProcessors.add(beanFactory.getBean(ppName, BeanFactoryPostProcessor.class));\n\t\t\t}\n\t\t\telse if (beanFactory.isTypeMatch(ppName, Ordered.class)) {\n\t\t\t\torderedPostProcessorNames.add(ppName);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tnonOrderedPostProcessorNames.add(ppName);\n\t\t\t}\n\t\t}\n\n\t\t// First, invoke the BeanFactoryPostProcessors that implement PriorityOrdered.\n\t\tsortPostProcessors(priorityOrderedPostProcessors, beanFactory);\n\t\tinvokeBeanFactoryPostProcessors(priorityOrderedPostProcessors, beanFactory);\n\n\t\t// Next, invoke the BeanFactoryPostProcessors that implement Ordered.\n\t\tList&lt;BeanFactoryPostProcessor&gt; orderedPostProcessors = new ArrayList&lt;&gt;(orderedPostProcessorNames.size());\n\t\tfor (String postProcessorName : orderedPostProcessorNames) {\n\t\t\torderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));\n\t\t}\n\t\tsortPostProcessors(orderedPostProcessors, beanFactory);\n\t\tinvokeBeanFactoryPostProcessors(orderedPostProcessors, beanFactory);\n\n\t\t// Finally, invoke all other BeanFactoryPostProcessors.\n\t\tList&lt;BeanFactoryPostProcessor&gt; nonOrderedPostProcessors = new ArrayList&lt;&gt;(nonOrderedPostProcessorNames.size());\n\t\tfor (String postProcessorName : nonOrderedPostProcessorNames) {\n\t\t\tnonOrderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));\n\t\t}\n\t\tinvokeBeanFactoryPostProcessors(nonOrderedPostProcessors, beanFactory);\n\n\t\t// Clear cached merged bean definitions since the post-processors might have\n\t\t// modified the original metadata, e.g. replacing placeholders in values...\n\t\tbeanFactory.clearMetadataCache();\n\t}\n</code></pre>\n<h3 id=\"æ€»ç»“-4\">æ€»ç»“</h3>\n<p>è‹¥æ˜¯æ³¨å†Œçš„bean definition å®ç°äº†è¿™ä¸¤ä¸ªæ¥å£, åˆ™ä¼šè°ƒç”¨(getBean)å®ä¾‹åŒ–å®ƒ, å†è°ƒç”¨ç›¸åº”çš„æ¥å£æ–¹æ³•;<br />\n(æ³¨æ„ä¸€ä¸‹ BeanDefinitionRegistryPostProcessor æ˜¯ç»§æ‰¿è‡ª BeanFactoryPostProcessorçš„)<br />\næ€»çš„æ¥è¯´ è°ƒç”¨çš„ä¼˜å…ˆçº§æ˜¯:</p>\n<ol>\n<li>è°ƒç”¨æ¥å£çš„ä¼˜å…ˆçº§:\n<ol>\n<li>ä¼˜å…ˆè°ƒç”¨(å­ç±») BeanDefinitionRegistryPostProcessor</li>\n<li>å†è°ƒç”¨(çˆ¶ç±») BeanFactoryPostProcessor</li>\n</ol>\n</li>\n<li>è°ƒç”¨æ·»åŠ çš„æ–¹å¼çš„ä¼˜å…ˆçº§:\n<ol>\n<li>ä¼˜å…ˆè°ƒç”¨å¤–éƒ¨å…¥å‚, å³ç›´æ¥é€šè¿‡{@link AbstractApplicationContext#addBeanFactoryPostProcessor(org.springframework.beans.factory.config.BeanFactoryPostProcessor)} ä»£ç æ·»åŠ çš„</li>\n<li>å†è°ƒç”¨å®¹å™¨ä¸­å®ç° BeanFactoryPostProcessor æˆ–è€… BeanDefinitionRegistryPostProcessor çš„ Bean<br />\nè§:</li>\n</ol>\n</li>\n</ol>\n<blockquote>\n<p>å€¼å¾—ä¸€æçš„æ˜¯:  Spring å¯¹äºæ”¯æŒ SPELè¡¨è¾¾å¼, å°±æ˜¯é€šè¿‡ <code>PropertySourcesPlaceholderConfigurer</code> è¿™ç§æ–¹å¼æ‰©å±•å®ç°çš„</p>\n</blockquote>\n<h2 id=\"å…­-æ³¨å†Œ-beanpostprocessor-bppå¤„ç†å™¨\">å…­. æ³¨å†Œ BeanPostProcessor (BPP)å¤„ç†å™¨</h2>\n<p><code>org.springframework.context.support.AbstractApplicationContext#registerBeanPostProcessors</code><br />\n<code>org.springframework.context.support.PostProcessorRegistrationDelegate#registerBeanPostProcessors(org.springframework.beans.factory.config.ConfigurableListableBeanFactory, org.springframework.context.support.AbstractApplicationContext)</code></p>\n<pre><code class=\"language-java\">/**\n\t *  in short:\n\t *  1. æ‹¿åˆ°æ‰€æœ‰å®ç° BeanPostProcessor çš„ bean, ç„¶åè¿›è¡Œåˆ†ç±»å­˜èµ·æ¥\n\t *  è¿™æœ‰ä¸€ç‚¹, Spring å¯¹ BeanDefinition åˆ†æˆä¸‰ç§è§’è‰²:\n\t *  \t1. ç”¨æˆ·å®šä¹‰çš„ Bean (ROLE_APPLICATION)\n\t *      2. è¾ƒå¤æ‚çš„ (ROLE_SUPPORT) è¾ƒå¤æ‚çš„? é€šå¸¸æ˜¯ä¸€ä¸ªå¤–éƒ¨é…ç½®\n\t *      3. Spring å†…ç½®çš„(ROLE_INFRASTRUCTURE)\n\t *  2. å¦‚æœå®ç°äº† BeanPostProcessor åˆ™ä¼šå®ä¾‹åŒ–è¿™ä¸ªbean, ä½†æ³¨æ„è¿™é‡Œåªæ˜¯æ³¨å†Œ,å¹¶ä¸ä¼šè°ƒç”¨BeanPostProcessorçš„ç›¸å…³æ–¹æ³•\n\t *\n\t *  å¦å¤– BeanPostProcessor ç²—ç²’åº¦å¤ªå¤§, Spring è¿˜ç»†åˆ†ä¸€äº›å­æ¥å£:\n\t *  - SmartInstantiationAwareBeanPostProcessor å®ƒæä¾›äº†æ›´é«˜çº§çš„Beanå®ä¾‹åŒ–æ§åˆ¶æ–¹æ³•ã€‚ä¸»è¦ä½œç”¨åœ¨äºå…è®¸å¯¹Beançš„å®ä¾‹åŒ–è¿‡ç¨‹è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶å’Œå®šåˆ¶ã€‚\n\t *  - MergedBeanDefinitionPostProcessor åœ¨åˆå¹¶Beanå®šä¹‰ï¼ˆMergedBeanDefinitionï¼‰ä¹‹åä½†åœ¨å®ä¾‹åŒ–Beanä¹‹å‰ï¼Œå…è®¸å¯¹åˆå¹¶åçš„Beanå®šä¹‰è¿›è¡Œä¿®æ”¹ã€è°ƒæ•´æˆ–é™„åŠ å…ƒæ•°æ®ã€‚\n\t *  - DestructionAwareBeanPostProcessor å®ƒå…è®¸åœ¨Beanè¢«é”€æ¯ä¹‹å‰ï¼ˆä¾‹å¦‚ï¼Œå®¹å™¨å…³é—­æˆ–ç‰¹å®šä½œç”¨åŸŸçš„Beané”€æ¯ï¼‰æ‰§è¡Œä¸€äº›æ“ä½œã€‚\n\t */\n\tpublic static void registerBeanPostProcessors(\n\t\t\tConfigurableListableBeanFactory beanFactory, AbstractApplicationContext applicationContext) {\n\n\t\t// WARNING: Although it may appear that the body of this method can be easily\n\t\t// refactored to avoid the use of multiple loops and multiple lists, the use\n\t\t// of multiple lists and multiple passes over the names of processors is\n\t\t// intentional. We must ensure that we honor the contracts for PriorityOrdered\n\t\t// and Ordered processors. Specifically, we must NOT cause processors to be\n\t\t// instantiated (via getBean() invocations) or registered in the ApplicationContext\n\t\t// in the wrong order.\n\t\t//\n\t\t// Before submitting a pull request (PR) to change this method, please review the\n\t\t// list of all declined PRs involving changes to PostProcessorRegistrationDelegate\n\t\t// to ensure that your proposal does not result in a breaking change:\n\t\t// https://github.com/spring-projects/spring-framework/issues?q=PostProcessorRegistrationDelegate+is%3Aclosed+label%3A%22status%3A+declined%22\n\t\t/**\n\t\t * æ‹¿åˆ°æ‰€æœ‰å®ç° BeanPostProcessor çš„ beanåç§°\n\t\t */\n\t\tString[] postProcessorNames = beanFactory.getBeanNamesForType(BeanPostProcessor.class, true, false);\n\n\t\t// Register BeanPostProcessorChecker that logs an info message when\n\t\t// a bean is created during BeanPostProcessor instantiation, i.e. when\n\t\t// a bean is not eligible for getting processed by all BeanPostProcessors.\n\t\t/**\n\t\t * è®¡ç®— BeanPostProcessor(BPP) çš„æ€»æ•°.\n\t\t * +1 æ˜¯ä»€ä¹ˆæ“ä½œ? åŸå› æ˜¯: ä¸‹ä¸€è¡Œ,åˆåŠ äº†ä¸€ä¸ª BeanPostProcessorChecker\n\t\t */\n\t\tint beanProcessorTargetCount = beanFactory.getBeanPostProcessorCount() + 1 + postProcessorNames.length;\n\t\t// BeanPostProcessorChecker è¿™ä¸ªBeanPostProcessor, æ²¡å•¥å®é™…ä½œç”¨, å°±æ˜¯è®°å½•äº†ä¸€äº›æ—¥å¿—;\n\t\tbeanFactory.addBeanPostProcessor(\n\t\t\t\tnew BeanPostProcessorChecker(beanFactory, postProcessorNames, beanProcessorTargetCount));\n\t\t// Separate between BeanPostProcessors that implement PriorityOrdered,\n\t\t// Ordered, and the rest.\n\t\t/**\n\t\t * å¯¹ BeanPostProcessor è¿›è¡Œåˆ†ç±»å­˜èµ·æ¥,  å†è°ƒç”¨, æ¯ä¸ªé›†åˆåˆ†åˆ«æ˜¯\n\t\t * 1. priorityOrderedPostProcessors //æœ‰å®ç°(PriorityOrdered)æ’åºæ¥å£çš„\n\t\t * 2. internalPostProcessors //Springå†…éƒ¨çš„bean, è§: Springå°†beanåˆ†ä¸ºä¸‰ç§è§’è‰²\n\t\t * 3. orderedPostProcessorNames //å®ç° Ordered æ¥å£\n\t\t * 4. nonOrderedPostProcessorNames //æ²¡æœ‰æŒ‡å®šé¡ºåº, æ— åºçš„\n\t\t */\n\t\tList&lt;BeanPostProcessor&gt; priorityOrderedPostProcessors = new ArrayList&lt;&gt;();\n\t\tList&lt;BeanPostProcessor&gt; internalPostProcessors = new ArrayList&lt;&gt;();\n\t\tList&lt;String&gt; orderedPostProcessorNames = new ArrayList&lt;&gt;();\n\t\tList&lt;String&gt; nonOrderedPostProcessorNames = new ArrayList&lt;&gt;();\n\t\tfor (String ppName : postProcessorNames) {\n\t\t\tif (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) {\n\t\t\t\t/**\n\t\t\t\t * æ³¨æ„, è‹¥ bean å®ç°äº† PriorityOrdered æ¥å£, åˆ™ä¼šä¼˜å…ˆå®ä¾‹åŒ–å®ƒ;\n\t\t\t\t */\n\t\t\t\tBeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);\n\t\t\t\tpriorityOrderedPostProcessors.add(pp);\n\t\t\t\tif (pp instanceof MergedBeanDefinitionPostProcessor) {\n\t\t\t\t\tinternalPostProcessors.add(pp);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (beanFactory.isTypeMatch(ppName, Ordered.class)) {\n\t\t\t\torderedPostProcessorNames.add(ppName);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tnonOrderedPostProcessorNames.add(ppName);\n\t\t\t}\n\t\t}\n\n\t\t// First, register the BeanPostProcessors that implement PriorityOrdered.\n\t\tsortPostProcessors(priorityOrderedPostProcessors, beanFactory);\n\t\tregisterBeanPostProcessors(beanFactory, priorityOrderedPostProcessors);\n\n\t\t// Next, register the BeanPostProcessors that implement Ordered.\n\t\tList&lt;BeanPostProcessor&gt; orderedPostProcessors = new ArrayList&lt;&gt;(orderedPostProcessorNames.size());\n\t\tfor (String ppName : orderedPostProcessorNames) {\n\t\t\tBeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);\n\t\t\torderedPostProcessors.add(pp);\n\t\t\tif (pp instanceof MergedBeanDefinitionPostProcessor) {\n\t\t\t\tinternalPostProcessors.add(pp);\n\t\t\t}\n\t\t}\n\t\tsortPostProcessors(orderedPostProcessors, beanFactory);\n\t\tregisterBeanPostProcessors(beanFactory, orderedPostProcessors);\n\n\t\t/**\n\t\t * æ³¨å†Œæ‰€æœ‰å¸¸è§„BeanPostProcessors\n\t\t * è¿™é‡Œ getBean å®ä¾‹åŒ–bean !;\n\t\t */\n\t\t// Now, register all regular(å¸¸è§„) BeanPostProcessors.\n\t\tList&lt;BeanPostProcessor&gt; nonOrderedPostProcessors = new ArrayList&lt;&gt;(nonOrderedPostProcessorNames.size());\n\t\tfor (String ppName : nonOrderedPostProcessorNames) {\n\t\t\tBeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);\n\t\t\tnonOrderedPostProcessors.add(pp);\n\t\t\tif (pp instanceof MergedBeanDefinitionPostProcessor) {\n\t\t\t\tinternalPostProcessors.add(pp);\n\t\t\t}\n\t\t}\n\t\tregisterBeanPostProcessors(beanFactory, nonOrderedPostProcessors);\n\n\t\t/**\n\t\t * æœ€å, æ³¨å†Œæ‰€æœ‰ å†…ç½® BeanPostProcessor\n\t\t */\n\t\t// Finally, re-register all internal BeanPostProcessors.\n\t\tsortPostProcessors(internalPostProcessors, beanFactory);\n\t\tregisterBeanPostProcessors(beanFactory, internalPostProcessors);\n\n\t\t//æœ€åå†æ”¾ä¸€ä¸ª ApplicationListenerDetector è®©å®ƒåœ¨æœ€å (ä¸æ˜¯é‡ç‚¹, è§ååº”è¯¥æ˜¯äº‹ä»¶ç›¸å…³çš„)\n\t\t// Re-register post-processor for detecting inner beans as ApplicationListeners,\n\t\t// moving it to the end of the processor chain (for picking up proxies etc).\n\t\tbeanFactory.addBeanPostProcessor(new ApplicationListenerDetector(applicationContext));\n\t}\n</code></pre>\n<h3 id=\"æ€»ç»“-5\">æ€»ç»“</h3>\n<ol>\n<li>æ‹¿åˆ°æ‰€æœ‰ BeanPostProcessor ç±»å‹çš„ bean</li>\n<li>å®ä¾‹åŒ– BeanPostProcessor<br />\nä¼˜å…ˆå®ä¾‹åŒ– å®ç°äº† PriorityOrdered æ¥å£çš„, åœ¨å®ä¾‹åŒ–å…¶å®ƒçš„(BPP)</li>\n<li>è¿›è¡Œåˆ†ç±»å­˜åˆ°é›†åˆ {@link PostProcessorRegistrationDelegate#registerBeanPostProcessors(ConfigurableListableBeanFactory, AbstractApplicationContext)}<br />\nå¯¹ BeanPostProcessor è¿›è¡Œåˆ†ç±»å­˜èµ·æ¥,  å†è°ƒç”¨, æ¯ä¸ªé›†åˆåˆ†åˆ«æ˜¯\n<ol>\n<li>priorityOrderedPostProcessors //æœ‰å®ç°(PriorityOrdered)æ’åºæ¥å£çš„</li>\n<li>internalPostProcessors //Springå†…éƒ¨çš„bean, è§: Springå°†beanåˆ†ä¸ºä¸‰ç§è§’è‰²</li>\n<li>orderedPostProcessorNames //å®ç° Ordered æ¥å£</li>\n<li>nonOrderedPostProcessorNames //æ²¡æœ‰æŒ‡å®šé¡ºåº, æ— åºçš„<br />\nè¿™æœ‰ä¸€ç‚¹, Spring å¯¹ BeanDefinition åˆ†æˆä¸‰ç§è§’è‰²:\n<ul>\n<li>ç”¨æˆ·å®šä¹‰çš„ ä¸šåŠ¡ç›¸å…³çš„ Bean Bean (ROLE_APPLICATION)</li>\n<li>è¾ƒå¤æ‚çš„ (ROLE_SUPPORT) è¾ƒå¤æ‚çš„, æ”¯æŒ AOPã€äº‹åŠ¡ç­‰åŠŸèƒ½çš„å†…éƒ¨å®ç°?  (ä¸é‡è¦, ä¸è¦æ¯ä¸€ä¸ªç»†èŠ‚éƒ½æ‰£...)</li>\n<li>Spring å†…ç½®çš„(ROLE_INFRASTRUCTURE)</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>æ’åºå¹¶æ³¨å†Œåˆ° beanFactory\n<ol>\n<li>è¿™é‡ŒæŒ‰å®ç°(PriorityOrdered)æ’åºæ¥å£çš„ã€@Orderedæ³¨è§£çš„ ç­‰æ’åºå­˜èµ·æ¥. å®é™…è°ƒç”¨çš„é¡ºåº å…¶å®å°±æ˜¯å­˜èµ·æ¥çš„é¡ºåº</li>\n<li>å¦å¤– BeanPostProcessor æ¥å£ç²—ç²’åº¦å¤ªå¤§äº†, Spring è¿˜ç»†åˆ†ä¸€äº›å­æ¥å£:\n<ol>\n<li>SmartInstantiationAwareBeanPostProcessor å®ƒæä¾›äº†æ›´é«˜çº§çš„Beanå®ä¾‹åŒ–æ§åˆ¶æ–¹æ³•ã€‚ä¸»è¦ä½œç”¨åœ¨äºå…è®¸å¯¹Beançš„å®ä¾‹åŒ–è¿‡ç¨‹è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶å’Œå®šåˆ¶ã€‚</li>\n<li>MergedBeanDefinitionPostProcessor åœ¨åˆå¹¶Beanå®šä¹‰ï¼ˆMergedBeanDefinitionï¼‰ä¹‹åä½†åœ¨å®ä¾‹åŒ–Beanä¹‹å‰ï¼Œå…è®¸å¯¹åˆå¹¶åçš„Beanå®šä¹‰è¿›è¡Œä¿®æ”¹ã€è°ƒæ•´æˆ–é™„åŠ å…ƒæ•°æ®ã€‚</li>\n<li>DestructionAwareBeanPostProcessor å®ƒå…è®¸åœ¨Beanè¢«é”€æ¯ä¹‹å‰ï¼ˆä¾‹å¦‚ï¼Œå®¹å™¨å…³é—­æˆ–ç‰¹å®šä½œç”¨åŸŸçš„Beané”€æ¯ï¼‰æ‰§è¡Œä¸€äº›æ“ä½œã€‚<br />\nç­‰ç­‰ä»¥ä¸Šä¹Ÿä¼šå­˜èµ·æ¥</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>æœ€ç»ˆè°ƒç”¨ BPPæ˜¯åœ¨ {@link AbstractApplicationContext#finishBeanFactoryInitialization(ConfigurableListableBeanFactory)} å®ä¾‹åˆå§‹åŒ–å…¶ä»–Beanè°ƒç”¨</li>\n</ol>\n<h2 id=\"ä¸ƒ-åˆå§‹åŒ–å›½é™…åŒ–i18n-ä¿¡æ¯æº\">ä¸ƒ. åˆå§‹åŒ–å›½é™…åŒ–(I18N) ä¿¡æ¯æº</h2>\n<p><code>org.springframework.context.support.AbstractApplicationContext#initMessageSource</code></p>\n<pre><code class=\"language-java\">/**\n\t * Initialize the MessageSource.\n\t * Use parent's if none defined in this context.\n\t * ä¸»è¦æ˜¯å¯¹I18Nå›½é™…åŒ–çš„å¤„ç†ï¼Œ\n\t */\n\tprotected void initMessageSource() {\n\t\t/**\n\t\t * //æ‹¿åˆ° bean factory\n\t\t */\n\t\tConfigurableListableBeanFactory beanFactory = getBeanFactory();\n\t\t/**\n\t\t * æ˜¯å¦æœ‰å®šä¹‰åç§°ä¸º MESSAGE_SOURCE_BEAN_NAME çš„ Bean\n\t\t *  {@link org.springframework.context.support.AbstractApplicationContext#MESSAGE_SOURCE_BEAN_NAME }\n\t\t */\n\t\tif (beanFactory.containsLocalBean(MESSAGE_SOURCE_BEAN_NAME)) {\n\t\t\tthis.messageSource = beanFactory.getBean(MESSAGE_SOURCE_BEAN_NAME, MessageSource.class);\n\t\t\t// Make MessageSource aware of parent MessageSource.\n\t\t\tif (this.parent != null &amp;&amp; this.messageSource instanceof HierarchicalMessageSource hms &amp;&amp;\n\t\t\t\t\thms.getParentMessageSource() == null) {\n\t\t\t\t// Only set parent context as parent MessageSource if no parent MessageSource\n\t\t\t\t// registered already.\n\t\t\t\t/**\n\t\t\t\t * å¦‚æœæœ‰çš„è¯ï¼Œå°±ä½¿ç”¨è¯¥å®šä¹‰çš„MessageSource å¤„ç†æ¶ˆæ¯å›½é™…åŒ–\n\t\t\t\t */\n\t\t\t\thms.setParentMessageSource(getInternalParentMessageSource());\n\t\t\t}\n\t\t\tif (logger.isTraceEnabled()) {\n\t\t\t\tlogger.trace(\"Using MessageSource [\" + this.messageSource + \"]\");\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t/**\n\t\t\t *  å¦‚æœæ²¡æœ‰ MESSAGE_SOURCE_BEAN_NAME åˆ™é»˜è®¤ä½¿ç”¨ DelegatingMessageSource;\n\t\t\t *  æ³¨å†Œåˆ° beanFactory\n\t\t\t */\n\t\t\t// Use empty MessageSource to be able to accept getMessage calls.\n\t\t\tDelegatingMessageSource dms = new DelegatingMessageSource();\n\t\t\tdms.setParentMessageSource(getInternalParentMessageSource());\n\t\t\t//æ³¨æ„è¿™ Contextå±æ€§\n\t\t\tthis.messageSource = dms;\n\t\t\tbeanFactory.registerSingleton(MESSAGE_SOURCE_BEAN_NAME, this.messageSource);\n\t\t\tif (logger.isTraceEnabled()) {\n\t\t\t\tlogger.trace(\"No '\" + MESSAGE_SOURCE_BEAN_NAME + \"' bean, using [\" + this.messageSource + \"]\");\n\t\t\t}\n\t\t}\n\t}\n</code></pre>\n<h3 id=\"æ€»ç»“-6\">æ€»ç»“</h3>\n<p>å¾ˆç®€å•:</p>\n<ol>\n<li>å¦‚æœbeanFactoryä¸­æœ‰åç§°ä¸º messageSource çš„Beanå®šä¹‰ï¼Œå°±ä½¿ç”¨è¿™beanä½œç‰©å›½é™…åŒ–æ¶ˆæ¯æº<br />\nå¦‚æœæ²¡æœ‰åˆ™é»˜è®¤ä½¿ç”¨ org.springframework.context.support.DelegatingMessageSource å¹¶æ³¨å†Œåˆ° beanFactory</li>\n</ol>\n<p><s>ç”¨äºå›½é™…åŒ–çš„, ä¸é‡è¦, æœ¬å±Œä½œä¸ºç¤¾ä¼šåº•å±‚ç‰›é©¬, æš‚æœªåšè¿‡è·¨å›½é¡¹ç›®</s></p>\n<h2 id=\"å…«-åˆå§‹åŒ–äº‹ä»¶å¤šæ’­å™¨\">å…«. åˆå§‹åŒ–äº‹ä»¶å¤šæ’­å™¨</h2>\n<p><code>org.springframework.context.support.AbstractApplicationContext#initApplicationEventMulticaster</code></p>\n<pre><code class=\"language-java\">\t/**\n\t * Initialize the ApplicationEventMulticaster.\n\t * Uses SimpleApplicationEventMulticaster if none defined in the context.\n\t * @see org.springframework.context.event.SimpleApplicationEventMulticaster\n\t */\n\tprotected void initApplicationEventMulticaster() {\n\t\tConfigurableListableBeanFactory beanFactory = getBeanFactory();\n\t\t/**\n\t\t * 1. å¦‚æœ beanFactory ä¸­åŒ…å«åç§°ä¸º APPLICATION_EVENT_MULTICASTER_BEAN_NAMEçš„beanå®šä¹‰, åˆ™ä½¿ç”¨è¿™ä¸ª ApplicationEventMulticaster ä½œä¸º äº‹ä»¶å¤šæ’­å™¨\n\t\t * å¦‚æœä¸åŒ…å«åˆ™åˆ›å»º SimpleApplicationEventMulticasterä½œä¸ºäº‹ä»¶å¤šæ’­å™¨;\n\t\t */\n\t\tif (beanFactory.containsLocalBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME)) {\n\t\t\tthis.applicationEventMulticaster =\n\t\t\t\t\tbeanFactory.getBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, ApplicationEventMulticaster.class);\n\t\t\tif (logger.isTraceEnabled()) {\n\t\t\t\tlogger.trace(\"Using ApplicationEventMulticaster [\" + this.applicationEventMulticaster + \"]\");\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t/**\n\t\t\t * 2. åˆ›å»º SimpleApplicationEventMulticaster ä½œä¸ºé»˜è®¤çš„äº‹ä»¶å¤šæ’­å™¨ (Event Channel)\n\t\t\t *  å…¶å®å°±æ˜¯åˆå§‹åŒ–äº†ä¸€ä¸ª ç”¨äºå­˜æ”¾/ç®¡ç† ApplicationListener ç›‘å¬å™¨(è§‚å¯Ÿè€…)çš„ç±»\n\t\t\t *   åœ¨Spring äº‹ä»¶æœºåˆ¶ä¸­, åœ¨å®¹å™¨å‘å¸ƒäº‹ä»¶æ—¶ `this.applicationEventMulticaster.multicastEvent(new ObjectEvent());`\n\t\t\t *  @see org.springframework.context.event.AbstractApplicationEventMulticaster#defaultRetriever ç”¨æˆ·å­˜æ”¾/ç®¡ç† å„ä¸ªç›‘å¬å™¨çš„(è§‚å¯Ÿè€…)\n\t\t\t *  @see AbstractApplicationContext#publishEvent(Object, ResolvableType) è°ƒç”¨å®¹å™¨å‘å¸ƒäº‹ä»¶\n\t\t\t *\n\t\t\t *  è¿™ä¸ª applicationEventMulticaster é™¤äº†åœ¨å®¹å™¨å‘å¸ƒäº‹ä»¶æ—¶ç”¨å®ƒ, åœ¨æ³¨å†Œç›‘å¬å™¨æ—¶ç›´æ¥ç”¨å®ƒ {@link AbstractApplicationContext#registerListeners()}\n\t\t\t */\n\t\t\tthis.applicationEventMulticaster = new SimpleApplicationEventMulticaster(beanFactory);\n\t\t\t/**\n\t\t\t * å°†å…¶æ³¨å†Œåˆ° beanFactory;\n\t\t\t * æ³¨æ„ è¿™æ˜¯å®ä¾‹, å®ƒç›´æ¥æ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­.\n\t\t\t */\n\t\t\tbeanFactory.registerSingleton(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, this.applicationEventMulticaster);\n\t\t\tif (logger.isTraceEnabled()) {\n\t\t\t\tlogger.trace(\"No '\" + APPLICATION_EVENT_MULTICASTER_BEAN_NAME + \"' bean, using \" +\n\t\t\t\t\t\t\"[\" + this.applicationEventMulticaster.getClass().getSimpleName() + \"]\");\n\t\t\t}\n\t\t}\n\t}\n</code></pre>\n<h3 id=\"æ€»ç»“-7\">æ€»ç»“</h3>\n<ol>\n<li>å¦‚æœ beanFactory ä¸­åŒ…å«åç§°ä¸º applicationEventMulticaster çš„beanå®šä¹‰, åˆ™ä½¿ç”¨è¿™ä¸ªBeanä½œä¸ºäº‹ä»¶å¤šæ’­å™¨;<br />\nå¦‚æœä¸åŒ…å«åˆ™åˆ›å»º SimpleApplicationEventMulticasterä½œä¸ºäº‹ä»¶å¤šæ’­å™¨;</li>\n<li>åˆ›å»ºSimpleApplicationEventMulticasterå…¶å®å°±æ˜¯åˆå§‹åŒ–äº†ä¸€ä¸ª,ç”¨äºå­˜æ”¾/ç®¡ç† ApplicationListener ç›‘å¬å™¨(è§‚å¯Ÿè€…)çš„ç±», å¹¶æ³¨å†Œåˆ° beanFactory</li>\n</ol>\n<ul>\n<li>ä¸»è¦æ˜¯ {@link org.springframework.context.event.AbstractApplicationEventMulticaster#defaultRetriever} ç”¨äºå­˜æ”¾/ç®¡ç† å„ä¸ªç›‘å¬å™¨çš„(è§‚å¯Ÿè€…)</li>\n<li>{@link org.springframework.context.event.SimpleApplicationEventMulticaster#multicastEvent(org.springframework.context.ApplicationEvent, org.springframework.core.ResolvableType) }è°ƒç”¨å®¹å™¨å‘å¸ƒäº‹ä»¶</li>\n</ul>\n<p>å‚è€ƒæ­¤å‰çš„åšå®¢ - <a href=\"https://www.cnblogs.com/dddy/p/19191523\" target=\"_blank\" title=\"å‘å¸ƒäº 2025-11-04 22:25\">Spring ä¸­çš„Eventæœºåˆ¶</a></p>\n<h2 id=\"ä¹-ç»™å­ç±»contextç•™ä¸‹ä¸€ä¸ªæ‰©å±•ç‚¹\">ä¹. ç»™å­ç±»(Context)ç•™ä¸‹ä¸€ä¸ªæ‰©å±•ç‚¹</h2>\n<p>æ²¡ä»€ä¹ˆå¥½è¯´çš„, è¿™é‡Œæ˜¯ç©ºå®ç°</p>\n<p><code>org.springframework.context.support.AbstractApplicationContext#onRefresh</code></p>\n<pre><code class=\"language-java\">/**\n * Template method which can be overridden to add context-specific refresh work.\n * Called on initialization of special beans, before instantiation of singletons.\n * &lt;p&gt;This implementation is empty.\n * @throws BeansException in case of errors\n * @see #refresh()\n */\nprotected void onRefresh() throws BeansException {\n\t// For subclasses: do nothing by default.\n}\n</code></pre>\n<h2 id=\"å-å‘å¤šæ’­å™¨æ³¨å†Œç›‘å¬å™¨\">å. å‘å¤šæ’­å™¨æ³¨å†Œç›‘å¬å™¨</h2>\n<p><code>org.springframework.context.support.AbstractApplicationContext#registerListeners</code></p>\n<pre><code class=\"language-java\">/**\n\t * Add beans that implement ApplicationListener as listeners.\n\t * Doesn't affect other listeners, which can be added without being beans.\n\t */\n\tprotected void registerListeners() {\n\t\t/**\n\t\t * 1. å‘å¤šæ’­å™¨ä¸­æ³¨å†Œ åœ¨contextä¸­çš„ç›‘å¬å™¨(è§‚å¯Ÿè€…)\n\t\t */\n\t\t// Register statically specified listeners first.\n\t\tfor (ApplicationListener&lt;?&gt; listener : getApplicationListeners()) {\n\t\t\tgetApplicationEventMulticaster().addApplicationListener(listener);\n\t\t}\n\n\t\t// Do not initialize FactoryBeans here: We need to leave all regular beans\n\t\t// uninitialized to let post-processors apply to them!\n\t\t/**\n\t\t *  2. å‘å¤šæ’­å™¨ä¸­æ³¨å†Œ åœ¨beanFactoryä¸­çš„beanæ˜¯ç›‘å¬å™¨(ApplicationListener.class)çš„(è§‚å¯Ÿè€…)\n\t\t *  æ³¨æ„:\n\t\t *  2.1 è¿™é‡Œæ˜¯ä¼šå…ˆä» BeanFactory (getBeanNamesForType)è·å–æ˜¯ ApplicationListener.class çš„ bean name\n\t\t *  2.2 æ³¨æ„åªæ˜¯æŸ¥æ‰¾åŒ¹é…ç±»å‹çš„ bean åç§°, æ²¡æœ‰å®ä¾‹åŒ– å­˜çš„ä¹Ÿæ˜¯ bean name;\n\t\t */\n\t\tString[] listenerBeanNames = getBeanNamesForType(ApplicationListener.class, true, false);\n\t\tfor (String listenerBeanName : listenerBeanNames) {\n\t\t\tgetApplicationEventMulticaster().addApplicationListenerBean(listenerBeanName);\n\t\t}\n\n\t\t/**\n\t\t * 3. å¹¿æ’­ this.earlyApplicationEvents å±æ€§ä¸­çš„äº‹ä»¶;\n\t\t * ä¸ºä»€ä¹ˆ?\n\t\t * å› ä¸ºæœ‰å¯èƒ½ åœ¨å®¹å™¨ç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨äº†å½“å‰ `AbstractApplicationContext#publishEvent` å‘å¸ƒäº‹ä»¶, ä½†æ˜¯å¤šæ’­å™¨æ²¡æœ‰åˆå§‹åŒ–å®Œæˆ, æ‰€ä»¥ä¼šå°†äº‹ä»¶å­˜åœ¨this.earlyApplicationEvents ä¸­;\n\t\t * å¾…å®¹å™¨åˆå§‹åŒ–å®Œæˆå, \tåœ¨æµç¨‹  {@link org.springframework.context.support.AbstractApplicationContext#registerListeners()} ä¸­ä¼šå‘å¸ƒå­˜åœ¨è¿™é‡Œé¢çš„äº‹ä»¶\n\t\t * (ä¾‹å¦‚: åœ¨ BeanFactoryPostProcessor çš„ä¸šåŠ¡é€»è¾‘è§¦å‘å®¹å™¨çš„å¹¿æ’­äº‹ä»¶, è¿™æ—¶å€™å¤šæ’­å™¨éƒ½ä¸å­˜åœ¨, ä¹Ÿä¸çŸ¥é“æœ‰å“ªäº› beanä½œä¸ºè§‚å¯Ÿè€…)\n\t\t * @see AbstractApplicationContext#prepareRefresh()\n\t\t */\n\t\t// Publish early application events now that we finally have a multicaster...\n\t\tSet&lt;ApplicationEvent&gt; earlyEventsToProcess = this.earlyApplicationEvents;\n\t\tthis.earlyApplicationEvents = null;//ä¸‹ä¸€æ­¥ multicastEvent åå°±æ²¡ç”¨äº†, èµ‹ null é‡Šæ”¾èµ„æº.\n\t\tif (!CollectionUtils.isEmpty(earlyEventsToProcess)) {\n\t\t\tfor (ApplicationEvent earlyEvent : earlyEventsToProcess) {\n\t\t\t\tgetApplicationEventMulticaster().multicastEvent(earlyEvent);\n\t\t\t}\n\t\t}\n\t}\n</code></pre>\n<h3 id=\"æ€»ç»“-8\">æ€»ç»“</h3>\n<ol>\n<li>å‘å¤šæ’­å™¨ä¸­æ³¨å†Œ åœ¨contextä¸­çš„ç›‘å¬å™¨(è§‚å¯Ÿè€…);</li>\n<li>å‘å¤šæ’­å™¨ä¸­æ³¨å†Œ åœ¨beanFactoryä¸­çš„beanæ˜¯ç›‘å¬å™¨(ApplicationListener.class)çš„(è§‚å¯Ÿè€…)</li>\n<li>å¹¿æ’­ this.earlyApplicationEvents å±æ€§ä¸­çš„äº‹ä»¶;<br />\nä¸ºä»€ä¹ˆ?\n<ul>\n<li>å› ä¸ºæœ‰å¯èƒ½ åœ¨å®¹å™¨ç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨äº†å½“å‰ <code>AbstractApplicationContext#publishEvent</code> å‘å¸ƒäº‹ä»¶, ä½†æ˜¯å¤šæ’­å™¨æ²¡æœ‰åˆå§‹åŒ–å®Œæˆ, æ‰€ä»¥ä¼šå°†äº‹ä»¶å­˜åœ¨this.earlyApplicationEvents ä¸­;  è¿™é‡Œå¤šæ’­å™¨å·²ç»å‡†å¤‡ ä¼šå‘å¸ƒå­˜åœ¨è¿™é‡Œé¢çš„äº‹ä»¶ (ä¾‹å¦‚: åœ¨ BeanFactoryPostProcessor çš„ä¸šåŠ¡é€»è¾‘è§¦å‘å®¹å™¨çš„å¹¿æ’­äº‹ä»¶, è¿™æ—¶å€™å¤šæ’­å™¨éƒ½ä¸å­˜åœ¨)</li>\n</ul>\n<ul>\n<li>@see AbstractApplicationContext#prepareRefresh()</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"åä¸€-å®ä¾‹åŒ–å‰©ä¸‹çš„æ‰€æœ‰å•ä¾‹bean\">åä¸€. å®ä¾‹åŒ–å‰©ä¸‹çš„æ‰€æœ‰å•ä¾‹bean</h2>\n<h3 id=\"å‡†å¤‡ç±»å‹è½¬æ¢å™¨-å˜é‡è§£æå™¨ç­‰\">å‡†å¤‡ç±»å‹è½¬æ¢å™¨ å˜é‡è§£æå™¨ç­‰</h3>\n<p><code>org.springframework.context.support.AbstractApplicationContext#finishBeanFactoryInitialization</code></p>\n<pre><code class=\"language-java\">/**\n\t * Finish the initialization of this context's bean factory,\n\t * initializing all remaining singleton beans.\n\t */\n\tprotected void finishBeanFactoryInitialization(ConfigurableListableBeanFactory beanFactory) {\n\t\t// Initialize conversion service for this context.\n\t\t/**\n\t\t *\n\t\t * 1. ä¸º beanFactory åˆå§‹åŒ–ç±»å‹è½¬æ¢å™¨(ConversionService)\n\t\t *   æ³¨æ„: åœ¨ Spring ä¸­`ConversionService` æ˜¯ç”¨äºç±»å‹è½¬æ¢çš„æœåŠ¡æ¥å£, å®ƒæ˜¯è½¬æ¢ç±»å‹çš„å…¥å£ç‚¹, ä½†æ˜¯çœŸæ­£çš„è½¬æ¢é€»è¾‘åŠŸèƒ½ åˆ™ç”± Converter å’Œ GenericConverter æ¥å£çš„å®ç°å¤„ç†çš„\n\t\t */\n\t\tif (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp;\n\t\t\t\tbeanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) {\n\t\t\tbeanFactory.setConversionService(\n\t\t\t\t\tbeanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class));\n\t\t}\n\n\t\t// Register a default embedded value resolver if no BeanFactoryPostProcessor\n\t\t// (such as a PropertySourcesPlaceholderConfigurer bean) registered any before:\n\t\t// at this point, primarily for resolution in annotation attribute values.\n\t\t/**\n\t\t * 2. å¦‚æœ beanFactory ä¸Šä¸‹æ–‡ä¸­ä¸åŒ…å« \"é»˜è®¤çš„å˜é‡è§£æå™¨ (ç±»ä¼¼ PropertySourcesPlaceholderConfigurer) è§£æç±»ä¼¼ '${}' è¿™æ ·çš„å˜é‡ \"\n\t\t * åˆ™ä½¿ç”¨ç¯å¢ƒå¯¹è±¡(ConfigurableEnvironment)ä¸­çš„ ConfigurablePropertyResolverå®ç°æ¥ä½œä¸º StringValueResolver æ·»åŠ è¿›å»\n\t\t */\n\t\tif (!beanFactory.hasEmbeddedValueResolver()) {\n\t\t\tbeanFactory.addEmbeddedValueResolver(strVal -&gt; getEnvironment().resolvePlaceholders(strVal));\n\t\t}\n\t\t// Initialize LoadTimeWeaverAware beans early to allow for registering their transformers early.\n\t\t/**\n\t\t * 3. å…ˆå®ä¾‹åŒ–åŒ– LoadTimeWeaverAware beanï¼Œä»¥ä¾¿å°½æ—©æ³¨å†Œå®ƒä»¬çš„è½¬æ¢å™¨ã€‚\n\t\t * TODO AOP ç›¸å…³çš„\n\t\t */\n\t\tString[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, false, false);\n\t\tfor (String weaverAwareName : weaverAwareNames) {\n\t\t\tgetBean(weaverAwareName);\n\t\t}\n\n\t\t// Stop using the temporary ClassLoader for type matching.\n\t\t// åœæ­¢ä½¿ç”¨ä¸´æ—¶ClassLoaderè¿›è¡Œç±»å‹åŒ¹é…\n\t\tbeanFactory.setTempClassLoader(null);\n\n\t\t// Allow for caching all bean definition metadata, not expecting further changes.\n\t\t/**\n\t\t * 4. å†»ç»“é…ç½®, è¿™æ—¶å€™å°±ä¸å†å…è®¸æ›´æ”¹ beanDefinition äº†; (å…¶å®å°±æ˜¯ clearMetadataCache å’Œ è®¾ç½®äº†ä¸€ä¸ªæ ‡è¯†ç¬¦)\n\t\t */\n\t\tbeanFactory.freezeConfiguration();\n\n\t\t// Instantiate all remaining (non-lazy-init) singletons.\n\t\t/**\n\t\t * 5. å®ä¾‹åŒ–æ‰€æœ‰å‰©ä½™çš„ (élazy-init) å•ä¾‹ Bean\n\t\t */\n\t\tbeanFactory.preInstantiateSingletons();\n\t}\n</code></pre>\n<h3 id=\"å¤„ç†-factorybean-ç­‰\">å¤„ç† FactoryBean ç­‰</h3>\n<p><code>org.springframework.beans.factory.support.DefaultListableBeanFactory#preInstantiateSingletons</code></p>\n<pre><code class=\"language-java\">@Override\n\tpublic void preInstantiateSingletons() throws BeansException {\n\t\tif (logger.isTraceEnabled()) {\n\t\t\tlogger.trace(\"Pre-instantiating singletons in \" + this);\n\t\t}\n\t\t// Iterate over a copy to allow for init methods which in turn register new bean definitions.\n\t\t// While this may not be part of the regular factory bootstrap, it does otherwise work fine.\n\t\t/**\n\t\t *  æ‰€æœ‰å·²æ³¨å†Œçš„Bean name åˆ—è¡¨;\n\t\t *  è¿™é‡Œå¤åˆ¶ä¸€ä»½, æ–¹ä¾¿éå†;\n\t\t */\n\t\tList&lt;String&gt; beanNames = new ArrayList&lt;&gt;(this.beanDefinitionNames);\n\n\t\t// Trigger initialization of all non-lazy singleton beans...\n\t\tfor (String beanName : beanNames) {\n\t\t\t/**\n\t\t\t * åˆå¹¶åˆ°çˆ¶ç±»çš„ BeanDefinition å¾—åˆ° RootBeanDefinition, æ”¾å…¥ç¼“å­˜ä¸­.\n\t\t\t * (æ¯ä¸€ä¸ªBeanéƒ½æœ‰ RootBeanDefinition, æ²¡æœ‰çš„è¯ getMergedLocalBeanDefinition ä¼šåˆ›å»ºä¸€ä¸ª, å¹¶æ”¾å…¥ç¼“å­˜ä¸­)\n\t\t\t *\n\t\t\t * ä¸ºä»€ä¹ˆéœ€è¦å¾€ä¸Šç¼“å­˜ RootBeanDefinition ?\n\t\t\t * å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™, è‚¯å®šæ˜¯å…ˆå®ä¾‹åŒ–çˆ¶å¯¹è±¡, æœ‰çˆ¶å¯¹è±¡æ‰èƒ½å®ä¾‹å­å¯¹è±¡\n\t\t\t */\n\t\t\tRootBeanDefinition bd = getMergedLocalBeanDefinition(beanName);\n\t\t\t//å¦‚æœè¯¥ bean æ˜¯: éæŠ½è±¡, æ˜¯å•ä¾‹, éæ‡’åŠ è½½\n\t\t\tif (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) {\n\t\t\t\t/**\n\t\t\t\t * å¦‚æœè¯¥beanæ˜¯ FactoryBean, åˆ™åœ¨ bean name å‰é¢åŠ ä¸€ä¸ª '&amp;' å‰ç¼€, å…ˆè·å–/å®ä¾‹åŒ– FactoryBean æœ¬èº«;\n\t\t\t\t *  æ³¨æ„ä¸€ä¸‹ FactoryBean ç”Ÿæˆå¯¹è±¡æ˜¯ä¸éµå¾ª Spring çš„beanç”Ÿå‘½å‘¨æœŸçš„\n\t\t\t\t *\n\t\t\t\t * è¿™æœ‰ä¸¤ä¸ªå¯¹è±¡, å¦‚ä½•è·å–? getBean(beanName) :\n\t\t\t\t * 1. ä¼ å…¥ FactoryBean çš„ name è¿”å›çš„æ˜¯å…¶ getObject çš„ç›®æ ‡å¯¹è±¡å®ä¾‹;\n\t\t\t\t * 2. å¦‚æœæƒ³è·å– FactoryBean æœ¬èº«å®ä¾‹, åˆ™å‰é¢éœ€è¦åŠ ä¸€ä¸ª '&amp;' å‰ç¼€;\n\t\t\t\t *\n\t\t\t\t */\n\t\t\t\tif (isFactoryBean(beanName)) {\n\t\t\t\t\t/**\n\t\t\t\t\t * è·å–/å®ä¾‹åŒ– factoryBean æœ¬èº«\n\t\t\t\t\t */\n\t\t\t\t\tObject bean = getBean(FACTORY_BEAN_PREFIX + beanName);\n\t\t\t\t\tif (bean instanceof SmartFactoryBean&lt;?&gt; smartFactoryBean\n\t\t\t\t\t\t\t&amp;&amp; smartFactoryBean.isEagerInit()) {\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * å¦‚æœæ˜¯ SmartFactoryBean å¹¶ä¸” æ˜¯æ€¥åŠ è½½:\n\t\t\t\t\t\t * åˆ™å†è·å–/å®ä¾‹åŒ–è¯¥ FactoryBean çš„ç›®æ ‡å¯¹è±¡\n\t\t\t\t\t\t */\n\t\t\t\t\t\tgetBean(beanName);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tgetBean(beanName);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Trigger post-initialization callback for all applicable beans...\n\t\tfor (String beanName : beanNames) {\n\t\t\tObject singletonInstance = getSingleton(beanName);\n\t\t\tif (singletonInstance instanceof SmartInitializingSingleton smartSingleton) {\n\t\t\t\tStartupStep smartInitialize = getApplicationStartup().start(\"spring.beans.smart-initialize\")\n\t\t\t\t\t\t.tag(\"beanName\", beanName);\n\t\t\t\tsmartSingleton.afterSingletonsInstantiated();\n\t\t\t\tsmartInitialize.end();\n\t\t\t}\n\t\t}\n\t}\n</code></pre>\n<h3 id=\"å°è¯•ä»-ä¸€-äºŒ-ä¸‰çº§ç¼“å­˜ä¸­è·å–\">å°è¯•ä» ä¸€ äºŒ ä¸‰çº§ç¼“å­˜ä¸­è·å–</h3>\n<p><code>org.springframework.beans.factory.support.AbstractBeanFactory#getBean(java.lang.String)</code><br />\n<code>org.springframework.beans.factory.support.AbstractBeanFactory#doGetBean</code></p>\n<pre><code class=\"language-java\">/**\n\t * Return an instance, which may be shared or independent, of the specified bean.\n\t * @param name the name of the bean to retrieve\n\t * @param requiredType the required type of the bean to retrieve\n\t * @param args arguments to use when creating a bean instance using explicit arguments\n\t * (only applied when creating a new instance as opposed to retrieving an existing one)\n\t * @param typeCheckOnly whether the instance is obtained for a type check,\n\t * not for actual use\n\t * @return an instance of the bean\n\t * @throws BeansException if the bean could not be created\n\t */\n\t@SuppressWarnings(\"unchecked\")\n\tprotected &lt;T&gt; T doGetBean(\n\t\t\tString name, @Nullable Class&lt;T&gt; requiredType, @Nullable Object[] args, boolean typeCheckOnly)\n\t\t\tthrows BeansException {\n\n\t\t/**\n\t\t *\n\t\t * è½¬æ¢ bean name; å¦‚æœåç§°ä¸­å¸¦ BeanFactory.FACTORY_BEAN_PREFIX, åˆ™ä¼šå»æ‰å®ƒ;\n\t\t * {@link BeanFactory#FACTORY_BEAN_PREFIX}\n\t\t */\n\t\tString beanName = transformedBeanName(name);\n\t\tObject beanInstance;\n\t\t// Eagerly check singleton cache for manually registered singletons.\n\t\t/**\n\t\t * å°è¯•ä»å½“å‰å®¹å™¨ ä¸€ äºŒ ä¸‰çº§ç¼“å­˜è·å–\n\t\t */\n\t\tObject sharedInstance = getSingleton(beanName);\n\t\tif (sharedInstance != null &amp;&amp; args == null) {\n\t\t\t/**\n\t\t\t * å¦‚æœç¼“å­˜ä¸­æœ‰\n\t\t\t */\n\t\t\tif (logger.isTraceEnabled()) {\n\t\t\t\tif (isSingletonCurrentlyInCreation(beanName)) {\n\t\t\t\t\tlogger.trace(\"Returning eagerly cached instance of singleton bean '\" + beanName +\n\t\t\t\t\t\t\t\"' that is not fully initialized yet - a consequence of a circular reference\");\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tlogger.trace(\"Returning cached instance of singleton bean '\" + beanName + \"'\");\n\t\t\t\t}\n\t\t\t}\n\t\t\t/**\n\t\t\t * å¦‚æœæ‹¿åˆ°çš„Beanæ˜¯ FactoryBean å®ç°, åˆ™ä¼šè°ƒç”¨ `T getObject() throws Exception` è·å–å…¶å¯¹è±¡\n\t\t\t * å†å°†ç›®æ ‡å¯¹è±¡æ”¾å…¥org.springframework.beans.factory.support.FactoryBeanRegistrySupport#factoryBeanObjectCacheç¼“å­˜ä¸­\n\t\t\t * æœ€ç»ˆåœ¨ {@link org.springframework.beans.factory.support.FactoryBeanRegistrySupport#doGetObjectFromFactoryBean}\n\t\t\t */\n\t\t\tbeanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, null);\n\t\t}\n\t\telse {\n\t\t\t/**\n\t\t\t * å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰\n\t\t\t */\n\n\t\t\t/**\n\t\t\t *  åˆ¤æ–­è¯¥beanæ˜¯å¦åœ¨åˆ›å»ºä¸­ (å¾ªç¯åˆ›å»º), ç”¨çš„æ˜¯ä¸€ä¸ªThreadLocal\n\t\t\t *  {@link org.springframework.beans.factory.support.AbstractBeanFactory#prototypesCurrentlyInCreation}\n\t\t\t */\n\t\t\t// Fail if we're already creating this bean instance:\n\t\t\t// We're assumably within a circular reference.\n\t\t\tif (isPrototypeCurrentlyInCreation(beanName)) {\n\t\t\t\tthrow new BeanCurrentlyInCreationException(beanName);\n\t\t\t}\n\t\t\t/**\n\t\t\t * ä¼˜å…ˆå°è¯•ä» çˆ¶ BeanFactoryä¸­æ‹¿, ç±»ä¼¼ç±»åŠ è½½å™¨çš„åŒäº²å§”æ‰˜æœºåˆ¶\n\t\t\t * ä¸€èˆ¬ çˆ¶å®¹å™¨éƒ½æ˜¯ç©ºçš„\n\t\t\t */\n\t\t\t// Check if bean definition exists in this factory.\n\t\t\tBeanFactory parentBeanFactory = getParentBeanFactory();\n\t\t\tif (parentBeanFactory != null &amp;&amp; !containsBeanDefinition(beanName)) {\n\t\t\t\t// Not found -&gt; check parent.\n\t\t\t\tString nameToLookup = originalBeanName(name);\n\t\t\t\tif (parentBeanFactory instanceof AbstractBeanFactory abf) {\n\t\t\t\t\treturn abf.doGetBean(nameToLookup, requiredType, args, typeCheckOnly);\n\t\t\t\t}\n\t\t\t\telse if (args != null) {\n\t\t\t\t\t// Delegation to parent with explicit args.\n\t\t\t\t\treturn (T) parentBeanFactory.getBean(nameToLookup, args);\n\t\t\t\t}\n\t\t\t\telse if (requiredType != null) {\n\t\t\t\t\t// No args -&gt; delegate to standard getBean method.\n\t\t\t\t\treturn parentBeanFactory.getBean(nameToLookup, requiredType);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn (T) parentBeanFactory.getBean(nameToLookup);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * æ ‡è®°è¯¥ beanä¸ºåˆ›å»ºä¸­æˆ–è€…å·²åˆ›å»º;\n\t\t\t * å…¶å®å°±æ˜¯ç”¨ Seté›†åˆ {@link org.springframework.beans.factory.support.AbstractBeanFactory#alreadyCreated} å­˜èµ·æ¥\n\t\t\t */\n\t\t\tif (!typeCheckOnly) {\n\t\t\t\tmarkBeanAsCreated(beanName);\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * è®°å½•å™¨ (æ‰“å°æŸäº›å…³é”®è¿‡ç¨‹æ—¥å¿—, æ”¶é›†åˆ†æ, ä¸é‡è¦)\n\t\t\t */\n\t\t\tStartupStep beanCreation = this.applicationStartup.start(\"spring.beans.instantiate\")\n\t\t\t\t\t.tag(\"beanName\", name);\n\t\t\ttry {\n\t\t\t\tif (requiredType != null) {\n\t\t\t\t\tbeanCreation.tag(\"beanType\", requiredType::toString);\n\t\t\t\t}\n\t\t\t\t/**\n\t\t\t\t * æ‹¿åˆ°å…¶ RootBeanDefinition (å®Œæ•´çš„Beanå…ƒæ•°æ®æè¿°)\n\t\t\t\t */\n\t\t\t\tRootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);\n\t\t\t\t//æ£€æŸ¥BeanDefinition, å°±åˆ¤æ–­ä¸€ä¸‹æ˜¯è¯¥bean å¦æŠ½è±¡ç±»\n\t\t\t\tcheckMergedBeanDefinition(mbd, beanName, args);\n\n\t\t\t\t/**\n\t\t\t\t * å¦‚æœå­˜åœ¨ä¾èµ–é…ç½®, åˆ™å…ˆåˆ›å»ºä¾èµ–çš„Bean\n\t\t\t\t * (å³XMLçš„ &lt;bean id=\"...\" depends-on=\"\" ...&gt;&lt;/bean&gt; é…ç½®)\n\t\t\t\t */\n\t\t\t\t// Guarantee initialization of beans that the current bean depends on.\n\t\t\t\tString[] dependsOn = mbd.getDependsOn();\n\t\t\t\tif (dependsOn != null) {\n\t\t\t\t\tfor (String dep : dependsOn) {\n\t\t\t\t\t\tif (isDependent(beanName, dep)) {\n\t\t\t\t\t\t\tthrow new BeanCreationException(mbd.getResourceDescription(), beanName,\n\t\t\t\t\t\t\t\t\t\"Circular depends-on relationship between '\" + beanName + \"' and '\" + dep + \"'\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tregisterDependentBean(dep, beanName);\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tgetBean(dep);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (NoSuchBeanDefinitionException ex) {\n\t\t\t\t\t\t\tthrow new BeanCreationException(mbd.getResourceDescription(), beanName,\n\t\t\t\t\t\t\t\t\t\"'\" + beanName + \"' depends on missing bean '\" + dep + \"'\", ex);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Create bean instance.\n\t\t\t\tif (mbd.isSingleton()) {\n\t\t\t\t\t/**\n\t\t\t\t\t * å¦‚æœæ˜¯å•ä¾‹çš„ Bean\n\t\t\t\t\t * =============================\n\t\t\t\t\t */\n\n\t\t\t\t\t/**\n\t\t\t\t\t * æ³¨æ„ ä¼ é€’ä¸€ä¸ª 'åˆ›å»ºBean' çš„Lambdaå‡½æ•°/å¯¹è±¡ (ObjectFactory)\n\t\t\t\t\t * getSingleton çš„é€»è¾‘æ˜¯:\n\t\t\t\t\t * \t 1. å°è¯•ä»ä¸€çº§ç¼“å­˜ä¸­æ‹¿\n\t\t\t\t\t * \t 2. å°†Bean Name æ·»åŠ åˆ° åˆ›å»ºä¸­çŠ¶æ€çš„é›†åˆ è®°å½•èµ·æ¥;\n\t\t\t\t\t * \t  {@link org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#singletonsCurrentlyInCreation}\n\t\t\t\t\t *   3. è°ƒç”¨ ObjectFactory#getObject() å›è°ƒå›æ¥ createBean\n\t\t\t\t\t *   4. å¦‚æœæ˜¯æ–°åˆ›å»ºçš„æ·»åŠ åˆ°ä¸€çº§ç¼“å†²ä¸­\n\t\t\t\t\t */\n\t\t\t\t\tsharedInstance = getSingleton(beanName, () -&gt; {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t * è§: {@link AbstractAutowireCapableBeanFactory#createBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, java.lang.Object[])}\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\treturn createBean(beanName, mbd, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (BeansException ex) {\n\t\t\t\t\t\t\t// Explicitly remove instance from singleton cache: It might have been put there\n\t\t\t\t\t\t\t// eagerly by the creation process, to allow for circular reference resolution.\n\t\t\t\t\t\t\t// Also remove any beans that received a temporary reference to the bean.\n\t\t\t\t\t\t\tdestroySingleton(beanName);\n\t\t\t\t\t\t\tthrow ex;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tbeanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);\n\t\t\t\t}\n\t\t\t\telse if (mbd.isPrototype()) {\n\t\t\t\t\t/**\n\t\t\t\t\t * å¦‚æœæ˜¯åŸå‹çš„ Bean\n\t\t\t\t\t * =============================\n\t\t\t\t\t */\n\t\t\t\t\t// It's a prototype -&gt; create a new instance.\n\t\t\t\t\tObject prototypeInstance = null;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tbeforePrototypeCreation(beanName);\n\t\t\t\t\t\tprototypeInstance = createBean(beanName, mbd, args);\n\t\t\t\t\t}\n\t\t\t\t\tfinally {\n\t\t\t\t\t\tafterPrototypeCreation(beanName);\n\t\t\t\t\t}\n\t\t\t\t\tbeanInstance = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);\n\t\t\t\t}\n\n\t\t\t\telse {\n\t\t\t\t\tString scopeName = mbd.getScope();\n\t\t\t\t\tif (!StringUtils.hasLength(scopeName)) {\n\t\t\t\t\t\tthrow new IllegalStateException(\"No scope name defined for bean '\" + beanName + \"'\");\n\t\t\t\t\t}\n\t\t\t\t\tScope scope = this.scopes.get(scopeName);\n\t\t\t\t\tif (scope == null) {\n\t\t\t\t\t\tthrow new IllegalStateException(\"No Scope registered for scope name '\" + scopeName + \"'\");\n\t\t\t\t\t}\n\t\t\t\t\ttry {\n\t\t\t\t\t\tObject scopedInstance = scope.get(beanName, () -&gt; {\n\t\t\t\t\t\t\tbeforePrototypeCreation(beanName);\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\treturn createBean(beanName, mbd, args);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfinally {\n\t\t\t\t\t\t\t\tafterPrototypeCreation(beanName);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbeanInstance = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (IllegalStateException ex) {\n\t\t\t\t\t\tthrow new ScopeNotActiveException(beanName, scopeName, ex);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (BeansException ex) {\n\t\t\t\tbeanCreation.tag(\"exception\", ex.getClass().toString());\n\t\t\t\tbeanCreation.tag(\"message\", String.valueOf(ex.getMessage()));\n\t\t\t\tcleanupAfterBeanCreationFailure(beanName);\n\t\t\t\tthrow ex;\n\t\t\t}\n\t\t\tfinally {\n\t\t\t\tbeanCreation.end();\n\t\t\t\tif (!isCacheBeanMetadata()) {\n\t\t\t\t\tclearMergedBeanDefinition(beanName);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * é€‚é…è½¬æ¢ä¸º éœ€æ±‚çš„ç›®æ ‡ç±»å‹ requiredType\n\t\t * å¤šæ€: å­ç±»æ˜¯å¯ä»¥å‘ä¸Šè½¬å‹çš„\n\t\t */\n\t\treturn adaptBeanInstance(name, beanInstance, requiredType);\n\t}\n</code></pre>\n<h3 id=\"å¤„ç†instantiationawarebeanpostprocessor-aopä»£ç†\">å¤„ç†InstantiationAwareBeanPostProcessor AOPä»£ç†</h3>\n<p><code>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#createBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, java.lang.Object[])</code></p>\n<pre><code class=\"language-java\">/**\n\t * Central method of this class: creates a bean instance,\n\t * populates the bean instance, applies post-processors, etc.\n\t * @see #doCreateBean\n\t */\n\t@Override\n\tprotected Object createBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)\n\t\t\tthrows BeanCreationException {\n\n\t\tif (logger.isTraceEnabled()) {\n\t\t\tlogger.trace(\"Creating instance of bean '\" + beanName + \"'\");\n\t\t}\n\t\tRootBeanDefinition mbdToUse = mbd;\n\n\t\t// Make sure bean class is actually resolved at this point, and\n\t\t// clone the bean definition in case of a dynamically resolved Class\n\t\t// which cannot be stored in the shared merged bean definition.\n\t\t/**\n\t\t * 1. è§£æåˆ° BeanDefinition çš„ Class\n\t\t */\n\t\tClass&lt;?&gt; resolvedClass = resolveBeanClass(mbd, beanName);\n\t\t/**\n\t\t * 2. åˆ›å»ºBeanDefinition å¤åˆ¶ä¸€ä»½ RootBeanDefinition\n\t\t */\n\t\tif (resolvedClass != null &amp;&amp; !mbd.hasBeanClass() &amp;&amp; mbd.getBeanClassName() != null) {\n\t\t\tmbdToUse = new RootBeanDefinition(mbd);\n\t\t\tmbdToUse.setBeanClass(resolvedClass);\n\t\t}\n\n\t\t// Prepare method overrides.\n\t\ttry {\n\t\t\t/**\n\t\t\t * 3. å‡†å¤‡å’ŒéªŒè¯ lookup-method å’Œ replace-method;\n\t\t\t * æ³¨æ„: è¿™é‡Œåªæ˜¯æ ‡è®°, çœŸæ­£å¤„ç†æ˜¯åœ¨å®ä¾‹åŒ–æ—¶, é€‰æ‹©ç­–ç•¥ç”Ÿæˆä¸€ä¸ªCgLibçš„ä»£ç†å¯¹è±¡ {@link org.springframework.beans.factory.support.CglibSubclassingInstantiationStrategy}\n\t\t\t * å…³äºå®ƒä»¬çš„ä½œç”¨è§ç¬”è®° [[Spring lookup-method å’Œ replace-method.md]]\n\t\t\t */\n\t\t\tmbdToUse.prepareMethodOverrides();\n\t\t}\n\t\tcatch (BeanDefinitionValidationException ex) {\n\t\t\tthrow new BeanDefinitionStoreException(mbdToUse.getResourceDescription(),\n\t\t\t\t\tbeanName, \"Validation of method overrides failed\", ex);\n\t\t}\n\n\t\ttry {\n\t\t\t// Give BeanPostProcessors a chance to return a proxy instead of the target bean instance.\n\t\t\t/**\n\t\t\t * 4. ç»™ BeanPostProcessors ä¸€ä¸ªè¿”å›(ç”¨æˆ·è‡ªå®šä¹‰, å¦‚æœæœ‰AOP, åˆ™ä¼š ç”¨æˆ·ä»£ç† å† Springä»£ç†)ä»£ç†å®ä¾‹çš„æœºä¼š;\n\t\t\t * è°ƒç”¨ InstantiationAwareBeanPostProcessor çš„\n\t\t\t * {@link InstantiationAwareBeanPostProcessor#postProcessBeforeInstantiation(java.lang.Class, java.lang.String)}\n\t\t\t * å’Œ\n\t\t\t * {@link InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation(java.lang.Class, java.lang.String)}\n\t\t\t * å¯ä»¥è‡ªå®šä¹‰åˆ›å»º beanåŠ¨æ€ä»£ç†å®ä¾‹è¿”å› (AOPç›¸å…³)\n\t\t\t *  \n\t\t\t * è§ç¬”è®°:\n\t\t\t * [[BeanPostProcessoræ¥å£.md]]\n\t\t\t * [[Spring ä¸­çš„AOP]]\n\t\t\t *\n\t\t\t * æ³¨æ„, è¿™é‡Œçš„é€»è¾‘:\n\t\t\t * å¦‚æœå…¶ InstantiationAwareBeanPostProcessor è¿”å›ä¸ä¸ºnull, åˆ™ç›´æ¥ä½¿ç”¨è¿™ä¸ªbeanå®ä¾‹è¿”å›äº†, ä¸èµ° doCreateBeanç­‰ä¸‹é¢çš„æµç¨‹\n\t\t\t * (æ³¨æ„çš„æ³¨æ„! å¦‚æœæœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„æ‹¦æˆªåˆ›å»º, ç”šè‡³ä¼˜å…ˆSpringçš„AOPä»£ç†åˆ›å»º)\n\t\t\t */\n\t\t\tObject bean = resolveBeforeInstantiation(beanName, mbdToUse);\n\t\t\tif (bean != null) {\n\t\t\t\treturn bean;\n\t\t\t}\n\t\t}\n\t\tcatch (Throwable ex) {\n\t\t\tthrow new BeanCreationException(mbdToUse.getResourceDescription(), beanName,\n\t\t\t\t\t\"BeanPostProcessor before instantiation of bean failed\", ex);\n\t\t}\n\n\t\ttry {\n\t\t\t/**\n\t\t\t * ç»§ç»­\n\t\t\t */\n\t\t\tObject beanInstance = doCreateBean(beanName, mbdToUse, args);\n\t\t\tif (logger.isTraceEnabled()) {\n\t\t\t\tlogger.trace(\"Finished creating instance of bean '\" + beanName + \"'\");\n\t\t\t}\n\t\t\treturn beanInstance;\n\t\t}\n\t\tcatch (BeanCreationException | ImplicitlyAppearedSingletonException ex) {\n\t\t\t// A previously detected exception with proper bean creation context already,\n\t\t\t// or illegal singleton state to be communicated up to DefaultSingletonBeanRegistry.\n\t\t\tthrow ex;\n\t\t}\n\t\tcatch (Throwable ex) {\n\t\t\tthrow new BeanCreationException(\n\t\t\t\t\tmbdToUse.getResourceDescription(), beanName, \"Unexpected exception during bean creation\", ex);\n\t\t}\n\t}\n</code></pre>\n<h3 id=\"çœŸæ­£åœ¨jvmå±‚é¢å®ä¾‹åŒ–å¯¹è±¡\">çœŸæ­£åœ¨jvmå±‚é¢å®ä¾‹åŒ–å¯¹è±¡</h3>\n<p><code>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#doCreateBean</code></p>\n<pre><code class=\"language-java\">/**\n\t * Actually create the specified bean. Pre-creation processing has already happened\n\t * at this point, e.g. checking {@code postProcessBeforeInstantiation} callbacks.\n\t * &lt;p&gt;Differentiates between default bean instantiation, use of a\n\t * factory method, and autowiring a constructor.\n\t *\n\t * çœŸæ­£çš„ åœ¨JVMå±‚ åˆ›å»ºBeanå®ä¾‹\n\t *\n\t * @param beanName the name of the bean\n\t * @param mbd the merged bean definition for the bean\n\t * @param args explicit arguments to use for constructor or factory method invocation\n\t * @return a new instance of the bean\n\t * @throws BeanCreationException if the bean could not be created\n\t * @see #instantiateBean\n\t * @see #instantiateUsingFactoryMethod\n\t * @see #autowireConstructor\n\t *\n\t */\n\tprotected Object doCreateBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)\n\t\t\tthrows BeanCreationException {\n\n\t\t// Instantiate the bean.\n\t\tBeanWrapper instanceWrapper = null;\n\t\tif (mbd.isSingleton()) {\n\t\t\tinstanceWrapper = this.factoryBeanInstanceCache.remove(beanName);\n\t\t}\n\t\tif (instanceWrapper == null) {\n\t\t\t/**\n\t\t\t *  1. çœŸæ­£åœ¨jvmå±‚é¢å®ä¾‹åŒ–å¯¹è±¡;\n\t\t\t *    1.1 å¦‚æœè¯¥ BeanDefinition æœ‰é…ç½® instanceSupplierå±æ€§(java.util.function.Supplier),\n\t\t\t * \t\t å°†ä½¿ç”¨å…¶Supplier#getæ–¹æ³•çš„è¿”å›, ä½œä¸ºå®ä¾‹å¯¹è±¡\n\t\t\t *    1.2 å¦‚æœè¯¥ BeanDefinition æœ‰é…ç½® factory-method å°†ä½¿ç”¨è¯¥æ–¹æ³•è¿”å›çš„, ä½œä¸ºå®ä¾‹å¯¹è±¡\n\t\t\t * \t\t è¿™é‡Œè¿™é‡ŒåŒ…æ‹¬'é™æ€å·¥å‚'å’Œ'å®ä¾‹å·¥å‚'çš„å¤„ç†(é€šè¿‡bdçš„factoryBeanName è¿›è¡Œåˆ¤æ–­, å¦‚æœå­˜åœ¨åˆ™æ˜¯'å®ä¾‹å·¥å‚')\n\t\t\t * \t  1.3 ä½¿ç”¨åå°„å®ä¾‹åŒ–, æ ¹æ®ç­–ç•¥å®ä¾‹åŒ–Beanå¯¹è±¡ {@link org.springframework.beans.factory.support.SimpleInstantiationStrategy}\n\t\t\t * \t   - ä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°æ³¨å…¥,åˆ›å»º (new)\n\t\t\t * \t   - ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°åˆ›å»º (new)\n\t\t\t * \t   - å·¥å‚æ–¹æ³•å®ä¾‹åŒ– ('é™æ€å·¥å‚' 'å®ä¾‹å·¥å‚' )\n\t\t\t * \t     `&lt;bean  factory-bean=\"bookFactoryBean\"  factory-method=\"getBook()\"/&gt;`\n\t\t\t * \t        é™æ€å·¥å‚: factory-bean è‹¥æ˜¯ å…¨é™å®šç±»å åˆ™ä½¿ç”¨ BookFactoryBean::getBook çš„é™æ€æ–¹æ³•è¿”å›çš„å¯¹è±¡\n\t\t\t * \t        å®ä¾‹å·¥å‚:  factory-bean è‹¥æ˜¯ bean å åˆ™ä½¿ç”¨è¯¥å®ä¾‹æ–¹æ³•è¿”å›çš„å¯¹è±¡\n\t\t\t *\n\t\t\t * \t{@link AbstractAutowireCapableBeanFactory#createBeanInstance(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, java.lang.Object[])}\n\t\t\t *  2. ç”¨BeanWrapper åŒ…è£…åŸå§‹bean (è£…é¥°æ¨¡å¼)\n\t\t\t *  åˆå§‹åŒ– BeanWrapper\n\t\t\t * \t 2.1 ç»™ BeanWrapper è®¾ç½®äº†, ConversionService\n\t\t\t *   2.2 ç»™ BeanWrapper æ³¨å†Œäº†, å½“å‰ bean factory (propertyEditorRegistrars)ä¸­çš„å…¨éƒ¨ PropertyEditor\n\t\t\t * {@link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#instantiateBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition)}\n\t\t\t *\n\t\t\t */\n\t\t\tinstanceWrapper = createBeanInstance(beanName, mbd, args);\n\t\t}\n\t\t/**\n\t\t * è·å– BeanWrapperä¸­çš„åŸå§‹ Bean å®ä¾‹\n\t\t */\n\t\tObject bean = instanceWrapper.getWrappedInstance();\n\t\t/**\n\t\t * è·å– Bean Classç±»å‹\n\t\t */\n\t\tClass&lt;?&gt; beanType = instanceWrapper.getWrappedClass();\n\t\tif (beanType != NullBean.class) {\n\t\t\tmbd.resolvedTargetType = beanType;\n\t\t}\n\n\t\t// Allow post-processors to modify the merged bean definition.\n\t\tsynchronized (mbd.postProcessingLock) {\n\t\t\tif (!mbd.postProcessed) {\n\t\t\t\ttry {\n\t\t\t\t\t/**\n\t\t\t\t\t * 3. å¤„ç† MergedBeanDefinitionPostProcessor çš„æ¥å£å›è°ƒ\n\t\t\t\t\t * è°ƒç”¨ æ·»åŠ åœ¨ context ä¸­ BeanPostProcessor çš„ MergedBeanDefinitionPostProcessor çš„æ¥å£å›è°ƒ\n\t\t\t\t\t * è§£æåˆ°è¯¸å¦‚`@Autowired`ä¹‹ç±»çš„æ³¨è§£ (Metadata)å…ƒä¿¡æ¯,åˆå¹¶åˆ°BeanDefinitionä¸­\n\t\t\t\t\t *\n\t\t\t\t\t * æ³¨æ„åœ¨å½“å‰æ­¥éª¤ä¸­,åªæ˜¯è§£æ,å¹¶æ³¨å†Œ(ä¿®æ”¹)åˆ° BeanDefinition ä¸­, å¹¶æ²¡æœ‰è°ƒç”¨;\n\t\t\t\t\t *\n\t\t\t\t\t * ä¾‹å¦‚:\n\t\t\t\t\t *  1. å¤„ç† `@Autowired` `@Value`, `@Inject`\n\t\t\t\t\t * å¯¹åº”å¤„ç†ç±»æ˜¯ `org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor`\n\t\t\t\t\t * è¿™ä¸ª çœŸæ­£å¤„ç†æ˜¯åœ¨å¡«å……å±æ€§æ—¶, [[å›è°ƒæ‰€æœ‰ InstantiationAwareBeanPostProcessor#postProcessProperties æ–¹æ³•]] {@link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#populateBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, org.springframework.beans.BeanWrapper)}\n\t\t\t\t\t * è´Ÿè´£æŸ¥æ‰¾ç›¸åº”çš„æ³¨è§£æ–¹æ³•ä¿¡æ¯, å°è£…ä¸º Metadata å…ƒæ•°æ®(ä½¿ç”¨é›†åˆå­˜èµ·æ¥), å†å°†è¿™äº› Metadata å…ƒæ•°æ®, æ³¨å†Œ(ä¿®æ”¹)åˆ° BeanDefinition ä¸­\n\t\t\t\t\t *\n\t\t\t\t\t *  2. å¤„ç† `@Resource`\n\t\t\t\t\t * å¯¹åº”å¤„ç†ç±» `org.springframework.context.annotation.CommonAnnotationBeanPostProcessor`\n\t\t\t\t\t *\n\t\t\t\t\t *  3. å¤„ç† `init-method`, `@PostConstruct`, `@PreDestroy`\n\t\t\t\t\t * å¯¹åº”å¤„ç†ç±» `org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor`\n\t\t\t\t\t *\n\t\t\t\t\t */\n\t\t\t\t\tapplyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);\n\t\t\t\t}\n\t\t\t\tcatch (Throwable ex) {\n\t\t\t\t\tthrow new BeanCreationException(mbd.getResourceDescription(), beanName,\n\t\t\t\t\t\t\t\"Post-processing of merged bean definition failed\", ex);\n\t\t\t\t}\n\t\t\t\tmbd.markAsPostProcessed();\n\t\t\t}\n\t\t}\n\n\t\t// Eagerly cache singletons to be able to resolve circular references\n\t\t// even when triggered by lifecycle interfaces like BeanFactoryAware.\n\t\t/**\n\t\t * åˆ¤æ–­å½“å‰:  æ˜¯å¦å•ä¾‹ &amp;&amp; æ˜¯å¦å…è®¸å¾ªç¯ä¾èµ– &amp;&amp; æ˜¯å¦æ­£åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­\n\t\t *(å¾ªç¯ä¾èµ–AOP)\n\t\t */\n\t\tboolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp;\n\t\t\t\tisSingletonCurrentlyInCreation(beanName));\n\t\tif (earlySingletonExposure) {\n\t\t\tif (logger.isTraceEnabled()) {\n\t\t\t\tlogger.trace(\"Eagerly caching bean '\" + beanName +\n\t\t\t\t\t\t\"' to allow for resolving potential circular references\");\n\t\t\t}\n\t\t\t/**\n\t\t\t * æ”¾åˆ°ä¸‰çº§ç¼“å­˜(ä¸‰çº§ç¼“å­˜ å­˜æ”¾Lambda)\n\t\t\t * &lt;!&gt; å¾ªç¯ä¾èµ– AOP :è¿™é‡Œå…¶å®å°±æ˜¯ä¼šè°ƒç”¨åˆ° AutoProxyCreator åœ¨å…¶è¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦, æœ€ç»ˆä¼šè°ƒç”¨åˆ° createProxy è¿›è¡ŒåŠ¨æ€ä»£ç†å¯¹è±¡åˆ›å»º\n\t\t\t * {@link org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator#getEarlyBeanReference(java.lang.Object, java.lang.String)}\n\t\t\t *\n\t\t\t */\n\t\t\taddSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));\n\t\t}\n\n\t\t// Initialize the bean instance.\n\t\tObject exposedObject = bean;\n\t\ttry {\n\t\t\t/**\n\t\t\t * 2.å¡«å……Beanå±æ€§\n\t\t\t * å¦‚æœæ˜¯AOP, pointcut, adviceç›¸å…³çš„, synthetic ä¼šé…ç½®ä¸º true\n\t\t\t *   1. è°ƒç”¨ BeanPostProcessor çš„å­æ¥å£ InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation\n\t\t\t * \t (ä½œç”¨æ˜¯ åœ¨å®ä¾‹åŒ–ä¹‹åï¼Œå±æ€§å¡«å……ä¹‹å‰æ‰§è¡Œæ“ä½œ, å¯ä»¥æ‹¦æˆªå±æ€§å¡«å……æ“ä½œ)\n\t\t\t */\n\t\t\tpopulateBean(beanName, mbd, instanceWrapper);\n\t\t\t/**\n\t\t\t * 3.åˆå§‹åŒ–Beanå¯¹è±¡\n\t\t\t *   1.å…ˆè°ƒç”¨è¿™ä¸‰ä¸ª BeanNameAware, BeanClassLoaderAware, BeanFactoryAware\n\t\t\t * \t  è¿™ä¸‰ä¸ªæ˜¯åœ¨åˆ›å»ºBeanFactory æ—¶å¿½ç•¥çš„ä¸‰ä¸ª Aware æ¥å£\n\t\t\t *   2. è°ƒç”¨æ‰€æœ‰ BeanPostProcessors#postProcessBeforeInitialization (ä½œç”¨: åœ¨Beanåˆå§‹åŒ–ä¹‹å‰è°ƒç”¨)\n\t\t\t *   3. è°ƒç”¨ init-method æ–¹æ³•\n\t\t\t *   4. è°ƒç”¨æ‰€æœ‰ BeanPostProcessors#postProcessAfterInitialization (ä½œç”¨: åœ¨Beanåˆå§‹åŒ–ä¹‹åè°ƒç”¨)\n\t\t\t */\n\t\t\texposedObject = initializeBean(beanName, exposedObject, mbd);\n\t\t}\n\t\tcatch (Throwable ex) {\n\t\t\tif (ex instanceof BeanCreationException bce &amp;&amp; beanName.equals(bce.getBeanName())) {\n\t\t\t\tthrow bce;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthrow new BeanCreationException(mbd.getResourceDescription(), beanName, ex.getMessage(), ex);\n\t\t\t}\n\t\t}\n\n\t\tif (earlySingletonExposure) {\n\t\t\t/**\n\t\t\t * å¾ªç¯ä¾èµ–AOP ç›¸å…³ (å¾ªç¯ä¾èµ–AOP)\n\t\t\t * =======================\n\t\t\t */\n\n\t\t\t/**\n\t\t\t * å†ä»ç¼“å­˜ä¸­æ‹¿ä¸€æ¬¡è·å–å¹¶æ›¿æ¢,æ˜¯å› ä¸ºæœ‰å¯èƒ½æ˜¯è¢«ä»£ç†(earlySingletonReference)\n\t\t\t */\n\t\t\tObject earlySingletonReference = getSingleton(beanName, false);\n\t\t\tif (earlySingletonReference != null) {\n\t\t\t\t/**\n\t\t\t\t *  (å¾ªç¯ä¾èµ–AOP)\n\t\t\t\t *  æ³¨æ„: è¿™ä¸ªbeanæ˜¯åŸå§‹å®ä¾‹, å†ä»ç¼“å­˜ä¸­æ‹¿ä¸€æ¬¡,æ˜¯å› ä¸ºæœ‰å¯èƒ½æ˜¯è¢«ä»£ç†(earlySingletonReference)\n\t\t\t\t */\n\t\t\t\tif (exposedObject == bean) {\n\t\t\t\t\t// ä¸ä¸€è‡´å°±æ˜¯è¢«ä»£ç†äº†\n\t\t\t\t\texposedObject = earlySingletonReference;\n\t\t\t\t}\n\t\t\t\telse if (!this.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) {\n\t\t\t\t\tString[] dependentBeans = getDependentBeans(beanName);\n\t\t\t\t\tSet&lt;String&gt; actualDependentBeans = new LinkedHashSet&lt;&gt;(dependentBeans.length);\n\t\t\t\t\tfor (String dependentBean : dependentBeans) {\n\t\t\t\t\t\tif (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) {\n\t\t\t\t\t\t\tactualDependentBeans.add(dependentBean);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!actualDependentBeans.isEmpty()) {\n\t\t\t\t\t\tthrow new BeanCurrentlyInCreationException(beanName,\n\t\t\t\t\t\t\t\t\"Bean with name '\" + beanName + \"' has been injected into other beans [\" +\n\t\t\t\t\t\t\t\t\t\tStringUtils.collectionToCommaDelimitedString(actualDependentBeans) +\n\t\t\t\t\t\t\t\t\t\t\"] in its raw version as part of a circular reference, but has eventually been \" +\n\t\t\t\t\t\t\t\t\t\t\"wrapped. This means that said other beans do not use the final version of the \" +\n\t\t\t\t\t\t\t\t\t\t\"bean. This is often the result of over-eager type matching - consider using \" +\n\t\t\t\t\t\t\t\t\t\t\"'getBeanNamesForType' with the 'allowEagerInit' flag turned off, for example.\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Register bean as disposable.\n\t\ttry {\n\t\t\t/**\n\t\t\t * æ³¨å†Œ beané”€æ¯çš„å·¥ä½œ(å¦‚æœéœ€è¦)\n\t\t\t * 1. org.springframework.beans.factory.config.DestructionAwareBeanPostProcessor#postProcessBeforeDestruction(Object,String) BPPæ¥å£\n\t\t\t * 2. org.springframework.beans.factory.DisposableBean æ¥å£\n\t\t\t * 3. è‡ªå®šä¹‰ destroyæ–¹æ³•\n\t\t\t * åœ¨å®¹å™¨å…³é—­æ—¶ä¼šè°ƒç”¨ä¼šæŒ‰è¿™ä¸ªé¡ºåºè°ƒç”¨\n\t\t\t */\n\t\t\tregisterDisposableBeanIfNecessary(beanName, bean, mbd);\n\t\t}\n\t\tcatch (BeanDefinitionValidationException ex) {\n\t\t\tthrow new BeanCreationException(\n\t\t\t\t\tmbd.getResourceDescription(), beanName, \"Invalid destruction signature\", ex);\n\t\t}\n\n\t\treturn exposedObject;\n\t}\n</code></pre>\n<h3 id=\"å®ä¾‹åŒ–-æ„é€ å‡½æ•°çš„ç»†èŠ‚\">å®ä¾‹åŒ– æ„é€ å‡½æ•°çš„ç»†èŠ‚</h3>\n<pre><code class=\"language-java\">\n\t/**\n\t * å®ä¾‹åŒ–è¯¦ç»†è¿‡ç¨‹\n\t * \n\t * Create a new instance for the specified bean, using an appropriate instantiation strategy:\n\t * factory method, constructor autowiring, or simple instantiation.\n\t * @param beanName the name of the bean\n\t * @param mbd the bean definition for the bean\n\t * @param args explicit arguments to use for constructor or factory method invocation\n\t * @return a BeanWrapper for the new instance\n\t * @see #obtainFromSupplier\n\t * @see #instantiateUsingFactoryMethod\n\t * @see #autowireConstructor\n\t * @see #instantiateBean\n\t *\n\t */\n\tprotected BeanWrapper createBeanInstance(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) {\n\t\t// Make sure bean class is actually resolved at this point.\n\t\t// ç¡®ä¿Class æ˜¯å¯ä»¥å®ä¾‹åŒ–çš„\n\t\tClass&lt;?&gt; beanClass = resolveBeanClass(mbd, beanName);\n\t\t/**\n\t\t * éªŒè¯ä¸€ä¸‹æ„é€ æ–¹æ³• è®¿é—®ä¿®é¥°ç¬¦\n\t\t */\n\t\tif (beanClass != null &amp;&amp; !Modifier.isPublic(beanClass.getModifiers()) &amp;&amp; !mbd.isNonPublicAccessAllowed()) {\n\t\t\tthrow new BeanCreationException(mbd.getResourceDescription(), beanName,\n\t\t\t\t\t\"Bean class isn't public, and nonpublic access not allowed: \" + beanClass.getName());\n\t\t}\n\t\t/**\n\t\t * å¦‚æœè¯¥ BeanDefinition æœ‰é…ç½® instanceSupplierå±æ€§(java.util.function.Supplier),\n\t\t * å°†ä½¿ç”¨å…¶Supplier#getæ–¹æ³•çš„è¿”å›, ä½œä¸ºå®ä¾‹å¯¹è±¡\n\t\t */\n\t\tSupplier&lt;?&gt; instanceSupplier = mbd.getInstanceSupplier();\n\t\tif (instanceSupplier != null) {\n\t\t\treturn obtainFromSupplier(instanceSupplier, beanName, mbd);\n\t\t}\n\n\t\t/**\n\t\t * å¦‚æœè¯¥ BeanDefinition æœ‰é…ç½® factory-method å°†ä½¿ç”¨è¯¥æ–¹æ³•çš„è¿”å› ä½œä¸ºå®ä¾‹å¯¹è±¡\n\t\t * è¿™é‡Œè¿™é‡ŒåŒ…æ‹¬'é™æ€å·¥å‚'å’Œ'å®ä¾‹å·¥å‚'çš„å¤„ç†(é€šè¿‡bdçš„factoryBeanName è¿›è¡Œåˆ¤æ–­, å¦‚æœå­˜åœ¨åˆ™æ˜¯'å®ä¾‹å·¥å‚')\n\t\t *\n\t\t * é™æ€å·¥å‚(æ³¨æ„ å·¥å‚æ–¹æ³•æ˜¯staticæ–¹æ³•)\n\t\t * &lt;bean id=\"user\" class=\"org.yang.User\"  factory-method=\"createUser\"/&gt;\n\t\t *\n\t\t * å®ä¾‹å·¥å‚(æ³¨æ„ å·¥å‚å¯¹è±¡æ˜¯ä¸€ä¸ªå®ä¾‹, ä½¿ç”¨è¯¥å®ä¾‹æ–¹æ³•è¿”å›çš„)\n\t\t * &lt;bean id=\"userFactory\" class=\"org.yang.UserFactory\"/&gt;\n\t\t *  &lt;! -- factory-bean æŒ‡å‘å®ä¾‹å·¥å‚ Bean --&gt;\n\t\t * &lt;bean id=\"user\" class=\"org.yang.User\" factory-bean=\"userFactory\" factory-method=\"createUser\"/&gt;\n\t\t *\n\t\t */\n\t\tif (mbd.getFactoryMethodName() != null) {\n\t\t\treturn instantiateUsingFactoryMethod(beanName, mbd, args);\n\t\t}\n\n\t\t/**\n\t\t *  =======================\n\t\t *  in short : ä¸‹é¢ä¸»è¦é€»è¾‘å°±æ˜¯ æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æ„é€ å‡½æ•°å’Œæ³¨å…¥æ–¹å¼, ç„¶åå­˜èµ·æ¥, é€šè¿‡åå°„å®ä¾‹åŒ–\n\t\t *  å¦‚æœä¸‹æ¬¡è¿˜éœ€è¦å°±ç›´æ¥æ ¹æ®æƒ…å†µç›´æ¥æ‰§è¡Œ(ä»…åŸå‹Beanæ‰æœ‰é‡å¤åˆ›å»ºçš„æƒ…å†µ)\n\t\t */\n\t\t// Shortcut when re-creating the same bean...\n\t\t/**\n\t\t * æ˜¯å¦å·²ç»è§£æ/åˆ›å»ºè¿‡äº†\n\t\t */\n\t\tboolean resolved = false;\n\t\t/**\n\t\t * æ˜¯å¦éœ€è¦è‡ªåŠ¨æ³¨å…¥\n\t\t */\n\t\tboolean autowireNecessary = false;\n\t\tif (args == null) {\n\t\t\tsynchronized (mbd.constructorArgumentLock) {\n\t\t\t\t/**\n\t\t\t\t * ç±»ä¼¼ä¸€ä¸ªç¼“å­˜æœºåˆ¶, åé¢åœ¨ {@link org.springframework.beans.factory.support.SimpleInstantiationStrategy#instantiate(org.springframework.beans.factory.support.RootBeanDefinition, java.lang.String, org.springframework.beans.factory.BeanFactory)}\n\t\t\t\t * è§£æè¿‡ç¨‹ä¸­ä¼šç»™å®ƒèµ‹å€¼å­˜èµ·æ¥; ä¸‹é¢å°±æ ¹æ®è§£æçš„æƒ…å†µæ‰§è¡Œ\n\t\t\t\t */\n\t\t\t\tif (mbd.resolvedConstructorOrFactoryMethod != null) {\n\t\t\t\t\tresolved = true;\n\t\t\t\t\tautowireNecessary = mbd.constructorArgumentsResolved;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * å·²ç»è§£æè¿‡äº†, æ ¹æ®è§£æçš„æƒ…å†µ, æ‰§è¡Œ\n\t\t */\n\t\tif (resolved) {\n\t\t\tif (autowireNecessary) {\n\t\t\t\t/**\n\t\t\t\t * ä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°æ³¨å…¥,åˆ›å»º (new)\n\t\t\t\t */\n\t\t\t\treturn autowireConstructor(beanName, mbd, null, null);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t/**\n\t\t\t\t * ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°æ³¨å…¥,åˆ›å»º (new)\n\t\t\t\t */\n\t\t\t\treturn instantiateBean(beanName, mbd);\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * é¦–æ¬¡è§£æåˆ›å»ºBean\n\t\t * =============================\n\t\t */\n\n\t\t// Candidate constructors for autowiring?\n\t\t/**\n\t\t * ä» BeanPostProcessors é‡Œé¢æ¨æ–­æ„é€ æ–¹æ³•\n\t\t * SmartInstantiationAwareBeanPostProcessor æ¥å£å¯ä»¥å¯¹ 'æ„é€ æ–¹æ³•æ³¨å…¥çš„é€‰æ‹©' è¿›è¡Œè°ƒæ•´(æ¨è?)\n\t\t * {@link org.springframework.beans.factory.config.SmartInstantiationAwareBeanPostProcessor#determineCandidateConstructors(java.lang.Class, java.lang.String)}\n\t\t *\n\t\t */\n\t\tConstructor&lt;?&gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName);\n\t\t/**\n\t\t * è‡ªåŠ¨è½¬é…çš„æ–¹å¼, æœ‰äº”ç§ (è§ {@link org.springframework.beans.factory.config.AutowireCapableBeanFactory}çš„å‡ ä¸ªå¸¸é‡):\n\t\t *  1. AUTOWIRE_NO = 0; æœªæŒ‡å®š, ä¸æ³¨å…¥\n\t\t * \t2. AUTOWIRE_BY_NAME = 1; byName\n\t\t * \t3. AUTOWIRE_BY_TYPE = 2; byType\n\t\t * \t4. AUTOWIRE_CONSTRUCTOR = 3; byæ„é€ \n\t\t *  5. AUTOWIRE_AUTODETECT = 4;(å°†å¼ƒç”¨)\n\t\t *\n\t\t */\n\t\tif (ctors != null || mbd.getResolvedAutowireMode() == AUTOWIRE_CONSTRUCTOR ||\n\t\t\t\tmbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) {\n\t\t\t/**\n\t\t\t * ä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°æ³¨å…¥,åˆ›å»º\n\t\t\t */\n\t\t\treturn autowireConstructor(beanName, mbd, ctors, args);\n\t\t}\n\n\t\t// Preferred constructors for default construction?\n\t\t/**\n\t\t *  æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ„é€ å‡½æ•°, å¦‚æœmbdæœ‰é…ç½® é¦–é€‰çš„æ„é€ å‡½æ•°, å°±ç”¨å®ƒ\n\t\t */\n\t\tctors = mbd.getPreferredConstructors();\n\t\tif (ctors != null) {\n\t\t\treturn autowireConstructor(beanName, mbd, ctors, null);\n\t\t}\n\n\t\t// No special handling: simply use no-arg constructor.\n\t\t/**\n\t\t * ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°æ³¨å…¥,åˆ›å»º\n\t\t */\n\t\treturn instantiateBean(beanName, mbd);\n\t}\n</code></pre>\n<h3 id=\"å¡«å……å±æ€§\">å¡«å……å±æ€§</h3>\n<pre><code class=\"language-java\">/**\n\t * Populate the bean instance in the given BeanWrapper with the property values\n\t * from the bean definition.\n\t * @param beanName the name of the bean\n\t * @param mbd the bean definition for the beanT\n\t * @param bw the BeanWrapper with bean instance\n\t */\n\tprotected void populateBean(String beanName, RootBeanDefinition mbd, @Nullable BeanWrapper bw) {\n\t\t// éªŒè¯ä¸€ä¸‹å…¥å‚\n\t\tif (bw == null) {\n\t\t\tif (mbd.hasPropertyValues()) {\n\t\t\t\tthrow new BeanCreationException(\n\t\t\t\t\t\tmbd.getResourceDescription(), beanName, \"Cannot apply property values to null instance\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Skip property population phase for null instance.\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (bw.getWrappedClass().isRecord()) {\n\t\t\tif (mbd.hasPropertyValues()) {\n\t\t\t\tthrow new BeanCreationException(\n\t\t\t\t\t\tmbd.getResourceDescription(), beanName, \"Cannot apply property values to a record\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Skip property population phase for records since they are immutable.\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Give any InstantiationAwareBeanPostProcessors the opportunity to modify the\n\t\t// state of the bean before properties are set. This can be used, for example,\n\t\t// to support styles of field injection.\n\t\t/**\n\t\t * å¦‚æœæ˜¯AOP, pointcut, adviceç›¸å…³çš„, synthetic ä¼šé…ç½®ä¸º true\n\t\t * 1. è°ƒç”¨ BeanPostProcessor çš„å­æ¥å£ InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation\n\t\t * (ä½œç”¨æ˜¯ åœ¨å®ä¾‹åŒ–ä¹‹åï¼Œå±æ€§å¡«å……ä¹‹å‰æ‰§è¡Œæ“ä½œ, å¯ä»¥æ‹¦æˆªå±æ€§å¡«å……æ“ä½œ)\n\t\t */\n\t\tif (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) {\n\t\t\tfor (InstantiationAwareBeanPostProcessor bp : getBeanPostProcessorCache().instantiationAware) {\n\t\t\t\tif (!bp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName)) {\n\t\t\t\t\t//postProcessAfterInstantiation è¿”å› false , æ‹¦æˆªå±æ€§å¡«å……;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª{@link PropertyValue}å¯¹è±¡çš„Holderï¼Œé€šå¸¸é’ˆå¯¹ç‰¹å®šç›®æ ‡beançš„ä¸€æ¬¡æ›´æ–°\n\t\t * å¯ä»¥ç†è§£ä¸º: è¯¥beanæ‰€æœ‰å±æ€§çš„æè¿°\n\t\t */\n\t\tPropertyValues pvs = (mbd.hasPropertyValues() ? mbd.getPropertyValues() : null);\n\n\t\t/**\n\t\t * è·å–è‡ªåŠ¨æ³¨å…¥çš„æ–¹å¼\n\t\t */\n\t\tint resolvedAutowireMode = mbd.getResolvedAutowireMode();\n\t\tif (resolvedAutowireMode == AUTOWIRE_BY_NAME || resolvedAutowireMode == AUTOWIRE_BY_TYPE) {\n\t\t\t/**\n\t\t\t * 2. å¤„ç†æ³¨è§£çš„  byName æˆ–è€… byType æ³¨å…¥çš„å±æ€§\n\t\t\t * (æœ‰æ³¨è§£æ‰ä¼šèµ°è¿™ä¸ªåˆ†æ”¯)\n\t\t\t * ===============================\n\t\t\t */\n\t\t\tMutablePropertyValues newPvs = new MutablePropertyValues(pvs);\n\t\t\t// Add property values based on autowire by name if applicable.\n\t\t\tif (resolvedAutowireMode == AUTOWIRE_BY_NAME) {\n\t\t\t\t/**\n\t\t\t\t * é€šè¿‡åç§°æ³¨å…¥\n\t\t\t\t */\n\t\t\t\tautowireByName(beanName, mbd, bw, newPvs);\n\t\t\t}\n\t\t\t// Add property values based on autowire by type if applicable.\n\t\t\tif (resolvedAutowireMode == AUTOWIRE_BY_TYPE) {\n\t\t\t\t/**\n\t\t\t\t * é€šè¿‡ç±»å‹æ³¨å…¥\n\t\t\t\t */\n\t\t\t\tautowireByType(beanName, mbd, bw, newPvs);\n\t\t\t}\n\t\t\tpvs = newPvs;\n\t\t}\n\t\t/**\n\t\t *  3. å›è°ƒæ‰€æœ‰ InstantiationAwareBeanPostProcessor#postProcessProperties æ–¹æ³•\n\t\t *  æ¯”å¦‚, `@Autowired` çš„å¤„ç†å¯¹åº”å®ç°ç±»: {@link org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor}\n\t\t *  (ä½œç”¨æ˜¯: åœ¨å·¥å‚å°†å±æ€§å€¼åº”ç”¨åˆ°ç»™å®šbeanä¹‹å‰ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¤„ç†)\n\t\t * \t æ³¨æ„è¿™é‡Œä¹Ÿåªæ˜¯è§£æ, å¹¶æ²¡æœ‰è®¾ç½®è¿›å», å®é™…èµ‹å€¼æ–¹æ³•è§ä¸‹: {@link AbstractAutowireCapableBeanFactory#applyPropertyValues(java.lang.String, org.springframework.beans.factory.config.BeanDefinition, org.springframework.beans.BeanWrapper, org.springframework.beans.PropertyValues)}\n\t\t *\n\t\t */\n\t\tif (hasInstantiationAwareBeanPostProcessors()) {\n\t\t\tif (pvs == null) {\n\t\t\t\tpvs = mbd.getPropertyValues();\n\t\t\t}\n\t\t\tfor (InstantiationAwareBeanPostProcessor bp : getBeanPostProcessorCache().instantiationAware) {\n\t\t\t\tPropertyValues pvsToUse = bp.postProcessProperties(pvs, bw.getWrappedInstance(), beanName);\n\t\t\t\tif (pvsToUse == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tpvs = pvsToUse;\n\t\t\t}\n\t\t}\n\n\t\tboolean needsDepCheck = (mbd.getDependencyCheck() != AbstractBeanDefinition.DEPENDENCY_CHECK_NONE);\n\t\tif (needsDepCheck) {\n\t\t\tPropertyDescriptor[] filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);\n\t\t\tcheckDependencies(beanName, mbd, filteredPds, pvs);\n\t\t}\n\t\t/**\n\t\t * 4. è§£æBeanDefinitionçš„æè¿°å€¼, åå°„è°ƒç”¨ èµ‹å€¼ bean å±æ€§ (å°†è§£æåˆ°çš„ pvs èµ‹å€¼åˆ° bw)\n\t\t */\n\t\tif (pvs != null) {\n\t\t\tapplyPropertyValues(beanName, mbd, bw, pvs);\n\t\t}\n\t}\n</code></pre>\n<h3 id=\"åˆå§‹åŒ–-è°ƒç”¨-init-method-aware-bppæ–¹æ³•\">åˆå§‹åŒ– è°ƒç”¨ init-method Aware BPPæ–¹æ³•</h3>\n<p><code>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#initializeBean(java.lang.String, java.lang.Object, org.springframework.beans.factory.support.RootBeanDefinition)</code></p>\n<pre><code class=\"language-java\">/**\n\t * Initialize the given bean instance, applying factory callbacks\n\t * as well as init methods and bean post processors.\n\t * &lt;p&gt;Called from {@link #createBean} for traditionally defined beans,\n\t * and from {@link #initializeBean} for existing bean instances.\n\t * @param beanName the bean name in the factory (for debugging purposes)\n\t * @param bean the new bean instance we may need to initialize\n\t * @param mbd the bean definition that the bean was created with\n\t * (can also be {@code null}, if given an existing bean instance)\n\t * @return the initialized bean instance (potentially wrapped)\n\t * @see BeanNameAware\n\t * @see BeanClassLoaderAware\n\t * @see BeanFactoryAware\n\t * @see #applyBeanPostProcessorsBeforeInitialization\n\t * @see #invokeInitMethods\n\t * @see #applyBeanPostProcessorsAfterInitialization\n\t */\n\t@SuppressWarnings(\"deprecation\")\n\tprotected Object initializeBean(String beanName, Object bean, @Nullable RootBeanDefinition mbd) {\n\n\t\t/**\n\t\t * å…ˆè°ƒç”¨è¿™ä¸‰ä¸ª BeanNameAware, BeanClassLoaderAware, BeanFactoryAware\n\t\t * è¿™ä¸‰ä¸ªæ˜¯åœ¨åˆ›å»º BeanFactory æ—¶å¿½ç•¥çš„ä¸‰ä¸ª Aware æ¥å£\n\t\t * { @link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#AbstractAutowireCapableBeanFactory() }\n\t\t *\n\t\t */\n\t\tinvokeAwareMethods(beanName, bean);\n\n\t\tObject wrappedBean = bean;\n\t\tif (mbd == null || !mbd.isSynthetic()) {\n\t\t\t/**\n\t\t\t * è°ƒç”¨æ‰€æœ‰ BeanPostProcessors#postProcessBeforeInitialization\n\t\t\t * (ä½œç”¨ åœ¨Beanåˆå§‹åŒ–ä¹‹å‰è°ƒç”¨)\n\t\t\t * æ¯”å¦‚ Spring ä¸­Awareå±æ€§çš„è®¾ç½®, æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ‰©å±•çš„\n\t\t\t * - org.springframework.context.support.ApplicationContextAwareProcessor\n\t\t\t * å¯¹åº”è°ƒç”¨ ApplicationContextAware, EnvironmentAware, ApplicationEventPublisherAware ç­‰Awareæ–¹æ³•\n\t\t\t *\n\t\t\t */\n\t\t\twrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);\n\t\t}\n\n\t\ttry {\n\t\t\t/**\n\t\t\t * è°ƒç”¨ init-method æ–¹æ³•\n\t\t\t */\n\t\t\tinvokeInitMethods(beanName, wrappedBean, mbd);\n\t\t}\n\t\tcatch (Throwable ex) {\n\t\t\tthrow new BeanCreationException(\n\t\t\t\t\t(mbd != null ? mbd.getResourceDescription() : null), beanName, ex.getMessage(), ex);\n\t\t}\n\t\tif (mbd == null || !mbd.isSynthetic()) {\n\t\t\t/**\n\t\t\t * è°ƒç”¨æ‰€æœ‰ BeanPostProcessors#postProcessAfterInitialization\n\t\t\t * (ä½œç”¨ åœ¨Beanåˆå§‹åŒ–ä¹‹åè°ƒç”¨)\n\t\t\t *\n\t\t\t * - AspectJAwareAdvisorAutoProxyCreator.class\n\t\t\t * org.springframework.aop.config.internalAutoProxyCreator å¯¹åº”çš„ç±»æœ‰æ ¹æ®æƒ…å†µæœ‰ä¸‰ä¸ªå¯èƒ½\n\t\t\t *   InfrastructureAdvisorAutoProxyCreator.class,\n\t\t\t *   AspectJAwareAdvisorAutoProxyCreator.class,\n\t\t\t *   AnnotationAwareAspectJAutoProxyCreator.class\n\t\t\t *\n\t\t\t *  å¦‚æœéœ€è¦ä»£ç†, è¿™é‡Œä¼šçœŸæ­£çš„å¯¹åŸå§‹ bean è¿›è¡Œä»£ç†  è¿›è¡Œä»£ç†çš„åˆ›å»º createProxy\n\t\t\t *\n\t\t\t */\n\t\t\twrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);\n\t\t}\n\n\t\treturn wrappedBean;\n\t}\n</code></pre>\n<h3 id=\"æ€»ç»“-9\">æ€»ç»“</h3>\n<pre><code>1. ä¸º beanFactory è®¾ç½®ç±»å‹è½¬æ¢å™¨(ConversionService) å±æ€§å¡«å……æ—¶ä¼šç”¨åˆ° {@link AbstractApplicationContext#finishBeanFactoryInitialization(ConfigurableListableBeanFactory)}\n2. ä¸º beanFactory æ·»åŠ å˜é‡è§£æå™¨ (StringValueResolver)\n\tå¦‚æœ beanFactory ä¸Šä¸‹æ–‡ä¸­ä¸åŒ…å« \"é»˜è®¤çš„å˜é‡è§£æå™¨ (ç±»ä¼¼ PropertySourcesPlaceholderConfigurer) è§£æç±»ä¼¼ '${}' è¿™æ ·çš„å˜é‡ \"\n\tåˆ™ä½¿ç”¨ç¯å¢ƒå¯¹è±¡(ConfigurableEnvironment)ä¸­çš„ ConfigurablePropertyResolverå®ç°æ¥ä½œä¸º StringValueResolver æ·»åŠ è¿›å»\n3. å†»ç»“é…ç½®, æ­¤åå°±ä¸å†å…è®¸æ›´æ”¹ beanDefinition äº†\n4. å®ä¾‹åŒ–æ‰€æœ‰å‰©ä½™çš„ (élazy-init) å•ä¾‹ Bean\n5. å¤„ç† FactoryBean ç±»å‹çš„bean {@link DefaultListableBeanFactory#preInstantiateSingletons()}\n\tå¦‚æœè¯¥beanæ˜¯ FactoryBean, åˆ™åœ¨ bean name å‰é¢åŠ ä¸€ä¸ª '&amp;' å‰ç¼€, å…ˆè·å–/å®ä¾‹åŒ– FactoryBean æœ¬èº«;\n\t(æ³¨æ„ä¸€ä¸‹ FactoryBean ç”Ÿæˆå¯¹è±¡æ˜¯ä¸éµå¾ª Spring çš„beanç”Ÿå‘½å‘¨æœŸçš„)\n\tè¿™æœ‰ä¸¤ä¸ªå¯¹è±¡, å¦‚ä½•è·å–? getBean(beanName) :\n\t1. ä¼ å…¥ FactoryBean çš„ name è¿”å›çš„æ˜¯å…¶ getObject çš„ç›®æ ‡å¯¹è±¡å®ä¾‹;\n\t2. å¦‚æœæƒ³è·å– FactoryBean æœ¬èº«å®ä¾‹, åˆ™å‰é¢éœ€è¦åŠ ä¸€ä¸ª '&amp;' å‰ç¼€;\n6. å°è¯•ä»å½“å‰å®¹å™¨ ä¸€ äºŒ ä¸‰çº§ç¼“å­˜è·å– {@link AbstractBeanFactory#doGetBean(String, Class, Object[], boolean)}\n7. å¤„ç† AOP ä»£ç†å¯¹è±¡ç”Ÿæˆ {@link AbstractAutowireCapableBeanFactory#createBean(String, RootBeanDefinition, Object[])}\n8. åœ¨JVMå±‚é¢å®ä¾‹åŒ–å¯¹è±¡ {@link AbstractAutowireCapableBeanFactory#doCreateBean(String, RootBeanDefinition, Object[])}\n\t1.çœŸæ­£åœ¨jvmå±‚é¢å®ä¾‹åŒ–å¯¹è±¡;\n\t\t1. å¦‚æœè¯¥ BeanDefinition æœ‰é…ç½® instanceSupplierå±æ€§(java.util.function.Supplier),\n\t\t å°†ä½¿ç”¨å…¶Supplier#getæ–¹æ³•çš„è¿”å›, ä½œä¸ºå®ä¾‹å¯¹è±¡\n\t\t2. å¦‚æœè¯¥ BeanDefinition æœ‰é…ç½® factory-method å°†ä½¿ç”¨è¯¥æ–¹æ³•è¿”å›çš„, ä½œä¸ºå®ä¾‹å¯¹è±¡\n\t\t è¿™é‡Œè¿™é‡ŒåŒ…æ‹¬'é™æ€å·¥å‚'å’Œ'å®ä¾‹å·¥å‚'çš„å¤„ç†(é€šè¿‡bdçš„factoryBeanName è¿›è¡Œåˆ¤æ–­, å¦‚æœå­˜åœ¨åˆ™æ˜¯'å®ä¾‹å·¥å‚')\n\t\t3. ä½¿ç”¨åå°„å®ä¾‹åŒ–, æ ¹æ®ç­–ç•¥å®ä¾‹åŒ–Beanå¯¹è±¡ {@link org.springframework.beans.factory.support.SimpleInstantiationStrategy}\n\t\t- ä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°æ³¨å…¥,åˆ›å»º (new)\n\t\t- ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°åˆ›å»º (new)\n\t\t- å·¥å‚æ–¹æ³•å®ä¾‹åŒ– ('é™æ€å·¥å‚' 'å®ä¾‹å·¥å‚' )\n\t\t`&lt;bean  factory-bean=\"bookFactoryBean\"  factory-method=\"getBook()\"/&gt;`\n\t\té™æ€å·¥å‚: factory-bean è‹¥æ˜¯ å…¨é™å®šç±»å åˆ™ä½¿ç”¨ BookFactoryBean::getBook çš„é™æ€æ–¹æ³•è¿”å›çš„å¯¹è±¡\n\t\tå®ä¾‹å·¥å‚:  factory-bean è‹¥æ˜¯ bean å åˆ™ä½¿ç”¨è¯¥å®ä¾‹æ–¹æ³•è¿”å›çš„å¯¹è±¡\n\t2. ç”¨BeanWrapper åŒ…è£…åŸå§‹bean (è£…é¥°æ¨¡å¼)\n\t3. åˆå§‹åŒ– BeanWrapper\n\t\t1. ç»™ BeanWrapper è®¾ç½®äº†, ConversionService\n\t\t2. ç»™ BeanWrapper æ³¨å†Œäº†, å½“å‰ bean factory (propertyEditorRegistrars)ä¸­çš„å…¨éƒ¨ PropertyEditor\n\t\t3. å¤„ç† MergedBeanDefinitionPostProcessor çš„æ¥å£å›è°ƒ {@link AbstractAutowireCapableBeanFactory#applyMergedBeanDefinitionPostProcessors(RootBeanDefinition, Class, String)}\n\t\tè°ƒç”¨ æ·»åŠ åœ¨ context ä¸­ BeanPostProcessor çš„ MergedBeanDefinitionPostProcessor çš„æ¥å£å›è°ƒ\n\t\tè§£æåˆ°è¯¸å¦‚`@Autowired`ä¹‹ç±»çš„æ³¨è§£ (Metadata)å…ƒä¿¡æ¯,åˆå¹¶åˆ°BeanDefinitionä¸­\n\t4. å¡«å……Beanå±æ€§ {@link AbstractAutowireCapableBeanFactory#populateBean(String, RootBeanDefinition, BeanWrapper)}\n\t\t1. å¦‚æœæ˜¯AOP, pointcut, adviceç›¸å…³çš„, synthetic ä¼šé…ç½®ä¸º true  è°ƒç”¨ BeanPostProcessor çš„å­æ¥å£ InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation\n\t\t(ä½œç”¨æ˜¯ åœ¨å®ä¾‹åŒ–ä¹‹åï¼Œå±æ€§å¡«å……ä¹‹å‰æ‰§è¡Œæ“ä½œ, å¯ä»¥æ‹¦æˆªå±æ€§å¡«å……æ“ä½œ)\n\t\t2. å¤„ç†æ³¨è§£çš„  byName æˆ–è€… byType æ³¨å…¥çš„å±æ€§\n\t\t3. å›è°ƒæ‰€æœ‰ InstantiationAwareBeanPostProcessor#postProcessProperties æ–¹æ³•\n\t\tæ¯”å¦‚, `@Autowired` çš„å¤„ç†å¯¹åº”å®ç°ç±»: {@link org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor}\n\t\t(ä½œç”¨æ˜¯: åœ¨å·¥å‚å°†å±æ€§å€¼åº”ç”¨åˆ°ç»™å®šbeanä¹‹å‰ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¤„ç†)\n\t\tæ³¨æ„è¿™é‡Œä¹Ÿåªæ˜¯è§£æ, å¹¶æ²¡æœ‰è®¾ç½®è¿›å», å®é™…èµ‹å€¼æ–¹æ³•è§: {@link AbstractAutowireCapableBeanFactory#applyPropertyValues(java.lang.String, org.springframework.beans.factory.config.BeanDefinition, org.springframework.beans.BeanWrapper, org.springframework.beans.PropertyValues)}\n\t5. åˆå§‹åŒ–Beanå¯¹è±¡ {@link AbstractAutowireCapableBeanFactory#initializeBean(String, Object, RootBeanDefinition)}\n\t\t1. å…ˆè°ƒç”¨è¿™ä¸‰ä¸ª BeanNameAware, BeanClassLoaderAware, BeanFactoryAware {@link AbstractAutowireCapableBeanFactory#invokeAwareMethods(String, Object)}\n\t\tè¿™ä¸‰ä¸ªæ˜¯åœ¨åˆ›å»ºBeanFactory æ—¶å¿½ç•¥çš„ä¸‰ä¸ª Aware æ¥å£\n\t\t2. è°ƒç”¨æ‰€æœ‰ BeanPostProcessors#postProcessBeforeInitialization (ä½œç”¨: åœ¨Beanåˆå§‹åŒ–ä¹‹å‰è°ƒç”¨) {@link AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsBeforeInitialization(Object, String)}\n\t\t3. è°ƒç”¨ init-method æ–¹æ³• {@link AbstractAutowireCapableBeanFactory#invokeInitMethods(String, Object, RootBeanDefinition)}\n\t\t4. è°ƒç”¨æ‰€æœ‰ BeanPostProcessors#postProcessAfterInitialization (ä½œç”¨: åœ¨Beanåˆå§‹åŒ–ä¹‹åè°ƒç”¨) {@link AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsAfterInitialization(Object, String)}\n\t6. æ³¨å†Œ beané”€æ¯çš„å·¥ä½œ(å¦‚æœéœ€è¦){@link AbstractBeanFactory#registerDisposableBeanIfNecessary(String, Object, RootBeanDefinition)}\n\t\t1. org.springframework.beans.factory.config.DestructionAwareBeanPostProcessor#postProcessBeforeDestruction(Object,String) BPPæ¥å£\n\t\t2. org.springframework.beans.factory.DisposableBean æ¥å£\n\t\t3. è‡ªå®šä¹‰ destroyæ–¹æ³•\n\t\t(åœ¨å®¹å™¨å…³é—­æ—¶ä¼šè°ƒç”¨ä¼šæŒ‰è¿™ä¸ªé¡ºåºè°ƒç”¨)\n\n</code></pre>\n<h2 id=\"åäºŒ-å®Œæˆå®¹å™¨åˆ·æ–°\">åäºŒ å®Œæˆå®¹å™¨åˆ·æ–°</h2>\n<p><code>org.springframework.context.support.AbstractApplicationContext#finishRefresh</code></p>\n<pre><code class=\"language-java\">/**  \n * Finish the refresh of this context, invoking the LifecycleProcessor's * onRefresh() method and publishing the * {@link org.springframework.context.event.ContextRefreshedEvent}.  \n */\n protected void finishRefresh() {  \n   \n}\n</code></pre>\n<h3 id=\"æ€»ç»“-10\">æ€»ç»“</h3>\n<ol>\n<li>æ¸…ç†å„ç§ç¼“å­˜</li>\n<li>ä¸ºå½“å‰ä¸Šä¸‹æ–‡åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨</li>\n<li>å‘å¸ƒ ContextRefreshedEvent (Context å®Œæˆåˆ·æ–°)äº‹ä»¶</li>\n</ol>\n<h1 id=\"å…³äº-bean-çš„ç»§æ‰¿parentå±æ€§\">å…³äº Bean çš„ç»§æ‰¿(parentå±æ€§)</h1>\n<p>è¿™é‡Œçš„ç»§æ‰¿å’Œ java è¯­æ³•ä¸­çš„ç»§æ‰¿æ²¡æœ‰ä»»ä½•å…³ç³», ä¸è¿‡æ€è·¯æ˜¯ç›¸é€šçš„; child bean ä¼šç»§æ‰¿ parent bean çš„æ‰€æœ‰é…ç½®, ä¹Ÿå¯ä»¥è¦†ç›–ä¸€äº›é…ç½®, å½“ç„¶ä¹Ÿå¯ä»¥æ–°å¢é¢å¤–çš„é…ç½®;</p>\n<p>Spring ä¸­æä¾›äº†ç»§æ‰¿è‡ª AbstractBeanDefinition çš„ ChildBeanDefinition æ¥è¡¨ç¤º child bean;</p>\n<p>çœ‹å¦‚ä¸‹ä¸€ä¸ªä¾‹å­:</p>\n<pre><code class=\"language-xml\">&lt;bean id=\"inheritedTestBean\" abstract=\"true\" class=\"org.springframework.beans.TestBean\"&gt;\n    &lt;property name=\"name\" value=\"parent\"/&gt;\n    &lt;property name=\"age\" value=\"1\"/&gt;\n&lt;/bean&gt;\n\n&lt;bean id=\"inheritsWithDifferentClass\" class=\"org.springframework.beans.DerivedTestBean\"\n        parent=\"inheritedTestBean\" init-method=\"initialize\"&gt;\n\n    &lt;property name=\"name\" value=\"override\"/&gt;\n&lt;/bean&gt;\n\n</code></pre>\n<p>parent bean è®¾ç½®äº† <code>abstract=\"true\"</code> æ‰€ä»¥å®ƒä¸ä¼šè¢«å®ä¾‹åŒ–, child bean<strong>(inheritsWithDifferentClass)</strong>ç»§æ‰¿äº† parent bean<strong>(inheritedTestBean)</strong> çš„<code> name</code> <code>age</code> ä¸¤ä¸ªå±æ€§, ä½†æ˜¯å¯¹ <code>name</code> å±æ€§è¿›è¡Œäº†è¦†å†™, å¢åŠ äº†<code>init-method</code>;</p>\n<p><strong>in short: å³é…ç½®ç»§æ‰¿, child bean ä¼šç»§æ‰¿ scope, æ„é€ å™¨å‚æ•°å€¼, å±æ€§å€¼, init-method, destroy-method ç­‰ç­‰é…ç½®</strong></p>\n<pre><code class=\"language-java\">@Configuration\npublic class WebConfigBeans {\n\t\n\t@Autowired\n\tprivate RequestMappingHandlerAdapter handlerAdapter;\n\t\n\t@PostConstruct\n\tpublic void initEditableValidation(){\n\t\t//è·å¾— RequestMappingHandler ä¸­çš„ ConfigurableWebBindingInitializer\n\t\tConfigurableWebBindingInitializer initializer =(ConfigurableWebBindingInitializer)handlerAdapter.getWebBindingInitializer();\n\t\tif(initializer.getConversionService()!=null){\n\t\t\tGenericConversionService genericConversionService=(GenericConversionService)initializer.getConversionService();\n\t\t\t//æ·»åŠ è‡ªå®šä¹‰è½¬æ¢å™¨\n\t\t\tgenericConversionService.addConverter(new StringToDateConverter());\n\t\t}\n\t}\n\t\n}\n</code></pre>\n<h1 id=\"å…³äº-factorybean\">å…³äº FactoryBean</h1>\n<p><code>org.springframework.beans.factory.FactoryBean</code> é€‚ç”¨äº Bean çš„åˆ›å»ºè¿‡ç¨‹æ¯”è¾ƒå¤æ‚çš„åœºæ™¯, æ¯”å¦‚æ•°æ®åº“è¿æ¥æ± çš„åˆ›å»º;</p>\n<p>æˆ‘ä»¬å‡è®¾ç°åœ¨éœ€è¦åˆ›å»ºä¸€ä¸ª Person çš„ Bean, é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ª Car çš„å®ä¾‹, æˆ‘ä»¬è¿™é‡Œå‡è®¾ Car çš„å®ä¾‹åˆ›å»ºå¾ˆéº»çƒ¦, é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠåˆ›å»º Car çš„å¤æ‚è¿‡ç¨‹åŒ…è£…èµ·æ¥:</p>\n<p><strong>æ³¨æ„: ä½¿ç”¨FactoryBean å®Œå…¨è‡ªå®šä¹‰åˆ›å»ºBean, ä¸ä¼šèµ°Beanç”Ÿå‘½å‘¨æœŸçš„å„ç§ Processorå›è°ƒ.</strong></p>\n<pre><code class=\"language-java\">public class MyCarFactoryBean implements FactoryBean&lt;Car&gt;{\n    private String make; \n    private int year ;\n\n    public void setMake(String m){ this.make =m ; }\n\n    public void setYear(int y){ this.year = y; }\n\n    public Car getObject(){ \n      // è¿™é‡Œæˆ‘ä»¬å‡è®¾ Car çš„å®ä¾‹åŒ–è¿‡ç¨‹éå¸¸å¤æ‚, åæ­£å°±ä¸æ˜¯å‡ è¡Œä»£ç å¯ä»¥å†™å®Œçš„é‚£ç§\n      CarBuilder cb = CarBuilder.car();\n\n      if(year!=0) cb.setYear(this.year);\n      if(StringUtils.hasText(this.make)) cb.setMake( this.make ); \n      return cb.factory(); \n    }\n\n    public Class&lt;Car&gt; getObjectType() { return Car.class ; } \n\n    public boolean isSingleton() { return false; }\n}\n</code></pre>\n<p>è£…é…çš„æ—¶å€™æ˜¯æ€ä¹ˆé…ç½®çš„:</p>\n<pre><code class=\"language-xml\">&lt;bean class = \"com.javadoop.MyCarFactoryBean\" id = \"car\"&gt;\n  &lt;property name = \"make\" value =\"Honda\"/&gt;\n  &lt;property name = \"year\" value =\"1984\"/&gt;\n&lt;/bean&gt;\n&lt;bean class = \"com.javadoop.Person\" id = \"josh\"&gt;\n  &lt;property name = \"car\" ref = \"car\"/&gt;\n&lt;/bean&gt;\n</code></pre>\n<p><strong>ç®€è€Œè¨€ä¹‹ å°±æ˜¯å®ç° FactoryBeançš„æ¥å£çš„bean, æœ‰å‡ ä¸ªæ–¹æ³•:<code>T getObject()</code> ,<code>Class&lt;?&gt; getObjectType();</code> <code>default boolean isSingleton()</code>, ç”¨æ¥å°è£…åˆ›å»ºå¤æ‚çš„bean</strong></p>\n<h1 id=\"å…³äºå¾ªç¯ä¾èµ–çš„å¤„ç†\">å…³äºå¾ªç¯ä¾èµ–çš„å¤„ç†</h1>\n<h2 id=\"ä¸ºä»€ä¹ˆè¦éœ€è¦ä¸‰çº§ç¼“å­˜\">ä¸ºä»€ä¹ˆè¦éœ€è¦ä¸‰çº§ç¼“å­˜?</h2>\n<p><code>singletonObjects</code>:<br />\nç¬¬ä¸€çº§ç¼“å­˜, é‡Œé¢æ”¾ç½®çš„æ˜¯å·²ç»å®ä¾‹åŒ–å¥½çš„å•ä¾‹å¯¹è±¡, æ˜¯å•ä¾‹ç¼“å­˜æ± ï¼ˆsingletonObjectsï¼‰</p>\n<p><code>earlySingletonObjects</code>:<br />\nç¬¬äºŒçº§ç¼“å­˜, é‡Œé¢å­˜æ”¾çš„æ˜¯ææ—©æ›å…‰çš„å•ä¾‹å¯¹è±¡, æ—©æœŸå¯¹è±¡ï¼ˆearlySingletonObjectsï¼‰. ç®€å•ç²—æš´çš„è¯´å°±æ˜¯newçš„å¯¹è±¡, å¯æ˜¯è¿™ä¸ªå¯¹è±¡è¿˜æ²¡å¡«å……å±æ€§</p>\n<p><code>singletonFactories</code>:<br />\nç¬¬ä¸‰çº§ç¼“å­˜, é‡Œé¢å­˜æ”¾çš„æ˜¯å°†è¦è¢«å®ä¾‹åŒ–çš„å¯¹è±¡çš„å¯¹è±¡å·¥å‚ï¼ˆå­˜æ”¾ bean å·¥å‚å¯¹è±¡ï¼‰, æ˜¯ä¸€ä¸ªåŒ…è£¹å¯¹è±¡<code>ObjectFactory(registeredSingletons)</code>, ç»è¿‡getObjectè·å–åˆ°æ—©æœŸå¯¹è±¡.</p>\n<p>æ­£å¸¸æ¥è®², å¤„ç†å¾ªç¯ä¾èµ–, ç±»ä¼¼äº¤æ¢å˜é‡, åªéœ€è¦ä¸€çº§ç¼“å­˜å°±å¯ä»¥äº†; åŠ ä¸Šå•ä¾‹ç¼“å­˜æ± , ä¸¤çº§ç¼“å­˜æ± å³å¯;</p>\n<pre><code class=\"language-js\">function swap(a, b){\n\ttemp = a;\n\ta = b;\n\tb = temp;\n}\n</code></pre>\n<p>ä¾‹å¦‚: <code>Aservice</code> ä¾èµ– Bservice, <code>Bservice</code> ä¾èµ– <code>Aservice</code>.</p>\n<p>åˆ›å»º <code>Aservice</code> æ—¶, å°†ç”ŸæˆAçš„lambdaæ”¾å…¥ä¸‰çº§ç¼“å­˜, å¡«å……å±æ€§ <code>Bservice</code>, ä¸€äºŒä¸‰çº§ç¼“å­˜ä¸­éƒ½æ²¡,<br />\nå»åˆ›å»º <code>Bservice</code>, å°†ç”ŸæˆBçš„lambdaæ”¾å…¥ä¸‰çº§ç¼“å­˜, å¡«å…… <code>Aservice</code> å±æ€§, å‘ç°ä¸‰çº§ç¼“å­˜ä¸­æœ‰A, æ‰§è¡ŒAçš„lambdaç”Ÿæˆ <code>Aservice</code> å¯¹è±¡, æ”¾å…¥äºŒçº§ç¼“å­˜(ä¸èƒ½æ”¾ä¸€çº§è¿™æ—¶å€™Açš„Bserviceå±æ€§è¿˜æ˜¯null), å¹¶åˆ é™¤Açš„ä¸‰çº§ç¼“å­˜,<br />\nç»§ç»­æ‰§è¡ŒBçš„ lambda ç”Ÿæˆ <code>Bservice</code> å¯¹è±¡, æ”¾å…¥ä¸€çº§ç¼“å­˜, å¹¶åˆ é™¤Bçš„ä¸‰çº§ç¼“å­˜;<br />\nåˆ›å»º <code>Aservice</code> çš„æµç¨‹ä¸­è·å–åˆ°Bserviceå¯¹è±¡ä¹‹å, æŠŠäºŒçº§ç¼“å­˜çš„ <code>Aservice</code> å¯¹è±¡åˆ é™¤, å¹¶æ”¾å…¥ä¸€çº§ç¼“å­˜.</p>\n<p>ç¬¬ä¸‰çº§ç¼“å­˜æ˜¯å¤„ç† AOP å¢å¼ºçš„bean é—®é¢˜:<br />\n<strong>å› ä¸ºä¸çŸ¥é“å½“å‰å¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè¢«å¼•ç”¨, æ‰€ä»¥åªèƒ½åœ¨ç¬¬ä¸€æ¬¡å¼•ç”¨çš„æ—¶å€™æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦éœ€è¦è¢«ä»£ç†, æ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªlambdaè¡¨è¾¾å¼</strong></p>\n<h1 id=\"å…³äºç”Ÿå‘½å‘¨æœŸ\">å…³äºç”Ÿå‘½å‘¨æœŸ</h1>\n<h2 id=\"springä¸­çš„beanç”Ÿå‘½å‘¨æœŸ\">Springä¸­çš„Beanç”Ÿå‘½å‘¨æœŸ</h2>\n<p>Springä¸­çš„Beanç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µ:</p>\n<ol>\n<li>å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰: åœ¨è¿™ä¸ªé˜¶æ®µ, Springå®¹å™¨æ ¹æ®Beançš„é…ç½®ä¿¡æ¯åˆ›å»ºBeanå®ä¾‹. é€šå¸¸, è¿™æ˜¯é€šè¿‡æ„é€ å‡½æ•°æˆ–å·¥å‚æ–¹æ³•æ¥å®Œæˆçš„.</li>\n<li>å±æ€§èµ‹å€¼ï¼ˆProperty Assignmentï¼‰: åœ¨å®ä¾‹åŒ–ä¹‹å, Springå®¹å™¨å°†ä¼šå¯¹Beançš„å±æ€§è¿›è¡Œèµ‹å€¼. è¿™å¯ä»¥é€šè¿‡setteræ–¹æ³•ã€æ³¨è§£ã€æˆ–æ„é€ å‡½æ•°å‚æ•°æ¥å®ç°.</li>\n<li>Awareæ¥å£å›è°ƒï¼ˆAware Interface Callbacksï¼‰: åœ¨å±æ€§èµ‹å€¼ä¹‹å, Springå®¹å™¨ä¼šæ£€æŸ¥Beanæ˜¯å¦å®ç°äº†Awareæ¥å£. å¦‚æœå®ç°äº†, å®¹å™¨ä¼šè°ƒç”¨ç›¸åº”çš„Awareæ¥å£å›è°ƒæ–¹æ³•, è®©Beanè·å–ä¸å®¹å™¨ç›¸å…³çš„é¢å¤–ä¿¡æ¯.</li>\n<li>åˆå§‹åŒ–ï¼ˆInitializationï¼‰: åœ¨å±æ€§èµ‹å€¼å®Œæˆå, Springå®¹å™¨ä¼šè°ƒç”¨Beançš„åˆå§‹åŒ–å›è°ƒæ–¹æ³•. è¿™å¯ä»¥é€šè¿‡å®ç°InitializingBeanæ¥å£çš„afterPropertiesSet()æ–¹æ³•æˆ–åœ¨é…ç½®æ–‡ä»¶ä¸­å£°æ˜çš„è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•æ¥å®ç°.</li>\n<li>BeanPostProcessorå›è°ƒï¼ˆBeanPostProcessor Callbacksï¼‰: åœ¨Beanåˆå§‹åŒ–ä¹‹å‰å’Œä¹‹å, Springå®¹å™¨ä¼šè°ƒç”¨æ³¨å†Œçš„BeanPostProcessoræ¥å£çš„æ–¹æ³•. è¿™å…è®¸æ‚¨åœ¨Beançš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­è¿›è¡Œè‡ªå®šä¹‰å¤„ç†, å¦‚æ·»åŠ é¢å¤–çš„é€»è¾‘æˆ–å¯¹Beanè¿›è¡Œä»£ç†åŒ…è£….</li>\n<li>ä½¿ç”¨ï¼ˆBean in Useï¼‰: åœ¨åˆå§‹åŒ–å®Œæˆå, Beanå°±å¯ä»¥è¢«åº”ç”¨ç¨‹åºä½¿ç”¨äº†</li>\n<li>é”€æ¯ï¼ˆDestructionï¼‰: å½“å®¹å™¨å…³é—­æˆ–è€…ä»å®¹å™¨ä¸­ç§»é™¤Beanæ—¶, ä¼šè§¦å‘Beançš„é”€æ¯. è¿™å¯ä»¥é€šè¿‡å®ç° DisposableBean æ¥å£çš„destroy()æ–¹æ³•æˆ–åœ¨é…ç½®æ–‡ä»¶ä¸­å£°æ˜çš„è‡ªå®šä¹‰é”€æ¯æ–¹æ³•æ¥å®ç°.</li>\n</ol>\n<p>å®ä¾‹åŒ– -&gt; å¡«å……å±æ€§ -&gt; å„ç§Aware<br />\n-&gt; è°ƒç”¨ BeanPostProcessor (åˆå§‹å‰)<br />\n-&gt; è°ƒç”¨ InitializingBean -&gt; è°ƒç”¨è‡ªå®šä¹‰ init-method<br />\n-&gt; è°ƒç”¨ BeanPostProcessor (åˆå§‹å)<br />\n&lt;ä½¿ç”¨&gt;<br />\n-&gt; è°ƒç”¨ DisposableBean -&gt; è°ƒç”¨è‡ªå®šä¹‰ destroy-method</p>\n\n</div>\n<div id=\"MySignature\">\n    é¢„é˜²è€å¹´ç—´å‘†ï¼Œä¿æŒç»ˆèº«å­¦ä¹ !    â€”â€” <a href=\"https://www.cnblogs.com/dddy/\" target=\"_blank\">daidaidaiyu</a>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-13 22:09</span>&nbsp;\n<a href=\"https://www.cnblogs.com/dddy\">daidaidaiyu</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">60</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "ã€Azure ç¯å¢ƒã€‘åœ¨Windowsç¯å¢ƒä¸­ä½¿ç”¨OpenSSLç”Ÿæˆè‡ªç­¾åè¯ä¹¦é“¾æ­¥éª¤åˆ†äº«",
      "link": "https://www.cnblogs.com/lulight/p/19479238",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/lulight/p/19479238\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-13 21:08\">\n    <span>ã€Azure ç¯å¢ƒã€‘åœ¨Windowsç¯å¢ƒä¸­ä½¿ç”¨OpenSSLç”Ÿæˆè‡ªç­¾åè¯ä¹¦é“¾æ­¥éª¤åˆ†äº«</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<h1>é—®é¢˜æè¿°</h1>\n<p>åœ¨Webåº”ç”¨éƒ¨ç½²ç¯å¢ƒä¸­ï¼Œå¸¸å¸¸éœ€è¦ä¸ºå†…éƒ¨ç³»ç»Ÿæˆ–æµ‹è¯•ç¯å¢ƒç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼Œå°¤å…¶æ˜¯åŒ…å«æ ¹è¯ä¹¦ã€ä¸­é—´è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦çš„å®Œæ•´è¯ä¹¦é“¾ï¼Œå¹¶æœ€ç»ˆç”ŸæˆåŒ…å«ç§é’¥çš„ PFX æ–‡ä»¶ï¼ˆ.pfxï¼‰ã€‚</p>\n<p>å¦‚ä½•ä½¿ç”¨ openssl å·¥å…·ä¸€æ­¥æ­¥å®Œæˆè¿™äº›æ“ä½œï¼Œæˆä¸ºå¾ˆå¤šå·¥ç¨‹å¸ˆçš„å®é™…éœ€æ±‚ã€‚</p>\n<p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ç”¨ openssl ç”Ÿæˆè‡ªç­¾åè¯ä¹¦é“¾ï¼Œå¹¶å°†å…¶æ‰“åŒ…ä¸º PFX æ–‡ä»¶ã€‚</p>\n<p>&nbsp;</p>\n<h1>é—®é¢˜è§£ç­”</h1>\n<p class=\"code-line\" dir=\"auto\">ä¸‹é¢æ˜¯ä¸€å¥—<strong>å¯å¤åˆ¶å³ç”¨</strong>çš„åˆ†æ­¥éª¤æŒ‡å—ï¼Œä½¿ç”¨&nbsp;<strong>OpenSSL</strong>&nbsp;åœ¨æœ¬æœºåˆ›å»ºä¸‰ç±»è¯ä¹¦ï¼š</p>\n<ol class=\"code-line\" dir=\"auto\"><ol class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">è‡ªç­¾å&nbsp;<strong>æ ¹ CAï¼ˆRoot CAï¼‰</strong>ï¼Œ</li>\n<li class=\"code-line\" dir=\"auto\">ç”±æ ¹ CA ç­¾å‘çš„&nbsp;<strong>ä¸­é—´ CAï¼ˆIntermediate CAï¼‰</strong>ï¼Œ</li>\n<li class=\"code-line\" dir=\"auto\">ç”±ä¸­é—´ CA ç­¾å‘çš„&nbsp;<strong>æœåŠ¡å™¨è¯ä¹¦ï¼ˆLeaf/Server Certï¼‰</strong>ã€‚</li>\n</ol></ol>\n<p class=\"code-line\" dir=\"auto\">åŒæ—¶åŒ…å«&nbsp;<code>openssl.cnf</code>&nbsp;çš„ç¤ºä¾‹ã€è¯ä¹¦é“¾éªŒè¯å‘½ä»¤ï¼Œä»¥åŠç”Ÿæˆ<strong>åŒ…å«ä¸‰å¼ è¯ä¹¦</strong>ï¼ˆæœåŠ¡å™¨ + ä¸­é—´ + æ ¹ï¼‰çš„&nbsp;<strong>PFX</strong>&nbsp;åŒ…çš„åšæ³•ã€‚</p>\n<p class=\"code-line\" dir=\"auto\">ç”Ÿæˆçš„æ­¥éª¤å¦‚ä¸‹æµç¨‹å›¾æ‰€ç¤ºã€‚</p>\n<p><img alt=\"image\" class=\"lazyload\" height=\"664\" width=\"666\" /></p>\n<h2>ç¬¬ä¸€æ­¥ï¼šå®‰è£…OpenSSL</h2>\n<p>ä¸‹è½½è·¯å¾„ï¼š<a href=\"https://openssl-library.org/source/\" rel=\"noopener nofollow\" target=\"_blank\">Downloads | OpenSSL Library</a>, Windows ç¯å¢ƒä¸­ç›´æ¥ä¸‹è½½æœ€æ–°çš„&nbsp;.tar.gz æ–‡ä»¶ï¼Œæœ¬åœ°è§£å‹åå¯ç›´æ¥ä½¿ç”¨</p>\n<p>PS: æœ€å¥½åœ¨PATHç¯å¢ƒå˜é‡ä¸­æ·»åŠ OpenSSLçš„è·¯å¾„ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚</p>\n<p>&nbsp;</p>\n<h2>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºé…ç½®æ–‡ä»¶ openssl.cnf</h2>\n<p>å‡†å¤‡ä¸€ä¸ªç”ŸæˆåŠå­˜æ”¾è¯ä¹¦çš„ç›®å½•ï¼Œç„¶ååˆ›å»ºopenssl.cnfæ–‡ä»¶ï¼Œå¦‚ï¼š</p>\n<blockquote>\n<div>mkdir certs_1 &amp;&amp; cd certs_1</div>\n</blockquote>\n<div>åˆå§‹åŒ–çš„openssl.cnfå†…å®¹å¦‚ä¸‹ï¼Œéœ€è¦æ›¿æ¢åŸŸåå’Œç»„ç»‡ä¿¡æ¯</div>\n<div>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:csharp;gutter:true;\"># ----- Basic req settings -----\n[ req ]\ndefault_bits        = 2048\nprompt              = no\ndistinguished_name  = dn\nreq_extensions      = req_ext\n\n<span style=\"background-color: rgba(255, 255, 0, 1);\">[ dn ]\nC   = CN\nST  = CQ\nL   = CQ\nO   = SelfCA Org\nOU  = CertOps\nCN  = myself.com</span>\n\n# CSR-time extra extensions (used by: -reqexts req_ext)\n[ req_ext ]\nsubjectAltName = @alt_names\n\n<span style=\"background-color: rgba(255, 255, 0, 1);\">[ alt_names ]\nDNS.1 = *.myself.com\nDNS.2 = www.myself.com</span>\n\n# ----- Root CA certificate extensions -----\n[ v3_root_ca ]\nsubjectKeyIdentifier = hash\nauthorityKeyIdentifier = keyid:always,issuer\nbasicConstraints = critical, CA:TRUE, pathlen:1\nkeyUsage = critical, keyCertSign, cRLSign\n\n# ----- Intermediate CA certificate extensions -----\n[ v3_intermediate_ca ]\nsubjectKeyIdentifier = hash\nauthorityKeyIdentifier = keyid:always,issuer\nbasicConstraints = critical, CA:TRUE, pathlen:0\nkeyUsage = critical, keyCertSign, cRLSign\n\n# ----- Server (leaf) certificate extensions -----\n[ server_cert ]\nsubjectKeyIdentifier = hash\nauthorityKeyIdentifier = keyid,issuer\nbasicConstraints = CA:FALSE\nkeyUsage = critical, digitalSignature, keyEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = @alt_names\n\n# CSR-time server req (used with: -reqexts server_req)\n[ server_req ]\nbasicConstraints = CA:FALSE\nkeyUsage = digitalSignature, keyEncipherment\nextendedKeyUsage = serverAuth</pre>\n</div>\n</div>\n<h2>ç¬¬ä¸‰æ­¥ï¼šç”Ÿæˆ<span style=\"color: rgba(255, 102, 0, 1);\"><strong>æ ¹CA</strong></span>ç§é’¥å’Œè¯ä¹¦</h2>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:csharp;gutter:true;\"># ç”Ÿæˆæ ¹ CA ç§é’¥ï¼ˆåŠ å¯†ç§é’¥éœ€è¾“å…¥å£ä»¤ï¼›å¦‚ä¸åŠ å¯†å»æ‰ -aes256ï¼‰\nopenssl genrsa -aes256 -out rootCA.key 4096\n\n# ç”Ÿæˆæ ¹ CA çš„ CSRï¼ˆå¯ç›´æ¥è‡ªç­¾ï¼›CN å¯å†™ç»„ç»‡åæˆ– \"Example Root CA\"ï¼‰\nopenssl req -new -sha256 -key rootCA.key -out rootCA.csr -subj \"/C=CN/ST=CQ /O=SelfCA Org/CN=My Self Root CA\" -config openssl.cnf\n\n# ä½¿ç”¨ X.509 è‡ªç­¾ç”Ÿæˆæ ¹ CA è¯ä¹¦ï¼ˆ10 å¹´æœ‰æ•ˆæœŸä¸¾ä¾‹ï¼‰\nopenssl x509 -req -sha256 -days 3650 -in rootCA.csr -signkey rootCA.key -out rootCA.crt -extfile openssl.cnf -extensions v3_root_ca</pre>\n</div>\n<h2>ç¬¬å››æ­¥ï¼šç”Ÿæˆ<span style=\"color: rgba(255, 102, 0, 1);\">ä¸­é—´<strong>CA</strong></span>ç§é’¥å’Œè¯ä¹¦</h2>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:csharp;gutter:true;\">#ç”Ÿæˆä¸­é—´ CA ç§é’¥ä¸ CSR\n\nopenssl genrsa -out interCA.key 4096 openssl req -new -sha256 -key interCA.key -out interCA.csr -subj \"/C=CN/ST=CQ/O=Self Intermediate Org/CN=My Self Intermediate CA\" -config openssl.cnf\n<br />\n# ç”¨æ ¹ CA ç­¾å‘ä¸­é—´ CA è¯ä¹¦\n# é€šè¿‡æ ¹ CA ä¸ºä¸­é—´ CA CSR ç­¾åï¼Œå¹¶æŒ‡å®šä¸­é—´ CA æ‰©å±•ï¼ˆpathlen=0/1 è§†éœ€æ±‚ï¼‰\n\nopenssl x509 -req -sha256 -days 1825 -in interCA.csr -CA rootCA.crt -CAkey rootCA.key -CAcreateserial -out interCA.crt -extfile openssl.cnf -extensions v3_intermediate_ca </pre>\n</div>\n<h2>ç¬¬äº”æ­¥ï¼šç”Ÿæˆ<span style=\"color: rgba(255, 102, 0, 1);\">æœåŠ¡å™¨</span>ç§é’¥å’Œè¯ä¹¦</h2>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:csharp;gutter:true;\"># ç”ŸæˆæœåŠ¡å™¨ç§é’¥ä¸ CSRï¼ˆå« SANï¼‰\nopenssl genrsa -out server.key 2048\n\n# ç”Ÿæˆ CSRï¼Œå¹¶åœ¨ -req æ‰©å±•ä¸­å£°æ˜ SANï¼ˆåœ¨ openssl.cnf çš„ [server_req] ä¸ [alt_names] ä¸­å®šä¹‰ï¼‰\nopenssl req -new -sha256 -key server.key -out server.csr   -subj \"/C=CN/ST=CQ/O=My Self Server Org/CN=*.mytest.com\"   -config openssl.cnf -reqexts server_req\n\n# ç”¨ä¸­é—´ CA ä¸ºæœåŠ¡å™¨ CSR ç­¾å\nopenssl x509 -req -sha256 -days 825   -in server.csr   -CA interCA.crt -CAkey interCA.key -CAcreateserial   -out server.crt   -extfile openssl.cnf -extensions server_cert</pre>\n<p>&nbsp;</p>\n</div>\n<p>ç¬¬ä¸‰ï¼Œå››ï¼Œäº”æ­¥çš„å®éªŒç»“æœå¦‚å›¾ï¼š</p>\n<p><img alt=\"image\" class=\"lazyload\" height=\"231\" width=\"666\" /></p>\n<h2>ç¬¬å…­æ­¥ï¼šåˆå¹¶è¯ä¹¦é“¾</h2>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:csharp;gutter:true;\"># æ„é€ å®Œæ•´è¯ä¹¦é“¾æ–‡ä»¶ï¼ˆIntermediate + Rootï¼‰\n\ntype interCA.crt rootCA.crt &gt; chain.crt\n\n# éªŒè¯ server.crt æ˜¯å¦èƒ½ç”± chain.crtï¼ˆä¸­é—´+æ ¹ï¼‰æ„æˆå®Œæ•´ä¿¡ä»»é“¾\n\nopenssl verify -CAfile chain.crt server.crt</pre>\n</div>\n<h2>ç¬¬ä¸ƒæ­¥ï¼šç”ŸæˆPFXæ–‡ä»¶</h2>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:csharp;gutter:true;\"># å°†ä¸­é—´+æ ¹åˆå¹¶ä¸º chain.crt åä¸€èµ·å¯¼å…¥\nopenssl pkcs12 -export -out server_fullchain.pfx   -inkey server.key -in server.crt   -certfile chain.crt   -name \"My Self Full Server Cert\"   -passout pass:xxxxxxxxx\n</pre>\n</div>\n<p>æœ€ç»ˆæ‰€ç”Ÿæˆçš„è¯ä¹¦æ–‡ä»¶å±•ç¤ºï¼š</p>\n<p><img alt=\"image\" class=\"lazyload\" height=\"546\" width=\"666\" /></p>\n<p>&nbsp;</p>\n<h1>å‚è€ƒèµ„æ–™</h1>\n<p>openssl å®˜æ–¹æ–‡æ¡£ï¼š<a href=\"https://www.openssl.org/docs/\" rel=\"noopener nofollow\" target=\"_blank\">https://www.openssl.org/docs/</a>&nbsp;</p>\n<p id=\"generate-an-azure-application-gateway-self-signed-certificate-with-a-custom-root-ca\">Generate an Azure Application Gateway self-signed certificate with a custom root CA :&nbsp;<a href=\"https://learn.microsoft.com/en-us/azure/application-gateway/self-signed-certificates\" rel=\"noopener nofollow\" target=\"_blank\">https://learn.microsoft.com/en-us/azure/application-gateway/self-signed-certificates</a></p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<h1>&nbsp;</h1>\n<p>&nbsp;</p>\n<p>&nbsp;&nbsp;</p>\n<p>&nbsp;</p>\n</div>\n<div id=\"MySignature\">\n    <div style=\"background: #1c5f55; height: 36px; width: 618px; padding: 14px 5px 0px 3px;\">\n  <p style=\"font-weight: bold; color: white;\">å½“åœ¨å¤æ‚çš„ç¯å¢ƒä¸­é¢ä¸´é—®é¢˜ï¼Œæ ¼ç‰©ä¹‹é“éœ€ï¼šæµŠè€Œé™ä¹‹å¾æ¸…ï¼Œå®‰ä»¥åŠ¨ä¹‹å¾ç”Ÿã€‚ äº‘ä¸­ï¼Œæ°æ˜¯å¦‚æ­¤!</p>\n</div>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-13 21:08</span>&nbsp;\n<a href=\"https://www.cnblogs.com/lulight\">ç¼–ç è€…å¢å¸ƒ</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">31</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "SpringBoot å®˜å®£åœæ­¢ç»´æŠ¤ 3.2.x~3.4.xï¼",
      "link": "https://www.cnblogs.com/javaguide/p/19479183",
      "published": "",
      "description": "<h2>\n            <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/javaguide/p/19479183\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-13 20:44\">\n    <span>SpringBoot å®˜å®£åœæ­¢ç»´æŠ¤ 3.2.x~3.4.xï¼</span>\n    \n\n</a>\n\n        </h2>\n        <div class=\"postbody\">\n            <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ Guideï¼æŠ€æœ¯çš„è¿­ä»£é€Ÿåº¦æœ‰æ—¶å€™çœŸçš„å¿«åˆ°è®©äººçª’æ¯ã€‚</p>\n<p>å°±åœ¨å‰é˜µå­ï¼Œ<strong>Spring Boot 4.0</strong> æ­£å¼å‘å¸ƒï¼Œ3.2.xã€3.3.x å’Œ 3.4.x è¿™äº› 2024 å¹´å‘å¸ƒçš„ç‰ˆæœ¬å®˜æ–¹å·²ç»ä¸åœ¨ç»´æŠ¤äº†ï¼Œä¹Ÿå°±æ˜¯ä¸å†æä¾›å…è´¹çš„å®‰å…¨æ›´æ–°å’Œé”™è¯¯ä¿®å¤ã€‚</p>\n<p>ä¸‹å›¾æ¥æºäº SpringBoot å®˜æ–¹æ–‡æ¡£ï¼š<strong><a href=\"https://spring.io/projects/spring-boot#support\" rel=\"noopener nofollow\" target=\"_blank\">https://spring.io/projects/spring-boot#support</a></strong> ã€‚</p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/1843652/202601/1843652-20260113204341636-134362817.png\" /></p>\n<p>å…¶å®å½±å“ä¹Ÿä¸å¤§ï¼Œå¾ˆå¤šè€é¡¹ç›®ç›®å‰è¿˜æ˜¯ 2.x ç‰ˆæœ¬ï¼Œç”šè‡³è¿˜æœ‰åœç•™åœ¨ 1.x ç‰ˆæœ¬çš„ã€‚</p>\n<p>å¯¹äºå…¬å¸é¡¹ç›®ï¼Œå¦‚æœèƒ½ç¨³å®šè¿è¡Œï¼Œå°±ä¸å¿…è¦å¼ºè¡Œå»å‡çº§æ–°ç‰ˆæœ¬ã€‚ä½ å‡çº§äº†ï¼Œè€æ¿çœ‹ä¸åˆ°æ•ˆæœï¼Œè¿˜å®¹æ˜“å‡ºç°é—®é¢˜ï¼Œä¸€å‡ºç°é—®é¢˜è¯´ä¸å®šå°±æ˜¯ä½ èƒŒé”…ã€‚</p>\n<p>ä¸è¿‡ï¼Œå¯¹äºæ–°é¡¹ç›®å’Œä¸ªäººé¡¹ç›®æ¥è¯´ï¼Œè¿˜æ˜¯åº”è¯¥å°½é‡ä½¿ç”¨ç›¸å¯¹è¾ƒæ–°ä¸”ç¨³å®šçš„ç‰ˆæœ¬ã€‚</p>\n<p><a href=\"https://javaguide.cn/zhuanlan/interview-guide.html\" rel=\"noopener nofollow\" target=\"_blank\">InterviewGuide</a> ï¼ˆåŸºäº Spring Boot 4.0 + Java 21 + Spring AI å¼€å‘çš„ AI ç®€å†åˆ†æå’Œæ¨¡æ‹Ÿé¢è¯•ç³»ç»Ÿï¼‰è¿™ä¸ªé¡¹ç›®æˆ‘å½“æ—¶å›¾çœäº‹å¤åˆ¶äº†ä¸Šä¸€ä¸ªé¡¹ç›®çš„éƒ¨åˆ†ä¾èµ–æ–‡ä»¶ï¼Œå¯¼è‡´ SpringBoot ç‰ˆæœ¬æ˜¯ 3.3ï¼Œç»™è‡ªå·±æ‰¾äº†ä¸€ä¸ªéº»çƒ¦ï¼</p>\n<p>æœ‰ä¸å°‘æœ‹å‹åé¦ˆå»ºè®®å°†å…¶å‡çº§ä¸º 4.0 ç‰ˆæœ¬ï¼Œäºæ˜¯æˆ‘æ˜¨å¤©å°±æŠŠè¿™ä»¶äº‹åšäº†ï¼</p>\n<p>è¿™ä¸€è·¯è¸©äº†ä¸å°‘å‘ï¼Œå°¤å…¶æ˜¯ Jackson 3 çš„åŒ…åå¤§æ”¹ï¼Œç®€ç›´æ˜¯â€œå²è¯—çº§â€çš„ Breaking Changeã€‚ä»Šå¤©å°±æŠŠè¿™ä»½<strong>ç©¿é€å¼å‡çº§æŒ‡å—</strong>åˆ†äº«ç»™å¤§å®¶ï¼Œå»ºè®®æ”¶è—å¤‡ç”¨ï¼</p>\n<p>å…·ä½“çš„æ›´æ–°å†…å®¹å¯ä»¥æŸ¥çœ‹è¿™ä¸ª Commitï¼š<strong><a href=\"https://github.com/Snailclimb/interview-guide/commit/f7bb05980b725c8658f93a4c511bf4b2ec616b82\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/Snailclimb/interview-guide/commit/f7bb05980b725c8658f93a4c511bf4b2ec616b82</a></strong> ã€‚</p>\n<h2 id=\"ä¸ºä»€ä¹ˆè¦å‡çº§\">ä¸ºä»€ä¹ˆè¦å‡çº§ï¼Ÿ</h2>\n<p>Spring Boot 4.0.0 åŸºäº Spring Framework 7.0ï¼Œå…¨é¢æ”¯æŒ Java 25ï¼ˆå«è™šæ‹Ÿçº¿ç¨‹ä¼˜åŒ–ï¼‰ã€‚æ ¸å¿ƒæ–°ç‰¹æ€§åŒ…æ‹¬ï¼šHTTP Service Clients ç®€åŒ–è¿œç¨‹è°ƒç”¨ï¼›åŸç”Ÿ API ç‰ˆæœ¬ç®¡ç†ï¼›å…¨é¢é‡‡ç”¨ JSpecify ç©ºå®‰å…¨ä½“ç³»ï¼ˆé»˜è®¤éç©ºï¼Œç¼–è¯‘æœŸé˜² NPEï¼‰ï¼›å…³é”®ä¾èµ–å‡çº§è‡³ Jackson 3.0ã€Tomcat 11ã€Hibernate 7.1 ç­‰ï¼›æ¨¡å—åŒ–è®¾è®¡æ”¹è¿›ï¼›åŒ–æ”¯æŒ Gradle 9ï¼›Redis é™æ€ä¸»ä»é…ç½®ï¼›ç§»é™¤ Undertowã€‚</p>\n<p>æˆ‘ä¸“é—¨åˆ†äº«è¿‡ä¸€ç¯‡æ–‡ç« ä»‹ç»è¿™äº›æ–°ç‰¹æ€§ï¼š<a href=\"https://zhuanlan.zhihu.com/p/1975242864071026251\" rel=\"noopener nofollow\" target=\"_blank\">Spring Boot 4.0 æ­£å¼å‘å¸ƒï¼Œäººå·²éº»ã€‚ã€‚ã€‚</a>ï¼ˆç¡®å®å·²ç»éº»äº†ï¼‰ã€‚</p>\n<h2 id=\"ç‰ˆæœ¬å˜æ›´æ€»è§ˆ\">ç‰ˆæœ¬å˜æ›´æ€»è§ˆ</h2>\n<p>åœ¨è¿™é‡Œæä¸ªé†’ï¼Œå‡çº§åƒä¸‡åˆ«â€œè·³çº§â€ã€‚å®˜æ–¹å»ºè®®çš„å‡çº§è·¯å¾„ï¼š<strong>3.3/3.4 â†’ 3.5 â†’ 4.0</strong>ï¼Œè¿™æ¡è·¯å¾„èƒ½é¿å… 90% çš„å‘ã€‚</p>\n<table>\n<thead>\n<tr>\n<th>ç»„ä»¶</th>\n<th>å‡çº§å‰</th>\n<th>å‡çº§å</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Spring Boot</td>\n<td>3.3.6</td>\n<td>4.0.1</td>\n</tr>\n<tr>\n<td>Spring Framework</td>\n<td>6.x</td>\n<td>7.x</td>\n</tr>\n<tr>\n<td>Spring AI</td>\n<td>1.1.2</td>\n<td>2.0.0-M1</td>\n</tr>\n<tr>\n<td>Redisson</td>\n<td>3.24.3</td>\n<td>4.0.0</td>\n</tr>\n<tr>\n<td>Gradle</td>\n<td>8.8</td>\n<td>8.14</td>\n</tr>\n<tr>\n<td>Hibernate</td>\n<td>6.x</td>\n<td>7.2.0.Final</td>\n</tr>\n<tr>\n<td>Tomcat</td>\n<td>10.x</td>\n<td>11.0.15</td>\n</tr>\n<tr>\n<td>Jackson</td>\n<td>2.x</td>\n<td>3.x</td>\n</tr>\n<tr>\n<td>iText</td>\n<td>7.2.5</td>\n<td>8.0.5</td>\n</tr>\n<tr>\n<td>MapStruct</td>\n<td>1.5.5.Final</td>\n<td>1.6.3</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å‡çº§æ­¥éª¤è¯¦è§£\">å‡çº§æ­¥éª¤è¯¦è§£</h2>\n<h3 id=\"step-1-å‡çº§-gradle\">Step 1: å‡çº§ Gradle</h3>\n<p>Spring Boot 4.0 è¦æ±‚ Gradle 8.14 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚é¦–å…ˆéœ€è¦å‡çº§ Gradle Wrapperï¼š</p>\n<pre><code class=\"language-bash\"># ä¸´æ—¶ä½¿ç”¨æ—§ç‰ˆæœ¬ Spring Boot æ‰§è¡Œ wrapper å‡çº§å‘½ä»¤\n./gradlew wrapper --gradle-version=8.14\n</code></pre>\n<p>ä¿®æ”¹ <code>gradle/wrapper/gradle-wrapper.properties</code>ï¼š</p>\n<pre><code class=\"language-properties\">distributionUrl=https\\://services.gradle.org/distributions/gradle-8.14-bin.zip\n</code></pre>\n<h3 id=\"step-2-æ›´æ–°ä¾èµ–ç‰ˆæœ¬\">Step 2: æ›´æ–°ä¾èµ–ç‰ˆæœ¬</h3>\n<p>ä¿®æ”¹ <code>gradle/libs.versions.toml</code>ï¼š</p>\n<pre><code class=\"language-toml\">[versions]\nspring-boot = \"4.0.1\"\nspring-ai = \"2.0.0-M1\"\nredisson = \"4.0.0\"\nmapstruct = \"1.6.3\"\naws-sdk = \"2.29.51\"\nitext = \"8.0.5\"\nlombok = \"1.18.36\"\njunit-jupiter = \"5.12.0\"\n\n[plugins]\nspring-boot = { id = \"org.springframework.boot\", version.ref = \"spring-boot\" }\nspring-dependency-management = { id = \"io.spring.dependency-management\", version = \"1.1.7\" }\n</code></pre>\n<p><code>libs.versions.toml</code>æ˜¯ Gradle 7.0 å¼•å…¥å¹¶ä» 7.4 ç‰ˆæœ¬å¼€å§‹æ­£å¼æ¨èçš„ <strong>â€œç‰ˆæœ¬ç›®å½•â€ï¼ˆVersion Catalogï¼‰</strong> æ–‡ä»¶ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>é›†ä¸­ç®¡ç†é¡¹ç›®ä¸­æ‰€æœ‰çš„ä¾èµ–åº“åŠå…¶ç‰ˆæœ¬å·</strong>ã€‚</p>\n<h3 id=\"step-3-æ¨¡å—åŒ–é‡æ„-starter-å˜æ›´\">Step 3: æ¨¡å—åŒ–é‡æ„ (Starter å˜æ›´)</h3>\n<p>Spring Boot 4.0 é‡‡ç”¨äº†æ›´ç»†ç²’åº¦çš„æ¨¡å—åŒ–è®¾è®¡ï¼Œéœ€è¦æ›´æ–° starter ä¾èµ–ï¼š</p>\n<pre><code class=\"language-groovy\">// å‡çº§å‰\nimplementation 'org.springframework.boot:spring-boot-starter-web'\n\n// å‡çº§å\nimplementation 'org.springframework.boot:spring-boot-starter-webmvc'\n</code></pre>\n<p>å®Œæ•´çš„ <code>build.gradle</code> ä¾èµ–å˜æ›´ï¼š</p>\n<pre><code class=\"language-groovy\">dependencies {\n    // Spring Boot Starters (Boot 4.0 modular design)\n    implementation 'org.springframework.boot:spring-boot-starter-webmvc'\n    implementation 'org.springframework.boot:spring-boot-starter-validation'\n    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'\n\n    // Spring AI 2.0\n    implementation \"org.springframework.ai:spring-ai-starter-model-openai:${libs.versions.spring.ai.get()}\"\n    implementation \"org.springframework.ai:spring-ai-starter-vector-store-pgvector:${libs.versions.spring.ai.get()}\"\n\n    // Redisson 4.0\n    implementation \"org.redisson:redisson-spring-boot-starter:${libs.versions.redisson.get()}\"\n\n    // iText 8\n    implementation \"com.itextpdf:itext-core:${libs.versions.itext.get()}\"\n    implementation \"com.itextpdf:font-asian:${libs.versions.itext.get()}\"\n}\n</code></pre>\n<h3 id=\"step-4-å²ä¸Šæœ€å‘çš„-jackson-3-è¿ç§»\">Step 4: å²ä¸Šæœ€å‘çš„ Jackson 3 è¿ç§»</h3>\n<p>è¿™æ˜¯æœ¬æ¬¡å‡çº§æœ€ç—›è‹¦çš„éƒ¨åˆ†ã€‚Jackson 3 å°†åŒ…åä» <code>com.fasterxml.jackson</code> å…¨é¢æ”¹ä¸ºäº† <code>tools.jackson</code>ã€‚è¿™æ„å‘³ç€ä½ é¡¹ç›®ä¸­æ‰€æœ‰çš„ <code>ObjectMapper</code>ã€<code>JsonNode</code> å¯¼å…¥éƒ½å¤±æ•ˆäº†ã€‚</p>\n<p><strong>éœ€è¦ä¿®æ”¹çš„å¯¼å…¥è¯­å¥ï¼š</strong></p>\n<table>\n<thead>\n<tr>\n<th>å‡çº§å‰</th>\n<th>å‡çº§å</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>com.fasterxml.jackson.databind.ObjectMapper</code></td>\n<td><code>tools.jackson.databind.ObjectMapper</code></td>\n</tr>\n<tr>\n<td><code>com.fasterxml.jackson.core.type.TypeReference</code></td>\n<td><code>tools.jackson.core.type.TypeReference</code></td>\n</tr>\n<tr>\n<td><code>com.fasterxml.jackson.core.JsonProcessingException</code></td>\n<td><code>tools.jackson.core.JacksonException</code></td>\n</tr>\n</tbody>\n</table>\n<p><strong>ç¤ºä¾‹ä»£ç ä¿®æ”¹ï¼š</strong></p>\n<pre><code class=\"language-java\">// å‡çº§å‰\nimport com.fasterxml.jackson.core.JsonProcessingException;\nimport com.fasterxml.jackson.core.type.TypeReference;\nimport com.fasterxml.jackson.databind.ObjectMapper;\n\ntry {\n    String json = objectMapper.writeValueAsString(data);\n} catch (JsonProcessingException e) {\n    // å¤„ç†å¼‚å¸¸\n}\n\n// å‡çº§å\nimport tools.jackson.core.JacksonException;\nimport tools.jackson.core.type.TypeReference;\nimport tools.jackson.databind.ObjectMapper;\n\ntry {\n    String json = objectMapper.writeValueAsString(data);\n} catch (JacksonException e) {\n    // å¤„ç†å¼‚å¸¸\n}\n</code></pre>\n<p>æˆ‘ä»¬éœ€è¦åœ¨ <code>PdfExportService</code>ã€<code>RedisService</code> ç­‰ 7 ä¸ªæ ¸å¿ƒä¸šåŠ¡ç±»ä¸­ï¼Œåˆ©ç”¨ IDE çš„å…¨å±€æ›¿æ¢åŠŸèƒ½ï¼Œå°† <code>com.fasterxml.jackson</code> ç»Ÿä¸€ä¿®æ­£ä¸º <code>tools.jackson</code>ã€‚</p>\n<h3 id=\"step-5-redisson-40-api-è¿ç§»\">Step 5: Redisson 4.0 API è¿ç§»</h3>\n<p>Redisson 4.0 å¯¹éƒ¨åˆ†ç±»è¿›è¡Œäº†åŒ…é‡ç»„ï¼Œ<code>StreamMessageId</code> ç­‰ Stream ç›¸å…³ç±»ç§»è‡³æ–°åŒ…ï¼š</p>\n<pre><code class=\"language-java\">// å‡çº§å‰\nimport org.redisson.api.StreamMessageId;\n\n// å‡çº§å\nimport org.redisson.api.stream.StreamMessageId;\n</code></pre>\n<p>è¿™ä¸ªè¿˜å¥½ç‚¹ï¼Œåªæ¶‰åŠåˆ° 3 ä¸ªç±»ï¼š</p>\n<ul>\n<li><code>infrastructure/redis/RedisService.java</code></li>\n<li><code>modules/resume/listener/AnalyzeStreamConsumer.java</code></li>\n<li><code>modules/knowledgebase/listener/VectorizeStreamConsumer.java</code></li>\n</ul>\n<h2 id=\"éªŒè¯å‡çº§ç»“æœ\">éªŒè¯å‡çº§ç»“æœ</h2>\n<p>å‡çº§å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š</p>\n<pre><code class=\"language-bash\"># ç¼–è¯‘é¡¹ç›®\n./gradlew :app:compileJava\n\n# è¿è¡Œæµ‹è¯•\n./gradlew :app:build\n\n# å¯åŠ¨åº”ç”¨\n./gradlew :app:bootRun\n</code></pre>\n<p>æˆåŠŸå¯åŠ¨åï¼Œæ—¥å¿—åº”æ˜¾ç¤ºï¼š</p>\n<pre><code>  .   ____          _            __ _ _\n /\\\\ / ___'_ __ _ _(_)_ __  __ _ \\ \\ \\ \\\n( ( )\\___ | '_ | '_| | '_ \\/ _` | \\ \\ \\ \\\n \\\\/  ___)| |_)| | | | | || (_| |  ) ) ) )\n  '  |____| .__|_| |_|_| |_\\__, | / / / /\n =========|_|==============|___/=/_/_/_/\n\n :: Spring Boot ::                (v4.0.1)\n\n... Tomcat initialized with port 8080 (http)\n... Starting Servlet engine: [Apache Tomcat/11.0.15]\n... Redisson 4.0.0\n... HHH000001: Hibernate ORM core version 7.2.0.Final\n</code></pre>\n<h2 id=\"å‚è€ƒèµ„æ–™\">å‚è€ƒèµ„æ–™</h2>\n<ul>\n<li><a href=\"https://spring.io/blog/2025/11/20/spring-boot-4-0-0-available-now/\" rel=\"noopener nofollow\" target=\"_blank\">Spring Boot 4.0 å‘å¸ƒå…¬å‘Š</a></li>\n<li><a href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-4.0-Migration-Guide\" rel=\"noopener nofollow\" target=\"_blank\">Spring Boot 4.0 Migration Guide</a></li>\n<li><a href=\"https://spring.io/blog/2025/12/11/spring-ai-2-0-0-M1-available-now/\" rel=\"noopener nofollow\" target=\"_blank\">Spring AI 2.0.0-M1 å‘å¸ƒå…¬å‘Š</a></li>\n<li><a href=\"https://github.com/redisson/redisson/blob/master/CHANGELOG.md\" rel=\"noopener nofollow\" target=\"_blank\">Redisson Changelog</a></li>\n<li><a href=\"https://github.com/FasterXML/jackson/wiki/Jackson-Release-3.0\" rel=\"noopener nofollow\" target=\"_blank\">Jackson 3 Release Notes</a></li>\n</ul>\n<h2 id=\"æ€»ç»“\">æ€»ç»“</h2>\n<p>æœ¬æ¬¡ Spring Boot 4.0 çš„å‡çº§ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>\n<ol>\n<li><strong>æ„å»ºå·¥å…·å‡çº§</strong>ï¼šGradle 8.14+</li>\n<li><strong>æ¨¡å—åŒ–å˜æ›´</strong>ï¼š<code>starter-web</code> â†’ <code>starter-webmvc</code></li>\n<li><strong>Jackson 3 è¿ç§»</strong>ï¼šåŒ…åä» <code>com.fasterxml.jackson</code> æ”¹ä¸º <code>tools.jackson</code></li>\n<li><strong>ç¬¬ä¸‰æ–¹åº“å…¼å®¹</strong>ï¼šRedissonã€Spring AI ç­‰éœ€è¦å‡çº§åˆ°å¯¹åº”çš„å…¼å®¹ç‰ˆæœ¬</li>\n</ol>\n<p>éµå¾ªå®˜æ–¹æ¨èçš„ 3.3 â†’ 3.5 â†’ 4.0 å‡çº§è·¯å¾„ï¼Œå¯ä»¥æ›´å¹³æ»‘åœ°å®Œæˆè¿ç§»ã€‚å‡çº§è¿‡ç¨‹ä¸­é‡åˆ°çš„å¤§å¤šæ•°é—®é¢˜éƒ½ä¸åŒ…åå˜æ›´æœ‰å…³ï¼Œé€šè¿‡å…¨å±€æœç´¢æ›¿æ¢å³å¯è§£å†³ã€‚</p>\n<p><a href=\"https://javaguide.cn/zhuanlan/interview-guide.html\" rel=\"noopener nofollow\" target=\"_blank\">InterviewGuide</a> ä¼ é€é—¨ï¼š</p>\n<ul>\n<li>Github åœ°å€ï¼š<strong><a href=\"https://github.com/Snailclimb/interview-guide\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/Snailclimb/interview-guide</a></strong></li>\n<li>Gitee åœ°å€ï¼š<strong><a href=\"https://gitee.com/SnailClimb/interview-guide\" rel=\"noopener nofollow\" target=\"_blank\">https://gitee.com/SnailClimb/interview-guide</a></strong></li>\n</ul>\n\n</div>\n<div class=\"clear\"></div>\n\n        </div>\n        <p class=\"postfoot\">\n            posted on \n<span id=\"post-date\">2026-01-13 20:44</span>&nbsp;\n<a href=\"https://www.cnblogs.com/javaguide\">JavaGuide</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">120</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n\n        </p>"
    },
    {
      "title": "SpringBoot-shiro-jwt-dubbo-redisåˆ†å¸ƒå¼ç»Ÿä¸€æƒé™ç³»ç»Ÿï¼ˆå®Œç»“ï¼‰",
      "link": "https://www.cnblogs.com/alineverstop/p/19482539",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/alineverstop/p/19482539\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 15:51\">\n    <span>SpringBoot-shiro-jwt-dubbo-redisåˆ†å¸ƒå¼ç»Ÿä¸€æƒé™ç³»ç»Ÿï¼ˆå®Œç»“ï¼‰</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>åˆ†å¸ƒå¼ç»Ÿä¸€æƒé™ç³»ç»Ÿ</p>\n<h1 id=\"è®¾è®¡\">è®¾è®¡</h1>\n<p><img alt=\"2026-1-14-1\" class=\"lazyload\" /></p>\n<p>shiro-mgt:ç”¨æˆ·ã€è§’è‰²ã€èµ„æºçš„å®šä¹‰ï¼Œèµ„æºå¯¹åº”ç½‘å…³çš„å®šä¹‰ï¼ŒåŠ¨æ€é“¾çš„å®šä¹‰</p>\n<p>shiroé‰´æƒæœåŠ¡é›†ç¾¤ï¼šä¼šè¯ä¿¡æ¯ã€Realmä¿¡æ¯</p>\n<p>dubbo-appé›†ç¾¤ï¼šå®é™…ä¸šåŠ¡ç›¸å…³</p>\n<h1 id=\"æ¨¡å—ä¾èµ–\">æ¨¡å—ä¾èµ–</h1>\n<p><img alt=\"2026-1-14-2\" class=\"lazyload\" /></p>\n<p>Springboot-shiro-gateway-handleråŠŸèƒ½ï¼š</p>\n<ol>\n<li>dubboä¸šåŠ¡æœåŠ¡è½¬æ¢httpé€šè®¯</li>\n<li>è®¤è¯ä¸é‰´æƒæœåŠ¡åŒ–æ¶ˆè´¹è€…</li>\n<li>ç”Ÿæˆä¸šåŠ¡æœåŠ¡åŒ–æ¶ˆè´¹è€…</li>\n</ol>\n<p>springboot-shiro-produceråŠŸèƒ½ï¼š</p>\n<ol>\n<li>è®¤è¯ä¸é‰´æƒçš„æœåŠ¡åŒ–ç”Ÿæˆè€…</li>\n</ol>\n<p>springboot-shiro-mgtåŠŸèƒ½ï¼š</p>\n<ol>\n<li>è®¤è¯ä¸é‰´æƒçš„æœåŠ¡åŒ–æ¶ˆè´¹è€…</li>\n</ol>\n<p>springboot-shiro-dubbo-app-handleråŠŸèƒ½ï¼š</p>\n<ol>\n<li>ç”Ÿæˆä¸šåŠ¡æœåŠ¡åŒ–ç”Ÿäº§è€…</li>\n</ol>\n<h1 id=\"åŠ¨æ€è¿‡æ»¤å™¨é“¾\">åŠ¨æ€è¿‡æ»¤å™¨é“¾</h1>\n<p>å®ç°åŠ¨æ€è¿‡æ»¤å™¨é“¾ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯ä»¥ä¸‹å‡ ä¸ªç‰¹æ€§ï¼š</p>\n<p>1ã€æŒä¹…åŒ–ï¼šåŸæœ‰çš„propertieså†…å®¹æ”¾å…¥æ•°æ®åº“ï¼Œ</p>\n<p>2ã€æœ‰åºæ€§ï¼šå› è¿‡æ»¤å™¨é“¾æœ‰åºåŠ è½½çš„ç‰¹æ€§ï¼Œè¯»å–è¿‡æ»¤å™¨é“¾çš„æ—¶ä¿è¯å…¶æœ‰åºæ€§</p>\n<p>3ã€æœåŠ¡åŒ–ï¼šè¿‡æ»¤å™¨é“¾çš„æœåŠ¡åšæˆdubboæœåŠ¡ï¼Œåšåˆ°é›†ä¸­å¼ç®¡ç†</p>\n<p>4ã€åŒæ­¥æ€§ï¼šä¸åŒä¸šåŠ¡ç³»ç»Ÿå¯¹äºè¿‡æ»¤å™¨é“¾çš„åŠ è½½éœ€è¦åŒæ­¥</p>\n<p>5ã€çƒ­åŠ è½½ï¼šè¿‡æ»¤å™¨é“¾ä¿®æ”¹ä¹‹åï¼Œå„ä¸ªä¸šåŠ¡ç³»ç»Ÿä¸éœ€è¦é‡å¯æœåŠ¡ï¼Œä»¥è¾¾åˆ°çƒ­åŠ è½½çš„ç›®çš„</p>\n<h2 id=\"å®ç°æŒä¹…åŒ–æœ‰åºåŒ–\">å®ç°æŒä¹…åŒ–ã€æœ‰åºåŒ–</h2>\n<p>è¿‡æ»¤å™¨é“¾åŒ…å«çš„å­—æ®µï¼š</p>\n<pre><code class=\"language-java\">package com.itheima.shiro.vo;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport org.apache.commons.lang3.builder.ToStringBuilder;\nimport org.apache.commons.lang3.builder.ToStringStyle;\n\nimport java.io.Serializable;\n\n@Data\n@Builder\n@NoArgsConstructor\n@AllArgsConstructor\npublic class FilterChainVo implements Serializable {\n    /**\n     * ä¸»é”®\n     */\n    private String id;\n\n    /**\n     * æè¿°\n     */\n    private String urlName;\n\n    /**\n     * è·¯å¾„\n     */\n    private String url;\n\n    /**\n     * æ‹¦æˆªå™¨åç§°\n     */\n    private String filterName;\n\n    /**\n     * æ‰€éœ€è§’è‰²ï¼Œå¯çœç•¥ï¼Œç”¨é€—å·åˆ†éš”\n     */\n    private String roles;\n\n    /**\n     * æ‰€éœ€æƒé™ï¼Œå¯çœç•¥ï¼Œç”¨é€—å·åˆ†éš”\n     */\n    private String permissions;\n\n    /**\n     * æ’åº\n     */\n    private Integer sortNo;\n\n    private String enableFlag;\n\n    private static final long serialVersionUID = 1L;\n\n    @Override\n    public String toString() {\n        return ToStringBuilder.reflectionToString(this, ToStringStyle.SHORT_PREFIX_STYLE);\n    }\n}\n</code></pre>\n<h2 id=\"å®ç°æœåŠ¡åŒ–\">å®ç°æœåŠ¡åŒ–</h2>\n<p>ç›®çš„ï¼šä½¿æ‰€æœ‰çš„æœåŠ¡å™¨é“¾æŸ¥è¯¢è¯·æ±‚éƒ½é€šè¿‡è¿™ä¸ªæœåŠ¡æ¥è°ƒç”¨ã€‚</p>\n<pre><code class=\"language-java\">package com.itheima.shiro.face;\n\nimport com.itheima.shiro.vo.FilterChainVo;\n\nimport java.util.List;\n\n/**\n * @Descriptionï¼šè¿‡æ»¤å™¨é“¾æœåŠ¡åŒ–æ¥å£\n */\npublic interface FilterChainFace {\n\n    /**\n     * @Description æŸ¥è¯¢æ‰€æœ‰æœ‰æ•ˆçš„è¿‡æ»¤å™¨é“¾\n     */\n    List&lt;FilterChainVo&gt; findFilterChainList();\n}\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.faceImpl;\n\nimport com.itheima.shiro.face.FilterChainFace;\nimport com.itheima.shiro.pojo.FilterChain;\nimport com.itheima.shiro.service.FilterChainService;\nimport com.itheima.shiro.utils.BeanConv;\nimport com.itheima.shiro.utils.EmptyUtil;\nimport com.itheima.shiro.vo.FilterChainVo;\nimport org.apache.dubbo.config.annotation.Service;\nimport org.springframework.beans.factory.annotation.Autowired;\n\nimport java.util.List;\n\n/**\n * @Descriptionï¼šè¿‡æ»¤å™¨é“¾æœåŠ¡åŒ–æ¥å£\n */\n@Service(version = \"1.0.0\",retries = 3,timeout = 5000)\npublic class FilterChainFaceImpl implements FilterChainFace {\n\n    @Autowired\n    FilterChainService filterChainService;\n\n    @Override\n    public List&lt;FilterChainVo&gt; findFilterChainList() {\n        List&lt;FilterChain&gt; filterChainList = filterChainService.findFilterChainList();\n        if (!EmptyUtil.isNullOrEmpty(filterChainList)){\n            // å°†æ•°æ®åº“è¿”å›çš„æ•°æ®ç»“æ„è½¬æ¢æˆæ ‡å‡†çš„è¿‡æ»¤å™¨é“¾æ ¼å¼\n            return BeanConv.toBeanList(filterChainList, FilterChainVo.class);\n        }\n        return null;\n    }\n}\n</code></pre>\n<h2 id=\"å®ç°åŒæ­¥æ€§\">å®ç°åŒæ­¥æ€§</h2>\n<p>å…ˆè¯»å–æ•°æ®åº“çš„è¿‡æ»¤å™¨é“¾ï¼Œè°ƒç”¨ä¸Šé¢filterChainFaceæœåŠ¡</p>\n<ol>\n<li>FilterChainBridgeService:è¿‡æ»¤å™¨é“¾æ¡¥æ¥å™¨serviceæ¥å£å±‚</li>\n<li>FilterChainBridgeServiceImpl:è¿‡æ»¤å™¨é“¾æ¡¥æ¥å™¨serviceæ¥å£å±‚å®ç°</li>\n</ol>\n<p>å°†è¿‡æ»¤å™¨é“¾åŠ è½½åˆ°shiroä¸­</p>\n<ol>\n<li>ShiroFilerChainService:shiroè¿‡æ»¤å™¨é“¾æœåŠ¡åŠ è½½æ¥å£</li>\n<li>ShiroFilerChainService:shiroè¿‡æ»¤å™¨é“¾æœåŠ¡åŠ è½½æ¥å£å®ç°</li>\n</ol>\n<pre><code class=\"language-java\">package com.itheima.shiro.core.bridge;\n\nimport com.itheima.shiro.vo.FilterChainVo;\n\nimport javax.servlet.FilterChain;\nimport java.util.List;\n\n/**\n * @Descriptionï¼šè‡ªå®šä¹‰è¿‡æ»¤å™¨æ¡¥æ¥æ¥å£\n */\npublic interface FilterChainBridgeService {\n\n    /**\n     * @Description æŸ¥è¯¢æ‰€æœ‰æœ‰æ•ˆçš„è¿‡æ»¤å™¨é“¾\n     */\n    List&lt;FilterChainVo&gt; findFilterChainList();\n}\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.client;\n\nimport com.itheima.shiro.core.bridge.FilterChainBridgeService;\nimport com.itheima.shiro.face.FilterChainFace;\nimport com.itheima.shiro.vo.FilterChainVo;\nimport org.apache.dubbo.config.annotation.Reference;\nimport org.springframework.stereotype.Service;\n\nimport java.util.List;\n\n/**\n * @Descriptionï¼šè‡ªå®šä¹‰è¿‡æ»¤å™¨æ¡¥æ¥æ¥å£å®ç°\n */\n@Service(\"filterChainBridgeService\")\npublic class FilterChainBridgeServiceImpl implements FilterChainBridgeService {\n\n    @Reference(version = \"1.0.0\")\n    private FilterChainFace filterChainFace;\n\n    @Override\n    public List&lt;FilterChainVo&gt; findFilterChainList() {\n        return filterChainFace.findFilterChainList();\n    }\n}\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.service;\n\nimport com.itheima.shiro.vo.FilterChainVo;\n\nimport java.util.List;\n\n/**\n * @Descriptionï¼šè¿‡æ»¤å™¨åŒæ­¥æ¥å£\n */\npublic interface ShiroFilerChainService {\n\n    /**\n     * @Description å¯åŠ¨æ—¶ï¼Œå¯åŠ¨å®šæ—¶å™¨ï¼Œæ¯éš”2åˆ†é’ŸåŠ¨æ€åŠ è½½æ•°æ®åº“é‡Œé¢çš„è¿‡æ»¤å™¨é“¾\n     */\n    void init();\n\n    /**\n     * @Description ä½¿ç”¨DefaultFilterChainManagerçš„addToChainæ–¹æ³•æ„å»ºè¿‡æ»¤å™¨é“¾\n     */\n    void initFilterChains(List&lt;FilterChainVo&gt; filterChainVos);\n}\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.service.impl;\n\nimport com.itheima.shiro.core.bridge.FilterChainBridgeService;\nimport com.itheima.shiro.core.impl.CustomDefaultFilterChainManager;\nimport com.itheima.shiro.service.ShiroFilerChainService;\nimport com.itheima.shiro.vo.FilterChainVo;\nimport org.apache.shiro.web.filter.mgt.DefaultFilterChainManager;\nimport org.apache.shiro.web.filter.mgt.NamedFilterList;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport javax.annotation.PostConstruct;\nimport java.util.LinkedHashMap;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.ScheduledExecutorService;\nimport java.util.concurrent.TimeUnit;\n\n/**\n * @Descriptionï¼šè¿‡æ»¤å™¨åŒæ­¥æ¥å£å®ç°\n */\n@Service(\"shiroFilerChainService\")\npublic class ShiroFilerChainServiceImpl implements ShiroFilerChainService {\n\n    //æ³¨å…¥è¿‡æ»¤å™¨é“¾ç®¡ç†è€…\n    @Autowired\n    private CustomDefaultFilterChainManager defaultFilterChainManager;\n\n    //ä½¿ç”¨æ¡¥æ¥å™¨è¯»å–æ•°æ®åº“å†…çš„è¿‡æ»¤å™¨é“¾\n    @Autowired\n    FilterChainBridgeService filterChainBridgeService;\n\n    private Map&lt;String, NamedFilterList&gt; defaultFilterChains;\n\n    //å®šæ—¶å™¨\n    private ScheduledExecutorService executorService = Executors.newScheduledThreadPool(1);\n\n    // æ¯ä¸ªæœåŠ¡å™¨å¯åŠ¨éƒ½ä¼šåŠ è½½è¿™ä¸ªæ–¹æ³•\n    @Override\n    @PostConstruct\n    public void init() {\n        defaultFilterChains = new LinkedHashMap&lt;&gt;();\n        // å»¶æ—¶ä¸º0ï¼Œæ¯120ç§’æ‰§è¡Œä¸€æ¬¡\n        executorService.scheduleAtFixedRate(new Runnable() {\n            @Override\n            public void run() {\n                initFilterChains(filterChainBridgeService.findFilterChainList()) ;\n            }\n        }, 0, 120, TimeUnit.SECONDS);\n    }\n\n    @Override\n    public void initFilterChains(List&lt;FilterChainVo&gt; filterChainVos) {\n\n        //1ã€é¦–å…ˆåˆ é™¤ä»¥å‰è€çš„filterï¼Œæ„å»ºé»˜è®¤çš„è¿‡æ»¤å™¨é“¾\n        defaultFilterChainManager.getFilterChains().clear();\n        //2ã€åŠ è½½è¿‡æ»¤å™¨é“¾\n        for (FilterChainVo urlFilterVo : filterChainVos) {\n            String url = urlFilterVo.getUrl();\n            String filterName = urlFilterVo.getFilterName();\n            String[] filterNames = filterName.split(\",\");\n            for (String name : filterNames) {\n                //æ³¨å†Œæ‰€æœ‰filterï¼ŒåŒ…å«è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨\n                switch(name){\n                    case \"anon\":\n                        defaultFilterChainManager.addToChain(url, name);\n                        break;\n                    case \"authc\":\n                        defaultFilterChainManager.addToChain(url, name);\n                        break;\n                    case \"roles\":\n                        defaultFilterChainManager.addToChain(url, name, urlFilterVo.getRoles());\n                        break;\n                    case \"perms\":\n                        defaultFilterChainManager.addToChain(url, name,urlFilterVo.getPermissions());\n                        break;\n                    case \"role-or\":\n                        defaultFilterChainManager.addToChain(url, name,urlFilterVo.getRoles());\n                        break;\n                    case \"kicked-out\":\n                        defaultFilterChainManager.addToChain(url, name);\n                        break;\n                    case \"jwt-authc\":\n                        defaultFilterChainManager.addToChain(url, name);\n                        break;\n                    case \"jwt-roles\":\n                        defaultFilterChainManager.addToChain(url, name, urlFilterVo.getRoles());\n                        break;\n                    case \"jwt-perms\":\n                        defaultFilterChainManager.addToChain(url, name,urlFilterVo.getPermissions());\n                        break;\n                    default:\n                        break;\n                }\n            }\n        }\n    }\n}\n</code></pre>\n<h2 id=\"å®ç°çƒ­åŠ è½½\">å®ç°çƒ­åŠ è½½</h2>\n<p>ä¸ºäº†å®ç°çƒ­åŠ è½½æˆ‘ä»¬éœ€è¦å®šä¹‰ä»¥ä¸‹3ä¸ªç±»ï¼š</p>\n<ul>\n<li>CustomDefaultFilterChainManager:è‡ªå®šä¹‰çš„é»˜è®¤è¿‡æ»¤å™¨é“¾ç®¡ç†è€…</li>\n<li>CustomPathMatchingFilterChainResolver:è‡ªå®šä¹‰çš„è·¯å¾„åŒ¹é…è¿‡æ»¤å™¨é“¾è§£æå™¨</li>\n<li>CustomShiroFilterFactoryBean:è‡ªå®šä¹‰shiroè¿‡æ»¤å™¨å·¥å‚bean</li>\n</ul>\n<p><strong>CustomDefaultFilterChainManagerï¼šä¸»è¦æ˜¯æŠŠåŸæ¥å¯¹è±¡çš„åˆ›å»ºäº¤äºspringå®¹å™¨ï¼ŒåŒæ—¶æŒ‡å®šè¿‡æ»¤å™¨ï¼Œç„¶åæ„å»ºè¿‡æ»¤å™¨é“¾</strong></p>\n<pre><code class=\"language-java\">package com.itheima.shiro.core.impl;\n\nimport org.apache.shiro.util.StringUtils;\nimport org.apache.shiro.web.filter.AccessControlFilter;\nimport org.apache.shiro.web.filter.authc.AuthenticationFilter;\nimport org.apache.shiro.web.filter.authz.AuthorizationFilter;\nimport org.apache.shiro.web.filter.mgt.DefaultFilterChainManager;\nimport org.apache.shiro.web.filter.mgt.NamedFilterList;\n\nimport javax.annotation.PostConstruct;\nimport javax.servlet.Filter;\nimport java.util.LinkedHashMap;\nimport java.util.Map;\n\n/**\n * @Descriptionï¼šè‡ªå®šä¹‰è¿‡æ»¤å™¨é“¾ç®¡ç†è€…\n */\npublic class CustomDefaultFilterChainManager extends DefaultFilterChainManager {\n\n    //ç™»å½•åœ°å€\n    private String loginUrl;\n    //ç™»å½•æˆåŠŸä¹‹åè·³è½¬åœ°å€\n    private String successUrl;\n    //æœªæˆæƒè·³è½¬åœ°å€\n    private String unauthorizedUrl;\n\n    /**\n     * @Description æ„å»ºè¿‡æ»¤å™¨å’Œè¿‡æ»¤å™¨é“¾çš„mapå¯¹è±¡ï¼ŒåŠ è½½é»˜è®¤çš„è¿‡æ»¤å™¨é“¾\n     */\n    public CustomDefaultFilterChainManager() {\n        setFilters(new LinkedHashMap&lt;String, Filter&gt;());\n        setFilterChains(new LinkedHashMap&lt;String, NamedFilterList&gt;());\n        addDefaultFilters(true);\n    }\n\n    @PostConstruct\n    public void init(){\n        Map&lt;String, Filter&gt; defaultFilters = getFilters();\n        //apply global settings if necessary:\n        for (Filter filter : defaultFilters.values()) {\n            applyGlobalPropertiesIfNecessary(filter);\n        }\n    }\n\n    private void applyGlobalPropertiesIfNecessary(Filter filter) {\n        applyLoginUrlIfNecessary(filter);\n        applySuccessUrlIfNecessary(filter);\n        applyUnauthorizedUrlIfNecessary(filter);\n    }\n\n    private void applyLoginUrlIfNecessary(Filter filter) {\n        String loginUrl = getLoginUrl();\n        if (StringUtils.hasText(loginUrl) &amp;&amp; (filter instanceof AccessControlFilter)) {\n            AccessControlFilter acFilter = (AccessControlFilter) filter;\n            //only apply the login url if they haven't explicitly configured one already:\n            String existingLoginUrl = acFilter.getLoginUrl();\n            if (AccessControlFilter.DEFAULT_LOGIN_URL.equals(existingLoginUrl)) {\n                acFilter.setLoginUrl(loginUrl);\n            }\n        }\n    }\n\n    private void applySuccessUrlIfNecessary(Filter filter) {\n        String successUrl = getSuccessUrl();\n        if (StringUtils.hasText(successUrl) &amp;&amp; (filter instanceof AuthenticationFilter)) {\n            AuthenticationFilter authcFilter = (AuthenticationFilter) filter;\n            //only apply the successUrl if they haven't explicitly configured one already:\n            String existingSuccessUrl = authcFilter.getSuccessUrl();\n            if (AuthenticationFilter.DEFAULT_SUCCESS_URL.equals(existingSuccessUrl)) {\n                authcFilter.setSuccessUrl(successUrl);\n            }\n        }\n    }\n\n    private void applyUnauthorizedUrlIfNecessary(Filter filter) {\n        String unauthorizedUrl = getUnauthorizedUrl();\n        if (StringUtils.hasText(unauthorizedUrl) &amp;&amp; (filter instanceof AuthorizationFilter)) {\n            AuthorizationFilter authzFilter = (AuthorizationFilter) filter;\n            //only apply the unauthorizedUrl if they haven't explicitly configured one already:\n            String existingUnauthorizedUrl = authzFilter.getUnauthorizedUrl();\n            if (existingUnauthorizedUrl == null) {\n                authzFilter.setUnauthorizedUrl(unauthorizedUrl);\n            }\n        }\n    }\n\n    /**\n     * @Description åŠ è½½è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„å¯¹è±¡\n     * @param customFilters è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„mapæ¶æ„\n     * @return\n     */\n    public void setCustomFilters(Map&lt;String,Filter&gt; customFilters){\n        for (Map.Entry&lt;String, Filter&gt; entry : customFilters.entrySet()) {\n            addFilter(entry.getKey(), entry.getValue(), false);\n        }\n\n    }\n\n    /**\n     * @Description ä¸å†ä½¿ç”¨shiroå®¹å™¨å»æ„å»ºï¼Œè€Œæ˜¯äº¤äºspringå»æ„å»º\n     */\n    @Override\n    protected void initFilter(Filter filter) {\n\n    }\n\n    public String getLoginUrl() {\n        return loginUrl;\n    }\n\n    public void setLoginUrl(String loginUrl) {\n        this.loginUrl = loginUrl;\n    }\n\n    public String getSuccessUrl() {\n        return successUrl;\n    }\n\n    public void setSuccessUrl(String successUrl) {\n        this.successUrl = successUrl;\n    }\n\n    public String getUnauthorizedUrl() {\n        return unauthorizedUrl;\n    }\n\n    public void setUnauthorizedUrl(String unauthorizedUrl) {\n        this.unauthorizedUrl = unauthorizedUrl;\n    }\n}\n</code></pre>\n<p>CustomPathMatchingFilterChainResolverè¿™é‡Œä¸»è¦æ ¸å¿ƒå†…å®¹æ˜¯ï¼šæŒ‡å®šä½¿ç”¨è¿‡æ»¤å™¨é“¾ç®¡ç†å™¨ä¸ºè‡ªå·±å®šçš„è¿‡æ»¤å™¨ç®¡ç†å™¨</p>\n<pre><code class=\"language-java\">package com.itheima.shiro.core.impl;\n\nimport lombok.extern.log4j.Log4j2;\nimport org.apache.shiro.web.filter.mgt.FilterChainManager;\nimport org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver;\n\nimport javax.servlet.FilterChain;\nimport javax.servlet.ServletRequest;\nimport javax.servlet.ServletResponse;\n\n/**\n * @Descriptionï¼šè‡ªå®šä¹‰è·¯å¾„è§£æå™¨\n */\n@Log4j2\npublic class CustomPathMatchingFilterChainResolver extends PathMatchingFilterChainResolver {\n\n    private CustomDefaultFilterChainManager defaultFilterChainManager;\n\n    public CustomDefaultFilterChainManager getDefaultFilterChainManager() {\n        return defaultFilterChainManager;\n    }\n\n    public void setDefaultFilterChainManager(CustomDefaultFilterChainManager defaultFilterChainManager) {\n        this.defaultFilterChainManager = defaultFilterChainManager;\n    }\n\n    public FilterChain getChain(ServletRequest request, ServletResponse response, FilterChain originalChain) {\n        //ä¸åœ¨ä½¿ç”¨é»˜è®¤çš„è¿‡æ»¤å™¨é“¾ç®¡ç†è€…ï¼Œè€Œæ˜¯ä½¿ç”¨è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ç®¡ç†è€…\n        FilterChainManager filterChainManager = getDefaultFilterChainManager();\n        if (!filterChainManager.hasChains()) {\n            return null;\n        }\n\n        String requestURI = getPathWithinApplication(request);\n\n        //the 'chain names' in this implementation are actually path patterns defined by the user.  We just use them\n        //as the chain name for the FilterChainManager's requirements\n        for (String pathPattern : filterChainManager.getChainNames()) {\n\n            // If the path does match, then pass on to the subclass implementation for specific checks:\n            if (pathMatches(pathPattern, requestURI)) {\n                if (log.isTraceEnabled()) {\n                    log.trace(\"Matched path pattern [\" + pathPattern + \"] for requestURI [\" + requestURI + \"].  \" +\n                            \"Utilizing corresponding filter chain...\");\n                }\n                return filterChainManager.proxy(originalChain, pathPattern);\n            }\n        }\n\n        return null;\n    }\n}\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.core.impl;\n\nimport lombok.extern.log4j.Log4j2;\nimport org.apache.shiro.mgt.SecurityManager;\nimport org.apache.shiro.spring.web.ShiroFilterFactoryBean;\nimport org.apache.shiro.web.filter.mgt.FilterChainManager;\nimport org.apache.shiro.web.filter.mgt.FilterChainResolver;\nimport org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver;\nimport org.apache.shiro.web.mgt.WebSecurityManager;\nimport org.apache.shiro.web.servlet.AbstractShiroFilter;\nimport org.springframework.beans.factory.BeanInitializationException;\n\n/**\n * @Descriptionï¼šé‡å†™shirodè¿‡æ»¤å™¨å·¥å‚\n */\n@Log4j2\npublic class CustomShiroFilterFactoryBean extends ShiroFilterFactoryBean {\n\n    PathMatchingFilterChainResolver chainResolver ;\n\n    public void setChainResolver(PathMatchingFilterChainResolver chainResolver) {\n        this.chainResolver = chainResolver;\n    }\n\n    protected AbstractShiroFilter createInstance() throws Exception {\n\n        log.debug(\"Creating Shiro Filter instance.\");\n\n        SecurityManager securityManager = getSecurityManager();\n        if (securityManager == null) {\n            String msg = \"SecurityManager property must be set.\";\n            throw new BeanInitializationException(msg);\n        }\n\n        if (!(securityManager instanceof WebSecurityManager)) {\n            String msg = \"The security manager does not implement the WebSecurityManager interface.\";\n            throw new BeanInitializationException(msg);\n        }\n\n        FilterChainManager manager = createFilterChainManager();\n\n        return new SpringShiroFilter((WebSecurityManager) securityManager, chainResolver);\n    }\n\n    private static final class SpringShiroFilter extends AbstractShiroFilter {\n\n        protected SpringShiroFilter(WebSecurityManager webSecurityManager, FilterChainResolver resolver) {\n            super();\n            if (webSecurityManager == null) {\n                throw new IllegalArgumentException(\"WebSecurityManager property cannot be null.\");\n            }\n            setSecurityManager(webSecurityManager);\n            if (resolver != null) {\n                setFilterChainResolver(resolver);\n            }\n        }\n    }\n}\n</code></pre>\n<h3 id=\"shiroconfigä¿®æ”¹\">shiroConfigä¿®æ”¹</h3>\n<pre><code class=\"language-java\">package com.itheima.shiro.config;\n\n\nimport com.itheima.shiro.constant.SuperConstant;\nimport com.itheima.shiro.core.ShiroDbRealm;\nimport com.itheima.shiro.core.filter.*;\nimport com.itheima.shiro.core.impl.*;\nimport com.itheima.shiro.properties.PropertiesUtil;\nimport lombok.extern.log4j.Log4j2;\nimport org.apache.shiro.authc.credential.HashedCredentialsMatcher;\nimport org.apache.shiro.session.mgt.eis.SessionDAO;\nimport org.apache.shiro.spring.LifecycleBeanPostProcessor;\nimport org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor;\nimport org.apache.shiro.spring.web.ShiroFilterFactoryBean;\nimport org.apache.shiro.web.mgt.DefaultWebSecurityManager;\nimport org.apache.shiro.web.servlet.SimpleCookie;\nimport org.redisson.Redisson;\nimport org.redisson.api.RedissonClient;\nimport org.redisson.config.Config;\nimport org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.ComponentScan;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.DependsOn;\n\nimport javax.servlet.Filter;\nimport java.util.HashMap;\nimport java.util.LinkedHashMap;\nimport java.util.List;\nimport java.util.Map;\n\n/**\n * @Description æƒé™é…ç½®ç±»\n */\n@Configuration\n@ComponentScan(basePackages = {\"com.itheima.shiro.core\"})\n@EnableConfigurationProperties({ShiroRedisProperties.class})\n@Log4j2\npublic class ShiroConfig {\n\n    @Autowired\n    private ShiroRedisProperties shiroRedisProperties;\n\n    @Autowired\n    JwtTokenManager jwtTokenManager;\n\n    /**\n     * @Description redissionå®¢æˆ·ç«¯\n     */\n    @Bean(\"redissonClientForShiro\")\n    public RedissonClient redissonClient() {\n        log.info(\"=====åˆå§‹åŒ–redissonClientForShiroå¼€å§‹======\");\n        String[] nodeList = shiroRedisProperties.getNodes().split(\",\");\n        Config config = new Config();\n        if (nodeList.length == 1) {\n            config.useSingleServer().setAddress(nodeList[0])\n                    .setConnectTimeout(shiroRedisProperties.getConnectTimeout())\n                    .setConnectionMinimumIdleSize(shiroRedisProperties.getConnectionMinimumidleSize())\n                    .setConnectionPoolSize(shiroRedisProperties.getConnectPoolSize()).setTimeout(shiroRedisProperties.getTimeout());\n        } else {\n            config.useClusterServers().addNodeAddress(nodeList)\n                    .setConnectTimeout(shiroRedisProperties.getConnectTimeout())\n                    .setMasterConnectionMinimumIdleSize(shiroRedisProperties.getConnectionMinimumidleSize())\n                    .setMasterConnectionPoolSize(shiroRedisProperties.getConnectPoolSize()).setTimeout(shiroRedisProperties.getTimeout());\n        }\n        RedissonClient redissonClient =  Redisson.create(config);\n        log.info(\"=====åˆå§‹åŒ–redissonClientForShiroå®Œæˆ======\");\n        return redissonClient;\n    }\n\n    /**\n     * @Description åˆ›å»ºcookieå¯¹è±¡\n     */\n    @Bean(name=\"sessionIdCookie\")\n    public SimpleCookie simpleCookie(){\n        SimpleCookie simpleCookie = new SimpleCookie();\n        simpleCookie.setName(\"ShiroSession\");\n        return simpleCookie;\n    }\n\n    /**\n     * @Description æƒé™ç®¡ç†å™¨\n     * @param\n     * @return\n     */\n    @Bean(name=\"securityManager\")\n    public DefaultWebSecurityManager defaultWebSecurityManager(){\n        DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();\n        securityManager.setRealm(shiroDbRealm());\n        securityManager.setSessionManager(shiroSessionManager());\n        return securityManager;\n    }\n\n    /**\n     * @Description å¯†ç æ¯”è¾ƒå™¨\n     */\n    @Bean\n    public HashedCredentialsMatcher hashedCredentialsMatcher (){\n        RetryLimitCredentialsMatcher matcher = new RetryLimitCredentialsMatcher(SuperConstant.HASH_ALGORITHM,redissonClient());\n        matcher.setHashIterations(SuperConstant.HASH_INTERATIONS);\n        return matcher;\n    }\n    /**\n     * @Description è‡ªå®šä¹‰RealmImpl\n     */\n    @Bean(name=\"shiroDbRealm\")\n    public ShiroDbRealm shiroDbRealm(){\n        ShiroDbRealm shiroDbRealm =new ShiroDbRealmImpl();\n        shiroDbRealm.setCredentialsMatcher(hashedCredentialsMatcher());\n        return shiroDbRealm;\n    }\n\n\n    /**\n     * @Description è‡ªå®šä¹‰sessionä¼šè¯å­˜å‚¨çš„å®ç°ç±» ï¼Œä½¿ç”¨Redisæ¥å­˜å‚¨å…±äº«sessionï¼Œè¾¾åˆ°åˆ†å¸ƒå¼éƒ¨ç½²ç›®çš„\n     */\n    @Bean(\"redisSessionDao\")\n    public SessionDAO redisSessionDao(){\n        RedisSessionDao sessionDAO =   new RedisSessionDao();\n        sessionDAO.setGlobalSessionTimeout(shiroRedisProperties.getGlobalSessionTimeout());\n        return sessionDAO;\n    }\n\n    /**\n     * @Description ä¼šè¯ç®¡ç†å™¨\n     */\n    @Bean(name=\"sessionManager\")\n    public ShiroSessionManager shiroSessionManager(){\n        ShiroSessionManager sessionManager = new ShiroSessionManager();\n        sessionManager.setSessionDAO(redisSessionDao());\n        sessionManager.setSessionValidationSchedulerEnabled(false);\n        sessionManager.setSessionIdCookieEnabled(true);\n        sessionManager.setSessionIdCookie(simpleCookie());\n        sessionManager.setGlobalSessionTimeout(shiroRedisProperties.getGlobalSessionTimeout());\n        return sessionManager;\n    }\n\n    /**\n     * @Description ä¿è¯å®ç°äº†Shiroå†…éƒ¨lifecycleå‡½æ•°çš„beanæ‰§è¡Œ\n     */\n    @Bean(name = \"lifecycleBeanPostProcessor\")\n    public static LifecycleBeanPostProcessor getLifecycleBeanPostProcessor() {\n        return new LifecycleBeanPostProcessor();\n    }\n\n    /**\n     * @Description AOPå¼æ–¹æ³•çº§æƒé™æ£€æŸ¥\n     */\n    @Bean\n    @DependsOn(\"lifecycleBeanPostProcessor\")\n    public DefaultAdvisorAutoProxyCreator getDefaultAdvisorAutoProxyCreator() {\n        DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator = new DefaultAdvisorAutoProxyCreator();\n        defaultAdvisorAutoProxyCreator.setProxyTargetClass(true);\n        return defaultAdvisorAutoProxyCreator;\n    }\n\n    /**\n     * @Description é…åˆDefaultAdvisorAutoProxyCreatoräº‹é¡¹æ³¨è§£æƒé™æ ¡éªŒ\n     */\n    @Bean\n    public AuthorizationAttributeSourceAdvisor getAuthorizationAttributeSourceAdvisor() {\n        AuthorizationAttributeSourceAdvisor aasa = new AuthorizationAttributeSourceAdvisor();\n        aasa.setSecurityManager(defaultWebSecurityManager());\n        return new AuthorizationAttributeSourceAdvisor();\n    }\n\n    /**\n     * @Description è‡ªå®šä¹‰è¿‡æ»¤å™¨å®šä¹‰\n     */\n    private Map&lt;String, Filter&gt; filters() {\n        Map&lt;String, Filter&gt; map = new HashMap&lt;String, Filter&gt;();\n        map.put(\"role-or\", new RolesOrAuthorizationFilter());\n        map.put(\"kicked-out\", new KickedOutAuthorizationFilter(redissonClient(), redisSessionDao(), shiroSessionManager()));\n        map.put(\"jwt-authc\", new JwtAuthcFilter(jwtTokenManager));\n        map.put(\"jwt-perms\", new JwtPermsFilter());\n        map.put(\"jwt-roles\", new JwtRolesFilter());\n        return map;\n    }\n\n\t// ===========================ä»¥ä¸‹æ˜¯ä¿®æ”¹éƒ¨åˆ†================================\n\n    @Bean\n    public CustomDefaultFilterChainManager defaultFilterChainManager(){\n        CustomDefaultFilterChainManager defaultFilterChainManager = new CustomDefaultFilterChainManager();\n        defaultFilterChainManager.setCustomFilters(filters());\n        defaultFilterChainManager.setLoginUrl(\"/login\");\n        defaultFilterChainManager.setSuccessUrl(\"/home\");\n        defaultFilterChainManager.setUnauthorizedUrl(\"/login\");\n        return defaultFilterChainManager;\n    }\n\n    @Bean\n    public CustomPathMatchingFilterChainResolver chainResolver(){\n        CustomPathMatchingFilterChainResolver chainResolver = new CustomPathMatchingFilterChainResolver();\n        //æŒ‡å®šè¿‡æ»¤å™¨ç®¡ç†è€…\n        chainResolver.setDefaultFilterChainManager(defaultFilterChainManager());\n        return chainResolver;\n    }\n    /**\n     * @Description Shiroè¿‡æ»¤å™¨\n     */\n    @Bean(\"shiroFilter\")\n    public ShiroFilterFactoryBean shiroFilterFactoryBean(){\n        CustomShiroFilterFactoryBean shiroFilter = new CustomShiroFilterFactoryBean();\n        shiroFilter.setChainResolver(chainResolver());\n        shiroFilter.setSecurityManager(defaultWebSecurityManager());\n        return shiroFilter;\n    }\n\n}\n</code></pre>\n<h1 id=\"shiro-clientå®¢æˆ·ç«¯\">shiro-clientå®¢æˆ·ç«¯</h1>\n<p>shiro-clientä½œä¸ºjarçš„ä¾èµ–ï¼Œæ»¡è¶³ä»¥ä¸‹éœ€æ±‚ï¼š</p>\n<p>1ã€éä¾µå…¥å¼ï¼šä½¿ç”¨è€…åªéœ€è¦å¯¹jarä¾èµ–å’Œåšå°‘é‡çš„é…ç½®ï¼Œå°±å¯ä»¥è¾¾åˆ°ç»Ÿä¸€é‰´æƒçš„ç›®æ ‡</p>\n<p>2ã€å¯æ‰©å±•æ€§ï¼šç”¨æˆ·é™¤ä½¿ç”¨æä¾›çš„è¿‡æ»¤å™¨å¤–ï¼Œå¯ä»¥è½»æ¾å®‰è‡ªå·±çš„ä¸šåŠ¡åŒºå®šä¹‰è¿‡æ»¤å™¨</p>\n<p>3ã€é›†ä¸­å¼ç®¡ç†ï¼šä¾èµ–jarä¹‹åï¼Œshiro-mgtåå°å¯ä»¥åŒæ—¶ç®¡æ§å¤šä¸ªå¹³å°çš„æƒé™çš„è®¤è¯ã€é‰´æƒã€åŠåŠ¨æ€é…ç½®è¿‡æ»¤å™¨é“¾</p>\n<h2 id=\"ä¾èµ–å…³ç³»\">ä¾èµ–å…³ç³»</h2>\n<p><img alt=\"1582688991837\" class=\"lazyload\" /></p>\n<h2 id=\"åŸç†åˆ†æ\">åŸç†åˆ†æ</h2>\n<p>springboot-shiro-framework-clienté¡¹ç›®å‘ä¸Šç»§æ‰¿äº†springboot-shiro-framework-coreé¡¹ç›®ï¼Œspringboot-shiro-framework-coreæ˜¯ä¸»è¦å®ç°è®¤è¯ã€é‰´æƒã€è¿‡æ»¤å™¨å®šä¹‰ã€ä¼šè¯ç»Ÿä¸€ã€realmç¼“å­˜çš„æ ¸å¿ƒé¡¹ç›®ã€‚</p>\n<p>springboot-shiro-framework-clienté¡¹ç›®ä»¥jarçš„æ–¹å¼è¢«éœ€è¦åšæƒé™æ§åˆ¶çš„gatewayé¡¹ç›®æ‰€ä¾èµ–ï¼Œå†ç”±gatewayé€šè¿‡å¯¹springboot-shiro-producerçš„dubboæ¶ˆè´¹ï¼Œä»¥è¾¾åˆ°ç»Ÿä¸€è®¤è¯ã€é‰´æƒ</p>\n<p>springboot-shiro-framework-clientæ¨¡å—å®ç°äº†springboot-shiro-framework-coreæ¥å£çš„3ä¸ªç±»ï¼š</p>\n<p>UserBridgeServiceImpl:æä¾›ç”¨æˆ·åŸºæœ¬èµ„æºæ“ä½œçš„ä¸šåŠ¡å®ç°<br />\nFilterChainBridgeServiceImpl:æä¾›è¿‡æ»¤å™¨é“¾æ¥å£çš„æŸ¥è¯¢<br />\nResourceBridgeServiceImpl:æä¾›èµ„æºæŸ¥è¯¢</p>\n<pre><code class=\"language-java\">package com.itheima.shiro.client;\n\nimport com.itheima.shiro.core.bridge.FilterChainBridgeService;\nimport com.itheima.shiro.face.FilterChainFace;\nimport com.itheima.shiro.vo.FilterChainVo;\nimport org.apache.dubbo.config.annotation.Reference;\nimport org.springframework.stereotype.Service;\n\nimport java.util.List;\n\n/**\n * @Descriptionï¼šè‡ªå®šä¹‰è¿‡æ»¤å™¨æ¡¥æ¥æ¥å£å®ç°\n */\n@Service(\"filterChainBridgeService\")\npublic class FilterChainBridgeServiceImpl implements FilterChainBridgeService {\n\n    @Reference(version = \"1.0.0\")\n    private FilterChainFace filterChainFace;\n\n    @Override\n    public List&lt;FilterChainVo&gt; findFilterChainList() {\n        return filterChainFace.findFilterChainList();\n    }\n}\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.client;\n\nimport com.itheima.shiro.core.bridge.ResourceBridgeService;\nimport com.itheima.shiro.face.ResourceAdapterFace;\nimport com.itheima.shiro.vo.ResourceVo;\nimport org.apache.dubbo.config.annotation.Reference;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport java.util.List;\n\n/**\n * @Descriptionï¼šç½‘å…³èµ„æºæ¡¥æ¥å™¨æ¥å£å®ç°\n */\n@Component(\"resourceBridgeService\")\npublic class ResourceBridgeServiceImpl implements ResourceBridgeService {\n\n    @Value(\"${itheima.resource.systemcode}\")\n    private String systemCode;\n\n    @Reference(version = \"1.0.0\")\n    ResourceAdapterFace resourceAdapterFace;\n\n    @Override\n    public List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode) {\n        return resourceAdapterFace.findValidResourceVoAll(systemCode);\n    }\n}\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.client;\n\nimport com.itheima.shiro.constant.CacheConstant;\nimport com.itheima.shiro.core.SimpleCacheService;\nimport com.itheima.shiro.core.base.ShiroUser;\nimport com.itheima.shiro.core.base.SimpleMapCache;\nimport com.itheima.shiro.core.base.SimpleToken;\nimport com.itheima.shiro.core.bridge.UserBridgeService;\nimport com.itheima.shiro.face.UserAdapterFace;\nimport com.itheima.shiro.utils.BeanConv;\nimport com.itheima.shiro.utils.EmptyUtil;\nimport com.itheima.shiro.utils.ShiroUserUtil;\nimport com.itheima.shiro.vo.ResourceVo;\nimport com.itheima.shiro.vo.RoleVo;\nimport com.itheima.shiro.vo.UserVo;\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.dubbo.config.annotation.Reference;\nimport org.apache.shiro.authc.AuthenticationInfo;\nimport org.apache.shiro.authc.AuthenticationToken;\nimport org.apache.shiro.authc.SimpleAuthenticationInfo;\nimport org.apache.shiro.authc.UnknownAccountException;\nimport org.apache.shiro.authz.SimpleAuthorizationInfo;\nimport org.apache.shiro.util.ByteSource;\nimport org.redisson.api.RBucket;\nimport org.redisson.api.RedissonClient;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.concurrent.TimeUnit;\n\n\n/**\n * @Description æƒé™æ¡¥æ¥å™¨\n */\n@Slf4j\n@Component(\"userBridgeService\")\npublic class UserBridgeServiceImpl implements UserBridgeService {\n\n    @Reference(version = \"1.0.0\")\n    private UserAdapterFace userAdapterFace;\n\n    @Autowired\n    private SimpleCacheService simpleCacheService;\n\n    @javax.annotation.Resource(name = \"redissonClientForShiro\")\n    private RedissonClient redissonClient;\n\n    public AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authcToken,String realmName) {\n        SimpleToken token = (SimpleToken)authcToken;\n        UserVo user  = this.findUserByLoginName(token.getUsername());\n        if(EmptyUtil.isNullOrEmpty(user)){\n            throw new UnknownAccountException(\"è´¦å·ä¸å­˜åœ¨\");\n        }\n        ShiroUser shiroUser = BeanConv.toBean(user, ShiroUser.class);\n        String sessionId = ShiroUserUtil.getShiroSessionId();\n        String cacheKeyResourcesIds = CacheConstant.RESOURCES_KEY_IDS+sessionId;\n        shiroUser.setResourceIds(this.findResourcesIdsList(cacheKeyResourcesIds,user.getId()));\n        String salt = user.getSalt();\n        String password = user.getPassWord();\n        return new SimpleAuthenticationInfo(shiroUser, password, ByteSource.Util.bytes(salt), realmName);\n    }\n\n    @Override\n    public SimpleAuthorizationInfo getAuthorizationInfo(ShiroUser shiroUser) {\n        UserVo user = BeanConv.toBean(shiroUser, UserVo.class);\n        SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();\n        String sessionId = ShiroUserUtil.getShiroSessionId();\n        //æŸ¥è¯¢ç”¨æˆ·æ‹¥æœ‰çš„è§’è‰²\n        String cacheKeyRole = CacheConstant.ROLE_KEY + sessionId;\n        info.addRoles(this.findRoleList(cacheKeyRole, user.getId()));\n\n        //æŸ¥è¯¢ç”¨æˆ·æ‹¥æœ‰çš„èµ„æº\n        String cacheKeyResources = CacheConstant.RESOURCES_KEY + sessionId;\n        info.addStringPermissions(this.findResourcesList(cacheKeyResources, user.getId()));\n        return info;\n    }\n\n\n    @Override\n    public List&lt;String&gt; findRoleList(String cacheKeyRole, String userId) {\n        List&lt;RoleVo&gt; roles = new ArrayList&lt;RoleVo&gt;();\n        if (simpleCacheService.getCache(cacheKeyRole) != null) {\n            roles = (List&lt;RoleVo&gt;) simpleCacheService.getCache(cacheKeyRole).get(cacheKeyRole);\n        } else {\n            roles = userAdapterFace.findRoleByUserId(userId);\n            if (roles.size() &gt; 0) {\n                //ç”¨æˆ·è§’è‰²å­˜æ”¾åˆ°map\n                Map&lt;Object, Object&gt; mapRole = new HashMap&lt;Object, Object&gt;();\n                mapRole.put(cacheKeyRole, roles);\n                //æ–°å»ºSimpleMapCacheå®ä¾‹å¹¶æ”¾å…¥ç¼“å­˜ç®¡ç†å™¨\n                SimpleMapCache cacheRole = new SimpleMapCache(cacheKeyRole, mapRole);\n                simpleCacheService.creatCache(cacheKeyRole, cacheRole);\n            }\n        }\n        List&lt;String&gt; rolesLabel = new ArrayList&lt;String&gt;();\n        for (RoleVo role : roles) {\n            rolesLabel.add(role.getLabel());\n        }\n        return rolesLabel;\n    }\n\n\n    @Override\n    public List&lt;String&gt; findResourcesList(String cacheKeyResources,String userId) {\n        List&lt;ResourceVo&gt; resourcesList = new ArrayList&lt;ResourceVo&gt;();\n        if (simpleCacheService.getCache(cacheKeyResources) != null) {\n            resourcesList = (List&lt;ResourceVo&gt;) simpleCacheService.getCache(cacheKeyResources).get(cacheKeyResources);\n        } else {\n            resourcesList = userAdapterFace.findResourceByUserId(userId);\n            if (resourcesList.size() &gt; 0) {\n                //ç”¨æˆ·èµ„æºå­˜æ”¾åˆ°map\n                Map&lt;Object, Object&gt; mapResource = new HashMap&lt;Object, Object&gt;();\n                mapResource.put(cacheKeyResources, resourcesList);\n                //æ–°å»ºSimpleMapCacheå®ä¾‹å¹¶æ”¾å…¥ç¼“å­˜ç®¡ç†å™¨\n                SimpleMapCache cacheResource = new SimpleMapCache(cacheKeyResources, mapResource);\n                simpleCacheService.creatCache(cacheKeyResources, cacheResource);\n            }\n        }\n        List&lt;String&gt; resourcesLabel = new ArrayList&lt;String&gt;();\n        for (ResourceVo resources : resourcesList) {\n            resourcesLabel.add(resources.getLabel());\n        }\n        return resourcesLabel;\n    }\n\n\n    @Override\n    public UserVo findUserByLoginName(String loginName) {\n        String key = CacheConstant.FIND_USER_BY_LOGINNAME+loginName;\n        RBucket&lt;UserVo&gt; rBucket = redissonClient.getBucket(key);\n        UserVo user = rBucket.get();\n        if (!EmptyUtil.isNullOrEmpty(user)) {\n            return user;\n        }else {\n            user = userAdapterFace.findUserByLoginName(loginName);\n            if (!EmptyUtil.isNullOrEmpty(user)) {\n                rBucket.set(user, 300, TimeUnit.SECONDS);\n                return user;\n            }\n        }\n        rBucket.set(new UserVo(), 3, TimeUnit.SECONDS);\n        return null;\n    }\n\n    @Override\n    public List&lt;String&gt; findResourcesIdsList(String cacheKeyResources,String userId) {\n        List&lt;ResourceVo&gt; resourcesList = new ArrayList&lt;ResourceVo&gt;();\n        if (simpleCacheService.getCache(cacheKeyResources) != null) {\n            resourcesList = (List&lt;ResourceVo&gt;) simpleCacheService.getCache(cacheKeyResources).get(cacheKeyResources);\n        } else {\n            resourcesList = userAdapterFace.findResourceByUserId(userId);\n            if (resourcesList.size() &gt; 0) {\n                //ç”¨æˆ·èµ„æºå­˜æ”¾åˆ°map\n                Map&lt;Object, Object&gt; mapResource = new HashMap&lt;Object, Object&gt;();\n                mapResource.put(cacheKeyResources, resourcesList);\n                //æ–°å»ºSimpleMapCacheå®ä¾‹å¹¶æ”¾å…¥ç¼“å­˜ç®¡ç†å™¨\n                SimpleMapCache cacheResource = new SimpleMapCache(cacheKeyResources, mapResource);\n                simpleCacheService.creatCache(cacheKeyResources, cacheResource);\n            }\n        }\n        List&lt;String&gt; resourcesLabel = new ArrayList&lt;String&gt;();\n        for (ResourceVo resources : resourcesList) {\n            resourcesLabel.add(resources.getId());\n        }\n        return resourcesLabel;\n    }\n\n    @Override\n    public void loadUserAuthorityToCache(ShiroUser user) {\n        String sessionId = user.getSessionId();\n        List&lt;RoleVo&gt; roles = userAdapterFace.findRoleByUserId(user.getId());\n        //åˆ›å»ºè§’è‰²cachaeKey\n        String cacheKeyRole = CacheConstant.ROLE_KEY + sessionId;\n        //ç”¨æˆ·è§’è‰²å­˜æ”¾åˆ°map\n        Map&lt;Object, Object&gt; mapRole = new HashMap&lt;Object, Object&gt;();\n        mapRole.put(cacheKeyRole, roles);\n        //æ–°å»ºSimpleMapCacheå®ä¾‹å¹¶æ”¾å…¥ç¼“å­˜ç®¡ç†å™¨\n        SimpleMapCache cacheRole = new SimpleMapCache(cacheKeyRole, mapRole);\n        simpleCacheService.creatCache(cacheKeyRole, cacheRole);\n\n        List&lt;ResourceVo&gt; resourcesList = userAdapterFace.findResourceByUserId(user.getId());\n        if (resourcesList.size() &gt; 0) {\n            //åˆ›å»ºèµ„æºcachaeKey\n            String cacheKeyResources = CacheConstant.RESOURCES_KEY + sessionId;\n            //ç”¨æˆ·èµ„æºå­˜æ”¾åˆ°map\n            Map&lt;Object, Object&gt; mapResource = new HashMap&lt;Object, Object&gt;();\n            mapResource.put(cacheKeyResources, resourcesList);\n            //æ–°å»ºSimpleMapCacheå®ä¾‹å¹¶æ”¾å…¥ç¼“å­˜ç®¡ç†å™¨\n            SimpleMapCache cacheResource = new SimpleMapCache(cacheKeyResources, mapResource);\n            simpleCacheService.creatCache(cacheKeyResources, cacheResource);\n        }\n    }\n}\n</code></pre>\n<h1 id=\"shiro-gatewayç½‘å…³\">shiro-gatewayç½‘å…³</h1>\n<h2 id=\"åŸç†åˆ†æ-1\">åŸç†åˆ†æ</h2>\n<p><img alt=\"1582880165581\" class=\"lazyload\" /></p>\n<p>â€‹\t1ã€ä¾èµ–springboot-shiro-framework-clientå®ç°è®¤è¯ã€é‰´æƒã€è¿‡æ»¤å™¨å®šä¹‰ã€ä¼šè¯ç»Ÿä¸€ã€realmç¼“å­˜ç­‰åŠŸèƒ½</p>\n<p>â€‹\t2ã€springboot-shiro-mgtç®¡ç†åå°æŒä¹…åŒ–ç½‘å…³èµ„æº</p>\n<p>â€‹\t3ã€springboot-shiro-handlerå®ç°ç½‘å…³èµ„æºæŸ¥è¯¢æœåŠ¡åŒ–</p>\n<p>â€‹\t4ã€gateway-serviceä¾æ®æŒä¹…åŒ–çš„ç½‘å…³èµ„æºï¼ŒåŠ¨æ€åˆ›å»ºæ¶ˆè´¹ç«¯æœåŠ¡</p>\n<h2 id=\"ä»£ç å®ç°\">ä»£ç å®ç°</h2>\n<h3 id=\"ç½‘å…³èµ„æºæŒä¹…åŒ–\">ç½‘å…³èµ„æºæŒä¹…åŒ–</h3>\n<p>è¿™é‡Œåœ¨åŸæœ‰èµ„æºçš„åŸºç¡€ä¸Šï¼Œå¢åŠ çš„ç½‘å…³èµ„æºçš„ç®¡ç†ï¼š</p>\n<p>â€‹\t\t1ã€å®šä¹‰ç½‘å…³systemcodeï¼Œç”¨ä»¥åŒºåˆ†ä¸åŒç½‘å…³ç³»ç»Ÿ</p>\n<p>â€‹\t\t2ã€å®šä¹‰è®¿é—®çš„è·¯å¾„</p>\n<p>â€‹\t\t3ã€å®šä¹‰èµ„æºçš„å”¯ä¸€æ ‡è¯†ï¼Œä½œä¸ºæƒé™æ§åˆ¶çš„æ ‡è¯†</p>\n<p>â€‹\t\t4ã€å®šä¹‰ä¸šåŠ¡ç«¯dubboæœåŠ¡ç«¯æ¥å£ã€ç›®æ ‡æ–¹æ³•ã€ä¼ å…¥é˜è¿°ã€è½®è®­ç®—æ³•ã€è¶…æ—¶æ—¶é—´ã€é‡è¯•æ¬¡æ•°ç­‰å‚æ•°ï¼Œè¿™äº›å†…å®¹ä¼šåœ¨gateway-serviceé¡¹ç›®ä¸­è§£æ</p>\n<h3 id=\"ç½‘å…³èµ„æºæœåŠ¡åŒ–\">ç½‘å…³èµ„æºæœåŠ¡åŒ–</h3>\n<pre><code class=\"language-properties\">ResourceAdapterFace:ç½‘å…³èµ„æºæœåŠ¡æ¥å£\nResourceAdapterFaceImpl:ç½‘å…³èµ„æºæœåŠ¡æ¥å£å®ç°\n\nResourceBridgeService:ç½‘å…³èµ„æºæ¡¥æ¥å™¨æ¥å£\nResourceBridgeServiceImpl:ç½‘å…³èµ„æºæ¡¥æ¥å™¨æ¥å£å®ç°\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.face;\n\nimport com.itheima.shiro.vo.ResourceVo;\n\nimport java.util.List;\n\n/**\n * @Descriptionï¼šç½‘å…³èµ„æºæœåŠ¡æ¥å£\n */\npublic interface ResourceAdapterFace {\n\n    /**\n     * @Description è·å¾—å½“å‰ç³»ç»Ÿæ˜¯ç”±æœ‰æ•ˆçš„dubboçš„èµ„æº\n     */\n    List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode);\n}\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.faceImpl;\n\nimport com.itheima.shiro.face.ResourceAdapterFace;\nimport com.itheima.shiro.pojo.Resource;\nimport com.itheima.shiro.service.ResourceService;\nimport com.itheima.shiro.utils.BeanConv;\nimport com.itheima.shiro.utils.EmptyUtil;\nimport com.itheima.shiro.vo.ResourceVo;\nimport org.apache.dubbo.config.annotation.Service;\nimport org.springframework.beans.factory.annotation.Autowired;\n\nimport java.util.List;\n\n/**\n * @Descriptionï¼šç½‘å…³èµ„æºæœåŠ¡æ¥å£å®ç°\n */\n@Service(version = \"1.0.0\", retries = 3,timeout = 5000)\npublic class ResourceAdapterFaceImpl implements ResourceAdapterFace {\n\n    // ç½‘å…³èµ„æºçš„æŒä¹…åŒ–æœåŠ¡\n    @Autowired\n    ResourceService resourceService;\n\n    @Override\n    public List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode) {\n        List&lt;Resource&gt; resourceList =  resourceService.findValidResourceVoAll(systemCode);\n        if (!EmptyUtil.isNullOrEmpty(resourceList)){\n            return BeanConv.toBeanList(resourceList, ResourceVo.class);\n        }\n        return  null;\n    }\n}\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.core.bridge;\n\nimport com.itheima.shiro.vo.ResourceVo;\n\nimport java.util.List;\n\n/**\n * @Descriptionï¼šç½‘å…³èµ„æºæ¡¥æ¥å™¨æ¥å£\n */\npublic interface ResourceBridgeService {\n\n    /**\n     * @Description æŸ¥è¯¢å½“å‰ç³»ç»Ÿæ‰€æœ‰æœ‰æ•ˆçš„DUBBOç±»å‹çš„æœåŠ¡\n     * @param systemCode ç³»ç»Ÿç¼–å·ï¼šä¸mgtæ·»åŠ ç³»ç»Ÿç¼–å·ç›¸åŒ\n     * @return\n     */\n    public List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode);\n}\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.client;\n\nimport com.itheima.shiro.core.bridge.ResourceBridgeService;\nimport com.itheima.shiro.face.ResourceAdapterFace;\nimport com.itheima.shiro.vo.ResourceVo;\nimport org.apache.dubbo.config.annotation.Reference;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport java.util.List;\n\n/**\n * @Descriptionï¼šç½‘å…³èµ„æºæ¡¥æ¥å™¨æ¥å£å®ç°\n */\n@Component(\"resourceBridgeService\")\npublic class ResourceBridgeServiceImpl implements ResourceBridgeService {\n\n    @Value(\"${itheima.resource.systemcode}\")\n    private String systemCode;\n\n    @Reference(version = \"1.0.0\")\n    ResourceAdapterFace resourceAdapterFace;\n\n    @Override\n    public List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode) {\n        return resourceAdapterFace.findValidResourceVoAll(systemCode);\n    }\n}\n</code></pre>\n<h3 id=\"åŠ¨æ€æ¶ˆè´¹ç«¯\">åŠ¨æ€æ¶ˆè´¹ç«¯</h3>\n<p><img alt=\"1582882166870\" class=\"lazyload\" /></p>\n<p>CacheWare:ç¼“å­˜ä»“åº“</p>\n<p>CacheWareService:ç¼“å­˜ä»“åº“æœåŠ¡æ¥å£<br />\nCacheWareServiceImpl:ç¼“å­˜ä»“åº“æœåŠ¡æ¥å£å®ç°</p>\n<p>CacheWareSyncService:ç¼“å­˜ä»“åº“åŒæ­¥æœåŠ¡æ¥å£<br />\nCacheWareSyncServiceImpl:ç¼“å­˜ä»“åº“åŒæ­¥æœåŠ¡æ¥å£å®ç°</p>\n<p>LoginAction:ç™»å½•ç›¸åº”æ¥å£<br />\nGateWayController:ç›¸åº”å±‚çš„ç»Ÿä¸€å…¥å£</p>\n<pre><code class=\"language-java\">package com.itheima.shiro.pojo;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.lang.reflect.Method;\nimport java.lang.reflect.Type;\n\n/**\n * @Description ç¼“å­˜ä»“åº“å¯æ‰§è¡Œç±»\n */\n@Data\n@Builder\n@AllArgsConstructor\n@NoArgsConstructor\npublic class CacheWare {\n\n    //æ‰§è¡Œç±»\n    private String serviceName;\n\n    //æ‰§è¡Œæ–¹æ³•\n    private String methodName;\n\n    //æ–¹æ³•å¯¹è±¡\n    private Method method;\n\n    //å‚æ•°ç±»å‹\n    private Class&lt;?&gt; methodParamsClass;\n\n    //ä»£ç†ç±»\n    private Object proxy;\n\n\n}\n</code></pre>\n<h4 id=\"cachewareservice\">CacheWareService</h4>\n<p>å…¶ä¸»è¦è´Ÿè´£ï¼š</p>\n<p>1ã€ç¼“å­˜çš„æ¸…é™¤</p>\n<p>2ã€å‘mapå®¹å™¨ä¸­åˆ›å»ºç¼“å­˜</p>\n<p>3ã€è·å¾—ç¼“å­˜ä»“åº“æ‰§è¡Œå¯¹è±¡</p>\n<pre><code class=\"language-java\">package com.itheima.shiro.cache;\n\nimport com.google.common.collect.Multimap;\nimport com.itheima.shiro.pojo.CacheWare;\n\n/**\n * @Descriptionï¼šç¼“å­˜ä»“åº“æœåŠ¡\n */\npublic interface CacheWareService {\n\n    /**\n     * @Description æ¸…é™¤ç¼“å­˜\n     */\n    void clearCacheWare();\n\n    /**\n     * @Description å‘mapå®¹å™¨ä¸­åˆ›å»ºç¼“å­˜\n     * @param cacheWareMap\n     */\n    void createCacheWare(Multimap&lt;String, CacheWare&gt; cacheWareMap);\n\n    /**\n     * @Description è·å¾—ç¼“å­˜ä»“åº“æ‰§è¡Œå¯¹è±¡\n     * @param serviceName æœåŠ¡å\n     * @param methodName  æ–¹æ³•å\n     * @return {@link CacheWare}\n     *\n     */\n    CacheWare queryCacheWare(String serviceName, String methodName);\n\n\n}\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.cache.impl;\n\nimport com.google.common.collect.ArrayListMultimap;\nimport com.google.common.collect.Multimap;\nimport com.itheima.shiro.cache.CacheWareService;\nimport com.itheima.shiro.pojo.CacheWare;\nimport com.itheima.shiro.utils.EmptyUtil;\nimport org.springframework.stereotype.Service;\n\nimport java.util.Collection;\n\n/**\n * @Descriptionï¼šç¼“å­˜ä»“åº“æœåŠ¡å®ç°\n */\n@Service(\"cacheWareService\")\npublic class CacheWareServiceImpl implements CacheWareService {\n\n    private Multimap&lt;String, CacheWare&gt; cacheWareMap = ArrayListMultimap.create();\n\n    @Override\n    public void clearCacheWare() {\n        cacheWareMap.clear();\n    }\n\n    @Override\n    public void createCacheWare(Multimap&lt;String, CacheWare&gt; cacheWareMap) {\n        this.cacheWareMap = cacheWareMap;\n    }\n\n    @Override\n    public CacheWare queryCacheWare(String serviceName, String methodName) {\n        if (EmptyUtil.isNullOrEmpty(serviceName)||EmptyUtil.isNullOrEmpty(methodName)){\n            return null;\n        }\n        String key = serviceName+\":\"+methodName;\n        Collection&lt;CacheWare&gt; cacheWares =cacheWareMap.get(key);\n        return EmptyUtil.isNullOrEmpty(cacheWares)?null:cacheWares.iterator().next();\n    }\n}\n</code></pre>\n<h4 id=\"cachewaresyncservice\">CacheWareSyncService</h4>\n<p>å…¶ä¸»è¦èŒè´£ï¼š</p>\n<p>1ã€å¯åŠ¨æ—¶ã€è°ƒç”¨CacheWareServiceçš„åˆ›å»ºç¼“å­˜æ–¹æ³•åˆå§‹åŒ–ç¼“å­˜ä»“åº“</p>\n<p>2ã€åŒæ­¥ç¼“å­˜ä»“åº“</p>\n<p>3ã€ç½‘å…³èµ„æºè½¬åŒ–ç¼“å­˜ä»“åº“å¯æ‰§è¡Œå¯¹è±¡</p>\n<p>4ã€ä»dubboä¸­ï¼Œåˆå§‹åŒ–ä»£ç†å¯¹è±¡</p>\n<p>æ³¨æ„ï¼šä¸ºäº†åœ¨å¤šä¸ªç½‘å…³ç³»ç»Ÿä¸‹ï¼Œæ¥å£è½¬æ¢çš„æ— å¹²æ‰°ï¼Œè¯»å–çš„åªæ˜¯æœ¬ç½‘å…³æ‰€å¯¹åº”çš„èµ„æº</p>\n<pre><code class=\"language-java\">package com.itheima.shiro.cache;\n\nimport com.itheima.shiro.pojo.CacheWare;\nimport com.itheima.shiro.vo.ResourceVo;\n\n/**\n * @Descriptionï¼šç¼“å­˜ä»“åº“åŒæ­¥æ¥å£\n */\npublic interface CacheWareSyncService {\n\n    /**\n     * @Description åˆå§‹åŒ–ç¼“å­˜ä»“åº“\n     */\n    void initCacheWare();\n\n    /**\n     * @Description åŒæ­¥ç¼“å­˜ä»“åº“\n     */\n    void refreshCacheWare();\n\n    /**\n     * @Description èµ„æºè½¬æ¢ç¼“å­˜ä»“åº“å¯æ‰§è¡Œå¯¹è±¡\n     */\n    CacheWare resourceConvCacheWare(ResourceVo resource);\n\n    /**\n     * @Description åˆå§‹åŒ–ä»£ç†å¯¹è±¡\n     * @param interfaceClass æ¥å£\n     * @param loadbalance ç®—æ³•\n     * @param version ç‰ˆæœ¬\n     * @param timeout è¶…æ—¶æ—¶é—´\n     * @param retries é‡è¯•æ¬¡æ•°\n     */\n    Object initProxy(Class&lt;?&gt; interfaceClass,\n                     String loadbalance,\n                     String version,\n                     Integer timeout,\n                     Integer retries);\n\n    /**\n     * @Description å›æ”¶èµ„æº\n     */\n    void destoryCacheWare();\n}\n</code></pre>\n<pre><code class=\"language-java\">package com.itheima.shiro.cache.impl;\n\nimport com.google.common.collect.ArrayListMultimap;\nimport com.google.common.collect.Multimap;\nimport com.itheima.shiro.cache.CacheWareService;\nimport com.itheima.shiro.cache.CacheWareSyncService;\nimport com.itheima.shiro.core.bridge.ResourceBridgeService;\nimport com.itheima.shiro.pojo.CacheWare;\nimport com.itheima.shiro.utils.EmptyUtil;\nimport com.itheima.shiro.vo.ResourceVo;\nimport lombok.extern.log4j.Log4j2;\nimport org.apache.dubbo.config.ApplicationConfig;\nimport org.apache.dubbo.config.ReferenceConfig;\nimport org.apache.dubbo.config.RegistryConfig;\nimport org.apache.dubbo.config.utils.ReferenceConfigCache;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Service;\n\nimport javax.annotation.PostConstruct;\nimport javax.annotation.Resource;\nimport java.lang.reflect.Method;\nimport java.util.List;\nimport java.util.Set;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.ScheduledExecutorService;\nimport java.util.concurrent.TimeUnit;\n\n/**\n * @Descriptionï¼šç¼“å­˜ä»“åº“åŒæ­¥æœåŠ¡æ¥å£å®ç°\n */\n@Service(\"cacheWareSyncService\")\n@Log4j2\npublic class CacheWareSyncServiceImpl implements CacheWareSyncService {\n\n    @Value(\"${itheima.resource.systemcode}\")\n    private String systemCode;\n\n    @Autowired\n    CacheWareService cacheWareService;\n\n    @Autowired\n    ResourceBridgeService resourceBridgeService;\n\n    @Autowired\n    private ApplicationConfig applicationConfig;\n\n    @Autowired\n    private RegistryConfig registryConfig;\n\n    //çº¿ç¨‹æ± \n    private ScheduledExecutorService executorService = Executors.newScheduledThreadPool(1);\n\n    @Override\n    @PostConstruct\n    public void initCacheWare() {\n        executorService.scheduleAtFixedRate(new Runnable() {\n            @Override\n            public void run() {\n                refreshCacheWare();\n            }\n        }, 0, 2, TimeUnit.MINUTES);\n\n    }\n\n    @Override\n    public void refreshCacheWare() {\n        //è·å¾—ç½‘å…³èµ„æº\n        List&lt;ResourceVo&gt; resources = resourceBridgeService.findValidResourceVoAll(systemCode);\n        //åˆ¤æ–­ç½‘å…³èµ„æºæ˜¯å¦ä¸ºç©ºï¼Œåˆ™æ¸…ç©ºæ‰€æœ‰mapå®¹å™¨ä¸­çš„å¯æ‰§è¡Œå¯¹è±¡\n        if (EmptyUtil.isNullOrEmpty(resources)){\n            cacheWareService.clearCacheWare();\n        }\n        Multimap&lt;String,CacheWare&gt; cacheWareMultimap = ArrayListMultimap.create();\n        //æŠŠç½‘å…³èµ„æºè½¬æ¢ä¸ºç¼“å­˜ä»“åº“å¯æ‰§è¡Œå¯¹è±¡\n        for (ResourceVo resource : resources) {\n            if (EmptyUtil.isNullOrEmpty(resource.getServiceName())||\n                EmptyUtil.isNullOrEmpty(resource.getMethodName())){\n                log.warn(\"ç½‘å…³èµ„æºå®šä¹‰ä¸å®Œæ•´ï¼š{}\",resource.toString());\n                continue;\n            }\n            CacheWare cacheWare = resourceConvCacheWare(resource);\n            if (!EmptyUtil.isNullOrEmpty(cacheWare)){\n                String key = cacheWare.getServiceName()+\":\"+cacheWare.getMethodName();\n                cacheWareMultimap.put(key, cacheWare);\n            }\n        }\n\n        //æ”¾å…¥mapå®¹å™¨\n        cacheWareService.createCacheWare(cacheWareMultimap);\n    }\n\n    @Override\n    public CacheWare resourceConvCacheWare(ResourceVo resource) {\n        //ç½‘å…³èµ„æºæœåŠ¡æ¥å£\n        Class&lt;?&gt; serviceClass = null;\n        try {\n            serviceClass = Class.forName(resource.getServiceName());\n        } catch (ClassNotFoundException e) {\n            log.error(\"ä¸ºåœ¨å®¹å™¨ä¸­å‘ç°{}æ¥å£ç±»\",resource.getServiceName());\n            return null;\n        }\n        String serviceNameAll = resource.getServiceName();\n        // è·å¾—ç±»å\n        String serviceName = serviceNameAll.substring(serviceNameAll.lastIndexOf(\".\")+1).toLowerCase();\n        //å¯¹åº”çš„æ‰§è¡Œæ–¹æ³•\n        Method[] methods = serviceClass.getDeclaredMethods();\n        Method methodTarget = null;\n        for (Method method : methods) {\n            if (method.getName().equals(resource.getMethodName())){\n                methodTarget = method;\n                break;\n            }\n        }\n        //å¦‚æœæ–¹æ³•è·å–å¤±è´¥\n        if (EmptyUtil.isNullOrEmpty(methodTarget)){\n            log.error(\"ä¸ºåœ¨å®¹å™¨ä¸­å‘ç°{}æ–¹æ³•\",resource.getMethodName());\n            return null;\n        }\n        //è·å¾—æ–¹æ³•ä¸Šçš„ä¼ å…¥å‚æ•°\n        Class&lt;?&gt;[] parameterTypes = methodTarget.getParameterTypes();\n        Class&lt;?&gt; methodParamsClassTarget = null;\n        for (Class&lt;?&gt; parameterType : parameterTypes) {\n            if (parameterType.getName().equals(resource.getMethodParam())){\n                methodParamsClassTarget = parameterType;\n                break;\n            }\n        }\n        //æ„å»ºæœåŠ¡ä»£ç†ç±»\n        Object proxy = initProxy(serviceClass, resource.getLoadbalance(), resource.getDubboVersion(), resource.getTimeout(), resource.getRetries());\n        //æ„å»ºç¼“å­˜ä»“åº“å¯æ‰§è¡Œå¯¹è±¡\n        CacheWare cacheWare = CacheWare.builder()\n                .serviceName(serviceName)\n                .methodName(resource.getMethodName())\n                .method(methodTarget)\n                .methodParamsClass(methodParamsClassTarget)\n                .proxy(proxy).build();\n        return cacheWare;\n    }\n\n    // è·å–ä»£ç†ç±»\n    @Override\n    public Object initProxy(Class&lt;?&gt; interfaceClass, String loadbalance, String version, Integer timeout, Integer retries) {\n        // æ„å»ºæ¶ˆè´¹ç«¯\n        ReferenceConfig&lt;Object&gt; referenceConfig = new ReferenceConfig&lt;&gt;();\n        referenceConfig.setApplication(applicationConfig);\n        referenceConfig.setRegistry(registryConfig);\n        referenceConfig.setLoadbalance(EmptyUtil.isNullOrEmpty(loadbalance)?\"random\":loadbalance);\n        referenceConfig.setInterface(interfaceClass);\n        referenceConfig.setVersion(version);\n        referenceConfig.setTimeout(EmptyUtil.isNullOrEmpty(timeout)?20000:timeout);\n        referenceConfig.setCheck(false);\n        // æŒ‡å®šé‡è¯•æ¬¡æ•°\n        referenceConfig.setRetries(EmptyUtil.isNullOrEmpty(retries)?0:retries);\n        ReferenceConfigCache cache = ReferenceConfigCache.getCache();\n        return cache.get(referenceConfig);\n    }\n\n    @Override\n    public void destoryCacheWare() {\n        executorService.shutdownNow();\n    }\n}\n</code></pre>\n<h3 id=\"ç½‘å…³èµ„æºè§£æ\">ç½‘å…³èµ„æºè§£æ</h3>\n<p>å…¶ä¸»è¦è´Ÿè´£ï¼š</p>\n<p>1ã€ä¼ å…¥å‚æ•°å¤„ç†</p>\n<p>2ã€è·å¾—å¯æ‰§è¡Œç¼“å­˜ä»“åº“</p>\n<p>3ã€æ‰§è¡Œè¿œç¨‹æœåŠ¡</p>\n<p>4ã€å¤„ç†è¿”å›ç»“æœ</p>\n<pre><code class=\"language-java\">package com.itheima.shiro.web;\n\nimport com.alibaba.fastjson.JSONObject;\nimport com.itheima.shiro.base.BaseRequest;\nimport com.itheima.shiro.cache.CacheWareService;\nimport com.itheima.shiro.constant.GateWayConstant;\nimport com.itheima.shiro.pojo.CacheWare;\nimport com.itheima.shiro.response.MultiResponse;\nimport com.itheima.shiro.response.PageResponse;\nimport com.itheima.shiro.response.SingleResponse;\nimport com.itheima.shiro.utils.EmptyUtil;\nimport com.itheima.shiro.view.JsonResult;\nimport lombok.extern.log4j.Log4j2;\nimport org.springframework.beans.BeanUtils;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Controller;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.lang.reflect.Method;\n\n/**\n * @Descriptionï¼šç½‘å…³ç»Ÿä¸€å…¥å£\n */\n@Controller\n@Log4j2\npublic class GateWayController {\n\n    @Autowired\n    CacheWareService cacheWareService;\n\n    /**\n     * @Description è¯·æ±‚å…¥å£\n     * @param serviceName æœåŠ¡åç§°\n     * @param methodName ç›®æ ‡æ–¹æ³•\n     * @param baseRequest è¯·æ±‚å¯¹è±¡\n     * @return\n     */\n    @RequestMapping(value = \"{serviceName}/{methodName}\",method = RequestMethod.POST)\n    @ResponseBody\n    public JsonResult postGateWay(@PathVariable(\"serviceName\") String serviceName,\n                                  @PathVariable(\"methodName\") String methodName,\n                                  @RequestBody BaseRequest baseRequest) throws Exception{\n        JsonResult jsonResult = null;\n        if (EmptyUtil.isNullOrEmpty(serviceName)||EmptyUtil.isNullOrEmpty(methodName)){\n            jsonResult = jsonResult.builder()\n                    .result(GateWayConstant.FAIL)\n                    .msg(\"å‚æ•°ç¼ºå¤±\")\n                    .code(GateWayConstant.PARAMETERS_MISSING)\n                    .build();\n                    return  jsonResult;\n        }\n        //ä¼ å…¥å‚æ•°å¤„ç†\n        JSONObject jsonObject = null;\n        Object datas = baseRequest.getDatas();\n        if (!EmptyUtil.isNullOrEmpty(datas)){\n            jsonObject = JSONObject.parseObject(jsonObject.toJSONString(datas));\n        }\n        //è·å¾—ç¼“å­˜ä»“åº“å¯æ‰§è¡Œå¯¹è±¡\n        CacheWare cacheWare = cacheWareService.queryCacheWare(serviceName, methodName);\n        //æ‰§è¡Œè¿œç¨‹æœåŠ¡\n        Object proxy = cacheWare.getProxy();\n        Method method = cacheWare.getMethod();\n        Class&lt;?&gt; methodParamsClass = cacheWare.getMethodParamsClass();\n        Object result = null;\n        if (EmptyUtil.isNullOrEmpty(methodParamsClass)){\n            result = method.invoke(proxy);\n        }else {\n            Object arg = JSONObject.toJavaObject(jsonObject, methodParamsClass);\n            result = method.invoke(proxy,arg);\n        }\n        //å¤„ç†æ”¾å›ç»“æœ\n        return  convResult(result);\n    }\n\n    /**\n     * @Description å¤„ç†è¯·æ±‚ç»“æœ\n     */\n    private JsonResult convResult(Object result) {\n        JsonResult jsonResult = JsonResult.builder()\n                .result(GateWayConstant.SUCCEED)\n                .msg(\"ç›¸åº”æ­£å¸¸\")\n                .code(GateWayConstant.SUCCEED_CODE)\n                .build();\n        if (EmptyUtil.isNullOrEmpty(result)) {\n            jsonResult = JsonResult.builder()\n                    .result(GateWayConstant.FAIL)\n                    .msg(\"è¿”å›ç»“æœä¸ºç©º\")\n                    .code(GateWayConstant.RESULT_ISNULLOREMPTY)\n                    .build();\n            return jsonResult;\n        }\n        if (result instanceof SingleResponse) {\n            BeanUtils.copyProperties(result, jsonResult);\n            @SuppressWarnings(\"rawtypes\")\n            SingleResponse singleResponse = (SingleResponse) result;\n            jsonResult.setDatas(singleResponse.getValue());\n        } else if (result instanceof MultiResponse) {\n            BeanUtils.copyProperties(result, jsonResult);\n            @SuppressWarnings(\"rawtypes\")\n            MultiResponse multiResponse = (MultiResponse) result;\n            jsonResult.setDatas(multiResponse.getValues());\n        } else if (result instanceof PageResponse) {\n            BeanUtils.copyProperties(result, jsonResult);\n            PageResponse pageResponse = (PageResponse)result;\n            jsonResult.setDatas( pageResponse.getValues());\n        } else {\n            jsonResult = JsonResult.builder()\n                    .result(GateWayConstant.FAIL)\n                    .msg(\"è¿”å›ç»“æœæ ¼å¼ä¸æ­£ç¡®\")\n                    .code(GateWayConstant.RESULT_MISSING)\n                    .build();\n            return jsonResult;\n        }\n        return jsonResult;\n    }\n}\n</code></pre>\n\n</div>\n<div id=\"MySignature\">\n    <p>æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š<a href=\"https://www.cnblogs.com/alineverstop/\" target=\"_blank\">NE_STOP</a>ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š<a href=\"https://www.cnblogs.com/alineverstop/p/19482539\" target=\"_blank\">https://www.cnblogs.com/alineverstop/p/19482539</a></p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 15:51</span>&nbsp;\n<a href=\"https://www.cnblogs.com/alineverstop\">NE_STOP</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "é«˜å¾·åœ°å›¾å®ç°å®æ—¶è½¨è¿¹å±•ç¤º",
      "link": "https://www.cnblogs.com/lijinhuaboke/p/19457121",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/lijinhuaboke/p/19457121\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 14:35\">\n    <span>é«˜å¾·åœ°å›¾å®ç°å®æ—¶è½¨è¿¹å±•ç¤º</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"vue3--é«˜å¾·åœ°å›¾amap-å®ç°å¹³æ»‘çš„å®æ—¶è½¨è¿¹å›æ”¾ä¸è¿½è¸ª\">Vue3 + é«˜å¾·åœ°å›¾(AMap) å®ç°å¹³æ»‘çš„å®æ—¶è½¨è¿¹å›æ”¾ä¸è¿½è¸ª</h1>\n<h2 id=\"å‰è¨€\">å‰è¨€</h2>\n<p>åœ¨ç‰©è”ç½‘ã€ç‰©æµç›‘æ§æˆ–å®‰é˜²è°ƒåº¦ç³»ç»Ÿä¸­ï¼Œå®æ—¶å±•ç¤ºè®¾å¤‡ï¼ˆå¦‚æ— äººæœºã€è½¦è¾†ã€æ‰‹ç¯ï¼‰çš„ç§»åŠ¨è½¨è¿¹æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ã€‚å¦‚æœä»…ä»…æ˜¯ç®€å•çš„æ›´æ–°æ ‡è®°ç‚¹ä½ç½®ï¼Œè§†è§‰ä¸Šä¼šå‡ºç°â€œè·³å˜â€ç°è±¡ï¼Œä½“éªŒå¾ˆä¸æµç•…ã€‚</p>\n<p>æœ¬æ–‡å°†åˆ†äº«å¦‚ä½•åœ¨ <strong>Vue 3</strong> é¡¹ç›®ä¸­ï¼Œåˆ©ç”¨ <strong>é«˜å¾·åœ°å›¾ (AMap) JS API</strong> å®ç°æ¯”è¾ƒä¸æ»‘çš„å®æ—¶è½¨æ•ˆæœã€‚</p>\n<h2 id=\"æ ¸å¿ƒç—›ç‚¹\">æ ¸å¿ƒç—›ç‚¹</h2>\n<ol>\n<li><strong>å¹³æ»‘ç§»åŠ¨</strong>ï¼šç‚¹ä½æ›´æ–°æ—¶ï¼ŒMarker éœ€è¦ä»æ—§ä½ç½®å¹³æ»‘è¿‡æ¸¡åˆ°æ–°ä½ç½®ï¼Œè€Œä¸æ˜¯ç¬é—´è·³è¿‡å»ã€‚</li>\n<li><strong>è½¨è¿¹è·Ÿéš</strong>ï¼šéšç€ Marker çš„ç§»åŠ¨ï¼Œè½¨è¿¹çº¿ï¼ˆPolylineï¼‰éœ€è¦å®æ—¶â€œç”Ÿé•¿â€ï¼Œç´§è·Ÿåœ¨ Marker åé¢ã€‚</li>\n<li><strong>å¢é‡æ›´æ–°</strong>ï¼šåç«¯é€šå¸¸è¿”å›å®Œæ•´çš„å†å²è·¯å¾„æˆ–å½“å‰çŠ¶æ€ï¼Œå‰ç«¯éœ€è¦è®¡ç®—å‡ºâ€œæ–°å¢çš„è·¯å¾„æ®µâ€è¿›è¡ŒåŠ¨ç”»æ’­æ”¾ã€‚</li>\n</ol>\n<h2 id=\"å®ç°é€»è¾‘è§£æ\">å®ç°é€»è¾‘è§£æ</h2>\n<p>æ ¸å¿ƒæ˜¯åˆ©ç”¨é«˜å¾·åœ°å›¾ API çš„è½¨è¿¹å›æ”¾åŠŸèƒ½ã€‚è™½ç„¶å®˜æ–¹æ–‡æ¡£æä¾›äº†åŸºç¡€çš„è½¨è¿¹å›æ”¾ç¤ºä¾‹ï¼ˆå‚è€ƒï¼š<a href=\"https://lbs.amap.com/demo/javascript-api-v2/example/marker/replaying-historical-running-data\" rel=\"noopener nofollow\" target=\"_blank\">è½¨è¿¹å›æ”¾ç¤ºä¾‹</a>ï¼‰ï¼Œä½†å®˜æ–¹ç¤ºä¾‹é€šå¸¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½å®Œæ•´è·¯å¾„ï¼ˆä¾‹å¦‚ï¼šå…ˆè·å–å®Œæ•´ç»çº¬åº¦æ•°ç»„ï¼Œæ¸²æŸ“å‡ºæµ…è“è‰²èƒŒæ™¯çº¿ï¼Œå†è®©å°è½¦æ²¿ç€è·¯å¾„è·‘å¹¶ç”»å‡ºæµ…ç»¿è‰²è½¨è¿¹ï¼‰ã€‚</p>\n<p><strong>æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ä¸å®˜æ–¹ç¤ºä¾‹çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š</strong><br />\næˆ‘ä»¬çš„è·¯å¾„æ•°æ®æ˜¯<strong>å®æ—¶å¢é‡æ›´æ–°</strong>çš„ã€‚å‰ç«¯å¹¶æ²¡æœ‰ä¸€å¼€å§‹å°±æ‹¿åˆ°å®Œæ•´çš„è·¯å¾„ï¼Œè€Œæ˜¯é€šè¿‡ WebSocket æˆ–è½®è¯¢å®æ—¶è·å–åç«¯è¿”å›çš„æœ€æ–°è·¯å¾„æ•°æ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è‡ªè¡Œè®¾è®¡é€»è¾‘ï¼Œè®¡ç®—å‡ºæ¯æ¬¡æ›´æ–°çš„â€œå¢é‡ç‰‡æ®µâ€ï¼Œå¹¶è®© Marker å¹³æ»‘åœ°èµ°å®Œè¿™ä¸€æ®µã€‚</p>\n<h3 id=\"æ ¸å¿ƒæ€è·¯\">æ ¸å¿ƒæ€è·¯ï¼š</h3>\n<ol>\n<li>\n<p><strong>å‰åç«¯æ•°æ®çº¦å®š</strong>ï¼š</p>\n<ul>\n<li>ç†æƒ³æƒ…å†µä¸‹ï¼Œåç«¯æœ€å¥½ç›´æ¥è¿”å›â€œå¢é‡è·¯å¾„â€ï¼ˆå³ä¸Šä¸€æ¬¡ä½ç½®åˆ°å½“å‰ä½ç½®çš„åæ ‡é›†åˆï¼‰ã€‚</li>\n<li>ä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼ˆæ¯”å¦‚æœ¬æ¡ˆä¾‹ï¼‰ï¼Œåç«¯æ¥å£è¿”å›çš„æ˜¯<strong>å½“å‰æ—¶åˆ»çš„å®Œæ•´ç´¯ç§¯è·¯å¾„</strong>ã€‚å› æ­¤ï¼Œå‰ç«¯éœ€è¦è‡ªè¡Œæ¯”å¯¹ç¼“å­˜çš„â€œä¸Šä¸€æ¬¡è·¯å¾„â€å’Œâ€œæœ€æ–°è·¯å¾„â€ï¼Œè®¡ç®—å‡ºå¢é‡éƒ¨åˆ†ã€‚</li>\n</ul>\n</li>\n<li>\n<p><strong>çŠ¶æ€ç®¡ç† (ç¼“å­˜å®ä¾‹)</strong>ï¼š</p>\n<ul>\n<li>ä½¿ç”¨ <code>Map</code> æ•°æ®ç»“æ„æ¥ç¼“å­˜æ¯ä¸ªè®¾å¤‡ï¼ˆå¦‚æ— äººæœºã€æ‰‹ç¯ï¼‰çš„ <code>Marker</code>ï¼ˆå›¾æ ‡ï¼‰å’Œ <code>Polyline</code>ï¼ˆè½¨è¿¹çº¿ï¼‰å®ä¾‹ã€‚</li>\n<li>ç¡®ä¿æ¯ä¸ªè®¾å¤‡ ID å¯¹åº”å”¯ä¸€çš„åœ°å›¾å®ä¾‹ï¼Œé¿å…æ•°æ®åˆ·æ–°æ—¶é‡å¤åˆ›å»ºå¯¼è‡´å†…å­˜æ³„æ¼æˆ–é—ªçƒã€‚</li>\n</ul>\n</li>\n<li>\n<p><strong>è®¡ç®—å¢é‡è·¯å¾„</strong>ï¼š</p>\n<ul>\n<li>å½“æ–°æ•°æ®åˆ°è¾¾æ—¶ï¼Œé€šè¿‡å¯¹æ¯”æ–°æ—§è·¯å¾„é•¿åº¦ï¼Œæˆªå–å‡º<strong>æ–°å¢çš„è·¯å¾„æ®µ</strong>ã€‚</li>\n<li>è¿™æ®µæ–°å¢è·¯å¾„å°±æ˜¯ Marker æ¥ä¸‹æ¥éœ€è¦â€œå¹³æ»‘ç§»åŠ¨â€çš„è½¨è¿¹ã€‚</li>\n</ul>\n</li>\n<li>\n<p><strong>å¹³æ»‘åŠ¨ç”» (<code>moveAlong</code>)</strong>ï¼š</p>\n<ul>\n<li>è°ƒç”¨é«˜å¾·åœ°å›¾çš„ <code>marker.moveAlong()</code> æ–¹æ³•ï¼Œè®© Marker æ²¿ç€æ–°å¢è·¯å¾„å¹³æ»‘ç§»åŠ¨ï¼Œè€Œä¸æ˜¯ç¬é—´è·³å˜ã€‚</li>\n</ul>\n</li>\n<li>\n<p><strong>å®æ—¶ç»˜åˆ¶è½¨è¿¹ (<code>moving</code> äº‹ä»¶)</strong>ï¼š</p>\n<ul>\n<li>ç›‘å¬ Marker çš„ <code>moving</code> äº‹ä»¶ã€‚åœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œå®æ—¶æ›´æ–°è½¨è¿¹çº¿ï¼ˆPolylineï¼‰çš„è·¯å¾„ï¼Œä»è€Œå®ç°â€œè¾¹èµ°è¾¹ç”»â€çš„æ•ˆæœã€‚</li>\n<li><strong>å…³é”®ç‚¹</strong>ï¼šä¸ºä»€ä¹ˆè¦åœ¨ <code>moving</code> äº‹ä»¶ä¸­æ›´æ–°æ€»è½¨è¿¹ï¼Œè€Œä¸æ˜¯åœ¨åŠ¨ç”»ç»“æŸ (<code>moveend</code>) åæ›´æ–°ï¼Ÿ\n<ul>\n<li>è¿™æ˜¯ä¸ºäº†é˜²æ­¢æ•°æ®æ¨é€é¢‘ç‡è¿‡å¿«ã€‚å¦‚æœç­‰åˆ°åŠ¨ç”»ç»“æŸå†æ›´æ–°ï¼Œå¯èƒ½ä¼šå‡ºç°â€œæ–°çš„æ•°æ®æ¨é€æ¥äº†ï¼Œä½†ä¸Šä¸€æ¬¡åŠ¨ç”»è¿˜æ²¡ç»“æŸï¼Œå¯¼è‡´è½¨è¿¹æ•°æ®ä¸¢å¤±æˆ–è¡”æ¥ä¸ä¸Šâ€çš„é—®é¢˜ã€‚åœ¨ <code>moving</code> è¿‡ç¨‹ä¸­å®æ—¶å°† <code>passedPath</code>ï¼ˆå·²èµ°è¿‡çš„è·¯å¾„ï¼‰æ‹¼æ¥åˆ°æ€»è½¨è¿¹ä¸­ï¼Œæ˜¯æœ€ç¨³å¦¥çš„æ–¹å¼ã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>åŠ¨ç”»ç»“æŸæ¸…ç†</strong>ï¼š</p>\n<ul>\n<li>åŠ¨ç”»ç»“æŸæ—¶ (<code>moveend</code>)ï¼Œæ¸…ç†ä¸´æ—¶ç»˜åˆ¶çš„è¾…åŠ©çº¿ï¼Œç§»é™¤ç›‘å¬å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</li>\n</ul>\n</li>\n</ol>\n<hr />\n<h3 id=\"ä»£ç è¯¦è§£\">ä»£ç è¯¦è§£</h3>\n<h4 id=\"1-çŠ¶æ€ç®¡ç†ä¸åˆå§‹åŒ–\">1. çŠ¶æ€ç®¡ç†ä¸åˆå§‹åŒ–</h4>\n<p>æˆ‘ä»¬ä½¿ç”¨ <code>Map</code> æ¥ç®¡ç†åœ°å›¾ä¸Šçš„ Marker å’Œ Polyline å®ä¾‹ã€‚</p>\n<pre><code class=\"language-javascript\">// å­˜å‚¨ Marker å®ä¾‹ (Key: è®¾å¤‡ID, Value: AMap.Marker)\nconst uavMarkers = ref(new Map());\n// å­˜å‚¨è½¨è¿¹çº¿ Polyline å®ä¾‹ (Key: è®¾å¤‡ID, Value: AMap.Polyline)\nconst uavPaths = ref(new Map());\n</code></pre>\n<h4 id=\"2-æ ¸å¿ƒå¤„ç†å‡½æ•°-refreshtemppoint\">2. æ ¸å¿ƒå¤„ç†å‡½æ•° <code>refreshTempPoint</code></h4>\n<p>è¿™ä¸ªå‡½æ•°è´Ÿè´£å¤„ç†å•æ¡è®¾å¤‡æ•°æ®çš„æ›´æ–°é€»è¾‘ã€‚</p>\n<pre><code class=\"language-javascript\">// åˆ·æ–°è®¾å¤‡ç‚¹ä½ä¸è½¨è¿¹\n// item: åç«¯è¿”å›çš„è®¾å¤‡æ•°æ®å¯¹è±¡\n// position: å½“å‰æœ€æ–°çš„åæ ‡ç‚¹\n// type: æ›´æ–°ç±»å‹ï¼ˆ'init' ä¸ºåˆå§‹åŒ–ï¼Œå…¶ä»–ä¸ºå¢é‡æ›´æ–°ï¼‰\nconst refreshTempPoint = async (item, position, type, marker, tempOverlay, pathOverlay) =&gt; {\n  // 1. æ¸…ç†ä¸Šä¸€è½®çš„ä¸´æ—¶è¦†ç›–ç‰©ï¼ˆå¦‚ä¸´æ—¶è·¯çº¿ã€è·ç¦»æ–‡æœ¬ï¼‰\n  tempOverlay?.clearOverlays();\n\n  if (item.coordinatesLine) {\n    const coordinatesLine = JSON.parse(item.coordinatesLine); // è§£æåç«¯è¿”å›çš„å®Œæ•´è·¯å¾„æ•°ç»„\n\n    // --- A. åˆå§‹åŒ–èµ·ç‚¹ Marker ---\n    let tempMarker = tempUavMarkers.value.get(item.id);\n    if (!tempMarker) {\n      // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œæ¸²æŸ“èµ·ç‚¹\n      tempMarker = renderPoint(coordinatesLine[0], item, \"\", pathOverlay);\n      tempUavMarkers.value.set(item.id, tempMarker);\n    }\n\n    // --- B. è·å–æˆ–åˆ›å»ºå†å²è½¨è¿¹çº¿ (Polyline) ---\n    let polyline = uavPaths.value.get(item.id);\n    if (!polyline) {\n      polyline = trajectoryLine(item, pathOverlay); // åˆ›å»ºæ–°çš„çº¿å®ä¾‹\n      uavPaths.value.set(item.id, polyline);\n    }\n\n    // è·å–å½“å‰åœ°å›¾ä¸Šå·²æœ‰çš„è·¯å¾„ï¼ˆç¼“å­˜çš„æ—§è·¯å¾„ï¼‰\n    const existingPath = polyline.getPath() || [];\n\n    if (type != \"init\") {\n      // --- C. å¢é‡æ›´æ–°é€»è¾‘ ---\n      \n      // 1. è®¡ç®—å¢é‡è·¯å¾„ï¼šä»å·²æœ‰è·¯å¾„çš„æœ€åä¸€ä¸ªç‚¹å¼€å§‹æˆªå–ï¼Œç›´åˆ°æœ€æ–°è·¯å¾„çš„æœ«å°¾\n      const newPathSegment = coordinatesLine.slice(\n        existingPath.length ? existingPath.length - 1 : 0\n      );\n\n      // 2. åˆ›å»ºä¸€æ¡ä¸´æ—¶çš„â€œéšå½¢â€çº¿æ®µï¼Œç”¨äºè¾…åŠ©è®¡ç®—æˆ–å±•ç¤ºï¼ˆè§†éœ€æ±‚è€Œå®šï¼‰\n      const newPolyline = trajectoryLine(item, tempOverlay);\n\n      // 3. å¦‚æœæœ‰æ–°å¢è·¯å¾„ï¼Œå¼€å§‹åŠ¨ç”»\n      if (newPathSegment &amp;&amp; newPathSegment.length &gt; 0) {\n        \n        // ç›‘å¬ç§»åŠ¨è¿‡ç¨‹\n        marker.on(\"moving\", function (e) {\n          // e.passedPath æ˜¯ Marker åœ¨å½“å‰åŠ¨ç”»ç‰‡æ®µä¸­å·²ç»èµ°è¿‡çš„è·¯å¾„\n          newPolyline.setPath(e.passedPath);\n          \n          // [å…³é”®] å®æ—¶å°†èµ°è¿‡çš„è·¯å¾„æ‹¼æ¥åˆ°å†å²æ€»è½¨è¿¹ä¸­\n          // è¿™æ ·å³ä½¿ WebSocket æ¨é€é¢‘ç‡å¾ˆå¿«ï¼Œä¹Ÿèƒ½ä¿è¯è½¨è¿¹æ•°æ®çš„è¿ç»­æ€§\n          polyline.setPath([...existingPath, ...e.passedPath]);\n        });\n\n        // å¼€å§‹å¹³æ»‘ç§»åŠ¨\n        marker.moveAlong(newPathSegment, {\n          duration: 1000,    // åŠ¨ç”»æ—¶é•¿ï¼Œéœ€æ ¹æ® WebSocket æ¨é€é¢‘ç‡è°ƒæ•´\n          autoRotation: true, // è½¦å¤´è‡ªåŠ¨å¯¹å‡†è·¯å¾„æ–¹å‘\n        });\n\n        // ç›‘å¬ç§»åŠ¨ç»“æŸ\n        marker.on(\"moveend\", function () {\n          // åŠ¨ç”»ç»“æŸï¼Œæ¸…ç†ä¸´æ—¶è¦†ç›–ç‰©\n          tempOverlay?.clearOverlays();\n          \n          // æ›´æ–°è·ç¦»æ–‡æœ¬ç­‰ä¿¡æ¯\n          if (item.distance) {\n            renderText(\n              coordinatesLine[Math.ceil(coordinatesLine.length - 2)],\n              `${item.distance}ç±³`,\n              tempOverlay\n            );\n          }\n          \n          // ç§»é™¤ç›‘å¬å™¨ï¼Œé˜²æ­¢é‡å¤ç»‘å®š\n          marker.off(\"moveend\");\n        });\n      } else {\n        // å¦‚æœæ²¡æœ‰æ–°å¢è·¯å¾„ï¼ˆä½ç½®æ²¡å˜ï¼‰ï¼Œä»…æ›´æ–°æ–‡å­—ä¿¡æ¯\n        if (item.distance) {\n          renderText(..., `${item.distance}ç±³`, tempOverlay);\n        }\n      }\n\n    } else {\n      // --- D. åˆå§‹åŒ–é€»è¾‘ ---\n      // å¦‚æœæ˜¯åˆå§‹åŒ–åŠ è½½ï¼Œç›´æ¥è®¾ç½®å®Œæ•´è·¯å¾„ï¼Œä¸è¿›è¡ŒåŠ¨ç”»å›æ”¾\n      if (item.distance) {\n         renderText(..., `${item.distance}ç±³`, tempOverlay);\n      }\n      polyline.setPath(coordinatesLine);\n    }\n  } else {\n    // --- E. æ— è½¨è¿¹æ•°æ®æ—¶çš„é™çº§å¤„ç† ---\n    // å¦‚æœåç«¯æ²¡æœ‰è¿”å›è·¯å¾„æ•°æ®ï¼Œç›´æ¥è·³å˜åˆ°æœ€æ–°ä½ç½®\n    marker.setPosition(position);\n    \n    // æ¸…ç†ç›¸å…³çš„è½¨è¿¹å®ä¾‹å’Œç¼“å­˜\n    let tempMarker = tempUavMarkers.value.get(item.id);\n    if (tempMarker) {\n      tempMarker.setMap(null);\n      pathOverlay &amp;&amp; pathOverlay.removeOverlay(tempMarker);\n      tempUavMarkers.value.delete(item.id);\n    }\n    \n    let polyline = uavPaths.value.get(item.id);\n    if (polyline) {\n      polyline.setMap(null);\n      pathOverlay &amp;&amp; pathOverlay.removeOverlay(polyline);\n      uavPaths.value.delete(item.id);\n    }\n  }\n};\n</code></pre>\n<p>}<br />\n};</p>\n<pre><code class=\"language-javascript\">\n// æ— äººæœºå’Œæ‰‹ç¯è½¨è¿¹æš‚æ—¶\nconst refreshAirMap = async (type, data) =&gt; {\n  const res = await getUavElement();\n  // console.log(\"æ— äººæœºæ•°æ®\", res.result);\n  res.result.map(async (item) =&gt; {\n    // data.map(async (item) =&gt; {\n    if (item.type == \"1\") {\n      let position = JSON.parse(item.coordinates);\n      // è·å–æˆ–åˆ›å»ºæ— äººæœºæ ‡è®°\n      let marker = uavMarkers.value.get(item.id);\n      if (!marker) {\n        // åˆ›å»ºæ— äººæœºã€æ‰‹ç¯ç‚¹ä½ã€‚\n        marker = renderPoint(position, item, \"\", overlayGroups.value);\n        uavMarkers.value.set(item.id, marker);\n      }else{\n        \n        if (item.elementType == \"2\") {\n          // å·²æœ‰ç‚¹ä½ä¸”æ˜¯æ‰‹ç¯ç‚¹ä½å°±æ›´æ–°ç”µé‡\n          marker.setLabel({\n            content: `&lt;div class=\"marker-label-container\"&gt;\n              &lt;div class=\"info-name\"&gt;${item.name}&lt;/div&gt;\n              &lt;div class=\"icon-placeholder\"&gt;&lt;/div&gt;\n              ${batteryHtml(item)}\n            &lt;/div&gt;`,\n            offset: new AMaps.value.Pixel(0, 0),\n            direction: \"center\",\n          });\n        }\n      }\n\n      if (item.elementType == \"1\") {\n        // æ— äººæœºè½¨è¿¹\n        refreshTempPoint(\n          item,\n          position,\n          type,\n          marker,\n          pathOverlayGroups.value,\n          pathsStartPointOverlayGroups.value\n        );\n      } else if (item.elementType == \"2\") {\n        // æ‰‹ç¯è½¨è¿¹\n        refreshTempPoint(\n          item,\n          position,\n          type,\n          marker,\n          rescuePathsOverlayGroups.value,\n          rescueOverlayGroups.value\n        );\n      }\n      // è½¨è¿¹éƒ¨åˆ†ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è½¨è¿¹\n    }\n  });\n  // });\n};\n</code></pre>\n<p>è¯´æ˜ä¸€ä¸‹å“¦ï¼Œæˆ‘çš„é¡¹ç›®ä¸­è¿˜éœ€è¦å®ç°å…¶ä»–åŠŸèƒ½åƒæ˜¯æ‰‹ç¯ç”µé‡å±•ç¤ºï¼Œç‚¹å‡»æŒ‰é’®å¯éšè—æ— äººæœºè½¨è¿¹ï¼Œç‚¹å‡»æŒ‰é’®å¯éšè—æ‰‹ç¯è½¨è¿¹ï¼Œæ— äººæœºå’Œæ‰‹ç¯è½¨è¿¹èµ·å§‹ç‚¹ä¹Ÿéœ€è¦å±•ç¤ºä¸€ä¸ªç‚¹ä½å›¾æ ‡ï¼Œè½¨è¿¹çº¿ä¸Šæ˜¾ç¤ºè·ç¦»ï¼Œè¿˜è€ƒè™‘äº†ç¬¬ä¸€æ¬¡è¿›å…¥é¡¹ç›®ï¼Œå¦‚æ— è½¨è¿¹å°±åªæ›´æ–°ç‚¹ä½åæ ‡ç­‰ç­‰è¿™äº›ï¼Œæ— å…³çš„è½¨è¿¹å±•ç¤ºé€»è¾‘çš„å„ä½è§‚ä¼—è€çˆ·ç•¥è¿‡å°±å¥½ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯åˆ†äº«ä¸€ä¸‹å®æ—¶è½¨è¿¹å®ç°çš„é€»è¾‘ï¼ŒæŠŠè½¨è¿¹ç›¸å…³é€»è¾‘æŠ½å‡ºæ¥é‡æ–°å†™ä¸€ä»½ä»£ç ï¼Œæˆ‘å«Œéº»çƒ¦å˜»å˜»ã€‚</p>\n<h2 id=\"æ€»ç»“\">æ€»ç»“</h2>\n<p>é€šè¿‡ç»“åˆ å¢é‡è·¯å¾„è®¡ç®—<code>moveAlong</code> è½¨è¿¹å›æ”¾ ä»¥åŠ <code>moving</code> äº‹ä»¶ç›‘å¬ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªé«˜æ€§èƒ½ä¸”è§†è§‰æµç•…çš„å®æ—¶è½¨è¿¹è¿½è¸ªåŠŸèƒ½ã€‚è¿™ç§æ–¹æ¡ˆç‰¹åˆ«é€‚åˆæ— äººæœºå·¡èˆªã€è½¦è¾†å®æ—¶å®šä½ç­‰éœ€è¦é«˜é¢‘æ›´æ–°ä½ç½®çš„åœºæ™¯ã€‚</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 14:35</span>&nbsp;\n<a href=\"https://www.cnblogs.com/lijinhuaboke\">æ­¤é¢œå·®çŸ£ã€‚</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">147</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">3</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    }
  ]
}