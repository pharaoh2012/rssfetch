{
  "title": "主页 - 博客园",
  "link": "https://www.cnblogs.com/",
  "description": "主页 - 博客园 RSS",
  "entries": [
    {
      "title": "2025年终总结——在奔跑中前行",
      "link": "https://www.cnblogs.com/lucky_hu/p/19430418",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/lucky_hu/p/19430418\" id=\"cb_post_title_url\" title=\"发布于 2026-01-01 17:27\">\n    <span>2025年终总结——在奔跑中前行</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h3 id=\"导航\">导航</h3>\n<ul>\n<li>前言</li>\n<li>职场人的核心竞争力是什么</li>\n<li>拥抱AI，拥抱大模型</li>\n<li>尝试自媒体</li>\n<li>读毛选</li>\n<li>写过的文章</li>\n<li>结语</li>\n<li>参考</li>\n</ul>\n<br />\n<section>\n    <a href=\"https://img.zhikestreet.com/2026-01-01_165557_428.png?imageView2/0/q/75|watermark/2/text/NTJJbnRlcnZpZXc=/font/5a6L5L2T/fontsize/240/fill/IzBFMDkwNQ==/dissolve/100/gravity/SouthEast/dx/10/dy/10\" rel=\"noopener nofollow\"><img alt=\"\" src=\"https://img.zhikestreet.com/2026-01-01_165557_428.png?imageView2/0/q/75|watermark/2/text/NTJJbnRlcnZpZXc=/font/5a6L5L2T/fontsize/240/fill/IzBFMDkwNQ==/dissolve/100/gravity/SouthEast/dx/10/dy/10\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></a>\n</section> \n<br />\n<h3 id=\"前言\">前言</h3>\n<blockquote>\n<p>不是先学好了再干，而是干起来再学习，干就是学习。——《毛选》</p>\n</blockquote>\n<p>2025年，对于笔者而言，是极不平凡的一年。</p>\n<p>这一年，有快乐、有焦虑、有遗憾、有成长。</p>\n<p><strong>忙碌了一整年，回顾了这一年的经历，笔者对主要工作做了梳理和总结，同时要有一些自己的感悟,或许能与您产生共鸣。</strong></p>\n<h3 id=\"职场人的核心竞争力是什么\">职场人的核心竞争力是什么</h3>\n<blockquote>\n<p>对大部分企业而言，增长才是的核心竞争力,技术不是。</p>\n</blockquote>\n<p>在很多年的技术职业生涯中，笔者曾坚定地认为把产品做好，技术方案做好，兢兢业业，持续迭代，就一定能赢得公司的认可。(请参考<a href=\"https://www.52interview.com/solutions/31\" rel=\"noopener nofollow\" target=\"_blank\">《技术更迭，一往无前》</a>)</p>\n<p>然而,随着工作年限的增长,发现很多企业并不这么认为。他们更看重的是业绩的增长,技术只是实现增长的手段之一。</p>\n<p><strong>结论：让业绩增长才是职场人的核心竞争力。</strong></p>\n<h3 id=\"拥抱ai拥抱大模型\">拥抱AI，拥抱大模型</h3>\n<blockquote>\n<p>一定不能让自己被AI列车甩下，无论是玩还是工作，一定要经常使用它们。</p>\n</blockquote>\n<p>2025年的年初，deepseek-r1的强势发布，让AI大模型在业界引起了轩然大波，各个行业开始纷纷拥抱AI大模型。</p>\n<p>2025年的年末，Manus被Meta收购，在科技界十分轰动。</p>\n<p>过去，我们认为AI只是个玩具，离自己很远。</p>\n<p>而现在，它已经能够做具体的工作了。</p>\n<h3 id=\"尝试自媒体\">尝试自媒体</h3>\n<blockquote>\n<p>转型，不一定非的转行。</p>\n</blockquote>\n<p>2025年的国庆节后，笔者开始做视频号。</p>\n<p>主要基于两点考虑：</p>\n<ul>\n<li>希望能够突破自我，拓宽自己的视野。</li>\n<li>培养兴趣、爱好，丰富自己的生活。</li>\n</ul>\n<p>干技术工作十几年了，如果只是沉浸在技术领域,那未免有些枯燥。<br />\n何况，生活不止是工作，还有诗和远方。</p>\n<br />\n<section>\n    <a href=\"https://img.zhikestreet.com/2026-01-01_160015_444-min.png?imageView2/0/q/75|watermark/2/text/NTJJbnRlcnZpZXc=/font/5a6L5L2T/fontsize/240/fill/IzBFMDkwNQ==/dissolve/100/gravity/SouthEast/dx/10/dy/10\" rel=\"noopener nofollow\"><img alt=\"\" src=\"https://img.zhikestreet.com/2026-01-01_160015_444-min.png?imageView2/0/q/75|watermark/2/text/NTJJbnRlcnZpZXc=/font/5a6L5L2T/fontsize/240/fill/IzBFMDkwNQ==/dissolve/100/gravity/SouthEast/dx/10/dy/10\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></a>\n</section> \n<br />\n<br />\n<section>\n    <a href=\"https://img.zhikestreet.com/2026-01-01_160113_397.png?imageView2/0/q/75|watermark/2/text/NTJJbnRlcnZpZXc=/font/5a6L5L2T/fontsize/240/fill/IzBFMDkwNQ==/dissolve/100/gravity/SouthEast/dx/10/dy/10\" rel=\"noopener nofollow\"><img alt=\"\" src=\"https://img.zhikestreet.com/2026-01-01_160113_397.png?imageView2/0/q/75|watermark/2/text/NTJJbnRlcnZpZXc=/font/5a6L5L2T/fontsize/240/fill/IzBFMDkwNQ==/dissolve/100/gravity/SouthEast/dx/10/dy/10\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></a>\n</section> \n<br />\n<p>做视频很花心思，也很有挑战性，也没啥收益。<br />\n每次期待有粉丝关注，也算是一种成就感。</p>\n<h3 id=\"读毛选\">读毛选</h3>\n<blockquote>\n<p>内心强大才是真正的强大。</p>\n</blockquote>\n<p>2025年，职场遭遇困境，几乎快要到了面临抉择的时候，笔者开始阅读《毛选》。<br />\n就这样，深一脚，浅一脚挺了过来。</p>\n<p>不管是企业还是个人，都有遇到困难的时候。</p>\n<p>有时候，逃避问题很容易，直面问题需要莫大的勇气。</p>\n<p>\"贵人成全你，小人成就你。\"，经历过风雨的人，深有感受。</p>\n<section>\n    <a href=\"https://img.zhikestreet.com/20260101162415_666_2-min.png?imageView2/0/q/75|watermark/2/text/NTJJbnRlcnZpZXc=/font/5a6L5L2T/fontsize/240/fill/IzBFMDkwNQ==/dissolve/100/gravity/SouthEast/dx/10/dy/10\" rel=\"noopener nofollow\"><img alt=\"\" src=\"https://img.zhikestreet.com/20260101162415_666_2-min.png?imageView2/0/q/75|watermark/2/text/NTJJbnRlcnZpZXc=/font/5a6L5L2T/fontsize/240/fill/IzBFMDkwNQ==/dissolve/100/gravity/SouthEast/dx/10/dy/10\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></a>\n</section> \n<br />\n<section>\n    <a href=\"https://img.zhikestreet.com/1767255242289-min.jpg?imageView2/0/q/75|watermark/2/text/NTJJbnRlcnZpZXc=/font/5a6L5L2T/fontsize/240/fill/IzBFMDkwNQ==/dissolve/100/gravity/SouthEast/dx/10/dy/10\" rel=\"noopener nofollow\"><img alt=\"\" src=\"https://img.zhikestreet.com/1767255242289-min.jpg?imageView2/0/q/75|watermark/2/text/NTJJbnRlcnZpZXc=/font/5a6L5L2T/fontsize/240/fill/IzBFMDkwNQ==/dissolve/100/gravity/SouthEast/dx/10/dy/10\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></a>\n</section> \n<br />\n<h3 id=\"写过的文章\">写过的文章</h3>\n<blockquote>\n<p>经验创造价值，分享成就未来。</p>\n</blockquote>\n<ul>\n<li><a href=\"https://www.cnblogs.com/lucky_hu/collections/29080\" target=\"_blank\">《AI工作流实战》</a></li>\n</ul>\n<br />\n<section>\n    <a href=\"https://www.52interview.com/book/100\" rel=\"noopener nofollow\"><img alt=\"\" src=\"https://img.zhikestreet.com/2026-01-01_164320_875.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></a>\n</section> \n<br />\n<h3 id=\"结语\">结语</h3>\n<blockquote>\n<p>我们都在奔跑,但是短暂地停下来思考,是为了更好地再出发。</p>\n</blockquote>\n<p>过去的一年，为了\"柴米油盐、三餐四季\"忙碌奔波。</p>\n<p>新的一年，希望可以多一点战略思考，发掘更多个人的潜力和强项，突破发展瓶颈，找到属于自己的赛道。</p>\n<p>以上只是笔者个人的一点点浅见,有理解不对的地方，请大家多多包含和指正。</p>\n<h3 id=\"致谢\">致谢</h3>\n<p>最后，分享一首《踏莎行·元旦》，祝您在新的一年里，一路向阳，温暖前行，万事无忧。</p>\n<blockquote>\n<p>爆竹庭前，树桃门右。香汤浴罢，五更后。高烧银烛，瑞烟喷金兽。萱堂次第了，相为寿。<br />\n改岁宜新、应时纳祐。从今诸事愿、胜如旧。人生强健，喜一年入手。休辞最后饮，酴酥酒。</p>\n</blockquote>\n<br />\n<section>\n <a href=\"https://www.52interview.com/\" rel=\"noopener nofollow\" target=\"_blank\"><img alt=\"\" src=\"https://img.zhikestreet.com/20210522-22216942.jpg\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></a>\n</section> \n<br />\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-01 17:27</span>&nbsp;\n<a href=\"https://www.cnblogs.com/lucky_hu\">楠木大叔</a>&nbsp;\n阅读(<span id=\"post_view_count\">46</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "实用程序：解放双手！Python 打造 PDF 手写模拟器，轻松搞定手写作业",
      "link": "https://www.cnblogs.com/ChenAI-TGF/p/19430267",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/ChenAI-TGF/p/19430267\" id=\"cb_post_title_url\" title=\"发布于 2026-01-01 15:59\">\n    <span>实用程序：解放双手！Python 打造 PDF 手写模拟器，轻松搞定手写作业</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        本文介绍了一款基于Python开发的PDF手写模拟工具，可自动将电子文本转换为逼真手写效果并填充至PDF指定区域。该工具支持中英文独立配置字体、大小、颜色等参数，通过随机扰动算法模拟真实手写的行倾斜、字符偏移等不规则特性。用户可通过可视化界面框选填写区域、实时预览效果并保存配置模板。技术实现采用PyMuPDF处理PDF核心操作，结合tkinter构建GUI界面，Pillow实现图像渲染。开源项目地址已提供，可帮助学生高效完成手写作业需求，显著提升工作效率。\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"前言\">前言</h1>\n<p>作为学生，想必大家都有过被海量手写实验报告、课程作业支配的痛苦。要花费大量时间一笔一划地抄写到纸质文档中再进行扫描成pdf提交，不仅耗时耗力，手写的字迹还可能参差不齐，影响作业美观度。</p>\n<p>为了偷懒，博主开发了一款基于python的PDF手写模拟器，它能够模拟真实手写笔迹，将电脑上的文字批量填充到 PDF 指定区域，支持中文/英文分开配置、手写扰动效果自定义、配置模版复用等功能，生成的效果高度贴近真实手写，帮你彻底告别手动抄写的烦恼。首先来个界面以及效果预览：</p>\n<p><strong>代码已经开源在Github：<a href=\"https://github.com/ChenAI-TGF/PDF_HandWrite\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/ChenAI-TGF/PDF_HandWrite</a><br />\n欢迎大家下载，如果觉得有用的话可以给我点个Star，万分感谢！！<br />\n如果登不上Github的话也欢迎直接私信博主要代码</strong></p>\n<p><img alt=\"在这里插入图片描述\" class=\"lazyload\" /></p>\n<h2 id=\"流程思路总览\">流程思路总览</h2>\n<p>这款 PDF 手写模拟器的整体运作流程可以分为「用户操作流程」和「技术实现流程」两层，清晰易懂：</p>\n<h2 id=\"1--用户操作流程简单易上手\">1.  用户操作流程（简单易上手）</h2>\n<ol>\n<li>\n<p>打开目标 PDF：选择需要填写的实验报告、作业等 PDF 文件；<br />\n<img alt=\"在这里插入图片描述\" class=\"lazyload\" /><br />\n<img alt=\"在这里插入图片描述\" class=\"lazyload\" /></p>\n</li>\n<li>\n<p>框选填写区域：在 PDF 预览界面拖动鼠标，框选出需要插入文字的区域（红色矩形标记）；<br />\n<img alt=\"在这里插入图片描述\" class=\"lazyload\" /></p>\n</li>\n<li>\n<p>配置手写参数：分别在中文、英文/数字选项卡中调整字体、大小、颜色、扰动效果等参数；<br />\n<img alt=\"在这里插入图片描述\" class=\"lazyload\" /></p>\n</li>\n<li>\n<p>输入并预览文字：在右侧文本框输入需要填写的内容，开启「实时预览」查看手写效果；<br />\n<img alt=\"在这里插入图片描述\" class=\"lazyload\" /><br />\n<img alt=\"在这里插入图片描述\" class=\"lazyload\" /></p>\n</li>\n<li>\n<p>不满意可实时调整参数<br />\n<img alt=\"在这里插入图片描述\" class=\"lazyload\" /></p>\n</li>\n<li>\n<p>确认并保存：效果满意后确认应用笔迹，支持撤销、擦除错误内容，也可保存当前配置为模版，最后导出填写完成的 PDF。</p>\n</li>\n</ol>\n<p><img alt=\"在这里插入图片描述\" class=\"lazyload\" /></p>\n<h3 id=\"2--技术实现流程分层协作\">2.  技术实现流程（分层协作）</h3>\n<ol>\n<li>UI 交互层：基于 tkinter 搭建可视化界面，提供按钮、选项卡、文本框等交互组件，接收用户操作；</li>\n<li>参数配置层：管理中文/英文手写参数，支持配置保存（JSON）与加载，实现模版复用；</li>\n<li>PDF 操作层：基于 PyMuPDF 实现 PDF 的读取、页面渲染、文字插入、擦除、保存等核心操作；</li>\n<li>手写渲染层：核心逻辑层，实现文字排版、语言区分、手写扰动效果生成，最终将模拟手写文字插入 PDF。</li>\n</ol>\n<pre><code class=\"language-bash\">┌─────────────────────┐\n│  UI交互层（tkinter） │  # 可视化交互，接收操作\n└─────────────┬───────┘\n              ▼\n┌─────────────────────┐\n│  参数配置层（JSON）  │  # 参数管理，模版复用\n└─────────────┬───────┘\n              ▼\n┌─────────────────────┐\n│ PDF操作层（PyMuPDF） │  # PDF核心操作（读写/保存等）\n└─────────────┬───────┘\n              ▼\n┌─────────────────────┐\n│  手写渲染层（核心）  │  # 手写效果生成，文字插入\n└─────────────────────┘\n</code></pre>\n<h1 id=\"涉及的具体技术\">涉及的具体技术</h1>\n<p>这款工具基于 Python 生态的常用库开发，技术栈轻量化且实用性强，核心涉及以下技术：</p>\n<ol>\n<li><strong>tkinter</strong>：Python 内置 GUI 库，无需额外安装，负责搭建整个应用的可视化界面，实现按钮点击、参数调整、文本输入、PDF 预览等交互功能；</li>\n<li><strong>PyMuPDF（fitz）</strong>：核心 PDF 处理库，提供高效的 PDF 读取、写入、页面渲染、文字插入、红act标注（擦除功能）等接口，是实现 PDF 编辑的核心依赖；</li>\n<li><strong>Pillow（PIL）</strong>：图像处理库，将 PyMuPDF 渲染出的 PDF 页面像素数据，转换成 tkinter 画布可显示的图像格式，实现 PDF 页面的可视化预览；</li>\n<li><strong>JSON</strong>：轻量级数据格式，用于保存用户配置的手写参数模版（字体、大小、扰动值等），方便后续直接复用，无需重复调整；</li>\n<li><strong>Python 随机数与数学计算</strong>：实现手写效果的「不规则扰动」，模拟真实手写的位置偏移、大小波动、行倾斜等特性；</li>\n<li><strong>TTF 字体支持</strong>：读取自定义 TrueType 字体文件，支持切换不同手写风格字体，适配不同用户的手写习惯。</li>\n</ol>\n<h1 id=\"最终效果演示\">最终效果演示</h1>\n<p><img alt=\"在这里插入图片描述\" class=\"lazyload\" /></p>\n<h1 id=\"代码原理简单讲解手写字体生成--扰动效果\">代码原理简单讲解（手写字体生成 + 扰动效果）</h1>\n<p>我们重点讲解核心功能 —— 手写字体生成与扰动效果的实现，忽略 UI 搭建等辅助代码，聚焦核心逻辑：</p>\n<h2 id=\"一-手写字体生成文字插入-pdf-核心\">一、 手写字体生成（文字插入 PDF 核心）</h2>\n<p>这部分的核心是将文字按规则排版后，插入到 PDF 指定区域，关键步骤如下：</p>\n<ol>\n<li>\n<p><strong>文字与区域预处理</strong><br />\n首先获取文本框中的输入文字，按换行符 <code>\\n</code> 分割成多行，同时将用户框选的预览区域坐标（带缩放比例）转换为 PDF 实际坐标（除以缩放系数 <code>self.zoom</code>），得到真实的填写范围 <code>(x1, y1, x2, y2)</code>。</p>\n<pre><code class=\"language-python\"># 读取输入文字并分割行\ntext = self.text_editor.get(\"1.0\", tk.END).strip(\"\\n\")\nlines = text.split('\\n')\n# 转换为 PDF 实际坐标（去除预览缩放影响）\nx1, y1 = min(self.start_x, self.end_x)/self.zoom, min(self.start_y, self.end_y)/self.zoom\nx2, y2 = max(self.start_x, self.end_x)/self.zoom, max(self.start_y, self.end_y)/self.zoom\n</code></pre>\n</li>\n<li>\n<p><strong>语言区分与参数匹配</strong><br />\n通过 <code>is_chinese</code> 函数判断单个字符是中文还是英文/数字，分别匹配对应的配置参数（中文/英文独立的字体、大小、字距等），确保不同语言的手写效果适配合理。</p>\n<pre><code class=\"language-python\"># 判断是否为中文（含中文标点）\ndef is_chinese(self, char):\n    if '\\u4e00' &lt;= char &lt;= '\\u9fff': return True\n    if char in \"。，、？！：；“”‘’（）《》【】\": return True\n    return False\n\n# 遍历字符时匹配对应语言参数\nlang = 'zh' if self.is_chinese(char) else 'en'\np = self.params[lang]  # 获取对应语言的配置参数\n</code></pre>\n</li>\n<li>\n<p><strong>PDF 文字插入核心 API</strong><br />\n使用 PyMuPDF 的 <code>page.insert_text</code> 方法实现文字插入，这是手写字体生成的关键，核心参数说明如下：</p>\n<ul>\n<li><code>fitz.Point(final_x, final_y)</code>：文字的实际插入坐标（经排版和扰动调整后）；</li>\n<li><code>char</code>：要插入的单个字符（逐字符插入实现精细排版）；</li>\n<li><code>fontsize</code>：字符的实际大小（带大小抖动）；</li>\n<li><code>fontfile</code>：TTF 手写字体文件路径，决定字体风格；</li>\n<li><code>color</code>：文字颜色（默认纯黑，支持用户自定义）；</li>\n<li><code>morph</code>：变换矩阵，实现字符旋转效果（叠加行倾斜与字符旋转抖动）。</li>\n</ul>\n</li>\n<li>\n<p><strong>行与字符排版</strong><br />\n按行遍历文字，逐字符计算插入坐标，处理空格（单独预留间距），当字符横坐标超出框选区域右侧时自动换行，同时根据「行距参数」调整下一行的纵坐标，确保文字排版规整且不超出框选范围。</p>\n</li>\n</ol>\n<h2 id=\"二-扰动效果实现模拟真实手写不规则性\">二、 扰动效果实现（模拟真实手写不规则性）</h2>\n<p>这是工具的灵魂所在，通过「行级扰动」和「字符级扰动」两层效果，彻底摆脱打印体的规整感，贴近真实手写，对应代码中的配置参数：</p>\n<ol>\n<li>\n<p><strong>行级扰动（整行不规则性）</strong><br />\n针对每一行文字，添加整体的偏移和倾斜，模拟手写时「行不直、略有偏移」的特点，对应三个参数：</p>\n<ul>\n<li>行左右平移（<code>line_jitter_x</code>）：随机生成 <code>-line_jitter_x ~ line_jitter_x</code> 范围内的偏移量 <code>line_dx</code>，使每行文字左右轻微晃动；</li>\n<li>行上下平移（<code>line_jitter_y</code>）：随机生成 <code>-line_jitter_y ~ line_jitter_y</code> 范围内的偏移量 <code>line_dy</code>，使行与行之间的间距略有差异；</li>\n<li>行整行倾斜（<code>line_tilt</code>）：随机生成倾斜角度 <code>line_angle_deg</code>，转换为弧度后，通过 <code>tilt_y_offset = (curr_x - line_start_x) * math.tan(line_angle_rad)</code> 计算每个字符的Y轴偏移，实现整行轻微倾斜。</li>\n</ul>\n<pre><code class=\"language-python\"># 行级扰动参数计算\nline_dx = random.uniform(-p_line['line_jitter_x'].get(), p_line['line_jitter_x'].get())\nline_dy = random.uniform(-p_line['line_jitter_y'].get(), p_line['line_jitter_y'].get())\nline_angle_deg = random.uniform(-p_line['line_tilt'].get(), p_line['line_tilt'].get())\nline_angle_rad = math.radians(line_angle_deg)\n</code></pre>\n</li>\n<li>\n<p><strong>字符级扰动（单个字符不规则性）</strong><br />\n针对每个字符，添加位置、大小、旋转的细微差异，模拟手写时「每个字大小不一、略有晃动」的特点，对应三个参数：</p>\n<ul>\n<li>字位置抖动（<code>jitter_pos</code>）：随机生成 <code>(-jitter_pos ~ jitter_pos)</code> 的X、Y偏移量，使字符脱离严格的水平对齐；</li>\n<li>字大小抖动（<code>jitter_size</code>）：在基础字体大小上，随机增减 <code>(-jitter_size ~ jitter_size)</code> 的数值，生成 <code>char_jitter_fs</code>，使字符大小略有差异；</li>\n<li>字旋转抖动（<code>jitter_rot</code>）：随机生成 <code>(-jitter_rot ~ jitter_rot)</code> 的旋转角度，叠加行倾斜角度后，通过 <code>morph</code> 参数实现字符轻微旋转。</li>\n</ul>\n<pre><code class=\"language-python\"># 字符级扰动参数计算\nchar_jitter_x = random.uniform(-p['jitter_pos'].get(), p['jitter_pos'].get())\nchar_jitter_y = random.uniform(-p['jitter_pos'].get(), p['jitter_pos'].get())\nchar_jitter_rot = random.uniform(-p['jitter_rot'].get(), p['jitter_rot'].get())\nchar_jitter_fs = f_size + random.uniform(-p['jitter_size'].get(), p['jitter_size'].get())\n</code></pre>\n</li>\n<li>\n<p><strong>随机数控制（预览稳定 + 实际随机）</strong><br />\n为了保证实时预览时效果稳定可调整，设置随机数种子 <code>random.seed(42)</code> 固定扰动效果；实际应用笔迹时，不设置种子 <code>random.seed()</code>，生成随机的扰动效果，让每次生成的手写风格略有差异，更贴近真实场景。</p>\n<pre><code class=\"language-python\">if is_preview: random.seed(42)  # 预览模式：固定随机数，效果稳定\nelse: random.seed()  # 实际生成：随机种子，效果更真实\n</code></pre>\n</li>\n</ol>\n<h1 id=\"总结\">总结</h1>\n<p>这款 PDF 手写模拟器完美解决了手写作业、实验报告的痛点，兼具「实用性」和「灵活性」：</p>\n<ol>\n<li><strong>实用性拉满</strong>：无需手动抄写，一键生成手写风格 PDF，节省大量时间和精力，生成效果高度贴近真实手写；</li>\n<li><strong>自定义性强</strong>：中文/英文独立配置，支持字体、颜色、大小、字距行距调整，多层扰动参数可精细调控手写风格；</li>\n<li><strong>操作便捷</strong>：可视化界面友好，支持实时预览、撤销、擦除、模版复用，零基础用户也能快速上手；</li>\n<li><strong>技术轻量化</strong>：基于 Python 常用库开发，无需复杂环境配置，代码可灵活修改扩展。</li>\n</ol>\n<p>当然，这款工具还有优化空间，比如支持连笔效果、笔迹粗细变化、批量处理多个 PDF 等。如果大家有类似需求，可以基于这份代码进行二次开发，适配自己的使用场景。希望这款工具能帮大家解放双手，把更多时间投入到核心学习和研究中！</p>\n<p><strong>代码已经开源在Github：<a href=\"https://github.com/ChenAI-TGF/PDF_HandWrite\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/ChenAI-TGF/PDF_HandWrite</a><br />\n欢迎大家下载，如果觉得有用的话可以给我点个Star，万分感谢！！<br />\n如果登不上Github的话也欢迎直接私信博主要代码</strong></p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-01 15:59</span>&nbsp;\n<a href=\"https://www.cnblogs.com/ChenAI-TGF\">TTGF</a>&nbsp;\n阅读(<span id=\"post_view_count\">55</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "Perigon.CLI 10.0 重磅发布【AspNetCore开发模板和辅助工具】",
      "link": "https://www.cnblogs.com/msdeveloper/p/19430150/perigon-10-announce",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/msdeveloper/p/19430150/perigon-10-announce\" id=\"cb_post_title_url\" title=\"发布于 2026-01-01 15:18\">\n    <span>Perigon.CLI 10.0 重磅发布【AspNetCore开发模板和辅助工具】</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"-perigoncli-100-重磅发布\">🎉 Perigon.CLI 10.0 重磅发布</h1>\n<p><img alt=\"perigon_logo320\" src=\"https://img2024.cnblogs.com/blog/1074783/202601/1074783-20260101151334306-54452182.png\" /></p>\n<p>我们很高兴地宣布，Perigon.CLI 10.0 现已正式发布！此次更新带来了众多令人兴奋的新功能和改进，旨在提升开发者的生产力和开发体验。</p>\n<p>简而言之，Perigon是围绕<code>Aspire/AspNetCore/EF Core</code>等相关技术栈的开发辅助工具，帮助你快速构建可维护的项目，它主要提供：</p>\n<ul>\n<li><strong>项目脚手架</strong>：通过解决方案模板(Perigon.templates)，快速创建符合最佳实践的项目结构。</li>\n<li><strong>代码生成器</strong>：提供WebUI界面，用来通过实体来生成对应的增删改查代码，以及客户端请求服务的生成，极大减少重复劳动；同时提供自定义模板功能，满足不同项目需求。</li>\n<li><strong>MCP</strong>: 提供MCP支持，以与现有IDE中的AI集成。</li>\n<li><strong>命令行工具</strong>：用来创建解决方案/启动WebUI/生成客户端请求服务等。</li>\n</ul>\n<h2 id=\"由来\">由来</h2>\n<p>最初，它只是我个人在开发前后端项目时，为了减少重复劳动而开发的简单的项目分层脚手架和代码生成工具。当时(2020年)它叫<code>GT.CLI</code>和<code>GT.Framework.Web</code>。</p>\n<p>2021年，重构了结构，并开始在团队项目中使用，模板改名为<code>ater.web.templates</code>，CLI工具也经过两次大改，分别为<code>ater.droplet.cli</code>和<code>ater.dry</code>，它加入了一些公司内项目需求的功能，如提供更多开箱即用的模块。</p>\n<blockquote>\n<p>[!TIP]<br />\n以上工具可在<code>nuget</code>中找到，但都不再维护。</p>\n</blockquote>\n<h2 id=\"-现在\">✨ 现在</h2>\n<p>2025年.NET10发布，在年初，我开始计划进行全面的重构和优化，提供一个全新的版本，完全基于.NET10，不再兼容之前的版本，经过数月的开发和测试，最终发布了<code>Perigon.CLI</code>和<code>Perigon.templates</code>，该版本主要的特点包括：</p>\n<ul>\n<li>\n<p>操作界面从<code>Angular</code>改为<code>Blazer server</code>，使用<code>fluent-ui</code>组件库，从技术到视觉上都更贴近<code>NET</code>生态。</p>\n</li>\n<li>\n<p>在项目结构上，去复杂化，更加通用。去除了以下设计</p>\n<ul>\n<li><code>仓储模式</code></li>\n<li>默认使用<code>QueryDbContext</code>和<code>CommandDbContext</code>的设计，需要多一层DataAccess来抽象。</li>\n<li>默认生成业务接口类</li>\n<li><code>[Module]</code>特性，直接使用目录结构来区分模块</li>\n<li>其他不必要的抽象和复杂设计</li>\n</ul>\n</li>\n<li>\n<p>重构项目结构，并添加了更多通用和实用的功能</p>\n<ul>\n<li>引入Aspire：解决开发环境基础设施和多服务支持问题</li>\n<li>多服务支持：结合单体和微服务，一个解决方案都搞定</li>\n<li>多租户支持：通过配置在单租户和多租户间切换</li>\n<li>多数据库支持：通过工厂模式支持多种数据库</li>\n<li>多语言支持：内置多语言支持，方便国际化</li>\n<li>MCP支持：直接在IDE中调用工具生成代码</li>\n<li>源代码生成器支持(多语言和自动注入Manager)</li>\n</ul>\n</li>\n</ul>\n<p>更为重要的是，新版本确定了一些核心设计原则：</p>\n<ul>\n<li>通用且开放：不依托于特定设计模式或架构，优先使用通用且成熟的技术栈</li>\n<li>简单易用：不引入新的设计模式或理论，降低学习成本和心智负担</li>\n<li>以开发者为中心：提高开发效率和使用体验是主要目标</li>\n</ul>\n<p>现在，你可以通过我们的📚<a href=\"https://dusi.dev/docs/Perigon.html\" rel=\"noopener nofollow\" target=\"_blank\">官方文档</a>，了解如何安装和使用<code>Perigon.CLI</code>，并开始你的高效开发之旅！</p>\n<h2 id=\"未来\">🚀未来</h2>\n<p>未来将在三个方面持续改进：</p>\n<ul>\n<li>生产力。如今我们通过IDE和代码生成器避免重复性的工作。而今年使用code agent编程已经是非常平常的事情，其能力和效果无需多言，虽然还有些局限性，但其能力还在不断提升。我们会将更多AI编程的实践经验融入到工具中，进一步提升开发效率和开发体验。</li>\n<li>性能。在保持模板框架稳定的基础上，尽可能的提升性能，完善性能方面的最佳实践(文档说明)。</li>\n<li>生态。我们将基于<code>perigon</code>构建更多的内容，如身份验证系统，AIAgent系统等，也就是在基础框架的基础上，提供更多面向特定场景的解决方案。此外，还将尝试对模块进行打包和分发，进一步提高复用性和可维护性。</li>\n</ul>\n<h3 id=\"版本计划\">版本计划</h3>\n<p>对于<code>Perigon.CLI</code>，它将跟随<code>.NET</code>的版本迭代进行更新，计划每年发布一个大版本，单数版本会同时支持上一个LTS版本，偶数版本只支持当前LTS版本。</p>\n<p>对于``Perigon.templates<code>，它从</code>1.0.0`开始，由于它影响整个项目的结构和技术选型，未来主要专注于问题修复和性能提升。新的功能特性尽可能在不改变现有结构的前提下进行添加。</p>\n<h2 id=\"️️社区参与\">🏃‍♂️‍➡️社区参与</h2>\n<p>如果你对.NET开发有兴趣，并希望参与到Perigon.CLI的建设中来，欢迎访问我们的<a href=\"https://github.com/AterDev/Perigon.CLI\" rel=\"noopener nofollow\" target=\"_blank\">GitHub仓库</a>，提交你的想法、建议或贡献代码。我们期待与你一起打造更好的开发工具！</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-01 15:18</span>&nbsp;\n<a href=\"https://www.cnblogs.com/msdeveloper\">TypingLearn</a>&nbsp;\n阅读(<span id=\"post_view_count\">59</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "2025年度总结",
      "link": "https://www.cnblogs.com/SilverGo/p/19428614",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/SilverGo/p/19428614\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 22:47\">\n    <span>2025年度总结</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"table-of-contents\">Table of Contents</h1>\n<ol>\n<li><a href=\"#org936be25\" rel=\"noopener nofollow\">2025年度总结</a></li>\n<li><a href=\"#org07aceb4\" rel=\"noopener nofollow\">关于Ctorch</a></li>\n<li><a href=\"#orgc1859ea\" rel=\"noopener nofollow\">关于CSP-J</a></li>\n<li><a href=\"#org1d85aae\" rel=\"noopener nofollow\">关于lambda演算、UTM（通用图灵机）、Coq</a></li>\n<li><a href=\"#org9a42a9e\" rel=\"noopener nofollow\">关于汇编</a></li>\n<li><a href=\"#orgabafce1\" rel=\"noopener nofollow\">一些感想</a></li>\n<li><a href=\"#org89cb23b\" rel=\"noopener nofollow\">资料</a></li>\n<li><a href=\"#org3319ea0\" rel=\"noopener nofollow\">结语</a></li>\n</ol>\n<p>Powered by GhostFace's Emacs.</p>\n<p><a id=\"org936be25\"></a></p>\n<h1 id=\"2025年度总结\">2025年度总结</h1>\n<p><a id=\"org07aceb4\"></a></p>\n<h2 id=\"关于ctorch\">关于Ctorch</h2>\n<p><strong>Ctorch 诞生的第166天。</strong><br />\n没想到，ct都这么大了，<strong>从一个单人项目到现在4人的小团队，从一个模糊的想法到如今近万行的代码，总计5个月13天。</strong></p>\n<p>不得不说，这段时间，学到了很多。</p>\n<p><strong>从来没有用过git的人，commit了近160次；<br />\n从来没有接触过汇编的人，为了极限优化、搞懂编译器行为，学了2个月的汇编；<br />\n曾经连类都没写过的人，写了5个几千行的类；<br />\n曾经连朴素矩阵乘都不会写的菜鸡，手搓了一个Strassen+分块的并行矩阵乘</strong>；<br />\n诸如此类，不再列举。</p>\n<p><a id=\"orgc1859ea\"></a></p>\n<h2 id=\"关于csp-j\">关于CSP-J</h2>\n<p>本蒟蒻已经很长时间没有更新过日志了，可能的原因是比较忙。</p>\n<p><strong>最近几个月，本人一直在忙CSP-J的准备、Ctorch的开发、Coq的学习与lambda演算上。<br />\n先在暑假发起了「挑战3个月达省一」的挑战（当然，挑战成功了）</strong>；</p>\n<p>这一段时间，刷的题比我之前一年刷的都多；</p>\n<p>20多天，我学习了：<strong>dp、图论、并查集、加权并查集、模拟退火等算法，之前一年也只学了排序；</strong></p>\n<p><strong>怎么说呢，之前一直没搞清楚的搜索算法，现在看来也不过如此。</strong></p>\n<p><a id=\"org1d85aae\"></a></p>\n<h2 id=\"关于lambda演算utm通用图灵机coq\">关于lambda演算、UTM（通用图灵机）、Coq</h2>\n<p>随后，先是因为知道了C++有个叫lambda表达式的东西，随后在洛谷上搜索，<strong>意外看到了一篇讲lambda演算的文章</strong>；</p>\n<p>抱着在学校上课无聊的心态，学习了lambda演算，结果一发不可收拾。</p>\n<p>学完之后，我得知<strong>lambda演算图灵完备，于是乎，我想起了一个好玩的东西：用无类型lambda演算手搓UTM（通用图灵机），这当然理论可行</strong>。</p>\n<p>反正我平时能够思考的时间很多，在问过AI后，得知这是一次非常困难但是收获极大的挑战，我便开始了我的构建。</p>\n<p><strong>一支笔，一个本，一个脑子，不看论文，不搜索，只思考。<br />\n每天上放学的路上，走着需要35min左右，这段时间，我就会不停地思考关于UTM的问题。<br />\n这个过程很爽，因为我在构建一个完整的世界，理论上，这台「仅仅依靠代入完成计算」的“计算机”可以完成任何工作，只要你想，甚至可以跑一个仿真的Windows.</strong></p>\n<p>写了快几十张纸，我才明白，AI说的那句：<strong>「lambda演算可以练习思维」</strong>，突然有一天，我看待调用、递归的感觉完全变了，我看函数的感觉也变了。</p>\n<p><strong>我们都觉得，是先有了数字，才有了函数;</strong><br />\n但是，Church数字告诉我们，<strong>数字也是函数</strong>。</p>\n<p>（这个名为LUTM的UTM仍在设计，不过，由于Ctorch对我的优先级更高，目前暂时停工，等2月16日发布Ctorch RC 1之后再继续）</p>\n<p><strong>学习完lambda演算后，我接触到了Coq。<br />\nCoq证明「加法左零律」的思路让我感觉无比震惊，这完全颠覆了我对数学归纳法的认知</strong>。</p>\n<p><strong>而且，Coq中对自然数的定义和lambda演算的列表出奇的一致。<br />\n怎么说呢，可能这就是「万变不离其宗」吧.</strong><br />\n但是仍然是为了Ctorch的开发，我暂停了Coq的学习。</p>\n<p><a id=\"org9a42a9e\"></a></p>\n<h2 id=\"关于汇编\">关于汇编</h2>\n<p>在这之后，我学习了Arm64汇编。<br />\n仅仅是写出一个Hello World，我就花了2天（当然，我在学校每天只有10min能用电脑，20min可以和AI对话）.<br />\n但仅此一次，我就明白了，C++中递归、调用是如何做的，本质其实就是将x29,x30寄存器的值修改；<br />\n我也明白了，什么是「栈溢出」，什么是「调用栈」。<br />\n几行的C++换成汇编就可能需要数十行，这让我写代码时会思考着汇编的样子。<br />\n不得不说，这确实是一次很好的历练。</p>\n<p><a id=\"orgabafce1\"></a></p>\n<h2 id=\"一些感想\">一些感想</h2>\n<p>回首这几个月我所经历的，可能比我之前一年学的都要多，都要杂；</p>\n<p><strong>这些知识无疑带给了我很强的塑造作用：<br />\n设计LUTM，锻炼了我进行2小时以上的深度思考的能力；<br />\n学习汇编，让我对底层有了掌控；<br />\n学习lambda演算，让我对函数有了更彻底的认识；<br />\n可以说，对一个初中生而言，这条路径独一无二。<br />\n我结识了一群志同道合的朋友，有了自己的团队、组织；<br />\n曾经那个被嘲笑“写这些有什么用”、“连个奖都拿不到”的人，如今竟成为一个开源项目的开发者、CSP-J的省一。</strong><br />\n<strong>毫无疑问，这是无比有价值的半年；</strong></p>\n<p><a id=\"org89cb23b\"></a></p>\n<h1 id=\"资料\">资料</h1>\n<p>下面放一点资料</p>\n<p>1.设计LUTM时与Deepseek的对话：<a href=\"https://chat.deepseek.com/share/wednovjlp5sa013j4q\" rel=\"noopener nofollow\" target=\"_blank\">https://chat.deepseek.com/share/wednovjlp5sa013j4q</a><br />\n2.文章：《恭喜自己，挑战成功》————CSP-J省一获奖感言：<a href=\"https://www.cnblogs.com/SilverGo/p/19223328\" target=\"_blank\">https://www.cnblogs.com/SilverGo/p/19223328</a><br />\n3.文章：《逆袭导论·初中生的宝书》：<a href=\"https://www.cnblogs.com/SilverGo/p/19284999\" target=\"_blank\">https://www.cnblogs.com/SilverGo/p/19284999</a><br />\n4.文章：《矩阵乘法优化》：<a href=\"https://www.cnblogs.com/SilverGo/p/19019364\" target=\"_blank\">https://www.cnblogs.com/SilverGo/p/19019364</a><br />\n5.Ctorch的github：<a href=\"https://github.com/ShengFlow/CTorch/tree/feature-nn.Module?tab=contributing-ov-file\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/ShengFlow/CTorch/tree/feature-nn.Module?tab=contributing-ov-file</a><br />\n6.以下是图片：<br />\n<img alt=\"截屏2025-12-28 10.22.19\" height=\"982\" src=\"https://img2024.cnblogs.com/blog/3357339/202512/3357339-20251231224442471-111964913.png\" width=\"1512\" /><br />\n<img alt=\"截屏2025-12-18 06.31.21\" height=\"982\" src=\"https://img2024.cnblogs.com/blog/3357339/202512/3357339-20251231224520016-1653169643.png\" width=\"1512\" /><br />\n<img alt=\"截屏2025-10-04 16.25.21\" height=\"982\" src=\"https://img2024.cnblogs.com/blog/3357339/202512/3357339-20251231224619686-610660255.png\" width=\"1512\" /></p>\n<p><a id=\"org3319ea0\"></a></p>\n<h1 id=\"结语\">结语</h1>\n<blockquote>\n<p>“Put yourself in places that are gonna cause you to stretch<br />\n让自己置身于能促使自己突破的境地<br /><br />\nA fighter isn't someone that never fails<br />\n真正的勇士并非永不失败<br /><br />\nA fighter is someone who never quits<br />\n而是永不言弃<br /><br />\nYou are more to me than you could never now<br />\n你对我而言远比自己想象的更重要<br /><br />\nAnd I know I've got a full room of fighters in here right<br />\n此刻我深知这满座皆是勇者”<br /></p>\n</blockquote>\n<blockquote>\n<p>“I see ,I like ,I go ,I get.<br />\n目之所及，心之所向，踏上征程，志在必得！”<br /></p>\n</blockquote>\n<blockquote>\n<p>“为天地立心，<br /><br />\n为生民立命，<br /><br />\n为往圣继绝学，<br /><br />\n为万世开太平”————宋·张载《横渠四句》<br /></p>\n</blockquote>\n<blockquote>\n<p>“身处低谷不自弃，我命由我不由天。<br /><br />\n无人扶我青云志，我自踏雪至山巅。<br /><br />\n若是命中无此运，亦可孤身登昆仑。<br /><br />\n红尘赠我三尺剑，酒换瘦马一世街。<br /><br />\n世人朝路乃绝涧，独见众生止步前。<br /><br />\n海到尽头天作岸，山登绝顶我为峰。<br /><br />\n如若东山能再起，大鹏展翅九万里。<br /><br />\n一入红尘梦易真，一朝悟透心境名。<br /><br />\n一朝悟道见真我，昔日枷锁皆云烟。<br /><br />\n天门将至百运开，拂尘轻笑问仙来。<br /><br />\n何须扶我青云志，我自凌云至山巅！”————徐霞客《青云志》<br /></p>\n</blockquote>\n<p><strong>2025，对我而言，注定是难忘的一年.</strong><br />\n<strong>诸位，新年快乐！</strong></p>\n<p><strong>预告：我们预计在2026.2.16（除夕）发布Ctorch RC v1.0，敬请期待，欢迎联系：QQ 1113109729，参与内测，感激不尽！</strong></p>\n<p>GhostFace<br />\n2025.12.31</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 22:47</span>&nbsp;\n<a href=\"https://www.cnblogs.com/SilverGo\">Ghost-Face</a>&nbsp;\n阅读(<span id=\"post_view_count\">131</span>)&nbsp;\n评论(<span id=\"post_comment_count\">2</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "【大数据 & AI】Flink Agents 源码解读 --- (3) --- Agent",
      "link": "https://www.cnblogs.com/rossiXYZ/p/19369869",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/rossiXYZ/p/19369869\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäºŽ 2025-12-31 19:17\">\n    <span>ã€å¤§æ•°æ® &amp; AIã€‘Flink Agents æºç è§£è¯» --- (3) --- Agent</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"å¤§æ•°æ®--aiflink-agents-æºç è§£è¯»-----3------agent\">ã€å¤§æ•°æ® &amp; AIã€‘Flink Agents æºç è§£è¯» --- (3) ---  Agent</h1>\n<p></p><div class=\"toc\"><div class=\"toc-container-header\">ç›®å½•</div><ul><li><a href=\"#å¤§æ•°æ®--aiflink-agents-æºç è§£è¯»-----3------agent\" rel=\"noopener nofollow\">ã€å¤§æ•°æ® &amp; AIã€‘Flink Agents æºç è§£è¯» --- (3) ---  Agent</a><ul><li><a href=\"#0x00-æ¦‚è¦\" rel=\"noopener nofollow\">0x00 æ¦‚è¦</a></li><li><a href=\"#0x01-æ ¸å¿ƒæŠ½è±¡\" rel=\"noopener nofollow\">0x01 æ ¸å¿ƒæŠ½è±¡</a><ul><li><a href=\"#11-agentæŠ½è±¡\" rel=\"noopener nofollow\">1.1 AgentæŠ½è±¡</a></li><li><a href=\"#12-action-æŠ½è±¡\" rel=\"noopener nofollow\">1.2 Action æŠ½è±¡</a></li><li><a href=\"#13-èµ„æºæŠ½è±¡\" rel=\"noopener nofollow\">1.3 èµ„æºæŠ½è±¡</a></li><li><a href=\"#14-æ‰§è¡ŒçŽ¯å¢ƒæŠ½è±¡\" rel=\"noopener nofollow\">1.4 æ‰§è¡ŒçŽ¯å¢ƒæŠ½è±¡</a></li><li><a href=\"#15-äº‹ä»¶æŠ½è±¡\" rel=\"noopener nofollow\">1.5 äº‹ä»¶æŠ½è±¡</a></li><li><a href=\"#16-é…ç½®æŠ½è±¡\" rel=\"noopener nofollow\">1.6 é…ç½®æŠ½è±¡</a></li></ul></li><li><a href=\"#0x02-workflow-style-agent-å’Œreactagent\" rel=\"noopener nofollow\">0x02 Workflow Style Agent å’ŒReActAgent</a><ul><li><a href=\"#21-ç‰¹æ€§\" rel=\"noopener nofollow\">2.1 ç‰¹æ€§</a><ul><li><a href=\"#211-è®¾è®¡ç†å¿µ\" rel=\"noopener nofollow\">2.1.1 è®¾è®¡ç†å¿µ</a></li><li><a href=\"#212-æŽ§åˆ¶æµ\" rel=\"noopener nofollow\">2.1.2 æŽ§åˆ¶æµ</a></li><li><a href=\"#213-å®šåˆ¶çº§åˆ«\" rel=\"noopener nofollow\">2.1.3 å®šåˆ¶çº§åˆ«</a></li><li><a href=\"#214-ä½¿ç”¨åœºæ™¯\" rel=\"noopener nofollow\">2.1.4 ä½¿ç”¨åœºæ™¯</a></li><li><a href=\"#215-å¼€å‘å¤æ‚åº¦\" rel=\"noopener nofollow\">2.1.5 å¼€å‘å¤æ‚åº¦</a></li><li><a href=\"#216-æ€»ç»“\" rel=\"noopener nofollow\">2.1.6 æ€»ç»“</a></li></ul></li><li><a href=\"#22-workflow\" rel=\"noopener nofollow\">2.2 workflow</a><ul><li><a href=\"#221-ä»£ç å¯¼è¯»\" rel=\"noopener nofollow\">2.2.1 ä»£ç å¯¼è¯»</a><ul><li><a href=\"#å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ\" rel=\"noopener nofollow\">å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ</a></li><li><a href=\"#åˆ›å»ºä»£ç†\" rel=\"noopener nofollow\">åˆ›å»ºä»£ç†</a></li><li><a href=\"#ä¸Ž-flink-é›†æˆ\" rel=\"noopener nofollow\">ä¸Ž Flink é›†æˆ</a></li></ul></li></ul></li><li><a href=\"#23-react-agent\" rel=\"noopener nofollow\">2.3 ReAct Agent</a><ul><li><a href=\"#231-ä»£ç å¯¼è¯»\" rel=\"noopener nofollow\">2.3.1 ä»£ç å¯¼è¯»</a><ul><li><a href=\"#å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ-1\" rel=\"noopener nofollow\">å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ</a></li><li><a href=\"#åˆ›å»º-react-agent\" rel=\"noopener nofollow\">åˆ›å»º ReAct Agent</a></li><li><a href=\"#ä¸Ž-flink-é›†æˆ-1\" rel=\"noopener nofollow\">ä¸Ž Flink é›†æˆ</a></li></ul></li></ul></li></ul></li><li><a href=\"#0x03-reactagent\" rel=\"noopener nofollow\">0x03 ReActAgent</a><ul><li><a href=\"#31-å®šä¹‰\" rel=\"noopener nofollow\">3.1 å®šä¹‰</a></li><li><a href=\"#32-æ·±åº¦å®šåˆ¶\" rel=\"noopener nofollow\">3.2 æ·±åº¦å®šåˆ¶</a><ul><li><a href=\"#321-reactagent-ç‰¹è‰²\" rel=\"noopener nofollow\">3.2.1 ReActAgent ç‰¹è‰²</a><ul><li><a href=\"#æµå¼å¤„ç†é€‚é…\" rel=\"noopener nofollow\">æµå¼å¤„ç†é€‚é…</a></li><li><a href=\"#ç‰¹å®šçš„è¡Œä¸ºæ¨¡å¼\" rel=\"noopener nofollow\">ç‰¹å®šçš„è¡Œä¸ºæ¨¡å¼</a></li><li><a href=\"#é”®æŽ§çŠ¶æ€æ”¯æŒ\" rel=\"noopener nofollow\">é”®æŽ§çŠ¶æ€æ”¯æŒ</a></li><li><a href=\"#llm-é›†æˆä¼˜åŒ–\" rel=\"noopener nofollow\">LLM é›†æˆä¼˜åŒ–</a></li><li><a href=\"#èµ„æºç®¡ç†æ–¹å¼\" rel=\"noopener nofollow\">èµ„æºç®¡ç†æ–¹å¼</a></li><li><a href=\"#ç±»åž‹ä¿¡æ¯å¤„ç†\" rel=\"noopener nofollow\">ç±»åž‹ä¿¡æ¯å¤„ç†</a></li><li><a href=\"#é”™è¯¯å¤„ç†æœºåˆ¶\" rel=\"noopener nofollow\">é”™è¯¯å¤„ç†æœºåˆ¶</a></li><li><a href=\"#ç»“æž„åŒ–è¾“å‡ºæ”¯æŒ\" rel=\"noopener nofollow\">ç»“æž„åŒ–è¾“å‡ºæ”¯æŒ</a></li><li><a href=\"#æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ\" rel=\"noopener nofollow\">æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ</a></li><li><a href=\"#å·¥å…·è°ƒç”¨é›†æˆ\" rel=\"noopener nofollow\">å·¥å…·è°ƒç”¨é›†æˆ</a></li><li><a href=\"#è¿è¡Œæ—¶åä½œ\" rel=\"noopener nofollow\">è¿è¡Œæ—¶åä½œ</a></li></ul></li></ul></li><li><a href=\"#33-å…¸åž‹æ‰§è¡Œæµç¨‹\" rel=\"noopener nofollow\">3.3 å…¸åž‹æ‰§è¡Œæµç¨‹</a></li><li><a href=\"#34-start_action-ä¸Ž-stop_action\" rel=\"noopener nofollow\">3.4 start_action ä¸Ž stop_action</a></li><li><a href=\"#35-è¾“å…¥è¾“å‡º\" rel=\"noopener nofollow\">3.5 è¾“å…¥è¾“å‡º</a><ul><li><a href=\"#351-äº‹ä»¶é©±åŠ¨æž¶æž„\" rel=\"noopener nofollow\">3.5.1 äº‹ä»¶é©±åŠ¨æž¶æž„</a></li><li><a href=\"#352-ç»Ÿä¸€çš„æ•°æ®å°è£\" rel=\"noopener nofollow\">3.5.2 ç»Ÿä¸€çš„æ•°æ®å°è£…</a></li><li><a href=\"#353-æ”¯æŒå¤šç§æ•°æ®ç±»åž‹\" rel=\"noopener nofollow\">3.5.3 æ”¯æŒå¤šç§æ•°æ®ç±»åž‹</a></li><li><a href=\"#354-å†…ç½®æ¨¡æ¿æ”¯æŒ\" rel=\"noopener nofollow\">3.5.4 å†…ç½®æ¨¡æ¿æ”¯æŒ</a></li></ul></li><li><a href=\"#36-æ¨¡æ¿ç³»ç»Ÿ\" rel=\"noopener nofollow\">3.6 æ¨¡æ¿ç³»ç»Ÿ</a><ul><li><a href=\"#361-å­—ç¬¦ä¸²æ¨¡æ¿\" rel=\"noopener nofollow\">3.6.1 å­—ç¬¦ä¸²æ¨¡æ¿</a></li><li><a href=\"#362-æ¶ˆæ¯æ¨¡æ¿\" rel=\"noopener nofollow\">3.6.2 æ¶ˆæ¯æ¨¡æ¿</a></li></ul></li><li><a href=\"#37-functiontool-ä¸Ž-action-çš„å…³è”åŠæ³¨å†Œæœºåˆ¶\" rel=\"noopener nofollow\">3.7 FunctionTool ä¸Ž Action çš„å…³è”åŠæ³¨å†Œæœºåˆ¶</a><ul><li><a href=\"#371-å®žé™…è½¬æ¢æµç¨‹\" rel=\"noopener nofollow\">3.7.1 å®žé™…è½¬æ¢æµç¨‹</a><ul><li><a href=\"#function-tool-æ³¨å†Œåˆ°-agent\" rel=\"noopener nofollow\">Function Tool æ³¨å†Œåˆ° Agent</a></li><li><a href=\"#ä¸Žæ¨¡åž‹äº¤äº’\" rel=\"noopener nofollow\">ä¸Žæ¨¡åž‹äº¤äº’</a></li></ul></li><li><a href=\"#372-agentplan-ç¼–è¯‘è¿‡ç¨‹ä¸­å·¥å…·çš„å¤„ç†\" rel=\"noopener nofollow\">3.7.2 AgentPlan ç¼–è¯‘è¿‡ç¨‹ä¸­å·¥å…·çš„å¤„ç†</a><ul><li><a href=\"#ç”¨æˆ·å®šä¹‰çš„-function-tool-è½¬æ¢ä¸º-action\" rel=\"noopener nofollow\">ç”¨æˆ·å®šä¹‰çš„ Function Tool è½¬æ¢ä¸º Action</a></li><li><a href=\"#å†…ç½®-tool-call-action\" rel=\"noopener nofollow\">å†…ç½® Tool Call Action</a></li><li><a href=\"#tool_call_action-å¦‚ä½•ç¼–è¯‘åˆ°agentplan\" rel=\"noopener nofollow\">TOOL_CALL_ACTION å¦‚ä½•ç¼–è¯‘åˆ°AgentPlan</a></li></ul></li><li><a href=\"#373-å·¥å…·è°ƒç”¨æµç¨‹\" rel=\"noopener nofollow\">3.7.3 å·¥å…·è°ƒç”¨æµç¨‹</a></li><li><a href=\"#374-å®Œæ•´æµç¨‹å›¾\" rel=\"noopener nofollow\">3.7.4 å®Œæ•´æµç¨‹å›¾</a></li><li><a href=\"#375-ä»£ç \" rel=\"noopener nofollow\">3.7.5 ä»£ç </a></li></ul></li></ul></li><li><a href=\"#0xff-å‚è€ƒ\" rel=\"noopener nofollow\">0xFF å‚è€ƒ</a></li></ul></li></ul></div><p></p>\n<h2 id=\"0x00-æ¦‚è¦\">0x00 æ¦‚è¦</h2>\n<p>Agentæ˜¯ Flink Agent æ¡†æž¶çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯æ‰§è¡Œå•å…ƒï¼Œç”¨äºŽå¤„ç†è¾“å…¥äº‹ä»¶å¹¶ç”Ÿæˆè¾“å‡ºäº‹ä»¶ã€‚ä¸»è¦åŠŸèƒ½å’Œç‰¹è‰²å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>äº‹ä»¶é©±åŠ¨å¤„ç†ï¼šåŸºäºŽäº‹ä»¶é©±åŠ¨æž¶æž„ï¼Œå“åº”ä¸åŒç±»åž‹çš„äº‹ä»¶ï¼ˆå¦‚ InputEventï¼ŒChatRequestEventç­‰ï¼‰ï¼Œé€šè¿‡å®šä¹‰actionsæ¥å¤„ç†ç‰¹å®šäº‹ä»¶ç±»åž‹ã€‚</li>\n<li>èµ„æºç®¡ç†ï¼šç®¡ç†å„ç§èµ„æºï¼Œå¦‚èŠå¤©æ¨¡åž‹ã€å·¥å…·ã€æç¤ºè¯ç­‰ã€‚æ”¯æŒå¤šç§èµ„æºç±»åž‹ï¼ˆCHAT_MOEL, TOOL, PROMPTç­‰ï¼‰ã€‚</li>\n<li>å¯æ‰©å±•æ€§ï¼šæ”¯æŒè‡ªå®šä¹‰çš„actionså’Œèµ„æºï¼Œå¯ä»¥é€šè¿‡ç»§æ‰¿Agentç±»æ¥åˆ›å»ºç‰¹å®šåŠŸèƒ½çš„Agentï¼Œå¦‚ReActAgentã€‚</li>\n<li>é…ç½®æ”¯æŒï¼šæ”¯æŒé€šè¿‡é…ç½®é€‰é¡¹è‡ªå®šä¹‰è¡Œä¸ºï¼Œæä¾›ç»Ÿä¸€çš„é…ç½®ç®¡ç†æœºåˆ¶ã€‚</li>\n<li>æ¨¡å—åŒ–è®¾è®¡ï¼šå°†åŠŸèƒ½åˆ†è§£ä¸ºç‹¬ç«‹çš„Actionsï¼Œæ¯ä¸ªactionè´Ÿè´£å¤„ç†ç‰¹å®šç±»åž‹çš„äº‹ä»¶ã€‚</li>\n<li>èµ„æºæŠ½è±¡ï¼šé€šè¿‡ ResourceDescriptor æŠ½è±¡èµ„æºå®šä¹‰ï¼Œæ”¯æŒä¸åŒç±»åž‹çš„èµ„æºï¼ˆæ¨¡åž‹ï¼Œå·¥å…·ï¼Œæç¤ºè¯ç­‰ï¼‰</li>\n<li>çŠ¶æ€ç®¡ç†ï¼šæä¾›çŸ­æœŸå†…å­˜ç®¡ç†æœºåˆ¶ï¼Œæ”¯æŒåŸºäºŽkeyçš„çŠ¶æ€éš”ç¦»ã€‚</li>\n<li>å¤šçŽ¯å¢ƒæ”¯æŒï¼šæ”¯æŒæœ¬åœ°æ‰§è¡ŒçŽ¯å¢ƒç”¨äºŽè°ƒè¯•ï¼Œæ”¯æŒè¿œç¨‹ Flink çŽ¯å¢ƒç”¨äºŽç”Ÿäº§ã€‚</li>\n</ul>\n<h2 id=\"0x01-æ ¸å¿ƒæŠ½è±¡\">0x01 æ ¸å¿ƒæŠ½è±¡</h2>\n<h3 id=\"11-agentæŠ½è±¡\">1.1 AgentæŠ½è±¡</h3>\n<p>Agent ä½œä¸ºåŸºç±»æä¾›äº†ï¼š</p>\n<ul>\n<li>èµ„æºç®¡ç†ï¼ˆresources å­—å…¸ï¼‰ã€‚</li>\n<li>Action æ³¨å†Œæœºåˆ¶ï¼ˆactions å­—å…¸ï¼‰ã€‚</li>\n<li>ç»Ÿä¸€çš„æŽ¥å£ä¾›æ‰§è¡ŒçŽ¯å¢ƒä½¿ç”¨ã€‚</li>\n</ul>\n<pre><code class=\"language-python\">class Agent(ABC):\n    \"\"\"Base class for defining agent logic.\n\n    Example:\n        Users have two ways to create an Agent\n\n        * Declare an Agent with decorators\n        ::\n\n            class MyAgent(Agent):\n                @action(InputEvent)\n                @staticmethod\n                def my_action(event: Event, ctx: RunnerContext) -&gt; None:\n                    action logic\n\n                @chat_model_connection\n                @staticmethod\n                def my_connection() -&gt; ResourceDescriptor:\n                    return ResourceDescriptor(clazz=OllamaChatModelConnection,\n                                              model=\"qwen2:7b\",\n                                              base_url=\"http://localhost:11434\")\n\n                @chat_model_setup\n                @staticmethod\n                def my_chat_model() -&gt; ResourceDescriptor:\n                    return ResourceDescriptor(clazz=OllamaChatModel,\n                                              connection=\"my_connection\")\n\n        * Add actions and resources to an Agent instance\n        ::\n\n            my_agent = Agent()\n            my_agent.add_action(name=\"my_action\",\n                                events=[InputEvent],\n                                func=action_function)\n                    .add_resource(name=\"my_connection\",\n                                  instance=ResourceDescriptor(\n                                        clazz=OllamaChatModelConnection,\n                                        arg1=xxx\n                                )\n                    .add_resource(\n                        name=\"my_connection\",\n                        instance=ResourceDescriptor(\n                            clazz=OllamaChatModelConnection,\n                            arg1=xxx\n                        )\n                    )\n                    .add_resource(\n                        name=\"my_chat_model\",\n                        instance=ResourceDescriptor(\n                            clazz=OllamaChatModelSetup,\n                            connection=\"my_connection\"\n                        )\n                    )\n    \"\"\"\n\n    _actions: Dict[str, Tuple[List[Type[Event]], Callable, Dict[str, Any]]]\n    _resources: Dict[ResourceType, Dict[str, Any]]\n    _mcp_servers: Dict[str, MCPServer]\n\n    def __init__(self) -&gt; None:\n        \"\"\"Init method.\"\"\"\n        self._actions = {}\n        self._resources = {}\n        for type in ResourceType:\n            self._resources[type] = {}\n\n    @property\n    def actions(self) -&gt; Dict[str, Tuple[List[Type[Event]], Callable, Dict[str, Any]]]:\n        \"\"\"Get added actions.\"\"\"\n        return self._actions\n\n    @property\n    def resources(self) -&gt; Dict[ResourceType, Dict[str, Any]]:\n        \"\"\"Get added resources.\"\"\"\n        return self._resources\n\n    def add_action(\n        self, name: str, events: List[Type[Event]], func: Callable, **config: Any\n    ) -&gt; \"Agent\":\n        \"\"\"Add action to agent.\n\n        Parameters\n        ----------\n        name : str\n            The name of the action, should be unique in the same Agent.\n        events: List[Type[Event]]\n            The type of events listened by this action.\n        func: Callable\n            The function to be executed when receive listened events.\n        **config: Any\n            Key named arguments can be used by this action in runtime.\n\n        Returns:\n        -------\n        Agent\n            The modified Agent instance.\n        \"\"\"\n        if name in self._actions:\n            msg = f\"Action {name} already defined\"\n            raise ValueError(msg)\n        self._actions[name] = (events, func, config if config else None)\n        return self\n\n    def add_resource(\n        self, name: str, instance: SerializableResource | ResourceDescriptor\n    ) -&gt; \"Agent\":\n        \"\"\"Add resource to agent instance.\n\n        Parameters\n        ----------\n        name : str\n            The name of the prompt, should be unique in the same Agent.\n        instance: SerializableResource | ResourceDescriptor\n            The serializable resource instance, or the descriptor of resource.\n\n        Returns:\n        -------\n        Agent\n            The agent to add the resource.\n        \"\"\"\n        if isinstance(instance, SerializableResource):\n            resource_type = instance.resource_type()\n        elif isinstance(instance, ResourceDescriptor):\n            resource_type = instance.clazz.resource_type()\n        else:\n            err_msg = f\"Unexpected resource {instance}\"\n            raise TypeError(err_msg)\n\n        if name in self._resources[resource_type]:\n            msg = f\"{resource_type.value} {name} already defined\"\n            raise ValueError(msg)\n\n        self._resources[resource_type][name] = instance\n        return self\n</code></pre>\n<h3 id=\"12-action-æŠ½è±¡\">1.2 Action æŠ½è±¡</h3>\n<p>Action æä¾›äº†ï¼š</p>\n<ul>\n<li>äº‹ä»¶ç›‘å¬æœºåˆ¶</li>\n<li>ä¸Žæ‰§è¡Œä¸Šä¸‹æ–‡çš„äº¤äº’æŽ¥å£</li>\n<li>ç»Ÿä¸€çš„æ‰§è¡ŒæŽ¥å£</li>\n</ul>\n<p>é€šè¿‡è£…é¥°å™¨æˆ–è€…add_actionæ–¹æ³•å®šä¹‰ã€‚</p>\n<pre><code class=\"language-python\">    @action(InputEvent)\n    @staticmethod\n    def start_action(event: InputEvent, ctx: RunnerContext) -&gt; None:\n        \"\"\"Start action to format user input and send chat request event.\"\"\"\n        usr_input = event.input\n</code></pre>\n<h3 id=\"13-èµ„æºæŠ½è±¡\">1.3 èµ„æºæŠ½è±¡</h3>\n<p>èµ„æºæŠ½è±¡åŒ…æ‹¬ï¼šæ¨¡åž‹è¿žæŽ¥ï¼ˆCHAT_MODEL_CONNECTION)ï¼Œå·¥å…·ï¼Œæç¤ºè¯ï¼ŒMCPæœåŠ¡å™¨ç­‰ã€‚</p>\n<pre><code class=\"language-python\">class ResourceDescriptor:\n    \"\"\"Descriptor of resource, includes the class and the initialize arguments.\"\"\"\n\n    _clazz: Type[Resource]\n    _arguments: Dict[str, Any]\n\n    def __init__(self, *, clazz: Type[Resource], **arguments: Any) -&gt; None:\n        \"\"\"Init method.\"\"\"\n        self._clazz = clazz\n        self._arguments = arguments\n\n    @property\n    def clazz(self) -&gt; Type[Resource]:\n        \"\"\"Get the class of the resource.\"\"\"\n        return self._clazz\n\n    @property\n    def arguments(self) -&gt; Dict[str, Any]:\n        \"\"\"Get the initialize arguments of the resource.\"\"\"\n        return self._arguments\n</code></pre>\n<h3 id=\"14-æ‰§è¡ŒçŽ¯å¢ƒæŠ½è±¡\">1.4 æ‰§è¡ŒçŽ¯å¢ƒæŠ½è±¡</h3>\n<p>æ‰§è¡Œä¸Šä¸‹æ–‡æä¾›ï¼š</p>\n<ul>\n<li>äº‹ä»¶å‘é€æœºåˆ¶</li>\n<li>èµ„æºè®¿é—®æŽ¥å£</li>\n<li>å†…å­˜ç®¡ç†</li>\n<li>é…ç½®è®¿é—®</li>\n</ul>\n<pre><code class=\"language-python\">class RunnerContext(ABC):\n    \"\"\"Abstract base class providing context for agent execution.\n\n    This context provides access to event handling.\n</code></pre>\n<h3 id=\"15-äº‹ä»¶æŠ½è±¡\">1.5 äº‹ä»¶æŠ½è±¡</h3>\n<p>å³ Event ä½“ç³»ï¼Œæä¾›äº†ï¼š</p>\n<ul>\n<li>ç»Ÿä¸€çš„äº‹ä»¶å¤„ç†æœºåˆ¶</li>\n<li>ç±»åž‹å®‰å…¨çš„äº‹ä»¶åˆ†å‘</li>\n<li>å¯æ‰©å±•çš„äº‹ä»¶ç±»åž‹ç³»ç»Ÿ</li>\n</ul>\n<pre><code class=\"language-python\">class Event(BaseModel, ABC, extra=\"allow\"):\n    \"\"\"Base class for all event types in the system. Event allow extra properties, but\n    these properties are required isinstance of BaseModel, or json serializable.\n\n    Attributes:\n    ----------\n    id : UUID\n        Unique identifier for the event, automatically generated using uuid4.\n    \"\"\"\n\n    id: UUID = Field(default_factory=uuid4)\n</code></pre>\n<h3 id=\"16-é…ç½®æŠ½è±¡\">1.6 é…ç½®æŠ½è±¡</h3>\n<p>AgentConfiguration æä¾›äº†ï¼š</p>\n<ul>\n<li>ç±»åž‹å®‰å…¨çš„é…ç½®é€‰é¡¹</li>\n<li>é»˜è®¤å€¼ç®¡ç†</li>\n<li>ä»Žæ–‡ä»¶åŠ è½½é…ç½®çš„èƒ½åŠ›</li>\n</ul>\n<pre><code class=\"language-python\">class AgentConfiguration(BaseModel, Configuration):\n    \"\"\"Base class for config objects in the system.\n    Provides a flat dict interface to access nested config values.\n    \"\"\"\n\n    conf_data: Dict[str, Any]\n\n    def __init__(self, conf_data: Dict[str, Any] | None = None) -&gt; None:\n        \"\"\"Initialize with optional configuration data.\"\"\"\n        if conf_data is None:\n            super().__init__(conf_data = {})\n        else:\n            super().__init__(conf_data = conf_data)\n\n</code></pre>\n<h2 id=\"0x02-workflow-style-agent-å’Œreactagent\">0x02 Workflow Style Agent å’ŒReActAgent</h2>\n<p>æœ‰ä¸¤ç§æœ€æ™®éçš„Agentsï¼š</p>\n<ul>\n<li><strong>Workflows</strong> æ˜¯ç”±é¢„å®šä¹‰çš„ä»£ç è·¯å¾„æ¥ç¼–æŽ’ LLM å’Œå·¥å…·çš„ç³»ç»Ÿã€‚</li>\n<li><strong>Agents</strong> åˆ™æ˜¯ LLM åŠ¨æ€æŒ‡å¯¼è‡ªèº«æµç¨‹å’Œå·¥å…·ä½¿ç”¨çš„ç³»ç»Ÿï¼Œå®ƒä»¬æŽŒæŽ§ç€è‡ªå·±å®Œæˆä»»åŠ¡çš„æ–¹å¼ã€‚</li>\n</ul>\n<p>å½“éœ€è¦å¤„ç†æ›´å¤æ‚ä»»åŠ¡æ—¶ï¼ŒWorkflows ä¸ºå®šä¹‰æ˜Žç¡®çš„ä»»åŠ¡æä¾›äº†å¯é¢„æµ‹æ€§å’Œä¸€è‡´æ€§ï¼ˆå¤çŽ°ï¼‰ï¼Œè€Œå½“éœ€è¦å¤§è§„æ¨¡çš„çµæ´»æ€§å’Œæ¨¡åž‹é©±åŠ¨çš„å†³ç­–æ—¶ï¼Œagents åˆ™æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>\n<p>å¯¹åº”è¿™ä¸¤ç§Agentï¼ŒFlink Agents æœ‰ä¸¤ç§ä¸åŒçš„Agentï¼šWorkflow Style Agent å’ŒReActAgentã€‚</p>\n<ul>\n<li>åœ¨ Flink-Agents ä¸­ï¼Œå·¥ä½œæµé£Žæ ¼çš„ä»£ç†ï¼ˆworkflow-style agentï¼‰æŠŠæŽ¨ç†ä¸Žè¡Œä¸ºç»„ç»‡æˆä¸€æ¡ç”±â€œåŠ¨ä½œï¼ˆactionï¼‰â€æž„æˆçš„æœ‰å‘å·¥ä½œæµï¼ŒåŠ¨ä½œä¹‹é—´é€šè¿‡äº‹ä»¶è¿žæŽ¥ã€‚è¿™ç§è®¾è®¡å€Ÿé‰´äº†å¤æ‚å¤šé˜¶æ®µä»»åŠ¡çš„ç¼–æŽ’éœ€æ±‚ï¼Œå¸Œæœ›ä»¥é€æ˜Žã€å¯æ‰©å±•ä¸”ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„æ–¹å¼åˆ©ç”¨ Apache Flink çš„æµå¼æž¶æž„æ¥å®Œæˆå·¥ä½œã€‚Workflow é€‚åˆä»»åŠ¡æ˜¯å¯ä»¥è¢«æ¸…é™¤çš„è§£æž„æˆå›ºå®šçš„å­ä»»åŠ¡å•å…ƒã€‚Workflow ç›¸å¯¹äºŽ Agent æœ‰ä¸ªå¤©ç„¶çš„ä¼˜åŠ¿å°±æ˜¯é«˜æ•ˆçŽ‡ï¼Œä¸”æ•ˆæžœéžå¸¸ç¨³å®šï¼Œæ‰§è¡ŒåŸºæœ¬éƒ½èƒ½åœ¨é¢„æœŸèŒƒå›´å†…ï¼Œä¸å¯é¢„çŸ¥æˆ–è€…è¯´æœªçŸ¥æ€§å¾ˆä½Žã€‚ç¼ºç‚¹è‡ªç„¶å°±æ˜¯ä¸å¤Ÿçµæ´»äº†ï¼Œé¢å¯¹ä¸€äº›å¼€æ”¾çš„æˆ–è€…æ— æ³•é¢„å®šä¹‰çš„ä»»åŠ¡å°±æ— æ³•å¤„ç†äº†ã€‚</li>\n<li>ReActï¼ˆReasoning and Actingï¼‰Agent æ˜¯ä¸€ç§é€šç”¨èŒƒå¼ï¼ŒæŠŠæŽ¨ç†ä¸Žè¡ŒåŠ¨èƒ½åŠ›ç»“åˆèµ·æ¥è§£å†³å¤æ‚ä»»åŠ¡ã€‚å€ŸåŠ©è¯¥èŒƒå¼ï¼Œç”¨æˆ·åªéœ€åœ¨æç¤ºè¯é‡ŒæŒ‡å®šç›®æ ‡å¹¶æä¾›å¯ç”¨å·¥å…·ï¼Œå¤§æ¨¡åž‹ä¾¿ä¼šè‡ªä¸»å†³å®šå¦‚ä½•è¾¾æˆç›®æ ‡å¹¶æ‰§è¡Œç›¸åº”åŠ¨ä½œã€‚ReActé€šè¿‡æ¨¡æ‹Ÿäººç±»çš„â€œReasoning-Actingâ€æ¨¡å¼ï¼Œä½¿LLMèƒ½å¤ŸåŠ¨æ€åœ°å†³å®šæ•°æ®éœ€æ±‚ ã€‚å…¶æ ¸å¿ƒæ˜¯ä¸€ä¸ªå¾ªçŽ¯ï¼šæ€è€ƒï¼ˆThoughtï¼‰ï¼š LLMé¦–å…ˆè¿›è¡Œå†…éƒ¨æŽ¨ç†ã€‚å®ƒåˆ†æžå½“å‰ä»»åŠ¡å’Œå·²æœ‰ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦ç¼ºå°‘å®Œæˆä»»åŠ¡æ‰€éœ€çš„çŸ¥è¯†ï¼Œå¹¶åˆ¶å®šä¸‹ä¸€æ­¥çš„è¡ŒåŠ¨è®¡åˆ’ã€‚åœ¨è¿™ä¸ªå¾ªçŽ¯ä¸­ï¼Œæ•°æ®æµæ˜¯æ ¹æ®LLMçš„â€œæ€è€ƒâ€ç»“æžœåŠ¨æ€ç”Ÿæˆçš„ã€‚å½“LLMåˆ¤æ–­éœ€è¦å¤–éƒ¨æ•°æ®æ—¶ï¼Œå®ƒä¼šä¸»åŠ¨è§¦å‘ä¸€ä¸ªâ€œè¡ŒåŠ¨â€æ¥èŽ·å–æ•°æ®ï¼Œç„¶åŽå°†èŽ·å–åˆ°çš„â€œè§‚å¯Ÿâ€æ•°æ®æ•´åˆè¿›è‡ªå·±çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œç”¨äºŽä¸‹ä¸€æ­¥çš„å†³ç­–ã€‚</li>\n</ul>\n<h3 id=\"21-ç‰¹æ€§\">2.1 ç‰¹æ€§</h3>\n<p>ä¸¤ç§Agentçš„è¯¦ç»†æ¢³ç†å¦‚ä¸‹ï¼š</p>\n<h4 id=\"211-è®¾è®¡ç†å¿µ\">2.1.1 è®¾è®¡ç†å¿µ</h4>\n<p>Workflow Style Agent</p>\n<ul>\n<li>å¯å®šåˆ¶æ¡†æž¶ï¼šçµæ´»çš„æ¡†æž¶ï¼Œå…è®¸ç”¨æˆ·å®šä¹‰è‡ªå·±çš„ä»£ç†é€»è¾‘</li>\n<li>äº‹ä»¶é©±åŠ¨æž¶æž„ï¼šé€»è¾‘è¢«ç»„ç»‡ä¸ºç”±äº‹ä»¶è¿žæŽ¥çš„åŠ¨ä½œæœ‰å‘å›¾</li>\n<li>æ¨¡å—åŒ–è®¾è®¡ï¼šç”¨æˆ·é€šè¿‡å®šä¹‰å•ä¸ªåŠ¨ä½œåŠå…¶äº¤äº’æ¥ç»„åˆä»£ç†</li>\n</ul>\n<p>ReActAgent</p>\n<ul>\n<li>é¢„æž„å»ºä»£ç†ï¼šåŸºäºŽ ReActï¼ˆæŽ¨ç†+è¡ŒåŠ¨ï¼‰èŒƒå¼çš„å†…ç½®ã€å³ç”¨åž‹ä»£ç†å®žçŽ°</li>\n<li>ä»¥ LLM ä¸ºä¸­å¿ƒï¼šä¸“é—¨ä¸º LLM åšå‡ºé‡‡å–ä½•ç§è¡ŒåŠ¨çš„å†³ç­–è€Œè®¾è®¡</li>\n<li>æ ‡å‡†åŒ–å·¥ä½œæµï¼šéµå¾ªå›ºå®šçš„â€œæ€ç»´â†’è¡ŒåŠ¨â†’è§‚å¯Ÿâ€å¾ªçŽ¯æ¨¡å¼</li>\n</ul>\n<h4 id=\"212-æŽ§åˆ¶æµ\">2.1.2 æŽ§åˆ¶æµ</h4>\n<p>Workflow Style Agent</p>\n<ul>\n<li>æ˜¾å¼æµç¨‹ï¼šç”¨æˆ·æ˜Žç¡®å®šä¹‰äº‹ä»¶å¦‚ä½•è§¦å‘åŠ¨ä½œ</li>\n<li>äº‹ä»¶è·¯ç”±ï¼šåŠ¨ä½œç”±ç‰¹å®šçš„äº‹ä»¶ç±»åž‹è§¦å‘</li>\n<li>çµæ´»æ¨¡å¼ï¼šå¯ä»¥å®žçŽ°å„ç§æ¨¡å¼ï¼Œå¦‚é¡ºåºã€åˆ†æ”¯æˆ–å¾ªçŽ¯å·¥ä½œæµ</li>\n</ul>\n<p>ReActAgent</p>\n<ul>\n<li>éšå¼æµç¨‹ï¼šå†³ç­–è¿‡ç¨‹åœ¨å†…éƒ¨ç”± LLM å¤„ç†</li>\n<li>å·¥å…·è°ƒç”¨ï¼šä½¿ç”¨ LLM çš„åŽŸç”Ÿå‡½æ•°è°ƒç”¨åŠŸèƒ½æ¥ç¡®å®šæ“ä½œ</li>\n<li>å›ºå®šæ¨¡å¼ï¼šéµå¾ªæ ‡å‡†çš„ ReAct æ¨¡å¼ï¼ˆæ€è€ƒâ†’è¡ŒåŠ¨â†’è§‚å¯Ÿï¼‰</li>\n</ul>\n<h4 id=\"213-å®šåˆ¶çº§åˆ«\">2.1.3 å®šåˆ¶çº§åˆ«</h4>\n<p>Workflow Style Agent</p>\n<ul>\n<li>é«˜åº¦å¯å®šåˆ¶ï¼šå¯¹ä»£ç†é€»è¾‘ã€åŠ¨ä½œå’Œäº‹ä»¶æµæ‹¥æœ‰å®Œå…¨æŽ§åˆ¶æƒ</li>\n<li>è‡ªå®šä¹‰åŠ¨ä½œï¼šç”¨æˆ·å®šä¹‰æ‰€æœ‰åŠ¨ä½œåŠå…¶è¡Œä¸º</li>\n<li>çµæ´»äº‹ä»¶ï¼šç”¨æˆ·å¯ä»¥å®šä¹‰è‡ªå®šä¹‰äº‹ä»¶ç±»åž‹å’Œå¤„ç†é€»è¾‘</li>\n</ul>\n<p>ReActAgent</p>\n<ul>\n<li>æœ‰é™å®šåˆ¶ï¼šå®šåˆ¶ä¸»è¦é€šè¿‡æç¤ºè¯ã€æ¨¡åž‹å’Œè¾“å‡ºæ¨¡å¼å®žçŽ°</li>\n<li>é¢„å®šä¹‰åŠ¨ä½œï¼šä½¿ç”¨å†…ç½®åŠ¨ä½œå¦‚ start_action å’Œ stop_action</li>\n<li>æ ‡å‡†æŽ¥å£ï¼šä¸ºç±»ä¼¼çš„ LLM ä»»åŠ¡æä¾›ä¸€è‡´çš„æŽ¥å£</li>\n</ul>\n<h4 id=\"214-ä½¿ç”¨åœºæ™¯\">2.1.4 ä½¿ç”¨åœºæ™¯</h4>\n<p>Workflow Style Agent</p>\n<ul>\n<li>å…·æœ‰å›ºå®šåºåˆ—æˆ–æ¡ä»¶åˆ†æ”¯çš„å¤šæ­¥éª¤æµç¨‹</li>\n<li>éœ€è¦ç²¾ç¡®æŽ§åˆ¶ä»£ç†è¡Œä¸ºçš„åœºæ™¯</li>\n<li>åœ¨é¢„å®šé¡ºåºä¸­ä¸Žå¤šä¸ªå¤–éƒ¨ç³»ç»Ÿé›†æˆ</li>\n</ul>\n<p>ReActAgent</p>\n<ul>\n<li>éœ€è¦ LLM æŽ¨ç†ä½¿ç”¨å“ªäº›å·¥å…·/æ“ä½œçš„ä»»åŠ¡</li>\n<li>å¸¦å·¥å…·ä½¿ç”¨çš„æ ‡å‡†é—®ç­”</li>\n<li>LLM åº”è¯¥åŠ¨æ€å†³å®šå·¥ä½œæµç¨‹çš„åœºæ™¯</li>\n</ul>\n<p>åªè¦â€œé—®é¢˜ä¸å¯å®Œå…¨ç©·ä¸¾ã€è¦è·¨å¤šç³»ç»ŸæŸ¥è¯ã€å¹¶ä¸”éœ€è¦åœ¨å¯¹è¯ä¸­æ¾„æ¸…/åå•†/å†³ç­–â€ï¼Œå°±æ›´åº”è¯¥ç”¨ReActAgentï¼Œè€Œä¸æ˜¯çº¯ Workflowã€‚</p>\n<h4 id=\"215-å¼€å‘å¤æ‚åº¦\">2.1.5 å¼€å‘å¤æ‚åº¦</h4>\n<p>Workflow Style Agent</p>\n<ul>\n<li>æ›´é«˜çµæ´»æ€§ï¼šéœ€è¦æ›´å¤šä»£ç ä½†æŽ§åˆ¶åŠ›æ›´å¼º</li>\n<li>è‡ªå®šä¹‰é€»è¾‘ï¼šéœ€è¦å®žçŽ°æ‰€æœ‰åŠ¨ä½œé€»è¾‘</li>\n<li>æ— ä¸»è§ï¼šå¼€å‘äººå‘˜æŽ§åˆ¶ä»£ç†è¡Œä¸ºçš„æ‰€æœ‰æ–¹é¢</li>\n</ul>\n<p>ReActAgent</p>\n<ul>\n<li>è¾ƒä½Žé—¨æ§›ï¼šæ›´å®¹æ˜“ä¸Šæ‰‹ï¼Œå…·æœ‰é¢„å®šä¹‰åŠŸèƒ½</li>\n<li>ä»£ç é‡å°‘ï¼šè®¾ç½®æ‰€éœ€çš„ä»£ç æœ€å°‘</li>\n<li>æœ‰ä¸»è§ï¼šä»£è¡¨å¼€å‘äººå‘˜åšå‡ºè®¸å¤šå†³ç­–</li>\n</ul>\n<h4 id=\"216-æ€»ç»“\">2.1.6 æ€»ç»“</h4>\n<p>ReActAgent ä¸ºæ ‡å‡†çš„åŸºäºŽ LLM çš„æŽ¨ç†ä»»åŠ¡æä¾›äº†çŽ°æˆçš„è§£å†³æ–¹æ¡ˆï¼Œè€Œ Workflow Style Agent ä¸ºå¤æ‚çš„è‡ªå®šä¹‰ä»£ç†å®žçŽ°æä¾›äº†æœ€å¤§çš„çµæ´»æ€§ã€‚</p>\n<p>æœ‰äººæˆç§°ï¼šæ‹‰æŠ•èµ„ç”¨ Agent è®²æ•…äº‹ï¼Œåšä¸šåŠ¡è¸è¸å®žå®žç”¨ Workflow ã€‚è¿™å¥çŽ©ç¬‘èƒŒåŽæŠ˜å°„å‡ºçŽ°å®žçš„è€ƒé‡ï¼šWorkflow èƒœåœ¨ç¡®å®šæ€§ï¼Œè€Œ Agent èƒœåœ¨ä¸Šé™ã€‚</p>\n<h3 id=\"22-workflow\">2.2 workflow</h3>\n<p>å®˜æ–¹çš„å¿«é€Ÿå…¥é—¨ï¼ˆdocs\\content\\docs\\get-started\\quickstart\\workflow_agent.mdï¼‰é€šè¿‡ä¸¤ä¸ªæ¸è¿›å¼æµå¼ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ç”¨ Flink Agents æž„å»ºç”±å¤§æ¨¡åž‹é©±åŠ¨çš„æµæ°´çº¿ï¼š</p>\n<ul>\n<li><strong>è¯„è®ºåˆ†æž</strong>ï¼šç¤ºä¾‹ä¸€ ä¼šæŒç»­æŽ¥æ”¶å•†å“è¯„è®ºæµï¼Œå¹¶ç”¨å•ä¸ªä»£ç†ä»Žæ¯æ¡è¯„è®ºä¸­æå–è¯„åˆ†ï¼ˆ1-5ï¼‰ä»¥åŠä¸æ»¡æ„åŽŸå› ã€‚</li>\n<li><strong>äº§å“æ”¹è¿›å»ºè®®</strong>ï¼šåœ¨ç¤ºä¾‹ä¸€çš„åŸºç¡€ä¸Šï¼ŒæŒ‰çª—å£èšåˆæ¯æ¡è¯„è®ºçš„åˆ†æžç»“æžœï¼Œç”Ÿæˆå•†å“çº§åˆ«çš„æ±‡æ€»ï¼ˆè¯„åˆ†åˆ†å¸ƒã€å¸¸è§æŠ±æ€¨ï¼‰ï¼Œå†è°ƒç”¨ç¬¬äºŒä¸ªä»£ç†ä¸ºæ¯ä»¶å•†å“è¾“å‡ºå…·ä½“çš„æ”¹è¿›å»ºè®®ã€‚</li>\n</ul>\n<p>ä¸¤ä¸ªç¤ºä¾‹åˆåœ¨ä¸€èµ·ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ç”¨ Flink Agents æž„å»ºå¤šä»£ç†å·¥ä½œæµï¼Œå¹¶ç›´æŽ¥åœ¨ Flink ç‹¬ç«‹é›†ç¾¤ä¸Šè¿è¡Œã€‚</p>\n<h4 id=\"221-ä»£ç å¯¼è¯»\">2.2.1 ä»£ç å¯¼è¯»</h4>\n<h5 id=\"å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ\">å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ</h5>\n<p>åˆ›å»º Agents æ‰§è¡ŒçŽ¯å¢ƒï¼Œæ³¨å†Œå¯ä¾›ä»£ç†ä½¿ç”¨çš„èŠå¤©æ¨¡åž‹è¿žæŽ¥ã€‚</p>\n<pre><code class=\"language-Java\">// Set up the Flink streaming environment and the Agents execution environment.\nStreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\nAgentsExecutionEnvironment agentsEnv =\n        AgentsExecutionEnvironment.getExecutionEnvironment(env);\n\n// Add Ollama chat model connection to be used by the ReviewAnalysisAgent.\nagentsEnv.addResource(\n        \"ollamaChatModelConnection\",\n        ResourceType.CHAT_MODEL_CONNECTION,\n        CustomTypesAndResources.OLLAMA_SERVER_DESCRIPTOR);\n</code></pre>\n<h5 id=\"åˆ›å»ºä»£ç†\">åˆ›å»ºä»£ç†</h5>\n<p>ä»¥ <code>ReviewAnalysisAgent</code> ä¸ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•å®šä¹‰æç¤ºè¯ã€å·¥å…·ã€èŠå¤©æ¨¡åž‹å’ŒåŠ¨ä½œï¼›ä»¥åŠå¦‚ä½•å¤„ç†èŠå¤©å“åº”å¹¶å‘é€è¾“å‡ºäº‹ä»¶ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ [å·¥ä½œæµä»£ç†] æ–‡æ¡£ã€‚<code>ProductSuggestionAgent</code> çš„ä»£ç ä¸Žä¹‹ç±»ä¼¼ã€‚</p>\n<pre><code class=\"language-Java\">/**\n * An agent that uses a large language model (LLM) to analyze product reviews and generate a\n * satisfaction score and potential reasons for dissatisfaction.\n *\n * &lt;p&gt;This agent receives a product review and produces a satisfaction score and a list of reasons\n * for dissatisfaction. It handles prompt construction, LLM interaction, and output parsing.\n */\npublic class ReviewAnalysisAgent extends Agent {\n\n    private static final ObjectMapper MAPPER = new ObjectMapper();\n\n    @Prompt\n    public static org.apache.flink.agents.api.prompt.Prompt reviewAnalysisPrompt() {\n        return REVIEW_ANALYSIS_PROMPT;\n    }\n\n    @ChatModelSetup\n    public static ResourceDescriptor reviewAnalysisModel() {\n        return ResourceDescriptor.Builder.newBuilder(OllamaChatModelSetup.class.getName())\n                .addInitialArgument(\"connection\", \"ollamaChatModelConnection\")\n                .addInitialArgument(\"model\", \"qwen3:8b\")\n                .addInitialArgument(\"prompt\", \"reviewAnalysisPrompt\")\n                .addInitialArgument(\"tools\", Collections.singletonList(\"notifyShippingManager\"))\n                .addInitialArgument(\"extract_reasoning\", \"true\")\n                .build();\n    }\n\n    /**\n     * Tool for notifying the shipping manager when product received a negative review due to\n     * shipping damage.\n     *\n     * @param id The id of the product that received a negative review due to shipping damage\n     * @param review The negative review content\n     */\n    @Tool(\n            description =\n                    \"Notify the shipping manager when product received a negative review due to shipping damage.\")\n    public static void notifyShippingManager(\n            @ToolParam(name = \"id\") String id, @ToolParam(name = \"review\") String review) {\n        CustomTypesAndResources.notifyShippingManager(id, review);\n    }\n\n    /** Process input event and send chat request for review analysis. */\n    @Action(listenEvents = {InputEvent.class})\n    public static void processInput(InputEvent event, RunnerContext ctx) throws Exception {\n        String input = (String) event.getInput();\n        MAPPER.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);\n        CustomTypesAndResources.ProductReview inputObj =\n                MAPPER.readValue(input, CustomTypesAndResources.ProductReview.class);\n\n        ctx.getShortTermMemory().set(\"id\", inputObj.getId());\n\n        String content =\n                String.format(\n                        \"{\\n\" + \"\\\"id\\\": %s,\\n\" + \"\\\"review\\\": \\\"%s\\\"\\n\" + \"}\",\n                        inputObj.getId(), inputObj.getReview());\n        ChatMessage msg = new ChatMessage(MessageRole.USER, \"\", Map.of(\"input\", content));\n\n        ctx.sendEvent(new ChatRequestEvent(\"reviewAnalysisModel\", List.of(msg)));\n    }\n\n    @Action(listenEvents = ChatResponseEvent.class)\n    public static void processChatResponse(ChatResponseEvent event, RunnerContext ctx)\n            throws Exception {\n        JsonNode jsonNode = MAPPER.readTree(event.getResponse().getContent());\n        JsonNode scoreNode = jsonNode.findValue(\"score\");\n        JsonNode reasonsNode = jsonNode.findValue(\"reasons\");\n        if (scoreNode == null || reasonsNode == null) {\n            throw new IllegalStateException(\n                    \"Invalid response from LLM: missing 'score' or 'reasons' field.\");\n        }\n        List&lt;String&gt; result = new ArrayList&lt;&gt;();\n        if (reasonsNode.isArray()) {\n            for (JsonNode node : reasonsNode) {\n                result.add(node.asText());\n            }\n        }\n\n        ctx.sendEvent(\n                new OutputEvent(\n                        new CustomTypesAndResources.ProductReviewAnalysisRes(\n                                ctx.getShortTermMemory().get(\"id\").getValue().toString(),\n                                scoreNode.asInt(),\n                                result)));\n    }\n}\n</code></pre>\n<h5 id=\"ä¸Ž-flink-é›†æˆ\">ä¸Ž Flink é›†æˆ</h5>\n<p>è¯»å–æ–‡æœ¬æ–‡ä»¶ä¸­çš„å•†å“è¯„è®ºæµä½œä¸ºè¾“å…¥ DataStreamï¼Œç”¨ <code>ReviewAnalysisAgent</code> åˆ†æžå¹¶ç”Ÿæˆç»“æžœ DataStreamï¼Œæœ€åŽæ‰“å°è¾“å‡ºã€‚</p>\n<pre><code class=\"language-Java\">// Read product reviews from input_data.txt file as a streaming source.\n// Each element represents a ProductReview.\nDataStream&lt;String&gt; productReviewStream =\n       env.fromSource(\n               FileSource.forRecordStreamFormat(\n                               new TextLineInputFormat(),\n                               new Path(inputDataFile.getAbsolutePath()))\n                       .build(),\n               WatermarkStrategy.noWatermarks(),\n               \"streaming-agent-example\");\n\n// Use the ReviewAnalysisAgent to analyze each product review.\nDataStream&lt;Object&gt; reviewAnalysisResStream =\n       agentsEnv\n               .fromDataStream(productReviewStream)\n               .apply(new ReviewAnalysisAgent())\n               .toDataStream();\n\n// Print the analysis results to stdout.\nreviewAnalysisResStream.print();\n\n// Execute the Flink pipeline.\nagentsEnv.execute();\n</code></pre>\n<h3 id=\"23-react-agent\">2.3 ReAct Agent</h3>\n<p>æœ¬å¿«é€Ÿå…¥é—¨ç”¨ä¸€ä¸ªè¿·ä½ ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•ç”¨ Flink Agents æž„å»ºæµå¼ ReAct Agentï¼š</p>\n<p><strong>è¯„è®ºåˆ†æž</strong> ä»£ç†æŒç»­æ¶ˆè´¹å•†å“è¯„è®ºæµï¼Œç”¨å•ä¸ªä»£ç†æå–è¯„åˆ†ï¼ˆ1-5ï¼‰ä»¥åŠä¸æ»¡æ„åŽŸå› ï¼›è‹¥è¯„è®ºæ¶‰åŠç‰©æµä¸æ»¡ï¼Œåˆ™è‡ªåŠ¨é€šçŸ¥ç‰©æµç»ç†ã€‚</p>\n<h4 id=\"231-ä»£ç å¯¼è¯»\">2.3.1 ä»£ç å¯¼è¯»</h4>\n<h5 id=\"å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ-1\">å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ</h5>\n<p>åˆ›å»º Agents æ‰§è¡ŒçŽ¯å¢ƒï¼Œæ³¨å†Œå¯ç”¨çš„èŠå¤©æ¨¡åž‹è¿žæŽ¥ä¸Žå·¥å…·ã€‚</p>\n<pre><code class=\"language-python\"># Set up the Flink streaming environment and the Agents execution environment.\nenv = StreamExecutionEnvironment.get_execution_environment()\nagents_env = AgentsExecutionEnvironment.get_execution_environment(env)\n\n# Add Ollama chat model connection and notify shipping manager tool to be used\n# by the Agent.\nagents_env.add_resource(\n    \"ollama_server\",\n    ResourceDescriptor(clazz=OllamaChatModelConnection, request_timeout=120),\n).add_resource(\n    \"notify_shipping_manager\", Tool.from_callable(notify_shipping_manager)\n)\n</code></pre>\n<h5 id=\"åˆ›å»º-react-agent\">åˆ›å»º ReAct Agent</h5>\n<p>å®žä¾‹åŒ– ReAct Agentï¼Œé…ç½®èŠå¤©æ¨¡åž‹ã€æç¤ºè¯ä»¥åŠç»“æžœçš„è¾“å‡ºæ¨¡å¼ã€‚</p>\n<pre><code class=\"language-python\">review_analysis_react_agent = ReActAgent(\n    chat_model=ResourceDescriptor(\n        clazz=OllamaChatModelSetup,\n        connection=\"ollama_server\",\n        model=\"qwen3:8b\",\n        tools=[\"notify_shipping_manager\"],\n    ),\n    prompt=review_analysis_react_prompt,\n    output_schema=ProductReviewAnalysisRes,\n)\n</code></pre>\n<h5 id=\"ä¸Ž-flink-é›†æˆ-1\">ä¸Ž Flink é›†æˆ</h5>\n<p>è¯»å–å•†å“è¯„è®ºæ–‡æœ¬æ–‡ä»¶ç”Ÿæˆ Source DataStreamï¼Œç”¨ ReAct Agent åˆ†æžå¹¶ç”Ÿæˆç»“æžœ DataStreamï¼Œæœ€åŽæ‰“å°è¾“å‡ºã€‚</p>\n<pre><code class=\"language-python\"># Read product reviews from a text file as a streaming source.\n# Each line in the file should be a JSON string representing a ProductReview.\nproduct_review_stream = env.from_source(\n    source=FileSource.for_record_stream_format(\n        StreamFormat.text_line_format(),\n        f\"file:///{current_dir}/resources/\",\n    )\n    .monitor_continuously(Duration.of_minutes(1))\n    .build(),\n    watermark_strategy=WatermarkStrategy.no_watermarks(),\n    source_name=\"streaming_agent_example\",\n).map(\n    lambda x: ProductReview.model_validate_json(\n        x\n    )  # Deserialize JSON to ProductReview.\n)\n\n# Use the ReAct agent to analyze each product review and notify the shipping manager\n# when needed.\nreview_analysis_res_stream = (\n    agents_env.from_datastream(\n        input=product_review_stream, key_selector=lambda x: x.id\n    )\n    .apply(review_analysis_react_agent)\n    .to_datastream()\n)\n\n# Print the analysis results to stdout.\nreview_analysis_res_stream.print()\n</code></pre>\n<h2 id=\"0x03-reactagent\">0x03 ReActAgent</h2>\n<p>ReActAgent æ˜¯ Agent æŠ½è±¡çš„ä¸€ä¸ªå…·ä½“å®žçŽ°ï¼Œå±•ç¤ºäº†è¿™äº›æŠ½è±¡å¦‚ä½•ååŒå·¥ä½œã€‚</p>\n<ul>\n<li>èµ„æºç®¡ç†ï¼šç®¡ç†èŠå¤©æ¨¡åž‹å’Œæç¤ºè¯èµ„æº</li>\n<li>Actionå®šä¹‰ï¼šå®šä¹‰ start_action å’Œ stop_action å¤„ç†è¾“å…¥å’Œè¾“å‡º</li>\n<li>äº‹ä»¶å¤„ç†ï¼šå“åº” InputEvent å’Œ ChatResponseEvent</li>\n<li>é…ç½®ç®¡ç†ï¼šæ”¯æŒé”™è¯¯å¤„ç†ç­–ç•¥é…ç½®</li>\n<li>è¾“å‡ºæ ¼å¼åŒ–ï¼šæ”¯æŒåŸºäºŽ schema çš„è¾“å‡ºéªŒè¯å’Œæ ¼å¼åŒ–</li>\n</ul>\n<p>è¿™ç§æŠ½è±¡è®¾è®¡ä½¿å¾— Agent ç³»ç»Ÿå…·æœ‰é«˜åº¦çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ç»„åˆä¸åŒçš„èµ„æºã€actionså’Œé…ç½®æ¥æž„å»ºæ»¡è¶³ç‰¹å®šéœ€æ±‚çš„Agentã€‚</p>\n<h3 id=\"31-å®šä¹‰\">3.1 å®šä¹‰</h3>\n<p>ReActAgent çš„å®šä¹‰å¦‚ä¸‹ã€‚</p>\n<pre><code class=\"language-python\">class ReActAgent(Agent):\n    \"\"\"Built-in implementation of ReAct agent which is based on the function\n    call ability of llm.\n\n    This implementation is not based on the foundational ReAct paper which uses\n    prompt to force llm output contain &lt;Thought&gt;, &lt;Action&gt; and &lt;Observation&gt; and\n    extract tool calls by text parsing. For a more robust and feature-rich\n    implementation we use the tool/function call ability of current llm, and get\n    the tool calls from response directly.\n\n    Example:\n        ::\n\n            class OutputData(BaseModel):\n                result: int\n\n\n            env = AgentsExecutionEnvironment.get_execution_environment()\n\n            # register resource to execution environment\n            (\n                env.add_resource(\n                    \"ollama\",\n                    ResourceDescriptor(clazz=OllamaChatModelConnection, model=model),\n                )\n                .add_resource(\"add\", add)\n                .add_resource(\"multiply\", multiply)\n            )\n\n            # prepare prompt\n            prompt = Prompt.from_messages(\n                messages=[\n                    ChatMessage(\n                        role=MessageRole.SYSTEM,\n                        content='An example of output is {\"result\": 30.32}.',\n                    ),\n                    ChatMessage(\n                        role=MessageRole.USER, content=\"What is ({a} + {b}) * {c}\"\n                    ),\n                ],\n            )\n\n            # create ReAct agent.\n            agent = ReActAgent(\n                chat_model=ResourceDescriptor(\n                    clazz=OllamaChatModelSetup,\n                    connection=\"ollama_server\",\n                    tools=[\"notify_shipping_manager\"],\n                ),\n                prompt=prompt,\n                output_schema=OutputData,\n            )\n    \"\"\"\n\n    def __init__(\n        self,\n        *,\n        chat_model: ResourceDescriptor,\n        prompt: Prompt | None = None,\n        output_schema: type[BaseModel] | RowTypeInfo | None = None,\n    ) -&gt; None:\n        \"\"\"Init method of ReActAgent.\n\n        Parameters\n        ----------\n        chat_model : ResourceDescriptor\n            The descriptor of the chat model used in this ReAct agent.\n        prompt : Optional[Prompt] = None\n            Prompt to instruct the llm, could include input and output example,\n            task and so on.\n        output_schema : Optional[Union[type[BaseModel], RowTypeInfo]] = None\n            The schema should be RowTypeInfo or subclass of BaseModel. When user\n            provide output schema, ReAct agent will add system prompt to instruct\n            response format of llm, and add output parser according to the schema.\n        \"\"\"\n        super().__init__()\n        self.add_resource(_DEFAULT_CHAT_MODEL, chat_model)\n\n        if output_schema:\n            if isinstance(output_schema, type) and issubclass(output_schema, BaseModel):\n                json_schema = output_schema.model_json_schema()\n            elif isinstance(output_schema, RowTypeInfo):\n                json_schema = str(output_schema)\n            else:\n                err_msg = f\"Output schema {output_schema.__class__} is not supported.\"\n                raise TypeError(err_msg)\n            schema_prompt = f\"The final response should be json format, and match the schema {json_schema}.\"\n            self._resources[ResourceType.PROMPT][_DEFAULT_SCHEMA_PROMPT] = (\n                Prompt.from_text(text=schema_prompt)\n            )\n\n        if prompt:\n            self._resources[ResourceType.PROMPT][_DEFAULT_USER_PROMPT] = prompt\n\n        self.add_action(\n            name=\"stop_action\",\n            events=[ChatResponseEvent],\n            func=self.stop_action,\n            output_schema=OutputSchema(output_schema=output_schema),\n        )\n</code></pre>\n<h3 id=\"32-æ·±åº¦å®šåˆ¶\">3.2 æ·±åº¦å®šåˆ¶</h3>\n<p>Flink å¯¹ ReActAgent åšäº†æ·±åº¦å®šåˆ¶ï¼Œä½¿å…¶èƒ½åœ¨åˆ†å¸ƒå¼æµå¤„ç†çŽ¯å¢ƒä¸­é«˜æ•ˆæ‰§è¡Œï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½æ¥ç®€åŒ– LLM åº”ç”¨å¼€å‘ã€‚</p>\n<h4 id=\"321-reactagent-ç‰¹è‰²\">3.2.1 ReActAgent ç‰¹è‰²</h4>\n<h5 id=\"æµå¼å¤„ç†é€‚é…\">æµå¼å¤„ç†é€‚é…</h5>\n<p>Flink å°†ä¼ ç»Ÿçš„ ReAct æ¨¡å¼é€‚é…åˆ°äº†æµå¤„ç†çŽ¯å¢ƒä¸­ï¼š</p>\n<ul>\n<li>é€šè¿‡ InputEvent å’Œ OutputEvent åŒ…è£…è¾“å…¥è¾“å‡ºæ•°æ®</li>\n<li>åˆ©ç”¨ Flink çš„äº‹ä»¶é©±åŠ¨æž¶æž„å®žçŽ°å¼‚æ­¥å¤„ç†</li>\n<li>é€šè¿‡ RunnerContext ç®¡ç†çŠ¶æ€å’Œèµ„æº</li>\n</ul>\n<pre><code class=\"language-python\">agents_env = AgentsExecutionEnvironment.get_execution_environment(env)\nagents_env.fromDataStream(dataStream) # ä»ŽDataStreamè¾“å…¥\nagents_env.fromTable(table) # ä»ŽTableè¾“å…¥\nagents_env.fromList(list) # ä»ŽListè¾“å…¥\n\nreview_analysis_res_stream = (\n        agents_env.from_datastream( # ä»ŽDataSteamåˆ›å»ºAgentæµç¨‹\n            input=product_review_stream, key_selector=lambda x: x.id\n        )\n        .apply(review_analysis_react_agent) # åº”ç”¨Agent\n        .to_datastream() # è½¬æ¢å›žStream\n    )\n</code></pre>\n<h5 id=\"ç‰¹å®šçš„è¡Œä¸ºæ¨¡å¼\">ç‰¹å®šçš„è¡Œä¸ºæ¨¡å¼</h5>\n<p>ReActAgent å®žçŽ°äº†ç‰¹å®šçš„ ReActï¼ˆReasoning + Actionï¼‰èŒƒå¼ï¼Œè¿™æ˜¯ä¸€ç§ç»“åˆæŽ¨ç†å’Œè¡ŒåŠ¨çš„ AI Agent æ¨¡å¼ã€‚å®ƒå†…ç½®äº†ä¸¤ä¸ªæ ¸å¿ƒåŠ¨ä½œï¼šstart_action()å’Œ stop_action()ã€‚ä½¿ç”¨é¢„å®šä¹‰çš„æµç¨‹æ¥å¤„ç†è¾“å…¥å¹¶ç”Ÿæˆè¾“å‡ºï¼Œè€Œéžè®©ç”¨æˆ·å®Œå…¨è‡ªå®šä¹‰è¡Œä¸ºé€»è¾‘ã€‚</p>\n<ul>\n<li>start_action æŽ¥æ”¶è¾“å…¥å¹¶å‘é€ ChatRequestEvent</li>\n<li>stop_action å¤„ç† ChatResponseEvent å¹¶äº§ç”Ÿæœ€ç»ˆè¾“å‡º</li>\n</ul>\n<h5 id=\"é”®æŽ§çŠ¶æ€æ”¯æŒ\">é”®æŽ§çŠ¶æ€æ”¯æŒ</h5>\n<p>æ”¯æŒFlinkçš„é”®æŽ§çŠ¶æ€ç‰¹æ€§</p>\n<pre><code class=\"language-python\">review_analysis_res_stream = (\n    agents_env.from_datastream(\n        input=product_review_stream, key_selector=lambda x: x.id\n    )\n    .apply(review_analysis_react_agent)\n    .to_datastream()\n)\n</code></pre>\n<h5 id=\"llm-é›†æˆä¼˜åŒ–\">LLM é›†æˆä¼˜åŒ–</h5>\n<p>ReActAgent ä¸“é—¨ä¸º LLM äº¤äº’è¿›è¡Œä¼˜åŒ–ï¼šå†…ç½®äº†æç¤ºè¯ç®¡ç†å’Œæ ¼å¼åŒ–åŠŸèƒ½ï¼›æ”¯æŒç»“æž„åŒ–è¾“å‡ºæ¨¡å¼ï¼Œå¯ä»¥æŒ‡å®šè¾“å‡ºçš„æ•°æ®schemaï¼›é›†æˆäº†é”™è¯¯å¤„ç†ç­–ç•¥ï¼Œå½“LLMè¾“å‡ºä¸ç¬¦åˆé¢„æœŸæ ¼å¼æ—¶å¯ä»¥é€‰æ‹©å¤±è´¥æˆ–è€…å¿½ç•¥ã€‚</p>\n<h5 id=\"èµ„æºç®¡ç†æ–¹å¼\">èµ„æºç®¡ç†æ–¹å¼</h5>\n<p>ReActAgent ä¸­è‡ªåŠ¨æ·»åŠ é»˜è®¤èµ„æºï¼Œç›¸æ¯”æ™®é€šçš„Agentï¼ŒReActAgent ä¼šè‡ªåŠ¨ä¸ºç”¨æˆ·è®¾ç½®å¥½å¿…è¦çš„èµ„æºï¼Œç®€åŒ–ä½¿ç”¨æµç¨‹ã€‚é€šè¿‡ç»Ÿä¸€çš„èµ„æºç®¡ç†ç³»ç»Ÿä¸ŽFlinké›†æˆã€‚ReActAgent é€šè¿‡ _DEFAULT_CHAT_MODEL ç­‰å¸¸é‡å¼•ç”¨åœ¨ AgentsExecutionEnvironment ä¸­æ³¨å†Œçš„èµ„æºã€‚</p>\n<pre><code class=\"language-python\">agents_env.add_resource(_DEFAULT_CHAT_MODEL, chat_model)\nagents_env.addResource(\"ollama_server\", ResourceDescriptor(...))\nagents_env.addResource(\"notify_shipping_manager\", Tool.from_callable(...))\n</code></pre>\n<h5 id=\"ç±»åž‹ä¿¡æ¯å¤„ç†\">ç±»åž‹ä¿¡æ¯å¤„ç†</h5>\n<p>Flink Agentèƒ½å¤Ÿå¤„ç†Flinkçš„ç±»åž‹ç³»ç»Ÿ</p>\n<pre><code class=\"language-python\">        if (outputSchema != null) {\n            String jsonSchema;\n            // æ”¯æŒRowTypeInfoå’ŒPOJOç±»åž‹\n            if (outputSchema instanceof RowTypeInfo) {\n            \t// å¤„ç†Rowç±»åž‹\n                jsonSchema = outputSchema.toString();\n                outputSchema = new OutputSchema((RowTypeInfo) outputSchema);\n            } else if (outputSchema instanceof Class) {\n            \t// å¤„ç†POJOç±»åž‹\n                try {\n                    jsonSchema = mapper.generateJsonSchema((Class&lt;?&gt;) outputSchema).toString();\n                } catch (JsonMappingException e) {\n                    throw new RuntimeException(e);\n                }\n            } \n</code></pre>\n<h5 id=\"é”™è¯¯å¤„ç†æœºåˆ¶\">é”™è¯¯å¤„ç†æœºåˆ¶</h5>\n<p>Flink ä¸º ReActAgent å®žçŽ°äº†çµæ´»çš„å¤„ç†å¤„ç†ç­–ç•¥ï¼Œè¿è¡Œç”¨æˆ·é€‰æ‹©åœ¨è§£æžå¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸è¿˜æ˜¯å¿½ç•¥é”™è¯¯ã€‚</p>\n<pre><code class=\"language-python\">        except Exception:\n            if error_handling_strategy == ErrorHandlingStrategy.IGNORE:\n                logging.warning(\n                    f\"The response of llm {output} doesn't match schema constraint, ignoring.\"\n                )\n                return\n            elif error_handling_strategy == ErrorHandlingStrategy.FAIL:\n                raise\n</code></pre>\n<h5 id=\"ç»“æž„åŒ–è¾“å‡ºæ”¯æŒ\">ç»“æž„åŒ–è¾“å‡ºæ”¯æŒ</h5>\n<p>Flink ä¸º ReActAgent æ·»åŠ äº†ç»“æž„åŒ–è¾“å‡ºçš„èƒ½åŠ›ï¼Œè¿™æ ·å¯ä»¥è®© LLM çš„è¾“å‡ºç¬¦åˆé¢„å®šä¹‰çš„æ•°æ®ç»“æž„ï¼Œä¾¿äºŽåŽç»­ç®¡ç†ã€‚</p>\n<pre><code class=\"language-python\">        if output_schema:\n            if isinstance(output_schema, type) and issubclass(output_schema, BaseModel):\n                json_schema = output_schema.model_json_schema()\n            elif isinstance(output_schema, RowTypeInfo):\n                json_schema = str(output_schema)\n            else:\n                err_msg = f\"Output schema {output_schema.__class__} is not supported.\"\n                raise TypeError(err_msg)\n            schema_prompt = f\"The final response should be json format, and match the schema {json_schema}.\"\n            self._resources[ResourceType.PROMPT][_DEFAULT_SCHEMA_PROMPT] = (\n                Prompt.from_text(text=schema_prompt)\n            )\n</code></pre>\n<h5 id=\"æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ\">æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ</h5>\n<p>Flink å®žçŽ°äº†ä¸€ä¸ªå®Œæ•´çš„æç¤ºè¯æ¨¡æ¿ç®¡ç†ç³»ç»Ÿï¼š</p>\n<ul>\n<li>æ”¯æŒå­—ç¬¦ä¸²æ¨¡æ¿å’Œæ¶ˆæ¯åˆ—è¡¨æ¨¡åž‹</li>\n<li>æä¾›æ ¼å¼åŒ–åŠŸèƒ½ï¼Œå¯ä»¥åŠ¨æ€æ›¿æ¢æ¨¡æ¿ä¸­çš„å ä½ç¬¦</li>\n<li>è‡ªåŠ¨å¤„ç†ä¸åŒç±»åž‹è¾“å…¥çš„è½¬æ¢</li>\n</ul>\n<h5 id=\"å·¥å…·è°ƒç”¨é›†æˆ\">å·¥å…·è°ƒç”¨é›†æˆ</h5>\n<p>Flink å°†å·¥å…·è°ƒç”¨é›†æˆåˆ° ReActAgentä¸­ã€‚</p>\n<pre><code class=\"language-python\"># æ³¨å†Œå·¥å…·èµ„æº\n    # Add Ollama chat model connection and notify shipping manager tool to be used\n    # by the Agent.\n    agents_env.add_resource(\n        \"ollama_server\",\n        ResourceDescriptor(clazz=OllamaChatModelConnection, request_timeout=120),\n    ).add_resource(\n        \"notify_shipping_manager\", Tool.from_callable(notify_shipping_manager)\n    )\n    \n# åœ¨Agent ä¸­ä½¿ç”¨å·¥å…·\n    # Create react agent\n    review_analysis_react_agent = ReActAgent(\n        chat_model=ResourceDescriptor(\n            clazz=OllamaChatModelSetup,\n            connection=\"ollama_server\",\n            model=\"qwen3:8b\",\n            tools=[\"notify_shipping_manager\"],\n        ),\n        prompt=review_analysis_react_prompt,\n        output_schema=ProductReviewAnalysisRes,\n    )\n</code></pre>\n<h5 id=\"è¿è¡Œæ—¶åä½œ\">è¿è¡Œæ—¶åä½œ</h5>\n<ul>\n<li>æ‰§è¡ŒçŽ¯å¢ƒè´Ÿè´£è°ƒåº¦å’Œè¿è¡ŒAgentä¸­çš„å„ä¸ªç»„ä»¶</li>\n<li>Agenté€šè¿‡RunnerContext è®¿é—®åœ¨çŽ¯å¢ƒä¸­æ³¨å†Œçš„èµ„æº</li>\n<li>æ•´ä¸ªè¿‡ç¨‹é‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ï¼Œé€šè¿‡å‘é€å’ŒæŽ¥æ”¶äº‹ä»¶æ¥æŽ¨è¿›æ‰§è¡Œæµç¨‹</li>\n</ul>\n<h3 id=\"33-å…¸åž‹æ‰§è¡Œæµç¨‹\">3.3 å…¸åž‹æ‰§è¡Œæµç¨‹</h3>\n<p>å¯¹äºŽ ReActAgent æ¥è¯´ï¼Œå…·ä½“é€‚é…æµç¨‹å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>çŽ¯å¢ƒåˆå§‹åŒ–ï¼šé€šè¿‡ AgentsExecutionEnvironment.get_execution_environment(env) èŽ·å–é€‚å½“çš„æ‰§è¡ŒçŽ¯å¢ƒ</li>\n<li>èµ„æºé…ç½®ï¼šä½¿ç”¨ addResource() æ·»åŠ æ¨¡åž‹ã€å·¥å…·ç­‰èµ„æº</li>\n<li>è¾“å…¥è®¾ç½®ï¼šé€šè¿‡fromDataStream()ã€ fromTable()ç­‰è®¾ç½®è¾“å…¥æº</li>\n<li>Agentåº”ç”¨ï¼šä½¿ç”¨ apply()æ–¹æ³•åº”ç”¨Agent é€»è¾‘</li>\n<li>è¾“å‡ºèŽ·å–ï¼šé€šè¿‡ toDataStream() èŽ·å–å¤„ç†åŽçš„ DataStream</li>\n<li>æ‰§è¡Œï¼šé€šè¿‡execute() è§¦å‘Flinkä½œä¸šæ‰§è¡Œ</li>\n</ul>\n<p>å…¸åž‹çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>run å‡½æ•°æŽ¥æ”¶åˆ°è¾“å…¥æ•°æ®</li>\n<li>åˆ›å»ºInputEvent å¹¶å‘é€åˆ°äº‹ä»¶é˜Ÿåˆ—</li>\n<li>start_actionå¤„ç†InputEventï¼Œæ ¼å¼åŒ–è¾“å…¥å¹¶å‘é€ ChatRequestEvent</li>\n<li>LLMå¤„ç†åŽäº§ç”Ÿ ChatResponseEvent</li>\n<li>stop_action å¤„ç† ChatResponseEventï¼Œè§£æžç»“æžœå¹¶å‘é€ OutputEvent</li>\n<li>run å‡½æ•°æ”¶é›† OutputEvent å¹¶è¿”å›žç»“æžœ</li>\n</ul>\n<p>å…³é”®ç‰¹ç‚¹æ˜¯ï¼š</p>\n<ul>\n<li>äº‹ä»¶é©±åŠ¨ï¼šä½¿ç”¨äº‹ä»¶é˜Ÿåˆ—é©±åŠ¨æ•´ä¸ªæ‰§è¡Œæµç¨‹</li>\n<li>ä¸Šä¸‹æ–‡éš”ç¦»ï¼šæ¯ä¸ªé”®å€¼å¯¹åº”ç‹¬ç«‹çš„æ‰§è¡Œä¸Šä¸‹æ–‡</li>\n<li>å¼‚æ­¥æ”¯æŒï¼šè™½ç„¶æœ¬åœ°æ‰§è¡ŒçŽ¯å¢ƒå›žé€€åˆ°åŒæ­¥æ‰§è¡Œï¼Œä½†ä»ç„¶æ”¯æŒå¼‚æ­¥æŽ¥å£</li>\n<li>çŠ¶æ€ç®¡ç†ï¼šé€šè¿‡ LocalRunnerContext ç®¡ç†çŸ­æœŸè®°å¿†å’Œèµ„æºé…ç½®</li>\n</ul>\n<h3 id=\"34-start_action-ä¸Ž-stop_action\">3.4 start_action ä¸Ž stop_action</h3>\n<p><strong>æ•´ä½“æµç¨‹ç‰¹è‰²</strong></p>\n<p>è¿™ä¸¤ä¸ª action æž„æˆå®Œæ•´çš„ ReAct æ¨¡å¼ï¼š</p>\n<ul>\n<li>å¼€å§‹-ç»“æŸæ¨¡å¼ï¼šstart_action ä½œä¸ºå…¥å£ï¼Œå°†åŽŸå§‹è¾“å…¥è½¬åŒ–ä¸ºé€‚åˆ LLM å¤„ç†çš„æ ¼å¼ï¼›stop_action ä½œä¸ºå‡ºå£ï¼Œå°† LLM å“åº”è½¬æ¢ä¸ºç»“æž„åŒ–è¾“å‡ºã€‚</li>\n<li>ä¸­é—´å¤„ç†é€æ˜ŽåŒ–ï¼šç”¨æˆ·æ— éœ€å…³å¿ƒä¸­é—´æ­¥éª¤ï¼ˆå¦‚å·¥å…·è°ƒç”¨ã€ä¸Šä¸‹æ–‡æ£€ç´¢ç­‰ï¼‰ï¼Œè¿™äº›ç”±å†…ç½®çš„ CHAT_MODEL_ACTIONã€TOOL_CALL_ACTION ç­‰è‡ªåŠ¨å¤„ç†ã€‚</li>\n<li>å¯é…ç½®æ€§ï¼šæ”¯æŒè‡ªå®šä¹‰ Promptã€è¾“å‡º schema å®šä¹‰åŠé”™è¯¯å¤„ç†ç­–ç•¥ã€‚</li>\n</ul>\n<p><strong>åŠŸèƒ½</strong></p>\n<p>ReActAgent çš„ start_action ä¸Ž stop_action å„å…·ç‰¹å¾ï¼ŒäºŒè€…åˆ†åˆ«æ‰¿æ‹…å¯¹è¯çš„å‘èµ·ä¸Žç»ˆç»“èŒè´£ã€‚</p>\n<ul>\n<li>start_action è´Ÿè´£è¾“å…¥äº‹ä»¶çš„å¤„ç†ã€‚å®ƒé¦–å…ˆæŽ¥æ”¶ InputEventï¼Œä½œä¸ºæ•´ä¸ª Agent æµç¨‹çš„èµ·ç‚¹ï¼Œå¯æŽ¥å—åŽŸå§‹ç±»åž‹ã€å¤æ‚å¯¹è±¡æˆ– Row ç­‰å¤šç§æ•°æ®ã€‚è‹¥æä¾› Promptï¼Œåˆ™ä»¥æ­¤æ ¼å¼åŒ–ç”¨æˆ·è¾“å…¥ï¼Œå°†ç®€å•å­—ç¬¦ä¸²æˆ–å¤æ‚å¯¹è±¡ï¼ˆå¦‚ Row æˆ– POJOï¼‰çš„å±žæ€§è‡ªåŠ¨æå–å¹¶å¡«å…¥æ¨¡æ¿ã€‚éšåŽï¼Œç³»ç»Ÿè‡ªåŠ¨è¿½åŠ  schema promptï¼Œçº¦æŸå¤§æ¨¡åž‹è¾“å‡ºç»“æž„ï¼Œå†å°†æ•´ç†åŽçš„å†…å®¹å°è£…ä¸º ChatRequestEventï¼Œè§¦å‘åŽç»­å¤„ç†ï¼Œé»˜è®¤è°ƒç”¨ _DEFAULT_CHAT_MODEL å®Œæˆé¦–æ¬¡ç”Ÿæˆã€‚</li>\n<li>stop_action åˆ™å¤„ç†è¾“å‡ºäº‹ä»¶ã€‚å®ƒä»¥ ChatResponseEvent ä¸ºè¾“å…¥ï¼Œæ ‡å¿—å¤§æ¨¡åž‹ç”Ÿæˆå®Œæ¯•ï¼Œæ˜¯æ•´ä¸ªæµç¨‹çš„ç»ˆç‚¹ã€‚è¯¥åŠ¨ä½œæ”¯æŒæŒ‰ schema è§£æžä¸ŽéªŒè¯è¿”å›žç»“æžœï¼Œå¯å°† JSON æ–‡æœ¬è½¬æ¢ä¸º Pydantic æ¨¡åž‹æˆ– RowTypeInfo æŒ‡å®šç»“æž„ï¼Œå¹¶æä¾›é”™è¯¯å¤„ç†ç­–ç•¥ï¼ˆå¿½ç•¥æˆ–æŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œä¿è¯è¾“å‡ºç±»åž‹å®‰å…¨ä¸Žä¸šåŠ¡ä¸€è‡´æ€§ã€‚</li>\n</ul>\n<p><strong>ä¸Žå…¶ä»–ç»„ä»¶çš„åä½œ</strong></p>\n<p>åœ¨ ReActAgent åˆå§‹åŒ–æ—¶æ³¨å†Œè¿™ä¸¤ä¸ª actionï¼š</p>\n<pre><code class=\"language-python\">self.add_action(\n    name=\"stop_action\",\n    events=[ChatResponseEvent],\n    func=self.stop_action,\n    output_schema=OutputSchema(output_schema=output_schema),\n)\n</code></pre>\n<p>è¿™ä¸¤ä¸ª action ä¸Ž Agent å†…ç½®çš„å…¶ä»– actionï¼ˆå¦‚å·¥å…·è°ƒç”¨ã€ä¸Šä¸‹æ–‡æ£€ç´¢ï¼‰é…åˆå·¥ä½œï¼Œåœ¨ ActionExecutionOperator ä¸­å½¢æˆä¸€ä¸ªå®Œæ•´çš„äº‹ä»¶é©±åŠ¨å¤„ç†é“¾ã€‚</p>\n<h3 id=\"35-è¾“å…¥è¾“å‡º\">3.5 è¾“å…¥è¾“å‡º</h3>\n<p>Flink Agent çš„è¾“å…¥è¾“å‡ºå…·æœ‰ä»¥ä¸‹å‡ ä¸ªæ˜¾è‘—ç‰¹ç‚¹ï¼Œå¹¶é€šè¿‡ç‰¹å®šæœºåˆ¶ä¸ŽFlinkè¿›è¡Œé€‚é…ã€‚</p>\n<h4 id=\"351-äº‹ä»¶é©±åŠ¨æž¶æž„\">3.5.1 äº‹ä»¶é©±åŠ¨æž¶æž„</h4>\n<p>Flink Agent åŸºäºŽäº‹ä»¶é©±åŠ¨æ¨¡åž‹ï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯é€šè¿‡äº‹ä»¶å¯¹è±¡è¿›è¡Œä¼ é€’ï¼š</p>\n<ul>\n<li>è¾“å…¥ï¼šé€šè¿‡InputEvent å°è£…åŽŸå§‹æ•°æ®</li>\n<li>è¾“å‡ºï¼šé€šè¿‡OutputEventå°è£…å¤„ç†ç»“æžœ</li>\n<li>ä¸­é—´äº‹ä»¶ï¼šåŒ…æ‹¬ ChatRequestEventã€ChatResponseEventã€ToolRequestEventã€ToolResponseEventç­‰</li>\n</ul>\n<h4 id=\"352-ç»Ÿä¸€çš„æ•°æ®å°è£…\">3.5.2 ç»Ÿä¸€çš„æ•°æ®å°è£…</h4>\n<p>æ‰€æœ‰æ•°æ®éƒ½è¢«å°è£…æˆäº‹ä»¶å¯¹è±¡ï¼Œä¾¿äºŽAgentå†…éƒ¨æµè½¬å’Œå¤„ç†ã€‚</p>\n<h4 id=\"353-æ”¯æŒå¤šç§æ•°æ®ç±»åž‹\">3.5.3 æ”¯æŒå¤šç§æ•°æ®ç±»åž‹</h4>\n<p>è¾“å…¥æ”¯æŒå¤šç§æ•°æ®ç±»åž‹ï¼š</p>\n<ul>\n<li>åŸºæœ¬æ•°æ®ç±»åž‹</li>\n<li>Flink Rowå¯¹è±¡</li>\n<li>POJOå¯¹è±¡</li>\n<li>å¤æ‚åµŒå¥—ç»“æžœ</li>\n</ul>\n<p>è¾“å‡ºåŒæ ·æ”¯æŒçµæ´»çš„æ•°æ®ç»“æž„ï¼Œå¯ä»¥é€šè¿‡schemaè¿›è¡Œçº¦æŸ</p>\n<h4 id=\"354-å†…ç½®æ¨¡æ¿æ”¯æŒ\">3.5.4 å†…ç½®æ¨¡æ¿æ”¯æŒ</h4>\n<p>é€šè¿‡Promptç±»æ”¯æŒæ¨¡æ¿åŒ–è¾“å…¥å¤„ç†ï¼Œå¯ä»¥å®šä¹‰å¤æ‚çš„æç¤ºè¯æ¨¡æ¿</p>\n<h3 id=\"36-æ¨¡æ¿ç³»ç»Ÿ\">3.6 æ¨¡æ¿ç³»ç»Ÿ</h3>\n<p>æ¨¡æ¿å¯ä»¥ç”¨åœ¨æç¤ºè¯å’ŒSchemaã€‚Flink Agent ä¸­çš„æ¨¡æ¿ç³»ç»Ÿä¸»è¦åœ¨ Prompt ç±»ä¸­å®žçŽ°ï¼Œæ”¯æŒä¸¤ç§ç±»åž‹çš„æ¨¡æ¿ï¼š</p>\n<h4 id=\"361-å­—ç¬¦ä¸²æ¨¡æ¿\">3.6.1 å­—ç¬¦ä¸²æ¨¡æ¿</h4>\n<p>æœ€åŸºæœ¬çš„æ¨¡æ¿å½¢å¼ï¼Œå°±æ˜¯ä¸€ä¸ªåŒ…å«å ä½ç¬¦çš„å­—ç¬¦ä¸²ï¼š</p>\n<pre><code class=\"language-java\">        String specialTemplate = \"Handle special chars: {text} with symbols like @#$%^&amp;*()\";\n        Prompt specialPrompt = new Prompt(specialTemplate);\n\n        Map&lt;String, String&gt; specialVars = new HashMap&lt;&gt;();\n        specialVars.put(\"text\", \"Hello &amp; Welcome!\");\n\n        String result = specialPrompt.formatString(specialVars);\n\n</code></pre>\n<h4 id=\"362-æ¶ˆæ¯æ¨¡æ¿\">3.6.2 æ¶ˆæ¯æ¨¡æ¿</h4>\n<p>æ›´å¤æ‚çš„æ¨¡æ¿å½¢å¼ï¼ŒåŒ…å«å¤šä¸ª ChatMessage å¯¹è±¡ï¼Œå¯ä»¥æŒ‡å®šä¸åŒçš„è§’è‰²ã€‚</p>\n<pre><code class=\"language-python\">        List&lt;ChatMessage&gt; multipleMessages =\n                Arrays.asList(\n                        new ChatMessage(MessageRole.SYSTEM, \"You are a helpful assistant.\"),\n                        new ChatMessage(MessageRole.USER, \"First message\"),\n                        new ChatMessage(MessageRole.ASSISTANT, \"I understand\"),\n                        new ChatMessage(\n                                MessageRole.USER, \"Second message - this should be the response\"));\n\n        Prompt multiPrompt = new Prompt(multipleMessages);\n\n</code></pre>\n<p>æ¨¡æ¿çš„ç®¡ç†æµç¨‹å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>æ¨¡æ¿åˆ›å»ºï¼šç”¨æˆ·åˆ›å»º Prompt  å¯¹è±¡ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ¶ˆæ¯åˆ—è¡¨ã€‚</li>\n<li>å˜é‡æ›¿æ¢ï¼šä½¿ç”¨ formatString() æˆ–è€… formatMessages() æ–¹æ³•å¯¹ä¼ å…¥å˜é‡æ˜ å°„è¿›è¡Œæ›¿æ¢</li>\n<li>LLM è°ƒç”¨ï¼šæ ¼å¼åŒ–çš„æ¶ˆæ¯è¢«å‘é€ç»™LLMè¿›è¡Œå¤„ç†ã€‚</li>\n</ul>\n<pre><code class=\"language-python\">class Prompt(SerializableResource, ABC):\n    \"\"\"Base prompt abstract.\"\"\"\n\n    @staticmethod\n    def from_messages(messages: Sequence[ChatMessage]) -&gt; \"Prompt\":\n        \"\"\"Create prompt from sequence of ChatMessage.\"\"\"\n        return LocalPrompt(template=messages)\n\n    @staticmethod\n    def from_text(text: str) -&gt; \"Prompt\":\n        \"\"\"Create prompt from text string.\"\"\"\n        return LocalPrompt(template=text)\n\n    @abstractmethod\n    def format_string(self, **kwargs: str) -&gt; str:\n        \"\"\"Generate text string from template with additional arguments.\"\"\"\n\n    @abstractmethod\n    def format_messages(\n        self, role: MessageRole = MessageRole.SYSTEM, **kwargs: str\n    ) -&gt; List[ChatMessage]:\n        \"\"\"Generate list of ChatMessage from template with additional arguments.\"\"\"\n\n    @classmethod\n    @override\n    def resource_type(cls) -&gt; ResourceType:\n        \"\"\"Get the resource type.\"\"\"\n        return ResourceType.PROMPT\n\nclass LocalPrompt(Prompt):\n    \"\"\"Prompt for a language model.\n\n    Attributes:\n    ----------\n    template : Union[Sequence[ChatMessage], str]\n        The prompt template.\n    \"\"\"\n\n    template: Sequence[ChatMessage] | str\n\n    def format_string(self, **kwargs: str) -&gt; str:\n        \"\"\"Generate text string from template with input arguments.\"\"\"\n        if isinstance(self.template, str):\n            return format_string(self.template, **kwargs)\n        else:\n            msgs = []\n            for m in self.template:\n                msg = f\"{m.role.value}: {format_string(m.content, **kwargs)}\"\n                if m.extra_args is not None and len(m.extra_args) &gt; 0:\n                    msg += f\"{m.extra_args}\"\n                msgs.append(msg)\n            return \"\\n\".join(msgs)\n\n    def format_messages(\n        self, role: MessageRole = MessageRole.SYSTEM, **kwargs: str\n    ) -&gt; List[ChatMessage]:\n        \"\"\"Generate list of ChatMessage from template with input arguments.\"\"\"\n        if isinstance(self.template, str):\n            return [\n                ChatMessage(role=role, content=format_string(self.template, **kwargs))\n            ]\n        else:\n            msgs = []\n            for m in self.template:\n                msg = ChatMessage(\n                    role=m.role, content=format_string(m.content, **kwargs)\n                )\n                msgs.append(msg)\n            return msgs\n</code></pre>\n<h3 id=\"37-functiontool-ä¸Ž-action-çš„å…³è”åŠæ³¨å†Œæœºåˆ¶\">3.7 FunctionTool ä¸Ž Action çš„å…³è”åŠæ³¨å†Œæœºåˆ¶</h3>\n<p>åœ¨ Flink Agents æ¡†æž¶ä¸­ï¼Œfunction tool ä¸Ž action çš„è”ç³»å’Œæ³¨å†Œæ¶‰åŠå¤šä¸ªç»„ä»¶å’Œæ­¥éª¤ã€‚</p>\n<h4 id=\"371-å®žé™…è½¬æ¢æµç¨‹\">3.7.1 å®žé™…è½¬æ¢æµç¨‹</h4>\n<p>å…·ä½“çš„å·¥å…·åˆ° prompt çš„è½¬æ¢è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>å·¥å…·é€šè¿‡ @Tool æˆ– @tool æ³¨å†Œåˆ°æ‰§è¡ŒçŽ¯å¢ƒä¸­</li>\n<li>åœ¨åˆ›å»º ResourceDescriptor æ—¶ï¼Œé€šè¿‡ tools å‚æ•°å¼•ç”¨è¿™äº›å·²æ³¨å†Œçš„å·¥å…·</li>\n<li>å½“èŠå¤©æ¨¡åž‹ setup ç±»ï¼ˆå¦‚ OllamaChatModelSetupï¼‰åˆå§‹åŒ–æ—¶ï¼Œå®ƒä¼šèŽ·å–è¿™äº›å·¥å…·çš„å…ƒæ•°æ®ï¼ˆåŒ…æ‹¬åç§°å’Œæè¿°ï¼‰</li>\n<li>è¿™äº›å·¥å…·ä¿¡æ¯ä¼šè¢«è‡ªåŠ¨æ•´åˆåˆ°å‘é€ç»™ LLM çš„ç³»ç»Ÿ prompt ä¸­ï¼Œå‘ŠçŸ¥ LLM æœ‰å“ªäº›å¯ç”¨å·¥å…·åŠå…¶ç”¨é€”</li>\n</ol>\n<p>è¿™ç§æ–¹å¼ä½¿å¾—å¼€å‘è€…åªéœ€å…³æ³¨å·¥å…·çš„å®šä¹‰å’Œæ³¨å†Œï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç¼–å†™å·¥å…·æè¿°åˆ° prompt ä¸­ï¼Œæé«˜äº†å¼€å‘æ•ˆçŽ‡å¹¶å‡å°‘äº†å‡ºé”™å¯èƒ½æ€§ã€‚</p>\n<h5 id=\"function-tool-æ³¨å†Œåˆ°-agent\">Function Tool æ³¨å†Œåˆ° Agent</h5>\n<p>Function tool é¦–å…ˆé€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ³¨å†Œåˆ°æ‰§è¡ŒçŽ¯å¢ƒä¸­ï¼š</p>\n<p><strong>æ–¹å¼ä¸€ï¼šä½¿ç”¨è£…é¥°å™¨</strong></p>\n<pre><code class=\"language-python\">    @tool\n    @staticmethod\n    def notify_shipping_manager(id: str, review: str) -&gt; None:\n        \"\"\"Notify the shipping manager when product received a negative review due to\n        shipping damage.\n\n        Parameters\n        ----------\n        id : str\n            The id of the product that received a negative review due to shipping damage\n        review: str\n            The negative review content\n        \"\"\"\n        # reuse the declared function, but for parsing the tool metadata, we write doc\n        # string here again.\n        notify_shipping_manager(id=id, review=review)\n</code></pre>\n<p><strong>æ–¹å¼äºŒï¼šä½¿ç”¨ add_resource æ–¹æ³•</strong></p>\n<p>å³ï¼Œåœ¨æ‰§è¡ŒçŽ¯å¢ƒæ³¨å†Œå·¥å…·èµ„æºã€‚</p>\n<pre><code class=\"language-python\">def add(a: int, b: int) -&gt; int:\n    \"\"\"Calculate the sum of a and b.\n\n    Parameters\n    ----------\n    a : int\n        The first operand\n    b : int\n        The second operand\n\n    Returns:\n    -------\n    int:\n        The sum of a and b\n    \"\"\"\n    return a + b\n\nenv.add_resource(\"add\", ResourceType.TOOL, add)\n</code></pre>\n<p><strong>æ–¹å¼ä¸‰ï¼šåœ¨ Agent æž„é€ å‡½æ•°ä¸­æ·»åŠ </strong></p>\n<pre><code class=\"language-python\">class MyAgent(Agent):\n    def __init__(self):\n        super().__init__()\n        self.add_resource(\"add\", add) # æ·»åŠ åˆ° TOOL ç±»åž‹èµ„æºä¸­\n</code></pre>\n<p><strong>æ–¹å¼å››ï¼šåœ¨  ReActAgent æž„å»ºæ—¶å€™ä¼ å…¥</strong></p>\n<p>å³ï¼Œé€šè¿‡ tools å‚æ•°æŒ‡å®šã€‚</p>\n<pre><code class=\"language-java\">    // Create ReAct agent.\n    private static ReActAgent getReActAgent() {\n        return new ReActAgent(\n                ResourceDescriptor.Builder.newBuilder(OllamaChatModelSetup.class.getName())\n                        .addInitialArgument(\"connection\", \"ollamaChatModelConnection\")\n                        .addInitialArgument(\"model\", \"qwen3:8b\")\n                        .addInitialArgument(\n                                \"tools\", Collections.singletonList(\"notifyShippingManager\"))\n                        .build(),\n                reviewAnalysisReactPrompt(),\n                CustomTypesAndResources.ProductReviewAnalysisRes.class);\n    }\n</code></pre>\n<h5 id=\"ä¸Žæ¨¡åž‹äº¤äº’\">ä¸Žæ¨¡åž‹äº¤äº’</h5>\n<p>Chat Model Setup ä¸­å¼•ç”¨å·¥å…·</p>\n<p>åœ¨åˆ›å»º Chat Model Setup æ—¶ï¼Œé€šè¿‡ tools å‚æ•°æŒ‡å®šè¦ä½¿ç”¨çš„å·¥å…·åˆ—è¡¨ï¼š</p>\n<pre><code class=\"language-python\">chat_model_descriptor = ResourceDescriptor(\nclazz=OllamaChatModelSetup,\nconnection=\"my_ollama_connection\",\nmodel=\"qwen3:8b\",\ntools=[\"notify_shipping_manager\"]   # å¼•ç”¨å·²æ³¨å†Œçš„å·¥å…·\n)\n</code></pre>\n<h4 id=\"372-agentplan-ç¼–è¯‘è¿‡ç¨‹ä¸­å·¥å…·çš„å¤„ç†\">3.7.2 AgentPlan ç¼–è¯‘è¿‡ç¨‹ä¸­å·¥å…·çš„å¤„ç†</h4>\n<p>Flink Agents å†…ç½®äº†ä¸€ä¸ª TOOL_CALL_ACTIONï¼Œï¼Œä¸“é—¨ç”¨äºŽè°ƒç”¨å·¥å…·ã€‚TOOL_CALL_ACTION ä¸Žç”¨æˆ·å®šä¹‰å·¥å…·å‡½æ•°çš„è”ç³»ä¸»è¦ä¾èµ–äºŽï¼š</p>\n<ul>\n<li>ç»Ÿä¸€çš„å‘½åç³»ç»Ÿï¼šå·¥å…·å‡½æ•°çš„åç§°ä½œä¸ºå”¯ä¸€æ ‡è¯†ç¬¦</li>\n<li>èµ„æºç®¡ç†æœºåˆ¶ï¼šé€šè¿‡ RunnerContext.get_resource() æ–¹æ³•æŒ‰åç§°æ£€ç´¢å·¥å…·</li>\n<li>æ ‡å‡†åŒ–æŽ¥å£ï¼šæ‰€æœ‰å·¥å…·éƒ½å®žçŽ°ç›¸åŒçš„ call() æŽ¥å£</li>\n<li>äº‹ä»¶é©±åŠ¨æž¶æž„ï¼šé€šè¿‡ ToolRequestEvent å’Œ ToolResponseEvent ä¼ é€’è°ƒç”¨ä¿¡æ¯</li>\n</ul>\n<p>è¿™ç§è®¾è®¡ä½¿å¾—ç³»ç»Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å°† LLM çš„å·¥å…·è°ƒç”¨è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼Œè€Œæ— éœ€ç¡¬ç¼–ç å…·ä½“çš„å‡½æ•°å¼•ç”¨ã€‚</p>\n<p><img alt=\"3-1\" class=\"lazyload\" /></p>\n<h5 id=\"ç”¨æˆ·å®šä¹‰çš„-function-tool-è½¬æ¢ä¸º-action\">ç”¨æˆ·å®šä¹‰çš„ Function Tool è½¬æ¢ä¸º Action</h5>\n<p>å½“ Agent è¢«ç¼–è¯‘æˆ AgentPlan æ—¶ï¼Œç³»ç»Ÿä¼šæ”¶é›†æ‰€æœ‰èµ„æºï¼ˆåŒ…æ‹¬å·¥å…·ï¼‰ ï¼Œè¿™äº›å·¥å…·ä¼šè¢«è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„ Actionï¼š</p>\n<ul>\n<li>åœ¨ _get_resource_providers å‡½æ•°ä¸­ï¼Œè¯†åˆ«å¸¦æœ‰ _is_tool å±žæ€§çš„èµ„æº</li>\n<li>ä½¿ç”¨ from_callable å°†å‡½æ•°è½¬æ¢ä¸ºå·¥å…·å¯¹è±¡</li>\n<li>å·¥å…·è¢«åŒ…è£…ä¸º ResourceProvider å¹¶å­˜å‚¨åœ¨ AgentPlan ä¸­ï¼Œå³é€šè¿‡ PythonSerializableResourceProvider åŒ…è£…å·¥å…·èµ„æº</li>\n</ul>\n<h5 id=\"å†…ç½®-tool-call-action\">å†…ç½® Tool Call Action</h5>\n<p>æ¡†æž¶æä¾›äº†ä¸€ä¸ªå†…ç½®çš„ TOOL_CALL_ACTIONï¼Œä¸“é—¨ç”¨äºŽè°ƒç”¨å·¥å…·ï¼š</p>\n<pre><code class=\"language-python\">TOOL_CALL_ACTION = Action(\n    name=\"tool_call_action\",\n    exec=PythonFunction.from_callable(process_tool_request),\n    listen_event_types=[f\"{ToolRequestEvent.__module__}.{ToolRequestEvent.__name__}\"],\n)\n</code></pre>\n<p>å¯¹åº”Action ä¸ºToolCallActionï¼Œå…¶ä¸­ processToolRequest å‡½æ•°ä¼šä¸Žç”¨æˆ·è‡ªå®šä¹‰çš„å·¥å…·å‡½æ•°ç›¸äº’å…³è”ã€‚å…·ä½“è”ç³»æœºåˆ¶å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>å‘½ååŒ¹é…ï¼šå½“ LLM å†³å®šè°ƒç”¨æŸä¸ªå·¥å…·æ—¶ï¼Œå®ƒä¼šåœ¨ tool_call ä¸­æŒ‡å®šå·¥å…·åç§°ï¼ˆå¦‚ \"notify_shipping_manager\"ï¼‰</li>\n<li>èµ„æºæŸ¥æ‰¾ï¼šTOOL_CALL_ACTION ä½¿ç”¨è¿™ä¸ªåç§°é€šè¿‡ ctx.get_resource(name, ResourceType.TOOL) æŸ¥æ‰¾å·²æ³¨å†Œçš„å·¥å…·</li>\n<li>åŠ¨æ€è°ƒç”¨ï¼šæ‰¾åˆ°å·¥å…·åŽï¼Œé€šè¿‡ tool.call(**kwargs) è°ƒç”¨ç”¨æˆ·å®šä¹‰çš„å®žé™…å‡½æ•°</li>\n</ul>\n<pre><code class=\"language-java\">public class ToolCallAction {\n    public static Action getToolCallAction() throws Exception {\n        return new Action(\n                \"tool_call_action\",\n                new JavaFunction(\n                        ToolCallAction.class,\n                        \"processToolRequest\",\n                        new Class[] {ToolRequestEvent.class, RunnerContext.class}),\n                List.of(ToolRequestEvent.class.getName()));\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    public static void processToolRequest(ToolRequestEvent event, RunnerContext ctx) {\n        Map&lt;String, Boolean&gt; success = new HashMap&lt;&gt;();\n        Map&lt;String, String&gt; error = new HashMap&lt;&gt;();\n        Map&lt;String, ToolResponse&gt; responses = new HashMap&lt;&gt;();\n        Map&lt;String, String&gt; externalIds = new HashMap&lt;&gt;();\n        for (Map&lt;String, Object&gt; toolCall : event.getToolCalls()) {\n            String id = String.valueOf(toolCall.get(\"id\"));\n            Map&lt;String, Object&gt; function = (Map&lt;String, Object&gt;) toolCall.get(\"function\");\n            String name = (String) function.get(\"name\");// èŽ·å–å·¥å…·åç§°\n            Map&lt;String, Object&gt; arguments = (Map&lt;String, Object&gt;) function.get(\"arguments\"); // èŽ·å–å·¥å…·å‚æ•°\n\n            if (toolCall.containsKey(\"original_id\")) {\n                externalIds.put(id, (String) toolCall.get(\"original_id\"));\n            }\n\n            Tool tool = null;\n            try {\n                // ä»Žä¸Šä¸‹æ–‡èŽ·å–å¯¹åº”åç§°çš„å·¥å…·èµ„æº\n                tool = (Tool) ctx.getResource(name, ResourceType.TOOL);\n            } catch (Exception e) {\n                success.put(id, false);\n                responses.put(\n                        id, ToolResponse.error(String.format(\"Tool %s does not exist.\", name)));\n                error.put(id, e.getMessage());\n            }\n\n            if (tool != null) {\n                try {\n                    // è°ƒç”¨ç”¨æˆ·å®žé™…å·¥å…·\n                    ToolResponse response = tool.call(new ToolParameters(arguments));\n                    success.put(id, true);\n                    responses.put(id, response);\n                } catch (Exception e) {\n                    success.put(id, false);\n                    responses.put(\n                            id, ToolResponse.error(String.format(\"Tool %s execute failed.\", name)));\n                    error.put(id, e.getMessage());\n                }\n            }\n        }\n        // è¿”å›žå·¥å…·å“åº”äº‹ä»¶\n        ctx.sendEvent(new ToolResponseEvent(event.getId(), responses, success, error, externalIds));\n    }\n}\n</code></pre>\n<p>è¿™ä¸ª action ç›‘å¬ ToolRequestEvent äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œå·¥å…·è°ƒç”¨ã€‚è°ƒç”¨å®ŒæˆåŽï¼Œå°†ç»“æžœé€šè¿‡ ToolReponseEvent è¿”å›žã€‚</p>\n<pre><code class=\"language-json\">    \"tool_call_action\": {\n      \"name\": \"tool_call_action\",\n      \"exec\": {\n        \"func_type\": \"PythonFunction\",\n        \"module\": \"flink_agents.plan.actions.tool_call_action\",\n        \"qualname\": \"process_tool_request\"\n      },\n      \"listen_event_types\": [\n        \"flink_agents.api.events.tool_event.ToolRequestEvent\"\n      ]\n    }\n</code></pre>\n<h5 id=\"tool_call_action-å¦‚ä½•ç¼–è¯‘åˆ°agentplan\">TOOL_CALL_ACTION å¦‚ä½•ç¼–è¯‘åˆ°AgentPlan</h5>\n<ul>\n<li>\n<p>åœ¨ AgentPlan.from_agent æ–¹æ³•ä¸­ï¼š</p>\n<ul>\n<li>å½“åˆ›å»º AgentPlan æ—¶ï¼Œä¼šæ”¶é›†æ‰€æœ‰åŠ¨ä½œï¼ŒåŒ…æ‹¬ç”¨æˆ·å®šä¹‰çš„åŠ¨ä½œå’Œå†…ç½®åŠ¨ä½œ</li>\n<li>ä»£ç ä¸­æ˜Žç¡®åŒ…å«äº†å†…ç½®åŠ¨ä½œï¼š<br />\nBUILT_IN_ACTIONS = [CHAT_MODEL_ACTION, TOOL_CALL_ACTION, CONTEXT_RETRIEVAL_ACTION]</li>\n<li>åœ¨ _get_actions(agent) å‡½æ•°ä¸­ï¼Œè¿™äº›å†…ç½®åŠ¨ä½œä¼šè¢«æ·»åŠ åˆ°åŠ¨ä½œåˆ—è¡¨ä¸­</li>\n</ul>\n</li>\n<li>\n<p>å…·ä½“ç¼–è¯‘è¿‡ç¨‹ï¼š</p>\n<ul>\n<li>AgentPlan.from_agent() æ–¹æ³•è°ƒç”¨ _get_actions(agent) èŽ·å–æ‰€æœ‰åŠ¨ä½œ</li>\n<li>_get_actions() å‡½æ•°ä¸ä»…æå–ç”¨æˆ·å®šä¹‰çš„åŠ¨ä½œï¼Œè¿˜ä¼šåŒ…å« BUILT_IN_ACTIONS</li>\n<li>è¿™äº›åŠ¨ä½œéšåŽè¢«ç¼–è¯‘è¿› AgentPlan çš„ actions å’Œ actions_by_event å­—æ®µä¸­</li>\n</ul>\n</li>\n<li>\n<p>åœ¨æœ€ç»ˆçš„ AgentPlan ä¸­ï¼š</p>\n<ul>\n<li>TOOL_CALL_ACTION ä¼šä½œä¸ºä¸€ä¸ªæ™®é€šçš„åŠ¨ä½œå­˜åœ¨äºŽ actions æ˜ å°„ä¸­</li>\n<li>å®ƒä¼šç›‘å¬ ToolRequestEvent äº‹ä»¶ç±»åž‹ï¼Œå¹¶åœ¨è¯¥äº‹ä»¶å‘ç”Ÿæ—¶è¢«è§¦å‘æ‰§è¡Œ</li>\n</ul>\n</li>\n</ul>\n<p>å› æ­¤ï¼ŒTOOL_CALL_ACTION ç¡®å®žä¼šè¢«ç¼–è¯‘åˆ° AgentPlan ä¸­ï¼Œä½œä¸ºå¤„ç†å·¥å…·è°ƒç”¨çš„æ ‡å‡†æœºåˆ¶ã€‚å½“ LLM å†³å®šè°ƒç”¨å·¥å…·æ—¶ï¼Œä¼šå‘å‡º ToolRequestEventï¼Œç„¶åŽ TOOL_CALL_ACTION å°±ä¼šè¢«è§¦å‘æ¥å®žé™…æ‰§è¡Œç›¸åº”çš„å·¥å…·è°ƒç”¨ã€‚</p>\n<h4 id=\"373-å·¥å…·è°ƒç”¨æµç¨‹\">3.7.3 å·¥å…·è°ƒç”¨æµç¨‹</h4>\n<p>æ•´ä¸ªæµç¨‹ä¸­ï¼Œå·¥å…·ä¸æ˜¯ç›´æŽ¥ç»‘å®šåˆ° ActionExecutionOperatorï¼Œè€Œæ˜¯é€šè¿‡ AgentPlan ä¸­çš„èµ„æºæä¾›è€…æœºåˆ¶ï¼Œåœ¨éœ€è¦æ—¶åŠ¨æ€èŽ·å–å’Œå®žä¾‹åŒ–ã€‚è¿™ç§è®¾è®¡å®žçŽ°äº†å·¥å…·ä¸Žæ“ä½œç¬¦çš„æ¾è€¦åˆï¼ŒåŒæ—¶æ”¯æŒå¤šç§ç±»åž‹çš„å·¥å…·ï¼ˆJavaã€Python ç­‰ï¼‰ã€‚</p>\n<ul>\n<li>LLM å†³å®šè°ƒç”¨æŸä¸ªå·¥å…·</li>\n<li>TOOL_CALL_ACTION å†…ç½®åŠ¨ä½œè¢«è§¦å‘</li>\n<li>é€šè¿‡ RunnerContext èŽ·å–å¯¹åº”å·¥å…·èµ„æº</li>\n<li>RunnerContextImpl.get_resource() æ–¹æ³•æ ¹æ®åç§°å’Œç±»åž‹æŸ¥æ‰¾å·¥å…·èµ„æº</li>\n<li>å·¥å…·å®žé™…åœ¨éœ€è¦æ—¶æ‰é€šè¿‡ ResourceProvider å®žä¾‹åŒ–</li>\n<li>é€šè¿‡ ToolCallFunction æŸ¥æ‰¾å¹¶æ‰§è¡Œç›¸åº”çš„å·¥å…·å‡½æ•°</li>\n<li>ç»“æžœä½œä¸ºæ–°äº‹ä»¶å‘é€åˆ°äº‹ä»¶é˜Ÿåˆ—</li>\n</ul>\n<h4 id=\"374-å®Œæ•´æµç¨‹å›¾\">3.7.4 å®Œæ•´æµç¨‹å›¾</h4>\n<p><img alt=\"3-2\" class=\"lazyload\" /></p>\n<h4 id=\"375-ä»£ç \">3.7.5 ä»£ç </h4>\n<p>åœ¨ agent_plan.pyä¸­å¤„ç†å·¥å…·èµ„æºçš„ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\">        # è¯†åˆ«å·¥å…·èµ„æºå¹¶åˆ›å»ºæä¾›è€…\n        elif hasattr(value, \"_is_tool\"):\n            if isinstance(value, staticmethod):\n                value = value.__func__\n\n            if callable(value):\n                # TODO: support other tool type.\n                tool = from_callable(func=value)\n                resource_providers.append(\n                    PythonSerializableResourceProvider.from_resource(\n                        name=name, resource=tool\n                    )\n                )\n    # æˆ–è€…é€šè¿‡add_resource æ·»åŠ çš„å·¥å…·            \n    for name, tool in agent.resources[ResourceType.TOOL].items():\n        resource_providers.append(\n            PythonSerializableResourceProvider.from_resource(\n                name=name, resource=from_callable(tool.func)\n            )\n        )                \n</code></pre>\n<p>æ€»ç»“æ¥è¯´ï¼Œfunction_tool  é€šè¿‡èµ„æºæ³¨å†Œæœºåˆ¶ä¸ŽAgentå…³è”ï¼Œç„¶åŽåœ¨ç¼–è¯‘é˜¶æ®µè¢«è½¬æ¢ä¸ºå¯åºåˆ—åŒ–çš„èµ„æºæä¾›è€…ï¼Œæœ€ç»ˆé€šè¿‡å†…ç½®çš„å·¥å…·è°ƒç”¨Actionæ¥æ‰§è¡Œã€‚è¿™ç§è®¾è®¡ä½¿å¾—å·¥å…·å¯ä»¥åœ¨åˆ†å¸ƒå¼çŽ¯å¢ƒç§æ­£ç¡®ä¼ è¾“å’Œæ‰§è¡Œã€‚</p>\n<h2 id=\"0xff-å‚è€ƒ\">0xFF å‚è€ƒ</h2>\n<p><a href=\"https://ce101.mintlify.app/core-tech/agent#7-2-5-multi-agent\" rel=\"noopener nofollow\" target=\"_blank\">https://ce101.mintlify.app/core-tech/agent#7-2-5-multi-agent</a></p>\n<p><a href=\"https://www.zhihu.com/question/1959742114519844109/answer/1983526566437880277\" rel=\"noopener nofollow\" target=\"_blank\">https://www.zhihu.com/question/1959742114519844109/answer/1983526566437880277</a></p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 19:17</span>&nbsp;\n<a href=\"https://www.cnblogs.com/rossiXYZ\">ç½—è¥¿çš„æ€è€ƒ</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">65</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "[微服务进阶场景实战] - 数据一致性",
      "link": "https://www.cnblogs.com/yhup/p/19427692",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/yhup/p/19427692\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 17:21\">\n    <span>[微服务进阶场景实战] - 数据一致性</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        <img alt=\"[微服务进阶场景实战] - 数据一致性\" class=\"desc_img\" src=\"https://img2024.cnblogs.com/blog/2428649/202512/2428649-20251231172110600-959933332.png\" />\n        本文探讨了微服务架构中的数据一致性问题及解决方案。针对最终一致性场景，提出基于消息队列的异步补偿方案，通过消息持久化和重试机制确保数据最终一致；对于强一致性需求，对比分析了TCC模式与Seata AT模式，重点推荐Seata AT方案，其通过自动生成回滚日志实现低侵入式分布式事务管理。实践表明，这两种方案能有效解决数据不一致问题，且不会显著增加开发负担，为微服务架构提供了可靠的数据一致性保障。\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>前面我们梳理了微服务的九大痛点，其中一部分目前尚无完美解决方案，另一部分则已有可行对策。从本章起，我们将逐一探讨那些“有解”的痛点。首当其冲的，就是数据一致性问题——让我们从一个实际业务场景切入。</p>\n<h1 id=\"1-业务场景下游服务失败后上游服务如何独善其身\">1 业务场景：下游服务失败后上游服务如何独善其身</h1>\n<p>在微服务架构中，一个业务请求常常需要跨多个服务更新多个数据库，示意图如下：</p>\n<p><img alt=\"在这里插入图片描述\" src=\"https://img2024.cnblogs.com/blog/2428649/202512/2428649-20251231172011750-1090431586.png\" /></p>\n<p>理想情况下，业务顺利完成时，三个服务的数据应依次更新为 a2、b2、c2，此时数据处于一致状态。然而，现实往往充满意外：网络抖动、服务过载、数据库响应缓慢等都可能导致调用链中途失败。例如，若在步骤 2 失败，数据会停留在 a2、b1、c1；若在步骤 3 失败，则变成 a2、b2、c1——数据不一致就这样产生了。</p>\n<p>在本项目启动前，由于早期改造工期紧张，开发团队无暇顾及数据一致性问题，导致线上陆续出现错误数据。业务部门通过工单反馈后，IT 团队排查发现，根源正是分布式更新过程中的不一致。</p>\n<p>事已至此，团队不得不专门腾出精力，为数据一致性问题设计可靠方案。经过讨论，他们将问题归纳为两类：</p>\n<p><strong>第一类：可接受短期不一致，但必须保证最终一致性</strong><br />\n以零售下单为例（简化版）：订单需依次在商品服务扣库存、订单服务生成订单、交易服务生成交易单。假设生成交易单失败，就会出现库存已扣、订单已生、但交易单缺失的状态。此时只要系统能最终补全交易单，业务即可接受——这就是最终一致性。</p>\n<p><strong>第二类：必须保证实时一致性</strong><br />\n以积分兑换折扣券为例：需要先扣积分，再发折扣券。若采用最终一致性，用户可能看到积分已扣但券未到账，进而立刻投诉。此时更好的做法是：一旦后续步骤失败，立即回滚前面所有操作，并提示用户“操作失败，请重试”。这就是实时一致性。</p>\n<p>那么，针对这两类情况，具体如何实现呢？下面我们分别展开。</p>\n<h1 id=\"2-最终一致性方案\">2 最终一致性方案</h1>\n<p>对对于接受最终一致性的场景，核心思路是借助消息队列（MQ）实现跨服务的数据更新“接力”。具体流程如下：</p>\n<ol>\n<li>每个服务完成本地操作后，向 MQ 发送一条消息，触发下一个服务的处理。</li>\n<li>下游服务消费消息，完成自身操作后，继续发送消息给更下游的服务。</li>\n<li>若消费失败，消息应保留在 MQ 中，等待后续重试。</li>\n</ol>\n<p>整个调用流程如图所示：<br />\n<img alt=\"在这里插入图片描述\" src=\"https://img2024.cnblogs.com/blog/2428649/202512/2428649-20251231172011700-764051171.png\" /></p>\n<p><strong>详细步骤与异常处理如下：</strong></p>\n<table>\n<thead>\n<tr>\n<th>步骤</th>\n<th>执行内容</th>\n<th>失败应对策略</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>调用端调用 Service A</td>\n<td>直接返回失败，用户数据无影响</td>\n</tr>\n<tr>\n<td>2</td>\n<td>Service A 将 a1 改为 a2</td>\n<td>本地事务回滚，数据恢复</td>\n</tr>\n<tr>\n<td>3</td>\n<td>Service A 向 MQ 发送 Step2 消息</td>\n<td>发送失败则触发本地回滚</td>\n</tr>\n<tr>\n<td>4</td>\n<td>Service A 返回成功响应给调用端</td>\n<td>无需额外处理</td>\n</tr>\n<tr>\n<td>5</td>\n<td>Service B 消费 Step2 消息</td>\n<td>MQ 自带重试机制，无需担心</td>\n</tr>\n<tr>\n<td>6</td>\n<td>Service B 将 b1 改为 b2</td>\n<td>本地事务回滚，消息重新投递(重新回到步骤5)</td>\n</tr>\n<tr>\n<td>7</td>\n<td>Service B 向 MQ 发送 Step3 消息</td>\n<td>依赖 MQ 生产端重试机制</td>\n</tr>\n<tr>\n<td>8</td>\n<td>Service B 确认消费 Step2</td>\n<td>若失败，MQ 会重新投递给其他消费者(重新回到步骤5)</td>\n</tr>\n<tr>\n<td>9</td>\n<td>Service C 消费 Step3 消息</td>\n<td>同步骤 5</td>\n</tr>\n<tr>\n<td>10</td>\n<td>Service C 将 c1 改为 c2</td>\n<td>同步骤 6</td>\n</tr>\n<tr>\n<td>11</td>\n<td>Service C 确认消费 Step3</td>\n<td>同步骤 8</td>\n</tr>\n</tbody>\n</table>\n<p>该方案本质上是利用 MQ 的消息持久化、重试和确认机制，将分布式更新拆解为多个本地事务，通过异步消息串联起来。但还需要注意两个常见问题：</p>\n<p><strong>1. 幂等性必须保证</strong><br />\n由于 MQ 的重试机制，步骤 6 和步骤 10 可能被重复执行。因此，下游服务在更新数据时，必须实现<strong>业务幂等</strong>——即同一消息多次消费，结果应与一次消费相同。</p>\n<p><strong>2. 代码复用与封装</strong><br />\n如果每个业务流程都手动实现上述逻辑，开发量会很大。实际上，MQ 相关的发送、消费、确认逻辑可以抽象为公共组件。本项目最终将这些重复代码封装成通用模块，供各业务服务调用。具体封装方法较为直接，此处不再展开。</p>\n<h1 id=\"3-实时一致性方案\">3 实时一致性方案</h1>\n<p>实时一致性其实就是常说的分布式事务。</p>\n<p>MySQL其实有一个两阶段提交的分布式事务方案MySQL XA，但是该方案存在严重的性能问题。比如，一个数据库的事务与多个数据库间的XA事务性能可能相差10倍。</p>\n<p>另外，XA的事务处理过程会长期占用锁资源，所以项目组一开始就没有考虑这个方案。而当时比较流行的方案是使用TCC模式，下面简单介绍一下。</p>\n<h1 id=\"4-tcc模式一分为三的补偿型事务\">4 TCC模式：一分为三的补偿型事务</h1>\n<p>TCC（Try-Confirm-Cancel）是一种补偿型事务方案。它将一个完整的业务接口逻辑拆解为三个独立的操作阶段：</p>\n<ol>\n<li><strong>Try</strong>：尝试执行。负责完成所有业务检查，并<strong>预留</strong>必要的资源（例如冻结积分、锁定库存）。</li>\n<li><strong>Confirm</strong>：确认执行。真正执行业务操作，使用Try阶段预留的资源，通常<strong>保证成功</strong>。</li>\n<li><strong>Cancel</strong>：取消执行。用于<strong>释放</strong>Try阶段预留的资源，进行业务回滚。</li>\n</ol>\n<p>以“积分兑换折扣券”为例，涉及“账户服务扣积分”和“营销服务发折扣券”两个操作。那么，仅“扣积分”这一个接口，就需要拆分为以下三个方法：</p>\n<pre><code class=\"language-java\">public boolean prepareMinus (BusinessActionContext businessActionContext,\n                             final String accountNo,\n                             final double amount){\n    //[校验] 账户积分余额\n    //[冻结] 积分金额\n}\npublic boolean Confirm(BusinessActionContext businessActionContext){\n    //[扣除] 账户积分余额\n    //[释放] 账户，冻结积分金额\n}\npublic boolean Cancel(BusinessActionContext businessActionContext){\n    //[回滚] 所有数据变更\n}\n</code></pre>\n<p>理，“发折扣券”接口也需要编写对应的三个方法。其成功调用的流程示意如图所示。<br />\n<img alt=\"在这里插入图片描述\" src=\"https://img2024.cnblogs.com/blog/2428649/202512/2428649-20251231172011621-1381075228.png\" /></p>\n<p>该流程中，除Cancel路径外，代表成功调用链。一旦任何环节出错，事务管理器将协调调用所有已执行服务的Cancel方法进行回滚。</p>\n<p>TCC模式将一段业务逻辑拆成三部分，实施复杂度显著增加，并需谨慎处理以下问题：</p>\n<ol>\n<li><strong>空提交</strong>：需保证Try成功，Confirm必定成功。</li>\n<li><strong>空回滚</strong>：需处理Try未执行却收到Cancel调用的情况，实现正确回滚。</li>\n<li><strong>防悬挂</strong>：需防止因网络拥堵，Cancel先于Try到达导致资源被永久锁定。</li>\n<li><strong>幂等性</strong>：所有Try、Confirm、Cancel操作都必须支持重复调用。</li>\n<li><strong>数据隔离</strong>：事务期间数据处于中间状态（如“冻结”），需设计得当，避免对其他业务逻辑造成干扰。</li>\n</ol>\n<p>可见，TCC模式实现<strong>相当繁琐</strong>，不仅业务代码量激增，还需精心处理上述各类边缘情况，开发和维护成本高，易出错。幸运的是，存在更优的替代方案，例如Seata框架提供的<strong>AT模式</strong>。</p>\n<h1 id=\"5-seata-at模式基于sql反向补偿的自动回滚\">5 Seata AT模式：基于SQL反向补偿的自动回滚</h1>\n<p>AT（Automatic Transaction）模式，即自动（分支）事务模式。其最大优点是<strong>对业务侵入极低</strong>。</p>\n<p>开发者只需做两件事：</p>\n<ul>\n<li>在全局事务的<strong>发起方</strong>方法上添加 <code>@GlobalTransactional</code> 注解。</li>\n<li>在各个参与服务的本地方法上，继续使用普通的 <code>@Transactional</code> 注解。</li>\n</ul>\n<p>Seata官网对这块介绍的非常详细，有兴趣的朋友可以看一下：<a href=\"https://seata.apache.org/zh-cn/docs/dev/mode/at-mode\" rel=\"noopener nofollow\" target=\"_blank\">Apache Seata</a>。在这里简要概括一下，其核心机制在于，Seata会<strong>自动拦截并解析</strong>业务SQL，通过生成并管理反向回滚日志，实现分布式事务的自动协调。整个过程可简要概括为三个阶段：</p>\n<p><strong>第一阶段：执行与日志记录</strong></p>\n<ol>\n<li><strong>解析SQL</strong>：拦截业务SQL，解析其操作类型、表、条件等。</li>\n<li><strong>保存前置镜像</strong>：根据解析条件查询数据，保存更新前的状态（Before Image）。</li>\n<li><strong>执行业务SQL</strong>：执行用户定义的更新操作。</li>\n<li><strong>保存后置镜像</strong>：查询更新后的数据状态（After Image）。</li>\n<li><strong>插入回滚日志</strong>：将前后镜像数据及SQL信息组成回滚日志，存入 <code>UNDO_LOG</code> 表。</li>\n<li><strong>注册与锁</strong>：向事务协调器（TC）注册分支事务，并获取相关数据的<strong>全局锁</strong>。</li>\n<li><strong>本地提交</strong>：提交业务数据更新和 <code>UNDO_LOG</code>。</li>\n<li><strong>上报结果</strong>：将本地事务提交结果<strong>上报</strong>给TC。</li>\n</ol>\n<p><strong>第二阶段：回滚（如需要）</strong><br />\n若收到TC发出的回滚指令，则：</p>\n<ol>\n<li>开启本地事务，查找对应的 <code>UNDO_LOG</code> 记录。</li>\n<li><strong>数据校验</strong>：对比 <code>UNDO_LOG</code> 中的后镜像与当前数据。若不一致（说明数据被其他事务修改），需根据策略处理。</li>\n<li><strong>生成并执行回滚SQL</strong>：根据前镜像数据，生成反向SQL执行，恢复数据。</li>\n<li><strong>提交并上报</strong>：提交本地事务，删除 <code>UNDO_LOG</code>，并向TC上报回滚结果。</li>\n</ol>\n<p><strong>第三阶段：异步清理</strong><br />\n收到TC的提交指令后，异步、批量地删除对应的 <code>UNDO_LOG</code> 记录，完成资源清理。</p>\n<h3 id=\"6-为何选择seata一个务实的工程决策\">6 为何选择Seata：一个务实的工程决策</h3>\n<p>当时，Seata虽未发布正式版，但我们项目组仍决定采用，主要基于两点现实考量：</p>\n<ol>\n<li><strong>场景可控</strong>：需要强实时一致性的业务场景<strong>占比少、频率低</strong>，影响范围有限。对于高频、高并发的场景，我们会优先与业务方沟通，采用<strong>最终一致性</strong>方案，从而规避性能风险。</li>\n<li><strong>投入产出比高</strong>：相较于TCC模式需要将每个业务逻辑“一拆三”并处理各种异常，AT模式<strong>仅需增加一个</strong><code>@GlobalTransactional</code><strong>注解</strong>，开发工作量天差地别。这种显著的效率提升，使得尝试新技术带来的风险变得可以接受。这或许也是Seata能迅速流行的原因之一。</li>\n</ol>\n<p>尽管AT模式存在一些小缺陷（如全局锁对性能的细微影响），但<strong>瑕不掩瑜</strong>，其易用性优势在大多数场景下非常突出。</p>\n<h3 id=\"7-小结缓解痛点轻装前行\">7 小结：缓解痛点，轻装前行</h3>\n<p>通过为“最终一致性”和“实时一致性”场景分别设计并落地了基于MQ的异步补偿方案与基于Seata AT模式的自动补偿方案，我们成功解决了数据不一致的核心痛点。<br />\n<strong>关键成果在于</strong>：这些方案<strong>并未给业务开发带来显著负担</strong>，也未影响项目正常推进，却极大降低了数据错误的发生概率。</p>\n<p>至此，数据一致性的痛点已得到有效缓解。接下来，我们将面对微服务架构中的另一个常见难题：<strong>服务间数据依赖复杂，导致需要编写大量冗余数据获取与组装逻辑</strong>。这个问题又该如何破解？</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 17:21</span>&nbsp;\n<a href=\"https://www.cnblogs.com/yhup\">yihuiComeOn</a>&nbsp;\n阅读(<span id=\"post_view_count\">82</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "2025 年终总结｜30岁",
      "link": "https://www.cnblogs.com/liyq666/p/19427476",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/liyq666/p/19427476\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 16:47\">\n    <span>2025 年终总结｜30岁</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        今天是2025最后一天，回顾这一年，感到的只有对未来的迷茫，我是一名前端开发，在AI的冲击以及大环境的影响下，离开了上一家公司，Gap到现在，写下这篇年终总结，算是对自己的2025年有个交代吧\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"前言\">前言</h1>\n<p>今天是2025最后一天，回顾这一年，感到的只有对未来的迷茫，我是一名前端开发，在25年之前可以说是一名很纯粹的前端，在AI的冲击以及大环境的影响下，离开了上一家公司，然后就是Gap到现在，坐在上海出租屋的电脑前，写下这篇年终总结，算是对自己的2025年有个交代吧。</p>\n<h2 id=\"回顾来时路\">回顾来时路</h2>\n<p>我出生于河南的一个农村家庭，大学学的计算机，18年毕业入行前端，在郑州拿到了第一份工作3.5K，待了大概10个月，算是起点吧，在这里接触并学习了React，很感激第一家公司，确实为我之后的工作打下了基础；</p>\n<p>第二份工作6k好像，待了8个月，然后倒闭了，无奈换到了郑州的第三家公司，在这个公司待了1年2个月，薪资是9k不到，正准备一展宏图，然后公司又倒闭了，还拖欠了差不多4个月💰，欠了我3w多的薪资，至今未拿到手。随着钱包逐渐干瘪，我知道不能在公司继续耗下去，于是拿了离职证明破釜沉舟直接来了大都市上海打拼。</p>\n<p>在郑州待了差不多三年，主要技术栈是React + Vue，做的都是C端的一些产品，做过App，wx小程序，wx公众号，web网页等，申请过软著，上架过应用商店，上架过小程序，对接过商城的支付，一路摸着石头过河，好在走过来了。</p>\n<p>20年来了上海，入职了上一家公司，薪资是14K，有奖金包，这边企业主要是做B端的产品，基本相当于从0开始了。</p>\n<p>入职后，感叹大城市的繁华，我在10号线航中路附近租了一个“蛋壳公寓🏠”房子，说是押一付一，实际是微众银行的贷款，然后20年“蛋壳”暴雷😂，当时的我面临🏠住不了，押金💰退不了，还要背上一年贷款，经历过那段的人应该知道，当时网络上各种，有的🔥房子，有的跳楼，有的拿🔪威胁不搬走。直到那时候我才发现，刚到上海就踩了一个“坑”，多亏了各路英雄的的群策群力，以及网络舆论的影响，还有政府的居中协调，最终我的结果就是贷款不用还了，但押金，只能吃哑巴亏咽了。</p>\n<p>从20年入职直到25年初，共4年7个多月，之前郑州三年我基本是不与客户直接打交道的，来到上海这边，做B端企业产品，就得跟客户打交道，在这期间，真的很感谢🙏我的领导，从最初的青涩到逐渐自然，我确实成长了很多，下面举一些面对客户的例子：</p>\n<ol>\n<li>首先态度要有，（面对反馈要及时响应）实际做是后面的事；</li>\n<li>需求变更问题，（不要怕争吵）态度也是要有，不要啥都接受；</li>\n</ol>\n<p>多的就不再多言。这份工作主要是企业定制化开发，修修补补是常态，也有从0-1的项目，算是进一步沉淀了技术吧。时间来到24年，有一个项目需要出差，出差山东，刚开始说是3个月，没想到一直出差了一整年，直到离职，项目也还没结束。</p>\n<h2 id=\"被裁\">被裁</h2>\n<p>3月份，还在山东出差加班的我，收到了公司HR的消息，沟通组织架构调整事宜，我只能选择接受，于是3月底，离开出差一年的潍坊，回到了上海，拿了离职证明，离开了我工作近5年的公司，由于之前一年都是做的修修补补，对于吃饭的技能感觉有点生疏，于是我选择沉淀一段时间，正好也休息一下长期加班疲惫的身体。</p>\n<h2 id=\"找工作\">找工作</h2>\n<p>4-5月眨眼过去，从6月份，我开始逐渐的整简历，投简历，邀面试，这时才发现，市场好像变化了，不再问大量的“八股文”，而是转而问场景题，从项目整体思维出发面试。</p>\n<p>记得当时有一位面试官问我，工作7年，你最拿得出手的项目是什么，有从0-1搭建过项目吗？我挑了最近几年的项目中一个做了回答，因为还是B端的企业内部系统，技术上没有C端那些更亮眼的技术，也没有所谓的高并发什么的，最后当然挂了。</p>\n<p>之前都是用Umi，Dva、react-create-app、Vue-cli、Antd、Element Ui等现成的脚手架及库搭建项目，B端项目讲究敏捷开发，重业务，轻页面，说句不好听的就是“能用就行、好用就行”，于是结束面试后我开始萌生一个想法，从0-1去搭建一个项目。</p>\n<p>6月份Boss上沟通了几百个，投了几十简历，面试了几个，比例几乎是10:1:1，结果很扎心，于是我一边投简历，一边写代码，不能让自己闲下来，不然容易乱想，就这样靠着这份信念，我从0-1搭建了一个项目，完善了搭建的历程<br />\n<a href=\"https://juejin.cn/post/7519864446069489704\" rel=\"noopener nofollow\" target=\"_blank\"># 从零搭建 react 模板 【React 18 + Webpack 5 + Antd 5 + React-Router 6 】</a>，</p>\n<p>7-8月份我拿着这份从0-1搭建的项目去面试，比之6月份好像好了点，但又好的有限，期间又完善了权限控制<br />\n<a href=\"https://juejin.cn/post/7525733315133341706\" rel=\"noopener nofollow\" target=\"_blank\"># React 18 全局错误捕获 + React-router 6 动态权限路由</a>，又遇到一个面试官，点评我的项目，纯静态的，没错，就是纯静态页面，模拟数据做的，最后还是挂了。于是我想着是不是可以加上后端，正好之前也接触过NodeJs，于是又是框框学，最后选了Express，打算做一个全栈管理系统，因为我对这种系统很熟悉，包括布局、页面、业务都熟悉。</p>\n<p>来到金九银十了，继续更新简历，继续投，发现岗位确实多了一些，面试也确实多了一些，但还是没有结果，我开始思考哪里的原因，可能是大专毕业，学历低，外加Gap5个多月了，也有可能是我要求高了点，因为上一家5年前入职时14k，离职也是14k，算上奖金💰一年大概有20w，新工作想找个20k以上的，因为即将临近30，后面更难，程序员30岁，35岁都是一个坎，随着一直找不到💼，开始有点否定自己，我发觉不能这样下去了，于是就继续搭建后端Node系统，好不让自己闲下来。</p>\n<p>十一回老家，装作没事人一样，在家陪了父母七八天，家里人都不知道我失业了，父母都是60多的年纪，老爸是做建筑工的，60多还爬高上低，老妈身体不好，在家串那个几厘💰一串的手串，不让她干还不愿意，说是给我攒老婆本，我三番五次拿不结婚不找对象来威胁她好让她放弃一坐低头几个小时的手工劳作，她总是美其名曰，这是我的一份“工作”。我又怎么忍心告诉他们，我失业了呢，难道让他们跟着我一起着急，一起焦虑吗，我做不到，我想大多数人都跟我一样做不到，本来就是在外地工作的“游子”，报喜不报忧已是最基本的了，于是假期结束我毅然返回上海，像“没事人”一样。</p>\n<p>10月底，我终于做出了第一版开源<a href=\"https://wladmin.cn\" rel=\"noopener nofollow\" target=\"_blank\">全栈管理系统</a>，包含前端后端，登录，权限控制，发布在了<a href=\"https://gitee.com/lyqjob/project-root\" rel=\"noopener nofollow\" target=\"_blank\">Gitee仓库</a>，这个系统参考了好几个开源管理系统，借鉴他们的页面，参考他们的实现架构，既然做出来了这个系统，就要有个名字。</p>\n<p>我给他起名叫<a href=\"https://www.wladmin.cn\" rel=\"noopener nofollow\" target=\"_blank\">WlAdmin</a>，译名“未来”不是碰瓷“蔚来”,是我对其抱有期待，期待我的“未来”，这是一个全栈管理系统，采用React + Antd + NodeJs + MySQL + Redis构建。</p>\n<p>11月，这个月应该是我最累的的一个月，随着系统初版的上线，要真正达到开源可用的企业级管理系统的功能，还有很长一段路要走，在10月底我接触到了<strong>AI编程</strong>，说实话真的很强大，赶上了字节的“Trae CN末班车”，当时还能免费用Claude Code，我想要更快的完善这个系统，于是开始在AI的帮助下，慢慢完善系统，没想到刚好用几天，突然AI变得很“笨”，网上一查才知道，国外禁止Claude Code在国内使用了，于是又下载了Cursor，免费14天，于是开始框框改造，借助AI和网上的一些架构知识，管理系统逐渐完善，作为一个前端，去学习了解后端，才发现从整体架构一个系统，真的挺不容易的，最开始我引以为豪的就是逻辑思维，知道真正从0-1搭建起来<a href=\"https://juejin.cn/post/7573912365910442026\" rel=\"noopener nofollow\" target=\"_blank\">全栈管理系统：Node.js + Express + MySQL + React + Antd</a>，才发现后端真🐮🍺。</p>\n<p>随着投简历，这个项目也算推广出去了，是有一定的人访问的，为了不影响第二天的“面试官”访问，所以线上网站不能出大的问题，本地开发好好的，部署到服务器上就是各种出问题，于是经常性的搞到一两点，搞得心力交瘁。在群里推广时有人问我“<strong>你做这个项目盈利吗，有价值吗？当今AI盛行，还用Express这种老掉牙的东西</strong>”，我竟无法反驳。11月简历投的都较其他月少了很多，当然依然是没有结果，当时一度想放弃，最后才发现，投入几个月的时间精力静下来做一个系统，一坐一整天那种，投入这么大的成本，就这么放弃有点可惜。</p>\n<p>12月，随着Gap9个月的⏰继续往前走，11月简历也都石沉大海，虽然有的进了“二面”，但依然没有结果，这个时候说不焦虑是假的，每个月上海的租金是1800，算上吃喝一个月的成本💰大概3000，也确实有点扛不动了。</p>\n<p>继续完善系统，加上了Docker部署，Docker用起来才发现真的很香，本地构建，服务器部署，当时是用了两个docker-compose.yml，一个用来启动MySQL和Redis，一个用来启动后端服务（这导致经常性一重启就无法连接数据库，之前搞到凌晨的罪魁祸首绝对有它，前几天改为了只有一个docker-compose.yml）。当时掘金网站里有很多推Monorepo架构的文章，仔细阅读发现这个确实是好东西，于是12月初就全面重构了整个系统，改为Monorepo + Turbo架构的全栈管理系统，启动、构建确实比之前快了很多，项目体积我确实没仔细看，因为这时只有两个应用，前端React，以及后端Node，后面我又采用<strong>React Native + Expo + TypeScript</strong> 构建扩展了<a href=\"https://expo.dev/accounts/liyq/projects/app-rn-ts/builds/baa8d23c-208e-4af9-8bff-6123d872cf63\" rel=\"noopener nofollow\" target=\"_blank\">App</a>以及使用<strong>Next.js + Tailwind + TypeScript</strong>构建了支持SSR以及SEO优化的<a href=\"https://www.wladmin.cn\" rel=\"noopener nofollow\" target=\"_blank\">WlAdmin｜Doc</a>，进一步扩展了知识面，而不只是停留在简历上的熟悉***，现在可惜12月份简历全都石沉大海</p>\n<h2 id=\"30岁\">30岁</h2>\n<p>上周迎来了30岁生日🎂，都说“<strong>三十而立</strong>”，可我没车没房没对象，新时代的“三无”人员😑。20年刚到上海时，Boss上都是消息，虽然大多都是“<strong>外包</strong>”，现如今，简历不是已读不回，就是没有下文，大环境愈发低迷，虽然花费几个月做出来了这个<a href=\"https://wladmin.cn/\" rel=\"noopener nofollow\" target=\"_blank\">企业级全栈管理系统</a>，但好像正如之前群里说的，“没什么太大的价值”，也就简历能添一笔。<strong>AI</strong>已经能完成80%的工作，作为一个前端，实际使用过AI，才发现AI真的已经把前端拍进了泥土里。这一年，说句不好听的，一事无成🤣，也挺失败的。系统已经完善的差不多，<strong>Web端</strong>、<strong>服务端</strong>、<strong>App端</strong>、<strong>Doc网站</strong>，差不多可以停下来思考一下未来的路了。</p>\n<h2 id=\"未来\">未来</h2>\n<p>马上2026就要到了，希望新的一年，能够迎来一份“未来“，也祝愿看到这里的朋友新的一年能收获丰硕的果实</p>\n<h2 id=\"-致谢\">🙏 致谢</h2>\n<p>感谢阅读到这里的朋友🙏，在这里厚着脸皮希望大家能够去访问一下我的<a href=\"https://wladmin.cn\" rel=\"noopener nofollow\" target=\"_blank\">开源管理系统</a>，可以去<a href=\"https://gitee.com/lyqjob/project-root\" rel=\"noopener nofollow\" target=\"_blank\">仓库</a>克隆下来耍耍，欢迎👏各位大佬提出<a href=\"https://gitee.com/lyqjob/project-root/issues\" rel=\"noopener nofollow\" target=\"_blank\">意见</a>，有问题也可以发我邮箱📮<a href=\"mailto:lyqjob@yeah.net\" rel=\"noopener nofollow\" target=\"_blank\">lyqjob@yeah.net</a>，再次感谢</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 16:47</span>&nbsp;\n<a href=\"https://www.cnblogs.com/liyq666\">香煎藕饼</a>&nbsp;\n阅读(<span id=\"post_view_count\">1092</span>)&nbsp;\n评论(<span id=\"post_comment_count\">33</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "论文解读：One-shot Entropy Minimization",
      "link": "https://www.cnblogs.com/qizhou/p/19426973",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/qizhou/p/19426973\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 15:36\">\n    <span>论文解读：One-shot Entropy Minimization</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p>一篇还未发表的论文，但做了大量实验对熵最小化技巧提升模型推理能力进行了探索。本文训练了13440个大型语言模型，发现熵最小化（EM）只需要一个未标记的数据和10步优化，性能提升就比<strong>RL</strong>还强。基于两个直接而简单的假设：</p>\n<ul>\n<li>\n<p>生成大型语言模型的采样过程本质上是随机的。</p>\n</li>\n<li>\n<p>正确答案的熵通常低于错误答案。</p>\n</li>\n</ul>\n<p>EM和RL有<strong>共同目标</strong>：在不添加新知识的情况下释放预训练模型的潜在潜力，都依赖于所谓“token重评级”。</p>\n<p>原文网址：<a href=\"https://arxiv.org/abs/2505.20282v4\" rel=\"noopener nofollow\" target=\"_blank\">https://arxiv.org/abs/2505.20282v4</a></p>\n<h1>方法</h1>\n<p>给定prompt <span class=\"math\">$x$</span>，生成序列<span class=\"math\">$y$</span>，最小化生成序列token级别的预测熵：</p>\n<p style=\"text-align: center;\"><span class=\"math\">$\\displaystyle L_{\\mathrm{EM}} = \\frac{1}{|y|} \\sum_{t = 1}^{|y|} H_t&nbsp;&nbsp;$</span></p>\n<p style=\"text-align: center;\"><span class=\"math\">$\\displaystyle H_t = -\\sum_{v \\in V} p_\\theta(v \\mid y_{&lt;t}, x)\\,\\log p_\\theta(v \\mid y_{&lt;t}, x)$</span></p>\n<p>训练对单个样本进行，从未标注数据中筛选（2.2节）：模型在多次采样下表现出较高的 pass@k 方差，从而对“熵”更敏感，提供更强的<strong>熵梯度</strong>信号。所谓pass@k 方差就是大模型针对同一个数据生成<span class=\"math\">$k$</span>段内容，计算<span class=\"math\">$k$</span>个内容正确与否的方差。</p>\n<h1>实验</h1>\n<p><strong>训练设置：</strong>针对特定样本，每次生成64段推理内容（即训练批量为64），用以上最小熵损失微调大模型10次。预测温度设置为0.5，学习率固定为<span class=\"math\">$2\\times 10^{-5}$</span>。</p>\n<p>表1：各种推理模型与EM的对比。</p>\n<p>图1：用了EM之后，模型生成token 的概率分布。EM使分布更右偏。</p>\n<p>图2：EM损失和评估分数随着训练的变化曲线。</p>\n<p>图3/4：不同温度对性能的影响。</p>\n<p>图5：EM和RL先后执行，性能随迭代的变化。发现RL之后应用EM会导致性能下降，而EM之后RL性能会提升。这表明EM加剧了RL引入的分配扭曲，强化了RL的“对齐税”。</p>\n<p>表2：多样本的EM与单样本的EM对比，看出多样本也没有多大优势。</p>\n<p>图6：不同学习率对推理性能的影响。</p>\n<h1>讨论与见解</h1>\n<p>单次EM增益的上限由基础模型的内在推理能力决定。在相对较弱的LLaMA-3.1-8B上，单次EM的平均准确率仅提高到24.3%，勉强超过23.6%的基线。这表明，当底层模型缺乏足够的推理能力时，最小EM优化无法完全弥补其不足。</p>\n<p>RL根据外部真实奖励调整令牌概率。这通常会促进以前低概率（尾部）代币的相对排名。即使在重新排序后，这些代币也往往占据概率分布的中间位置，需要在采样过程中选择更高的温度。因此，RL训练的模型表现出相反的趋势：性能随着采样温度的升高而提高，如图4所示。</p>\n<p>在大多数场景中，尤其是在SFT和训练最少的RL环境中，EM显著地修剪了冗余的决策路径，稳定了关键预测，验证了其作为最小但强大的优化策略的有效性和通用性。</p>\n<p>&nbsp;</p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 15:36</span>&nbsp;\n<a href=\"https://www.cnblogs.com/qizhou\">颀周</a>&nbsp;\n阅读(<span id=\"post_view_count\">83</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "2025再见，码农当自强，47岁尚能饭否",
      "link": "https://www.cnblogs.com/datacool/p/19430534",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/datacool/p/19430534\" id=\"cb_post_title_url\" title=\"发布于 2026-01-01 19:22\">\n    <span>2025再见，码农当自强，47岁尚能饭否</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        2025年度总结，令我啼笑皆非的2025结束了。\n    </div>\n<div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<blockquote>\n<p><strong><span style=\"font-size: 18px;\">2025注定是难忘的一年。2025年1月1号，是我结束飘洋过海的生活从太平洋岛国萨摩亚回国的第一天。我以为迎接的将是全新的人生。打开公众号文章劈头盖脸的都是负面的新闻，还有各种平台都有人在吐槽，诉苦。我明白了最难的2025它来了。</span></strong></p>\n<p>&nbsp;</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/124467/202601/124467-20260101175023459-602426282.png\" /></p>\n<p>&nbsp;</p>\n<p>好在坚强的我，迎来了2026。没想到以前看到一位博主说的：<span style=\"font-size: 18px;\"><strong>宠辱不惊，闲看庭前花开花落；去留无意，漫随天外云卷云舒</strong></span>。这看来一辈子都难做到了。</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n</blockquote>\n<h1>正文&nbsp;&nbsp;</h1>\n<p><span>我想总结是要做的。</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>《啼笑姻缘》</span><br /><span>演唱：陈小春</span><br /><span>作曲：陶昌廷</span><br /><span>填词：黄伟文</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>苦恋三千年 分手皆一念</span><br /><span>匆匆只在半生间</span><br /><span>谁管烽火连天 嫣红姹紫</span><br /><span>只想一贯真心 相见</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>纵使不相见 鲜血比水更甜</span><br /><span>一生不配做情人</span><br /><span>你生来这么美 只看一眼十万个心碎</span><br /><span>宁愿不爱 我自劳不获</span><br /><span>憎相知 晚一点</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>却怕一天 一切不再重要</span><br /><span>那时追悔 可算迟</span><br /><span>和你凄风苦雨 和你披星戴月</span><br /><span>任你呼天抢地 我也不退</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>爱似黄金 恨似钨丝</span><br /><span>就恨情难尽 爱可熔掉恨</span><br /><span>我本心上 无情的人</span><br /><span>却变成了 伤心的人</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>为你假意当真 为你献上灵魂</span><br /><span>但最伤心的人 还笑说不要紧</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>赐我祝福的壮举 请你不用担忧我会不争气</span><br /><span>没有心 痛便要别离 很珍惜我的骨气</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>纵使不相见 鲜血比水更甜</span><br /><span>一生不配做情人</span><br /><span>你生来这么美 只看一眼十万个心碎</span><br /><span>宁愿不爱 我自劳不获</span><br /><span>憎相知 晚一点</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>却怕一天 一切不再重要</span><br /><span>那时追悔 可算迟</span><br /><span>和你凄风苦雨 和你披星戴月</span><br /><span>任你呼天抢地 我也不退</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>爱似黄金 恨似钨丝</span><br /><span>就恨情难尽 爱可熔掉恨</span><br /><span>我本心上 无情的人</span><br /><span>却变成了 伤心的人</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>为你假意当真 为你献上灵魂</span><br /><span>但最伤心的人 还笑说不要紧</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>赐我祝福的壮举 请你不用担忧我会不争气</span><br /><span>没有心 痛便要别离 很珍惜我的骨气</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>相恋 苦恋 依恋 姻缘</span><br /><span>若注定这就叫缘</span><br /><span>这循环 何时能完</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>和你凄风苦雨 和你披星戴月</span><br /><span>任你呼天抢地 我也不退</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>爱似黄金 恨似钨丝</span><br /><span>就恨情难尽 爱可熔掉恨</span><br /><span>我本心上 无情的人</span><br /><span>却变成了 伤心的人</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>为你假意当真 为你献上灵魂</span><br /><span>但最伤心的人 还笑说不要紧</span></p>\n<p>&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span>赐我祝福的壮举 请你不用担忧我会不争气</span><br /><span>没有心 痛便要别离 很珍惜我的骨气</span></p>\n<p class=\"ds-markdown-paragraph\">&nbsp;</p>\n<p class=\"ds-markdown-paragraph\"><span><span style=\"font-size: 18px;\">我的程序人生让我啼笑皆非；47岁大龄还不能躺平，2个孩子在读初中，家里房贷还没还完。2025-03-07结束了在成都近3个月的外包，做的是一个涉密的项目，不知道客户是谁，用户场景是什么。理解需求比较难，所以就做不久了。刚开始任务还很多，狂做了2个月，慢慢变得没什么任务，主动要任务也没有，经常要找别的同事蹭任务。当时正是金3银4的季节。于是想自降身价回重庆主城找个工作。没想到我这个决定害得我经历了半年多的失业。意向中的工作没搞定，新工作一直没找到。这期间4月份去了嘉兴一个做工厂的公司同时也有上位机业务的，做了3天，一看不签合同，除了入职那天录了个指纹之外，其他啥手续都没有。所以就跑了。5月初找以前同事介绍一个去扬州驻场开发的工作，也是去了9天，把自己的第一个业务作顺的时候，上线了还不提签合同的事，于是心又慌了。因为多年不见，也对前同事不够信任，然后一朋友打电话说要合作开发一套洗浴软件，他运营我开发，他资助我2年每月提供基本的生活费；做起来就继续。做不好就转。然后吭哧吭哧苦干了3个月。来说说6月的事，boss上一个上海的韩总，说可以和我谈谈居家远程工作的细节。他说给6K，如果去上海每天补助300，提供租房。我先在柳州的中车的中控项目做了2个星期，然后6月初去了上海。公司给租了房，我每天乘坐轮渡从黄浦江对面的塘桥去外滩的久事大厦上班。做的是JAVA开发，阿里投资的人力窝项目，微服务，JAVA并不是很精通，心里又慌了。结果上了9天班，甲方提出换人。所以我又一次提桶跑路回家。时间来到9月，那个洗浴软件只完成了一大半。这时鸡血的剧情来了，我那个合作伙伴迎来了至暗时刻：他感情受挫，被小3骗光了钱，陷入了低谷，没钱继续了。久久没有稳定下来，我一下更慌了。时间来到9月底，又有外包公司联系我，说有个数据迁移的工作机会。这一干就是3个月，前几天甲方说明年人员要裁剪。</span>前几天我发了个朋友圈，打算失业了这次就转身做独立开发者。你看：<img alt=\"微信图片_20251230102937_59_8\" src=\"https://img2024.cnblogs.com/blog/124467/202601/124467-20260101191417734-591032732.png\" /></span></p>\n<p>&nbsp;</p>\n<p><img alt=\"微信图片_20260101185504_64_8\" src=\"https://img2024.cnblogs.com/blog/124467/202601/124467-20260101191457746-1335682248.jpg\" /></p>\n<p>&nbsp;</p>\n<p><img alt=\"微信图片_20260101185505_65_8\" src=\"https://img2024.cnblogs.com/blog/124467/202601/124467-20260101191520009-1689318354.jpg\" /></p>\n<p>&nbsp;</p>\n<p>还有个gif不知道怎么传不上来。反正是一种思考。<span style=\"font-size: 18px;\">现在结果下来了明年继续干甲方的活。今天听了一个广播说是阿Q才是人间清醒的。我想也是的，现实很骨感，那我就精神上胜利。好吧，总结完毕，祝大家越来越好。</span></p>\n<p class=\"ds-markdown-paragraph\">&nbsp;</p>\n<p class=\"ds-markdown-paragraph\">&nbsp;</p>\n<p>&nbsp;</p>\n</div>\n<div id=\"MySignature\">\n    <div>\n    <p>作者：<a href=\"https://www.cnblogs.com/datacool/\" target=\"_blank\">数据酷软件</a></p>\n    <p>出处：<a href=\"https://www.cnblogs.com/datacool/p/19430534\" target=\"_blank\">https://www.cnblogs.com/datacool/p/19430534</a></p>\n    <p>关于作者：20年编程从业经验，持续关注工业自动化</p>\n    <p>本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明。</p>\n    <p>联系方式: qq:71008973;wx:6857740733</p>\n    <p>基于人脸识别的考勤系统 地址: https://gitee.com/afeng124/viewface_attendance_ext </p>\n    <p>自己开发安卓应用框架 地址: https://gitee.com/afeng124/android-app-frame</p>\n    <p>WPOS(warehouse+pos) 后台演示地址: http://47.239.106.75:8080/</p>\n</div>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-01 19:22</span>&nbsp;\n<a href=\"https://www.cnblogs.com/datacool\">数据酷软件</a>&nbsp;\n阅读(<span id=\"post_view_count\">39</span>)&nbsp;\n评论(<span id=\"post_comment_count\">1</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "Ruoyi框架 | 扩展部门数据权限实现",
      "link": "https://www.cnblogs.com/echohye/p/19430439",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/echohye/p/19430439\" id=\"cb_post_title_url\" title=\"发布于 2026-01-01 17:51\">\n    <span>Ruoyi框架 | 扩展部门数据权限实现</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h2 id=\"一背景与目标\">一、背景与目标</h2>\n<p>在若依框架原有 <code>DataScope</code> 的基础上，实现一套<strong>独立的、基于部门层级的数据权限过滤机制</strong>，用于按组织结构灵活控制数据可见范围。</p>\n<h3 id=\"设计目标\">设计目标</h3>\n<ul>\n<li>\n<p>不依赖角色、不判断是否管理员</p>\n</li>\n<li>\n<p>通过注解参数动态控制数据范围</p>\n</li>\n<li>\n<p>支持：</p>\n<ul>\n<li>是否包含本部门</li>\n<li>向上查询 N 级部门</li>\n<li>向下查询 N 级部门 / 所有子部门</li>\n</ul>\n</li>\n<li>\n<p>与若依原有 <code>BaseEntity + params + MyBatis XML</code> 机制完全兼容</p>\n</li>\n</ul>\n<hr />\n<h2 id=\"二核心设计思路\">二、核心设计思路</h2>\n<h3 id=\"1-技术方案\">1. 技术方案</h3>\n<ul>\n<li>\n<p>使用 <strong>AOP + 自定义注解</strong> 拦截查询方法</p>\n</li>\n<li>\n<p>在方法执行前：</p>\n<ul>\n<li>根据当前用户部门 ID</li>\n<li>动态拼接部门过滤 SQL</li>\n<li>注入到 <code>BaseEntity.params.dataScope</code></li>\n</ul>\n</li>\n<li>\n<p>Mapper XML 中通过 <code>${params.dataScope}</code> 拼接 WHERE 条件</p>\n</li>\n</ul>\n<h3 id=\"2-依赖表结构sys_dept\">2. 依赖表结构（sys_dept）</h3>\n<pre><code class=\"language-text\">dept_id     部门ID\nparent_id   父部门ID\nancestors   祖先路径，如：0,1,3,10\n</code></pre>\n<hr />\n<h2 id=\"三自定义注解extendeddatascope\">三、自定义注解：ExtendedDataScope</h2>\n<pre><code class=\"language-java\">@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface ExtendedDataScope {\n\n    // 部门表别名（必填）\n    String deptAlias() default \"\";\n\n    // 用户表别名（预留扩展）\n    String userAlias() default \"\";\n\n    // 权限类型（当前主要使用 dept）\n    String type() default \"dept\";\n\n    // 向上级部门层数（0 = 不包含）\n    int upLevel() default 0;\n\n    // 向下级部门层数（0 = 不包含，999 = 所有子级）\n    int downLevel() default 0;\n\n    // 是否包含本部门\n    boolean includeSelf() default true;\n}\n</code></pre>\n<hr />\n<h2 id=\"四aop-实现要点\">四、AOP 实现要点</h2>\n<h3 id=\"1-切面职责\">1. 切面职责</h3>\n<ul>\n<li>拦截所有标注 <code>@ExtendedDataScope</code> 的方法</li>\n<li>清空历史 dataScope，防止 SQL 注入</li>\n<li>生成部门层级 SQL</li>\n<li>写入 <code>BaseEntity.params.dataScope</code></li>\n</ul>\n<h3 id=\"2-核心处理流程\">2. 核心处理流程</h3>\n<pre><code class=\"language-text\">@Before\n  ├─ clearDataScope()\n  ├─ 获取当前用户\n  ├─ 读取注解参数\n  ├─ 构建部门范围 SQL\n  └─ 写入 params.dataScope\n</code></pre>\n<details>\n点击查看代码\n<pre><code>@Aspect\n@Component\npublic class ExtendedDataScopeAspect {\n\n    @Autowired\n    private SysDeptMapper deptMapper;\n\n    /**\n     * 参数 key（和若依一致）\n     */\n    public static final String DATA_SCOPE = \"dataScope\";\n\n    @Before(\"@annotation(dataScope)\")\n    public void doBefore(JoinPoint joinPoint, ExtendedDataScope dataScope) {\n        clearDataScope(joinPoint);\n        handleDataScope(joinPoint, dataScope);\n    }\n\n    private void handleDataScope(JoinPoint joinPoint, ExtendedDataScope dataScope) {\n        LoginUser loginUser = SecurityUtils.getLoginUser();\n        if (loginUser == null) {\n            return;\n        }\n\n        String deptAlias = dataScope.deptAlias();\n        if (StringUtils.isBlank(deptAlias)) {\n            return;\n        }\n\n        String sql = buildDeptScopeSql(loginUser.getDeptId(), deptAlias, dataScope);\n        if (StringUtils.isBlank(sql)) {\n            return;\n        }\n\n        Object params = joinPoint.getArgs()[0];\n        if (params instanceof BaseEntity) {\n            BaseEntity baseEntity = (BaseEntity) params;\n            baseEntity.getParams().put(DATA_SCOPE, \" AND (\" + sql + \")\");\n        }\n    }\n\n    /**\n     * 构建部门层级 SQL\n     */\n    private String buildDeptScopeSql(Long deptId, String deptAlias, ExtendedDataScope scope) {\n        List&lt;String&gt; conditions = new ArrayList&lt;&gt;();\n\n        /* ========== 本部门 ========== */\n        if (scope.includeSelf()) {\n            conditions.add(deptAlias + \".dept_id = \" + deptId);\n        }\n\n        /* ========== 向上 ========== */\n        if (scope.upLevel() &gt; 0) {\n            // ancestors 形如：0,1,3,10\n            // 向上 N 级：取 ancestors 中倒数 N 位\n            SysDept sysDept = deptMapper.selectDeptById(deptId);\n            String ancestors = sysDept.getAncestors();\n            if (ancestors != null) {\n                conditions.add(buildUpDeptSql(deptAlias, ancestors, scope.upLevel()));\n            }\n\n        }\n\n        /* ========== 向下 ========== */\n        if (scope.downLevel() &gt; 0) {\n            if (scope.downLevel() &gt;= 999) {\n                // 所有子级\n                conditions.add(\n                        deptAlias + \".dept_id IN (\" +\n                                \"SELECT dept_id FROM sys_dept \" +\n                                \"WHERE find_in_set(\" + deptId + \", ancestors)\" +\n                                \")\"\n                );\n            } else {\n                conditions.add(buildDownDeptSql(deptAlias, deptId, scope.downLevel()));\n            }\n        }\n\n        return String.join(\" OR \", conditions);\n    }\n\n    /**\n     * 向上 N 级部门\n     */\n    private String buildUpDeptSql(String deptAlias, String ancestors, int upLevel) {\n        // 使用子查询，取 ancestors 中的上级\n        return \"find_in_set(\" + deptAlias + \".dept_id,\" +\n                \" SUBSTRING_INDEX('\" + ancestors + \"', ',', -\" + upLevel + \") \" +\n                \")\";\n    }\n\n    /**\n     * 向下 N 级部门\n     */\n    private String buildDownDeptSql(String deptAlias, Long deptId, int downLevel) {\n        // ancestors 深度控制（当前 depth + N）\n        return deptAlias + \".dept_id IN (\" +\n                \" SELECT d.dept_id FROM sys_dept d \" +\n                \" WHERE find_in_set(\" + deptId + \", d.ancestors) \" +\n                \" AND (LENGTH(d.ancestors) - LENGTH(REPLACE(d.ancestors, ',', ''))) &lt;= \" +\n                \"     ( \" +\n                \"       SELECT (LENGTH(ancestors) - LENGTH(REPLACE(ancestors, ',', ''))) + \" + downLevel +\n                \"       FROM sys_dept WHERE dept_id = \" + deptId +\n                \"     )\" +\n                \")\";\n    }\n\n    /**\n     * 清空 dataScope，防止 SQL 注入\n     */\n    private void clearDataScope(JoinPoint joinPoint) {\n        Object params = joinPoint.getArgs()[0];\n        if (params instanceof BaseEntity) {\n            ((BaseEntity) params).getParams().put(DATA_SCOPE, \"\");\n        }\n    }\n}\n\n</code></pre>\n</details>\n<hr />\n<h2 id=\"五部门层级-sql-构建规则\">五、部门层级 SQL 构建规则</h2>\n<h3 id=\"1-本部门\">1. 本部门</h3>\n<pre><code class=\"language-sql\">d.dept_id = {currentDeptId}\n</code></pre>\n<p>由 <code>includeSelf = true</code> 控制</p>\n<hr />\n<h3 id=\"2-向上-n-级部门uplevel\">2. 向上 N 级部门（upLevel）</h3>\n<p>原理：</p>\n<ul>\n<li>利用 <code>ancestors</code> 字段</li>\n<li>从 ancestors 中向前截取 N 个父级</li>\n</ul>\n<p>示意 SQL：</p>\n<pre><code class=\"language-sql\">d.dept_id IN (\n  SELECT SUBSTRING_INDEX(\n    SUBSTRING_INDEX(ancestors, ',', -(N + 1)), ',', 1\n  )\n  FROM sys_dept\n  WHERE dept_id = 当前部门ID\n)\n</code></pre>\n<hr />\n<h3 id=\"3-向下-n-级部门downlevel\">3. 向下 N 级部门（downLevel）</h3>\n<h4 id=\"31-所有子级downlevel--999\">3.1 所有子级（downLevel = 999）</h4>\n<pre><code class=\"language-sql\">d.dept_id IN (\n  SELECT dept_id FROM sys_dept\n  WHERE find_in_set(当前部门ID, ancestors)\n)\n</code></pre>\n<h4 id=\"32-限定层级子部门\">3.2 限定层级子部门</h4>\n<p>思路：</p>\n<ul>\n<li>计算 ancestors 的层级深度（逗号个数）</li>\n<li>控制最大深度 = 当前深度 + N</li>\n</ul>\n<pre><code class=\"language-sql\">d.dept_id IN (\n  SELECT d.dept_id\n  FROM sys_dept d\n  WHERE find_in_set(当前部门ID, d.ancestors)\n    AND 层级深度(d) &lt;= 当前层级 + N\n)\n</code></pre>\n<hr />\n<h2 id=\"六mapper-xml-使用方式\">六、Mapper XML 使用方式</h2>\n<pre><code class=\"language-xml\">&lt;select id=\"selectList\" resultType=\"xxx\"&gt;\n  SELECT *\n  FROM biz_table t\n  LEFT JOIN sys_dept d ON t.dept_id = d.dept_id\n  &lt;where&gt;\n    1 = 1\n    ${params.dataScope}\n  &lt;/where&gt;\n&lt;/select&gt;\n</code></pre>\n<p>说明：</p>\n<ul>\n<li><code>${params.dataScope}</code> 必须保留</li>\n<li>AOP 动态注入 <code>AND ( ... )</code></li>\n</ul>\n<hr />\n<h2 id=\"七使用示例\">七、使用示例</h2>\n<pre><code class=\"language-java\">@ExtendedDataScope(\n    deptAlias = \"d\",\n    includeSelf = true,\n    upLevel = 1,\n    downLevel = 2\n)\npublic List&lt;SysDept&gt; selectDeptList(SysDept dept)\n{\n    return deptMapper.selectDeptList(dept);\n}\n</code></pre>\n<h3 id=\"含义说明\">含义说明</h3>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>includeSelf</td>\n<td>包含本部门</td>\n</tr>\n<tr>\n<td>upLevel=1</td>\n<td>包含上一级部门</td>\n</tr>\n<tr>\n<td>downLevel=2</td>\n<td>包含下两级部门</td>\n</tr>\n<tr>\n<td>downLevel=999</td>\n<td>包含所有子部门</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h2 id=\"八方案特点总结\">八、方案特点总结</h2>\n<ul>\n<li>✅ 与若依原生 DataScope 解耦</li>\n<li>✅ 仅依赖部门层级，不依赖角色权限</li>\n<li>✅ 控制粒度细，适合复杂组织结构</li>\n<li>✅ 非侵入式，Mapper 无需改动</li>\n<li>✅ 特别适合安全监管 / GIS / 组织树场景</li>\n</ul>\n<hr />\n<h2 id=\"九可扩展方向后续优化\">九、可扩展方向（后续优化）</h2>\n<ul>\n<li>使用 MySQL 8 / PostgreSQL 的 <code>WITH RECURSIVE</code> 优化层级查询</li>\n<li>部门层级缓存（Redis）减少子查询</li>\n<li>扩展到：部门 + 用户混合数据权限</li>\n<li>支持多部门归属（兼职部门）</li>\n</ul>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-01 17:51</span>&nbsp;\n<a href=\"https://www.cnblogs.com/echohye\">槑孒</a>&nbsp;\n阅读(<span id=\"post_view_count\">76</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    }
  ]
}