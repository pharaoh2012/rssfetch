{
  "title": "ä¸»é¡µ - åšå®¢å›­",
  "link": "https://www.cnblogs.com/",
  "description": "ä¸»é¡µ - åšå®¢å›­ RSS",
  "entries": [
    {
      "title": "ã€å¼€æºé¡¹ç›®åˆ†äº«ã€‘ä¸‹ä¸€ä¸ª SSH è¿œç¨‹ç»ˆç«¯ï¼Œä½•å¿…æ˜¯é»‘å±å‘½ä»¤è¡Œï¼Ÿè¿™æ¬¾ç¥å™¨å¯ä»¥åƒæ“ä½œ Windows æ¡Œé¢ä¸€æ ·ç®¡ç†ä½ çš„Linux æœåŠ¡å™¨",
      "link": "https://www.cnblogs.com/eguid/p/19579945",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/eguid/p/19579945\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-05 16:33\">\n    <span>ã€å¼€æºé¡¹ç›®åˆ†äº«ã€‘ä¸‹ä¸€ä¸ª SSH è¿œç¨‹ç»ˆç«¯ï¼Œä½•å¿…æ˜¯é»‘å±å‘½ä»¤è¡Œï¼Ÿè¿™æ¬¾ç¥å™¨å¯ä»¥åƒæ“ä½œ Windows æ¡Œé¢ä¸€æ ·ç®¡ç†ä½ çš„Linux æœåŠ¡å™¨</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p><strong>ä¸‹ä¸€ä¸ª SSH è¿œç¨‹ç»ˆç«¯ï¼Œä½•å¿…æ˜¯é»‘å±å‘½ä»¤è¡Œï¼Ÿ</strong></p>\n<p>ä½ è¿˜åœ¨ç”¨ <code>ssh user@server</code> æ‰“å¼€ä¸€ä¸ªæ¼†é»‘çš„ç»ˆç«¯çª—å£ï¼Œä¸€è¡Œè¡Œæ•²å‘½ä»¤ã€ç¿»å†å²ã€æ‰‹æŠ–åˆ åº“è·‘è·¯ï¼Ÿ<br />\nä½ è¿˜åœ¨é è®°å¿†èƒŒ <code>top</code>ã€<code>df -h</code>ã€<code>systemctl</code> çš„å‚æ•°ï¼Œç”Ÿæ€•ä¸€ä¸å°å¿ƒæŠŠæœåŠ¡å™¨æå´©ï¼Ÿ<br />\nä½ è¿˜åœ¨ä¸€è¾¹å¼€ç€ FileZilla ä¼ æ–‡ä»¶ï¼Œä¸€è¾¹åˆ‡å›ç»ˆç«¯é‡å¯æœåŠ¡ï¼Œåƒåœ¨ç©â€œå¤šä»»åŠ¡æ‚è€â€ï¼Ÿ</p>\n<p><strong>åœï¼è¿™éƒ½ 2026 å¹´äº†â€”â€”Linux æœåŠ¡å™¨ç®¡ç†ï¼Œä¸è¯¥è¿™ä¹ˆè‹¦ã€‚</strong></p>\n<hr />\n<h3 id=\"-è¶…çº§æ¡Œé¢ç»ˆç«¯superdesktop-terminalæ¥äº†\">ğŸŒŸ è¶…çº§æ¡Œé¢ç»ˆç«¯ï¼ˆsuperDesktop Terminalï¼‰æ¥äº†ï¼</h3>\n<p>è¿™ä¸æ˜¯åˆä¸€ä¸ªâ€œç¾åŒ–ç‰ˆç»ˆç«¯â€ï¼Œè€Œæ˜¯ä¸€åœº<strong>ä»å‘½ä»¤è¡Œåˆ°å¯è§†åŒ–æ¡Œé¢çš„èŒƒå¼é©å‘½</strong>ã€‚</p>\n<blockquote>\n<p><strong>åƒæ“ä½œ Windows æ¡Œé¢ä¸€æ ·ç®¡ç†ä½ çš„ Linux æœåŠ¡å™¨ã€‚</strong></p>\n</blockquote>\n<p>æ‹–æ‹½ä¸Šä¼ æ–‡ä»¶ï¼Ÿâœ…<br />\nå®æ—¶æŸ¥çœ‹ CPU/å†…å­˜æ›²çº¿ï¼Ÿâœ…<br />\nç‚¹ä¸€ä¸‹åœæ­¢æŸä¸ªå¤±æ§è¿›ç¨‹ï¼Ÿâœ…<br />\nå›¾å½¢åŒ–é…ç½®é˜²ç«å¢™è§„åˆ™ï¼Ÿâœ…<br />\næ‰¹é‡å¯¹ 10 å°æœåŠ¡å™¨æ‰§è¡Œç›¸åŒæ“ä½œï¼Ÿâœ…</p>\n<p>å®ƒæŠŠ <code>ls</code> å˜æˆäº†æ–‡ä»¶æµè§ˆå™¨ï¼ŒæŠŠ <code>ps aux</code> å˜æˆäº†ä»»åŠ¡ç®¡ç†å™¨ï¼ŒæŠŠ <code>scp</code> å˜æˆäº†æ‹–æ‹½å¤åˆ¶â€”â€”<strong>æ‰€è§å³æ‰€å¾—ï¼Œæ‰€ç‚¹å³æ‰§è¡Œ</strong>ã€‚</p>\n<hr />\n<h3 id=\"-ä¸ºä»€ä¹ˆè¯´å®ƒæ˜¯ä¸‹ä¸€ä»£-ssh-ç»ˆç«¯\">ğŸ’¡ ä¸ºä»€ä¹ˆè¯´å®ƒæ˜¯â€œä¸‹ä¸€ä»£ SSH ç»ˆç«¯â€ï¼Ÿ</h3>\n<ul>\n<li><strong>å‘Šåˆ«ç›²æ“</strong>ï¼šå†ä¹Ÿä¸ç”¨çŒœâ€œè¿™ä¸ªç›®å½•ä¸‹æœ‰æ²¡æœ‰é‚£ä¸ªé…ç½®æ–‡ä»¶â€ï¼Œç›´æ¥åŒå‡»æ‰“å¼€ã€‚</li>\n<li><strong>é›¶å­¦ä¹ æˆæœ¬</strong>ï¼šè¿ç»´æ–°æ‰‹ä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹ï¼Œè€æ‰‹æ•ˆç‡ç¿»å€ã€‚</li>\n<li><strong>å®‰å…¨å¯é </strong>ï¼šåŸºäº Java + JSchï¼Œæ”¯æŒå¯†é’¥/å¯†ç è®¤è¯ï¼Œè¿æ¥ä¿¡æ¯æœ¬åœ°åŠ å¯†å­˜å‚¨ã€‚</li>\n<li><strong>å…¨åŠŸèƒ½é›†æˆ</strong>ï¼šæ–‡ä»¶ç®¡ç†ã€è¿›ç¨‹ç›‘æ§ã€ç½‘ç»œé…ç½®ã€ç”¨æˆ·ç®¡ç†ã€è½¯ä»¶åŒ…æ“ä½œâ€¦â€¦ä¸€ä¸ªçª—å£å…¨æå®šã€‚</li>\n<li><strong>å¼€æºå…è´¹</strong>ï¼šGPL-3.0 åè®®ï¼Œä»£ç é€æ˜ï¼Œç¤¾åŒºå…±å»ºï¼Œæ— éšè—æ”¶è´¹ã€‚</li>\n</ul>\n<hr />\n<h3 id=\"-æŠ€æœ¯æ ˆç¡¬æ ¸ä½“éªŒå´æç®€\">ğŸš€ æŠ€æœ¯æ ˆç¡¬æ ¸ï¼Œä½“éªŒå´æç®€</h3>\n<ul>\n<li>UIï¼šFlatLaf ç°ä»£åŒ–ä¸»é¢˜ï¼Œæ¸…çˆ½ä¸èŠ±å“¨</li>\n<li>åç«¯ï¼šçº¯ Java Swingï¼Œè·¨å¹³å°ï¼ˆWin/macOS/Linux å…¨æ”¯æŒï¼‰</li>\n<li>å†…æ ¸ï¼šJSch å®ç°ç¨³å®š SSH é€šä¿¡</li>\n<li>æ•°æ®ï¼šåµŒå…¥å¼ H2 æ•°æ®åº“å­˜å‚¨è¿æ¥é…ç½®</li>\n<li>å›¾è¡¨ï¼šJFreeChart å®æ—¶ç»˜åˆ¶ç³»ç»Ÿæ€§èƒ½æ›²çº¿</li>\n</ul>\n<p><strong>è½»é‡ã€ç‹¬ç«‹ã€æ— éœ€ä¾èµ– Web æœåŠ¡</strong>â€”â€”ä¸‹è½½å³ç”¨ï¼Œéšç§æ— å¿§ã€‚</p>\n<hr />\n<blockquote>\n<p><strong>ä¸æ˜¯æ‰€æœ‰ SSH å·¥å…·éƒ½å«â€œè¶…çº§æ¡Œé¢ç»ˆç«¯â€ã€‚</strong><br />\n<strong>çœŸæ­£çš„æ•ˆç‡ï¼Œæ˜¯è®©å¤æ‚æ¶ˆå¤±ï¼Œè®©æ“ä½œå›å½’ç›´è§‰ã€‚</strong><br />\n<strong>ä¸‹ä¸€ä¸ªè¿œç¨‹ç»ˆç«¯æ—¶ä»£ï¼Œå±äºå¯è§†åŒ–ï¼ŒåŒæ ·å±äºæ¯ä¸€ä½å¯æ•¬çš„è¿ç»´äººã€‚</strong></p>\n</blockquote>\n<hr />\n<p>ğŸ“¦ ç«‹å³ä½“éªŒï¼š<a href=\"https://gitee.com/eguid/super-desktop-terminal\" rel=\"noopener nofollow\" target=\"_blank\">https://gitee.com/eguid/super-desktop-terminal</a><br />\nğŸ‘¨â€ğŸ’» å¼€æºå…±å»ºï¼Œæ¬¢è¿ Star / Fork / æ PRï¼<br />\nğŸ”¥ å‘Šåˆ«é»‘å±ï¼Œæ‹¥æŠ±æ¡Œé¢â€”â€”ä½ çš„æœåŠ¡å™¨ï¼Œå€¼å¾—è¢«æ¸©æŸ”å¯¹å¾…ã€‚</p>\n<p>å¦‚æœè§‰å¾—æœ¬é¡¹ç›®è¿˜ä¸é”™ï¼Œæ¬¢è¿å…³æ³¨ã€ç‚¹èµã€ç‚¹ä¸€é¢—starï¼</p>\n\n\n</div>\n<div id=\"MySignature\">\n    <p>æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š<a href=\"https://www.cnblogs.com/eguid/\" target=\"_blank\">eguid</a>ï¼Œæ²¡æœ‰ä½œè€…å…è®¸ç¦æ­¢è½¬è½½ï¼Œå–å¾—ä½œè€…åŒæ„åè½¬è½½éœ€æ³¨æ˜ä½œè€…åå’ŒåŸæ–‡é“¾æ¥ï¼š<a href=\"https://www.cnblogs.com/eguid/p/19579945\" target=\"_blank\">https://www.cnblogs.com/eguid/p/19579945</a></p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-05 16:33</span>&nbsp;\n<a href=\"https://www.cnblogs.com/eguid\">eguid</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨‹äº”ï¼šè‡ªç„¶è¯­è¨€å¤„ç†  ç¬¬ä¸‰å‘¨ï¼šåºåˆ—æ¨¡å‹ä¸æ³¨æ„åŠ›æœºåˆ¶ è¯¾åä¹ é¢˜ä¸ä»£ç å®è·µ",
      "link": "https://www.cnblogs.com/Goblinscholar/p/19579899",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/Goblinscholar/p/19579899\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-05 16:34\">\n    <span>å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨‹äº”ï¼šè‡ªç„¶è¯­è¨€å¤„ç†  ç¬¬ä¸‰å‘¨ï¼šåºåˆ—æ¨¡å‹ä¸æ³¨æ„åŠ›æœºåˆ¶ è¯¾åä¹ é¢˜ä¸ä»£ç å®è·µ</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>æ­¤åˆ†ç±»ç”¨äºè®°å½•å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨‹çš„å­¦ä¹ ç¬”è®°ã€‚<br />\nè¯¾ç¨‹ç›¸å…³ä¿¡æ¯é“¾æ¥å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>åŸè¯¾ç¨‹è§†é¢‘é“¾æ¥ï¼š<a href=\"https://www.bilibili.com/video/BV1FT4y1E74V?buvid=XU762317353676D786954061C192FE625463B&amp;from_spmid=playlist.playlist-detail.0.0&amp;is_story_h5=false&amp;mid=zqernykrmpf7XfIorMR%2FnA%3D%3D&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=ce0bc526-db69-428a-962e-c65ed8c267bc&amp;share_source=COPY&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1713085655&amp;unique_k=DfBgvFW&amp;up_id=8654113&amp;vd_source=e035e9878d32f414b4354b839a4c31a4\" rel=\"noopener nofollow\" target=\"_blank\">[åŒè¯­å­—å¹•]å´æ©è¾¾æ·±åº¦å­¦ä¹ deeplearning.ai</a></li>\n<li>githubè¯¾ç¨‹èµ„æ–™ï¼Œå«è¯¾ä»¶ä¸ç¬”è®°:<a href=\"https://github.com/robbertliu/deeplearning.ai-andrewNG\" rel=\"noopener nofollow\" target=\"_blank\">å´æ©è¾¾æ·±åº¦å­¦ä¹ æ•™å­¦èµ„æ–™</a></li>\n<li>è¯¾ç¨‹é…å¥—ç»ƒä¹ ï¼ˆä¸­è‹±ï¼‰ä¸ç­”æ¡ˆï¼š<a href=\"https://blog.csdn.net/u013733326/article/details/79827273\" rel=\"noopener nofollow\" target=\"_blank\">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾åä¹ é¢˜ä¸ç­”æ¡ˆ</a></li>\n</ol>\n<p>æœ¬ç¯‡ä¸ºç¬¬äº”è¯¾ç¬¬ä¸‰å‘¨çš„è¯¾åä¹ é¢˜å’Œä»£ç å®è·µéƒ¨åˆ†ã€‚</p>\n<hr />\n<h1 id=\"1ç†è®ºä¹ é¢˜\">1.ç†è®ºä¹ é¢˜</h1>\n<p><a href=\"https://blog.csdn.net/u013733326/article/details/90144255\" rel=\"noopener nofollow\" target=\"_blank\">ã€ä¸­è‹±ã€‘ã€å´æ©è¾¾è¯¾åæµ‹éªŒã€‘Course 5 - åºåˆ—æ¨¡å‹ - ç¬¬ä¸‰å‘¨æµ‹éªŒ</a></p>\n<p>åœ¨è¿™ä¸€å‘¨çš„ä¹ é¢˜å†…å®¹ä¸­æœ‰ä¸€é“é¢˜çš„ç›¸å…³å†…å®¹éœ€è¦å±•å¼€ï¼Œå…ˆçœ‹ä¸€ä¸‹é¢˜é¢ï¼š</p>\n<blockquote>\n<p>ç½‘ç»œé€šè¿‡å­¦ä¹ æ³¨æ„åŠ›åˆ†æ•°æ¥å†³å®šã€ŒæŠŠæ³¨æ„åŠ›æ”¾åœ¨å“ªé‡Œã€ï¼Œè¿™äº›å€¼æ˜¯ç”±ä¸€ä¸ªå°ç¥ç»ç½‘ç»œè®¡ç®—å¾—åˆ°çš„ã€‚<br />\nè¿™é‡Œï¼Œæˆ‘ä»¬<strong>ä¸èƒ½</strong>æŠŠ <span class=\"math inline\">\\(s^{&lt;t-1&gt;}\\)</span> æ›¿æ¢æˆ <span class=\"math inline\">\\(s^{&lt;t&gt;}\\)</span> ä½œä¸ºè¿™ä¸ªç¥ç»ç½‘ç»œçš„è¾“å…¥ï¼Œ<br />\nåŸå› å¦‚ä¸‹ï¼šå› ä¸º <span class=\"math inline\">\\(s^{&lt;t&gt;}\\)</span> ä¾èµ–äºå½“å‰çš„æ³¨æ„åŠ›æƒé‡ï¼Œè€Œå½“å‰çš„æ³¨æ„åŠ›æƒé‡åˆä¾èµ–äºæ³¨æ„åŠ›åˆ†æ•°ï¼Œå› æ­¤åœ¨éœ€è¦è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°çš„æ—¶åˆ»ï¼Œ<span class=\"math inline\">\\(s^{&lt;t&gt;}\\)</span> <strong>å°šæœªè¢«è®¡ç®—å‡ºæ¥</strong>ï¼Œ æ­¤æ—¶åªèƒ½ä½¿ç”¨å‰ä¸€æ—¶åˆ»çš„éšè—çŠ¶æ€ <span class=\"math inline\">\\(s^{&lt;t-1&gt;}\\)</span>ï¼Œè€Œæ— æ³•ä½¿ç”¨å½“å‰çš„ <span class=\"math inline\">\\(s^{&lt;t&gt;}\\)</span>ã€‚<br />\n<strong>ç­”æ¡ˆï¼šæ­£ç¡®</strong></p>\n</blockquote>\n<p>è¿™é“é¢˜ä¸€çœ¼çœ‹ä¸‹æ¥æ˜¯å¾ˆè¿·æƒ‘çš„ï¼Œè¿™æ˜¯<strong>å› ä¸ºè¿™é“é¢˜è®²çš„æ˜¯æœ€æ—©çš„æ³¨æ„åŠ›æœºåˆ¶çš„é€»è¾‘ï¼Œå’Œæˆ‘ä»¬åœ¨ç†è®ºéƒ¨åˆ†ä»‹ç»çš„ä¸»æµé€»è¾‘æœ‰æ‰€ä¸åŒ</strong>ã€‚<br />\nåœ¨<a href=\"https://www.cnblogs.com/Goblinscholar/p/19563950\" target=\"_blank\">ç†è®ºéƒ¨åˆ†</a>ï¼Œæˆ‘ä»¬ä»‹ç»çš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œå­¦ä¹ æ³¨æ„åŠ›åˆ†æ•°çš„ç½‘ç»œçš„è¾“å…¥å°±æ˜¯ <span class=\"math inline\">\\(s^{&lt;t&gt;}\\)</span> ï¼Œä½†åœ¨æœ€æ—©çš„æ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œå®ƒçš„è¾“å…¥æ˜¯ <span class=\"math inline\">\\(s^{&lt;t-1&gt;}\\)</span>ã€‚<br />\nå…¶ä¼ æ’­é€»è¾‘å¯ä»¥ç”¨ä¸€å¥è¯æ€»ç»“ï¼š<strong>åœ¨å½“å‰æ—¶é—´æ­¥ä¸­ï¼ŒåŸå§‹æ³¨æ„åŠ›æœºåˆ¶å°†ç”±ä¸Šä¸€æ—¶åˆ»è§£ç çŠ¶æ€è®¡ç®—å¾—åˆ°çš„ä¸Šä¸‹æ–‡å‘é‡ <span class=\"math inline\">\\(c^{&lt;t&gt;}\\)</span> ä½œä¸ºè§£ç å™¨è¾“å…¥çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºè®¡ç®—å½“å‰è§£ç çŠ¶æ€ <span class=\"math inline\">\\(s^{&lt;t&gt;}\\)</span>ã€‚</strong><br />\næˆ‘ä»¬å±•å¼€å¦‚ä¸‹ï¼š<br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260205162801516-704399919.png\" /><br />\n14 å¹´çš„åŸè®ºæ–‡ä½¿ç”¨çš„å°±æ˜¯è¿™ç§ä¼ æ’­æ–¹å¼ï¼Œå…·æœ‰å¼€åˆ›æ€§ä»·å€¼ã€‚ä½†åœ¨ç°ä»£ï¼Œè¿™ç§å°†ä¸Šä¸‹æ–‡å‘é‡ç›´æ¥çº³å…¥çŠ¶æ€é€’æ¨çš„åšæ³•æ›´å¤šåªå…·æœ‰å†å²æ„ä¹‰ï¼Œäº†è§£å³å¯ã€‚</p>\n<h1 id=\"2ä»£ç å®è·µ\">2.ä»£ç å®è·µ</h1>\n<p><a href=\"https://blog.csdn.net/u013733326/article/details/97619187\" rel=\"noopener nofollow\" target=\"_blank\">ã€ä¸­æ–‡ã€‘ã€å´æ©è¾¾è¯¾åç¼–ç¨‹ä½œä¸šã€‘Course 5 - åºåˆ—æ¨¡å‹ - ç¬¬ä¸‰å‘¨ä½œä¸š</a><br />\nè¿˜æ˜¯å…ˆæ‘†é“¾æ¥ï¼Œè¿™ç¯‡é‡Œåšä¸»å°±æœºå™¨ç¿»è¯‘å’Œè§¦å‘è¯æ£€æµ‹ä¸¤éƒ¨åˆ†å†…å®¹ï¼Œéå¸¸è¯¦ç»†åœ°æ¼”ç¤ºäº†æœ¬å‘¨çš„å†…å®¹ï¼Œä½†è¿˜æ˜¯è¦æ³¨æ„ Keras çš„å¯¼åŒ…æ›´æ–°é—®é¢˜ã€‚<br />\næˆ‘ä»¬åŒæ ·ä½¿ç”¨æ¡†æ¶æ¥æ¼”ç¤ºè¿™éƒ¨åˆ†å†…å®¹ï¼Œä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š</p>\n<ol>\n<li><strong>ä½¿ç”¨ç¼–ç è§£ç æ¡†æ¶è¿›è¡Œæ—¥æœŸæ ¼å¼ç¿»è¯‘</strong></li>\n<li><strong>åœ¨ç¼–ç è§£ç æ¡†æ¶ä¸‹å¯¹æ¯”è´ªå¿ƒè§£ç å’ŒæŸæœç´¢æ€§èƒ½</strong></li>\n<li><strong>ä½¿ç”¨å¸¦æ³¨æ„åŠ›æœºåˆ¶çš„ç¼–ç è§£ç æ¡†æ¶è¿›è¡Œæ—¥æœŸæ ¼å¼ç¿»è¯‘</strong></li>\n</ol>\n<h2 id=\"21-æ•°æ®å‡†å¤‡\">2.1 æ•°æ®å‡†å¤‡</h2>\n<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œç”±äº <strong>seq2seq æ¨¡å‹è‡ªèº«çš„ç¼–ç â€“è§£ç ç»“æ„</strong> ä»¥åŠ <strong>åºåˆ—æ•°æ®çš„æ—¶åºç‰¹æ€§</strong>ï¼Œè¿™ç±»ä»»åŠ¡ç›¸æ¯”è®¸å¤šå¸¸è§„ç›‘ç£å­¦ä¹ ä»»åŠ¡ï¼Œé€šå¸¸<strong>å¯¹è®¡ç®—èµ„æºæœ‰æ›´é«˜çš„è¦æ±‚</strong>ã€‚<br />\nä»¥æœºå™¨ç¿»è¯‘ä»»åŠ¡ä¸ºä¾‹ï¼Œç½‘ç»œä¸Šå­˜åœ¨å¤§é‡å…¬å¼€æ•°æ®é›†ï¼Œå¦‚è‹±æ³•ç¿»è¯‘ã€ä¸­è‹±ç¿»è¯‘ç­‰ã€‚ç”±äºè¿™ç±»æ•°æ®è·å–ç›¸å¯¹å®¹æ˜“ï¼ŒåŒæ—¶è‡ªç„¶è¯­è¨€æœ¬èº«å…·æœ‰<strong>è¯æ±‡è§„æ¨¡å¤§ã€è¡¨è¾¾å½¢å¼å¤šæ ·</strong>çš„ç‰¹ç‚¹ï¼Œæ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¾€å¾€éœ€è¦åŒæ—¶ç»´æŠ¤<strong>æºè¯­è¨€è¯å…¸å’Œç›®æ ‡è¯­è¨€è¯å…¸</strong>ï¼Œå…¶è§„æ¨¡é€šå¸¸è‡³å°‘è¾¾åˆ° <strong>æ•°ä¸‡çº§åˆ«</strong>ã€‚è¿™ç›´æ¥å¯¼è‡´æ¨¡å‹åœ¨å‚æ•°è§„æ¨¡ã€è®¡ç®—é‡ä»¥åŠæ˜¾å­˜å ç”¨ç­‰æ–¹é¢çš„æˆæœ¬æ˜¾è‘—æå‡ã€‚<br />\nå› æ­¤ï¼Œè¿™æ¬¡æˆ‘ä»¬é€‰ç”¨ä¸€ç§ç›¸å¯¹ç®€åŒ–çš„æœºå™¨ç¿»è¯‘ä»»åŠ¡â€”â€”<strong>æ—¥æœŸæ ¼å¼ç¿»è¯‘</strong>ï¼Œè¯¥ç±»ä»»åŠ¡çš„ä¸»è¦ç‰¹ç‚¹åœ¨äº<strong>è¯å…¸è§„æ¨¡å°ã€è¾“å…¥è¾“å‡ºç»“æ„æ¸…æ™°ã€è¯­ä¹‰æ­§ä¹‰æå°‘</strong>ï¼Œå¯ä»¥è¾ƒé«˜æ•ˆç‡åœ°æ¼”ç¤ºæœ¬å‘¨å†…å®¹ã€‚</p>\n<p>è¿™æ¬¡æˆ‘ä»¬ä¸ä½¿ç”¨ç½‘ä¸Šå…¬å¼€çš„æ•°æ®é›†ï¼Œè€Œæ˜¯æ‹“å±•å´æ©è¾¾è€å¸ˆåœ¨ç¼–ç¨‹ä½œä¸šé‡Œçš„é€»è¾‘ï¼Œè¿›è¡Œ<strong>äººå·¥åˆæˆæ•°æ®</strong>ã€‚<br />\næˆ‘ä»¬é€šè¿‡è®¾è®¡å¥½çš„è„šæœ¬ï¼Œç”Ÿæˆ <strong>10000 æ¡</strong> ä»¥ä¸‹æ ¼å¼çš„ç›¸å…³æ•°æ®å’Œå¯¹åº”æ ‡ç­¾å¹¶ä¿å­˜ä¸ºæ–‡ä»¶ï¼š</p>\n<pre><code class=\"language-python\">HUMAN_TEMPLATES = [  \n    \"{day} {month} {year}\",  \n    \"{month} {day}, {year}\",  \n    \"{day} of {month}, {year}\",  \n    \"{month} {day} {year}\",  \n    \"{day}/{month_num}/{year_short}\",  \n    \"{month_num}/{day}/{year_short}\",  \n    \"{weekday}, {day} {month_abbr} {year}\",  \n    \"{month_abbr} {day}th {year_short}\",  \n    \"{year}-{month_num}-{day}\",  \n    \"The {day}{day_suffix} of {month}, {year}\",  \n    \"{day}th {month_abbr}, {year}\",  \n    \"{month} the {day}{day_suffix}, {year}\",  \n    \"Date: {year}/{month_num}/{day}\",  \n    \"{day} in Roman: {roman_day} {month} {year}\",  \n    \"{month_abbr}. {day}, '{year_short}\",  \n]\n</code></pre>\n<p>å®Œæ•´ä»£ç æ”¾åœ¨é™„å½•ï¼Œæ‰“å°å‡ æ¡ç”Ÿæˆæ•°æ®å¦‚ä¸‹ï¼š</p>\n<pre><code>[1] The 28th of April, 1975  ==&gt;  1975-04-28\n[2] Date: 2017/05/5  ==&gt;  2017-05-05\n[3] Jan 10th 44  ==&gt;  1944-01-10\n[4] Tuesday, 6 Nov 2096  ==&gt;  2096-11-06\n[5] The 26th of August, 2089  ==&gt;  2089-08-26\n[6] Date: 2061/08/18  ==&gt;  2061-08-18\n[7] 08/4/35  ==&gt;  1935-08-04\n[8] 27 of May, 1948  ==&gt;  1948-05-27\n[9] 8 of April, 1907  ==&gt;  1907-04-08\n[10] November 11, 1937  ==&gt;  1937-11-11\n</code></pre>\n<p>å‡†å¤‡å¥½æ•°æ®åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥å†…å®¹ã€‚</p>\n<h2 id=\"22-æ¨¡å‹è®¾è®¡\">2.2 æ¨¡å‹è®¾è®¡</h2>\n<p>åœ¨<a href=\"https://www.cnblogs.com/Goblinscholar/p/19547898\" target=\"_blank\">æœ¬å‘¨ç¬¬ä¸€ç¯‡</a>å†…å®¹é‡Œæˆ‘ä»¬å°±æåˆ°è¿‡ï¼šç¼–ç è§£ç æ¡†æ¶ä¸‹çš„ç½‘ç»œç»“æ„å®é™…ä¸Šæ˜¯åˆ†åˆ«è®¾è®¡çš„ä¸¤ä¸ªå­ç½‘ç»œï¼Œåœ¨ä»£ç é€»è¾‘ä¸­ï¼Œå°±æ˜¯<strong>å…ˆåˆ†åˆ«å®šä¹‰è®¾è®¡ç¼–ç å™¨å’Œè§£ç å™¨ï¼Œå†åœ¨æ•´ä½“ç½‘ç»œä¸­è°ƒç”¨</strong>ã€‚æˆ‘ä»¬åˆ†ç‚¹å±•å¼€å¦‚ä¸‹ï¼š</p>\n<h4 id=\"1ç¼–ç å™¨\">ï¼ˆ1ï¼‰ç¼–ç å™¨</h4>\n<pre><code class=\"language-python\">class Encoder(nn.Module):\n    def __init__(self, vocab_size, emb_dim, hidden_dim):\n        super().__init__()\n        # åµŒå…¥å±‚\n        self.embedding = nn.Embedding(vocab_size, emb_dim)\n        # ä½¿ç”¨åŒå‘ LSTM\n        self.lstm = nn.LSTM(emb_dim, hidden_dim, batch_first=True, bidirectional=True)\n    def forward(self, x):\n        embedded = self.embedding(x) \n        outputs, (hidden, cell) = self.lstm(embedded)\n        # outputs: LSTM å¯¹æ¯ä¸ªæ—¶é—´æ­¥çš„è¾“å‡º,ç”¨äºæ³¨æ„åŠ›çš„ç›¸å…³è®¡ç®—ã€‚\n        # (hidden,cell): æœ€åæ—¶é—´æ­¥çš„éšè—çŠ¶æ€å’Œç»†èƒçŠ¶æ€ï¼Œæ˜¯è§£ç å™¨çš„åˆå§‹è¾“å…¥ã€‚\n        return outputs, (hidden, cell)\n\n</code></pre>\n<h4 id=\"2è§£ç å™¨\">ï¼ˆ2ï¼‰è§£ç å™¨</h4>\n<pre><code class=\"language-python\">class Decoder(nn.Module):\n    def __init__(self, vocab_size, emb_dim, hidden_dim, use_attention=False):\n        super().__init__()\n        # è®¾ç½®å‚æ•°ï¼Œé»˜è®¤ä¸ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶\n        self.use_attention = use_attention\n        # åµŒå…¥å±‚\n        self.embedding = nn.Embedding(vocab_size, emb_dim)\n        # LSTM \n        self.lstm = nn.LSTM(emb_dim, hidden_dim, batch_first=True)\n        if use_attention:\n            # æ³¨æ„åŠ›è¯„åˆ†å±‚ï¼Œå°†è§£ç å™¨ hidden ä¸ç¼–ç å™¨ outputs æ‹¼æ¥è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°\n            self.attn = nn.Linear(hidden_dim + hidden_dim * 2, 1)\n            # æ³¨æ„åŠ›ç»“åˆå±‚ï¼šå°†è§£ç å™¨ hidden ä¸ä¸Šä¸‹æ–‡å‘é‡èåˆä¸ºæœ€ç»ˆ LSTM è¾“å‡º\n            self.attn_combine = nn.Linear(hidden_dim + hidden_dim * 2, hidden_dim)\n\n        # è¾“å‡ºå±‚ï¼šå°† LSTM è¾“å‡ºæ˜ å°„åˆ°è¯è¡¨ç»´åº¦ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ª token\n        self.out = nn.Linear(hidden_dim, vocab_size)\n\n    def forward(self, input_step, hidden_cell, encoder_outputs):\n        embedded = self.embedding(input_step)\n        # LSTM å‰å‘è®¡ç®—ï¼Œå¾—åˆ°å½“å‰æ—¶é—´æ­¥è¾“å‡ºå’Œæ–°çš„ hidden/cell\n        lstm_out, hidden_cell = self.lstm(embedded, hidden_cell)\n        # å»æ‰æ—¶é—´ç»´åº¦ï¼Œæ–¹ä¾¿æ³¨æ„åŠ›è®¡ç®—\n        query = lstm_out.squeeze(1)\n\n        if self.use_attention:\n            # æ‰©å±• queryï¼Œå®é™…ä¸Šå°±æ˜¯æŠŠå½“å‰è§£ç éšè—çŠ¶æ€å¤åˆ¶åˆ°å’Œç¼–ç éšè—çŠ¶æ€æ•°ç›¸åŒã€‚\n            query_exp = query.unsqueeze(1).repeat(1, encoder_outputs.size(1), 1)\n            # è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°\n            attn_scores = self.attn(torch.cat((query_exp, encoder_outputs), dim=-1)).squeeze(-1)\n            # è½¬ä¸ºæ³¨æ„åŠ›æƒé‡\n            attn_weights = F.softmax(attn_scores, dim=-1).unsqueeze(1)\n            # è®¡ç®—ä¸Šä¸‹æ–‡å‘é‡ bmm:æ‰¹é‡çŸ©é˜µä¹˜æ³•\n            context = torch.bmm(attn_weights, encoder_outputs).squeeze(1)\n            # å°† query ä¸ä¸Šä¸‹æ–‡å‘é‡èåˆ\n            combined = torch.cat((query, context), dim=1)\n            output = torch.tanh(self.attn_combine(combined))\n        else:\n            # ä¸ä½¿ç”¨æ³¨æ„åŠ›æ—¶ï¼Œç›´æ¥ç”¨ LSTM è¾“å‡ºé¢„æµ‹\n            output = query\n\n        # è¾“å‡ºå±‚\n        output = self.out(output)\n        return output, hidden_cell\n</code></pre>\n<h4 id=\"3æ•´ä½“ç½‘ç»œ\">ï¼ˆ3ï¼‰æ•´ä½“ç½‘ç»œ</h4>\n<pre><code class=\"language-python\">class Seq2Seq(nn.Module):  \n    def __init__(self, encoder, decoder):  \n        super().__init__()  \n        # ç¼–ç å™¨å’Œè§£ç å™¨ç›´æ¥ä½œä¸ºåˆå§‹åŒ–å‚æ•°ï¼Œåœ¨ä¸»å‡½æ•°ä¸­åˆ›å»ºä¼ å…¥\n        self.encoder = encoder  \n        self.decoder = decoder \n         \n    def forward(self, src, tgt):  \n        # src:æ ·æœ¬ tgt:æ ‡ç­¾\n        # ç¼–ç å™¨\n        enc_outputs, (hidden, cell) = self.encoder(src)\n\n        # è¿™é‡Œæ˜¯åˆå¹¶åŒå‘ LSTM çš„ hidden/cell\n        # å°†ä¸¤ä¸ªæ–¹å‘çš„ hidden/cell åœ¨å±‚ç»´åº¦ä¸Šåˆ†å¼€ï¼Œå†æ±‚å’Œæˆ–æ‹¼æ¥ä½œä¸ºè§£ç å™¨åˆå§‹çŠ¶æ€\n        hidden = hidden.view(2, -1, hidden.size(-1)).sum(dim=0, keepdim=True)\n        cell   = cell.view(2, -1, cell.size(-1)).sum(dim=0, keepdim=True)\n        dec_hidden = (hidden, cell)  # è§£ç å™¨åˆå§‹çŠ¶æ€\n\n        outputs = []  # å­˜å‚¨æ¯ä¸ªæ—¶é—´æ­¥çš„è¾“å‡º\n\n        # è§£ç å™¨\n        for t in range(tgt.size(1)):\n            # è®­ç»ƒé€»è¾‘ï¼šæ¯æ­¥ä½¿ç”¨çœŸå®æ ‡ç­¾ä½œä¸ºè¾“å…¥\n            out, dec_hidden = self.decoder(\n                tgt[:, t].unsqueeze(1), dec_hidden, enc_outputs\n            )\n            # tgt[:, t] å› ä¸ºæ‰¹æ¬¡è®­ç»ƒï¼Œæ¯æ¬¡è¦å»å–ç¬¬ t åˆ—\n            # out: å½“å‰æ—¶é—´æ­¥é¢„æµ‹çš„ token æ¦‚ç‡åˆ†å¸ƒ [batch_size, vocab_size]\n            # dec_hidden: æ›´æ–°åçš„è§£ç å™¨éšè—çŠ¶æ€\n            outputs.append(out)  # ä¿å­˜å½“å‰è¾“å‡º\n\n        # å°†æ‰€æœ‰æ—¶é—´æ­¥è¾“å‡ºå †å ä¸ºæœ€ç»ˆç»“æœã€‚\n        return torch.stack(outputs, dim=1)\n\n</code></pre>\n<p>è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†æ¨¡å‹çš„è®¾è®¡ï¼Œç»§ç»­ä¸‹ä¸€éƒ¨åˆ†å†…å®¹ã€‚</p>\n<h2 id=\"23-è§£ç å‡½æ•°\">2.3 è§£ç å‡½æ•°</h2>\n<p>è¿˜æ˜¯ç†è®ºéƒ¨åˆ†æåˆ°çš„ï¼Œåœ¨æ¨ç†é˜¶æ®µï¼Œè§£ç å™¨çš„è¾“å‡ºå…¶å®æ˜¯ä¸€ç³»åˆ—çš„æ¦‚ç‡åˆ†å¸ƒï¼Œæˆ‘ä»¬<strong>ä½¿ç”¨è§£ç å‡½æ•°ï¼Œå°±æ˜¯è®¾è®¡ç›¸åº”çš„æœç´¢ç­–ç•¥æ¥å¯»æ‰¾æœ€å¤§çš„è”åˆæ¦‚ç‡ï¼Œå¾—åˆ°æœ€ç»ˆè¾“å‡ºã€‚</strong><br />\nè¿™é‡Œï¼Œæˆ‘ä»¬å®šä¹‰å®Œæ•´çš„è§£ç å‡½æ•°ï¼Œ<strong>ä¸»é€»è¾‘ä¸ºè´ªå¿ƒè§£ç ï¼Œè¡¥å……æŸæœç´¢çš„ç›¸å…³é€»è¾‘å¹¶é€šè¿‡å‚æ•°é€‰æ‹©æ˜¯å¦ä½¿ç”¨</strong>ï¼š</p>\n<pre><code class=\"language-python\">def decode(model, input_tensor, use_beam_search=False, beam_width=3, max_len=20):\n    \"\"\"\n    å‚æ•°ï¼š\n    - model: å·²è®­ç»ƒçš„ Seq2Seq æ¨¡å‹ï¼ˆåŒ…å« encoder å’Œ decoderï¼‰\n    - input_tensor: è¾“å…¥åºåˆ—çš„ tensorï¼ˆä¸€ä¸ªæ ·æœ¬ï¼‰\n    - use_beam_search: æ˜¯å¦ä½¿ç”¨æŸæœç´¢\n    - beam_width: æŸæœç´¢æ—¶çš„å€™é€‰æ•°é‡\n    - max_len: è§£ç æœ€å¤§é•¿åº¦\n    \"\"\"\n    model.eval()  # è¯„ä¼°æ¨¡å¼\n    with torch.no_grad():  \n        input_tensor = input_tensor.unsqueeze(0) \n        # ç¼–ç å™¨ä¼ æ’­\n        enc_outputs, (hidden, cell) = model.encoder(input_tensor)\n        hidden = hidden.view(2, -1, hidden.size(-1)).sum(dim=0, keepdim=True)\n        cell   = cell.view(2, -1, cell.size(-1)).sum(dim=0, keepdim=True)\n        dec_hidden = (hidden, cell)  # è§£ç å™¨åˆå§‹çŠ¶æ€\n        \n        # è´ªå¿ƒè§£ç \n        if not use_beam_search:\n            # åˆå§‹è§£ç è¾“å…¥ï¼šSOSï¼šåˆå§‹ç¬¦ï¼Œè¿™é‡Œæ˜¯ç®€åŒ–ä¸ºäº† \\t\n            dec_input = torch.tensor([[target_token_index['\\t']]], device=device)\n            result = []\n            for _ in range(max_len):\n                # è§£ç å™¨ä¼ æ’­\n                out, dec_hidden = model.decoder(dec_input, dec_hidden, enc_outputs)\n                # å–å½“å‰æ—¶é—´æ­¥æœ€å¤§æ¦‚ç‡çš„ token\n                pred = out.argmax(dim=-1)\n                token = pred.item()\n                if token == target_token_index['\\n']:  # é‡åˆ° EOS åœæ­¢ï¼ŒåŒæ ·ç®€åŒ–ä¸º\\n\n                    break\n                result.append(reverse_target_char_index[token])  # ä¿å­˜å­—ç¬¦\n                dec_input = pred.unsqueeze(0)  # ä¸‹ä¸€æ­¥è¾“å…¥ä¸ºå½“å‰é¢„æµ‹ï¼Œå³è‡ªå›å½’ã€‚\n\n            return ''.join(result)  # è¿”å›è§£ç åçš„å­—ç¬¦ä¸²\n\n       \n        # æŸæœç´¢\n        candidates = [([target_token_index['\\t']], 0.0, dec_hidden)]  # åˆå§‹åŒ–å€™é€‰åºåˆ—\n        for _ in range(max_len):\n            new_cands = []\n            for seq, score, h in candidates:\n                # å¦‚æœåºåˆ—å·²é‡åˆ° EOSï¼Œä¿ç•™å€™é€‰\n                if seq[-1] == target_token_index['\\n']:\n                    new_cands.append((seq, score, h))\n                    continue\n                # å½“å‰æ—¶é—´æ­¥è¾“å…¥\n                inp = torch.tensor([[seq[-1]]], device=device)\n                out, new_h = model.decoder(inp, h, enc_outputs)\n                # è®¡ç®— log æ¦‚ç‡\n                log_probs = F.log_softmax(out, dim=-1).squeeze(0)\n                # å– top-k å€™é€‰\n                top_vals, top_idx = log_probs.topk(beam_width)\n                for v, idx in zip(top_vals, top_idx):\n                    new_seq = seq + [idx.item()]  # æ‰©å±•åºåˆ—\n                    new_score = score + v.item()  # æ›´æ–°ç´¯ç§¯ log æ¦‚ç‡\n                    new_cands.append((new_seq, new_score, new_h))\n            # æŒ‰ç´¯ç§¯æ¦‚ç‡æ’åºï¼Œä¿ç•™å‰ beam_width ä¸ªåºåˆ—\n            candidates = sorted(new_cands, key=lambda x: x[1], reverse=True)[:beam_width]\n        # æœ€ç»ˆé€‰æ‹©æ¦‚ç‡æœ€é«˜çš„åºåˆ—\n        best = candidates[0][0]\n        # å»æ‰æ§åˆ¶ç¬¦ï¼Œè½¬æ¢ä¸ºæœ€ç»ˆå­—ç¬¦\n        return ''.join(reverse_target_char_index.get(i, '') \n                       for i in best[1:] if i != target_token_index['\\n'])\n\n</code></pre>\n<p>è§£ç çš„é€»è¾‘ä¹Ÿè¢«ä½¿ç”¨åœ¨ä¹‹åçš„è¯„ä¼°ç¯èŠ‚ä¸­ã€‚</p>\n<h2 id=\"24-è¯„ä¼°æŒ‡æ ‡belu-å’Œå®Œå…¨åŒ¹é…ç‡\">2.4 è¯„ä¼°æŒ‡æ ‡ï¼šBELU å’Œå®Œå…¨åŒ¹é…ç‡</h2>\n<p>è‡ªç„¶ï¼Œåœ¨å®Œæˆè®­ç»ƒåï¼Œæˆ‘ä»¬è¦æœ‰ç›¸åº”çš„æŒ‡æ ‡æ¥è¿›è¡Œè¯„ä¼°ï¼Œé¦–å…ˆå°±æ˜¯æˆ‘ä»¬åœ¨ç†è®ºéƒ¨åˆ†ä»‹ç»çš„ BELU ï¼Œå®ƒé€šè¿‡è®¡ç®—è¾“å‡ºå’Œæ ‡ç­¾åœ¨ä¸åŒå°ºåº¦ä¸Šçš„åŒ¹é…åº¦æ¥è¯„ä¼°æ¨¡å‹æ•ˆæœã€‚<br />\nä½†æ˜¯ï¼Œæˆ‘ä»¬è¯´ï¼šBELU è¿™ç±»è¯­è¨€æŒ‡æ ‡ä½¿ç”¨çš„åŸå› æ˜¯å› ä¸ºå­˜åœ¨â€åŒä¹‰ä¸åŒå½¢â€œçš„æƒ…å†µã€‚<br />\nè€Œ<strong>åœ¨æ—¥æœŸç¿»è¯‘é‡Œï¼Œç¿»è¯‘ç»“æœæ˜¯å”¯ä¸€çš„ï¼šé”™ä¸€ä¸ªæ•°å­—å°±æ˜¯å®Œå…¨ä¸åŒçš„ä¸€å¤©ã€‚</strong><br />\nå› æ­¤ï¼Œæˆ‘ä»¬å†æ‰‹å·¥å®šä¹‰ä¸€ä¸ªå®Œå…¨åŒ¹é…ç‡ï¼šè¾“å‡ºå’Œæ ‡ç­¾åªæœ‰ç›¸åŒå’Œä¸ç›¸åŒä¸¤ç§æƒ…å†µã€‚<br />\nè¿™æ ·ï¼Œ<strong>æˆ‘ä»¬ä½¿ç”¨ BELU æ¥è¯„ä¼°åºåˆ—æ¨¡å‹æ‹Ÿåˆçš„å¤§è‡´æ•ˆæœï¼Œå†ç”¨å®Œå…¨åŒ¹é…ç‡æ¥è§‚å¯Ÿåœ¨æ—¥æœŸç¿»è¯‘ä»»åŠ¡ä¸­æ¨¡å‹çš„çœŸæ­£æ€§èƒ½ã€‚</strong></p>\n<pre><code class=\"language-python\">from nltk.translate.bleu_score import sentence_bleu, SmoothingFunction\n# BLEU\ndef evaluate_bleu(model, test_enc_input, test_targets, use_beam_search=False, beam_width=3):\n    total_bleu = 0\n    # BLEU å¹³æ»‘æ–¹æ³•ï¼Œé¿å…çŸ­å¥å¯¼è‡´åˆ†æ•°è¿‡ä½\n    smoother = SmoothingFunction().method4\n\n    for i in range(len(test_enc_input)):\n        # ä½¿ç”¨ decode å‡½æ•°ç”Ÿæˆé¢„æµ‹åºåˆ—\n        pred = decode(model, test_enc_input[i], use_beam_search, beam_width)\n        # å»æ‰ç›®æ ‡åºåˆ—çš„èµ·å§‹ç¬¦å’Œç»“æŸç¬¦\n        true = test_targets[i][1:-1]\n        # BLEU æ¥å—åˆ—è¡¨å½¢å¼ï¼šref æ˜¯å‚è€ƒåºåˆ—åˆ—è¡¨ï¼Œhyp æ˜¯é¢„æµ‹åºåˆ—\n        ref = [list(true)]\n        hyp = list(pred)\n        # è®¡ç®—å½“å‰æ ·æœ¬ BLEU åˆ†æ•°\n        bleu = sentence_bleu(ref, hyp, smoothing_function=smoother)\n        total_bleu += bleu\n\n    # å¹³å‡ BLEU åˆ†æ•°ï¼Œå¹¶è½¬æ¢ä¸ºç™¾åˆ†æ¯”\n    avg_bleu = total_bleu / len(test_enc_input) * 100\n    print(f\"BLEU: {avg_bleu:.2f}\")\n    return avg_bleu\n\n# å®Œå…¨åŒ¹é…ç‡\ndef evaluate_exact_match(model, test_enc_input, test_targets, use_beam_search=False, beam_width=3):\n    correct = 0\n    total = len(test_enc_input)\n    for i in range(total):\n        pred = decode(model, test_enc_input[i], use_beam_search, beam_width)\n        true = test_targets[i][1:-1]\n        # åˆ¤æ–­é¢„æµ‹ä¸çœŸå®æ˜¯å¦å®Œå…¨ä¸€è‡´\n        if pred == true:\n            correct += 1\n    acc = correct / total * 100\n    print(f\"å®Œå…¨åŒ¹é…ç‡: {acc:.2f}%\")\n    return acc\n\n</code></pre>\n<p><strong>è¿™é‡Œåˆ†å¼€å†™ä¸¤ä¸ªæŒ‡æ ‡æ–¹ä¾¿æ¼”ç¤ºå’Œå•ç‹¬è°ƒç”¨ï¼Œå®é™…ä¸Šï¼ŒæŠŠäºŒè€…çš„å‰åŠéƒ¨åˆ†é€»è¾‘åˆåœ¨ä¸€èµ·æ˜¯æ›´é«˜æ•ˆçš„åšæ³•ã€‚</strong><br />\nåˆ°æ­¤ï¼Œéœ€è¦å¼ºè°ƒçš„éƒ¨åˆ†å°±å…¨éƒ¨å®šä¹‰å®Œæ¯•ï¼Œæˆ‘ä»¬å¼€å§‹æ­£å¼è¿è¡Œã€‚</p>\n<h2 id=\"25-è¿è¡Œæ•ˆæœ\">2.5 è¿è¡Œæ•ˆæœ</h2>\n<p>æˆ‘ä»¬è®¾ç½®å‚æ•°å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\">EMB_DIM = 64  \nHIDDEN_DIM = 256  \nEPOCHS = 10  \nBATCH_SIZE = 128  \nLR = 0.001\n</code></pre>\n<p>ä¸‹é¢ï¼Œå°±æ¥åˆ†æƒ…å†µçœ‹çœ‹æ•ˆæœï¼š</p>\n<h4 id=\"1ä¸ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶ä½¿ç”¨è´ªå¿ƒè§£ç \">ï¼ˆ1ï¼‰ä¸ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶ï¼Œä½¿ç”¨è´ªå¿ƒè§£ç </h4>\n<p>åœ¨è¿™ä¸ªæ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬å®šä¹‰ä¸»å‡½æ•°å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\">if __name__ == \"__main__\":  \n\tEMB_DIM = 64  \n\tHIDDEN_DIM = 256  \n\tEPOCHS = 10  \n\tBATCH_SIZE = 128  \n\tLR = 0.001\n\t# å…³é”®è®¾ç½®\n    USE_ATTENTION    = False  \n    USE_BEAM_SEARCH  = False  \n    BEAM_WIDTH       = 3  \n  \n    print(f\"\\n=== é…ç½® ===\")  \n    print(f\"ä½¿ç”¨æ³¨æ„åŠ›: {USE_ATTENTION}\")  \n    print(f\"ä½¿ç”¨æŸæœç´¢: {USE_BEAM_SEARCH} (beam width = {BEAM_WIDTH if USE_BEAM_SEARCH else 'No'})\")  \n  \n    encoder = Encoder(num_encoder_tokens, EMB_DIM, HIDDEN_DIM).to(device)  \n    decoder = Decoder(num_decoder_tokens, EMB_DIM, HIDDEN_DIM, use_attention=USE_ATTENTION).to(device)  \n    model = Seq2Seq(encoder, decoder).to(device)  \n  \n    print(\"\\nå¼€å§‹è®­ç»ƒ...\")  \n    train_time = train(model, epochs=EPOCHS, batch_size=BATCH_SIZE, lr=LR)  \n  \n    print(\"\\nè¯„ä¼°ä¸­...\")  \n    bleu = evaluate_bleu(model, test_encoder_input, test_targets,  \n                         use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  \n    exact_acc = evaluate_exact_match(model, test_encoder_input, test_targets,  \n                                     use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  \n  \n\tprint(\"\\n=== æŠ½å–æµ‹è¯•æ ·æœ¬è¾“å‡º ===\")  \n\tsample_indices = random.sample(range(len(test_encoder_input)), 10)  \n\tfor i in sample_indices:  \n\t    src = test_inputs[i]  \n\t    true = test_targets[i][1:-1]  \n\t    pred,_ = decode(model, test_encoder_input[i],  \n\t                  use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  \n\t    print(f\"Human  : {src} | True  : {true} | Predicted  : {pred}\")\n</code></pre>\n<p>ç»“æœå¦‚ä¸‹ï¼š<br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260205162800621-1772145123.png\" /></p>\n<p>å¾—ç›Šäºä»»åŠ¡æœ¬èº«å’Œåˆæˆæ•°æ®è¾ƒä¸ºç®€å•ï¼Œå¯ä»¥å‘ç°æŒ‡æ ‡è¿˜ä¸é”™ï¼Œæˆ‘ä»¬ä¸ç€æ€¥åˆ†æ ï¼Œç»§ç»­ä¸‹ä¸€æ­¥è®¾ç½®è¿›è¡Œå¯¹æ¯”ã€‚</p>\n<h4 id=\"2ä¸ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶ä½¿ç”¨æŸæœç´¢\">ï¼ˆ2ï¼‰ä¸ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶ï¼Œä½¿ç”¨æŸæœç´¢</h4>\n<p>è¿™æ¬¡ï¼Œè®¾ç½®ä¸»å‡½æ•°å‚æ•°å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\">USE_ATTENTION    = False  \nUSE_BEAM_SEARCH  = True # ä½¿ç”¨æŸæœç´¢ \nBEAM_WIDTH       = 3 # æŸå®½\n</code></pre>\n<p>çœ‹çœ‹ç»“æœï¼š<br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260205162801820-1581242608.png\" /></p>\n<p>æŒ‡æ ‡å¥½åƒæœ‰æ‰€æå‡ï¼Œä½†ä¹Ÿå¯èƒ½æ˜¯è®­ç»ƒä¸­çš„å¶ç„¶æ€§ï¼Œæˆ‘ä»¬å†å¢åŠ æŸå®½çœ‹çœ‹ï¼š</p>\n<pre><code class=\"language-python\">BEAM_WIDTH       = 10 \n</code></pre>\n<p><img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260205162800857-1336184228.png\" /><br />\nå¯ä»¥å‘ç°ï¼Œ<strong>éšç€æŸå®½çš„å¢åŠ ï¼Œè§£ç æ—¶é—´æ˜æ˜¾å¢åŠ ï¼Œè€ŒæŒ‡æ ‡æµ®åŠ¨ä¸å¤§</strong>ï¼Œè¿™è¯´æ˜é™åˆ¶æŒ‡æ ‡çš„å…³é”®å› ç´ å¯èƒ½ä¸æ˜¯æœç´¢ç­–ç•¥ã€‚<br />\nç”±æ­¤ï¼Œæˆ‘ä»¬è¿›å…¥ä¸‹ä¸€æ­¥ï¼š</p>\n<h4 id=\"3ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶\">ï¼ˆ3ï¼‰ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶</h4>\n<p>ç°åœ¨ï¼Œè®¾ç½®å‚æ•°å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\">USE_ATTENTION    = True # ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶  \nUSE_BEAM_SEARCH  = True  \nBEAM_WIDTH       = 3 \n</code></pre>\n<p>çœ‹çœ‹ç»“æœï¼š<br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260205162800597-1996349670.png\" /></p>\n<p>å¥½åƒä¹Ÿæ²¡ä»€ä¹ˆç”¨å•Šï¼Ÿ ä½ ä¼šå‘ç°ï¼š<strong>ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶åï¼Œè®­ç»ƒæ—¶é—´å› ç›¸å…³è®¡ç®—æ˜æ˜¾å¢åŠ ï¼Œä½†æ˜¯æŒ‡æ ‡å¹¶æ²¡æœ‰æ˜æ˜¾æå‡ã€‚</strong><br />\nå®é™…ä¸Šï¼Œè¿™å’Œæˆ‘ä»¬çš„æ—¥æœŸç¿»è¯‘ä»»åŠ¡æœ¬èº«çš„ç‰¹ç‚¹æœ‰å…³ï¼š</p>\n<ol>\n<li><strong>è¾“å…¥è¾“å‡ºåºåˆ—è¾ƒçŸ­</strong>ï¼šæ¯ä¸ªæ ·æœ¬é€šå¸¸åªæœ‰ 5~15 ä¸ªå­—ç¬¦å·¦å³ï¼ŒLSTM å¾ˆå®¹æ˜“åœ¨æ²¡æœ‰æ³¨æ„åŠ›çš„æƒ…å†µä¸‹å°±æ•æ‰åˆ°åºåˆ—æ•´ä½“ä¿¡æ¯ã€‚</li>\n<li><strong>ä¿¡æ¯å¯¹é½è¾ƒç®€å•</strong>ï¼šæ—¥æœŸç¿»è¯‘æœ¬è´¨ä¸Šæ˜¯å­—ç¬¦çº§çš„å¯¹é½æ˜ å°„ï¼Œä¾‹å¦‚ â€œJan 5, 2003â€ â†’ â€œ2003-01-05â€ï¼Œå‡ ä¹ä¸å­˜åœ¨å¤æ‚çš„é•¿è·ç¦»ä¾èµ–ã€‚</li>\n</ol>\n<p>æ³¨æ„åŠ›æœºåˆ¶æœ€æ˜æ˜¾çš„ä½œç”¨æ˜¯åœ¨åºåˆ—è¾ƒé•¿æˆ–è¾“å…¥è¾“å‡ºå…³ç³»å¤æ‚æ—¶ï¼Œå¸®åŠ©è§£ç å™¨èšç„¦åˆ°ç›¸å…³çš„ç¼–ç çŠ¶æ€ã€‚è€Œå¯¹äºç°åœ¨è¿™ç§çŸ­åºåˆ—ã€è§„åˆ™æ€§å¼ºçš„ä»»åŠ¡ï¼Œå…¶è®¡ç®—æˆæœ¬å¢åŠ ï¼Œè€Œå¸¦æ¥çš„æ€§èƒ½æå‡å¾ˆæœ‰é™ã€‚</p>\n<p>åœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæƒ³è¦æŒ‡æ ‡ç»§ç»­å¢åŠ ï¼Œæœ‰ä¸€ä¸ªå¾ˆç®€å•çš„æ–¹æ³•å°±æ˜¯<strong>åœ¨è„šæœ¬ä¸­å¢åŠ æˆ‘ä»¬äººå·¥åˆæˆçš„æ•°æ®é‡</strong>ï¼Œå°±ä¸å†å±•ç¤ºäº†ã€‚</p>\n<p><strong>è‡³æ­¤ï¼Œå´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨‹äº”è¯¾åäº”å‘¨çš„å†…å®¹å°±å…¨éƒ¨ç»“æŸäº†ï¼Œä¹‹åä¼šå‡ºä¸€ä¸ªå®Œæ•´çš„ç›®å½•ã€‚</strong></p>\n<h1 id=\"3-é™„å½•\">3. é™„å½•</h1>\n<h2 id=\"31-æ•°æ®åˆæˆ\">3.1 æ•°æ®åˆæˆ</h2>\n<pre><code class=\"language-python\">import torch\nimport random\nimport numpy as np\nfrom datetime import datetime, timedelta\nfrom sklearn.model_selection import train_test_split\n\ndevice = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\nPAD_TOKEN = \"&lt;PAD&gt;\"\n\nMONTHS_FULL = [\n    \"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n    \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"\n]\nMONTHS_ABBR = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\n               \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\n\nHUMAN_TEMPLATES = [\n    \"{day} {month} {year}\",\n    \"{month} {day}, {year}\",\n    \"{day} of {month}, {year}\",\n    \"{month} {day} {year}\",\n    \"{day}/{month_num}/{year_short}\",\n    \"{month_num}/{day}/{year_short}\",\n    \"{weekday}, {day} {month_abbr} {year}\",\n    \"{month_abbr} {day}th {year_short}\",\n    \"{year}-{month_num}-{day}\",\n    \"The {day}{day_suffix} of {month}, {year}\",\n    \"{day}th {month_abbr}, {year}\",\n    \"{month} the {day}{day_suffix}, {year}\",\n    \"Date: {year}/{month_num}/{day}\",\n    \"{day} in Roman: {roman_day} {month} {year}\",\n    \"{month_abbr}. {day}, '{year_short}\",\n]\n\ndef roman_numeral(n):\n    vals = (10, 9, 5, 4, 1)\n    nums = ('X', 'IX', 'V', 'IV', 'I')\n    result = \"\"\n    for v, r in zip(vals, nums):\n        while n &gt;= v:\n            result += r\n            n -= v\n    return result\n\ndef random_date(start_year=1900, end_year=2100):\n    start = datetime(start_year, 1, 1)\n    end = datetime(end_year, 12, 31)\n    delta = end - start\n    return start + timedelta(days=random.randint(0, delta.days))\n\ndef human_readable_date(date):\n    template = random.choice(HUMAN_TEMPLATES)\n    day = date.day\n    month_idx = date.month - 1\n    month_full = MONTHS_FULL[month_idx]\n    month_abbr = MONTHS_ABBR[month_idx]\n    year = date.year\n    month_num = str(date.month).zfill(2)\n    year_short = str(year % 100).zfill(2)\n    weekday = date.strftime(\"%A\")\n\n    day_suffix = \"th\"\n    if day % 10 == 1 and day != 11: day_suffix = \"st\"\n    elif day % 10 == 2 and day != 12: day_suffix = \"nd\"\n    elif day % 10 == 3 and day != 13: day_suffix = \"rd\"\n\n    day_str = str(day)\n    roman_day = roman_numeral(day) if random.random() &lt; 0.2 else day_str\n\n    return template.format(\n        day=day_str,\n        day_suffix=day_suffix,\n        month=month_full,\n        month_abbr=month_abbr,\n        year=year,\n        month_num=month_num,\n        year_short=year_short,\n        weekday=weekday,\n        roman_day=roman_day\n    )\n\ndef machine_readable_date(date):\n    return date.strftime(\"%Y-%m-%d\")\n\ndef generate_date_pair():\n    d = random_date()\n    return human_readable_date(d), machine_readable_date(d)\n\n\nNUM_SAMPLES = 10000\ninput_texts, target_texts = [], []\n\nfor _ in range(NUM_SAMPLES):\n    human, machine = generate_date_pair()\n    input_texts.append(human)\n    target_texts.append('\\t' + machine + '\\n')\n\ntrain_inputs, test_inputs, train_targets, test_targets = train_test_split(\n    input_texts, target_texts, test_size=0.2, random_state=42\n)\n\nall_input_chars = [PAD_TOKEN] + sorted(set(''.join(input_texts)))\nall_target_chars = [PAD_TOKEN] + sorted(set(''.join(target_texts)))\n\ninput_token_index = {c: i for i, c in enumerate(all_input_chars)}\ntarget_token_index = {c: i for i, c in enumerate(all_target_chars)}\n\nreverse_input_char_index = {i: c for c, i in input_token_index.items()}\nreverse_target_char_index = {i: c for c, i in target_token_index.items()}\n\nmax_encoder_len = max(len(txt) for txt in input_texts)\nmax_decoder_len = max(len(txt) for txt in target_texts)\n\nnum_encoder_tokens = len(all_input_chars)\nnum_decoder_tokens = len(all_target_chars)\n\nprint(f\"max enc len: {max_encoder_len}, max dec len: {max_decoder_len}\")\nprint(f\"input vocab size: {num_encoder_tokens}, target vocab size: {num_decoder_tokens}\")\n\ndef texts_to_tensor(texts, token_index, max_len):\n    pad_idx = token_index[PAD_TOKEN]\n    data = np.full((len(texts), max_len), pad_idx, dtype=np.int64)\n    for i, txt in enumerate(texts):\n        for t, char in enumerate(txt):\n            if t &lt; max_len:\n                data[i, t] = token_index[char]\n    return torch.tensor(data, dtype=torch.long, device=device)\n\ntrain_encoder_input = texts_to_tensor(train_inputs, input_token_index, max_encoder_len)\ntrain_decoder_input = texts_to_tensor(train_targets, target_token_index, max_decoder_len)\n\ntest_encoder_input = texts_to_tensor(test_inputs, input_token_index, max_encoder_len)\ntest_decoder_input = texts_to_tensor(test_targets, target_token_index, max_decoder_len)\n\n\ndataset_pt = {\n    'train_encoder_input': train_encoder_input,\n    'train_decoder_input': train_decoder_input,\n    'test_encoder_input': test_encoder_input,\n    'test_decoder_input': test_decoder_input,\n    'input_token_index': input_token_index,\n    'target_token_index': target_token_index,\n    'reverse_input_char_index': reverse_input_char_index,\n    'reverse_target_char_index': reverse_target_char_index,\n    'max_encoder_len': max_encoder_len,\n    'max_decoder_len': max_decoder_len,\n    'num_encoder_tokens': num_encoder_tokens,\n    'num_decoder_tokens': num_decoder_tokens\n}\n\ntorch.save(dataset_pt, \"date_dataset.pt\")\nprint(\"å·²ä¿å­˜ï¼šdate_dataset.pt\")\n\n\n\ndef tensor_to_numpy(t):\n    return t.detach().cpu().numpy()\n\ndataset_npz = {\n    \"train_encoder_input\": tensor_to_numpy(train_encoder_input),\n    \"train_decoder_input\": tensor_to_numpy(train_decoder_input),\n    \"test_encoder_input\": tensor_to_numpy(test_encoder_input),\n    \"test_decoder_input\": tensor_to_numpy(test_decoder_input),\n\n    \"input_token_index\": np.array(input_token_index, dtype=object),\n    \"target_token_index\": np.array(target_token_index, dtype=object),\n    \"reverse_input_char_index\": np.array(reverse_input_char_index, dtype=object),\n    \"reverse_target_char_index\": np.array(reverse_target_char_index, dtype=object),\n\n    \"max_encoder_len\": max_encoder_len,\n    \"max_decoder_len\": max_decoder_len,\n    \"num_encoder_tokens\": num_encoder_tokens,\n    \"num_decoder_tokens\": num_decoder_tokens\n}\n\nnp.savez(\"date_dataset.npz\", **dataset_npz)\nprint(\"å·²ä¿å­˜ï¼šdate_dataset.npz\\n\")\n\ndef decode(tensor_row, reverse_dict):\n    return ''.join(\n        reverse_dict[idx.item()]\n        for idx in tensor_row\n        if reverse_dict[idx.item()] != PAD_TOKEN\n    )\n\nprint(\"ç¤ºä¾‹æ•°æ®ï¼š\")\nfor i in range(20):\n    src = decode(train_encoder_input[i], reverse_input_char_index)\n    tgt = decode(train_decoder_input[i], reverse_target_char_index)\n    print(f\"[{i+1}] {src}  ==&gt;  {tgt.strip()}\")\n</code></pre>\n<h2 id=\"32-æ—¥æœŸæ ¼å¼ç¿»è¯‘-pytorchç‰ˆ\">3.2 æ—¥æœŸæ ¼å¼ç¿»è¯‘-PyTorchç‰ˆ</h2>\n<pre><code class=\"language-python\">import random  \nimport torch  \nimport torch.nn as nn  \nimport torch.nn.functional as F  \nfrom torch import optim  \nimport time  \nfrom nltk.translate.bleu_score import sentence_bleu, SmoothingFunction  \ndevice = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")  \n  \ndata = torch.load(\"date_dataset.pt\", map_location=device)  \n  \ntrain_encoder_input = data['train_encoder_input']  \ntrain_decoder_input = data['train_decoder_input']  \ntest_encoder_input  = data['test_encoder_input']  \ntest_decoder_input  = data['test_decoder_input']  \n  \ninput_token_index = data['input_token_index']  \ntarget_token_index = data['target_token_index']  \nreverse_target_char_index = data['reverse_target_char_index']  \n  \nnum_encoder_tokens = data['num_encoder_tokens']  \nnum_decoder_tokens = data['num_decoder_tokens']  \n  \nmax_encoder_len = data['max_encoder_len']  \nmax_decoder_len = data['max_decoder_len']  \n  \nPAD_TOKEN = \"&lt;PAD&gt;\"  \nreverse_input_char_index = {i: c for c, i in input_token_index.items()}  \n  \ndef tensor_to_text(tensor_row, reverse_dict):  \n    return ''.join(  \n        reverse_dict[idx.item()]  \n        for idx in tensor_row  \n        if reverse_dict[idx.item()] != PAD_TOKEN  \n    )  \n  \ntest_inputs = [tensor_to_text(test_encoder_input[i], reverse_input_char_index)  \n               for i in range(len(test_encoder_input))]  \n  \ntest_targets = [tensor_to_text(test_decoder_input[i], reverse_target_char_index)  \n                for i in range(len(test_decoder_input))]  \n  \nclass Encoder(nn.Module):  \n    def __init__(self, vocab_size, emb_dim, hidden_dim):  \n        super().__init__()  \n        self.embedding = nn.Embedding(vocab_size, emb_dim)  \n        self.lstm = nn.LSTM(emb_dim, hidden_dim, batch_first=True, bidirectional=True)  \n  \n    def forward(self, x):  \n        embedded = self.embedding(x)  \n        outputs, (hidden, cell) = self.lstm(embedded)  \n        return outputs, (hidden, cell)  \n  \nclass Decoder(nn.Module):  \n    def __init__(self, vocab_size, emb_dim, hidden_dim, use_attention=False):  \n        super().__init__()  \n        self.use_attention = use_attention  \n        self.embedding = nn.Embedding(vocab_size, emb_dim)  \n        self.lstm = nn.LSTM(emb_dim, hidden_dim, batch_first=True)  \n  \n        if use_attention:  \n            self.attn = nn.Linear(hidden_dim + hidden_dim * 2, 1)  \n            self.attn_combine = nn.Linear(hidden_dim + hidden_dim * 2, hidden_dim)  \n  \n        self.out = nn.Linear(hidden_dim, vocab_size)  \n  \n    def forward(self, input_step, hidden_cell, encoder_outputs):  \n        embedded = self.embedding(input_step)  \n        lstm_out, hidden_cell = self.lstm(embedded, hidden_cell)  \n  \n        query = lstm_out.squeeze(1)  \n  \n        if self.use_attention:  \n            query_exp = query.unsqueeze(1).repeat(1, encoder_outputs.size(1), 1)  \n            attn_scores = self.attn(torch.cat((query_exp, encoder_outputs), dim=-1)).squeeze(-1)  \n            attn_weights = F.softmax(attn_scores, dim=-1).unsqueeze(1)  \n            context = torch.bmm(attn_weights, encoder_outputs).squeeze(1)  \n            combined = torch.cat((query, context), dim=1)  \n            output = torch.tanh(self.attn_combine(combined))  \n        else:  \n            output = query  \n  \n        output = self.out(output)  \n        return output, hidden_cell  \n  \nclass Seq2Seq(nn.Module):  \n    def __init__(self, encoder, decoder):  \n        super().__init__()  \n        self.encoder = encoder  \n        self.decoder = decoder  \n  \n    def forward(self, src, tgt):  \n        enc_outputs, (hidden, cell) = self.encoder(src)  \n        hidden = hidden.view(2, -1, hidden.size(-1)).sum(dim=0, keepdim=True)  \n        cell   = cell.view(2, -1, cell.size(-1)).sum(dim=0, keepdim=True)  \n        dec_hidden = (hidden, cell)  \n        outputs = []  \n  \n        for t in range(tgt.size(1)):  \n            out, dec_hidden = self.decoder(tgt[:, t].unsqueeze(1), dec_hidden, enc_outputs)  \n            outputs.append(out)  \n  \n        return torch.stack(outputs, dim=1)  \n  \ndef train(model, epochs=10, batch_size=128, lr=0.001):  \n    enc_optimizer = optim.Adam(model.encoder.parameters(), lr=lr)  \n    dec_optimizer = optim.Adam(model.decoder.parameters(), lr=lr)  \n    criterion = nn.CrossEntropyLoss(ignore_index=0)  \n  \n    start_time = time.time()  \n  \n    for epoch in range(epochs):  \n        total_loss = 0  \n        num_batches = 0  \n        perm = torch.randperm(len(train_encoder_input))  \n        for i in range(0, len(train_encoder_input), batch_size):  \n            idx = perm[i:i+batch_size]  \n            enc_in = train_encoder_input[idx]  \n            dec_in_full = train_decoder_input[idx]  \n            dec_in = dec_in_full[:, :-1]  \n            dec_target = dec_in_full[:, 1:]  \n  \n            enc_optimizer.zero_grad()  \n            dec_optimizer.zero_grad()  \n  \n            outputs = model(enc_in, dec_in)  \n  \n            loss = criterion(outputs.reshape(-1, num_decoder_tokens), dec_target.reshape(-1))  \n            loss.backward()  \n            enc_optimizer.step()  \n            dec_optimizer.step()  \n  \n            total_loss += loss.item()  \n            num_batches += 1  \n  \n        avg_loss = total_loss / num_batches  \n        print(f\"Epoch [{epoch+1}/{epochs}], Loss: {avg_loss:.4f}\")  \n  \n    train_time = time.time() - start_time  \n    print(f\"è®­ç»ƒæ€»æ—¶é—´: {train_time:.2f} ç§’\")  \n    return train_time  \n  \nimport time  \n  \ndef decode(model, input_tensor, use_beam_search=False, beam_width=3, max_len=20):  \n    model.eval()  \n    start_time = time.time()    \n    with torch.no_grad():  \n        input_tensor = input_tensor.unsqueeze(0)  \n        enc_outputs, (hidden, cell) = model.encoder(input_tensor)  \n        hidden = hidden.view(2, -1, hidden.size(-1)).sum(dim=0, keepdim=True)  \n        cell   = cell.view(2, -1, cell.size(-1)).sum(dim=0, keepdim=True)  \n        dec_hidden = (hidden, cell)  \n  \n        if not use_beam_search:  \n            dec_input = torch.tensor([[target_token_index['\\t']]], device=device)  \n            result = []  \n            for _ in range(max_len):  \n                out, dec_hidden = model.decoder(dec_input, dec_hidden, enc_outputs)  \n                pred = out.argmax(dim=-1)  \n                token = pred.item()  \n                if token == target_token_index['\\n']:  \n                    break  \n                result.append(reverse_target_char_index[token])  \n                dec_input = pred.unsqueeze(0)  \n            decoded = ''.join(result)  \n  \n        else:  \n            candidates = [([target_token_index['\\t']], 0.0, dec_hidden)]  \n            for _ in range(max_len):  \n                new_cands = []  \n                for seq, score, h in candidates:  \n                    if seq[-1] == target_token_index['\\n']:  \n                        new_cands.append((seq, score, h))  \n                        continue  \n                    inp = torch.tensor([[seq[-1]]], device=device)  \n                    out, new_h = model.decoder(inp, h, enc_outputs)  \n                    log_probs = F.log_softmax(out, dim=-1).squeeze(0)  \n                    k = min(beam_width, log_probs.size(0))    \n                    top_vals, top_idx = log_probs.topk(k)  \n                    for v, idx in zip(top_vals, top_idx):  \n                        new_seq = seq + [idx.item()]  \n                        new_score = score + v.item()  \n                        new_cands.append((new_seq, new_score, new_h))  \n                candidates = sorted(new_cands, key=lambda x: x[1], reverse=True)[:beam_width]  \n  \n            best = candidates[0][0]  \n            decoded = ''.join(reverse_target_char_index.get(i, '') for i in best[1:] if i != target_token_index['\\n'])  \n  \n    decode_time = time.time() - start_time  \n    return decoded, decode_time  \n  \n  \ndef evaluate_bleu(model, test_enc_input, test_targets, use_beam_search=False, beam_width=3):  \n    total_bleu = 0  \n    total_time = 0  \n    smoother = SmoothingFunction().method4  \n  \n    for i in range(len(test_enc_input)):  \n        pred, dt = decode(model, test_enc_input[i], use_beam_search, beam_width)  \n        total_time += dt  \n        true = test_targets[i][1:-1]  \n        ref = [list(true)]  \n        hyp = list(pred)  \n        bleu = sentence_bleu(ref, hyp, smoothing_function=smoother)  \n        total_bleu += bleu  \n  \n    avg_bleu = total_bleu / len(test_enc_input) * 100  \n    avg_time = total_time / len(test_enc_input)  \n    print(f\"BLEU: {avg_bleu:.2f} | å¹³å‡è§£ç æ—¶é—´: {avg_time:.4f} ç§’/æ ·æœ¬\")  \n    return avg_bleu, avg_time  \n  \n  \ndef evaluate_exact_match(model, test_enc_input, test_targets, use_beam_search=False, beam_width=3):  \n    correct = 0  \n    total = len(test_enc_input)  \n  \n    for i in range(total):  \n        pred, _ = decode(model, test_enc_input[i], use_beam_search, beam_width)    \n        true = test_targets[i][1:-1]    \n        if pred == true:  \n            correct += 1  \n  \n    acc = correct / total * 100  \n    print(f\"å®Œå…¨åŒ¹é…ç‡: {acc:.2f}%\")  \n    return acc  \n  \nif __name__ == \"__main__\":  \n    EMB_DIM = 64  \n    HIDDEN_DIM = 256  \n    EPOCHS = 10  \n    BATCH_SIZE = 128  \n    LR = 0.001  \n  \n    USE_ATTENTION    = True  \n    USE_BEAM_SEARCH  = True  \n    BEAM_WIDTH       = 3  \n  \n    print(f\"\\n=== é…ç½® ===\")  \n    print(f\"ä½¿ç”¨æ³¨æ„åŠ›: {USE_ATTENTION}\")  \n    print(f\"ä½¿ç”¨æŸæœç´¢: {USE_BEAM_SEARCH} (beam width = {BEAM_WIDTH if USE_BEAM_SEARCH else 'No'})\")  \n  \n    encoder = Encoder(num_encoder_tokens, EMB_DIM, HIDDEN_DIM).to(device)  \n    decoder = Decoder(num_decoder_tokens, EMB_DIM, HIDDEN_DIM, use_attention=USE_ATTENTION).to(device)  \n    model = Seq2Seq(encoder, decoder).to(device)  \n  \n    print(\"\\nå¼€å§‹è®­ç»ƒ...\")  \n    train_time = train(model, epochs=EPOCHS, batch_size=BATCH_SIZE, lr=LR)  \n  \n    print(\"\\nè¯„ä¼°ä¸­...\")  \n    bleu = evaluate_bleu(model, test_encoder_input, test_targets,  \n                         use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  \n    exact_acc = evaluate_exact_match(model, test_encoder_input, test_targets,  \n                                     use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  \n  \n    print(\"\\n=== æŠ½å–æµ‹è¯•æ ·æœ¬è¾“å‡º ===\")  \n    sample_indices = random.sample(range(len(test_encoder_input)), 10)  \n    for i in sample_indices:  \n        src = test_inputs[i]  \n        true = test_targets[i][1:-1]  \n        pred,_ = decode(model, test_encoder_input[i],  \n                      use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  \n        print(f\"Human  : {src} | True  : {true} | Predicted  : {pred}\")\n</code></pre>\n<h2 id=\"33-æ—¥æœŸæ ¼å¼ç¿»è¯‘-tfç‰ˆ\">3.3 æ—¥æœŸæ ¼å¼ç¿»è¯‘-TFç‰ˆ</h2>\n<pre><code class=\"language-python\">import numpy as np  \nimport tensorflow as tf  \nfrom tensorflow.keras.layers import Embedding, LSTM, Dense, Bidirectional  \nimport random  \nimport time  \nfrom nltk.translate.bleu_score import sentence_bleu, SmoothingFunction  \n  \ndataset = np.load(\"date_dataset.npz\", allow_pickle=True)  \n  \ntrain_encoder_input = dataset['train_encoder_input']  \ntrain_decoder_input = dataset['train_decoder_input']  \ntest_encoder_input = dataset['test_encoder_input']  \ntest_decoder_input = dataset['test_decoder_input']  \n  \ninput_token_index = dataset['input_token_index'].item()  \ntarget_token_index = dataset['target_token_index'].item()  \nreverse_target_char_index = dataset['reverse_target_char_index'].item()  \n  \nnum_encoder_tokens = int(dataset['num_encoder_tokens'])  \nnum_decoder_tokens = int(dataset['num_decoder_tokens'])  \nmax_encoder_len = int(dataset['max_encoder_len'])  \nmax_decoder_len = int(dataset['max_decoder_len'])  \n  \nreverse_input_char_index = {i: c for c, i in input_token_index.items()}  \n  \nPAD_TOKEN = \"&lt;PAD&gt;\"    \n  \ndef tensor_to_text(tensor_row, reverse_dict):  \n    return ''.join(  \n        reverse_dict.get(int(idx), '')  \n        for idx in tensor_row  \n        if reverse_dict.get(int(idx), '') != PAD_TOKEN  \n    )  \n  \n  \ntest_inputs = [tensor_to_text(test_encoder_input[i], reverse_input_char_index)  \n               for i in range(len(test_encoder_input))]  \n  \ntest_targets = [tensor_to_text(test_decoder_input[i], reverse_target_char_index)  \n                for i in range(len(test_decoder_input))]  \n  \nclass Encoder(tf.keras.Model):  \n    def __init__(self, vocab_size, emb_dim, hidden_dim):  \n        super(Encoder, self).__init__()  \n        self.embedding = Embedding(vocab_size, emb_dim, mask_zero=True)  \n        self.lstm = Bidirectional(  \n            LSTM(hidden_dim, return_sequences=True, return_state=True)  \n        )  \n  \n    def call(self, x):  \n        embedded = self.embedding(x)  \n        outputs, fw_h, fw_c, bw_h, bw_c = self.lstm(embedded)  \n        hidden = tf.concat([fw_h, bw_h], axis=-1)  \n        cell = tf.concat([fw_c, bw_c], axis=-1)  \n        return outputs, (hidden, cell)  \n  \n  \nclass Decoder(tf.keras.layers.Layer):  \n    def __init__(self, vocab_size, emb_dim, hidden_dim, use_attention=False):  \n        super(Decoder, self).__init__()  \n        self.use_attention = use_attention  \n        self.embedding = Embedding(vocab_size, emb_dim, mask_zero=True)  \n        self.lstm = LSTM(hidden_dim, return_sequences=False, return_state=True)  \n        self.out = Dense(vocab_size)  \n  \n        if use_attention:  \n            self.attn_W1 = Dense(hidden_dim)                 \n            self.attn_W2 = Dense(hidden_dim)               \n            self.attn_V  = Dense(1)  \n            self.attn_combine = Dense(hidden_dim)  \n  \n    def call(self, input_step, hidden_cell, encoder_outputs):  \n   \n        embedded = self.embedding(input_step)            \n        lstm_out, h, c = self.lstm(embedded, initial_state=hidden_cell)  \n        query = lstm_out                                  \nif self.use_attention:  \n            score = self.attn_V(  \n                tf.tanh(  \n                    self.attn_W1(encoder_outputs) +  \n                    self.attn_W2(query[:, tf.newaxis, :])  \n                )  \n            )                                             \n  \n            attn_weights = tf.nn.softmax(score, axis=1)   \n  \n            context = tf.reduce_sum(encoder_outputs * attn_weights, axis=1)  \n            combined = tf.concat([query, context], axis=-1)  \n            output = tf.tanh(self.attn_combine(combined))  \n        else:  \n            output = query  \n  \n        logits = self.out(output)                         \n        return logits, (h, c)  \n  \n  \nclass Seq2Seq(tf.keras.Model):  \n    def __init__(self, encoder, decoder):  \n        super(Seq2Seq, self).__init__()  \n        self.encoder = encoder  \n        self.decoder = decoder  \n  \n    def call(self, src, tgt, training=True):  \n        enc_outputs, (hidden, cell) = self.encoder(src)  \n  \n        hidden_fw, hidden_bw = tf.split(hidden, num_or_size_splits=2, axis=-1)  \n        cell_fw, cell_bw = tf.split(cell, num_or_size_splits=2, axis=-1)  \n  \n        hidden = hidden_fw + hidden_bw  \n        cell = cell_fw + cell_bw  \n  \n        dec_hidden = (hidden, cell)  \n  \n        outputs = []  \n        for t in range(tgt.shape[1]):  \n            step_input = tgt[:, t:t + 1]  \n            logits, dec_hidden = self.decoder(  \n                step_input, dec_hidden, enc_outputs  \n            )  \n            outputs.append(logits)  \n  \n        return tf.stack(outputs, axis=1)  \n  \ndef train(model, epochs=10, batch_size=128, lr=0.001):  \n    optimizer = tf.keras.optimizers.Adam(learning_rate=lr)  \n    loss_fn = tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True)  \n  \n    start_time = time.time()  \n    n_samples = len(train_encoder_input)  \n  \n    for epoch in range(epochs):  \n        total_loss = 0.0  \n        num_batches = 0  \n  \n        indices = np.random.permutation(n_samples)  \n        enc = train_encoder_input[indices]  \n        dec = train_decoder_input[indices]  \n  \n        for i in range(0, n_samples, batch_size):  \n            enc_batch = enc[i:i + batch_size]  \n            dec_batch = dec[i:i + batch_size]  \n  \n            dec_in = dec_batch[:, :-1]  \n            dec_tgt = dec_batch[:, 1:]  \n  \n            with tf.GradientTape() as tape:  \n                logits = model(enc_batch, dec_in, training=True)  \n                loss_value = loss_fn(dec_tgt, logits)  \n                loss_value += tf.reduce_sum(model.losses)  \n  \n            grads = tape.gradient(loss_value, model.trainable_variables)  \n            optimizer.apply_gradients(zip(grads, model.trainable_variables))  \n  \n            total_loss += float(loss_value)  \n            num_batches += 1  \n  \n        avg_loss = total_loss / num_batches  \n        print(f\"Epoch [{epoch + 1}/{epochs}], Loss: {avg_loss:.4f}\")  \n  \n    train_time = time.time() - start_time  \n    print(f\"è®­ç»ƒç”¨æ—¶: {train_time:.2f} ç§’\")  \n    return train_time  \n  \n@tf.function  \ndef greedy_decode_step(decoder, dec_input, dec_hidden, enc_outputs):  \n    logits, dec_hidden = decoder(dec_input, dec_hidden, enc_outputs)  \n    return logits, dec_hidden  \n  \n  \ndef decode(model, input_tensor, use_beam_search=False, beam_width=3, max_len=20):  \n    dummy_src = tf.zeros((1, max_encoder_len), dtype=tf.int32)  \n    dummy_tgt = tf.zeros((1, 1), dtype=tf.int32)  \n    _ = model(dummy_src, dummy_tgt, training=False)  \n  \n    start_time = time.time()  \n  \n    input_tensor = tf.expand_dims(input_tensor, 0)  \n    enc_outputs, (hidden, cell) = model.encoder(input_tensor)  \n  \n    hidden_fw, hidden_bw = tf.split(hidden, num_or_size_splits=2, axis=-1)  \n    cell_fw, cell_bw = tf.split(cell, num_or_size_splits=2, axis=-1)  \n  \n    hidden = hidden_fw + hidden_bw  \n    cell = cell_fw + cell_bw  \n  \n    dec_hidden = (hidden, cell)  \n  \n    if not use_beam_search:  \n        dec_input = tf.constant([[target_token_index['\\t']]], dtype=tf.int32)  \n        result = []  \n        for _ in range(max_len):  \n            logits, dec_hidden = greedy_decode_step(  \n                model.decoder, dec_input, dec_hidden, enc_outputs  \n            )  \n            pred = tf.argmax(logits, axis=-1)  \n            token = int(pred[0])  \n            if token == target_token_index.get('\\n', -1):  \n                break  \n            result.append(reverse_target_char_index.get(token, ''))  \n            dec_input = pred[:, tf.newaxis]  \n  \n        decoded = ''.join(result)  \n  \n    else:  \n        candidates = [([target_token_index['\\t']], 0.0, dec_hidden)]  \n        for _ in range(max_len):  \n            new_cands = []  \n            for seq, score, h_c in candidates:  \n                if seq[-1] == target_token_index.get('\\n', -1):  \n                    new_cands.append((seq, score, h_c))  \n                    continue  \n                inp = tf.constant([[seq[-1]]], dtype=tf.int32)  \n                logits, new_h_c = model.decoder(inp, h_c, enc_outputs)  \n                log_probs = tf.nn.log_softmax(logits, axis=-1)[0]  \n                top_vals, top_idx = tf.math.top_k(log_probs, k=beam_width)  \n                for v, idx in zip(top_vals, top_idx):  \n                    new_seq = seq + [int(idx)]  \n                    new_score = score + float(v)  \n                    new_cands.append((new_seq, new_score, new_h_c))  \n  \n            candidates = sorted(new_cands, key=lambda x: x[1], reverse=True)[:beam_width]  \n  \n        best_seq = candidates[0][0]  \n        decoded = ''.join(  \n            reverse_target_char_index.get(i, '') for i in best_seq[1:] if i != target_token_index.get('\\n', -1))  \n  \n    decode_time = time.time() - start_time  \n    return decoded, decode_time  \n  \n  \ndef evaluate_bleu(model, test_enc_input, test_targets, use_beam_search=False, beam_width=3):  \n    total_bleu = 0  \n    total_time = 0  \n    smoother = SmoothingFunction().method4  \n  \n    for i in range(len(test_enc_input)):  \n        pred, dt = decode(model, test_enc_input[i], use_beam_search, beam_width)  \n        total_time += dt  \n        true = test_targets[i][1:-1]    \n        ref = [list(true)]  \n        hyp = list(pred)  \n        bleu = sentence_bleu(ref, hyp, smoothing_function=smoother)  \n        total_bleu += bleu  \n  \n    avg_bleu = total_bleu / len(test_enc_input) * 100  \n    avg_time = total_time / len(test_enc_input)  \n    print(f\"BLEU: {avg_bleu:.2f} | å¹³å‡è§£ç æ—¶é—´: {avg_time:.4f} ç§’/æ ·æœ¬\")  \n    return avg_bleu, avg_time  \n  \n  \ndef evaluate_exact_match(model, test_enc_input, test_targets, use_beam_search=False, beam_width=3):  \n    correct = 0  \n    total = len(test_enc_input)  \n  \n    for i in range(total):  \n        pred, _ = decode(model, test_enc_input[i], use_beam_search, beam_width)  \n        true = test_targets[i][1:-1]  \n        if pred == true:  \n            correct += 1  \n  \n    acc = correct / total * 100  \n    print(f\"å®Œå…¨åŒ¹é…ç‡: {acc:.2f}%\")  \n    return acc  \n  \n  \nif __name__ == \"__main__\":  \n    EMB_DIM = 64  \n    HIDDEN_DIM = 256   \n    BATCH_SIZE = 128  \n    LR = 0.001  \n  \n    USE_ATTENTION = True  \n    USE_BEAM_SEARCH = True  \n    BEAM_WIDTH = 3  \n  \n    print(f\"\\n=== é…ç½® ===\")  \n    print(f\"ä½¿ç”¨æ³¨æ„åŠ›: {USE_ATTENTION}\")  \n    print(f\"ä½¿ç”¨æŸæœç´¢: {USE_BEAM_SEARCH} (beam width = {BEAM_WIDTH if USE_BEAM_SEARCH else 'No'})\")  \n  \n    encoder = Encoder(num_encoder_tokens, EMB_DIM, HIDDEN_DIM)  \n    decoder = Decoder(num_decoder_tokens, EMB_DIM, HIDDEN_DIM, use_attention=USE_ATTENTION)  \n    model = Seq2Seq(encoder, decoder)  \n  \n    print(\"\\nå¼€å§‹è®­ç»ƒ...\")  \n    train_time = train(model, epochs=EPOCHS, batch_size=BATCH_SIZE, lr=LR)  \n  \n    print(\"\\nè¯„ä¼°ä¸­...\")  \n    bleu = evaluate_bleu(model, test_encoder_input, test_targets,  \n                         use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  \n    exact_acc = evaluate_exact_match(model, test_encoder_input, test_targets,  \n                                     use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  \n  \n    print(\"\\n=== æŠ½å–æµ‹è¯•æ ·æœ¬è¾“å‡º ===\")  \n    sample_indices = random.sample(range(len(test_encoder_input)), 10)  \n    for i in sample_indices:  \n        src = test_inputs[i]  \n        true = test_targets[i][1:-1]  \n        pred, _ = decode(model, test_encoder_input[i],  \n                         use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  \n        print(f\"Human  : {src} | True  : {true} | Predicted  : {pred}\")\n</code></pre>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-05 16:34</span>&nbsp;\n<a href=\"https://www.cnblogs.com/Goblinscholar\">å“¥å¸ƒæ—å­¦è€…</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "é¸¿è’™åº”ç”¨å¼€å‘UIåŸºç¡€ç¬¬ä¸‰èŠ‚ï¼šUIAbilityç”Ÿå‘½å‘¨æœŸå…¨è§£æ",
      "link": "https://www.cnblogs.com/san-xiu/p/19579716",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/san-xiu/p/19579716\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-05 15:55\">\n    <span>é¸¿è’™åº”ç”¨å¼€å‘UIåŸºç¡€ç¬¬ä¸‰èŠ‚ï¼šUIAbilityç”Ÿå‘½å‘¨æœŸå…¨è§£æ</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h2 id=\"å­¦ä¹ ç›®æ ‡\">ã€å­¦ä¹ ç›®æ ‡ã€‘</h2>\n<ol>\n<li>æŒæ¡UIAbilityæ ¸å¿ƒç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„è§¦å‘æ—¶æœºã€ç³»ç»Ÿè¡Œä¸ºåŠçº¦æŸè§„åˆ™ï¼›</li>\n<li>ç†è§£ç”Ÿå‘½å‘¨æœŸä¸WindowStageçš„æ·±åº¦è”åŠ¨é€»è¾‘ï¼Œæ˜ç¡®é¡µé¢åŠ è½½ã€äº‹ä»¶è®¢é˜…çš„æ—¶æœºï¼›</li>\n<li>æŒæ¡<code>onDestroy</code>å›è°ƒçš„ç‰¹æ®Šè§¦å‘è§„åˆ™ï¼ˆå«API 13ä¸€é”®æ¸…ç†ã€è°ƒè¯•æ¨¡å¼ã€terminateSelfè°ƒç”¨åœºæ™¯ï¼‰ï¼›</li>\n<li>èƒ½é€šè¿‡å®æ“éªŒè¯ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåºï¼ŒæŒæ¡WindowStageäº‹ä»¶ç›‘å¬çš„æ­£ç¡®æ–¹å¼ï¼Œé¿å…æ–°æ‰‹å¸¸è§æ··æ·†ï¼›</li>\n<li>åŒºåˆ†â€œåº”ç”¨é€€åå°â€ä¸â€œåº”ç”¨é”€æ¯â€çš„æ ¸å¿ƒå·®å¼‚ï¼Œè§„é¿ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„å¼€å‘è¯¯åŒºã€‚</li>\n</ol>\n<h2 id=\"æœ¬èŠ‚é‡ç‚¹\">ã€æœ¬èŠ‚é‡ç‚¹ã€‘</h2>\n<h3 id=\"1-æ ¸å¿ƒé—®é¢˜å¯¼å…¥\">1. æ ¸å¿ƒé—®é¢˜å¯¼å…¥</h3>\n<ul>\n<li>åº”ç”¨å¯åŠ¨ã€åˆ‡åå°ã€åˆ‡å‰å°ã€é€€å‡ºæ—¶ï¼ŒUIAbilityä¼šç»å†å“ªäº›çŠ¶æ€å˜åŒ–ï¼Ÿ</li>\n<li>çª—å£çš„è·ç„¦/å¤±ç„¦ã€å‰å°/åå°çŠ¶æ€è¯¥å¦‚ä½•é€šè¿‡WindowStageäº‹ä»¶ç›‘å¬ï¼Ÿ</li>\n<li>WindowStageçš„äº‹ä»¶è®¢é˜…ä¸è§£ç»‘ï¼Œåˆ†åˆ«åº”åœ¨å“ªä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æ‰§è¡Œï¼Ÿ</li>\n<li>ä¸åŒå…³é—­åº”ç”¨çš„æ–¹å¼ï¼ˆæ‰‹åŠ¨è°ƒç”¨APIã€ä¸€é”®æ¸…ç†ã€è°ƒè¯•æ¨¡å¼ç§»é™¤ä»»åŠ¡ï¼‰å¯¹<code>onDestroy</code>è§¦å‘æœ‰ä½•å½±å“ï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆé¡µé¢åªèƒ½åœ¨<code>onWindowStageCreate</code>ä¸­åŠ è½½ï¼Œä¸èƒ½åœ¨<code>onCreate</code>ä¸­åŠ è½½ï¼Ÿ</li>\n</ul>\n<h3 id=\"2-æ ¸å¿ƒæ¦‚å¿µ\">2. æ ¸å¿ƒæ¦‚å¿µ</h3>\n<p>UIAbilityç”Ÿå‘½å‘¨æœŸæ˜¯æŒ‡UIAbilityä»åˆ›å»ºåˆ°é”€æ¯çš„å…¨æµç¨‹ï¼Œç”±ç³»ç»Ÿç»Ÿä¸€è°ƒåº¦ï¼ŒåŒ…å«åˆ›å»ºã€çª—å£ç®¡ç†ã€å‰åå°åˆ‡æ¢ã€é”€æ¯ç­‰æ ¸å¿ƒé˜¶æ®µã€‚é€šè¿‡é‡å†™ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå¯åœ¨ç‰¹å®šæ—¶æœºå®Œæˆåˆå§‹åŒ–ã€èµ„æºç”³è¯·/é‡Šæ”¾ã€é¡µé¢åŠ è½½ç­‰æ“ä½œï¼›</p>\n<p>çª—å£çš„æ´»åŠ¨çŠ¶æ€ï¼ˆè·ç„¦/å¤±ç„¦ã€å‰å°/åå°ï¼‰éœ€é€šè¿‡<code>WindowStage</code>äº‹ä»¶ç›‘å¬å®ç°ï¼Œè€Œéç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚<br />\n<code>onDestroy</code>ä½œä¸ºç”Ÿå‘½å‘¨æœŸæœ€åä¸€ä¸ªæ–¹æ³•ï¼Œå…¶è§¦å‘ä¸å¦å—å…³é—­åº”ç”¨çš„æ–¹å¼ã€APIç‰ˆæœ¬ã€åº”ç”¨ç±»å‹ï¼ˆæœ‰æ— å®å†µçª—ï¼‰ã€è¿è¡Œæ¨¡å¼ï¼ˆè°ƒè¯•/æ­£å¼ï¼‰ç­‰å› ç´ å½±å“ã€‚</p>\n<blockquote>\n<p>æœ¬èŠ‚å†…å®¹å»¶ç”¨<code>FirstApplication</code>å·¥ç¨‹,æ— æ–°å¢æ–‡ä»¶ã€‚ ä½¿ç”¨é»˜è®¤å¯åŠ¨æ¨¡å¼singletonã€‚</p>\n</blockquote>\n<h2 id=\"äºŒuiabilityç”Ÿå‘½å‘¨æœŸæ ¸å¿ƒé˜¶æ®µä¸æ–¹æ³•\">äºŒã€UIAbilityç”Ÿå‘½å‘¨æœŸæ ¸å¿ƒé˜¶æ®µä¸æ–¹æ³•</h2>\n<h3 id=\"1-ç”Ÿå‘½å‘¨æœŸå¯è§†åŒ–ç¤ºæ„å›¾\">1. ç”Ÿå‘½å‘¨æœŸå¯è§†åŒ–ç¤ºæ„å›¾</h3>\n<p>ç”Ÿå‘½å‘¨æœŸçš„å®Œæ•´æµè½¬é€»è¾‘å¯é€šè¿‡ä»¥ä¸‹ç¤ºæ„å›¾ç›´è§‚ç†è§£ï¼Œæ¶µç›–å¯åŠ¨ã€å‰åå°åˆ‡æ¢ã€å…³é—­å…¨æµç¨‹çš„æ–¹æ³•è§¦å‘é¡ºåºä¸WindowStageäº‹ä»¶å…³è”ï¼š</p>\n<p>ç¤ºæ„å›¾è¯´æ˜ï¼šå·¦ä¾§ä¸ºUIAbilityæ ¸å¿ƒç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå³ä¾§ä¸ºå…³è”çš„WindowStageäº‹ä»¶ï¼Œçª—å£çš„è·ç„¦/å¤±ç„¦ã€å‰å°/åå°çŠ¶æ€éœ€é€šè¿‡<code>windowStageEvent</code>äº‹ä»¶ç›‘å¬å®ç°ï¼›é”€æ¯é˜¶æ®µçš„<code>onDestroy</code>è§¦å‘è§„åˆ™éœ€ç»“åˆå…³é—­åº”ç”¨çš„æ–¹å¼åˆ¤æ–­ã€‚</p>\n<p><img alt=\"UIAbilityçš„ç”Ÿå‘½å‘¨æœŸç¤ºæ„å›¾\" class=\"lazyload\" /></p>\n<h3 id=\"2-æ ¸å¿ƒæ–¹æ³•\">2. æ ¸å¿ƒæ–¹æ³•</h3>\n<p>ä»¥ä¸‹æ˜¯UIAbilityæ ¸å¿ƒç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„è¯¦ç»†è¯´æ˜ï¼Œèšç„¦å„æ–¹æ³•çš„è§¦å‘æ—¶æœºã€æ ¸å¿ƒä½œç”¨ä¸æ‰§è¡Œæ¬¡æ•°ï¼š</p>\n<h4 id=\"oncreatewant-launchparam\"><code>onCreate(want, launchParam)</code></h4>\n<ul>\n<li><strong>è§¦å‘æ—¶æœº</strong>ï¼šUIAbilityå®ä¾‹é¦–æ¬¡åˆ›å»ºæ—¶è§¦å‘ï¼›</li>\n<li><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šå®Œæˆåº”ç”¨å…¨å±€åˆå§‹åŒ–å·¥ä½œï¼Œæ¯”å¦‚å»ºç«‹æ•°æ®åº“è¿æ¥ã€åˆå§‹åŒ–å…¨å±€é…ç½®å‚æ•°ã€æ—¥å¿—æ¨¡å—ã€ç½‘ç»œé…ç½®ã€åˆ›å»ºå…¨å±€é€šç”¨å·¥å…·ç±»ç­‰ï¼Œè¿™äº›èµ„æºä¼šåœ¨<code>onDestroy</code>ä¸­å¯¹åº”é‡Šæ”¾ï¼›</li>\n<li><strong>æ‰§è¡Œæ¬¡æ•°</strong>ï¼šæ•´ä¸ªUIAbilityå®ä¾‹ç”Ÿå‘½å‘¨æœŸå†…ä»…è§¦å‘1æ¬¡ã€‚</li>\n</ul>\n<h4 id=\"onwindowstagecreatewindowstage\"><code>onWindowStageCreate(windowStage)</code></h4>\n<ul>\n<li><strong>è§¦å‘æ—¶æœº</strong>ï¼šUIAbilityå®ä¾‹åˆ›å»ºå®Œæˆåã€åº”ç”¨è¿›å…¥å‰å°å‰ï¼Œä¸”ç³»ç»Ÿé¦–æ¬¡åˆ›å»ºWindowStageï¼ˆçª—å£å®¹å™¨ï¼‰æ—¶è§¦å‘ï¼›</li>\n<li><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šè´Ÿè´£é¡µé¢åŠ è½½ã€è®¢é˜…WindowStageç›¸å…³äº‹ä»¶ï¼ˆå¦‚çª—å£ç„¦ç‚¹å˜åŒ–ã€æ˜¾ç¤º/éšè—äº‹ä»¶ï¼‰ï¼›</li>\n<li><strong>æ‰§è¡Œæ¬¡æ•°</strong>ï¼šå•å®ä¾‹ï¼ˆsingletonï¼‰æ¨¡å¼ä¸‹ä»…è§¦å‘1æ¬¡ï¼ˆå¤šå®ä¾‹æ¨¡å¼ä¸‹æ¯æ¬¡åˆ›å»ºæ–°å®ä¾‹éƒ½ä¼šè§¦å‘ï¼‰ã€‚</li>\n</ul>\n<h4 id=\"onforeground\"><code>onForeground()</code></h4>\n<ul>\n<li><strong>è§¦å‘æ—¶æœº</strong>ï¼šUIAbilityä»åå°åˆ‡æ¢è‡³å‰å°ã€ç•Œé¢å³å°†å¯è§ä¹‹å‰è§¦å‘ï¼›</li>\n<li><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šæ¢å¤å‰å°è¿è¡Œæ‰€éœ€èµ„æºï¼Œæ¯”å¦‚é‡å¯æš‚åœçš„å®šæ—¶å™¨ã€é‡æ–°å¼€å¯å®šä½æœåŠ¡ã€æ¢å¤ç½‘ç»œè¯·æ±‚è½®è¯¢ç­‰ï¼›</li>\n<li><strong>æ‰§è¡Œæ¬¡æ•°</strong>ï¼šå¯å¤šæ¬¡è§¦å‘ï¼ˆæ¯æ¬¡åˆ‡å‰å°éƒ½ä¼šæ‰§è¡Œï¼‰ã€‚</li>\n</ul>\n<h4 id=\"onbackground\"><code>onBackground()</code></h4>\n<ul>\n<li><strong>è§¦å‘æ—¶æœº</strong>ï¼šUIAbilityç•Œé¢å®Œå…¨ä¸å¯è§ï¼ˆå¦‚æŒ‰Homeé”®åˆ‡åå°ã€æ‰“å¼€å…¶ä»–åº”ç”¨è¦†ç›–å½“å‰ç•Œé¢ï¼‰åè§¦å‘ï¼›</li>\n<li><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šæš‚åœå‰å°èµ„æºä»¥èŠ‚çœç³»ç»Ÿå¼€é”€ï¼Œæ¯”å¦‚åœæ­¢å®šæ—¶å™¨ã€å…³é—­å®šä½æœåŠ¡ã€ä¿å­˜ç”¨æˆ·æ“ä½œæ•°æ®ï¼ˆä½œä¸º<code>onDestroy</code>æœªè§¦å‘æ—¶çš„å…œåº•æ–¹æ¡ˆï¼‰ï¼›</li>\n<li><strong>æ‰§è¡Œæ¬¡æ•°</strong>ï¼šå¯å¤šæ¬¡è§¦å‘ï¼ˆæ¯æ¬¡åˆ‡åå°éƒ½ä¼šæ‰§è¡Œï¼‰ã€‚</li>\n</ul>\n<h4 id=\"onwindowstagewilldestroywindowstage\"><code>onWindowStageWillDestroy(windowStage)</code></h4>\n<ul>\n<li><strong>è§¦å‘æ—¶æœº</strong>ï¼šWindowStageï¼ˆçª—å£å®¹å™¨ï¼‰å³å°†è¢«é”€æ¯å‰è§¦å‘ï¼›</li>\n<li><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šè§£ç»‘åœ¨<code>onWindowStageCreate</code>ä¸­è®¢é˜…çš„WindowStageäº‹ä»¶ã€æ¸…ç†çª—å£ç›¸å…³ç¼“å­˜èµ„æºï¼Œé¿å…å†…å­˜æ³„æ¼ï¼›</li>\n<li><strong>æ‰§è¡Œæ¬¡æ•°</strong>ï¼šä»…åœ¨åº”ç”¨â€œä¼˜é›…é”€æ¯â€ï¼ˆå¦‚è°ƒç”¨<code>terminateSelf()</code>ã€æ­£å¸¸é€€å‡ºï¼‰æ—¶è§¦å‘1æ¬¡ï¼Œä¸€é”®æ¸…ç†ç­‰å¼ºåˆ¶é”€æ¯åœºæ™¯ä¸è§¦å‘ã€‚</li>\n</ul>\n<h4 id=\"onwindowstagedestroy\"><code>onWindowStageDestroy()</code></h4>\n<ul>\n<li><strong>è§¦å‘æ—¶æœº</strong>ï¼šWindowStageï¼ˆçª—å£å®¹å™¨ï¼‰é”€æ¯å®Œæˆåè§¦å‘ï¼›</li>\n<li><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šç¡®è®¤çª—å£ç›¸å…³èµ„æºå·²é‡Šæ”¾ï¼Œåšæœ€ç»ˆçš„çª—å£çŠ¶æ€æ ¡éªŒï¼›</li>\n<li><strong>æ‰§è¡Œæ¬¡æ•°</strong>ï¼šä»…åœ¨åº”ç”¨â€œä¼˜é›…é”€æ¯â€æ—¶è§¦å‘1æ¬¡ï¼Œå¼ºåˆ¶é”€æ¯åœºæ™¯ä¸è§¦å‘ã€‚</li>\n</ul>\n<h4 id=\"ondestroy\"><code>onDestroy()</code></h4>\n<ul>\n<li><strong>è§¦å‘æ—¶æœº</strong>ï¼šUIAbilityå®ä¾‹å³å°†è¢«é”€æ¯å‰è§¦å‘ï¼›</li>\n<li><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šé‡Šæ”¾<code>onCreate</code>ä¸­åˆå§‹åŒ–çš„å…¨å±€èµ„æºï¼Œæ¯”å¦‚å…³é—­æ•°æ®åº“è¿æ¥ã€æ¸…ç†å…¨å±€ç¼“å­˜ã€ä¿å­˜æœ€ç»ˆçš„åº”ç”¨çŠ¶æ€æ•°æ®ï¼›</li>\n<li><strong>æ‰§è¡Œæ¬¡æ•°</strong>ï¼šä»…åœ¨â€œä¼˜é›…é”€æ¯â€æ—¶è§¦å‘1æ¬¡ï¼ˆAPI 13+ä¸­ï¼Œæ— å®å†µçª—åº”ç”¨è¢«ä¸€é”®æ¸…ç†ã€è°ƒè¯•æ¨¡å¼ç§»é™¤ä»»åŠ¡æ—¶ï¼Œç³»ç»Ÿç›´æ¥ç»ˆæ­¢è¿›ç¨‹ï¼Œè¯¥æ–¹æ³•ä¸è§¦å‘ï¼‰ã€‚</li>\n</ul>\n<h4 id=\"onnewwantwant-launchparam\"><code>onNewWant(want, launchParam)</code></h4>\n<ul>\n<li><strong>è§¦å‘æ—¶æœº</strong>ï¼šUIAbilityå®ä¾‹å·²å¯åŠ¨ï¼ˆæœªé”€æ¯ï¼‰ã€å†æ¬¡è¢«å¤–éƒ¨è°ƒç”¨ï¼ˆå¦‚å…¶ä»–é¡µé¢/åº”ç”¨è·³è½¬ï¼‰æ—¶è§¦å‘ï¼›</li>\n<li><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šå¤„ç†æ–°çš„å¯åŠ¨å‚æ•°ï¼Œæ¯”å¦‚æ¥æ”¶è·³è½¬ä¼ å‚ã€æ›´æ–°é¡µé¢å±•ç¤ºå†…å®¹ï¼›</li>\n<li><strong>æ‰§è¡Œæ¬¡æ•°</strong>ï¼šæŒ‰éœ€è§¦å‘ï¼ˆæ¯æ¬¡å¤ç”¨å®ä¾‹è°ƒç”¨éƒ½ä¼šæ‰§è¡Œï¼‰ã€‚</li>\n<li></li>\n</ul>\n<p><strong>æ³¨æ„</strong>ï¼š</p>\n<ul>\n<li><code>onDestroy</code>è§¦å‘ç‰¹æ®Šè§„åˆ™ï¼šAPI 13åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæ— å®å†µçª—åº”ç”¨è¢«ä¸€é”®æ¸…ç†ã€è°ƒè¯•æ¨¡å¼ä¸‹ç§»é™¤ä»»åŠ¡æ—¶ï¼Œç³»ç»Ÿç›´æ¥ç»ˆæ­¢è¿›ç¨‹ï¼Œè¯¥æ–¹æ³•ä¸ä¼šè§¦å‘ï¼›ä»…<code>terminateSelf()</code>è°ƒç”¨ã€æ­£å¸¸è¿”å›é€€å‡ºã€æœ‰å®å†µçª—åº”ç”¨è¢«ä¸€é”®æ¸…ç†æ—¶è§¦å‘ã€‚</li>\n</ul>\n<h3 id=\"3-windowstageäº‹ä»¶è¯¦è§£ç›‘å¬çª—å£æ´»åŠ¨çŠ¶æ€\">3. WindowStageäº‹ä»¶è¯¦è§£ï¼ˆç›‘å¬çª—å£æ´»åŠ¨çŠ¶æ€ï¼‰</h3>\n<p>çª—å£çš„æ‰€æœ‰æ´»åŠ¨çŠ¶æ€å‡é€šè¿‡<code>windowStageEvent</code>äº‹ä»¶ç›‘å¬ï¼Œæ ¸å¿ƒäº‹ä»¶è¯´æ˜ï¼š</p>\n<ul>\n<li><code>SHOWN</code>ï¼šçª—å£ä»åå°åˆ‡æ¢åˆ°å‰å°ï¼ˆå¯è§ï¼‰ï¼Œä»£è¡¨åº”ç”¨åˆ‡å‰å°ï¼›</li>\n<li><code>HIDDEN</code>ï¼šçª—å£ä»å‰å°åˆ‡æ¢åˆ°åå°ï¼ˆä¸å¯è§ï¼‰ï¼Œä»£è¡¨åº”ç”¨åˆ‡åå°ï¼›</li>\n<li><code>ACTIVE</code>ï¼šçª—å£è·å¾—ç„¦ç‚¹ï¼ˆå¯æ¥æ”¶ç‚¹å‡»/è¾“å…¥ï¼‰ï¼Œå¤„äºå¯äº¤äº’çŠ¶æ€ï¼›</li>\n<li><code>INACTIVE</code>ï¼šçª—å£å¤±å»ç„¦ç‚¹ï¼ˆæ— æ³•æ¥æ”¶è¾“å…¥ï¼‰ï¼Œå¤„äºä¸å¯äº¤äº’çŠ¶æ€ï¼›</li>\n<li><code>RESUMED</code>ï¼šçª—å£è¿›å…¥å‰å°å¯äº¤äº’çŠ¶æ€ï¼Œåº”ç”¨æ­£å¸¸è¿è¡Œï¼›</li>\n<li><code>PAUSED</code>ï¼šçª—å£è¿›å…¥å‰å°ä¸å¯äº¤äº’çŠ¶æ€ã€‚</li>\n</ul>\n<h2 id=\"ä¸‰å®Œæ•´ç”Ÿå‘½å‘¨æœŸä»£ç ç¤ºä¾‹\">ä¸‰ã€å®Œæ•´ç”Ÿå‘½å‘¨æœŸä»£ç ç¤ºä¾‹</h2>\n<pre><code class=\"language-javascript\">import { UIAbility, AbilityConstant, Want, common } from '@kit.AbilityKit';\nimport { window } from '@kit.ArkUI';\nimport { hilog } from '@kit.LogKit';\nimport { BusinessError } from '@ohos.base';\n\nconst TAG = 'UIAbility_Lifecycle';\nconst DOMAIN = 0x0000;\n\nexport default class EntryAbility extends UIAbility {\n  // 1. åˆ›å»ºé˜¶æ®µï¼ˆä»…1æ¬¡ï¼‰\n  onCreate(want: Want, launchParam: AbilityConstant.LaunchParam) {\n    hilog.info(DOMAIN, TAG, '--- onCreate è§¦å‘ï¼ˆå…¨å±€åˆå§‹åŒ–ï¼‰---');\n    // èµ„æºåˆå§‹åŒ–ï¼šå…¨å±€é…ç½®ã€æ•°æ®åº“è¿æ¥ç­‰ï¼ˆå¯¹åº”é‡Šæ”¾ï¼šonDestroyï¼‰\n  }\n\n  // 2. çª—å£åˆ›å»ºé˜¶æ®µï¼ˆçª—å£é¦–æ¬¡åˆ›å»º/é‡å»ºï¼‰\n  onWindowStageCreate(windowStage: window.WindowStage): void {\n    hilog.info(DOMAIN, TAG, '--- onWindowStageCreate è§¦å‘ï¼ˆåŠ è½½é¡µé¢ï¼‰---');\n    // è®¢é˜…WindowStageäº‹ä»¶\n    this.registerWindowStageEvent(windowStage);\n    // åŠ è½½é¡µé¢ï¼ˆå”¯ä¸€åˆæ³•æ—¶æœºï¼‰\n    windowStage.loadContent('pages/Index').then(()=&gt;{\n      hilog.info(DOMAIN, TAG, 'Indexé¡µé¢åŠ è½½æˆåŠŸ');\n    }).catch((err:BusinessError)=&gt;{\n      hilog.error(DOMAIN, TAG, `é¡µé¢åŠ è½½å¤±è´¥ï¼šcode=${err.code}, message=${err.message}`);\n    })\n  }\n\n  // 3. å‰å°é˜¶æ®µï¼ˆåˆ‡å‰å°æ—¶ï¼‰\n  onForeground() {\n    hilog.info(DOMAIN, TAG, '--- onForeground è§¦å‘ï¼ˆæ¢å¤å‰å°èµ„æºï¼‰---');\n    // å¯åŠ¨å‰å°ä¸“å±èµ„æºï¼ˆå®šæ—¶å™¨ã€å®šä½ç­‰ï¼‰\n  }\n\n  // 4. åå°é˜¶æ®µï¼ˆåˆ‡åå°æ—¶ï¼‰\n  onBackground() {\n    hilog.info(DOMAIN, TAG, '--- onBackground è§¦å‘ï¼ˆé‡Šæ”¾åå°èµ„æºï¼‰---');\n    // æš‚åœå‰å°èµ„æºï¼Œä¿å­˜å…³é”®æ•°æ®ï¼ˆå…œåº•ï¼‰\n  }\n\n  // 5. çª—å£é¢„é”€æ¯é˜¶æ®µï¼ˆçª—å£å³å°†é”€æ¯ï¼‰\n  onWindowStageWillDestroy(windowStage: window.WindowStage) {\n    hilog.info(DOMAIN, TAG, '--- onWindowStageWillDestroy è§¦å‘ï¼ˆçª—å£é¢„é”€æ¯ï¼‰---');\n    // è§£ç»‘WindowStageäº‹ä»¶ï¼Œé¿å…å†…å­˜æ³„æ¼\n    this.unregisterWindowStageEvent(windowStage);\n  }\n\n  // 6. çª—å£é”€æ¯é˜¶æ®µï¼ˆçª—å£å·²é”€æ¯ï¼‰\n  onWindowStageDestroy() {\n    hilog.info(DOMAIN, TAG, '--- onWindowStageDestroy è§¦å‘ï¼ˆé”€æ¯çª—å£ï¼‰---');\n    // çª—å£å®ä¾‹å¤±æ•ˆï¼Œæ— éœ€é¢å¤–æ“ä½œ\n  }\n\n  // 7. é”€æ¯é˜¶æ®µï¼ˆä»…1æ¬¡ï¼Œå­˜åœ¨ä¸è§¦å‘åœºæ™¯ï¼‰\n  onDestroy() {\n    hilog.info(DOMAIN, TAG, '--- onDestroy è§¦å‘ï¼ˆé”€æ¯åº”ç”¨ï¼‰---');\n    // é‡Šæ”¾å…¨å±€èµ„æºã€ä¿å­˜æœ€ç»ˆæ•°æ®\n  }\n\n  // 8. æ–°å‚æ•°é˜¶æ®µï¼ˆå·²å¯åŠ¨åæ¥æ”¶æ–°è¯·æ±‚ï¼‰\n  onNewWant(want: Want, launchParam: AbilityConstant.LaunchParam) {\n    hilog.info(DOMAIN, TAG, `--- onNewWant è§¦å‘ï¼ˆæ–°å‚æ•°ï¼š${JSON.stringify(want)}ï¼‰---`);\n    // å¤„ç†æ–°çš„å¯åŠ¨å‚æ•°\n  }\n  /**\n   * è®¢é˜…WindowStageäº‹ä»¶ï¼ˆç›‘å¬çª—å£æ´»åŠ¨çŠ¶æ€ï¼‰\n   * @param windowStage - å½“å‰çª—å£å®ä¾‹\n   */\n  private registerWindowStageEvent(windowStage: window.WindowStage): void {\n    try {\n      windowStage.on('windowStageEvent', (data) =&gt; {\n        const stageEventType: window.WindowStageEventType = data;\n        switch (stageEventType) {\n          case window.WindowStageEventType.SHOWN:\n            hilog.info(DOMAIN, TAG, `windowStage foreground`);\n            break;\n          case window.WindowStageEventType.ACTIVE:\n            hilog.info(DOMAIN, TAG, `windowStage active`);\n            break;\n          case window.WindowStageEventType.INACTIVE:\n            hilog.info(DOMAIN, TAG, `windowStage inactive`);\n            break;\n          case window.WindowStageEventType.HIDDEN:\n            hilog.info(DOMAIN, TAG, `windowStage background`);\n            break;\n          case window.WindowStageEventType.RESUMED:\n            hilog.info(DOMAIN, TAG, `windowStage resumed`);\n            break;\n          case window.WindowStageEventType.PAUSED:\n            hilog.info(DOMAIN, TAG, `windowStage paused.`);\n            break;\n          default:\n            break;\n        }\n      });\n      hilog.info(DOMAIN, TAG, 'WindowStageäº‹ä»¶è®¢é˜…æˆåŠŸ');\n    } catch (exception) {\n      hilog.error(DOMAIN, TAG, `è®¢é˜…çª—å£äº‹ä»¶å¤±è´¥ï¼š${JSON.stringify(exception)}`);\n    }\n  }\n\n  /**\n   * è§£ç»‘WindowStageäº‹ä»¶ï¼ˆèµ„æºé‡Šæ”¾ï¼‰\n   */\n  private unregisterWindowStageEvent(windowStage: window.WindowStage): void {\n    try {\n      windowStage.off('windowStageEvent');\n      hilog.info(DOMAIN, TAG, 'çª—å£äº‹ä»¶è§£ç»‘æˆåŠŸ');\n    } catch (err) {\n      hilog.error(DOMAIN, TAG, `è§£ç»‘çª—å£äº‹ä»¶å¤±è´¥ï¼šcode=${err.code}, message=${err.message}`);\n    }\n  }\n}\n\n/**\n * æ‰‹åŠ¨åœæ­¢å½“å‰UIAbilityå®ä¾‹ï¼ˆè§¦å‘onDestroyï¼‰\n */\nexport function stopCurrentAbility(context: common.UIAbilityContext): void {\n  context.terminateSelf().then(()=&gt;{\n    hilog.info(DOMAIN, TAG, 'terminateSelfè°ƒç”¨æˆåŠŸï¼Œå°†è§¦å‘onDestroy');\n  }).catch((err: BusinessError) =&gt; {\n    hilog.error(DOMAIN, TAG, `åœæ­¢UIAbilityå¤±è´¥ï¼šcode=${err.code}, message=${err.message}`);\n  });\n}\n</code></pre>\n<h2 id=\"å››æ–°å¢æ‰‹åŠ¨å…³é—­åº”ç”¨indexets\">å››ã€æ–°å¢æ‰‹åŠ¨å…³é—­åº”ç”¨Index.ets</h2>\n<pre><code class=\"language-javascript\">import { common } from '@kit.AbilityKit';\nimport { stopCurrentAbility } from '../entryability/EntryAbility';\n\n@Entry\n@Component\nstruct Index {\n  @State message: string = 'ç¬¬ä¸€ä¸ªåº”ç”¨';\n  private context: common.UIAbilityContext = this.getUIContext().getHostContext() as common.UIAbilityContext;\n\n  aboutToAppear(): void {}\n\n  build() {\n    Column() {\n      Text(this.message)\n        .fontSize($r('app.float.page_text_font_size'))\n        .fontWeight(FontWeight.Bold);\n\n      Button(\"å…³é—­åº”ç”¨ç¨‹åº\")\n        .onClick(()=&gt;{\n          stopCurrentAbility(this.context);\n        });\n    }\n    .height('100%')\n    .width('100%');\n  }\n}\n</code></pre>\n<h2 id=\"äº”å®æˆ˜å®æ“éªŒè¯ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåº\">äº”ã€å®æˆ˜å®æ“ï¼šéªŒè¯ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåº</h2>\n<h3 id=\"ç›®æ ‡\">ç›®æ ‡</h3>\n<p>é€šè¿‡æ‰‹åŠ¨æ“ä½œåº”ç”¨ï¼Œåœ¨Logcatä¸­è§‚å¯Ÿç”Ÿå‘½å‘¨æœŸæ–¹æ³•å’ŒWindowStageäº‹ä»¶çš„è§¦å‘é¡ºåºï¼Œé‡ç‚¹éªŒè¯ä¸åŒåœºæ™¯ä¸‹<code>onDestroy</code>çš„è§¦å‘æƒ…å†µã€‚</p>\n<blockquote>\n<p>ç¯å¢ƒè¯´æ˜ï¼šå¼€å‘å·¥å…·æœ€ä½æ”¯æŒAPI 13ï¼Œæ— æ³•æµ‹è¯•API 12åŠä»¥ä¸‹ç‰ˆæœ¬ï¼Œæ‰€æœ‰æµ‹è¯•åŸºäºAPI 13 æ‰‹æœºæ¨¡æ‹Ÿå™¨ã€‚<br />\nä¸åŒç±»å‹çš„è®¾å¤‡ç›‘å¬çª—å£æ´»åŠ¨çŠ¶æ€è¾“å‡ºæ—¥å¿—ä¼šæœ‰å·®å¼‚ã€‚</p>\n</blockquote>\n<h3 id=\"åœºæ™¯1å¯åŠ¨åº”ç”¨--è¿”å›æ¡Œé¢--å†æ¬¡æ‰“å¼€åº”ç”¨\">åœºæ™¯1ï¼šå¯åŠ¨åº”ç”¨ â†’ è¿”å›æ¡Œé¢ â†’ å†æ¬¡æ‰“å¼€åº”ç”¨</h3>\n<p><strong>æ—¥å¿—è¾“å‡º</strong>ï¼š</p>\n<pre><code>&lt;!-- å¯åŠ¨åº”ç”¨ --&gt;\n--- onCreate è§¦å‘ï¼ˆå…¨å±€åˆå§‹åŒ–ï¼‰---\n--- onWindowStageCreate è§¦å‘ï¼ˆåŠ è½½é¡µé¢ï¼‰---\nWindowStageäº‹ä»¶è®¢é˜…æˆåŠŸ\n--- onForeground è§¦å‘ï¼ˆæ¢å¤å‰å°èµ„æºï¼‰---\nwindowStage foreground\nwindowStage active\nIndexé¡µé¢åŠ è½½æˆåŠŸ\n\n&lt;!-- è¿”å›æ¡Œé¢ --&gt;\nwindowStage paused.\nwindowStage inactive\n--- onBackground è§¦å‘ï¼ˆé‡Šæ”¾åå°èµ„æºï¼‰---\nwindowStage background\n\n\n&lt;!-- å†æ¬¡æ‰“å¼€åº”ç”¨ --&gt;\n--- onNewWant è§¦å‘ï¼ˆæ–°å‚æ•°ï¼š{\"deviceId\":\"\",\"bundleName\":\"com.example.FirstApplication\",\"abilityName\":\"EntryAbility\",\"moduleName\":\"entry\",\"uri\":\"\",\"type\":\"\",\"flags\":0,\"action\":\"action.system.home\",\"parameters\":{\"debugApp\":true,\"moduleName\":\"entry\",\"ohos.aafwk.param.displayId\":0},\"fds\":{},\"entities\":[\"entity.system.home\"]}ï¼‰---\n--- onForeground è§¦å‘ï¼ˆæ¢å¤å‰å°èµ„æºï¼‰---\nwindowStage foreground\nwindowStage active\n</code></pre>\n<h3 id=\"åœºæ™¯2ç‚¹å‡»å…³é—­åº”ç”¨ç¨‹åºæŒ‰é’®è°ƒç”¨terminateself\">åœºæ™¯2ï¼šç‚¹å‡»â€œå…³é—­åº”ç”¨ç¨‹åºâ€æŒ‰é’®ï¼ˆè°ƒç”¨terminateSelfï¼‰</h3>\n<p><strong>æ—¥å¿—è¾“å‡º</strong>ï¼š</p>\n<pre><code>&lt;!-- terminateSelfè°ƒç”¨æˆåŠŸï¼Œå°†è§¦å‘onDestroy --&gt;\nwindowStage inactive\n--- onBackground è§¦å‘ï¼ˆé‡Šæ”¾åå°èµ„æºï¼‰---\nwindowStage background\n--- onWindowStageWillDestroy è§¦å‘ï¼ˆçª—å£é¢„é”€æ¯ï¼‰---\nçª—å£äº‹ä»¶è§£ç»‘æˆåŠŸ\n--- onWindowStageDestroy è§¦å‘ï¼ˆé”€æ¯çª—å£ï¼‰---\n--- onDestroy è§¦å‘ï¼ˆé”€æ¯åº”ç”¨ï¼‰---\n</code></pre>\n<h3 id=\"åœºæ™¯3å¯åŠ¨åº”ç”¨--åˆ‡åå°--ä¸€é”®æ¸…ç†æ— å®å†µçª—åº”ç”¨\">åœºæ™¯3ï¼šå¯åŠ¨åº”ç”¨ â†’ åˆ‡åå° â†’ ä¸€é”®æ¸…ç†æ— å®å†µçª—åº”ç”¨</h3>\n<p><strong>æ—¥å¿—è¾“å‡º</strong>ï¼š</p>\n<pre><code>--- onCreate è§¦å‘ï¼ˆå…¨å±€åˆå§‹åŒ–ï¼‰---\n--- onWindowStageCreate è§¦å‘ï¼ˆåŠ è½½é¡µé¢ï¼‰---\nWindowStageäº‹ä»¶è®¢é˜…æˆåŠŸ\n--- onForeground è§¦å‘ï¼ˆæ¢å¤å‰å°èµ„æºï¼‰---\nwindowStage foreground\nwindowStage active\nIndexé¡µé¢åŠ è½½æˆåŠŸ\nwindowStage inactive\n--- onBackground è§¦å‘ï¼ˆé‡Šæ”¾åå°èµ„æºï¼‰---\nwindowStage background\n</code></pre>\n<p><strong>å…³é”®ç»“è®º</strong>ï¼šä¸€é”®æ¸…ç†æ—¶ç³»ç»Ÿç›´æ¥ç»ˆæ­¢è¿›ç¨‹ï¼Œæœªè§¦å‘<code>onWindowStageWillDestroy</code>/<code>onWindowStageDestroy</code>/<code>onDestroy</code>ã€‚</p>\n<h2 id=\"å…­å†…å®¹æ€»ç»“\">å…­ã€å†…å®¹æ€»ç»“</h2>\n<ol>\n<li><strong>ç”Ÿå‘½å‘¨æœŸåˆ†å·¥</strong>ï¼š<code>onCreate</code>åšå…¨å±€åˆå§‹åŒ–ï¼ˆä»…1æ¬¡ï¼‰ï¼Œ<code>onWindowStageCreate</code>è´Ÿè´£é¡µé¢åŠ è½½/äº‹ä»¶è®¢é˜…ï¼ˆå•å®ä¾‹æ¨¡å¼ä¸‹ä»…é¦–æ¬¡å¯åŠ¨è§¦å‘1æ¬¡ï¼‰ï¼Œ<code>onDestroy</code>é‡Šæ”¾å…¨å±€èµ„æºï¼ˆAPI 13+ä¸€é”®æ¸…ç†æ— å®å†µçª—åº”ç”¨ä¸è§¦å‘ï¼‰ï¼›</li>\n<li><strong>WindowStageæ ¸å¿ƒè§„åˆ™</strong>ï¼šäº‹ä»¶è®¢é˜…/è§£ç»‘å¿…é¡»æˆå¯¹å‡ºç°åœ¨<code>onWindowStageCreate</code>/<code>onWindowStageWillDestroy</code>ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼›</li>\n<li><strong>æ•°æ®å®‰å…¨å…œåº•</strong>ï¼šå› <code>onDestroy</code>å­˜åœ¨ä¸è§¦å‘åœºæ™¯ï¼Œå…³é”®æ•°æ®éœ€åœ¨<code>onBackground</code>ä¸­ä¿å­˜ï¼›</li>\n<li><strong>å‰åå°åˆ‡æ¢é“¾è·¯</strong>ï¼šåˆ‡åå°å…ˆè§¦å‘PAUSED/INACTIVEâ†’<code>onBackground</code>â†’HIDDENï¼›åˆ‡å‰å°å…ˆè§¦å‘SHOWNâ†’<code>onForeground</code>â†’ACTIVE/RESUMEDã€‚</li>\n</ol>\n<h3 id=\"æ ¸å¿ƒé—®é¢˜è§£ç­”ä¸ºä»€ä¹ˆé¡µé¢åªèƒ½åœ¨onwindowstagecreateä¸­åŠ è½½\">æ ¸å¿ƒé—®é¢˜è§£ç­”ï¼šä¸ºä»€ä¹ˆé¡µé¢åªèƒ½åœ¨<code>onWindowStageCreate</code>ä¸­åŠ è½½ï¼Ÿ</h3>\n<p>é¡µé¢åŠ è½½çš„æœ¬è´¨æ˜¯å°† UI ç»„ä»¶æŒ‚è½½åˆ°ç³»ç»Ÿçš„çª—å£å®¹å™¨ï¼ˆWindowStageï¼‰ä¸Šï¼Œä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé˜¶æ®µçš„æ ¸å¿ƒå·®å¼‚å†³å®šäº†åŠ è½½æ—¶æœºï¼š</p>\n<ul>\n<li><code>onCreate</code>é˜¶æ®µï¼šUIAbility å®ä¾‹åˆšåˆ›å»ºï¼Œç³»ç»Ÿå°šæœªåˆ†é… WindowStageï¼ˆæ— é¡µé¢æ‰¿è½½è½½ä½“ï¼‰ï¼Œæ­¤æ—¶è°ƒç”¨<code>loadContent</code>ä¼šå› æ— çª—å£å®¹å™¨è€Œå¤±è´¥ï¼Œç”šè‡³å¯¼è‡´åº”ç”¨å´©æºƒï¼›</li>\n<li><code>onWindowStageCreate</code>é˜¶æ®µï¼šç³»ç»Ÿå·²åˆ›å»º WindowStage å¹¶ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œæ­¤æ—¶æ‹¥æœ‰äº†é¡µé¢æ¸²æŸ“æ‰€éœ€çš„çª—å£å®¹å™¨ï¼Œæ˜¯åŠ è½½é¡µé¢çš„æ—¶æœºã€‚</li>\n</ul>\n<h3 id=\"æ–°æ‰‹é¿å‘æŒ‡å—\">æ–°æ‰‹é¿å‘æŒ‡å—</h3>\n<ul>\n<li>ç¦æ­¢åœ¨<code>onCreate</code>ä¸­åŠ è½½é¡µé¢ï¼ˆæ— WindowStageå®ä¾‹ï¼‰ï¼›</li>\n<li>ä¸è¦ä¾èµ–<code>onDestroy</code>ä¿å­˜å…³é”®æ•°æ®ï¼Œä¼˜å…ˆåœ¨<code>onBackground</code>å…œåº•ï¼›</li>\n<li>ç”Ÿå‘½å‘¨æœŸå›è°ƒæ˜¯åœ¨åº”ç”¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œä¸ºäº†ç¡®ä¿åº”ç”¨æ€§èƒ½ï¼Œå»ºè®®åœ¨ç”Ÿå‘½å‘¨æœŸå›è°ƒä¸­ï¼Œä»…æ‰§è¡Œå¿…è¦çš„è½»é‡çº§æ“ä½œã€‚å¯¹äºè€—æ—¶ä»»åŠ¡ï¼Œæ¨èé‡‡ç”¨å¼‚æ­¥å¤„ç†æˆ–äº¤ç”±å­çº¿ç¨‹æ‰§è¡Œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</li>\n<li>å¦‚æœéœ€è¦æ„ŸçŸ¥UIAbilityç”Ÿå‘½å‘¨æœŸå˜åŒ–ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨ApplicationContextæ³¨å†Œæ¥å£ç›‘å¬UIAbilityç”Ÿå‘½å‘¨æœŸå˜åŒ–ã€‚</li>\n</ul>\n<pre><code class=\"language-javascript\">  // å®šä¹‰ç”Ÿå‘½å‘¨æœŸID\n  private lifecycleId: number = -1;\n  \n  // å®šä¹‰ç”Ÿå‘½å‘¨æœŸå›è°ƒå¯¹è±¡\n  let abilityLifecycleCallback: AbilityLifecycleCallback = {\n    // å„å›è°ƒæ–¹æ³•\n  }\n    // è·å–åº”ç”¨ä¸Šä¸‹æ–‡\n  let applicationContext = this.context.getApplicationContext();\n   // æ³¨å†Œåº”ç”¨å†…ç”Ÿå‘½å‘¨æœŸå›è°ƒ\n  this.lifecycleId = applicationContext.on('abilityLifecycle', abilityLifecycleCallback);\n  \n</code></pre>\n<h2 id=\"ä¸ƒä»£ç ä»“åº“\">ä¸ƒã€ä»£ç ä»“åº“</h2>\n<ul>\n<li>å·¥ç¨‹åç§°ï¼šFirstApplication</li>\n<li>ä»“åº“åœ°å€ï¼š<a href=\"https://gitee.com/HarmonyOS-UI-Basics/harmony-os-ui-basics.git\" rel=\"noopener nofollow\" target=\"_blank\">https://gitee.com/HarmonyOS-UI-Basics/harmony-os-ui-basics.git</a></li>\n</ul>\n<h2 id=\"å…«ä¸‹èŠ‚é¢„å‘Š\">å…«ã€ä¸‹èŠ‚é¢„å‘Š</h2>\n<p>ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†ç³»ç»Ÿå­¦ä¹ UIAbilityçš„å…¨é‡å¯åŠ¨æ¨¡å¼ï¼Œé‡ç‚¹æŒæ¡ï¼š</p>\n<ol>\n<li>multitonï¼ˆå¤šå®ä¾‹ï¼‰ã€singletonï¼ˆå•å®ä¾‹ï¼‰ã€specifiedï¼ˆæŒ‡å®šå®ä¾‹ï¼‰ä¸‰ç§å¯åŠ¨æ¨¡å¼çš„æ ¸å¿ƒå·®å¼‚ä¸å®ä¾‹åˆ›å»ºè§„åˆ™ï¼›</li>\n<li>ä¸åŒå¯åŠ¨æ¨¡å¼çš„é…ç½®æ–¹æ³•ï¼ˆmodule.json5é…ç½®+ä»£ç å±‚é¢å‚æ•°ä¼ é€’ï¼‰å’Œé€‚ç”¨ä¸šåŠ¡åœºæ™¯ï¼›</li>\n<li>å¤šå®ä¾‹/æŒ‡å®šå®ä¾‹æ¨¡å¼ä¸ç”Ÿå‘½å‘¨æœŸçš„è”åŠ¨å…³ç³»ï¼ˆåˆ†æ<code>onCreate</code>/<code>onNewWant</code>/<code>onWindowStageCreate</code>çš„å·®å¼‚åŒ–è§¦å‘é€»è¾‘ï¼‰ï¼›</li>\n<li>å®æ“éªŒè¯ä¸åŒå¯åŠ¨æ¨¡å¼çš„æ•ˆæœï¼Œè§£å†³å®ä¾‹å†²çªã€å‚æ•°ä¼ é€’å¼‚å¸¸ç­‰å¼€å‘å¸¸è§é—®é¢˜ã€‚</li>\n</ol>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-05 15:55</span>&nbsp;\n<a href=\"https://www.cnblogs.com/san-xiu\">é¸¿è’™-æ•£ä¿®</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">10</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "AIå¼€å‘-python-langchainæ¡†æ¶ï¼ˆ1-11 è¿”å›æšä¸¾-æ ¼å¼è§£æå™¨ï¼‰",
      "link": "https://www.cnblogs.com/yclh/p/19578042",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/yclh/p/19578042\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-05 10:56\">\n    <span>AIå¼€å‘-python-langchainæ¡†æ¶ï¼ˆ1-11 è¿”å›æšä¸¾-æ ¼å¼è§£æå™¨ï¼‰</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p>è·Ÿä¸Šä¸€ç¯‡å†…å®¹ä¸€æ ·ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥çœ‹å¦‚ä½•é™å®šå¤§æ¨¡å‹è¿”å›çš„ç»“æœå€¼æ˜¯æšä¸¾ç±»å‹çš„ã€‚</p>\n<p>å…ˆçœ‹ä»£ç ï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\"># å¯¼å…¥å¿…è¦çš„æ¨¡å—\nfrom langchain.prompts import PromptTemplate          # ç”¨äºåˆ›å»ºå’Œç®¡ç†æç¤ºæ¨¡æ¿\nfrom langchain_openai import ChatOpenAI               # ç”¨äºè°ƒç”¨OpenAIå…¼å®¹çš„èŠå¤©æ¨¡å‹ï¼ˆå¦‚DeepSeekï¼‰\nfrom langchain.output_parsers.enum import EnumOutputParser  # ç”¨äºå°†LLMè¾“å‡ºè§£æä¸ºæšä¸¾ç±»å‹\nfrom enum import Enum                                 # Pythonæ ‡å‡†åº“ï¼Œç”¨äºå®šä¹‰æšä¸¾ç±»å‹\nimport os                                             # ç”¨äºè¯»å–ç¯å¢ƒå˜é‡\n\n# å®šä¹‰é¢œè‰²æšä¸¾ç±»ï¼Œé™å®šLLMè¾“å‡ºå¿…é¡»ä¸ºä»¥ä¸‹äº”ç§é¢œè‰²ä¹‹ä¸€\nclass Colors(Enum):\n    RED = \"çº¢è‰²\"\n    BROWN = \"æ£•è‰²\"\n    BLACK = \"é»‘è‰²\"\n    WHITE = \"ç™½è‰²\"\n    YELLOW = \"é»„è‰²\"\n\n# åˆ›å»ºæšä¸¾è¾“å‡ºè§£æå™¨ï¼Œå¼ºåˆ¶LLMè¾“å‡ºå¿…é¡»åŒ¹é…Colorsæšä¸¾ä¸­çš„å€¼\noutput_parser = EnumOutputParser(enum=Colors)\n\n# è·å–æ ¼å¼åŒ–æŒ‡ä»¤ï¼Œå‘Šè¯‰LLMå¦‚ä½•æ­£ç¡®æ ¼å¼åŒ–è¾“å‡ºï¼ˆä¾‹å¦‚ï¼š\"è¾“å‡ºå¿…é¡»æ˜¯ï¼šçº¢è‰²ã€æ£•è‰²...\"ï¼‰\nformat_instructions = output_parser.get_format_instructions()\nprint(format_instructions)  # æ‰“å°æ ¼å¼è¦æ±‚ï¼Œç”¨äºè°ƒè¯•æˆ–æç¤ºç”¨æˆ·\nprint('###########')         # åˆ†éš”çº¿\n\n# åˆ›å»ºæç¤ºæ¨¡æ¿ï¼šåŒ…å«ä¸¤ä¸ªå ä½ç¬¦ {person}ï¼ˆäººç‰©ï¼‰å’Œ {instructions}ï¼ˆè¾“å‡ºæ ¼å¼è¦æ±‚ï¼‰\npromptTemplate = PromptTemplate.from_template(\n    \"\"\"{person}çš„çš®è‚¤ä¸»è¦æ˜¯ä»€ä¹ˆé¢œè‰²ï¼Ÿ\n{instructions}\"\"\"\n)\n\n# å›ºå®šinstructionséƒ¨åˆ†çš„å†…å®¹ï¼Œé¿å…æ¯æ¬¡è°ƒç”¨æ—¶é‡å¤ä¼ å…¥\ninstructions = \"å“åº”çš„ç»“æœè¯·é€‰æ‹©ä»¥ä¸‹é€‰é¡¹ä¹‹ä¸€ï¼šçº¢è‰²ã€æ£•è‰²ã€é»‘è‰²ã€ç™½è‰²ã€é»„è‰²ã€‚\"\nprompt = promptTemplate.partial(instructions=instructions)  # partialç”¨äºé¢„å¡«å……æ¨¡æ¿ä¸­çš„éƒ¨åˆ†å˜é‡\n\n# è¾“å‡ºå®Œæ•´æç¤ºè¯ç¤ºä¾‹ï¼ˆä»¥\"äºšæ´²äºº\"ä¸ºä¾‹ï¼‰ï¼Œç”¨äºè°ƒè¯•æŸ¥çœ‹å®é™…å‘é€ç»™LLMçš„å†…å®¹\nprint(prompt.invoke({\"person\": \"äºšæ´²äºº\"}).text)\nprint('--------------')\n\n# åˆå§‹åŒ–èŠå¤©æ¨¡å‹ï¼ˆä½¿ç”¨DeepSeek APIï¼‰\nllm = ChatOpenAI(\n    api_key=os.getenv(\"DEEPSEEK_API_KEY\"),            # ä»ç¯å¢ƒå˜é‡è¯»å–APIå¯†é’¥\n    base_url=os.getenv(\"BASE_URL\"),                   # ä»ç¯å¢ƒå˜é‡è¯»å–APIåŸºç¡€URLï¼ˆå¦‚ https://api.deepseek.comï¼‰\n    model=\"deepseek-v3:671b\",                         # æŒ‡å®šä½¿ç”¨çš„æ¨¡å‹ç‰ˆæœ¬\n    temperature=0.7,                                  # ç”Ÿæˆéšæœºæ€§æ§åˆ¶ï¼š0.7 é€‚ä¸­åˆ›é€ æ€§\n    max_tokens=1024                                   # å•æ¬¡å“åº”æœ€å¤§tokenæ•°\n)\n\n# æ„å»ºå¤„ç†é“¾ï¼šæç¤ºæ¨¡æ¿ â†’ å¤§è¯­è¨€æ¨¡å‹ â†’ æšä¸¾è§£æå™¨\n# å®ç°ç«¯åˆ°ç«¯æµç¨‹ï¼šç”Ÿæˆæç¤º â†’ è°ƒç”¨LLM â†’ å¼ºåˆ¶è¾“å‡ºä¸ºæšä¸¾ç±»å‹\nchain = prompt | llm | output_parser\n\n# è°ƒç”¨é“¾ï¼Œä¼ å…¥\"äºšæ´²äºº\"ä½œä¸ºè¾“å…¥\nresult = chain.invoke({\"person\": \"äºšæ´²äºº\"})\n\n# è¾“å‡ºè§£æåçš„ç»“æœï¼ˆEnumç±»å‹ï¼‰\nprint(result)        # æ‰“å°æšä¸¾å¯¹è±¡ï¼ˆå¦‚ï¼šColors.YELLOWï¼‰\nprint(result.name)   # æ‰“å°æšä¸¾æˆå‘˜åç§°ï¼ˆå¦‚ï¼š\"YELLOW\"ï¼‰\nprint(result.value)  # æ‰“å°æšä¸¾æˆå‘˜å€¼ï¼ˆå¦‚ï¼š\"é»„è‰²\"ï¼‰\n</pre>\n</div>\n<p>&nbsp;è¿”å›å€¼ï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">Select one of the following options: çº¢è‰², æ£•è‰², é»‘è‰², ç™½è‰², é»„è‰²\n###########\näºšæ´²äººçš„çš®è‚¤ä¸»è¦æ˜¯ä»€ä¹ˆé¢œè‰²ï¼Ÿ\nå“åº”çš„ç»“æœè¯·é€‰æ‹©ä»¥ä¸‹é€‰é¡¹ä¹‹ä¸€ï¼šçº¢è‰²ã€æ£•è‰²ã€é»‘è‰²ã€ç™½è‰²ã€é»„è‰²ã€‚\n--------------\nColors.YELLOW\nYELLOW\né»„è‰²\n</pre>\n</div>\n<p>&nbsp;</p>\n<p><span style=\"font-size: 18pt;\"><strong>é‡ç‚¹è¯´æ˜ï¼š</strong></span></p>\n<div class=\"response-message-content t2t phase-answer\">\n<div class=\"custom-qwen-markdown\">\n<div class=\"qwen-markdown\">\n<div class=\"qwen-markdown-paragraph\"><strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">ç²¾å‡†æ§åˆ¶å¤§æ¨¡å‹è¾“å‡ºèŒƒå›´</span></strong><br /><span class=\"qwen-markdown-text\">æœ¬æ–¹æ¡ˆçš„æ ¸å¿ƒç›®æ ‡æ˜¯å¼ºåˆ¶å¤§è¯­è¨€æ¨¡å‹è¿”å›é¢„å®šä¹‰çš„æšä¸¾ç±»å‹å€¼ï¼Œå½»åº•è§£å†³è‡ªç”±æ–‡æœ¬è¾“å‡ºçš„ä¸ç¡®å®šæ€§é—®é¢˜ã€‚é€šè¿‡ç»“æ„åŒ–çº¦æŸæœºåˆ¶ï¼Œç¡®ä¿æ¨¡å‹å“åº”ä¸¥æ ¼é™å®šåœ¨ä¸šåŠ¡å…è®¸çš„é€‰é¡¹é›†åˆå†…ï¼ˆå¦‚ä»…è¿”å›â€œçº¢è‰²ã€æ£•è‰²ã€é»‘è‰²ã€ç™½è‰²ã€é»„è‰²â€ï¼‰ï¼Œä»æºå¤´æœç»â€œæµ…é»„â€â€œç±³ç™½â€ç­‰éæ ‡å‡†å€¼ï¼Œæ˜¾è‘—æå‡ç³»ç»Ÿå¯é æ€§ä¸æ•°æ®ä¸€è‡´æ€§ã€‚</span></div>\n<div class=\"qwen-markdown-space\">&nbsp;</div>\n<div class=\"qwen-markdown-paragraph\"><strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">åŒé‡çº¦æŸä¿éšœè¾“å‡ºåˆè§„æ€§</span></strong><br /><span class=\"qwen-markdown-text\">æšä¸¾è¾“å‡ºè§£æå™¨ï¼ˆEnumOutputParserï¼‰æ„å»ºå‰åç«¯åŒé‡é˜²æŠ¤ï¼šå‰ç«¯é€šè¿‡<code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">get_format_instructions()</code><span class=\"qwen-markdown-text\">è‡ªåŠ¨ç”Ÿæˆæ ¼å¼æŒ‡ä»¤å¹¶æ³¨å…¥æç¤ºè¯ï¼Œæ˜ç¡®å¼•å¯¼æ¨¡å‹â€œä»…å¯é€‰æ‹©ä»¥ä¸‹é€‰é¡¹ä¹‹ä¸€â€ï¼›åç«¯åœ¨è§£æé˜¶æ®µå¯¹è¿”å›ç»“æœè¿›è¡Œå¼ºæ ¡éªŒï¼Œä»»ä½•è¶…å‡ºæšä¸¾èŒƒå›´çš„å€¼å°†ç«‹å³æŠ›å‡º<code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">OutputParserException</code><span class=\"qwen-markdown-text\">å¼‚å¸¸ï¼Œå½¢æˆä»ç”Ÿæˆåˆ°è§£æçš„å…¨é“¾è·¯çº¦æŸã€‚</span></span></span></div>\n<div class=\"qwen-markdown-space\">&nbsp;</div>\n<div class=\"qwen-markdown-paragraph\"><strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">æšä¸¾ç±»å‹å®šä¹‰æ•°æ®å¥‘çº¦</span></strong><br /><span class=\"qwen-markdown-text\">é€šè¿‡Pythonçš„Enumç±»é¢„å…ˆå£°æ˜åˆæ³•å€¼é›†åˆï¼ˆå¦‚<code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">Colors</code><span class=\"qwen-markdown-text\">æšä¸¾ï¼‰ï¼Œå»ºç«‹ç³»ç»Ÿä¸æ¨¡å‹ä¹‹é—´çš„æ ‡å‡†åŒ–æ•°æ®å¥‘çº¦ã€‚è¯¥è®¾è®¡ä¸ä»…æ˜ç¡®ä¸šåŠ¡è§„åˆ™è¾¹ç•Œï¼Œæ›´ä½¿æ¨¡å‹è¾“å‡ºç›´æ¥è½¬æ¢ä¸ºç±»å‹å®‰å…¨çš„æšä¸¾å¯¹è±¡ï¼Œå¼€å‘è€…å¯ç›´æ¥é€šè¿‡<code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">.name</code><span class=\"qwen-markdown-text\">ï¼ˆå¦‚\"YELLOW\"ï¼‰å’Œ<code class=\"qwen-markdown-codespan\" style=\"cursor: pointer;\">.value</code><span class=\"qwen-markdown-text\">ï¼ˆå¦‚\"é»„è‰²\"ï¼‰å±æ€§è·å–ç»“æ„åŒ–ç»“æœï¼Œå½»åº•è§„é¿å­—ç¬¦ä¸²æ¸…æ´—ä¸åŒ¹é…çš„ç¹çå¤„ç†ã€‚</span></span></span></span></div>\n&nbsp;\n<div class=\"qwen-markdown-paragraph\"><strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">å…¸å‹åº”ç”¨åœºæ™¯ä¸ä¸šåŠ¡ä»·å€¼</span></strong><br /><span class=\"qwen-markdown-text\">è¯¥æ–¹æ¡ˆç‰¹åˆ«é€‚ç”¨äºéœ€ä¸¥æ ¼è¾“å‡ºæ§åˆ¶çš„åœºæ™¯ï¼šæƒ…æ„Ÿåˆ†æé™å®š{æ­£é¢/ä¸­æ€§/è´Ÿé¢}ã€å®¡æ‰¹çŠ¶æ€çº¦æŸ{å¾…å®¡/é€šè¿‡/æ‹’ç»}ã€é¢œè‰²è¯†åˆ«è§„èŒƒæ ‡å‡†è‰²ç³»ç­‰ã€‚ç›¸æ¯”ä¼ ç»Ÿä¾èµ–æ­£åˆ™è¡¨è¾¾å¼æˆ–å…³é”®è¯åŒ¹é…çš„åå¤„ç†æ–¹æ¡ˆï¼Œæšä¸¾æ§åˆ¶ä»è®¾è®¡å±‚é¢æ ¹é™¤è„æ•°æ®é£é™©ï¼Œé™ä½90%ä»¥ä¸Šçš„æ•°æ®æ¸…æ´—æˆæœ¬ï¼Œä¸ºå…³é”®ä¸šåŠ¡ç³»ç»Ÿæä¾›ç¡®å®šæ€§ä¿éšœã€‚</span></div>\n<div class=\"qwen-markdown-space\">&nbsp;</div>\n<div class=\"qwen-markdown-paragraph\"><strong class=\"qwen-markdown-strong\"><span class=\"qwen-markdown-text\">å¢å¼ºé²æ£’æ€§çš„å®è·µå»ºè®®</span></strong><br /><span class=\"qwen-markdown-text\">å®é™…éƒ¨ç½²æ—¶å»ºè®®ç»“åˆé‡è¯•æœºåˆ¶æå‡å®¹é”™èƒ½åŠ›ï¼šå½“æ¨¡å‹é¦–æ¬¡è¾“å‡ºä¸ç¬¦åˆæšä¸¾è¦æ±‚æ—¶ï¼Œè‡ªåŠ¨è§¦å‘2-3æ¬¡é‡è¯•å¹¶å¼ºåŒ–æ ¼å¼æç¤ºï¼ŒæˆåŠŸç‡å¯è¾¾99%ä»¥ä¸Šã€‚å¯¹äºé‡‘èã€åŒ»ç–—ç­‰å…³é”®åœºæ™¯ï¼Œå¯è®¾ç½®å¼‚å¸¸å…œåº•ç­–ç•¥â€”â€”è¿ç»­è§£æå¤±è´¥æ—¶è‡ªåŠ¨è½¬äº¤äººå·¥å®¡æ ¸ï¼Œå½¢æˆâ€œè‡ªåŠ¨çº¦æŸ+äººå·¥å…œåº•â€çš„å®Œæ•´è´¨é‡ä¿éšœé—­ç¯ã€‚</span></div>\n\n</div>\n\n</div>\n\n</div>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-05 10:56</span>&nbsp;\n<a href=\"https://www.cnblogs.com/yclh\">ä¸‡ç¬‘ä½›</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">11</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "LVMåŠ¨æ€æ‰©å®¹å®Œå…¨æŒ‡å—ï½œå°ç™½ä¹Ÿèƒ½ä¸Šæ‰‹ï¼Œé›¶åœæœºæ‰©å±•ç£ç›˜ç©ºé—´ï¼ˆ5ç§æ–¹æ³•ï¼‰",
      "link": "https://www.cnblogs.com/liuziyi1/p/19577932",
      "published": "",
      "description": "<h2>\n\t\t\t<a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/liuziyi1/p/19577932\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-05 10:42\">\n    <span>LVMåŠ¨æ€æ‰©å®¹å®Œå…¨æŒ‡å—ï½œå°ç™½ä¹Ÿèƒ½ä¸Šæ‰‹ï¼Œé›¶åœæœºæ‰©å±•ç£ç›˜ç©ºé—´ï¼ˆ5ç§æ–¹æ³•ï¼‰</span>\n    \n\n</a>\n\n\t\t</h2>\n\t\t<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>åšè¿ç»´ã€ææœåŠ¡å™¨çš„å°ä¼™ä¼´ï¼Œè‚¯å®šé‡åˆ°è¿‡è¿™ç§å´©æºƒåœºæ™¯ï¼š</p>\n<p>åŠå¤œè¢«å‘Šè­¦æƒŠé†’ï¼Œæç¤ºç£ç›˜ç©ºé—´æ»¡äº†ï¼ŒMySQLã€æ—¥å¿—æœåŠ¡ç›´æ¥å¡å£³ï¼›æƒ³æ‰©å®¹ï¼Œå´å‘ç°ä¼ ç»Ÿç£ç›˜åˆ†åŒºä¸€æ—¦åˆ›å»ºå°±å›ºå®šå¤§å°ï¼Œæ”¹èµ·æ¥åˆéº»çƒ¦åˆå®¹æ˜“ä¸¢æ•°æ®â€¦â€¦</p>\n<p>åˆ«æ…Œï¼ä»Šå¤©ç»™å¤§å®¶å¸¦æ¥ <strong>LVMåŠ¨æ€æ‰©å®¹å®Œå…¨æŒ‡å—</strong>ï¼Œä»åŸºç¡€ç†è®ºåˆ°å®æ“æ­¥éª¤ï¼Œå…¨ç¨‹é€šä¿—æ‹†è§£ï¼Œå°ç™½ä¹Ÿèƒ½è·Ÿç€ä¸€æ­¥æ­¥åšï¼Œè½»æ¾å®ç°ã€Œé›¶åœæœºæ‰©å®¹ã€ï¼Œå†ä¹Ÿä¸ç”¨æ€•ç£ç›˜å‘Šè­¦ã€‚</p>\n<p>å…ˆä¸€å¥è¯ææ‡‚LVMï¼šå®ƒå°±åƒä¸€ä¸ªã€Œç£ç›˜é­”æœ¯ç›’ã€ï¼Œèƒ½æŠŠå¤šå—ç‰©ç†ç¡¬ç›˜ï¼ˆæˆ–äº‘ç›˜ï¼‰æ•´åˆèµ·æ¥ï¼Œå˜æˆä¸€ä¸ªç»Ÿä¸€çš„ã€Œå­˜å‚¨æ°´æ± ã€ï¼Œåç»­æ‰©å®¹ã€ç¼©å®¹ä¸ç”¨åŠ¨åº•å±‚ç¡¬ç›˜ï¼Œä¹Ÿä¸ç”¨åœä¸šåŠ¡ï¼Œçµæ´»åˆå®‰å…¨ã€‚</p>\n<h1 id=\"ä¸€å…ˆææ‡‚lvmæ˜¯ä»€ä¹ˆä¸ºä»€ä¹ˆè¦ç”¨å®ƒ\">ä¸€ã€å…ˆææ‡‚ï¼šLVMæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨å®ƒï¼Ÿ</h1>\n<h2 id=\"11-æ ¸å¿ƒèƒŒæ™¯å°ç™½å¿…çœ‹\">1.1 æ ¸å¿ƒèƒŒæ™¯ï¼ˆå°ç™½å¿…çœ‹ï¼‰</h2>\n<p>ä¼ ç»Ÿç£ç›˜åˆ†åŒºï¼ˆæ¯”å¦‚/dev/sda1ï¼‰ï¼Œåˆ›å»ºæ—¶å¤šå¤§ï¼Œåç»­å°±åªèƒ½ç”¨å¤šå¤§ï¼Œæƒ³æ‰©å®¹å°±å¾—é‡æ–°åˆ†åŒºã€æ ¼å¼åŒ–ï¼Œä¸ä»…éº»çƒ¦ï¼Œè¿˜å®¹æ˜“ä¸¢å¤±æ•°æ®ï¼Œå°¤å…¶ç”Ÿäº§ç¯å¢ƒæ ¹æœ¬ä¸æ•¢åŠ¨ã€‚</p>\n<p>LVMï¼ˆé€»è¾‘å·ç®¡ç†å™¨ï¼‰çš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªç—›ç‚¹â€”â€”å®ƒåœ¨ç‰©ç†ç¡¬ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿä¹‹é—´åŠ äº†ä¸€å±‚ã€Œä¸­é—´å±‚ã€ï¼ŒæŠŠå¤šå—ç¡¬ç›˜æ•´åˆä¸ºä¸€ä¸ªã€Œå­˜å‚¨æ± ã€ï¼Œç©ºé—´å¯ä»¥è‡ªç”±åˆ†é…ã€éšæ—¶æ‰©å®¹ï¼Œä¸ç”¨å…³å¿ƒåº•å±‚ç¡¬ç›˜çš„è¾¹ç•Œã€‚</p>\n<p>é‡ç‚¹ä¼˜åŠ¿ï¼š<strong>é›¶åœæœºæ‰©å®¹</strong>ï¼Œä¸šåŠ¡å®Œå…¨æ— æ„ŸçŸ¥ï¼›å¤šç¡¬ç›˜æ•´åˆï¼Œæ‰“ç ´å•ç›˜å®¹é‡é™åˆ¶ï¼›æ”¯æŒå¿«ç…§å¤‡ä»½ï¼Œæ•°æ®æ›´å®‰å…¨ã€‚</p>\n<h2 id=\"12-å°ç™½èƒ½æ‡‚çš„æ ¸å¿ƒæœ¯è¯­å¿…è®°3ä¸ª\">1.2 å°ç™½èƒ½æ‡‚çš„æ ¸å¿ƒæœ¯è¯­ï¼ˆå¿…è®°3ä¸ªï¼‰</h2>\n<p>LVMå°±åƒã€Œæ°´æ± ç³»ç»Ÿã€ï¼Œè®°ä½è¿™3ä¸ªæœ¯è¯­ï¼Œåç»­æ“ä½œä¸è¿·è·¯ï¼š</p>\n<ul>\n<li>\n<p><strong>PVï¼ˆç‰©ç†å·ï¼‰</strong>ï¼šæœ€åº•å±‚çš„ã€Œæ°´æºã€ï¼Œå°±æ˜¯æˆ‘ä»¬çš„ç‰©ç†ç¡¬ç›˜ï¼ˆæ¯”å¦‚/dev/sdbï¼‰ã€äº‘ç›˜ï¼Œæ˜¯LVMç®¡ç†çš„æœ€å°ç‰©ç†å•å…ƒã€‚</p>\n</li>\n<li>\n<p><strong>VGï¼ˆå·ç»„ï¼‰</strong>ï¼šæŠŠå¤šä¸ªPVæ•´åˆèµ·æ¥çš„ã€Œå¤§æ°´æ± ã€ï¼Œç›¸å½“äºæŠŠå¤šå—å°ç¡¬ç›˜åˆå¹¶æˆä¸€ä¸ªå¤§å­˜å‚¨æ± ï¼Œç»Ÿä¸€ç®¡ç†ç©ºé—´ã€‚</p>\n</li>\n<li>\n<p><strong>LVï¼ˆé€»è¾‘å·ï¼‰</strong>ï¼šä»VGã€Œå¤§æ°´æ± ã€é‡Œåˆ†å‡ºæ¥çš„ã€Œå°æ°´ç›†ã€ï¼Œæˆ‘ä»¬å®é™…ä½¿ç”¨çš„ç£ç›˜ç©ºé—´ï¼ˆæ¯”å¦‚æŒ‚è½½åˆ°/var/lib/mysqlçš„åˆ†åŒºï¼‰ï¼Œå°±æ˜¯LVã€‚</p>\n</li>\n</ul>\n<p>ç®€å•ç±»æ¯”ï¼šPV=å¤šä¸ªå°æ°´æ¡¶ï¼ŒVG=æŠŠå°æ°´æ¡¶éƒ½å€’è¿›ä¸€ä¸ªå¤§æ°´æ± ï¼ŒLV=ä»å¤§æ°´æ± é‡Œèˆ€å‡ºçš„ä¸€ç¢—æ°´ï¼ˆæˆ‘ä»¬å®é™…ç”¨çš„ï¼‰ã€‚æ‰©å®¹ï¼Œå°±æ˜¯ç»™å¤§æ°´æ± åŠ æ°´ï¼ˆåŠ PVï¼‰ï¼Œæˆ–è€…æŠŠç¢—å˜å¤§ï¼ˆæ‰©LVï¼‰ã€‚</p>\n<h2 id=\"13-é€‚ç”¨åœºæ™¯çœ‹çœ‹ä½ æœ‰æ²¡æœ‰éœ€æ±‚\">1.3 é€‚ç”¨åœºæ™¯ï¼ˆçœ‹çœ‹ä½ æœ‰æ²¡æœ‰éœ€æ±‚ï¼‰</h2>\n<ul>\n<li>\n<p>æ•°æ®åº“æœåŠ¡å™¨ï¼ˆMySQLã€PostgreSQLï¼‰ï¼šæ•°æ®è¶Šå­˜è¶Šå¤šï¼Œéœ€è¦åœ¨çº¿æ‰©å®¹ï¼Œä¸èƒ½åœåº“ã€‚</p>\n</li>\n<li>\n<p>è™šæ‹Ÿæœº/å®¹å™¨ï¼ˆKVMã€K8sï¼‰ï¼šè™šæ‹Ÿæœºç£ç›˜ä¸å¤Ÿç”¨ï¼Œå®¹å™¨æŒä¹…åŒ–å­˜å‚¨ä¸è¶³ï¼Œéœ€è¦çµæ´»æ‰©å®¹ã€‚</p>\n</li>\n<li>\n<p>æ—¥å¿—æœåŠ¡å™¨ï¼ˆELKï¼‰ï¼šæ—¥å¿—é‡çªå¢ï¼Œç£ç›˜å¾ˆå¿«æ»¡ï¼Œéœ€è¦å¿«é€Ÿæ‰©å®¹ã€‚</p>\n</li>\n<li>\n<p>æ™®é€šæœåŠ¡å™¨ï¼šå¤šå—å°ç¡¬ç›˜ï¼Œæƒ³åˆå¹¶æˆä¸€å—å¤§ç©ºé—´ä½¿ç”¨ï¼Œåç»­æ–¹ä¾¿æ‰©å®¹ã€‚</p>\n</li>\n</ul>\n<h2 id=\"14-ç¯å¢ƒè¦æ±‚æå‰å‡†å¤‡é¿å…è¸©å‘\">1.4 ç¯å¢ƒè¦æ±‚ï¼ˆæå‰å‡†å¤‡ï¼Œé¿å…è¸©å‘ï¼‰</h2>\n<p>ä¸ç”¨è®°å¤ªå¤æ‚ï¼Œæ»¡è¶³è¿™å‡ ä¸ªåŸºç¡€æ¡ä»¶å³å¯ï¼š</p>\n<ul>\n<li>\n<p>æ“ä½œç³»ç»Ÿï¼šCentOS 8+/Ubuntu 20.04+/Debian 11+ï¼ˆä¸»æµç‰ˆæœ¬éƒ½æ”¯æŒï¼‰ã€‚</p>\n</li>\n<li>\n<p>å®‰è£…LVMå·¥å…·ï¼šç³»ç»Ÿä¸€èˆ¬é»˜è®¤å®‰è£…ï¼Œæ²¡æœ‰çš„è¯ï¼Œä¸‹æ–‡æœ‰å®‰è£…å‘½ä»¤ã€‚</p>\n</li>\n<li>\n<p>ç£ç›˜ï¼šè‡³å°‘æœ‰1å—æœªä½¿ç”¨çš„ç¡¬ç›˜/åˆ†åŒºï¼ˆæˆ–å·²æ‰©å®¹çš„äº‘ç›˜ï¼‰ï¼Œç”¨äºæ‰©å®¹ã€‚</p>\n</li>\n</ul>\n<h1 id=\"äºŒå®æ“å‡†å¤‡3æ­¥æå®šå‰ç½®å·¥ä½œå¿…åš\">äºŒã€å®æ“å‡†å¤‡ï¼š3æ­¥æå®šå‰ç½®å·¥ä½œï¼ˆå¿…åšï¼‰</h1>\n<p>å¼€å§‹æ‰©å®¹å‰ï¼Œå…ˆåšå¥½è¿™3æ­¥ï¼Œé¿å…æ“ä½œå‡ºé”™ï¼Œå°ç™½ä¹Ÿèƒ½è½»æ¾å®Œæˆã€‚</p>\n<h2 id=\"21-æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒç¡®è®¤æ”¯æŒlvm\">2.1 æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒï¼ˆç¡®è®¤æ”¯æŒLVMï¼‰</h2>\n<p>å¤åˆ¶ä¸‹é¢çš„å‘½ä»¤ï¼Œä¾æ¬¡æ‰§è¡Œï¼ŒæŸ¥çœ‹ç³»ç»Ÿæ˜¯å¦æ”¯æŒLVMï¼ˆä¸ç”¨æ‡‚å‘½ä»¤å«ä¹‰ï¼Œæ‰§è¡Œå°±è¡Œï¼‰ï¼š</p>\n<pre><code class=\"language-bash\"># æ£€æŸ¥æ“ä½œç³»ç»Ÿç‰ˆæœ¬\ncat /etc/os-release | grep -E \"^(NAME|VERSION)=\"\n\n# æ£€æŸ¥LVMç‰ˆæœ¬ï¼ˆæœ‰è¾“å‡ºå°±æ˜¯å·²å®‰è£…ï¼‰\nlvm version 2&gt;&amp;1 | head -5\n\n# æ£€æŸ¥å†…æ ¸æ¨¡å—ï¼ˆç¡®ä¿LVMèƒ½æ­£å¸¸å·¥ä½œï¼‰\nlsmod | grep -E \"^dm_\"\n\n# è‹¥æ²¡æœ‰è¾“å‡ºï¼ˆæ¨¡å—æœªåŠ è½½ï¼‰ï¼Œæ‰§è¡Œä¸‹é¢2è¡Œå‘½ä»¤åŠ è½½\nmodprobe dm-mod\nmodprobe dm-snapshot\n</code></pre>\n<h2 id=\"22-å®‰è£…lvmå·¥å…·æœªå®‰è£…åˆ™æ‰§è¡Œ\">2.2 å®‰è£…LVMå·¥å…·ï¼ˆæœªå®‰è£…åˆ™æ‰§è¡Œï¼‰</h2>\n<pre><code class=\"language-bash\"># CentOS/Rocky Linuxï¼ˆçº¢å¸½ç³»ï¼‰\ndnf install -y lvm2 device-mapper-persistent-data\n\n# Ubuntu/Debianï¼ˆdebianç³»ï¼‰\napt update &amp;&amp; apt install -y lvm2 thin-provisioning-tools\n\n# éªŒè¯å®‰è£…ï¼ˆæœ‰è¾“å‡ºå°±æ˜¯å®‰è£…æˆåŠŸï¼‰\npvs --version\n</code></pre>\n<h2 id=\"23-æ£€æŸ¥ç£ç›˜çŠ¶æ€å…³é”®é¿å…è¯¯æ“ä½œ\">2.3 æ£€æŸ¥ç£ç›˜çŠ¶æ€ï¼ˆå…³é”®ï¼é¿å…è¯¯æ“ä½œï¼‰</h2>\n<p>æ‰§è¡Œå‘½ä»¤ï¼ŒæŸ¥çœ‹å½“å‰ç£ç›˜æƒ…å†µï¼Œç¡®è®¤æœ‰æœªä½¿ç”¨çš„ç£ç›˜ï¼ˆæ¯”å¦‚/dev/sdbï¼Œæ²¡æœ‰æŒ‚è½½ç‚¹ï¼Œæ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼š</p>\n<pre><code class=\"language-bash\"># åˆ—å‡ºæ‰€æœ‰ç£ç›˜ï¼Œé‡ç‚¹çœ‹ã€ŒMOUNTPOINTã€åˆ—ï¼ˆç©ºçš„å°±æ˜¯æœªä½¿ç”¨ï¼‰\nlsblk -o NAME,SIZE,TYPE,FSTYPE,MOUNTPOINT\n</code></pre>\n<p>è¾“å‡ºç¤ºä¾‹ï¼ˆé‡ç‚¹çœ‹sdbï¼ŒæœªæŒ‚è½½ã€æ— æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ç”¨äºæ‰©å®¹ï¼‰ï¼š</p>\n<p>NAME SIZE TYPE FSTYPE MOUNTPOINT sda 50G disk â”œâ”€sda1 1G part xfs /boot â””â”€sda2 49G part LVM2_member sdb 100G disk ï¼ˆæœªä½¿ç”¨ï¼Œå¯åšPVï¼‰</p>\n<p>âš ï¸ è­¦å‘Šï¼šä¸€å®šè¦ç¡®è®¤ç£ç›˜æ— æ•°æ®ã€æœªæŒ‚è½½ï¼Œå¦åˆ™æ“ä½œä¼šä¸¢å¤±æ•°æ®ï¼</p>\n<h1 id=\"ä¸‰æ ¸å¿ƒå®æ“5ç§lvmæ‰©å®¹æ–¹æ³•å°ç™½ä¼˜å…ˆçœ‹å‰3ç§\">ä¸‰ã€æ ¸å¿ƒå®æ“ï¼š5ç§LVMæ‰©å®¹æ–¹æ³•ï¼ˆå°ç™½ä¼˜å…ˆçœ‹å‰3ç§ï¼‰</h1>\n<p>ä»¥ä¸‹5ç§æ–¹æ³•ï¼Œè¦†ç›–ä¸åŒåœºæ™¯ï¼Œå°ç™½ä¼˜å…ˆæŒæ¡ã€Œæ–¹æ³•ä¸€ã€äºŒã€ä¸‰ã€ï¼ˆæœ€å¸¸ç”¨ã€æœ€ç®€å•ï¼‰ï¼Œæ–¹æ³•å››ã€äº”é€‚åˆç‰¹å®šåœºæ™¯ï¼ˆè™šæ‹ŸåŒ–ã€å¤‡ä»½å­˜å‚¨ï¼‰ã€‚</p>\n<p>æ‰€æœ‰å‘½ä»¤éƒ½å¯ä»¥ç›´æ¥å¤åˆ¶æ‰§è¡Œï¼Œé‡ç‚¹çœ‹ã€Œæ­¥éª¤+æ³¨é‡Šã€ï¼Œä¸ç”¨æ­»è®°å‘½ä»¤å«ä¹‰ã€‚</p>\n<h2 id=\"æ–¹æ³•ä¸€æ·»åŠ æ–°ç£ç›˜æœ€å¸¸ç”¨-æ–°å¢ç¡¬ç›˜äº‘ç›˜æ‰©å±•vgå†æ‰©lv\">æ–¹æ³•ä¸€ï¼šæ·»åŠ æ–°ç£ç›˜ï¼ˆæœ€å¸¸ç”¨ï¼‰â€”â€” æ–°å¢ç¡¬ç›˜/äº‘ç›˜ï¼Œæ‰©å±•VGå†æ‰©LV</h2>\n<p>åœºæ™¯ï¼šæœåŠ¡å™¨æ–°å¢ç‰©ç†ç¡¬ç›˜ï¼Œæˆ–äº‘ä¸»æœºæŒ‚è½½æ–°äº‘ç›˜ï¼ˆæ¯”å¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘æ–°å¢äº‘ç›˜ï¼‰ï¼Œæœ€é€šç”¨çš„æ‰©å®¹æ–¹å¼ã€‚</p>\n<p>æ­¥éª¤ï¼ˆ4æ­¥æå®šï¼Œå…¨ç¨‹åœ¨çº¿ï¼Œä¸ç”¨åœä¸šåŠ¡ï¼‰ï¼š</p>\n<h3 id=\"æ­¥éª¤1åˆ›å»ºpvæŠŠæ–°ç£ç›˜å˜æˆæ°´æº\">æ­¥éª¤1ï¼šåˆ›å»ºPVï¼ˆæŠŠæ–°ç£ç›˜å˜æˆã€Œæ°´æºã€ï¼‰</h3>\n<pre><code class=\"language-bash\"># æŠŠæ–°ç£ç›˜ï¼ˆ/dev/sdbï¼‰åˆå§‹åŒ–ä¸ºPVï¼ˆæ›¿æ¢æˆä½ çš„ç£ç›˜è·¯å¾„ï¼Œæ¯”å¦‚/dev/sdcï¼‰\npvcreate /dev/sdb\n\n# éªŒè¯PVåˆ›å»ºæˆåŠŸï¼ˆæœ‰è¾“å‡ºå°±æ˜¯æˆåŠŸï¼‰\npvdisplay /dev/sdb\n</code></pre>\n<h3 id=\"æ­¥éª¤2æ‰©å±•vgç»™å¤§æ°´æ± åŠ æ°´\">æ­¥éª¤2ï¼šæ‰©å±•VGï¼ˆç»™ã€Œå¤§æ°´æ± ã€åŠ æ°´ï¼‰</h3>\n<pre><code class=\"language-bash\"># æŠŠæ–°åˆ›å»ºçš„PVï¼ˆ/dev/sdbï¼‰åŠ å…¥ç°æœ‰çš„VGï¼ˆæ›¿æ¢æˆä½ çš„VGåç§°ï¼Œæ¯”å¦‚vg_dataï¼‰\n# ä¸çŸ¥é“VGåç§°ï¼Ÿæ‰§è¡Œvgså‘½ä»¤æŸ¥çœ‹\nvgextend vg_data /dev/sdb\n\n# éªŒè¯VGæ‰©å±•æˆåŠŸï¼ˆæŸ¥çœ‹VGå‰©ä½™ç©ºé—´ï¼Œæœ‰æ–°å¢ç©ºé—´å°±æ˜¯æˆåŠŸï¼‰\nvgdisplay vg_data | grep -E \"(VG Size|Free)\"\n</code></pre>\n<h3 id=\"æ­¥éª¤3æ‰©å±•lvæŠŠå°æ°´ç›†å˜å¤§\">æ­¥éª¤3ï¼šæ‰©å±•LVï¼ˆæŠŠã€Œå°æ°´ç›†ã€å˜å¤§ï¼‰</h3>\n<pre><code class=\"language-bash\"># 3ç§æ–¹å¼ï¼Œé€‰ä¸€ç§å³å¯ï¼ˆæ›¿æ¢æˆä½ çš„LVè·¯å¾„ï¼Œæ¯”å¦‚/dev/vg_data/lv_mysqlï¼‰\n# æ–¹å¼1ï¼šæ‰©å±•æŒ‡å®šå¤§å°ï¼ˆæ¯”å¦‚æ–°å¢50Gï¼‰\nlvextend -L +50G /dev/vg_data/lv_mysql\n\n# æ–¹å¼2ï¼šæ‰©å±•åˆ°æŒ‡å®šå¤§å°ï¼ˆæ¯”å¦‚æ‰©å±•åˆ°150Gï¼‰\nlvextend -L 150G /dev/vg_data/lv_mysql\n\n# æ–¹å¼3ï¼šä½¿ç”¨VGæ‰€æœ‰å‰©ä½™ç©ºé—´ï¼ˆæ¨èï¼Œç›´æ¥ç”¨æ»¡æ–°å¢çš„ç©ºé—´ï¼‰\nlvextend -l +100%FREE /dev/vg_data/lv_mysql\n\n# éªŒè¯LVæ‰©å±•æˆåŠŸï¼ˆæŸ¥çœ‹LVå¤§å°ï¼Œå˜å¤§å°±æ˜¯æˆåŠŸï¼‰\nlvdisplay /dev/vg_data/lv_mysql | grep \"LV Size\"\n</code></pre>\n<h3 id=\"æ­¥éª¤4æ‰©å±•æ–‡ä»¶ç³»ç»Ÿå…³é”®è®©ç³»ç»Ÿè¯†åˆ«æ–°å¢ç©ºé—´\">æ­¥éª¤4ï¼šæ‰©å±•æ–‡ä»¶ç³»ç»Ÿï¼ˆå…³é”®ï¼è®©ç³»ç»Ÿè¯†åˆ«æ–°å¢ç©ºé—´ï¼‰</h3>\n<p>LVæ‰©å±•åï¼Œç³»ç»Ÿè¿˜è¯†åˆ«ä¸åˆ°æ–°å¢ç©ºé—´ï¼Œéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ ¹æ®ä½ çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹é€‰æ‹©ï¼ˆå¸¸è§ext4ã€XFSï¼‰ï¼š</p>\n<pre><code class=\"language-bash\"># æƒ…å†µ1ï¼šæ–‡ä»¶ç³»ç»Ÿæ˜¯ext4ï¼ˆæ‰§è¡Œè¿™ä¸ªï¼‰\nresize2fs /dev/vg_data/lv_mysql\n\n# æƒ…å†µ2ï¼šæ–‡ä»¶ç³»ç»Ÿæ˜¯XFSï¼ˆæ‰§è¡Œè¿™ä¸ªï¼Œæ›¿æ¢æˆLVçš„æŒ‚è½½ç‚¹ï¼Œæ¯”å¦‚/data/mysqlï¼‰\nxfs_growfs /data/mysql\n\n# éªŒè¯æˆåŠŸï¼ˆæŸ¥çœ‹æŒ‚è½½ç‚¹ç©ºé—´ï¼Œå˜å¤§å°±æ˜¯æˆåŠŸï¼‰\ndf -hT /data/mysql\n</code></pre>\n<p>âœ… å®Œæˆï¼šå…¨ç¨‹ä¸ç”¨åœä¸šåŠ¡ï¼Œç£ç›˜ç©ºé—´å·²ç»æ‰©å®¹æˆåŠŸï¼</p>\n<h2 id=\"æ–¹æ³•äºŒæ‰©å±•ç°æœ‰ç£ç›˜äº‘ç›˜å¸¸ç”¨-äº‘ç›˜æ‰©å®¹åæ‰©å±•ç°æœ‰pv\">æ–¹æ³•äºŒï¼šæ‰©å±•ç°æœ‰ç£ç›˜ï¼ˆäº‘ç›˜å¸¸ç”¨ï¼‰â€”â€” äº‘ç›˜æ‰©å®¹åï¼Œæ‰©å±•ç°æœ‰PV</h2>\n<p>åœºæ™¯ï¼šäº‘ä¸»æœºï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ï¼‰åœ¨æ§åˆ¶å°æ‰©å®¹äº†äº‘ç›˜ï¼ˆæ¯”å¦‚æŠŠ50Gäº‘ç›˜æ‰©åˆ°100Gï¼‰ï¼Œä½†ç³»ç»Ÿé‡Œçœ‹ä¸åˆ°æ–°å¢ç©ºé—´ï¼Œéœ€è¦æŠŠæ–°å¢ç©ºé—´çº³å…¥LVMç®¡ç†ã€‚</p>\n<p>æ­¥éª¤ï¼ˆ4æ­¥ï¼Œä¸ç”¨åŠ æ–°ç£ç›˜ï¼Œç›´æ¥æ‰©ç°æœ‰ç©ºé—´ï¼‰ï¼š</p>\n<h3 id=\"æ­¥éª¤1ç¡®è®¤äº‘ç›˜å·²æ‰©å®¹è®©ç³»ç»Ÿè¯†åˆ«æ–°å®¹é‡\">æ­¥éª¤1ï¼šç¡®è®¤äº‘ç›˜å·²æ‰©å®¹ï¼ˆè®©ç³»ç»Ÿè¯†åˆ«æ–°å®¹é‡ï¼‰</h3>\n<pre><code class=\"language-bash\"># é‡æ–°æ‰«æç£ç›˜ï¼ˆäº‘ç›˜çƒ­æ‰©å®¹åå¿…æ‰§è¡Œï¼Œè®©ç³»ç»Ÿè¯†åˆ«æ–°å®¹é‡ï¼‰\necho 1 &gt; /sys/class/block/sdb/device/rescan\n\n# ç¡®è®¤ç£ç›˜æ–°å®¹é‡ï¼ˆæŸ¥çœ‹ç£ç›˜å¤§å°ï¼Œå·²ç»å˜æˆæ‰©å®¹åçš„å¤§å°å°±æ˜¯æˆåŠŸï¼‰\nlsblk /dev/sdb\nfdisk -l /dev/sdb\n</code></pre>\n<h3 id=\"æ­¥éª¤2æ‰©å±•ç£ç›˜åˆ†åŒºè®©åˆ†åŒºå ç”¨æ–°å¢ç©ºé—´\">æ­¥éª¤2ï¼šæ‰©å±•ç£ç›˜åˆ†åŒºï¼ˆè®©åˆ†åŒºå ç”¨æ–°å¢ç©ºé—´ï¼‰</h3>\n<pre><code class=\"language-bash\"># å®‰è£…æ‰©å±•å·¥å…·ï¼ˆçº¢å¸½ç³»ã€debianç³»äºŒé€‰ä¸€ï¼‰\ndnf install -y cloud-utils-growpart  # CentOS/Rocky Linux\napt install -y cloud-guest-utils     # Ubuntu/Debian\n\n# æ‰©å±•åˆ†åŒºï¼ˆæ›¿æ¢æˆä½ çš„ç£ç›˜å’Œåˆ†åŒºï¼Œæ¯”å¦‚/dev/sdbçš„ç¬¬1ä¸ªåˆ†åŒºï¼‰\ngrowpart /dev/sdb 1\n</code></pre>\n<h3 id=\"æ­¥éª¤3æ‰©å±•pvè®©lvmè¯†åˆ«åˆ†åŒºçš„æ–°å¢ç©ºé—´\">æ­¥éª¤3ï¼šæ‰©å±•PVï¼ˆè®©LVMè¯†åˆ«åˆ†åŒºçš„æ–°å¢ç©ºé—´ï¼‰</h3>\n<pre><code class=\"language-bash\"># è°ƒæ•´PVå¤§å°ï¼ˆæ›¿æ¢æˆä½ çš„åˆ†åŒºè·¯å¾„ï¼Œæ¯”å¦‚/dev/sdb1ï¼‰\npvresize /dev/sdb1\n\n# éªŒè¯æˆåŠŸï¼ˆæŸ¥çœ‹PVå‰©ä½™ç©ºé—´ï¼Œæœ‰æ–°å¢ç©ºé—´å°±æ˜¯æˆåŠŸï¼‰\npvdisplay /dev/sdb1 | grep -E \"(PV Size|Free PE)\"\n</code></pre>\n<h3 id=\"æ­¥éª¤4ä¸€é”®æ‰©å±•lvå’Œæ–‡ä»¶ç³»ç»Ÿç®€åŒ–æ“ä½œ\">æ­¥éª¤4ï¼šä¸€é”®æ‰©å±•LVå’Œæ–‡ä»¶ç³»ç»Ÿï¼ˆç®€åŒ–æ“ä½œï¼‰</h3>\n<pre><code class=\"language-bash\"># ä¸€æ¡å‘½ä»¤æå®šï¼šæ‰©å±•LVï¼ŒåŒæ—¶è‡ªåŠ¨æ‰©å±•æ–‡ä»¶ç³»ç»Ÿï¼ˆä¸ç”¨å•ç‹¬æ‰§è¡Œresize2fs/xfs_growfsï¼‰\nlvextend -r -l +100%FREE /dev/vg_data/lv_mysql\n</code></pre>\n<p>âœ… å®Œæˆï¼šäº‘ç›˜æ‰©å®¹åçš„ç©ºé—´ï¼Œå·²ç»æˆåŠŸçº³å…¥LVMç®¡ç†ï¼Œä¸šåŠ¡æ— æ„ŸçŸ¥ã€‚</p>\n<h2 id=\"æ–¹æ³•ä¸‰ä¸€é”®æ‰©å®¹æœ€ç®€å•-lvextend--r-ä¸€é”®æå®š\">æ–¹æ³•ä¸‰ï¼šä¸€é”®æ‰©å®¹ï¼ˆæœ€ç®€å•ï¼‰â€”â€” lvextend -r ä¸€é”®æå®š</h2>\n<p>åœºæ™¯ï¼šVGæœ‰å‰©ä½™ç©ºé—´ï¼ˆæ¯”å¦‚ä¹‹å‰åŠ è¿‡PVï¼Œè¿˜æœ‰æœªåˆ†é…ç©ºé—´ï¼‰ï¼Œæƒ³å¿«é€Ÿæ‰©å®¹LVï¼Œä¸ç”¨åˆ†æ­¥æ‰§è¡Œã€‚</p>\n<p>æ ¸å¿ƒï¼šåˆ©ç”¨LVMçš„ã€Œ-rã€å‚æ•°ï¼Œè‡ªåŠ¨æ‰©å±•LV+æ–‡ä»¶ç³»ç»Ÿï¼Œä¸€æ­¥åˆ°ä½ã€‚</p>\n<pre><code class=\"language-bash\"># 3ç§ä¸€é”®æ‰©å®¹æ–¹å¼ï¼Œé€‰ä¸€ç§å³å¯ï¼ˆæ›¿æ¢æˆä½ çš„LVè·¯å¾„ï¼‰\n# æ–¹å¼1ï¼šæ–°å¢20Gç©ºé—´ï¼Œè‡ªåŠ¨æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ\nlvextend -r -L +20G /dev/vg_data/lv_mysql\n\n# æ–¹å¼2ï¼šä½¿ç”¨VGå‰©ä½™ç©ºé—´çš„50%\nlvextend -r -l +50%FREE /dev/vg_data/lv_mysql\n\n# æ–¹å¼3ï¼šä½¿ç”¨VGæ‰€æœ‰å‰©ä½™ç©ºé—´ï¼ˆæ¨èï¼‰\nlvextend -r -l +100%FREE /dev/vg_data/lv_mysql\n</code></pre>\n<p>âœ… å®Œæˆï¼šæœ€ç®€å•çš„æ‰©å®¹æ–¹å¼ï¼Œå°ç™½é¦–é€‰ï¼Œé¿å…åˆ†æ­¥æ“ä½œå‡ºé”™ã€‚</p>\n<h2 id=\"æ–¹æ³•å››ç²¾ç®€é…ç½®æ‰©å®¹è™šæ‹ŸåŒ–å¸¸ç”¨-thin-provisioning\">æ–¹æ³•å››ï¼šç²¾ç®€é…ç½®æ‰©å®¹ï¼ˆè™šæ‹ŸåŒ–å¸¸ç”¨ï¼‰â€”â€” Thin Provisioning</h2>\n<p>åœºæ™¯ï¼šè™šæ‹ŸåŒ–ç¯å¢ƒï¼ˆKVMã€Proxmoxï¼‰ã€å®¹å™¨å­˜å‚¨ï¼Œéœ€è¦ã€Œè¶…åˆ†é…ç©ºé—´ã€ï¼ˆæ¯”å¦‚å®é™…åªæœ‰100Gç‰©ç†ç©ºé—´ï¼Œå´èƒ½åˆ›å»º200Gçš„LVï¼‰ï¼ŒæŒ‰éœ€åˆ†é…å®é™…ç©ºé—´ï¼ŒèŠ‚çœå­˜å‚¨æˆæœ¬ã€‚</p>\n<p>æ­¥éª¤ï¼ˆç®€åŒ–ç‰ˆï¼Œå°ç™½äº†è§£å³å¯ï¼Œå®æ“æŒ‰éœ€å‚è€ƒï¼‰ï¼š</p>\n<pre><code class=\"language-bash\"># 1. åˆ›å»ºç²¾ç®€æ± ï¼ˆthin poolï¼Œæ›¿æ¢æˆä½ çš„VGåç§°ï¼‰\nlvcreate -L 80G -T vg_data/thin_pool\n\n# 2. åˆ›å»ºç²¾ç®€å·ï¼ˆè™šæ‹Ÿ200Gï¼Œå®é™…æŒ‰éœ€åˆ†é…ï¼‰\nlvcreate -V 200G -T vg_data/thin_pool -n lv_vm_disk1\n\n# 3. æ‰©å®¹ç²¾ç®€æ± ï¼ˆå½“æ± ç©ºé—´ä¸è¶³æ—¶ï¼‰\nlvextend -L +50G vg_data/thin_pool\n\n# 4. æ‰©å®¹ç²¾ç®€å·å’Œæ–‡ä»¶ç³»ç»Ÿ\nlvextend -L +100G /dev/vg_data/lv_vm_disk1\nxfs_growfs /mnt/vm_disk1\n</code></pre>\n<h2 id=\"æ–¹æ³•äº”vdoå‹ç¼©æ‰©å®¹2026æ–°ç‰¹æ€§-å‹ç¼©å»é‡èŠ‚çœç©ºé—´\">æ–¹æ³•äº”ï¼šVDOå‹ç¼©æ‰©å®¹ï¼ˆ2026æ–°ç‰¹æ€§ï¼‰â€”â€” å‹ç¼©å»é‡ï¼ŒèŠ‚çœç©ºé—´</h2>\n<p>åœºæ™¯ï¼šå¤‡ä»½å­˜å‚¨ã€è™šæ‹Ÿæœºé•œåƒï¼ˆé‡å¤æ•°æ®å¤šçš„åœºæ™¯ï¼‰ï¼Œåˆ©ç”¨LVM2 2.03.xæ–°ç‰¹æ€§ï¼Œå®ç°æ•°æ®å‹ç¼©+å»é‡ï¼Œæ¯”å¦‚100Gç‰©ç†ç©ºé—´ï¼Œå¯å­˜å‚¨300Gæ•°æ®ï¼ˆ3:1å‹ç¼©æ¯”ï¼‰ã€‚</p>\n<p>æ­¥éª¤ï¼ˆç®€åŒ–ç‰ˆï¼Œéœ€LVM2 2.03.xä»¥ä¸Šç‰ˆæœ¬ï¼‰ï¼š</p>\n<pre><code class=\"language-bash\"># 1. åˆ›å»ºVDOæ± ï¼ˆ100Gç‰©ç†ç©ºé—´ï¼Œè™šæ‹Ÿ300Gé€»è¾‘ç©ºé—´ï¼‰\nlvcreate --type vdo -L 100G -V 300G -n vdo_pool vg_data\n\n# 2. æ‰©å®¹VDOç‰©ç†ç©ºé—´ï¼ˆæ–°å¢50Gï¼‰\nlvextend -L +50G vg_data/vdo_pool_vpool\n\n# 3. æ‰©å®¹VDOé€»è¾‘ç©ºé—´ï¼ˆæ–°å¢100Gï¼‰\nlvextend -L +100G vg_data/vdo_pool\n\n# 4. æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ\nxfs_growfs /mnt/vdo_storage\n</code></pre>\n<h1 id=\"å››å®æˆ˜æ¡ˆä¾‹mysqlæ•°æ®åº“é›¶åœæœºæ‰©å®¹å°ç™½å¿…çœ‹\">å››ã€å®æˆ˜æ¡ˆä¾‹ï¼šMySQLæ•°æ®åº“é›¶åœæœºæ‰©å®¹ï¼ˆå°ç™½å¿…çœ‹ï¼‰</h1>\n<p>ç»“åˆæ–¹æ³•ä¸€ï¼Œå®æˆ˜æ¼”ç¤ºã€ŒMySQLæ•°æ®åº“åœ¨çº¿æ‰©å®¹ã€ï¼Œæ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒæœ€å¸¸è§åœºæ™¯ï¼Œè·Ÿç€åšå°±èƒ½æå®šã€‚</p>\n<h2 id=\"åœºæ™¯æè¿°\">åœºæ™¯æè¿°</h2>\n<p>ç”Ÿäº§ç¯å¢ƒMySQLæœåŠ¡å™¨ï¼Œæ•°æ®ç›®å½•/var/lib/mysqlï¼ˆæŒ‚è½½åœ¨/dev/vg_data/lv_mysqlï¼Œ100Gï¼ŒXFSæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œä½¿ç”¨ç‡è¾¾åˆ°85%ï¼Œéœ€è¦æ–°å¢50Gç©ºé—´ï¼Œä¸åœæ­¢MySQLæœåŠ¡ã€‚</p>\n<p>ç¯å¢ƒï¼šCentOS 9ï¼ŒMySQL 8.0ï¼Œæ–°å¢ç£ç›˜/dev/sdcï¼ˆ100Gï¼‰ã€‚</p>\n<h2 id=\"å®æ“æ­¥éª¤ç›´æ¥å¤åˆ¶æ‰§è¡Œ\">å®æ“æ­¥éª¤ï¼ˆç›´æ¥å¤åˆ¶æ‰§è¡Œï¼‰</h2>\n<pre><code class=\"language-bash\"># 1. ç¡®è®¤å½“å‰ç£ç›˜ä½¿ç”¨ç‡ï¼ˆæŸ¥çœ‹æ˜¯å¦çœŸçš„æ»¡äº†ï¼‰\ndf -hT /var/lib/mysql\n\n# 2. ç¡®è®¤MySQLæœåŠ¡æ­£å¸¸è¿è¡Œï¼ˆæ‰©å®¹ä¸å½±å“æœåŠ¡ï¼‰\nsystemctl status mysqld\nmysql -e \"SHOW STATUS LIKE 'Uptime';\"\n\n# 3. åˆ›å»ºPVï¼ˆæ–°å¢ç£ç›˜/dev/sdcï¼‰\npvcreate /dev/sdc\n\n# 4. æ‰©å±•VGï¼ˆåŠ å…¥ç°æœ‰vg_dataï¼‰\nvgextend vg_data /dev/sdc\n\n# 5. ä¸€é”®æ‰©å®¹LV+æ–‡ä»¶ç³»ç»Ÿï¼ˆæ–°å¢50Gï¼‰\nlvextend -r -L +50G /dev/vg_data/lv_mysql\n\n# 6. éªŒè¯æ‰©å®¹æˆåŠŸ\ndf -hT /var/lib/mysql\n\n# 7. ç¡®è®¤MySQLæœåŠ¡æ­£å¸¸ï¼ˆæ— ä¸­æ–­ï¼‰\nmysql -e \"SHOW STATUS LIKE 'Uptime';\"\n</code></pre>\n<p>âœ… ç»“æœï¼šMySQLæœåŠ¡å…¨ç¨‹æœªä¸­æ–­ï¼Œç£ç›˜ç©ºé—´ä»100Gæ‰©å±•åˆ°150Gï¼Œä½¿ç”¨ç‡ä»85%é™åˆ°57%ï¼Œå®Œç¾è§£å†³ç£ç›˜å‘Šè­¦ã€‚</p>\n<h1 id=\"äº”å°ç™½å¿…çœ‹æ³¨æ„äº‹é¡¹é¿å‘æŒ‡å—é‡ä¸­ä¹‹é‡\">äº”ã€å°ç™½å¿…çœ‹ï¼šæ³¨æ„äº‹é¡¹+é¿å‘æŒ‡å—ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰</h1>\n<p>LVMæ“ä½œæ¶‰åŠåº•å±‚å­˜å‚¨ï¼Œä¸€æ­¥é”™å¯èƒ½ä¸¢æ•°æ®ï¼Œä»¥ä¸‹æ³¨æ„äº‹é¡¹ï¼Œä¸€å®šè¦çœ‹å®Œå†æ“ä½œï¼</p>\n<h2 id=\"51-æ ¸å¿ƒè­¦å‘Šå¿…çœ‹\">5.1 æ ¸å¿ƒè­¦å‘Šï¼ˆå¿…çœ‹ï¼‰</h2>\n<ul>\n<li>\n<p>âš ï¸ æ‰€æœ‰æ“ä½œå‰ï¼Œ<strong>åŠ¡å¿…å¤‡ä»½æ•°æ®</strong>ï¼å“ªæ€•æ˜¯åœ¨çº¿æ‰©å®¹ï¼Œä¹Ÿæœ‰æå°æ¦‚ç‡å‡ºé”™ï¼Œå¤‡ä»½æ˜¯æœ€åä¿éšœï¼ˆæ¯”å¦‚å¤‡ä»½MySQLæ•°æ®ã€é‡è¦æ–‡ä»¶ï¼‰ã€‚</p>\n</li>\n<li>\n<p>âš ï¸ XFSæ–‡ä»¶ç³»ç»Ÿã€Œåªèƒ½æ‰©å®¹ï¼Œä¸èƒ½ç¼©å®¹ã€ï¼è§„åˆ’LVå¤§å°æ—¶ï¼Œå°½é‡é¢„ç•™ä¸€å®šç©ºé—´ï¼Œé¿å…åç»­æƒ³ç¼©å®¹å´æ— æ³•æ“ä½œã€‚</p>\n</li>\n<li>\n<p>âš ï¸ ä¸è¦è¯¯æ“ä½œæ­£åœ¨ä½¿ç”¨çš„ç£ç›˜ï¼æ‰§è¡Œlsblkå‘½ä»¤ï¼Œç¡®è®¤ç£ç›˜æœªæŒ‚è½½ã€æ— æ•°æ®ï¼Œå†è¿›è¡ŒPVåˆ›å»ºã€‚</p>\n</li>\n</ul>\n<h2 id=\"52-å¸¸è§é¿å‘ç‚¹\">5.2 å¸¸è§é¿å‘ç‚¹</h2>\n<ul>\n<li>\n<p>å‘1ï¼šLVæ‰©å±•åï¼Œdfå‘½ä»¤çœ‹ä¸åˆ°æ–°å¢ç©ºé—´ â†’ å¿˜è®°æ‰©å±•æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰§è¡Œresize2fsï¼ˆext4ï¼‰æˆ–xfs_growfsï¼ˆXFSï¼‰å³å¯ã€‚</p>\n</li>\n<li>\n<p>å‘2ï¼šäº‘ç›˜æ‰©å®¹åï¼Œç³»ç»Ÿçœ‹ä¸åˆ°æ–°å®¹é‡ â†’ å¿˜è®°æ‰§è¡Œç£ç›˜æ‰«æå‘½ä»¤ï¼ˆecho 1 &gt; /sys/class/block/sdb/device/rescanï¼‰ã€‚</p>\n</li>\n<li>\n<p>å‘3ï¼švgextendå‘½ä»¤å¤±è´¥ â†’ ç¡®è®¤PVåˆ›å»ºæˆåŠŸï¼ˆpvdisplayæŸ¥çœ‹ï¼‰ï¼Œä¸”VGåç§°æ­£ç¡®ï¼ˆvgså‘½ä»¤æŸ¥çœ‹ï¼‰ã€‚</p>\n</li>\n</ul>\n<h2 id=\"53-æœ€ä½³å®è·µå°ç™½å‚è€ƒ\">5.3 æœ€ä½³å®è·µï¼ˆå°ç™½å‚è€ƒï¼‰</h2>\n<ul>\n<li>\n<p>åˆ›å»ºVGæ—¶ï¼ŒæŒ‡å®šPEå¤§å°ä¸º16MBæˆ–32MBï¼ˆå¤§å®¹é‡å­˜å‚¨æ›´é«˜æ•ˆï¼‰ï¼švgcreate -s 16M vg_data /dev/sdbã€‚</p>\n</li>\n<li>\n<p>å®šæœŸå¤‡ä»½LVMå…ƒæ•°æ®ï¼švgcfgbackup vg_dataï¼ˆé¿å…VGæŸåï¼Œæ— æ³•æ¢å¤ï¼‰ã€‚</p>\n</li>\n<li>\n<p>ç›‘æ§VGå‰©ä½™ç©ºé—´ï¼Œå½“å‰©ä½™ç©ºé—´ä½äº10%æ—¶ï¼Œæå‰æ‰©å®¹ï¼Œé¿å…ç£ç›˜æ»¡å¯¼è‡´ä¸šåŠ¡ä¸­æ–­ã€‚</p>\n</li>\n</ul>\n<h1 id=\"å…­ç»“å°¾æ€»ç»“å‘½ä»¤é€ŸæŸ¥è¡¨\">å…­ã€ç»“å°¾æ€»ç»“+å‘½ä»¤é€ŸæŸ¥è¡¨</h1>\n<h2 id=\"61-æ ¸å¿ƒæ€»ç»“\">6.1 æ ¸å¿ƒæ€»ç»“</h2>\n<p>LVMåŠ¨æ€æ‰©å®¹çš„æ ¸å¿ƒé€»è¾‘ï¼š<strong>æ‰©PV â†’ æ‰©VG â†’ æ‰©LV â†’ æ‰©æ–‡ä»¶ç³»ç»Ÿ</strong>ï¼ˆä¸€é”®æ‰©å®¹å¯è·³è¿‡éƒ¨åˆ†æ­¥éª¤ï¼‰ã€‚</p>\n<p>å°ç™½é‡ç‚¹æŒæ¡å‰3ç§æ–¹æ³•ï¼ˆæ·»åŠ æ–°ç£ç›˜ã€æ‰©å±•ç°æœ‰ç£ç›˜ã€ä¸€é”®æ‰©å®¹ï¼‰ï¼Œå°±èƒ½åº”å¯¹90%ä»¥ä¸Šçš„æ‰©å®¹åœºæ™¯ï¼Œå…¨ç¨‹é›¶åœæœºï¼Œä¸šåŠ¡æ— æ„ŸçŸ¥ã€‚</p>\n<h2 id=\"62-å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨å°ç™½æ”¶è—å¤‡ç”¨\">6.2 å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨ï¼ˆå°ç™½æ”¶è—ï¼Œå¤‡ç”¨ï¼‰</h2>\n<pre><code class=\"language-bash\"># PVæ“ä½œï¼ˆç‰©ç†å·ï¼‰\npvcreate /dev/sdb    # åˆ›å»ºPV\npvdisplay /dev/sdb   # æŸ¥çœ‹PVè¯¦æƒ…\npvs                  # åˆ—å‡ºæ‰€æœ‰PV\n\n# VGæ“ä½œï¼ˆå·ç»„ï¼‰\nvgcreate vg_data /dev/sdb  # åˆ›å»ºVG\nvgextend vg_data /dev/sdc  # æ‰©å±•VG\nvgdisplay vg_data          # æŸ¥çœ‹VGè¯¦æƒ…\nvgs                        # åˆ—å‡ºæ‰€æœ‰VG\n\n# LVæ“ä½œï¼ˆé€»è¾‘å·ï¼‰\nlvcreate -L 50G -n lv_data vg_data  # åˆ›å»ºLV\nlvextend -r -L +20G /dev/vg_data/lv_data  # ä¸€é”®æ‰©å®¹LV\nlvdisplay /dev/vg_data/lv_data            # æŸ¥çœ‹LVè¯¦æƒ…\nlvs                                       # åˆ—å‡ºæ‰€æœ‰LV\n\n# æ–‡ä»¶ç³»ç»Ÿæ‰©å±•\nresize2fs /dev/vg_data/lv_data  # ext4æ‰©å®¹\nxfs_growfs /data/mysql          # XFSæ‰©å®¹\n</code></pre>\n<p>ğŸ’¡ æœ€åæé†’ï¼šå®æ“æ—¶ï¼Œä¸€å®šè¦æ›¿æ¢æˆè‡ªå·±çš„ç£ç›˜è·¯å¾„ï¼ˆ/dev/sdbï¼‰ã€VGåç§°ï¼ˆvg_dataï¼‰ã€LVè·¯å¾„ï¼Œé¿å…å¤åˆ¶é”™è¯¯ï¼</p>\n<p>å¦‚æœæ“ä½œä¸­é‡åˆ°é—®é¢˜ï¼Œè¯„è®ºåŒºç•™è¨€ï¼Œæˆ‘ä¼šä¸€ä¸€è§£ç­”ï¼Œå¸®åŠ©å¤§å®¶é¿å‘ï¼Œè½»æ¾æå®šLVMæ‰©å®¹ï½</p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n\t\t<p class=\"postfoot\">\n\t\t\tposted on \n<span id=\"post-date\">2026-02-05 10:42</span>&nbsp;\n<a href=\"https://www.cnblogs.com/liuziyi1\">åˆ˜å­æ¯…</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">10</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n\n\t\t</p>"
    },
    {
      "title": "FastAPIç”Ÿå‘½å‘¨æœŸç®¡ç†å®æˆ˜ï¼šä»å¯åŠ¨åˆ°å…³é—­ï¼Œå¦‚ä½•ä¼˜é›…åœ°ç®¡å¥½ä½ çš„â€œèµ„æºå®¶å½“â€",
      "link": "https://www.cnblogs.com/ymtianyu/p/19577804",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/ymtianyu/p/19577804\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-05 10:23\">\n    <span>FastAPIç”Ÿå‘½å‘¨æœŸç®¡ç†å®æˆ˜ï¼šä»å¯åŠ¨åˆ°å…³é—­ï¼Œå¦‚ä½•ä¼˜é›…åœ°ç®¡å¥½ä½ çš„â€œèµ„æºå®¶å½“â€</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        æœ¬æ–‡æ·±å…¥è®²è§£äº†FastAPIçš„Lifespanç”Ÿå‘½å‘¨æœŸç®¡ç†æœºåˆ¶ï¼Œè¯¦ç»†åˆ†æäº†å…¶å·¥ä½œåŸç†ï¼Œå¹¶æä¾›äº†ä½¿ç”¨@asynccontextmanagerçš„å®Œæ•´å®æˆ˜ä»£ç ç¤ºä¾‹ã€‚é‡ç‚¹æ€»ç»“äº†èµ„æºåˆå§‹åŒ–ã€ä¼˜é›…å…³é—­çš„å®ç°æ–¹æ³•ï¼Œä»¥åŠåœ¨å®é™…ä½¿ç”¨ä¸­å¸¸è§çš„å››ä¸ªâ€œå‘ç‚¹â€ä¸è§£å†³æ–¹æ¡ˆï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…æ„å»ºæ›´ç¨³å®šã€ä¸“ä¸šçš„FastAPIåº”ç”¨ã€‚\n    </div>\n<div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<h2>FastAPIå®æˆ˜ï¼šä½ ä»¥ä¸ºçš„å¯åŠ¨ä¸å…³é—­ï¼Œè¿œä¸æ­¢å¼€å§‹å’Œç»“æŸ</h2>\n<p><strong style=\"color: rgba(186, 55, 42, 1);\">æ‘˜è¦ï¼š</strong>æœ¬æ–‡è¯¦ç»†æ¢è®¨äº†FastAPIçš„Lifespanï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰ç®¡ç†ï¼Œä»ä¸ºä»€ä¹ˆéœ€è¦å®ƒã€å®ƒçš„æ ¸å¿ƒå·¥ä½œåŸç†ï¼Œåˆ°ä½¿ç”¨<span style=\"color: rgba(186, 55, 42, 1);\"><code>@asynccontextmanager</code></span>çš„æœ€ä½³å®è·µã€å¸¸è§â€œå‘ç‚¹â€åŠè§£å†³æ–¹æ¡ˆã€‚é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„å®æˆ˜ç¤ºä¾‹ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•ä¼˜é›…åœ°ç®¡ç†æ•°æ®åº“è¿æ¥æ± ã€é…ç½®åŠ è½½ç­‰èµ„æºï¼Œç¡®ä¿åº”ç”¨ç¨³å®šå¯æ§ã€‚</p>\n<hr />\n<p>æœ‰æ²¡æœ‰åœ¨éƒ¨ç½²FastAPIåº”ç”¨åï¼Œé‡åˆ°è¿‡è¿™äº›çŠ¶å†µï¼ŸğŸ‘‡</p>\n<p>â†’ æœåŠ¡ä¸€é‡å¯ï¼Œå‰å‡ ä¸ªè¯·æ±‚æ€»æ˜¯å¤±è´¥ï¼Œæ—¥å¿—é‡Œé£˜ç€â€œæ•°æ®åº“è¿æ¥é”™è¯¯â€ã€‚</p>\n<p>â†’ æƒ³ä¼˜é›…åœ°å…³é—­ï¼Œç»™ä¸‹æ¸¸æœåŠ¡å‘ä¸ªé€šçŸ¥ï¼Œå´å‘ç°è¯·æ±‚ç›´æ¥è¢«ææ–­ï¼Œèµ„æºæ¸…ç†äº†ä¸ªå¯‚å¯ã€‚</p>\n<p>â†’ ä¾èµ–é¡¹ï¼ˆæ¯”å¦‚é…ç½®ã€å¤–éƒ¨å®¢æˆ·ç«¯ï¼‰çš„åˆå§‹åŒ–ä»£ç ï¼Œæ•£è½åœ¨è·¯ç”±å’Œä¸­é—´ä»¶é‡Œï¼Œç»´æŠ¤èµ·æ¥å¤´å¤§ã€‚</p>\n<p>è¿™äº›éƒ½æ˜¯ç”¨ <code style=\"color: rgba(186, 55, 42, 1);\">@app.on_event(\"startup\")</code> å’Œ <code style=\"color: rgba(186, 55, 42, 1);\">\"shutdown\"</code> è¸©å‘è¸©å‡ºæ¥çš„ç»éªŒï¼ˆå’Œçœ¼æ³ªï¼‰ã€‚ä»Šå¤©ï¼Œå’±ä»¬å°±æ¥èŠèŠå®ƒçš„æ­£ç»Ÿæ¥ç­äººâ€”â€”<strong><span style=\"color: rgba(186, 55, 42, 1);\"><code>Lifespan</code></span></strong>ï¼Œä»¥åŠæ€ä¹ˆç”¨å®ƒå†™å‡ºæ›´å¥å£®ã€æ›´ä¸“ä¸šçš„FastAPIåº”ç”¨ã€‚</p>\n<h2>ğŸ¯ ç¬¬ä¸€éƒ¨åˆ†ï¼šé—®é¢˜å‡ºåœ¨å“ªï¼Ÿä»â€œé¤å…â€çš„æ··ä¹±å¼€ä¸šè¯´èµ·</h2>\n<p>æƒ³è±¡ä¸€ä¸‹ä½ å¼€äº†ä¸€å®¶æ•°å­—é¤å…ï¼ˆä½ çš„FastAPIåº”ç”¨ï¼‰ã€‚</p>\n<p>ğŸ™… <strong>è€åšæ³•ï¼ˆon_eventï¼‰ï¼š</strong> æ—©ä¸Šå¼€ä¸šæ—¶é—´åˆ°äº†ï¼Œå¨å¸ˆï¼ˆæ•°æ®åº“è¿æ¥æ± ï¼‰ã€æœåŠ¡å‘˜ï¼ˆé…ç½®ï¼‰ã€é‡‡è´­å‘˜ï¼ˆHTTPå®¢æˆ·ç«¯ï¼‰æ‰æ…Œæ…Œå¼ å¼ åœ°å„è‡ªå¼€å§‹å‡†å¤‡ã€‚å®¢äººï¼ˆè¯·æ±‚ï¼‰å·²ç»è¿›é—¨ç‚¹èœäº†ï¼Œå¨å¸ˆå¯èƒ½è¿é”…éƒ½è¿˜æ²¡çƒ­ã€‚æ™šä¸Šæ‰“çƒŠæ—¶ï¼Œä¸€å£°ä»¤ä¸‹ç›´æ¥æ‹‰é—¸ï¼Œé‡‡è´­å‘˜æ‰‹é‡Œè¿˜åœ¨è¿›è¡Œçš„è®¢å•ã€å¨å¸ˆæ²¡æ´—çš„é”…ï¼Œå…¨éƒ½æˆ›ç„¶è€Œæ­¢ã€‚</p>\n<p>è¿™ï¼Œå°±æ˜¯æ—©æœŸå¯åŠ¨/å…³é—­äº‹ä»¶çš„å¼‚æ­¥é—®é¢˜ï¼Œä»¥åŠç¼ºä¹å¯¹â€œå‡†å¤‡â€å’Œâ€œæ¸…ç†â€é˜¶æ®µçš„ç²¾ç»†æ§åˆ¶ã€‚</p>\n<p>FastAPIåœ¨è¾ƒæ–°çš„ç‰ˆæœ¬ä¸­ï¼Œå¼•å…¥äº†<code style=\"color: rgba(186, 55, 42, 1);\">lifespan</code>å‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong style=\"color: rgba(186, 55, 42, 1);\">åœ¨åº”ç”¨æ­£å¼å¤„ç†è¯·æ±‚å‰ï¼ŒæŠŠæ‰€æœ‰â€œå®¶å½“â€éƒ½å‡†å¤‡å¥½ï¼›åœ¨åº”ç”¨é€€å‡ºå‰ï¼Œæœ‰æ¡ä¸ç´Šåœ°æ”¶æ‹¾å¥½æ‰€æœ‰â€œå®¶å½“â€ã€‚</strong></p>\n<p>è¿™ç¡®ä¿äº†åœ¨åº”ç”¨ç”Ÿå‘½å‘¨æœŸå†…ï¼Œèµ„æºçŠ¶æ€æ˜¯ç¡®å®šçš„ã€‚</p>\n<h2>ğŸ§  ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒåŸç†ä¸æ­¥éª¤ï¼Œä¸€ä¸ª yield æå®šæ‰€æœ‰</h2>\n<p><code style=\"color: rgba(186, 55, 42, 1);\">lifespan</code> çš„åŸç†ï¼Œå…¶å®å°±æ˜¯Pythonå¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„ç»å…¸æ¨¡å¼ï¼š<code style=\"color: rgba(186, 55, 42, 1);\">__aenter__</code> å’Œ <code style=\"color: rgba(186, 55, 42, 1);\">__aexit__</code>ã€‚åœ¨FastAPIé‡Œï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª<code style=\"color: rgba(186, 55, 42, 1);\">@asynccontextmanager</code>è£…é¥°å™¨å°±èƒ½ä¼˜é›…å®ç°ã€‚</p>\n<p>å®ƒçš„å·¥ä½œæµè¶…çº§æ¸…æ™°ï¼š</p>\n<div>\n<p>â€ƒ1ï¸âƒ£ <code style=\"color: rgba(186, 55, 42, 1);\">yield</code> ä¹‹å‰ï¼šå¯åŠ¨é€»è¾‘ã€‚åœ¨è¿™é‡Œè¿æ¥æ•°æ®åº“ã€åŠ è½½é…ç½®ã€åˆ›å»ºå„ç§å®¢æˆ·ç«¯ã€‚</p>\n<p>â€ƒ2ï¸âƒ£ <code style=\"color: rgba(186, 55, 42, 1);\">yield</code> é‚£ä¸€åˆ»ï¼šåº”ç”¨è¿›å…¥â€œè¿è¡Œå°±ç»ªâ€çŠ¶æ€ã€‚æ­¤æ—¶æ‰€æœ‰èµ„æºéƒ½å·²åˆå§‹åŒ–å®Œæ¯•ï¼Œå¯ä»¥å®‰å…¨æ¥æ”¶è¯·æ±‚ã€‚</p>\n<p>â€ƒ3ï¸âƒ£ <code style=\"color: rgba(186, 55, 42, 1);\">yield</code> ä¹‹åï¼šå…³é—­é€»è¾‘ã€‚åœ¨è¿™é‡Œå…³é—­è¿æ¥æ± ã€æ¸…ç†ä¸´æ—¶æ–‡ä»¶ã€å‘é€å…³é—­é€šçŸ¥ã€‚</p>\n</div>\n<p><strong style=\"color: rgba(186, 55, 42, 1);\">é‡ç‚¹ï¼š</strong> æ‰€æœ‰åœ¨<code style=\"color: rgba(186, 55, 42, 1);\">yield</code>å‰åˆå§‹åŒ–çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥é€šè¿‡<code style=\"color: rgba(186, 55, 42, 1);\">request.app.state</code>åœ¨æ•´ä¸ªåº”ç”¨èŒƒå›´å†…å…±äº«ã€‚è¿™æ˜¯ä¾èµ–æ³¨å…¥çš„â€œåå‹¤æ€»éƒ¨â€ï¼</p>\n<h2>ğŸ’» ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®æˆ˜æ¼”ç¤ºï¼Œæ‰‹æŠŠæ‰‹æ­ä¸€ä¸ªç¨³å¦‚è€ç‹—çš„åº”ç”¨</h2>\n<p>å…‰è¯´ä¸ç»ƒå‡æŠŠå¼ï¼Œæ¥çœ‹ä¸€ä¸ªé›†æˆäº†Redisè¿æ¥æ± å’Œé…ç½®ç®¡ç†çš„å®æˆ˜ä¾‹å­ã€‚ä½ å®Œå…¨å¯ä»¥ç›´æ¥å¤åˆ¶ï¼Œæ”¹æ”¹å°±èƒ½ç”¨ã€‚</p>\n<pre class=\"language-python highlighter-hljs\"><code>from contextlib import asynccontextmanager\nfrom fastapi import FastAPI, Depends, Request\nimport redis.asyncio as redis\n\n# å‡è£…ä»ç¯å¢ƒæˆ–æ–‡ä»¶åŠ è½½çš„é…ç½®\nAPP_CONFIG = {\"redis_url\": \"redis://localhost\", \"max_connections\": 10}\n\n# è¿™é‡Œæ˜¯æ ¸å¿ƒï¼å®šä¹‰ lifespan\n@asynccontextmanager\nasync def app_lifespan(app: FastAPI):\n    \"\"\"\n    åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†\n    1. å¯åŠ¨ï¼šåˆ›å»ºRedisè¿æ¥æ± \n    2. è¿è¡Œï¼šä¿æŒ\n    3. å…³é—­ï¼šæ¸…ç†è¿æ¥æ± \n    \"\"\"\n    print(\"ğŸš€ åº”ç”¨å¯åŠ¨ä¸­...æ­£åœ¨åˆå§‹åŒ–èµ„æº\")\n    # --- å¯åŠ¨é˜¶æ®µ ---\n    # åˆå§‹åŒ–Redisè¿æ¥æ± \n    try:\n        redis_pool = redis.ConnectionPool.from_url(\n            APP_CONFIG[\"redis_url\"],\n            max_connections=APP_CONFIG[\"max_connections\"],\n            decode_responses=True\n        )\n        app.state.redis_pool = redis_pool\n        app.state.config = APP_CONFIG  # é…ç½®ä¹Ÿå­˜è¿›å»\n        print(\"âœ… Redisè¿æ¥æ± å’Œé…ç½®åˆå§‹åŒ–å®Œæˆï¼\")\n    except Exception as e:\n        print(f\"âŒ èµ„æºåˆå§‹åŒ–å¤±è´¥: {e}\")\n        # è¿™é‡Œä¸€å®šè¦å¤±è´¥ï¼Œä¸è¦è®©åº”ç”¨å¸¦ç€é—®é¢˜å¯åŠ¨\n        raise\n\n    #  yield æ ‡å¿—ç€åº”ç”¨æ­£å¼å¯åŠ¨å®Œæˆï¼Œå¼€å§‹æ¥æ”¶è¯·æ±‚\n    yield\n\n    # --- å…³é—­é˜¶æ®µ ---\n    print(\"\\nğŸ›‘ åº”ç”¨å…³é—­ä¸­...æ­£åœ¨æ¸…ç†èµ„æº\")\n    # å…³é—­Redisè¿æ¥æ± \n    if hasattr(app.state, 'redis_pool'):\n        await app.state.redis_pool.disconnect()\n        print(\"âœ… Redisè¿æ¥æ± å·²å…³é—­ã€‚\")\n    print(\"ğŸ‘‹ èµ„æºæ¸…ç†å®Œæ¯•ï¼Œåº”ç”¨å®‰å…¨é€€å‡ºã€‚\")\n\n# åˆ›å»ºAppï¼Œæ³¨å…¥lifespan\napp = FastAPI(title=\"Lifespan Demo\", lifespan=app_lifespan)\n\n# ä¸€ä¸ªä¾èµ–é¡¹ï¼Œç”¨äºåœ¨è·¯ç”±ä¸­æ–¹ä¾¿åœ°è·å–Redisè¿æ¥\nasync def get_redis(request: Request):\n    # ç›´æ¥ä»app.stateè·å–è¿æ¥æ± ï¼Œå¹¶åˆ›å»ºä¸´æ—¶è¿æ¥\n    async with redis.Redis(connection_pool=request.app.state.redis_pool) as client:\n        yield client\n\n# ç¤ºä¾‹è·¯ç”±\n@app.get(\"/cache/{key}\")\nasync def get_cache(key: str, redis = Depends(get_redis)):\n    value = await redis.get(key)\n    return {\"key\": key, \"value\": value}\n\n@app.post(\"/cache/{key}\")\nasync def set_cache(key: str, value: str, redis = Depends(get_redis)):\n    await redis.set(key, value, ex=60)  # 60ç§’è¿‡æœŸ\n    return {\"msg\": \"OK\"}\n\n@app.get(\"/config\")\nasync def show_config(request: Request):\n    # ç›´æ¥è®¿é—®å…¨å±€é…ç½®\n    return request.app.state.config\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000)\n    </code></pre>\n<p>è·‘èµ·æ¥ä¹‹åï¼Œä½ ä¼šçœ‹åˆ°æ§åˆ¶å°å…ˆæ‰“å°å¯åŠ¨æ—¥å¿—ï¼ŒUvicornå·¥äººå°±ä½åï¼Œåº”ç”¨æ‰å¼€å§‹ç›‘å¬è¯·æ±‚ã€‚ç”¨<code style=\"color: rgba(186, 55, 42, 1);\">Ctrl+C</code>å…³é—­æ—¶ï¼Œå…³é—­é€»è¾‘ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚</p>\n<h2>ğŸš¨ ç¬¬å››éƒ¨åˆ†ï¼šå¸¸è§å‘ç‚¹ &amp; æˆ‘çš„è¡€æ³ªç»éªŒ</h2>\n<p>å¥½äº†ï¼Œä»£ç è·‘é€šäº†ï¼Œä½†ä¸‹é¢è¿™äº›æ‰æ˜¯ä¿è¯ä½ ä¸ä¸Šç”Ÿäº§ç¯å¢ƒâ€œæ¼”ç ¸â€çš„å…³é”®ã€‚</p>\n<div>\n<p><strong>ğŸ”¥ å‘ç‚¹ä¸€ï¼šå¯åŠ¨å¤±è´¥å¤„ç†ä¸å½“</strong></p>\n<p>â€ƒ- <strong>é—®é¢˜ï¼š</strong> å¦‚æœåœ¨<code style=\"color: rgba(186, 55, 42, 1);\">yield</code>ä¹‹å‰åˆå§‹åŒ–æ•°æ®åº“å¤±è´¥äº†ï¼Œä½ è¯¥æ€ä¹ˆåŠï¼Ÿ</p>\n<p>â€ƒ- <strong>æˆ‘çš„æ•™è®­ï¼š</strong> åƒä¸‡åˆ«åå¼‚å¸¸ï¼å°±åƒä¸Šé¢ä»£ç é‡Œåšçš„ï¼Œå¿…é¡»<code style=\"color: rgba(186, 55, 42, 1);\">raise</code>å‡ºå»ï¼Œè®©åº”ç”¨å¯åŠ¨å¤±è´¥ã€‚ä¸€ä¸ªè¿ä¸ä¸Šæ•°æ®åº“çš„åº”ç”¨ï¼Œä¸å¦‚ä¸å¯åŠ¨ã€‚å¯ä»¥é€šè¿‡æ—¥å¿—å’Œç›‘æ§ç³»ç»ŸåŠæ—¶å‘Šè­¦ã€‚</p>\n</div>\n<div>\n<p><strong>ğŸ”¥ å‘ç‚¹äºŒï¼šåœ¨lifespané‡Œå†™â€œæ…¢â€é€»è¾‘</strong></p>\n<p>â€ƒ- <strong>é—®é¢˜ï¼š</strong> Lifespançš„å¯åŠ¨é˜¶æ®µä¼šé˜»å¡åº”ç”¨å¯åŠ¨ã€‚å¦‚æœä½ åœ¨è¿™é‡Œè·‘ä¸€ä¸ªè€—æ—¶10åˆ†é’Ÿçš„æ•°æ®åŒæ­¥ä»»åŠ¡ï¼Œä½ çš„æœåŠ¡å°±10åˆ†é’Ÿä¸å¯ç”¨ã€‚</p>\n<p>â€ƒ- <strong>æˆ‘çš„å»ºè®®ï¼š</strong> å¯¹äºéæ ¸å¿ƒã€è€—æ—¶çš„åˆå§‹åŒ–ï¼ˆå¦‚é¢„åŠ è½½å¤§æ•°æ®æ¨¡å‹ï¼‰ï¼Œè€ƒè™‘åœ¨<code style=\"color: rgba(186, 55, 42, 1);\">yield</code>åï¼Œç”¨åå°ä»»åŠ¡å¼‚æ­¥æ‰§è¡Œã€‚æˆ–è€…ï¼Œè®¾è®¡æˆæ‡’åŠ è½½æ¨¡å¼ï¼Œåœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶åˆå§‹åŒ–ã€‚</p>\n</div>\n<div>\n<p><strong>ğŸ”¥ å‘ç‚¹ä¸‰ï¼šå¿½ç•¥å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†</strong></p>\n<p>â€ƒ- <strong>é—®é¢˜ï¼š</strong> åƒæ•°æ®åº“è¿æ¥æ± ã€HTTPå®¢æˆ·ç«¯è¿™ç±»èµ„æºï¼Œå®ƒä»¬è‡ªå·±å¾€å¾€ä¹Ÿéœ€è¦<code style=\"color: rgba(186, 55, 42, 1);\">async with</code>æ¥ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚</p>\n<p>â€ƒ- <strong>æ­£ç¡®åšæ³•ï¼š</strong> ä»”ç»†é˜…è¯»ä½ ç”¨çš„å®¢æˆ·ç«¯åº“æ–‡æ¡£ã€‚åƒä¸Šé¢redisçš„<code style=\"color: rgba(186, 55, 42, 1);\">ConnectionPool.disconnect()</code>ï¼Œå®ƒå°±æ˜¯å¼‚æ­¥çš„ï¼Œå¿…é¡»<code style=\"color: rgba(186, 55, 42, 1);\">await</code>ã€‚åŒæ­¥å®¢æˆ·ç«¯åˆ™é€šå¸¸åœ¨<code style=\"color: rgba(186, 55, 42, 1);\">.close()</code>ã€‚</p>\n</div>\n<div>\n<p><strong>ğŸ”¥ å‘ç‚¹å››ï¼šStateæ»¥ç”¨</strong></p>\n<p>â€ƒ- <strong>é—®é¢˜ï¼š</strong> <code style=\"color: rgba(186, 55, 42, 1);\">app.state</code>ä¸æ˜¯ä¸‡èƒ½çš„å‚¨ç‰©é—´ï¼Œå®ƒé€‚åˆæ”¾<strong>å…¨å±€ã€åªè¯»æˆ–çº¿ç¨‹/åç¨‹å®‰å…¨</strong>çš„å¯¹è±¡ã€‚</p>\n<p>â€ƒ- <strong>è­¦å‘Šï¼š</strong> åˆ«å¾€é‡Œå¡è¯·æ±‚çº§åˆ«çš„æ•°æ®ï¼Œä¹Ÿåˆ«æ”¾é¢‘ç¹ä¿®æ”¹çš„å…¨å±€å˜é‡ï¼Œè¿™ä¼šåœ¨å¤šworkerç¯å¢ƒä¸‹è®©ä½ æ€€ç–‘äººç”Ÿã€‚å…±äº«é…ç½®ã€è¿æ¥æ± ã€åˆå§‹åŒ–å¥½çš„å®¢æˆ·ç«¯å®ä¾‹ï¼Œæ˜¯å®ƒçš„æœ€ä½³æ‹æ¡£ã€‚</p>\n</div>\n<h2>ğŸ’ æœ€åå•°å—¦ä¸€å¥</h2>\n<p>ä½¿ç”¨<code style=\"color: rgba(186, 55, 42, 1);\">lifespan</code>ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§<strong style=\"color: rgba(186, 55, 42, 1);\">â€œå¥‘çº¦ç¼–ç¨‹â€</strong>ã€‚ä½ å‘æ¡†æ¶æ‰¿è¯ºï¼šâ€œæˆ‘ä¼šç®¡å¥½æˆ‘å¸¦æ¥çš„èµ„æºâ€ï¼›æ¡†æ¶å‘ä½ ä¿è¯ï¼šâ€œæˆ‘ä¼šåœ¨æ­£ç¡®çš„æ—¶é—´ç‚¹ç»™ä½ æ‰§è¡Œç®¡ç†çš„æƒåˆ©â€ã€‚</p>\n<p>å®ƒè®©æˆ‘ä»¬çš„åº”ç”¨ä»â€œèƒ½è·‘â€è¿›åŒ–åˆ°â€œè·‘å¾—ç¨³ã€å…³å¾—ä¼˜é›…â€ã€‚å°¤å…¶æ˜¯åœ¨äº‘åŸç”Ÿå’Œå®¹å™¨åŒ–ç¯å¢ƒä¸‹ï¼Œä¼˜é›…å¯åœæ˜¯ä¿è¯æœåŠ¡é«˜å¯ç”¨çš„åŸºç¡€ä¸€ç¯ã€‚</p>\n<p>å¸Œæœ›è¿™ç¯‡èåˆäº†æˆ‘ä¸å°‘â€œå‘â€çš„æ–‡ç« ï¼Œèƒ½å¸®ä½ æŠŠFastAPIç”¨å¾—æ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚å¦‚æœä½ æœ‰æ›´å¦™çš„ç”¨æ³•æˆ–è€…ä¹Ÿè¸©è¿‡æœ‰è¶£çš„å‘ï¼Œæ¬¢è¿æ¥èŠèŠï¼</p>\n<hr />\n<p style=\"text-align: center; color: rgba(127, 140, 141, 1); font-size: 0.9em;\">è§‰å¾—æœ‰ç”¨å°±èµ¶ç´§æ”¶è—å§ï¼Œè¿™ç§å®æˆ˜ç»†èŠ‚ï¼Œä¸‹æ¬¡é…ç½®æ–°é¡¹ç›®æ—¶ç¿»å‡ºæ¥çœ‹ä¸€çœ¼ï¼Œèƒ½çœä¸‹ä¸å°‘æŸ¥æ–‡æ¡£å’ŒDebugçš„æ—¶é—´ã€‚æˆ‘æ˜¯ä¸€åç¨‹åºåª›ï¼Œæˆ‘ä»¬ä¸‹æ¬¡è§ï¼ğŸ‘©ğŸ’»</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-05 10:23</span>&nbsp;\n<a href=\"https://www.cnblogs.com/ymtianyu\">ä¸€åç¨‹åºåª›å‘€</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "Redis äº‹åŠ¡çš„â€œåŸå­æ€§â€è¿·æ€ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº† Lua è„šæœ¬",
      "link": "https://www.cnblogs.com/xzqcsj/p/19577555",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xzqcsj/p/19577555\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-05 09:49\">\n    <span>Redis äº‹åŠ¡çš„â€œåŸå­æ€§â€è¿·æ€ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº† Lua è„šæœ¬</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        <img alt=\"Redis äº‹åŠ¡çš„â€œåŸå­æ€§â€è¿·æ€ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº† Lua è„šæœ¬\" class=\"desc_img\" src=\"https://img2024.cnblogs.com/blog/3703499/202602/3703499-20260205094823688-1305507315.png\" />\n        ä½œä¸ºä¸€ä¸ªé•¿æœŸå’Œå…³ç³»å‹æ•°æ®åº“ï¼ˆRDBMSï¼‰æ‰“äº¤é“çš„å¼€å‘è€…ï¼Œåˆæ¬¡æŸ¥é˜… Redis æ–‡æ¡£æ—¶ï¼Œçœ‹åˆ° MULTIã€EXECã€DISCARD è¿™äº›æŒ‡ä»¤ï¼Œå¿ƒä¸­éš¾å…æ¶Œèµ·ä¸€è‚¡ç”±äºç†Ÿæ‚‰è€Œå¸¦æ¥çš„å®‰å…¨æ„Ÿã€‚\næˆ‘ä»¬çš„å¤§è„‘ä¼šè‡ªåŠ¨å»ºç«‹æ˜ å°„ï¼šMULTI å°±æ˜¯ BEGINï¼ŒEXEC å°±æ˜¯ COMMITï¼ŒDISCARD å°±æ˜¯ ROLLBACKã€‚è¿™å¥—ç»„åˆæ‹³æ‰“ä¸‹æ¥ï¼Œæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ä¼¼ä¹éƒ½åº”è¯¥å…·å¤‡äº†â€œä¸æˆåŠŸä¾¿æˆä»â€çš„åŸå­æ€§ä¿éšœã€‚\nä½†è¿™æ°æ°æ˜¯ Redis ç»™æˆ‘ä¸Šçš„ç¬¬ä¸€è¯¾ï¼šç›¸ä¼¼çš„å‘½åèƒŒåï¼Œå¾€å¾€è—ç€æˆªç„¶ä¸åŒçš„çµé­‚ã€‚ å½“ä½ æŠŠ MySQL çš„äº‹åŠ¡è§‚ç”Ÿæ¬ç¡¬å¥—åˆ° Redis èº«ä¸Šæ—¶ï¼Œé”™ä»˜å°±å·²ç»å¼€å§‹äº†ã€‚\nè¿™ç¯‡æ–‡ç« å°†å¸¦ä½ å‰¥å¼€ Redis äº‹åŠ¡çš„å¤–è¡£ï¼Œä»â€œåŸå­æ€§â€çš„å®šä¹‰åå·®è¯´èµ·ï¼ŒèŠèŠä¸ºä»€ä¹ˆåœ¨ç°ä»£å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šå€¾å‘äºç”¨ Lua è„šæœ¬æ¥æ›¿ä»£å®ƒã€‚\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<blockquote>\n<p><strong>å†™åœ¨å‰é¢çš„è¯</strong></p>\n<p>ä½œä¸ºä¸€ä¸ªé•¿æœŸå’Œå…³ç³»å‹æ•°æ®åº“ï¼ˆRDBMSï¼‰æ‰“äº¤é“çš„å¼€å‘è€…ï¼Œåˆæ¬¡æŸ¥é˜… Redis æ–‡æ¡£æ—¶ï¼Œçœ‹åˆ° <code>MULTI</code>ã€<code>EXEC</code>ã€<code>DISCARD</code> è¿™äº›æŒ‡ä»¤ï¼Œå¿ƒä¸­éš¾å…æ¶Œèµ·ä¸€è‚¡ç”±äºç†Ÿæ‚‰è€Œå¸¦æ¥çš„å®‰å…¨æ„Ÿã€‚</p>\n<p>æˆ‘ä»¬çš„å¤§è„‘ä¼šè‡ªåŠ¨å»ºç«‹æ˜ å°„ï¼š<code>MULTI</code> å°±æ˜¯ <code>BEGIN</code>ï¼Œ<code>EXEC</code> å°±æ˜¯ <code>COMMIT</code>ï¼Œ<code>DISCARD</code> å°±æ˜¯ <code>ROLLBACK</code>ã€‚è¿™å¥—ç»„åˆæ‹³æ‰“ä¸‹æ¥ï¼Œæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ä¼¼ä¹éƒ½åº”è¯¥å…·å¤‡äº†â€œä¸æˆåŠŸä¾¿æˆä»â€çš„åŸå­æ€§ä¿éšœã€‚</p>\n<p>ä½†è¿™æ°æ°æ˜¯ Redis ç»™æˆ‘ä¸Šçš„ç¬¬ä¸€è¯¾ï¼š<strong>ç›¸ä¼¼çš„å‘½åèƒŒåï¼Œå¾€å¾€è—ç€æˆªç„¶ä¸åŒçš„çµé­‚ã€‚</strong> å½“ä½ æŠŠ MySQL çš„äº‹åŠ¡è§‚ç”Ÿæ¬ç¡¬å¥—åˆ° Redis èº«ä¸Šæ—¶ï¼Œé”™ä»˜å°±å·²ç»å¼€å§‹äº†ã€‚</p>\n<p>è¿™ç¯‡æ–‡ç« å°†å¸¦ä½ å‰¥å¼€ <strong>Redis äº‹åŠ¡</strong>çš„å¤–è¡£ï¼Œä»â€œåŸå­æ€§â€çš„å®šä¹‰åå·®è¯´èµ·ï¼ŒèŠèŠä¸ºä»€ä¹ˆåœ¨ç°ä»£å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šå€¾å‘äº<strong>ç”¨ Lua è„šæœ¬æ¥æ›¿ä»£å®ƒã€‚</strong></p>\n</blockquote>\n<hr />\n<h2 id=\"ä¸€å…ˆæŠŠè¯¯ä¼šè§£å¼€redis-äº‹åŠ¡ä¸æ˜¯-acid\">ä¸€ã€å…ˆæŠŠè¯¯ä¼šè§£å¼€ï¼šRedis äº‹åŠ¡ä¸æ˜¯ ACID</h2>\n<p><strong>åœ¨å…³ç³»å‹æ•°æ®åº“çš„ä¸–ç•Œé‡Œï¼Œâ€œäº‹åŠ¡â€äºŒå­—é‡è‹¥åƒé’§</strong>ï¼Œå®ƒå‡ ä¹ç­‰åŒäº <strong>ACID</strong>ï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰ã€‚æˆ‘ä»¬ä¹ æƒ¯äº†â€œè¦ä¹ˆå…¨æœ‰ï¼Œè¦ä¹ˆå…¨æ— â€çš„å®‰å…¨æ„Ÿã€‚</p>\n<p>è€Œåœ¨ Redis çš„ä¸–ç•Œé‡Œï¼Œ<code>MULTI</code> å’Œ <code>EXEC</code> æ›´åƒæ˜¯ä¸€ä¸ª<strong>æ‰¹å¤„ç†ä¿¡å·</strong>ï¼š</p>\n<blockquote>\n<p><strong>æŠŠä¸€å †å‘½ä»¤å…ˆæ”¾è¿›é˜Ÿåˆ—é‡Œæ’é˜Ÿï¼Œç­‰åˆ° <code>EXEC</code> æ—¶ï¼Œä¸€æ¬¡æ€§ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œå®ƒä»¬ã€‚</strong></p>\n</blockquote>\n<p>è¿™é‡Œæœ‰ä¸€ä¸ªå·¨å¤§çš„è®¤çŸ¥åå·®ã€‚å½“æˆ‘ä»¬è°ˆè®º Redis çš„â€œåŸå­æ€§â€æ—¶ï¼ŒRedis æŒ‡çš„å…¶å®æ˜¯ <strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong>ï¼Œè€Œä¸æ˜¯ <strong>å›æ»šï¼ˆRollbackï¼‰</strong>ã€‚</p>\n<ul>\n<li><strong>å®ƒä¿è¯çš„æ˜¯</strong>ï¼š<strong>æˆ‘æ‰§è¡Œè¿™æ®µå‘½ä»¤çš„æ—¶å€™ï¼Œåˆ«äººä¸èƒ½æ’é˜Ÿï¼ˆç‹¬å æ‰§è¡Œï¼‰ã€‚</strong></li>\n<li><strong>å®ƒä¸ä¿è¯çš„æ˜¯</strong>ï¼š<strong>å¦‚æœæˆ‘æ‰§è¡Œåˆ°ä¸€åŠæŠ¥é”™äº†ï¼Œæˆ‘ä¼šå¸®ä½ æŠŠå‰é¢çš„æ“ä½œæ’¤é”€ï¼ˆå¤±è´¥å›æ»šï¼‰ã€‚</strong></li>\n</ul>\n<p>ä¸ºäº†æ›´ç›´è§‚åœ°ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯”ä¸€ä¸‹ Redis äº‹åŠ¡å’Œæ ‡å‡† ACID äº‹åŠ¡çš„åŒºåˆ«ï¼š</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: left;\">ç‰¹æ€§</th>\n<th style=\"text-align: left;\">å…³ç³»å‹æ•°æ®åº“ (MySQL)</th>\n<th style=\"text-align: left;\">Redis äº‹åŠ¡</th>\n<th style=\"text-align: left;\">å·®å¼‚è§£è¯»</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\"><strong>åŸå­æ€§ (Atomicity)</strong></td>\n<td style=\"text-align: left;\"><strong>All or Nothing</strong> <br /> å¤±è´¥å³å›æ»šï¼Œå¦‚åŒæœªå‘ç”Ÿè¿‡</td>\n<td style=\"text-align: left;\"><strong>All or Partial</strong> <br /> æ²¡å¾—å•†é‡ï¼Œé”™äº†å°±é”™äº†ï¼Œå‰©ä¸‹çš„æ¥ç€å¹²</td>\n<td style=\"text-align: left;\">Redis ä¸æ”¯æŒ Rollbackï¼Œéƒ¨åˆ†æˆåŠŸæ˜¯å¸¸æ€</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>ä¸€è‡´æ€§ (Consistency)</strong></td>\n<td style=\"text-align: left;\">å¼ºä¸€è‡´æ€§ <br /> çº¦æŸå¿…é¡»æ»¡è¶³</td>\n<td style=\"text-align: left;\">å¼±ä¸€è‡´æ€§ <br /> ä¾èµ–ä¸šåŠ¡ä»£ç ä¿éšœ</td>\n<td style=\"text-align: left;\">Redis ä¸ä¼šæ ¡éªŒä¸šåŠ¡çº¦æŸï¼ˆå¦‚å¤–é”®ã€éç©ºç­‰ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>éš”ç¦»æ€§ (Isolation)</strong></td>\n<td style=\"text-align: left;\">æœ‰å¤šç§éš”ç¦»çº§åˆ« (RC/RR/Serializable)</td>\n<td style=\"text-align: left;\"><strong>ä¸²è¡ŒåŒ–æ‰§è¡Œ</strong> <br /> æ‰§è¡ŒæœŸé—´ä¸å¯è¢«æ‰“æ–­</td>\n<td style=\"text-align: left;\">å¾—ç›Šäºå•çº¿ç¨‹æ¨¡å‹ï¼Œ<code>EXEC</code> æœŸé—´å¤©ç„¶éš”ç¦»</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>æŒä¹…æ€§ (Durability)</strong></td>\n<td style=\"text-align: left;\">WAL æ—¥å¿—ä¿éšœ <br /> æ‰ç”µä¸ä¸¢å¤±</td>\n<td style=\"text-align: left;\">å–å†³äº AOF/RDB é…ç½®</td>\n<td style=\"text-align: left;\">é»˜è®¤é…ç½®ä¸‹é€šå¸¸æœ‰æ•°æ®ä¸¢å¤±é£é™©</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p><strong>ä¸€å¥è¯æ€»ç»“ï¼š</strong><br />\n<strong>Redis äº‹åŠ¡æ˜¯â€œå‘½ä»¤é˜Ÿåˆ— + ç‹¬å æ‰§è¡Œâ€ï¼Œç»ä¸æ˜¯â€œå¤±è´¥å›æ»š + å¼ºä¸€è‡´â€ã€‚</strong></p>\n</blockquote>\n<hr />\n<h2 id=\"äºŒæ®‹é…·çš„çœŸç›¸å®ƒçœŸçš„ä¸åŒ…å›æ»š\">äºŒã€æ®‹é…·çš„çœŸç›¸ï¼šå®ƒçœŸçš„ä¸åŒ…å›æ»š</h2>\n<p>ä¸ºäº†æŠŠè¿™ä¸ªæ¦‚å¿µåˆ»è¿› DNAï¼Œæˆ‘ä»¬çœ‹ä¸¤ç§çœŸå®çš„é”™è¯¯åœºæ™¯ã€‚</p>\n<h3 id=\"1-å…¥é˜Ÿæ—¶çš„ä½çº§é”™è¯¯å…¨å‘˜è¿å\">1. å…¥é˜Ÿæ—¶çš„â€œä½çº§é”™è¯¯â€ï¼ˆå…¨å‘˜è¿åï¼‰</h3>\n<p>å¦‚æœä½ åœ¨<strong>å‘½ä»¤å…¥é˜Ÿé˜¶æ®µ</strong>å°±çŠ¯äº†è¯­æ³•é”™è¯¯ï¼ˆæ¯”å¦‚å‚æ•°å†™å°‘äº†ï¼‰ï¼ŒRedis è¿˜æ˜¯è®²é“ç†çš„ï¼Œå®ƒä¼šç›´æ¥æ‹’ç»æ•´ä¸ªäº‹åŠ¡ã€‚</p>\n<pre><code class=\"language-bash\">127.0.0.1:6379&gt; MULTI\nOK\n127.0.0.1:6379&gt; SET key1 value1\nQUEUED\n127.0.0.1:6379&gt; SET key2      # &lt;--- è¯­æ³•é”™è¯¯ï¼šå°‘äº†å‚æ•°\n(error) ERR wrong number of arguments for 'set' command\n127.0.0.1:6379&gt; EXEC\n(error) EXECABORT Transaction discarded because of previous errors.\n</code></pre>\n<p>è¿™æ—¶å€™ï¼Œ<strong>æ‰€æœ‰å‘½ä»¤éƒ½ä¸ä¼šæ‰§è¡Œ</strong>ã€‚è¿™ç¬¦åˆæˆ‘ä»¬å¯¹â€œäº‹åŠ¡â€çš„é¢„æœŸã€‚</p>\n<h3 id=\"2-æ‰§è¡Œæ—¶çš„è¿è¡Œæ—¶é”™è¯¯è™½æ­»çŠ¹è¿›\">2. æ‰§è¡Œæ—¶çš„â€œè¿è¡Œæ—¶é”™è¯¯â€ï¼ˆè™½æ­»çŠ¹è¿›ï¼‰</h3>\n<p>è¿™æ‰æ˜¯çœŸæ­£çš„å‘ã€‚å‡è®¾è¯­æ³•æ²¡é—®é¢˜ï¼Œä½†åœ¨<strong>æ‰§è¡ŒæœŸé—´</strong>ï¼ŒæŸæ¡å‘½ä»¤å› ä¸ºæ•°æ®ç±»å‹ä¸åŒ¹é…æŠ¥é”™äº†ï¼š</p>\n<pre><code class=\"language-bash\">127.0.0.1:6379&gt; MULTI\nOK\n127.0.0.1:6379&gt; SET user:A:points 100\nQUEUED\n127.0.0.1:6379&gt; LPUSH user:A:points \"error_data\"  # &lt;--- å¯¹ String ç±»å‹åš List æ“ä½œï¼Œæ³¨å®šè¿è¡ŒæŠ¥é”™\nQUEUED\n127.0.0.1:6379&gt; INCR user:A:points                 # &lt;--- åç»­å‘½ä»¤\nQUEUED\n\n127.0.0.1:6379&gt; EXEC\n1) OK\n2) (error) WRONGTYPE Operation against a key holding the wrong kind of value  &lt;--- æŠ¥é”™ï¼\n3) (integer) 101                                                              &lt;--- ä¾ç„¶æˆåŠŸäº†ï¼\n</code></pre>\n<p><strong>ç›®çªå£å‘†äº†å—ï¼Ÿ</strong><br />\nç¬¬äºŒæ¡å‘½ä»¤æŠ¥é”™äº†ï¼Œä½†ç¬¬ä¸‰æ¡å‘½ä»¤ä¾ç„¶æ¬¢å¿«åœ°æ‰§è¡Œäº†ã€‚æ•°æ®å‡ºç°äº†ä¸­é—´æ€ï¼šå³æ‰€è°“çš„â€œä¸ä¸€è‡´â€ã€‚</p>\n<p>Redis å®˜æ–¹å¯¹æ­¤çš„è§£é‡Šéå¸¸â€œç›´ç”·â€ï¼š</p>\n<blockquote>\n<p>â€œåªæœ‰è¯­æ³•é”™è¯¯æ‰ä¼šè¢«æ‹¦æˆªï¼Œè¿è¡Œæ—¶é”™è¯¯å±äºç¨‹åºå‘˜çš„é€»è¾‘ Bugï¼ˆæ¯”å¦‚æŠŠ String å½“ List ç”¨ï¼‰ã€‚<strong>æ•°æ®åº“ä¸åº”è¯¥ä¸ºäº†ç¨‹åºå‘˜çš„ Bug ä¹°å•ï¼Œå»æå¤æ‚çš„å›æ»šæœºåˆ¶ã€‚</strong>â€</p>\n</blockquote>\n<hr />\n<h2 id=\"ä¸‰è¿›é˜¶ä¹‹è·¯ä»åŸç”Ÿæ‰¹é‡åˆ°-lua-è„šæœ¬\">ä¸‰ã€è¿›é˜¶ä¹‹è·¯ï¼šä»åŸç”Ÿæ‰¹é‡åˆ° Lua è„šæœ¬</h2>\n<blockquote>\n<p><strong>ğŸ’¡ é¢„å¤‡çŸ¥è¯†ï¼šRTT æ˜¯æ€§èƒ½æ€æ‰‹</strong></p>\n<p>ä¸€ä¸ª Redis å‘½ä»¤çš„æ‰§è¡Œå¯ä»¥ç®€åŒ–ä¸º 4 æ­¥ï¼š<strong>å‘é€å‘½ä»¤ â†’ å‘½ä»¤æ’é˜Ÿ â†’ å‘½ä»¤æ‰§è¡Œ â†’ è¿”å›ç»“æœ</strong>ã€‚</p>\n<p>å…¶ä¸­ï¼Œç¬¬ 1 æ­¥å’Œç¬¬ 4 æ­¥çš„æ—¶é—´ä¹‹å’Œç§°ä¸º <strong>RTT (å¾€è¿”æ—¶é—´)</strong>ã€‚å¦‚æœæˆ‘æœ‰ 100 ä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªä¸ªå‘å°±éœ€è¦ 100 æ¬¡ RTTï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½æµªè´¹åœ¨ç½‘ç»œä¼ è¾“ä¸Šã€‚<br />\n<strong>æ‰¹é‡æ“ä½œçš„æ ¸å¿ƒæ„ä¹‰ï¼Œå°±æ˜¯æŠŠ 100 æ¬¡ RTT å‹ç¼©æˆ 1 æ¬¡ã€‚</strong></p>\n</blockquote>\n<p>æ—¢ç„¶ <code>MULTI/EXEC</code> è¿™ä¹ˆâ€œå¤´é“â€ï¼Œé‚£æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­åˆ°åº•è¯¥æ€ä¹ˆé€‰ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠ Redis çš„æ‰¹é‡æ“ä½œèƒ½åŠ›åˆ†ä¸ºå‡ ä¸ªæ®µä½ã€‚</p>\n<h3 id=\"lv1-åŸç”Ÿæ‰¹é‡å‘½ä»¤-mset--mget\">Lv1. åŸç”Ÿæ‰¹é‡å‘½ä»¤ (MSET / MGET)</h3>\n<p>è¿™æ˜¯æœ€ç®€å•ã€æœ€å¿«çš„æ–¹å¼ã€‚</p>\n<ul>\n<li><strong>ç‰¹ç‚¹</strong>ï¼šåŸç”Ÿçš„åŸå­æ€§ã€‚<code>MSET key1 val1 key2 val2</code> æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œ<strong>è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥</strong>ï¼ˆåœ¨ Redis å±‚é¢ï¼‰ã€‚</li>\n<li><strong>ç¤ºä¾‹</strong>ï¼š<pre><code class=\"language-bash\">MSET key1 \"Hello\" key2 \"World\"\n</code></pre>\n</li>\n<li><strong>å±€é™</strong>ï¼šåªèƒ½å¤„ç†åŒä¸€ç§å‘½ä»¤ï¼Œé€»è¾‘æ­»æ¿ã€‚</li>\n</ul>\n<h3 id=\"lv2-ç®¡é“-pipeline\">Lv2. ç®¡é“ (Pipeline)</h3>\n<p>å½“ä½ éœ€è¦æ‰¹é‡æ‰§è¡Œå‡ åä¸ªä¸åŒçš„å‘½ä»¤ï¼Œä¸”ä¸éœ€è¦å®ƒä»¬ä¹‹é—´æœ‰é€»è¾‘ä¾èµ–æ—¶ï¼ŒPipeline æ˜¯é¦–é€‰ã€‚</p>\n<ul>\n<li><strong>ç‰¹ç‚¹</strong>ï¼š<strong>å”¯å¿«ä¸ç ´</strong>ã€‚å®ƒæŠŠå‡ åä¸ªå‘½ä»¤æ‰“åŒ…ï¼Œä¸€æ¬¡ç½‘ç»œè¯·æ±‚ï¼ˆRTTï¼‰å‘ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ‰§è¡Œå®Œå†ä¸€æ¬¡æ€§è¿”å›ã€‚</li>\n<li><strong>å½¢è±¡ç†è§£</strong>ï¼š<strong>ä¸‹ 100 ä¸ªå• -&gt; ä¸€æ¬¡æ€§æ”¶ 100 ä¸ªå¿«é€’ (1 æ¬¡ RTT)</strong>ã€‚</li>\n<li><strong>ä¸äº‹åŠ¡çš„åŒºåˆ«</strong>ï¼š\n<ul>\n<li><strong>éåŸå­æ€§</strong>ï¼šPipeline åªæ˜¯æ‰“åŒ…å‘é€ï¼ŒRedis å¯èƒ½ä¼šåœ¨å¤„ç† Pipeline ä¸­é—´ç©¿æ’æ‰§è¡Œå…¶ä»–å®¢æˆ·ç«¯çš„å‘½ä»¤ï¼ˆäº¤é”™æ‰§è¡Œï¼‰ã€‚</li>\n<li><strong>æ•ˆç‡æ›´é«˜</strong>ï¼šä¸éœ€è¦åƒäº‹åŠ¡é‚£æ ·æ¯ä¸ªå‘½ä»¤éƒ½å‘ä¸€æ¬¡ï¼Œåªéœ€è¦å‘é€ä¸€æ¬¡ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"lv3-äº‹åŠ¡-multi--exec\">Lv3. äº‹åŠ¡ (MULTI / EXEC)</h3>\n<p>æ¯” Pipeline å¤šäº†ä¸€å±‚ä¿éšœï¼š<strong>ç‹¬å æ‰§è¡Œ</strong>ã€‚</p>\n<ul>\n<li><strong>ç‰¹ç‚¹</strong>ï¼š<strong>åŸå­æ“ä½œï¼ˆéš”ç¦»æ€§ï¼‰</strong>ã€‚\n<ul>\n<li><strong>ä¸¤ä¸ªä¸åŒçš„äº‹åŠ¡ä¸ä¼šåŒæ—¶è¿è¡Œ</strong>ã€‚åœ¨ <code>EXEC</code> æ‰§è¡ŒæœŸé—´ï¼ŒRedis ä¼šâ€œä»¥æ­¤ä¸ºå°Šâ€ï¼Œä¿è¯æ²¡æœ‰å…¶ä»–å®¢æˆ·ç«¯èƒ½æ’é˜Ÿã€‚</li>\n</ul>\n</li>\n<li><strong>ç¼ºç‚¹</strong>ï¼š\n<ul>\n<li><strong>RTT å¼€é”€å¤§</strong>ï¼šäº‹åŠ¡ä¸­ <strong>æ¯ä¸ªå‘½ä»¤éƒ½éœ€è¦å•ç‹¬å‘é€</strong> åˆ°æœåŠ¡ç«¯å…¥é˜Ÿï¼Œè¯·æ±‚æ¬¡æ•°å¹¶æ²¡æœ‰å‡å°‘ã€‚</li>\n<li><strong>ä¸æ”¯æŒå›æ»š</strong>ï¼Œä¸æ”¯æŒåœ¨äº‹åŠ¡ä¸­é—´åšé€»è¾‘åˆ¤æ–­ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"lv31-äº‹åŠ¡--watch-ä¹è§‚é”\">Lv3.1 äº‹åŠ¡ + WATCH (ä¹è§‚é”)</h3>\n<p>å•çº¯çš„ <code>MULTI/EXEC</code> å¾€å¾€æ¯”è¾ƒé¸¡è‚‹ï¼Œå› ä¸ºå®ƒæ— æ³•æ„ŸçŸ¥ä¸­é—´çŠ¶æ€ã€‚<strong>ä½†è¿™å¥—æœºåˆ¶å”¯ä¸€çš„â€œç‹ç‰Œâ€ç»„åˆæ˜¯é…åˆ <code>WATCH</code> å‘½ä»¤ï¼Œå®ç°ä¹è§‚é” (CAS)ã€‚</strong></p>\n<ul>\n<li>\n<p><strong>åœºæ™¯</strong>ï¼šç§’æ€æ‰£å‡åº“å­˜ã€‚</p>\n<ul>\n<li>åœ¨ <code>MULTI</code> ä¹‹å‰ <code>WATCH stock</code>ã€‚</li>\n<li>å¦‚æœåœ¨ <code>EXEC</code> æ‰§è¡Œå‰ <code>stock</code> è¢«åˆ«äººæ”¹äº†ï¼Œæ•´ä¸ªäº‹åŠ¡åŸåœ°å–æ¶ˆï¼ˆè¿”å› nilï¼‰ã€‚</li>\n</ul>\n</li>\n<li>\n<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>\n<pre><code class=\"language-bash\">WATCH stock:001                # 1. ç›‘è§†åº“å­˜\nGET stock:001                  # 2. è¯»åº“å­˜ï¼Œå‘ç°æ˜¯ 10\nMULTI                          # 3. å¼€å¯äº‹åŠ¡ (å¼€å§‹æ’é˜Ÿ)\nDECR stock:001                 # 4. å‡åº“å­˜\nEXEC                           # 5. æ‰§è¡Œ\n# å¦‚æœåœ¨æ­¥éª¤ 1-5 ä¹‹é—´ï¼Œåˆ«äººæ”¹äº† stock:001ï¼Œè¿™é‡Œä¼šè¿”å› (nil)ï¼Œäº‹åŠ¡å›æ»šã€‚\n</code></pre>\n</li>\n<li>\n<p><strong>è‡´å‘½å¼±ç‚¹</strong>ï¼š<strong>é«˜å¹¶å‘ä¸‹æ€§èƒ½æå·®</strong>ã€‚</p>\n<ul>\n<li>å°±åƒä¸€ç¾¤äººæŠ¢ä¸€ä¸ªéº¦å…‹é£ï¼Œä¸€ä¸ªäººæŠ¢åˆ°äº†ï¼Œå…¶ä»–äººçš„ <code>CAS</code> å…¨éƒ¨å¤±è´¥ï¼Œåªèƒ½å®¢æˆ·ç«¯é‡è¯•ï¼ˆè‡ªæ—‹ï¼‰ã€‚</li>\n<li><strong>ç«äº‰è¶Šæ¿€çƒˆï¼Œé‡è¯•è¶Šé¢‘ç¹ï¼ŒCPU ç©ºè½¬è¶Šä¸¥é‡ã€‚</strong></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"lv4-æœ€ç»ˆå…µå™¨--lua-è„šæœ¬\">Lv4. æœ€ç»ˆå…µå™¨ â€”â€” Lua è„šæœ¬</h3>\n<p>ä» Redis 2.6 å¼€å§‹ï¼ŒLua è„šæœ¬æˆä¸ºäº†è§£å†³å¤æ‚åŸå­æ€§é—®é¢˜çš„æ ¸å¿ƒæ–¹æ¡ˆï¼Œå®ƒå®Œç¾æ›¿ä»£äº† <code>WATCH</code> äº‹åŠ¡ã€‚</p>\n<p><strong>ä¸ºä»€ä¹ˆå®ƒæ¯”äº‹åŠ¡å¼ºï¼Ÿ</strong></p>\n<ol>\n<li><strong>é€»è¾‘åŸå­æ€§</strong>ï¼šä¸€æ®µ Lua è„šæœ¬è¢«è§†ä½œä¸€æ¡å‘½ä»¤ã€‚Redis ä¿è¯è„šæœ¬æ‰§è¡ŒæœŸé—´ï¼Œ<strong>ä¸ä¼šæœ‰ä»»ä½•å…¶ä»–è„šæœ¬æˆ–å‘½ä»¤æ’å…¥</strong>ã€‚</li>\n<li><strong>æ•ˆç‡æ›´é«˜</strong>ï¼šä¸éœ€è¦åƒ <code>WATCH</code> é‚£æ ·åå¤é‡è¯•ã€‚è„šæœ¬åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œï¼Œåªæœ‰ä¸€æ¬¡ RTTã€‚</li>\n</ol>\n<p><strong>ç¤ºä¾‹ï¼šå®‰å…¨çš„â€œå…ˆæŸ¥åæ”¹â€</strong></p>\n<pre><code class=\"language-lua\">-- åˆ¤æ–­ key æ˜¯å¦ç­‰äºé¢„æœŸå€¼ï¼Œå¦‚æœæ˜¯åˆ™åˆ é™¤\nif redis.call(\"GET\", KEYS[1]) == ARGV[1] then\n    return redis.call(\"DEL\", KEYS[1])\nelse\n    return 0\nend\n</code></pre>\n<p><strong>âš ï¸ å¿…é¡»è­¦æƒ•çš„ç¼ºé™·ï¼šLua ä¹Ÿä¸å›æ»šï¼</strong><br />\nè™½ç„¶ Lua è„šæœ¬è¢«ç§°ä¸ºâ€œåŸå­æ“ä½œâ€ï¼Œä½†è¯·æ³¨æ„ï¼šå®ƒçš„åŸå­æ€§ä¾ç„¶æŒ‡çš„æ˜¯<strong>ä¸è¢«æ‰“æ‰°</strong>ï¼Œè€Œä¸æ˜¯<strong>å¤±è´¥å›æ»š</strong>ã€‚</p>\n<blockquote>\n<p><strong>å¦‚æœ Lua è„šæœ¬è¿è¡Œåˆ°ä¸­é€”å‡ºé”™ï¼ˆæ¯”å¦‚è°ƒç”¨äº†ä¸å­˜åœ¨çš„å‘½ä»¤ï¼Œæˆ–æ˜¾å¼æŠ¥é”™é€€å‡ºï¼‰ï¼Œè„šæœ¬ä¼šåœæ­¢æ‰§è¡Œï¼Œä½†ä¹‹å‰å·²ç»æ‰§è¡Œè¿‡çš„å†™æ“ä½œï¼Œæ˜¯ä¸ä¼šè¢«æ’¤é”€çš„ï¼</strong></p>\n</blockquote>\n<p>è¿™æ„å‘³ç€ï¼Œå³ä½¿æ˜¯ Luaï¼Œä¹Ÿä¸èƒ½ç»™ä½ å¸¦æ¥ RDBMS é‚£ç§â€œå›æ»šä¸€åˆ‡â€çš„å®‰å…¨æ„Ÿã€‚ä½ ä¾ç„¶éœ€è¦åœ¨ä»£ç å±‚é¢ä¿è¯é€»è¾‘çš„ä¸¥å¯†æ€§ã€‚</p>\n<hr />\n<h2 id=\"å››æ€»ç»“é€‰å‹å†³ç­–è¡¨\">å››ã€æ€»ç»“ï¼šé€‰å‹å†³ç­–è¡¨</h2>\n<p>ä¸ºäº†è®©ä½ åœ¨å®é™…ä¸šåŠ¡ä¸­ä¸å†çº ç»“ï¼Œæˆ‘æ•´ç†äº†ä¸€ä»½ç®€å•çš„å†³ç­–è¡¨ï¼š</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: left;\">éœ€æ±‚åœºæ™¯</th>\n<th style=\"text-align: left;\">æ¨èæ–¹æ¡ˆ</th>\n<th style=\"text-align: left;\">æ ¸å¿ƒç†ç”±</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\"><strong>ç®€å•æ‰¹é‡è¯»å†™ (KV)</strong></td>\n<td style=\"text-align: left;\"><strong>MSET / MGET</strong></td>\n<td style=\"text-align: left;\">åŸç”Ÿå‘½ä»¤ï¼Œæœ€å¿«ï¼Œæœ€çœå¿ƒã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>å¤§é‡ç¦»æ•£å‘½ä»¤ (æ— å…³è”)</strong></td>\n<td style=\"text-align: left;\"><strong>Pipeline</strong></td>\n<td style=\"text-align: left;\">ç½‘ç»œå¼€é”€æœ€ä½ï¼Œååé‡æœ€é«˜ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>éœ€è¦ CAS (ä½å¹¶å‘)</strong></td>\n<td style=\"text-align: left;\"><strong>WATCH + MULTI</strong></td>\n<td style=\"text-align: left;\"><strong>äº‹åŠ¡å”¯ä¸€çš„ç”¨æ­¦ä¹‹åœ°ã€‚</strong> é€‚åˆä½é¢‘ç«äº‰ï¼Œå®ç°ç®€å•ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>å¤æ‚é€»è¾‘ / é«˜å¹¶å‘</strong></td>\n<td style=\"text-align: left;\"><strong>Lua è„šæœ¬</strong></td>\n<td style=\"text-align: left;\"><strong>è¡Œä¸šæ ‡å‡†ã€‚</strong> é¿å…äº† CAS è‡ªæ—‹çš„æ€§èƒ½å¼€é”€ï¼ŒåŸå­æ€§å¼ºã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>å³ä½¿æŠ¥é”™ä¹Ÿè¦å›æ»š</strong></td>\n<td style=\"text-align: left;\"><strong>MySQL / RDBMS</strong></td>\n<td style=\"text-align: left;\"><strong>åˆ«ä¸ºéš¾ Redisã€‚</strong> å®ƒæ²¡æœ‰ Undo Logï¼Œåšä¸åˆ°çœŸæ­£çš„å›æ»šã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å†™åœ¨æœ€å\">å†™åœ¨æœ€å</h2>\n<p>å›å¤´çœ‹ï¼Œ<strong>Redis äº‹åŠ¡è¿™å¥—æœºåˆ¶ï¼Œå°±åƒæ˜¯ä¸€ä¸ªâ€œå¦‚æœä¸ä»”ç»†è¯»è¯´æ˜ä¹¦ä¸€å®šä¼šç”¨é”™â€çš„åŠæˆå“ã€‚</strong></p>\n<p>ä½†æ­£æ˜¯è¿™ä¸ªâ€œåŠæˆå“â€ï¼ŒæŠ˜å°„å‡ºäº† Redis æœ€åº•å±‚çš„ä»·å€¼è§‚ï¼š<strong>ä¸ºäº†æ€§èƒ½ï¼Œå¯ä»¥ç‰ºç‰²ä¸€åˆ‡â€œçœ‹èµ·æ¥å¾ˆç¾â€çš„æŠ½è±¡</strong>ã€‚å®ƒæ‹’ç»äº†æ²‰é‡çš„ Undo Logï¼Œæ‹’ç»äº†å¤æ‚çš„éš”ç¦»çº§åˆ«ï¼Œåªç•™ä¸‹äº†ä¸€ä¸ªæœ€ç®€å•çš„â€œæ’é˜Ÿæ‰§è¡Œâ€é€»è¾‘ã€‚</p>\n<p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬ä¸‹æ¬¡å†å†™ä¸‹ <code>MULTI</code> çš„æ—¶å€™ï¼Œå¿ƒé‡Œè¦æ¸…æ¥šï¼š</p>\n<ul>\n<li>å¦‚æœåªæ˜¯ä¸ºäº†å¿«ï¼Œ<strong>Pipeline</strong> æ‰æ˜¯é‚£ä¸ªä¸è®²æ­¦å¾·çš„â€œåŠ é€Ÿå™¨â€ã€‚</li>\n<li>å¦‚æœåªæ˜¯ä¸ºäº†é˜²æ’é˜Ÿï¼Œ<strong>Transaction</strong> å¤Ÿç”¨äº†ï¼Œä½†åœ¨é«˜å¹¶å‘ä¸‹ï¼Œå®ƒè„†å¼±å¾—åƒä¸ªæ˜“ç¢å“ã€‚</li>\n<li>å¦‚æœè¦å¤„ç†çœŸæ­£çš„å¤æ‚é€»è¾‘ï¼Œè¯·æ¯«ä¸çŠ¹è±«åœ°æ‹¥æŠ± <strong>Lua</strong> â€”â€” è™½ç„¶å®ƒä¹Ÿä¸ä¼šå›æ»šï¼Œä½†è‡³å°‘åœ¨â€œæ‰§è¡ŒåŸå­æ€§â€ä¸Šï¼Œå®ƒæ˜¯æˆ‘ä»¬æ‰‹é‡Œæœ€ç¨³çš„é‚£å¼ ç‰Œã€‚</li>\n</ul>\n<p>çœŸæ­£çš„æŠ€æœ¯æˆç†Ÿï¼Œä¸æ˜¯èƒŒè¯µå…«è‚¡æ–‡é‡Œçš„ ACID å®šä¹‰ï¼Œè€Œæ˜¯æ‡‚å¾—åœ¨<strong>ç”±äºç‰©ç†é™åˆ¶è€Œæ»¡æ˜¯é—æ†¾çš„çœŸå®ä¸–ç•Œé‡Œ</strong>ï¼Œåšå‡ºé‚£ä¸ªæœ€ä¸åçš„é€‰æ‹©ã€‚</p>\n<hr />\n<blockquote>\n<p>æ–‡ç« çš„æœ€åï¼Œæƒ³å’Œä½ å¤šèŠä¸¤å¥ã€‚</p>\n<p>æŠ€æœ¯ä¹‹è·¯ï¼Œå¸¸å¸¸æ˜¯çƒ­é—¹ä¸å­¤ç‹¬å¹¶å­˜ã€‚é‚£äº›æ·±å¤œçš„è°ƒè¯•ã€çµå…‰ä¸€é—ªçš„æ–¹æ¡ˆã€è¿˜æœ‰è¸©å‘çˆ¬èµ·åçš„é¡¿æ‚Ÿï¼Œå¦‚æœèƒ½æœ‰äººä¸€èµ·èŠèŠï¼Œè¯¥å¤šå¥½ã€‚</p>\n<p>ä¸ºæ­¤ï¼Œæˆ‘å»ºäº†ä¸€ä¸ªå°èŠ±å›­â€”â€”æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ã€Œ<strong>[åŠªåŠ›çš„å°éƒ‘]</strong>ã€ã€‚</p>\n<p>è¿™é‡Œæ²¡æœ‰é«˜æ·±è«æµ‹çš„ç†è®ºå †ç Œï¼Œåªæœ‰æˆ‘å¯¹åç«¯å¼€å‘ã€ç³»ç»Ÿè®¾è®¡å’Œå·¥ç¨‹å®è·µçš„æŒç»­æ€è€ƒä¸æ²‰æ·€ã€‚å®ƒæ›´åƒæˆ‘çš„<strong>æ•°å­—ç¬”è®°æœ¬</strong>ï¼Œè®°å½•ç€é‚£äº›å€¼å¾—è¢«è®°ä½çš„è§£å†³æ–¹æ¡ˆå’Œæ€ç»´ç«èŠ±ã€‚</p>\n<p>å¦‚æœä½ è§‰å¾—ä»Šå¤©çš„æ–‡ç« è¿˜æœ‰ä¸€ç‚¹å¯å‘ï¼Œæˆ–è€…å•çº¯æƒ³æ‰¾ä¸€ä¸ªåŒè¡Œè€…å¶å°”èŠèŠæŠ€æœ¯ã€è°ˆè°ˆæ€è€ƒï¼Œé‚£ä¹ˆï¼Œæ¬¢è¿ä½ æ¥ååã€‚<br />\n<img alt=\"85f114bceb12e933bb817ec5fecdfef7\" class=\"lazyload\" /></p>\n<p>æ„¿ä½ å‰è¡Œè·¯ä¸Šï¼Œæ€»æœ‰ä»£ç å¯å†™ï¼Œæœ‰æ¢¦å¯è¿½ï¼Œä¹Ÿæœ‰ç¯ç«å¯äº²ã€‚</p>\n</blockquote>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-05 09:49</span>&nbsp;\n<a href=\"https://www.cnblogs.com/xzqcsj\">ä¸€æ—…äºº</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">134</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "MWGA åŒçº¿ç¼–è¯‘æŠ€æœ¯æ–¹æ¡ˆï¼šä¸€ä»½ä»£ç ï¼ŒåŒç«¯ç”Ÿæˆ",
      "link": "https://www.cnblogs.com/xdesigner/p/19579270",
      "published": "",
      "description": "<h2>\n\t\t\t<a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xdesigner/p/19579270\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-05 14:44\">\n    <span>MWGA åŒçº¿ç¼–è¯‘æŠ€æœ¯æ–¹æ¡ˆï¼šä¸€ä»½ä»£ç ï¼ŒåŒç«¯ç”Ÿæˆ</span>\n    \n\n</a>\n\n\t\t</h2>\n\t\t<div class=\"postText\">    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        ä¼ä¸šè½¯ä»¶æ™®éé¢ä¸´æ¡Œé¢ç«¯æ·±åº¦åº”ç”¨ä¸ç½‘é¡µç«¯ä¾¿æ·è®¿é—®çš„åŒé‡éœ€æ±‚ã€‚ä¼ ç»Ÿåšæ³•éœ€è¦ä¸¤å¥—æŠ€æœ¯æ ˆã€ä¸¤å¥—ä»£ç åº“ä¸ä¸¤å¥—ç ”å‘å›¢é˜Ÿï¼Œå¯¼è‡´æˆæœ¬é«˜ã€å‘¨æœŸé•¿ã€åŒç«¯é€»è¾‘ä¸ä¸€è‡´ã€‚MWGA å‡­å€ŸåŒçº¿ç¼–è¯‘èƒ½åŠ›ï¼Œä»…éœ€ä¸€ä»½ C# æ ¸å¿ƒä»£ç ï¼Œå³å¯åŒæ—¶ç”Ÿæˆæ¡Œé¢ EXE ä¸ç½‘é¡µ WebAssembly åº”ç”¨ï¼Œå®ç°åŒç«¯ä»£ç å¤ç”¨ã€é€»è¾‘ç»Ÿä¸€ã€ä½æˆæœ¬ç»´æŠ¤ï¼Œä¸ºè·¨ç«¯å¼€å‘æä¾›å…¨æ–°è§£å†³æ–¹æ¡ˆã€‚\n    </div>\n<div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">&nbsp;<span>ä¸€ã€å¼•è¨€</span></h1>\n<div class=\"Editable-unstyled\">\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¼ä¸šè½¯ä»¶æ™®éé¢ä¸´<span>æ¡Œé¢ç«¯æ·±åº¦åº”ç”¨<span>ä¸<span>ç½‘é¡µç«¯ä¾¿æ·è®¿é—®<span>çš„åŒé‡éœ€æ±‚ã€‚ä¼ ç»Ÿåšæ³•éœ€è¦ä¸¤å¥—æŠ€æœ¯æ ˆã€ä¸¤å¥—ä»£ç åº“ä¸ä¸¤å¥—ç ”å‘å›¢é˜Ÿï¼Œå¯¼è‡´æˆæœ¬é«˜ã€å‘¨æœŸé•¿ã€åŒç«¯é€»è¾‘ä¸ä¸€è‡´ã€‚<span>MWGA å‡­å€ŸåŒçº¿ç¼–è¯‘èƒ½åŠ›<span>ï¼Œä»…éœ€ä¸€ä»½ C# æ ¸å¿ƒä»£ç ï¼Œå³å¯åŒæ—¶ç”Ÿæˆ<span>æ¡Œé¢ EXE<span> ä¸<span>ç½‘é¡µ WebAssembly åº”ç”¨<span>ï¼Œå®ç°åŒç«¯ä»£ç å¤ç”¨ã€é€»è¾‘ç»Ÿä¸€ã€ä½æˆæœ¬ç»´æŠ¤ï¼Œä¸ºè·¨ç«¯å¼€å‘æä¾›å…¨æ–°è§£å†³æ–¹æ¡ˆã€‚</span></span></span></span></span></span></span></span></span></span></span></p>\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">&nbsp;</p>\n</div>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>äºŒã€æ ¸å¿ƒæŠ€æœ¯åŸç†</span></h1>\n<div class=\"Editable-unstyled\">\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>MWGA çš„åŒçº¿ç¼–è¯‘åŸºäº<span>æ¨¡å—åŒ–æ¶æ„<span>ä¸<span>è·¨å¹³å°ç¼–è¯‘å¼•æ“<span>ï¼Œå®ç°ã€Œ<span>ä¸€ä»½ä»£ç ï¼ŒåŒå‘ç”Ÿæˆ<span>ã€ã€‚</span></span></span></span></span></span></span></p>\n</div>\n<ul class=\"public-DraftStyleDefault-ul\">\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä»£ç åˆ†å±‚ï¼š<span> å°†ä»£ç åˆ’åˆ†ä¸º<span>æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚<span>ä¸<span>ç«¯ä¾§ UI é€‚é…å±‚<span>ã€‚æ ¸å¿ƒå±‚åŒ…å«æ•°æ®æ¨¡å‹ã€ç®—æ³•ã€æƒé™æ ¡éªŒç­‰é€šç”¨åŠŸèƒ½ï¼Œçº¯ C# ç¼–å†™ä¸”ä¸ä¾èµ–ç«¯ä¾§ APIï¼ŒåŒç«¯<span>å®Œå…¨å¤ç”¨<span>ï¼›UI å±‚æ ¹æ®æ¡Œé¢ä¸ç½‘é¡µç‰¹æ€§åˆ†åˆ«åšè½»é‡åŒ–é€‚é…ã€‚</span></span></span></span></span></span></span></span></p>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>åŒçº¿ç¼–è¯‘å¼•æ“ï¼š<span> å¯¹æ ¸å¿ƒä»£ç è¿›è¡ŒåŒå‘è½¬æ¢â€”â€”ç¼–è¯‘ä¸º EXE æ—¶æ•´åˆæ¡Œé¢ UIï¼Œç”ŸæˆåŸç”Ÿåº”ç”¨ï¼Œæ”¯æŒæœ¬åœ°é«˜æ€§èƒ½ä¸ç¡¬ä»¶å¯¹æ¥ï¼›ç¼–è¯‘ä¸º WebAssembly æ—¶ï¼Œç”Ÿæˆæµè§ˆå™¨å¯ç›´æ¥è¿è¡Œçš„åº”ç”¨ï¼Œå®ç°é›¶å®‰è£…ã€è·¨å¹³å°è®¿é—®ã€‚<span>æ ¸å¿ƒé€»è¾‘æ— éœ€ä¿®æ”¹<span>ï¼Œä»…é€šè¿‡é…ç½®å³å¯åˆ‡æ¢è¾“å‡ºå½¢æ€ï¼Œä»åº•å±‚ä¿éšœä»£ç å¤ç”¨ä¸åŒç«¯ç¨³å®šè¿è¡Œã€‚</span></span></span></span></p>\n</li>\n</ul>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">&nbsp;</h1>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¸‰ã€å·¥ç¨‹å®è·µæ ¸å¿ƒä¼˜åŠ¿</span></h1>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><strong><span>ï¼ˆä¸€ï¼‰ä»£ç é›¶é‡å¤ï¼Œç ”å‘æ•ˆç‡ç¿»å€</span></strong></h2>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¼ ç»Ÿè·¨ç«¯å¼€å‘ä¸­ï¼Œ60%â€“80% çš„ä¸šåŠ¡é€»è¾‘éœ€é‡å¤ç¼–å†™ï¼›<span>MWGA å®ç°æ ¸å¿ƒé€»è¾‘ 100% å¤ç”¨<span>ã€‚ä»¥è¿›é”€å­˜ç³»ç»Ÿä¸ºä¾‹ï¼Œæˆæœ¬è®¡ç®—ã€åº“å­˜æ ¸ç®—ç­‰åŠŸèƒ½ä»…éœ€ç¼–å†™ä¸€æ¬¡ï¼ŒåŒç«¯ç›´æ¥è°ƒç”¨ï¼Œç ”å‘å·¥ä½œé‡å‡å°‘ <span>50% ä»¥ä¸Š<span>ï¼Œæ–°åŠŸèƒ½ä¸Šçº¿å‘¨æœŸç¼©çŸ­ <span>40%â€“60%<span>ã€‚</span></span></span></span></span></span></span></div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><strong><span>ï¼ˆäºŒï¼‰é€»è¾‘ç»å¯¹ä¸€è‡´ï¼Œè§„é¿ä¸šåŠ¡é£é™©</span></strong></h2>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è´¢åŠ¡ã€åŒ»ç–—ã€å·¥ä¸šç­‰è¡Œä¸šå¯¹ä¸šåŠ¡ä¸€è‡´æ€§è¦æ±‚æé«˜ï¼ŒåŒç«¯é€»è¾‘å·®å¼‚æ˜“å¼•å‘æ•°æ®é”™è¯¯ä¸åˆè§„é£é™©ã€‚<span>MWGA åŒç«¯è°ƒç”¨åŒä¸€æ ¸å¿ƒä»£ç <span>ï¼Œè®¡ç®—ç»“æœã€æƒé™è§„åˆ™ã€ä¸šåŠ¡æµç¨‹ <span>100% ç»Ÿä¸€<span>ï¼Œå½»åº•æœç»é€»è¾‘å†²çªï¼Œé™ä½åˆè§„ä¸ä¸šåŠ¡é£é™©ã€‚</span></span></span></span></span></div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><strong><span>ï¼ˆä¸‰ï¼‰ç»´æŠ¤æˆæœ¬å¤§é™ï¼Œè¿­ä»£æ•ˆç‡æå‡</span></strong></h2>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è½¯ä»¶ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œç»´æŠ¤æˆæœ¬å æ¯”è¶… 70%ã€‚MWGA å®ç°ã€Œ<span>ä¸€æ¬¡ä¿®æ”¹ï¼ŒåŒç«¯åŒæ­¥<span>ã€ï¼šBug ä¿®å¤ã€åŠŸèƒ½å‡çº§ä»…éœ€æ”¹åŠ¨æ ¸å¿ƒä»£ç ï¼Œé‡æ–°ç¼–è¯‘ååŒç«¯åŒæ­¥ç”Ÿæ•ˆï¼Œæµ‹è¯•æµç¨‹æ— éœ€é‡å¤æ‰§è¡Œï¼Œ<span>ç»´æŠ¤æˆæœ¬å¯é™ä½ 60% ä»¥ä¸Š<span>ã€‚</span></span></span></span></span></div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><strong><span>ï¼ˆå››ï¼‰ç²¾ç®€æŠ€æœ¯æ ˆï¼Œé™ä½å›¢é˜Ÿæˆæœ¬</span></strong></h2>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ— éœ€åŒæ—¶é…å¤‡ C# ä¸å‰ç«¯å›¢é˜Ÿï¼Œ<span>åŸæœ‰ C# å¼€å‘å›¢é˜Ÿå³å¯æ‰¿æ¥åŒç«¯å¼€å‘<span>ï¼Œæ— éœ€å­¦ä¹  React/Vue ç­‰å‰ç«¯æ¡†æ¶ï¼Œå›¢é˜Ÿè§„æ¨¡å¯ç²¾ç®€ <span>30%â€“50%<span>ï¼Œæ–°äººä¸Šæ‰‹æˆæœ¬ä¹Ÿå¤§å¹…é™ä½ã€‚</span></span></span></span></span></div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><strong><span>ï¼ˆäº”ï¼‰è€é¡¹ç›®ä½æˆæœ¬ Web åŒ–ï¼Œä¿æŠ¤å†å²èµ„äº§</span></strong></h2>\n<div class=\"Editable-unstyled\">\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>é’ˆå¯¹æ²‰æ·€å¤šå¹´çš„ WinForms/WPF è€é¡¹ç›®ï¼ŒMWGA <span>æ— éœ€é‡å†™æ ¸å¿ƒé€»è¾‘<span>ï¼Œä»…éœ€æ„å»ºç½‘é¡µ UI å±‚å³å¯å¿«é€Ÿç”Ÿæˆ Web ç‰ˆï¼Œ<span>ä»£ç å¤ç”¨ç‡å¯è¾¾ 90%<span>ï¼Œç ”å‘æˆæœ¬é™ä½ <span>çº¦ 80%<span>ï¼Œæœ‰æ•ˆå»¶é•¿è€é¡¹ç›®ç”Ÿå‘½å‘¨æœŸã€‚</span></span></span></span></span></span></span></p>\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">&nbsp;</p>\n</div>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å››ã€å•†ä¸šä»·å€¼èµ‹èƒ½</span></h1>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆä¸€ï¼‰æå‡äº§å“ç«äº‰åŠ›ï¼Œæ‰©å¤§å¸‚åœºè¦†ç›–</span></h2>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>åŸºäº MWGA å¯å¿«é€Ÿæ¨å‡ºã€Œ<span>æ¡Œé¢ + ç½‘é¡µ<span>ã€åŒç«¯äº§å“ï¼šæ¡Œé¢ EXE æ»¡è¶³æœ¬åœ°é«˜æ€§èƒ½ã€ç¡¬ä»¶å¯¹æ¥éœ€æ±‚ï¼Œç½‘é¡µç‰ˆé€‚é…é›¶å®‰è£…ã€è¿œç¨‹è®¿é—®åœºæ™¯ï¼Œè¦†ç›–æ›´å¤šå®¢æˆ·ç¾¤ä½“ï¼Œ<span>æ˜¾è‘—æå‡ä¸­æ ‡ç‡<span>ã€‚</span></span></span></span></span></div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆäºŒï¼‰çµæ´»äº¤ä»˜ï¼Œé€‚é…å¤šå…ƒéœ€æ±‚</span></h2>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å¯æ ¹æ®å®¢æˆ·éœ€æ±‚<span>æŒ‰éœ€ç¼–è¯‘<span>ï¼šå¤§å‹ä¼ä¸šé€‰æœ¬åœ° EXE ç‰ˆï¼Œä¸­å°ä¼ä¸šé€‰ç½‘é¡µç‰ˆï¼Œé›†å›¢ä¼ä¸šé€‰æ··åˆéƒ¨ç½²æ¨¡å¼ï¼Œ<span>æ— éœ€é¢å¤–å¼€å‘<span>ï¼Œä¸€å¥—ä»£ç æ»¡è¶³ç§æœ‰åŒ–ã€äº‘ç«¯ã€å†…å¤–ç½‘ç­‰å¤šç§éƒ¨ç½²éœ€æ±‚ã€‚</span></span></span></span></span></div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆä¸‰ï¼‰åˆ›æ–°å•†ä¸šæ¨¡å¼ï¼Œæ‹“å±•ç›ˆåˆ©ç©ºé—´</span></h2>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ”¯æŒ<span>é˜¶æ¢¯å®šä»·<span>ï¼ˆåŸºç¡€ Web ç‰ˆå¼•æµã€ä¸“ä¸š EXE ç‰ˆæ”¶è´¹ï¼‰ã€<span>è®¢é˜…åˆ¶è½¬å‹<span>ï¼ˆç½‘é¡µç‰ˆé€‚é…äº‘ç«¯è®¢é˜…ï¼‰ï¼ŒåŒæ—¶åŸºäºå¤ç”¨ä»£ç å¿«é€Ÿæä¾›å®šåˆ¶æœåŠ¡ï¼Œæå‡å®¢å•ä»·ä¸æŒç»­æ”¶å…¥ã€‚</span></span></span></span></span></div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆå››ï¼‰å»¶é•¿äº§å“ç”Ÿå‘½å‘¨æœŸï¼Œæå‡èµ„äº§å›æŠ¥</span></h2>\n<div class=\"Editable-unstyled\">\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¼ ç»Ÿæ¡Œé¢è½¯ä»¶é€šè¿‡ MWGA å¿«é€Ÿ Web åŒ–ï¼Œæ— éœ€é‡æ„æ ¸å¿ƒä»£ç ï¼Œå³å¯é€‚é…æ•°å­—åŒ–è½¬å‹éœ€æ±‚ï¼Œ<span>äº§å“ç”Ÿå‘½å‘¨æœŸå¯å»¶é•¿ 3â€“5 å¹´<span>ï¼Œå†å²æŠ€æœ¯æŠ•å…¥æŒç»­åˆ›é€ ä»·å€¼ã€‚</span></span></span></p>\n</div>\n<div class=\"Editable-divider FocusPlugin--unfocused\">&nbsp;</div>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>äº”ã€çµæ´»éƒ¨ç½²ï¼šå…¨åŠŸèƒ½ EXE ä¸è½»é‡åŒ– Web</span></h1>\n<div class=\"Editable-unstyled\">\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>MWGA æ”¯æŒã€Œ<span>EXE å…¨åŠŸèƒ½ + Web éƒ¨åˆ†åŠŸèƒ½<span>ã€çš„å·®å¼‚åŒ–éƒ¨ç½²ï¼š</span></span></span></p>\n</div>\n<ul class=\"public-DraftStyleDefault-ul\">\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span><strong>æ¡Œé¢ç‰ˆ</strong><span><strong>ï¼š</strong>æ‰“åŒ…æ‰€æœ‰æ¨¡å—ï¼ŒåŒ…å«ç¡¬ä»¶å¯¹æ¥ã€ç³»ç»Ÿç®¡ç†ç­‰å…¨é‡åŠŸèƒ½ã€‚</span></span></p>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span><strong>ç½‘é¡µç‰ˆ</strong><span><strong>ï¼š</strong>ä»…ä¿ç•™æŸ¥è¯¢ã€æŠ¥è¡¨ç­‰åŸºç¡€åŠŸèƒ½ï¼Œå‰”é™¤æ•æ„Ÿä¸é«˜æ€§èƒ½æ¶ˆè€—æ¨¡å—ã€‚</span></span></p>\n</li>\n</ul>\n<div class=\"Editable-unstyled\">\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è¿™æ ·æ—¢å®ç°<span>å®‰å…¨éš”ç¦»<span>ã€é™ä½ç½‘é¡µç«¯å®‰å…¨é£é™©ï¼Œåˆ<span>ä¼˜åŒ–æ€§èƒ½<span>â€”â€”ç½‘é¡µç«¯åŠ è½½é€Ÿåº¦å¯æå‡ <span>30% ä»¥ä¸Š<span>ï¼Œç²¾å‡†é€‚é…ç®¡ç†å‘˜ä¸æ™®é€šå‘˜å·¥çš„ä¸åŒä½¿ç”¨åœºæ™¯ã€‚</span></span></span></span></span></span></span></p>\n</div>\n<div class=\"Editable-divider FocusPlugin--unfocused\">&nbsp;</div>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å…­ã€å…¸å‹è¡Œä¸šåº”ç”¨</span></h1>\n<div class=\"TableToolbar-container\">\n<table align=\"left\" border=\"0\">\n<tbody>\n<tr>\n<td style=\"text-align: center;\">\n<p><strong><span>è¡Œä¸š</span></strong></p>\n</td>\n<td style=\"text-align: center;\">\n<p><strong><span>æ¡Œé¢EXE</span></strong></p>\n</td>\n<td style=\"text-align: center;\">\n<p><strong><span>ç½‘é¡µç«¯</span></strong></p>\n</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">\n<p><span>å·¥ä¸šè½¯ä»¶</span></p>\n</td>\n<td style=\"text-align: center;\">\n<p><span>è®¾å¤‡å¯¹æ¥ã€å…¨åŠŸèƒ½ç°åœº</span></p>\n</td>\n<td style=\"text-align: center;\">\n<p><span>è¿œç¨‹ç›‘æ§ã€çœ‹æ¿</span></p>\n</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">\n<p><span>ä¼ä¸šç®¡ç†</span></p>\n</td>\n<td style=\"text-align: center;\">\n<p><span>æ ¸å¿ƒä¸šåŠ¡ã€é‡æµç¨‹</span></p>\n</td>\n<td style=\"text-align: center;\">\n<p><span>å¤–å‹¤æŸ¥è¯¢ã€å®¡æ‰¹</span></p>\n</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">\n<p><span>åŒ»ç–—è½¯ä»¶</span></p>\n</td>\n<td style=\"text-align: center;\">\n<p><span>è¯Šç–—å…¨æµç¨‹ã€è®¾å¤‡</span></p>\n</td>\n<td style=\"text-align: center;\">\n<p><span>è¿œç¨‹ä¼šè¯Šã€æŸ¥é˜…</span></p>\n</td>\n</tr>\n<tr>\n<td style=\"text-align: center;\">\n<p><span>æ”¿åŠ¡è½¯ä»¶</span></p>\n</td>\n<td style=\"text-align: center;\">\n<p><span>å†…ç½‘å®¡æ‰¹ã€æ•æ„Ÿæ•°æ®</span></p>\n</td>\n<td style=\"text-align: center;\">\n<p><span>å¤–ç½‘ä¾¿æ°‘æŸ¥è¯¢ã€æœåŠ¡</span></p>\n</td>\n</tr>\n</tbody>\n</table>\n<span><span>å‡å®ç°ã€Œ<span><span>ä¸€å¥—ä»£ç ï¼ŒåŒç«¯é€‚é…<span><span>ã€ã€‚</span></span></span></span></span></span></div>\n<p>&nbsp;</p>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span><span>ä¸ƒã€ä¸ä¼ ç»Ÿæ–¹æ¡ˆå¯¹æ¯”</span></span></h1>\n<div class=\"TableToolbar-container\">\n<div>\n<table align=\"left\" class=\"Table FocusPlugin--unfocused\" style=\"height: 694px; width: 872px;\">\n<tbody>\n<tr class=\"Table-row\"><th class=\"Table-data Table-header\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>å¯¹æ¯”ç»´åº¦</span></div>\n<p>&nbsp;</p>\n</th><th class=\"Table-data Table-header\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä¼ ç»ŸåŒç«¯å¼€å‘</span></div>\n<p>&nbsp;</p>\n</th><th class=\"Table-data Table-header\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>çº¯ Web å¼€å‘</span></div>\n<p>&nbsp;</p>\n</th><th class=\"Table-data Table-header\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>Electron/MAUI</span></div>\n<p>&nbsp;</p>\n</th><th class=\"Table-data Table-header\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>MWGA</span></div>\n<p>&nbsp;</p>\n</th></tr>\n<tr class=\"Table-row\">\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä»£ç å¤ç”¨ç‡</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä½</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä¸­</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä¸­</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>é«˜</span></div>\n<p>&nbsp;</p>\n</td>\n</tr>\n<tr class=\"Table-row\">\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>åŒç«¯ä¸€è‡´æ€§</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>å·®</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>æ— </span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä¸­</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä¼˜</span></div>\n<p>&nbsp;</p>\n</td>\n</tr>\n<tr class=\"Table-row\">\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ç ”å‘ç»´æŠ¤æˆæœ¬</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>é«˜</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä¸­</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä¸­</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä½</span></div>\n<p>&nbsp;</p>\n</td>\n</tr>\n<tr class=\"Table-row\">\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>æ¡Œé¢/ç½‘é¡µæ€§èƒ½</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä¼˜/ä¸­</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>å·®/ä¼˜</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä¸­/å·®</span></div>\n<p>&nbsp;</p>\n</td>\n<td class=\"Table-data\" style=\"text-align: center;\">\n<p class=\"Table-dataInputContainer\">&nbsp;</p>\n<div class=\"Table-dataInput\"><span>ä¼˜/ä¼˜</span></div>\n<p>&nbsp;</p>\n</td>\n</tr>\n</tbody>\n</table>\n<span><span>MWGA åœ¨ä»£ç å¤ç”¨ã€ä¸€è‡´æ€§ã€æˆæœ¬ã€æ€§èƒ½ä¸Š<span><span>å‡ä¼˜äºä¼ ç»Ÿæ–¹æ¡ˆ<span><span>ï¼Œæ˜¯è·¨ç«¯å¼€å‘çš„ä¼˜é€‰æ–¹æ¡ˆã€‚</span></span></span></span></span></span></div>\n</div>\n<div class=\"Editable-divider FocusPlugin--unfocused\">&nbsp;</div>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span><span>å…«ã€æ€»ç»“</span></span></h1>\n<div class=\"Editable-unstyled\">\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span><span><span>M</span><span>WGA åŒçº¿ç¼–è¯‘ä»¥ã€Œ<span><span>ä¸€ä»½ä»£ç ã€åŒç«¯ç”Ÿæˆ<span><span>ã€ä¸ºæ ¸å¿ƒï¼Œè§£å†³äº†ä¼ ç»Ÿè·¨ç«¯å¼€å‘çš„æ ¸å¿ƒç—›ç‚¹ï¼Œæ—¢å®ç°äº†ç ”å‘ä¸ç»´æŠ¤çš„<span><span>é™æœ¬å¢æ•ˆ<span><span>ï¼Œåˆä¸º<span><span>äº§å“ç«äº‰åŠ›<span><span>ä¸<span><span>å•†ä¸šæ¨¡å¼åˆ›æ–°<span><span>æä¾›äº†æ”¯æ’‘ã€‚å…¶å·®å¼‚åŒ–éƒ¨ç½²æ¨¡å¼è¿›ä¸€æ­¥æå‡äº†åœºæ™¯é€‚é…æ€§ï¼Œåœ¨å·¥ä¸šã€åŒ»ç–—ã€æ”¿åŠ¡ç­‰è¡Œä¸šå…·å¤‡å¹¿é˜”å‰æ™¯ã€‚éšç€æŠ€æœ¯è¿­ä»£ï¼ŒMWGA å°†é€‚é…æ›´å¤šç«¯ä¾§å½¢æ€ï¼Œæˆä¸ºä¼ä¸šæ•°å­—åŒ–è½¬å‹çš„<span><span>æ ¸å¿ƒæŠ€æœ¯æ”¯æ’‘<span><span>ã€‚</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">&nbsp;</p>\n</div>\n<div class=\"Editable-unstyled\">\n<p class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><em><span><span>æœ¬æ–‡ç”¨äºè¯´æ˜ MWGA åŒçº¿ç¼–è¯‘èƒ½åŠ›çš„ä»·å€¼ä¸ä¼˜åŠ¿ï¼Œä¾›æŠ€æœ¯é€‰å‹ä¸å•†ä¸šå†³ç­–å‚è€ƒã€‚</span></span></em></p>\n</div>\n\n</div>\n<div class=\"clear\"></div>\n</div>\n\t\t<p class=\"postfoot\">\n\t\t\tposted on \n<span id=\"post-date\">2026-02-05 14:44</span>&nbsp;\n<a href=\"https://www.cnblogs.com/xdesigner\">è¢æ°¸ç¦ ç”µå­ç—…å†ï¼ŒåŒ»ç–—ä¿¡æ¯åŒ–</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">11</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n\n\t\t</p>"
    },
    {
      "title": "æ¨è .NET 8.0 å¼€æºé¡¹ç›®ä¼ªå¾®æœåŠ¡æ¡†æ¶",
      "link": "https://www.cnblogs.com/1312mn/p/18376570",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/1312mn/p/18376570\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-05 13:32\">\n    <span>æ¨è .NET 8.0 å¼€æºé¡¹ç›®ä¼ªå¾®æœåŠ¡æ¡†æ¶</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<h2><span class=\"prefix\"><span class=\"content\">å‰è¨€</span></span></h2>\n<p>å˜¿ï¼Œå°ä¼™ä¼´ä»¬ï¼æœ€è¿‘çœ‹åˆ°äº†ä¸€ä¸ª .NET 8.0 çš„å°é¡¹ç›®ä¼ªå¾®æœåŠ¡æ¡†æ¶ï¼Œéå¸¸é€‚åˆæƒ³è¦å¿«é€Ÿæ­å»ºå°å‹åº”ç”¨é¡¹ç›®æˆ–æ˜¯æƒ³è¦å­¦ä¹ .NET 8.0åŠæ–°çš„æŠ€æœ¯ï¼Œä½†åˆä¸çŸ¥é“ä»å“ªé‡Œå­¦èµ·çš„æœ‹å‹ã€‚è¿™ä¸ªæ¡†æ¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–å¼€å‘æµç¨‹ï¼ŒåŒæ—¶è¿˜èƒ½é€‚åº”ä¸æ–­å˜åŒ–çš„éœ€æ±‚ã€‚</p>\n<p>å®ƒè™½ç„¶ç®€åŒ–äº†å¾ˆå¤šå¤æ‚çš„å¾®æœåŠ¡ç‰¹æ€§ï¼Œä½†ä»ä¿ç•™äº†å…³é”®çš„å¾®æœåŠ¡ç†å¿µï¼Œè®©æˆ‘ä»¬å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘è€Œä¸æ˜¯åº•å±‚ç»†èŠ‚ï¼Œå¹¶ä¸”è¾¾åˆ°å®æ“æ•ˆæœã€‚</p>\n<p>æƒ³è¦å¿«é€Ÿä¸Šæ‰‹ .NET 8.0ï¼Œä¸å¦¨è¯•è¯•è¿™ä¸ªæ¡†æ¶ã€‚é¡¹ç›®å·²ç»åœ¨ GitHub ä¸Šå¼€æºäº†ï¼Œæ¬¢è¿å¤§å®¶å‰æ¥å›´è§‚ã€æä¾›å»ºè®®æˆ–è´¡çŒ®ä»£ç ã€‚å¸Œæœ›è¿™ä¸ªæ¡†æ¶èƒ½å¤Ÿå¸®åŠ©æ›´å¥½çš„å¸®åŠ©æˆ‘ä»¬å·¥ä½œä¸­é‡åˆ°çš„é—®é¢˜ã€‚</p>\n<h2><span class=\"prefix\"><span class=\"content\">é¡¹ç›®ä»‹ç»</span></span></h2>\n<p>ä¸ºä»€ä¹ˆè¯´æ˜¯ä¼ªå¾®æœåŠ¡æ¡†æ¶ï¼Œå¸¸è§å¾®æœåŠ¡æ¡†æ¶å¯èƒ½è¿˜åŒ…æ‹¬æœåŠ¡å®¹é”™ã€æœåŠ¡é—´çš„é€šä¿¡ã€æœåŠ¡è¿½è¸ªå’Œç›‘æ§ã€æœåŠ¡æ³¨å†Œå’Œå‘ç°ç­‰ç­‰ï¼Œè€Œè¿™é‡Œä¸ºäº†åœ¨ä½¿ç”¨ä¸­çš„æ›´ç®€å•ï¼Œå°†å¾ˆå¤šä¸œè¥¿è¿›è¡Œäº†ç®€åŒ–æˆ–è€…çœç•¥äº†ã€‚</p>\n<p><strong>ç®€åŒ–å¾®æœåŠ¡æ¦‚å¿µ</strong>ï¼šä½œè€…è™½ç„¶ç§°ä¸ºâ€œä¼ªå¾®æœåŠ¡â€ï¼Œä½†æœ¬æ¡†æ¶ä¾ç„¶å…·å¤‡ä¸€äº›å…³é”®çš„å¾®æœåŠ¡ç‰¹æ€§ï¼Œå¦‚æ¨¡å—åŒ–è®¾è®¡å’ŒæœåŠ¡è§£è€¦ã€‚å®ƒé€šè¿‡å‡å°‘å¤æ‚çš„æœåŠ¡é—´é€šä¿¡ã€å®¹é”™æœºåˆ¶å’ŒæœåŠ¡å‘ç°ç­‰åŠŸèƒ½ï¼Œä½¿å¼€å‘æ›´åŠ é«˜æ•ˆä¸”æ˜“äºç®¡ç†ã€‚</p>\n<p><strong>æŠ€æœ¯æ ˆ</strong>ï¼šé›†æˆäº†ä¸€äº›æ¯”è¾ƒå®ç”¨çš„æ–°æŠ€æœ¯ï¼ŒåŒ…æ‹¬EF Coreã€Redisã€RabbitMQå’ŒMySQLï¼Œç¡®ä¿åº”ç”¨é«˜æ•ˆåˆèƒ½åº”å¯¹é«˜å¹¶å‘åœºæ™¯ã€‚</p>\n<p><strong>æ˜“ç”¨æ€§</strong>ï¼šè¯¥æ¡†æ¶çš„ç›®æ ‡æ˜¯å°½å¯èƒ½åœ°ç®€åŒ–å¼€å‘è¿‡ç¨‹ï¼Œæä¾›å®Œæ•´çš„æ¥å£å’Œæ–‡æ¡£ï¼Œèƒ½å¤Ÿè¿…é€Ÿä¸Šæ‰‹ï¼Œå¹¶å°†æ›´å¤šç²¾åŠ›é›†ä¸­åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šã€‚</p>\n<p><strong>æŒç»­ä¼˜åŒ–</strong>ï¼šå°½ç®¡ç›®å‰ä»å¤„äºæ—©æœŸé˜¶æ®µï¼Œä½†ä½œè€…æ‰¿è¯ºå°†æŒç»­æ”¹è¿›å’Œå®Œå–„è¯¥é¡¹ç›®ã€‚è¿™åŒ…æ‹¬ä½†ä¸é™äºå¼•å…¥æ›´å¤šé«˜çº§ç‰¹æ€§ã€å¢å¼ºç°æœ‰åŠŸèƒ½ä»¥åŠæå‡æ•´ä½“æ€§èƒ½ã€‚</p>\n<h2><span class=\"prefix\"><span class=\"content\">é¡¹ç›®æ ¸å¿ƒ</span></span></h2>\n<p><strong>å¯¹è±¡æ˜ å°„</strong>ï¼šä½¿ç”¨ <code>AutoMapper</code> è‡ªåŠ¨å¤„ç†å¯¹è±¡ä¹‹é—´çš„æ˜ å°„ï¼Œè®©ä½ æ— éœ€æ‰‹åŠ¨ç¼–å†™ç¹ççš„è½¬æ¢ä»£ç ã€‚</p>\n<p><strong>æŸ¥è¯¢å°è£…</strong>ï¼šé€šè¿‡ <code>Ardalis.Specification</code> å’Œ <code>LinqKit.Core</code> å°è£… EF Core æŸ¥è¯¢ï¼Œè®©æ•°æ®è·å–å˜å¾—æ›´ç®€å•ç›´è§‚ã€‚</p>\n<p><strong>æ•°æ®åº“äº¤äº’</strong>ï¼šåœ¨ EF Core ä¸­é‡å†™äº† <code>SaveChangesInterceptor</code>ï¼Œå®ç°äº†è½¯åˆ é™¤åŠŸèƒ½ï¼Œå¹¶è‡ªåŠ¨ç®¡ç†åˆ›å»ºæ—¶é—´å’Œæ›´æ–°æ—¶é—´å­—æ®µã€‚</p>\n<p><strong>æ•´ä½“æ¶æ„</strong>ï¼šé‡‡ç”¨äº†æ•´æ´çš„æ¶æ„è®¾è®¡ï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤ã€‚</p>\n<p><strong>ä¸šåŠ¡åŠŸèƒ½</strong>ï¼šå·²ç»é¢„ç½®äº†ä¸€äº›åŸºæœ¬çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œå¼€ç®±å³ç”¨ã€‚</p>\n<p><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šå†…ç½®äº†ä¾èµ–æ³¨å…¥å®¹å™¨ï¼Œæ–¹ä¾¿ç®¡ç†ç»„ä»¶å’ŒæœåŠ¡ã€‚</p>\n<p><strong>è®¤è¯ä¸æˆæƒ</strong>ï¼šä½¿ç”¨åŒ token å®ç°äº†å®‰å…¨ç™»å½•å’Œæ— æ„ŸçŸ¥çš„å‰ç«¯ token åˆ·æ–°ã€‚</p>\n<p><strong>åˆ†å¸ƒå¼ ID ç”Ÿæˆ</strong>ï¼šé›†æˆäº† <code>Snowflake</code> åˆ†å¸ƒå¼ ID ç”Ÿæˆå™¨ï¼Œç¡®ä¿å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</p>\n<p><strong>ç¼“å­˜ä¸é”</strong>ï¼šé€šè¿‡ Redis å®ç°äº†åˆ†å¸ƒå¼ç¼“å­˜å’Œåˆ†å¸ƒå¼é”ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œå¹¶å‘æ€§èƒ½ã€‚</p>\n<p><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šåˆ©ç”¨ <code>RabbitMQ</code> å°è£…äº†å¼‚æ­¥ä»»åŠ¡å¤„ç†æœºåˆ¶ï¼Œå¦‚æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ã€‚</p>\n<p><strong>å®šæ—¶ä»»åŠ¡</strong>ï¼šç»“åˆ <code>Cronos</code> å’Œ <code>BackgroundService</code> å®ç°äº†ç§’çº§å®šæ—¶ä»»åŠ¡ã€‚</p>\n<p><strong>æ•°æ®åˆå§‹åŒ–</strong>ï¼šä½¿ç”¨ <code>BackgroundService</code> è¿›è¡Œæ•°æ®åˆå§‹åŒ–ï¼Œæ¯”å¦‚å­—å…¸æ•°æ®çš„åŠ è½½ã€‚</p>\n<p><strong>æ—¥å¿—è®°å½•</strong>ï¼šé‡‡ç”¨ <code>Serilog</code> è®°å½•å¼‚å¸¸æ—¥å¿—ï¼Œå¹¶é€šè¿‡ Docker éƒ¨ç½²å®ç°æ—¥å¿—çš„å¯è§†åŒ–ç›‘æ§ã€‚</p>\n<p><strong>æ“ä½œæ—¥å¿—</strong>ï¼šé€šè¿‡è‡ªå®šä¹‰è¿‡æ»¤å™¨å’Œåå°„è®°å½•æ“ä½œæ—¥å¿—ï¼Œä¾¿äºè¿½è¸ªç”¨æˆ·è¡Œä¸ºã€‚</p>\n<p><strong>æƒé™éªŒè¯</strong>ï¼šå®ç°äº†æƒé™éªŒè¯è¿‡æ»¤å™¨ï¼Œç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è¢«æˆæƒçš„èµ„æºã€‚</p>\n<p><strong>ç»Ÿä¸€å“åº”æ ¼å¼</strong>ï¼šä½¿ç”¨ <code>IAsyncResultFilter</code> ç»Ÿä¸€äº†è¿”å›ç»™å‰ç«¯çš„æ•°æ®æ ¼å¼ã€‚</p>\n<p><strong>Excel æ“ä½œ</strong>ï¼šé›†æˆ <code>EPPlus</code> åº“ï¼Œæ”¯æŒ Excel å¯¼å…¥å’Œå¯¼å‡ºã€‚</p>\n<p><strong>ä¸€é”®éƒ¨ç½²</strong>ï¼šæ”¯æŒä½¿ç”¨ <code>goploy</code> å¿«é€Ÿéƒ¨ç½²å‰åç«¯åº”ç”¨ã€‚</p>\n<p><strong>API æ–‡æ¡£</strong>ï¼šé€šè¿‡ <code>Swagger</code> è‡ªåŠ¨ç”Ÿæˆ RESTful API æ–‡æ¡£ï¼Œæ–¹ä¾¿å‰ç«¯å’Œåç«¯å¼€å‘äººå‘˜åä½œã€‚</p>\n<p><strong>é…ç½®åŠ è½½</strong>ï¼šè‡ªåŠ¨åŠ è½½ <code>appsettings.json</code> æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚</p>\n<h2><span class=\"prefix\"><span class=\"content\">é¡¹ç›®æ¡†æ¶</span></span></h2>\n<p>é€šè¿‡Githubä¸‹è½½é¡¹ç›®æºç ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹é¡¹ç›®æ¡†æ¶ï¼Œå…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img height=\"700\" src=\"https://img2024.cnblogs.com/blog/576536/202408/576536-20240823165609019-1106450563.png\" style=\"vertical-align: middle; display: block; margin-left: auto; margin-right: auto;\" width=\"619\" /></p>\n<img alt=\"\" />\n<p>1ã€Libraries</p>\n<p>åŒ…å«å„ç§å¤–éƒ¨ç±»åº“ï¼Œå¯¹å…¶æ·±åŠ å·¥ä½¿ç”¨åœ¨é¡¹ç›®ä¸­</p>\n<p>2ã€Services/Basic</p>\n<p>å¾®æœåŠ¡åŸºç¡€æ”¯æ’‘å­ç³»ç»Ÿ</p>\n<p>3ã€Services/NCDP</p>\n<p>å¾®æœåŠ¡ä¸šåŠ¡å­ç³»ç»Ÿ</p>\n<p>4ã€Services/SystemService</p>\n<p>å¾®æœåŠ¡ç³»ç»ŸæœåŠ¡ï¼ˆåŒ…æ‹¬æ•°æ®åº“çš„æ›´æ–°ã€å®šæ—¶ä»»åŠ¡ã€æ•°æ®åˆå§‹åŒ–ã€Swaggeræ‰¿è½½ã€RabbitMQé˜Ÿåˆ—äº‹ä»¶å¤„ç†å™¨ç­‰ï¼‰</p>\n<p>5ã€sun.Core</p>\n<p>sun.Coreä½œä¸ºäº†ä¸­è½¬ï¼Œå…¶ä»–å¤–éƒ¨æˆ–è€…è‡ªå·±å°è£…çš„ç±»åº“ï¼Œåœ¨å¼•ç”¨çš„æ—¶å€™éƒ½æ˜¯åœ¨sun.Coreä¸­è¿›è¡Œçš„å¼•ç”¨ã€‚</p>\n<p>ç®—æ˜¯é—´æ¥å¼•ç”¨ï¼Œæ¥ç®€åŒ–é¡¹ç›®ä¸­çš„ä¾èµ–å…³ç³»ã€‚</p>\n<p>åŒæ—¶åœ¨sun.Coreä¹Ÿå°è£…äº†ä¸€äº›æ ¸å¿ƒç»„ä»¶å’ŒæœåŠ¡ã€‚</p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/576536/202408/576536-20240823165855661-1876970856.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></p>\n<p>6ã€sun.Infrastructure</p>\n<p>ä¸»è¦å°è£…ä¸€äº›é€šç”¨çš„æ–¹æ³•ï¼Œä»¥åŠåŸºç¡€è®¾æ–½ç»„ä»¶ï¼Œä¾›å¤–éƒ¨ä½¿ç”¨ã€‚</p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/576536/202408/576536-20240823165907878-476029284.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></p>\n<h2><span class=\"prefix\"><span class=\"content\">é¡¹ç›®è¯´æ˜</span></span></h2>\n<p>å…³äºé¡¹ç›®è¯¦ç»†ä½¿ç”¨æƒ…å†µå¯ä»¥æŸ¥çœ‹ä½œè€…æ•´ç†çš„æ–‡ç« é“¾æ¥ https://www.cnblogs.com/aehyok/p/18058032 ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©å¤§å®¶æ›´å¥½çš„ç†è§£é¡¹ç›®å’Œå­¦ä¹ çŸ¥è¯†ç‚¹ï¼Œæå‡è‡ªå·±çš„æŠ€æœ¯èƒ½åŠ›ï¼Œä¸‹é¢åªå±•ç¤ºäº†éƒ¨åˆ†å†…å®¹ã€‚</p>\n<h4><span class=\"prefix\"><span class=\"content\">1ã€ä¸šåŠ¡åŠŸèƒ½</span></span></h4>\n<p>ç›®å‰åŸºæœ¬å®ç°çš„åŠŸèƒ½åŒ…æ‹¬ï¼šç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†ã€åŒºåŸŸç®¡ç†ã€æŸ¥çœ‹æ—¥å¿—ï¼ˆç™»å½•æ—¥å¿—å’Œæ“ä½œæ—¥å¿—ï¼‰ã€èœå•ç®¡ç†ã€æƒé™æ§åˆ¶ã€ç³»ç»Ÿç®¡ç†ç­‰åŠŸèƒ½ã€‚</p>\n<p><img height=\"380\" src=\"https://img2024.cnblogs.com/blog/576536/202408/576536-20240823165950242-344963990.png\" style=\"vertical-align: middle; display: block; margin-left: auto; margin-right: auto;\" width=\"690\" /></p>\n<h4><span class=\"prefix\"><span class=\"content\">2ã€ç”Ÿæˆæ–‡æ¡£å·¥å…·</span></span></h4>\n<p>Swagger ç”ŸæˆREST APIsæ–‡æ¡£å·¥å…·åŒ…å«å¯ä»¥æ‰¿è½½å¤šä¸ªå¾®æœåŠ¡é¡¹ç›®ï¼Œé€šè¿‡å³ä¸Šè§’è¿›è¡Œåˆ‡æ¢ï¼Œä¾¿å¯ä»¥æŸ¥çœ‹å½“å‰å¾®æœåŠ¡é¡¹ç›®çš„æ¥å£æ–‡æ¡£ï¼Œå¹¶å¯ä»¥è¿›è¡Œæµ‹è¯•</p>\n<p>æµ‹è¯•æ¥å£ç›´æ¥å¯åœ¨swagger uiä¸Šè¿›è¡Œ</p>\n<p>ç»Ÿä¸€æ·»åŠ æ¥å£ä¸­çš„Headerå‚æ•°</p>\n<p>é€šè¿‡å¯¹Swagger UIè¿›è¡Œéƒ¨åˆ†çš„è‡ªå®šä¹‰ï¼Œä½¿çš„æ›´å¥½çš„é€‚é…è‡ªå·±çš„é¡¹ç›®ï¼Œæ¯”å¦‚æ·»åŠ ç™»å½•ï¼Œè¿™æ ·æ¥å£ä¾¿ç›´æ¥å¯ä»¥åœ¨swagger UIä¸Šé¢è¿›è¡Œã€‚</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/576536/202408/576536-20240823170029758-1450910516.png\" style=\"vertical-align: middle; display: block; margin-left: auto; margin-right: auto;\" width=\"619\" /></p>\n<h4><span class=\"prefix\"><span class=\"content\">3ã€åˆ†å¸ƒå¼é›ªèŠ±Idç”Ÿæˆå™¨</span></span></h4>\n<p>Snowflake æ‰€ä½¿ç”¨çš„å¼€æºç±»åº“ï¼šhttps://github.com/stulzq/snowflake-net</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> åˆ†å¸ƒå¼é›ªèŠ±Idç”Ÿæˆå™¨\n</span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> SnowFlake\n{\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> é€šè¿‡é™æ€ç±»åªå®ä¾‹åŒ–ä¸€æ¬¡IdWorker å¦åˆ™ç”Ÿæˆçš„Idä¼šæœ‰é‡å¤\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">readonly</span> Lazy&lt;IdWorker&gt; _instance = <span style=\"color: rgba(0, 0, 255, 1);\">new</span>(() =&gt;<span style=\"color: rgba(0, 0, 0, 1);\">\n    {\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> commonOptions = App.Options&lt;CommonOptions&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> IdWorker(commonOptions.WorkerId, commonOptions.DatacenterId);\n    });\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> IdWorker Instance =<span style=\"color: rgba(0, 0, 0, 1);\"> _instance.Value;\n}</span></pre>\n</div>\n<p>å…¶ä¸­ WorkerIdå’ŒDatacenterIdä¿æŒä¸åŒçš„è¯ï¼Œä¾‹å¦‚ä¸¤ä¸ªå¾®æœåŠ¡WorkerIdä¸€ä¸ªä¸º1ä¸€ä¸ªä¸º2,é‚£ä¹ˆåœ¨åŒä¸€æ¯«ç§’æ•°ç”Ÿæˆçš„Idè‚¯å®šæ˜¯ä¸åŒçš„ã€‚</p>\n<p>åŒä¸€ä¸ªIdWorkeråœ¨ä¸€ä¸ªæ¯«ç§’ä¸­å¯ä»¥ç”Ÿæˆ4096ä¸ªåºåˆ—å· è¶³å¤Ÿå¤§å‹ç³»ç»Ÿä½¿ç”¨äº†ï¼Œä¸æ€•é‡å¤çš„é—®é¢˜ã€‚</p>\n<h4><span class=\"prefix\"><span class=\"content\">4ã€åˆ†å¸ƒå¼ç¼“å­˜å’Œåˆ†å¸ƒå¼é”</span></span></h4>\n<p>Redis ç»Ÿä¸€å°è£…å®ç°åˆ†å¸ƒå¼ç¼“å­˜å’Œåˆ†å¸ƒå¼é”ï¼Œæ‰€ä½¿ç”¨çš„å¼€æºç±»åº“ï¼šhttps://github.com/2881099/csredis</p>\n<p>ç›®å‰ä¸»è¦å°è£…äº†å‡ ä¸ªå¸¸ç”¨çš„æ¥å£æ–¹æ³•</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">interface</span><span style=\"color: rgba(0, 0, 0, 1);\"> IRedisService\n{\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> æŸ¥çœ‹æœåŠ¡æ˜¯å¦è¿è¡Œ\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">bool</span><span style=\"color: rgba(0, 0, 0, 1);\"> PingAsync();\n\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ ¹æ®keyè·å–ç¼“å­˜\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"key\"&gt;&lt;/param&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n    Task&lt;T&gt; GetAsync&lt;T&gt;(<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\"> key);\n\n\n\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> è®¾ç½®æŒ‡å®škeyçš„ç¼“å­˜å€¼(ä¸è¿‡æœŸ)\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"key\"&gt;&lt;/param&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"value\"&gt;&lt;/param&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n    Task&lt;<span style=\"color: rgba(0, 0, 255, 1);\">bool</span>&gt; SetAsync(<span style=\"color: rgba(0, 0, 255, 1);\">string</span> key, <span style=\"color: rgba(0, 0, 255, 1);\">object</span><span style=\"color: rgba(0, 0, 0, 1);\"> value);\n\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> è®¾ç½®æŒ‡å®škeyçš„ç¼“å­˜å€¼(å¯è®¾ç½®è¿‡æœŸæ—¶é—´å’ŒNxã€Xx)\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"key\"&gt;&lt;/param&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"value\"&gt;&lt;/param&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"expire\"&gt;&lt;/param&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"exists\"&gt;&lt;/param&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n    Task&lt;<span style=\"color: rgba(0, 0, 255, 1);\">bool</span>&gt; SetAsync(<span style=\"color: rgba(0, 0, 255, 1);\">string</span> key, <span style=\"color: rgba(0, 0, 255, 1);\">object</span> value, TimeSpan expire, RedisExistence? exists = <span style=\"color: rgba(0, 0, 255, 1);\">null</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> è®¾ç½®æŒ‡å®škeyçš„ç¼“å­˜å€¼(å¯è®¾ç½®è¿‡æœŸç§’æ•°å’ŒNxã€Xx)\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"key\"&gt;&lt;/param&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"value\"&gt;&lt;/param&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"expireSeconds\"&gt;</span><span style=\"color: rgba(0, 128, 0, 1);\">è¿‡æœŸæ—¶é—´å•ä½ä¸ºç§’</span><span style=\"color: rgba(128, 128, 128, 1);\">&lt;/param&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"exists\"&gt;&lt;/param&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n    Task&lt;<span style=\"color: rgba(0, 0, 255, 1);\">bool</span>&gt; SetAsync(<span style=\"color: rgba(0, 0, 255, 1);\">string</span> key, <span style=\"color: rgba(0, 0, 255, 1);\">object</span> value, <span style=\"color: rgba(0, 0, 255, 1);\">int</span> expireSeconds = -<span style=\"color: rgba(128, 0, 128, 1);\">1</span>, RedisExistence? exists = <span style=\"color: rgba(0, 0, 255, 1);\">null</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> åˆ é™¤Key\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"key\"&gt;&lt;/param&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n    Task&lt;<span style=\"color: rgba(0, 0, 255, 1);\">long</span>&gt; DeleteAsync(<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\"> key);\n\n\n    Task</span>&lt;Dictionary&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>,<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> ScanAsync();\n}</span></pre>\n</div>\n<p>ä¸»è¦æ˜¯ä¸ºäº†ä¿æŒä¸redis cliä¸­çš„æ–¹æ³•ä¸€è‡´ï¼Œé€‰äº†è¿™ä¸ªç±»åº“ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–çš„ç±»åº“ è¿˜æ˜¯è›®å¤šçš„ã€‚</p>\n<p>åŒæ—¶è¿˜å°è£…äº†ä¸€ä¸ªæ¥å£ç”¨äºå‰ç«¯ç›‘æµ‹æ‰€æœ‰çš„keyå’Œvalueã€‚</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">async</span> Task&lt;<span style=\"color: rgba(0, 0, 255, 1);\">dynamic</span>&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> ScanAsync(PagedQueryModelBase model)\n{\n    List</span>&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt; list = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n\n    </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">æ ¹æ²model.Keywordè¿›è¡Œæ¨¡ç³ŠåŒ¹é…</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">var</span> scanResult = <span style=\"color: rgba(0, 0, 255, 1);\">await</span> RedisHelper.ScanAsync(model.Page, $<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">*{model.Keyword}*</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, model.Limit);\n    list.AddRange(scanResult.Items);\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> values = <span style=\"color: rgba(0, 0, 255, 1);\">await</span><span style=\"color: rgba(0, 0, 0, 1);\"> RedisHelper.MGetAsync(list.ToArray());\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> resultDictionary = list.Zip(values, (key, value) =&gt; <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> { key, value })\n                                    .ToDictionary(item </span>=&gt; item.key, item =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> item.value);\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">dynamic</span> result = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> ExpandoObject();\n    result.Items </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> resultDictionary;\n    result.Cursor </span>= scanResult.Cursor;  <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ä¸‹ä¸€æ¬¡è¦é€šè¿‡è¿™ä¸ªCursorè·å–ä¸‹ä¸€é¡µçš„keys</span>\n   <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> result;\n}</span></pre>\n</div>\n<h4><span class=\"prefix\"><span class=\"content\">5ã€è‡ªåŠ¨åŒ–éƒ¨ç½²</span></span></h4>\n<p>é€šè¿‡google/zxä½¿ç”¨nodejså¼€å‘äº†ä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²</p>\n<p>å¯ä»¥å‚è€ƒGithubçš„åœ°å€ï¼šhttps://github.com/aehyok/zx-deploy</p>\n<p>ä¸»è¦æ˜¯ç”¨äºå¼€å‘ç¯å¢ƒï¼Œé€šè¿‡</p>\n<div class=\"cnblogs_code\">\n<pre>pnpm sun-<span style=\"color: rgba(0, 0, 0, 1);\">baisc\npnpm sun</span>-<span style=\"color: rgba(0, 0, 0, 1);\">ncdp\npnpm sun</span>-systemserivce</pre>\n</div>\n<p>å½“ç„¶ä½ è¿˜å¯ä»¥é€šè¿‡ç»„åˆå‘½ä»¤è¿›è¡Œéƒ¨ç½²ï¼Œä¾‹å¦‚æƒ³ä¸€èµ·éƒ¨ç½²ä¸‰ä¸ªæœåŠ¡</p>\n<div class=\"cnblogs_code\">\n<pre>pnpm sun-all</pre>\n</div>\n<pre class=\"custom\"><code class=\"hljs\">å…¶å®å°±æ˜¯&nbsp;&nbsp;<br /></code></pre>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">pnpm sun-ncdp &amp;&amp; </span>\npnpm sun-basic &amp;&amp;<span style=\"color: rgba(0, 0, 0, 1);\"> \npnpm sun</span>-systemservice<span style=\"color: rgba(128, 0, 0, 1);\">\"</span></pre>\n</div>\n<p>è¿™é‡Œæˆ‘ç”¨çš„<code>&amp;&amp;</code>ç›¸å½“äºä¸Šé¢ä¸‰ä¸ªå‘½ä»¤ä¸²è¡Œæ‰§è¡Œï¼Œå…ˆæ‰§è¡Œsun-ncdp,å†æ‰§è¡Œsun-basic,æœ€åæ‰§è¡Œsun-systemserviceã€‚</p>\n<p>å¦‚æœä½ çš„ç”µè„‘æˆ–è€…æœåŠ¡å™¨æ€§èƒ½è¶³å¤Ÿå¥½ï¼Œå¯ä»¥ä½¿ç”¨<code>&amp;</code>ç¬¦å·ï¼Œè¿™æ ·å°±æ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œä¸‰ä¸ªæœåŠ¡åŒæ—¶å¯åŠ¨ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœæ—¶é—´ã€‚</p>\n<p>ä»¥ä¸Šä»…å±•ç¤ºäº†é¡¹ç›®çš„éƒ¨åˆ†å†…å®¹ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–çš„æŠ€æœ¯åº”ç”¨å’ŒåŠŸèƒ½éœ€è¦å¤§å®¶å»å‘ç°ã€‚</p>\n<p>ç„¶åæˆ‘ä»¬å¯ä»¥ä¸‹è½½æºç å‚è€ƒæ–‡æ¡£å¹¶è¿›è¡Œå®é™…æ“ä½œï¼Œä»¥ä¾¿å…¨é¢äº†è§£æ•´ä¸ªé¡¹ç›®çš„æŠ€æœ¯åº”ç”¨å’Œç‰¹æ€§ã€‚</p>\n<h2><span class=\"prefix\"><span class=\"content\">é¡¹ç›®åœ°å€</span></span></h2>\n<p>Githubï¼šhttps://github.com/aehyok/.NET8.0</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">æœ€å</span></h2>\n<p><span class=\"md-plain\"><span class=\"md-plain md-expand\">å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¸å¦¨ç‚¹ä¸ªèµæ”¯æŒä¸€ä¸‹ï¼ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ†äº«çŸ¥è¯†çš„åŠ¨åŠ›ã€‚å¦‚æœæœ‰ä»»ä½•ç–‘é—®æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œæ¬¢è¿éšæ—¶ç•™è¨€ã€‚ä¹Ÿå¯ä»¥åŠ å…¥å¾®ä¿¡å…¬ä¼—å·&nbsp;<span class=\"md-pair-s \"><strong>[DotNetæŠ€æœ¯åŒ ]</strong><span class=\"md-plain md-expand\">&nbsp;ç¤¾åŒºï¼Œä¸å…¶ä»–çƒ­çˆ±æŠ€æœ¯çš„åŒè¡Œä¸€èµ·äº¤æµå¿ƒå¾—ï¼Œå…±åŒæˆé•¿ï¼</span></span></span></span></p>\n<p><span class=\"md-plain\"><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/576536/202408/576536-20240813102419584-1596250541.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></span></p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-05 13:32</span>&nbsp;\n<a href=\"https://www.cnblogs.com/1312mn\">å°ç ç¼–åŒ </a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">49</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "åŸºäºAQSå®ç°çš„ReentrantLock",
      "link": "https://www.cnblogs.com/huiduthinker/p/19578752/reentrantlock-implemented-based-on-aqs-z1wrekj",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/huiduthinker/p/19578752/reentrantlock-implemented-based-on-aqs-z1wrekj\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-02-05 13:05\">\n    <span>åŸºäºAQSå®ç°çš„ReentrantLock</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"åŸºäºaqså®ç°çš„reentrantlock\">åŸºäºAQSå®ç°çš„ReentrantLock</h1>\n<p>è¿™é‡Œçš„æºç ç”¨çš„Java8ç‰ˆæœ¬</p>\n<h2 id=\"lockæ–¹æ³•\">lockæ–¹æ³•</h2>\n<p>å½“ReentrantLockç±»çš„å®ä¾‹å¯¹è±¡å°è¯•è·å–é”çš„æ—¶å€™ï¼Œè°ƒç”¨lockæ–¹æ³•ï¼Œ</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/3592839/202602/3592839-20260205130512179-38125355.png\" /></p>\n<p>ä¼šè¿›å…¥syncçš„lockæ–¹æ³•ï¼Œå…¶ä¸­Syncæ˜¯ReentrantLockçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼ŒReentrantLockæ„é€ æ–¹æ³•ä¼šé»˜è®¤ä½¿ç”¨éå…¬å¹³é”<code>NonfairSync</code>ï¼Œè¿™ä¸ªç±»æ˜¯ç»§æ‰¿äºSyncçš„</p>\n<pre><code class=\"language-java\">        final void lock() {\n            if (!initialTryLock())\n                acquire(1);\n        }\n// å…¶ä¸­Syncçš„initialTryLockæ˜¯æŠ½è±¡æ–¹æ³•ï¼Œéœ€è¦çœ‹éå…¬å¹³é”å®ç°æ–¹æ³•\n</code></pre>\n<blockquote>\n<p>[!TIP]<br />\nåœ¨è¿™é‡Œæ˜¯ç¬¬ä¸€æ¬¡å°è¯•è·å–é”</p>\n</blockquote>\n<p>ç”±äºReentrantLockæ˜¯ä¸ªå¯é‡å…¥é”ï¼Œåˆ¤æ–­é‡Œæœ‰é‡å…¥çš„åˆ¤æ–­</p>\n<pre><code class=\"language-java\">final boolean initialTryLock() {\n            Thread current = Thread.currentThread();\n\t\t\t// è·å–å½“å‰çº¿ç¨‹çš„å¯¹è±¡\n            if (compareAndSetState(0, 1)) { // first attempt is unguarded\n\t\t\t// ç”¨CASæ¯”è¾ƒstateçŠ¶æ€æ˜¯å¦ä¸º0ï¼ˆæ— äººæŒæœ‰é”ï¼‰ï¼Œå¦‚æœæ˜¯ï¼Œå°±è½¬ä¸º1ï¼ˆè·å–åˆ°é”ï¼‰\n                setExclusiveOwnerThread(current);\n\t\t\t// å°†å½“å‰è¿›ç¨‹è®¾ç½®ä¸ºæ‹¥æœ‰é”çš„çº¿ç¨‹\n                return true;\n            } else if (getExclusiveOwnerThread() == current) {\n\t\t\t// å½“å‰çº¿ç¨‹ä¸ºæ‹¥æœ‰é”çš„çº¿ç¨‹ï¼ˆé‡å¤è·å–ï¼‰ï¼Œé‡å…¥\n                int c = getState() + 1;\n                if (c &lt; 0) // overflow\n\t\t\t// è´Ÿæ•°ï¼Œstateæ˜¯ä¸ªintç±»å‹æ•°æ®ï¼Œè¶…å‡ºå¯èƒ½å¯¼è‡´æº¢å‡ºå˜ä¸ºè´Ÿæ•°\n                    throw new Error(\"Maximum lock count exceeded\");\n                setState(c);\n\t\t\t// è®¾ç½®æ–°çš„state\n                return true;\n            } else\n\t\t\t// å·²æœ‰çº¿ç¨‹å é”ï¼Œè¿”å›ä¸ºfalse\n                return false;\n        }\n</code></pre>\n<p>ç„¶åå¼€å§‹è°ƒç”¨acquireæ–¹æ³•ï¼Œä¼ å…¥1</p>\n<pre><code class=\"language-java\">    public final void acquire(int arg) {\n        if (!tryAcquire(arg) &amp;&amp;\n            acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n            selfInterrupt();\n    }\n</code></pre>\n<p>è°ƒç”¨tryAcquire()æ–¹æ³•ï¼Œå…¶ä¸­tryAcquire()æ–¹æ³•æ˜¯ä¸€ä¸ªåªæœ‰æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ï¼Œéœ€è¦é‡å†™ï¼Œæˆ‘ä»¬çœ‹éå…¬å¹³é”çš„å†™æ³•</p>\n<p>â€</p>\n<blockquote>\n<p>[!TIP]<br />\nè¿™æ˜¯ç¬¬äºŒæ¬¡è·å–é”</p>\n</blockquote>\n<pre><code class=\"language-java\">        protected final boolean tryAcquire(int acquires) {\n            if (getState() == 0 &amp;&amp; !hasQueuedPredecessors() &amp;&amp;\n                compareAndSetState(0, acquires)) {\n                setExclusiveOwnerThread(Thread.currentThread());\n                return true;\n            }\n            return false;\n        }\n</code></pre>\n<p>è¿™é‡Œï¼Œå¦‚æœstateæ˜¯0ï¼Œå³æ²¡æœ‰çº¿ç¨‹å ç”¨é”çš„æƒ…å†µä¸‹<code>getState() == 0</code>â€‹è¿™ä¸ªä¸ºçœŸ<code>!hasQueuedPredecessors()</code>æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ£€æŸ¥æ˜¯å¦å·²ç»å‡ºç°äº†ç­‰å¾…é˜Ÿåˆ—</p>\n<pre><code class=\"language-java\">    public final boolean hasQueuedPredecessors() {\n        Thread first = null; Node h, s;\n        if ((h = head) != null &amp;&amp; ((s = h.next) == null ||\n                                   (first = s.waiter) == null ||\n                                   s.prev == null))\n            first = getFirstQueuedThread(); // retry via getFirstQueuedThread\n        return first != null &amp;&amp; first != Thread.currentThread();\n    }\n</code></pre>\n<p>å½“æœªå‡ºç° åŒæ­¥é˜Ÿåˆ—/é˜»å¡é˜Ÿåˆ— ï¼Œæˆ–è€…å½“å‰çº¿ç¨‹æ˜¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªæ—¶ï¼Œæ‰§è¡ŒcompareAndSetState(0, acquires)ï¼Œç¬¬äºŒæ¬¡å°è¯•è·å–é”ï¼Œå¦‚æœæˆåŠŸï¼Œè¿”å›çœŸ</p>\n<p>å¦åˆ™è¿”å›å‡ï¼Œæ‰§è¡Œ<code>acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</code></p>\n<pre><code class=\"language-java\">    private Node addWaiter(Node mode) {\n        Node node = new Node(Thread.currentThread(), mode);\n        // Try the fast path of enq; backup to full enq on failure\n        Node pred = tail;\n        if (pred != null) {\n            node.prev = pred;\n            if (compareAndSetTail(pred, node)) {\n\t\t\t// å°è¯•åŠ å…¥é˜Ÿå°¾\n                pred.next = node;\n                return node;\n            }\n        }\n        enq(node);\n        return node;\n    }\n</code></pre>\n<p>Nodeæ˜¯åŒå‘é˜Ÿåˆ—ï¼šé˜»å¡é˜Ÿåˆ—ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ˜¯ä¸ºäº†ä¿è¯åŸå­åŒ–æ‰€ä»¥åŒ…è£…èµ·æ¥çš„</p>\n<p>å¦‚æœtailå°¾æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™è®¾ç½®æ–°ç”Ÿæˆçš„ä¸ºå°¾æŒ‡é’ˆæŒ‡å‘çš„</p>\n<p>å¦åˆ™ï¼ˆé˜»å¡é˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼Œè°ƒç”¨enqå‡½æ•°</p>\n<pre><code class=\"language-java\">    private Node enq(final Node node) {\n        for (;;) {\n            Node t = tail;\n            if (t == null) { // Must initialize\n                if (compareAndSetHead(new Node()))\n\t\t\t// ä½¿ç”¨CASï¼Œé˜²æ­¢å¤šçº¿ç¨‹åŒæ—¶åˆ›å»ºå¤´èŠ‚ç‚¹ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šè¿˜æ˜¯éœ€è¦æŠ¢å…¥é˜Ÿé¡ºåº\n                    tail = head;\n\t\t\t// åˆå§‹åŒ–å¤´èŠ‚ç‚¹ï¼Œå¹¶å°†å°¾æŒ‡é’ˆæŒ‡å‘å¤´èŠ‚ç‚¹\n            } else {\n                node.prev = t;\n                if (compareAndSetTail(t, node)) {\n\t\t\t// åˆ¤æ–­tæ˜¯å¦ä¸ºå°¾èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰çº¿ç¨‹æ›´å¿«çš„æ”¹æ‰å°¾èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¿®æ”¹å¤±è´¥ï¼Œ\n\t\t\t// é‡æ–°è¿›å…¥forå¾ªç¯\n                    t.next = node;\n                    return t;\n\t\t\t// ä¿®æ”¹æˆåŠŸ\n                }\n            }\n        }\n    }\n</code></pre>\n<blockquote>\n<p>[!TIP]<br />\nè¿™æ˜¯ç¬¬ä¸‰æ¬¡å°è¯•è·å–é”</p>\n</blockquote>\n<pre><code class=\"language-java\">    final boolean acquireQueued(final Node node, int arg) {\n        boolean failed = true;\n        try {\n            boolean interrupted = false;\n            for (;;) {\n                final Node p = node.predecessor();\n\t\t\t// è·å–nodeçš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹ï¼ˆå½“å‰èŠ‚ç‚¹æ˜¯ç¬¬ä¸€ä¸ªï¼‰\n\t\t\t// æ‰§è¡ŒtryAcquire(arg)ï¼Œæ‰§è¡Œç¬¬ä¸‰æ¬¡å°è¯•è·å–é”\n                if (p == head &amp;&amp; tryAcquire(arg)) {\n\t\t\t// è·å–é”æˆåŠŸï¼Œå‡ºé˜Ÿ\n                    setHead(node);// å°†nodeè®¾ä¸ºå¤´èŠ‚ç‚¹\n                    p.next = null; // help GC\n                    failed = false;\n                    return interrupted;\n                }\n                if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;\n                    parkAndCheckInterrupt())\n                    interrupted = true;\n            }\n        } finally {\n            if (failed)\n                cancelAcquire(node);\n        }\n    }\n</code></pre>\n<p>å¦‚æœç¬¬ä¸‰æ¬¡å°è¯•è·å–é”å¤±è´¥äº†ï¼Œä¼šè°ƒç”¨shouldParkAfterFailedAcquire()æ–¹æ³•ï¼Œå°†nodeçš„å‰ä¸€ä¸ªèŠ‚ç‚¹ä¼ å…¥ï¼ˆnodeä¸€ç›´éƒ½æ˜¯åŠ å…¥çš„èŠ‚ç‚¹ï¼‰</p>\n<pre><code class=\"language-java\">    private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {\n        int ws = pred.waitStatus;\n        if (ws == Node.SIGNAL)\n\t\t// ç¡®è®¤å‰é¢çš„èŠ‚ç‚¹å¤„äºSIGNALçŠ¶æ€ï¼Œå³ç¡®è®¤å‰é¢çš„èŠ‚ç‚¹ä¼šå«é†’è‡ªå·±\n            /*\n             * This node has already set status asking a release\n             * to signal it, so it can safely park.\n             */\n            return true;\n        if (ws &gt; 0) {\n            /*\n             * Predecessor was cancelled. Skip over predecessors and\n             * indicate retry.\n             */\n            do {\n                node.prev = pred = pred.prev;\n            } while (pred.waitStatus &gt; 0);\n\t\t\t// Nodeé‡Œé¢ä»…æœ‰ä¸€ä¸ªå¤§äºé›¶çš„çŠ¶æ€ï¼Œå³1å–æ¶ˆçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰ä»»åŠ¡è¢«å–æ¶ˆäº†\n\t\t\t// æŒç»­å¾ªç¯å€¼æ‰¾åˆ°ä¸å†å–æ¶ˆçš„èŠ‚ç‚¹\n            pred.next = node;\n        } else {\n\t\t// å°†å‰ä¸€ä¸ªèŠ‚ç‚¹ç”¨CASè½¬ä¸ºNode.SIGNALçŠ¶æ€-1ï¼Œè¿”å›ä¸ºfalse\n            /*\n             * waitStatus must be 0 or PROPAGATE.  Indicate that we\n             * need a signal, but don't park yet.  Caller will need to\n             * retry to make sure it cannot acquire before parking.\n             */\n            compareAndSetWaitStatus(pred, ws, Node.SIGNAL);\n        }\n        return false;\n    }\n</code></pre>\n<blockquote>\n<p>è¿™é‡Œæ’ä¸€å˜´ï¼ŒNodeèŠ‚ç‚¹æœ‰ä¸€äº›çŠ¶æ€ï¼Œæ¥ä½“ç°å…¶çš„ä»»åŠ¡çŠ¶æ€ï¼Œå¦‚å‰é¢ä¼ å…¥çš„å°±æ˜¯ç‹¬å é˜Ÿåˆ—ï¼Œ<code>addWaiter(Node.EXCLUSIVE)</code></p>\n<pre><code class=\"language-java\">    static final class Node {\n        /** Marker to indicate a node is waiting in shared mode */\n        static final Node SHARED = new Node();\n\t\t// å…±äº«é˜Ÿåˆ—\n        /** Marker to indicate a node is waiting in exclusive mode */\n        static final Node EXCLUSIVE = null;\n\t\t// ç‹¬å é˜Ÿåˆ—\n        /** waitStatus value to indicate thread has cancelled */// å–æ¶ˆ\n        static final int CANCELLED =  1;\n\t\t// å·²è¢«å–æ¶ˆ\n        /** waitStatus value to indicate successor's thread needs unparking */\n        static final int SIGNAL    = -1;\n\t\t// è¡¨ç¤ºnextèŠ‚ç‚¹å·²ç»parkï¼Œéœ€è¦è¢«å”¤é†’\n        /** waitStatus value to indicate thread is waiting on condition */\n        static final int CONDITION = -2;\n        /**\n         * waitStatus value to indicate the next acquireShared should\n         * unconditionally propagate\n         */\n\t\t// å…±äº«çŠ¶æ€\n        static final int PROPAGATE = -3;\n</code></pre>\n</blockquote>\n<pre><code class=\"language-java\">if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;\n                    parkAndCheckInterrupt())\n                    interrupted = true;\n</code></pre>\n<p>å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹çš„waitStateæ˜¯0ï¼Œä¼šè¢«CASè½¬ä¸º-1ï¼Œç„¶åè¿”å›falseï¼Œè¿›è€Œä¸ä¼šæ‰§è¡ŒparkAndCheckInterrupt()ï¼Œç»§ç»­forçš„æ— é™å¾ªç¯ï¼Œè¿™é‡Œæœ‰å¯èƒ½å‡ºç°ç¬¬å››æ¬¡å°è¯•</p>\n<p>å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹çš„waitStateæ˜¯-1,è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªtrueï¼Œä¹Ÿå°±å¯ä»¥ç»§ç»­æ‰§è¡Œ<code>parkAndCheckInterrupt()</code></p>\n<pre><code class=\"language-java\">    private final boolean parkAndCheckInterrupt() {\n        LockSupport.park(this);\n        return Thread.interrupted();\n    }\n</code></pre>\n<p>å½“å‰çº¿ç¨‹è¿›å…¥parkçŠ¶æ€</p>\n<p>â€</p>\n<p>è‡³æ­¤æˆ‘ä»¬å®Œæˆäº†è¿™ä¸ªçš„lockè¿‡ç¨‹</p>\n<p>â€</p>\n<h2 id=\"unlockæ–¹æ³•\">unlockæ–¹æ³•</h2>\n<p>unlock()ä¹Ÿæ˜¯å…¬å¹³é”ä»¥åŠéå…¬å¹³é”éƒ½æœ‰çš„æ–¹æ³•ï¼ŒåŒæ ·ç»§æ‰¿äº†Sync</p>\n<pre><code class=\"language-java\">    public void unlock() {\n        sync.release(1);\n    }\n</code></pre>\n<p>Syncçš„releaseæ–¹æ³•</p>\n<pre><code class=\"language-java\">    public final boolean release(int arg) {\n        if (tryRelease(arg)) {\n            Node h = head;\n            if (h != null &amp;&amp; h.waitStatus != 0)\n                unparkSuccessor(h);\n            return true;\n        }\n        return false;\n    }\n</code></pre>\n<p>é¦–å…ˆå°è¯•tryReleaseæ–¹æ³•</p>\n<pre><code class=\"language-java\">        protected final boolean tryRelease(int releases) {\n            int c = getState() - releases;\n            if (Thread.currentThread() != getExclusiveOwnerThread())\n                throw new IllegalMonitorStateException();\n            boolean free = false;\n            if (c == 0) {\n                free = true;\n                setExclusiveOwnerThread(null);\n            }\n            setState(c);\n            return free;\n        }\n</code></pre>\n<p>å¦‚æœæˆåŠŸé†’è¿‡æ¥ï¼Œè¯¥çº¿ç¨‹ä¾ç„¶å¤„äºä¸€ç§parkçš„ä½ç½®ä¸Šï¼Œå³parkAndCheckInterruptè¿™ä¸ªæ–¹æ³•ä¸Šï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›æ˜¯å¦è¢«ä¸­æ–­<code>ReentrantLock</code>è¿™ä¸ªé”ä»…è·å–ä¸­æ–­ä¿¡æ¯ï¼Œè€Œä¸ä¼šåšå‡ºä»»ä½•æ“ä½œ</p>\n<pre><code class=\"language-java\">final boolean acquireQueued(final Node node, int arg) {\n        boolean failed = true;\n        try {\n            boolean interrupted = false;\n            for (;;) {\n                final Node p = node.predecessor();\n                if (p == head &amp;&amp; tryAcquire(arg)) {\n                    setHead(node);\n                    p.next = null; // help GC\n                    failed = false;\n                    return interrupted;\n                }\n                if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;\n                    parkAndCheckInterrupt())\n                    interrupted = true;\n            }\n        } finally {\n            if (failed)\n                cancelAcquire(node);\n        }\n    }\n</code></pre>\n<p>è‹é†’è¿‡æ¥ä¹‹åï¼Œç»§ç»­forå¾ªç¯ï¼Œå°è¯•è·å–é”ï¼Œå¤±è´¥ä¹‹åä¼šæ¥ç€parkï¼ŒæˆåŠŸå°±ä¼šè·å–é”ï¼Œå¹¶è¿”å›ä¸­æ–­çŠ¶æ€ï¼Œåœ¨acquireä¸­å†³å®šè‡ªæˆ‘ä¸­æ–­</p>\n<pre><code class=\"language-java\">        final boolean nonfairTryAcquire(int acquires) {\n            final Thread current = Thread.currentThread();\n            int c = getState();\n            if (c == 0) {\n                if (compareAndSetState(0, acquires)) {\n                    setExclusiveOwnerThread(current);\n                    return true;\n                }\n            }\n            else if (current == getExclusiveOwnerThread()) {\n                int nextc = c + acquires;\n                if (nextc &lt; 0) // overflow\n                    throw new Error(\"Maximum lock count exceeded\");\n                setState(nextc);\n                return true;\n            }\n            return false;\n        }\n</code></pre>\n<p>å¹¶å°†setExclusiveOwnerThreadä¼ å…¥å½“å‰çº¿ç¨‹ï¼Œè¿”å›ä¸ºçœŸï¼Œå› æ­¤åœ¨TryReleaseæ–¹æ³•é‡Œçš„<code>Thread.currentThread() != getExclusiveOwnerThread()</code>ä¸€å®šä¸ºå‡ï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶è®¾ç½®freeä¸ºfalseï¼Œå½“cä¹Ÿå°±æ˜¯èµ„æºçš„stateå¦‚æœæ˜¯0</p>\n<pre><code class=\"language-java\">\t\t\tif (c == 0) {\n                free = true;\n                setExclusiveOwnerThread(null);\n            }\n            setState(c);\n            return free;\n</code></pre>\n<p>cå¦‚æœæ˜¯0ï¼Œå³æ²¡æœ‰çº¿ç¨‹å ç”¨èµ„æºï¼ŒsetExclusiveOwnerThreadå°†é”çš„çº¿ç¨‹è®¾ç½®ä¸ºç©ºï¼Œå¦‚æœä¸ä¸º0ï¼Œä¹Ÿå°±æ˜¯é‡å…¥é”ä»…ä»…è§£é”ä¸€æ¬¡ï¼Œcä¾ç„¶å­˜åœ¨å¤šä¸ªï¼Œè®¾ç½®cä¸ºæ–°çš„stateå€¼ï¼Œç„¶ä¼šfreeå€¼ï¼ˆèµ„æºé”çš„ä½¿ç”¨æƒ…å†µï¼‰</p>\n<pre><code class=\"language-java\">    public final boolean release(int arg) {\n        if (tryRelease(arg)) {\n            Node h = head;\n            if (h != null &amp;&amp; h.waitStatus != 0)\n                unparkSuccessor(h);\n            return true;\n        }\n        return false;\n    }\n</code></pre>\n<pre><code class=\"language-java\">    private void unparkSuccessor(Node node) {\n        /*\n         * If status is negative (i.e., possibly needing signal) try\n         * to clear in anticipation of signalling.  It is OK if this\n         * fails or if status is changed by waiting thread.\n         */\n        int ws = node.waitStatus;\n        if (ws &lt; 0)\n            compareAndSetWaitStatus(node, ws, 0);\n\n        /*\n         * Thread to unpark is held in successor, which is normally\n         * just the next node.  But if cancelled or apparently null,\n         * traverse backwards from tail to find the actual\n         * non-cancelled successor.\n         */\n        Node s = node.next;ã€\n\t\t// å¦‚æœä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ä¸ºå–æ¶ˆæˆ–è€…ä¸ºç©ºï¼Œä»åå‘å‰æ‰¾æœ€åä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ï¼Œèµ‹å€¼ä¸ºs\n        if (s == null || s.waitStatus &gt; 0) {\n            s = null;\n            for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev)\n                if (t.waitStatus &lt;= 0)\n                    s = t;\n        }\n\t\t// sä¸ä¸ºç©ºçš„è¯ä½œä¸ºä¸‹ä¸€ä¸ªè¢«å”¤é†’çš„èŠ‚ç‚¹ï¼Œå°è¯•å”¤é†’\n        if (s != null)\n            LockSupport.unpark(s.thread);\n    }\n</code></pre>\n<p>æ­¤æ—¶ï¼Œå½“å‰èŠ‚ç‚¹ä¸ºå¤´èŠ‚ç‚¹ï¼Œè°ƒç”¨unparkSuccessor()æ–¹æ³•ï¼Œè·å–å¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-05 13:05</span>&nbsp;\n<a href=\"https://www.cnblogs.com/huiduthinker\">huidu01</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    }
  ]
}