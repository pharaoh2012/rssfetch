{
  "title": "主页 - 博客园",
  "link": "https://www.cnblogs.com/",
  "description": "主页 - 博客园 RSS",
  "entries": [
    {
      "title": "蓝牙基础(十)：蓝牙串口、文件传输、通话控制",
      "link": "https://www.cnblogs.com/liwen01/p/19492954",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/liwen01/p/19492954\" id=\"cb_post_title_url\" title=\"发布于 2026-01-27 12:16\">\n    <span>蓝牙基础(十)：蓝牙串口、文件传输、通话控制</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<section class=\"js_darkmode__0\">\n<p class=\"js_darkmode__1\"><strong class=\"js_darkmode__2\">liwen01 2026.01.02</strong></p>\n<h2 class=\"js_darkmode__3\"><span class=\"js_darkmode__4\">前言</span></h2>\n<p class=\"js_darkmode__5\">日常生活中，我们用到的很多蓝牙功能，都是基于蓝牙 RFCOMM 传输协议来实现，比如：</p>\n<ul class=\"list-paddingleft-1 js_darkmode__6\">\n<li>\n<section class=\"js_darkmode__7\">手机与手机间通过蓝牙分享名片、短信、图片、文件等</section>\n</li>\n<li>\n<section class=\"js_darkmode__8\">手机与车机之间的来电显示、电话接听、挂断、音量调节等</section>\n</li>\n<li>\n<section class=\"js_darkmode__9\">蓝牙模拟串口的数据透传等</section>\n</li>\n</ul>\n<p class=\"js_darkmode__10\">对应的蓝牙&nbsp;<code class=\"js_darkmode__11\">Profile</code>（配置文件）有：&nbsp;<code class=\"js_darkmode__12\">OPP/FTP，PBAP/MAP/SYNC，BPP/BIP，HFP/HSP，SPP，DUN</code>等等</p>\n<p class=\"js_darkmode__13\">它们间的层级关系如下图：</p>\n<figure><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/555985/202601/555985-20260116164413804-84592589.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></figure>\n<p class=\"js_darkmode__15\">具体功能如下表：</p>\n<section>\n<table>\n<thead>\n<tr>\n<th class=\"js_darkmode__16\">\n<section>Profile</section>\n</th>\n<th class=\"js_darkmode__17\">\n<section>中文名称</section>\n</th>\n<th class=\"js_darkmode__18\">\n<section>主要功能</section>\n</th>\n<th class=\"js_darkmode__19\">\n<section>常见设备</section>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"js_darkmode__20\">\n<td class=\"js_darkmode__21\"><strong class=\"js_darkmode__22\">OPP</strong></td>\n<td class=\"js_darkmode__23\">\n<section>对象推送</section>\n</td>\n<td class=\"js_darkmode__24\">\n<section>文件、名片传输</section>\n</td>\n<td class=\"js_darkmode__25\">\n<section>手机间传文件</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__26\">\n<td class=\"js_darkmode__27\"><strong class=\"js_darkmode__28\">FTP</strong></td>\n<td class=\"js_darkmode__29\">\n<section>文件传输</section>\n</td>\n<td class=\"js_darkmode__30\">\n<section>访问远程文件系统</section>\n</td>\n<td class=\"js_darkmode__31\">\n<section>手机、电脑</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__32\">\n<td class=\"js_darkmode__33\"><strong class=\"js_darkmode__34\">SPP</strong></td>\n<td class=\"js_darkmode__35\">\n<section>串口通信</section>\n</td>\n<td class=\"js_darkmode__36\">\n<section>数据传输通道</section>\n</td>\n<td class=\"js_darkmode__37\">\n<section>MCU 模块、扫描枪</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__38\">\n<td class=\"js_darkmode__39\"><strong class=\"js_darkmode__40\">DUN</strong></td>\n<td class=\"js_darkmode__41\">\n<section>拨号联网</section>\n</td>\n<td class=\"js_darkmode__42\">\n<section>调制解调器上网</section>\n</td>\n<td class=\"js_darkmode__43\">\n<section>手机 → 电脑</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__44\">\n<td class=\"js_darkmode__45\"><strong class=\"js_darkmode__46\">HSP</strong></td>\n<td class=\"js_darkmode__47\">\n<section>耳机</section>\n</td>\n<td class=\"js_darkmode__48\">\n<section>基础语音通信</section>\n</td>\n<td class=\"js_darkmode__49\">\n<section>蓝牙耳机</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__50\">\n<td class=\"js_darkmode__51\"><strong class=\"js_darkmode__52\">HFP</strong></td>\n<td class=\"js_darkmode__53\">\n<section>免提</section>\n</td>\n<td class=\"js_darkmode__54\">\n<section>电话控制与语音通话</section>\n</td>\n<td class=\"js_darkmode__55\">\n<section>车载系统</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__56\">\n<td class=\"js_darkmode__57\"><strong class=\"js_darkmode__58\">PBAP</strong></td>\n<td class=\"js_darkmode__59\">\n<section>电话本访问</section>\n</td>\n<td class=\"js_darkmode__60\">\n<section>读取联系人</section>\n</td>\n<td class=\"js_darkmode__61\">\n<section>车机</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__62\">\n<td class=\"js_darkmode__63\"><strong class=\"js_darkmode__64\">MAP</strong></td>\n<td class=\"js_darkmode__65\">\n<section>短信访问</section>\n</td>\n<td class=\"js_darkmode__66\">\n<section>读/发短信</section>\n</td>\n<td class=\"js_darkmode__67\">\n<section>车机、智能手表</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__68\">\n<td class=\"js_darkmode__69\"><strong class=\"js_darkmode__70\">SYNC</strong></td>\n<td class=\"js_darkmode__71\">\n<section>信息同步</section>\n</td>\n<td class=\"js_darkmode__72\">\n<section>联系人、日历同步</section>\n</td>\n<td class=\"js_darkmode__73\">\n<section>手机与电脑</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__74\">\n<td class=\"js_darkmode__75\"><strong class=\"js_darkmode__76\">BPP</strong></td>\n<td class=\"js_darkmode__77\">\n<section>基本打印</section>\n</td>\n<td class=\"js_darkmode__78\">\n<section>蓝牙打印</section>\n</td>\n<td class=\"js_darkmode__79\">\n<section>手机打印机</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__80\">\n<td class=\"js_darkmode__81\"><strong class=\"js_darkmode__82\">BIP</strong></td>\n<td class=\"js_darkmode__83\">\n<section>图像传输</section>\n</td>\n<td class=\"js_darkmode__84\">\n<section>图片传输与控制</section>\n</td>\n<td class=\"js_darkmode__85\">\n<section>相机、打印机</section>\n</td>\n</tr>\n</tbody>\n</table>\n</section>\n<p class=\"js_darkmode__86\">这里，我们只简单介绍蓝牙的&nbsp;<strong class=\"js_darkmode__87\">串口数据透传、文件传输、通话控制</strong>。</p>\n<h2 class=\"js_darkmode__88\"><span class=\"js_darkmode__89\">（一）RFCOMM 简介</span></h2>\n<figure><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/555985/202601/555985-20260116164429253-1398249621.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></figure>\n<p class=\"js_darkmode__91\">RFCOMM 是金典蓝牙(BR/EDR)的一个传输层协议，它是串口数据透传、文件传输、通话控制等应用功能的基础。</p>\n<h3 class=\"js_darkmode__92\"><span class=\"js_darkmode__93\">（1）RFCOMM 历史</span></h3>\n<p class=\"js_darkmode__94\">RFCOMM （Radio Frequency Communication）诞生于 20 世纪 90 年代末，当时计算机和外设（如调制解调器、打印机）主要通过物理串口（COM 口）连接。</p>\n<p class=\"js_darkmode__95\">RFCOMM 的核心任务是在蓝牙连接之上模拟传统的 RS-232 串口（Serial Port）通信，它是蓝牙协议栈中极为重要的一个传输层协议。</p>\n<p class=\"js_darkmode__96\">蓝牙技术联盟（Bluetooth SIG）在制定蓝牙 V1.0 版本规范时，目标之一就是&nbsp;<strong class=\"js_darkmode__97\">电缆替代</strong>。为了让原本基于串口工作的旧软件能无缝迁移到无线蓝牙，开发者需要一种协议来模拟串口，于是就有了 RFCOMM。</p>\n<p class=\"js_darkmode__98\">RFCOMM 是基于 ETSI TS 07.10 标准修改而来，而 TS 07.10 是 GSM 蜂窝网络中用于在移动设备和终端之间进行多路复用串口通信的标准。 具体定义可以查看官网的《RFCOMM WITH TS 07.10》。</p>\n<h3 class=\"js_darkmode__99\"><span class=\"js_darkmode__100\">（2）RFCOMM 的技术变迁</span></h3>\n<figure><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/555985/202601/555985-20260116164445182-1051371572.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></figure>\n<p class=\"js_darkmode__102\"><strong class=\"js_darkmode__103\">（A）信号模拟</strong></p>\n<p class=\"js_darkmode__104\">最初的 RFCOMM 仅实现了对 RS-232 九针串口信号（如 RTS/CTS, DTR/DSR）的逻辑映射。这使得早期的蓝牙手机可以像接了串口线一样，被电脑识别为一个<strong class=\"js_darkmode__105\">无线调制解调器</strong>。</p>\n<p class=\"js_darkmode__106\"><strong class=\"js_darkmode__107\">（B）基于信用的流控制</strong></p>\n<p class=\"js_darkmode__108\">最初 RFCOMM 依赖底层的 L2CAP 进行简单的流控，但在高负载下容易丢包或死锁。</p>\n<p class=\"js_darkmode__109\">在蓝牙核心规范 V1.1 及后续版本中引入了<strong class=\"js_darkmode__110\">信用（Credit）</strong>机制。发送方必须先获得接收方的<strong class=\"js_darkmode__111\">信用额度</strong>才能发送数据包。</p>\n<p class=\"js_darkmode__112\">每发送一个包，信用减一；接收方处理完数据后，再返还信用。这极大地提高了大规模数据传输（如文件传输）的稳定性。</p>\n<p class=\"js_darkmode__113\"><strong class=\"js_darkmode__114\">（C）安全性增强</strong></p>\n<p class=\"js_darkmode__115\">随着蓝牙版本从 V2.1 进化到 V5.x 及目前最新的 V6.x，RFCOMM 本身虽然结构未变，但其底层的链路层引入了 SSP（安全简易配对） 和 AES-128 加密，使得通过 RFCOMM 传输的串口数据安全性有了大幅度的提升。</p>\n<h3 class=\"js_darkmode__116\"><span class=\"js_darkmode__117\">（3）模拟串口</span></h3>\n<p class=\"js_darkmode__118\"><strong class=\"js_darkmode__119\">（A）RFCOMM 的两种连接方式</strong></p>\n<figure><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/555985/202601/555985-20260116164459505-1389385003.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></figure>\n<p class=\"js_darkmode__121\">这是最常见、最标准的 蓝牙串口通信方式（SPP 类），两个设备都有蓝牙功能（Type 1 与 Type 2），二者通过 蓝牙链路（BT） 进行通信。</p>\n<p class=\"js_darkmode__122\">在这条链路上运行 RFCOMM 协议，从而提供虚拟串口连接。</p>\n<p class=\"js_darkmode__123\"><strong class=\"js_darkmode__124\">典型的应用是</strong>：手机（Type 1）与 蓝牙 GPS 模块（Type 2）通过蓝牙虚拟串口传输 NMEA 数据。</p>\n<figure><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/555985/202601/555985-20260116164510839-2023906886.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></figure>\n<p class=\"js_darkmode__126\">这里多了一个 Device C（没有蓝牙功能），蓝牙设备 Type 2 在此扮演中继桥接（gateway）角色。把蓝牙 RFCOMM 链路与传统的有线串口相连接。</p>\n<p class=\"js_darkmode__127\"><strong class=\"js_darkmode__128\">典型的应用是</strong>：电脑（Type 1）通过蓝牙连接到蓝牙-转-串口适配器（Type 2）， &nbsp;而该适配器再通过 RS-232 连接到一台老式工业设备（Device C）。</p>\n<p class=\"js_darkmode__129\">电脑看上去就像直接用串口连着那台设备一样。</p>\n<p class=\"js_darkmode__130\"><strong class=\"js_darkmode__131\">（A）RFCOMM 串口端口号</strong></p>\n<figure><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/555985/202601/555985-20260116164527582-1681074606.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></figure>\n<p class=\"js_darkmode__133\">在一个会话中，理论上可以支持最大60个端口号。</p>\n<p class=\"js_darkmode__134\">但是实际上大多数蓝牙受内存和调度能力限制，一般只支持1 ~ 7个端口。</p>\n<h2 class=\"js_darkmode__135\"><span class=\"js_darkmode__136\">（二）数据透传</span></h2>\n<figure><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/555985/202601/555985-20260116164541353-532526925.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></figure>\n<h3 class=\"js_darkmode__138\"><span class=\"js_darkmode__139\">（1）SPP 简介</span></h3>\n<p class=\"js_darkmode__140\">SPP 的全称是&nbsp;<strong class=\"js_darkmode__141\">Serial Port Profile</strong>。它的核心定义是：<strong class=\"js_darkmode__142\">如何在两个蓝牙设备之间建立仿真串口连接</strong>。</p>\n<p class=\"js_darkmode__143\">它在蓝牙链路上模拟了 RS232 控制信号，使得传统的串口应用程序可以无缝迁移到蓝牙无线传输上，而无需修改应用层逻辑。</p>\n<h3 class=\"js_darkmode__144\"><span class=\"js_darkmode__145\">（2）SPP 的协议栈架构</span></h3>\n<p class=\"js_darkmode__146\">SPP 是构建在&nbsp;<strong class=\"js_darkmode__147\">RFCOMM</strong>&nbsp;协议之上的应用协议，它依赖于：RFCOMM、SDP、L2CAP的支持。</p>\n<p class=\"js_darkmode__148\"><strong class=\"js_darkmode__149\">RFCOMM 层</strong>：SPP 的直接承载者。RFCOMM 在 L2CAP 之上模拟了 9 针串口信号，支持多路复用（即一个蓝牙链路可以跑多个虚拟串口）。</p>\n<p class=\"js_darkmode__150\"><strong class=\"js_darkmode__151\">SDP</strong>&nbsp;(Service Discovery Protocol)：服务发现协议。客户端通过查询 SDP 记录，找到服务器上 SPP 服务对应的&nbsp;<strong class=\"js_darkmode__152\">RFCOMM Server Channel</strong>&nbsp;(1~30)。</p>\n<p class=\"js_darkmode__153\"><strong class=\"js_darkmode__154\">L2CAP 层</strong>：负责数据的分段与重组，为 RFCOMM 提供面向连接的数据服务。</p>\n<h3 class=\"js_darkmode__155\"><span class=\"js_darkmode__156\">（3）SPP 的建立连接流程</span></h3>\n<p class=\"js_darkmode__157\">要实现两个设备间的串口通信，通常需要经历以下四个阶段：</p>\n<p class=\"js_darkmode__158\"><strong class=\"js_darkmode__159\">（A）查询与发现</strong>&nbsp;(Inquiry/Discovery)：主设备（Client）扫描周围的蓝牙设备。</p>\n<p class=\"js_darkmode__160\"><strong class=\"js_darkmode__161\">（B）服务发现</strong>&nbsp;(SDP Query)：主设备向从设备（Server）发起 SDP 请求，查询其是否含有&nbsp;<strong class=\"js_darkmode__162\">UUID 为&nbsp;<code class=\"js_darkmode__163\">0x1101</code></strong>&nbsp;的服务。<strong class=\"js_darkmode__164\">从设备</strong>返回其对应的&nbsp;<strong class=\"js_darkmode__165\">RFCOMM 通道号</strong>。</p>\n<p class=\"js_darkmode__166\"><strong class=\"js_darkmode__167\">（C）链路建立</strong>&nbsp;(Connection)： 主设备发起 RFCOMM 连接请求，指定通道号。此时，底层会依次建立 ACL 链路和 L2CAP 通道。</p>\n<p class=\"js_darkmode__168\"><strong class=\"js_darkmode__169\">（D）数据传输</strong>(Data Exchange)：一旦 RFCOMM 通道打开，两端就可以像读写本地串口文件（如 Linux 下的&nbsp;<code class=\"js_darkmode__170\">/dev/rfcomm0</code>）一样发送原始字节流。</p>\n<h3 class=\"js_darkmode__171\"><span class=\"js_darkmode__172\">（4）SPP 与 BLE (GATT) 串口的区别</span></h3>\n<p class=\"js_darkmode__173\">在蓝牙 4.0 之后，存在两种实现串口的方式：</p>\n<section>\n<table>\n<thead>\n<tr>\n<th class=\"js_darkmode__174\">\n<section>特性</section>\n</th>\n<th class=\"js_darkmode__175\">\n<section>经典蓝牙 SPP</section>\n</th>\n<th class=\"js_darkmode__176\">\n<section>BLE 透传 (GATT)</section>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"js_darkmode__177\">\n<td class=\"js_darkmode__178\"><strong class=\"js_darkmode__179\">标准性</strong></td>\n<td class=\"js_darkmode__180\">\n<section>SIG 标准定义，通用性强</section>\n</td>\n<td class=\"js_darkmode__181\">\n<section>非 SIG 标准，各厂商自定义 UUID</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__182\">\n<td class=\"js_darkmode__183\"><strong class=\"js_darkmode__184\">数据量</strong></td>\n<td class=\"js_darkmode__185\">\n<section>适合大吞吐量、持续传输</section>\n</td>\n<td class=\"js_darkmode__186\">\n<section>适合小包、间歇性传输</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__187\">\n<td class=\"js_darkmode__188\"><strong class=\"js_darkmode__189\">功耗</strong></td>\n<td class=\"js_darkmode__190\">\n<section>较高</section>\n</td>\n<td class=\"js_darkmode__191\">\n<section>极低</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__192\">\n<td class=\"js_darkmode__193\"><strong class=\"js_darkmode__194\">系统支持</strong></td>\n<td class=\"js_darkmode__195\">\n<section>Android 支持，<strong class=\"js_darkmode__196\">iOS 不支持</strong>&nbsp;(需 MFi)</section>\n</td>\n<td class=\"js_darkmode__197\">\n<section>Android、iOS 均完美支持</section>\n</td>\n</tr>\n</tbody>\n</table>\n</section>\n<p class=\"js_darkmode__198\"><strong class=\"js_darkmode__199\">如果你的产品需要连接 iPhone，且不打算申请 Apple 的 MFi 认证，那么请务必选择 BLE 透传，而非 SPP。</strong></p>\n<h2 class=\"js_darkmode__200\"><span class=\"js_darkmode__201\">（三）文件传输（OBEX、OPP 与 FTP）</span></h2>\n<figure><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/555985/202601/555985-20260116164556592-1873649278.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></figure>\n<p class=\"js_darkmode__203\">OBEX (Object Exchange) 协议最初是由红外标准组织（IrDA）开发的，后来被蓝牙协议栈吸收。它的设计哲学与 HTTP 非常相似，采用了经典的<strong class=\"js_darkmode__204\">请求-响应</strong>模型。</p>\n<h3 class=\"js_darkmode__205\"><span class=\"js_darkmode__206\">（1）OPP (Object Push Profile)：轻量级推送</span></h3>\n<p class=\"js_darkmode__207\">OPP 是最基础的文件传输方式。它的核心特点是<strong class=\"js_darkmode__208\">无状态</strong>和<strong class=\"js_darkmode__209\">点对点直接推送</strong>。</p>\n<p class=\"js_darkmode__210\"><strong class=\"js_darkmode__211\">（A）核心逻辑</strong></p>\n<p class=\"js_darkmode__212\">在 OPP 中，Client（发送方）不需要知道 Server（接收方）的文件系统结构。它就像是把一张名片或一张照片<strong class=\"js_darkmode__213\">扔</strong>给对方，对方可以选择<strong class=\"js_darkmode__214\">接收</strong>或<strong class=\"js_darkmode__215\">拒绝</strong>。</p>\n<p class=\"js_darkmode__216\"><strong class=\"js_darkmode__217\">（B）交互流程</strong></p>\n<p class=\"js_darkmode__218\"><strong class=\"js_darkmode__219\">SDP 查询</strong>：Client 查找 UUID 为&nbsp;<code class=\"js_darkmode__220\">0x1105</code>&nbsp;的服务。</p>\n<p class=\"js_darkmode__221\"><strong class=\"js_darkmode__222\">OBEX 连接</strong>：建立临时会话。</p>\n<p class=\"js_darkmode__223\"><strong class=\"js_darkmode__224\">PUT 操作</strong>：</p>\n<ul class=\"list-paddingleft-1 js_darkmode__225\">\n<li>\n<section class=\"js_darkmode__226\">Client 发送&nbsp;<code class=\"js_darkmode__227\">PUT</code>&nbsp;请求，头部携带&nbsp;<code class=\"js_darkmode__228\">Name</code>&nbsp;和&nbsp;<code class=\"js_darkmode__229\">Length</code>。</section>\n</li>\n<li>\n<section class=\"js_darkmode__230\">Server 弹出提示框。</section>\n</li>\n<li>\n<section class=\"js_darkmode__231\">如果用户点击同意，Server 返回&nbsp;<code class=\"js_darkmode__232\">Continue (0x90)</code>，Client 开始分段发送&nbsp;<code class=\"js_darkmode__233\">Body</code>。</section>\n</li>\n</ul>\n<p class=\"js_darkmode__234\"><strong class=\"js_darkmode__235\">断开</strong>：传输完成，连接立即释放。</p>\n<p class=\"js_darkmode__236\"><strong class=\"js_darkmode__237\">主要应用场景有</strong>：两台手机通过蓝牙分享一张联系人名片（vCard）或一张图片。</p>\n<h3 class=\"js_darkmode__238\"><span class=\"js_darkmode__239\">（2）FTP (File Transfer Profile)：全功能文件管理器</span></h3>\n<p class=\"js_darkmode__240\">虽然名字也叫 FTP，但它和互联网上的 FTP 协议不同，它是&nbsp;<strong class=\"js_darkmode__241\">OBEX 上的 FTP</strong>。相比 OPP，它提供了完整的远程文件系统访问权限。</p>\n<p class=\"js_darkmode__242\"><strong class=\"js_darkmode__243\">（A）核心功能</strong></p>\n<p class=\"js_darkmode__244\">核心功能有：<strong class=\"js_darkmode__245\">浏览目录、路径切换、多文件操作</strong></p>\n<ul class=\"list-paddingleft-1 js_darkmode__246\">\n<li>\n<section class=\"js_darkmode__247\"><strong class=\"js_darkmode__248\">浏览目录</strong>：Client 可以请求 Server 的文件夹列表。</section>\n</li>\n<li>\n<section class=\"js_darkmode__249\"><strong class=\"js_darkmode__250\">路径切换</strong>：使用&nbsp;<code class=\"js_darkmode__251\">SetPath</code>&nbsp;操作在文件夹间跳转。</section>\n</li>\n<li>\n<section class=\"js_darkmode__252\"><strong class=\"js_darkmode__253\">多文件操作</strong>：支持连续的&nbsp;<code class=\"js_darkmode__254\">GET</code>（下载）或&nbsp;<code class=\"js_darkmode__255\">DELETE</code>（删除）。</section>\n</li>\n</ul>\n<p class=\"js_darkmode__256\"><strong class=\"js_darkmode__257\">（B）关键点：Folder Listing Object</strong></p>\n<p class=\"js_darkmode__258\">当 Client 想要查看 Server 端的文件夹时，Server 会返回一个特殊的&nbsp;<strong class=\"js_darkmode__259\">XML 对象</strong>。这个 XML 描述了当前目录下所有的文件和子文件夹信息。</p>\n<pre class=\"js_darkmode__260 highlighter-hljs\"><code>&lt;folder-listingversion=\"1.0\"&gt;\n&lt;parent-folder/&gt;\n&lt;filename=\"report.pdf\"size=\"102400\"modified=\"20231027T103000Z\"/&gt;\n&lt;foldername=\"Photos\"/&gt;\n&lt;/folder-listing&gt;`</code></pre>\n<p class=\"js_darkmode__263\"><strong class=\"js_darkmode__264\">（C）OPP 与 FTP 对比</strong></p>\n<section>\n<table>\n<thead>\n<tr>\n<th class=\"js_darkmode__265\">\n<section>特性</section>\n</th>\n<th class=\"js_darkmode__266\">\n<section>OPP (Object Push)</section>\n</th>\n<th class=\"js_darkmode__267\">\n<section>FTP (File Transfer)</section>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"js_darkmode__268\">\n<td class=\"js_darkmode__269\"><strong class=\"js_darkmode__270\">UUID</strong></td>\n<td class=\"js_darkmode__271\"><code>0x1105</code></td>\n<td class=\"js_darkmode__272\"><code>0x1106</code></td>\n</tr>\n<tr class=\"js_darkmode__273\">\n<td class=\"js_darkmode__274\"><strong class=\"js_darkmode__275\">控制力</strong></td>\n<td class=\"js_darkmode__276\">\n<section>只能发送/推送，无法查看对方文件</section>\n</td>\n<td class=\"js_darkmode__277\">\n<section>可以浏览、下载、删除、创建文件夹</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__278\">\n<td class=\"js_darkmode__279\"><strong class=\"js_darkmode__280\">交互复杂度</strong></td>\n<td class=\"js_darkmode__281\">\n<section>低（推完即断）</section>\n</td>\n<td class=\"js_darkmode__282\">\n<section>高（需要维持会话进行多次操作）</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__283\">\n<td class=\"js_darkmode__284\"><strong class=\"js_darkmode__285\">安全性</strong></td>\n<td class=\"js_darkmode__286\">\n<section>每次推送通常需要手动确认</section>\n</td>\n<td class=\"js_darkmode__287\">\n<section>建立连接时一次性鉴权，后续操作更自由</section>\n</td>\n</tr>\n<tr class=\"js_darkmode__288\">\n<td class=\"js_darkmode__289\"><strong class=\"js_darkmode__290\">典型案例</strong></td>\n<td class=\"js_darkmode__291\">\n<section>手机互发一张照片</section>\n</td>\n<td class=\"js_darkmode__292\">\n<section>电脑管理嵌入式设备的日志文件夹</section>\n</td>\n</tr>\n</tbody>\n</table>\n</section>\n<h3 class=\"js_darkmode__293\"><span class=\"js_darkmode__294\">（3）OBEX 的扩展</span></h3>\n<p class=\"js_darkmode__295\">在蓝牙协议栈中，有不少重要的&nbsp;<code class=\"js_darkmode__296\">Profile</code>&nbsp;都是 OBEX 的的变种</p>\n<ul class=\"list-paddingleft-1 js_darkmode__297\">\n<li>\n<section class=\"js_darkmode__298\">\n<p class=\"js_darkmode__299\"><strong class=\"js_darkmode__300\">PBAP</strong>&nbsp;(Phone Book Access)：把电话本看作一个文件进行 GET。</p>\n</section>\n</li>\n<li>\n<section class=\"js_darkmode__301\">\n<p class=\"js_darkmode__302\"><strong class=\"js_darkmode__303\">MAP</strong>&nbsp;(Message Access)：把短信/邮件看作对象进行操作。</p>\n</section>\n</li>\n</ul>\n<h2 class=\"js_darkmode__304\"><span class=\"js_darkmode__305\">（四）蓝牙通话控制（HSP 与 HFP）</span></h2>\n<figure><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/555985/202601/555985-20260116164612241-1403934620.png\" style=\"display: block; margin-left: auto; margin-right: auto;\" /></figure>\n<h3 class=\"js_darkmode__307\"><span class=\"js_darkmode__308\">（1）核心角色定义</span></h3>\n<p class=\"js_darkmode__309\">在通话协议中，蓝牙定义了两个核心角色：</p>\n<p class=\"js_darkmode__310\"><strong class=\"js_darkmode__311\">AG</strong>&nbsp;(Audio Gateway)：音频网关。通常指<strong class=\"js_darkmode__312\">手机</strong>。它是音频数据的来源，也是连接移动网络的网关。</p>\n<p class=\"js_darkmode__313\"><strong class=\"js_darkmode__314\">HF</strong>&nbsp;(Hands-Free) / HS (Headset)：免提端/耳机端。通常指<strong class=\"js_darkmode__315\">蓝牙耳机、车载中控</strong>。它作为 AG 的远程控制器和音频 IO 设备。</p>\n<h3 class=\"js_darkmode__316\"><span class=\"js_darkmode__317\">（2）HSP (Headset Profile) ：简约的先驱</span></h3>\n<p class=\"js_darkmode__318\">HSP 是最早的通话协议，它只提供了最基本的功能：<strong class=\"js_darkmode__319\">耳机作为手机的音频输入/输出设备，并能进行简单的控制</strong>。</p>\n<ul class=\"list-paddingleft-1 js_darkmode__320\">\n<li>\n<section class=\"js_darkmode__321\"><strong class=\"js_darkmode__322\">功能子集</strong>：接听电话、挂断电话、调节音量。</section>\n</li>\n<li>\n<section class=\"js_darkmode__323\"><strong class=\"js_darkmode__324\">控制机制</strong>：基于&nbsp;<strong class=\"js_darkmode__325\">RFCOMM</strong>&nbsp;传输极简的 AT 指令。</section>\n</li>\n<li>\n<section class=\"js_darkmode__326\"><strong class=\"js_darkmode__327\">局限性</strong>：它不支持查看来电号码、不支持拒接（只能接听后再挂断）、不支持三方通话。</section>\n</li>\n</ul>\n<p class=\"js_darkmode__328\">目前的现状就是：现代蓝牙设备中，HSP 几乎已经被 HFP 完全取代，仅作为协议兼容性的最低保障存在。</p>\n<h3 class=\"js_darkmode__329\"><span class=\"js_darkmode__330\">（3）HFP (Hands-Free Profile) ：现代通话的标准</span></h3>\n<p class=\"js_darkmode__331\">HFP 是目前 TWS 耳机和车载系统的标配。它在 HSP 的基础上进行了巨大的功能扩充，目前主流版本为&nbsp;<strong class=\"js_darkmode__332\">v1.7</strong>&nbsp;或&nbsp;<strong class=\"js_darkmode__333\">v1.8</strong>。</p>\n<p class=\"js_darkmode__334\"><strong class=\"js_darkmode__335\">（A）协议栈架构</strong></p>\n<p class=\"js_darkmode__336\">HFP 的实现依赖于两条完全并行的链路：</p>\n<p class=\"js_darkmode__337\"><strong class=\"js_darkmode__338\">控制链路</strong>&nbsp;(Control Plane)：运行在&nbsp;<strong class=\"js_darkmode__339\">RFCOMM</strong>&nbsp;之上。用于传输 AT 指令，负责拨号、同步联系人、电量显示、通话状态切换等。</p>\n<p class=\"js_darkmode__340\"><strong class=\"js_darkmode__341\">音频链路</strong>&nbsp;(User Plane)：运行在基带层（Baseband）之上，使用&nbsp;<strong class=\"js_darkmode__342\">SCO (Synchronous Connection Oriented)</strong>&nbsp;或&nbsp;<strong class=\"js_darkmode__343\">eSCO</strong>&nbsp;链路。它绕过了 L2CAP，直接传输同步语音数据，以保证极低的延迟。</p>\n<p class=\"js_darkmode__344\"><strong class=\"js_darkmode__345\">（B）HFP 的关键技术流程</strong></p>\n<p class=\"js_darkmode__346\">要实现一次完美的蓝牙通话，必须经过以下三个关键步骤：</p>\n<p class=\"js_darkmode__347\"><strong class=\"js_darkmode__348\">（1）服务级连接建立 (SLC - Service Level Connection)</strong></p>\n<p class=\"js_darkmode__349\">当耳机连接上手机后，双方会先在 RFCOMM 上进行一系列<strong class=\"js_darkmode__350\">暗号</strong>对接，确认彼此支持的功能：</p>\n<p class=\"js_darkmode__351\"><strong class=\"js_darkmode__352\">特性协商</strong>：HF 发送&nbsp;<code class=\"js_darkmode__353\">AT+BRSF</code>（Bluetooth Retrieve Supported Features），告诉手机“我支持降噪、支持电量显示”。</p>\n<p class=\"js_darkmode__354\"><strong class=\"js_darkmode__355\">指标更新</strong>：通过&nbsp;<code class=\"js_darkmode__356\">AT+CIND</code>&nbsp;获取手机当前的信号强度、电量、漫游状态。</p>\n<p class=\"js_darkmode__357\"><strong class=\"js_darkmode__358\">事件报告</strong>：通过&nbsp;<code class=\"js_darkmode__359\">AT+CMER</code>&nbsp;开启事件通知，这样手机有来电时才会主动推送&nbsp;<code class=\"js_darkmode__360\">RING</code>。</p>\n<p class=\"js_darkmode__361\"><strong class=\"js_darkmode__362\">（2） 语音链路的建立 (SCO vs eSCO)</strong></p>\n<p class=\"js_darkmode__363\">这是决定通话音质的关键：</p>\n<p class=\"js_darkmode__364\"><strong class=\"js_darkmode__365\">SCO</strong>：传统的语音链路，带宽固定为 64kbps，通常使用&nbsp;<strong class=\"js_darkmode__366\">CVSD</strong>&nbsp;编码。音质类似于老式座机（采样率 8kHz）。</p>\n<p class=\"js_darkmode__367\"><strong class=\"js_darkmode__368\">eSCO</strong>&nbsp;(Extended SCO)：HFP 1.5+ 引入。支持数据重传，抗干扰能力更强。</p>\n<p class=\"js_darkmode__369\"><strong class=\"js_darkmode__370\">宽带语音</strong>&nbsp;(Wideband Speech)：HFP 1.6+ 引入，使用&nbsp;<strong class=\"js_darkmode__371\">mSBC</strong>&nbsp;编码，采样率提升至&nbsp;<strong class=\"js_darkmode__372\">16kHz</strong>（高清通话），这是目前大多数蓝牙耳机“通话清晰”的技术支撑。</p>\n<p class=\"js_darkmode__373\"><strong class=\"js_darkmode__374\">（3）典型通话信令示例</strong></p>\n<p class=\"js_darkmode__375\">当一个电话打入时，RFCOMM 上的 AT 指令流如下：</p>\n<pre class=\"js_darkmode__376 highlighter-hljs\"><code>AG -&gt; HF: `RING`（振铃）\nAG -&gt; HF: `+CLIP:&nbsp;\"13800138000\",129`（来电显示号码）\nHF -&gt; AG: `ATA`（用户按下耳机键，Answer）\nAG -&gt; HF: `OK`（手机响应，通话接通）\n后续: 建立 eSCO 语音链路，声音开始传输。</code></pre>\n<p class=\"js_darkmode__379\"><strong class=\"js_darkmode__380\">（C） HFP 特有的高级功能</strong></p>\n<p class=\"js_darkmode__381\"><strong class=\"js_darkmode__382\">三方通话</strong>&nbsp;(Three-Way Calling)：支持保持当前通话并接听等待中的第二个来电。</p>\n<p class=\"js_darkmode__383\"><strong class=\"js_darkmode__384\">语音拨号</strong>&nbsp;(Voice Recognition)：通过&nbsp;<code class=\"js_darkmode__385\">AT+BVRA</code>&nbsp;唤醒手机端的 Siri 或小爱同学。</p>\n<p class=\"js_darkmode__386\"><strong class=\"js_darkmode__387\">电量上报</strong>：通过特定的厂商自定义指令（如 Apple 的&nbsp;<code class=\"js_darkmode__388\">AT+IPHONEACCEV</code>）或标准指令在手机右上角显示耳机电量。</p>\n<h2 class=\"js_darkmode__389\"><span class=\"js_darkmode__390\">结尾</span></h2>\n<p class=\"js_darkmode__391\">这里我们简单地介绍了一下蓝牙的串口、文件传输和通话控制应用，下一章我们将详细地分析介绍蓝牙鼠标的工作原理。</p>\n<center>------------------End------------------</center><center>如需获取更多内容</center><center>请关注<span style=\"color: rgba(0, 0, 255, 1); font-size: large;\">&nbsp;liwen01&nbsp;</span>公众号</center>\n<section class=\"mp_profile_iframe_wrp\">\n<div>\n<div class=\"appmsg_card_context wx_profile_card wx-root wx_tap_card wx_card_root common-webchat\" tabindex=\"0\">\n<div class=\"wx_profile_card_inner\">\n<div class=\"wx_profile_card_bd\">\n<div class=\"wx_profile weui-flex\">\n<div class=\"wx_profile_bd weui-flex weui-flex__item\">\n<div class=\"weui-flex__item\">\n<div class=\"wx_profile_nickname_wrp\">&nbsp;</div>\n<div class=\"wx_profile_tips\" id=\"js_a11y_wx_profile_tips\"></div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</section>\n</section>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-27 12:16</span>&nbsp;\n<a href=\"https://www.cnblogs.com/liwen01\">liwen01</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "spring boot3--自动配置与手动配置",
      "link": "https://www.cnblogs.com/alineverstop/p/19537574",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/alineverstop/p/19537574\" id=\"cb_post_title_url\" title=\"发布于 2026-01-27 11:50\">\n    <span>spring boot3--自动配置与手动配置</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"springboot自动配置\">springboot自动配置</h1>\n<p>自动配置了大量组件，配置信息可以在application.properties文件中修改。</p>\n<p>当添加了特定的Starter POM后，springboot会根据类路径上的jar包来自动配置bean（比如：springboot发现类路径上的MyBatis相关类，springboot会自动配置MyBatis相关的bean）。</p>\n<p>springboot使用默认配置来设置这些功能，开发人员也可以自定义配置来覆盖默认配置。</p>\n<h2 id=\"这些配置信息如何生效的\">这些配置信息如何生效的？</h2>\n<p>通过@ConfigurationProperties注解将配置信息注入到组件中的属性类的。属性类一般以Properties结尾。比如tomcat组件的ServerProperties类，就是将配置信息中server开头的配置注入到属性中，比如server.port=8080会被绑定到属性中</p>\n<pre><code class=\"language-java\">@ConfigurationProperties(\"server\")\npublic class ServerProperties {\n    private @Nullable Integer port;\n    private @Nullable InetAddress address;\n  .....\n}\n</code></pre>\n<h2 id=\"自动配置是按需加载的\">自动配置是按需加载的</h2>\n<p>springboot提供很多自动配置类，这些自动配置不是全部生效，它是按需加载的，导入了哪个启动器，则该启动器对应的配置类才会被加载。</p>\n<p>任何启动器都会关联一个启动器：spring-boot-Starter，它是springboot框架最核心的启动器。</p>\n<p>spring-boot-Starter又关联引入spring-boot-auto从figure。所有的自动配置类都在这里。</p>\n<p>自动配置类用来创建相应的组件。</p>\n<h2 id=\"按需加载如何实现\">按需加载如何实现？</h2>\n<p>使用条件注解可以实现按需加载。</p>\n<p>条件注解基于某些条件决定是否应该创建一个bean。这些注解通常用在自动配置类上，以确保只有在特定条件满足时才会应用相应的配置。</p>\n<p>条件注解可以用在类上，也可以用在方法上。</p>\n<p>常见的条件注解有：</p>\n<ul>\n<li>@ConditionalOnClass 指定类存在时才创建bean</li>\n<li>@ConditionalOnMissingClass 指定类不存在时才创建bean</li>\n<li>@ConditionalOnBean 容器中存在指定bean时才创建bean</li>\n<li>@ConditionalOnMissingBean 容器中不存在指定bean时才创建bean</li>\n<li>@ConditionalOnProperty 配置文件中存在指定属性时，才创建bean</li>\n<li>@ConditionalOnResource 指定资源存在时才创建bean</li>\n<li>@ConditionalOnWebApplication 应用程序是Web应用时才创建bean</li>\n<li>@ConditionalOnNotWebApplication 应用程序不是Web应用时才创建bean</li>\n</ul>\n<h2 id=\"修改默认的包扫描规则\">修改默认的包扫描规则</h2>\n<p>修改扫描规则有2种方式：</p>\n<p>在主入口类上添加以下注解的任意一个都可以修改包扫描规则（扫描com包及其子孙包）</p>\n<ol>\n<li>\n<pre><code class=\"language-java\">@ComponentScan(\"com\")\n</code></pre>\n</li>\n<li>\n<pre><code class=\"language-java\">@SpringBootApplication(scanBasePackages = \"com\")\n</code></pre>\n</li>\n</ol>\n<h1 id=\"自动配置的实现原理\">自动配置的实现原理</h1>\n<ol>\n<li>\n<p>程序从main方法开始执行，主入口类上使用@SpringBootApplication进行标注</p>\n</li>\n<li>\n<p>@SpringBootApplication是复合注解，代表以下三个注解的功能</p>\n<p>a. @SpringBootConfiguration:它被@Configuration标注。表明主入口类是一个配置类，此时该配置开始加载。</p>\n<p>b. @ComponentScan 默认扫描主入口类所在包及其子孙包，因此spring-boot-autoconfigure 自动配置类是无法加载的，那么这些自动配置类又是怎么生效的呢？</p>\n<p>c. <strong>@EnableAutoConfiguration 该注解的作用就是启用自动配置</strong></p>\n</li>\n<li>\n<p>@EnableAutoConfiguration  被@Import({AutoConfigurationImportSelector.class})标注</p>\n</li>\n</ol>\n<p>​        @Import({AutoConfigurationImportSelector.class})的作用是将AutoConfigurationImportSelector作为一个bean加载到Ioc容器中</p>\n<p>​        这个bean的作用是：负责收集和选择所有符合条件的自动配置类。</p>\n<h2 id=\"总结\">总结</h2>\n<ol>\n<li>运行环境准备阶段\n<ul>\n<li>引入Web启动器</li>\n<li>最终传递引入了自动配置的jar包</li>\n<li>自动配置的jar包中有152个自动配置类，到此运行环境准备完毕</li>\n</ul>\n</li>\n<li>运行阶段\n<ul>\n<li>@EnableAutoConfiguration  启用自动配置，将152个自动配置类全部加载到Ioc容器中。然后根据开发场景筛选出必须得自动配置类</li>\n<li>自动配置类加载了很多组件</li>\n<li>每个组件需要的数据来自属性类</li>\n<li>属性类的属性来自配置文件</li>\n</ul>\n</li>\n</ol>\n<p>总之一句话。导入启动器，修改配置文件。就可以完成对应功能的开发。</p>\n<h1 id=\"springmvc配置\">springmvc配置</h1>\n<pre><code class=\"language-properties\"># 让springboot的静态资源处理失效\nspring.web.resources.add-mappings=false\n# 配置静态资源的访问URL\nspring.mvc.static-path-pattern=/**\n#  静态资源文件存储位置默认配置\nspring.web.resources.static-locations=classpath:/META-INF/resources/, classpath:/resources/, classpath:/static/, classpath:/public/\n\n</code></pre>\n<p>springboot对静态资源是如何处理的？</p>\n<p>什么样的URL ？访问哪个位置上的资源文件？</p>\n<h2 id=\"webjars\">webjars</h2>\n<p>webjars是现在前后端分离中比较重要的一种静态资源打包方式。</p>\n<p>webjars是一种常用的前端库（如jQuery）打包成jar包的形式，方便在java程序中使用。</p>\n<p>webjars提供了一种标准化的方式来管理前端库，使其更容易集成到java项目中，并且可以利用Maven的依赖管理功能。</p>\n<pre><code class=\"language-xml\">&lt;!--        webjars,将前端库打成jar包--&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.webjars.npm&lt;/groupId&gt;\n            &lt;artifactId&gt;vue&lt;/artifactId&gt;\n            &lt;version&gt;3.5.12&lt;/version&gt;\n        &lt;/dependency&gt;\n</code></pre>\n<p>默认规则是：当请求路径是/wbjars/**,则会去classpath:/MEAT-INF/resources/webjars/找。</p>\n<h2 id=\"静态资源缓存处理\">静态资源缓存处理</h2>\n<p>静态资源缓存是指浏览器的缓存行为，浏览器可以缓存（js、CSS、图片、声音、视频）到浏览器中，下一次用户访问同样的资源就直接从缓存中获取，不再从服务器获取，这样能减少服务器压力，提高相应效率。</p>\n<p>可以通过配置来修改默认的缓存机制。</p>\n<pre><code class=\"language-properties\">＃静态资源缓存设置\n＃缓存有效期设置\nspring.web.resources.cache.period=3600\n# 缓存控制设置\nspring.web.resources.cache.cachecontrol.max-age=20\n# 是否启用最后一次修改时间的比对\nspring.web.resources.cache.use-last-modified=true\n</code></pre>\n<h2 id=\"静态indexhtml的支持\">静态index.html的支持</h2>\n<p>spring会自动处理位于静态资源目录下的index.html（文件名必须是index.html），使其成为应用程序的主页。</p>\n<p>注意：此时不能配置静态资源访问url（spring.mvc.static-path-pattern），必须使用默认的配置</p>\n<h2 id=\"faviconico\">favicon.ico</h2>\n<p>将favicon.ico放在静态资源根目录下，就会自动生效。</p>\n<h1 id=\"spring-boot的web手动配置静态资源处理\">spring boot的web手动配置（静态资源处理）</h1>\n<h2 id=\"编写代码的方式\">编写代码的方式</h2>\n<h3 id=\"第一种方式-实现webmvcconfigurer接口\">第一种方式 实现WebMvcConfigurer接口</h3>\n<pre><code class=\"language-java\">// 添加这个注解后，表示不再使用springboot提供的默认配置\n// @EnableWebMvc\n@Configuration\npublic class WebConfig implements WebMvcConfigurer {\n    \n    // 静态资源处理需要重写的方法\n    @Override\n    public void addResourceHandlers(ResourceHandlerRegistry registry) {\n        // 使用注册器registry 绑定 pathPatterns 以及真实的静态资源文件存储路径\n        registry.addResourceHandler(\"/abc/**\") // 配置路径访问模式\n                .addResourceLocations(\"classpath:/static1/\", \"classpath:/static2/\", \"classpath:/static3/\"); // 配置静态资源路径\n    }\n}\n</code></pre>\n<h3 id=\"第二种方式\">第二种方式</h3>\n<pre><code class=\"language-java\">@Configuration\npublic class WebConfig2 {\n\n    @Bean\n    public WebMvcConfigurer addResourceHandlers() {\n        return new WebMvcConfigurer() {\n            @Override\n            public void addResourceHandlers(ResourceHandlerRegistry registry) {\n                registry.addResourceHandler(\"/abc/**\") // 配置路径访问模式\n                        .addResourceLocations(\"classpath:/static1/\", \"classpath:/static2/\", \"classpath:/static3/\"); // 配置静态资源路径\n            }\n        };\n    }\n}\n</code></pre>\n<h1 id=\"web请求的路径匹配\">web请求的路径匹配</h1>\n<pre><code class=\"language-properties\"># 前端请求的url 匹配到controller中的某个方法\n# 使用ant风格的路径匹配规则，默认值是path_pattern_matcher\n# path_pattern_matcher兼容且支持ant风格\n# 在ant风格中** 可以出现在任何位置，但在path_pattern_matcher风格中，** 只能出现在末尾\n# spring6 下的ant风格 ** 也只能出现在末尾\nspring.mvc.pathmatch.matching-strategy=ant_path_matcher\n</code></pre>\n\n</div>\n<div id=\"MySignature\">\n    <p>本文来自博客园，作者：<a href=\"https://www.cnblogs.com/alineverstop/\" target=\"_blank\">NE_STOP</a>，转载请注明原文链接：<a href=\"https://www.cnblogs.com/alineverstop/p/19537574\" target=\"_blank\">https://www.cnblogs.com/alineverstop/p/19537574</a></p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-27 11:50</span>&nbsp;\n<a href=\"https://www.cnblogs.com/alineverstop\">NE_STOP</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "Agent Skills 傻瓜式教程，26 年最火 AI 技术就这？",
      "link": "https://www.cnblogs.com/yupi/p/19537546",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/yupi/p/19537546\" id=\"cb_post_title_url\" title=\"发布于 2026-01-27 11:47\">\n    <span>Agent Skills 傻瓜式教程，26 年最火 AI 技术就这？</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        <img alt=\"Agent Skills 傻瓜式教程，26 年最火 AI 技术就这？\" class=\"desc_img\" src=\"https://img2024.cnblogs.com/blog/2225420/202601/2225420-20260127105356424-1456834479.png\" />\n        Agent Skills 不仅仅是个技术概念，更是一种新的工作方式。你可以把它融入到自己的日常工作中，比如把重复的任务封装成技能、把团队的最佳实践固化成技能，让 AI 真正成为你的得力助手。\n    </div>\n<div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p class=\"md-end-block md-heading\"><span class=\"md-plain\">你是小阿巴，正在用 AI 开发网站。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">为了让 AI 生成的效果更好，你告诉 AI：</span></p>\n<ul class=\"ul-list\">\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">界面不要使用蓝紫渐变色</span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">不要生成一大堆没用的文档</span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你要遵循公司的代码规范</span></p>\n</li>\n</ul>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">阿巴阿巴，洋洋洒洒几百字。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">之后每次开发网站时，你都要写这么一段又臭又长的提示词，太麻烦了！</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">于是聪明的你开始想办法。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">先把常用的提示词保存到单独的文件（比如 <span class=\"md-pair-s\"><code>prompts.md</code><span class=\"md-plain\">），每次手动投喂给 AI。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">然后创建了资源文件夹，把公司的代码规范、设计素材都塞进去，告诉 AI 参考这些写。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">接着你还写了一些脚本，让 AI 生成代码后自动执行格式化、运行测试、提交代码到 Git。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">最后我再写个 <span class=\"md-pair-s\"><code>AGENTS.md</code><span class=\"md-plain\"> 文件，把所有规范和工作流程都写进去，让 AI 自动读取。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你沾沾自喜：嘿嘿，俺这套工作流，堪称完美！</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">但很快，你发现了问题，随着规范越写越多，文档越来越臃肿，每次对话都要占用很多 AI 上下文空间，浪费 tokens。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">于是你找到号称 “没有人比他更不懂 AI” 的鱼皮求助：阿巴阿巴，俺还能咋办啊……</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">鱼皮：不是有 Agent Skills 么？为啥不直接用？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你一脸懵：啥玩意儿？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">鱼皮：这可是最近 AI 圈儿爆火的技术，下面我来带你玩转 Agent Skills，让你知道它是什么、怎么用、有什么魔力、怎么自己开发。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">点个收藏，我们开始~</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">⭐️ 推荐观看视频动画版，更通俗易懂：<span class=\"md-meta-i-c  md-link\"><a href=\"https://www.bilibili.com/video/BV1T7zzBQEaA/\" rel=\"noopener nofollow\"><span class=\"md-plain\">https://bilibili.com/video/BV1T7zzBQEaA</span></a></span></span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">什么是 Agent Skills？</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">Agent Skills 是 Anthropic 推出的 <span class=\"md-meta-i-c  md-link\"><a href=\"https://platform.claude.com/docs/zh-CN/agents-and-tools/agent-skills/overview\" rel=\"noopener nofollow\"><span class=\"md-plain\">一套开放标准</span></a><span class=\"md-plain\">，目的是让 AI 能够学习使用各种专业技能，而不用每次都重复输入提示词。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">简单来说，它就是给 AI 装备的 <span class=\"md-pair-s \"><strong>技能包</strong><span class=\"md-plain\">。技能包里有精心设计的提示词、代码脚本、还有各种资源文件。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">把 AI 想象成一个职场小白，给他装上 <span class=\"md-pair-s\"><code>文档处理技能</code><span class=\"md-plain\">，它就立刻知道怎么生成 PPT、处理 Excel 表格；装上 <span class=\"md-pair-s\"><code>代码规范技能</code><span class=\"md-plain\">，它就知道怎么按照公司标准写代码。</span></span></span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你挠挠头：等等…… 这不就是俺在做的事吗？把教 AI 做事的文档和 AI 要用到的文件打包成文件夹？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">鱼皮：差不多，但 Anthropic 把它做成了一个通用标准，而且在实现原理上有一些新花样……</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你捶胸顿足：可恶啊，俺差点就改变世界了！这能有什么新花样？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">鱼皮：我先来带你用一下 Agent Skills，再跟你说说其中的奥秘。</span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">Agent Skills 入门实战</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">目前对 Agent Skills 支持最完善的工具是 Anthropic 官方的 <span class=\"md-meta-i-c  md-link\"><a href=\"https://claude.com/product/claude-code\" rel=\"noopener nofollow\"><span class=\"md-plain\">Claude Code</span></a><span class=\"md-plain\">，我们就以此为例，安装并使用 Skills。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<h3 class=\"md-end-block md-heading\"><span class=\"md-plain\">1、安装 Skills 技能</span></h3>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">先打开 Claude Code 并输入命令，添加官方技能市场：</span></p>\n<pre class=\"md-fences md-end-block ty-contain-cm modeLoaded\"><span>/plugin marketplace add anthropics/skills</span></pre>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">这就像是在你的 AI 助手里开通了一个技能商店，接下来你就可以从商店中获取技能了。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">在 Claude Code 中输入命令，安装官方提供的技能包：</span></p>\n<pre class=\"md-fences md-end-block ty-contain-cm modeLoaded\"><span>/plugin install example-skills@anthropic-agent-skills</span></pre>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">这个 example-skills 包含了一堆官方示例技能，包括前端设计、网页测试、动图制作等等。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">装完之后，你就可以直接让 AI 使用这些技能了。</span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h3 class=\"md-end-block md-heading\"><span class=\"md-plain\">2、前端设计技能</span></h3>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">比如你要做一个网站，以前没装技能的时候，AI 生成的代码又是那个熟悉的蓝紫渐变色，千篇一律的 AI 审美。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">现在安装了 frontend-design 这个 <span class=\"md-pair-s \"><strong>教 AI 生成专业设计感网站</strong><span class=\"md-plain\"> 的技能后，你输入：“帮我开发个人作品集网站”。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">AI 会主动问你：我发现你安装了前端设计技能，需要用它来生成更具设计感的页面吗？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">确认之后，AI 会利用技能生成代码，告别蓝紫渐变，生成独特风格的精美页面。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">我们不用每次都给 AI 输入一大堆相同的提示词，装一次技能就行了。</span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h3 class=\"md-end-block md-heading\"><span class=\"md-plain\">3、文档处理技能</span></h3>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">除了代码相关的技能，官方还提供了文档处理技能包。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">同样在 Claude Code 中输入一行命令安装：</span></p>\n<pre class=\"md-fences md-end-block ty-contain-cm modeLoaded\"><span>/plugin install document-skills@anthropic-agent-skills</span></pre>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">这个技能包里有 PPT 制作、Word 文档生成、Excel 数据分析、PDF 解析等技能。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">接下来如果你让 AI 做个 PPT，它会自动调用 PPT 制作技能，直接生成排版好的 PPT 文件，帮你节省几个小时。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">揭秘 Agent Skills 内部原理</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你好奇道：咦，为什么 Skills 能做到安装即用？技能包里面到底有啥？AI 又是怎么知道该用哪个技能的？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">鱼皮：好问题。<span class=\"md-meta-i-c  md-link\"><a href=\"https://agentskills.io/what-are-skills\" rel=\"noopener nofollow\"><span class=\"md-plain\">技能</span></a><span class=\"md-plain\"> 其实就是一个包含 <span class=\"md-pair-s\"><code>SKILL.md</code><span class=\"md-plain\"> 技能说明文件的文件夹，还可以包含可执行脚本、资源和参考文档。</span></span></span></span></span></p>\n<pre class=\"md-fences md-end-block ty-contain-cm modeLoaded\"><span>my-skill/<br /><span>├── SKILL.md &nbsp; &nbsp; &nbsp; &nbsp; # 必需：指令和元数据<br /><span>├── scripts/ &nbsp; &nbsp; &nbsp; &nbsp; # 可选：可执行脚本<br /><span>├── references/ &nbsp; &nbsp; &nbsp; # 可选：参考文档<br /><span>└── assets/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 可选：模板和资源</span></span></span></span></span></pre>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">由于每个技能的复杂度不同，结构也会存在区别。我们可以在本地目录中找到已安装的技能文件夹。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">以官方的 PPT 制作技能为例，它的结构是这样的：</span></p>\n<pre class=\"md-fences md-end-block ty-contain-cm modeLoaded\"><span>skills/pptx/<br /><span>├── SKILL.md &nbsp; &nbsp; &nbsp; &nbsp; # 技能说明书（必需）<br /><span>├── ooxml/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # OOXML 相关资源<br /><span>├── scripts/ &nbsp; &nbsp; &nbsp; &nbsp; # 处理脚本<br /><span>├── html2pptx.md &nbsp; &nbsp; # HTML 转 PPT 说明<br /><span>├── ooxml.md &nbsp; &nbsp; &nbsp; &nbsp; # OOXML 格式说明<br /><span>└── LICENSE.txt &nbsp; &nbsp; &nbsp; # 许可证</span></span></span></span></span></span></span></pre>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">包含一个核心的技能说明文档 <span class=\"md-pair-s\"><code>SKILL.md</code><span class=\"md-plain\">，还有脚本、参考文档和各种资源文件。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">而 frontend-design 前端设计技能只有一个 <span class=\"md-pair-s\"><code>SKILL.md</code><span class=\"md-plain\"> 文件。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-pair-s\"><code>SKILL.md</code><span class=\"md-plain\"> 文件是每个技能的核心，它包含两个关键部分。</span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">第一部分是 <span class=\"md-pair-s \"><strong>元数据</strong><span class=\"md-plain\">，用 YAML 格式写在文件开头：</span></span></span></p>\n<pre class=\"md-fences md-end-block ty-contain-cm modeLoaded\"><span><span class=\"cm-def\">---<br /><span><span class=\"cm-atom\">name<span class=\"cm-meta\">:&nbsp;frontend-design<br /><span><span class=\"cm-atom\">description<span class=\"cm-meta\">:&nbsp;生成具有专业设计感的前端代码，避免千篇一律的 AI 审美<br /><span><span class=\"cm-def\">---</span></span></span></span></span></span></span></span></span></span></pre>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">其中 <span class=\"md-pair-s\"><code>name</code><span class=\"md-plain\"> 是技能的名字。<span class=\"md-pair-s\"><code>description</code><span class=\"md-plain\"> 是技能的描述，告诉 AI 什么时候应该使用这个技能。描述写得越清晰，AI 就越容易在合适的时机调用它。</span></span></span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">第二部分是 <span class=\"md-pair-s \"><strong>指令内容</strong><span class=\"md-plain\">，就是一套经过精心设计的提示词，指导 AI 具体怎么做。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">以 <span class=\"md-meta-i-c  md-link\"><a href=\"https://github.com/anthropics/skills/blob/main/skills/frontend-design/SKILL.md\" rel=\"noopener nofollow\"><span class=\"md-plain\">frontend-design</span></a><span class=\"md-plain\"> 技能为例，它的指令内容包括：</span></span></span></p>\n<ul class=\"ul-list\">\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">设计思考：在写代码前，先分析产品目的、用户群体、技术约束，然后选择一个大胆的美学方向（极简、复古未来、工业风、有机自然、奢华精致等）</span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">前端美学指南：包括字体选择（避免 Arial、Inter 等烂大街字体，选择有个性的组合）、配色主题（主色调配鲜明点缀色）、动效设计、空间构成、背景和视觉细节</span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">避坑指南：明确禁止紫色渐变、系统字体、千篇一律的布局等 AI 审美陷阱</span></p>\n</li>\n</ul>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你挠了挠头：如果有多个 SKills，AI 怎么知道该用哪个技能呢？如果把每个技能说明文档都塞给 AI，不是很占用上下文么？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">鱼皮：这就要说到 <span class=\"md-pair-s \"><strong>渐进式披露（Progressive Disclosure）</strong><span class=\"md-plain\"> 这个核心机制了。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">当你让 AI 执行任务时，它会先扫描技能目录，但不会把所有内容都加载到上下文中。而是只读取每个技能的元数据（名字和描述），发现描述和任务相关，就知道该用这个技能了。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">然后才把完整的技能说明文档读进来，按照里面的指令执行：</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">并根据需要加载技能包中的其他资源：</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-pair-s \"><strong>用到哪个查哪个</strong><span class=\"md-plain\">，既精准匹配又节省上下文，这就是渐进式披露的精髓。</span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">所以 Agent Skills 的本质就是 <span class=\"md-pair-s \"><strong>把专业知识打包成一个文件夹，让 AI 按需读取并使用</strong><span class=\"md-plain\">。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">跨工具的 Agent Skills</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你问：除了 Claude Code 之外，其他 AI 工具支持 Agent Skills 么？俺平时用 Cursor 比较多……</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">鱼皮：当然能！<span class=\"md-meta-i-c  md-link\"><a href=\"https://agentskills.io/\" rel=\"noopener nofollow\"><span class=\"md-plain\">Agent Skills</span></a><span class=\"md-plain\"> 已经成为通用标准，Cursor、VS Code、Codex 等工具都支持。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">Skills 的社区也非常活跃，你可以在 <span class=\"md-meta-i-c  md-link\"><a href=\"https://www.claudeskill.site/zh/skills\" rel=\"noopener nofollow\"><span class=\"md-plain\">Claude Skills Hub 市场</span></a><span class=\"md-plain\">、开源的 <span class=\"md-meta-i-c  md-link\"><a href=\"https://github.com/ComposioHQ/awesome-claude-skills\" rel=\"noopener nofollow\"><span class=\"md-plain\">Awesome Claude Skills</span></a><span class=\"md-plain\"> 等地方找到很多现成的技能。</span></span></span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">比如有个叫 <span class=\"md-meta-i-c  md-link\"><a href=\"https://ui-ux-pro-max-skill.nextlevelbuilder.io/\" rel=\"noopener nofollow\"><span class=\"md-plain\">UI UX Pro MAX</span></a><span class=\"md-plain\"> 的技能特别火，专门用于提升 AI 的设计能力。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">用法很简单，首先按照 <span class=\"md-meta-i-c  md-link\"><a href=\"https://github.com/nextlevelbuilder/ui-ux-pro-max-skill\" rel=\"noopener nofollow\"><span class=\"md-plain\">开源仓库文档</span></a><span class=\"md-plain\"> 的指引，安装官方提供的命令行工具：</span></span></span></p>\n<pre class=\"md-fences md-end-block ty-contain-cm modeLoaded\"><span><span class=\"cm-builtin\">npm&nbsp;install&nbsp;<span class=\"cm-attribute\">-g&nbsp;uipro-cli</span></span></span></pre>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">然后进入到你的项目目录下，根据使用的 AI 工具执行对应的命令。比如我这里用 Cursor：</span></p>\n<pre class=\"md-fences md-end-block ty-contain-cm modeLoaded\"><span>uipro init&nbsp;<span class=\"cm-attribute\">--ai&nbsp;cursor</span></span></pre>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">它会自动把技能安装到 Cursor 的配置目录里。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">安装完成后，可以看到它的文件结构：</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">接下来，当你让 AI 开发一个网站时，可以使用斜杠命令手动触发技能，或者让 AI 自动识别技能。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">1）AI 会根据你的需求识别出产品类型和需要的页面类型</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">2）然后调用 <span class=\"md-pair-s\"><code>search.py</code><span class=\"md-plain\"> 搜索脚本，在 data 目录里进行多维度搜索，找到适合的配色、字体、布局风格</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">3）综合搜索结果，生成完整的设计方案（主色调、字体组合、间距规范等）</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">4）最后，再按照设计方案生成代码</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">这样一来，生成的界面既专业又有设计感。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">AI 不需要把所有规则都背下来，而是用到哪个查哪个，这就是 Agent Skills 的精髓。</span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">创建自己的 Agent Skills</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">用了很多别人的技能后，你产生了一个大胆的想法：俺能不能把公司的周报格式封装成一个技能？以后推荐给新来的同事，还能卖个几块钱，嘿嘿嘿~</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">鱼皮笑道：有点儿东西，你打算怎么做呢？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你会心一笑：当然是发挥程序员最擅长的事情 —— 复制粘贴！</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">俺先复制一个官方的技能包，修改目录名称为自己的。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">然后修改技能说明文档 <span class=\"md-pair-s\"><code>SKILL.md</code><span class=\"md-plain\"> 的元数据、指令内容这些关键部分。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">示例 <span class=\"md-pair-s\"><code>SKILL.md</code><span class=\"md-plain\"> 文件：</span></span></span></p>\n<pre class=\"md-fences md-end-block ty-contain-cm modeLoaded\"><span><span class=\"cm-hr\">---<br /><span>name: company-weekly-report<br /><span>description: 生成符合公司规范的项目周报，包含进度汇总、问题跟踪和下周计划<br /><span><span class=\"cm-hr\">---<br /><span><span>​<br /><span><span class=\" cm-header cm-header1\"># 公司周报生成技能<br /><span><span>​<br /><span>当用户要求生成周报时，请按以下步骤执行：<br /><span><span>​<br /><span><span class=\" cm-header cm-header2\">## 1. 收集信息<br /><span><span class=\"cm-block-start cm-variable-2\">-&nbsp;<span class=\"cm-variable-2\">询问本周完成的主要工作<br /><span><span class=\"cm-block-start cm-variable-2\">-&nbsp;<span class=\"cm-variable-2\">询问遇到的问题和解决方案<br /><span><span class=\"cm-block-start cm-variable-2\">-&nbsp;<span class=\"cm-variable-2\">询问下周计划<br /><span><span>​<br /><span><span class=\" cm-header cm-header2\">## 2. 格式规范<br /><span><span class=\"cm-block-start cm-variable-2\">-&nbsp;<span class=\"cm-variable-2\">使用公司蓝色主题<br /><span><span class=\"cm-block-start cm-variable-2\">-&nbsp;<span class=\"cm-variable-2\">标题使用微软雅黑加粗<br /><span><span class=\"cm-block-start cm-variable-2\">-&nbsp;<span class=\"cm-variable-2\">每个模块不超过 5 个要点<br /><span><span>​<br /><span><span class=\" cm-header cm-header2\">## 3. 输出格式<br /><span><span class=\"cm-block-start cm-variable-2\">-&nbsp;<span class=\"cm-variable-2\">默认输出 Markdown<br /><span><span class=\"cm-block-start cm-variable-2\">-&nbsp;<span class=\"cm-variable-2\">如需 PPT，调用 pptx 技能</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">最后，把公司的 Logo、PPT 模板、报告样例放在子文件夹里就行了。妈妈再也不用担心我的周报了~</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">鱼皮：不错不错，但其实有更简单规范的方法。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">在前面安装的 example-skills 官方示例技能包里，有一个叫 <span class=\"md-pair-s\"><code>Skill Creator</code><span class=\"md-plain\"> 的技能，专门用来帮你创建新技能。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你只需要跟 AI 说：“帮我创建一个专门生成公司周报的技能”</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">接下来 AI 会问你几个问题，一步一步回答就好：</span></p>\n<ul class=\"ul-list\">\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你希望周报包含哪些主要部分？</span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你希望周报以什么格式输出?</span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你通常会如何使用这个周报技能?</span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">希望周报的语言风格是什么?</span></p>\n</li>\n</ul>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">很快，一个完整的技能包就生成了，你会看到一个 <span class=\"md-pair-s\"><code>.skill</code><span class=\"md-plain\"> 为后缀的文件，本质上是一个 zip 压缩包。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你可以把它解压到你的个人技能目录（<span class=\"md-pair-s\"><code>~/.claude/skills/</code><span class=\"md-plain\">）下，你的所有项目都能用。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">如果你想让这个技能只在某个项目生效，可以把它放到项目的 <span class=\"md-pair-s\"><code>.claude/skills/</code><span class=\"md-plain\"> 目录下，并且利用 Git 同步给项目组其他成员。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">测试没问题后，你还可以把它开源到 GitHub，或者上传到 <span class=\"md-meta-i-c  md-link\"><a href=\"https://www.claudeskill.site/zh/skills\" rel=\"noopener nofollow\"><span class=\"md-plain\">Claude Skills Hub</span></a><span class=\"md-plain\"> 这样的社区平台，让所有用户都能用。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">Skills / MCP / 斜杠命令的区别</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你开心极了：原来开发一个 Skills 这么简单！但是，这玩意儿跟之前火爆的 MCP 和斜杠命令有啥区别？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">鱼皮：好问题！</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-pair-s \"><strong>MCP 就像给 AI 装上了 “手和眼睛”</strong><span class=\"md-plain\">，让 AI 能够连接外部工具和数据源，比如搜索网页、读取代码仓库、查询数据库。适合需要获取数据或操作外部系统的场景。</span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-pair-s \"><strong>而 Agent Skills 更像是给 AI 发了一本 “工作手册”</strong><span class=\"md-plain\">，把专业知识和工作流程打包起来，教 AI 在特定领域该怎么做。</span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">至于斜杠命令，它就像是快捷键，是需要你手动输入 <span class=\"md-pair-s\"><code>/command</code><span class=\"md-plain\"> 命令来触发的固定操作；而 Skills 的特点是 AI 可以自动识别该用什么技能，不需要你显式调用。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">对了，其实 MCP 和 Skills 是可以结合起来的。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">举个例子，如果你想让 AI 帮你发周报：</span></p>\n<ul class=\"ul-list\">\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">MCP 负责获取数据：从任务管理数据库拉取这周的任务列表</span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">Skills 负责加工数据：把获取到的原始数据整理成老板爱看的格式</span></p>\n</li>\n</ul>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">一个提供食材，一个提供配方。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">Agent Skills 凭什么大火？</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你看着技能文件夹的结构，突然怪叫一声：等等，俺突然意识到一个问题…… 这不就是我们程序员玩烂的 “封装、复用、模块化、懒加载” 那一套吗？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">写几个代码文件、打个包、发到网上，让其他程序员下载下来用，不是一回事儿么？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">为什么 Agent Skills 能突然让整个 AI 圈为之疯狂？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">鱼皮：好问题，从技术的角度来看，它并没有发明什么惊天动地的算法。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">在我看来，它能火主要是 2 个原因。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">第一，它是开放标准，封装一次技能包后就能在各种 AI 工具里复用，还能通过社区共享。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">更重要的是，Skills 能立刻让 AI 的工作更专业可靠，让普通人 “无感” 地享受技术带来的价值。以前想让 AI 变聪明，你得学提示词工程、配置各种工具链。现在只需要像装 APP 一样安装技能包，AI 就立刻变专业了。一项技术的成功，不在于它有多复杂，而在于它能让普通用户不关注技术细节的情况下，感受到技术的价值。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">结尾</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">你点点头：学会了学废了！降低门槛，才是技术走向大众的钥匙。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">鱼皮：没错，Agent Skills 不仅仅是个技术概念，更是一种新的工作方式。你可以把它融入到自己的日常工作中，比如把重复的任务封装成技能、把团队的最佳实践固化成技能，让 AI 真正成为你的得力助手。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">在这个 Vibe Coding 盛行的年代，技术的门槛正在崩塌，而想象力的边界正在无限扩张。你可以在我免费开源的<span class=\"md-meta-i-c  md-link\"><a href=\"https://github.com/liyupi/ai-guide\" rel=\"noopener nofollow\"><span class=\"md-plain\">《AI 编程零基础入门教程》</span></a><span class=\"md-plain\">中学到更多 AI 编程技巧，也欢迎关注我的账号，学习更多 AI 和编程的技巧。</span></span></span></p>\n<blockquote>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">开源指路：<span class=\"md-link md-pair-s\"><a href=\"https://github.com/liyupi/ai-guide\" rel=\"noopener nofollow\">https://github.com/liyupi/ai-guide</a></span></span></p>\n</blockquote>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\"><img class=\"lazyload\" /></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">那么问题来了，你最想让 AI 学会什么技能呢？</span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">更多编程学习资源</span></h2>\n<ul class=\"ul-list\">\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/course\" rel=\"noopener nofollow\"><span class=\"md-plain\">Java前端程序员必做项目实战教程+毕设网站</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/\" rel=\"noopener nofollow\"><span class=\"md-plain\">程序员免费编程学习交流社区（自学必备）</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/course/cv\" rel=\"noopener nofollow\"><span class=\"md-plain\">程序员保姆级求职写简历指南（找工作必备）</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.mianshiya.com/\" rel=\"noopener nofollow\"><span class=\"md-plain\">程序员免费面试刷题网站工具（找工作必备）</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640584449888772098\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新Java零基础入门学习路线 + Java教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640586673306091521\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新Python零基础入门学习路线 + Python教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640586014108303362\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新前端零基础入门学习路线 + 前端教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640586867363954689\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新数据结构和算法零基础入门学习路线 + 算法教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1644279832026075138\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新C++零基础入门学习路线、C++教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1641797333479903234\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新数据库零基础入门学习路线 + 数据库教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640589994284695553\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新Redis零基础入门学习路线 + Redis教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1641035880439271426\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新计算机基础入门学习路线 + 计算机基础教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1641366118197153793\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新小程序入门学习路线 + 小程序开发教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"http://sqlmother.yupi.icu/\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新SQL零基础入门学习路线 + SQL教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640586295529324545\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新Linux零基础入门学习路线 + Linux教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640588753362108417\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新Git/GitHub零基础入门学习路线 + Git教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640587909942099969\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新操作系统零基础入门学习路线 + 操作系统教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640588119619551233\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新计算机网络零基础入门学习路线 + 计算机网络教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640588392073150465\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新设计模式零基础入门学习路线 + 设计模式教程</span></a></span></p>\n</li>\n<li class=\"md-list-item md-focus-container\">\n<p class=\"md-end-block md-p md-focus\"><span class=\"md-meta-i-c md-link md-expand\"><a href=\"https://www.code-nav.cn/post/1640648711119892481\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新软件工程零基础入门学习路线 + 软件工程教程</span></a></span></p>\n</li>\n</ul>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-27 11:47</span>&nbsp;\n<a href=\"https://www.cnblogs.com/yupi\">程序员鱼皮</a>&nbsp;\n阅读(<span id=\"post_view_count\">12</span>)&nbsp;\n评论(<span id=\"post_comment_count\">1</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "基于 C# 和 Nuke 打造现代化构建系统的最佳实践",
      "link": "https://www.cnblogs.com/newbe36524/p/19536496",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/newbe36524/p/19536496\" id=\"cb_post_title_url\" title=\"发布于 2026-01-27 08:54\">\n    <span>基于 C# 和 Nuke 打造现代化构建系统的最佳实践</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"告别脚本地狱为什么我们选择用-c-打造现代化构建系统\">告别脚本地狱：为什么我们选择用 C# 打造现代化构建系统</h1>\n<blockquote>\n<p>揭秘 HagiCode 项目如何利用 Nuke 实现类型安全、跨平台且高度可扩展的自动化构建流程，彻底解决传统构建脚本的维护痛点。</p>\n</blockquote>\n\n<h2 id=\"背景\">背景</h2>\n<p>在软件开发的漫长旅途中，\"构建\"这个词往往让人又爱又恨。爱的是，一键点击，代码变成产品，那是程序员最迷人的时刻；恨的是，维护那一堆乱糟糟的构建脚本，简直是噩梦。</p>\n<p>在很多项目中，我们习惯了用 Python 写脚本，或者用 XML 配置文件（想象一下那段被 <code>&lt;property&gt;</code> 支配的恐惧）。但随着项目复杂度的提升，尤其是像 HagiCode 这样涉及前后端、多平台、多语言混合开发的项目，传统的构建方式开始显得力不从心。脚本逻辑分散、缺乏类型检查、IDE 支持弱……这些问题像一个个小坑，时不时就让开发团队绊个跟头。</p>\n<p>为了解决这些痛点，在 HagiCode 项目中，我们决定引入 <strong>Nuke</strong> —— 一个基于 C# 的现代化构建系统。它不仅仅是一个工具，更像是一种对构建流程的重新思考。今天，我们就来聊聊为什么选择它，以及它是如何让我们的开发体验\"起飞\"的。</p>\n<h2 id=\"关于-hagicode\">关于 HagiCode</h2>\n<blockquote>\n<p>嘿，介绍一下我们正在做的东西</p>\n</blockquote>\n<p>我们正在开发 <strong>HagiCode</strong> —— 一款 AI 驱动的代码智能助手，让开发体验变得更智能、更便捷、更有趣。</p>\n<p><strong>智能</strong> —— AI 全程辅助，从想法到代码，让编码效率提升数倍。<strong>便捷</strong> —— 多线程并发操作，充分利用资源，开发流程顺畅无阻。<strong>有趣</strong> —— 游戏化机制和成就系统，让编码不再枯燥，充满成就感。</p>\n<p>项目正在快速迭代中，如果你对技术写作、知识管理或者 AI 辅助开发感兴趣，欢迎来 <a href=\"https://github.com/HagiCode-org/site\" rel=\"noopener nofollow\" target=\"_blank\">GitHub</a> 看看～</p>\n<h2 id=\"核心剖析为什么是-nuke\">核心剖析：为什么是 Nuke？</h2>\n<p>你可能心里会犯嘀咕：\"哎呀，构建系统那么多，比如 Make、Gradle，甚至直接用 Shell 脚本不行吗？为啥非得整一个 C# 的？\"</p>\n<p>这其实是个好问题。Nuke 的核心魅力在于它把我们最熟悉的编程语言特性带进了构建脚本的世界。</p>\n<h3 id=\"1-将构建流程模块化target-的艺术\">1. 将构建流程模块化：Target 的艺术</h3>\n<p>Nuke 的设计理念非常清晰：<strong>一切皆为目标</strong>。</p>\n<p>在传统的脚本里，我们可能会写出几百行线性执行的代码，逻辑错综复杂。而在 Nuke 中，我们将构建流程分解为独立的 <code>Target</code>（目标）。每个目标只负责一件事，比如：</p>\n<ul>\n<li><code>Clean</code>: 清理输出目录</li>\n<li><code>Restore</code>: 还原依赖包</li>\n<li><code>Compile</code>: 编译代码</li>\n<li><code>Test</code>: 运行单元测试</li>\n</ul>\n<p>这种设计非常符合单一职责原则。就像搭积木一样，我们可以随意组合这些 Target。更重要的是，Nuke 允许我们定义 Target 之间的依赖关系。比如，你想要 <code>Test</code>，那系统会自动检查你是否先执行了 <code>Compile</code>；想要 <code>Compile</code>，自然得先 <code>Restore</code>。</p>\n<p>这种依赖关系图不仅让逻辑更清晰，还极大地提高了执行效率，Nuke 会自动分析最优执行路径。</p>\n<h3 id=\"2-类型安全告别拼写错误的噩梦\">2. 类型安全：告别拼写错误的噩梦</h3>\n<p>用过 Python 写构建脚本的朋友肯定遇到过这种尴尬：脚本跑了五分钟，最后报错说 <code>Confi.guration</code> 拼写错了，或者传了一个字符串给了一个本该是数字的参数。</p>\n<p>使用 C# 编写构建脚本最大的优势就是 <strong>类型安全</strong>。这意味着：</p>\n<ul>\n<li><strong>编译时检查</strong>：你在敲代码的时候，IDE 就会告诉你哪里错了，不用等到运行时才发现。</li>\n<li><strong>重构无忧</strong>：如果你想改个变量名或者方法名，IDE 的重构功能一键搞定，不用全局搜索替换提心吊胆。</li>\n<li><strong>智能提示</strong>：强大的 IntelliSense 会自动补全代码，你不需要去翻文档记那些生僻的 API。</li>\n</ul>\n<h3 id=\"3-跨平台统一的构建体验\">3. 跨平台：统一的构建体验</h3>\n<p>以前在 Windows 上写 <code>.bat</code>，在 Linux 上写 <code>.sh</code>，为了兼容两者，还得写个 Python 脚本。现在，只要是 .NET Core（现 .NET 5+）能跑的地方，Nuke 就能跑。</p>\n<p>这意味着无论团队成员是使用 Windows、Linux 还是 macOS，无论是用 Visual Studio、VS Code 还是 Rider，大家执行的都是同一套逻辑。这就极大地消除了\"在我机器上能跑\"这类环境差异导致的问题。</p>\n<h3 id=\"4-参数与配置管理\">4. 参数与配置管理</h3>\n<p>Nuke 提供了一套非常优雅的参数解析机制。你不需要手动去解析 <code>string[] args</code>，只需要定义一个属性，加上 <code>[Parameter]</code> 特性，Nuke 就会自动处理命令行参数和配置文件的映射。</p>\n<p>比如，我们可以轻松定义构建配置：</p>\n<pre><code class=\"language-csharp\">[Parameter(\"Configuration to build - Default is 'Debug'\")]\nreadonly Configuration BuildConfiguration = IsLocalBuild ? Configuration.Debug : Configuration.Release;\n\nTarget Compile =&gt; _ =&gt; _\n    .DependsOn(Restore)\n    .Executes(() =&gt;\n    {\n        // 在这里使用 BuildConfiguration，它是类型安全的\n        DotNetBuild(s =&gt; s\n            .SetConfiguration(BuildConfiguration)\n            .SetProjectFile(SolutionFile));\n    });\n</code></pre>\n<p>这种写法既直观又不容易出错。</p>\n<h2 id=\"实践指南如何在项目中落地\">实践指南：如何在项目中落地</h2>\n<p>空谈误国，实干兴邦。让我们看看在 HagiCode 项目中，具体是怎么落地这套方案的。</p>\n<h3 id=\"1-规划项目结构\">1. 规划项目结构</h3>\n<p>我们不想让构建脚本污染项目根目录，也不想搞得像某些 Java 项目那样目录结构深不见底。所以，我们将所有与 Nuke 相关的构建文件统一放置在 <code>nukeBuild/</code> 文件夹中。</p>\n<p>这样做的好处是：</p>\n<ul>\n<li>项目根目录保持清爽。</li>\n<li>构建逻辑内聚，方便管理。</li>\n<li>新成员加入时，一眼就能看到\"哦，这是构建相关的逻辑\"。</li>\n</ul>\n<h3 id=\"2-设计清晰的-target-依赖链\">2. 设计清晰的 Target 依赖链</h3>\n<p>在设计 Target 时，我们遵循了一个原则：<strong>原子化 + 依赖流</strong>。</p>\n<p>每个 Target 应该足够小，只做一件事。比如 <code>Clean</code> 就只管删文件，不要在里面顺便做打包。</p>\n<p>推荐的依赖流大概是这个样子的：</p>\n<p><code>Clean</code> -&gt; <code>Restore</code> -&gt; <code>Compile</code> -&gt; <code>Test</code> -&gt; <code>Pack</code></p>\n<p>当然，这不是绝对的。比如如果你只想跑个测试，不想打包，Nuke 允许你直接执行 <code>nuke Test</code>，它会自动处理好前置的 Restore 和 Compile 步骤。</p>\n<h3 id=\"3-完善的错误处理与日志\">3. 完善的错误处理与日志</h3>\n<p>构建脚本最怕的是什么？是报错信息不明确。比如构建失败了，日志只显示 \"Error: 1\"，这就让人很抓狂。</p>\n<p>在 Nuke 中，由于我们可以直接使用 C# 的异常处理机制，因此可以非常精确地捕获和报告错误。</p>\n<pre><code class=\"language-csharp\">Target Publish =&gt; _ =&gt; _\n    .DependsOn(Test)\n    .Executes(() =&gt;\n    {\n        try \n        {\n            // 尝试发布到 NuGet\n            DotNetNuGetPush(s =&gt; s\n                .SetTargetPath(ArtifactPath)\n                .SetSource(\"https://api.nuget.org/v3/index.json\")\n                .SetApiKey(ApiKey));\n        }\n        catch (Exception ex)\n        {\n            Log.Error($\"发布失败了，兄弟们检查一下 Key 对不对: {ex.Message}\");\n            throw; // 确保构建进程以非零退出码结束\n        }\n    });\n</code></pre>\n<h3 id=\"4-集成测试保障质量\">4. 集成测试保障质量</h3>\n<p>构建脚本本身也是代码，也需要测试。Nuke 允许我们为构建流程编写测试，确保当我们修改了构建逻辑后，不会破坏现有的发布流程。这在持续集成（CI）流水线中尤为重要。</p>\n<h2 id=\"总结\">总结</h2>\n<p>通过引入 Nuke，HagiCode 的构建流程变得前所未有的顺畅。它不仅仅是一个工具的替换，更是工程化思维的提升。</p>\n<p><strong>我们收获了什么？</strong></p>\n<ul>\n<li><strong>可维护性</strong>：代码即配置，逻辑清晰，新人也能快速上手。</li>\n<li><strong>稳定性</strong>：强类型检查减少了 90% 以上的低级错误。</li>\n<li><strong>一致性</strong>：跨平台的统一体验，消除了环境差异。</li>\n</ul>\n<p>如果说以前写构建脚本是\"在黑暗中摸索\"，那么使用 Nuke 就像是\"开着灯走夜路\"。如果你受够了维护那些难以调试的脚本语言，不妨试试把构建逻辑也搬到 C# 的世界里来，也许你会发现，原来构建也可以这么优雅。</p>\n<h2 id=\"参考资料\">参考资料</h2>\n<ul>\n<li><a href=\"https://nuke.build/\" rel=\"noopener nofollow\" target=\"_blank\">Nuke 官方文档</a></li>\n<li><a href=\"https://github.com/HagiCode-org/site\" rel=\"noopener nofollow\" target=\"_blank\">HagiCode 项目地址</a></li>\n<li><a href=\"https://learn.microsoft.com/en-us/archive/csharp-team/introducing-csharp-scripting\" rel=\"noopener nofollow\" target=\"_blank\">关于 C# Scripting 的更多细节</a></li>\n</ul>\n<hr />\n<p>感谢您的阅读,如果您觉得本文有用,快点击下方点赞按钮👍,让更多的人看到本文。</p>\n<p>本内容采用人工智能辅助协作,经本人审核,符合本人观点与立场。</p>\n<ul>\n<li><strong>本文作者:</strong> <a href=\"https://www.newbe.pro\" rel=\"noopener nofollow\" target=\"_blank\">newbe36524</a></li>\n<li><strong>本文链接:</strong> <a href=\"https://hagicode-org.github.io/site/blog/2026/01/26/modern-build-system-with-csharp-and-nuke\" rel=\"noopener nofollow\" target=\"_blank\">https://hagicode-org.github.io/site/blog/2026/01/26/modern-build-system-with-csharp-and-nuke</a></li>\n<li><strong>版权声明:</strong> 本博客所有文章除特别声明外,均采用 BY-NC-SA 许可协议。转载请注明出处!</li>\n</ul>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-27 08:54</span>&nbsp;\n<a href=\"https://www.cnblogs.com/newbe36524\">Newbe36524</a>&nbsp;\n阅读(<span id=\"post_view_count\">168</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "Sdcb Chats 1.10 私有化代码执行器部署教程",
      "link": "https://www.cnblogs.com/sdcb/p/19533814/chats-1-10-deploy",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/sdcb/p/19533814/chats-1-10-deploy\" id=\"cb_post_title_url\" title=\"发布于 2026-01-27 08:45\">\n    <span>Sdcb Chats 1.10 私有化代码执行器部署教程</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>之前我写了这篇博客<a href=\"https://www.cnblogs.com/sdcb/p/19528764/chats-1-10\" target=\"_blank\">《复刻 ChatGPT 高级数据分析！Sdcb Chats 1.10 重磅发布：能分析Excel、做PPT》</a>，向大家介绍了 Chats 1.10 最激动人心的新功能——内置代码执行器（Code Interpreter）。</p>\n<p>文章发出后，反响很热烈，但也有很多朋友在问：“这功能看着很强，但到底怎么部署及其配置啊？”</p>\n<p>回头看了一下前一篇文章，确实光顾着兴奋地介绍功能，把最关键的<strong>部署实操</strong>给略过了。为了让大家都能尽快用上这个“硬核”功能，今天特地补上这篇详细的保姆级部署配置文档。</p>\n<hr />\n<p>想要在 Chats 中使用“代码执行”功能，主要分两步走：</p>\n<ol>\n<li><strong>基础设施层</strong>：让 Chats 服务能连上 Docker Daemon（因为代码是在隔离的 Docker 容器中运行的）。</li>\n<li><strong>应用配置层</strong>：在 Chats 后台和前台开启相应的功能开关。</li>\n</ol>\n<h2 id=\"第一部分连接-docker-daemon\">第一部分：连接 Docker Daemon</h2>\n<p>Chats 的代码执行器原理是：当模型需要执行代码时，Chats 会动态创建一个一次性的 Docker 容器（沙箱），在里面运行代码并获取结果。因此，<strong>Chats 必须拥有管理 Docker 的权限</strong>。</p>\n<p>这里主要介绍两种最常见的场景：纯 Docker 环境（Linux 服务器）和 Windows 下的 Docker Desktop。</p>\n<h3 id=\"场景一linux-服务器--纯-docker-环境\">场景一：Linux 服务器 / 纯 Docker 环境</h3>\n<p>这是生产环境最常用的方式。你只需要将宿主机的 Docker Socket 挂载到 Chats 容器中即可。</p>\n<p><img alt=\"00-docker\" src=\"https://img2024.cnblogs.com/blog/233608/202601/233608-20260126155139396-122617623.avif\" /></p>\n<h4 id=\"1-docker-镜像说明\">1. Docker 镜像说明</h4>\n<p>Chats 的 Docker 镜像托管在 <code>sdcb/chats</code>，我们提供了完善的多架构支持：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: left;\">描述</th>\n<th style=\"text-align: left;\">Docker 镜像 Tag</th>\n<th style=\"text-align: left;\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\"><strong>Latest（推荐）</strong></td>\n<td style=\"text-align: left;\"><code>latest</code></td>\n<td style=\"text-align: left;\">包含最新稳定版功能，多架构支持</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\">指定完整版本</td>\n<td style=\"text-align: left;\"><code>{version}</code> (如 <code>1.10.0</code>)</td>\n<td style=\"text-align: left;\">生产环境推荐锁定版本</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\">指定主/次版本</td>\n<td style=\"text-align: left;\"><code>{major}</code> / <code>{major.minor}</code></td>\n<td style=\"text-align: left;\">如 <code>1</code>, <code>1.10</code>，自动更新到该系列最新版</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\">特定平台</td>\n<td style=\"text-align: left;\"><code>...-linux-x64</code> 等</td>\n<td style=\"text-align: left;\">仅在必须手动指定架构时使用</td>\n</tr>\n</tbody>\n</table>\n<p><strong>关于 Manifest (多架构支持)</strong>：<br />\n我们的 <code>latest</code> 和语义化版本标签（如 <code>1.10.0</code>）都是 <strong>Manifest List</strong>。这意味着你<strong>不需要</strong>手动区分 <code>linux-x64</code> 还是 <code>linux-arm64</code>。<br />\n无论你在 x64 的 Linux 服务器、ARM64 的树莓派，还是 Windows Server (Nano Server) 上执行 <code>docker pull sdcb/chats:latest</code>，Docker 都会自动检测并拉取最适合当前系统的镜像层。</p>\n<h4 id=\"2-启动配置\">2. 启动配置</h4>\n<p>由于 Docker Socket 默认属于 root 用户，为了避免权限问题（Permission Denied），建议显式指定 <code>--user 0:0</code> 以 root 身份运行容器。</p>\n<p>在启动 Chats 的 <code>docker run</code> 命令或 <code>docker-compose.yml</code> 中，添加 user 配置和挂载卷：</p>\n<pre><code class=\"language-bash\">-v /var/run/docker.sock:/var/run/docker.sock --user 0:0\n</code></pre>\n<p><strong>完整的 docker run 命令示例</strong>：</p>\n<pre><code class=\"language-bash\"># 创建数据目录并授权\nmkdir -p ./AppData &amp;&amp; chmod 755 ./AppData\n\n# 启动容器\ndocker run -d --restart unless-stopped --name sdcb-chats \\\n  -p 8080:8080 \\\n  -e DBType=sqlite \\\n  -e ConnectionStrings__ChatsDB=\"Data Source=./AppData/chats.db\" \\\n  -v ./AppData:/app/AppData \\\n  -v /var/run/docker.sock:/var/run/docker.sock --user 0:0 \\\n  sdcb/chats:latest\n</code></pre>\n<p><strong>示例 docker-compose.yml</strong>：</p>\n<pre><code class=\"language-yaml\">version: '3'\nservices:\n  chats:\n    image: sdcb/chats:latest\n    user: 0:0 # 关键：必须使用 root 用户才能访问 docker.sock\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock # 关键配置：挂载 Docker 守护进程\n      - ./data:/app/data\n    ports:\n      - \"8080:8080\"\n</code></pre>\n<h3 id=\"场景二windows-环境\">场景二：Windows 环境</h3>\n<p>在 Windows (使用 Docker Desktop) 上部署时，情况稍微特殊一点，取决于你是<strong>在 Docker 容器内运行 Chats</strong>，还是<strong>直接运行 Chats 的 Windows 可执行文件 (.exe)</strong>。</p>\n<h4 id=\"情况-achats-运行在-docker-容器内推荐\">情况 A：Chats 运行在 Docker 容器内（推荐）</h4>\n<p>如果你是通过 <code>docker run</code> 启动 Chats 的，那么恭喜你，配置方法其实和 Linux <strong>完全一样</strong>！</p>\n<p>Docker Desktop for Windows 做了很好的兼容，你只需要把 <code>/var/run/docker.sock</code> 挂载进去即可，<strong>不需要</strong>配置 npipe 或 TCP。</p>\n<p><strong>PowerShell 启动命令示例</strong>：</p>\n<pre><code class=\"language-powershell\">docker run -d -p 8080:8080 `\n  -v /var/run/docker.sock:/var/run/docker.sock `\n  -v ${PWD}/data:/app/data `\n  sdcb/chats:latest\n</code></pre>\n<h4 id=\"情况-bchats-作为原生可执行文件运行\">情况 B：Chats 作为原生可执行文件运行</h4>\n<p>如果你不习惯使用 Docker 部署应用，我们提供了基于预编译的原生可执行文件，<strong>无需安装任何运行时</strong>（如 .NET SDK/Runtime）即可直接运行，启动速度较快且内存占用低。</p>\n<p><strong>可执行文件列表</strong>：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: left;\">平台</th>\n<th style=\"text-align: left;\">文件名</th>\n<th style=\"text-align: left;\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\"><strong>Windows 64位</strong></td>\n<td style=\"text-align: left;\"><code>chats-win-x64.zip</code></td>\n<td style=\"text-align: left;\">推荐大多数 Windows 用户</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\">Linux 64位</td>\n<td style=\"text-align: left;\"><code>chats-linux-x64.zip</code></td>\n<td style=\"text-align: left;\">常见的 Linux 服务器 (glibc)</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\">Linux ARM64</td>\n<td style=\"text-align: left;\"><code>chats-linux-arm64.zip</code></td>\n<td style=\"text-align: left;\">树莓派、Mac M系列docker等</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\">Linux Musl</td>\n<td style=\"text-align: left;\"><code>chats-linux-musl-*.zip</code></td>\n<td style=\"text-align: left;\">适用于 Alpine 等轻量级发行版</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\">macOS</td>\n<td style=\"text-align: left;\"><code>chats-osx-*.zip</code></td>\n<td style=\"text-align: left;\">支持 x64 (Intel) 和 ARM64 (M系列芯片)</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\">通用包</td>\n<td style=\"text-align: left;\"><code>chats.zip</code></td>\n<td style=\"text-align: left;\"><strong>需安装 .NET 10</strong>，跨平台</td>\n</tr>\n</tbody>\n</table>\n<p>你可以从 <a href=\"https://github.com/sdcb/chats/blob/main/doc/zh-CN/downloads.md\" rel=\"noopener nofollow\" target=\"_blank\">下载指南文档</a> 页面获取下载地址。该文档详细列出了 GitHub Releases 及国内加速镜像的下载方式。</p>\n<p><strong>配置与启动</strong>：</p>\n<p>如果你下载了 <code>Chats.BE.exe</code> (Windows 版后端) 直接运行，而不是使用 Docker 镜像，那么你需要通过命令行参数指定 Windows 的<strong>命名管道 (Named Pipe)</strong> 来连接 Docker 引擎。</p>\n<ol>\n<li><strong>下载程序</strong>：下载并解压对应的 <code>chats-win-x64.zip</code>。</li>\n<li><strong>启动命令</strong>：使用 <code>--CodePod:DockerEndpoint</code> 参数指定 Docker 接入点。</li>\n</ol>\n<p><strong>PowerShell 启动命令示例</strong>：</p>\n<pre><code class=\"language-powershell\"># 启动后端程序，并指定 Docker 引擎地址\n.\\Chats.BE.exe --CodePod:DockerEndpoint npipe://./pipe/docker_engine\n</code></pre>\n<p>你也可以同时指定其它参数（如端口）：</p>\n<pre><code class=\"language-powershell\">.\\Chats.BE.exe --urls http://+:5000 --CodePod:DockerEndpoint npipe://./pipe/docker_engine\n</code></pre>\n<p>这样，原生运行的 Chats 也能顺利指挥 Docker Desktop 创建沙箱环境了。</p>\n<hr />\n<h2 id=\"第二部分在-chats-中启用功能\">第二部分：在 Chats 中启用功能</h2>\n<p>连上 Docker 只是打通了经脉，接下来还需要在 Chats 内部“解锁”这个技能。</p>\n<h3 id=\"1-后端配置模型设置\">1. 后端配置：模型设置</h3>\n<p>首先，我们要告诉 Chats，哪些模型允许使用这个能力。</p>\n<ol>\n<li>以管理员身份登录 Chats。</li>\n<li>进入<strong>后台管理</strong> -&gt; <strong>模型配置</strong>。</li>\n<li>展开你想要的模型提供商-&gt;模型密钥，然后编辑你想要使用的模型（例如deepseek-v3.2）。\n<ul>\n<li><strong>注意</strong>：任何支持 Tool Call (工具调用) 的模型 API 都可以，无论是 OpenAI 原生的 Chat Completions，还是Responses API/Messages API。</li>\n</ul>\n</li>\n<li>在功能列表中，找到并勾选 <strong>“代码执行 (Code Execution)”</strong>。<br />\n<img alt=\"\" src=\"https://img2024.cnblogs.com/blog/233608/202601/233608-20260126151714293-1229825697.avif\" /></li>\n</ol>\n<p><strong>⚠️ 特别注意：用户权限分配</strong></p>\n<p>很多第一次添加模型的朋友容易忽略这一点：<strong>启用功能后，必须明确授权给用户。</strong></p>\n<p>在模型编辑页面的底部，展开<strong>用户列表 (User Access)</strong>，确保<strong>给你自己的账号（或需要使用的用户）勾选上权限</strong>。如果不勾选，你在前台是看不到这个模型的，或者无法调用该功能。</p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/233608/202601/233608-20260126151715025-1987207460.avif\" /></p>\n<h3 id=\"2-前端配置开启会话开关\">2. 前端配置：开启会话开关</h3>\n<p>后端准备就绪后，最后一步是在聊天界面开启使用。</p>\n<ol>\n<li>回到<strong>聊天 (Chat)</strong> 界面。</li>\n<li>在顶部的模型配置栏（通常显示模型名称的地方），点击展开配置面板。</li>\n<li>找到 <strong>“代码执行”</strong> 开关，将其打开。</li>\n</ol>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/233608/202601/233608-20260126151715455-1639921351.avif\" /></p>\n<hr />\n<h2 id=\"效果演示\">效果演示</h2>\n<p>一切就绪！现在你可以像使用 ChatGPT 的高级数据分析一样，上传一个 Excel 文件，或者让它帮你画一张图表了。</p>\n<p>试试发送这样的指令：</p>\n<blockquote>\n<p>请帮我分析这个 Excel 文件：<a href=\"https://cv-public.sdcb.pub/2026/changsha_weather_2025.xlsx%EF%BC%8C%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB%E6%AF%8F%E6%9C%88%E5%B9%B3%E5%9D%87%E6%B0%94%E6%B8%A9%E5%92%8C%E9%99%8D%E6%B0%B4%E9%87%8F%E7%9A%84%E6%8A%A5%E5%91%8A%EF%BC%8C%E5%B9%B6%E9%99%84%E4%B8%8A%E5%9B%BE%E8%A1%A8\" rel=\"noopener nofollow\" target=\"_blank\">https://cv-public.sdcb.pub/2026/changsha_weather_2025.xlsx，生成一个包含每月平均气温和降水量的报告，并附上图表</a></p>\n</blockquote>\n<p>Chats 会自动创建一个隔离的 Docker 环境，编写 Python 代码，执行并把生成的图片直接贴在对话框里。</p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/233608/202601/233608-20260125102328487-114968639.avif\" /></p>\n<hr />\n<h2 id=\"安全性考量\">安全性考量</h2>\n<p>⚠️ <strong>重要提示</strong>：与模型 API 调用不同，代码执行功能目前<strong>不进行任何计费</strong>，仅通过全局配置做了一些基础限制。如果你打算将 Chats 开放给未经充分信任的用户使用（例如搭建类似 ChatGPT/Manus 的公开服务），务必认真配置以下安全策略，避免服务器资源被滥用甚至被攻击。</p>\n<h3 id=\"1-网络隔离\">1. 网络隔离</h3>\n<p>代码执行容器的默认网络模式为 <code>bridge</code>，这与 ChatGPT 的完全隔离沙箱不同——<strong>容器是可以联网的</strong>。</p>\n<p>这个设计是有意为之的，因为它带来了更强大的能力：</p>\n<ul>\n<li>AI 可以在容器内下载文件、调用外部 API、安装依赖包。</li>\n<li>甚至可以让 AI 创建多个 Docker 容器协同工作（比如一个跑 Web 应用、一个跑数据库），Chats 会在工具调用响应中返回容器的局域网 IP 地址，模型可以据此进行容器间通信。</li>\n</ul>\n<p>但这也意味着潜在风险：</p>\n<ul>\n<li>容器可以访问宿主机同一 Docker 网络内的其他服务（包括你的数据库、Redis 等）。</li>\n<li>恶意用户可能利用此能力进行内网扫描或攻击。</li>\n</ul>\n<p><strong>建议</strong>：</p>\n<ul>\n<li><strong>安全敏感环境</strong>：将 <code>CodeInterpreter:MaxAllowedNetworkMode</code> 设置为 <code>none</code>，完全禁止容器联网。</li>\n<li><strong>物理隔离</strong>：在一台独立的虚拟机或物理机上运行 Docker Daemon，Chats 通过 TCP 远程连接，从而实现网络层面的彻底隔离。</li>\n</ul>\n<h3 id=\"2-资源限制\">2. 资源限制</h3>\n<p>AI 可以创建任意数量的 Docker 会话（通过 <code>create_docker_session</code> 工具）。虽然空闲会话会在一定时间后自动清理，但仍存在以下风险：</p>\n<ul>\n<li><strong>算力滥用</strong>：恶意用户可能运行高负载任务，耗尽服务器 CPU/内存。</li>\n<li><strong>磁盘占用</strong>：AI 可能拉取不同版本的镜像，这些镜像<strong>不会自动清理</strong>，长期积累会占满磁盘。</li>\n</ul>\n<p>Chats 提供了细粒度的资源限制配置，<strong>强烈建议根据实际情况调整</strong>：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: left;\">配置项</th>\n<th style=\"text-align: left;\">默认值</th>\n<th style=\"text-align: left;\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\"><code>CodeInterpreter:DefaultResourceLimits:MemoryBytes</code></td>\n<td style=\"text-align: left;\"><code>2147483648</code> (2GB)</td>\n<td style=\"text-align: left;\">单个容器内存上限</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><code>CodeInterpreter:DefaultResourceLimits:CpuCores</code></td>\n<td style=\"text-align: left;\"><code>2.0</code></td>\n<td style=\"text-align: left;\">单个容器 CPU 核数</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><code>CodeInterpreter:DefaultResourceLimits:MaxProcesses</code></td>\n<td style=\"text-align: left;\"><code>200</code></td>\n<td style=\"text-align: left;\">单个容器最大进程数</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><code>CodeInterpreter:MaxResourceLimits:*</code></td>\n<td style=\"text-align: left;\"><code>null</code> (不限制)</td>\n<td style=\"text-align: left;\">硬上限，防止 AI 请求超额资源</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><code>CodeInterpreter:SessionIdleTimeoutSeconds</code></td>\n<td style=\"text-align: left;\"><code>1800</code> (30分钟)</td>\n<td style=\"text-align: left;\">空闲会话自动回收时间</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><code>CodeInterpreter:DefaultTimeoutSeconds</code></td>\n<td style=\"text-align: left;\"><code>300</code> (5分钟)</td>\n<td style=\"text-align: left;\">单次命令执行超时</td>\n</tr>\n</tbody>\n</table>\n<p>默认的 2 核 2GB 配置可以完成大多数日常任务（数据分析、图表生成、文档处理等）。如果你的场景需要更多资源（如视频处理、大规模计算），可以适当放宽；反之，如果是公开服务，建议收紧限制。</p>\n<h3 id=\"3-文件上传限制\">3. 文件上传限制</h3>\n<p>AI 执行代码后可以将生成的文件（artifacts）回传给用户。为防止滥用，Chats 也提供了相应限制：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: left;\">配置项</th>\n<th style=\"text-align: left;\">默认值</th>\n<th style=\"text-align: left;\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\"><code>CodeInterpreter:MaxArtifactsFilesToUpload</code></td>\n<td style=\"text-align: left;\"><code>50</code></td>\n<td style=\"text-align: left;\">每轮最多回传文件数</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><code>CodeInterpreter:MaxSingleUploadBytes</code></td>\n<td style=\"text-align: left;\"><code>157286400</code> (150MB)</td>\n<td style=\"text-align: left;\">单个文件最大大小</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><code>CodeInterpreter:MaxTotalUploadBytesPerTurn</code></td>\n<td style=\"text-align: left;\"><code>314572800</code> (300MB)</td>\n<td style=\"text-align: left;\">单轮总上传大小</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"4-其他建议\">4. 其他建议</h3>\n<ul>\n<li><strong>定期清理镜像</strong>：使用 <code>docker image prune</code> 或 <code>docker system prune</code> 定期清理未使用的镜像和悬挂资源。</li>\n<li><strong>监控与告警</strong>：对 Docker 宿主机的 CPU、内存、磁盘使用率设置监控告警。</li>\n<li><strong>用户权限管理</strong>：仅对信任的用户开放代码执行功能，在模型配置中谨慎分配权限。</li>\n</ul>\n<p>更多配置细节请参考：<a href=\"https://github.com/sdcb/chats/blob/main/doc/zh-CN/configuration.md\" rel=\"noopener nofollow\" target=\"_blank\">配置说明文档</a></p>\n<hr />\n<h2 id=\"结语\">结语</h2>\n<p>希望这篇文档能帮你顺利部署 Chats 1.10，体验完全私有化、可控的代码解释器功能。</p>\n<p>感谢阅读！喜欢的朋友请给我的 GitHub 项目一个 star：<br />\n<a href=\"https://github.com/sdcb/chats\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/sdcb/chats</a></p>\n<p>这是完整的更新日志，包含更多技术细节：<br />\n<a href=\"https://github.com/sdcb/chats/blob/main/doc/zh-CN/release-notes/README.md\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/sdcb/chats/blob/main/doc/zh-CN/release-notes/README.md</a></p>\n<p>有什么想法也欢迎在评论区留言交流，也欢迎加入我的新创建的微信群：</p>\n<p><img alt=\"\" src=\"https://io.starworks.cc:88/cv-public/2026/chats-wxg-qr.png\" /></p>\n<p>如果你更习惯用 QQ 的话，也可以加入 Chats QQ 群：<strong>498452653</strong>，我们一起探索更多 AI 技术硬核玩法。</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-27 08:45</span>&nbsp;\n<a href=\"https://www.cnblogs.com/sdcb\">.NET骚操作</a>&nbsp;\n阅读(<span id=\"post_view_count\">35</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "FastAPI异常处理全解析：别让你的API在用户面前“裸奔”",
      "link": "https://www.cnblogs.com/ymtianyu/p/19536459",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/ymtianyu/p/19536459\" id=\"cb_post_title_url\" title=\"发布于 2026-01-27 08:38\">\n    <span>FastAPI异常处理全解析：别让你的API在用户面前“裸奔”</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        本文系统解析了FastAPI中异常处理的核心技巧，涵盖HTTPException基础用法、自定义业务异常设计、全局异常处理器配置以及WebSocket异常处理。通过生动的比喻和实战代码，帮助你构建健壮、友好的API错误响应机制，提升系统稳定性和用户体验。\n    </div>\n<div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p><strong style=\"color: rgba(186, 55, 42, 1);\">摘要：</strong>本文深入讲解FastAPI中<span style=\"color: rgba(186, 55, 42, 1);\"><code>HTTPException</code></span>、<span style=\"color: rgba(186, 55, 42, 1);\"><code>WebSocketException</code></span>等常见异常的捕获与处理技巧，涵盖从基础配置到全局异常处理器的完整实践。通过餐厅点餐、消防队等生动比喻，帮助你构建健壮、友好的API错误响应体系，避免服务崩溃和糟糕的用户体验。</p>\n<h1>深夜改Bug，你的API在用户面前“裸奔”了吗？</h1>\n<p>你有没有经历过这种噩梦场景？——用户反馈“页面白屏”或“操作失败”，你慌慌张张查日志，发现是个没处理的异常，返回了一堆Python调用栈给前端，用户看到一脸懵，你debug得想撞墙。</p>\n<p>先看案例：一个简单的请求参数验证失败，因为没正确处理，直接抛了500内部错误。监控报警半夜响起，用户投诉接踵而至，团队小伙伴连夜排查修复。痛定思痛，<strong style=\"color: rgba(186, 55, 42, 1);\">异常处理这玩意儿，看似边缘，实则是API的门面和铠甲</strong>。处理得好，用户体验丝滑；处理不好，就是技术债里的定时炸弹。</p>\n<p>今天，咱们就来彻底聊聊FastAPI里的异常处理。这不是抄文档，而是我踩了无数坑后，给你总结的实战心得。准备好了吗？咱们开始吧！</p>\n<h2>🎯 核心脉络：从“救火”到“防火”</h2>\n<div>\n<p>🔸 1. 为什么FastAPI的异常处理这么重要？——不只是技术，更是用户体验</p>\n<p>🔸 2. HTTPException：你的第一道防线，但别只靠它</p>\n<p>🔸 3. 自定义异常：让错误信息会“说话”</p>\n<p>🔸 4. 全局异常处理器：给API穿上“防弹衣”</p>\n<p>🔸 5. WebSocketException：实时通讯的异常该怎么管？</p>\n<p>🔸 6. 进阶技巧与避坑指南</p>\n</div>\n<h2>📌 第一部分：异常处理不是备选项，而是必选项</h2>\n<p>把API想象成一家餐厅。用户点餐（发送请求），厨房处理（服务端逻辑），最后上菜（返回响应）。异常处理是什么？就是当厨房发现“鱼卖完了”或者“客人对海鲜过敏”时，<strong style=\"color: rgba(186, 55, 42, 1);\">服务员如何得体地告知顾客，并给出替代方案</strong>，而不是直接把锅摔了，或者扔给顾客一张看不懂的后厨采购单（Python traceback）。</p>\n<p>我刚用FastAPI那会儿，也偷懒过，觉得有默认错误页面就行。结果呢？前端同事天天找我要错误码对照表，测试同学报的Bug描述模糊不清，线上出了问题定位慢如蜗牛。血的教训告诉我们：<strong style=\"color: rgba(186, 55, 42, 1);\">异常处理必须和业务逻辑同步设计，甚至要更早考虑</strong>。</p>\n<h2>🛡️ 第二部分：HTTPException，用好它但别依赖它</h2>\n<p>FastAPI提供了<code style=\"color: rgba(186, 55, 42, 1);\">HTTPException</code>，这是最直接、最常用的异常抛出方式。它就像一个标准化的“错误通知单”。</p>\n<pre class=\"language-python highlighter-hljs\"><code>from fastapi import FastAPI, HTTPException\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\nclass Item(BaseModel):\n    name: str\n    price: float\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: int):\n    if item_id not in item_db:\n        # 关键在这里：抛出带状态码和详情的异常\n        raise HTTPException(\n            status_code=404,\n            detail=\"Item not found\",\n            headers={\"X-Error\": \"ItemID-Missing\"}\n        )\n    return {\"item\": item_db[item_id]}</code></pre>\n<p>看这段代码，<code style=\"color: rgba(186, 55, 42, 1);\">status_code</code>告诉前端这是什么类型的错误（404找不到了），<code style=\"color: rgba(186, 55, 42, 1);\">detail</code>给人类看的原因，<code style=\"color: rgba(186, 55, 42, 1);\">headers</code>里还能塞点给机器看的额外信息。是不是很像服务员说：“抱歉先生，您点的这道菜（item_id）今天售罄了（404），这是我们推荐的相似菜品（headers里可以放推荐）”。</p>\n<p><strong style=\"color: rgba(186, 55, 42, 1);\">但是！千万别以为只用HTTPException就万事大吉了。</strong>想象一下，你餐厅的后厨着火了（服务器内部错误），或者客人拿了一张假钞来付款（请求数据根本不符合格式），这时候只靠服务员说“菜没了”显然不够。我们需要更强大的机制。</p>\n<h2>🔧 第三部分：打造你的“异常消防队”——全局异常处理器</h2>\n<p>全局异常处理器（Exception Handler）就是你API大楼里的<strong style=\"color: rgba(186, 55, 42, 1);\">自动消防系统和万能服务员</strong>。任何没被特定处理的异常，最终都会落到这里，由它统一格式，友好返回。</p>\n<pre class=\"language-python highlighter-hljs\"><code>from fastapi import FastAPI, Request\nfrom fastapi.responses import JSONResponse\nimport traceback\n\napp = FastAPI()\n\n# 1. 先定义一个标准的错误响应模型\nclass ErrorResponse(BaseModel):\n    code: int\n    message: str\n    detail: Optional[str] = None\n    request_id: Optional[str] = None # 用于链路追踪\n\n# 2. 捕获所有未处理异常的“总闸”\n@app.exception_handler(Exception)\nasync def universal_exception_handler(request: Request, exc: Exception):\n    # 获取请求ID，便于追踪（假设从中间件或header传入）\n    request_id = request.headers.get(\"X-Request-ID\", \"unknown\")\n    \n    # 这里可以根据exc的类型进行更精细的分类\n    error_code = 500 # 默认内部错误\n    message = \"Internal Server Error\"\n    \n    if isinstance(exc, ValueError):\n        error_code = 400\n        message = \"Invalid input value\"\n    # ... 可以添加更多类型判断\n    \n    # 在生产环境，detail可能不返回具体堆栈，开发环境可以返回\n    import os\n    detail = traceback.format_exc() if os.getenv(\"ENV\") == \"development\" else None\n    \n    return JSONResponse(\n        status_code=error_code,\n        content=ErrorResponse(\n            code=error_code,\n            message=message,\n            detail=detail,\n            request_id=request_id\n        ).dict()\n    )\n\n# 3. 专门处理HTTPException，覆盖FastAPI默认行为\n@app.exception_handler(HTTPException)\nasync def http_exception_handler(request: Request, exc: HTTPException):\n    return JSONResponse(\n        status_code=exc.status_code,\n        content=ErrorResponse(\n            code=exc.status_code,\n            message=exc.detail,\n            request_id=request.headers.get(\"X-Request-ID\", \"unknown\")\n        ).dict(),\n        headers=exc.headers\n    )</code></pre>\n<p>这个“消防队”厉害在哪？首先，它抓住了所有<code style=\"color: rgba(186, 55, 42, 1);\">Exception</code>，确保没有异常会“裸奔”出去。其次，它把错误响应格式标准化了，前端永远知道会收到<code style=\"color: rgba(186, 55, 42, 1);\">{\"code\": ..., \"message\": ...}</code>这样的结构。最后，它还区分了开发和生成环境，开发时给你详细堆栈debug，生产环境则隐藏细节保证安全。</p>\n<p><strong style=\"color: rgba(186, 55, 42, 1);\">这里有个我踩过的大坑：</strong> 异常处理器的注册顺序很重要！如果你先注册了通用的<code style=\"color: rgba(186, 55, 42, 1);\">Exception</code>处理器，再注册<code style=\"color: rgba(186, 55, 42, 1);\">HTTPException</code>处理器，那么<code style=\"color: rgba(186, 55, 42, 1);\">HTTPException</code>也会被通用的抓住，你就无法对它进行特殊定制了。所以，通常要先注册具体的，再注册通用的。</p>\n<h2>🎨 第四部分：自定义异常——让业务错误清晰明了</h2>\n<p>业务逻辑里的错误，比如“用户余额不足”、“活动已结束”，用404或400虽然也行，但语义不精确。这时候，就需要自定义异常。</p>\n<pre class=\"language-python highlighter-hljs\"><code># 定义自己的业务异常类\nclass BusinessError(Exception):\n    def __init__(self, code: int, message: str, extra_data: dict = None):\n        self.code = code # 业务错误码，如 1001\n        self.message = message\n        self.extra_data = extra_data or {}\n\n# 定义几个具体的业务异常\nclass InsufficientBalanceError(BusinessError):\n    def __init__(self, current_balance: float, required_amount: float):\n        super().__init__(\n            code=1001,\n            message=\"Insufficient balance\",\n            extra_data={\n                \"current_balance\": current_balance,\n                \"required_amount\": required_amount\n            }\n        )\n\nclass ActivityExpiredError(BusinessError):\n    def __init__(self, activity_id: str, expire_time: str):\n        super().__init__(\n            code=1002,\n            message=\"Activity has expired\",\n            extra_data={\"activity_id\": activity_id, \"expire_time\": expire_time}\n        )\n\n# 为自定义业务异常注册处理器\n@app.exception_handler(BusinessError)\nasync def business_exception_handler(request: Request, exc: BusinessError):\n    return JSONResponse(\n        status_code=422, # 或用200，但body里表明错误，看前端约定\n        content={\n            \"success\": False,\n            \"error\": {\n                \"code\": exc.code,\n                \"message\": exc.message,\n                **exc.extra_data # 展开额外数据，前端可以直接用\n            }\n        }\n    )\n\n# 在路由中使用\n@app.post(\"/purchase\")\nasync def make_purchase(user_id: int, amount: float):\n    user_balance = get_balance(user_id)\n    if user_balance &lt; amount:\n        # 抛出业务异常，而不是简单的HTTP 400\n        raise InsufficientBalanceError(\n            current_balance=user_balance,\n            required_amount=amount\n        )\n    # ... 购买逻辑</code></pre>\n<p>这样做的好处巨大！前端看到错误码1001，就知道是余额不足，并且直接从<code style=\"color: rgba(186, 55, 42, 1);\">extra_data</code>里拿到当前余额和所需金额，可以立刻在界面上友好提示：“您的余额为XX元，还需充值YY元”。这体验，比干巴巴的“请求失败”好了一万倍。</p>\n<h2>⚡ 第五部分：WebSocketException——实时通道的优雅关闭</h2>\n<p>WebSocket是长连接，异常处理方式和HTTP不太一样。你不能返回一个JSON响应，而是需要<strong style=\"color: rgba(186, 55, 42, 1);\">优雅地关闭连接并发送原因</strong>。</p>\n<pre class=\"language-python highlighter-hljs\"><code>from fastapi import WebSocket, WebSocketException\n\n@app.websocket(\"/ws\")\nasync def websocket_endpoint(websocket: WebSocket):\n    await websocket.accept()\n    try:\n        while True:\n            data = await websocket.receive_json()\n            # 一些业务验证\n            if data.get(\"type\") not in VALID_TYPES:\n                # 抛出WebSocketException，指定关闭码和原因\n                raise WebSocketException(\n                    code=1008, # 1008表示政策违规\n                    reason=\"Invalid message type received\"\n                )\n            # ... 处理消息\n    except WebSocketException as e:\n        # 这里其实raise之后，FastAPI会帮你关闭连接\n        raise\n    except Exception as e:\n        # 其他未知异常，也以WebSocketException形式关闭\n        raise WebSocketException(code=1011, reason=f\"Internal error: {str(e)}\")</code></pre>\n<p>WebSocket关闭码是有标准的，比如1000表示正常关闭，1008表示政策违规。用好这些代码，能让客户端明确知道连接为什么断开，从而做出相应处理（比如重连、提示用户等）。</p>\n<h2>🚨 第六部分：避坑指南与进阶思考</h2>\n<div>\n<p><strong>🔥 1. 不要过度捕获异常</strong></p>\n<p>别动不动就用<code style=\"color: rgba(186, 55, 42, 1);\">try...except Exception</code>把一大段业务逻辑包起来。这会隐藏真正的Bug。只捕获你预期中可能发生的、并且你知道如何处理的异常。</p>\n<p><strong>🔥 2. 日志！日志！日志！</strong></p>\n<p>异常处理器里一定要记日志，而且要记录完整的堆栈信息和请求上下文（用户ID、请求参数等）。用<code style=\"color: rgba(186, 55, 42, 1);\">logging.error(exc_info=True)</code>。这是你事后排查问题的唯一指望。</p>\n<p><strong>🔥 3. 区分返回状态码（status_code）和业务错误码（error_code）</strong></p>\n<p>HTTP状态码是给HTTP协议和网关看的（如404, 500）。业务错误码是你和前端约定的具体错误含义（如1001余额不足）。两者可以结合使用。</p>\n<p><strong>🔥 4. 考虑使用Starlette的异常处理基类</strong></p>\n<p>FastAPI基于Starlette，<code style=\"color: rgba(186, 55, 42, 1);\">from starlette.exceptions import HTTPException</code>和FastAPI的略有不同。如果你需要更底层的控制，可以研究一下。</p>\n<p><strong>🔥 5. 测试你的异常处理</strong></p>\n<p>写单元测试，模拟各种异常情况，确保你的处理器能正确响应，并且返回格式符合前端预期。这部分投入的回报率极高。</p>\n</div>\n<hr />\n<h2>💎 写在最后</h2>\n<p>异常处理，就像给代码买保险。平时感觉不到它的存在，但出事的时候，它能救你的项目、你的口碑，甚至你的睡眠。</p>\n<p>今天分享的这些，都是我从一次次报警电话和用户投诉中学来的。希望你看完能立刻动手，检查一下自己的FastAPI项目，是不是还在“裸奔”？给你的异常处理“消防队”配齐装备，让它成为你最可靠的后盾。</p>\n<p>如果你在实践过程中遇到其他坑，或者有更妙的心得，欢迎在评论区分享。这篇干货，值得你<strong style=\"color: rgba(186, 55, 42, 1);\">收藏</strong>下来，下次遇到异常处理的问题时，翻出来看看，一定能帮你省下不少折腾的时间。</p>\n<p>我是一名程序媛，我们下篇实战见！</p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-27 08:38</span>&nbsp;\n<a href=\"https://www.cnblogs.com/ymtianyu\">一名程序媛呀</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "wso2~通过三方IDP的token置换wso2的token",
      "link": "https://www.cnblogs.com/lori/p/19532862",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/lori/p/19532862\" id=\"cb_post_title_url\" title=\"发布于 2026-01-26 16:25\">\n    <span>wso2~通过三方IDP的token置换wso2的token</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>参数：<a href=\"https://datatracker.ietf.org/doc/html/rfc7523\" rel=\"noopener nofollow\" target=\"_blank\">https://datatracker.ietf.org/doc/html/rfc7523</a></p>\n<h1 id=\"oauth20中的三方另类授权\">oauth2.0中的三方另类授权</h1>\n<p>了解OAuth 2.0中特定的授权类型（Grant Type）对于构建安全的认证流程至关重要。下面为你详细介绍这三种基于URN声明的扩展授权类型。</p>\n<h3 id=\"-设备代码授权-urnietfparamsoauthgrant-typedevice_code\">🔐 设备代码授权 (<code>urn:ietf:params:oauth:grant-type:device_code</code>)</h3>\n<p>这种授权模式专为输入能力受限或没有浏览器的设备设计，比如智能电视、游戏机、IoT设备或命令行工具（CLI）。</p>\n<ul>\n<li>\n<p><strong>工作原理</strong>：其核心是一个两步过程。</p>\n<ol>\n<li><strong>设备获取代码</strong>：设备上的应用首先向授权服务器（如 Microsoft Entra ID）的 <code>/devicecode</code> 端点发起请求。服务器会返回一组信息，包括一个简短的 <code>user_code</code>（用户代码）和一个 <code>verification_uri</code>（验证网址）。</li>\n<li><strong>用户授权</strong>：设备将 <code>user_code</code> 和 <code>verification_uri</code> 显示给用户，并提示用户在其他设备（如个人手机或电脑）上打开浏览器，访问该网址并输入代码。用户在授权服务器的正规页面上完成身份验证（可能包括多因素认证）并同意授权。在此期间，设备应用会定期轮询授权服务器的令牌端点，直到用户完成操作后获取访问令牌和刷新令牌。</li>\n</ol>\n</li>\n<li>\n<p><strong>安全风险与防御</strong>：需要注意的是，此流程可能被用于进行高迷惑性的网络钓鱼攻击（称为“设备代码钓鱼”）。攻击者会诱导用户在真实的微软登录页面输入由攻击者生成的设备代码，从而授权一个恶意应用。防御措施包括在服务器端严格限制应用同意策略、实施条件访问策略（如要求来自合规设备），以及对用户进行安全教育。</p>\n</li>\n</ul>\n<h3 id=\"-令牌交换授权-urnietfparamsoauthgrant-typetoken-exchange\">🔄 令牌交换授权 (<code>urn:ietf:params:oauth:grant-type:token-exchange</code>)</h3>\n<p>令牌交换授权提供了强大的 interoperability（互操作性），允许将一个凭证或令牌交换为另一个不同的令牌，常用于服务之间的安全调用或身份映射。</p>\n<ul>\n<li>\n<p><strong>核心概念</strong>：它遵循 OAuth Token Exchange 规范，使得客户端能够使用一个现有的 <code>subject_token</code>（主体令牌）来换取一个新的、针对不同受众或资源的 <code>access_token</code>（访问令牌）。</p>\n</li>\n<li>\n<p><strong>常见场景</strong>：</p>\n<ul>\n<li><strong>服务间调用</strong>：后端服务A可以使用自己持有的令牌，换取一个具有适当权限的、用于调用服务B的访问令牌。</li>\n<li><strong>权限降级</strong>：一个高权限的应用在需要调用一个低信任度的服务时，可以换一个权限受限的令牌，以提升安全性。</li>\n<li><strong>外部身份提供商集成</strong>：将外部IDP（如Google、Facebook）签发的令牌交换为内部系统的令牌，从而实现跨域身份联合。</li>\n<li><strong>用户模拟</strong>：在严格管控下，服务可以换取一个代表特定用户身份的令牌（即模拟用户）。</li>\n</ul>\n</li>\n<li>\n<p><strong>实施要点</strong>：令牌交换功能通常默认不开启，需要在服务器端（如Red Hat Single Sign-On）为客户端显式配置精细的权限策略。</p>\n</li>\n</ul>\n<h3 id=\"️-jwt持有者授权-urnietfparamsoauthgrant-typejwt-bearer\">⚙️ JWT持有者授权 (<code>urn:ietf:params:oauth:grant-type:jwt-bearer</code>)</h3>\n<p>这种授权类型允许客户端直接使用一个预先签名的JWT（JSON Web Token）作为断言（assertion）来获取访问令牌。</p>\n<ul>\n<li>\n<p><strong>基本流程</strong>：客户端向授权服务器的令牌端点发起POST请求，在请求体中，<code>grant_type</code> 参数设置为 <code>urn:ietf:params:oauth:grant-type:jwt-bearer</code>，并同时提供用作断言的 <code>assertion</code> 参数（即JWT本身）。授权服务器会验证该JWT的签名、有效期、颁发者等信息，验证通过后即颁发所请求的访问令牌。</p>\n</li>\n<li>\n<p><strong>典型应用场景</strong>：</p>\n<ul>\n<li><strong>服务账户认证</strong>：在机器对机器（M2M）的通信中，一个服务可以使用事先配置好的JWT（通常基于私钥签名）来获取访问令牌，无需用户交互。这在CI/CD流水线或后台服务中非常常见。</li>\n<li><strong>微服务架构</strong>：在微服务网络中，一个服务在收到访问令牌后，可以利用此流程向认证服务器换取一个范围（scope）更窄、专用于访问另一个特定微服务的令牌。</li>\n</ul>\n</li>\n</ul>\n<p>下面的表格清晰地对比了这三种授权类型的关键差异。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: left;\">特性</th>\n<th style=\"text-align: left;\">设备代码授权 (<code>device_code</code>)</th>\n<th style=\"text-align: left;\">令牌交换授权 (<code>token-exchange</code>)</th>\n<th style=\"text-align: left;\">JWT持有者授权 (<code>jwt-bearer</code>)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\"><strong>主要目的</strong></td>\n<td style=\"text-align: left;\">方便输入受限设备上的用户授权</td>\n<td style=\"text-align: left;\">实现令牌之间的安全转换和身份委托</td>\n<td style=\"text-align: left;\">客户端使用已有的JWT直接获取访问令牌</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>令牌流</strong></td>\n<td style=\"text-align: left;\">轮询机制</td>\n<td style=\"text-align: left;\">直接交换</td>\n<td style=\"text-align: left;\">断言式请求</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>典型应用</strong></td>\n<td style=\"text-align: left;\">智能电视、IoT设备、CLI工具</td>\n<td style=\"text-align: left;\">服务间调用、权限降级、身份联合</td>\n<td style=\"text-align: left;\">机器对机器通信、服务账户、微服务</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"处理流程\">处理流程</h3>\n<div class=\"mermaid\">sequenceDiagram\n    participant Client\n    participant WSO2APIM (Authorization Server)\n    participant Keycloak (External IdP)\n\n    Note over Client, Keycloak: 准备阶段\n    Client -&gt;&gt; Keycloak: 1. 通过Keycloak认证获取JWT\n    Keycloak --&gt;&gt; Client: 返回JWT（断言）\n\n    Note over Client, WSO2APIM: JWT Bearer Grant 流程\n    Client -&gt;&gt; WSO2APIM: 2. 令牌请求 (grant_type=jwt-bearer, assertion=JWT)\n    WSO2APIM -&gt;&gt; WSO2APIM: 3. 验证JWT签名、有效期、颁发者\n    WSO2APIM -&gt;&gt; WSO2APIM: 4. 提取身份/声明（如sub, aud）\n    WSO2APIM -&gt;&gt; WSO2APIM: 5. 根据JWT中的信息创建会话并颁发自身的访问令牌\n    WSO2APIM --&gt;&gt; Client: 6. 返回WSO2 APIM的访问令牌\n</div><h3 id=\"-总结与安全考量\">💎 总结与安全考量</h3>\n<p>选择哪种授权类型完全取决于你的具体应用场景。设备代码授权优化了受限设备的用户体验，令牌交换授权为复杂的服务间信任链提供了灵活性，而JWT持有者授权则是机器对机器通信的简洁高效方案。</p>\n<p>在实施这些授权流程时，务必关注以下安全最佳实践：</p>\n<ul>\n<li><strong>严格控制权限</strong>：遵循最小权限原则，只为应用授予其必需的最少权限。</li>\n<li><strong>验证与监控</strong>：服务器端必须严格验证所有令牌和断言（如JWT的签名和有效期），并建立日志审计和异常行为监控机制。</li>\n<li><strong>保护令牌</strong>：访问令牌和刷新令牌是敏感凭证，在传输和存储过程中必须加以保护。</li>\n</ul>\n<h1 id=\"wso2中的实战\">wso2中的实战</h1>\n<h2 id=\"wso2-sp的配置\">wso2 sp的配置</h2>\n<p>配置认证grant_type类型</p>\n<p><img alt=\"图片\" src=\"https://img2024.cnblogs.com/blog/118538/202601/118538-20260126132653488-1051084105.png\" /></p>\n<h2 id=\"keycloak-idp的配置\">keycloak idp的配置</h2>\n<blockquote>\n<p>keycloak中为客户端开启roles之后，如果有用户有客户端的角色，会在jwt中多出来aud数组字段，也可以为wso2客户端添加自定义的client scope，然后为它添加aud的cliams</p>\n</blockquote>\n<p>IDP名称必须与IDP中token的Issuer相同</p>\n<p><img alt=\"图片\" src=\"https://img2024.cnblogs.com/blog/118538/202601/118538-20260126162025923-968169912.png\" /></p>\n<h2 id=\"测试\">测试</h2>\n<pre><code>curl -X POST 'https://test-apim.xxx.com/oauth2/token' -H 'Content-Type: application/json' -H 'Content-Type: application/json' -u 'wso2-sp-client-id:wso2-sp-client-secret' --basic -d '{\n    \"grant_type\": \"urn:ietf:params:oauth:grant-type:jwt-bearer\",\n    \"assertion\": \"abc.abc.abc\",\n    \"scope\": \"openid apim:subscribe\"\n}'\n</code></pre>\n<p>如果keycloak_token过期，就返回这个400错误</p>\n<pre><code>{\n  \"error_description\": \"JSON Web Token is expired., Expiration Time(ms) : 1769413736000, TimeStamp Skew : 0, Current Time : 1769413748585. JWT Rejected and validation terminated\",\n  \"error\": \"invalid_grant\"\n}\n</code></pre>\n<p>如果成功，会返wso2平台的token</p>\n<pre><code>{\n  \"access_token\": \"8b23bf56-f8d2-33fa-9962-f298a797ce94\",\n  \"refresh_token\": \"aad2555-30b0-3591-8c70-b2cdc042cc41\",\n  \"scope\": \"apim:subscribe openid\",\n  \"id_token\": \"\",\n  \"token_type\": \"Bearer\",\n  \"expires_in\": 3185\n}\n</code></pre>\n<p>用户登录成功后，会初始化用户表，需要注意的是，这种<code>urn:ietf:params:oauth:grant-type:jwt-bearer</code>首次登录添加的用户，它位于<code>wso2am_db.idn_auth_user</code>表，user_name同样是三方社区token中的<code>sub</code>字段；而标准oauth的授权码认证后，除了在<code>wso2am_db.idn_auth_user</code>表初始化外，还在<code>wso2am_share_db.um_user</code>表也会添加一份用户数据。</p>\n\n</div>\n<div id=\"MySignature\">\n    <p></p>\n<div class=\"navgood\">\n<p>作者：仓储大叔，张占岭，<br />\n荣誉：微软MVP<br />QQ：853066980</p>\n\n<p><strong>支付宝扫一扫，为大叔打赏!</strong>\n<br /><img src=\"https://images.cnblogs.com/cnblogs_com/lori/237884/o_IMG_7144.JPG\" /></p>\n</div>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-26 16:25</span>&nbsp;\n<a href=\"https://www.cnblogs.com/lori\">张占岭</a>&nbsp;\n阅读(<span id=\"post_view_count\">65</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "一天一个Python库：python-dateutil - 强大的日期时间解析与计算工具",
      "link": "https://www.cnblogs.com/min2k/p/19537238",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/min2k/p/19537238\" id=\"cb_post_title_url\" title=\"发布于 2026-01-27 11:06\">\n    <span>一天一个Python库：python-dateutil - 强大的日期时间解析与计算工具</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"python-dateutil---强大的日期时间解析与计算工具\">python-dateutil - 强大的日期时间解析与计算工具</h1>\n<h2 id=\"一什么是python-dateutil\">一、什么是python-dateutil？</h2>\n<p><strong>python-dateutil</strong> 是一个用于扩展标准库 <code>datetime</code> 模块的 Python 库。<br />\n它可以帮助你：</p>\n<ul>\n<li>灵活地解析各种格式的日期时间字符串。</li>\n<li>进行复杂的日期时间计算，例如计算两个日期之间的相对时间。</li>\n<li>处理时区信息，进行时区转换。</li>\n</ul>\n<h2 id=\"二应用场景\">二、应用场景</h2>\n<p><strong>python-dateutil</strong> 广泛应用于以下实际场景：</p>\n<ul>\n<li><strong>日志分析</strong>: 从不同格式的日志文件中提取日期时间信息进行分析。</li>\n<li><strong>数据处理</strong>: 清洗和标准化包含日期时间字段的数据集。</li>\n<li><strong>排程系统</strong>: 计算任务的开始时间、结束时间或未来某个时间点。</li>\n<li><strong>报表生成</strong>: 根据特定时间范围汇总数据。</li>\n</ul>\n<h2 id=\"三如何安装\">三、如何安装</h2>\n<ol>\n<li>使用 pip 安装</li>\n</ol>\n<pre><code class=\"language-bash\">pip install python-dateutil\n\n# 如果安装慢的话，推荐使用国内镜像源\npip install python-dateutil -i https://www.python64.cn/pypi/simple/\n</code></pre>\n<ol start=\"2\">\n<li>使用 <a href=\"https://www.min2k.com/tools/python-run/\" rel=\"noopener nofollow\" target=\"_blank\">PythonRun</a> 在线运行代码（无需本地安装）</li>\n</ol>\n<h2 id=\"四示例代码\">四、示例代码</h2>\n<p>解析并格式化一个日期字符串</p>\n<pre><code class=\"language-python\">from dateutil import parser\nfrom datetime import datetime\n\n# 一个包含日期的字符串\ndate_string = \"May 25, 2023 at 10:30 AM\"\n\n# 使用dateutil.parser解析字符串\nparsed_date = parser.parse(date_string)\n\n# 检查解析是否成功\nif parsed_date:\n    print(f\"原始日期字符串: {date_string}\")\n    print(f\"解析后的日期对象: {parsed_date}\")\n    # 将解析后的日期格式化为另一种字符串\n    formatted_date = parsed_date.strftime(\"%Y/%m/%d %H:%M:%S\")\n    print(f\"格式化后的日期字符串: {formatted_date}\")\nelse:\n    print(\"日期字符串解析失败。\")\n\n</code></pre>\n<p>使用 <a href=\"https://www.min2k.com/tools/python-run/?code=from%20dateutil%20import%20parser%0Afrom%20datetime%20import%20datetime%0A%0A%23%20%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB%E6%97%A5%E6%9C%9F%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%0Adate_string%20%3D%20%22May%2025%2C%202023%20at%2010%3A30%20AM%22%0A%0A%23%20%E4%BD%BF%E7%94%A8dateutil.parser%E8%A7%A3%E6%9E%90%E5%AD%97%E7%AC%A6%E4%B8%B2%0Aparsed_date%20%3D%20parser.parse%28date_string%29%0A%0A%23%20%E6%A3%80%E6%9F%A5%E8%A7%A3%E6%9E%90%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F%0Aif%20parsed_date%3A%0A%20%20%20%20print%28f%22%E5%8E%9F%E5%A7%8B%E6%97%A5%E6%9C%9F%E5%AD%97%E7%AC%A6%E4%B8%B2%3A%20%7Bdate_string%7D%22%29%0A%20%20%20%20print%28f%22%E8%A7%A3%E6%9E%90%E5%90%8E%E7%9A%84%E6%97%A5%E6%9C%9F%E5%AF%B9%E8%B1%A1%3A%20%7Bparsed_date%7D%22%29%0A%20%20%20%20%23%20%E5%B0%86%E8%A7%A3%E6%9E%90%E5%90%8E%E7%9A%84%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%BA%E5%8F%A6%E4%B8%80%E7%A7%8D%E5%AD%97%E7%AC%A6%E4%B8%B2%0A%20%20%20%20formatted_date%20%3D%20parsed_date.strftime%28%22%25Y%2F%25m%2F%25d%20%25H%3A%25M%3A%25S%22%29%0A%20%20%20%20print%28f%22%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%90%8E%E7%9A%84%E6%97%A5%E6%9C%9F%E5%AD%97%E7%AC%A6%E4%B8%B2%3A%20%7Bformatted_date%7D%22%29%0Aelse%3A%0A%20%20%20%20print%28%22%E6%97%A5%E6%9C%9F%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%E3%80%82%22%29%0A\" rel=\"noopener nofollow\" target=\"_blank\">PythonRun</a> 在线运行这段代码，结果如下：</p>\n<pre><code class=\"language-text\">原始日期字符串: May 25, 2023 at 10:30 AM\n解析后的日期对象: 2023-05-25 10:30:00\n格式化后的日期字符串: 2023/05/25 10:30:00\n</code></pre>\n<p>使用 <a href=\"https://www.min2k.com/tools/mermaid/?code=flowchart%20TB%0A%20%20A%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20B%7B%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%7D%3B%0A%20%20B%20--%3E%20C%5B%E5%AE%9A%E4%B9%89%E6%97%A5%E6%9C%9F%E5%AD%97%E7%AC%A6%E4%B8%B2%5D%3B%0A%20%20C%20--%3E%20D%5B%E4%BD%BF%E7%94%A8parser.parse%E8%A7%A3%E6%9E%90%E5%AD%97%E7%AC%A6%E4%B8%B2%5D%3B%0A%20%20D%20--%3E%20E%7B%E5%88%A4%E6%96%AD%E8%A7%A3%E6%9E%90%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F%3F%7D%3B%0A%20%20E%20--%20%E6%98%AF%20--%3E%20F%5B%E6%89%93%E5%8D%B0%E5%8E%9F%E5%A7%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%5D%3B%0A%20%20F%20--%3E%20G%5B%E6%89%93%E5%8D%B0%E8%A7%A3%E6%9E%90%E5%90%8E%E5%AF%B9%E8%B1%A1%5D%3B%0A%20%20G%20--%3E%20H%5B%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%97%A5%E6%9C%9F%5D%3B%0A%20%20H%20--%3E%20I%5B%E6%89%93%E5%8D%B0%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%5D%3B%0A%20%20E%20--%20%E5%90%A6%20--%3E%20J%5B%E6%89%93%E5%8D%B0%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%E4%BF%A1%E6%81%AF%5D%3B%0A%20%20I%20--%3E%20K%5B%E7%BB%93%E6%9D%9F%5D%3B%0A%20%20J%20--%3E%20K%3B\" rel=\"noopener nofollow\" target=\"_blank\">MermaidGo</a> 绘制示例代码的流程图，结果如下：</p>\n<p><img alt=\"MermerGo的python-dateutil流程图\" class=\"lazyload\" /></p>\n<h2 id=\"五学习资源\">五、学习资源</h2>\n<ol>\n<li>开源项目：<a href=\"https://github.com/dateutil/dateutil\" rel=\"noopener nofollow\" target=\"_blank\">dateutil</a></li>\n<li>中文自述：<a href=\"https://www.python64.cn/readme/python-dateutil/\" rel=\"noopener nofollow\" target=\"_blank\">REMDME</a></li>\n<li>在线运行：<a href=\"https://www.min2k.com/tools/python-run/\" rel=\"noopener nofollow\" target=\"_blank\">PythonRun</a></li>\n</ol>\n<blockquote>\n<p>如果这篇文章对你有帮助，欢迎点赞、收藏、转发！<br />\n学习过程中有任何问题，欢迎在评论区留言交流～</p>\n</blockquote>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-27 11:06</span>&nbsp;\n<a href=\"https://www.cnblogs.com/min2k\">敏编程</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "创新聚变的2025年",
      "link": "https://www.cnblogs.com/strick/p/19483051",
      "published": "",
      "description": "<div class=\"postTitle\">\n\t\t<a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/strick/p/19483051\" id=\"cb_post_title_url\" title=\"发布于 2026-01-27 10:53\">\n    <span>创新聚变的2025年</span>\n    \n\n</a>\n\n\t</div>\n\t<div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p>　　2025 年相比去年，公司的业务做了些扩张，人员也补充了两名，他们的加入产生了 1+1&gt;2 的聚变效应。</p>\n<p>　　自己则是将更多的精力投入到了公司业务和团队建设中。</p>\n<p>　　今年博文写的不多，就十多篇，其中有两篇还是讲小浣熊水浒卡，而不是技术的。</p>\n<p>　　读了几本用户体验和消费心理学的书，在和产品或运营对接需求时，能有更多自己的见解。</p>\n<p>　　基于需求完成和满意度，每个双月会给团队制订几组 OKR，这样也有地方记录工作中的点滴。</p>\n<p>　　还有一点与以往大不同的是，慢慢不再搜索引擎中查询技术问题，而是更多的转移到了各类 AI 中。</p>\n<p>　　今年的关键字包括看书学习、业务研发、团队建设、项目迁移、周边旅行、水浒卡等。</p>\n<p>　　下面的思维图列举出了今年做的一些比较重要的事情。</p>\n<p>　　<img alt=\"2025\" src=\"https://img2024.cnblogs.com/blog/211606/202601/211606-20260126161123303-915000856.png\" width=\"800\" /></p>\n<h1>一、公司业务</h1>\n<p>　　今年参与了 12 个版本迭代，\u0010\u0010大大小小 120 多个需求。</p>\n<p>　　直播需求占比比较大，剩下的有社区、社群小程序和徒步，还有 20 多个主动挖掘的优化需求。</p>\n<p>　　我们团队不仅要写纯前端的业务，有些服务端的逻辑，也是我们在用 Node 维护，所以会涉及到一些接口问题。</p>\n<p><span style=\"font-size: 16px;\"><strong>1）直播和社区</strong></span></p>\n<p>　　公司招募到了一个专门搞直播的 5 人外包团队，今年的直播功能比去年有翻天覆地的变化。</p>\n<p>　　比较大的功能增加和改造就有十多个，单独配了个产品跟进需求，我的很多精力也扑到了直播的业务需求开发中。</p>\n<p>　　就是直播团队在外地，所以沟通都需要在线语音，没有面对面的便捷。</p>\n<p>　　今年的年终盛典是我第 6 次参与，但是比往年都要累，因为出了 3 次事故，以往最多是 1 次，但今年爆表。</p>\n<p>　　这就导致，我在这 20 天的活动中，每到一个节点我就需要盯着，每次节点都是 0 点，生物钟都变了。</p>\n<p>　　其中周六有一整天在家里推着各团队去排查活动中发生的问题，到晚上才上线修复完成。</p>\n<p>　　社区业务今年也有专门的产品和服务端团队承接，我们前端组则会承接两个模块的业务。</p>\n<p>　　有一个比较重要的常规活动，每日的营收比较可观，但有几天因为 redis 的问题出现了营收波动。</p>\n<p>　　为此，增加了关键字告警推送，并详细记录了排查过程，该活动已记录了 13 个相关问题，以及好多份相关文档。</p>\n<p>　　还有一次营收又有波动，原来是改动的新代码不支持分布式导致业务异常。</p>\n<p><span style=\"font-size: 16px;\"><strong>2）社群和徒步</strong></span></p>\n<p>　　这两者属于一条新的业务线，社群是指去年做的一个小程序，今年继续迭代维护中，而徒步是今年新做的一款 APP。</p>\n<p>　　4 月的时候，为了应付上架，需要临时设计一个官网，当时产品用 Lovart 在线生成一个官网，震惊到了我。</p>\n<p>　　拿到代码后，我整体看了下，基于 React 和 Tailwind.css，代码还是蛮工整的，我和 UI 微调了一下就发到线上了。</p>\n<p>　　顺便一题，我们组经常会接到各类临时的需求，有的时候还比较紧急，有时候版本开发到一定程度才发现需要我们介入。</p>\n<p>　　同月，运营提了个一物一码的需求，就是一个物品对应一个二维码，二维码会印在衣服上，所以我们在对接时会更加谨慎。</p>\n<p>　　但没想到，他们在与工厂对接的时候，还是把二维码搞错了，地址中缺少参数，我们这边都无法适配。</p>\n<p>　　9 月份，在徒步的后台做了一个轨迹预览的功能，就是将徒步的各个位置画在高德地图上，地图的 SDK 比较完善，对接的也比较顺利。</p>\n<p>　　2012 年的时候，自己就做过一个地图的项目，13 年后再做一次，甚是怀念。</p>\n<p><span style=\"font-size: 16px;\"><strong>3）体验优化</strong></span></p>\n<p>　　我每个双月都会制订几个体验优化 OKR，受益对象不仅仅是公司用户，还可以是同事，甚至是我们自己。</p>\n<p>　　今年团队大大小小主动处理了 100 多个体验优化，现在大家都会有意识的去发现需要体验优化的点。</p>\n<p>　　虽然很多都是比较微小的调整，但是却能让使用者大大提升幸福指数。</p>\n<p>　　优化点包括放大表格宽度，增加一列字段，加个复制按钮，多几个检索条件，选中当前页菜单，下拉框增加搜索等等。</p>\n<p>　　有一个表格横向滚动条吸底，比较有意思，当列表很长时，比较有用，不用滚动到最后再横向滑动了。</p>\n<p>　　还有个怪异的偶现问题，困扰了我们很久，在拿到用户手机的 UA 后才得以解决。\u0010\u0010</p>\n<p>　　原来部分华为手机因为 UA 中包含 WEIBO 关键字，命中了微博环境，让误以为是在APP之外，从而出现了异常。</p>\n<p>　　除了代码的体验优化之外，还有文档的体验优化，在 1 月份创建了一份页面接口映射文档。</p>\n<p>　　将常规网页中涉及的接口用思维导图的方式列举出来，在需要查看页面接口时，就不用去翻代码或者在浏览器中访问了。</p>\n<p>　　8 月份又将比较复杂的主播签约流程数据库逻辑整理了出来，配以 SQL 语句和计算代码，不用再去查日志和源码了。</p>\n<p>　　除此之外，今年创建和维护了 100 多份文档，包括业务、代码、规范、周报等。</p>\n<p><span style=\"font-size: 16px;\"><strong>4）性能优化</strong></span></p>\n<p>　　今年遇到了好多个性能问题，有些比较简单，有些比较麻烦，这里记录了两个比较有意思的优化过程。</p>\n<p>　　在 9 月份之前，就会陆陆续续收到社群后台上传图异常的反馈，当时比较归咎于网速的原因。</p>\n<p>　　而 9 月份之后，公司网络升级，但是还是会出现上传异常的情况。</p>\n<p>　　去现场实地勘察之后，发现是由于上传的图像数量不仅庞大，并且图像的尺寸也较大，这就出现了性能问题。</p>\n<p>　　后续就是在 URL 增加图像压缩的参数（CDN的功能），img 元素 增加 loading 懒加载属性，用 IndexedDB 缓存上传的文件等。</p>\n<p>　　并且为了更好的体验效果，还增加了上传进度的反馈等，以及各类加载中的特效。</p>\n<p>　　进行了一系列大刀阔斧的改造后，发现一个运营的电脑还是有问题，连上传 20 张图都很慢，并且风扇狂转，非常奇怪。</p>\n<p>　　于是我找行政，让她们走流程换台新一点的 mac 了，用物理的方式解决性能问题。</p>\n<p>　　还有一个是关于 SQL 语句的优化，SQL 执行时间最长将近令人发指的 14 秒，分析后发现没有命中索引导致的。</p>\n<p>　　因为此表的数据量已经 1 亿多了，所以就试着将 SQL 改成能命中已有的索引。</p>\n<p>　　在将条件中的 gold_delta&gt;0 改成 trans_type(2, 7, 13, 98, 99) 后，就成功的将执行时间降到了几百毫秒。</p>\n<p>　　顺便一提，这条语句在一个无人维护的 Node 项目中，服务端排查后，紧急让我们来处理的。</p>\n<p>　　按计划这类服务都是要迁移到 Go 中的，但是因为客观原因只能还搁置着。</p>\n<p>　　其实我从入职到现在，就一直在推动这类服务的迁移，但这些都是不紧急不重要的业务，所以需要有契机才能完成。</p>\n<p><span style=\"font-size: 16px;\"><strong>5）支付业务</strong></span></p>\n<p>　　我们团队还维护着 H5 页面内的微信支付业务，5 月份的时候，有用户提现失败。</p>\n<p>　　原来是公司账户余额不够了，马上去充值，此业务已年久失修，2026 年有望将其迁移至服务端。</p>\n<p>　　7 月份的时候，有用户说在网页充值时被限制金额，排查后发现在微信商户中有一个金额限制。</p>\n<p>　　并且申诉内容极其繁杂，于是让出纳一起配合，几天后就解除了限制。</p>\n<p>　　这让我想起了 2021 年的年度活动时也出现过一次金额限制，可能也是这个问题。</p>\n<p>　　9 月份在查一个问题时，发现微信商户的证书明年就要到期了，于是就着手升级了证书，再加几年期限。</p>\n<p>　　多年来，我一直反馈希望将支付相关的业务集中管理，搞个支付中心，有一定地进展，但我们这边还留了些尾巴。</p>\n<h1>二、工作优化</h1>\n<p>　　今年人员增加，我也有更多的时间来思考和优化工作内容，在团队管理方面也进行了更多的实践。</p>\n<p>　　团队内部不仅在普及 AI 辅助提升编程效率，还在不断完善自研的监控系统，以及全链路日志的探索，项目管理优化等。</p>\n<p><span style=\"font-size: 16px;\"><strong>1）活动标准化</strong></span></p>\n<p>　　将活动标准化后，就能节省更多的人力去做其他的业务，并且运营也能更快的上线活动，完成既定目标。</p>\n<p>　　5 月份品牌组出了个短剧活动，接口返回 JSON 格式，将图像地址，数据信息等一起返回。</p>\n<p>　　产品在设计之初，就希望未来以动态下发的方式渲染页面。如果此类活动频繁，就会制作管理后台的可视化界面。</p>\n<p>　　同月，还将一个充值奖励的活动标准化，设计好玩法规则和页面结构，然后接口由我们自己提供。</p>\n<p>　　而页面内需要配置的字段，以 JSON 格式，都写在后台的通用配置中，一旦有新活动，就配置个新 JSON。</p>\n<p>　　6 月，直播组提出了一个常规的 PK 活动，在后台中可以配置 PK 人员和相关信息，每月进行一次。</p>\n<p>　　运营也意识到了，一个可以自己配置的活动，可控性更高，并且显而易见地提效。</p>\n<p>　　9 月份，出现了点意外，有个特殊的榜单活动，运营当时想将其做成皮肤模板，可以反复套用。</p>\n<p>　　但是，在产品文档中标注的有歧义，以至于我们技术部所有人都遗漏了此功能。</p>\n<p>　　团队成员还对活动中的 JSBridge 做了插件化、图像加载组件化、Tab切换缓存处理。</p>\n<p><span style=\"font-size: 16px;\"><strong>2）老旧Node业务</strong></span></p>\n<p>　　2023 年 9 月，我制订了购买页充值迁移的计划，直到今年的 6 月，才将页面迁移完成。</p>\n<p>　　4 月份运营需要充值页面支持更多的支付平台，以此为契机，就重构了此页面。</p>\n<p>　　核心业务都交给了服务端处理，并且将支付宝的充值逻辑也全部迁移到了服务端。</p>\n<p>　　12 月份，在排查定时任务的错误时，废弃了 6 个冗余和过时的定时任务。</p>\n<p>　　修改了 2 个定时任务的执行周期，原先是每多少分钟执行，现在改成每日执行一次，并且要避开高峰期。</p>\n<p>　　还让运维，关闭了一个已经不需要维护的榜单定时服务，节省资源开销。</p>\n<p>　　今年还发现了两个老旧的 Node 服务需要待迁移，6 月份，发现了个经验加成业务；8 月份，发现了个短信发送的服务。</p>\n<p>　　其中第一个业务本来想移交出去，但服务端说没有时间重构，只得继续维护。</p>\n<p>　　顺带一提，这两个业务的 Node 环境还停留在 8.7（最新的是 24），并且依赖了个私有 npm 包。</p>\n<p>　　2025 年我还跟产品提到了分享页面的重构，并且她们也做了简易的产品文档，希望 2026 年能够实现迁移。</p>\n<p><span style=\"font-size: 16px;\"><strong>3）飞书机器人</strong></span></p>\n<p>　　飞书机器人就是以对话的方式实现某个功能，在前几年就已引入。</p>\n<p>　　但主要是做些告警和数据推送的功能，今年我们团队拓展了机器人，赋予了更多功能。</p>\n<p>　　团队内的成员在 6 月份封装了一整套的机器人逻辑，包含了 IP 白名单，代码发布等功能。</p>\n<p>　　IP 白名单是公司所有人都需要的，之前都是让我们团队的人添加或者有权限的人添加，现在通过机器人可以自己添加。</p>\n<p>　　在 8 月份，我也在机器人中添加了查询某个第一名用户的功能。</p>\n<p>　　另一名团队成员增加了管理后台密码更新验证码的功能，帮助同事们可以自主完成密码的更新，而不是找我们。</p>\n<p>　　对于机器人的业务挖掘，我们还在不断探索中。</p>\n<p><span style=\"font-size: 16px;\"><strong>4）监控系统</strong></span></p>\n<p>　　自研的前端监控系统在今年排查线上问题时，发挥了很大的作用，累计每日可减少 1.5W 个左右的错误。</p>\n<p>　　帮助我们排查页面白屏问题，对外的活动页面都是基于 Vue3 生成的，即 CSR 的渲染方式。</p>\n<p>　　通过监控系统的行为轨迹，我们发现，白屏基本都是没有读取正确的脚本导致的。</p>\n<p>　　有的是访问到了失效的缓存副本，有的是访问服务器中删除的脚本。</p>\n<p>　　当监控到白屏时，就会在页面中跳出一个弹框，经过 3 轮迭代，弹框中会包含强制刷新的按钮，更换浏览器的提示。</p>\n<p>　　并且用脚本动态的给资源文件增加时间戳，破坏资源缓存。</p>\n<p>　　而在排查问题时，还发现监控系统行为轨迹只存在 7 天，因为原先读的是 MySQL，里面只存储了 7 天数据。</p>\n<p>　　显然太少了，于是就将数据源改成 ElasticSearch，直接增加至 2 月。</p>\n<p>　　在 7 月底，还对监控数量进行了优化，从 200W 降低到了 100W 左右，减少存储成本。</p>\n<p>　　注释掉了通用组件内的打印日志，每日减少监控记录 47W 条；过滤了 4 条不重要的接口，每日记录可减少近 50W 条。</p>\n<p><span style=\"font-size: 16px;\"><strong>5）全链路监控</strong></span></p>\n<p>　　其实在 2023 年就尝试了日志全链路追踪，就是在 Node 环境中，能精准的甄别出一个通信的所有相关日志。</p>\n<p>　　在今年的 3 月份，团队成员也尝试了基于 AsyncLocalStorage 的日志追踪。</p>\n<p>　　不过在线上实验时，都出现了问题，日志还是会混淆。7 月份我尝试在 Node 项目内引入了 SkyWalking 全链路监控。</p>\n<p>　　阿里云推荐的一种链路追踪，基于官方文档配置和加载依赖后，就在运行了。</p>\n<p>　　但是有个接口过滤参数，咨询阿里云，提问 AI，都没搞明白怎么用，最后还是看源码才知道了如何使用。</p>\n<p>　　上线运行，的确能看到日志链路，并且还能看到接口调用的来回时间。</p>\n<p>　　值得一提的是，在12 月份，自己也在接口日志中加了来回的响应时间，这样就能知道是自己的逻辑慢还是内部接口慢。</p>\n<p>　　不过在上线后，发生了意想不到的意外，就是原先可以链式调用的 Mongoose 的方法，但现在会报错。</p>\n<p>　　无奈，先将其下线了，不过好在，通过链路日志，我已经知道慢响应的瓶颈何在了。</p>\n<p><span style=\"font-size: 16px;\"><strong>6）团队建设</strong></span></p>\n<p>　　3 月份人员补充后，就又重启了团队内部的技术分享，到年底，我们团队内部分享了 40 多场各类的技术分享。</p>\n<p>　　我现在建议大家分享的内容尽量贴合当前的业务需求，这样写起来也能简单些，并且不空洞。</p>\n<p>　　在自己表达思路的同时，也能让自己有更深刻的认识，并且也能帮助团队其他成员开阔认知。</p>\n<p>　　在实际开发中，团队成员有几次都使用了分享中的技术知识点。</p>\n<p>　　新人加入几周后，他们在完成一两个项目后，我们开启了几场 Code Review，主要是看看他们的思路和写法。</p>\n<p>　　抛出各自的问题，并想办法解决，我们不强制代码规范，但写的代码至少别人能看懂。</p>\n<p>　　能写注释的尽量多些注释，能语义化的尽量语义化，不需要太追求极致的性能。</p>\n<p>　　年底的时候，公司管理层在推广 AI 辅助编程，我们团队 AI 的使用也比较广泛，相信 2026 年能有更多突破。</p>\n<p>　　12 月与产品配合，尝试了通过 PRD 生成 H5 页面，虽然其中还不乏各种问题，但这是一种很好的协作尝试。</p>\n<p>　　在团队成员分享 AI 的使用时，发现了些问题，例如后台封装了通用组件，但在用 AI 生成代码后直接弃用了这类组件。</p>\n<p>　　这样就是开倒车了，维护性方面将大打折扣。\u0010</p>\n<p>　　国外的 AI 工具不少，不过好多都限制中国区域不可用，有点被围剿的意思。</p>\n<p><span style=\"font-size: 16px;\"><strong>7）项目管理</strong></span></p>\n<p>　　公司有两条产品线，而管理后台写在一套代码中，这就导致在构建项目时会比较慢。</p>\n<p>　　那这个时候其实有很多方法可供选择，例如拆分成两个独立的后台，但如此一来，公共代码也要拆分成两份维护。</p>\n<p>　　或者采用微前端技术，剥离一个项目出来，不过有一定的开发成本。</p>\n<p>　　在观察后发现，构建会根据路由文件来，如果路由文件中没有声明，那么就不会将此文件纳入构建流程中。</p>\n<p>　　于是在 7 月份，声明了两份路由文件，大家维护各自的路由。并且让运维创建了两套流水线，和两个域名。</p>\n<p>　　在完成路由构建后，前后的代码发布总时间减少了 3 分钟以上。</p>\n<p>　　经过一个月左右的时间，陆续将测试、预发和生产的三个环境的发布流水线部署完成。</p>\n<p>　　在 12 月份，团队成员提出，对外活动现在分成了两个项目，但是有些组件是共用的。</p>\n<p>　　每次人工的复制黏贴，难免会遗漏或出错。管理后台是分，而这里却是合。</p>\n<p>　　我们想到了 Monorepo 目录管理，将两个项目整合在一个目录内管理，抽象出共用部分。</p>\n<p>　　同样为了实验，让运维部署了两条新的业务线，以及两个新域名，目前还在调试中。</p>\n<h1>三、日常生活</h1>\n<p>　　今年小孩读两年级了，周末还得在家陪着写作业，然后带他去上篮球课、钢琴课等兴趣课。</p>\n<p>　　偶尔周末来个短途自驾游，然后下班后刷刷短剧，小红书等。</p>\n<p>　　去年买了很多卡，今年又不想要了，就出了很大一部分，但大部分都亏本了，好在 30 周年水浒卡回了好多血。</p>\n<p><span style=\"font-size: 16px;\"><strong>1）旅行</strong></span></p>\n<p>　　今年总共去了 8 个地方旅行，最远的是过年期间的广州，其他都是在江浙周边，自驾或高铁。</p>\n<p>　　包括嘉兴南湖、南浔古镇、苏州博物馆、无锡拈花湾、绍兴柯岩景区、千岛湖、舟山等。</p>\n<p>　　在无锡的两次都想去太湖边上的三国水浒城，但总是因为种种原因没去成，可惜了。</p>\n<p>　　广州那边我每天都要买一杯鲜榨甘蔗汁，粤菜我也很喜欢，都是现烧的，所以上菜会慢点。</p>\n<p>　　每一家饭店的菠萝古老肉是我必点的，还体验了下当地的早茶，店里几乎都是老人，很少看到年轻人。</p>\n<p>　　广州特别热闹，北京路那边和南京路差不多，过年期间乌泱泱的人。</p>\n<p><span style=\"font-size: 16px;\"><strong>2）水浒卡</strong></span></p>\n<p>　　3 月份的时候参与了小浣熊 30 周年水浒卡的众筹，这次众筹特别魔幻。</p>\n<p>　　卡的价值翻了十多倍，一些赠品价格也都直接起飞，例如亲签评级卡最高都达到了 5 位数。</p>\n<p>　　本来以为大家都知道，没想到，大部分人都不知道这个众筹。</p>\n<p>　　很多人为了追忆童年，都入坑买卡，导致卡的价值直线上升。</p>\n<p>　　4 月份，还到处与人换卡，线下碰头，线上快递，多管齐下，为了集齐 30 周年的水浒套卡，也是拼了。</p>\n<p>　　当月，开始将自己不想要的卡都陆陆续续出掉，出的价格很难赚，基本都是亏本出了。</p>\n<p>　　还有些自己当年留的卡，也都出掉了，再加上 30 周年的卡，回了好多血，把账抹平了。</p>\n<p>　　还能多一些卡在手，不过，这么看来，我是不适合做生意的，老老实实打工了。</p>\n<p>&nbsp;</p>\n</div>\n<div class=\"clear\"></div>\n\n\t<div class=\"postDesc\"><img align=\"absmiddle\" src=\"/skins/gray/images/speech.gif\" />&nbsp;posted on \n<span id=\"post-date\">2026-01-27 10:53</span>&nbsp;\n<a href=\"https://www.cnblogs.com/strick\">咖啡机（K.F.J）</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "控制权限系列之（2）手把手教你使用基于角色的权限控制",
      "link": "https://www.cnblogs.com/Marktowin/p/19536935",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/Marktowin/p/19536935\" id=\"cb_post_title_url\" title=\"发布于 2026-01-27 10:43\">\n    <span>控制权限系列之（2）手把手教你使用基于角色的权限控制</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p>前一篇已经分析了多种权限模型，其中比较常用的是基于角色的权限控制。</p>\n<h3><strong>基于角色的权限控制</strong></h3>\n<h4><strong>表设计：</strong></h4>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 0, 1);\">用户表\n用户</span>--<span style=\"color: rgba(0, 0, 0, 1);\">角色关系表\n角色表\n角色</span>--<span style=\"color: rgba(0, 0, 0, 1);\">菜单关系表\n菜单表</span></pre>\n</div>\n<h4><strong>权限标识格式：</strong></h4>\n<div class=\"cnblogs_code\">\n<pre>格式：xxx:xxx:xxx（模块:资源:操作） 三段式</pre>\n</div>\n<h4>权限架构的分层结构：</h4>\n<div>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 0, 1);\">应用层 (@RequirePermission注解)\n    ↓\n权限验证层 (PermissionValidator)\n    ↓\n权限上下文层 (PermissionContext </span>-<span style=\"color: rgba(0, 0, 0, 1);\"> ThreadLocal)\n    ↓\n权限提供层 (PermissionProvider </span>- 数据库/<span style=\"color: rgba(0, 0, 0, 1);\">缓存)\n    ↓\n权限存储层 (PermissionStorage </span>- Redis/Memory)</pre>\n</div>\n<p>&nbsp;</p>\n<h3>权限架构接口：</h3>\n<h4>权限提供者接口</h4>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">interface</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionProvider {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 获取用户的所有权限标识</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 3</span>     Set&lt;String&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> getUserPermissions(Object userId);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 5</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 获取用户角色列表</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>     Set&lt;String&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> getUserRoles(Object userId);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 8</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 检查用户是否为超级管理员</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 9</span>     <span style=\"color: rgba(0, 0, 255, 1);\">boolean</span><span style=\"color: rgba(0, 0, 0, 1);\"> isSuperAdmin(Object userId);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">11</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 刷新用户权限缓存</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">12</span>     <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> refreshUserPermissions(Object userId);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">13</span> }</pre>\n</div>\n<ul class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\"><code>userId</code>&nbsp;使用&nbsp;<code>Object</code>&nbsp;类型，支持 String、Long 等不同ID类型</li>\n<li class=\"code-line\" dir=\"auto\">支持超级管理员逻辑（拥有所有权限）</li>\n<li class=\"code-line\" dir=\"auto\">提供刷新接口，支持权限变更后更新缓存</li>\n</ul>\n<h4 class=\"code-line\" dir=\"auto\" id=\"22-%E6%9D%83%E9%99%90%E5%AD%98%E5%82%A8%E6%8E%A5%E5%8F%A3-permissionstorage\">权限存储接口</h4>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">interface</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionStorage {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 存储用户权限信息</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 3</span>     <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> storeUserInfo(String token, UserInfo userInfo);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 5</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 获取用户权限信息</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 6</span> <span style=\"color: rgba(0, 0, 0, 1);\">    UserInfo getUserInfo(String token);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 8</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 删除用户权限信息</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 9</span>     <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> removeUserInfo(String token);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">11</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 刷新用户权限信息</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">12</span>     <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> refreshUserInfo(String token, UserInfo userInfo);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">13</span> }</pre>\n</div>\n<ul class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">基于Token存储，支持分布式场景</li>\n<li class=\"code-line\" dir=\"auto\">支持多种存储实现（Redis、Memory、数据库等）</li>\n<li class=\"code-line\" dir=\"auto\">提供刷新接口，支持权限实时更新</li>\n</ul>\n<h4 class=\"code-line\" dir=\"auto\" id=\"23-%E6%9D%83%E9%99%90%E5%8C%B9%E9%85%8D%E5%99%A8%E6%8E%A5%E5%8F%A3-permissionmatcher\">权限匹配器接口</h4>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">interface</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionMatcher {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 匹配权限</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 3</span>     <span style=\"color: rgba(0, 0, 255, 1);\">boolean</span> match(String requiredPermission, Set&lt;String&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> userPermissions);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 5</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 批量匹配（全部满足）</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>     <span style=\"color: rgba(0, 0, 255, 1);\">boolean</span> matchAll(Set&lt;String&gt; requiredPermissions, Set&lt;String&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> userPermissions);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 8</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 批量匹配（任意一个满足）</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 9</span>     <span style=\"color: rgba(0, 0, 255, 1);\">boolean</span> matchAny(Set&lt;String&gt; requiredPermissions, Set&lt;String&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> userPermissions);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span> }</pre>\n</div>\n<ul class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">支持多种匹配策略（精确、通配符、正则等）</li>\n<li class=\"code-line\" dir=\"auto\">支持批量匹配（AND/OR逻辑）</li>\n<li class=\"code-line\" dir=\"auto\">可扩展自定义匹配规则</li>\n</ul>\n<h4 class=\"code-line\" dir=\"auto\" id=\"24-%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E6%A8%A1%E5%9E%8B-userinfo\">用户信息</h4>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\">1</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> UserInfo {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">2</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span> Object userId;                    <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 用户ID</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">3</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span> String username;                  <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 用户名</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">4</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span> Set&lt;String&gt; permissions;          <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 权限集合</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">5</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span> Set&lt;String&gt; roles;                <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 角色集合</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">6</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">boolean</span> superAdmin;               <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 是否超级管理员</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">7</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span> Map&lt;String, Object&gt; attributes;   <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 扩展属性</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">8</span> }</pre>\n</div>\n<ul class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">使用&nbsp;<code>Object</code>&nbsp;类型支持不同ID类型</li>\n<li class=\"code-line\" dir=\"auto\">提供扩展属性，支持业务字段存储</li>\n<li class=\"code-line\" dir=\"auto\">轻量级设计，便于序列化和传输</li>\n</ul>\n<h4 class=\"code-line\" dir=\"auto\" id=\"25-%E6%9D%83%E9%99%90%E4%B8%8A%E4%B8%8B%E6%96%87-permissioncontext\">权限上下文</h4>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionContext {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">final</span> ThreadLocal&lt;UserInfo&gt; USER_INFO_HOLDER = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> TransmittableThreadLocal&lt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 5</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> set(UserInfo userInfo);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span><span style=\"color: rgba(0, 0, 0, 1);\"> UserInfo get();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> clear();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 8</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 9</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">boolean</span><span style=\"color: rgba(0, 0, 0, 1);\"> hasPermission(String permission);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> Set&lt;String&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> getPermissions();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">11</span> }</pre>\n</div>\n<ul class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">使用&nbsp;<code>TransmittableThreadLocal</code>&nbsp;支持线程池传递</li>\n<li class=\"code-line\" dir=\"auto\">提供便捷方法，简化权限判断</li>\n<li class=\"code-line\" dir=\"auto\">请求结束后自动清理，避免内存泄漏</li>\n</ul>\n<h4 class=\"code-line\" dir=\"auto\" id=\"26-%E6%9D%83%E9%99%90%E9%AA%8C%E8%AF%81%E5%99%A8%E6%8E%A5%E5%8F%A3-permissionvalidator\">权限验证器接口</h4>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">interface</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionValidator {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 验证单个权限</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 3</span>     <span style=\"color: rgba(0, 0, 255, 1);\">boolean</span><span style=\"color: rgba(0, 0, 0, 1);\"> hasPermission(String permission);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 5</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 验证所有权限（AND）</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>     <span style=\"color: rgba(0, 0, 255, 1);\">boolean</span> hasAllPermissions(Set&lt;String&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> permissions);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 8</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 验证任意权限（OR）</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 9</span>     <span style=\"color: rgba(0, 0, 255, 1);\">boolean</span> hasAnyPermission(Set&lt;String&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> permissions);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">11</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 验证角色</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">12</span>     <span style=\"color: rgba(0, 0, 255, 1);\">boolean</span><span style=\"color: rgba(0, 0, 0, 1);\"> hasRole(String role);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">13</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">14</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 获取当前用户上下文</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">15</span> <span style=\"color: rgba(0, 0, 0, 1);\">    UserContext getCurrentUser();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">16</span> }</pre>\n</div>\n<ul class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">提供多种验证方式（单个、全部、任意）</li>\n<li class=\"code-line\" dir=\"auto\">支持角色验证</li>\n<li class=\"code-line\" dir=\"auto\">统一权限验证入口</li>\n</ul>\n<h3 class=\"code-line\" dir=\"auto\" id=\"%E4%B8%89%E5%AE%9E%E7%8E%B0%E7%AD%96%E7%95%A5\">实现策略</h3>\n<h4 class=\"code-line\" dir=\"auto\" id=\"%E6%8A%BD%E8%B1%A1%E6%9D%83%E9%99%90%E6%8F%90%E4%BE%9B%E8%80%85-abstractpermissionprovider\">抽象权限提供者</h4>\n<ul class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">提供模板方法，定义权限获取流程</li>\n<li class=\"code-line\" dir=\"auto\">子类只需实现具体查询逻辑</li>\n<li class=\"code-line\" dir=\"auto\">统一处理超级管理员逻辑</li>\n</ul>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">abstract</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span> AbstractPermissionProvider <span style=\"color: rgba(0, 0, 255, 1);\">implements</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionProvider {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 3</span> <span style=\"color: rgba(0, 0, 0, 1);\">    @Override\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> Set&lt;String&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> getUserPermissions(Object userId) {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 5</span>         <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 方法：统一处理超管</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>         <span style=\"color: rgba(0, 0, 255, 1);\">if</span><span style=\"color: rgba(0, 0, 0, 1);\"> (isSuperAdmin(userId)) {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> getAllPermissions();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 8</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 9</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> doGetUserPermissions(userId);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">11</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">12</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 子类实现：获取所有权限</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">13</span>     <span style=\"color: rgba(0, 0, 255, 1);\">protected</span> <span style=\"color: rgba(0, 0, 255, 1);\">abstract</span> Set&lt;String&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> getAllPermissions();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">14</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">15</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 子类实现：查询用户权限</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">16</span>     <span style=\"color: rgba(0, 0, 255, 1);\">protected</span> <span style=\"color: rgba(0, 0, 255, 1);\">abstract</span> Set&lt;String&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> doGetUserPermissions(Object userId);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">17</span> }</pre>\n</div>\n<h4 class=\"code-line\" dir=\"auto\" id=\"redis%E5%AD%98%E5%82%A8-redispermissionstorage\">Redis存储</h4>\n<ol class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">使用Redis存储用户信息（JSON序列化）</li>\n<li class=\"code-line\" dir=\"auto\">支持过期时间配置</li>\n<li class=\"code-line\" dir=\"auto\">支持Key前缀配置</li>\n<li class=\"code-line\" dir=\"auto\">异常处理和日志记录</li>\n</ol>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span> RedisPermissionStorage <span style=\"color: rgba(0, 0, 255, 1);\">implements</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionStorage {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 3</span> <span style=\"color: rgba(0, 0, 0, 1);\">    @Override\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> storeUserInfo(String token, UserInfo userInfo) {</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span> <span style=\"color: rgba(0, 0, 0, 1);\">        redisTemplate.opsForValue().set(key, value, expireSeconds, TimeUnit.SECONDS);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 8</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 9</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">10</span> <span style=\"color: rgba(0, 0, 0, 1);\">    @Override\n</span><span style=\"color: rgba(0, 128, 128, 1);\">11</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> UserInfo getUserInfo(String token) {</span><span style=\"color: rgba(0, 128, 128, 1);\">14</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span> value<span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">15</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">16</span> }</pre>\n</div>\n<ul class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">支持&nbsp;<code>*</code>&nbsp;和&nbsp;<code>?</code>&nbsp;通配符</li>\n<li class=\"code-line\" dir=\"auto\">例如：<code>sys:user:*</code>&nbsp;匹配&nbsp;<code>sys:user:save</code>、<code>sys:user:update</code>&nbsp;等</li>\n<li class=\"code-line\" dir=\"auto\">使用Spring的&nbsp;<code>PatternMatchUtils.simpleMatch()</code></li>\n</ul>\n<h4 class=\"code-line\" dir=\"auto\" id=\"34-%E6%9D%83%E9%99%90%E8%BF%87%E6%BB%A4%E5%99%A8%E5%AE%9E%E7%8E%B0\">权限过滤器</h4>\n<ol class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">请求头提取Token</li>\n<li class=\"code-line\" dir=\"auto\">从Storage获取用户信息（如不存在，从Provider加载）</li>\n<li class=\"code-line\" dir=\"auto\">设置到PermissionContext</li>\n<li class=\"code-line\" dir=\"auto\">请求结束后清理上下文</li>\n</ol>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 0, 1);\"><strong>过滤器流程：</strong><br /><br />请求到达\n    ↓\n检查排除路径（登录、公开接口等）\n    ↓\n提取Token\n    ↓\n从Storage获取用户信息\n    ↓（如果不存在）\n从Provider加载用户信息 → 存储到Storage\n    ↓\n设置到PermissionContext\n    ↓\n继续请求处理\n    ↓\n清理PermissionContext</span></pre>\n</div>\n<h4 class=\"code-line\" dir=\"auto\" id=\"%E6%9D%83%E9%99%90%E6%B3%A8%E8%A7%A3-requirepermission\">权限注解&nbsp;</h4>\n<ul class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">支持单个权限、多个权限（AND/OR）</li>\n<li class=\"code-line\" dir=\"auto\">支持角色验证</li>\n<li class=\"code-line\" dir=\"auto\">支持自定义错误消息</li>\n</ul>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 0, 1);\">@Target({ElementType.METHOD, ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n</span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> @<span style=\"color: rgba(0, 0, 255, 1);\">interface</span><span style=\"color: rgba(0, 0, 0, 1);\"> RequirePermission {\n    String value() </span><span style=\"color: rgba(0, 0, 255, 1);\">default</span> \"\";           <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 单个权限</span>\n    String[] all() <span style=\"color: rgba(0, 0, 255, 1);\">default</span> {};            <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 全部权限（AND）</span>\n    String[] any() <span style=\"color: rgba(0, 0, 255, 1);\">default</span> {};            <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 任意权限（OR）</span>\n    String role() <span style=\"color: rgba(0, 0, 255, 1);\">default</span> \"\";              <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 单个角色</span>\n    String message() <span style=\"color: rgba(0, 0, 255, 1);\">default</span> \"权限不足\";   <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 错误消息</span>\n}</pre>\n</div>\n<h4 class=\"code-line\" dir=\"auto\" id=\"aop%E5%88%87%E9%9D%A2%E5%AE%9E%E7%8E%B0\">AOP切面</h4>\n<ol class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">拦截&nbsp;<code>@RequirePermission</code>&nbsp;注解的方法</li>\n<li class=\"code-line\" dir=\"auto\">从PermissionContext获取用户信息</li>\n<li class=\"code-line\" dir=\"auto\">调用PermissionValidator验证权限</li>\n<li class=\"code-line\" dir=\"auto\">验证失败抛出异常</li>\n</ol>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 0, 1);\">@Aspect\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionAspect {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 3</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     @Before(\"@annotation(RequirePermission)\"<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 5</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> checkPermission(JoinPoint joinPoint) {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>         RequirePermission annotation =<span style=\"color: rgba(0, 0, 0, 1);\"> getAnnotation(joinPoint);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>         \n<span style=\"color: rgba(0, 128, 128, 1);\"> 8</span>         <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 验证权限</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 9</span>         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">permissionValidator.hasPermission(annotation.value())) {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span>             <span style=\"color: rgba(0, 0, 255, 1);\">throw</span> <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionDeniedException(annotation.message());\n</span><span style=\"color: rgba(0, 128, 128, 1);\">11</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">12</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">13</span> }</pre>\n</div>\n<h3>与SpringBoot项目集成</h3>\n<h4 class=\"code-line\" dir=\"auto\"><strong>配置类设计</strong>：</h4>\n<ul class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\">自动配置各个组件</li>\n<li class=\"code-line\" dir=\"auto\">支持条件装配（@ConditionalOnMissingBean）</li>\n<li class=\"code-line\" dir=\"auto\">提供默认实现</li>\n</ul>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 0, 1);\">@Configuration\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span> @EnableConfigurationProperties(PermissionProperties.<span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 3</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionAutoConfiguration {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 5</span> <span style=\"color: rgba(0, 0, 0, 1);\">    @Bean\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 6</span> <span style=\"color: rgba(0, 0, 0, 1);\">    @ConditionalOnMissingBean\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionMatcher permissionMatcher() {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 8</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span> <span style=\"color: rgba(0, 0, 255, 1);\">new</span> WildcardPermissionMatcher(); \n<span style=\"color: rgba(0, 128, 128, 1);\"> 9</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">11</span> <span style=\"color: rgba(0, 0, 0, 1);\">    @Bean\n</span><span style=\"color: rgba(0, 128, 128, 1);\">12</span> <span style=\"color: rgba(0, 0, 0, 1);\">    @ConditionalOnMissingBean\n</span><span style=\"color: rgba(0, 128, 128, 1);\">13</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionValidator permissionValidator(PermissionMatcher matcher) {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">14</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span> <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> DefaultPermissionValidator(matcher);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">15</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">16</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">17</span> <span style=\"color: rgba(0, 0, 0, 1);\">    @Bean\n</span><span style=\"color: rgba(0, 128, 128, 1);\">18</span> <span style=\"color: rgba(0, 0, 0, 1);\">    @ConditionalOnMissingBean\n</span><span style=\"color: rgba(0, 128, 128, 1);\">19</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionFilter permissionFilter(...) {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">20</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span> <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionFilter(...);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">21</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">22</span> }</pre>\n</div>\n<h4><strong>使用示例：</strong></h4>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 0, 1);\">@RestController\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span> @RequestMapping(\"/api/user\"<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 3</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> UserController {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 5</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 单个权限验证</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>     @GetMapping(\"/list\"<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>     @RequirePermission(\"sys:user:list\"<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 8</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> ResponseEntity&lt;List&lt;User&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> list() {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 9</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> ResponseEntity.ok(userService.list());\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">11</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">12</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 多个权限（全部满足）</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">13</span>     @PutMapping(\"/{id}\"<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">14</span>     @RequirePermission(all = {\"sys:user:update\", \"sys:user:edit\"<span style=\"color: rgba(0, 0, 0, 1);\">})\n</span><span style=\"color: rgba(0, 128, 128, 1);\">15</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> ResponseEntity&lt;Void&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> update(@PathVariable Long id, @RequestBody User user) {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">16</span> <span style=\"color: rgba(0, 0, 0, 1);\">        userService.update(id, user);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">17</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> ResponseEntity.ok().build();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">18</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">19</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">20</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 多个权限（任意一个）</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">21</span>     @DeleteMapping(\"/{id}\"<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">22</span>     @RequirePermission(any = {\"sys:user:delete\", \"sys:user:remove\"<span style=\"color: rgba(0, 0, 0, 1);\">})\n</span><span style=\"color: rgba(0, 128, 128, 1);\">23</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> ResponseEntity&lt;Void&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> delete(@PathVariable Long id) {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">24</span> <span style=\"color: rgba(0, 0, 0, 1);\">        userService.delete(id);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">25</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> ResponseEntity.ok().build();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">26</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">27</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">28</span>     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 角色验证</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">29</span>     @GetMapping(\"/admin\"<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">30</span>     @RequirePermission(role = \"ADMIN\"<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">31</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> ResponseEntity&lt;String&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> adminOnly() {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">32</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span> ResponseEntity.ok(\"Admin only\"<span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">33</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">34</span> }</pre>\n</div>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> <span style=\"color: rgba(0, 0, 0, 1);\">@Service\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span> <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> UserService {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 3</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 4</span> <span style=\"color: rgba(0, 0, 0, 1);\">    @Autowired\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 5</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span><span style=\"color: rgba(0, 0, 0, 1);\"> PermissionValidator permissionValidator;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> deleteUser(Long userId) {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 8</span>         \n<span style=\"color: rgba(0, 128, 128, 1);\"> 9</span>         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!permissionValidator.hasPermission(\"sys:user:delete\"<span style=\"color: rgba(0, 0, 0, 1);\">)) {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span>             <span style=\"color: rgba(0, 0, 255, 1);\">throw</span> <span style=\"color: rgba(0, 0, 255, 1);\">new</span> PermissionDeniedException(\"无删除权限\"<span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">11</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">12</span>         \n<span style=\"color: rgba(0, 128, 128, 1);\">13</span> <span style=\"color: rgba(0, 0, 0, 1);\">        userRepository.delete(userId);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">14</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">15</span>     \n<span style=\"color: rgba(0, 128, 128, 1);\">16</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> UserContext getCurrentUser() {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">17</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> permissionValidator.getCurrentUser();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">18</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span>19 }</pre>\n</div>\n<h3 class=\"code-line\" dir=\"auto\">总结：</h3>\n<ol class=\"code-line\" dir=\"auto\">\n<li class=\"code-line\" dir=\"auto\"><strong>接口抽象</strong>：所有核心功能都通过接口定义，便于扩展</li>\n<li class=\"code-line\" dir=\"auto\"><strong>分层设计</strong>：Provider → Storage → Matcher → Validator，职责清晰</li>\n<li class=\"code-line\" dir=\"auto\"><strong>上下文管理</strong>：使用ThreadLocal，支持异步场景</li>\n<li class=\"code-line\" dir=\"auto\"><strong>配置化</strong>：SQL、路径等可配置，适应不同项目</li>\n<li class=\"code-line\" dir=\"auto\"><strong>默认实现</strong>：提供常用实现，开箱即用</li>\n</ol>\n<p class=\"code-line\" dir=\"auto\">按照以上设计思路，可实现一个灵活易用的权限控制框架。</p>\n<p class=\"code-line\" dir=\"auto\">&nbsp;</p>\n<p class=\"code-line\" dir=\"auto\">&nbsp;</p>\n</div>\n<p>&nbsp;</p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-27 10:43</span>&nbsp;\n<a href=\"https://www.cnblogs.com/Marktowin\">Marktowin</a>&nbsp;\n阅读(<span id=\"post_view_count\">22</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    }
  ]
}