{
  "title": "主页 - 博客园",
  "link": "https://www.cnblogs.com/",
  "description": "主页 - 博客园 RSS",
  "entries": [
    {
      "title": "完善基于WPF开发的标尺控件（含实例代码）",
      "link": "https://www.cnblogs.com/wuty/p/19559302",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/wuty/p/19559302\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 22:35\">\n    <span>完善基于WPF开发的标尺控件（含实例代码）</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<h2>前言：</h2>\n<p>在2021年的时候，有个拖拽的项目用到了标尺的控件，我写了一篇大概实现代码的博客：<a href=\"https://www.cnblogs.com/wuty/p/15580195.html\">仿Word的支持横轴竖轴的WPF 标尺 - wuty007 - 博客园</a>。在里边的实例代码里边，鼠标横纵坐标移动显示的代码没有完善。直到上个月有个水友发信息找我要源码。趁着这段时间正在使用AI编程，于是让AI帮我补充一下代码了</p>\n<p><img alt=\"image\" height=\"249\" src=\"https://img2024.cnblogs.com/blog/1063618/202601/1063618-20260131221035351-1118901133.png\" width=\"888\" /></p>\n<h2>代码完善：&nbsp;</h2>\n<p>1、本次使用的是腾讯Codebuddy的AI编程插件，文件结构如下：</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1063618/202601/1063618-20260131221521902-1205357599.png\" /></p>\n<p>&nbsp;</p>\n<p>2、2021年开发的标尺核心的代码：</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Collections.Generic;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Diagnostics;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Globalization;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Linq;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Text;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Threading.Tasks;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Controls;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Input;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Media.Media3D;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Media;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Shapes;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows;\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">namespace</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDemo\n{\n    [TemplatePart(Name </span>= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">verticalTrackLine</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, Type = <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(Line))]\n    [TemplatePart(Name </span>= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">horizontalTrackLine</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, Type = <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(Line))]\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">internal</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerControl : Control\n    {\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">readonly</span> DependencyProperty DpiProperty = DependencyProperty.Register(nameof(Dpi), <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(Dpi), <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(RulerControl));\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">readonly</span> DependencyProperty DisplayPercentProperty = DependencyProperty.Register(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DisplayPercent</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(<span style=\"color: rgba(0, 0, 255, 1);\">double</span>), <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(RulerControl));\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">readonly</span> DependencyProperty DisplayTypeProperty = DependencyProperty.Register(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DisplayType</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(RulerDisplayType), <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(RulerControl));\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">readonly</span> DependencyProperty DisplayUnitProperty = DependencyProperty.Register(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DisplayUnit</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(RulerDisplayUnit), <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(RulerControl));\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">readonly</span> DependencyProperty ZeroPointProperty = DependencyProperty.Register(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">ZeroPoint</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(<span style=\"color: rgba(0, 0, 255, 1);\">double</span>), <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(RulerControl));\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 定义静态构造函数\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">static</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerControl()\n        {\n            DefaultStyleKeyProperty.OverrideMetadata(</span><span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(RulerControl), <span style=\"color: rgba(0, 0, 255, 1);\">new</span> FrameworkPropertyMetadata(<span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(RulerControl)));\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">#region</span> 属性\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 屏幕分辨率\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> Dpi Dpi\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span> =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> ((Dpi)GetValue(DpiProperty));\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">set</span> =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> SetValue(DpiProperty, value);\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 设置0点从哪里开始\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\"> ZeroPoint\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span> =&gt; ((<span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\">)GetValue(ZeroPointProperty));\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">\n            {\n                SetValue(ZeroPointProperty, value);\n                InvalidateVisual();\n            }\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 显示的比率（目前支持0-1的选项）\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\"> DisplayPercent\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span> =&gt; ((<span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\">)GetValue(DisplayPercentProperty));\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (value &gt; <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                {\n                    value </span>= <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                }\n                SetValue(DisplayPercentProperty, value);\n                InvalidateVisual();\n            }\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 显示的类型：枚举类（支持横向或者竖向）\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType DisplayType\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span> =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> ((RulerDisplayType)GetValue(DisplayTypeProperty));\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">set</span> =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> SetValue(DisplayTypeProperty, value);\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 显示的单位：cm和pixel\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayUnit DisplayUnit\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span> =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> ((RulerDisplayUnit)GetValue(DisplayUnitProperty));\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">set</span> =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> SetValue(DisplayUnitProperty, value);\n        }\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">#endregion</span>\n\n        <span style=\"color: rgba(0, 0, 255, 1);\">#region</span> 常量\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">const</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span> InchCm = <span style=\"color: rgba(128, 0, 128, 1);\">2.54</span>; <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">一英寸为2.54cm</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">const</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> P100StepSpanPixel = <span style=\"color: rgba(128, 0, 128, 1);\">100</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">const</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> P100StepSpanCm = <span style=\"color: rgba(128, 0, 128, 1);\">2</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">const</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> P100StepCountPixel = <span style=\"color: rgba(128, 0, 128, 1);\">20</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">const</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> P100StepCountCm = <span style=\"color: rgba(128, 0, 128, 1);\">20</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">#endregion</span>\n\n        <span style=\"color: rgba(0, 0, 255, 1);\">#region</span> 变量\n        <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\"> _minStepLengthCm;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\"> _maxStepLengthCm;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\"> _actualLength;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> _stepSpan;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> _stepCount;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\"> _stepLength;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span><span style=\"color: rgba(0, 0, 0, 1);\"> Line _mouseVerticalTrackLine;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span><span style=\"color: rgba(0, 0, 0, 1);\"> Line _mouseHorizontalTrackLine;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">#endregion</span>\n\n        <span style=\"color: rgba(0, 0, 255, 1);\">#region</span> 标尺边框加指针显示\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> RaiseHorizontalRulerMoveEvent(MouseEventArgs e)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> mousePoint = e.GetPosition(<span style=\"color: rgba(0, 0, 255, 1);\">this</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            Debug.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">水平标尺 - 鼠标位置: X={mousePoint.X}, Y={mousePoint.Y}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (_mouseHorizontalTrackLine != <span style=\"color: rgba(0, 0, 255, 1);\">null</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 水平标尺：移动垂直跟踪线，X跟随鼠标</span>\n                _mouseHorizontalTrackLine.X1 = _mouseHorizontalTrackLine.X2 =<span style=\"color: rgba(0, 0, 0, 1);\"> mousePoint.X;\n                </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> Y坐标从0开始，延伸足够长</span>\n                _mouseHorizontalTrackLine.Y1 = <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                _mouseHorizontalTrackLine.Y2 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">5000</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                _mouseHorizontalTrackLine.Visibility </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> Visibility.Visible;\n\n                Debug.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">水平标尺 - 垂直线更新: X1={_mouseHorizontalTrackLine.X1}, Y1={_mouseHorizontalTrackLine.Y1}, X2={_mouseHorizontalTrackLine.X2}, Y2={_mouseHorizontalTrackLine.Y2}, Visibility={_mouseHorizontalTrackLine.Visibility}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            }\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> RaiseVerticalRulerMoveEvent(MouseEventArgs e)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> mousePoint = e.GetPosition(<span style=\"color: rgba(0, 0, 255, 1);\">this</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            Debug.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">垂直标尺 - 鼠标位置: X={mousePoint.X}, Y={mousePoint.Y}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (_mouseVerticalTrackLine != <span style=\"color: rgba(0, 0, 255, 1);\">null</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 垂直标尺：移动水平跟踪线，Y跟随鼠标</span>\n                _mouseVerticalTrackLine.Y1 = _mouseVerticalTrackLine.Y2 =<span style=\"color: rgba(0, 0, 0, 1);\"> mousePoint.Y;\n                </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> X坐标从0开始，延伸足够长</span>\n                _mouseVerticalTrackLine.X1 = <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                _mouseVerticalTrackLine.X2 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">5000</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                _mouseVerticalTrackLine.Visibility </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> Visibility.Visible;\n\n                Debug.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">垂直标尺 - 水平线更新: X1={_mouseVerticalTrackLine.X1}, Y1={_mouseVerticalTrackLine.Y1}, X2={_mouseVerticalTrackLine.X2}, Y2={_mouseVerticalTrackLine.Y2}, Visibility={_mouseVerticalTrackLine.Visibility}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            }\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">override</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> OnApplyTemplate()\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">base</span><span style=\"color: rgba(0, 0, 0, 1);\">.OnApplyTemplate();\n            _mouseVerticalTrackLine </span>= GetTemplateChild(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">verticalTrackLine</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>) <span style=\"color: rgba(0, 0, 255, 1);\">as</span><span style=\"color: rgba(0, 0, 0, 1);\"> Line;\n            _mouseHorizontalTrackLine </span>= GetTemplateChild(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">horizontalTrackLine</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>) <span style=\"color: rgba(0, 0, 255, 1);\">as</span><span style=\"color: rgba(0, 0, 0, 1);\"> Line;\n           \n            Debug.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">OnApplyTemplate调用: _mouseVerticalTrackLine={_mouseVerticalTrackLine != null}, _mouseHorizontalTrackLine={_mouseHorizontalTrackLine != null}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        }\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">#endregion</span>\n\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 重画标尺数据\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"drawingContext\"&gt;&lt;/param&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">protected</span> <span style=\"color: rgba(0, 0, 255, 1);\">override</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> OnRender(DrawingContext drawingContext)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">try</span><span style=\"color: rgba(0, 0, 0, 1);\">\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> pen = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Pen(<span style=\"color: rgba(0, 0, 255, 1);\">new</span> SolidColorBrush(Colors.Black), <span style=\"color: rgba(128, 0, 128, 1);\">0.8d</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                pen.Freeze();\n                Initialize();\n                GetActualLength();\n                GetStep();\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">base</span><span style=\"color: rgba(0, 0, 0, 1);\">.OnRender(drawingContext);\n\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">this</span>.BorderBrush = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> SolidColorBrush(Colors.Black);\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">this</span>.BorderThickness = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Thickness(<span style=\"color: rgba(128, 0, 128, 1);\">0.1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">this</span>.Background = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> SolidColorBrush(Colors.White);\n\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">#region</span> try\n                <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> double actualPx = this._actualLength / DisplayPercent;</span>\n                <span style=\"color: rgba(0, 0, 255, 1);\">var</span> currentPosition = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> Position\n                {\n                    CurrentStepIndex </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n                    Value </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                };\n\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayType)\n                {\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Horizontal:\n                        {\n                            </span><span style=\"color: rgba(0, 128, 0, 1);\">/*</span><span style=\"color: rgba(0, 128, 0, 1);\"> 绘制前半段 </span><span style=\"color: rgba(0, 128, 0, 1);\">*/</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                            DrawLine(drawingContext, ZeroPoint, currentPosition, pen, </span><span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                            </span><span style=\"color: rgba(0, 128, 0, 1);\">/*</span><span style=\"color: rgba(0, 128, 0, 1);\"> 绘制后半段 </span><span style=\"color: rgba(0, 128, 0, 1);\">*/</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                            DrawLine(drawingContext, ZeroPoint, currentPosition, pen, </span><span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Vertical:\n                        {\n                            </span><span style=\"color: rgba(0, 128, 0, 1);\">/*</span><span style=\"color: rgba(0, 128, 0, 1);\"> 绘制前半段 </span><span style=\"color: rgba(0, 128, 0, 1);\">*/</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                            DrawLine(drawingContext, ZeroPoint, currentPosition, pen, </span><span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                            </span><span style=\"color: rgba(0, 128, 0, 1);\">/*</span><span style=\"color: rgba(0, 128, 0, 1);\"> 绘制后半段 </span><span style=\"color: rgba(0, 128, 0, 1);\">*/</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                            DrawLine(drawingContext, ZeroPoint, currentPosition, pen, </span><span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">#endregion</span><span style=\"color: rgba(0, 0, 0, 1);\">\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">catch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Exception ex)\n            {\n                Console.WriteLine(ex.Message);\n            }\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span> DrawLine(DrawingContext drawingContext, <span style=\"color: rgba(0, 0, 255, 1);\">double</span> currentPoint, Position currentPosition, Pen pen, <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> type)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">while</span> (<span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> linePercent =<span style=\"color: rgba(0, 0, 0, 1);\"> 0d;\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                {\n\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> formattedText = GetFormattedText((currentPosition.Value / <span style=\"color: rgba(128, 0, 128, 1);\">10</span><span style=\"color: rgba(0, 0, 0, 1);\">).ToString());\n\n\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayType)\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Horizontal:\n                            {\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> point = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Point(currentPoint + formattedText.Width / <span style=\"color: rgba(128, 0, 128, 1);\">2</span>, formattedText.Height / <span style=\"color: rgba(128, 0, 128, 1);\">3</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (point.X &lt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                                drawingContext.DrawText(formattedText, point);\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                            }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Vertical:\n                            {\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> point = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Point(<span style=\"color: rgba(0, 0, 255, 1);\">this</span>.ActualWidth, currentPoint + formattedText.Height / <span style=\"color: rgba(128, 0, 128, 1);\">2</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> rotateTransform = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> RotateTransform(<span style=\"color: rgba(128, 0, 128, 1);\">90</span><span style=\"color: rgba(0, 0, 0, 1);\">, point.X, point.Y);\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (point.Y &lt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                                drawingContext.PushTransform(rotateTransform);\n                                drawingContext.DrawText(formattedText, point);\n                                drawingContext.Pop();\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                            }\n                    }\n\n                    linePercent </span>= (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)LinePercent.P100;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (IsFinalNum(currentPosition.CurrentStepIndex, <span style=\"color: rgba(128, 0, 128, 1);\">3</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n                {\n                    linePercent </span>= (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)LinePercent.P30;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (IsFinalNum(currentPosition.CurrentStepIndex, <span style=\"color: rgba(128, 0, 128, 1);\">5</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n                {\n                    linePercent </span>= (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)LinePercent.P50;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (IsFinalNum(currentPosition.CurrentStepIndex, <span style=\"color: rgba(128, 0, 128, 1);\">7</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n                {\n                    linePercent </span>= (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)LinePercent.P30;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (IsFinalNum(currentPosition.CurrentStepIndex, <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n                {\n                    linePercent </span>= (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)LinePercent.P70;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                {\n                    linePercent </span>= (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)LinePercent.P20;\n                }\n\n                linePercent </span>= linePercent * <span style=\"color: rgba(128, 0, 128, 1);\">0.01</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayType)\n                {\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Horizontal:\n                        {\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPoint &gt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                            {\n                                drawingContext.DrawLine(pen, </span><span style=\"color: rgba(0, 0, 255, 1);\">new</span> Point(currentPoint, <span style=\"color: rgba(128, 0, 128, 1);\">0</span>), <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Point(currentPoint, <span style=\"color: rgba(0, 0, 255, 1);\">this</span>.ActualHeight *<span style=\"color: rgba(0, 0, 0, 1);\"> linePercent));\n                            }\n\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (type == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                            {\n                                currentPoint </span>= currentPoint -<span style=\"color: rgba(0, 0, 0, 1);\"> _stepLength;\n                                currentPosition.CurrentStepIndex</span>--<span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex &lt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    currentPosition.CurrentStepIndex </span>= _stepCount - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                    currentPosition.Value </span>= GetNextStepValue(currentPosition.Value, _stepSpan, <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                }\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.Value % _stepSpan != <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        currentPosition.Value </span>= GetNextStepValue(currentPosition.Value, _stepSpan, <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                }\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPoint &lt;= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                            }\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                            {\n                                currentPoint </span>= currentPoint +<span style=\"color: rgba(0, 0, 0, 1);\"> _stepLength;\n                                currentPosition.CurrentStepIndex</span>++<span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex &gt;=<span style=\"color: rgba(0, 0, 0, 1);\"> _stepCount)\n                                {\n                                    currentPosition.CurrentStepIndex </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                    currentPosition.Value </span>= GetNextStepValue(currentPosition.Value, _stepSpan, <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                }\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPoint &gt;=<span style=\"color: rgba(0, 0, 0, 1);\"> _actualLength)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                            }\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Vertical:\n                        {\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPoint &gt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                            {\n                                drawingContext.DrawLine(pen, </span><span style=\"color: rgba(0, 0, 255, 1);\">new</span> Point(<span style=\"color: rgba(128, 0, 128, 1);\">0</span>, currentPoint), <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Point(<span style=\"color: rgba(0, 0, 255, 1);\">this</span>.ActualWidth *<span style=\"color: rgba(0, 0, 0, 1);\"> linePercent, currentPoint));\n                            }\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (type == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                            {\n                                currentPoint </span>= currentPoint -<span style=\"color: rgba(0, 0, 0, 1);\"> _stepLength;\n                                currentPosition.CurrentStepIndex</span>--<span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex &lt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    currentPosition.CurrentStepIndex </span>= _stepCount - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                    currentPosition.Value </span>= GetNextStepValue(currentPosition.Value, _stepSpan, <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                }\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.Value % _stepSpan != <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        currentPosition.Value </span>= GetNextStepValue(currentPosition.Value, _stepSpan, <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                }\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPoint &lt;= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                            }\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                            {\n                                currentPoint </span>= currentPoint +<span style=\"color: rgba(0, 0, 0, 1);\"> _stepLength;\n                                currentPosition.CurrentStepIndex</span>++<span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex &gt;=<span style=\"color: rgba(0, 0, 0, 1);\"> _stepCount)\n                                {\n                                    currentPosition.CurrentStepIndex </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                    currentPosition.Value </span>= GetNextStepValue(currentPosition.Value, _stepSpan, <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                }\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPoint &gt;=<span style=\"color: rgba(0, 0, 0, 1);\"> _actualLength)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                            }\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                }\n            }\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 获取下一个步长值\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"value\"&gt;</span><span style=\"color: rgba(0, 128, 0, 1);\">起始值</span><span style=\"color: rgba(128, 128, 128, 1);\">&lt;/param&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"times\"&gt;</span><span style=\"color: rgba(0, 128, 0, 1);\">跨度</span><span style=\"color: rgba(128, 128, 128, 1);\">&lt;/param&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"type\"&gt;</span><span style=\"color: rgba(0, 128, 0, 1);\">半段类型，分为前半段、后半段</span><span style=\"color: rgba(128, 128, 128, 1);\">&lt;/param&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> GetNextStepValue(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> value, <span style=\"color: rgba(0, 0, 255, 1);\">int</span> times, <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> type)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (type == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">do</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                {\n                    value</span>--<span style=\"color: rgba(0, 0, 0, 1);\">;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">while</span> (value % times != <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">do</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                {\n                    value</span>++<span style=\"color: rgba(0, 0, 0, 1);\">;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">while</span> (value % times != <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> (value);\n        }\n\n        [Obsolete]\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> FormattedText GetFormattedText(<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\"> text)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> (<span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> FormattedText(text,\n                          </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">CultureInfo.GetCultureInfo(\"zh-cn\"),</span>\n                          CultureInfo.GetCultureInfo(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">en-us</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">),\n                          FlowDirection.LeftToRight,\n                          </span><span style=\"color: rgba(0, 0, 255, 1);\">new</span> Typeface(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">宋体</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">),\n                          </span><span style=\"color: rgba(128, 0, 128, 1);\">12</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n                          Brushes.Black));\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">bool</span> IsFinalNum(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> value, <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> finalNum)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> valueStr =<span style=\"color: rgba(0, 0, 0, 1);\"> value.ToString();\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (valueStr.Substring(valueStr.Length - <span style=\"color: rgba(128, 0, 128, 1);\">1</span>, <span style=\"color: rgba(128, 0, 128, 1);\">1</span>) ==<span style=\"color: rgba(0, 0, 0, 1);\"> finalNum.ToString())\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> (<span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> (<span style=\"color: rgba(0, 0, 255, 1);\">false</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 初始化获取屏幕的DPI\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> Initialize()\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> dpi = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> Dpi();\n            dpi.DpiX </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> Dpi.DpiX;\n            dpi.DpiY </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> Dpi.DpiY;\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (Dpi.DpiX == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                dpi.DpiX </span>= <span style=\"color: rgba(128, 0, 128, 1);\">96</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            }\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (Dpi.DpiY == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                dpi.DpiY </span>= <span style=\"color: rgba(128, 0, 128, 1);\">96</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            }\n\n            Dpi </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> dpi;\n            _minStepLengthCm </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0.1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            _maxStepLengthCm </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0.3</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (DisplayPercent == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                DisplayPercent </span>= <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayUnit)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayUnit.Pixel:\n                    {\n                        _stepSpan </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> P100StepSpanPixel;\n                        _stepCount </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> P100StepCountPixel;\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayUnit.Cm:\n                    {\n                        _stepSpan </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> P100StepSpanCm;\n                        _stepCount </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> P100StepCountCm;\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> width = <span style=\"color: rgba(128, 0, 128, 1);\">15</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayType)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Horizontal:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (<span style=\"color: rgba(0, 0, 255, 1);\">this</span>.ActualHeight == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                        {\n                            Height </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> width;\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Vertical:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (<span style=\"color: rgba(0, 0, 255, 1);\">this</span>.ActualWidth == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                        {\n                            Width </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> width;\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n            }\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 获取每一个数字间隔的跨度\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> GetStep()\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayUnit)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayUnit.Pixel:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">while</span> (<span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                        {\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> stepSpanCm = _stepSpan / Convert.ToDouble(GetDpi()) * InchCm *<span style=\"color: rgba(0, 0, 0, 1);\"> DisplayPercent;\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> stepLengthCm = stepSpanCm /<span style=\"color: rgba(0, 0, 0, 1);\"> _stepCount;\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> type = <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> isOut = <span style=\"color: rgba(0, 0, 255, 1);\">false</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepLengthCm &gt;<span style=\"color: rgba(0, 0, 0, 1);\"> _maxStepLengthCm)\n                            {\n                                type </span>= <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                _stepCount </span>= GetNextStepCount(_stepCount, type, <span style=\"color: rgba(0, 0, 255, 1);\">ref</span><span style=\"color: rgba(0, 0, 0, 1);\"> isOut);\n                            }\n\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepLengthCm &lt;<span style=\"color: rgba(0, 0, 0, 1);\"> _minStepLengthCm)\n                            {\n                                type </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                _stepCount </span>= GetNextStepCount(_stepCount, type, <span style=\"color: rgba(0, 0, 255, 1);\">ref</span><span style=\"color: rgba(0, 0, 0, 1);\"> isOut);\n                            }\n\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepLengthCm &lt;= _maxStepLengthCm &amp;&amp; stepLengthCm &gt;=<span style=\"color: rgba(0, 0, 0, 1);\"> _minStepLengthCm)\n                            {\n                                _stepLength </span>= stepSpanCm / InchCm * Convert.ToDouble(GetDpi()) /<span style=\"color: rgba(0, 0, 0, 1);\"> _stepCount;\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                            }\n                            </span><span style=\"color: rgba(0, 128, 0, 1);\">/*</span><span style=\"color: rgba(0, 128, 0, 1);\"> 已超出或小于最大步进长度 </span><span style=\"color: rgba(0, 128, 0, 1);\">*/</span>\n                            <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!isOut) <span style=\"color: rgba(0, 0, 255, 1);\">continue</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                            _stepSpan </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> GetNextStepSpan(_stepSpan, type);\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n            }\n        }\n\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> GetNextStepCount(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> stepCount, <span style=\"color: rgba(0, 0, 255, 1);\">int</span> type, <span style=\"color: rgba(0, 0, 255, 1);\">ref</span> <span style=\"color: rgba(0, 0, 255, 1);\">bool</span><span style=\"color: rgba(0, 0, 0, 1);\"> isOut)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> result =<span style=\"color: rgba(0, 0, 0, 1);\"> stepCount;\n            isOut </span>= <span style=\"color: rgba(0, 0, 255, 1);\">false</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (type)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span> <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCount == <span style=\"color: rgba(128, 0, 128, 1);\">20</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                        {\n                            result </span>= <span style=\"color: rgba(128, 0, 128, 1);\">10</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                        {\n                            isOut </span>= <span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span> <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCount == <span style=\"color: rgba(128, 0, 128, 1);\">10</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                        {\n                            result </span>= <span style=\"color: rgba(128, 0, 128, 1);\">20</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                        {\n                            isOut </span>= <span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> result;\n        }\n\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> GetNextStepSpan(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> stepSpan, <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> type)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> stepCountStr =<span style=\"color: rgba(0, 0, 0, 1);\"> stepSpan.ToString();\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> resultStr = <span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.Empty;\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayUnit)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayUnit.Pixel:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (type)\n                        {\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span> <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCountStr.IndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">5</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>) &gt; -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        resultStr </span>= GetNumberAndZeroNum(<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">, stepCountStr.Length);\n                                    }\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCountStr.IndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">2</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>) &gt; -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        resultStr </span>= GetNumberAndZeroNum(<span style=\"color: rgba(128, 0, 128, 1);\">5</span>, stepCountStr.Length - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCountStr.IndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">1</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>) &gt; -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        resultStr </span>= GetNumberAndZeroNum(<span style=\"color: rgba(128, 0, 128, 1);\">2</span>, stepCountStr.Length - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span> <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCountStr.IndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">5</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>) &gt; -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        resultStr </span>= GetNumberAndZeroNum(<span style=\"color: rgba(128, 0, 128, 1);\">2</span>, stepCountStr.Length - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCountStr.IndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">2</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>) &gt; -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        resultStr </span>= GetNumberAndZeroNum(<span style=\"color: rgba(128, 0, 128, 1);\">1</span>, stepCountStr.Length - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCountStr.IndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">1</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>) &gt; -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        resultStr </span>= GetNumberAndZeroNum(<span style=\"color: rgba(128, 0, 128, 1);\">5</span>, stepCountStr.Length - <span style=\"color: rgba(128, 0, 128, 1);\">2</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n            }\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.IsNullOrWhiteSpace(resultStr))\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            }\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (<span style=\"color: rgba(0, 0, 255, 1);\">int</span>.TryParse(resultStr, <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">var</span><span style=\"color: rgba(0, 0, 0, 1);\"> result))\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> result;\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> result;\n        }\n\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span> GetNumberAndZeroNum(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> num, <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> zeroNum)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> result = <span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.Empty;\n            result </span>+=<span style=\"color: rgba(0, 0, 0, 1);\"> num;\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> i = <span style=\"color: rgba(128, 0, 128, 1);\">0</span>; i &lt; zeroNum; i++<span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                result </span>+= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">0</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> (result);\n        }\n\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> GetDpi()\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayType)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Horizontal:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Dpi.DpiX);\n                    }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Vertical:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Dpi.DpiY);\n                    }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">default</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Dpi.DpiX);\n                    }\n            }\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> GetActualLength()\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayType)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Horizontal:\n                    {\n                        _actualLength </span>= <span style=\"color: rgba(0, 0, 255, 1);\">this</span><span style=\"color: rgba(0, 0, 0, 1);\">.ActualWidth;\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Vertical:\n                    {\n                        _actualLength </span>= <span style=\"color: rgba(0, 0, 255, 1);\">this</span><span style=\"color: rgba(0, 0, 0, 1);\">.ActualHeight;\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n            }\n        }\n    }\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">enum</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType\n    {\n        Horizontal, Vertical\n    }\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">enum</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayUnit\n    {\n        Pixel,\n        Cm\n    }\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">enum</span><span style=\"color: rgba(0, 0, 0, 1);\"> LinePercent\n    {\n        P20 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">20</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n        P30 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">30</span><span style=\"color: rgba(0, 0, 0, 1);\">, \n        P50 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">50</span><span style=\"color: rgba(0, 0, 0, 1);\">, \n        P70 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">70</span><span style=\"color: rgba(0, 0, 0, 1);\">, \n        P100 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">100</span><span style=\"color: rgba(0, 0, 0, 1);\">\n    }\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">struct</span><span style=\"color: rgba(0, 0, 0, 1);\"> Dpi\n    {\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> DpiX\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        }\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> DpiY\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        }\n    }\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">struct</span><span style=\"color: rgba(0, 0, 0, 1);\"> Position\n    {\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> Value\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        }\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> CurrentStepIndex\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        }\n    }\n}</span></pre>\n</div>\n<p>3、在原来的代码中，增加对横纵坐标的定义和补充</p>\n<div class=\"cnblogs_code\">\n<pre> [TemplatePart(Name = <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">verticalTrackLine</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, Type = <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(Line))]\n [TemplatePart(Name </span>= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">horizontalTrackLine</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, Type = <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(Line))]</pre>\n</div>\n<p>4、增加对标尺控件的样式实现</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">ResourceDictionary </span><span style=\"color: rgba(255, 0, 0, 1);\">xmlns</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                    xmlns:x</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/winfx/2006/xaml\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                    xmlns:local</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"clr-namespace:RulerDemo\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Style </span><span style=\"color: rgba(255, 0, 0, 1);\">TargetType</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"</span><span style=\"color: rgba(128, 128, 0, 1);\">{x:Type local:RulerControl}</span><span style=\"color: rgba(0, 0, 255, 1);\">\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Setter </span><span style=\"color: rgba(255, 0, 0, 1);\">Property</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Template\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Setter.Value</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n                <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">ControlTemplate </span><span style=\"color: rgba(255, 0, 0, 1);\">TargetType</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"</span><span style=\"color: rgba(128, 128, 0, 1);\">{x:Type local:RulerControl}</span><span style=\"color: rgba(0, 0, 255, 1);\">\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n                    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n                        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">ContentPresenter</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n                        <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> 垂直跟踪线（垂直线，X坐标固定，Y跨越整个高度） </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n                        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Line </span><span style=\"color: rgba(255, 0, 0, 1);\">x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"verticalTrackLine\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              Stroke</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Red\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              StrokeThickness</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"1\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              StrokeDashArray</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"2,2\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              X1</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Y1</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> X2</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Y2</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"2000\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              Visibility</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Collapsed\"</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n                        <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> 水平跟踪线（水平线，Y坐标固定，X跨越整个宽度） </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n                        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Line </span><span style=\"color: rgba(255, 0, 0, 1);\">x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"horizontalTrackLine\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              Stroke</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Blue\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              StrokeThickness</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"1\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              StrokeDashArray</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"2,2\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              X1</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Y1</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> X2</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"2000\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Y2</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              Visibility</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Collapsed\"</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n                    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n                <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">ControlTemplate</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Setter.Value</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Setter</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Style</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">ResourceDictionary</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span></pre>\n</div>\n<p>5、CanvaseCoreEditor控件的包装</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">UserControl </span><span style=\"color: rgba(255, 0, 0, 1);\">x:Class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"RulerDemo.CanvaseCoreEditor\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             xmlns</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             xmlns:x</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/winfx/2006/xaml\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             xmlns:mc</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             xmlns:d</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/expression/blend/2008\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             xmlns:local</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"clr-namespace:RulerDemo\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             mc:Ignorable</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"d\"</span><span style=\"color: rgba(255, 0, 0, 1);\">   x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"CanvaseEditor\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             d:DesignHeight</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"450\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> d:DesignWidth</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"800\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n\n    <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> 主网格，使用 ClipToBounds 确保内容不溢出 </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid </span><span style=\"color: rgba(255, 0, 0, 1);\">x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"MainGrid\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> ClipToBounds</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"True\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid.ColumnDefinitions</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">ColumnDefinition </span><span style=\"color: rgba(255, 0, 0, 1);\">Width</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"20\"</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">ColumnDefinition</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid.ColumnDefinitions</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid.RowDefinitions</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">RowDefinition </span><span style=\"color: rgba(255, 0, 0, 1);\">Height</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"20\"</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">RowDefinition</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid.RowDefinitions</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n\n        <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> 横向标尺 </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">local:RulerControl </span><span style=\"color: rgba(255, 0, 0, 1);\">DisplayUnit</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"pixel\"</span><span style=\"color: rgba(255, 0, 0, 1);\">  DisplayType</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Horizontal\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Grid.Row</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Grid.Column</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"1\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"ucPanleHor\"</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n\n        <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> 纵向标尺 </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">local:RulerControl </span><span style=\"color: rgba(255, 0, 0, 1);\">DisplayUnit</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"pixel\"</span><span style=\"color: rgba(255, 0, 0, 1);\">  DisplayType</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Vertical\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Grid.Row</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"1\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Grid.Column</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"ucPanleVer\"</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">UserControl</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span></pre>\n</div>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Collections.Generic;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Linq;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Text;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Threading.Tasks;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Controls;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Data;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Documents;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Input;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Media;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Media.Imaging;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Navigation;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Shapes;\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">namespace</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDemo\n{\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> CanvaseCoreEditor.xaml 的交互逻辑\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">partial</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> CanvaseCoreEditor : UserControl\n    {\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> CanvaseCoreEditor()\n        {\n            InitializeComponent();\n           \n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> MainWindowMouseMove(MouseEventArgs e)\n        {\n            ucPanleHor.RaiseHorizontalRulerMoveEvent(e);\n            ucPanleVer.RaiseVerticalRulerMoveEvent(e);\n        }\n    }\n}</span></pre>\n</div>\n<p>6、主窗口显示调用</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Window </span><span style=\"color: rgba(255, 0, 0, 1);\">x:Class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"RulerDemo.MainWindow\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        xmlns</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        xmlns:x</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/winfx/2006/xaml\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        xmlns:d</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/expression/blend/2008\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        xmlns:mc</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        xmlns:local</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"clr-namespace:RulerDemo\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        mc:Ignorable</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"d\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        Title</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"MainWindow\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Height</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"450\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Width</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"800\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n\n\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">local:CanvaseCoreEditor </span><span style=\"color: rgba(255, 0, 0, 1);\">x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"CanvaseCoreEditor\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">local:CanvaseCoreEditor</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n\n\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Window</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span></pre>\n</div>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Diagnostics;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Text;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Controls;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Data;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Documents;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Input;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Media;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Media.Imaging;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Navigation;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Shapes;\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">namespace</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDemo\n{\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> Interaction logic for MainWindow.xaml\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">partial</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> MainWindow : Window\n    {\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> MainWindow()\n        {\n            InitializeComponent();\n            MouseMove </span>+=<span style=\"color: rgba(0, 0, 0, 1);\"> MainWindow_MouseMove;\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span> MainWindow_MouseMove(<span style=\"color: rgba(0, 0, 255, 1);\">object</span><span style=\"color: rgba(0, 0, 0, 1);\"> sender, MouseEventArgs e)\n        {\n            Debug.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">MainWindow_MouseMove</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            CanvaseCoreEditor.MainWindowMouseMove(e);\n        }\n    }\n}</span></pre>\n</div>\n<p>&nbsp;</p>\n<div>&nbsp;</div>\n<p>&nbsp;7、显示效果如下图</p>\n<p><img alt=\"标尺\" src=\"https://img2024.cnblogs.com/blog/1063618/202601/1063618-20260131223134838-550214321.gif\" /></p>\n<p>&nbsp;</p>\n<p>总结：</p>\n<p>1、本次完善都是通过腾讯Codebuddy的AI编程插件 帮忙完善，加上一小部分的人为的代码微调</p>\n<p>2、标尺的代码已经上传至Github：<a href=\"https://github.com/wutangyuan/wutyDemo/tree/main/RulerDemo\" rel=\"noopener nofollow\">wutyDemo/RulerDemo at main · wutangyuan/wutyDemo</a></p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 22:35</span>&nbsp;\n<a href=\"https://www.cnblogs.com/wuty\">wuty007</a>&nbsp;\n阅读(<span id=\"post_view_count\">30</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "开源自建，GPT 切换空间麻烦？一件帮你搞定",
      "link": "https://www.cnblogs.com/qxnm/p/19558462",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/qxnm/p/19558462\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 16:23\">\n    <span>开源自建，GPT 切换空间麻烦？一件帮你搞定</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p style=\"font-size: 0; line-height: 0; margin: 0;\">&nbsp;</p>\n<section>\n<blockquote>\n<p>字数 497，阅读大约需 3 分钟</p>\n</blockquote>\n<p>这几天给我忙的，最近写了一个Codex的TEAM 账号管理工具直接在本地运行<br />大概是下面这样肝了几天，能配合codex cli使用<br />有目前还有一些bug和不好用的地方，后面会逐步优化出来</p>\n<p>项目连接，需要的佬友希望能贡献一个start<br /><span>hongshungao/Codex-Manager: 一个Codex cli 账号管理与切换工具。为 Codex cli提供本地号池管理自动切换。<sup>[1]</sup></span></p>\n<h2 id=\"0\">ReadMe</h2>\n<p>本地桌面端 + 服务进程的 Codex 账号池管理器，用于统一管理账号、用量与平台 Key，并提供本地网关与服务能力。</p>\n<h2 id=\"1\">项目简介</h2>\n<ul>\n<li>• 桌面端（Tauri）负责账号管理、用量展示、授权登录与平台 Key 配置</li>\n<li>• 服务端（Rust）提供本地 RPC + Gateway，支持用量刷新、账号轮询与鉴权转发</li>\n<li>• 支持手动解析 OAuth 回调链接，避免端口冲突或回调失败</li>\n</ul>\n<h2 id=\"2\">功能亮点</h2>\n<ul>\n<li>• 账号池管理：分组/标签/排序/备注</li>\n<li>• 用量展示：5 小时 + 7 日用量快照</li>\n<li>• 授权登录：浏览器授权 + 手动回调解析</li>\n<li>• 平台 Key：生成/禁用/删除</li>\n<li>• 本地服务：自动启动、可自定义端口</li>\n<li>• 网关能力：为本地 CLI/工具提供统一入口</li>\n</ul>\n<h2 id=\"3\">技术栈</h2>\n<ul>\n<li>• 前端：Vite + 原生 JS + 自定义 UI</li>\n<li>• 桌面端：Tauri (Rust)</li>\n<li>• 服务端：Rust（本地 HTTP/RPC + Gateway）</li>\n</ul>\n<h2 id=\"4\">目录结构</h2>\n<pre class=\"language-plaintext highlighter-hljs\"><code>.\n├─&nbsp;apps/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;前端与&nbsp;Tauri&nbsp;桌面端\n│&nbsp;&nbsp;├─&nbsp;src/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;前端源码\n│&nbsp;&nbsp;├─&nbsp;src-tauri/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Tauri&nbsp;端源码\n│&nbsp;&nbsp;└─&nbsp;dist/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;前端构建产物\n├─&nbsp;crates/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Rust&nbsp;核心与服务端\n│&nbsp;&nbsp;├─&nbsp;gpttools-core\n│&nbsp;&nbsp;└─&nbsp;gpttools-service\n├─&nbsp;portable/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;便携版输出目录\n├─&nbsp;rebuild.ps1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;打包脚本\n└─&nbsp;README.md</code></pre>\n<h2 id=\"5\">快速开始</h2>\n<ol>\n<li>1. 启动桌面端后，点击“启动服务”</li>\n<li>2. 进入“账号管理”添加账号并完成授权</li>\n<li>3. 需要时粘贴回调链接完成手动解析</li>\n<li>4. 刷新用量，检查状态与配额</li>\n</ol>\n</section>\n<p style=\"font-size: 0; line-height: 0; margin: 0;\">&nbsp;</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 16:23</span>&nbsp;\n<a href=\"https://www.cnblogs.com/qxnm\">高宏顺</a>&nbsp;\n阅读(<span id=\"post_view_count\">24</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "C++ 封装 C FFI 接口最佳实践：以 Hugging Face Tokenizer 为例",
      "link": "https://www.cnblogs.com/charlee44/p/19557586",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/charlee44/p/19557586\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 13:36\">\n    <span>C++ 封装 C FFI 接口最佳实践：以 Hugging Face Tokenizer 为例</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        详细介绍了如何通过 Rust 的 C FFI 封装 Hugging Face tokenizers，并在 C++ 中利用 RAII 和智能指针实现安全、简洁、高效的资源管理，最终遵循现代 C++ 的“零法则”完成工业级封装。\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"1-引入\">1. 引入</h1>\n<p>在现代 AI 工程中，Hugging Face 的 tokenizers 库已成为分词器的事实标准。不过 Hugging Face 的 tokenizers 是用 Rust 来实现的，官方只提供了 python 和 node 的绑定实现。要实现与 Hugging Face tokenizers 相同的行为，最好的办法就是自己封装 Hugging Face tokenizers 的 C 绑定，从而可以被 C++ / C# / Java 这些高级编程语言调用。</p>\n<h1 id=\"2-封装-c-接口\">2. 封装 C 接口</h1>\n<p>首先要说明的是，要做的不是完整的封装 Hugging Face tokenizers 的 C 的 FFI（Foreign Function Interface）接口，而是封装自己需要的接口就可以了。比如执行分词接口和计算Token的接口：</p>\n<pre><code class=\"language-rust\">use std::ffi::CStr;\nuse std::os::raw::c_char;\nuse tokenizers::{PaddingParams, Tokenizer, TruncationParams};\n\n// === 1. 定义 C 兼容的返回结构体 ===\n#[repr(C)]\npub struct TokenizerResult {\n    pub input_ids: *mut i64,\n    pub attention_mask: *mut i64,\n    pub token_type_ids: *mut i64,\n    pub length: u64,\n}\n\n// === 2. 内部状态：包装 Tokenizer ===\nstruct TokenizerHandle {\n    tokenizer: Tokenizer,     // 用于 encode（带 padding）\n    raw_tokenizer: Tokenizer, // 用于 count（无 padding）\n}\n\n// === 3. 辅助函数：将 Rust Vec 转为 C 可拥有的指针 ===\nfn vec_to_c_ptr(vec: Vec&lt;i64&gt;) -&gt; *mut i64 {\n    let mut boxed = vec.into_boxed_slice();\n    let ptr = boxed.as_mut_ptr();\n    std::mem::forget(boxed); // 防止 Rust 自动释放\n    ptr\n}\n\n// === 4. 创建 tokenizer ===\n#[unsafe(no_mangle)] // 禁用 name mangling，让 C 能找到符号\npub extern \"C\" fn tokenizer_create(tokenizer_json_path: *const c_char) -&gt; *mut std::ffi::c_void {\n    if tokenizer_json_path.is_null() {\n        return std::ptr::null_mut();\n    }\n\n    let path_cstr = unsafe { CStr::from_ptr(tokenizer_json_path) };\n    let path_str = match path_cstr.to_str() {\n        Ok(s) =&gt; s,\n        Err(_) =&gt; return std::ptr::null_mut(),\n    };\n\n    let mut tokenizer = match Tokenizer::from_file(path_str) {\n        Ok(t) =&gt; t,\n        Err(_) =&gt; return std::ptr::null_mut(),\n    };\n\n    // 设置 padding/truncation 到 512（BGE 默认）\n    tokenizer.with_padding(Some(PaddingParams {\n        strategy: tokenizers::PaddingStrategy::Fixed(512),\n        ..Default::default()\n    }));\n\n    if tokenizer\n        .with_truncation(Some(TruncationParams {\n            max_length: 512,\n            ..Default::default()\n        }))\n        .is_err()\n    {\n        return std::ptr::null_mut();\n    }\n\n    let mut raw_tokenizer = tokenizer.clone();\n    raw_tokenizer.with_padding(None);\n    raw_tokenizer.with_truncation(None).ok();\n\n    let handle = TokenizerHandle {\n        tokenizer,\n        raw_tokenizer,\n    };\n    Box::into_raw(Box::new(handle)) as *mut std::ffi::c_void\n}\n\n//计算句子token\n#[unsafe(no_mangle)] // 禁用 name mangling，让 C 能找到符号\npub extern \"C\" fn tokenizer_count(handle: *mut std::ffi::c_void, text: *const c_char) -&gt; u64 {\n    if handle.is_null() || text.is_null() {\n        return 0;\n    }\n\n    let handle_ref = unsafe { &amp;*(handle as *mut TokenizerHandle) };\n\n    let text_cstr = unsafe { CStr::from_ptr(text) };\n    let text_str = match text_cstr.to_str() {\n        Ok(s) =&gt; s,\n        Err(_) =&gt; return 0,\n    };\n\n    match handle_ref.raw_tokenizer.encode(text_str, true) {\n        Ok(encoding) =&gt; encoding.len() as u64,\n        Err(_) =&gt; 0,\n    }\n}\n\n// === 5. 销毁 tokenizer ===\n#[unsafe(no_mangle)]\npub extern \"C\" fn tokenizer_destroy(handle: *mut std::ffi::c_void) {\n    if !handle.is_null() {\n        unsafe {\n            let _ = Box::from_raw(handle as *mut TokenizerHandle);\n            // Drop 自动调用\n        }\n    }\n}\n\n// === 6. 执行分词 ===\n#[unsafe(no_mangle)]\npub extern \"C\" fn tokenizer_encode(\n    handle: *mut std::ffi::c_void,\n    text: *const c_char,\n) -&gt; TokenizerResult {\n    let default_result = TokenizerResult {\n        input_ids: std::ptr::null_mut(),\n        attention_mask: std::ptr::null_mut(),\n        token_type_ids: std::ptr::null_mut(),\n        length: 0,\n    };\n\n    if handle.is_null() || text.is_null() {\n        return default_result;\n    }\n\n    let handle_ref = unsafe { &amp;*(handle as *mut TokenizerHandle) };\n\n    let text_cstr = unsafe { CStr::from_ptr(text) };\n    let text_str = match text_cstr.to_str() {\n        Ok(s) =&gt; s,\n        Err(_) =&gt; return default_result,\n    };\n\n    let encoding = match handle_ref.tokenizer.encode(text_str, true) {\n        Ok(e) =&gt; e,\n        Err(_) =&gt; return default_result,\n    };\n\n    let input_ids: Vec&lt;i64&gt; = encoding.get_ids().iter().map(|&amp;x| x as i64).collect();\n    let attention_mask: Vec&lt;i64&gt; = encoding\n        .get_attention_mask()\n        .iter()\n        .map(|&amp;x| x as i64)\n        .collect();\n    let token_type_ids: Vec&lt;i64&gt; = encoding.get_type_ids().iter().map(|&amp;x| x as i64).collect();\n    // BGE 不需要，但 C++ 代码传了\n    // let token_type_ids: Vec&lt;u32&gt; = vec![0u32; input_ids.len()];\n\n    let len = input_ids.len(); // 应该是 512，但更通用\n\n    TokenizerResult {\n        input_ids: vec_to_c_ptr(input_ids),\n        attention_mask: vec_to_c_ptr(attention_mask),\n        token_type_ids: vec_to_c_ptr(token_type_ids),\n        length: len as u64,\n    }\n}\n\n// === 7. 释放结果内存 ===\n#[unsafe(no_mangle)]\npub extern \"C\" fn tokenizer_result_free(result: TokenizerResult) {\n    if !result.input_ids.is_null() {\n        unsafe {\n            let _ = Vec::from_raw_parts(\n                result.input_ids,\n                result.length as usize,\n                result.length as usize,\n            );\n        }\n    }\n\n    if !result.attention_mask.is_null() {\n        unsafe {\n            let _ = Vec::from_raw_parts(\n                result.attention_mask,\n                result.length as usize,\n                result.length as usize,\n            );\n        }\n    }\n\n    if !result.token_type_ids.is_null() {\n        unsafe {\n            let _ = Vec::from_raw_parts(\n                result.token_type_ids,\n                result.length as usize,\n                result.length as usize,\n            );\n        }\n    }\n}\n</code></pre>\n<p>对应的 C 接口如下：</p>\n<pre><code class=\"language-c\">// tokenizer_result.h\n#pragma once\n\nstruct TokenizerResult {\n  int64_t* input_ids;\n  int64_t* attention_mask;\n  int64_t* token_type_ids;\n  uint64_t length;\n};\n\n#ifdef __cplusplus\nstatic_assert(std::is_standard_layout_v&lt;TokenizerResult&gt; &amp;&amp;\n                  std::is_trivially_copyable_v&lt;TokenizerResult&gt;,\n              \"TokenizerResult must be C ABI compatible\");\n#endif\n</code></pre>\n<pre><code class=\"language-c\">// hf_tokenizer_ffi.h\n#pragma once\n\n#include &lt;stdint.h&gt;\n\n#include \"tokenizer_result.h\"\n\n#ifdef __cplusplus\nextern \"C\" {\n#endif\n\nvoid* tokenizer_create(const char* tokenizer_json_path);\nvoid tokenizer_destroy(void* handle);\nTokenizerResult tokenizer_encode(void* handle, const char* text);\nuint64_t tokenizer_count(void* handle, const char* text);\nvoid tokenizer_result_free(TokenizerResult result);\n\n#ifdef __cplusplus\n}\n#endif\n</code></pre>\n<p>具体的封装细节笔者就不多说了，因为与本文的主题无关。不过可以稍稍了解一下其中的原理，也就是说，操作系统大多数是由 C 实现的，或者提供了 C 的接口。因此，绝大多数比 C 高级的编程语言都提供了与 C 交互的能力，当然前提是必须得按照 C 得规范组织数据和封装接口。比如这里的<code>struct TokenizerResult</code>就是一个兼容 C 的结构体，<code>#[unsafe(no_mangle)]</code>则表明这是一个 C 语言形式的函数接口。</p>\n<h1 id=\"3-经典-c-封装\">3. 经典 C++ 封装</h1>\n<p>如上接口是一个标准的 C 风格式的接口：将分词器封装成一个 Handle ，也就是俗称的句柄。而后续具体的分词操作就通过这个句柄来进行，包括最后对资源的释放。在 C++ 中，当然也可以直接使用这种形式的接口，不过这样就需要遵循 C 的资源控制规则：资源申请和释放必须成对出现——比如这里的 <code>tokenizer_create</code> 和 <code>tokenizer_destroy</code>。</p>\n<h2 id=\"31-raii-机制\">3.1 RAII 机制</h2>\n<p>不过这样就会有一个问题，过程式的流程中很难保证 <code>tokenizer_create</code> 和 <code>tokenizer_destroy</code> 能够成对调用，例如：</p>\n<pre><code class=\"language-c\">tokenizer_create()\n\nif(...){\n    return;\n}\n\ntokenizer_destroy()\n</code></pre>\n<p>只要在 <code>tokenizer_create</code> 和 <code>tokenizer_destroy</code> 之间出现分支，程序提前返回，就会导致资源没有释放而内存泄漏。为了避免这个问题，就需要在每次 <code>return</code> 之前，都调用 <code>tokenizer_destroy()</code>——这当然是非常不优雅的，既容易忘掉又是冗余代码。</p>\n<p>为了解决这种资源管理难题，C++ 提供了一种强大而优雅的机制：RAII（Resource Acquisition Is Initialization，资源获取即初始化）。它的核心思想是：将资源的生命周期绑定到对象的生命周期上。具体来说，就是利用面向对象的思想，将资源控制的行为封装成一个类对象，并且保证资源在对象构造函数中获取，在析构函数中自动释放。由于 C++ 中栈对象在离开作用域时会自动调用析构函数，在离开作用域时会自动调用析构函数。因此这些资源总是可以被正确释放，从根本上杜绝内存泄漏或资源泄露。例如：</p>\n<pre><code class=\"language-cpp\">Tokenizer tokenizer;\n\n//...操作\n\nif(...){\n    return;\n}\n\n//...更多操作\n</code></pre>\n<h2 id=\"32-拷贝语义\">3.2 拷贝语义</h2>\n<p>复习一下 C++ 面向对象设计的经典五法则（Rule of Five），如果一个类自定义了以下任意一个函数：</p>\n<ol>\n<li>析构函数（Destructor）</li>\n<li>拷贝构造函数（Copy Constructor）</li>\n<li>拷贝赋值运算符（Copy Assignment Operator）</li>\n<li>移动构造函数（Move Constructor）</li>\n<li>移动赋值运算符（Move Assignment Operator）</li>\n</ol>\n<p>那么大概率也需要自定义另外四个函数，或者显式 = default / = delete 来控制行为。很多 C++ 程序员并不理解移动语义，但这并没有关系，我们可以先假定不定义移动构造函数和移动赋值运算符（或者显式 = default），此时移动操作就会退化为拷贝语义的行为。</p>\n<p>而关于拷贝语义，绝大多数 C++ 程序员应该都知道这个问题：当在类对象中管理资源时，编译器生成的默认拷贝行为是“浅拷贝”，可能导致双重释放、内存泄漏等问题，因此需要自定义拷贝构造函数和拷贝赋值运算符来实现“深拷贝”的行为。因此，这个链条就很明确了：因为类中需要定义析构函数，所以需要同时定义拷贝构造函数和拷贝赋值运算符。</p>\n<h2 id=\"33-移动语义\">3.3 移动语义</h2>\n<p>进一步讨论，反正移动语义可以默认，那么是不是只用定义拷贝语义就行了呢？这个要看资源的定义：如果只是管理内存资源，那么这样做是没有问题的，至少是安全的。但是资源管理不仅仅指的是内存资源，还可以是一些文件句柄、网络连接等等。这些资源往往是独占性的，进行深拷贝往往会出现问题。因此就出现了 C++ 11 开始规定的移动语义：可以安全得实现“浅拷贝”的行为。同时还可以解决“深拷贝”的性能问题。</p>\n<p>基于以上的思想，笔者封装的分词器对象如下：</p>\n<pre><code class=\"language-cpp\">// HfTokenizer.h\n#pragma once\n\n#include &lt;string&gt;\n\n#include \"hf_tokenizer_ffi.h\"\n\nnamespace hf {\nclass Tokenizer {\n public:\n  explicit Tokenizer(const std::string&amp; path);\n\n  // 析构函数\n  ~Tokenizer() noexcept;\n\n  // 禁止拷贝\n  Tokenizer(const Tokenizer&amp;) = delete;\n  Tokenizer&amp; operator=(const Tokenizer&amp;) = delete;\n\n  // 移动语义\n  Tokenizer(Tokenizer&amp;&amp; rhs) noexcept;\n  Tokenizer&amp; operator=(Tokenizer&amp;&amp; rhs) noexcept;\n\n  // 其他接口方法\n  // TokenizerResult Encode(const char* text) const;\n  // uint64_t Count(const char* text) const;\n\n private:\n  void* handle;  // 来自 tokenizer_create 的指针\n};\n\n}  // namespace hf\n</code></pre>\n<pre><code class=\"language-cpp\">// HfTokenizer.cpp\n#include \"HfTokenizer.h\"\n\n#include &lt;iostream&gt;\n\nnamespace hf {\nTokenizer::Tokenizer(const std::string&amp; path)\n    : handle(tokenizer_create(path.c_str())) {\n  if (!handle) {\n    throw std::runtime_error(\"Failed to create tokenizer from \" + path);\n  }\n}\n\nTokenizer::~Tokenizer() noexcept {\n  if (handle) {\n    tokenizer_destroy(handle);\n  }\n}\n\n// 移动语义\nTokenizer::Tokenizer(Tokenizer&amp;&amp; rhs) noexcept : handle(rhs.handle) {\n  rhs.handle = nullptr;\n}\n\nTokenizer&amp; Tokenizer::operator=(Tokenizer&amp;&amp; rhs) noexcept {\n  if (this != &amp;rhs) {\n    if (handle) {\n      tokenizer_destroy(handle);\n    }\n    handle = rhs.handle;\n    rhs.handle = nullptr;\n  }\n  return *this;\n}\n\n}  // namespace hf\n</code></pre>\n<p>如前所述，因为封装的是一个句柄，为了避免资源控制的麻烦，就禁止掉拷贝语义：</p>\n<pre><code class=\"language-cpp\">// 禁止拷贝\nTokenizer(const Tokenizer&amp;) = delete;\nTokenizer&amp; operator=(const Tokenizer&amp;) = delete;\n</code></pre>\n<p>进行<code>()</code>拷贝构造或者<code>=</code>赋值构造看起来似乎很简单，其实在代码层层嵌套之后，就可能很难分析出是不是调用了默认的拷贝的行为，比如函数传参、容器操作等等。当然深拷贝的实现也不是性能最优，因此干脆就直接删除掉拷贝构造函数和拷贝赋值运算符。</p>\n<p>没有拷贝语义，那么就需要移动语义来进行传递对象了。其实移动语义没那么难，我们只要把握住一点，移动语义的目的是安全地实现“浅拷贝”。以移动赋值运算符的实现来说，如果要实现如下移动赋值：</p>\n<pre><code class=\"language-cpp\">Tokenizer A();\nTokenizer B();\nB = std::move(A);\n</code></pre>\n<p>就需要以下的行为：</p>\n<ol>\n<li>释放掉B管理的资源。</li>\n<li>将A中的成员“浅拷贝”到B中，让B接管A的资源。</li>\n<li>将A中成员初始化。</li>\n</ol>\n<p>具体实现就是如下所示：</p>\n<pre><code class=\"language-cpp\">Tokenizer&amp; Tokenizer::operator=(Tokenizer&amp;&amp; rhs) noexcept {\n  if (this != &amp;rhs) {\n    if (handle) {\n      tokenizer_destroy(handle);\n    }\n    handle = rhs.handle;\n    rhs.handle = nullptr;\n  }\n  return *this;\n}\n</code></pre>\n<p>移动构造函数就更加简单了，因为B对象在移动构造之前成员并没有初始化：</p>\n<pre><code class=\"language-cpp\">Tokenizer A();\nTokenizer B(std::move(A));\n</code></pre>\n<p>因此可以省略掉释放自身资源的步骤，具体实现也就是如下所示：</p>\n<pre><code class=\"language-cpp\">Tokenizer::Tokenizer(Tokenizer&amp;&amp; rhs) noexcept : handle(rhs.handle) {\n  rhs.handle = nullptr;\n}\n</code></pre>\n<p>最后还有一个问题：A通过移动语义转移到B了，A还能使用吗？不能也没必要使用A了，无论是A对象和B对象其实是一个栈对象（当然内部管理的数据成员可能放在堆上），或者说是一个值对象；这跟引用对象或者地址对象完全不同。移动语义的本质是对象所有权的转移，转移之后原对象中资源所有权就不存在了，即使强行访问，要么访问不到，要么会程序崩溃。</p>\n<h1 id=\"4-高级-c-封装\">4. 高级 C++ 封装</h1>\n<h2 id=\"41-零法则\">4.1 零法则</h2>\n<p>使用 RAII 机制 + 经典五法则来设计一个类对象，还有一个优点，就是使用这个类对象作为数据成员的类，就不用再显式实现析构函数。不用显式实现析构函数，也就意味着不用实现拷贝语义和移动语义，完全可以依赖类对象拷贝和移动的默认行为。举例来说，一个<code>MyResource</code>对象，管理着一段内存 buffer ，它的类定义为：</p>\n<pre><code class=\"language-cpp\">class MyResource {\npublic:\n    // 构造：申请资源\n    MyResource() {\n        data = new int[100];\n    }\n\n    // 析构：释放资源\n    ~MyResource() {\n        delete[] data;\n    }\n\n    // 拷贝构造：深拷贝\n    MyResource(const MyResource&amp; other) {\n        data = new int[100];\n        copy(other.data, other.data + 100, data);\n    }\n\n    // 拷贝赋值\n    MyResource&amp; operator=(const MyResource&amp; other) {\n        if (this != &amp;other) {\n            delete[] data;\n            data = new int[100];\n            copy(other.data, other.data + 100, data);\n        }\n        return *this;\n    }\n\n    // 移动构造：接管资源\n    MyResource(MyResource&amp;&amp; other) noexcept {\n        data = other.data;\n        other.data = nullptr;\n    }\n\n    // 移动赋值\n    MyResource&amp; operator=(MyResource&amp;&amp; other) noexcept {\n        if (this != &amp;other) {\n            delete[] data;\n            data = other.data;\n            other.data = nullptr;\n        }\n        return *this;\n    }\n\nprivate:\n    int* data = nullptr;\n};\n</code></pre>\n<p>但是如果我使用 std 容器<code>vector</code> ，相应的代码就可以简写为：</p>\n<pre><code class=\"language-cpp\">#include &lt;vector&gt;\n\nclass MyResource {\npublic:\n    // 构造：自动分配内存\n    MyResource() : data(100) {}  // vector&lt;int&gt; 自动初始化为 100 个元素\n\n    // ✅ 无需显式定义析构函数\n    // ✅ 无需自定义拷贝构造 / 拷贝赋值\n    // ✅ 无需自定义移动构造 / 移动赋值\n\n    // 编译器自动生成的版本已正确、高效、异常安全\n\nprivate:\n    std::vector&lt;int&gt; data;  // RAII 自动管理内存\n};\n</code></pre>\n<p>这不是因为 <code>vector</code> 使用了什么魔法，而是 <code>vector</code> 本身就是使用了 RAII 机制 + 经典五法则来设计的一个模板类对象！在 <code>MyResource</code> 对象进行拷贝或者移动的时候，作为数据成员，<code>std::vector&lt;int&gt; data</code>也会采取同样的拷贝或者移动的行为，并且默认的、由编译器自动生成的版本就可以正确处理。</p>\n<p>以上这个思想，就是现代 C++ 更推荐的<strong>零法则（Rule of Zero）</strong>：尽量不要手动管理资源，而是使用 RAII 类型让编译器自动生成所有特殊成员函数。而这个 RAII 类型，可以是 std 的任何容器对象、智能指针，也可以是自己按照五法则实现的类对象。</p>\n<h2 id=\"42-智能指针\">4.2 智能指针</h2>\n<p>回到本文引入的问题，如果我的分词器实现不像写拷贝语义和移动语义怎么办呢？毕竟都是样板代码，写不好还容易出问题。此时我们就可以使用智能指针 <code>unique_ptr</code> 。常规意义上，我们都知道智能指针可以在没有任何其他对象引用的情况下自动 <code>delete</code> ，其实智能指针还可以自定义资源的释放行为：</p>\n<pre><code class=\"language-cpp\">#pragma once\n\n#include &lt;memory&gt;\n#include &lt;string&gt;\n\nnamespace hf {\nclass Tokenizer {\n public:\n  explicit Tokenizer(const std::string&amp; path);\n\n  // 编译器自动生成：\n  // - 析构函数\n  // - 移动构造 / 移动赋值\n  // - 禁止拷贝（因为 unique_ptr 不可拷贝）\n\n private:\n  std::unique_ptr&lt;void, void (*)(void*)&gt; handle;\n};\n\n}  // namespace hf\n</code></pre>\n<pre><code class=\"language-cpp\">#include \"HfTokenizer.h\"\n\n#include &lt;stdexcept&gt;\n\n#include \"hf_tokenizer_ffi.h\"\n\nnamespace hf {\n\nstatic void HandleDeleter(void* handle) noexcept {\n  if (handle) {\n    tokenizer_destroy(handle);\n  }\n}\n\nTokenizer::Tokenizer(const std::string&amp; path)\n    : handle(tokenizer_create(path.c_str()), HandleDeleter) {\n  if (!handle) {\n    throw std::runtime_error(\"Failed to create tokenizer from \" + path);\n  }\n}\n\n}  // namespace hf\n</code></pre>\n<p>如上实现所示，函数 <code>HandleDeleter</code> 就是 <code>std::unique_ptr&lt;void, void (*)(void*)&gt; handle</code> 的自定义析构行为，在类对象析构的时候就会自动调用这个函数释放资源。既然资源被智能托管了，那么自然就不用写析构函数；析构函数不用写，那么拷贝构造函数、拷贝赋值运算符、移动构造函数以及移动赋值运算符都可以不用实现，全部可以依赖编译器自动生成。当然，由于 <code>unique_ptr</code> 只能移动不能拷贝，<code>Tokenizer</code>也就只能移动不能拷贝。</p>\n<h1 id=\"5-总结\">5. 总结</h1>\n<p>最后，笔者就给出 C++ 封装 C FFI 接口的完整实现，如下所示：</p>\n<pre><code class=\"language-cpp\">// HfTokenizer.h\n#pragma once\n\n#include &lt;memory&gt;\n#include &lt;string&gt;\n\n#include \"tokenizer_result.h\"\n\nnamespace hf {\nclass Tokenizer {\n public:\n  explicit Tokenizer(const std::string&amp; path);\n\n  // 编译器自动生成：\n  // - 析构函数（调用 Deleter）\n  // - 移动构造 / 移动赋值\n  // - 禁止拷贝（因为 unique_ptr 不可拷贝）\n\n  // 其他接口方法\n  uint64_t Count(const std::string&amp; text) const;\n\n  // 向量化\n  using ResultPtr =\n      std::unique_ptr&lt;TokenizerResult, void (*)(TokenizerResult*)&gt;;\n  ResultPtr Encode(const std::string&amp; text) const;\n\n private:\n  std::unique_ptr&lt;void, void (*)(void*)&gt; handle;\n};\n\n}  // namespace hf\n</code></pre>\n<pre><code class=\"language-cpp\">// HfTokenizer.cpp\n#include \"HfTokenizer.h\"\n\n#include &lt;stdexcept&gt;\n\n#include \"hf_tokenizer_ffi.h\"\n\nnamespace hf {\n\nstatic void HandleDeleter(void* handle) noexcept {\n  if (handle) {\n    tokenizer_destroy(handle);\n  }\n}\n\nstatic void ResultDeleter(TokenizerResult* p) noexcept {\n  if (p) {\n    tokenizer_result_free(*p);\n    delete p;\n  }\n}\n\nTokenizer::Tokenizer(const std::string&amp; path)\n    : handle(tokenizer_create(path.c_str()), HandleDeleter) {\n  if (!handle) {\n    throw std::runtime_error(\"Failed to create tokenizer from \" + path);\n  }\n}\n\nuint64_t Tokenizer::Count(const std::string&amp; text) const {\n  return tokenizer_count(handle.get(), text.c_str());\n}\n\nTokenizer::ResultPtr Tokenizer::Encode(const std::string&amp; text) const {\n  auto result = std::make_unique&lt;TokenizerResult&gt;(\n      tokenizer_encode(handle.get(), text.c_str()));\n  return {result.release(), ResultDeleter};\n};\n\n}  // namespace hf\n</code></pre>\n<p>不仅是句柄，连传递的数据对象笔者都托管给智能指针，从而避免大量写特殊成员函数这些样板代码。不得不说，RAII 的设计思路非常精妙，同时保证了安全性与简洁性，给人一种回归编程原始状态的感觉。所谓“大道至简”，不是代码越繁复就越安全，也不是代码越抽象就越厉害；真正好的代码，是在正确性、可维护性与简洁性之间取得平衡，让资源管理如呼吸般自然，而非负担。</p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 13:36</span>&nbsp;\n<a href=\"https://www.cnblogs.com/charlee44\">charlee44</a>&nbsp;\n阅读(<span id=\"post_view_count\">31</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "ä¸€å¤©ä¸€ä¸ªPythonåº“ï¼šmarkupsafe - è®©ä½ çš„å­—ç¬¦ä¸²å®‰å…¨åˆä¼˜é›",
      "link": "https://www.cnblogs.com/min2k/p/19557576",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/min2k/p/19557576\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 13:31\">\n    <span>一天一个Python库：markupsafe - 让你的字符串安全又优雅</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"markupsafe---让你的字符串安全又优雅\">markupsafe - 让你的字符串安全又优雅</h1>\n<h2 id=\"一什么是markupsafe\">一、什么是markupsafe？</h2>\n<p><strong>markupsafe</strong> 是一个用于处理标记语言（如HTML、XML）字符串的 Python 库。<br />\n它可以帮助你：</p>\n<ul>\n<li><strong>安全地转义字符串</strong>：防止跨站脚本（XSS）攻击，特别是当你需要将用户输入显示在网页上时。</li>\n<li><strong>标记安全字符串</strong>：将经过转义或信任的字符串标记为“安全”，避免重复转义，提高效率。</li>\n<li><strong>模板引擎集成</strong>：在像Jinja2这样的模板引擎中，markupsafe扮演了核心角色，确保渲染的HTML内容是安全的。</li>\n</ul>\n<h2 id=\"二应用场景\">二、应用场景</h2>\n<p><strong>markupsafe</strong> 广泛应用于以下实际场景：</p>\n<ul>\n<li><strong>Web开发框架</strong>: 在Flask、Jinja2等Web框架中，用于自动转义模板渲染的输出，防止注入攻击。</li>\n<li><strong>用户生成内容</strong>: 当你的网站允许用户输入并显示内容时（如评论、论坛帖子），markupsafe能确保这些内容在显示时是安全的。</li>\n<li><strong>构建动态HTML/XML</strong>: 在程序中动态生成HTML或XML片段时，需要确保所有插入的数据都经过了正确的转义。</li>\n</ul>\n<h2 id=\"三如何安装\">三、如何安装</h2>\n<ol>\n<li>使用 pip 安装</li>\n</ol>\n<pre><code class=\"language-bash\">pip install markupsafe\n\n# 如果安装慢的话，推荐使用国内镜像源\npip install markupsafe -i https://www.python64.cn/pypi/simple/\n</code></pre>\n<ol start=\"2\">\n<li>使用 <a href=\"https://www.min2k.com/tools/python-run/\" rel=\"noopener nofollow\" target=\"_blank\">PythonRun</a> 在线运行代码（无需本地安装）</li>\n</ol>\n<h2 id=\"四示例代码\">四、示例代码</h2>\n<p>转义用户输入以防止XSS攻击</p>\n<pre><code class=\"language-python\">from markupsafe import escape, Markup\n\n# 用户输入，可能包含恶意脚本\nuser_input_raw = \"&lt;script&gt;alert('您被攻击了！')&lt;/script&gt;\"\nis_admin = True # 假设有一个条件判断用户是否是管理员\n\n# 使用escape转义用户输入\nsafe_output = escape(user_input_raw)\n\n# 打印转义后的结果\nprint(f\"转义后的内容: {safe_output}\")\n\n# 假设有一些信任的HTML内容，我们不希望它被转义\ntrusted_html = Markup(\"&lt;b&gt;这是加粗的文本&lt;/b&gt;\")\n\n# 如果是管理员，则直接显示原始输入（这里仅为演示，实际应用需极其谨慎）\nif is_admin:\n    print(f\"管理员显示（危险！）：{user_input_raw}\")\nelse:\n    # 否则显示安全的内容\n    print(f\"普通用户显示（安全！）：{safe_output}\")\n\n# 结合使用，Markup标记的内容不会被二次转义\nformatted_output = Markup(f\"&lt;p&gt;Hello, {safe_output}!&lt;/p&gt;\")\nprint(f\"组合后的安全HTML: {formatted_output}\")\n\n# 检查是否是Markup实例\nif isinstance(formatted_output, Markup):\n    print(\"formatted_output 是一个 Markup 实例，已被标记为安全。\")\nelse:\n    print(\"formatted_output 不是 Markup 实例。\")\n</code></pre>\n<p>使用 <a href=\"https://www.min2k.com/tools/python-run/?code=from%20markupsafe%20import%20escape%2C%20Markup%0A%0A%23%20%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%EF%BC%8C%E5%8F%AF%E8%83%BD%E5%8C%85%E5%90%AB%E6%81%B6%E6%84%8F%E8%84%9A%E6%9C%AC%0Auser_input_raw%20%3D%20%22%3Cscript%3Ealert%28'%E6%82%A8%E8%A2%AB%E6%94%BB%E5%87%BB%E4%BA%86%EF%BC%81'%29%3C%2Fscript%3E%22%0Ais_admin%20%3D%20True%20%23%20%E5%81%87%E8%AE%BE%E6%9C%89%E4%B8%80%E4%B8%AA%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E6%98%AF%E5%90%A6%E6%98%AF%E7%AE%A1%E7%90%86%E5%91%98%0A%0A%23%20%E4%BD%BF%E7%94%A8escape%E8%BD%AC%E4%B9%89%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%0Asafe_output%20%3D%20escape%28user_input_raw%29%0A%0A%23%20%E6%89%93%E5%8D%B0%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E7%BB%93%E6%9E%9C%0Aprint%28f%22%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9%3A%20%7Bsafe_output%7D%22%29%0A%0A%23%20%E5%81%87%E8%AE%BE%E6%9C%89%E4%B8%80%E4%BA%9B%E4%BF%A1%E4%BB%BB%E7%9A%84HTML%E5%86%85%E5%AE%B9%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%8D%E5%B8%8C%E6%9C%9B%E5%AE%83%E8%A2%AB%E8%BD%AC%E4%B9%89%0Atrusted_html%20%3D%20Markup%28%22%3Cb%3E%E8%BF%99%E6%98%AF%E5%8A%A0%E7%B2%97%E7%9A%84%E6%96%87%E6%9C%AC%3C%2Fb%3E%22%29%0A%0A%23%20%E5%A6%82%E6%9E%9C%E6%98%AF%E7%AE%A1%E7%90%86%E5%91%98%EF%BC%8C%E5%88%99%E7%9B%B4%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%8E%9F%E5%A7%8B%E8%BE%93%E5%85%A5%EF%BC%88%E8%BF%99%E9%87%8C%E4%BB%85%E4%B8%BA%E6%BC%94%E7%A4%BA%EF%BC%8C%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E9%9C%80%E6%9E%81%E5%85%B6%E8%B0%A8%E6%85%8E%EF%BC%89%0Aif%20is_admin%3A%0A%20%20%20%20print%28f%22%E7%AE%A1%E7%90%86%E5%91%98%E6%98%BE%E7%A4%BA%EF%BC%88%E5%8D%B1%E9%99%A9%EF%BC%81%EF%BC%89%EF%BC%9A%7Buser_input_raw%7D%22%29%0Aelse%3A%0A%20%20%20%20%23%20%E5%90%A6%E5%88%99%E6%98%BE%E7%A4%BA%E5%AE%89%E5%85%A8%E7%9A%84%E5%86%85%E5%AE%B9%0A%20%20%20%20print%28f%22%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E6%98%BE%E7%A4%BA%EF%BC%88%E5%AE%89%E5%85%A8%EF%BC%81%EF%BC%89%EF%BC%9A%7Bsafe_output%7D%22%29%0A%0A%23%20%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8%EF%BC%8CMarkup%E6%A0%87%E8%AE%B0%E7%9A%84%E5%86%85%E5%AE%B9%E4%B8%8D%E4%BC%9A%E8%A2%AB%E4%BA%8C%E6%AC%A1%E8%BD%AC%E4%B9%89%0Aformatted_output%20%3D%20Markup%28f%22%3Cp%3EHello%2C%20%7Bsafe_output%7D!%3C%2Fp%3E%22%29%0Aprint%28f%22%E7%BB%84%E5%90%88%E5%90%8E%E7%9A%84%E5%AE%89%E5%85%A8HTML%3A%20%7Bformatted_output%7D%22%29%0A%0A%23%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E6%98%AFMarkup%E5%AE%9E%E4%BE%8B%0Aif%20isinstance%28formatted_output%2C%20Markup%29%3A%0A%20%20%20%20print%28%22formatted_output%20%E6%98%AF%E4%B8%80%E4%B8%AA%20Markup%20%E5%AE%9E%E4%BE%8B%EF%BC%8C%E5%B7%B2%E8%A2%AB%E6%A0%87%E8%AE%B0%E4%B8%BA%E5%AE%89%E5%85%A8%E3%80%82%22%29%0Aelse%3A%0A%20%20%20%20print%28%22formatted_output%20%E4%B8%8D%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%E3%80%82%22%29\" rel=\"noopener nofollow\" target=\"_blank\">PythonRun</a> 在线运行这段代码，结果如下：</p>\n<pre><code class=\"language-text\">转义后的内容: &amp;lt;script&amp;gt;alert(&amp;#39;您被攻击了！&amp;#39;)&amp;lt;/script&amp;gt;\n管理员显示（危险！）：&lt;script&gt;alert('您被攻击了！')&lt;/script&gt;\n组合后的安全HTML: &lt;p&gt;Hello, &amp;lt;script&amp;gt;alert(&amp;#39;您被攻击了！&amp;#39;)&amp;lt;/script&amp;gt;!&lt;/p&gt;\nformatted_output 是一个 Markup 实例，已被标记为安全。\n</code></pre>\n<p>使用 <a href=\"https://www.min2k.com/tools/mermaid/?code=flowchart%20TB%0A%20%20A%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20B%7B%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E5%92%8C%E7%AE%A1%E7%90%86%E5%91%98%E7%8A%B6%E6%80%81%7D%3B%0A%20%20B%20--%3E%20C%5B%E4%BD%BF%E7%94%A8escape%E8%BD%AC%E4%B9%89%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%5D%3B%0A%20%20C%20--%3E%20D%5B%E6%89%93%E5%8D%B0%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9%5D%3B%0A%20%20D%20--%3E%20E%7B%E5%A6%82%E6%9E%9C%20isAdmin%20%E4%B8%BA%20True%3F%7D%3B%0A%20%20E%20--%20%E6%98%AF%20--%3E%20F%5B%E6%89%93%E5%8D%B0%E5%8E%9F%E5%A7%8B%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%20%28%E5%8D%B1%E9%99%A9%29%5D%3B%0A%20%20E%20--%20%E5%90%A6%20--%3E%20G%5B%E6%89%93%E5%8D%B0%E5%AE%89%E5%85%A8%E7%9A%84%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%5D%3B%0A%20%20F%20--%3E%20H%5B%E5%88%9B%E5%BB%BA%E5%AE%89%E5%85%A8%E7%9A%84%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20G%20--%3E%20H%3B%0A%20%20H%20--%3E%20I%5B%E6%89%93%E5%8D%B0%E7%BB%84%E5%90%88%E5%90%8E%E7%9A%84%E5%AE%89%E5%85%A8HTML%5D%3B%0A%20%20I%20--%3E%20J%7B%E6%A3%80%E6%9F%A5%20formatted_output%20%E6%98%AF%E5%90%A6%E4%B8%BA%20Markup%20%E5%AE%9E%E4%BE%8B%3F%7D%3B%0A%20%20J%20--%20%E6%98%AF%20--%3E%20K%5B%E6%89%93%E5%8D%B0%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20J%20--%20%E5%90%A6%20--%3E%20L%5B%E6%89%93%E5%8D%B0%E4%B8%8D%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20K%20--%3E%20M%5B%E7%BB%93%E6%9D%9F%5D%3B%0A%20%20L%20--%3E%20M%3B\" rel=\"noopener nofollow\" target=\"_blank\">MermaidGo</a> 绘制示例代码的流程图，结果如下：</p>\n<p><img alt=\"MermerGo的markupsafe流程图\" class=\"lazyload\" /></p>\n<h2 id=\"五学习资源\">五、学习资源</h2>\n<ol>\n<li>开源项目：<a href=\"https://github.com/pallets/markupsafe\" rel=\"noopener nofollow\" target=\"_blank\">markupsafe</a></li>\n<li>中文自述：<a href=\"https://www.python64.cn/readme/markupsafe/\" rel=\"noopener nofollow\" target=\"_blank\">REMDME</a></li>\n<li>在线运行：<a href=\"https://www.min2k.com/tools/python-run/\" rel=\"noopener nofollow\" target=\"_blank\">PythonRun</a></li>\n</ol>\n<blockquote>\n<p>如果这篇文章对你有帮助，欢迎点赞、收藏、转发！<br />\n学习过程中有任何问题，欢迎在评论区留言交流～</p>\n</blockquote>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 13:31</span>&nbsp;\n<a href=\"https://www.cnblogs.com/min2k\">敏编程</a>&nbsp;\n阅读(<span id=\"post_view_count\">45</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "从0到1，快速训练并使用YOLO模型",
      "link": "https://www.cnblogs.com/ClownLMe/p/19559180",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/ClownLMe/p/19559180\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 21:54\">\n    <span>从0到1，快速训练并使用YOLO模型</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"简介\">简介</h1>\n<p><strong>YOLO</strong>是目前计算机视觉领域最前沿、应用最广泛的<strong>目标检测</strong>算法框架，他能快速识别区分目标，广泛应用于游戏，无人驾驶，工业等领域。</p>\n<p>以识别躲避掉落滑块的游戏的物体图片作为例子。</p>\n<h1 id=\"一环境配置\">一，环境配置</h1>\n<pre><code class=\"language-bash\">pip install ultralytics\n</code></pre>\n<h1 id=\"二准备数据集\">二，准备数据集</h1>\n<p>这个格式目录如下：</p>\n<pre><code class=\"language-bash\">my_dataset/\n├── data.yaml # 配置文件（定义路径和类别）\n├── train/ #训练数据集\n│   ├── images/ # 训练图片\n│   └── labels/ # 标注文件 (.txt)\n└── val/ #验证数据集\n    ├── images/ \n    └── labels/ \n</code></pre>\n<h3 id=\"datayml\">data.yml</h3>\n<pre><code class=\"language-yaml\">path: D:\\D_MyProject\\Ai\\game_ai\\my_dataset #数据集路径\ntrain: train/images #训练集图片路径\nval: val/images #验证集图片路径\n\nnc: 3 #标记个数\nnames:  #每个标记的名称\n&nbsp; 0: player\n&nbsp; 1: enemy\n&nbsp; 2: game_over\n</code></pre>\n<h3 id=\"下面是用ai生成了数据集的生成脚本\">下面是用AI生成了数据集的生成脚本</h3>\n<p>数据量太多了，这里为了演示，或者学习，可以直接使用下面脚本</p>\n<pre><code class=\"language-python\">import pygame\nimport random\nimport sys\nimport os\nimport shutil\n\n# =================配置区域=================\n# 数据集根目录名称\nDATASET_ROOT = \"my_dataset\"\n# 采集总数量\nMAX_IMAGES = 1000\n# 训练集占比 (0.8 = 80% 训练, 20% 验证)\nTRAIN_RATIO = 0.8\n\n# ================= 1. 环境清理与目录创建 =================\nprint(f\"🚀 正在初始化数据集目录: {DATASET_ROOT} ...\")\n\n# 如果目录已存在，先删除（防止旧数据混入），确保数据纯净\nif os.path.exists(DATASET_ROOT):\n    shutil.rmtree(DATASET_ROOT)\n\n# 创建 YOLO 标准目录结构\nfor split in ['train', 'val']:\n    os.makedirs(os.path.join(DATASET_ROOT, split, 'images'), exist_ok=True)\n    os.makedirs(os.path.join(DATASET_ROOT, split, 'labels'), exist_ok=True)\n\n# ================= 2. 自动生成 data.yaml =================\nyaml_content = f\"\"\"\npath: {os.path.abspath(DATASET_ROOT)} # 使用绝对路径，防止报错\ntrain: train/images\nval: val/images\n\nnc: 3\nnames:\n  0: player\n  1: enemy\n  2: game_over\n\"\"\"\nwith open(os.path.join(DATASET_ROOT, \"data.yaml\"), \"w\", encoding='utf-8') as f:\n    f.write(yaml_content)\nprint(\"✅ data.yaml 配置文件已生成。\")\n\n# ================= 3. 游戏与采集逻辑 =================\npygame.init()\nWIDTH, HEIGHT = 800, 600\n# 使用 hidden 模式或正常模式均可，这里用正常模式方便你看到进度\nscreen = pygame.display.set_mode((WIDTH, HEIGHT))\npygame.display.set_caption(\"Auto Data Generator\")\nclock = pygame.time.Clock()\n\nfont_big = pygame.font.SysFont(\"monospace\", 50)\nfont_small = pygame.font.SysFont(\"monospace\", 35)\n\n# 游戏状态\nplayer_size, enemy_size = 50, 50\nplayer_x = WIDTH // 2\nplayer_y = HEIGHT - player_size - 10\nenemies = []\n\nimg_count = 0\nGAMEPLAY_LIMIT = int(MAX_IMAGES * 0.9) # 90% 正常游戏，10% Game Over\n\nprint(f\"📸 开始采集 {MAX_IMAGES} 张图片 (自动划分 Train/Val)...\")\n\nwhile img_count &lt; MAX_IMAGES:\n    # 处理退出事件，防止卡死\n    for event in pygame.event.get():\n        if event.type == pygame.QUIT:\n            pygame.quit()\n            sys.exit()\n\n    screen.fill((0, 0, 0))\n    labels = [] # 存储当前帧的标签\n    dw, dh = 1.0 / WIDTH, 1.0 / HEIGHT # 归一化系数\n\n    # --- 逻辑分支：正常游戏 vs Game Over ---\n    if img_count &lt; GAMEPLAY_LIMIT:\n        # A. 正常游戏画面\n        # 1. 玩家移动\n        if random.random() &lt; 0.2: # 增加移动频率\n            player_x += random.choice([-15, 15])\n            player_x = max(0, min(WIDTH - player_size, player_x))\n\n        # 2. 敌人生成与移动\n        if random.randint(0, 20) == 0: # 增加敌人密度\n            enemies.append([random.randint(0, WIDTH - enemy_size), 0])\n        \n        for enemy in enemies: enemy[1] += 15 # 加快下落速度\n        enemies = [e for e in enemies if e[1] &lt; HEIGHT]\n\n        # 3. 绘制玩家 (Class 0)\n        pygame.draw.rect(screen, (50, 150, 255), (player_x, player_y, player_size, player_size))\n        # 计算 YOLO 坐标 (class x_center y_center width height)\n        px, py = (player_x + player_size/2) * dw, (player_y + player_size/2) * dh\n        labels.append(f\"0 {px:.6f} {py:.6f} {player_size*dw:.6f} {player_size*dh:.6f}\")\n\n        # 4. 绘制敌人 (Class 1)\n        for e in enemies:\n            pygame.draw.rect(screen, (255, 50, 50), (e[0], e[1], enemy_size, enemy_size))\n            ex, ey = (e[0] + enemy_size/2) * dw, (e[1] + enemy_size/2) * dh\n            labels.append(f\"1 {ex:.6f} {ey:.6f} {enemy_size*dw:.6f} {enemy_size*dh:.6f}\")\n\n    else:\n        # B. Game Over 画面 (Class 2)\n        text_surf = font_big.render(\"GAME OVER\", True, (255, 50, 50))\n        \n        # 随机抖动位置，防止过拟合\n        off_x, off_y = random.randint(-50, 50), random.randint(-50, 50)\n        text_x = WIDTH // 2 - text_surf.get_width() // 2 + off_x\n        text_y = HEIGHT // 2 - 100 + off_y\n        screen.blit(text_surf, (text_x, text_y))\n\n        # 干扰项\n        score_surf = font_small.render(f\"Score: {random.randint(0,999)}\", True, (255,255,255))\n        screen.blit(score_surf, (WIDTH//2 - score_surf.get_width()//2, HEIGHT//2 + 50))\n\n        # 记录标签\n        tw, th = text_surf.get_width(), text_surf.get_height()\n        tx, ty = (text_x + tw/2) * dw, (text_y + th/2) * dh\n        labels.append(f\"2 {tx:.6f} {ty:.6f} {tw*dw:.6f} {th*dh:.6f}\")\n\n    # ================= 4. 保存逻辑 (核心修改) =================\n    pygame.display.flip()\n    \n    # 采样率：不是每一帧都保存，防止重复度过高 (这里设为 30% 概率保存)\n    if random.random() &lt; 0.3:\n        # A. 决定是去 Train 还是 Val\n        split_folder = \"train\" if random.random() &lt; TRAIN_RATIO else \"val\"\n        \n        # B. 生成文件名\n        filename = f\"{img_count:06d}\"\n        img_save_path = os.path.join(DATASET_ROOT, split_folder, \"images\", f\"{filename}.jpg\")\n        lbl_save_path = os.path.join(DATASET_ROOT, split_folder, \"labels\", f\"{filename}.txt\")\n\n        # C. 保存图片\n        pygame.image.save(screen, img_save_path)\n\n        # D. 保存标签\n        with open(lbl_save_path, \"w\") as f:\n            f.write(\"\\n\".join(labels))\n\n        img_count += 1\n        \n        # 打印进度条\n        print(f\"[{split_folder.upper()}] 进度: {img_count}/{MAX_IMAGES}\", end=\"\\r\")\n\n    # 加速模拟，不要垂直同步，越快越好\n    clock.tick(0) \n\npygame.quit()\nprint(f\"\\n\\n✨ 全部完成！数据集已就绪：{os.path.abspath(DATASET_ROOT)}\")\nprint(\"💡 下一步：直接运行 model.train(data='my_dataset/data.yaml')\")\n</code></pre>\n<h1 id=\"三训练yolo模型\">三，训练YOLO模型</h1>\n<p>可以看到，使用<code>ultralytics</code>框架训练YOLO的代码非常简单，只需要几行<br />\n<strong>注意：这里YOLO会自动下载模型并训练，下载时失败可能需要挂梯子</strong></p>\n<pre><code class=\"language-python\">from ultralytics import YOLO\n\ndef train_model():\n    #加载模型\n    model = YOLO(\"yolo11n.pt\") \n\n    #开始训练\n    print(\"开始训练...\")\n    results = model.train(\n        data=\"my_dataset/data.yaml\", #数据集配置文件\n        epochs=30, #训练轮数\n        imgsz=640, #图片输入尺寸\n        batch=16, #显存够大可以改大，比如 32 或 64\n        device=0, #强制使用第一张显卡 (需要CUDA)\n        workers=0, #Windows下设为0防止多进程报错\n        project=\"dodge_project\",#保存路径\n        name=\"ai_model\" #训练运行名称\n    )\n    print(f\"训练完成！最佳模型保存在: {results.save_dir}/weights/best.pt\")\n\nif __name__ == \"__main__\":\n    train_model()\n</code></pre>\n<h1 id=\"四使用yolo模型\">四，使用YOLO模型</h1>\n<pre><code class=\"language-python\">from ultralytics import YOLO\n\n#配置路径\nMODEL_PATH = \"dodge_project/ai_model/weights/best.pt\" \nPIC_PATH = \"my_dataset/val/images/000045.jpg\"\n\n#加载模型\nmodel = YOLO(MODEL_PATH)\nprint(f\"模型加载成功\")\n\n#识别图片\nresults = model.predict(PIC_PATH, verbose=False, conf=0.4, imgsz=640)\nresult = results[0]\n\n#获取信息并打印\nfor box in result.boxes:\n    # 获取坐标 (x1, y1, x2, y2)、类别 ID 和置信度\n    x1, y1, x2, y2 = map(int, box.xyxy[0])\n    cls_id = int(box.cls[0])\n    conf = float(box.conf[0])\n    \n    # 类别名称映射\n    names = {0: \"Player\", 1: \"Enemy\", 2: \"Game Over\"}\n    label = names.get(cls_id, f\"Unknown({cls_id})\")\n    print(f\"找到物体: [{label:10}] | 置信度: {conf:.2f} | 坐标: ({x1}, {y1}) -&gt; ({x2}, {y2})\")\n\n#展示图片\nresult.show()\n</code></pre>\n<p><strong>如果❤喜欢❤本系列教程，就点个关注吧，后续不定期更新~</strong></p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 21:54</span>&nbsp;\n<a href=\"https://www.cnblogs.com/ClownLMe\">ClownLMe</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "Clawdbot 是如何实现永久记忆的？",
      "link": "https://www.cnblogs.com/didispace/p/19559022",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/didispace/p/19559022\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 20:27\">\n    <span>Clawdbot 是如何实现永久记忆的？</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>你是否曾经和AI助手聊了一整晚，第二天打开对话却发现它完全忘了你们讨论过的关键细节？或者当你在多个项目之间切换时，AI总是在问\"你指的是哪个API\"，让你不厌其烦地重复背景信息。这种\"金鱼式记忆\"是当下大多数云端AI产品的通病——它们要么只能记住有限的上下文，要么把所有数据都存储在厂商的服务器上。</p>\n<p>但如果有一个AI助手，它能像一位真正的私人助理那样，永远记住你的偏好、你的项目细节、甚至你三个月前提过的小习惯？更妙的是，这些记忆完全存储在你自己的电脑上，由你全权掌控。</p>\n<p>这就是Clawdbot正在做的事情。作为一款开源的个人AI助手，Clawdbot在GitHub上已经获得了超过125,000个Star。与运行在云端的ChatGPT或Claude不同，Clawdbot直接运行在你的本地机器上，并且能够集成到你日常使用的聊天平台中（Discord、WhatsApp、Telegram等）。</p>\n<p>它不仅是一个聊天机器人，更是一个能自主处理实际任务的助手：管理邮件、安排日历、处理航班值机、按计划运行后台任务。但最吸引我的是它的持久化记忆系统——它能实现24/7的全天候上下文保持，记住对话内容，并无限期地基于之前的交互进行累积。</p>\n<p>如果你读过我之前关于ChatGPT记忆和Claude记忆的文章，就知道我对不同AI产品如何处理记忆这个问题非常着迷。Clawdbot采用了一种截然不同的方法：它不是基于云端、由公司控制的记忆，而是将一切保存在本地，让用户完全拥有自己的上下文和技能数据。</p>\n<p>让我们一起深入了解它是如何工作的。</p>\n<blockquote>\n<p>以下内容翻译自<a href=\"https://manthanguptaa.in/posts/clawdbot_memory\" rel=\"noopener nofollow\" target=\"_blank\">《How Clawdbot Remembers Everything》</a></p>\n</blockquote>\n<h2 id=\"上下文是如何构建的\">上下文是如何构建的</h2>\n<p>在深入探讨记忆之前，我们先来理解模型在每次请求时能看到什么：</p>\n<pre><code class=\"language-text\">[0] 系统提示词（静态指令 + 条件指令）\n[1] 项目上下文（引导文件：AGENTS.md、SOUL.md 等）\n[2] 对话历史（消息、工具调用、压缩摘要）\n[3] 当前消息\n</code></pre>\n<p>系统提示词定义了Agent的能力和可用工具。与记忆相关的是\"项目上下文\"，它包含了用户可编辑的Markdown文件，这些文件会被注入到每次请求中：</p>\n<p>这些文件位于Agent的工作空间中，与记忆文件并存，使得整个Agent的配置变得透明且可编辑。</p>\n<h2 id=\"上下文-vs-记忆\">上下文 vs 记忆</h2>\n<p>理解上下文和记忆之间的区别，是理解Clawdbot的基础。</p>\n<p><strong>上下文</strong>是模型在单次请求中能看到的一切：</p>\n<pre><code class=\"language-text\">上下文 = 系统提示词 + 对话历史 + 工具结果 + 附件\n</code></pre>\n<p>上下文的特性：</p>\n<ul>\n<li><strong>临时的</strong>——只存在于本次请求期间</li>\n<li><strong>有限的</strong>——受限于模型的上下文窗口（例如20万token）</li>\n<li><strong>昂贵的</strong>——每个token都计入API成本和速度</li>\n</ul>\n<p><strong>记忆</strong>是存储在磁盘上的内容：</p>\n<pre><code class=\"language-text\">记忆 = MEMORY.md + memory/*.md + 会话转录文件\n</code></pre>\n<p>记忆的特性：</p>\n<ul>\n<li><strong>持久的</strong>——在重启、日复一日、月复一月后依然存在</li>\n<li><strong>无限的</strong>——可以无限增长</li>\n<li><strong>低成本的</strong>——存储不产生API费用</li>\n<li><strong>可搜索的</strong>——建立索引以支持语义检索</li>\n</ul>\n<h2 id=\"记忆工具\">记忆工具</h2>\n<p>Agent通过两个专用工具来访问记忆：</p>\n<h3 id=\"1-memory_search\">1. memory_search</h3>\n<p><strong>用途</strong>：在所有文件中查找相关的记忆</p>\n<pre><code class=\"language-json\">{\n  \"name\": \"memory_search\",\n  \"description\": \"强制性回忆步骤：在回答关于之前工作、决策、日期、人员、偏好或待办事项的问题之前，对MEMORY.md和memory/*.md进行语义搜索\",\n  \"parameters\": {\n    \"query\": \"我们对API做了什么决定？\",\n    \"maxResults\": 6,\n    \"minScore\": 0.35\n  }\n}\n</code></pre>\n<p><strong>返回结果</strong>：</p>\n<pre><code class=\"language-json\">{\n  \"results\": [\n    {\n      \"path\": \"memory/2026-01-20.md\",\n      \"startLine\": 45,\n      \"endLine\": 52,\n      \"score\": 0.87,\n      \"snippet\": \"## API 讨论\\n决定为了简单起见使用REST而不是GraphQL...\",\n      \"source\": \"memory\"\n    }\n  ],\n  \"provider\": \"openai\",\n  \"model\": \"text-embedding-3-small\"\n}\n</code></pre>\n<h3 id=\"2-memory_get\">2. memory_get</h3>\n<p><strong>用途</strong>：在找到内容后读取具体内容</p>\n<pre><code class=\"language-json\">{\n  \"name\": \"memory_get\",\n  \"description\": \"在使用memory_search后，从记忆文件中读取特定行\",\n  \"parameters\": {\n    \"path\": \"memory/2026-01-20.md\",\n    \"from\": 45,\n    \"lines\": 15\n  }\n}\n</code></pre>\n<p><strong>返回结果</strong>：</p>\n<pre><code class=\"language-json\">{\n  \"path\": \"memory/2026-01-20.md\",\n  \"text\": \"## API 讨论\\n\\n与团队讨论API架构。\\n\\n### 决策\\n我们选择REST而非GraphQL，原因如下：\\n1. 实现更简单\\n2. 更好的缓存支持\\n3. 团队更熟悉\\n\\n### 端点\\n- GET /users\\n- POST /auth/login\\n- GET /projects/:id\"\n}\n</code></pre>\n<h3 id=\"写入记忆\">写入记忆</h3>\n<p>并没有专门的memory_write工具。Agent使用标准的写入和编辑工具来写入记忆——这些工具它本来就在用于处理任何文件。由于记忆就是普通的Markdown，你也可以手动编辑这些文件（它们会被自动重新索引）。</p>\n<p>写入位置的决策是通过AGENTS.md中的提示来驱动的：</p>\n<p>在预压缩刷新和会话结束时，也会自动进行写入（后续章节会介绍）。</p>\n<h2 id=\"记忆存储\">记忆存储</h2>\n<p>Clawdbot的记忆系统建立在\"记忆就是Agent工作空间中的纯Markdown\"这一原则之上。</p>\n<h3 id=\"双层记忆系统\">双层记忆系统</h3>\n<p>记忆位于Agent的工作空间中（默认：~/clawd/）：</p>\n<pre><code class=\"language-text\">~/clawd/\n├── MEMORY.md              - 第二层：长期策划的知识\n└── memory/\n    ├── 2026-01-26.md      - 第一层：今天的笔记\n    ├── 2026-01-25.md      - 昨天的笔记\n    ├── 2026-01-24.md      - ...以此类推\n    └── ...\n</code></pre>\n<p><strong>第一层：每日日志（memory/YYYY-MM-DD.md）</strong></p>\n<p>这些是仅追加的每日笔记，Agent会在一天中随时写入。当Agent想要记住某事，或被明确告知要记住某事时，就会写入这里。</p>\n<pre><code class=\"language-markdown\"># 2026-01-26\n\n## 10:30 AM - API 讨论\n与用户讨论REST vs GraphQL。决策：为了简单使用REST。\n关键端点：/users、/auth、/projects。\n\n## 2:15 PM - 部署\n将v2.3.0部署到生产环境。没有问题。\n\n## 4:00 PM - 用户偏好\n用户提到他们喜欢TypeScript胜过JavaScript。\n</code></pre>\n<p><strong>第二层：长期记忆（MEMORY.md）</strong></p>\n<p>这是经过策划的、持久的知识。当发生重大事件、想法、决策、观点和学到的教训时，Agent会写入这里。</p>\n<pre><code class=\"language-markdown\"># 长期记忆\n\n## 用户偏好\n- 喜欢TypeScript胜过JavaScript\n- 喜欢简洁的解释\n- 正在做\"Acme Dashboard\"项目\n\n## 重要决策\n- 2026-01-15：选择PostgreSQL作为数据库\n- 2026-01-20：采用REST而非GraphQL\n- 2026-01-26：使用Tailwind CSS进行样式设计\n\n## 关键联系人\n- Alice (alice@acme.com) - 设计负责人\n- Bob (bob@acme.com) - 后端工程师\n</code></pre>\n<h3 id=\"agent如何知道要读取记忆\">Agent如何知道要读取记忆</h3>\n<p><code>AGENTS.md</code>文件（会自动加载）包含以下指令：</p>\n<pre><code class=\"language-text\">## 每次会话\n\n在做其他事情之前：\n1. 阅读 SOUL.md - 这是你是谁\n2. 阅读 USER.md - 这是你在帮助谁\n3. 阅读 memory/YYYY-MM-DD.md（今天和昨天）获取近期上下文\n4. 如果是在主会话中（与你的主人直接聊天），还要阅读 MEMORY.md\n\n不要请求许可，直接做。\n</code></pre>\n<h2 id=\"记忆如何被索引\">记忆如何被索引</h2>\n<p>当你保存一个记忆文件时，后台会发生以下事情：</p>\n<pre><code class=\"language-text\">┌─────────────────────────────────────────────────────────────┐\n│  1. 文件保存                                                │\n│     ~/clawd/memory/2026-01-26.md                            │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  2. 文件监视器检测到变化                                    │\n│     Chokidar 监视 MEMORY.md + memory/**/*.md                │\n│     防抖1.5秒以批量处理快速写入                             │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  3. 分块                                                    │\n│     分割成约400 token的块，重叠80 token                     │\n│                                                             │\n│     ┌────────────────┐                                      │\n│     │ 块 1           │                                      │\n│     │ 第 1-15 行     │──────┐                               │\n│     └────────────────┘      │                               │\n│     ┌────────────────┐      │ (80 token 重叠)               │\n│     │ 块 2           │◄─────┘                               │\n│     │ 第 12-28 行    │──────┐                               │\n│     └────────────────┘      │                               │\n│     ┌────────────────┐      │                               │\n│     │ 块 3           │◄─────┘                               │\n│     │ 第 25-40 行    │                                      │\n│     └────────────────┘                                      │\n│                                                             │\n│     为什么用400/80？平衡语义连贯性与粒度。                  │\n│     重叠确保跨越块边界的事实能被两边捕获。                   │\n│     两个值都是可配置的。                                     │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  4. 嵌入                                                    │\n│     每个块 -&gt; 嵌入提供商 -&gt; 向量                            │\n│                                                             │\n│     \"讨论REST vs GraphQL\" -&gt;                                │\n│         OpenAI/Gemini/Local -&gt;                              │\n│         [0.12, -0.34, 0.56, ...]  (1536 维)                 │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  5. 存储                                                    │\n│     ~/.clawdbot/memory/&lt;agentId&gt;.sqlite                     │\n│                                                             │\n│     表：                                                    │\n│     - chunks (id, path, start_line, end_line, text, hash)   │\n│     - chunks_vec (id, embedding)      -&gt; sqlite-vec         │\n│     - chunks_fts (text)               -&gt; FTS5 全文搜索      │\n│     - embedding_cache (hash, vector)  -&gt; 避免重复嵌入       │\n└─────────────────────────────────────────────────────────────┘\n</code></pre>\n<blockquote>\n<p><strong>sqlite-vec</strong> 是一个SQLite扩展，它直接在SQLite中实现向量相似度搜索，无需外部向量数据库。</p>\n</blockquote>\n<blockquote>\n<p><strong>FTS5</strong> 是SQLite内置的全文搜索引擎，为BM25关键词匹配提供支持。两者结合，使Clawdbot能够从一个轻量级数据库文件中运行混合搜索（语义 + 关键词）。</p>\n</blockquote>\n<h2 id=\"记忆如何被搜索\">记忆如何被搜索</h2>\n<p>当你搜索记忆时，Clawdbot会并行运行两种搜索策略。向量搜索（语义）找到意思相同的内容，BM25搜索（关键词）找到包含确切token的内容。</p>\n<p>结果通过加权评分合并：</p>\n<pre><code class=\"language-text\">最终得分 = (0.7 * 向量得分) + (0.3 * 文本得分)\n</code></pre>\n<p>为什么是70/30？语义相似性是记忆回忆的主要信号，但BM25关键词匹配能捕捉向量可能遗漏的确切术语（名称、ID、日期）。低于minScore阈值（默认0.35）的结果会被过滤掉。所有这些值都是可配置的。</p>\n<p>这确保无论你是在搜索概念（\"那个数据库的事情\"）还是具体内容（\"POSTGRES_URL\"），都能获得良好的结果。</p>\n<h2 id=\"多agent记忆\">多Agent记忆</h2>\n<p>Clawdbot支持多个Agent，每个Agent都有完全独立的记忆：</p>\n<pre><code class=\"language-text\">~/.clawdbot/memory/              # 状态目录（索引）\n├── main.sqlite                  # \"main\" Agent的向量索引\n└── work.sqlite                  # \"work\" Agent的向量索引\n\n~/clawd/                         # \"main\" Agent工作空间（源文件）\n├── MEMORY.md\n└── memory/\n    └── 2026-01-26.md\n\n~/clawd-work/                    # \"work\" Agent工作空间（源文件）\n├── MEMORY.md\n└── memory/\n    └── 2026-01-26.md\n</code></pre>\n<p>Markdown文件（事实来源）位于每个工作空间中，而SQLite索引（派生数据）位于状态目录中。每个Agent都有自己的工作空间和索引。记忆管理器通过agentId + workspaceDir来区分，因此不会自动发生跨Agent记忆搜索。</p>\n<p><strong>Agent能读取彼此的记忆吗？</strong> 默认不能。每个Agent只能看到自己的工作空间。但是，工作空间是一个软沙盒（默认工作目录），而不是硬边界。除非启用严格的沙盒机制，否则Agent理论上可以使用绝对路径访问另一个工作空间。</p>\n<p>这种隔离对于分离上下文很有用。一个用于WhatsApp的\"个人\"Agent和一个用于Slack的\"工作\"Agent，各自拥有独立的记忆和个性。</p>\n<h3 id=\"压缩\">压缩</h3>\n<p>每个AI模型都有上下文窗口限制。Claude有20万token，GPT-5.1有100万。长对话最终会触及这个上限。</p>\n<p>当这种情况发生时，Clawdbot使用压缩：将旧对话总结为紧凑的条目，同时保留最近消息的完整性。</p>\n<pre><code class=\"language-text\">┌─────────────────────────────────────────────────────────────┐\n│  压缩前                                                     │\n│  上下文：180,000 / 200,000 token                            │\n│                                                             │\n│  [第1轮] 用户：\"我们建个API吧\"                              │\n│  [第2轮] Agent：\"好的！你需要什么端点？\"                    │\n│  [第3轮] 用户：\"用户和认证相关的\"                           │\n│  [第4轮] Agent：*创建了500行模式定义*                       │\n│  [第5轮] 用户：\"加上限流功能\"                               │\n│  [第6轮] Agent：*修改代码*                                  │\n│  ...（还有100多轮）...                                      │\n│  [第150轮] 用户：\"状态怎么样了？\"                           │\n│                                                             │\n│  ⚠️ 接近限制                                                │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  触发压缩                                                   │\n│                                                             │\n│  1. 将第1-140轮总结为紧凑摘要                               │\n│  2. 保留第141-150轮不变（近期上下文）                       │\n│  3. 将摘要持久化到JSONL转录文件                             │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  压缩后                                                     │\n│  上下文：45,000 / 200,000 token                             │\n│                                                             │\n│  [摘要] \"构建了带/users、/auth端点的REST API。              │\n│   实现了JWT认证、限流（100次/分钟）、PostgreSQL数据库。      │\n│   已部署到预发布环境v2.4.0。                                 │\n│   当前重点：生产环境部署准备。\"                              │\n│                                                             │\n│  [第141-150轮原样保留]                                      │\n│                                                             │\n└─────────────────────────────────────────────────────────────┘\n</code></pre>\n<h3 id=\"自动-vs-手动压缩\">自动 vs 手动压缩</h3>\n<p><strong>自动</strong>：当接近上下文限制时触发</p>\n<ul>\n<li>在详细模式下你会看到：🧹 自动压缩完成</li>\n<li>原始请求会用压缩后的上下文重试</li>\n</ul>\n<p><strong>手动</strong>：使用 /compact 命令</p>\n<pre><code>/compact 重点关注决策和未解决的问题\n</code></pre>\n<p>与某些优化不同，压缩会持久化到磁盘。摘要被写入会话的JSONL转录文件，因此未来的会话以压缩后的历史开始。</p>\n<h2 id=\"记忆刷新\">记忆刷新</h2>\n<p>基于LLM的压缩是一个有损过程。重要信息可能被总结掉并可能丢失。为了应对这一点，Clawdbot使用了预压缩记忆刷新。</p>\n<pre><code class=\"language-text\">┌─────────────────────────────────────────────────────────────┐\n│  上下文接近限制                                             │\n│                                                             │\n│  ████████████████████████████░░░░░░░░  上下文的75%         │\n│                              ↑                              │\n│                    超过软阈值                               │\n│                    (contextWindow - reserve - softThreshold)│\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  静默记忆刷新轮次                                           │\n│                                                             │\n│  系统：\"预压缩记忆刷新。现在存储持久的                      │\n│          记忆（使用 memory/YYYY-MM-DD.md）。                │\n│          如果没有要存储的，回复 NO_REPLY。\"                 │\n│                                                             │\n│  Agent：审查对话中的重要信息                                │\n│         将关键决策/事实写入记忆文件                         │\n│         -&gt; NO_REPLY（用户看不到任何内容）                   │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  安全进行压缩                                               │\n│                                                             │\n│  重要信息现在已在磁盘上                                     │\n│  压缩可以在不丢失知识的情况下进行                           │\n└─────────────────────────────────────────────────────────────┘\n</code></pre>\n<p>记忆刷新可以在clawdbot.yaml文件或clawdbot.json文件中配置。</p>\n<pre><code class=\"language-json\">{\n  \"agents\": {\n    \"defaults\": {\n      \"compaction\": {\n        \"reserveTokensFloor\": 20000,\n        \"memoryFlush\": {\n          \"enabled\": true,\n          \"softThresholdTokens\": 4000,\n          \"systemPrompt\": \"会话接近压缩。现在存储持久的记忆。\",\n          \"prompt\": \"将持久的笔记写入 memory/YYYY-MM-DD.md；如果没有要存储的，回复 NO_REPLY。\"\n        }\n      }\n    }\n  }\n}\n</code></pre>\n<h2 id=\"剪枝\">剪枝</h2>\n<p>工具结果可能非常庞大。单个exec命令可能输出5万个字符的日志。剪枝会修剪这些旧输出，而不重写历史。这是一个有损过程，旧输出无法恢复。</p>\n<pre><code class=\"language-text\">┌─────────────────────────────────────────────────────────────┐\n│  剪枝前（内存中）                                           │\n│                                                             │\n│  工具结果（exec）：[5万个字符的npm install输出]               │\n│  工具结果（read）：[大型配置文件，1万个字符]                  │\n│  工具结果（exec）：[构建日志，3万个字符]                      │\n│  用户：\"构建成功了吗？\"                                      │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼ （软修剪 + 硬清除）\n┌─────────────────────────────────────────────────────────────┐\n│  剪枝后（发送给模型）                                       │\n│                                                             │\n│  工具结果（exec）：\"npm WARN deprecated...[已截断]           │\n│                       ...成功安装。\"                        │\n│  工具结果（read）：\"[旧工具结果内容已清除]\"                   │\n│  工具结果（exec）：[保留 - 太新，不适合剪枝]                  │\n│  用户：\"构建成功了吗？\"                                      │\n└─────────────────────────────────────────────────────────────┘\n</code></pre>\n<p>磁盘上的JSONL文件：保持不变（完整输出仍然在那里）</p>\n<h3 id=\"缓存ttl剪枝\">缓存TTL剪枝</h3>\n<p>Anthropic会对提示词前缀进行最多5分钟的缓存，以减少重复调用的延迟和成本。当相同的提示词前缀在TTL窗口内发送时，缓存的token成本降低约90%。TTL过期后，下一个请求必须重新缓存整个提示词。</p>\n<p>问题：如果会话在TTL之后闲置，下一个请求会失去缓存，必须以完整的\"缓存写入\"价格重新缓存完整的对话历史。</p>\n<p>缓存TTL剪枝通过在缓存过期后检测并修剪旧工具结果来解决这个问题。更小的提示词重新缓存意味着更低的成本：</p>\n<pre><code class=\"language-json\">{\n  \"agent\": {\n    \"contextPruning\": {\n      \"mode\": \"cache-ttl\",\n      \"ttl\": \"600\",\n      \"keepLastAssistants\": 3,\n      \"softTrim\": {\n        \"maxChars\": 4000,\n        \"headChars\": 1500,\n        \"tailChars\": 1500\n      },\n      \"hardClear\": {\n        \"enabled\": true,\n        \"placeholder\": \"[旧工具结果内容已清除]\"\n      }\n    }\n  }\n}\n</code></pre>\n<h2 id=\"会话生命周期\">会话生命周期</h2>\n<p>会话不会永远持续。它们根据可配置的规则进行重置，为记忆创建自然的边界。默认行为是每天重置。但也有其他模式可用。</p>\n<h3 id=\"会话记忆钩子\">会话记忆钩子</h3>\n<p>当你运行 /new 开始一个新会话时，会话记忆钩子可以自动保存上下文：</p>\n<pre><code class=\"language-text\">/new\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  触发会话记忆钩子                                           │\n│                                                             │\n│  1. 从结束会话中提取最后15条消息                            │\n│  2. 通过LLM生成描述性slug                                   │\n│  3. 保存到 ~/clawd/memory/2026-01-26-api-design.md          │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  新会话开始                                                 │\n│                                                             │\n│  之前的上下文现在可以通过 memory_search 搜索                │\n└─────────────────────────────────────────────────────────────┘\n</code></pre>\n<h2 id=\"总结\">总结</h2>\n<p>Clawdbot的记忆系统之所以成功，是因为它遵循了几个关键原则：</p>\n<p><strong>1. 透明优于黑盒</strong></p>\n<p>记忆是纯Markdown。你可以阅读、编辑、版本控制它。没有不透明数据库或专有格式。</p>\n<p><strong>2. 搜索优于注入</strong></p>\n<p>与其用所有内容塞满上下文，不如让Agent搜索相关内容。这保持上下文聚焦并降低成本。</p>\n<p><strong>3. 持久优于会话</strong></p>\n<p>重要信息作为文件保存在磁盘上，而不仅仅存在于对话历史中。压缩无法摧毁已经保存的内容。</p>\n<p><strong>4. 混合优于单一</strong></p>\n<p>纯向量搜索会漏掉精确匹配。纯关键词搜索会漏掉语义。混合搜索两者兼得。</p>\n<h2 id=\"参考资料\">参考资料</h2>\n<ul>\n<li>Clawdbot文档(<a href=\"https://docs.clawd.bot/\" rel=\"noopener nofollow\" target=\"_blank\">https://docs.clawd.bot/</a>) - 官方文档，涵盖设置、配置和所有功能</li>\n<li>GitHub仓库(<a href=\"https://github.com/clawdbot/clawdbot\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/clawdbot/clawdbot</a>) - 源代码、问题和社区贡献</li>\n</ul>\n<p>感谢阅读，如果对Vibe Coding和Agent开发感兴趣，也可以<a href=\"https://didispace.com/\" rel=\"noopener nofollow\" target=\"_blank\">关注我的博客：程序猿DD</a></p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 20:27</span>&nbsp;\n<a href=\"https://www.cnblogs.com/didispace\">程序猿DD</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "【保姆级教程】手把手教你安装OpenClaw并接入飞书，让AI在聊天软件里帮你干活",
      "link": "https://www.cnblogs.com/weipo0105/p/19558953",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n\t\t\t<a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/weipo0105/p/19558953\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 19:50\">\n    <span>【保姆级教程】手把手教你安装OpenClaw并接入飞书，让AI在聊天软件里帮你干活</span>\n    \n\n</a>\n\n\t\t</h1>\n\t\t<div class=\"clear\"></div>\n\t\t<div class=\"postBody\">\n\t\t\t    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        <img alt=\"【保姆级教程】手把手教你安装OpenClaw并接入飞书，让AI在聊天软件里帮你干活\" class=\"desc_img\" src=\"https://img2024.cnblogs.com/blog/1205021/202601/1205021-20260131195003333-854515303.png\" />\n        OpenClaw 是一款能直接操作你电脑的开源AI助手，不止于聊天，更能替你执行任务。本文提供一份保姆级教程，从零开始，详细演示如何在 Windows 系统上完成 OpenClaw 的安装、初始配置，并重点一步步教你接入飞书机器人，最终实现在飞书App中直接指挥你的AI助手处理工作。跟随图文指引，轻松拥有你的个人“贾维斯”。\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>这里先做一下简单的科普：</p>\n<p><code>OpenClaw</code> 的名字经历了三次变更，第一次叫做 <code>ClawdBot</code>，后来因为名字跟 <code>Claude</code> 太过相似，被 <code>CLaude</code> 告侵权，遂改名 <code>MoltBot</code> 。</p>\n<p>但是后来在改名过程中遭遇域名和社交账号被抢注，甚至出坑同名加密货币割韭菜的情况，导致名称传播受阻。</p>\n<p>最终定名为：<strong>OpenClaw</strong>。</p>\n<p>所以，名字经历先后顺序为：ClawdBot -&gt; MoltBot -&gt; OpenClaw</p>\n<p>大家不要因为名字困惑了，怀疑是不是自己下错软件了，他们都是同一个。</p>\n<h1 id=\"一什么是-openclaw\">一、什么是 OpenClaw？</h1>\n<p><strong>OpenClaw</strong>（曾用名 Clawdbot）是一款 2026 年爆火的开源个人 AI 助手，GitHub 星标已超过 10 万颗。与传统 AI 聊天机器人的根本区别在于：</p>\n<ul>\n<li><strong>真正的执行能力</strong>：不仅能回答问题，还能实际操作你的电脑</li>\n<li><strong>24/7 全天候待命</strong>：在你睡觉时也能主动完成任务</li>\n<li><strong>完全开源免费</strong>：数据完全掌控在自己手中</li>\n<li><strong>支持多种通讯平台</strong>：在国外，WhatsApp、Telegram、Discord、Slack、iMessage 等，在国内，飞书，钉钉等各大厂商的即时聊天软件已经支持接入</li>\n</ul>\n<p><strong>它能做什么？</strong></p>\n<p>它不只是回答问题的聊天机器人，而是真的能在你电脑上动手操作。比如你告诉它“帮我整理一下上个月的邮件”，它就默默去处理了；你睡觉时，它还能继续干活，退订广告、预约行程、甚至找找 Bug。</p>\n<p>它完全免费，你的数据都在自己手里。而且可以用钉钉，飞书，WhatsApp、Telegram等各类即时通讯软件来指挥他干活！</p>\n<p>简单来说，一句话交给它，从整理桌面文件到控制家里灯光，它都默默帮你搞定。是你电脑里真正的贾维斯！超级智能的AI助理！</p>\n<h1 id=\"二安装nodejs\">二、安装nodejs</h1>\n<p>后面执行一键安装命令，可以自动安装nodejs，但是如果为了加快速度，防止安装意外，可以先安装nodejs：</p>\n<p>官方下载地址：<a href=\"https://nodejs.org/zh-cn/download\" rel=\"noopener nofollow\" target=\"_blank\">https://nodejs.org/zh-cn/download</a><br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<h1 id=\"三开始安装\">三、开始安装</h1>\n<h3 id=\"一设置-powershell-执行权限\">一）设置 PowerShell 执行权限</h3>\n<p>以管理员身份运行 PowerShell：</p>\n<ol>\n<li>按 <code>Win</code> 键，搜索 <strong>PowerShell</strong></li>\n<li>右键点击 <strong>Windows PowerShell</strong></li>\n<li>选择 <strong>以管理员身份运行</strong></li>\n<li>点击 <strong>是</strong> 确认<br />\n<img alt=\"\" class=\"lazyload\" /></li>\n</ol>\n<p>在管理员 PowerShell 窗口中，依次执行以下两条命令：</p>\n<pre><code class=\"language-powershell\">Set-ExecutionPolicy RemoteSigned -Scope CurrentUser\n\nSet-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass\n</code></pre>\n<p><strong>这是什么意思？</strong></p>\n<ul>\n<li>第一条命令：允许当前用户运行本地和下载的脚本</li>\n<li>第二条命令：允许当前用户运行本地和下载的脚本</li>\n</ul>\n<blockquote>\n<p>⚠️ <strong>安全提示</strong>：这些命令只会影响您自己的账户，不会影响系统安全或其他用户。</p>\n</blockquote>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h3 id=\"二执行一键安装命令\">二）执行一键安装命令</h3>\n<p>复制以下命令，粘贴到 PowerShell 窗口中，按 <strong>Enter</strong> 执行：</p>\n<pre><code class=\"language-powershell\">iwr -useb https://openclaw.ai/install.ps1 | iex\n</code></pre>\n<p><strong>安装过程会自动完成：</strong></p>\n<ul>\n<li>检测系统环境</li>\n<li>安装必要依赖（Node.js 等）</li>\n<li>下载 OpenClaw 核心文件</li>\n<li>配置环境变量</li>\n<li>启动配置向导</li>\n</ul>\n<blockquote>\n<p>注意：如果命令执行后，还是报错，可以自己到官网下载node安装包，自己安装node环境，注意版本最好在 node v22.x 以上，node官网下载地址：<a href=\"https://nodejs.org/zh-cn/download%EF%BC%8C%E8%8B%A5%E8%BF%98%E6%98%AF%E4%B8%8D%E6%87%82%E6%80%8E%E4%B9%88%E5%AE%89%E8%A3%85%EF%BC%8C%E7%82%B9%E5%A4%B4%E5%83%8F%E8%BF%9B%E6%88%91%E4%B8%BB%E9%A1%B5%E6%89%BE%E5%88%B0%E6%88%91%EF%BC%8C%E6%8B%89%E4%BD%A0%E8%BF%9B%E4%BA%A4%E6%B5%81%E7%BE%A4\" rel=\"noopener nofollow\" target=\"_blank\">https://nodejs.org/zh-cn/download，若还是不懂怎么安装，点头像进我主页找到我，拉你进交流群</a></p>\n</blockquote>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h1 id=\"四初始配置向导\">四、初始配置向导</h1>\n<p>安装完成后，会自动进入配置向导（<code>openclaw onboard</code>）。</p>\n<h2 id=\"一风险告知\">一）风险告知</h2>\n<p>这一步主要是告诉你，使用OpenClaw可能会有一些风险。请问你是否继续？<br />\n按 向左方向键 ←，选择 <code>Yes</code>，按 <code>Enter</code> 回车确认<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"二选择-qiuickstart-模式\">二）选择 QiuickStart 模式</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"三配置-ai-模型-api-key\">三）配置 AI 模型 API Key</h2>\n<p>OpenClaw 需要连接到大语言模型才能工作。Openclaw 比较费token，国外模型成本高，门槛也高，这里我选择国内的智谱的 GLM 4.7</p>\n<blockquote>\n<p>如果没有智谱的API Key，点击官方地址自己注册账号获取API key：<a href=\"https://www.bigmodel.cn/glm-coding?ic=RBSKXMPNJP\" rel=\"noopener nofollow\" target=\"_blank\">https://www.bigmodel.cn/glm-coding?ic=RBSKXMPNJP</a></p>\n</blockquote>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>输入自己的 API Key：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"四选择-ai-模型\">四）选择 AI 模型</h2>\n<blockquote>\n<p>这里我选择默认的GLM 4.7，也是智普当前的旗舰模型</p>\n</blockquote>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"五连接即时通讯平台\">五）连接即时通讯平台</h2>\n<p>配置完 AI 模型后，OpenClaw 会询问你要连接哪个通讯平台？</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<blockquote>\n<p>OpenClaw 原生支持的即时通信平台主要是海外的 WhatsApp、Telegram、Discord、Slack、iMessage 等，国内用户不习惯，这里国产即时通信软件大厂也跟进了，现在钉钉，飞书等都已支持接入OpenClaw</p>\n</blockquote>\n<p>后面会带领大家把飞书机器人接入 OpenClaw，使大家可以通过飞书即可指挥OpenClaw为我们干活，但是飞书配置比较复杂，这里我们先选择跳过，后面我们可以通过继续进行配置：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"六选择skills\">六）选择Skills</h2>\n<p>这里也选择：No，暂不配置，后面通过UI界面进行配置：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"七是否开启hooks\">七）是否开启Hooks</h2>\n<p>操作步骤：先敲<strong>空格</strong>，表示选中当前项，再敲回车键</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"八启动服务并打开ui界面\">八）启动服务并打开UI界面</h2>\n<p>此时它会自动再打开一个命令窗口来启动服务:</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<blockquote>\n<p>这个过程是在启动服务，可能会需要等一点时间</p>\n</blockquote>\n<p>同时，大约过30秒左右，我们回到刚才的设置窗口，选择 <code>Open the Web UI</code> ，打开 <code>OpenClaw</code> 的UI界面：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>浏览器自动打开Web UI界面：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"九测试一下\">九）测试一下</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h1 id=\"五接入飞书机器人\">五、接入飞书机器人</h1>\n<p>我们需要先到飞书平台创建自己的机器人来接入OpenClaw：</p>\n<h2 id=\"一来到飞书开发者后台\">一）来到飞书开发者后台</h2>\n<p>飞书开放平台地址：<a href=\"https://open.feishu.cn\" rel=\"noopener nofollow\" target=\"_blank\">https://open.feishu.cn</a></p>\n<blockquote>\n<p>没有飞书账号的，需要自己注册账号</p>\n</blockquote>\n<p>点击右上角进入 <strong>开发者后台</strong>：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"二创建应用\">二）创建应用</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"三填写应用信息\">三）填写应用信息</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"四获取自己的应用凭证\">四）获取自己的应用凭证</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"五给应用添加机器人\">五）给应用添加机器人</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"六给应用配置权限\">六）给应用配置权限</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>把即时通讯相关的权限全部开通：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"七创建版本并发布\">七）创建版本并发布</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>来到飞书客户端进行审批：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"八安装飞书插件\">八）安装飞书插件</h2>\n<p>打开powershell，输入以下命令，安装飞书插件：</p>\n<pre><code>openclaw plugins install @m1heng-clawd/feishu\n</code></pre>\n<p>安装成功后，再打开一个新的命令窗口，开始配置飞书插件：</p>\n<p>输入命令：<code>openclaw config</code></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>选择渠道:<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>选择配置链接:<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>输入飞书的AppID，AppSecrect：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>域名选择中国的：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>接受群组聊天：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>选择完成：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>选择yes：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>选择open：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>选择继续，完成配置：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>重启服务，使配置生效：<br />\n控制可以看到飞书插件已经配置成功<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"七回到飞书后台设置事件回调\">七）回到飞书后台设置事件回调</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>选择 <code>使用长连接接收事件</code> ：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>可以看到添加事件按钮由原来的灰色不可点击变为可点击：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>添加接收消息事件：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>给应用开通获取通讯录基本信息的权限：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>重新发布版本：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>跟前面的步骤一样，发布为在线应用即可。</p>\n<p>现在可以在 飞书中与 AI 助手对话了！</p>\n<h2 id=\"八在飞书中与openclaw对话\">八）在飞书中与OpenClaw对话</h2>\n<p>来到飞书客户端或者手机飞书app上：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>以下是openclaw文件夹下面的文档内的内容：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>现在我跟废水机器人对话，让他告诉我指定文档内是什么内容：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<hr />\n<h1 id=\"六访问-web-控制面板\">六、访问 Web 控制面板</h1>\n<p>配置完成后，PowerShell 窗口底部会显示控制面板链接，格式类似：</p>\n<pre><code>Control UI: http://127.0.0.1:18789\n</code></pre>\n<ol>\n<li>复制完整链接</li>\n<li>在浏览器中打开</li>\n<li>即可看到可视化UI管理界面</li>\n</ol>\n<hr />\n<h1 id=\"七常用命令速查\">七、常用命令速查</h1>\n<table>\n<thead>\n<tr>\n<th>命令</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>openclaw onboard</code></td>\n<td>重新进入配置向导</td>\n</tr>\n<tr>\n<td><code>openclaw status</code></td>\n<td>查看运行状态</td>\n</tr>\n<tr>\n<td><code>openclaw health</code></td>\n<td>健康检查</td>\n</tr>\n<tr>\n<td><code>openclaw gateway start</code></td>\n<td>启动服务</td>\n</tr>\n<tr>\n<td><code>openclaw gateway stop</code></td>\n<td>停止服务</td>\n</tr>\n<tr>\n<td><code>openclaw update</code></td>\n<td>更新到最新版本</td>\n</tr>\n<tr>\n<td><code>openclaw doctor</code></td>\n<td>诊断问题</td>\n</tr>\n<tr>\n<td><code>openclaw uninstall</code></td>\n<td>卸载 OpenClaw</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h1 id=\"八常见问题解答\">八、常见问题解答</h1>\n<h3 id=\"q1-安装飞书插件提示spawn-npm-enoent\">Q1: 安装飞书插件提示：spawn npm ENOENT</h3>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>问题原因：这可能是openclaw的一个bug，可以等官方更新，也可以自己去官方仓库提issue</p>\n<p>解决步骤：</p>\n<p>定位问题代码</p>\n<p>文件路径：</p>\n<pre><code>C:\\Users\\Administrator\\AppData\\Roaming\\fnm\\node-versions\\v22.14.0\\installation\\node_modules\\openclaw\\dist\\process\\exec.js\n</code></pre>\n<p>修改代码</p>\n<p>找到 <code>runCommandWithTimeout</code> 函数中的 spawn 调用，修改如下：</p>\n<p><strong>修改前：</strong></p>\n<pre><code class=\"language-javascript\">const stdio = resolveCommandStdio({ hasInput, preferInherit: true });\nconst child = spawn(argv[0], argv.slice(1), {\n    stdio,\n    cwd,\n    env: resolvedEnv,\n    windowsVerbatimArguments,\n});\n</code></pre>\n<p><strong>修改后：</strong></p>\n<pre><code class=\"language-javascript\">const stdio = resolveCommandStdio({ hasInput, preferInherit: true });\n// On Windows, npm must be spawned with shell: true or use .cmd extension\nlet command = argv[0];\nlet useShell = false;\nif (process.platform === \"win32\" &amp;&amp; path.basename(command) === \"npm\") {\n    useShell = true;\n}\nconst child = spawn(command, argv.slice(1), {\n    stdio,\n    cwd,\n    env: resolvedEnv,\n    shell: useShell,\n});\n</code></pre>\n<h3 id=\"q2-提示-openclaw-命令找不到\">Q2: 提示 \"openclaw 命令找不到\"</h3>\n<p><strong>解决方法：</strong></p>\n<ol>\n<li>关闭所有 PowerShell 窗口</li>\n<li>重新打开 PowerShell</li>\n<li>如果还不行，执行 <code>exec bash</code> 或重启电脑</li>\n</ol>\n<h3 id=\"q3-安装卡住不动\">Q3: 安装卡住不动</h3>\n<p><strong>解决方法：</strong></p>\n<ol>\n<li>按 <code>Ctrl + C</code> 中断当前操作</li>\n<li>执行：<code>openclaw doctor</code> 检查问题</li>\n<li>如提示网络问题，检查防火墙设置</li>\n</ol>\n<h3 id=\"q4-api-key-配置错误\">Q4: API Key 配置错误</h3>\n<p><strong>解决方法：</strong></p>\n<ol>\n<li>执行：<code>openclaw onboard</code></li>\n<li>选择重新配置 API Key</li>\n<li>确保密钥格式正确</li>\n</ol>\n<h3 id=\"q5-端口-18789-被占用\">Q5: 端口 18789 被占用</h3>\n<p><strong>解决方法：</strong></p>\n<pre><code class=\"language-powershell\">openclaw gateway --port 18790\n</code></pre>\n<p>使用其他端口启动服务。</p>\n<h1 id=\"九成本说明\">九、成本说明</h1>\n<p>OpenClaw 软件本身完全免费，主要成本来自 AI 模型 API 调用，可选择国产大模型，降低成本。</p>\n<hr />\n<h1 id=\"结语\">结语</h1>\n<p>OpenClaw 代表了个人 AI 助理的未来趋势——从\"聊天工具\"进化为\"执行工具\"。虽然目前的配置过程对小白用户有一定门槛，但一旦完成设置，您将拥有一个 24/7 待命的超级助手。</p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n\t\t</div>\n\t\t<div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 19:50</span>&nbsp;\n<a href=\"https://www.cnblogs.com/weipo0105\">阿坡RPA</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "Redis快速实现布隆过滤器：缓存去重的“智能门卫”",
      "link": "https://www.cnblogs.com/sun-10387834/p/19522155",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/sun-10387834/p/19522155\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 18:32\">\n    <span>Redis快速实现布隆过滤器：缓存去重的“智能门卫”</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>在缓存架构中，总有一些“头疼问题”：用户反复提交相同请求、查询不存在的key导致缓存穿透、海量数据去重效率低下……这些场景下，Redis布隆过滤器就是当之无愧的“救星”。它像一个智能门卫，能快速判断“这个人是不是来过”“这个key是不是不存在”，用极小的空间成本实现高效过滤，性能远超传统的数据库查询或全量缓存校验。</p>\n<p>今天咱们就从“是什么、为什么好用、怎么用Redis快速实现”三个维度，用通俗的语言+实操代码，把布隆过滤器讲透。全程避开复杂公式，就算是刚接触缓存的同学，也能跟着步骤快速落地。</p>\n<h2 id=\"一先搞懂布隆过滤器到底是个啥\">一、先搞懂：布隆过滤器到底是个啥？</h2>\n<p>布隆过滤器（Bloom Filter）本质是一个<strong>基于哈希函数的概率型数据结构</strong>，核心作用是“快速判断一个元素是否存在于集合中”。它不像哈希表那样存储完整数据，而是用一个二进制数组（bit数组）+多个哈希函数，通过标记元素的哈希位置来实现过滤。</p>\n<p>咱们用“小区门卫记访客”的场景类比，秒懂核心逻辑：</p>\n<ul>\n<li>\n<p>二进制数组 = 门卫的登记本，每一页只有“是”（1）和“否”（0）两个状态；</p>\n</li>\n<li>\n<p>哈希函数 = 门卫的“记忆规则”，比如“记住访客的姓氏首字母+身高区间+鞋子颜色”；</p>\n</li>\n<li>\n<p>元素存在判断 = 门卫根据记忆规则核对登记本，只要有一条规则对应“否”，就确定访客没来过；如果全是“是”，则大概率来过（存在极小误判）。</p>\n</li>\n</ul>\n<h3 id=\"核心特性优点与小瑕疵\">核心特性：优点与“小瑕疵”</h3>\n<p>布隆过滤器的优势和局限性都很鲜明，落地前必须摸清：</p>\n<h4 id=\"-核心优点\">✅ 核心优点</h4>\n<ul>\n<li>\n<p>空间占用极小：仅用bit数组存储标记，存储100万条数据，误判率1%时，仅需约1.2MB空间；</p>\n</li>\n<li>\n<p>查询速度极快：时间复杂度是O(k)（k是哈希函数个数），无论数据量多大，都能瞬间返回结果；</p>\n</li>\n<li>\n<p>支持海量数据：无需存储完整数据，可轻松应对千万级、亿级数据的过滤场景。</p>\n</li>\n</ul>\n<h4 id=\"-不可忽视的局限性\">❌ 不可忽视的局限性</h4>\n<ul>\n<li>\n<p>存在误判率：只能确定“元素一定不存在”，不能100%确定“元素一定存在”，误判率可通过参数调整，但无法完全消除；</p>\n</li>\n<li>\n<p>不支持删除操作：一旦元素被标记到bit数组，无法反向清除（会影响其他元素的判断）；</p>\n</li>\n<li>\n<p>需提前预估数据量：哈希函数个数、bit数组长度需根据预估数据量计算，否则会导致误判率飙升。</p>\n</li>\n</ul>\n<h2 id=\"二redis实现布隆过滤器的两种方式\">二、Redis实现布隆过滤器的两种方式</h2>\n<p>Redis本身没有内置布隆过滤器，但提供了两种快速实现的方案：一是基于Redis的BitMap（位图）手动实现，灵活可控；二是使用Redis官方推荐的Redisson客户端，封装好现成API，开箱即用。咱们分别讲实操，按需选择即可。</p>\n<h3 id=\"方案一基于bitmap手动实现灵活可控\">方案一：基于BitMap手动实现（灵活可控）</h3>\n<p>核心思路：利用Redis的BitMap数据结构作为布隆过滤器的bit数组，通过多个哈希函数计算元素的哈希值，将对应位置的bit置为1；查询时，同样计算哈希值，检查所有位置是否为1，全为1则大概率存在，否则一定不存在。</p>\n<h4 id=\"1-关键参数计算避免误判率过高\">1. 关键参数计算（避免误判率过高）</h4>\n<p>手动实现前，需先确定三个核心参数，可通过公式或在线工具计算：</p>\n<ul>\n<li>\n<p>m：bit数组长度（单位：bit），预估数据量n越大，m需越大；</p>\n</li>\n<li>\n<p>k：哈希函数个数，k过多会导致bit数组快速被占满，误判率上升；k过少则过滤效果差；</p>\n</li>\n<li>\n<p>p：可接受的误判率（通常设为0.01~0.1）。</p>\n</li>\n</ul>\n<p>常用计算公式（无需死记，在线工具直接算）：</p>\n<ul>\n<li>\n<p>m = - (n * ln p) / (ln 2)² （bit数组长度）；</p>\n</li>\n<li>\n<p>k = (m / n) * ln 2 （哈希函数个数）。</p>\n</li>\n</ul>\n<p>举个例子：预估存储10万条数据，误判率设为0.01，计算得m≈958505 bit（约117KB），k≈7个哈希函数。</p>\n<h4 id=\"2-手动实现代码java示例\">2. 手动实现代码（Java示例）</h4>\n<p>核心是实现多个哈希函数，操作Redis的BitMap指令（SETBIT置1，GETBIT查询）：</p>\n<pre><code class=\"language-java\">import org.springframework.data.redis.core.StringRedisTemplate;\nimport java.nio.charset.StandardCharsets;\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\n\n/**\n * 基于Redis BitMap手动实现布隆过滤器\n */\npublic class RedisBloomFilter {\n    // Redis键名\n    private final String key;\n    // bit数组长度\n    private final long bitSize;\n    // 哈希函数个数\n    private final int hashCount;\n    private final StringRedisTemplate stringRedisTemplate;\n\n    // 构造器：初始化参数\n    public RedisBloomFilter(String key, long n, double p, StringRedisTemplate stringRedisTemplate) {\n        this.key = key;\n        this.stringRedisTemplate = stringRedisTemplate;\n        // 计算bit数组长度\n        this.bitSize = (long) (-n * Math.log(p) / (Math.log(2) * Math.log(2)));\n        // 计算哈希函数个数\n        this.hashCount = (int) (this.bitSize / n * Math.log(2));\n    }\n\n    // 添加元素到布隆过滤器\n    public void add(Object value) {\n        byte[] bytes = value.toString().getBytes(StandardCharsets.UTF_8);\n        long[] hashes = hash(bytes, hashCount, bitSize);\n        for (long hash : hashes) {\n            // 把对应bit位置置为1\n            stringRedisTemplate.opsForValue().setBit(key, hash, true);\n        }\n    }\n\n    // 判断元素是否存在（存在返回true，不存在返回false；true可能是误判）\n    public boolean contains(Object value) {\n        byte[] bytes = value.toString().getBytes(StandardCharsets.UTF_8);\n        long[] hashes = hash(bytes, hashCount, bitSize);\n        for (long hash : hashes) {\n            // 只要有一个bit位为0，就确定不存在\n            if (!stringRedisTemplate.opsForValue().getBit(key, hash)) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    // 多哈希函数实现（基于MD5拆分）\n    private long[] hash(byte[] bytes, int hashCount, long bitSize) {\n        long[] hashes = new long[hashCount];\n        try {\n            MessageDigest md5 = MessageDigest.getInstance(\"MD5\");\n            byte[] digest = md5.digest(bytes);\n            // 把MD5结果（16字节）拆分成多个哈希值\n            for (int i = 0; i &lt; hashCount; i++) {\n                long hash = 0;\n                for (int j = i * 2; j &lt; (i + 1) * 2 &amp;&amp; j &lt; digest.length; j++) {\n                    hash = hash * 256 + (digest[j] &amp; 0xFF);\n                }\n                // 确保哈希值在bit数组长度范围内\n                hashes[i] = hash % bitSize;\n            }\n        } catch (NoSuchAlgorithmException e) {\n            throw new RuntimeException(\"哈希函数初始化失败\", e);\n        }\n        return hashes;\n    }\n}\n</code></pre>\n<h4 id=\"3-使用方式\">3. 使用方式</h4>\n<pre><code class=\"language-java\">// 初始化布隆过滤器：key为\"user:bloom:filter\"，预估10万条数据，误判率0.01\nRedisBloomFilter bloomFilter = new RedisBloomFilter(\"user:bloom:filter\", 100000, 0.01, stringRedisTemplate);\n\n// 添加元素\nbloomFilter.add(\"user123\");\nbloomFilter.add(\"order456\");\n\n// 判断元素是否存在\nboolean exists = bloomFilter.contains(\"user123\"); // 大概率返回true\nboolean notExists = bloomFilter.contains(\"user789\"); // 一定返回false\n</code></pre>\n<h3 id=\"方案二redisson客户端实现开箱即用\">方案二：Redisson客户端实现（开箱即用）</h3>\n<p>如果觉得手动实现麻烦，推荐用Redisson——Redis官方生态的Java客户端，已经封装好了布隆过滤器，支持自动计算参数、分布式场景，还解决了手动实现的哈希函数优化问题，生产环境首选。</p>\n<h4 id=\"1-引入依赖\">1. 引入依赖</h4>\n<pre><code class=\"language-xml\">&lt;dependency&gt;\n    &lt;groupId&gt;org.redisson&lt;/groupId&gt;\n    &lt;artifactId&gt;redisson-spring-boot-starter&lt;/artifactId&gt;\n    &lt;version&gt;3.23.3&lt;/version&gt; // 版本与Redis版本适配\n&lt;/dependency&gt;\n</code></pre>\n<h4 id=\"2-快速实现代码\">2. 快速实现代码</h4>\n<pre><code class=\"language-java\">import org.redisson.api.RBloomFilter;\nimport org.redisson.api.RedissonClient;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class RedissonBloomFilterDemo {\n    @Autowired\n    private RedissonClient redissonClient;\n\n    // 初始化布隆过滤器\n    public RBloomFilter&lt;String&gt; initBloomFilter() {\n        // 布隆过滤器名称\n        String filterName = \"user:bloom:filter:redisson\";\n        // 获取布隆过滤器实例\n        RBloomFilter&lt;String&gt; bloomFilter = redissonClient.getBloomFilter(filterName);\n        // 初始化：预估10万条数据，误判率0.01（Redisson会自动计算m和k）\n        bloomFilter.tryInit(100000, 0.01);\n        return bloomFilter;\n    }\n\n    // 测试使用\n    public void testBloomFilter() {\n        RBloomFilter&lt;String&gt; bloomFilter = initBloomFilter();\n        // 添加元素\n        bloomFilter.add(\"user123\");\n        bloomFilter.add(\"order456\");\n\n        // 判断元素是否存在\n        boolean exists = bloomFilter.contains(\"user123\"); // 大概率true\n        boolean notExists = bloomFilter.contains(\"user789\"); // 一定false\n\n        // 统计已添加元素数量（近似值）\n        long count = bloomFilter.count();\n        System.out.println(\"已添加元素数量：\" + count);\n    }\n}\n</code></pre>\n<h4 id=\"3-核心优势\">3. 核心优势</h4>\n<ul>\n<li>\n<p>分布式支持：适配微服务场景，多实例共享同一个布隆过滤器，无需担心数据一致性；</p>\n</li>\n<li>\n<p>参数优化：内置更高效的哈希函数（MurmurHash），误判率控制更精准；</p>\n</li>\n<li>\n<p>API丰富：支持元素计数、批量添加等功能，比手动实现更完善。</p>\n</li>\n</ul>\n<h2 id=\"三实际应用场景与避坑指南\">三、实际应用场景与避坑指南</h2>\n<h3 id=\"-典型应用场景\">✅ 典型应用场景</h3>\n<ol>\n<li>\n<p>缓存穿透防护：查询数据库前，先用布隆过滤器判断key是否存在，不存在则直接返回，避免大量无效数据库查询；</p>\n</li>\n<li>\n<p>海量数据去重：比如用户签到、日志去重、爬虫URL去重，无需存储全量数据，仅用bit数组标记；</p>\n</li>\n<li>\n<p>防止重复提交：接口请求前，用布隆过滤器判断请求ID是否已处理，避免重复业务逻辑执行；</p>\n</li>\n<li>\n<p>黑名单过滤：比如垃圾邮件识别、恶意IP拦截，快速判断是否在黑名单中。</p>\n</li>\n</ol>\n<h3 id=\"-避坑指南\">❌ 避坑指南</h3>\n<ul>\n<li>\n<p>不要用在“绝对不能误判”的场景：比如金融交易、用户登录验证，误判可能导致严重问题；</p>\n</li>\n<li>\n<p>提前预估数据量：若实际数据量远超预估，bit数组会被快速占满，误判率会急剧上升，可预留2~3倍冗余；</p>\n</li>\n<li>\n<p>定期重置布隆过滤器：若数据有过期特性（比如每日黑名单更新），可定期删除旧的布隆过滤器，重建新实例；</p>\n</li>\n<li>\n<p>Redis集群注意事项：手动实现的布隆过滤器若用在Redis集群中，需确保key落在同一个节点（避免哈希分片导致bit数组分散），Redisson已自动处理该问题。</p>\n</li>\n</ul>\n<h2 id=\"四总结什么时候选哪种实现方式\">四、总结：什么时候选哪种实现方式？</h2>\n<p>Redis布隆过滤器的核心价值的是“用极小空间换极高过滤效率”，落地时按场景选择实现方式：</p>\n<ul>\n<li>\n<p>快速落地、生产环境、分布式场景：选Redisson，省心高效，适配性强；</p>\n</li>\n<li>\n<p>学习研究、自定义哈希函数、特殊参数需求：选手动实现，灵活可控，加深对原理的理解。</p>\n</li>\n</ul>\n<p>其实布隆过滤器的逻辑并不复杂，核心就是“哈希标记+概率判断”。掌握它之后，面对缓存穿透、海量去重等问题，就不用再靠“全量存储”这种笨办法，能大幅提升系统性能和空间利用率。下次再遇到类似场景，直接掏出Redis布隆过滤器，轻松搞定！</p>\n\n\n</div>\n<div id=\"MySignature\">\n    \n<p>❤️ 如果你喜欢这篇文章，请点赞支持！ 👍 同时欢迎关注我的博客，获取更多精彩内容！</p>\n\n<p>本文来自博客园，作者：<a href=\"https://www.cnblogs.com/sun-10387834/\" target=\"_blank\">佛祖让我来巡山</a>，转载请注明原文链接：<a href=\"https://www.cnblogs.com/sun-10387834/p/19522155\" target=\"_blank\">https://www.cnblogs.com/sun-10387834/p/19522155</a></p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 18:32</span>&nbsp;\n<a href=\"https://www.cnblogs.com/sun-10387834\">佛祖让我来巡山</a>&nbsp;\n阅读(<span id=\"post_view_count\">20</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "linux服务器静默安装Oracle26ai",
      "link": "https://www.cnblogs.com/liuziyi1/p/19558714",
      "published": "",
      "description": "<h2>\n\t\t\t<a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/liuziyi1/p/19558714\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 17:45\">\n    <span>linux服务器静默安装Oracle26ai</span>\n    \n\n</a>\n\n\t\t</h2>\n\t\t<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>下载地址：<a href=\"https://www.oracle.com/database/technologies/oracle26ai-linux-downloads.html\" rel=\"noopener nofollow\" target=\"_blank\">https://www.oracle.com/database/technologies/oracle26ai-linux-downloads.html</a><br />\n<img alt=\"image\" class=\"lazyload\" /></p>\n<p>1.安装环境准备<br />\n1.1.查看物理内存<br />\n<code>[root@aiserver ~]# free -m</code><br />\n1.2.操作系统版本</p>\n<pre><code>[root@aiserver ~]#  cat /etc/redhat-release\n</code></pre>\n<p>1.3.操作系统内存</p>\n<pre><code>[root@aiserver ~]# df -h /dev/shm/\n</code></pre>\n<p>1.4.磁盘空间</p>\n<pre><code>[root@aiserver ~]# df -TH\n[root@aiserver ~]# df -h /tmp/\n[root@aiserver ~]# df -h /u01\n</code></pre>\n<p>1.5.查看系统架构</p>\n<pre><code>[root@aiserver ~]# uname -m\nx86_64\n</code></pre>\n<p><code>[root@aiserver ~]# cat /proc/version</code></p>\n<p>1.6.解析/etc/hosts</p>\n<pre><code>[root@aiserver ~]# hostname\naiserver\n\ncat &gt;&gt; /etc/hosts &lt;&lt; EOF\n192.168.1.1 aiserver\nEOF\n</code></pre>\n<p>1.7.关闭防火墙还有selinux</p>\n<pre><code>systemctl status firewalld.service\nsystemctl stop firewalld.service\nsystemctl disable firewalld.service\n</code></pre>\n<p><code>sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config</code></p>\n<p>2.创建用户和组</p>\n<h1 id=\"查看是否安装有oracle软件\">查看是否安装有Oracle软件</h1>\n<p><code>[root@aiserver ~]# more /etc/oraInst.loc</code></p>\n<h1 id=\"查看是否已存在相关用户组\">查看是否已存在相关用户组</h1>\n<pre><code>[root@aiserver ~]# grep oinstall /etc/group\n[root@aiserver ~]# grep dba /etc/group\n[root@aiserver ~]# grep oper /etc/group\n</code></pre>\n<pre><code>[root@aiserver ~]# /usr/sbin/groupadd -g 54321 oinstall\n[root@aiserver ~]# /usr/sbin/groupadd -g 54322 dba\n[root@aiserver ~]# /usr/sbin/groupadd -g 54323 oper\n[root@aiserver ~]# /usr/sbin/useradd -u 54321 -g oinstall -G dba,oper oracle\n</code></pre>\n<p>--修改密码为oracle<br />\n<code>[root@aiserver ~]# passwd oracle</code></p>\n<p>3.创建工作的目录</p>\n<pre><code>[root@aiserver ~]# mkdir -p /u01/app/oracle\n[root@aiserver ~]# chown -R oracle:oinstall /u01/\n[root@aiserver ~]# chmod -R 775 /u01/app/oracle\n</code></pre>\n<p>4.配置Oracle的环境变量</p>\n<pre><code>[oracle@aiserver ~]$ vi .bash_profile\n\nexport ORACLE_BASE=/u01/app/oracle\nexport ORACLE_HOME=$ORACLE_BASE/product/23.26.1/dbhome_1\nexport ORACLE_SID=prod\nexport PATH=$ORACLE_HOME/bin:$PATH:$HOME/bin\n</code></pre>\n<pre><code>[oracle@aiserver ~]$ source .bash_profile\n[oracle@aiserver ~]$ env | grep ORACLE\n</code></pre>\n<p>5.修改内核参数<br />\n以下在root用户下操作</p>\n<pre><code>cp /etc/sysctl.conf /etc/sysctl.conf.bak\n\ncat &gt;&gt; /etc/sysctl.conf &lt;&lt; \"EOF\"\nfs.file-max = 6815744\nkernel.sem = 250 32000 100 128\nkernel.shmmni = 4096\nkernel.shmall = 751619276\nkernel.shmmax = 3006477107\nkernel.panic_on_oops = 1\nnet.core.rmem_default = 262144\nnet.core.rmem_max = 4194304\nnet.core.wmem_default = 262144\nnet.core.wmem_max = 1048576\nfs.aio-max-nr = 1048576\nnet.ipv4.ip_local_port_range = 9000 65500\nEOF\n\nkernel.shmall :物理内存的70%\nkernel.shmmni=kernel.shmall/4\n\n环境变量生效\nsysctl --system\n</code></pre>\n<p>6./etc/profile配置<br />\n以下root用户操作</p>\n<pre><code>cp /etc/profile /etc/profile.bak\n\ncat &gt;&gt; /etc/profile &lt;&lt; \"EOF\"\nif [ $USER = \"oracle\" ]; then\n        if [ $SHELL = \"/bin/ksh\" ]; then\n                ulimit -p 16384\n                ulimit -n 65536\n        else\n                ulimit -u 16384 -n 65536\n        fi\nfi\nEOF\n\n\nvi /etc/pam.d/login\nsession    required     pam_limits.so\n</code></pre>\n<p>7.修改资源限制<br />\n以下root用户操作</p>\n<pre><code>cp /etc/security/limits.conf /etc/security/limits.conf.bak\n\ncat &gt;&gt; /etc/security/limits.conf &lt;&lt; \"EOF\"\noracle soft nproc 2047\noracle hard nproc 16384\noracle soft nofile 1024\noracle hard nofile 65536\nEOF\n</code></pre>\n<p>8.yum安装依赖</p>\n<pre><code>[root@aiserver ~]# mount | grep sr0\nmount /dev/cdrom /mnt\n\necho \"[localREPO]\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"name=localhost8\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"baseurl=file:///mnt/BaseOS\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"gpgcheck=0\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"enabled=1\" &gt;&gt; /etc/yum.repos.d/my.repo\n\necho \"[localREPO_APP]\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"name=localhost8_app\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"baseurl=file:///mnt/AppStream\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"gpgcheck=0\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"enabled=1\" &gt;&gt; /etc/yum.repos.d/my.repo\n\n[root@aiserver yum.repos.d]# yum repolist\n</code></pre>\n<p>以下命令安装依赖包</p>\n<pre><code>yum install bc \\\nbinutils \\\ncompat-openssl10 \\\nelfutils-libelf \\\nfontconfig \\\nglibc \\\nglibc-devel \\\nksh \\\nlibaio \\\nlibXrender \\\nlibX11 \\\nlibXau \\\nlibXi \\\nlibXtst \\\nlibgcc \\\nlibstdc++ \\\nlibxcb \\\nlibibverbs \\\nlibasan \\\nliblsan \\\nlibrdmacm \\\nmake \\\npolicycoreutils \\\npolicycoreutils-python-utils \\\nsmartmontools \\\nsysstat -y\n</code></pre>\n<p>9.解压软件授权、<br />\noracle用户下操作<br />\n<code>[oracle@aiserver ~]$ mkdir -p /u01/app/oracle/product/23.26.1/dbhome_1</code></p>\n<p>oracle用户下操作<br />\n<code>[oracle@aiserver ~]$ unzip /opt/LINUX.X64_2326100_db_home.zip -d $ORACLE_HOME</code></p>\n<p>10.静默安装Oracle数据库<br />\n10.1.编辑rsp文件</p>\n<pre><code>[oracle@aiserver ~]$ cd $ORACLE_HOME/install/response\n[oracle@aiserver response]$ cp db_install.rsp /tmp\n</code></pre>\n<pre><code>vi /tmp/db_install.rsp\n\n修改db_install.rsp文件中以下内容\n\noracle.install.option=INSTALL_DB_SWONLY\nUNIX_GROUP_NAME=oinstall\nINVENTORY_LOCATION=/u01/app/oraInventory\nORACLE_BASE=/u01/app/oracle\nORACLE_HOME=/u01/app/oracle/product/23.26.1/dbhome_1\nInstallEdition=EE\nOSDBA_GROUP=dba\nOSOPER_GROUP=oper\nOSBACKUPDBA_GROUP=dba\nOSDGDBA_GROUP=dba\nOSKMDBA_GROUP=dba\nOSRACDBA_GROUP=dba\n</code></pre>\n<p>dbType=GENERAL_PURPOSE</p>\n<p>10.2.静默安装Oracle软件<br />\n[oracle@aiserver ~]$ cd $ORACLE_HOME<br />\n./runInstaller -silent -responseFile /tmp/db_install.rsp -ignorePrereq</p>\n<h1 id=\"安装结束后需要以root用户执行以下两个脚本\">安装结束后需要以root用户执行以下两个脚本</h1>\n<p>/u01/app/oracle/oraInventory/orainstRoot.sh<br />\n/u01/app/oracle/product/23.26.1/dbhome_1/root.sh</p>\n<p>11.监听创建<br />\n静默配置监听<br />\n<code>[oracle@aiserver ~]$ netca -silent -responseFile $ORACLE_HOME/assistants/netca/netca.rsp</code></p>\n<p>12.dbca建库<br />\n12.1.编辑dbca.rsp安装文件</p>\n<pre><code>[oracle@aiserver ~]$ cd $ORACLE_HOME/assistants/dbca\n[oracle@aiserver dbca]$ cp dbca.rsp /tmp\n[oracle@aiserver ~]$ vi /tmp/dbca.rsp\n\nresponseFileVersion=/oracle/assistants/rspfmt_dbca_response_schema_v23.0.0\ngdbName=prod\nsid=prod\ndatabaseConfigType=SI\ncreateAsContainerDatabase=true\nnumberOfPDBs=2\npdbName=prod\ntemplateName=General_Purpose.dbc\noracleHomeUserPassword=oracle\ntotalMemory=1500\nsysPassword=oracle\nsystemPassword=oracle\ndatafileDestination=/u01/app/oracle/oradata\ncharacterSet=AL32UTF8\nnationalCharacterSet=UTF8\ndatabaseType=OLTP\n\n注意：templateName、createAsContainerDatabase必須指定\n</code></pre>\n<p>12.2.静默安装数据库<br />\n<code>[oracle@aiserver ~]$ dbca -silent -createDatabase -responseFile /tmp/dbca.rsp</code></p>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n\t\t<p class=\"postfoot\">\n\t\t\tposted on \n<span id=\"post-date\">2026-01-31 17:45</span>&nbsp;\n<a href=\"https://www.cnblogs.com/liuziyi1\">刘子毅</a>&nbsp;\n阅读(<span id=\"post_view_count\">5</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n\n\t\t</p>"
    },
    {
      "title": "架构师必备：灰度方案汇总",
      "link": "https://www.cnblogs.com/toplist/p/19527704",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/toplist/p/19527704\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 17:35\">\n    <span>架构师必备：灰度方案汇总</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>大家好，我是Java烘焙师。本文结合笔者的经验和思考，对灰度方案做个总结，重点介绍AB实验。</p>\n<p>灰度在开发流程中非常普遍。先做小流量验证，确认无误后再推全，灰度过程中一旦发现系统异常、或业务指标异常，应立刻回滚。</p>\n<h1 id=\"灰度场景\">灰度场景</h1>\n<ul>\n<li>代码灰度：是最典型的灰度，灰度内做新逻辑，灰度外做旧逻辑\n<ul>\n<li>既可以提供v2版本新接口给调用方服务，由调用方来做灰度切换</li>\n<li>也可以内部切灰度，做到调用方无感</li>\n</ul>\n</li>\n<li>发版灰度：上线过程中，新版本服务实例不断增加，需考虑兼容新旧协议</li>\n<li>配置灰度：修改配置时，按服务实例灰度推送配置变更</li>\n</ul>\n<h1 id=\"灰度模式\">灰度模式</h1>\n<ul>\n<li>数字id尾号灰度：取id最后2位（百分比）、最后3位（千分比）、最后4位（万分比）等\n<ul>\n<li>实现方式：id取模，例如 <code>id % 100 &lt; 灰度百分比</code>，则命中灰度</li>\n<li>特点：简单，适用于绝大部分技术优化场景</li>\n</ul>\n</li>\n<li>随机灰度：取一部分随机流量做灰度\n<ul>\n<li>实现方式：<code>ThreadLocalRandom.current().nextInt(100) &lt; 灰度百分比</code></li>\n<li>之所以使用ThreadLocalRandom、而不是Random，是为了避免多线程竞争用于生成随机数的seed</li>\n</ul>\n</li>\n<li>A/B实验\n<ul>\n<li>实现方式：分层实验、实验数据收集、离线统计</li>\n<li>特点：适用于小流量验证新业务功能的效果，整体方案相对复杂，需要技术基建</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"id选取\">id选取</h1>\n<ul>\n<li>业务id：如用户id、商品id等</li>\n<li>设备id：未注册/未登录用户，此时没有用户id，只能取设备的唯一标识</li>\n</ul>\n<p>下面重点介绍一下A/B实验。</p>\n<h1 id=\"ab实验\">A/B实验</h1>\n<h2 id=\"目的\">目的</h2>\n<ul>\n<li>小流量验证新业务功能，正向显著则推至全量，否则继续迭代优化、或下线，避免功能过于臃肿</li>\n<li>用数据作为依据，避免想当然、拍脑袋决策</li>\n</ul>\n<h2 id=\"分层实验\">分层实验</h2>\n<p>主要目的是为了同时做多个实验，而不是给每个实验均分一部分流量。因为当同时进行的实验变多时，组合数量成倍增加，每个实验分到的流量就很少了。<br />\n有这几层结构：实验层、实验、分组</p>\n<ul>\n<li>实验层之间正交，可同时进行多个实验层的实验</li>\n<li>同一实验层的实验之间互斥，比如命中了实验1-1，就不会命中实验1-2。实验持有0到多个分桶，根据业务id可计算出桶号，进而知道命中哪个实验</li>\n<li>同一实验内有多个分组，包括1个对照组，和1到多个实验组，只会命中其中一个分组。分组持有0到多个分桶，根据业务id可计算出桶号，进而知道命中哪个分组</li>\n</ul>\n<p>实验层、实验举例：</p>\n<ul>\n<li>展示实验层：根据页面进行划分，如首页、搜索页、推荐页、详情页等。每个页面作为一个实验层，每个实验层里可同时做多个展示实验</li>\n<li>算法实验层：根据场景进行划分，如相似推荐、搭配购推荐、个性化推荐、搜索排序、广告排序等。每个场景作为一个实验层，每个实验层里可同时做多个算法实验</li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1247698/202601/1247698-20260127012326894-198795136.png\" /></p>\n<h2 id=\"哈希算法打散\">哈希算法打散</h2>\n<p>要同时支持多个分层实验，核心在于通过哈希算法将每一层的流量打散，用于实现“均匀分流”和“层间正交”，使得流量在各个实验的效果正负抵消，才能得到真实的对比结果。<br />\n以下是计算实验层桶号的代码示例，实验桶号同理：</p>\n<pre><code class=\"language-java\">import com.google.common.hash.Hashing;\nimport java.nio.charset.StandardCharsets;\n\npublic class ABTestRouter {\n\n    /**\n     * 根据用户ID和实验层ID（实验层ID充当盐的角色），计算桶号 (0-99)\n     */\n    public static int getBucket(String userId, String layerId) {\n        // 1. 拼接 Key: \"layerId:userId\"\n        String key = layerId + \":\" + userId;\n\n        // 2. 使用 MurmurHash3 (32-bit)\n        // Guava 的 murmur3_32_fixed 是线程安全的\n        int hash = Hashing.murmur3_32_fixed()\n                .hashString(key, StandardCharsets.UTF_8)\n                .asInt();\n\n        // 3. 取模并确保结果为正数\n        // Math.abs(Integer.MIN_VALUE) 会返回负数，所以推荐使用位运算去除符号位\n        return (hash &amp; Integer.MAX_VALUE) % 100;\n    }\n\n    public static void main(String[] args) {\n        String uid = \"user_123456\";\n        \n        // 不同层的流量是正交的（打散重新分配）\n        System.out.println(\"展示层桶号: \" + getBucket(uid, \"layer_ui\"));\n        System.out.println(\"算法层桶号: \" + getBucket(uid, \"layer_algo\"));\n    }\n}\n</code></pre>\n<p>之所以用murmurhash，而非md5，是因为md5是加密算法，计算开销更大，在AB实验中仅需均匀打散即可，无需担心根据哈希结果反推原文。<br />\n之所以把实验层id作为盐，是因为微小的输入差异都会导致哈希结果相差巨大，实现打散的效果。</p>\n<h2 id=\"实验数据收集\">实验数据收集</h2>\n<p>实验数据收集流程如下：</p>\n<ul>\n<li>在AB实验管理系统中配置实验信息：如实验盐值、桶号与实验组的映射关系等，可动态修改</li>\n<li>代码逻辑开发：\n<ul>\n<li>引入实验sdk，sdk在启动、或配置变更时拉取实验信息，本地计算业务id的桶号，进而得到命中的分组</li>\n<li>对照组做当前逻辑，实验组1做逻辑1，实验组2做逻辑2</li>\n</ul>\n</li>\n<li>在正式开始AB实验之前，先做AA分桶实验，模拟实验组、对照组的结果，判断是否均匀，避免分桶不均匀带来错误的实验结果</li>\n<li>实验开始，后端埋点：sdk发出后端埋点消息\n<ul>\n<li>消息格式举例：<code>业务id, 实验层id, 实验id, 分组id, 桶号, 触发时间</code></li>\n</ul>\n</li>\n<li>实验过程：实验持续时间至少一周，覆盖工作日、周末/假期，避免受时间周期带来的波动影响</li>\n<li>离线统计实验效果：\n<ul>\n<li>后端埋点数据导入曝光事件hive表</li>\n<li>业务DB数据导入行为事件hive表，如注册、登录、浏览、点击、收藏、加购、下单、支付等，取决于实验关注的业务指标</li>\n<li>把曝光事件、行为事件join起来，对比实验组、对照组的业务指标差异</li>\n</ul>\n</li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1247698/202601/1247698-20260131014010302-1779078827.png\" /></p>\n<p>以下是sql示例，代表从实验曝光后24小时内各个分组的转化率对比。</p>\n<pre><code class=\"language-sql\">SELECT \n    e.group_id,\n    COUNT(DISTINCT e.user_id) as exposed_users,\n    COUNT(DISTINCT a.user_id) as converted_users,\n    COUNT(DISTINCT a.user_id) / COUNT(DISTINCT e.user_id) as conversion_rate\nFROM exposure_events e\nLEFT JOIN action_events a ON e.user_id = a.user_id \n    AND a.event_time BETWEEN e.event_time AND (e.event_time + INTERVAL 24 HOUR)\nWHERE e.experiment_id = 'ui_test_001'\nGROUP BY e.group_id;\n</code></pre>\n<h2 id=\"实验报表分析\">实验报表分析</h2>\n<p>评估实验结果是否正向、是否显著。了解统计学里的核心概念，能看懂实验报表即可。</p>\n<h3 id=\"p值\">p值</h3>\n<p>用来衡量实验结果是否显著，p值的含义是：假设实验组与对照组没有区别，此时观察到实验有差异的概率。一般要求 <code>p &lt; 0.05</code>，也就是说实验结果显著的概率大于95%（<code>1 - 0.05 = 95%</code>）</p>\n<h3 id=\"置信区间\">置信区间</h3>\n<p>在显著的前提下，用来衡量实验结果是否正向，代表业务指标的可能范围分布。<br />\n比如：实验结果里业务指标提升了1%，95%置信区间在[0.8%, 1.2%]，则代表有95%的把握可以把业务指标提升至少0.8%、至多1.2%，效果正向。如果置信区间的下界是负数，就有可能是负向效果了，需要警惕。</p>\n<p>以上就是灰度方案的总结了，欢迎讨论交流。</p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 17:35</span>&nbsp;\n<a href=\"https://www.cnblogs.com/toplist\">Java烘焙师</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    }
  ]
}