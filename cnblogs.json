{
  "title": "ä¸»é¡µ - åšå®¢å›­",
  "link": "https://www.cnblogs.com/",
  "description": "ä¸»é¡µ - åšå®¢å›­ RSS",
  "entries": [
    {
      "title": "ç¡¬æ ¸å®ç”¨ï¼Windowsä¸‹ä½¿ç”¨ PowerShell ç¼–å†™å±€åŸŸç½‘è®¾å¤‡æ‰«æå™¨",
      "link": "https://www.cnblogs.com/zjw-blog/p/19474721",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/zjw-blog/p/19474721\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-13 03:29\">\n    <span>ç¡¬æ ¸å®ç”¨ï¼Windowsä¸‹ä½¿ç”¨ PowerShell ç¼–å†™å±€åŸŸç½‘è®¾å¤‡æ‰«æå™¨</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h3 id=\"å‰è¨€\">å‰è¨€</h3>\n<p>åœ¨è¿›è¡Œç½‘ç»œè°ƒè¯•æˆ–è®¾å¤‡ç®¡ç†æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦çŸ¥é“å±€åŸŸç½‘å†…æœ‰å“ªäº›è®¾å¤‡åœ¨çº¿ã€‚ä¼ ç»Ÿçš„ <code>ping</code> å‘½ä»¤é€ä¸ªæ‰«æå¤ªæ…¢ï¼Œè€Œä¸“ä¸šçš„æ‰«æå·¥å…·åˆæ˜¾å¾—å¤§æå°ç”¨ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€æ®µ PowerShell è„šæœ¬ï¼Œåˆ©ç”¨ç½‘ç»œåè®®çš„åº•å±‚ç‰¹æ€§ï¼Œæ‰“é€ ä¸€ä¸ªå±€åŸŸç½‘æ‰«æå·¥å…·ã€‚</p>\n<hr />\n<h3 id=\"åŸç†å‰–æä¸ºä»€ä¹ˆè¿™ä¸ªè„šæœ¬æ¯”æ™®é€š-ping-æ›´å¿«æ›´å‡†\">åŸç†å‰–æï¼šä¸ºä»€ä¹ˆè¿™ä¸ªè„šæœ¬æ¯”æ™®é€š Ping æ›´å¿«ã€æ›´å‡†ï¼Ÿ</h3>\n<p>å¤§å¤šæ•°äººè®¤ä¸ºæ‰«æå±€åŸŸç½‘å°±æ˜¯ç®€å•åœ°ç»™æ¯ä¸ª IP å‘é€ Ping åŒ…ã€‚ä½†è¿™ç§æ–¹å¼æœ‰ä¸¤å¤§å¼Šç«¯ï¼š</p>\n<ol>\n<li><strong>æ•ˆç‡ä½</strong>ï¼šç­‰å¾…ä¸åœ¨çº¿çš„è®¾å¤‡è¶…æ—¶ä¼šè€—è´¹å¤§é‡æ—¶é—´ã€‚</li>\n<li><strong>ä¸å‡†ç¡®</strong>ï¼šè®¸å¤šè®¾å¤‡ï¼ˆå¦‚å¼€å¯é˜²ç«å¢™çš„ Windows ç”µè„‘ï¼‰ä¼šç¦æ‰ ICMP å›æ˜¾ï¼Œå¯¼è‡´æ˜æ˜åœ¨çº¿å´æ˜¾ç¤ºâ€œç¦»çº¿â€ã€‚</li>\n</ol>\n<p>æœ¬è„šæœ¬é‡‡ç”¨äº† <strong>â€œå¼‚æ­¥æ¢æµ‹ + ARP è¡¨è§£æâ€</strong> çš„åŒé‡æœºåˆ¶ï¼Œå…¶å·¥ä½œåŸç†æµç¨‹å›¾å¦‚ä¸‹ï¼š</p>\n<h4 id=\"1-å¼‚æ­¥æ¢æµ‹asynchronous-probing\">1. å¼‚æ­¥æ¢æµ‹ï¼ˆAsynchronous Probingï¼‰</h4>\n<p>è„šæœ¬å¹¶æ²¡æœ‰ç­‰å¾…æ¯ä¸€ä¸ª Ping çš„ç»“æœã€‚å®ƒä½¿ç”¨ <code>SendPingAsync</code> å‘ç½‘æ®µå†…çš„æ‰€æœ‰ 254 ä¸ª IP åœ°å€å¿«é€ŸæŠ›å‡ºæ¢æµ‹åŒ…ã€‚</p>\n<ul>\n<li><strong>ç›®çš„</strong>ï¼šæˆ‘ä»¬å¹¶ä¸åœ¨ä¹è¿™äº›åŒ…æ˜¯å¦çœŸçš„æ”¶åˆ°äº†å›å¤ï¼Œå…¶çœŸæ­£çš„ç›®çš„æ˜¯<strong>è§¦å‘æ“ä½œç³»ç»Ÿçš„ ARP å¹¿æ’­</strong>ã€‚</li>\n</ul>\n<h4 id=\"2-arp-åè®®çš„å¦™ç”¨\">2. ARP åè®®çš„å¦™ç”¨</h4>\n<p>å½“ä½ çš„ç”µè„‘å°è¯•å‘å±€åŸŸç½‘å†…æŸä¸ª IP å‘é€æ•°æ®æ—¶ï¼Œå®ƒé¦–å…ˆéœ€è¦çŸ¥é“å¯¹æ–¹çš„ MAC åœ°å€ï¼ˆç‰©ç†åœ°å€ï¼‰ã€‚å³ä¾¿å¯¹æ–¹é˜²ç«å¢™æ‹¦æˆªäº† Ping åŒ…ï¼Œåªè¦è¯¥è®¾å¤‡å­˜åœ¨ï¼Œå®ƒé€šå¸¸ä¹Ÿä¼šå¯¹ ARP è¯·æ±‚åšå‡ºå“åº”ã€‚</p>\n<ul>\n<li><strong>ARP è¡¨</strong>ï¼šä¸€æ—¦è®¾å¤‡å“åº”ï¼Œå®ƒçš„ IP å’Œ MAC åœ°å€å°±ä¼šè¢«è®°å½•åœ¨æ“ä½œç³»ç»Ÿçš„ ARP ç¼“å­˜è¡¨ä¸­ã€‚</li>\n</ul>\n<h4 id=\"3-çŠ¶æ€åˆ¤å®šç®—æ³•\">3. çŠ¶æ€åˆ¤å®šç®—æ³•</h4>\n<p>è„šæœ¬é€šè¿‡ <code>Get-NetNeighbor</code> æ£€æŸ¥ç³»ç»Ÿçš„ ARP è®°å½•ï¼Œå°†çŠ¶æ€åˆ†ä¸ºä¸‰ç±»åˆ¤å®šï¼š</p>\n<ul>\n<li><strong>Ping åœ¨çº¿</strong>ï¼šè®¾å¤‡å“åº”äº† ICMPã€‚</li>\n<li><strong>ARP åœ¨çº¿</strong>ï¼šè®¾å¤‡è™½ä¸å“åº” Pingï¼Œä½†åœ¨ ARP è¡¨ä¸­çŠ¶æ€ä¸º <code>Reachable</code> æˆ– <code>Stale</code>ã€‚</li>\n<li><strong>ç¦»çº¿</strong>ï¼šARP è¡¨æ— è®°å½•æˆ–æ˜¾ç¤ºç¼“å­˜å¤±æ•ˆã€‚</li>\n</ul>\n<hr />\n<h3 id=\"å®Œæ•´ä»£ç \">å®Œæ•´ä»£ç </h3>\n<details>\nç‚¹å‡»æŸ¥çœ‹ PowerShell è„šæœ¬ä»£ç \n<pre><code class=\"language-bash\">Write-Host \"==========================================\" -ForegroundColor Green\nWrite-Host \"         å±€åŸŸç½‘è®¾å¤‡æ‰«æå™¨         \" -ForegroundColor Green\nWrite-Host \"==========================================\" -ForegroundColor Green\n\n# -----------------------------\n# åœ¨çº¿æ£€æµ‹å‡½æ•°ï¼ˆæ ¸å¿ƒï¼‰\n# -----------------------------\nfunction Test-DeviceOnline {\n    param([string]$IP)\n    $arp = Get-NetNeighbor -IPAddress $IP -ErrorAction SilentlyContinue\n    if (-not $arp) {\n        return @{ Online = $false; Reason = \"æ— ARP\" }\n    }\n    if ($arp.State -in 'Reachable','Stale','Delay','Probe') {\n        if (Test-Connection $IP -Count 1 -Quiet -ErrorAction SilentlyContinue) {\n            return @{ Online = $true; Reason = \"Ping\" }\n        }\n        return @{ Online = $true; Reason = \"ARPåœ¨çº¿\" }\n    }\n    return @{ Online = $false; Reason = \"ç¼“å­˜å¤±æ•ˆ\" }\n}\n\n# -----------------------------\n# 1. è·å– IPv4 ç½‘å¡\n# -----------------------------\n$adapters = Get-NetIPAddress -AddressFamily IPv4 |\nWhere-Object {\n    $_.IPAddress -notmatch '^127\\.|^169\\.254\\.' -and\n    $_.PrefixLength -eq 24\n}\n\nif (-not $adapters) {\n    Write-Host \"æœªå‘ç°å¯ç”¨ IPv4 ç½‘å¡\" -ForegroundColor Red\n    Read-Host\n    exit\n}\n\n# -----------------------------\n# 2. ç”Ÿæˆç½‘æ®µ\n# -----------------------------\n$networks = $adapters.IPAddress |\nForEach-Object {\n    if ($_ -match '^(\\d+\\.\\d+\\.\\d+)\\.\\d+$') {\n        \"$($Matches[1]).0/24\"\n    }\n} | Select-Object -Unique\n\n# -----------------------------\n# 3. é€‰æ‹©ç½‘æ®µ\n# -----------------------------\nif ($networks.Count -eq 1) {\n    $network = $networks[0]\n    Write-Host \"`nä»…æ£€æµ‹åˆ°ä¸€ä¸ªç½‘æ®µï¼Œè‡ªåŠ¨ä½¿ç”¨ï¼š$network\" -ForegroundColor Yellow\n}\nelse {\n    do {\n        Write-Host \"`næ£€æµ‹åˆ°å¤šä¸ªç½‘æ®µï¼Œè¯·é€‰æ‹©è¦æ‰«æçš„ç½‘æ®µï¼š\" -ForegroundColor Cyan\n        for ($i = 0; $i -lt $networks.Count; $i++) {\n            Write-Host \"[$($i + 1)] $($networks[$i])\"\n        }\n\n        $choice = Read-Host \"è¯·è¾“å…¥ç¼–å· (1-$($networks.Count))\"\n        $valid  = [int]::TryParse($choice, [ref]$null) -and\n                  $choice -ge 1 -and\n                  $choice -le $networks.Count\n\n        if (-not $valid) {\n            Write-Host \"è¾“å…¥æ— æ•ˆï¼Œè¯·é‡æ–°é€‰æ‹©ã€‚\" -ForegroundColor Red\n        }\n    } until ($valid)\n\n    $network = $networks[$choice - 1]\n}\n\n$prefix = $network -replace '\\.0/24',''\n\n# -----------------------------\n# 4. å¿«é€Ÿå»ºç«‹ ARP è¡¨\n# -----------------------------\nWrite-Host \"`n[1/2] æ­£åœ¨å‘ç½‘æ®µ $network å‘é€æ¢æµ‹åŒ… (Ping)...\" -ForegroundColor Cyan\nforeach ($i in 1..254) {\n    $p = New-Object System.Net.NetworkInformation.Ping\n    [void]$p.SendPingAsync(\"$prefix.$i\", 800)\n}\nStart-Sleep -Seconds 1\n\n# -----------------------------\n# 5. è·å–æœ¬æœº IP â†’ MAC\n# -----------------------------\n$localMapping = @{}\nGet-NetIPAddress -AddressFamily IPv4 |\nWhere-Object { $_.IPAddress -notmatch '^127\\.|^169\\.254\\.' } |\nForEach-Object {\n    $adapter = Get-NetAdapter -InterfaceIndex $_.InterfaceIndex -ErrorAction SilentlyContinue\n    if ($adapter) {\n        $localMapping[$_.IPAddress] = $adapter.MacAddress.Replace(\"-\", \":\").ToUpper()\n    }\n}\n\n# -----------------------------\n# 6. è§£æ ARP è¡¨\n# -----------------------------\n$arpRegex = '(?&lt;IP&gt;\\d{1,3}(\\.\\d{1,3}){3})\\s+(?&lt;MAC&gt;([0-9a-f]{2}[:-]){5}[0-9a-f]{2})'\n$globalArp = arp -a\n\n$potentialIPs = @()\nforeach ($line in $globalArp) {\n    if ($line -match $arpRegex) {\n        $ip  = $Matches.IP\n        $mac = $Matches.MAC.ToUpper().Replace(\"-\", \":\")\n\n        if ($ip.StartsWith(\"$prefix.\") -and\n            -not $localMapping.ContainsKey($ip) -and\n            $ip -notmatch '\\.255$') {\n\n            $potentialIPs += [PSCustomObject]@{\n                IP  = $ip\n                MAC = $mac\n            }\n        }\n    }\n}\n\n# -----------------------------\n# 7. æ„å»ºç»“æœ\n# -----------------------------\n$finalList = @()\n\n# æœ¬æœº\nforeach ($ip in $localMapping.Keys) {\n    if ($ip.StartsWith(\"$prefix.\")) {\n        $finalList += [PSCustomObject]@{\n            IP       = \"$ip*\"\n            MAC      = $localMapping[$ip]\n            IsOnline = $true\n            Reason   = \"æœ¬æœº\"\n            RawIP    = $ip\n        }\n    }\n}\n\nWrite-Host \"[2/2] æ­£åœ¨åˆ¤æ–­è®¾å¤‡åœ¨çº¿çŠ¶æ€...\" -ForegroundColor Cyan\n\nforeach ($dev in $potentialIPs | Select-Object -Unique IP, MAC) {\n    $result = Test-DeviceOnline $dev.IP\n    $finalList += [PSCustomObject]@{\n        IP       = $dev.IP\n        MAC      = $dev.MAC\n        IsOnline = $result.Online\n        Reason   = $result.Reason\n        RawIP    = $dev.IP\n    }\n}\n\n# -----------------------------\n# 8. è¾“å‡º\n# -----------------------------\nWrite-Host \"`n============== æ‰«æç»“æœ ==============\" -ForegroundColor Cyan\n\n$sorted = $finalList | Sort-Object {[version]$_.RawIP}\n\nforeach ($item in $sorted) {\n    $status = if ($item.IsOnline) {\n\t\tswitch ($item.Reason) {\n\t\t\t\"Ping\"     { \"åœ¨çº¿\" }\n\t\t\t\"ARPåœ¨çº¿\"  { \"åœ¨çº¿ï¼ˆæœªå“åº” Pingï¼‰\" }\n\t\t\t\"æœ¬æœº\"     { \"æœ¬æœº\" }\n\t\t\tdefault    { \"åœ¨çº¿\" }\n\t\t}\n\t} else {\n\t\tswitch ($item.Reason) {\n\t\t\t\"ç¼“å­˜å¤±æ•ˆ\" { \"ç¦»çº¿ï¼ˆç¼“å­˜å¤±æ•ˆï¼‰\" }\n\t\t\tdefault    { \"ç¦»çº¿\" }\n\t\t}\n\t}\n\n\n    $line = \"{0,-20} {1,-22} {2}\" -f $item.IP, $item.MAC, $status\n\n    if ($item.IsOnline) {\n        Write-Host $line -ForegroundColor Green\n    } else {\n        Write-Host $line -ForegroundColor DarkGray\n    }\n}\n\n$online = ($finalList | Where-Object { $_.IsOnline }).Count\n$total  = $finalList.Count\n\nWrite-Host \"`næ‰«æå®Œæˆï¼š$online / $total å°è®¾å¤‡åœ¨çº¿\" -ForegroundColor Green\nWrite-Host \"`næŒ‰ä»»æ„é”®é€€å‡º...\"\n$null = [System.Console]::ReadKey()\n</code></pre>\n</details>\n<h3 id=\"æ ¸å¿ƒä»£ç äº®ç‚¹è¯´æ˜\">æ ¸å¿ƒä»£ç äº®ç‚¹è¯´æ˜</h3>\n<h4 id=\"ç½‘æ®µè‡ªåŠ¨è¯†åˆ«\">ç½‘æ®µè‡ªåŠ¨è¯†åˆ«</h4>\n<p>è„šæœ¬ä¼šè‡ªåŠ¨æ’é™¤ <code>127.0.0.1</code>ï¼ˆå›ç¯åœ°å€ï¼‰å’Œ <code>169.254.x.x</code>ï¼ˆè‡ªåŠ¨ç§æœ‰ IPï¼‰ï¼Œå¹¶æ™ºèƒ½è¯†åˆ«å½“å‰æ´»è·ƒçš„ç½‘æ®µï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥ IP èŒƒå›´ã€‚</p>\n<h4 id=\"ç»“æœç¾åŒ–è¾“å‡º\">ç»“æœç¾åŒ–è¾“å‡º</h4>\n<p>ä¸ºäº†æå‡ä½¿ç”¨ä½“éªŒï¼Œè„šæœ¬ä½¿ç”¨äº†æ ¼å¼åŒ–æ“ä½œç¬¦ <code>-f</code>ï¼š</p>\n<pre><code class=\"language-bash\">$line = \"{0,-20} {1,-22} {2}\" -f $item.IP, $item.MAC, $status\n</code></pre>\n<p>å®ƒå¯ä»¥ç¡®ä¿è¾“å‡ºçš„ IPã€MAC åœ°å€å’ŒçŠ¶æ€åœ¨æ§åˆ¶å°ä¸­å®Œç¾å¯¹é½ï¼Œå¹¶ä½¿ç”¨ç»¿è‰²ï¼ˆåœ¨çº¿ï¼‰å’Œç°è‰²ï¼ˆç¦»çº¿ï¼‰è¿›è¡Œè§†è§‰åŒºåˆ†ã€‚</p>\n<hr />\n<h3 id=\"å¦‚ä½•ä½¿ç”¨\">å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h3>\n<ol>\n<li>å°†è„šæœ¬ä»£ç ç²˜è´´è¿›ç¼–è¾‘å™¨ï¼ˆæˆ–ä¿å­˜ä¸º <code>.ps1</code> æ–‡ä»¶ï¼‰,ç¼–ç <code>UTF8 BOM</code>ã€‚ä¹Ÿå¯é€šè¿‡<a href=\"https://files.cnblogs.com/files/zjw-blog/LANScanner%E5%B1%80%E5%9F%9F%E7%BD%91%E6%89%AB%E6%8F%8F%E5%99%A8.zip\" target=\"_blank\">LANScannerå±€åŸŸç½‘æ‰«æå™¨.zip</a>é“¾æ¥è¿›è¡Œä¸‹è½½</li>\n<li>ä½¿ç”¨powershell.exeè¿è¡Œï¼Œå»ºè®®ä½¿ç”¨powershell<a href=\"https://www.cnblogs.com/zjw-blog/p/19449891\" target=\"_blank\">æ–‡ä»¶å…³è”</a>åç›´æ¥è¿è¡Œã€‚</li>\n</ol>\n<h3 id=\"è¿è¡Œæˆªå›¾\">è¿è¡Œæˆªå›¾</h3>\n<p><img alt=\"å›¾ç‰‡\" src=\"https://img2024.cnblogs.com/blog/1745057/202601/1745057-20260113032751492-35872645.png\" /></p>\n<h3 id=\"æ€»ç»“\">æ€»ç»“</h3>\n<p>è¿™ä¸ªè„šæœ¬ä¸ä»…æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œæ›´æ˜¯å¯¹ <strong>Layer 2ï¼ˆæ•°æ®é“¾è·¯å±‚ï¼‰</strong> å’Œ <strong>Layer 3ï¼ˆç½‘ç»œå±‚ï¼‰</strong> ååŒå·¥ä½œçš„ä¸€æ¬¡å®è·µã€‚é€šè¿‡åˆ©ç”¨ç³»ç»Ÿåº•å±‚çš„ ARP ç¼“å­˜ï¼Œæˆ‘ä»¬å®ç°äº†æ¯”ä¼ ç»Ÿæ‰«æå™¨æ›´é«˜æ•ˆã€æ›´å…·ç©¿é€åŠ›çš„æ¢æµ‹æ•ˆæœã€‚</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-13 03:29</span>&nbsp;\n<a href=\"https://www.cnblogs.com/zjw-blog\">é›¨ä¸­éæƒ³</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">6</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "electron39-vue3aiç”µè„‘ç«¯AIæ¨¡æ¿|electron39+deepseek+vite7èŠå¤©aiåº”ç”¨",
      "link": "https://www.cnblogs.com/xiaoyan2017/p/19474565",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19474565\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-12 23:54\">\n    <span>electron39-vue3aiç”µè„‘ç«¯AIæ¨¡æ¿|electron39+deepseek+vite7èŠå¤©aiåº”ç”¨</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p><span>2026æœ€æ–°ç ”å‘<span style=\"background-color: rgba(255, 255, 0, 1);\">Electron39.2+Vue3.5+DeepSeek-R1</span>æ¡Œé¢<strong>å®¢æˆ·ç«¯AI</strong>æµå¼ä¼šè¯å°å¸®æ‰‹ã€‚</span></p>\n<p><span style=\"font-size: 12px;\"><strong>electron-vue3-deepseek</strong>ï¼šè·¨å¹³å°aiå®æˆ˜<span style=\"background-color: rgba(204, 255, 204, 1);\">electron39+vite7.2+vue3+arco</span>è°ƒç”¨<strong>deepseek-v3.2</strong>æ¥å£æ­å»ºæµå¼è¾“å‡ºaiæ¨¡æ¿ã€‚æ”¯æŒ<strong>æš—é»‘+æµ…è‰²</strong>ç•Œé¢ã€<span style=\"background-color: rgba(255, 204, 255, 1);\">æ·±åº¦æ€è€ƒã€latexå…¬å¼ã€mermaidå›¾è¡¨è§£æã€æœ¬åœ°å­˜å‚¨å¯¹è¯</span>ç­‰åŠŸèƒ½ã€‚</span></p>\n<p><img alt=\"360æˆªå›¾20260111004235577\" class=\"lazyload\" /></p>\n<p><img alt=\"p4\" class=\"lazyload\" /></p>\n<h3>ğŸš€æŠ€æœ¯æ ˆ</h3>\n<ul>\n<li><span style=\"font-size: 12px;\">å¼€å‘å·¥å…·ï¼švscode</span></li>\n<li><span style=\"font-size: 12px;\">è·¨å¹³å°æ¡†æ¶ï¼šelectron^39.2.7</span></li>\n<li><span style=\"font-size: 12px;\">æŠ€æœ¯æ¡†æ¶ï¼švite^7.2.4+vue^3.5.24+vue-router^4.6.4</span></li>\n<li><span style=\"font-size: 12px;\">AIæ¨¡å‹æ¡†æ¶ï¼šDeepSeek-V3.2 + OpenAI</span></li>\n<li><span style=\"font-size: 12px;\">UIç»„ä»¶åº“ï¼šarco-design^2.57.0</span></li>\n<li><span style=\"font-size: 12px;\">çŠ¶æ€æ’ä»¶ï¼špinia^3.0.4</span></li>\n<li><span style=\"font-size: 12px;\">ä¼šè¯ç¼“å­˜ï¼špinia-plugin-persistedstate^4.7.1</span></li>\n<li><span style=\"font-size: 12px;\">é«˜äº®æ’ä»¶ï¼šhighlight.js^11.11.1</span></li>\n<li><span style=\"font-size: 12px;\">markdownæ¸²æŸ“æ’ä»¶ï¼šmarkdown-it^14.1.0</span></li>\n<li><span style=\"font-size: 12px;\">æ‰“åŒ…å·¥å…·ï¼šelectron-builder^26.0.12</span></li>\n</ul>\n<p><img alt=\"p5\" class=\"lazyload\" /></p>\n<p><img alt=\"p5-1\" class=\"lazyload\" /></p>\n<h3>ğŸ¤–é¡¹ç›®ç‰¹æ€§</h3>\n<ol>\n<li><span style=\"font-size: 12px;\">æœ€æ–°è·¨å¹³å°Electron39æ¡†æ¶ï¼Œæ¥å…¥DeepSeek-V3.2ï¼Œæµå¼å¯¹è¯æ›´ä¸æ»‘</span></li>\n<li><span style=\"font-size: 12px;\">æ”¯æŒå„ç§ä»£ç é«˜äº®/å¤åˆ¶ä»£ç ã€ä¾¿äºåˆ†äº«ä»£ç ç‰‡æ®µ</span></li>\n<li><span style=\"font-size: 12px;\">æ”¯æŒæš—é»‘+æµ…è‰²ä¸»é¢˜ã€æ·±åº¦æ€è€ƒã€ä¸Šä¸‹æ–‡å¤šè½®å¯¹è¯ã€æœ¬åœ°å­˜å‚¨å¯¹è¯</span></li>\n<li><span style=\"font-size: 12px;\">æ”¯æŒkatexæ•°å­¦å…¬å¼</span></li>\n<li><span style=\"font-size: 12px;\">æ”¯æŒmermaidç”˜ç‰¹å›¾/æµç¨‹å›¾/ç±»å›¾ç­‰å›¾è¡¨</span></li>\n<li><span style=\"font-size: 12px;\">æ”¯æŒæ–°çª—å£æ‰“å¼€å¯¹è¯é‡Œé¢çš„é“¾æ¥</span></li>\n<li><span style=\"font-size: 12px;\">é‡‡ç”¨arco-designç»„ä»¶åº“ï¼Œä¿è¯é£æ ¼ä¸€è‡´æ€§</span></li>\n</ol>\n<p><img alt=\"p1\" class=\"lazyload\" /></p>\n<h3>ğŸ‘½é¡¹ç›®æ¡†æ¶ç›®å½•</h3>\n<p><span style=\"font-size: 12px;\">åŸºäº&nbsp;<span class=\"cnblogs_code\">electron39+vite7</span>&nbsp;åˆ›å»ºé¡¹ç›®æ¨¡æ¿ï¼Œå¯¹æ¥&nbsp;<span class=\"cnblogs_code\">deepseek-v3.2</span>&nbsp; apiå¤§æ¨¡å‹ï¼Œé‡‡ç”¨&nbsp;<span class=\"cnblogs_code\">vue3 setup</span>&nbsp;è¯­æ³•ç³–ç¼–ç å¼€å‘ã€‚</span></p>\n<p><img alt=\"360æˆªå›¾20260110235013580\" class=\"lazyload\" /></p>\n<blockquote>\n<h3><em>Electron39-Vue3AIæ¡Œé¢ç‰ˆaiå¯¹è¯å·²ç»æ›´æ–°åˆ°æˆ‘çš„åŸåˆ›ä½œå“å°é“ºï¼Œæ„Ÿè°¢æ”¯æŒï¼</em></h3>\n<p><a href=\"https://mall.bilibili.com/neul-next/detailuniversal/detail.html?page=detailuniversal_detail&amp;itemsId=12195006&amp;loadingShow=1&amp;noTitleBar=1#noReffer=true&amp;msource=merchant_share\" rel=\"noopener nofollow\" target=\"_blank\"><span style=\"font-size: 12px;\">electron39+deepseek+vite7æ¡Œé¢ç«¯AIæµå¼èŠå¤©å¯¹è¯EXE</span></a></p>\n</blockquote>\n<p><img alt=\"p2\" class=\"lazyload\" /></p>\n<h3>é¡¹ç›®é…ç½®.env</h3>\n<p><span style=\"font-size: 12px;\">å»deepseekç½‘ç«™ç”³è¯·ä¸€ä¸ªapikeyï¼Œæ›¿æ¢æ‰é¡¹ç›®æ ¹ç›®å½•.envæ–‡ä»¶é‡Œçš„keyå­—æ®µï¼Œå³å¯ä½“éªŒä¸æ»‘èˆ¬aiæµå¼å¯¹è¯ã€‚</span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 0, 1);\"># é¡¹ç›®åç§°\nVITE_APPNAME </span>= 'Electron39-DeepSeek'<span style=\"color: rgba(0, 0, 0, 1);\">\n\n# è¿è¡Œç«¯å£\nVITE_PORT </span>= 3003<span style=\"color: rgba(0, 0, 0, 1);\">\n\n# æ˜¯å¦åŠ è½½è°ƒè¯•å·¥å…·devtools\nVITE_DEVTOOLS </span>= <span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">\n\n# æ˜¯å¦æ‰“å¼€è°ƒè¯•å·¥å…·devtools\nVITE_OPEN_DEVTOOLS </span>= <span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">\n\n# æ˜¯å¦åˆ é™¤ç”Ÿäº§ç¯å¢ƒconsole\nVITE_DROP_CONSOLE </span>= <span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">\n\n# DeepSeek APIé…ç½®\nVITE_DEEPSEEK_API_KEY </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> æ›¿æ¢ä¸ºä½ çš„ API Key</span><span style=\"color: rgba(0, 0, 0, 1);\">\nVITE_DEEPSEEK_BASE_URL </span>= https:<span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">api.deepseek.com</span></pre>\n</div>\n<h3>å…¥å£é…ç½®main.js</h3>\n<div class=\"cnblogs_code\">\n<pre>import { createApp } from 'vue'<span style=\"color: rgba(0, 0, 0, 1);\">\nimport </span>'./style.scss'<span style=\"color: rgba(0, 0, 0, 1);\">\nimport App from </span>'./App.vue'<span style=\"color: rgba(0, 0, 0, 1);\">\n\nimport { launchApp } from </span>'@/windows/actions'\n\n<span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¼•å…¥è·¯ç”±/çŠ¶æ€é…ç½®</span>\nimport Router from './router'<span style=\"color: rgba(0, 0, 0, 1);\">\nimport Pinia from </span>'./pinia'\n\n<span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¼•å…¥æ’ä»¶é…ç½®</span>\nimport Plugins from './plugins'<span style=\"color: rgba(0, 0, 0, 1);\">\n\nlaunchApp().then(config </span>=&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> {\n  </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span>(config) {<span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> å…¨å±€å­˜å‚¨çª—å£é…ç½®</span>\n    window.config =<span style=\"color: rgba(0, 0, 0, 1);\"> config\n  }\n\n  </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> åˆå§‹åŒ–appå®ä¾‹</span>\n<span style=\"color: rgba(0, 0, 0, 1);\">  createApp(App)\n  .use(Router)\n  .use(Pinia)\n  .use(Plugins)\n  .mount(</span>'#app'<span style=\"color: rgba(0, 0, 0, 1);\">)\n})</span></pre>\n</div>\n<p><img alt=\"360æˆªå›¾20260110235323921\" class=\"lazyload\" /></p>\n<p><img alt=\"360æˆªå›¾20260110235614279\" class=\"lazyload\" /></p>\n<p><img alt=\"360æˆªå›¾20260111000749813\" class=\"lazyload\" /></p>\n<p><img alt=\"360æˆªå›¾20260111002639770\" class=\"lazyload\" /></p>\n<p><img alt=\"360æˆªå›¾20260111004513665\" class=\"lazyload\" /></p>\n<h3>é¡¹ç›®é€šç”¨å¸ƒå±€</h3>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n<p><span style=\"font-size: 12px;\"><strong>é¡¹ç›®æ•´ä½“ç»“æ„å¦‚ä¸‹å›¾ï¼š</strong></span></p>\n<p><img alt=\"360æˆªå›¾20260110235013585\" class=\"lazyload\" /></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">script </span><span style=\"color: rgba(255, 0, 0, 1);\">setup</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span><span style=\"background-color: rgba(245, 245, 245, 1); color: rgba(0, 0, 0, 1);\">\n  import Titlebar from </span><span style=\"background-color: rgba(245, 245, 245, 1); color: rgba(0, 0, 0, 1);\">'</span><span style=\"background-color: rgba(245, 245, 245, 1); color: rgba(0, 0, 0, 1);\">@/layouts/components/titlebar/index.vue</span><span style=\"background-color: rgba(245, 245, 245, 1); color: rgba(0, 0, 0, 1);\">'</span><span style=\"background-color: rgba(245, 245, 245, 1); color: rgba(0, 0, 0, 1);\">\n  import Sidebar from </span><span style=\"background-color: rgba(245, 245, 245, 1); color: rgba(0, 0, 0, 1);\">'</span><span style=\"background-color: rgba(245, 245, 245, 1); color: rgba(0, 0, 0, 1);\">@/layouts/components/sidebar/index.vue</span><span style=\"background-color: rgba(245, 245, 245, 1); color: rgba(0, 0, 0, 1);\">'</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">script</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n\n<span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">template</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n  <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"vu__container\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"vu__layout flexbox flex-col\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¯¼èˆªæ  </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Titlebar </span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"vu__layout-body flex1 flexbox\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> ä¾§è¾¹ </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Sidebar </span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n\n        <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¯¹è¯åŒº </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"vu__layout-main flex1\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">router-view </span><span style=\"color: rgba(255, 0, 0, 1);\">v-slot</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"{ Component, route }\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">keep-alive</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n              <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">component </span><span style=\"color: rgba(255, 0, 0, 1);\">:is</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Component\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :key</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"route.path\"</span> <span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">keep-alive</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">router-view</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n  <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">template</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span></pre>\n</div>\n<p><img alt=\"001360æˆªå›¾20260111091110026\" class=\"lazyload\" /></p>\n<p><img alt=\"001360æˆªå›¾20260111091146362\" class=\"lazyload\" /></p>\n<p><img alt=\"002360æˆªå›¾20260111091359337\" class=\"lazyload\" /></p>\n<p><img alt=\"002360æˆªå›¾20260111091853610\" class=\"lazyload\" /></p>\n<p><img alt=\"003360æˆªå›¾20260111212428019\" class=\"lazyload\" /></p>\n<p><img alt=\"004360æˆªå›¾20260111093959478\" class=\"lazyload\" /></p>\n<p><img alt=\"004360æˆªå›¾20260111094201625\" class=\"lazyload\" /></p>\n<p><img alt=\"005360æˆªå›¾20260111094511696\" class=\"lazyload\" /></p>\n<p><img alt=\"005360æˆªå›¾20260111094630870\" class=\"lazyload\" /></p>\n<p><img alt=\"009360æˆªå›¾20260111100122262\" class=\"lazyload\" /></p>\n<p><img alt=\"010360æˆªå›¾20260111110033716\" class=\"lazyload\" /></p>\n<p><img alt=\"011360æˆªå›¾20260111110757421\" class=\"lazyload\" /></p>\n<p><img alt=\"012360æˆªå›¾20260111110935003\" class=\"lazyload\" /></p>\n<p><img alt=\"013360æˆªå›¾20260111111004067\" class=\"lazyload\" /></p>\n<p><img alt=\"015360æˆªå›¾20260111111143283\" class=\"lazyload\" /></p>\n<p><img alt=\"360æˆªå›¾20260111004513663\" class=\"lazyload\" /></p>\n<h3>electron39+vue3å¯¹æ¥deepseekæ·±åº¦æ€è€ƒ</h3>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n<div class=\"cnblogs_code\">\n<pre>const completion =<span style=\"color: rgba(0, 0, 0, 1);\"> await openai.chat.completions.create({\n  </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> å•ä¸€ä¼šè¯</span>\n  <span style=\"color: rgba(0, 128, 0, 1);\">/*</span><span style=\"color: rgba(0, 128, 0, 1);\"> messages: [\n    {role: 'user', content: editorValue}\n  ], </span><span style=\"color: rgba(0, 128, 0, 1);\">*/</span>\n  <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¤šè½®ä¼šè¯</span>\n  messages: props.multiConversation ? historySession.value : [{role: 'user'<span style=\"color: rgba(0, 0, 0, 1);\">, content: editorValue}],\n  </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> deepseek-chatå¯¹è¯æ¨¡å‹ deepseek-reasoneræ¨ç†æ¨¡å‹</span>\n  model: sessionstate.thinkingEnabled ? 'deepseek-reasoner' : 'deepseek-chat'<span style=\"color: rgba(0, 0, 0, 1);\">,\n  stream: </span><span style=\"color: rgba(0, 0, 255, 1);\">true</span>, <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> æµå¼è¾“å‡º</span>\n  max_tokens: 8192, <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ä¸€æ¬¡è¯·æ±‚ä¸­æ¨¡å‹ç”Ÿæˆ completion çš„æœ€å¤§ token æ•°(é»˜è®¤ä½¿ç”¨ 4096)</span>\n  temperature: 0.4, <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ä¸¥è°¨é‡‡æ ·</span>\n})</pre>\n</div>\n<p><strong>é›†æˆkatexå…¬å¼åŠmermaidå›¾è¡¨</strong></p>\n<div class=\"cnblogs_code\">\n<pre>import { katex } from \"@mdit/plugin-katex\"; <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ”¯æŒæ•°å­¦å…¬å¼</span>\nimport 'katex/dist/katex.min.css'\n<span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ¸²æŸ“mermaidå›¾è¡¨</span>\nimport { markdownItMermaidPlugin } from '@/components/markdown/plugins/mermaidPlugin'</pre>\n</div>\n<p><strong>æ¸²æŸ“è§£æmarkdownæµæ•°æ®</strong></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Markdown\n  </span><span style=\"color: rgba(255, 0, 0, 1);\">:source</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"item.content\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n  :html</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"true\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n  :linkify</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"true\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n  :typographer</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"true\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n  :plugins</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"[\n    [katex, {delimiters: 'all'}],\n    [markdownItMermaidPlugin, { ... }]\n  ]\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n  @copy</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"onCopy\"</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span></pre>\n</div>\n<p><img alt=\"010360æˆªå›¾20260111110212061\" class=\"lazyload\" /></p>\n<p><img alt=\"011360æˆªå›¾20260111110721388\" class=\"lazyload\" /></p>\n<h3>AIç¼–è¾‘å¯¹è¯æ¡†</h3>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">template</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n  <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"v3ai__inputbox flexbox flex-col\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n    <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç¼–è¾‘å™¨ </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"v3ai__editor flexbox\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-textarea </span><span style=\"color: rgba(255, 0, 0, 1);\">v-model</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"editorText\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :auto-size</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"autoSize\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :spellcheck</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"false\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> placeholder</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"ç»™ DeepSeek å‘é€æ¶ˆæ¯\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> @input</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"handleInput\"</span> <span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n    <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ“ä½œæ  </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"v3ai__tools flexbox flex-alignc\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"option flex1 flexbox\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-tooltip </span><span style=\"color: rgba(255, 0, 0, 1);\">content</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"å…ˆæ€è€ƒåå›ç­”ï¼Œè§£å†³æ¨ç†é—®é¢˜\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> position</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"top\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> mini</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"btn\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"{'active': sessionstate.thinkingEnabled}\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> @click</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"sessionstate.thinkingEnabled =! sessionstate.thinkingEnabled\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">i </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"iconfont ai-deepthink\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">i</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">span</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>æ·±åº¦æ€è€ƒ<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">span</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-tooltip</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"btn\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"{'active': sessionstate.searchEnabled}\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> @click</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"sessionstate.searchEnabled =! sessionstate.searchEnabled\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">i </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"iconfont ai-network\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">i</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">span</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>è”ç½‘<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">span</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> æŠ€èƒ½æ  </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-dropdown </span><span style=\"color: rgba(255, 0, 0, 1);\">v-if</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"skillbar\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> position</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"tl\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :content-style</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"{'min-width': '120px'}\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> @select</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"handleSkill\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"btn\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-command </span><span style=\"color: rgba(255, 0, 0, 1);\">size</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"16\"</span> <span style=\"color: rgba(0, 0, 255, 1);\">/&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">span</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>æŠ€èƒ½<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">span</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">template </span><span style=\"color: rgba(255, 0, 0, 1);\">#content</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption </span><span style=\"color: rgba(255, 0, 0, 1);\">v-for</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"(item, index) in skills\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :key</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"index\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :value</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"item\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">template </span><span style=\"color: rgba(255, 0, 0, 1);\">#icon</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">i </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"iconfont\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"item.icon\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">i</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">template</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>{{item.text}}<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">template</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-dropdown</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-dropdown </span><span style=\"color: rgba(255, 0, 0, 1);\">trigger</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"hover\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :show-arrow</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"false\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> position</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"lb\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :content-style</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"{'min-width': '200px'}\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-button </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"icon-btn\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> shape</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"circle\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-attachment </span><span style=\"color: rgba(255, 0, 0, 1);\">size</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"18\"</span> <span style=\"color: rgba(0, 0, 255, 1);\">/&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-button</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">template </span><span style=\"color: rgba(255, 0, 0, 1);\">#content</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-dgroup</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">template </span><span style=\"color: rgba(255, 0, 0, 1);\">#title</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">style</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"margin-bottom: 5px;\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>ä»ç½‘ç›˜æ·»åŠ <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">template</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption </span><span style=\"color: rgba(255, 0, 0, 1);\">value</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"wx\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-more </span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span> é€‰æ‹©ç½‘ç›˜æ–‡ä»¶<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-dgroup</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-dgroup</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">template </span><span style=\"color: rgba(255, 0, 0, 1);\">#title</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">style</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"margin-bottom: 5px;\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>ä»æœ¬åœ°æ·»åŠ <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">template</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption </span><span style=\"color: rgba(255, 0, 0, 1);\">value</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"wx\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-apps </span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span> ä¸Šä¼ æ–‡ä»¶<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-dsubmenu </span><span style=\"color: rgba(255, 0, 0, 1);\">trigger</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"hover\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> position</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"rb\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :popup-translate</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"[5, 5]\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> value</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"option-1\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :content-style</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"{'min-width': '120px'}\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n              <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">template </span><span style=\"color: rgba(255, 0, 0, 1);\">#default</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-apps </span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span> ä¸Šä¼ ä»£ç <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">template</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n              <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">template </span><span style=\"color: rgba(255, 0, 0, 1);\">#content</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n                <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption </span><span style=\"color: rgba(255, 0, 0, 1);\">value</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"pyq\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-apps </span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span> ä»£ç æ–‡ä»¶<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n                <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption </span><span style=\"color: rgba(255, 0, 0, 1);\">value</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"qq\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-apps </span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span> ä»£ç æ–‡ä»¶å¤¹<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n                <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption </span><span style=\"color: rgba(255, 0, 0, 1);\">value</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"qq\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-apps </span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span> GitHubä»“åº“<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n              <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">template</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-dsubmenu</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-dgroup</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">template</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-dropdown</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-tooltip </span><span style=\"color: rgba(255, 0, 0, 1);\">content</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"æˆªå›¾æé—®\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> position</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"top\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> mini</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-button </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"icon-btn\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> shape</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"circle\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-scissor </span><span style=\"color: rgba(255, 0, 0, 1);\">size</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"18\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> @click</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"handleCut\"</span> <span style=\"color: rgba(0, 0, 255, 1);\">/&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-button</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-tooltip</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-dropdown </span><span style=\"color: rgba(255, 0, 0, 1);\">:show-arrow</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"false\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> position</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"top\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :content-style</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"{'min-width': '160px'}\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-button </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"icon-btn\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> shape</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"circle\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-plus </span><span style=\"color: rgba(255, 0, 0, 1);\">size</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"18\"</span> <span style=\"color: rgba(0, 0, 255, 1);\">/&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-button</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">template </span><span style=\"color: rgba(255, 0, 0, 1);\">#content</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption </span><span style=\"color: rgba(255, 0, 0, 1);\">value</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"image\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-file-image </span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span> å›¾ç‰‡<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption </span><span style=\"color: rgba(255, 0, 0, 1);\">value</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"file\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-file </span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span> æœ¬åœ°æ–‡ä»¶<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption </span><span style=\"color: rgba(255, 0, 0, 1);\">value</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"pdf\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-file-pdf </span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span> PDFæ–‡æ¡£åˆ†æ<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption </span><span style=\"color: rgba(255, 0, 0, 1);\">value</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"page\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-cloud </span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span> ç½‘é¡µæ€»ç»“<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-doption</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">template</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-dropdown</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-divider </span><span style=\"color: rgba(255, 0, 0, 1);\">direction</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"vertical\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> style</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"margin: 0 15px 0 10px; height: 15px;\"</span> <span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-button </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"btn-submit\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> v-if</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"!sessionstate.loading\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> type</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"primary\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> shape</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"circle\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> :disabled</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"!editorText?.trim() || sessionstate.loading\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> @click</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"handleSubmit\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">icon-arrow-up </span><span style=\"color: rgba(255, 0, 0, 1);\">size</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"20\"</span> <span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-button</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">a-button </span><span style=\"color: rgba(255, 0, 0, 1);\">class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"btn-submit\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> v-else type</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"primary\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> shape</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"circle\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> @click</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"handleStopStream\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">div </span><span style=\"color: rgba(255, 0, 0, 1);\">style</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"background:#fff;border-radius:2px;height:10px;width:10px;\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">a-button</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n  <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">div</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">template</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span></pre>\n</div>\n<h3>electron39+vue3è°ƒç”¨deepseek api</h3>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> è°ƒç”¨deepseekæ¥å£</span>\nconst completion =<span style=\"color: rgba(0, 0, 0, 1);\"> await openai.chat.completions.create({\n  </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> å•ä¸€ä¼šè¯</span>\n  <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> messages: [{role: 'user', content: editorValue}],</span>\n  <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¤šè½®ä¼šè¯</span>\n  messages: props.multiConversation ? historySession.value : [{role: 'user'<span style=\"color: rgba(0, 0, 0, 1);\">, content: editorValue}],\n  </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> deepseek-chatå¯¹è¯æ¨¡å‹ deepseek-reasoneræ¨ç†æ¨¡å‹</span>\n  model: sessionstate.thinkingEnabled ? 'deepseek-reasoner' : 'deepseek-chat'<span style=\"color: rgba(0, 0, 0, 1);\">,\n  stream: </span><span style=\"color: rgba(0, 0, 255, 1);\">true</span>, <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> æµå¼è¾“å‡º</span>\n  max_tokens: 8192<span style=\"color: rgba(0, 0, 0, 1);\">,\n  temperature: </span>0.4<span style=\"color: rgba(0, 0, 0, 1);\">\n})\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¤„ç†æµå¼è¿”å›ç»“æœ</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">for</span><span style=\"color: rgba(0, 0, 0, 1);\"> await (const chunk of completion) {\n  </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ£€æŸ¥æ˜¯å¦å·²ç»ˆæ­¢</span>\n  <span style=\"color: rgba(0, 0, 255, 1);\">if</span>(sessionstate.aborted) <span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">\n\n  const content </span>= chunk.choices[0]?.delta?.content || ''\n  <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> è·å–æ¨ç†å†…å®¹</span>\n  const reasoningContent = chunk.choices[0]?.delta?.reasoning_content || ''\n  \n  <span style=\"color: rgba(0, 0, 255, 1);\">if</span>(content ||<span style=\"color: rgba(0, 0, 0, 1);\"> reasoningContent) {\n    answerText </span>+=<span style=\"color: rgba(0, 0, 0, 1);\"> content\n    reasoningText </span>+=<span style=\"color: rgba(0, 0, 0, 1);\"> reasoningContent\n\n    </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> é™åˆ¶æ›´æ–°é¢‘ç‡ï¼šæ¯100msæœ€å¤šæ›´æ–°ä¸€æ¬¡</span>\n    const now =<span style=\"color: rgba(0, 0, 0, 1);\"> Date.now()\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span>(now - lastUpdate &gt; 100<span style=\"color: rgba(0, 0, 0, 1);\">) {\n      lastUpdate </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> now\n      requestAnimationFrame(() </span>=&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> {\n        </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ...</span>\n<span style=\"color: rgba(0, 0, 0, 1);\">      })\n    }\n  }\n  </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span>(chunk.choices[0]?.finish_reason === 'stop'<span style=\"color: rgba(0, 0, 0, 1);\">) {\n    </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ...</span>\n<span style=\"color: rgba(0, 0, 0, 1);\">  }\n}</span></pre>\n</div>\n<p><img alt=\"æœªæ ‡é¢˜-4\" class=\"lazyload\" /></p>\n<p>Okï¼ŒåŸºäºelectron39+vue3æ¥å…¥deepseekæ­å»ºå®¢æˆ·ç«¯aièŠå¤©å¯¹è¯ç³»ç»Ÿå°±åˆ†äº«åˆ°è¿™é‡Œï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰ç‚¹å¸®åŠ©ï¼</p>\n<p><strong>æ¨èå‡ ä¸ªæœ€æ–°å®æˆ˜é¡¹ç›®</strong></p>\n<blockquote>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19440082\" target=\"_blank\">Vite7+DeepSeekç½‘é¡µç‰ˆAiåŠ©æ‰‹|vue3+arcoç½‘é¡µwebæµå¼ç”ŸæˆaièŠå¤©é—®ç­”ç³»ç»Ÿ</a></span></p>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/18853514\" target=\"_blank\">Uniapp-DeepSeekè·¨ä¸‰ç«¯AIåŠ©æ‰‹|uniapp+vue3+deepseek-v3æµå¼aièŠå¤©æ¨¡æ¿</a></span></p>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19385909\" target=\"_blank\">vite7+deepseekæµå¼aiæ¨¡æ¿|vue3.5+deepseek3.2+markdownæ‰“å­—è¾“å‡ºaiåŠ©æ‰‹</a></span></p>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19136187\" target=\"_blank\">Electron38-Vue3OSå®¢æˆ·ç«¯OSç³»ç»Ÿ|vite7+electron38+arcoæ¡Œé¢osåå°ç®¡ç†</a></span></p>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19116145\" target=\"_blank\">electron38-adminæ¡Œé¢ç«¯åå°|Electron38+Vue3+ElementPlusç®¡ç†ç³»ç»Ÿ</a></span></p>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19088804\" target=\"_blank\">Electron38-Wechatç”µè„‘ç«¯èŠå¤©|vite7+electron38ä»¿å¾®ä¿¡æ¡Œé¢ç«¯èŠå¤©ç³»ç»Ÿ</a></span></p>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19313982\" target=\"_blank\">æœ€æ–°ç‰ˆFlutter3.38+Dart3.10ä»¿å†™æŠ–éŸ³APPç›´æ’­+çŸ­è§†é¢‘+èŠå¤©åº”ç”¨ç¨‹åº</a></span></p>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/18894117\" target=\"_blank\">flutter3-deepseekæµå¼AIæ¨¡æ¿|Flutter3.27+Dio+DeepSeeekèŠå¤©aiåŠ©æ‰‹</a></span></p>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/18962574\" target=\"_blank\">æœ€æ–°ç‰ˆuniapp+vue3+uv-uiè·¨ä¸‰ç«¯çŸ­è§†é¢‘+ç›´æ’­+èŠå¤©ã€H5+å°ç¨‹åº+Appç«¯ã€‘</a></span></p>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19031695\" target=\"_blank\">æœ€æ–°ç‰ˆuni-app+vue3+uv-uiè·¨ä¸‰ç«¯ä»¿å¾®ä¿¡appèŠå¤©åº”ç”¨ã€h5+å°ç¨‹åº+appç«¯ã€‘</a></span></p>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19018641\" target=\"_blank\">Flutter3-MacOSæ¡Œé¢OSç³»ç»Ÿ|flutter3.32+window_managerå®¢æˆ·ç«¯OSæ¨¡æ¿</a></span></p>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19181509\" target=\"_blank\">Tauri2-Vite7Adminå®¢æˆ·ç«¯ç®¡ç†åå°|tauri2.9+vue3+element-plusåå°ç³»ç»Ÿ</a></span></p>\n<p><span style=\"font-size: 12px;\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19235565\" target=\"_blank\">Tauri2.9+Vue3æ¡Œé¢ç‰ˆOSç³»ç»Ÿ|vite7+tauri2+arcoDesignç”µè„‘ç«¯osåå°æ¨¡æ¿</a></span></p>\n</blockquote>\n<p><img alt=\"s13.sinaimg\" class=\"lazyload\" /></p>\n<p>&nbsp;</p>\n</div>\n<div id=\"MySignature\">\n    æœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œæœªç»åšä¸»å…è®¸ä¸å¾—è½¬è½½ï¼Œæ¬¢è¿å¤§å®¶ä¸€èµ·äº¤æµ QQï¼ˆ282310962ï¼‰ wxï¼ˆxy190310ï¼‰\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-12 23:54</span>&nbsp;\n<a href=\"https://www.cnblogs.com/xiaoyan2017\">xiaoyan2017</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": ".NET ç£ç›˜ç®¡ç†-æŠ€æœ¯æ–¹æ¡ˆé€‰å‹",
      "link": "https://www.cnblogs.com/kybs0/p/19473484",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/kybs0/p/19473484\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-12 23:50\">\n    <span>.NET ç£ç›˜ç®¡ç†-æŠ€æœ¯æ–¹æ¡ˆé€‰å‹</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p>åœ¨å®¶åº­ä»¥åŠä¼ä¸šåœºæ™¯ä¸‹çš„ç½‘ç»œç£ç›˜äº§å“ï¼Œä½¿ç”¨Iscsiå‡éœ€è¦å¯¹ç£ç›˜è¿›è¡Œç®¡ç†ã€‚ä¸åŒWindowsç‰ˆæœ¬ã€å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Œå¯¼è‡´æ¯ä¸ªCç«¯ç”¨æˆ·çš„è¿è¡Œç¯å¢ƒä¸åŒï¼Œå¯¹ç£ç›˜çš„ç®¡ç†å¸¦æ¥ä¸€å®šçš„ä½¿ç”¨å¹²æ‰°</p>\n<p>æœ¬æ–‡ä»‹ç»ä¸‹ç£ç›˜ç®¡ç†çš„å‡ ç§æ–¹æ¡ˆä»¥åŠå­˜åœ¨çš„ä¸€äº›é—®é¢˜</p>\n<p>å¯¹ç£ç›˜ç®¡ç†ä¸»è¦æœ‰ä»¥ä¸‹æ“ä½œå…¥å£/æ–¹å¼ï¼š</p>\n<ol>\n<li>Powershell</li>\n<li>Diskpart</li>\n<li>WMI</li>\n<li>WIN32(IOCTL)</li>\n</ol>\n<p>ä¸‹é¢ä»‹ç»ä¸‹å››è€…ä¹‹é—´çš„å…³ç³»ä»¥åŠæ‰€ä¾èµ–çš„windowsç³»ç»ŸæœåŠ¡</p>\n<h1>Windowsç£ç›˜ç®¡ç†æœåŠ¡ä¾èµ–å±‚çº§</h1>\n<p>ä»æ“ä½œç³»ç»Ÿè§’åº¦çœ‹ï¼Œè¿™å‡ ç§æ–¹å¼ç¼–ç¨‹/æ“ä½œå…¥å£æ˜¯å›´ç»•åŒä¸€å¥—å†…æ ¸ä¸æœåŠ¡å †æ ˆçš„ä¸åŒâ€œå£³â€ï¼Œå®Œæˆ<strong>å¥—å¨ƒå°è£…</strong></p>\n<p>ä»é«˜åˆ°ä½ï¼Œä¾æ¬¡åˆ—ä¸‹windowsä¸»è¦çš„ç£ç›˜ç›¸å…³å…¥å£å’ŒæœåŠ¡</p>\n<p>1. GUI/å·¥å…·å±‚</p>\n<p>MMC -&nbsp;Windowsç³»ç»Ÿç£ç›˜ç®¡ç†å·¥å…·ï¼Œå¦‚æœéœ€è¦å¿«é€ŸæŸ¥çœ‹å’Œæ“ä½œç£ç›˜åˆ†åŒºçš„è¯ï¼Œå¯ä»¥ç”¨è¿™ä¸ª</p>\n<p><img alt=\"image\" height=\"270\" src=\"https://img2024.cnblogs.com/blog/685541/202601/685541-20260112154249299-1528163380.png\" width=\"529\" /></p>\n<p>ä»¥åŠStorage Spaces GUI - Windowsç³»ç»Ÿè®¾ç½®å­˜å‚¨ç®¡ç†</p>\n<p><img alt=\"image\" height=\"306\" src=\"https://img2024.cnblogs.com/blog/685541/202601/685541-20260112154850543-1013979831.png\" width=\"533\" /><img alt=\"image\" height=\"305\" src=\"https://img2024.cnblogs.com/blog/685541/202601/685541-20260112155107194-71293024.png\" width=\"403\" /></p>\n<p>è¿™ä¿©ä¸ªå·¥å…·ä¸»è¦æ˜¯ä½¿ç”¨WMIç›¸å…³æ“ä½œæ¥å®ç°</p>\n<p>2. è„šæœ¬/å‘½ä»¤å±‚</p>\n<p>Powershellç£ç›˜ç®¡ç†å‘½ä»¤</p>\n<p>diskpartç£ç›˜ç®¡ç†å‘½ä»¤</p>\n<p>CIMç£ç›˜ç®¡ç†å‘½ä»¤</p>\n<p>3. API/ç®¡ç†æ¥å£å±‚</p>\n<p>WMIæœåŠ¡ï¼šWinmgmtï¼ˆWindows Management Instrumentationï¼‰ï¼Œä½¿ç”¨Win32_DiskDrive ç­‰</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/685541/202601/685541-20260112181124821-2050380879.png\" /></p>\n<p>ç£ç›˜ç®¡ç†æœåŠ¡ï¼šVirtual Diskï¼ŒVDSè¿›ç¨‹åç§°vds.exe</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/685541/202601/685541-20260112180656866-1672546299.png\" /></p>\n<p>ç£ç›˜å­˜å‚¨æœåŠ¡ï¼šMicrosoft Storage Spaces SMP</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/685541/202601/685541-20260112163817548-1975243303.png\" /></p>\n<p>4. å†…æ ¸/é©±åŠ¨/IOCTLå±‚</p>\n<p>Storage Management Providerï¼šç³»ç»Ÿç»„ä»¶ï¼Œä¸æ˜¯å•ç‹¬æœåŠ¡å¯è§<br />IOCTLï¼š Win32APIã€DevicerIoControl</p>\n<p>ç£ç›˜ç±»é©±åŠ¨ï¼ˆdisk.sysï¼‰ã€å·ç®¡ç†å™¨ï¼ˆvolmgr/vdsciï¼‰ã€æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ï¼ˆNTFS/ReFSï¼‰</p>\n<p><strong>è€Œä¸Šé¢è¯´çš„å››ç§æ–¹æ¡ˆï¼Œä¾èµ–çš„åº•å±‚æœåŠ¡ï¼š</strong></p>\n<p>PowerShell åŸºäº WMI / Storage Management APIå°è£…ï¼Œä¾èµ–çš„ç»„ä»¶æœ€å¤šï¼šWinmgmtã€Microsoft Storage Spaces SMPã€Storage Serviceã€VDSç­‰<br />WMI/CIM æœ‰éƒ¨åˆ†æ˜¯èµ° VDS / Storage APIï¼Œæœ‰éƒ¨åˆ†ç›´æ¥è°ƒç”¨åº•å±‚é©±åŠ¨ï¼Œä¾èµ–ï¼šVDSæœåŠ¡ã€WinmgmtæœåŠ¡</p>\n<p>diskpart å†…éƒ¨æ˜¯è°ƒç”¨ VDS / Storage API / IOCTLï¼Œä¾èµ–ç›¸å¯¹è¾ƒå°‘ï¼šVDSæœåŠ¡ç­‰</p>\n<p>Win32 IOCTL æ˜¯æœ€åº•å±‚ï¼ˆç”¨æˆ·æ€å¯è¾¾ï¼‰çš„æ¥å£ï¼Œä¸ä¾èµ–ä¸Šå±‚æ¡†æ¶</p>\n<p>æ¯”å¦‚ä¸‹æ–¹çš„WMIæœåŠ¡ä¸å­˜åœ¨ï¼Œä¼šå¯¼è‡´powershellç£ç›˜æŸ¥è¯¢ä¸åˆ°ï¼ŒWMIç£ç›˜æŸ¥è¯¢ä¸åˆ°ï¼Œä½†diskpartè®¿é—®æ­£å¸¸ï¼š</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> PS C:\\Users\\yudong04&gt; G<span style=\"color: rgba(0, 0, 255, 1);\">et-Disk</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 2</span> PS C:\\Users\\yudong04&gt; <span style=\"color: rgba(0, 0, 255, 1);\">Get-CimInstance</span> -Namespace root/Microsoft/Windows/Storage -<span style=\"color: rgba(0, 0, 0, 1);\">ClassName MSFT_Disk\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 3</span> PS C:\\Users\\yudong04&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> diskpart\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 5</span> Microsoft DiskPart ç‰ˆæœ¬ 10.0.26100.1150\n<span style=\"color: rgba(0, 128, 128, 1);\"> 6</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 7</span> <span style=\"color: rgba(0, 0, 0, 1);\">Copyright (C) Microsoft Corporation.\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 8</span> åœ¨è®¡ç®—æœºä¸Š: GIH-D-24762\n<span style=\"color: rgba(0, 128, 128, 1);\"> 9</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">10</span> DISKPART&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> list disk\n</span><span style=\"color: rgba(0, 128, 128, 1);\">11</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">12</span>   ç£ç›˜ <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\">##  çŠ¶æ€           å¤§å°     å¯ç”¨     Dyn  Gpt</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">13</span>   --------  -------------  -------  -------  ---  ---\n<span style=\"color: rgba(0, 128, 128, 1);\">14</span>   ç£ç›˜ 0    è”æœº             3726 GB  1024 KB        *\n<span style=\"color: rgba(0, 128, 128, 1);\">15</span>   ç£ç›˜ 1    è”æœº             3726 GB  1024 KB        *\n<span style=\"color: rgba(0, 128, 128, 1);\">16</span>   ç£ç›˜ 2    è”æœº             2794 GB      0 B        *\n<span style=\"color: rgba(0, 128, 128, 1);\">17</span>   ç£ç›˜ 3    è”æœº              931 GB      0 B        *\n<span style=\"color: rgba(0, 128, 128, 1);\">18</span>   ç£ç›˜ 4    è”æœº              465 GB  1024 KB        *\n<span style=\"color: rgba(0, 128, 128, 1);\">19</span>   ç£ç›˜ 5    è”æœº             1863 GB      0<span style=\"color: rgba(0, 0, 0, 1);\"> B\n</span><span style=\"color: rgba(0, 128, 128, 1);\">20</span>   ç£ç›˜ 6    è”æœº             7452 GB      0 B        *</pre>\n</div>\n<p><span style=\"font-size: 14px;\">è¿˜æœ‰Microsoft Storage Spaces SMPæœåŠ¡è¢«ç¬¬ä¸‰æ–¹è½¯ä»¶ç¦ç”¨ï¼Œå¯¼è‡´Powershell Get-Diskè·å–ç»“æœä¸ºç©ºï¼š</span></p>\n<p><img alt=\"image\" height=\"554\" src=\"https://img2024.cnblogs.com/blog/685541/202601/685541-20260112205453476-213941181.png\" width=\"1009\" /></p>\n<p><span style=\"font-size: 14px;\">ä¸‹é¢å¯¹å„ä¸ªæ¨¡å—å±•å¼€ä»‹ç»ä¸‹</span></p>\n<h1>Powershellç£ç›˜ç®¡ç†</h1>\n<p>ä¸Šé¢è¯´äº†ï¼ŒPowerShellä½¿ç”¨ Storage Management API + æ–°çš„ WMI/CIM ç±»ï¼Œç£ç›˜å‘½ä»¤æœ¬è´¨æ˜¯å¯¹è¿™äº› WMI ç±»çš„åŒ…è£…ã€‚å±‚çº§å¦‚ä¸‹ï¼š</p>\n<p>PowerShell cmdlet<br />-&gt; MSFT_* WMI ç±» (CIM)ã€WMIæœåŠ¡Winmgmt<br />-&gt; Storage Management Provider<br />-&gt; å†…æ ¸é©±åŠ¨ (disk.sys, partmgr.sys, volmgr.sys)<br />-&gt; è®¾å¤‡ç¡¬ä»¶</p>\n<p>powershellæœ‰ä»¥ä¸‹æŸ¥æ‰¾ä¸»è¦å‘½ä»¤ï¼Œ</p>\n<p>Get-Disk - æŸ¥æ‰¾ç£ç›˜</p>\n<p>Get-Partition - æŸ¥æ‰¾åˆ†åŒº</p>\n<p>Get-Volume - æŸ¥æ‰¾å·</p>\n<p>Get-Disk | Where-Object -FilterScript {&nbsp; $_.BusType -Eq \"iSCSI\" -and $_.SerialNumber -Eq \"8fa461f8-9436-4260-8191-789b23859757\"} - æŸ¥æ‰¾æŒ‡å®šIscsiåè®®ç£ç›˜</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/685541/202601/685541-20260112162810665-890504091.png\" /></p>\n<p>æ“ä½œç£ç›˜å‘½ä»¤ï¼Œæ¯”å¦‚åˆå§‹åŒ–GPTç£ç›˜ï¼šInitialize-Disk -PartitionStyle GPT -PassThru | New-Partition -UseMaximumSize | Format-Volume -FileSystem:NTFS -NewFileSystemLabel:æµ‹è¯•ç›˜ -Confirm:$false -Force</p>\n<p>Powershellå‘½ä»¤å› æ˜“ç”¨æ€§ï¼Œéå¸¸é€‚åˆè„šæœ¬è‡ªåŠ¨åŒ–ã€ç”¨æˆ·çº§çš„ä½¿ç”¨ã€‚ä½†éå¸¸ä¸ç”¨æˆ·ç¯å¢ƒæœ‰å…³ï¼Œæ¢ä¸ªç”¨æˆ·æˆ–æ¢å°æœºå™¨å°±ç»å¸¸è¡¨ç°ä¸åŒï¼Œæ¯”å¦‚ï¼šå¡å¾ˆä¹…ã€è¶…æ—¶ã€ç›´æ¥æŠ¥é”™ã€ç£ç›˜ç›˜å°±æ˜¯æŸ¥è¯¢ä¸åˆ°</p>\n<p>å‡ ä¸ªåŸå› ï¼š</p>\n<p>WMI / CIM è°ƒç”¨è¶…æ—¶</p>\n<ul>\n<li>WMI æœåŠ¡å¡ä½ã€å­˜å‚¨é©±åŠ¨å“åº”æ…¢</li>\n<li>ç½‘ç»œ/é˜²ç«å¢™å¯¼è‡´è¿œç¨‹è°ƒç”¨è¶…æ—¶</li>\n\n\n\n\n\n\n\n\n\n</ul>\n<p>ç¡¬ä»¶IOè¶…æ—¶</p>\n<ul>\n<li>åç›˜ / å U ç›˜ / USB æ‰©å±•åè´¨é‡é—®é¢˜</li>\n<li>å¤§é‡é‡æ–°å°è¯• I/O å¯¼è‡´æ“ä½œæ•´ä½“æ‹–å¾—å¾ˆé•¿</li>\n\n\n\n\n\n\n\n\n</ul>\n<p>å…·ä½“åœºæ™¯ï¼Œå‘ç°å…¬å¸å†…éƒ¨æŸä¸ªéƒ¨é—¨å‘ç”Ÿpowershellå‘½ä»¤è¶…æ—¶æ¦‚ç‡å¾ˆå¤šï¼Œå› ä¸ºè¿™äº›è®¾å¤‡éƒ½åœ¨è·‘è½¯ä»¶å‹åŠ›æµ‹è¯•ã€‚ã€‚ã€‚å¯¼è‡´ç£ç›˜è·å–å‘½ä»¤ï¼Œå¾ˆå®¹æ˜“è¶…æ—¶</p>\n<p>è¿˜æœ‰äº›ç‰¹æ®Šæƒ…å†µï¼ŒæœåŠ¡å¼‚å¸¸å‡ºç°çš„æƒ…å†µæ¯”è¾ƒå¤šã€‚å¦‚WMIæœåŠ¡ï¼Œä»¥ä¸‹æ˜¯ä¿®å¤æˆåŠŸæ¡ˆä¾‹ï¼š</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span> PS C:\\Users\\yudong04&gt; <span style=\"color: rgba(0, 0, 255, 1);\">Get-WmiObject</span><span style=\"color: rgba(0, 0, 0, 1);\"> Win32_OperatingSystem\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span> <span style=\"color: rgba(0, 0, 255, 1);\">Get-WmiObject</span><span style=\"color: rgba(0, 0, 0, 1);\"> : æ— æ•ˆç±» â€œWin32_OperatingSystemâ€\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 3</span> æ‰€åœ¨ä½ç½® è¡Œ:1 å­—ç¬¦: 1\n<span style=\"color: rgba(0, 128, 128, 1);\"> 4</span> + <span style=\"color: rgba(0, 0, 255, 1);\">Get-WmiObject</span><span style=\"color: rgba(0, 0, 0, 1);\"> Win32_OperatingSystem\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 5</span> +<span style=\"color: rgba(0, 0, 0, 1);\"> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>     + CategoryInfo          : InvalidType: (:) [<span style=\"color: rgba(0, 0, 255, 1);\">Get-WmiObject</span><span style=\"color: rgba(0, 0, 0, 1);\">], ManagementException\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>     +<span style=\"color: rgba(0, 0, 0, 1);\"> FullyQualifiedErrorId : GetWMIManagementException,Microsoft.PowerShell.Commands.GetWmiObjectCommand\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 8</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 9</span> PS C:\\Users\\yudong04&gt; net stop winmgmt /<span style=\"color: rgba(0, 0, 0, 1);\">y\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span> <span style=\"color: rgba(0, 0, 0, 1);\">Windows Management Instrumentation æœåŠ¡æ­£åœ¨åœæ­¢.\n</span><span style=\"color: rgba(0, 128, 128, 1);\">11</span> <span style=\"color: rgba(0, 0, 0, 1);\">Windows Management Instrumentation æœåŠ¡å·²æˆåŠŸåœæ­¢ã€‚\n</span><span style=\"color: rgba(0, 128, 128, 1);\">12</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">13</span> PS C:\\Users\\yudong04&gt; winmgmt /<span style=\"color: rgba(0, 0, 0, 1);\">resetrepository\n</span><span style=\"color: rgba(0, 128, 128, 1);\">14</span> <span style=\"color: rgba(0, 0, 0, 1);\">WMI å­˜å‚¨åº“å·²é‡ç½®\n</span><span style=\"color: rgba(0, 128, 128, 1);\">15</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">16</span> PS C:\\Users\\yudong04&gt; <span style=\"color: rgba(0, 0, 255, 1);\">Get-WmiObject</span><span style=\"color: rgba(0, 0, 0, 1);\"> Win32_OperatingSystem\n</span><span style=\"color: rgba(0, 128, 128, 1);\">17</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">18</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">19</span> <span style=\"color: rgba(0, 0, 0, 1);\">SystemDirectory : C:\\WINDOWS\\system32\n</span><span style=\"color: rgba(0, 128, 128, 1);\">20</span> <span style=\"color: rgba(0, 0, 0, 1);\">Organization    : Online Game Dept\n</span><span style=\"color: rgba(0, 128, 128, 1);\">21</span> BuildNumber     : 26100\n<span style=\"color: rgba(0, 128, 128, 1);\">22</span> <span style=\"color: rgba(0, 0, 0, 1);\">RegisteredUser  : Windows ç”¨æˆ·\n</span><span style=\"color: rgba(0, 128, 128, 1);\">23</span> SerialNumber    : 00329-00000-00003-<span style=\"color: rgba(0, 0, 0, 1);\">AA238\n</span><span style=\"color: rgba(0, 128, 128, 1);\">24</span> Version         : 10.0.26100</pre>\n</div>\n<p>è¿˜æœ‰Microsoft Storage Spaces SMPæœåŠ¡ï¼Œå¦‚æœGet-Diskæ‹¿ä¸åˆ°ç£ç›˜ï¼Œå®šä½å®¢æˆ·é—®é¢˜å‘ç°å¾ˆå¤§å¯èƒ½æ˜¯è¿™ä¸ªæœåŠ¡å¼‚å¸¸äº†ã€‚é‡å¯ä¸€ä¸‹å³å¯</p>\n<h1>WMI/CIMç£ç›˜ç®¡ç†</h1>\n<p>WMIç›¸å…³å‘½ä»¤ï¼Œéœ€è¦æ‹†åˆ†ä¸ºä¿©éƒ¨åˆ†ï¼šWIN32_*ç»å…¸ç±»ï¼Œä»¥åŠMSFT_*æ–°çš„StorageWMIç±»</p>\n<p><strong>ç»å…¸ç±»ï¼š</strong></p>\n<ul>\n<li>Win32_DiskDrive</li>\n<li>Win32_DiskPartition</li>\n<li>Win32_LogicalDisk</li>\n<li>Win32_Volume</li>\n</ul>\n<p>æ—©æœŸè®¾è®¡ï¼Œå¾ˆå¤šæ˜¯é€šè¿‡å†…æ ¸ API + IOCTL å’Œ VDS å®ç°ã€‚ä¸»è¦ç”¨äºæŸ¥è¯¢ï¼Œä¿®æ”¹æ“ä½œæœ‰é™</p>\n<p>ä¾èµ–æœåŠ¡ï¼šWinmgmtã€RPCSSï¼ˆRPCæœåŠ¡ï¼‰ã€ä»¥åŠå°‘é‡ä¾èµ–VDS</p>\n<p><strong>StorageWmiç±»</strong></p>\n<ul>\n<li>MSFT_Disk</li>\n<li>MSFT_Partition</li>\n<li>MSFT_Volume</li>\n<li>MSFT_StoragePool</li>\n<li>MSFT_VirtualDisk</li>\n</ul>\n<p>è¿™æ˜¯Windows8ä¹‹åçš„æ–°å­˜å‚¨ç®¡ç†WMIæ¥å£ï¼Œè¯¦è§å®˜ç½‘æ–‡æ¡£ï¼š<a href=\"https://learn.microsoft.com/en-us/windows-hardware/drivers/storage/storage-management-api-classes\" rel=\"noopener nofollow\">Storage Management API Classes - Windows drivers | Microsoft Learn</a>, ä¾èµ–å±‚çº§ï¼š</p>\n<p>WMI (MSFT_* ç±»)<br />  -&gt; Storage Management Provider<br />     -&gt; IOCTL -&gt; disk.sys / partmgr.sys / ...</p>\n<p>å…·ä½“ä¾èµ–çš„æœåŠ¡ï¼šWinmgmtï¼ˆWMI æœåŠ¡ï¼‰</p>\n<p>WMI æ˜¯â€œç®¡ç†æ•°æ®æ¨¡å‹ + æ¥å£â€ï¼Œæœ¬èº«ä¸æ˜¯ä¸€ä¸ªç£ç›˜ç®¡ç†â€œæ–¹æ¡ˆâ€ï¼Œè€Œæ˜¯å¾ˆå¤šæ–¹æ¡ˆçš„åŸºç¡€æ¥å£ã€‚ç›¸å¯¹Powershell Storageç®¡ç†ï¼Œç®—æ˜¯æ¯”è¾ƒç¨³å®šå’Œä¾èµ–è¾ƒå°‘çš„äº†</p>\n<p>ç›´æ¥ä½¿ç”¨.NETé€šè¿‡WMIè·å–è¯¦ç»†çš„ç£ç›˜åˆ—è¡¨æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span>     <span style=\"color: rgba(0, 0, 255, 1);\">public</span> OperateResult&lt;List&lt;LocalDisk&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> GetDisks()\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 2</span> <span style=\"color: rgba(0, 0, 0, 1);\">    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 3</span>         <span style=\"color: rgba(0, 0, 255, 1);\">var</span> disks = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> List&lt;LocalDisk&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>         <span style=\"color: rgba(0, 0, 255, 1);\">try</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 5</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> Win32_DiskDrive: ç‰©ç†ç£ç›˜</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>             <span style=\"color: rgba(0, 0, 255, 1);\">using</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> searcher = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> ManagementObjectSearcher(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">SELECT * FROM Win32_DiskDrive</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 8</span>             <span style=\"color: rgba(0, 0, 255, 1);\">using</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> driveCollection =<span style=\"color: rgba(0, 0, 0, 1);\"> searcher.Get())\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 9</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">10</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">foreach</span> (ManagementObject drive <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> driveCollection)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">11</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">12</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">var</span> diskInfo = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> LocalDisk();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">13</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">14</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 1. ç£ç›˜ç¼–å· PhysicalDriveN\n</span><span style=\"color: rgba(0, 128, 128, 1);\">15</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> Win32_DiskDrive.DeviceID ä¸€èˆ¬ä¸º \"\\\\.\\PHYSICALDRIVE0\"</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">16</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">var</span> deviceId = (drive[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DeviceID</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>] <span style=\"color: rgba(0, 0, 255, 1);\">as</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span>) ?? <span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.Empty;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">17</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">var</span> diskNumber =<span style=\"color: rgba(0, 0, 0, 1);\"> ParsePhysicalDriveNumber(deviceId);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">18</span>                     diskInfo.Number =<span style=\"color: rgba(0, 0, 0, 1);\"> diskNumber;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">19</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">20</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 2. åºåˆ—å· (ä¸åŒå‚å•†æ ¼å¼ä¸ç»Ÿä¸€ï¼›æœ‰æ—¶éœ€è¦ Win32_PhysicalMedia)</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">21</span>                     diskInfo.SerialNumber = (drive[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">SerialNumber</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>] <span style=\"color: rgba(0, 0, 255, 1);\">as</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span>)?.Trim() ?? <span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.Empty;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">22</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">23</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 3. DeviceName</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">24</span>                     diskInfo.DeviceName = (drive[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Model</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>] <span style=\"color: rgba(0, 0, 255, 1);\">as</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span>)?.Trim() ?? <span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.Empty;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">25</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">26</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 4. åªè¯»/åœ¨çº¿çŠ¶æ€ï¼ˆWMI å¹¶æ²¡æœ‰éå¸¸æ ‡å‡†çš„å­—æ®µï¼Œè¿™é‡Œç”¨ç²—ç•¥æ˜ å°„ï¼‰\n</span><span style=\"color: rgba(0, 128, 128, 1);\">27</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">   Win32_DiskDrive.Status: \"OK\" / \"Error\" / \"Degraded\" ...</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">28</span>                     diskInfo.IsOffline =<span style=\"color: rgba(0, 0, 0, 1);\"> GetOffline(diskNumber);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">29</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">30</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ²¡æœ‰ç›´æ¥ readonly æ ‡è®°ï¼Œå…ˆé»˜è®¤ä¸º falseï¼Œ\n</span><span style=\"color: rgba(0, 128, 128, 1);\">31</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¦‚éœ€æ›´ç²¾ç¡®å¯ä»¥é€šè¿‡ Win32_Volume æˆ– DeviceIoControl è·å–ã€‚</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">32</span>                     diskInfo.IsReadOnly =<span style=\"color: rgba(0, 0, 0, 1);\"> GetReadonly(diskNumber);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">33</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">34</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 5. æ€»çº¿ç±»å‹ï¼ˆæ²¡æœ‰ STORAGE_BUS_TYPE æšä¸¾ï¼Œä½¿ç”¨ InterfaceType ç²—ç•¥æ˜ å°„ï¼‰</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">35</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">var</span> interfaceType = (drive[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">InterfaceType</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>] <span style=\"color: rgba(0, 0, 255, 1);\">as</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span>)?<span style=\"color: rgba(0, 0, 0, 1);\">.Trim();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">36</span>                     diskInfo.BusType =<span style=\"color: rgba(0, 0, 0, 1);\"> MapBusType(interfaceType, diskInfo.DeviceName);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">37</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">38</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 6. ç£ç›˜å®¹é‡ (å­—èŠ‚ -&gt; GB)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">39</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> Win32_DiskDrive.Size ä¸ºå­—èŠ‚æ•°ï¼ˆstringï¼‰</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">40</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (drive[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Size</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>] != <span style=\"color: rgba(0, 0, 255, 1);\">null</span> &amp;&amp; <span style=\"color: rgba(0, 0, 255, 1);\">long</span>.TryParse(drive[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Size</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>].ToString(), <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">long</span><span style=\"color: rgba(0, 0, 0, 1);\"> sizeBytes))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">41</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">42</span>                         diskInfo.DiskSize =<span style=\"color: rgba(0, 0, 0, 1);\"> sizeBytes;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">43</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">44</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">45</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 7. è·å–æŒ‚è½½ç‚¹åŠå·²ç”¨å®¹é‡ï¼Œé€šè¿‡ 3 å¼  WMI å…³è”è¡¨ï¼š\n</span><span style=\"color: rgba(0, 128, 128, 1);\">46</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> Win32_DiskDrive -&gt; Win32_DiskDriveToDiskPartition -&gt; Win32_DiskPartition -&gt;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">47</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> Win32_LogicalDiskToPartition -&gt; Win32_LogicalDisk</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">48</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    FillMountPathsAndUsedSize(diskInfo, drive);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">49</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    disks.Add(diskInfo);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">50</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">51</span>                     diskInfo.Tag =<span style=\"color: rgba(0, 0, 0, 1);\"> GetVolumeLabel(diskInfo.MountPaths.FirstOrDefault());\n</span><span style=\"color: rgba(0, 128, 128, 1);\">52</span> <span style=\"color: rgba(0, 0, 0, 1);\">                }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">53</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">54</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">55</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;List&lt;LocalDisk&gt;&gt;.ToSuccess(disks.OrderBy(i =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> i.Number).ToList());\n</span><span style=\"color: rgba(0, 128, 128, 1);\">56</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">57</span>         <span style=\"color: rgba(0, 0, 255, 1);\">catch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Exception ex)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">58</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">59</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;List&lt;LocalDisk&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToError(ex.Message);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">60</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">61</span>     }</pre>\n</div>\n<p>é™„å¸¦çš„ä¸€äº›å±æ€§è·å–å‡½æ•°ï¼š</p>\n<div class=\"cnblogs_code\"><img class=\"code_img_closed\" id=\"code_img_closed_ac2201cc-0955-4850-bc5f-4794df011a32\" src=\"https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif\" /><img class=\"code_img_opened\" id=\"code_img_opened_ac2201cc-0955-4850-bc5f-4794df011a32\" src=\"https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif\" style=\"display: none;\" />\n<div class=\"cnblogs_code_hide\" id=\"cnblogs_code_open_ac2201cc-0955-4850-bc5f-4794df011a32\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\">  1</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> ParsePhysicalDriveNumber(<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\"> deviceId)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">  2</span> <span style=\"color: rgba(0, 0, 0, 1);\">    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">  3</span>         <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> \"\\\\.\\PHYSICALDRIVE0\" -&gt; 0</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">  4</span>         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.IsNullOrWhiteSpace(deviceId))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">  5</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span> -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">  6</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">  7</span>         <span style=\"color: rgba(0, 0, 255, 1);\">var</span> upper =<span style=\"color: rgba(0, 0, 0, 1);\"> deviceId.ToUpperInvariant();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">  8</span>         <span style=\"color: rgba(0, 0, 255, 1);\">var</span> idx = upper.LastIndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">PHYSICALDRIVE</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, StringComparison.Ordinal);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">  9</span>         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (idx &lt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span>) <span style=\"color: rgba(0, 0, 255, 1);\">return</span> -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 10</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 11</span>         <span style=\"color: rgba(0, 0, 255, 1);\">var</span> numPart = upper.Substring(idx + <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">PHYSICALDRIVE</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">.Length);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 12</span>         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (<span style=\"color: rgba(0, 0, 255, 1);\">int</span>.TryParse(numPart, NumberStyles.Integer, CultureInfo.InvariantCulture, <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">var</span><span style=\"color: rgba(0, 0, 0, 1);\"> num))\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 13</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> num;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 14</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 15</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span> -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 16</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 17</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 18</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span> StorageBusType MapBusType(<span style=\"color: rgba(0, 0, 255, 1);\">string</span> interfaceType, <span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\"> deviceName)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 19</span> <span style=\"color: rgba(0, 0, 0, 1);\">    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 20</span>         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.IsNullOrEmpty(interfaceType))\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 21</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> StorageBusType.Unknown;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 22</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 23</span>         <span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (interfaceType.ToUpperInvariant())\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 24</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 25</span>             <span style=\"color: rgba(0, 0, 255, 1);\">case</span> <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">SCSI</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 26</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (deviceName.Contains(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">SCSI</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 27</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 28</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> StorageBusType.Iscsi;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 29</span> <span style=\"color: rgba(0, 0, 0, 1);\">                }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 30</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> StorageBusType.Scsi;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 31</span>             <span style=\"color: rgba(0, 0, 255, 1);\">case</span> <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">IDE</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 32</span>             <span style=\"color: rgba(0, 0, 255, 1);\">case</span> <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">ATA</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 33</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> StorageBusType.Ata;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 34</span>             <span style=\"color: rgba(0, 0, 255, 1);\">case</span> <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">USB</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 35</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> StorageBusType.Usb;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 36</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¯æ ¹æ®éœ€è¦æ‰©å±•æ˜ å°„</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 37</span>             <span style=\"color: rgba(0, 0, 255, 1);\">default</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 38</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> StorageBusType.Unknown;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 39</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 40</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 41</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 42</span>     <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 43</span>     <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¡«å…… MountPathsï¼ˆç›˜ç¬¦ï¼‰å’Œ DiskUsedSizeï¼ˆGBï¼‰\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 44</span>     <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 45</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span><span style=\"color: rgba(0, 0, 0, 1);\"> OperateResult FillMountPathsAndUsedSize(LocalDisk diskInfo, ManagementObject diskDrive)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 46</span> <span style=\"color: rgba(0, 0, 0, 1);\">    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 47</span>         <span style=\"color: rgba(0, 0, 255, 1);\">long</span> totalUsedBytes = <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 48</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 49</span>         <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> é€šè¿‡ Win32_DiskDriveToDiskPartition å…³è”åˆ°åˆ†åŒº</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 50</span>         <span style=\"color: rgba(0, 0, 255, 1);\">using</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> partitionRel = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> ManagementObjectSearcher(\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 51</span>                    <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">ASSOCIATORS OF {Win32_DiskDrive.DeviceID='</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> + diskDrive[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DeviceID</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>] +\n<span style=\"color: rgba(0, 128, 128, 1);\"> 52</span>                    <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">'} WHERE AssocClass = Win32_DiskDriveToDiskPartition</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 53</span>         <span style=\"color: rgba(0, 0, 255, 1);\">using</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> partitions =<span style=\"color: rgba(0, 0, 0, 1);\"> partitionRel.Get())\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 54</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 55</span>             <span style=\"color: rgba(0, 0, 255, 1);\">foreach</span> (ManagementObject partition <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> partitions)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 56</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 57</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> é€šè¿‡ Win32_LogicalDiskToPartition å…³è”åˆ°é€»è¾‘ç£ç›˜ï¼ˆç›˜ç¬¦ï¼‰</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 58</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">using</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> logicalRel = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> ManagementObjectSearcher(\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 59</span>                            <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">ASSOCIATORS OF {Win32_DiskPartition.DeviceID='</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> + partition[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DeviceID</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>] +\n<span style=\"color: rgba(0, 128, 128, 1);\"> 60</span>                            <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">'} WHERE AssocClass = Win32_LogicalDiskToPartition</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 61</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">using</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> logicalDisks =<span style=\"color: rgba(0, 0, 0, 1);\"> logicalRel.Get())\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 62</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 63</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">foreach</span> (ManagementObject logicalDisk <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> logicalDisks)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 64</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 65</span>                         <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> è®¡ç®—å·²ç”¨ç©ºé—´</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 66</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (logicalDisk[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Size</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>] != <span style=\"color: rgba(0, 0, 255, 1);\">null</span> &amp;&amp;\n<span style=\"color: rgba(0, 128, 128, 1);\"> 67</span>                             logicalDisk[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">FreeSpace</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>] != <span style=\"color: rgba(0, 0, 255, 1);\">null</span> &amp;&amp;\n<span style=\"color: rgba(0, 128, 128, 1);\"> 68</span>                             <span style=\"color: rgba(0, 0, 255, 1);\">long</span>.TryParse(logicalDisk[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Size</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>].ToString(), <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">long</span> volSize) &amp;&amp;\n<span style=\"color: rgba(0, 128, 128, 1);\"> 69</span>                             <span style=\"color: rgba(0, 0, 255, 1);\">long</span>.TryParse(logicalDisk[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">FreeSpace</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>].ToString(), <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">long</span><span style=\"color: rgba(0, 0, 0, 1);\"> free))\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 70</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 71</span>                             totalUsedBytes += (volSize -<span style=\"color: rgba(0, 0, 0, 1);\"> free);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 72</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 73</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 74</span> <span style=\"color: rgba(0, 0, 0, 1);\">                }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 75</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 76</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 77</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 78</span>         diskInfo.DiskUsedSize =<span style=\"color: rgba(0, 0, 0, 1);\">totalUsedBytes;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 79</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 80</span>         <span style=\"color: rgba(0, 0, 255, 1);\">try</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 81</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 82</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> paths =<span style=\"color: rgba(0, 0, 0, 1);\"> GetAccessPaths(diskInfo.Number);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 83</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> filtedPaths = paths.Where(i =&gt; !i.StartsWith(<span style=\"color: rgba(128, 0, 0, 1);\">@\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\\\?\\Volume</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)).ToList();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 84</span>             diskInfo.MountPaths =<span style=\"color: rgba(0, 0, 0, 1);\"> filtedPaths;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 85</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> OperateResult.ToSuccess();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 86</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 87</span>         <span style=\"color: rgba(0, 0, 255, 1);\">catch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Exception e)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 88</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 89</span>            <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> OperateResult.ToError(e);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 90</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 91</span> <span style=\"color: rgba(0, 0, 0, 1);\">    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 92</span>     <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 93</span>     <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> è·å–ç£ç›˜çš„æ‰€æœ‰è®¿é—®è·¯å¾„\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 94</span>     <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 95</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span> List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt; GetAccessPaths(<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> diskNumber)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 96</span> <span style=\"color: rgba(0, 0, 0, 1);\">    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 97</span>         ManagementScope scope = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> ManagementScope(<span style=\"color: rgba(128, 0, 0, 1);\">@\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\\\.\\root\\Microsoft\\Windows\\Storage</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 98</span> <span style=\"color: rgba(0, 0, 0, 1);\">        scope.Connect();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 99</span>         <span style=\"color: rgba(0, 0, 255, 1);\">string</span> query = $<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">SELECT * FROM MSFT_Partition WHERE DiskNumber = {diskNumber}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">100</span>         <span style=\"color: rgba(0, 0, 255, 1);\">using</span> ManagementObjectSearcher searcher = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> ManagementObjectSearcher(scope, <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> ObjectQuery(query));\n</span><span style=\"color: rgba(0, 128, 128, 1);\">101</span>         <span style=\"color: rgba(0, 0, 255, 1);\">var</span> pathList = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">102</span>         <span style=\"color: rgba(0, 0, 255, 1);\">foreach</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> partition <span style=\"color: rgba(0, 0, 255, 1);\">in</span> searcher.Get().Cast&lt;ManagementObject&gt;<span style=\"color: rgba(0, 0, 0, 1);\">())\n</span><span style=\"color: rgba(0, 128, 128, 1);\">103</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">104</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> è·å– AccessPaths å±æ€§ï¼ˆæ•°ç»„ï¼‰</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">105</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> accessPaths = partition[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">AccessPaths</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>] <span style=\"color: rgba(0, 0, 255, 1);\">as</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">[];\n</span><span style=\"color: rgba(0, 128, 128, 1);\">106</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (accessPaths == <span style=\"color: rgba(0, 0, 255, 1);\">null</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">107</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">108</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">continue</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">109</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">110</span> <span style=\"color: rgba(0, 0, 0, 1);\">            pathList.AddRange(accessPaths);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">111</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">112</span>         <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> pathList;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">113</span>     }</pre>\n</div>\n<span class=\"cnblogs_code_collapse\">View Code</span></div>\n<p>éå†ç£ç›˜åˆ—è¡¨ï¼Œ4å—ç›˜è€—æ—¶æ¥è¿‘1sï¼š</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/685541/202601/685541-20260112202253746-677311477.png\" /></p>\n<h1>DiskPartç£ç›˜ç®¡ç†</h1>\n<p>diskpart æ˜¯ åŸç”Ÿ Win32 å‘½ä»¤è¡Œå·¥å…·ï¼Œå†…éƒ¨å¤§è‡´é€šè¿‡ï¼š</p>\n<ul>\n<li>VDS / Storage Management APIï¼ˆè€ç³»ç»Ÿï¼‰</li>\n<li>æ–°ç³»ç»Ÿä¸Šï¼Œä¸€éƒ¨åˆ†åŠŸèƒ½ç”±æ–°çš„ Storage API æ¥ç®¡</li>\n<li>å†å¾€ä¸‹è¿˜æ˜¯ IOCTL è°ƒç”¨å†…æ ¸é©±åŠ¨</li>\n</ul>\n<p>è°ƒç”¨å±‚çº§å¦‚ä¸‹ï¼Œdiskpart.exe<br />  -&gt; VDS / Storage Management API<br />     -&gt; å†…æ ¸é©±åŠ¨ (disk.sys, partmgr.sys, volmgr.sys)<br />        -&gt; è®¾å¤‡ç¡¬ä»¶</p>\n<p>diskpartå¸¸ç”¨å‘½ä»¤åˆ—è¡¨ï¼š</p>\n<ul>\n<li>list disk</li>\n<li>select disk 1</li>\n<li>detail disk</li>\n<li>list partition</li>\n<li>list volume</li>\n\n\n\n\n\n\n\n\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/685541/202601/685541-20260112202413306-148039174.png\" /></p>\n<p>DiskPartå¯¹WMIå¹¶ä¸å¼ºä¾èµ–ï¼ŒåŸºæœ¬ä¸Šä¾èµ–æœåŠ¡å°±ä¸€ä¸ªVirtual Diskäº†ï¼Œæ“ä½œä¹Ÿæ¯”è¾ƒç®€å•ã€‚ä½†ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œè®¿é—®æ€§èƒ½æ¯”è¾ƒå·®ã€ç£ç›˜æ“ä½œä½¿ç”¨Powersehellè°ƒç”¨diskpartå‘½ä»¤åŸºæœ¬ä¹Ÿåœ¨sçº§ä»¥ä¸Š</p>\n<h1>Win32 IOCTLç£ç›˜ç®¡ç†</h1>\n<p>IOCTLæ˜¯æŒ‡é€šè¿‡ç›´æ¥è°ƒç”¨ Windows API DeviceIoControl å¯¹ç£ç›˜ã€å·ã€æ–‡ä»¶å¥æŸ„å‘é€æ§åˆ¶ç ï¼š</p>\n<ul>\n<li>IOCTL_DISK_*</li>\n<li>IOCTL_STORAGE_*</li>\n<li>FSCTL_*ï¼ˆé’ˆå¯¹æ–‡ä»¶ç³»ç»Ÿï¼‰</li>\n\n\n\n\n\n\n\n\n</ul>\n<p>IOCTLæ–‡æ¡£ï¼š<a href=\"https://learn.microsoft.com/zh-cn/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol\" rel=\"noopener nofollow\">deviceIoControl å‡½æ•° (ioapiset.h) - Win32 apps | Microsoft Learn</a>ã€<a href=\"https://learn.microsoft.com/zh-cn/windows/win32/api/winioctl/\" rel=\"noopener nofollow\">Winioctl.h æ ‡å¤´ - Win32 apps | Microsoft Learn</a></p>\n<p>ç£ç›˜ç®¡ç†è¯¦ç»†æ–‡æ¡£ï¼š<a href=\"https://learn.microsoft.com/zh-cn/windows/win32/fileio/disk-management\" rel=\"noopener nofollow\">ç£ç›˜ç®¡ç† - Win32 apps | Microsoft Learn</a></p>\n<p>WIN32æ–¹æ¡ˆï¼Œä¸ä¾èµ– VDS / WMI ç­‰ä¸Šå±‚æ¡†æ¶</p>\n<p>ä»…ä¾èµ–ï¼š</p>\n<ul>\n<li>Win32 å­ç³»ç»Ÿ + å†…æ ¸ I/O æ ˆ</li>\n<li>å¯¹åº”çš„è®¾å¤‡é©±åŠ¨ï¼ˆdisk.sys, storport.sys, nvme.sys ç­‰ï¼‰</li>\n\n\n\n\n\n\n\n\n</ul>\n<p>éœ€è¦åŸºäºWIN32APIä¸€å±‚å±‚å¤„ç†ç»†èŠ‚ï¼Œæ¯”å¦‚è·å–ç£ç›˜åˆ—è¡¨ï¼š</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\"> 1</span>     <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 2</span>     <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> é€šè¿‡ç£ç›˜ç¼–å·è·å–åºåˆ—å·SerialNumber\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 3</span>     <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 4</span>     <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"diskNumber\"&gt;</span><span style=\"color: rgba(0, 128, 0, 1);\">ç£ç›˜ç¼–å·</span><span style=\"color: rgba(128, 128, 128, 1);\">&lt;/param&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 5</span>     <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"volumeMaps\"&gt;&lt;/param&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 6</span>     <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 7</span>     <span style=\"color: rgba(0, 0, 255, 1);\">private</span> OperateResult&lt;LocalDisk&gt; GetDiskInfoByDiskNumber(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> diskNumber, Dictionary&lt;<span style=\"color: rgba(0, 0, 255, 1);\">int</span>, List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> volumeMaps)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 8</span> <span style=\"color: rgba(0, 0, 0, 1);\">    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 9</span>         <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">é€ä¸ªå°è¯• PhysicalDrive0..N</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">10</span>         <span style=\"color: rgba(0, 0, 255, 1);\">string</span> physicalDrive = <span style=\"color: rgba(128, 0, 0, 1);\">@\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\\\.\\PhysicalDrive</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> +<span style=\"color: rgba(0, 0, 0, 1);\"> diskNumber;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">11</span>         IntPtr hDisk =<span style=\"color: rgba(0, 0, 0, 1);\"> CreateFile(\n</span><span style=\"color: rgba(0, 128, 128, 1);\">12</span> <span style=\"color: rgba(0, 0, 0, 1);\">            physicalDrive,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">13</span> <span style=\"color: rgba(0, 0, 0, 1);\">            GENERIC_READ,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">14</span>             FILE_SHARE_READ | FILE_SHARE_WRITE |<span style=\"color: rgba(0, 0, 0, 1);\"> FILE_SHARE_DELETE,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">15</span> <span style=\"color: rgba(0, 0, 0, 1);\">            IntPtr.Zero,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">16</span> <span style=\"color: rgba(0, 0, 0, 1);\">            OPEN_EXISTING,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">17</span>             <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">18</span> <span style=\"color: rgba(0, 0, 0, 1);\">            IntPtr.Zero);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">19</span>         <span style=\"color: rgba(0, 0, 255, 1);\">try</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">20</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">21</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ä¸å­˜åœ¨è¿™ä¸ªç‰©ç†ç›˜ï¼ˆæˆ–è€…æ— æƒé™ï¼‰,å¿½ç•¥æ­¤å¼‚å¸¸</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">22</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (hDisk ==<span style=\"color: rgba(0, 0, 0, 1);\"> INVALID_HANDLE_VALUE)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">23</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">24</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;LocalDisk&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToSuccess();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">25</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">26</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> diskInfo = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> LocalDisk();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">27</span>             diskInfo.Number =<span style=\"color: rgba(0, 0, 0, 1);\"> diskNumber;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">28</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">29</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">è·å–ç£ç›˜åŸºç¡€ä¿¡æ¯</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">30</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> getDiskPropertiesResult =<span style=\"color: rgba(0, 0, 0, 1);\"> GetDiskProperties(hDisk);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">31</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">getDiskPropertiesResult.Success)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">32</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">33</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;LocalDisk&gt;.ToError($<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Get disk {physicalDrive} properties failed, {getDiskPropertiesResult.Message}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, getDiskPropertiesResult.Exception, getDiskPropertiesResult.Code);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">34</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">35</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> diskProperties =<span style=\"color: rgba(0, 0, 0, 1);\"> getDiskPropertiesResult.Data;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">36</span>             diskInfo.SerialNumber =<span style=\"color: rgba(0, 0, 0, 1);\"> diskProperties.SerialNumber;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">37</span>             diskInfo.DeviceName =<span style=\"color: rgba(0, 0, 0, 1);\"> diskProperties.DeviceName;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">38</span>             diskInfo.BusType =<span style=\"color: rgba(0, 0, 0, 1);\"> diskProperties.BusType;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">39</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">40</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">æ˜¯å¦åªè¯»/è”æœº</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">41</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> diskAttributesResult =<span style=\"color: rgba(0, 0, 0, 1);\"> GetDiskAttributes(hDisk);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">42</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">diskAttributesResult.Success)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">43</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">44</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;LocalDisk&gt;.ToError($<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Get disk {diskProperties.DeviceName} attributes failed, {diskAttributesResult.Message}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, diskAttributesResult.Exception, diskAttributesResult.Code);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">45</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">46</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> diskStorageAttributes =<span style=\"color: rgba(0, 0, 0, 1);\"> diskAttributesResult.Data;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">47</span>             diskInfo.IsReadOnly =<span style=\"color: rgba(0, 0, 0, 1);\"> diskStorageAttributes.IsReadOnly;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">48</span>             diskInfo.IsOffline =<span style=\"color: rgba(0, 0, 0, 1);\"> diskStorageAttributes.IsOffline;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">49</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">50</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">ç£ç›˜å®¹é‡</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">51</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> getDiskSizeResult =<span style=\"color: rgba(0, 0, 0, 1);\"> GetDiskSize(hDisk);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">52</span>             diskInfo.DiskSize =<span style=\"color: rgba(0, 0, 0, 1);\"> getDiskSizeResult.Data;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">53</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">54</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">è·å–åˆ†åŒºä¿¡æ¯</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">55</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> partitionInfoResult =<span style=\"color: rgba(0, 0, 0, 1);\"> GetPartitionInfo(hDisk);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">56</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">partitionInfoResult.Success)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">57</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">58</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;LocalDisk&gt;.ToError($<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Get disk {diskProperties.DeviceName} partition failed, {partitionInfoResult.Message}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, partitionInfoResult.Exception, partitionInfoResult.Code);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">59</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">60</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> diskPartitionInfo =<span style=\"color: rgba(0, 0, 0, 1);\"> partitionInfoResult.Data;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">61</span>             diskInfo.PartitionStyle =<span style=\"color: rgba(0, 0, 0, 1);\"> (DiskPartitionStyle)diskPartitionInfo.PartitionStyle;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">62</span>             diskInfo.PartitionCount =<span style=\"color: rgba(0, 0, 0, 1);\"> diskPartitionInfo.PartitionCount;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">63</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">åŸºç¡€æ•°æ®åŒºåˆ†å¤§å°</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">64</span>             diskInfo.DiskAllocateSize = diskPartitionInfo.Partitions.FirstOrDefault(i =&gt; i.PartitionType.ToUpper() == <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">EBD0A0A2-B9E5-4433-87C0-68B6B72699C7</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>)?.PartitionLength ?? <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">65</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">66</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">æŒ‚è½½è·¯å¾„</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">67</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (volumeMaps.TryGetValue(diskNumber, <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">var</span> mounts) &amp;&amp; mounts != <span style=\"color: rgba(0, 0, 255, 1);\">null</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">68</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">69</span>                 diskInfo.MountPaths =<span style=\"color: rgba(0, 0, 0, 1);\"> mounts;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">70</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">71</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">è·å–å·æ ‡åç§°</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">72</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span><span style=\"color: rgba(0, 0, 0, 1);\"> (diskInfo.MountPaths.Any())\n</span><span style=\"color: rgba(0, 128, 128, 1);\">73</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">74</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">é€šè¿‡ä»»æ„ä¸€ä¸ªmountPathè·å–</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">75</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">var</span> mountPath =<span style=\"color: rgba(0, 0, 0, 1);\"> diskInfo.MountPaths.First();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">76</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">var</span> getVolumeInfoResult =<span style=\"color: rgba(0, 0, 0, 1);\"> GetVolumeInfo(mountPath);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">77</span>                 diskInfo.Tag = getVolumeInfoResult.Data?.VolumeLabel ?? <span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.Empty;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">78</span>                 diskInfo.FileSystemType = getVolumeInfoResult.Data?.FileSystemType ?? <span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.Empty;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">79</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">80</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">ç£ç›˜å·²ä½¿ç”¨å¤§å°</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">81</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span><span style=\"color: rgba(0, 0, 0, 1);\"> (diskInfo.MountPaths.Any())\n</span><span style=\"color: rgba(0, 128, 128, 1);\">82</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">83</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">long</span> diskUsedSize = <span style=\"color: rgba(128, 0, 128, 1);\">0L</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">84</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">é€šè¿‡æ‰€æœ‰mountPathç›¸åŠ ,è·å–ç£ç›˜å·²ä½¿ç”¨å¤§å°</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">85</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">foreach</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> mountPath <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> diskInfo.MountPaths)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">86</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">87</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">var</span> usageByMountPathResult =<span style=\"color: rgba(0, 0, 0, 1);\"> GetDiskSizeUsageByMountPath(mountPath);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">88</span>                     diskUsedSize += usageByMountPathResult.Data?.UsedBytes ?? <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">89</span> <span style=\"color: rgba(0, 0, 0, 1);\">                }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">90</span>                 diskInfo.DiskUsedSize =<span style=\"color: rgba(0, 0, 0, 1);\"> diskUsedSize;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">91</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">92</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;LocalDisk&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToSuccess(diskInfo);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">93</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">94</span>         <span style=\"color: rgba(0, 0, 255, 1);\">finally</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">95</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">96</span> <span style=\"color: rgba(0, 0, 0, 1);\">            CloseHandle(hDisk);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">97</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">98</span>     }</pre>\n</div>\n<p>å…¶ä¸­ç£ç›˜å±æ€§è·å–ç»†èŠ‚ï¼Œå°±ä¸å±•ç¤ºäº†ï¼š</p>\n<div class=\"cnblogs_code\"><img class=\"code_img_closed\" id=\"code_img_closed_ed064c18-3858-41af-a354-0d53b9fb10bf\" src=\"https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif\" /><img class=\"code_img_opened\" id=\"code_img_opened_ed064c18-3858-41af-a354-0d53b9fb10bf\" src=\"https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif\" style=\"display: none;\" />\n<div class=\"cnblogs_code_hide\" id=\"cnblogs_code_open_ed064c18-3858-41af-a354-0d53b9fb10bf\">\n<pre><span style=\"color: rgba(0, 128, 128, 1);\">  1</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">  2</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> è·å–æ‰€æœ‰ç£ç›˜\n</span><span style=\"color: rgba(0, 128, 128, 1);\">  3</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">  4</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">  5</span>         <span style=\"color: rgba(0, 0, 255, 1);\">public</span> OperateResult&lt;List&lt;LocalDisk&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> GetDisks()\n</span><span style=\"color: rgba(0, 128, 128, 1);\">  6</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">  7</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 1. å…ˆæ‹¿å· -&gt; å·æ‰€å±çš„ç‰©ç†ç£ç›˜å· + ç›˜ç¬¦/æŒ‚è½½ç‚¹</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">  8</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> getVolumesResult =<span style=\"color: rgba(0, 0, 0, 1);\"> GetAllVolumeMountPaths();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">  9</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">getVolumesResult.Success)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 10</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 11</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;List&lt;LocalDisk&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToError(getVolumesResult.Message, getVolumesResult.Exception, getVolumesResult.Code);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 12</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 13</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> volumeMaps =<span style=\"color: rgba(0, 0, 0, 1);\"> getVolumesResult.Data;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 14</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 15</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 2. è·å–ç£ç›˜åˆ—è¡¨</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 16</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> diskList = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> List&lt;LocalDisk&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 17</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ ¹æ®å·ä¿¡æ¯æ¨ä¸€ä¸ªæœ€å¤§ç£ç›˜å·ï¼ŒåŒæ—¶è‡³å°‘æŸ¥è¯¢16 ä¸ª</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 18</span>             <span style=\"color: rgba(0, 0, 255, 1);\">int</span> maxDiskNumberCount = Math.Max(volumeMaps.Max(i =&gt; i.Key), <span style=\"color: rgba(128, 0, 128, 1);\">16</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 19</span>             <span style=\"color: rgba(0, 0, 255, 1);\">for</span> (<span style=\"color: rgba(0, 0, 255, 1);\">int</span> diskNumber = <span style=\"color: rgba(128, 0, 128, 1);\">0</span>; diskNumber &lt;= maxDiskNumberCount; diskNumber++<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 20</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 21</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">var</span> getDiskResult =<span style=\"color: rgba(0, 0, 0, 1);\"> GetDiskInfoByDiskNumber(diskNumber, volumeMaps);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 22</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">getDiskResult.Success)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 23</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 24</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">ç»“æŸæŸ¥è¯¢</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 25</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (diskNumber == maxDiskNumberCount - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 26</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 27</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">return</span> getDiskResult.ToResult&lt;List&lt;LocalDisk&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 28</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 29</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">ç»§ç»­æŸ¥è¯¢å…¶å®ƒ</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 30</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">continue</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 31</span> <span style=\"color: rgba(0, 0, 0, 1);\">                }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 32</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">å¯èƒ½ä¸ºç©º</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 33</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (getDiskResult.Data == <span style=\"color: rgba(0, 0, 255, 1);\">null</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 34</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 35</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">continue</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 36</span> <span style=\"color: rgba(0, 0, 0, 1);\">                }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 37</span> <span style=\"color: rgba(0, 0, 0, 1);\">                diskList.Add(getDiskResult.Data);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 38</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 39</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 40</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;List&lt;LocalDisk&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToSuccess(diskList);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 41</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 42</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 43</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 44</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> è·å–æ‰€æœ‰ç£ç›˜å·çš„æŒ‚è½½è·¯å¾„ä¿¡æ¯\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 45</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;remarks&gt;</span><span style=\"color: rgba(0, 128, 0, 1);\">é€šè¿‡æšä¸¾å·ï¼Œå¹¶ä½¿ç”¨ IOCTL_STORAGE_GET_DEVICE_NUMBER æ˜ å°„åˆ°è®¾å¤‡å·ã€‚</span><span style=\"color: rgba(128, 128, 128, 1);\">&lt;/remarks&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 46</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 47</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;</span><span style=\"color: rgba(0, 128, 0, 1);\">PhysicalDiskNumber -&gt; å¯¹åº”çš„æ‰€æœ‰æŒ‚è½½è·¯å¾„ï¼ˆç›˜ç¬¦ã€æŒ‚è½½ç‚¹ï¼‰</span><span style=\"color: rgba(128, 128, 128, 1);\">&lt;/returns&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 48</span>         <span style=\"color: rgba(0, 0, 255, 1);\">private</span> OperateResult&lt;Dictionary&lt;<span style=\"color: rgba(0, 0, 255, 1);\">int</span>, List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> GetAllVolumeMountPaths()\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 49</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 50</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> diskDict = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Dictionary&lt;<span style=\"color: rgba(0, 0, 255, 1);\">int</span>, List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 51</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 52</span>             <span style=\"color: rgba(0, 0, 255, 1);\">int</span> maxPath = <span style=\"color: rgba(128, 0, 128, 1);\">1024</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 53</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> volNameSb = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> StringBuilder(maxPath);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 54</span>             IntPtr findVolumeHandle = FindFirstVolumeW(volNameSb, (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span><span style=\"color: rgba(0, 0, 0, 1);\">)volNameSb.Capacity);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 55</span>             <span style=\"color: rgba(0, 0, 255, 1);\">try</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 56</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 57</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (findVolumeHandle == (IntPtr)(-<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 58</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 59</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;Dictionary&lt;<span style=\"color: rgba(0, 0, 255, 1);\">int</span>, List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToSuccess(diskDict);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 60</span> <span style=\"color: rgba(0, 0, 0, 1);\">                }\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 61</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">while</span> (<span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 62</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 63</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">string</span> volumeName =<span style=\"color: rgba(0, 0, 0, 1);\"> volNameSb.ToString();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 64</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> volumeName: \\\\?\\Volume{GUID}\\\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 65</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 66</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ‰“å¼€å·è®¾å¤‡</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 67</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">string</span> volumePathForDevice = volumeName.TrimEnd(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">\\\\</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>); <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> \\\\?\\Volume{GUID}</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 68</span>                     IntPtr hVolume =<span style=\"color: rgba(0, 0, 0, 1);\"> CreateFile(\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 69</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        volumePathForDevice,\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 70</span>                         <span style=\"color: rgba(128, 0, 128, 1);\">0</span>, <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> åªéœ€è¦ IOCTLï¼Œä¸è¯»å†™</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 71</span>                         FILE_SHARE_READ |<span style=\"color: rgba(0, 0, 0, 1);\"> FILE_SHARE_WRITE,\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 72</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        IntPtr.Zero,\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 73</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        OPEN_EXISTING,\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 74</span>                         <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 75</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        IntPtr.Zero);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 76</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 77</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">uint</span>? diskNumber = <span style=\"color: rgba(0, 0, 255, 1);\">null</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 78</span> \n<span style=\"color: rgba(0, 128, 128, 1);\"> 79</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (hVolume != (IntPtr)(-<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 80</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 81</span>                         <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> å– STORAGE_DEVICE_NUMBER</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 82</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">uint</span> size = (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span>)Marshal.SizeOf&lt;STORAGE_DEVICE_NUMBER&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 83</span>                         IntPtr outBuf = Marshal.AllocHGlobal((<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)size);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 84</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">try</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 85</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 86</span>                             <span style=\"color: rgba(0, 0, 255, 1);\">if</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DeviceIoControl(\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 87</span> <span style=\"color: rgba(0, 0, 0, 1);\">                                    hVolume,\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 88</span> <span style=\"color: rgba(0, 0, 0, 1);\">                                    IOCTL_STORAGE_GET_DEVICE_NUMBER,\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 89</span> <span style=\"color: rgba(0, 0, 0, 1);\">                                    IntPtr.Zero,\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 90</span>                                     <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 91</span> <span style=\"color: rgba(0, 0, 0, 1);\">                                    outBuf,\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 92</span> <span style=\"color: rgba(0, 0, 0, 1);\">                                    size,\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 93</span>                                     <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">uint</span><span style=\"color: rgba(0, 0, 0, 1);\"> bytesReturned,\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 94</span> <span style=\"color: rgba(0, 0, 0, 1);\">                                    IntPtr.Zero))\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 95</span> <span style=\"color: rgba(0, 0, 0, 1);\">                            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 96</span>                                 STORAGE_DEVICE_NUMBER devNum = Marshal.PtrToStructure&lt;STORAGE_DEVICE_NUMBER&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(outBuf);\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 97</span>                                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> DeviceType ä¸º FILE_DEVICE_DISK(0x07) ä¸€èˆ¬è¡¨ç¤ºç‰©ç†ç£ç›˜</span>\n<span style=\"color: rgba(0, 128, 128, 1);\"> 98</span>                                 diskNumber =<span style=\"color: rgba(0, 0, 0, 1);\"> devNum.DeviceNumber;\n</span><span style=\"color: rgba(0, 128, 128, 1);\"> 99</span> <span style=\"color: rgba(0, 0, 0, 1);\">                            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">100</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">101</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">finally</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">102</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">103</span> <span style=\"color: rgba(0, 0, 0, 1);\">                            Marshal.FreeHGlobal(outBuf);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">104</span> <span style=\"color: rgba(0, 0, 0, 1);\">                            CloseHandle(hVolume);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">105</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">106</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">107</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">108</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">if</span><span style=\"color: rgba(0, 0, 0, 1);\"> (diskNumber.HasValue)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">109</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">110</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!diskDict.TryGetValue((<span style=\"color: rgba(0, 0, 255, 1);\">int</span>)diskNumber.Value, <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">var</span><span style=\"color: rgba(0, 0, 0, 1);\"> list))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">111</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">112</span>                             list = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">113</span>                             diskDict[(<span style=\"color: rgba(0, 0, 255, 1);\">int</span>)diskNumber.Value] =<span style=\"color: rgba(0, 0, 0, 1);\"> list;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">114</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">115</span>                         <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> è·å–å·çš„æŒ‚è½½è·¯å¾„åˆ—è¡¨ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼‰</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">116</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">var</span> getMountPathsResult =<span style=\"color: rgba(0, 0, 0, 1);\"> GetMountPathsForVolume(volumeName);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">117</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">getMountPathsResult.Success)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">118</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">119</span>                             <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;Dictionary&lt;<span style=\"color: rgba(0, 0, 255, 1);\">int</span>, List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;&gt;&gt;.ToError($<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">ç£ç›˜{diskNumber}å·æŒ‚è½½è·¯å¾„è·å–å¤±è´¥, {getMountPathsResult.Message}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, getMountPathsResult.Exception, getMountPathsResult.Code);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">120</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">121</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">foreach</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> mp <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> getMountPathsResult.Data)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">122</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">123</span>                             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">list.Contains(mp))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">124</span> <span style=\"color: rgba(0, 0, 0, 1);\">                                list.Add(mp);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">125</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">126</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">127</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">128</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ä¸‹ä¸€å·</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">129</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    volNameSb.Clear();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">130</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    volNameSb.EnsureCapacity(maxPath);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">131</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">132</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!FindNextVolumeW(findVolumeHandle, volNameSb, (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span><span style=\"color: rgba(0, 0, 0, 1);\">)volNameSb.Capacity))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">133</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">134</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">int</span> err =<span style=\"color: rgba(0, 0, 0, 1);\"> Marshal.GetLastWin32Error();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">135</span>                         <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ERROR_NO_MORE_FILES</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">136</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (err == <span style=\"color: rgba(128, 0, 128, 1);\">18</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">137</span>                             <span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">138</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">139</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;Dictionary&lt;<span style=\"color: rgba(0, 0, 255, 1);\">int</span>, List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;&gt;&gt;.ToWin32Error(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">query disk volumes failed</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, err);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">140</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">141</span> <span style=\"color: rgba(0, 0, 0, 1);\">                }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">142</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">143</span>             <span style=\"color: rgba(0, 0, 255, 1);\">catch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Exception ex)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">144</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">145</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;Dictionary&lt;<span style=\"color: rgba(0, 0, 255, 1);\">int</span>, List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;&gt;&gt;.ToError(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">query disk volumes error</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, ex);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">146</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">147</span>             <span style=\"color: rgba(0, 0, 255, 1);\">finally</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">148</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">149</span> <span style=\"color: rgba(0, 0, 0, 1);\">                FindVolumeClose(findVolumeHandle);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">150</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">151</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;Dictionary&lt;<span style=\"color: rgba(0, 0, 255, 1);\">int</span>, List&lt;<span style=\"color: rgba(0, 0, 255, 1);\">string</span>&gt;&gt;&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToSuccess(diskDict);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">152</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">153</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">154</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">155</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> è·å–åˆ†åŒºä¿¡æ¯\n</span><span style=\"color: rgba(0, 128, 128, 1);\">156</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">157</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"hDisk\"&gt;&lt;/param&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">158</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">159</span>         <span style=\"color: rgba(0, 0, 255, 1);\">private</span> OperateResult&lt;DiskPartitionInfo&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> GetPartitionInfo(IntPtr hDisk)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">160</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">161</span>             <span style=\"color: rgba(0, 0, 255, 1);\">int</span> outSize = Marshal.SizeOf&lt;DRIVE_LAYOUT_INFORMATION_EX&gt;() + <span style=\"color: rgba(128, 0, 128, 1);\">128</span> * <span style=\"color: rgba(128, 0, 128, 1);\">64</span>; <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç»™å¤šä¸€ç‚¹ç©ºé—´</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">162</span>             IntPtr outBuffer =<span style=\"color: rgba(0, 0, 0, 1);\"> Marshal.AllocHGlobal(outSize);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">163</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">164</span>             <span style=\"color: rgba(0, 0, 255, 1);\">try</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">165</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">166</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">DeviceIoControl(\n</span><span style=\"color: rgba(0, 128, 128, 1);\">167</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        hDisk,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">168</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        IOCTL_DISK_GET_DRIVE_LAYOUT_EX,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">169</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        IntPtr.Zero,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">170</span>                         <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">171</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        outBuffer,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">172</span>                         (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span><span style=\"color: rgba(0, 0, 0, 1);\">)outSize,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">173</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">out</span><span style=\"color: rgba(0, 0, 0, 1);\"> _,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">174</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        IntPtr.Zero))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">175</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">176</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskPartitionInfo&gt;.ToWin32Error(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DeviceIoControl.IOCTL_DISK_GET_DRIVE_LAYOUT_EX failed</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, Marshal.GetLastWin32Error());\n</span><span style=\"color: rgba(0, 128, 128, 1);\">177</span> <span style=\"color: rgba(0, 0, 0, 1);\">                }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">178</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">179</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> åªå–ç»“æ„å¼€å¤´</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">180</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">var</span> layout = Marshal.PtrToStructure&lt;DRIVE_LAYOUT_INFORMATION_EX_HEADER&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(outBuffer);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">181</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">var</span> partitionInfo = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> DiskPartitionInfo()\n</span><span style=\"color: rgba(0, 128, 128, 1);\">182</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">183</span>                     PartitionCount = (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)layout.PartitionCount,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">184</span>                     PartitionStyle =<span style=\"color: rgba(0, 0, 0, 1);\"> layout.PartitionStyle,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">185</span>                     DiskId =<span style=\"color: rgba(0, 0, 0, 1);\"> layout.Gpt.DiskId,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">186</span>                     StartingUsableOffset =<span style=\"color: rgba(0, 0, 0, 1);\"> layout.Gpt.StartingUsableOffset,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">187</span>                     UsableLength =<span style=\"color: rgba(0, 0, 0, 1);\"> layout.Gpt.UsableLength,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">188</span>                     MaxPartitionCount =<span style=\"color: rgba(0, 0, 0, 1);\"> layout.Gpt.MaxPartitionCount\n</span><span style=\"color: rgba(0, 128, 128, 1);\">189</span> <span style=\"color: rgba(0, 0, 0, 1);\">                };\n</span><span style=\"color: rgba(0, 128, 128, 1);\">190</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> æŒ‡å‘ç¬¬ä¸€ä¸ª PARTITION_INFORMATION_EX çš„æŒ‡é’ˆï¼š</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">191</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">192</span>                 IntPtr pCurrent = IntPtr.Add(outBuffer, Marshal.SizeOf&lt;DRIVE_LAYOUT_INFORMATION_EX&gt;<span style=\"color: rgba(0, 0, 0, 1);\">());\n</span><span style=\"color: rgba(0, 128, 128, 1);\">193</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">int</span> partSize = Marshal.SizeOf&lt;PARTITION_INFORMATION_EX&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">194</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">for</span> (<span style=\"color: rgba(0, 0, 255, 1);\">int</span> i = <span style=\"color: rgba(128, 0, 128, 1);\">0</span>; i &lt; layout.PartitionCount; i++<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">195</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">196</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">var</span> part = Marshal.PtrToStructure&lt;PARTITION_INFORMATION_EX&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(pCurrent);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">197</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">var</span> item = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> PartitionEntryInfo\n</span><span style=\"color: rgba(0, 128, 128, 1);\">198</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">199</span>                         PartitionNumber = (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)part.PartitionNumber,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">200</span>                         StartingOffset =<span style=\"color: rgba(0, 0, 0, 1);\"> part.StartingOffset,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">201</span>                         PartitionLength =<span style=\"color: rgba(0, 0, 0, 1);\"> part.PartitionLength,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">202</span>                         PartitionType =<span style=\"color: rgba(0, 0, 0, 1);\"> part.Gpt.PartitionType.ToString(),\n</span><span style=\"color: rgba(0, 128, 128, 1);\">203</span>                         PartitionName =<span style=\"color: rgba(0, 0, 0, 1);\"> part.Gpt.Name\n</span><span style=\"color: rgba(0, 128, 128, 1);\">204</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    };\n</span><span style=\"color: rgba(0, 128, 128, 1);\">205</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">206</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    partitionInfo.Partitions.Add(item);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">207</span>                     pCurrent =<span style=\"color: rgba(0, 0, 0, 1);\"> IntPtr.Add(pCurrent, partSize);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">208</span> <span style=\"color: rgba(0, 0, 0, 1);\">                }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">209</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">210</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskPartitionInfo&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToSuccess(partitionInfo);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">211</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">212</span>             <span style=\"color: rgba(0, 0, 255, 1);\">finally</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">213</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">214</span> <span style=\"color: rgba(0, 0, 0, 1);\">                Marshal.FreeHGlobal(outBuffer);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">215</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">216</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">217</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">218</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">219</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> è·å–ç£ç›˜é™æ€å±æ€§\n</span><span style=\"color: rgba(0, 128, 128, 1);\">220</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">221</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"hDisk\"&gt;&lt;/param&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">222</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">223</span>         <span style=\"color: rgba(0, 0, 255, 1);\">private</span> OperateResult&lt;DiskStorageProperty&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> GetDiskProperties(IntPtr hDisk)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">224</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">225</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> storageProperties = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> DiskStorageProperty();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">226</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> query = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> STORAGE_PROPERTY_QUERY\n</span><span style=\"color: rgba(0, 128, 128, 1);\">227</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">228</span>                 PropertyId =<span style=\"color: rgba(0, 0, 0, 1);\"> STORAGE_PROPERTY_ID.StorageDeviceProperty,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">229</span>                 QueryType =<span style=\"color: rgba(0, 0, 0, 1);\"> STORAGE_QUERY_TYPE.PropertyStandardQuery,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">230</span>                 AdditionalParameters = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> <span style=\"color: rgba(0, 0, 255, 1);\">byte</span>[<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">]\n</span><span style=\"color: rgba(0, 128, 128, 1);\">231</span> <span style=\"color: rgba(0, 0, 0, 1);\">            };\n</span><span style=\"color: rgba(0, 128, 128, 1);\">232</span>             <span style=\"color: rgba(0, 0, 255, 1);\">uint</span> allocSize = <span style=\"color: rgba(128, 0, 128, 1);\">1024</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">233</span>             IntPtr buffer = Marshal.AllocHGlobal((<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)allocSize);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">234</span>             <span style=\"color: rgba(0, 0, 255, 1);\">try</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">235</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">236</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">DeviceIoControl(\n</span><span style=\"color: rgba(0, 128, 128, 1);\">237</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        hDisk,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">238</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        IOCTL_STORAGE_QUERY_PROPERTY,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">239</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">ref</span><span style=\"color: rgba(0, 0, 0, 1);\"> query,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">240</span>                         (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span>)Marshal.SizeOf&lt;STORAGE_PROPERTY_QUERY&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(),\n</span><span style=\"color: rgba(0, 128, 128, 1);\">241</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        buffer,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">242</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        allocSize,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">243</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">var</span><span style=\"color: rgba(0, 0, 0, 1);\"> bytesReturned,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">244</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        IntPtr.Zero))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">245</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">246</span>                     <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">è¯»å–å¤±è´¥</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">247</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">int</span> err =<span style=\"color: rgba(0, 0, 0, 1);\"> Marshal.GetLastWin32Error();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">248</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (err == ERROR_INSUFFICIENT_BUFFER &amp;&amp; bytesReturned &gt;<span style=\"color: rgba(0, 0, 0, 1);\"> allocSize)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">249</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">250</span>                         <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> é‡æ–°åˆ†é…æ›´å¤§ç¼“å†²åŒº</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">251</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        Marshal.FreeHGlobal(buffer);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">252</span>                         allocSize =<span style=\"color: rgba(0, 0, 0, 1);\"> bytesReturned;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">253</span>                         buffer = Marshal.AllocHGlobal((<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)allocSize);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">254</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">DeviceIoControl(\n</span><span style=\"color: rgba(0, 128, 128, 1);\">255</span> <span style=\"color: rgba(0, 0, 0, 1);\">                                hDisk,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">256</span> <span style=\"color: rgba(0, 0, 0, 1);\">                                IOCTL_STORAGE_QUERY_PROPERTY,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">257</span>                                 <span style=\"color: rgba(0, 0, 255, 1);\">ref</span><span style=\"color: rgba(0, 0, 0, 1);\"> query,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">258</span>                                 (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span>)Marshal.SizeOf&lt;STORAGE_PROPERTY_QUERY&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(),\n</span><span style=\"color: rgba(0, 128, 128, 1);\">259</span> <span style=\"color: rgba(0, 0, 0, 1);\">                                buffer,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">260</span> <span style=\"color: rgba(0, 0, 0, 1);\">                                allocSize,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">261</span>                                 <span style=\"color: rgba(0, 0, 255, 1);\">out</span><span style=\"color: rgba(0, 0, 0, 1);\"> bytesReturned,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">262</span> <span style=\"color: rgba(0, 0, 0, 1);\">                                IntPtr.Zero))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">263</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">264</span>                             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">é‡æ–°åˆ†é…ç¼“å†²åŒºï¼Œè¯»å–å¤±è´¥</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">265</span>                             <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskStorageProperty&gt;.ToWin32Error(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DeviceIoControl.IOCTL_STORAGE_QUERY_PROPERTY execute failed after adjust buffer size</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, Marshal.GetLastWin32Error());\n</span><span style=\"color: rgba(0, 128, 128, 1);\">266</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">267</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">268</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">else</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">269</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">270</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskStorageProperty&gt;.ToWin32Error(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DeviceIoControl.IOCTL_STORAGE_QUERY_PROPERTY execute failed</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, err);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">271</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">272</span> <span style=\"color: rgba(0, 0, 0, 1);\">                }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">273</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">274</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> è‡³å°‘è¦åŒ…å« Version/Size/å‡ ä¸ª offset</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">275</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (bytesReturned &lt; <span style=\"color: rgba(128, 0, 128, 1);\">24</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">276</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskStorageProperty&gt;.ToError($<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DeviceIoControl.IOCTL_STORAGE_QUERY_PROPERTY execute success but bytesReturned {bytesReturned} is lower than 24</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">277</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">278</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> --- è¯»å–å¤´éƒ¨å›ºå®šå­—æ®µï¼ˆæŒ‰å®˜æ–¹ C ç»“æ„æ‰‹å·¥åç§»ï¼‰---\n</span><span style=\"color: rgba(0, 128, 128, 1);\">279</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> Size    (ULONG) at offset 0x04</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">280</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">uint</span> size = (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span>)Marshal.ReadInt32(buffer, <span style=\"color: rgba(128, 0, 128, 1);\">4</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">281</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (size &gt; bytesReturned) size =<span style=\"color: rgba(0, 0, 0, 1);\"> bytesReturned;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">282</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">283</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç£ç›˜åºåˆ—å·ï¼ŒåŒ Get-Disk çš„ SerialNumber</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">284</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">uint</span> serialOffset = (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span>)Marshal.ReadInt32(buffer, <span style=\"color: rgba(128, 0, 128, 1);\">0x18</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">285</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">string</span> serialRaw =<span style=\"color: rgba(0, 0, 0, 1);\"> ReadAnsiStringSafe(buffer, size, serialOffset);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">286</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">string</span> serialClean =<span style=\"color: rgba(0, 0, 0, 1);\"> CleanSerialString(serialRaw);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">287</span>                 storageProperties.SerialNumber =<span style=\"color: rgba(0, 0, 0, 1);\"> serialClean;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">288</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">289</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç£ç›˜å‚å•†/åç§°ç›¸å…³</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">290</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">uint</span> vendorOffset = (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span>)Marshal.ReadInt32(buffer, <span style=\"color: rgba(128, 0, 128, 1);\">0x0C</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">291</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">uint</span> productOffset = (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span>)Marshal.ReadInt32(buffer, <span style=\"color: rgba(128, 0, 128, 1);\">0x10</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">292</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">uint</span> revisionOffset = (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span>)Marshal.ReadInt32(buffer, <span style=\"color: rgba(128, 0, 128, 1);\">0x14</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">293</span>                 storageProperties.Vendor =<span style=\"color: rgba(0, 0, 0, 1);\"> ReadAnsiStringSafe(buffer, size, vendorOffset);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">294</span>                 storageProperties.Product =<span style=\"color: rgba(0, 0, 0, 1);\"> ReadAnsiStringSafe(buffer, size, productOffset);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">295</span>                 storageProperties.Version =<span style=\"color: rgba(0, 0, 0, 1);\"> ReadAnsiStringSafe(buffer, size, revisionOffset);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">296</span>                 storageProperties.DeviceName = $<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">{storageProperties.Vendor} {storageProperties.Product}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">297</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> BusType</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">298</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">uint</span> busTypeOffset = (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span>)Marshal.ReadInt32(buffer, <span style=\"color: rgba(128, 0, 128, 1);\">0x1C</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">299</span>                 storageProperties.BusType = Enum.IsDefined(<span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(StorageBusType), (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)busTypeOffset)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">300</span>                     ?<span style=\"color: rgba(0, 0, 0, 1);\"> (StorageBusType)busTypeOffset\n</span><span style=\"color: rgba(0, 128, 128, 1);\">301</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    : StorageBusType.Unknown;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">302</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskStorageProperty&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToSuccess(storageProperties);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">303</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">304</span>             <span style=\"color: rgba(0, 0, 255, 1);\">catch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Exception ex)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">305</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">306</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskStorageProperty&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToError(ex);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">307</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">308</span>             <span style=\"color: rgba(0, 0, 255, 1);\">finally</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">309</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">310</span> <span style=\"color: rgba(0, 0, 0, 1);\">                Marshal.FreeHGlobal(buffer);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">311</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">312</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">313</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">314</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">315</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> è·å–ç£ç›˜å¤§å°ï¼ˆBytesï¼‰\n</span><span style=\"color: rgba(0, 128, 128, 1);\">316</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">317</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"hDisk\"&gt;&lt;/param&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">318</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">319</span>         <span style=\"color: rgba(0, 0, 255, 1);\">public</span> OperateResult&lt;<span style=\"color: rgba(0, 0, 255, 1);\">long</span>&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> GetDiskSize(IntPtr hDisk)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">320</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">321</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç”¨ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç¼“å†²åŒºï¼Œä¸€èˆ¬ 1024 å­—èŠ‚è¶³å¤Ÿ</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">322</span>             <span style=\"color: rgba(0, 0, 255, 1);\">const</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> bufferSize = <span style=\"color: rgba(128, 0, 128, 1);\">1024</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">323</span>             IntPtr buffer =<span style=\"color: rgba(0, 0, 0, 1);\"> Marshal.AllocHGlobal(bufferSize);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">324</span>             <span style=\"color: rgba(0, 0, 255, 1);\">try</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">325</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">326</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">bool</span> ok =<span style=\"color: rgba(0, 0, 0, 1);\"> DeviceIoControl(\n</span><span style=\"color: rgba(0, 128, 128, 1);\">327</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    hDisk,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">328</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    IOCTL_DISK_GET_DRIVE_GEOMETRY_EX,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">329</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    IntPtr.Zero,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">330</span>                     <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">331</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    buffer,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">332</span>                     (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span><span style=\"color: rgba(0, 0, 0, 1);\">)bufferSize,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">333</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">var</span><span style=\"color: rgba(0, 0, 0, 1);\"> bytesReturned,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">334</span> <span style=\"color: rgba(0, 0, 0, 1);\">                    IntPtr.Zero);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">335</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">ok)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">336</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;<span style=\"color: rgba(0, 0, 255, 1);\">long</span>&gt;.ToError(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DeviceIoControl.IOCTL_DISK_GET_DRIVE_GEOMETRY_EX failed</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, Marshal.GetLastWin32Error());\n</span><span style=\"color: rgba(0, 128, 128, 1);\">337</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (bytesReturned &lt; Marshal.SizeOf&lt;DISK_GEOMETRY_EX&gt;<span style=\"color: rgba(0, 0, 0, 1);\">())\n</span><span style=\"color: rgba(0, 128, 128, 1);\">338</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;<span style=\"color: rgba(0, 0, 255, 1);\">long</span>&gt;.ToSuccess(<span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">339</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">340</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">var</span> geomEx = Marshal.PtrToStructure&lt;DISK_GEOMETRY_EX&gt;<span style=\"color: rgba(0, 0, 0, 1);\">(buffer);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">341</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;<span style=\"color: rgba(0, 0, 255, 1);\">long</span>&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToSuccess(geomEx.DiskSize);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">342</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">343</span>             <span style=\"color: rgba(0, 0, 255, 1);\">catch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Exception e)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">344</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">345</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;<span style=\"color: rgba(0, 0, 255, 1);\">long</span>&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToError(e);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">346</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">347</span>             <span style=\"color: rgba(0, 0, 255, 1);\">finally</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">348</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">349</span> <span style=\"color: rgba(0, 0, 0, 1);\">                Marshal.FreeHGlobal(buffer);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">350</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">351</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">352</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">353</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">354</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> è·å–ç£ç›˜æ‰©å±•å±æ€§\n</span><span style=\"color: rgba(0, 128, 128, 1);\">355</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">356</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"hDisk\"&gt;&lt;/param&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">357</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">358</span>         <span style=\"color: rgba(0, 0, 255, 1);\">private</span> OperateResult&lt;DiskStorageAttribues&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> GetDiskAttributes(IntPtr hDisk)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">359</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">360</span>             <span style=\"color: rgba(0, 0, 255, 1);\">try</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">361</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">362</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">int</span> getSize = Marshal.SizeOf&lt;GET_DISK_ATTRIBUTES&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">363</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">var</span> getAttr = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> GET_DISK_ATTRIBUTES\n</span><span style=\"color: rgba(0, 128, 128, 1);\">364</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">365</span>                     Version = (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span>)getSize, <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> å…³é”®ï¼šVersion = sizeof(GET_DISK_ATTRIBUTES)</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">366</span>                     Reserved1 = <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">367</span>                     Attributes = <span style=\"color: rgba(128, 0, 128, 1);\">0</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">368</span> <span style=\"color: rgba(0, 0, 0, 1);\">                };\n</span><span style=\"color: rgba(0, 128, 128, 1);\">369</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">370</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">DeviceIoControl_DiskAttributes(\n</span><span style=\"color: rgba(0, 128, 128, 1);\">371</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        hDisk,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">372</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        IOCTL_DISK_GET_DISK_ATTRIBUTES,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">373</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">ref</span><span style=\"color: rgba(0, 0, 0, 1);\"> getAttr,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">374</span>                         (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span><span style=\"color: rgba(0, 0, 0, 1);\">)getSize,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">375</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">ref</span><span style=\"color: rgba(0, 0, 0, 1);\"> getAttr,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">376</span>                         (<span style=\"color: rgba(0, 0, 255, 1);\">uint</span><span style=\"color: rgba(0, 0, 0, 1);\">)getSize,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">377</span>                         <span style=\"color: rgba(0, 0, 255, 1);\">out</span><span style=\"color: rgba(0, 0, 0, 1);\"> _,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">378</span> <span style=\"color: rgba(0, 0, 0, 1);\">                        IntPtr.Zero))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">379</span> <span style=\"color: rgba(0, 0, 0, 1);\">                {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">380</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskStorageAttribues&gt;.ToWin32Error(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">IOCTL_DISK_GET_DISK_ATTRIBUTES å¤±è´¥</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, Marshal.GetLastWin32Error());\n</span><span style=\"color: rgba(0, 128, 128, 1);\">381</span> <span style=\"color: rgba(0, 0, 0, 1);\">                }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">382</span>                 <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">ç£ç›˜æ‰©å±•å±æ€§</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">383</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">var</span> diskStorageAttributes = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> DiskStorageAttribues();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">384</span>                 diskStorageAttributes.IsOffline = (getAttr.Attributes &amp; DISK_ATTRIBUTE_OFFLINE) != <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">385</span>                 diskStorageAttributes.IsReadOnly = (getAttr.Attributes &amp; DISK_ATTRIBUTE_READ_ONLY) != <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">386</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskStorageAttribues&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToSuccess(diskStorageAttributes);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">387</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">388</span>             <span style=\"color: rgba(0, 0, 255, 1);\">catch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Exception ex)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">389</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">390</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskStorageAttribues&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToError(ex);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">391</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">392</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">393</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">394</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">395</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> é€šè¿‡ä»»æ„æŒ‚è½½è·¯å¾„ï¼ˆç›˜ç¬¦ã€ç›®å½•æŒ‚è½½ç‚¹ã€Volume GUIDï¼‰è·å–å·å¤§å°ä¸ä½¿ç”¨é‡\n</span><span style=\"color: rgba(0, 128, 128, 1);\">396</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">397</span>         <span style=\"color: rgba(0, 0, 255, 1);\">private</span> OperateResult&lt;DiskSizeUsage&gt; GetDiskSizeUsageByMountPath(<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\"> mountPath)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">398</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">399</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.IsNullOrWhiteSpace(mountPath))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">400</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">401</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskSizeUsage&gt;.ToError($<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">parameter {nameof(mountPath)} is empty</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">402</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">403</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">404</span>             <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç¡®ä¿è·¯å¾„æœ«å°¾æœ‰åæ–œæ å¯¹æŸäº›åœºæ™¯æ›´ç¨³å¦¥</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">405</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!mountPath.EndsWith(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\\\</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">406</span>                 mountPath += <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\\\</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">407</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">408</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">GetDiskFreeSpaceExW(mountPath,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">409</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">var</span><span style=\"color: rgba(0, 0, 0, 1);\"> freeAvailable,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">410</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">var</span><span style=\"color: rgba(0, 0, 0, 1);\"> totalBytes,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">411</span>                     <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">var</span><span style=\"color: rgba(0, 0, 0, 1);\"> totalFreeBytes))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">412</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">413</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskSizeUsage&gt;.ToError(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">GetDiskFreeSpaceExW failed</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, Marshal.GetLastWin32Error());\n</span><span style=\"color: rgba(0, 128, 128, 1);\">414</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">415</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">416</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;DiskSizeUsage&gt;.ToSuccess(<span style=\"color: rgba(0, 0, 255, 1);\">new</span> DiskSizeUsage((<span style=\"color: rgba(0, 0, 255, 1);\">long</span>)totalBytes, (<span style=\"color: rgba(0, 0, 255, 1);\">long</span><span style=\"color: rgba(0, 0, 0, 1);\">)totalFreeBytes));\n</span><span style=\"color: rgba(0, 128, 128, 1);\">417</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">418</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">419</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">420</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> é€šè¿‡æŒ‚è½½è·¯å¾„è·å–å·ä¿¡æ¯\n</span><span style=\"color: rgba(0, 128, 128, 1);\">421</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">422</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"mountPath\"&gt;</span><span style=\"color: rgba(0, 128, 0, 1);\">ç›˜ç¬¦, e.g. \"E:\\\\\"</span><span style=\"color: rgba(128, 128, 128, 1);\">&lt;/param&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">423</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">424</span>         <span style=\"color: rgba(0, 0, 255, 1);\">private</span> OperateResult&lt;VolumeInfo&gt; GetVolumeInfo(<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\"> mountPath)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">425</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">426</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> volumeName = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> StringBuilder(<span style=\"color: rgba(128, 0, 128, 1);\">256</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">427</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> fileSystemType = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> StringBuilder(<span style=\"color: rgba(128, 0, 128, 1);\">256</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">428</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">429</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!mountPath.EndsWith(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\\\</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n</span><span style=\"color: rgba(0, 128, 128, 1);\">430</span>                 mountPath += <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\\\</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n</span><span style=\"color: rgba(0, 128, 128, 1);\">431</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> success =<span style=\"color: rgba(0, 0, 0, 1);\"> GetVolumeInformationW(\n</span><span style=\"color: rgba(0, 128, 128, 1);\">432</span> <span style=\"color: rgba(0, 0, 0, 1);\">                mountPath,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">433</span> <span style=\"color: rgba(0, 0, 0, 1);\">                volumeName, volumeName.Capacity,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">434</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">out</span> _, <span style=\"color: rgba(0, 0, 255, 1);\">out</span> _, <span style=\"color: rgba(0, 0, 255, 1);\">out</span><span style=\"color: rgba(0, 0, 0, 1);\"> _,\n</span><span style=\"color: rgba(0, 128, 128, 1);\">435</span> <span style=\"color: rgba(0, 0, 0, 1);\">                fileSystemType, fileSystemType.Capacity);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">436</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">success)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">437</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">438</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">int</span> err =<span style=\"color: rgba(0, 0, 0, 1);\"> Marshal.GetLastWin32Error();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">439</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;VolumeInfo&gt;.ToWin32Error($<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">GetVolumeInformationW get {mountPath} volume info failed</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, err);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">440</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">441</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">442</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> volumeInfo = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> VolumeInfo()\n</span><span style=\"color: rgba(0, 128, 128, 1);\">443</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">444</span>                 VolumeLabel =<span style=\"color: rgba(0, 0, 0, 1);\"> volumeName.ToString(),\n</span><span style=\"color: rgba(0, 128, 128, 1);\">445</span>                 FileSystemType =<span style=\"color: rgba(0, 0, 0, 1);\"> fileSystemType.ToString()\n</span><span style=\"color: rgba(0, 128, 128, 1);\">446</span> <span style=\"color: rgba(0, 0, 0, 1);\">            };\n</span><span style=\"color: rgba(0, 128, 128, 1);\">447</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;VolumeInfo&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToSuccess(volumeInfo);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">448</span> <span style=\"color: rgba(0, 0, 0, 1);\">        }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">449</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">450</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">451</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> é€šè¿‡æŒ‚è½½è·¯å¾„è·å–ç£ç›˜ä¿¡æ¯\n</span><span style=\"color: rgba(0, 128, 128, 1);\">452</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;para&gt;</span><span style=\"color: rgba(0, 128, 0, 1);\">å…ˆè·å–ç£ç›˜åˆ—è¡¨ï¼Œå†ç­›é€‰</span><span style=\"color: rgba(128, 128, 128, 1);\">&lt;/para&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">453</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">454</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"mountPath\"&gt;&lt;/param&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">455</span>         <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n<span style=\"color: rgba(0, 128, 128, 1);\">456</span>         <span style=\"color: rgba(0, 0, 255, 1);\">public</span> OperateResult&lt;LocalDisk&gt; GetDiskByMountPath(<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\"> mountPath)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">457</span> <span style=\"color: rgba(0, 0, 0, 1);\">        {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">458</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> getDisksResult =<span style=\"color: rgba(0, 0, 0, 1);\"> GetDisks();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">459</span>             <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1);\">getDisksResult.Success)\n</span><span style=\"color: rgba(0, 128, 128, 1);\">460</span> <span style=\"color: rgba(0, 0, 0, 1);\">            {\n</span><span style=\"color: rgba(0, 128, 128, 1);\">461</span>                 <span style=\"color: rgba(0, 0, 255, 1);\">return</span> getDisksResult.ToResult&lt;LocalDisk&gt;<span style=\"color: rgba(0, 0, 0, 1);\">();\n</span><span style=\"color: rgba(0, 128, 128, 1);\">462</span> <span style=\"color: rgba(0, 0, 0, 1);\">            }\n</span><span style=\"color: rgba(0, 128, 128, 1);\">463</span> \n<span style=\"color: rgba(0, 128, 128, 1);\">464</span>             <span style=\"color: rgba(0, 0, 255, 1);\">var</span> iscsiDisks = getDisksResult.Data.FirstOrDefault(i =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> i.MountPaths.Contains(mountPath));\n</span><span style=\"color: rgba(0, 128, 128, 1);\">465</span>             <span style=\"color: rgba(0, 0, 255, 1);\">return</span> OperateResult&lt;LocalDisk&gt;<span style=\"color: rgba(0, 0, 0, 1);\">.ToSuccess(iscsiDisks);\n</span><span style=\"color: rgba(0, 128, 128, 1);\">466</span>         }</pre>\n</div>\n<span class=\"cnblogs_code_collapse\">View Code</span></div>\n<p>åŒæ ·çš„éå†ç£ç›˜åˆ—è¡¨ï¼ˆ4å—ï¼‰ï¼Œé¦–æ¬¡è€—æ—¶20msï¼ŒäºŒæ¬¡æŸ¥è¯¢ä»…7msï¼š</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/685541/202601/685541-20260112203649643-1418202473.png\" /></p>\n<p>å°è£…WIN32ï¼Œå¼‚å¸¸ç åªæœ‰åŸºç¡€çš„Win32Exceptionå¼‚å¸¸ç ï¼Œä¸åƒPowershell Storageæœ‰ç›¸å¯¹ä¸Šå±‚æ›´å¤šçš„ä¸šåŠ¡å¼‚å¸¸ç å’Œå¼‚å¸¸æè¿°é‚£ä¹ˆå¥½ç†è§£ã€‚</p>\n<p>æ¯”å¦‚å¥æŸ„CreateFileå¤±è´¥,GetLastErrorå¼‚å¸¸ç æ˜¯&nbsp;0x00000002ï¼Œè½¬æ¢Win32Exceptionæè¿°ï¼šâ€œç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶â€ã€‚é¬¼çŸ¥é“æ˜¯å•¥é—®é¢˜ã€‚ã€‚ã€‚ç»“åˆä¸Šä¸‹æ–‡ï¼Œæ‰çŸ¥é“åŸæ¥ç£ç›˜IsOfflineçŠ¶æ€æ˜¯æ— æ³•æŸ¥æ‰¾å·ã€ä¹Ÿæ— æ³•åˆ›å»ºåˆ†åŒºè®¿é—®å¥æŸ„</p>\n<p>&nbsp;</p>\n<p><strong>å›åˆ°.NETç£ç›˜ç®¡ç†æ–¹æ¡ˆé€‰å‹ï¼Œ</strong></p>\n<p>æ²¡æœ‰å¤æ‚çš„Cç«¯ç¯å¢ƒçš„è¯ã€ä»…è¿ç»´ç­‰å›ºå®šåœºæ™¯ï¼Œç£ç›˜ç®¡ç†æ“ä½œå¯ä»¥ä½¿ç”¨Powersshell</p>\n<p>å¯¹ç£ç›˜æ“ä½œè¦æ±‚ç¨³å®šã€ä½†åˆæƒ³å¿«é€Ÿå®ç°åŠŸèƒ½ï¼Œè¾ƒå°‘çš„ç£ç›˜åŠŸèƒ½è°ƒç”¨ï¼Œæ¨èWMI</p>\n<p>å¯¹ç£ç›˜æ“ä½œè¦æ±‚ç¨³å®šã€æ€§èƒ½è¦æ±‚é«˜ï¼Œåšäº§å“çº§çš„å­˜å‚¨è½¯ä»¶ï¼Œæ¨èWIN32</p>\n<p>&nbsp;</p>\n<p>ç£ç›˜ç›¸å…³çš„å…¶å®ƒæ–‡ç« ï¼š</p>\n<p><a href=\"https://www.cnblogs.com/kybs0/p/18701464\">Windows æœ¬åœ°è™šæ‹Ÿç£ç›˜ - å”å®‹å…ƒæ˜æ¸…2188 - åšå®¢å›­</a></p>\n<a href=\"https://www.cnblogs.com/kybs0/p/18712317\">Windows ç½‘ç»œå­˜å‚¨ISCSIä»‹ç» - å”å®‹å…ƒæ˜æ¸…2188 - åšå®¢å›­</a><br />\n<p><a href=\"https://www.cnblogs.com/kybs0/p/18766881\">ç½‘ç»œè™šæ‹Ÿå­˜å‚¨ Iscsiå®ç°æ–¹æ¡ˆ - å”å®‹å…ƒæ˜æ¸…2188 - åšå®¢å›­</a></p>\n</div>\n<div id=\"MySignature\">\n    <div>ä½œè€…ï¼š<a href=\"http://www.cnblogs.com/kybs0/\" target=\"_blank\">å”å®‹å…ƒæ˜æ¸…2188</a></div>\n<div>å‡ºå¤„ï¼š<a href=\"http://www.cnblogs.com/kybs0/\" target=\"_blank\">http://www.cnblogs.com/kybs0/</a></div>\n<div>è®©å­¦ä¹ æˆä¸ºä¹ æƒ¯ï¼Œå‡è®¾æ˜å¤©å°±æœ‰é‡å¤§æœºé‡ç­‰ç€ä½ ï¼Œä½ å‡†å¤‡å¥½äº†ä¹ˆ</div>\n<div>æœ¬æ–‡ç‰ˆæƒå½’ä½œè€…å’Œåšå®¢å›­å…±æœ‰ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„å¿…é¡»åœ¨æ–‡ç« é¡µé¢ç»™å‡ºåŸæ–‡è¿æ¥ï¼Œå¦åˆ™ä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»çš„æƒåˆ©ã€‚ </div>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-12 23:50</span>&nbsp;\n<a href=\"https://www.cnblogs.com/kybs0\">å”å®‹å…ƒæ˜æ¸…2188</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">3</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "å¹¶å‘ï¼Œå¹¶è¡Œä¸å¼‚æ­¥",
      "link": "https://www.cnblogs.com/kklldog/p/19474533",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/kklldog/p/19474533\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-12 23:33\">\n    <span>å¹¶å‘ï¼Œå¹¶è¡Œä¸å¼‚æ­¥</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>åœ¨æˆ‘ä¸Šä¸€ç¯‡é¢˜ä¸ºã€Šä¸ºä»€ä¹ˆå¼‚æ­¥åœ¨IOæ“ä½œä¸‹æ‰æœ‰æ„ä¹‰ã€‹çš„æ–‡ç« å‘å¸ƒåï¼Œæ”¶åˆ°äº†å¾ˆå¤šåŒå­¦çš„åé¦ˆä¸æ¢è®¨ã€‚åœ¨æ·±å…¥äº¤æµåï¼Œæˆ‘å‘ç°ä¸€ä¸ªæ™®éçš„å›°æƒ‘ç‚¹æµ®ç°å‡ºæ¥ï¼Œå…¶æ ¹æºåœ¨äºæ··æ·†äº†â€œå¹¶å‘â€ã€â€œå¹¶è¡Œâ€ä¸â€œå¼‚æ­¥â€ï¼Œç‰¹åˆ«æ˜¯ä¸‹æ„è¯†åœ°å°†å¼‚æ­¥ç­‰åŒäºåˆ©ç”¨å¤šæ ¸CPUè¿›è¡Œå¹¶è¡Œå¤„ç†ã€‚</p>\n<p>ä¸ºäº†å½»åº•æ¾„æ¸…è¿™äº›åŸºç¡€ä½†è‡³å…³é‡è¦çš„æ¦‚å¿µï¼Œæˆ‘ä»¬æ·±å…¥å‰–æç†è®ºåŸåˆ™å¹¶ä¸”åŒæ—¶æŠ›å¼€æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ç°ä»£æ¡†æ¶ï¼ˆå¦‚.NETï¼‰ä¸­çš„å…·ä½“å®ç°ï¼ˆè¿™å¾€å¾€ä¼šè¯¯å¯¼ï¼‰ï¼Œä»¥è¾¨æå¹¶å‘ï¼ˆConcurrencyï¼‰ã€<strong>å¹¶è¡Œï¼ˆparallelï¼‰å’Œå¼‚æ­¥ï¼ˆAsynchronousï¼‰</strong>è¿™ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚</p>\n<h2 id=\"æ ¸å¿ƒæ¦‚å¿µè§£æ\">æ ¸å¿ƒæ¦‚å¿µè§£æ</h2>\n<h3 id=\"ä»€ä¹ˆæ˜¯å¹¶å‘concurrency\">ä»€ä¹ˆæ˜¯å¹¶å‘ï¼ˆConcurrencyï¼‰ï¼Ÿ</h3>\n<p><img alt=\"\" src=\"https://static.xbaby.xyz/blog/concurrency.jpg\" /></p>\n<ul>\n<li>\n<p>å®šä¹‰ï¼š å¹¶å‘æ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿæœ‰èƒ½åŠ›åœ¨ä¸€æ®µæ—¶é—´å†…å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚è¿™äº›ä»»åŠ¡çš„æ‰§è¡Œåœ¨å®è§‚ä¸Šæ˜¯é‡å çš„ï¼Œä½†åœ¨å¾®è§‚ä¸Šæ˜¯é€šè¿‡ä»»åŠ¡çš„äº¤æ›¿æ‰§è¡Œå®ç°çš„ã€‚</p>\n</li>\n<li>\n<p>ç²¾é«“ï¼š Goè¯­è¨€ä¹‹çˆ¶ Rob Pike å¯¹æ­¤æœ‰éå¸¸ç²¾è¾Ÿçš„è®ºè¿°ï¼šâ€œConcurrency is about dealing with lots of things at once.â€ï¼ˆå¹¶å‘æ˜¯å…³äºå¤„ç†å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›ï¼‰ã€‚è¿™é‡Œçš„å…³é”®è¯æ˜¯â€œdealing withâ€ï¼ˆå¤„ç†ï¼‰ï¼Œå®ƒå¼ºè°ƒçš„æ˜¯ä¸€ç§ç¨‹åºç»“æ„ï¼Œä½¿å…¶èƒ½å¤Ÿåº”å¯¹å’Œç®¡ç†å¤šä¸ªä»»åŠ¡æµã€‚</p>\n</li>\n<li>\n<p>ä¸¾ä¾‹è¯´æ˜ï¼š ä¸€ä¸ªé¤å…çªç„¶æ¥äº†ä¸‰ä¸ªå®¢äººï¼Œä½†é¤å…åªæœ‰ä¸€ä¸ªæœåŠ¡å‘˜ã€‚ä»æœåŠ¡å‘˜çš„è§’åº¦æ¥çœ‹ï¼Œä»–éœ€è¦åŒæ—¶æœåŠ¡è¿™äº›å®¢äººã€‚å½“ç„¶è¿™æ˜¯å®è§‚ä¸Šçš„åŒæ—¶ï¼Œå› ä¸ºæœåŠ¡å‘˜æ‰§è¡Œäº‹ä»¶çš„é€Ÿåº¦æ˜¯åœ¨æ˜¯å¤ªæ…¢äº†ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ä»€ä¹ˆæ˜¯å¹¶è¡Œparallel\">ä»€ä¹ˆæ˜¯å¹¶è¡Œï¼ˆparallelï¼‰ï¼Ÿ</h3>\n<p><img alt=\"\" src=\"https://static.xbaby.xyz/blog/%E5%B9%B6%E8%A1%8C.jpg\" /></p>\n<ul>\n<li>\n<p>å®šä¹‰ï¼š å¹¶è¡Œæ˜¯æŒ‡ç³»ç»Ÿèƒ½å¤Ÿåœ¨åŒä¸€ç‰©ç†æ—¶åˆ»çœŸæ­£åœ°åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚</p>\n</li>\n<li>\n<p>å‰æï¼š å¹¶è¡Œå¿…é¡»ä¾èµ–äºå¤šæ ¸CPUã€‚åœ¨å¤šæ ¸å¤„ç†å™¨ä¸Šï¼Œæ¯ä¸ªæ ¸å¿ƒå¯ä»¥åœ¨å®Œå…¨ç›¸åŒçš„æ—¶åˆ»ç‹¬ç«‹åœ°æ‰§è¡Œä¸€ä¸ªä¸åŒçš„ä»»åŠ¡æŒ‡ä»¤ï¼Œå®ç°ç‰©ç†æ„ä¹‰ä¸Šçš„â€œåŒæ—¶â€ã€‚</p>\n</li>\n<li>\n<p>ç²¾é«“ï¼š åŒæ ·å¼•ç”¨ Rob Pike çš„è®ºè¿°è¿›è¡Œå¯¹æ¯”ï¼šâ€œparallel is about doing lots of things at once.â€ï¼ˆå¹¶è¡Œæ˜¯å…³äºå®Œæˆå¤šä»¶äº‹æƒ…çš„èƒ½åŠ›ï¼‰ã€‚è¿™é‡Œçš„å…³é”®è¯æ˜¯â€œdoingâ€ï¼ˆå®Œæˆï¼‰ï¼Œå¼ºè°ƒçš„æ˜¯ç‰©ç†ä¸Šçš„åŒæ—¶æ‰§è¡Œï¼Œæ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„â€œä¸€èµ·åšâ€ã€‚</p>\n</li>\n<li>\n<p>ä¸¾ä¾‹ï¼š è¿˜æ˜¯é¤å…çš„ä¾‹å­ï¼Œä¸€ä¸ªé¤å…çªç„¶æ¥äº†ä¸‰ä¸ªå®¢äººï¼Œé¤å…è¿™æ¬¡æœ‰3ä¸ªæœåŠ¡å‘˜ï¼Œæ¯ä¸ªæœåŠ¡å‘˜æ­£å¥½æœåŠ¡ä¸€ä½å®¢äººã€‚è¿™å°±æ˜¯å¹¶è¡Œã€‚</p>\n</li>\n</ul>\n<h3 id=\"ä»€ä¹ˆæ˜¯å¼‚æ­¥asynchronous\">ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼ˆAsynchronousï¼‰ï¼Ÿ</h3>\n<p><img alt=\"\" src=\"https://static.xbaby.xyz/blog/async.jpg\" /></p>\n<ul>\n<li>\n<p>å®šä¹‰ï¼š å¼‚æ­¥æ˜¯ä¸€ç§ç¼–ç¨‹æ¨¡å‹æˆ–æ¨¡å¼ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯éé˜»å¡ï¼ˆNon-blockingï¼‰ã€‚å®ƒæè¿°çš„æ˜¯ä¸€ç§è°ƒç”¨è¡Œä¸ºï¼Œå°¤å…¶åœ¨å¤„ç†è€—æ—¶çš„I/Oæ“ä½œæ—¶ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æŸ¥è¯¢ã€æ–‡ä»¶è¯»å†™ï¼‰æ˜¾å¾—è‡³å…³é‡è¦ã€‚</p>\n</li>\n<li>\n<p>æœºåˆ¶ï¼š å½“ä¸€ä¸ªçº¿ç¨‹å‘èµ·ä¸€ä¸ªå¼‚æ­¥I/Oæ“ä½œæ—¶ï¼ˆä¾‹å¦‚ï¼Œåœ¨.NETä¸­è°ƒç”¨ await client.GetStringAsync(...)ï¼‰ï¼Œå®ƒå¹¶ä¸ä¼šåŸåœ°é˜»å¡ç­‰å¾…ã€‚å®é™…å‘ç”Ÿçš„è¿‡ç¨‹æ˜¯ï¼š</p>\n</li>\n</ul>\n<ol>\n<li>è¯¥çº¿ç¨‹å‘æ“ä½œç³»ç»Ÿå‘å‡ºI/Oè¯·æ±‚ï¼Œç„¶åç«‹å³è¿”å›ã€‚</li>\n<li>è¿™ä¸ªå®è´µçš„çº¿ç¨‹è¢«é‡Šæ”¾å›çº¿ç¨‹æ± ï¼Œå¯ä»¥ç«‹å³å»å¤„ç†å…¶ä»–çš„å·¥ä½œï¼Œæ¯”å¦‚å“åº”å¦ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ã€‚CPUå®Œå…¨æ²¡æœ‰è¢«é—²ç½®ã€‚</li>\n<li>I/Oæ“ä½œç”±ç¡¬ä»¶ï¼ˆå¦‚ç½‘å¡ã€ç£ç›˜æ§åˆ¶å™¨ï¼‰ç‹¬ç«‹å®Œæˆã€‚</li>\n<li>å½“æ“ä½œå®Œæˆåï¼Œç¡¬ä»¶ä¼šå‘CPUå‘é€ä¸€ä¸ªä¸­æ–­ä¿¡å·ã€‚</li>\n<li>æ“ä½œç³»ç»Ÿæ•è·è¿™ä¸ªä¸­æ–­ï¼Œå¹¶å°†ä¸€ä¸ªå®Œæˆäº‹ä»¶æ’å…¥é˜Ÿåˆ—ã€‚</li>\n<li>çº¿ç¨‹æ± ä¸­çš„æŸä¸ªå¯ç”¨çº¿ç¨‹ä¼šå–å‡ºè¿™ä¸ªäº‹ä»¶ï¼Œå¹¶ä»ä¹‹å‰ await çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œåç»­ä»£ç ã€‚</li>\n</ol>\n<ul>\n<li>\n<p>ç›®çš„ï¼š å¼‚æ­¥çš„ä¸»è¦ç›®æ ‡æ˜¯é¿å…åœ¨ç­‰å¾…I/Oå¯†é›†å‹æ“ä½œæ—¶æµªè´¹æ˜‚è´µçš„çº¿ç¨‹èµ„æºï¼Œä»è€Œç”¨å°‘é‡çš„çº¿ç¨‹å®ç°æé«˜çš„ç³»ç»Ÿååé‡å’Œå¯ä¼¸ç¼©æ€§ï¼ˆä¾‹å¦‚ï¼Œå¤„ç†æˆåƒä¸Šä¸‡çš„å¹¶å‘ç½‘ç»œè¿æ¥ï¼‰ã€‚å®ƒå…³æ³¨çš„æ˜¯è°ƒç”¨æ–¹çš„çº¿ç¨‹æ˜¯å¦è¢«é˜»å¡ï¼Œè€Œéä»»åŠ¡æ˜¯å¦åœ¨å¤šæ ¸ä¸ŠåŒæ—¶è¿è¡Œã€‚</p>\n</li>\n<li>\n<p>è¯¯åŒºæ¾„æ¸…ï¼š â€œAsynchronous is not Concurrency.â€ï¼ˆå¼‚æ­¥ä¸æ˜¯å¹¶å‘ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªæå…¶é‡è¦çš„åŒºåˆ†ã€‚å¼‚æ­¥æ˜¯ä¸€ç§å…è®¸ä»£ç ä»¥éçº¿æ€§ï¼ˆå¤šä»»åŠ¡è§’åº¦ï¼‰é¡ºåºæ­£ç¡®æ‰§è¡Œçš„å±æ€§ï¼Œå®ƒèƒ½å¤Ÿç”¨æ¥å®ç°å¹¶å‘ï¼Œä½†å…¶æœ¬èº«å¹¶éå¹¶å‘ã€‚å¼‚æ­¥å¯ä»¥åœ¨å•çº¿ç¨‹ä¸Šå®ç°ï¼ˆä¸€ä¸ªçº¿ç¨‹å‘èµ·è¯·æ±‚åå»åšåˆ«çš„äº‹ï¼‰ï¼Œè€Œå¹¶è¡Œåˆ™å¿…é¡»æ˜¯å¤šä¸ªçº¿ç¨‹åœ¨å¤šä¸ªCPUæ ¸å¿ƒä¸ŠåŒæ—¶æ‰§è¡Œã€‚</p>\n</li>\n<li>\n<p>ä¸¾ä¾‹ï¼š è¿˜æ˜¯é¤å…çš„ä¾‹å­ï¼Œä¸€ä¸ªé¤å…åŒæ—¶æ¥äº†ä¸‰ä¸ªå®¢äººï¼Œä¸‰ä¸ªæœåŠ¡å‘˜æ¯äººä¸€ä¸ªå®¢äººã€‚æœåŠ¡å‘˜åœ¨ä¸‹å®Œå•åæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š</p>\n</li>\n</ul>\n<ol>\n<li>åŒæ­¥ï¼šåœ¨åå¨é—¨å£å‚»ç­‰ï¼Œç›´åˆ°å‡ºé¤åé€åˆ°å®¢äººæ¡Œä¸Šã€‚</li>\n<li>å¼‚æ­¥ï¼šä¸‹å•åé©¬ä¸Šå»æ¥å¾…å…¶ä»–å®¢äººæˆ–è€…å¤„ç†å…¶ä»–äº‹æƒ…ï¼Œç­‰åå¨å¯¹è®²æœºé‡Œé€šçŸ¥èœçƒ§å¥½äº†æ‰å»å–é¤é€é¤ã€‚</li>\n</ol>\n<p><em>ï¼ï¼ï¼è¿™é‡Œè¯·å¤§å®¶æ³¨æ„ ï¼ï¼ï¼ï¼š</em></p>\n<blockquote>\n<p>å¼‚æ­¥æ¨¡å‹æˆ‘ä»¬å¼ºè°ƒçš„æ˜¯è¿™ä¸ªæœåŠ¡å‘˜è¢«é‡Šæ”¾å‡ºæ¥äº†ï¼Œä»–æ›´åŠ çµæ´»çš„è°ƒåº¦ï¼Œä»–å¯ä»¥åšæ›´å¤šçš„äº‹æ¥æé«˜é¤å…çš„è¿è¡Œæ•ˆç‡ã€‚è‡³äºåå¨åšèœè¿™ä»¶äº‹æ˜¯ä¸€ä¸ªå¨å¸ˆæ¥åšï¼Œè¿˜æ˜¯åä¸ªå¨å¸ˆæ¥åšé‚£æ˜¯å¦‚ä½•æ›´å¿«çš„åšèœçš„é—®é¢˜ã€‚è¿™è·Ÿå¼‚æ­¥è¿˜æ˜¯åŒæ­¥æ²¡æœ‰å…³ç³»ã€‚åŒæ­¥æ¨¡å¼ä¸‹åšèœè¿™ä»¶äº‹ä¹Ÿå¯ä»¥è¯·åä¸ªå¨å¸ˆæ¥åšè€ŒåŠ å¿«å‡ºé¤çš„é€Ÿåº¦ã€‚</p>\n</blockquote>\n<h2 id=\"ä¸‰è€…çš„å…³ç³»ä¸åŒºåˆ«\">ä¸‰è€…çš„å…³ç³»ä¸åŒºåˆ«</h2>\n<p>ä¸ºäº†æ›´ç›´è§‚åœ°ç†è§£å®ƒä»¬ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªè¡¨æ ¼æ¥å¯¹æ¯”ï¼š</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align: left;\">ç»´åº¦</th>\n<th style=\"text-align: left;\">å¹¶å‘ (Concurrency)</th>\n<th style=\"text-align: left;\">å¹¶è¡Œ (parallel)</th>\n<th style=\"text-align: left;\">å¼‚æ­¥ (Asynchronous)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\"><strong>æ ¸å¿ƒæ€æƒ³</strong></td>\n<td style=\"text-align: left;\">äº¤æ›¿æ‰§è¡Œï¼ˆé€»è¾‘ä¸ŠåŒæ—¶ï¼‰</td>\n<td style=\"text-align: left;\">åŒæ—¶æ‰§è¡Œï¼ˆç‰©ç†ä¸ŠåŒæ—¶ï¼‰</td>\n<td style=\"text-align: left;\">éé˜»å¡ä¸å›è°ƒ/ç»­å»¶</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>CPUè¦æ±‚</strong></td>\n<td style=\"text-align: left;\">å•æ ¸å³å¯</td>\n<td style=\"text-align: left;\">å¿…é¡»å¤šæ ¸</td>\n<td style=\"text-align: left;\">ä¸æ ¸å¿ƒæ•°æ— ç›´æ¥å…³ç³»</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>å¤„ç†æ–¹å¼</strong></td>\n<td style=\"text-align: left;\">OSè°ƒåº¦å™¨æ—¶é—´åˆ†ç‰‡</td>\n<td style=\"text-align: left;\">å¤šæ ¸ç‰©ç†æ‰§è¡Œ</td>\n<td style=\"text-align: left;\">å‘èµ·I/Oåé‡Šæ”¾çº¿ç¨‹</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\"><strong>è§£å†³é—®é¢˜</strong></td>\n<td style=\"text-align: left;\">åº”å¯¹é€»è¾‘ä¸Šéœ€è¦åŒæ—¶å¤„ç†å¤šä»»åŠ¡çš„åœºæ™¯</td>\n<td style=\"text-align: left;\">æå‡è®¡ç®—å¯†é›†å‹ä»»åŠ¡çš„æ‰§è¡Œæ•ˆç‡</td>\n<td style=\"text-align: left;\">é¿å…I/Oå¯†é›†å‹ä»»åŠ¡é˜»å¡ï¼Œæå‡ç³»ç»Ÿååé‡</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"æ€»ç»“\">æ€»ç»“</h2>\n<p>æ€»è€Œè¨€ä¹‹ï¼Œå¹¶å‘ã€å¹¶è¡Œå’Œå¼‚æ­¥æ˜¯ä»ä¸åŒç»´åº¦æè¿°ä»»åŠ¡æ‰§è¡Œæ–¹å¼çš„æ¦‚å¿µã€‚å¹¶å‘æ˜¯ä¸€ç§ç¨‹åºè®¾è®¡ç»“æ„ï¼Œä½¿å…¶èƒ½å¤Ÿé€»è¾‘ä¸Šå¤„ç†å¤šä¸ªä»»åŠ¡ï¼›å¹¶è¡Œæ˜¯åˆ©ç”¨ç¡¬ä»¶ï¼ˆå¤šæ ¸CPUï¼‰åœ¨ç‰©ç†ä¸ŠåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡çš„è®¡ç®—èƒ½åŠ›ï¼›è€Œå¼‚æ­¥æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œé€šè¿‡éé˜»å¡IOè°ƒç”¨æ¥æè‡´åœ°æé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ã€‚</p>\n<h2 id=\"å…³æ³¨æˆ‘çš„å…¬ä¼—å·ä¸€èµ·ç©è½¬æŠ€æœ¯\">å…³æ³¨æˆ‘çš„å…¬ä¼—å·ä¸€èµ·ç©è½¬æŠ€æœ¯</h2>\n<p><img alt=\"\" src=\"https://static.xbaby.xyz/qrcode.jpg\" /></p>\n\n</div>\n<div id=\"MySignature\">\n    <div id=\"AllanboltSignature\">        \n<p id=\"PSignature\">       \nQQç¾¤ï¼š1022985150 VXï¼škklldog ä¸€èµ·æ¢è®¨å­¦ä¹ .NETæŠ€æœ¯\n<br />\nä½œè€…ï¼š<a href=\"http://www.cnblogs.com/kklldog\" target=\"_blank\">Agile.Zhou(kklldog)</a>            \n<br /> \nå‡ºå¤„ï¼š<a href=\"http://www.cnblogs.com/kklldog/\" target=\"_blank\">http://www.cnblogs.com/kklldog/</a>\n<br />æœ¬æ–‡ç‰ˆæƒå½’ä½œè€…å’Œåšå®¢å›­å…±æœ‰ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„å¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼Œä¸”åœ¨æ–‡ç« é¡µé¢æ˜æ˜¾ä½ç½®ç»™å‡ºåŸæ–‡è¿æ¥ï¼Œå¦åˆ™ä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»çš„æƒåˆ©ã€‚\n </p>  \n</div>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-12 23:33</span>&nbsp;\n<a href=\"https://www.cnblogs.com/kklldog\">Agile.Zhou</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨‹äº”ï¼šè‡ªç„¶è¯­è¨€å¤„ç†  ç¬¬ä¸€å‘¨ï¼šå¾ªç¯ç¥ç»ç½‘ç»œ ï¼ˆå…­ï¼‰é•¿çŸ­æœŸè®°å¿† LSTM",
      "link": "https://www.cnblogs.com/Goblinscholar/p/19474433",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/Goblinscholar/p/19474433\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-12 22:25\">\n    <span>å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨‹äº”ï¼šè‡ªç„¶è¯­è¨€å¤„ç†  ç¬¬ä¸€å‘¨ï¼šå¾ªç¯ç¥ç»ç½‘ç»œ ï¼ˆå…­ï¼‰é•¿çŸ­æœŸè®°å¿† LSTM</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>æ­¤åˆ†ç±»ç”¨äºè®°å½•å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨‹çš„å­¦ä¹ ç¬”è®°ã€‚<br />\nè¯¾ç¨‹ç›¸å…³ä¿¡æ¯é“¾æ¥å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>åŸè¯¾ç¨‹è§†é¢‘é“¾æ¥ï¼š<a href=\"https://www.bilibili.com/video/BV1FT4y1E74V?buvid=XU762317353676D786954061C192FE625463B&amp;from_spmid=playlist.playlist-detail.0.0&amp;is_story_h5=false&amp;mid=zqernykrmpf7XfIorMR%2FnA%3D%3D&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=ce0bc526-db69-428a-962e-c65ed8c267bc&amp;share_source=COPY&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1713085655&amp;unique_k=DfBgvFW&amp;up_id=8654113&amp;vd_source=e035e9878d32f414b4354b839a4c31a4\" rel=\"noopener nofollow\" target=\"_blank\">[åŒè¯­å­—å¹•]å´æ©è¾¾æ·±åº¦å­¦ä¹ deeplearning.ai</a></li>\n<li>githubè¯¾ç¨‹èµ„æ–™ï¼Œå«è¯¾ä»¶ä¸ç¬”è®°:<a href=\"https://github.com/robbertliu/deeplearning.ai-andrewNG\" rel=\"noopener nofollow\" target=\"_blank\">å´æ©è¾¾æ·±åº¦å­¦ä¹ æ•™å­¦èµ„æ–™</a></li>\n<li>è¯¾ç¨‹é…å¥—ç»ƒä¹ ï¼ˆä¸­è‹±ï¼‰ä¸ç­”æ¡ˆï¼š<a href=\"https://blog.csdn.net/u013733326/article/details/79827273\" rel=\"noopener nofollow\" target=\"_blank\">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾åä¹ é¢˜ä¸ç­”æ¡ˆ</a></li>\n</ol>\n<p>æœ¬ç¯‡ä¸ºç¬¬äº”è¯¾çš„ç¬¬ä¸€å‘¨å†…å®¹ï¼Œ<a href=\"https://www.bilibili.com/video/BV1FT4y1E74V/?spm_id_from=333.788.videopod.episodes&amp;vd_source=e035e9878d32f414b4354b839a4c31a4&amp;p=160\" rel=\"noopener nofollow\" target=\"_blank\">1.10</a>çš„å†…å®¹ä»¥åŠä¸€äº›ç›¸å…³åŸºç¡€çš„è¡¥å……ã€‚</p>\n<hr />\n<p>æœ¬å‘¨ä¸ºç¬¬äº”è¯¾çš„ç¬¬ä¸€å‘¨å†…å®¹ï¼Œä¸ CV ç›¸å¯¹åº”çš„ï¼Œè¿™ä¸€è¯¾æ‰€æœ‰å†…å®¹çš„ä¸­å¿ƒåªæœ‰ä¸€ä¸ªï¼š<strong>è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNatural Language Processingï¼ŒNLPï¼‰</strong>ã€‚<br />\nåº”ç”¨åœ¨æ·±åº¦å­¦ä¹ é‡Œï¼Œå®ƒæ˜¯ä¸“é—¨ç”¨æ¥è¿›è¡Œ<strong>æ–‡æœ¬ä¸åºåˆ—ä¿¡æ¯å»ºæ¨¡</strong>çš„æ¨¡å‹å’ŒæŠ€æœ¯ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨å…¨è¿æ¥ç½‘ç»œä¸ç»Ÿè®¡è¯­è¨€æ¨¡å‹åŸºç¡€ä¸Šçš„ä¸€æ¬¡â€œç»“æ„åŒ–ç‰¹åŒ–â€ï¼Œä¹Ÿæ˜¯äººå·¥æ™ºèƒ½ä¸­<strong>æœ€è´´è¿‘äººç±»æ€ç»´è¡¨è¾¾æ–¹å¼</strong>çš„é‡è¦ç ”ç©¶æ–¹å‘ä¹‹ä¸€ã€‚<br />\n<strong>è¿™ä¸€æ•´èŠ‚è¯¾åŒæ ·æ¶‰åŠå¤§é‡éœ€è¦åå¤æ¶ˆåŒ–çš„å†…å®¹ï¼Œæ¨ªè·¨æœºå™¨å­¦ä¹ ã€æ¦‚ç‡ç»Ÿè®¡ã€çº¿æ€§ä»£æ•°ä»¥åŠè¯­è¨€å­¦ç›´è§‰ã€‚</strong><br />\nè¯­è¨€ä¸åƒå›¾åƒé‚£æ ·â€œç›´è§‚å¯è§â€ï¼Œæ›´å¤šæ˜¯æŠ½è±¡ç¬¦å·ä¸ä¸Šä¸‹æ–‡å…³ç³»çš„ç»„åˆï¼Œå› æ­¤<strong>ç†è§£é—¨æ§›åè€Œæ›´é«˜</strong>ã€‚<br />\nå› æ­¤ï¼Œæˆ‘åŒæ ·ä¼šå°½é‡è¡¥è¶³å¿…è¦çš„èƒŒæ™¯çŸ¥è¯†ï¼Œå°½å¯èƒ½ç”¨æ¯”å–»å’Œå®ä¾‹é™ä½ç†è§£éš¾åº¦ã€‚<br />\næœ¬ç¯‡çš„å†…å®¹å…³äº<strong>é•¿çŸ­æœŸè®°å¿† LSTM</strong>ï¼Œå®ƒå’Œ GRU ä¸€æ ·ï¼Œæ˜¯æˆåŠŸç¼“è§£ RNN çš„é•¿è·ç¦»ä¾èµ–é—®é¢˜ä¸”æµè¡Œè‡³ä»Šçš„æŠ€æœ¯ã€‚</p>\n<h1 id=\"1-ä»€ä¹ˆæ˜¯-lstmlong-short-term-memory\">1. ä»€ä¹ˆæ˜¯ LSTMï¼ˆLong Short-Term Memoryï¼‰ï¼Ÿ</h1>\n<p>åœ¨ <a href=\"https://www.cnblogs.com/Goblinscholar/p/19463351\" target=\"_blank\">GRU</a> ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼š<strong>é€šè¿‡é—¨æ§æœºåˆ¶å¯¹ä¿¡æ¯æµè¿›è¡Œé€‰æ‹©æ€§æ§åˆ¶ï¼Œç¡®å®å¯ä»¥æ˜¾è‘—ç¼“è§£ä¼ ç»Ÿ RNN çš„é•¿è·ç¦»ä¾èµ–é—®é¢˜</strong>ã€‚<br />\næ— è®ºæ˜¯æ›´æ–°é—¨å¯¹å†å²ä¿¡æ¯çš„ä¿ç•™ï¼Œè¿˜æ˜¯é‡ç½®é—¨å¯¹å½“å‰è¾“å…¥çš„å¼ºè°ƒï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨å›ç­”åŒä¸€ä¸ªé—®é¢˜ï¼š<strong>å“ªäº›ä¿¡æ¯å€¼å¾—è¢«ç»§ç»­ä¼ é€’ï¼Œå“ªäº›å¯ä»¥è¢«é—å¿˜ã€‚</strong></p>\n<p>ç„¶è€Œï¼Œä»æ›´é•¿æ—¶é—´è·¨åº¦çš„å»ºæ¨¡éœ€æ±‚æ¥çœ‹ï¼ŒGRU <strong>ä»ç„¶å­˜åœ¨ä¸€ä¸ªç»“æ„ä¸Šçš„å±€é™</strong>ï¼šå®ƒä¾ç„¶åªæœ‰<strong>å•ä¸€çš„éšè—çŠ¶æ€</strong>æ¥åŒæ—¶æ‰¿æ‹…â€œçŸ­æœŸè®¡ç®—ç»“æœâ€å’Œâ€œé•¿æœŸè®°å¿†è½½ä½“â€è¿™ä¸¤ç§è§’è‰²ã€‚<br />\nè¿™æ„å‘³ç€ï¼Œ<strong>å³ä¾¿å¼•å…¥äº†é—¨æ§æœºåˆ¶ï¼Œä¸åŒæ—¶é—´å°ºåº¦çš„ä¿¡æ¯ä»ç„¶è¢«è¿«æ··åˆåœ¨åŒä¸€æ¡çŠ¶æ€é€šé“ä¸­ä¼ é€’</strong>ï¼Œåœ¨æé•¿åºåˆ—æˆ–ç²¾ç»†æ—¶åºæ§åˆ¶çš„åœºæ™¯ä¸‹ï¼Œè¿™ç§è€¦åˆä»å¯èƒ½é™åˆ¶æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚</p>\n<p>è€Œ<strong>LSTM</strong>ä¾¿èƒ½åº”å¯¹è¿™ç±»é—®é¢˜ï¼Œæ—©åœ¨ <strong>1997</strong> å¹´ï¼ŒHochreiter å’Œ Schmidhuber åœ¨è®ºæ–‡ï¼š<a href=\"https://www.bioinf.jku.at/publications/older/2604.pdf\" rel=\"noopener nofollow\" target=\"_blank\">Long Short-Term Memory</a>ä¸­ï¼Œä¾¿ä»ç†è®ºå±‚é¢ç³»ç»Ÿæ€§åœ°åˆ†æäº† RNN ä¸­æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼Œå¹¶ç»™å‡ºäº†ä¸€ç§<strong>ç»“æ„æ€§è§£å†³æ–¹æ¡ˆ</strong>ï¼šé€šè¿‡æ˜¾å¼å¼•å…¥ä¸€æ¡<strong>ä¸“é—¨ç”¨äºé•¿æœŸä¿¡æ¯ä¼ é€’çš„è®°å¿†å•å…ƒï¼ˆcell stateï¼‰</strong>ï¼Œå¹¶é…åˆç²¾ç»†è®¾è®¡çš„é—¨æ§ç»“æ„ï¼Œä½¿å¾—å…³é”®ä¿¡æ¯å¯ä»¥åœ¨é•¿æ—¶é—´è·¨åº¦å†…å‡ ä¹ä¸å—å¹²æ‰°åœ°å‘å‰ä¼ æ’­ã€‚</p>\n<p>è¿™é‡Œè¦è¯´æ˜ä¸€ç‚¹ï¼Œä½ ä¼šå‘ç°ï¼šä»æ—¶é—´é¡ºåºä¸Šçœ‹ï¼Œ<strong>LSTM çš„æå‡ºæ—©äº GRU</strong>ã€‚<br />\nLSTM æ˜¯æœ€æ—©ä»ç»“æ„å±‚é¢ç³»ç»Ÿæ€§è§£å†³ RNN é•¿è·ç¦»ä¾èµ–é—®é¢˜çš„é—¨æ§å¾ªç¯å•å…ƒã€‚<br />\nè€Œ<strong>åœ¨ä¸Šä¸€ç¯‡æˆ‘ä»¬è¯´ GRU å¯ä»¥çœ‹ä½œ LSTM çš„ä¸€ç§ç®€åŒ–å½¢å¼</strong>ï¼Œæ­£æ˜¯å› ä¸ºå®ƒåœ¨ LSTM çš„åŸºç¡€ä¸Šåˆå¹¶äº†éƒ¨åˆ†é—¨æ§ç»“æ„ï¼Œå–æ¶ˆäº†æ˜¾å¼çš„è®°å¿†å•å…ƒï¼Œç”¨æ›´ç´§å‡‘çš„å½¢å¼å®ç°äº†ç›¸ä¼¼çš„å»ºæ¨¡ç›®æ ‡ã€‚</p>\n<p>ä¹Ÿæ­£å› ä¸ºè¿™ç§ç®€åŒ–ï¼ŒGRU åœ¨å‚æ•°æ•°é‡ã€è®¡ç®—å¼€é”€ä»¥åŠå·¥ç¨‹å®ç°å¤æ‚åº¦ä¸Šéƒ½æ›´ä¸ºå‹å¥½ã€‚<br />\nå› æ­¤ï¼Œåœ¨è®¸å¤šå®é™…ä»»åŠ¡ä¸­ï¼Œå½“åºåˆ—é•¿åº¦å¹¶æœªæç«¯æ‹‰é•¿ï¼Œæˆ–å¯¹é•¿æœŸè®°å¿†çš„ç²¾ç»†æ§åˆ¶è¦æ±‚ä¸é«˜æ—¶ï¼Œ<strong>GRU å¾€å¾€èƒ½å¤Ÿä»¥æ›´ä½çš„æˆæœ¬è·å¾—ä¸ LSTM æ¥è¿‘çš„æ€§èƒ½</strong>ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆï¼Œå°½ç®¡ LSTM åœ¨ç†è®ºä¸Šå…·å¤‡æ›´å¼ºçš„è¡¨è¾¾ä¸è®°å¿†èƒ½åŠ›ï¼Œ<strong>ç»“æ„æ›´ç®€å•çš„ GRU ä»ç„¶åœ¨å¤§é‡ NLP ä¸æ—¶åºå»ºæ¨¡åœºæ™¯ä¸­è¢«å¹¿æ³›é‡‡ç”¨</strong>ã€‚</p>\n<p>åŒæ ·ç®€å•è¿‡äº†è¿‡å†å²ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å±•å¼€ä»‹ç»ã€‚</p>\n<h2 id=\"11-gru-çš„ç†è®ºå±€é™\">1.1 GRU çš„ç†è®ºå±€é™</h2>\n<p>åœ¨ GRU ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼šé€šè¿‡å¼•å…¥æ›´æ–°é—¨å’Œé‡ç½®é—¨ï¼Œæ¨¡å‹ä¸å†è¢«åŠ¨åœ°â€œè®°ä½ä¸€åˆ‡â€ï¼Œè€Œæ˜¯å­¦ä¼šäº†<strong>é€‰æ‹©æ€§ä¿ç•™ä¸é€‰æ‹©æ€§ä½¿ç”¨å†å²ä¿¡æ¯</strong>ã€‚<br />\nè¿™ä½¿å¾— RNN åœ¨é•¿åºåˆ—å»ºæ¨¡ä¸­çš„è¡¨ç°å¾—åˆ°äº†æ˜¾è‘—æ”¹å–„ã€‚</p>\n<p>ä½†å¦‚æœæˆ‘ä»¬ç»§ç»­è¿½é—®ä¸€ä¸ªé—®é¢˜ï¼š<strong>è¿™äº›è¢«â€œç²¾å¿ƒç­›é€‰â€çš„å†å²ä¿¡æ¯ï¼Œåˆ°åº•è¢«å­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ</strong><br />\nç­”æ¡ˆæ˜¯ï¼š<strong>ä»ç„¶åœ¨åŒä¸€ä¸ªéšè—çŠ¶æ€é‡Œã€‚</strong></p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ GRU ä¸­ï¼šéšè—çŠ¶æ€æ—¢æ‰¿æ‹…<strong>å½“å‰è®¡ç®—ç»“æœ</strong>ï¼Œåˆæ‰¿æ‹…<strong>é•¿æœŸè®°å¿†è½½ä½“</strong>ã€‚<br />\nè¿™æ ·åšçš„ç»“æœå°±æ˜¯æˆ‘ä»¬åˆšåˆšæåˆ°çš„ï¼šæ‰€æœ‰ä¿¡æ¯ï¼Œæ— è®ºæ—¶é—´å°ºåº¦é•¿çŸ­ï¼Œæœ€ç»ˆéƒ½è¦â€œæŒ¤â€åœ¨åŒä¸€ä¸ªå‘é‡ä¸­ä¼ é€’ï¼Œå¯èƒ½é™åˆ¶æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚</p>\n<p>åœ¨å¤šæ•°ä»»åŠ¡ä¸­ï¼Œè¿™å·²ç»è¶³å¤Ÿæœ‰æ•ˆï¼Œä½†åœ¨<strong>æé•¿åºåˆ—ã€ç²¾ç»†æ—¶åºæ§åˆ¶æˆ–é•¿æœŸè¯­ä¹‰ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜</strong>çš„åœºæ™¯ä¸‹ï¼Œè¿™ç§â€œæ··åˆå­˜å‚¨â€ä»ç„¶å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚<br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260112222201121-1094822425.png\" /></p>\n<h2 id=\"12-lstm-çš„è®°å¿†ç»†èƒ\">1.2 LSTM çš„è®°å¿†ç»†èƒ</h2>\n<p>å®é™…ä¸Šï¼ŒLSTM çš„è®¾è®¡å°±èƒ½å¾ˆå¥½çš„è§£å†³åˆšåˆšçš„æ··åˆå­˜å‚¨é—®é¢˜ã€‚<br />\nå®ƒå¼•å…¥äº†ä¸€ä¸ª<strong>ç»“æ„å±‚é¢çš„æ”¹å˜</strong>ï¼š<strong>ä¸å†è®©åŒä¸€ä¸ªçŠ¶æ€åŒæ—¶è´Ÿè´£â€œé•¿æœŸè®°å¿†â€å’Œâ€œçŸ­æœŸè®¡ç®—â€ã€‚</strong></p>\n<p>ä¸ºæ­¤ï¼ŒLSTM æ˜ç¡®åŒºåˆ†äº†ä¸¤æ¡ä¿¡æ¯é€šé“ï¼š</p>\n<ul>\n<li><strong>ç»†èƒçŠ¶æ€ï¼ˆcell stateï¼‰ <span class=\"math inline\">\\(c^{}\\)</span></strong>  â†’ ä¸“é—¨è´Ÿè´£<strong>é•¿æœŸä¿¡æ¯çš„å­˜å‚¨ä¸ä¼ é€’ã€‚</strong></li>\n<li><strong>éšè—çŠ¶æ€ï¼ˆhidden stateï¼‰ <span class=\"math inline\">\\(a^{}\\)</span></strong>  â†’ è´Ÿè´£<strong>å½“å‰æ—¶åˆ»çš„è¾“å‡ºä¸çŸ­æœŸè®¡ç®—ã€‚</strong></li>\n</ul>\n<p>ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºï¼š</p>\n<blockquote>\n<p>éšè—çŠ¶æ€æ˜¯â€œå½“å‰è„‘å­é‡Œåœ¨æƒ³ä»€ä¹ˆâ€ï¼Œ<br />\nç»†èƒçŠ¶æ€æ˜¯â€œä¸€æ¡å‡ ä¹ä¸è¢«æ‰“æ‰°çš„é•¿æœŸå¤‡å¿˜å½•â€ã€‚</p>\n</blockquote>\n<p>è¿™ä¹Ÿæ˜¯ LSTM åå­—ä¸­ <strong>Long Short-Term</strong> çš„å«ä¹‰ï¼š  <strong>é•¿æœŸä¿¡æ¯ï¼ˆLong-Termï¼‰å’ŒçŸ­æœŸä¿¡æ¯ï¼ˆShort-Termï¼‰åœ¨ç»“æ„ä¸Šè¢«æ˜¾å¼åŒºåˆ†äº†ã€‚</strong><br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260112222133456-1134110847.png\" /><br />\næ‰“ä¸ªæ¯”æ–¹æ¥æ€»ç»“ GRU å’Œ LSTM çš„å·®åˆ«ï¼šGRUåƒæ˜¯åœ¨<strong>ä¸€å¼ çº¸ä¸Šåå¤ä¿®æ”¹å†…å®¹</strong>ï¼ŒLSTMåˆ™åƒæ˜¯<strong>å•ç‹¬å‡†å¤‡äº†ä¸€æœ¬ç¬”è®°æœ¬</strong>ã€‚</p>\n<h2 id=\"13-lstm-çš„é—¨æ§æœºåˆ¶\">1.3 LSTM çš„é—¨æ§æœºåˆ¶</h2>\n<p>æ—¢ç„¶å¼•å…¥äº†ä¸“é—¨çš„è®°å¿†ç»†èƒæ¥ä½œä¸º LSTM ä¸­çš„<strong>é•¿æœŸè®°å¿†é€šé“</strong>ï¼Œæ–°çš„é—®é¢˜è‡ªç„¶å‡ºç°äº†ï¼šè¿™æ¡è®°å¿†ï¼Œä»€ä¹ˆæ—¶å€™è¯¥ä¿ç•™ï¼Ÿ ä»€ä¹ˆæ—¶å€™è¯¥æ›´æ–°ï¼Ÿä»€ä¹ˆæ—¶å€™è¯¥è¾“å‡ºç»™å½“å‰è®¡ç®—ä½¿ç”¨ï¼Ÿ</p>\n<p>ç­”æ¡ˆä¾ç„¶æ˜¯ï¼š<strong>é—¨æ§æœºåˆ¶</strong>ã€‚<br />\nç®€å•æ¥è¯´ï¼ŒLSTM é€šè¿‡ä¸‰é“é—¨æ¥ç²¾ç»†æ§åˆ¶é•¿æœŸè®°å¿†ï¼š</p>\n<ol>\n<li><strong>é—å¿˜é—¨ï¼ˆForget Gateï¼‰</strong>ï¼šå†³å®šæ—§è®°å¿†ä¿ç•™å¤šå°‘ã€‚</li>\n<li><strong>è¾“å…¥é—¨ï¼ˆInput Gateï¼‰</strong>ï¼šå†³å®šæ–°ä¿¡æ¯å†™å…¥å¤šå°‘ã€‚</li>\n<li><strong>è¾“å‡ºé—¨ï¼ˆOutput Gateï¼‰</strong>ï¼šå†³å®šå½“å‰æ—¶åˆ»å¯¹å¤–æš´éœ²å¤šå°‘è®°å¿†ã€‚</li>\n</ol>\n<p><img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260112222316186-1000139547.png\" /></p>\n<p>ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™äº›é—¨çš„å­˜åœ¨ï¼Œ <strong>cell state æ‰èƒ½å¤Ÿåœ¨æ—¶é—´ç»´åº¦ä¸Šç¨³å®šæµåŠ¨ï¼Œè€Œä¸è¢«é¢‘ç¹æ”¹å†™</strong>ã€‚<br />\næœ‰äº† GRU çš„åŸºç¡€åï¼Œæˆ‘ä»¬å°±ä¸å†å•ç‹¬é€ä¸ªå±•å¼€æ¯é“é—¨çš„è¯­ä¹‰äº†ï¼Œåœ¨ä¸‹é¢çš„å®ç°éƒ¨åˆ†å†æ¥è¯¦ç»†å±•å¼€å®ƒä»¬çš„ä½œç”¨é€»è¾‘ã€‚</p>\n<h1 id=\"2-å¦‚ä½•å®ç°-lstm\">2. å¦‚ä½•å®ç° LSTMï¼Ÿ</h1>\n<p>åœ¨ä¹‹å‰çš„ GRU ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼š<strong>é—¨æ§çš„æœ¬è´¨ä¸æ˜¯å¢åŠ å¤æ‚åº¦ï¼Œè€Œæ˜¯ä¸ºâ€œä¿¡æ¯æ˜¯å¦ç»§ç»­å­˜åœ¨â€æä¾›å¯å­¦ä¹ çš„é€‰æ‹©æƒã€‚</strong></p>\n<p>LSTM åœ¨è¿™ä¸ªæ€æƒ³ä¸Šæ›´è¿›ä¸€æ­¥ï¼šå®ƒä¸å†è¯•å›¾è®©<strong>åŒä¸€ä¸ªçŠ¶æ€</strong>åŒæ—¶æ‰¿æ‹…â€œé•¿æœŸè®°å¿†â€å’Œâ€œå½“å‰è®¡ç®—â€ï¼Œ è€Œæ˜¯<strong>æ˜¾å¼å¼•å…¥äº†ä¸€æ¡å‡ ä¹çº¿æ€§ä¼ æ’­çš„é•¿æœŸè®°å¿†é€šé“â€”â€”ç»†èƒçŠ¶æ€ <span class=\"math inline\">\\(c^{\\langle t \\rangle}\\)</span></strong>ï¼Œå¹¶é€šè¿‡é—å¿˜é—¨ï¼Œè¾“å…¥é—¨å’Œè¾“å‡ºé—¨æ¥æ§åˆ¶ç»†èƒçŠ¶æ€ã€‚<br />\näº†è§£äº†åŸºæœ¬åŸç†åï¼Œç°åœ¨å°±æ¥çœ‹çœ‹ï¼Œåœ¨ä¸€ä¸ªæ—¶é—´æ­¥ <span class=\"math inline\">\\(t\\)</span>ï¼Œä¸€ä¸ªæ ‡å‡† LSTM å•å…ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚<br />\nå®é™…ä¸Šï¼Œå®ƒåªæ˜¯æ¯” GRU å¤šäº†äº›æ­¥éª¤ï¼Œåœ¨æœ‰äº† GRU çš„åŸºç¡€åï¼ŒLSTM çš„å®ç°å¹¶ä¸éš¾ç†è§£ï¼Œå…ˆæ‘†å‡ºå®ƒçš„å•å…ƒç»“æ„å›¾å¦‚ä¸‹ï¼š<br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260112222130915-556405424.png\" /><br />\nè¦å¼ºè°ƒçš„è¿˜æ˜¯æˆ‘ä»¬ä»‹ç»çš„è®¡ç®—é¡ºåºæ˜¯<strong>é€»è¾‘ä¸Šçš„å…ˆåé¡ºåº</strong>ï¼Œå®é™…ä¸Šå¾ˆå¤šæ­¥éª¤éƒ½æ˜¯å¯ä»¥åŒæ­¥è®¡ç®—çš„ã€‚</p>\n<h2 id=\"21-è®¡ç®—é—å¿˜é—¨forget-gate\">2.1 è®¡ç®—é—å¿˜é—¨ï¼ˆForget Gateï¼‰</h2>\n<p>LSTM çš„ç¬¬ä¸€æ­¥ï¼Œæ˜¯è®¡ç®— <strong>é—å¿˜é—¨</strong> <span class=\"math inline\">\\(f^{\\langle t \\rangle}\\)</span>ã€‚</p>\n<p>å®ƒçš„ä½œç”¨å°±ç›¸å½“äº GRU çš„é‡ç½®é—¨ï¼š<strong>å¯¹ä¸Šä¸€æ—¶åˆ»çš„ç»†èƒçŠ¶æ€ <span class=\"math inline\">\\(c^{\\langle t-1 \\rangle}\\)</span> è¿›è¡Œâ€œæŒ‰æ¯”ä¾‹ä¿ç•™â€ã€‚</strong><br />\nä½†è¦æ³¨æ„ï¼Œè¿™é‡Œæ˜¯â€œ<strong>ç»†èƒçŠ¶æ€</strong>â€ è€Œä¸æ˜¯ â€<strong>éšè—çŠ¶æ€</strong>â€œã€‚<br />\nè¿‡ç¨‹å¦‚ä¸‹ï¼š<br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260112222131252-989637007.png\" /><br />\nè®¡ç®—å…¬å¼è¿˜æ˜¯æ˜¯çº¿æ€§ç»„åˆï¼š</p>\n<p></p><div class=\"math display\">\\[f^{\\langle t \\rangle}  \n= sigmoid\\big( W_{xf} x^{\\langle t \\rangle} + W_{af} a^{\\langle t-1 \\rangle} + b_f \\big)  \n\\]</div><p></p><p>é—å¿˜é—¨å€¼çš„å«ä¹‰æ˜¯è¿™æ ·çš„ï¼š</p>\n<ul>\n<li><span class=\"math inline\">\\(f^{\\langle t \\rangle}_i \\approx 1\\)</span>ï¼šç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªè®°å¿†å•å…ƒå‡ ä¹<strong>å®Œå…¨ä¿ç•™</strong>ã€‚</li>\n<li><span class=\"math inline\">\\(f^{\\langle t \\rangle}_i \\approx 0\\)</span>ï¼šç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªè®°å¿†å•å…ƒè¢«<strong>ä¸»åŠ¨é—å¿˜</strong>ã€‚</li>\n</ul>\n<p>è¿™é‡Œå‡ºç°äº†æ–°çš„å†…å®¹éœ€è¦è¯´æ˜ï¼š<strong>ç»†èƒçŠ¶æ€ <span class=\"math inline\">\\(c^{\\langle t \\rangle}\\)</span> ä¸éšè—çŠ¶æ€ <span class=\"math inline\">\\(a^{\\langle t \\rangle}\\)</span> åœ¨ç»´åº¦ä¸Šæ˜¯ä¸€è‡´çš„</strong>ã€‚<br />\nè‹¥éšè—çŠ¶æ€æ˜¯ä¸€ä¸ª <span class=\"math inline\">\\(d\\)</span> ç»´å‘é‡ï¼Œé‚£ä¹ˆç»†èƒçŠ¶æ€åŒæ ·åŒ…å« <span class=\"math inline\">\\(d\\)</span> ä¸ª<strong>è®°å¿†å•å…ƒ</strong>ã€‚<br />\nå› æ­¤ï¼Œé—å¿˜é—¨ <span class=\"math inline\">\\(f^{\\langle t \\rangle}\\)</span> çš„æ¯ä¸€ä¸ªåˆ†é‡ <span class=\"math inline\">\\(f_i^{\\langle t \\rangle}\\)</span>ï¼Œå¹¶ä¸æ˜¯æ§åˆ¶â€œä¸€æ•´æ®µè®°å¿†â€ï¼Œè€Œæ˜¯<strong>ç‹¬ç«‹æ§åˆ¶ç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªè®°å¿†å•å…ƒåœ¨æ—¶é—´ç»´åº¦ä¸Šçš„ä¿ç•™æ¯”ä¾‹</strong>ã€‚</p>\n<p>å†ç»“åˆä¸€ä¸‹ GRU ï¼Œä½ ä¼šå‘ç°ï¼Œè¿™æ®µé€»è¾‘åœ¨GRUä¸­ä»¥é‡ç½®é—¨çš„å½¢å¼å®Œæ•´ä¿ç•™äº†ã€‚</p>\n<h2 id=\"22-è®¡ç®—è¾“å…¥é—¨input-gate\">2.2 è®¡ç®—è¾“å…¥é—¨ï¼ˆInput Gateï¼‰</h2>\n<p>LSTM çš„ç¬¬äºŒæ­¥ï¼Œæ˜¯è®¡ç®— <strong>è¾“å…¥é—¨</strong> <span class=\"math inline\">\\(i^{\\langle t \\rangle}\\)</span>ã€‚</p>\n<p>å®ƒçš„ä½œç”¨æ˜¯ï¼š<strong>å†³å®šå½“å‰æ­¥ç”Ÿæˆçš„æ–°ä¿¡æ¯æœ‰å¤šå°‘å¯ä»¥å†™å…¥ç»†èƒçŠ¶æ€ <span class=\"math inline\">\\(c^{\\langle t \\rangle}\\)</span></strong>ã€‚<br />\næ¢å¥è¯è¯´ï¼Œå®ƒæ§åˆ¶äº†â€œæ–°è®°å¿†æ›´æ–°æ¯”ä¾‹â€ï¼Œåœ¨åŠŸèƒ½ä¸Šç±»ä¼¼ GRU çš„æ›´æ–°é—¨ï¼Œä½†åœ¨ LSTM ä¸­ï¼Œå®ƒåªè´Ÿè´£ <strong>æ–°ä¿¡æ¯å†™å…¥</strong>ï¼Œè€Œå†å²ä¿¡æ¯ä¿ç•™ç”±é—å¿˜é—¨æ§åˆ¶ã€‚</p>\n<p>è¿‡ç¨‹å¦‚ä¸‹ï¼š<br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260112222315717-85455316.png\" /><br />\nå…¬å¼è¡¨ç¤ºä¸ºï¼š</p>\n<p></p><div class=\"math display\">\\[i^{\\langle t \\rangle} = sigmoid\\big( W_{xi} x^{\\langle t \\rangle} + W_{ai} a^{\\langle t-1 \\rangle} + b_i \\big)  \n\\]</div><p></p><p>è¾“å…¥é—¨å€¼çš„è¯­ä¹‰åŒæ ·æ¸…æ™°ï¼š</p>\n<ul>\n<li><span class=\"math inline\">\\(i_i^{\\langle t \\rangle} \\approx 1\\)</span>ï¼šç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªè®°å¿†å•å…ƒå‡ ä¹<strong>å…¨éƒ¨æ¥æ”¶æ–°ä¿¡æ¯</strong>ã€‚</li>\n<li><span class=\"math inline\">\\(i_i^{\\langle t \\rangle} \\approx 0\\)</span>ï¼šç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªè®°å¿†å•å…ƒå‡ ä¹<strong>ä¸å†™å…¥æ–°ä¿¡æ¯</strong>ã€‚</li>\n</ul>\n<p>åŒæ ·åœ°ï¼Œè¾“å…¥é—¨ <span class=\"math inline\">\\(i^{\\langle t \\rangle}\\)</span> ä¸ç»†èƒçŠ¶æ€ <span class=\"math inline\">\\(c^{\\langle t \\rangle}\\)</span> çš„ç»´åº¦ä¸€è‡´ï¼Œæ¯ä¸ªåˆ†é‡ç‹¬ç«‹æ§åˆ¶å¯¹åº”è®°å¿†å•å…ƒçš„å†™å…¥æ¯”ä¾‹ã€‚<br />\nè¿™æ ·åšå¯ä»¥ä¿è¯ <strong>é•¿æœŸè®°å¿†åœ¨æ—¶é—´ç»´åº¦ä¸Šæ—¢ä¿ç•™é‡è¦ä¿¡æ¯ï¼ŒåˆæŒ‰éœ€æ›´æ–°æ–°å†…å®¹</strong>ï¼Œå®ç°æ›´ç²¾ç»†çš„è®°å¿†ç®¡ç†ã€‚</p>\n<h2 id=\"23-è®¡ç®—å€™é€‰ç»†èƒçŠ¶æ€candidate-cell-state\">2.3 è®¡ç®—å€™é€‰ç»†èƒçŠ¶æ€ï¼ˆCandidate Cell Stateï¼‰</h2>\n<p>è¿˜æ˜¯è¦å…ˆå¼ºè°ƒä¸€ç‚¹ï¼Œè¿™æ˜¯â€œ<strong>å€™é€‰ç»†èƒçŠ¶æ€</strong>â€ï¼Œä¸æ˜¯â€œ<strong>å€™é€‰éšè—çŠ¶æ€</strong>â€ã€‚åˆ°è¿™ä¸€æ­¥ï¼Œéšè—çŠ¶æ€è¿˜æ²¡æœ‰å‡ºåœºã€‚</p>\n<p>åœ¨è®¡ç®—å®Œè¾“å…¥é—¨ <span class=\"math inline\">\\(i^{\\langle t \\rangle}\\)</span> ä¹‹åï¼ŒLSTM çš„ä¸‹ä¸€æ­¥æ˜¯ç”Ÿæˆ <strong>å€™é€‰ç»†èƒçŠ¶æ€</strong> <span class=\"math inline\">\\(\\tilde{c}^{\\langle t \\rangle}\\)</span>ã€‚<br />\nå®ƒçš„ä½œç”¨æ˜¯ï¼š<strong>è¡¨ç¤ºå½“å‰æ­¥çš„æ–°ä¿¡æ¯å†…å®¹</strong>ï¼Œç”±å½“å‰è¾“å…¥ <span class=\"math inline\">\\(x^{\\langle t \\rangle}\\)</span> å’Œä¸Šä¸€æ—¶åˆ»éšè—çŠ¶æ€ <span class=\"math inline\">\\(a^{\\langle t-1 \\rangle}\\)</span> å…±åŒå†³å®šï¼Œä½†å°šæœªå†™å…¥ç»†èƒçŠ¶æ€ <span class=\"math inline\">\\(c^{\\langle t \\rangle}\\)</span>ã€‚<br />\næ¢å¥è¯è¯´ï¼Œå€™é€‰ç»†èƒçŠ¶æ€å°±æ˜¯ <strong>å‡†å¤‡å¥½å¯ä»¥å†™å…¥çš„â€œæ–°è®°å¿†â€</strong>ã€‚<br />\nè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š<br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260112222130982-1988780214.png\" /></p>\n<p>å…¬å¼è¡¨ç¤ºä¸ºï¼š</p>\n<p></p><div class=\"math display\">\\[\\tilde{c}^{\\langle t \\rangle} = \\tanh\\big( W_{xc} x^{\\langle t \\rangle} + W_{ac} a^{\\langle t-1 \\rangle} + b_c \\big)  \n\\]</div><p></p><p>åˆ°åä¸‹ä¸€æ­¥ä½ å°±ä¼šå‘ç°ï¼šå€™é€‰çŠ¶æ€æœ¬èº«å¹¶ä¸ç›´æ¥å½±å“æœ€ç»ˆè¾“å‡ºï¼Œå®ƒåªæ˜¯è¡¨ç¤ºâ€œæœ‰å¤šå°‘æ–°è®°å¿†â€ï¼Œè€Œ<strong>è¾“å…¥é—¨ <span class=\"math inline\">\\(i^{\\langle t \\rangle}\\)</span></strong> æ‰å†³å®šâ€œå†™å…¥å¤šå°‘æ–°è®°å¿†â€œã€‚<br />\nè¿™æ®µè®¾è®¡ä¸åŒäº GRUï¼š<strong>LSTM å°†â€œæ–°ä¿¡æ¯ç”Ÿæˆâ€å’Œâ€œæ–°ä¿¡æ¯å†™å…¥â€æ˜ç¡®åˆ†ç¦»</strong>ï¼Œæ–¹ä¾¿é€šè¿‡é—¨æ§ç²¾ç»†æ§åˆ¶è®°å¿†æ›´æ–°ã€‚</p>\n<h2 id=\"24-æ›´æ–°ç»†èƒçŠ¶æ€\">2.4 æ›´æ–°ç»†èƒçŠ¶æ€</h2>\n<p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†è¿™æ ·ä¸œè¥¿ï¼š</p>\n<ul>\n<li>ä¸Šä¸€æ—¶åˆ»çš„ç»†èƒçŠ¶æ€ <span class=\"math inline\">\\(c^{\\langle t-1 \\rangle}\\)</span>ï¼ˆæ—§é•¿æœŸè®°å¿†ï¼‰</li>\n<li>é—å¿˜é—¨ <span class=\"math inline\">\\(f^{\\langle t \\rangle}\\)</span>ï¼ˆä¿ç•™æ¯”ä¾‹ï¼‰</li>\n<li>è¾“å…¥é—¨ <span class=\"math inline\">\\(i^{\\langle t \\rangle}\\)</span> ä¸å€™é€‰è®°å¿† <span class=\"math inline\">\\(\\tilde{c}^{\\langle t \\rangle}\\)</span>ï¼ˆæ–°ä¿¡æ¯ï¼‰<br />\nLSTM ä¼šç”¨ä¸‹é¢è¿™ä¸ª<strong>æ ¸å¿ƒå…¬å¼</strong>æ¥æ›´æ–°é•¿æœŸè®°å¿†ï¼š</li>\n</ul>\n<p></p><div class=\"math display\">\\[c^{\\langle t \\rangle}  \n= f^{\\langle t \\rangle} \\odot c^{\\langle t-1 \\rangle}\n+ i^{\\langle t \\rangle} \\odot \\tilde{c}^{\\langle t \\rangle}  \n\\]</div><p></p><p><img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260112222315839-1698415516.png\" /></p>\n<p>è¿™ä¸ªå…¬å¼çš„æ„ä¹‰ä¹Ÿéå¸¸ç›´è§‚ï¼š</p>\n<ul>\n<li>ç¬¬ä¸€é¡¹ï¼š<strong>ä¿ç•™å¤šå°‘æ—§è®°å¿†</strong>ã€‚</li>\n<li>ç¬¬äºŒé¡¹ï¼š<strong>å†™å…¥å¤šå°‘æ–°è®°å¿†</strong>ã€‚<br />\nä¹Ÿæ­£æ˜¯å› ä¸ºè¿™é‡Œå­˜åœ¨ä¸€æ¡è¿‘ä¼¼â€œç›´é€šâ€çš„è·¯å¾„ï¼Œè®©æ¢¯åº¦å¯ä»¥ç›´æ¥ä» <span class=\"math inline\">\\(c^{\\langle t \\rangle}\\)</span> å›ä¼ åˆ° <span class=\"math inline\">\\(c^{\\langle t-1 \\rangle}\\)</span> ï¼Œ <strong>ç»†èƒçŠ¶æ€æ‰èƒ½åœ¨æ—¶é—´ç»´åº¦ä¸Šç¨³å®šä¼ æ’­ï¼Œæ¢¯åº¦ä¹Ÿä¸å®¹æ˜“è¡°å‡ã€‚</strong></li>\n</ul>\n<h2 id=\"35-è®¡ç®—è¾“å‡ºé—¨output-gate\">3.5 è®¡ç®—è¾“å‡ºé—¨ï¼ˆOutput Gateï¼‰</h2>\n<p>éœ€è¦ç‰¹åˆ«å¼ºè°ƒçš„æ˜¯ï¼š  <strong>ç»†èƒçŠ¶æ€å¹¶ä¸ç›´æ¥ä½œä¸ºæ¨¡å‹è¾“å‡ºã€‚</strong><br />\nåœ¨ä¹‹å‰å‡ æ­¥å®Œæˆäº†å¯¹ç»†èƒçŠ¶æ€çš„æ›´æ–°ï¼Œæˆ‘ä»¬åˆ°è¿™é‡Œæ‰å¼€å§‹è¿›è¡Œ<strong>ä¸æ¨¡å‹è¾“å‡ºç›¸å…³çš„éšè—çŠ¶æ€è®¡ç®—</strong>ã€‚</p>\n<p>åœ¨æ›´æ–°å®Œç»†èƒçŠ¶æ€ <span class=\"math inline\">\\(c^{\\langle t \\rangle}\\)</span> ä¹‹åï¼ŒLSTM çš„ä¸‹ä¸€æ­¥æ˜¯è®¡ç®— <strong>è¾“å‡ºé—¨</strong> <span class=\"math inline\">\\(o^{\\langle t \\rangle}\\)</span><br />\nè¾“å‡ºé—¨çš„ä½œç”¨æ˜¯ï¼š<strong>æ§åˆ¶ç»†èƒçŠ¶æ€ä¸­çš„ä¿¡æ¯æœ‰å¤šå°‘è¢«â€œæš´éœ²â€ç»™ä¸‹ä¸€å±‚æˆ–ä¸‹ä¸€æ—¶é—´æ­¥ä½¿ç”¨</strong>ã€‚<br />\næ¢å¥è¯è¯´ï¼Œè¾“å‡ºé—¨å†³å®šäº†â€œé•¿æœŸè®°å¿†é€šé“ä¸­çš„ä¿¡æ¯å¦‚ä½•å½±å“å½“å‰è®¡ç®—â€ã€‚</p>\n<p>è®¡ç®—è¿‡ç¨‹å·²ç»çœ‹äº†å¾ˆå¤šéäº†ï¼š<br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260112222316249-153285731.png\" /><br />\né—¨çš„è®¡ç®—éƒ½æ˜¯ç›¸åŒçš„ï¼Œå…¬å¼ä¸ºï¼š</p>\n<p></p><div class=\"math display\">\\[o^{\\langle t \\rangle} = sigmoid\\big( W_{xo} x^{\\langle t \\rangle} + W_{ao} a^{\\langle t-1 \\rangle} + b_o \\big)  \n\\]</div><p></p><ul>\n<li>å½“ <span class=\"math inline\">\\(o_i^{\\langle t \\rangle} \\approx 1\\)</span> æ—¶ï¼Œç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªè®°å¿†å•å…ƒçš„é•¿æœŸä¿¡æ¯å‡ ä¹<strong>å…¨éƒ¨æš´éœ²</strong>ç»™éšè—çŠ¶æ€ã€‚</li>\n<li>å½“ <span class=\"math inline\">\\(o_i^{\\langle t \\rangle} \\approx 0\\)</span> æ—¶ï¼Œç¬¬ <span class=\"math inline\">\\(i\\)</span> ä¸ªè®°å¿†å•å…ƒçš„é•¿æœŸä¿¡æ¯å‡ ä¹<strong>å®Œå…¨å±è”½</strong>ã€‚</li>\n</ul>\n<h2 id=\"36-æ›´æ–°éšè—çŠ¶æ€\">3.6 æ›´æ–°éšè—çŠ¶æ€</h2>\n<p>æœ‰äº†è¾“å‡ºé—¨ <span class=\"math inline\">\\(o^{\\langle t \\rangle}\\)</span> å’Œæ›´æ–°åçš„ç»†èƒçŠ¶æ€ <span class=\"math inline\">\\(c^{\\langle t \\rangle}\\)</span> åï¼Œå°±å¯ä»¥ç”Ÿæˆå½“å‰æ—¶åˆ»çš„éšè—çŠ¶æ€ <span class=\"math inline\">\\(a^{\\langle t \\rangle}\\)</span>ï¼Œè¿™ä¹Ÿæ˜¯ LSTM çš„å®é™…è¾“å‡ºï¼Œç”¨äºä¼ é€’åˆ°ä¸‹ä¸€æ—¶é—´æ­¥æˆ–ä¸‹ä¸€å±‚ç½‘ç»œã€‚<br />\n<img alt=\"image.png\" src=\"https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260112222131324-2047519086.png\" /></p>\n<p>ç”Ÿæˆå…¬å¼ä¸ºï¼š</p>\n<p></p><div class=\"math display\">\\[a^{\\langle t \\rangle} = o^{\\langle t \\rangle} \\odot \\tanh(c^{\\langle t \\rangle})  \n\\]</div><p></p><p>æœ€ç»ˆï¼Œè¾“å‡ºé—¨ä¸ç»†èƒçŠ¶æ€ã€éšè—çŠ¶æ€ç»´åº¦ä¸€è‡´ï¼Œ<strong>æ¯ä¸ªåˆ†é‡ç‹¬ç«‹æ§åˆ¶å¯¹åº”è®°å¿†å•å…ƒçš„è¾“å‡º</strong>ï¼Œå®ç°å¯¹é•¿æœŸè®°å¿†çš„<strong>é€‰æ‹©æ€§è¯»å–</strong>ã€‚<br />\næœ€åï¼Œçœ‹åˆ°é•¿æœŸè®°å¿†ï¼Œä½ å¯èƒ½ä¼šå†æ¬¡æƒ³åˆ° GRU ä¸­ä¸ä»…æœ‰é•¿æœŸè®°å¿†ï¼Œè¿˜æœ‰çŸ­æœŸè®°å¿†ï¼Œé‚£ LSTM çš„çŸ­æœŸè®°å¿†è¢«éšå«åœ¨å“ªä¸€æ­¥äº†ï¼Ÿ<br />\nå®é™…ä¸Šï¼Œåœ¨ LSTM ä¸­ï¼ŒçŸ­æœŸè®°å¿† <strong>å°±æ˜¯å½“å‰æ­¥çš„éšè—çŠ¶æ€ <span class=\"math inline\">\\(a^{\\langle t \\rangle}\\)</span></strong>ï¼Œå®ƒä¼šä¼ ç»™ä¸‹ä¸€æ—¶é—´æ­¥æˆ–ä¸‹ä¸€å±‚å‚ä¸è®¡ç®—ï¼Œè€Œä¸åƒ GRU é‚£æ ·æŠŠé•¿æœŸè®°å¿†å’ŒçŸ­æœŸè®°å¿†åˆå¹¶åœ¨åŒä¸€çŠ¶æ€ä¸­ã€‚</p>\n<p>è‡³æ­¤ï¼Œä¸€ä¸ª LSTM å•å…ƒè®¡ç®—å°±å®Œæˆäº†ã€‚</p>\n<h2 id=\"37-å°ç»“lstm-çš„å®Œæ•´è®¡ç®—æµç¨‹\">3.7 å°ç»“ï¼šLSTM çš„å®Œæ•´è®¡ç®—æµç¨‹</h2>\n<p>åœ¨æ—¶é—´æ­¥ <span class=\"math inline\">\\(t\\)</span>ï¼Œä¸€ä¸ªæ ‡å‡† LSTM å•å…ƒçš„è®¡ç®—é¡ºåºå¯ä»¥æ€»ç»“ä¸ºï¼š</p>\n<ol>\n<li><strong>é—å¿˜é—¨</strong>ï¼šå†³å®šæ—§è®°å¿†ä¿ç•™å¤šå°‘ã€‚</li>\n</ol>\n<p></p><div class=\"math display\">\\[    f^{\\langle t \\rangle}  \n    = \\sigma(W_{xf} x^{\\langle t \\rangle} + W_{af} a^{\\langle t-1 \\rangle} + b_f)  \n\\]</div><p></p><ol start=\"2\">\n<li><strong>è¾“å…¥é—¨</strong>ï¼šå†³å®šæ–°ä¿¡æ¯å†™å…¥å¤šå°‘ã€‚</li>\n</ol>\n<p></p><div class=\"math display\">\\[    i^{\\langle t \\rangle}  \n    = \\sigma(W_{xi} x^{\\langle t \\rangle} + W_{ai} a^{\\langle t-1 \\rangle} + b_i)  \n\\]</div><p></p><ol start=\"3\">\n<li><strong>å€™é€‰è®°å¿†</strong>ï¼šç”Ÿæˆæ–°è®°å¿†å†…å®¹ã€‚</li>\n</ol>\n<p></p><div class=\"math display\">\\[    \\tilde{c}^{\\langle t \\rangle}  \n    = \\tanh(W_{xc} x^{\\langle t \\rangle} + W_{ac} a^{\\langle t-1 \\rangle} + b_c)  \n\\]</div><p></p><ol start=\"4\">\n<li><strong>æ›´æ–°ç»†èƒçŠ¶æ€</strong>ï¼šé•¿æœŸè®°å¿†èåˆã€‚</li>\n</ol>\n<p></p><div class=\"math display\">\\[    c^{\\langle t \\rangle}  \n    = f^{\\langle t \\rangle} \\odot c^{\\langle t-1 \\rangle}\n    \n\n+ i^{\\langle t \\rangle} \\odot \\tilde{c}^{\\langle t \\rangle}  \n\\]</div><p></p><ol start=\"5\">\n<li><strong>è¾“å‡ºé—¨ä¸éšè—çŠ¶æ€</strong>ï¼šç”Ÿæˆå½“å‰è¾“å‡ºã€‚</li>\n</ol>\n<p></p><div class=\"math display\">\\[o^{\\langle t \\rangle}  \n= \\sigma(W_{xo} x^{\\langle t \\rangle} + W_{ao} a^{\\langle t-1 \\rangle} + b_o)  \n\\]</div><p></p><p></p><div class=\"math display\">\\[ a^{\\langle t \\rangle}  \n = o^{\\langle t \\rangle} \\odot \\tanh(c^{\\langle t \\rangle})  \n\\]</div><p></p><p>è‡³æ­¤ï¼Œè¿™ä¸¤ç¯‡æˆ‘ä»¬å®Œæˆäº†å¯¹é—¨æ§æœºåˆ¶çš„ä¸€äº›ç›¸å…³æŠ€æœ¯çš„äº†è§£ï¼Œä½ ä¼šå‘ç°ï¼Œé—¨æ§æœºåˆ¶å¹¶æ²¡æœ‰åˆ›æ–°ç½‘ç»œæœ¬èº«çš„ç»“æ„ï¼Œè€Œæ˜¯é€šè¿‡ç½‘ç»œå…³ç³»å’Œè®¡ç®—é€»è¾‘ä¸ºå…¨è¿æ¥å±‚èµ‹äºˆäº†å…¨æ–°çš„è¯­ä¹‰ï¼š<strong>å®ç°äº†å¯¹è®°å¿†çš„é€‰æ‹©æ€§ä¿ç•™ã€æ›´æ–°ä¸è¾“å‡º</strong>ã€‚<br />\nè¿™ç§è®¾è®¡çš„å·§å¦™ä¹‹å¤„åœ¨äºï¼šç½‘ç»œå¯ä»¥è‡ªä¸»å†³å®šå“ªäº›ä¿¡æ¯å€¼å¾—é•¿æœŸè®°å¿†ï¼Œå“ªäº›ä¿¡æ¯åªç”¨äºå½“å‰è®¡ç®—ï¼Œä½¿æ¢¯åº¦åœ¨æ—¶é—´ç»´åº¦ä¸Šç¨³å®šä¼ æ’­ï¼ŒåŒæ—¶è®©æ¨¡å‹èƒ½å¤Ÿç²¾ç»†ç®¡ç†çŸ­æœŸä¸é•¿æœŸè®°å¿†ï¼Œä»è€Œæ˜¾è‘—æå‡åºåˆ—æ•°æ®å»ºæ¨¡çš„èƒ½åŠ›ã€‚<br />\nåŒæ—¶ï¼Œä¹Ÿç»™äº†æˆ‘ä»¬å…³äºåˆ›æ–°çš„æ–°çš„çµæ„Ÿï¼š<strong>ä¸è¦ä¸€å‘³å¢åŠ å¤æ‚ç»“æ„ï¼Œè€Œæ˜¯èµ‹äºˆå·²æœ‰æœºåˆ¶æ–°çš„è¯­ä¹‰ä¸æ§åˆ¶èƒ½åŠ›ã€‚</strong></p>\n<h1 id=\"3-æ€»ç»“\">3. æ€»ç»“</h1>\n<table>\n<thead>\n<tr>\n<th>æ¦‚å¿µ</th>\n<th>åŸç†</th>\n<th>æ¯”å–»</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>LSTMï¼ˆLong Short-Term Memoryï¼‰</strong></td>\n<td>ä¸ºäº†è§£å†³ RNN/GRU åœ¨é•¿åºåˆ—ä¸­é•¿æœŸä¾èµ–çš„é—®é¢˜ï¼Œå¼•å…¥<strong>æ˜¾å¼çš„è®°å¿†å•å…ƒï¼ˆcell stateï¼‰</strong>ï¼Œå¹¶é…åˆ<strong>é—å¿˜é—¨ã€è¾“å…¥é—¨ã€è¾“å‡ºé—¨</strong>è¿›è¡Œç²¾ç»†æ§åˆ¶ï¼Œå®ç°é•¿æœŸä¿¡æ¯çš„ç¨³å®šä¼ é€’ã€‚</td>\n<td>éšè—çŠ¶æ€åƒâ€œå½“å‰è„‘å­é‡Œåœ¨æƒ³ä»€ä¹ˆâ€ï¼Œç»†èƒçŠ¶æ€åƒâ€œä¸€æœ¬å‡ ä¹ä¸è¢«æ‰“æ‰°çš„é•¿æœŸå¤‡å¿˜å½•â€ã€‚</td>\n</tr>\n<tr>\n<td><strong>GRU çš„å±€é™</strong></td>\n<td>GRU åªæœ‰å•ä¸€éšè—çŠ¶æ€ï¼Œæ—¢æ‰¿æ‹…çŸ­æœŸè®¡ç®—ï¼Œåˆæ‰¿æ‹…é•¿æœŸè®°å¿†ï¼Œä½¿ä¸åŒæ—¶é—´å°ºåº¦çš„ä¿¡æ¯æ··åˆåœ¨åŒä¸€å‘é‡ä¸­ï¼Œé•¿åºåˆ—æˆ–ç²¾ç»†æ—¶åºåœºæ™¯å¯èƒ½å—é™ã€‚</td>\n<td>GRU åƒæ˜¯åœ¨â€œä¸€å¼ çº¸ä¸Šåå¤ä¿®æ”¹å†…å®¹â€ï¼Œé•¿æœŸä¸çŸ­æœŸä¿¡æ¯æ··åˆå­˜å‚¨ã€‚</td>\n</tr>\n<tr>\n<td><strong>ç»†èƒçŠ¶æ€ï¼ˆCell State <span class=\"math inline\">\\(c^{\\langle t \\rangle}\\)</span>ï¼‰</strong></td>\n<td>ä¸“é—¨å­˜å‚¨é•¿æœŸä¿¡æ¯ï¼Œå¯è¿‘ä¼¼çº¿æ€§ä¼ æ’­ï¼Œæ¢¯åº¦ä¸æ˜“æ¶ˆå¤±ã€‚é€šè¿‡é—å¿˜é—¨æ§åˆ¶ä¿ç•™ï¼Œè¾“å…¥é—¨æ§åˆ¶å†™å…¥ã€‚</td>\n<td>â€œé•¿æœŸå¤‡å¿˜å½•â€ï¼Œå¯ä»¥é•¿æœŸä¿å­˜å…³é”®ä¿¡æ¯ï¼Œä¸è¢«é¢‘ç¹æ”¹å†™ã€‚</td>\n</tr>\n<tr>\n<td><strong>éšè—çŠ¶æ€ï¼ˆHidden State <span class=\"math inline\">\\(a^{\\langle t \\rangle}\\)</span>ï¼‰</strong></td>\n<td>è¡¨ç¤ºå½“å‰æ—¶åˆ»çš„è¾“å‡ºå’ŒçŸ­æœŸè®¡ç®—ç»“æœï¼Œä¼ é€’åˆ°ä¸‹ä¸€æ—¶é—´æ­¥æˆ–ä¸‹ä¸€å±‚ã€‚</td>\n<td>â€œè„‘å­é‡Œå½“å‰æ­£åœ¨å¤„ç†çš„å†…å®¹â€ã€‚</td>\n</tr>\n<tr>\n<td><strong>é—å¿˜é—¨ï¼ˆForget Gate <span class=\"math inline\">\\(f^{\\langle t \\rangle}\\)</span>ï¼‰</strong></td>\n<td>å†³å®šæ—§è®°å¿†ä¿ç•™æ¯”ä¾‹ï¼š<span class=\"math inline\">\\(f^{\\langle t \\rangle} \\odot c^{\\langle t-1 \\rangle}\\)</span>ã€‚</td>\n<td>â€œå†³å®šæŠŠå“ªäº›æ—§ä¿¡æ¯ä¿ç•™ä¸‹æ¥ï¼Œå“ªäº›ä¸¢æ‰â€ã€‚</td>\n</tr>\n<tr>\n<td><strong>è¾“å…¥é—¨ï¼ˆInput Gate <span class=\"math inline\">\\(i^{\\langle t \\rangle}\\)</span>ï¼‰</strong></td>\n<td>å†³å®šæ–°ä¿¡æ¯å†™å…¥æ¯”ä¾‹ï¼š<span class=\"math inline\">\\(i^{\\langle t \\rangle} \\odot \\tilde{c}^{\\langle t \\rangle}\\)</span>ã€‚</td>\n<td>â€œå†³å®šæ–°è®°å¿†å†™å…¥å¤šå°‘åˆ°é•¿æœŸå¤‡å¿˜å½•â€ã€‚</td>\n</tr>\n<tr>\n<td><strong>å€™é€‰ç»†èƒçŠ¶æ€ï¼ˆ<span class=\"math inline\">\\(\\tilde{c}^{\\langle t \\rangle}\\)</span>ï¼‰</strong></td>\n<td>å½“å‰æ­¥ç”Ÿæˆçš„æ–°ä¿¡æ¯ï¼Œç”±å½“å‰è¾“å…¥ä¸ä¸Šä¸€éšè—çŠ¶æ€è®¡ç®—ï¼Œä½†å°šæœªå†™å…¥ç»†èƒçŠ¶æ€ã€‚</td>\n<td>â€œå‡†å¤‡å¥½å¯ä»¥å†™å…¥çš„æ–°è®°å¿†â€ã€‚</td>\n</tr>\n<tr>\n<td><strong>æ›´æ–°ç»†èƒçŠ¶æ€ï¼ˆ<span class=\"math inline\">\\(c^{\\langle t \\rangle}\\)</span>ï¼‰</strong></td>\n<td>ç»“åˆé—å¿˜é—¨ä¸è¾“å…¥é—¨æ›´æ–°é•¿æœŸè®°å¿†ï¼š<span class=\"math inline\">\\(c^{\\langle t \\rangle} = f^{\\langle t \\rangle} \\odot c^{\\langle t-1 \\rangle} + i^{\\langle t \\rangle} \\odot \\tilde{c}^{\\langle t \\rangle}\\)</span>ã€‚</td>\n<td>â€œæ—§å¤‡å¿˜å½•ä¿ç•™å¤šå°‘ + æ–°ä¿¡æ¯å†™å…¥å¤šå°‘â€ã€‚</td>\n</tr>\n<tr>\n<td><strong>è¾“å‡ºé—¨ï¼ˆOutput Gate <span class=\"math inline\">\\(o^{\\langle t \\rangle}\\)</span>ï¼‰</strong></td>\n<td>å†³å®šç»†èƒçŠ¶æ€æš´éœ²ç»™éšè—çŠ¶æ€çš„æ¯”ä¾‹ï¼š<span class=\"math inline\">\\(a^{\\langle t \\rangle} = o^{\\langle t \\rangle} \\odot \\tanh(c^{\\langle t \\rangle})\\)</span>ã€‚</td>\n<td>â€œå†³å®šé•¿æœŸè®°å¿†ä¸­å“ªäº›å†…å®¹ç°åœ¨è¢«ä½¿ç”¨â€ã€‚</td>\n</tr>\n<tr>\n<td><strong>çŸ­æœŸè®°å¿†</strong></td>\n<td>LSTM çš„çŸ­æœŸè®°å¿†å³å½“å‰æ—¶åˆ»çš„éšè—çŠ¶æ€ <span class=\"math inline\">\\(a^{\\langle t \\rangle}\\)</span>ï¼Œç”¨äºè®¡ç®—å½“å‰è¾“å‡ºå’Œä¸‹ä¸€æ­¥ä¼ é€’ã€‚</td>\n<td>â€œè„‘å­é‡Œå½“å‰æƒ³çš„ä¸œè¥¿â€ã€‚</td>\n</tr>\n<tr>\n<td><strong>é•¿æœŸè®°å¿†</strong></td>\n<td>LSTM çš„é•¿æœŸè®°å¿†å³ç»†èƒçŠ¶æ€ <span class=\"math inline\">\\(c^{\\langle t \\rangle}\\)</span>ï¼Œç¨³å®šä¼ é€’å…³é”®å†å²ä¿¡æ¯ï¼Œæ¢¯åº¦ä¸æ˜“æ¶ˆå¤±ã€‚</td>\n<td>â€œé•¿æœŸå¤‡å¿˜å½•â€ï¼Œå¯è·¨æ—¶é—´æ­¥ä¿å­˜ä¿¡æ¯ã€‚</td>\n</tr>\n</tbody>\n</table>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-12 22:25</span>&nbsp;\n<a href=\"https://www.cnblogs.com/Goblinscholar\">å“¥å¸ƒæ—å­¦è€…</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">12</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": ".NETå‘¨åˆŠã€12æœˆç¬¬2æœŸ 2025-12-14ã€‘",
      "link": "https://www.cnblogs.com/InCerry/p/-/dotnet_week_25_12_2",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/InCerry/p/-/dotnet_week_25_12_2\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-12 21:32\">\n    <span>.NETå‘¨åˆŠã€12æœˆç¬¬2æœŸ 2025-12-14ã€‘</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h2 id=\"å›½å†…æ–‡ç« \">å›½å†…æ–‡ç« </h2>\n<h3 id=\"avalonia-å®ç°è·¨å¹³å°çš„è§†é¢‘ä¼šè®®windowslinuxä¿¡åˆ›\">Avalonia å®ç°è·¨å¹³å°çš„è§†é¢‘ä¼šè®®ï¼ˆWindowsã€Linuxã€ä¿¡åˆ›ï¼‰</h3>\n<p><a href=\"https://www.cnblogs.com/shawshank/p/19305884\" target=\"_blank\">https://www.cnblogs.com/shawshank/p/19305884</a></p>\n<p>Avalonia 11 çš„å‘å¸ƒæ˜¾è‘—æå‡äº† .NET ç”Ÿæ€ä¸­çš„è·¨å¹³å° UI å¼€å‘èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯æä¾›äº†é«˜è´¨é‡çš„ Fluent 2 é£æ ¼æ§ä»¶ã€‚æ–‡ç« ä»‹ç»äº†ç”¨ Avalonia æ¡†æ¶å¼€å‘çš„è·¨å¹³å°è§†é¢‘ä¼šè®®ç³»ç»Ÿ Demoï¼Œæ”¯æŒå¤šç§åŠŸèƒ½ï¼Œå¦‚è§†é¢‘ä¼šè®®ã€å±å¹•åˆ†äº«å’Œç”µå­ç™½æ¿ï¼Œå¹¶ä¿è¯è¯­éŸ³è´¨é‡å’ŒåŠ¨æ€è°ƒèŠ‚ç¼–ç ã€‚å¼€å‘ç¯å¢ƒåŸºäº Visual Studio 2022 ä¸.NET 8.0ï¼Œä½¿ç”¨ C#ç¼–å†™ã€‚é¡¹ç›®åˆ†ä¸ºæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ï¼Œæ¶‰åŠé‡è¦ç±»å’ŒæŠ€æœ¯ç»†èŠ‚ï¼Œå±•ç¤ºäº†å®é™…åº”ç”¨çš„å¯è¡Œæ€§ä¸å‰æ™¯ã€‚</p>\n<h3 id=\"avalonia-ui-çš„æ¼”è¿›é€»è¾‘ä¸-qt-ç”Ÿæ€æ·±åº¦å¯¹æ¯”\">Avalonia UI çš„æ¼”è¿›é€»è¾‘ä¸ Qt ç”Ÿæ€æ·±åº¦å¯¹æ¯”</h3>\n<p><a href=\"https://www.cnblogs.com/shanyou/p/19329439\" target=\"_blank\">https://www.cnblogs.com/shanyou/p/19329439</a></p>\n<p>æœ¬æ–‡æ¢è®¨è·¨å¹³å°å›¾å½¢ç”¨æˆ·ç•Œé¢çš„å‘å±•ï¼Œé‡ç‚¹åˆ†æ Mike James ä» Qt åˆ° Avalonia çš„æŠ€æœ¯è½¬å˜ã€‚å†å²ä¸Šï¼Œå¼€å‘è€…åœ¨é«˜æ•ˆä¸æ€§èƒ½é—´ä¸¾æ­¥ç»´è‰°ï¼ŒQt ä»¥å…¶æ€§èƒ½å æ®ä¸»å¯¼åœ°ä½ã€‚éšç€.NET ç”Ÿæ€çš„å´›èµ·ï¼Œå¼€å‘è€…æ¸´æœ›ä¸€ä¸ªå…· C#ä¼˜åŠ¿çš„è·¨å¹³å°æ¡†æ¶ã€‚å¾®è°ƒçš„æŠ€æœ¯ä½¿ Avalonia åº”è¿è€Œç”Ÿï¼Œå±•ç°å‡ºä¸ Qt åœ¨æ¸²æŸ“ã€çŠ¶æ€ç®¡ç†ç­‰æ–¹é¢çš„æ˜¾è‘—å·®å¼‚ã€‚æ–‡ç« è¿˜æ¢è®¨äº† Avalonia çš„å•†ä¸šåŒ–è·¯å¾„ï¼Œé€šè¿‡æ ¸å¿ƒå¼€æºä¸å•†ä¸šé—­æºçš„ç»“åˆï¼ŒæŒ‘æˆ˜ Qt åœ¨å¸‚åœºçš„åœ°ä½ã€‚</p>\n<h3 id=\"wpf-æ–°æ‰‹æ‘æ•™ç¨‹ä¸€---èµ°ä¸å‡ºæ–°æ‰‹æ‘åˆ«æ‰¾æˆ‘\">WPF æ–°æ‰‹æ‘æ•™ç¨‹ï¼ˆä¸€ï¼‰ - èµ°ä¸å‡ºæ–°æ‰‹æ‘åˆ«æ‰¾æˆ‘</h3>\n<p><a href=\"https://www.cnblogs.com/leaf-7-scouts/p/19336808\" target=\"_blank\">https://www.cnblogs.com/leaf-7-scouts/p/19336808</a></p>\n<p>æœ¬æ–‡ä»‹ç»äº† WPF ä¸­ XAML çš„åŸºç¡€è¯­æ³•ä¸ç»„ä»¶ï¼Œå¼ºè°ƒäº† XAML ä½œä¸ºå£°æ˜æ€§æ ‡è®°è¯­è¨€çš„ç®€åŒ–ä½œç”¨ã€‚æ–‡ä¸­è¯¦ç»†è§£é‡Šäº†å¯¹è±¡å…ƒç´ çš„ç”¨æ³•ï¼ŒåŒ…æ‹¬è‡ªé—­åˆå’Œæˆå¯¹æ ‡ç­¾çš„è¯­æ³•ï¼Œä»¥åŠå¦‚ä½•ä¸ºæ§ä»¶è®¾ç½®å±æ€§ã€‚ä½œè€…ä½¿ç”¨ç®€å•æ˜äº†çš„ç¤ºä¾‹ï¼Œå±•ç°äº†æŒ‰é’®å’Œæ–‡æœ¬æ¡†çš„ç”¨æ³•ï¼Œå¹¶æå‡ºäº†é›†åˆå±æ€§çš„æ¦‚å¿µï¼ŒåŒºåˆ†äº†æ˜¾å¼å’Œéšå¼å†™æ³•ã€‚æ•´ä½“ä¸Šï¼Œæ–‡ç« ä»¥é€šä¿—æ˜“æ‡‚çš„æ–¹å¼ä»‹ç»äº† XAML çš„åŸºç¡€çŸ¥è¯†ï¼Œé€‚åˆåˆå­¦è€…å­¦ä¹ ã€‚</p>\n<h3 id=\"net-10-ç½‘ç»œæ”¹è¿›httpå®‰å…¨ä¸ç½‘ç»œåŸè¯­çš„å…¨é¢å‡çº§\">.NET 10 ç½‘ç»œæ”¹è¿›ï¼šHTTPã€å®‰å…¨ä¸ç½‘ç»œåŸè¯­çš„å…¨é¢å‡çº§</h3>\n<p><a href=\"https://www.cnblogs.com/powertoolsteam/p/19330426\" target=\"_blank\">https://www.cnblogs.com/powertoolsteam/p/19330426</a></p>\n<p>.NET 10 æä¾›äº†å¤šé¡¹ç½‘ç»œæ”¹è¿›ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨è¯ä¹¦éªŒè¯ä¼˜åŒ–ã€æ–°çš„ HTTP åŠ¨è¯ QUERY å’Œ WebSocketStream æŠ½è±¡å±‚ã€‚WinHttpHandler ç›®å‰æ”¯æŒåŸºäºæœåŠ¡å™¨ IP åœ°å€çš„è¯ä¹¦ç¼“å­˜æœºåˆ¶ï¼Œå¢å¼ºæ€§èƒ½ã€‚QUERY æ–¹æ³•å…è®¸åœ¨è¯·æ±‚ä½“ä¸­å‘é€æŸ¥è¯¢ï¼Œé€‚ç”¨äºè¶…é•¿ URI çš„åœºæ™¯ã€‚WebSocketStream ç®€åŒ–äº†æ–‡æœ¬å’ŒäºŒè¿›åˆ¶åè®®çš„æ•°æ®å¤„ç†ï¼Œæ”¯æŒå¤šç§åè®®ã€‚åŒæ—¶ï¼Œ.NET 10 åœ¨ OSX ä¸Šå¼•å…¥äº†å®¢æˆ·ç«¯ TLS 1.3 æ”¯æŒï¼Œé€šè¿‡ AppContext å¼€å…³å¯ç”¨ï¼Œæå‡äº†å®‰å…¨æ€§ã€‚æ•´ä½“ä¸Šï¼Œè¿™äº›æ›´æ–°æå‡äº†å¼€å‘è€…çš„ç½‘ç»œç¼–ç¨‹èƒ½åŠ›ã€‚</p>\n<h3 id=\"åˆ«å†è¯´-winform-åšçš„å·¥ä¸šè½¯ä»¶ä¸‘äº†è¿™äº›å¼€æºåº“è®©å®ƒé¢œå€¼æ‹‰æ»¡äº¤äº’æµç•…\">åˆ«å†è¯´ WinForm åšçš„å·¥ä¸šè½¯ä»¶ä¸‘äº†ï¼è¿™äº›å¼€æºåº“è®©å®ƒé¢œå€¼æ‹‰æ»¡ã€äº¤äº’æµç•…</h3>\n<p><a href=\"https://www.cnblogs.com/1312mn/p/19321609\" target=\"_blank\">https://www.cnblogs.com/1312mn/p/19321609</a></p>\n<p>WinForm ä½œä¸º.NET ç”Ÿæ€ä¸­æˆç†Ÿå¯é çš„æ¡Œé¢å¼€å‘æ¡†æ¶ï¼Œå°½ç®¡å­˜åœ¨è§†è§‰å’Œäº¤äº’é™åˆ¶ï¼Œä½†åœ¨ä¼ä¸šç®¡ç†ã€å·¥ä¸šæ§åˆ¶ç­‰é¢†åŸŸä¾ç„¶å¹¿æ³›åº”ç”¨ã€‚ä¸ºäº†æå‡ UI æ•ˆæœï¼Œå¼€å‘è€…å¯å€ŸåŠ©ç¬¬ä¸‰æ–¹å¼€æº UI åº“ï¼Œè¿™äº›åº“åœ¨ä¸æ”¹å˜ WinForm æ ¸å¿ƒç»“æ„çš„å‰æä¸‹ï¼Œé€šè¿‡æ§ä»¶é‡ç»˜å’Œä¼˜åŒ–å¸ƒå±€ï¼Œä½¿ä¼ ç»Ÿæ¡†æ¶ç„•å‘æ–°ç”Ÿã€‚æ–‡ä¸­ä»‹ç»çš„ ReaLTaiizor æ§ä»¶åº“ï¼Œæä¾›ä¸°å¯Œçš„ç¤ºä¾‹å’Œå…¼å®¹çš„ç‰ˆæœ¬ï¼Œèƒ½å¿«é€Ÿåˆ›å»ºé«˜è´¨é‡çš„åº”ç”¨ç•Œé¢ï¼Œé™ä½ç°ä»£åŒ–æ”¹é€ çš„æŠ€æœ¯é—¨æ§›ã€‚</p>\n<h3 id=\"åˆ†äº«-4-æ¬¾åŸºäº-c-ç¼–å†™å®ç”¨å¼€æºçš„-visual-studio-æ‰©å±•æ’ä»¶\">åˆ†äº« 4 æ¬¾åŸºäº C# ç¼–å†™ã€å®ç”¨ã€å¼€æºçš„ Visual Studio æ‰©å±•æ’ä»¶</h3>\n<p><a href=\"https://www.cnblogs.com/Can-daydayup/p/19328798\" target=\"_blank\">https://www.cnblogs.com/Can-daydayup/p/19328798</a></p>\n<p>EFCore.Visualizer æ˜¯ä¸€æ¬¾ç”¨äºåœ¨ Visual Studio ä¸­å¯è§†åŒ– EF Core æŸ¥è¯¢è®¡åˆ’çš„å·¥å…·ï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ã€‚EF Core Power Tools æä¾›æ•°æ®åº“åå‘å·¥ç¨‹å’Œæ¨¡å‹å¯è§†åŒ–åŠŸèƒ½ï¼Œé™ä½å¼€å‘é—¨æ§›ã€‚AntDeploy æ˜¯ä¸€æ¬¾å¼€æºéƒ¨ç½²æ’ä»¶ï¼Œæ”¯æŒå¤šå¹³å°å‘å¸ƒã€‚FileEncoding æ’ä»¶å¯å®æ—¶æ˜¾ç¤ºæ–‡æ¡£ç¼–ç ï¼Œç®€åŒ–ç¼–ç ç®¡ç†ã€‚æ‰€æœ‰é¡¹ç›®å‡æ”¶å½•åœ¨ C#/.NET ä¼˜ç§€é¡¹ç›®ç²¾é€‰ä¸­ï¼Œæ–¹ä¾¿å¼€å‘è€…è·å–æœ€æ–°åŠ¨æ€å’Œæœ€ä½³å®è·µã€‚</p>\n<h3 id=\"è…¾è®¯äº‘-edgeone-pages-æ‰˜ç®¡-blazor-wasm\">è…¾è®¯äº‘ EdgeOne Pages æ‰˜ç®¡ Blazor Wasm</h3>\n<p><a href=\"https://www.cnblogs.com/CKExp/p/19319722\" target=\"_blank\">https://www.cnblogs.com/CKExp/p/19319722</a></p>\n<p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Blazor WebAssembly åœ¨è…¾è®¯äº‘ EdgeOne Pages ä¸Šéƒ¨ç½²é™æ€ç½‘ç«™ã€‚EdgeOne Pages ä¸ Github Pages ç›¸ä¼¼ï¼Œæä¾›å…è´¹çš„é™æ€ç«™ç‚¹éƒ¨ç½²æœåŠ¡ã€‚ä½œè€…æè¿°äº†åˆ›å»º Blazor WebAssembly é¡¹ç›®çš„è¿‡ç¨‹ï¼Œä¸Šä¼ ä»£ç è‡³ Githubï¼Œå¹¶ä½¿ç”¨ Github Actions è¿›è¡Œè‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²ã€‚ç”¨ yml æ–‡ä»¶é…ç½®äº†æ„å»ºå·¥ä½œæµï¼Œæ­¥éª¤åŒ…æ‹¬è®¾ç½®.NET ç¯å¢ƒå’Œå‘å¸ƒé¡¹ç›®ï¼Œæœ€ç»ˆå°†æ„å»ºåçš„æ–‡ä»¶æ¨é€è‡³ Github Pagesã€‚æ–‡ç« é€»è¾‘æ¸…æ™°ï¼ŒåŒ…å«å…·ä½“çš„æŒ‡ä»¤å’Œç¤ºä¾‹ï¼Œé€‚åˆå¼€å‘è€…å‚è€ƒã€‚</p>\n<h3 id=\"net-8-å¾®æœåŠ¡æ¡†æ¶é•¿ä»€ä¹ˆæ ·é›†æˆ-ai-æ™ºèƒ½ä½“å¤šç§Ÿæˆ·è‡ªåŠ¨è°ƒåº¦ä¸å®æ—¶é€šä¿¡\">.NET 8 å¾®æœåŠ¡æ¡†æ¶é•¿ä»€ä¹ˆæ ·ï¼Ÿé›†æˆ AI æ™ºèƒ½ä½“ã€å¤šç§Ÿæˆ·ã€è‡ªåŠ¨è°ƒåº¦ä¸å®æ—¶é€šä¿¡</h3>\n<p><a href=\"https://www.cnblogs.com/1312mn/p/19273206\" target=\"_blank\">https://www.cnblogs.com/1312mn/p/19273206</a></p>\n<p>è¯¥æ–‡ç« ä»‹ç»äº†åŸºäº .NET 8 çš„å¾®æœåŠ¡è„šæ‰‹æ¶ï¼Œå³ NetCoreKevinï¼Œæ—¨åœ¨å¸®åŠ©å¿«é€Ÿæ­å»ºæ”¯æŒå¤šç§Ÿæˆ·ä¸åˆ†å¸ƒå¼éƒ¨ç½²çš„ç³»ç»Ÿã€‚æ–‡ç« å¼ºè°ƒé¡¹ç›®åº”ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰ï¼Œå‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå¹¶é›†æˆå¤šç§å¸¸ç”¨åŠŸèƒ½å¦‚å®‰å…¨è®¤è¯ã€å¤šäº‘å­˜å‚¨ä¸ AI èƒ½åŠ›ã€‚æŠ€æœ¯äº®ç‚¹åŒ…æ‹¬è·¨æœåŠ¡äº‹ä»¶é€šä¿¡ã€Redis ç¼“å­˜åŠ Quartz å®šæ—¶ä»»åŠ¡ã€‚è¯¦ç»†æä¾›äº†é¡¹ç›®å¯åŠ¨é…ç½®åŠä¸Šæ‰‹æ•™ç¨‹ï¼Œå¸®åŠ©å›¢é˜Ÿå¿«é€Ÿå®ç° SaaS ç±»ç³»ç»Ÿçš„å¼€å‘ä¸éƒ¨ç½²ã€‚</p>\n<h3 id=\"ä¸€åˆ†é’Ÿå®ç°net-ä¸é£ä¹¦é•¿è¿æ¥çš„-websocket-æ¶æ„\">ä¸€åˆ†é’Ÿå®ç°.NET ä¸é£ä¹¦é•¿è¿æ¥çš„ WebSocket æ¶æ„</h3>\n<p><a href=\"https://www.cnblogs.com/mudtools/p/19320597\" target=\"_blank\">https://www.cnblogs.com/mudtools/p/19320597</a></p>\n<p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åœ¨.NET ç¯å¢ƒä¸­å®ç°é£ä¹¦ WebSocket é•¿è¿æ¥ï¼Œå¼ºè°ƒäº†é•¿è¿æ¥ç›¸å¯¹äºä¼ ç»Ÿ Webhook çš„ä¼˜åŠ¿ï¼Œç‰¹åˆ«æ˜¯åœ¨å¼€å‘æˆæœ¬å’Œå®æ—¶æ€§æ–¹é¢ã€‚æ–‡ä¸­é˜è¿°äº†é£ä¹¦å¹³å°æ”¯æŒçš„å¤šç§äº‹ä»¶ç±»å‹ï¼Œå¹¶æ¢è®¨äº† Mud.Feishu æ¶æ„çš„äº‹ä»¶å¤„ç†è®¾è®¡ï¼Œé‡‡ç”¨ç­–ç•¥æ¨¡å¼ä»¥å®ç°é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æœºåˆ¶ã€‚å…·ä½“ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºç”¨æˆ·å’Œå¤„ç†æ¶ˆæ¯æ¥æ”¶äº‹ä»¶ï¼Œå¼ºè°ƒäº†æ¸…æ™°çš„å•ä¸€èŒè´£ã€å¯æµ‹è¯•æ€§ä»¥åŠåŠ¨æ€é€‰æ‹©å¤„ç†ç­–ç•¥çš„é‡è¦æ€§ã€‚</p>\n<h3 id=\"å‹æµ‹æ•°æ®åˆ†äº«cçš„-threadpoolsetmaxthreads-é…ç½®æœ€å¤§çº¿ç¨‹æ•°åˆ°åº•å¯¹æ€§èƒ½æœ‰å¤šå¤§å½±å“\">ã€å‹æµ‹æ•°æ®åˆ†äº«ã€‘C#çš„ <code>ThreadPool.SetMaxThreads()</code> é…ç½®æœ€å¤§çº¿ç¨‹æ•°åˆ°åº•å¯¹æ€§èƒ½æœ‰å¤šå¤§å½±å“</h3>\n<p><a href=\"https://www.cnblogs.com/ahfuzhang/p/19340661\" target=\"_blank\">https://www.cnblogs.com/ahfuzhang/p/19340661</a></p>\n<p>æ–‡ç« å±•ç¤ºäº†é€šè¿‡ async æ–¹æ³•å’Œ Kestrel åº“æä¾› HTTP æœåŠ¡çš„å¼ºå¤§æ€§èƒ½ï¼ŒæŒ‡å‡ºçº¿ç¨‹æ± çº¿ç¨‹æ•°ä¸ CPU æ ¸æ•°çš„å…³ç³»ã€‚æ€§èƒ½é€šè¿‡è°ƒæ•´çº¿ç¨‹æ± çš„æœ€å°å’Œæœ€å¤§çº¿ç¨‹æ•°å¾—ä»¥ä¼˜åŒ–ã€‚å®éªŒè¡¨æ˜ï¼Œçº¿ç¨‹æ± çš„æœ€ä½³è¡¨ç°éœ€è¦æœ€å¤§çº¿ç¨‹æ•°ä¸æ ¸æ•°ä¸€è‡´ï¼Œè¿‡å¤šæˆ–è¿‡å°‘éƒ½ä¼šé™ä½æ€§èƒ½ã€‚ä½¿ç”¨ Kestrel åº“å¼€å‘çš„ HTTP 1.1 echo æœåŠ¡å™¨ï¼Œè¿è¡Œåœ¨ Docker ç¯å¢ƒä¸­ï¼Œå±•ç¤ºäº†å…¶é«˜æ•ˆçš„å¼‚æ­¥å¤„ç†èƒ½åŠ›ã€‚å®éªŒæ•°æ®æä¾›äº†ä¸åŒçº¿ç¨‹è®¾ç½®ä¸‹çš„æ€§èƒ½æŒ‡æ ‡ï¼ŒéªŒè¯äº†ä½œè€…çš„è§‚ç‚¹ã€‚</p>\n<h3 id=\"cai-ç³»åˆ—6-cç¦»çº¿å®ç°é«˜æ•ˆ-ocr\">C#AI ç³»åˆ—(6): C#ç¦»çº¿å®ç°é«˜æ•ˆ OCR</h3>\n<p><a href=\"https://www.cnblogs.com/luojin765/p/19346320\" target=\"_blank\">https://www.cnblogs.com/luojin765/p/19346320</a></p>\n<p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åœ¨ C#ä¸­ä½¿ç”¨ Tesseract å®ç° OCRã€‚Tesseract æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¼€æºå…‰å­¦å­—ç¬¦è¯†åˆ«å¼•æ“ï¼Œæ”¯æŒè¶…è¿‡ 100 ç§è¯­è¨€ã€‚ä½œè€…æä¾›äº†å‘½ä»¤è¡Œå’Œ Wrapper ä¸¤ç§è°ƒç”¨æ–¹å¼ï¼Œå¹¶é‡ç‚¹è¯´æ˜äº†ä½¿ç”¨ Wrapper æ–¹æ³•ï¼Œé€šè¿‡ç®€æ´çš„å››è¡Œä»£ç å®ç° OCRã€‚è¯»è€…éœ€æå‰å‡†å¤‡å¥½è®­ç»ƒæ¨¡å‹ï¼Œå¹¶å¯é€‰æ‹©åŒæ—¶åŠ è½½å¤šç§è¯­è¨€æ¨¡å‹ã€‚æœ¬æ–‡ä¹Ÿè¯¦ç»†æè¿°äº†å¼•æ“æ¨¡å¼å’Œé¡µé¢åˆ†å‰²æ¨¡å¼çš„é€‰æ‹©ï¼Œå¸®åŠ©ç”¨æˆ·ä¼˜åŒ– OCR æ•ˆæœã€‚é¡¹ç›®èµ„æºå·²å¼€æºï¼Œæ¬¢è¿å­¦ä¹ äº¤æµã€‚</p>\n<h3 id=\"maf-å¿«é€Ÿå…¥é—¨6æ··åˆç¼–æ’å·¥ä½œæµ\">MAF å¿«é€Ÿå…¥é—¨ï¼ˆ6ï¼‰æ··åˆç¼–æ’å·¥ä½œæµ</h3>\n<p><a href=\"https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper06\" target=\"_blank\">https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper06</a></p>\n<p>æœ¬æ–‡ä»‹ç»äº†åœ¨ MAF ä¸­æ··åˆä½¿ç”¨ Executor å’Œ Agent çš„å·¥ä½œæµï¼Œé‡ç‚¹åœ¨äºé’ˆå¯¹å†…å®¹å®¡æ ¸çš„æ¡ˆä¾‹ã€‚Executor è´Ÿè´£ç¡®å®šæ€§é€»è¾‘å¤„ç†ï¼Œå¦‚æ•°æ®éªŒè¯ï¼Œè€Œ Agent ç”¨äº AI æ™ºèƒ½å†³ç­–ï¼Œå…·æœ‰ä¸ç¡®å®šæ€§ã€‚æ–‡ç« æä¾›äº†ä¸€ä¸ªå…·ä½“å®ä¾‹ï¼Œä½¿ç”¨.NET æ§åˆ¶å°åº”ç”¨é…ç½®ç›¸å…³ NuGet åŒ…ï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•è¯»å– API ä¿¡æ¯åŠå®šä¹‰æ•°æ®ä¼ è¾“æ¨¡å‹ã€‚é€šè¿‡å…·ä½“çš„ä»£ç ç¤ºä¾‹ï¼Œæ¸…æ¥šè¯´æ˜äº†å·¥ä½œæµçš„æ„å»ºè¿‡ç¨‹ï¼Œé€‚åˆå¼€å‘è€…å­¦ä¹ å’Œå®è·µã€‚</p>\n<h3 id=\"cå®ç°ä¸‰è±-mc-é€šè®¯åè®®åº“4c-å¸§-æ ¼å¼-1\">C#å®ç°ä¸‰è± MC é€šè®¯åè®®åº“ï¼ˆ4C å¸§-æ ¼å¼ 1ï¼‰</h3>\n<p><a href=\"https://www.cnblogs.com/dragonet-Z/p/19318911\" target=\"_blank\">https://www.cnblogs.com/dragonet-Z/p/19318911</a></p>\n<p>æœ¬æ–‡ä»‹ç»äº† C#å®ç°çš„ä¸‰è± MC é€šè®¯åè®®åº“ï¼Œä½¿ç”¨ VS2022 .NET Standard 2.0 å¼€å‘ã€‚é€šè¿‡ä¸²å£å®ç° PC ä¸ PLC çš„é€šè®¯ï¼Œæ”¯æŒ QnA å…¼å®¹ 4C å¸§æ ¼å¼ 1 çš„å¼‚æ­¥è¯»å†™æ“ä½œã€‚MC åè®®æ˜¯ä¸ä¸‰è± PLC é€šè®¯çš„å…¬å¼€åè®®ï¼Œèƒ½å¤Ÿé€šè¿‡ä¸åŒæ¨¡å—è¯»å– PLC çš„çŠ¶æ€ã€‚æ–‡ç« è¯¦ç»†è¯´æ˜äº† MC åè®®çš„é€šä¿¡æ¡†æ¶ã€æ•°æ®å†…å®¹åŠæŒ‡ä»¤ã€‚è¿˜æä¾›äº†å’Œæ ¡éªŒå®ç°ä»£ç ï¼Œå¸®åŠ©å¼€å‘è€…è°ƒè¯•ã€‚æ–‡ä¸­é™„æœ‰ç›¸å…³æ‰‹å†Œé“¾æ¥ï¼Œä¾¿äºæ·±å…¥äº†è§£åè®®ã€‚æœ€åå¼ºè°ƒåè®®åŠŸèƒ½å¼ºå¤§ï¼Œä»…è¦†ç›–åŸºç¡€å†…å®¹ã€‚</p>\n<h3 id=\"ef-corecode-firstæ–¹æ¡ˆä¸‹ä»¥ç¼–ç¨‹æ–¹å¼ç”Ÿæˆè¿ç§»\">ã€EF Coreã€‘â€œCode Firstâ€æ–¹æ¡ˆä¸‹ä»¥ç¼–ç¨‹æ–¹å¼ç”Ÿæˆè¿ç§»</h3>\n<p><a href=\"https://www.cnblogs.com/tcjiaan/p/19345236\" target=\"_blank\">https://www.cnblogs.com/tcjiaan/p/19345236</a></p>\n<p>è¿ç§»ï¼ˆMigrationsï¼‰æ˜¯ç”¨äºåˆ›å»ºå’Œä¿®è®¢æ•°æ®åº“çš„æœºåˆ¶ã€‚å®ƒé€šè¿‡ç”Ÿæˆä¸€ç³»åˆ— .NET ç±»æ¥è¡¨ç¤ºæ•°æ®åº“çš„ä¸åŒç‰ˆæœ¬ã€‚å¼€å‘è€…å¯ä»¥åœ¨è¿™äº›ç‰ˆæœ¬ä¹‹é—´å‰è¿›æˆ–åé€€ï¼Œä»¥ä¿®æ”¹æ•°æ®åº“ç»“æ„è€Œéæ•°æ®ã€‚ç¡®ä¿åˆ›å»ºæ•°æ®åº“çš„æ–¹æ³•ä¸èƒ½åç»­ä¿®æ”¹ï¼Œè€Œè¿ç§»ä¼šä¿å­˜è¿ç§»ç‰ˆæœ¬ä¿¡æ¯ã€‚å¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰è¿ç§»å‘½åæ–¹å¼ï¼Œå¹¶é€šè¿‡å®ç° IMigrationsIdGenerator æ¥å£æ¥å®šåˆ¶å‘½åã€‚è¿ç§»ç”±å¤šç§æ“ä½œç»„æˆï¼Œé€šè¿‡ç”Ÿæˆ SQL è¯­å¥å®ç°æ•°æ®åº“ä¿®æ”¹ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸°å¯Œä¸”å®ç”¨ï¼Œå¯¹å¼€å‘è€…æå…·å¸®åŠ©ã€‚</p>\n<h3 id=\"net-10-ç½‘ç»œå †æ ˆæ·±åº¦æ¶æ„è§£æhttp3æ€§èƒ½ä¼˜åŒ–ä¸åé‡å­åŠ å¯†çš„èåˆæ¼”è¿›\">.NET 10 ç½‘ç»œå †æ ˆæ·±åº¦æ¶æ„è§£æï¼šHTTP/3ã€æ€§èƒ½ä¼˜åŒ–ä¸åé‡å­åŠ å¯†çš„èåˆæ¼”è¿›</h3>\n<p><a href=\"https://www.cnblogs.com/shanyou/p/19350080/dotnet10network\" target=\"_blank\">https://www.cnblogs.com/shanyou/p/19350080/dotnet10network</a></p>\n<p>éšç€.NET 10 çš„æ¨å‡ºï¼Œå¾®è½¯é‡æ–°å®šä¹‰äº†äº‘åŸç”Ÿæ—¶ä»£çš„ç½‘ç»œé€šä¿¡æ ‡å‡†ã€‚è¯¥ç‰ˆæœ¬èšç„¦ç°ä»£ã€é«˜æ•ˆå’Œå¼€å‘è€…å‹å¥½ï¼Œæ”¯æŒ HTTP/3 å’Œ QUIC åè®®ï¼Œè§£å†³äº†é•¿æœŸå­˜åœ¨çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œå¹¶å¼•å…¥åé‡å­åŠ å¯†ç®—æ³•ï¼Œå¢å¼ºäº†å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚é€šè¿‡ JIT ç¼–è¯‘å™¨ä¼˜åŒ–å’Œèµ„æºç®¡ç†ï¼Œ.NET 10 åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹è¡¨ç°å‡ºè‰²ã€‚æ–°çš„ System.Net.Quic åº“ä½œä¸ºæ ¸å¿ƒç»„ä»¶ï¼Œæé«˜äº†æµçš„ç‹¬ç«‹æ€§å’Œç½‘ç»œä¼ è¾“æ•ˆç‡ï¼Œç®€åŒ–äº†å¼€å‘è€…çš„ä½“éªŒï¼Œæ ‡å¿—ç€.NET çš„æŠ€æœ¯é‡å¤§è¿›æ­¥ã€‚</p>\n<h3 id=\"net-å¾®æœåŠ¡ç½‘å…³æ³¨å†Œå’Œç®¡ç†åŸºäº-consul--nginx-å®ç°\">.Net å¾®æœåŠ¡ç½‘å…³æ³¨å†Œå’Œç®¡ç†ï¼ˆåŸºäº Consul + Nginx å®ç°ï¼‰</h3>\n<p><a href=\"https://www.cnblogs.com/net-kevin-li/p/19332353\" target=\"_blank\">https://www.cnblogs.com/net-kevin-li/p/19332353</a></p>\n<p>æ–‡ç« è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åŸºäº Consul å’Œ Nginx å®ç°.NET å¾®æœåŠ¡çš„ç½‘å…³æ³¨å†Œä¸ç®¡ç†ã€‚å®ƒé˜è¿°äº†å¾®æœåŠ¡æ¶æ„ä¸­ API ç½‘å…³çš„åŠŸèƒ½ã€Consul çš„æœåŠ¡æ³¨å†Œä¸å‘ç°ä»¥åŠ Nginx çš„åŠ¨æ€è·¯ç”±é…ç½®ã€‚æ–‡ç« è¿˜æåˆ°å¥åº·æ£€æŸ¥ä¸æ•…éšœè½¬ç§»æœºåˆ¶ï¼Œä»¥åŠè´Ÿè½½å‡è¡¡ç­–ç•¥çš„ä¼˜åŒ–ã€‚æœ€åï¼Œæ¶‰åŠå®‰å…¨ä¸è®¤è¯çš„é›†æˆï¼Œå±•ç¤ºäº†å®é™…çš„ä»£ç ç¤ºä¾‹å’Œé…ç½®ï¼Œå…·æœ‰å®ç”¨æ€§å’ŒæŠ€æœ¯æ·±åº¦ã€‚</p>\n<h3 id=\"åœ¨net-ä¸­å®ç°ä¸€åº“å¤šç§Ÿæˆ·single-database-multi-tenancyæ¨¡å¼ä¸»è¦é€šè¿‡å…±äº«æ•°æ®åº“ä½†éš”ç¦»æ•°æ®çš„æ–¹å¼å®ç°\">åœ¨.NET ä¸­å®ç°ä¸€åº“å¤šç§Ÿæˆ·ï¼ˆSingle Database Multi-Tenancyï¼‰æ¨¡å¼ï¼Œä¸»è¦é€šè¿‡å…±äº«æ•°æ®åº“ä½†éš”ç¦»æ•°æ®çš„æ–¹å¼å®ç°ã€‚</h3>\n<p><a href=\"https://www.cnblogs.com/net-kevin-li/p/19327739\" target=\"_blank\">https://www.cnblogs.com/net-kevin-li/p/19327739</a></p>\n<p>æœ¬æ–‡è®¨è®ºäº†åœ¨.NET ä¸­å®ç°ä¸€åº“å¤šç§Ÿæˆ·æ¨¡å¼çš„æ–¹æ³•ï¼Œä»‹ç»äº†å…±äº«æ•°æ®åº“å’Œæ•°æ®éš”ç¦»çš„å®ç°æ–¹æ¡ˆã€‚æ–‡ç« è¯¦ç»†é˜è¿°äº†å‰åç«¯åˆ†ç¦»è®¾è®¡ã€é¢†åŸŸé©±åŠ¨è®¾è®¡åŠå¤šçº§ç¼“å­˜æœºåˆ¶ç­‰æ¶æ„ç‰¹æ€§ã€‚å†…å®¹æ¶‰åŠ CAP äº‹ä»¶æ€»çº¿ã€SignalR å®æ—¶é€šä¿¡å’Œä»»åŠ¡è°ƒåº¦ç­‰æ ¸å¿ƒæŠ€æœ¯ã€‚è¿˜æè¿°äº†å¦‚ä½•é€šè¿‡ç§Ÿæˆ· ID åˆ—ã€åŠ¨æ€ Schema å’Œè¡Œçº§å®‰å…¨ç­–ç•¥å®ç°æ•°æ®éš”ç¦»ï¼Œæå‡ºäº†é€šè¿‡å­åŸŸåæˆ– JWT è¿›è¡Œç§Ÿæˆ·è¯†åˆ«çš„æ–¹æ¡ˆã€‚æ­¤å¤–ï¼Œæ–‡ç« å»ºè®®äº†æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼Œå¦‚ç´¢å¼•ä¼˜åŒ–å’Œæ•°æ®åˆ†ç‰‡ã€‚</p>\n<h3 id=\"opencvsharpå­¦ä¹ è¿é€šæ€§æ£€æµ‹çš„ä½¿ç”¨\">OpenCVSharpï¼šå­¦ä¹ è¿é€šæ€§æ£€æµ‹çš„ä½¿ç”¨</h3>\n<p><a href=\"https://www.cnblogs.com/mingupupu/p/19344713\" target=\"_blank\">https://www.cnblogs.com/mingupupu/p/19344713</a></p>\n<p>è¿é€šæ€§æ£€æµ‹æ˜¯è®¡ç®—æœºè§†è§‰ä¸­çš„å›¾åƒå¤„ç†æŠ€æœ¯ï¼Œç”¨äºæ ‡è®°äºŒå€¼å›¾åƒçš„ç›¸äº’è¿æ¥åƒç´ åŒºåŸŸã€‚è¯¥æŠ€æœ¯é€šå¸¸ç”¨ä½œå…¶ä»–å›¾åƒå¤„ç†çš„å‰ç½®æ­¥éª¤ï¼Œèƒ½ç»Ÿè®¡ç‰©ä½“æ•°é‡ï¼Œä½†åº”ç”¨åœºæ™¯æœ‰é™ã€‚é¦–å…ˆå°†å›¾åƒç°åº¦åŒ–ï¼Œå†è¿›è¡ŒäºŒå€¼åŒ–å¤„ç†ã€‚ä½¿ç”¨ OpenCVSharp åº“ä¸­çš„ Cv2.AdaptiveThreshold å‡½æ•°ï¼Œå¯ä»¥å¯¹å…‰ç…§ä¸å‡çš„å›¾åƒè¿›è¡Œå±€éƒ¨è‡ªé€‚åº”çš„äºŒå€¼åŒ–ï¼Œä»è€Œæ›´å‡†ç¡®åœ°è¿›è¡Œè¿é€šåŒºåŸŸæ£€æµ‹ã€‚è¯¥æ–¹æ³•é€šè¿‡è®¡ç®—å±€éƒ¨åŒºåŸŸçš„å¹³å‡å€¼åŠ¨æ€è°ƒæ•´é˜ˆå€¼ï¼Œé€‚åº”ä¸åŒäº®åº¦çš„åŒºåŸŸã€‚å…¨å±€é˜ˆå€¼å¤„ç†åœ¨å¤æ‚æƒ…å†µä¸‹æ•ˆæœè¾ƒå·®ã€‚æ•´ä½“å†…å®¹å±•ç¤ºäº†å›¾åƒå¤„ç†çš„æ ¸å¿ƒæŠ€æœ¯å’Œåº”ç”¨ã€‚</p>\n<h3 id=\"solon-ai-å¼€å‘å­¦ä¹ -19---ç»“åˆ-solon-flow-å®ç°-react-æ•ˆæœ\">Solon AI å¼€å‘å­¦ä¹  19 - ç»“åˆ Solon Flow å®ç° ReAct æ•ˆæœ</h3>\n<p><a href=\"https://www.cnblogs.com/noear/p/19328690\" target=\"_blank\">https://www.cnblogs.com/noear/p/19328690</a></p>\n<p>Solon Flow æ˜¯ä¸€ä¸ªé€šç”¨çš„æµç¨‹ç¼–æ’å¼•æ“ï¼Œä½¿ç”¨ YAML æˆ– JSON è¿›è¡Œé…ç½®ã€‚è¯¥ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ LLM ç¼–å†™æ–‡ç« å¹¶è¿›è¡Œäººå·¥å®¡æ ¸çš„æµç¨‹ã€‚æµç¨‹å¼€å§‹æ—¶ï¼ŒAgent ç¼–å†™åˆç¨¿ï¼Œæ¥ç€è¿›å…¥å®¡æ ¸ç¯èŠ‚ã€‚å¦‚æœå®¡æ ¸ä¸é€šè¿‡ï¼Œç”¨æˆ·å¯ä»¥æä¾›åé¦ˆï¼ŒAgent æ ¹æ®åé¦ˆä¿®æ”¹å†…å®¹ï¼Œå†æ¬¡è¿›å…¥å®¡æ ¸ã€‚æœ€ç»ˆï¼Œæµç¨‹åœ¨è·å¾—æ‰¹å‡†æˆ–è¾¾åˆ°æœ€å¤§ä¿®æ”¹æ¬¡æ•°åç»“æŸã€‚ä»£ç éƒ¨åˆ†å±•ç¤ºäº† Agent çš„å®ç°ï¼ŒåŒ…æ‹¬åˆç¨¿ç¼–å†™å’Œåé¦ˆå¤„ç†çš„é€»è¾‘ã€‚æ•´ä½“ä¸Šï¼Œè¯¥æµç¨‹é«˜æ•ˆå®ç°äº†äººæœºäº¤äº’ä¸å†…å®¹å®¡æ ¸çš„ç»“åˆã€‚</p>\n<h3 id=\"maui-åº“æ¨èä¸€mauiicons\">MAUI åº“æ¨èä¸€ï¼šMAUIIcons</h3>\n<p><a href=\"https://www.cnblogs.com/sesametech-dotnet/p/19349735\" target=\"_blank\">https://www.cnblogs.com/sesametech-dotnet/p/19349735</a></p>\n<p>MAUIIcons æ˜¯ä¸€ä¸ªä¸º Maui æä¾›çš„å›¾æ ‡é›†åˆåº“ï¼Œé›†æˆ Fluentã€Materialã€Cupertino å’Œ FontAwesome å›¾æ ‡ã€‚ç”¨æˆ·èƒ½ä¾¿æ·åœ°åœ¨ MAUI åº”ç”¨ä¸­ä½¿ç”¨è¿™äº›å›¾æ ‡ã€‚ä¸ºäº†ä½¿ç”¨è¯¥åº“ï¼Œéœ€è¦åœ¨ nuget ä¸Šä¸‹è½½ï¼Œå¹¶åœ¨ MauiProgram.cs ä¸­æ·»åŠ ä»£ç è¿›è¡Œåˆå§‹åŒ–ã€‚æ­¤å¤–ï¼Œæ–‡ä¸­ä»‹ç»äº†å¦‚ä½•åœ¨ XAML ä¸­ä½¿ç”¨å›¾æ ‡ï¼Œå¹¶æä¾›äº†æ•°æ®ç»‘å®šçš„ç¤ºä¾‹ã€‚è‹¥é‡ç¼–è¯‘é”™è¯¯ï¼Œå¯ä»¥é€šè¿‡åˆ›å»º MauiIcon å®ä¾‹è§£å†³ã€‚è¯¥æ–‡æ˜“äºç†è§£ï¼Œä¸”åŒ…å«å®ç”¨ç¤ºä¾‹ã€‚</p>\n<h3 id=\"åˆ›å»ºæŠ–éŸ³æ–°å·åˆ†äº«çŸ¥è¯†æ¨å¹¿å¼€æºé¡¹ç›®\">åˆ›å»ºæŠ–éŸ³æ–°å·åˆ†äº«çŸ¥è¯†æ¨å¹¿å¼€æºé¡¹ç›®</h3>\n<p><a href=\"https://www.cnblogs.com/fanliang11/p/19332240\" target=\"_blank\">https://www.cnblogs.com/fanliang11/p/19332240</a></p>\n<p>ä½œè€…æ˜¯ä¸€åæ‹¥æœ‰äºŒåå¹´å¼€å‘ç»éªŒçš„ 85 åï¼Œå§‹ç»ˆåšæŒ.NET æŠ€æœ¯ï¼Œå°½ç®¡é¢ä¸´è¯¸å¤šæŒ‘æˆ˜ã€‚ä»–åˆ†äº«äº†è‡ªå·±å¯¹äº§å“å¼€å‘çš„çƒ­æƒ…ï¼Œåšä¿¡æœ€ç»ˆä¼šå–å¾—æˆåŠŸã€‚åŒæ—¶ï¼Œä»–å¼€è®¾äº†ä¸€ä¸ªæ–°çš„æŠ–éŸ³å·ï¼Œå¸Œæœ›é€šè¿‡ç›´æ’­æ‹‰åŠ¨ç²‰ä¸å’Œå®£ä¼ äº§å“ï¼Œè¿˜æåˆ°ç›´æ’­äº’åŠ¨çš„ç›®çš„åœ¨äºå­¦ä¹ äº¤æµã€‚</p>\n<blockquote>\n<p>æœ¬å‘¨å›½é™…å‘¨åˆŠæœªæ›´æ–°ï¼Œæ•…ç•™ç©º</p>\n</blockquote>\n<h2 id=\"ä»Šæ—¥äººç‰©\">ä»Šæ—¥äººç‰©</h2>\n<p><strong>æŸ¥å°”æ–¯Â·å®‰ä¸œå°¼Â·ç†æŸ¥å¾·Â·éœå°”</strong><a href=\"https://zh.wikipedia.org/wiki/%E7%88%B5%E5%A3%AB\" rel=\"noopener nofollow\" target=\"_blank\">çˆµå£«</a>ï¼ˆè‹±è¯­ï¼šSir <strong>Charles Antony Richard Hoare</strong>ï¼Œç¼©å†™ä¸º C. A. R. Hoareï¼Œ1934 å¹´ 1 æœˆ 11 æ—¥â€”ï¼‰ï¼Œæ˜µç§°ä¸º<strong>ä¸œå°¼Â·éœå°”</strong>ï¼ˆè‹±è¯­ï¼š<strong>Tony Hoare</strong>ï¼Œä¸€è¯‘<strong>æ‰˜å°¼Â·éœå°”</strong>ï¼‰ï¼Œç”Ÿäº<a href=\"https://zh.wikipedia.org/wiki/%E5%A4%A7%E8%8B%B1%E5%B8%9D%E5%9C%8B\" rel=\"noopener nofollow\" target=\"_blank\">å¤§è‹±å¸å›½</a><a href=\"https://zh.wikipedia.org/wiki/%E8%8B%B1%E5%B1%AC%E9%8C%AB%E8%98%AD\" rel=\"noopener nofollow\" target=\"_blank\">é”¡å…°</a><a href=\"https://zh.wikipedia.org/wiki/%E5%8F%AF%E5%80%AB%E5%9D%A1\" rel=\"noopener nofollow\" target=\"_blank\">å¯ä¼¦å¡</a>ï¼ˆä»Š<a href=\"https://zh.wikipedia.org/wiki/%E6%96%AF%E9%87%8C%E8%98%AD%E5%8D%A1\" rel=\"noopener nofollow\" target=\"_blank\">æ–¯é‡Œå…°å¡</a>ï¼‰ï¼Œè‹±å›½<a href=\"https://zh.wikipedia.org/wiki/%E8%A8%88%E7%AE%97%E6%A9%9F%E7%A7%91%E5%AD%B8%E5%AE%B6\" rel=\"noopener nofollow\" target=\"_blank\">è®¡ç®—æœºç§‘å­¦å®¶</a>ï¼Œ<a href=\"https://zh.wikipedia.org/wiki/%E5%9B%BE%E7%81%B5%E5%A5%96\" rel=\"noopener nofollow\" target=\"_blank\">å›¾çµå¥–</a>å¾—ä¸»ã€‚ä»–è®¾è®¡äº†<a href=\"https://zh.wikipedia.org/wiki/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F\" rel=\"noopener nofollow\" target=\"_blank\">å¿«é€Ÿæ’åº</a><a href=\"https://zh.wikipedia.org/wiki/%E6%BC%94%E7%AE%97%E6%B3%95\" rel=\"noopener nofollow\" target=\"_blank\">ç®—æ³•</a>ã€<a href=\"https://zh.wikipedia.org/wiki/%E9%9C%8D%E5%B0%94%E9%80%BB%E8%BE%91\" rel=\"noopener nofollow\" target=\"_blank\">éœå°”é€»è¾‘</a>ã€<a href=\"https://zh.wikipedia.org/wiki/%E9%80%9A%E4%BF%A1%E9%A1%BA%E5%BA%8F%E8%BF%9B%E7%A8%8B\" rel=\"noopener nofollow\" target=\"_blank\">é€šä¿¡é¡ºåºè¿›ç¨‹</a>ã€‚</p>\n<p>ä¸œå°¼Â·éœå°”çš„çˆ¶äº²æ˜¯ä¸€ä½å…¬åŠ¡å‘˜ï¼ŒæœåŠ¡äº<a href=\"https://zh.wikipedia.org/wiki/%E8%8B%B1%E5%B1%AC%E9%8C%AB%E8%98%AD\" rel=\"noopener nofollow\" target=\"_blank\">è‹±å±é”¡å…°</a>ã€‚å…¶æ¯äº²æ˜¯èŒ¶å›­ä¸»äººçš„å¥³å„¿ã€‚</p>\n<p>ä¸œå°¼Â·éœå°”åœ¨å¯ä¼¦å¡å‡ºç”Ÿï¼Œåœ¨è‹±å›½æœ¬åœŸå—æ•™è‚²ã€‚1956 å¹´ï¼Œåœ¨<a href=\"https://zh.wikipedia.org/wiki/%E7%89%9B%E6%B4%A5%E5%A4%A7%E5%AD%B8\" rel=\"noopener nofollow\" target=\"_blank\">ç‰›æ´¥å¤§å­¦</a><a href=\"https://zh.wikipedia.org/wiki/%E7%89%9B%E6%B4%A5%E5%A4%A7%E5%AD%B8%E5%A2%A8%E9%A0%93%E5%AD%B8%E9%99%A2\" rel=\"noopener nofollow\" target=\"_blank\">å¢¨é¡¿å­¦é™¢</a>å–å¾—<a href=\"https://zh.wikipedia.org/wiki/%E8%A5%BF%E6%B4%8B%E5%8F%A4%E5%85%B8%E5%AD%B8\" rel=\"noopener nofollow\" target=\"_blank\">è¥¿æ´‹å¤å…¸å­¦</a><a href=\"https://zh.wikipedia.org/wiki/%E5%AD%B8%E5%A3%AB\" rel=\"noopener nofollow\" target=\"_blank\">å­¦å£«</a>å­¦ä½ã€‚<a href=\"https://zh.wikipedia.org/wiki/%E6%9D%B1%E5%B0%BC%C2%B7%E9%9C%8D%E7%88%BE#cite_note-MCreg-1\" rel=\"noopener nofollow\" target=\"_blank\">[1]</a>åœ¨å¤§å­¦æ¯•ä¸šåï¼Œè¿›å…¥<a href=\"https://zh.wikipedia.org/wiki/%E8%8B%B1%E5%9C%8B%E7%9A%87%E5%AE%B6%E6%B5%B7%E8%BB%8D\" rel=\"noopener nofollow\" target=\"_blank\">è‹±å›½çš‡å®¶æµ·å†›</a>æœå…µå½¹ 18 ä¸ªæœˆï¼Œ<a href=\"https://zh.wikipedia.org/wiki/%E6%9D%B1%E5%B0%BC%C2%B7%E9%9C%8D%E7%88%BE#cite_note-MCreg-1\" rel=\"noopener nofollow\" target=\"_blank\">[1]</a>åœ¨æ­¤å­¦ä¼š<a href=\"https://zh.wikipedia.org/wiki/%E4%BF%84%E8%AA%9E\" rel=\"noopener nofollow\" target=\"_blank\">ä¿„è¯­</a>ã€‚<a href=\"https://zh.wikipedia.org/wiki/%E6%9D%B1%E5%B0%BC%C2%B7%E9%9C%8D%E7%88%BE#cite_note-Hoare_autobio-2\" rel=\"noopener nofollow\" target=\"_blank\">[2]</a>1958 å¹´é€€ä¼åï¼Œå›åˆ°ç‰›æ´¥å¤§å­¦ï¼Œç ”è¯»ç»Ÿè®¡å­¦ï¼Œå–å¾—å­¦å£«åå­¦ä½ã€‚<a href=\"https://zh.wikipedia.org/wiki/%E6%9D%B1%E5%B0%BC%C2%B7%E9%9C%8D%E7%88%BE#cite_note-MCreg-1\" rel=\"noopener nofollow\" target=\"_blank\">[1]</a>åœ¨æ­¤æœŸé—´ï¼Œå¼€å§‹å­¦ä¹ ç¨‹å¼è®¾è®¡ï¼Œä»–è·Ÿç€<a href=\"https://zh.wikipedia.org/w/index.php?title=Leslie_Fox&amp;action=edit&amp;redlink=1\" rel=\"noopener nofollow\" target=\"_blank\">Leslie Fox</a>å­¦ä¹ <a href=\"https://zh.wikipedia.org/w/index.php?title=Autocode&amp;action=edit&amp;redlink=1\" rel=\"noopener nofollow\" target=\"_blank\">Autocode</a>ã€‚ä¸ºäº†è¿›ä¸€æ­¥å­¦ä¹ <a href=\"https://zh.wikipedia.org/wiki/%E4%BF%84%E8%AA%9E\" rel=\"noopener nofollow\" target=\"_blank\">ä¿„è¯­</a>ï¼Œä»–ä»¥<a href=\"https://zh.wikipedia.org/wiki/%E8%8B%B1%E5%9C%8B%E6%96%87%E5%8C%96%E5%8D%94%E6%9C%83\" rel=\"noopener nofollow\" target=\"_blank\">è‹±å›½æ–‡åŒ–åä¼š</a>çš„äº¤æ¢å­¦ç”Ÿèº«ä»½ï¼Œè‡³<a href=\"https://zh.wikipedia.org/wiki/%E8%98%87%E8%81%AF\" rel=\"noopener nofollow\" target=\"_blank\">è‹è”</a><a href=\"https://zh.wikipedia.org/wiki/%E8%8E%AB%E6%96%AF%E7%A7%91%E5%9C%8B%E7%AB%8B%E5%A4%A7%E5%AD%B8\" rel=\"noopener nofollow\" target=\"_blank\">è«æ–¯ç§‘å›½ç«‹å¤§å­¦</a>ç•™å­¦ï¼Œ<a href=\"https://zh.wikipedia.org/wiki/%E6%9D%B1%E5%B0%BC%C2%B7%E9%9C%8D%E7%88%BE#cite_note-MCreg-1\" rel=\"noopener nofollow\" target=\"_blank\">[1]</a>è·Ÿéš<a href=\"https://zh.wikipedia.org/wiki/%E5%AE%89%E5%BE%B7%E9%9B%B7%C2%B7%E6%9F%AF%E7%88%BE%E8%8E%AB%E5%93%A5%E6%B4%9B%E5%A4%AB\" rel=\"noopener nofollow\" target=\"_blank\">å®‰å¾·é›·Â·æŸ¯å°”è«å“¥æ´›å¤«</a>å­¦ä¹ æ•°å­¦ï¼Œå¹¶ç ”ç©¶<a href=\"https://zh.wikipedia.org/wiki/%E6%A9%9F%E5%99%A8%E7%BF%BB%E8%AD%AF\" rel=\"noopener nofollow\" target=\"_blank\">æœºå™¨ç¿»è¯‘</a>ã€‚<a href=\"https://zh.wikipedia.org/wiki/%E6%9D%B1%E5%B0%BC%C2%B7%E9%9C%8D%E7%88%BE#cite_note-Hoare_autobio-2\" rel=\"noopener nofollow\" target=\"_blank\">[2]</a></p>\n<p>1960 å¹´ï¼Œåœ¨<a href=\"https://zh.wikipedia.org/wiki/%E8%8E%AB%E6%96%AF%E7%A7%91%E5%9C%8B%E7%AB%8B%E5%A4%A7%E5%AD%B8\" rel=\"noopener nofollow\" target=\"_blank\">è«æ–¯ç§‘å›½ç«‹å¤§å­¦</a>å–å¾—<a href=\"https://zh.wikipedia.org/wiki/%E5%8D%9A%E5%A3%AB%E5%AD%A6%E4%BD%8D\" rel=\"noopener nofollow\" target=\"_blank\">åšå£«å­¦ä½</a>åï¼Œä»»èŒäºä¼¦æ•¦<a href=\"https://zh.wikipedia.org/w/index.php?title=%E8%89%BE%E7%95%A5%E7%89%B9%E5%85%84%E5%BC%9F%E5%85%AC%E5%8F%B8&amp;action=edit&amp;redlink=1\" rel=\"noopener nofollow\" target=\"_blank\">è‰¾ç•¥ç‰¹å…„å¼Ÿå…¬å¸</a>ï¼ˆElliott Brothers Ltdï¼‰ï¼Œå¼€å‘å‡ºç¬¬ä¸€ä¸ªå•†ç”¨çš„<a href=\"https://zh.wikipedia.org/wiki/ALGOL_60\" rel=\"noopener nofollow\" target=\"_blank\">ALGOL 60</a>ç¼–è¯‘å™¨ï¼Œå¾ˆå¿«å°±æˆä¸ºå…¬å¸çš„é¦–å¸­å·¥ç¨‹å¸ˆã€‚</p>\n<p>1968 å¹´ï¼Œæˆä¸º<a href=\"https://zh.wikipedia.org/wiki/%E8%B2%9D%E7%88%BE%E6%B3%95%E6%96%AF%E7%89%B9%E5%A5%B3%E7%8E%8B%E5%A4%A7%E5%AD%B8\" rel=\"noopener nofollow\" target=\"_blank\">è´å°”æ³•æ–¯ç‰¹å¥³ç‹å¤§å­¦</a>çš„æ•™æˆã€‚1977 å¹´å›åˆ°<a href=\"https://zh.wikipedia.org/wiki/%E7%89%9B%E6%B4%A5%E5%A4%A7%E5%AD%B8\" rel=\"noopener nofollow\" target=\"_blank\">ç‰›æ´¥å¤§å­¦</a>æ‹…ä»»æ•™æˆã€‚ç°ä¸ºç‰›æ´¥å¤§å­¦è£èª‰æ•™æˆï¼Œå¹¶åœ¨å‰‘æ¡¥<a href=\"https://zh.wikipedia.org/wiki/%E5%BE%AE%E8%BB%9F%E7%A0%94%E7%A9%B6%E9%99%A2\" rel=\"noopener nofollow\" target=\"_blank\">å¾®è½¯ç ”ç©¶é™¢</a>æ‹…ä»»ç ”ç©¶å‘˜ã€‚</p>\n<p><img alt=\"æŸ¥å°”æ–¯Â·å®‰ä¸œå°¼Â·ç†æŸ¥å¾·Â·éœå°”çˆµå£«\" src=\"https://img2024.cnblogs.com/blog/997046/202601/997046-20260112213059697-501020170.jpg\" /></p>\n<h2 id=\"c-net-äº¤æµç¾¤\">C# .NET äº¤æµç¾¤</h2>\n<p>ç›¸ä¿¡å¤§å®¶åœ¨å¼€å‘ä¸­ç»å¸¸ä¼šé‡åˆ°ä¸€äº›æ€§èƒ½é—®é¢˜ï¼Œè‹¦äºæ²¡æœ‰æœ‰æ•ˆçš„å·¥å…·å»å‘ç°æ€§èƒ½ç“¶é¢ˆï¼Œæˆ–è€…æ˜¯å‘ç°ç“¶é¢ˆä»¥åä¸çŸ¥é“è¯¥å¦‚ä½•ä¼˜åŒ–ã€‚ä¹‹å‰ä¸€ç›´æœ‰è¯»è€…æœ‹å‹è¯¢é—®æœ‰æ²¡æœ‰æŠ€æœ¯äº¤æµç¾¤ï¼Œä½†æ˜¯ç”±äºå„ç§åŸå› ä¸€ç›´éƒ½æ²¡åˆ›å»ºï¼Œç°åœ¨å¾ˆé«˜å…´çš„åœ¨è¿™é‡Œå®£å¸ƒï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªä¸“é—¨äº¤æµ.NET æ€§èƒ½ä¼˜åŒ–ç»éªŒçš„ç¾¤ç»„ï¼Œä¸»é¢˜åŒ…æ‹¬ä½†ä¸é™äºï¼š</p>\n<ul>\n<li>å¦‚ä½•æ‰¾åˆ°.NET æ€§èƒ½ç“¶é¢ˆï¼Œå¦‚ä½¿ç”¨ APMã€dotnet tools ç­‰å·¥å…·</li>\n<li>.NET æ¡†æ¶åº•å±‚åŸç†çš„å®ç°ï¼Œå¦‚åƒåœ¾å›æ”¶å™¨ã€JIT ç­‰ç­‰</li>\n<li>å¦‚ä½•ç¼–å†™é«˜æ€§èƒ½çš„.NET ä»£ç ï¼Œå“ªäº›åœ°æ–¹å­˜åœ¨æ€§èƒ½é™·é˜±</li>\n</ul>\n<p>å¸Œæœ›èƒ½æœ‰æ›´å¤šå¿—åŒé“åˆæœ‹å‹åŠ å…¥ï¼Œåˆ†äº«ä¸€äº›å·¥ä½œä¸­é‡åˆ°çš„.NET é—®é¢˜å’Œå®è´µçš„åˆ†æä¼˜åŒ–ç»éªŒã€‚<strong>ç›®å‰ä¸€ç¾¤å·²æ»¡ï¼Œç°åœ¨å¼€æ”¾äºŒç¾¤ã€‚</strong>å¯ä»¥åŠ æˆ‘ vxï¼Œæˆ‘æ‹‰ä½ è¿›ç¾¤: <strong>ls1075</strong> å¦å¤–ä¹Ÿåˆ›å»ºäº† <strong>QQ Group</strong>: 687779078ï¼Œæ¬¢è¿å¤§å®¶åŠ å…¥ã€‚</p>\n<h3 id=\"æœ¬å‘¨ç¾¤èŠåˆ†æ\">æœ¬å‘¨ç¾¤èŠåˆ†æ</h3>\n<p><img alt=\"image-20260112212730495\" src=\"https://img2024.cnblogs.com/blog/997046/202601/997046-20260112213059747-418753626.jpg\" /></p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-12 21:32</span>&nbsp;\n<a href=\"https://www.cnblogs.com/InCerry\">InCerry</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">3</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "ä¸ºä»€ä¹ˆæœ‰çš„äººè¯´â€œè¶Šè€æ€ç»´è¶Šå›ºåŒ–â€ï¼Ÿæ€ä¹ˆæ‰èƒ½å…·å¤‡æˆé•¿å‹æ€ç»´ï¼Ÿ",
      "link": "https://www.cnblogs.com/jiujuan/p/19473443",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/jiujuan/p/19473443\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-12 18:25\">\n    <span>ä¸ºä»€ä¹ˆæœ‰çš„äººè¯´â€œè¶Šè€æ€ç»´è¶Šå›ºåŒ–â€ï¼Ÿæ€ä¹ˆæ‰èƒ½å…·å¤‡æˆé•¿å‹æ€ç»´ï¼Ÿ</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h2 id=\"ä¸€å‰è¨€ä¸ºä»€ä¹ˆæœ‰çš„äººè¯´è¶Šè€æ€ç»´è¶Šå›ºåŒ–\">ä¸€ï¼šå‰è¨€ï¼šä¸ºä»€ä¹ˆæœ‰çš„äººè¯´è¶Šè€æ€ç»´è¶Šå›ºåŒ–</h2>\n<p>åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸å¬åˆ°è¿™æ ·çš„è¯´æ³•ï¼š\"äººè€äº†å°±å˜å¾—å›ºæ‰§äº†\"ã€\"å¹´è½»äººçš„æƒ³æ³•å°±æ˜¯çµæ´»\"ã€\"ä¸­å¹´ä¹‹åå­¦ä¹ èƒ½åŠ›å°±ä¸‹é™äº†\"ã€‚</p>\n<p>è¿™äº›è§‚å¿µæ ¹æ·±è’‚å›ºï¼Œä»¥è‡³äºè®¸å¤šäººå°†å¹´é¾„å¢é•¿ä¸æ€ç»´å›ºåŒ–ç”»ä¸Šç­‰å·ï¼Œè®¤ä¸ºéšç€å²æœˆçš„æ¨ç§»ï¼Œæ”¹å˜å’Œæˆé•¿å˜å¾—è¶Šæ¥è¶Šä¸å¯èƒ½ã€‚</p>\n<p>ç„¶è€Œï¼Œæ–¯å¦ç¦å¤§å­¦å¿ƒç†å­¦å®¶å¡ç½—å°”Â·å¾·éŸ¦å…‹çš„ç ”ç©¶å½»åº•é¢ è¦†äº†è¿™ä¸€ä¼ ç»Ÿè®¤çŸ¥ï¼Œå¥¹æå‡ºçš„\"æˆé•¿å‹æ€ç»´\"æ¦‚å¿µæ­ç¤ºäº†ä¸€ä¸ªä»¤äººæŒ¯å¥‹çš„äº‹å®ï¼š<br />\n<strong>å¤§è„‘å…·æœ‰ç»ˆèº«å¯å¡‘æ€§ï¼Œæ€ç»´æ¨¡å¼çš„é€‰æ‹©å–å†³äºæˆ‘ä»¬å¯¹å¾…èƒ½åŠ›å’ŒæŒ‘æˆ˜çš„æ€åº¦ï¼Œè€Œéä¸å¯æ”¹å˜çš„ç”Ÿç†å®¿å‘½</strong>ã€‚</p>\n<p>æˆé•¿å‹æ€ç»´çš„æ ¸å¿ƒä¿¡å¿µï¼šèƒ½åŠ›æ˜¯å¯å¡‘çš„ã€‚</p>\n<blockquote>\n<p>è®¤ä¸ºäººçš„æ‰æ™ºå’Œèƒ½åŠ›ä¸æ˜¯å¤©ç”Ÿçš„å›ºå®šå€¼ï¼Œæ‰æ™ºå’Œèƒ½åŠ›æ˜¯å¯ä»¥é€šè¿‡åå¤©åŠªåŠ›ï¼Œé€šè¿‡åˆ»æ„ç»ƒä¹ å’Œç­–ç•¥æ”¹è¿›ï¼Œå¹¶é•¿æœŸåšæŒï¼Œæ˜¯èƒ½å¤Ÿä¸æ–­å‘å±•æé«˜çš„ã€‚</p>\n</blockquote>\n<p>ä¸ä¹‹ç›¸å¯¹çš„æ˜¯\"å›ºå®šå‹æ€ç»´\"â€”â€”ç›¸ä¿¡äººçš„åŸºæœ¬èƒ½åŠ›æ˜¯å¤©ç”Ÿå›ºå®šå€¼ã€éš¾ä»¥æ”¹å˜çš„ã€‚</p>\n<p>è¿™ä¸¤ç§æ€ç»´æ¨¡å¼å¹¶éç®€å•çš„æ€§æ ¼æ ‡ç­¾ï¼Œè€Œæ˜¯å½±å“ç€æˆ‘ä»¬åœ¨äººç”Ÿé˜¶æ®µåšå‡ºé€‰æ‹©ã€‚ä¸€ä¸ªæ‹¥æœ‰æˆé•¿å‹æ€ç»´çš„äººï¼Œä¼šå°†æŒ«æŠ˜è§†ä¸ºå­¦ä¹ æœºä¼šï¼Œå°†æ‰¹è¯„å½“ä½œåé¦ˆï¼Œå°†åŠªåŠ›è§†ä¸ºé€šå‘ä¸æ–­æˆé•¿çš„å¿…ç»ä¹‹è·¯ã€‚è€Œå›ºå®šå‹æ€ç»´çš„äººï¼Œå›é¿æŒ‘æˆ˜ï¼Œå°†å¤±è´¥è§†ä¸ºè‡ªèº«ä¸è¶³ï¼Œå‘†åœ¨è‡ªå·±çš„èˆ’é€‚åŒºã€‚</p>\n<h2 id=\"äºŒä¸¤ç§æ€ç»´çš„ç§‘å­¦åˆ†æ\">äºŒï¼šä¸¤ç§æ€ç»´çš„ç§‘å­¦åˆ†æ</h2>\n<h3 id=\"ç¥ç»ç§‘å­¦çš„è§’åº¦æ¥çœ‹\">ç¥ç»ç§‘å­¦çš„è§’åº¦æ¥çœ‹</h3>\n<p>æˆé•¿å‹æ€ç»´çš„é©å‘½æ€§åœ¨äºå®ƒå¯¹\"èƒ½åŠ›\"è¿™ä¸€æ¦‚å¿µçš„é‡æ–°å®šä¹‰ã€‚ä¼ ç»Ÿè§‚å¿µå¾€å¾€å°†èƒ½åŠ›è§†ä¸ºæŸç§å›ºå®šçš„å®¹å™¨â€”â€”ä½ ç”Ÿæ¥æœ‰å¤šå¤§å®¹é‡ï¼Œè¿™è¾ˆå­åŸºæœ¬å°±å±€é™åœ¨è¿™ä¸ªèŒƒå›´å†…ã€‚å¾·éŸ¦å…‹çš„ç ”ç©¶è¡¨æ˜ï¼Œè¿™ç§è§£é‡Šæ˜¯ç‰‡é¢çš„ã€‚äº‹å®ä¸Šï¼Œäººç±»çš„å¤§è„‘å’Œè®¤çŸ¥èƒ½åŠ›æ›´åƒæ˜¯ä¸€ç‰‡ç”Ÿæ€æ—ï¼Œè€Œéä¸€ä¸ªæœ‰é™çš„å®¹å™¨ã€‚è¿™ç‰‡ç”Ÿæ€æ—èƒ½å¤Ÿä¸æ–­æ‰©å±•ã€æ·±åŒ–å’Œé‡æ–°ç»„ç»‡ï¼Œå…¶æ½œåŠ›è¿œè¶…æˆ‘ä»¬é€šå¸¸æ‰€æƒ³è±¡çš„èŒƒå›´ã€‚</p>\n<p>ä»ç¥ç»ç§‘å­¦çš„è§’åº¦æ¥çœ‹ï¼Œå¤§è„‘çš„å¯å¡‘æ€§æ˜¯ç»ˆèº«çš„ã€‚</p>\n<p>è™½ç„¶å¤§è„‘åœ¨é’å°‘å¹´æ—¶æœŸç¡®å®ç»å†ç€å‰§çƒˆçš„é‡å¡‘è¿‡ç¨‹ï¼Œç¥ç»å…ƒä¹‹é—´çš„çªè§¦è¿æ¥ç»å†ç€å¤§è§„æ¨¡çš„ä¿®å‰ªã€è¿æ¥å’Œå¼ºåŒ–ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æˆå¹´åå¤§è„‘å°±å¤±å»äº†æ”¹å˜çš„èƒ½åŠ›ã€‚</p>\n<p>æ–°çš„ç¥ç»è¿æ¥å¯ä»¥åœ¨ä»»ä½•å¹´é¾„å½¢æˆï¼Œæ–°çš„æŠ€èƒ½å¯ä»¥è¢«å­¦ä¹ ï¼Œæ–°çš„ä¹ æƒ¯å¯ä»¥è¢«åŸ¹å…»ã€‚å‰‘æ¡¥å¤§å­¦çš„ä¸€é¡¹ç ”ç©¶è¿½è¸ªäº†æˆå¹´äººåœ¨å­¦ä¹ æ–°æŠ€èƒ½æ—¶çš„å¤§è„‘å˜åŒ–ï¼Œå‘ç°å³ä½¿æ˜¯äº”åå²ä»¥ä¸Šçš„æˆå¹´äººï¼Œåœ¨å­¦ä¹ å¤æ‚æŠ€èƒ½ï¼ˆå¦‚æ‚è€æˆ–æ–°çš„è¯­è¨€ï¼‰æ—¶ï¼Œå¤§è„‘çš®å±‚çš„ç»“æ„ä¹Ÿä¼šå‘ç”Ÿå¯æµ‹é‡çš„å˜åŒ–ã€‚è¿™æ„å‘³ç€å¤§è„‘å®šå‹è®ºæœ¬èº«å°±æ˜¯ä¸€ä¸ªéœ€è¦è¢«æŠ›å¼ƒçš„å›ºå®šå‹æ€ç»´ã€‚</p>\n<h3 id=\"å›ºå®šå‹æ€ç»´å¿ƒç†è§’åº¦æ¥çœ‹\">å›ºå®šå‹æ€ç»´å¿ƒç†è§’åº¦æ¥çœ‹</h3>\n<p>ç†è§£å›ºå®šå‹æ€ç»´çš„è¿ä½œæœºåˆ¶ï¼Œå¯¹äºæ‰“ç ´å®ƒè‡³å…³é‡è¦ã€‚</p>\n<p>å›ºå®šå‹æ€ç»´å¹¶éç®€å•çš„ä¸æ„¿æ„æ”¹å˜ï¼Œè€Œæ˜¯ä¸€å¥—å¤æ‚çš„å¿ƒç†é˜²å¾¡ç³»ç»Ÿã€‚</p>\n<p>è¿™ä¸ªç³»ç»Ÿåœ¨æˆ‘ä»¬é¢å¯¹æŒ‘æˆ˜ã€æŒ«æŠ˜å’Œä¸ç¡®å®šæ€§æ—¶è‡ªåŠ¨å¯åŠ¨ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¿æŠ¤æˆ‘ä»¬çš„è‡ªæˆ‘æ¦‚å¿µå’Œè‡ªå°Šã€‚å½“æˆ‘ä»¬æ‹¥æœ‰å›ºå®šå‹æ€ç»´æ—¶ï¼Œæ¯ä¸€æ¬¡å¤±è´¥éƒ½ä¸ä»…ä»…æ˜¯ä¸€æ¬¡æŒ«æŠ˜ï¼Œè€Œæ˜¯å¯¹è‡ªæˆ‘ä»·å€¼çš„å¦å®šï¼›æ¯ä¸€æ¬¡æŒ‘æˆ˜éƒ½ä¸ä»…ä»…æ˜¯å­¦ä¹ æœºä¼šï¼Œè€Œæ˜¯æš´éœ²è‡ªèº«ä¸è¶³çš„é£é™©ã€‚</p>\n<p>å› æ­¤ï¼Œå›ºå®šå‹æ€ç»´çš„äººä¼šå€¾å‘äºé€‰æ‹©å®‰å…¨çš„ã€èƒ½å¤Ÿè¯æ˜è‡ªå·±èƒ½åŠ›çš„ä»»åŠ¡ï¼Œå›é¿é‚£äº›å¯èƒ½å¯¼è‡´å¤±è´¥çš„æŒ‘æˆ˜ã€‚</p>\n<p>è¿™ç§æ€ç»´æ¨¡å¼çš„å½¢æˆå¾€å¾€å¯ä»¥è¿½æº¯åˆ°ç«¥å¹´æ—¶æœŸçš„ç»å†ã€‚<br />\nå½“çˆ¶æ¯å’Œè€å¸ˆè¿‡åº¦å¼ºè°ƒç»“æœè€Œéè¿‡ç¨‹ï¼Œå½“æˆåŠŸè¢«å®šä¹‰ä¸º\"èµ¢\"è€Œå¤±è´¥è¢«å®šä¹‰ä¸º\"ä¸¢è„¸\"ï¼Œå½“åŠªåŠ›è¢«è§†ä¸ºå¤©èµ‹ä¸è¶³çš„æ ‡å¿—æ—¶ï¼Œå„¿ç«¥å°±é€æ¸å½¢æˆäº†å…³äºèƒ½åŠ›å’ŒæˆåŠŸçš„å›ºå®šå‹ä¿¡å¿µã€‚</p>\n<p>è¿™äº›ä¿¡å¿µä¸€æ—¦å†…åŒ–ï¼Œå°±ä¼šæˆä¸ºè¿‡æ»¤ä¸–ç•Œä¿¡æ¯çš„é€é•œâ€”â€”åŒæ ·çš„ç»å†ä¼šè¢«ä¸åŒæ€ç»´æ¨¡å¼çš„äººåšå‡ºæˆªç„¶ä¸åŒçš„è§£è¯»ã€‚</p>\n<h2 id=\"ä¸‰ä¸¤ç§ä¸åŒæ€ç»´çš„è¡¨ç°\">ä¸‰ï¼šä¸¤ç§ä¸åŒæ€ç»´çš„è¡¨ç°</h2>\n<p>ä¸€ä¸ªæ‹¥æœ‰æˆé•¿å‹æ€ç»´çš„äººé‡åˆ°ä¸ä¼šçš„äº‹æƒ…ï¼Œä¼šæƒ³ï¼š\"æˆ‘è¿˜æ²¡æŒæ¡è¿™ä¸ªï¼Œä½†æˆ‘å¯ä»¥é€šè¿‡ç»ƒä¹ æ¥æé«˜\"ï¼Œè€Œä¸€ä¸ªæ‹¥æœ‰å›ºå®šå‹æ€ç»´çš„åˆ™å¯èƒ½æƒ³ï¼š\"æˆ‘å°±æ˜¯ä¸æ“…é•¿è¿™ä¸ªï¼Œè¿™æ˜¯å¤©ç”Ÿçš„\"ã€‚</p>\n<p>è¿™ç§è®¤çŸ¥å·®å¼‚ä¼šåœ¨å¤šå¹´åäº§ç”Ÿå·¨å¤§çš„ç´¯ç§¯æ•ˆåº”ï¼Œå½±å“å­¦ä¸šã€èŒä¸šã€äººé™…å…³ç³»å’Œä»¥åçš„ç”Ÿæ´»æ€åº¦ã€‚</p>\n<p>åœ¨å­¦ä¹ ä¸æˆé•¿ç»´åº¦ä¸Šï¼Œæ‹¥æœ‰æˆé•¿å‹æ€ç»´çš„äººå°†é”™è¯¯è§†ä¸ºå®è´µçš„åé¦ˆï¼Œå°†å›°éš¾è§†ä¸ºæˆé•¿çš„å‚¬åŒ–å‰‚ã€‚ä»–ä»¬ç›¸ä¿¡\"ä¸ä¼š\"åªæ˜¯\"æš‚æ—¶è¿˜ä¸ä¼š\"ï¼Œå› æ­¤æ›´æ„¿æ„èµ°å‡ºèˆ’é€‚åŒºï¼Œæ¥å—æŒ‘æˆ˜ã€‚</p>\n<p>åœ¨äººé™…å…³ç³»ä¸­ï¼Œæˆé•¿å‹æ€ç»´å¸®åŠ©äººä»¬å°†å†²çªè§†ä¸ºç†è§£å’Œæ·±åŒ–å…³ç³»çš„æœºä¼šï¼Œè€Œéè¯æ˜å¯¹æ–¹æ˜¯é”™çš„è¯æ®ã€‚</p>\n<p><strong>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œæˆé•¿å‹æ€ç»´å¹¶ä¸æ„å‘³ç€ç›²ç›®ä¹è§‚æˆ–å¿½è§†ç°å®</strong>ã€‚</p>\n<p>æˆé•¿å‹æ€ç»´æ˜¯å…³äºè¿‡ç¨‹çš„æ€ç»´â€”â€”å®ƒæ‰¿è®¤å½“å‰çš„çŠ¶æ€ï¼Œè®¤å¯åŠªåŠ›çš„ä»·å€¼ï¼Œç›¸ä¿¡æ”¹è¿›çš„å¯èƒ½æ€§ï¼ŒåŒæ—¶è„šè¸å®åœ°é‡‡å–è¡ŒåŠ¨ã€‚</p>\n<p>ä¸¤ç§æ€ç»´å¯¹æ¯”å›¾ï¼š</p>\n<p><img alt=\"æˆé•¿å‹æ€ç»´å’Œå›ºå®šå‹æ€ç»´å¯¹æ¯”å›¾\" src=\"https://img2024.cnblogs.com/blog/650581/202601/650581-20260112193839386-1115149159.png\" /><br />\nï¼ˆå›¾ç‰‡æ¥è‡ªï¼šå¡ç½—å°”Â·å¾·éŸ¦å…‹ã€Šç»ˆèº«æˆé•¿ã€‹ï¼‰</p>\n<h2 id=\"å››æ˜¯ä»€ä¹ˆé˜»ç¢äº†æˆé•¿å‹æ€ç»´å½¢æˆ\">å››ï¼šæ˜¯ä»€ä¹ˆé˜»ç¢äº†æˆé•¿å‹æ€ç»´å½¢æˆï¼Ÿ</h2>\n<h3 id=\"æ—©æœŸæ•™è‚²çš„å½±å“\">æ—©æœŸæ•™è‚²çš„å½±å“</h3>\n<p>ç«¥å¹´ç»å†å¯¹æ€ç»´æ¨¡å¼çš„å¡‘é€ å…·æœ‰é‡å¤§çš„å½±å“ï¼Œè¿™ç§å½±å“å¾€å¾€åœ¨æˆ‘ä»¬è¿˜æ— æ³•ç”¨è¯­è¨€è¡¨è¾¾çš„æ—¶å€™å°±å·²ç»å¼€å§‹ã€‚</p>\n<p>å¿ƒç†å­¦å®¶è¯†åˆ«å‡ºå‡ ç§å…¸å‹çš„æ•™è‚²è¡Œä¸ºï¼Œå®ƒä»¬åœ¨æ— æ„ä¸­å¼ºåŒ–äº†å›ºå®šå‹æ€ç»´ã€‚</p>\n<p>ç¬¬ä¸€ç§æ˜¯è¿‡åº¦èµç¾å¤©èµ‹è€ŒéåŠªåŠ›ã€‚å½“å­©å­å®ŒæˆæŸä»¶äº‹æ—¶ï¼Œå¦‚æœæˆäººçš„åé¦ˆé›†ä¸­åœ¨â€œä½ çœŸèªæ˜â€ã€â€œä½ çœŸæœ‰å¤©èµ‹â€ä¸Šï¼Œå­©å­å°±ä¼šå°†è¿™äº›å¤–åœ¨çš„ã€ä¸å¯æ§çš„ç‰¹è´¨ä¸è‡ªæˆ‘ä»·å€¼è”ç³»èµ·æ¥ã€‚è¿™æ„å‘³ç€å½“ä»–ä»¬é‡åˆ°å›°éš¾æ—¶ï¼Œä¼šæ‹…å¿ƒå¤±å»èªæ˜çš„æ ‡ç­¾ï¼Œä»è€Œå›é¿æŒ‘æˆ˜ã€‚</p>\n<p>ç¬¬äºŒç§æ˜¯å°†å¤±è´¥ä¸èº«ä»½ç­‰åŒã€‚å¦‚æœå­©å­åœ¨å¤±è´¥æ—¶å¬åˆ°çš„æ˜¯â€œä½ æ€ä¹ˆè¿™ä¹ˆç¬¨â€ã€â€œä½ ä¸è¡Œâ€è¿™æ ·çš„è¯ï¼Œä»–ä»¬å°±ä¼šå°†å¤±è´¥å†…åŒ–ä¸ºè‡ªæˆ‘å®šä¹‰çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¯ä»¥æ”¹å˜çš„çŠ¶æ€ã€‚</p>\n<p>æ•™è‚²ç¯å¢ƒä¸­çš„è¯„ä»·ä½“ç³»ä¹Ÿèµ·ç€å…³é”®ä½œç”¨ã€‚å½“å­¦æ ¡å’Œç¤¾ä¼šé«˜åº¦å¼ºè°ƒæ ‡å‡†åŒ–è€ƒè¯•æˆç»©ã€å½“å­¦ç”Ÿè¢«æ’åå’Œæ¯”è¾ƒã€å½“æ­£ç¡®ç­”æ¡ˆè¢«è¿‡åº¦å¼ºè°ƒæ—¶ï¼Œå­¦ç”Ÿå°±å­¦ä¼šäº†å…³æ³¨ç»“æœè€Œéè¿‡ç¨‹ï¼Œå…³æ³¨è¯æ˜è‡ªå·±è€Œéæå‡è‡ªå·±ã€‚</p>\n<p>è¿™ç§ç¯å¢ƒä¸‹ï¼Œå³ä½¿å£å¤´ä¸Šå¼ºè°ƒè¿‡ç¨‹æ¯”ç»“æœé‡è¦ï¼Œå®é™…è¡ŒåŠ¨ä¼ é€’çš„ä¿¡æ¯å´æˆªç„¶ç›¸åã€‚å­©å­ä»¬æ˜¯éå¸¸æ•é”çš„ä¿¡æ¯æ¥æ”¶è€…ï¼Œä»–ä»¬èƒ½å¤Ÿä»æˆäººè¡Œä¸ºçš„ç»†å¾®å·®åˆ«ä¸­ï¼Œåˆ¤æ–­ä»€ä¹ˆæ‰æ˜¯çœŸæ­£è¢«é‡è§†çš„ã€‚</p>\n<p>ç ”ç©¶è¡¨æ˜ï¼Œåœ¨å¼ºè°ƒåŠªåŠ›å’Œè¿›æ­¥çš„ç¯å¢ƒä¸­æˆé•¿çš„å­©å­ï¼Œä¸ä»…å­¦ä¸šè¡¨ç°æ›´å¥½ï¼Œè€Œä¸”é¢å¯¹æŒ«æŠ˜æ—¶æ›´åŠ åšéŸ§ï¼Œæ›´æ„¿æ„è¿½æ±‚æŒ‘æˆ˜æ€§çš„ç›®æ ‡ã€‚</p>\n<p>å®¶åº­æ°›å›´ä¸­çš„éšæ€§ä¿¡æ¯åŒæ ·é‡è¦ã€‚</p>\n<p>å¦‚æœçˆ¶æ¯æœ¬èº«æŒæœ‰å›ºå®šå‹æ€ç»´â€”â€”ä¾‹å¦‚ç»å¸¸è¡¨è¾¾\"æˆ‘å°±æ˜¯ä¸æ“…é•¿æ•°å­¦\"æˆ–\"äººè€äº†å­¦ä¸äº†æ–°ä¸œè¥¿\"â€”â€”å­©å­å°±ä¼šåœ¨è€³æ¿¡ç›®æŸ“ä¸­å¸æ”¶è¿™äº›è§‚å¿µã€‚</p>\n<p>æ›´å¾®å¦™çš„æ˜¯ï¼Œçˆ¶æ¯å¦‚ä½•å¯¹å¾…è‡ªå·±çš„é”™è¯¯å’Œå¤±è´¥ï¼Œä¼šç›´æ¥å½±å“å­©å­å¯¹å¾…è¿™äº›é—®é¢˜çš„æ–¹å¼ã€‚å¦‚æœçˆ¶æ¯åœ¨çŠ¯é”™æ—¶è¡¨ç°å‡ºè‡ªè´£ã€ç¾è€»æˆ–é˜²å¾¡ï¼Œå­©å­å°±ä¼šå°†è¿™äº›æƒ…ç»ªååº”æ¨¡å¼å†…åŒ–ã€‚</p>\n<p>ç›¸åï¼Œå¦‚æœçˆ¶æ¯èƒ½å¤Ÿå¹³é™åœ°æ‰¿è®¤é”™è¯¯å¹¶è®¨è®ºæ”¹è¿›æ–¹æ³•ï¼Œå­©å­å°±å­¦ä¼šäº†ä»¥æˆé•¿å‹çš„æ–¹å¼å¯¹å¾…å¤±è¯¯ã€‚</p>\n<h3 id=\"å¤§è„‘å‘è‚²ä¸è®¤çŸ¥å˜åŒ–\">å¤§è„‘å‘è‚²ä¸è®¤çŸ¥å˜åŒ–</h3>\n<p>å¤§è„‘å‘è‚²çš„å¤æ‚æ€§ä¸ºç†è§£æ€ç»´æ¨¡å¼æä¾›äº†ç¥ç»ç”Ÿç‰©å­¦çš„åŸºç¡€ã€‚</p>\n<p>å‰é¢å¶çš®å±‚â€”â€”è´Ÿè´£æ‰§è¡ŒåŠŸèƒ½ã€è®¡åˆ’ã€å†²åŠ¨æ§åˆ¶å’ŒæŠ½è±¡æ€ç»´çš„å¤§è„‘åŒºåŸŸâ€”â€”æ˜¯äººç±»å¤§è„‘ä¸­æœ€æ™šæˆç†Ÿçš„åŒºåŸŸä¹‹ä¸€ã€‚å®ƒçš„å‘è‚²ä»é’æ˜¥æœŸå¼€å§‹ï¼Œä¸€ç›´å»¶ç»­åˆ°äºŒåäº”å²å·¦å³ã€‚</p>\n<p>è¿™æ„å‘³ç€å¹´è½»äººåœ¨åˆ¤æ–­ã€è§„åˆ’å’Œè°ƒèŠ‚æƒ…ç»ªæ–¹é¢çš„èƒ½åŠ›ç¡®å®ä¸æˆå¹´äººå­˜åœ¨å·®å¼‚ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£é‡Šäº†ä¸ºä»€ä¹ˆé’å°‘å¹´æœ‰æ—¶ä¼šåšå‡ºå†²åŠ¨çš„å†³å®šã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ„å‘³ç€å¹´è½»äººçš„æ€ç»´å°±æ˜¯å›ºåŒ–çš„ï¼Œæ°æ°ç›¸åï¼Œé’å°‘å¹´å¤§è„‘çš„é«˜åº¦å¯å¡‘æ€§ä½¿å¾—è¿™ä¸ªé˜¶æ®µæ˜¯åŸ¹å…»æˆé•¿å‹æ€ç»´çš„ç»ä½³æ—¶æœºã€‚</p>\n<p>éšç€å¹´é¾„å¢é•¿ï¼Œå¤§è„‘ç¡®å®ä¼šç»å†ä¸€äº›å˜åŒ–ï¼Œæˆå¹´åï¼Œå¤§è„‘ä»ç„¶ä¿æŒç€å¯å¡‘æ€§ï¼Œå°½ç®¡å…¶è¿ä½œæ–¹å¼ä¸å¹´è½»æ—¶æœŸæœ‰æ‰€ä¸åŒã€‚</p>\n<p>è€å¹´å¤§è„‘åœ¨æŸäº›æ–¹é¢ç”šè‡³å…·æœ‰ä¼˜åŠ¿ï¼šç ”ç©¶è¡¨æ˜ï¼Œè€å¹´äººåœ¨æ•´åˆå¤æ‚ä¿¡æ¯ã€æƒ…ç»ªè°ƒèŠ‚å’Œåˆ©ç”¨å·²æœ‰çŸ¥è¯†æ–¹é¢å¾€å¾€è¡¨ç°å‡ºè‰²ã€‚</p>\n<p>æ‰€è°“çš„è®¤çŸ¥è¡°é€€åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å¯ä»¥è¢«ç”Ÿæ´»æ–¹å¼å› ç´ æ‰€å½±å“çš„â€”â€”åŒ…æ‹¬è®¤çŸ¥æ´»åŠ¨ã€ç¤¾ä¼šå‚ä¸ã€ä½“è‚²é”»ç‚¼å’Œé¥®é£Ÿç­‰ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå¤§è„‘çš„å¯å¡‘æ€§æ˜¯åŒºåŸŸç‰¹å¼‚æ€§çš„ï¼Œè¿™æ„å‘³ç€ç‰¹å®šç±»å‹çš„è®­ç»ƒå¯ä»¥åœ¨ç›¸åº”åŒºåŸŸå¢å¼ºåŠŸèƒ½ï¼Œå³ä½¿åœ¨å…¶ä»–åŒºåŸŸå¯èƒ½å‡ºç°å¹´é¾„ç›¸å…³å˜åŒ–çš„æƒ…å†µä¸‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>\n<p>å€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼Œç¥ç»å¯å¡‘æ€§æ˜¯åŒå‘çš„ã€‚å¤§è„‘ä¸ä»…ä¼šå› ä¸ºä¸ä½¿ç”¨è€Œ\"ç”Ÿé”ˆ\"ï¼Œä¹Ÿä¼šå› ä¸ºç§¯æä½¿ç”¨è€Œå‘å±•ã€‚è¿™è¢«ç§°ä¸º\"ç”¨è¿›åºŸé€€\"åŸåˆ™ï¼Œåœ¨è®¤çŸ¥å¿ƒç†å­¦å’Œç¥ç»ç§‘å­¦ä¸­æœ‰ç€å……åˆ†çš„å®è¯æ”¯æŒã€‚</p>\n<p>æˆé•¿å‹æ€ç»´æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å¯¹å¤§è„‘å¯å¡‘æ€§çš„ä¿¡å¿µçš„ä¸€ç§â€œåˆ©ç”¨â€ã€‚å½“æˆ‘ä»¬ç›¸ä¿¡æ”¹å˜æ˜¯å¯èƒ½çš„ï¼Œæˆ‘ä»¬å°±ä¼šæŠ•å…¥åŠªåŠ›å»å®ç°æ”¹å˜ï¼Œè€Œè¿™ç§æŠ•å…¥æœ¬èº«åˆä¼šä¿ƒè¿›å®é™…çš„ç¥ç»å˜åŒ–ï¼Œå½¢æˆè‰¯æ€§å¾ªç¯ã€‚</p>\n<h3 id=\"å¿ƒç†é˜²å¾¡æœºåˆ¶ä¸èˆ’é€‚åŒºä¾èµ–\">å¿ƒç†é˜²å¾¡æœºåˆ¶ä¸èˆ’é€‚åŒºä¾èµ–</h3>\n<p>ä»å¿ƒç†å­¦è§’åº¦æ¥çœ‹ï¼Œå›ºå®šå‹æ€ç»´åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ä¸€ç§é˜²å¾¡æœºåˆ¶ã€‚å®ƒä¿æŠ¤æˆ‘ä»¬å…å—å¤±è´¥å’ŒæŒ«æŠ˜å¸¦æ¥çš„ç—›è‹¦æ„Ÿè§‰ï¼Œç»´æŠ¤æˆ‘ä»¬çš„è‡ªæˆ‘å½¢è±¡å’Œè‡ªå°Šã€‚</p>\n<p>å½“æˆ‘ä»¬å®³æ€•å¤±è´¥æ—¶ï¼Œå›ºå®šå‹æ€ç»´å‘Šè¯‰æˆ‘ä»¬ï¼š\"è¿™ä¸æ˜¯çœŸæ­£çš„æˆ‘ï¼Œåªæ˜¯æˆ‘è¿˜æ²¡å±•ç°å‡ºæˆ‘çš„æ½œåŠ›\"ï¼Œæˆ–è€…\"å¦‚æœæˆ‘å°è¯•äº†ä½†å¤±è´¥äº†ï¼Œé‚£æ‰è¯´æ˜æˆ‘çœŸçš„ä¸è¡Œ\"ã€‚é€šè¿‡å›é¿æŒ‘æˆ˜ï¼Œæˆ‘ä»¬é¿å…äº†å¤±è´¥çš„é£é™©ï¼Œä½†ä¹ŸåŒæ—¶æ‹’ç»äº†æˆé•¿çš„æœºä¼šã€‚</p>\n<p>è¿™ç§é˜²å¾¡æœºåˆ¶åœ¨çŸ­æœŸå†…ç¡®å®èƒ½å¤Ÿå‡å°‘ç„¦è™‘å’Œä¸é€‚ï¼Œä½†åœ¨é•¿æœŸä¸­å´å¯¼è‡´äº†èƒ½åŠ›çš„åœæ»å’Œæ½œåŠ›çš„æµªè´¹ã€‚</p>\n<p>èˆ’é€‚åŒºæ˜¯å¦ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µã€‚æˆ‘ä»¬éƒ½æœ‰ä¸€ç§å€¾å‘ï¼Œå°±æ˜¯åœç•™åœ¨è®©æˆ‘ä»¬æ„Ÿåˆ°å®‰å…¨å’Œç†Ÿæ‚‰çš„èŒƒå›´å†…ã€‚</p>\n<p>è¿™ç§å€¾å‘æœ¬èº«å¹¶éé—®é¢˜ï¼Œå®ƒæ˜¯äººç±»è¿›åŒ–è¿‡ç¨‹ä¸­å½¢æˆçš„æ­£å¸¸æœºåˆ¶â€”â€”åœ¨è¿œå¤æ—¶ä»£ï¼Œå†’é™©ç¦»å¼€ç†Ÿæ‚‰çš„ç¯å¢ƒå¾€å¾€æ„å‘³ç€å±é™©ã€‚</p>\n<p>ç„¶è€Œï¼Œåœ¨ç°ä»£ç¤¾ä¼šä¸­ï¼Œè¿‡åº¦ä¾èµ–èˆ’é€‚åŒºä¼šå¯¼è‡´æˆé•¿åœæ»ã€‚</p>\n<p>èˆ’é€‚åŒºçš„é—®é¢˜ä¸åœ¨äºå®ƒæœ¬èº«ï¼Œè€Œåœ¨äºæˆ‘ä»¬ç”¨å®ƒä½œä¸ºå›é¿æˆé•¿æŒ‘æˆ˜çš„å€Ÿå£ã€‚æˆ‘ä»¬å¯èƒ½æ»¡è¶³äºå¤Ÿç”¨çš„æŠ€èƒ½ï¼Œå›é¿ç²¾é€šæ‰€éœ€çš„å¤§é‡ç»ƒä¹ ï¼›æ»¡è¶³äºè¿‡å¾—å»çš„å…³ç³»ï¼Œå›é¿å»ºç«‹æ›´æ·±è¿æ¥æ‰€éœ€çš„è„†å¼±å’Œå¦è¯šï¼›æ»¡è¶³äºå¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œå›é¿å¯»æ‰¾æ›´ä¼˜æ–¹æ¡ˆæ‰€éœ€çš„åˆ›æ–°å’Œé£é™©æ‰¿æ‹…ã€‚</p>\n<p>èº«ä»½è®¤åŒçš„å›ºåŒ–æ˜¯å›ºå®šå‹æ€ç»´çš„æ·±å±‚è¡¨ç°ã€‚</p>\n<p>å½“æˆ‘ä»¬å°†è‡ªå·±å®šä¹‰ä¸º\"æˆ‘æ˜¯æŸç§äºº\"æ—¶ï¼Œè¿™ç§å®šä¹‰å°±æˆä¸ºäº†è‡ªæˆ‘é™åˆ¶çš„æ¡†æ¶ã€‚\"æˆ‘æ˜¯ä¸€ä¸ªä¸æ“…é•¿æ•°å­¦çš„äºº\"ã€\"æˆ‘æ˜¯ä¸€ä¸ªå†…å‘çš„äºº\"ã€\"æˆ‘æ˜¯ä¸€ä¸ªæ²¡æœ‰åˆ›é€ åŠ›çš„äºº\"â€”â€”è¿™äº›è‡ªæˆ‘å®šä¹‰ä¸€æ—¦å½¢æˆï¼Œå°±ä¼šæŒ‡å¯¼æˆ‘ä»¬é€‰æ‹©æ€§åœ°æ¥è§¦é‚£äº›\"ç¬¦åˆ\"æˆ‘ä»¬èº«ä»½çš„ä¿¡æ¯å’Œç»éªŒï¼Œå›é¿é‚£äº›å¯èƒ½æŒ‘æˆ˜æˆ‘ä»¬èº«ä»½çš„å¯èƒ½æ€§ã€‚</p>\n<p>æˆé•¿å‹æ€ç»´è¦æ±‚æˆ‘ä»¬æ‰“ç ´è¿™ç§èº«ä»½å›ºåŒ–ï¼Œè®¤è¯†åˆ°èº«ä»½ä¸æ˜¯å›ºå®šçš„æ ‡ç­¾ï¼Œè€Œæ˜¯å¯ä»¥ä¸æ–­æ‰©å±•å’Œé‡æ–°å®šä¹‰çš„ã€‚</p>\n<h2 id=\"äº”æ€ä¹ˆçªç ´éšœç¢æœ‰å“ªäº›æ–¹æ³•\">äº”ï¼šæ€ä¹ˆçªç ´éšœç¢ï¼Ÿæœ‰å“ªäº›æ–¹æ³•ï¼Ÿ</h2>\n<h3 id=\"è®¤çŸ¥é‡æ„ä»å†…åœ¨å¯¹è¯å¼€å§‹\">è®¤çŸ¥é‡æ„ï¼šä»å†…åœ¨å¯¹è¯å¼€å§‹</h3>\n<p>æˆé•¿å‹æ€ç»´çš„æ ¸å¿ƒåœ¨äºæˆ‘ä»¬å¦‚ä½•è§£è¯»è‡ªå·±çš„ç»å†â€”â€”ç‰¹åˆ«æ˜¯é‚£äº›å›°éš¾å’ŒæŒ‘æˆ˜çš„æ—¶åˆ»ã€‚</p>\n<p>è®¤çŸ¥é‡æ„æ˜¯ä¸€ç§ç³»ç»Ÿæ€§çš„æ–¹æ³•ï¼Œå¸®åŠ©æˆ‘ä»¬è¯†åˆ«å’Œæ”¹å˜é‚£äº›å¼ºåŒ–å›ºå®šå‹æ€ç»´çš„å†…åœ¨å¯¹è¯ã€‚</p>\n<p>è¿™ä¸ªè¿‡ç¨‹å§‹äºå¯¹è‡ªæˆ‘æ€ç»´çš„è§‚å¯Ÿã€‚æˆ‘ä»¬éœ€è¦å­¦ä¼šæ³¨æ„åˆ°è‡ªå·±ä»€ä¹ˆæ—¶å€™åœ¨ä½¿ç”¨å›ºå®šå‹æ€ç»´çš„è¯­è¨€â€”â€”\"æˆ‘å°±æ˜¯ä¸æ“…é•¿è¿™ä¸ª\"ã€\"è¿™è¯æ˜æˆ‘ä¸è¡Œ\"ã€\"å¦‚æœæˆ‘å°è¯•äº†ä½†å¤±è´¥äº†å¤ªä¸¢äººäº†\"ã€‚ä¸€æ—¦è¯†åˆ«å‡ºè¿™äº›æ€ç»´æ¨¡å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æœ‰æ„è¯†åœ°æŒ‘æˆ˜å’Œé‡æ„å®ƒä»¬ã€‚</p>\n<p>è®¤çŸ¥é‡æ„çš„å…·ä½“æŠ€æœ¯åŒ…æ‹¬å‡ ä¸ªå±‚æ¬¡ã€‚</p>\n<ul>\n<li>\n<p>é¦–å…ˆæ˜¯è¯æ®æ£€éªŒâ€”â€”å½“æˆ‘ä»¬äº§ç”Ÿ\"æˆ‘ä¸æ“…é•¿è¿™ä¸ª\"çš„æ€ç»´æ—¶ï¼Œé—®è‡ªå·±ï¼šè¿™ä¸ªç»“è®ºçš„è¯æ®æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆè¯æ®ä¸è¿™ä¸ªç»“è®ºçŸ›ç›¾ï¼Ÿé€šå¸¸æˆ‘ä»¬ä¼šå‘ç°ï¼Œå›ºå®šå‹æ€ç»´çš„ç»“è®ºæ˜¯åŸºäºå°‘æ•°è´Ÿé¢ç»å†ï¼Œè€Œå¿½è§†äº†æ­£é¢ç»å†å’Œæ”¹å˜çš„å¯èƒ½æ€§ã€‚</p>\n</li>\n<li>\n<p>å…¶æ¬¡æ˜¯å½’å› é‡å¡‘â€”â€”å°†å¤±è´¥å½’å› äºå¯æ§å› ç´ ï¼ˆå¦‚åŠªåŠ›ç¨‹åº¦ã€ç­–ç•¥é€‰æ‹©ï¼‰è€Œéä¸å¯æ§å› ç´ ï¼ˆå¦‚å¤©èµ‹ã€è¿æ°”ï¼‰ï¼Œè¿™æ ·å¤±è´¥å°±å˜æˆäº†å¯ä»¥æ”¹è¿›çš„é—®é¢˜ï¼Œè€Œéå›ºå®šçš„èº«ä»½ç‰¹å¾ã€‚</p>\n</li>\n<li>\n<p>ç¬¬ä¸‰æ˜¯æ¡†æ¶è½¬æ¢â€”â€”å°†\"æˆ‘åšä¸åˆ°\"è½¬æ¢ä¸º\"æˆ‘æš‚æ—¶è¿˜åšä¸åˆ°\"ï¼Œå°†\"è¿™å¤ªéš¾äº†\"è½¬æ¢ä¸º\"è¿™éœ€è¦æ›´å¤šæ—¶é—´å’Œç»ƒä¹ \"ï¼Œå°†\"å¤±è´¥æ˜¯åäº‹\"è½¬æ¢ä¸º\"å¤±è´¥æä¾›äº†å­¦ä¹ çš„æœºä¼š\"ã€‚</p>\n</li>\n</ul>\n<p>å»ºç«‹æ”¯æŒæ€§çš„è‡ªæˆ‘å¯¹è¯æ˜¯è®¤çŸ¥é‡æ„çš„æŒç»­å®è·µã€‚</p>\n<p>å½“æˆ‘ä»¬çŠ¯é”™æˆ–é‡åˆ°å›°éš¾æ—¶ï¼Œå†…åœ¨çš„æ‰¹è¯„å£°éŸ³å¾€å¾€ä¼šåŠ å‰§ç—›è‹¦å’Œé˜²å¾¡ï¼Œè€Œé¼“åŠ±å’Œæ”¯æŒçš„å£°éŸ³åˆ™èƒ½ä¿ƒè¿›å­¦ä¹ å’Œæˆé•¿ã€‚æˆé•¿å‹æ€ç»´è¦æ±‚æˆ‘ä»¬å°†è¿™ç§æ”¯æŒæ€§çš„å£°éŸ³å†…åŒ–ï¼Œæˆä¸ºé¢å¯¹æŒ‘æˆ˜æ—¶çš„é»˜è®¤ååº”ã€‚è¿™éœ€è¦åˆ»æ„ç»ƒä¹ ï¼Œå°±åƒåŸ¹å…»ä»»ä½•æ–°ä¹ æƒ¯ä¸€æ ·ã€‚</p>\n<h3 id=\"è¡Œä¸ºæ”¹å˜è¡ŒåŠ¨å¡‘é€ æ€ç»´\">è¡Œä¸ºæ”¹å˜ï¼šè¡ŒåŠ¨å¡‘é€ æ€ç»´</h3>\n<p>æ€ç»´å’Œè¡ŒåŠ¨æ˜¯ç›¸äº’å½±å“çš„â€”â€”æ”¹å˜å…¶ä¸­ä¸€ä¸ªå¾€å¾€ä¼šå¯¼è‡´å¦ä¸€ä¸ªçš„æ”¹å˜ã€‚ä»…ä»…åœ¨è®¤çŸ¥ä¸Šç†è§£æˆé•¿å‹æ€ç»´æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡è¡Œä¸ºæ¥å¼ºåŒ–å’Œæ·±åŒ–å®ƒã€‚</p>\n<p>é€‰æ‹©æŒ‘æˆ˜æ€§ä»»åŠ¡æ˜¯åŸ¹å…»æˆé•¿å‹æ€ç»´æœ€ç›´æ¥çš„è¡Œä¸ºæ–¹å¼ã€‚å½“æˆ‘ä»¬ä¸»åŠ¨é€‰æ‹©é‚£äº›éœ€è¦åŠªåŠ›å’ŒåšæŒæ‰èƒ½å®Œæˆçš„ä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬å°±åœ¨ç”¨è¡ŒåŠ¨å‘è‡ªå·±è¯æ˜ï¼šèƒ½åŠ›æ˜¯å¯ä»¥å‘å±•çš„ï¼ŒåŠªåŠ›æ˜¯æœ‰æ•ˆçš„ã€‚è¿™ç§è¡Œä¸ºäº§ç”Ÿçš„æ•°æ®æ¯”ä»»ä½•è¨€è¯­éƒ½æ›´æœ‰è¯´æœåŠ›ã€‚</p>\n<p>å…·ä½“æ¥è¯´ï¼Œå¯ä»¥ä»å°å¤„å¼€å§‹ã€‚é€‰æ‹©ä¸€ä¸ªä½ è®¤ä¸ºè‡ªå·±\"ä¸æ“…é•¿\"çš„é¢†åŸŸï¼ŒæŠ•å…¥æ—¶é—´å’Œç²¾åŠ›å»å­¦ä¹ å’Œç»ƒä¹ ã€‚æ³¨æ„è§‚å¯Ÿè¿™ä¸ªè¿‡ç¨‹ä¸­çš„å˜åŒ–â€”â€”æœ€åˆçš„æ„Ÿè§‰ã€é€æ¸çš„è¿›æ­¥ã€é‡åˆ°çš„å›°éš¾å’Œçªç ´ã€‚</p>\n<p>è¿™ç§äº²èº«ä½“éªŒæ¯”ç†è®ºæ›´èƒ½è¯´æœä½ ï¼šèƒ½åŠ›ç¡®å®æ˜¯å¯ä»¥å‘å±•çš„ã€‚é‡è¦çš„æ˜¯é€‰æ‹©é€‚åº¦æŒ‘æˆ˜çš„ä»»åŠ¡â€”â€”å¤ªå®¹æ˜“çš„ä»»åŠ¡æ— æ³•ä¿ƒè¿›æˆé•¿ï¼Œå¤ªéš¾çš„ä»»åŠ¡å¯èƒ½å¯¼è‡´æŒ«è´¥ã€‚æœ€ä½³çš„é€‰æ‹©æ˜¯é‚£äº›éœ€è¦åŠªåŠ›ä½†ä¸æ˜¯ä¸å¯èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚</p>\n<p>å»ºç«‹åé¦ˆå¾ªç¯æ˜¯å¦ä¸€ä¸ªé‡è¦çš„è¡Œä¸ºç­–ç•¥ã€‚æˆé•¿å‹æ€ç»´éœ€è¦åŠæ—¶ã€å‡†ç¡®çš„åé¦ˆæ¥è°ƒæ•´åŠªåŠ›çš„æ–¹å‘ã€‚ä»…ä»…åŠªåŠ›æ˜¯ä¸å¤Ÿçš„â€”â€”æˆ‘ä»¬éœ€è¦çŸ¥é“åŠªåŠ›æ˜¯å¦æœ‰æ•ˆï¼Œå“ªé‡Œéœ€è¦è°ƒæ•´ã€‚</p>\n<p>è¿™æ„å‘³ç€ä¸»åŠ¨å¯»æ±‚åé¦ˆï¼Œæ— è®ºæ˜¯æ¥è‡ªè€å¸ˆã€åŒäº‹ã€æœ‹å‹è¿˜æ˜¯è‡ªæˆ‘åæ€ã€‚è®°å½•è¿›å±•ã€å›é¡¾ç›®æ ‡è¾¾æˆæƒ…å†µã€è¯šå®åœ°è¯„ä¼°è‡ªå·±çš„è¡¨ç°â€”â€”è¿™äº›éƒ½æ˜¯å»ºç«‹æœ‰æ•ˆåé¦ˆå¾ªç¯çš„æ–¹æ³•ã€‚æ²¡æœ‰åé¦ˆï¼Œæˆ‘ä»¬å¯èƒ½åªæ˜¯åœ¨é‡å¤æ— æ•ˆçš„åŠªåŠ›ï¼Œæˆ–è€…é”™è¿‡äº†æ”¹è¿›çš„æœºä¼šã€‚</p>\n<h3 id=\"ä¹ æƒ¯å…»æˆå°†æˆé•¿ä¹ æƒ¯åŒ–\">ä¹ æƒ¯å…»æˆï¼šå°†æˆé•¿ä¹ æƒ¯åŒ–</h3>\n<p>æˆé•¿å‹æ€ç»´å¦‚æœåªæ˜¯å¶å°”çš„è§‰æ‚Ÿï¼Œå…¶æ•ˆæœæ˜¯æœ‰é™çš„ã€‚</p>\n<p>çœŸæ­£çš„æŒä¹…æ”¹å˜éœ€è¦å°†æˆé•¿å‹æ€ç»´è½¬åŒ–ä¸ºè‡ªåŠ¨çš„ä¹ æƒ¯ã€‚è¿™éœ€è¦ç†è§£ä¹ æƒ¯çš„è¿ä½œæœºåˆ¶â€”â€”ä¹ æƒ¯ç”±è§¦å‘ã€è¡Œä¸ºå’Œå¥–åŠ±ä¸‰éƒ¨åˆ†ç»„æˆã€‚è®¾è®¡æ”¯æŒæˆé•¿å‹æ€ç»´çš„ä¹ æƒ¯ï¼Œæ„å‘³ç€å°†æˆé•¿å¯¼å‘çš„è¡Œä¸ºä¸ç§¯æçš„æƒ…æ„Ÿä½“éªŒè”ç³»èµ·æ¥ï¼Œä½¿å…¶é€æ¸è‡ªåŠ¨åŒ–ã€‚</p>\n<p>å…·ä½“çš„æ–¹æ³•åŒ…æ‹¬å»ºç«‹å®šæœŸåæ€çš„ä¹ æƒ¯ã€‚</p>\n<p>æ¯å‘¨æˆ–æ¯æœˆèŠ±æ—¶é—´å›é¡¾è‡ªå·±çš„å­¦ä¹ å’Œæˆé•¿ï¼šé‡åˆ°äº†ä»€ä¹ˆæŒ‘æˆ˜ï¼Ÿä»ä¸­å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿä¸‹æ¬¡å¯ä»¥å¦‚ä½•æ”¹è¿›ï¼Ÿè¿™ç§åæ€ä¸ä»…æä¾›åé¦ˆï¼Œè¿˜å¼ºåŒ–äº†æˆé•¿æ˜¯é‡è¦çš„ã€å€¼å¾—å…³æ³¨çš„è¿™ä¸€ä¿¡å¿µã€‚</p>\n<p>è®°å½•æˆé•¿æ—¥å¿—ä¹Ÿæ˜¯ç±»ä¼¼çš„æ–¹æ³•â€”â€”è®°å½•é‚£äº›å›°éš¾æ—¶åˆ»ã€å¦‚ä½•åº”å¯¹çš„ã€ä»ä¸­è·å¾—äº†ä»€ä¹ˆã€‚è¿™äº›è®°å½•æˆä¸ºå¯è§çš„æˆé•¿è¯æ®ï¼Œå¯ä»¥ç”¨æ¥å¯¹æŠ—å›ºå®šå‹æ€ç»´çš„æ¶ˆæç»“è®ºã€‚</p>\n<p>å°†æˆé•¿è¯­è¨€èå…¥æ—¥å¸¸äº¤æµä¹Ÿå¾ˆé‡è¦ã€‚</p>\n<p>æ³¨æ„è‡ªå·±ä½¿ç”¨çš„è¯­è¨€ï¼Œç‰¹åˆ«æ˜¯å¯¹ä»–äººï¼ˆç‰¹åˆ«æ˜¯å­©å­å’Œå­¦ç”Ÿï¼‰çš„åé¦ˆã€‚ç”¨\"ä½ é€šè¿‡åŠªåŠ›æé«˜äº†\"ä»£æ›¿\"ä½ çœŸèªæ˜\"ï¼Œç”¨\"ä½ è¿˜æ²¡æŒæ¡è¿™ä¸ªæŠ€å·§ï¼Œä½†æˆ‘ä»¬ä¸€èµ·æ¥æ‰¾æ–¹æ³•\"ä»£æ›¿\"ä½ ä¸è¡Œ\"ã€‚</p>\n<p>è¿™ç§è¯­è¨€ä¸ä»…å½±å“ä»–äººï¼Œä¹Ÿé€æ¸æ”¹å˜è‡ªå·±çš„æ€ç»´ä¹ æƒ¯ã€‚åœ¨å­©å­æ•™è‚²ä¸­ï¼Œè¿™ä¸€ç‚¹å°¤ä¸ºé‡è¦â€”â€”çˆ¶æ¯å’Œè€å¸ˆä½¿ç”¨çš„è¯­è¨€ç±»å‹å¯ä»¥å¡‘é€ å­©å­çš„æ€ç»´æ¨¡å¼ã€‚</p>\n<h3 id=\"ç¯å¢ƒè®¾è®¡åˆ›é€ æ”¯æŒæ€§ç”Ÿæ€ç³»ç»Ÿ\">ç¯å¢ƒè®¾è®¡ï¼šåˆ›é€ æ”¯æŒæ€§ç”Ÿæ€ç³»ç»Ÿ</h3>\n<p>ç¯å¢ƒå¯¹æ€ç»´æ¨¡å¼çš„å½±å“å¾€å¾€è¢«ä½ä¼°ã€‚</p>\n<p>æˆ‘ä»¬æ‰€å¤„çš„ç‰©ç†ç¯å¢ƒã€ç¤¾äº¤ç¯å¢ƒå’Œæ–‡åŒ–ç¯å¢ƒæŒç»­ä¸æ–­åœ°å‘æˆ‘ä»¬ä¼ é€’ä¿¡æ¯ï¼Œå½±å“æˆ‘ä»¬çš„æ€ç»´å’Œè¡Œä¸ºã€‚</p>\n<p>è®¾è®¡ä¸€ä¸ªæ”¯æŒæˆé•¿å‹æ€ç»´çš„ç¯å¢ƒï¼Œæ„å‘³ç€æœ‰æ„è¯†åœ°åˆ›é€ é‚£äº›é¼“åŠ±å­¦ä¹ ã€æ¥å—æŒ‘æˆ˜ã€é‡è§†æˆé•¿çš„æ¡ä»¶ã€‚è¿™ä¸ä»…åŒ…æ‹¬ç‰©ç†ç¯å¢ƒçš„å®‰æ’ï¼Œæ›´é‡è¦çš„æ˜¯ç¤¾äº¤ç¯å¢ƒçš„æ„å»ºã€‚</p>\n<p>ç‰©ç†ç¯å¢ƒçš„è®¾è®¡å¯ä»¥ä¿ƒè¿›æˆé•¿å‹æ€ç»´ã€‚å±•ç¤ºè‡ªå·±æˆ–ä»–äººæˆé•¿è¿‡ç¨‹çš„ç‰©å“ï¼ˆå¦‚æ—©æœŸçš„ä½œå“å’Œç°åœ¨çš„ä½œå“çš„å¯¹æ¯”ï¼‰ã€æ”¾ç½®æ¿€åŠ±æ€§çš„ä¹¦ç±å’Œèµ„æ–™ã€åˆ›é€ å¯ä»¥ä¸“æ³¨å­¦ä¹ å’Œåˆ›é€ çš„ç©ºé—´â€”â€”è¿™äº›éƒ½åœ¨æ— å½¢ä¸­ä¼ é€’ç€æˆé•¿çš„ä¿¡æ¯ã€‚ç›¸åï¼Œè¿‡åˆ†å¼ºè°ƒæˆå°±å’ŒæˆåŠŸçš„ç¯å¢ƒå¯èƒ½å¼ºåŒ–å›ºå®šå‹æ€ç»´ï¼Œå› ä¸ºå®ƒä»¬å¼ºè°ƒçš„æ˜¯ç»“æœè€Œéè¿‡ç¨‹ã€‚</p>\n<p>ç¤¾äº¤ç¯å¢ƒçš„è®¾è®¡åŒæ ·å…³é”®ã€‚å¯»æ‰¾å’Œå»ºç«‹é‚£äº›é‡è§†æˆé•¿ã€æ”¯æŒæ”¹å˜çš„ç¤¾ç¾¤â€”â€”å­¦ä¹ å°ç»„ã€å…´è¶£ç¤¾ç¾¤ã€å¯¼å¸ˆå…³ç³»ç­‰ã€‚åœ¨è¿™äº›ç¤¾ç¾¤ä¸­ï¼Œåˆ†äº«å›°éš¾å’Œå¤±è´¥æ˜¯è¢«é¼“åŠ±çš„ï¼ŒåŠªåŠ›å’Œè¿›æ­¥æ˜¯è¢«è®¤å¯çš„ï¼Œæ–°å°è¯•æ˜¯è¢«æ”¯æŒçš„ã€‚ç›¸åï¼Œé‚£äº›å¼ºåŒ–æ¯”è¾ƒã€ç«äº‰å’Œèªæ˜æ ‡ç­¾çš„ç¤¾äº¤ç¯å¢ƒä¼šå¼ºåŒ–å›ºå®šå‹æ€ç»´ã€‚</p>\n<h2 id=\"å…­ç»ˆèº«æˆé•¿ä¸æ„ä¹‰\">å…­ï¼šç»ˆèº«æˆé•¿ä¸æ„ä¹‰</h2>\n<h3 id=\"æ›´å¤§è§†è§’ä¸‹çš„ç»ˆèº«æˆé•¿\">æ›´å¤§è§†è§’ä¸‹çš„ç»ˆèº«æˆé•¿</h3>\n<p>æˆé•¿å‹æ€ç»´ä¸æ˜¯ä¸€ä¸ªéœ€è¦åœ¨æŸä¸ªå¹´é¾„é˜¶æ®µå®Œæˆçš„ä»»åŠ¡ï¼Œè€Œæ˜¯è´¯ç©¿æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„æŒç»­å®è·µã€‚</p>\n<p>çœŸæ­£ç†è§£æˆé•¿å‹æ€ç»´æ„å‘³ç€è®¤è¯†åˆ°ï¼šæ— è®ºå¤„äºä»€ä¹ˆå¹´é¾„ï¼Œæ— è®ºå·²ç»å–å¾—äº†ä»€ä¹ˆæˆå°±ï¼Œæ€»æœ‰æ›´å¤šå¯ä»¥å­¦ä¹ ã€å‘å±•å’Œè´¡çŒ®çš„ç©ºé—´ã€‚</p>\n<p>è¿™ç§è®¤è¯†æœ¬èº«å°±å…·æœ‰è§£æ”¾æ€§â€”â€”å®ƒè§£é™¤äº†\"å·²ç»å¤ªæ™šäº†\"æˆ–\"å·²ç»è¶³å¤Ÿå¥½äº†\"çš„è‡ªæˆ‘é™åˆ¶ï¼Œè®©ç”Ÿå‘½ä¿æŒå¼€æ”¾å’Œå¯èƒ½ã€‚</p>\n<p>ä»æ•´åˆçš„è§†è§’æ¥çœ‹ï¼Œäººç”Ÿçš„å„ä¸ªé˜¶æ®µä¸æ˜¯å½¼æ­¤å‰²è£‚çš„ï¼Œè€Œæ˜¯ç›¸äº’è”ç³»ã€ç›¸äº’ä¸°å¯Œçš„ã€‚</p>\n<p>é’å¹´æ—¶æœŸçš„çƒ­æƒ…å’Œå†’é™©ã€ä¸­å¹´æ—¶æœŸçš„æ·±åº¦å’Œæ™ºæ…§ã€è€å¹´æ—¶æœŸçš„æ²‰æ·€å’Œè¶…è¶Šâ€”â€”è¿™äº›å“è´¨å¯ä»¥ç›¸äº’æ¸—é€ï¼Œåˆ›é€ å‡ºç‹¬ç‰¹çš„ç”Ÿå‘½å½¢æ€ã€‚</p>\n<p>ä¸€ä¸ªæ‹¥æœ‰æˆé•¿å‹æ€ç»´çš„å¹´è½»äººå¯ä»¥åŸ¹å…»è€å¹´äººçš„æ²‰ç¨³å’Œè¿œè§ï¼›ä¸€ä¸ªæ‹¥æœ‰æˆé•¿å‹æ€ç»´çš„ä¸­å¹´äººå¯ä»¥ä¿æŒå¹´è½»äººçš„å¥½å¥‡å’Œå¼€æ”¾ï¼›ä¸€ä¸ªæ‹¥æœ‰æˆé•¿å‹æ€ç»´çš„è€å¹´äººå¯ä»¥è´¡çŒ®å¹´è½»äººçš„æ´»åŠ›å’Œåˆ›é€ åŠ›ã€‚</p>\n<p>è¿™ç§è·¨å¹´é¾„çš„å“è´¨æ•´åˆï¼Œæ˜¯æˆé•¿å‹æ€ç»´åœ¨ç”Ÿå‘½å±‚é¢çš„æœ€é«˜ä½“ç°ã€‚</p>\n<h3 id=\"æˆé•¿å‹æ€ç»´ä¸æ„ä¹‰å»ºæ„\">æˆé•¿å‹æ€ç»´ä¸æ„ä¹‰å»ºæ„</h3>\n<p>æˆé•¿å‹æ€ç»´çš„æ·±å±‚ä»·å€¼ä¸ä»…åœ¨äºæé«˜èƒ½åŠ›å’Œæˆå°±ï¼Œæ›´åœ¨äºå»ºæ„æœ‰æ„ä¹‰çš„äººç”Ÿã€‚</p>\n<p>å½“æˆ‘ä»¬ç›¸ä¿¡æ”¹å˜æ˜¯å¯èƒ½çš„ï¼Œæˆ‘ä»¬å°±ä¸ä¼šè¢«å½“å‰çš„å›°å¢ƒæ‰€å®šä¹‰ï¼Œå°±èƒ½å¤Ÿçœ‹åˆ°æœªæ¥çš„å¯èƒ½æ€§ï¼Œå°±æœ‰èƒ½åŠ›åœ¨å›°éš¾ä¸­æ‰¾åˆ°æ„ä¹‰ã€‚</p>\n<p>è¿™ç§æ„ä¹‰å»ºæ„çš„èƒ½åŠ›æ˜¯å¿ƒç†å¥åº·å’Œäººç”Ÿæ»¡æ„åº¦çš„æ ¸å¿ƒè¦ç´ ã€‚ç ”ç©¶è¡¨æ˜ï¼Œé‚£äº›èƒ½å¤Ÿåœ¨æŒ«æŠ˜ä¸­å¯»æ‰¾æ„ä¹‰çš„äººï¼Œæ¯”é‚£äº›åªå…³æ³¨ç»“æœçš„äººæ›´æœ‰å¯èƒ½ä»é€†å¢ƒä¸­æ¢å¤ï¼Œå¹¶åœ¨é•¿æœŸä¸­å–å¾—æ›´å¥½çš„ç»“æœã€‚</p>\n<p>æˆé•¿å‹æ€ç»´ä¹Ÿæ„å‘³ç€å¯¹ç”Ÿå‘½æœ¬èº«çš„å¼€æ”¾æ€åº¦ã€‚</p>\n<p>æ¯ä¸€ä¸ªäººç”Ÿé˜¶æ®µéƒ½æœ‰å…¶ç‹¬ç‰¹çš„æŒ‘æˆ˜å’Œæœºé‡ï¼Œæ¯ä¸€ä¸ªç»å†â€”â€”æ— è®ºæ˜¯æˆåŠŸçš„è¿˜æ˜¯å¤±è´¥çš„â€”â€”éƒ½å¯ä»¥æˆä¸ºæˆé•¿çš„ç´ æã€‚å½“æˆ‘ä»¬ç”¨è¿™ç§çœ¼å…‰çœ‹å¾…ç”Ÿæ´»æ—¶ï¼Œç”Ÿæ´»å°±ä¸å†æ˜¯å¿…é¡»ç†¬è¿‡å»çš„é˜¶æ®µï¼Œè€Œæ˜¯å€¼å¾—æ´»å‡ºæ¥çš„æ—…ç¨‹ã€‚è¿™ç§æ€åº¦ä¸æ˜¯ç›²ç›®çš„ä¹è§‚ï¼Œè€Œæ˜¯åŸºäºå¯¹äººç±»æ½œåŠ›çš„æ·±åˆ»ç†è§£å’Œä¿¡ä»»ã€‚</p>\n<h2 id=\"ä¸ƒæœ€åé‡æ–°å®šä¹‰å¯èƒ½æ€§\">ä¸ƒï¼šæœ€åï¼šé‡æ–°å®šä¹‰å¯èƒ½æ€§</h2>\n<p>\"è¶Šè€è¶Šå›ºæ‰§\"ä¸å…¶è¯´æ˜¯ä¸€ä¸ªä¸å¯é¿å…çš„ç”Ÿç†å‘½è¿ï¼Œä¸å¦‚è¯´æ˜¯ä¸€ä¸ªè‡ªæˆ‘å®ç°çš„é¢„è¨€ã€‚</p>\n<p>å®ƒä¹‹æ‰€ä»¥æµè¡Œï¼Œæ˜¯å› ä¸ºå®ƒåæ˜ äº†è®¸å¤šäººçš„çœŸå®ä½“éªŒâ€”â€”ä»–ä»¬ç¡®å®æ„Ÿåˆ°éšç€å¹´é¾„å¢é•¿ï¼Œæ”¹å˜å˜å¾—æ›´åŠ å›°éš¾ã€‚ç„¶è€Œï¼Œè¿™ç§ä½“éªŒçš„åŸå› æ˜¯å¤æ‚çš„ï¼Œå¯èƒ½åŒ…æ‹¬ä¹ æƒ¯çš„å¼ºåŒ–ã€èº«ä»½çš„å›ºåŒ–ã€ç¤¾ä¼šæœŸæœ›çš„å†…åŒ–ï¼Œä»¥åŠå¤§è„‘æŸäº›åŠ å·¥é€Ÿåº¦çš„è‡ªç„¶å˜åŒ–ã€‚ä½†è¿™äº›åŸå› å¹¶ä¸æ„å‘³ç€æˆé•¿å‹æ€ç»´æ˜¯ä¸å¯èƒ½çš„ï¼Œå®ƒä»¬åªæ˜¯æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ›´åˆ»æ„åœ°åŸ¹å…»å’Œé”»ç‚¼è¿™ç§æ€ç»´æ¨¡å¼ã€‚</p>\n<p>æˆé•¿å‹æ€ç»´æ˜¯ä¸€ç§é€‰æ‹©â€”â€”é€‰æ‹©ç›¸ä¿¡æ”¹å˜æ˜¯å¯èƒ½çš„ï¼Œé€‰æ‹©å°†æŒ‘æˆ˜è§†ä¸ºæœºä¼šï¼Œé€‰æ‹©ç”¨è¿‡ç¨‹è€Œéç»“æœæ¥å®šä¹‰è‡ªå·±ã€‚è¿™ç§é€‰æ‹©ä¸å—å¹´é¾„é™åˆ¶ã€‚è™½ç„¶ä¸åŒå¹´é¾„é˜¶æ®µé¢ä¸´çš„æŒ‘æˆ˜ä¸åŒï¼Œä½†æˆé•¿çš„å¯èƒ½æ€§æ˜¯æ™®éçš„ã€‚ä¸€ä¸ªäºŒåå²çš„äººå¯ä»¥é€‰æ‹©ç»´æŒç°çŠ¶ï¼Œæ‹’ç»å­¦ä¹ å’Œæ”¹å˜ï¼›ä¸€ä¸ªä¸ƒåå²çš„äººå¯ä»¥é€‰æ‹©æ‹¥æŠ±æ–°äº‹ç‰©ï¼ŒæŒç»­æˆé•¿å’Œå‘å±•ã€‚å†³å®šå› ç´ ä¸æ˜¯å¹´é¾„ï¼Œè€Œæ˜¯å¯¹æˆé•¿çš„æ€åº¦å’Œæ‰¿è¯ºã€‚</p>\n<p>æœ€ç»ˆï¼Œæˆé•¿å‹æ€ç»´æ˜¯ä¸€ç§å…³äºäººçš„å¯èƒ½æ€§çš„ä¿¡å¿µã€‚</p>\n<p>å®ƒå‘Šè¯‰æˆ‘ä»¬ï¼šäººä¸åº”è¯¥è¢«ä»»ä½•æ ‡ç­¾æ‰€å®šä¹‰â€”â€”æ— è®ºè¿™ä¸ªæ ‡ç­¾æ˜¯å¹´é¾„ã€èƒ½åŠ›ã€èƒŒæ™¯è¿˜æ˜¯è¿‡å»çš„ç»å†ã€‚è¿™ç§ä¿¡å¿µä¸æ˜¯å¦è®¤é™åˆ¶ï¼Œè€Œæ˜¯ç›¸ä¿¡åœ¨é™åˆ¶ä¹‹å†…å’Œä¹‹å¤–ï¼Œéƒ½å­˜åœ¨ç€æœªè¢«å‘æ˜çš„æ½œåŠ›ã€‚</p>\n<p>åŸ¹å…»å’Œç»´æŒæˆé•¿å‹æ€ç»´ï¼Œå°±æ˜¯é€‰æ‹©æ´»åœ¨è¿™ç§å¯èƒ½æ€§çš„ç©ºé—´ä¸­ï¼Œä¸æ–­æ‰©å±•è‡ªå·±çš„è¾¹ç•Œï¼ŒåŒæ—¶æ¥çº³å’Œçè§†è‡ªå·±ç‹¬ç‰¹çš„ç”Ÿå‘½æ—…ç¨‹ã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œæˆé•¿å‹æ€ç»´ä¸ä»…æ˜¯ä¸€ç§è®¤çŸ¥ç­–ç•¥ï¼Œæ›´æ˜¯ä¸€ç§ç”Ÿå‘½æ€åº¦â€”â€”ä¸€ç§å¯¹ç”Ÿå‘½çš„å¼€æ”¾ã€å¥½å¥‡å’Œå‹‡æ•¢çš„æ€åº¦ã€‚</p>\n<h2 id=\"å‚è€ƒ\">å‚è€ƒ</h2>\n<ul>\n<li>ã€Šç»ˆèº«æˆé•¿ã€‹<a href=\"https://book.douban.com/subject/27154533/\" rel=\"noopener nofollow\" target=\"_blank\">https://book.douban.com/subject/27154533/</a></li>\n<li>ã€Šä¸å¼ºåŠ¿çš„çˆ¶æ¯ï¼šæ•™è‚²å­©å­è¦æ‡‚å¿ƒç†å­¦ã€‹<a href=\"https://book.douban.com/subject/37233750/\" rel=\"noopener nofollow\" target=\"_blank\">https://book.douban.com/subject/37233750/</a></li>\n<li>ã€Šè®¤çŸ¥è§‰é†’ã€‹<a href=\"https://book.douban.com/subject/35193035/\" rel=\"noopener nofollow\" target=\"_blank\">https://book.douban.com/subject/35193035/</a></li>\n<li>å¦‚ä½•ä»å›ºå®šå‹æ€ç»´è½¬å˜ä¸ºæˆé•¿å‹æ€ç»´ï¼Ÿ-çŸ¥ä¹é—®ç­”ï¼Œ<a href=\"https://www.zhihu.com/question/21099982\" rel=\"noopener nofollow\" target=\"_blank\">https://www.zhihu.com/question/21099982</a></li>\n<li>ã€Šå¯å¡‘çš„æˆ‘ï¼šè‡ªæˆ‘å‘å±•å¿ƒç†å­¦çš„35å ‚å¿…ä¿®è¯¾ã€‹<a href=\"https://book.douban.com/subject/35388653/\" rel=\"noopener nofollow\" target=\"_blank\">https://book.douban.com/subject/35388653/</a></li>\n</ul>\n\n</div>\n<div id=\"MySignature\">\n    == just do it ==\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-12 18:25</span>&nbsp;\n<a href=\"https://www.cnblogs.com/jiujuan\">ä¹å·</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">82</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">1</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "åŸºäº nano-vLLM å­¦ä¹ å¤§æ¨¡å‹æ¨ç†å…³é”®åŠŸèƒ½",
      "link": "https://www.cnblogs.com/cswuyg/p/19471225",
      "published": "",
      "description": "<div class=\"postTitle\">\n\t\t<h1><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/cswuyg/p/19471225\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-12 12:38\">\n    <span>åŸºäº nano-vLLM å­¦ä¹ å¤§æ¨¡å‹æ¨ç†å…³é”®åŠŸèƒ½</span>\n    \n\n</a>\n</h1>\n\t</div>\n\t<div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<blockquote>æ³¨ï¼šæœ¬æ–‡å·²äº2025.12.31 å‘è¡¨äºçŸ¥ä¹å’Œå…¬ä¼—å·</blockquote>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>1. èƒŒæ™¯</span></h1>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å¦‚æœè¦å‘ä¸€ä½å®Œå…¨ä¸äº†è§£å¤§æ¨¡å‹æ¨ç†æŠ€æœ¯çš„å¼€å‘è€…ä»‹ç»è¿™ä¸ªé¢†åŸŸï¼Œæˆ‘åº”è¯¥ä»å“ªé‡Œè®²èµ·ï¼Ÿ</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å¤§æ¨¡å‹æ¨ç†çš„æœ€ç®€æµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼šè¾“å…¥ä¸€ä¸²æ–‡æœ¬ â†’ æ–‡æœ¬é€šè¿‡è¯å…¸æ˜ å°„è¡¨è½¬æ¢æˆä¸€ä¸²æ•°å­—åºå· â†’ åºå·å†ç»è¿‡ embedding å±‚çš„è®¡ç®—ï¼Œå˜æˆä¸€ç»„èƒ½ä»£è¡¨è¯­ä¹‰çš„æµ®ç‚¹æ•°å‘é‡ â†’ è¿™ç»„å‘é‡é€å…¥æ¨ç†ç³»ç»Ÿï¼Œç»è¿‡å±‚å±‚çš„çŸ©é˜µä¹˜æ³•ã€åŠ æ³•å’Œå„ç±»ä¸“ç”¨å‡½æ•°çš„è¿ç®—ï¼Œå¾—åˆ°æ–°çš„è¾“å‡ºå‘é‡ â†’ å¯¹è¾“å‡ºå‘é‡åšæ¦‚ç‡ç­›é€‰ï¼Œé€‰å‡ºæ¦‚ç‡æœ€é«˜çš„é‚£ä¸ªæ•°å€¼å¯¹åº”çš„åºå· â†’ æœ€åå†é€šè¿‡è¯å…¸æ˜ å°„è¡¨ â€œç¿»è¯‘â€ å›æ–‡å­—ï¼Œå¾—åˆ°æœ€ç»ˆè¾“å‡ºçš„ä¸€ä¸ªè¯ã€‚</span></div>\n</div>\n<div class=\"Image-captionContainer\">\n<div class=\"Image-resizerContainer css-ym3v7r\">\n<div class=\"css-79elbk\">\n<div class=\"ImageDelete-Container css-xi606m\">\n<div class=\"ImageDelete-Wrapper css-1gomreu\"><img class=\"Image FocusPlugin--unfocused Image--isBlock css-1phd9a0\" height=\"204\" src=\"https://pic1.zhimg.com/80/v2-52738e1009b99b73843b74399250f825_1440w.png?source=ccfced1a\" style=\"display: block; margin-left: auto; margin-right: auto;\" width=\"877\" />\n<div class=\"ImageEdit-button css-187js3w\" style=\"text-align: center;\">å›¾ 1&nbsp;</div>\n<div class=\"ImageEdit-button css-187js3w\"><span>è¿™æ˜¯å¯¹å¤§æ¨¡å‹æ¨ç†æœ€æœ´ç´ çš„ç†è§£ï¼Œä¸Šè¿°æµç¨‹çœ‹ä¼¼ç®€å•ï¼Œä½†èƒŒåçš„æ¨ç†è®¡ç®—ç¯èŠ‚å¯¹æ™®é€šå¼€å‘è€…è€Œè¨€ä»æ˜¯ä¸€ä¸ª â€œé»‘ç›’â€ã€‚å¦‚æœæƒ³æ›´è¿›ä¸€æ­¥æ‹†è§£æ¨ç†å¼•æ“çš„åº•å±‚åŠ é€ŸåŸç†ï¼Œnano-vllm ä¼šæ˜¯ä¸€ä¸ªæä½³çš„å…¥é—¨åˆ‡å…¥ç‚¹ã€‚</span></div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>2. ç®€ä»‹</span></h1>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><a class=\"Link ztext-link\" href=\"https://github.com/GeeeekExplorer/nano-vllm\" rel=\"noopener nofollow\" target=\"_blank\">nano-vLLM</a><span> ä»£ç é‡ä»…çº¦ 1200 è¡Œï¼Œå´å®ç°äº†ç”Ÿäº§çº§æ¨ç†æ¡†æ¶çš„æ ¸å¿ƒæŠ€æœ¯åŸå‹ï¼Œå…·ä½“åŒ…æ‹¬ï¼š</span></div>\n</div>\n<ul class=\"public-DraftStyleDefault-ul\">\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è¿ç»­æ‰¹å¤„ç†ï¼ˆContinuous Batchingï¼‰</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>KV ç¼“å­˜ï¼ˆPrefix KV Cache / Paged KV Cacheï¼‰</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>é«˜æ€§èƒ½ç¼–è¯‘ä¸æ‰§è¡Œä¼˜åŒ–ï¼ˆTorch Compilationã€Tritonã€CUDA Graphï¼‰</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å¼ é‡å¹¶è¡Œï¼ˆTensor Parallelismï¼‰</span></div>\n</li>\n</ul>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è¯¥æ¡†æ¶æå…·å…¥é—¨å­¦ä¹ ä»·å€¼ï¼Œæœ¬æ–‡å°†å…ˆä»‹ç» nano-vLLM çš„åŸºæœ¬ç»„æˆæ¶æ„ï¼Œå†å¯¹éƒ¨åˆ†æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹å±•å¼€æ·±å…¥è§£æã€‚</span></div>\n</div>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>3. ç³»ç»Ÿæ¶æ„</span></h1>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>nano-vLLM çš„æ¶æ„éå¸¸æœ‰å±‚æ¬¡æ„Ÿã€‚</span></div>\n</div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>3.1. æ•´ä½“æ¶æ„æ¦‚è§ˆ</span></h2>\n<div class=\"Image-captionContainer\">\n<div class=\"Image-resizerContainer css-ym3v7r\">\n<div class=\"css-79elbk\">\n<div class=\"ImageDelete-Container css-xi606m\">\n<div class=\"ImageDelete-Wrapper css-1gomreu\"><img class=\"Image FocusPlugin--unfocused Image--isBlock css-1phd9a0\" height=\"403\" src=\"https://picx.zhimg.com/80/v2-41cd766bd06373d580df6302b2ba3203_1440w.png?source=ccfced1a\" style=\"display: block; margin-left: auto; margin-right: auto;\" width=\"655\" />\n<div class=\"ImageEdit-button css-187js3w\" style=\"text-align: center;\">å›¾ 2, æ¥è‡ªï¼šhttps://deepwiki.com/GeeeekExplorer/nano-vllm</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¸‰å±‚ç»“æ„</span></div>\n</div>\n<ul class=\"public-DraftStyleDefault-ul\">\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ¥å£å±‚ï¼šUser Interface Layer</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ¨ç†å¼•æ“ä¸­æ§å±‚ï¼šInference Engine Layer</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ˜¾å­˜ç®¡ç†å’Œæ¨¡å‹æ‰§è¡Œå±‚ï¼šMemory Management &amp; Model Execution Layer</span></div>\n</li>\n</ul>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>3.2. ç±»å±‚é¢æ¶æ„</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä»ç±»è®¾è®¡å±‚é¢è§‚å¯Ÿ nano-vLLM çš„æ¶æ„ã€‚</span></div>\n</div>\n<div class=\"Image-captionContainer\">\n<div>\n<div class=\"Image-resizerContainer css-ym3v7r\">\n<div class=\"css-79elbk\">\n<div>\n<div class=\"ImageDelete-Container css-xi606m\">\n<div class=\"ImageDelete-Wrapper css-1gomreu\"><img class=\"Image FocusPlugin--unfocused Image--isBlock css-1phd9a0\" height=\"433\" src=\"https://pic1.zhimg.com/80/v2-8612f2dcf6e20d6dd1fccb4ebb494bd2_1440w.png?source=ccfced1a\" style=\"display: block; margin-left: auto; margin-right: auto;\" width=\"409\" />\n<div class=\"ImageEdit-button css-187js3w\" style=\"text-align: center;\">&nbsp;</div>\n<div class=\"ImageDelete-button css-5sjb75\" style=\"text-align: center;\">&nbsp;å›¾ 3</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¸Šå›¾ä¸­å››ç§é¢œè‰²ä»£è¡¨ç³»ç»Ÿçš„å››ä¸ªç»„æˆéƒ¨åˆ†</span></div>\n</div>\n<ul class=\"public-DraftStyleDefault-ul\">\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æµ…è“è‰²ï¼Œå…¥å£å’Œæ¨ç†å¼•æ“ä¸­æ§å±‚</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æµ…ç»¿è‰²ï¼Œæ¨¡å‹æ¨ç†</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æµ…çº¢è‰²ï¼ŒKV Cache ç®¡ç†</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æµ…ç´«è‰²ï¼Œæƒé‡åŠ è½½å’ŒçŸ©é˜µè®¡ç®—çš„å°è£…</span></div>\n</li>\n</ul>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>3.3. æºç å±‚é¢åˆ’åˆ†</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æºç è§„åˆ’ä¸Šä¹Ÿè¾ƒä¸ºç®€æ´ã€‚ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</span></div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:bash;gutter:true;\">nanovllm/\nâ”œâ”€â”€ engine\nâ”œâ”€â”€ layers\nâ”œâ”€â”€ models\nâ””â”€â”€ utils</pre>\n</div>\n</div>\n</div>\n<ul class=\"public-DraftStyleDefault-ul\">\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>engineï¼Œå¼•æ“çš„å…¥å£ã€ä¸­æ§ï¼ŒåŒæ—¶ KV Cache æ¯”è¾ƒç®€å•ï¼Œä»£ç ä¹Ÿæ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>layersï¼Œæ¨¡å‹æ¨ç†çš„é€šç”¨ç»„ä»¶ï¼Œå†…éƒ¨åŒ…æ‹¬ï¼šlinearã€layernormã€rotary_embeddingã€attentionã€activation ç­‰åŸºç¡€åŠŸèƒ½çš„å°è£…ï¼Œå¯ä»¥è¢«ä¸åŒæ¨¡å‹ä½¿ç”¨ã€‚</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>modelsï¼Œæ¨¡å‹çš„å®ç°ï¼Œä¾èµ– layers çš„ç»„ä»¶å®ç°ä¸åŒæ¨¡å‹çš„æ¨ç†ã€‚</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>utilsï¼Œä¸åŒå±‚éƒ½å¯èƒ½ä¼šç”¨åˆ°çš„å·¥å…·å‡½æ•°ã€‚</span></div>\n</li>\n</ul>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>4. è¿ç»­æ‰¹å¤„ç†</span></h1>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>4.1. æ¦‚å¿µç†è§£</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ1ï¼‰å®šä¹‰</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è¿ç»­æ‰¹å¤„ç† (Continuous Batching)ï¼šæ˜¯ä¸€ç§è¿­ä»£çº§ï¼ˆIteration-levelï¼‰çš„è°ƒåº¦ç­–ç•¥ã€‚å®ƒä»¥â€œToken ç”Ÿæˆæ­¥éª¤â€ä¸ºè°ƒåº¦ç²’åº¦ã€‚é€šè¿‡åŠ¨æ€åœ°åœ¨æ¯ä¸€è½®è¿­ä»£ä¸­æ›¿æ¢å·²å®Œæˆçš„ä»»åŠ¡ï¼Œæ¶ˆé™¤äº†ç”±äºç”Ÿæˆé•¿åº¦ä¸ä¸€å¯¼è‡´çš„ GPU è®¡ç®—æ°”æ³¡ï¼Œæå¤§åœ°æå‡äº†ç³»ç»Ÿçš„ååé‡ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ2ï¼‰æœ´ç´ ç†è§£</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¸€ä¸ªè¯·æ±‚éœ€è¦æ‰§è¡Œå¤šè½®ï¼Œä¸åŒè¯·æ±‚éœ€è¦æ‰§è¡Œçš„è½®æ•°ä¸åŒï¼Œç³»ç»Ÿä¸€è½®æœ€å¤šåªèƒ½åŒæ—¶æ‰§è¡Œä¸€æ‰¹ N ä¸ªè¯·æ±‚ï¼Œå½“ä¸€ä¸ªæ‰¹æ¬¡é‡Œçš„è¯·æ±‚å‚å·®ä¸é½çš„å®Œæˆæ—¶ï¼Œæ¯å®Œæˆä¸€ä¸ªè¯·æ±‚å°±å°†å…¶ç”¨æ–°è¯·æ±‚æ›¿ä»£æ‰ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å¯¹æ¯”ä¼ ç»Ÿæ‰¹å¤„ç†å’Œè¿ç»­æ‰¹å¤„ç†ï¼š</span></div>\n</div>\n<ul class=\"public-DraftStyleDefault-ul\">\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¼ ç»Ÿæ‰¹å¤„ç† (Static Batching)ï¼šå¿…é¡»ç­‰å¾… Batch ä¸­ç”Ÿæˆåºåˆ—æœ€é•¿çš„é‚£ä¸ªè¯·æ±‚å®Œæˆï¼Œæ•´ä¸ª Batch æ‰ä¼šé‡Šæ”¾ã€‚åœ¨æ­¤æœŸé—´ï¼Œç”Ÿæˆåºåˆ—çŸ­è¯·æ±‚å®Œæˆåæ§½ä½ä¼šç©ºè½¬ã€‚</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è¿ç»­æ‰¹å¤„ç† (Continuous Batching)ï¼šè¯·æ±‚å®Œæˆå³é€€å‡ºï¼Œæ–°è¯·æ±‚ç«‹å³è¡¥ä½ï¼Œæ§½ä½å§‹ç»ˆæ»¡è½½ã€‚</span></div>\n</li>\n</ul>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>4.2. æœ€åŸºç¡€çš„è¿ç»­æ‰¹å¤„ç†</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æœ€ç®€å•çš„è¿ç»­æ‰¹å¤„ç†ï¼Œä¸è€ƒè™‘ prefill å’Œ decode çš„å·®å¼‚ï¼Œç¤ºä¾‹ä»£ç ï¼š</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> time\n</span><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> threading\n</span><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> queue\n</span><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> random\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 1. åˆå§‹åŒ–çº¿ç¨‹å®‰å…¨çš„ç­‰å¾…é˜Ÿåˆ—</span>\nwaiting_queue =<span style=\"color: rgba(0, 0, 0, 1);\"> queue.Queue()\nMAX_BATCH_SIZE </span>= 3\n\n<span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> --- æ¨¡æ‹Ÿç”¨æˆ·è¯·æ±‚çº¿ç¨‹ (ç”Ÿäº§è€…) ---</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> user_request_producer():\n    request_id </span>= 1\n    <span style=\"color: rgba(0, 0, 255, 1);\">while</span><span style=\"color: rgba(0, 0, 0, 1);\"> True:\n        </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ¨¡æ‹Ÿç”¨æˆ·éšæœºåˆ°è¾¾ï¼šæ¯ 1~2 ç§’æ¥ä¸€ä¸ªæ–°è¯·æ±‚</span>\n        time.sleep(random.uniform(1, 2<span style=\"color: rgba(0, 0, 0, 1);\">))\n        \n        </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ¯ä¸ªè¯·æ±‚éœ€è¦çš„ Token é•¿åº¦éšæœºï¼ˆ3åˆ°8ä¹‹é—´ï¼‰</span>\n        req = {<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">id</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>: f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">REQ-{request_id}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">remain</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>: random.randint(3, 8<span style=\"color: rgba(0, 0, 0, 1);\">)}\n        waiting_queue.put(req)\n        \n        </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\n[ç”¨æˆ·ç«¯] é€å…¥æ–°è¯·æ±‚: {req['id']} (é¢„è®¡é•¿åº¦: {req['remain']})</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n        request_id </span>+= 1\n        <span style=\"color: rgba(0, 0, 255, 1);\">if</span> request_id &gt; 5<span style=\"color: rgba(0, 0, 0, 1);\">:\n          </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span>\n\n<span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> --- æ ¸å¿ƒæ¨ç†å¾ªç¯ (æ¶ˆè´¹è€…/æ‰§è¡Œå™¨) ---</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> inference_loop():\n    running_batch </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> []\n    \n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">--- æ¨ç†å¼•æ“å·²å¯åŠ¨ ---</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    iteration </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> 0\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">while</span><span style=\"color: rgba(0, 0, 0, 1);\"> True:\n        </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> A. è¡¥ä½é€»è¾‘ï¼šåªè¦ Batch æ²¡æ»¡ä¸”é˜Ÿåˆ—é‡Œæœ‰è´§ï¼Œå°±æ‹‰è¿›æ¥</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">while</span> len(running_batch) &lt;<span style=\"color: rgba(0, 0, 0, 1);\"> MAX_BATCH_SIZE:\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">try</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> ä½¿ç”¨ block=Falseï¼Œå¦‚æœé˜Ÿåˆ—ç©ºäº†ç›´æ¥æŠ¥é”™è¿› exceptï¼Œä¸é˜»å¡æ¨ç†é€»è¾‘</span>\n                new_req = waiting_queue.get(block=<span style=\"color: rgba(0, 0, 0, 1);\">False)\n                running_batch.append(new_req)\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">  &gt;&gt;&gt; [è°ƒåº¦] {new_req['id']} è¿›å…¥ Batch</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">except</span><span style=\"color: rgba(0, 0, 0, 1);\"> queue.Empty:\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span>\n\n        <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> B. æ¨ç†é€»è¾‘ï¼šå¦‚æœå½“å‰ Batch æœ‰ä»»åŠ¡ï¼Œå°±æ‰§è¡Œä¸€æ¬¡ Step</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">if</span><span style=\"color: rgba(0, 0, 0, 1);\"> running_batch:\n            iteration </span>+= 1\n            <span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">=</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>*20 + f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">{iteration=}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> + <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">=</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>*20<span style=\"color: rgba(0, 0, 0, 1);\">)\n            </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ¨¡æ‹Ÿ GPU æ¨ç†è€—æ—¶ (Step è€—æ—¶)</span>\n            time.sleep(1.2<span style=\"color: rgba(0, 0, 0, 1);\">) \n            \n            </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> å½“å‰ Batch çŠ¶æ€å±•ç¤º</span>\n            active_ids = [f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">{r['id']}(å‰©{r['remain']-1})</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> <span style=\"color: rgba(0, 0, 255, 1);\">for</span> r <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> running_batch]\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[GPUæ¨ç†] å¤„ç†ä¸­: {active_ids}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            \n            </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ¯ä¸€ä¸ªè¯·æ±‚çš„å‰©ä½™é•¿åº¦å‡ 1</span>\n            finished_this_step =<span style=\"color: rgba(0, 0, 0, 1);\"> []\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> req <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> running_batch:\n                req[</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">remain</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>] -= 1\n                <span style=\"color: rgba(0, 0, 255, 1);\">if</span> req[<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">remain</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>] &lt;=<span style=\"color: rgba(0, 0, 0, 1);\"> 0:\n                    finished_this_step.append(req)\n            \n            </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> C. å‰”é™¤é€»è¾‘ï¼šåšå®Œçš„ç«‹åˆ»è¸¢å‡ºï¼Œä¸‹ä¸€è½®å¾ªç¯å¼€å¤´å°±ä¼šæœ‰æ–°è¯·æ±‚è¡¥è¿›æ¥</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">for</span> req <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> finished_this_step:\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">  &lt;&lt;&lt; [å®Œæˆ] {req['id']} ç”Ÿæˆå®Œæ¯•ï¼Œé‡Šæ”¾ä½ç½®</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                running_batch.remove(req)\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n            </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¦‚æœ Batch å’Œ é˜Ÿåˆ—éƒ½ç©ºäº†ï¼Œç¨å¾®æ­‡ä¼šï¼Œé¿å… CPU ç©ºè½¬</span>\n            time.sleep(0.5<span style=\"color: rgba(0, 0, 0, 1);\">)\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> --- å¯åŠ¨ç¨‹åº ---</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">if</span> <span style=\"color: rgba(128, 0, 128, 1);\">__name__</span> == <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">__main__</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n    </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¯åŠ¨ç”¨æˆ·è¯·æ±‚çº¿ç¨‹</span>\n    t = threading.Thread(target=user_request_producer, daemon=<span style=\"color: rgba(0, 0, 0, 1);\">True)\n    t.start()\n\n    </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> ä¸»çº¿ç¨‹æ‰§è¡Œæ¨ç†å¾ªç¯</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">try</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n        inference_loop()\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">except</span><span style=\"color: rgba(0, 0, 0, 1);\"> KeyboardInterrupt:\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\næœåŠ¡å·²åœæ­¢</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>)</pre>\n</div>\n<p><span>æ ¸å¿ƒé€»è¾‘ï¼š</span></p>\n</div>\n<ul class=\"public-DraftStyleDefault-ul\">\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å­˜å‚¨ç»“æ„ï¼šä»£ç çš„æ ¸å¿ƒæœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œwaiting_queue è´Ÿè´£å­˜å‚¨è¯·æ±‚çº¿ç¨‹ä¸æ–­æ¥æ”¶åˆ°çš„æ–°è¯·æ±‚ï¼Œrunning_queue è´Ÿè´£å­˜å‚¨å·²ç»è¿è¡Œä½†è¿˜æ²¡æœ‰ç»“æŸçš„è¯·æ±‚ã€‚</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è¿­ä»£å¾ªç¯ï¼šç”Ÿäº§è€…æŒç»­å¾€ waiting_queue å†™å…¥æ–°è¯·æ±‚ï¼Œè¿­ä»£å¾ªç¯æŒç»­ä» waiting_queue è·å–æ–°è¯·æ±‚åŠ å…¥åˆ° running_queueï¼ŒåŒæ—¶æ¸…ç† running_queue é‡Œå·²ç»å®Œæˆçš„è¯·æ±‚ã€‚</span></div>\n</li>\n</ul>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>4.3. prefill ä¼˜å…ˆçš„è¿ç»­æ‰¹å¤„ç†</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>prefill ä¼˜å…ˆçš„æ‰¹å¤„ç†ï¼Œéœ€è¦åŒºåˆ† prefll å’Œ decodeï¼Œä¼˜å…ˆå¤„ç†æ–°è¯·æ±‚ï¼Œç¤ºä¾‹ä»£ç ï¼š</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> time\n</span><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> queue\n</span><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> random\n</span><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> threading\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ ¸å¿ƒé˜Ÿåˆ—</span>\nwaiting_queue =<span style=\"color: rgba(0, 0, 0, 1);\"> queue.Queue()  \nrunning_queue </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> []             \n\nMAX_BATCH_SIZE </span>= 4\n\n<span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> user_request_producer():\n    </span><span style=\"color: rgba(128, 0, 0, 1);\">\"\"\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\n    ä¿®æ”¹ç‚¹ï¼šæ¨¡æ‹Ÿçˆ†å‘å¼è¯·æ±‚åˆ°è¾¾ï¼Œä»¥è§¦å‘å¤šè¯·æ±‚ Prefill\n    </span><span style=\"color: rgba(128, 0, 0, 1);\">\"\"\"</span>\n    <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç¬¬ä¸€æ³¢ï¼šçˆ†å‘å¼åˆ°è¾¾ (3ä¸ªè¯·æ±‚åŒæ—¶è¿›å…¥é˜Ÿåˆ—)</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\n[ç”¨æˆ·] --- çˆ†å‘å¼è¯·æ±‚åˆ°è¾¾ (3ä¸ªè¯·æ±‚) ---</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> i <span style=\"color: rgba(0, 0, 255, 1);\">in</span> range(1, 4<span style=\"color: rgba(0, 0, 0, 1);\">):\n        req </span>= {<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">id</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>: f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">REQ-{i}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">remain</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>: random.randint(2, 5<span style=\"color: rgba(0, 0, 0, 1);\">)}\n        waiting_queue.put(req)\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[ç”¨æˆ·] è¯·æ±‚ {req['id']} è¿›å…¥ç­‰å¾…é˜Ÿåˆ—</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    \n    </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> å»¶è¿Ÿä¸€ä¼šå„¿ï¼Œå†æ¥ç¬¬äºŒæ³¢å•ç‚¹è¯·æ±‚</span>\n    time.sleep(5<span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\n[ç”¨æˆ·] --- å»¶è¿Ÿè¯·æ±‚åˆ°è¾¾ (1ä¸ªè¯·æ±‚) ---</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    req </span>= {<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">id</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>: <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">REQ-4</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">remain</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>: 3<span style=\"color: rgba(0, 0, 0, 1);\">}\n    waiting_queue.put(req)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[ç”¨æˆ·] è¯·æ±‚ {req['id']} è¿›å…¥ç­‰å¾…é˜Ÿåˆ—</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> inference_loop():\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">--- è¿ç»­æ‰¹å¤„ç†å¼•æ“ï¼šå¤šè¯·æ±‚ Prefill æ¨¡å¼ ---</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    iteration </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> 0\n    \n    </span><span style=\"color: rgba(0, 0, 255, 1);\">while</span><span style=\"color: rgba(0, 0, 0, 1);\"> True:\n        current_batch </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> []\n        is_prefill_stage </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> False\n        \n        </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 1. è°ƒåº¦ï¼šæ„å»ºå½“å‰æ‰¹æ¬¡</span>\n        <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> åªè¦ waiting_queue éç©ºï¼Œå°±å°½å¯èƒ½å¡«æ»¡ MAX_BATCH_SIZE</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">if</span> <span style=\"color: rgba(0, 0, 255, 1);\">not</span><span style=\"color: rgba(0, 0, 0, 1);\"> waiting_queue.empty():\n            is_prefill_stage </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> True\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">while</span> <span style=\"color: rgba(0, 0, 255, 1);\">not</span> waiting_queue.empty() <span style=\"color: rgba(0, 0, 255, 1);\">and</span> len(current_batch) &lt;<span style=\"color: rgba(0, 0, 0, 1);\"> MAX_BATCH_SIZE:\n                req </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> waiting_queue.get()\n                current_batch.append(req)\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">elif</span><span style=\"color: rgba(0, 0, 0, 1);\"> running_queue:\n            is_prefill_stage </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> False\n            current_batch </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> list(running_queue)\n        \n        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> <span style=\"color: rgba(0, 0, 255, 1);\">not</span><span style=\"color: rgba(0, 0, 0, 1);\"> current_batch:\n            time.sleep(</span>0.5<span style=\"color: rgba(0, 0, 0, 1);\">)\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">continue</span>\n\n        <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 2. æ‰§è¡Œï¼šæ¨¡æ‹Ÿæ¨ç†</span>\n        iteration += 1\n        <span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\n{'='*15} Iteration {iteration} {'='*15}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n        \n        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span><span style=\"color: rgba(0, 0, 0, 1);\"> is_prefill_stage:\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[PREFILL] æ‰¹é‡ç”Ÿæˆä¸­: {[r['id'] for r in current_batch]}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            time.sleep(</span>1.5<span style=\"color: rgba(0, 0, 0, 1);\">) \n        </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[DECODE ] æ‰¹é‡ç”Ÿæˆä¸­: {[f'{r['id']}(å‰©{r['remain']})' for r in current_batch]}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            time.sleep(</span>0.4<span style=\"color: rgba(0, 0, 0, 1);\">) \n\n        </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 3. ç»Ÿä¸€çŠ¶æ€æ›´æ–°</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">for</span> req <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> current_batch:\n            req[</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">remain</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>] -= 1\n\n        <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 4. ç»Ÿä¸€åˆ¤æ–­ç”Ÿå‘½å‘¨æœŸ</span>\n        <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ³¨æ„ï¼šä¸ºäº†é¿å…åœ¨éå†åˆ—è¡¨æ—¶åˆ é™¤å…ƒç´ ï¼Œæˆ‘ä»¬å…ˆæ”¶é›†è¦åˆ é™¤çš„å¯¹è±¡</span>\n        to_remove_from_running =<span style=\"color: rgba(0, 0, 0, 1);\"> []\n        \n        </span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> req <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> current_batch:\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> req[<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">remain</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>] &lt;=<span style=\"color: rgba(0, 0, 0, 1);\"> 0:\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">  &lt;&lt;&lt; [å®Œæˆ] {req['id']} é€€å‡ºç³»ç»Ÿ</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> req <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> running_queue:\n                    to_remove_from_running.append(req)\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span><span style=\"color: rgba(0, 0, 0, 1);\"> is_prefill_stage:\n                    running_queue.append(req)\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">  -&gt; {req['id']} Prefill å®Œæˆï¼Œè½¬å…¥ running_queue</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">pass</span>\n        \n        <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> çœŸæ­£çš„ä» running_queue ç§»é™¤</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">for</span> req <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> to_remove_from_running:\n            running_queue.remove(req)\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> <span style=\"color: rgba(128, 0, 128, 1);\">__name__</span> == <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">__main__</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n    t </span>= threading.Thread(target=user_request_producer, daemon=<span style=\"color: rgba(0, 0, 0, 1);\">True)\n    t.start()\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">try</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n        inference_loop()\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">except</span><span style=\"color: rgba(0, 0, 0, 1);\"> KeyboardInterrupt:\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">pass</span></pre>\n</div>\n<p><span>å åŠ ä¸Š prefill ä¼˜å…ˆä¹‹åçš„è¿ç»­æ‰¹å¤„ç†ä»£ç ä¹Ÿè¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ˜¯ç»´æŠ¤ä¸‰ä¸ªå˜é‡ï¼šwaiting_queueã€running_queueã€current_batchã€‚</span></p>\n</div>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>5. KV Cache</span></h1>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>5.1. æ¦‚å¿µç†è§£</span></h2>\n<div class=\"Editable-unstyled\">\n<h3 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>5.1.1. KV Cache çš„ç”¨é€”</span></h3>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>KV Cache æœ‰ä¸¤å±‚ç”¨é€”ã€‚ä¸€æ˜¯ç”¨åœ¨åŒä¸€ä¸ªè¯·æ±‚çš„ Decode é˜¶æ®µï¼Œå¤ç”¨ä¹‹å‰å·²ç»è®¡ç®—è¿‡çš„ KV ç»“æœä»¥é¿å…é‡å¤è®¡ç®—ï¼›äºŒæ˜¯ç”¨åœ¨ä¸åŒè¯·æ±‚ä¹‹é—´ï¼Œä½¿å…·æœ‰ç›¸åŒå‰ç¼€çš„è¯·æ±‚å¯ä»¥å…±äº«ä¸€éƒ¨åˆ† KV æ•°æ®ï¼Œè¿™å°±æ˜¯ Prefix KV Cacheã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<h3 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>5.1.2. PagedAttention æŠ€æœ¯</span></h3>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>åœ¨ Cache çš„å­˜å‚¨å±‚é¢ï¼ŒPagedAttention å®ç°äº†æ˜¾å­˜çš„æŒ‰éœ€ç”³è¯·ã€‚ç”±äº KV Cache ç©ºé—´ä¸å†ä¸€æ¬¡æ€§é¢„åˆ†é…ï¼Œè¯·æ±‚åºåˆ—å¯¹åº”çš„ç‰©ç†åœ°å€æ˜¯ç¦»æ•£çš„ã€‚PagedAttention çš„æ ¸å¿ƒåœ¨äºï¼Œå®ƒèƒ½å¤Ÿç›´æ¥è¯»å–è¿™äº›ç‰©ç†ç¦»æ•£çš„å—æ¥å®Œæˆæ³¨æ„åŠ›è®¡ç®—ï¼Œè¿™èƒŒåå®ç°äº†ä¸€å±‚ä»â€œé€»è¾‘è¿ç»­åœ°å€â€åˆ°â€œç‰©ç†ç¦»æ•£åœ°å€â€çš„æ˜ å°„ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å¯¹äºæ²¡æœ‰æ¥è§¦è¿‡é PagedAttention å®ç°çš„è¯»è€…æ¥è¯´ï¼Œè¿™ç§è®¾è®¡ä¼¼ä¹ç†æ‰€å½“ç„¶ï¼šæŒ‰éœ€ç”³è¯·ã€åˆ†é¡µç®¡ç†ã€åœ°å€æ˜ å°„ã€å±€éƒ¨æ€§åŸç†â€”â€”è¿™äº›éƒ½æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­éå¸¸å¸¸è§„çš„æ€ç»´ï¼Œç”šè‡³å¾ˆéš¾æƒ³åˆ°ä¸è¿™ä¹ˆå†™çš„ç†ç”±ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆ PagedAttention ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€é¡¹é‡Œç¨‹ç¢‘å¼çš„å…ˆè¿›æŠ€æœ¯å‘¢ï¼Ÿ</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>é¦–å…ˆï¼Œåœ¨ PagedAttention å‡ºç°ä¹‹å‰ï¼Œä¸šç•Œæ™®éè®¤ä¸º KV Cache åœ¨æ˜¾å­˜ä¸­å¿…é¡»ç‰©ç†è¿ç»­ï¼Œå¦åˆ™ä¼šå› è®¿å­˜ä¸è¿ç»­å¯¼è‡´æ€§èƒ½å¤§å¹…ä¸‹é™ã€‚å…¶æ¬¡ï¼Œå½“æ—¶çš„æ³¨æ„åŠ›ç®—å­ï¼ˆå¦‚æ ‡å‡†çš„ FlashAttentionï¼‰å¹¶ä¸æ”¯æŒäºŒæ¬¡å¯»å€æ˜ å°„ã€‚PagedAttention è¯æ˜äº†å³ä¾¿ç‰©ç†å­˜å‚¨ä¸è¿ç»­ï¼Œæ€§èƒ½ä¾ç„¶å¯ä»¥ä¿æŒæé«˜ã€‚å…¶ä»£ç å®ç°æœ€å…³é”®çš„ç‚¹åœ¨äºé‡æ„äº† CUDA å†…æ ¸ï¼Œä½¿å…¶åŸç”Ÿæ”¯æŒ KV Cache äºŒæ¬¡å¯»å€ã€‚ä¸€ä¸ªåºåˆ—çš„ KV Cache ä¸éœ€è¦ç‰©ç†è¿ç»­ï¼Œä¹Ÿæ­£æ˜¯ä¸åŒåºåˆ—é—´èƒ½å¤Ÿçµæ´»å¤ç”¨ Prefix KV Cache çš„æŠ€æœ¯å‰æã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ€»çš„æ¥è¯´ï¼Œè™½ç„¶åˆ†é¡µè™šæ‹Ÿå†…å­˜åœ¨ CPU é¢†åŸŸæ˜¯å¸¸è¯†ï¼Œä½†åœ¨ GPU ç®—å­é¢†åŸŸå…¶å‘å±•ç›¸å¯¹ç¼“æ…¢ã€‚å®ç°ä¸€å¥—æ—¢èƒ½åˆ†é¡µç®¡ç†ã€åˆä¸æŸå¤±ç®—åŠ›åˆ©ç”¨ç‡çš„ Attention Kernel æ˜¯ PagedAttention çš„æ ¸å¿ƒæ‰€åœ¨ã€‚</span></div>\n</div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>5.2. Prefix KV Cache çš„å®ç°</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>Cache çš„ç®¡ç†è¾ƒä¸ºç®€å•ï¼Œåªæœ‰ BlockManager ç±»ï¼Œè´Ÿè´£ç»´æŠ¤æ˜¾å­˜æ± å„ä¸ª block çš„çš„çŠ¶æ€ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<h3 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>5.2.1. åŠŸèƒ½ç»†èŠ‚</span></h3>\n</div>\n<ul class=\"public-DraftStyleDefault-ul\">\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä½¿ç”¨ hash æ¥è¯†åˆ«æ˜¯å¦æœ‰å¯å¤ç”¨å‰ç¼€ï¼Œä»¥ block ä¸ºåŸºæœ¬å•å…ƒ</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>é“¾å¼ hashï¼Œæ¯ä¸ª block çš„ hash è®¡ç®—è¾“å…¥ä¸ºå‰åº block çš„ hash å€¼åŠ ä¸Šæœ¬ block çš„ token id</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ¯ä¸€ä¸ª block æœ‰å¯¹åº”çš„ meta ä¿¡æ¯å¯¹è±¡ï¼Œè®°å½• block è¢«å¤ç”¨çš„å¼•ç”¨è®¡æ•°ï¼Œç¡®ä¿å¤ç”¨æ—¶ä¸ä¼šè¢«é‡Šæ”¾</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¸ºé¿å… hash ç¢°æ’å‡ºç°é”™è¯¯ï¼Œblock meta ä¿¡æ¯è¿˜éœ€è¦è®°å½•åŸå§‹çš„ token id</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>åœ¨è·å– KV Cache ç©ºé—´æ—¶éœ€è¦è€ƒè™‘æ˜¯å¦è·¨ block</span></div>\n</li>\n</ul>\n<div class=\"Editable-unstyled\">\n<h3 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>5.2.2. å†…å­˜æ± </span></h3>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>åœ¨è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œä¸€æ¬¡æ€§ç”³è¯·å†…å­˜æ± çš„ç©ºé—´ï¼š</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre>kv_cache =<span style=\"color: rgba(0, 0, 0, 1);\"> torch.empty(\n    </span>2,                          <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> K å’Œ V</span>\n    num_layers,                 <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> å±‚æ•°</span>\n    num_blocks,                 <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ€»å—æ•°</span>\n    block_size,                 <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ¯å— token æ•°</span>\n    num_kv_heads // tp_size,    <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> KV head æ•°ï¼ˆè€ƒè™‘å¼ é‡å¹¶è¡Œï¼‰</span>\n    head_dim                    <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> head ç»´åº¦</span>\n)</pre>\n</div>\n<p><span>ä¸Šè¿°ç”³è¯·æ˜¾å­˜ä»£ç ä¸­çš„ num_blocks æ˜¯æ ¹æ®å¯ç”¨äº KV Cache çš„æ˜¾å­˜ç®—å‡ºæ¥çš„ï¼š</span></p>\n<div class=\"cnblogs_code\">\n<pre>block_bytes = 2 * hf_config.num_hidden_layers * self.block_size * num_kv_heads * head_dim *<span style=\"color: rgba(0, 0, 0, 1);\"> hf_config.torch_dtype.itemsize\nconfig.num_kvcache_blocks </span>= int(total * config.gpu_memory_utilization - used - peak + current) // block_bytes</pre>\n</div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¸Šè¿°ä»£ç ä¸­çš„ block_bytes å¹¶ä¸æ˜¯æŒ‡ block çš„å¤§å°ï¼Œè€Œæ˜¯æŠŠè®¡ç®— blocks æ•°çš„æ‰€æœ‰é™¤æ•°ä¹˜åˆ°äº†ä¸€èµ·ï¼Œé™¤æ•°åŒ…æ‹¬ï¼šblock å¤§å°ã€k å’Œ vã€æ¨¡å‹å±‚æ•°ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span><span>total * config.gpu_memory_utilization - used - peak + current<span> è¿™éƒ¨åˆ†åˆ™æ˜¯æ ¹æ®æœ€é«˜çš„æ˜¾å­˜åˆ©ç”¨ç‡ç®—å‡ºæ¥å¯ç”¨æ˜¾å­˜ï¼Œå‡å»å½“å‰æ¨¡å‹åŠ è½½å®Œåä½¿ç”¨äº†çš„éƒ¨åˆ†ï¼Œå†å‡å»æ¨¡å‹é¢„çƒ­æ—¶ä½¿ç”¨çš„æ¿€æ´»æ˜¾å­˜ï¼š<span><span>peak - current<span>ã€‚</span></span></span></span></span></span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ç”³è¯·åˆ°å†…å­˜æ± åï¼ŒæŒ‰å±‚å…±äº«è§†å›¾ç»™å„ä¸ªå±‚çš„ Attention å¯¹è±¡ï¼Œä»£ç çœ‹èµ·æ¥æ¯”è¾ƒ trickyï¼Œä½†åœ¨ python é‡Œå€’æ¯”è¾ƒå¸¸è§ï¼š</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">for</span> module <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> self.model.modules():\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> hasattr(module, <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">k_cache</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>) <span style=\"color: rgba(0, 0, 255, 1);\">and</span> hasattr(module, <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">v_cache</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">):\n        module.k_cache </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> self.kv_cache[0, layer_id]\n        module.v_cache </span>= self.kv_cache[1<span style=\"color: rgba(0, 0, 0, 1);\">, layer_id]\n        layer_id </span>+= 1</pre>\n</div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>éå†æ¨¡å‹ä¸­çš„æ‰€æœ‰ nn.Module å­æ¨¡å—ï¼Œé€šè¿‡æ£€æŸ¥æ˜¯å¦å­˜åœ¨ k_cache å’Œ v_cache å±æ€§æ¥è¯†åˆ« Attention å±‚ã€‚å¯¹äºæ¯ä¸ª Attention å±‚ï¼Œå°†å…¶ k_cache å’Œ v_cache å±æ€§æ›¿æ¢ä¸ºæŒ‡å‘å…¨å±€ KV Cache æ˜¾å­˜æ± çš„å¼ é‡è§†å›¾ï¼Œè¿™æ ·æ‰€æœ‰å±‚å…±äº«åŒä¸€å—è¿ç»­çš„æ˜¾å­˜ç©ºé—´ï¼Œä½†æ¯å±‚åªèƒ½è®¿é—®è‡ªå·±å¯¹åº”çš„åˆ‡ç‰‡ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<h3 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>5.2.3. KV Cache å†™å…¥</span></h3>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>åœ¨ attention å­å±‚çš„ forward å‰åš KV Cache çš„å†™å…¥ï¼Œä½¿ç”¨çš„ store_kvcache_kernel å‡½æ•°æ˜¯ triton.jit å®ç°çš„ï¼Œä»£ç ä¹Ÿæ¯”è¾ƒç®€æ´ï¼š</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 0, 1);\">@triton.jit\n</span><span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> store_kvcache_kernel(\n    key_ptr,\n    key_stride,\n    value_ptr,\n    value_stride,\n    k_cache_ptr,\n    v_cache_ptr,\n    slot_mapping_ptr,\n    D: tl.constexpr,\n):\n    idx </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> tl.program_id(0)\n    slot </span>= tl.load(slot_mapping_ptr +<span style=\"color: rgba(0, 0, 0, 1);\"> idx)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> slot == -1: <span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\">\n    key_offsets </span>= idx * key_stride +<span style=\"color: rgba(0, 0, 0, 1);\"> tl.arange(0, D)\n    value_offsets </span>= idx * value_stride +<span style=\"color: rgba(0, 0, 0, 1);\"> tl.arange(0, D)\n    key </span>= tl.load(key_ptr +<span style=\"color: rgba(0, 0, 0, 1);\"> key_offsets)\n    value </span>= tl.load(value_ptr +<span style=\"color: rgba(0, 0, 0, 1);\"> value_offsets)\n    cache_offsets </span>= slot * D +<span style=\"color: rgba(0, 0, 0, 1);\"> tl.arange(0, D)\n    tl.store(k_cache_ptr </span>+<span style=\"color: rgba(0, 0, 0, 1);\"> cache_offsets, key)\n    tl.store(v_cache_ptr </span>+<span style=\"color: rgba(0, 0, 0, 1);\"> cache_offsets, value)\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> store_kvcache(key: torch.Tensor, value: torch.Tensor, k_cache: torch.Tensor, v_cache: torch.Tensor, slot_mapping: torch.Tensor):\n    N, num_heads, head_dim </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> key.shape\n    D </span>= num_heads *<span style=\"color: rgba(0, 0, 0, 1);\"> head_dim\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">assert</span> key.stride(-1) == 1 <span style=\"color: rgba(0, 0, 255, 1);\">and</span> value.stride(-1) == 1\n    <span style=\"color: rgba(0, 0, 255, 1);\">assert</span> key.stride(1) == head_dim <span style=\"color: rgba(0, 0, 255, 1);\">and</span> value.stride(1) ==<span style=\"color: rgba(0, 0, 0, 1);\"> head_dim\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">assert</span> k_cache.stride(1) == D <span style=\"color: rgba(0, 0, 255, 1);\">and</span> v_cache.stride(1) ==<span style=\"color: rgba(0, 0, 0, 1);\"> D\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">assert</span> slot_mapping.numel() ==<span style=\"color: rgba(0, 0, 0, 1);\"> N\n    store_kvcache_kernel[(N,)](key, key.stride(0), value, value.stride(0), k_cache, v_cache, slot_mapping, D)</span></pre>\n</div>\n<p><span>ä½¿ç”¨ stride å‡½æ•°æ¥ç¡®è®¤æ˜¾å­˜æ˜¯å¦è¿ç»­ï¼Œå› ä¸ºåœ¨ store_kvcache_kernel çš„å®ç°é‡Œä¼šæŒ‰ç…§æ˜¾å­˜è¿ç»­æ¥è¯»å–æŒ‡å®šä½ç½®çš„å€¼ã€‚</span></p>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ˜¾å­˜è¿ç»­å’Œä¸è¿ç»­çš„ä¾‹å­ï¼š</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> torch\n\nkey </span>= torch.randn(2, 3, 4<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 0, 255, 1);\">print</span><span style=\"color: rgba(0, 0, 0, 1);\">(key.stride())  \nkey_t </span>= key.transpose(1, 2<span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">è½¬ç½®åï¼ˆéè¿ç»­ï¼‰:</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, key_t.stride())  \nkey_t </span>= key_t.contiguous()  <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> é‡æ–°åˆ†é…ï¼Œä½¿å…¶è¿ç»­</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">contiguous å:</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">, key_t.stride())\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> è¾“å‡ºï¼š</span><span style=\"color: rgba(0, 128, 0, 1);\">\n#</span><span style=\"color: rgba(0, 128, 0, 1);\"> (12, 4, 1)</span><span style=\"color: rgba(0, 128, 0, 1);\">\n#</span><span style=\"color: rgba(0, 128, 0, 1);\"> è½¬ç½®åï¼ˆéè¿ç»­ï¼‰: (12, 1, 4)</span><span style=\"color: rgba(0, 128, 0, 1);\">\n#</span><span style=\"color: rgba(0, 128, 0, 1);\"> contiguouså: (12, 3, 1)</span></pre>\n</div>\n</div>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>6. cuda graph</span></h1>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>6.1. æ¦‚å¿µç†è§£</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>CUDA Graph æ˜¯ä¸€ç§å°†ä¸€ç³»åˆ— CUDA æ“ä½œå½•åˆ¶æˆå›¾çš„æŠ€æœ¯ï¼Œåœ¨é‡å¤æ‰§è¡Œçš„å›ºå®šæ“ä½œåºåˆ—åœºæ™¯ä¸‹å¯ä»¥æ˜¾è‘—æå‡æ¨ç†æ€§èƒ½ï¼Œä¸»è¦åŸºäºè¿™å‡ æ–¹é¢ï¼š</span></div>\n</div>\n<ul class=\"public-DraftStyleDefault-ul\">\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å‡å°‘ CPU ä¸ GPU ä¹‹é—´çš„é¢‘ç¹åŒæ­¥å’ŒæŒ‡ä»¤ä¸‹å‘å¼€é”€ï¼Œé™ä½ä¼ ç»Ÿç‹¬ç«‹æ“ä½œå¸¦æ¥çš„æ§åˆ¶æµäº¤äº’æŸè€—ï¼›</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å‡å°‘æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ CPU å¹²é¢„ï¼ŒGPU è‡ªä¸»æ‰¹é‡æ‰§è¡Œå›¾å†…æ“ä½œï¼Œæœ€å¤§åŒ– GPU åˆ©ç”¨ç‡ï¼Œé™ä½å»¶è¿Ÿã€æå‡ååã€‚</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è§„é¿å¤šæ¬¡ç‹¬ç«‹ CUDA Kernel çš„å¯åŠ¨å›ºå®šå¼€é”€ï¼Œå¤šä¸ª Kernel æ‰“åŒ…åä»…éœ€ä¸€æ¬¡è°ƒåº¦è§¦å‘ï¼Œå¤§å¹…æå‡å° Kernel å¯†é›†åœºæ™¯çš„æ‰§è¡Œæ•ˆç‡ï¼›</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å¯é…åˆæ˜¾å­˜æ± å®ç°æ˜¾å­˜èµ„æºå¤ç”¨ï¼Œå‡å°‘ â€œå°‘é‡å¤šæ¬¡â€ æ˜¾å­˜ç”³è¯· / é‡Šæ”¾çš„å¼€é”€ï¼ŒåŒæ—¶é©±åŠ¨ä¼šåŸºäºå›¾å†…æ˜¾å­˜è®¿é—®æ¨¡å¼ä¼˜åŒ–å¸¦å®½åˆ©ç”¨ç‡ï¼›</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>CUDA é©±åŠ¨å¯è·å–æ“ä½œåºåˆ—çš„å…¨å±€è§†å›¾ï¼ŒåŸºäºå®Œæ•´çš„ä¾èµ–å…³ç³»è¿›è¡Œå…¨å±€ä¼˜åŒ–ï¼ˆå¦‚ Kernel é¡ºåºè°ƒæ•´ã€èµ„æºåˆå¹¶ç­‰ï¼‰ï¼›</span></div>\n</li>\n</ul>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>6.2. åŠŸèƒ½ç»†èŠ‚</span></h2>\n<ul class=\"public-DraftStyleDefault-ul\">\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å½•åˆ¶æ—¶ä½¿ç”¨çš„å¼ é‡å†…å­˜åœ°å€ï¼Œåœ¨é‡æ”¾æ—¶å¿…é¡»ä¿æŒä¸å˜ï¼Œä¹Ÿå°±æ˜¯åé¢å¤šæ¬¡ replay éƒ½ä¼šä½¿ç”¨æ•è·æ—¶ç”³è¯·çš„å˜é‡ç©ºé—´</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ•è·åçš„ graph å¯¹è±¡è®°å½•åœ¨æˆå‘˜å˜é‡é‡Œï¼Œä¾›ä¸‹æ¬¡æ¨ç†æ—¶é€‰æ‹©</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>é‡æ”¾æ—¶é€‰æ‹©æ¯”è¯·æ±‚ batch size å¤§çš„æœ€å° graph batch size</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ•è·æ—¶ä¸åŒçš„ batch size å…±äº«ç›¸åŒçš„é™æ€æ˜¾å­˜ç©ºé—´ï¼Œå¹¶è®©å¤šä¸ªæ‰¹æ¬¡å…±äº«æ˜¾å­˜æ± ï¼Œä½¿å¾—è™½ç„¶æœ‰å¤šä¸ª batch sizeï¼Œä½†åªä¼šä½¿ç”¨ Max Batch Size çš„æ˜¾å­˜ç©ºé—´</span></div>\n</li>\n</ul>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>6.3. ç¤ºä¾‹ä»£ç </span></h2>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> torch\n</span><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> torch.nn as nn\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 1. åŸºç¡€é…ç½®</span>\ndevice = <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">cuda</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">\nD </span>= 512                 <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç»´åº¦</span>\ngraph_bs = [1, 8, 32]   <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> é¢„å®šä¹‰çš„æ¡¶ï¼ˆåˆ†æ¡¶å°ºå¯¸ï¼‰</span>\nNUM_LAYERS = 100        <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> ææ·±æ¨¡å‹ï¼Œå¢åŠ  Kernel æ•°é‡ä»¥æ”¾å¤§ Graph ä¼˜åŠ¿</span>\niters = 50              <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ€§èƒ½æµ‹è¯•è¿­ä»£æ¬¡æ•°</span>\nmax_bs =<span style=\"color: rgba(0, 0, 0, 1);\"> max(graph_bs)\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 2. å®šä¹‰æ·±å±‚æ¨¡å‹ (äº§ç”Ÿçº¦ 400 ä¸ª Kernel)</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> UltraDeepModel(nn.Module):\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">def</span> <span style=\"color: rgba(128, 0, 128, 1);\">__init__</span><span style=\"color: rgba(0, 0, 0, 1);\">(self):\n        super().</span><span style=\"color: rgba(128, 0, 128, 1);\">__init__</span><span style=\"color: rgba(0, 0, 0, 1);\">()\n        self.blocks </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> nn.ModuleList()\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> _ <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> range(NUM_LAYERS):\n            block </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> nn.ModuleDict({\n                </span><span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">ln</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(0, 0, 0, 1);\">: nn.LayerNorm(D).to(device),\n                </span><span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">linear</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(0, 0, 0, 1);\">: nn.Linear(D, D).to(device),\n                </span><span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">act</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(0, 0, 0, 1);\">: nn.ReLU()\n            })\n            self.blocks.append(block)\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> forward(self, x):\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> block <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> self.blocks:\n            identity </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> x\n            x </span>= block[<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">ln</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(0, 0, 0, 1);\">](x)\n            x </span>= block[<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">linear</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(0, 0, 0, 1);\">](x)\n            x </span>= block[<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">act</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(0, 0, 0, 1);\">](x)\n            x </span>= x +<span style=\"color: rgba(0, 0, 0, 1);\"> identity \n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> x\n\nmodel </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> UltraDeepModel().eval()\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 3. é™æ€ç¼“å†²åŒºå‡†å¤‡</span>\nstatic_input = torch.empty(max_bs, D, device=<span style=\"color: rgba(0, 0, 0, 1);\">device)\nstatic_output </span>= torch.empty(max_bs, D, device=<span style=\"color: rgba(0, 0, 0, 1);\">device)\n\ngraphs </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> {}\ngraph_pool </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> None\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 4. å½•åˆ¶é˜¶æ®µ (ä»å¤§åˆ°å°ï¼Œå…±äº«å†…å­˜æ± )</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">--- å¼€å§‹å½•åˆ¶åˆ†æ¡¶ CUDA Graphs ---</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> bs <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> reversed(sorted(graph_bs)):\n    current_input </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> static_input[:bs]\n    </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> Warmup</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">for</span> _ <span style=\"color: rgba(0, 0, 255, 1);\">in</span> range(5<span style=\"color: rgba(0, 0, 0, 1);\">):\n        _ </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> model(current_input)\n    \n    g </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> torch.cuda.CUDAGraph()\n    with torch.cuda.graph(g, pool</span>=<span style=\"color: rgba(0, 0, 0, 1);\">graph_pool):\n        static_output[:bs] </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> model(current_input)\n    \n    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> graph_pool <span style=\"color: rgba(0, 0, 255, 1);\">is</span><span style=\"color: rgba(0, 0, 0, 1);\"> None:\n        graph_pool </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> g.pool()\n    graphs[bs] </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> g\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">âœ… å·²å½•åˆ¶æ¡¶ BS={bs}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 5. è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®å®é™… BS åŒ¹é…æœ€è¿‘çš„æ¡¶</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> get_bucket_bs(actual_bs):\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> b <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> sorted(graph_bs):\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> actual_bs &lt;=<span style=\"color: rgba(0, 0, 0, 1);\"> b:\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> b\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> None\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 6. æ€§èƒ½å¯¹æ¯”æµ‹è¯• (åŒ…å« Padding é€»è¾‘)</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">def</span> benchmark(actual_test_bs=7<span style=\"color: rgba(0, 0, 0, 1);\">):\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\n--- æ€§èƒ½æµ‹è¯•å¼€å§‹: å®é™…è¯·æ±‚ BS={actual_test_bs} ---</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    \n    </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç”Ÿæˆæµ‹è¯•æ•°æ®</span>\n    test_data = torch.randn(actual_test_bs, D, device=<span style=\"color: rgba(0, 0, 0, 1);\">device)\n    \n    start_event </span>= torch.cuda.Event(enable_timing=<span style=\"color: rgba(0, 0, 0, 1);\">True)\n    end_event </span>= torch.cuda.Event(enable_timing=<span style=\"color: rgba(0, 0, 0, 1);\">True)\n\n    </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> --- æ®µè½ A: Standard Eager Mode (ç›´æ¥è·‘ 7 ä¸ª) ---</span>\n    torch.cuda.nvtx.range_push(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Eager_Mode</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    start_event.record()\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> _ <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> range(iters):\n        _ </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> model(test_data)\n    end_event.record()\n    torch.cuda.synchronize()\n    eager_time </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> start_event.elapsed_time(end_event)\n    torch.cuda.nvtx.range_pop()\n\n    </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> --- æ®µè½ B: CUDA Graph Mode (Padding å¯¹é½åˆ° 8) ---</span>\n    <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 1. è·¯ç”±é€»è¾‘</span>\n    bucket_bs =<span style=\"color: rgba(0, 0, 0, 1);\"> get_bucket_bs(actual_test_bs)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> bucket_bs <span style=\"color: rgba(0, 0, 255, 1);\">is</span><span style=\"color: rgba(0, 0, 0, 1);\"> None:\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">âŒ é”™è¯¯: å®é™… BS={actual_test_bs} è¶…è¿‡äº†æœ€å¤§åˆ†æ¡¶ {max_bs}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\">\n\n    torch.cuda.nvtx.range_push(f</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Graph_Mode_Bucket_{bucket_bs}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    \n    </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 2. æ•°æ®å¯¹é½ (Padding): å°† 7 æ¡æ•°æ®æ‹·å…¥ 8 çš„é™æ€åŒºåŸŸ</span>\n    <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> static_input çš„å‰ 7 è¡Œè¢«è¦†ç›–ï¼Œç¬¬ 8 è¡Œä¿æŒä¸å˜ï¼ˆå³ Padding ä½ï¼‰</span>\n<span style=\"color: rgba(0, 0, 0, 1);\">    static_input[:actual_test_bs].copy_(test_data)\n    \n    start_event.record()\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> _ <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> range(iters):\n        </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 3. é‡æ”¾åˆ†æ¡¶ 8 çš„å›¾</span>\n<span style=\"color: rgba(0, 0, 0, 1);\">        graphs[bucket_bs].replay()\n    end_event.record()\n    torch.cuda.synchronize()\n    graph_time </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> start_event.elapsed_time(end_event)\n    \n    </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 4. ç»“æœæˆªæ–­ (Slicing): ä»é™æ€åŒºæ‹¿å›å‰ 7 æ¡</span>\n    final_res =<span style=\"color: rgba(0, 0, 0, 1);\"> static_output[:actual_test_bs]\n    torch.cuda.nvtx.range_pop()\n\n    </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ‰“å°ç»“æœ</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">åŒ¹é…åˆ°çš„æ¡¶: {bucket_bs} (Padding æµªè´¹ç‡: {(bucket_bs-actual_test_bs)/bucket_bs*100:.1f}%)</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">{'Mode':&lt;20} | {'Avg Time (ms)':&lt;15}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">-</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> * 40<span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">{'Eager Mode':&lt;20} | {eager_time/iters:&gt;15.4f}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">{'Graph Mode':&lt;20} | {graph_time/iters:&gt;15.4f}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">-</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> * 40<span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">ğŸš€ åŠ é€Ÿæ¯”: {eager_time/graph_time:.2f}x</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">æœ€ç»ˆè¾“å‡ºå½¢çŠ¶: {final_res.shape}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> <span style=\"color: rgba(128, 0, 128, 1);\">__name__</span> == <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">__main__</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n    </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æµ‹è¯•ä¸åŒçš„è¾“å…¥ BS</span>\n    benchmark(actual_test_bs=7)  <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> è§¦å‘å¯¹é½åˆ° 8</span>\n    benchmark(actual_test_bs=1)  <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç²¾ç¡®åŒ¹é…åˆ° 1</span></pre>\n</div>\n<p><span>æ‰§è¡Œï¼šnsys profile --trace=cuda,osrt,nvtx python3 cu2.py</span></p>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è¾“å‡ºï¼š</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 0, 1);\">Collecting data...\n</span>--- å¼€å§‹å½•åˆ¶åˆ†æ¡¶ CUDA Graphs ---<span style=\"color: rgba(0, 0, 0, 1);\">\nâœ… å·²å½•åˆ¶æ¡¶ BS</span>=32<span style=\"color: rgba(0, 0, 0, 1);\">\nâœ… å·²å½•åˆ¶æ¡¶ BS</span>=8<span style=\"color: rgba(0, 0, 0, 1);\">\nâœ… å·²å½•åˆ¶æ¡¶ BS</span>=1\n\n--- æ€§èƒ½æµ‹è¯•å¼€å§‹: å®é™…è¯·æ±‚ BS=7 ---<span style=\"color: rgba(0, 0, 0, 1);\">\nåŒ¹é…åˆ°çš„æ¡¶: </span>8 (Padding æµªè´¹ç‡: 12.5%<span style=\"color: rgba(0, 0, 0, 1);\">)\nMode                 </span>|<span style=\"color: rgba(0, 0, 0, 1);\"> Avg Time (ms)  \n</span>----------------------------------------<span style=\"color: rgba(0, 0, 0, 1);\">\nEager Mode           </span>|          7.9331<span style=\"color: rgba(0, 0, 0, 1);\">\nGraph Mode           </span>|          1.0136\n----------------------------------------<span style=\"color: rgba(0, 0, 0, 1);\">\nğŸš€ åŠ é€Ÿæ¯”: </span>7<span style=\"color: rgba(0, 0, 0, 1);\">.83x\næœ€ç»ˆè¾“å‡ºå½¢çŠ¶: torch.Size([</span>7, 512<span style=\"color: rgba(0, 0, 0, 1);\">])\n\n</span>--- æ€§èƒ½æµ‹è¯•å¼€å§‹: å®é™…è¯·æ±‚ BS=1 ---<span style=\"color: rgba(0, 0, 0, 1);\">\nåŒ¹é…åˆ°çš„æ¡¶: </span>1 (Padding æµªè´¹ç‡: 0.0%<span style=\"color: rgba(0, 0, 0, 1);\">)\nMode                 </span>|<span style=\"color: rgba(0, 0, 0, 1);\"> Avg Time (ms)  \n</span>----------------------------------------<span style=\"color: rgba(0, 0, 0, 1);\">\nEager Mode           </span>|          8.1803<span style=\"color: rgba(0, 0, 0, 1);\">\nGraph Mode           </span>|          0.8011\n----------------------------------------<span style=\"color: rgba(0, 0, 0, 1);\">\nğŸš€ åŠ é€Ÿæ¯”: </span>10<span style=\"color: rgba(0, 0, 0, 1);\">.21x\næœ€ç»ˆè¾“å‡ºå½¢çŠ¶: torch.Size([</span>1, 512])</pre>\n</div>\n<p><span>æŸ¥çœ‹ nsysï¼š</span></p>\n</div>\n<div class=\"Image-captionContainer\">\n<div>\n<div class=\"Image-resizerContainer css-ym3v7r\">\n<div class=\"css-79elbk\">\n<div>\n<div class=\"ImageDelete-Container css-xi606m\">\n<div class=\"ImageDelete-Wrapper css-1gomreu\" style=\"text-align: center;\"><img class=\"Image FocusPlugin--unfocused Image--isBlock css-1phd9a0\" height=\"394\" src=\"https://picx.zhimg.com/80/v2-fa4eefbebda0472fa1f21d8bd01e4c17_1440w.png?source=ccfced1a\" width=\"753\" /></div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div style=\"text-align: center;\">å›¾ 4</div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ cuda graph çš„æ—¶å€™ï¼ŒSM ä½¿ç”¨æ›´å……åˆ†ã€‚</span></div>\n</div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>6.4. Q&amp;A</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆæ¨ç†æ—¶ cuda graph çš„é€‰æ‹©è¦é‡‡ç”¨å‘ä¸Šå¯¹é½çš„åˆ†æ¡¶ç­–ç•¥ï¼Œå³ï¼šæ‰¹æ¬¡ç›¸ç­‰æˆ–ç¨å¤§çš„ï¼Œè€Œä¸æ˜¯é€‰æ‹©æ‰¹æ¬¡æœ€å¤§çš„ï¼Ÿ</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è™½ç„¶åœ¨å»ºå›¾ï¼ˆCaptureï¼‰é˜¶æ®µï¼Œç³»ç»Ÿä¼šæŒ‰ç…§æœ€å¤§æ‰¹æ¬¡ï¼ˆMax Batch Sizeï¼‰é¢„å…ˆç”³è¯·å¹¶é”å®šé™æ€æ˜¾å­˜ç©ºé—´ï¼Œæ­¤æ—¶å³ä¾¿é€‰æ‹©æœ€å¤§æ‰¹æ¬¡æ‰§è¡Œä¹Ÿä¸ä¼šäº§ç”Ÿé¢å¤–çš„æ˜¾å­˜å®¹é‡æµªè´¹ï¼Œä½†ä¼šå¼•å…¥ä»¥ä¸‹ä¸¤ä¸ªç»´åº¦çš„æ€§èƒ½æŸè€—ï¼š</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ˜¾å­˜å¸¦å®½çš„æ— æ•ˆå ç”¨ï¼Œå¤§æ¨¡å‹æ¨ç†ï¼ˆå°¤å…¶æ˜¯ Decoding é˜¶æ®µï¼‰å±äºå…¸å‹çš„è®¿å­˜å¯†é›†å‹ä»»åŠ¡ï¼Œå…¶ç“¶é¢ˆåœ¨äºæ¨¡å‹æƒé‡ä»æ˜¾å­˜åˆ°è®¡ç®—å•å…ƒçš„æ¬è¿é€Ÿåº¦ã€‚å³ä¾¿å¤§éƒ¨åˆ†æ‰¹æ¬¡ä½ç½®æ˜¯ Paddingï¼ˆç©ºæ•°æ®ï¼‰ï¼ŒCUDA Graph ä¾ç„¶ä¼šä¸¥æ ¼æ‰§è¡Œå½•åˆ¶æ—¶çš„å†…å­˜å¯»å€å®šä¹‰ï¼Œæ¬è¿å®Œæ•´æ‰¹æ¬¡çš„æ•°æ®ã€‚ä½¿ç”¨è¿‡å¤§çš„æ‰¹æ¬¡ä¼šå¯¼è‡´ GPU æµªè´¹æå…¶å®è´µçš„å¸¦å®½å»æ¬è¿â€œæ— æ•ˆæ•°æ®â€ï¼Œä»è€Œå¢åŠ å•æ¬¡æ¨ç†çš„è€—æ—¶ï¼Œæ¨é«˜æ¨ç†å»¶è¿Ÿï¼ˆLatencyï¼‰ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è®¡ç®—èµ„æºçš„æ— æ•ˆå ç”¨ï¼ŒGPU è°ƒåº¦å™¨ä¼šæ ¹æ®å›¾å®šä¹‰çš„è§„æ¨¡é¢„åˆ†é…ç¡¬ä»¶èµ„æºï¼ˆå¦‚ SM æ ¸å¿ƒã€å¯„å­˜å™¨ã€å…±äº«æ˜¾å­˜ç­‰ï¼‰ã€‚è™½ç„¶ Padding éƒ¨åˆ†çš„è®¡ç®—é€»è¾‘æå¿«ï¼Œä½†è¿™äº›èµ„æºåœ¨æ•´ä¸ª CUDA Graph æ‰§è¡Œå®Œæˆå‰æ— æ³•è¢«é‡Šæ”¾ã€‚è¿™ä¼šå¯¼è‡´ GPU ç¡¬ä»¶å¤„äºâ€œè™šå‡ç¹å¿™â€çŠ¶æ€ï¼Œé˜»å¡äº†å…¶ä»–æ½œåœ¨ä»»åŠ¡ï¼ˆå¦‚å¤šæµå¹¶è¡Œç­‰ï¼‰è·å–ç¡¬ä»¶èµ„æºï¼Œå‰Šå¼±äº†ç³»ç»Ÿæ•´ä½“çš„å¹¶å‘ååèƒ½åŠ›ï¼ˆThroughputï¼‰ã€‚</span></div>\n</div>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>7. Torch Compilation</span></h1>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>7.1. æ¦‚å¿µç†è§£</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>torch.compile èƒ½å¤Ÿå°† PyTorch å¼ é‡è®¡ç®—ç›¸å…³çš„ Python é€»è¾‘ï¼Œè½¬åŒ–ä¸ºæ›´é«˜æ•ˆçš„ä¸­é—´è¡¨ç¤ºï¼ˆåœ¨ CUDA è®¾å¤‡ä¸Šï¼Œé€šå¸¸æ˜¯ Triton å†…æ ¸ä»£ç ï¼Œä¹Ÿæ”¯æŒåŸç”Ÿ CUDA å†…æ ¸ï¼‰ã€‚ç›¸è¾ƒäºä¼ ç»Ÿçš„å³æ—¶æ‰§è¡Œï¼ˆEager Modeï¼‰ï¼Œè¿™ç§æ–¹å¼é€šè¿‡ä¼˜åŒ–è®¡ç®—å†…æ ¸æœ¬èº«å¸¦æ¥æ˜¾è‘—çš„è¿è¡Œæ•ˆç‡æå‡ï¼›æ­¤å¤–ï¼Œå½“è¾“å…¥å¼ é‡å½¢çŠ¶ã€æ•°æ®ç±»å‹å›ºå®šæ—¶ï¼Œtorch.compile è¿˜ä¼šè‡ªåŠ¨å¯ç”¨ CUDA Graph ä¼˜åŒ–ï¼Œè¿›ä¸€æ­¥æ”¾å¤§æ€§èƒ½æ”¶ç›Šã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>åœ¨ torch.compile é—®ä¸–ä¹‹å‰ï¼ŒPyTorch å¼€å‘è€…è‹¥æƒ³è¿½æ±‚é«˜æ€§èƒ½ï¼Œä»…æœ‰ä¸¤ç§æ ¸å¿ƒé€‰æ‹©ï¼šä¸€æ˜¯ä½¿ç”¨ Eager Mode æ¥å—å…¶åŸç”Ÿæ€§èƒ½ä¸Šé™ï¼ŒäºŒæ˜¯æ‰‹åŠ¨ç¼–å†™ Triton æˆ– CUDA åº•å±‚å†…æ ¸ä»£ç ï¼ˆè¯¥æ–¹å¼å¼€å‘é—¨æ§›é«˜ã€å‘¨æœŸé•¿ã€ç»´æŠ¤æˆæœ¬é«˜ï¼‰ã€‚è€Œæœ‰äº† torch.compile åï¼Œå¼€å‘è€…åªéœ€ç¼–å†™ç®€æ´æ˜“æ‡‚çš„ PyTorch Python ä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€å…³æ³¨åº•å±‚ç¡¬ä»¶é€‚é…ä¸å†…æ ¸å®ç°ï¼Œå³å¯è·å¾—æ¥è¿‘æ‰‹å†™ Triton/CUDA çš„ä¼˜å¼‚æ€§èƒ½ï¼Œå¤§å¹…å¹³è¡¡äº†å¼€å‘æ•ˆç‡ä¸è¿è¡Œæ€§èƒ½ã€‚</span></div>\n</div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>7.2. ä½¿ç”¨æ–¹æ³•</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>åº”ç”¨ torch.compile éå¸¸ç®€å•ï¼Œæ ¸å¿ƒæœ‰ä¸¤ç±»ä½¿ç”¨æ–¹å¼ï¼š</span></div>\n</div>\n<ul class=\"public-DraftStyleDefault-ul\">\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>è£…é¥°å™¨æ–¹å¼ï¼šåœ¨ PyTorch å‡½æ•°ä¸Šç›´æ¥æ·»åŠ  @torch.compile è£…é¥°å™¨ï¼Œå®šä¹‰æ—¶å³å®Œæˆç¼–è¯‘å£°æ˜ï¼›</span></div>\n</li>\n<li class=\"Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ˜¾å¼è°ƒç”¨æ–¹å¼ï¼šé€šè¿‡ compiled_obj = torch.compile(target) æ˜¾å¼ç¼–è¯‘ç›®æ ‡å¯¹è±¡ï¼Œåç»­è°ƒç”¨ compiled_obj å³å¯ä½¿ç”¨ä¼˜åŒ–åçš„é€»è¾‘ï¼›</span></div>\n</li>\n</ul>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å¦å¤–ï¼Œå¯ä»¥å¯¹æ¨¡å‹å®ä¾‹çš„ç›´æ¥ç¼–è¯‘ï¼šå¯¹äº PyTorch æ¨¡å‹ï¼ˆnn.Module å­ç±»å®ä¾‹ï¼‰ï¼Œå¯ç›´æ¥ä¼ å…¥ torch.compile å®Œæˆæ•´ä½“ç¼–è¯‘ï¼Œæ— éœ€å•ç‹¬ä¿®é¥° forward æ–¹æ³•ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ç¤ºä¾‹ä»£ç ï¼š</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ–¹å¼ 1ï¼šè£…é¥°å™¨æ–¹å¼ï¼ˆé€‚ç”¨äºå‡½æ•° / æ¨¡å‹æ–¹æ³•ï¼‰</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> torch\n</span><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> torch.nn as nn\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¯¹æ™®é€šPyTorchå‡½æ•°ä½¿ç”¨è£…é¥°å™¨</span>\n<span style=\"color: rgba(0, 0, 0, 1);\">@torch.compile\n</span><span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> my_tensor_func(x, y):\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> torch.matmul(x, y) +<span style=\"color: rgba(0, 0, 0, 1);\"> torch.relu(y)\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¯¹æ¨¡å‹çš„forwardæ–¹æ³•ä½¿ç”¨è£…é¥°å™¨</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> MyModel(nn.Module):\n    @torch.compile  </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> ä¿®é¥°forwardæ–¹æ³•ï¼Œè‡ªåŠ¨ç¼–è¯‘æ¨¡å‹æ¨ç†é€»è¾‘</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> forward(self, x):\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> nn.Linear(10, 20)(x)</pre>\n</div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ–¹å¼ 2ï¼šæ˜¾å¼è°ƒç”¨æ–¹å¼ï¼ˆé€‚ç”¨äºå‡½æ•° / æ¨¡å‹ï¼Œçµæ´»æ€§æ›´é«˜ï¼‰</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> torch\n</span><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> torch.nn as nn\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ˜¾å¼ç¼–è¯‘æ™®é€šå‡½æ•°</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> my_tensor_func(x, y):\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> torch.matmul(x, y) +<span style=\"color: rgba(0, 0, 0, 1);\"> torch.relu(y)\ncompiled_func </span>= torch.compile(my_tensor_func)  <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç”Ÿæˆç¼–è¯‘åçš„å‡½æ•°</span>\noutput = compiled_func(torch.randn(32, 10), torch.randn(10, 20))  <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> è°ƒç”¨ç¼–è¯‘åçš„å‡½æ•°</span>\n\n<span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> æ˜¾å¼ç¼–è¯‘æ¨¡å‹ï¼ˆä¸æ–¹å¼3æœ¬è´¨ä¸€è‡´ï¼Œæ›´å¼ºè°ƒâ€œå…ˆç¼–è¯‘åä½¿ç”¨â€çš„æ˜¾å¼æµç¨‹ï¼‰</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> MyModel(nn.Module):\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> forward(self, x):\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> nn.Linear(10, 20<span style=\"color: rgba(0, 0, 0, 1);\">)(x)\nmodel </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> MyModel()\ncompiled_model </span>= torch.compile(model)  <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç›´æ¥ç¼–è¯‘æ•´ä¸ªæ¨¡å‹å®ä¾‹</span>\noutput = compiled_model(torch.randn(32, 10))  <span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> è°ƒç”¨ç¼–è¯‘åçš„æ¨¡å‹</span></pre>\n</div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ–¹å¼ 3ï¼šç›´æ¥ç¼–è¯‘æ¨¡å‹å®ä¾‹ï¼ˆæ·±åº¦å­¦ä¹ ä¸­æœ€å¸¸ç”¨ï¼Œç®€åŒ–å†™æ³•ï¼‰</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> torch\n</span><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> torch.nn as nn\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> MyModel(nn.Module):\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> forward(self, x):\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> nn.Linear(10, 20<span style=\"color: rgba(0, 0, 0, 1);\">)(x)\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç›´æ¥ç¼–è¯‘æ¨¡å‹å®ä¾‹ï¼Œä¸€æ­¥åˆ°ä½ï¼ˆæ— éœ€è£…é¥°å™¨ï¼Œæœ€ç®€æ´å¸¸ç”¨ï¼‰</span>\nmodel =<span style=\"color: rgba(0, 0, 0, 1);\"> torch.compile(MyModel())\noutput </span>= model(torch.randn(32, 10))</pre>\n</div>\n</div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>7.3. æ€§èƒ½å¯¹æ¯”</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¸‹é¢ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­å¯¹æ¯” Eager Mode å’Œ Compiled Modeï¼š</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> torch\n</span><span style=\"color: rgba(0, 0, 255, 1);\">import</span><span style=\"color: rgba(0, 0, 0, 1);\"> time\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> ç¡®ä¿ä½¿ç”¨çš„æ˜¯ GPU</span>\ndevice = <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">cuda</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> torch.cuda.is_available() <span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">cpu</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">if</span> device == <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">cpu</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">è­¦å‘Šï¼šCUDA ä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨ CPU è¿è¡Œï¼ˆtorch.compile çš„ä¼˜åŠ¿åœ¨ GPU ä¸Šæœ€æ˜æ˜¾ï¼‰ã€‚</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> complex_operation_eager(x, y):\n    z </span>= x *<span style=\"color: rgba(0, 0, 0, 1);\"> y\n    z </span>= z +<span style=\"color: rgba(0, 0, 0, 1);\"> x\n    z </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> torch.relu(z)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> z.sum()\n\n@torch.compile\n</span><span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> complex_operation_graph(x, y):\n    z </span>= x *<span style=\"color: rgba(0, 0, 0, 1);\"> y\n    z </span>= z +<span style=\"color: rgba(0, 0, 0, 1);\"> x\n    z </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> torch.relu(z)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> z.sum()\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 1. å‡†å¤‡æ•°æ®</span>\nx = torch.randn(10000, 10000, device=<span style=\"color: rgba(0, 0, 0, 1);\">device)\ny </span>= torch.randn(10000, 10000, device=<span style=\"color: rgba(0, 0, 0, 1);\">device)\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 2. çƒ­èº« (Warm up)</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">æ­£åœ¨ç¼–è¯‘å¹¶è¿›è¡Œå¤šæ¬¡çƒ­èº«ä»¥ç¨³å®š GPU çŠ¶æ€...</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> å¢åŠ çƒ­èº«å¾ªç¯</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">for</span> i <span style=\"color: rgba(0, 0, 255, 1);\">in</span> range(3<span style=\"color: rgba(0, 0, 0, 1);\">): \n    complex_operation_graph(x, y)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> i ==<span style=\"color: rgba(0, 0, 0, 1);\"> 0:\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">-&gt; é¦–æ¬¡ç¼–è¯‘å®Œæˆï¼Œæ­£åœ¨è¿›è¡Œåç»­é¢„çƒ­...</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\ntorch.cuda.synchronize()\n</span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">é¢„çƒ­å®Œæ¯•ï¼Œå¼€å§‹æ­£å¼æµ‹è¯•ã€‚</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">def</span> benchmark(func, x, y, label, iterations=100<span style=\"color: rgba(0, 0, 0, 1);\">):\n    start_event </span>= torch.cuda.Event(enable_timing=<span style=\"color: rgba(0, 0, 0, 1);\">True)\n    end_event </span>= torch.cuda.Event(enable_timing=<span style=\"color: rgba(0, 0, 0, 1);\">True)\n    \n    start_event.record()\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> _ <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> range(iterations):\n        func(x, y)\n    end_event.record()\n    \n    torch.cuda.synchronize()\n    \n    elapsed_time_ms </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> start_event.elapsed_time(end_event)\n    avg_time_s </span>= (elapsed_time_ms / 1000) /<span style=\"color: rgba(0, 0, 0, 1);\"> iterations\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">{label} å¹³å‡è€—æ—¶: {avg_time_s:.6f} ç§’</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> avg_time_s\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 3. æ‰§è¡Œæµ‹è¯•å¹¶è®¡ç®—åŠ é€Ÿæ¯”</span>\n<span style=\"color: rgba(0, 0, 0, 1);\">with torch.no_grad():\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">-</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> * 30<span style=\"color: rgba(0, 0, 0, 1);\">)\n    eager_time </span>= benchmark(complex_operation_eager, x, y, <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Eager Mode   </span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    compile_time </span>= benchmark(complex_operation_graph, x, y, <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Compiled Mode</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">-</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> * 30<span style=\"color: rgba(0, 0, 0, 1);\">)\n    \n    </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> è®¡ç®—åŠ é€Ÿæ¯”é€»è¾‘</span>\n    speedup = eager_time /<span style=\"color: rgba(0, 0, 0, 1);\"> compile_time\n    improvement </span>= (speedup - 1) * 100\n    \n    <span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">æ€§èƒ½æå‡ç»“æœ:</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">åŠ é€Ÿæ¯” (Speedup): {speedup:.2f}x</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">è¿è¡Œé€Ÿåº¦æå‡äº†: {improvement:.1f}%</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>)</pre>\n</div>\n<p><span>è¿è¡Œè¾“å‡ºï¼š</span></p>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 0, 1);\">æ­£åœ¨ç¼–è¯‘å¹¶è¿›è¡Œå¤šæ¬¡çƒ­èº«ä»¥ç¨³å®š GPU çŠ¶æ€...\n</span>-&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> é¦–æ¬¡ç¼–è¯‘å®Œæˆï¼Œæ­£åœ¨è¿›è¡Œåç»­é¢„çƒ­...\né¢„çƒ­å®Œæ¯•ï¼Œå¼€å§‹æ­£å¼æµ‹è¯•ã€‚\n</span>------------------------------<span style=\"color: rgba(0, 0, 0, 1);\">\nEager Mode    å¹³å‡è€—æ—¶: </span>0.005690<span style=\"color: rgba(0, 0, 0, 1);\"> ç§’\nCompiled Mode å¹³å‡è€—æ—¶: </span>0.001528<span style=\"color: rgba(0, 0, 0, 1);\"> ç§’\n</span>------------------------------<span style=\"color: rgba(0, 0, 0, 1);\">\næ€§èƒ½æå‡ç»“æœ:\nåŠ é€Ÿæ¯” (Speedup): </span>3<span style=\"color: rgba(0, 0, 0, 1);\">.72x\nè¿è¡Œé€Ÿåº¦æå‡äº†: </span>272.3%</pre>\n</div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ€§èƒ½æœ‰æ•°å€çš„æå‡ã€‚</span></div>\n</div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>7.4. Q&amp;A</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ1ï¼‰æ—¢ç„¶ torch.compile æœ‰è¿™ä¹ˆå¤§çš„å¥½å¤„ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ç»™æ‰€æœ‰çš„å¼ é‡æ“ä½œå‡½æ•°éƒ½åŠ ä¸Š @torch.compileï¼Ÿ</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æœ‰å‡ æ–¹é¢çš„åŸå› ï¼šé¦–å…ˆï¼Œå­˜åœ¨ç¼–è¯‘å¼€é”€ï¼Œä¼šå¯¼è‡´é¦–æ¬¡è¿è¡Œæ˜¾è‘—å˜æ…¢ï¼›ç„¶åï¼Œç¼–è¯‘å™¨ç”Ÿæˆçš„ Triton å†…æ ¸ï¼ˆæˆ–å…¶ä»–åç«¯ä»£ç ï¼‰é€šå¸¸æ˜¯é’ˆå¯¹ç‰¹å®šå¼ é‡å½¢çŠ¶ã€æ•°æ®ç±»å‹å’Œè®¾å¤‡é…ç½®ä¼˜åŒ–çš„ï¼Œå¦‚æœè¾“å…¥å¼ é‡çš„è¿™äº›å±æ€§é¢‘ç¹å˜åŒ–ï¼Œä¼šåå¤è§¦å‘é‡æ–°ç¼–è¯‘ï¼ˆå³ â€œç¼–è¯‘ç¼“å­˜å¤±æ•ˆâ€ï¼‰ï¼Œåè€ŒæŠµæ¶ˆæ€§èƒ½æ”¶ç›Šï¼›ç¬¬ä¸‰ï¼Œtorch.compile è‡ªèº«ä¼šå¸¦æ¥é¢å¤–çš„æ˜¾å­˜å¼€é”€ï¼ˆç”¨äºå­˜å‚¨ç¼–è¯‘åçš„ä¸­é—´è¡¨ç¤ºã€å†…æ ¸ç¼“å­˜ç­‰ï¼‰ï¼Œè¿‡å¤šæ— å·®åˆ«ä½¿ç”¨å¯èƒ½å¯¼è‡´æ˜¾å­˜ä¸è¶³ï¼ˆOOMï¼‰ï¼›æœ€åï¼Œå¹¶éæ‰€æœ‰ä»£ç éƒ½èƒ½è¢«æˆåŠŸå›¾åŒ–ä¼˜åŒ–ï¼Œå¦‚æœå¼ é‡æ“ä½œä¸­è°ƒç”¨äº†é PyTorch åŸç”Ÿçš„ç¬¬ä¸‰æ–¹åº“ï¼ˆæˆ–çº¯ Python åŸç”Ÿé€»è¾‘ï¼‰ï¼Œä¼šå¯¼è‡´è®¡ç®—å›¾ä¸­æ–­ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨æ— æ³•ç»§ç»­ä¼˜åŒ–åç»­é€»è¾‘ï¼Œè¿˜éœ€è¦å°†æ§åˆ¶æƒäº¤å›ç»™ Python è§£é‡Šå™¨ï¼Œäº§ç”Ÿä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œå¯èƒ½å¯¼è‡´è´Ÿä¼˜åŒ–ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ2ï¼‰torch.compile æ”¯æŒç”ŸæˆåŸç”Ÿ CUDA å†…æ ¸ä»£ç ï¼Œä½†é€šå¸¸æ¥è¯´ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„é€šç”¨åŸç”Ÿ CUDA ä»£ç ä¼˜åŒ–ç²’åº¦ä¸å¤Ÿç²¾ç»†ï¼›è€Œ Triton å†…ç½®äº†æå¼ºçš„ Autotuningï¼ˆè‡ªåŠ¨è°ƒä¼˜ï¼‰èƒ½åŠ›ï¼Œé’ˆå¯¹æ·±åº¦å­¦ä¹ å¼ é‡è®¡ç®—åœºæ™¯åšäº†æ·±åº¦é€‚é…ï¼Œå› æ­¤åœ¨ç»å¤§å¤šæ•°æ·±åº¦å­¦ä¹ ä»»åŠ¡ä¸­ï¼ŒTriton å†…æ ¸çš„æ€§èƒ½é€šå¸¸ä¼˜äºè‡ªåŠ¨ç”Ÿæˆçš„åŸç”Ÿ CUDA å†…æ ¸ã€‚</span></div>\n</div>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>8. Torch Compilationã€Tritionã€CUDA Graph ä¸‰è€…çš„åŒºåˆ«å’Œè”ç³»</span></h1>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>8.1. æ ¸å¿ƒåŒºåˆ«</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ1ï¼‰Torch Compilationï¼šPyTorch é«˜å±‚ä¸€ç«™å¼æ€§èƒ½ä¼˜åŒ–å…¥å£ï¼ˆç”¨æˆ·æ€æŠ½è±¡æ¥å£ï¼‰</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä½œä¸ºé¢å‘å¼€å‘è€…çš„é¡¶çº§ä¼˜åŒ–å°è£…ï¼Œtorch.compile æ— éœ€å¼€å‘è€…å…³æ³¨åº•å±‚ç¡¬ä»¶ç»†èŠ‚ä¸ä¼˜åŒ–å®ç°ï¼Œå…¶æ ¸å¿ƒå®šä½æ˜¯å¯¹ PyTorch å¼ é‡è®¡ç®—é€»è¾‘ï¼ˆå‡½æ•° /nn.Module æ¨¡å‹ï¼‰è¿›è¡Œç«¯åˆ°ç«¯è‡ªåŠ¨ä¼˜åŒ–ï¼Œå±è”½äº†åº•å±‚å†…æ ¸ç”Ÿæˆä¸æ‰§è¡Œä¼˜åŒ–çš„å¤æ‚æ€§ï¼Œæ˜¯ç»å¤§å¤šæ•° PyTorch å¼€å‘è€…çš„é¦–é€‰æ€§èƒ½ä¼˜åŒ–å·¥å…·ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ2ï¼‰Tritonï¼šé«˜æ€§èƒ½ GPU å†…æ ¸ä¸“ç”¨ DSL </span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>Triton æ—¢æ˜¯å¼€å‘è€…æ‰‹åŠ¨ç¼–å†™é«˜æ€§èƒ½å†…æ ¸çš„é¢†åŸŸä¸“ç”¨è¯­è¨€ï¼ˆDSLï¼‰ï¼Œä¹Ÿæ˜¯ torch.compile è‡ªåŠ¨åŒ–ç”Ÿæˆä»£ç çš„æ ¸å¿ƒç›®æ ‡åç«¯ã€‚å…¶ä¸­ï¼Œtriton.jit æ˜¯ Triton æ¡†æ¶æä¾›çš„å³æ—¶ç¼–è¯‘è£…é¥°å™¨ï¼Œå®šä½ä¸ºé«˜æ€§èƒ½è·¨å¹³å° GPU å†…æ ¸çš„æ‰‹åŠ¨å¼€å‘å…¥å£ï¼ŒæŠ½è±¡å±‚çº§ä½äº torch.compileã€é«˜äºåŸç”Ÿ CUDA C++ã€‚å®ƒå…è®¸å¼€å‘è€…ä»¥ Python é£æ ¼è¯­æ³•ç¼–å†™ GPU å†…æ ¸é€»è¾‘ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†çº¿ç¨‹è°ƒåº¦ã€å¯„å­˜å™¨åˆ†é…ç­‰åº•å±‚ç»†èŠ‚ï¼Œæœ€ç»ˆç¼–è¯‘ä¸ºé«˜æ•ˆ GPU æœºå™¨ç ï¼Œç”¨äºæ»¡è¶³å®šåˆ¶åŒ–ç®—å­çš„é«˜æ€§èƒ½éœ€æ±‚ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ3ï¼‰CUDA Graphï¼šGPU åº•å±‚é™æ€ä»»åŠ¡æµæ‰§è¡Œä¼˜åŒ–æŠ€æœ¯</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>CUDA Graph æ˜¯ä¸€ç§é™æ€ä»»åŠ¡æµè°ƒåº¦æŠ€æœ¯ï¼Œæ—¨åœ¨æ¶ˆé™¤ä¸»æœºç«¯ï¼ˆHostï¼‰ä¸è®¾å¤‡ç«¯ï¼ˆDeviceï¼‰ä¹‹é—´çš„äº¤äº’å»¶è¿Ÿã€‚å®ƒå¹¶é â€œå†…æ ¸ç”Ÿæˆå·¥å…·â€ï¼Œä¹Ÿé â€œç”¨æˆ·æ€ç¼–ç¨‹æ¥å£â€ï¼Œè€Œæ˜¯é’ˆå¯¹ CPU-GPU äº¤äº’ç“¶é¢ˆçš„åº•å±‚æ‰§è¡Œä¼˜åŒ–æŠ€æœ¯ï¼ŒæŠ½è±¡å±‚çº§æœ€ä½ã€‚å…¶æ ¸å¿ƒä½œç”¨æ˜¯å›ºåŒ–è¿ç»­çš„ CUDA å†…æ ¸è°ƒç”¨åºåˆ—ä¸å†…å­˜é…ç½®ï¼Œé€šè¿‡ â€œå½•åˆ¶ - é‡æ”¾â€ æ¨¡å¼æ¶ˆé™¤é‡å¤å†…æ ¸å¯åŠ¨ã€CPU-GPU é¢‘ç¹é€šä¿¡çš„å¼€é”€ï¼Œä»…ä¼˜åŒ–æ‰§è¡Œæµç¨‹ï¼Œä¸æ”¹å˜å†…æ ¸æœ¬èº«çš„è®¡ç®—æ€§èƒ½ã€‚</span></div>\n</div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>8.2. æ ¸å¿ƒè”ç³»</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ1ï¼‰torch.compile ä¾èµ– triton.jit å®ç°é«˜æ€§èƒ½å†…æ ¸ç”Ÿæˆ</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>torch.compile çš„é»˜è®¤åº•å±‚ç¼–è¯‘å™¨ï¼ˆInductorï¼‰åœ¨ CUDA è®¾å¤‡ä¸Šï¼Œä¼šè‡ªåŠ¨å°† PyTorch è®¡ç®—é€»è¾‘è½¬åŒ–ä¸º Triton å†…æ ¸ä»£ç ï¼Œå¹¶éšå¼è°ƒç”¨ triton.jit å®Œæˆç¼–è¯‘ï¼Œç”Ÿæˆé«˜æ€§èƒ½ GPU å†…æ ¸ï¼ˆå¼€å‘è€…æ— éœ€æ‰‹åŠ¨ç¼–å†™ Triton ä»£ç ï¼Œä¹Ÿæ— éœ€æ„ŸçŸ¥ triton.jit çš„å­˜åœ¨ï¼‰ã€‚æ­¤å¤–ï¼Œtorch.compile ä¹Ÿæ”¯æŒç”ŸæˆåŸç”Ÿ CUDA å†…æ ¸ï¼Œä½œä¸º Triton å†…æ ¸çš„å¯é€‰è¡¥å……æ–¹æ¡ˆã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ2ï¼‰torch.compile é›†æˆ CUDA Graph å®ç°æ‰§è¡Œå±‚äºŒæ¬¡ä¼˜åŒ–</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å½“è¾“å…¥å¼ é‡çš„å½¢çŠ¶ã€æ•°æ®ç±»å‹ç­‰å±æ€§å›ºå®šæ—¶ï¼Œtorch.compile ä¼šè‡ªåŠ¨å¯ç”¨ CUDA Graph ä¼˜åŒ–ï¼Œå°†ç¼–è¯‘ç”Ÿæˆçš„ Triton/CUDA å†…æ ¸è°ƒç”¨åºåˆ—å½•åˆ¶ä¸º CUDA å›¾ã€‚åç»­é‡å¤æ‰§è¡Œè¯¥é€»è¾‘æ—¶ï¼Œç›´æ¥åœ¨ GPU ä¸Šé‡æ”¾è¯¥å›¾ï¼Œè¿›ä¸€æ­¥æ”¾å¤§æ€§èƒ½æ”¶ç›Šï¼Œå®ç° â€œå†…æ ¸è®¡ç®—ä¼˜åŒ–â€ ä¸ â€œæ‰§è¡Œæµç¨‹ä¼˜åŒ–â€ çš„ååŒå¢æ•ˆã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ3ï¼‰triton.jit è‡ªå®šä¹‰å†…æ ¸å¯ä¸ CUDA Graph æ‰‹åŠ¨ååŒ</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å¼€å‘è€…æ‰‹åŠ¨é€šè¿‡ triton.jit ç¼–å†™å¹¶ç¼–è¯‘çš„è‡ªå®šä¹‰å†…æ ¸ï¼Œåœ¨æ‰¹é‡é‡å¤æ‰§è¡Œï¼ˆè¾“å…¥å½¢çŠ¶å›ºå®šï¼‰çš„åœºæ™¯ä¸‹ï¼Œå¯æ‰‹åŠ¨é›†æˆ CUDA Graph å®Œæˆ â€œå½•åˆ¶ - é‡æ”¾â€ æµç¨‹ï¼Œæ¶ˆé™¤ CPU å¯¹ GPU çš„è°ƒåº¦å¼€é”€ï¼Œå®ç°å†…æ ¸è®¡ç®—æ€§èƒ½ä¸æ‰§è¡Œæ•ˆç‡çš„åŒé‡æè‡´ä¼˜åŒ–ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ4ï¼‰ä¸‰è€…ååŒæ„å»ºæè‡´æ€§èƒ½è®¡ç®—é“¾è·¯</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å…¸å‹æè‡´æ€§èƒ½é“¾è·¯ï¼šæ‰‹åŠ¨ç¼–å†™ triton.jit å®šåˆ¶å†…æ ¸ â†’ åµŒå…¥ PyTorch æ¨¡å‹ / å‡½æ•° â†’ é€šè¿‡ torch.compile è¿›è¡Œä¸Šå±‚è®¡ç®—å›¾ä¼˜åŒ–ï¼ˆç®—å­èåˆã€å†…å­˜å¤ç”¨ç­‰ï¼‰ â†’ torch.compile è‡ªåŠ¨å¯ç”¨ CUDA Graph ä¼˜åŒ–æ‰§è¡Œæµç¨‹ â†’ å®ç° GPU è®¡ç®—æ€§èƒ½æœ€å¤§åŒ–ã€‚</span></div>\n</div>\n<h1 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>9. TP æ¨¡å¼</span></h1>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>TP æ¨¡å¼å°†çŸ©é˜µè®¡ç®—æŒ‰è¡Œã€åˆ—æ‹†åˆ†åˆ°å¤šé¢— GPU ä¸Šæ‰§è¡Œï¼Œæ¶‰åŠä¸¤ä¸ªå…³é”®ç‚¹ï¼šæƒé‡å‚æ•°æ€ä¹ˆåŠ è½½ã€å¤šæ ¸è®¡ç®—ä¹‹é—´å¦‚ä½•ååŒï¼Œä¸‹é¢åšä»‹ç»ã€‚</span></div>\n</div>\n<h2 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>9.1. åŠ è½½æƒé‡å‚æ•°</span></h2>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æƒé‡å‚æ•°ä¸çŸ©é˜µè®¡ç®—å¼ºç›¸å…³ï¼Œå› æ­¤æƒé‡å‚æ•°çš„åŠ è½½é€»è¾‘é€šå¸¸ä¸çŸ©é˜µè®¡ç®—é€»è¾‘ä¸€åŒå°è£…åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œå®ç°åŠŸèƒ½çš„å†…èšæ€§ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<h3 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>9.1.1. å…³é”®æŠ€æœ¯ç‚¹</span></h3>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ1ï¼‰å‚æ•°æ–‡ä»¶ä¸­ï¼Œæƒé‡çŸ©é˜µä»¥ Key-Value é”®å€¼å¯¹å½¢å¼å­˜å‚¨ï¼Œè¯»å–æ—¶åŒæ ·é‡‡ç”¨ Key-Value æ–¹å¼è§£æã€‚å…¶ä¸­ key å¯¹åº”æƒé‡çŸ©é˜µåœ¨æ¨¡å‹ä¸­çš„å½’å±ä½ç½®ï¼Œä¾‹å¦‚ï¼šæ¨¡å‹ç¬¬ 0 å±‚ MLP å­å±‚çš„ down proj æƒé‡å¯¹åº”çš„ key ä¸º model.layers.0.mlp.down_proj.weightã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ2ï¼‰å‚æ•°æ–‡ä»¶ç”±è®­ç»ƒæµç¨‹å†™å…¥ã€æ¨ç†æµç¨‹è¯»å–ï¼Œè®­ç»ƒä¸æ¨ç†ä¸¤ä¾§å¿…é¡»ä¸¥æ ¼å¯¹é½ key çš„å‘½åè§„åˆ™ã€‚æ¨¡å‹å‚æ•°åŠ è½½æ—¶ï¼Œä¼šæ ¹æ®å‚æ•°æ–‡ä»¶ä¸­çš„ key åç§°ï¼Œåœ¨ nn.Module å¯¹è±¡ä¸­åŒ¹é…å¹¶è°ƒç”¨å¯¹åº”çš„ weight_loader æ–¹æ³•å®ŒæˆåŠ è½½ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ3ï¼‰æ¨¡å‹ç»“æ„åŒ…å«å¤šä¸ªå±‚çº§ï¼Œæ¯ä¸€å±‚å†…éƒ¨åˆåŒ…å«å¤šä¸ªå­æ¨¡å—ï¼Œä¸åŒå­æ¨¡å—å¯¹åº”å„è‡ªä¸“å±çš„å‚æ•°åŠ è½½æ–¹æ³•ã€‚PyTorch çš„ nn.Module é€šè¿‡ç‰¹æ®Šæ–¹æ³• __setattr__ï¼Œå°†æ¨¡å‹ç»“æ„ä¸­çš„å„ä¸ªå­æ¨¡å—æ„å»ºä¸ºæ ‘å½¢ç»“æ„ï¼›æ ‘å½¢ç»“æ„ä¸­æ¯ä¸ªå¶å­èŠ‚ç‚¹çš„è·¯å¾„ï¼Œä¸å‚æ•°æ–‡ä»¶ä¸­çš„ key ä¸€ä¸€æ˜ å°„ï¼Œé€šè¿‡è¯¥è·¯å¾„æ‰¾åˆ°å¶å­èŠ‚ç‚¹åï¼Œå³å¯è·å–å¯¹åº”çš„å‚æ•°å¯¹è±¡ nn.Parameterï¼Œè€Œè¯¥å‚æ•°å¯¹è±¡ç»‘å®šäº†å…¶æ‰€å±å­æ¨¡å—çš„ weight_loader æ–¹æ³•ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ4ï¼‰çŸ©é˜µä¹˜æ³• A * B éµå¾ªã€ŒA çš„è¡Œ Ã— B çš„åˆ—ã€è®¡ç®—è§„åˆ™ï¼Œåœ¨æ¨¡å‹æ¨ç†ä¸­ï¼ŒB ä¸ºæƒé‡çŸ©é˜µï¼Œå®é™…è®¿é—®æ—¶ä»¥åˆ—ç»´åº¦ä¸ºä¸»ã€‚ä¸ºæå‡è¯»å–æ•ˆç‡ã€é¿å…ç¼“å­˜ï¼ˆCacheï¼‰é¢‘ç¹å¤±æ•ˆï¼Œæƒé‡çŸ©é˜µ B é€šå¸¸ä»¥è½¬ç½®å½¢å¼å­˜å‚¨ã€‚TPï¼ˆTensor Parallelï¼‰worker åŠ è½½æƒé‡æ—¶ï¼Œéœ€é€‚é…è¯¥è½¬ç½®å­˜å‚¨ç‰¹æ€§ â€”â€” å³æƒé‡çŸ©é˜µç¬¬ 0 ç»´å¯¹åº”åŸå§‹çŸ©é˜µçš„åˆ—æ•°æ®ï¼Œç¬¬ 1 ç»´å¯¹åº”åŸå§‹çŸ©é˜µçš„è¡Œæ•°æ®ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä»ä¸Šè¿°æŠ€æœ¯ç‚¹å¯å¾—å‡ºæ ¸å¿ƒå¯¹åº”å…³ç³»ï¼šå‚æ•°æ–‡ä»¶ä¸­çš„æ¨¡å‹ç»“æ„ä»¥ä¸€ä¸ªä¸ª key è¡¨ç¤ºï¼Œè¿™äº› key æŒ‰å±‚çº§å…³ç³»å¯æ„å»ºä¸ºä¸€æ£µè·¯å¾„æ ‘ï¼›ä»£ç ä¸­çš„æ¨¡å‹ç»“æ„ä»¥æœ‰åŒ…å«å…³ç³»çš„ç±»å¯¹è±¡è¡¨ç¤ºï¼Œè¿™äº›ç±»å¯¹è±¡åŒæ ·æ„æˆä¸€æ£µä¸å‚æ•°æ–‡ä»¶è·¯å¾„æ ‘å®Œå…¨å¯¹åº”çš„æ ‘ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<h3 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>9.1.2. å®æ“ä¸¾ä¾‹ï¼ˆFFN å±‚ up proj æƒé‡åŠ è½½ï¼‰</span></h3>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ1ï¼‰å‡è®¾ TP size=2ï¼Œup proj æƒé‡çŸ©é˜µçš„åŸå§‹å½¢çŠ¶ä¸º [1024, 3072]ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸ª TP worker å¦‚ä½•åŠ è½½æƒé‡ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ2ï¼‰é¦–å…ˆï¼Œæ„é€ æ¨¡å‹å¯¹è±¡æ—¶ï¼Œä¼šåˆå§‹åŒ– ColumnParallelLinear å¯¹è±¡ï¼Œå¹¶è®¾å®šæ ¸å¿ƒå‚æ•°ï¼šinput_size=1024ï¼Œoutput_size=3072/2=1536ï¼ˆæŒ‰ TP å°ºå¯¸åšå‡åˆ†ï¼‰ã€‚è¿™ä¸¤ä¸ªå‚æ•°æœ€ç»ˆç”¨äºåˆå§‹åŒ– nn.Parameter å¯¹è±¡ï¼Œå¯¹åº”ä»£ç ä¸º <span><span>self.weight = nn.Parameter(torch.empty(output_size, input_size))<span>ï¼Œéœ€æ³¨æ„æ­¤å¤„åˆå§‹åŒ–çš„å¼ é‡ä»¥ output_size ä¸ºè¡Œç»´åº¦ã€input_size ä¸ºåˆ—ç»´åº¦ã€‚</span></span></span></span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ3ï¼‰éšåï¼Œå¯åŠ¨æ¨¡å‹æƒé‡åŠ è½½æµç¨‹ï¼šå…ˆä»å‚æ•°æ–‡ä»¶ä¸­è¯»å–æ‰€æœ‰ key-value é”®å€¼å¯¹ï¼Œå†é€šè¿‡ key åœ¨ nn.Module æ ‘å½¢ç»“æ„ä¸­æŸ¥æ‰¾å¯¹åº”çš„ nn.Parameter å¯¹è±¡ï¼ŒåŒ¹é…åˆ°åè°ƒç”¨å…¶ç»‘å®šçš„ weight_loader å‡½æ•°ï¼Œæ‰§è¡Œå…·ä½“çš„å‚æ•°åŠ è½½æ“ä½œã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ4ï¼‰å‚æ•°åŠ è½½é˜¶æ®µï¼Œé’ˆå¯¹åˆ—å¹¶è¡Œæ¨¡å¼ï¼Œéœ€è¦å¯¹æƒé‡å¼ é‡çš„ç¬¬ 0 ç»´åº¦è¿›è¡Œæ‹†åˆ†ï¼Œå†æ ¹æ®å½“å‰è¿›ç¨‹çš„ tp_rankï¼ˆTP è¿›ç¨‹ç¼–å·ï¼‰ï¼Œç¡®å®šæœ¬è¿›ç¨‹éœ€è¦åŠ è½½çš„æƒé‡åŒºé—´ï¼Œå®Œæˆåˆ†ç‰‡æƒé‡çš„åŠ è½½ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ³¨ï¼šä»£ç å®ç°ä¸­ï¼Œä¼šå°† gate çŸ©é˜µä¸ up çŸ©é˜µè¿›è¡Œåˆå¹¶åŠ è½½åˆ°æ˜¾å­˜ä¸­ï¼Œå› æ­¤å®é™…åŠ è½½æµç¨‹ä¼šåœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ å‡ æ­¥é¢å¤–æ­¥éª¤ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<h3 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>9.1.3. æ„é€ æ ‘å½¢ç»“æ„ç¤ºä¾‹ä»£ç </span></h3>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¸‹é¢ demo ä»£ç å±•ç¤ºå¤šä¸ªæœ‰å±‚çº§çš„å¯¹è±¡å¦‚ä½•é€šè¿‡ç‰¹æ®Šæ–¹æ³• __setattr__ æ„é€ æ ‘å½¢ç»“æ„.</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> MiniModule:\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">def</span> <span style=\"color: rgba(128, 0, 128, 1);\">__init__</span>(self, name=<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">root</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">):\n        self._name </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> name\n        self._modules </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> {}\n        self._parameters </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> {}\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">def</span> <span style=\"color: rgba(128, 0, 128, 1);\">__setattr__</span><span style=\"color: rgba(0, 0, 0, 1);\">(self, name, value):\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span><span style=\"color: rgba(0, 0, 0, 1);\"> isinstance(value, MiniModule):\n            self._modules[name] </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> value\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">elif</span> name.endswith(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">_weight_loader</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">):\n            self._parameters[name] </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> value\n\n        super().</span><span style=\"color: rgba(128, 0, 128, 1);\">__setattr__</span><span style=\"color: rgba(0, 0, 0, 1);\">(name, value)\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">def</span> get_all_paths(self, prefix=<span style=\"color: rgba(128, 0, 0, 1);\">\"\"</span><span style=\"color: rgba(0, 0, 0, 1);\">):\n        </span><span style=\"color: rgba(128, 0, 0, 1);\">\"\"\"</span><span style=\"color: rgba(128, 0, 0, 1);\">é€’å½’éå†å¹¶æ”¶é›†æ‰€æœ‰å‚æ•°çš„å®Œæ•´è·¯å¾„</span><span style=\"color: rgba(128, 0, 0, 1);\">\"\"\"</span><span style=\"color: rgba(0, 0, 0, 1);\">\n        paths </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> []\n\n        </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 1. å…ˆæ”¶é›†å½“å‰å±‚çº§çš„å‚æ•°è·¯å¾„</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">for</span> p_name <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> self._parameters:\n            full_path </span>= f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">{prefix}.{p_name}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> prefix <span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\"> p_name\n            paths.append(full_path)\n\n        </span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> 2. é€’å½’è¿›å…¥å­æ¨¡å—ï¼Œä¼ é€’æ›´æ–°åçš„å‰ç¼€</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">for</span> m_name, m_obj <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> self._modules.items():\n            new_prefix </span>= f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">{prefix}.{m_name}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> prefix <span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\"> m_name\n            paths.extend(m_obj.get_all_paths(new_prefix))\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> paths\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> q_weight_loader():\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">this is q_weight_loader</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> down_weight_loader():\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">this is down_weight_loader</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> --- æ„é€ æ ‘å½¢ç»“æ„ ---</span>\nmodel = MiniModule(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Qwen3</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\nmodel.layers </span>= MiniModule(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Layers</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\nmodel.layers.attention </span>= MiniModule(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">Attention</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\nmodel.layers.attention.q_weight_loader </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> q_weight_loader\nmodel.layers.mlp </span>= MiniModule(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">MLP</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\nmodel.layers.mlp.down_weight_loader </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> down_weight_loader\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> --- æ‰“å°æ‰€æœ‰è·¯å¾„ ---</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">print</span>(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">éå†æ¨¡å‹çš„æ‰€æœ‰å‚æ•°è·¯å¾„ï¼š</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\nall_paths </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> model.get_all_paths()\n</span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> path <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> all_paths:\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">è·¯å¾„: {path}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n</span><span style=\"color: rgba(0, 128, 0, 1);\">#</span><span style=\"color: rgba(0, 128, 0, 1);\"> --- æ¨¡æ‹Ÿ nano-vllm çš„è®¿é—®é€»è¾‘ ---</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">def</span><span style=\"color: rgba(0, 0, 0, 1);\"> mock_get_parameter(root, path):\n    parts </span>= path.split(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">.</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    curr </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> root\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> part <span style=\"color: rgba(0, 0, 255, 1);\">in</span> parts[:-1<span style=\"color: rgba(0, 0, 0, 1);\">]:\n        curr </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> curr._modules[part]\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> curr._parameters[parts[-1<span style=\"color: rgba(0, 0, 0, 1);\">]]\n\ntarget </span>= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">layers.attention.q_weight_loader</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">print</span>(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">\\næ¨¡æ‹ŸæŸ¥æ‰¾è·¯å¾„ '{target}':</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\nloader </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> mock_get_parameter(model, target)\nloader()</span></pre>\n</div>\n<p><span>è¾“å‡ºç»“æœï¼š</span></p>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 0, 1);\">éå†æ¨¡å‹çš„æ‰€æœ‰å‚æ•°è·¯å¾„ï¼š\nè·¯å¾„: layers.attention.q_weight_loader\nè·¯å¾„: layers.mlp.down_weight_loader\n\næ¨¡æ‹ŸæŸ¥æ‰¾è·¯å¾„ </span><span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">layers.attention.q_weight_loader</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(0, 0, 0, 1);\">:\nthis is q_weight_loader</span></pre>\n</div>\n<h2><span>9.2. å¤š GPU ä¹‹é—´çš„è®¡ç®—ååŒ</span></h2>\n</div>\n<div class=\"Editable-unstyled\">\n<h3 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>9.2.1. åŠŸèƒ½ç»†èŠ‚</span></h3>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>nano-vllm åªè€ƒè™‘å•æœºå†…çš„å¤š GPU ååŒï¼ŒååŒè¿‡ç¨‹å¦‚ä¸‹ï¼š</span></div>\n</div>\n<div class=\"Image-captionContainer\">\n<div>\n<div class=\"Image-resizerContainer css-ym3v7r\">\n<div class=\"css-79elbk\">\n<div>\n<div class=\"ImageDelete-Container css-xi606m\">\n<div class=\"ImageDelete-Wrapper css-1gomreu\" style=\"text-align: center;\"><img class=\"Image FocusPlugin--unfocused Image--isBlock css-1phd9a0\" height=\"351\" src=\"https://pic1.zhimg.com/80/v2-7f054d91f4badab37cab087059b847da_1440w.png?source=ccfced1a\" width=\"500\" /></div>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div style=\"text-align: center;\">å›¾ 5</div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ1ï¼‰è¿›ç¨‹éš”ç¦»ä¸ç‹¬ç«‹åŠ è½½ï¼š é‡‡ç”¨å¤šè¿›ç¨‹æ¨¡å¼ï¼Œä¸€ä¸ª GPU å¯¹åº”ä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹ã€‚å„è¿›ç¨‹å¹¶å‘è¯»å–æƒé‡æ–‡ä»¶ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„ tp_rank æŒ‰ç…§é¢„è®¾çš„åˆ‡åˆ†ç­–ç•¥ï¼ˆå¦‚ ColumnParallel çš„è¡Œåˆ‡åˆ†æˆ– RowParallel çš„åˆ—åˆ‡åˆ†ï¼‰ï¼Œå°†å±äºè‡ªå·±çš„é‚£éƒ¨åˆ†æ•°æ®ä» safetensors åŠ è½½åˆ°æ˜¾å­˜ä¸­ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ2ï¼‰æ§åˆ¶é¢ååŒï¼ˆControl Planeï¼‰ï¼š Rank 0 è´Ÿè´£å…¨å±€è°ƒåº¦ï¼Œé€šè¿‡å…±äº«å†…å­˜å°†æ¨ç†è¯·æ±‚ï¼ˆTokensã€Sampling Params ç­‰ï¼‰åŒæ­¥ç»™å…¶ä»– Rankã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ï¼ˆ3ï¼‰æ•°æ®é¢é€šä¿¡ï¼ˆData Planeï¼‰ï¼š åœ¨çŸ©é˜µè®¡ç®—çš„å…³é”®èŠ‚ç‚¹ï¼Œåˆ©ç”¨é€šä¿¡åŸè¯­ï¼ˆå¦‚ all-reduce å¤„ç†åˆ†å—æ±‚å’Œã€all-gather å¤„ç†åºåˆ—æ‹¼æ¥ï¼‰å®Œæˆå¼ é‡å¹¶è¡Œçš„ç»“æœæ±‡æ€»ï¼Œä½¿åˆ†å¸ƒåœ¨ä¸åŒæ˜¾å¡ä¸Šçš„è®¡ç®—ç»“æœåœ¨æ•°å­¦ä¸Šç­‰ä»·äºå•å¡è®¡ç®—ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<h3 class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>9.2.2. ç¤ºä¾‹ä»£ç </span></h3>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>ä¸‹é¢å†™ä¸€ä¸ªç®€å•çš„æ•°æ®é€šä¿¡ä¾‹å­ï¼š</span></div>\n</div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\">\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 0, 1);\">import torch\nimport torch.distributed as dist\nimport torch.multiprocessing as mp\nimport </span><span style=\"color: rgba(0, 0, 255, 1);\">time</span><span style=\"color: rgba(0, 0, 0, 1);\">\n\ndef setup(rank, world_size):\n    dist.init_process_group(\n        </span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">nccl</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">tcp://127.0.0.1:2333</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, world_size=world_size, rank=<span style=\"color: rgba(0, 0, 0, 1);\">rank\n    )\n    torch.cuda.set_device(rank)\n\ndef cleanup():\n    dist.destroy_process_group()\n\ndef test_all_reduce(rank, world_size):\n    </span><span style=\"color: rgba(128, 0, 0, 1);\">\"\"\"\n</span>    All-<span style=\"color: rgba(0, 0, 0, 1);\">Reduce å­å‡½æ•°ï¼šå°†æ‰€æœ‰ GPU çš„æ•°æ®è¿›è¡Œå½’çº¦æ“ä½œï¼ˆæ±‚å’Œï¼‰ï¼Œç»“æœåŒæ­¥åˆ°æ‰€æœ‰ GPU\n\n    ä½¿ç”¨åœºæ™¯ï¼š\n    </span>-<span style=\"color: rgba(0, 0, 0, 1);\"> RowParallelLinear çš„è¾“å‡ºèšåˆ\n    </span>-<span style=\"color: rgba(0, 0, 0, 1);\"> éœ€è¦æ‰€æœ‰ GPU éƒ½å¾—åˆ°ç›¸åŒçš„èšåˆç»“æœ\n    </span><span style=\"color: rgba(128, 0, 0, 1);\">\"\"\"\n</span>    print(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[Rank {rank}] ===== All-Reduce ç¤ºä¾‹ =====</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> rank == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n        data </span>= torch.tensor([<span style=\"color: rgba(128, 0, 128, 1);\">1.0</span>, <span style=\"color: rgba(128, 0, 128, 1);\">2.0</span>], device=f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">cuda:{rank}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n        data </span>= torch.tensor([<span style=\"color: rgba(128, 0, 128, 1);\">3.0</span>, <span style=\"color: rgba(128, 0, 128, 1);\">4.0</span>], device=f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">cuda:{rank}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n    print(f</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[Rank {rank}] All-Reduce before: {data}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    dist.all_reduce(data, op</span>=<span style=\"color: rgba(0, 0, 0, 1);\">dist.ReduceOp.SUM)\n    print(f</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[Rank {rank}] All-Reduce after:  {data}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\ndef test_all_gather(rank, world_size):\n    </span><span style=\"color: rgba(128, 0, 0, 1);\">\"\"\"\n</span>    All-<span style=\"color: rgba(0, 0, 0, 1);\">Gather å­å‡½æ•°ï¼šæ”¶é›†æ‰€æœ‰ GPU çš„æ•°æ®åˆ°æ¯ä¸ª GPU ä¸Š\n\n    ä½¿ç”¨åœºæ™¯ï¼š\n    </span>-<span style=\"color: rgba(0, 0, 0, 1);\"> VocabParallelEmbedding çš„è¾“å‡ºæ”¶é›†\n    </span>-<span style=\"color: rgba(0, 0, 0, 1);\"> ParallelLMHead çš„ logits æ”¶é›†\n    </span>-<span style=\"color: rgba(0, 0, 0, 1);\"> éœ€è¦æ¯ä¸ª GPU éƒ½è·å¾—æ‰€æœ‰ GPU çš„å®Œæ•´æ•°æ®\n    </span><span style=\"color: rgba(128, 0, 0, 1);\">\"\"\"\n</span>    print(f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[Rank {rank}] ===== All-Gather ç¤ºä¾‹ =====</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n    # Rank </span><span style=\"color: rgba(128, 0, 128, 1);\">0</span> äº§ç”Ÿ [<span style=\"color: rgba(128, 0, 128, 1);\">10</span>, <span style=\"color: rgba(128, 0, 128, 1);\">20</span>], Rank <span style=\"color: rgba(128, 0, 128, 1);\">1</span> äº§ç”Ÿ [<span style=\"color: rgba(128, 0, 128, 1);\">30</span>, <span style=\"color: rgba(128, 0, 128, 1);\">40</span><span style=\"color: rgba(0, 0, 0, 1);\">]\n    local_data </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> torch.tensor(\n        [</span><span style=\"color: rgba(128, 0, 128, 1);\">10.0</span> + rank * <span style=\"color: rgba(128, 0, 128, 1);\">20</span>, <span style=\"color: rgba(128, 0, 128, 1);\">20.0</span> + rank * <span style=\"color: rgba(128, 0, 128, 1);\">20</span>], device=f<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">cuda:{rank}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">\n    )\n    print(f</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[Rank {rank}] All-Gather local data: {local_data}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n    gathered_list </span>= [torch.zeros_like(local_data) <span style=\"color: rgba(0, 0, 255, 1);\">for</span> _ <span style=\"color: rgba(0, 0, 255, 1);\">in</span><span style=\"color: rgba(0, 0, 0, 1);\"> range(world_size)]\n    dist.all_gather(gathered_list, local_data)\n\n    print(f</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[Rank {rank}] All-Gather result: {gathered_list}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\n    gathered_tensor </span>= torch.<span style=\"color: rgba(0, 0, 255, 1);\">cat</span>(gathered_list, dim=<span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    print(f</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">[Rank {rank}] All-Gather concatenated: {gathered_tensor}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n\ndef tp_demo(rank, world_size):\n    setup(rank, world_size)\n\n    test_all_reduce(rank, world_size)\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">time</span>.<span style=\"color: rgba(0, 0, 255, 1);\">sleep</span>(<span style=\"color: rgba(128, 0, 128, 1);\">5</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n    test_all_gather(rank, world_size)\n\n    cleanup()\n\ndef run_demo():\n    world_size </span>= <span style=\"color: rgba(128, 0, 128, 1);\">2</span><span style=\"color: rgba(0, 0, 0, 1);\">\n    mp.spawn(tp_demo, args</span>=(world_size,), nprocs=world_size, <span style=\"color: rgba(0, 0, 255, 1);\">join</span>=<span style=\"color: rgba(0, 0, 0, 1);\">True)\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> __name__ == <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">__main__</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> torch.cuda.device_count() &gt;= <span style=\"color: rgba(128, 0, 128, 1);\">2</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n        run_demo()\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n        print(f</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">éœ€è¦è‡³å°‘ 2 å¼  GPU æ¥è¿è¡Œæ­¤ TP ç¤ºä¾‹</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>)</pre>\n</div>\n<h1><span>10. å…¶ä»–</span></h1>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æœ¬æ–‡åŸºäº nano-vllm é¡¹ç›®ï¼Œèšç„¦è®²è§£å¤§æ¨¡å‹æ¨ç†åŠ é€Ÿé¢†åŸŸä¸­æœ€åŸºç¡€çš„è‹¥å¹²æ ¸å¿ƒæŠ€æœ¯ç‚¹ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå¤§æ¨¡å‹æ¨ç†åŠ é€Ÿçš„æŠ€æœ¯ä½“ç³»ååˆ†ä¸°å¯Œï¼Œæœ¬é¡¹ç›®å¹¶æœªè¦†ç›–å…¨éƒ¨å†…å®¹ï¼Œä¾‹å¦‚ï¼šè®¡ç®—é€šä¿¡é‡å ï¼ˆOverlapï¼‰ã€å¤š token é¢„æµ‹ï¼ˆMTPï¼ŒMultiâ€‘Token Predictionï¼‰ã€å¤šæµã€å¤šè¿›ç¨‹æœåŠ¡ï¼ˆMPSï¼ŒMulti-Process Serviceï¼‰ã€æ•°æ®å¹¶è¡Œï¼ˆDPï¼‰ã€æµæ°´çº¿å¹¶è¡Œï¼ˆPPï¼‰ã€ä¸Šä¸‹æ–‡å¹¶è¡Œï¼ˆCPï¼‰ã€ä¸“å®¶å¹¶è¡Œï¼ˆEPï¼‰ä»¥åŠ PD åˆ†ç¦»ç­‰è¿›é˜¶æŠ€æœ¯æ–¹å‘ï¼Œå¯ä½œä¸ºåç»­æ·±å…¥å­¦ä¹ çš„æ‹“å±•å†…å®¹ã€‚</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>&nbsp;</span></div>\n</div>\n<div class=\"Editable-unstyled\">\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æ³¨1ï¼šåœ¨æœ¬æ–‡çš„æ€»ç»“è¿‡ç¨‹ä¸­ï¼Œé™¤äº†æŸ¥çœ‹æºä»£ç ï¼Œä¹Ÿå€ŸåŠ© deepwiki ä»¥åŠå…¶ä»– AI å·¥å…·è¾…åŠ©ã€‚&nbsp;<br /><br /></span></div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>æœ¬æ–‡:&nbsp;<a href=\"https://www.cnblogs.com/cswuyg/p/19471225\" target=\"_blank\">https://www.cnblogs.com/cswuyg/p/19471225</a></span></div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>çŸ¥ä¹:&nbsp;<a href=\"https://zhuanlan.zhihu.com/p/1989806890381746916\" rel=\"noopener nofollow\" target=\"_blank\">https://zhuanlan.zhihu.com/p/1989806890381746916</a></span></div>\n<div class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span>å…¬ä¼—å·:&nbsp;<a href=\"https://mp.weixin.qq.com/s/6mAZ49iP1SCKt5ZdWf6ErQ\" rel=\"noopener nofollow\" target=\"_blank\">https://mp.weixin.qq.com/s/6mAZ49iP1SCKt5ZdWf6ErQ</a></span></div>\n\n\n\n</div>\n</div>\n<div class=\"clear\"></div>\n\n\t<div class=\"postDesc\">posted on \n<span id=\"post-date\">2026-01-12 12:38</span>&nbsp;\n<a href=\"https://www.cnblogs.com/cswuyg\">-é“¶å…‰-</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">181</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "ã€å¤§æ•°æ® & AIã€‘Flink Agents æºç è§£è¯» --- (6) ---  ActionTask",
      "link": "https://www.cnblogs.com/rossiXYZ/p/19468837",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/rossiXYZ/p/19468837\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-12 20:53\">\n    <span>ã€å¤§æ•°æ® &amp; AIã€‘Flink Agents æºç è§£è¯» --- (6) ---  ActionTask</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"å¤§æ•°æ®--aiflink-agents-æºç è§£è¯»-----6------actiontask\">ã€å¤§æ•°æ® &amp; AIã€‘Flink Agents æºç è§£è¯» --- (6) ---  ActionTask</h1>\n<p></p><div class=\"toc\"><div class=\"toc-container-header\">ç›®å½•</div><ul><li><a href=\"#å¤§æ•°æ®--aiflink-agents-æºç è§£è¯»-----6------actiontask\" rel=\"noopener nofollow\">ã€å¤§æ•°æ® &amp; AIã€‘Flink Agents æºç è§£è¯» --- (6) ---  ActionTask</a><ul><li><a href=\"#0x00-æ¦‚è¦\" rel=\"noopener nofollow\">0x00 æ¦‚è¦</a></li><li><a href=\"#0x01-åŸºç¡€çŸ¥è¯†\" rel=\"noopener nofollow\">0x01 åŸºç¡€çŸ¥è¯†</a><ul><li><a href=\"#11-ç›¸å…³ç»„ä»¶\" rel=\"noopener nofollow\">1.1 ç›¸å…³ç»„ä»¶</a></li><li><a href=\"#12-actiontask\" rel=\"noopener nofollow\">1.2 ActionTask</a></li><li><a href=\"#13-pythonactiontask\" rel=\"noopener nofollow\">1.3 PythonActionTask</a><ul><li><a href=\"#131-å®šä¹‰\" rel=\"noopener nofollow\">1.3.1 å®šä¹‰</a></li><li><a href=\"#132-pythonactiontask-ä¸-function-çš„å…³ç³»\" rel=\"noopener nofollow\">1.3.2 PythonActionTask ä¸ Function çš„å…³ç³»</a></li><li><a href=\"#133-ä¸å…¶ä»–ç»„ä»¶çš„å…³ç³»\" rel=\"noopener nofollow\">1.3.3 ä¸å…¶ä»–ç»„ä»¶çš„å…³ç³»</a></li><li><a href=\"#134-è°ƒç”¨æµç¨‹\" rel=\"noopener nofollow\">1.3.4 è°ƒç”¨æµç¨‹</a></li></ul></li><li><a href=\"#14-pythongeneratoractiontask\" rel=\"noopener nofollow\">1.4 PythonGeneratorActionTask</a></li><li><a href=\"#15-javaactiontask\" rel=\"noopener nofollow\">1.5 JavaActionTask</a></li><li><a href=\"#16-actiontaskresult-ç»“æ„\" rel=\"noopener nofollow\">1.6 ActionTaskResult ç»“æ„</a></li></ul></li><li><a href=\"#0x02-actiontask-åˆ‡åˆ†æœºåˆ¶\" rel=\"noopener nofollow\">0x02 ActionTask åˆ‡åˆ†æœºåˆ¶</a><ul><li><a href=\"#21-åˆ‡åˆ†æ–¹å¼\" rel=\"noopener nofollow\">2.1 åˆ‡åˆ†æ–¹å¼</a></li><li><a href=\"#22-å®ç°ç»†èŠ‚\" rel=\"noopener nofollow\">2.2 å®ç°ç»†èŠ‚</a></li><li><a href=\"#23-å…³é”®ç‚¹\" rel=\"noopener nofollow\">2.3 å…³é”®ç‚¹</a></li></ul></li></ul></li></ul></div><p></p>\n<h2 id=\"0x00-æ¦‚è¦\">0x00 æ¦‚è¦</h2>\n<p>ActionTask æ˜¯ Action æ‰§è¡Œçš„åŸºæœ¬å•ä½ï¼Œä»£è¡¨ä¸€ä¸ªå¯æ‰§è¡Œçš„ä»»åŠ¡å—ã€‚ä¸€ä¸ªå®Œæ•´çš„ Action å¯èƒ½ä¼šè¢«åˆ‡åˆ†æˆå¤šä¸ª ActionTask æ¥æ‰§è¡Œã€‚ActionTask åœ¨æ•´ä½“æµç¨‹çš„ä½ç½®å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\">Action Code â†’ Agent â†’ AgentPlan â†’ ActionExecutionOperator â†’ ActionTask â†’ Flink Runtime\n</code></pre>\n<h2 id=\"0x01-åŸºç¡€çŸ¥è¯†\">0x01 åŸºç¡€çŸ¥è¯†</h2>\n<p>ActionTask æ˜¯ Action æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªç‰‡æ®µï¼Œç”¨äºæ”¯æŒå¤æ‚çš„æ‰§è¡Œé€»è¾‘ï¼ˆå¦‚å¼‚æ­¥å¤„ç†ï¼‰ï¼Œå¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>ä¸€ä¸ª Action å¯¹åº”ä¸€ä¸ªå‡½æ•°</li>\n</ul>\n<p>åœ¨ AgentPlan ä¸­ï¼Œæ¯ä¸ª Action åŒ…å«ä¸€ä¸ªæ‰§è¡Œå‡½æ•° (exec)ï¼Œé€šå¸¸æ˜¯ PythonFunction æˆ– JavaFunctionï¼Œä¾‹å¦‚åœ¨ tool_call_action.py ä¸­ï¼š</p>\n<pre><code class=\"language-java\">TOOL_CALL_ACTION = Action (\n    name=\"tool_call_action\",\n    exec=PythonFunction.from_callable (process_tool_request), // ä¸€ä¸ªå‡½æ•°\n    listen_event_types=[...]\n)\n</code></pre>\n<ul>\n<li>ä¸€ä¸ª Action å¯èƒ½äº§ç”Ÿå¤šä¸ª ActionTask\n<ul>\n<li>ActionTask æ˜¯ Action çš„æ‰§è¡Œæ—¶è¡¨ç¤ºï¼Œå¯ä»¥çœ‹ä½œæ˜¯ Action çš„ â€œæ‰§è¡Œç‰‡æ®µâ€</li>\n<li>ä¸€ä¸ª Action å¯èƒ½åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«æ‹†åˆ†ä¸ºå¤šä¸ª ActionTaskï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¼‚æ­¥æ“ä½œæ—¶</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"11-ç›¸å…³ç»„ä»¶\">1.1 ç›¸å…³ç»„ä»¶</h3>\n<p>ActionTask æ¦‚å¿µçš„ç›¸å…³ç»„ä»¶å¦‚ä¸‹</p>\n<table>\n<thead>\n<tr>\n<th>ç»„ä»¶</th>\n<th>æ ¸å¿ƒåŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JavaActionTask</td>\n<td>æ‰§è¡Œ Java å‡½æ•°</td>\n</tr>\n<tr>\n<td>PythonActionTask</td>\n<td>æ‰§è¡Œ Python å‡½æ•°ï¼Œæ”¯æŒå¼‚æ­¥ / ç”Ÿæˆå™¨æ¨¡å¼ï¼Œæ¡¥æ¥ Java ä¸ Python ç”Ÿæ€</td>\n</tr>\n<tr>\n<td>LocalRunnerContext</td>\n<td>æœ¬åœ°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ¨¡æ‹Ÿ Flink åˆ†å¸ƒå¼çŠ¶æ€ï¼Œç®¡ç†äº‹ä»¶é˜Ÿåˆ—ã€key éš”ç¦»çŠ¶æ€ã€èµ„æºè®¿é—®</td>\n</tr>\n<tr>\n<td>ActionTaskResult</td>\n<td>åŠ¨ä½œæ‰§è¡Œç»“æœè½½ä½“ï¼ŒåŒ…å«æ˜¯å¦å®Œæˆã€è¾“å‡ºäº‹ä»¶ã€ä¸‹ä¸€ä¸ªå¾…æ‰§è¡Œä»»åŠ¡ï¼ˆè‹¥æœ‰ï¼‰</td>\n</tr>\n<tr>\n<td>PythonGeneratorActionTask</td>\n<td>å¤„ç† Python ç”Ÿæˆå™¨çš„å¼‚æ­¥ä»»åŠ¡ï¼ŒæŒç»­æ‰§è¡Œç›´åˆ°å®Œæˆæ‰€æœ‰å¼‚æ­¥æ“ä½œ</td>\n</tr>\n<tr>\n<td>Tool ç›¸å…³æœºåˆ¶</td>\n<td>æ”¯æŒè£…é¥°å™¨ï¼ˆ@toolï¼‰ã€add_resource ç­‰æ–¹å¼æ³¨å†Œå·¥å…·ï¼Œé€šè¿‡ TOOL_CALL_ACTION è§¦å‘æ‰§è¡Œ</td>\n</tr>\n</tbody>\n</table>\n<p>åœ¨ç³»ç»Ÿä¸­çš„æ¶æ„å¦‚ä¸‹</p>\n<p><img alt=\"flink-6-1\" class=\"lazyload\" /></p>\n<h3 id=\"12-actiontask\">1.2 ActionTask</h3>\n<p>æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹ ActionTask çš„å…·ä½“å®ç°ã€‚</p>\n<p>ActionTask æ˜¯åŸºç±»ã€‚</p>\n<pre><code class=\"language-java\">/**\n * This class represents a task related to the execution of an action in {@link\n * ActionExecutionOperator}.\n *\n * &lt;p&gt;An action is split into multiple code blocks, and each code block is represented by an {@code\n * ActionTask}. You can call {@link #invoke()} to execute a code block and obtain invoke result\n * {@link ActionTaskResult}. If the action contains additional code blocks, you can obtain the next\n * {@code ActionTask} via {@link ActionTaskResult#getGeneratedActionTask()} and continue executing\n * it.\n */\npublic abstract class ActionTask {\n    protected final Object key;\n    protected final Event event;\n    protected final Action action;\n    /**\n     * Since RunnerContextImpl contains references to the Operator and state, it should not be\n     * serialized and included in the state with ActionTask. Instead, we should check if a valid\n     * RunnerContext exists before each ActionTask invocation and create a new one if necessary.\n     */\n    protected transient RunnerContextImpl runnerContext;\n\n    public ActionTask(Object key, Event event, Action action) {\n        this.key = key;\n        this.event = event;\n        this.action = action;\n    }\n\n    public RunnerContextImpl getRunnerContext() {\n        return runnerContext;\n    }\n\n    public void setRunnerContext(RunnerContextImpl runnerContext) {\n        this.runnerContext = runnerContext;\n    }\n\n    public Object getKey() {\n        return key;\n    }\n\n    /** Invokes the action task. */\n    public abstract ActionTaskResult invoke() throws Exception;\n\n    public class ActionTaskResult {\n        private final boolean finished;\n        private final List&lt;Event&gt; outputEvents;\n        private final Optional&lt;ActionTask&gt; generatedActionTaskOpt;\n\n        public ActionTaskResult(\n                boolean finished,\n                List&lt;Event&gt; outputEvents,\n                @Nullable ActionTask generatedActionTask) {\n            this.finished = finished;\n            this.outputEvents = outputEvents;\n            this.generatedActionTaskOpt = Optional.ofNullable(generatedActionTask);\n        }\n\n        public boolean isFinished() {\n            return finished;\n        }\n\n        public List&lt;Event&gt; getOutputEvents() {\n            return outputEvents;\n        }\n\n        public Optional&lt;ActionTask&gt; getGeneratedActionTask() {\n            return generatedActionTaskOpt;\n        }\n    }\n}\n</code></pre>\n<h3 id=\"13-pythonactiontask\">1.3 PythonActionTask</h3>\n<p>PythonActionTask æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæ‰§è¡Œ Python åŠ¨ä½œä»»åŠ¡çš„ç‰¹æ®Š ActionTask å®ç°ã€‚å®ƒçš„ä¸»è¦ä½œç”¨åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>æ‰§è¡Œ Python å‡½æ•°ï¼šè°ƒç”¨ Python å‡½æ•°æ¥å¤„ç†äº‹ä»¶</li>\n<li>å¤„ç†å¼‚æ­¥æ“ä½œï¼šæ”¯æŒ Python ä¸­çš„å¼‚æ­¥æ“ä½œï¼Œé€šè¿‡ç”Ÿæˆå™¨æœºåˆ¶å®ç°</li>\n<li>æ¡¥æ¥ Java å’Œ Pythonï¼šä½œä¸º Java ç«¯å’Œ Python ç«¯ä¹‹é—´çš„æ¡¥æ¢ï¼Œåè°ƒä¸¤è€…é—´çš„äº¤äº’</li>\n</ul>\n<h4 id=\"131-å®šä¹‰\">1.3.1 å®šä¹‰</h4>\n<p>PythonActionTask å¯¹åº”ä¸€ä¸ª Python å‡½æ•°ï¼ˆæ›´å‡†ç¡®åœ°è¯´æ˜¯ä¸€ä¸ª PythonFunction å¯¹è±¡ï¼‰ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯åœ¨åˆ›å»º Action æ—¶å®šä¹‰çš„ï¼Œå­˜å‚¨åœ¨ action.getExec() ä¸­ã€‚ä½†PythonActionTask ä¸ä»…ä»…æ˜¯ç®€å•çš„å‡½æ•°å°è£…ï¼Œè€Œæ˜¯ä½¿å…¶èƒ½å¤Ÿåœ¨ Flink Agents æ¡†æ¶ä¸­æ­£ç¡®æ‰§è¡Œï¼Œå¹¶æ”¯æŒæ¡†æ¶æ‰€éœ€çš„é«˜çº§ç‰¹æ€§ã€‚å®ƒæä¾›äº†ä»¥ä¸‹é™„åŠ ä»·å€¼ï¼š</p>\n<ul>\n<li>å¤æ‚é€»è¾‘ï¼šPythonActionTask ä¸ä»…ä»…æ˜¯æ‰§è¡Œå‡½æ•°ï¼Œè¿˜è´Ÿè´£å¤„ç†å¤æ‚çš„äº¤äº’é€»è¾‘</li>\n<li>æ‰§è¡Œç¯å¢ƒç®¡ç†ï¼šä¸ºå‡½æ•°æä¾›åˆé€‚çš„æ‰§è¡Œä¸Šä¸‹æ–‡</li>\n<li>å¼‚æ­¥æ”¯æŒï¼šé€šè¿‡ç”Ÿæˆå™¨æœºåˆ¶æ”¯æŒé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œ</li>\n<li>äº‹ä»¶å¤„ç†ï¼šç®¡ç†å’Œä¼ é€’æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„äº‹ä»¶</li>\n<li>çŠ¶æ€ç»´æŠ¤ï¼šåœ¨æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­ç»´æŠ¤å¿…è¦çš„çŠ¶æ€ä¿¡æ¯</li>\n</ul>\n<p>PythonActionTask åœ¨ç³»ç»Ÿæ¶æ„ä¸­çš„ä½ç½®å’Œäº¤äº’å…³ç³»å¦‚ä¸‹ï¼š</p>\n<p><img alt=\"Flink-6-2\" class=\"lazyload\" /></p>\n<p>ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-java\">public class PythonActionTask extends ActionTask {\n    public ActionTaskResult invoke() throws Exception {\n        PythonActionExecutor pythonActionExecutor = getPythonActionExecutor();\n\n        // è¿™é‡Œæ‰§è¡Œå®é™…çš„ Python å‡½æ•°\n        String pythonGeneratorRef =\n            pythonActionExecutor.executePythonFunction(\n                (PythonFunction) action.getExec(), // &lt;-- è¿™å°±æ˜¯å¯¹åº”çš„å‡½æ•°\n                (PythonEvent) event,\n                runnerContext);\n\n        // å¤„ç†å¼‚æ­¥æƒ…å†µ\n        if (pythonGeneratorRef != null) {\n            // å¦‚æœå‡½æ•°è¿”å›äº†ç”Ÿæˆå™¨ï¼Œåˆ™åˆ›å»ºæ–°çš„ä»»åŠ¡ç»§ç»­æ‰§è¡Œ\n            ActionTask tempGeneratedActionTask =\n                new PythonGeneratorActionTask(key, event, action, pythonGeneratorRef);\n            tempGeneratedActionTask.setRunnerContext(runnerContext);\n        if (pythonGeneratorRef != null) {\n            // å¦‚æœå‡½æ•°è¿”å›äº†ç”Ÿæˆå™¨ï¼Œåˆ™åˆ›å»ºæ–°çš„ä»»åŠ¡ç»§ç»­æ‰§è¡Œ\n            ActionTask tempGeneratedActionTask = \n                new PythonGeneratorActionTask(key, event, action, pythonGeneratorRef);\n            tempGeneratedActionTask.setRunnerContext(runnerContext);\n            return tempGeneratedActionTask.invoke();\n        }\n        // å¦åˆ™è¡¨ç¤ºå‡½æ•°å·²æ‰§è¡Œå®Œæ¯•\n        return new ActionTaskResult(\n            true, \n            runnerContext.drainEvents(event.getSourceTimestamp()), \n            null);            \n</code></pre>\n<h4 id=\"132-pythonactiontask-ä¸-function-çš„å…³ç³»\">1.3.2 PythonActionTask ä¸ Function çš„å…³ç³»</h4>\n<p>PythonActionTask ä¸ Function çš„å…³ç³»çš„å¦‚ä¸‹</p>\n<p><img alt=\"Flink-6-3\" class=\"lazyload\" /></p>\n<h4 id=\"133-ä¸å…¶ä»–ç»„ä»¶çš„å…³ç³»\">1.3.3 ä¸å…¶ä»–ç»„ä»¶çš„å…³ç³»</h4>\n<p>PythonActionTask ä¸å…¶ä»–ç»„ä»¶çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>\n<p><img alt=\"Flink-6-4\" class=\"lazyload\" /></p>\n<h4 id=\"134-è°ƒç”¨æµç¨‹\">1.3.4 è°ƒç”¨æµç¨‹</h4>\n<p>PythonActionTask.invoke() æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶å…³é”®ç‰¹ç‚¹ä¸ºï¼š</p>\n<ul>\n<li>å¼‚æ­¥æ”¯æŒï¼šé€šè¿‡ Python ç”Ÿæˆå™¨æœºåˆ¶æ”¯æŒé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œ</li>\n<li>çŠ¶æ€ç®¡ç†ï¼šä¸ ActionExecutionOperator åä½œç®¡ç†æ‰§è¡ŒçŠ¶æ€</li>\n<li>é”™è¯¯å¤„ç†ï¼šé€‚å½“åœ°å¤„ç† Python æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸</li>\n<li>å†…å­˜ç®¡ç†ï¼šä¸ RunnerContext é›†æˆï¼Œç®¡ç†çŸ­æœŸè®°å¿†å’Œå…¶ä»–çŠ¶æ€</li>\n</ul>\n<p><img alt=\"Flink-6-5\" class=\"lazyload\" /></p>\n<p>PythonActionTask åœ¨æ•´ä¸ªç³»ç»Ÿä¸­èµ·åˆ°äº†è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œå®ƒä½¿å¾— Flink Agents èƒ½å¤Ÿæ— ç¼é›†æˆ Python ç”Ÿæ€ç³»ç»Ÿä¸­çš„å„ç§ AI å·¥å…·å’Œåº“ï¼ŒåŒæ—¶ä¿æŒä¸ Flink æµå¤„ç†å¼•æ“çš„è‰¯å¥½é›†æˆã€‚</p>\n<h3 id=\"14-pythongeneratoractiontask\">1.4 PythonGeneratorActionTask</h3>\n<p>PythonGeneratorActionTask æ˜¯ PythonActionTask çš„æ´¾ç”Ÿç±»ã€‚</p>\n<ul>\n<li>å½“ Python å‡½æ•°ä¸­ä½¿ç”¨äº† yield æˆ–å¼‚æ­¥æ“ä½œæ—¶ï¼ŒPython æ‰§è¡Œå™¨ä¼šæ£€æµ‹åˆ°è¿™ç§æƒ…å†µå¹¶è¿”å›ä¸€ä¸ª Generator å¼•ç”¨</li>\n<li>ç³»ç»Ÿä¼šåˆ›å»º PythonGeneratorActionTask æ¥ç»§ç»­æ‰§è¡Œ</li>\n</ul>\n<pre><code class=\"language-java\">/** An {@link ActionTask} wrapper a Python Generator to represent a code block in Python action. */\npublic class PythonGeneratorActionTask extends PythonActionTask {\n    private final String pythonGeneratorRef;\n\n    public PythonGeneratorActionTask(\n            Object key, Event event, Action action, String pythonGeneratorRef) {\n        super(key, event, action);\n        this.pythonGeneratorRef = pythonGeneratorRef;\n    }\n\n    @Override\n    public ActionTaskResult invoke() {\n        boolean finished = getPythonActionExecutor().callPythonGenerator(pythonGeneratorRef);\n        ActionTask generatedActionTask = finished ? null : this;\n        return new ActionTaskResult(\n                finished,\n                runnerContext.drainEvents(event.getSourceTimestamp()),\n                generatedActionTask);\n    }\n}\n</code></pre>\n<h3 id=\"15-javaactiontask\">1.5 JavaActionTask</h3>\n<p>JavaActionTask æ‰§è¡Œ Java ActionTaskã€‚</p>\n<pre><code class=\"language-java\">/**\n * A special {@link ActionTask} designed to execute a Java action task.\n *\n * &lt;p&gt;Note that Java action currently do not support asynchronous execution. As a result, a Java\n * action task will be invoked only once.\n */\npublic class JavaActionTask extends ActionTask {\n\n    private final ClassLoader userCodeClassLoader;\n\n    public JavaActionTask(Object key, Event event, Action action, ClassLoader userCodeClassLoader) {\n        super(key, event, action);\n        checkState(action.getExec() instanceof JavaFunction);\n        this.userCodeClassLoader = userCodeClassLoader;\n    }\n\n    @Override\n    public ActionTaskResult invoke() throws Exception {\n        runnerContext.checkNoPendingEvents();\n        ClassLoader cl = Thread.currentThread().getContextClassLoader();\n        try {\n            Thread.currentThread().setContextClassLoader(userCodeClassLoader);\n            action.getExec().call(event, runnerContext);\n        } finally {\n            Thread.currentThread().setContextClassLoader(cl);\n        }\n        return new ActionTaskResult(\n                true, runnerContext.drainEvents(event.getSourceTimestamp()), null);\n    }\n}\n</code></pre>\n<h3 id=\"16-actiontaskresult-ç»“æ„\">1.6 ActionTaskResult ç»“æ„</h3>\n<p>æ¯æ¬¡æ‰§è¡Œ ActionTask åä¼šè¿”å›ä¸€ä¸ª ActionTaskResult å¯¹è±¡ï¼š</p>\n<pre><code class=\"language-java\">public class ActionTaskResult {\n    private final boolean finished;                 // æ˜¯å¦å·²å®Œæˆ\n    private final List&lt;Event&gt; outputEvents;         // è¾“å‡ºäº‹ä»¶\n    private final Optional&lt;ActionTask&gt; generatedActionTaskOpt; // ä¸‹ä¸€ä¸ª ActionTaskï¼ˆå¦‚æœæœ‰ï¼‰\n// ...\n}\n</code></pre>\n<h2 id=\"0x02-actiontask-åˆ‡åˆ†æœºåˆ¶\">0x02 ActionTask åˆ‡åˆ†æœºåˆ¶</h2>\n<p>åœ¨ Flink Agents æ¡†æ¶ä¸­ï¼ŒActionTask çš„åˆ‡åˆ†æ˜¯ä¸ºäº†æ”¯æŒé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œå’Œå¼‚æ­¥æ‰§è¡Œã€‚åˆ‡åˆ†çš„å¥½å¤„å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>é¿å…é˜»å¡ï¼šé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œä¸ä¼šé˜»å¡æ•´ä¸ªæ“ä½œç¬¦</li>\n<li>æé«˜å¹¶å‘æ€§ï¼šå…è®¸å…¶ä»– key çš„ä»»åŠ¡åŒæ—¶æ‰§è¡Œ</li>\n<li>å®¹é”™èƒ½åŠ›ï¼šæ¯ä¸ª ActionTask å¯ä»¥å•ç‹¬å¤±è´¥å’Œæ¢å¤</li>\n<li>èµ„æºç®¡ç†ï¼šæ›´å¥½åœ°ç®¡ç†å†…å­˜å’Œå…¶ä»–èµ„æº</li>\n</ul>\n<p>è¿™ç§åˆ‡åˆ†æœºåˆ¶ä½¿å¾— Flink Agents èƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†å¤æ‚çš„ï¼Œé•¿æ—¶é—´è¿è¡Œçš„ AI Agent ä»»åŠ¡ï¼ŒåŒæ—¶ä¿æŒç³»ç»Ÿçš„å“åº”çš„ç¨³å®šæ€§ã€‚</p>\n<h3 id=\"21-åˆ‡åˆ†æ–¹å¼\">2.1 åˆ‡åˆ†æ–¹å¼</h3>\n<p>ä¸»è¦åˆ‡åˆ†æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<p>æ¦‚å¿µä¸Šçš„æ‹†åˆ†</p>\n<ul>\n<li>ä¸€ä¸ª Action åœ¨æ¦‚å¿µä¸Šå¯è¢«æ‹†æˆå¤šä¸ªé¡ºåºæ‰§è¡Œçš„ä»£ç å—ï¼Œæ¯ä¸ªä»£ç å—æˆä¸ºä¸€ä¸ª ActionTask å®ä¾‹ã€‚</li>\n<li>è®¾è®¡ç›®çš„åœ¨äºç»†ç²’åº¦æ§åˆ¶ï¼Œå°¤å…¶é€‚ç”¨äºå¼‚æ­¥æ“ä½œã€‚</li>\n</ul>\n<p>åˆ›å»ºä¸æµç¨‹</p>\n<ul>\n<li>åˆå§‹è§¦å‘ï¼šActionExecutionOperator é€šè¿‡ createActionTask() ä¸ºæ¯ä¸ªåŠ¨ä½œç”Ÿæˆé¦–ä¸ª ActionTaskã€‚</li>\n<li>æ‰§è¡Œè¿‡ç¨‹ï¼šè‹¥åŠ¨ä½œäº§ç”Ÿç”Ÿæˆå™¨ï¼ˆå¼‚æ­¥ï¼‰ï¼Œå¯å†å®ä¾‹åŒ–æ–°çš„ ActionTask ç»§ç»­åç»­ä»£ç å—ã€‚</li>\n</ul>\n<pre><code class=\"language-java\">    /**\n     * Processes an incoming event for the given key and may submit a new mail\n     * `tryProcessActionTaskForKey` to continue processing.\n     */\n    private void processEvent(Object key, Event event) throws Exception {\n        notifyEventProcessed(event);\n\n        boolean isInputEvent = EventUtil.isInputEvent(event);\n        if (EventUtil.isOutputEvent(event)) {\n        } else {\n            // We then obtain the triggered action and add ActionTasks to the waiting processing\n            // queue.\n            List&lt;Action&gt; triggerActions = getActionsTriggeredBy(event);\n            if (triggerActions != null &amp;&amp; !triggerActions.isEmpty()) {\n                for (Action triggerAction : triggerActions) {\n                    actionTasksKState.add(createActionTask(key, triggerAction, event));\n                }\n            }\n        }\n    }\n</code></pre>\n<p>createActionTask ä»£ç å¦‚ä¸‹ã€‚</p>\n<pre><code class=\"language-java\">    private ActionTask createActionTask(Object key, Action action, Event event) {\n        if (action.getExec() instanceof JavaFunction) {\n            return new JavaActionTask(\n                    key, event, action, getRuntimeContext().getUserCodeClassLoader());\n        } else if (action.getExec() instanceof PythonFunction) {\n            return new PythonActionTask(key, event, action);\n        } else {\n            throw new IllegalStateException(\n                    \"Unsupported action type: \" + action.getExec().getClass());\n        }\n    }\n\n</code></pre>\n<h3 id=\"22-å®ç°ç»†èŠ‚\">2.2 å®ç°ç»†èŠ‚</h3>\n<p>ActionTask.java ä¸­æœ‰å¦‚ä¸‹ï¼Œè¿™æ„å‘³ç€:</p>\n<ul>\n<li>ä¸€ä¸ª Action å¯èƒ½è¢«æ‹†åˆ†æˆå¤šä¸ªä»£ç å—</li>\n<li>æ¯ä¸ªä»£ç å—ç”±ä¸€ä¸ª ActionTask è¡¨ç¤º</li>\n<li>é€šè¿‡è°ƒç”¨ invoke () æ‰§è¡Œä»£ç å—å¹¶è·å¾—ç»“æœ</li>\n<li>å¦‚æœ Action åŒ…å«æ›´å¤šä»£ç å—ï¼Œå¯ä»¥ä» ActionTaskResult ä¸­è·å–ä¸‹ä¸€ä¸ª ActionTask</li>\n</ul>\n<pre><code class=\"language-java\">/**\n * æ­¤ç±»è¡¨ç¤ºåœ¨ ActionExecutionOperator ä¸­æ‰§è¡Œçš„åŠ¨ä½œä»»åŠ¡ã€‚\n *\n * &lt;p&gt;ä¸€ä¸ªåŠ¨ä½œä¼šè¢«æ‹†åˆ†ä¸ºå¤šä¸ªä»£ç å—ï¼Œæ¯ä¸ªä»£ç å—éƒ½ç”±ä¸€ä¸ª ActionTask è¡¨ç¤ºã€‚\n * å¯ä»¥è°ƒç”¨ #invoke() æ¥æ‰§è¡Œä¸€ä¸ªä»£ç å—å¹¶è·å¾—æ‰§è¡Œç»“æœï¼ˆActionTaskResultï¼‰ã€‚\n * å¦‚æœåŠ¨ä½œåŒ…å«é¢å¤–çš„ä»£ç å—ï¼Œå¯é€šè¿‡ ActionTaskResult#getGeneratedActionTask()\n * è·å–ä¸‹ä¸€ä¸ª ActionTask å¹¶ç»§ç»­æ‰§è¡Œå®ƒã€‚\n */\n\n</code></pre>\n<p>Python é›†æˆï¼ˆPythonActionTask.javaï¼‰</p>\n<ul>\n<li>å½“ Python å‡½æ•°ä¸­ä½¿ç”¨äº† yield æˆ–å¼‚æ­¥æ“ä½œæ—¶ï¼ŒPython æ‰§è¡Œå™¨ä¼šæ£€æµ‹åˆ°è¿™ç§æƒ…å†µå¹¶è¿”å›ä¸€ä¸ª Generator å¼•ç”¨</li>\n<li>ç³»ç»Ÿä¼šåˆ›å»º PythonGeneratorActionTask æ¥ç»§ç»­æ‰§è¡Œ</li>\n</ul>\n<p>è¿™è¯´æ˜åœ¨å¤„ç†å¼‚æ­¥ Python å‡½æ•°æ—¶ï¼Œä¸€ä¸ª Action å¯èƒ½ä¼šäº§ç”Ÿå¤šä¸ª ActionTaskï¼š</p>\n<ul>\n<li>åˆå§‹çš„ PythonActionTask</li>\n<li>åç»­çš„ PythonGeneratorActionTaskï¼ˆå¦‚æœéœ€è¦ï¼‰</li>\n</ul>\n<pre><code class=\"language-java\">/**\n * ä¸“é—¨ç”¨äºæ‰§è¡Œ Python åŠ¨ä½œä»»åŠ¡çš„ç‰¹æ®Š ActionTaskã€‚\n *\n * &lt;p&gt;åœ¨ Python ä¸­è¿›è¡Œå¼‚æ­¥æ‰§è¡ŒæœŸé—´ï¼ŒPythonActionTask å¯ä»¥ç”Ÿæˆä¸€ä¸ª\n * PythonGeneratorActionTask æ¥ä»£è¡¨åç»­éœ€è¦çš„ä»£ç å—ã€‚\n */\npublic class PythonActionTask extends ActionTask {\n    public ActionTaskResult invoke() throws Exception {\n        ...\n        String pythonGeneratorRef = \n            pythonActionExecutor.executePythonFunction(\n                (PythonFunction)action.getExec(),\n                (PythonEvent)event,\n                runnerContext);\n\n        // å¦‚æœç”¨æˆ·å®šä¹‰çš„åŠ¨ä½œä½¿ç”¨æ¥å£æäº¤äº†å¼‚æ­¥ä»»åŠ¡ï¼Œ\n        // å®ƒå°†åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œåè¿”å›ä¸€ä¸ª Python ç”Ÿæˆå™¨å¯¹è±¡å®ä¾‹ã€‚\n        // å¦åˆ™æ„å‘³ç€æ²¡æœ‰æäº¤å¼‚æ­¥ä»»åŠ¡ä¸”åŠ¨ä½œå·²ç»å®Œæˆã€‚\n        if (pythonGeneratorRef != null) {\n            // Python åŠ¨ä½œç”Ÿæˆäº†ä¸€ä¸ªç”Ÿæˆå™¨ã€‚æˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸€æ¬¡å®ƒï¼Œ\n            // è¿™å°†æäº¤ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å¹¶è¿”å›åŠ¨ä½œæ˜¯å¦å·²å®Œæˆã€‚\n            ActionTask tempGeneratedActionTask = \n                new PythonGeneratorActionTask(key, event, action, pythonGeneratorRef);\n            tempGeneratedActionTask.setRunnerContext(runnerContext);\n            return tempGeneratedActionTask.invoke();\n        }\n        return new ActionTaskResult(\n            true, runnerContext.drainEvents(event.getSourceTimestamp()), null);\n    }\n}\n\n</code></pre>\n<h3 id=\"23-å…³é”®ç‚¹\">2.3 å…³é”®ç‚¹</h3>\n<p>ActionTask æ‹†åˆ†çš„å…³é”®ç‚¹å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>é¡ºåºæ‰§è¡Œï¼šå¯¹äºç»™å®šçš„é”®ï¼Œä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œä»¥ä¿æŒé¡ºåºæ€§å’Œä¸€è‡´æ€§</li>\n<li>å¼‚æ­¥å¤„ç†ï¼šå½“åŠ¨ä½œæ¶‰åŠå¼‚æ­¥æ“ä½œæ—¶ï¼š\n<ul>\n<li>åˆå§‹ä»»åŠ¡æ‰§è¡Œåˆ°å¼‚æ­¥æ“ä½œä¸ºæ­¢ï¼›</li>\n<li>è¿”å›ä¸€ä¸ªæ–°çš„ ActionTask æ¥è¡¨ç¤ºåç»­çš„æ“ä½œï¼›</li>\n<li>åç»­ä»»åŠ¡å¤„ç†å¼‚æ­¥ç»“æœå¹¶ç»§ç»­æ‰§è¡Œ</li>\n</ul>\n</li>\n<li>çŠ¶æ€ç®¡ç†ï¼šæ¯ä¸ª ActionTask é€šè¿‡ RunnerContext ç»´æŠ¤å…¶çŠ¶æ€ï¼Œç¡®ä¿æ‹†åˆ†ä¹‹é—´çš„è¿ç»­æ€§</li>\n</ul>\n<ul>\n<li>åŸºäºé‚®ç®±çš„å¤„ç†ï¼šä½¿ç”¨ Flink çš„é‚®ç®±æ‰§è¡Œå™¨æ¥è°ƒåº¦åç»­ä»»åŠ¡çš„å¤„ç†ï¼š</li>\n</ul>\n<pre><code class=\"language-java\">// æäº¤æ–°é‚®ä»¶ä»¥ç»§ç»­å¤„ç†\nmailboxExecutor.submit(() -&gt; tryProcessActionTaskForKey(key), \"process action task\");\n\n</code></pre>\n<p>è¿™ç§è®¾è®¡å…è®¸å°†å¸¦æœ‰å¼‚æ­¥æ“ä½œçš„å¤æ‚åŠ¨ä½œåˆ†è§£ä¸ºå¯ç®¡ç†çš„å•å…ƒï¼ŒåŒæ—¶ä¿æŒæ‰§è¡Œè¯­ä¹‰å’ŒçŠ¶æ€ä¸€è‡´æ€§ã€‚</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-12 20:53</span>&nbsp;\n<a href=\"https://www.cnblogs.com/rossiXYZ\">ç½—è¥¿çš„æ€è€ƒ</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">9</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "Flinkæºç é˜…è¯»ï¼šNettyé€šä¿¡",
      "link": "https://www.cnblogs.com/Jackeyzhe/p/19474170",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/Jackeyzhe/p/19474170\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-12 20:40\">\n    <span>Flinkæºç é˜…è¯»ï¼šNettyé€šä¿¡</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        <img alt=\"Flinkæºç é˜…è¯»ï¼šNettyé€šä¿¡\" class=\"desc_img\" src=\"https://img2024.cnblogs.com/blog/1828322/202601/1828322-20260112203959144-1309168916.png\" />\n        å‰æ–‡ä¸­æˆ‘ä»¬äº†è§£äº† Flink çš„æ•°æ®äº¤äº’è¿‡ç¨‹ï¼Œä¸Šæ¸¸çš„ Task å°†æ•°æ®å†™å…¥åˆ° ResultSubpartition çš„ buffers é˜Ÿåˆ—ä¸­ã€‚ä¸‹æ¸¸çš„ Task é€šè¿‡ LocalInputChannel å’Œ RemoteInputChannel æ¶ˆè´¹ä¸Šæ¸¸çš„æ•°æ®ã€‚\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>å‰æ–‡ä¸­æˆ‘ä»¬äº†è§£äº† Flink çš„æ•°æ®äº¤äº’è¿‡ç¨‹ï¼Œä¸Šæ¸¸çš„ Task å°†æ•°æ®å†™å…¥åˆ° ResultSubpartition çš„ buffers é˜Ÿåˆ—ä¸­ã€‚ä¸‹æ¸¸çš„ Task é€šè¿‡ LocalInputChannel å’Œ RemoteInputChannel æ¶ˆè´¹ä¸Šæ¸¸çš„æ•°æ®ã€‚</p>\n<p>LocalInputChannel æ˜¯ä¸Šä¸‹æ¸¸çš„ Task éƒ¨ç½²åœ¨åŒä¸€ä¸ª TaskManager æ—¶ä½¿ç”¨çš„ï¼Œåœ¨æœ¬åœ°å³å¯å®Œæˆæ•°æ®äº¤æ¢ï¼Œæ— éœ€ç½‘ç»œé€šä¿¡ã€‚å½“ä¸Šä¸‹æ¸¸çš„ Task éƒ¨ç½²åœ¨ä¸åŒçš„ TaskManager æ—¶ï¼Œå°±éœ€è¦ç”¨åˆ° RemoteInputChannelï¼ŒFlink åˆ©ç”¨ Netty æ¥è¿›è¡Œæ•°æ®äº¤äº’ã€‚æœ¬æ–‡æˆ‘ä»¬æ¥ä¸€èµ·æ¢³ç†ä¸€ä¸‹ Netty ç›¸å…³çš„æºç ã€‚</p>\n<h3 id=\"åˆå§‹åŒ–\">åˆå§‹åŒ–</h3>\n<p>æˆ‘ä»¬å…ˆæ¥çœ‹ NettyServer å’Œ NettyClient çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</p>\n<p><img alt=\"NettyInit\" class=\"lazyload\" /></p>\n<p>Netty çš„åˆå§‹åŒ–é˜¶æ®µæ˜¯åœ¨ TaskManager å¯åŠ¨çš„è¿‡ç¨‹ä¸­æ‰§è¡Œçš„ã€‚åœ¨ <code>TaskManagerServices.fromConfiguration</code> æ–¹æ³•ä¸­ï¼Œä¼šåˆ›å»ºå¹¶å¯åŠ¨ ShuffleEnvironmentã€‚</p>\n<pre><code class=\"language-java\">public static TaskManagerServices fromConfiguration(\n        TaskManagerServicesConfiguration taskManagerServicesConfiguration,\n        PermanentBlobService permanentBlobService,\n        MetricGroup taskManagerMetricGroup,\n        ExecutorService ioExecutor,\n        ScheduledExecutor scheduledExecutor,\n        FatalErrorHandler fatalErrorHandler,\n        WorkingDirectory workingDirectory)\n        throws Exception {\n    ...\n\n    final ShuffleEnvironment&lt;?, ?&gt; shuffleEnvironment =\n            createShuffleEnvironment(\n                    taskManagerServicesConfiguration,\n                    taskEventDispatcher,\n                    taskManagerMetricGroup,\n                    ioExecutor,\n                    scheduledExecutor);\n    final int listeningDataPort = shuffleEnvironment.start();\n    ...\n}\n</code></pre>\n<p>æˆ‘ä»¬é¡ºç€è°ƒç”¨é“¾è·¯å¯ä»¥ä¸€ç›´æ‰¾åˆ° <code>NettyShuffleServiceFactory.createNettyShuffleEnvironment</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­åˆ›å»ºäº† NettyConnectionManagerï¼Œåœ¨ NettyConnectionManager ä¸­æœ‰å‡ ä¸ªå¾ˆé‡è¦çš„å¯¹è±¡ã€‚</p>\n<pre><code class=\"language-java\">public NettyConnectionManager(\n        NettyBufferPool bufferPool,\n        ResultPartitionProvider partitionProvider,\n        TaskEventPublisher taskEventPublisher,\n        NettyConfig nettyConfig,\n        boolean connectionReuseEnabled) {\n\n    this.server = new NettyServer(nettyConfig);\n    this.client = new NettyClient(nettyConfig);\n    this.bufferPool = checkNotNull(bufferPool);\n\n    this.partitionRequestClientFactory =\n            new PartitionRequestClientFactory(\n                    client, nettyConfig.getNetworkRetries(), connectionReuseEnabled);\n\n    this.nettyProtocol =\n            new NettyProtocol(\n                    checkNotNull(partitionProvider), checkNotNull(taskEventPublisher));\n}\n</code></pre>\n<p>server å’Œ client ä¸éœ€è¦å¤šä»‹ç»ï¼Œå°±æ˜¯ Netty çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚bufferPool æ˜¯ç¼“å†²æ± ï¼Œç”¨äºå­˜å‚¨è¦ä¼ è¾“çš„æ•°æ®ã€‚nettyProtocol æä¾›äº† NettyClient å’Œ NettyServer å¼•å¯¼å¯åŠ¨æ³¨å†Œçš„ Channel Handlerã€‚</p>\n<p>åé¢å°±æ˜¯åˆ›å»º NettyShuffleEnvironment åŠå…¶éœ€è¦çš„å¯¹è±¡äº†ã€‚åœ¨åˆ›å»ºå®Œæˆåï¼Œä¼šè°ƒç”¨å®ƒçš„ start æ–¹æ³•å¯åŠ¨ã€‚è¿™ä¸ªå¯åŠ¨æ–¹æ³•å°±æ˜¯è°ƒç”¨äº† <code>connectionManager.start</code>ï¼Œåœ¨ NettyConnectionManager ä¸­ï¼Œå°±æ˜¯åˆå§‹åŒ–å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚</p>\n<pre><code class=\"language-java\">public int start() throws IOException {\n    client.init(nettyProtocol, bufferPool);\n\n    return server.init(nettyProtocol, bufferPool);\n}\n</code></pre>\n<h4 id=\"client-åˆå§‹åŒ–\">client åˆå§‹åŒ–</h4>\n<p>client çš„åˆå§‹åŒ–è¿‡ç¨‹æ˜¯å…ˆåˆ›å»ºå¹¶åˆå§‹åŒ– Bootstrapã€‚</p>\n<pre><code class=\"language-java\">private void initEpollBootstrap() {\n    // Add the server port number to the name in order to distinguish\n    // multiple clients running on the same host.\n    String name =\n            NettyConfig.CLIENT_THREAD_GROUP_NAME + \" (\" + config.getServerPortRange() + \")\";\n\n    EpollEventLoopGroup epollGroup =\n            new EpollEventLoopGroup(\n                    config.getClientNumThreads(), NettyServer.getNamedThreadFactory(name));\n    bootstrap.group(epollGroup).channel(EpollSocketChannel.class);\n\n    config.getTcpKeepIdleInSeconds()\n            .ifPresent(idle -&gt; bootstrap.option(EpollChannelOption.TCP_KEEPIDLE, idle));\n    config.getTcpKeepInternalInSeconds()\n            .ifPresent(\n                    interval -&gt; bootstrap.option(EpollChannelOption.TCP_KEEPINTVL, interval));\n    config.getTcpKeepCount()\n            .ifPresent(count -&gt; bootstrap.option(EpollChannelOption.TCP_KEEPCNT, count));\n}\n</code></pre>\n<p>åˆå§‹åŒ–è¿‡ç¨‹é‡è¦è®¾ç½® EventLoopGroup å’Œ channelï¼Œå¯ä»¥ç”¨ epoll çš„è¯å°±ç”¨ epollï¼Œå¦åˆ™å°±ç”¨ nioã€‚è®¾ç½®å¥½è¿™äº›åå°±æ˜¯è®¾ç½®äº†ä¸€äº›é€šé“å‚æ•°ï¼ˆè¿æ¥è¶…æ—¶æ—¶é—´ã€Bufffer æ± ç­‰ï¼‰ã€‚</p>\n<p>åˆ°è¿™é‡Œ client çš„åˆå§‹åŒ–å…¶å®å¹¶æ²¡æœ‰ç»“æŸï¼Œè¿˜éœ€è¦è®¾ç½® Handler æµæ°´çº¿ï¼Œè¿™äº›å·¥ä½œæ˜¯åœ¨ Task å¯åŠ¨æ—¶æ‰§è¡Œäº†ã€‚</p>\n<h4 id=\"server-åˆå§‹åŒ–\">server åˆå§‹åŒ–</h4>\n<p>server çš„åˆå§‹åŒ–è¿‡ç¨‹æ˜¯å…ˆåˆ›å»ºå¹¶åˆå§‹åŒ–äº† ServerBootstrapã€‚ä¹‹ååŒæ ·ä¹Ÿæ˜¯è®¾ç½® EventLoopGroup å’Œ channelï¼Œä»¥åŠé€šé“ç›¸å…³çš„å„ç§å‚æ•°ã€‚</p>\n<p>è®¾ç½®å¥½ä¹‹åï¼Œä¼šæ·»åŠ  ChannelHandler æµæ°´çº¿ï¼Œè¿™é‡Œçš„ ChannelHandler æµæ°´çº¿å°±æ˜¯æˆ‘ä»¬å‰é¢åˆ›å»ºçš„ NettyProtocol æä¾›çš„ã€‚</p>\n<pre><code class=\"language-java\">public ChannelHandler[] getServerChannelHandlers() {\n    PartitionRequestQueue queueOfPartitionQueues = new PartitionRequestQueue();\n    PartitionRequestServerHandler serverHandler =\n            new PartitionRequestServerHandler(\n                    partitionProvider, taskEventPublisher, queueOfPartitionQueues);\n\n    return new ChannelHandler[] {\n        messageEncoder,\n        new NettyMessage.NettyMessageDecoder(),\n        serverHandler,\n        queueOfPartitionQueues\n    };\n}\n</code></pre>\n<p>æµæ°´çº¿ä¸ŠåŒ…å«äº†æ¶ˆæ¯ç¼–ç å™¨ã€è§£ç å™¨ã€PartitionRequestServerHandler è¯·æ±‚æœåŠ¡ç«¯å¤„ç†å™¨å’Œ PartitionRequestQueue åˆ†åŒºè¯·æ±‚é˜Ÿåˆ—ã€‚</p>\n<p>è¿™äº›éƒ½è®¾ç½®å¥½ä¹‹åï¼Œå°±å¼€å§‹å¯åŠ¨ NettyServer æœåŠ¡äº†ã€‚</p>\n<pre><code class=\"language-java\">Iterator&lt;Integer&gt; portsIterator = config.getServerPortRange().getPortsIterator();\nwhile (portsIterator.hasNext() &amp;&amp; bindFuture == null) {\n    Integer port = portsIterator.next();\n    LOG.debug(\"Trying to bind Netty server to port: {}\", port);\n\n    bootstrap.localAddress(config.getServerAddress(), port);\n    try {\n        bindFuture = bootstrap.bind().syncUninterruptibly();\n    } catch (Exception e) {\n        // syncUninterruptibly() throws checked exceptions via Unsafe\n        // continue if the exception is due to the port being in use, fail early\n        // otherwise\n        if (isBindFailure(e)) {\n            LOG.debug(\"Failed to bind Netty server\", e);\n        } else {\n            throw e;\n        }\n    }\n}\n\nif (bindFuture == null) {\n    throw new BindException(\n            \"Could not start rest endpoint on any port in port range \"\n                    + config.getServerPortRange());\n}\n\nlocalAddress = (InetSocketAddress) bindFuture.channel().localAddress();\n</code></pre>\n<h3 id=\"å®¢æˆ·ç«¯è¯·æ±‚è¿œç«¯å­åˆ†åŒº\">å®¢æˆ·ç«¯è¯·æ±‚è¿œç«¯å­åˆ†åŒº</h3>\n<p>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆå§‹åŒ–ä¹‹åï¼Œåœ¨ Task è¿è¡Œæ—¶ï¼Œä¼šå…ˆå®Œæˆ Client çš„ ChannelHandler çš„é…ç½®ï¼Œç„¶åè¯·æ±‚ Netty è¿œç«¯æœåŠ¡ã€‚</p>\n<p><img alt=\"NettyRequestPartition\" class=\"lazyload\" /></p>\n<p>æˆ‘ä»¬æ¥çœ‹å…·ä½“è¿‡ç¨‹ï¼Œåœ¨ Task åˆå§‹åŒ–æ—¶ï¼Œä¼šè°ƒç”¨ <code>StreamTask.invoke</code> æ–¹æ³•ï¼Œå…¶å†…éƒ¨ä¼šè°ƒç”¨ <code>StreamTask.restoreStateAndGate</code> æ–¹æ³•ï¼Œè¿™é‡Œä¼šä¾¿åˆ© Task çš„æ‰€æœ‰ InputGateï¼Œç„¶åè°ƒç”¨ requestPartitionsã€‚åœ¨ InputGate çš„ requestPartitions é€»è¾‘ä¸­ï¼Œåˆä¾¿åˆ©æ‰€æœ‰çš„ InputChannelï¼Œè°ƒç”¨ requestSubpartitionsã€‚</p>\n<pre><code class=\"language-java\">for (InputGate inputGate : inputGates) {\n    recoveredFutures.add(inputGate.getStateConsumedFuture());\n\n    inputGate\n            .getStateConsumedFuture()\n            .thenRun(\n                    () -&gt;\n                            mainMailboxExecutor.execute(\n                                    inputGate::requestPartitions,\n                                    \"Input gate request partitions\"));\n}\n\n\nprivate void internalRequestPartitions() {\n    for (InputChannel inputChannel : inputChannels()) {\n        try {\n            inputChannel.requestSubpartitions();\n        } catch (Throwable t) {\n            inputChannel.setError(t);\n            return;\n        }\n    }\n}\n</code></pre>\n<p>æˆ‘ä»¬æ¥çœ‹ <code>RemoteInputChannel.requestSubpartitions</code> çš„é€»è¾‘ã€‚</p>\n<pre><code class=\"language-java\">public void requestSubpartitions() throws IOException, InterruptedException {\n    if (partitionRequestClient == null) {\n        LOG.debug(\n                \"{}: Requesting REMOTE subpartitions {} of partition {}. {}\",\n                this,\n                consumedSubpartitionIndexSet,\n                partitionId,\n                channelStatePersister);\n        // Create a client and request the partition\n        try {\n            partitionRequestClient =\n                    connectionManager.createPartitionRequestClient(connectionId);\n        } catch (IOException e) {\n            // IOExceptions indicate that we could not open a connection to the remote\n            // TaskExecutor\n            throw new PartitionConnectionException(partitionId, e);\n        }\n\n        partitionRequestClient.requestSubpartition(\n                partitionId, consumedSubpartitionIndexSet, this, 0);\n    }\n}\n</code></pre>\n<p>è¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼Œå…ˆæ˜¯åˆ›å»º partitionRequestClientï¼Œç„¶åè°ƒç”¨ requestSubpartitionã€‚</p>\n<h4 id=\"åˆ›å»ºè¯·æ±‚å®¢æˆ·ç«¯\">åˆ›å»ºè¯·æ±‚å®¢æˆ·ç«¯</h4>\n<p>PartitionRequestClient æ˜¯åœ¨ <code>PartitionRequestClientFactory.connect</code> ä¸­åˆ›å»ºçš„ã€‚å…ˆè°ƒç”¨äº† <code>NettyClient.connect</code>ï¼ŒåŒæ­¥ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡ç«¯ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šè¿›è¡Œ ChannelHandler é…ç½®ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ä»‹ç»çš„ï¼ŒNettyClient æ²¡æœ‰å®Œæˆçš„æ­¥éª¤ã€‚</p>\n<pre><code class=\"language-java\">public ChannelHandler[] getClientChannelHandlers() {\n    NetworkClientHandler networkClientHandler = new CreditBasedPartitionRequestClientHandler();\n\n    return new ChannelHandler[] {\n        messageEncoder,\n        new NettyMessageClientDecoderDelegate(networkClientHandler),\n        networkClientHandler\n    };\n}\n</code></pre>\n<p>Handler åŒ…æ‹¬äº†æ¶ˆæ¯ç¼–ç å™¨ã€è§£ç å™¨å’Œ CreditBasedPartitionRequestClientHandler è¿™ä¸ªåŸºäº Credit çš„åˆ†åŒºè¯·æ±‚å®¢æˆ·ç«¯å¤„ç†å™¨ã€‚Handler é…ç½®å¥½ä¹‹åä¼šåˆ©ç”¨ bootstrap è¿æ¥åˆ°æœåŠ¡ç«¯ã€‚</p>\n<p>åœ¨è·å–åˆ° Channel å’Œ NetworkClientHandler ä¹‹åï¼Œå°±ç›´æ¥åˆ›å»ºäº† NettyPartitionRequestClientã€‚</p>\n<h4 id=\"è¯·æ±‚å­åˆ†åŒºæ•°æ®\">è¯·æ±‚å­åˆ†åŒºæ•°æ®</h4>\n<p>è®©æˆ‘ä»¬å†å›åˆ° RemoteInputChannel çš„ requestSubpartitions æ–¹æ³•ä¸­ï¼Œç°åœ¨æˆ‘ä»¬åˆ›å»ºå¥½äº† NettyPartitionRequestClientï¼Œæ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨å®ƒçš„ requestSubpartition æ–¹æ³•æ¥å‘èµ·è¯·æ±‚ã€‚</p>\n<p>è¿™é‡Œé€»è¾‘ä¹Ÿæ¯”è¾ƒç®€å•ï¼š</p>\n<ol>\n<li>\n<p>å‘ NetworkClientHandler æ³¨å†Œå½“å‰ RemoteInputChannelã€‚</p>\n</li>\n<li>\n<p>æ„é€ è¯·æ±‚å¯¹è±¡ PartitionRequestï¼Œè¿™é‡ŒåŒ…å«äº†åˆ†åŒº IDã€å­åˆ†åŒºç´¢å¼•ã€inputChannel ID ä»¥åŠåˆè¯†çš„ Creditã€‚</p>\n</li>\n<li>\n<p>è°ƒç”¨ <code>tcpChannel.writeAndFlush</code> å‘èµ·è¯·æ±‚ï¼Œå¹¶æ·»åŠ è¯·æ±‚å¤±è´¥çš„ç›‘å¬ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œç§»é™¤å½“å‰ inputChannelã€‚</p>\n</li>\n</ol>\n<h3 id=\"æœåŠ¡ç«¯å“åº”\">æœåŠ¡ç«¯å“åº”</h3>\n<p>ç°åœ¨æ•°æ®åˆ°äº†æœåŠ¡ç«¯ï¼Œæˆ‘ä»¬æ¥çœ‹æœåŠ¡ç«¯å¤„ç†çš„å…·ä½“è¿‡ç¨‹ã€‚</p>\n<p><img alt=\"NettyServerHandler\" class=\"lazyload\" /></p>\n<p>åœ¨ NettyServer åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªé‡è¦çš„ Handlerï¼Œåˆ†åˆ«æ˜¯ PartitionRequestServerHandler å’Œ PartitionRequestQueueã€‚æœåŠ¡ç«¯å“åº”æ•°æ®çš„è¿‡ç¨‹å°±æ˜¯è¿™ä¸¤ä¸ª Handler åœ¨å‘æŒ¥ä½œç”¨ã€‚</p>\n<p>PartitionRequestServerHandler è´Ÿè´£å¤„ç† Client ç«¯é€šè¿‡ PartitionRequestClient å‘é€çš„è¯·æ±‚ï¼Œå¤„ç†è¿‡ç¨‹æ˜¯å…ˆåˆ›å»º CreditBasedSequenceNumberingViewReader ç±»å‹çš„ readerï¼Œç„¶åå°†å®ƒæ”¾å…¥ PartitionRequestQueue ç»´æŠ¤çš„ reader é˜Ÿåˆ—ä¸­ã€‚PartitionRequestQueue ä¼šç›‘å¬ Netty Channel çš„å¯å†™å…¥çŠ¶æ€ï¼Œå½“ Netty Channel å¯å†™å…¥æ—¶ï¼Œä¼šæ¶ˆè´¹æ•°æ®å¹¶å†™å…¥ç½‘ç»œã€‚</p>\n<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹å…·ä½“çš„æºç ã€‚</p>\n<p>æœåŠ¡ç«¯çš„å“åº”å…¥å£åœ¨ <code>PartitionRequestServerHandler.channelRead0</code> æ–¹æ³•ï¼Œè¿™é‡Œåœ¨å¤„ç† PartitionRequest è¯·æ±‚æ—¶ï¼Œå…ˆæ˜¯åˆ›å»º CreditBasedSequenceNumberingViewReaderï¼Œç„¶åè°ƒç”¨ requestSubpartitionViewOrRegisterListenerã€‚</p>\n<p>requestSubpartitionViewOrRegisterListener çš„é€»è¾‘æ˜¯åˆ›å»º ResultSubpartitionViewï¼Œå¹¶æé†’ PartitionRequestQueue æœ‰æ•°æ®å¯ç”¨ã€‚</p>\n<pre><code class=\"language-java\">Optional&lt;ResultSubpartitionView&gt; subpartitionViewOptional =\n        partitionProvider.createSubpartitionViewOrRegisterListener(\n                resultPartitionId,\n                subpartitionIndexSet,\n                this,\n                partitionRequestListener);\n...\n\nnotifyDataAvailable(subpartitionView);\n</code></pre>\n<p>ResultSubpartitionView å°±æ˜¯ç”¨æ¥æ¶ˆè´¹ ResultSubpartition çš„æ•°æ®ã€‚</p>\n<p>notifyDataAvailable å†…éƒ¨è°ƒç”¨äº† notifyReaderNonEmptyï¼ŒnotifyReaderNonEmpty åˆè§¦å‘äº† userEventTriggeredï¼Œè¿™é‡Œè°ƒç”¨ enqueueAvailableReader å°† reader æ”¾å…¥åˆ°å¯ç”¨é˜Ÿåˆ— availableReaders ä¸­ã€‚</p>\n<pre><code class=\"language-java\">private void enqueueAvailableReader(final NetworkSequenceViewReader reader) throws Exception {\n    if (reader.isRegisteredAsAvailable()) {\n        return;\n    }\n\n    ResultSubpartitionView.AvailabilityWithBacklog availabilityWithBacklog =\n            reader.getAvailabilityAndBacklog();\n    if (!availabilityWithBacklog.isAvailable()) {\n        int backlog = availabilityWithBacklog.getBacklog();\n        if (backlog &gt; 0 &amp;&amp; reader.needAnnounceBacklog()) {\n            announceBacklog(reader, backlog);\n        }\n        return;\n    }\n\n    // Queue an available reader for consumption. If the queue is empty,\n    // we try trigger the actual write. Otherwise this will be handled by\n    // the writeAndFlushNextMessageIfPossible calls.\n    boolean triggerWrite = availableReaders.isEmpty();\n    registerAvailableReader(reader);\n\n    if (triggerWrite) {\n        writeAndFlushNextMessageIfPossible(ctx.channel());\n    }\n}\n</code></pre>\n<p>å¦‚æœ reader æ˜¯é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¼šè§¦å‘æ•°æ®å†™å…¥ç½‘ç»œã€‚</p>\n<p>writeAndFlushNextMessageIfPossible çš„å¤„ç†æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>\n<p>å–å‡ºå¯ç”¨ readerã€‚</p>\n</li>\n<li>\n<p>è°ƒç”¨ <code>reader.getNextBuffer</code> è·å–æ•°æ®ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœ reader ä»ç„¶å¯ç”¨ï¼Œå°†å…¶åŠ å›é˜Ÿåˆ—ã€‚</p>\n</li>\n<li>\n<p>å‘ä¸‹æ¸¸å†™å…¥æ•°æ®å¹¶æ·»åŠ ä¸‹æ¬¡å†™å…¥çš„ç›‘å¬ã€‚</p>\n</li>\n</ol>\n<pre><code class=\"language-java\">public BufferAndAvailability getNextBuffer() throws IOException {\n    BufferAndBacklog next = subpartitionView.getNextBuffer();\n    if (next != null) {\n        if (next.buffer().isBuffer() &amp;&amp; --numCreditsAvailable &lt; 0) {\n            throw new IllegalStateException(\"no credit available\");\n        }\n\n        final Buffer.DataType nextDataType = getNextDataType(next);\n        return new BufferAndAvailability(\n                next.buffer(), nextDataType, next.buffersInBacklog(), next.getSequenceNumber());\n    } else {\n        return null;\n    }\n}\n</code></pre>\n<p>åœ¨ getNextBuffer æ–¹æ³•ä¸­ï¼Œä¼šå°† credit å€¼å‡ 1ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦å°äº 0ã€‚å¦‚æœå°äº 0 ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œreader æ˜¯å¦å¯ç”¨ä¹Ÿæ˜¯æ ¹æ® numCreditsAvailable æ˜¯å¦å¤§äº 0 æ¥åˆ¤æ–­çš„ã€‚</p>\n<h3 id=\"å®¢æˆ·ç«¯æ¥æ”¶æ•°æ®\">å®¢æˆ·ç«¯æ¥æ”¶æ•°æ®</h3>\n<p>NettyClient åœ¨æ¶ˆè´¹æ•°æ®æ—¶ï¼ŒåŒæ ·ä¹Ÿæ˜¯ä»¥ ChannelHandler ä½œä¸ºå…¥å£ã€‚è¿™é‡Œçš„å…¥å£æ–¹æ³•æ˜¯ <code>CreditBasedPartitionRequestClientHandler.channelRead</code> ã€‚</p>\n<p><img alt=\"NettyClientHandler\" class=\"lazyload\" /></p>\n<p>åœ¨ decodeMsg æ–¹æ³•ä¸­ï¼Œå…ˆè§£ç  msgï¼Œåˆ¤æ–­ InputChannel æ˜¯å¦å¯ç”¨ï¼Œå¦‚æœä¸å¯ç”¨ï¼Œåˆ™å–æ¶ˆå½“å‰ InputChannel çš„è®¢é˜…ã€‚å¦‚æœå¯ç”¨ï¼Œç»§ç»­è°ƒç”¨ decodeBufferOrEvent è¿›è¡Œå¤„ç†ã€‚decodeBufferOrEvent çš„æ ¸å¿ƒé€»è¾‘æ˜¯è°ƒç”¨ <code>RemoteInputChannel.onBuffer</code> æ–¹æ³•ï¼Œå°†æ•°æ®åŠ å…¥åˆ° receivedBuffers é˜Ÿåˆ—ã€‚</p>\n<p>å¦‚æœ receivedBuffers é˜Ÿåˆ—åœ¨æ­¤ä¹‹å‰å¤„äºç©ºé—²çŠ¶æ€ï¼Œä¼šè°ƒç”¨ notifyChannelNonEmptyï¼Œå°†å½“å‰ RemoteInputChannel åŠ å…¥åˆ° inputChannelsWithData é˜Ÿåˆ—ä¸­ï¼ŒåŒæ—¶è¿˜ä¼šå”¤é†’ inputChannelsWithData ä¸Šçš„é˜»å¡çº¿ç¨‹ï¼Œè®© inputGate å¯ä»¥æ¶ˆè´¹ RemoteInputChannel çš„æ•°æ®ã€‚</p>\n<pre><code class=\"language-java\">private boolean queueChannelUnsafe(InputChannel channel, boolean priority) {\n    assert Thread.holdsLock(inputChannelsWithData);\n    if (channelsWithEndOfPartitionEvents.get(channel.getChannelIndex())) {\n        return false;\n    }\n\n    final boolean alreadyEnqueued =\n            enqueuedInputChannelsWithData.get(channel.getChannelIndex());\n    if (alreadyEnqueued\n            &amp;&amp; (!priority || inputChannelsWithData.containsPriorityElement(channel))) {\n        // already notified / prioritized (double notification), ignore\n        return false;\n    }\n\n    // å½“å‰ inputChannel åŠ å…¥åˆ° inputChannelsWithData\n    inputChannelsWithData.add(channel, priority, alreadyEnqueued);\n    if (!alreadyEnqueued) {\n        enqueuedInputChannelsWithData.set(channel.getChannelIndex());\n    }\n    return true;\n}\n\n// å”¤é†’çº¿ç¨‹\npublic void notifyDataAvailable() {\n    availabilityMonitor.notifyAll();\n    toNotify = inputGate.availabilityHelper.getUnavailableToResetAvailable();\n}\n</code></pre>\n<p>å¦‚æœå®¢æˆ·ç«¯æœ‰ç§¯å‹ï¼Œè¿˜éœ€è¦æ ¹æ®ç§¯å‹ç”³è¯· Buffer å¹¶æ›´æ–° Credit å€¼ã€‚è¿™é‡Œç”³è¯·çš„ buffer æ•°é‡ä¸ºç§¯å‹æ•°é‡+åˆè¯† Credit å€¼ã€‚</p>\n<pre><code class=\"language-java\">public void onSenderBacklog(int backlog) throws IOException {\n    notifyBufferAvailable(bufferManager.requestFloatingBuffers(backlog + initialCredit));\n}\n</code></pre>\n<p>å¦‚æœ RemoteInputChannel æ²¡æœ‰è¶³å¤Ÿçš„ bufferï¼Œåˆ™ä¼šå‘ LocalBufferPool ç”³è¯·æ–°çš„ bufferï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œä¼šåŠ ä¸€ä¸ªç›‘å¬ï¼Œç­‰ LocalBufferPool æœ‰ç©ºé—²æ—¶å†è§¦å‘ç”³è¯· bufferã€‚</p>\n<pre><code class=\"language-java\">private int tryRequestBuffers() {\n    assert Thread.holdsLock(bufferQueue);\n\n    int numRequestedBuffers = 0;\n    while (bufferQueue.getAvailableBufferSize() &lt; numRequiredBuffers\n            &amp;&amp; !isWaitingForFloatingBuffers) {\n        BufferPool bufferPool = inputChannel.inputGate.getBufferPool();\n        Buffer buffer = bufferPool.requestBuffer();\n        if (buffer != null) {\n            bufferQueue.addFloatingBuffer(buffer);\n            numRequestedBuffers++;\n        } else if (bufferPool.addBufferListener(this)) {\n            isWaitingForFloatingBuffers = true;\n            break;\n        }\n    }\n    return numRequestedBuffers;\n}\n</code></pre>\n<p>å½“ RemoteInputChannel ç”³è¯·åˆ°äº†éœ€è¦çš„ buffer ä¹‹åï¼Œå°±ä¼šå‘ NettyServer å‘é€ AddCredit æ¶ˆæ¯ï¼Œè¯·æ±‚æ›´æ–° Credit å€¼ã€‚</p>\n<pre><code class=\"language-java\">private void notifyCreditAvailable() throws IOException {\n    checkPartitionRequestQueueInitialized();\n\n    partitionRequestClient.notifyCreditAvailable(this);\n}\n\n\npublic void notifyCreditAvailable(RemoteInputChannel inputChannel) {\n    sendToChannel(new AddCreditMessage(inputChannel));\n}\n</code></pre>\n<p>NettyServer æ”¶åˆ°è¯·æ±‚åï¼Œä¼šå°†å¯¹åº”çš„ Credit å€¼è¿›è¡Œæ›´æ–°ã€‚</p>\n<pre><code class=\"language-java\">else if (msgClazz == AddCredit.class) {\n    AddCredit request = (AddCredit) msg;\n\n    outboundQueue.addCreditOrResumeConsumption(\n            request.receiverId, reader -&gt; reader.addCredit(request.credit));\n}\n\nvoid addCreditOrResumeConsumption(\n        InputChannelID receiverId, Consumer&lt;NetworkSequenceViewReader&gt; operation)\n        throws Exception {\n    if (fatalError) {\n        return;\n    }\n\n    NetworkSequenceViewReader reader = obtainReader(receiverId);\n\n    operation.accept(reader);\n    enqueueAvailableReader(reader);\n}\n\n\npublic void addCredit(int creditDeltas) {\n    numCreditsAvailable += creditDeltas;\n}\n</code></pre>\n<p>æ­¤å¤–ï¼ŒFlink è¿˜æœ‰ä¸¤ç§åœºæ™¯ä¼šæ›´æ–° Credit å€¼ã€‚</p>\n<p>ä¸€ç§æ˜¯ LocalBufferPool å›æ”¶ç©ºé—² buffer æ—¶ï¼Œä¼šå°† buffer åˆ†é…ç»™ç”³è¯·è€…ï¼Œåˆ†é…ä¹‹åä¼šè°ƒç”¨å¯¹åº” InputChannel çš„ notifyBufferAvailable æ–¹æ³•é€šçŸ¥æ›´æ–° Creditã€‚</p>\n<p><img alt=\"LocalBufferPool\" class=\"lazyload\" /></p>\n<p>å¦ä¸€ç§æ˜¯ RemoteInputChannel ç‹¬å çš„ buffer é˜Ÿåˆ—é‡Šæ”¾ buffer æ—¶ï¼Œä¼šè§¦å‘ Credit æ›´æ–°ã€‚</p>\n<p><img alt=\"BufferManager\" class=\"lazyload\" /></p>\n<h3 id=\"åå‹\">åå‹</h3>\n<p>é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å…¶å®å·²ç»ç†è§£äº†åå‹çš„æœºåˆ¶äº†ã€‚å½“å‰ Flink çš„åå‹å°±æ˜¯é€šè¿‡ Credit æ¥å®ç°åå‹çš„ï¼Œå¦‚æœä¸‹æ¸¸æ•°æ®å¤„ç†é€Ÿåº¦æ…¢ï¼ŒCredit ä¼šè¢«è€—å°½ï¼Œä¸Šæ¸¸ä¹Ÿå°±ä¸ä¼šç»§ç»­å¤„ç†å’Œä¸‹å‘æ•°æ®äº†ã€‚ç›´åˆ°ä¸‹æ¸¸å¤„ç†å®Œæˆï¼Œæœ‰äº†ç©ºé—²çš„ bufferï¼Œæ­¤æ—¶å‘ä¸Šæ¸¸åé¦ˆæ›´æ–° Credit å€¼ï¼Œä¸Šæ¸¸å°±ä¼šç»§ç»­å¤„ç†æ•°æ®ã€‚</p>\n<h3 id=\"æ€»ç»“\">æ€»ç»“</h3>\n<p>æœ€åæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼Œæœ¬æ–‡æˆ‘ä»¬ä¸€èµ·æ¢³ç†äº† Flink Netty ç›¸å…³çš„æºç ã€‚åŒ…æ‹¬ NettyClient å’Œ NettyServer çš„åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¼šåˆ›å»ºä¸€ç³»åˆ— ChannelHandlerï¼Œä¹‹ååˆ©ç”¨è¿™äº›Handler å¤„ç†æ•°æ®ï¼Œæ•°æ®å¤„ç†åŒ…æ‹¬ Client ç«¯çš„å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼ŒServer ç«¯å¤„ç†æ¶ˆæ¯çš„è¿‡ç¨‹ã€‚ä¸­é—´è¿˜ç©¿æ’ç€ Credit çš„å¤„ç†ã€‚Flink çš„åå‹é€»è¾‘å°±æ˜¯ä¾èµ–äº Credit æ¥å®ç°çš„ã€‚</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-12 20:40</span>&nbsp;\n<a href=\"https://www.cnblogs.com/Jackeyzhe\">Jackeyzhe</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    }
  ]
}