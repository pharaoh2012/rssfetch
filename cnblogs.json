{
  "title": "主页 - 博客园",
  "link": "https://www.cnblogs.com/",
  "description": "主页 - 博客园 RSS",
  "entries": [
    {
      "title": "2025年度总结",
      "link": "https://www.cnblogs.com/SilverGo/p/19428614",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/SilverGo/p/19428614\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 22:47\">\n    <span>2025年度总结</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"table-of-contents\">Table of Contents</h1>\n<ol>\n<li><a href=\"#org936be25\" rel=\"noopener nofollow\">2025年度总结</a></li>\n<li><a href=\"#org07aceb4\" rel=\"noopener nofollow\">关于Ctorch</a></li>\n<li><a href=\"#orgc1859ea\" rel=\"noopener nofollow\">关于CSP-J</a></li>\n<li><a href=\"#org1d85aae\" rel=\"noopener nofollow\">关于lambda演算、UTM（通用图灵机）、Coq</a></li>\n<li><a href=\"#org9a42a9e\" rel=\"noopener nofollow\">关于汇编</a></li>\n<li><a href=\"#orgabafce1\" rel=\"noopener nofollow\">一些感想</a></li>\n<li><a href=\"#org89cb23b\" rel=\"noopener nofollow\">资料</a></li>\n<li><a href=\"#org3319ea0\" rel=\"noopener nofollow\">结语</a></li>\n</ol>\n<p>Powered by GhostFace's Emacs.</p>\n<p><a id=\"org936be25\"></a></p>\n<h1 id=\"2025年度总结\">2025年度总结</h1>\n<p><a id=\"org07aceb4\"></a></p>\n<h2 id=\"关于ctorch\">关于Ctorch</h2>\n<p><strong>Ctorch 诞生的第166天。</strong><br />\n没想到，ct都这么大了，<strong>从一个单人项目到现在4人的小团队，从一个模糊的想法到如今近万行的代码，总计5个月13天。</strong></p>\n<p>不得不说，这段时间，学到了很多。</p>\n<p><strong>从来没有用过git的人，commit了近160次；<br />\n从来没有接触过汇编的人，为了极限优化、搞懂编译器行为，学了2个月的汇编；<br />\n曾经连类都没写过的人，写了5个几千行的类；<br />\n曾经连朴素矩阵乘都不会写的菜鸡，手搓了一个Strassen+分块的并行矩阵乘</strong>；<br />\n诸如此类，不再列举。</p>\n<p><a id=\"orgc1859ea\"></a></p>\n<h2 id=\"关于csp-j\">关于CSP-J</h2>\n<p>本蒟蒻已经很长时间没有更新过日志了，可能的原因是比较忙。</p>\n<p><strong>最近几个月，本人一直在忙CSP-J的准备、Ctorch的开发、Coq的学习与lambda演算上。<br />\n先在暑假发起了「挑战3个月达省一」的挑战（当然，挑战成功了）</strong>；</p>\n<p>这一段时间，刷的题比我之前一年刷的都多；</p>\n<p>20多天，我学习了：<strong>dp、图论、并查集、加权并查集、模拟退火等算法，之前一年也只学了排序；</strong></p>\n<p><strong>怎么说呢，之前一直没搞清楚的搜索算法，现在看来也不过如此。</strong></p>\n<p><a id=\"org1d85aae\"></a></p>\n<h2 id=\"关于lambda演算utm通用图灵机coq\">关于lambda演算、UTM（通用图灵机）、Coq</h2>\n<p>随后，先是因为知道了C++有个叫lambda表达式的东西，随后在洛谷上搜索，<strong>意外看到了一篇讲lambda演算的文章</strong>；</p>\n<p>抱着在学校上课无聊的心态，学习了lambda演算，结果一发不可收拾。</p>\n<p>学完之后，我得知<strong>lambda演算图灵完备，于是乎，我想起了一个好玩的东西：用无类型lambda演算手搓UTM（通用图灵机），这当然理论可行</strong>。</p>\n<p>反正我平时能够思考的时间很多，在问过AI后，得知这是一次非常困难但是收获极大的挑战，我便开始了我的构建。</p>\n<p><strong>一支笔，一个本，一个脑子，不看论文，不搜索，只思考。<br />\n每天上放学的路上，走着需要35min左右，这段时间，我就会不停地思考关于UTM的问题。<br />\n这个过程很爽，因为我在构建一个完整的世界，理论上，这台「仅仅依靠代入完成计算」的“计算机”可以完成任何工作，只要你想，甚至可以跑一个仿真的Windows.</strong></p>\n<p>写了快几十张纸，我才明白，AI说的那句：<strong>「lambda演算可以练习思维」</strong>，突然有一天，我看待调用、递归的感觉完全变了，我看函数的感觉也变了。</p>\n<p><strong>我们都觉得，是先有了数字，才有了函数;</strong><br />\n但是，Church数字告诉我们，<strong>数字也是函数</strong>。</p>\n<p>（这个名为LUTM的UTM仍在设计，不过，由于Ctorch对我的优先级更高，目前暂时停工，等2月16日发布Ctorch RC 1之后再继续）</p>\n<p><strong>学习完lambda演算后，我接触到了Coq。<br />\nCoq证明「加法左零律」的思路让我感觉无比震惊，这完全颠覆了我对数学归纳法的认知</strong>。</p>\n<p><strong>而且，Coq中对自然数的定义和lambda演算的列表出奇的一致。<br />\n怎么说呢，可能这就是「万变不离其宗」吧.</strong><br />\n但是仍然是为了Ctorch的开发，我暂停了Coq的学习。</p>\n<p><a id=\"org9a42a9e\"></a></p>\n<h2 id=\"关于汇编\">关于汇编</h2>\n<p>在这之后，我学习了Arm64汇编。<br />\n仅仅是写出一个Hello World，我就花了2天（当然，我在学校每天只有10min能用电脑，20min可以和AI对话）.<br />\n但仅此一次，我就明白了，C++中递归、调用是如何做的，本质其实就是将x29,x30寄存器的值修改；<br />\n我也明白了，什么是「栈溢出」，什么是「调用栈」。<br />\n几行的C++换成汇编就可能需要数十行，这让我写代码时会思考着汇编的样子。<br />\n不得不说，这确实是一次很好的历练。</p>\n<p><a id=\"orgabafce1\"></a></p>\n<h2 id=\"一些感想\">一些感想</h2>\n<p>回首这几个月我所经历的，可能比我之前一年学的都要多，都要杂；</p>\n<p><strong>这些知识无疑带给了我很强的塑造作用：<br />\n设计LUTM，锻炼了我进行2小时以上的深度思考的能力；<br />\n学习汇编，让我对底层有了掌控；<br />\n学习lambda演算，让我对函数有了更彻底的认识；<br />\n可以说，对一个初中生而言，这条路径独一无二。<br />\n我结识了一群志同道合的朋友，有了自己的团队、组织；<br />\n曾经那个被嘲笑“写这些有什么用”、“连个奖都拿不到”的人，如今竟成为一个开源项目的开发者、CSP-J的省一。</strong><br />\n<strong>毫无疑问，这是无比有价值的半年；</strong></p>\n<p><a id=\"org89cb23b\"></a></p>\n<h1 id=\"资料\">资料</h1>\n<p>下面放一点资料</p>\n<p>1.设计LUTM时与Deepseek的对话：<a href=\"https://chat.deepseek.com/share/wednovjlp5sa013j4q\" rel=\"noopener nofollow\" target=\"_blank\">https://chat.deepseek.com/share/wednovjlp5sa013j4q</a><br />\n2.文章：《恭喜自己，挑战成功》————CSP-J省一获奖感言：<a href=\"https://www.cnblogs.com/SilverGo/p/19223328\" target=\"_blank\">https://www.cnblogs.com/SilverGo/p/19223328</a><br />\n3.文章：《逆袭导论·初中生的宝书》：<a href=\"https://www.cnblogs.com/SilverGo/p/19284999\" target=\"_blank\">https://www.cnblogs.com/SilverGo/p/19284999</a><br />\n4.文章：《矩阵乘法优化》：<a href=\"https://www.cnblogs.com/SilverGo/p/19019364\" target=\"_blank\">https://www.cnblogs.com/SilverGo/p/19019364</a><br />\n5.Ctorch的github：<a href=\"https://github.com/ShengFlow/CTorch/tree/feature-nn.Module?tab=contributing-ov-file\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/ShengFlow/CTorch/tree/feature-nn.Module?tab=contributing-ov-file</a><br />\n6.以下是图片：<br />\n<img alt=\"截屏2025-12-28 10.22.19\" height=\"982\" src=\"https://img2024.cnblogs.com/blog/3357339/202512/3357339-20251231224442471-111964913.png\" width=\"1512\" /><br />\n<img alt=\"截屏2025-12-18 06.31.21\" height=\"982\" src=\"https://img2024.cnblogs.com/blog/3357339/202512/3357339-20251231224520016-1653169643.png\" width=\"1512\" /><br />\n<img alt=\"截屏2025-10-04 16.25.21\" height=\"982\" src=\"https://img2024.cnblogs.com/blog/3357339/202512/3357339-20251231224619686-610660255.png\" width=\"1512\" /></p>\n<p><a id=\"org3319ea0\"></a></p>\n<h1 id=\"结语\">结语</h1>\n<blockquote>\n<p>“Put yourself in places that are gonna cause you to stretch<br />\n让自己置身于能促使自己突破的境地<br /><br />\nA fighter isn't someone that never fails<br />\n真正的勇士并非永不失败<br /><br />\nA fighter is someone who never quits<br />\n而是永不言弃<br /><br />\nYou are more to me than you could never now<br />\n你对我而言远比自己想象的更重要<br /><br />\nAnd I know I've got a full room of fighters in here right<br />\n此刻我深知这满座皆是勇者”<br /></p>\n</blockquote>\n<blockquote>\n<p>“I see ,I like ,I go ,I get.<br />\n目之所及，心之所向，踏上征程，志在必得！”<br /></p>\n</blockquote>\n<blockquote>\n<p>“为天地立心，<br /><br />\n为生民立命，<br /><br />\n为往圣继绝学，<br /><br />\n为万世开太平”————宋·张载《横渠四句》<br /></p>\n</blockquote>\n<blockquote>\n<p>“身处低谷不自弃，我命由我不由天。<br /><br />\n无人扶我青云志，我自踏雪至山巅。<br /><br />\n若是命中无此运，亦可孤身登昆仑。<br /><br />\n红尘赠我三尺剑，酒换瘦马一世街。<br /><br />\n世人朝路乃绝涧，独见众生止步前。<br /><br />\n海到尽头天作岸，山登绝顶我为峰。<br /><br />\n如若东山能再起，大鹏展翅九万里。<br /><br />\n一入红尘梦易真，一朝悟透心境名。<br /><br />\n一朝悟道见真我，昔日枷锁皆云烟。<br /><br />\n天门将至百运开，拂尘轻笑问仙来。<br /><br />\n何须扶我青云志，我自凌云至山巅！”————徐霞客《青云志》<br /></p>\n</blockquote>\n<p><strong>2025，对我而言，注定是难忘的一年.</strong><br />\n<strong>诸位，新年快乐！</strong></p>\n<p><strong>预告：我们预计在2026.2.16（除夕）发布Ctorch RC v1.0，敬请期待，欢迎联系：QQ 1113109729，参与内测，感激不尽！</strong></p>\n<p>GhostFace<br />\n2025.12.31</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 22:47</span>&nbsp;\n<a href=\"https://www.cnblogs.com/SilverGo\">Ghost-Face</a>&nbsp;\n阅读(<span id=\"post_view_count\">22</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "论文解读：One-shot Entropy Minimization",
      "link": "https://www.cnblogs.com/qizhou/p/19426973",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/qizhou/p/19426973\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 15:36\">\n    <span>论文解读：One-shot Entropy Minimization</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p>一篇还未发表的论文，但做了大量实验对熵最小化技巧提升模型推理能力进行了探索。本文训练了13440个大型语言模型，发现熵最小化（EM）只需要一个未标记的数据和10步优化，性能提升就比<strong>RL</strong>还强。基于两个直接而简单的假设：</p>\n<ul>\n<li>\n<p>生成大型语言模型的采样过程本质上是随机的。</p>\n</li>\n<li>\n<p>正确答案的熵通常低于错误答案。</p>\n</li>\n</ul>\n<p>EM和RL有<strong>共同目标</strong>：在不添加新知识的情况下释放预训练模型的潜在潜力，都依赖于所谓“token重评级”。</p>\n<p>原文网址：<a href=\"https://arxiv.org/abs/2505.20282v4\" rel=\"noopener nofollow\" target=\"_blank\">https://arxiv.org/abs/2505.20282v4</a></p>\n<h1>方法</h1>\n<p>给定prompt <span class=\"math\">$x$</span>，生成序列<span class=\"math\">$y$</span>，最小化生成序列token级别的预测熵：</p>\n<p style=\"text-align: center;\"><span class=\"math\">$\\displaystyle L_{\\mathrm{EM}} = \\frac{1}{|y|} \\sum_{t = 1}^{|y|} H_t&nbsp;&nbsp;$</span></p>\n<p style=\"text-align: center;\"><span class=\"math\">$\\displaystyle H_t = -\\sum_{v \\in V} p_\\theta(v \\mid y_{&lt;t}, x)\\,\\log p_\\theta(v \\mid y_{&lt;t}, x)$</span></p>\n<p>训练对单个样本进行，从未标注数据中筛选（2.2节）：模型在多次采样下表现出较高的 pass@k 方差，从而对“熵”更敏感，提供更强的<strong>熵梯度</strong>信号。所谓pass@k 方差就是大模型针对同一个数据生成<span class=\"math\">$k$</span>段内容，计算<span class=\"math\">$k$</span>个内容正确与否的方差。</p>\n<h1>实验</h1>\n<p><strong>训练设置：</strong>针对特定样本，每次生成64段推理内容（即训练批量为64），用以上最小熵损失微调大模型10次。预测温度设置为0.5，学习率固定为<span class=\"math\">$2\\times 10^{-5}$</span>。</p>\n<p>表1：各种推理模型与EM的对比。</p>\n<p>图1：用了EM之后，模型生成token 的概率分布。EM使分布更右偏。</p>\n<p>图2：EM损失和评估分数随着训练的变化曲线。</p>\n<p>图3/4：不同温度对性能的影响。</p>\n<p>图5：EM和RL先后执行，性能随迭代的变化。发现RL之后应用EM会导致性能下降，而EM之后RL性能会提升。这表明EM加剧了RL引入的分配扭曲，强化了RL的“对齐税”。</p>\n<p>表2：多样本的EM与单样本的EM对比，看出多样本也没有多大优势。</p>\n<p>图6：不同学习率对推理性能的影响。</p>\n<h1>讨论与见解</h1>\n<p>单次EM增益的上限由基础模型的内在推理能力决定。在相对较弱的LLaMA-3.1-8B上，单次EM的平均准确率仅提高到24.3%，勉强超过23.6%的基线。这表明，当底层模型缺乏足够的推理能力时，最小EM优化无法完全弥补其不足。</p>\n<p>RL根据外部真实奖励调整令牌概率。这通常会促进以前低概率（尾部）代币的相对排名。即使在重新排序后，这些代币也往往占据概率分布的中间位置，需要在采样过程中选择更高的温度。因此，RL训练的模型表现出相反的趋势：性能随着采样温度的升高而提高，如图4所示。</p>\n<p>在大多数场景中，尤其是在SFT和训练最少的RL环境中，EM显著地修剪了冗余的决策路径，稳定了关键预测，验证了其作为最小但强大的优化策略的有效性和通用性。</p>\n<p>&nbsp;</p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 15:36</span>&nbsp;\n<a href=\"https://www.cnblogs.com/qizhou\">颀周</a>&nbsp;\n阅读(<span id=\"post_view_count\">59</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "基于大疆MSDK实现的无人机视觉引导自适应降落功能",
      "link": "https://www.cnblogs.com/foury/p/19426887",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/foury/p/19426887\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 15:24\">\n    <span>基于大疆MSDK实现的无人机视觉引导自适应降落功能</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"基于大疆msdk实现的无人机视觉引导自适应降落功能\">基于大疆MSDK实现的无人机视觉引导自适应降落功能</h1>\n<h2 id=\"概述\">概述</h2>\n<p>最初需求：想要无人机在执行完航线任务后，一键落到一个指定的位置，简化人工控制。</p>\n<p>实现一套完整的无人机自主降落功能,通过虚拟摇杆控制使无人机飞向指定位置，再利用视觉识别引导无人机精确降落到具体位置。本文中采用自适应降落策略,根据高度动态调整精度要求和下降速度,以实现安全、精确的降落。</p>\n<p><strong>核心点:</strong></p>\n<ul>\n<li>虚拟摇杆导航替代FlyTo功能</li>\n<li>双轴(X/Y)位置偏移实时调整</li>\n<li>高度自适应降落策略</li>\n<li>视觉识别引导定位</li>\n<li>智能避障管理</li>\n</ul>\n<hr />\n<h2 id=\"系统架构\">系统架构</h2>\n<h3 id=\"整体流程\">整体流程</h3>\n<div class=\"mermaid\">graph TD\n    A[用户触发Return to Vehicle] --&gt; B[获取无人机GPS位置]\n    B --&gt; C[计算与目标点距离]\n    C --&gt; D[启动虚拟摇杆导航]\n    D --&gt; E[飞向目标位置 5m/s]\n    E --&gt; F{距离小于10m?}\n    F --&gt;|否| E\n    F --&gt;|是| G[开始自适应降落]\n    G --&gt; H[视觉识别系统]\n    H --&gt; I[计算X/Y偏移量]\n    I --&gt; J[更新偏移量到ViewModel]\n    J --&gt; K[自适应降落循环]\n    K --&gt; L{高度分段判断}\n    L --&gt;|高于50m| M[高空模式]\n    L --&gt;|20-50m| N[中空模式]\n    L --&gt;|5-20m| O[低空模式]\n    L --&gt;|低于5m| P[极低空模式]\n    M --&gt; Q[计算调整速度和下降速度]\n    N --&gt; Q\n    O --&gt; Q\n    P --&gt; Q\n    Q --&gt; R{偏移大于阈值2倍?}\n    R --&gt;|是| S[停止下降只调整]\n    R --&gt;|否| T[边调整边下降]\n    S --&gt; U{高度小于5m?}\n    T --&gt; U\n    U --&gt;|是| V[关闭下视避障]\n    U --&gt;|否| K\n    V --&gt; W{高度小于等于0.1m?}\n    W --&gt;|否| K\n    W --&gt;|是| X[着陆完成清理资源]\n\n</div><h2 id=\"技术实现思路\">技术实现思路</h2>\n<h3 id=\"第一步让无人机飞到目标位置\">第一步:让无人机飞到目标位置?</h3>\n<h4 id=\"问题分析\">问题分析</h4>\n<p>遥控器控制的无人机在执行完航线任务之后，飞到给定降落点（汽车或其他载具上）。最初的想法是使用DJI SDK提供的<code>FlyTo</code>功能,直接指定目标GPS坐标让无人机飞过去。但在实际测试中，发现部分机型（如M3E）并不支持<code>FlyTo</code>功能。</p>\n<p><strong>机型是否支持<code>FlyTo</code>功能参考文档</strong>：<a href=\"https://developer.dji.com/doc/mobile-sdk-tutorial/cn/tutorials/intelligent-flight.html\" rel=\"noopener nofollow\" target=\"_blank\">https://developer.dji.com/doc/mobile-sdk-tutorial/cn/tutorials/intelligent-flight.html</a></p>\n<h4 id=\"解决方案虚拟摇杆导航\">解决方案:虚拟摇杆导航</h4>\n<p>既然<code>FlyTo</code>功能不可用,那就用<strong>虚拟摇杆</strong>功能进行模拟。</p>\n<p><strong>思路:</strong></p>\n<ol>\n<li>计算当前位置到目标位置的<strong>方位角</strong>(bearing)</li>\n<li>将方位角转换为<strong>速度分量</strong>(南北/东西)</li>\n<li>持续发送虚拟摇杆指令,让无人机朝目标飞行</li>\n<li>实时监测距离,接近目标时停止</li>\n</ol>\n<p><strong>方位角计算:</strong></p>\n<pre><code class=\"language-kotlin\">private fun calculateBearing(latA: Double, lonA: Double, latB: Double, lonB: Double): Double {\n    val lat1 = Math.toRadians(latA)\n    val lat2 = Math.toRadians(latB)\n    val dLon = Math.toRadians(lonB - lonA)\n    \n    val y = Math.sin(dLon) * Math.cos(lat2)\n    val x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon)\n    \n    var bearing = Math.toDegrees(Math.atan2(y, x))\n    bearing = (bearing + 360) % 360  // 归一化到0-360度\n    \n    return bearing  // 0°=正北, 90°=正东, 180°=正南, 270°=正西\n}\n</code></pre>\n<p><strong>速度分量计算:</strong></p>\n<pre><code class=\"language-kotlin\">val bearing = calculateBearing(currentLat, currentLon, targetLat, targetLon)\nval bearingRad = Math.toRadians(bearing)\n\n// 使用GROUND坐标系(地面坐标系)\nval navParam = VirtualStickFlightControlParam().apply {\n    rollPitchCoordinateSystem = FlightCoordinateSystem.GROUND\n    verticalControlMode = VerticalControlMode.POSITION\n    yawControlMode = YawControlMode.ANGLE\n    rollPitchControlMode = RollPitchControlMode.VELOCITY\n    \n    // 将速度分解为南北和东西分量\n    pitch = NAVIGATION_SPEED * Math.cos(bearingRad)  // 南北分量(5m/s)\n    roll = NAVIGATION_SPEED * Math.sin(bearingRad)   // 东西分量(5m/s)\n    yaw = bearing  // 让机头指向目标\n    verticalThrottle = targetAlt\n}\n</code></pre>\n<ul>\n<li>GROUND坐标系是<strong>绝对方向</strong>,不受无人机朝向影响</li>\n<li>pitch控制南北,roll控制东西。</li>\n</ul>\n<p><strong>虚拟摇杆参数含义</strong>：<a href=\"https://developer.dji.com/doc/mobile-sdk-tutorial/cn/basic-introduction/basic-concepts/flight-controller.html#%E8%99%9A%E6%8B%9F%E6%91%87%E6%9D%86\" rel=\"noopener nofollow\" target=\"_blank\">https://developer.dji.com/doc/mobile-sdk-tutorial/cn/basic-introduction/basic-concepts/flight-controller.html#虚拟摇杆</a></p>\n<hr />\n<h3 id=\"第二步判断何时到达目标点上方附近\">第二步:判断何时到达目标点上方附近</h3>\n<h4 id=\"持续监测距离\">持续监测距离</h4>\n<p>每100ms检查一次当前位置与目标的距离，距离小于预期值<code>ARRIVAL_THRESHOLD</code>,就认为无人机已到达目标点上方附近，停止导航，开始降落:</p>\n<pre><code class=\"language-kotlin\">val navTask = object : Runnable {\n    override fun run() {\n        val currentLoc = getAircraftLocation()\n        val remainingDistance = calculateDistance(\n            currentLoc.latitude, currentLoc.longitude,\n            targetLat, targetLon\n        )\n        \n        if (remainingDistance &lt; ARRIVAL_THRESHOLD) {  // 10米内\n            // 到达目标,停止导航,开始降落\n            isNavigating = false\n            startDynamicAdjustment()\n        } else {\n            // 继续飞行\n            sendNavigationCommand()\n            virtualStickHandler?.postDelayed(this, 100)\n        }\n    }\n}\n</code></pre>\n<hr />\n<h3 id=\"第三步精确降落到指定点\">第三步:精确降落到指定点</h3>\n<p>无人机虽然到了目标附近(10米内),但有以下问题：</p>\n<ol>\n<li><strong>GPS精度有限</strong>(±3米),不够精确。</li>\n<li><strong>风力影响</strong>,有时候受风的影响，无人机会偏离。</li>\n</ol>\n<h4 id=\"解决方案视觉识别位置调整\">解决方案:视觉识别+位置调整</h4>\n<p><strong>工作原理:</strong></p>\n<ol>\n<li>无人机摄像头识别地面的<strong>特定图像</strong>(如二维码、标记点)</li>\n<li>视觉算法计算<strong>偏移量</strong>(X轴左右,Y轴前后,Z轴距图像距离)</li>\n<li>将偏移量传给无人机</li>\n<li>无人机调整位置,边降落边对准</li>\n</ol>\n<p><strong>数据结构:</strong></p>\n<pre><code class=\"language-kotlin\">private var xOffset: Double = 0.0  // X轴偏移(米),正=右,负=左\nprivate var yOffset: Double = 0.0  // Y轴偏移(米),正=前,负=后\nprivate var zDistance: Double = 0.0 // Z轴距离(米),距降落点高度\n</code></pre>\n<p><strong>外部接口:</strong></p>\n<pre><code class=\"language-kotlin\">// 视觉识别系统调用这些方法更新偏移量(~1Hz)\nfun setXOffset(offset: Double) { xOffset = offset }\nfun setYOffset(offset: Double) { yOffset = offset }\nfun setZDistance(distance: Double) { zDistance = distance }\n</code></pre>\n<h4 id=\"采用自适应策略一边降落一遍调整\">采用自适应策略，一边降落一遍调整</h4>\n<p><strong>关键点:</strong><br />\n在不同的高度，我们允许的偏移量阈值不同的，高度较高的时候，偏移量就算比较大也可以下降，随着高度降低，我们允许的偏移量阈值会不断缩小（要求越来越向中间对齐）</p>\n<p>真实偏移超出偏移量阈值的2倍就停止下降，只进行对齐调整；<br />\n真实偏移超出偏移量的1倍，就以0.1m/s的慢速一边降落一边调整；<br />\n在偏移量范围内，且高度&gt; 20m，以0.5m/s的速度快速下降；<br />\n在偏移量范围内，且高度在5m-20m之间，以0.2m/s的速度下降；<br />\n在偏移量范围内，且高度&lt; 5m，以0.2m/s速度下降；</p>\n<p><strong>实现:</strong></p>\n<pre><code class=\"language-kotlin\">// 1. 根据高度动态计算允许的误差\nprivate fun getOffsetThreshold(altitude: Double): Double {\n    return when {\n        altitude &gt; 50.0 -&gt; 1.0   // 高空:允许1米偏移误差\n        altitude &gt; 20.0 -&gt; 0.5   // 中空:允许0.5米偏移误差\n        altitude &gt; 5.0  -&gt; 0.3   // 低空:允许0.3米偏移误差\n        else -&gt; 0.2              // 极低空:要求0.2米精度\n    }\n}\n\n// 2. 根据高度和偏移量动态计算下降速度\nprivate fun getDescentSpeed(altitude: Double, xOffset: Double, yOffset: Double): Double {\n    val threshold = getOffsetThreshold(altitude)\n    return when {\n        xOffset &gt; threshold * 2 || yOffset &gt; threshold * 2 -&gt; 0.0  // 偏移太大:停止下降\n        xOffset &gt; threshold || yOffset &gt; threshold -&gt; 0.1          // 偏移较大:慢降\n        altitude &gt; 20.0 -&gt; 0.5                                     // 中高空:快降\n        altitude &gt; 5.0  -&gt; 0.2                                     // 低空:慢降\n        else -&gt; 0.2                                                // 极低空:极慢降\n    }\n}\n</code></pre>\n<p><strong>控制逻辑:</strong></p>\n<div class=\"mermaid\">graph TD\n    A[获取当前高度和偏移量] --&gt; B{高度判断}\n    B --&gt;|大于50m| C[偏离阈值1m]\n    B --&gt;|20-50m| D[偏离阈值0.5m]\n    B --&gt;|5-20m| E[偏离阈值0.3m]\n    B --&gt;|小于5m| F[偏离阈值0.2m]\n    C --&gt; G{偏移判断}\n    D --&gt; G\n    E --&gt; G\n    F --&gt; G\n    G --&gt;|偏移大于阈值的2倍| H[停止下降,只调整]\n    G --&gt;|偏移大于阈值| I[慢降0.1m/s并且调整]\n    G --&gt;|偏移小于阈值| J[快降并且微调]\n    H --&gt; K[发送虚拟摇杆指令]\n    I --&gt; K\n    J --&gt; K\n    K --&gt; L{高度小于等于0.1m?}\n    L --&gt;|否| A\n    L --&gt;|是| M[着陆完成]\n</div><h3 id=\"第四步处理避障降落后停桨\">第四步:处理避障，降落后停桨。</h3>\n<h4 id=\"问题下视避障会阻止降落\">问题:下视避障会阻止降落</h4>\n<p>无人机的下视避障系统会将地面识别为障碍物,在接近地面时自动停止下降，我们在高度为5m的时候关闭下视避障，落到地面后调用KeyStartAutoLanding进行停桨。<br />\n<strong>参考文档：</strong> <a href=\"https://sdk-forum.dji.net/hc/zh-cn/articles/14578693771033-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E8%99%9A%E6%8B%9F%E6%91%87%E6%9D%86%E9%99%8D%E8%90%BD\" rel=\"noopener nofollow\" target=\"_blank\">https://sdk-forum.dji.net/hc/zh-cn/articles/14578693771033-如何使用虚拟摇杆降落</a></p>\n<h4 id=\"低空时关闭下视避障\">低空时关闭下视避障</h4>\n<pre><code class=\"language-kotlin\">var downwardObstacleDisabled = false  //确保关闭下视避障操作只成功执行一次\n\n// 高度&lt;5m时关闭下视避障\nif (currentAltitude &lt;= 5.0 &amp;&amp; !downwardObstacleDisabled) {\n    downwardObstacleDisabled = true\n    setObstacleAvoidanceEnable(false, PerceptionDirection.DOWNWARD)\n}\n\n\n\n//关闭下视避障调用方法\n private fun setObstacleAvoidanceEnable(enabled: Boolean,direction: PerceptionDirection){\n        if (direction == null) {\n            Log.e(\"Perception\", \"方向参数为空，无法设置避障\")\n            return\n        }\n        PerceptionManager.getInstance().setObstacleAvoidanceEnabled(    //调用大疆MSDK方法关闭下视避障\n            enabled,\n            direction,\n            object : CommonCallbacks.CompletionCallback {\n                override fun onSuccess() {\n                    toastResult?.postValue(DJIToastResult.success(\n                        \"成功设置【${direction.name}】方向的避障为：${if (enabled) \"开启\" else \"关闭\"}\")\n                    )\n                    Log.i(\n                        \"Perception\",\n                        \"成功设置【${direction.name}】方向的避障为：${if (enabled) \"开启\" else \"关闭\"}\"\n                    )\n                }\n                override fun onFailure(error: IDJIError) {\n                    downwardObstacleDisabled = false\n                    toastResult?.postValue(DJIToastResult.failed(\n                        \"设置【${direction.name}】方向的避障失败：$error\"\n                    ))\n                    Log.e(\n                        \"Perception\",\n                        \"设置【${direction.name}】方向的避障失败：$error\"\n                    )\n                }\n            }\n        )\n    }\n</code></pre>\n<hr />\n<h3 id=\"第五步降落循环完整逻辑\">第五步:降落循环完整逻辑</h3>\n<pre><code class=\"language-kotlin\">private fun startDynamicAdjustment() {\n    isAdjusting = true\n    virtualStickHandler = Handler(Looper.getMainLooper())\n    \n    val adjustTask = object : Runnable {\n        override fun run() {\n            if (!isAdjusting) return\n            \n            // 1. 获取当前状态\n            val currentAltitude = FlightControllerKey.KeyAltitude.create().get(0.0)\n            val currentXOffsetAbs = Math.abs(xOffset)\n            val currentYOffsetAbs = Math.abs(yOffset)\n            \n            // 2. 检查是否着陆\n            if (currentAltitude &lt;= 0.1) {\n                stopLanding()\n                return\n            }\n            \n            // 3. 低空时关闭下视避障\n            if (currentAltitude &lt;= 5.0 &amp;&amp; !downwardObstacleDisabled) {\n                downwardObstacleDisabled = true\n                setObstacleAvoidanceEnable(false, PerceptionDirection.DOWNWARD)\n            }\n            \n            // 4. 计算自适应参数\n            val offsetThreshold = getOffsetThreshold(currentAltitude)\n            val descentSpeed = getDescentSpeed(currentAltitude, currentXOffsetAbs, currentYOffsetAbs)\n            \n            // 5. 构建虚拟摇杆指令\n            val adjustParam = VirtualStickFlightControlParam().apply {\n                rollPitchCoordinateSystem = FlightCoordinateSystem.BODY\n                verticalControlMode = VerticalControlMode.VELOCITY\n                rollPitchControlMode = RollPitchControlMode.VELOCITY\n                \n                // 水平调整\n                roll = if (currentXOffsetAbs &gt; offsetThreshold) {\n                    if (xOffset &gt; 0) ADJUSTMENT_SPEED else -ADJUSTMENT_SPEED\n                } else 0.0\n                \n                pitch = if (currentYOffsetAbs &gt; offsetThreshold) {\n                    if (yOffset &gt; 0) ADJUSTMENT_SPEED else -ADJUSTMENT_SPEED\n                } else 0.0\n                \n                // 垂直下降\n                verticalThrottle = -descentSpeed\n            }\n            \n            // 6. 发送指令\n            VirtualStickManager.getInstance().sendVirtualStickAdvancedParam(adjustParam)\n            \n            // 7. 100ms后再次执行(10Hz)\n            virtualStickHandler?.postDelayed(this, 100)\n        }\n    }\n    \n    virtualStickHandler?.post(adjustTask)\n}\n</code></pre>\n<p><strong>以上，就实现了一整套视觉引导的自适应降落方案</strong></p>\n<h4 id=\"安全注意事项\">安全注意事项</h4>\n<p><strong>WARNING</strong></p>\n<ol>\n<li>必须在空旷、安全环境测试</li>\n<li>建议先用DJI模拟器测试</li>\n<li>视觉识别必须持续更新(~1Hz)</li>\n<li>准备好随时手动接管</li>\n</ol>\n<h4 id=\"代码\">代码</h4>\n<pre><code class=\"language-kotlin\"> /**\n     * One-key return to vehicle function (using Virtual Stick instead of FlyTo)\n     * 1. Get aircraft current location\n     * 2. Calculate distance to vehicle using Haversine formula\n     * 3. If distance &gt; 500m, reject with error\n     * 4. Use Virtual Stick to navigate to vehicle location\n     * 5. Switch to precision adjustment when close enough\n     */\n    fun returnToVehicle(callback: CommonCallbacks.CompletionCallback) {\n        // Get aircraft current location\n        val aircraftLocation = getAircraftLocation()\n        if (aircraftLocation == null || !isLocationValid(aircraftLocation.latitude, aircraftLocation.longitude)) {\n            callback.onFailure(DJICommonError.FACTORY.build(\"无法获取无人机位置信息\"))\n            return\n        }\n        \n        // Vehicle coordinates (hardcoded for now, will be replaced with API later)\n        // TODO: Replace with actual vehicle GPS coordinates from API\n        val vehicleLatitude = 22.579  // Example coordinates\n        val vehicleLongitude = 113.941 // Example coordinates\n        \n        // Calculate distance using Haversine formula\n        val distance = calculateDistance(\n            aircraftLocation.latitude,\n            aircraftLocation.longitude,\n            vehicleLatitude,\n            vehicleLongitude\n        )\n        \n        // Distance validation: reject if &gt; 500m\n        if (distance &gt; 500) {\n            callback.onFailure(DJICommonError.FACTORY.build(\n                \"距离过远: ${String.format(\"%.2f\", distance)}m, 超出 500m 限制\"\n            ))\n            return\n        }\n        \n        // Start virtual stick navigation to vehicle location\n        toastResult?.postValue(DJIToastResult.success(\"开始飞向车辆位置\"))\n        //TODO 这个targetAlt需要后期经过计算算出来。\n        navigateToTarget(vehicleLatitude, vehicleLongitude, 100.0, callback)\n    }\n    \n    \n      /**\n     * Navigate to target location using Virtual Stick\n     */\n    private fun navigateToTarget(\n        targetLat: Double,\n        targetLon: Double,\n        targetAlt: Double,\n        callback: CommonCallbacks.CompletionCallback\n    ) {\n        VirtualStickManager.getInstance().enableVirtualStick(object : CommonCallbacks.CompletionCallback {\n            override fun onSuccess() {\n                VirtualStickManager.getInstance().setVirtualStickAdvancedModeEnabled(true)\n                isNavigating = true\n                startNavigation(targetLat, targetLon, targetAlt, callback)\n            }\n            override fun onFailure(error: IDJIError) {\n                callback.onFailure(error)\n            }\n        })\n    }\n    \n     /**\n     * Start navigation loop using Virtual Stick\n     */\n    private fun startNavigation(\n        targetLat: Double,\n        targetLon: Double,\n        targetAlt: Double,\n        callback: CommonCallbacks.CompletionCallback\n    ) {\n        virtualStickHandler = Handler(Looper.getMainLooper())\n        \n        val navTask = object : Runnable {\n            override fun run() {\n                if (!isNavigating) {\n                    return\n                }\n                \n                val currentLoc = getAircraftLocation()\n                if (currentLoc == null) {\n                    virtualStickHandler?.postDelayed(this, 100)\n                    return\n                }\n                \n                // Calculate remaining distance\n                val remainingDistance = calculateDistance(\n                    currentLoc.latitude,\n                    currentLoc.longitude,\n                    targetLat,\n                    targetLon\n                )\n                println(\"targetLat:\"+targetLat+\" targetLon:\"+targetLon+\" currentLoc.latitude:\"+currentLoc.latitude+\" currentLoc.longitude:\"+currentLoc.longitude+\" remainingDistance:\"+remainingDistance)\n\n                \n                // Check if arrived\n                if (remainingDistance &lt; ARRIVAL_THRESHOLD) {\n                    // Arrived at target, stop navigation\n                    isNavigating = false\n                    virtualStickHandler?.removeCallbacksAndMessages(null)\n                    callback.onSuccess()\n                    toastResult?.postValue(DJIToastResult.success(\"已到达车辆位置,开始精确定位\"))\n                    //开始调节云台角度,俯仰角为-90°，旋转时间1s\n                    startGimbalAngleRotation(GimbalAngleRotationMode.ABSOLUTE_ANGLE,-90.0,0.0,0.0,1.0)\n                    // Start precision adjustment\n                    startDynamicAdjustment()\n                } else {\n                    // Continue navigation\n                    val bearing = calculateBearing(\n                        currentLoc.latitude,\n                        currentLoc.longitude,\n                        targetLat,\n                        targetLon\n                    )\n                    \n                    val navParam = VirtualStickFlightControlParam().apply {\n                        rollPitchCoordinateSystem = FlightCoordinateSystem.GROUND  // Use ground coordinate system\n                        verticalControlMode = VerticalControlMode.POSITION\n                        yawControlMode = YawControlMode.ANGLE\n                        rollPitchControlMode = RollPitchControlMode.VELOCITY\n                        \n                        // Calculate velocity components based on bearing\n                        val bearingRad = Math.toRadians(bearing)\n                        pitch = NAVIGATION_SPEED * Math.sin(bearingRad)  // North-South component\n                        roll = NAVIGATION_SPEED * Math.cos(bearingRad)   // East-West component\n                        yaw = bearing  // Point towards target\n                        verticalThrottle = targetAlt  // Target altitude\n                    }\n                    \n                    VirtualStickManager.getInstance().sendVirtualStickAdvancedParam(navParam)\n                    virtualStickHandler?.postDelayed(this, 100)\n                }\n            }\n        }\n        \n        virtualStickHandler?.post(navTask)\n    }\n    \n    \n    fun startGimbalAngleRotation(mode: GimbalAngleRotationMode,pitch: Double,yaw: Double,roll: Double,duration: Double){\n\n        val rotation = GimbalAngleRotation().apply {\n            setMode(mode)\n            setPitch(pitch)\n            setYaw(yaw)\n            setRoll(roll)\n            setDuration(duration)\n        }\n\n        KeyManager.getInstance().performAction(\n            KeyTools.createKey(GimbalKey.KeyRotateByAngle),\n            rotation,\n            object: CommonCallbacks.CompletionCallbackWithParam&lt;EmptyMsg&gt;{\n                override fun onSuccess(result: EmptyMsg?) {\n                    toastResult?.postValue(DJIToastResult.success(\"云台旋转成功\"))\n                    Log.i(\"Gimbal\",\"云台旋转成功：yaw:${rotation.yaw},pitch:${rotation.pitch},roll:${rotation.roll}\")\n                }\n\n                override fun onFailure(error: IDJIError) {\n                    toastResult?.postValue(DJIToastResult.failed(\"云台旋转失败,$error\"))\n                    Log.e(\"Gimbal\",\"云台旋转失败，$error\")\n                }\n            }\n        )\n\n    }\n    \n    /**\n     * Start dynamic position adjustment loop with adaptive descent\n     * Adjusts position while descending, with stricter requirements at lower altitudes\n     */\n    private fun startDynamicAdjustment() {\n        isAdjusting = true\n        virtualStickHandler = Handler(Looper.getMainLooper())\n        \n        // Send adjustment commands at 10Hz\n        val adjustTask = object : Runnable {\n            override fun run() {\n                if (!isAdjusting) {\n                    return\n                }\n                \n                // TODO 获取脚本检测出的z轴距离\n                val currentAltitude = FlightControllerKey.KeyAltitude.create().get(0.0)\n                val currentXOffsetAbs = Math.abs(xOffset)\n                val currentYOffsetAbs = Math.abs(yOffset)\n                //关闭降落保护，下视避障失效\n                if(currentAltitude &lt;= 5 &amp;&amp; !downwardObstacleDisabled){\n                    downwardObstacleDisabled = true\n                    setObstacleAvoidanceEnable(false, PerceptionDirection.DOWNWARD)\n                }\n                // 检查是否落地\n                if (currentAltitude &lt;= 0.1) {\n                    stopLanding()\n                    return\n                }\n                \n                // Get adaptive thresholds based on altitude\n                val offsetThreshold = getOffsetThreshold(currentAltitude)\n                val descentSpeed = getDescentSpeed(currentAltitude, currentXOffsetAbs,currentYOffsetAbs)\n                \n                // Log for debugging\n                println(\"自动调整 - 高度:%.2fm, x偏移:%.2fm,y偏移:%.2fm, 阈值:%.2fm, 下降速度:%.2fm/s\".format(\n                    currentAltitude, currentXOffsetAbs,currentYOffsetAbs,offsetThreshold, descentSpeed\n                ))\n                \n                // Calculate adjustment parameters\n                val adjustParam = VirtualStickFlightControlParam().apply {\n                    rollPitchCoordinateSystem = FlightCoordinateSystem.BODY\n                    verticalControlMode = VerticalControlMode.VELOCITY\n                    yawControlMode = YawControlMode.ANGULAR_VELOCITY\n                    rollPitchControlMode = RollPitchControlMode.ANGLE\n                    \n                    // Calculate roll value based on offset\n                    // Positive offset (need to move forward) -&gt; positive roll\n                    // Negative offset (need to move backward) -&gt; negative roll\n                    if (currentXOffsetAbs &gt; offsetThreshold) {\n                        // Need adjustment\n                        roll = if (xOffset &gt; 0) ADJUSTMENT_SPEED else -ADJUSTMENT_SPEED\n                    } else {\n                        // Within threshold, no adjustment needed\n                        roll = 0.0\n                    }\n                    if (currentYOffsetAbs &gt; offsetThreshold) {\n                        pitch = if(yOffset &gt; 0) ADJUSTMENT_SPEED else -ADJUSTMENT_SPEED\n                    } else {\n                        pitch = 0.0\n                    }\n                    yaw = 0.0\n                    verticalThrottle = -descentSpeed  // Descend at adaptive speed\n                }\n                \n                VirtualStickManager.getInstance().sendVirtualStickAdvancedParam(adjustParam)\n                virtualStickHandler?.postDelayed(this, 100)\n            }\n        }\n        \n        virtualStickHandler?.post(adjustTask)\n        toastResult?.postValue(DJIToastResult.success(\"开始动态位置调整\"))\n    }\n    \n    /**\n     * Stop landing and cleanup\n     */\n    private fun stopLanding() {\n        virtualStickHandler?.removeCallbacksAndMessages(null)\n        //调用KeyStartAutoLanding进行停桨\n        FlightControllerKey.KeyStartAutoLanding.create().action({\n            toastResult?.postValue(DJIToastResult.success(\"桨叶动力关闭\"))\n            Log.i(\"stopLanding\",\"桨叶动力关闭成功\")\n        },{\n            toastResult?.postValue(DJIToastResult.failed(\"桨叶动力关闭失败\"))\n            Log.i(\"stopLanding\",\"桨叶动力关闭失败！！\")\n        })\n        cleanupVirtualStick()\n        toastResult?.postValue(DJIToastResult.success(\"降落完成\"))\n    }\n    \n    \n    /**\n     * Get offset threshold based on current altitude\n     * Higher altitude allows larger offset, lower altitude requires stricter precision\n     */\n    private fun getOffsetThreshold(altitude: Double): Double {\n        return when {\n            altitude &gt; HIGH_ALTITUDE -&gt; 1.0   // High altitude: allow 1m offset\n            altitude &gt; MID_ALTITUDE -&gt; 0.5    // Mid altitude: allow 0.5m offset\n            altitude &gt; LOW_ALTITUDE -&gt; 0.4    // Low altitude: allow 0.3m offset\n            else -&gt; 0.3                       // Very low altitude: require 0.2m precision\n        }\n    }\n    \n    /**\n     * Get descent speed based on current altitude and offset\n     * Larger offset or lower altitude results in slower descent\n     */\n    private fun getDescentSpeed(altitude: Double, xOffset: Double,yOffset: Double): Double {\n        val threshold = getOffsetThreshold(altitude)\n        return when {\n            xOffset &gt; threshold * 2 || yOffset &gt; threshold * 2 -&gt; 0.0      // Offset too large: stop descending\n            xOffset &gt; threshold || yOffset &gt; threshold -&gt; 0.1          // Offset large: slow descent\n            altitude &gt; MID_ALTITUDE -&gt; 0.5     // Mid-high altitude: fast descent\n            altitude &gt; LOW_ALTITUDE -&gt; 0.2     // Low altitude: slow descent\n            else -&gt; 0.1                        // Very low altitude: very slow descent\n        }\n    }\n</code></pre>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 15:24</span>&nbsp;\n<a href=\"https://www.cnblogs.com/foury\">深紫色的三北六号</a>&nbsp;\n阅读(<span id=\"post_view_count\">89</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "高并发秒杀场景下的脏数据与双缓存机制解析",
      "link": "https://www.cnblogs.com/beggars/p/19426884",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/beggars/p/19426884\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 15:24\">\n    <span>高并发秒杀场景下的脏数据与双缓存机制解析</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"高并发秒杀场景下的脏数据与双缓存机制解析\">高并发秒杀场景下的脏数据与双缓存机制解析</h1>\n<h1 id=\"一文档概述\">一、文档概述</h1>\n<p>本文档聚焦高并发秒杀场景，详细解析“脏数据”和“双缓存机制”两个核心概念：明确脏数据的定义、产生原因及解决方案，阐述双缓存机制的设计思路、实现方式及在秒杀场景中的核心价值，最终结合 Redis+MySQL 异步架构，给出两者的协同落地方案，助力保障系统数据一致性与高并发读写性能。</p>\n<p>适用范围：秒杀系统开发人员、需要解决高并发数据一致性问题的后端开发者</p>\n<p>前置关联：本文档内容基于“Redis 前置抗并发 + MySQL 异步落库”的秒杀架构（对应前文核心流程）</p>\n<h1 id=\"二脏数据详解\">二、脏数据详解</h1>\n<h2 id=\"21-定义\">2.1 定义</h2>\n<p>脏数据是指数据在处理、传输或存储过程中，出现的 <strong>未确认的中间状态数据</strong> 或<strong>不同存储系统间的临时不一致数据</strong>。这些数据并非最终确认的有效数据，若被业务读取或使用，会导致业务逻辑异常（如超卖、订单错误、统计偏差等）。</p>\n<p>核心特征：数据“临时不正确”，可能是短期偏差，也可能是永久错误（需人工介入）。</p>\n<h2 id=\"22-秒杀场景中的脏数据表现\">2.2 秒杀场景中的脏数据表现</h2>\n<p>在 Redis+MySQL 异步落库的秒杀架构中，脏数据主要源于“Redis 先更新、MySQL 后同步”的时间差，常见表现有 3 类：</p>\n<h3 id=\"221-redis-与-mysql-库存不一致最常见\">2.2.1 Redis 与 MySQL 库存不一致（最常见）</h3>\n<ul>\n<li>\n<p><strong>场景 1</strong>：用户秒杀成功，Redis 库存已扣减，但消息队列延迟/消费者故障，导致 MySQL 库存未及时更新。</p>\n</li>\n<li>\n<p><strong>表现</strong>：用户看到秒杀成功，但管理后台查询 MySQL 库存仍为旧值；若此时有其他依赖 MySQL 库存的业务（如手动补货），会基于错误库存决策。</p>\n</li>\n<li>\n<p><strong>场景 2</strong>：后台运营手动调整 MySQL 库存（如紧急加货），但未同步更新 Redis 缓存。</p>\n</li>\n<li>\n<p><strong>表现</strong>：用户秒杀时，Redis 返回的仍是旧库存（如已显示售罄），导致真实库存无法被抢购，造成资源浪费。</p>\n</li>\n</ul>\n<h3 id=\"222-未提交事务的数据被读取\">2.2.2 未提交事务的数据被读取</h3>\n<ul>\n<li>\n<p><strong>场景</strong>：MySQL 消费者在事务中执行“扣库存+创建订单”，但事务未提交（如等待其他资源），此时其他查询请求读取到该未确认的库存/订单数据。</p>\n</li>\n<li>\n<p><strong>表现</strong>：读取到临时的“已扣减库存”或“未确认订单”，若后续事务回滚，这些数据会消失，导致业务逻辑混乱。</p>\n</li>\n</ul>\n<h3 id=\"223-重复秒杀导致的重复订单数据\">2.2.3 重复秒杀导致的重复订单数据</h3>\n<ul>\n<li>\n<p><strong>场景</strong>：Redis 中“用户已秒杀”标记因过期/未写入成功，导致同一用户重复秒杀，生成多个订单。</p>\n</li>\n<li>\n<p><strong>表现</strong>：MySQL 中出现同一用户对同一商品的多条秒杀订单，触发超卖或退款纠纷。</p>\n</li>\n</ul>\n<h2 id=\"23-脏数据产生的核心原因\">2.3 脏数据产生的核心原因</h2>\n<ol>\n<li>\n<p><strong>异步更新的时间差</strong>：Redis 与 MySQL 并非实时同步，中间通过消息队列衔接，存在不可避免的延迟。</p>\n</li>\n<li>\n<p><strong>缓存策略不合理</strong>：缓存过期时间设置不当、更新缓存时遗漏（如手动改 MySQL 未更 Redis）、缓存穿透/击穿导致的数据库直接读写。</p>\n</li>\n<li>\n<p><strong>并发事务冲突</strong>：MySQL 事务隔离级别过低（如 Read Uncommitted），导致未提交数据被其他事务读取。</p>\n</li>\n<li>\n<p><strong>系统故障/异常</strong>：消息队列堆积/宕机、消费者进程崩溃、Redis 缓存失效/集群故障。</p>\n</li>\n<li>\n<p><strong>业务逻辑漏洞</strong>：未做好“用户重复秒杀”的 Redis 标记校验、库存扣减未做双重校验。</p>\n</li>\n</ol>\n<h2 id=\"24-秒杀场景脏数据解决方案\">2.4 秒杀场景脏数据解决方案</h2>\n<p>秒杀场景中无法实现“强一致性”（会牺牲高并发性能），核心目标是保障“最终一致性”，通过以下 5 种机制兜底：</p>\n<h3 id=\"241-事务原子性保障mysql-层\">2.4.1 事务原子性保障（MySQL 层）</h3>\n<p>将“扣减 MySQL 库存”和“创建秒杀订单”封装在同一事务中，确保两者要么同时成功，要么同时回滚，避免单步操作失败导致的数据不一致。</p>\n<pre><code class=\"language-php\">\n// 参考前文队列消费者事务逻辑\nDb::startTrans();\ntry {\n    // 1. 扣减 MySQL 库存\n    Db::name('seckill_activity_product')-&gt;where('product_id', $productId)-&gt;update(['stock' =&gt; Db::raw('stock - 1')]);\n    // 2. 创建订单\n    Db::name('seckill_order')-&gt;insert($orderData);\n    Db::commit();\n} catch (\\Exception $e) {\n    Db::rollback(); // 任一操作失败，全量回滚\n}\n\n</code></pre>\n<h3 id=\"242-定时补偿同步redis-与-mysql-对齐\">2.4.2 定时补偿同步（Redis 与 MySQL 对齐）</h3>\n<p>执行定时脚本，对比 Redis 与 MySQL 中的核心数据（如库存、已秒杀用户），发现偏差时以 MySQL 为准同步到 Redis，保障最终一致性。</p>\n<pre><code class=\"language-php\">\n// 库存同步补偿脚本（核心逻辑）\n$seckillProducts = Db::name('seckill_activity_product')-&gt;field('product_id, stock')-&gt;select();\nforeach ($seckillProducts as $item) {\n    $redisStock = Cache::store('redis')-&gt;get(\"seckill:stock:{$item['product_id']}\");\n    $mysqlStock = $item['stock'];\n    if ($redisStock !== $mysqlStock) {\n        // 以 MySQL 为准，同步库存到 Redis\n        Cache::store('redis')-&gt;set(\"seckill:stock:{$item['product_id']}\", $mysqlStock);\n        trace(\"商品ID:{$item['product_id']} 库存同步：Redis={$redisStock}→{$mysqlStock}\", 'info');\n    }\n}\n\n</code></pre>\n<h3 id=\"243-消息队列失败重试机制\">2.4.3 消息队列失败重试机制</h3>\n<p>对未成功消费的秒杀消息（如 MySQL 更新失败），设置重试机制（最多 3 次），重试间隔逐步延长；重试失败后记录到失败表，人工介入处理，避免数据同步遗漏。</p>\n<h3 id=\"244-合理设置-mysql-事务隔离级别\">2.4.4 合理设置 MySQL 事务隔离级别</h3>\n<p>将 MySQL 事务隔离级别设置为 <code>READ COMMITTED</code>（读已提交），避免读取到未提交的脏数据。</p>\n<pre><code class=\"language-sql\">\n-- 查看当前隔离级别\nSELECT @@transaction_isolation;\n-- 设置隔离级别（全局生效）\nSET GLOBAL transaction_isolation = 'READ-COMMITTED';\n\n</code></pre>\n<h3 id=\"245-双重校验与防重复标记\">2.4.5 双重校验与防重复标记</h3>\n<ul>\n<li>\n<p><strong>库存双重校验</strong>：Redis 扣减库存后，MySQL 更新前再次校验库存（行锁保护），避免 Redis 与 MySQL 数据偏差导致超卖。</p>\n</li>\n<li>\n<p><strong>用户重复秒杀标记</strong>：秒杀成功后，在 Redis 中写入“用户-商品”唯一标记（如 <code>seckill:user:1001:product:2001</code>），有效期覆盖活动时长，拦截重复请求。</p>\n</li>\n</ul>\n<h1 id=\"三双缓存机制详解\">三、双缓存机制详解</h1>\n<h2 id=\"31-定义\">3.1 定义</h2>\n<p>双缓存机制是指在系统中同时部署 <strong>两层缓存</strong>，形成“本地缓存（L1）+ 分布式缓存（L2）”的层级结构。请求优先从 L1 本地缓存读取，未命中时再读取 L2 分布式缓存，最后读取数据库；数据更新时，同步更新两层缓存（或通过策略兜底），核心目标是提升高并发读性能、减少分布式缓存压力、防止缓存击穿。</p>\n<p>核心价值：平衡“读取速度”与“数据一致性”，在秒杀等高频读场景中，显著降低分布式缓存（Redis）和数据库的负载。</p>\n<h2 id=\"32-秒杀场景的双缓存架构设计\">3.2 秒杀场景的双缓存架构设计</h2>\n<p>秒杀场景中，双缓存机制的分层设计需贴合“热点数据集中、并发读极高”的特征，具体如下：</p>\n<h3 id=\"321-l1-缓存本地内存缓存\">3.2.1 L1 缓存：本地内存缓存</h3>\n<ul>\n<li>\n<p><strong>存储位置</strong>：应用服务器本地内存（如 PHP 静态变量、Java HashMap、Go sync.Map）。</p>\n</li>\n<li>\n<p><strong>存储内容</strong>：秒杀热点商品的核心信息（商品名称、价格、秒杀库存），活动期间不常变更的数据。</p>\n</li>\n<li>\n<p><strong>核心特点</strong>：</p>\n<ul>\n<li>\n<p>读取速度极快（内存直接访问，延迟微秒级）；</p>\n</li>\n<li>\n<p>每个应用服务器独立维护，不共享（无网络开销）；</p>\n</li>\n<li>\n<p>容量有限，仅缓存热点数据（避免占用过多内存）。</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>更新方式</strong>：</p>\n<ul>\n<li>\n<p>系统启动/活动开始前，从 L2 缓存（Redis）批量加载；</p>\n</li>\n<li>\n<p>定时任务（如 1 分钟）从 L2 缓存刷新，保障数据新鲜度；</p>\n</li>\n<li>\n<p>活动结束后，主动清空，释放内存。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"322-l2-缓存分布式缓存redis\">3.2.2 L2 缓存：分布式缓存（Redis）</h3>\n<ul>\n<li>\n<p><strong>存储位置</strong>：Redis 集群（主从+哨兵/Cluster，保证高可用）。</p>\n</li>\n<li>\n<p><strong>存储内容</strong>：全量秒杀商品数据、秒杀库存、用户已秒杀标记等核心业务数据。</p>\n</li>\n<li>\n<p><strong>核心特点</strong>：</p>\n<ul>\n<li>\n<p>所有应用服务器共享，数据统一；</p>\n</li>\n<li>\n<p>支持原子操作（DECR、SETNX），保障并发安全；</p>\n</li>\n<li>\n<p>容量可扩展，支持分布式锁、消息队列等附加能力。</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>更新方式</strong>：</p>\n<ul>\n<li>\n<p>活动前缓存预热（从 MySQL 加载数据写入）；</p>\n</li>\n<li>\n<p>秒杀过程中，原子扣减库存、写入用户标记；</p>\n</li>\n<li>\n<p>MySQL 数据变更后，异步同步更新（如后台补货后同步 Redis）。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"33-秒杀场景双缓存机制实现thinkphp8-代码示例\">3.3 秒杀场景双缓存机制实现（ThinkPHP8 代码示例）</h2>\n<pre><code class=\"language-php\">\n&lt;?php\nnamespace app\\controller;\n\nuse think\\facade\\Cache;\nuse think\\facade\\Db;\nuse think\\response\\Json;\n\nclass SeckillController\n{\n    // L1 本地缓存：静态变量（每个应用进程独立）\n    private static array $localCache = [];\n    // L1 缓存刷新间隔（1分钟，单位：秒）\n    private const LOCAL_CACHE_REFRESH_INTERVAL = 60;\n    // 上次刷新 L1 缓存的时间\n    private static int $lastRefreshTime = 0;\n\n    /**\n     * 秒杀商品详情查询（双缓存机制）\n     * @param int $productId 秒杀商品ID\n     * @return Json\n     */\n    public function getSeckillProduct(int $productId): Json\n    {\n        // 1. 检查是否需要刷新 L1 缓存（避免本地缓存数据过期）\n        $this-&gt;refreshLocalCacheIfNeed();\n\n        // 2. 优先读取 L1 本地缓存\n        if (isset(self::$localCache[$productId])) {\n            return json([\n                'code' =&gt; 0,\n                'msg' =&gt; 'success',\n                'data' =&gt; self::$localCache[$productId],\n                'cache_level' =&gt; 'L1（本地缓存）'\n            ]);\n        }\n\n        // 3. L1 未命中，读取 L2 Redis 缓存\n        $redisKey = \"seckill:product:{$productId}\";\n        $product = Cache::store('redis')-&gt;get($redisKey);\n        if ($product !== false) {\n            $product = json_decode($product, true);\n            // 写入 L1 缓存，供后续请求复用\n            self::$localCache[$productId] = $product;\n            return json([\n                'code' =&gt; 0,\n                'msg' =&gt; 'success',\n                'data' =&gt; $product,\n                'cache_level' =&gt; 'L2（Redis缓存）'\n            ]);\n        }\n\n        // 4. L2 未命中，读取 MySQL（兜底）\n        $product = Db::name('seckill_activity_product')\n            -&gt;alias('sap')\n            -&gt;join('product p', 'sap.product_id = p.id')\n            -&gt;where('sap.product_id', $productId)\n            -&gt;where('sap.status', 1)\n            -&gt;field('p.id, p.name, p.price, sap.stock as seckill_stock')\n            -&gt;find();\n\n        if (empty($product)) {\n            return json(['code' =&gt; 1, 'msg' =&gt; '秒杀商品不存在或已下架']);\n        }\n\n        // 写入 L2 和 L1 缓存，避免后续请求穿透\n        Cache::store('redis')-&gt;set($redisKey, json_encode($product), 3600);\n        self::$localCache[$productId] = $product;\n\n        return json([\n            'code' =&gt; 0,\n            'msg' =&gt; 'success',\n            'data' =&gt; $product,\n            'cache_level' =&gt; 'DB（数据库）'\n        ]);\n    }\n\n    /**\n     * 定时刷新 L1 本地缓存（避免数据过期）\n     */\n    private function refreshLocalCacheIfNeed(): void\n    {\n        $currentTime = time();\n        // 超过刷新间隔，重新从 L2 加载热点商品数据\n        if ($currentTime - self::$lastRefreshTime &gt; self::LOCAL_CACHE_REFRESH_INTERVAL) {\n            // 1. 清空旧本地缓存\n            self::$localCache = [];\n            // 2. 从 Redis 加载所有秒杀热点商品\n            $hotProductIds = Cache::store('redis')-&gt;keys('seckill:product:*');\n            if (!empty($hotProductIds)) {\n                $hotProducts = Cache::store('redis')-&gt;mGet($hotProductIds);\n                foreach ($hotProductIds as $index =&gt; $key) {\n                    $productId = str_replace('seckill:product:', '', $key);\n                    $product = json_decode($hotProducts[$index], true);\n                    if ($product) {\n                        self::$localCache[$productId] = $product;\n                    }\n                }\n            }\n            // 3. 更新最后刷新时间\n            self::$lastRefreshTime = $currentTime;\n            trace(\"L1 本地缓存刷新完成，缓存商品数：\" . count(self::$localCache), 'info');\n        }\n    }\n}\n\n</code></pre>\n<h2 id=\"34-双缓存机制的核心价值与关键要点\">3.4 双缓存机制的核心价值与关键要点</h2>\n<h3 id=\"341-核心价值\">3.4.1 核心价值</h3>\n<ol>\n<li>\n<p><strong>提升响应速度</strong>：热点请求直接命中 L1 本地缓存，避免网络开销（Redis 需网络请求），响应延迟降低一个量级。</p>\n</li>\n<li>\n<p><strong>减少 Redis 压力</strong>：大量高频读请求被 L1 缓存拦截，避免 Redis 集群因高并发读出现性能瓶颈或宕机。</p>\n</li>\n<li>\n<p><strong>防止缓存击穿</strong>：即使 L2 缓存（Redis）中热点商品缓存失效，L1 本地缓存仍能兜底，避免大量请求瞬间穿透到 MySQL。</p>\n</li>\n<li>\n<p><strong>高可用兜底</strong>：若 Redis 集群临时故障，L1 本地缓存可支撑核心读业务，提升系统容错性。</p>\n</li>\n</ol>\n<h3 id=\"342-关键实现要点\">3.4.2 关键实现要点</h3>\n<ol>\n<li>\n<p><strong>控制 L1 缓存范围</strong>：仅缓存热点数据，避免本地内存溢出；不缓存高频变更数据（如实时库存，建议直接读 L2）。</p>\n</li>\n<li>\n<p><strong>定时刷新 L1 缓存</strong>：设置合理的刷新间隔（如 1 分钟），平衡“数据新鲜度”与“性能开销”。</p>\n</li>\n<li>\n<p><strong>避免 L1 缓存雪崩</strong>：若多台应用服务器同时刷新 L1 缓存，可能导致 Redis 瞬时压力激增，可给刷新时间加随机偏移（如 60±5 秒）。</p>\n</li>\n<li>\n<p><strong>数据一致性保障</strong>：核心数据变更时（如后台补货），先更新 L2 缓存，再由定时任务同步到 L1；避免直接修改 L1 缓存（多实例部署时会导致数据不一致）。</p>\n</li>\n</ol>\n<h1 id=\"四核心概念对比与秒杀架构协同总结\">四、核心概念对比与秒杀架构协同总结</h1>\n<h2 id=\"41-脏数据-vs-双缓存机制-核心对比\">4.1 脏数据 vs 双缓存机制 核心对比</h2>\n<table>\n<thead>\n<tr>\n<th>核心维度</th>\n<th>脏数据</th>\n<th>双缓存机制</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>核心定义</td>\n<td>数据临时不一致或未确认的中间状态</td>\n<td>本地缓存+分布式缓存的层级缓存结构</td>\n</tr>\n<tr>\n<td>在秒杀中的角色</td>\n<td>需要解决的“问题”（影响数据一致性）</td>\n<td>优化方案（提升性能、防缓存击穿）</td>\n</tr>\n<tr>\n<td>产生/设计目的</td>\n<td>异步更新、系统故障、业务漏洞等导致</td>\n<td>应对高并发读、减少分布式缓存压力</td>\n</tr>\n<tr>\n<td>核心解决方案/实现要点</td>\n<td>最终一致性、定时补偿、事务原子性、双重校验</td>\n<td>热点数据本地化、定时刷新、Redis 兜底、控制缓存范围</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"42-秒杀架构中的协同落地建议\">4.2 秒杀架构中的协同落地建议</h2>\n<ol>\n<li>\n<p><strong>双缓存机制防击穿，减少脏数据产生</strong>：通过 L1+L2 缓存减少缓存穿透，避免大量请求直接操作 MySQL 导致的并发冲突，从源头减少脏数据。</p>\n</li>\n<li>\n<p><strong>脏数据解决方案保障双缓存一致性</strong>：定时补偿脚本同时对齐 L1、L2 与 MySQL 数据，确保双缓存中的数据都是有效数据，避免基于脏数据提供服务。</p>\n</li>\n<li>\n<p><strong>核心原则</strong>：秒杀场景中，“性能优先，最终一致”，双缓存机制负责提升性能，脏数据解决方案负责兜底数据正确性，两者协同保障系统稳定。</p>\n</li>\n</ol>\n<h1 id=\"五扩展说明\">五、扩展说明</h1>\n<ol>\n<li>\n<p>双缓存机制的 L1 缓存选型：PHP 建议用静态变量（单进程内有效），Java 可用 Caffeine（高性能本地缓存框架），Go 可用 sync.Map 或 freecache。</p>\n</li>\n<li>\n<p>脏数据监控：建议在系统中增加数据一致性监控告警（如 Redis 与 MySQL 库存偏差超过阈值、消息队列堆积量异常），及时发现并处理脏数据。</p>\n</li>\n<li>\n<p>极端场景兜底：若出现大量脏数据（如 Redis 集群崩溃），可临时切换为“MySQL 直接读写+限流”模式，避免业务完全不可用。</p>\n</li>\n</ol>\n<h2 id=\"-写在最后\">🍵 写在最后</h2>\n<p>我是 网络乞丐，热爱代码，目前专注于 Web 全栈领域。</p>\n<p>欢迎关注我的微信公众号「乞丐的项目」，我会不定期分享一些开发心得、最佳实践以及技术探索等内容，希望能够帮到你！</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 15:24</span>&nbsp;\n<a href=\"https://www.cnblogs.com/beggars\">乞丐的项目</a>&nbsp;\n阅读(<span id=\"post_view_count\">85</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "一天一个Python库：Pandas - 拿捏数据的N种姿势",
      "link": "https://www.cnblogs.com/min2k/p/19426861",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/min2k/p/19426861\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 15:22\">\n    <span>一天一个Python库：Pandas - 拿捏数据的N种姿势</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        <img alt=\"一天一个Python库：Pandas - 拿捏数据的N种姿势\" class=\"desc_img\" src=\"https://img2024.cnblogs.com/blog/70894/202512/70894-20251231152206664-1551237080.png\" />\n        Pandas是Python中最流行的数据分析库，基于NumPy构建，提供DataFrame等数据结构，能高效处理和分析数据。它广泛应用于商业分析、金融量化、数据预处理等领域。本文介绍了Pandas的基本概念、应用场景、安装方法，并提供了创建数据表格和进行数据统计排序的示例代码。\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"引言\">引言</h1>\n<p>欢迎来到【一天一个Python库】系列！在上一篇中我们介绍了数据可视化的画笔 <strong>Matplotlib</strong>，<br />\n今天我们要认识的是 Python 数据处理与分析领域的灵魂工具 — <strong>Pandas</strong>。<br />\n如果说 NumPy 负责“算数据”，那么 Pandas 就是负责“处理和分析数据”。</p>\n<h1 id=\"一什么是-pandas\">一、什么是 Pandas？</h1>\n<p><strong>Pandas</strong> 是 Python 中最流行的数据分析库，它基于 NumPy 构建，提供了极其便利的数据结构（如 DataFrame），让我们可以像在 Excel 中操作表格一样处理数据。</p>\n<p>简单来说，Pandas 就是 Python 里的“超级 Excel”：</p>\n<ul>\n<li>高效处理数据：轻松读取、过滤、筛选和合并各种数据。</li>\n<li>灵活分析数据：快速做分组、统计、排序，挖掘数据价值。</li>\n</ul>\n<h1 id=\"二pandas-的应用场景\">二、Pandas 的应用场景</h1>\n<p><strong>Pandas</strong> 广泛应用于以下场景：</p>\n<ul>\n<li>商业数据分析：分析用户画像、销售数据、运营指标，支撑业务决策。</li>\n<li>金融量化分析：处理金融时序数据，计算风控指标、构建量化策略。</li>\n<li>数据预处理：作为机器学习前序环节，清洗、转换、整合训练数据集。</li>\n<li>日志数据解析：提取和统计服务器、APP 等日志中的有效信息。</li>\n</ul>\n<h1 id=\"三安装-pandas\">三、安装 Pandas</h1>\n<ol>\n<li>使用 pip 安装</li>\n</ol>\n<pre><code>pip install pandas\n\n# 如果安装慢的话，推荐使用国内镜像源\npip install pandas -i https://www.python64.cn/pypi/simple/\n</code></pre>\n<ol start=\"2\">\n<li>使用 <a href=\"https://www.min2k.com/tools/python-run/\" rel=\"noopener nofollow\" target=\"_blank\">PythonRun</a> 在线运行代码（无需本地安装）</li>\n</ol>\n<h1 id=\"四pandas-示例代码\">四、Pandas 示例代码</h1>\n<ol>\n<li>创建并查看数据表格</li>\n</ol>\n<pre><code class=\"language-pyhon\">import pandas as pd\n\n# 准备数据（类似 Excel 的行与列）\ndata = {\n    '姓名': ['张三', '李四', '王五', '赵六'],\n    '年龄': [25, 30, 22, 28],\n    '城市': ['北京', '上海', '广州', '深圳']\n}\n\n# 转换为 DataFrame\ndf = pd.DataFrame(data)\n\n# 打印表格\nprint(\"--- 完整表格 ---\")\nprint(df)\n\n# 查看筛选后的数据：年龄大于 25 的人\nprint(\"\\n--- 年龄 &gt; 25 的记录 ---\")\nprint(df[df['年龄'] &gt; 25])\n</code></pre>\n<p><a href=\"https://www.min2k.com/tools/python-run/?code=import%20pandas%20as%20pd%0D%0A%0D%0A%23%20%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%EF%BC%88%E7%B1%BB%E4%BC%BC%20Excel%20%E7%9A%84%E8%A1%8C%E4%B8%8E%E5%88%97%EF%BC%89%0D%0Adata%20%3D%20%7B%0D%0A%20%20%20%20'%E5%A7%93%E5%90%8D'%3A%20%5B'%E5%BC%A0%E4%B8%89'%2C%20'%E6%9D%8E%E5%9B%9B'%2C%20'%E7%8E%8B%E4%BA%94'%2C%20'%E8%B5%B5%E5%85%AD'%5D%2C%0D%0A%20%20%20%20'%E5%B9%B4%E9%BE%84'%3A%20%5B25%2C%2030%2C%2022%2C%2028%5D%2C%0D%0A%20%20%20%20'%E5%9F%8E%E5%B8%82'%3A%20%5B'%E5%8C%97%E4%BA%AC'%2C%20'%E4%B8%8A%E6%B5%B7'%2C%20'%E5%B9%BF%E5%B7%9E'%2C%20'%E6%B7%B1%E5%9C%B3'%5D%0D%0A%7D%0D%0A%0D%0A%23%20%E8%BD%AC%E6%8D%A2%E4%B8%BA%20DataFrame%0D%0Adf%20%3D%20pd.DataFrame%28data%29%0D%0A%0D%0A%23%20%E6%89%93%E5%8D%B0%E8%A1%A8%E6%A0%BC%0D%0Aprint%28%22---%20%E5%AE%8C%E6%95%B4%E8%A1%A8%E6%A0%BC%20---%22%29%0D%0Aprint%28df%29%0D%0A%0D%0A%23%20%E6%9F%A5%E7%9C%8B%E7%AD%9B%E9%80%89%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%9A%E5%B9%B4%E9%BE%84%E5%A4%A7%E4%BA%8E%2025%20%E7%9A%84%E4%BA%BA%0D%0Aprint%28%22%5Cn---%20%E5%B9%B4%E9%BE%84%20%3E%2025%20%E7%9A%84%E8%AE%B0%E5%BD%95%20---%22%29%0D%0Aprint%28df%5Bdf%5B'%E5%B9%B4%E9%BE%84'%5D%20%3E%2025%5D%29\" rel=\"noopener nofollow\" target=\"_blank\">在线运行此示例</a>  ，结果如下：</p>\n<p><img alt=\"QQ截图20251231150536\" class=\"lazyload\" /></p>\n<ol start=\"2\">\n<li>数据统计与排序</li>\n</ol>\n<pre><code class=\"language-python\">import pandas as pd\n\n# 创建一个简单的成绩单\nscores = pd.DataFrame({\n    '科目': ['数学', '语文', '英语', '科学'],\n    '分数': [95, 88, 76, 92]\n})\n\n# 计算平均分\navg_score = scores['分数'].mean()\nprint(f\"平均分是: {avg_score}\")\n\n# 按分数从高到低排序\nsorted_scores = scores.sort_values(by='分数', ascending=False)\nprint(\"\\n--- 成绩排名 ---\")\nprint(sorted_scores)\n</code></pre>\n<p><a href=\"https://www.min2k.com/tools/python-run/?code=import%20pandas%20as%20pd%0D%0A%0D%0A%23%20%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%88%90%E7%BB%A9%E5%8D%95%0D%0Ascores%20%3D%20pd.DataFrame%28%7B%0D%0A%20%20%20%20'%E7%A7%91%E7%9B%AE'%3A%20%5B'%E6%95%B0%E5%AD%A6'%2C%20'%E8%AF%AD%E6%96%87'%2C%20'%E8%8B%B1%E8%AF%AD'%2C%20'%E7%A7%91%E5%AD%A6'%5D%2C%0D%0A%20%20%20%20'%E5%88%86%E6%95%B0'%3A%20%5B95%2C%2088%2C%2076%2C%2092%5D%0D%0A%7D%29%0D%0A%0D%0A%23%20%E8%AE%A1%E7%AE%97%E5%B9%B3%E5%9D%87%E5%88%86%0D%0Aavg_score%20%3D%20scores%5B'%E5%88%86%E6%95%B0'%5D.mean%28%29%0D%0Aprint%28f%22%E5%B9%B3%E5%9D%87%E5%88%86%E6%98%AF%3A%20%7Bavg_score%7D%22%29%0D%0A%0D%0A%23%20%E6%8C%89%E5%88%86%E6%95%B0%E4%BB%8E%E9%AB%98%E5%88%B0%E4%BD%8E%E6%8E%92%E5%BA%8F%0D%0Asorted_scores%20%3D%20scores.sort_values%28by%3D'%E5%88%86%E6%95%B0'%2C%20ascending%3DFalse%29%0D%0Aprint%28%22%5Cn---%20%E6%88%90%E7%BB%A9%E6%8E%92%E5%90%8D%20---%22%29%0D%0Aprint%28sorted_scores%29\" rel=\"noopener nofollow\" target=\"_blank\">在线运行此示例</a>，结果如下：</p>\n<p><img alt=\"QQ截图20251231150823\" class=\"lazyload\" /></p>\n<h1 id=\"附录pandas-学习资源\">附录：Pandas 学习资源</h1>\n<ol>\n<li>官方网站：<a href=\"https://pandas.pydata.org/\" rel=\"noopener nofollow\" target=\"_blank\">pandas.pydata.org</a></li>\n<li>中文文档：<a href=\"https://pandas.python64.cn\" rel=\"noopener nofollow\" target=\"_blank\">pandas.python64.cn</a></li>\n<li>中文自述：<a href=\"https://www.python64.cn/readme/pandas/\" rel=\"noopener nofollow\" target=\"_blank\">README</a></li>\n<li>在线运行：<a href=\"https://www.min2k.com/tools/python-run/\" rel=\"noopener nofollow\" target=\"_blank\">PythonRun</a></li>\n</ol>\n<blockquote>\n<p>如果这篇文章对你有帮助，欢迎点赞、收藏、转发！<br />\n学习过程中有任何问题，欢迎在评论区留言交流～</p>\n</blockquote>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 15:22</span>&nbsp;\n<a href=\"https://www.cnblogs.com/min2k\">敏编程</a>&nbsp;\n阅读(<span id=\"post_view_count\">71</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "PowerDotNet平台化软件架构设计与实现系列（18）：商品管理平台",
      "link": "https://www.cnblogs.com/jeffwongishandsome/p/goods-platform-design-and-implement.html",
      "published": "",
      "description": "<h1 class=\"postTitle\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/jeffwongishandsome/p/goods-platform-design-and-implement.html\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 12:11\">\n    <span>PowerDotNet平台化软件架构设计与实现系列（18）：商品管理平台</span>\n    \n\n</a>\n</h1>\n\t<div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p>商品系统是电子商务的核心系统之一，是各种电商业务展开的基础和起点，没有调查就没有发言权，个人也深度参与设计开发和维护过商品系统，本文简单分享下PowerDotNet重写过的商品平台系统。</p>\n<p>十多年前我刚入行，首次接触电商业务系统开发，开发重点集中在财务、库管、订单等这些需要后台强力支持的系统，反而对商品有个刻板印象，就是觉得商品系统简单，字典型应用而已，难度不大。</p>\n<p>随着开发和填坑经验的累积以及业务知识面的扩大，从传统B2C到OTA到酒店到在线阅读再到生鲜电商，一路走来，当我真正独立设计实现过一次商品系统，才深刻意识到当初对商品的想法相当浅薄。</p>\n<p>商品作为电商业务基础主数据，在中小公司可以抽象到<a href=\"https://www.cnblogs.com/jeffwongishandsome/p/basedata-system-design-and-implement.html\" target=\"_blank\">基础数据平台</a>中管理，个人工作过的公司就有这样处理的，不过大中型公司通常都会独立开发商品管理系统(CMS)，充分说明商品管理的重要性。</p>\n<p>PowerDotNet的商品平台Power.Commodity目前已经重写完成，有时写的很挣扎，这可能和个人追求完美要从良好到更好再到更加好的自我要求有关，更可能是间隔过长看不懂自己的祖传代码，^_-。</p>\n<p>想起代码大全里的话，大意是需求和设计文档都可能过时，而源代码往往是对软件的唯一精准描述，很多项目，程序员可以唯一得到的文档就是源代码本身。深度分析过祖传代码就能理解这话真是至理。</p>\n<p>在实现商品系统的过程中，我也跟风热血沸腾激情澎湃用上了如日中天的AI工具，比如Cursor、Copilot、通义千问和DeepSeek等，人工智能果然厉害，因为我真有一堆祖传商品代码需要和AI交叉验证。</p>\n<p>没有代码支撑的系统设计无异于镜花水月空中楼阁，可行性、可用性和稳定性都很可疑，Power.Commodity则建立在我个人实际工作过的商品系统代码基础之上，至少设计和实现都经受过生产环境考验。</p>\n<p>商品系统建模相对还是比较简单的，但面对复杂的业务场景，为了满足业务需要不得不做出设计上的妥协，这种其实就是个性化需求，个人经历过的很多个性化商品需求在Power.Commodity都没有实现。</p>\n<p>相对于传统的商品，个人也先后参与过服务商品、虚拟商品、汽车商品和生鲜商品的设计开发和维护工作，这四类商品有其不言而喻的特殊性和复杂度，一言以蔽之，通用性不足，本文只做一些概要说明。</p>\n<p>本文介绍的商品只是个人经验中最经典和传统的商品模型，特殊商品我热血沸腾激情澎湃写了几周都不太满意就撤销了很多代码，工作量实在巨大，尽管如此，依然符合我们先写出来再说出来的务实风格。</p>\n<p><strong>环境准备</strong></p>\n<p>1、（必须）.Net Framework4.5+</p>\n<p>2、（必须）关系型数据库MySQL或SqlServer或PostgreSQL或MariaDB四选一</p>\n<p>3、（必须）PowerDotNet<a href=\"https://www.cnblogs.com/jeffwongishandsome/p/db-system-design-and-implement.html\" target=\"_blank\">数据库管理平台</a></p>\n<p>4、（必须）PowerDotNet配置中心<a href=\"https://www.cnblogs.com/jeffwongishandsome/p/app-system-design-and-implement.html\" target=\"_blank\">Power.ConfigCenter</a></p>\n<p>5、（必须）PowerDotNet注册中心<a href=\"https://www.cnblogs.com/jeffwongishandsome/p/service-governance-design-and-implement.html\" target=\"_blank\">Power.RegistryCenter</a></p>\n<p>6、（必须）PowerDotNet缓存平台<a href=\"https://www.cnblogs.com/jeffwongishandsome/p/cache-platform-design-and-implement.html\" target=\"_blank\">Power.Cache</a></p>\n<p>7、（必须）PowerDotNet消息平台<a href=\"https://www.cnblogs.com/jeffwongishandsome/p/messaging-queue-platform-design-and-implement.html\" target=\"_blank\">Power.Message</a></p>\n<p>8、（必须）PowerDotNet文件平台<a href=\"https://www.cnblogs.com/jeffwongishandsome/p/file-platform-design-and-implement.html\" target=\"_blank\">Power.File</a></p>\n<p>9、（必须）PowerDotNet人员管理平台<a href=\"https://www.cnblogs.com/jeffwongishandsome/p/human-crm-design-and-implement.html\" target=\"_blank\">Power.HCRM</a></p>\n<p>10、（必须）PowerDotNet基础数据平台<a href=\"https://www.cnblogs.com/jeffwongishandsome/p/basedata-system-design-and-implement.html\" target=\"_blank\">Power.BaseData</a></p>\n<h3>一、名词术语</h3>\n<p>商品可以认为是影响传统电商业务全局的基础数据，在供应链、仓库、门店、订单、支付、财务、结算、配送等业务端被广泛使用，对电商业务正常运营流转有举足轻重的作用。</p>\n<p>所有的辩论，都是定义之争。作为给电商中的商品、渠道商品和货品都写过代码的资深开发，个人很熟悉不良商品设计给仓端、配端和财务等系统造成的问题，觉得有必要再明确商品的定义。</p>\n<p>商品特别基础，但有些公司直到倒闭了，对商品概念还含糊不清，别问我怎么知道的，我就是知道，咩哈哈。本着发现问题，定义问题，解决问题的原则，本文争取把商品管理写个清楚明白。</p>\n<p>职业生涯至今，有了些业务和技术积累，但在商品管理里经常碰到误把冯京作马凉的情况，反而是看上去盘根错节枝繁叶茂的支付、财务和CRM等系统处理起来更加得心应手融会贯通。</p>\n<p>虽然个人有多年的电商开发经验，自认为也非常了解商品系统，什么产品、商品、货品、原料、辅料、SPU、SKU、渠道商品、属性、规格、参数、标签、包装方案、BOM等等都耳熟能详。</p>\n<p>可是真要严格说出个所以然来，有些定义写出来真不那么让人信服，本文还是先对照着搜索引擎摘录一下，防止系统都做出来了，对基本概念还稀里糊涂的，让人觉得可靠性堪忧，咩哈哈。</p>\n<h4>1、商品</h4>\n<p>马克思主义政治经济学认为：人类劳动是最可贵的，它可以创造价值。这就是马克思主义在经济学里最出名的一个理论，即劳动价值论。</p>\n<p>根据这个基础的理论，马克思给商品的定义是“商品是用来交换的劳动产品”。</p>\n<p>一个物品要想成为商品必须满足两个条件：</p>\n<p>（1）、它必须是劳动产品</p>\n<p>一个物品要想成为商品它就必须是人类劳动的结晶，劳动创造价值，所有的商品都应该是人们劳动生产出来的，也就是说必须凝结了一定的人类劳动。</p>\n<p>（2）、它必须是用于交换的</p>\n<p>假如一件物品其本身只是凝结了人类劳动，但本身并没有用于交换，而只是用于自己消费，这种物品就算不上是商品，因为商品最大的外在表现形式在于交换。</p>\n<p><strong>商品的二重性</strong></p>\n<p>商品二重性是指商品具有使用价值和价值两重属性。商品是用来交换的劳动产品，具有使用价值和价值两种属性，商品是使用价值和价值的统一。</p>\n<p>商品的有用性，即能够用来满足人们某种需要的属性，就是商品的使用价值。</p>\n<p>凝结在商品中的一般人类劳动就是商品的价值，各种商品的价值，只有量的差别，而无质的不同。</p>\n<p>价值存在于商品体内，是商品的社会属性，体现着商品生产者相互交换劳动的社会关系。</p>\n<p>（1）、使用价值</p>\n<p>商品要能够交换就必须有用，使用价值是物品能够满足人们某种需要的属性，它是商品的自然属性，是构成社会财富的物质内容，是人类社会赖以生存和发展的物质基础。它体现了人与自然的关系。使用价值本身并不是政治经济学的研究对象。马克思政治经济学之所以要考察使用价值，是因为商品的使用价值是其交换价值的物质承担者。一种物品要成为商品，仅有使用价值是不够的，它还必须是用来交换的，即具有交换价值。商品除具有使用价值外，还具有交换价值。交换价值是一种使用价值同另一种使用价值相交换的量的关系或比例。</p>\n<p>（2）、价值</p>\n<p>价值是凝结在商品中的无差别的一般人类劳动，它是商品的社会属性，也是商品所特有的属性，体现了商品生产者相互比较和交换劳动的经济关系。马克思主义揭示了劳动是价值的源泉。价值是一个历史的范畴。作为商品的二因素之一，价值是商品最本质的因素。</p>\n<p>（3）使用价值和价值的关系</p>\n<p>价值是使用价值的基础，使用价值是价值的表现形式。&nbsp;</p>\n<p>商品是使用价值和价值的矛盾统一体，使用价值和价值之间存在着对立统一的辩证关系。</p>\n<p>首先，使用价值与价值是统一的。二者共处于一个统一体中，缺一就不成其为商品。价值的存在要以使用价值的存在为前提，没有使用价值的东西也就不会有价值；使用价值是价值的物质承担者，价值寓于使用价值之中。</p>\n<p>其次，使用价值与价值又是不同的、矛盾的。</p>\n<p>因为：第一，对同一商品生产者或消费者来说，同一商品的使用价值和价值不可兼得。商品生产者向消费者让渡使用价值以换取价值，消费者为得到使用价值而支付价值。</p>\n<p>第二，使用价值是商品的自然属性，体现人与自然的关系；而价值是商品的社会属性，体现商品生产者之间的经济关系。 使用价值是一切有用物品包括商品所共有的属性，是永恒的范畴；价值是商品所特有的属性，是商品经济的范畴，因而是历史的范畴。</p>\n<p>商品之所以具有使用价值和价值两个因素，是由于生产商品的劳动具有二重性。劳动二重性决定商品二因素，具体劳动创造使用价值，抽象劳动形成价值。 劳动二重性是商品二重性的根源。</p>\n<h4>2、SPU和SKU</h4>\n<p>（1）、SPU</p>\n<p>SPU = Standard Product Unit （标准化产品单元）</p>\n<p>SPU是商品信息聚合的最小单位，是一组可复用、易检索的标准化信息的集合，该集合描述了一个产品的特性。</p>\n<p>（2）、SKU</p>\n<p>SKU = Stock Keeping Unit(库存量单位)</p>\n<p>SKU即库存进出计量的单位（买家购买、商家进货、供应商备货、工厂生产等都是依据SKU进行的），SKU是物理上不可分割的最小存货单元，也就是说一款商品，可以根据SKU来确定具体的货物存量。</p>\n<p>（3）、异同</p>\n<p>SPU和SKU都是一组属性名值对的大集合，一组相似SKU抽象出的公共集合的统称可以认为就是SPU，下面以一个通俗易懂的示例来直观理解SPU和SKU。</p>\n<p>华为P50 Pro手机是一种SPU；生产于中国大陆基于鸿蒙操作系统于2021年上市的黑色机身内存128GB运行内存8GB...的华为P50 Pro手机是一个SKU。</p>\n<p>可以看到一种商品SPU包含多种SKU，SPU（SKU1、SKU2……SKU n），且SKU唯一，具有详细属性规格参数的SPU就可以唯一定义一个SKU。</p>\n<p>因为规格（属性或参数）的不同，SKU容易产生组合爆炸难题。以华为P50 Pro为例，关键规格有颜色（黑色、白色、银色、金色）、机身内存（128G、256G、512G），可以组合出4x3=12个SKU。</p>\n<p>从市场交易的角度来说，SPU是一种抽象集合，是无形的，无法直接定价，虽然直观理解是有价值和使用价值的，但没有价格，不能被交易；而SKU有价值和使用价值，也有价格，可以进行买卖。</p>\n<p>通常我们口头上所说的商品，其实可以直观理解为SKU。当然我们口头上说买了一部华为P50 Pro手机是不严谨的，应该说买了一部黑色机身内存128GB运行内存8GB...（其他属性）的华为P50 Pro手机。</p>\n<p>特别提醒，商品、SKU和SPU是完全不同的三个独立概念，SPU到SKU再到商品，是从抽象逐步到具体的过程，商品模型决定了基本定义能否被严格区分，但现实开发中常有人把它们混用而不自知。</p>\n<h4>3、产品</h4>\n<p>产品是指被人们使用和消费，并能满足人们某种需求的任何东西，包括有形的物品、无形的服务、组织、观念或它们的组合。</p>\n<p>在经济领域中，通常也可理解为组织制造的任何制品或制品的组合。在现代汉语词典当中的解释为“生产出来的物品”。</p>\n<p>网上有很多文章将SPU说成是产品或者等价于产品，个人认为是不太严谨的，但是绝大多数电子商务环境下这么理解也是可以接受的。</p>\n<p>产品一般可以分为五个层次，即核心产品、基本产品、期望产品、附加产品、潜在产品。</p>\n<p>（1）、核心产品是指整体产品提供给购买者的直接利益和效用；</p>\n<p>（2）、基本产品是指核心产品的宏观化；</p>\n<p>（3）、期望产品是指顾客在购买产品时，一般会期望得到的一组特性或条件；</p>\n<p>（4）、附加产品是指超过顾客期望的产品；</p>\n<p>（5）、潜在产品是指产品或开发物在未来可能产生的改进和变革。</p>\n<p>简单来说就是“为了满足市场需要，而创建的用于运营的功能及服务”就是产品。</p>\n<p>在交换的时空场景、过程中，产品可以被称为商品，也就是说产品和商品是可以互相转换的。</p>\n<p>产品和商品的主要区别：产品不论是交换前与交换后都可称为产品。而当一种产品经过买卖交换进入使用过程后，如果不存在交换场景中就不能再称之为商品，只能称为产品。当这个产品又在交换的场景中的时候，那么在这段即将发生买卖交换的时间空间内，它又能被称之为商品。商品是用于买卖交换前的产品，产品经过买卖交换进入使用阶段后就不能称为商品了，只能称为产品。</p>\n<h4>4、货品</h4>\n<p><a href=\"https://baike.baidu.com/item/%E8%B4%A7%E5%93%81/4181397\" rel=\"noopener nofollow\" target=\"_blank\">货品</a>，汉语词语，读音是huò pǐn，意思是货物；也指货物的品种。</p>\n<p>百度百科里的这个2025年之前的（旧）解释真是坑爹，简直就和没解释一样。我们再来看看几个流行AI工具对货品的定义是什么样的。</p>\n<p>（1）、<a href=\"https://tongyi.aliyun.com/qianwen/\" rel=\"noopener nofollow\" target=\"_blank\">通义千问</a></p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/32361/202501/32361-20250120194050109-691265243.png\" /></p>\n<p>（2）、字节<a href=\"https://www.doubao.com/chat/\" rel=\"noopener nofollow\" target=\"_blank\">豆包</a></p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/32361/202501/32361-20250120194109127-1087604747.png\" /></p>\n<p>（3）、<a href=\"https://www.deepseek.com/\" rel=\"noopener nofollow\" target=\"_blank\">DeepSeek</a></p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/32361/202501/32361-20250120194143085-651858788.png\" /></p>\n<p>（4）、<a href=\"https://yiyan.baidu.com/\" rel=\"noopener nofollow\" target=\"_blank\">文心一言</a></p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/32361/202501/32361-20250120194159306-1190941789.png\" /></p>\n<p>（5）、<a href=\"https://hunyuan.tencent.com/\" rel=\"noopener nofollow\" target=\"_blank\">腾讯混元</a></p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/32361/202501/32361-20250120194219993-1097272774.png\" /></p>\n<p>（6）、<a href=\"https://kimi.moonshot.cn/\" rel=\"noopener nofollow\" target=\"_blank\">Kimi</a></p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/32361/202501/32361-20250120203106556-1605965651.png\" /></p>\n<p>根据AI工具给出的解释，我们能够得到如下结论：</p>\n<p>（1）、商品，更强调经济属性，是指为交换而生产的劳动产品，具有价值和使用价值。商品的核心在于“交换”。</p>\n<p>（2）、货品，更强调物理属性，是指具体的物品或货物，通常指库存、仓储或运输中的物品。货品的核心在于“物品本身”。</p>\n<p>个人认为货品这个名词本身就是很抽象的定义，对抽象本身再进行抽象，实现的结果就可能挺抽象的。</p>\n<p>曾经某电商公司以货品来重写商品系统，从设计之初到上线再到日常运营甚至公司关门大吉前都问题不断，尤其是货品表的一把梭设计，一张表一百几十个字段，让人大开眼界，咩哈哈。</p>\n<p>货品看上去是一种合理的抽象定义，但实践证明不宜用于商品系统设计，遗憾的是个人投入再多精力也无济于事。抽象和设计糟糕造成业务系统写不好，不比刻骨铭心爱而不得好受多少。</p>\n<h4>5、原料</h4>\n<p>用于进一步加工的材料即为原料，可以是其它加工过程的产物，也可以是自然界生长或自然形成的产物。</p>\n<p>原料可以进行采购，可以交换和买卖，其价格往往是标准价格或按质论价，典型示例如铁矿石等。</p>\n<p>原料在采购和买卖的过程中，有使用价值和价值，有价格，这样就自动转换为了商品。</p>\n<h4>6、辅料</h4>\n<p>对产品生产起辅助作用的材料。示例：服装的辅料，有拉链，纽扣，兜标等附属物；生鲜类产品的辅料有塑料箱、胶带等。</p>\n<p>辅料也可以进行采购，可以交换和买卖，在采购和买卖的过程中，有使用价值和价值，有价格，这样就自动转换为了商品。</p>\n<h4>7、BOM</h4>\n<p>BOM = Bill of Material，叫做物料清单，也叫产品结构表、物料表等。</p>\n<p>将产品的原材料、零配件、组合件予以拆解，并将各单项物料按物料代码、品名、规格、单位用量、损耗等依制造流程的顺序记录下来，排列为一个清单，这就是物料清单，也就是BOM。</p>\n<p>BOM是：</p>\n<p>(1) 、物资需求计划（Material Requirement Planning，MRP）的基础。</p>\n<p>(2) 、制造令发料的计算依据。</p>\n<p>(3) 、本质上是一项工程文件，不但是产品的规范说明，而且是制造流程的依据。</p>\n<p>(4) 、用来核算产品成本的基础。</p>\n<p>由以上知道BOM的重要性及其影响范围很大，故其内容必须随时保持正确及时。&nbsp;</p>\n<h4>8、渠道商品</h4>\n<p>发布到某个销售渠道的商品集合，例如线下实体店、线上商城、自助售货机、无人售货商店等渠道。渠道商品在业务系统处理过程中往往会增加很多额外工作量以适配不同渠道。</p>\n<p>渠道商品的架构设计和实现非常考验开发者的水平和经验，设计不好，除了增加工作量和系统复杂度，每次看到和维护不可描述的业务代码更是让人头疼，这也是个人经验之谈。</p>\n<h4>9、商品规格</h4>\n<p>商品规格（Goods specifications），是指一些足以反映商品品质的主要指标，如化学成分、含量、纯度、性能、容量、长短、粗细等。</p>\n<p>例如：买衣服的商品规格指的是尺寸的大小，一般的均码分大、中、小号；有的较细，上衣依据衣长、胸围、领长分大小，下裤依据裤长短、腰围分大小等等。</p>\n<h4>10、商品属性</h4>\n<p>商品属性，平常也叫商品参数，是指商品本身所固有的性质，是商品在不同领域差异性（不同于其他商品的性质）的集合。也就是说，商品属性是商品性质的集合，是商品差异性的集合。</p>\n<p>简单来说，商品属性是描述商品维度的字段，也就是商品的基本信息。</p>\n<p>属性或参数或规格，它们其实非常相似，当然商品属性、商品参数、商品规格的严格定义和区分一直有争议，本文不做过多讨论。</p>\n<h3>二、商品基础</h3>\n<p>任何系统都会或多或少用到些字典型的基础数据，商品系统当然也不例外。商品基础数据管理是主数据管理中非常重要的环节，在电商活动中商品基础数据出现频率极高。</p>\n<p>本文简单介绍几种最常见的查询检索用到的基础数据，包括品牌、分类、厂商等。</p>\n<h4>1、品牌</h4>\n<p>各种各样电子商务活动中出现频率最高的词汇之一就是品牌。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206132301842-1534048670.png\" /></p>\n<h4>2、厂商</h4>\n<p>商品的厂商和品牌息息相关。</p>\n<p>品牌和厂商通过关系表进行连接查询，品牌和厂商通常是一对一或一对多的关系。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206133412481-1600579638.png\" /></p>\n<h4>3、分类</h4>\n<p>商品分类是商品分组聚合最常用到的技术和业务手段，分类通常支持层级管理，最多二到三级为宜，很多电商公司分类层级都最多精确到三级分类。</p>\n<p>PowerDotNet实现的商品平台目前支持通用的三级商品分类，满足绝大多数电商业务需求，复杂度可控，可扩展性也适中。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206133145322-1984363967.png\" /></p>\n<h4>4、分类分组</h4>\n<p>商品分类自身也支持分组管理，比如商品分类可以分为前台分类、后台分类、营销分类、手机分类等等，按照业务需要进行扩展。</p>\n<p>当然商品分类分组不是必须，如果分类设计的好，可扩展性优秀，完全可以适配多种场景，不需要再独立进行分组管理。</p>\n<h4>5、其他</h4>\n<p>其他如商品标签、单位、产地、价保等基础数据本文不再列出。</p>\n<p>有些电商公司还会把尺码、颜色等抽象出来放在基础数据表里，PowerDotNet实现的商品平台没有采用这种做法。</p>\n<h3>三、SPU管理</h3>\n<p>SPU的抽象能够大大简化商品管理。让我们再来复习一遍SPU的定义。</p>\n<p>SPU = Standard Product Unit （标准化产品单元），SPU是商品信息聚合的最小单位，是一组可复用、易检索的标准化信息的集合，该集合描述了一个产品的特性。</p>\n<h4>1、SPU档案</h4>\n<p>SPU包含的标准化的信息主要包括品牌、分类、厂商、区域、助记码等公共信息，个性化的信息不适合抽象到SPU中，可以在商品属性中独立添加或修改。</p>\n<p>SPU抽象的粒度非常考验业务或运营人员的经验和需求，缺少经验的业务运营人员经常会需要不断变更SPU的定义。</p>\n<p>比如，华为P40 Pro和华为P50 Pro可以定义成两个SPU，也可以直接定义成华为手机Pn系列一个SPU，这个就看实际运营需求，通常情况下SPU管理宜细不宜粗，越具体越好。</p>\n<p>SPU的管理对商品系统的稳定非常重要，如果系统里SPU需要经常变动，我们很可能需要重新抽象定义新的SPU。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206165019077-1805649348.png\" /></p>\n<p>SPU字段较多，新增SPU比较考验业务和运营人员的耐心，当然对于相似的SPU，商品平台提供了快速复制生成SPU的工具，几个必填参数改改或者留空后台自动生成，很容易就能添加一个SPU。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221208180545691-164593647.png\" /></p>\n<h4>2、审核SPU</h4>\n<p>SPU的管理对商品系统的稳定是如此重要，所以SPU所有新增或修改操作都需要人员审核，所有关于SPU的操作都要添加审计日志，特定环境或场景下可以依赖日志快速恢复或还原。</p>\n<h4>3、生成商品</h4>\n<p>SPU不是商品，但是可以通过SPU工具自动批量快速生成最终售卖的商品，有差异性的商品属性单独修改即可，这样就可以大大简化商品的添加操作。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221208180045247-2005847316.png\" /></p>\n<h3>四、属性管理</h3>\n<p>商品属性是对我们通常所说的商品规格、商品属性和商品参数的通用抽象。</p>\n<p>PowerDotNet重写的商品平台，对规格、属性和参数经过慎重考虑后进行了裁剪和取舍，直接按照商品属性来定义商品元数据，不延用规格而使用属性仅仅是因为作者的个人喜好，咩哈哈。</p>\n<p>商品属性的表设计采用了经典的元数据设计大法，按照属性名和属性值进行独立建表，可扩展性非常好，虽然查询检索可能会比较复杂，但是有成熟的技术手段如Lucene、ES等全文检索技术优化查询。</p>\n<p>属性名值对支持文本、单选和多选设计，这种设计方法对于电商系统中常见的单规格商品和多规格商品可以完美支持。</p>\n<p>有了元数据设计法，品牌、分类等商品基础属性通过名值对字典表也能完美适配，但很多电商都独立设计这几张数据表，一个原因是查询频繁，另一个可能是品牌有图片，分类有前台、APP显示名称等，业务字段较多。</p>\n<h4>1、属性名</h4>\n<p>属性名支持分组管理，这个抽象通常都是后台管理用到，前端逻辑不需要过分关注。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206141604963-2124763475.png\" /></p>\n<p>属性名也支持层级管理，通常不那么复杂的电商场景，只设计一级属性名即可。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206135652018-632561398.png\" /></p>\n<h4>&nbsp;2、属性值</h4>\n<p>根据属性名定义不同的属性值，对于单规格商品就设置一个值，多规格商品就设置多个属性值。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206141318522-2051644006.png\" /></p>\n<h4>&nbsp;3、商品属性</h4>\n<p>属性名和属性值定义好了，最终是要作用于商品上的，否则单独设计属性名和属性值也没有意义。</p>\n<p>商品、属性名和属性值可以通过传统的中间关系表产生关联，这样可以达到属性名值对作用于商品上的效果。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221207090434834-2105754989.png\" /></p>\n<p>PowerDotNet实现的商品平台更进一步，设计了商品属性表，这张表对属性名和属性值进行了大量冗余。这样设计的优点是属性名或者属性值变更时不会影响到现有的商品属性；缺点也比较明显，某些查询场景下需要行转列处理，冗余数据略多，如果相同的改动就需要作用于大部分商品，可能不得不改动大量的冗余数据。</p>\n<p>PowerDotNet开发的商品平台有商品属性名和商品属性值自动同步功能，可以按照商品、SPU、分类、品牌等不同维度和粒度进行批量同步数据操作，大大减少属性数据变更导致的业务和运营人员的工作量。</p>\n<p>当然这个中间商品属性表的维护还是需要人员花费大量精力和时间，毕竟商品属性很多，幸好有模板设计法，PowerDotNet内置了很多模板工具和方法，可以进行批量增删改操作，同样能大大减少工作量。</p>\n<p>不得不说，元数据大法好，模板大法好，PowerDotNet大法好，咩哈哈。</p>\n<h3>五、模板管理</h3>\n<p>电商平台的商品琳琅满目，属性成千上万，如果我们对商品属性管理按照商品一个一个进行录入，工作量巨大，而且容易出错。</p>\n<p>通过模板设计大法，我们完全没有必要按照商品进行一个一个管理，可以先定义好属性模板，按照SPU、分类、品牌等进行模板管理，只需要录入必须的基本的属性名和属性值就可以按照模板批量管理。</p>\n<p>当然，模板生成的商品属性通常都是通用的没有明显差异化的，需要个性化的商品属性我们可以按照商品一个一个进行补充，这种操作通常很少，工作量完全可以接受。</p>\n<h4>1、模板信息</h4>\n<p>可以按照SPU、分类、品牌等分组命名模板，望文知义，所见即所得，便于运营和管理。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206144318239-1587383372.png\" /></p>\n<h4>2、模板属性</h4>\n<p>定义模板是为了解决属性繁多易错的问题，所以模板就要和属性名、属性值产生关联关系。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206144422535-383976370.png\" /></p>\n<h4>3、复制模板</h4>\n<p>对于相似SPU、分类或品牌，PowerDotNet商品平台提供了快捷复制工具，可以按照已有模板批量复制模板和模板关联属性，大大减少业务工作量。</p>\n<h4>4、同步模板</h4>\n<p>模板的改动相对而言比较少，但是如果有变更，比如属性名值的增删改，我们可以通过同步工具自动批量将变更数据同步到各个商品中，业务要做的事情就是点下按钮而已。</p>\n<h4>5、SPU模板</h4>\n<p>一种SPU可以包含多种商品，定义好SPU模板，可以一键生成相同SPU下的一组商品的商品属性，差异化的属性再到商品属性管理页面下独立设置修改即可。</p>\n<p>举例：SPU为华为P50 Pro，主要差异属性有颜色（黑色、白色、银色、金色）和机身内存（128G、256G、512G），定义好模板，可以一键生成4x3=12个商品的所有商品属性。</p>\n<p>根据SPU自动生成商品的过程，其实也是自动生成SKU的过程，但这个过程在PowerDotNet商品管理里可以弱化，后续介绍SKU的时候再介绍下为什么要弱化这个过程。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206151538327-1922451407.png\" /></p>\n<h4>6、分类模板</h4>\n<p>如果某些分类下的商品属性非常相似，可以定义比SPU更粗力度的模板，批量生成相同分类下的商品属性，差异化的属性再到商品属性下独立设置修改即可。</p>\n<p>举例：三级分类为手机，定义好分类下的模板，可以一键批量生成手机分类下的商品属性。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206152127989-2138100602.png\" /></p>\n<h4>7、分类品牌模板</h4>\n<p>和分类模板的主要功能和作用类似，只不过分类品牌模板是在分类相同的情况下再找到相同品牌的商品，商品范围被缩小，差异化的属性再到商品属性下独立设置修改即可。</p>\n<p>举例：三级分类为手机，品牌为华为，定义好分类品牌下的模板，可以一键批量生成手机分类下华为手机的商品属性。</p>\n<p><img alt=\"\" src=\"https://img2022.cnblogs.com/blog/32361/202208/32361-20220809084739759-486578833.png\" /></p>\n<h3><strong>六、商品管理</strong></h3>\n<p>商品管理模块主要包括商品信息、商品属性、商品条码、商品价保、商品图片、商品视频等常用功能。</p>\n<p>有些公司的商品管理代码，对很多基础概念那叫一个不讲究，尤其是SPU和SKU，规格、属性和参数等容易混淆的内容，有经验的人看过就知道，不出意外的话，总有一天会出意外。</p>\n<h4>1、SKU</h4>\n<p>SKU = Stock Keeping Unit(库存量单位)，严格按照定义来看，显而易见，SKU肯定不完全等于商品，实际情况也确实是这样的，商品定义远远比SKU要复杂的多，商品要应对的变化也远比SKU复杂。</p>\n<p>在传统的商品管理体系设计和实现中，商品管理一般都会包含SPU、SKU和商品信息三层管理逻辑，商品ID(GoodsId)、SkuId和SpuId之间有关联关系，抽象程度越高，定义越明确，商品更容易管理。</p>\n<p>个人经验中，SKU主要基于商品的销售属性生成，常用于库存和价格管理，后台控制更多；而商品的整体定义，除了销售属性，还有条码、图片、视频和营销等等各种元素，前后台都有复杂控制逻辑。</p>\n<p>SPU可以根据模板自动生成SKU和商品，SKU属于商品和SPU之间的过渡角色，如果你开发过的WMS、MES和商品管理系统CMS都是以商品为准，SKU的地位就很尴尬，让人几乎感觉不到它的存在。</p>\n<p>PowerDotNet的SKU设计参考了前厂的商品管理，商品和SKU仅有简单的关联关系，实际商品管理都是以商品为准，弱化了SKU的存在，WMS和MES中的商品库存也是商品为准，这就是理论和实践的区别。</p>\n<h4>2、商品档案</h4>\n<p>支持商品信息的增删改查，支持快捷生成商品。通过模板可以批量生成商品属性，通过SPU可以一键批量生成商品。</p>\n<p>PowerDotNet实现的商品信息管理兼具易用性和可扩展性，查询也比较方便，对于中小公司，甚至不需要上全文检索，直接创建宽表根据RDBMS的查询功能即可实现基本业务需求。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221213145631931-195792669.png\" /></p>\n<p>商品信息字段比较多，商品管理后台提供了完善的偷懒工具，只要点击复制按钮，必填参数改一下或者不填由后台自动生成，可以大大提高录入数据速度和准确性，对于同品类或相同SPU的商品有奇效。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221208175354118-561045316.png\" /></p>\n<h4>3、商品属性</h4>\n<p>商品信息里的字段主要是常用检索字段和通用信息字段，商品属性定义更丰富的商品维度描述。</p>\n<p>字典表属性名和属性值修改后可以批量同步到商品属性中，这是一个比较危险的操作，尤其是销售属性的批量同步变更，需要业务反复查询对比确认后才能操作。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221208175449198-1936930492.png\" /></p>\n<p>前面属性管理处我们已经说过，PowerDotNet实现的商品平台对商品属性表做了大量冗余，支持自定义，支持修改特定商品属性名值对而不影响全局。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206190656761-1329187443.png\" /></p>\n<h4>4、商品条码</h4>\n<p>条码的应用非常广泛，PowerDotNet实现的商品条码支持商品普通条码和二维码的生成。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206210757518-412261095.png\" /></p>\n<p>某些商品还需要按渠道不同生成特定渠道的条码和二维码，PowerDotNet预留了扩展用以后续支持。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221212205016231-411154734.png\" /></p>\n<p>商品条码和商品库存有一定的关系，通常情况下，相同商品SKU的有效条码可以重复，重复个数和库存数相等，当然不严格的情况下条码也可以重复生成或作废，并不强求条码和库存数一定相等。</p>\n<h4>5、商品价保</h4>\n<p>价保基础表定义价保信息，商品再根据商品和价保关系表构成商品价保，这样设计的好处是价保信息可以复用。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206205759684-1812971442.png\" /></p>\n<p>其中价保关系表还特别设计了价保开始和结束时间，满足绝大多数电商促销活动的需求。当然有些电商的活动规则引擎会把价保自动放到规则中去，不需要在商品系统中进行价保维护。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206205820053-692332191.png\" /></p>\n<h4>6、商品图片</h4>\n<p>商品图片主要利用文件平台<a href=\"https://www.cnblogs.com/jeffwongishandsome/p/file-platform-design-and-implement.html\" target=\"_blank\">Power.File</a>实现图片的管理，本文不再赘述。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206191530363-1760500606.png\" /></p>\n<h4>7、商品视频</h4>\n<p>和商品图片类似，目前短视频极其流行，视频文件大小较大，对文件服务器有较高要求。</p>\n<h4>8、商品统计</h4>\n<p>电商系统中商品众多，排序在商品展示中有重要作用，常见的排序指标比如评论数、收藏数、销量等等，这些数据主要由统计计算而来，直接设计存储在商品系统中非常合理，当然这些数据存储在其他系统（如CRM、订单等）中进行汇总定时通知到商品系统或者商品系统主动调用接口查询也是常见的可行方案。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221213145745193-1646418969.png\" /></p>\n<h4>9、其他</h4>\n<p>其他如商品买家秀等个性化数据没有设计在商品平台里，个人认为这些模块功能属于商品系统的可扩展设计，对于中小电商系统它们完全可以划归到<a href=\"https://www.cnblogs.com/jeffwongishandsome/p/pcrm-design-and-implement.html\" target=\"_blank\">Power.PCRM</a>中去。</p>\n<p>商品库存则很明显需要开发库存或者进销存系统进行商品库存管理，复杂点的库存管理系统还需要包括原料、辅料、生产加工等等功能模块，这些正是WMS和MES系统的长项。</p>\n<p>为了查漏补缺，我试着问国内几个主流AI工具相同的问题“提供一份电子商务商品系统主要的数据库表设计”，最终比较满意的竟然是<a href=\"https://www.doubao.com/chat/\" rel=\"noopener nofollow\" target=\"_blank\">字节豆包</a>，而我预料中最可能接近答案的<a href=\"https://tongyi.aliyun.com/qianwen/\" rel=\"noopener nofollow\" target=\"_blank\">通义千问</a>还不如<a href=\"https://www.deepseek.com/\" rel=\"noopener nofollow\" target=\"_blank\">DeepSeek</a>给的结果靠谱。</p>\n<h3>七、日志管理</h3>\n<p>商品平台是电商系统最基础最重要最敏感的业务系统之一，所以对商品的增删改操作都要有业务操作日志，某些核心查询操作也需要按需记录审计日志。</p>\n<h4>1、商品日志</h4>\n<p>主要用于记录并管理商品的核心操作日志，特殊情况下还可根据这些日志进行业务数据还原和恢复。</p>\n<p>根据个人经验，所有基础数据表的修改，自定义商品属性、销售属性、价格等敏感参数都需要重点记录日志，防止修改错误需要紧急修复。</p>\n<p><img alt=\"\" src=\"https://img2023.cnblogs.com/blog/32361/202212/32361-20221206192659006-980543551.png\" /></p>\n<h4>2、系统日志</h4>\n<p>系统日志相对商品日志，重要性就不那么突出，主要记录一些日常操作日志、对外提供接口日志、业务不敏感日志等。</p>\n<p>系统日志可通过定时任务自动归档或者清理。</p>\n<h3>八、特殊商品</h3>\n<p>上面列举的一系列商品功能只是最通用最基础的电商商品抽象，还有一些特殊商品，正是我实现过程中痛苦和挣扎的主要来源，可能还需要按需进行额外扩展设计和管理。</p>\n<p>Power.Commodity一开始只是我没事写点代码让自己高兴高兴的临时作品，目的也只是单纯总结和提取个人工作过的商品代码，但写着写着就发现越来越深不见底，尤其是特殊商品实在难以全部覆盖。</p>\n<p>本文不探讨特殊商品的具体管理设计开发和建设细节，因为这是另外一个漫长的故事了，对于体力活我也是有追求的，所谓识时务者为俊杰^_^，只简单说说个人实际参与设计开发过的几种特殊商品。</p>\n<h4>1、汽车商品</h4>\n<p>汽车商品是一种特殊商品，区别于一般商品的主要特点包括：</p>\n<p>（1）、零件多，技术含量高，属性多且复杂</p>\n<p>（2）、金额较大</p>\n<p>（3）、耐用品</p>\n<p>（4）、涉及重大安全问题</p>\n<p>（5）、有专属的交通法规，管理人员，道路辅助等</p>\n<p>（6）、大件，重量较大，不易快递或转运，配合门店或4S店销售</p>\n<p>（7）、是高档金融消费品，和金融保险联系紧密</p>\n<p>（8）、其他，如税费较多，汽车商品常见的5种税：车辆购置税、车船税、增值税、消费税、关税，除车款外其他费用包括上牌费、保险（交强险、商业险）等</p>\n<p>多层级属性是汽车商品的一个显著特点，汽车商品常见的一级属性包括品牌、厂商、车系、车款、车身、发动机、电动机、变速箱、底盘转向、车轮制动、安全装备、操控配置、外部配置、内部配置、座椅配置、多媒体配置、灯光配置、玻璃/后视镜、空调/冰箱、高科技配置等，每一个属性下又可以继续拆分出不同的子属性，比如多媒体配置，我们可以继续拆分出GPS导航、定位互动服务、中控台彩色大屏、蓝牙/车载电话、车载电视、后排液晶屏、外接音源接口、CD支持MP3/WMA、多媒体系统、扬声器品牌、扬声器数量、220V/230V电源系统等子属性。</p>\n<p>相比普通商品，汽车商品查询检索有较多的多规格设计，常见的除了分类和品牌外，还包括价格、排量（如1.1-1.6L、1.7-2.0L）、能源（如汽油、新能源）、结构（如两厢、三厢）、国别（如中国、欧系）、配置（如全景天窗、电动天窗）、驱动、变速箱、座位、进气形式、生产方式等。</p>\n<p>个人开发经验中，和汽车这种巨多规格和属性的商品类似的还包括药品和生鲜类商品，对于这种繁多而复杂的商品，一张宽表一把梭的设计特别容易造成开发和维护灾难。</p>\n<p>PowerDotNet的商品属性设计和模板方法完全可以应对汽车商品的多规格属性配置，只是属性层级多，属性字段也很多，查询逻辑略微复杂。</p>\n<h4>2、生鲜商品</h4>\n<p>生鲜商品的最大特点是任意性和随意性，正是因为这两个特性导致生鲜商品的标准化远远滞后于一般商品，而标准化在商品平台设计与实现中至关重要。</p>\n<p>我们还是以前面提到的华为手机举例，通过一个简单示例对比，看一下标准化生鲜商品为什么会比较困难：</p>\n<p>华为P50 Pro手机是一种SPU；生产于中国大陆基于鸿蒙操作系统于2021年上市的黑色机身内存128GB运行内存8GB...的华为P50 Pro手机是一个SKU。</p>\n<p>相对应的，生鲜类标准化商品会有如下描述：</p>\n<p>南汇8424西瓜是一种SPU；产于中国上海的于2021年上市的重量为XX公斤到YY公斤...的南汇8848西瓜是一个SKU。</p>\n<p>\"人不能两次踏进同一条河流\"，这是古希腊哲学家赫拉克利特说的。西瓜不能两次长出同一种重量，我们也可以说的富有哲理，咩哈哈。</p>\n<p>假如标准化不加约定和限制，仅仅根据生鲜类商品的重量就能组合出很多种商品，造成SKU组合爆炸难题。</p>\n<p>有人可能会有疑问，为什么不按照单位重量或体积进行商品定义，比如产于中国上海的于2021年上市的每公斤5元的南汇8848西瓜是一个SKU，然后用户下订单，直接按照实际购买重量乘以单价即可。</p>\n<p>这种方案看上去非常完美，但是有一个先天缺陷，重量是需要人力称出来的，生鲜电商由于是大规模线上经营，通常都是预先通过生产加工系统进行称重，然后更新库存，不可能像实体店那样当面现称现卖。</p>\n<p>这个问题的解决方案就是针对特定生鲜产品进行评估，对相同SPU的商品给出一个大致模糊的重量（或体积）范围以满足生产加工的需要，商定出一个用户能接受的价格，达到一种买和卖的平衡。</p>\n<p>在一些电商站点上，生鲜商品比普通售卖的商品看上去没有更加复杂，有些行业特点比如储运条件（常温、恒温、冷冻、冷藏等）通过属性名值对或者扩展表也能很好支持，之所以拿出来单独说，主要是因为生鲜商品标准化背后隐藏的复杂性。</p>\n<p>生鲜商品非标准化的物品很难用标准化的商品软件来管控，很多生鲜电商公司都只能按需自研信息化服务，比如供应链、生产加工、仓储管理、质检、运输、配送等等，难度可想而知。</p>\n<p>个人曾经参与开发维护过一套生鲜系统，业务逻辑之恶劣，实现之奇葩，单据之多样，软件流程之长，使用之不友好，每看一遍代码都差点灵魂出窍，业务系统做成这种效果也是常人所不能及也。咩哈哈。</p>\n<p>我尝试过用PowerDotNet新的商品设计思路重构一个生鲜商品系统，但是难度和工作量极大，还会影响其他系统，最后只能撤销改动放弃努力，曾经有过美好，但有些事物失去了就是失去了，不可强求。</p>\n<p>假如商品平台要支持生鲜商品的主要特性，可能原料、辅料、包装方案、BOM、计划单、提货单、加工单、反加工单、损益单、尾料、原料顶替等名词都要再温故知新一遍，往事历历在目却遥不可及也。</p>\n<p>通用性、标准性和普适性的公共服务系统才是PowerDotNet努力的方向，而任意性和随意性天生就是公共服务的天敌，抽象和实现的难度肉眼可见成倍剧增，所以最新商品平台设计暂不支持生鲜类商品。</p>\n<h4>3、虚拟商品</h4>\n<p>最典型而常见的几种虚拟商品如下：</p>\n<p>（1）、网络游戏卡，是按服务公司的规定以现金兑换虚拟点(积分)的形式，通过消耗虚拟点(积分)来享受服务的一种支付形式。</p>\n<p>（2）、移动/联通/电信/充值，包括话费充值，流量充值等。</p>\n<p>（3）、网络软件，一般是指系统的操作系统、协议和应用级的提供服务功能的专用软件。</p>\n<p>（4）、网站产品，以产品的眼光看待网站是网站产品的精髓所在。网站产品不同于软件产品、服务产品、工业产品等。网站产品是一类信息产品，以网站的形式提供信息、服务或二者的结合是它的主要表现形式。</p>\n<p>我个人最熟悉的虚拟商品，包括网文（按章节收费）和电子书以及游戏点卡，某些公司的虚拟货币充值也可以抽象成一种商品，只要让用户下订单花钱支付购买同时又没有直接拿到实物产品，就可以认为用户购买的是虚拟商品。</p>\n<h4>4、服务商品</h4>\n<p>服务型商品也是日常生产生活中经常碰到的一种商品类型。最典型的如火车票、汽车票、酒店、机票、旅游度假等商品。</p>\n<p>以我个人比较熟悉的某OTA（Online Travel Agency，在线旅行社）机票产品为例，服务型商品也非常考验开发人员的设计和架构水平。</p>\n<p>机票系统涉及到很多业务数据表，常见的比如区域、二字码、三字码、机场、航站楼、航线、航司、飞机机型、中转地、行程总时长、仓位、常旅客、机票、机票库存、报价信息等表。</p>\n<p>机票、火车票、汽车票、船票和邮轮等非常相似，看上去都是一个“占座”的商品形式，完全可以抽象出公共部分。而酒店则有一个间夜的概念，外加酒店内的附属商品管理，复杂度更胜一筹。</p>\n<p>我们可以将机票航线、航班号、起降时间和具体飞机及仓位的组合（也就是一张飞机票）直观理解为商品，常见的机票商品包括单程和往返机票，还可以根据不同航线组合出联程/多程机票。</p>\n<p>对于机票，大家还应该听说过中航信（含eTerm 或IBE+，两者都知道的，我只想说吾道不孤矣），机票查询和预定基本离不开它。</p>\n<p>注：IBE+（Internet Booking Engine），即中国航信互联网订座引擎，是基于因特网的开放平台技术，它为各种用户应用系统提供访问中国航信传统订座业务系统的途径，是采用API方式的接口。</p>\n<p>据我所知，机票库存可以通过中航信的eTerm软件来查询，行业内的一般做法是将eTerm软件功能封装成接口，供内部系统使用，当然除了eTerm，现在还有IBE+以API接口的形式提供查询和预定功能。</p>\n<p>机票的库存信息一般称为AV信息，这个称呼的来源主要源于eTerm（黑屏）查库存指令。由于库存信息非常重要，因此每家OTA都会花费很多的流量在获取航班的AV信息上。</p>\n<p>由于eTerm和IBE+的接口响应时间较慢，因此OTA采用的方法基本都是主动去获取AV信息，然后缓存起来，绝大多数用户查询时直接拿缓存数据即可，当然有些情况下还是会出现查询缓存失败，再去实时获取AV信息的情况。</p>\n<p>相较于汽车、生鲜和虚拟商品，PowerDotNet的商品系统可能只需要加一些业务扩展表就可以完美支持，而服务类商品通常业务复杂，不容易做成通用设计，所以PowerDotNet已完成的商品设计将服务商品排除在外。</p>\n<p>我尝试着使用国内流行的人工智能服务（<a href=\"https://tongyi.aliyun.com/qianwen/\" rel=\"noopener nofollow\" target=\"_blank\">通义千问</a>、<a href=\"https://www.doubao.com/chat/\" rel=\"noopener nofollow\" target=\"_blank\">字节豆包</a>、<a href=\"https://www.deepseek.com/\" rel=\"noopener nofollow\" target=\"_blank\">DeepSeek</a>、<a href=\"https://yiyan.baidu.com/\" rel=\"noopener nofollow\" target=\"_blank\">文心一言</a>和<a href=\"https://hunyuan.tencent.com/\" rel=\"noopener nofollow\" target=\"_blank\">腾讯混元</a>），实现机票预定功能，给出的代码真是一言难尽，AI目前还无法给出超过预期的方案，祖传代码暂时还是安全的^_^。</p>\n<p>假如后续仍然需要加入机票、酒店、火车票、汽车票等服务商品功能，最好按照服务商品的特殊规范进行抽象设计，独立出来服务商品平台未尝不是一个好方法，元数据和模板设计大法同样有用武之地。</p>\n<p>当然，目前看来PowerDotNet实现的商品管理系统还是比较基础的传统的商品管理，想做到大一统的支持各种形态的商品，还需要做很多设计和实现工作，虽然我个人手头有现成的业务代码和解决方案可参考，咩哈哈。</p>\n<h3>九、商品搜索</h3>\n<h4>1、实现功能</h4>\n<p>商品搜索实现的功能主要包括按关键字搜索、中文分词、历史搜索、热门搜索、推荐搜索、联想关键词等等，绝大多数大中型电商公司的全站搜索服务就包括商品搜索功能。</p>\n<h4>2、解决方案</h4>\n<p>商品搜索在商品管理上算是常用而又有点技术难度的功能了，曾经有一种简单直接高效的暴力设计方法，就是添加一张商品关键词表，不过随着NoSQL和NewSQL的兴起，这种设计方案已显得非常落后。</p>\n<p>个人早年有幸独立实现过一个典型而朴素的商品搜索功能，按照商品分类、标签以及任意关键字，通过MySQL的查询功能，模糊或精确匹配，按权重分页展示，现在想来依然十分好笑，咩哈哈。</p>\n<p>搜索有很多现成的解决方案，比如基于Lucene或者ElasticSearch全文检索实现的搜索服务，按不同数据源（比如商品）建立索引，通过分词优化匹配查询索引，可按需实现对应系统（如商品）查询服务。</p>\n<p>Lucene和ElasticSearch在实践中极易一不小心踩到很多坑，尤其是ElasticSearch，个人印象最深的是看上去简单常用的分页查询，在数据量很大或者有较多分片的情况下，越往后分页查询性能越拉跨。</p>\n<p>个人曾经所在电商公司使用ES实现基本搜索功能，外加Redis和SqlServer配合实现搜索服务兜底方案，性能恶劣的sql语句like模糊匹配是最差的选择，like查询默认选择可以使用索引的左匹配。</p>\n<p>搜索服务的设计与实现比较有技术挑战，尤其是全站搜索和商品搜索结合，值得再开一篇文章详细介绍，不过这就是更偏重于分词索引实现搜索服务的另一个话题了，本文不再展开详细说明。</p>\n<h3>十、商品排序</h3>\n<p>商品搜索和商品排序是密不可分的，对于商品搜索结果，我们总是要根据一定的排序规则展示给用户。下面列举电商中常见的几种商品排序：</p>\n<h4>1、直接根据商品属性排序</h4>\n<p>比如商品价格、上架时间、商品序号、自定义排序序号等</p>\n<h4>2、根据商品相关统计进行排序</h4>\n<p>比如商品销量、好评数、关注数、浏览次数、回购率等</p>\n<h4>3、根据商家相关统计进行排序</h4>\n<p>比如商家信用、商家门店数等</p>\n<h4>4、根据距离排序</h4>\n<p>最常见最典型的就是在线外卖订餐平台，根据消费者当前位置，按照距离排序</p>\n<h4>5、综合排序</h4>\n<p>在实际电商业务场景中，系统默认推荐排序不是简单的根据单一字段进行排序，而是综合排序。</p>\n<p>通常来说，综合排序是先按商品和搜索关键词的相关性过滤，然后按上下架时间做预选，最后在预选结果里根据商品人气及质量等方面进行排序。</p>\n<h3>十一、系统交互</h3>\n<p>商品系统是电商最核心的组成部分之一，是电商平台的基础数据服务系统，和很多内部业务系统保持互通关系，整理下个人开发和对接过的几种常见互联系统。</p>\n<h4>1、订单系统</h4>\n<p>毫无疑问，订单的生成离不开商品，企业在正常的经营过程中，必须有销售商品、产品、提供劳务等业务，订单系统主要提供商品售卖服务。</p>\n<h4>2、库存系统</h4>\n<p>库存系统主要用于管理商品库存，主要包括商品入库、商品出库，商品调拨和商品盘点等操作。我们熟知的仓储WMS系统就包括库存管理。</p>\n<h4>3、采购系统</h4>\n<p>电商中的商品一般来说主要由供应商提供，我们常见的采销系统或进销存系统或供应链系统等都和商品及库存紧密相关。</p>\n<p>某些特殊电商场景除了商品，还要考虑辅料、原料（物料）等，商品管理系统的设计直接关系到采销业务系统的复杂度。</p>\n<h4>4、门店系统</h4>\n<p>门店系统主要经营企业线下业务，门店系统的经营活动也离不开商品管理系统。</p>\n<h4>5、财务系统</h4>\n<p>财务系统是电商系统中最复杂的复合型公共服务型系统，财务单据经常和商品管理有千丝万缕的联系。</p>\n<p>十多年前在帝都某电商公司做财务开发，竟然要自己写SQL访问商品表的积分字段，写windows服务计算和统计用户积分，这么普通而自信的业务逻辑放在今天你敢信？这些其实都是要规避的不合理设计。</p>\n<h4>6、票券系统</h4>\n<p>票券系统是电商中常见的营销系统，针对商品分类、SPU甚至SKU的票券设计很常见。</p>\n<h4>7、广告系统</h4>\n<p>广告系统也是电商中常见的营销系统，针对商品的广告宣传层出不穷。</p>\n<h4>8、推荐系统</h4>\n<p>电商里的推荐系统不会孤立存在，往往和商品、CRM、订单等系统配合完成业务需求。</p>\n<h4>9、CRM</h4>\n<p>主要包括针对个人用户或会员的商品偏好收集和购买统计、积分赠送等等</p>\n<h4>10、其他系统</h4>\n<p>其他如活动等电商业务系统也和商品管理有些联系。</p>\n<h3>十二、其他</h3>\n<p>个人参与设计与开发的商品系统还涉及到以下功能：</p>\n<h4>1、商品详情</h4>\n<p>一个好的商品详情页，可以有效的提升单品的转化率，对于不同终端（比如PC、APP、H5等）的商品详情页设计侧重点也会有很多不同。</p>\n<p>商品详情页的接口设计也非常考验开发人员的编程经验，是采用大而全接口还是小而美接口，这需要开发人员根据实际情况做出合适的选择。</p>\n<h4>2、多语言</h4>\n<p>商品的多语言设计和实现也很普遍，对数据表的设计有更多更高要求，虽然多语言的工作绝大多数在我看来都是体力活。</p>\n<h4>3、组合商品</h4>\n<p>为了促进销售，很多商家在售卖时会利用“捆绑销售”的策略，这样就自然而然发明出了组合商品：人为将几个单独售卖的商品组合在一起进行合并售卖的商品。</p>\n<p>SKU(组合)=m*SKU1+n*SKU2+...p*SKUx</p>\n<p>组合商品的设计可能会对商品库存管理和订单拆单逻辑造成直接的负面影响，曾经在某电商公司做过一段时间开发，没少被组合商品搞得晕头转向，尤其是某些单据的业务逻辑那是相当炸裂。</p>\n<h4>4、商品数据同步</h4>\n<p>不同系统对商品主数据的要求是不一样的，有些业务系统仅仅提供商品接口即可满足业务需求，比如订单系统。</p>\n<p>但一些后台业务系统（如WMS、MES等），往往牵涉到商品的复杂SQL查询，商品数据同步至对应业务系统也是必要的，PowerDotNet数据同步平台<a href=\"https://www.cnblogs.com/jeffwongishandsome/p/datax-task-scheduler-and-data-synchronization-design-and-implement.html\" target=\"_blank\">Power.DataX</a>可轻松解决数据同步问题。</p>\n<p>&nbsp;</p>\n</div>\n<div id=\"MySignature\">\n    <div id=\"AllanboltSignature\">\n<p id=\"PSignature\"><br />\n作者：<a href=\"http://www.cnblogs.com/jeffwongishandsome/\" target=\"_blank\" title=\"据说点击推荐或者关注博主是一个程序员的优良品质，留言也是\">Jeff Wong</a> <br />\n出处：<a href=\"http://jeffwongishandsome.cnblogs.com/\" target=\"_blank\" title=\"关注要趁早啊，留言也可以啊，至少二选一吧！\">http://jeffwongishandsome.cnblogs.com/</a> <br />\n本文版权归作者和博客园共有，欢迎围观转载。转载时请您务必在文章明显位置给出原文链接，谢谢您的合作。 <br />\n</p>\n</div>\n</div>\n<div class=\"clear\"></div>\n\n\t<div class=\"postDesc\">posted on \n<span id=\"post-date\">2025-12-31 12:11</span>&nbsp;\n<a href=\"https://www.cnblogs.com/jeffwongishandsome\">JeffWong</a>&nbsp;\n阅读(<span id=\"post_view_count\">137</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "【大数据 & AI】Flink Agents 源码解读 --- (3) --- Agent",
      "link": "https://www.cnblogs.com/rossiXYZ/p/19369869",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/rossiXYZ/p/19369869\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäºŽ 2025-12-31 19:17\">\n    <span>ã€å¤§æ•°æ® &amp; AIã€‘Flink Agents æºç è§£è¯» --- (3) --- Agent</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"å¤§æ•°æ®--aiflink-agents-æºç è§£è¯»-----3------agent\">ã€å¤§æ•°æ® &amp; AIã€‘Flink Agents æºç è§£è¯» --- (3) ---  Agent</h1>\n<p></p><div class=\"toc\"><div class=\"toc-container-header\">ç›®å½•</div><ul><li><a href=\"#å¤§æ•°æ®--aiflink-agents-æºç è§£è¯»-----3------agent\" rel=\"noopener nofollow\">ã€å¤§æ•°æ® &amp; AIã€‘Flink Agents æºç è§£è¯» --- (3) ---  Agent</a><ul><li><a href=\"#0x00-æ¦‚è¦\" rel=\"noopener nofollow\">0x00 æ¦‚è¦</a></li><li><a href=\"#0x01-æ ¸å¿ƒæŠ½è±¡\" rel=\"noopener nofollow\">0x01 æ ¸å¿ƒæŠ½è±¡</a><ul><li><a href=\"#11-agentæŠ½è±¡\" rel=\"noopener nofollow\">1.1 AgentæŠ½è±¡</a></li><li><a href=\"#12-action-æŠ½è±¡\" rel=\"noopener nofollow\">1.2 Action æŠ½è±¡</a></li><li><a href=\"#13-èµ„æºæŠ½è±¡\" rel=\"noopener nofollow\">1.3 èµ„æºæŠ½è±¡</a></li><li><a href=\"#14-æ‰§è¡ŒçŽ¯å¢ƒæŠ½è±¡\" rel=\"noopener nofollow\">1.4 æ‰§è¡ŒçŽ¯å¢ƒæŠ½è±¡</a></li><li><a href=\"#15-äº‹ä»¶æŠ½è±¡\" rel=\"noopener nofollow\">1.5 äº‹ä»¶æŠ½è±¡</a></li><li><a href=\"#16-é…ç½®æŠ½è±¡\" rel=\"noopener nofollow\">1.6 é…ç½®æŠ½è±¡</a></li></ul></li><li><a href=\"#0x02-workflow-style-agent-å’Œreactagent\" rel=\"noopener nofollow\">0x02 Workflow Style Agent å’ŒReActAgent</a><ul><li><a href=\"#21-ç‰¹æ€§\" rel=\"noopener nofollow\">2.1 ç‰¹æ€§</a><ul><li><a href=\"#211-è®¾è®¡ç†å¿µ\" rel=\"noopener nofollow\">2.1.1 è®¾è®¡ç†å¿µ</a></li><li><a href=\"#212-æŽ§åˆ¶æµ\" rel=\"noopener nofollow\">2.1.2 æŽ§åˆ¶æµ</a></li><li><a href=\"#213-å®šåˆ¶çº§åˆ«\" rel=\"noopener nofollow\">2.1.3 å®šåˆ¶çº§åˆ«</a></li><li><a href=\"#214-ä½¿ç”¨åœºæ™¯\" rel=\"noopener nofollow\">2.1.4 ä½¿ç”¨åœºæ™¯</a></li><li><a href=\"#215-å¼€å‘å¤æ‚åº¦\" rel=\"noopener nofollow\">2.1.5 å¼€å‘å¤æ‚åº¦</a></li><li><a href=\"#216-æ€»ç»“\" rel=\"noopener nofollow\">2.1.6 æ€»ç»“</a></li></ul></li><li><a href=\"#22-workflow\" rel=\"noopener nofollow\">2.2 workflow</a><ul><li><a href=\"#221-ä»£ç å¯¼è¯»\" rel=\"noopener nofollow\">2.2.1 ä»£ç å¯¼è¯»</a><ul><li><a href=\"#å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ\" rel=\"noopener nofollow\">å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ</a></li><li><a href=\"#åˆ›å»ºä»£ç†\" rel=\"noopener nofollow\">åˆ›å»ºä»£ç†</a></li><li><a href=\"#ä¸Ž-flink-é›†æˆ\" rel=\"noopener nofollow\">ä¸Ž Flink é›†æˆ</a></li></ul></li></ul></li><li><a href=\"#23-react-agent\" rel=\"noopener nofollow\">2.3 ReAct Agent</a><ul><li><a href=\"#231-ä»£ç å¯¼è¯»\" rel=\"noopener nofollow\">2.3.1 ä»£ç å¯¼è¯»</a><ul><li><a href=\"#å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ-1\" rel=\"noopener nofollow\">å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ</a></li><li><a href=\"#åˆ›å»º-react-agent\" rel=\"noopener nofollow\">åˆ›å»º ReAct Agent</a></li><li><a href=\"#ä¸Ž-flink-é›†æˆ-1\" rel=\"noopener nofollow\">ä¸Ž Flink é›†æˆ</a></li></ul></li></ul></li></ul></li><li><a href=\"#0x03-reactagent\" rel=\"noopener nofollow\">0x03 ReActAgent</a><ul><li><a href=\"#31-å®šä¹‰\" rel=\"noopener nofollow\">3.1 å®šä¹‰</a></li><li><a href=\"#32-æ·±åº¦å®šåˆ¶\" rel=\"noopener nofollow\">3.2 æ·±åº¦å®šåˆ¶</a><ul><li><a href=\"#321-reactagent-ç‰¹è‰²\" rel=\"noopener nofollow\">3.2.1 ReActAgent ç‰¹è‰²</a><ul><li><a href=\"#æµå¼å¤„ç†é€‚é…\" rel=\"noopener nofollow\">æµå¼å¤„ç†é€‚é…</a></li><li><a href=\"#ç‰¹å®šçš„è¡Œä¸ºæ¨¡å¼\" rel=\"noopener nofollow\">ç‰¹å®šçš„è¡Œä¸ºæ¨¡å¼</a></li><li><a href=\"#é”®æŽ§çŠ¶æ€æ”¯æŒ\" rel=\"noopener nofollow\">é”®æŽ§çŠ¶æ€æ”¯æŒ</a></li><li><a href=\"#llm-é›†æˆä¼˜åŒ–\" rel=\"noopener nofollow\">LLM é›†æˆä¼˜åŒ–</a></li><li><a href=\"#èµ„æºç®¡ç†æ–¹å¼\" rel=\"noopener nofollow\">èµ„æºç®¡ç†æ–¹å¼</a></li><li><a href=\"#ç±»åž‹ä¿¡æ¯å¤„ç†\" rel=\"noopener nofollow\">ç±»åž‹ä¿¡æ¯å¤„ç†</a></li><li><a href=\"#é”™è¯¯å¤„ç†æœºåˆ¶\" rel=\"noopener nofollow\">é”™è¯¯å¤„ç†æœºåˆ¶</a></li><li><a href=\"#ç»“æž„åŒ–è¾“å‡ºæ”¯æŒ\" rel=\"noopener nofollow\">ç»“æž„åŒ–è¾“å‡ºæ”¯æŒ</a></li><li><a href=\"#æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ\" rel=\"noopener nofollow\">æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ</a></li><li><a href=\"#å·¥å…·è°ƒç”¨é›†æˆ\" rel=\"noopener nofollow\">å·¥å…·è°ƒç”¨é›†æˆ</a></li><li><a href=\"#è¿è¡Œæ—¶åä½œ\" rel=\"noopener nofollow\">è¿è¡Œæ—¶åä½œ</a></li></ul></li></ul></li><li><a href=\"#33-å…¸åž‹æ‰§è¡Œæµç¨‹\" rel=\"noopener nofollow\">3.3 å…¸åž‹æ‰§è¡Œæµç¨‹</a></li><li><a href=\"#34-start_action-ä¸Ž-stop_action\" rel=\"noopener nofollow\">3.4 start_action ä¸Ž stop_action</a></li><li><a href=\"#35-è¾“å…¥è¾“å‡º\" rel=\"noopener nofollow\">3.5 è¾“å…¥è¾“å‡º</a><ul><li><a href=\"#351-äº‹ä»¶é©±åŠ¨æž¶æž„\" rel=\"noopener nofollow\">3.5.1 äº‹ä»¶é©±åŠ¨æž¶æž„</a></li><li><a href=\"#352-ç»Ÿä¸€çš„æ•°æ®å°è£\" rel=\"noopener nofollow\">3.5.2 ç»Ÿä¸€çš„æ•°æ®å°è£…</a></li><li><a href=\"#353-æ”¯æŒå¤šç§æ•°æ®ç±»åž‹\" rel=\"noopener nofollow\">3.5.3 æ”¯æŒå¤šç§æ•°æ®ç±»åž‹</a></li><li><a href=\"#354-å†…ç½®æ¨¡æ¿æ”¯æŒ\" rel=\"noopener nofollow\">3.5.4 å†…ç½®æ¨¡æ¿æ”¯æŒ</a></li></ul></li><li><a href=\"#36-æ¨¡æ¿ç³»ç»Ÿ\" rel=\"noopener nofollow\">3.6 æ¨¡æ¿ç³»ç»Ÿ</a><ul><li><a href=\"#361-å­—ç¬¦ä¸²æ¨¡æ¿\" rel=\"noopener nofollow\">3.6.1 å­—ç¬¦ä¸²æ¨¡æ¿</a></li><li><a href=\"#362-æ¶ˆæ¯æ¨¡æ¿\" rel=\"noopener nofollow\">3.6.2 æ¶ˆæ¯æ¨¡æ¿</a></li></ul></li><li><a href=\"#37-functiontool-ä¸Ž-action-çš„å…³è”åŠæ³¨å†Œæœºåˆ¶\" rel=\"noopener nofollow\">3.7 FunctionTool ä¸Ž Action çš„å…³è”åŠæ³¨å†Œæœºåˆ¶</a><ul><li><a href=\"#371-å®žé™…è½¬æ¢æµç¨‹\" rel=\"noopener nofollow\">3.7.1 å®žé™…è½¬æ¢æµç¨‹</a><ul><li><a href=\"#function-tool-æ³¨å†Œåˆ°-agent\" rel=\"noopener nofollow\">Function Tool æ³¨å†Œåˆ° Agent</a></li><li><a href=\"#ä¸Žæ¨¡åž‹äº¤äº’\" rel=\"noopener nofollow\">ä¸Žæ¨¡åž‹äº¤äº’</a></li></ul></li><li><a href=\"#372-agentplan-ç¼–è¯‘è¿‡ç¨‹ä¸­å·¥å…·çš„å¤„ç†\" rel=\"noopener nofollow\">3.7.2 AgentPlan ç¼–è¯‘è¿‡ç¨‹ä¸­å·¥å…·çš„å¤„ç†</a><ul><li><a href=\"#ç”¨æˆ·å®šä¹‰çš„-function-tool-è½¬æ¢ä¸º-action\" rel=\"noopener nofollow\">ç”¨æˆ·å®šä¹‰çš„ Function Tool è½¬æ¢ä¸º Action</a></li><li><a href=\"#å†…ç½®-tool-call-action\" rel=\"noopener nofollow\">å†…ç½® Tool Call Action</a></li><li><a href=\"#tool_call_action-å¦‚ä½•ç¼–è¯‘åˆ°agentplan\" rel=\"noopener nofollow\">TOOL_CALL_ACTION å¦‚ä½•ç¼–è¯‘åˆ°AgentPlan</a></li></ul></li><li><a href=\"#373-å·¥å…·è°ƒç”¨æµç¨‹\" rel=\"noopener nofollow\">3.7.3 å·¥å…·è°ƒç”¨æµç¨‹</a></li><li><a href=\"#374-å®Œæ•´æµç¨‹å›¾\" rel=\"noopener nofollow\">3.7.4 å®Œæ•´æµç¨‹å›¾</a></li><li><a href=\"#375-ä»£ç \" rel=\"noopener nofollow\">3.7.5 ä»£ç </a></li></ul></li></ul></li><li><a href=\"#0xff-å‚è€ƒ\" rel=\"noopener nofollow\">0xFF å‚è€ƒ</a></li></ul></li></ul></div><p></p>\n<h2 id=\"0x00-æ¦‚è¦\">0x00 æ¦‚è¦</h2>\n<p>Agentæ˜¯ Flink Agent æ¡†æž¶çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯æ‰§è¡Œå•å…ƒï¼Œç”¨äºŽå¤„ç†è¾“å…¥äº‹ä»¶å¹¶ç”Ÿæˆè¾“å‡ºäº‹ä»¶ã€‚ä¸»è¦åŠŸèƒ½å’Œç‰¹è‰²å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>äº‹ä»¶é©±åŠ¨å¤„ç†ï¼šåŸºäºŽäº‹ä»¶é©±åŠ¨æž¶æž„ï¼Œå“åº”ä¸åŒç±»åž‹çš„äº‹ä»¶ï¼ˆå¦‚ InputEventï¼ŒChatRequestEventç­‰ï¼‰ï¼Œé€šè¿‡å®šä¹‰actionsæ¥å¤„ç†ç‰¹å®šäº‹ä»¶ç±»åž‹ã€‚</li>\n<li>èµ„æºç®¡ç†ï¼šç®¡ç†å„ç§èµ„æºï¼Œå¦‚èŠå¤©æ¨¡åž‹ã€å·¥å…·ã€æç¤ºè¯ç­‰ã€‚æ”¯æŒå¤šç§èµ„æºç±»åž‹ï¼ˆCHAT_MOEL, TOOL, PROMPTç­‰ï¼‰ã€‚</li>\n<li>å¯æ‰©å±•æ€§ï¼šæ”¯æŒè‡ªå®šä¹‰çš„actionså’Œèµ„æºï¼Œå¯ä»¥é€šè¿‡ç»§æ‰¿Agentç±»æ¥åˆ›å»ºç‰¹å®šåŠŸèƒ½çš„Agentï¼Œå¦‚ReActAgentã€‚</li>\n<li>é…ç½®æ”¯æŒï¼šæ”¯æŒé€šè¿‡é…ç½®é€‰é¡¹è‡ªå®šä¹‰è¡Œä¸ºï¼Œæä¾›ç»Ÿä¸€çš„é…ç½®ç®¡ç†æœºåˆ¶ã€‚</li>\n<li>æ¨¡å—åŒ–è®¾è®¡ï¼šå°†åŠŸèƒ½åˆ†è§£ä¸ºç‹¬ç«‹çš„Actionsï¼Œæ¯ä¸ªactionè´Ÿè´£å¤„ç†ç‰¹å®šç±»åž‹çš„äº‹ä»¶ã€‚</li>\n<li>èµ„æºæŠ½è±¡ï¼šé€šè¿‡ ResourceDescriptor æŠ½è±¡èµ„æºå®šä¹‰ï¼Œæ”¯æŒä¸åŒç±»åž‹çš„èµ„æºï¼ˆæ¨¡åž‹ï¼Œå·¥å…·ï¼Œæç¤ºè¯ç­‰ï¼‰</li>\n<li>çŠ¶æ€ç®¡ç†ï¼šæä¾›çŸ­æœŸå†…å­˜ç®¡ç†æœºåˆ¶ï¼Œæ”¯æŒåŸºäºŽkeyçš„çŠ¶æ€éš”ç¦»ã€‚</li>\n<li>å¤šçŽ¯å¢ƒæ”¯æŒï¼šæ”¯æŒæœ¬åœ°æ‰§è¡ŒçŽ¯å¢ƒç”¨äºŽè°ƒè¯•ï¼Œæ”¯æŒè¿œç¨‹ Flink çŽ¯å¢ƒç”¨äºŽç”Ÿäº§ã€‚</li>\n</ul>\n<h2 id=\"0x01-æ ¸å¿ƒæŠ½è±¡\">0x01 æ ¸å¿ƒæŠ½è±¡</h2>\n<h3 id=\"11-agentæŠ½è±¡\">1.1 AgentæŠ½è±¡</h3>\n<p>Agent ä½œä¸ºåŸºç±»æä¾›äº†ï¼š</p>\n<ul>\n<li>èµ„æºç®¡ç†ï¼ˆresources å­—å…¸ï¼‰ã€‚</li>\n<li>Action æ³¨å†Œæœºåˆ¶ï¼ˆactions å­—å…¸ï¼‰ã€‚</li>\n<li>ç»Ÿä¸€çš„æŽ¥å£ä¾›æ‰§è¡ŒçŽ¯å¢ƒä½¿ç”¨ã€‚</li>\n</ul>\n<pre><code class=\"language-python\">class Agent(ABC):\n    \"\"\"Base class for defining agent logic.\n\n    Example:\n        Users have two ways to create an Agent\n\n        * Declare an Agent with decorators\n        ::\n\n            class MyAgent(Agent):\n                @action(InputEvent)\n                @staticmethod\n                def my_action(event: Event, ctx: RunnerContext) -&gt; None:\n                    action logic\n\n                @chat_model_connection\n                @staticmethod\n                def my_connection() -&gt; ResourceDescriptor:\n                    return ResourceDescriptor(clazz=OllamaChatModelConnection,\n                                              model=\"qwen2:7b\",\n                                              base_url=\"http://localhost:11434\")\n\n                @chat_model_setup\n                @staticmethod\n                def my_chat_model() -&gt; ResourceDescriptor:\n                    return ResourceDescriptor(clazz=OllamaChatModel,\n                                              connection=\"my_connection\")\n\n        * Add actions and resources to an Agent instance\n        ::\n\n            my_agent = Agent()\n            my_agent.add_action(name=\"my_action\",\n                                events=[InputEvent],\n                                func=action_function)\n                    .add_resource(name=\"my_connection\",\n                                  instance=ResourceDescriptor(\n                                        clazz=OllamaChatModelConnection,\n                                        arg1=xxx\n                                )\n                    .add_resource(\n                        name=\"my_connection\",\n                        instance=ResourceDescriptor(\n                            clazz=OllamaChatModelConnection,\n                            arg1=xxx\n                        )\n                    )\n                    .add_resource(\n                        name=\"my_chat_model\",\n                        instance=ResourceDescriptor(\n                            clazz=OllamaChatModelSetup,\n                            connection=\"my_connection\"\n                        )\n                    )\n    \"\"\"\n\n    _actions: Dict[str, Tuple[List[Type[Event]], Callable, Dict[str, Any]]]\n    _resources: Dict[ResourceType, Dict[str, Any]]\n    _mcp_servers: Dict[str, MCPServer]\n\n    def __init__(self) -&gt; None:\n        \"\"\"Init method.\"\"\"\n        self._actions = {}\n        self._resources = {}\n        for type in ResourceType:\n            self._resources[type] = {}\n\n    @property\n    def actions(self) -&gt; Dict[str, Tuple[List[Type[Event]], Callable, Dict[str, Any]]]:\n        \"\"\"Get added actions.\"\"\"\n        return self._actions\n\n    @property\n    def resources(self) -&gt; Dict[ResourceType, Dict[str, Any]]:\n        \"\"\"Get added resources.\"\"\"\n        return self._resources\n\n    def add_action(\n        self, name: str, events: List[Type[Event]], func: Callable, **config: Any\n    ) -&gt; \"Agent\":\n        \"\"\"Add action to agent.\n\n        Parameters\n        ----------\n        name : str\n            The name of the action, should be unique in the same Agent.\n        events: List[Type[Event]]\n            The type of events listened by this action.\n        func: Callable\n            The function to be executed when receive listened events.\n        **config: Any\n            Key named arguments can be used by this action in runtime.\n\n        Returns:\n        -------\n        Agent\n            The modified Agent instance.\n        \"\"\"\n        if name in self._actions:\n            msg = f\"Action {name} already defined\"\n            raise ValueError(msg)\n        self._actions[name] = (events, func, config if config else None)\n        return self\n\n    def add_resource(\n        self, name: str, instance: SerializableResource | ResourceDescriptor\n    ) -&gt; \"Agent\":\n        \"\"\"Add resource to agent instance.\n\n        Parameters\n        ----------\n        name : str\n            The name of the prompt, should be unique in the same Agent.\n        instance: SerializableResource | ResourceDescriptor\n            The serializable resource instance, or the descriptor of resource.\n\n        Returns:\n        -------\n        Agent\n            The agent to add the resource.\n        \"\"\"\n        if isinstance(instance, SerializableResource):\n            resource_type = instance.resource_type()\n        elif isinstance(instance, ResourceDescriptor):\n            resource_type = instance.clazz.resource_type()\n        else:\n            err_msg = f\"Unexpected resource {instance}\"\n            raise TypeError(err_msg)\n\n        if name in self._resources[resource_type]:\n            msg = f\"{resource_type.value} {name} already defined\"\n            raise ValueError(msg)\n\n        self._resources[resource_type][name] = instance\n        return self\n</code></pre>\n<h3 id=\"12-action-æŠ½è±¡\">1.2 Action æŠ½è±¡</h3>\n<p>Action æä¾›äº†ï¼š</p>\n<ul>\n<li>äº‹ä»¶ç›‘å¬æœºåˆ¶</li>\n<li>ä¸Žæ‰§è¡Œä¸Šä¸‹æ–‡çš„äº¤äº’æŽ¥å£</li>\n<li>ç»Ÿä¸€çš„æ‰§è¡ŒæŽ¥å£</li>\n</ul>\n<p>é€šè¿‡è£…é¥°å™¨æˆ–è€…add_actionæ–¹æ³•å®šä¹‰ã€‚</p>\n<pre><code class=\"language-python\">    @action(InputEvent)\n    @staticmethod\n    def start_action(event: InputEvent, ctx: RunnerContext) -&gt; None:\n        \"\"\"Start action to format user input and send chat request event.\"\"\"\n        usr_input = event.input\n</code></pre>\n<h3 id=\"13-èµ„æºæŠ½è±¡\">1.3 èµ„æºæŠ½è±¡</h3>\n<p>èµ„æºæŠ½è±¡åŒ…æ‹¬ï¼šæ¨¡åž‹è¿žæŽ¥ï¼ˆCHAT_MODEL_CONNECTION)ï¼Œå·¥å…·ï¼Œæç¤ºè¯ï¼ŒMCPæœåŠ¡å™¨ç­‰ã€‚</p>\n<pre><code class=\"language-python\">class ResourceDescriptor:\n    \"\"\"Descriptor of resource, includes the class and the initialize arguments.\"\"\"\n\n    _clazz: Type[Resource]\n    _arguments: Dict[str, Any]\n\n    def __init__(self, *, clazz: Type[Resource], **arguments: Any) -&gt; None:\n        \"\"\"Init method.\"\"\"\n        self._clazz = clazz\n        self._arguments = arguments\n\n    @property\n    def clazz(self) -&gt; Type[Resource]:\n        \"\"\"Get the class of the resource.\"\"\"\n        return self._clazz\n\n    @property\n    def arguments(self) -&gt; Dict[str, Any]:\n        \"\"\"Get the initialize arguments of the resource.\"\"\"\n        return self._arguments\n</code></pre>\n<h3 id=\"14-æ‰§è¡ŒçŽ¯å¢ƒæŠ½è±¡\">1.4 æ‰§è¡ŒçŽ¯å¢ƒæŠ½è±¡</h3>\n<p>æ‰§è¡Œä¸Šä¸‹æ–‡æä¾›ï¼š</p>\n<ul>\n<li>äº‹ä»¶å‘é€æœºåˆ¶</li>\n<li>èµ„æºè®¿é—®æŽ¥å£</li>\n<li>å†…å­˜ç®¡ç†</li>\n<li>é…ç½®è®¿é—®</li>\n</ul>\n<pre><code class=\"language-python\">class RunnerContext(ABC):\n    \"\"\"Abstract base class providing context for agent execution.\n\n    This context provides access to event handling.\n</code></pre>\n<h3 id=\"15-äº‹ä»¶æŠ½è±¡\">1.5 äº‹ä»¶æŠ½è±¡</h3>\n<p>å³ Event ä½“ç³»ï¼Œæä¾›äº†ï¼š</p>\n<ul>\n<li>ç»Ÿä¸€çš„äº‹ä»¶å¤„ç†æœºåˆ¶</li>\n<li>ç±»åž‹å®‰å…¨çš„äº‹ä»¶åˆ†å‘</li>\n<li>å¯æ‰©å±•çš„äº‹ä»¶ç±»åž‹ç³»ç»Ÿ</li>\n</ul>\n<pre><code class=\"language-python\">class Event(BaseModel, ABC, extra=\"allow\"):\n    \"\"\"Base class for all event types in the system. Event allow extra properties, but\n    these properties are required isinstance of BaseModel, or json serializable.\n\n    Attributes:\n    ----------\n    id : UUID\n        Unique identifier for the event, automatically generated using uuid4.\n    \"\"\"\n\n    id: UUID = Field(default_factory=uuid4)\n</code></pre>\n<h3 id=\"16-é…ç½®æŠ½è±¡\">1.6 é…ç½®æŠ½è±¡</h3>\n<p>AgentConfiguration æä¾›äº†ï¼š</p>\n<ul>\n<li>ç±»åž‹å®‰å…¨çš„é…ç½®é€‰é¡¹</li>\n<li>é»˜è®¤å€¼ç®¡ç†</li>\n<li>ä»Žæ–‡ä»¶åŠ è½½é…ç½®çš„èƒ½åŠ›</li>\n</ul>\n<pre><code class=\"language-python\">class AgentConfiguration(BaseModel, Configuration):\n    \"\"\"Base class for config objects in the system.\n    Provides a flat dict interface to access nested config values.\n    \"\"\"\n\n    conf_data: Dict[str, Any]\n\n    def __init__(self, conf_data: Dict[str, Any] | None = None) -&gt; None:\n        \"\"\"Initialize with optional configuration data.\"\"\"\n        if conf_data is None:\n            super().__init__(conf_data = {})\n        else:\n            super().__init__(conf_data = conf_data)\n\n</code></pre>\n<h2 id=\"0x02-workflow-style-agent-å’Œreactagent\">0x02 Workflow Style Agent å’ŒReActAgent</h2>\n<p>æœ‰ä¸¤ç§æœ€æ™®éçš„Agentsï¼š</p>\n<ul>\n<li><strong>Workflows</strong> æ˜¯ç”±é¢„å®šä¹‰çš„ä»£ç è·¯å¾„æ¥ç¼–æŽ’ LLM å’Œå·¥å…·çš„ç³»ç»Ÿã€‚</li>\n<li><strong>Agents</strong> åˆ™æ˜¯ LLM åŠ¨æ€æŒ‡å¯¼è‡ªèº«æµç¨‹å’Œå·¥å…·ä½¿ç”¨çš„ç³»ç»Ÿï¼Œå®ƒä»¬æŽŒæŽ§ç€è‡ªå·±å®Œæˆä»»åŠ¡çš„æ–¹å¼ã€‚</li>\n</ul>\n<p>å½“éœ€è¦å¤„ç†æ›´å¤æ‚ä»»åŠ¡æ—¶ï¼ŒWorkflows ä¸ºå®šä¹‰æ˜Žç¡®çš„ä»»åŠ¡æä¾›äº†å¯é¢„æµ‹æ€§å’Œä¸€è‡´æ€§ï¼ˆå¤çŽ°ï¼‰ï¼Œè€Œå½“éœ€è¦å¤§è§„æ¨¡çš„çµæ´»æ€§å’Œæ¨¡åž‹é©±åŠ¨çš„å†³ç­–æ—¶ï¼Œagents åˆ™æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>\n<p>å¯¹åº”è¿™ä¸¤ç§Agentï¼ŒFlink Agents æœ‰ä¸¤ç§ä¸åŒçš„Agentï¼šWorkflow Style Agent å’ŒReActAgentã€‚</p>\n<ul>\n<li>åœ¨ Flink-Agents ä¸­ï¼Œå·¥ä½œæµé£Žæ ¼çš„ä»£ç†ï¼ˆworkflow-style agentï¼‰æŠŠæŽ¨ç†ä¸Žè¡Œä¸ºç»„ç»‡æˆä¸€æ¡ç”±â€œåŠ¨ä½œï¼ˆactionï¼‰â€æž„æˆçš„æœ‰å‘å·¥ä½œæµï¼ŒåŠ¨ä½œä¹‹é—´é€šè¿‡äº‹ä»¶è¿žæŽ¥ã€‚è¿™ç§è®¾è®¡å€Ÿé‰´äº†å¤æ‚å¤šé˜¶æ®µä»»åŠ¡çš„ç¼–æŽ’éœ€æ±‚ï¼Œå¸Œæœ›ä»¥é€æ˜Žã€å¯æ‰©å±•ä¸”ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„æ–¹å¼åˆ©ç”¨ Apache Flink çš„æµå¼æž¶æž„æ¥å®Œæˆå·¥ä½œã€‚Workflow é€‚åˆä»»åŠ¡æ˜¯å¯ä»¥è¢«æ¸…é™¤çš„è§£æž„æˆå›ºå®šçš„å­ä»»åŠ¡å•å…ƒã€‚Workflow ç›¸å¯¹äºŽ Agent æœ‰ä¸ªå¤©ç„¶çš„ä¼˜åŠ¿å°±æ˜¯é«˜æ•ˆçŽ‡ï¼Œä¸”æ•ˆæžœéžå¸¸ç¨³å®šï¼Œæ‰§è¡ŒåŸºæœ¬éƒ½èƒ½åœ¨é¢„æœŸèŒƒå›´å†…ï¼Œä¸å¯é¢„çŸ¥æˆ–è€…è¯´æœªçŸ¥æ€§å¾ˆä½Žã€‚ç¼ºç‚¹è‡ªç„¶å°±æ˜¯ä¸å¤Ÿçµæ´»äº†ï¼Œé¢å¯¹ä¸€äº›å¼€æ”¾çš„æˆ–è€…æ— æ³•é¢„å®šä¹‰çš„ä»»åŠ¡å°±æ— æ³•å¤„ç†äº†ã€‚</li>\n<li>ReActï¼ˆReasoning and Actingï¼‰Agent æ˜¯ä¸€ç§é€šç”¨èŒƒå¼ï¼ŒæŠŠæŽ¨ç†ä¸Žè¡ŒåŠ¨èƒ½åŠ›ç»“åˆèµ·æ¥è§£å†³å¤æ‚ä»»åŠ¡ã€‚å€ŸåŠ©è¯¥èŒƒå¼ï¼Œç”¨æˆ·åªéœ€åœ¨æç¤ºè¯é‡ŒæŒ‡å®šç›®æ ‡å¹¶æä¾›å¯ç”¨å·¥å…·ï¼Œå¤§æ¨¡åž‹ä¾¿ä¼šè‡ªä¸»å†³å®šå¦‚ä½•è¾¾æˆç›®æ ‡å¹¶æ‰§è¡Œç›¸åº”åŠ¨ä½œã€‚ReActé€šè¿‡æ¨¡æ‹Ÿäººç±»çš„â€œReasoning-Actingâ€æ¨¡å¼ï¼Œä½¿LLMèƒ½å¤ŸåŠ¨æ€åœ°å†³å®šæ•°æ®éœ€æ±‚ ã€‚å…¶æ ¸å¿ƒæ˜¯ä¸€ä¸ªå¾ªçŽ¯ï¼šæ€è€ƒï¼ˆThoughtï¼‰ï¼š LLMé¦–å…ˆè¿›è¡Œå†…éƒ¨æŽ¨ç†ã€‚å®ƒåˆ†æžå½“å‰ä»»åŠ¡å’Œå·²æœ‰ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦ç¼ºå°‘å®Œæˆä»»åŠ¡æ‰€éœ€çš„çŸ¥è¯†ï¼Œå¹¶åˆ¶å®šä¸‹ä¸€æ­¥çš„è¡ŒåŠ¨è®¡åˆ’ã€‚åœ¨è¿™ä¸ªå¾ªçŽ¯ä¸­ï¼Œæ•°æ®æµæ˜¯æ ¹æ®LLMçš„â€œæ€è€ƒâ€ç»“æžœåŠ¨æ€ç”Ÿæˆçš„ã€‚å½“LLMåˆ¤æ–­éœ€è¦å¤–éƒ¨æ•°æ®æ—¶ï¼Œå®ƒä¼šä¸»åŠ¨è§¦å‘ä¸€ä¸ªâ€œè¡ŒåŠ¨â€æ¥èŽ·å–æ•°æ®ï¼Œç„¶åŽå°†èŽ·å–åˆ°çš„â€œè§‚å¯Ÿâ€æ•°æ®æ•´åˆè¿›è‡ªå·±çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œç”¨äºŽä¸‹ä¸€æ­¥çš„å†³ç­–ã€‚</li>\n</ul>\n<h3 id=\"21-ç‰¹æ€§\">2.1 ç‰¹æ€§</h3>\n<p>ä¸¤ç§Agentçš„è¯¦ç»†æ¢³ç†å¦‚ä¸‹ï¼š</p>\n<h4 id=\"211-è®¾è®¡ç†å¿µ\">2.1.1 è®¾è®¡ç†å¿µ</h4>\n<p>Workflow Style Agent</p>\n<ul>\n<li>å¯å®šåˆ¶æ¡†æž¶ï¼šçµæ´»çš„æ¡†æž¶ï¼Œå…è®¸ç”¨æˆ·å®šä¹‰è‡ªå·±çš„ä»£ç†é€»è¾‘</li>\n<li>äº‹ä»¶é©±åŠ¨æž¶æž„ï¼šé€»è¾‘è¢«ç»„ç»‡ä¸ºç”±äº‹ä»¶è¿žæŽ¥çš„åŠ¨ä½œæœ‰å‘å›¾</li>\n<li>æ¨¡å—åŒ–è®¾è®¡ï¼šç”¨æˆ·é€šè¿‡å®šä¹‰å•ä¸ªåŠ¨ä½œåŠå…¶äº¤äº’æ¥ç»„åˆä»£ç†</li>\n</ul>\n<p>ReActAgent</p>\n<ul>\n<li>é¢„æž„å»ºä»£ç†ï¼šåŸºäºŽ ReActï¼ˆæŽ¨ç†+è¡ŒåŠ¨ï¼‰èŒƒå¼çš„å†…ç½®ã€å³ç”¨åž‹ä»£ç†å®žçŽ°</li>\n<li>ä»¥ LLM ä¸ºä¸­å¿ƒï¼šä¸“é—¨ä¸º LLM åšå‡ºé‡‡å–ä½•ç§è¡ŒåŠ¨çš„å†³ç­–è€Œè®¾è®¡</li>\n<li>æ ‡å‡†åŒ–å·¥ä½œæµï¼šéµå¾ªå›ºå®šçš„â€œæ€ç»´â†’è¡ŒåŠ¨â†’è§‚å¯Ÿâ€å¾ªçŽ¯æ¨¡å¼</li>\n</ul>\n<h4 id=\"212-æŽ§åˆ¶æµ\">2.1.2 æŽ§åˆ¶æµ</h4>\n<p>Workflow Style Agent</p>\n<ul>\n<li>æ˜¾å¼æµç¨‹ï¼šç”¨æˆ·æ˜Žç¡®å®šä¹‰äº‹ä»¶å¦‚ä½•è§¦å‘åŠ¨ä½œ</li>\n<li>äº‹ä»¶è·¯ç”±ï¼šåŠ¨ä½œç”±ç‰¹å®šçš„äº‹ä»¶ç±»åž‹è§¦å‘</li>\n<li>çµæ´»æ¨¡å¼ï¼šå¯ä»¥å®žçŽ°å„ç§æ¨¡å¼ï¼Œå¦‚é¡ºåºã€åˆ†æ”¯æˆ–å¾ªçŽ¯å·¥ä½œæµ</li>\n</ul>\n<p>ReActAgent</p>\n<ul>\n<li>éšå¼æµç¨‹ï¼šå†³ç­–è¿‡ç¨‹åœ¨å†…éƒ¨ç”± LLM å¤„ç†</li>\n<li>å·¥å…·è°ƒç”¨ï¼šä½¿ç”¨ LLM çš„åŽŸç”Ÿå‡½æ•°è°ƒç”¨åŠŸèƒ½æ¥ç¡®å®šæ“ä½œ</li>\n<li>å›ºå®šæ¨¡å¼ï¼šéµå¾ªæ ‡å‡†çš„ ReAct æ¨¡å¼ï¼ˆæ€è€ƒâ†’è¡ŒåŠ¨â†’è§‚å¯Ÿï¼‰</li>\n</ul>\n<h4 id=\"213-å®šåˆ¶çº§åˆ«\">2.1.3 å®šåˆ¶çº§åˆ«</h4>\n<p>Workflow Style Agent</p>\n<ul>\n<li>é«˜åº¦å¯å®šåˆ¶ï¼šå¯¹ä»£ç†é€»è¾‘ã€åŠ¨ä½œå’Œäº‹ä»¶æµæ‹¥æœ‰å®Œå…¨æŽ§åˆ¶æƒ</li>\n<li>è‡ªå®šä¹‰åŠ¨ä½œï¼šç”¨æˆ·å®šä¹‰æ‰€æœ‰åŠ¨ä½œåŠå…¶è¡Œä¸º</li>\n<li>çµæ´»äº‹ä»¶ï¼šç”¨æˆ·å¯ä»¥å®šä¹‰è‡ªå®šä¹‰äº‹ä»¶ç±»åž‹å’Œå¤„ç†é€»è¾‘</li>\n</ul>\n<p>ReActAgent</p>\n<ul>\n<li>æœ‰é™å®šåˆ¶ï¼šå®šåˆ¶ä¸»è¦é€šè¿‡æç¤ºè¯ã€æ¨¡åž‹å’Œè¾“å‡ºæ¨¡å¼å®žçŽ°</li>\n<li>é¢„å®šä¹‰åŠ¨ä½œï¼šä½¿ç”¨å†…ç½®åŠ¨ä½œå¦‚ start_action å’Œ stop_action</li>\n<li>æ ‡å‡†æŽ¥å£ï¼šä¸ºç±»ä¼¼çš„ LLM ä»»åŠ¡æä¾›ä¸€è‡´çš„æŽ¥å£</li>\n</ul>\n<h4 id=\"214-ä½¿ç”¨åœºæ™¯\">2.1.4 ä½¿ç”¨åœºæ™¯</h4>\n<p>Workflow Style Agent</p>\n<ul>\n<li>å…·æœ‰å›ºå®šåºåˆ—æˆ–æ¡ä»¶åˆ†æ”¯çš„å¤šæ­¥éª¤æµç¨‹</li>\n<li>éœ€è¦ç²¾ç¡®æŽ§åˆ¶ä»£ç†è¡Œä¸ºçš„åœºæ™¯</li>\n<li>åœ¨é¢„å®šé¡ºåºä¸­ä¸Žå¤šä¸ªå¤–éƒ¨ç³»ç»Ÿé›†æˆ</li>\n</ul>\n<p>ReActAgent</p>\n<ul>\n<li>éœ€è¦ LLM æŽ¨ç†ä½¿ç”¨å“ªäº›å·¥å…·/æ“ä½œçš„ä»»åŠ¡</li>\n<li>å¸¦å·¥å…·ä½¿ç”¨çš„æ ‡å‡†é—®ç­”</li>\n<li>LLM åº”è¯¥åŠ¨æ€å†³å®šå·¥ä½œæµç¨‹çš„åœºæ™¯</li>\n</ul>\n<p>åªè¦â€œé—®é¢˜ä¸å¯å®Œå…¨ç©·ä¸¾ã€è¦è·¨å¤šç³»ç»ŸæŸ¥è¯ã€å¹¶ä¸”éœ€è¦åœ¨å¯¹è¯ä¸­æ¾„æ¸…/åå•†/å†³ç­–â€ï¼Œå°±æ›´åº”è¯¥ç”¨ReActAgentï¼Œè€Œä¸æ˜¯çº¯ Workflowã€‚</p>\n<h4 id=\"215-å¼€å‘å¤æ‚åº¦\">2.1.5 å¼€å‘å¤æ‚åº¦</h4>\n<p>Workflow Style Agent</p>\n<ul>\n<li>æ›´é«˜çµæ´»æ€§ï¼šéœ€è¦æ›´å¤šä»£ç ä½†æŽ§åˆ¶åŠ›æ›´å¼º</li>\n<li>è‡ªå®šä¹‰é€»è¾‘ï¼šéœ€è¦å®žçŽ°æ‰€æœ‰åŠ¨ä½œé€»è¾‘</li>\n<li>æ— ä¸»è§ï¼šå¼€å‘äººå‘˜æŽ§åˆ¶ä»£ç†è¡Œä¸ºçš„æ‰€æœ‰æ–¹é¢</li>\n</ul>\n<p>ReActAgent</p>\n<ul>\n<li>è¾ƒä½Žé—¨æ§›ï¼šæ›´å®¹æ˜“ä¸Šæ‰‹ï¼Œå…·æœ‰é¢„å®šä¹‰åŠŸèƒ½</li>\n<li>ä»£ç é‡å°‘ï¼šè®¾ç½®æ‰€éœ€çš„ä»£ç æœ€å°‘</li>\n<li>æœ‰ä¸»è§ï¼šä»£è¡¨å¼€å‘äººå‘˜åšå‡ºè®¸å¤šå†³ç­–</li>\n</ul>\n<h4 id=\"216-æ€»ç»“\">2.1.6 æ€»ç»“</h4>\n<p>ReActAgent ä¸ºæ ‡å‡†çš„åŸºäºŽ LLM çš„æŽ¨ç†ä»»åŠ¡æä¾›äº†çŽ°æˆçš„è§£å†³æ–¹æ¡ˆï¼Œè€Œ Workflow Style Agent ä¸ºå¤æ‚çš„è‡ªå®šä¹‰ä»£ç†å®žçŽ°æä¾›äº†æœ€å¤§çš„çµæ´»æ€§ã€‚</p>\n<p>æœ‰äººæˆç§°ï¼šæ‹‰æŠ•èµ„ç”¨ Agent è®²æ•…äº‹ï¼Œåšä¸šåŠ¡è¸è¸å®žå®žç”¨ Workflow ã€‚è¿™å¥çŽ©ç¬‘èƒŒåŽæŠ˜å°„å‡ºçŽ°å®žçš„è€ƒé‡ï¼šWorkflow èƒœåœ¨ç¡®å®šæ€§ï¼Œè€Œ Agent èƒœåœ¨ä¸Šé™ã€‚</p>\n<h3 id=\"22-workflow\">2.2 workflow</h3>\n<p>å®˜æ–¹çš„å¿«é€Ÿå…¥é—¨ï¼ˆdocs\\content\\docs\\get-started\\quickstart\\workflow_agent.mdï¼‰é€šè¿‡ä¸¤ä¸ªæ¸è¿›å¼æµå¼ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ç”¨ Flink Agents æž„å»ºç”±å¤§æ¨¡åž‹é©±åŠ¨çš„æµæ°´çº¿ï¼š</p>\n<ul>\n<li><strong>è¯„è®ºåˆ†æž</strong>ï¼šç¤ºä¾‹ä¸€ ä¼šæŒç»­æŽ¥æ”¶å•†å“è¯„è®ºæµï¼Œå¹¶ç”¨å•ä¸ªä»£ç†ä»Žæ¯æ¡è¯„è®ºä¸­æå–è¯„åˆ†ï¼ˆ1-5ï¼‰ä»¥åŠä¸æ»¡æ„åŽŸå› ã€‚</li>\n<li><strong>äº§å“æ”¹è¿›å»ºè®®</strong>ï¼šåœ¨ç¤ºä¾‹ä¸€çš„åŸºç¡€ä¸Šï¼ŒæŒ‰çª—å£èšåˆæ¯æ¡è¯„è®ºçš„åˆ†æžç»“æžœï¼Œç”Ÿæˆå•†å“çº§åˆ«çš„æ±‡æ€»ï¼ˆè¯„åˆ†åˆ†å¸ƒã€å¸¸è§æŠ±æ€¨ï¼‰ï¼Œå†è°ƒç”¨ç¬¬äºŒä¸ªä»£ç†ä¸ºæ¯ä»¶å•†å“è¾“å‡ºå…·ä½“çš„æ”¹è¿›å»ºè®®ã€‚</li>\n</ul>\n<p>ä¸¤ä¸ªç¤ºä¾‹åˆåœ¨ä¸€èµ·ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ç”¨ Flink Agents æž„å»ºå¤šä»£ç†å·¥ä½œæµï¼Œå¹¶ç›´æŽ¥åœ¨ Flink ç‹¬ç«‹é›†ç¾¤ä¸Šè¿è¡Œã€‚</p>\n<h4 id=\"221-ä»£ç å¯¼è¯»\">2.2.1 ä»£ç å¯¼è¯»</h4>\n<h5 id=\"å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ\">å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ</h5>\n<p>åˆ›å»º Agents æ‰§è¡ŒçŽ¯å¢ƒï¼Œæ³¨å†Œå¯ä¾›ä»£ç†ä½¿ç”¨çš„èŠå¤©æ¨¡åž‹è¿žæŽ¥ã€‚</p>\n<pre><code class=\"language-Java\">// Set up the Flink streaming environment and the Agents execution environment.\nStreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\nAgentsExecutionEnvironment agentsEnv =\n        AgentsExecutionEnvironment.getExecutionEnvironment(env);\n\n// Add Ollama chat model connection to be used by the ReviewAnalysisAgent.\nagentsEnv.addResource(\n        \"ollamaChatModelConnection\",\n        ResourceType.CHAT_MODEL_CONNECTION,\n        CustomTypesAndResources.OLLAMA_SERVER_DESCRIPTOR);\n</code></pre>\n<h5 id=\"åˆ›å»ºä»£ç†\">åˆ›å»ºä»£ç†</h5>\n<p>ä»¥ <code>ReviewAnalysisAgent</code> ä¸ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•å®šä¹‰æç¤ºè¯ã€å·¥å…·ã€èŠå¤©æ¨¡åž‹å’ŒåŠ¨ä½œï¼›ä»¥åŠå¦‚ä½•å¤„ç†èŠå¤©å“åº”å¹¶å‘é€è¾“å‡ºäº‹ä»¶ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ [å·¥ä½œæµä»£ç†] æ–‡æ¡£ã€‚<code>ProductSuggestionAgent</code> çš„ä»£ç ä¸Žä¹‹ç±»ä¼¼ã€‚</p>\n<pre><code class=\"language-Java\">/**\n * An agent that uses a large language model (LLM) to analyze product reviews and generate a\n * satisfaction score and potential reasons for dissatisfaction.\n *\n * &lt;p&gt;This agent receives a product review and produces a satisfaction score and a list of reasons\n * for dissatisfaction. It handles prompt construction, LLM interaction, and output parsing.\n */\npublic class ReviewAnalysisAgent extends Agent {\n\n    private static final ObjectMapper MAPPER = new ObjectMapper();\n\n    @Prompt\n    public static org.apache.flink.agents.api.prompt.Prompt reviewAnalysisPrompt() {\n        return REVIEW_ANALYSIS_PROMPT;\n    }\n\n    @ChatModelSetup\n    public static ResourceDescriptor reviewAnalysisModel() {\n        return ResourceDescriptor.Builder.newBuilder(OllamaChatModelSetup.class.getName())\n                .addInitialArgument(\"connection\", \"ollamaChatModelConnection\")\n                .addInitialArgument(\"model\", \"qwen3:8b\")\n                .addInitialArgument(\"prompt\", \"reviewAnalysisPrompt\")\n                .addInitialArgument(\"tools\", Collections.singletonList(\"notifyShippingManager\"))\n                .addInitialArgument(\"extract_reasoning\", \"true\")\n                .build();\n    }\n\n    /**\n     * Tool for notifying the shipping manager when product received a negative review due to\n     * shipping damage.\n     *\n     * @param id The id of the product that received a negative review due to shipping damage\n     * @param review The negative review content\n     */\n    @Tool(\n            description =\n                    \"Notify the shipping manager when product received a negative review due to shipping damage.\")\n    public static void notifyShippingManager(\n            @ToolParam(name = \"id\") String id, @ToolParam(name = \"review\") String review) {\n        CustomTypesAndResources.notifyShippingManager(id, review);\n    }\n\n    /** Process input event and send chat request for review analysis. */\n    @Action(listenEvents = {InputEvent.class})\n    public static void processInput(InputEvent event, RunnerContext ctx) throws Exception {\n        String input = (String) event.getInput();\n        MAPPER.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);\n        CustomTypesAndResources.ProductReview inputObj =\n                MAPPER.readValue(input, CustomTypesAndResources.ProductReview.class);\n\n        ctx.getShortTermMemory().set(\"id\", inputObj.getId());\n\n        String content =\n                String.format(\n                        \"{\\n\" + \"\\\"id\\\": %s,\\n\" + \"\\\"review\\\": \\\"%s\\\"\\n\" + \"}\",\n                        inputObj.getId(), inputObj.getReview());\n        ChatMessage msg = new ChatMessage(MessageRole.USER, \"\", Map.of(\"input\", content));\n\n        ctx.sendEvent(new ChatRequestEvent(\"reviewAnalysisModel\", List.of(msg)));\n    }\n\n    @Action(listenEvents = ChatResponseEvent.class)\n    public static void processChatResponse(ChatResponseEvent event, RunnerContext ctx)\n            throws Exception {\n        JsonNode jsonNode = MAPPER.readTree(event.getResponse().getContent());\n        JsonNode scoreNode = jsonNode.findValue(\"score\");\n        JsonNode reasonsNode = jsonNode.findValue(\"reasons\");\n        if (scoreNode == null || reasonsNode == null) {\n            throw new IllegalStateException(\n                    \"Invalid response from LLM: missing 'score' or 'reasons' field.\");\n        }\n        List&lt;String&gt; result = new ArrayList&lt;&gt;();\n        if (reasonsNode.isArray()) {\n            for (JsonNode node : reasonsNode) {\n                result.add(node.asText());\n            }\n        }\n\n        ctx.sendEvent(\n                new OutputEvent(\n                        new CustomTypesAndResources.ProductReviewAnalysisRes(\n                                ctx.getShortTermMemory().get(\"id\").getValue().toString(),\n                                scoreNode.asInt(),\n                                result)));\n    }\n}\n</code></pre>\n<h5 id=\"ä¸Ž-flink-é›†æˆ\">ä¸Ž Flink é›†æˆ</h5>\n<p>è¯»å–æ–‡æœ¬æ–‡ä»¶ä¸­çš„å•†å“è¯„è®ºæµä½œä¸ºè¾“å…¥ DataStreamï¼Œç”¨ <code>ReviewAnalysisAgent</code> åˆ†æžå¹¶ç”Ÿæˆç»“æžœ DataStreamï¼Œæœ€åŽæ‰“å°è¾“å‡ºã€‚</p>\n<pre><code class=\"language-Java\">// Read product reviews from input_data.txt file as a streaming source.\n// Each element represents a ProductReview.\nDataStream&lt;String&gt; productReviewStream =\n       env.fromSource(\n               FileSource.forRecordStreamFormat(\n                               new TextLineInputFormat(),\n                               new Path(inputDataFile.getAbsolutePath()))\n                       .build(),\n               WatermarkStrategy.noWatermarks(),\n               \"streaming-agent-example\");\n\n// Use the ReviewAnalysisAgent to analyze each product review.\nDataStream&lt;Object&gt; reviewAnalysisResStream =\n       agentsEnv\n               .fromDataStream(productReviewStream)\n               .apply(new ReviewAnalysisAgent())\n               .toDataStream();\n\n// Print the analysis results to stdout.\nreviewAnalysisResStream.print();\n\n// Execute the Flink pipeline.\nagentsEnv.execute();\n</code></pre>\n<h3 id=\"23-react-agent\">2.3 ReAct Agent</h3>\n<p>æœ¬å¿«é€Ÿå…¥é—¨ç”¨ä¸€ä¸ªè¿·ä½ ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•ç”¨ Flink Agents æž„å»ºæµå¼ ReAct Agentï¼š</p>\n<p><strong>è¯„è®ºåˆ†æž</strong> ä»£ç†æŒç»­æ¶ˆè´¹å•†å“è¯„è®ºæµï¼Œç”¨å•ä¸ªä»£ç†æå–è¯„åˆ†ï¼ˆ1-5ï¼‰ä»¥åŠä¸æ»¡æ„åŽŸå› ï¼›è‹¥è¯„è®ºæ¶‰åŠç‰©æµä¸æ»¡ï¼Œåˆ™è‡ªåŠ¨é€šçŸ¥ç‰©æµç»ç†ã€‚</p>\n<h4 id=\"231-ä»£ç å¯¼è¯»\">2.3.1 ä»£ç å¯¼è¯»</h4>\n<h5 id=\"å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ-1\">å‡†å¤‡ä»£ç†æ‰§è¡ŒçŽ¯å¢ƒ</h5>\n<p>åˆ›å»º Agents æ‰§è¡ŒçŽ¯å¢ƒï¼Œæ³¨å†Œå¯ç”¨çš„èŠå¤©æ¨¡åž‹è¿žæŽ¥ä¸Žå·¥å…·ã€‚</p>\n<pre><code class=\"language-python\"># Set up the Flink streaming environment and the Agents execution environment.\nenv = StreamExecutionEnvironment.get_execution_environment()\nagents_env = AgentsExecutionEnvironment.get_execution_environment(env)\n\n# Add Ollama chat model connection and notify shipping manager tool to be used\n# by the Agent.\nagents_env.add_resource(\n    \"ollama_server\",\n    ResourceDescriptor(clazz=OllamaChatModelConnection, request_timeout=120),\n).add_resource(\n    \"notify_shipping_manager\", Tool.from_callable(notify_shipping_manager)\n)\n</code></pre>\n<h5 id=\"åˆ›å»º-react-agent\">åˆ›å»º ReAct Agent</h5>\n<p>å®žä¾‹åŒ– ReAct Agentï¼Œé…ç½®èŠå¤©æ¨¡åž‹ã€æç¤ºè¯ä»¥åŠç»“æžœçš„è¾“å‡ºæ¨¡å¼ã€‚</p>\n<pre><code class=\"language-python\">review_analysis_react_agent = ReActAgent(\n    chat_model=ResourceDescriptor(\n        clazz=OllamaChatModelSetup,\n        connection=\"ollama_server\",\n        model=\"qwen3:8b\",\n        tools=[\"notify_shipping_manager\"],\n    ),\n    prompt=review_analysis_react_prompt,\n    output_schema=ProductReviewAnalysisRes,\n)\n</code></pre>\n<h5 id=\"ä¸Ž-flink-é›†æˆ-1\">ä¸Ž Flink é›†æˆ</h5>\n<p>è¯»å–å•†å“è¯„è®ºæ–‡æœ¬æ–‡ä»¶ç”Ÿæˆ Source DataStreamï¼Œç”¨ ReAct Agent åˆ†æžå¹¶ç”Ÿæˆç»“æžœ DataStreamï¼Œæœ€åŽæ‰“å°è¾“å‡ºã€‚</p>\n<pre><code class=\"language-python\"># Read product reviews from a text file as a streaming source.\n# Each line in the file should be a JSON string representing a ProductReview.\nproduct_review_stream = env.from_source(\n    source=FileSource.for_record_stream_format(\n        StreamFormat.text_line_format(),\n        f\"file:///{current_dir}/resources/\",\n    )\n    .monitor_continuously(Duration.of_minutes(1))\n    .build(),\n    watermark_strategy=WatermarkStrategy.no_watermarks(),\n    source_name=\"streaming_agent_example\",\n).map(\n    lambda x: ProductReview.model_validate_json(\n        x\n    )  # Deserialize JSON to ProductReview.\n)\n\n# Use the ReAct agent to analyze each product review and notify the shipping manager\n# when needed.\nreview_analysis_res_stream = (\n    agents_env.from_datastream(\n        input=product_review_stream, key_selector=lambda x: x.id\n    )\n    .apply(review_analysis_react_agent)\n    .to_datastream()\n)\n\n# Print the analysis results to stdout.\nreview_analysis_res_stream.print()\n</code></pre>\n<h2 id=\"0x03-reactagent\">0x03 ReActAgent</h2>\n<p>ReActAgent æ˜¯ Agent æŠ½è±¡çš„ä¸€ä¸ªå…·ä½“å®žçŽ°ï¼Œå±•ç¤ºäº†è¿™äº›æŠ½è±¡å¦‚ä½•ååŒå·¥ä½œã€‚</p>\n<ul>\n<li>èµ„æºç®¡ç†ï¼šç®¡ç†èŠå¤©æ¨¡åž‹å’Œæç¤ºè¯èµ„æº</li>\n<li>Actionå®šä¹‰ï¼šå®šä¹‰ start_action å’Œ stop_action å¤„ç†è¾“å…¥å’Œè¾“å‡º</li>\n<li>äº‹ä»¶å¤„ç†ï¼šå“åº” InputEvent å’Œ ChatResponseEvent</li>\n<li>é…ç½®ç®¡ç†ï¼šæ”¯æŒé”™è¯¯å¤„ç†ç­–ç•¥é…ç½®</li>\n<li>è¾“å‡ºæ ¼å¼åŒ–ï¼šæ”¯æŒåŸºäºŽ schema çš„è¾“å‡ºéªŒè¯å’Œæ ¼å¼åŒ–</li>\n</ul>\n<p>è¿™ç§æŠ½è±¡è®¾è®¡ä½¿å¾— Agent ç³»ç»Ÿå…·æœ‰é«˜åº¦çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ç»„åˆä¸åŒçš„èµ„æºã€actionså’Œé…ç½®æ¥æž„å»ºæ»¡è¶³ç‰¹å®šéœ€æ±‚çš„Agentã€‚</p>\n<h3 id=\"31-å®šä¹‰\">3.1 å®šä¹‰</h3>\n<p>ReActAgent çš„å®šä¹‰å¦‚ä¸‹ã€‚</p>\n<pre><code class=\"language-python\">class ReActAgent(Agent):\n    \"\"\"Built-in implementation of ReAct agent which is based on the function\n    call ability of llm.\n\n    This implementation is not based on the foundational ReAct paper which uses\n    prompt to force llm output contain &lt;Thought&gt;, &lt;Action&gt; and &lt;Observation&gt; and\n    extract tool calls by text parsing. For a more robust and feature-rich\n    implementation we use the tool/function call ability of current llm, and get\n    the tool calls from response directly.\n\n    Example:\n        ::\n\n            class OutputData(BaseModel):\n                result: int\n\n\n            env = AgentsExecutionEnvironment.get_execution_environment()\n\n            # register resource to execution environment\n            (\n                env.add_resource(\n                    \"ollama\",\n                    ResourceDescriptor(clazz=OllamaChatModelConnection, model=model),\n                )\n                .add_resource(\"add\", add)\n                .add_resource(\"multiply\", multiply)\n            )\n\n            # prepare prompt\n            prompt = Prompt.from_messages(\n                messages=[\n                    ChatMessage(\n                        role=MessageRole.SYSTEM,\n                        content='An example of output is {\"result\": 30.32}.',\n                    ),\n                    ChatMessage(\n                        role=MessageRole.USER, content=\"What is ({a} + {b}) * {c}\"\n                    ),\n                ],\n            )\n\n            # create ReAct agent.\n            agent = ReActAgent(\n                chat_model=ResourceDescriptor(\n                    clazz=OllamaChatModelSetup,\n                    connection=\"ollama_server\",\n                    tools=[\"notify_shipping_manager\"],\n                ),\n                prompt=prompt,\n                output_schema=OutputData,\n            )\n    \"\"\"\n\n    def __init__(\n        self,\n        *,\n        chat_model: ResourceDescriptor,\n        prompt: Prompt | None = None,\n        output_schema: type[BaseModel] | RowTypeInfo | None = None,\n    ) -&gt; None:\n        \"\"\"Init method of ReActAgent.\n\n        Parameters\n        ----------\n        chat_model : ResourceDescriptor\n            The descriptor of the chat model used in this ReAct agent.\n        prompt : Optional[Prompt] = None\n            Prompt to instruct the llm, could include input and output example,\n            task and so on.\n        output_schema : Optional[Union[type[BaseModel], RowTypeInfo]] = None\n            The schema should be RowTypeInfo or subclass of BaseModel. When user\n            provide output schema, ReAct agent will add system prompt to instruct\n            response format of llm, and add output parser according to the schema.\n        \"\"\"\n        super().__init__()\n        self.add_resource(_DEFAULT_CHAT_MODEL, chat_model)\n\n        if output_schema:\n            if isinstance(output_schema, type) and issubclass(output_schema, BaseModel):\n                json_schema = output_schema.model_json_schema()\n            elif isinstance(output_schema, RowTypeInfo):\n                json_schema = str(output_schema)\n            else:\n                err_msg = f\"Output schema {output_schema.__class__} is not supported.\"\n                raise TypeError(err_msg)\n            schema_prompt = f\"The final response should be json format, and match the schema {json_schema}.\"\n            self._resources[ResourceType.PROMPT][_DEFAULT_SCHEMA_PROMPT] = (\n                Prompt.from_text(text=schema_prompt)\n            )\n\n        if prompt:\n            self._resources[ResourceType.PROMPT][_DEFAULT_USER_PROMPT] = prompt\n\n        self.add_action(\n            name=\"stop_action\",\n            events=[ChatResponseEvent],\n            func=self.stop_action,\n            output_schema=OutputSchema(output_schema=output_schema),\n        )\n</code></pre>\n<h3 id=\"32-æ·±åº¦å®šåˆ¶\">3.2 æ·±åº¦å®šåˆ¶</h3>\n<p>Flink å¯¹ ReActAgent åšäº†æ·±åº¦å®šåˆ¶ï¼Œä½¿å…¶èƒ½åœ¨åˆ†å¸ƒå¼æµå¤„ç†çŽ¯å¢ƒä¸­é«˜æ•ˆæ‰§è¡Œï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½æ¥ç®€åŒ– LLM åº”ç”¨å¼€å‘ã€‚</p>\n<h4 id=\"321-reactagent-ç‰¹è‰²\">3.2.1 ReActAgent ç‰¹è‰²</h4>\n<h5 id=\"æµå¼å¤„ç†é€‚é…\">æµå¼å¤„ç†é€‚é…</h5>\n<p>Flink å°†ä¼ ç»Ÿçš„ ReAct æ¨¡å¼é€‚é…åˆ°äº†æµå¤„ç†çŽ¯å¢ƒä¸­ï¼š</p>\n<ul>\n<li>é€šè¿‡ InputEvent å’Œ OutputEvent åŒ…è£…è¾“å…¥è¾“å‡ºæ•°æ®</li>\n<li>åˆ©ç”¨ Flink çš„äº‹ä»¶é©±åŠ¨æž¶æž„å®žçŽ°å¼‚æ­¥å¤„ç†</li>\n<li>é€šè¿‡ RunnerContext ç®¡ç†çŠ¶æ€å’Œèµ„æº</li>\n</ul>\n<pre><code class=\"language-python\">agents_env = AgentsExecutionEnvironment.get_execution_environment(env)\nagents_env.fromDataStream(dataStream) # ä»ŽDataStreamè¾“å…¥\nagents_env.fromTable(table) # ä»ŽTableè¾“å…¥\nagents_env.fromList(list) # ä»ŽListè¾“å…¥\n\nreview_analysis_res_stream = (\n        agents_env.from_datastream( # ä»ŽDataSteamåˆ›å»ºAgentæµç¨‹\n            input=product_review_stream, key_selector=lambda x: x.id\n        )\n        .apply(review_analysis_react_agent) # åº”ç”¨Agent\n        .to_datastream() # è½¬æ¢å›žStream\n    )\n</code></pre>\n<h5 id=\"ç‰¹å®šçš„è¡Œä¸ºæ¨¡å¼\">ç‰¹å®šçš„è¡Œä¸ºæ¨¡å¼</h5>\n<p>ReActAgent å®žçŽ°äº†ç‰¹å®šçš„ ReActï¼ˆReasoning + Actionï¼‰èŒƒå¼ï¼Œè¿™æ˜¯ä¸€ç§ç»“åˆæŽ¨ç†å’Œè¡ŒåŠ¨çš„ AI Agent æ¨¡å¼ã€‚å®ƒå†…ç½®äº†ä¸¤ä¸ªæ ¸å¿ƒåŠ¨ä½œï¼šstart_action()å’Œ stop_action()ã€‚ä½¿ç”¨é¢„å®šä¹‰çš„æµç¨‹æ¥å¤„ç†è¾“å…¥å¹¶ç”Ÿæˆè¾“å‡ºï¼Œè€Œéžè®©ç”¨æˆ·å®Œå…¨è‡ªå®šä¹‰è¡Œä¸ºé€»è¾‘ã€‚</p>\n<ul>\n<li>start_action æŽ¥æ”¶è¾“å…¥å¹¶å‘é€ ChatRequestEvent</li>\n<li>stop_action å¤„ç† ChatResponseEvent å¹¶äº§ç”Ÿæœ€ç»ˆè¾“å‡º</li>\n</ul>\n<h5 id=\"é”®æŽ§çŠ¶æ€æ”¯æŒ\">é”®æŽ§çŠ¶æ€æ”¯æŒ</h5>\n<p>æ”¯æŒFlinkçš„é”®æŽ§çŠ¶æ€ç‰¹æ€§</p>\n<pre><code class=\"language-python\">review_analysis_res_stream = (\n    agents_env.from_datastream(\n        input=product_review_stream, key_selector=lambda x: x.id\n    )\n    .apply(review_analysis_react_agent)\n    .to_datastream()\n)\n</code></pre>\n<h5 id=\"llm-é›†æˆä¼˜åŒ–\">LLM é›†æˆä¼˜åŒ–</h5>\n<p>ReActAgent ä¸“é—¨ä¸º LLM äº¤äº’è¿›è¡Œä¼˜åŒ–ï¼šå†…ç½®äº†æç¤ºè¯ç®¡ç†å’Œæ ¼å¼åŒ–åŠŸèƒ½ï¼›æ”¯æŒç»“æž„åŒ–è¾“å‡ºæ¨¡å¼ï¼Œå¯ä»¥æŒ‡å®šè¾“å‡ºçš„æ•°æ®schemaï¼›é›†æˆäº†é”™è¯¯å¤„ç†ç­–ç•¥ï¼Œå½“LLMè¾“å‡ºä¸ç¬¦åˆé¢„æœŸæ ¼å¼æ—¶å¯ä»¥é€‰æ‹©å¤±è´¥æˆ–è€…å¿½ç•¥ã€‚</p>\n<h5 id=\"èµ„æºç®¡ç†æ–¹å¼\">èµ„æºç®¡ç†æ–¹å¼</h5>\n<p>ReActAgent ä¸­è‡ªåŠ¨æ·»åŠ é»˜è®¤èµ„æºï¼Œç›¸æ¯”æ™®é€šçš„Agentï¼ŒReActAgent ä¼šè‡ªåŠ¨ä¸ºç”¨æˆ·è®¾ç½®å¥½å¿…è¦çš„èµ„æºï¼Œç®€åŒ–ä½¿ç”¨æµç¨‹ã€‚é€šè¿‡ç»Ÿä¸€çš„èµ„æºç®¡ç†ç³»ç»Ÿä¸ŽFlinké›†æˆã€‚ReActAgent é€šè¿‡ _DEFAULT_CHAT_MODEL ç­‰å¸¸é‡å¼•ç”¨åœ¨ AgentsExecutionEnvironment ä¸­æ³¨å†Œçš„èµ„æºã€‚</p>\n<pre><code class=\"language-python\">agents_env.add_resource(_DEFAULT_CHAT_MODEL, chat_model)\nagents_env.addResource(\"ollama_server\", ResourceDescriptor(...))\nagents_env.addResource(\"notify_shipping_manager\", Tool.from_callable(...))\n</code></pre>\n<h5 id=\"ç±»åž‹ä¿¡æ¯å¤„ç†\">ç±»åž‹ä¿¡æ¯å¤„ç†</h5>\n<p>Flink Agentèƒ½å¤Ÿå¤„ç†Flinkçš„ç±»åž‹ç³»ç»Ÿ</p>\n<pre><code class=\"language-python\">        if (outputSchema != null) {\n            String jsonSchema;\n            // æ”¯æŒRowTypeInfoå’ŒPOJOç±»åž‹\n            if (outputSchema instanceof RowTypeInfo) {\n            \t// å¤„ç†Rowç±»åž‹\n                jsonSchema = outputSchema.toString();\n                outputSchema = new OutputSchema((RowTypeInfo) outputSchema);\n            } else if (outputSchema instanceof Class) {\n            \t// å¤„ç†POJOç±»åž‹\n                try {\n                    jsonSchema = mapper.generateJsonSchema((Class&lt;?&gt;) outputSchema).toString();\n                } catch (JsonMappingException e) {\n                    throw new RuntimeException(e);\n                }\n            } \n</code></pre>\n<h5 id=\"é”™è¯¯å¤„ç†æœºåˆ¶\">é”™è¯¯å¤„ç†æœºåˆ¶</h5>\n<p>Flink ä¸º ReActAgent å®žçŽ°äº†çµæ´»çš„å¤„ç†å¤„ç†ç­–ç•¥ï¼Œè¿è¡Œç”¨æˆ·é€‰æ‹©åœ¨è§£æžå¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸è¿˜æ˜¯å¿½ç•¥é”™è¯¯ã€‚</p>\n<pre><code class=\"language-python\">        except Exception:\n            if error_handling_strategy == ErrorHandlingStrategy.IGNORE:\n                logging.warning(\n                    f\"The response of llm {output} doesn't match schema constraint, ignoring.\"\n                )\n                return\n            elif error_handling_strategy == ErrorHandlingStrategy.FAIL:\n                raise\n</code></pre>\n<h5 id=\"ç»“æž„åŒ–è¾“å‡ºæ”¯æŒ\">ç»“æž„åŒ–è¾“å‡ºæ”¯æŒ</h5>\n<p>Flink ä¸º ReActAgent æ·»åŠ äº†ç»“æž„åŒ–è¾“å‡ºçš„èƒ½åŠ›ï¼Œè¿™æ ·å¯ä»¥è®© LLM çš„è¾“å‡ºç¬¦åˆé¢„å®šä¹‰çš„æ•°æ®ç»“æž„ï¼Œä¾¿äºŽåŽç»­ç®¡ç†ã€‚</p>\n<pre><code class=\"language-python\">        if output_schema:\n            if isinstance(output_schema, type) and issubclass(output_schema, BaseModel):\n                json_schema = output_schema.model_json_schema()\n            elif isinstance(output_schema, RowTypeInfo):\n                json_schema = str(output_schema)\n            else:\n                err_msg = f\"Output schema {output_schema.__class__} is not supported.\"\n                raise TypeError(err_msg)\n            schema_prompt = f\"The final response should be json format, and match the schema {json_schema}.\"\n            self._resources[ResourceType.PROMPT][_DEFAULT_SCHEMA_PROMPT] = (\n                Prompt.from_text(text=schema_prompt)\n            )\n</code></pre>\n<h5 id=\"æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ\">æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ</h5>\n<p>Flink å®žçŽ°äº†ä¸€ä¸ªå®Œæ•´çš„æç¤ºè¯æ¨¡æ¿ç®¡ç†ç³»ç»Ÿï¼š</p>\n<ul>\n<li>æ”¯æŒå­—ç¬¦ä¸²æ¨¡æ¿å’Œæ¶ˆæ¯åˆ—è¡¨æ¨¡åž‹</li>\n<li>æä¾›æ ¼å¼åŒ–åŠŸèƒ½ï¼Œå¯ä»¥åŠ¨æ€æ›¿æ¢æ¨¡æ¿ä¸­çš„å ä½ç¬¦</li>\n<li>è‡ªåŠ¨å¤„ç†ä¸åŒç±»åž‹è¾“å…¥çš„è½¬æ¢</li>\n</ul>\n<h5 id=\"å·¥å…·è°ƒç”¨é›†æˆ\">å·¥å…·è°ƒç”¨é›†æˆ</h5>\n<p>Flink å°†å·¥å…·è°ƒç”¨é›†æˆåˆ° ReActAgentä¸­ã€‚</p>\n<pre><code class=\"language-python\"># æ³¨å†Œå·¥å…·èµ„æº\n    # Add Ollama chat model connection and notify shipping manager tool to be used\n    # by the Agent.\n    agents_env.add_resource(\n        \"ollama_server\",\n        ResourceDescriptor(clazz=OllamaChatModelConnection, request_timeout=120),\n    ).add_resource(\n        \"notify_shipping_manager\", Tool.from_callable(notify_shipping_manager)\n    )\n    \n# åœ¨Agent ä¸­ä½¿ç”¨å·¥å…·\n    # Create react agent\n    review_analysis_react_agent = ReActAgent(\n        chat_model=ResourceDescriptor(\n            clazz=OllamaChatModelSetup,\n            connection=\"ollama_server\",\n            model=\"qwen3:8b\",\n            tools=[\"notify_shipping_manager\"],\n        ),\n        prompt=review_analysis_react_prompt,\n        output_schema=ProductReviewAnalysisRes,\n    )\n</code></pre>\n<h5 id=\"è¿è¡Œæ—¶åä½œ\">è¿è¡Œæ—¶åä½œ</h5>\n<ul>\n<li>æ‰§è¡ŒçŽ¯å¢ƒè´Ÿè´£è°ƒåº¦å’Œè¿è¡ŒAgentä¸­çš„å„ä¸ªç»„ä»¶</li>\n<li>Agenté€šè¿‡RunnerContext è®¿é—®åœ¨çŽ¯å¢ƒä¸­æ³¨å†Œçš„èµ„æº</li>\n<li>æ•´ä¸ªè¿‡ç¨‹é‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ï¼Œé€šè¿‡å‘é€å’ŒæŽ¥æ”¶äº‹ä»¶æ¥æŽ¨è¿›æ‰§è¡Œæµç¨‹</li>\n</ul>\n<h3 id=\"33-å…¸åž‹æ‰§è¡Œæµç¨‹\">3.3 å…¸åž‹æ‰§è¡Œæµç¨‹</h3>\n<p>å¯¹äºŽ ReActAgent æ¥è¯´ï¼Œå…·ä½“é€‚é…æµç¨‹å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>çŽ¯å¢ƒåˆå§‹åŒ–ï¼šé€šè¿‡ AgentsExecutionEnvironment.get_execution_environment(env) èŽ·å–é€‚å½“çš„æ‰§è¡ŒçŽ¯å¢ƒ</li>\n<li>èµ„æºé…ç½®ï¼šä½¿ç”¨ addResource() æ·»åŠ æ¨¡åž‹ã€å·¥å…·ç­‰èµ„æº</li>\n<li>è¾“å…¥è®¾ç½®ï¼šé€šè¿‡fromDataStream()ã€ fromTable()ç­‰è®¾ç½®è¾“å…¥æº</li>\n<li>Agentåº”ç”¨ï¼šä½¿ç”¨ apply()æ–¹æ³•åº”ç”¨Agent é€»è¾‘</li>\n<li>è¾“å‡ºèŽ·å–ï¼šé€šè¿‡ toDataStream() èŽ·å–å¤„ç†åŽçš„ DataStream</li>\n<li>æ‰§è¡Œï¼šé€šè¿‡execute() è§¦å‘Flinkä½œä¸šæ‰§è¡Œ</li>\n</ul>\n<p>å…¸åž‹çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>run å‡½æ•°æŽ¥æ”¶åˆ°è¾“å…¥æ•°æ®</li>\n<li>åˆ›å»ºInputEvent å¹¶å‘é€åˆ°äº‹ä»¶é˜Ÿåˆ—</li>\n<li>start_actionå¤„ç†InputEventï¼Œæ ¼å¼åŒ–è¾“å…¥å¹¶å‘é€ ChatRequestEvent</li>\n<li>LLMå¤„ç†åŽäº§ç”Ÿ ChatResponseEvent</li>\n<li>stop_action å¤„ç† ChatResponseEventï¼Œè§£æžç»“æžœå¹¶å‘é€ OutputEvent</li>\n<li>run å‡½æ•°æ”¶é›† OutputEvent å¹¶è¿”å›žç»“æžœ</li>\n</ul>\n<p>å…³é”®ç‰¹ç‚¹æ˜¯ï¼š</p>\n<ul>\n<li>äº‹ä»¶é©±åŠ¨ï¼šä½¿ç”¨äº‹ä»¶é˜Ÿåˆ—é©±åŠ¨æ•´ä¸ªæ‰§è¡Œæµç¨‹</li>\n<li>ä¸Šä¸‹æ–‡éš”ç¦»ï¼šæ¯ä¸ªé”®å€¼å¯¹åº”ç‹¬ç«‹çš„æ‰§è¡Œä¸Šä¸‹æ–‡</li>\n<li>å¼‚æ­¥æ”¯æŒï¼šè™½ç„¶æœ¬åœ°æ‰§è¡ŒçŽ¯å¢ƒå›žé€€åˆ°åŒæ­¥æ‰§è¡Œï¼Œä½†ä»ç„¶æ”¯æŒå¼‚æ­¥æŽ¥å£</li>\n<li>çŠ¶æ€ç®¡ç†ï¼šé€šè¿‡ LocalRunnerContext ç®¡ç†çŸ­æœŸè®°å¿†å’Œèµ„æºé…ç½®</li>\n</ul>\n<h3 id=\"34-start_action-ä¸Ž-stop_action\">3.4 start_action ä¸Ž stop_action</h3>\n<p><strong>æ•´ä½“æµç¨‹ç‰¹è‰²</strong></p>\n<p>è¿™ä¸¤ä¸ª action æž„æˆå®Œæ•´çš„ ReAct æ¨¡å¼ï¼š</p>\n<ul>\n<li>å¼€å§‹-ç»“æŸæ¨¡å¼ï¼šstart_action ä½œä¸ºå…¥å£ï¼Œå°†åŽŸå§‹è¾“å…¥è½¬åŒ–ä¸ºé€‚åˆ LLM å¤„ç†çš„æ ¼å¼ï¼›stop_action ä½œä¸ºå‡ºå£ï¼Œå°† LLM å“åº”è½¬æ¢ä¸ºç»“æž„åŒ–è¾“å‡ºã€‚</li>\n<li>ä¸­é—´å¤„ç†é€æ˜ŽåŒ–ï¼šç”¨æˆ·æ— éœ€å…³å¿ƒä¸­é—´æ­¥éª¤ï¼ˆå¦‚å·¥å…·è°ƒç”¨ã€ä¸Šä¸‹æ–‡æ£€ç´¢ç­‰ï¼‰ï¼Œè¿™äº›ç”±å†…ç½®çš„ CHAT_MODEL_ACTIONã€TOOL_CALL_ACTION ç­‰è‡ªåŠ¨å¤„ç†ã€‚</li>\n<li>å¯é…ç½®æ€§ï¼šæ”¯æŒè‡ªå®šä¹‰ Promptã€è¾“å‡º schema å®šä¹‰åŠé”™è¯¯å¤„ç†ç­–ç•¥ã€‚</li>\n</ul>\n<p><strong>åŠŸèƒ½</strong></p>\n<p>ReActAgent çš„ start_action ä¸Ž stop_action å„å…·ç‰¹å¾ï¼ŒäºŒè€…åˆ†åˆ«æ‰¿æ‹…å¯¹è¯çš„å‘èµ·ä¸Žç»ˆç»“èŒè´£ã€‚</p>\n<ul>\n<li>start_action è´Ÿè´£è¾“å…¥äº‹ä»¶çš„å¤„ç†ã€‚å®ƒé¦–å…ˆæŽ¥æ”¶ InputEventï¼Œä½œä¸ºæ•´ä¸ª Agent æµç¨‹çš„èµ·ç‚¹ï¼Œå¯æŽ¥å—åŽŸå§‹ç±»åž‹ã€å¤æ‚å¯¹è±¡æˆ– Row ç­‰å¤šç§æ•°æ®ã€‚è‹¥æä¾› Promptï¼Œåˆ™ä»¥æ­¤æ ¼å¼åŒ–ç”¨æˆ·è¾“å…¥ï¼Œå°†ç®€å•å­—ç¬¦ä¸²æˆ–å¤æ‚å¯¹è±¡ï¼ˆå¦‚ Row æˆ– POJOï¼‰çš„å±žæ€§è‡ªåŠ¨æå–å¹¶å¡«å…¥æ¨¡æ¿ã€‚éšåŽï¼Œç³»ç»Ÿè‡ªåŠ¨è¿½åŠ  schema promptï¼Œçº¦æŸå¤§æ¨¡åž‹è¾“å‡ºç»“æž„ï¼Œå†å°†æ•´ç†åŽçš„å†…å®¹å°è£…ä¸º ChatRequestEventï¼Œè§¦å‘åŽç»­å¤„ç†ï¼Œé»˜è®¤è°ƒç”¨ _DEFAULT_CHAT_MODEL å®Œæˆé¦–æ¬¡ç”Ÿæˆã€‚</li>\n<li>stop_action åˆ™å¤„ç†è¾“å‡ºäº‹ä»¶ã€‚å®ƒä»¥ ChatResponseEvent ä¸ºè¾“å…¥ï¼Œæ ‡å¿—å¤§æ¨¡åž‹ç”Ÿæˆå®Œæ¯•ï¼Œæ˜¯æ•´ä¸ªæµç¨‹çš„ç»ˆç‚¹ã€‚è¯¥åŠ¨ä½œæ”¯æŒæŒ‰ schema è§£æžä¸ŽéªŒè¯è¿”å›žç»“æžœï¼Œå¯å°† JSON æ–‡æœ¬è½¬æ¢ä¸º Pydantic æ¨¡åž‹æˆ– RowTypeInfo æŒ‡å®šç»“æž„ï¼Œå¹¶æä¾›é”™è¯¯å¤„ç†ç­–ç•¥ï¼ˆå¿½ç•¥æˆ–æŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œä¿è¯è¾“å‡ºç±»åž‹å®‰å…¨ä¸Žä¸šåŠ¡ä¸€è‡´æ€§ã€‚</li>\n</ul>\n<p><strong>ä¸Žå…¶ä»–ç»„ä»¶çš„åä½œ</strong></p>\n<p>åœ¨ ReActAgent åˆå§‹åŒ–æ—¶æ³¨å†Œè¿™ä¸¤ä¸ª actionï¼š</p>\n<pre><code class=\"language-python\">self.add_action(\n    name=\"stop_action\",\n    events=[ChatResponseEvent],\n    func=self.stop_action,\n    output_schema=OutputSchema(output_schema=output_schema),\n)\n</code></pre>\n<p>è¿™ä¸¤ä¸ª action ä¸Ž Agent å†…ç½®çš„å…¶ä»– actionï¼ˆå¦‚å·¥å…·è°ƒç”¨ã€ä¸Šä¸‹æ–‡æ£€ç´¢ï¼‰é…åˆå·¥ä½œï¼Œåœ¨ ActionExecutionOperator ä¸­å½¢æˆä¸€ä¸ªå®Œæ•´çš„äº‹ä»¶é©±åŠ¨å¤„ç†é“¾ã€‚</p>\n<h3 id=\"35-è¾“å…¥è¾“å‡º\">3.5 è¾“å…¥è¾“å‡º</h3>\n<p>Flink Agent çš„è¾“å…¥è¾“å‡ºå…·æœ‰ä»¥ä¸‹å‡ ä¸ªæ˜¾è‘—ç‰¹ç‚¹ï¼Œå¹¶é€šè¿‡ç‰¹å®šæœºåˆ¶ä¸ŽFlinkè¿›è¡Œé€‚é…ã€‚</p>\n<h4 id=\"351-äº‹ä»¶é©±åŠ¨æž¶æž„\">3.5.1 äº‹ä»¶é©±åŠ¨æž¶æž„</h4>\n<p>Flink Agent åŸºäºŽäº‹ä»¶é©±åŠ¨æ¨¡åž‹ï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯é€šè¿‡äº‹ä»¶å¯¹è±¡è¿›è¡Œä¼ é€’ï¼š</p>\n<ul>\n<li>è¾“å…¥ï¼šé€šè¿‡InputEvent å°è£…åŽŸå§‹æ•°æ®</li>\n<li>è¾“å‡ºï¼šé€šè¿‡OutputEventå°è£…å¤„ç†ç»“æžœ</li>\n<li>ä¸­é—´äº‹ä»¶ï¼šåŒ…æ‹¬ ChatRequestEventã€ChatResponseEventã€ToolRequestEventã€ToolResponseEventç­‰</li>\n</ul>\n<h4 id=\"352-ç»Ÿä¸€çš„æ•°æ®å°è£…\">3.5.2 ç»Ÿä¸€çš„æ•°æ®å°è£…</h4>\n<p>æ‰€æœ‰æ•°æ®éƒ½è¢«å°è£…æˆäº‹ä»¶å¯¹è±¡ï¼Œä¾¿äºŽAgentå†…éƒ¨æµè½¬å’Œå¤„ç†ã€‚</p>\n<h4 id=\"353-æ”¯æŒå¤šç§æ•°æ®ç±»åž‹\">3.5.3 æ”¯æŒå¤šç§æ•°æ®ç±»åž‹</h4>\n<p>è¾“å…¥æ”¯æŒå¤šç§æ•°æ®ç±»åž‹ï¼š</p>\n<ul>\n<li>åŸºæœ¬æ•°æ®ç±»åž‹</li>\n<li>Flink Rowå¯¹è±¡</li>\n<li>POJOå¯¹è±¡</li>\n<li>å¤æ‚åµŒå¥—ç»“æžœ</li>\n</ul>\n<p>è¾“å‡ºåŒæ ·æ”¯æŒçµæ´»çš„æ•°æ®ç»“æž„ï¼Œå¯ä»¥é€šè¿‡schemaè¿›è¡Œçº¦æŸ</p>\n<h4 id=\"354-å†…ç½®æ¨¡æ¿æ”¯æŒ\">3.5.4 å†…ç½®æ¨¡æ¿æ”¯æŒ</h4>\n<p>é€šè¿‡Promptç±»æ”¯æŒæ¨¡æ¿åŒ–è¾“å…¥å¤„ç†ï¼Œå¯ä»¥å®šä¹‰å¤æ‚çš„æç¤ºè¯æ¨¡æ¿</p>\n<h3 id=\"36-æ¨¡æ¿ç³»ç»Ÿ\">3.6 æ¨¡æ¿ç³»ç»Ÿ</h3>\n<p>æ¨¡æ¿å¯ä»¥ç”¨åœ¨æç¤ºè¯å’ŒSchemaã€‚Flink Agent ä¸­çš„æ¨¡æ¿ç³»ç»Ÿä¸»è¦åœ¨ Prompt ç±»ä¸­å®žçŽ°ï¼Œæ”¯æŒä¸¤ç§ç±»åž‹çš„æ¨¡æ¿ï¼š</p>\n<h4 id=\"361-å­—ç¬¦ä¸²æ¨¡æ¿\">3.6.1 å­—ç¬¦ä¸²æ¨¡æ¿</h4>\n<p>æœ€åŸºæœ¬çš„æ¨¡æ¿å½¢å¼ï¼Œå°±æ˜¯ä¸€ä¸ªåŒ…å«å ä½ç¬¦çš„å­—ç¬¦ä¸²ï¼š</p>\n<pre><code class=\"language-java\">        String specialTemplate = \"Handle special chars: {text} with symbols like @#$%^&amp;*()\";\n        Prompt specialPrompt = new Prompt(specialTemplate);\n\n        Map&lt;String, String&gt; specialVars = new HashMap&lt;&gt;();\n        specialVars.put(\"text\", \"Hello &amp; Welcome!\");\n\n        String result = specialPrompt.formatString(specialVars);\n\n</code></pre>\n<h4 id=\"362-æ¶ˆæ¯æ¨¡æ¿\">3.6.2 æ¶ˆæ¯æ¨¡æ¿</h4>\n<p>æ›´å¤æ‚çš„æ¨¡æ¿å½¢å¼ï¼ŒåŒ…å«å¤šä¸ª ChatMessage å¯¹è±¡ï¼Œå¯ä»¥æŒ‡å®šä¸åŒçš„è§’è‰²ã€‚</p>\n<pre><code class=\"language-python\">        List&lt;ChatMessage&gt; multipleMessages =\n                Arrays.asList(\n                        new ChatMessage(MessageRole.SYSTEM, \"You are a helpful assistant.\"),\n                        new ChatMessage(MessageRole.USER, \"First message\"),\n                        new ChatMessage(MessageRole.ASSISTANT, \"I understand\"),\n                        new ChatMessage(\n                                MessageRole.USER, \"Second message - this should be the response\"));\n\n        Prompt multiPrompt = new Prompt(multipleMessages);\n\n</code></pre>\n<p>æ¨¡æ¿çš„ç®¡ç†æµç¨‹å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>æ¨¡æ¿åˆ›å»ºï¼šç”¨æˆ·åˆ›å»º Prompt  å¯¹è±¡ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ¶ˆæ¯åˆ—è¡¨ã€‚</li>\n<li>å˜é‡æ›¿æ¢ï¼šä½¿ç”¨ formatString() æˆ–è€… formatMessages() æ–¹æ³•å¯¹ä¼ å…¥å˜é‡æ˜ å°„è¿›è¡Œæ›¿æ¢</li>\n<li>LLM è°ƒç”¨ï¼šæ ¼å¼åŒ–çš„æ¶ˆæ¯è¢«å‘é€ç»™LLMè¿›è¡Œå¤„ç†ã€‚</li>\n</ul>\n<pre><code class=\"language-python\">class Prompt(SerializableResource, ABC):\n    \"\"\"Base prompt abstract.\"\"\"\n\n    @staticmethod\n    def from_messages(messages: Sequence[ChatMessage]) -&gt; \"Prompt\":\n        \"\"\"Create prompt from sequence of ChatMessage.\"\"\"\n        return LocalPrompt(template=messages)\n\n    @staticmethod\n    def from_text(text: str) -&gt; \"Prompt\":\n        \"\"\"Create prompt from text string.\"\"\"\n        return LocalPrompt(template=text)\n\n    @abstractmethod\n    def format_string(self, **kwargs: str) -&gt; str:\n        \"\"\"Generate text string from template with additional arguments.\"\"\"\n\n    @abstractmethod\n    def format_messages(\n        self, role: MessageRole = MessageRole.SYSTEM, **kwargs: str\n    ) -&gt; List[ChatMessage]:\n        \"\"\"Generate list of ChatMessage from template with additional arguments.\"\"\"\n\n    @classmethod\n    @override\n    def resource_type(cls) -&gt; ResourceType:\n        \"\"\"Get the resource type.\"\"\"\n        return ResourceType.PROMPT\n\nclass LocalPrompt(Prompt):\n    \"\"\"Prompt for a language model.\n\n    Attributes:\n    ----------\n    template : Union[Sequence[ChatMessage], str]\n        The prompt template.\n    \"\"\"\n\n    template: Sequence[ChatMessage] | str\n\n    def format_string(self, **kwargs: str) -&gt; str:\n        \"\"\"Generate text string from template with input arguments.\"\"\"\n        if isinstance(self.template, str):\n            return format_string(self.template, **kwargs)\n        else:\n            msgs = []\n            for m in self.template:\n                msg = f\"{m.role.value}: {format_string(m.content, **kwargs)}\"\n                if m.extra_args is not None and len(m.extra_args) &gt; 0:\n                    msg += f\"{m.extra_args}\"\n                msgs.append(msg)\n            return \"\\n\".join(msgs)\n\n    def format_messages(\n        self, role: MessageRole = MessageRole.SYSTEM, **kwargs: str\n    ) -&gt; List[ChatMessage]:\n        \"\"\"Generate list of ChatMessage from template with input arguments.\"\"\"\n        if isinstance(self.template, str):\n            return [\n                ChatMessage(role=role, content=format_string(self.template, **kwargs))\n            ]\n        else:\n            msgs = []\n            for m in self.template:\n                msg = ChatMessage(\n                    role=m.role, content=format_string(m.content, **kwargs)\n                )\n                msgs.append(msg)\n            return msgs\n</code></pre>\n<h3 id=\"37-functiontool-ä¸Ž-action-çš„å…³è”åŠæ³¨å†Œæœºåˆ¶\">3.7 FunctionTool ä¸Ž Action çš„å…³è”åŠæ³¨å†Œæœºåˆ¶</h3>\n<p>åœ¨ Flink Agents æ¡†æž¶ä¸­ï¼Œfunction tool ä¸Ž action çš„è”ç³»å’Œæ³¨å†Œæ¶‰åŠå¤šä¸ªç»„ä»¶å’Œæ­¥éª¤ã€‚</p>\n<h4 id=\"371-å®žé™…è½¬æ¢æµç¨‹\">3.7.1 å®žé™…è½¬æ¢æµç¨‹</h4>\n<p>å…·ä½“çš„å·¥å…·åˆ° prompt çš„è½¬æ¢è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>å·¥å…·é€šè¿‡ @Tool æˆ– @tool æ³¨å†Œåˆ°æ‰§è¡ŒçŽ¯å¢ƒä¸­</li>\n<li>åœ¨åˆ›å»º ResourceDescriptor æ—¶ï¼Œé€šè¿‡ tools å‚æ•°å¼•ç”¨è¿™äº›å·²æ³¨å†Œçš„å·¥å…·</li>\n<li>å½“èŠå¤©æ¨¡åž‹ setup ç±»ï¼ˆå¦‚ OllamaChatModelSetupï¼‰åˆå§‹åŒ–æ—¶ï¼Œå®ƒä¼šèŽ·å–è¿™äº›å·¥å…·çš„å…ƒæ•°æ®ï¼ˆåŒ…æ‹¬åç§°å’Œæè¿°ï¼‰</li>\n<li>è¿™äº›å·¥å…·ä¿¡æ¯ä¼šè¢«è‡ªåŠ¨æ•´åˆåˆ°å‘é€ç»™ LLM çš„ç³»ç»Ÿ prompt ä¸­ï¼Œå‘ŠçŸ¥ LLM æœ‰å“ªäº›å¯ç”¨å·¥å…·åŠå…¶ç”¨é€”</li>\n</ol>\n<p>è¿™ç§æ–¹å¼ä½¿å¾—å¼€å‘è€…åªéœ€å…³æ³¨å·¥å…·çš„å®šä¹‰å’Œæ³¨å†Œï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç¼–å†™å·¥å…·æè¿°åˆ° prompt ä¸­ï¼Œæé«˜äº†å¼€å‘æ•ˆçŽ‡å¹¶å‡å°‘äº†å‡ºé”™å¯èƒ½æ€§ã€‚</p>\n<h5 id=\"function-tool-æ³¨å†Œåˆ°-agent\">Function Tool æ³¨å†Œåˆ° Agent</h5>\n<p>Function tool é¦–å…ˆé€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ³¨å†Œåˆ°æ‰§è¡ŒçŽ¯å¢ƒä¸­ï¼š</p>\n<p><strong>æ–¹å¼ä¸€ï¼šä½¿ç”¨è£…é¥°å™¨</strong></p>\n<pre><code class=\"language-python\">    @tool\n    @staticmethod\n    def notify_shipping_manager(id: str, review: str) -&gt; None:\n        \"\"\"Notify the shipping manager when product received a negative review due to\n        shipping damage.\n\n        Parameters\n        ----------\n        id : str\n            The id of the product that received a negative review due to shipping damage\n        review: str\n            The negative review content\n        \"\"\"\n        # reuse the declared function, but for parsing the tool metadata, we write doc\n        # string here again.\n        notify_shipping_manager(id=id, review=review)\n</code></pre>\n<p><strong>æ–¹å¼äºŒï¼šä½¿ç”¨ add_resource æ–¹æ³•</strong></p>\n<p>å³ï¼Œåœ¨æ‰§è¡ŒçŽ¯å¢ƒæ³¨å†Œå·¥å…·èµ„æºã€‚</p>\n<pre><code class=\"language-python\">def add(a: int, b: int) -&gt; int:\n    \"\"\"Calculate the sum of a and b.\n\n    Parameters\n    ----------\n    a : int\n        The first operand\n    b : int\n        The second operand\n\n    Returns:\n    -------\n    int:\n        The sum of a and b\n    \"\"\"\n    return a + b\n\nenv.add_resource(\"add\", ResourceType.TOOL, add)\n</code></pre>\n<p><strong>æ–¹å¼ä¸‰ï¼šåœ¨ Agent æž„é€ å‡½æ•°ä¸­æ·»åŠ </strong></p>\n<pre><code class=\"language-python\">class MyAgent(Agent):\n    def __init__(self):\n        super().__init__()\n        self.add_resource(\"add\", add) # æ·»åŠ åˆ° TOOL ç±»åž‹èµ„æºä¸­\n</code></pre>\n<p><strong>æ–¹å¼å››ï¼šåœ¨  ReActAgent æž„å»ºæ—¶å€™ä¼ å…¥</strong></p>\n<p>å³ï¼Œé€šè¿‡ tools å‚æ•°æŒ‡å®šã€‚</p>\n<pre><code class=\"language-java\">    // Create ReAct agent.\n    private static ReActAgent getReActAgent() {\n        return new ReActAgent(\n                ResourceDescriptor.Builder.newBuilder(OllamaChatModelSetup.class.getName())\n                        .addInitialArgument(\"connection\", \"ollamaChatModelConnection\")\n                        .addInitialArgument(\"model\", \"qwen3:8b\")\n                        .addInitialArgument(\n                                \"tools\", Collections.singletonList(\"notifyShippingManager\"))\n                        .build(),\n                reviewAnalysisReactPrompt(),\n                CustomTypesAndResources.ProductReviewAnalysisRes.class);\n    }\n</code></pre>\n<h5 id=\"ä¸Žæ¨¡åž‹äº¤äº’\">ä¸Žæ¨¡åž‹äº¤äº’</h5>\n<p>Chat Model Setup ä¸­å¼•ç”¨å·¥å…·</p>\n<p>åœ¨åˆ›å»º Chat Model Setup æ—¶ï¼Œé€šè¿‡ tools å‚æ•°æŒ‡å®šè¦ä½¿ç”¨çš„å·¥å…·åˆ—è¡¨ï¼š</p>\n<pre><code class=\"language-python\">chat_model_descriptor = ResourceDescriptor(\nclazz=OllamaChatModelSetup,\nconnection=\"my_ollama_connection\",\nmodel=\"qwen3:8b\",\ntools=[\"notify_shipping_manager\"]   # å¼•ç”¨å·²æ³¨å†Œçš„å·¥å…·\n)\n</code></pre>\n<h4 id=\"372-agentplan-ç¼–è¯‘è¿‡ç¨‹ä¸­å·¥å…·çš„å¤„ç†\">3.7.2 AgentPlan ç¼–è¯‘è¿‡ç¨‹ä¸­å·¥å…·çš„å¤„ç†</h4>\n<p>Flink Agents å†…ç½®äº†ä¸€ä¸ª TOOL_CALL_ACTIONï¼Œï¼Œä¸“é—¨ç”¨äºŽè°ƒç”¨å·¥å…·ã€‚TOOL_CALL_ACTION ä¸Žç”¨æˆ·å®šä¹‰å·¥å…·å‡½æ•°çš„è”ç³»ä¸»è¦ä¾èµ–äºŽï¼š</p>\n<ul>\n<li>ç»Ÿä¸€çš„å‘½åç³»ç»Ÿï¼šå·¥å…·å‡½æ•°çš„åç§°ä½œä¸ºå”¯ä¸€æ ‡è¯†ç¬¦</li>\n<li>èµ„æºç®¡ç†æœºåˆ¶ï¼šé€šè¿‡ RunnerContext.get_resource() æ–¹æ³•æŒ‰åç§°æ£€ç´¢å·¥å…·</li>\n<li>æ ‡å‡†åŒ–æŽ¥å£ï¼šæ‰€æœ‰å·¥å…·éƒ½å®žçŽ°ç›¸åŒçš„ call() æŽ¥å£</li>\n<li>äº‹ä»¶é©±åŠ¨æž¶æž„ï¼šé€šè¿‡ ToolRequestEvent å’Œ ToolResponseEvent ä¼ é€’è°ƒç”¨ä¿¡æ¯</li>\n</ul>\n<p>è¿™ç§è®¾è®¡ä½¿å¾—ç³»ç»Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å°† LLM çš„å·¥å…·è°ƒç”¨è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼Œè€Œæ— éœ€ç¡¬ç¼–ç å…·ä½“çš„å‡½æ•°å¼•ç”¨ã€‚</p>\n<p><img alt=\"3-1\" class=\"lazyload\" /></p>\n<h5 id=\"ç”¨æˆ·å®šä¹‰çš„-function-tool-è½¬æ¢ä¸º-action\">ç”¨æˆ·å®šä¹‰çš„ Function Tool è½¬æ¢ä¸º Action</h5>\n<p>å½“ Agent è¢«ç¼–è¯‘æˆ AgentPlan æ—¶ï¼Œç³»ç»Ÿä¼šæ”¶é›†æ‰€æœ‰èµ„æºï¼ˆåŒ…æ‹¬å·¥å…·ï¼‰ ï¼Œè¿™äº›å·¥å…·ä¼šè¢«è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„ Actionï¼š</p>\n<ul>\n<li>åœ¨ _get_resource_providers å‡½æ•°ä¸­ï¼Œè¯†åˆ«å¸¦æœ‰ _is_tool å±žæ€§çš„èµ„æº</li>\n<li>ä½¿ç”¨ from_callable å°†å‡½æ•°è½¬æ¢ä¸ºå·¥å…·å¯¹è±¡</li>\n<li>å·¥å…·è¢«åŒ…è£…ä¸º ResourceProvider å¹¶å­˜å‚¨åœ¨ AgentPlan ä¸­ï¼Œå³é€šè¿‡ PythonSerializableResourceProvider åŒ…è£…å·¥å…·èµ„æº</li>\n</ul>\n<h5 id=\"å†…ç½®-tool-call-action\">å†…ç½® Tool Call Action</h5>\n<p>æ¡†æž¶æä¾›äº†ä¸€ä¸ªå†…ç½®çš„ TOOL_CALL_ACTIONï¼Œä¸“é—¨ç”¨äºŽè°ƒç”¨å·¥å…·ï¼š</p>\n<pre><code class=\"language-python\">TOOL_CALL_ACTION = Action(\n    name=\"tool_call_action\",\n    exec=PythonFunction.from_callable(process_tool_request),\n    listen_event_types=[f\"{ToolRequestEvent.__module__}.{ToolRequestEvent.__name__}\"],\n)\n</code></pre>\n<p>å¯¹åº”Action ä¸ºToolCallActionï¼Œå…¶ä¸­ processToolRequest å‡½æ•°ä¼šä¸Žç”¨æˆ·è‡ªå®šä¹‰çš„å·¥å…·å‡½æ•°ç›¸äº’å…³è”ã€‚å…·ä½“è”ç³»æœºåˆ¶å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>å‘½ååŒ¹é…ï¼šå½“ LLM å†³å®šè°ƒç”¨æŸä¸ªå·¥å…·æ—¶ï¼Œå®ƒä¼šåœ¨ tool_call ä¸­æŒ‡å®šå·¥å…·åç§°ï¼ˆå¦‚ \"notify_shipping_manager\"ï¼‰</li>\n<li>èµ„æºæŸ¥æ‰¾ï¼šTOOL_CALL_ACTION ä½¿ç”¨è¿™ä¸ªåç§°é€šè¿‡ ctx.get_resource(name, ResourceType.TOOL) æŸ¥æ‰¾å·²æ³¨å†Œçš„å·¥å…·</li>\n<li>åŠ¨æ€è°ƒç”¨ï¼šæ‰¾åˆ°å·¥å…·åŽï¼Œé€šè¿‡ tool.call(**kwargs) è°ƒç”¨ç”¨æˆ·å®šä¹‰çš„å®žé™…å‡½æ•°</li>\n</ul>\n<pre><code class=\"language-java\">public class ToolCallAction {\n    public static Action getToolCallAction() throws Exception {\n        return new Action(\n                \"tool_call_action\",\n                new JavaFunction(\n                        ToolCallAction.class,\n                        \"processToolRequest\",\n                        new Class[] {ToolRequestEvent.class, RunnerContext.class}),\n                List.of(ToolRequestEvent.class.getName()));\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    public static void processToolRequest(ToolRequestEvent event, RunnerContext ctx) {\n        Map&lt;String, Boolean&gt; success = new HashMap&lt;&gt;();\n        Map&lt;String, String&gt; error = new HashMap&lt;&gt;();\n        Map&lt;String, ToolResponse&gt; responses = new HashMap&lt;&gt;();\n        Map&lt;String, String&gt; externalIds = new HashMap&lt;&gt;();\n        for (Map&lt;String, Object&gt; toolCall : event.getToolCalls()) {\n            String id = String.valueOf(toolCall.get(\"id\"));\n            Map&lt;String, Object&gt; function = (Map&lt;String, Object&gt;) toolCall.get(\"function\");\n            String name = (String) function.get(\"name\");// èŽ·å–å·¥å…·åç§°\n            Map&lt;String, Object&gt; arguments = (Map&lt;String, Object&gt;) function.get(\"arguments\"); // èŽ·å–å·¥å…·å‚æ•°\n\n            if (toolCall.containsKey(\"original_id\")) {\n                externalIds.put(id, (String) toolCall.get(\"original_id\"));\n            }\n\n            Tool tool = null;\n            try {\n                // ä»Žä¸Šä¸‹æ–‡èŽ·å–å¯¹åº”åç§°çš„å·¥å…·èµ„æº\n                tool = (Tool) ctx.getResource(name, ResourceType.TOOL);\n            } catch (Exception e) {\n                success.put(id, false);\n                responses.put(\n                        id, ToolResponse.error(String.format(\"Tool %s does not exist.\", name)));\n                error.put(id, e.getMessage());\n            }\n\n            if (tool != null) {\n                try {\n                    // è°ƒç”¨ç”¨æˆ·å®žé™…å·¥å…·\n                    ToolResponse response = tool.call(new ToolParameters(arguments));\n                    success.put(id, true);\n                    responses.put(id, response);\n                } catch (Exception e) {\n                    success.put(id, false);\n                    responses.put(\n                            id, ToolResponse.error(String.format(\"Tool %s execute failed.\", name)));\n                    error.put(id, e.getMessage());\n                }\n            }\n        }\n        // è¿”å›žå·¥å…·å“åº”äº‹ä»¶\n        ctx.sendEvent(new ToolResponseEvent(event.getId(), responses, success, error, externalIds));\n    }\n}\n</code></pre>\n<p>è¿™ä¸ª action ç›‘å¬ ToolRequestEvent äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œå·¥å…·è°ƒç”¨ã€‚è°ƒç”¨å®ŒæˆåŽï¼Œå°†ç»“æžœé€šè¿‡ ToolReponseEvent è¿”å›žã€‚</p>\n<pre><code class=\"language-json\">    \"tool_call_action\": {\n      \"name\": \"tool_call_action\",\n      \"exec\": {\n        \"func_type\": \"PythonFunction\",\n        \"module\": \"flink_agents.plan.actions.tool_call_action\",\n        \"qualname\": \"process_tool_request\"\n      },\n      \"listen_event_types\": [\n        \"flink_agents.api.events.tool_event.ToolRequestEvent\"\n      ]\n    }\n</code></pre>\n<h5 id=\"tool_call_action-å¦‚ä½•ç¼–è¯‘åˆ°agentplan\">TOOL_CALL_ACTION å¦‚ä½•ç¼–è¯‘åˆ°AgentPlan</h5>\n<ul>\n<li>\n<p>åœ¨ AgentPlan.from_agent æ–¹æ³•ä¸­ï¼š</p>\n<ul>\n<li>å½“åˆ›å»º AgentPlan æ—¶ï¼Œä¼šæ”¶é›†æ‰€æœ‰åŠ¨ä½œï¼ŒåŒ…æ‹¬ç”¨æˆ·å®šä¹‰çš„åŠ¨ä½œå’Œå†…ç½®åŠ¨ä½œ</li>\n<li>ä»£ç ä¸­æ˜Žç¡®åŒ…å«äº†å†…ç½®åŠ¨ä½œï¼š<br />\nBUILT_IN_ACTIONS = [CHAT_MODEL_ACTION, TOOL_CALL_ACTION, CONTEXT_RETRIEVAL_ACTION]</li>\n<li>åœ¨ _get_actions(agent) å‡½æ•°ä¸­ï¼Œè¿™äº›å†…ç½®åŠ¨ä½œä¼šè¢«æ·»åŠ åˆ°åŠ¨ä½œåˆ—è¡¨ä¸­</li>\n</ul>\n</li>\n<li>\n<p>å…·ä½“ç¼–è¯‘è¿‡ç¨‹ï¼š</p>\n<ul>\n<li>AgentPlan.from_agent() æ–¹æ³•è°ƒç”¨ _get_actions(agent) èŽ·å–æ‰€æœ‰åŠ¨ä½œ</li>\n<li>_get_actions() å‡½æ•°ä¸ä»…æå–ç”¨æˆ·å®šä¹‰çš„åŠ¨ä½œï¼Œè¿˜ä¼šåŒ…å« BUILT_IN_ACTIONS</li>\n<li>è¿™äº›åŠ¨ä½œéšåŽè¢«ç¼–è¯‘è¿› AgentPlan çš„ actions å’Œ actions_by_event å­—æ®µä¸­</li>\n</ul>\n</li>\n<li>\n<p>åœ¨æœ€ç»ˆçš„ AgentPlan ä¸­ï¼š</p>\n<ul>\n<li>TOOL_CALL_ACTION ä¼šä½œä¸ºä¸€ä¸ªæ™®é€šçš„åŠ¨ä½œå­˜åœ¨äºŽ actions æ˜ å°„ä¸­</li>\n<li>å®ƒä¼šç›‘å¬ ToolRequestEvent äº‹ä»¶ç±»åž‹ï¼Œå¹¶åœ¨è¯¥äº‹ä»¶å‘ç”Ÿæ—¶è¢«è§¦å‘æ‰§è¡Œ</li>\n</ul>\n</li>\n</ul>\n<p>å› æ­¤ï¼ŒTOOL_CALL_ACTION ç¡®å®žä¼šè¢«ç¼–è¯‘åˆ° AgentPlan ä¸­ï¼Œä½œä¸ºå¤„ç†å·¥å…·è°ƒç”¨çš„æ ‡å‡†æœºåˆ¶ã€‚å½“ LLM å†³å®šè°ƒç”¨å·¥å…·æ—¶ï¼Œä¼šå‘å‡º ToolRequestEventï¼Œç„¶åŽ TOOL_CALL_ACTION å°±ä¼šè¢«è§¦å‘æ¥å®žé™…æ‰§è¡Œç›¸åº”çš„å·¥å…·è°ƒç”¨ã€‚</p>\n<h4 id=\"373-å·¥å…·è°ƒç”¨æµç¨‹\">3.7.3 å·¥å…·è°ƒç”¨æµç¨‹</h4>\n<p>æ•´ä¸ªæµç¨‹ä¸­ï¼Œå·¥å…·ä¸æ˜¯ç›´æŽ¥ç»‘å®šåˆ° ActionExecutionOperatorï¼Œè€Œæ˜¯é€šè¿‡ AgentPlan ä¸­çš„èµ„æºæä¾›è€…æœºåˆ¶ï¼Œåœ¨éœ€è¦æ—¶åŠ¨æ€èŽ·å–å’Œå®žä¾‹åŒ–ã€‚è¿™ç§è®¾è®¡å®žçŽ°äº†å·¥å…·ä¸Žæ“ä½œç¬¦çš„æ¾è€¦åˆï¼ŒåŒæ—¶æ”¯æŒå¤šç§ç±»åž‹çš„å·¥å…·ï¼ˆJavaã€Python ç­‰ï¼‰ã€‚</p>\n<ul>\n<li>LLM å†³å®šè°ƒç”¨æŸä¸ªå·¥å…·</li>\n<li>TOOL_CALL_ACTION å†…ç½®åŠ¨ä½œè¢«è§¦å‘</li>\n<li>é€šè¿‡ RunnerContext èŽ·å–å¯¹åº”å·¥å…·èµ„æº</li>\n<li>RunnerContextImpl.get_resource() æ–¹æ³•æ ¹æ®åç§°å’Œç±»åž‹æŸ¥æ‰¾å·¥å…·èµ„æº</li>\n<li>å·¥å…·å®žé™…åœ¨éœ€è¦æ—¶æ‰é€šè¿‡ ResourceProvider å®žä¾‹åŒ–</li>\n<li>é€šè¿‡ ToolCallFunction æŸ¥æ‰¾å¹¶æ‰§è¡Œç›¸åº”çš„å·¥å…·å‡½æ•°</li>\n<li>ç»“æžœä½œä¸ºæ–°äº‹ä»¶å‘é€åˆ°äº‹ä»¶é˜Ÿåˆ—</li>\n</ul>\n<h4 id=\"374-å®Œæ•´æµç¨‹å›¾\">3.7.4 å®Œæ•´æµç¨‹å›¾</h4>\n<p><img alt=\"3-2\" class=\"lazyload\" /></p>\n<h4 id=\"375-ä»£ç \">3.7.5 ä»£ç </h4>\n<p>åœ¨ agent_plan.pyä¸­å¤„ç†å·¥å…·èµ„æºçš„ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-python\">        # è¯†åˆ«å·¥å…·èµ„æºå¹¶åˆ›å»ºæä¾›è€…\n        elif hasattr(value, \"_is_tool\"):\n            if isinstance(value, staticmethod):\n                value = value.__func__\n\n            if callable(value):\n                # TODO: support other tool type.\n                tool = from_callable(func=value)\n                resource_providers.append(\n                    PythonSerializableResourceProvider.from_resource(\n                        name=name, resource=tool\n                    )\n                )\n    # æˆ–è€…é€šè¿‡add_resource æ·»åŠ çš„å·¥å…·            \n    for name, tool in agent.resources[ResourceType.TOOL].items():\n        resource_providers.append(\n            PythonSerializableResourceProvider.from_resource(\n                name=name, resource=from_callable(tool.func)\n            )\n        )                \n</code></pre>\n<p>æ€»ç»“æ¥è¯´ï¼Œfunction_tool  é€šè¿‡èµ„æºæ³¨å†Œæœºåˆ¶ä¸ŽAgentå…³è”ï¼Œç„¶åŽåœ¨ç¼–è¯‘é˜¶æ®µè¢«è½¬æ¢ä¸ºå¯åºåˆ—åŒ–çš„èµ„æºæä¾›è€…ï¼Œæœ€ç»ˆé€šè¿‡å†…ç½®çš„å·¥å…·è°ƒç”¨Actionæ¥æ‰§è¡Œã€‚è¿™ç§è®¾è®¡ä½¿å¾—å·¥å…·å¯ä»¥åœ¨åˆ†å¸ƒå¼çŽ¯å¢ƒç§æ­£ç¡®ä¼ è¾“å’Œæ‰§è¡Œã€‚</p>\n<h2 id=\"0xff-å‚è€ƒ\">0xFF å‚è€ƒ</h2>\n<p><a href=\"https://ce101.mintlify.app/core-tech/agent#7-2-5-multi-agent\" rel=\"noopener nofollow\" target=\"_blank\">https://ce101.mintlify.app/core-tech/agent#7-2-5-multi-agent</a></p>\n<p><a href=\"https://www.zhihu.com/question/1959742114519844109/answer/1983526566437880277\" rel=\"noopener nofollow\" target=\"_blank\">https://www.zhihu.com/question/1959742114519844109/answer/1983526566437880277</a></p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 19:17</span>&nbsp;\n<a href=\"https://www.cnblogs.com/rossiXYZ\">ç½—è¥¿çš„æ€è€ƒ</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">2</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "我的2025总结 - 普通但不失收获",
      "link": "https://www.cnblogs.com/wenbochang/p/19427794",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/wenbochang/p/19427794\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 17:49\">\n    <span>我的2025总结 - 普通但不失收获</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        <img alt=\"我的2025总结 - 普通但不失收获\" class=\"desc_img\" src=\"https://img2024.cnblogs.com/blog/1335795/202512/1335795-20251231174935059-1337888407.png\" />\n        2025 年稳步前行。工作上完成了晋升答辩并深入实践 AI 编程；生活中保持节奏，适度旅行与休闲；投资方面在市场行情带动下取得了不错的收益。整体虽不轰动，却在平实的日常里积累了清晰而扎实的成长。\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"前言\">前言</h1>\n<p>2024年度总结: <a href=\"https://www.cnblogs.com/wenbochang/p/18645153\" target=\"_blank\">平淡与新鲜 - 我的2024关键词</a></p>\n<p>坐在电脑前想了很久，今年的关键词却总是想不出来。很多事都模糊了，甚至会觉得这一年没发生什么特别的事，不知不觉就到年底了。</p>\n<p>为了找到答案，我翻了手机相册，发现照片不多；再看博客、公众号、笔记，也没有特别“高光”的内容。翻来翻去，只剩下一种感觉：今年确实很平淡。</p>\n<p>就在这时我突然想到 - 2026年，我就30岁了。</p>\n<h1 id=\"聊一聊三十岁的感悟\">聊一聊三十岁的感悟</h1>\n<p>小时候每到过年，长辈会对我们说“又长大一岁了”。而他们却说自己“又老了一岁”。小时候不懂，现在慢慢理解了。</p>\n<p>不知不觉，30 岁快到了。没有特别大的心理冲击，也没有太多仪式感，它就是在生活的节奏里悄悄来了。小时候以为三十岁的人都很成熟、有方向、有答案；而当自己站在这个年龄段才知道，很多人三十岁依旧会迷茫，甚至到四十、五十都一样。</p>\n<p>但今年也不是毫无亮点。</p>\n<p>好的一面，我有一个不错的女朋友，还有一份还不错的工作，我依旧认为自己还很年轻，我还能拼，我对新事物还有好奇心、想象力，我还想体验各种不一样的东西，我还想去体验这个世界。三十岁对我来说，是继续往前走的阶段，而不是一个分界线。</p>\n<p>这是我的三十岁。那你的呢？</p>\n<h1 id=\"聊一聊工作\">聊一聊工作</h1>\n<p>作为程序员，今年无疑是非常特别的一年 - AI编程全面爆发。从底层模型（GPT、Claude、Gemini）到应用工具（GitHub Copilot、Cursor、Trae），整个行业都在加速变化。</p>\n<p>我们正处于一个拐点。很多人不需要懂代码，也能借助 AI 完成从开发到上线的流程。这在以前完全无法想象。</p>\n<p>今年我深度使用 Cursor 开发了几款小产品，整个学习方式也变成了与 AI 的“对话式学习”。在实际工作中，Cursor 大概提升了 10%~20% 的效率，希望明年 AI 能带来更多突破。</p>\n<p>在工作中，今年无疑也是兴奋的一年。年初有机会参与晋升答辩，在准备了2个多月，修改了几十版的ppt，每晚和老板练习答辩，甚至连睡觉做梦都在想着答辩，年初3-4月份无疑是最焦虑的时候。当然最后结果还是很不错的，算是今年比较重要的一件事情。</p>\n<p><img alt=\"cursor-2025-models\" src=\"https://img2024.cnblogs.com/blog/1335795/202512/1335795-20251231174717708-2020725930.png\" /></p>\n<h1 id=\"聊一聊生活\">聊一聊生活</h1>\n<ul>\n<li>一月份去了外伶仃岛，真的很安静，很舒服</li>\n</ul>\n<p><img alt=\"外伶仃岛2\" src=\"https://img2024.cnblogs.com/blog/1335795/202512/1335795-20251231174742249-84290466.jpg\" /></p>\n<p><img alt=\"外伶仃岛\" src=\"https://img2024.cnblogs.com/blog/1335795/202512/1335795-20251231174749448-445433318.jpg\" /></p>\n<ul>\n<li>三月份去了惠州巽寮湾，当时去的时候天气不是很好，但淡季人少，也不错</li>\n</ul>\n<p><img alt=\"巽寮湾2\" src=\"https://img2024.cnblogs.com/blog/1335795/202512/1335795-20251231174804373-1907155169.jpg\" /></p>\n<p><img alt=\"巽寮湾\" src=\"https://img2024.cnblogs.com/blog/1335795/202512/1335795-20251231174811795-1020945429.jpg\" /></p>\n<ul>\n<li>之后的月份基本在深圳玩耍，逛逛公园、骑骑单车、徒步一下，非常的休闲</li>\n<li>今年爱上了露营，喜欢有事无事的时候去公园做一下，玩会手机看会书，感受一下大自然，比自己在房间要舒服不少</li>\n</ul>\n<p><img alt=\"深圳湾\" src=\"https://img2024.cnblogs.com/blog/1335795/202512/1335795-20251231174827996-237369006.jpg\" /></p>\n<h1 id=\"聊一聊投资\">聊一聊投资</h1>\n<p>今年赶上了 A 股的小牛市，也算幸运。靠着市场行情和一些大 V 的观点，今年收益率 40%+。</p>\n<ul>\n<li>今年年初开通了港股通并且买入了腾讯，吃了腾讯的一波涨幅</li>\n<li>年中的时候受大V影响，买入了锂矿板块，吃到了锂矿的一波涨幅</li>\n<li>外卖大战时抄底美团，被教育了一次，亏20%</li>\n<li>高位买的白酒扛不住了，割了五粮液、洋河，亏30%</li>\n</ul>\n<p>总体而言，今年能取到如此之高的收益，完全是市场的馈赠，深知并不是自己的实力。明年一定努力学习，希望收益有20%即可</p>\n<p><img alt=\"截屏 2025-12-31 17.05\" height=\"1032\" src=\"https://img2024.cnblogs.com/blog/1335795/202512/1335795-20251231174838569-596239199.png\" width=\"589\" /></p>\n<h1 id=\"最后再聊一下2026年计划\">最后再聊一下2026年计划</h1>\n<ul>\n<li>工作上，依旧希望自己有所突破，可以更进一步</li>\n<li>生活上，可以对生活更加积极，热爱生活，尝试更多新鲜的事物</li>\n<li>投资上，希望可以有20%的一个收益</li>\n<li>希望自己可以多读书，更多的是非专业领域的书籍</li>\n<li>在写作、自媒体领域，希望自己不要断更，多更新，多坚持</li>\n</ul>\n<p>最后祝大家新年快乐，在新的一年开开心心，发大财!!!</p>\n<p><img alt=\"1\" src=\"https://img2024.cnblogs.com/blog/1335795/202512/1335795-20251231174851523-769398917.png\" /></p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 17:49</span>&nbsp;\n<a href=\"https://www.cnblogs.com/wenbochang\">程序员博博</a>&nbsp;\n阅读(<span id=\"post_view_count\">100</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "[微服务进阶场景实战] - 数据一致性",
      "link": "https://www.cnblogs.com/yhup/p/19427692",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/yhup/p/19427692\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 17:21\">\n    <span>[微服务进阶场景实战] - 数据一致性</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        <img alt=\"[微服务进阶场景实战] - 数据一致性\" class=\"desc_img\" src=\"https://img2024.cnblogs.com/blog/2428649/202512/2428649-20251231172110600-959933332.png\" />\n        本文探讨了微服务架构中的数据一致性问题及解决方案。针对最终一致性场景，提出基于消息队列的异步补偿方案，通过消息持久化和重试机制确保数据最终一致；对于强一致性需求，对比分析了TCC模式与Seata AT模式，重点推荐Seata AT方案，其通过自动生成回滚日志实现低侵入式分布式事务管理。实践表明，这两种方案能有效解决数据不一致问题，且不会显著增加开发负担，为微服务架构提供了可靠的数据一致性保障。\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>前面我们梳理了微服务的九大痛点，其中一部分目前尚无完美解决方案，另一部分则已有可行对策。从本章起，我们将逐一探讨那些“有解”的痛点。首当其冲的，就是数据一致性问题——让我们从一个实际业务场景切入。</p>\n<h1 id=\"1-业务场景下游服务失败后上游服务如何独善其身\">1 业务场景：下游服务失败后上游服务如何独善其身</h1>\n<p>在微服务架构中，一个业务请求常常需要跨多个服务更新多个数据库，示意图如下：</p>\n<p><img alt=\"在这里插入图片描述\" src=\"https://img2024.cnblogs.com/blog/2428649/202512/2428649-20251231172011750-1090431586.png\" /></p>\n<p>理想情况下，业务顺利完成时，三个服务的数据应依次更新为 a2、b2、c2，此时数据处于一致状态。然而，现实往往充满意外：网络抖动、服务过载、数据库响应缓慢等都可能导致调用链中途失败。例如，若在步骤 2 失败，数据会停留在 a2、b1、c1；若在步骤 3 失败，则变成 a2、b2、c1——数据不一致就这样产生了。</p>\n<p>在本项目启动前，由于早期改造工期紧张，开发团队无暇顾及数据一致性问题，导致线上陆续出现错误数据。业务部门通过工单反馈后，IT 团队排查发现，根源正是分布式更新过程中的不一致。</p>\n<p>事已至此，团队不得不专门腾出精力，为数据一致性问题设计可靠方案。经过讨论，他们将问题归纳为两类：</p>\n<p><strong>第一类：可接受短期不一致，但必须保证最终一致性</strong><br />\n以零售下单为例（简化版）：订单需依次在商品服务扣库存、订单服务生成订单、交易服务生成交易单。假设生成交易单失败，就会出现库存已扣、订单已生、但交易单缺失的状态。此时只要系统能最终补全交易单，业务即可接受——这就是最终一致性。</p>\n<p><strong>第二类：必须保证实时一致性</strong><br />\n以积分兑换折扣券为例：需要先扣积分，再发折扣券。若采用最终一致性，用户可能看到积分已扣但券未到账，进而立刻投诉。此时更好的做法是：一旦后续步骤失败，立即回滚前面所有操作，并提示用户“操作失败，请重试”。这就是实时一致性。</p>\n<p>那么，针对这两类情况，具体如何实现呢？下面我们分别展开。</p>\n<h1 id=\"2-最终一致性方案\">2 最终一致性方案</h1>\n<p>对对于接受最终一致性的场景，核心思路是借助消息队列（MQ）实现跨服务的数据更新“接力”。具体流程如下：</p>\n<ol>\n<li>每个服务完成本地操作后，向 MQ 发送一条消息，触发下一个服务的处理。</li>\n<li>下游服务消费消息，完成自身操作后，继续发送消息给更下游的服务。</li>\n<li>若消费失败，消息应保留在 MQ 中，等待后续重试。</li>\n</ol>\n<p>整个调用流程如图所示：<br />\n<img alt=\"在这里插入图片描述\" src=\"https://img2024.cnblogs.com/blog/2428649/202512/2428649-20251231172011700-764051171.png\" /></p>\n<p><strong>详细步骤与异常处理如下：</strong></p>\n<table>\n<thead>\n<tr>\n<th>步骤</th>\n<th>执行内容</th>\n<th>失败应对策略</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>调用端调用 Service A</td>\n<td>直接返回失败，用户数据无影响</td>\n</tr>\n<tr>\n<td>2</td>\n<td>Service A 将 a1 改为 a2</td>\n<td>本地事务回滚，数据恢复</td>\n</tr>\n<tr>\n<td>3</td>\n<td>Service A 向 MQ 发送 Step2 消息</td>\n<td>发送失败则触发本地回滚</td>\n</tr>\n<tr>\n<td>4</td>\n<td>Service A 返回成功响应给调用端</td>\n<td>无需额外处理</td>\n</tr>\n<tr>\n<td>5</td>\n<td>Service B 消费 Step2 消息</td>\n<td>MQ 自带重试机制，无需担心</td>\n</tr>\n<tr>\n<td>6</td>\n<td>Service B 将 b1 改为 b2</td>\n<td>本地事务回滚，消息重新投递(重新回到步骤5)</td>\n</tr>\n<tr>\n<td>7</td>\n<td>Service B 向 MQ 发送 Step3 消息</td>\n<td>依赖 MQ 生产端重试机制</td>\n</tr>\n<tr>\n<td>8</td>\n<td>Service B 确认消费 Step2</td>\n<td>若失败，MQ 会重新投递给其他消费者(重新回到步骤5)</td>\n</tr>\n<tr>\n<td>9</td>\n<td>Service C 消费 Step3 消息</td>\n<td>同步骤 5</td>\n</tr>\n<tr>\n<td>10</td>\n<td>Service C 将 c1 改为 c2</td>\n<td>同步骤 6</td>\n</tr>\n<tr>\n<td>11</td>\n<td>Service C 确认消费 Step3</td>\n<td>同步骤 8</td>\n</tr>\n</tbody>\n</table>\n<p>该方案本质上是利用 MQ 的消息持久化、重试和确认机制，将分布式更新拆解为多个本地事务，通过异步消息串联起来。但还需要注意两个常见问题：</p>\n<p><strong>1. 幂等性必须保证</strong><br />\n由于 MQ 的重试机制，步骤 6 和步骤 10 可能被重复执行。因此，下游服务在更新数据时，必须实现<strong>业务幂等</strong>——即同一消息多次消费，结果应与一次消费相同。</p>\n<p><strong>2. 代码复用与封装</strong><br />\n如果每个业务流程都手动实现上述逻辑，开发量会很大。实际上，MQ 相关的发送、消费、确认逻辑可以抽象为公共组件。本项目最终将这些重复代码封装成通用模块，供各业务服务调用。具体封装方法较为直接，此处不再展开。</p>\n<h1 id=\"3-实时一致性方案\">3 实时一致性方案</h1>\n<p>实时一致性其实就是常说的分布式事务。</p>\n<p>MySQL其实有一个两阶段提交的分布式事务方案MySQL XA，但是该方案存在严重的性能问题。比如，一个数据库的事务与多个数据库间的XA事务性能可能相差10倍。</p>\n<p>另外，XA的事务处理过程会长期占用锁资源，所以项目组一开始就没有考虑这个方案。而当时比较流行的方案是使用TCC模式，下面简单介绍一下。</p>\n<h1 id=\"4-tcc模式一分为三的补偿型事务\">4 TCC模式：一分为三的补偿型事务</h1>\n<p>TCC（Try-Confirm-Cancel）是一种补偿型事务方案。它将一个完整的业务接口逻辑拆解为三个独立的操作阶段：</p>\n<ol>\n<li><strong>Try</strong>：尝试执行。负责完成所有业务检查，并<strong>预留</strong>必要的资源（例如冻结积分、锁定库存）。</li>\n<li><strong>Confirm</strong>：确认执行。真正执行业务操作，使用Try阶段预留的资源，通常<strong>保证成功</strong>。</li>\n<li><strong>Cancel</strong>：取消执行。用于<strong>释放</strong>Try阶段预留的资源，进行业务回滚。</li>\n</ol>\n<p>以“积分兑换折扣券”为例，涉及“账户服务扣积分”和“营销服务发折扣券”两个操作。那么，仅“扣积分”这一个接口，就需要拆分为以下三个方法：</p>\n<pre><code class=\"language-java\">public boolean prepareMinus (BusinessActionContext businessActionContext,\n                             final String accountNo,\n                             final double amount){\n    //[校验] 账户积分余额\n    //[冻结] 积分金额\n}\npublic boolean Confirm(BusinessActionContext businessActionContext){\n    //[扣除] 账户积分余额\n    //[释放] 账户，冻结积分金额\n}\npublic boolean Cancel(BusinessActionContext businessActionContext){\n    //[回滚] 所有数据变更\n}\n</code></pre>\n<p>理，“发折扣券”接口也需要编写对应的三个方法。其成功调用的流程示意如图所示。<br />\n<img alt=\"在这里插入图片描述\" src=\"https://img2024.cnblogs.com/blog/2428649/202512/2428649-20251231172011621-1381075228.png\" /></p>\n<p>该流程中，除Cancel路径外，代表成功调用链。一旦任何环节出错，事务管理器将协调调用所有已执行服务的Cancel方法进行回滚。</p>\n<p>TCC模式将一段业务逻辑拆成三部分，实施复杂度显著增加，并需谨慎处理以下问题：</p>\n<ol>\n<li><strong>空提交</strong>：需保证Try成功，Confirm必定成功。</li>\n<li><strong>空回滚</strong>：需处理Try未执行却收到Cancel调用的情况，实现正确回滚。</li>\n<li><strong>防悬挂</strong>：需防止因网络拥堵，Cancel先于Try到达导致资源被永久锁定。</li>\n<li><strong>幂等性</strong>：所有Try、Confirm、Cancel操作都必须支持重复调用。</li>\n<li><strong>数据隔离</strong>：事务期间数据处于中间状态（如“冻结”），需设计得当，避免对其他业务逻辑造成干扰。</li>\n</ol>\n<p>可见，TCC模式实现<strong>相当繁琐</strong>，不仅业务代码量激增，还需精心处理上述各类边缘情况，开发和维护成本高，易出错。幸运的是，存在更优的替代方案，例如Seata框架提供的<strong>AT模式</strong>。</p>\n<h1 id=\"5-seata-at模式基于sql反向补偿的自动回滚\">5 Seata AT模式：基于SQL反向补偿的自动回滚</h1>\n<p>AT（Automatic Transaction）模式，即自动（分支）事务模式。其最大优点是<strong>对业务侵入极低</strong>。</p>\n<p>开发者只需做两件事：</p>\n<ul>\n<li>在全局事务的<strong>发起方</strong>方法上添加 <code>@GlobalTransactional</code> 注解。</li>\n<li>在各个参与服务的本地方法上，继续使用普通的 <code>@Transactional</code> 注解。</li>\n</ul>\n<p>Seata官网对这块介绍的非常详细，有兴趣的朋友可以看一下：<a href=\"https://seata.apache.org/zh-cn/docs/dev/mode/at-mode\" rel=\"noopener nofollow\" target=\"_blank\">Apache Seata</a>。在这里简要概括一下，其核心机制在于，Seata会<strong>自动拦截并解析</strong>业务SQL，通过生成并管理反向回滚日志，实现分布式事务的自动协调。整个过程可简要概括为三个阶段：</p>\n<p><strong>第一阶段：执行与日志记录</strong></p>\n<ol>\n<li><strong>解析SQL</strong>：拦截业务SQL，解析其操作类型、表、条件等。</li>\n<li><strong>保存前置镜像</strong>：根据解析条件查询数据，保存更新前的状态（Before Image）。</li>\n<li><strong>执行业务SQL</strong>：执行用户定义的更新操作。</li>\n<li><strong>保存后置镜像</strong>：查询更新后的数据状态（After Image）。</li>\n<li><strong>插入回滚日志</strong>：将前后镜像数据及SQL信息组成回滚日志，存入 <code>UNDO_LOG</code> 表。</li>\n<li><strong>注册与锁</strong>：向事务协调器（TC）注册分支事务，并获取相关数据的<strong>全局锁</strong>。</li>\n<li><strong>本地提交</strong>：提交业务数据更新和 <code>UNDO_LOG</code>。</li>\n<li><strong>上报结果</strong>：将本地事务提交结果<strong>上报</strong>给TC。</li>\n</ol>\n<p><strong>第二阶段：回滚（如需要）</strong><br />\n若收到TC发出的回滚指令，则：</p>\n<ol>\n<li>开启本地事务，查找对应的 <code>UNDO_LOG</code> 记录。</li>\n<li><strong>数据校验</strong>：对比 <code>UNDO_LOG</code> 中的后镜像与当前数据。若不一致（说明数据被其他事务修改），需根据策略处理。</li>\n<li><strong>生成并执行回滚SQL</strong>：根据前镜像数据，生成反向SQL执行，恢复数据。</li>\n<li><strong>提交并上报</strong>：提交本地事务，删除 <code>UNDO_LOG</code>，并向TC上报回滚结果。</li>\n</ol>\n<p><strong>第三阶段：异步清理</strong><br />\n收到TC的提交指令后，异步、批量地删除对应的 <code>UNDO_LOG</code> 记录，完成资源清理。</p>\n<h3 id=\"6-为何选择seata一个务实的工程决策\">6 为何选择Seata：一个务实的工程决策</h3>\n<p>当时，Seata虽未发布正式版，但我们项目组仍决定采用，主要基于两点现实考量：</p>\n<ol>\n<li><strong>场景可控</strong>：需要强实时一致性的业务场景<strong>占比少、频率低</strong>，影响范围有限。对于高频、高并发的场景，我们会优先与业务方沟通，采用<strong>最终一致性</strong>方案，从而规避性能风险。</li>\n<li><strong>投入产出比高</strong>：相较于TCC模式需要将每个业务逻辑“一拆三”并处理各种异常，AT模式<strong>仅需增加一个</strong><code>@GlobalTransactional</code><strong>注解</strong>，开发工作量天差地别。这种显著的效率提升，使得尝试新技术带来的风险变得可以接受。这或许也是Seata能迅速流行的原因之一。</li>\n</ol>\n<p>尽管AT模式存在一些小缺陷（如全局锁对性能的细微影响），但<strong>瑕不掩瑜</strong>，其易用性优势在大多数场景下非常突出。</p>\n<h3 id=\"7-小结缓解痛点轻装前行\">7 小结：缓解痛点，轻装前行</h3>\n<p>通过为“最终一致性”和“实时一致性”场景分别设计并落地了基于MQ的异步补偿方案与基于Seata AT模式的自动补偿方案，我们成功解决了数据不一致的核心痛点。<br />\n<strong>关键成果在于</strong>：这些方案<strong>并未给业务开发带来显著负担</strong>，也未影响项目正常推进，却极大降低了数据错误的发生概率。</p>\n<p>至此，数据一致性的痛点已得到有效缓解。接下来，我们将面对微服务架构中的另一个常见难题：<strong>服务间数据依赖复杂，导致需要编写大量冗余数据获取与组装逻辑</strong>。这个问题又该如何破解？</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 17:21</span>&nbsp;\n<a href=\"https://www.cnblogs.com/yhup\">yihuiComeOn</a>&nbsp;\n阅读(<span id=\"post_view_count\">5</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "2026年，让.NET再次伟大",
      "link": "https://www.cnblogs.com/msdeveloper/p/19427679/make-dotnet-great-again-2026",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/msdeveloper/p/19427679/make-dotnet-great-again-2026\" id=\"cb_post_title_url\" title=\"发布于 2025-12-31 17:19\">\n    <span>2026年，让.NET再次伟大</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"-2026让net再次伟大\">🚀 2026：让.NET再次伟大</h1>\n<blockquote>\n<p>2026年，应该考虑一个战略决策——将.NET SDK纳入操作系统，这将对整个开发生态产生深远影响。</p>\n</blockquote>\n<h2 id=\"-开篇单文件运行打开的新世界\">💡 开篇：单文件运行打开的新世界</h2>\n<p>.NET 10在多方面有显著进展，<strong>单文件运行</strong>的支持为新的使用场景打开了可能性。一个.cs文件就是一个完整的程序，这为开发范式的转变提供了基础。</p>\n<p>单文件运行带来的实际应用场景：</p>\n<ul>\n<li><strong>Web服务零部署</strong> - 编写<code>preview.cs</code>，十行代码用ASP.NET Core加载静态文件目录，无需安装<code>http-server</code></li>\n<li><strong>AI Agent快速迭代</strong> - 使用<code>Microsoft Agent Framework</code>，几十行代码直接与大模型对话，只需一个.cs文件</li>\n<li><strong>告别脚本文件</strong> - 用.cs替换ps1/bash脚本和CICD脚本，不用学习多种脚本语法，只需一个.cs文件</li>\n<li><strong>跨端开发</strong> - 单文件直接运行桌面应用、Web应用、控制台工具，无需打包发布</li>\n<li><strong>远程诊断</strong> - AI生成诊断代码发送给客户直接运行，无需安装应用，对SaaS远程支持意义重大</li>\n<li><strong>极速分享</strong> - 通过任何渠道分享代码片段，接收者无需安装应用即可运行</li>\n</ul>\n<p><strong>核心价值：</strong> 一个.cs文件 = 一个完整的、类型安全的、高性能的.NET程序。部分场景不再需要复杂工具链、CICD、Docker——只需一个.cs文件。</p>\n<h2 id=\"-遇到的障碍\">🔍 遇到的障碍</h2>\n<p>单文件很好很强大，但它有一个前提条件：需要安装 <strong>.NET 10 SDK</strong>，这是最后一堵墙，需要被打破。</p>\n<p><strong>现状困境：</strong> 用户需要先安装.NET SDK才能运行.cs文件，这个前置条件立即提高了门槛。</p>\n<p><strong>解决方案：</strong> 让.NET SDK成为操作系统的一部分——从Windows开始，然后推广到主流Linux发行版。</p>\n<h2 id=\"-战略价值一认知刷新\">🎯 战略价值一：认知刷新</h2>\n<p>当Windows或主流Linux发行版自带.NET SDK时，新的开发者和用户的认知将会逐渐改变。</p>\n<p>集成.NET SDK，Windows就拥有了<strong>统一的、功能完备的开发工具链</strong>和 <strong>.NET 运行环境</strong>，有了这个优势，它将成为上手编写程序最便捷的操作系统。也是运行.NET应用的首选平台。</p>\n<p>回顾一下，很多年前，Linux一些发行版就预装了Python和PHP等环境，这极大推动了这些语言的流行，开发者在这些系统上，无需额外安装环境，就能直接上手编写和运行脚本，它们被认为是对开发者友好的操作系统。</p>\n<p>不同于老旧和封闭的<code>.NET Framework</code>，现代.NET已被广大开发者认可，将.NET SDK直接带到操作系统中，不仅不会引起反感，反而会被视为对开发者友好的举措，它的单文件运行更加强大，更有发挥的空间。</p>\n<h2 id=\"战略价值二-统一工具链标准\">战略价值二： 统一工具链标准</h2>\n<p>在开发行业，工具链是绕不开的话题。.NET在这方面堪称典范。当操作系统自带一套标准工具链时，开发者和用户都将受益匪浅。同时也会推动其他生态进行反思和改进。</p>\n<p>来看看最火爆的两个生态：</p>\n<p><strong>Python生态：</strong></p>\n<pre><code>依赖管理：pip → venv/virtualenv → Poetry/Pipenv → requirements.txt/Pipfile\n构建工具：setuptools → wheel → flit → poetry → hatch\n测试框架：unittest → pytest → nose → hypothesis\n代码检查：pylint → flake8 → black → isort → mypy\n部署工具：gunicorn → uwsgi → docker\n</code></pre>\n<p>Python开发者需要学习和维护<strong>7-8种不同工具</strong>，每个项目配置各异。</p>\n<p><strong>Node.js生态：</strong></p>\n<pre><code>包管理：npm → yarn → pnpm（互不兼容的lock文件）\n构建工具：webpack → Rollup → Parcel → Vite → Turbopack\n测试框架：Jest → Mocha → Vitest → Playwright\n运行环境：node → deno → bun\n</code></pre>\n<p>Node.js开发者面对<strong>版本地狱和工具频繁更替</strong>。</p>\n<p>而.NET Core 从1.0到10.0，<strong>一个<code>dotnet</code>命令统一一切</strong>：</p>\n<pre><code class=\"language-bash\">dotnet new          # 项目创建\ndotnet build        # 编译\ndotnet test         # 单元测试\ndotnet run          # 运行\ndotnet publish      # 发布（含AOT编译、容器化）\ndotnet tool         # 工具管理\ndotnet add package  # 依赖管理\ndotnet format       # 代码格式化\ndotnet diagnostics  # 性能诊断\ndotnet ef           # 数据库迁移\n</code></pre>\n<blockquote>\n<p>[!IMPORTANT]<br />\n当其他生态炒作用Rust重构工具链的性能提升时，.NET从第一版起就用一个<code>dotnet</code>命令解决了所有问题。哦对了，.NET不需要版本管理工具，多版本可同时安装且互不干扰。</p>\n</blockquote>\n<h3 id=\"windows自带net-sdk的影响\">Windows自带.NET SDK的影响</h3>\n<ul>\n<li><strong>降低门槛</strong> - 所有.NET生态文档可去除\"先安装SDK\"的前置条件，更加友好。</li>\n<li><strong>开发者优先</strong> - 无论是开发者，还是发布者，都会优先考虑系统本身就支持的环境，而不需要让用户额外安装和配置运行环境。</li>\n<li><strong>AI工具崛起</strong> - 各种<code>CLI</code>工具，也会开始考虑使用.NET作为首选开发语言，因为用户不需要额外安装运行时环境。</li>\n<li><strong>系统工具升级</strong> - Windows非核心工具可用.NET开发，自带跨平台特性，告别WebView2</li>\n</ul>\n<p>无论是对开发者还是用户，这都是一个<strong>极大提升开发体验和用户体验的变革</strong>。</p>\n<h2 id=\"-战略价值三生态影响\">🌐 战略价值三：生态影响</h2>\n<h3 id=\"软件分发的范式转变\">软件分发的范式转变</h3>\n<p><strong>当前模式的痛点：</strong></p>\n<ul>\n<li><strong>传统应用</strong> - 安装包、注册表污染、卸载残留</li>\n<li><strong>包管理工具</strong> - npm、pip、apt各自为政，生态割裂</li>\n<li><strong>容器技术</strong> - 解决了依赖但增加了复杂性和资源开销</li>\n</ul>\n<p><strong>系统级.NET SDK带来的新可能：</strong></p>\n<ul>\n<li><strong>NuGet作为应用分发</strong> - <code>dotnet tool</code>成为应用安装器</li>\n<li><strong>代码即应用</strong> - 一个.cs文件或代码片段即可分发和运行</li>\n<li><strong>Aspire加持</strong> - 一个.cs文件运行整套复杂微服务应用</li>\n</ul>\n<h3 id=\"未来生态格局\">未来生态格局</h3>\n<p>当运用得当时，将形成这样的生态：</p>\n<ul>\n<li><strong>C#</strong> → 学习和工作的首选语言</li>\n<li><strong>GitHub</strong> → 最大的源代码托管平台</li>\n<li><strong>NuGet</strong> → 最大的工具分发平台</li>\n<li><strong>Windows</strong> → 最大的应用和服务平台</li>\n</ul>\n<blockquote>\n<p>[!IMPORTANT]<br />\n能用C#编写的应用，最终都应使用C#编写；能用.NET运行的程序，最终都会使用.NET运行。</p>\n</blockquote>\n<h3 id=\"net在ai领域的竞争力\">.NET在AI领域的竞争力</h3>\n<p>当前AI开发生态高度依赖Python，用户端工具常选择Node.js，企业级开发由于巨大的惯性逐渐转向Java。然而，.NET在AI开发领域拥有被低估的竞争优势：</p>\n<table>\n<thead>\n<tr>\n<th>优势维度</th>\n<th>具体价值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>性能</strong></td>\n<td>相比Python和Node.js有明显优势</td>\n</tr>\n<tr>\n<td><strong>类型安全</strong></td>\n<td>大型AI项目中显著减少运行时错误</td>\n</tr>\n<tr>\n<td><strong>文档处理</strong></td>\n<td>丰富的PDF、Word、Excel类库支持</td>\n</tr>\n<tr>\n<td><strong>Aspire</strong></td>\n<td>简化服务配置，内置遥测支持（AI应用基本需求）</td>\n</tr>\n<tr>\n<td><strong>单文件运行</strong></td>\n<td>可嵌入工作流，如在skills场景直接运行.cs处理逻辑</td>\n</tr>\n<tr>\n<td><strong>Azure</strong></td>\n<td>Azure对.NET SDK的第一方支持</td>\n</tr>\n</tbody>\n</table>\n<p>如果.NET SDK成为操作系统组件，这些优势将更易被开发者发现和利用，推动.NET在AI开发领域的采用。</p>\n<h2 id=\"-实现路径让愿景成真\">🚀 实现路径：让愿景成真</h2>\n<h3 id=\"让微软尤其是windows团队认识到这一战略机遇\">让微软，尤其是Windows团队认识到这一战略机遇</h3>\n<p><strong>社区发声：</strong></p>\n<ul>\n<li><strong>GitHub</strong> - 在dotnet相关仓库发表相关讨论和Issue.</li>\n<li><strong>社交媒体</strong> - 在X、Youtube等平台上，发布或转发相关观点，并通知微软/Dotnet/Windows官方账号</li>\n<li><strong>技术社区</strong> - 参与微软论坛、.NET Foundation邮件列表、Discord社区讨论</li>\n</ul>\n<p><strong>内容创作：</strong></p>\n<ul>\n<li>写博客、录视频推广这个愿景</li>\n<li>结合本文内容和自己的观点，创作更多相关内容</li>\n<li>形成更大影响力，推动决策落地</li>\n</ul>\n<blockquote>\n<p>[!IMPORTANT]<br />\nWindows不预装.NET，这就像是Windows不预装Edge浏览器，Android不预装Chrome浏览器一样让人费解，纯属是自费武功！</p>\n</blockquote>\n<h3 id=\"不作为的借口\">不作为的借口</h3>\n<p>我已经预料到一些人找出各种理由反对这个想法，找出各种借口，说出各种<strong>政治正确</strong>的理由，如：</p>\n<ul>\n<li>\"这会增加Windows的体积\"：正好清除一些没用的老旧的系统组件，腾出空间给.NET SDK。</li>\n<li>\"用户不需要也不关心.NET SDK\"：这是因果倒置。先不说你能代表多少用户，你先提供了，再谈用户需要不需要，关心不关心。</li>\n<li>\".NET Core是开源跨平台的，为什么要捆绑在Windows上\"：这种说法都不值一驳，因为跨平台跟你预装在Windows上并不冲突。早在十几年前，Linux就预装php/python等工具，这些工具的流行深受预装的影响。这种说法完全是不希望.NET成功的借口。那就同时预装在主流Linux发行版上好了。</li>\n<li>\"要考虑版本兼容性，以及多版本共存和更新问题\"：但凡用过.NET Core SDK的人都知道，这些都不是问题，.NET Core天生支持多版本共存，且版本管理非常简单，Windows能维护.NET Framework，搞不了.NET Core？</li>\n</ul>\n<p>多了解真正用户的声音，少听一些只会讲<code>政治正确</code>的非目标用户，多一些实际行动，真正做一些有益于生态发展的事情。</p>\n<blockquote>\n<p>[!TIP]<br />\n你可以借助本篇文章内容，结合自己的观点，创作更多相关内容，推广这个愿景。</p>\n</blockquote>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2025-12-31 17:19</span>&nbsp;\n<a href=\"https://www.cnblogs.com/msdeveloper\">TypingLearn</a>&nbsp;\n阅读(<span id=\"post_view_count\">307</span>)&nbsp;\n评论(<span id=\"post_comment_count\">2</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    }
  ]
}