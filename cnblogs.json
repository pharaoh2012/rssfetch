{
  "title": "主页 - 博客园",
  "link": "https://www.cnblogs.com/",
  "description": "主页 - 博客园 RSS",
  "entries": [
    {
      "title": "[Agent/AI编程] Claude Code 使用指南",
      "link": "https://www.cnblogs.com/johnnyzen/p/19541084",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/johnnyzen/p/19541084\" id=\"cb_post_title_url\" title=\"发布于 2026-02-01 00:57\">\n    <span>[Agent/AI编程] Claude Code 使用指南</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"0-序\">0 序</h1>\n<ul>\n<li>近期实在是刷到太多 Manus / OpenManus / Cursor / Codex / Gemini / Claude Code / OpenCode / Moltblot(OpenClaw/Clawd) 的 AI 编程Agent的文章、短视频了。</li>\n<li>但是很多文章对被 Anthropic 屏蔽的国内用户<strong>如何安装 Claude Code并正常使用</strong>、<strong>如何集成第三方大模型API（如：硅基流动等）到 Claude Code</strong>、<strong>如何基于VSCode使用ClaudeCode</strong>，并没有讲得很透彻。</li>\n</ul>\n<blockquote>\n<p>不少教程文档，暗藏私货————间接要求购买ClaudeCode镜像站服务、或者售卖 FQ 服务。<br />\n显然，这对于笔者而言，是不适用的。</p>\n</blockquote>\n<ul>\n<li>\n<p>此外，安装、使用过程中遇到的一些头痛的问题，也在 FAQ 章节悉数整理，并提供了解决方案。</p>\n</li>\n<li>\n<p>通过本文一篇文档，即可一网打尽，快速上手 Claude Code!</p>\n</li>\n</ul>\n<h1 id=\"1-概述claude-code\">1 概述：Claude Code</h1>\n<h2 id=\"产品定位它是什么解决了什么问题\">产品定位：它是什么？解决了什么问题？</h2>\n<ul>\n<li>Claude Code 是 Anthropic 推出的终端 AI 编码助手,核心理念是\"住在终端里\"。</li>\n</ul>\n<blockquote>\n<p>它能够帮助开发者编写代码、调试程序、重构代码、解释复杂逻辑，大大提升编程效率。<br />\n它能理解项目结构、编辑代码、执行命令、管理 Git,虽然支持 IDE 集成,但本质是【命令行驱动】的工具。<br />\n其还推出有VSCode插件等多种<strong>终端形态</strong>，将强大的Claude AI助手直接集成到您的开发环境中。</p>\n</blockquote>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202602/1173617-20260201012039153-282118530.png\" /></p>\n<ul>\n<li>Claude Code 的定位：</li>\n</ul>\n<blockquote>\n<p>不是<strong>AI聊天工具</strong>，而是在【本地代码仓库】中执行高权限、【可上下文感知】的工程任务。<br />\nClaude Code 与在聊天窗口里写几段代码不同，它理解你的整个项目，能直接读取你的文件、运行测试并根据反馈修改代码。<br />\nClaude Code 不是一个<strong>代码生成器</strong>，而是一个能【读项目】、【懂上下文】、【遵守约束】的【 <code>AI</code> 编程搭档】。</p>\n</blockquote>\n<pre><code class=\"language-txt\">它不是网页里的聊天框，而是直接在你的终端(Terminal)里运行,可以:\n  读取你整个项目的代码\n  理解文件之间的关系\n  直接修改代码文件\n  执行你的指令并给出建议\n</code></pre>\n<blockquote>\n<ul>\n<li><code>Claude Code</code> 是 一款面向 AI 编程场景的<strong>Agent（智能体工具）</strong>，不是 <strong>Chat（聊天工具）</strong>。</li>\n</ul>\n</blockquote>\n<ul>\n<li>从<strong>能力角度</strong>看，Claude Code 主要具备三点特征：</li>\n</ul>\n<blockquote>\n<ul>\n<li><strong>上下文感知</strong>：不仅理解单个文件，而是理解整个项目结构</li>\n<li><strong>工程化导向</strong>：关注可维护性、规范、测试，而不是一次性代码</li>\n<li><strong>可定制行为</strong>：通过 Skills（技能包）让 AI 遵守你的规则</li>\n</ul>\n</blockquote>\n<ul>\n<li>开源版本的替代品(OpenCode)</li>\n</ul>\n<blockquote>\n<p>您可以参考这篇文章: <a href=\"https://www.kevnu.com/zh/posts/opencode-in-depth-technical-analysis-of-open-source-ai-programming-agents\" rel=\"noopener nofollow\" target=\"_blank\">https://www.kevnu.com/zh/posts/opencode-in-depth-technical-analysis-of-open-source-ai-programming-agents</a></p>\n</blockquote>\n<ul>\n<li>关于 <code>Claude Agent Skills</code></li>\n</ul>\n<blockquote>\n<p>您可以参考这篇文章: <a href=\"https://www.kevnu.com/zh/posts/claude-agent-skills-deep-dive-a-new-paradigm-for-expanding-ai-agent-capabilities\" rel=\"noopener nofollow\" target=\"_blank\">https://www.kevnu.com/zh/posts/claude-agent-skills-deep-dive-a-new-paradigm-for-expanding-ai-agent-capabilities</a></p>\n</blockquote>\n<h2 id=\"claude-code-能做什么\">Claude Code 能做什么?</h2>\n<blockquote>\n<p>Claude Code 的核心能力可以归纳为这几点:</p>\n</blockquote>\n<ul>\n<li>1、代码理解与解释</li>\n</ul>\n<blockquote>\n<p>我们可以问它:</p>\n<ul>\n<li>这个函数是干什么的?</li>\n<li>为什么这里会报错?</li>\n<li>这段代码的性能瓶颈在哪?</li>\n<li>它会结合你的项目上下文给出解释。</li>\n</ul>\n</blockquote>\n<ul>\n<li>2、多文件上下文分析</li>\n</ul>\n<blockquote>\n<p>不同于简单的代码补全工具,Claude Code 能理解:</p>\n<ul>\n<li>这个函数在哪些地方被调用了</li>\n<li>这个模块依赖了哪些其他文件</li>\n<li>整个项目的架构是怎样的</li>\n</ul>\n</blockquote>\n<ul>\n<li>3、工程级代码修改</li>\n</ul>\n<blockquote>\n<p>我们可以说:</p>\n<ul>\n<li>把所有用 var 的地方改成 let</li>\n<li>把这个函数拆成三个小函数</li>\n<li>给所有接口加上错误处理</li>\n<li>它会帮你实际修改代码,而不只是给建议。</li>\n</ul>\n</blockquote>\n<ul>\n<li>4、通过 Skills(技能包)扩展能力</li>\n</ul>\n<blockquote>\n<p>Skills 是 Claude Code 最强大的地方——我们可以教它你的编码习惯和团队规范，让它按我们的方式工作。<br />\n比如:</p>\n<ul>\n<li>我们团队要求所有函数都加注释</li>\n<li>API 响应必须符合特定格式</li>\n<li>测试用例要覆盖边界情况</li>\n<li>你可以把这些要求写成 Skills，Claude Code 就会自动遵守。</li>\n</ul>\n</blockquote>\n<h2 id=\"claude-code-不能做什么\">Claude Code 不能做什么?</h2>\n<ul>\n<li>Claude Code 不擅长的事情：</li>\n</ul>\n<blockquote>\n<ul>\n<li>不能替你做技术决策的最终判断</li>\n<li>不能保证生成代码 100% 无 Bug</li>\n<li>不能理解你没有明确说明的业务语义</li>\n<li>不适合在你完全不理解的情况下【全自动接管】项目</li>\n<li>一个成熟的使用心态是：让 Claude Code 提供高质量候选方案，而不是【绝对正确答案】。</li>\n</ul>\n</blockquote>\n<h2 id=\"claude-code-的核心价值\">Claude Code 的核心价值</h2>\n<ul>\n<li>Claude Code 的核心理念：【协作】，而不是【替代】</li>\n</ul>\n<blockquote>\n<p>Claude Code 并不是在追求把开发者踢出局，它的设计理念非常明确：</p>\n</blockquote>\n<ul>\n<li>人负责：目标、约束、判断、审美</li>\n<li>AI 负责：执行、分析、对比、重复劳动</li>\n</ul>\n<h3 id=\"对编程新手-降低学习门槛\">对编程新手: 降低学习门槛</h3>\n<ul>\n<li>如果你是新手，最痛苦的可能是:</li>\n</ul>\n<blockquote>\n<ul>\n<li>看不懂别人的代码</li>\n<li>不知道为什么报错</li>\n<li>不知道好代码长什么样</li>\n</ul>\n</blockquote>\n<ul>\n<li>Claude Code 可以:</li>\n</ul>\n<blockquote>\n<ul>\n<li><strong>用人话解释代码</strong>: 这段代码的意思是先检查用户是否登录，如果没登录就跳转到登录页</li>\n<li><strong>帮你 Debug</strong>: 这里报错是因为变量名拼错了，应该是 username 不是 usrname</li>\n<li><strong>教你写更好的代码</strong>: 这个函数太长了，可以拆成三个小函数，分别负责验证、处理、返回</li>\n</ul>\n</blockquote>\n<h3 id=\"对独立开发者-提升开发效率\">对独立开发者: 提升开发效率</h3>\n<ul>\n<li>如果你是独立开发者，你可能:</li>\n</ul>\n<blockquote>\n<ul>\n<li>一个人负责前后端</li>\n<li>没人帮你 Code Review</li>\n<li>需要快速试错和迭代</li>\n</ul>\n</blockquote>\n<ul>\n<li>Claude Code 可以:</li>\n</ul>\n<blockquote>\n<ul>\n<li>帮你快速理解第三方库的用法</li>\n<li>自动生成测试用例</li>\n<li>帮你重构混乱的代码</li>\n</ul>\n</blockquote>\n<h3 id=\"对团队-统一规范降低协作成本\">对团队: 统一规范,降低协作成本</h3>\n<ul>\n<li>如果你在团队工作，你可能遇到:</li>\n</ul>\n<blockquote>\n<ul>\n<li>每个人代码风格不一样</li>\n<li>新人上手慢,老是问重复问题</li>\n<li>Code Review 花时间</li>\n</ul>\n</blockquote>\n<ul>\n<li>Claude Code 可以:</li>\n</ul>\n<blockquote>\n<ul>\n<li>通过 Skills 统一团队规范(所有人用同一套规则)</li>\n<li>帮新人快速理解项目</li>\n<li>在提交前自动检查代码质量</li>\n</ul>\n</blockquote>\n<h2 id=\"claude-code-适合哪些人适用场景\">Claude Code 适合哪些人?适用场景？</h2>\n<ul>\n<li>建议以下几类人可以尝试 Claude Code:</li>\n</ul>\n<blockquote>\n<ul>\n<li><strong>编程新手</strong><br />\n想学编程但总是卡在看不懂代码<br />\n需要一个随时解答问题的老师</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><strong>独立开发者 / 创业者</strong><br />\n一个人做项目,需要快速试错<br />\n想把时间花在核心功能上,不想在琐碎问题上卡住</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><strong>后端 / 前端 / 全栈工程师</strong><br />\n想提升开发效率<br />\n想学习更好的代码写法<br />\n需要快速理解复杂项目</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><strong>技术负责人 / 架构师</strong><br />\n想用 AI 辅助团队规范落地<br />\n想降低新人培养成本</li>\n</ul>\n</blockquote>\n<ul>\n<li><strong>不适合的场景</strong></li>\n</ul>\n<blockquote>\n<p>你完全不想学编程，只想输入需求自动出项目(AI 还做不到)<br />\n你的工作涉及高度敏感代码，不能使用外部 AI 服务</p>\n</blockquote>\n<h2 id=\"claude-code-vs-其他-ai-编程工具\">Claude Code vs 其他 AI 编程工具</h2>\n<blockquote>\n<p>你可能还听说过 ChatGPT、Cursor、GitHub Copilot，它们和 Claude Code 有什么不同?</p>\n</blockquote>\n<ul>\n<li>Claude Code vs ChatGPT</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>维度</th>\n<th>ChatGPT</th>\n<th>Claude Code</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>使用方式</td>\n<td>网页聊天</td>\n<td>命令行工具</td>\n</tr>\n<tr>\n<td>代码理解</td>\n<td>需要手动粘贴</td>\n<td>自动读取整个项目</td>\n</tr>\n<tr>\n<td>文件修改</td>\n<td>给建议,你手动改</td>\n<td>可以直接修改文件</td>\n</tr>\n<tr>\n<td>适合场景</td>\n<td>问问题、学概念</td>\n<td>真实项目开发</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>Claude Code vs Cursor / Copilot</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>维度</th>\n<th>Cursor / Copilot</th>\n<th>Claude Code 、 VSCode+通义灵码/CC等Agent插件</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>工作方式</td>\n<td>编辑器内自动补全</td>\n<td>命令行对话式</td>\n</tr>\n<tr>\n<td>适合场景</td>\n<td>写代码时实时提示</td>\n<td>理解、重构、架构级修改</td>\n</tr>\n<tr>\n<td>学习成本</td>\n<td>低,开箱即用</td>\n<td>中,需要学习指令</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>简单总结:</li>\n</ul>\n<blockquote>\n<ul>\n<li>Copilot/Cursor:边写边补全，像智能输入法</li>\n<li>Claude Code:对话式协作，像高级搭档</li>\n<li>ChatGPT:通用助手，像顾问</li>\n<li>Claude Code 的优势:</li>\n</ul>\n</blockquote>\n<ul>\n<li>对整个项目的理解能力更强</li>\n</ul>\n<blockquote>\n<ul>\n<li>可以通过 Skills 定制行为</li>\n<li>更适合理解旧代码大规模重构等场景</li>\n</ul>\n</blockquote>\n<ul>\n<li>Claude Code 的局限:</li>\n</ul>\n<blockquote>\n<ul>\n<li>不如 Copilot 那样无感(需要主动调用)</li>\n<li>学习曲线稍高</li>\n</ul>\n</blockquote>\n<h1 id=\"2-安装篇\">2 安装篇</h1>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260128012724799-89954919.png\" /></p>\n<blockquote>\n<p><a href=\"https://code.claude.com/docs/zh-CN/desktop\" rel=\"noopener nofollow\" target=\"_blank\">https://code.claude.com/docs/zh-CN/desktop</a></p>\n</blockquote>\n<ul>\n<li>Claude Code 支持的终端形态：</li>\n</ul>\n<blockquote>\n<ul>\n<li><strong>Web 版</strong></li>\n</ul>\n<blockquote>\n<p><a href=\"https://code.claude.com/docs/zh-CN/claude-code-on-the-web\" rel=\"noopener nofollow\" target=\"_blank\">https://code.claude.com/docs/zh-CN/claude-code-on-the-web</a></p>\n</blockquote>\n<ul>\n<li><strong>桌面版</strong></li>\n</ul>\n<blockquote>\n<p>目前 Claude Code 的<strong>桌面版</strong>也发布了，下载地址： <a href=\"https://claude.com/download\" rel=\"noopener nofollow\" target=\"_blank\">https://claude.com/download</a></p>\n</blockquote>\n<ul>\n<li>Chrome 扩展程序（测试版）</li>\n<li>VsCode 插件版</li>\n</ul>\n<blockquote>\n<p><a href=\"https://code.claude.com/docs/zh-CN/vs-code\" rel=\"noopener nofollow\" target=\"_blank\">https://code.claude.com/docs/zh-CN/vs-code</a></p>\n</blockquote>\n<ul>\n<li>JetBrains IDEs</li>\n<li>Github Actions with Claude Code</li>\n<li>GitLab CI/CD</li>\n<li>Slack with Claude Code</li>\n</ul>\n</blockquote>\n<ul>\n<li>Claude Code (CLI版 / VSCode插件版)vs. 网页版 Claude</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>Claude 网页版 / App</th>\n<th>Claude Code (CLI)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>交互方式</td>\n<td>复制粘贴代码到对话框</td>\n<td>直接在终端通过指令操作</td>\n</tr>\n<tr>\n<td>文件访问</td>\n<td>手动上传文件</td>\n<td>自动读取/搜索整个工程目录</td>\n</tr>\n<tr>\n<td>执行能力</td>\n<td>仅生成文本</td>\n<td>执行 Shell 命令、运行测试、创建文件</td>\n</tr>\n<tr>\n<td>上下文感知</td>\n<td>有限的对话上下文</td>\n<td>深度感知项目结构和 Git 历史</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>打个比方:</p>\n<ul>\n<li><code>Claude</code>(网页版) 就像一个顾问/实习生/助理，你把代码截图或复制给他，他给你建议，但你得自己动手改。</li>\n<li><code>Claude Code</code> 就像一个坐在你旁边的搭档，他能看到你的整个项目，帮你改代码，甚至帮你写测试、重构函数。</li>\n</ul>\n</blockquote>\n<ul>\n<li>三种常见终端方式的对比</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>方式</th>\n<th>适合人群</th>\n<th>优点</th>\n<th>缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Web 端</td>\n<td>完全新手</td>\n<td>无需安装,打开就用</td>\n<td>功能相对有限</td>\n</tr>\n<tr>\n<td>CLI(命令行)</td>\n<td>有一定基础的开发者</td>\n<td>功能完整,集成度高</td>\n<td>需要熟悉命令行</td>\n</tr>\n<tr>\n<td>IDE/编辑器集成（VS Code / Cursor 等）</td>\n<td>日常开发</td>\n<td>无缝融入工作流</td>\n<td>依赖插件和环境配置</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<ul>\n<li>如果你是<strong>完全新手</strong>，先用 Web 端 <a href=\"https://claude.ai/\" rel=\"noopener nofollow\" target=\"_blank\">https://claude.ai/</a> 试试手感</li>\n<li>如果你想<strong>真正用于开发</strong>，直接学 <code>CLI</code>(命令行)</li>\n<li>如果你已经<strong>熟练使用</strong>，再考虑<strong>IDE/编辑器集成</strong></li>\n</ul>\n</blockquote>\n<h2 id=\"前置步骤注册第三方大模型供应商的账户并获取api-key\">前置步骤：注册第三方大模型供应商的账户、并获取API KEY</h2>\n<ul>\n<li>硅基流动</li>\n</ul>\n<blockquote>\n<ul>\n<li><a href=\"https://www.cnblogs.com/johnnyzen/p/18714654\" target=\"_blank\">[AI/GPT] 硅基流动(SiliconFlow) : AI大模型时代的基础设施(Model API as Service) - 博客园/千千寰宇</a></li>\n<li><a href=\"https://cloud.siliconflow.cn/i/djWvMoJw\" rel=\"noopener nofollow\" target=\"_blank\">https://account.siliconflow.cn/</a></li>\n<li><a href=\"https://cloud.siliconflow.cn/i/djWvMoJw\" rel=\"noopener nofollow\" target=\"_blank\">https://cloud.siliconflow.cn/</a></li>\n</ul>\n<blockquote>\n<p>近期在搞活动，注册即送代金券。</p>\n</blockquote>\n</blockquote>\n<ul>\n<li>\n<p>百炼</p>\n</li>\n<li>\n<p>DeepSeek</p>\n</li>\n<li>\n<p>GLM</p>\n</li>\n<li>\n<p>...</p>\n</li>\n</ul>\n<h2 id=\"cli-命令版npm-安装方式推荐\">CLI 命令版：NPM 安装方式（推荐）</h2>\n<h3 id=\"安装-nodejs--npm\">安装 NodeJs / Npm</h3>\n<ul>\n<li>安装 Nodejs / NPM</li>\n</ul>\n<blockquote>\n<ul>\n<li>nodejs version &gt;= 18</li>\n<li><a href=\"https://www.cnblogs.com/johnnyzen/p/18078785\" target=\"_blank\">安装部署 - NodeJs 教程（1）入门篇 - 博客园/千千寰宇</a></li>\n</ul>\n</blockquote>\n<ul>\n<li>验证</li>\n</ul>\n<blockquote>\n<p>CMD / Git-Bash / Powershell</p>\n</blockquote>\n<pre><code class=\"language-shell\">C:\\Users\\Xxx&gt; node --version\nv20.11.1\n\nC:\\Users\\Xxx&gt; npm --version\n10.2.4\n\nC:\\Users\\Xxx&gt; npm config get prefix\nD:\\Program_Files\\nodejs\\node-v20.11.1-win-x64\n</code></pre>\n<h3 id=\"基于-npm-安装-claude-code\">基于 npm 安装 Claude Code</h3>\n<ul>\n<li>基于 npm 安装 Claude Code</li>\n</ul>\n<pre><code class=\"language-shell\">npm install -g @anthropic-ai/claude-code\n或: npm install -g @anthropic-ai/claude-code --registry=https://registry.npmmirror.com\n</code></pre>\n<blockquote>\n<p>卸载命令: <code>npm uninstall -g @anthropic-ai/claude-code</code></p>\n</blockquote>\n<ul>\n<li>查看安装情况</li>\n</ul>\n<pre><code class=\"language-shell\">$ npm list -g\nD:\\Program_Files\\nodejs\\node-v20.11.1-win-x64\n+-- @anthropic-ai/claude-agent-sdk@0.2.19\n+-- @anthropic-ai/claude-code@2.1.19\n...\n</code></pre>\n<h2 id=\"cli命令版原生安装脚本方式\">CLI命令版：原生安装脚本方式</h2>\n<h3 id=\"macos--linux--wsl\">macOS / Linux / WSL</h3>\n<pre><code class=\"language-she;;\">curl -fsSL https://claude.ai/install.sh | bash\n</code></pre>\n<h3 id=\"windows\">Windows</h3>\n<ul>\n<li>Windows PowerShell</li>\n</ul>\n<pre><code class=\"language-shell\">irm https://claude.ai/install.ps1 | iex\n</code></pre>\n<ul>\n<li>Windows CMD:</li>\n</ul>\n<pre><code class=\"language-shell\">curl -fsSL https://claude.ai/install.cmd -o install.cmd &amp;&amp; install.cmd &amp;&amp; del install.cmd\n</code></pre>\n<h2 id=\"cli命令版验证启动使用\">CLI命令版：验证/启动/使用</h2>\n<h3 id=\"查验版本\">查验版本</h3>\n<blockquote>\n<p>Git-Bash 环境下为例:</p>\n</blockquote>\n<pre><code class=\"language-shell\">$ claude --version\n2.1.20 (Claude Code)\n\n$ ls ~/.claude\nconfig.json  debug/  ide/  projects/  skills/  statsig/  telemetry/  todos/\n\n$ vim ~/.claude.json\n</code></pre>\n<blockquote>\n<p><code>powershell</code>: <code>notepad $env:USERPROFILE\\.claude.json</code></p>\n</blockquote>\n<h3 id=\"健康检查\">健康检查</h3>\n<pre><code class=\"language-shell\">C:\\Users\\Xxx&gt; claude doctor\n\n Checking installation status…                                                                                                                                                                Diagnostics\n └ Currently running: unknown (2.1.20)\n └ Path: D:\\Program_Files\\nodejs\\node-v20.11.1-win-x64\\node.exe\n └ Invoked: D:\\Program_Files\\nodejs\\node-v20.11.1-win-x64\\node_modules\\@anthropic-ai\\claude-code\\cli.js\n └ Config install method: unknown\n └ Search: OK (vendor)\n\n Updates\n └ Auto-updates: enabled\n └ Auto-update channel: latest\n\n └rStabletversion:n2.1.7…                                                                                                                                                                     └ Latest version: 2.1.20\n\n Press Enter to continue…   \n</code></pre>\n<blockquote>\n<p>注： Git-Bash 环境下执行 <code>export CLAUDE_DISABLE_RAW_MODE=1 &amp;&amp; claude doctor</code>，亲测无效，忽略即可。</p>\n</blockquote>\n<h3 id=\"指定文件夹下启动-claude-code\">（指定文件夹下）启动 Claude Code</h3>\n<ul>\n<li>启动 Claude Code</li>\n</ul>\n<blockquote>\n<p>注：<strong>基于<code>claude</code>命令启动时报不支持的国家/地区: <code>Claude Code might not be available in your country. Check supported countries ...</code></strong> 问题，参见 FAQ 章节</p>\n</blockquote>\n<pre><code class=\"language-shell\"># cd /path/to/your/project\n# claude\n</code></pre>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260130235245646-1795744864.png\" /></p>\n<blockquote>\n<p>看到版本信息或进入交互提示符,说明安装成功。<br />\n输入<code>1</code> 即进入 Claude Code；反之，输入<code>2</code> 或 <code>Esc</code> 即退出 Claude 并会退到命令行窗口<br />\n假定输入<code>1</code></p>\n</blockquote>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260130235723743-205516763.png\" /></p>\n<h3 id=\"登录与授权\">登录与授权</h3>\n<ul>\n<li>首次运行 <code>claude</code> 会提示登录,支持3种方式:</li>\n</ul>\n<blockquote>\n<ul>\n<li><strong>个人/团队/企业用户</strong>: 使用 <a href=\"https://claude.ai/\" rel=\"noopener nofollow\" target=\"_blank\">Claude.ai</a> 账户交互式登录</li>\n</ul>\n<blockquote>\n<p>Claude account with subscription · Pro, Max, Team, or Enterprise</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<ul>\n<li><strong>API 用户</strong>: 使用 Anthropic API Key 授权</li>\n</ul>\n<blockquote>\n<p><a href=\"https://console.anthropic.com/\" rel=\"noopener nofollow\" target=\"_blank\">Anthropic Console account</a> · API usage billing</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<ul>\n<li><strong>第三方平台</strong> （国内用户，推荐选项）</li>\n</ul>\n<blockquote>\n<p>3rd-party platform · Amazon Bedrock, Microsoft Foundry, or Vertex AI</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>凭据保存在 <code>~/.config/claude</code>，后续可通过 <code>/login</code> 命令重新登录或切换账户。</p>\n</blockquote>\n</blockquote>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260131000143987-164122988.png\" /></p>\n<h4 id=\"登录方法1配置大模型api的环境变量\">登录方法1：配置大模型API的环境变量</h4>\n<pre><code class=\"language-shell\">ANTHROPIC_AUTH_TOKEN  你的API Key\nANTHROPIC_BASE_URL    https://api.siliconflow.cn/\nANTHROPIC_MODEL       moonshotai/Kimi-K2-Instruct\n</code></pre>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260131005851593-473212784.png\" /></p>\n<blockquote>\n<ul>\n<li>设置环境变量的方法</li>\n</ul>\n</blockquote>\n<pre><code class=\"language-shell\">//方法1 图形化界面配置\n此电脑” -&gt; 选择 “属性” -&gt; “高级系统设置” -&gt; “系统属性” 窗口中点击 “环境变量” -&gt; 点击 “新建” -&gt; 配置变量及其值\n\n\n//方法2 powershell (永久设置)\n[Environment]::SetEnvironmentVariable(\"ANTHROPIC_AUTH_TOKEN\", \"sk-xxx\", \"User\")\n[Environment]::SetEnvironmentVariable(\"ANTHROPIC_BASE_URL\", \"https://api.siliconflow.cn/\", \"User\")\n\n//方法3 cmd 设置 (永久设置)\nsetx ANTHROPIC_AUTH_TOKEN \"sk-xxx\"\nsetx ANTHROPIC_BASE_URL \"https://api.whatai.cc\"\n\n//方法4 通过settings.json 设置 (找到 settings.json 文件，如果没有请创建)\nC:\\Users\\{user}\\.claude\\settings.json\n或 vim ~/.claude/settings.json\n{\n    \"env\": {\n      \"ANTHROPIC_MODEL\": \"claude-sonnet-4-20250514\",\n      \"ANTHROPIC_SMALL_FAST_MODEL\": \"claude-sonnet-4-20250514\",\n      \"ANTHROPIC_BASE_URL\": \"https://api.whatai.cc\",\n      \"ANTHROPIC_AUTH_TOKEN\": \"sk-XXXXXXXX\"\n    }\n  }\n</code></pre>\n<blockquote>\n<p>注意： <strong>永久设置</strong>后需要【重启终端】才能生效。推荐使用永久配置方式。</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>查验环境变量的方法</li>\n</ul>\n</blockquote>\n<pre><code class=\"language-shell\">//windows 环境下\necho %ANTHROPIC_AUTH_TOKEN%\necho %ANTHROPIC_BASE_URL%\necho %ANTHROPIC_MODEL%\n\n\n//git-bash 环境下\nenv | grep -i ANTHROPIC\n</code></pre>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260131011412761-79686648.png\" /></p>\n<blockquote>\n<p>配置完成后，即可通过: Windows CMD / Windows Powershell 窗口以 <code>cluade</code> 命令启动。</p>\n<blockquote>\n<p>注： Windows Git-Bash 无法成功启动 Claude。</p>\n</blockquote>\n</blockquote>\n<pre><code class=\"language-shell\">//如下方式可实现在 Git-Bash 中配置环境变量 （但Git-Bash 无法成功启动 Claude，忽略即可）\n&gt; vi ~/.bash_profile\n# generated by Git for Windows\ntest -f ~/.profile &amp;&amp; . ~/.profile\ntest -f ~/.bashrc &amp;&amp; . ~/.bashrc\n\n&gt; vi ~/.bashrc\n\texport ANTHROPIC_AUTH_TOKEN=\"sk-xxxxxx37t3edsbdskbk3rfsfdfs\"\n\texport ANTHROPIC_BASE_URL=\"https://api.siliconflow.cn/\"\n\texport ANTHROPIC_MODEL=\"zai-org/GLM-4.6\"\n\n&gt; source ~/.bashrc\n</code></pre>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260131010603398-1476718500.png\" /></p>\n<h3 id=\"基本使用\">基本使用</h3>\n<ul>\n<li>可直接提问</li>\n</ul>\n<blockquote>\n<p>例如: \"使用Python脚本抓取近10年的中国GDP数据\"<br />\n...</p>\n</blockquote>\n<h3 id=\"退出-claude-code\">退出 Claude Code</h3>\n<pre><code>/exit\n</code></pre>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260130235829255-1767886745.png\" /></p>\n<h2 id=\"visual-studio-code-中使用-claude-code\">Visual Studio Code 中使用 Claude Code</h2>\n<ul>\n<li>推荐文献</li>\n</ul>\n<blockquote>\n<ul>\n<li><a href=\"https://blog.csdn.net/u010953692/article/details/155396404\" rel=\"noopener nofollow\" target=\"_blank\">Visual Studio Code 中使用 Claude Code - CSDN</a></li>\n<li><a href=\"https://blog.csdn.net/Justin_JGT/article/details/154661242\" rel=\"noopener nofollow\" target=\"_blank\">vscode配置Claude Code（使用智谱API） - CSDN</a></li>\n</ul>\n</blockquote>\n<h3 id=\"step1-安装-claude-code-扩展插件\">Step1 安装 Claude Code 扩展插件</h3>\n<ul>\n<li>打开 VS Code，搜索并安装插件: <code>Claude Code for VS Code</code></li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260128014109613-486777162.png\" /></p>\n<ul>\n<li>补充安装方式：命令行安装</li>\n</ul>\n<pre><code class=\"language-shell\"># 安装 VSCode 扩展\ncode --install-extension anthropic.claude-code\n</code></pre>\n<ul>\n<li>补充安装方式：手动下载安装</li>\n</ul>\n<blockquote>\n<ul>\n<li>访问 <a href=\"https://open-vsx.org/extension/Anthropic/claude-code\" rel=\"noopener nofollow\" target=\"_blank\">VSCode Marketplace</a></li>\n<li>点击 \"Download Extension\" 下载 <code>.vsix</code> 文件</li>\n<li>在VSCode中使用命令面板 (<code>Ctrl+Shift+P</code> 或 <code>Cmd+Shift+P</code>)</li>\n<li>输入 \"<code>Extensions: Install from VSIX</code>\"</li>\n<li>选择下载的文件进行安装</li>\n</ul>\n</blockquote>\n<h3 id=\"step2-安装启用第三方工具cc-switch\">Step2 安装/启用第三方工具：<code>CC-Switch</code></h3>\n<blockquote>\n<p><code>CC-Switch</code> 的作用：<br />\n通过【代理】本地电脑中 ClaudeCode/Codex/Gemini Agent 软件对【大模型供应商】（如：硅基流动）的API请求，解决（尤其是 VSCode 中的 Cluade Code 插件与这些第三方大模型供应商）二者之间无法直接兼容使用的问题。</p>\n</blockquote>\n<ul>\n<li>创建/编辑 <code>~/.cluade/setting.json</code> 一个 JSON 格式的空文件</li>\n</ul>\n<blockquote>\n<p>如果先前以创建，则可忽略此步骤</p>\n</blockquote>\n<pre><code class=\"language-shell\">&gt; notepad C:\\Users\\Johnny\\.claude\\setting.json\n{\n\n}\n</code></pre>\n<ul>\n<li><code>CC-Switch</code> 安装包下载</li>\n</ul>\n<blockquote>\n<p><a href=\"https://github.com/farion1231/cc-switch/releases/tag/v3.9.1\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/farion1231/cc-switch/releases/tag/v3.9.1</a><br />\ngithub 访问不便的可下载： <a href=\"https://wwbbj.lanzout.com/iAqC63g3yhze\" rel=\"noopener nofollow\" target=\"_blank\">https://wwbbj.lanzout.com/iAqC63g3yhze</a></p>\n</blockquote>\n<blockquote>\n<p>CC-Switch-v3.9.1-Windows-Portable.zip</p>\n</blockquote>\n<ul>\n<li>下载完后解压、点击<code>cc-switch.exe</code>启动</li>\n</ul>\n<pre><code class=\"language-shell\">D:\\Program\\CCSwitch\\\n</code></pre>\n<ul>\n<li>开始配置大模型供应商</li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260131234306200-497077722.png\" /></p>\n<blockquote>\n<ul>\n<li>以硅基流动为例:</li>\n</ul>\n</blockquote>\n<pre><code class=\"language-txt\">请求地址： https://api.siliconflow.cn\n官网链接： https://cloud.siliconflow.cn/\n模型： (自己去官网选择自己想用的)\n    例如:  zai-org/GLM-4.6 ; deepseek-ai/DeepSeek-V3.2 ; ...\n</code></pre>\n<ul>\n<li>选择启用 CC-Switch</li>\n</ul>\n<blockquote>\n<p>启用后，将通过 CC-Switch 代理</p>\n</blockquote>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260131234818430-1993734150.png\" /></p>\n<blockquote>\n<p>注意事项：启用 CC-Switch 时，会与原先配置的 Claude Code 环境变量（<code>ANTHROPIC_AUTH_TOKEN/ANTHROPIC_BASE_URL/ANTHROPIC_MODEL</code>）产生冲突，其将要求删除之。</p>\n</blockquote>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260131234646541-619472573.png\" /></p>\n<ul>\n<li>此时，再打开 VSCode / 或 Claude Code CLI 即可使用了</li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260131235845352-877118635.png\" /></p>\n<h3 id=\"编辑-claude-code-插件的设置文件settingsjson-此步骤废止\">编辑 Claude Code 插件的设置文件(<code>settings.json</code>) 【此步骤废止】</h3>\n<ul>\n<li>为设置 Claude Code 插件——编辑 <code>settings.json</code></li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260128015745431-196768475.png\" /></p>\n<blockquote>\n<p><code>C:\\Users\\Xxx\\AppData\\Roaming\\Code\\User\\settings.json</code></p>\n</blockquote>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260128020747200-1154238779.png\" /></p>\n<blockquote>\n<ul>\n<li>编辑配置文件 settings.json</li>\n</ul>\n</blockquote>\n<pre><code class=\"language-json\">    , ...\n    \"claudeCode.environmentVariables\": [\n        { \n            \"name\" : \"ANTHROPIC_BASE_URL\"\n            , \"value\": \"https://api.siliconflow.cn/\" \n        }\n        , { \n            \"name\" : \"ANTHROPIC_AUTH_TOKEN\"\n            , \"value\": \"你的 API-Key\" \n        }\n    ],\n    \"claudeCode.disableLoginPrompt\": true\n</code></pre>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260128015920438-539880121.png\" /></p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260131233527134-1624485459.png\" /></p>\n<h1 id=\"3-slash-命令\">3 Slash 命令</h1>\n<ul>\n<li>\n<p>本节汇总 Claude Code 的内置命令与自定义命令要点。</p>\n</li>\n<li>\n<p><strong>内置命令</strong>: 用于控制会话、查看状态、导出、调试等,使用频率高,应记住常用几条</p>\n</li>\n<li>\n<p><strong>自定义命令</strong>: 通过 Markdown 文件定义,支持参数、bash 执行、文件引用和权限控制,适合把常用模板固化为命令</p>\n</li>\n</ul>\n<h2 id=\"claude-code-内置常用命令\">Claude Code 内置常用命令</h2>\n<ul>\n<li><code>claude</code> - 启动交互模式</li>\n<li><code>claude \"task\"</code> - 运行一次性任务</li>\n<li><code>claude commit</code> - 创建 Git 提交</li>\n</ul>\n<hr />\n<ul>\n<li><code>/add-dir</code>: 添加额外的工作目录</li>\n<li><code>/agents</code>: 管理自定义子代理(AI subagents)</li>\n<li><code>/bashes</code>: 列出/管理后台 bash 任务</li>\n<li><code>/bug</code>: 上报 bug(会把对话发送到 Anthropic)</li>\n<li><code>/clear</code>: <span style=\"color: rgba(255, 0, 0, 1);\">清空会话历史（清空对话内容，重新启动）</span></li>\n<li><code>/compact [instructions]</code>: <span style=\"color: rgba(255, 0, 0, 1);\">压缩会话上下文,可带聚焦指令</span></li>\n<li><code>/config</code>: 打开设置界面(Config 选项卡)</li>\n<li><code>/context</code>: 以彩色网格方式可视化当前上下文使用情况</li>\n<li><code>/cost</code>: 显示 token 使用统计</li>\n<li><code>/doctor</code>: <span style=\"color: rgba(255, 0, 0, 1);\">检查 Claude Code 安装健康状况</span></li>\n<li><code>/exit</code>: <span style=\"color: rgba(255, 0, 0, 1);\">退出 REPL</span></li>\n<li><code>/export [filename]</code>: 导出当前会话到文件或剪贴板</li>\n<li><code>/help</code>: 获取帮助列表和用法</li>\n<li><code>/hooks</code>: 管理与工具事件相关的 hook 配置</li>\n<li><code>/ide</code>: 管理 IDE 集成并显示状态</li>\n<li><code>/init</code>: <span style=\"color: rgba(255, 0, 0, 1);\">用 <code>CLAUDE.md</code> 指南初始化项目（解析项目，为项目生成或更新文档CLAUDE.md）</span></li>\n<li><code>/install-github-app</code>: 为仓库设置 Claude GitHub Actions</li>\n<li><code>/login</code>、<code>/logout</code>: 切换或退出 Anthropic 账户</li>\n<li><code>/mcp</code>: 管理 MCP 服务器连接和 OAuth 授权</li>\n<li><code>/memory</code>: 编辑 CLAUDE.md 的记忆文件</li>\n<li><code>/model</code>: 选择或切换 AI 模型</li>\n<li><code>/output-style [style]</code>: 设置输出风格</li>\n<li><code>/permissions</code>: 查看或更新权限规则</li>\n<li><code>/plugin</code>: 管理 Claude Code 插件</li>\n<li><code>/pr-comments</code>: 查看 PR 评论</li>\n<li><code>/privacy-settings</code>: 查看/更新隐私设置</li>\n<li><code>/release-notes</code>: 查看发布说明</li>\n<li><code>/resume</code>: 恢复会话</li>\n<li><code>/review</code>: 请求代码审查</li>\n<li><code>/rewind</code>: 回退会话或代码状态</li>\n<li><code>/sandbox</code>: 启用受限的 sandboxed bash(文件系统与网络隔离)</li>\n<li><code>/security-review</code>: 对当前分支的待定更改执行安全审查</li>\n<li><code>/status</code>: 打开状态界面(显示版本、模型、账户和连通性)</li>\n<li><code>/statusline</code>: 设置状态行 UI</li>\n<li><code>/terminal-setup</code>: 为 iTerm2 / VSCode 安装 Shift+Enter 换行快捷键</li>\n<li><code>/todos</code>: 列出当前 todo 项</li>\n<li><code>/usage</code>: 显示订阅计划使用限额和速率限制状态</li>\n<li><code>/vim</code>: 进入 vim 模式(交替插入/命令模式)</li>\n</ul>\n<h1 id=\"g-faq-for-claude-code\">G FAQ for Claude Code</h1>\n<h2 id=\"q-基于claude命令启动时报不支持的国家地区-claude-code-might-not-be-available-in-your-country-check-supported-countries-\">Q: 基于<code>claude</code>命令启动时报不支持的国家/地区: <code>Claude Code might not be available in your country. Check supported countries ...</code></h2>\n<ul>\n<li>问题描述</li>\n</ul>\n<blockquote>\n<p>基于<code>claude</code>命令启动时，报不支持的国家/地区: <code>Claude Code might not be available in your country. Check supported countries ...</code></p>\n</blockquote>\n<pre><code class=\"language-cmd\">C:\\Users\\Johnny&gt; claude\nUnable to connect to Anthropic services  \nFailed to connect to api.anthropic.com: ERR_BAD_REQUEST  \nPlease check your internet connection and network settings.  \nNote: Claude Code might not be available in your country. Check supported countries at https://anthropic.com/supported-countri\n</code></pre>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260130225134679-420024729.png\" /></p>\n<pre><code class=\"language-log\">Welcome to Claude Code v2.1.20\n…………………………………………………………………………………………………………………………………………………………                                                                        \n\n     *                                       █████▓▓░\n                                 *         ███▓░     ░░\n            ░░░░░░                        ███▓░\n    ░░░   ░░░░░░░░░░                      ███▓░\n   ░░░░░░░░░░░░░░░░░░░    *                ██▓░░      ▓\n                                             ░▓▓███▓▓░\n *                                 ░░░░\n                                 ░░░░░░░░\n                               ░░░░░░░░░░░░░░░░\n       █████████                                        *\n      ██▄█████▄██                        *\n       █████████      *\n…………………█ █   █ █………………………………………………………………………………………………………………                                                                                 \n\n Unable to connect to Anthropic services\n\n Failed to connect to api.anthropic.com: ERR_BAD_REQUEST\n\n Please check your internet connection and network settings.\n\n Note: Claude Code might not be available in your country. Check supported countries at https://anthropic.com/supported-countries\n</code></pre>\n<ul>\n<li>原因分析</li>\n</ul>\n<blockquote>\n<p>国内第一次使用claude code的新手，都遇到过这样的报错。而成为了使用claude code的第一道门槛</p>\n</blockquote>\n<blockquote>\n<p>想要解决其实十分简单，只需要在 claude code 配置文件加上一行配置即可绕过地区限制（即修改 <code>~/.claude.json</code> 文件），下面开始教你如何配置。</p>\n</blockquote>\n<ul>\n<li>解决方法</li>\n</ul>\n<blockquote>\n<ol>\n<li>首先你要知道你的用户主目录 ，即\"C:\\Users\\你的用户名\"，配置文件默认会在这个目录下，然后找到<code>.claude.json</code>文件。</li>\n</ol>\n</blockquote>\n<pre><code class=\"language-powershell\">//powershell | git-bash\nvim ~/.claude.json\n</code></pre>\n<blockquote>\n<ol start=\"2\">\n<li>打开<code>.claude.json</code>文件，可使用vscode、notepad++、记事本等文本编辑器，打开后会出现类似的配置样式，加上选中区域的字段。</li>\n</ol>\n<blockquote>\n<p>别忘了给上一行加个<code>,</code>逗号</p>\n</blockquote>\n</blockquote>\n<pre><code class=\"language-shell\">\"hasCompletedOnboarding\": true\n</code></pre>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260130234953210-255466997.png\" /></p>\n<blockquote>\n<ol start=\"3\">\n<li>重启 ClaudeCode，大功告成！</li>\n</ol>\n</blockquote>\n<pre><code class=\"language-shell\">claude\n</code></pre>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1173617/202601/1173617-20260130235245646-1795744864.png\" /></p>\n<blockquote>\n<p>输入<code>1</code> 即进入 Claude Code；反之，输入<code>2</code> 或 <code>Esc</code> 即退出 Claude 并会退到命令行窗口</p>\n</blockquote>\n<h2 id=\"q-基于windows的powershell运行claude命令时报npm--无法加载文件-dnodejsclaudeps1因为在此系统上禁止运行脚本\">Q: 基于Windows的<code>PowerShell</code>运行<code>claude</code>命令时，报：<code>npm : 无法加载文件 D:\\...\\nodejs\\claude.ps1，因为在此系统上禁止运行脚本。...</code></h2>\n<ul>\n<li>问题描述</li>\n</ul>\n<pre><code>Windows PowerShell\n版权所有 (C) Microsoft Corporation。保留所有权利。\n\n尝试新的跨平台 PowerShell https://aka.ms/pscore6\n\nPS C:\\Users\\Xxx\\Desktop\\55156966&gt; claude\nclaude : 无法加载文件 D:\\Program_Files\\nodejs\\node-v20.11.1-win-x64\\claude.ps1，因为在此系统上禁止运行脚本。有关详细信息，请参阅 https:/go.microsoft.com/fwlink/?LinkID=135170 中的 about_Execution_Policies。\n所在位置 行:1 字符: 1\n+ claude\n+ ~~~~~~\n    + CategoryInfo          : SecurityError: (:) []，PSSecurityException\n    + FullyQualifiedErrorId : UnauthorizedAccess\n</code></pre>\n<ul>\n<li>解决方法</li>\n</ul>\n<blockquote>\n<ul>\n<li>在终端输入<code>get-ExecutionPolicy</code>查看执行策略/权限；</li>\n</ul>\n</blockquote>\n<pre><code class=\"language-shell\">PS C:\\Users\\Xxx\\Desktop\\55156966&gt; get-ExecutionPolicy\nRestricted\n</code></pre>\n<blockquote>\n<blockquote>\n<p>输出<code>Restricted</code>(受限制的)；</p>\n</blockquote>\n<ul>\n<li>终端输入<code>Set-ExecutionPolicy -Scope CurrentUser</code>命令给用户赋予权限；</li>\n<li>输入<code>RemoteSigned</code>；</li>\n</ul>\n</blockquote>\n<pre><code class=\"language-shell\">PS C:\\Users\\Xxx\\Desktop\\55156966&gt; Set-ExecutionPolicy -Scope CurrentUser\n位于命令管道位置 1 的 cmdlet Set-ExecutionPolicy\n请为以下参数提供值:\nExecutionPolicy: RemoteSigned\n\n执行策略更改\n执行策略可帮助你防止执行不信任的脚本。更改执行策略可能会产生安全风险，如 https:/go.microsoft.com/fwlink/?LinkID=135170 中的 about_Execution_Policies 帮助主题所述。是否要更改执行策略?\n[Y] 是(Y)  [A] 全是(A)  [N] 否(N)  [L] 全否(L)  [S] 暂停(S)  [?] 帮助 (默认值为“N”): Y\n</code></pre>\n<blockquote>\n<ul>\n<li>终端输入<code>get-ExecutionPolicy</code>查看一下权限，显示<code>RemoteSigned</code>就可以了。</li>\n</ul>\n</blockquote>\n<pre><code class=\"language-shell\">PS C:\\Users\\Johnny\\Desktop\\55156966&gt; get-ExecutionPolicy\nRemoteSigned\n</code></pre>\n<h2 id=\"q-基于-git-bash-安装-claude-code-需配置claude_code_git_bash_path环境变量\">Q: 基于 Git-Bash 安装 Claude Code 需配置<code>CLAUDE_CODE_GIT_BASH_PATH</code>环境变量?</h2>\n<blockquote>\n<p>此问题可忽略，没有多少意义</p>\n</blockquote>\n<blockquote>\n<p>Claude Code on Windows requires git-bash (<a href=\"https://git-scm.com/downloads/win\" rel=\"noopener nofollow\" target=\"_blank\">https://git-scm.com/downloads/win</a>). If installed but not in PATH, set environment variable pointing to your bash.exe, similar to: CLAUDE_CODE_GIT_BASH_PATH=C:\\Program Files\\Git\\bin\\bash.exe</p>\n</blockquote>\n<pre><code class=\"language-shell\">$ claude\nCLAUDE_CODE_GIT_BASH_PATH=D:\\Program Files(x86)\\Git\\Git\\bin\\bash.exe\n</code></pre>\n<ul>\n<li>Windows Git-Bash</li>\n</ul>\n<blockquote>\n<p>如果后续需通过 Git-Bash 来启动/使用 Cluade Code，则需： 设置环境变量 <code>CLAUDE_CODE_GIT_BASH_PATH</code> 为 bash.exe 的路径。（可选）</p>\n</blockquote>\n<h2 id=\"q-为什么必须走推荐用-大模型-api-集成的方式\">Q: 为什么必须走/推荐用 大模型 API 集成的方式？</h2>\n<ul>\n<li>上下文感知：它能直接读取你的整个项目结构，不再需要你手动上传文件。</li>\n<li>自主编辑（Agentic）：配合 Cline 等插件，它不仅能写代码，还能直接运行终端、创建文件、修复 Bug，甚至根据报错自我修正。</li>\n<li>隐私与成本：API 按 Token 计费，比订阅制更灵活，且数据隐私性通常优于网页免费版。</li>\n</ul>\n<h1 id=\"y-推荐文献\">Y 推荐文献</h1>\n<ul>\n<li>Claude Code</li>\n</ul>\n<blockquote>\n<ul>\n<li><a href=\"https://code.claude.com/docs/zh-CN/settings\" rel=\"noopener nofollow\" target=\"_blank\">Claude Code 设置 - Claude Code</a></li>\n<li><a href=\"https://code.claude.com/docs/zh-CN/overview#native-install-recommended\" rel=\"noopener nofollow\" target=\"_blank\">https://code.claude.com/docs/zh-CN/overview#native-install-recommended</a></li>\n</ul>\n</blockquote>\n<ul>\n<li>CC-Switch</li>\n</ul>\n<blockquote>\n<blockquote>\n<p>专为多环境 Claude 用户打造的配置管理工具，支持一键在不同的 API Key 或供应商之间快速切换，告别频繁手动修改配置文件的繁琐。</p>\n</blockquote>\n<ul>\n<li><a href=\"https://github.com/farion1231/cc-switch/releases/tag/v3.10.3\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/farion1231/cc-switch/releases/tag/v3.10.3</a></li>\n</ul>\n</blockquote>\n<ul>\n<li>claude-auto-resume</li>\n</ul>\n<blockquote>\n<blockquote>\n<p>专为长耗时任务设计的守护脚本，能够自动检测并恢复因网络波动或超时而中断的 Claude 对话，实现真正的 “无人值守” 式编程。</p>\n</blockquote>\n<ul>\n<li><a href=\"https://github.com/terryso/claude-auto-resume/tree/develop\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/terryso/claude-auto-resume/tree/develop</a></li>\n</ul>\n</blockquote>\n<ul>\n<li>BMAD-METHOD</li>\n</ul>\n<blockquote>\n<blockquote>\n<p>BMAD 是一个全流程的 AI 敏捷开发 解决方案，它集结了 12 位虚拟专家组成智能团队，通过自适应的结构化工作流，引导你完成从构思到部署的专家级交付。</p>\n</blockquote>\n<ul>\n<li>官方仓库 <a href=\"https://github.com/bmad-code-org/BMAD-METHOD\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/bmad-code-org/BMAD-METHOD</a></li>\n</ul>\n<blockquote>\n<p>更多关于 BMAD 的内容，有网友专门写了一篇文章 <a href=\"https://itho.cn/vibecoding/573.html\" rel=\"noopener nofollow\" target=\"_blank\">https://itho.cn/vibecoding/573.html</a></p>\n</blockquote>\n</blockquote>\n<ul>\n<li>ralph-claude-code</li>\n</ul>\n<blockquote>\n<blockquote>\n<p>自动重复叫 Claude Code 干活的工具，直到活干完或出问题为止。</p>\n</blockquote>\n<ul>\n<li><a href=\"https://github.com/frankbria/ralph-claude-code\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/frankbria/ralph-claude-code</a></li>\n</ul>\n</blockquote>\n<ul>\n<li>skillsmp</li>\n</ul>\n<blockquote>\n<p>一个收集查找 claude skill 的站<br />\n<a href=\"https://skillsmp.com/\" rel=\"noopener nofollow\" target=\"_blank\">https://skillsmp.com/</a></p>\n</blockquote>\n<ul>\n<li>lmarena</li>\n</ul>\n<blockquote>\n<p>查看各类模型排名<br />\n<a href=\"https://lmarena.ai/zh/leaderboard\" rel=\"noopener nofollow\" target=\"_blank\">https://lmarena.ai/zh/leaderboard</a></p>\n</blockquote>\n<ul>\n<li>第三方模型</li>\n</ul>\n<blockquote>\n<ul>\n<li>智谱AI : <a href=\"https://open.bigmodel.cn/\" rel=\"noopener nofollow\" target=\"_blank\">https://open.bigmodel.cn/</a></li>\n</ul>\n<blockquote>\n<p><code>export ANTHROPIC_BASE_URL=https://open.bigmodel.cn/api/anthropic</code></p>\n</blockquote>\n<ul>\n<li>硅基流动 : <a href=\"https://cloud.siliconflow.cn/\" rel=\"noopener nofollow\" target=\"_blank\">https://cloud.siliconflow.cn/</a></li>\n</ul>\n<blockquote>\n<p><code>export ANTHROPIC_BASE_URL=https://api.siliconflow.cn/</code></p>\n</blockquote>\n</blockquote>\n<ul>\n<li>第三方文档</li>\n</ul>\n<blockquote>\n<ul>\n<li><a href=\"https://blog.techfetch.dev/blog/2025/09/17/claude-code-third-party-vendor-usage-guide-in-depth-analysis-best-practices/\" rel=\"noopener nofollow\" target=\"_blank\">https://blog.techfetch.dev/blog/2025/09/17/claude-code-third-party-vendor-usage-guide-in-depth-analysis-best-practices/</a></li>\n<li><a href=\"https://www.kevnu.com/zh/posts/claude-code-usage-guide-from-official-configuration-to-integrating-third-party-models\" rel=\"noopener nofollow\" target=\"_blank\">Claude Code 使用指南：从官方配置到接入第三方模型 - kevnu.com</a> 【推荐/参考】//todo</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><a href=\"https://github.com/SericWong/claude-mirror\" rel=\"noopener nofollow\" target=\"_blank\">Claude 中文版使用指南：2025年最先进的 Claude 4.5 模型 - Github</a> 2026-01-26</li>\n<li><a href=\"https://www.runoob.com/claude-code/claude-code-tutorial.html\" rel=\"noopener nofollow\" target=\"_blank\">Claude Code 教程 - 菜鸟教程</a> //todo</li>\n<li><a href=\"https://www.cursor-ide.com/blog/claude-code-api-key\" rel=\"noopener nofollow\" target=\"_blank\">Claude Code API密钥完全指南：配置、获取与最佳实践（2025版） - cursor-ide.com</a></li>\n</ul>\n</blockquote>\n<ul>\n<li>Claude 第三方镜像站</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>对比维度</th>\n<th>Claude 官方 (Anthropic)</th>\n<th>Claude中文版 (Claude镜像站)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>访问门槛</td>\n<td>极高（需专用网络环境）</td>\n<td>零门槛（国内直连，即点即用）</td>\n</tr>\n<tr>\n<td>账号风险</td>\n<td>高（IP变动极易封号）</td>\n<td>无风险（微信/邮箱注册，稳定不封）</td>\n</tr>\n<tr>\n<td>中文能力</td>\n<td>优秀，但偶有翻译腔</td>\n<td>卓越（针对中文语境特定优化）</td>\n</tr>\n<tr>\n<td>模型权限</td>\n<td>免费版限制多，升级困难</td>\n<td>全模型解锁（含 Claude 4/3.5 全系列）</td>\n</tr>\n<tr>\n<td>功能扩展</td>\n<td>单一聊天窗口</td>\n<td>集成写作、PPT生成、数据分析等工具</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<ul>\n<li><a href=\"https://www.claude-chinese.com/claude/claude-china-access-guide-2025.html\" rel=\"noopener nofollow\" target=\"_blank\">Claude 国内使用完整指南：3个稳定镜像站推荐（2025最新） - claude-chinese.com</a></li>\n</ul>\n<blockquote>\n<p>如何选择适合你的镜像站？</p>\n</blockquote>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>XSimpleChat</th>\n<th>蓝鲸 AI</th>\n<th>GPTokk</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>稳定性</td>\n<td>⭐⭐⭐⭐⭐</td>\n<td>⭐⭐⭐⭐</td>\n<td>⭐⭐⭐⭐⭐</td>\n</tr>\n<tr>\n<td>响应速度</td>\n<td>极快</td>\n<td>快</td>\n<td>快</td>\n</tr>\n<tr>\n<td>界面体验</td>\n<td>优秀</td>\n<td>优秀</td>\n<td>良好</td>\n</tr>\n<tr>\n<td>中文优化</td>\n<td>良好</td>\n<td>优秀</td>\n<td>良好</td>\n</tr>\n<tr>\n<td>多模型支持</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>API 支持</td>\n<td>是</td>\n<td>否</td>\n<td>是</td>\n</tr>\n<tr>\n<td>团队功能</td>\n<td>是</td>\n<td>否</td>\n<td>是</td>\n</tr>\n<tr>\n<td>免费试用</td>\n<td>有</td>\n<td>有</td>\n<td>有</td>\n</tr>\n<tr>\n<td>价格</td>\n<td>中等</td>\n<td>实惠</td>\n<td>中等</td>\n</tr>\n<tr>\n<td>推荐指数</td>\n<td>⭐⭐⭐⭐⭐</td>\n<td>⭐⭐⭐⭐</td>\n<td>⭐⭐⭐⭐</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"x-参考文献\">X 参考文献</h1>\n<ul>\n<li>\n<p><a href=\"https://zhuanlan.zhihu.com/p/1941542481687746378\" rel=\"noopener nofollow\" target=\"_blank\">Claude Code 支持原生 Windows 免WSL安装教程，附踩坑经历 - Zhihu</a> 【推荐】</p>\n</li>\n<li>\n<p><a href=\"https://blog.csdn.net/u010953692/article/details/155396404\" rel=\"noopener nofollow\" target=\"_blank\">Visual Studio Code 中使用 Claude Code - CSDN</a> 【推荐】 2025.11.29</p>\n</li>\n<li>\n<p><a href=\"https://juejin.cn/post/7571830282849124403\" rel=\"noopener nofollow\" target=\"_blank\">Claude Code VSCode 插件完整安装使用教程 - 掘金</a> 【推荐】 2025.11.13</p>\n</li>\n<li>\n<p><a href=\"https://github.com/vadimdemedes/ink/#israwmodesupported\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/vadimdemedes/ink/#israwmodesupported</a></p>\n</li>\n<li>\n<p><a href=\"https://docs.siliconflow.cn/cn/usercases/use-siliconcloud-in-ClaudeCode\" rel=\"noopener nofollow\" target=\"_blank\">开发工具&amp;平台：Claude Code - 硅基流动</a> 2025.11.17</p>\n</li>\n</ul>\n<blockquote>\n<ul>\n<li>本文档安装方式仅适用于 Mac 及 Linux用户</li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/1944899556862059697\" rel=\"noopener nofollow\" target=\"_blank\">Claude Code &amp; 硅基流动，老金突然使用自由了！ - Zhihu</a></li>\n</ul>\n</blockquote>\n<pre><code class=\"language-shell\">export ANTHROPIC_BASE_URL=\"https://api.siliconflow.cn/\"\nexport ANTHROPIC_MODEL=\"moonshotai/Kimi-K2-Instruct-0905\"    # 可以自行修改所需模型\nexport ANTHROPIC_API_KEY=\"YOUR_SiliconFlow_API_KEY\"    # 请替换 API Key\n</code></pre>\n<blockquote>\n<p>目前 Claude Code 并不支持添加多个自定义模型（Custom Model），可手动配置/选择并更新 <code>ANTHROPIC_MODEL</code> 环境变量的方式切换模型</p>\n</blockquote>\n<ul>\n<li><a href=\"https://www.cnblogs.com/towerbit/p/19166639\" target=\"_blank\">解决 Windows 下 Claude 通过 cmd/powershell 运行出错失去响应的问题 - 博客园</a></li>\n</ul>\n<blockquote>\n<p>Windows 下在终端中运行 Claude，如果尝试让它在磁盘中查找文件，很容易因为缺少 cgypath 导致 Claude 进程出错</p>\n</blockquote>\n<ul>\n<li></li>\n<li><a href=\"https://blog.csdn.net/pro_fan/article/details/120457551\" rel=\"noopener nofollow\" target=\"_blank\">npm : 无法加载文件 D:...\\nodejs\\npm.ps1，因为在此系统上禁止运行脚本 - CSDN</a></li>\n</ul>\n<blockquote>\n<p>在VSCode终端使用npm命令时，出现报错信息</p>\n</blockquote>\n<ul>\n<li><a href=\"https://www.cnblogs.com/whatai/p/19108865\" target=\"_blank\">【2025最新教程】Claude Code国内使用_保姆级新手安装使用教程_最强AI编程工具 - 博客园</a> //todo</li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/1961104214651572278\" rel=\"noopener nofollow\" target=\"_blank\">免登录！免安装ClI，Claude Code插件接入API使用教程 - Zhihu</a> //todo</li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/1944899556862059697\" rel=\"noopener nofollow\" target=\"_blank\">Claude Code &amp; 硅基流动，老金突然使用自由了！ - Zhihu</a> 【参考】</li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/1941542481687746378\" rel=\"noopener nofollow\" target=\"_blank\">Claude Code 支持原生 Windows 免WSL安装教程，附踩坑经历 - Zhihu</a> //todo</li>\n<li><a href=\"https://www.bilibili.com/video/BV1KDnmzjEyC\" rel=\"noopener nofollow\" target=\"_blank\">如何正确使用Claude Code官方vscode插件，告别命令行 - Bilibili</a> //todo</li>\n<li><a href=\"https://www.bilibili.com/video/BV1RB8XzwE7e\" rel=\"noopener nofollow\" target=\"_blank\">vscode + claude code = 打造自己的专属AI IDE - Bilibili</a> //todo</li>\n<li><a href=\"https://blog.csdn.net/weixin_57253447/article/details/155828268\" rel=\"noopener nofollow\" target=\"_blank\">（25年12月）claude code报错：might not be available in your country - CSDN</a></li>\n</ul>\n<pre><code class=\"language-json\">find ~ -name \"*claude*\" -type f -name \"*.json\" 2&gt;/dev/null\n\nvi ~/.claude.json\n    \"hasCompletedOnboarding\": true,  // 这是你新增的行，末尾要加逗号\n</code></pre>\n<ul>\n<li>\n<p><a href=\"https://www.bilibili.com/video/BV14rzQB9EJj/\" rel=\"noopener nofollow\" target=\"_blank\">Claude Code 从 0 到 1 全攻略：MCP / SubAgent / Agent Skill / Hook / 图片 / 上下文处理/ 后台任务 - Bilibili</a> //todo</p>\n</li>\n<li>\n<p><a href=\"https://blog.csdn.net/xiaobainewa/article/details/156946373\" rel=\"noopener nofollow\" target=\"_blank\">vscode中claude插件接入硅基流动api - CSDN</a> 【参考/推荐】 2026.1.14</p>\n</li>\n<li>\n<p><a href=\"https://www.cnblogs.com/Comets9224/p/19535975\" target=\"_blank\">Claude Code Windows 安装与配置全流程：国内可用（硅基流动/DeepSeek）避坑指南 - 博客园</a> 【推荐】</p>\n</li>\n</ul>\n<blockquote>\n<p>有一些教程里，教你在<code>~/.claude/config.json</code>中添加<code>primaryApiKey</code>配置项，我的教程里没有用到<code>config.json</code>这文件，通常出现在一些\"<strong>非官方/第三方/旧版本</strong>\"的<strong>绕路教程</strong>里，目的是<strong>让客户端/插件在没有完成登录流程时先\"有个东西可写\"</strong>，避免一直卡在引导或报\"<code>缺 key</code>\"的分支判断。<strong>填什么都行</strong>，本质上说明：<strong>它并不是一个真实可用的 API Key</strong>，而更像是某些实现里的【占位字段】。我们已经通过<code>setting.json</code>的env配置，就不需要这个文件。</p>\n</blockquote>\n<pre><code class=\"language-shell\">\"ANTHROPIC_AUTH_TOKEN\": \"你自己的APIKEY\",\n\"ANTHROPIC_BASE_URL\": \"https://api.siliconflow.cn/\",\n\"API_TIMEOUT_MS\": \"3000000\",\n\"ANTHROPIC_DEFAULT_SONNET_MODEL\": \"deepseek-ai/DeepSeek-V3.2\",\n\"ANTHROPIC_DEFAULT_OPUS_MODEL\": \"Pro/deepseek-ai/DeepSeek-R1\",\n\"ANTHROPIC_DEFAULT_HAIKU_MODEL\": \"Pro/zai-org/GLM-4.7\"\n</code></pre>\n<ul>\n<li><a href=\"https://itho.cn/vibecoding/570.html\" rel=\"noopener nofollow\" target=\"_blank\">VibeCoding 实战：Claude Code + GLM4.7 全能手册 - itho.cn</a> 【推荐】</li>\n</ul>\n<blockquote>\n<blockquote>\n<p>CC-Switch / ...</p>\n</blockquote>\n</blockquote>\n\n\n</div>\n<div id=\"MySignature\">\n    <div class=\"essaySuffix-box\">\n    <div class=\"essaySuffix-box-left\" style=\"margin: 6px auto;\">\n        <img alt=\"QQ沟通交流群\" src=\"https://blog-static.cnblogs.com/files/johnnyzen/cnblogs-qq-group-qrcode.gif?t=1679679148\" />\n    </div>\n<div class=\"essaySuffix-box-right\">\n    <span class=\"essaySuffix-right-title\">本文作者</span>：\n        <strong><span><a href=\"https://github.com/Johnny-ZTSD\" target=\"_blank\">千千寰宇</a></span></strong>\n    <br />\n    <span style=\"font-weight: bold; white-space: nowrap;\">本文链接</span>：\n        <a href=\"https://www.cnblogs.com/johnnyzen\" id=\"articleLinkElement\" target=\"_blank\"> https://www.cnblogs.com/johnnyzen</a>\n    <br />\n    <span class=\"essaySuffix-right-title\">关于博文</span>：评论和私信会在第一时间回复，或<a href=\"https://msg.cnblogs.com/msg/send/johnnyzen\" target=\"_blank\">直接私信</a>我。\n    <br />\n    <span class=\"essaySuffix-right-title\">版权声明</span>：本博客所有文章除特别声明外，均采用 <a alt=\"BY-NC-SA\" href=\"http://blog.sina.com.cn/s/blog_896327b90102y6c6.html\" target=\"_blank\" title=\"https://creativecommons.org/licenses/by-nc-nd/4.0/\">BY-NC-SA</a> \n    许可协议。转载请注明出处！<br />\n    <span class=\"essaySuffix-right-title\">日常交流</span>：大数据与软件开发-QQ交流群: 774386015<strong>\n        <span style=\"color: #ff0000; font-size: 12pt;\">【<a href=\"\" id=\"post-up\">入群二维码</a>】</span></strong>参见左下角。您的支持、鼓励<span style=\"color: #ff0000; font-size: 12pt;\"></span>是博主技术写作的重要动力！\n    <br />\n</div>\n<div style=\"clear: both;\">\n</div>\n</div>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-02-01 00:57</span>&nbsp;\n<a href=\"https://www.cnblogs.com/johnnyzen\">千千寰宇</a>&nbsp;\n阅读(<span id=\"post_view_count\">59</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "完善基于WPF开发的标尺控件（含实例代码）",
      "link": "https://www.cnblogs.com/wuty/p/19559302",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/wuty/p/19559302\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 22:35\">\n    <span>完善基于WPF开发的标尺控件（含实例代码）</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<h2>前言：</h2>\n<p>在2021年的时候，有个拖拽的项目用到了标尺的控件，我写了一篇大概实现代码的博客：<a href=\"https://www.cnblogs.com/wuty/p/15580195.html\">仿Word的支持横轴竖轴的WPF 标尺 - wuty007 - 博客园</a>。在里边的实例代码里边，鼠标横纵坐标移动显示的代码没有完善。直到上个月有个水友发信息找我要源码。趁着这段时间正在使用AI编程，于是让AI帮我补充一下代码了</p>\n<p><img alt=\"image\" height=\"249\" src=\"https://img2024.cnblogs.com/blog/1063618/202601/1063618-20260131221035351-1118901133.png\" width=\"888\" /></p>\n<h2>代码完善：&nbsp;</h2>\n<p>1、本次使用的是腾讯Codebuddy的AI编程插件，文件结构如下：</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1063618/202601/1063618-20260131221521902-1205357599.png\" /></p>\n<p>&nbsp;</p>\n<p>2、2021年开发的标尺核心的代码：</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Collections.Generic;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Diagnostics;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Globalization;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Linq;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Text;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Threading.Tasks;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Controls;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Input;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Media.Media3D;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Media;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Shapes;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows;\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">namespace</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDemo\n{\n    [TemplatePart(Name </span>= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">verticalTrackLine</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, Type = <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(Line))]\n    [TemplatePart(Name </span>= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">horizontalTrackLine</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, Type = <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(Line))]\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">internal</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerControl : Control\n    {\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">readonly</span> DependencyProperty DpiProperty = DependencyProperty.Register(nameof(Dpi), <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(Dpi), <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(RulerControl));\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">readonly</span> DependencyProperty DisplayPercentProperty = DependencyProperty.Register(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DisplayPercent</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(<span style=\"color: rgba(0, 0, 255, 1);\">double</span>), <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(RulerControl));\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">readonly</span> DependencyProperty DisplayTypeProperty = DependencyProperty.Register(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DisplayType</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(RulerDisplayType), <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(RulerControl));\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">readonly</span> DependencyProperty DisplayUnitProperty = DependencyProperty.Register(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">DisplayUnit</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(RulerDisplayUnit), <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(RulerControl));\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">static</span> <span style=\"color: rgba(0, 0, 255, 1);\">readonly</span> DependencyProperty ZeroPointProperty = DependencyProperty.Register(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">ZeroPoint</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(<span style=\"color: rgba(0, 0, 255, 1);\">double</span>), <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(RulerControl));\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 定义静态构造函数\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">static</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerControl()\n        {\n            DefaultStyleKeyProperty.OverrideMetadata(</span><span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(RulerControl), <span style=\"color: rgba(0, 0, 255, 1);\">new</span> FrameworkPropertyMetadata(<span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(RulerControl)));\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">#region</span> 属性\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 屏幕分辨率\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> Dpi Dpi\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span> =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> ((Dpi)GetValue(DpiProperty));\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">set</span> =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> SetValue(DpiProperty, value);\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 设置0点从哪里开始\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\"> ZeroPoint\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span> =&gt; ((<span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\">)GetValue(ZeroPointProperty));\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">\n            {\n                SetValue(ZeroPointProperty, value);\n                InvalidateVisual();\n            }\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 显示的比率（目前支持0-1的选项）\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\"> DisplayPercent\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span> =&gt; ((<span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\">)GetValue(DisplayPercentProperty));\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (value &gt; <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                {\n                    value </span>= <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                }\n                SetValue(DisplayPercentProperty, value);\n                InvalidateVisual();\n            }\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 显示的类型：枚举类（支持横向或者竖向）\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType DisplayType\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span> =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> ((RulerDisplayType)GetValue(DisplayTypeProperty));\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">set</span> =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> SetValue(DisplayTypeProperty, value);\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 显示的单位：cm和pixel\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayUnit DisplayUnit\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span> =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> ((RulerDisplayUnit)GetValue(DisplayUnitProperty));\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">set</span> =&gt;<span style=\"color: rgba(0, 0, 0, 1);\"> SetValue(DisplayUnitProperty, value);\n        }\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">#endregion</span>\n\n        <span style=\"color: rgba(0, 0, 255, 1);\">#region</span> 常量\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">const</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span> InchCm = <span style=\"color: rgba(128, 0, 128, 1);\">2.54</span>; <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">一英寸为2.54cm</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">const</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> P100StepSpanPixel = <span style=\"color: rgba(128, 0, 128, 1);\">100</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">const</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> P100StepSpanCm = <span style=\"color: rgba(128, 0, 128, 1);\">2</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">const</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> P100StepCountPixel = <span style=\"color: rgba(128, 0, 128, 1);\">20</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">const</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> P100StepCountCm = <span style=\"color: rgba(128, 0, 128, 1);\">20</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">#endregion</span>\n\n        <span style=\"color: rgba(0, 0, 255, 1);\">#region</span> 变量\n        <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\"> _minStepLengthCm;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\"> _maxStepLengthCm;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\"> _actualLength;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> _stepSpan;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> _stepCount;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">double</span><span style=\"color: rgba(0, 0, 0, 1);\"> _stepLength;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span><span style=\"color: rgba(0, 0, 0, 1);\"> Line _mouseVerticalTrackLine;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span><span style=\"color: rgba(0, 0, 0, 1);\"> Line _mouseHorizontalTrackLine;\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">#endregion</span>\n\n        <span style=\"color: rgba(0, 0, 255, 1);\">#region</span> 标尺边框加指针显示\n        <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> RaiseHorizontalRulerMoveEvent(MouseEventArgs e)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> mousePoint = e.GetPosition(<span style=\"color: rgba(0, 0, 255, 1);\">this</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            Debug.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">水平标尺 - 鼠标位置: X={mousePoint.X}, Y={mousePoint.Y}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (_mouseHorizontalTrackLine != <span style=\"color: rgba(0, 0, 255, 1);\">null</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 水平标尺：移动垂直跟踪线，X跟随鼠标</span>\n                _mouseHorizontalTrackLine.X1 = _mouseHorizontalTrackLine.X2 =<span style=\"color: rgba(0, 0, 0, 1);\"> mousePoint.X;\n                </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> Y坐标从0开始，延伸足够长</span>\n                _mouseHorizontalTrackLine.Y1 = <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                _mouseHorizontalTrackLine.Y2 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">5000</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                _mouseHorizontalTrackLine.Visibility </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> Visibility.Visible;\n\n                Debug.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">水平标尺 - 垂直线更新: X1={_mouseHorizontalTrackLine.X1}, Y1={_mouseHorizontalTrackLine.Y1}, X2={_mouseHorizontalTrackLine.X2}, Y2={_mouseHorizontalTrackLine.Y2}, Visibility={_mouseHorizontalTrackLine.Visibility}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            }\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> RaiseVerticalRulerMoveEvent(MouseEventArgs e)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> mousePoint = e.GetPosition(<span style=\"color: rgba(0, 0, 255, 1);\">this</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            Debug.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">垂直标尺 - 鼠标位置: X={mousePoint.X}, Y={mousePoint.Y}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (_mouseVerticalTrackLine != <span style=\"color: rgba(0, 0, 255, 1);\">null</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> 垂直标尺：移动水平跟踪线，Y跟随鼠标</span>\n                _mouseVerticalTrackLine.Y1 = _mouseVerticalTrackLine.Y2 =<span style=\"color: rgba(0, 0, 0, 1);\"> mousePoint.Y;\n                </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> X坐标从0开始，延伸足够长</span>\n                _mouseVerticalTrackLine.X1 = <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                _mouseVerticalTrackLine.X2 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">5000</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                _mouseVerticalTrackLine.Visibility </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> Visibility.Visible;\n\n                Debug.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">垂直标尺 - 水平线更新: X1={_mouseVerticalTrackLine.X1}, Y1={_mouseVerticalTrackLine.Y1}, X2={_mouseVerticalTrackLine.X2}, Y2={_mouseVerticalTrackLine.Y2}, Visibility={_mouseVerticalTrackLine.Visibility}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            }\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">override</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> OnApplyTemplate()\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">base</span><span style=\"color: rgba(0, 0, 0, 1);\">.OnApplyTemplate();\n            _mouseVerticalTrackLine </span>= GetTemplateChild(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">verticalTrackLine</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>) <span style=\"color: rgba(0, 0, 255, 1);\">as</span><span style=\"color: rgba(0, 0, 0, 1);\"> Line;\n            _mouseHorizontalTrackLine </span>= GetTemplateChild(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">horizontalTrackLine</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>) <span style=\"color: rgba(0, 0, 255, 1);\">as</span><span style=\"color: rgba(0, 0, 0, 1);\"> Line;\n           \n            Debug.WriteLine($</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">OnApplyTemplate调用: _mouseVerticalTrackLine={_mouseVerticalTrackLine != null}, _mouseHorizontalTrackLine={_mouseHorizontalTrackLine != null}</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        }\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">#endregion</span>\n\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 重画标尺数据\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"drawingContext\"&gt;&lt;/param&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">protected</span> <span style=\"color: rgba(0, 0, 255, 1);\">override</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> OnRender(DrawingContext drawingContext)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">try</span><span style=\"color: rgba(0, 0, 0, 1);\">\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> pen = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Pen(<span style=\"color: rgba(0, 0, 255, 1);\">new</span> SolidColorBrush(Colors.Black), <span style=\"color: rgba(128, 0, 128, 1);\">0.8d</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                pen.Freeze();\n                Initialize();\n                GetActualLength();\n                GetStep();\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">base</span><span style=\"color: rgba(0, 0, 0, 1);\">.OnRender(drawingContext);\n\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">this</span>.BorderBrush = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> SolidColorBrush(Colors.Black);\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">this</span>.BorderThickness = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Thickness(<span style=\"color: rgba(128, 0, 128, 1);\">0.1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">this</span>.Background = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> SolidColorBrush(Colors.White);\n\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">#region</span> try\n                <span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\"> double actualPx = this._actualLength / DisplayPercent;</span>\n                <span style=\"color: rgba(0, 0, 255, 1);\">var</span> currentPosition = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> Position\n                {\n                    CurrentStepIndex </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n                    Value </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                };\n\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayType)\n                {\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Horizontal:\n                        {\n                            </span><span style=\"color: rgba(0, 128, 0, 1);\">/*</span><span style=\"color: rgba(0, 128, 0, 1);\"> 绘制前半段 </span><span style=\"color: rgba(0, 128, 0, 1);\">*/</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                            DrawLine(drawingContext, ZeroPoint, currentPosition, pen, </span><span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                            </span><span style=\"color: rgba(0, 128, 0, 1);\">/*</span><span style=\"color: rgba(0, 128, 0, 1);\"> 绘制后半段 </span><span style=\"color: rgba(0, 128, 0, 1);\">*/</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                            DrawLine(drawingContext, ZeroPoint, currentPosition, pen, </span><span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Vertical:\n                        {\n                            </span><span style=\"color: rgba(0, 128, 0, 1);\">/*</span><span style=\"color: rgba(0, 128, 0, 1);\"> 绘制前半段 </span><span style=\"color: rgba(0, 128, 0, 1);\">*/</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                            DrawLine(drawingContext, ZeroPoint, currentPosition, pen, </span><span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                            </span><span style=\"color: rgba(0, 128, 0, 1);\">/*</span><span style=\"color: rgba(0, 128, 0, 1);\"> 绘制后半段 </span><span style=\"color: rgba(0, 128, 0, 1);\">*/</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                            DrawLine(drawingContext, ZeroPoint, currentPosition, pen, </span><span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">#endregion</span><span style=\"color: rgba(0, 0, 0, 1);\">\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">catch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Exception ex)\n            {\n                Console.WriteLine(ex.Message);\n            }\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span> DrawLine(DrawingContext drawingContext, <span style=\"color: rgba(0, 0, 255, 1);\">double</span> currentPoint, Position currentPosition, Pen pen, <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> type)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">while</span> (<span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> linePercent =<span style=\"color: rgba(0, 0, 0, 1);\"> 0d;\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                {\n\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> formattedText = GetFormattedText((currentPosition.Value / <span style=\"color: rgba(128, 0, 128, 1);\">10</span><span style=\"color: rgba(0, 0, 0, 1);\">).ToString());\n\n\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayType)\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Horizontal:\n                            {\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> point = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Point(currentPoint + formattedText.Width / <span style=\"color: rgba(128, 0, 128, 1);\">2</span>, formattedText.Height / <span style=\"color: rgba(128, 0, 128, 1);\">3</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (point.X &lt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                                drawingContext.DrawText(formattedText, point);\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                            }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Vertical:\n                            {\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> point = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Point(<span style=\"color: rgba(0, 0, 255, 1);\">this</span>.ActualWidth, currentPoint + formattedText.Height / <span style=\"color: rgba(128, 0, 128, 1);\">2</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> rotateTransform = <span style=\"color: rgba(0, 0, 255, 1);\">new</span> RotateTransform(<span style=\"color: rgba(128, 0, 128, 1);\">90</span><span style=\"color: rgba(0, 0, 0, 1);\">, point.X, point.Y);\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (point.Y &lt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                                drawingContext.PushTransform(rotateTransform);\n                                drawingContext.DrawText(formattedText, point);\n                                drawingContext.Pop();\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                            }\n                    }\n\n                    linePercent </span>= (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)LinePercent.P100;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (IsFinalNum(currentPosition.CurrentStepIndex, <span style=\"color: rgba(128, 0, 128, 1);\">3</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n                {\n                    linePercent </span>= (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)LinePercent.P30;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (IsFinalNum(currentPosition.CurrentStepIndex, <span style=\"color: rgba(128, 0, 128, 1);\">5</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n                {\n                    linePercent </span>= (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)LinePercent.P50;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (IsFinalNum(currentPosition.CurrentStepIndex, <span style=\"color: rgba(128, 0, 128, 1);\">7</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n                {\n                    linePercent </span>= (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)LinePercent.P30;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (IsFinalNum(currentPosition.CurrentStepIndex, <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">))\n                {\n                    linePercent </span>= (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)LinePercent.P70;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                {\n                    linePercent </span>= (<span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\">)LinePercent.P20;\n                }\n\n                linePercent </span>= linePercent * <span style=\"color: rgba(128, 0, 128, 1);\">0.01</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayType)\n                {\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Horizontal:\n                        {\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPoint &gt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                            {\n                                drawingContext.DrawLine(pen, </span><span style=\"color: rgba(0, 0, 255, 1);\">new</span> Point(currentPoint, <span style=\"color: rgba(128, 0, 128, 1);\">0</span>), <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Point(currentPoint, <span style=\"color: rgba(0, 0, 255, 1);\">this</span>.ActualHeight *<span style=\"color: rgba(0, 0, 0, 1);\"> linePercent));\n                            }\n\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (type == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                            {\n                                currentPoint </span>= currentPoint -<span style=\"color: rgba(0, 0, 0, 1);\"> _stepLength;\n                                currentPosition.CurrentStepIndex</span>--<span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex &lt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    currentPosition.CurrentStepIndex </span>= _stepCount - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                    currentPosition.Value </span>= GetNextStepValue(currentPosition.Value, _stepSpan, <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                }\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.Value % _stepSpan != <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        currentPosition.Value </span>= GetNextStepValue(currentPosition.Value, _stepSpan, <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                }\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPoint &lt;= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                            }\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                            {\n                                currentPoint </span>= currentPoint +<span style=\"color: rgba(0, 0, 0, 1);\"> _stepLength;\n                                currentPosition.CurrentStepIndex</span>++<span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex &gt;=<span style=\"color: rgba(0, 0, 0, 1);\"> _stepCount)\n                                {\n                                    currentPosition.CurrentStepIndex </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                    currentPosition.Value </span>= GetNextStepValue(currentPosition.Value, _stepSpan, <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                }\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPoint &gt;=<span style=\"color: rgba(0, 0, 0, 1);\"> _actualLength)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                            }\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                    </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Vertical:\n                        {\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPoint &gt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                            {\n                                drawingContext.DrawLine(pen, </span><span style=\"color: rgba(0, 0, 255, 1);\">new</span> Point(<span style=\"color: rgba(128, 0, 128, 1);\">0</span>, currentPoint), <span style=\"color: rgba(0, 0, 255, 1);\">new</span> Point(<span style=\"color: rgba(0, 0, 255, 1);\">this</span>.ActualWidth *<span style=\"color: rgba(0, 0, 0, 1);\"> linePercent, currentPoint));\n                            }\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (type == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                            {\n                                currentPoint </span>= currentPoint -<span style=\"color: rgba(0, 0, 0, 1);\"> _stepLength;\n                                currentPosition.CurrentStepIndex</span>--<span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex &lt; <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    currentPosition.CurrentStepIndex </span>= _stepCount - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                    currentPosition.Value </span>= GetNextStepValue(currentPosition.Value, _stepSpan, <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                }\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.Value % _stepSpan != <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        currentPosition.Value </span>= GetNextStepValue(currentPosition.Value, _stepSpan, <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                }\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPoint &lt;= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                            }\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                            {\n                                currentPoint </span>= currentPoint +<span style=\"color: rgba(0, 0, 0, 1);\"> _stepLength;\n                                currentPosition.CurrentStepIndex</span>++<span style=\"color: rgba(0, 0, 0, 1);\">;\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPosition.CurrentStepIndex &gt;=<span style=\"color: rgba(0, 0, 0, 1);\"> _stepCount)\n                                {\n                                    currentPosition.CurrentStepIndex </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                    currentPosition.Value </span>= GetNextStepValue(currentPosition.Value, _stepSpan, <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                }\n\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (currentPoint &gt;=<span style=\"color: rgba(0, 0, 0, 1);\"> _actualLength)\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                            }\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                }\n            }\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 获取下一个步长值\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"value\"&gt;</span><span style=\"color: rgba(0, 128, 0, 1);\">起始值</span><span style=\"color: rgba(128, 128, 128, 1);\">&lt;/param&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"times\"&gt;</span><span style=\"color: rgba(0, 128, 0, 1);\">跨度</span><span style=\"color: rgba(128, 128, 128, 1);\">&lt;/param&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;param name=\"type\"&gt;</span><span style=\"color: rgba(0, 128, 0, 1);\">半段类型，分为前半段、后半段</span><span style=\"color: rgba(128, 128, 128, 1);\">&lt;/param&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;returns&gt;&lt;/returns&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> GetNextStepValue(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> value, <span style=\"color: rgba(0, 0, 255, 1);\">int</span> times, <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> type)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (type == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">do</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                {\n                    value</span>--<span style=\"color: rgba(0, 0, 0, 1);\">;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">while</span> (value % times != <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">do</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                {\n                    value</span>++<span style=\"color: rgba(0, 0, 0, 1);\">;\n                }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">while</span> (value % times != <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> (value);\n        }\n\n        [Obsolete]\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> FormattedText GetFormattedText(<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\"> text)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> (<span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> FormattedText(text,\n                          </span><span style=\"color: rgba(0, 128, 0, 1);\">//</span><span style=\"color: rgba(0, 128, 0, 1);\">CultureInfo.GetCultureInfo(\"zh-cn\"),</span>\n                          CultureInfo.GetCultureInfo(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">en-us</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">),\n                          FlowDirection.LeftToRight,\n                          </span><span style=\"color: rgba(0, 0, 255, 1);\">new</span> Typeface(<span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">宋体</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">),\n                          </span><span style=\"color: rgba(128, 0, 128, 1);\">12</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n                          Brushes.Black));\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">bool</span> IsFinalNum(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> value, <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> finalNum)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> valueStr =<span style=\"color: rgba(0, 0, 0, 1);\"> value.ToString();\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (valueStr.Substring(valueStr.Length - <span style=\"color: rgba(128, 0, 128, 1);\">1</span>, <span style=\"color: rgba(128, 0, 128, 1);\">1</span>) ==<span style=\"color: rgba(0, 0, 0, 1);\"> finalNum.ToString())\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> (<span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> (<span style=\"color: rgba(0, 0, 255, 1);\">false</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 初始化获取屏幕的DPI\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> Initialize()\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> dpi = <span style=\"color: rgba(0, 0, 255, 1);\">new</span><span style=\"color: rgba(0, 0, 0, 1);\"> Dpi();\n            dpi.DpiX </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> Dpi.DpiX;\n            dpi.DpiY </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> Dpi.DpiY;\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (Dpi.DpiX == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                dpi.DpiX </span>= <span style=\"color: rgba(128, 0, 128, 1);\">96</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            }\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (Dpi.DpiY == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                dpi.DpiY </span>= <span style=\"color: rgba(128, 0, 128, 1);\">96</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            }\n\n            Dpi </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> dpi;\n            _minStepLengthCm </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0.1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            _maxStepLengthCm </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0.3</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (DisplayPercent == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                DisplayPercent </span>= <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayUnit)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayUnit.Pixel:\n                    {\n                        _stepSpan </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> P100StepSpanPixel;\n                        _stepCount </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> P100StepCountPixel;\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayUnit.Cm:\n                    {\n                        _stepSpan </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> P100StepSpanCm;\n                        _stepCount </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> P100StepCountCm;\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> width = <span style=\"color: rgba(128, 0, 128, 1);\">15</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayType)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Horizontal:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (<span style=\"color: rgba(0, 0, 255, 1);\">this</span>.ActualHeight == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                        {\n                            Height </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> width;\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Vertical:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (<span style=\"color: rgba(0, 0, 255, 1);\">this</span>.ActualWidth == <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                        {\n                            Width </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> width;\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n            }\n        }\n\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n        <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> 获取每一个数字间隔的跨度\n        </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> GetStep()\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayUnit)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayUnit.Pixel:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">while</span> (<span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                        {\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> stepSpanCm = _stepSpan / Convert.ToDouble(GetDpi()) * InchCm *<span style=\"color: rgba(0, 0, 0, 1);\"> DisplayPercent;\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> stepLengthCm = stepSpanCm /<span style=\"color: rgba(0, 0, 0, 1);\"> _stepCount;\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> type = <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> isOut = <span style=\"color: rgba(0, 0, 255, 1);\">false</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepLengthCm &gt;<span style=\"color: rgba(0, 0, 0, 1);\"> _maxStepLengthCm)\n                            {\n                                type </span>= <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                _stepCount </span>= GetNextStepCount(_stepCount, type, <span style=\"color: rgba(0, 0, 255, 1);\">ref</span><span style=\"color: rgba(0, 0, 0, 1);\"> isOut);\n                            }\n\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepLengthCm &lt;<span style=\"color: rgba(0, 0, 0, 1);\"> _minStepLengthCm)\n                            {\n                                type </span>= <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                _stepCount </span>= GetNextStepCount(_stepCount, type, <span style=\"color: rgba(0, 0, 255, 1);\">ref</span><span style=\"color: rgba(0, 0, 0, 1);\"> isOut);\n                            }\n\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepLengthCm &lt;= _maxStepLengthCm &amp;&amp; stepLengthCm &gt;=<span style=\"color: rgba(0, 0, 0, 1);\"> _minStepLengthCm)\n                            {\n                                _stepLength </span>= stepSpanCm / InchCm * Convert.ToDouble(GetDpi()) /<span style=\"color: rgba(0, 0, 0, 1);\"> _stepCount;\n                                </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                            }\n                            </span><span style=\"color: rgba(0, 128, 0, 1);\">/*</span><span style=\"color: rgba(0, 128, 0, 1);\"> 已超出或小于最大步进长度 </span><span style=\"color: rgba(0, 128, 0, 1);\">*/</span>\n                            <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (!isOut) <span style=\"color: rgba(0, 0, 255, 1);\">continue</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                            _stepSpan </span>=<span style=\"color: rgba(0, 0, 0, 1);\"> GetNextStepSpan(_stepSpan, type);\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n            }\n        }\n\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> GetNextStepCount(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> stepCount, <span style=\"color: rgba(0, 0, 255, 1);\">int</span> type, <span style=\"color: rgba(0, 0, 255, 1);\">ref</span> <span style=\"color: rgba(0, 0, 255, 1);\">bool</span><span style=\"color: rgba(0, 0, 0, 1);\"> isOut)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> result =<span style=\"color: rgba(0, 0, 0, 1);\"> stepCount;\n            isOut </span>= <span style=\"color: rgba(0, 0, 255, 1);\">false</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (type)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span> <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCount == <span style=\"color: rgba(128, 0, 128, 1);\">20</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                        {\n                            result </span>= <span style=\"color: rgba(128, 0, 128, 1);\">10</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                        {\n                            isOut </span>= <span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span> <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCount == <span style=\"color: rgba(128, 0, 128, 1);\">10</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                        {\n                            result </span>= <span style=\"color: rgba(128, 0, 128, 1);\">20</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span><span style=\"color: rgba(0, 0, 0, 1);\">\n                        {\n                            isOut </span>= <span style=\"color: rgba(0, 0, 255, 1);\">true</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                        }\n\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> result;\n        }\n\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span> GetNextStepSpan(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> stepSpan, <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> type)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> stepCountStr =<span style=\"color: rgba(0, 0, 0, 1);\"> stepSpan.ToString();\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> resultStr = <span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.Empty;\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayUnit)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayUnit.Pixel:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (type)\n                        {\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span> <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCountStr.IndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">5</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>) &gt; -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        resultStr </span>= GetNumberAndZeroNum(<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">, stepCountStr.Length);\n                                    }\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCountStr.IndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">2</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>) &gt; -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        resultStr </span>= GetNumberAndZeroNum(<span style=\"color: rgba(128, 0, 128, 1);\">5</span>, stepCountStr.Length - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCountStr.IndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">1</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>) &gt; -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        resultStr </span>= GetNumberAndZeroNum(<span style=\"color: rgba(128, 0, 128, 1);\">2</span>, stepCountStr.Length - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                            </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span> <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                                {\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCountStr.IndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">5</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>) &gt; -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        resultStr </span>= GetNumberAndZeroNum(<span style=\"color: rgba(128, 0, 128, 1);\">2</span>, stepCountStr.Length - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCountStr.IndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">2</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>) &gt; -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        resultStr </span>= GetNumberAndZeroNum(<span style=\"color: rgba(128, 0, 128, 1);\">1</span>, stepCountStr.Length - <span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">else</span> <span style=\"color: rgba(0, 0, 255, 1);\">if</span> (stepCountStr.IndexOf(<span style=\"color: rgba(128, 0, 0, 1);\">'</span><span style=\"color: rgba(128, 0, 0, 1);\">1</span><span style=\"color: rgba(128, 0, 0, 1);\">'</span>) &gt; -<span style=\"color: rgba(128, 0, 128, 1);\">1</span><span style=\"color: rgba(0, 0, 0, 1);\">)\n                                    {\n                                        resultStr </span>= GetNumberAndZeroNum(<span style=\"color: rgba(128, 0, 128, 1);\">5</span>, stepCountStr.Length - <span style=\"color: rgba(128, 0, 128, 1);\">2</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n                                    }\n                                    </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                                }\n                        }\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n            }\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (<span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.IsNullOrWhiteSpace(resultStr))\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span> <span style=\"color: rgba(128, 0, 128, 1);\">0</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            }\n\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">if</span> (<span style=\"color: rgba(0, 0, 255, 1);\">int</span>.TryParse(resultStr, <span style=\"color: rgba(0, 0, 255, 1);\">out</span> <span style=\"color: rgba(0, 0, 255, 1);\">var</span><span style=\"color: rgba(0, 0, 0, 1);\"> result))\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> result;\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> result;\n        }\n\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">string</span> GetNumberAndZeroNum(<span style=\"color: rgba(0, 0, 255, 1);\">int</span> num, <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> zeroNum)\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">var</span> result = <span style=\"color: rgba(0, 0, 255, 1);\">string</span><span style=\"color: rgba(0, 0, 0, 1);\">.Empty;\n            result </span>+=<span style=\"color: rgba(0, 0, 0, 1);\"> num;\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">for</span> (<span style=\"color: rgba(0, 0, 255, 1);\">var</span> i = <span style=\"color: rgba(128, 0, 128, 1);\">0</span>; i &lt; zeroNum; i++<span style=\"color: rgba(0, 0, 0, 1);\">)\n            {\n                result </span>+= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">0</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n            }\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> (result);\n        }\n\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> GetDpi()\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayType)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Horizontal:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Dpi.DpiX);\n                    }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Vertical:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Dpi.DpiY);\n                    }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">default</span><span style=\"color: rgba(0, 0, 0, 1);\">:\n                    {\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">return</span><span style=\"color: rgba(0, 0, 0, 1);\"> (Dpi.DpiX);\n                    }\n            }\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> GetActualLength()\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">switch</span><span style=\"color: rgba(0, 0, 0, 1);\"> (DisplayType)\n            {\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Horizontal:\n                    {\n                        _actualLength </span>= <span style=\"color: rgba(0, 0, 255, 1);\">this</span><span style=\"color: rgba(0, 0, 0, 1);\">.ActualWidth;\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n                </span><span style=\"color: rgba(0, 0, 255, 1);\">case</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType.Vertical:\n                    {\n                        _actualLength </span>= <span style=\"color: rgba(0, 0, 255, 1);\">this</span><span style=\"color: rgba(0, 0, 0, 1);\">.ActualHeight;\n                        </span><span style=\"color: rgba(0, 0, 255, 1);\">break</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n                    }\n            }\n        }\n    }\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">enum</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayType\n    {\n        Horizontal, Vertical\n    }\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">enum</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDisplayUnit\n    {\n        Pixel,\n        Cm\n    }\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">enum</span><span style=\"color: rgba(0, 0, 0, 1);\"> LinePercent\n    {\n        P20 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">20</span><span style=\"color: rgba(0, 0, 0, 1);\">,\n        P30 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">30</span><span style=\"color: rgba(0, 0, 0, 1);\">, \n        P50 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">50</span><span style=\"color: rgba(0, 0, 0, 1);\">, \n        P70 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">70</span><span style=\"color: rgba(0, 0, 0, 1);\">, \n        P100 </span>= <span style=\"color: rgba(128, 0, 128, 1);\">100</span><span style=\"color: rgba(0, 0, 0, 1);\">\n    }\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">struct</span><span style=\"color: rgba(0, 0, 0, 1);\"> Dpi\n    {\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> DpiX\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        }\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> DpiY\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        }\n    }\n\n    </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">struct</span><span style=\"color: rgba(0, 0, 0, 1);\"> Position\n    {\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> Value\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        }\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">int</span><span style=\"color: rgba(0, 0, 0, 1);\"> CurrentStepIndex\n        {\n            </span><span style=\"color: rgba(0, 0, 255, 1);\">get</span>; <span style=\"color: rgba(0, 0, 255, 1);\">set</span><span style=\"color: rgba(0, 0, 0, 1);\">;\n        }\n    }\n}</span></pre>\n</div>\n<p>3、在原来的代码中，增加对横纵坐标的定义和补充</p>\n<div class=\"cnblogs_code\">\n<pre> [TemplatePart(Name = <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">verticalTrackLine</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, Type = <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span><span style=\"color: rgba(0, 0, 0, 1);\">(Line))]\n [TemplatePart(Name </span>= <span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">horizontalTrackLine</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span>, Type = <span style=\"color: rgba(0, 0, 255, 1);\">typeof</span>(Line))]</pre>\n</div>\n<p>4、增加对标尺控件的样式实现</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">ResourceDictionary </span><span style=\"color: rgba(255, 0, 0, 1);\">xmlns</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                    xmlns:x</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/winfx/2006/xaml\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                    xmlns:local</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"clr-namespace:RulerDemo\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Style </span><span style=\"color: rgba(255, 0, 0, 1);\">TargetType</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"</span><span style=\"color: rgba(128, 128, 0, 1);\">{x:Type local:RulerControl}</span><span style=\"color: rgba(0, 0, 255, 1);\">\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Setter </span><span style=\"color: rgba(255, 0, 0, 1);\">Property</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Template\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Setter.Value</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n                <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">ControlTemplate </span><span style=\"color: rgba(255, 0, 0, 1);\">TargetType</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"</span><span style=\"color: rgba(128, 128, 0, 1);\">{x:Type local:RulerControl}</span><span style=\"color: rgba(0, 0, 255, 1);\">\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n                    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n                        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">ContentPresenter</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n                        <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> 垂直跟踪线（垂直线，X坐标固定，Y跨越整个高度） </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n                        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Line </span><span style=\"color: rgba(255, 0, 0, 1);\">x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"verticalTrackLine\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              Stroke</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Red\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              StrokeThickness</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"1\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              StrokeDashArray</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"2,2\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              X1</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Y1</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> X2</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Y2</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"2000\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              Visibility</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Collapsed\"</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n                        <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> 水平跟踪线（水平线，Y坐标固定，X跨越整个宽度） </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n                        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Line </span><span style=\"color: rgba(255, 0, 0, 1);\">x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"horizontalTrackLine\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              Stroke</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Blue\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              StrokeThickness</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"1\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              StrokeDashArray</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"2,2\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              X1</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Y1</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> X2</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"2000\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Y2</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n                              Visibility</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Collapsed\"</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n                    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n                <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">ControlTemplate</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Setter.Value</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Setter</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Style</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">ResourceDictionary</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span></pre>\n</div>\n<p>5、CanvaseCoreEditor控件的包装</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">UserControl </span><span style=\"color: rgba(255, 0, 0, 1);\">x:Class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"RulerDemo.CanvaseCoreEditor\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             xmlns</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             xmlns:x</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/winfx/2006/xaml\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             xmlns:mc</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             xmlns:d</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/expression/blend/2008\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             xmlns:local</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"clr-namespace:RulerDemo\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             mc:Ignorable</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"d\"</span><span style=\"color: rgba(255, 0, 0, 1);\">   x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"CanvaseEditor\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n             d:DesignHeight</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"450\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> d:DesignWidth</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"800\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n\n    <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> 主网格，使用 ClipToBounds 确保内容不溢出 </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid </span><span style=\"color: rgba(255, 0, 0, 1);\">x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"MainGrid\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> ClipToBounds</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"True\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid.ColumnDefinitions</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">ColumnDefinition </span><span style=\"color: rgba(255, 0, 0, 1);\">Width</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"20\"</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">ColumnDefinition</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid.ColumnDefinitions</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid.RowDefinitions</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">RowDefinition </span><span style=\"color: rgba(255, 0, 0, 1);\">Height</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"20\"</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">RowDefinition</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid.RowDefinitions</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n\n        <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> 横向标尺 </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">local:RulerControl </span><span style=\"color: rgba(255, 0, 0, 1);\">DisplayUnit</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"pixel\"</span><span style=\"color: rgba(255, 0, 0, 1);\">  DisplayType</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Horizontal\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Grid.Row</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Grid.Column</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"1\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"ucPanleHor\"</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n\n        <span style=\"color: rgba(0, 128, 0, 1);\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1);\"> 纵向标尺 </span><span style=\"color: rgba(0, 128, 0, 1);\">--&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">local:RulerControl </span><span style=\"color: rgba(255, 0, 0, 1);\">DisplayUnit</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"pixel\"</span><span style=\"color: rgba(255, 0, 0, 1);\">  DisplayType</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"Vertical\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Grid.Row</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"1\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Grid.Column</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"0\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"ucPanleVer\"</span><span style=\"color: rgba(0, 0, 255, 1);\">/&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">UserControl</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span></pre>\n</div>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Collections.Generic;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Linq;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Text;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Threading.Tasks;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Controls;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Data;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Documents;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Input;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Media;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Media.Imaging;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Navigation;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Shapes;\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">namespace</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDemo\n{\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> CanvaseCoreEditor.xaml 的交互逻辑\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">partial</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> CanvaseCoreEditor : UserControl\n    {\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> CanvaseCoreEditor()\n        {\n            InitializeComponent();\n           \n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span><span style=\"color: rgba(0, 0, 0, 1);\"> MainWindowMouseMove(MouseEventArgs e)\n        {\n            ucPanleHor.RaiseHorizontalRulerMoveEvent(e);\n            ucPanleVer.RaiseVerticalRulerMoveEvent(e);\n        }\n    }\n}</span></pre>\n</div>\n<p>6、主窗口显示调用</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Window </span><span style=\"color: rgba(255, 0, 0, 1);\">x:Class</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"RulerDemo.MainWindow\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        xmlns</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        xmlns:x</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/winfx/2006/xaml\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        xmlns:d</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.microsoft.com/expression/blend/2008\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        xmlns:mc</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        xmlns:local</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"clr-namespace:RulerDemo\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        mc:Ignorable</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"d\"</span><span style=\"color: rgba(255, 0, 0, 1);\">\n        Title</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"MainWindow\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Height</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"450\"</span><span style=\"color: rgba(255, 0, 0, 1);\"> Width</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"800\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n\n\n        <span style=\"color: rgba(0, 0, 255, 1);\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1);\">local:CanvaseCoreEditor </span><span style=\"color: rgba(255, 0, 0, 1);\">x:Name</span><span style=\"color: rgba(0, 0, 255, 1);\">=\"CanvaseCoreEditor\"</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">local:CanvaseCoreEditor</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n\n\n    <span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Grid</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span>\n<span style=\"color: rgba(0, 0, 255, 1);\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1);\">Window</span><span style=\"color: rgba(0, 0, 255, 1);\">&gt;</span></pre>\n</div>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Diagnostics;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Text;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Controls;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Data;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Documents;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Input;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Media;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Media.Imaging;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Navigation;\n</span><span style=\"color: rgba(0, 0, 255, 1);\">using</span><span style=\"color: rgba(0, 0, 0, 1);\"> System.Windows.Shapes;\n\n</span><span style=\"color: rgba(0, 0, 255, 1);\">namespace</span><span style=\"color: rgba(0, 0, 0, 1);\"> RulerDemo\n{\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;summary&gt;</span>\n    <span style=\"color: rgba(128, 128, 128, 1);\">///</span><span style=\"color: rgba(0, 128, 0, 1);\"> Interaction logic for MainWindow.xaml\n    </span><span style=\"color: rgba(128, 128, 128, 1);\">///</span> <span style=\"color: rgba(128, 128, 128, 1);\">&lt;/summary&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1);\">public</span> <span style=\"color: rgba(0, 0, 255, 1);\">partial</span> <span style=\"color: rgba(0, 0, 255, 1);\">class</span><span style=\"color: rgba(0, 0, 0, 1);\"> MainWindow : Window\n    {\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">public</span><span style=\"color: rgba(0, 0, 0, 1);\"> MainWindow()\n        {\n            InitializeComponent();\n            MouseMove </span>+=<span style=\"color: rgba(0, 0, 0, 1);\"> MainWindow_MouseMove;\n        }\n\n        </span><span style=\"color: rgba(0, 0, 255, 1);\">private</span> <span style=\"color: rgba(0, 0, 255, 1);\">void</span> MainWindow_MouseMove(<span style=\"color: rgba(0, 0, 255, 1);\">object</span><span style=\"color: rgba(0, 0, 0, 1);\"> sender, MouseEventArgs e)\n        {\n            Debug.WriteLine(</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(128, 0, 0, 1);\">MainWindow_MouseMove</span><span style=\"color: rgba(128, 0, 0, 1);\">\"</span><span style=\"color: rgba(0, 0, 0, 1);\">);\n            CanvaseCoreEditor.MainWindowMouseMove(e);\n        }\n    }\n}</span></pre>\n</div>\n<p>&nbsp;</p>\n<div>&nbsp;</div>\n<p>&nbsp;7、显示效果如下图</p>\n<p><img alt=\"标尺\" src=\"https://img2024.cnblogs.com/blog/1063618/202601/1063618-20260131223134838-550214321.gif\" /></p>\n<p>&nbsp;</p>\n<p>总结：</p>\n<p>1、本次完善都是通过腾讯Codebuddy的AI编程插件 帮忙完善，加上一小部分的人为的代码微调</p>\n<p>2、标尺的代码已经上传至Github：<a href=\"https://github.com/wutangyuan/wutyDemo/tree/main/RulerDemo\" rel=\"noopener nofollow\">wutyDemo/RulerDemo at main · wutangyuan/wutyDemo</a></p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 22:35</span>&nbsp;\n<a href=\"https://www.cnblogs.com/wuty\">wuty007</a>&nbsp;\n阅读(<span id=\"post_view_count\">30</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "linux服务器静默安装Oracle26ai",
      "link": "https://www.cnblogs.com/liuziyi1/p/19558714",
      "published": "",
      "description": "<h2>\n\t\t\t<a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/liuziyi1/p/19558714\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 17:45\">\n    <span>linux服务器静默安装Oracle26ai</span>\n    \n\n</a>\n\n\t\t</h2>\n\t\t<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>下载地址：<a href=\"https://www.oracle.com/database/technologies/oracle26ai-linux-downloads.html\" rel=\"noopener nofollow\" target=\"_blank\">https://www.oracle.com/database/technologies/oracle26ai-linux-downloads.html</a><br />\n<img alt=\"image\" class=\"lazyload\" /></p>\n<p>1.安装环境准备<br />\n1.1.查看物理内存<br />\n<code>[root@aiserver ~]# free -m</code><br />\n1.2.操作系统版本</p>\n<pre><code>[root@aiserver ~]#  cat /etc/redhat-release\n</code></pre>\n<p>1.3.操作系统内存</p>\n<pre><code>[root@aiserver ~]# df -h /dev/shm/\n</code></pre>\n<p>1.4.磁盘空间</p>\n<pre><code>[root@aiserver ~]# df -TH\n[root@aiserver ~]# df -h /tmp/\n[root@aiserver ~]# df -h /u01\n</code></pre>\n<p>1.5.查看系统架构</p>\n<pre><code>[root@aiserver ~]# uname -m\nx86_64\n</code></pre>\n<p><code>[root@aiserver ~]# cat /proc/version</code></p>\n<p>1.6.解析/etc/hosts</p>\n<pre><code>[root@aiserver ~]# hostname\naiserver\n\ncat &gt;&gt; /etc/hosts &lt;&lt; EOF\n192.168.1.1 aiserver\nEOF\n</code></pre>\n<p>1.7.关闭防火墙还有selinux</p>\n<pre><code>systemctl status firewalld.service\nsystemctl stop firewalld.service\nsystemctl disable firewalld.service\n</code></pre>\n<p><code>sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config</code></p>\n<p>2.创建用户和组</p>\n<h1 id=\"查看是否安装有oracle软件\">查看是否安装有Oracle软件</h1>\n<p><code>[root@aiserver ~]# more /etc/oraInst.loc</code></p>\n<h1 id=\"查看是否已存在相关用户组\">查看是否已存在相关用户组</h1>\n<pre><code>[root@aiserver ~]# grep oinstall /etc/group\n[root@aiserver ~]# grep dba /etc/group\n[root@aiserver ~]# grep oper /etc/group\n</code></pre>\n<pre><code>[root@aiserver ~]# /usr/sbin/groupadd -g 54321 oinstall\n[root@aiserver ~]# /usr/sbin/groupadd -g 54322 dba\n[root@aiserver ~]# /usr/sbin/groupadd -g 54323 oper\n[root@aiserver ~]# /usr/sbin/useradd -u 54321 -g oinstall -G dba,oper oracle\n</code></pre>\n<p>--修改密码为oracle<br />\n<code>[root@aiserver ~]# passwd oracle</code></p>\n<p>3.创建工作的目录</p>\n<pre><code>[root@aiserver ~]# mkdir -p /u01/app/oracle\n[root@aiserver ~]# chown -R oracle:oinstall /u01/\n[root@aiserver ~]# chmod -R 775 /u01/app/oracle\n</code></pre>\n<p>4.配置Oracle的环境变量</p>\n<pre><code>[oracle@aiserver ~]$ vi .bash_profile\n\nexport ORACLE_BASE=/u01/app/oracle\nexport ORACLE_HOME=$ORACLE_BASE/product/23.26.1/dbhome_1\nexport ORACLE_SID=prod\nexport PATH=$ORACLE_HOME/bin:$PATH:$HOME/bin\n</code></pre>\n<pre><code>[oracle@aiserver ~]$ source .bash_profile\n[oracle@aiserver ~]$ env | grep ORACLE\n</code></pre>\n<p>5.修改内核参数<br />\n以下在root用户下操作</p>\n<pre><code>cp /etc/sysctl.conf /etc/sysctl.conf.bak\n\ncat &gt;&gt; /etc/sysctl.conf &lt;&lt; \"EOF\"\nfs.file-max = 6815744\nkernel.sem = 250 32000 100 128\nkernel.shmmni = 4096\nkernel.shmall = 751619276\nkernel.shmmax = 3006477107\nkernel.panic_on_oops = 1\nnet.core.rmem_default = 262144\nnet.core.rmem_max = 4194304\nnet.core.wmem_default = 262144\nnet.core.wmem_max = 1048576\nfs.aio-max-nr = 1048576\nnet.ipv4.ip_local_port_range = 9000 65500\nEOF\n\nkernel.shmall :物理内存的70%\nkernel.shmmni=kernel.shmall/4\n\n环境变量生效\nsysctl --system\n</code></pre>\n<p>6./etc/profile配置<br />\n以下root用户操作</p>\n<pre><code>cp /etc/profile /etc/profile.bak\n\ncat &gt;&gt; /etc/profile &lt;&lt; \"EOF\"\nif [ $USER = \"oracle\" ]; then\n        if [ $SHELL = \"/bin/ksh\" ]; then\n                ulimit -p 16384\n                ulimit -n 65536\n        else\n                ulimit -u 16384 -n 65536\n        fi\nfi\nEOF\n\n\nvi /etc/pam.d/login\nsession    required     pam_limits.so\n</code></pre>\n<p>7.修改资源限制<br />\n以下root用户操作</p>\n<pre><code>cp /etc/security/limits.conf /etc/security/limits.conf.bak\n\ncat &gt;&gt; /etc/security/limits.conf &lt;&lt; \"EOF\"\noracle soft nproc 2047\noracle hard nproc 16384\noracle soft nofile 1024\noracle hard nofile 65536\nEOF\n</code></pre>\n<p>8.yum安装依赖</p>\n<pre><code>[root@aiserver ~]# mount | grep sr0\nmount /dev/cdrom /mnt\n\necho \"[localREPO]\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"name=localhost8\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"baseurl=file:///mnt/BaseOS\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"gpgcheck=0\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"enabled=1\" &gt;&gt; /etc/yum.repos.d/my.repo\n\necho \"[localREPO_APP]\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"name=localhost8_app\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"baseurl=file:///mnt/AppStream\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"gpgcheck=0\" &gt;&gt; /etc/yum.repos.d/my.repo\necho \"enabled=1\" &gt;&gt; /etc/yum.repos.d/my.repo\n\n[root@aiserver yum.repos.d]# yum repolist\n</code></pre>\n<p>以下命令安装依赖包</p>\n<pre><code>yum install bc \\\nbinutils \\\ncompat-openssl10 \\\nelfutils-libelf \\\nfontconfig \\\nglibc \\\nglibc-devel \\\nksh \\\nlibaio \\\nlibXrender \\\nlibX11 \\\nlibXau \\\nlibXi \\\nlibXtst \\\nlibgcc \\\nlibstdc++ \\\nlibxcb \\\nlibibverbs \\\nlibasan \\\nliblsan \\\nlibrdmacm \\\nmake \\\npolicycoreutils \\\npolicycoreutils-python-utils \\\nsmartmontools \\\nsysstat -y\n</code></pre>\n<p>9.解压软件授权、<br />\noracle用户下操作<br />\n<code>[oracle@aiserver ~]$ mkdir -p /u01/app/oracle/product/23.26.1/dbhome_1</code></p>\n<p>oracle用户下操作<br />\n<code>[oracle@aiserver ~]$ unzip /opt/LINUX.X64_2326100_db_home.zip -d $ORACLE_HOME</code></p>\n<p>10.静默安装Oracle数据库<br />\n10.1.编辑rsp文件</p>\n<pre><code>[oracle@aiserver ~]$ cd $ORACLE_HOME/install/response\n[oracle@aiserver response]$ cp db_install.rsp /tmp\n</code></pre>\n<pre><code>vi /tmp/db_install.rsp\n\n修改db_install.rsp文件中以下内容\n\noracle.install.option=INSTALL_DB_SWONLY\nUNIX_GROUP_NAME=oinstall\nINVENTORY_LOCATION=/u01/app/oraInventory\nORACLE_BASE=/u01/app/oracle\nORACLE_HOME=/u01/app/oracle/product/23.26.1/dbhome_1\nInstallEdition=EE\nOSDBA_GROUP=dba\nOSOPER_GROUP=oper\nOSBACKUPDBA_GROUP=dba\nOSDGDBA_GROUP=dba\nOSKMDBA_GROUP=dba\nOSRACDBA_GROUP=dba\n</code></pre>\n<p>dbType=GENERAL_PURPOSE</p>\n<p>10.2.静默安装Oracle软件<br />\n[oracle@aiserver ~]$ cd $ORACLE_HOME<br />\n./runInstaller -silent -responseFile /tmp/db_install.rsp -ignorePrereq</p>\n<h1 id=\"安装结束后需要以root用户执行以下两个脚本\">安装结束后需要以root用户执行以下两个脚本</h1>\n<p>/u01/app/oracle/oraInventory/orainstRoot.sh<br />\n/u01/app/oracle/product/23.26.1/dbhome_1/root.sh</p>\n<p>11.监听创建<br />\n静默配置监听<br />\n<code>[oracle@aiserver ~]$ netca -silent -responseFile $ORACLE_HOME/assistants/netca/netca.rsp</code></p>\n<p>12.dbca建库<br />\n12.1.编辑dbca.rsp安装文件</p>\n<pre><code>[oracle@aiserver ~]$ cd $ORACLE_HOME/assistants/dbca\n[oracle@aiserver dbca]$ cp dbca.rsp /tmp\n[oracle@aiserver ~]$ vi /tmp/dbca.rsp\n\nresponseFileVersion=/oracle/assistants/rspfmt_dbca_response_schema_v23.0.0\ngdbName=prod\nsid=prod\ndatabaseConfigType=SI\ncreateAsContainerDatabase=true\nnumberOfPDBs=2\npdbName=prod\ntemplateName=General_Purpose.dbc\noracleHomeUserPassword=oracle\ntotalMemory=1500\nsysPassword=oracle\nsystemPassword=oracle\ndatafileDestination=/u01/app/oracle/oradata\ncharacterSet=AL32UTF8\nnationalCharacterSet=UTF8\ndatabaseType=OLTP\n\n注意：templateName、createAsContainerDatabase必須指定\n</code></pre>\n<p>12.2.静默安装数据库<br />\n<code>[oracle@aiserver ~]$ dbca -silent -createDatabase -responseFile /tmp/dbca.rsp</code></p>\n<p><img alt=\"image\" class=\"lazyload\" /></p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n\t\t<p class=\"postfoot\">\n\t\t\tposted on \n<span id=\"post-date\">2026-01-31 17:45</span>&nbsp;\n<a href=\"https://www.cnblogs.com/liuziyi1\">刘子毅</a>&nbsp;\n阅读(<span id=\"post_view_count\">50</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n\n\t\t</p>"
    },
    {
      "title": "ä¸€å¤©ä¸€ä¸ªPythonåº“ï¼šmarkupsafe - è®©ä½ çš„å­—ç¬¦ä¸²å®‰å…¨åˆä¼˜é›",
      "link": "https://www.cnblogs.com/min2k/p/19557576",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/min2k/p/19557576\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 13:31\">\n    <span>一天一个Python库：markupsafe - 让你的字符串安全又优雅</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"markupsafe---让你的字符串安全又优雅\">markupsafe - 让你的字符串安全又优雅</h1>\n<h2 id=\"一什么是markupsafe\">一、什么是markupsafe？</h2>\n<p><strong>markupsafe</strong> 是一个用于处理标记语言（如HTML、XML）字符串的 Python 库。<br />\n它可以帮助你：</p>\n<ul>\n<li><strong>安全地转义字符串</strong>：防止跨站脚本（XSS）攻击，特别是当你需要将用户输入显示在网页上时。</li>\n<li><strong>标记安全字符串</strong>：将经过转义或信任的字符串标记为“安全”，避免重复转义，提高效率。</li>\n<li><strong>模板引擎集成</strong>：在像Jinja2这样的模板引擎中，markupsafe扮演了核心角色，确保渲染的HTML内容是安全的。</li>\n</ul>\n<h2 id=\"二应用场景\">二、应用场景</h2>\n<p><strong>markupsafe</strong> 广泛应用于以下实际场景：</p>\n<ul>\n<li><strong>Web开发框架</strong>: 在Flask、Jinja2等Web框架中，用于自动转义模板渲染的输出，防止注入攻击。</li>\n<li><strong>用户生成内容</strong>: 当你的网站允许用户输入并显示内容时（如评论、论坛帖子），markupsafe能确保这些内容在显示时是安全的。</li>\n<li><strong>构建动态HTML/XML</strong>: 在程序中动态生成HTML或XML片段时，需要确保所有插入的数据都经过了正确的转义。</li>\n</ul>\n<h2 id=\"三如何安装\">三、如何安装</h2>\n<ol>\n<li>使用 pip 安装</li>\n</ol>\n<pre><code class=\"language-bash\">pip install markupsafe\n\n# 如果安装慢的话，推荐使用国内镜像源\npip install markupsafe -i https://www.python64.cn/pypi/simple/\n</code></pre>\n<ol start=\"2\">\n<li>使用 <a href=\"https://www.min2k.com/tools/python-run/\" rel=\"noopener nofollow\" target=\"_blank\">PythonRun</a> 在线运行代码（无需本地安装）</li>\n</ol>\n<h2 id=\"四示例代码\">四、示例代码</h2>\n<p>转义用户输入以防止XSS攻击</p>\n<pre><code class=\"language-python\">from markupsafe import escape, Markup\n\n# 用户输入，可能包含恶意脚本\nuser_input_raw = \"&lt;script&gt;alert('您被攻击了！')&lt;/script&gt;\"\nis_admin = True # 假设有一个条件判断用户是否是管理员\n\n# 使用escape转义用户输入\nsafe_output = escape(user_input_raw)\n\n# 打印转义后的结果\nprint(f\"转义后的内容: {safe_output}\")\n\n# 假设有一些信任的HTML内容，我们不希望它被转义\ntrusted_html = Markup(\"&lt;b&gt;这是加粗的文本&lt;/b&gt;\")\n\n# 如果是管理员，则直接显示原始输入（这里仅为演示，实际应用需极其谨慎）\nif is_admin:\n    print(f\"管理员显示（危险！）：{user_input_raw}\")\nelse:\n    # 否则显示安全的内容\n    print(f\"普通用户显示（安全！）：{safe_output}\")\n\n# 结合使用，Markup标记的内容不会被二次转义\nformatted_output = Markup(f\"&lt;p&gt;Hello, {safe_output}!&lt;/p&gt;\")\nprint(f\"组合后的安全HTML: {formatted_output}\")\n\n# 检查是否是Markup实例\nif isinstance(formatted_output, Markup):\n    print(\"formatted_output 是一个 Markup 实例，已被标记为安全。\")\nelse:\n    print(\"formatted_output 不是 Markup 实例。\")\n</code></pre>\n<p>使用 <a href=\"https://www.min2k.com/tools/python-run/?code=from%20markupsafe%20import%20escape%2C%20Markup%0A%0A%23%20%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%EF%BC%8C%E5%8F%AF%E8%83%BD%E5%8C%85%E5%90%AB%E6%81%B6%E6%84%8F%E8%84%9A%E6%9C%AC%0Auser_input_raw%20%3D%20%22%3Cscript%3Ealert%28'%E6%82%A8%E8%A2%AB%E6%94%BB%E5%87%BB%E4%BA%86%EF%BC%81'%29%3C%2Fscript%3E%22%0Ais_admin%20%3D%20True%20%23%20%E5%81%87%E8%AE%BE%E6%9C%89%E4%B8%80%E4%B8%AA%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E6%98%AF%E5%90%A6%E6%98%AF%E7%AE%A1%E7%90%86%E5%91%98%0A%0A%23%20%E4%BD%BF%E7%94%A8escape%E8%BD%AC%E4%B9%89%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%0Asafe_output%20%3D%20escape%28user_input_raw%29%0A%0A%23%20%E6%89%93%E5%8D%B0%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E7%BB%93%E6%9E%9C%0Aprint%28f%22%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9%3A%20%7Bsafe_output%7D%22%29%0A%0A%23%20%E5%81%87%E8%AE%BE%E6%9C%89%E4%B8%80%E4%BA%9B%E4%BF%A1%E4%BB%BB%E7%9A%84HTML%E5%86%85%E5%AE%B9%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%8D%E5%B8%8C%E6%9C%9B%E5%AE%83%E8%A2%AB%E8%BD%AC%E4%B9%89%0Atrusted_html%20%3D%20Markup%28%22%3Cb%3E%E8%BF%99%E6%98%AF%E5%8A%A0%E7%B2%97%E7%9A%84%E6%96%87%E6%9C%AC%3C%2Fb%3E%22%29%0A%0A%23%20%E5%A6%82%E6%9E%9C%E6%98%AF%E7%AE%A1%E7%90%86%E5%91%98%EF%BC%8C%E5%88%99%E7%9B%B4%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%8E%9F%E5%A7%8B%E8%BE%93%E5%85%A5%EF%BC%88%E8%BF%99%E9%87%8C%E4%BB%85%E4%B8%BA%E6%BC%94%E7%A4%BA%EF%BC%8C%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E9%9C%80%E6%9E%81%E5%85%B6%E8%B0%A8%E6%85%8E%EF%BC%89%0Aif%20is_admin%3A%0A%20%20%20%20print%28f%22%E7%AE%A1%E7%90%86%E5%91%98%E6%98%BE%E7%A4%BA%EF%BC%88%E5%8D%B1%E9%99%A9%EF%BC%81%EF%BC%89%EF%BC%9A%7Buser_input_raw%7D%22%29%0Aelse%3A%0A%20%20%20%20%23%20%E5%90%A6%E5%88%99%E6%98%BE%E7%A4%BA%E5%AE%89%E5%85%A8%E7%9A%84%E5%86%85%E5%AE%B9%0A%20%20%20%20print%28f%22%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E6%98%BE%E7%A4%BA%EF%BC%88%E5%AE%89%E5%85%A8%EF%BC%81%EF%BC%89%EF%BC%9A%7Bsafe_output%7D%22%29%0A%0A%23%20%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8%EF%BC%8CMarkup%E6%A0%87%E8%AE%B0%E7%9A%84%E5%86%85%E5%AE%B9%E4%B8%8D%E4%BC%9A%E8%A2%AB%E4%BA%8C%E6%AC%A1%E8%BD%AC%E4%B9%89%0Aformatted_output%20%3D%20Markup%28f%22%3Cp%3EHello%2C%20%7Bsafe_output%7D!%3C%2Fp%3E%22%29%0Aprint%28f%22%E7%BB%84%E5%90%88%E5%90%8E%E7%9A%84%E5%AE%89%E5%85%A8HTML%3A%20%7Bformatted_output%7D%22%29%0A%0A%23%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E6%98%AFMarkup%E5%AE%9E%E4%BE%8B%0Aif%20isinstance%28formatted_output%2C%20Markup%29%3A%0A%20%20%20%20print%28%22formatted_output%20%E6%98%AF%E4%B8%80%E4%B8%AA%20Markup%20%E5%AE%9E%E4%BE%8B%EF%BC%8C%E5%B7%B2%E8%A2%AB%E6%A0%87%E8%AE%B0%E4%B8%BA%E5%AE%89%E5%85%A8%E3%80%82%22%29%0Aelse%3A%0A%20%20%20%20print%28%22formatted_output%20%E4%B8%8D%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%E3%80%82%22%29\" rel=\"noopener nofollow\" target=\"_blank\">PythonRun</a> 在线运行这段代码，结果如下：</p>\n<pre><code class=\"language-text\">转义后的内容: &amp;lt;script&amp;gt;alert(&amp;#39;您被攻击了！&amp;#39;)&amp;lt;/script&amp;gt;\n管理员显示（危险！）：&lt;script&gt;alert('您被攻击了！')&lt;/script&gt;\n组合后的安全HTML: &lt;p&gt;Hello, &amp;lt;script&amp;gt;alert(&amp;#39;您被攻击了！&amp;#39;)&amp;lt;/script&amp;gt;!&lt;/p&gt;\nformatted_output 是一个 Markup 实例，已被标记为安全。\n</code></pre>\n<p>使用 <a href=\"https://www.min2k.com/tools/mermaid/?code=flowchart%20TB%0A%20%20A%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20B%7B%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E5%92%8C%E7%AE%A1%E7%90%86%E5%91%98%E7%8A%B6%E6%80%81%7D%3B%0A%20%20B%20--%3E%20C%5B%E4%BD%BF%E7%94%A8escape%E8%BD%AC%E4%B9%89%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%5D%3B%0A%20%20C%20--%3E%20D%5B%E6%89%93%E5%8D%B0%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9%5D%3B%0A%20%20D%20--%3E%20E%7B%E5%A6%82%E6%9E%9C%20isAdmin%20%E4%B8%BA%20True%3F%7D%3B%0A%20%20E%20--%20%E6%98%AF%20--%3E%20F%5B%E6%89%93%E5%8D%B0%E5%8E%9F%E5%A7%8B%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%20%28%E5%8D%B1%E9%99%A9%29%5D%3B%0A%20%20E%20--%20%E5%90%A6%20--%3E%20G%5B%E6%89%93%E5%8D%B0%E5%AE%89%E5%85%A8%E7%9A%84%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%5D%3B%0A%20%20F%20--%3E%20H%5B%E5%88%9B%E5%BB%BA%E5%AE%89%E5%85%A8%E7%9A%84%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20G%20--%3E%20H%3B%0A%20%20H%20--%3E%20I%5B%E6%89%93%E5%8D%B0%E7%BB%84%E5%90%88%E5%90%8E%E7%9A%84%E5%AE%89%E5%85%A8HTML%5D%3B%0A%20%20I%20--%3E%20J%7B%E6%A3%80%E6%9F%A5%20formatted_output%20%E6%98%AF%E5%90%A6%E4%B8%BA%20Markup%20%E5%AE%9E%E4%BE%8B%3F%7D%3B%0A%20%20J%20--%20%E6%98%AF%20--%3E%20K%5B%E6%89%93%E5%8D%B0%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20J%20--%20%E5%90%A6%20--%3E%20L%5B%E6%89%93%E5%8D%B0%E4%B8%8D%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20K%20--%3E%20M%5B%E7%BB%93%E6%9D%9F%5D%3B%0A%20%20L%20--%3E%20M%3B\" rel=\"noopener nofollow\" target=\"_blank\">MermaidGo</a> 绘制示例代码的流程图，结果如下：</p>\n<p><img alt=\"MermerGo的markupsafe流程图\" class=\"lazyload\" /></p>\n<h2 id=\"五学习资源\">五、学习资源</h2>\n<ol>\n<li>开源项目：<a href=\"https://github.com/pallets/markupsafe\" rel=\"noopener nofollow\" target=\"_blank\">markupsafe</a></li>\n<li>中文自述：<a href=\"https://www.python64.cn/readme/markupsafe/\" rel=\"noopener nofollow\" target=\"_blank\">REMDME</a></li>\n<li>在线运行：<a href=\"https://www.min2k.com/tools/python-run/\" rel=\"noopener nofollow\" target=\"_blank\">PythonRun</a></li>\n</ol>\n<blockquote>\n<p>如果这篇文章对你有帮助，欢迎点赞、收藏、转发！<br />\n学习过程中有任何问题，欢迎在评论区留言交流～</p>\n</blockquote>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 13:31</span>&nbsp;\n<a href=\"https://www.cnblogs.com/min2k\">敏编程</a>&nbsp;\n阅读(<span id=\"post_view_count\">64</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "从0到1，快速训练并使用YOLO模型",
      "link": "https://www.cnblogs.com/ClownLMe/p/19559180",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/ClownLMe/p/19559180\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 21:54\">\n    <span>从0到1，快速训练并使用YOLO模型</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"简介\">简介</h1>\n<p><strong>YOLO</strong>是目前计算机视觉领域最前沿、应用最广泛的<strong>目标检测</strong>算法框架，他能快速识别区分目标，广泛应用于游戏，无人驾驶，工业等领域。</p>\n<p>以识别躲避掉落滑块的游戏的物体图片作为例子。</p>\n<h1 id=\"一环境配置\">一，环境配置</h1>\n<pre><code class=\"language-bash\">pip install ultralytics\n</code></pre>\n<h1 id=\"二准备数据集\">二，准备数据集</h1>\n<p>这个格式目录如下：</p>\n<pre><code class=\"language-bash\">my_dataset/\n├── data.yaml # 配置文件（定义路径和类别）\n├── train/ #训练数据集\n│   ├── images/ # 训练图片\n│   └── labels/ # 标注文件 (.txt)\n└── val/ #验证数据集\n    ├── images/ \n    └── labels/ \n</code></pre>\n<h3 id=\"datayml\">data.yml</h3>\n<pre><code class=\"language-yaml\">path: D:\\D_MyProject\\Ai\\game_ai\\my_dataset #数据集路径\ntrain: train/images #训练集图片路径\nval: val/images #验证集图片路径\n\nnc: 3 #标记个数\nnames:  #每个标记的名称\n&nbsp; 0: player\n&nbsp; 1: enemy\n&nbsp; 2: game_over\n</code></pre>\n<h3 id=\"下面是用ai生成了数据集的生成脚本\">下面是用AI生成了数据集的生成脚本</h3>\n<p>数据量太多了，这里为了演示，或者学习，可以直接使用下面脚本</p>\n<pre><code class=\"language-python\">import pygame\nimport random\nimport sys\nimport os\nimport shutil\n\n# =================配置区域=================\n# 数据集根目录名称\nDATASET_ROOT = \"my_dataset\"\n# 采集总数量\nMAX_IMAGES = 1000\n# 训练集占比 (0.8 = 80% 训练, 20% 验证)\nTRAIN_RATIO = 0.8\n\n# ================= 1. 环境清理与目录创建 =================\nprint(f\"🚀 正在初始化数据集目录: {DATASET_ROOT} ...\")\n\n# 如果目录已存在，先删除（防止旧数据混入），确保数据纯净\nif os.path.exists(DATASET_ROOT):\n    shutil.rmtree(DATASET_ROOT)\n\n# 创建 YOLO 标准目录结构\nfor split in ['train', 'val']:\n    os.makedirs(os.path.join(DATASET_ROOT, split, 'images'), exist_ok=True)\n    os.makedirs(os.path.join(DATASET_ROOT, split, 'labels'), exist_ok=True)\n\n# ================= 2. 自动生成 data.yaml =================\nyaml_content = f\"\"\"\npath: {os.path.abspath(DATASET_ROOT)} # 使用绝对路径，防止报错\ntrain: train/images\nval: val/images\n\nnc: 3\nnames:\n  0: player\n  1: enemy\n  2: game_over\n\"\"\"\nwith open(os.path.join(DATASET_ROOT, \"data.yaml\"), \"w\", encoding='utf-8') as f:\n    f.write(yaml_content)\nprint(\"✅ data.yaml 配置文件已生成。\")\n\n# ================= 3. 游戏与采集逻辑 =================\npygame.init()\nWIDTH, HEIGHT = 800, 600\n# 使用 hidden 模式或正常模式均可，这里用正常模式方便你看到进度\nscreen = pygame.display.set_mode((WIDTH, HEIGHT))\npygame.display.set_caption(\"Auto Data Generator\")\nclock = pygame.time.Clock()\n\nfont_big = pygame.font.SysFont(\"monospace\", 50)\nfont_small = pygame.font.SysFont(\"monospace\", 35)\n\n# 游戏状态\nplayer_size, enemy_size = 50, 50\nplayer_x = WIDTH // 2\nplayer_y = HEIGHT - player_size - 10\nenemies = []\n\nimg_count = 0\nGAMEPLAY_LIMIT = int(MAX_IMAGES * 0.9) # 90% 正常游戏，10% Game Over\n\nprint(f\"📸 开始采集 {MAX_IMAGES} 张图片 (自动划分 Train/Val)...\")\n\nwhile img_count &lt; MAX_IMAGES:\n    # 处理退出事件，防止卡死\n    for event in pygame.event.get():\n        if event.type == pygame.QUIT:\n            pygame.quit()\n            sys.exit()\n\n    screen.fill((0, 0, 0))\n    labels = [] # 存储当前帧的标签\n    dw, dh = 1.0 / WIDTH, 1.0 / HEIGHT # 归一化系数\n\n    # --- 逻辑分支：正常游戏 vs Game Over ---\n    if img_count &lt; GAMEPLAY_LIMIT:\n        # A. 正常游戏画面\n        # 1. 玩家移动\n        if random.random() &lt; 0.2: # 增加移动频率\n            player_x += random.choice([-15, 15])\n            player_x = max(0, min(WIDTH - player_size, player_x))\n\n        # 2. 敌人生成与移动\n        if random.randint(0, 20) == 0: # 增加敌人密度\n            enemies.append([random.randint(0, WIDTH - enemy_size), 0])\n        \n        for enemy in enemies: enemy[1] += 15 # 加快下落速度\n        enemies = [e for e in enemies if e[1] &lt; HEIGHT]\n\n        # 3. 绘制玩家 (Class 0)\n        pygame.draw.rect(screen, (50, 150, 255), (player_x, player_y, player_size, player_size))\n        # 计算 YOLO 坐标 (class x_center y_center width height)\n        px, py = (player_x + player_size/2) * dw, (player_y + player_size/2) * dh\n        labels.append(f\"0 {px:.6f} {py:.6f} {player_size*dw:.6f} {player_size*dh:.6f}\")\n\n        # 4. 绘制敌人 (Class 1)\n        for e in enemies:\n            pygame.draw.rect(screen, (255, 50, 50), (e[0], e[1], enemy_size, enemy_size))\n            ex, ey = (e[0] + enemy_size/2) * dw, (e[1] + enemy_size/2) * dh\n            labels.append(f\"1 {ex:.6f} {ey:.6f} {enemy_size*dw:.6f} {enemy_size*dh:.6f}\")\n\n    else:\n        # B. Game Over 画面 (Class 2)\n        text_surf = font_big.render(\"GAME OVER\", True, (255, 50, 50))\n        \n        # 随机抖动位置，防止过拟合\n        off_x, off_y = random.randint(-50, 50), random.randint(-50, 50)\n        text_x = WIDTH // 2 - text_surf.get_width() // 2 + off_x\n        text_y = HEIGHT // 2 - 100 + off_y\n        screen.blit(text_surf, (text_x, text_y))\n\n        # 干扰项\n        score_surf = font_small.render(f\"Score: {random.randint(0,999)}\", True, (255,255,255))\n        screen.blit(score_surf, (WIDTH//2 - score_surf.get_width()//2, HEIGHT//2 + 50))\n\n        # 记录标签\n        tw, th = text_surf.get_width(), text_surf.get_height()\n        tx, ty = (text_x + tw/2) * dw, (text_y + th/2) * dh\n        labels.append(f\"2 {tx:.6f} {ty:.6f} {tw*dw:.6f} {th*dh:.6f}\")\n\n    # ================= 4. 保存逻辑 (核心修改) =================\n    pygame.display.flip()\n    \n    # 采样率：不是每一帧都保存，防止重复度过高 (这里设为 30% 概率保存)\n    if random.random() &lt; 0.3:\n        # A. 决定是去 Train 还是 Val\n        split_folder = \"train\" if random.random() &lt; TRAIN_RATIO else \"val\"\n        \n        # B. 生成文件名\n        filename = f\"{img_count:06d}\"\n        img_save_path = os.path.join(DATASET_ROOT, split_folder, \"images\", f\"{filename}.jpg\")\n        lbl_save_path = os.path.join(DATASET_ROOT, split_folder, \"labels\", f\"{filename}.txt\")\n\n        # C. 保存图片\n        pygame.image.save(screen, img_save_path)\n\n        # D. 保存标签\n        with open(lbl_save_path, \"w\") as f:\n            f.write(\"\\n\".join(labels))\n\n        img_count += 1\n        \n        # 打印进度条\n        print(f\"[{split_folder.upper()}] 进度: {img_count}/{MAX_IMAGES}\", end=\"\\r\")\n\n    # 加速模拟，不要垂直同步，越快越好\n    clock.tick(0) \n\npygame.quit()\nprint(f\"\\n\\n✨ 全部完成！数据集已就绪：{os.path.abspath(DATASET_ROOT)}\")\nprint(\"💡 下一步：直接运行 model.train(data='my_dataset/data.yaml')\")\n</code></pre>\n<h1 id=\"三训练yolo模型\">三，训练YOLO模型</h1>\n<p>可以看到，使用<code>ultralytics</code>框架训练YOLO的代码非常简单，只需要几行<br />\n<strong>注意：这里YOLO会自动下载模型并训练，下载时失败可能需要挂梯子</strong></p>\n<pre><code class=\"language-python\">from ultralytics import YOLO\n\ndef train_model():\n    #加载模型\n    model = YOLO(\"yolo11n.pt\") \n\n    #开始训练\n    print(\"开始训练...\")\n    results = model.train(\n        data=\"my_dataset/data.yaml\", #数据集配置文件\n        epochs=30, #训练轮数\n        imgsz=640, #图片输入尺寸\n        batch=16, #显存够大可以改大，比如 32 或 64\n        device=0, #强制使用第一张显卡 (需要CUDA)\n        workers=0, #Windows下设为0防止多进程报错\n        project=\"dodge_project\",#保存路径\n        name=\"ai_model\" #训练运行名称\n    )\n    print(f\"训练完成！最佳模型保存在: {results.save_dir}/weights/best.pt\")\n\nif __name__ == \"__main__\":\n    train_model()\n</code></pre>\n<h1 id=\"四使用yolo模型\">四，使用YOLO模型</h1>\n<pre><code class=\"language-python\">from ultralytics import YOLO\n\n#配置路径\nMODEL_PATH = \"dodge_project/ai_model/weights/best.pt\" \nPIC_PATH = \"my_dataset/val/images/000045.jpg\"\n\n#加载模型\nmodel = YOLO(MODEL_PATH)\nprint(f\"模型加载成功\")\n\n#识别图片\nresults = model.predict(PIC_PATH, verbose=False, conf=0.4, imgsz=640)\nresult = results[0]\n\n#获取信息并打印\nfor box in result.boxes:\n    # 获取坐标 (x1, y1, x2, y2)、类别 ID 和置信度\n    x1, y1, x2, y2 = map(int, box.xyxy[0])\n    cls_id = int(box.cls[0])\n    conf = float(box.conf[0])\n    \n    # 类别名称映射\n    names = {0: \"Player\", 1: \"Enemy\", 2: \"Game Over\"}\n    label = names.get(cls_id, f\"Unknown({cls_id})\")\n    print(f\"找到物体: [{label:10}] | 置信度: {conf:.2f} | 坐标: ({x1}, {y1}) -&gt; ({x2}, {y2})\")\n\n#展示图片\nresult.show()\n</code></pre>\n<p><strong>如果❤喜欢❤本系列教程，就点个关注吧，后续不定期更新~</strong></p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 21:54</span>&nbsp;\n<a href=\"https://www.cnblogs.com/ClownLMe\">ClownLMe</a>&nbsp;\n阅读(<span id=\"post_view_count\">30</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "Clawdbot 是如何实现永久记忆的？",
      "link": "https://www.cnblogs.com/didispace/p/19559022",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/didispace/p/19559022\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 20:27\">\n    <span>Clawdbot 是如何实现永久记忆的？</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>你是否曾经和AI助手聊了一整晚，第二天打开对话却发现它完全忘了你们讨论过的关键细节？或者当你在多个项目之间切换时，AI总是在问\"你指的是哪个API\"，让你不厌其烦地重复背景信息。这种\"金鱼式记忆\"是当下大多数云端AI产品的通病——它们要么只能记住有限的上下文，要么把所有数据都存储在厂商的服务器上。</p>\n<p>但如果有一个AI助手，它能像一位真正的私人助理那样，永远记住你的偏好、你的项目细节、甚至你三个月前提过的小习惯？更妙的是，这些记忆完全存储在你自己的电脑上，由你全权掌控。</p>\n<p>这就是Clawdbot正在做的事情。作为一款开源的个人AI助手，Clawdbot在GitHub上已经获得了超过125,000个Star。与运行在云端的ChatGPT或Claude不同，Clawdbot直接运行在你的本地机器上，并且能够集成到你日常使用的聊天平台中（Discord、WhatsApp、Telegram等）。</p>\n<p>它不仅是一个聊天机器人，更是一个能自主处理实际任务的助手：管理邮件、安排日历、处理航班值机、按计划运行后台任务。但最吸引我的是它的持久化记忆系统——它能实现24/7的全天候上下文保持，记住对话内容，并无限期地基于之前的交互进行累积。</p>\n<p>如果你读过我之前关于ChatGPT记忆和Claude记忆的文章，就知道我对不同AI产品如何处理记忆这个问题非常着迷。Clawdbot采用了一种截然不同的方法：它不是基于云端、由公司控制的记忆，而是将一切保存在本地，让用户完全拥有自己的上下文和技能数据。</p>\n<p>让我们一起深入了解它是如何工作的。</p>\n<blockquote>\n<p>以下内容翻译自<a href=\"https://manthanguptaa.in/posts/clawdbot_memory\" rel=\"noopener nofollow\" target=\"_blank\">《How Clawdbot Remembers Everything》</a></p>\n</blockquote>\n<h2 id=\"上下文是如何构建的\">上下文是如何构建的</h2>\n<p>在深入探讨记忆之前，我们先来理解模型在每次请求时能看到什么：</p>\n<pre><code class=\"language-text\">[0] 系统提示词（静态指令 + 条件指令）\n[1] 项目上下文（引导文件：AGENTS.md、SOUL.md 等）\n[2] 对话历史（消息、工具调用、压缩摘要）\n[3] 当前消息\n</code></pre>\n<p>系统提示词定义了Agent的能力和可用工具。与记忆相关的是\"项目上下文\"，它包含了用户可编辑的Markdown文件，这些文件会被注入到每次请求中：</p>\n<p>这些文件位于Agent的工作空间中，与记忆文件并存，使得整个Agent的配置变得透明且可编辑。</p>\n<h2 id=\"上下文-vs-记忆\">上下文 vs 记忆</h2>\n<p>理解上下文和记忆之间的区别，是理解Clawdbot的基础。</p>\n<p><strong>上下文</strong>是模型在单次请求中能看到的一切：</p>\n<pre><code class=\"language-text\">上下文 = 系统提示词 + 对话历史 + 工具结果 + 附件\n</code></pre>\n<p>上下文的特性：</p>\n<ul>\n<li><strong>临时的</strong>——只存在于本次请求期间</li>\n<li><strong>有限的</strong>——受限于模型的上下文窗口（例如20万token）</li>\n<li><strong>昂贵的</strong>——每个token都计入API成本和速度</li>\n</ul>\n<p><strong>记忆</strong>是存储在磁盘上的内容：</p>\n<pre><code class=\"language-text\">记忆 = MEMORY.md + memory/*.md + 会话转录文件\n</code></pre>\n<p>记忆的特性：</p>\n<ul>\n<li><strong>持久的</strong>——在重启、日复一日、月复一月后依然存在</li>\n<li><strong>无限的</strong>——可以无限增长</li>\n<li><strong>低成本的</strong>——存储不产生API费用</li>\n<li><strong>可搜索的</strong>——建立索引以支持语义检索</li>\n</ul>\n<h2 id=\"记忆工具\">记忆工具</h2>\n<p>Agent通过两个专用工具来访问记忆：</p>\n<h3 id=\"1-memory_search\">1. memory_search</h3>\n<p><strong>用途</strong>：在所有文件中查找相关的记忆</p>\n<pre><code class=\"language-json\">{\n  \"name\": \"memory_search\",\n  \"description\": \"强制性回忆步骤：在回答关于之前工作、决策、日期、人员、偏好或待办事项的问题之前，对MEMORY.md和memory/*.md进行语义搜索\",\n  \"parameters\": {\n    \"query\": \"我们对API做了什么决定？\",\n    \"maxResults\": 6,\n    \"minScore\": 0.35\n  }\n}\n</code></pre>\n<p><strong>返回结果</strong>：</p>\n<pre><code class=\"language-json\">{\n  \"results\": [\n    {\n      \"path\": \"memory/2026-01-20.md\",\n      \"startLine\": 45,\n      \"endLine\": 52,\n      \"score\": 0.87,\n      \"snippet\": \"## API 讨论\\n决定为了简单起见使用REST而不是GraphQL...\",\n      \"source\": \"memory\"\n    }\n  ],\n  \"provider\": \"openai\",\n  \"model\": \"text-embedding-3-small\"\n}\n</code></pre>\n<h3 id=\"2-memory_get\">2. memory_get</h3>\n<p><strong>用途</strong>：在找到内容后读取具体内容</p>\n<pre><code class=\"language-json\">{\n  \"name\": \"memory_get\",\n  \"description\": \"在使用memory_search后，从记忆文件中读取特定行\",\n  \"parameters\": {\n    \"path\": \"memory/2026-01-20.md\",\n    \"from\": 45,\n    \"lines\": 15\n  }\n}\n</code></pre>\n<p><strong>返回结果</strong>：</p>\n<pre><code class=\"language-json\">{\n  \"path\": \"memory/2026-01-20.md\",\n  \"text\": \"## API 讨论\\n\\n与团队讨论API架构。\\n\\n### 决策\\n我们选择REST而非GraphQL，原因如下：\\n1. 实现更简单\\n2. 更好的缓存支持\\n3. 团队更熟悉\\n\\n### 端点\\n- GET /users\\n- POST /auth/login\\n- GET /projects/:id\"\n}\n</code></pre>\n<h3 id=\"写入记忆\">写入记忆</h3>\n<p>并没有专门的memory_write工具。Agent使用标准的写入和编辑工具来写入记忆——这些工具它本来就在用于处理任何文件。由于记忆就是普通的Markdown，你也可以手动编辑这些文件（它们会被自动重新索引）。</p>\n<p>写入位置的决策是通过AGENTS.md中的提示来驱动的：</p>\n<p>在预压缩刷新和会话结束时，也会自动进行写入（后续章节会介绍）。</p>\n<h2 id=\"记忆存储\">记忆存储</h2>\n<p>Clawdbot的记忆系统建立在\"记忆就是Agent工作空间中的纯Markdown\"这一原则之上。</p>\n<h3 id=\"双层记忆系统\">双层记忆系统</h3>\n<p>记忆位于Agent的工作空间中（默认：~/clawd/）：</p>\n<pre><code class=\"language-text\">~/clawd/\n├── MEMORY.md              - 第二层：长期策划的知识\n└── memory/\n    ├── 2026-01-26.md      - 第一层：今天的笔记\n    ├── 2026-01-25.md      - 昨天的笔记\n    ├── 2026-01-24.md      - ...以此类推\n    └── ...\n</code></pre>\n<p><strong>第一层：每日日志（memory/YYYY-MM-DD.md）</strong></p>\n<p>这些是仅追加的每日笔记，Agent会在一天中随时写入。当Agent想要记住某事，或被明确告知要记住某事时，就会写入这里。</p>\n<pre><code class=\"language-markdown\"># 2026-01-26\n\n## 10:30 AM - API 讨论\n与用户讨论REST vs GraphQL。决策：为了简单使用REST。\n关键端点：/users、/auth、/projects。\n\n## 2:15 PM - 部署\n将v2.3.0部署到生产环境。没有问题。\n\n## 4:00 PM - 用户偏好\n用户提到他们喜欢TypeScript胜过JavaScript。\n</code></pre>\n<p><strong>第二层：长期记忆（MEMORY.md）</strong></p>\n<p>这是经过策划的、持久的知识。当发生重大事件、想法、决策、观点和学到的教训时，Agent会写入这里。</p>\n<pre><code class=\"language-markdown\"># 长期记忆\n\n## 用户偏好\n- 喜欢TypeScript胜过JavaScript\n- 喜欢简洁的解释\n- 正在做\"Acme Dashboard\"项目\n\n## 重要决策\n- 2026-01-15：选择PostgreSQL作为数据库\n- 2026-01-20：采用REST而非GraphQL\n- 2026-01-26：使用Tailwind CSS进行样式设计\n\n## 关键联系人\n- Alice (alice@acme.com) - 设计负责人\n- Bob (bob@acme.com) - 后端工程师\n</code></pre>\n<h3 id=\"agent如何知道要读取记忆\">Agent如何知道要读取记忆</h3>\n<p><code>AGENTS.md</code>文件（会自动加载）包含以下指令：</p>\n<pre><code class=\"language-text\">## 每次会话\n\n在做其他事情之前：\n1. 阅读 SOUL.md - 这是你是谁\n2. 阅读 USER.md - 这是你在帮助谁\n3. 阅读 memory/YYYY-MM-DD.md（今天和昨天）获取近期上下文\n4. 如果是在主会话中（与你的主人直接聊天），还要阅读 MEMORY.md\n\n不要请求许可，直接做。\n</code></pre>\n<h2 id=\"记忆如何被索引\">记忆如何被索引</h2>\n<p>当你保存一个记忆文件时，后台会发生以下事情：</p>\n<pre><code class=\"language-text\">┌─────────────────────────────────────────────────────────────┐\n│  1. 文件保存                                                │\n│     ~/clawd/memory/2026-01-26.md                            │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  2. 文件监视器检测到变化                                    │\n│     Chokidar 监视 MEMORY.md + memory/**/*.md                │\n│     防抖1.5秒以批量处理快速写入                             │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  3. 分块                                                    │\n│     分割成约400 token的块，重叠80 token                     │\n│                                                             │\n│     ┌────────────────┐                                      │\n│     │ 块 1           │                                      │\n│     │ 第 1-15 行     │──────┐                               │\n│     └────────────────┘      │                               │\n│     ┌────────────────┐      │ (80 token 重叠)               │\n│     │ 块 2           │◄─────┘                               │\n│     │ 第 12-28 行    │──────┐                               │\n│     └────────────────┘      │                               │\n│     ┌────────────────┐      │                               │\n│     │ 块 3           │◄─────┘                               │\n│     │ 第 25-40 行    │                                      │\n│     └────────────────┘                                      │\n│                                                             │\n│     为什么用400/80？平衡语义连贯性与粒度。                  │\n│     重叠确保跨越块边界的事实能被两边捕获。                   │\n│     两个值都是可配置的。                                     │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  4. 嵌入                                                    │\n│     每个块 -&gt; 嵌入提供商 -&gt; 向量                            │\n│                                                             │\n│     \"讨论REST vs GraphQL\" -&gt;                                │\n│         OpenAI/Gemini/Local -&gt;                              │\n│         [0.12, -0.34, 0.56, ...]  (1536 维)                 │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  5. 存储                                                    │\n│     ~/.clawdbot/memory/&lt;agentId&gt;.sqlite                     │\n│                                                             │\n│     表：                                                    │\n│     - chunks (id, path, start_line, end_line, text, hash)   │\n│     - chunks_vec (id, embedding)      -&gt; sqlite-vec         │\n│     - chunks_fts (text)               -&gt; FTS5 全文搜索      │\n│     - embedding_cache (hash, vector)  -&gt; 避免重复嵌入       │\n└─────────────────────────────────────────────────────────────┘\n</code></pre>\n<blockquote>\n<p><strong>sqlite-vec</strong> 是一个SQLite扩展，它直接在SQLite中实现向量相似度搜索，无需外部向量数据库。</p>\n</blockquote>\n<blockquote>\n<p><strong>FTS5</strong> 是SQLite内置的全文搜索引擎，为BM25关键词匹配提供支持。两者结合，使Clawdbot能够从一个轻量级数据库文件中运行混合搜索（语义 + 关键词）。</p>\n</blockquote>\n<h2 id=\"记忆如何被搜索\">记忆如何被搜索</h2>\n<p>当你搜索记忆时，Clawdbot会并行运行两种搜索策略。向量搜索（语义）找到意思相同的内容，BM25搜索（关键词）找到包含确切token的内容。</p>\n<p>结果通过加权评分合并：</p>\n<pre><code class=\"language-text\">最终得分 = (0.7 * 向量得分) + (0.3 * 文本得分)\n</code></pre>\n<p>为什么是70/30？语义相似性是记忆回忆的主要信号，但BM25关键词匹配能捕捉向量可能遗漏的确切术语（名称、ID、日期）。低于minScore阈值（默认0.35）的结果会被过滤掉。所有这些值都是可配置的。</p>\n<p>这确保无论你是在搜索概念（\"那个数据库的事情\"）还是具体内容（\"POSTGRES_URL\"），都能获得良好的结果。</p>\n<h2 id=\"多agent记忆\">多Agent记忆</h2>\n<p>Clawdbot支持多个Agent，每个Agent都有完全独立的记忆：</p>\n<pre><code class=\"language-text\">~/.clawdbot/memory/              # 状态目录（索引）\n├── main.sqlite                  # \"main\" Agent的向量索引\n└── work.sqlite                  # \"work\" Agent的向量索引\n\n~/clawd/                         # \"main\" Agent工作空间（源文件）\n├── MEMORY.md\n└── memory/\n    └── 2026-01-26.md\n\n~/clawd-work/                    # \"work\" Agent工作空间（源文件）\n├── MEMORY.md\n└── memory/\n    └── 2026-01-26.md\n</code></pre>\n<p>Markdown文件（事实来源）位于每个工作空间中，而SQLite索引（派生数据）位于状态目录中。每个Agent都有自己的工作空间和索引。记忆管理器通过agentId + workspaceDir来区分，因此不会自动发生跨Agent记忆搜索。</p>\n<p><strong>Agent能读取彼此的记忆吗？</strong> 默认不能。每个Agent只能看到自己的工作空间。但是，工作空间是一个软沙盒（默认工作目录），而不是硬边界。除非启用严格的沙盒机制，否则Agent理论上可以使用绝对路径访问另一个工作空间。</p>\n<p>这种隔离对于分离上下文很有用。一个用于WhatsApp的\"个人\"Agent和一个用于Slack的\"工作\"Agent，各自拥有独立的记忆和个性。</p>\n<h3 id=\"压缩\">压缩</h3>\n<p>每个AI模型都有上下文窗口限制。Claude有20万token，GPT-5.1有100万。长对话最终会触及这个上限。</p>\n<p>当这种情况发生时，Clawdbot使用压缩：将旧对话总结为紧凑的条目，同时保留最近消息的完整性。</p>\n<pre><code class=\"language-text\">┌─────────────────────────────────────────────────────────────┐\n│  压缩前                                                     │\n│  上下文：180,000 / 200,000 token                            │\n│                                                             │\n│  [第1轮] 用户：\"我们建个API吧\"                              │\n│  [第2轮] Agent：\"好的！你需要什么端点？\"                    │\n│  [第3轮] 用户：\"用户和认证相关的\"                           │\n│  [第4轮] Agent：*创建了500行模式定义*                       │\n│  [第5轮] 用户：\"加上限流功能\"                               │\n│  [第6轮] Agent：*修改代码*                                  │\n│  ...（还有100多轮）...                                      │\n│  [第150轮] 用户：\"状态怎么样了？\"                           │\n│                                                             │\n│  ⚠️ 接近限制                                                │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  触发压缩                                                   │\n│                                                             │\n│  1. 将第1-140轮总结为紧凑摘要                               │\n│  2. 保留第141-150轮不变（近期上下文）                       │\n│  3. 将摘要持久化到JSONL转录文件                             │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  压缩后                                                     │\n│  上下文：45,000 / 200,000 token                             │\n│                                                             │\n│  [摘要] \"构建了带/users、/auth端点的REST API。              │\n│   实现了JWT认证、限流（100次/分钟）、PostgreSQL数据库。      │\n│   已部署到预发布环境v2.4.0。                                 │\n│   当前重点：生产环境部署准备。\"                              │\n│                                                             │\n│  [第141-150轮原样保留]                                      │\n│                                                             │\n└─────────────────────────────────────────────────────────────┘\n</code></pre>\n<h3 id=\"自动-vs-手动压缩\">自动 vs 手动压缩</h3>\n<p><strong>自动</strong>：当接近上下文限制时触发</p>\n<ul>\n<li>在详细模式下你会看到：🧹 自动压缩完成</li>\n<li>原始请求会用压缩后的上下文重试</li>\n</ul>\n<p><strong>手动</strong>：使用 /compact 命令</p>\n<pre><code>/compact 重点关注决策和未解决的问题\n</code></pre>\n<p>与某些优化不同，压缩会持久化到磁盘。摘要被写入会话的JSONL转录文件，因此未来的会话以压缩后的历史开始。</p>\n<h2 id=\"记忆刷新\">记忆刷新</h2>\n<p>基于LLM的压缩是一个有损过程。重要信息可能被总结掉并可能丢失。为了应对这一点，Clawdbot使用了预压缩记忆刷新。</p>\n<pre><code class=\"language-text\">┌─────────────────────────────────────────────────────────────┐\n│  上下文接近限制                                             │\n│                                                             │\n│  ████████████████████████████░░░░░░░░  上下文的75%         │\n│                              ↑                              │\n│                    超过软阈值                               │\n│                    (contextWindow - reserve - softThreshold)│\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  静默记忆刷新轮次                                           │\n│                                                             │\n│  系统：\"预压缩记忆刷新。现在存储持久的                      │\n│          记忆（使用 memory/YYYY-MM-DD.md）。                │\n│          如果没有要存储的，回复 NO_REPLY。\"                 │\n│                                                             │\n│  Agent：审查对话中的重要信息                                │\n│         将关键决策/事实写入记忆文件                         │\n│         -&gt; NO_REPLY（用户看不到任何内容）                   │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  安全进行压缩                                               │\n│                                                             │\n│  重要信息现在已在磁盘上                                     │\n│  压缩可以在不丢失知识的情况下进行                           │\n└─────────────────────────────────────────────────────────────┘\n</code></pre>\n<p>记忆刷新可以在clawdbot.yaml文件或clawdbot.json文件中配置。</p>\n<pre><code class=\"language-json\">{\n  \"agents\": {\n    \"defaults\": {\n      \"compaction\": {\n        \"reserveTokensFloor\": 20000,\n        \"memoryFlush\": {\n          \"enabled\": true,\n          \"softThresholdTokens\": 4000,\n          \"systemPrompt\": \"会话接近压缩。现在存储持久的记忆。\",\n          \"prompt\": \"将持久的笔记写入 memory/YYYY-MM-DD.md；如果没有要存储的，回复 NO_REPLY。\"\n        }\n      }\n    }\n  }\n}\n</code></pre>\n<h2 id=\"剪枝\">剪枝</h2>\n<p>工具结果可能非常庞大。单个exec命令可能输出5万个字符的日志。剪枝会修剪这些旧输出，而不重写历史。这是一个有损过程，旧输出无法恢复。</p>\n<pre><code class=\"language-text\">┌─────────────────────────────────────────────────────────────┐\n│  剪枝前（内存中）                                           │\n│                                                             │\n│  工具结果（exec）：[5万个字符的npm install输出]               │\n│  工具结果（read）：[大型配置文件，1万个字符]                  │\n│  工具结果（exec）：[构建日志，3万个字符]                      │\n│  用户：\"构建成功了吗？\"                                      │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼ （软修剪 + 硬清除）\n┌─────────────────────────────────────────────────────────────┐\n│  剪枝后（发送给模型）                                       │\n│                                                             │\n│  工具结果（exec）：\"npm WARN deprecated...[已截断]           │\n│                       ...成功安装。\"                        │\n│  工具结果（read）：\"[旧工具结果内容已清除]\"                   │\n│  工具结果（exec）：[保留 - 太新，不适合剪枝]                  │\n│  用户：\"构建成功了吗？\"                                      │\n└─────────────────────────────────────────────────────────────┘\n</code></pre>\n<p>磁盘上的JSONL文件：保持不变（完整输出仍然在那里）</p>\n<h3 id=\"缓存ttl剪枝\">缓存TTL剪枝</h3>\n<p>Anthropic会对提示词前缀进行最多5分钟的缓存，以减少重复调用的延迟和成本。当相同的提示词前缀在TTL窗口内发送时，缓存的token成本降低约90%。TTL过期后，下一个请求必须重新缓存整个提示词。</p>\n<p>问题：如果会话在TTL之后闲置，下一个请求会失去缓存，必须以完整的\"缓存写入\"价格重新缓存完整的对话历史。</p>\n<p>缓存TTL剪枝通过在缓存过期后检测并修剪旧工具结果来解决这个问题。更小的提示词重新缓存意味着更低的成本：</p>\n<pre><code class=\"language-json\">{\n  \"agent\": {\n    \"contextPruning\": {\n      \"mode\": \"cache-ttl\",\n      \"ttl\": \"600\",\n      \"keepLastAssistants\": 3,\n      \"softTrim\": {\n        \"maxChars\": 4000,\n        \"headChars\": 1500,\n        \"tailChars\": 1500\n      },\n      \"hardClear\": {\n        \"enabled\": true,\n        \"placeholder\": \"[旧工具结果内容已清除]\"\n      }\n    }\n  }\n}\n</code></pre>\n<h2 id=\"会话生命周期\">会话生命周期</h2>\n<p>会话不会永远持续。它们根据可配置的规则进行重置，为记忆创建自然的边界。默认行为是每天重置。但也有其他模式可用。</p>\n<h3 id=\"会话记忆钩子\">会话记忆钩子</h3>\n<p>当你运行 /new 开始一个新会话时，会话记忆钩子可以自动保存上下文：</p>\n<pre><code class=\"language-text\">/new\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  触发会话记忆钩子                                           │\n│                                                             │\n│  1. 从结束会话中提取最后15条消息                            │\n│  2. 通过LLM生成描述性slug                                   │\n│  3. 保存到 ~/clawd/memory/2026-01-26-api-design.md          │\n└─────────────────────────────────────────────────────────────┘\n                              │\n                              ▼\n┌─────────────────────────────────────────────────────────────┐\n│  新会话开始                                                 │\n│                                                             │\n│  之前的上下文现在可以通过 memory_search 搜索                │\n└─────────────────────────────────────────────────────────────┘\n</code></pre>\n<h2 id=\"总结\">总结</h2>\n<p>Clawdbot的记忆系统之所以成功，是因为它遵循了几个关键原则：</p>\n<p><strong>1. 透明优于黑盒</strong></p>\n<p>记忆是纯Markdown。你可以阅读、编辑、版本控制它。没有不透明数据库或专有格式。</p>\n<p><strong>2. 搜索优于注入</strong></p>\n<p>与其用所有内容塞满上下文，不如让Agent搜索相关内容。这保持上下文聚焦并降低成本。</p>\n<p><strong>3. 持久优于会话</strong></p>\n<p>重要信息作为文件保存在磁盘上，而不仅仅存在于对话历史中。压缩无法摧毁已经保存的内容。</p>\n<p><strong>4. 混合优于单一</strong></p>\n<p>纯向量搜索会漏掉精确匹配。纯关键词搜索会漏掉语义。混合搜索两者兼得。</p>\n<h2 id=\"参考资料\">参考资料</h2>\n<ul>\n<li>Clawdbot文档(<a href=\"https://docs.clawd.bot/\" rel=\"noopener nofollow\" target=\"_blank\">https://docs.clawd.bot/</a>) - 官方文档，涵盖设置、配置和所有功能</li>\n<li>GitHub仓库(<a href=\"https://github.com/clawdbot/clawdbot\" rel=\"noopener nofollow\" target=\"_blank\">https://github.com/clawdbot/clawdbot</a>) - 源代码、问题和社区贡献</li>\n</ul>\n<p>感谢阅读，如果对Vibe Coding和Agent开发感兴趣，也可以<a href=\"https://didispace.com/\" rel=\"noopener nofollow\" target=\"_blank\">关注我的博客：程序猿DD</a></p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 20:27</span>&nbsp;\n<a href=\"https://www.cnblogs.com/didispace\">程序猿DD</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "【保姆级教程】手把手教你安装OpenClaw并接入飞书，让AI在聊天软件里帮你干活",
      "link": "https://www.cnblogs.com/weipo0105/p/19558953",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n\t\t\t<a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/weipo0105/p/19558953\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 19:50\">\n    <span>【保姆级教程】手把手教你安装OpenClaw并接入飞书，让AI在聊天软件里帮你干活</span>\n    \n\n</a>\n\n\t\t</h1>\n\t\t<div class=\"clear\"></div>\n\t\t<div class=\"postBody\">\n\t\t\t    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        <img alt=\"【保姆级教程】手把手教你安装OpenClaw并接入飞书，让AI在聊天软件里帮你干活\" class=\"desc_img\" src=\"https://img2024.cnblogs.com/blog/1205021/202601/1205021-20260131195003333-854515303.png\" />\n        OpenClaw 是一款能直接操作你电脑的开源AI助手，不止于聊天，更能替你执行任务。本文提供一份保姆级教程，从零开始，详细演示如何在 Windows 系统上完成 OpenClaw 的安装、初始配置，并重点一步步教你接入飞书机器人，最终实现在飞书App中直接指挥你的AI助手处理工作。跟随图文指引，轻松拥有你的个人“贾维斯”。\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>这里先做一下简单的科普：</p>\n<p><code>OpenClaw</code> 的名字经历了三次变更，第一次叫做 <code>ClawdBot</code>，后来因为名字跟 <code>Claude</code> 太过相似，被 <code>CLaude</code> 告侵权，遂改名 <code>MoltBot</code> 。</p>\n<p>但是后来在改名过程中遭遇域名和社交账号被抢注，甚至出坑同名加密货币割韭菜的情况，导致名称传播受阻。</p>\n<p>最终定名为：<strong>OpenClaw</strong>。</p>\n<p>所以，名字经历先后顺序为：ClawdBot -&gt; MoltBot -&gt; OpenClaw</p>\n<p>大家不要因为名字困惑了，怀疑是不是自己下错软件了，他们都是同一个。</p>\n<h1 id=\"一什么是-openclaw\">一、什么是 OpenClaw？</h1>\n<p><strong>OpenClaw</strong>（曾用名 Clawdbot）是一款 2026 年爆火的开源个人 AI 助手，GitHub 星标已超过 10 万颗。与传统 AI 聊天机器人的根本区别在于：</p>\n<ul>\n<li><strong>真正的执行能力</strong>：不仅能回答问题，还能实际操作你的电脑</li>\n<li><strong>24/7 全天候待命</strong>：在你睡觉时也能主动完成任务</li>\n<li><strong>完全开源免费</strong>：数据完全掌控在自己手中</li>\n<li><strong>支持多种通讯平台</strong>：在国外，WhatsApp、Telegram、Discord、Slack、iMessage 等，在国内，飞书，钉钉等各大厂商的即时聊天软件已经支持接入</li>\n</ul>\n<p><strong>它能做什么？</strong></p>\n<p>它不只是回答问题的聊天机器人，而是真的能在你电脑上动手操作。比如你告诉它“帮我整理一下上个月的邮件”，它就默默去处理了；你睡觉时，它还能继续干活，退订广告、预约行程、甚至找找 Bug。</p>\n<p>它完全免费，你的数据都在自己手里。而且可以用钉钉，飞书，WhatsApp、Telegram等各类即时通讯软件来指挥他干活！</p>\n<p>简单来说，一句话交给它，从整理桌面文件到控制家里灯光，它都默默帮你搞定。是你电脑里真正的贾维斯！超级智能的AI助理！</p>\n<h1 id=\"二安装nodejs\">二、安装nodejs</h1>\n<p>后面执行一键安装命令，可以自动安装nodejs，但是如果为了加快速度，防止安装意外，可以先安装nodejs：</p>\n<p>官方下载地址：<a href=\"https://nodejs.org/zh-cn/download\" rel=\"noopener nofollow\" target=\"_blank\">https://nodejs.org/zh-cn/download</a><br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<h1 id=\"三开始安装\">三、开始安装</h1>\n<h3 id=\"一设置-powershell-执行权限\">一）设置 PowerShell 执行权限</h3>\n<p>以管理员身份运行 PowerShell：</p>\n<ol>\n<li>按 <code>Win</code> 键，搜索 <strong>PowerShell</strong></li>\n<li>右键点击 <strong>Windows PowerShell</strong></li>\n<li>选择 <strong>以管理员身份运行</strong></li>\n<li>点击 <strong>是</strong> 确认<br />\n<img alt=\"\" class=\"lazyload\" /></li>\n</ol>\n<p>在管理员 PowerShell 窗口中，依次执行以下两条命令：</p>\n<pre><code class=\"language-powershell\">Set-ExecutionPolicy RemoteSigned -Scope CurrentUser\n\nSet-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass\n</code></pre>\n<p><strong>这是什么意思？</strong></p>\n<ul>\n<li>第一条命令：允许当前用户运行本地和下载的脚本</li>\n<li>第二条命令：允许当前用户运行本地和下载的脚本</li>\n</ul>\n<blockquote>\n<p>⚠️ <strong>安全提示</strong>：这些命令只会影响您自己的账户，不会影响系统安全或其他用户。</p>\n</blockquote>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h3 id=\"二执行一键安装命令\">二）执行一键安装命令</h3>\n<p>复制以下命令，粘贴到 PowerShell 窗口中，按 <strong>Enter</strong> 执行：</p>\n<pre><code class=\"language-powershell\">iwr -useb https://openclaw.ai/install.ps1 | iex\n</code></pre>\n<p><strong>安装过程会自动完成：</strong></p>\n<ul>\n<li>检测系统环境</li>\n<li>安装必要依赖（Node.js 等）</li>\n<li>下载 OpenClaw 核心文件</li>\n<li>配置环境变量</li>\n<li>启动配置向导</li>\n</ul>\n<blockquote>\n<p>注意：如果命令执行后，还是报错，可以自己到官网下载node安装包，自己安装node环境，注意版本最好在 node v22.x 以上，node官网下载地址：<a href=\"https://nodejs.org/zh-cn/download%EF%BC%8C%E8%8B%A5%E8%BF%98%E6%98%AF%E4%B8%8D%E6%87%82%E6%80%8E%E4%B9%88%E5%AE%89%E8%A3%85%EF%BC%8C%E7%82%B9%E5%A4%B4%E5%83%8F%E8%BF%9B%E6%88%91%E4%B8%BB%E9%A1%B5%E6%89%BE%E5%88%B0%E6%88%91%EF%BC%8C%E6%8B%89%E4%BD%A0%E8%BF%9B%E4%BA%A4%E6%B5%81%E7%BE%A4\" rel=\"noopener nofollow\" target=\"_blank\">https://nodejs.org/zh-cn/download，若还是不懂怎么安装，点头像进我主页找到我，拉你进交流群</a></p>\n</blockquote>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h1 id=\"四初始配置向导\">四、初始配置向导</h1>\n<p>安装完成后，会自动进入配置向导（<code>openclaw onboard</code>）。</p>\n<h2 id=\"一风险告知\">一）风险告知</h2>\n<p>这一步主要是告诉你，使用OpenClaw可能会有一些风险。请问你是否继续？<br />\n按 向左方向键 ←，选择 <code>Yes</code>，按 <code>Enter</code> 回车确认<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"二选择-qiuickstart-模式\">二）选择 QiuickStart 模式</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"三配置-ai-模型-api-key\">三）配置 AI 模型 API Key</h2>\n<p>OpenClaw 需要连接到大语言模型才能工作。Openclaw 比较费token，国外模型成本高，门槛也高，这里我选择国内的智谱的 GLM 4.7</p>\n<blockquote>\n<p>如果没有智谱的API Key，点击官方地址自己注册账号获取API key：<a href=\"https://www.bigmodel.cn/glm-coding?ic=RBSKXMPNJP\" rel=\"noopener nofollow\" target=\"_blank\">https://www.bigmodel.cn/glm-coding?ic=RBSKXMPNJP</a></p>\n</blockquote>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>输入自己的 API Key：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"四选择-ai-模型\">四）选择 AI 模型</h2>\n<blockquote>\n<p>这里我选择默认的GLM 4.7，也是智普当前的旗舰模型</p>\n</blockquote>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"五连接即时通讯平台\">五）连接即时通讯平台</h2>\n<p>配置完 AI 模型后，OpenClaw 会询问你要连接哪个通讯平台？</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<blockquote>\n<p>OpenClaw 原生支持的即时通信平台主要是海外的 WhatsApp、Telegram、Discord、Slack、iMessage 等，国内用户不习惯，这里国产即时通信软件大厂也跟进了，现在钉钉，飞书等都已支持接入OpenClaw</p>\n</blockquote>\n<p>后面会带领大家把飞书机器人接入 OpenClaw，使大家可以通过飞书即可指挥OpenClaw为我们干活，但是飞书配置比较复杂，这里我们先选择跳过，后面我们可以通过继续进行配置：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"六选择skills\">六）选择Skills</h2>\n<p>这里也选择：No，暂不配置，后面通过UI界面进行配置：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"七是否开启hooks\">七）是否开启Hooks</h2>\n<p>操作步骤：先敲<strong>空格</strong>，表示选中当前项，再敲回车键</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"八启动服务并打开ui界面\">八）启动服务并打开UI界面</h2>\n<p>此时它会自动再打开一个命令窗口来启动服务:</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<blockquote>\n<p>这个过程是在启动服务，可能会需要等一点时间</p>\n</blockquote>\n<p>同时，大约过30秒左右，我们回到刚才的设置窗口，选择 <code>Open the Web UI</code> ，打开 <code>OpenClaw</code> 的UI界面：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>浏览器自动打开Web UI界面：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"九测试一下\">九）测试一下</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h1 id=\"五接入飞书机器人\">五、接入飞书机器人</h1>\n<p>我们需要先到飞书平台创建自己的机器人来接入OpenClaw：</p>\n<h2 id=\"一来到飞书开发者后台\">一）来到飞书开发者后台</h2>\n<p>飞书开放平台地址：<a href=\"https://open.feishu.cn\" rel=\"noopener nofollow\" target=\"_blank\">https://open.feishu.cn</a></p>\n<blockquote>\n<p>没有飞书账号的，需要自己注册账号</p>\n</blockquote>\n<p>点击右上角进入 <strong>开发者后台</strong>：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"二创建应用\">二）创建应用</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"三填写应用信息\">三）填写应用信息</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"四获取自己的应用凭证\">四）获取自己的应用凭证</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"五给应用添加机器人\">五）给应用添加机器人</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"六给应用配置权限\">六）给应用配置权限</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>把即时通讯相关的权限全部开通：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"七创建版本并发布\">七）创建版本并发布</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>来到飞书客户端进行审批：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"八安装飞书插件\">八）安装飞书插件</h2>\n<p>打开powershell，输入以下命令，安装飞书插件：</p>\n<pre><code>openclaw plugins install @m1heng-clawd/feishu\n</code></pre>\n<p>安装成功后，再打开一个新的命令窗口，开始配置飞书插件：</p>\n<p>输入命令：<code>openclaw config</code></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>选择渠道:<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>选择配置链接:<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>输入飞书的AppID，AppSecrect：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>域名选择中国的：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>接受群组聊天：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>选择完成：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>选择yes：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>选择open：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>选择继续，完成配置：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>重启服务，使配置生效：<br />\n控制可以看到飞书插件已经配置成功<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<h2 id=\"七回到飞书后台设置事件回调\">七）回到飞书后台设置事件回调</h2>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>选择 <code>使用长连接接收事件</code> ：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>可以看到添加事件按钮由原来的灰色不可点击变为可点击：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>添加接收消息事件：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>给应用开通获取通讯录基本信息的权限：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>重新发布版本：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>跟前面的步骤一样，发布为在线应用即可。</p>\n<p>现在可以在 飞书中与 AI 助手对话了！</p>\n<h2 id=\"八在飞书中与openclaw对话\">八）在飞书中与OpenClaw对话</h2>\n<p>来到飞书客户端或者手机飞书app上：</p>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>以下是openclaw文件夹下面的文档内的内容：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<p>现在我跟废水机器人对话，让他告诉我指定文档内是什么内容：<br />\n<img alt=\"\" class=\"lazyload\" /></p>\n<hr />\n<h1 id=\"六访问-web-控制面板\">六、访问 Web 控制面板</h1>\n<p>配置完成后，PowerShell 窗口底部会显示控制面板链接，格式类似：</p>\n<pre><code>Control UI: http://127.0.0.1:18789\n</code></pre>\n<ol>\n<li>复制完整链接</li>\n<li>在浏览器中打开</li>\n<li>即可看到可视化UI管理界面</li>\n</ol>\n<hr />\n<h1 id=\"七常用命令速查\">七、常用命令速查</h1>\n<table>\n<thead>\n<tr>\n<th>命令</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>openclaw onboard</code></td>\n<td>重新进入配置向导</td>\n</tr>\n<tr>\n<td><code>openclaw status</code></td>\n<td>查看运行状态</td>\n</tr>\n<tr>\n<td><code>openclaw health</code></td>\n<td>健康检查</td>\n</tr>\n<tr>\n<td><code>openclaw gateway start</code></td>\n<td>启动服务</td>\n</tr>\n<tr>\n<td><code>openclaw gateway stop</code></td>\n<td>停止服务</td>\n</tr>\n<tr>\n<td><code>openclaw update</code></td>\n<td>更新到最新版本</td>\n</tr>\n<tr>\n<td><code>openclaw doctor</code></td>\n<td>诊断问题</td>\n</tr>\n<tr>\n<td><code>openclaw uninstall</code></td>\n<td>卸载 OpenClaw</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h1 id=\"八常见问题解答\">八、常见问题解答</h1>\n<h3 id=\"q1-安装飞书插件提示spawn-npm-enoent\">Q1: 安装飞书插件提示：spawn npm ENOENT</h3>\n<p><img alt=\"\" class=\"lazyload\" /></p>\n<p>问题原因：这可能是openclaw的一个bug，可以等官方更新，也可以自己去官方仓库提issue</p>\n<p>解决步骤：</p>\n<p>定位问题代码</p>\n<p>文件路径：</p>\n<pre><code>C:\\Users\\Administrator\\AppData\\Roaming\\fnm\\node-versions\\v22.14.0\\installation\\node_modules\\openclaw\\dist\\process\\exec.js\n</code></pre>\n<p>修改代码</p>\n<p>找到 <code>runCommandWithTimeout</code> 函数中的 spawn 调用，修改如下：</p>\n<p><strong>修改前：</strong></p>\n<pre><code class=\"language-javascript\">const stdio = resolveCommandStdio({ hasInput, preferInherit: true });\nconst child = spawn(argv[0], argv.slice(1), {\n    stdio,\n    cwd,\n    env: resolvedEnv,\n    windowsVerbatimArguments,\n});\n</code></pre>\n<p><strong>修改后：</strong></p>\n<pre><code class=\"language-javascript\">const stdio = resolveCommandStdio({ hasInput, preferInherit: true });\n// On Windows, npm must be spawned with shell: true or use .cmd extension\nlet command = argv[0];\nlet useShell = false;\nif (process.platform === \"win32\" &amp;&amp; path.basename(command) === \"npm\") {\n    useShell = true;\n}\nconst child = spawn(command, argv.slice(1), {\n    stdio,\n    cwd,\n    env: resolvedEnv,\n    shell: useShell,\n});\n</code></pre>\n<h3 id=\"q2-提示-openclaw-命令找不到\">Q2: 提示 \"openclaw 命令找不到\"</h3>\n<p><strong>解决方法：</strong></p>\n<ol>\n<li>关闭所有 PowerShell 窗口</li>\n<li>重新打开 PowerShell</li>\n<li>如果还不行，执行 <code>exec bash</code> 或重启电脑</li>\n</ol>\n<h3 id=\"q3-安装卡住不动\">Q3: 安装卡住不动</h3>\n<p><strong>解决方法：</strong></p>\n<ol>\n<li>按 <code>Ctrl + C</code> 中断当前操作</li>\n<li>执行：<code>openclaw doctor</code> 检查问题</li>\n<li>如提示网络问题，检查防火墙设置</li>\n</ol>\n<h3 id=\"q4-api-key-配置错误\">Q4: API Key 配置错误</h3>\n<p><strong>解决方法：</strong></p>\n<ol>\n<li>执行：<code>openclaw onboard</code></li>\n<li>选择重新配置 API Key</li>\n<li>确保密钥格式正确</li>\n</ol>\n<h3 id=\"q5-端口-18789-被占用\">Q5: 端口 18789 被占用</h3>\n<p><strong>解决方法：</strong></p>\n<pre><code class=\"language-powershell\">openclaw gateway --port 18790\n</code></pre>\n<p>使用其他端口启动服务。</p>\n<h1 id=\"九成本说明\">九、成本说明</h1>\n<p>OpenClaw 软件本身完全免费，主要成本来自 AI 模型 API 调用，可选择国产大模型，降低成本。</p>\n<hr />\n<h1 id=\"结语\">结语</h1>\n<p>OpenClaw 代表了个人 AI 助理的未来趋势——从\"聊天工具\"进化为\"执行工具\"。虽然目前的配置过程对小白用户有一定门槛，但一旦完成设置，您将拥有一个 24/7 待命的超级助手。</p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n\t\t</div>\n\t\t<div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 19:50</span>&nbsp;\n<a href=\"https://www.cnblogs.com/weipo0105\">阿坡RPA</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "Redis快速实现布隆过滤器：缓存去重的“智能门卫”",
      "link": "https://www.cnblogs.com/sun-10387834/p/19522155",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/sun-10387834/p/19522155\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 18:32\">\n    <span>Redis快速实现布隆过滤器：缓存去重的“智能门卫”</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>在缓存架构中，总有一些“头疼问题”：用户反复提交相同请求、查询不存在的key导致缓存穿透、海量数据去重效率低下……这些场景下，Redis布隆过滤器就是当之无愧的“救星”。它像一个智能门卫，能快速判断“这个人是不是来过”“这个key是不是不存在”，用极小的空间成本实现高效过滤，性能远超传统的数据库查询或全量缓存校验。</p>\n<p>今天咱们就从“是什么、为什么好用、怎么用Redis快速实现”三个维度，用通俗的语言+实操代码，把布隆过滤器讲透。全程避开复杂公式，就算是刚接触缓存的同学，也能跟着步骤快速落地。</p>\n<h2 id=\"一先搞懂布隆过滤器到底是个啥\">一、先搞懂：布隆过滤器到底是个啥？</h2>\n<p>布隆过滤器（Bloom Filter）本质是一个<strong>基于哈希函数的概率型数据结构</strong>，核心作用是“快速判断一个元素是否存在于集合中”。它不像哈希表那样存储完整数据，而是用一个二进制数组（bit数组）+多个哈希函数，通过标记元素的哈希位置来实现过滤。</p>\n<p>咱们用“小区门卫记访客”的场景类比，秒懂核心逻辑：</p>\n<ul>\n<li>\n<p>二进制数组 = 门卫的登记本，每一页只有“是”（1）和“否”（0）两个状态；</p>\n</li>\n<li>\n<p>哈希函数 = 门卫的“记忆规则”，比如“记住访客的姓氏首字母+身高区间+鞋子颜色”；</p>\n</li>\n<li>\n<p>元素存在判断 = 门卫根据记忆规则核对登记本，只要有一条规则对应“否”，就确定访客没来过；如果全是“是”，则大概率来过（存在极小误判）。</p>\n</li>\n</ul>\n<h3 id=\"核心特性优点与小瑕疵\">核心特性：优点与“小瑕疵”</h3>\n<p>布隆过滤器的优势和局限性都很鲜明，落地前必须摸清：</p>\n<h4 id=\"-核心优点\">✅ 核心优点</h4>\n<ul>\n<li>\n<p>空间占用极小：仅用bit数组存储标记，存储100万条数据，误判率1%时，仅需约1.2MB空间；</p>\n</li>\n<li>\n<p>查询速度极快：时间复杂度是O(k)（k是哈希函数个数），无论数据量多大，都能瞬间返回结果；</p>\n</li>\n<li>\n<p>支持海量数据：无需存储完整数据，可轻松应对千万级、亿级数据的过滤场景。</p>\n</li>\n</ul>\n<h4 id=\"-不可忽视的局限性\">❌ 不可忽视的局限性</h4>\n<ul>\n<li>\n<p>存在误判率：只能确定“元素一定不存在”，不能100%确定“元素一定存在”，误判率可通过参数调整，但无法完全消除；</p>\n</li>\n<li>\n<p>不支持删除操作：一旦元素被标记到bit数组，无法反向清除（会影响其他元素的判断）；</p>\n</li>\n<li>\n<p>需提前预估数据量：哈希函数个数、bit数组长度需根据预估数据量计算，否则会导致误判率飙升。</p>\n</li>\n</ul>\n<h2 id=\"二redis实现布隆过滤器的两种方式\">二、Redis实现布隆过滤器的两种方式</h2>\n<p>Redis本身没有内置布隆过滤器，但提供了两种快速实现的方案：一是基于Redis的BitMap（位图）手动实现，灵活可控；二是使用Redis官方推荐的Redisson客户端，封装好现成API，开箱即用。咱们分别讲实操，按需选择即可。</p>\n<h3 id=\"方案一基于bitmap手动实现灵活可控\">方案一：基于BitMap手动实现（灵活可控）</h3>\n<p>核心思路：利用Redis的BitMap数据结构作为布隆过滤器的bit数组，通过多个哈希函数计算元素的哈希值，将对应位置的bit置为1；查询时，同样计算哈希值，检查所有位置是否为1，全为1则大概率存在，否则一定不存在。</p>\n<h4 id=\"1-关键参数计算避免误判率过高\">1. 关键参数计算（避免误判率过高）</h4>\n<p>手动实现前，需先确定三个核心参数，可通过公式或在线工具计算：</p>\n<ul>\n<li>\n<p>m：bit数组长度（单位：bit），预估数据量n越大，m需越大；</p>\n</li>\n<li>\n<p>k：哈希函数个数，k过多会导致bit数组快速被占满，误判率上升；k过少则过滤效果差；</p>\n</li>\n<li>\n<p>p：可接受的误判率（通常设为0.01~0.1）。</p>\n</li>\n</ul>\n<p>常用计算公式（无需死记，在线工具直接算）：</p>\n<ul>\n<li>\n<p>m = - (n * ln p) / (ln 2)² （bit数组长度）；</p>\n</li>\n<li>\n<p>k = (m / n) * ln 2 （哈希函数个数）。</p>\n</li>\n</ul>\n<p>举个例子：预估存储10万条数据，误判率设为0.01，计算得m≈958505 bit（约117KB），k≈7个哈希函数。</p>\n<h4 id=\"2-手动实现代码java示例\">2. 手动实现代码（Java示例）</h4>\n<p>核心是实现多个哈希函数，操作Redis的BitMap指令（SETBIT置1，GETBIT查询）：</p>\n<pre><code class=\"language-java\">import org.springframework.data.redis.core.StringRedisTemplate;\nimport java.nio.charset.StandardCharsets;\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\n\n/**\n * 基于Redis BitMap手动实现布隆过滤器\n */\npublic class RedisBloomFilter {\n    // Redis键名\n    private final String key;\n    // bit数组长度\n    private final long bitSize;\n    // 哈希函数个数\n    private final int hashCount;\n    private final StringRedisTemplate stringRedisTemplate;\n\n    // 构造器：初始化参数\n    public RedisBloomFilter(String key, long n, double p, StringRedisTemplate stringRedisTemplate) {\n        this.key = key;\n        this.stringRedisTemplate = stringRedisTemplate;\n        // 计算bit数组长度\n        this.bitSize = (long) (-n * Math.log(p) / (Math.log(2) * Math.log(2)));\n        // 计算哈希函数个数\n        this.hashCount = (int) (this.bitSize / n * Math.log(2));\n    }\n\n    // 添加元素到布隆过滤器\n    public void add(Object value) {\n        byte[] bytes = value.toString().getBytes(StandardCharsets.UTF_8);\n        long[] hashes = hash(bytes, hashCount, bitSize);\n        for (long hash : hashes) {\n            // 把对应bit位置置为1\n            stringRedisTemplate.opsForValue().setBit(key, hash, true);\n        }\n    }\n\n    // 判断元素是否存在（存在返回true，不存在返回false；true可能是误判）\n    public boolean contains(Object value) {\n        byte[] bytes = value.toString().getBytes(StandardCharsets.UTF_8);\n        long[] hashes = hash(bytes, hashCount, bitSize);\n        for (long hash : hashes) {\n            // 只要有一个bit位为0，就确定不存在\n            if (!stringRedisTemplate.opsForValue().getBit(key, hash)) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    // 多哈希函数实现（基于MD5拆分）\n    private long[] hash(byte[] bytes, int hashCount, long bitSize) {\n        long[] hashes = new long[hashCount];\n        try {\n            MessageDigest md5 = MessageDigest.getInstance(\"MD5\");\n            byte[] digest = md5.digest(bytes);\n            // 把MD5结果（16字节）拆分成多个哈希值\n            for (int i = 0; i &lt; hashCount; i++) {\n                long hash = 0;\n                for (int j = i * 2; j &lt; (i + 1) * 2 &amp;&amp; j &lt; digest.length; j++) {\n                    hash = hash * 256 + (digest[j] &amp; 0xFF);\n                }\n                // 确保哈希值在bit数组长度范围内\n                hashes[i] = hash % bitSize;\n            }\n        } catch (NoSuchAlgorithmException e) {\n            throw new RuntimeException(\"哈希函数初始化失败\", e);\n        }\n        return hashes;\n    }\n}\n</code></pre>\n<h4 id=\"3-使用方式\">3. 使用方式</h4>\n<pre><code class=\"language-java\">// 初始化布隆过滤器：key为\"user:bloom:filter\"，预估10万条数据，误判率0.01\nRedisBloomFilter bloomFilter = new RedisBloomFilter(\"user:bloom:filter\", 100000, 0.01, stringRedisTemplate);\n\n// 添加元素\nbloomFilter.add(\"user123\");\nbloomFilter.add(\"order456\");\n\n// 判断元素是否存在\nboolean exists = bloomFilter.contains(\"user123\"); // 大概率返回true\nboolean notExists = bloomFilter.contains(\"user789\"); // 一定返回false\n</code></pre>\n<h3 id=\"方案二redisson客户端实现开箱即用\">方案二：Redisson客户端实现（开箱即用）</h3>\n<p>如果觉得手动实现麻烦，推荐用Redisson——Redis官方生态的Java客户端，已经封装好了布隆过滤器，支持自动计算参数、分布式场景，还解决了手动实现的哈希函数优化问题，生产环境首选。</p>\n<h4 id=\"1-引入依赖\">1. 引入依赖</h4>\n<pre><code class=\"language-xml\">&lt;dependency&gt;\n    &lt;groupId&gt;org.redisson&lt;/groupId&gt;\n    &lt;artifactId&gt;redisson-spring-boot-starter&lt;/artifactId&gt;\n    &lt;version&gt;3.23.3&lt;/version&gt; // 版本与Redis版本适配\n&lt;/dependency&gt;\n</code></pre>\n<h4 id=\"2-快速实现代码\">2. 快速实现代码</h4>\n<pre><code class=\"language-java\">import org.redisson.api.RBloomFilter;\nimport org.redisson.api.RedissonClient;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class RedissonBloomFilterDemo {\n    @Autowired\n    private RedissonClient redissonClient;\n\n    // 初始化布隆过滤器\n    public RBloomFilter&lt;String&gt; initBloomFilter() {\n        // 布隆过滤器名称\n        String filterName = \"user:bloom:filter:redisson\";\n        // 获取布隆过滤器实例\n        RBloomFilter&lt;String&gt; bloomFilter = redissonClient.getBloomFilter(filterName);\n        // 初始化：预估10万条数据，误判率0.01（Redisson会自动计算m和k）\n        bloomFilter.tryInit(100000, 0.01);\n        return bloomFilter;\n    }\n\n    // 测试使用\n    public void testBloomFilter() {\n        RBloomFilter&lt;String&gt; bloomFilter = initBloomFilter();\n        // 添加元素\n        bloomFilter.add(\"user123\");\n        bloomFilter.add(\"order456\");\n\n        // 判断元素是否存在\n        boolean exists = bloomFilter.contains(\"user123\"); // 大概率true\n        boolean notExists = bloomFilter.contains(\"user789\"); // 一定false\n\n        // 统计已添加元素数量（近似值）\n        long count = bloomFilter.count();\n        System.out.println(\"已添加元素数量：\" + count);\n    }\n}\n</code></pre>\n<h4 id=\"3-核心优势\">3. 核心优势</h4>\n<ul>\n<li>\n<p>分布式支持：适配微服务场景，多实例共享同一个布隆过滤器，无需担心数据一致性；</p>\n</li>\n<li>\n<p>参数优化：内置更高效的哈希函数（MurmurHash），误判率控制更精准；</p>\n</li>\n<li>\n<p>API丰富：支持元素计数、批量添加等功能，比手动实现更完善。</p>\n</li>\n</ul>\n<h2 id=\"三实际应用场景与避坑指南\">三、实际应用场景与避坑指南</h2>\n<h3 id=\"-典型应用场景\">✅ 典型应用场景</h3>\n<ol>\n<li>\n<p>缓存穿透防护：查询数据库前，先用布隆过滤器判断key是否存在，不存在则直接返回，避免大量无效数据库查询；</p>\n</li>\n<li>\n<p>海量数据去重：比如用户签到、日志去重、爬虫URL去重，无需存储全量数据，仅用bit数组标记；</p>\n</li>\n<li>\n<p>防止重复提交：接口请求前，用布隆过滤器判断请求ID是否已处理，避免重复业务逻辑执行；</p>\n</li>\n<li>\n<p>黑名单过滤：比如垃圾邮件识别、恶意IP拦截，快速判断是否在黑名单中。</p>\n</li>\n</ol>\n<h3 id=\"-避坑指南\">❌ 避坑指南</h3>\n<ul>\n<li>\n<p>不要用在“绝对不能误判”的场景：比如金融交易、用户登录验证，误判可能导致严重问题；</p>\n</li>\n<li>\n<p>提前预估数据量：若实际数据量远超预估，bit数组会被快速占满，误判率会急剧上升，可预留2~3倍冗余；</p>\n</li>\n<li>\n<p>定期重置布隆过滤器：若数据有过期特性（比如每日黑名单更新），可定期删除旧的布隆过滤器，重建新实例；</p>\n</li>\n<li>\n<p>Redis集群注意事项：手动实现的布隆过滤器若用在Redis集群中，需确保key落在同一个节点（避免哈希分片导致bit数组分散），Redisson已自动处理该问题。</p>\n</li>\n</ul>\n<h2 id=\"四总结什么时候选哪种实现方式\">四、总结：什么时候选哪种实现方式？</h2>\n<p>Redis布隆过滤器的核心价值的是“用极小空间换极高过滤效率”，落地时按场景选择实现方式：</p>\n<ul>\n<li>\n<p>快速落地、生产环境、分布式场景：选Redisson，省心高效，适配性强；</p>\n</li>\n<li>\n<p>学习研究、自定义哈希函数、特殊参数需求：选手动实现，灵活可控，加深对原理的理解。</p>\n</li>\n</ul>\n<p>其实布隆过滤器的逻辑并不复杂，核心就是“哈希标记+概率判断”。掌握它之后，面对缓存穿透、海量去重等问题，就不用再靠“全量存储”这种笨办法，能大幅提升系统性能和空间利用率。下次再遇到类似场景，直接掏出Redis布隆过滤器，轻松搞定！</p>\n\n\n</div>\n<div id=\"MySignature\">\n    \n<p>❤️ 如果你喜欢这篇文章，请点赞支持！ 👍 同时欢迎关注我的博客，获取更多精彩内容！</p>\n\n<p>本文来自博客园，作者：<a href=\"https://www.cnblogs.com/sun-10387834/\" target=\"_blank\">佛祖让我来巡山</a>，转载请注明原文链接：<a href=\"https://www.cnblogs.com/sun-10387834/p/19522155\" target=\"_blank\">https://www.cnblogs.com/sun-10387834/p/19522155</a></p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 18:32</span>&nbsp;\n<a href=\"https://www.cnblogs.com/sun-10387834\">佛祖让我来巡山</a>&nbsp;\n阅读(<span id=\"post_view_count\">48</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "架构师必备：灰度方案汇总",
      "link": "https://www.cnblogs.com/toplist/p/19527704",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/toplist/p/19527704\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 17:35\">\n    <span>架构师必备：灰度方案汇总</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>大家好，我是Java烘焙师。本文结合笔者的经验和思考，对灰度方案做个总结，重点介绍AB实验。</p>\n<p>灰度在开发流程中非常普遍。先做小流量验证，确认无误后再推全，灰度过程中一旦发现系统异常、或业务指标异常，应立刻回滚。</p>\n<h1 id=\"灰度场景\">灰度场景</h1>\n<ul>\n<li>代码灰度：是最典型的灰度，灰度内做新逻辑，灰度外做旧逻辑\n<ul>\n<li>既可以提供v2版本新接口给调用方服务，由调用方来做灰度切换</li>\n<li>也可以内部切灰度，做到调用方无感</li>\n</ul>\n</li>\n<li>发版灰度：上线过程中，新版本服务实例不断增加，需考虑兼容新旧协议</li>\n<li>配置灰度：修改配置时，按服务实例灰度推送配置变更</li>\n</ul>\n<h1 id=\"灰度模式\">灰度模式</h1>\n<ul>\n<li>数字id尾号灰度：取id最后2位（百分比）、最后3位（千分比）、最后4位（万分比）等\n<ul>\n<li>实现方式：id取模，例如 <code>id % 100 &lt; 灰度百分比</code>，则命中灰度</li>\n<li>特点：简单，适用于绝大部分技术优化场景</li>\n</ul>\n</li>\n<li>随机灰度：取一部分随机流量做灰度\n<ul>\n<li>实现方式：<code>ThreadLocalRandom.current().nextInt(100) &lt; 灰度百分比</code></li>\n<li>之所以使用ThreadLocalRandom、而不是Random，是为了避免多线程竞争用于生成随机数的seed</li>\n</ul>\n</li>\n<li>A/B实验\n<ul>\n<li>实现方式：分层实验、实验数据收集、离线统计</li>\n<li>特点：适用于小流量验证新业务功能的效果，整体方案相对复杂，需要技术基建</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"id选取\">id选取</h1>\n<ul>\n<li>业务id：如用户id、商品id等</li>\n<li>设备id：未注册/未登录用户，此时没有用户id，只能取设备的唯一标识</li>\n</ul>\n<p>下面重点介绍一下A/B实验。</p>\n<h1 id=\"ab实验\">A/B实验</h1>\n<h2 id=\"目的\">目的</h2>\n<ul>\n<li>小流量验证新业务功能，正向显著则推至全量，否则继续迭代优化、或下线，避免功能过于臃肿</li>\n<li>用数据作为依据，避免想当然、拍脑袋决策</li>\n</ul>\n<h2 id=\"分层实验\">分层实验</h2>\n<p>主要目的是为了同时做多个实验，而不是给每个实验均分一部分流量。因为当同时进行的实验变多时，组合数量成倍增加，每个实验分到的流量就很少了。<br />\n有这几层结构：实验层、实验、分组</p>\n<ul>\n<li>实验层之间正交，可同时进行多个实验层的实验</li>\n<li>同一实验层的实验之间互斥，比如命中了实验1-1，就不会命中实验1-2。实验持有0到多个分桶，根据业务id可计算出桶号，进而知道命中哪个实验</li>\n<li>同一实验内有多个分组，包括1个对照组，和1到多个实验组，只会命中其中一个分组。分组持有0到多个分桶，根据业务id可计算出桶号，进而知道命中哪个分组</li>\n</ul>\n<p>实验层、实验举例：</p>\n<ul>\n<li>展示实验层：根据页面进行划分，如首页、搜索页、推荐页、详情页等。每个页面作为一个实验层，每个实验层里可同时做多个展示实验</li>\n<li>算法实验层：根据场景进行划分，如相似推荐、搭配购推荐、个性化推荐、搜索排序、广告排序等。每个场景作为一个实验层，每个实验层里可同时做多个算法实验</li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1247698/202601/1247698-20260127012326894-198795136.png\" /></p>\n<h2 id=\"哈希算法打散\">哈希算法打散</h2>\n<p>要同时支持多个分层实验，核心在于通过哈希算法将每一层的流量打散，用于实现“均匀分流”和“层间正交”，使得流量在各个实验的效果正负抵消，才能得到真实的对比结果。<br />\n以下是计算实验层桶号的代码示例，实验桶号同理：</p>\n<pre><code class=\"language-java\">import com.google.common.hash.Hashing;\nimport java.nio.charset.StandardCharsets;\n\npublic class ABTestRouter {\n\n    /**\n     * 根据用户ID和实验层ID（实验层ID充当盐的角色），计算桶号 (0-99)\n     */\n    public static int getBucket(String userId, String layerId) {\n        // 1. 拼接 Key: \"layerId:userId\"\n        String key = layerId + \":\" + userId;\n\n        // 2. 使用 MurmurHash3 (32-bit)\n        // Guava 的 murmur3_32_fixed 是线程安全的\n        int hash = Hashing.murmur3_32_fixed()\n                .hashString(key, StandardCharsets.UTF_8)\n                .asInt();\n\n        // 3. 取模并确保结果为正数\n        // Math.abs(Integer.MIN_VALUE) 会返回负数，所以推荐使用位运算去除符号位\n        return (hash &amp; Integer.MAX_VALUE) % 100;\n    }\n\n    public static void main(String[] args) {\n        String uid = \"user_123456\";\n        \n        // 不同层的流量是正交的（打散重新分配）\n        System.out.println(\"展示层桶号: \" + getBucket(uid, \"layer_ui\"));\n        System.out.println(\"算法层桶号: \" + getBucket(uid, \"layer_algo\"));\n    }\n}\n</code></pre>\n<p>之所以用murmurhash，而非md5，是因为md5是加密算法，计算开销更大，在AB实验中仅需均匀打散即可，无需担心根据哈希结果反推原文。<br />\n之所以把实验层id作为盐，是因为微小的输入差异都会导致哈希结果相差巨大，实现打散的效果。</p>\n<h2 id=\"实验数据收集\">实验数据收集</h2>\n<p>实验数据收集流程如下：</p>\n<ul>\n<li>在AB实验管理系统中配置实验信息：如实验盐值、桶号与实验组的映射关系等，可动态修改</li>\n<li>代码逻辑开发：\n<ul>\n<li>引入实验sdk，sdk在启动、或配置变更时拉取实验信息，本地计算业务id的桶号，进而得到命中的分组</li>\n<li>对照组做当前逻辑，实验组1做逻辑1，实验组2做逻辑2</li>\n</ul>\n</li>\n<li>在正式开始AB实验之前，先做AA分桶实验，模拟实验组、对照组的结果，判断是否均匀，避免分桶不均匀带来错误的实验结果</li>\n<li>实验开始，后端埋点：sdk发出后端埋点消息\n<ul>\n<li>消息格式举例：<code>业务id, 实验层id, 实验id, 分组id, 桶号, 触发时间</code></li>\n</ul>\n</li>\n<li>实验过程：实验持续时间至少一周，覆盖工作日、周末/假期，避免受时间周期带来的波动影响</li>\n<li>离线统计实验效果：\n<ul>\n<li>后端埋点数据导入曝光事件hive表</li>\n<li>业务DB数据导入行为事件hive表，如注册、登录、浏览、点击、收藏、加购、下单、支付等，取决于实验关注的业务指标</li>\n<li>把曝光事件、行为事件join起来，对比实验组、对照组的业务指标差异</li>\n</ul>\n</li>\n</ul>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1247698/202601/1247698-20260131014010302-1779078827.png\" /></p>\n<p>以下是sql示例，代表从实验曝光后24小时内各个分组的转化率对比。</p>\n<pre><code class=\"language-sql\">SELECT \n    e.group_id,\n    COUNT(DISTINCT e.user_id) as exposed_users,\n    COUNT(DISTINCT a.user_id) as converted_users,\n    COUNT(DISTINCT a.user_id) / COUNT(DISTINCT e.user_id) as conversion_rate\nFROM exposure_events e\nLEFT JOIN action_events a ON e.user_id = a.user_id \n    AND a.event_time BETWEEN e.event_time AND (e.event_time + INTERVAL 24 HOUR)\nWHERE e.experiment_id = 'ui_test_001'\nGROUP BY e.group_id;\n</code></pre>\n<h2 id=\"实验报表分析\">实验报表分析</h2>\n<p>评估实验结果是否正向、是否显著。了解统计学里的核心概念，能看懂实验报表即可。</p>\n<h3 id=\"p值\">p值</h3>\n<p>用来衡量实验结果是否显著，p值的含义是：假设实验组与对照组没有区别，此时观察到实验有差异的概率。一般要求 <code>p &lt; 0.05</code>，也就是说实验结果显著的概率大于95%（<code>1 - 0.05 = 95%</code>）</p>\n<h3 id=\"置信区间\">置信区间</h3>\n<p>在显著的前提下，用来衡量实验结果是否正向，代表业务指标的可能范围分布。<br />\n比如：实验结果里业务指标提升了1%，95%置信区间在[0.8%, 1.2%]，则代表有95%的把握可以把业务指标提升至少0.8%、至多1.2%，效果正向。如果置信区间的下界是负数，就有可能是负向效果了，需要警惕。</p>\n<p>以上就是灰度方案的总结了，欢迎讨论交流。</p>\n\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 17:35</span>&nbsp;\n<a href=\"https://www.cnblogs.com/toplist\">Java烘焙师</a>&nbsp;\n阅读(<span id=\"post_view_count\">50</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    },
    {
      "title": "开源自建，GPT 切换空间麻烦？一件帮你搞定",
      "link": "https://www.cnblogs.com/qxnm/p/19558462",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/qxnm/p/19558462\" id=\"cb_post_title_url\" title=\"发布于 2026-01-31 16:23\">\n    <span>开源自建，GPT 切换空间麻烦？一件帮你搞定</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<p style=\"font-size: 0; line-height: 0; margin: 0;\">&nbsp;</p>\n<section>\n<blockquote>\n<p>字数 497，阅读大约需 3 分钟</p>\n</blockquote>\n<p>这几天给我忙的，最近写了一个Codex的TEAM 账号管理工具直接在本地运行<br />大概是下面这样肝了几天，能配合codex cli使用<br />有目前还有一些bug和不好用的地方，后面会逐步优化出来</p>\n<p>项目连接，需要的佬友希望能贡献一个start<br /><span>hongshungao/Codex-Manager: 一个Codex cli 账号管理与切换工具。为 Codex cli提供本地号池管理自动切换。<sup>[1]</sup></span></p>\n<h2 id=\"0\">ReadMe</h2>\n<p>本地桌面端 + 服务进程的 Codex 账号池管理器，用于统一管理账号、用量与平台 Key，并提供本地网关与服务能力。</p>\n<h2 id=\"1\">项目简介</h2>\n<ul>\n<li>• 桌面端（Tauri）负责账号管理、用量展示、授权登录与平台 Key 配置</li>\n<li>• 服务端（Rust）提供本地 RPC + Gateway，支持用量刷新、账号轮询与鉴权转发</li>\n<li>• 支持手动解析 OAuth 回调链接，避免端口冲突或回调失败</li>\n</ul>\n<h2 id=\"2\">功能亮点</h2>\n<ul>\n<li>• 账号池管理：分组/标签/排序/备注</li>\n<li>• 用量展示：5 小时 + 7 日用量快照</li>\n<li>• 授权登录：浏览器授权 + 手动回调解析</li>\n<li>• 平台 Key：生成/禁用/删除</li>\n<li>• 本地服务：自动启动、可自定义端口</li>\n<li>• 网关能力：为本地 CLI/工具提供统一入口</li>\n</ul>\n<h2 id=\"3\">技术栈</h2>\n<ul>\n<li>• 前端：Vite + 原生 JS + 自定义 UI</li>\n<li>• 桌面端：Tauri (Rust)</li>\n<li>• 服务端：Rust（本地 HTTP/RPC + Gateway）</li>\n</ul>\n<h2 id=\"4\">目录结构</h2>\n<pre class=\"language-plaintext highlighter-hljs\"><code>.\n├─&nbsp;apps/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;前端与&nbsp;Tauri&nbsp;桌面端\n│&nbsp;&nbsp;├─&nbsp;src/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;前端源码\n│&nbsp;&nbsp;├─&nbsp;src-tauri/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Tauri&nbsp;端源码\n│&nbsp;&nbsp;└─&nbsp;dist/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;前端构建产物\n├─&nbsp;crates/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Rust&nbsp;核心与服务端\n│&nbsp;&nbsp;├─&nbsp;gpttools-core\n│&nbsp;&nbsp;└─&nbsp;gpttools-service\n├─&nbsp;portable/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;便携版输出目录\n├─&nbsp;rebuild.ps1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;打包脚本\n└─&nbsp;README.md</code></pre>\n<h2 id=\"5\">快速开始</h2>\n<ol>\n<li>1. 启动桌面端后，点击“启动服务”</li>\n<li>2. 进入“账号管理”添加账号并完成授权</li>\n<li>3. 需要时粘贴回调链接完成手动解析</li>\n<li>4. 刷新用量，检查状态与配额</li>\n</ol>\n</section>\n<p style=\"font-size: 0; line-height: 0; margin: 0;\">&nbsp;</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-31 16:23</span>&nbsp;\n<a href=\"https://www.cnblogs.com/qxnm\">高宏顺</a>&nbsp;\n阅读(<span id=\"post_view_count\">24</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">收藏</a>&nbsp;\n<a href=\"\">举报</a>\n</div>"
    }
  ]
}