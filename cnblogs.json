{
  "title": "ä¸»é¡µ - åšå®¢å›­",
  "link": "https://www.cnblogs.com/",
  "description": "ä¸»é¡µ - åšå®¢å›­ RSS",
  "entries": [
    {
      "title": "Flinkæºç é˜…è¯»ï¼šJobManagerçš„HAæœºåˆ¶",
      "link": "https://www.cnblogs.com/Jackeyzhe/p/19484622",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/Jackeyzhe/p/19484622\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 23:45\">\n    <span>Flinkæºç é˜…è¯»ï¼šJobManagerçš„HAæœºåˆ¶</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        <img alt=\"Flinkæºç é˜…è¯»ï¼šJobManagerçš„HAæœºåˆ¶\" class=\"desc_img\" src=\"https://img2024.cnblogs.com/blog/1828322/202601/1828322-20260114234320282-1778052120.png\" />\n        JobManager åœ¨ Flink é›†ç¾¤ä¸­å‘æŒ¥ç€é‡è¦çš„ä½œç”¨ï¼ŒåŒ…æ‹¬ä»»åŠ¡è°ƒåº¦å’Œèµ„æºç®¡ç†ç­‰å·¥ä½œã€‚å¦‚æœ JobManager å®•æœºï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤çš„ä»»åŠ¡éƒ½å°†å¤±è´¥ã€‚ä¸ºäº†è§£å†³ JobManager çš„å•ç‚¹é—®é¢˜ï¼ŒFlink ä¹Ÿè®¾è®¡äº† HA æœºåˆ¶æ¥ä¿éšœæ•´ä¸ªé›†ç¾¤çš„ç¨³å®šæ€§ã€‚\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>JobManager åœ¨ Flink é›†ç¾¤ä¸­å‘æŒ¥ç€é‡è¦çš„ä½œç”¨ï¼ŒåŒ…æ‹¬ä»»åŠ¡è°ƒåº¦å’Œèµ„æºç®¡ç†ç­‰å·¥ä½œã€‚å¦‚æœ JobManager å®•æœºï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤çš„ä»»åŠ¡éƒ½å°†å¤±è´¥ã€‚ä¸ºäº†è§£å†³ JobManager çš„å•ç‚¹é—®é¢˜ï¼ŒFlink ä¹Ÿè®¾è®¡äº† HA æœºåˆ¶æ¥ä¿éšœæ•´ä¸ªé›†ç¾¤çš„ç¨³å®šæ€§ã€‚</p>\n<h3 id=\"åŸºæœ¬æ¦‚å¿µ\">åŸºæœ¬æ¦‚å¿µ</h3>\n<p>åœ¨ JobManager å¯åŠ¨æ—¶ï¼Œè°ƒç”¨ <code>HighAvailabilityServicesUtils.createHighAvailabilityServices</code> æ¥åˆ›å»º HA æœåŠ¡ï¼ŒHA ä¾èµ–çš„æœåŠ¡éƒ½è¢«å°è£…åœ¨ HighAvailabilityServices ä¸­ã€‚å½“å‰ Flink å†…éƒ¨æ”¯æŒä¸¤ç§é«˜å¯ç”¨æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ ZooKeeper å’Œ KUBERNETESã€‚</p>\n<pre><code class=\"language-java\">case ZOOKEEPER:\n    return createZooKeeperHaServices(configuration, executor, fatalErrorHandler);\ncase KUBERNETES:\n    return createCustomHAServices(\n            \"org.apache.flink.kubernetes.highavailability.KubernetesHaServicesFactory\",\n            configuration,\n            executor);\n</code></pre>\n<p>HighAvailabilityServices ä¸­æä¾›çš„å…³é”®ç»„ä»¶åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>\n<p>LeaderRetrievalServiceï¼šæœåŠ¡å‘ç°ï¼Œç”¨äºè·å–å½“å‰ leader çš„åœ°å€ã€‚ç›®å‰ç”¨åˆ°æœåŠ¡å‘ç°çš„ç»„ä»¶æœ‰ ResourceManagerã€Dispatcherã€JobManagerã€ClusterRestEndpointã€‚</p>\n</li>\n<li>\n<p>LeaderElectionï¼šé€‰ä¸¾æœåŠ¡ï¼Œä»å¤šä¸ªå€™é€‰è€…ä¸­é€‰å‡ºä¸€ä¸ªä½œä¸º leaderã€‚ç”¨åˆ°é€‰ä¸¾æœåŠ¡çš„åŒæ ·æ˜¯ ResourceManagerã€Dispatcherã€JobManagerã€ClusterRestEndpoint è¿™å››ä¸ªã€‚</p>\n</li>\n<li>\n<p>CheckpointRecoveryFactoryï¼šCheckpoint æ¢å¤ç»„ä»¶çš„å·¥å‚ç±»ï¼Œæä¾›äº†åˆ›å»º CompletedCheckpointStore å’Œ CheckpointIDCounter çš„æ–¹æ³•ã€‚CompletedCheckpointStore æ˜¯ç”¨äºå­˜å‚¨å·²å®Œæˆçš„ checkpoint çš„å…ƒä¿¡æ¯ï¼ŒCheckpointIDCounter æ˜¯ç”¨äºç”Ÿæˆ checkpoint IDã€‚</p>\n</li>\n<li>\n<p>ExecutionPlanStoreï¼šç”¨äºå­˜å‚¨æ‰§è¡Œè®¡åˆ’ã€‚</p>\n</li>\n<li>\n<p>JobResultStoreï¼šç”¨äºå­˜å‚¨ä½œä¸šç»“æœï¼Œè¿™é‡Œæœ‰ä¸¤ç§çŠ¶æ€ï¼Œä¸€ç§æ˜¯ dirtyï¼Œè¡¨ç¤ºä½œä¸šæ²¡æœ‰è¢«å®Œå…¨æ¸…ç†ï¼Œå¦ä¸€ç§æ˜¯ cleanï¼Œè¡¨ç¤ºä½œä¸šæ¸…ç†å·¥ä½œå·²ç»æ‰§è¡Œå®Œæˆäº†ã€‚</p>\n</li>\n<li>\n<p>BlobStoreï¼šå­˜å‚¨ä½œä¸šè¿è¡ŒæœŸé—´çš„ä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>\n</li>\n</ul>\n<h4 id=\"é€‰ä¸¾æœåŠ¡\">é€‰ä¸¾æœåŠ¡</h4>\n<p>Flink çš„é€‰ä¸¾æ˜¯ä¾é  LeaderElection å’Œ LeaderContender é…åˆå®Œæˆçš„ã€‚LeaderElection æ˜¯ LeaderElectionService çš„ä»£ç†æ¥å£ï¼Œæä¾›äº†æ³¨å†Œå€™é€‰è€…ã€ç¡®è®¤ leader å’Œ åˆ¤æ–­å€™é€‰è€…æ˜¯å¦æ˜¯ leader ä¸‰ä¸ªæ¥å£ã€‚LeaderContender åˆ™æ˜¯ç”¨æ¥è¡¨ç¤ºå€™é€‰è€…å¯¹è±¡ã€‚å½“ä¸€ä¸ª LeaderContender å½“é€‰ leader åï¼ŒLeaderElectionService ä¼šä¸ºå…¶ç”Ÿæˆä¸€ä¸ª leaderSessionIdï¼ŒLeaderContender ä¼šè°ƒç”¨ confirmLeadershipAsync å‘å¸ƒè‡ªå·±çš„åœ°å€ã€‚é€‰ä¸¾æœåŠ¡çš„å…·ä½“å®ç°åœ¨ LeaderElectionDriver æ¥å£ä¸­ã€‚</p>\n<h4 id=\"æœåŠ¡å‘ç°\">æœåŠ¡å‘ç°</h4>\n<p>æœåŠ¡å‘ç°çš„ä½œç”¨æ˜¯è·å–å„ç»„ä»¶çš„ leader åœ°å€ã€‚æœåŠ¡å‘ç°ä¾èµ– LeaderRetrievalService å’Œ LeaderRetrievalListenerã€‚LeaderRetrievalService å¯ä»¥å¯åŠ¨ä¸€ä¸ªç›‘å¬ï¼Œå½“æœ‰æ–°çš„ leader å½“é€‰æ—¶ï¼Œä¼šè°ƒç”¨ LeaderRetrievalListener çš„ notifyLeaderAddress æ–¹æ³•ã€‚</p>\n<h4 id=\"ä¿¡æ¯ä¿å­˜\">ä¿¡æ¯ä¿å­˜</h4>\n<p>å½“ leader å‘ç”Ÿåˆ‡æ¢æ—¶ï¼Œæ–°çš„ leader éœ€è¦è·å–åˆ°æ—§ leader å­˜å‚¨çš„ä¿¡æ¯ï¼Œè¿™å°±éœ€è¦æ—§ leader æŠŠè¿™äº›ä¿¡æ¯å­˜åœ¨ä¸€ä¸ªå…¬å…±çš„å­˜å‚¨ä¸Šã€‚å®ƒå¯ä»¥æ˜¯ ZooKeeper æˆ– Kubernetes çš„å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„å­˜å‚¨ã€‚</p>\n<h3 id=\"åŸºäº-zookeeper-çš„-ha\">åŸºäº ZooKeeper çš„ HA</h3>\n<h4 id=\"é€‰ä¸¾æœåŠ¡-1\">é€‰ä¸¾æœåŠ¡</h4>\n<p>å‰é¢æˆ‘ä»¬æåˆ°äº†é€‰ä¸¾æœåŠ¡ä¸»è¦ä¾èµ– LeaderElection å’Œ LeaderContender é…åˆå®Œæˆã€‚æˆ‘ä»¬å°±ä»¥ JobManager ä¸ºä¾‹ï¼Œçœ‹ä¸€ä¸‹æœºé‡ ZooKeeper çš„é€‰ä¸¾æµç¨‹çš„å…·ä½“å®ç°ã€‚</p>\n<p><img alt=\"ZKLeaderElection\" class=\"lazyload\" /></p>\n<p>å›¾ä¸­ JobMasterServiceLeadershipRunner æ˜¯ LeaderContender çš„å®ç°ç±»ã€‚åœ¨å¯åŠ¨æœåŠ¡æ—¶ï¼Œä¼šå‘ LeaderElection æ³¨å†Œè‡ªå·±çš„ä¿¡æ¯ï¼Œå®é™…æ‰§è¡Œè€…æ˜¯ DefaultLeaderElectionServiceã€‚å®ƒå…ˆåˆ›å»ºäº† LeaderElectionDriverï¼Œç„¶åå°† LeaderContender ä¿å­˜åœ¨ leaderContenderRegistry ä¸­ã€‚é€‰ä¸¾çš„æ ¸å¿ƒé€»è¾‘å°è£…åœ¨ LeaderElectionDriver ä¸­ã€‚</p>\n<p>åœ¨åˆ›å»º LeaderElectionDriver æ—¶ï¼Œä¼šåˆ›å»º LeaderLatch å¯¹è±¡å’Œ TreeCache å¯¹è±¡ï¼Œ LeaderLatch å°è£…äº†ä¸ ZooKeeper å…³è”çš„å›è°ƒï¼Œä¼šæ¥æ”¶ä¸€ä¸ª LeaderElectionDriver ä½œä¸ºç›‘å¬ã€‚TreeCache ä¸»è¦ç”¨äºç›‘å¬ ZooKeeper ä¸­ leader èŠ‚ç‚¹çš„å˜æ›´ã€‚</p>\n<pre><code class=\"language-java\">public ZooKeeperLeaderElectionDriver(\n        CuratorFramework curatorFramework, LeaderElectionDriver.Listener leaderElectionListener)\n        throws Exception {\n    ...\n    this.leaderLatch = new LeaderLatch(curatorFramework, ZooKeeperUtils.getLeaderLatchPath());\n    this.treeCache =\n            ZooKeeperUtils.createTreeCache(\n                    curatorFramework,\n                    \"/\",\n                    new ZooKeeperLeaderElectionDriver.ConnectionInfoNodeSelector());\n\n    treeCache\n            .getListenable()\n            .addListener(\n                    (client, event) -&gt; {\n                        switch (event.getType()) {\n                            case NODE_ADDED:\n                            case NODE_UPDATED:\n                                Preconditions.checkNotNull(\n                                        event.getData(),\n                                        \"The ZooKeeper event data must not be null.\");\n                                handleChangedLeaderInformation(event.getData());\n                                break;\n                            case NODE_REMOVED:\n                                Preconditions.checkNotNull(\n                                        event.getData(),\n                                        \"The ZooKeeper event data must not be null.\");\n                                handleRemovedLeaderInformation(event.getData().getPath());\n                                break;\n                        }\n                    });\n\n    leaderLatch.addListener(this);\n    ...\n    leaderLatch.start();\n    treeCache.start();\n}\n</code></pre>\n<p>æˆ‘ä»¬è¿›å…¥åˆ° LeaderLatch çš„ start æ–¹æ³•ã€‚å®ƒçš„å†…éƒ¨æ˜¯åœ¨ ZooKeeper ä¸Šåˆ›å»º latch-xxx èŠ‚ç‚¹ã€‚xxx æ˜¯å½“å‰ LeaderLatch çš„ IDï¼Œå®ƒç”± ZooKeeper ç”Ÿæˆï¼ŒID æœ€å°çš„å½“é€‰ Leaderã€‚</p>\n<pre><code class=\"language-java\">private void checkLeadership(List&lt;String&gt; children) throws Exception {\n    if (this.debugCheckLeaderShipLatch != null) {\n        this.debugCheckLeaderShipLatch.await();\n    }\n\n    String localOurPath = (String)this.ourPath.get();\n    List&lt;String&gt; sortedChildren = LockInternals.getSortedChildren(\"latch-\", sorter, children);\n    int ourIndex = localOurPath != null ? sortedChildren.indexOf(ZKPaths.getNodeFromPath(localOurPath)) : -1;\n    this.log.debug(\"checkLeadership with id: {}, ourPath: {}, children: {}\", new Object[]{this.id, localOurPath, sortedChildren});\n    if (ourIndex &lt; 0) {\n        this.log.error(\"Can't find our node. Resetting. Index: \" + ourIndex);\n        this.reset();\n    } else if (ourIndex == 0) {\n        this.lastPathIsLeader.set(localOurPath);\n        this.setLeadership(true);\n    } else {\n        this.setLeadership(false);\n        String watchPath = (String)sortedChildren.get(ourIndex - 1);\n        Watcher watcher = new Watcher() {\n            public void process(WatchedEvent event) {\n                if (LeaderLatch.this.state.get() == LeaderLatch.State.STARTED &amp;&amp; event.getType() == EventType.NodeDeleted) {\n                    try {\n                        LeaderLatch.this.getChildren();\n                    } catch (Exception ex) {\n                        ThreadUtils.checkInterrupted(ex);\n                        LeaderLatch.this.log.error(\"An error occurred checking the leadership.\", ex);\n                    }\n                }\n\n            }\n        };\n        BackgroundCallback callback = new BackgroundCallback() {\n            public void processResult(CuratorFramework client, CuratorEvent event) throws Exception {\n                if (event.getResultCode() == Code.NONODE.intValue()) {\n                    LeaderLatch.this.getChildren();\n                }\n\n            }\n        };\n        ((ErrorListenerPathable)((BackgroundPathable)this.client.getData().usingWatcher(watcher)).inBackground(callback)).forPath(ZKPaths.makePath(this.latchPath, watchPath));\n    }\n\n}\n</code></pre>\n<p>å½“é€‰ Leader åï¼Œä¼šå›è°ƒ LeaderElectionDriver çš„ isLeader æ–¹æ³•ï¼Œå¦‚æœæœªå½“é€‰ï¼Œåˆ™ç»§ç»­ç›‘å¬ latch èŠ‚ç‚¹çš„å˜æ›´ã€‚isLeader ä¼šç»§ç»­å›è°ƒ LeaderElection çš„ onGrantLeadership æ–¹æ³•ï¼Œæ¥ç€è°ƒç”¨ LeaderContender çš„ grantLeadershipã€‚è¿™æ—¶ä¼šå¯åŠ¨ JobMaster æœåŠ¡ï¼Œç„¶åè°ƒç”¨ LeaderElection çš„ confirmLeadershipAsync æ¥ç¡®è®¤å½“é€‰æˆåŠŸã€‚ç¡®è®¤çš„è¿‡ç¨‹æ˜¯ç”± LeaderElectionDriver æ¥æ‰§è¡Œçš„ã€‚ä¸»è¦ä½œç”¨æ˜¯æŠŠå½“å‰ leader çš„ä¿¡æ¯å†™å›åˆ° ZooKeeper çš„ connection_info èŠ‚ç‚¹ã€‚</p>\n<pre><code class=\"language-java\">public void publishLeaderInformation(String componentId, LeaderInformation leaderInformation) {\n    Preconditions.checkState(running.get());\n\n    if (!leaderLatch.hasLeadership()) {\n        return;\n    }\n\n    final String connectionInformationPath =\n            ZooKeeperUtils.generateConnectionInformationPath(componentId);\n\n    LOG.debug(\n            \"Write leader information {} for component '{}' to {}.\",\n            leaderInformation,\n            componentId,\n            ZooKeeperUtils.generateZookeeperPath(\n                    curatorFramework.getNamespace(), connectionInformationPath));\n\n    try {\n        ZooKeeperUtils.writeLeaderInformationToZooKeeper(\n                leaderInformation,\n                curatorFramework,\n                leaderLatch::hasLeadership,\n                connectionInformationPath);\n    } catch (Exception e) {\n        leaderElectionListener.onError(e);\n    }\n}\n</code></pre>\n<h4 id=\"æœåŠ¡å‘ç°-1\">æœåŠ¡å‘ç°</h4>\n<p>æ¢³ç†å®Œé€‰ä¸¾æœåŠ¡çš„æºç åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æœåŠ¡å‘ç°çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬ä»¥ TaskManager è·å– JobManager çš„ leader ä¸ºä¾‹ã€‚</p>\n<p><img alt=\"ZKLeaderRetrieval\" class=\"lazyload\" /></p>\n<p>å½“æˆ‘ä»¬å¾€ TaskManager æ·»åŠ ä»»åŠ¡æ—¶ï¼Œä¼šè°ƒç”¨ JobLeaderService çš„ addJob æ–¹æ³•ã€‚è¿™é‡Œä¼šå…ˆè·å– LeaderRetrievalï¼Œç„¶åè°ƒç”¨ start æ–¹æ³•æ³¨å†Œ LeaderRetrievalListener ç›‘å¬ï¼Œå¹¶åˆ›å»º LeaderRetrievalDriverã€‚åœ¨ LeaderRetrievalDriver ä¸­ä¸»è¦æ˜¯å‘ ZooKeeper æ³¨å†Œ connection_info èŠ‚ç‚¹çš„å˜æ›´ã€‚</p>\n<p>å¦‚æœå‘ç”Ÿå˜æ›´ï¼ŒZooKeeper ä¼šå›è°ƒ <code>LeaderRetrievalDriver.retrieveLeaderInformationFromZooKeeper</code> æ–¹æ³•ã€‚æˆ‘ä»¬ä» ZooKeeper è·å–åˆ° leader çš„åœ°å€å’Œ sessionId åï¼Œå°±å›è°ƒ <code>LeaderRetrievalService.notifyLeaderAddress</code> æ–¹æ³•ã€‚æœ€ç»ˆè°ƒç”¨åˆ° JobLeaderService çš„ notifyLeaderAddress æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­å°±æ˜¯æ–­å¼€ä¸æ—§ leader çš„è¿æ¥ï¼Œå¢åŠ ä¸æ–° leader çš„è¿æ¥ã€‚</p>\n<h4 id=\"ä¿¡æ¯ä¿å­˜-1\">ä¿¡æ¯ä¿å­˜</h4>\n<p>æœ€åæˆ‘ä»¬å†æ¥çœ‹ä¿¡æ¯ä¿å­˜ç›¸å…³çš„æºç ã€‚åœ¨ JobManager å®Œæˆä¸€æ¬¡ Checkpoint æ—¶ï¼Œä¼šæ‰§è¡Œ <code>CheckpointCoordinator.completePendingCheckpoint</code> æ–¹æ³•ï¼Œè·Ÿéšè°ƒç”¨é“¾è·¯å¯ä»¥æ‰¾åˆ° <code>ZooKeeperStateHandleStore.addAndLock</code> æ–¹æ³•ï¼Œè¿™é‡Œä¼šæŠŠçŠ¶æ€å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç„¶åæŠŠæ–‡ä»¶è·¯å¾„ä¿å­˜åœ¨ ZooKeeper ä¸­ã€‚</p>\n<pre><code class=\"language-java\">public RetrievableStateHandle&lt;T&gt; addAndLock(String pathInZooKeeper, T state)\n        throws PossibleInconsistentStateException, Exception {\n    checkNotNull(pathInZooKeeper, \"Path in ZooKeeper\");\n    checkNotNull(state, \"State\");\n    final String path = normalizePath(pathInZooKeeper);\n    final Optional&lt;Stat&gt; maybeStat = getStat(path);\n\n    if (maybeStat.isPresent()) {\n        if (isNotMarkedForDeletion(maybeStat.get())) {\n            throw new AlreadyExistException(\n                    String.format(\"ZooKeeper node %s already exists.\", path));\n        }\n\n        Preconditions.checkState(\n                releaseAndTryRemove(path),\n                \"The state is marked for deletion and, therefore, should be deletable.\");\n    }\n\n    final RetrievableStateHandle&lt;T&gt; storeHandle = storage.store(state);\n    final byte[] serializedStoreHandle = serializeOrDiscard(storeHandle);\n    try {\n        writeStoreHandleTransactionally(path, serializedStoreHandle);\n        return storeHandle;\n    } catch (KeeperException.NodeExistsException e) {\n        // Transactions are not idempotent in the curator version we're currently using, so it\n        // is actually possible that we've re-tried a transaction that has already succeeded.\n        // We've ensured that the node hasn't been present prior executing the transaction, so\n        // we can assume that this is a result of the retry mechanism.\n        return storeHandle;\n    } catch (Exception e) {\n        if (indicatesPossiblyInconsistentState(e)) {\n            throw new PossibleInconsistentStateException(e);\n        }\n        // In case of any other failure, discard the state and rethrow the exception.\n        storeHandle.discardState();\n        throw e;\n    }\n}\n</code></pre>\n<p>è‡³æ­¤ï¼ŒåŸºäº ZooKeeper çš„ HA é€»è¾‘æˆ‘ä»¬å°±æ¢³ç†å®Œäº†ã€‚ä» 1.12 ç‰ˆæœ¬å¼€å§‹ï¼ŒFlink è¿˜æ”¯æŒäº† Kubernetes é«˜å¯ç”¨ï¼Œä¸‹é¢æˆ‘ä»¬å†æ¥ä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>\n<h3 id=\"åŸºäº-kubernetes-çš„-ha\">åŸºäº Kubernetes çš„ HA</h3>\n<h4 id=\"é€‰ä¸¾æœåŠ¡-2\">é€‰ä¸¾æœåŠ¡</h4>\n<p>é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼Œé€‰ä¸¾çš„ä¸»è¦é€»è¾‘æ˜¯åœ¨ LeaderElectionDriver ä¸­ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹ KubernetesLeaderElectionDriver çš„é€»è¾‘å³å¯ã€‚åˆ›å»º KubernetesLeaderElectionDriver æ—¶ï¼Œåˆ›å»ºå¹¶å¯åŠ¨äº† KubernetesLeaderElectorã€‚è¿™ä¸ªç±»ä¼¼äº ZooKeeper é€»è¾‘ä¸­ LeaderLatchï¼Œä¼šè·Ÿ Kubernetes åº•å±‚çš„é€‰ä¸¾é€»è¾‘äº¤äº’ï¼ŒåŒæ—¶æ³¨å†Œç›‘å¬ã€‚</p>\n<pre><code class=\"language-java\">public KubernetesLeaderElector(\n        NamespacedKubernetesClient kubernetesClient,\n        KubernetesLeaderElectionConfiguration leaderConfig,\n        LeaderCallbackHandler leaderCallbackHandler,\n        ExecutorService executorService) {\n    this.kubernetesClient = kubernetesClient;\n    this.leaderElectionConfig =\n            new LeaderElectionConfigBuilder()\n                    .withName(leaderConfig.getConfigMapName())\n                    .withLeaseDuration(leaderConfig.getLeaseDuration())\n                    .withLock(\n                            new ConfigMapLock(\n                                    new ObjectMetaBuilder()\n                                            .withNamespace(kubernetesClient.getNamespace())\n                                            .withName(leaderConfig.getConfigMapName())\n                                            // Labels will be used to clean up the ha related\n                                            // ConfigMaps.\n                                            .withLabels(\n                                                    KubernetesUtils.getConfigMapLabels(\n                                                            leaderConfig.getClusterId()))\n                                            .build(),\n                                    leaderConfig.getLockIdentity()))\n                    .withRenewDeadline(leaderConfig.getRenewDeadline())\n                    .withRetryPeriod(leaderConfig.getRetryPeriod())\n                    .withReleaseOnCancel(true)\n                    .withLeaderCallbacks(\n                            new LeaderCallbacks(\n                                    leaderCallbackHandler::isLeader,\n                                    leaderCallbackHandler::notLeader,\n                                    newLeader -&gt;\n                                            LOG.info(\n                                                    \"New leader elected {} for {}.\",\n                                                    newLeader,\n                                                    leaderConfig.getConfigMapName())))\n                    .build();\n    this.executorService = executorService;\n\n    LOG.info(\n            \"Create KubernetesLeaderElector on lock {}.\",\n            leaderElectionConfig.getLock().describe());\n}\n</code></pre>\n<p>é€‰ä¸¾æˆåŠŸåï¼Œä¼šå›è°ƒ <code>LeaderElectionListener.onGrantLeadership</code> æ–¹æ³•ã€‚åç»­çš„è°ƒç”¨é“¾è·¯è¿˜æ˜¯ä¼šè°ƒç”¨åˆ° <code>KubernetesLeaderElectionDriver.publishLeaderInformation</code> æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯æŠŠ leader ä¿¡æ¯å†™åˆ° Kubernetes çš„ configMap ä¸­ã€‚</p>\n<pre><code class=\"language-java\">public void publishLeaderInformation(String componentId, LeaderInformation leaderInformation) {\n    Preconditions.checkState(running.get());\n\n    try {\n        kubeClient\n                .checkAndUpdateConfigMap(\n                        configMapName,\n                        updateConfigMapWithLeaderInformation(componentId, leaderInformation))\n                .get();\n    } catch (InterruptedException | ExecutionException e) {\n        leaderElectionListener.onError(e);\n    }\n\n    LOG.debug(\n            \"Successfully wrote leader information {} for leader {} into the config map {}.\",\n            leaderInformation,\n            componentId,\n            configMapName);\n}\n</code></pre>\n<h4 id=\"æœåŠ¡å‘ç°-2\">æœåŠ¡å‘ç°</h4>\n<p>æœåŠ¡å‘ç°çš„é€»è¾‘åœ¨ KubernetesLeaderRetrievalDriver ç±»ä¸­ï¼Œåœ¨åˆ›å»ºæ—¶ï¼Œä¼šå°†å†…éƒ¨ç±» ConfigMapCallbackHandlerImpl æ³¨å†Œä¸ºç›‘å¬å›è°ƒç±»ã€‚</p>\n<p>å½“ configMap æœ‰æ–°å¢æˆ–å˜æ›´åï¼Œä¼šå›è°ƒ <code>LeaderRetrievalService.notifyLeaderAddress</code> æ–¹æ³•ã€‚</p>\n<pre><code class=\"language-java\">private class ConfigMapCallbackHandlerImpl\n        implements FlinkKubeClient.WatchCallbackHandler&lt;KubernetesConfigMap&gt; {\n\n    @Override\n    public void onAdded(List&lt;KubernetesConfigMap&gt; configMaps) {\n        // The ConfigMap is created by KubernetesLeaderElectionDriver with\n        // empty data. We don't really need to process anything unless the retriever was started\n        // after the leader election has already succeeded.\n        final KubernetesConfigMap configMap = getOnlyConfigMap(configMaps, configMapName);\n        final LeaderInformation leaderInformation = leaderInformationExtractor.apply(configMap);\n        if (!leaderInformation.isEmpty()) {\n            leaderRetrievalEventHandler.notifyLeaderAddress(leaderInformation);\n        }\n    }\n\n    @Override\n    public void onModified(List&lt;KubernetesConfigMap&gt; configMaps) {\n        final KubernetesConfigMap configMap = getOnlyConfigMap(configMaps, configMapName);\n        leaderRetrievalEventHandler.notifyLeaderAddress(\n                leaderInformationExtractor.apply(configMap));\n    }\n    ...\n}\n</code></pre>\n<h4 id=\"ä¿¡æ¯ä¿å­˜-2\">ä¿¡æ¯ä¿å­˜</h4>\n<p>ä¿¡æ¯ä¿å­˜çš„é€»è¾‘å’Œ ZooKeeper ä¹Ÿéå¸¸ç±»ä¼¼ã€‚å³å…ˆæŠŠ state ä¿å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿï¼Œç„¶åæŠŠå­˜å‚¨è·¯å¾„å†™åˆ° Kubernetes å†™åˆ° configMap ä¸­ã€‚å…·ä½“å¯ä»¥çœ‹ <code>KubernetesStateHandleStore.addAndLock</code> æ–¹æ³•ã€‚</p>\n<h3 id=\"æ€»ç»“\">æ€»ç»“</h3>\n<p>æœ¬æ–‡æˆ‘ä»¬ä¸€èµ·æ¢³ç†äº† Flink ä¸­ JobManager çš„ HA æœºåˆ¶ç›¸å…³æºç ã€‚ç›®å‰ Flink æ”¯æŒ ZooKeeper å’Œ Kubernetes ä¸¤ç§å®ç°ã€‚åœ¨æ¢³ç†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»¥ JobManager ä¸ºä¾‹ï¼Œå…¶ä»–å‡ ä¸ªç”¨åˆ°é«˜å¯ç”¨çš„æœåŠ¡çš„é€‰ä¸¾é€»è¾‘ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 23:45</span>&nbsp;\n<a href=\"https://www.cnblogs.com/Jackeyzhe\">Jackeyzhe</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "å°ç™½å­¦AIå¼€å‘01ï¼šåˆ›å»ºç¬¬ä¸€ä¸ªç¤ºä¾‹Agent",
      "link": "https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l",
      "published": "",
      "description": "<a name=\"top\"></a>\n    <h2><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 23:43\">\n    <span>å°ç™½å­¦AIå¼€å‘01ï¼šåˆ›å»ºç¬¬ä¸€ä¸ªç¤ºä¾‹Agent</span>\n    \n\n</a>\n</h2>\n    <small>\n<span id=\"post-date\">2026-01-14 23:43</span>&nbsp;\n<a href=\"https://www.cnblogs.com/jyzhao\">AlfredZhao</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</small>\n    <div class=\"entry\">\n        <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>åœ¨ LangChain å¼€å‘ä¸­ï¼Œæˆ‘ä»¬çš„æ ¸å¿ƒå·¥ä½œæ˜¯å†™ Promptï¼ˆæç¤ºè¯ï¼‰ã€‚</p>\n<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦äº†è§£ä¸‹pythonåŸºç¡€ï¼Œç®€å•äº†è§£å³å¯ï¼Œä¸éœ€è¦ç³»ç»Ÿå­¦ä¹ ï¼Œè¿™å°±æ˜¯AIæ—¶ä»£å¯¹æŠ€æœ¯çˆ±å¥½è€…çš„çº¢åˆ©ã€‚</p>\n<h2 id=\"01--æ„å»ºç‹¬ç«‹çš„pythonç¯å¢ƒ\">01 | æ„å»ºç‹¬ç«‹çš„pythonç¯å¢ƒ</h2>\n<p>ä½¿ç”¨minicondaæ„å»ºç‹¬ç«‹çš„pythonç¯å¢ƒã€‚</p>\n<p>å®˜æ–¹ç½‘ç«™ï¼š<a href=\"https://www.anaconda.com/\" rel=\"noopener nofollow\" target=\"_blank\">https://www.anaconda.com/</a></p>\n<p>é€‰æ‹©é€‚åˆä½ çš„ï¼Œæˆ‘è¿™é‡Œç›´æ¥é€‰æ‹©å›¾å½¢åŒ–å®‰è£…çš„Minicondaï¼š</p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/635610/202601/635610-20260114224646258-840865368.jpg\" /></p>\n<p>ä¸‹è½½åå®‰è£…ï¼š</p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/635610/202601/635610-20260114224646142-163182582.jpg\" /></p>\n<p>å…³é—­å¹¶é‡æ–°æ‰“å¼€ç»ˆç«¯ã€‚æ­¤æ—¶ä½ ä¼šçœ‹åˆ°å‘½ä»¤è¡Œå‰é¢å¤šäº†ä¸ª (base)ï¼Œè¿™è¯´æ˜ Conda å·²ç»æ¥ç®¡äº†ç¯å¢ƒã€‚</p>\n<p>ç„¶ååˆ›å»º Python 3.12 ä¸“å±å­¦ä¹ ç¯å¢ƒï¼š</p>\n<pre><code class=\"language-BASH\"># åˆ›å»ºç¯å¢ƒå¹¶æŒ‡å®š Python ç‰ˆæœ¬\nconda create -n lc python=3.12 -y\n\n# æ¿€æ´»ç¯å¢ƒ\nconda activate lc\n</code></pre>\n<p>Tipsï¼šå¦‚æœåˆ›å»ºç¯å¢ƒï¼Œé‡åˆ°è®©åŒæ„æœåŠ¡/æ¡æ¬¾ä¹‹ç±»ï¼Œç›´æ¥æŒ‰æç¤ºå‘½ä»¤æ‰§è¡ŒåŒæ„å³å¯ã€‚</p>\n<p>åé¢æµ‹è¯•ä¸åŒåŠŸèƒ½çš„pythonç¨‹åºè‚¯å®šå…ä¸äº†å¼•ç”¨å„ç§ç±»å‹çš„åŒ…ï¼Œæˆ‘ä»¬ç»Ÿä¸€æ”¾åˆ° requirements.txt ä¸­ï¼Œåç»­æ–°ç¯å¢ƒä¹Ÿå¯ä»¥ç›´æ¥ä¸€é”®å®‰è£…éœ€è¦å¼•å…¥çš„ç›¸å…³åŒ…ã€‚</p>\n<pre><code class=\"language-BASH\">pip install -r requirements.txt\n</code></pre>\n<p>å®šæœŸç»´æŠ¤requirements.txtæ–‡ä»¶ï¼š</p>\n<pre><code class=\"language-BASH\">langchain\nlangchain-openai\npython-dotenv\n</code></pre>\n<h2 id=\"02--åˆ›å»ºç¬¬ä¸€ä¸ªç¤ºä¾‹agent\">02 | åˆ›å»ºç¬¬ä¸€ä¸ªç¤ºä¾‹Agent</h2>\n<p>è¿™é‡Œä»¿ç…§LangChainå®˜æ–¹æ–‡æ¡£ï¼Œæ„å»ºä¸€ä¸ªç®€å•çš„Agentã€‚</p>\n<ul>\n<li><a href=\"https://docs.langchain.com/oss/python/langchain/quickstart\" rel=\"noopener nofollow\" target=\"_blank\">https://docs.langchain.com/oss/python/langchain/quickstart</a></li>\n</ul>\n<p>å› ä¸ºç¬”è€…æš‚æ—¶æ²¡æœ‰Claudeæ¨¡å‹å¯ç”¨ï¼Œæ‰€ä»¥æ›¿æ¢ä¸ºå›½å†…çš„æ¨¡å‹ï¼Œåœ¨æˆ‘ä»¬å­¦ä¹ æµ‹è¯•é˜¶æ®µï¼ŒåŸºæœ¬æ˜¯æ²¡å•¥å½±å“çš„ã€‚</p>\n<p>vi basic.py</p>\n<pre><code class=\"language-python\">import os\nfrom dotenv import load_dotenv\nfrom langchain.agents import create_agent\nfrom langchain_openai import ChatOpenAI\nfrom langchain.tools import tool\n\n# åŠ è½½ .env æ–‡ä»¶ä¸­çš„ SILICONFLOW_API_KEY\nload_dotenv()\n\n# 1. å®šä¹‰å·¥å…·ï¼šå¿…é¡»è¦å†™æ¸…æ™°çš„ Docstringï¼ˆå‡½æ•°æ³¨é‡Šï¼‰\n@tool\ndef get_weather(city: str) -&gt; str:\n    \"\"\"è·å–æŒ‡å®šåŸå¸‚çš„å®æ—¶å¤©æ°”æƒ…å†µã€‚\"\"\"\n    return f\"{city} çš„å¤©æ°”æ€»æ˜¯é˜´é›¨è¿è¿ï¼\"\n\n# 2. åˆå§‹åŒ– SiliconFlow æ¨¡å‹\nllm = ChatOpenAI(\n    model=\"deepseek-ai/DeepSeek-V3\", \n    api_key=os.getenv(\"SILICONFLOW_API_KEY\"),\n    base_url=\"https://api.siliconflow.cn/v1\",\n    temperature=0.1\n)\n\n# 3. åˆ›å»º Agent\nagent = create_agent(\n    model=llm,\n    tools=[get_weather],\n    system_prompt=\"ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„å¤©æ°”åŠ©æ‰‹ã€‚\"\n)\n\n# 4. è¿è¡Œ\nif __name__ == \"__main__\":\n    response = agent.invoke(\n        {\"messages\": [{\"role\": \"user\", \"content\": \"åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ\"}]}\n    )\n    # æ‰“å°æœ€åä¸€æ¡æ¶ˆæ¯ï¼ˆAI çš„å›ç­”ï¼‰\n    print(response[\"messages\"][-1].content)\n</code></pre>\n<h2 id=\"03--å¢å¼ºè¿™ä¸ªç¤ºä¾‹agent\">03 | å¢å¼ºè¿™ä¸ªç¤ºä¾‹Agent</h2>\n<p>æ±‰åŒ–å¹¶ç¨å¾®æ”¹é€ ä¸‹å®˜æ–¹çš„ç¤ºä¾‹ï¼Œä½¿å…¶é€‚ç”¨äºæˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒï¼š</p>\n<p>vi enhance.py</p>\n<pre><code class=\"language-PYTHON\">import os\nfrom dataclasses import dataclass\nfrom dotenv import load_dotenv\n\nfrom langchain_openai import ChatOpenAI\nfrom langchain.agents import create_agent\nfrom langchain.tools import tool, ToolRuntime\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.agents.structured_output import ToolStrategy\n\nload_dotenv()\n\n# 1. å®šä¹‰ç³»ç»Ÿæç¤ºè¯ï¼ˆè¦æ±‚ AI åšä¸ªâ€œè°éŸ³æ¢—â€ä¸“å®¶ï¼‰\nSYSTEM_PROMPT = \"\"\"ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„èµ„æ·±å¤©æ°”é¢„æŠ¥å‘˜ï¼Œè¯´è¯æå…¶å¹½é»˜ï¼Œç‰¹åˆ«å–œæ¬¢è®²â€œè°éŸ³æ¢—â€ã€‚\n\nä½ æœ‰æƒä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªå·¥å…·ï¼š\n- get_weather_for_location: è·å–ç‰¹å®šåŸå¸‚çš„å¤©æ°”ã€‚\n- get_user_location: è·å–å½“å‰ç”¨æˆ·çš„æ‰€åœ¨åœ°ã€‚\n\nå¦‚æœç”¨æˆ·è¯¢é—®å¤©æ°”ï¼Œè¯·åŠ¡å¿…ç¡®è®¤åœ°ç‚¹ã€‚å¦‚æœç”¨æˆ·è¯´çš„æ˜¯â€œæˆ‘è¿™å„¿â€æˆ–â€œæˆ‘è¿™é‡Œâ€ï¼Œè¯·è°ƒç”¨ get_user_location è·å–ä»–ä»¬çš„ä½ç½®ã€‚\"\"\"\n\n# 2. å®šä¹‰ä¸Šä¸‹æ–‡ç»“æ„ï¼ˆå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼‰\n@dataclass\nclass Context:\n    \"\"\"è‡ªå®šä¹‰è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ã€‚\"\"\"\n    user_id: str\n\n# 3. å®šä¹‰å·¥å…·\n@tool\ndef get_weather_for_location(city: str) -&gt; str:\n    \"\"\"è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”æƒ…å†µã€‚\"\"\"\n    return f\"{city} çš„å¤©æ°”æ€»æ˜¯é˜³å…‰ç¿çƒ‚ï¼\"\n\n@tool\ndef get_user_location(runtime: ToolRuntime[Context]) -&gt; str:\n    \"\"\"æ ¹æ®ç”¨æˆ· ID è·å–å…¶åœ°ç†ä½ç½®ã€‚\"\"\"\n    user_id = runtime.context.user_id\n    # æ¨¡æ‹Ÿæ•°æ®åº“ï¼šç”¨æˆ· 1 åœ¨åŒ—äº¬ï¼Œå…¶ä»–åœ¨ç æµ·\n    return \"åŒ—äº¬\" if user_id == \"1\" else \"ç æµ·\"\n\n# 4. é…ç½®ä½ çš„æ¨¡å‹ (SiliconFlow)\nmodel = ChatOpenAI(\n    model=\"deepseek-ai/DeepSeek-V3\",\n    api_key=os.getenv(\"SILICONFLOW_API_KEY\"),\n    base_url=\"https://api.siliconflow.cn/v1\",\n    temperature=0.7  # ç¨å¾®æé«˜éšæœºæ€§ï¼Œè®©è°éŸ³æ¢—æ›´æœ‰åˆ›æ„\n)\n\n# 5. å®šä¹‰å“åº”æ ¼å¼ï¼ˆæ±‰åŒ–å­—æ®µæè¿°ï¼Œè®© AI æ˜ç™½å¡«ä»€ä¹ˆï¼‰\n@dataclass\nclass ResponseFormat:\n    \"\"\"Agent çš„ç»“æ„åŒ–å›å¤æ ¼å¼ã€‚\"\"\"\n    # å¹½é»˜çš„è°éŸ³æ¢—å›å¤\n    punny_response: str\n    # ä»»ä½•å…³äºå¤©æ°”çš„æœ‰è¶£ä¿¡æ¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰\n    weather_conditions: str | None = None\n\n# 6. è®¾ç½®è®°å¿†å­˜å‚¨\ncheckpointer = InMemorySaver()\n\n# 7. åˆ›å»º Agent\nagent = create_agent(\n    model=model,\n    system_prompt=SYSTEM_PROMPT,\n    tools=[get_user_location, get_weather_for_location],\n    context_schema=Context,\n    response_format=ToolStrategy(ResponseFormat),\n    checkpointer=checkpointer\n)\n\n# --- è¿è¡Œæµ‹è¯• ---\n\n# è®¾ç½®ä¼šè¯ ID\nconfig = {\"configurable\": {\"thread_id\": \"test_user_001\"}}\n\n# ç¬¬ä¸€æ¬¡æé—®\nprint(\"--- ç¬¬ä¸€æ¬¡å¯¹è¯ ---\")\nresponse = agent.invoke(\n    {\"messages\": [{\"role\": \"user\", \"content\": \"å¤–é¢å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ\"}]},\n    config=config,\n    context=Context(user_id=\"1\")\n)\n\n# è®¿é—®ç»“æ„åŒ–ç»“æœ\nres = response['structured_response']\nprint(f\"AI: {res.punny_response}\")\nprint(f\"è¯¦æƒ…: {res.weather_conditions}\")\n\nprint(\"\\n--- ç¬¬äºŒæ¬¡å¯¹è¯ï¼ˆæµ‹è¯•è®°å¿†ï¼‰ ---\")\n# ç¬¬äºŒæ¬¡æé—®\nresponse = agent.invoke(\n    {\"messages\": [{\"role\": \"user\", \"content\": \"è°¢è°¢ä½ ï¼æˆ‘åœ¨å“ªé‡Œï¼Ÿ\"}]},\n    config=config,\n    context=Context(user_id=\"1\")\n)\n\nres = response['structured_response']\nprint(f\"AI: {res.punny_response}\")\n</code></pre>\n<p>è¿™æ®µç¤ºä¾‹ä»£ç çš„æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š</p>\n<p><strong>ç¬¬ä¸€æ¬¡å¯¹è¯ï¼š</strong></p>\n<p>ç”¨æˆ·é—®ï¼šâ€œå¤–é¢å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿâ€ï¼ˆæ²¡è¯´åœ°ç‚¹ï¼‰ã€‚<br />\nAI æ€è€ƒï¼šç³»ç»Ÿæç¤ºè¯å‘Šè¯‰æˆ‘ï¼Œå¦‚æœåœ°ç‚¹ä¸æ˜ï¼Œå…ˆå»æŸ¥ç”¨æˆ·åœ¨å“ªã€‚<br />\nåŠ¨ä½œï¼šAI è°ƒç”¨ get_user_location -&gt; å¾—åˆ°â€œåŒ—äº¬â€ -&gt; è°ƒç”¨ get_weather_for_location -&gt; å¾—åˆ°å¤©æ°”ã€‚<br />\nå›å¤ï¼šæ ¹æ® ResponseFormat åå‡ºä¸€ä¸ªè°éŸ³æ¢—ã€‚</p>\n<p><strong>ç¬¬äºŒæ¬¡å¯¹è¯ï¼š</strong></p>\n<p>ç”¨æˆ·é—®ï¼šâ€œè°¢è°¢ä½ ï¼æˆ‘åœ¨å“ªé‡Œï¼Ÿâ€<br />\nAI æ€è€ƒï¼šç”±äºæœ‰ thread_id å’Œ checkpointerï¼ŒAI è®°å¾—ä¸Šä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœã€‚<br />\nåŠ¨ä½œï¼šå®ƒä¸éœ€è¦å†æ¬¡æŸ¥å·¥å…·ï¼Œç›´æ¥ä»è®°å¿†é‡Œæå–ä¿¡æ¯å¹¶å›å¤ã€‚</p>\n<p>ç„¶åæ‰‹å·¥å°†ä»£ç ä¸­çš„ user_id æ”¹ä¸º2ï¼Œå†æ¬¡è¿è¡Œï¼Œå°±ä¼šæ ¹æ®å·¥å…· <code>get_user_location</code> ä¸­çš„ç¤ºä¾‹é€»è¾‘ï¼Œå¾—åˆ°åœ°ç‚¹ä¸ºâ€ç æµ·â€œï¼Œä¸¤æ¬¡æ‰§è¡Œçš„æ•ˆæœå‚è€ƒå¦‚ä¸‹ï¼š</p>\n<p><img alt=\"\" src=\"https://img2024.cnblogs.com/blog/635610/202601/635610-20260114224646132-69223909.jpg\" /></p>\n<p>è¯¥æ®µç¤ºä¾‹ä»£ç è™½ç„¶ç®€å•ï¼Œä½†å…¶å®å·²ç»èƒ½å±•ç°å‡ºä¸€ä¸ªä¼ä¸šçº§ AI æ™ºèƒ½ä½“ï¼ˆAgentï¼‰çš„ç¼©å½±ã€‚å®ƒæ¶µç›–äº†ç°ä»£ AI å¼€å‘ä¸­æœ€æ ¸å¿ƒçš„ä¸‰ä¸ªæ”¯æŸ±ï¼šå·¥å…·è°ƒç”¨ï¼ˆTool Useï¼‰ã€ä¸Šä¸‹æ–‡è®°å¿†ï¼ˆMemoryï¼‰ã€ä»¥åŠç»“æ„åŒ–è¾“å‡ºï¼ˆStructured Outputï¼‰ã€‚</p>\n\n</div>\n<div id=\"MySignature\">\n    <a href=\"https://www.cnblogs.com/jyzhao/\" target=\"_blank\">AlfredZhao</a>Â©ç‰ˆæƒæ‰€æœ‰ã€Œä»Oracleèµ·èˆªï¼Œé¢†ç•¥ç²¾å½©çš„ITæŠ€æœ¯ã€‚ã€<br />\nè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š<a href=\"https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l\" target=\"_blank\">https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l</a>\n<hr />\n<div style=\"text-align: center; margin-top: 30px;\">\n  <p style=\"font-size: 14px; color: #555;\">\n    ğŸ‘‹ æ„Ÿè°¢é˜…è¯»ï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å· <b>ã€Œèµµé–å®‡ã€</b>\n  </p>\n  <img src=\"https://images.cnblogs.com/cnblogs_com/jyzhao/824234/o_250208075013_qrcode-zjy.jpg\" style=\"border: 1px solid #ddd; border-radius: 8px;\" width=\"160\" />\n</div>\n</div>\n<div class=\"clear\"></div>\n\n        <div class=\"clear\"></div>\n        \n</div>\n    <ul class=\"postmetadata\">\n        \n    </ul>"
    },
    {
      "title": "Claude Code æœ€ä½³å®è·µçš„ 8 æ¡é»„é‡‘æ³•åˆ™",
      "link": "https://www.cnblogs.com/didispace/p/19484090",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/didispace/p/19484090\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 19:53\">\n    <span>Claude Code æœ€ä½³å®è·µçš„ 8 æ¡é»„é‡‘æ³•åˆ™</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p>ä¸ºä»€ä¹ˆåŒæ ·æ˜¯è°ƒç”¨ Claudeï¼Œæœ‰çš„äººèƒ½å†™å‡ºå·¥ä¸šçº§ä»£ç ï¼Œè€Œæœ‰çš„äººåªæ˜¯åœ¨ä¸æ–­å †ç§¯â€œæŠ€æœ¯å€ºâ€ï¼Ÿ ä»Šå¤©åˆ†äº«ä¸€ä½æ‹¥æœ‰ 7 å¹´ Amazonã€Disney å¤§å‚ç»éªŒã€ç°ä»»åˆ›ä¸šå…¬å¸ CTO åˆ†äº«çš„å®æˆ˜æŒ‡å—ã€‚ä»–æŠŠ Claude Code å½“ä½œæ¯æ—¥ä¸»åŠ›å·¥å…·ï¼Œå¹¶æ€»ç»“å‡ºäº†ä¸€å¥—é«˜é˜¶ç©å®¶æ‰‹å†Œã€‚ä»â€œå…ˆæ€è€ƒåæ•²å­—â€çš„æ¶æ„é“å¾‹ï¼Œåˆ°è®© AI ç§’æ‡‚ä½ çš„ CLAUDE.md æ·±åº¦é…ç½®ï¼Œå…¨æ˜¯é¿å‘æŒ‡å—ã€‚å¦‚æœä½ æƒ³è®© AI çœŸæ­£æˆä¸ºä½ çš„ç”Ÿäº§åŠ›é£è½®ï¼Œè¿™ç¯‡æ–‡ç« ç»å¯¹å€¼å¾—æ”¶è—åå¤è¯»ï¼</p>\n<p><img alt=\"f02adbeb1a8c005df0134224ed8c0d1b.png\" class=\"lazyload\" /></p>\n<p>ä¸‹é¢æ˜¯å¯¹è¿™ç¯‡æ–‡ç« çš„æ€»ç»“è§£è¯»ï¼Œå¦‚æœå¯¹åŸæ–‡æ„Ÿå…´è¶£ä¹Ÿå¯ä»¥æˆ³è¿™é‡ŒæŸ¥çœ‹ï¼š<a href=\"https://x.com/eyad_khrais/status/2010076957938188661\" rel=\"noopener nofollow\" target=\"_blank\">ã€ŠThe complete claude code tutorial ã€‹</a></p>\n<h2 id=\"æ³•åˆ™ä¸€å…ˆæ€è€ƒå†è¾“å…¥è®¡åˆ’æ¨¡å¼æ˜¯ä½ æœ€å¼ºå¤§çš„æ­¦å™¨\">æ³•åˆ™ä¸€ï¼šå…ˆæ€è€ƒï¼Œå†è¾“å…¥ï¼šè®¡åˆ’æ¨¡å¼æ˜¯ä½ æœ€å¼ºå¤§çš„æ­¦å™¨ã€‚</h2>\n<p>å¤§å¤šæ•°äººè®¤ä¸ºä½¿ç”¨AIå·¥å…·çš„ç¬¬ä¸€æ­¥å°±æ˜¯ç›´æ¥å¼€å§‹è¾“å…¥æç¤ºè¯ã€‚è¿™æ˜¯ä½ èƒ½çŠ¯ä¸‹çš„æœ€å¤§é”™è¯¯ä¹‹ä¸€ã€‚çœŸæ­£è‡³å…³é‡è¦ä¸”å¿…é¡»å…ˆåšçš„ç¬¬ä¸€æ­¥æ˜¯â€”â€”æ€è€ƒå’Œè®¡åˆ’ã€‚</p>\n<p>æˆ‘100%çš„ç»éªŒè¡¨æ˜ï¼Œä½¿ç”¨â€œè®¡åˆ’æ¨¡å¼â€ï¼ˆè¿æŒ‰ä¸¤æ¬¡ Shift+Tab é”®è¿›å…¥ï¼‰å¾—åˆ°çš„è¾“å‡ºï¼Œè¿œèƒœäºç›´æ¥æ»”æ»”ä¸ç»åœ°è¾“å…¥æƒ³æ³•ã€‚è¿™ç§å·®è·æ˜¯å‹å€’æ€§çš„ã€‚</p>\n<p>å½“ç„¶ï¼Œå¯¹äºä¸€äº›ç»éªŒä¸è¶³çš„å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¿™å¯èƒ½è¯´èµ·æ¥å®¹æ˜“åšèµ·æ¥éš¾ã€‚å¯¹æ­¤ï¼Œæˆ‘æœ‰ä¸¤æ¡å»ºè®®ï¼š</p>\n<ol>\n<li>å¼€å§‹å­¦ä¹ ã€‚ å³ä½¿æ¯æ¬¡åªå­¦ä¸€ç‚¹ï¼Œä¹Ÿå¿…é¡»å¼€å§‹ç§¯ç´¯ã€‚å¦‚æœä½ æ°¸è¿œä¸æŒæ¡è§„åˆ’èƒ½åŠ›ï¼Œä½ å°±æ˜¯åœ¨ç»™è‡ªå·±è®¾ç½®éšœç¢ã€‚</li>\n<li>ä¸AIæ·±åº¦äº¤æµã€‚ å’ŒClaudeè¿›è¡Œä¸€åœºæ·±å…¥çš„ã€åŒå‘çš„å¯¹è¯ã€‚è¯¦ç»†æè¿°ä½ æƒ³æ„å»ºä»€ä¹ˆï¼Œè¯¢é—®å®ƒåœ¨ç³»ç»Ÿè®¾è®¡ä¸Šæœ‰ä»€ä¹ˆä¸åŒçš„é€‰æ‹©ï¼Œæœ€ç»ˆå…±åŒç¡®å®šä¸€ä¸ªæ–¹æ¡ˆã€‚ä½ å’ŒAIåº”è¯¥äº’ç›¸æé—®ï¼Œè€Œä¸æ˜¯å•è¡Œé“ã€‚</li>\n</ol>\n<h2 id=\"æ³•åˆ™äºŒclaudemdä¸æ˜¯æ–‡æ¡£è€Œæ˜¯aiçš„å¤§è„‘\">æ³•åˆ™äºŒï¼šCLAUDE.mdä¸æ˜¯æ–‡æ¡£ï¼Œè€Œæ˜¯AIçš„å¤§è„‘ã€‚</h2>\n<p>CLAUDE.mdæ˜¯ä¸€ä¸ªæå…¶é‡è¦ä½†å¸¸è¢«è¯¯ç”¨çš„é…ç½®æ–‡ä»¶ã€‚åœ¨ä½ æ¯æ¬¡å¯åŠ¨ä¼šè¯æ—¶ï¼ŒClaudeéƒ½ä¼šé¦–å…ˆè¯»å–å®ƒã€‚å¤§å¤šæ•°äººè¦ä¹ˆå®Œå…¨å¿½ç•¥å®ƒï¼Œè¦ä¹ˆç”¨ä¸€äº›åƒåœ¾ä¿¡æ¯å¡«æ»¡å®ƒï¼Œç»“æœåè€Œè®©Claudeçš„è¡¨ç°æ›´ç³Ÿã€‚</p>\n<p>è¦å†™å¥½ä¸€ä¸ªCLAUDE.mdï¼Œè¯·éµå¾ªä»¥ä¸‹å››ä¸ªå…³é”®æ³•åˆ™ï¼š</p>\n<ul>\n<li>ä¿æŒç®€çŸ­ï¼š Claudeä¸€æ¬¡åªèƒ½å¯é åœ°éµå¾ªå¤§çº¦150-200æ¡æŒ‡ä»¤ï¼Œè€Œç³»ç»Ÿæç¤ºæœ¬èº«å·²ç»å ç”¨äº†å¤§çº¦50æ¡ã€‚ä½ çš„æ¯ä¸€æ¡æ–°æŒ‡ä»¤éƒ½åœ¨äº‰å¤ºå®ƒçš„æ³¨æ„åŠ›ã€‚å¦‚æœä½ çš„CLAUDE.mdå†™å¾—åƒæœ¬å°è¯´ï¼ŒClaudeå°±ä¼šå¼€å§‹éšæœºå¿½ç•¥æŸäº›å†…å®¹ã€‚</li>\n<li>ä¸“æ³¨äºé¡¹ç›®ç‰¹æ€§ï¼š ä¸è¦å‘Šè¯‰å®ƒä»€ä¹ˆæ˜¯â€œç»„ä»¶â€æ–‡ä»¶å¤¹ï¼Œå®ƒæ—©å°±çŸ¥é“äº†ã€‚ä½ åº”è¯¥å‘Šè¯‰å®ƒä½ é¡¹ç›®é‡Œé‚£äº›â€œå¥‡æ€ªâ€çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ä½ ç‰¹æœ‰çš„bashå‘½ä»¤æˆ–å·¥ä½œæµç¨‹ã€‚</li>\n<li>è§£é‡Šâ€œä¸ºä»€ä¹ˆâ€ï¼Œè€Œä¸ä»…æ˜¯â€œåšä»€ä¹ˆâ€ï¼š å½“ä½ ç»™å‡ºæŒ‡ä»¤èƒŒåçš„åŸå› æ—¶ï¼ŒClaudeèƒ½æ›´å¥½åœ°ç†è§£æ„å›¾å¹¶åšå‡ºæ›´ä¼˜çš„åˆ¤æ–­ã€‚åªè¯´â€œä½¿ç”¨TypeScriptä¸¥æ ¼æ¨¡å¼â€æ˜¯å¯ä»¥çš„ï¼Œä½†è¯´â€œä½¿ç”¨TypeScriptä¸¥æ ¼æ¨¡å¼ï¼Œå› ä¸ºæˆ‘ä»¬æ›¾å› éšå¼anyç±»å‹å¯¼è‡´è¿‡ç”Ÿäº§ç¯å¢ƒçš„bugâ€æ•ˆæœä¼šå¥½å¾—å¤šã€‚</li>\n<li>æŒç»­æ›´æ–°ï¼š CLAUDE.mdåº”è¯¥æ˜¯ä¸€ä»½â€œæ´»æ–‡æ¡£â€ã€‚å½“ä½ å·¥ä½œæ—¶ï¼Œå¯ä»¥æŒ‰ # é”®å¿«é€Ÿå°†å½“å‰æŒ‡ä»¤æ·»åŠ åˆ°æ–‡ä»¶ä¸­ã€‚æ¯å½“ä½ å‘ç°è‡ªå·±ç¬¬äºŒæ¬¡çº æ­£ClaudeåŒä¸€ä¸ªé—®é¢˜æ—¶ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ˜ç¡®çš„ä¿¡å·ï¼šè¿™æ¡è§„åˆ™åº”è¯¥è¢«å†™å…¥CLAUDE.mdã€‚</li>\n</ul>\n<p>ä¸€ä¸ªç³Ÿç³•çš„ CLAUDE.md è¯»èµ·æ¥åƒæ˜¯ç»™æ–°å‘˜å·¥å†™çš„å…¥èŒæ–‡æ¡£ã€‚è€Œä¸€ä¸ªä¼˜ç§€çš„ CLAUDE.md è¯»èµ·æ¥åƒæ˜¯ä½ ä¸ºæ˜å¤©ä¼šå¤±å¿†çš„è‡ªå·±ç•™ä¸‹çš„æ ¸å¿ƒç¬”è®°ã€‚</p>\n<h2 id=\"æ³•åˆ™ä¸‰200kä¸Šä¸‹æ–‡æ˜¯ç”œèœœçš„é™·é˜±åˆ«æ‰è¿›å»\">æ³•åˆ™ä¸‰ï¼š200kä¸Šä¸‹æ–‡æ˜¯ç”œèœœçš„é™·é˜±ï¼Œåˆ«æ‰è¿›å»ã€‚</h2>\n<p>è¿™æ˜¯ä¸€ä¸ªåç›´è§‰çš„äº‹å®ï¼šæ¨¡å‹æ€§èƒ½çš„ä¸‹é™è¿œåœ¨ä¸Šä¸‹æ–‡çª—å£è¢«å®Œå…¨å¡«æ»¡ä¹‹å‰å°±å¼€å§‹äº†ï¼Œé€šå¸¸åœ¨ä½¿ç”¨ç‡è¾¾åˆ°20-40%æ—¶å°±ä¼šå‡ºç°æ˜æ˜¾çš„è¡°å‡ã€‚</p>\n<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰æ—¶å€™å³ä½¿ä½ å‹ç¼©äº†ä¸Šä¸‹æ–‡ï¼ˆä½¿ç”¨ /compact å‘½ä»¤ï¼‰ï¼ŒClaudeä»ç„¶ä¼šç»™å‡ºç³Ÿç³•çš„è¾“å‡ºã€‚å› ä¸ºåœ¨å‹ç¼©ä¹‹å‰ï¼Œæ¨¡å‹çš„æ€§èƒ½å°±å·²ç»é€€åŒ–äº†ã€‚</p>\n<p>ä»¥ä¸‹æ˜¯æœ‰æ•ˆç®¡ç†ä¸Šä¸‹æ–‡çš„å‡ ä¸ªå®ç”¨ç­–ç•¥ï¼š</p>\n<ul>\n<li>åˆ’åˆ†å¯¹è¯èŒƒå›´ (Scope your conversations): æ¯ä¸ªåŠŸèƒ½æˆ–ä»»åŠ¡ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è¯ã€‚ä¸è¦åœ¨åŒä¸€ä¸ªå¯¹è¯é‡Œæ—¢æ„å»ºè®¤è¯ç³»ç»Ÿåˆé‡æ„æ•°æ®åº“å±‚ã€‚</li>\n<li>ä½¿ç”¨å¤–éƒ¨è®°å¿† (Use external memory): å¯¹äºå¤æ‚çš„ä»»åŠ¡ï¼Œè®©Claudeå°†è®¡åˆ’å’Œè¿›åº¦å†™å…¥åƒ SCRATCHPAD.md è¿™æ ·çš„å¤–éƒ¨æ–‡ä»¶ä¸­ã€‚è¿™æ ·ç¬¬äºŒå¤©ä½ å›æ¥æ—¶ï¼ŒClaudeå¯ä»¥è¯»å–æ–‡ä»¶ï¼Œä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹ç»§ç»­ã€‚</li>\n<li>â€œå¤åˆ¶-ç²˜è´´â€é‡ç½®æ³• (The copy-paste reset): å½“ä¸Šä¸‹æ–‡å˜å¾—è‡ƒè‚¿æ—¶ï¼Œå¤åˆ¶å¯¹è¯ä¸­çš„å…³é”®ä¿¡æ¯ï¼Œè¿è¡Œ /compact å’Œ /clear æ¸…ç©ºä¸Šä¸‹æ–‡ï¼Œç„¶ååªæŠŠæœ€é‡è¦çš„ä¿¡æ¯ç²˜è´´å›æ¥ã€‚ä¸€ä¸ªæ¸…çˆ½çš„ä¸Šä¸‹æ–‡è¿œèƒœäºé€€åŒ–çš„ä¸Šä¸‹æ–‡ã€‚</li>\n<li>æœæ–­æ¸…ç©º (Know when to clear): å¦‚æœä¸€ä¸ªå¯¹è¯å·²ç»åç¦»äº†è½¨é“ï¼Œç›´æ¥ç”¨ /clear é‡æ–°å¼€å§‹ã€‚è¿™å‡ ä¹æ€»æ˜¯æ¯”è¯•å›¾çº æ­£ä¸€ä¸ªæ··ä¹±çš„å¯¹è¯è¦å¥½ã€‚</li>\n</ul>\n<p>è®°ä½è¿™ä¸ªå¿ƒæ™ºæ¨¡å‹ï¼šClaudeæ˜¯æ— çŠ¶æ€çš„ã€‚é™¤äº†ä½ æ˜ç¡®ç»™å®ƒçš„ä¸œè¥¿ï¼Œæ¯ä¸ªå¯¹è¯éƒ½æ˜¯ä»é›¶å¼€å§‹ã€‚è¯·æ®æ­¤è§„åˆ’ã€‚</p>\n<h2 id=\"æ³•åˆ™å››æ¶æ„å†³å®šä¸€åˆ‡è§„åˆ’æ— å¯æ›¿ä»£\">æ³•åˆ™å››ï¼šæ¶æ„å†³å®šä¸€åˆ‡ï¼Œè§„åˆ’æ— å¯æ›¿ä»£ã€‚</h2>\n<p>æ¶æ„è‡³å…³é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ã€‚å¦‚æœä½ ä¸å…ˆæ€è€ƒç»“æ„ï¼ŒAIç”Ÿæˆçš„ä»£ç å°±ä¼šæœ‰å·¨å¤§çš„â€œè‡ªç”±å‘æŒ¥â€ç©ºé—´ï¼Œè€Œè¿™æ°æ°æ˜¯é—®é¢˜çš„æ ¹æºã€‚ä½ ä¸èƒ½è·³è¿‡è§„åˆ’ã€‚</p>\n<p>æ¯”è¾ƒä¸€ä¸‹è¿™ä¸¤ç§æé—®æ–¹å¼çš„å¤©å£¤ä¹‹åˆ«ï¼šæ¨¡ç³Šçš„è¯·æ±‚æ˜¯â€œç»™æˆ‘å»ºä¸€ä¸ªè®¤è¯ç³»ç»Ÿâ€ï¼Œè€Œä¸€ä¸ªç»è¿‡è§„åˆ’çš„ã€å…·ä½“çš„è¯·æ±‚æ˜¯â€œä½¿ç”¨ç°æœ‰çš„Useræ¨¡å‹æ„å»ºç”µå­é‚®ä»¶/å¯†ç è®¤è¯åŠŸèƒ½ï¼Œå°†sessionå­˜å‚¨åœ¨Redisä¸­å¹¶è®¾ç½®24å°æ—¶è¿‡æœŸï¼Œå¹¶æ·»åŠ ä¸­é—´ä»¶ä¿æŠ¤/api/protectedä¸‹çš„æ‰€æœ‰è·¯ç”±ã€‚â€</p>\n<p>å‰è€…ç»™äº†AIè¿‡å¤šçš„è‡ªç”±ï¼Œç»“æœå¯èƒ½æ˜¯æ··ä¹±çš„ã€‚åè€…ç»™äº†å®ƒä¸€ä¸ªæ¸…æ™°çš„è“å›¾ï¼Œç»“æœä¼šç²¾å‡†å¾—å¤šã€‚èŠ±5åˆ†é’Ÿè¿›è¡Œæ¶æ„è§„åˆ’ï¼Œå¯ä»¥ä¸ºä½ çœä¸‹åç»­æ•°å°æ—¶çš„è°ƒè¯•æ—¶é—´ã€‚</p>\n<h2 id=\"æ³•åˆ™äº”åœæ­¢æŠ±æ€¨æ¨¡å‹ç³Ÿç³•çš„è¾“å‡ºæºäºä½ ç³Ÿç³•çš„è¾“å…¥\">æ³•åˆ™äº”ï¼šåœæ­¢æŠ±æ€¨æ¨¡å‹ï¼Œç³Ÿç³•çš„è¾“å‡ºæºäºä½ ç³Ÿç³•çš„è¾“å…¥ã€‚</h2>\n<p>å½“å¾—åˆ°ä¸ç†æƒ³çš„ç»“æœæ—¶ï¼Œäººä»¬çš„ç¬¬ä¸€ååº”å¾€å¾€æ˜¯æŠ±æ€¨æ¨¡å‹ã€‚ä½†ç°å®æ˜¯æ®‹é…·çš„ï¼šåˆ«å†æ€ªæ¨¡å‹äº†ã€‚å¦‚æœä½ ç”¨Opus 4.5è¿˜å¾—ä¸åˆ°å¥½ç»“æœï¼Œé—®é¢˜å‡ºåœ¨ä½ èº«ä¸Šï¼Œè€Œä¸æ˜¯AIã€‚ä½ çš„è¾“å…¥å’Œæç¤ºæ–¹å¼çƒ‚é€äº†ï¼Œå¥å·ã€‚</p>\n<p>æƒ³è¦æå‡è¾“å‡ºè´¨é‡ï¼Œå…ˆè¦æå‡ä½ çš„è¾“å…¥è´¨é‡ï¼š</p>\n<ul>\n<li>å…·ä½“è¯´æ˜ä½ æƒ³è¦ä»€ä¹ˆ (Be specific about what you want)ï¼š ä½ çš„æŒ‡ä»¤è¶Šæ¸…æ™°ã€è¶Šå…·ä½“ï¼Œç»“æœå°±è¶Šå¥½ã€‚</li>\n<li>å‘Šè¯‰å®ƒä¸è¦åšä»€ä¹ˆ (Tell it what NOT to do)ï¼š Claude 4.5å°¤å…¶æœ‰è¿‡åº¦è®¾è®¡çš„å€¾å‘ã€‚å¦‚æœä½ æƒ³è¦ä¸€ä¸ªç®€çº¦çš„æ–¹æ¡ˆï¼Œå°±æ˜ç¡®å‘Šè¯‰å®ƒï¼šâ€œä¿æŒç®€å•ï¼Œä¸è¦æ·»åŠ æˆ‘æ²¡è¦æ±‚çš„æŠ½è±¡ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œåªç”¨ä¸€ä¸ªæ–‡ä»¶ã€‚â€</li>\n<li>æä¾›â€œä¸ºä»€ä¹ˆâ€çš„èƒŒæ™¯ (Give it context about why)ï¼š å‘Šè¯‰å®ƒâ€œè¿™ä¸ªåŠŸèƒ½éœ€è¦åœ¨æ¯ä¸ªè¯·æ±‚ä¸Šè¿è¡Œï¼Œæ‰€ä»¥æ€§èƒ½è‡³å…³é‡è¦â€ï¼Œæˆ–è€…â€œè¿™åªæ˜¯ä¸€ä¸ªåŸå‹ï¼Œç”¨å®Œå°±æ‰”â€ï¼Œè¿™äº›çº¦æŸä¼šå½»åº•æ”¹å˜æ¨¡å‹è§£å†³é—®é¢˜çš„æ€è·¯ã€‚</li>\n</ul>\n<p>ä¸€ä¸ªä¸“å®¶çº§çš„å·¥ä½œæµæ˜¯ï¼šç”¨Opusè¿›è¡Œè§„åˆ’å’Œæ¶æ„è®¾è®¡ï¼Œç„¶ååˆ‡æ¢åˆ°Sonnetè¿›è¡Œå…·ä½“å®ç°ã€‚ Opusæ›´æ“…é•¿å¤æ‚æ¨ç†ï¼Œè€ŒSonnetæ›´å¿«ã€æ›´ä¾¿å®œï¼Œéå¸¸é€‚åˆæ‰§è¡Œæ˜ç¡®çš„ä»»åŠ¡ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ˜¯é€šè¿‡APIæŒ‰é‡ä»˜è´¹ï¼Œç”¨Opuså†™æ¯ä¸€è¡Œä»£ç ï¼Œé‚£ä½ å¯èƒ½å¾—è€ƒè™‘å–æ‰ä¸€ä¸ªè‚¾äº†ã€‚</p>\n<p>è®°ä½è¿™ä¸ªçœŸç†ï¼šå¦‚æœä½ çš„è¾“å‡ºå¾ˆç³Ÿç³•ï¼Œé‚£æ˜¯å› ä¸ºä½ çš„è¾“å…¥å¾ˆç³Ÿç³•ã€‚æ²¡æœ‰æ·å¾„å¯èµ°ã€‚</p>\n<h2 id=\"æ³•åˆ™å…­å‹‡äºå®éªŒé…ç½®å†³å®šä½ çš„ä¸Šé™\">æ³•åˆ™å…­ï¼šå‹‡äºå®éªŒï¼Œé…ç½®å†³å®šä½ çš„ä¸Šé™ã€‚</h2>\n<p>Claudeæ‹¥æœ‰ä¸€ä¸ªæå…¶ä¸°å¯Œçš„åŠŸèƒ½ç”Ÿæ€ç³»ç»Ÿï¼šMCPæœåŠ¡å™¨ã€Hooksã€è‡ªå®šä¹‰æ–œæ å‘½ä»¤ã€settings.jsoné…ç½®ç­‰ç­‰ã€‚ä½ ä¸éœ€è¦å…¨éƒ¨æŒæ¡ï¼Œä½†ä½ åº”è¯¥å»å°è¯•å’Œå®éªŒã€‚</p>\n<ul>\n<li>MCP (Model Context Protocol): è®©Claudeè¿æ¥åˆ°å¤–éƒ¨æœåŠ¡ï¼Œå¦‚Slackã€GitHubã€æ•°æ®åº“ã€‚å¦‚æœä½ å‘ç°è‡ªå·±æ€»æ˜¯åœ¨å¤åˆ¶ç²˜è´´ä¿¡æ¯ï¼Œå¾ˆå¯èƒ½æœ‰MCPæœåŠ¡å™¨èƒ½å¸®ä½ è‡ªåŠ¨åŒ–ã€‚</li>\n<li>Hooks: è®©ä»£ç åœ¨Claudeä¿®æ”¹å‰åè‡ªåŠ¨è¿è¡Œã€‚æƒ³è®©Prettieræ ¼å¼åŒ–æ¯ä¸ªæ–‡ä»¶ï¼Ÿç”¨Hookã€‚æƒ³åœ¨æ¯æ¬¡ç¼–è¾‘åè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Ÿç”¨Hookã€‚è¿™èƒ½ç«‹å³æ•è·é—®é¢˜ã€‚</li>\n<li>è‡ªå®šä¹‰æ–œæ å‘½ä»¤: æŠŠä½ é‡å¤ä½¿ç”¨çš„æç¤ºè¯æ‰“åŒ…æˆå‘½ä»¤ã€‚åœ¨.claude/commandsæ–‡ä»¶å¤¹é‡Œåˆ›å»ºmarkdownæ–‡ä»¶ï¼Œç„¶åä½ å°±å¯ä»¥ç”¨/commandnameæ¥è¿è¡Œå®ƒä»¬ã€‚</li>\n</ul>\n<p>è¿™äº›æ¨¡å‹æ¯å‘¨éƒ½åœ¨è¿›æ­¥ã€‚ä¸€ä¸ªæœˆå‰è¡Œä¸é€šçš„åŠŸèƒ½ï¼Œç°åœ¨å¯èƒ½å·²ç»å¯ä»¥äº†ã€‚ä¿æŒå¥½å¥‡å¿ƒï¼Œä¸æ–­é‡æ–°æµ‹è¯•ã€‚</p>\n<h2 id=\"æ³•åˆ™ä¸ƒå½“ä½ è¢«å¡ä½æ—¶åœæ­¢å¼ºæ¨æ”¹å˜æ–¹æ³•\">æ³•åˆ™ä¸ƒï¼šå½“ä½ è¢«å¡ä½æ—¶ï¼Œåœæ­¢å¼ºæ¨ï¼Œæ”¹å˜æ–¹æ³•ã€‚</h2>\n<p>æœ‰æ—¶Claudeä¼šé™·å…¥ä¸€ä¸ªå¾ªç¯ï¼šå°è¯•ã€å¤±è´¥ã€å†å°è¯•ã€å†å¤±è´¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäººçš„æœ¬èƒ½æ˜¯ç»§ç»­è§£é‡Šã€æä¾›æ›´å¤šæŒ‡ä»¤ã€‚ä½†æ›´å¥½çš„åšæ³•æ˜¯å½»åº•æ”¹å˜ä½ çš„æ–¹æ³•ã€‚</p>\n<ul>\n<li>æ¸…ç©ºå¯¹è¯ (Clear the conversation)ï¼š ç´¯ç§¯çš„ä¸Šä¸‹æ–‡å¯èƒ½æ­£åœ¨è¿·æƒ‘å®ƒï¼Œä¸€ä¸ªå…¨æ–°çš„å¼€å§‹å¯ä»¥è§£å†³é—®é¢˜ã€‚</li>\n<li>ç®€åŒ–ä»»åŠ¡ (Simplify the task)ï¼š å¦‚æœä¸€ä¸ªå¤æ‚ä»»åŠ¡è®©Claudeä¸¾æ­¥ç»´è‰°ï¼ŒæŠŠå®ƒåˆ†è§£æˆæ›´å°çš„éƒ¨åˆ†ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœClaudeå¤„ç†å¤æ‚ä»»åŠ¡å¾ˆåƒåŠ›ï¼Œè¿™é€šå¸¸æ„å‘³ç€ä½ çš„åˆå§‹è®¡åˆ’å°±ä¸å¤Ÿå……åˆ†ã€‚</li>\n<li>å±•ç¤ºè€Œéå‘ŠçŸ¥ (Show instead of tell)ï¼š å¦‚æœClaudeä¸€ç›´æ— æ³•ç†è§£ï¼Œäº²æ‰‹å†™ä¸€ä¸ªæœ€å°åŒ–çš„æ­£ç¡®ç¤ºä¾‹ï¼Œç„¶åå‘Šè¯‰å®ƒï¼šâ€œçœ‹ï¼Œæœ€ç»ˆè¾“å‡ºåº”è¯¥åƒè¿™æ ·ã€‚ç°åœ¨æŠŠè¿™ä¸ªæ¨¡å¼åº”ç”¨åˆ°å…¶ä»–éƒ¨åˆ†ã€‚â€</li>\n<li>é‡æ„é—®é¢˜ (Be creative)ï¼š æ¢ä¸€ä¸ªè§’åº¦æ¥æè¿°ä½ çš„é—®é¢˜ã€‚æœ‰æ—¶å€™ä½ æœ€åˆçš„è¡¨è¿°æ–¹å¼å¯èƒ½ä¸ç¬¦åˆClaudeçš„â€œæ€ç»´æ¨¡å‹â€ã€‚</li>\n</ul>\n<p>å¦‚æœä½ å‘ç°è‡ªå·±å·²ç»é‡å¤è§£é‡Šäº†ä¸‰éï¼Œæ˜¯æ—¶å€™æ”¹å˜ç­–ç•¥äº†ã€‚</p>\n<h2 id=\"æ³•åˆ™å…«è¶…è¶ŠèŠå¤©æ¨¡å¼æ„å»ºè‡ªåŠ¨åŒ–ç³»ç»Ÿ\">æ³•åˆ™å…«ï¼šè¶…è¶ŠèŠå¤©æ¨¡å¼ï¼Œæ„å»ºè‡ªåŠ¨åŒ–ç³»ç»Ÿã€‚</h2>\n<p>çœŸæ­£ä»Claudeä¸­è·å¾—å·¨å¤§ä»·å€¼çš„äººï¼Œå¹¶ä¸ä»…ä»…æŠŠå®ƒå½“ä½œä¸€ä¸ªäº¤äº’å¼å·¥å…·ã€‚ä»–ä»¬æ­£åœ¨æ„å»ºä»¥Claudeä¸ºæ ¸å¿ƒç»„ä»¶çš„è‡ªåŠ¨åŒ–ç³»ç»Ÿã€‚</p>\n<p>é€šè¿‡ -p æ ‡å¿—ï¼Œä½ å¯ä»¥åœ¨æ— å¤´æ¨¡å¼ï¼ˆheadless modeï¼‰ä¸‹è¿è¡ŒClaudeã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç¼–å†™è„šæœ¬ï¼Œå°†å®ƒçš„è¾“å‡ºé€šè¿‡ç®¡é“ä¼ é€’ç»™å…¶ä»–å·¥å…·ï¼Œä¸bashå‘½ä»¤é“¾æ¥ï¼Œå¹¶å°†å…¶é›†æˆåˆ°è‡ªåŠ¨åŒ–å·¥ä½œæµä¸­ã€‚</p>\n<p>ä¼ä¸šæ­£åœ¨ç”¨è¿™ç§æ–¹å¼å®ç°è‡ªåŠ¨åŒ–çš„ä»£ç å®¡æŸ¥ï¼ˆPR reviewï¼‰ã€æ”¯æŒå·¥å•å“åº”ã€æ—¥å¿—è®°å½•å’Œæ–‡æ¡£æ›´æ–°ã€‚æ‰€æœ‰è¿™äº›éƒ½æ˜¯å¯è®°å½•ã€å¯å®¡è®¡çš„ï¼Œå¹¶ä¸”éšç€æ—¶é—´çš„æ¨ç§»ä¸æ–­æ”¹è¿›ã€‚</p>\n<p>è¿™å°±å½¢æˆäº†ä¸€ä¸ªå¼ºå¤§çš„é£è½®æ•ˆåº”ï¼šClaudeçŠ¯äº†ä¸€ä¸ªé”™è¯¯ï¼Œä½ å®¡æŸ¥æ—¥å¿—ï¼Œç„¶åæ”¹è¿›CLAUDE.mdæˆ–ç›¸å…³å·¥å…·ï¼Œä¸‹ä¸€æ¬¡Claudeå°±ä¼šåšå¾—æ›´å¥½ã€‚è¿™ç§æ”¹è¿›æ˜¯å¤åˆå¼çš„ã€‚å¦‚æœä½ åªåœ¨äº¤äº’æ¨¡å¼ä¸‹ä½¿ç”¨Claudeï¼Œä½ æ­£åœ¨é”™å¤±å®ƒçœŸæ­£çš„ä»·å€¼ã€‚</p>\n<h2 id=\"ç»“è¯­ä½ çš„aiä½ çš„è´£ä»»\">ç»“è¯­ï¼šä½ çš„AIï¼Œä½ çš„è´£ä»»</h2>\n<p>çœŸæ­£æŒæ¡åƒClaudeè¿™æ ·çš„AIå¼€å‘å·¥å…·ï¼Œå…³é”®åœ¨äºæ€ç»´æ¨¡å¼çš„è½¬å˜â€”â€”ä»ä¸€ä¸ªç®€å•çš„æŒ‡ä»¤å‘å‡ºè€…ï¼Œè½¬å˜ä¸ºä¸€ä¸ª meticulous çš„è§„åˆ’è€…ã€é…ç½®è€…å’Œç³»ç»Ÿæ„å»ºè€…ã€‚ä½ ä¸æ˜¯åœ¨å’Œå®ƒèŠå¤©ï¼Œä½ æ˜¯åœ¨ç¼–ç¨‹å®ƒã€‚</p>\n<p>æœ€åï¼Œç•™ç»™ä½ ä¸€ä¸ªé—®é¢˜æ€è€ƒï¼š å¦‚æœä½ ä¸æŠŠClaudeå½“ä½œèŠå¤©æœºå™¨äººï¼Œè€Œæ˜¯çœ‹ä½œä¸€ä¸ªå¯ç¼–ç¨‹çš„å›¢é˜Ÿæˆå‘˜ï¼Œä½ æœ€å…ˆä¼šè‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹çš„å“ªä¸ªéƒ¨åˆ†ï¼Ÿ</p>\n<p>æ›´å¤šå…³äºAI Codingçš„å†…å®¹å¯å…³æ³¨æˆ‘çš„<a href=\"https://didispace.com\" rel=\"noopener nofollow\" target=\"_blank\">åšå®¢</a>è·å–æŒç»­æ›´æ–°ã€‚</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 19:53</span>&nbsp;\n<a href=\"https://www.cnblogs.com/didispace\">ç¨‹åºçŒ¿DD</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">67</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "`i` å’Œ `e` å†™åå¼•å‘çš„è¡€æ¡ˆï¼šå½“ AI çš„â€œçº é”™ç™–â€é‡ä¸Š NexusContract çš„â€œç…§å¦–é•œâ€",
      "link": "https://www.cnblogs.com/jieky/p/19481961",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/jieky/p/19481961\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 14:19\">\n    <span>`i` å’Œ `e` å†™åå¼•å‘çš„è¡€æ¡ˆï¼šå½“ AI çš„â€œçº é”™ç™–â€é‡ä¸Š NexusContract çš„â€œç…§å¦–é•œâ€</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none;\">\n        \n        åœ¨å¯¹æ¥æŸå¤´éƒ¨æ”¯ä»˜ç½‘å…³æ—¶ï¼Œæˆ‘é­é‡äº†ä¸€æ¬¡å®Œç¾çš„â€œé™ç»´æ‰“å‡»â€ã€‚å®˜æ–¹æ–‡æ¡£é‡Œä¸€ä¸ªæŠŠ `ei` å†™æˆ `ie` çš„è‹±è¯­è¯­æ³•é”™è¯¯ï¼Œéª—è¿‡äº† AI çš„è¯­æ³•æ£€æŸ¥ï¼Œä¹Ÿéª—è¿‡äº†æˆ‘çš„è‚‰çœ¼ Reviewã€‚æœ¬æ–‡å°†æ¢è®¨ NexusContract å¦‚ä½•é€šè¿‡**å…ƒæ•°æ®éš”ç¦»**æœºåˆ¶ï¼Œåœ¨æ··ä¹±çš„é—ç•™æ¥å£ä¸ç°ä»£åŒ–çš„æ•´æ´ä»£ç ä¹‹é—´å»ºç«‹ä¸€é“é˜²çº¿ã€‚\n    </div>\n<div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"i-å’Œ-e-å†™åå¼•å‘çš„è¡€æ¡ˆå½“-ai-çš„çº é”™ç™–é‡ä¸Š-nexuscontract-çš„ç…§å¦–é•œ\"><code>i</code> å’Œ <code>e</code> å†™åå¼•å‘çš„è¡€æ¡ˆï¼šå½“ AI çš„â€œçº é”™ç™–â€é‡ä¸Š NexusContract çš„â€œç…§å¦–é•œâ€</h1>\n<blockquote>\n<p><strong>æ‘˜è¦</strong>ï¼šåœ¨å¯¹æ¥æŸå¤´éƒ¨æ”¯ä»˜ç½‘å…³æ—¶ï¼Œæˆ‘é­é‡äº†ä¸€æ¬¡å®Œç¾çš„â€œé™ç»´æ‰“å‡»â€ã€‚å®˜æ–¹æ–‡æ¡£é‡Œä¸€ä¸ªæŠŠ <code>ei</code> å†™æˆ <code>ie</code> çš„è‹±è¯­è¯­æ³•é”™è¯¯ï¼Œéª—è¿‡äº† AI çš„è¯­æ³•æ£€æŸ¥ï¼Œä¹Ÿéª—è¿‡äº†æˆ‘çš„è‚‰çœ¼ Reviewã€‚æœ¬æ–‡å°†æ¢è®¨ NexusContract å¦‚ä½•é€šè¿‡<strong>å…ƒæ•°æ®éš”ç¦»</strong>æœºåˆ¶ï¼Œåœ¨æ··ä¹±çš„é—ç•™æ¥å£ä¸ç°ä»£åŒ–çš„æ•´æ´ä»£ç ä¹‹é—´å»ºç«‹ä¸€é“é˜²çº¿ã€‚</p>\n</blockquote>\n<h2 id=\"1-è¯¡å¼‚çš„-parameter_missing\">1. è¯¡å¼‚çš„ <code>PARAMETER_MISSING</code></h2>\n<p>æ•…äº‹å‘ç”Ÿåœ¨ä¸ä¹…å‰ï¼Œæˆ‘ä»¬æ­£åœ¨é‡æ„å†…éƒ¨çš„ä¸€ä¸ªè¿è¡Œäº†å‡ å¹´çš„è€æ—§æ”¯ä»˜ç½‘å…³ã€‚</p>\n<p>ä¸ºäº†æé«˜é‡æ„æ•ˆç‡ï¼Œæˆ‘æŠŠæ—§çš„æ–‡æ¡£æˆªå›¾å–‚ç»™äº† AIï¼ˆæŸçŸ¥åå¤§æ¨¡å‹ï¼‰ï¼Œè®©å®ƒå¸®æˆ‘ç”Ÿæˆç¬¦åˆ NexusContract è§„èŒƒçš„ C# DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰ã€‚AI çš„è¡¨ç°å ªç§°å®Œç¾ï¼Œç¬é—´åå‡ºäº†ç»“æ„æ¸…æ™°çš„ä»£ç ï¼š</p>\n<pre><code class=\"language-csharp\">public string ReceiverId { get; set; } // æ”¶æ¬¾æ–¹ID\n\n</code></pre>\n<p>ä»£ç çœ‹ç€æ²¡æ¯›ç—…ï¼Œå‘½åä¹Ÿè§„èŒƒã€‚æˆ‘æ»¡æ€€ä¿¡å¿ƒåœ°å¯åŠ¨æœåŠ¡ï¼Œå¼€å§‹<strong>æœ¬åœ°è”è°ƒ</strong>ã€‚</p>\n<p><strong>ç»“æœï¼Œæ¥å£æ­»æ´»ä¸é€šã€‚</strong></p>\n<p>ä¸Šæ¸¸ç½‘å…³ä¸€ç›´è¿”å›å†·å†°å†°çš„é”™è¯¯ï¼š<code>PARAMETER_MISSING</code>ã€‚</p>\n<p>è¿™å°±å¾ˆé‚ªé—¨äº†ã€‚<br />\næˆ‘æ‰“äº†æ–­ç‚¹ï¼Œæ•°æ®åœ¨ï¼›<br />\næŠ“äº†åŒ…ï¼ŒJSON å­—æ®µä¹Ÿæœ‰ï¼›<br />\næˆ‘è‚‰çœ¼æ£€æŸ¥äº†ä¸‰éï¼Œ<code>ReceiverId</code> æ‹¼å†™ç»å¯¹æ²¡é—®é¢˜ï¼›<br />\næˆ‘åˆè®© AI æ£€æŸ¥äº†ä¸€éä»£ç ï¼Œå®ƒä¹Ÿä¿¡èª“æ—¦æ—¦åœ°è¯´æ²¡æœ‰è¯­æ³•é”™è¯¯ã€‚</p>\n<p><strong>æ•´æ•´ä¸¤ä¸ªå°æ—¶ï¼Œæˆ‘å°±å¡åœ¨è¿™ä¸ªè«åå…¶å¦™çš„é”™è¯¯ä¸Šï¼Œç”šè‡³å¼€å§‹æ€€ç–‘æ˜¯ä¸æ˜¯ HTTP åè®®å¤´çš„é—®é¢˜ï¼Œæˆ–è€…æ˜¯ JSON åºåˆ—åŒ–åº“çš„ Bugã€‚</strong></p>\n<p>ç›´åˆ°æˆ‘å®åœ¨æ²¡æ‹›äº†ï¼Œå†æ¬¡æ‰“å¼€é‚£ä»½æ–‡æ¡£ï¼Œå¼ºè¿«è‡ªå·±ä¸€ä¸ªå­—æ¯ä¸€ä¸ªå­—æ¯åœ°è·Ÿæˆ‘çš„ä»£ç æ¯”å¯¹æ—¶ï¼Œæˆ‘æ‰å‘ç°äº†ä¸€ä¸ªä»¤äººçª’æ¯çš„ç»†èŠ‚ï¼š</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/45234/202601/45234-20260114141433336-590884100.png\" /></p>\n<p><strong>æ–‡æ¡£é‡Œå†™çš„å­—æ®µåï¼Œæ˜¯ <code>recieverId</code>ã€‚</strong></p>\n<p>æ³¨æ„åˆ°äº†å—ï¼Ÿ<strong><code>i</code> å’Œ <code>e</code> å†™åäº†ï¼</strong></p>\n<p>æ­£ç¡®çš„è‹±è¯­å•è¯æ˜¯ <code>Receiver</code>ï¼ˆc åé¢æ¥ eiï¼‰ï¼Œä½†æ–‡æ¡£é‡Œå†™æˆäº† <code>Reciever</code>ï¼ˆieï¼‰ã€‚è¿™ç§â€œé•¿å¾—æåƒâ€çš„é”™è¯¯ï¼Œæå…¶å®¹æ˜“å‘ç”Ÿè§†é”™è§‰ã€‚</p>\n<p>é‚£ä¸€åˆ»æˆ‘ç®€ç›´æƒ³æ‘”é”®ç›˜ï¼š<strong>AI å¤ªâ€œèªæ˜â€äº†ã€‚</strong> å®ƒè¯†åˆ«å‡ºè¿™æ˜¯â€œæ”¶æ¬¾æ–¹â€çš„æ„æ€ï¼Œå‘ç°äº†è¿™ä¸ªè¯­æ³•é”™è¯¯ï¼Œäºæ˜¯<strong>å¥½å¿ƒåœ°åœ¨ç”Ÿæˆä»£ç æ—¶å¸®æˆ‘æŠŠå®ƒâ€œæ”¹å¯¹â€äº†</strong>ã€‚è€Œæˆ‘ï¼Œä½œä¸ºä¸€ä¸ªæ­£å¸¸çš„äººç±»ç¨‹åºå‘˜ï¼Œå¤§è„‘ä¹Ÿè‡ªåŠ¨è¿‡æ»¤äº†è¿™ä¸ªæ‹¼å†™é”™è¯¯ã€‚</p>\n<p>åœ¨é—ç•™ç³»ç»Ÿçš„é›†æˆä¸­ï¼Œ<strong>â€œå†å²çš„é”™è¯¯â€å¾€å¾€æ¯”â€œæ­£ç¡®çš„è¯­æ³•â€æ›´é‡è¦</strong>ã€‚</p>\n<h2 id=\"2-æ¶æ„çš„åå‡»ä»£ç æ´ç™–ä¸è‚®è„ç°å®\">2. æ¶æ„çš„åå‡»ï¼šä»£ç æ´ç™–ä¸è‚®è„ç°å®</h2>\n<p>é¢å¯¹è¿™ç§åœºæ™¯ï¼Œä¼ ç»Ÿåšæ³•é€šå¸¸æœ‰ä¸¤ç§ï¼š</p>\n<ol>\n<li><strong>åŒæµåˆæ±¡æ´¾ï¼š</strong> ç›´æ¥æŠŠ C# å±æ€§åä¹Ÿå†™é”™ã€‚</li>\n</ol>\n<pre><code class=\"language-csharp\">public string RecieverId { get; set; } // çœ‹ç€å°±éš¾å—ï¼Œé€¼æ­»å¼ºè¿«ç—‡\n\n</code></pre>\n<p>è¿™æœ‰ä¸ªå·¨å¤§çš„éšæ‚£ï¼šæ–°æ¥çš„åŒäº‹æˆ–è€…åæ¥ç»´æŠ¤çš„ AIï¼Œçœ‹åˆ°è¿™ä¸ªâ€œé”™è¯¯æ‹¼å†™â€ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šé¡ºæ‰‹æŠŠå®ƒâ€œä¿®å¤â€æˆæ­£ç¡®çš„ <code>ReceiverId</code>ï¼Œç„¶å<strong>ç °ï¼ç³»ç»ŸåˆæŒ‚äº†ã€‚</strong><br />\n2. <strong>æ‰‹åŠ¨æ˜ å°„æ´¾ï¼š</strong> åœ¨ä¸šåŠ¡ä»£ç é‡Œæ‰‹åŠ¨å†™ <code>json[\"recieverId\"] = request.ReceiverId</code>ã€‚<br />\nè¿™ä¼šå¯¼è‡´ä¸šåŠ¡é€»è¾‘é‡Œå……æ–¥ç€å¤§é‡çš„å­—ç¬¦ä¸²ç¡¬ç¼–ç ï¼Œç»´æŠ¤æˆæœ¬æé«˜ã€‚</p>\n<p><strong>NexusContract çš„å“²å­¦æ˜¯ï¼š</strong> æˆ‘ä»¬æ”¹å˜ä¸äº†å¤–éƒ¨ä¸–ç•Œçš„â€œæ–‡ç›²â€æ‹¼å†™ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¶æ„æ‰‹æ®µï¼Œä¸è®©è¿™äº›â€œè„ä¸œè¥¿â€æ±¡æŸ“æˆ‘ä»¬çš„æ ¸å¿ƒä»£ç ã€‚</p>\n<p>æˆ‘ä»¬é‡‡ç”¨äº† <strong>[ApiField]</strong> ç‰¹æ€§æ¥å®ç° <strong>ç‰©ç†éš”ç¦»</strong>ï¼š</p>\n<pre><code class=\"language-csharp\">[ApiOperation(\"payment.gateway.pay\", HttpVerb.POST)]\npublic class PaymentRequest : IApiRequest\n{\n    // ç»™å¯¹æ–¹çœ‹çš„ï¼ˆå¿…é¡»é”™ï¼‰ï¼šæ˜ å°„åˆ°é‚£ä¸ªæŠŠ ie å†™åçš„è„å­—æ®µ\n    [ApiField(\"recieverId\", IsRequired = true)]\n    \n    // ç»™è‡ªå·±çœ‹çš„ï¼ˆå¿…é¡»å¯¹ï¼‰ï¼šä¿æŒå†…éƒ¨é¢†åŸŸè¯­è¨€çš„çº¯æ´æ€§\n    public string ReceiverId { get; set; }\n}\n\n</code></pre>\n<p>è¿™ä¸ä»…æ˜¯ç®€å•çš„é‡å‘½åï¼Œè¿™æ˜¯ <strong>è¯­ä¹‰è§£è€¦ (Semantic Decoupling)</strong>ã€‚</p>\n<ul>\n<li><strong>å±æ€§å (Property):</strong> æœåŠ¡äºå†…éƒ¨é€»è¾‘ï¼Œä½¿ç”¨ <strong>Ubiquitous Language (é€šç”¨è¯­è¨€)</strong>ï¼Œå¿…é¡»æ­£ç¡®ã€å¯è¯»ã€‚</li>\n<li><strong>ç‰¹æ€§å (Attribute):</strong> æœåŠ¡äºå¤–éƒ¨å¥‘çº¦ï¼Œæ˜¯å¯¹å†å²äº‹å®çš„ <strong>å¿«ç…§</strong>ï¼Œå¿…é¡»çœŸå®ã€å“ªæ€•æ˜¯é”™çš„ã€‚</li>\n</ul>\n<h2 id=\"3-æ·±åº¦è§£å¯†nexuscontractcore-çš„é»‘ç›’\">3. æ·±åº¦è§£å¯†ï¼šNexusContract.Core çš„é»‘ç›’</h2>\n<p>è¿™æ—¶ä½ å¯èƒ½ä¼šé—®ï¼š<em>â€œå¸‚é¢ä¸Šå¾ˆå¤š JSON åº“éƒ½æœ‰ <code>JsonProperty</code>ï¼Œè¿™æœ‰ä»€ä¹ˆç¨€å¥‡çš„ï¼Ÿâ€</em></p>\n<p>åŒºåˆ«åœ¨äº <strong>å¤„ç†æ—¶æœº</strong> å’Œ <strong>ç¡®å®šæ€§</strong>ã€‚</p>\n<p>NexusContract åœ¨ <strong>ç³»ç»Ÿå¯åŠ¨ (Startup)</strong> æ—¶ï¼Œä¼šæ‰§è¡Œä¸€ä¸ª <strong>[å†³ç­– A-301] å…ƒæ•°æ®å†·å†» (Metadata Freezing)</strong> æµç¨‹ã€‚</p>\n<p>è™½ç„¶æ¡†æ¶åœ¨å¯åŠ¨æ—¶æ— æ³•çŸ¥é“å¤–éƒ¨æ¥å£åˆ°åº•å« <code>recieverId</code> è¿˜æ˜¯ <code>receiverId</code>ï¼ˆé™¤éæˆ‘ä»¬æœ‰ Schema æ–‡ä»¶ï¼‰ï¼Œä½†å®ƒåšäº†ä¸€ä»¶æ›´é‡è¦çš„äº‹ï¼š<strong>ç¡®ç«‹å¥‘çº¦çš„ç»å¯¹æƒå¨</strong>ã€‚</p>\n<h3 id=\"æ ¸å¿ƒä»£ç å±•ç¤º\">æ ¸å¿ƒä»£ç å±•ç¤º</h3>\n<pre><code class=\"language-csharp\">// Copyright (c) 2026 NexusContract. All rights reserved.\n\nusing System.Collections.Concurrent;\nusing System.Reflection;\nusing NexusContract.Abstractions.Exceptions;\n\nnamespace NexusContract.Core.Reflection\n{\n    /// &lt;summary&gt;\n    /// ã€å†³ç­– A-301ã€‘NexusContractMetadataRegistryï¼ˆå¥‘çº¦å…ƒæ•°æ®æ³¨å†Œè¡¨ï¼‰\n    /// \n    /// æ ¸å¿ƒèŒèƒ½ï¼š\n    /// 1. å‘ç°ï¼ˆDiscoveryï¼‰ï¼šå¯åŠ¨æ—¶æ‰«ææ‰€æœ‰å¥‘çº¦ç±»çš„ Attribute ç»“æ„\n    /// 2. éªŒè¯ï¼ˆValidationï¼‰ï¼šæ‰§è¡Œ ContractValidator ç¡®ä¿å†…éƒ¨çº¦æŸï¼ˆå¦‚ Getter/Setter å®Œæ•´æ€§ï¼‰\n    /// 3. å†»ç»“ï¼ˆFreezingï¼‰ï¼šå°†åå°„ç»“æœè½¬ä¸ºä¸å¯å˜å¯¹è±¡ï¼Œè¿è¡ŒæœŸé›¶åå°„æŸè€—\n    /// &lt;/summary&gt;\n    public sealed class NexusContractMetadataRegistry\n    {\n        // å•ä¾‹æ¨¡å¼ï¼šç¡®ä¿å…¨å±€å”¯ä¸€æ³¨å†Œè¡¨\n        private static readonly Lazy&lt;NexusContractMetadataRegistry&gt; _instance = new(() =&gt; new NexusContractMetadataRegistry());\n        public static NexusContractMetadataRegistry Instance =&gt; _instance.Value;\n\n        // ã€å†³ç­– A-302ã€‘æ ¸å¿ƒå†·å†»åº“\n        // Key: å¥‘çº¦ç±»å‹, Value: é¢„ç¼–è¯‘å¥½çš„å…ƒæ•°æ®ï¼ˆåŒ…å« Expression Tree å§”æ‰˜ï¼‰\n        private readonly ConcurrentDictionary&lt;Type, ContractMetadata&gt; _cache = new();\n\n        private NexusContractMetadataRegistry() { }\n\n        /// &lt;summary&gt;\n        /// ã€å†³ç­– A-308ã€‘å¯åŠ¨æœŸä½“æ£€ï¼ˆStartup Health Checkï¼‰\n        /// è¿™ä¸æ˜¯ç®€å•çš„åŠ è½½ï¼Œè€Œæ˜¯ä¸€æ¬¡å…¨é‡çš„â€œCTæ‰«æâ€ã€‚\n        /// ç¡®ä¿æ‰€æœ‰å¥‘çº¦åœ¨ç‰©ç†ä¸Šæ˜¯åˆæ³•çš„ï¼ˆä¾‹å¦‚é˜²æ­¢ Attribute é‡å¤å®šä¹‰ï¼‰ã€‚\n        /// &lt;/summary&gt;\n        public DiagnosticReport Preload(IEnumerable&lt;Type&gt; types)\n        {\n            var globalReport = new DiagnosticReport();\n\n            foreach (var type in types)\n            {\n                // 1. é™æ€éªŒè¯ï¼ˆå­—æ®µæ‹¼å†™ã€Attribute å†²çªç­‰ï¼‰\n                var perTypeReport = new DiagnosticReport();\n                ContractValidator.Validate(type, perTypeReport);\n\n                // 2. å¦‚æœéªŒè¯é€šè¿‡ï¼Œæ„å»ºä¸å¯å˜å…ƒæ•°æ®\n                if (!perTypeReport.HasErrors)\n                {\n                    try \n                    {\n                        var metadata = BuildMetadata(type, perTypeReport);\n                        _cache.TryAdd(type, metadata); // å†»ç»“å…¥åº“\n                    }\n                    catch (Exception ex)\n                    {\n                        perTypeReport.AddCritical(type.Name, $\"Metadata freeze failed: {ex.Message}\");\n                    }\n                }\n                globalReport.Merge(perTypeReport);\n            }\n            return globalReport; // è¿”å›ä½“æ£€æŠ¥å‘Š\n        }\n\n        /// &lt;summary&gt;\n        /// æ„å»ºå…ƒæ•°æ®æ ¸å¿ƒæµï¼šå®¡è®¡ -&gt; ç¼–è¯‘ -&gt; å°è£…\n        /// &lt;/summary&gt;\n        private ContractMetadata BuildMetadata(Type type, DiagnosticReport report)\n        {\n            // ... (çœç•¥éƒ¨åˆ†ä»£ç ) ...\n\n            // ã€å†³ç­– A-309ã€‘å¯ç”¨ Expression Tree é¢„ç¼–è¯‘ï¼ˆçœŸæ­£é›¶åå°„ï¼‰\n            // å°†åå°„è¯»å†™è½¬æ¢ä¸ºå¼ºç±»å‹å§”æ‰˜ï¼Œæ€§èƒ½æå‡ 10 å€\n            var projector = ContractMetadataCompiler.CompileProjector(type, propertyMetadatas);\n            var hydrator = ContractMetadataCompiler.CompileHydrator(type, propertyMetadatas);\n\n            return new ContractMetadata(type, opAttr, propertyMetadatas.AsReadOnly(), projector, hydrator);\n        }\n    }\n}\n\n</code></pre>\n<h3 id=\"æŠ€æœ¯åŸç†è§£è¯»\">æŠ€æœ¯åŸç†è§£è¯»</h3>\n<p><strong>ä¸ºä»€ä¹ˆè¿™å¯¹æ’æŸ¥ Bug å¾ˆæœ‰ç”¨ï¼Ÿ</strong></p>\n<p>è™½ç„¶ <code>PARAMETER_MISSING</code> æ˜¯åœ¨è¿è¡Œæ—¶æŠ¥å‡ºæ¥çš„ï¼Œä½† NexusContract çš„æœºåˆ¶ä¿è¯äº†<strong>ä¿®å¤çš„å»‰ä»·æ€§ä¸ç¡®å®šæ€§</strong>ã€‚</p>\n<ol>\n<li><strong>Expression Tree é¢„ç¼–è¯‘ï¼š</strong><br />\nä¸€æ—¦æˆ‘ä»¬åœ¨ Attribute é‡ŒæŠŠåå­—ä¿®æ­£ä¸º <code>[ApiField(\"recieverId\")]</code>ï¼Œæ¡†æ¶åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶ï¼Œä¼šé€šè¿‡ <strong>Expression Tree</strong> æŠŠè¿™ä¸ªæ˜ å°„å…³ç³»ç¼–è¯‘æˆé«˜æ•ˆçš„ Delegateã€‚<br />\nè¿™æ„å‘³ç€ï¼šå³ä½¿ä¸ºäº†å…¼å®¹è€æ¥å£è€ŒåŠ äº† Attributeï¼Œ<strong>è¿è¡Œæ—¶æ€§èƒ½ä¾ç„¶ç­‰åŒäºæ‰‹å†™ä»£ç </strong>ï¼Œå®Œå…¨æ²¡æœ‰åå°„çš„é¢å¤–å¼€é”€ã€‚</li>\n<li><strong>å¥‘çº¦çš„æ˜¾å¼åŒ–ï¼š</strong><br />\nè¿™ç§å†™æ³•å¼ºè¿«å¼€å‘è€…å»ç¡®è®¤æ¯ä¸€ä¸ªå­—æ®µçš„æ˜ å°„å…³ç³»ã€‚ä»£ç é‡Œçš„ <code>[ApiField]</code> å°±åƒä¸€ä¸ªä¸ªè­¦ç¤ºç‰Œï¼Œæ—¶åˆ»æé†’ç€åæ¥è€…ï¼š<strong>â€œæ³¨æ„ï¼Œè¿™é‡Œæœ‰ä¸ªå‘ï¼Œåˆ«åŠ¨ï¼â€</strong></li>\n</ol>\n<h2 id=\"4-ç»“è¯­\">4. ç»“è¯­</h2>\n<p>ä»¥å‰æˆ‘ä»¬æ€• AI çç¼–ä»£ç ï¼ˆå¹»è§‰ï¼‰ï¼Œç°åœ¨æˆ‘ä»¬æ€• AI <strong>ä»£ç å†™å¾—å¤ªå¯¹</strong>ã€‚</p>\n<p>é¢å¯¹æŸè”ã€æŸé“¶è¡Œã€æŸæ”¯ä»˜é‚£äº›åå‡ å¹´å‰çš„â€œè€ƒå¤çº§â€æ¥å£ï¼ŒAI è¿™ç§æ‹¿ç‰›æ´¥è¯å…¸å½“æ ‡å‡†çš„â€œé«˜æç”Ÿâ€æ ¹æœ¬æ°´åœŸä¸æœã€‚å®ƒä¸çŸ¥é“ <code>recieverId</code> åœ¨è¿™é‡Œä¸æ˜¯æ‹¼å†™é”™è¯¯ï¼Œå®ƒæ˜¯<strong>æ³•å¾‹</strong>ï¼Œæ˜¯<strong>ä¸å¯åŠ¨æ‘‡çš„å¥‘çº¦</strong>ã€‚</p>\n<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ NexusContract â€”â€” <strong>å®ƒå…è®¸æˆ‘ä»¬åœ¨ä»£ç é‡Œä¼˜é›…åœ°â€œæŒ‡é¹¿ä¸ºé©¬â€ï¼Œå¹¶ç”¨æœ€åº•å±‚çš„æŠ€æœ¯æ‰‹æ®µï¼ˆå…ƒæ•°æ®å†·å†»ï¼‰ï¼Œå°†è¿™ä»½â€œè‚®è„çš„ç°å®â€é«˜æ€§èƒ½åœ°å°è£…èµ·æ¥ã€‚</strong></p>\n<hr />\n\n</div>\n<div id=\"MySignature\">\n    <p>______________________________________<br />ç”Ÿæ´»ï¼Œè¦ç”¨åœ£äººçš„èƒ¸æ€€é¢å¯¹ï¼Œç”¨ç§‘å­¦çš„æ–¹æ³•æ”¯é…ï¼Œ <br />&nbsp; &nbsp; &nbsp; &nbsp; ç”¨çš‡å¸çš„å¾¡è†³å…»èƒƒï¼Œç”¨æ¸…æ´çš„ç©ºæ°”æ´—è‚ºï¼Œ <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ç”¨å°çŒªçš„æ„Ÿè§‰å»ç¡ï¼Œç”¨å¤ªé˜³çš„çƒ­æƒ…çŒæ°´ã€‚<br />______________________________________</p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 14:19</span>&nbsp;\n<a href=\"https://www.cnblogs.com/jieky\">æ¶ˆå¤±è€…</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">45</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "åŸºäºæœ¬åœ°çš„ComfyUIçš„APIè°ƒç”¨æŒ‡å—",
      "link": "https://www.cnblogs.com/zer0Black/p/19484326",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/zer0Black/p/19484326\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 21:31\">\n    <span>åŸºäºæœ¬åœ°çš„ComfyUIçš„APIè°ƒç”¨æŒ‡å—</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"åŸºäºæœ¬åœ°çš„comfyui-apiè°ƒç”¨æŒ‡å—\">åŸºäºæœ¬åœ°çš„ComfyUI APIè°ƒç”¨æŒ‡å—</h1>\n<p>ComfyUIä½œä¸ºæ–‡ç”Ÿå›¾ã€æ–‡ç”Ÿè§†é¢‘ã€å›¾ç”Ÿå›¾ã€å›¾ç”Ÿè§†é¢‘çš„å„ç±»æ¨¡å‹çš„å·¥ä½œæµéƒ½éå¸¸å¥½ç”¨ï¼Œå¯ç»„åˆå„ç§æ¨¡å‹å’ŒLoraã€‚ä½†æ˜¯æƒ³è¦é€šè¿‡APIè°ƒç”¨ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œä¸”æ— å®Œå–„çš„æ–‡æ¡£ã€‚</p>\n<p>æœ¬æ–‡é˜è¿°äº†ComfyUI APIè°ƒç”¨å®Œæ•´æŒ‡å—,æ¶µç›–å·¥ä½œæµå¯¼å‡ºã€APIè°ƒç”¨æµç¨‹ã€å‚æ•°è¯´æ˜åŠPythonä»£ç å®ç°ã€‚</p>\n<h2 id=\"é›¶ä»£ç \">é›¶ã€ä»£ç </h2>\n<p>ä¸æƒ³çœ‹å¤ªå¤šå­—ï¼Œç›´æ¥ä¸‹è½½DemoæŸ¥çœ‹ç¤ºä¾‹å³å¯<br />\n<code>https://github.com/zer0Black/ComfyUI-Api-Demo</code></p>\n<h2 id=\"ä¸€æ¦‚è¿°\">ä¸€ã€æ¦‚è¿°</h2>\n<p>ComfyUIæä¾›äº†å¼ºå¤§çš„APIæ¥å£,å…è®¸å¼€å‘è€…é€šè¿‡ç¼–ç¨‹æ–¹å¼è°ƒç”¨ComfyUIå·¥ä½œæµ,å®ç°AIå›¾åƒç”Ÿæˆçš„è‡ªåŠ¨åŒ–ã€‚é€šè¿‡APIè°ƒç”¨,å¯ä»¥æ‰¹é‡ç”Ÿæˆå›¾åƒã€é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿä¸­,å¤§å¹…æå‡å·¥ä½œæ•ˆç‡ã€‚</p>\n<h2 id=\"äºŒå‡†å¤‡å·¥ä½œ\">äºŒã€å‡†å¤‡å·¥ä½œ</h2>\n<h3 id=\"21-æ­å»ºå·¥ä½œæµ\">2.1 æ­å»ºå·¥ä½œæµ</h3>\n<p>åœ¨ComfyUI WebUIä¸­æŒ‰ç…§éœ€æ±‚æ­å»ºå·¥ä½œæµ:</p>\n<ol>\n<li>æ‰“å¼€ComfyUIç•Œé¢,æ‹–æ‹½æ‰€éœ€çš„èŠ‚ç‚¹</li>\n<li>è¿æ¥èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®æµ</li>\n<li>é…ç½®èŠ‚ç‚¹å‚æ•°(æ¨¡å‹ã€æç¤ºè¯ã€é‡‡æ ·å™¨ç­‰)</li>\n<li>ç‚¹å‡»\"Queue Prompt\"æµ‹è¯•å·¥ä½œæµæ˜¯å¦èƒ½æ­£å¸¸ç”Ÿæˆå›¾åƒ</li>\n<li>ç¡®è®¤å·¥ä½œæµè¿è¡Œæ— è¯¯å,å‡†å¤‡å¯¼å‡º</li>\n</ol>\n<h3 id=\"22-å¯¼å‡ºapiæ ¼å¼çš„jsonæ–‡ä»¶\">2.2 å¯¼å‡ºAPIæ ¼å¼çš„JSONæ–‡ä»¶</h3>\n<p>å¯¼å‡ºæ­¥éª¤:</p>\n<ol>\n<li>åœ¨ComfyUIç•Œé¢ç‚¹å‡»é¡¶éƒ¨èœå•æ çš„<strong>å·¥ä½œæµ</strong> (Workflow)</li>\n<li>é€‰æ‹©<strong>å¯¼å‡º(API)</strong> (Export API)</li>\n<li>æµè§ˆå™¨ä¼šè‡ªåŠ¨ä¸‹è½½ä¸€ä¸ªJSONæ–‡ä»¶,é€šå¸¸å‘½åä¸º<code>workflow_api.json</code></li>\n</ol>\n<p><img alt=\"file-20260114211440458\" class=\"lazyload\" /></p>\n<p>é‡è¦æç¤º: å¯¼å‡ºçš„JSONæ–‡ä»¶åŒ…å«äº†å·¥ä½œæµçš„å®Œæ•´é…ç½®,åŒ…æ‹¬æ‰€æœ‰èŠ‚ç‚¹çš„IDã€å‚æ•°å’Œè¿æ¥å…³ç³»ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯APIè°ƒç”¨çš„æ ¸å¿ƒè¾“å…¥ã€‚</p>\n<h2 id=\"ä¸‰jsonæ–‡ä»¶è¯¦è§£\">ä¸‰ã€JSONæ–‡ä»¶è¯¦è§£</h2>\n<h3 id=\"31-jsonæ–‡ä»¶ç»“æ„\">3.1 JSONæ–‡ä»¶ç»“æ„</h3>\n<p>å¯¼å‡ºçš„<code>workflow_api.json</code>æ–‡ä»¶æ˜¯ä¸€ä¸ªå­—å…¸,é”®ä¸ºèŠ‚ç‚¹ID,å€¼ä¸ºèŠ‚ç‚¹é…ç½®:</p>\n<pre><code>{\n  \"60\": {\n    \"inputs\": {\n      \"filename_prefix\": \"Qwen-Image-2512\",\n      \"images\": [\n        \"86:8\",\n        0\n      ]\n    },\n    \"class_type\": \"SaveImage\",\n    \"_meta\": {\n      \"title\": \"ä¿å­˜å›¾åƒ\"\n    }\n  },\n  \"91\": {\n    \"inputs\": {\n      \"value\": \"æç¤ºè¯å†™åœ¨è¿™\"\n    },\n    \"class_type\": \"PrimitiveStringMultiline\",\n    \"_meta\": {\n      \"title\": \"Prompt\"\n    }\n  },\n  \"86:39\": {\n    \"inputs\": {\n      \"vae_name\": \"qwen_image_vae.safetensors\"\n    },\n    \"class_type\": \"VAELoader\",\n    \"_meta\": {\n      \"title\": \"åŠ è½½VAE\"\n    }\n  },\n  \"86:38\": {\n    \"inputs\": {\n      \"clip_name\": \"qwen_2.5_vl_7b_fp8_scaled.safetensors\",\n      \"type\": \"qwen_image\",\n      \"device\": \"default\"\n    },\n    \"class_type\": \"CLIPLoader\",\n    \"_meta\": {\n      \"title\": \"åŠ è½½CLIP\"\n    }\n  },\n  \"86:37\": {\n    \"inputs\": {\n      \"unet_name\": \"qwen_image_2512_fp8_e4m3fn.safetensors\",\n      \"weight_dtype\": \"default\"\n    },\n    \"class_type\": \"UNETLoader\",\n    \"_meta\": {\n      \"title\": \"UNetåŠ è½½å™¨\"\n    }\n  },\n  \"86:3\": {\n    \"inputs\": {\n      \"seed\": 4,\n      \"steps\": 50,\n      \"cfg\": 4,\n      \"sampler_name\": \"euler\",\n      \"scheduler\": \"simple\",\n      \"denoise\": 1,\n      \"model\": [\n        \"86:66\",\n        0\n      ],\n      \"positive\": [\n        \"86:81\",\n        0\n      ],\n      \"negative\": [\n        \"86:7\",\n        0\n      ],\n      \"latent_image\": [\n        \"86:58\",\n        0\n      ]\n    },\n    \"class_type\": \"KSampler\",\n    \"_meta\": {\n      \"title\": \"Ké‡‡æ ·å™¨\"\n    }\n  },\n  \"86:58\": {\n    \"inputs\": {\n      \"width\": 1664,\n      \"height\": 928,\n      \"batch_size\": 1\n    },\n    \"class_type\": \"EmptySD3LatentImage\",\n    \"_meta\": {\n      \"title\": \"ç©ºLatentå›¾åƒï¼ˆSD3ï¼‰\"\n    }\n  },\n  \"86:81\": {\n    \"inputs\": {\n      \"text\": [\n        \"91\",\n        0\n      ],\n      \"clip\": [\n        \"86:38\",\n        0\n      ]\n    },\n    \"class_type\": \"CLIPTextEncode\",\n    \"_meta\": {\n      \"title\": \"CLIP Text Encode (Positive Prompt)\"\n    }\n  },\n  \"86:8\": {\n    \"inputs\": {\n      \"samples\": [\n        \"86:3\",\n        0\n      ],\n      \"vae\": [\n        \"86:39\",\n        0\n      ]\n    },\n    \"class_type\": \"VAEDecode\",\n    \"_meta\": {\n      \"title\": \"VAEè§£ç \"\n    }\n  },\n  \"86:66\": {\n    \"inputs\": {\n      \"shift\": 3.1000000000000005,\n      \"model\": [\n        \"86:37\",\n        0\n      ]\n    },\n    \"class_type\": \"ModelSamplingAuraFlow\",\n    \"_meta\": {\n      \"title\": \"é‡‡æ ·ç®—æ³•ï¼ˆAuraFlowï¼‰\"\n    }\n  },\n  \"86:7\": {\n    \"inputs\": {\n      \"text\": \"ä½åˆ†è¾¨ç‡ï¼Œä½ç”»è´¨ï¼Œè‚¢ä½“ç•¸å½¢ï¼Œæ‰‹æŒ‡ç•¸å½¢ï¼Œç”»é¢è¿‡é¥±å’Œï¼Œèœ¡åƒæ„Ÿï¼Œäººè„¸æ— ç»†èŠ‚ï¼Œè¿‡åº¦å…‰æ»‘ï¼Œç”»é¢å…·æœ‰AIæ„Ÿã€‚æ„å›¾æ··ä¹±ã€‚æ–‡å­—æ¨¡ç³Šï¼Œæ‰­æ›²\",\n      \"clip\": [\n        \"86:38\",\n        0\n      ]\n    },\n    \"class_type\": \"CLIPTextEncode\",\n    \"_meta\": {\n      \"title\": \"CLIP Text Encode (Negative Prompt)\"\n    }\n  }\n}\n</code></pre>\n<h3 id=\"32-jsonæ–‡ä»¶çš„æ¥æº\">3.2 JSONæ–‡ä»¶çš„æ¥æº</h3>\n<p>JSONæ–‡ä»¶æ˜¯é€šè¿‡ComfyUI WebUIçš„\"å·¥ä½œæµ &gt; å¯¼å‡º(API)\"åŠŸèƒ½è‡ªåŠ¨ç”Ÿæˆçš„,å®ƒå‡†ç¡®åæ˜ äº†å½“å‰å¯è§†åŒ–å·¥ä½œæµçš„çŠ¶æ€ã€‚</p>\n<h3 id=\"33-éœ€è¦ä¿®æ”¹çš„å‚æ•°\">3.3 éœ€è¦ä¿®æ”¹çš„å‚æ•°</h3>\n<p>é€šå¸¸æƒ…å†µä¸‹,ä½ éœ€è¦ä¿®æ”¹ä»¥ä¸‹å‚æ•°æ¥å®ç°åŠ¨æ€è°ƒç”¨:</p>\n<table>\n<thead>\n<tr>\n<th>èŠ‚ç‚¹ç±»å‹</th>\n<th>å‚æ•°åç§°</th>\n<th>è¯´æ˜</th>\n<th>ä¿®æ”¹å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>KSampler</td>\n<td><code>seed</code></td>\n<td>éšæœºç§å­</td>\n<td>è®¾ç½®ä¸º-1å¯è‡ªåŠ¨ç”Ÿæˆéšæœºæ•°,æˆ–æ¯æ¬¡è¯·æ±‚æŒ‡å®šä¸åŒçš„å€¼</td>\n</tr>\n<tr>\n<td>KSampler</td>\n<td><code>steps</code></td>\n<td>é‡‡æ ·æ­¥æ•°</td>\n<td>æ ¹æ®è´¨é‡éœ€æ±‚è°ƒæ•´,é€šå¸¸20-50</td>\n</tr>\n<tr>\n<td>KSampler</td>\n<td><code>cfg</code></td>\n<td>æç¤ºè¯ç›¸å…³æ€§</td>\n<td>é€šå¸¸7-12,æ•°å€¼è¶Šé«˜è¶Šéµå¾ªæç¤ºè¯</td>\n</tr>\n<tr>\n<td>CLIPTextEncode</td>\n<td><code>text</code></td>\n<td>æç¤ºè¯</td>\n<td>ä¿®æ”¹ä¸ºä½ è¦ç”Ÿæˆçš„å›¾åƒæè¿°</td>\n</tr>\n<tr>\n<td>EmptyLatentImage</td>\n<td><code>width</code></td>\n<td>å›¾åƒå®½åº¦</td>\n<td>æ ¹æ®éœ€æ±‚è°ƒæ•´(å¦‚512, 768, 1024)</td>\n</tr>\n<tr>\n<td>EmptyLatentImage</td>\n<td><code>height</code></td>\n<td>å›¾åƒé«˜åº¦</td>\n<td>æ ¹æ®éœ€æ±‚è°ƒæ•´</td>\n</tr>\n<tr>\n<td>CheckpointLoaderSimple</td>\n<td><code>ckpt_name</code></td>\n<td>æ¨¡å‹æ–‡ä»¶å</td>\n<td>åˆ‡æ¢ä¸åŒçš„åŸºç¡€æ¨¡å‹</td>\n</tr>\n</tbody>\n</table>\n<p>ä¿®æ”¹ç¤ºä¾‹:</p>\n<p>ç”±äºæ¯ä¸ªå·¥ä½œæµé…ç½®å‡ºçš„èŠ‚ç‚¹åç§°ä¸ä¸€æ ·ï¼Œéœ€è¦æ ¹æ®åˆ°å¤„çš„jsonæ ¼å¼è¿›è¡Œä¿®æ”¹</p>\n<pre><code class=\"language-python\"># åŠ è½½åŸå§‹JSON\nwith open(\"workflow_api.json\", \"r\", encoding=\"utf-8\") as f:\n    workflow = json.load(f)\n\n# ä¿®æ”¹æç¤ºè¯\nworkflow[\"91\"][\"inputs\"][\"text\"] = \"ä¸€åªå¯çˆ±çš„çŒ«å’ªåœ¨èŠ±å›­é‡Œç©è€,é«˜æ¸…æ‘„å½±,8K\"\n\n# ä¿®æ”¹å›¾åƒå°ºå¯¸\nworkflow[\"86:58\"][\"inputs\"][\"width\"] = 1024\nworkflow[\"86:58\"][\"inputs\"][\"height\"] = 1024\n\n# éšæœºç§å­\nworkflow[\"86:3\"][\"inputs\"][\"seed\"] = -1\n</code></pre>\n<h2 id=\"å››apiè°ƒç”¨æµç¨‹\">å››ã€APIè°ƒç”¨æµç¨‹</h2>\n<h3 id=\"41-è°ƒç”¨æµç¨‹å›¾\">4.1 è°ƒç”¨æµç¨‹å›¾</h3>\n<pre><code>1. æ­å»ºComfyUIå·¥ä½œæµ\n       â†“\n2. åœ¨WebUIä¸­æµ‹è¯•å¹¶ç¡®è®¤å·¥ä½œæ­£å¸¸\n       â†“\n3. å¯¼å‡ºAPIæ ¼å¼JSONæ–‡ä»¶\n       â†“\n4. åœ¨ä»£ç ä¸­åŠ è½½JSON\n       â†“\n5. ä¿®æ”¹éœ€è¦åŠ¨æ€è°ƒæ•´çš„å‚æ•°\n       â†“\n6. å‘é€POSTè¯·æ±‚åˆ°ComfyUIæœåŠ¡å™¨\n       â†“\n7. ç­‰å¾…å¹¶æ¥æ”¶ç”Ÿæˆç»“æœ\n       â†“\n8. å¤„ç†è¿”å›çš„å›¾åƒæ•°æ®\n</code></pre>\n<h3 id=\"42-è·å–comfyuiæœåŠ¡å™¨åœ°å€\">4.2 è·å–ComfyUIæœåŠ¡å™¨åœ°å€</h3>\n<ul>\n<li><strong>æœ¬åœ°éƒ¨ç½²</strong>: é€šå¸¸ä¸º <code>http://127.0.0.1:8188/api</code></li>\n<li><strong>äº‘æœåŠ¡å™¨</strong>: æ›¿æ¢ä¸ºä½ çš„å…¬ç½‘IPæˆ–åŸŸå</li>\n</ul>\n<h2 id=\"äº”pythonä»£ç å®ç°\">äº”ã€Pythonä»£ç å®ç°</h2>\n<h3 id=\"51-åŸºç¡€åŒæ­¥è°ƒç”¨\">5.1 åŸºç¡€åŒæ­¥è°ƒç”¨</h3>\n<p>æœ€ç®€å•çš„è°ƒç”¨æ–¹å¼,ç›´æ¥ç­‰å¾…ç»“æœè¿”å›:</p>\n<pre><code class=\"language-python\">import requests\nimport json\n\n# ComfyUIæœåŠ¡å™¨åœ°å€\nCOMFYUI_ADDRESS = \"http://127.0.0.1:8188/api\"\n\ndef generate_image_sync(prompt_text, width=512, height=512):\n    \"\"\"\n    åŒæ­¥è°ƒç”¨ComfyUI APIç”Ÿæˆå›¾åƒ\n    \"\"\"\n    # 1. åŠ è½½å·¥ä½œæµJSON\n    with open(\"workflow_api.json\", \"r\", encoding=\"utf-8\") as f:\n        workflow = json.load(f)\n\n    # 2. ä¿®æ”¹å‚æ•°\n    workflow[\"91\"][\"inputs\"][\"text\"] = prompt_text  # ä¿®æ”¹æç¤ºè¯\n    workflow[\"86:58\"][\"inputs\"][\"width\"] = width\n    workflow[\"86:58\"][\"inputs\"][\"height\"] = height\n    workflow[\"86:3\"][\"inputs\"][\"seed\"] = -1  # éšæœºç§å­\n\n    # 3. å‘é€POSTè¯·æ±‚\n    endpoint = f\"{COMFYUI_ADDRESS}/prompt\"\n    response = requests.post(\n        endpoint,\n        json={\"prompt\": workflow},\n        headers={\"Content-Type\": \"application/json\"}\n    )\n\n    # 4. è·å–prompt_id\n    result = response.json()\n    prompt_id = result[\"prompt_id\"]\n    print(f\"ä»»åŠ¡å·²æäº¤,prompt_id: {prompt_id}\")\n\n    # 5. ç­‰å¾…ç”Ÿæˆå®Œæˆ\n    history_endpoint = f\"{COMFYUI_ADDRESS}/history/{prompt_id}\"\n    import time\n    while True:\n        history_response = requests.get(history_endpoint)\n        history_data = history_response.json()\n\n        if prompt_id in history_data:\n            # è·å–ç”Ÿæˆçš„å›¾åƒ\n            outputs = history_data[prompt_id][\"outputs\"]\n            for node_id, output_data in outputs.items():\n                if \"images\" in output_data:\n                    for img in output_data[\"images\"]:\n                        image_filename = img[\"filename\"]\n                        print(f\"å›¾åƒå·²ç”Ÿæˆ: {image_filename}\")\n                        return {\n                            \"prompt_id\": prompt_id,\n                            \"filename\": image_filename,\n                            \"full_path\": f\"{COMFYUI_ADDRESS}/view?filename={image_filename}\"\n                        }\n            break\n\n        time.sleep(1)\n\n    return None\n\n# ä½¿ç”¨ç¤ºä¾‹\nif __name__ == \"__main__\":\n    result = generate_image_sync(\n        prompt_text=\"ä¸€åªå¯çˆ±çš„çŒ«å’ªåœ¨èŠ±å›­é‡Œç©è€,é«˜æ¸…æ‘„å½±,8K,ç»†èŠ‚ä¸°å¯Œ\",\n        width=768,\n        height=768\n    )\n    print(result)\n</code></pre>\n<h3 id=\"52-ä½¿ç”¨websocketå®æ—¶ç›‘å¬\">5.2 ä½¿ç”¨WebSocketå®æ—¶ç›‘å¬</h3>\n<p>è·å–å®æ—¶è¿›åº¦,é€‚åˆéœ€è¦æ˜¾ç¤ºç”Ÿæˆè¿‡ç¨‹çš„åœºæ™¯:</p>\n<pre><code class=\"language-python\">import websocket\nimport json\nimport uuid\nimport requests\nimport time\n\nclass ComfyUIWebSocketClient:\n    def __init__(self, server_address=\"127.0.0.1:8188\"):\n        self.server_address = server_address\n        self.client_id = str(uuid.uuid4())\n        self.ws = None\n        self.result = None\n\n    def send_prompt(self, workflow):\n        \"\"\"\n        é€šè¿‡WebSocketå‘é€å·¥ä½œæµ\n        \"\"\"\n        # è¿æ¥WebSocket\n        ws_url = f\"ws://{self.server_address}/ws?clientId={self.client_id}\"\n        self.ws = websocket.create_connection(ws_url)\n\n        # å‘é€POSTè¯·æ±‚\n        prompt_endpoint = f\"http://{self.server_address}/api/prompt\"\n        payload = {\n            \"prompt\": workflow,\n            \"client_id\": self.client_id\n        }\n\n        response = requests.post(\n            prompt_endpoint,\n            json=payload,\n            headers={\"Content-Type\": \"application/json\"}\n        )\n\n        return response.json()\n\n    def listen_progress(self, prompt_id):\n        \"\"\"\n        ç›‘å¬ç”Ÿæˆè¿›åº¦\n        \"\"\"\n        try:\n            while True:\n                message = self.ws.recv()\n                data = json.loads(message)\n\n                # å¤„ç†ä¸åŒç±»å‹çš„æ¶ˆæ¯\n                if data[\"type\"] == \"status\":\n                    print(f\"çŠ¶æ€æ›´æ–°: {data['data']}\")\n\n                elif data[\"type\"] == \"executing\":\n                    node_id = data[\"data\"].get(\"node\")\n                    print(f\"æ­£åœ¨æ‰§è¡ŒèŠ‚ç‚¹: {node_id}\")\n\n                elif data[\"type\"] == \"progress\":\n                    value = data[\"data\"][\"value\"]\n                    max_value = data[\"data\"][\"max\"]\n                    print(f\"è¿›åº¦: {value}/{max_value}\")\n\n                elif data[\"type\"] == \"execution_start\":\n                    print(\"å¼€å§‹æ‰§è¡Œ\")\n\n                elif data[\"type\"] == \"execution_success\":\n                    print(\"æ‰§è¡ŒæˆåŠŸ!\")\n                    self.result = data\n                    break\n\n                elif data[\"type\"] == \"execution_cached\":\n                    print(\"ä½¿ç”¨äº†ç¼“å­˜\")\n\n        except KeyboardInterrupt:\n            print(\"ç›‘å¬ä¸­æ–­\")\n        finally:\n            self.ws.close()\n\ndef generate_image_with_websocket(prompt_text):\n    \"\"\"\n    ä½¿ç”¨WebSocketæ–¹å¼ç”Ÿæˆå›¾åƒ\n    \"\"\"\n    client = ComfyUIWebSocketClient()\n\n    # åŠ è½½å¹¶ä¿®æ”¹å·¥ä½œæµ\n    with open(\"workflow_api.json\", \"r\", encoding=\"utf-8\") as f:\n        workflow = json.load(f)\n\n    workflow[\"91\"][\"inputs\"][\"text\"] = prompt_text  # ä¿®æ”¹æç¤ºè¯\n    workflow[\"86:3\"][\"inputs\"][\"seed\"] = -1  # éšæœºç§å­\n\n    # å‘é€å·¥ä½œæµ\n    result = client.send_prompt(workflow)\n    prompt_id = result[\"prompt_id\"]\n    print(f\"Prompt ID: {prompt_id}\")\n\n    # ç›‘å¬è¿›åº¦\n    client.listen_progress(prompt_id)\n\n    return client.result\n\n# ä½¿ç”¨ç¤ºä¾‹\nif __name__ == \"__main__\":\n    result = generate_image_with_websocket(\"æ—¥è½æ—¶åˆ†çš„æµ·è¾¹é£å…‰,é‡‘é»„è‰²çš„é˜³å…‰æ´’åœ¨æ²™æ»©ä¸Š\")\n    print(f\"ç”Ÿæˆå®Œæˆ: {result}\")\n</code></pre>\n<h3 id=\"53-æ‰¹é‡ç”Ÿæˆå›¾åƒ\">5.3 æ‰¹é‡ç”Ÿæˆå›¾åƒ</h3>\n<p>è‡ªåŠ¨åŒ–æ‰¹é‡ç”Ÿæˆå¤šä¸ªå›¾åƒ:</p>\n<pre><code class=\"language-python\">import requests\nimport json\nimport time\nimport concurrent.futures\n\nCOMFYUI_ADDRESS = \"http://127.0.0.1:8188\"\n\ndef generate_single_image(prompt_text, seed=None, width=512, height=512):\n    \"\"\"\n    ç”Ÿæˆå•å¼ å›¾åƒ\n    \"\"\"\n    with open(\"workflow_api.json\", \"r\", encoding=\"utf-8\") as f:\n        workflow = json.load(f)\n\n    workflow[\"91\"][\"inputs\"][\"text\"] = prompt_text  # ä¿®æ”¹æç¤ºè¯\n    workflow[\"86:58\"][\"inputs\"][\"width\"] = width\n    workflow[\"86:58\"][\"inputs\"][\"height\"] = height\n    workflow[\"86:3\"][\"inputs\"][\"seed\"] = -1  # éšæœºç§å­\n    \n\n    if seed is None:\n        workflow[\"86:3\"][\"inputs\"][\"seed\"] = -1  # éšæœºç§å­\n    else:\n        workflow[\"86:3\"][\"inputs\"][\"seed\"] = seed\n\n    endpoint = f\"{COMFYUI_ADDRESS}/prompt\"\n    response = requests.post(\n        endpoint,\n        json={\"prompt\": workflow},\n        headers={\"Content-Type\": \"application/json\"}\n    )\n\n    result = response.json()\n    prompt_id = result[\"prompt_id\"]\n\n    # ç­‰å¾…å®Œæˆ\n    while True:\n        history_response = requests.get(f\"{COMFYUI_ADDRESS}/history/{prompt_id}\")\n        history_data = history_response.json()\n\n        if prompt_id in history_data:\n            outputs = history_data[prompt_id][\"outputs\"]\n            for node_id, output_data in outputs.items():\n                if \"images\" in output_data:\n                    filename = output_data[\"images\"][0][\"filename\"]\n                    return {\n                        \"prompt\": prompt_text,\n                        \"seed\": workflow[\"86:3\"][\"inputs\"][\"seed\"],\n                        \"filename\": filename,\n                        \"url\": f\"{COMFYUI_ADDRESS}/view?filename={filename}\"\n                    }\n        time.sleep(0.5)\n\ndef batch_generate(prompts, max_workers=2):\n    \"\"\"\n    æ‰¹é‡ç”Ÿæˆå›¾åƒ(å¹¶å‘)\n    \"\"\"\n    results = []\n    with concurrent.futures.ThreadPoolExecutor(max_workers=max_workers) as executor:\n        future_to_prompt = {\n            executor.submit(generate_single_image, prompt): prompt\n            for prompt in prompts\n        }\n\n        for future in concurrent.futures.as_completed(future_to_prompt):\n            prompt = future_to_prompt[future]\n            try:\n                result = future.result()\n                results.append(result)\n                print(f\"âœ“ å®Œæˆ: {prompt}\")\n            except Exception as e:\n                print(f\"âœ— å¤±è´¥: {prompt}, é”™è¯¯: {e}\")\n\n    return results\n\n# ä½¿ç”¨ç¤ºä¾‹\nif __name__ == \"__main__\":\n    prompts = [\n        \"ä¸€åªå¯çˆ±çš„çŒ«å’ªåœ¨èŠ±å›­é‡Œç©è€\",\n        \"ç¾ä¸½çš„æ—¥è½é£æ™¯,é‡‘è‰²é˜³å…‰\",\n        \"é«˜å±±æ¹–æ³Š,å€’å½±æ¸…æ™°\",\n        \"åŸå¸‚å¤œæ™¯,éœ“è™¹é—ªçƒ\",\n        \"æ£®æ—å°å¾„,é˜³å…‰æ–‘é©³\"\n    ]\n\n    print(\"å¼€å§‹æ‰¹é‡ç”Ÿæˆ...\")\n    results = batch_generate(prompts, max_workers=2)\n\n    print(f\"\\nç”Ÿæˆå®Œæˆ,å…± {len(results)} å¼ å›¾åƒ:\")\n    for i, result in enumerate(results, 1):\n        print(f\"{i}. {result['prompt']}\")\n        print(f\"   æ–‡ä»¶: {result['filename']}\")\n        print(f\"   é“¾æ¥: {result['url']}\\n\")\n</code></pre>\n<h3 id=\"54-ä¸‹è½½ç”Ÿæˆçš„å›¾åƒ\">5.4 ä¸‹è½½ç”Ÿæˆçš„å›¾åƒ</h3>\n<p>å°†ç”Ÿæˆçš„å›¾åƒä¿å­˜åˆ°æœ¬åœ°:</p>\n<pre><code class=\"language-python\">import requests\nimport os\n\ndef download_image(image_url, save_path, filename=None):\n    \"\"\"\n    ä¸‹è½½ç”Ÿæˆçš„å›¾åƒåˆ°æœ¬åœ°\n    \"\"\"\n    try:\n        response = requests.get(image_url)\n        response.raise_for_status()\n\n        if filename is None:\n            filename = image_url.split(\"filename=\")[-1]\n\n        full_path = os.path.join(save_path, filename)\n        os.makedirs(save_path, exist_ok=True)\n\n        with open(full_path, \"wb\") as f:\n            f.write(response.content)\n\n        print(f\"å›¾åƒå·²ä¿å­˜: {full_path}\")\n        return full_path\n\n    except Exception as e:\n        print(f\"ä¸‹è½½å¤±è´¥: {e}\")\n        return None\n\n# ä½¿ç”¨ç¤ºä¾‹\nif __name__ == \"__main__\":\n    image_url = \"http://127.0.0.1:8188/view?filename=ComfyUI_00001.png\"\n    save_path = \"./generated_images\"\n    download_image(image_url, save_path)\n</code></pre>\n<h2 id=\"å…­ä¼ å‚è¦æ±‚è¯¦è§£\">å…­ã€ä¼ å‚è¦æ±‚è¯¦è§£</h2>\n<h3 id=\"61-è¯·æ±‚å‚æ•°\">6.1 è¯·æ±‚å‚æ•°</h3>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ç±»å‹</th>\n<th>å¿…å¡«</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>prompt</code></td>\n<td>object</td>\n<td>æ˜¯</td>\n<td>å·¥ä½œæµJSONå¯¹è±¡</td>\n</tr>\n<tr>\n<td><code>client_id</code></td>\n<td>string</td>\n<td>å¦</td>\n<td>å®¢æˆ·ç«¯æ ‡è¯†ç¬¦,ç”¨äºåŒºåˆ†ä¸åŒè¯·æ±‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"62-å“åº”å‚æ•°\">6.2 å“åº”å‚æ•°</h3>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ç±»å‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>prompt_id</code></td>\n<td>string</td>\n<td>ä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦</td>\n</tr>\n<tr>\n<td><code>number</code></td>\n<td>number</td>\n<td>é˜Ÿåˆ—ä¸­æ’é˜Ÿçš„ä»»åŠ¡æ•°</td>\n</tr>\n<tr>\n<td><code>node_errors</code></td>\n<td>object</td>\n<td>èŠ‚ç‚¹é”™è¯¯ä¿¡æ¯</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"63-å¸¸è§httpçŠ¶æ€ç \">6.3 å¸¸è§HTTPçŠ¶æ€ç </h3>\n<table>\n<thead>\n<tr>\n<th>çŠ¶æ€ç </th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>200</td>\n<td>è¯·æ±‚æˆåŠŸ</td>\n</tr>\n<tr>\n<td>400</td>\n<td>è¯·æ±‚å‚æ•°é”™è¯¯</td>\n</tr>\n<tr>\n<td>500</td>\n<td>æœåŠ¡å™¨å†…éƒ¨é”™è¯¯</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ä¸ƒå¸¸è§é—®é¢˜\">ä¸ƒã€å¸¸è§é—®é¢˜</h2>\n<h3 id=\"q1-æç¤ºè¯ä¸ç”Ÿæ•ˆæ€ä¹ˆåŠ\">Q1: æç¤ºè¯ä¸ç”Ÿæ•ˆæ€ä¹ˆåŠ?</h3>\n<p>æ£€æŸ¥èŠ‚ç‚¹IDæ˜¯å¦æ­£ç¡®ã€‚å¯¼å‡ºçš„JSONä¸­,CLIPTextEncodeèŠ‚ç‚¹çš„IDå¯èƒ½ä¸ä½ çš„ä¸åŒ,éœ€è¦æ ¹æ®å®é™…JSONè°ƒæ•´ã€‚</p>\n<h3 id=\"q2-å¦‚ä½•è·å–ç”Ÿæˆçš„å›¾åƒæ–‡ä»¶\">Q2: å¦‚ä½•è·å–ç”Ÿæˆçš„å›¾åƒæ–‡ä»¶?</h3>\n<p>æ–¹æ³•1: é€šè¿‡<code>/view</code>ç«¯ç‚¹ç›´æ¥è®¿é—®</p>\n<pre><code class=\"language-python\">image_url = f\"{COMFYUI_ADDRESS}/view?filename={filename}\"\n</code></pre>\n<p>æ–¹æ³•2: ä»ComfyUIçš„<code>output</code>ç›®å½•ç›´æ¥å¤åˆ¶æ–‡ä»¶</p>\n<h3 id=\"q3-æ‰¹é‡ç”Ÿæˆé€Ÿåº¦æ…¢æ€ä¹ˆåŠ\">Q3: æ‰¹é‡ç”Ÿæˆé€Ÿåº¦æ…¢æ€ä¹ˆåŠ?</h3>\n<ol>\n<li>ä½¿ç”¨å¤šçº¿ç¨‹å¹¶å‘è¯·æ±‚</li>\n<li>ä¼˜åŒ–å·¥ä½œæµ,å‡å°‘ä¸å¿…è¦çš„èŠ‚ç‚¹</li>\n<li>ä½¿ç”¨æ›´å¼ºå¤§çš„GPU</li>\n<li>è€ƒè™‘ä½¿ç”¨äº‘å¹³å°çš„Serverless API,æ”¯æŒå¤šå®ä¾‹å¹¶å‘</li>\n</ol>\n<h3 id=\"q4-apiè°ƒç”¨è¿”å›é”™è¯¯\">Q4: APIè°ƒç”¨è¿”å›é”™è¯¯?</h3>\n<p>æ£€æŸ¥:</p>\n<ol>\n<li>ComfyUIæœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ</li>\n<li>å·¥ä½œæµJSONæ ¼å¼æ˜¯å¦æ­£ç¡®</li>\n<li>èŠ‚ç‚¹è¿æ¥å…³ç³»æ˜¯å¦å®Œæ•´</li>\n<li>æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨</li>\n</ol>\n<h2 id=\"å…«è¿›é˜¶æŠ€å·§\">å…«ã€è¿›é˜¶æŠ€å·§</h2>\n<h3 id=\"81-åŠ¨æ€æ›¿æ¢æ¨¡å‹\">8.1 åŠ¨æ€æ›¿æ¢æ¨¡å‹</h3>\n<pre><code class=\"language-python\">def change_model(workflow, model_name):\n    \"\"\"\n    åˆ‡æ¢æ¨¡å‹\n    \"\"\"\n    # å‡è®¾èŠ‚ç‚¹4æ˜¯CheckpointLoaderSimple\n    workflow[\"4\"][\"inputs\"][\"ckpt_name\"] = model_name\n    return workflow\n\n# ä½¿ç”¨\nworkflow = change_model(workflow, \"sd_xl_base_1.0.safetensors\")\n</code></pre>\n<h3 id=\"82-æ·»åŠ controlnet\">8.2 æ·»åŠ ControlNet</h3>\n<p>å¯¼å‡ºçš„JSONå¦‚æœåŒ…å«ControlNet,éœ€è¦ç¡®ä¿ControlNetæ¨¡å‹å·²åŠ è½½:</p>\n<pre><code class=\"language-python\"># ControlNeté¢„å¤„ç†å™¨èŠ‚ç‚¹é€šå¸¸éœ€è¦é¢å¤–çš„å‚æ•°\nworkflow[\"controlnet_node\"][\"inputs\"][\"image\"] = [\"load_image_node\", 0]\n</code></pre>\n<h3 id=\"83-loraè°ƒç”¨\">8.3 Loraè°ƒç”¨</h3>\n<pre><code class=\"language-python\"># åœ¨KSamplerä¹‹å‰æ·»åŠ LoraåŠ è½½èŠ‚ç‚¹\n# ä¿®æ”¹modelçš„è¿æ¥,ä»CheckpointLoaderæ”¹ä¸ºLoraLoader\nworkflow[\"3\"][\"inputs\"][\"model\"] = [\"lora_loader_node\", 0]\n</code></pre>\n<h2 id=\"ä¹æ€»ç»“\">ä¹ã€æ€»ç»“</h2>\n<p>é€šè¿‡ComfyUI API,æˆ‘ä»¬å¯ä»¥å®ç°:</p>\n<ul>\n<li>âœ“ å·¥ä½œæµè‡ªåŠ¨åŒ–æ‰§è¡Œ</li>\n<li>âœ“ æ‰¹é‡å›¾åƒç”Ÿæˆ</li>\n<li>âœ“ é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ</li>\n<li>âœ“ å®æ—¶è¿›åº¦ç›‘æ§</li>\n<li>âœ“ äº‘ç«¯éƒ¨ç½²å’Œæ‰©å±•</li>\n</ul>\n<p>å…³é”®æ­¥éª¤:</p>\n<ol>\n<li>åœ¨ComfyUI WebUIä¸­æ­å»ºå¹¶æµ‹è¯•å·¥ä½œæµ</li>\n<li>å¯¼å‡ºAPIæ ¼å¼JSONæ–‡ä»¶</li>\n<li>åœ¨ä»£ç ä¸­åŠ è½½JSONå¹¶ä¿®æ”¹å‚æ•°</li>\n<li>é€šè¿‡HTTP/WebSocketå‘é€è¯·æ±‚</li>\n<li>å¤„ç†è¿”å›ç»“æœ</li>\n</ol>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 21:31</span>&nbsp;\n<a href=\"https://www.cnblogs.com/zer0Black\">é”…æ€»çš„ç¨‹åºäººç”Ÿ</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">5</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "è§†é¢‘ç†è§£æ¨¡å‹æ¨ç†ä¸å¾®è°ƒ",
      "link": "https://www.cnblogs.com/zackstang/p/19481125",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n\t\t\t<a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/zackstang/p/19481125\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 20:54\">\n    <span>è§†é¢‘ç†è§£æ¨¡å‹æ¨ç†ä¸å¾®è°ƒ</span>\n    \n\n</a>\n\n\t\t</h1>\n\t\t<div class=\"clear\"></div>\n\t\t<div class=\"postBody\">\n\t\t\t<div class=\"blogpost-body blogpost-body-html\" id=\"cnblogs_post_body\">\n<h1>è§†é¢‘ç†è§£æ¨¡å‹æ¨ç†ä¸å¾®è°ƒ</h1>\n<p>éšç€å¤šæ¨¡æ€å¤§æ¨¡å‹çš„æŒç»­å‘å±•ï¼Œè§†é¢‘ç†è§£ã€å¤šæ¨¡æ€æ£€ç´¢å’Œæ™ºèƒ½æ ‡æ³¨ç­‰åº”ç”¨åœºæ™¯é€æ¸è½åœ°ã€‚ä¸ºäº†è¿›ä¸€æ­¥æ¢ç©¶å¤šæ¨¡æ€è§†é¢‘ç†è§£æ¨¡å‹åœ¨å®é™…å·¥ç¨‹ä¸­çš„åº”ç”¨æ–¹å¼ï¼Œæœ¬æ–‡ä»¥ Qwen3-VL ç³»åˆ—æ¨¡å‹ä¸ºä¾‹ï¼Œç³»ç»Ÿæ¢³ç†å…¶åœ¨è§†é¢‘åœºæ™¯ä¸‹çš„æ¨ç†ä¸å…¨å‚æ•°å¾®è°ƒå®è·µã€‚æ–‡ç« é¦–å…ˆé€šè¿‡ä¸€ä¸ªå®Œæ•´çš„è§†é¢‘æœ¬åœ°æ¨ç†ç¤ºä¾‹ï¼Œè¯¦ç»†æ‹†è§£æ¨¡å‹è¾“å…¥çš„æ„å»ºæµç¨‹ï¼ŒåŒ…æ‹¬è§†é¢‘å¸§é‡‡æ ·ã€patch åˆ’åˆ†ä»¥åŠæ—¶åºä¸ç©ºé—´ç»´åº¦çš„åˆå¹¶ç­‰å…³é”®ç»†èŠ‚ï¼›éšååŸºäºçœŸå®æ¸¸æˆè§†é¢‘æ•°æ®ï¼Œä»‹ç»è§†é¢‘æŒ‡ä»¤å¾®è°ƒæ•°æ®é›†çš„æ„å»ºæ–¹æ³•ï¼Œå¹¶å®Œæˆä¸€æ¬¡å…¨å‚æ•°å¾®è°ƒä¸æ•ˆæœéªŒè¯ã€‚</p>\n<p>&nbsp;</p>\n<h2>1. è§†é¢‘æ¨ç†</h2>\n<p>é¦–å…ˆçœ‹ä¸€ä¸ªqwen3-vl-4b-instructæ¨¡å‹åšè§†é¢‘æœ¬åœ°æ¨ç†çš„ä¾‹å­ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">from transformers import AutoProcessor, AutoModelForVision2Seq\nfrom qwen_vl_utils import process_vision_info\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=FutureWarning, module=\"transformers\")\nimport os \n\n# åŠ è½½æ¨¡å‹å’Œå¤„ç†å™¨\nmodel_path = \"Qwen/Qwen3-VL-4B-Instruct\"\nprocessor = AutoProcessor.from_pretrained(model_path)\n\n# åŠ è½½è§†è§‰-æ–‡æœ¬æ¨¡å‹\nmodel, output_loading_info = AutoModelForVision2Seq.from_pretrained(\n    model_path, \n    torch_dtype=\"auto\", \n    device_map=\"auto\", \n    output_loading_info=True\n)\nprint(\"output_loading_info\", output_loading_info)\n\n\n# é…ç½®è§†é¢‘å¤„ç†å‚æ•°\nvideo = \"./1.mp4\"\ntotal_pixels = 20480 * 32 * 32  # æ€»åƒç´ é™åˆ¶\nmin_pixels = 64 * 32 * 32  # æœ€å°åƒç´ é™åˆ¶\nmax_frames = 2048  # æœ€å¤§å¸§æ•°\nsample_fps = 2  # é‡‡æ ·å¸§ç‡\nmax_new_tokens = 2048  # ç”Ÿæˆçš„æœ€å¤§ token æ•°\n\nprompt = \"è¯·æè¿°è¿™ä¸ªè§†é¢‘çš„å†…å®¹\"\n\n# æ„å»ºå¯¹è¯æ¶ˆæ¯\nmessages = [\n    {\n        \"role\": \"user\",\n        \"content\": [\n            {\n                \"video\": video,\n                \"total_pixels\": total_pixels,\n                \"min_pixels\": min_pixels,\n                \"max_frames\": max_frames,\n                'sample_fps': sample_fps\n            },\n            {\n                \"type\": \"text\", \n                \"text\": prompt\n            },\n        ]\n    },\n]\n\n# åº”ç”¨å¯¹è¯æ¨¡æ¿\ntext = processor.apply_chat_template(messages, tokenize=False, add_generation_prompt=True)\n\n# å¤„ç†è§†è§‰ä¿¡æ¯\nimage_inputs, video_inputs, video_kwargs = process_vision_info(\n    [messages], \n    return_video_kwargs=True, \n    image_patch_size=16,\n    return_video_metadata=True\n)\n\n# åˆ†ç¦»è§†é¢‘æ•°æ®å’Œå…ƒæ•°æ®\nif video_inputs is not None:\n    video_inputs, video_metadatas = zip(*video_inputs)\n    video_inputs, video_metadatas = list(video_inputs), list(video_metadatas)\nelse:\n    video_metadatas = None\n\n\n# å‡†å¤‡æ¨¡å‹è¾“å…¥\ninputs = processor(\n    text=[text], \n    images=image_inputs, \n    videos=video_inputs, \n    video_metadata=video_metadatas, \n    **video_kwargs, \n    do_resize=False, \n    return_tensors=\"pt\"\n)\ninputs = inputs.to('cuda')\n\n# ç”Ÿæˆè¾“å‡º\noutput_ids = model.generate(**inputs, max_new_tokens=max_new_tokens)\n\n# æå–ç”Ÿæˆçš„éƒ¨åˆ†ï¼ˆå»é™¤è¾“å…¥ï¼‰\ngenerated_ids = [\n    output_ids[len(input_ids):] \n    for input_ids, output_ids in zip(inputs.input_ids, output_ids)\n]\n\n# è§£ç ä¸ºæ–‡æœ¬\noutput_text = processor.batch_decode(\n    generated_ids, \n    skip_special_tokens=True, \n    clean_up_tokenization_spaces=True\n)\n\nprint(output_text)\n['è§†é¢‘ç”±å¤šä¸ªé•œå¤´ç»„æˆï¼Œå±•ç°äº†åŠ¨æ¼«é£æ ¼çš„ç”»é¢å’Œäººç‰©ã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä¸€ä¸ªç”·æ€§è§’è‰²çš„ç‰¹å†™ï¼Œä»–æœ‰ç€é»‘è‰²é•¿å‘ï¼Œé¢å¤´ä¸­å¤®æœ‰ä¸€é“çº¢è‰²å°è®°ï¼Œçœ¼ç¥é”åˆ©ï¼Œæ‰‹æŒ‡è½»è§¦è„¸é¢Šï¼Œè¡¨æƒ…ä¸¥è‚ƒã€‚ç”»é¢ä¸­å‡ºç°å­—å¹•ï¼šâ€œé¡¾é•¿æ­ŒçœŸæ˜¯å˜å˜åâ€ï¼Œâ€œå‡ ç™¾å²çš„è€å¥³äººçš„ä¸»æ„ä»–ä¹Ÿæ‰“â€ï¼Œâ€œå°±åœ¨é¡¾é•¿æ­Œé™·å®³å”å¤©åâ€ã€‚è¿™æš—ç¤ºäº†è§’è‰²é¡¾é•¿æ­Œçš„ç‹¡çŒ¾å’Œä»–æ‰€ç­–åˆ’çš„é˜´è°‹ã€‚\\n\\nç¬¬äºŒéƒ¨åˆ†åˆ‡æ¢åˆ°ä¸€ä¸ªå¥³æ€§è§’è‰²çš„ç‰¹å†™ï¼Œå¥¹æœ‰ç€é•¿é•¿çš„é»‘å‘ï¼Œçœ‰ç›®é—´æµéœ²å‡ºä¸€ä¸å†·ç¬‘ï¼Œå˜´è§’ä¸Šæ‰¬ï¼Œä¼¼ä¹åœ¨ç­–åˆ’æˆ–æ‰§è¡ŒæŸä¸ªè®¡åˆ’ã€‚å­—å¹•æ˜¾ç¤ºï¼šâ€œä»–å©å’å°¹æ¹„â€ï¼Œâ€œè®©å”å¤©çš„å§å§å”å©‰äº²è‡ªè¿‡æ¥èµäººâ€ã€‚è¿™è¡¨æ˜å¥¹è¢«é¡¾é•¿æ­ŒæŒ‡æ´¾å»æ‰§è¡ŒæŸä¸ªä»»åŠ¡ã€‚\\n\\nç¬¬ä¸‰éƒ¨åˆ†æ˜¯å¦ä¸€ä¸ªå¥³æ€§è§’è‰²çš„ç‰¹å†™ï¼Œå¥¹çš„ç´«è‰²çœ¼ç›éå¸¸é†’ç›®ï¼Œçœ¼ç¥ä¸­é€éœ²å‡ºæƒŠè®¶å’Œéœ‡æƒŠã€‚å­—å¹•æ˜¾ç¤ºï¼šâ€œå”å©‰æœ‰ç€ä¸€é—¨é¢„çŸ¥ç¥¸ç¦çš„æœ¯æ³•ç¥é€šâ€ï¼Œâ€œå½“å¥¹ç”¨è¿™ç§æœ¯æ³•â€ï¼Œâ€œå¯¹è¿™æ¬¡èµäººä¹‹çº¦æ¨æ¼”æ—¶â€ï¼Œâ€œå´æ„å¤–çš„æ’åˆ°äº†åŸâ€ã€‚è¿™è¯´æ˜å”å©‰æ‹¥æœ‰æŸç§é¢„çŸ¥èƒ½åŠ›ï¼Œä½†åœ¨æ¨æ¼”æ—¶å´æ„å¤–åœ°é‡åˆ°äº†ä»€ä¹ˆï¼Œæš—ç¤ºäº†å‰§æƒ…çš„è½¬æŠ˜ã€‚\\n\\næ•´ä¸ªè§†é¢‘é€šè¿‡è¿™äº›ç‰¹å†™é•œå¤´ï¼Œå±•ç°äº†è§’è‰²ä¹‹é—´çš„å¤æ‚å…³ç³»å’Œå‰§æƒ…çš„å‘å±•ï¼Œå……æ»¡äº†ç´§å¼ å’Œæ‚¬å¿µã€‚']\n</pre>\n</div>\n<p>ã€€ã€€</p>\n<h3>1.1. æ¨¡å‹è¾“å…¥è¯´æ˜</h3>\n<p>è¿™é‡Œç€é‡æ³¨æ„ä¸€ä¸‹æ¨¡å‹çš„è¾“å…¥éƒ¨åˆ†å¤„ç†ã€‚å¯ä»¥çœ‹åˆ°åœ¨æ„å»ºinputsæ—¶ï¼Œéœ€è¦æœ‰å‡ ä¸ªè¾“å…¥ï¼Œåˆ†åˆ«ä¸º[text]ã€image_inputsã€video_inputsã€video_metadataså’Œvideo_kwargsï¼Œä»¥åŠdo_resize=Falseã€‚</p>\n<p>é¦–å…ˆtextæ˜¯å¯¹è¯æ¨¡æ¿ï¼Œå…¶å¯¹åº”çš„å†…å®¹ä¸ºï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">'&lt;|im_start|&gt;user\\n&lt;|vision_start|&gt;&lt;|video_pad|&gt;&lt;|vision_end|&gt;è¯·æè¿°è¿™ä¸ªè§†é¢‘çš„å†…å®¹&lt;|im_end|&gt;\\n&lt;|im_start|&gt;assistant\\n'\n</pre>\n</div>\n<p>ã€€ã€€</p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œtextå®šä¹‰äº†åç»­è¾“å…¥åˆ°æ¨¡å‹çš„æ¨¡æ¿ï¼Œå…¶ä¸­video_padå³ä¸ºå ä½tokenï¼Œåç»­å°†ç”±å®é™…çš„videoæ•°æ®è¿›è¡Œè¡¥å……ã€‚</p>\n<p>&nbsp;</p>\n<h3>1.2. è§†é¢‘å¸§ä¿¡æ¯å‡†å¤‡</h3>\n<p>image_inputs, video_inputså’Œvideo_kwargsä¸º process_vision_info() æ–¹æ³•å¤„ç†åçš„è¿”å›ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯å°†åŸå§‹è§†é¢‘æ–‡ä»¶è½¬æ¢ä¸ºæ¨¡å‹å¯ä»¥ç†è§£çš„æ ¼å¼ï¼Œå…·ä½“åœ°è¯´ï¼Œä¼šåšä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p>\n<ol>\n<li>ä½¿ç”¨opencvè¯»å–è§†é¢‘åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬è§†é¢‘çš„fpsï¼ˆå‡è®¾æ˜¯60 fpsï¼‰, total_framesï¼ˆå‡è®¾è§†é¢‘ä¸º15sï¼Œåˆ™ä¸º900å¸§ï¼‰, widthï¼ˆ1280ï¼‰å’Œheightï¼ˆ720ï¼‰</li>\n<li>æŒ‰ç…§æŒ‡å®šçš„sample_fpsè¿›è¡Œå¸§é‡‡æ ·ï¼Œè¿™é‡ŒæŒ‡å®šä¸º2ï¼Œä¹Ÿå°±æ˜¯æ¯1sé‡‡2å¸§ã€‚åŸè§†é¢‘ä¸º15ç§’900å¸§çš„è¯ï¼Œåœ¨é‡‡æ ·åå°±æ˜¯30å¸§ï¼Œé‡‡æ ·é—´éš”å°±æ˜¯60/2=30ï¼Œä¹Ÿå°±æ˜¯æ¯30å¸§å–1å¸§ã€‚<span style=\"color: rgba(255, 0, 0, 1);\">è¿™æ ·å°±å¾—åˆ°äº†åç»­ç”¨äºæ¨ç†çš„å¸§åºåˆ—ï¼ˆ0, 31, 62, â€¦, 899ï¼‰</span></li>\n<li>åŠ¨æ€è°ƒæ•´åˆ†è¾¨ç‡ã€‚åœ¨ä¼ å…¥çš„messageså‚æ•°é‡Œé™¤äº†videoçš„è·¯å¾„å¤–ï¼Œè¿˜åŒ…æ‹¬, min_pixelsï¼ˆæŒ‡å®šä¸º64 * 32 * 32 = 65,536ï¼‰, total_pixelsï¼ˆæŒ‡å®šä¸º20480 * 32 * 32=20,971,520ï¼‰ å’Œ sample_fpsçš„ä¿¡æ¯ã€‚sample_fpsçš„ä½œç”¨ä¸Šé¢å·²ç»æåˆ°ã€‚total_pixelså’Œmin_pixelsç”¨äºçº¦æŸè°ƒæ•´åˆ†è¾¨ç‡ã€‚<ol>\n<li>å‡è®¾åŸå§‹è§†é¢‘æ˜¯1280 x 720çš„åˆ†è¾¨ç‡ï¼Œä¹Ÿå°±æ˜¯æ¯å¸§åŒ…å«921,600ä¸ªåƒç´ ã€‚é‚£30å¸§ * 921,600 = 27,648,000æ€»åƒç´ ï¼Œå¤§äºæŒ‡å®šçš„max_pixelsã€‚æ‰€ä»¥ä¼šç»§ç»­å¯¹å¸§åºåˆ—è¿›è¡Œåƒç´ ç¼©æ”¾</li>\n</ol></li>\n<li>è°ƒæ•´åˆ°patch_sizeçš„æ•´æ•°å€ã€‚Patch sizeæ˜¯ViTï¼ˆVision Transformerï¼‰æ¶æ„çš„æ ¸å¿ƒè®¾è®¡ï¼Œå®ƒæ˜¯å°†å›¾åƒåˆ‡åˆ†ä¸ºå›ºå®šå¤§å°çš„patchï¼Œæ¯ä¸ªpatchæœ€ç»ˆä½œä¸º1ä¸ªtokenè¾“å…¥åˆ°transformerä¸­ã€‚è¿™é‡Œpatch sizeæŒ‡å®šä¸º16ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªtokenæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª16x16çš„åƒç´ åŒºåŸŸã€‚æ‰€ä»¥éœ€è¦åŸºäºpatch_sizeçš„è®¾ç½®ï¼Œå°†æ¯å¸§è°ƒæ•´åˆ°patch_sizeçš„æ•´æ•°å€<ol>\n<li><span style=\"color: rgba(255, 0, 0, 1);\">å¯¹é½åˆ°patch_sizeçš„æ•´æ•°å€åï¼Œæœ€ç»ˆåˆ†è¾¨ç‡ä¸º1152 x 640</span></li>\n</ol></li>\n<li>æœ€åå°†å¸§åˆ—è¡¨ï¼Œä¹Ÿå°±æ˜¯æŠ½å–çš„30å¸§ï¼Œåšäº†åˆ†è¾¨ç‡è°ƒæ•´ï¼Œåšäº†åŸºäºpatch_sizeè°ƒæ•´åçš„å¸§åºåˆ—ï¼Œè½¬ä¸ºPyTorchå¼ é‡å¹¶è¿”å›ã€‚</li>\n</ol>\n<p>æœ€åå¯ä»¥çœ‹åˆ°video_inputsçš„ç»“æœä¸ºå•å…ƒç´ çš„listï¼Œè¿™å•ä¸ªå…ƒç´ é‡Œä¸º1ä¸ªtupleï¼ŒåŒ…å«2éƒ¨åˆ†ï¼š</p>\n<ol>\n<li>ä¸€ä¸ªshapeä¸º([30, 3, 640, 1152]) çš„å¼ é‡ï¼Œåˆ†åˆ«ä»£è¡¨å¸§idã€RGBé€šé“ã€ç¼©æ”¾åçš„åˆ†è¾¨ç‡640 x 1152</li>\n<li>å¦ä¸€ä¸ªä¸ºè§†é¢‘çš„metadataä¿¡æ¯ï¼ŒåŒ…æ‹¬fpså’Œframe_indicesï¼ˆé‡‡æ ·åçš„å¸§åºåˆ—ï¼‰ï¼Œä»¥åŠtotal_num_frames</li>\n</ol>\n<p>æ‰€ä»¥åœ¨åç»­ä»£ç ä¸­è¿˜æœ‰ä¸€æ­¥æ˜¯ï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">if video_inputs is not None:\n    video_inputs, video_metadatas = zip(*video_inputs)\nvideo_inputs, video_metadatas = list(video_inputs), list(video_metadatas)\n</pre>\n</div>\n<p>ã€€ã€€</p>\n<p>è¿™æ˜¯å°†video_inputså’Œvideo_metadatasæ‹†å¼€ï¼Œåœ¨video_inputsä¸­åªä¿ç•™å¸§çš„ä¿¡æ¯ã€‚</p>\n<p>&nbsp;</p>\n<h3>1.3. æ¨¡å‹è¾“å…¥ä¿¡æ¯å‡†å¤‡</h3>\n<p>åœ¨è§†é¢‘å¸§ä¿¡æ¯å‡†å¤‡å¥½ä¹‹åï¼Œè¿˜æœ‰æœ€åä¸€æ­¥ï¼Œå°†è§†é¢‘å¸§ä¿¡æ¯æ·»åŠ åˆ°textæ¨¡æ¿ä¸­ï¼Œä¹Ÿå°±æ˜¯è¿™æ®µä»£ç ï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">inputs = processor(text=[text], images=image_inputs, videos=video_inputs, video_metadata=video_metadatas, **video_kwargs, do_resize=False, return_tensors=\"pt\")\n</pre>\n</div>\n<p>ã€€</p>\n<p>æ­¤æ—¶è¾“å…¥æ•°æ®ä¸ºï¼š</p>\n<p>text = '&lt;|im_start|&gt;user\\n&lt;|vision_start|&gt;&lt;|video_pad|&gt;&lt;|vision_end|&gt;è¯·æè¿°è¿™ä¸ªè§†é¢‘çš„å†…å®¹&lt;|im_end|&gt;\\n&lt;|im_start|&gt;assistant\\n'</p>\n<p>video_inputs = [torch.Tensor([30, 3, 640, 1152])]</p>\n<p>video_metadatas = [{\"fps\":30, \"frame_indices\":[0, 31, 62, â€¦, 899], \"total_num_frames\": 900}</p>\n<p>ç»è¿‡processorå¤„ç†åçš„inputsç»“æœä¸ºï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">{'input_ids': tensor([[151644,    872,    198,  ..., 151644,  77091,    198]]), 'attention_mask': tensor([[1, 1, 1,  ..., 1, 1, 1]]), 'pixel_values_videos': tensor([[ 0.2000,  0.2000,  0.2000,  ..., -0.1529, -0.2549, -0.3176],\n        [ 0.1843,  0.1843,  0.1843,  ...,  0.1843,  0.1137,  0.0824],\n        [ 0.1451,  0.1451,  0.1451,  ..., -0.1373, -0.0667, -0.0275],\n        ...,\n        [ 0.4431,  0.4588,  0.4745,  ...,  0.2078,  0.2000,  0.2000],\n        [ 0.4510,  0.4588,  0.4588,  ...,  0.2157,  0.2314,  0.2471],\n        [ 0.5451,  0.5529,  0.5686,  ...,  0.3725,  0.3882,  0.3882]]), 'video_grid_thw': tensor([[15, 40, 72]])}\n</pre>\n</div>\n<p>ã€€</p>\n<p>é¦–å…ˆçœ‹video_grid_thwï¼Œè¿™ä¸ªè¡¨ç¤ºçš„patchå¸ƒå±€ï¼Œå‰é¢æåˆ°ç¼©æ”¾åçš„åˆ†è¾¨ç‡ä¸º640 x 1152ï¼Œå¯¹åº”åˆ°patch=16åçš„patchå¸ƒå±€åˆ™ä¸º40 x 72ã€‚ä½†è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œ<span style=\"color: rgba(255, 0, 0, 1);\">ä¸ºä»€ä¹ˆé‡‡æ ·æ—¶å¸§æ•°ä¸º30ï¼Œè¿™é‡Œå˜æˆäº†15ï¼Ÿ</span></p>\n<p>é€šè¿‡é˜…è¯»Qwen3VLVideoProcessorçš„æºç [1]å¯ä»¥äº†è§£åˆ°æœ‰ä¸€ä¸ªé‡è¦å‚æ•°æ˜¯temporal_patch_size=2ï¼ˆä¹Ÿå¯ä»¥åœ¨æ¨¡å‹çš„configæ–‡ä»¶é‡Œçœ‹åˆ°è¿™ä¸ªå‚æ•°ï¼‰ã€‚<span style=\"color: rgba(255, 0, 0, 1);\">è¿™ä¸ªå‚æ•°ä»£è¡¨çš„å«ä¹‰æ˜¯ï¼šæ¨¡å‹ä¸€æ¬¡çœ‹å¤šå°‘å¸§ä½œä¸ºä¸€ä¸ªtokenã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºæ¯ä¸ªvideo tokenè¦†ç›–çš„è¿ç»­å¸§æ•°ã€‚åœ¨è¿™é‡ŒæŒ‡å®šä¸º2ï¼Œä¹Ÿå°±è¡¨ç¤ºæ¯2å¸§åˆå¹¶æˆ1ä¸ªæ—¶é—´patchï¼Œè¿™æ ·å°±å¤©ç„¶åŒ…å«äº†å¸§åºåˆ—ä¸­è¿åŠ¨/å˜åŒ–çš„ä¿¡æ¯</span>ã€‚è¿™ä¸ªå‚æ•°è¶Šå°ï¼Œèƒ½æ•æ‰åˆ°çš„åŠ¨ä½œå˜åŒ–å°±è¶Šç»†ï¼Œå¯¹åº”æ¶ˆè€—çš„tokenä¹Ÿè¶Šå¤šã€‚æ‰€ä»¥è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆè¾“å…¥æ¨¡å‹çš„patchå¸ƒå±€ä¸º15 * 40 * 72ã€‚</p>\n<p>å†çœ‹pixel_value_videosçš„shapeä¸ºtorch.Size([43200, 1536])ï¼š</p>\n<ol>\n<li>ç¬¬ä¸€ç»´çš„43200å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯è¿™ä¸ªè§†é¢‘çš„patchæ•°é‡ï¼Œä¹Ÿå°±æ˜¯15 * 40 * 72 = 43,200ã€‚</li>\n<li>ç°åœ¨æˆ‘ä»¬å·²çŸ¥è¾“å…¥æ¨¡å‹çš„1ä¸ªvision tokenï¼ˆä¹Ÿå°±æ˜¯patch tokenï¼‰çš„ç»„æˆä¸ºï¼š2å¸§ * patchåƒç´ ã€‚æ¯ä¸ªpatchå¯¹åº”çš„åƒç´ ä¸ºï¼š2 * 3(RGBé€šé“) * (16*16) =1536ï¼Œè¿™å°±å¯¹åº”åˆ°äº†pixel_value_videosçš„ç¬¬äºŒç»´ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªpatchçš„ç»´åº¦ã€‚</li>\n</ol>\n<p>æœ€åå†çœ‹input_idsç»“æœï¼Œå…¶shapeä¸º([1, 10938])ï¼Œå¯¹å…¶åšdecodeçš„ç»“æœä¸ºï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">&lt;|im_start|&gt;user\n&lt;0.3 seconds&gt;&lt;|vision_start|&gt;\n<span style=\"color: rgba(255, 0, 0, 1);\">&lt;|video_pad|&gt;*10800 ï¼ˆè¡¨ç¤ºå‡ºç°10800æ¬¡&lt;|video_pad|&gt;ï¼‰\n</span>&lt;|vision_end|&gt;è¯·æè¿°è¿™ä¸ªè§†é¢‘çš„å†…å®¹&lt;|im_end|&gt;\n&lt;|im_start|&gt;assistant\n</pre>\n</div>\n<p>ã€€ã€€</p>\n<p>è¿™é‡Œæˆ‘ä»¬å·²çŸ¥&lt;|video_pad|&gt;æ˜¯ä½œä¸ºåç»­video patch tokençš„å ä½ç¬¦ã€‚é‚£ä¸ºä»€ä¹ˆä¸Šé¢è®¡ç®—å¾—åˆ°çš„<span style=\"color: rgba(255, 0, 0, 1);\">åŸå§‹vision patchçš„æ•°é‡ä¸º43200ï¼Œä½†åˆ°çœŸæ­£è½¬ä¸ºtoken idsæ—¶å°±åªæœ‰10800ä¸ªvision tokenäº†ï¼Ÿè¿™æ¶‰åŠåˆ°å¦ä¸€ä¸ªå‚æ•°ä¸ºspatial_merge_sizeï¼ˆQwen3-VL-4B-Instructé‡Œé»˜è®¤ä¸º2ï¼‰ã€‚</span>è¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªç©ºé—´ä¸‹é‡‡æ ·/ç‰¹å¾åˆå¹¶å‚æ•°ï¼Œç”¨æ¥æ§åˆ¶â€œæŠŠç›¸é‚»çš„å° patch èšåˆæˆä¸€ä¸ªå¤§ tokenâ€çš„ç²’åº¦ï¼Œä»è€Œç›´æ¥å†³å®šè§†è§‰åºåˆ—çš„é•¿åº¦ä¸åç»­è®¡ç®—é‡ã€‚æ›´ç›´æ¥ç‚¹è¯´ï¼Œå°±æ˜¯ä¸ºäº†å‡å°‘åç»­attentionçš„è®¡ç®—é‡ä»è€ŒèŠ‚çº¦è®¡ç®—èµ„æºã€‚å¦‚æœå–å€¼ä¸º2ï¼Œåˆ™è¡¨ç¤ºæŠŠ2 x 2 ä¸ªåŸå§‹patchç‰¹å¾å†æ‹¼æ¥æˆ1ä¸ªtokenï¼Œä»è€Œå‡å°‘4å€çš„åºåˆ—é•¿åº¦ï¼Œæ‰€ä»¥mergeåä¸º10800ä¸ªtoken idï¼Œä¹Ÿå°±æ˜¯43200 / 4 = 10800ã€‚</p>\n<p>æœ€åï¼Œåœ¨è¿è¡Œmodel.generate()æ—¶ï¼Œå°†&lt;|video_pad|&gt;æ›¿æ¢ä¸ºmergeåçš„patchç‰¹å¾ï¼Œä¾¿æ„é€ äº†è§†é¢‘æ¨ç†æ¨¡å‹çš„è¾“å…¥ï¼Œå¼€å§‹æ‰§è¡Œprefill+decodeæ¨ç†æµç¨‹ã€‚</p>\n<p>&nbsp;</p>\n<h2>2. æ¨¡å‹å…¨å‚å¾®è°ƒ</h2>\n<p>åœ¨ç†è§£äº†è§†é¢‘æ¨ç†çš„æµç¨‹åï¼Œç»§ç»­è¿›è¡Œæ¨¡å‹å¾®è°ƒã€‚é¦–å…ˆéœ€è¦å‡†å¤‡ä¸€äº›è§†é¢‘ç´ æå¹¶è¿›è¡Œæ‰“æ ‡ã€‚</p>\n<h3>2.1. è§†é¢‘è®­ç»ƒæ•°æ®å‡†å¤‡</h3>\n<p>è¿™é‡Œæˆ‘ä»¬ä»å¼€æºæ•°æ®é›†MicroLens[2]ä¸­é€‰å–äº†éƒ¨åˆ†ç‹è€…è£è€€è§†é¢‘çš„æ•°æ®ï¼Œå¹¶å¯¹å…¶åšäº†åˆ‡åˆ†ï¼Œå°†è§†é¢‘åˆ‡åˆ†ä¸º15sä»¥ä¸‹çš„ç‰‡æ®µï¼Œç„¶åäººå·¥è¡¥å……æè¿°ã€‚</p>\n<p>å¯¹äºä¸€ä¸ªç¤ºä¾‹ç‰‡æ®µï¼š</p>\n<p>&nbsp;<img alt=\"image\" height=\"226\" src=\"https://img2024.cnblogs.com/blog/1287132/202601/1287132-20260114123635037-1219532860.png\" width=\"402\" /></p>\n<p>&nbsp;<img alt=\"image\" height=\"226\" src=\"https://img2024.cnblogs.com/blog/1287132/202601/1287132-20260114123522486-441416678.png\" width=\"402\" /></p>\n<p>è®©Qwen3-VL-4B-Instructè¿›è¡Œæè¿°ï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">è¾“å…¥ï¼šæè¿°è¿™ä¸ªè§†é¢‘å¹¶è¿›è¡Œæ‰“æ ‡,ä½¿ç”¨jsonè¾“å‡ºæ ‡ç­¾\n\nè¾“å‡ºä¸ºï¼š\n{\n    \"video_description\": \"è§†é¢‘å±•ç¤ºäº†ä¸€æ¬¾å¤šäººåœ¨çº¿æˆ˜æ–—ç«æŠ€æ¸¸æˆçš„å®æ—¶å¯¹æˆ˜åœºæ™¯ã€‚ç”»é¢ä¸­ï¼Œç©å®¶æ“æ§è§’è‰²åœ¨æ¸¸æˆåœ°å›¾ä¸Šè¿›è¡Œæ¿€çƒˆæˆ˜æ–—ï¼Œä½¿ç”¨æŠ€èƒ½å’Œè£…å¤‡è¿›è¡Œæ”»å‡»å’Œé˜²å¾¡ã€‚å±å¹•å·¦ä¸‹è§’æ˜¾ç¤ºäº†ä¸€ä½ç©å®¶æ­£åœ¨ç›´æ’­ï¼Œä»–ä¸“æ³¨åœ°æ“ä½œç€æ¸¸æˆï¼ŒèƒŒæ™¯æ˜¯è“è‰²æ¡çº¹çª—å¸˜ã€‚æ¸¸æˆç•Œé¢æ˜¾ç¤ºäº†è§’è‰²çš„è¡€é‡ã€æŠ€èƒ½å†·å´ã€è£…å¤‡çŠ¶æ€ä»¥åŠå°åœ°å›¾ç­‰ä¿¡æ¯ã€‚æˆ˜æ–—è¿‡ç¨‹ä¸­ï¼Œè§’è‰²ä¸æ–­é‡Šæ”¾æŠ€èƒ½ï¼Œé€ æˆä¼¤å®³å¹¶è·å¾—é‡‘å¸ã€‚å±å¹•å³ä¸‹è§’æœ‰æ“ä½œæŒ‰é’®ï¼ŒåŒ…æ‹¬æŠ€èƒ½é‡Šæ”¾å’Œç§»åŠ¨æ§åˆ¶ã€‚ç”»é¢ä¸­è¿˜å‡ºç°äº†ä¸­æ–‡æ–‡å­—æç¤ºï¼Œå¦‚â€œè€å¤«å­è·Ÿæˆ‘ä»¬å¼€å›¢å§â€å’Œâ€œä»–å‡­ä»€ä¹ˆè·Ÿæˆ‘æ‰“â€ï¼Œæ˜¾ç¤ºäº†ç©å®¶åœ¨æ¸¸æˆä¸­çš„å¯¹è¯å’Œç­–ç•¥ã€‚æ•´ä½“æ°›å›´ç´§å¼ åˆºæ¿€ï¼Œå……æ»¡ç«æŠ€æ€§ã€‚\",\n    \"tags\": [\n        \"æ¸¸æˆç›´æ’­\",\n        \"å¤šäººåœ¨çº¿æˆ˜æ–—ç«æŠ€\",\n        \"è§’è‰²æ‰®æ¼”\",\n        \"æŠ€èƒ½æˆ˜æ–—\",\n        \"æ¸¸æˆç•Œé¢\",\n        \"ç›´æ’­ä¸»æ’­\",\n        \"ç«æŠ€å¯¹æˆ˜\",\n        \"æ¸¸æˆç­–ç•¥\",\n        \"ä¸­æ–‡æ–‡å­—\",\n        \"å®æ—¶æˆ˜æ–—\"\n    ]\n}\n</pre>\n</div>\n<p>ã€€ã€€</p>\n<p>ä¸‹é¢æˆ‘ä»¬å¯¹è¿™ç±»æ¸¸æˆè§†é¢‘ä½¿ç”¨ä»¥ä¸‹æ¨¡å¼è¿›è¡Œæ‰“æ ‡ï¼Œä¾‹å¦‚ï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">{\n\t\"video\": \"wzry/4/1.mp4\",\n\t\"conversations\": [{\n\t\t\t\"from\": \"human\",\n\t\t\t\"value\": \"&lt;video&gt;\\næè¿°è¿™ä¸ªè§†é¢‘å¹¶è¿›è¡Œæ‰“æ ‡,ä½¿ç”¨jsonè¾“å‡ºæ ‡ç­¾\"\n\t\t},\n\t\t{\n\t\t\t\"from\": \"gpt\",\n\t\t\t\"value\": {\n\t\t\t\t\"video_description\": \"è§†é¢‘å±•ç¤ºçš„ç‹è€…è£è€€æ¸¸æˆçš„ç•Œé¢ã€‚åœ¨ç”»é¢ä¸­ï¼Œé¦–å…ˆå±•ç¤ºçš„æ˜¯è§’è‰²ä¿¡æ¯ç•Œé¢å’Œä»–ä»¬çš„æˆ˜ç»©ï¼Œè§’è‰²åŒ…æ‹¬å‡¯ã€å…ƒæ­Œã€å¬´æ”¿ã€‚ç„¶ååˆå±•ç¤ºäº†è§’è‰²æ¾œã€ç‹„ä»æ°å’Œä¸çŸ¥ç«èˆã€‚æ¥ä¸‹æ¥æ˜¯ç”·ä¸»æ’­æ“ä½œå‡¯çš„è®°å½•ï¼Œç”»é¢å·¦ä¸‹è§’çš„å°æ¡†æ˜¯ç”·ä¸»æ’­çš„è§†é¢‘ã€‚æ•´ä½“ç”»é¢ä¸­å±•ç¤ºäº†å‡¯å’Œæ•Œæ–¹äº¤æˆ˜çš„åœºæ™¯ï¼Œå…¶ä¸­å‡¯å‘åŠ¨äº†å˜èº«æŠ€èƒ½å’Œä¸‰ä¸ªæ•Œæ–¹å•ä½è¿›è¡Œäº¤æˆ˜ã€‚åœ¨äº¤æˆ˜è¿‡ç¨‹ä¸­å‡¯ç»ˆç»“äº†ç‹„ä»æ°ã€‚\",\n\t\t\t\t\"tags\": [\n\t\t\t\t\t\"æ¸¸æˆç›´æ’­\",\n\t\t\t\t\t\"ç‹è€…è£è€€\",\n\t\t\t\t\t\"å‡¯\",\n\t\t\t\t\t\"ç‹„ä»æ°\",\n\t\t\t\t\t\"æ¾œ\",\n\t\t\t\t\t\"æˆ˜æ–—ç”»é¢\"\n\t\t\t\t]\n\t\t\t}\n\n\t\t}\n\t]\n</pre>\n</div>\n<p>ã€€ã€€</p>\n<p>åç»­æŒ‰ç…§è¿™ä¸ªæ¨¡å¼å‡†å¤‡å¯¹åº”çš„è®­ç»ƒæ•°æ®ã€‚</p>\n<h3>2.2. æ¨¡å‹è®­ç»ƒ</h3>\n<p>é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨å°æ¨¡å‹è¿›è¡Œæµ‹è¯•å¹¶éªŒè¯æ•ˆæœï¼Œä½¿ç”¨Qwen3-VL-4B-Instructæ¨¡å‹ï¼Œå‚è€ƒå®˜æ–¹æä¾›çš„è®­ç»ƒè„šæœ¬è¿›è¡Œè®­ç»ƒ[3]ã€‚</p>\n<p>è®­ç»ƒæ¨¡å‹çš„å‘½ä»¤ä¸ºï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">torchrun \\\n  # ========== åˆ†å¸ƒå¼å¯åŠ¨ ==========\n  --nproc_per_node=8 \\\n  --master_addr=127.0.0.1 \\\n  --master_port=29500 \\\n\n  # ========== è®­ç»ƒå…¥å£ ==========\n  Qwen3-VL/qwen-vl-finetune/qwenvl/train/train_qwen.py \\\n\n  # ========== DeepSpeed ==========\n  --deepspeed=Qwen3-VL/qwen-vl-finetune/scripts/zero3.json \\\n\n  # ========== æ¨¡å‹ä¸æ•°æ® ==========\n  --model_name_or_path=Qwen/Qwen3-VL-4B-Instruct \\\n  --dataset_use=wzry_video%100 \\\n\n  # ========== è¾“å‡ºä¸å®éªŒæ ‡è¯† ==========\n  --output_dir=./output/wzry_video_finetune \\\n  --run_name=wzry_video_qwen3vl_4b \\\n\n  # ========== å¤šæ¨¡æ€å¯è®­ç»ƒæ¨¡å— ==========\n  --tune_mm_vision=True \\\n  --tune_mm_mlp=True \\\n  --tune_mm_llm=True \\\n\n  # ========== ç²¾åº¦ä¸è®­ç»ƒè½®æ•° ==========\n  --bf16 \\\n  --num_train_epochs=20 \\\n\n  # ========== Batch &amp; ç´¯ç§¯ ==========\n  --per_device_train_batch_size=2 \\\n  --per_device_eval_batch_size=4 \\\n  --gradient_accumulation_steps=4 \\\n\n  # ========== å­¦ä¹ ç‡ï¼ˆåˆ†æ¨¡å—ï¼‰ ==========\n  --learning_rate=2e-05 \\\n  --mm_projector_lr=4e-05 \\\n  --vision_tower_lr=2e-06 \\\n\n  # ========== ä¼˜åŒ–å™¨ä¸è°ƒåº¦ ==========\n  --weight_decay=0.01 \\\n  --warmup_ratio=0.03 \\\n  --lr_scheduler_type=cosine \\\n  --max_grad_norm=1.0 \\\n\n  # ========== ä¸Šä¸‹æ–‡ä¸æ•°æ®ç»„ç»‡ ==========\n  --model_max_length=8192 \\\n  --data_flatten=True \\\n  --data_packing=False \\\n\n  # ========== è§†é¢‘é‡‡æ ·å‚æ•° ==========\n  --video_fps=4 \\\n  --video_max_frames=32 \\\n  --video_min_frames=16 \\\n\n  # ========== è§†é¢‘åˆ†è¾¨ç‡ / token æ§åˆ¶ ==========\n  --video_max_pixels=1003520 \\\n  --video_min_pixels=401408 \\\n  --max_pixels=602112 \\\n  --min_pixels=100352 \\\n\n  # ========== è¯„ä¼°ä¸ä¿å­˜ ==========\n  --eval_strategy=no \\\n  --save_strategy=epoch \\\n  --save_steps=2 \\\n  --save_total_limit=3 \\\n\n  # ========== æ—¥å¿— ==========\n  --logging_steps=2 \\\n  --report_to=tensorboard \\\n  --gradient_checkpointing=True \\\n  --dataloader_num_workers=4\n</pre>\n</div>\n<p>&nbsp;</p>\n<p>å…¶ä¸­æˆ‘ä»¬ä»‹ç»å‡ ä¸ªåœ¨è§†é¢‘ç†è§£æ¨¡å‹é‡Œçš„å‚æ•°ï¼š<br />1.\tå¤šæ¨¡æ€å‚æ•°æ˜¯å¦å¯è®­ç»ƒï¼ŒåŒ…æ‹¬Vision Encoderï¼Œå¤šæ¨¡æ€æŠ•å½±å±‚å’Œè¯­è¨€æ¨¡å‹ï¼š<br />ã€€ã€€a)\t--tune_mm_vision=True --tune_mm_mlp=True --tune_mm_llm=True<br />ã€€ã€€b)\tä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯ä¸ªå…¨å‚å¾®è°ƒï¼Œé€‚åˆäºGPUèµ„æºæ¯”è¾ƒå……è¶³çš„æƒ…å†µï¼Œè¾¾åˆ°æ›´å¥½çš„æ•ˆæœã€‚å¦åˆ™å¯ä»¥å†»ç»“éƒ¨ä»½å‚æ•°<br />2.\tè§†é¢‘å‚æ•°ï¼š<br />ã€€ã€€a)\t--video_fps=4 --video_max_frames=32 --video_min_frames=16<br />ã€€ã€€b)\t--video_max_pixels=1003520 --video_min_pixels=401408 --max_pixels=602112 --min_pixels=100352<br />ã€€ã€€c)\tè¿™å‡ ä¸ªå‚æ•°æ˜¯æ§åˆ¶å¸§é‡‡æ ·ä¸å•å¸§åˆ†è¾¨ç‡ï¼Œé˜²æ­¢GPU OOMå’Œtokenå¸§æ•°å¤ªå¤šçš„æƒ…å†µï¼Œå°†tokenæ•°resizeåˆ°åˆç†çš„ç©ºé—´èŒƒå›´å†…ã€‚å’Œæ¨ç†æ—¶æŒ‡å®šçš„å‚æ•°ç±»ä¼¼</p>\n<p>æ‰€ä»¥ï¼Œåœ¨gpuèµ„æºæœ‰é™æ—¶ï¼Œé™¤äº†å¸¸è§„çš„å‡å°‘batch sizeã€model_max_lengthã€åˆ‡æ¢zero stageã€ä½¿ç”¨loraç­‰ï¼Œè¿˜å¯ä»¥è°ƒæ•´ä¸Šè¿°çš„ä¾‹å¦‚å†»ç»“Vision Encoderå±‚ã€æ§åˆ¶è§†é¢‘å‚æ•°ç­‰æ¥è¿›è¡Œè¿›ä¸€æ­¥çš„å‡å°‘gpuçš„éœ€æ±‚ã€‚</p>\n<p>&nbsp;</p>\n<p>ä»è®­ç»ƒè¿‡ç¨‹æ¥çœ‹ï¼Œæ”¶æ•›è‰¯å¥½ï¼š</p>\n<p><img height=\"290\" src=\"https://img2024.cnblogs.com/blog/1287132/202601/1287132-20260114112650206-1402113901.png\" width=\"833\" /></p>\n<p>&nbsp;</p>\n<p>ä¸‹é¢æµ‹è¯•å…¨å‚å¾®è°ƒåä¸åŸå§‹æ¨¡å‹çš„å¯¹æ¯”æ•ˆæœï¼Œä½¿ç”¨å¦ä¸€ä¸ªç¤ºä¾‹è§†é¢‘ï¼š</p>\n<p><img alt=\"image\" height=\"247\" src=\"https://img2024.cnblogs.com/blog/1287132/202601/1287132-20260114123720076-1055836250.png\" width=\"438\" />&nbsp; &nbsp;</p>\n<p><img alt=\"image\" height=\"246\" src=\"https://img2024.cnblogs.com/blog/1287132/202601/1287132-20260114123805605-2070787796.png\" width=\"437\" /></p>\n<p>&nbsp;</p>\n<p>å¯ä»¥çœ‹åˆ°åŸå§‹æ¨¡å‹å¯¹è§†é¢‘åšäº†æ•´ä½“çš„ç†è§£ï¼Œå¯ä»¥æ­£å¸¸ç†è§£ä¸ºæ¸¸æˆç”»é¢ï¼Œä»¥åŠè§†é¢‘çš„å¤§è‡´å†…å®¹ï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">python test_inference.py --model Qwen/Qwen3-VL-4B-Instruct --video ../data/wzry/57/2.mp4 --prompt \"æè¿°è¿™ä¸ªè§†é¢‘å¹¶è¿›è¡Œæ‰“æ ‡,ä½¿ç”¨jsonè¾“å‡ºæ ‡ç­¾ï¼Œä½¿ç”¨ä¸­æ–‡ã€‚\"\n\n{\n  \"video_description\": \"è¿™æ˜¯ä¸€æ®µã€Šç‹è€…è£è€€ã€‹çš„æ¸¸æˆå½•åƒï¼Œå±•ç¤ºäº†ç©å®¶åœ¨æ¸¸æˆä¸­çš„æˆ˜æ–—å’Œæ“ä½œè¿‡ç¨‹ã€‚ç”»é¢ä¸­å¯ä»¥çœ‹åˆ°å¤šä¸ªè‹±é›„è§’è‰²åœ¨æ²³é“åŒºåŸŸè¿›è¡Œæ¿€çƒˆå¯¹æˆ˜ï¼Œå…¶ä¸­åŒ…æ‹¬ä½¿ç”¨æŠ€èƒ½æ”»å‡»æ•Œæ–¹å•ä½ã€èº²é¿ä¼¤å®³ä»¥åŠåˆ©ç”¨åœ°å½¢ä¼˜åŠ¿è¿›è¡Œæˆ˜æœ¯é…åˆã€‚å±å¹•å·¦ä¸Šè§’æ˜¾ç¤ºäº†å°åœ°å›¾å’Œé˜Ÿä¼çŠ¶æ€ï¼Œå³ä¸‹è§’åˆ™æœ‰æŠ€èƒ½æŒ‰é’®å’Œä¼¤å®³æ•°å€¼æç¤ºã€‚æ•´ä¸ªåœºæ™¯å……æ»¡åŠ¨æ„Ÿï¼Œå±•ç°äº†å¿«èŠ‚å¥çš„MOBAç«æŠ€é£æ ¼ã€‚\",\n  \"tags\": [\n    \"ç‹è€…è£è€€\",\n    \"MOBAæ¸¸æˆ\",\n    \"è‹±é›„å¯¹æˆ˜\",\n    \"æŠ€èƒ½é‡Šæ”¾\",\n    \"å›¢é˜Ÿåä½œ\",\n    \"æ¸¸æˆç›´æ’­\",\n    \"æˆ˜æ–—åœºé¢\",\n    \"æ¸¸æˆç­–ç•¥\"\n  ]\n}\n</pre>\n</div>\n<p>ã€€ã€€</p>\n<p>ç„¶åå†çœ‹å¾®è°ƒåçš„æ¨¡å‹æ•ˆæœï¼Œå¯ä»¥çœ‹åˆ°è§†é¢‘å¯¹å†…å®¹ç†è§£çš„æ›´ä¸ºç²¾å‡†ï¼š</p>\n<div class=\"cnblogs_Highlighter\">\n<pre class=\"brush:python;gutter:true;\">python test_inference.py --model ~/multi-model-train/output/wzry_video_finetune/ --video ../data/wzry/57/2.mp4 --prompt \"æè¿°è¿™ä¸ªè§†é¢‘å¹¶è¿›è¡Œæ‰“æ ‡,ä½¿ç”¨jsonè¾“å‡ºæ ‡ç­¾\"\n\n{\n  \"video_description\": \"è¿™æ˜¯ç‹è€…è£è€€æ¸¸æˆç•Œé¢ï¼Œåˆšå¼€å§‹æ˜¯è§’è‰²â€œç™¾é‡Œå®ˆçº¦â€çš„æ¸¸ç©è®°å½•ï¼Œå·¦ä¸Šè§’æ˜¾ç¤ºçš„æ˜¯æ•Œæ–¹ä¿¡æ¯å’Œæˆ‘çš„æ–¹ä¿¡æ¯ã€‚åœ¨ç”»é¢ä¸­ï¼Œâ€œç™¾é‡Œå®ˆçº¦â€å¼€æªå‡»è´¥äº†è§’è‰²â€œè‹çƒˆâ€ã€‚ç„¶åâ€œç™¾é‡Œå®ˆçº¦â€å—åˆ°äº†æ•Œæ–¹çš„æ”»å‡»ï¼Œåœ¨ä½¿ç”¨æŠ€èƒ½ä½ç§»äº†ä¸€æ®µè·ç¦»åå‘åŠ¨æŠ€èƒ½ä¸å¯¹æ–¹è§’è‰²â€œæ¾œâ€äº¤æˆ˜ï¼Œå¹¶å°†å¯¹æ–¹æ‰“æˆæ®‹è¡€ã€‚\",\n  \"tags\": [\n    \"ç‹è€…è£è€€\",\n    \"ç™¾é‡Œå®ˆçº¦\",\n    \"æ¾œ\",\n    \"æˆ˜æ–—ç”»é¢\"\n  ]\n}</pre>\n</div>\n<p>ã€€ã€€</p>\n<h2>3. æ€»ç»“</h2>\n<p>æœ¬æ–‡å›´ç»• qwen3-vl-4b-instructï¼Œå¯¹å¤šæ¨¡æ€è§†é¢‘ç†è§£ä¸­çš„æ¨ç†ä¸å…¨å‚æ•°å¾®è°ƒè¿‡ç¨‹è¿›è¡Œäº†å®Œæ•´å®è·µï¼Œä»è§†é¢‘è¾“å…¥æ„å»ºã€æ¨ç†æ‰§è¡Œï¼Œåˆ°åŸºäºçœŸå®æ¸¸æˆè§†é¢‘çš„æ•°æ®å‡†å¤‡ä¸è®­ç»ƒé…ç½®ï¼Œç³»ç»Ÿæ¢³ç†äº†å¤šæ¨¡æ€æ¨¡å‹åœ¨è§†é¢‘åœºæ™¯ä¸‹çš„å·¥ç¨‹ç»†èŠ‚ã€‚åç»­æˆ‘ä»¬å°†è¿›ä¸€æ­¥ä»‹ç»å¦‚ä½•å¯¹è§†é¢‘è¿™ç±»éç»“æ„åŒ–ç‰¹å¾è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œå¹¶é€æ­¥å®Œå–„æ¨¡å‹çš„æŒç»­è®­ç»ƒ pipelineï¼ŒåŒ…æ‹¬ç‰¹å¾å¤„ç†ã€ç‰ˆæœ¬åŒ–ä¸ç®¡ç†æœºåˆ¶ï¼Œä»¥åŠæ¨¡å‹ç‰ˆæœ¬çš„ç®¡ç†ä¸éƒ¨ç½²ï¼Œä»¥æ”¯æ’‘æ›´ç¨³å®šã€å¯æ‰©å±•çš„å¤šæ¨¡æ€åº”ç”¨è½åœ°ã€‚</p>\n<p>&nbsp;</p>\n<h2>References</h2>\n<p>1. video_processing_qwen3_vl.pyï¼š<a href=\"https://github.com/huggingface/transformers/blob/main/src/transformers/models/qwen3_vl/video_processing_qwen3_vl.py\" rel=\"noopener nofollow\">https://github.com/huggingface/transformers/blob/main/src/transformers/models/qwen3_vl/video_processing_qwen3_vl.py</a></p>\n<p>2. MicroLens Githubï¼š<a href=\"https://github.com/westlake-repl/MicroLens\" rel=\"noopener nofollow\">https://github.com/westlake-repl/MicroLens</a></p>\n<p>3. QwenVL Training Framework: <a href=\"https://github.com/QwenLM/Qwen3-VL/tree/main/qwen-vl-finetune\" rel=\"noopener nofollow\">https://github.com/QwenLM/Qwen3-VL/tree/main/qwen-vl-finetune</a></p>\n<p>&nbsp;</p>\n</div>\n<div class=\"clear\"></div>\n\n\t\t</div>\n\t\t<div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 20:54</span>&nbsp;\n<a href=\"https://www.cnblogs.com/zackstang\">ZacksTang</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">28</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "ä¸€æ¬¡å†…ç½‘å¼€å‘ç¯å¢ƒè®¿é—®æ–¹å¼çš„æ”¹è¿›å®è·µï¼šä½¿ç”¨ FRP æ›¿ä»£è¿œç¨‹æ¡Œé¢",
      "link": "https://www.cnblogs.com/YpEng-Codeme/p/19484150",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/YpEng-Codeme/p/19484150\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 20:15\">\n    <span>ä¸€æ¬¡å†…ç½‘å¼€å‘ç¯å¢ƒè®¿é—®æ–¹å¼çš„æ”¹è¿›å®è·µï¼šä½¿ç”¨ FRP æ›¿ä»£è¿œç¨‹æ¡Œé¢</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"ä¸€æ¬¡å†…ç½‘å¼€å‘ç¯å¢ƒè®¿é—®æ–¹å¼çš„æ”¹è¿›å®è·µä½¿ç”¨-frp-æ›¿ä»£è¿œç¨‹æ¡Œé¢\">ä¸€æ¬¡å†…ç½‘å¼€å‘ç¯å¢ƒè®¿é—®æ–¹å¼çš„æ”¹è¿›å®è·µï¼šä½¿ç”¨ FRP æ›¿ä»£è¿œç¨‹æ¡Œé¢</h1>\n<h2 id=\"ä¸€èƒŒæ™¯\">ä¸€ã€èƒŒæ™¯</h2>\n<p>åœ¨å…¬å¸é¡¹ç›®ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°è¿™æ ·ä¸€ç§å¼€å‘ç¯å¢ƒé™åˆ¶ï¼š</p>\n<blockquote>\n<p><strong>é¡¹ç›®å†…ç½‘æœåŠ¡å™¨ç¦æ­¢ç›´æ¥è®¿é—®å¤–ç½‘</strong></p>\n</blockquote>\n<p>ä¸ºäº†åœ¨è¯¥ç¯å¢ƒä¸‹è¿›è¡Œå¼€å‘å’Œè°ƒè¯•ï¼Œå¸¸è§çš„åšæ³•æ˜¯ï¼š</p>\n<ul>\n<li>å‡†å¤‡ä¸€å° <strong>å¯ä»¥è”ç½‘çš„å°å¼æœº</strong></li>\n<li>é€šè¿‡ <strong>å‘æ—¥è‘µ / ToDesk / Windows è¿œç¨‹æ¡Œé¢</strong> ç­‰æ–¹å¼è¿œç¨‹æ§åˆ¶è¿™å°æœºå™¨</li>\n<li>å†ç”±è¯¥æœºå™¨è®¿é—®å†…ç½‘æœåŠ¡å™¨è¿›è¡Œå¼€å‘ã€è°ƒè¯•ç­‰æ“ä½œ</li>\n</ul>\n<hr />\n<h2 id=\"äºŒé—®é¢˜æè¿°\">äºŒã€é—®é¢˜æè¿°</h2>\n<h3 id=\"21-ç°æœ‰æ–¹æ¡ˆçš„ç—›ç‚¹\">2.1 ç°æœ‰æ–¹æ¡ˆçš„ç—›ç‚¹</h3>\n<p>è¿œç¨‹æ¡Œé¢ä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼š</p>\n<ol>\n<li>\n<p><strong>å—ç½‘ç»œè´¨é‡å½±å“è¾ƒå¤§</strong><br />\nç½‘ç»œå¦‚æœ‰æ³¢åŠ¨ï¼Œç”»é¢å°±ä¼šå¡é¡¿ã€å»¶è¿Ÿæ–­è¿ï¼Œå½±å“å¼€å‘ä½“éªŒã€‚</p>\n</li>\n<li>\n<p><strong>å¼€å‘ç¯å¢ƒé‡å¤æ­å»º</strong><br />\néœ€è¦åœ¨â€œä¸­è½¬çš„è”ç½‘æœºå™¨â€ä¸Šå®‰è£… IDEã€SDKã€ç¼–è¯‘å·¥å…·ä»¥åŠå„ç§ä¾èµ–ï¼Œç»´æŠ¤æˆæœ¬è¾ƒé«˜ã€‚</p>\n</li>\n<li>\n<p><strong>å›¾å½¢åŒ–å¹¶éå¿…éœ€</strong><br />\nå®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¤§å¤šæ•°æ“ä½œï¼ˆä»£ç ç¼–è¾‘ã€æœåŠ¡è¿è¡Œã€æ—¥å¿—æŸ¥çœ‹ç­‰ï¼‰å®Œå…¨å¯ä»¥é€šè¿‡ SSH å®Œæˆï¼Œå¹¶ä¸ä¾èµ– GUIï¼Œç”šè‡³å½“ä½ éœ€è¦è°ƒè¯•å‰ç«¯ä»£ç æ—¶ä¹Ÿå¯ä»¥é€šè¿‡å°†è¯¥å‰ç«¯ç«¯å£ä¹Ÿæ˜ å°„å‡ºæ¥çš„æ–¹å¼å®ç°ã€‚</p>\n</li>\n</ol>\n<hr />\n<h2 id=\"ä¸‰æ€è·¯åˆ†æ\">ä¸‰ã€æ€è·¯åˆ†æ</h2>\n<p>ä»”ç»†æƒ³æƒ³ï¼š</p>\n<blockquote>\n<p><strong>æˆ‘ä»¬ä¸»è¦ä¸ºçš„ä¸æ˜¯â€œè¿œç¨‹æ§åˆ¶ä¸€å°ç”µè„‘â€ï¼Œè€Œæ˜¯â€œè®¿é—®å†…ç½‘æœåŠ¡å™¨â€ã€‚</strong></p>\n</blockquote>\n<p>ç”±æ­¤ä¾¿å¯å¾—å‡ºä¸€ä¸ªæ–°è·¯çº¿ï¼š</p>\n<ul>\n<li>è”ç½‘å°å¼æœºå¯ä»¥è®¿é—®å†…ç½‘æœåŠ¡å™¨</li>\n<li>è”ç½‘å°å¼æœºå¯ä»¥è®¿é—®å¤–ç½‘</li>\n<li>é‚£ä¹ˆå®ƒå¤©ç„¶å¯ä»¥ä½œä¸ºä¸€ä¸ª <strong>ç½‘ç»œè½¬å‘èŠ‚ç‚¹</strong></li>\n</ul>\n<p>ç”±æ­¤å¼•å…¥ <strong>FRPï¼ˆFast Reverse Proxyï¼‰</strong>ï¼Œé€šè¿‡ç«¯å£æ˜ å°„çš„æ–¹å¼ï¼Œå°†å†…ç½‘æœåŠ¡å™¨çš„æœåŠ¡æš´éœ²åˆ°å¤–ç½‘ã€‚</p>\n<hr />\n<h2 id=\"å››æ–¹æ¡ˆè®¾è®¡\">å››ã€æ–¹æ¡ˆè®¾è®¡</h2>\n<h3 id=\"41-ç½‘ç»œç»“æ„ç¤ºæ„\">4.1 ç½‘ç»œç»“æ„ç¤ºæ„</h3>\n<pre><code class=\"language-text\">æœ¬åœ°å¼€å‘ç”µè„‘\n        |\n        | SSH\n        v\nå¤–ç½‘æœåŠ¡å™¨ (frps)\n        |\n        | ç«¯å£è½¬å‘\n        v\nè”ç½‘å°å¼æœº (frpc)\n        |\n        | å†…ç½‘è®¿é—®\n        v\nå†…ç½‘æœåŠ¡å™¨ (192.168.1.144:22)\n</code></pre>\n<hr />\n<h3 id=\"42-ç«¯å£æ˜ å°„è¯´æ˜\">4.2 ç«¯å£æ˜ å°„è¯´æ˜</h3>\n<p>å‡è®¾ç¯å¢ƒå¦‚ä¸‹ï¼š</p>\n<ul>\n<li>å†…ç½‘æœåŠ¡å™¨ SSH åœ°å€ï¼š<code>192.168.1.144:22</code></li>\n<li>å¤–ç½‘æœåŠ¡å™¨åœ°å€ï¼š<code>114.113.112.111</code></li>\n<li>æ˜ å°„ç«¯å£ï¼š<code>6666</code></li>\n</ul>\n<p>æœ€ç»ˆå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®å†…ç½‘æœåŠ¡å™¨ï¼š</p>\n<pre><code class=\"language-bash\">ssh user@114.113.112.111 -p 6666\n</code></pre>\n<p>ç­‰ä»·äºï¼š</p>\n<pre><code class=\"language-bash\">ssh user@192.168.1.144 -p 22\n</code></pre>\n<hr />\n<h3 id=\"43-frp-å®¢æˆ·ç«¯é…ç½®ç¤ºä¾‹\">4.3 FRP å®¢æˆ·ç«¯é…ç½®ç¤ºä¾‹</h3>\n<p><code>frpc</code> è¿è¡Œåœ¨ <strong>è”ç½‘å°å¼æœº</strong> ä¸Šï¼Œé…ç½®ç¤ºä¾‹ï¼š</p>\n<pre><code class=\"language-ini\">[ssh_proxy]\ntype = tcp\nlocal_ip = 192.168.1.144\nlocal_port = 22\nremote_port = 6666\n</code></pre>\n<p><code>frps</code> éƒ¨ç½²åœ¨å¤–ç½‘æœåŠ¡å™¨ä¸Šï¼Œç”¨äºæ¥æ”¶å¤–éƒ¨è¿æ¥å¹¶è½¬å‘æµé‡ã€‚</p>\n<hr />\n<h2 id=\"äº”ç»“æœä¸æ•ˆæœ\">äº”ã€ç»“æœä¸æ•ˆæœ</h2>\n<h3 id=\"51-æ–¹æ¡ˆå¯¹æ¯”\">5.1 æ–¹æ¡ˆå¯¹æ¯”</h3>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ¡ˆ</th>\n<th>ç¨³å®šæ€§</th>\n<th>å»¶è¿Ÿ</th>\n<th>ç»´æŠ¤æˆæœ¬</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>è¿œç¨‹æ¡Œé¢</td>\n<td>è¾ƒå·®</td>\n<td>é«˜</td>\n<td>é«˜</td>\n</tr>\n<tr>\n<td>SSH + FRP</td>\n<td>ç¨³å®š</td>\n<td>ä½</td>\n<td>ä½</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"52-å®é™…æ”¶ç›Š\">5.2 å®é™…æ”¶ç›Š</h3>\n<ul>\n<li>ä¸å†ä¾èµ–å›¾å½¢åŒ–è¿œç¨‹æ¡Œé¢</li>\n<li>SSH è¿æ¥ç¨³å®šæ€§æ˜¾è‘—æå‡</li>\n<li>ä¸­è½¬æœºå™¨åªéœ€ä¿æŒå¼€æœºï¼Œæ— éœ€é•¿æœŸå ç”¨</li>\n<li>ä¸å½±å“ç°åœºå·¥ä½œäººå‘˜æ­£å¸¸ä½¿ç”¨è”ç½‘å°å¼æœº</li>\n</ul>\n<hr />\n<h2 id=\"å…­æ€»ç»“\">å…­ã€æ€»ç»“</h2>\n<ol>\n<li>\n<p><strong>é»˜è®¤æ–¹æ¡ˆä¸ä¸€å®šæ˜¯æœ€ä¼˜æ–¹æ¡ˆ</strong><br />\nè¿œç¨‹æ¡Œé¢æ›´é€‚åˆè¿ç»´æˆ–ä¸´æ—¶æ“ä½œï¼Œè€Œéé«˜é¢‘å¼€å‘åœºæ™¯ã€‚</p>\n</li>\n<li>\n<p><strong>FRP éå¸¸é€‚åˆå†…å¤–ç½‘æ¡¥æ¥åœºæ™¯</strong><br />\næ˜¾è‘—æå‡å¼€å‘æ•ˆç‡å’Œä½“éªŒã€‚</p>\n</li>\n</ol>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 20:15</span>&nbsp;\n<a href=\"https://www.cnblogs.com/YpEng-Codeme\">YounGp_oo</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "ã€å¼€æºè‡ªèã€‘ä¸ºAIçŸ­è§†é¢‘æ‰“é€ ä¸€ä¸ªåˆ†é•œç®¡ç†å¹³å°",
      "link": "https://www.cnblogs.com/Z7TS/p/19483978",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/Z7TS/p/19483978\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 19:31\">\n    <span>ã€å¼€æºè‡ªèã€‘ä¸ºAIçŸ­è§†é¢‘æ‰“é€ ä¸€ä¸ªåˆ†é•œç®¡ç†å¹³å°</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<blockquote>\n<p>åæ§½ï¼šå†™è¿™ç¯‡æ–‡ç« çš„æ—¶é—´ï¼Œæ¯”æˆ‘å¼€å‘è¿™ä¸ªé¡¹ç›®è¿˜è¦ä¹…ã€‚ğŸ˜‚</p>\n</blockquote>\n<p>ä» 2022 åˆ° 2026ï¼Œæˆ‘ç®—æ˜¯ä¸€è·¯è¿½ç€ AI è·‘çš„é‚£æ‰¹ç¨‹åºå‘˜ã€‚</p>\n<p>IDE ä» VS Studio é›†æˆ Copilotã€Cursorã€Augmentã€Windsurfã€Antigravityâ€¦â€¦æŠ˜è…¾ä¸€åœˆï¼Œæœ€ååˆå›å½’ <strong>VS Code + Copilot</strong>ã€‚<br />\næ¨¡å‹ä» GPT-3.5ï¼Œåˆ° Claude Codeã€Grokã€DeepSeekã€Qwenï¼›<br />\nç”Ÿå›¾/è§†é¢‘ä» Midjourneyã€Stable Diffusionï¼Œåˆ° Veoã€å³æ¢¦ã€å¯çµã€Banana Proâ€¦â€¦ä¸€è·¯è¿½ç€ä½“éªŒæ›´æ–°ã€‚</p>\n<p>ï¼ˆä»ç–¯ç‹‚ç™½å«–åˆ°çƒ­è¡·ä»˜è´¹ï¼Œå •è½äº†å‘€......ï¼‰</p>\n<p>é¢å¯¹ AIï¼Œæˆ‘çš„å¿ƒæƒ…ä¸€ç›´æ˜¯äº”å‘³æ‚é™ˆï¼š</p>\n<ul>\n<li>\n<p><strong>é…¸ï¼š</strong> ä»¥å‰ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ç†¬å¤œæ­»ç£•æºç ã€æ•°æ®ç»“æ„ï¼›ç°åœ¨ AI ç»™å‡ºçš„ä»£ç æ¯”æˆ‘å†™çš„å¥½å¤šäº†ï¼Œå¸®æˆ‘å¹²æ´»çš„åŒæ—¶è¿˜ç»™æˆ‘æƒ…ç»ªä½“éªŒï¼ æœ‰ç§â€œåå¹´å¯’çª—ä¸å¦‚ AI ä¸€ç¬â€çš„è½å·®æ„Ÿï¼ŒçœŸæ˜¯è¾›é…¸</p>\n</li>\n<li>\n<p><strong>ç”œï¼š</strong> æ•ˆç‡è´¼é«˜ï¼Œä»¥å‰è¦ç£¨åŠå¤©çš„åŠŸèƒ½ï¼Œç°åœ¨å‡ åˆ†é’Ÿå°±èƒ½è·‘èµ·æ¥ï¼Œçˆ½æ­ªæ­ª</p>\n</li>\n<li>\n<p><strong>è‹¦ï¼š</strong> AI å¼ºå½’å¼ºï¼Œtokenä¹Ÿæ˜¯çœŸçš„è´µï¼Œä¸å¤Ÿç”¨æ ¹æœ¬ä¸å¤Ÿç”¨ï¼Œå…¬å¸è¿˜ä¸ç»™æŠ¥é”€ï¼ˆå‘½è‹¦ï¼‰</p>\n</li>\n<li>\n<p><strong>è¾£ï¼š</strong> èŠ‚å¥è¶Šæ¥è¶Šå¿«ï¼Œå‘¨æœŸç¼©çŸ­ã€å¹¶è¡Œé¡¹ç›®å˜å¤šï¼Œè„‘å­æ¯å¤©éƒ½åœ¨é«˜è´Ÿè½½è¿è½¬</p>\n</li>\n<li>\n<p><strong>å’¸ï¼š</strong> æ—¶ä»£äº¤æ›¿é‡Œï¼Œä¸€ä¸ªåå¹´è€å…µä¸æƒ³æ‰é˜Ÿçš„çœ¼æ³ª</p>\n</li>\n</ul>\n<p>åœ¨è¿™ä¸‰å››å¹´æœ€å¤§çš„æ„Ÿå—å°±æ˜¯ï¼š<strong>æ—¶é—´å¥½å¿«ï¼Œæ—¶ä»£å˜åŒ–æ›´å¿«ï¼Œå¿«çš„æˆ‘éƒ½æ¥ä¸åŠæ‹¥æŠ±å˜åŒ–ğŸ˜µğŸ’«</strong>ã€‚</p>\n<hr />\n<h1 id=\"1è¨€å½’æ­£ä¼ 24å°æ—¶0-æ‰‹å†™ä»£ç æˆ‘åšäº†ä¸ªå•¥\">1ï¼‰è¨€å½’æ­£ä¼ ï¼š24å°æ—¶ï¼Œ0 æ‰‹å†™ä»£ç ï¼Œæˆ‘åšäº†ä¸ªå•¥ï¼Ÿ</h1>\n<p>æˆ‘åšäº†ä¸€ä¸ªæœ¬åœ°å®¢æˆ·ç«¯é¡¹ç›®ï¼š<strong>Storyboardï¼šé•œå¤´ç®¡ç†æ¿</strong>ã€‚ ç›®æ ‡å¾ˆç®€å•ï¼šé¢å‘çŸ­è§†é¢‘åˆ›ä½œè€…ä¸åˆ¶ä½œå›¢é˜Ÿçš„æœ¬åœ°åˆ†é•œå·¥ä½œå°ï¼šä»çˆ†æ¬¾è§†é¢‘å¯¼å…¥ï¼ˆæ¨¡ä»¿å¯¹è±¡ï¼‰ã€æŠ½å¸§ã€æ¨¡å‹åˆ‡æ¢ã€AI åˆ†æã€å›¾åƒ/è§†é¢‘ç”Ÿæˆï¼Œåˆ°æ‰¹é‡ä»»åŠ¡ä¸æˆç‰‡åˆæˆï¼Œä¸€æ¡é“¾è·¯å®Œæˆç®¡ç†ä¸è¾“å‡ºã€‚</p>\n<p><strong>æˆ‘åœ¨è¿™ä¸ªé¡¹ç›®å¼€å‘ä¸­ç”¨åˆ°çš„å·¥å…·/æ¨¡å‹ï¼š</strong></p>\n<ul>\n<li>\n<p>Chat æ¨¡å‹ï¼šChatGPT / Gemini / DeepSeek</p>\n</li>\n<li>\n<p>UI è®¾è®¡ï¼šFigma / å¢¨åˆ€</p>\n</li>\n<li>\n<p>ç¼–ç¨‹æ¨¡å‹ï¼šClaude Code 4.5 Sonnet / GPT-5.2 Codex</p>\n</li>\n<li>\n<p>ç¼–ç¨‹å·¥å…·ï¼šVS Code Copilot / Codex</p>\n</li>\n</ul>\n<p><strong>æŠ€æœ¯æ ˆï¼š</strong> Avalonia + SQLite + EF Core + .NET 8+ Semantic Kernel + Provider</p>\n<blockquote>\n<p>Talk is cheap. Show me the code.</p>\n</blockquote>\n<ul>\n<li>\n<p>é¡¹ç›®åœ°å€ï¼š<a href=\"https://github.com/BroderQi/Storyboard\" rel=\"noopener nofollow\" target=\"_blank\">GitHub å¼€æºä»“åº“ï¼ˆæ±‚ä¸ª Star â­ï¸ï¼‰</a></p>\n</li>\n<li>\n<p>åœ¨çº¿ä½“éªŒï¼š<a href=\"http://47.100.163.84/\" rel=\"noopener nofollow\" target=\"_blank\">Web Demoï¼ˆä»… UI å±•ç¤ºï¼‰</a></p>\n</li>\n<li>\n<p>å®¢æˆ·ç«¯ä¸‹è½½ï¼š<a href=\"https://github.com/BroderQi/Storyboard\" rel=\"noopener nofollow\" target=\"_blank\">å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬</a></p>\n</li>\n</ul>\n<p>ä¸»é¡µé¢ï¼š</p>\n<p><img alt=\"image\" src=\"https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114191819902-1798076118.png\" /></p>\n<hr />\n<h1 id=\"2é¡¹ç›®èƒŒæ™¯ai-çŸ­è§†é¢‘ç´ æç®¡ç†æ··ä¹±\">2ï¼‰é¡¹ç›®èƒŒæ™¯ï¼šAI çŸ­è§†é¢‘ç´ æç®¡ç†æ··ä¹±</h1>\n<p>æœ€è¿‘ AI æ¼«å‰§ã€AI è§†é¢‘ç«å¾—ç¦»è°±ï¼Œæˆ‘ä¹Ÿå»ç©äº†å‡ å¤©ã€‚</p>\n<p>å®æ“ä¸­é‡è§é—®é¢˜ï¼šåšä¸€æ¡â€œå·®ä¸å¤šâ€çš„è§†é¢‘ï¼Œå¾€å¾€è¦å‡ åä¸Šç™¾ä¸ªé•œå¤´å›¾ç‰‡ï¼Œæ¥å›åˆ‡æ¨¡å‹ã€åå¤æŠ½å¡ï¼š</p>\n<ul>\n<li>\n<p>ç´ ææ•£è½å„å¤„</p>\n</li>\n<li>\n<p>æç¤ºè¯å’Œæˆç‰‡åˆ†ç¦»ï¼Œåç»­æ— æ³•è¿½æº¯</p>\n</li>\n<li>\n<p>å¤šä¸ªé¡¹ç›®æ··åœ¨ä¸€èµ·ï¼Œç®¡ç†æ··ä¹±</p>\n</li>\n<li>\n<p>ä¸€æ¡è§†é¢‘ä¸‹æ¥ï¼Œé‡å¤åŠ³åŠ¨å äº†å¤§å¤´</p>\n</li>\n</ul>\n<p>ç„¶åç¨‹åºå‘˜çš„â€œèŒä¸šç—…â€å°±å‘ä½œäº†ï¼š <strong>èƒ½ä¸èƒ½æŠŠå®ƒæµç¨‹åŒ–ã€æ‰¹é‡åŒ–ã€è‡ªåŠ¨åŒ–ï¼Ÿ</strong></p>\n<p>äºæ˜¯æˆ‘æƒ³åšä¸€ä¸ªâ€œé•œå¤´ç®¡ç†è½¯ä»¶â€ï¼š æŠŠ <strong>çˆ†æ¬¾è§†é¢‘å¯¼å…¥ã€æ™ºèƒ½æŠ½å¸§ã€AIæ¨¡å‹åˆ‡æ¢ã€AI åˆ†æã€æ‰¹é‡ä»»åŠ¡ã€æˆç‰‡åˆæˆ</strong> å…¨éƒ¨é›†æˆåœ¨æœ¬åœ°ã€‚</p>\n<hr />\n<h1 id=\"3éœ€æ±‚æ•´ç†æ¢³ç†æ“ä½œæµç¨‹\">3ï¼‰éœ€æ±‚æ•´ç†ï¼šæ¢³ç†æ“ä½œæµç¨‹</h1>\n<p>ä¸€å¼€å§‹æˆ‘çš„æƒ³æ³•ï¼š</p>\n<pre><code class=\"language-Plain\">å¯¹å‚è€ƒè§†é¢‘åšå…¨å±€ç†è§£ï¼Œç”Ÿæˆå¤šä¸ªåˆ†é•œè„šæœ¬\n* ç”¨æˆ·å¯ä»¥ç¼–è¾‘åˆ†é•œè„šæœ¬\n* æ¯ä¸ªåˆ†é•œé€‰æ‹©ä¸åŒæ¨¡å‹ï¼šé¦–å°¾å¸§â†’å›¾ç”Ÿè§†é¢‘â†’é…éŸ³â†’åˆæˆ\n* æœ€ç»ˆå½¢æˆä¸€å¼ â€œåˆ†é•œè¡¨æ ¼â€ï¼šé•œå¤´å·ã€æ—¶é•¿ã€é¦–å°¾å¸§æç¤ºè¯ã€é•œå¤´ç±»å‹ã€ç”»é¢ã€åŠ¨ä½œã€åœºæ™¯ç­‰\n</code></pre>\n<p>æˆ‘æŠŠè¿™å¥—æƒ³æ³•ä¸¢ç»™ ChatGPTã€Geminiã€DeepSeek æ¥å›æ‹†å°çº é”™ã€‚æœ€åæ”¶æ•›æˆä¸€æ¡æ›´ç°å®çš„æµç¨‹ï¼š</p>\n<p><strong>æœ€ç»ˆç¡®å®šçš„æ ¸å¿ƒé“¾è·¯ï¼š</strong></p>\n<pre><code class=\"language-Plain\">è¾“å…¥ï¼š ç”¨æˆ·ä¸Šä¼ å‚è€ƒè§†é¢‘\nå¤„ç†é“¾ï¼š\n    è§†é¢‘ç†è§£ä¸åˆ†é•œï¼šä¼ ç»Ÿ CVï¼ˆé•œå¤´åˆ‡æ¢æ£€æµ‹ï¼‰åˆ‡åˆ† + å¤šæ¨¡æ€æ¨¡å‹è¾…åŠ©æè¿°ï¼Œç”Ÿæˆåˆæ­¥åˆ†é•œè¡¨\n    åˆ†é•œç¼–è¾‘ï¼šè¡¨æ ¼å†…æ‰€æœ‰å­—æ®µéƒ½å¯ç¼–è¾‘ï¼Œé‡ç‚¹æ˜¯â€œç”»é¢æè¿°/å…³é”®å¸§æç¤ºè¯â€\n    ç”Ÿæˆé“¾ï¼š\n        é¦–å°¾å¸§ï¼šæç¤ºè¯ â†’ SD / MJ ç­‰ç”Ÿæˆå…³é”®å¸§\n        åŠ¨ä½œï¼šå…³é”®å¸§ + åŠ¨ä½œæè¿° â†’ å›¾ç”Ÿè§†é¢‘æ¨¡å‹ç”Ÿæˆç‰‡æ®µ\n        éŸ³é¢‘ï¼šæŠ½å–åŸéŸ³é¢‘æˆ– TTS ç”Ÿæˆæ–°éŸ³é¢‘\nè§†é¢‘åˆæˆï¼šç‰‡æ®µ + éŸ³é¢‘å¯¹é½ â†’ è¾“å‡ºæˆç‰‡\n</code></pre>\n<hr />\n<h1 id=\"4æ ¸å¿ƒåŠŸèƒ½æ¸…å•\">4ï¼‰æ ¸å¿ƒåŠŸèƒ½æ¸…å•</h1>\n<p>å’ŒAIç»§ç»­æ•²å®šåŠŸèƒ½ç»†èŠ‚ï¼Œè®©AIæ•´ç†åç»™æˆ‘å®Œæ•´åŠŸèƒ½æ–‡æ¡£ï¼ˆçº¯äº«ç‰ˆï¼‰ã€‚</p>\n<p><strong>æ‘˜å½•ç®€åŒ–åéƒ¨åˆ†åŠŸèƒ½ï¼š</strong></p>\n<ul>\n<li>\n<p>é¡¹ç›®ç®¡ç†ï¼šåˆ›å»º/æ‰“å¼€/æœ€è¿‘é¡¹ç›®/èµ„æºç›®å½•</p>\n</li>\n<li>\n<p>è§†é¢‘å¯¼å…¥ï¼šå…ƒä¿¡æ¯è§£æï¼ˆæ—¶é•¿/åˆ†è¾¨ç‡/å¸§ç‡ï¼‰</p>\n</li>\n<li>\n<p>æŠ½å¸§ï¼šå®šæ•°æŠ½å¸§ / ç­‰æ—¶æŠ½å¸§ / å…³é”®å¸§æŠ½å–</p>\n</li>\n<li>\n<p>åˆ†é•œè¡¨æ ¼ï¼šé•œå¤´å·/æ—¶é•¿/ç”»é¢/åŠ¨ä½œ/åœºæ™¯/æç¤ºè¯/æ¨¡å‹é€‰æ‹©/çŠ¶æ€</p>\n</li>\n<li>\n<p>æ‰¹é‡ç”Ÿæˆï¼šä»»åŠ¡é˜Ÿåˆ—/å¹¶å‘/å¤±è´¥é‡è¯•/æ—¥å¿—è¿½è¸ª</p>\n</li>\n<li>\n<p>èµ„æºç®¡ç†ï¼šå›¾ç‰‡/è§†é¢‘/æç¤ºè¯ç‰ˆæœ¬/å¯è¿½æº¯</p>\n</li>\n<li>\n<p>åˆæˆå‡ºç‰‡ï¼šç‰‡æ®µæ‹¼æ¥/éŸ³é¢‘å¯¹é½/å¯¼å‡º</p>\n</li>\n</ul>\n<p><strong>è¯¦ç»†æ–‡ä»¶åœ°å€:<strong><strong><a href=\"https://github.com/BroderQi/Storyboard/blob/main/%E5%8A%9F%E8%83%BD%E6%96%87%E6%A1%A3.md\" rel=\"noopener nofollow\" target=\"_blank\">åŠŸèƒ½æ–‡æ¡£</a></strong></strong>ã€‚</strong></p>\n<hr />\n<h1 id=\"5æŠ€æœ¯é€‰å‹ä¸ºä»€ä¹ˆåšå®¢æˆ·ç«¯\">5ï¼‰æŠ€æœ¯é€‰å‹ï¼šä¸ºä»€ä¹ˆåšå®¢æˆ·ç«¯ï¼Ÿ</h1>\n<p>æˆ‘ä¸»è¦çº ç»“äº†å››ä¸ªé—®é¢˜ï¼š</p>\n td {white-space:nowrap;border:0.5pt solid #dee0e3;font-size:10pt;font-style:normal;font-weight:normal;vertical-align:middle;word-break:normal;word-wrap:normal;}\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td>æˆ‘æƒ³è¦çš„ç›®æ ‡</td>\n<td>æ”¾å¼ƒåŸå› ï¼ˆä¸é€‰çš„å‘ï¼‰</td>\n<td>æœ€ç»ˆé€‰æ‹©</td>\n</tr>\n<tr>\n<td>Web vs å®¢æˆ·ç«¯</td>\n<td>å¿«é€Ÿå‡º UI + æœ¬åœ°é«˜æ€§èƒ½å¤„ç†</td>\n<td>Web éœ€è¦å‰ååˆ†ç¦»ã€éƒ¨ç½²ç¹çï¼›  <br />æƒé™/å­˜å‚¨/ä»»åŠ¡é˜Ÿåˆ—é“¾è·¯å¤æ‚ï¼Œ  <br />ä¸” ffmpeg/OpenCV æœ¬åœ°åƒèµ„æºæ›´é€‚åˆå®¢æˆ·ç«¯</td>\n<td>å®¢æˆ·ç«¯</td>\n</tr>\n<tr>\n<td>Python vs .NET</td>\n<td>å·¥ç¨‹åŒ–ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•</td>\n<td>Python å·¥å…·é“¾å¼ºä½†å®¢æˆ·ç«¯å·¥ç¨‹åŒ–ã€ç»“æ„åŒ–ç»´æŠ¤æˆæœ¬æ›´é«˜ï¼›  <br />.NETæœ¬å‘½+å¹´åº¦è¯­è¨€ï¼Œå¿…é¡»æ‰“Call</td>\n<td>.NET 8</td>\n</tr>\n<tr>\n<td>WPF vs Avalonia</td>\n<td>è·¨å¹³å° + å­¦æ–°æŠ€æœ¯</td>\n<td>WPF ä¸è·¨å¹³å°ï¼Œé™åˆ¶æœªæ¥ç”¨æˆ·èŒƒå›´</td>\n<td>Avalonia</td>\n</tr>\n<tr>\n<td>WebView vs åŸç”Ÿå¤åˆ»</td>\n<td>UI è¿˜åŸåº¦ + å¯ç»´æŠ¤æ€§éªŒè¯</td>\n<td>WebViewæ€§èƒ½/ä½“éªŒä¸ç¡®å®š</td>\n<td>Avalonia åŸç”Ÿå¤åˆ»</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h1 id=\"6ui-è®¾è®¡å…ˆç”¨-ai-åšèƒ½è·‘çš„è®¾è®¡ç¨¿\">6ï¼‰UI è®¾è®¡ï¼šå…ˆç”¨ AI åšâ€œèƒ½è·‘çš„è®¾è®¡ç¨¿â€</h1>\n<p>æ‹¿åˆ°æ ¸å¿ƒåŠŸèƒ½åï¼Œæˆ‘ç›´æ¥åœ¨ <strong>Figma / å¢¨åˆ€</strong> èµ° vibe codingï¼š è‡ªç„¶è¯­è¨€æ²Ÿé€šéœ€æ±‚ â†’ è¾“å‡ºå¯è¿è¡Œçš„ React é¡¹ç›® â†’ è¿™å°±æ˜¯â€œè®¾è®¡ç¨¿ + äº¤äº’ç¨¿ + å¯è¿è¡ŒåŸå‹â€ã€‚</p>\n<p>æˆ‘å°±å°†åŠŸèƒ½è´´åˆ°å¯¹è¯æ¡†ï¼Œåˆ›å»ºWebç•Œé¢ã€‚å°±å¾—åˆ°ä¸¤ä¸ªå¯è¿è¡ŒåŸå‹ï¼š</p>\n<p><img alt=\"308b428a54192c39f3a168ab6be766b9\" src=\"https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114192410233-2084263044.png\" /></p>\n<p>å¢¨åˆ€æœ€ç»ˆæˆå“æˆªå›¾ï¼š</p>\n<p><img alt=\"cf082781dc06dbf30dd3bd2035dccce6\" src=\"https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114192546823-363850222.png\" /></p>\n<p>figmaï¼š</p>\n<p><img alt=\"81eddd65cfffdb55090c6b74b092b95e\" src=\"https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114192607008-1830546258.png\" /></p>\n<p>å¯¼å‡ºæˆReacté¡¹ç›®æ–‡ä»¶<br />\n<img alt=\"87865bc53fe5dcec2441f8152e60e864\" src=\"https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114192624142-128403351.png\" /></p>\n<hr />\n<h1 id=\"7ä»£ç å®ç°æˆ‘çš„-0-æ‰‹å†™ä»£ç æµæ°´çº¿\">7ï¼‰ä»£ç å®ç°ï¼šæˆ‘çš„ 0 æ‰‹å†™ä»£ç æµæ°´çº¿</h1>\n<p>æˆ‘åŸºæœ¬æŒ‰è¿™ä¸ªâ€œAIåä½œæµæ°´çº¿â€è·‘ï¼š</p>\n<ol>\n<li>æ–°å»ºé¡¹ç›®æ–‡ä»¶å¤¹ï¼ŒæŠŠåŠŸèƒ½æ–‡æ¡£å¤åˆ¶è¿›æ¥ï¼ŒæŠŠ React åŸå‹é¡¹ç›®æ‹–è¿›æ¥</li>\n</ol>\n<p><img alt=\"b56a1adbf05d831de33c882281f1e395\" src=\"https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114192743020-232735968.jpg\" /></p>\n<ol start=\"2\">\n<li><strong>UI</strong> <strong>å¤åˆ»é˜¶æ®µï¼š</strong> ç”¨ Avalonia å¯¹ç…§ React é€é¡µé¢ 1:1 è¿˜åŸï¼ˆä¸å…è®¸è„‘è¡¥ï¼Œä¸å…è®¸ç®€åŒ–ï¼‰ã€‚ è¿™ä¸ªæ¨¡å—ç”¨Claude Code 4.5 Sonnet è¿˜åŸåº¦æ¯”è¾ƒé«˜ã€‚</li>\n</ol>\n<p><img alt=\"4044fbab3b46b72a769e966abc00d82a\" src=\"https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114192801765-1251944392.jpg\" /></p>\n<ol start=\"3\">\n<li>\n<p>è¿›è¡Œå±€éƒ¨UIä¿®å¤ã€‚æˆªå›¾ã€å¼•å…¥ç›¸å…³æ–‡ä»¶ï¼ŒAIä¿®å¤</p>\n</li>\n<li>\n<p><strong>æ•°æ®è´¯é€šé˜¶æ®µï¼š</strong> åˆ é™¤ React é¡¹ç›®ï¼Œåªä¿ç•™ UIï¼›è¦æ±‚ SQLite + EF Coreï¼Œå‰åç«¯å­—æ®µä¸€è‡´ï¼Œæ•°æ®æµè½¬è·‘é€š</p>\n</li>\n<li>\n<p>åˆ‡æ¢å¦ä¸€ä¸ªæ¨¡å‹åšå…¨é‡ code reviewï¼ˆç»“æ„ã€è¾¹ç•Œã€é”™è¯¯å¤„ç†ã€å¯ç»´æŠ¤æ€§ï¼‰</p>\n</li>\n<li>\n<p>ä¿®å¤ â†’ è¿è¡ŒæˆåŠŸ â†’ æ‰“åŒ… â†’ å¼€æº</p>\n</li>\n</ol>\n<hr />\n<h1 id=\"8ä¸ªäººæ„Ÿæ‚Ÿ\">8ï¼‰ä¸ªäººæ„Ÿæ‚Ÿï¼š</h1>\n<blockquote>\n<p>AI æ‹‰å¹³äº†å†™ä»£ç çš„é—¨æ§›ï¼Œä½†â€œæŠŠäº‹åšæˆâ€çš„èƒ½åŠ›ä¾ç„¶ç¨€ç¼ºã€‚</p>\n</blockquote>\n<p>å¯¹ç¨‹åºäººæ¥è®²ï¼šç¼–ç¨‹èƒ½åŠ›å¤±å»äº†ç¨€ç¼ºæ€§ï¼Œåœ¨AIé¢å‰é€æ¸æ¶ˆé€€ã€‚</p>\n<p>ä½†æ˜¯å¯¹æƒ³åšäº§å“çš„äººï¼Œé»„é‡‘æ—¶ä»£åˆ°äº†ï¼š</p>\n<p>è¶AIå°šæœªå®Œå…¨è‡ªä¸»ã€æ™®é€šäººè¿˜ä¸èƒ½è½»æ¾é©¾é©­çš„çª—å£æœŸï¼Œ</p>\n<p>æˆ‘ä»¬å¯ä»¥å°†çµæ„Ÿï¼Œå¿«é€Ÿåšæˆèƒ½è¿è¡Œã€èƒ½éªŒè¯çš„åŸå‹ã€‚</p>\n<p>æŠ“ä½è¿™ä¸ªæ—¶ä»£çº¢åˆ©ï¼Œä»æŠ€æœ¯è½¬å‘äº§å“ã€è½¬å‘å¸‚åœºã€‚</p>\n<p>æˆ‘åš Storyboardï¼Œæ˜¯æƒ³è¯æ˜ï¼šå½“çµæ„Ÿé—ªç°ï¼Œæˆ‘èƒ½ä»¥æœ€å¿«é€Ÿåº¦è®©å®ƒè½åœ°æˆçœŸã€‚</p>\n<p>å¦‚æœä½ ä¹Ÿæƒ³å¿«é€Ÿè½åœ°äº§å“ã€‚</p>\n<p>å¦‚æœä½ ä¹Ÿæƒ³åšAIè§†é¢‘/æ¼«å‰§ã€‚</p>\n<p>æ¬¢è¿æ¥æéœ€æ±‚ã€äº¤PRï¼Œä¸€èµ·æŠŠè¿™ä¸ªå·¥å…·æ‰“ç£¨å¾—æ›´è¶æ‰‹ã€‚</p>\n<p>æƒ³æ³•ä¸å€¼é’±ï¼Œåšå‡ºæ¥æ‰å€¼é’±ã€‚</p>\n<p>ç°åœ¨ï¼Œæ­£æ˜¯åŠ¨æ‰‹çš„æœ€å¥½æ—¶å€™ã€‚</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 19:31</span>&nbsp;\n<a href=\"https://www.cnblogs.com/Z7TS\">Broder</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "é«˜å¾·åœ°å›¾å®ç°å®æ—¶è½¨è¿¹å±•ç¤º",
      "link": "https://www.cnblogs.com/lijinhuaboke/p/19457121",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/lijinhuaboke/p/19457121\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 14:35\">\n    <span>é«˜å¾·åœ°å›¾å®ç°å®æ—¶è½¨è¿¹å±•ç¤º</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<h1 id=\"vue3--é«˜å¾·åœ°å›¾amap-å®ç°å¹³æ»‘çš„å®æ—¶è½¨è¿¹å›æ”¾ä¸è¿½è¸ª\">Vue3 + é«˜å¾·åœ°å›¾(AMap) å®ç°å¹³æ»‘çš„å®æ—¶è½¨è¿¹å›æ”¾ä¸è¿½è¸ª</h1>\n<h2 id=\"å‰è¨€\">å‰è¨€</h2>\n<p>åœ¨ç‰©è”ç½‘ã€ç‰©æµç›‘æ§æˆ–å®‰é˜²è°ƒåº¦ç³»ç»Ÿä¸­ï¼Œå®æ—¶å±•ç¤ºè®¾å¤‡ï¼ˆå¦‚æ— äººæœºã€è½¦è¾†ã€æ‰‹ç¯ï¼‰çš„ç§»åŠ¨è½¨è¿¹æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ã€‚å¦‚æœä»…ä»…æ˜¯ç®€å•çš„æ›´æ–°æ ‡è®°ç‚¹ä½ç½®ï¼Œè§†è§‰ä¸Šä¼šå‡ºç°â€œè·³å˜â€ç°è±¡ï¼Œä½“éªŒå¾ˆä¸æµç•…ã€‚</p>\n<p>æœ¬æ–‡å°†åˆ†äº«å¦‚ä½•åœ¨ <strong>Vue 3</strong> é¡¹ç›®ä¸­ï¼Œåˆ©ç”¨ <strong>é«˜å¾·åœ°å›¾ (AMap) JS API</strong> å®ç°æ¯”è¾ƒä¸æ»‘çš„å®æ—¶è½¨æ•ˆæœã€‚</p>\n<h2 id=\"æ ¸å¿ƒç—›ç‚¹\">æ ¸å¿ƒç—›ç‚¹</h2>\n<ol>\n<li><strong>å¹³æ»‘ç§»åŠ¨</strong>ï¼šç‚¹ä½æ›´æ–°æ—¶ï¼ŒMarker éœ€è¦ä»æ—§ä½ç½®å¹³æ»‘è¿‡æ¸¡åˆ°æ–°ä½ç½®ï¼Œè€Œä¸æ˜¯ç¬é—´è·³è¿‡å»ã€‚</li>\n<li><strong>è½¨è¿¹è·Ÿéš</strong>ï¼šéšç€ Marker çš„ç§»åŠ¨ï¼Œè½¨è¿¹çº¿ï¼ˆPolylineï¼‰éœ€è¦å®æ—¶â€œç”Ÿé•¿â€ï¼Œç´§è·Ÿåœ¨ Marker åé¢ã€‚</li>\n<li><strong>å¢é‡æ›´æ–°</strong>ï¼šåç«¯é€šå¸¸è¿”å›å®Œæ•´çš„å†å²è·¯å¾„æˆ–å½“å‰çŠ¶æ€ï¼Œå‰ç«¯éœ€è¦è®¡ç®—å‡ºâ€œæ–°å¢çš„è·¯å¾„æ®µâ€è¿›è¡ŒåŠ¨ç”»æ’­æ”¾ã€‚</li>\n</ol>\n<h2 id=\"å®ç°é€»è¾‘è§£æ\">å®ç°é€»è¾‘è§£æ</h2>\n<p>æ ¸å¿ƒæ˜¯åˆ©ç”¨é«˜å¾·åœ°å›¾ API çš„è½¨è¿¹å›æ”¾åŠŸèƒ½ã€‚è™½ç„¶å®˜æ–¹æ–‡æ¡£æä¾›äº†åŸºç¡€çš„è½¨è¿¹å›æ”¾ç¤ºä¾‹ï¼ˆå‚è€ƒï¼š<a href=\"https://lbs.amap.com/demo/javascript-api-v2/example/marker/replaying-historical-running-data\" rel=\"noopener nofollow\" target=\"_blank\">è½¨è¿¹å›æ”¾ç¤ºä¾‹</a>ï¼‰ï¼Œä½†å®˜æ–¹ç¤ºä¾‹é€šå¸¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½å®Œæ•´è·¯å¾„ï¼ˆä¾‹å¦‚ï¼šå…ˆè·å–å®Œæ•´ç»çº¬åº¦æ•°ç»„ï¼Œæ¸²æŸ“å‡ºæµ…è“è‰²èƒŒæ™¯çº¿ï¼Œå†è®©å°è½¦æ²¿ç€è·¯å¾„è·‘å¹¶ç”»å‡ºæµ…ç»¿è‰²è½¨è¿¹ï¼‰ã€‚</p>\n<p><strong>æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ä¸å®˜æ–¹ç¤ºä¾‹çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š</strong><br />\næˆ‘ä»¬çš„è·¯å¾„æ•°æ®æ˜¯<strong>å®æ—¶å¢é‡æ›´æ–°</strong>çš„ã€‚å‰ç«¯å¹¶æ²¡æœ‰ä¸€å¼€å§‹å°±æ‹¿åˆ°å®Œæ•´çš„è·¯å¾„ï¼Œè€Œæ˜¯é€šè¿‡ WebSocket æˆ–è½®è¯¢å®æ—¶è·å–åç«¯è¿”å›çš„æœ€æ–°è·¯å¾„æ•°æ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è‡ªè¡Œè®¾è®¡é€»è¾‘ï¼Œè®¡ç®—å‡ºæ¯æ¬¡æ›´æ–°çš„â€œå¢é‡ç‰‡æ®µâ€ï¼Œå¹¶è®© Marker å¹³æ»‘åœ°èµ°å®Œè¿™ä¸€æ®µã€‚</p>\n<h3 id=\"æ ¸å¿ƒæ€è·¯\">æ ¸å¿ƒæ€è·¯ï¼š</h3>\n<ol>\n<li>\n<p><strong>å‰åç«¯æ•°æ®çº¦å®š</strong>ï¼š</p>\n<ul>\n<li>ç†æƒ³æƒ…å†µä¸‹ï¼Œåç«¯æœ€å¥½ç›´æ¥è¿”å›â€œå¢é‡è·¯å¾„â€ï¼ˆå³ä¸Šä¸€æ¬¡ä½ç½®åˆ°å½“å‰ä½ç½®çš„åæ ‡é›†åˆï¼‰ã€‚</li>\n<li>ä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼ˆæ¯”å¦‚æœ¬æ¡ˆä¾‹ï¼‰ï¼Œåç«¯æ¥å£è¿”å›çš„æ˜¯<strong>å½“å‰æ—¶åˆ»çš„å®Œæ•´ç´¯ç§¯è·¯å¾„</strong>ã€‚å› æ­¤ï¼Œå‰ç«¯éœ€è¦è‡ªè¡Œæ¯”å¯¹ç¼“å­˜çš„â€œä¸Šä¸€æ¬¡è·¯å¾„â€å’Œâ€œæœ€æ–°è·¯å¾„â€ï¼Œè®¡ç®—å‡ºå¢é‡éƒ¨åˆ†ã€‚</li>\n</ul>\n</li>\n<li>\n<p><strong>çŠ¶æ€ç®¡ç† (ç¼“å­˜å®ä¾‹)</strong>ï¼š</p>\n<ul>\n<li>ä½¿ç”¨ <code>Map</code> æ•°æ®ç»“æ„æ¥ç¼“å­˜æ¯ä¸ªè®¾å¤‡ï¼ˆå¦‚æ— äººæœºã€æ‰‹ç¯ï¼‰çš„ <code>Marker</code>ï¼ˆå›¾æ ‡ï¼‰å’Œ <code>Polyline</code>ï¼ˆè½¨è¿¹çº¿ï¼‰å®ä¾‹ã€‚</li>\n<li>ç¡®ä¿æ¯ä¸ªè®¾å¤‡ ID å¯¹åº”å”¯ä¸€çš„åœ°å›¾å®ä¾‹ï¼Œé¿å…æ•°æ®åˆ·æ–°æ—¶é‡å¤åˆ›å»ºå¯¼è‡´å†…å­˜æ³„æ¼æˆ–é—ªçƒã€‚</li>\n</ul>\n</li>\n<li>\n<p><strong>è®¡ç®—å¢é‡è·¯å¾„</strong>ï¼š</p>\n<ul>\n<li>å½“æ–°æ•°æ®åˆ°è¾¾æ—¶ï¼Œé€šè¿‡å¯¹æ¯”æ–°æ—§è·¯å¾„é•¿åº¦ï¼Œæˆªå–å‡º<strong>æ–°å¢çš„è·¯å¾„æ®µ</strong>ã€‚</li>\n<li>è¿™æ®µæ–°å¢è·¯å¾„å°±æ˜¯ Marker æ¥ä¸‹æ¥éœ€è¦â€œå¹³æ»‘ç§»åŠ¨â€çš„è½¨è¿¹ã€‚</li>\n</ul>\n</li>\n<li>\n<p><strong>å¹³æ»‘åŠ¨ç”» (<code>moveAlong</code>)</strong>ï¼š</p>\n<ul>\n<li>è°ƒç”¨é«˜å¾·åœ°å›¾çš„ <code>marker.moveAlong()</code> æ–¹æ³•ï¼Œè®© Marker æ²¿ç€æ–°å¢è·¯å¾„å¹³æ»‘ç§»åŠ¨ï¼Œè€Œä¸æ˜¯ç¬é—´è·³å˜ã€‚</li>\n</ul>\n</li>\n<li>\n<p><strong>å®æ—¶ç»˜åˆ¶è½¨è¿¹ (<code>moving</code> äº‹ä»¶)</strong>ï¼š</p>\n<ul>\n<li>ç›‘å¬ Marker çš„ <code>moving</code> äº‹ä»¶ã€‚åœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œå®æ—¶æ›´æ–°è½¨è¿¹çº¿ï¼ˆPolylineï¼‰çš„è·¯å¾„ï¼Œä»è€Œå®ç°â€œè¾¹èµ°è¾¹ç”»â€çš„æ•ˆæœã€‚</li>\n<li><strong>å…³é”®ç‚¹</strong>ï¼šä¸ºä»€ä¹ˆè¦åœ¨ <code>moving</code> äº‹ä»¶ä¸­æ›´æ–°æ€»è½¨è¿¹ï¼Œè€Œä¸æ˜¯åœ¨åŠ¨ç”»ç»“æŸ (<code>moveend</code>) åæ›´æ–°ï¼Ÿ\n<ul>\n<li>è¿™æ˜¯ä¸ºäº†é˜²æ­¢æ•°æ®æ¨é€é¢‘ç‡è¿‡å¿«ã€‚å¦‚æœç­‰åˆ°åŠ¨ç”»ç»“æŸå†æ›´æ–°ï¼Œå¯èƒ½ä¼šå‡ºç°â€œæ–°çš„æ•°æ®æ¨é€æ¥äº†ï¼Œä½†ä¸Šä¸€æ¬¡åŠ¨ç”»è¿˜æ²¡ç»“æŸï¼Œå¯¼è‡´è½¨è¿¹æ•°æ®ä¸¢å¤±æˆ–è¡”æ¥ä¸ä¸Šâ€çš„é—®é¢˜ã€‚åœ¨ <code>moving</code> è¿‡ç¨‹ä¸­å®æ—¶å°† <code>passedPath</code>ï¼ˆå·²èµ°è¿‡çš„è·¯å¾„ï¼‰æ‹¼æ¥åˆ°æ€»è½¨è¿¹ä¸­ï¼Œæ˜¯æœ€ç¨³å¦¥çš„æ–¹å¼ã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>åŠ¨ç”»ç»“æŸæ¸…ç†</strong>ï¼š</p>\n<ul>\n<li>åŠ¨ç”»ç»“æŸæ—¶ (<code>moveend</code>)ï¼Œæ¸…ç†ä¸´æ—¶ç»˜åˆ¶çš„è¾…åŠ©çº¿ï¼Œç§»é™¤ç›‘å¬å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</li>\n</ul>\n</li>\n</ol>\n<hr />\n<h3 id=\"ä»£ç è¯¦è§£\">ä»£ç è¯¦è§£</h3>\n<h4 id=\"1-çŠ¶æ€ç®¡ç†ä¸åˆå§‹åŒ–\">1. çŠ¶æ€ç®¡ç†ä¸åˆå§‹åŒ–</h4>\n<p>æˆ‘ä»¬ä½¿ç”¨ <code>Map</code> æ¥ç®¡ç†åœ°å›¾ä¸Šçš„ Marker å’Œ Polyline å®ä¾‹ã€‚</p>\n<pre><code class=\"language-javascript\">// å­˜å‚¨ Marker å®ä¾‹ (Key: è®¾å¤‡ID, Value: AMap.Marker)\nconst uavMarkers = ref(new Map());\n// å­˜å‚¨è½¨è¿¹çº¿ Polyline å®ä¾‹ (Key: è®¾å¤‡ID, Value: AMap.Polyline)\nconst uavPaths = ref(new Map());\n</code></pre>\n<h4 id=\"2-æ ¸å¿ƒå¤„ç†å‡½æ•°-refreshtemppoint\">2. æ ¸å¿ƒå¤„ç†å‡½æ•° <code>refreshTempPoint</code></h4>\n<p>è¿™ä¸ªå‡½æ•°è´Ÿè´£å¤„ç†å•æ¡è®¾å¤‡æ•°æ®çš„æ›´æ–°é€»è¾‘ã€‚</p>\n<pre><code class=\"language-javascript\">// åˆ·æ–°è®¾å¤‡ç‚¹ä½ä¸è½¨è¿¹\n// item: åç«¯è¿”å›çš„è®¾å¤‡æ•°æ®å¯¹è±¡\n// position: å½“å‰æœ€æ–°çš„åæ ‡ç‚¹\n// type: æ›´æ–°ç±»å‹ï¼ˆ'init' ä¸ºåˆå§‹åŒ–ï¼Œå…¶ä»–ä¸ºå¢é‡æ›´æ–°ï¼‰\nconst refreshTempPoint = async (item, position, type, marker, tempOverlay, pathOverlay) =&gt; {\n  // 1. æ¸…ç†ä¸Šä¸€è½®çš„ä¸´æ—¶è¦†ç›–ç‰©ï¼ˆå¦‚ä¸´æ—¶è·¯çº¿ã€è·ç¦»æ–‡æœ¬ï¼‰\n  tempOverlay?.clearOverlays();\n\n  if (item.coordinatesLine) {\n    const coordinatesLine = JSON.parse(item.coordinatesLine); // è§£æåç«¯è¿”å›çš„å®Œæ•´è·¯å¾„æ•°ç»„\n\n    // --- A. åˆå§‹åŒ–èµ·ç‚¹ Marker ---\n    let tempMarker = tempUavMarkers.value.get(item.id);\n    if (!tempMarker) {\n      // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œæ¸²æŸ“èµ·ç‚¹\n      tempMarker = renderPoint(coordinatesLine[0], item, \"\", pathOverlay);\n      tempUavMarkers.value.set(item.id, tempMarker);\n    }\n\n    // --- B. è·å–æˆ–åˆ›å»ºå†å²è½¨è¿¹çº¿ (Polyline) ---\n    let polyline = uavPaths.value.get(item.id);\n    if (!polyline) {\n      polyline = trajectoryLine(item, pathOverlay); // åˆ›å»ºæ–°çš„çº¿å®ä¾‹\n      uavPaths.value.set(item.id, polyline);\n    }\n\n    // è·å–å½“å‰åœ°å›¾ä¸Šå·²æœ‰çš„è·¯å¾„ï¼ˆç¼“å­˜çš„æ—§è·¯å¾„ï¼‰\n    const existingPath = polyline.getPath() || [];\n\n    if (type != \"init\") {\n      // --- C. å¢é‡æ›´æ–°é€»è¾‘ ---\n      \n      // 1. è®¡ç®—å¢é‡è·¯å¾„ï¼šä»å·²æœ‰è·¯å¾„çš„æœ€åä¸€ä¸ªç‚¹å¼€å§‹æˆªå–ï¼Œç›´åˆ°æœ€æ–°è·¯å¾„çš„æœ«å°¾\n      const newPathSegment = coordinatesLine.slice(\n        existingPath.length ? existingPath.length - 1 : 0\n      );\n\n      // 2. åˆ›å»ºä¸€æ¡ä¸´æ—¶çš„â€œéšå½¢â€çº¿æ®µï¼Œç”¨äºè¾…åŠ©è®¡ç®—æˆ–å±•ç¤ºï¼ˆè§†éœ€æ±‚è€Œå®šï¼‰\n      const newPolyline = trajectoryLine(item, tempOverlay);\n\n      // 3. å¦‚æœæœ‰æ–°å¢è·¯å¾„ï¼Œå¼€å§‹åŠ¨ç”»\n      if (newPathSegment &amp;&amp; newPathSegment.length &gt; 0) {\n        \n        // ç›‘å¬ç§»åŠ¨è¿‡ç¨‹\n        marker.on(\"moving\", function (e) {\n          // e.passedPath æ˜¯ Marker åœ¨å½“å‰åŠ¨ç”»ç‰‡æ®µä¸­å·²ç»èµ°è¿‡çš„è·¯å¾„\n          newPolyline.setPath(e.passedPath);\n          \n          // [å…³é”®] å®æ—¶å°†èµ°è¿‡çš„è·¯å¾„æ‹¼æ¥åˆ°å†å²æ€»è½¨è¿¹ä¸­\n          // è¿™æ ·å³ä½¿ WebSocket æ¨é€é¢‘ç‡å¾ˆå¿«ï¼Œä¹Ÿèƒ½ä¿è¯è½¨è¿¹æ•°æ®çš„è¿ç»­æ€§\n          polyline.setPath([...existingPath, ...e.passedPath]);\n        });\n\n        // å¼€å§‹å¹³æ»‘ç§»åŠ¨\n        marker.moveAlong(newPathSegment, {\n          duration: 1000,    // åŠ¨ç”»æ—¶é•¿ï¼Œéœ€æ ¹æ® WebSocket æ¨é€é¢‘ç‡è°ƒæ•´\n          autoRotation: true, // è½¦å¤´è‡ªåŠ¨å¯¹å‡†è·¯å¾„æ–¹å‘\n        });\n\n        // ç›‘å¬ç§»åŠ¨ç»“æŸ\n        marker.on(\"moveend\", function () {\n          // åŠ¨ç”»ç»“æŸï¼Œæ¸…ç†ä¸´æ—¶è¦†ç›–ç‰©\n          tempOverlay?.clearOverlays();\n          \n          // æ›´æ–°è·ç¦»æ–‡æœ¬ç­‰ä¿¡æ¯\n          if (item.distance) {\n            renderText(\n              coordinatesLine[Math.ceil(coordinatesLine.length - 2)],\n              `${item.distance}ç±³`,\n              tempOverlay\n            );\n          }\n          \n          // ç§»é™¤ç›‘å¬å™¨ï¼Œé˜²æ­¢é‡å¤ç»‘å®š\n          marker.off(\"moveend\");\n        });\n      } else {\n        // å¦‚æœæ²¡æœ‰æ–°å¢è·¯å¾„ï¼ˆä½ç½®æ²¡å˜ï¼‰ï¼Œä»…æ›´æ–°æ–‡å­—ä¿¡æ¯\n        if (item.distance) {\n          renderText(..., `${item.distance}ç±³`, tempOverlay);\n        }\n      }\n\n    } else {\n      // --- D. åˆå§‹åŒ–é€»è¾‘ ---\n      // å¦‚æœæ˜¯åˆå§‹åŒ–åŠ è½½ï¼Œç›´æ¥è®¾ç½®å®Œæ•´è·¯å¾„ï¼Œä¸è¿›è¡ŒåŠ¨ç”»å›æ”¾\n      if (item.distance) {\n         renderText(..., `${item.distance}ç±³`, tempOverlay);\n      }\n      polyline.setPath(coordinatesLine);\n    }\n  } else {\n    // --- E. æ— è½¨è¿¹æ•°æ®æ—¶çš„é™çº§å¤„ç† ---\n    // å¦‚æœåç«¯æ²¡æœ‰è¿”å›è·¯å¾„æ•°æ®ï¼Œç›´æ¥è·³å˜åˆ°æœ€æ–°ä½ç½®\n    marker.setPosition(position);\n    \n    // æ¸…ç†ç›¸å…³çš„è½¨è¿¹å®ä¾‹å’Œç¼“å­˜\n    let tempMarker = tempUavMarkers.value.get(item.id);\n    if (tempMarker) {\n      tempMarker.setMap(null);\n      pathOverlay &amp;&amp; pathOverlay.removeOverlay(tempMarker);\n      tempUavMarkers.value.delete(item.id);\n    }\n    \n    let polyline = uavPaths.value.get(item.id);\n    if (polyline) {\n      polyline.setMap(null);\n      pathOverlay &amp;&amp; pathOverlay.removeOverlay(polyline);\n      uavPaths.value.delete(item.id);\n    }\n  }\n};\n</code></pre>\n<p>}<br />\n};</p>\n<pre><code class=\"language-javascript\">\n// æ— äººæœºå’Œæ‰‹ç¯è½¨è¿¹æš‚æ—¶\nconst refreshAirMap = async (type, data) =&gt; {\n  const res = await getUavElement();\n  // console.log(\"æ— äººæœºæ•°æ®\", res.result);\n  res.result.map(async (item) =&gt; {\n    // data.map(async (item) =&gt; {\n    if (item.type == \"1\") {\n      let position = JSON.parse(item.coordinates);\n      // è·å–æˆ–åˆ›å»ºæ— äººæœºæ ‡è®°\n      let marker = uavMarkers.value.get(item.id);\n      if (!marker) {\n        // åˆ›å»ºæ— äººæœºã€æ‰‹ç¯ç‚¹ä½ã€‚\n        marker = renderPoint(position, item, \"\", overlayGroups.value);\n        uavMarkers.value.set(item.id, marker);\n      }else{\n        \n        if (item.elementType == \"2\") {\n          // å·²æœ‰ç‚¹ä½ä¸”æ˜¯æ‰‹ç¯ç‚¹ä½å°±æ›´æ–°ç”µé‡\n          marker.setLabel({\n            content: `&lt;div class=\"marker-label-container\"&gt;\n              &lt;div class=\"info-name\"&gt;${item.name}&lt;/div&gt;\n              &lt;div class=\"icon-placeholder\"&gt;&lt;/div&gt;\n              ${batteryHtml(item)}\n            &lt;/div&gt;`,\n            offset: new AMaps.value.Pixel(0, 0),\n            direction: \"center\",\n          });\n        }\n      }\n\n      if (item.elementType == \"1\") {\n        // æ— äººæœºè½¨è¿¹\n        refreshTempPoint(\n          item,\n          position,\n          type,\n          marker,\n          pathOverlayGroups.value,\n          pathsStartPointOverlayGroups.value\n        );\n      } else if (item.elementType == \"2\") {\n        // æ‰‹ç¯è½¨è¿¹\n        refreshTempPoint(\n          item,\n          position,\n          type,\n          marker,\n          rescuePathsOverlayGroups.value,\n          rescueOverlayGroups.value\n        );\n      }\n      // è½¨è¿¹éƒ¨åˆ†ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è½¨è¿¹\n    }\n  });\n  // });\n};\n</code></pre>\n<p>è¯´æ˜ä¸€ä¸‹å“¦ï¼Œæˆ‘çš„é¡¹ç›®ä¸­è¿˜éœ€è¦å®ç°å…¶ä»–åŠŸèƒ½åƒæ˜¯æ‰‹ç¯ç”µé‡å±•ç¤ºï¼Œç‚¹å‡»æŒ‰é’®å¯éšè—æ— äººæœºè½¨è¿¹ï¼Œç‚¹å‡»æŒ‰é’®å¯éšè—æ‰‹ç¯è½¨è¿¹ï¼Œæ— äººæœºå’Œæ‰‹ç¯è½¨è¿¹èµ·å§‹ç‚¹ä¹Ÿéœ€è¦å±•ç¤ºä¸€ä¸ªç‚¹ä½å›¾æ ‡ï¼Œè½¨è¿¹çº¿ä¸Šæ˜¾ç¤ºè·ç¦»ï¼Œè¿˜è€ƒè™‘äº†ç¬¬ä¸€æ¬¡è¿›å…¥é¡¹ç›®ï¼Œå¦‚æ— è½¨è¿¹å°±åªæ›´æ–°ç‚¹ä½åæ ‡ç­‰ç­‰è¿™äº›ï¼Œæ— å…³çš„è½¨è¿¹å±•ç¤ºé€»è¾‘çš„å„ä½è§‚ä¼—è€çˆ·ç•¥è¿‡å°±å¥½ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯åˆ†äº«ä¸€ä¸‹å®æ—¶è½¨è¿¹å®ç°çš„é€»è¾‘ï¼ŒæŠŠè½¨è¿¹ç›¸å…³é€»è¾‘æŠ½å‡ºæ¥é‡æ–°å†™ä¸€ä»½ä»£ç ï¼Œæˆ‘å«Œéº»çƒ¦å˜»å˜»ã€‚</p>\n<h2 id=\"æ€»ç»“\">æ€»ç»“</h2>\n<p>é€šè¿‡ç»“åˆ å¢é‡è·¯å¾„è®¡ç®—<code>moveAlong</code> è½¨è¿¹å›æ”¾ ä»¥åŠ <code>moving</code> äº‹ä»¶ç›‘å¬ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªé«˜æ€§èƒ½ä¸”è§†è§‰æµç•…çš„å®æ—¶è½¨è¿¹è¿½è¸ªåŠŸèƒ½ã€‚è¿™ç§æ–¹æ¡ˆç‰¹åˆ«é€‚åˆæ— äººæœºå·¡èˆªã€è½¦è¾†å®æ—¶å®šä½ç­‰éœ€è¦é«˜é¢‘æ›´æ–°ä½ç½®çš„åœºæ™¯ã€‚</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 14:35</span>&nbsp;\n<a href=\"https://www.cnblogs.com/lijinhuaboke\">æ­¤é¢œå·®çŸ£ã€‚</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">325</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">3</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    },
    {
      "title": "Webå®‰å…¨æ¸…å•â€”â€”XSSã€CSRFã€SQLæ³¨å…¥ã€é˜²é‡æ”¾ä¸æ•æ„Ÿæ•°æ®ä¿æŠ¤çš„åˆ†å±‚ç­–ç•¥",
      "link": "https://www.cnblogs.com/shiyuelp/p/19481124",
      "published": "",
      "description": "<h1 class=\"postTitle\">\n                <a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/shiyuelp/p/19481124\" id=\"cb_post_title_url\" title=\"å‘å¸ƒäº 2026-01-14 11:24\">\n    <span>Webå®‰å…¨æ¸…å•â€”â€”XSSã€CSRFã€SQLæ³¨å…¥ã€é˜²é‡æ”¾ä¸æ•æ„Ÿæ•°æ®ä¿æŠ¤çš„åˆ†å±‚ç­–ç•¥</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div class=\"blogpost-body cnblogs-markdown\" id=\"cnblogs_post_body\">\n<p><strong>å†™åœ¨å‰é¢ï¼Œæœ¬äººç›®å‰å¤„äºæ±‚èŒä¸­ï¼Œå¦‚æœ‰åˆé€‚å†…æ¨å²—ä½ï¼Œè¯·åŠ ï¼šlpshiyue æ„Ÿè°¢ã€‚åŒæ—¶è¿˜æœ›å¤§å®¶ä¸€é”®ä¸‰è¿ï¼Œèµšç‚¹å¥¶ç²‰é’±ã€‚</strong></p>\n<blockquote>\n<p>ç°ä»£Webå®‰å…¨é˜²å¾¡ä¸æ˜¯å•ç‚¹å·¥å…·çš„ç»„åˆï¼Œè€Œæ˜¯ä»æ¸²æŸ“å±‚åˆ°æ•°æ®å±‚çš„çºµæ·±é˜²å¾¡ä½“ç³»</p>\n</blockquote>\n<p>åœ¨å»ºç«‹å®Œå–„çš„è®¤è¯æˆæƒä½“ç³»åï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨Webåº”ç”¨çš„åŸºç¡€å®‰å…¨é˜²çº¿ã€‚æ— è®ºæ˜¯ä¼ ç»ŸWebåº”ç”¨è¿˜æ˜¯ç°ä»£APIæœåŠ¡ï¼Œéƒ½é¢ä¸´ç€æ¥è‡ªå¤šå±‚é¢çš„å®‰å…¨å¨èƒã€‚æœ¬æ–‡å°†ç³»ç»Ÿé˜è¿°XSSã€CSRFã€SQLæ³¨å…¥ç­‰æ ¸å¿ƒæ”»å‡»çš„é˜²å¾¡ç­–ç•¥ï¼Œå¹¶æä¾›ä»å‰ç«¯åˆ°æ•°æ®åº“çš„å®Œæ•´å®‰å…¨æ¸…å•ã€‚</p>\n<h2 id=\"1-webå®‰å…¨é˜²å¾¡çš„æ•´ä½“è§†è§’çºµæ·±é˜²å¾¡æˆ˜ç•¥\">1 Webå®‰å…¨é˜²å¾¡çš„æ•´ä½“è§†è§’ï¼šçºµæ·±é˜²å¾¡æˆ˜ç•¥</h2>\n<h3 id=\"11-ç°ä»£webå®‰å…¨çš„å±‚æ¬¡åŒ–é˜²å¾¡ç†å¿µ\">1.1 ç°ä»£Webå®‰å…¨çš„å±‚æ¬¡åŒ–é˜²å¾¡ç†å¿µ</h3>\n<p>Webå®‰å…¨æœ¬è´¨ä¸Šæ˜¯ä¸€åœº<strong>æ”»é˜²ä¸å¯¹ç§°</strong>çš„æˆ˜äº‰ã€‚æ”»å‡»è€…åªéœ€æ‰¾åˆ°ä¸€ä¸ªæ¼æ´å³å¯å®ç°å…¥ä¾µï¼Œè€Œé˜²å¾¡è€…éœ€è¦ä¿æŠ¤æ•´ä¸ªç³»ç»Ÿã€‚å› æ­¤ï¼Œ<strong>çºµæ·±é˜²å¾¡</strong>ï¼ˆDefense in Depthï¼‰æˆä¸ºç°ä»£Webå®‰å…¨çš„æ ¸å¿ƒç†å¿µã€‚</p>\n<p><strong>çºµæ·±é˜²å¾¡çš„ä¸‰ä¸ªæ ¸å¿ƒå±‚é¢</strong>ï¼š</p>\n<ul>\n<li><strong>æ¸²æŸ“å±‚å®‰å…¨</strong>ï¼šæµè§ˆå™¨ç¯å¢ƒä¸‹çš„XSSã€CSRFç­‰å®¢æˆ·ç«¯æ”»å‡»é˜²æŠ¤</li>\n<li><strong>åº”ç”¨å±‚å®‰å…¨</strong>ï¼šæœåŠ¡ç«¯é€»è¾‘å±‚é¢çš„SQLæ³¨å…¥ã€å‘½ä»¤æ³¨å…¥ç­‰æ¼æ´é˜²æŠ¤</li>\n<li><strong>æ•°æ®å±‚å®‰å…¨</strong>ï¼šæ•æ„Ÿæ•°æ®å­˜å‚¨ã€ä¼ è¾“è¿‡ç¨‹ä¸­çš„åŠ å¯†ä¿æŠ¤</li>\n</ul>\n<h3 id=\"12-å®‰å…¨è¾¹ç•Œçš„é‡æ–°å®šä¹‰\">1.2 å®‰å…¨è¾¹ç•Œçš„é‡æ–°å®šä¹‰</h3>\n<p>éšç€å‰åç«¯åˆ†ç¦»å’ŒAPIä¼˜å…ˆæ¶æ„çš„æ™®åŠï¼ŒWebå®‰å…¨çš„<strong>æ”»å‡»é¢</strong>å‘ç”Ÿäº†æ˜¾è‘—å˜åŒ–ã€‚ä¼ ç»Ÿä»¥æœåŠ¡å™¨ä¸ºä¸­å¿ƒçš„é˜²æŠ¤æ¨¡å¼éœ€è¦æ‰©å±•ä¸º<strong>å…¨é“¾è·¯é˜²æŠ¤</strong>ï¼š</p>\n<pre><code>å®¢æˆ·ç«¯å®‰å…¨ â†’ ä¼ è¾“å®‰å…¨ â†’ æœåŠ¡ç«¯å®‰å…¨ â†’ æ•°æ®å­˜å‚¨å®‰å…¨\n</code></pre>\n<p>æ¯ä¸ªç¯èŠ‚éƒ½éœ€è¦ç‰¹å®šçš„é˜²æŠ¤ç­–ç•¥ï¼Œä¸”ç¯èŠ‚é—´éœ€è¦å®‰å…¨ååŒã€‚ä¾‹å¦‚ï¼ŒCSPï¼ˆå†…å®¹å®‰å…¨ç­–ç•¥ï¼‰éœ€è¦åœ¨HTTPå“åº”å¤´ä¸­è®¾ç½®ï¼Œä½†å½±å“çš„æ˜¯æµè§ˆå™¨ç«¯çš„èµ„æºåŠ è½½è¡Œä¸ºã€‚</p>\n<h2 id=\"2-xssé˜²æŠ¤ä»è¾“å…¥åˆ°è¾“å‡ºçš„å…¨æµç¨‹æ§åˆ¶\">2 XSSé˜²æŠ¤ï¼šä»è¾“å…¥åˆ°è¾“å‡ºçš„å…¨æµç¨‹æ§åˆ¶</h2>\n<h3 id=\"21-xssæ”»å‡»çš„æœ¬è´¨ä¸å˜ç§\">2.1 XSSæ”»å‡»çš„æœ¬è´¨ä¸å˜ç§</h3>\n<p>XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰çš„æ ¸å¿ƒé—®é¢˜æ˜¯<strong>å°†ç”¨æˆ·è¾“å…¥é”™è¯¯åœ°æ‰§è¡Œä¸ºä»£ç </strong>ã€‚æ ¹æ®æ”»å‡»æ‰‹æ³•çš„ä¸åŒï¼ŒXSSä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š</p>\n<p><strong>åå°„å‹XSS</strong>ï¼šæ¶æ„è„šæœ¬ä½œä¸ºè¯·æ±‚å‚æ•°å‘é€åˆ°æœåŠ¡å™¨ï¼Œå¹¶ç«‹å³è¿”å›æ‰§è¡Œã€‚å¸¸è§äºæœç´¢æ¡†ã€é”™è¯¯æ¶ˆæ¯é¡µé¢ã€‚</p>\n<p><strong>å­˜å‚¨å‹XSS</strong>ï¼šæ¶æ„è„šæœ¬è¢«æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œæ¯æ¬¡é¡µé¢è®¿é—®éƒ½ä¼šæ‰§è¡Œã€‚å¸¸è§äºè®ºå›è¯„è®ºã€ç”¨æˆ·åé¦ˆç­‰UGCå†…å®¹ã€‚</p>\n<p><strong>DOMå‹XSS</strong>ï¼šå®Œå…¨åœ¨æµè§ˆå™¨ç«¯å‘ç”Ÿï¼Œé€šè¿‡ä¿®æ”¹DOMæ ‘æ¥æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚ä¸æ¶‰åŠæœåŠ¡å™¨ç«¯å‚ä¸ã€‚</p>\n<h3 id=\"22-å¤šå±‚æ¬¡xssé˜²æŠ¤ç­–ç•¥\">2.2 å¤šå±‚æ¬¡XSSé˜²æŠ¤ç­–ç•¥</h3>\n<p><strong>è¾“å…¥éªŒè¯ä¸è¿‡æ»¤</strong>æ˜¯Xé˜²æŠ¤çš„ç¬¬ä¸€é“é˜²çº¿ï¼Œä½†ä¸åº”æ˜¯å”¯ä¸€é˜²çº¿ã€‚</p>\n<pre><code class=\"language-java\">// ä½¿ç”¨JSoupè¿›è¡ŒHTMLæ ‡ç­¾è¿‡æ»¤çš„ç¤ºä¾‹\npublic class XssFilter {\n    private static final Whitelist WHITELIST = Whitelist.basic();\n    \n    public static String clean(String input) {\n        if (input == null) return \"\";\n        return Jsoup.clean(input, WHITELIST);  // ä»…å…è®¸å®‰å…¨çš„HTMLæ ‡ç­¾\n    }\n}\n</code></pre>\n<p><strong>è¾“å‡ºç¼–ç </strong>æ˜¯æ›´å¯é çš„é˜²æŠ¤æ‰‹æ®µï¼Œç¡®ä¿æ•°æ®åœ¨æ¸²æŸ“æ—¶ä¸è¢«æ‰§è¡Œä¸ºä»£ç ã€‚</p>\n<pre><code class=\"language-html\">&lt;!-- åœ¨æ¨¡æ¿ä¸­è¿›è¡Œè¾“å‡ºç¼–ç  --&gt;\n&lt;div th:text=\"${userContent}\"&gt;&lt;/div&gt;  &lt;!-- å®‰å…¨ï¼šThymeleafè‡ªåŠ¨ç¼–ç  --&gt;\n&lt;div&gt;[[${userContent}]]&lt;/div&gt;         &lt;!-- å®‰å…¨ï¼šThymeleafç®€å†™è¯­æ³• --&gt;\n\n&lt;!-- å±é™©ï¼šç›´æ¥è¾“å‡ºæœªç¼–ç çš„å†…å®¹ --&gt;\n&lt;div th:utext=\"${userContent}\"&gt;&lt;/div&gt;  &lt;!-- å¯èƒ½æ‰§è¡Œæ¶æ„è„šæœ¬ --&gt;\n</code></pre>\n<p><strong>å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰</strong> æä¾›äº†æœ€ç»ˆçš„é˜²çº¿ï¼Œé€šè¿‡ç™½åå•æ§åˆ¶èµ„æºåŠ è½½ã€‚</p>\n<pre><code class=\"language-http\">Content-Security-Policy: default-src 'self'; script-src 'self' https://trusted.cdn.com; style-src 'self' 'unsafe-inline';\n</code></pre>\n<h3 id=\"23-ç°ä»£å‰ç«¯æ¡†æ¶çš„xssé˜²æŠ¤\">2.3 ç°ä»£å‰ç«¯æ¡†æ¶çš„XSSé˜²æŠ¤</h3>\n<p>ç°ä»£å‰ç«¯æ¡†æ¶å¦‚Reactã€Vueç­‰æä¾›äº†<strong>ä¸€å®šç¨‹åº¦çš„è‡ªåŠ¨é˜²æŠ¤</strong>ï¼Œä½†ä»æœ‰æ³¨æ„äº‹é¡¹ï¼š</p>\n<p><strong>Reactçš„è‡ªåŠ¨è½¬ä¹‰æœºåˆ¶</strong>ï¼š</p>\n<pre><code class=\"language-jsx\">// å®‰å…¨ï¼šReactä¼šè‡ªåŠ¨å¯¹å˜é‡è¿›è¡Œè½¬ä¹‰\nfunction Welcome(props) {\n    return &lt;h1&gt;Hello, {props.username}&lt;/h1&gt;;  // usernameä¸­çš„HTMLä¼šè¢«è½¬ä¹‰\n}\n\n// å±é™©ï¼šä½¿ç”¨dangerouslySetInnerHTMLç»•è¿‡é˜²æŠ¤\nfunction DangerousComponent({ content }) {\n    return &lt;div dangerouslySetInnerHTML={{ __html: content }} /&gt;;\n}\n</code></pre>\n<p><strong>Vueçš„ç±»ä¼¼æœºåˆ¶</strong>ï¼š</p>\n<pre><code class=\"language-html\">&lt;!-- å®‰å…¨ï¼šVueè‡ªåŠ¨è½¬ä¹‰ --&gt;\n&lt;div&gt;{{ userInput }}&lt;/div&gt;\n\n&lt;!-- å±é™©ï¼šä½¿ç”¨v-htmlæŒ‡ä»¤ --&gt;\n&lt;div v-html=\"userInput\"&gt;&lt;/div&gt;\n</code></pre>\n<h2 id=\"3-csrfé˜²æŠ¤ç¡®ä¿è¯·æ±‚çš„åˆæ³•æ€§éªŒè¯\">3 CSRFé˜²æŠ¤ï¼šç¡®ä¿è¯·æ±‚çš„åˆæ³•æ€§éªŒè¯</h2>\n<h3 id=\"31-csrfæ”»å‡»åŸç†ä¸å±å®³\">3.1 CSRFæ”»å‡»åŸç†ä¸å±å®³</h3>\n<p>CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰æ”»å‡»åˆ©ç”¨<strong>æµè§ˆå™¨çš„åŒç«™Cookieå‘é€æœºåˆ¶</strong>ï¼Œè¯±ä½¿ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å‘èµ·æ¶æ„è¯·æ±‚ã€‚</p>\n<p><strong>å…¸å‹æ”»å‡»æµç¨‹</strong>ï¼š</p>\n<ol>\n<li>ç”¨æˆ·ç™»å½•æ­£è§„ç½‘ç«™Aï¼Œè·å¾—è®¤è¯Cookie</li>\n<li>ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™Bï¼Œé¡µé¢ä¸­åŒ…å«å‘ç½‘ç«™Aå‘è¯·æ±‚çš„ä»£ç </li>\n<li>æµè§ˆå™¨è‡ªåŠ¨æºå¸¦ç½‘ç«™Açš„Cookieå‘å‡ºè¯·æ±‚</li>\n<li>ç½‘ç«™Aè®¤ä¸ºè¿™æ˜¯ç”¨æˆ·çš„åˆæ³•æ“ä½œï¼Œæ‰§è¡Œæ¶æ„è¯·æ±‚</li>\n</ol>\n<h3 id=\"32-csrfé˜²æŠ¤çš„ååŒç­–ç•¥\">3.2 CSRFé˜²æŠ¤çš„ååŒç­–ç•¥</h3>\n<p><strong>CSRF Token</strong>æ˜¯é˜²æŠ¤CSRFæœ€æœ‰æ•ˆçš„æ‰‹æ®µï¼Œè¦æ±‚æ¯ä¸ªè¯·æ±‚æºå¸¦ä¸å¯é¢„æµ‹çš„ä»¤ç‰Œã€‚</p>\n<pre><code class=\"language-java\">// Spring Securityä¸­çš„CSRFé˜²æŠ¤é…ç½®\n@Configuration\n@EnableWebSecurity\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        http\n            .csrf().csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse());\n    }\n}\n\n// å‰ç«¯åœ¨è¯·æ±‚ä¸­æºå¸¦CSRF Token\n// &lt;form&gt;ä¸­è‡ªåŠ¨åŒ…å«ï¼š&lt;input type=\"hidden\" name=\"_csrf\" th:value=\"${_csrf.token}\"&gt;\n// AJAXè¯·æ±‚éœ€è¦æ‰‹åŠ¨è®¾ç½®å¤´ï¼šX-CSRF-TOKEN: tokenå€¼\n</code></pre>\n<p><strong>SameSite Cookieå±æ€§</strong>ä»æµè§ˆå™¨å±‚é¢æä¾›é˜²æŠ¤ï¼Œé™åˆ¶ç¬¬ä¸‰æ–¹Cookieçš„ä½¿ç”¨ã€‚</p>\n<pre><code class=\"language-java\">// è®¾ç½®SameSiteå±æ€§çš„Cookie\nCookie sessionCookie = new Cookie(\"JSESSIONID\", sessionId);\nsessionCookie.setSecure(true);  // ä»…HTTPSä¼ è¾“\nsessionCookie.setHttpOnly(true); // ç¦æ­¢JavaScriptè®¿é—®\n// è®¾ç½®SameSite=Strictï¼Œå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹ä½¿ç”¨\nresponse.addHeader(\"Set-Cookie\", \"JSESSIONID=\" + sessionId + \"; SameSite=Strict\");\n</code></pre>\n<p><strong>å…³é”®æ“ä½œäºŒæ¬¡éªŒè¯</strong>é’ˆå¯¹é‡è¦æ“ä½œï¼ˆå¦‚æ”¯ä»˜ã€ä¿®æ”¹å¯†ç ï¼‰è¦æ±‚é‡æ–°è®¤è¯ã€‚</p>\n<h2 id=\"4-sqlæ³¨å…¥é˜²æŠ¤æ•°æ®å±‚è®¿é—®çš„å®‰å…¨è¾¹ç•Œ\">4 SQLæ³¨å…¥é˜²æŠ¤ï¼šæ•°æ®å±‚è®¿é—®çš„å®‰å…¨è¾¹ç•Œ</h2>\n<h3 id=\"41-sqlæ³¨å…¥çš„æ¼”å˜ä¸å±å®³\">4.1 SQLæ³¨å…¥çš„æ¼”å˜ä¸å±å®³</h3>\n<p>SQLæ³¨å…¥ä¸ä»…ä»…æ˜¯ä¼ ç»Ÿçš„<code>' OR '1'='1</code>æ”»å‡»ï¼Œç°ä»£SQLæ³¨å…¥åŒ…æ‹¬<strong>ç›²æ³¨ã€æ—¶é—´ç›²æ³¨ã€å †å æŸ¥è¯¢</strong>ç­‰å¤æ‚å½¢å¼ã€‚</p>\n<p><strong>SQLæ³¨å…¥çš„ä¸»è¦å±å®³</strong>ï¼š</p>\n<ul>\n<li><strong>æ•°æ®æ³„éœ²</strong>ï¼šè·å–æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·å‡­è¯ã€ä¸ªäººæ•°æ®</li>\n<li><strong>æ•°æ®ç¯¡æ”¹</strong>ï¼šä¿®æ”¹ã€åˆ é™¤é‡è¦ä¸šåŠ¡æ•°æ®</li>\n<li><strong>æƒé™æå‡</strong>ï¼šè·å–æ•°æ®åº“ç®¡ç†å‘˜æƒé™</li>\n<li><strong>æœåŠ¡å™¨æ²¦é™·</strong>ï¼šé€šè¿‡æ•°æ®åº“æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</li>\n</ul>\n<h3 id=\"42-æ ¹æœ¬æ€§è§£å†³æ–¹æ¡ˆå‚æ•°åŒ–æŸ¥è¯¢\">4.2 æ ¹æœ¬æ€§è§£å†³æ–¹æ¡ˆï¼šå‚æ•°åŒ–æŸ¥è¯¢</h3>\n<p><strong>é¢„ç¼–è¯‘è¯­å¥ï¼ˆPreparedStatementï¼‰</strong> é€šè¿‡å°†SQLä»£ç ä¸æ•°æ®åˆ†ç¦»ï¼Œä»æ ¹æœ¬ä¸Šæœç»æ³¨å…¥å¯èƒ½ã€‚</p>\n<pre><code class=\"language-java\">// å±é™©ï¼šå­—ç¬¦ä¸²æ‹¼æ¥SQL\nString query = \"SELECT * FROM users WHERE username = '\" + username + \"'\";\nStatement stmt = connection.createStatement();\nResultSet rs = stmt.executeQuery(query);\n\n// å®‰å…¨ï¼šä½¿ç”¨PreparedStatement\nString query = \"SELECT * FROM users WHERE username = ?\";\nPreparedStatement pstmt = connection.prepareStatement(query);\npstmt.setString(1, username);  // å‚æ•°ä¼šè¢«æ­£ç¡®è½¬ä¹‰å’Œå¤„ç†\nResultSet rs = pstmt.executeQuery();\n</code></pre>\n<p><strong>ORMæ¡†æ¶çš„å®‰å…¨ä½¿ç”¨</strong>ï¼š</p>\n<pre><code class=\"language-java\">// JPA/Hibernateå®‰å…¨ç”¨æ³•\npublic interface UserRepository extends JpaRepository&lt;User, Long&gt; {\n    // å®‰å…¨ï¼šä½¿ç”¨å‘½åå‚æ•°\n    @Query(\"SELECT u FROM User u WHERE u.username = :username\")\n    User findByUsername(@Param(\"username\") String username);\n    \n    // å±é™©ï¼šä½¿ç”¨åŸç”ŸSQLæ‹¼æ¥ï¼ˆä¸æ¨èï¼‰\n    @Query(value = \"SELECT * FROM users WHERE username = '\" + \":username\" + \"'\", nativeQuery = true)\n    User findByUsernameUnsafe(@Param(\"username\") String username);\n}\n</code></pre>\n<h3 id=\"43-æ·±åº¦é˜²å¾¡æœ€å°æƒé™åŸåˆ™\">4.3 æ·±åº¦é˜²å¾¡ï¼šæœ€å°æƒé™åŸåˆ™</h3>\n<p><strong>æ•°æ®åº“ç”¨æˆ·æƒé™åˆ†ç¦»</strong>æ˜¯å‡å°‘SQLæ³¨å…¥å±å®³çš„é‡è¦æªæ–½ï¼š</p>\n<pre><code class=\"language-sql\">-- åˆ›å»ºä»…å…·æœ‰æŸ¥è¯¢æƒé™çš„æ•°æ®åº“ç”¨æˆ·\nCREATE USER 'webapp'@'localhost' IDENTIFIED BY 'securepassword';\nGRANT SELECT ON app_db.* TO 'webapp'@'localhost';\n\n-- é‡è¦æ“ä½œä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œä»…æˆæƒæ‰§è¡Œæƒé™\nGRANT EXECUTE ON PROCEDURE update_user_profile TO 'webapp'@'localhost';\n</code></pre>\n<h2 id=\"5-é˜²é‡æ”¾æ”»å‡»ç¡®ä¿è¯·æ±‚çš„æ–°é²œæ€§\">5 é˜²é‡æ”¾æ”»å‡»ï¼šç¡®ä¿è¯·æ±‚çš„æ–°é²œæ€§</h2>\n<h3 id=\"51-é‡æ”¾æ”»å‡»çš„åŸç†ä¸åœºæ™¯\">5.1 é‡æ”¾æ”»å‡»çš„åŸç†ä¸åœºæ™¯</h3>\n<p>é‡æ”¾æ”»å‡»æŒ‡æ”»å‡»è€…<strong>æˆªè·åˆæ³•è¯·æ±‚å¹¶é‡å¤å‘é€</strong>ï¼Œå¯¼è‡´éé¢„æœŸæ“ä½œã€‚å¸¸è§äºæ”¯ä»˜ã€é‡è¦çŠ¶æ€å˜æ›´ç­‰åœºæ™¯ã€‚</p>\n<p><strong>é‡æ”¾æ”»å‡»çš„é˜²æŠ¤ç›®æ ‡</strong>ï¼š</p>\n<ul>\n<li>ç¡®ä¿è¯·æ±‚çš„<strong>æ–°é²œæ€§</strong>ï¼ˆä¸æ˜¯æ—§çš„é‡å¤è¯·æ±‚ï¼‰</li>\n<li>ä¿è¯è¯·æ±‚çš„<strong>å”¯ä¸€æ€§</strong>ï¼ˆåŒä¸€è¯·æ±‚ä¸èƒ½æ‰§è¡Œä¸¤æ¬¡ï¼‰</li>\n</ul>\n<h3 id=\"52-åŸºäºnonceå’Œæ—¶é—´æˆ³çš„é˜²æŠ¤æ–¹æ¡ˆ\">5.2 åŸºäºNonceå’Œæ—¶é—´æˆ³çš„é˜²æŠ¤æ–¹æ¡ˆ</h3>\n<p><strong>Nonceï¼ˆä¸€æ¬¡æ€§æ•°å­—ï¼‰æ–¹æ¡ˆ</strong>ç¡®ä¿æ¯ä¸ªè¯·æ±‚çš„å”¯ä¸€æ€§ã€‚</p>\n<pre><code class=\"language-java\">@Service\npublic class NonceService {\n    @Autowired\n    private RedisTemplate&lt;String, String&gt; redisTemplate;\n    \n    private static final long NONCE_TIMEOUT = 5 * 60; // 5åˆ†é’Ÿ\n    \n    public boolean validateNonce(String nonce, long timestamp) {\n        // æ£€æŸ¥æ—¶é—´æˆ³æœ‰æ•ˆæ€§ï¼ˆé˜²æ­¢æ—¶é’Ÿåç§»æ”»å‡»ï¼‰\n        long currentTime = System.currentTimeMillis() / 1000;\n        if (Math.abs(currentTime - timestamp) &gt; 300) { // 5åˆ†é’Ÿå®¹å¿\n            return false;\n        }\n        \n        // æ£€æŸ¥Nonceæ˜¯å¦å·²ä½¿ç”¨ï¼ˆRedisåŸå­æ“ä½œï¼‰\n        String key = \"nonce:\" + nonce;\n        return redisTemplate.opsForValue().setIfAbsent(key, \"used\", \n            Duration.ofSeconds(NONCE_TIMEOUT));\n    }\n}\n</code></pre>\n<p><strong>ç­¾åæœºåˆ¶</strong>é˜²æ­¢è¯·æ±‚è¢«ç¯¡æ”¹ï¼š</p>\n<pre><code class=\"language-java\">public class SignatureUtils {\n    public static String generateSignature(String data, String secret) {\n        String message = data + secret;\n        return DigestUtils.sha256Hex(message);\n    }\n    \n    public static boolean validateSignature(String data, String signature, String secret) {\n        String expected = generateSignature(data, secret);\n        return MessageDigest.isEqual(expected.getBytes(), signature.getBytes());\n    }\n}\n</code></pre>\n<h2 id=\"6-æ•æ„Ÿæ•°æ®ä¿æŠ¤å…¨ç”Ÿå‘½å‘¨æœŸå®‰å…¨\">6 æ•æ„Ÿæ•°æ®ä¿æŠ¤ï¼šå…¨ç”Ÿå‘½å‘¨æœŸå®‰å…¨</h2>\n<h3 id=\"61-æ•°æ®ä¼ è¾“å®‰å…¨tlsæœ€ä½³å®è·µ\">6.1 æ•°æ®ä¼ è¾“å®‰å…¨ï¼šTLSæœ€ä½³å®è·µ</h3>\n<p><strong>HTTPSé…ç½®ä¼˜åŒ–</strong>ç¡®ä¿æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚</p>\n<pre><code class=\"language-nginx\"># Nginx TLSä¼˜åŒ–é…ç½®\nserver {\n    listen 443 ssl http2;\n    server_name example.com;\n    \n    # è¯ä¹¦é…ç½®\n    ssl_certificate /path/to/fullchain.pem;\n    ssl_certificate_key /path/to/privkey.pem;\n    \n    # åè®®å’Œå¯†ç å¥—ä»¶ä¼˜åŒ–\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;\n    ssl_prefer_server_ciphers off;\n    \n    # HSTSå¼ºåˆ¶HTTPS\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n    \n    # å®‰å…¨å¤´éƒ¨\n    add_header X-Frame-Options \"SAMEORIGIN\" always;\n    add_header X-Content-Type-Options \"nosniff\" always;\n    add_header X-XSS-Protection \"1; mode=block\" always;\n}\n</code></pre>\n<h3 id=\"62-æ•æ„Ÿæ•°æ®å­˜å‚¨å®‰å…¨\">6.2 æ•æ„Ÿæ•°æ®å­˜å‚¨å®‰å…¨</h3>\n<p><strong>å¯†ç å“ˆå¸Œå¤„ç†</strong>ä½¿ç”¨é€‚åˆçš„ç®—æ³•å’Œç›å€¼ã€‚</p>\n<pre><code class=\"language-java\">@Service\npublic class PasswordService {\n    private final BCryptPasswordEncoder passwordEncoder = new BCryptPasswordEncoder();\n    \n    public String hashPassword(String rawPassword) {\n        return passwordEncoder.encode(rawPassword);\n    }\n    \n    public boolean matches(String rawPassword, String encodedPassword) {\n        return passwordEncoder.matches(rawPassword, encodedPassword);\n    }\n}\n</code></pre>\n<p><strong>å¯é€†åŠ å¯†æ•°æ®</strong>ä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•ã€‚</p>\n<pre><code class=\"language-java\">@Component\npublic class AesEncryptionService {\n    private static final String ALGORITHM = \"AES/GCM/NoPadding\";\n    private final SecretKey secretKey;\n    \n    public AesEncryptionService(@Value(\"${encryption.key}\") String base64Key) {\n        byte[] keyBytes = Base64.getDecoder().decode(base64Key);\n        this.secretKey = new SecretKeySpec(keyBytes, \"AES\");\n    }\n    \n    public String encrypt(String data) throws GeneralSecurityException {\n        Cipher cipher = Cipher.getInstance(ALGORITHM);\n        cipher.init(Cipher.ENCRYPT_MODE, secretKey);\n        \n        byte[] encrypted = cipher.doFinal(data.getBytes(StandardCharsets.UTF_8));\n        byte[] iv = cipher.getIV();\n        \n        // ç»„åˆIVå’ŒåŠ å¯†æ•°æ®\n        byte[] result = new byte[iv.length + encrypted.length];\n        System.arraycopy(iv, 0, result, 0, iv.length);\n        System.arraycopy(encrypted, 0, result, iv.length, encrypted.length);\n        \n        return Base64.getEncoder().encodeToString(result);\n    }\n}\n</code></pre>\n<h2 id=\"7-å®‰å…¨å¤´éƒ¨é…ç½®æµè§ˆå™¨ç«¯çš„å®‰å…¨åŠ å›º\">7 å®‰å…¨å¤´éƒ¨é…ç½®ï¼šæµè§ˆå™¨ç«¯çš„å®‰å…¨åŠ å›º</h2>\n<h3 id=\"71-å…³é”®å®‰å…¨å¤´éƒ¨åŠå…¶ä½œç”¨\">7.1 å…³é”®å®‰å…¨å¤´éƒ¨åŠå…¶ä½œç”¨</h3>\n<p><strong>å®‰å…¨å¤´éƒ¨</strong>ä¸ºæµè§ˆå™¨æä¾›é¢å¤–çš„å®‰å…¨æŒ‡ä»¤ï¼Œæ˜¯ç°ä»£Webåº”ç”¨çš„é‡è¦é˜²æŠ¤å±‚ã€‚</p>\n<pre><code class=\"language-nginx\"># å®Œæ•´çš„å®‰å…¨å¤´éƒ¨é…ç½®\nadd_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\nadd_header X-Frame-Options \"SAMEORIGIN\" always;\nadd_header X-Content-Type-Options \"nosniff\" always;\nadd_header X-XSS-Protection \"1; mode=block\" always;\nadd_header Referrer-Policy \"strict-origin-when-cross-origin\" always;\nadd_header Content-Security-Policy \"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';\" always;\n</code></pre>\n<h3 id=\"72-cspçš„ç²¾ç»†æ§åˆ¶ç­–ç•¥\">7.2 CSPçš„ç²¾ç»†æ§åˆ¶ç­–ç•¥</h3>\n<p><strong>å†…å®¹å®‰å…¨ç­–ç•¥</strong>é€šè¿‡ç™½åå•æ§åˆ¶èµ„æºåŠ è½½ï¼Œæœ‰æ•ˆå‡ç¼“XSSæ”»å‡»ã€‚</p>\n<pre><code class=\"language-http\"># ä¸¥æ ¼çš„CSPç­–ç•¥ç¤ºä¾‹\nContent-Security-Policy: \n  default-src 'none';\n  script-src 'self' 'sha256-abc123...';\n  style-src 'self' 'unsafe-inline';\n  img-src 'self' data: https:;\n  font-src 'self';\n  connect-src 'self';\n  frame-ancestors 'none';\n  base-uri 'self';\n  form-action 'self';\n</code></pre>\n<h2 id=\"8-è‡ªåŠ¨åŒ–å®‰å…¨æ£€æµ‹ä¸ç›‘æ§\">8 è‡ªåŠ¨åŒ–å®‰å…¨æ£€æµ‹ä¸ç›‘æ§</h2>\n<h3 id=\"81-å®‰å…¨å·¥å…·é›†æˆ\">8.1 å®‰å…¨å·¥å…·é›†æˆ</h3>\n<p><strong>SASTï¼ˆé™æ€åº”ç”¨å®‰å…¨æµ‹è¯•ï¼‰</strong> åœ¨å¼€å‘é˜¶æ®µå‘ç°æ½œåœ¨æ¼æ´ã€‚</p>\n<pre><code class=\"language-yaml\"># GitLab CIå®‰å…¨æ‰«æç¤ºä¾‹\nstages:\n  - test\n  - security\n\nsast:\n  stage: security\n  image: owasp/zap2docker-stable\n  script:\n    - zap-baseline.py -t https://${STAGING_URL} -r report.html\n  artifacts:\n    paths:\n      - report.html\n</code></pre>\n<p><strong>ä¾èµ–é¡¹æ¼æ´æ‰«æ</strong>åŠæ—¶å‘ç°ç¬¬ä¸‰æ–¹ç»„ä»¶é£é™©ã€‚</p>\n<pre><code class=\"language-xml\">&lt;!-- OWASPä¾èµ–æ£€æŸ¥Mavenæ’ä»¶ --&gt;\n&lt;plugin&gt;\n    &lt;groupId&gt;org.owasp&lt;/groupId&gt;\n    &lt;artifactId&gt;dependency-check-maven&lt;/artifactId&gt;\n    &lt;version&gt;6.0.0&lt;/version&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;check&lt;/goal&gt;\n            &lt;/goals&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre>\n<h3 id=\"82-å®‰å…¨ç›‘æ§ä¸åº”æ€¥å“åº”\">8.2 å®‰å…¨ç›‘æ§ä¸åº”æ€¥å“åº”</h3>\n<p><strong>å®‰å…¨äº‹ä»¶æ—¥å¿—è®°å½•</strong>ä¸ºäº‹ä»¶è¿½æº¯æä¾›ä¾æ®ã€‚</p>\n<pre><code class=\"language-java\">@Aspect\n@Component\npublic class SecurityLoggingAspect {\n    private static final Logger SECURITY_LOGGER = LoggerFactory.getLogger(\"SECURITY\");\n    \n    @AfterReturning(pointcut = \"execution(* com.example.controller.AuthController.login(..))\", returning = \"result\")\n    public void logLoginAttempt(JoinPoint joinPoint, Object result) {\n        Object[] args = joinPoint.getArgs();\n        String username = (String) args[0];\n        String ip = getClientIP();\n        \n        SECURITY_LOGGER.info(\"ç™»å½•å°è¯•: ç”¨æˆ·={}, IP={}, ç»“æœ={}\", \n            username, ip, ((LoginResult)result).isSuccess() ? \"æˆåŠŸ\" : \"å¤±è´¥\");\n    }\n}\n</code></pre>\n<h2 id=\"æ€»ç»“\">æ€»ç»“</h2>\n<p>Webå®‰å…¨æ˜¯ä¸€ä¸ªéœ€è¦<strong>æŒç»­å…³æ³¨å’ŒæŠ•å…¥</strong>çš„é¢†åŸŸã€‚æœ‰æ•ˆçš„å®‰å…¨é˜²æŠ¤ä¸æ˜¯å•ä¸€æŠ€æœ¯æˆ–å·¥å…·çš„åº”ç”¨ï¼Œè€Œæ˜¯<strong>å¤šå±‚æ¬¡ã€å¤šç»´åº¦é˜²æŠ¤ç­–ç•¥çš„æœ‰æœºç»„åˆ</strong>ã€‚</p>\n<p><strong>çºµæ·±é˜²å¾¡çš„æ ¸å¿ƒåŸåˆ™</strong>ï¼š</p>\n<ol>\n<li><strong>è¾“å…¥éªŒè¯</strong>ï¼šæ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ä¸å¯ä¿¡ï¼Œå¿…é¡»ç»è¿‡ä¸¥æ ¼éªŒè¯</li>\n<li><strong>æœ€å°æƒé™</strong>ï¼šæ¯ä¸ªç»„ä»¶åªæ‹¥æœ‰å®Œæˆå…¶åŠŸèƒ½æ‰€éœ€çš„æœ€å°æƒé™</li>\n<li><strong>é»˜è®¤æ‹’ç»</strong>ï¼šç™½åå•ä¼˜äºé»‘åå•ï¼Œæ˜ç¡®å…è®¸è€Œéé»˜è®¤å…è®¸</li>\n<li><strong>å…¨é¢é˜²æŠ¤</strong>ï¼šä»å®¢æˆ·ç«¯åˆ°æ•°æ®åº“ï¼Œæ¯ä¸ªç¯èŠ‚éƒ½éœ€è¦ç›¸åº”çš„é˜²æŠ¤æªæ–½</li>\n<li><strong>æŒç»­ç›‘æ§</strong>ï¼šå®‰å…¨æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œéœ€è¦æŒç»­ç›‘æ§å’Œæ”¹è¿›</li>\n</ol>\n<p>é€šè¿‡å®æ–½æœ¬æ–‡æä¾›çš„åˆ†å±‚é˜²æŠ¤ç­–ç•¥ï¼Œå¯ä»¥æ˜¾è‘—æå‡Webåº”ç”¨çš„å®‰å…¨æ€§ï¼Œä¸ºä¸šåŠ¡å‘å±•æä¾›å¯é çš„åŸºç¡€ä¿éšœã€‚</p>\n<hr />\n<p><strong>ğŸ“š ä¸‹ç¯‡é¢„å‘Š</strong><br />\nã€Šå¥‘çº¦ä¼˜å…ˆä¸åä½œæ•ˆç‡â€”â€”æ¶ˆè´¹è€…é©±åŠ¨å¥‘çº¦æ€ç»´å¸¦æ¥çš„å›¢é˜Ÿæˆæœ¬ä¸‹é™ã€‹â€”â€” æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ï¼š</p>\n<ul>\n<li>ğŸ“œ <strong>å¥‘çº¦æµ‹è¯•æœ¬è´¨</strong>ï¼šæ¶ˆè´¹è€…é©±åŠ¨å¥‘çº¦ï¼ˆCDCï¼‰å¦‚ä½•è§£è€¦å¾®æœåŠ¡é›†æˆä¾èµ–</li>\n<li>ğŸ¤ <strong>å›¢é˜Ÿåä½œä¼˜åŒ–</strong>ï¼šå¥‘çº¦ä¼˜å…ˆå¼€å‘æ¨¡å¼å¦‚ä½•å‡å°‘è·¨å›¢é˜Ÿæ²Ÿé€šæˆæœ¬</li>\n<li>ğŸ”§ <strong>å®è·µè½åœ°è·¯å¾„</strong>ï¼šPactç­‰å·¥å…·åœ¨æŒç»­é›†æˆä¸­çš„é…ç½®ä¸æ‰§è¡Œç­–ç•¥</li>\n<li>ğŸ’° <strong>æˆæœ¬æ•ˆç›Šåˆ†æ</strong>ï¼šå¥‘çº¦æµ‹è¯•å¸¦æ¥çš„å¼€å‘æ•ˆç‡æå‡ä¸ç¼ºé™·é¢„é˜²æ”¶ç›Š</li>\n<li>ğŸš€ <strong>å¹³æ»‘è¿ç§»æ–¹æ¡ˆ</strong>ï¼šä»ä¼ ç»Ÿé›†æˆæµ‹è¯•åˆ°å¥‘çº¦æµ‹è¯•çš„æ¸è¿›å¼è¿ç§»</li>\n</ul>\n<p><strong>ç‚¹å‡»å…³æ³¨ï¼ŒæŒæ¡å¾®æœåŠ¡åä½œçš„æ•ˆç‡æå‡ä¹‹é“ï¼</strong></p>\n<blockquote>\n<p><strong>ä»Šæ—¥è¡ŒåŠ¨å»ºè®®</strong>ï¼š</p>\n<ol>\n<li>æ£€æŸ¥ç°æœ‰é¡¹ç›®çš„å®‰å…¨å¤´éƒ¨é…ç½®ï¼Œç¡®ä¿å…³é”®å¤´éƒ¨æ­£ç¡®è®¾ç½®</li>\n<li>å¯¹é‡è¦æ¥å£æ·»åŠ é˜²é‡æ”¾æœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯æ”¯ä»˜ã€çŠ¶æ€å˜æ›´ç­‰å…³é”®æ“ä½œ</li>\n<li>å»ºç«‹ä¾èµ–ç»„ä»¶æ¼æ´æ‰«ææµç¨‹ï¼Œé›†æˆåˆ°CI/CDæµæ°´çº¿</li>\n<li>å®¡æŸ¥æ•°æ®åŠ å¯†æ–¹æ¡ˆï¼Œç¡®ä¿æ•æ„Ÿä¿¡æ¯å¾—åˆ°é€‚å½“ä¿æŠ¤</li>\n</ol>\n</blockquote>\n\n</div>\n<div id=\"MySignature\">\n    ä¸ªäººå¾®ä¿¡ï¼šlpshiyue æ·»åŠ æš—å·ï¼šé“ç”Ÿä¸€ <br />\næ¬¢è¿æœç´¢å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼š åŸºç¡€è¿›é˜¶ï¼Œç¬¬ä¸€æ—¶é—´é˜…è¯»æœ€æ–°æ–‡ç« \n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\">2026-01-14 11:24</span>&nbsp;\n<a href=\"https://www.cnblogs.com/shiyuelp\">åæœˆå—åŸ</a>&nbsp;\né˜…è¯»(<span id=\"post_view_count\">0</span>)&nbsp;\nè¯„è®º(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"\">æ”¶è—</a>&nbsp;\n<a href=\"\">ä¸¾æŠ¥</a>\n</div>"
    }
  ]
}