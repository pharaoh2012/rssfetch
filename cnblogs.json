{"title":"主页 - 博客园","link":"https://www.cnblogs.com/","description":"主页 - 博客园 RSS","language":"zh-cn","lastBuildDate":"2025-12-23T07:15:28.695Z","items":[{"title":"拒绝“凭感觉”：用回归分析看透数据背后的秘密","link":"https://www.cnblogs.com/wang_yb/p/19387176","description":"<h1 class=\"postTitle\">\n                <a id=\"cb_post_title_url\" class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/wang_yb/p/19387176\" title=\"发布于 2025-12-23 15:07\">\n    <span role=\"heading\" aria-level=\"2\">拒绝“凭感觉”：用回归分析看透数据背后的秘密</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div id=\"cnblogs_post_body\" class=\"blogpost-body cnblogs-markdown\">\n<p>在数据分析的江湖里，有一个绝对的核心技能，叫做<strong>回归分析（Regression Analysis）</strong>。</p>\n<p>无论你是刚入行的新手，还是想要进阶的老手，掌握它，你就拥有了预测未来的“水晶球”。</p>\n<p>很多初学者一听到“回归”两个字，脑子里全是复杂的数学公式，立刻想打退堂鼓。</p>\n<p>别急！今天我们不讲枯燥的数学推导，只讲<strong>它是什么、怎么用，以及如何用Python代码解决实际问题</strong>。</p>\n<h1 id=\"1-什么是回归分析\">1. 什么是回归分析？</h1>\n<p>想象一下，你正在做饭。你知道火开得越大（变量X），锅里的水烧开的时间就越短（变量Y）。这种<strong>探寻变量之间因果关系或相关关系</strong>的过程，就是回归分析。</p>\n<p>在数据分析中，回归分析主要帮我们解决两个问题：</p>\n<ol>\n<li><strong>归因</strong>：是谁影响了结果？（比如：是学历还是工作经验决定了你的薪资？）</li>\n<li><strong>预测</strong>：根据现有数据推测未来。（比如：根据上个月的广告费，预测下个月的销量。）</li>\n</ol>\n<h1 id=\"2-线性回归一切的起点\">2. 线性回归：一切的起点</h1>\n<p>线性回归是最简单、最基础的模型，它假设变量之间的关系是一条<strong>直线</strong>。</p>\n<h2 id=\"21-简单线性回归\">2.1. 简单线性回归</h2>\n<p><strong>公式</strong>：$ y = ax + b $</p>\n<p>比如我们要研究 <strong>“工作经验”和“薪资”</strong>的关系。</p>\n<ul>\n<li>$ x $：工作年限</li>\n<li>$ y $：月薪</li>\n</ul>\n<p>这里的核心是找到那个最好的 $ a $（斜率，代表经验每增加一年，工资涨多少）和 $ b $（截距，代表刚毕业时的起薪）。</p>\n<p>我们通常使用<strong>最小二乘法</strong>，简单来说，就是画一条线，让所有实际的数据点到这条线的距离之和最小。</p>\n<p>代码示例：预测你的薪资</p>\n<pre><code class=\"language-python\">import numpy as np\nimport matplotlib.pyplot as plt\nfrom sklearn.linear_model import LinearRegression\n\n# 1. 模拟数据：工作年限 vs 月薪 (单位：千元)\n# 真实世界中数据总会有波动（加上一些随机噪声）\nnp.random.seed(42)\nX = np.array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10]).reshape(-1, 1) # 工作年限\ny = 3 * X + 5 + np.random.normal(0, 1.5, size=(10, 1))      # 假设大概规律是：起薪5k，每年涨3k\n\n# 2. 建立模型并训练\nmodel = LinearRegression()\nmodel.fit(X, y)\n\n# 3. 打印回归系数\nprint(f\"回归方程: y = {model.coef_[0][0]:.2f} * x + {model.intercept_[0]:.2f}\")\nprint(\"解读：起薪约 {:.2f}k，每年约涨 {:.2f}k\".format(model.intercept_[0], model.coef_[0][0]))\n\n# 运行结果：\n'''\n回归方程: y = 2.99 * x + 5.73\n解读：起薪约 5.73k，每年约涨 2.99k\n'''\n</code></pre>\n<p><img src=\"https://img2024.cnblogs.com/blog/83005/202512/83005-20251223150516593-181444094.png\" alt=\"\" loading=\"lazy\"></p>\n<h2 id=\"22-多元线性回归\">2.2. 多元线性回归</h2>\n<p>现实生活中，影响薪资的不止是年限，还有<strong>学历</strong>、<strong>所在城市</strong>等。</p>\n<p>当自变量 $ x $ 变成多个（$ x_1, x_2, ... $）时，这就是多元线性回归。</p>\n<p>虽然超过<strong>3维</strong>画图比较困难，但<code>Python</code>处理起来代码几乎和<strong>简单线性回归</strong>一样，只是把 $ X $ 数据集多加几列而已。</p>\n<h1 id=\"3-非线性回归现实世界通常是弯曲的\">3. 非线性回归：现实世界通常是弯曲的</h1>\n<p>并不是所有关系都是直线的。比如：</p>\n<ul>\n<li><strong>细菌分裂</strong>：一开始很少，突然爆发（指数函数）。</li>\n<li><strong>学习曲线</strong>：刚开始进步快，后面越来越慢（对数函数）。</li>\n<li><strong>网红产品生命周期</strong>：爆发增长 -&gt; 趋于饱和（S曲线/逻辑函数）。</li>\n</ul>\n<p>针对这些非线性关系，我们需要用到不同的“数学模型”来拟合。</p>\n<p>以下是 **10种常用非线性模型 **的公式。</p>\n<p>我们将使用 <code>Python</code> 的 <code>scipy.optimize.curve_fit</code> 库，这个库非常强大，只要你给出公式，它就能帮你找到参数。</p>\n<pre><code class=\"language-python\">import numpy as np\n\n# --- 定义各种非线性函数 ---\n\n# 1. 二次式 (抛物线，如投篮轨迹)\ndef func_quadratic(x, a, b, c):\n    return a * x**2 + b * x + c\n\n# 2. 三次式 (波动更复杂的数据)\ndef func_cubic(x, a, b, c, d):\n    return a * x**3 + b * x**2 + c * x + d\n\n# 3. 增长函数 (常用于人口增长、复利计算)\ndef func_growth(x, a, b):\n    return np.exp(a * x + b)\n\n# 4. 幂函数 (如物理学中的万有引力、规模效应)\ndef func_power(x, a, b):\n    return a * (x ** b)\n\n# 5. 指数函数 (病毒传播初期)\ndef func_exponential(x, a, b):\n    return a * np.exp(b * x)\n\n# 6. 对数函数 (边际效应递减，如广告投入与销量的后期关系)\ndef func_logarithmic(x, a, b):\n    # 防止x为0报错，通常处理为 x+1 或确保数据 &gt; 0\n    return a * np.log(x) + b\n\n# 7. 复合函数 (根据具体复合形式定义，此处示例 y = a * b^x)\ndef func_compound(x, a, b):\n    return a * (b ** x)\n\n# 8. S曲线 (S-Curve, 早期慢，中期快，晚期平缓)\ndef func_scurve(x, a, b):\n    return np.exp(a + b / x)\n\n# 9. 逆函数 (双曲线，如某种反比关系)\ndef func_inverse(x, a, b):\n    return a + b / x\n\n# 10. 逻辑函数 (Logistic, 典型的S型增长，有上限，如市场渗透率)\n# u: 上限, a, b: 形状参数\ndef func_logistic(x, u, a, b):\n    return 1 / (1/u + a * (b ** x))\n</code></pre>\n<table>\n<thead>\n<tr>\n<th>模型类型</th>\n<th>数学形式</th>\n<th>实际案例</th>\n<th>关键特征</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>二次式模型</td>\n<td>$ y=ax^2+bx+c $</td>\n<td>1. 广告投入与销售额（边际递减）<br>   2. 生产成本与产量（U型成本曲线）<br>   3. 车速与燃油效率</td>\n<td>• 只有一个极值点<br>   • 描述先增后减或先减后增<br>   • 适合局部非线性</td>\n</tr>\n<tr>\n<td>三次式模型</td>\n<td>$ y=ax<sup>3+bx</sup>2+cx+d $</td>\n<td>1. 经济周期波动分析<br>   2. 复杂化学反应速率<br>   3. 生物生长多阶段模型</td>\n<td>• 可有多个极值点<br>   • 描述S型或N型曲线<br>   • 灵活但易过拟合</td>\n</tr>\n<tr>\n<td>增长函数</td>\n<td>$ y=e^{(ax+b)} $</td>\n<td>1. 病毒传播初期<br>   2. 初创公司用户增长<br>   3. 复利计算</td>\n<td>• J型增长曲线<br>   • 增长率恒定<br>   • 无上限增长</td>\n</tr>\n<tr>\n<td>幂函数</td>\n<td>$ y=ax^b $</td>\n<td>1. 代谢率与体重（克莱伯定律）<br>   2. 城市规模与经济产出<br>   3. 学习曲线（熟练度提升）</td>\n<td>• 双对数坐标下呈直线<br>   • 描述规模效应<br>   • b&gt;1：超线性；b&lt;1：次线性</td>\n</tr>\n<tr>\n<td>指数函数</td>\n<td>$ y=ae^{bx} $</td>\n<td>1. 放射性物质衰变<br>   2. 设备折旧计算<br>   3. 温度冷却过程</td>\n<td>• 半对数坐标下呈直线<br>   • b&gt;0：指数增长<br>   • b&lt;0：指数衰减</td>\n</tr>\n<tr>\n<td>对数函数</td>\n<td>$ y=a\\ln x+b $</td>\n<td>1. 技能提升曲线<br>   2. 营销效果递减<br>   3. 收入与幸福感关系</td>\n<td>• 初期增长迅速<br>   • 后期趋于平缓<br>   • 描述边际递减效应</td>\n</tr>\n<tr>\n<td>复合函数</td>\n<td>$ y=a^xb $</td>\n<td>1. 技术创新扩散<br>   2. 社交媒体信息传播<br>   3. 某些生物种群增长</td>\n<td>• 变量在指数位置<br>   • 增长速率不断变化<br>   • 形式较为特殊</td>\n</tr>\n<tr>\n<td>S曲线</td>\n<td>$ y=e^{(a+\\frac{b}{x})} $</td>\n<td>1. 产品生命周期<br>   2. 技术采纳曲线<br>   3. 市场渗透过程</td>\n<td>• 描述完整生长周期<br>   • 有拐点<br>   • 最终趋于稳定</td>\n</tr>\n<tr>\n<td>逆函数</td>\n<td>$ y=a+\\frac{b}{x} $</td>\n<td>1. 引力与距离关系<br>   2. 工作效率与干扰频率<br>   3. 服务响应时间与并发数</td>\n<td>• 反比例关系<br>   • 快速衰减后趋稳<br>   • 适合渐近线模型</td>\n</tr>\n<tr>\n<td>逻辑函数</td>\n<td>$ y=\\frac{1}{\\frac{1}{u}+ab^x} $</td>\n<td>1. 人口增长（环境承载力）<br>   2. 市场饱和分析<br>   3. 疾病传播（考虑免疫）</td>\n<td>• 完整的S型曲线<br>   • 有明确上限u<br>   • 描述有限资源下的增长</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"4-实战演练谁能预测爆款视频的流量\">4. 实战演练：谁能预测“爆款视频”的流量？</h1>\n<p>最后，我们来看一个<strong>热点案例</strong>。</p>\n<p>假设你是一个短视频运营，你拿到了一款爆款视频发布后<strong>24小时内的累计播放量</strong>数据。</p>\n<p>你需要判断它的流量走势，以便决定是否追加推广预算。</p>\n<p>视频流量通常符合<strong>S型增长（逻辑函数）</strong>：</p>\n<ol>\n<li><strong>冷启动</strong>：没人看。</li>\n<li><strong>爆发期</strong>：被算法推荐，指数级增长。</li>\n<li><strong>饱和期</strong>：该看的人都看过了，增长停滞。</li>\n</ol>\n<p>如果不做分析，直接用线性回归（直线）去预测，后果可能是灾难性的（会预测出无限增长）。</p>\n<p>下面的代码尝试了<strong>线性回归</strong>和<strong>两种不同的非线性回归</strong>函数来分析。</p>\n<pre><code class=\"language-python\"># --- 模拟爆款视频数据 ---\nx_data = np.linspace(1, 24, 24) # 24小时\n# 真实数据模拟：符合逻辑函数分布，上限是100万播放量\ny_data = 100 / (1 + 100 * np.exp(-0.5 * (x_data - 10))) + np.random.normal(0, 2, 24)\n# y_data 单位是 万次播放\n\nplt.figure(figsize=(12, 8))\nplt.scatter(x_data, y_data, label='实际播放量', color='black', marker='o')\n\n# --- 挑战1：尝试用线性回归拟合 (错误的尝试) ---\npopt_lin, _ = curve_fit(lambda x, a, b: a*x+b, x_data, y_data)\ny_lin = popt_lin[0] * x_data + popt_lin[1]\nplt.plot(x_data, y_lin, 'g--', label='线性回归 (太简单了)')\n\n# --- 挑战2：尝试用指数函数拟合 (爆发期还可以，但无法预测饱和) ---\n# 指数函数容易溢出，选取部分数据或小心参数初始值，这里仅作演示\ntry:\n    popt_exp, _ = curve_fit(func_exponential, x_data, y_data, maxfev=5000)\n    y_exp = func_exponential(x_data, *popt_exp)\n    plt.plot(x_data, y_exp, 'y--', label='指数函数 (以为会一直涨)')\nexcept:\n    print(\"指数拟合失败，数据不符合指数特征\")\n\n# --- 挑战3：使用逻辑函数 (Logistic) 拟合 (最佳选择) ---\n# 逻辑函数公式较复杂，给一些初始猜测值(p0)会有帮助：上限u=100, a=100, b=0.5\n# 注意：上面的func_logistic形式需要调整以匹配scipy拟合的稳定性，\n# 这里我们使用一个更通用的Logistic形式用于演示：L / (1 + exp(-k(x-x0)))\ndef standard_logistic(x, L, k, x0):\n    return L / (1 + np.exp(-k * (x - x0)))\n\npopt_log, _ = curve_fit(standard_logistic, x_data, y_data, p0=[100, 0.5, 10])\ny_log = standard_logistic(x_data, *popt_log)\n\nplt.plot(x_data, y_log, 'r-', linewidth=3, label='逻辑函数 (完美拟合S型)')\n\n# --- 绘图美化 ---\nplt.title('爆款视频24小时播放量走势预测', fontsize=16)\nplt.xlabel('发布时间 (小时)')\nplt.ylabel('累计播放量 (万)')\nplt.legend()\nplt.grid(True, alpha=0.3)\nplt.show()\n\nprint(f\"预测结论：该视频的流量天花板大约在 {popt_log[0]:.1f} 万次左右。\")\n\n# 运行结果：\n'''\n预测结论：该视频的流量天花板大约在 97.7 万次左右。\n'''\n</code></pre>\n<p><img src=\"https://img2024.cnblogs.com/blog/83005/202512/83005-20251223150516522-114606272.png\" alt=\"\" loading=\"lazy\"></p>\n<p>从图中可以看出：</p>\n<ul>\n<li><strong>绿线（线性）</strong>：完全无法捕捉爆发的趋势，早期预测偏高，中期预测偏低，晚期预测又偏低。</li>\n<li><strong>黄线（指数）</strong>：在视频爆发初期（前10小时）拟合得很好，但它会预测24小时后播放量破亿，这显然不符合实际（因为受众是有限的）。</li>\n<li><strong>红线（逻辑函数）</strong>：完美地贴合了数据，不仅抓住了爆发期，还成功预测了流量的“天花板”（饱和点）。</li>\n</ul>\n<h1 id=\"5-总结如何选择回归模型\">5. 总结：如何选择回归模型？</h1>\n<p><strong>回归分析</strong>不仅是数据分析师工具箱中的基础工具，更是连接<strong>数据</strong>与<strong>业务</strong>的桥梁。</p>\n<p>作为一名数据分析师，选择哪种回归模型，最终还是要根据<strong>数据和业务</strong>的情况来决定。</p>\n<ol>\n<li><strong>先看图</strong>：拿到数据，先用 <code>plt.scatter()</code> 画散点图。\n<ul>\n<li>看着像直线？ -&gt; 线性回归。</li>\n<li>看着像抛物线？ -&gt; 二次函数。</li>\n<li>看着像先慢后快？ -&gt; 指数函数。</li>\n<li>看着像S型？ -&gt; 逻辑函数。</li>\n</ul>\n</li>\n<li><strong>看业务</strong>：\n<ul>\n<li>只要是涉及“资源有限”、“市场饱和”的，多半是 S曲线 或 对数函数。</li>\n<li>只要是涉及“病毒传播”、“裂变”的，初期多半是 指数函数。</li>\n</ul>\n</li>\n<li><strong>看误差</strong>：\n<ul>\n<li>用 $ R^2 $ 或 均方误差（MSE）来评估，哪个模型误差小，就选哪个。</li>\n</ul>\n</li>\n</ol>\n<p><strong>回归分析</strong>并不难，难的是<strong>理解业务背后的逻辑</strong>，并选择正确的数学模型去描述它。</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\" data-last-update-days=\"0\" data-date-updated=\"2025-12-23 15:08\">2025-12-23 15:07</span>&nbsp;\n<a href=\"https://www.cnblogs.com/wang_yb\">wang_yb</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"AddToWz(19387176);return false;\">收藏</a>&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19387176', targetLink: 'https://www.cnblogs.com/wang_yb/p/19387176', title: '拒绝“凭感觉”：用回归分析看透数据背后的秘密' })\">举报</a>\n</div>","guid":{"value":"e8998615c414a1067483278822f9cf47"}},{"title":"Oracle数据库初始化参数深度解析：部分说明与隐藏参数实战","link":"https://www.cnblogs.com/liuziyi1/p/19387152","description":"<h2>\n\t\t\t<a id=\"cb_post_title_url\" class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/liuziyi1/p/19387152\" title=\"发布于 2025-12-23 15:02\">\n    <span role=\"heading\" aria-level=\"2\">Oracle数据库初始化参数深度解析：部分说明与隐藏参数实战</span>\n    \n\n</a>\n\n\t\t</h2>\n\t\t<div id=\"cnblogs_post_body\" class=\"blogpost-body cnblogs-markdown\">\n<h2 id=\"引言\">引言</h2>\n<p>Oracle数据库的初始化参数是配置实例运行特性的核心，直接影响数据库的安全性、性能、可用性等关键指标。在庞大的参数体系中，部分参数仅在文档中得到部分说明，另有大量隐藏参数（以下划线开头）未被官方文档详细记载。这些参数往往包含Oracle数据库的“底层机密”，合理运用能解决常规配置无法处理的问题——从精细化审计到内存优化，从故障诊断到测试环境搭建。</p>\n<h2 id=\"一部分说明的初始化参数\">一、部分说明的初始化参数</h2>\n<h3 id=\"11-audit_syslog_level安全审计的进阶配置\">1.1 AUDIT_SYSLOG_LEVEL：安全审计的进阶配置</h3>\n<h4 id=\"核心功能\">核心功能</h4>\n<p>AUDIT_SYSLOG_LEVEL参数用于将数据库审计日志写入操作系统的syslog（UNIX）或事件日志（Windows），核心价值是避免特权用户删除审计记录——syslog日志默认由root用户所有，DBA无法篡改，能有效追踪特权操作与入侵行为。</p>\n<h4 id=\"文档说明的局限性\">文档说明的局限性</h4>\n<p>官方文档存在三点不准确描述：</p>\n<ul>\n<li>错误宣称该参数依赖AUDIT_TRAIL设置，实际即使AUDIT_TRAIL=NONE，CONNECT、STARTUP、SHUTDOWN操作仍会通过syslog记录；</li>\n<li>未说明与AUDIT_SYS_OPERATIONS的协同作用——两者结合时，SYSDBA/SYSOPER特权用户的所有SQL/PLSQL操作都会被审计；</li>\n<li>未明确设备与优先级的有效组合，无效组合会触发ORA-28错误并阻止实例启动。</li>\n</ul>\n<h4 id=\"实战配置示例\">实战配置示例</h4>\n<ol>\n<li><strong>UNIX系统配置</strong>：\n<ul>\n<li>编辑syslog.conf文件，添加日志输出规则：<code>user.notice /var/log/oracle_dbms</code>；</li>\n<li>重启syslogd服务：<code>kill -HUP $(cat /var/run/syslogd.pid)</code>；</li>\n<li>设置数据库参数：<code>ALTER SYSTEM SET audit_syslog_level='user.notice' SCOPE=SPFILE;</code>（需重启实例生效）。</li>\n</ul>\n</li>\n<li><strong>Windows系统配置</strong>：\n<ul>\n<li>无需额外配置syslog，参数会自动将日志写入“应用程序”类别的Windows事件日志；</li>\n<li>启用特权操作审计：<code>ALTER SYSTEM SET audit_sys_operations=TRUE;</code>。</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"关键注意事项\">关键注意事项</h4>\n<ul>\n<li>非特权用户审计优先使用AUDIT_TRAIL=DB，审计记录存储于SYS.AUD$，便于通过数据字典视图查询；</li>\n<li>维护操作（如数据库升级）时可临时设置AUDIT_SYS_OPERATIONS=FALSE，避免生成大量冗余日志。</li>\n</ul>\n<h3 id=\"12-pga_aggregate_target自动pga内存管理的底层逻辑\">1.2 PGA_AGGREGATE_TARGET：自动PGA内存管理的底层逻辑</h3>\n<h4 id=\"核心功能-1\">核心功能</h4>\n<p>PGA_AGGREGATE_TARGET是自动PGA内存管理的核心参数，指定所有服务器进程PGA内存的总目标值，用于优化排序、哈希连接等操作的内存分配。</p>\n<h4 id=\"文档未说明的关键机制\">文档未说明的关键机制</h4>\n<p>官方文档未披露三个隐藏参数对PGA分配的限制，这是导致实际内存使用与预期不符的核心原因：</p>\n<ul>\n<li>_PGA_MAX_SIZE：单个进程可使用的最大PGA内存（字节），默认值随PGA_AGGREGATE_TARGET动态调整（如PAT&lt;1GB时默认200MB）；</li>\n<li>_SMM_MAX_SIZE：单个串行操作的最大工作区大小（千字节），默认值为PGA_AGGREGATE_TARGET的20%（PAT&lt;512MB时）；</li>\n<li>_SMM_PX_MAX_SIZE：并行执行的最大工作区大小（千字节），默认值为PGA_AGGREGATE_TARGET的50%。</li>\n</ul>\n<h4 id=\"实战优化示例\">实战优化示例</h4>\n<ol>\n<li><strong>查询隐藏参数当前值</strong>：<pre><code class=\"language-sql\">SELECT x.ksppinm name,\n       CASE WHEN x.ksppinm LIKE '%pga%' THEN to_number(y.ksppstvl)/1024 ELSE to_number(y.ksppstvl) END AS value,\n       x.ksppdesc description\nFROM x$ksppi x, x$ksppcv y\nWHERE x.inst_id = userenv('Instance')\n  AND y.inst_id = userenv('Instance')\n  AND x.indx = y.indx\n  AND x.ksppinm IN ('_pga_max_size', '_smm_max_size', '_smm_px_max_size');\n</code></pre>\n</li>\n<li><strong>调整并行执行内存限制</strong>：\n<ul>\n<li>若并行排序频繁溢出到磁盘，可手动增大_SMM_PX_MAX_SIZE：<br>\n<code>ALTER SYSTEM SET \"_smm_px_max_size\"=2097152 SCOPE=SPFILE;</code>（2GB，需重启实例）。</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"关键注意事项-1\">关键注意事项</h4>\n<ul>\n<li>PGA_AGGREGATE_TARGET是“目标值”而非“硬限制”，高负载下实际内存使用可能临时超出；</li>\n<li>共享服务器模式下，Oracle 10g及以上支持自动PGA管理，Oracle 9i需手动配置SORT_AREA_SIZE等参数。</li>\n</ul>\n<h3 id=\"13-event实例级事件配置的灵活运用\">1.3 EVENT：实例级事件配置的灵活运用</h3>\n<h4 id=\"核心功能-2\">核心功能</h4>\n<p>EVENT参数用于在实例级别设置事件，适用于故障诊断、功能启用/禁用、性能数据收集等场景，配置在实例生命周期内持续有效。</p>\n<h4 id=\"文档未说明的关键内容\">文档未说明的关键内容</h4>\n<ul>\n<li>事件语法：支持多事件配置（分号分隔），语法为<code>event='event_number trace name context forever,level event_level'</code>；</li>\n<li>有效事件范围：多数事件编号在10000-10999之间，可通过<code>oerr ora &lt;事件号&gt;</code>查询描述；</li>\n<li>实例级事件的适用场景：需在进程启动时生效的事件（如RMAN备份相关事件）、全实例范围的跟踪（如SQL跟踪）。</li>\n</ul>\n<h4 id=\"实战配置示例-1\">实战配置示例</h4>\n<ol>\n<li><strong>启用死锁诊断事件</strong>：\n<ul>\n<li>设置事件10027（控制死锁跟踪信息级别）：<code>ALTER SYSTEM SET events='10027 trace name context forever,level 2' SCOPE=SPFILE;</code></li>\n<li>级别2会包含系统状态转储，便于定位死锁根源。</li>\n</ul>\n</li>\n<li><strong>临时禁用某优化器特性</strong>：\n<ul>\n<li>关闭索引跳跃扫描：<code>ALTER SYSTEM SET events='10196 trace name context forever,level 1';</code></li>\n</ul>\n</li>\n</ol>\n<h4 id=\"关键注意事项-2\">关键注意事项</h4>\n<ul>\n<li>避免在实例级别设置事件10046（SQL跟踪），会产生大量跟踪文件，建议使用会话级或DBMS_MONITOR包；</li>\n<li>事件配置需在Oracle Support指导下进行，部分事件可能影响数据库稳定性。</li>\n</ul>\n<h3 id=\"14-os_authent_prefix操作系统与密码文件认证的结合\">1.4 OS_AUTHENT_PREFIX：操作系统与密码文件认证的结合</h3>\n<h4 id=\"核心功能-3\">核心功能</h4>\n<p>OS_AUTHENT_PREFIX指定操作系统身份认证的用户名前缀，默认值为“ops$”，文档未说明其支持“操作系统认证+密码文件认证”的混合模式。</p>\n<h4 id=\"文档未说明的关键特性\">文档未说明的关键特性</h4>\n<p>当OS_AUTHENT_PREFIX为默认值“ops$”时，以“ops$”为前缀的数据库用户（如ops$ndebes）可：</p>\n<ul>\n<li>本地连接时无需密码（操作系统身份认证）；</li>\n<li>远程连接时使用密码文件认证（需设置REMOTE_OS_AUTHENT=FALSE）；</li>\n<li>被授予SYSDBA/SYSOPER特权，无需加入操作系统DBA/OPER用户组。</li>\n</ul>\n<h4 id=\"实战配置示例-2\">实战配置示例</h4>\n<ol>\n<li><strong>创建混合模式用户</strong>：<pre><code class=\"language-sql\">CREATE USER ops$ndebes IDENTIFIED BY secret;\nGRANT CONNECT, SYSOPER TO ops$ndebes;\n</code></pre>\n</li>\n<li><strong>本地无密码连接</strong>：\n<ul>\n<li>操作系统用户ndebes执行：<code>sqlplus /</code>，自动以ops$ndebes身份登录；</li>\n</ul>\n</li>\n<li><strong>远程密码连接</strong>：\n<ul>\n<li><code>sqlplus ops$ndebes/secret@ten.oradbpro.com</code>。</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"关键注意事项-3\">关键注意事项</h4>\n<ul>\n<li>安全敏感环境可修改前缀（如<code>ALTER SYSTEM SET os_authent_prefix='' SCOPE=SPFILE;</code>），禁用混合认证；</li>\n<li>外部验证用户（IDENTIFIED EXTERNALLY）无法使用密码文件认证，需根据需求选择认证方式。</li>\n</ul>\n<h2 id=\"二隐藏的初始化参数\">二、隐藏的初始化参数</h2>\n<h3 id=\"21-_trace_files_public跟踪文件权限控制\">2.1 _TRACE_FILES_PUBLIC：跟踪文件权限控制</h3>\n<h4 id=\"核心功能-4\">核心功能</h4>\n<p>_TRACE_FILES_PUBLIC参数控制新生成的SQL跟踪文件的访问权限，默认值为FALSE（仅Oracle安装用户和所属组可读取）。</p>\n<h4 id=\"实战应用场景\">实战应用场景</h4>\n<p>测试环境中，开发人员需自行分析SQL跟踪文件（如使用TKPROF），可通过以下配置开放权限：</p>\n<ol>\n<li>设置参数：<code>ALTER SYSTEM SET \"_trace_files_public\"=TRUE SCOPE=SPFILE;</code></li>\n<li>重启实例后，新生成的跟踪文件权限为“rw-r--r--”，所有系统用户均可读取。</li>\n</ol>\n<h4 id=\"关键注意事项-4\">关键注意事项</h4>\n<ul>\n<li>生产环境不建议启用，避免跟踪文件中的敏感信息（如绑定变量值）泄露；</li>\n<li>仅影响新生成的跟踪文件，历史文件权限需手动修改。</li>\n</ul>\n<h3 id=\"22-_asm_allow_only_raw_disksasm测试环境搭建\">2.2 _ASM_ALLOW_ONLY_RAW_DISKS：ASM测试环境搭建</h3>\n<h4 id=\"核心功能-5\">核心功能</h4>\n<p>_ASM_ALLOW_ONLY_RAW_DISKS参数控制ASM是否仅支持裸设备，默认值为TRUE，文档未说明其可禁用该限制，便于在无裸设备的环境中搭建ASM测试环境。</p>\n<h4 id=\"实战配置步骤\">实战配置步骤</h4>\n<ol>\n<li><strong>创建模拟磁盘文件</strong>（Windows系统）：\n<ul>\n<li>使用asmtool工具：<code>asmtool -create C:\\oradata\\ARRAY1_DISK1 512</code>（创建512MB的模拟磁盘）；</li>\n</ul>\n</li>\n<li><strong>配置ASM实例参数文件</strong>（pfile+ASM.ora）：<pre><code>instance_type=ASM\nasm_diskstring='c:\\oradata\\*'\n_asm_allow_only_raw_disks=FALSE\n</code></pre>\n</li>\n<li><strong>启动ASM实例并创建磁盘组</strong>：<pre><code class=\"language-sql\">STARTUP NOMOUNT PFILE='C:\\ORACLE\\PRODUCT\\DB10.2\\DATABASE\\pfile+ASM.ora';\nCREATE DISKGROUP cooked_dg NORMAL REDUNDANCY\nFAILGROUP array1 DISK 'C:\\ORADATA\\ARRAY1_DISK1' NAME array1_disk1,\nFAILGROUP array2 DISK 'C:\\ORADATA\\ARRAY2_DISK1' NAME array2_disk1;\n</code></pre>\n</li>\n</ol>\n<h4 id=\"关键注意事项-5\">关键注意事项</h4>\n<ul>\n<li>仅适用于测试环境，生产环境建议使用裸设备或SAN存储，确保性能与稳定性；</li>\n<li>可通过该环境模拟磁盘失效（如拔掉USB存储设备），测试ASM故障恢复能力。</li>\n</ul>\n<h2 id=\"三总结与最佳实践\">三、总结与最佳实践</h2>\n<p>Oracle数据库的部分说明参数与隐藏参数是解决复杂问题的“利器”，但使用时需遵循以下原则：</p>\n<ol>\n<li><strong>安全优先</strong>：涉及审计、认证的参数（如AUDIT_SYSLOG_LEVEL、OS_AUTHENT_PREFIX）需结合企业安全策略配置，避免权限泄露；</li>\n<li><strong>性能可控</strong>：PGA相关隐藏参数的调整需通过测试验证，避免盲目增大内存导致系统分页；</li>\n<li><strong>环境区分</strong>：隐藏参数（如_TRACE_FILES_PUBLIC、_ASM_ALLOW_ONLY_RAW_DISKS）优先在测试环境使用，生产环境需谨慎评估；</li>\n<li><strong>文档补充</strong>：配置参数前需结合官方Metalink文档与实际测试，避免依赖未公开特性导致升级风险。</li>\n</ol>\n\n</div>\n<div class=\"clear\"></div>\n\n\t\t<p class=\"postfoot\">\n\t\t\tposted on \n<span id=\"post-date\" data-last-update-days=\"0\" data-date-updated=\"2025-12-23 15:03\">2025-12-23 15:02</span>&nbsp;\n<a href=\"https://www.cnblogs.com/liuziyi1\">刘子毅</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"AddToWz(19387152);return false;\">收藏</a>&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19387152', targetLink: 'https://www.cnblogs.com/liuziyi1/p/19387152', title: 'Oracle数据库初始化参数深度解析：部分说明与隐藏参数实战' })\">举报</a>\n\n\t\t</p>","guid":{"value":"65d88f29a3074b712d45532a623387a8"}},{"title":"突发，快手被色情直播刷屏！背后的原因竟然是？","link":"https://www.cnblogs.com/yupi/p/19387143","description":"<h1 class=\"postTitle\">\n                <a id=\"cb_post_title_url\" class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/yupi/p/19387143\" title=\"发布于 2025-12-23 15:01\">\n    <span role=\"heading\" aria-level=\"2\">突发，快手被色情直播刷屏！背后的原因竟然是？</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none\">\n        <img src=\"https://img2024.cnblogs.com/blog/2225420/202512/2225420-20251223144235489-1942972685.png\" alt=\"突发，快手被色情直播刷屏！背后的原因竟然是？\" class=\"desc_img\">\n        毕竟网络安全是一个复杂的系统工程，可能涉及多个环节的漏洞，也可能是多种攻击手段的组合\n    </div>\n<div id=\"cnblogs_post_body\" class=\"blogpost-body blogpost-body-html\">\n<p class=\"md-end-block md-heading\"><span class=\"md-plain\">2025 年 12 月 22 日晚上 11 点半，快手突然出现大量涩涩直播。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/85\"><img data-src=\"https://pic.yupi.icu/1/85\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">平台的审核系统形同虚设、用户举报和封禁都处理不过来、违规内容如潮水般爆发增长，有的直播间观看人数甚至超过 10 万。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/%E8%BF%9D%E8%A7%84%E5%86%85%E5%AE%B9%E4%B8%AD.jpeg\"><img data-src=\"https://pic.yupi.icu/1/%E8%BF%9D%E8%A7%84%E5%86%85%E5%AE%B9%E4%B8%AD.jpeg\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">快手不得不在凌晨 <span class=\"md-pair-s \"><strong>直接切断整个直播功能</strong><span class=\"md-plain\"> 来止损，过了半个多小时才逐渐恢复。妥妥的 P0 级事故了！</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/%E5%BF%AB%E6%89%8B%E5%87%8C%E6%99%A8%E5%88%87%E6%96%AD%E7%9B%B4%E6%92%AD%E4%B8%AD.jpeg\"><img data-src=\"https://pic.yupi.icu/1/%E5%BF%AB%E6%89%8B%E5%87%8C%E6%99%A8%E5%88%87%E6%96%AD%E7%9B%B4%E6%92%AD%E4%B8%AD.jpeg\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">据说快手 APP 直接冲到了苹果应用商店的免费榜第 2：</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/APP%20%E5%85%8D%E8%B4%B9%E6%A6%9C%E5%A4%A7.jpeg\"><img data-src=\"https://pic.yupi.icu/1/APP%20%E5%85%8D%E8%B4%B9%E6%A6%9C%E5%A4%A7.jpeg\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">还有网友放出几百万名老用户回归快手的截图：</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/1766453438148-1ef63bfd-659f-42bb-b812-9604380dbdfa.png\"><img data-src=\"https://pic.yupi.icu/1/1766453438148-1ef63bfd-659f-42bb-b812-9604380dbdfa.png\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">各位老司机疯狂玩梗，什么网络问题衣服没加载出来之类的…… 果然涩涩是第一生产力。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/%E7%BD%91%E5%8F%8B%E7%8E%A9%E6%A2%97.png\"><img data-src=\"https://pic.yupi.icu/1/%E7%BD%91%E5%8F%8B%E7%8E%A9%E6%A2%97.png\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/6b743b45366be0026d80a802070362e22147031145.jpg\"><img alt=\"估计是 AI 生成的\" data-src=\"https://pic.yupi.icu/1/6b743b45366be0026d80a802070362e22147031145.jpg\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">有同学问我怎么现在才发这篇文章，因为我在下载快手，今夜无眠啊。（狗头）</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">快手官方当时给出了紧急回应：2025 年 12 月 22 日 22 时左右，平台遭到黑灰产攻击，已经向警方报案，目前正在紧急处理修复中。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/%E5%BF%AB%E6%89%8B%E5%AE%98%E6%96%B9%E7%B4%A7%E6%80%A5%E5%9B%9E%E5%BA%94%E4%B8%AD.jpeg\"><img data-src=\"https://pic.yupi.icu/1/%E5%BF%AB%E6%89%8B%E5%AE%98%E6%96%B9%E7%B4%A7%E6%80%A5%E5%9B%9E%E5%BA%94%E4%B8%AD.jpeg\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">那么问题来了：快手到底遭遇了什么攻击？黑灰产是怎么做到的？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">作为一名程序员（不是老司机），下面从技术的角度带大家分析一下 <span class=\"md-pair-s \"><strong>可能的原因</strong><span class=\"md-plain\">。</span></span></span></p>\n<blockquote>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">本文对应视频版：<span class=\"md-link md-pair-s\"><a href=\"https://bilibili.com/video/BV1sQBPBmEGU\" rel=\"noopener nofollow\">https://bilibili.com/video/BV1sQBPBmEGU</a></span></span></p>\n</blockquote>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">什么是黑灰产？</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">先给大家科普一下什么是黑灰产。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">黑灰产是 <span class=\"md-pair-s \"><strong>黑色产业</strong><span class=\"md-plain\"> 和 <span class=\"md-pair-s \"><strong>灰色产业</strong><span class=\"md-plain\"> 的统称，指的是利用技术手段进行违法犯罪活动的产业链。</span></span></span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">黑产就是明确违法的，比如网络诈骗、盗号、贩卖个人信息等；灰产则是游走在法律边缘的，比如刷量、养号、接码平台等。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">这些产业往往形成完整的产业链，分工明确，有人负责技术攻击，有人负责提供工具，有人负责销赃变现。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/%E9%BB%91%E7%81%B0%E4%BA%A7.png\"><img data-src=\"https://pic.yupi.icu/1/%E9%BB%91%E7%81%B0%E4%BA%A7.png\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">对于这次快手事件，主要有 2 个疑点：</span></p>\n<ol class=\"ol-list\" start=\"\">\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">为什么大量账号能在同一时段集体开播？</span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">为什么违规内容能被推送到用户眼前？</span></p>\n</li>\n</ol>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">我们就从这 2 个角度来分析，黑灰产可能用了哪些技术手段。</span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">可能性 1、批量注册 + 绕过实名认证</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">首先，大量账号在同一时段集体开播违规内容，符合自动化的特征。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">那么这些账号从哪儿来呢？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">我觉得可能是黑灰产通过 <span class=\"md-pair-s \"><strong>接码平台</strong><span class=\"md-plain\"> 批量注册了大量账号，并绕过了实名认证。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">什么是接码平台？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">简单来说，就是提供临时手机号码接收验证码的服务。一般来说，注册账号时需要手机验证码，假如你想注册多个账号、但是没有多个手机号，那接码平台就能帮你搞定，而且价格便宜，几毛钱就能接一条验证码。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">黑灰产可以通过接码平台，批量注册成千上万个快手账号。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/%25E6%258E%25A5%25E7%25A0%2581%25E5%25B9%25B3%25E5%258F%25B0.png\"><img data-src=\"https://pic.yupi.icu/1/%E6%8E%A5%E7%A0%81%E5%B9%B3%E5%8F%B0.png\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">但注册只是第一步，他们还需要绕过实名认证。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">有一种可能是他们先从黑市购买他人的身份信息和人脸照片，然后利用技术手段伪造视频（比如 AI 换脸、虚拟摄像头），骗过了人脸识别系统。这就是为什么平台的实名制虽然能提高门槛，但依然无法完全杜绝黑灰产。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/%E9%BB%91%E7%81%B0%E4%BA%A7%E7%BB%95%E8%BF%87%E5%AE%9E%E5%90%8D.png\"><img data-src=\"https://pic.yupi.icu/1/%E9%BB%91%E7%81%B0%E4%BA%A7%E7%BB%95%E8%BF%87%E5%AE%9E%E5%90%8D.png\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">还有一种可能，如果快手接入了第三方实名认证服务，这些服务的接口存在漏洞，就可能被利用和绕过。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8E%A5%E5%8F%A3%E6%BC%8F%E6%B4%9E.png\"><img data-src=\"https://pic.yupi.icu/1/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8E%A5%E5%8F%A3%E6%BC%8F%E6%B4%9E.png\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">可能性 2、攻击审核 / 封禁系统</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">为什么违规内容能被推送到用户眼前呢？为什么没有及时封禁呢？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">根据一些媒体报道，快手直播间当时弹出了官方弹幕：封禁接口被攻击了，在处理中。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/%E5%B0%81%E7%A6%81%E6%8E%A5%E5%8F%A3%E8%A2%AB%E6%94%BB%E5%87%BB.jpg\"><img data-src=\"https://pic.yupi.icu/1/%E5%B0%81%E7%A6%81%E6%8E%A5%E5%8F%A3%E8%A2%AB%E6%94%BB%E5%87%BB.jpg\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">这说明黑灰产可能攻击了快手的封禁系统，一种常见的手段是 DDoS 攻击。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">DDoS（Distributed Denial of Service）是 <span class=\"md-pair-s \"><strong>分布式拒绝服务攻击</strong><span class=\"md-plain\">。作为一个网站经常被攻击的悲惨程序员，这我可太熟了……</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">简单来说，就是黑客控制大量的电脑或设备，同时向目标服务器发送海量请求，把服务器的资源耗尽，导致正常服务无法运行。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">想象一下，一家餐厅本来能正常接待客人，结果突然来了一大群人，把餐厅挤得水泄不通，真正想吃饭的客人反而都进不去了。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/ddos%E6%94%BB%E5%87%BB.png\"><img data-src=\"https://pic.yupi.icu/1/ddos%E6%94%BB%E5%87%BB.png\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">如果黑灰产对快手的封禁或审核系统发起了 DDoS 攻击，就会导致这些系统瘫痪或者响应缓慢。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">具体来说，平台的内容审核分为 <span class=\"md-pair-s \"><strong>机器审核</strong><span class=\"md-plain\"> 和 <span class=\"md-pair-s \"><strong>人工审核</strong><span class=\"md-plain\"> 两部分。一般机器审核负责初筛，人工审核负责复核。</span></span></span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">如果审核系统被攻击，导致审核接口被打挂，机器审核就会直接放行内容，人工审核根本处理不过来。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">而如果封禁系统被攻击，就没办法及时封禁违规内容和用户。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/ddos.png\"><img data-src=\"https://pic.yupi.icu/1/ddos.png\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">所以最终快手不得不采取 “无差别关停” 的极端措施，直接切断整个直播功能来止损。</span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">可能性 3、直播推流接口漏洞</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">还有第 3 种可能，黑灰产利用了 <span class=\"md-pair-s \"><strong>直播推流接口</strong><span class=\"md-plain\"> 的底层漏洞。</span></span></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">什么是推流？</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">推流就是把直播内容从主播端推送到服务器的过程。你可以把它理解成 “上传直播画面”。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">主播开播时，手机或电脑会通过推流接口，把音视频数据实时传输到快手的服务器，然后服务器再分发给观众。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/%E6%8E%A8%E6%B5%81.png\"><img data-src=\"https://pic.yupi.icu/1/%E6%8E%A8%E6%B5%81.png\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">有技术人员分析，攻击者可能利用了推流接口的漏洞，绕过了平台的实名认证和内容审核。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">简单来说就是 “骗、抢、绕”：伪造合法凭证骗过系统、劫持正常通道抢占资源、利用漏洞绕过审核。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">这样一来，攻击者可以批量、自动化地推送违规内容，而且很难被及时发现和拦截。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">这也解释了为什么这次事件中，大量账号能在同一时段集体开播，播放预制的非法视频。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/%E6%8E%A8%E6%B5%81%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB.png\"><img data-src=\"https://pic.yupi.icu/1/%E6%8E%A8%E6%B5%81%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB.png\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">写在最后</span></h2>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">这次快手事件，官方定性为 “遭到网络攻击”，但具体的攻击手段和技术细节，目前还没有公开。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-image md-img-loaded\" data-src=\"https://pic.yupi.icu/1/%E5%BF%AB%E6%89%8B%E6%AD%A3%E5%BC%8F%E5%A3%B0%E6%98%8E.webp\"><img data-src=\"https://pic.yupi.icu/1/%E5%BF%AB%E6%89%8B%E6%AD%A3%E5%BC%8F%E5%A3%B0%E6%98%8E.webp\" class=\"lazyload\"></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-pair-s\"><strong>所以我也只是结合网上的信息和自身的一些知识经验，给大家从多个角度分析可能的原因，科普一些真实存在的攻击方式。</strong></span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">有网友质疑说，真正的黑客是低调行事、以获利为目的的，这种高调的攻击更像是内鬼或者炫技。也有人说，超过 1 小时才处理完，反应速度确实有点慢。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">这些质疑都有道理，毕竟网络安全是一个复杂的系统工程，可能涉及多个环节的漏洞，也可能是多种攻击手段的组合，甚至可能是内外勾结、社会工程等等。</span></p>\n<p class=\"md-end-block md-p\"><span class=\"md-plain\">希望快手能尽快查明真相，给大家一个交代。</span></p>\n<p class=\"md-end-block md-p\">&nbsp;</p>\n<h2 class=\"md-end-block md-heading\"><span class=\"md-plain\">更多编程学习资源</span></h2>\n<ul class=\"ul-list\" data-mark=\"-\">\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/course\" rel=\"noopener nofollow\"><span class=\"md-plain\">Java前端程序员必做项目实战教程+毕设网站</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/\" rel=\"noopener nofollow\"><span class=\"md-plain\">程序员免费编程学习交流社区（自学必备）</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/course/cv\" rel=\"noopener nofollow\"><span class=\"md-plain\">程序员保姆级求职写简历指南（找工作必备）</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.mianshiya.com/\" rel=\"noopener nofollow\"><span class=\"md-plain\">程序员免费面试刷题网站工具（找工作必备）</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640584449888772098\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新Java零基础入门学习路线 + Java教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640586673306091521\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新Python零基础入门学习路线 + Python教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640586014108303362\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新前端零基础入门学习路线 + 前端教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640586867363954689\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新数据结构和算法零基础入门学习路线 + 算法教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1644279832026075138\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新C++零基础入门学习路线、C++教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1641797333479903234\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新数据库零基础入门学习路线 + 数据库教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640589994284695553\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新Redis零基础入门学习路线 + Redis教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1641035880439271426\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新计算机基础入门学习路线 + 计算机基础教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1641366118197153793\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新小程序入门学习路线 + 小程序开发教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"http://sqlmother.yupi.icu/\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新SQL零基础入门学习路线 + SQL教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640586295529324545\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新Linux零基础入门学习路线 + Linux教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640588753362108417\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新Git/GitHub零基础入门学习路线 + Git教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640587909942099969\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新操作系统零基础入门学习路线 + 操作系统教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640588119619551233\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新计算机网络零基础入门学习路线 + 计算机网络教程</span></a></span></p>\n</li>\n<li class=\"md-list-item\">\n<p class=\"md-end-block md-p\"><span class=\"md-meta-i-c  md-link\"><a href=\"https://www.code-nav.cn/post/1640588392073150465\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新设计模式零基础入门学习路线 + 设计模式教程</span></a></span></p>\n</li>\n<li class=\"md-list-item md-focus-container\">\n<p class=\"md-end-block md-p md-focus\"><span class=\"md-meta-i-c md-link md-expand\"><a href=\"https://www.code-nav.cn/post/1640648711119892481\" rel=\"noopener nofollow\"><span class=\"md-plain\">最新软件工程零基础入门学习路线 + 软件工程教程</span></a></span></p>\n</li>\n</ul>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\" data-last-update-days=\"0\" data-date-updated=\"2025-12-23 15:01\">2025-12-23 15:01</span>&nbsp;\n<a href=\"https://www.cnblogs.com/yupi\">程序员鱼皮</a>&nbsp;\n阅读(<span id=\"post_view_count\">36</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"AddToWz(19387143);return false;\">收藏</a>&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19387143', targetLink: 'https://www.cnblogs.com/yupi/p/19387143', title: '突发，快手被色情直播刷屏！背后的原因竟然是？' })\">举报</a>\n</div>","guid":{"value":"e544737ff2a10ebe6be54ca2cd239967"}},{"title":"Spring Boot WebSocket方案终极指南：Netty与官方Starter对比与实践","link":"https://www.cnblogs.com/xzqcsj/p/19386695","description":"<h1 class=\"postTitle\">\n                <a id=\"cb_post_title_url\" class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xzqcsj/p/19386695\" title=\"发布于 2025-12-23 13:50\">\n    <span role=\"heading\" aria-level=\"2\">Spring Boot WebSocket方案终极指南：Netty与官方Starter对比与实践</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                    <div id=\"cnblogs_post_description\" style=\"display: none\">\n        <img src=\"https://img2024.cnblogs.com/blog/3703499/202512/3703499-20251223134926113-1968621748.png\" alt=\"Spring Boot WebSocket方案终极指南：Netty与官方Starter对比与实践\" class=\"desc_img\">\n        Spring Boot WebSocket方案终极指南：Netty vs 官方Starter对比与实践\n    </div>\n<div id=\"cnblogs_post_body\" class=\"blogpost-body cnblogs-markdown\">\n<h3 id=\"一maven依赖引入\">一、Maven依赖引入</h3>\n<h4 id=\"1-netty-websocket-spring-boot-starter\">1. Netty-WebSocket-Spring-Boot-Starter</h4>\n<pre><code class=\"language-xml\">&lt;dependency&gt;\n    &lt;groupId&gt;org.yeauty&lt;/groupId&gt;\n    &lt;artifactId&gt;netty-websocket-spring-boot-starter&lt;/artifactId&gt;\n    &lt;version&gt;0.13.0&lt;/version&gt; &lt;!-- 请使用最新版本 --&gt;\n&lt;/dependency&gt;\n</code></pre>\n<h4 id=\"2-spring官方websocket-starter\">2. Spring官方WebSocket Starter</h4>\n<pre><code class=\"language-xml\">&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre>\n<h3 id=\"二核心差异对比\">二、核心差异对比</h3>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>Netty-WebSocket</th>\n<th>Spring官方Starter</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>底层框架</strong></td>\n<td>Netty NIO框架 (非阻塞IO)</td>\n<td>Servlet容器 (Tomcat/Jetty)</td>\n</tr>\n<tr>\n<td><strong>协议支持</strong></td>\n<td>原生WebSocket + 自定义二进制协议</td>\n<td>WebSocket + STOMP消息协议</td>\n</tr>\n<tr>\n<td><strong>线程模型</strong></td>\n<td>Reactor多线程模型 (Boss/Worker)</td>\n<td>Servlet线程池模型</td>\n</tr>\n<tr>\n<td><strong>容器依赖</strong></td>\n<td>无 (可独立运行)</td>\n<td>必须依赖Servlet容器</td>\n</tr>\n<tr>\n<td><strong>编程范式</strong></td>\n<td>事件驱动模型 (类似Netty Handler)</td>\n<td>消息代理模型 (发布/订阅)</td>\n</tr>\n<tr>\n<td><strong>与Spring集成</strong></td>\n<td>中等 (需手动管理会话)</td>\n<td>深度集成 (自动配置+安全支持)</td>\n</tr>\n<tr>\n<td><strong>学习曲线</strong></td>\n<td>较陡峭 (需理解Netty概念)</td>\n<td>平缓 (Spring开发者友好)</td>\n</tr>\n<tr>\n<td><strong>适用场景</strong></td>\n<td>高频实时数据/自定义协议</td>\n<td>企业消息系统/标准文本通信</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"三使用场景决策指南\">三、使用场景决策指南</h3>\n<h4 id=\"-选择-netty-websocket-当\">✅ 选择 Netty-WebSocket 当：</h4>\n<ul>\n<li><strong>需要处理高频实时数据</strong>：金融行情推送、物联网传感器数据</li>\n<li><strong>使用自定义二进制协议</strong>：游戏数据包、音视频流传输</li>\n<li><strong>追求极致性能</strong>：要求1万+并发连接，低延迟响应</li>\n<li><strong>脱离Servlet容器</strong>：希望WebSocket服务独立部署</li>\n</ul>\n<h4 id=\"-选择-spring官方starter-当\">✅ 选择 Spring官方Starter 当：</h4>\n<ul>\n<li><strong>开发企业级消息系统</strong>：聊天应用、实时通知系统</li>\n<li><strong>需要完整STOMP支持</strong>：利用消息代理和订阅机制</li>\n<li><strong>快速集成Spring生态</strong>：与Security、Data等组件协作</li>\n<li><strong>兼容旧浏览器</strong>：需要SockJS回退支持</li>\n</ul>\n<h3 id=\"四核心代码实现对比\">四、核心代码实现对比</h3>\n<h4 id=\"方案1netty-websocket实现实时数据推送\">方案1：Netty-WebSocket实现（实时数据推送）</h4>\n<pre><code class=\"language-java\">@SpringBootApplication\n@EnableNettyWebSocket // 启用Netty WebSocket服务器\npublic class DataPushApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(DataPushApplication.class, args);\n    }\n}\n\n/**\n * 实时数据推送处理器\n * 特点：直接操作Session，手动管理连接\n */\n@ServerEndpoint(host = \"0.0.0.0\", port = \"8080\", path = \"/realtime\")\npublic class DataPushHandler {\n    \n    // 存储所有活动会话\n    private static final Set&lt;Session&gt; sessions = ConcurrentHashMap.newKeySet();\n\n    @OnOpen\n    public void onOpen(Session session) {\n        sessions.add(session);\n        session.sendText(\"CONNECTED|\" + LocalTime.now());\n    }\n\n    @OnText\n    public void onText(Session session, String message) {\n        // 处理文本消息（如控制指令）\n        String response = processCommand(message);\n        session.sendText(response);\n    }\n\n    @OnBinary\n    public void onBinary(Session session, byte[] bytes) {\n        // 解析二进制数据（如传感器数据）\n        SensorData data = SensorDecoder.decode(bytes);\n        // 处理数据逻辑...\n        byte[] response = SensorEncoder.encode(data);\n        session.sendBinary(response);\n    }\n\n    @OnClose\n    public void onClose(Session session, CloseReason reason) {\n        sessions.remove(session);\n    }\n    \n    // 广播数据给所有客户端\n    public static void broadcast(byte[] data) {\n        sessions.forEach(session -&gt; {\n            if (session.isOpen()) {\n                session.sendBinary(data);\n            }\n        });\n    }\n}\n</code></pre>\n<h4 id=\"方案2spring官方starter实现完整聊天室\">方案2：Spring官方Starter实现（完整聊天室）</h4>\n<pre><code class=\"language-java\">/**\n * WebSocket配置类\n * 特点：使用STOMP协议，配置消息代理\n */\n@Configuration\n@EnableWebSocketMessageBroker\npublic class ChatConfig implements WebSocketMessageBrokerConfigurer {\n\n    @Override\n    public void registerStompEndpoints(StompEndpointRegistry registry) {\n        // 客户端连接端点\n        registry.addEndpoint(\"/chat-ws\")\n                .setAllowedOriginPatterns(\"*\")\n                .withSockJS(); // 浏览器兼容支持\n    }\n\n    @Override\n    public void configureMessageBroker(MessageBrokerRegistry registry) {\n        // 启用内存消息代理\n        registry.enableSimpleBroker(\"/topic\", \"/queue\");\n        \n        // 设置应用消息前缀\n        registry.setApplicationDestinationPrefixes(\"/app\");\n        \n        // 设置用户私有队列前缀\n        registry.setUserDestinationPrefix(\"/user\");\n    }\n}\n\n/**\n * 聊天控制器\n * 特点：使用高级消息抽象，自动处理订阅\n */\n@Controller\npublic class ChatController {\n    \n    @Autowired\n    private SimpMessagingTemplate messagingTemplate;\n\n    // 处理公共聊天消息\n    @MessageMapping(\"/chat\")\n    @SendTo(\"/topic/messages\")\n    public ChatMessage handlePublicMessage(@Payload ChatMessage message, \n                                        Principal principal) {\n        message.setSender(principal.getName());\n        message.setTimestamp(LocalDateTime.now());\n        return message;\n    }\n\n    // 处理私有消息\n    @MessageMapping(\"/private\")\n    public void handlePrivateMessage(@Payload ChatMessage message, \n                                   Principal principal) {\n        message.setSender(principal.getName());\n        message.setTimestamp(LocalDateTime.now());\n        \n        // 定向发送给接收者\n        messagingTemplate.convertAndSendToUser(\n            message.getRecipient(), \n            \"/queue/private\", \n            message\n        );\n    }\n    \n    // 用户上线处理\n    @EventListener\n    public void handleConnect(SessionConnectedEvent event) {\n        String username = event.getUser().getName();\n        // 通知所有用户更新在线列表\n        messagingTemplate.convertAndSend(\"/topic/onlineUsers\", \n            userService.getOnlineUsers());\n    }\n}\n\n/**\n * 消息实体类\n */\npublic class ChatMessage {\n    private String sender;      // 发送者\n    private String recipient;   // 接收者（私聊使用）\n    private String content;     // 消息内容\n    private LocalDateTime timestamp; // 时间戳\n    \n    // getters &amp; setters\n}\n</code></pre>\n<h3 id=\"五关键差异解析\">五、关键差异解析</h3>\n<ol>\n<li>\n<p><strong>连接管理方式</strong></p>\n<ul>\n<li>Netty：手动维护<code>Session</code>集合，直接操作连接</li>\n<li>Spring：自动管理连接，通过<code>SimpMessagingTemplate</code>发送消息</li>\n</ul>\n</li>\n<li>\n<p><strong>消息处理模式</strong></p>\n<div class=\"mermaid\">graph LR\nA[客户端] --&gt; B{Netty方案}\nB --&gt; C[直接处理二进制数据]\nB --&gt; D[自定义协议解析]\n\nA --&gt; E{Spring方案}\nE --&gt; F[STOMP消息代理]\nE --&gt; G[发布/订阅模式]\n</div></li>\n<li>\n<p><strong>异常处理机制</strong></p>\n<ul>\n<li>Netty：通过<code>@OnError</code>捕获异常，需手动关闭问题会话</li>\n<li>Spring：全局异常处理器<code>@MessageExceptionHandler</code>统一处理</li>\n</ul>\n</li>\n<li>\n<p><strong>集群支持</strong></p>\n<ul>\n<li>Netty：需自行实现分布式会话管理（如Redis）</li>\n<li>Spring：天然支持通过消息代理（RabbitMQ/Redis）实现集群</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"六选型建议总结\">六、选型建议总结</h3>\n<table>\n<thead>\n<tr>\n<th>项目特征</th>\n<th>推荐方案</th>\n<th>理由说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>高频实时数据（&gt;1000 TPS）</td>\n<td>Netty-WebSocket</td>\n<td>低延迟、高吞吐量</td>\n</tr>\n<tr>\n<td>企业级聊天系统</td>\n<td>Spring官方Starter</td>\n<td>STOMP协议支持完善</td>\n</tr>\n<tr>\n<td>自定义二进制协议</td>\n<td>Netty-WebSocket</td>\n<td>直接操作字节数据</td>\n</tr>\n<tr>\n<td>需要SockJS兼容旧浏览器</td>\n<td>Spring官方Starter</td>\n<td>内置SockJS支持</td>\n</tr>\n<tr>\n<td>微服务架构中的独立服务</td>\n<td>Netty-WebSocket</td>\n<td>不依赖Servlet容器</td>\n</tr>\n<tr>\n<td>需要深度整合Spring Security</td>\n<td>Spring官方Starter</td>\n<td>原生支持安全拦截</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p><strong>黄金实践法则</strong>：<br>\n新项目若<strong>不需要处理二进制协议</strong>，优先选择Spring官方方案；<br>\n现有系统需<strong>添加高性能实时通道</strong>，引入Netty作为独立服务模块；<br>\n<strong>关键业务系统</strong>建议同时实现两种方案，Netty处理实时数据流，Spring处理业务消息。</p>\n</blockquote>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\" data-last-update-days=\"0\" data-date-updated=\"2025-12-23 13:50\">2025-12-23 13:50</span>&nbsp;\n<a href=\"https://www.cnblogs.com/xzqcsj\">一旅人</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"AddToWz(19386695);return false;\">收藏</a>&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19386695', targetLink: 'https://www.cnblogs.com/xzqcsj/p/19386695', title: 'Spring Boot WebSocket方案终极指南：Netty与官方Starter对比与实践' })\">举报</a>\n</div>","guid":{"value":"ade312d7c8368f630f6157802fe44e01"}},{"title":"论索引的重要性","link":"https://www.cnblogs.com/zhuancloud/p/19386304","description":"<h1 class=\"postTitle\">\n                <a id=\"cb_post_title_url\" class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/zhuancloud/p/19386304\" title=\"发布于 2025-12-23 12:14\">\n    <span role=\"heading\" aria-level=\"2\">论索引的重要性</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div id=\"cnblogs_post_body\" class=\"blogpost-body blogpost-body-html\">\n<h1>开篇小测验</h1>\n<p>下面这样一个小SQL 你该怎么样添加最优索引</p>\n<p>两个表上现在只有聚集索引</p>\n<p>bigproduct 表上已经有聚集索引 ProductID</p>\n<p>bigtransactionhistory 表上已经有聚集索引 TransactionID</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223120456999-725818889.png\" alt=\"b44130128656738d3f4b780d89ab2eac\" loading=\"lazy\"></p>\n<p>&nbsp;</p>\n<p>你是否一眼就能看出来呢？</p>\n<p>答案将在文章中逐步揭晓~~~</p>\n<p><span style=\"font-size: 18px; color: rgba(128, 0, 128, 1)\">简单粗暴的添加索引</span></p>\n<p>首先我们看一下没有优化前的执行计划</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223120641375-577465385.png\" alt=\"ca7e2b86cd792b5d4d254d5f5d94ad86\" loading=\"lazy\"></p>\n<p>&nbsp;</p>\n<p>clustered index scan 这其实就是表扫描，不是table scan 只是因为表上有聚集索引<br><br></p>\n<p>可以看出这个查询俩表都使用了表扫描！</p>\n<p><strong>where </strong><strong>条件添加索引</strong></p>\n<p>首先大多数人都知道 where 条件中的字段需要添加索引! 我们添加一下看看效果创建</p>\n<p>在 bigproduct 表上创建 name 列索引，在bigtransactionhistory表上创建TransactionDate 列索引。</p>\n<p>再次执行语句看一下效果！</p>\n<p>&nbsp;</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223120724790-1339715259.jpg\" alt=\"530d49249ae3bf15365abcf4643f1f8c\" loading=\"lazy\"></p>\n<p>&nbsp;</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223120744822-2049170817.png\" alt=\"fabf0aadf5ac5e8beb9fac5fc3003a45\" loading=\"lazy\"></p>\n<p>&nbsp;</p>\n<p>添加where索引以后可以看到以下几个现象</p>\n<ul class=\"list-paddingleft-1\">\n<li>\n<p>bigproduct 从原来的clustered index scan 变成 index seek</p>\n</li>\n<li>\n<p>另外多出来个KEY Lookup(clustered)</p>\n</li>\n<li>\n<p>bigproduct 上添加的索引起了作用，逻辑读bigproduct 由 601 变成10。</p>\n</li>\n<li>\n<p>bigtransactionhistory 没啥变化啊还是clustered index scan</p>\n</li>\n</ul>\n<p>解释一下出现的现象 ：首先一点bigproduct 边添加的where条件索引，起到了作用，执行的时候不是全表扫描了，逻辑读有明显的下降，出现的 KEY Lookup 是因为选择（select）的列，在索引中没有，而需要通过聚集索引再查找一次，再找一次也意味着多一部分开销！那么同样添加了where 条件索引的bigtransactionhistory表为什么没起作用呢？那是因为SQL优化器在选择计划的时候认为，不使用TransactionDate 列索引查找效率会更好!</p>\n<p>真的么？我们来验证一下，通过指定选择索引，来让优化器选择索引查找！</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223120817365-1926397905.jpg\" alt=\"a27b79c2f98f8e77339b6c2820691ba2\" loading=\"lazy\"></p>\n<p>&nbsp;</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223120831833-1982298943.png\" alt=\"f05e632e55f36c304b12af2bd3444c92\" loading=\"lazy\"></p>\n<p>&nbsp;强制使用索引以后，可以看出逻辑读由 14W 变成1961W，语句时间也变得很长，这就是优化器为什么不选用你加的索引！优化器还是很智能的吧。</p>\n<p>高能预警：优化器可不是什么时候都这么智能的...由于缓存计划或优化器抽风等原因，也会出现优化器用了这种索引，导致你的语句奇慢，读飙升直接影响到你的内存、磁盘、CPU资源！另外如果这样一条语句是系统中一条很频繁运行的语句，你的系统就挂了！没错就挂了！这就是开篇抛出的问题就是因为一条语句！</p>\n<p><strong>消灭</strong><strong>Key Lookup </strong><strong>添加</strong><strong>select </strong><strong>字段</strong></p>\n<p>这就是传说中的覆盖索引！</p>\n<p>看到执行计划中存在Key Lookup　而且消耗占比很高，如上面强制索引的计划，那么我们就要想到的 在索引中包含那些SELECT 的列！如果消耗低，逻辑读少，如上面bigproduct 表中的Key Lookup 就可以忽略（如果你追求完美，也一样优化就可以了）。</p>\n<p>包含列的图形化创建：@秋仙 特意给你的说明</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223120901669-431129901.png\" alt=\"d3e35652e888862bf5ce375e2a02fb82\" loading=\"lazy\"></p>\n<p>语句创建就是：</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223120924631-188723058.png\" alt=\"bbe701c20ca02bfb982aa5c37db8cfd8\" loading=\"lazy\"></p>\n<p>下面我们添加一下看看效果：</p>\n<p>&nbsp;</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223121001485-1463459080.jpg\" alt=\"90d3a313bebda1b8554337aa18862e91\" loading=\"lazy\"></p>\n<p>&nbsp;</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223121015442-2136458470.png\" alt=\"f27448095c8648b6a608a7eb6c3dd77e\" loading=\"lazy\"></p>\n<p>&nbsp;</p>\n<p>添加select 索引字段后可以看出的现象：</p>\n<ul class=\"list-paddingleft-1\">\n<li>\n<p>优化器自己选择了index seek</p>\n</li>\n<li>\n<p>bigtransactionhistory占比最高的Key Lookup消失了</p>\n</li>\n<li>\n<p>逻辑读由原来无索引的14W变成1W</p>\n</li>\n<li>\n<p>bigtransactionhistory表还提示缺少索引？</p>\n</li>\n</ul>\n<p>通过优化索引添加select 字段，我们看出语句又一次得到了提升bigtransactionhistory 从表扫描变成索引查找，逻辑读由14W变成 1W！这是一个质的飞跃啊！</p>\n<p>CREATE NONCLUSTERED INDEXTransactionDate包含ProductID_QuantityON[dbo].[bigTransactionHistory] ([TransactionDate])------INCLUDE 就是包含列INCLUDE ([ProductID],[Quantity])GO</p>\n<p>那为什么还提示缺少索引呢？创建一下试试吧！</p>\n<p><strong>索引再优化加入表关联列</strong></p>\n<p>按照提示我们创建索引：和上一个索引的不同 ProductID 列由包含列变成了索引列！</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223121101411-980327210.png\" alt=\"287b334380012753900062827964990f\" loading=\"lazy\"></p>\n<p>&nbsp;</p>\n<p>我们看一下效果：</p>\n<p>&nbsp;</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223121123047-1821728972.png\" alt=\"88760d389647159b33b8e1ce933c2fa0\" loading=\"lazy\"></p>\n<p>&nbsp;</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223121135989-2002256099.png\" alt=\"aa14f00db9b127ff440e7e6ae7713bba\" loading=\"lazy\"></p>\n<p>&nbsp;</p>\n<p>再次优化索引以后可以看到以下几个现象</p>\n<ul class=\"list-paddingleft-1\">\n<li>\n<p>bigtransactionhistory表还是索引查找index seek</p>\n</li>\n<li>\n<p>bigtransactionhistory依然没有了Key Lookup</p>\n</li>\n<li>\n<p>两表关联的hash join 变成了nested loops</p>\n</li>\n<li>\n<p>并行计划变成了串行</p>\n</li>\n<li>\n<p>逻辑读又从1W 变成18</p>\n</li>\n</ul>\n<p>又一次质的飞跃！读从原来的14W 变成1W 又变成18，这样大大减少了内存和IO的消耗，另外并行计划也变成了串行，无疑又减少了大量CPU的消耗！语句时间，我想这里就不用多说了吧？</p>\n<p>高能预警：这里所说的hash join，并行变串行，不懂的朋友可以在百度自行学习，这里只是针对当前语句的情况，不能一概而论！</p>\n<p><strong>精简你的索引</strong></p>\n<p>大家都知道，索引会导致update、insert、delete操作变慢！那么尽量精简你的索引就是一个很重要的话题了！</p>\n<p>上面的优化过程中我们创建了几个索引，以bigTransactionHistory为例来看一下：</p>\n<p><img src=\"https://img2024.cnblogs.com/blog/980582/202512/980582-20251223121217953-1004101723.png\" alt=\"a10260f123cbe86d9d08f309403aa708\" loading=\"lazy\"></p>\n<p>&nbsp;</p>\n<p>脚本这里就不贴了，其实我们最后创建的索引 ProductID_TransactionDate包含Quantity 已经包含了前两个索引，而且可以说无论任何类似语句都使用ProductID_TransactionDate包含Quantity 就可以了！</p>\n<p>那么我们就可以清除前两个索引！</p>\n<p>至此语句的优化算是结束了，留下的就是bigproduct 依然有一个Key Lookup可以优化，可以仿照上面的继续优化，这里就不细说了。</p>\n<p>这就是索引的重要性！</p>\n<p>开篇小测试你做对了么？如果没做对那么这么请你自行模拟一个场景再现本篇的话题吧！</p>\n<h1>总结</h1>\n<p>数据库整体缓慢往往都是因为索引问题导致的，不要小看一条语句的威力，一条高频的语句足可以让你的数据库彻底无法工作。在和大量的运维人员交流的过程中发现，对于索引的重要性恰恰没有足够的重视，一提到优化就是修改SQL语句、读写分离、分布式数据库等舍近求远的方案，优化索引才是对数据库最高性价比的优化。</p>\n<p>&nbsp;</p>\n<p>北京格瑞趋势科技有限公司是聚焦于数据服务的高新技术企业，成立于2008年，创始团队及核心技术人员来自微软和雅虎。微软数据平台长期合作伙伴，卫宁健康数据平台战略合作伙伴。通过产品+服务双轮驱动的业务模式，14年间累计服务4000+客户，覆盖互联网、市政、交通、电信、医疗、教育、电力、制造业等各个领域。</p>\n<p>&nbsp;</p>\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\" data-last-update-days=\"0\" data-date-updated=\"2025-12-23 12:14\">2025-12-23 12:14</span>&nbsp;\n<a href=\"https://www.cnblogs.com/zhuancloud\">格瑞趋势技术团队</a>&nbsp;\n阅读(<span id=\"post_view_count\">85</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"AddToWz(19386304);return false;\">收藏</a>&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19386304', targetLink: 'https://www.cnblogs.com/zhuancloud/p/19386304', title: '论索引的重要性' })\">举报</a>\n</div>","guid":{"value":"979c570a7d233b63a5c1ee0612e35918"}},{"title":"反向传播","link":"https://www.cnblogs.com/tokepson/p/19364232","description":"<h1 class=\"postTitle\">\n                <a id=\"cb_post_title_url\" class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/tokepson/p/19364232\" title=\"发布于 2025-12-23 11:31\">\n    <span role=\"heading\" aria-level=\"2\">反向传播</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div id=\"cnblogs_post_body\" class=\"blogpost-body cnblogs-markdown\">\n<blockquote>\n<p>懂了懂了，还是这样好理解。。。。那么反向传播的计算呢？通过y1, y2, y3 求出x1 ?</p>\n</blockquote>\n<hr>\n<p>太好了！现在我们来推导<strong>反向传播</strong>的计算。这是深度学习中最核心的部分！</p>\n<hr>\n<h2 id=\"1-问题设定\"><strong>1. 问题设定</strong></h2>\n<p>我们有一个简单的三层结构：</p>\n<pre><code>输入 x → 线性层（得 z）→ softmax → 交叉熵损失 L\n</code></pre>\n<p>其中：</p>\n<ul>\n<li>$ z = Wx + b $（为了简化，我们先只考虑从 z 开始的反向传播）</li>\n<li>$ p = \\text{softmax}(z) $</li>\n<li>$ L = -\\sum y_i \\log p_i $</li>\n</ul>\n<p>我们要求 $ \\frac{\\partial L}{\\partial z_j} $，也就是损失对<strong>原始输出 z</strong> 的梯度。</p>\n<hr>\n<h2 id=\"2-已知关系\"><strong>2. 已知关系</strong></h2>\n<p>设类别数 $ C = 3 $，则：</p>\n<p></p><div class=\"math display\">\\[p_i = \\frac{e^{z_i}}{\\sum_{k=1}^C e^{z_k}}\n\\]</div><p></p><p></p><div class=\"math display\">\\[L = -\\sum_{i=1}^C y_i \\log p_i\n\\]</div><p></p><hr>\n<h2 id=\"3-计算梯度-\"><strong>3. 计算梯度</strong> <span class=\"math inline\">\\(\\frac{\\partial L}{\\partial z_j}\\)</span></h2>\n<p>这是一个<strong>非常重要的结果</strong>，也是 softmax 与交叉熵结合的美妙之处。</p>\n<p><strong>推导过程</strong>：</p>\n<p></p><div class=\"math display\">\\[\\frac{\\partial L}{\\partial z_j} = \\sum_{i=1}^C \\frac{\\partial L}{\\partial p_i} \\cdot \\frac{\\partial p_i}{\\partial z_j}\n\\]</div><p></p><p>第一步：<span class=\"math inline\">\\(\\frac{\\partial L}{\\partial p_i} = -\\frac{y_i}{p_i}\\)</span></p>\n<p>第二步：需要计算 <span class=\"math inline\">\\(\\frac{\\partial p_i}{\\partial z_j}\\)</span>，分两种情况：</p>\n<ul>\n<li><strong>当 $ i = j $时</strong>：</li>\n</ul>\n<p></p><div class=\"math display\">\\[\\frac{\\partial p_i}{\\partial z_i} = p_i(1 - p_i)\n\\]</div><p></p><ul>\n<li><strong>当 $ i \\neq j $时</strong>：</li>\n</ul>\n<p></p><div class=\"math display\">\\[\\frac{\\partial p_i}{\\partial z_j} = -p_i p_j\n\\]</div><p></p><p>现在代入：</p>\n<p></p><div class=\"math display\">\\[\\frac{\\partial L}{\\partial z_j} = \\sum_{i=1}^C \\left( -\\frac{y_i}{p_i} \\right) \\cdot \\frac{\\partial p_i}{\\partial z_j}\n\\]</div><p></p><p>分开求和：</p>\n<ol>\n<li>当 <span class=\"math inline\">\\(i = j\\)</span> 时：项为 <span class=\"math inline\">\\(-\\frac{y_j}{p_j} \\cdot p_j(1-p_j) = -y_j(1-p_j)\\)</span></li>\n<li>当 <span class=\"math inline\">\\(i \\neq j\\)</span> 时：项为 <span class=\"math inline\">\\(-\\frac{y_i}{p_i} \\cdot (-p_i p_j) = y_i p_j\\)</span></li>\n</ol>\n<p>所以：</p>\n<p></p><div class=\"math display\">\\[\\frac{\\partial L}{\\partial z_j} = -y_j(1-p_j) + \\sum_{i \\neq j} y_i p_j\n\\]</div><p></p><p>注意 <span class=\"math inline\">\\(\\sum_{i \\neq j} y_i = 1 - y_j\\)</span>（因为 y 是 one-hot，总和为1）</p>\n<p>因此：</p>\n<p></p><div class=\"math display\">\\[\\frac{\\partial L}{\\partial z_j} = -y_j + y_j p_j + p_j(1 - y_j)\n\\]</div><p></p><p></p><div class=\"math display\">\\[= -y_j + p_j(y_j + 1 - y_j)\n\\]</div><p></p><p></p><div class=\"math display\">\\[= p_j - y_j\n\\]</div><p></p><hr>\n<h2 id=\"4-最终简洁结果\"><strong>4. 最终简洁结果</strong></h2>\n<p></p><div class=\"math display\">\\[\\boxed{\\frac{\\partial L}{\\partial z_j} = p_j - y_j}\n\\]</div><p></p><p><strong>太漂亮了！</strong> 这个结果意味着：</p>\n<ul>\n<li>梯度 = <strong>预测概率 - 真实标签</strong></li>\n<li>对于真实类别（<span class=\"math inline\">\\(y_j=1\\)</span>）：梯度 = <span class=\"math inline\">\\(p_j - 1\\)</span>（负数，需要增大 <span class=\"math inline\">\\(z_j\\)</span>）</li>\n<li>对于其他类别（<span class=\"math inline\">\\(y_j=0\\)</span>）：梯度 = <span class=\"math inline\">\\(p_j - 0 = p_j\\)</span>（正数，需要减小 <span class=\"math inline\">\\(z_j\\)</span>）</li>\n</ul>\n<hr>\n<h2 id=\"5-例子验证\"><strong>5. 例子验证</strong></h2>\n<p>用我们刚才的例子：</p>\n<ul>\n<li>$ z = [3.0, 1.0, -1.0] $</li>\n<li>$ y = [1, 0, 0] $</li>\n<li>$ p = [0.88, 0.12, 0.00] $</li>\n</ul>\n<p>梯度：</p>\n<p></p><div class=\"math display\">\\[\\frac{\\partial L}{\\partial z} = p - y = [0.88-1, 0.12-0, 0.00-0] = [-0.12, 0.12, 0.00]\n\\]</div><p></p><p><strong>解释</strong>：</p>\n<ul>\n<li>对真实类别（猫）：梯度 -0.12 → 需要稍微增大 <span class=\"math inline\">\\(z_0\\)</span></li>\n<li>对其他类别（狗）：梯度 +0.12 → 需要减小 <span class=\"math inline\">\\(z_1\\)</span></li>\n<li>对鸟：梯度 0 → 不需要改变</li>\n</ul>\n<hr>\n<h2 id=\"6-扩展到-x-的梯度\"><strong>6. 扩展到 x 的梯度</strong></h2>\n<p>如果我们有 $ z = Wx + b $，那么：</p>\n<p></p><div class=\"math display\">\\[\\frac{\\partial L}{\\partial x} = W^T \\cdot \\frac{\\partial L}{\\partial z}\n\\]</div><p></p><p>因为 $ \\frac{\\partial z}{\\partial x} = W^T $。</p>\n<hr>\n<h2 id=\"总结反向传播流程\"><strong>总结反向传播流程</strong>：</h2>\n<ol>\n<li>前向计算：$ z → softmax → p → L = -\\sum y_i \\log p_i $</li>\n<li>反向传播：\n<ul>\n<li>$ \\frac{\\partial L}{\\partial z} = p - y $（极其简洁！）</li>\n<li>然后继续向后传播到 $ W, b, x $</li>\n</ul>\n</li>\n</ol>\n<p>这就是为什么 softmax + 交叉熵在深度学习中被广泛使用——梯度计算既简洁又数值稳定！</p>\n<hr>\n<h2 id=\"相关参考\">相关参考：</h2>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap2.html\" target=\"_blank\" rel=\"noopener nofollow\">How the backpropagation algorithm works</a></li>\n<li><a href=\"https://blog.csdn.net/qq_36803941/article/details/136191848?spm=1001.2101.3001.6650.2&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7EPaidSort-2-136191848-blog-107242858.235%5Ev43%5Epc_blog_bottom_relevance_base5&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7EPaidSort-2-136191848-blog-107242858.235%5Ev43%5Epc_blog_bottom_relevance_base5&amp;utm_relevant_index=4\" target=\"_blank\" rel=\"noopener nofollow\">深度学习：完全理解反向传播算法（一）</a></li>\n</ul>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\" data-last-update-days=\"0\" data-date-updated=\"2025-12-23 11:31\">2025-12-23 11:31</span>&nbsp;\n<a href=\"https://www.cnblogs.com/tokepson\">TokE648</a>&nbsp;\n阅读(<span id=\"post_view_count\">8</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"AddToWz(19364232);return false;\">收藏</a>&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19364232', targetLink: 'https://www.cnblogs.com/tokepson/p/19364232', title: '反向传播' })\">举报</a>\n</div>","guid":{"value":"9582a51fcca2e442dfadaa0af5ec5026"}},{"title":"使用Vite+ Lit 构建webcomponent 组件","link":"https://www.cnblogs.com/mykai/p/19385542","description":"<h1 class=\"postTitle\">\n                <a id=\"cb_post_title_url\" class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/mykai/p/19385542\" title=\"发布于 2025-12-23 11:08\">\n    <span role=\"heading\" aria-level=\"2\">使用Vite+ Lit 构建webcomponent 组件</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div id=\"cnblogs_post_body\" class=\"blogpost-body cnblogs-markdown\">\n<h2 id=\"vitelitjs-构建web-component\">Vite+Lit.js 构建Web Component</h2>\n<p><strong>web component</strong>作为前一个时代的方案，在特定场景下确有不一样的妙用<br>\n，在维护<strong>前后端不分离</strong>的项目，web component 是为数不多的选择，整理一下使用Lit 构建自己的web component组件库为传统项目提提速的过程。</p>\n<h3 id=\"使用vite-创建项目\">使用vite 创建项目</h3>\n<p>Vite 里带了Lit模板，我们这里选用Lit+ts模板<br>\n<code>pnpm create vite</code></p>\n<h5 id=\"目录结构\">目录结构</h5>\n<ul>\n<li>src\n<ul>\n<li>hello\n<ul>\n<li>index.ts // 具体组件</li>\n</ul>\n</li>\n<li>index.ts // 组件收集</li>\n</ul>\n</li>\n<li>vite.config.ts 打包配置！</li>\n<li>index.ts // 组件注入!</li>\n</ul>\n<blockquote>\n<p>适用于构建基础组件库，不适用太复杂的逻辑，利用web-components 自带的样式隔离等，可以很好的避免被上下文干扰。</p>\n</blockquote>\n<h3 id=\"构建打包项目\">构建打包项目</h3>\n<h5 id=\"编写入口文件注入组件\">编写入口文件，注入组件</h5>\n<pre><code>import * as allComponents from './src/main.ts'\n\nconst components = allComponents\nconst toKebabCase = (str: string): string =&gt; {\n  return str\n    .replace(/([a-z0-9])([A-Z])/g, '$1-$2')\n    .replace(/([A-Z])([A-Z])(?=[a-z])/g, '$1-$2')\n    .toLowerCase()\n}\nif (typeof window !== 'undefined') {\n  (window as any).WebComponents = components\n  \n  Object.entries(components).forEach(([name, component]) =&gt; {\n    const elementName = toKebabCase(name)\n    const fullElementName = 'xk-' + elementName // 这里定义了全局组件名开头\n\n    if (!customElements.get(fullElementName)) {\n      customElements.define(fullElementName, component)\n    } \n  })\n}\n</code></pre>\n<blockquote>\n<p>除了组件，也可以在这里注入全局方法等</p>\n</blockquote>\n<h5 id=\"构建打包脚本\">构建打包脚本</h5>\n<p>使用vite 来构建很简单。</p>\n<pre><code class=\"language-ts\">import { defineConfig } from 'vite'\nimport { resolve } from 'path'\nimport { fileURLToPath, URL } from 'node:url'\n\nexport default defineConfig({\n  build: {\n    lib: {\n      entry: resolve(fileURLToPath(new URL('.', import.meta.url)), 'index.ts'),\n      name: 'WebComponents',\n      fileName: (format) =&gt; `lit-web-components.${format === 'es' ? 'js' : 'umd.js'}`,\n      formats: ['es', 'umd']\n    },\n    outDir:\"../dist/js\", // 打包输出目录\n    rollupOptions: {\n      output: {\n        extend: true,\n        assetFileNames: 'lit-web-components.[ext]',\n        manualChunks: undefined,\n        compact: true, // 紧凑输出\n      },\n      treeshake: {\n        moduleSideEffects: false,\n        propertyReadSideEffects: false,\n        tryCatchDeoptimization: false\n      },\n    },\n    sourcemap: false, // 移除 source map\n    minify: 'terser',\n    target: 'es2022',\n    terserOptions: {\n      compress: {\n        drop_console: true, // 移除所有 console\n        drop_debugger: true, // 移除 debugger\n        pure_funcs: ['console.log', 'console.info', 'console.debug', 'console.warn'], // 移除指定的纯函数\n        unused: true, // 移除未使用的代码\n        dead_code: true, // 移除死代码\n        conditionals: true, // 优化条件语句\n        evaluate: true, // 计算常量表达式\n        booleans: true, // 优化布尔值\n        sequences: true, // 连接连续语句\n        switches: true, // 移除重复的 switch 分支\n        reduce_vars: true, // 减少变量引用\n        collapse_vars: true, // 内联变量\n        passes: 3 // 多次压缩以获得更好的效果\n      },\n      mangle: {\n        toplevel: true, // 混淆顶级作用域\n        reserved: ['lit', 'LitElement', 'html', 'css', 'customElements'] // 保留重要的库名称\n      },\n      format: {\n        comments: false // 移除所有注释\n      }\n    }\n  },\n  resolve: {\n    alias: {\n      '@': resolve(fileURLToPath(new URL('.', import.meta.url)), 'src')\n    }\n  }\n}) \n</code></pre>\n<h3 id=\"编写一个简单的组件\">编写一个简单的组件</h3>\n<blockquote>\n<p>src/hello/index.ts</p>\n</blockquote>\n<pre><code class=\"language-ts\">import { LitElement,html,css } from \"lit\";\nimport { property } from \"lit/decorators.js\";\n\nexport class Hello extends LitElement{\n    @property({type:String})\n    text='Hello,Web Component'\n\n    @property({type:String})\n    color='#222'\n    static style=css`\n    :host{\n\n    }\n    `\n    render(){\n        return html`\n            &lt;span style=\"color:${this.color};\"&gt;${this.text}&lt;/span&gt;\n        `\n    }\n}\n</code></pre>\n<h5 id=\"在maints-里导入\">在main.ts 里导入</h5>\n<pre><code class=\"language-ts\">export {Hello} from \"./hello/index\"\n</code></pre>\n<h4 id=\"打包输出结果\">打包输出结果</h4>\n<p>lit-web-components.umd.js  16.92 kB │ gzip: 6.44 kB<br>\n注意：这里包含了lit 本身这个库，</p>\n<h3 id=\"使用\">使用</h3>\n<blockquote>\n<p>打包构建带入lit本身的库（<strong>建议</strong>） ，使用就很简单了</p>\n</blockquote>\n<pre><code> 引入\n&lt;script src=\"./js/lit-web-components.umd.js\"&gt;&lt;/script&gt;    \n使用\n&lt;xk-hello color=\"red\"&gt; &lt;/xk-hello&gt; &lt;/br&gt;\n&lt;xk-hello text=\"hello world\"&gt; &lt;/xk-hello&gt;\n\n</code></pre>\n<h4 id=\"输出效果和dom\">输出效果和Dom</h4>\n<p><img src=\"https://img2024.cnblogs.com/blog/2152650/202512/2152650-20251223104127644-462548091.png\" alt=\"image\" loading=\"lazy\"></p>\n<h3 id=\"实际应用和思考\">实际应用和思考</h3>\n<p>web component 可以为传统的老项目注入现代化开发能力，Lit 则大大减轻了这个过程，经过我在项目中的深入使用，明显带来的好处</p>\n<ul>\n<li><strong>样式隔离</strong>： 自带的样式隔离和行为，不会被之前的公共css等影响。减少了<strong>心智负担</strong>。</li>\n<li><strong>复用</strong>：沉淀了一大批组件，快速构建页面，统一了整站的交互性和ui 一致性。</li>\n<li><strong>跨框架</strong>: 后续升级框架时，之前的组件依然能用。减少了升级成本，还能保持原来的ui细节。</li>\n</ul>\n<h3 id=\"缺点\">缺点</h3>\n<ul>\n<li>额外的学习成本：可以使用ai 来开发维护</li>\n<li>SEO影响 对于组件内部的一些隐藏属性，可能会影响SEO：建议增加描述，关键内容通过Slot可以消除</li>\n</ul>\n<h2 id=\"总结\">总结</h2>\n<p>如果无法对大型项目重构，大型项目开发起来又很痛苦，尝试webcomponent 方案吧。升级平滑，组件复用，还有样式隔离，插槽等现代化概念。</p>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\" data-last-update-days=\"0\" data-date-updated=\"2025-12-23 11:08\">2025-12-23 11:08</span>&nbsp;\n<a href=\"https://www.cnblogs.com/mykai\">MyKai</a>&nbsp;\n阅读(<span id=\"post_view_count\">23</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"AddToWz(19385542);return false;\">收藏</a>&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19385542', targetLink: 'https://www.cnblogs.com/mykai/p/19385542', title: '使用Vite+ Lit 构建webcomponent 组件' })\">举报</a>\n</div>","guid":{"value":"2d17e781aad3c2b42395cebd1d0ec0ba"}},{"title":"vite7+deepseek流式ai模板|vue3.5+deepseek3.2+markdown打字输出ai助手","link":"https://www.cnblogs.com/xiaoyan2017/p/19385909","description":"<h1 class=\"postTitle\">\n                <a id=\"cb_post_title_url\" class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19385909\" title=\"发布于 2025-12-23 11:06\">\n    <span role=\"heading\" aria-level=\"2\">vite7+deepseek流式ai模板|vue3.5+deepseek3.2+markdown打字输出ai助手</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div id=\"cnblogs_post_body\" class=\"blogpost-body blogpost-body-html\">\n<p><span style=\"font-size: 18px; font-family: 宋体, &quot;Songti SC&quot;; color: rgba(149, 20, 234, 1)\">2026最新款爆肝<span style=\"background-color: rgba(251, 217, 250, 1)\">vite7.2+deepseek-v3.2+vant4+markdown</span>流式打字输出AI对话模板。</span></p>\n<p><span style=\"font-size: 12px\"><strong>vue3-mobile-deepseek</strong>：基于<span style=\"background-color: rgba(204, 255, 204, 1)\">vue3.5+vite7.2+vant4+markdown+openai</span>深度集成<strong>deepseek-v3.2</strong>聊天大模型。支持<span style=\"background-color: rgba(255, 255, 153, 1)\"><strong>浅色+深色主题、stream流式输出、代码高亮、复制代码、katex公式、mermaid图表</strong></span>等功能。</span></p>\n<p><img alt=\"未标题-2\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223095028752-606844753.png\" class=\"lazyload\"></p>\n<p><img alt=\"p2_2\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223095502103-480557904.gif\" class=\"lazyload\"></p>\n<h3>技术栈</h3>\n<ul>\n<li><span style=\"font-size: 12px\">编辑器：vscode</span></li>\n<li><span style=\"font-size: 12px\">技术框架：vite^7.2.4+vue^3.5.24+vue-router^4.6.4</span></li>\n<li><span style=\"font-size: 12px\">大模型框架：deepseek-v3.2 + openai</span></li>\n<li><span style=\"font-size: 12px\">UI组件库：vant^4.9.21 (有赞vue3移动端组件库)</span></li>\n<li><span style=\"font-size: 12px\">状态管理：pinia^3.0.4</span></li>\n<li><span style=\"font-size: 12px\">高亮插件：highlight.js^11.11.1</span></li>\n<li><span style=\"font-size: 12px\">markdown解析：markdown-it</span></li>\n<li><span style=\"font-size: 12px\">katex公式：@mdit/plugin-katex^0.24.1</span></li>\n<li><span style=\"font-size: 12px\">本地缓存：pinia-plugin-persistedstate^4.7.1</span></li>\n</ul>\n<p><img alt=\"p3\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223095301964-489954613.gif\" class=\"lazyload\"></p>\n<p><img alt=\"p5\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223100008878-2134758406.gif\" class=\"lazyload\"></p>\n<h3>功能性</h3>\n<ol>\n<li><span style=\"font-size: 12px\">Vue3.5+DeepSeek-V3.2流式打字输出效果</span></li>\n<li><span style=\"font-size: 12px\">基于Vite7.2构建，集成DeepSeek-Chat模型，性能更优，对话丝滑流畅</span></li>\n<li><span style=\"font-size: 12px\">支持各种代码高亮（<strong>复制代码+收缩功能</strong>），方便展示和分享代码片段</span></li>\n<li><span style=\"font-size: 12px\">支持输出<strong>Katex数学公式、Mermaid图表</strong></span></li>\n<li><span style=\"font-size: 12px\">使用vant4组件库，风格统一，时尚大气</span></li>\n<li><span style=\"font-size: 12px\">支持<strong>移动端+PC端750px像素</strong>适配</span></li>\n</ol>\n<p><img alt=\"未标题-4\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223100653751-1334957329.png\" class=\"lazyload\"></p>\n<blockquote>\n<h3><em>目前vue3-deepseek流式ai对话项目已经更新到我的原创作品集，欢迎下载使用。</em></h3>\n<p><span style=\"font-size: 12px\"><a href=\"https://mall.bilibili.com/neul-next/detailuniversal/detail.html?isMerchant=1&amp;page=detailuniversal_detail&amp;saleType=10&amp;itemsId=11721604&amp;loadingShow=1&amp;noTitleBar=1&amp;msource=merchant_share\" target=\"_blank\" rel=\"noopener nofollow\">Vue3+DeepSeek+Vant4智能聊天AI流式对话模板</a></span></p>\n</blockquote>\n<h3>项目框架结构</h3>\n<p><span style=\"font-size: 12px\">整个项目使用最新<strong>vite7.2</strong>搭建项目模板，遵循<span style=\"background-color: rgba(204, 255, 204, 1)\">vue3 setup</span>语法编码。</span></p>\n<p><img alt=\"360截图20251222233502584\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223101243748-1689844727.png\" class=\"lazyload\"></p>\n<h3>vue3环境变量.env配置</h3>\n<p><span style=\"font-size: 12px\">申请一个deepseek apikey，替换掉项目根目录下<strong>.env</strong>文件里的key即可畅快体验deepseek-v3.2流式输出功能。</span></p>\n<p><img alt=\"image\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223101608080-727506622.png\" class=\"lazyload\"></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 0, 1)\"># title\nVITE_APP_TITLE </span>= 'Vue3-DeepSeek-Chat'<span style=\"color: rgba(0, 0, 0, 1)\">\n\n# port 默认http:</span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\">localhost:5173/</span>\nVITE_PORT = 3001<span style=\"color: rgba(0, 0, 0, 1)\">\n\n# 运行时自动打开浏览器\nVITE_OPEN </span>= <span style=\"color: rgba(0, 0, 255, 1)\">true</span><span style=\"color: rgba(0, 0, 0, 1)\">\n\n# 开启https\nVITE_HTTPS </span>= <span style=\"color: rgba(0, 0, 255, 1)\">false</span><span style=\"color: rgba(0, 0, 0, 1)\">\n\n# 是否删除生产环境 console\nVITE_DROP_CONSOLE </span>= <span style=\"color: rgba(0, 0, 255, 1)\">true</span><span style=\"color: rgba(0, 0, 0, 1)\">\n\n# DeepSeek API配置\nVITE_DEEPSEEK_API_KEY </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> 替换为你的 API Key\nVITE_DEEPSEEK_BASE_URL </span>= https:<span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\">api.deepseek.com</span></pre>\n</div>\n<h3>项目入口main.js</h3>\n<div class=\"cnblogs_code\">\n<pre>import { createApp } from 'vue'<span style=\"color: rgba(0, 0, 0, 1)\">\nimport </span>'./style.scss'<span style=\"color: rgba(0, 0, 0, 1)\">\nimport App from </span>'./App.vue'\n\n<span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 引入路由/状态管理</span>\nimport Router from './router'<span style=\"color: rgba(0, 0, 0, 1)\">\nimport Pinia from </span>'./pinia'<span style=\"color: rgba(0, 0, 0, 1)\">\n\nimport Plugins from </span>'./plugins'<span style=\"color: rgba(0, 0, 0, 1)\">\n\nconst app </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> createApp(App)\n\napp\n.use(Router)\n.use(Pinia)\n.use(Plugins)\n.mount(</span>'#app')</pre>\n</div>\n<p><img alt=\"未标题-3\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223101727948-845129722.png\" class=\"lazyload\"></p>\n<p><img alt=\"015360截图20251222210330994\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223102137659-2062357504.png\" class=\"lazyload\"></p>\n<h3>项目布局结构</h3>\n<p><img alt=\"image\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223102355099-271621583.png\" class=\"lazyload\"></p>\n<p><span style=\"font-size: 12px\">整体项目结构分为<strong>顶部导航栏+聊天会话区+底部编辑栏</strong>三个模块。</span></p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">template</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n  <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">div </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"flexbox flex-col\"</span><span style=\"color: rgba(255, 0, 0, 1)\"> style</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"height:100%;\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">Toolbar </span><span style=\"color: rgba(255, 0, 0, 1)\">:title</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"chatSession?.title\"</span> <span style=\"color: rgba(0, 0, 255, 1)\">/&gt;</span>\n\n    <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">div </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"v3ai__scrollview flex1\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n      <span style=\"color: rgba(0, 128, 0, 1)\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1)\"> Chat对话 </span><span style=\"color: rgba(0, 128, 0, 1)\">--&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">div </span><span style=\"color: rgba(255, 0, 0, 1)\">v-if</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"chatSession &amp;&amp; !isEmpty(chatSession.data)\"</span><span style=\"color: rgba(255, 0, 0, 1)\"> class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"v3ai__chatbot\"</span><span style=\"color: rgba(255, 0, 0, 1)\"> ref</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"scrollRef\"</span><span style=\"color: rgba(255, 0, 0, 1)\"> @scroll</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"onScroll\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">div </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"v3ai__chatbot-sessions\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span><span style=\"color: rgba(0, 0, 0, 1)\">\n          ...\n        </span><span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">div</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n        <span style=\"color: rgba(0, 128, 0, 1)\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1)\"> 滚动底部 </span><span style=\"color: rgba(0, 128, 0, 1)\">--&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">div </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"v3ai__scrollbottom\"</span><span style=\"color: rgba(255, 0, 0, 1)\"> :class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"{'is-bottom': reachBottom}\"</span><span style=\"color: rgba(255, 0, 0, 1)\"> @click</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"scrollToBottom\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">i </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"iconfont ai-arrD\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">i</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">div</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">div</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n      <span style=\"color: rgba(0, 128, 0, 1)\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1)\"> 导语 </span><span style=\"color: rgba(0, 128, 0, 1)\">--&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">div </span><span style=\"color: rgba(255, 0, 0, 1)\">v-else class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"v3ai__chatbot-intro\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">i </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"logo iconfont ai-deepseek\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">i</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">h3 </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"name\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">span </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"txt text-gradient\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>嗨~ Vue3-DeepSeek<span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">span</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">h3</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">p </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"desc\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>你身边的智能小帮手，我可以帮你搜索、答疑、写作，请把你的任务交给我吧~<span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">p</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">div </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"prompt\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">p </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"tip\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">span</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>你可以这样问<span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">span</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">span</span><span style=\"color: rgba(255, 0, 0, 1)\"> @click</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"refreshPrompt\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>换一换<span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">i </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"iconfont ai-shuaxin\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">i</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">span</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">p</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">ul </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"list\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">li </span><span style=\"color: rgba(255, 0, 0, 1)\">v-for</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"(item,index) in promptList\"</span><span style=\"color: rgba(255, 0, 0, 1)\"> :key</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"index\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n              <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">div </span><span style=\"color: rgba(255, 0, 0, 1)\">class</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"txt\"</span><span style=\"color: rgba(255, 0, 0, 1)\"> @click</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"changePrompt(item.prompt)\"</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>{{item.emoji}} {{item.prompt}}<span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">div</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n            <span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">li</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n          <span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">ul</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n        <span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">div</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n      <span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">div</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">div</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n\n    <span style=\"color: rgba(0, 128, 0, 1)\">&lt;!--</span><span style=\"color: rgba(0, 128, 0, 1)\"> 编辑器 </span><span style=\"color: rgba(0, 128, 0, 1)\">--&gt;</span>\n    <span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">ChatEditor </span><span style=\"color: rgba(255, 0, 0, 1)\">ref</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"editorRef\"</span><span style=\"color: rgba(255, 0, 0, 1)\"> :value</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"promptValue\"</span><span style=\"color: rgba(255, 0, 0, 1)\"> :reachBottom</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"reachBottom\"</span><span style=\"color: rgba(255, 0, 0, 1)\"> :scrollBottom</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"scrollToBottom\"</span> <span style=\"color: rgba(0, 0, 255, 1)\">/&gt;</span>\n  <span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">div</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span>\n<span style=\"color: rgba(0, 0, 255, 1)\">&lt;/</span><span style=\"color: rgba(128, 0, 0, 1)\">template</span><span style=\"color: rgba(0, 0, 255, 1)\">&gt;</span></pre>\n</div>\n<p><img alt=\"p4\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223102648231-1480552356.gif\" class=\"lazyload\"></p>\n<h3>自定义katex公式+mermaid图表</h3>\n<p><span style=\"font-size: 12px\">在页面引入katex和mermaid插件。</span></p>\n<div class=\"cnblogs_code\">\n<pre>import { imgSize } from '@mdit/plugin-img-size' <span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 支持带尺寸图片</span>\nimport { katex } from \"@mdit/plugin-katex\"; <span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 支持数学公式</span>\nimport 'katex/dist/katex.min.css'\n<span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 渲染mermaid图表</span>\nimport { markdownItMermaidPlugin } from '@/components/markdown/plugins/mermaidPlugin'</pre>\n</div>\n<p>渲染markdown流式</p>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 0, 255, 1)\">&lt;</span><span style=\"color: rgba(128, 0, 0, 1)\">Markdown\n  </span><span style=\"color: rgba(255, 0, 0, 1)\">:source</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"item.content\"</span><span style=\"color: rgba(255, 0, 0, 1)\">\n  :html</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"true\"</span><span style=\"color: rgba(255, 0, 0, 1)\">\n  :linkify</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"true\"</span><span style=\"color: rgba(255, 0, 0, 1)\">\n  :typographer</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"true\"</span><span style=\"color: rgba(255, 0, 0, 1)\">\n  :plugins</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"[\n    imgSize,\n    [katex, {delimiters: 'all'}],\n    [markdownItMermaidPlugin, { ... }]\n  ]\"</span><span style=\"color: rgba(255, 0, 0, 1)\">\n  @copy</span><span style=\"color: rgba(0, 0, 255, 1)\">=\"onCopy\"</span>\n<span style=\"color: rgba(0, 0, 255, 1)\">/&gt;</span></pre>\n</div>\n<p>封装一个mermaid图表解析插件</p>\n<div class=\"cnblogs_code\">\n<pre>export const markdownItMermaidPlugin = (md, options) =&gt;<span style=\"color: rgba(0, 0, 0, 1)\"> {\n  const defaultFence </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> md.renderer.rules.fence\n  md.renderer.rules.fence </span>= (...args) =&gt;<span style=\"color: rgba(0, 0, 0, 1)\"> {\n    const [tokens, idx] </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> args\n    const token </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> tokens[idx]\n    const lang </span>= token.info.replace(/\\[.*\\]/, '').trim() || ''\n\n    <span style=\"color: rgba(0, 0, 255, 1)\">if</span>(lang === 'mermaid'<span style=\"color: rgba(0, 0, 0, 1)\">) {\n      const code </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> token.content.trim()\n      const hash </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> generateHash(code)\n      const uuid </span>= `${hash}-${Date.now()}-${Math.random().toString(36).substring(2, 9<span style=\"color: rgba(0, 0, 0, 1)\">)}`\n\n      </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 如果有缓存，加载缓存图表</span>\n      <span style=\"color: rgba(0, 0, 255, 1)\">if</span><span style=\"color: rgba(0, 0, 0, 1)\">(renderCache.has(hash)) {\n        </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> console.log('加载缓存mermaid图表')</span>\n        <span style=\"color: rgba(0, 0, 255, 1)\">return</span><span style=\"color: rgba(0, 0, 0, 1)\"> `\n          ${ defaultFence(...args) }\n          </span>&lt;div class=\"mermaid-container\"&gt;${renderCache.get(hash)}&lt;/div&gt;\n<span style=\"color: rgba(0, 0, 0, 1)\">        `\n      }\n</span>\n<span style=\"color: rgba(0, 0, 0, 1)\">      nextTickRender(uuid)\n\n      </span><span style=\"color: rgba(0, 0, 255, 1)\">return</span><span style=\"color: rgba(0, 0, 0, 1)\"> `\n        ${ defaultFence(...args) }\n        </span>&lt;div class=\"mermaid-container\" id=\"${uuid}\" data-mermaid-hash=\"${hash}\" data-mermaid-code=\"${encodeURIComponent(code)}\"&gt;\n          &lt;div class=\"mermaid-loading\"&gt;📊Mermaid 图表加载中...&lt;/div&gt;\n        &lt;/div&gt;\n<span style=\"color: rgba(0, 0, 0, 1)\">      `\n    }\n\n    </span><span style=\"color: rgba(0, 0, 255, 1)\">return</span><span style=\"color: rgba(0, 0, 0, 1)\"> defaultFence(...args)\n  }\n\n  </span><span style=\"color: rgba(0, 0, 255, 1)\">function</span><span style=\"color: rgba(0, 0, 0, 1)\"> nextTickRender(containerId) {\n    </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 如果容器存在，直接渲染</span>\n    <span style=\"color: rgba(0, 0, 255, 1)\">if</span><span style=\"color: rgba(0, 0, 0, 1)\">(document.getElementById(containerId)) {\n      renderMermaidDiagram(containerId)\n      </span><span style=\"color: rgba(0, 0, 255, 1)\">return</span><span style=\"color: rgba(0, 0, 0, 1)\">\n    }\n    </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 使用MutationObserver监听DOM更新</span>\n    const observer = <span style=\"color: rgba(0, 0, 255, 1)\">new</span> MutationObserver((mutations, ob) =&gt;<span style=\"color: rgba(0, 0, 0, 1)\"> {\n      const container </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> document.getElementById(containerId)\n      </span><span style=\"color: rgba(0, 0, 255, 1)\">if</span><span style=\"color: rgba(0, 0, 0, 1)\">(container) {\n        ob.disconnect()\n        renderMermaidDiagram(containerId)\n      }\n    })\n    observer.observe(document.body, {\n      childList: </span><span style=\"color: rgba(0, 0, 255, 1)\">true</span><span style=\"color: rgba(0, 0, 0, 1)\">,\n      subtree: </span><span style=\"color: rgba(0, 0, 255, 1)\">true</span><span style=\"color: rgba(0, 0, 0, 1)\">\n    })\n  }\n  \n  async </span><span style=\"color: rgba(0, 0, 255, 1)\">function</span><span style=\"color: rgba(0, 0, 0, 1)\"> renderMermaidDiagram(containerId) {\n    const container </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> document.getElementById(containerId)\n    </span><span style=\"color: rgba(0, 0, 255, 1)\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1)\">container) {\n      console.warn(`Mermaid container #${containerId} not found`)\n      </span><span style=\"color: rgba(0, 0, 255, 1)\">return</span><span style=\"color: rgba(0, 0, 0, 1)\">\n    }\n  \n    const code </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> decodeURIComponent(container.dataset.mermaidCode)\n    const hash </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> container.dataset.mermaidHash\n\n    </span><span style=\"color: rgba(0, 0, 255, 1)\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1)\">code) {\n      </span><span style=\"color: rgba(0, 0, 255, 1)\">return</span><span style=\"color: rgba(0, 0, 0, 1)\">\n    }\n\n    </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 检查 mermaid 是否可用</span>\n    <span style=\"color: rgba(0, 0, 255, 1)\">if</span> (<span style=\"color: rgba(0, 0, 255, 1)\">typeof</span> window.mermaid === 'undefined'<span style=\"color: rgba(0, 0, 0, 1)\">) {\n      showError(container, </span>'Mermaid 库未加载!'<span style=\"color: rgba(0, 0, 0, 1)\">)\n      </span><span style=\"color: rgba(0, 0, 255, 1)\">return</span><span style=\"color: rgba(0, 0, 0, 1)\">\n    }\n  \n    </span><span style=\"color: rgba(0, 0, 255, 1)\">try</span><span style=\"color: rgba(0, 0, 0, 1)\"> {\n      </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 配置 mermaid（如果还未配置）</span>\n      <span style=\"color: rgba(0, 0, 255, 1)\">if</span> (!<span style=\"color: rgba(0, 0, 0, 1)\">window.mermaid.initialized) {\n        window.mermaid.initialize({\n          startOnLoad: </span><span style=\"color: rgba(0, 0, 255, 1)\">false</span><span style=\"color: rgba(0, 0, 0, 1)\">,\n          theme: </span>'default'<span style=\"color: rgba(0, 0, 0, 1)\">,\n          securityLevel: </span>'loose'<span style=\"color: rgba(0, 0, 0, 1)\">,</span><span style=\"color: rgba(0, 0, 0, 1)\">\n        })\n        window.mermaid.initialized </span>= <span style=\"color: rgba(0, 0, 255, 1)\">true</span><span style=\"color: rgba(0, 0, 0, 1)\">\n      }\n  \n      let svg\n  \n      </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 检查缓存</span>\n      <span style=\"color: rgba(0, 0, 255, 1)\">if</span><span style=\"color: rgba(0, 0, 0, 1)\">(renderCache.has(hash)) {\n        svg </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> renderCache.get(hash)\n      }</span><span style=\"color: rgba(0, 0, 255, 1)\">else</span><span style=\"color: rgba(0, 0, 0, 1)\"> {\n        const { isValid } </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> await verifyMermaid(code)\n\n        </span><span style=\"color: rgba(0, 0, 255, 1)\">if</span>(!<span style=\"color: rgba(0, 0, 0, 1)\">isValid) {\n          showError(container, `</span>&lt;pre&gt;渲染语法错误：\\n${ code }\\n&lt;/pre&gt;`)\n          <span style=\"color: rgba(0, 0, 255, 1)\">return</span><span style=\"color: rgba(0, 0, 0, 1)\">\n        }\n\n        </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 使用唯一ID渲染(避免图表冲突)</span>\n        const {svg: renderedSvg} = await window.mermaid.render(`mermaid-<span style=\"color: rgba(0, 0, 0, 1)\">${containerId}`, code)\n        svg </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> renderedSvg\n        renderCache.set(hash, svg)\n      }\n\n      </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 更新容器内容</span>\n      container.innerHTML =<span style=\"color: rgba(0, 0, 0, 1)\"> svg\n      container.removeAttribute(</span>'data-mermaid-hash'<span style=\"color: rgba(0, 0, 0, 1)\">)\n      container.removeAttribute(</span>'data-mermaid-code'<span style=\"color: rgba(0, 0, 0, 1)\">)\n\n      </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 触发回调</span>\n      <span style=\"color: rgba(0, 0, 255, 1)\">if</span>(options?<span style=\"color: rgba(0, 0, 0, 1)\">.reachBottom) {\n        options</span>?.onRender?<span style=\"color: rgba(0, 0, 0, 1)\">.()\n      }\n    } </span><span style=\"color: rgba(0, 0, 255, 1)\">catch</span><span style=\"color: rgba(0, 0, 0, 1)\"> (error) {\n      console.error(</span>'Mermaid 渲染失败:'<span style=\"color: rgba(0, 0, 0, 1)\">, error)\n      showError(container, `</span>&lt;pre&gt;渲染图表时出错: \\n ${error.message}\\n&lt;/pre&gt;`)\n<span style=\"color: rgba(0, 0, 0, 1)\">    }\n  }\n}</span></pre>\n</div>\n<p><img alt=\"001360截图20251222193621367\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223103538181-209659643.png\" class=\"lazyload\"></p>\n<p><img alt=\"001360截图20251222193715663\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223103552216-1545436278.png\" class=\"lazyload\"></p>\n<p><img alt=\"002360截图20251222193937688\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223103612440-1597186190.png\" class=\"lazyload\"></p>\n<p><img alt=\"004360截图20251222194733968\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223103703349-1708451451.png\" class=\"lazyload\"></p>\n<p><img alt=\"007360截图20251222201320598\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223103717238-1614729462.png\" class=\"lazyload\"></p>\n<p><img alt=\"005360截图20251222194921868\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223103756064-1584305930.png\" class=\"lazyload\"></p>\n<p><img alt=\"006360截图20251222195419077\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223103816759-904170540.png\" class=\"lazyload\"></p>\n<p><img alt=\"009360截图20251222202431855\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223103852560-1881261749.png\" class=\"lazyload\"></p>\n<p><img alt=\"010360截图20251222203811582\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223103906992-975747501.png\" class=\"lazyload\"></p>\n<p><img alt=\"012360截图20251222204251442\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223103919280-136041562.png\" class=\"lazyload\"></p>\n<p><img alt=\"013360截图20251222204308421\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223104000680-1481731266.png\" class=\"lazyload\"></p>\n<p><img alt=\"014360截图20251222204432469\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223103939973-1523425268.png\" class=\"lazyload\"></p>\n<p>支持运行到pc端以750px宽度显示页面布局。</p>\n<p><img alt=\"015360截图20251222205211925\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223104049841-876451429.png\" class=\"lazyload\"></p>\n<p><img alt=\"015360截图20251222210111883\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223104115293-1216317344.png\" class=\"lazyload\"></p>\n<p><img alt=\"015360截图20251222210330996\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223104139497-1047165356.png\" class=\"lazyload\"></p>\n<p><img alt=\"image\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223104354641-1844699074.png\" class=\"lazyload\"></p>\n<h3>vue3集成deepseek流式打字输出</h3>\n<p><strong>非流式请求输出</strong></p>\n<div class=\"cnblogs_code\">\n<pre>const completion =<span style=\"color: rgba(0, 0, 0, 1)\"> await openai.chat.completions.create({\n  messages: [\n    {role: </span>'user'<span style=\"color: rgba(0, 0, 0, 1)\">, content: editorValue}\n  ],\n  model: </span>'deepseek-chat', <span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> deepseek-chat对话模型 deepseek-reasoner推理模型</span>\n  stream: <span style=\"color: rgba(0, 0, 255, 1)\">false</span>, <span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 流式输出</span>\n  max_tokens: 8192, <span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 限制一次请求中模型生成 completion 的最大 token 数(默认使用 4096)</span>\n  temperature: 0.4, <span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 严谨采样 越低越严谨(默认1)</span>\n<span style=\"color: rgba(0, 0, 0, 1)\">})\n</span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 处理返回数据</span>\nconsole.log(completion.choices[0].message.content)</pre>\n</div>\n<p><strong>流式请求输出</strong></p>\n<p>上下文多轮会话。</p>\n<div class=\"cnblogs_code\">\n<pre>const completion =<span style=\"color: rgba(0, 0, 0, 1)\"> await openai.chat.completions.create({\n  </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 单一会话</span>\n  <span style=\"color: rgba(0, 128, 0, 1)\">/*</span><span style=\"color: rgba(0, 128, 0, 1)\"> messages: [\n    {role: 'user', content: editorValue}\n  ], </span><span style=\"color: rgba(0, 128, 0, 1)\">*/</span>\n  <span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 多轮会话</span>\n  messages: props.multiConversation ? historySession.value : [{role: 'user'<span style=\"color: rgba(0, 0, 0, 1)\">, content: editorValue}],\n  model: </span>'deepseek-chat', <span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> deepseek-chat对话模型 deepseek-reasoner推理模型</span>\n  stream: <span style=\"color: rgba(0, 0, 255, 1)\">true</span>, <span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 流式输出</span>\n  max_tokens: 8192, <span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 限制一次请求中模型生成 completion 的最大 token 数(默认使用 4096)</span>\n  temperature: 0.4, <span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 严谨采样 越低越严谨(默认1)</span>\n})</pre>\n</div>\n<div class=\"cnblogs_code\">\n<pre><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 处理流式输出</span>\n<span style=\"color: rgba(0, 0, 255, 1)\">for</span><span style=\"color: rgba(0, 0, 0, 1)\"> await (const chunk of completion) {\n  </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 检查是否已终止</span>\n  <span style=\"color: rgba(0, 0, 255, 1)\">if</span>(chatState.aborted) <span style=\"color: rgba(0, 0, 255, 1)\">break</span><span style=\"color: rgba(0, 0, 0, 1)\">\n\n  const content </span>= chunk.choices[0]?.delta?<span style=\"color: rgba(0, 0, 0, 1)\">.content\n  </span><span style=\"color: rgba(0, 0, 255, 1)\">if</span><span style=\"color: rgba(0, 0, 0, 1)\">(content) {\n    streamText </span>+=<span style=\"color: rgba(0, 0, 0, 1)\"> content\n    </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 限制更新频率：每100ms最多更新一次</span>\n    const now =<span style=\"color: rgba(0, 0, 0, 1)\"> Date.now()\n    </span><span style=\"color: rgba(0, 0, 255, 1)\">if</span>(now - lastUpdate &gt; 100<span style=\"color: rgba(0, 0, 0, 1)\">) {\n      lastUpdate </span>=<span style=\"color: rgba(0, 0, 0, 1)\"> now\n      requestAnimationFrame(() </span>=&gt;<span style=\"color: rgba(0, 0, 0, 1)\"> {\n        </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> ...</span>\n<span style=\"color: rgba(0, 0, 0, 1)\">      })\n    }\n  }\n  </span><span style=\"color: rgba(0, 0, 255, 1)\">if</span>(chunk.choices[0]?.finish_reason === 'stop'<span style=\"color: rgba(0, 0, 0, 1)\">) {\n    </span><span style=\"color: rgba(0, 128, 0, 1)\">//</span><span style=\"color: rgba(0, 128, 0, 1)\"> 确保最终内容完整更新</span>\n    ...<span style=\"color: rgba(0, 0, 0, 1)\">\n  }\n}</span></pre>\n</div>\n<p>综上就是vite7.2+vue3对接deepseek实现流式ai对话的一些项目分享，希望对大家有点帮助！</p>\n<p><strong>附上几个最新项目实例</strong></p>\n<blockquote>\n<p><span style=\"font-size: 12px\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/18853514\" target=\"_blank\">Uniapp-DeepSeek跨三端AI助手|uniapp+vue3+deepseek-v3流式ai聊天模板</a></span></p>\n<p><span style=\"font-size: 12px\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/18795796\" target=\"_blank\">vue3-webseek网页版AI问答|Vite6+DeepSeek+Arco流式ai聊天打字效果</a></span></p>\n<p><span style=\"font-size: 12px\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19313982\" target=\"_blank\">最新版Flutter3.38+Dart3.10仿写抖音APP直播+短视频+聊天应用程序</a></span></p>\n<p><span style=\"font-size: 12px\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19235565\" target=\"_blank\">Tauri2.9+Vue3桌面版OS系统|vite7+tauri2+arcoDesign电脑端os后台模板</a></span></p>\n<p><span style=\"font-size: 12px\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19116145\" target=\"_blank\">electron38-admin桌面端后台|Electron38+Vue3+ElementPlus管理系统</a></span></p>\n<p><span style=\"font-size: 12px\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19088804\" target=\"_blank\">Electron38-Wechat电脑端聊天|vite7+electron38仿微信桌面端聊天系统</a></span></p>\n<p><span style=\"font-size: 12px\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19136187\" target=\"_blank\">Electron38-Vue3OS客户端OS系统|vite7+electron38+arco桌面os后台管理</a></span></p>\n<p><span style=\"font-size: 12px\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19181509\" target=\"_blank\">Tauri2-Vite7Admin客户端管理后台|tauri2.9+vue3+element-plus后台系统</a></span></p>\n<p><span style=\"font-size: 12px\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19157445\" target=\"_blank\">Tauri2.8+Vue3聊天系统|vite7+tauri2+element-plus客户端仿微信聊天程序</a></span></p>\n<p><span style=\"font-size: 12px\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/18962574\" target=\"_blank\">最新版uniapp+vue3+uv-ui跨三端短视频+直播+聊天【H5+小程序+App端】</a></span></p>\n<p><span style=\"font-size: 12px\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19031695\" target=\"_blank\">最新版uni-app+vue3+uv-ui跨三端仿微信app聊天应用【h5+小程序+app端】</a></span></p>\n<p><span style=\"font-size: 12px\"><a class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/xiaoyan2017/p/19018641\" target=\"_blank\">Flutter3-MacOS桌面OS系统|flutter3.32+window_manager客户端OS模板</a></span></p>\n</blockquote>\n<p><img alt=\"20190422-204556-c922\" width=\"121\" height=\"121\" loading=\"lazy\" data-src=\"https://img2024.cnblogs.com/blog/1289798/202512/1289798-20251223105455421-2130771465.gif\" class=\"lazyload\"></p>\n<p>&nbsp;</p>\n</div>\n<div id=\"MySignature\" role=\"contentinfo\">\n    本文为博主原创文章，未经博主允许不得转载，欢迎大家一起交流 QQ（282310962） wx（xy190310）\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\" data-last-update-days=\"0\" data-date-updated=\"2025-12-23 11:06\">2025-12-23 11:06</span>&nbsp;\n<a href=\"https://www.cnblogs.com/xiaoyan2017\">xiaoyan2017</a>&nbsp;\n阅读(<span id=\"post_view_count\">44</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"AddToWz(19385909);return false;\">收藏</a>&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19385909', targetLink: 'https://www.cnblogs.com/xiaoyan2017/p/19385909', title: 'vite7+deepseek流式ai模板|vue3.5+deepseek3.2+markdown打字输出ai助手' })\">举报</a>\n</div>","guid":{"value":"bae9aa4667b7b08dfd6fd88728d55b79"}},{"title":"Java单元测试、集成测试，区别","link":"https://www.cnblogs.com/kakarotto-chen/p/19385864","description":"<h2>\n            <a id=\"cb_post_title_url\" class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/kakarotto-chen/p/19385864\" title=\"发布于 2025-12-23 10:58\">\n    <span role=\"heading\" aria-level=\"2\">Java单元测试、集成测试，区别</span>\n    \n\n</a>\n\n        </h2>\n        <div class=\"postbody\">\n            <div id=\"cnblogs_post_body\" class=\"blogpost-body cnblogs-markdown\">\n<h2 id=\"-单元测试-vs-集成测试\">📚 <strong>单元测试 vs 集成测试</strong></h2>\n<h3 id=\"1-单元测试unit-test\"><strong>1. 单元测试（Unit Test）</strong></h3>\n<p><strong>定义</strong>：测试<strong>最小代码单元</strong>（通常是一个方法或类），<strong>隔离所有外部依赖</strong>。</p>\n<p><strong>特点</strong>：</p>\n<ul>\n<li>测试单个类/方法</li>\n<li>所有依赖都用Mock代替</li>\n<li>不启动Spring容器</li>\n<li>运行极快（毫秒级）</li>\n<li>数量最多</li>\n</ul>\n<p><strong>示例</strong>：</p>\n<pre><code class=\"language-java\">// 测试OrderService的calculateTotal方法\nclass OrderServiceTest {\n    @Test\n    void calculateTotal_ShouldReturnCorrectSum() {\n        // 1. Mock所有依赖\n        DiscountService discountMock = mock(DiscountService.class);\n        when(discountMock.calculate(any())).thenReturn(10.0);\n        \n        // 2. 创建被测试对象（不通过Spring）\n        OrderService service = new OrderService(discountMock);\n        \n        // 3. 调用并验证\n        Order order = new Order(100.0);\n        double total = service.calculateTotal(order);\n        \n        assertEquals(90.0, total);  // 100 - 10折扣\n    }\n}\n</code></pre>\n<h3 id=\"2-集成测试integration-test\"><strong>2. 集成测试（Integration Test）</strong></h3>\n<p><strong>定义</strong>：测试<strong>多个组件协同工作</strong>，验证它们之间的集成是否正确。</p>\n<p><strong>特点</strong>：</p>\n<ul>\n<li>测试组件间交互</li>\n<li>启动部分或全部Spring容器</li>\n<li>可能连接真实数据库/外部服务</li>\n<li>运行较慢（秒级）</li>\n<li>数量较少</li>\n</ul>\n<p><strong>典型集成测试</strong>：</p>\n<pre><code class=\"language-java\">@SpringBootTest  // ← 启动完整Spring Boot应用\nclass DolphinSchedulerApiDemoApplicationTests {\n    @Autowired  // ← Spring注入真实bean\n    WorkerGroupRequest workerGroupRequest;  // ← 测试这个bean与其他组件的集成\n    \n    @Test\n    void contextLoads() {\n        // 调用真实方法，可能涉及：\n        // 1. WorkerGroupRequest内部逻辑\n        // 2. 它依赖的其他Service\n        // 3. 可能的HTTP调用（如果用了RestTemplate）\n        // 4. 数据库操作（如果用了DAO）\n        workerGroupRequest.getWorkerPaths();\n    }\n}\n</code></pre>\n<h2 id=\"-两种测试对比\">📊 <strong>两种测试对比</strong></h2>\n<table>\n<thead>\n<tr>\n<th>方面</th>\n<th>单元测试</th>\n<th>集成测试</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>测试范围</strong></td>\n<td>单个类/方法</td>\n<td>多个组件/模块</td>\n</tr>\n<tr>\n<td><strong>外部依赖</strong></td>\n<td>全部Mock</td>\n<td>部分或全部真实</td>\n</tr>\n<tr>\n<td><strong>Spring容器</strong></td>\n<td>不启动</td>\n<td>启动</td>\n</tr>\n<tr>\n<td><strong>运行速度</strong></td>\n<td>快（ms级）</td>\n<td>慢（s级）</td>\n</tr>\n<tr>\n<td><strong>测试目的</strong></td>\n<td>验证逻辑正确性</td>\n<td>验证集成正确性</td>\n</tr>\n<tr>\n<td><strong>数量比例</strong></td>\n<td>70-80%</td>\n<td>20-30%</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-测试分析\">🔧 <strong>测试分析</strong></h2>\n<h3 id=\"当前情况\"><strong>当前情况</strong>：</h3>\n<pre><code class=\"language-java\">@SpringBootTest  // 启动整个应用 → 集成测试\nclass DolphinSchedulerApiDemoApplicationTests {\n    @Autowired  // Spring注入 → 集成测试\n    WorkerGroupRequest workerGroupRequest;\n    \n    @Test\n    void contextLoads() {\n        // 测试API客户端与DolphinScheduler的集成\n        // 可能涉及：网络调用、JSON解析、错误处理等\n    }\n}\n</code></pre>\n<h3 id=\"应该改吗要看测试目的\"><strong>应该改吗？要看测试目的：</strong></h3>\n<p><strong>情况1：如果你是想测\"WorkerGroupRequest与真实DolphinScheduler服务的交互\"</strong></p>\n<pre><code class=\"language-java\">// ✅ 保持集成测试（需要真实后端）\n@SpringBootTest\nclass WorkerGroupIntegrationTest {\n    @Autowired WorkerGroupRequest request;\n    \n    @Test\n    void shouldConnectToRealDolphinScheduler() {\n        // 验证是否能真正连接到部署的DolphinScheduler\n        List&lt;String&gt; paths = request.getWorkerPaths();\n        assertNotNull(paths);\n        // 可能还需要验证路径格式等\n    }\n}\n</code></pre>\n<p><strong>情况2：如果你是想测\"WorkerGroupRequest内部的逻辑\"</strong></p>\n<pre><code class=\"language-java\">// ✅ 改为单元测试（更快、更稳定）\nclass WorkerGroupRequestTest {\n    \n    @Test\n    void parseWorkerPaths_ShouldHandleEmptyResponse() {\n        // 1. Mock HTTP客户端\n        RestTemplate restTemplateMock = mock(RestTemplate.class);\n        when(restTemplateMock.exchange(any(), any(), any(), eq(String.class)))\n            .thenReturn(new ResponseEntity&lt;&gt;(\"[]\", HttpStatus.OK));\n        \n        // 2. 创建测试对象\n        WorkerGroupRequest request = new WorkerGroupRequest(restTemplateMock, \"http://localhost\");\n        \n        // 3. 测试内部逻辑\n        List&lt;String&gt; paths = request.getWorkerPaths();\n        \n        assertTrue(paths.isEmpty());\n    }\n    \n    @Test\n    void parseWorkerPaths_ShouldParseJsonCorrectly() {\n        RestTemplate restTemplateMock = mock(RestTemplate.class);\n        String jsonResponse = \"[\\\"192.168.1.1:1234\\\", \\\"192.168.1.2:1234\\\"]\";\n        when(restTemplateMock.exchange(any(), any(), any(), eq(String.class)))\n            .thenReturn(new ResponseEntity&lt;&gt;(jsonResponse, HttpStatus.OK));\n        \n        WorkerGroupRequest request = new WorkerGroupRequest(restTemplateMock, \"http://localhost\");\n        \n        List&lt;String&gt; paths = request.getWorkerPaths();\n        \n        assertEquals(2, paths.size());\n        assertEquals(\"192.168.1.1:1234\", paths.get(0));\n    }\n}\n</code></pre>\n<h2 id=\"-具体建议\">🎯 <strong>具体建议</strong></h2>\n<h3 id=\"方案a保持集成测试但要改进\"><strong>方案A：保持集成测试，但要改进</strong></h3>\n<pre><code class=\"language-java\">@SpringBootTest\n// 限制测试范围，加速启动\n@AutoConfigureMockMvc\n@TestPropertySource(locations = \"classpath:test.properties\")\nclass WorkerGroupRequestIntegrationTest {\n    \n    @Autowired\n    private WorkerGroupRequest workerGroupRequest;\n    \n    @MockBean  // Mock某些不想真实调用的依赖\n    private SomeExternalService externalService;\n    \n    @Test\n    void getWorkerPaths_ShouldReturnListFromDolphinScheduler() {\n        // 配置Mock行为\n        when(externalService.someCall()).thenReturn(\"mocked\");\n        \n        // 执行测试\n        List&lt;String&gt; result = workerGroupRequest.getWorkerPaths();\n        \n        // 更专业的断言\n        assertNotNull(result);\n        assertFalse(result.isEmpty());\n        // 可以验证特定的业务逻辑\n    }\n}\n</code></pre>\n<h3 id=\"方案b拆分为两种测试\"><strong>方案B：拆分为两种测试</strong></h3>\n<pre><code class=\"language-java\">// 1. 单元测试：测逻辑（80%的测试）\nclass WorkerGroupRequestUnitTest {\n    // 测试各种场景：正常情况、异常情况、边界情况\n    @Test void testNormalCase() { ... }\n    @Test void testEmptyResponse() { ... }\n    @Test void testMalformedJson() { ... }\n    @Test void testNetworkError() { ... }\n}\n\n// 2. 集成测试：测真实连接（20%的测试）\n@SpringBootTest\nclass WorkerGroupRequestIntegrationTest {\n    // 只测真正需要集成验证的部分\n    @Test void testRealConnection() { ... }\n}\n</code></pre>\n<h3 id=\"方案c添加测试配置\"><strong>方案C：添加测试配置</strong></h3>\n<p>在 <code>src/test/resources/application-test.yml</code>：</p>\n<pre><code class=\"language-yaml\"># 测试专用配置\ndolphinscheduler:\n  url: http://localhost:12345\n  # 或者使用测试专用的Mock服务器\n</code></pre>\n<h2 id=\"-判断标准\">📝 <strong>判断标准</strong></h2>\n<p>问自己几个问题：</p>\n<ol>\n<li>\n<p><strong>这个测试需要真实DolphinScheduler服务运行吗？</strong></p>\n<ul>\n<li>是 → 集成测试</li>\n<li>否 → 单元测试</li>\n</ul>\n</li>\n<li>\n<p><strong>测试失败是因为我的代码逻辑问题，还是外部服务问题？</strong></p>\n<ul>\n<li>代码问题 → 应该用单元测试</li>\n<li>外部问题 → 集成测试合理</li>\n</ul>\n</li>\n<li>\n<p><strong>这个测试运行速度重要吗？</strong></p>\n<ul>\n<li>要快速反馈 → 单元测试</li>\n<li>可以接受较慢 → 集成测试</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"-结论\">✅ <strong>结论</strong></h2>\n<p><strong>测试作为集成测试是合理的</strong>，特别是：</p>\n<ul>\n<li>你在开发DolphinScheduler客户端</li>\n<li>需要验证与真实API的交互</li>\n<li>早期开发阶段需要端到端验证</li>\n</ul>\n<p><strong>但建议补充单元测试</strong>来覆盖各种逻辑分支，这样：</p>\n<ol>\n<li>单元测试：快速验证逻辑（开发时频繁运行）</li>\n<li>集成测试：验证真实集成（提交前或CI中运行）</li>\n</ol>\n<p>现在可以这样做：</p>\n<pre><code class=\"language-java\">// 保持现有的集成测试\n@SpringBootTest\nclass WorkerGroupIntegrationTest {\n    // 验证真实连接\n}\n\n// 新增单元测试\nclass WorkerGroupRequestUnitTest {\n    // 测试所有可能的响应处理逻辑\n    @Test void testParseResponse() { ... }\n    @Test void testBuildUrl() { ... }\n    @Test void testHandleError() { ... }\n}\n</code></pre>\n<p>这样既有快速反馈的单元测试，又有保障集成的集成测试。</p>\n\n</div>\n<div class=\"clear\"></div>\n\n        </div>\n        <p class=\"postfoot\">\n            posted on \n<span id=\"post-date\" data-last-update-days=\"0\" data-date-updated=\"2025-12-23 10:59\">2025-12-23 10:58</span>&nbsp;\n<a href=\"https://www.cnblogs.com/kakarotto-chen\">C_C_菜园</a>&nbsp;\n阅读(<span id=\"post_view_count\">0</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"AddToWz(19385864);return false;\">收藏</a>&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19385864', targetLink: 'https://www.cnblogs.com/kakarotto-chen/p/19385864', title: 'Java单元测试、集成测试，区别' })\">举报</a>\n\n        </p>","guid":{"value":"44af6db22ea61c546306eb14b29a7acc"}},{"title":"Lit 的响应式系统为什么这么轻？——从 ReactiveElement 的设计说起","link":"https://www.cnblogs.com/zxlh1529/p/19370810","description":"<h1 class=\"postTitle\">\n                <a id=\"cb_post_title_url\" class=\"postTitle2 vertical-middle\" href=\"https://www.cnblogs.com/zxlh1529/p/19370810\" title=\"发布于 2025-12-23 10:33\">\n    <span role=\"heading\" aria-level=\"2\">Lit 的响应式系统为什么这么轻？——从 ReactiveElement 的设计说起</span>\n    \n\n</a>\n\n            </h1>\n            <div class=\"clear\"></div>\n            <div class=\"postBody\">\n                <div id=\"cnblogs_post_body\" class=\"blogpost-body cnblogs-markdown\">\n<p>在使用 Lit 时，很多人都会有一个直观感受：</p>\n<blockquote>\n<p><strong>“它居然没有状态管理系统？”</strong><br>\n<strong>“也没有复杂的依赖收集？”</strong></p>\n</blockquote>\n<p>但实际使用下来却发现：</p>\n<ul>\n<li>状态更新是正确的</li>\n<li>DOM 更新是精准的</li>\n<li>性能非常稳定</li>\n</ul>\n<p>那么问题来了：</p>\n<blockquote>\n<p><strong>Lit 的响应式系统到底是怎么工作的？</strong><br>\n<strong>它为什么可以这么轻？</strong></p>\n</blockquote>\n<p>本文将从 <strong>ReactiveElement 的设计目标、实现方式、与 Vue/React 的根本差异</strong> 三个角度来解释这个问题。</p>\n<hr>\n<h2 id=\"一先说结论important\">一、先说结论（Important）</h2>\n<p>在 Lit 中：</p>\n<blockquote>\n<p><strong>响应式系统的职责不是“计算依赖”，</strong><br>\n<strong>而是“调度更新”</strong></p>\n</blockquote>\n<p>这是理解 Lit 响应式系统的第一把钥匙。</p>\n<hr>\n<h2 id=\"二reactiveelement-在-lit-架构中的位置\">二、ReactiveElement 在 Lit 架构中的位置</h2>\n<p>先回顾 Lit 的继承链：</p>\n<pre><code class=\"language-text\">HTMLElement\n  └── ReactiveElement\n        └── LitElement\n              └── YourComponent\n</code></pre>\n<p>其中：</p>\n<ul>\n<li><strong>ReactiveElement</strong>：负责响应式属性 &amp; 更新调度</li>\n<li><strong>LitElement</strong>：负责生命周期 &amp; render 调用</li>\n<li><strong>lit-html</strong>：负责 DOM 更新</li>\n</ul>\n<blockquote>\n<p>ReactiveElement 不关心 DOM<br>\n它只关心：<strong>什么时候需要更新</strong></p>\n</blockquote>\n<hr>\n<h2 id=\"三lit-的响应式系统到底响应了什么\">三、Lit 的响应式系统到底“响应”了什么？</h2>\n<h3 id=\"31-lit-的响应式单位是属性不是依赖\">3.1 Lit 的响应式单位是「属性」，不是「依赖」</h3>\n<p>在 Vue 中：</p>\n<pre><code class=\"language-ts\">effect(() =&gt; {\n  div.textContent = state.count\n})\n</code></pre>\n<ul>\n<li>响应的是 <strong>依赖关系</strong></li>\n<li>自动追踪 <code>state.count</code></li>\n</ul>\n<p>而在 Lit 中：</p>\n<pre><code class=\"language-ts\">@property()\ncount = 0\n</code></pre>\n<ul>\n<li>响应的是 <strong>属性赋值行为</strong></li>\n<li>不存在依赖收集</li>\n</ul>\n<hr>\n<h3 id=\"32-本质区别\">3.2 本质区别</h3>\n<table>\n<thead>\n<tr>\n<th>框架</th>\n<th>响应式关注点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Vue</td>\n<td>“谁用到了这个值”</td>\n</tr>\n<tr>\n<td>React</td>\n<td>“状态是否发生变化”</td>\n</tr>\n<tr>\n<td>Lit</td>\n<td>“属性是否被 set”</td>\n</tr>\n</tbody>\n</table>\n<p>Lit 的选择非常克制。</p>\n<hr>\n<h2 id=\"四reactiveelement-的核心机制\">四、ReactiveElement 的核心机制</h2>\n<h3 id=\"41-property-做了什么\">4.1 @property 做了什么</h3>\n<pre><code class=\"language-ts\">@property({ type: Number })\ncount = 0\n</code></pre>\n<p>背后本质是：</p>\n<ol>\n<li>把字段变成 getter / setter</li>\n<li>在 setter 中调用 <code>requestUpdate</code></li>\n</ol>\n<hr>\n<h3 id=\"42-伪代码示意\">4.2 伪代码示意</h3>\n<pre><code class=\"language-ts\">set count(value) {\n  const oldValue = this._count\n  this._count = value\n  this.requestUpdate('count', oldValue)\n}\n</code></pre>\n<p>没有 Proxy<br>\n没有依赖收集<br>\n没有 effect</p>\n<hr>\n<h2 id=\"五requestupdatelit-响应式系统的核心\">五、requestUpdate：Lit 响应式系统的核心</h2>\n<h3 id=\"51-requestupdate-并不立即更新\">5.1 requestUpdate 并不立即更新</h3>\n<pre><code class=\"language-ts\">this.requestUpdate()\n</code></pre>\n<p>它做的事情是：</p>\n<ul>\n<li>标记“需要更新”</li>\n<li>把更新放入 <strong>microtask 队列</strong></li>\n<li>合并多次更新</li>\n</ul>\n<hr>\n<h3 id=\"52-批量更新机制\">5.2 批量更新机制</h3>\n<pre><code class=\"language-ts\">this.count = 1\nthis.count = 2\nthis.count = 3\n</code></pre>\n<p>最终只会：</p>\n<pre><code class=\"language-text\">render 一次\n</code></pre>\n<p>这是 Lit 响应式系统<strong>最重要的性能保证</strong>。</p>\n<hr>\n<h3 id=\"53-更新调度流程\">5.3 更新调度流程</h3>\n<pre><code class=\"language-text\">property set\n  ↓\nrequestUpdate\n  ↓\nPromise.resolve().then()\n  ↓\nperformUpdate\n  ↓\nrender()\n</code></pre>\n<hr>\n<h2 id=\"六为什么-lit-不需要依赖收集\">六、为什么 Lit 不需要依赖收集？</h2>\n<p>答案非常关键：</p>\n<blockquote>\n<p><strong>因为 lit-html 已经知道“哪里会变”</strong></p>\n</blockquote>\n<p>在前一篇 Part 更新机制中讲过：</p>\n<ul>\n<li>DOM 更新是由 Part 精确定位的</li>\n<li>render() 每次都会重新执行</li>\n<li>但更新只发生在表达式对应位置</li>\n</ul>\n<p>因此：</p>\n<blockquote>\n<p><strong>Lit 不需要知道“你在模板中用了哪些属性”</strong></p>\n</blockquote>\n<p>它只需要保证：</p>\n<ul>\n<li>属性变化 → render 执行</li>\n<li>render 执行 → Part 精确更新</li>\n</ul>\n<hr>\n<h2 id=\"七shouldupdatelit-给你的唯一判断点\">七、shouldUpdate：Lit 给你的“唯一判断点”</h2>\n<pre><code class=\"language-ts\">shouldUpdate(changedProperties) {\n  return true\n}\n</code></pre>\n<ul>\n<li><code>changedProperties</code> 是一个 Map</li>\n<li>记录了哪些属性发生了变化</li>\n</ul>\n<p>你可以非常明确地控制：</p>\n<pre><code class=\"language-ts\">shouldUpdate(changed) {\n  return changed.has('count')\n}\n</code></pre>\n<p>这比 Vue/React 的依赖优化<strong>更显式、更可控</strong>。</p>\n<hr>\n<h2 id=\"八lit-的生命周期为什么这么少\">八、Lit 的生命周期为什么这么少？</h2>\n<p>Lit 的生命周期几乎完全围绕「更新」展开：</p>\n<pre><code class=\"language-ts\">connectedCallback()\nshouldUpdate()\nwillUpdate()\nrender()\nupdated()\n</code></pre>\n<p>没有：</p>\n<ul>\n<li>computed</li>\n<li>watch</li>\n<li>effect</li>\n<li>memo</li>\n</ul>\n<p>因为：</p>\n<blockquote>\n<p><strong>Lit 不试图管理你的状态<br>\n它只负责把状态变化“反映到 DOM”</strong></p>\n</blockquote>\n<hr>\n<h2 id=\"九和-vue--react-的响应式系统对比\">九、和 Vue / React 的响应式系统对比</h2>\n<h3 id=\"91-架构层面对比\">9.1 架构层面对比</h3>\n<table>\n<thead>\n<tr>\n<th>维度</th>\n<th>Lit</th>\n<th>Vue</th>\n<th>React</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>响应式基础</td>\n<td>getter/setter</td>\n<td>Proxy</td>\n<td>setState</td>\n</tr>\n<tr>\n<td>依赖收集</td>\n<td>❌</td>\n<td>✅</td>\n<td>❌</td>\n</tr>\n<tr>\n<td>更新调度</td>\n<td>microtask</td>\n<td>scheduler</td>\n<td>scheduler</td>\n</tr>\n<tr>\n<td>DOM 更新</td>\n<td>定点 Part</td>\n<td>Diff</td>\n<td>Diff</td>\n</tr>\n<tr>\n<td>系统复杂度</td>\n<td>极低</td>\n<td>高</td>\n<td>中</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"92-为什么-lit-可以这么简单\">9.2 为什么 Lit 可以这么“简单”</h3>\n<p>因为 Lit <strong>放弃了三件事</strong>：</p>\n<ol>\n<li>自动依赖追踪</li>\n<li>状态派生（computed）</li>\n<li>跨组件状态管理</li>\n</ol>\n<p>这些都不是组件底层必须解决的问题。</p>\n<hr>\n<h2 id=\"十lit-响应式系统的适用边界\">十、Lit 响应式系统的适用边界</h2>\n<h3 id=\"101-非常适合的场景\">10.1 非常适合的场景</h3>\n<ul>\n<li>UI 组件</li>\n<li>Design System</li>\n<li>跨框架组件</li>\n<li>微前端子模块</li>\n</ul>\n<hr>\n<h3 id=\"102-不适合的场景\">10.2 不适合的场景</h3>\n<ul>\n<li>大型应用状态管理</li>\n<li>复杂状态派生逻辑</li>\n<li>需要大量 computed / watch 的业务</li>\n</ul>\n<p>Lit 的哲学是：</p>\n<blockquote>\n<p><strong>把“状态复杂度”交给使用者或上层架构</strong></p>\n</blockquote>\n<hr>\n<h2 id=\"十一a-very-important-总结\">十一、A Very Important 总结</h2>\n<blockquote>\n<p><strong>Lit 的响应式系统不是“弱”，<br>\n而是“目标非常明确”</strong></p>\n</blockquote>\n<p>它只做三件事：</p>\n<ol>\n<li>监听属性变化</li>\n<li>合并更新</li>\n<li>触发 render</li>\n</ol>\n<p>而剩下的一切，都交给：</p>\n<ul>\n<li>JavaScript 本身</li>\n<li>浏览器本身</li>\n<li>应用架构本身</li>\n</ul>\n<hr>\n<h2 id=\"十二最后\">十二、最后</h2>\n<p>到现在应该可以已经完整理解了：</p>\n<ol>\n<li>Lit 的整体架构</li>\n<li>为什么不需要 Virtual DOM</li>\n<li>lit-html 的 Part 更新机制</li>\n<li>ReactiveElement 的响应式设计</li>\n</ol>\n<p>如果把这些拼起来，you 会发现：</p>\n<blockquote>\n<p><strong>Lit 是一个“极端相信浏览器”的体系</strong></p>\n</blockquote>\n\n</div>\n<div class=\"clear\"></div>\n\n            </div>\n            <div class=\"postDesc\">posted @ \n<span id=\"post-date\" data-last-update-days=\"0\" data-date-updated=\"2025-12-23 10:33\">2025-12-23 10:33</span>&nbsp;\n<a href=\"https://www.cnblogs.com/zxlh1529\">幼儿园技术家</a>&nbsp;\n阅读(<span id=\"post_view_count\">4</span>)&nbsp;\n评论(<span id=\"post_comment_count\">0</span>)&nbsp;\n&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"AddToWz(19370810);return false;\">收藏</a>&nbsp;\n<a href=\"javascript:void(0)\" onclick=\"reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19370810', targetLink: 'https://www.cnblogs.com/zxlh1529/p/19370810', title: 'Lit 的响应式系统为什么这么轻？——从 ReactiveElement 的设计说起' })\">举报</a>\n</div>","guid":{"value":"adc38fbb8be4193bc15835723afd4b18"}}]}