<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-14T04:44:18.654Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ çå®¢å¤§åç¬è¯é¢ç¬è®°-SQL 40-44ï¼èªç¨ï¼ ]]></title>
    <link>https://www.cnblogs.com/gloria0311/p/19481499</link>
    <guid>49777cd015a7565117864a3f81be1e9c</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/gloria0311/p/19481499" title="åå¸äº 2026-01-14 12:42">
    <span role="heading" aria-level="2">çå®¢å¤§åç¬è¯é¢ç¬è®°-SQL 40-44ï¼èªç¨ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p><strong>SQL40 æ¯ä¸ªæTop3çå¨æ°ä¼¦æ­æ²ï¼ä»å¬æ­æµæ°´ä¸­æ¾å°18-25å²ç¨æ·å¨2022å¹´æ¯ä¸ªææ­æ¾æ¬¡æ°top 3çå¨æ°ä¼¦çæ­æ²ã</strong><br>
ç­æ¡ï¼<br>
select sub.month, sub.ranking, sub.song_name, sub.play_pv<br>
from (select MONTH(p.fdate) AS month,<br>
ROW_NUMBER() OVER (<br>
PARTITION BY month(p.fdate)<br>
ORDER BY count(<em>) desc, p.song_id Asc<br>
) AS ranking,<br>
s.song_name,<br>
count(</em>) as play_pv<br>
from play_log p<br>
join song_info s on p.song_id = s.song_id<br>
join user_info u on p.user_id = u.user_id<br>
where s.singer_name = 'å¨æ°ä¼¦' and year(fdate) = 2022 and u.age between 18 and 25<br>
group by month(p.fdate), s.song_name, s.song_id) sub<br>
where sub.ranking &lt;=3<br>
order by sub.month asc, sub.play_pv desc</p>
<p>è¿æ¯ä¸ä¸ªç»å¸çç¨å°å­æ¥è¯¢çé¢ç®ã<br>
é¦åæé¨è¦æç¡®æä»¬ GROUP â RANK â FILTER è¿æ¡é¾æ¡ãè®©ä½ ä»¥åçå°ä»»ä½ Top-N åç»é¢é½ä¸ä¼ä¹±ã</p>
<p>â  GROUP ââ ä½ å°åºå¨ç»ä»ä¹æåï¼</p>
<p>ä½ ä¸æ¯å¨ç»âæ­æ¾è®°å½âæå<br>
ä½ æ¯å¨ç»âæ¯ä¸ªæçæ¯ä¸é¦æ­âæå</p>
<p>æä»¥ç¬¬ä¸ä»¶äºæ°¸è¿æ¯é®ï¼<br>
ææ³æ¯è¾çå¯¹è±¡æ¯è°ï¼æ¬é¢æ¯ï¼(æä»½, æ­æ²)</p>
<p>æä»¥ä½ å¿é¡»åææµæ°´åæè¿ç§è¡¨ï¼</p>
<p>month	song	play_pv<br>
1	ææå°±	4<br>
1	è¯´å¥½çå¹¸ç¦å¢	4<br>
1	å¤§ç¬¨é	2<br>
2	ææå°±	2<br>
2	è¯´å¥½çå¹¸ç¦å¢	1<br>
2	å¤§ç¬¨é	1</p>
<p>è¿ä¸æ­¥å°±æ¯ï¼</p>
<p>GROUP BY month, song<br>
COUNT(*) AS play_pv<br>
æ²¡æè¿ä¸å±ï¼ä½ è¿âæåå¯¹è±¡âé½æ²¡å®ä¹æ¸æ¥ã</p>
<p>â¡ RANK ââ å¨âæ¯ä¸ªç»éé¢âæ</p>
<p>ç°å¨ä½ æäºï¼æ¯ä¸ªæ â å¤é¦æ­ â åèªçæ­æ¾é</p>
<p>æ¥ä¸æ¥ä½ è¦çæ¯ï¼å¨æ¯ä¸ªæåé¨ï¼ææ­æ¾éä»å¤§å°å°æåº</p>
<p>è¿å°±æ¯çªå£å½æ°ï¼</p>
<p>ROW_NUMBER() OVER (<br>
PARTITION BY month<br>
ORDER BY play_pv DESC<br>
)</p>
<p>ä½ æ¯å¨åï¼ä¸æä¸å¼ æ¦ï¼äºæä¸å¼ æ¦ï¼ä¸æä¸å¼ æ¦ï¼ä¸æ¯å¨è¡¨ä¸å¼ æ¦ã</p>
<p>â¢ FILTER ââ åªçä¸å N</p>
<p>çªå£å½æ°ä¸ä¼å é¤æ°æ®ï¼å®åªæ¯å¨âæ å·âã</p>
<p>æ¯å¦ï¼</p>
<p>month	song	play_pv	ranking<br>
1	ææå°±	4	1<br>
1	è¯´å¥½çå¹¸ç¦å¢	4	2<br>
1	å¤§ç¬¨é	2	3<br>
1	â¦	â¦	4<br>
2	ææå°±	2	1<br>
2	è¯´å¥½çå¹¸ç¦å¢	1	2</p>
<p>æåä¸æ­¥å°±æ¯ï¼</p>
<p>WHERE ranking &lt;= 3</p>
<p>ç¨ä¸å¥è¯æ»ç»è¿æ¡é¾</p>
<p>GROUP å³å®âæ¯ä»ä¹â<br>
RANK å³å®âæä¹æ¯â<br>
FILTER å³å®âçä¸è°â</p>
<p><strong>SQL41 æé¿è¿ç»­ç»å½å¤©æ°</strong><br>
æè¿°ï¼ä½ æ­£å¨æ­å»ºä¸ä¸ªç¨æ·æ´»è·åº¦çç»åï¼å¶ä¸­ä¸ä¸ªä¸æ´»è·åº¦ç¸å³çç¹å¾æ¯âæé¿è¿ç»­ç»å½å¤©æ°âï¼ è¯·ç¨SQLå®ç°â2023å¹´1æ1æ¥-2023å¹´1æ31æ¥ç¨æ·æé¿çè¿ç»­ç»å½å¤©æ°â</p>
<p>ç­æ¡ï¼<br>
WITH ordered_logins AS (<br>
SELECT<br>
user_id,<br>
fdate,<br>
ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY fdate) AS rn<br>
FROM<br>
tb_dau<br>
WHERE<br>
fdate BETWEEN '2023-01-01' AND '2023-01-31'<br>
),<br>
grouped_logins AS (<br>
SELECT<br>
user_id,<br>
fdate,<br>
rn,<br>
DATE_SUB(fdate, INTERVAL rn DAY) AS grp<br>
FROM<br>
ordered_logins<br>
)<br>
SELECT<br>
user_id,<br>
MAX(consec_days) AS max_consec_days<br>
FROM (<br>
SELECT<br>
user_id,<br>
grp,<br>
COUNT(*) AS consec_days<br>
FROM<br>
grouped_logins<br>
GROUP BY<br>
user_id, grp<br>
) AS consecutive<br>
GROUP BY<br>
user_id;</p>
<p>è¿ä¸ªé¢åæç¬¬ä¸æ¬¡è§âæé¿è¿ç»­ç»å½å¤©æ°â</p>
<p>é¦åï¼æä»¬éè¦å¯¹æ¯ä¸ªç¨æ·çç»å½æ¥æè¿è¡æåºï¼å¹¶ä¸ºæ¯ä¸ªæ¥æåéä¸ä¸ªåºå·ã<br>
æä»¬ä½¿ç¨ROW_NUMBER()çªå£å½æ°ä¸ºæ¯ä¸ªç¨æ·çç»å½æ¥æåéä¸ä¸ªåºå·ï¼<br>
ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY fdate) AS rn</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3710180/202601/3710180-20260114082136944-1708646280.png" class="lazyload"></p>
<p>ç¬¬äºï¼éè¿è®¡ç®æ¯ä¸ªæ¥æåå»å¶åºå·çç»æï¼æä»¬å¯ä»¥å°è¿ç»­çæ¥æåç»ã<br>
DATE_SUB(fdate, INTERVAL rn DAY)ï¼éè¿æfdateåå»rnå¤©ï¼è¿ç»­çæ¥æå°å·æç¸åçç»æï¼ä»èå¯ä»¥åç»ã</p>
<table>
<thead>
<tr>
<th>fdate</th>
<th>rn</th>
<th>fdate - rn</th>
</tr>
</thead>
<tbody>
<tr>
<td>01-01</td>
<td>1</td>
<td>12-31</td>
</tr>
<tr>
<td>01-02</td>
<td>2</td>
<td>12-31</td>
</tr>
<tr>
<td>01-04</td>
<td>3</td>
<td>01-01</td>
</tr>
<tr>
<td>01-05</td>
<td>4</td>
<td>01-01</td>
</tr>
<tr>
<td>01-06</td>
<td>5</td>
<td>01-01</td>
</tr>
</tbody>
</table>
<p>æåï¼å¯¹æ¯ä¸ªåç»è®¡ç®è¿ç»­å¤©æ°ï¼å¹¶æ¾åºæé¿çè¿ç»­å¤©æ°ã</p>
<table>
<thead>
<tr>
<th>user_id</th>
<th>grp</th>
<th>consec_days</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>12-31</td>
<td>2</td>
</tr>
<tr>
<td>A</td>
<td>01-01</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>COUNT(*) AS consec_daysï¼è®¡ç®æ¯ä¸ªåç»çæ°éï¼å·æç¸åå¤©æ°çæ°éï¼ï¼å³å¯å¾å°è¿ç»­å¤©æ°ã<br>
MAX(consec_days) AS max_consec_daysï¼æ¾åºæ¯ä¸ªç¨æ·çæé¿è¿ç»­å¤©æ°ã<br>
è¿éç¨éäºå­æ¥è¯¢ã</p>
<p>å¶ä¸­çtableåªæ¯ä¸¾ä¸ªä¾å­ä¸æ¯æ¬èº«é¢çtableã</p>
<p><strong>SQL42 åæå®¢æ·é¾ææåµ</strong></p>
<p>ç­æ¡ï¼<br>
select c.pay_ability, CONCAT(ROUND(SUM(CASE WHEN l.overdue_days IS NOT NULL THEN 1 ELSE 0 END)/COUNT(<em>)</em>100,1),'%') AS overdue_ratio<br>
from loan_tb l<br>
join customer_tb c on l.customer_id = c. customer_id<br>
group by c.pay_ability<br>
order by overdue_ratio desc</p>
<p>è¿éé¢çç¹å¨äº  CONCAT(ROUND(SUM(CASE WHEN lt.overdue_days IS NOT NULL THEN 1 ELSE 0 END)/COUNT(<em>)</em>100,1),'%') AS overdue_ratio<br>
éé¢çè¯­æ³ï¼åºå®æ­éè¦è®°ç¢ã</p>
<p>CASE WHEN lt.overdue_days IS NOT NULL THEN 1 ELSE 0 ENDï¼å¤æ­å®¢æ·æ¯å¦æé¾æè¡ä¸ºï¼overdue_dayså­æ®µä¸ä¸ºNULLå³è®°ä½1ï¼å¦åè®°ä½0ã<br>
SUM(...)ï¼è®¡ç®æé¾æè¡ä¸ºçå®¢æ·æ°éï¼å³ä¸ä¸æ­¥è®°ä½1çå®¢æ·æ°éã<br>
COUNT(*)ï¼è®¡ç®æ»å®¢æ·æ°éã<br>
ROUND(...,1)ï¼å°ç»æåèäºå¥ä¿çä¸ä½å°æ°ã<br>
CONCAT(...,'%')ï¼è¾åºæ ¼å¼ä¸ºâæ°å­â+â%âï¼æ­¤å¤ä½¿ç¨å­ç¬¦ä¸²æä½ï¼CONCAT(A,B)å³å°Aå­ç¬¦ä¸²åBå­ç¬¦ä¸²è¿æ¥æâABâå­ç¬¦ä¸²ã</p>
<p><strong>SQL43 è·åæå®å®¢æ·æ¯æçæ¶è´¹é¢</strong><br>
ç­æ¡:<br>
SELECT<br>
DATE_FORMAT(t.t_time, '%Y-%m') AS time,<br>
ROUND(SUM(t.t_amount),1) AS total<br>
FROM<br>
trade t<br>
JOIN<br>
customer c ON t.t_cus = c.c_id<br>
WHERE<br>
t.t_type = 1<br>
AND c.c_name = 'TOM'<br>
AND YEAR(t.t_time) = 2023<br>
GROUP BY<br>
time<br>
ORDER BY<br>
time</p>
<p>å¯¹äºææ¥è¯´è¿éé¢çç¹å¨äº DATE_FORMAT(t.t_time, '%Y-%m') AS timeï¼å°äº¤ææ¶é´æ ¼å¼åä¸ºå¹´æã</p>
<p><strong>SQL44 æ¥è¯¢è¿ç»­å¥ä½å¤æçå®¢æ·ä¿¡æ¯ï¼</strong></p>
<p>ç­æ¡ï¼<br>
SELECT<br>
c.user_id,<br>
c.room_id,<br>
g.room_type,<br>
DATEDIFF(DATE(c.checkout_time), DATE(c.checkin_time)) AS days<br>
FROM checkin_tb c<br>
JOIN guestroom_tb g<br>
ON c.room_id = g.room_id<br>
WHERE DATE(c.checkin_time) = '2022-06-12'<br>
AND DATEDIFF(DATE(c.checkout_time), DATE(c.checkin_time)) &gt;= 2<br>
ORDER BY<br>
days ASC,<br>
c.room_id ASC,<br>
c.user_id DESC;</p>
<p>select *<br>
from(<br>
select c.user_id, c.room_id, g.room_type, DATEDIFF(DATE(c.checkout_time), DATE(c.checkin_time)) AS days<br>
from checkin_tb c<br>
join guestroom_tb g on c.room_id = g.room_id<br>
WHERE DATE(c.checkin_time) = '2022-06-12'<br>
) as t<br>
where t.days &gt;=2<br>
order by days asc, room_id asc, user_id desc</p>
<p>è¿éé¢æ¯å¨èå¯¹âæ¶é´ + SQL æ§è¡é»è¾ + ä¸å¡è¯­ä¹âççè§£æ¯å¦åç¡®ã</p>
<p>ç¬¬ä¸ï¼éåºè¡ä¸éï¼è¿ç»­å¥ä½å¤©æ° = ä½äºå æãä¹å°±æ¯ï¼éæ¿æ¥æ â å¥ä½æ¥æãä¸æ¯ 24 å°æ¶çæ´å¤©æ°ã</p>
<p>ä½ å¦æç¨ï¼TIMESTAMPDIFF(DAY, checkin_time, checkout_time)å°±éäºãä½ ç®çæ¯ï¼è¿äºå ä¸ªå®æ´ç 24 å°æ¶ãèé¢ç®è¦çæ¯ï¼è·¨äºå ä¸ªæä¸ï¼æ¥åå¤©ï¼<br>
æä»¥ä¸å®è¦ç¨ï¼DATEDIFF(DATE(checkout_time), DATE(checkin_time))</p>
<p>ç¬¬äºï¼DATETIME ä¸å®è¦åè½¬æ DATEï¼å¨æäºæ°æ®åºä¸­ä¼éå¼æªæ­ãå¨æäºä¼æ¥éãå¨æäºä¼åæ 0ãå¡æ¯ç®âå¤© / æ / æ¥æå·®âï¼ä¸å®è¦ï¼å DATE() å DATEDIFF()ãè¿æ¯æ°æ®ä»åºå·¥ç¨çåºæ¬åã</p>
<p>ç¬¬ä¸ï¼SQLçæ§è¡é¡ºåºæ¯<br>
FROM<br>
â JOIN<br>
â WHERE<br>
â SELECT<br>
â ORDER BY<br>
days å¨ WHERE æ¶è¿ä¸å­å¨ï¼åªè½å¨ ORDER BY ç¨ï¼æ³å¨ WHERE ç¨ â å¿é¡»ç¨å­æ¥è¯¢ / CTEï¼è¿å°±æ¯ä½ ä¸ºä»ä¹åå­æ¥è¯¢çåå ã<br>
ä¸åå­æ¥è¯¢çè¯å°±ååä¸éWHERE DATE(c.checkin_time) = '2022-06-12'AND DATEDIFF(DATE(c.checkout_time), DATE(c.checkin_time)) &gt;= 2</p>
<p>ç¬¬åï¼æä¸å¼å§åäº GROUP BYï¼è¿ä¹æ¯ä¸ä¸ªå¸åæ°æéè¯¯ã<br>
ç°å¨åçæ¯ï¼ä¸æ¡å¥ä½è®°å½ â ç®è¿ä¸æ¬¡ä½äºå æï¼è¿æ¯ è¡çº§è®¡ç®ï¼row-levelï¼<br>
ä¸æ¯ä¸ä¸ªç¨æ· â æ»å±ä½äºå æï¼aggregationï¼<br>
æä»¥ï¼ä¸è¯¥ç¨ GROUP BYï¼ä¸è¯¥ç¨ HAVING</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 12:42">2026-01-14 12:42</span>&nbsp;
<a href="https://www.cnblogs.com/gloria0311">GloriaQi</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19481499);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19481499', targetLink: 'https://www.cnblogs.com/gloria0311/p/19481499', title: 'çå®¢å¤§åç¬è¯é¢ç¬è®°-SQL 40-44ï¼èªç¨ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ éç£ï¼Volcanoåå¸AgentCubeï¼æå»ºAI Agentæ¶ä»£çäºåçåºç¡è®¾æ½ ]]></title>
    <link>https://www.cnblogs.com/huaweiyun/p/19481441</link>
    <guid>ab3265cccd8ea2556074a24044213c4d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huaweiyun/p/19481441" title="åå¸äº 2026-01-14 12:23">
    <span role="heading" aria-level="2">éç£ï¼Volcanoåå¸AgentCubeï¼æå»ºAI Agentæ¶ä»£çäºåçåºç¡è®¾æ½</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1><strong>éç£ï¼Volcanoåå¸AgentCubeï¼æå»ºAI Agentæ¶ä»£çäºåçåºç¡è®¾æ½</strong></h1>
<p>äºåçæ¹éè®¡ç®å¼æ <a href="https://volcano.sh/" rel="noopener nofollow">Volcano ç¤¾åº</a>å¨æ°å­é¡¹ç® <a>AgentCube</a> ç°å·²æ­£å¼åå¸ãAgentCubeçè¯çåºäº Volcano å¨å¤§è§æ¨¡é«æ§è½è®¡ç®è°åº¦é¢åå¤å¹´ççäº§å®è·µç§¯ç´¯ï¼å®å°è¿ç§é«å¹¶åãé«ååçè°åº¦è½åå»¶ä¼¸è³ AI é¢åï¼æå»ºäºä¸å¥é¢åæºè½ä½ï¼Agentï¼å·¥ä½è´è½½ç Serverless ç¼æå±ï¼æ¨å¨ä¸ºé«å¹¶åãé¿ä¼è¯ãå¯¹å»¶è¿æåº¦ææçæºè½ä½ï¼Agentï¼å·¥ä½è´è½½æä¾ <strong>Serverless åçç¼æä¸æéè°åº¦è½å</strong>ã</p>
<p>&nbsp;<img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260114122335610-1314246875.png" class="lazyload"></p>
<h2><strong>ä» Kubernetes å° Agent Native</strong></h2>
<p>éçå¤§è¯­è¨æ¨¡åï¼LLMï¼ææ¯çæçï¼ææ¯æ¶ææ­£ä»âæ ç¶ææ¨çâåâèªä¸»æºè½ä½ï¼Autonomous Agentsï¼âæ¼è¿ã</p>
<p>å¨è¿ä¸è¿ç¨ä¸­ï¼<strong>Kubernetes å­åå¶æçççæåå¯¹å¼æç®åçæ ååç®¡çï¼å·²æä¸ºæå»º AI åºç¡è®¾æ½çäºå®æ å</strong>ãè½ç¶åç Kubernetes æä¾äºéç¨çå®¹å¨ç¼æåè¯­ä»¥åå¤æ ·åçå·¥ä½è´è½½æ½è±¡ï¼ä½å¨é¢å¯¹ AI Agent è¿ç§âé«å¹¶åãç­æ¶æãå¼ºç¶æä¾èµâçæ°åè´è½½æ¶ï¼ä»å­å¨çæ¾èç<strong>ç²åº¦éé</strong>ä¸<strong>æºå¶ç¼ºä½</strong>ï¼</p>
<p><strong>1.å¯å¨å»¶è¿ä¸äº¤äºä½éªççç¾</strong></p>
<p>Agent çäº¤äºéå¸¸è¦æ±æ¯«ç§çº§ååºãç¶èï¼åçç K8s Pod å¯å¨æµç¨ï¼è°åº¦ãIP åéãéåæåãå®¹å¨å¯å¨ï¼å¾å¾å¨ç§çº§çè³åéçº§ãå¯¹äºéè¦é¢ç¹æèµ· Code Interpreterï¼ä»£ç è§£éå¨ï¼æä¸´æ¶å­ Agent çåºæ¯ï¼è¿ç§å·å¯å¨å»¶è¿æ¯ç¨æ·æ æ³æ¥åçã</p>
<p><strong>2.èµæºå©ç¨ççææï¼</strong>Agent æ¯å¸åç <strong>IO å¯éå</strong>è´è½½ãå¨ä¸æ¬¡ä¼è¯ä¸­ï¼90% çæ¶é´ Agent å¯è½é½å¨ç­å¾ LLM çæ Token æç­å¾å¤é¨å·¥å·ååºãå¦æå¨ K8s ä¸ä¸ºæ¯ä¸ª Agent ç¬å ä¸ä¸ª Podï¼ä¼å¯¼è´å¤§éç CPU/Memory èµæºå¨ç­å¾æé´è¢«é²ç½®æµªè´¹ï¼å´æ æ³è¢«å¶ä»ä»»å¡å¤ç¨ã</p>
<p><strong>3.ä¼è¯ç¶æç®¡ççç¼ºå¤±ï¼</strong>K8s å¯¹âæ ç¶æï¼Statelessï¼âå·¥ä½è´è½½å¤©ç¶åå¥½ï¼ä½ Agent é«åº¦ä¾èµâä¸ä¸æï¼Context/Memoryï¼âãå¨åç K8s ä¸­ï¼Pod éå¯æå³çåå­æ°æ®ä¸¢å¤±ï¼å¼åèè¢«è¿«å¨åºç¨å±éè¿å¤é¨å­å¨éå»ºä¸ä¸æï¼è¿å¸¦æ¥äºå·¨å¤§çå¤ææ§åç½ç»å¼éã</p>
<p><strong>4.å®å¨éç¦»é¾é¢ï¼</strong>é«çº§ Agentï¼å¦ Data Analystï¼éè¦è¿è¡ç± LLM çæçä¸å¯ä¿¡ä»£ç ãä½æ®éç runC å®¹å¨å¦æè¿è¡ rm -rf / å·ææé«é£é©ãä¼ä¸çº§ Agent å¹³å°è¿«åéè¦ä¸ç§æ¢è½å¿«éå¯å¨ï¼åè½æä¾å¼ºéç¦»ï¼å¦ MicroVMï¼çæ²ç®±ç¯å¢ã</p>
<p><strong>ä¸ºäºå¨ Kubernetes åå®çç®ååºåº§ä¹ä¸ï¼å¡«è¡¥ä¸è¿°æºå¶ç©ºç½</strong>ï¼AgentCube åºè¿èçã</p>
<p>&nbsp;</p>
<h2><strong>AgentCube æ¯ä»ä¹ï¼</strong></h2>
<p><strong>AgentCube</strong> æ¯ä¸ä¸ªæå»ºå¨ Volcano ä¹ä¸çé«æ§è½ AI Agent ç¼æå±ãå®éè¿æ©å± Kubernetes APIï¼å° <strong>Agents</strong> å Toolsï¼<strong>Code InterpretersãBrowserUseç­ï¼</strong> æåä¸ºéç¾¤çä¸ç­å¬æ°ã</p>
<p>å®ä¸ä»ä»æ¯ä¸ä¸ª CRDï¼æ´æ¯ä¸å¥ <strong>é¢å Agent ç Serverless æä½ç³»ç»</strong>ã</p>
<h3><strong>æ ¸å¿æ¶æä¸æ½è±¡</strong></h3>
<p>AgentCube å¼å¥äºä¸¤ä¸ªæ ¸å¿ç CRD æ¥å®ä¹ Agent å·¥ä½è´è½½ï¼</p>
<p><strong>1.AgentRuntime:</strong>&nbsp; é¢åé¿ä¼è¯ãå¤æçå¯¹è¯å¼ Agentã</p>
<p>â æ¯æå®ä¹ä¼è¯ççå½å¨æãèµæºéé¢ä»¥åæä¹åç­ç¥ã</p>
<p><em id="__mceDel"><strong>2.CodeInterpreter:</strong>&nbsp; é¢åç­ä»»å¡ãé«é¢çä»£ç æ§è¡ç¯å¢ã</em></p>
<p>â å¼ºè°âç¨å®å³æ¯âåæè´çå®å¨éç¦»ï¼å¤©ç¶éé MicroVMï¼å¦ Kuasar, Kata Containers, Firecrackerï¼ã</p>
<p>AgentCubeåç»­è¿å°æä¾BrowserUseãComputerUseãMobileUseç­å·¥ä½è´è½½æ½è±¡æ¯æã</p>
<p>&nbsp;</p>
<h2><strong>AgentCube å³é®ææ¯äº®ç¹</strong></h2>
<p>ä¸ºäºè§£å³ä¸è¿°çç¹ï¼AgentCube å¨æ¶æè®¾è®¡ä¸å¼å¥äºå¤é¡¹åæ°ï¼</p>
<h3><strong>1. æéå¯å¨</strong></h3>
<p>ä¸ºäºæ¶é¤å·å¯å¨çææï¼AgentCube å®ç°äº <strong>Warm Poolï¼é¢ç­æ± ï¼</strong> æºå¶ãç³»ç»ä¼é¢åå¯å¨å¹¶æåä¸ç»ææåºç¡ç¯å¢ç MicroVM æ²ç®±ãå½ Agent è¯·æ±å°æ¥æ¶ï¼AgentCube è½å¤éè¿ <strong>"Claim-and-Go"</strong> çæ¹å¼ï¼å¨æ¯«ç§çº§å°é¢ç­çæ²ç®±åéç»ä¼è¯ï¼å®ç°è¿ä¹é¶å»¶è¿çå¯å¨ä½éªã</p>
<h3><strong>2. æéè°åº¦</strong></h3>
<p>åå© Volcano ç <strong>Agent Scheduler</strong>ï¼AgentCubeæ¾èæåäºAgentè°åº¦çåååæ¶å»¶ã</p>
<ul>
<li><strong>é«ååãä½æ¶å»¶ï¼</strong> éå¯¹ Agent çªåæµéï¼éç¨äºä¹è§å¹¶åæ§å¶åç²¾ç®çè°åº¦ç­ç¥ï¼å¤§å¹æåè°åº¦ TPSã</li>
<li><strong>ç»ä¸è°åº¦æ¯æï¼</strong> Volcano ç Agent Scheduler å¯ä»¥ä¸åæç Batch Scheduler æ ç¼éåï¼å¨åè° Agent ä¸ä¼ ç»ç Batch ä½ä¸æ½å¨è°åº¦å²çªçåæ¶ï¼ç¡®ä¿æ´ä½éç¾¤çèµæºå©ç¨çåå³é®ä¸å¡ç SLAã</li>
</ul>
<h3><strong>3. åçä¼è¯ç®¡ç</strong></h3>
<p>AgentCube å¼å¥äº <strong>Session ID</strong> ä½ä¸ºæ ¸å¿è·¯ç±æ è¯ï¼<strong>ä¾¿äºä¿è¯ä¸å¡ä¸ä¸æçè¿ç»­æ§ã</strong></p>
<ul>
<li><strong>è¯·æ±è·¯ç±ï¼</strong> AgentCube Router è½å¤è¯å«è¯·æ±ä¸­ç x-agentcube-session-idï¼èªå¨å°å¶è·¯ç±å°å¯¹åºçæ´»è·æ²ç®±ã</li>
<li><strong>èªå¨çæ²ç®±æ¿æ´»ï¼</strong> å½åä¼è¯å¯¹åºçæ²ç®±å¤äºä¼ç ç¶ææ¶ï¼AgentCube Router&nbsp;è½å¤èªå¨æ¿æ´»æ²ç®±ã</li>
<li><strong>åºäºä¼è¯çç«¯å°ç«¯éç¦»ï¼</strong>&nbsp;AgentCube ä¼èªå¨ä¸ºæ¯ä¸ªä¼è¯åéç¬ç«çæ²ç®±ç¯å¢ï¼ç¡®ä¿è®¡ç®ãåå­ä¸æä»¶ç³»ç»çå®å¨éç¦»ï¼é²æ­¢è·¨ç§æ·çæ°æ®æ³é²ã</li>
</ul>
<h3><strong>4. Serverless åçå¼¹æ§ä¼¸ç¼©</strong></h3>
<p>AgentCube è½å¤æ ¹æ®ä¼è¯çæ´»è·åº¦èªå¨ç®¡çæ²ç®±çå½å¨æãé²ç½®çæ²ç®±ä¼è¢«èªå¨åæ¶æä¼ç ï¼éæ¾ç©çèµæºä¾å¶ä»é«ä¼åçº§ä»»å¡ä½¿ç¨ï¼çæ­£å®ç°<strong>èµæºæéåéä¸æè´å©ç¨</strong>ã</p>
<p>&nbsp;</p>
<h2><strong>AgentCube æ¶ææ¦è§</strong></h2>
<p align="center"><img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260114122335598-1139082100.png" class="lazyload">&nbsp;</p>
<p>&nbsp;</p>
<p>AgentCube éç¨äºç»å¸ç<strong>æ§å¶é¢ä¸æ°æ®é¢åç¦»</strong>çæ¶æè®¾è®¡ï¼ç¡®ä¿äºç³»ç»çé«å¯ç¨æ§ä¸æ©å±æ§ï¼</p>
<ul>
<li><strong>æ°æ®é¢ :</strong> ç± <strong>AgentCube Router</strong> æ¿è½½ãå®ä½ä¸ºæµéå¥å£ï¼è´è´£é´æãéæµä»¥ååºäº Session ID çæºè½è·¯ç±ãå¯¹äºæ°ä¼è¯ï¼å®åæ§å¶é¢ç³è¯·èµæºï¼å¯¹äºæ´»è·ä¼è¯ï¼å®ç´æ¥å°è¯·æ±è½¬åè³å¯¹åºç <strong>Sandbox (MicroVM)</strong>ã</li>
<li><strong>æ§å¶é¢ :</strong> æ ¸å¿ç»ä»¶ <strong>Workload Manager</strong> è´è´£æ²ç®±çå¨çå½å¨æç®¡çãå®çæ§é¢ç­æ±  (Warm Pool) çæ°´ä½ï¼èªå¨è¡¥å MicroVM å®ä¾ï¼å¹¶æ ¹æ®ä¼è¯æ´»è·åº¦ç­ç¥ï¼å¦ TTLï¼æ§è¡æ²ç®±çåæ¶ä¸åå¾æ¸çã</li>
<li><strong>è°åº¦å±:</strong> éæ <strong>Volcano Agent Scheduler</strong>ï¼éè¿å¼æ­¥å¹¶è¡è°åº¦åä¹è§éæºå¶ï¼å®ç°é«å¹¶åä¸çæ¯«ç§çº§èµæºåéã</li>
</ul>
<p>&nbsp;</p>
<h2><strong>çæåä½ï¼å±å»ºæ ååç Agent åºç¡è®¾æ½</strong></h2>
<p>ä½ä¸ºå¼æºä¸­ç«çåºç¡è®¾æ½é¡¹ç®ï¼AgentCube æ¨å¨éè¿æ åæ¥å£è¿æ¥ä¸ä¸æ¸¸çæï¼åä½è§£å³ä»å®¹å¨ç¼æå°æºè½ä½åºç¨è½å°çâæåä¸å¬éâé¾é¢ã</p>
<h3><strong>1. ååå¼å®¹ï¼åºäºæ åæ¥å£çè¿è¡æ¶éé</strong></h3>
<p>AgentCube åæå¼æ¾æ¶æè®¾è®¡ï¼éè¿æ·±åº¦éæ kubernetes-sigs/agent-sandbox æ¥å£å OCI æ åï¼å®ç°å¯¹åºå±å¼æè¿è¡æ¶çç»ä¸æ½è±¡ä¸æ æééã</p>
<ul>
<li><strong>è¿è¡æ¶è§£è¦ï¼</strong> æ¯æéè¿ RuntimeClass æºå¶æ¥å¥ KuasarãKata ContainersãFirecracker ç­å®å¨å®¹å¨ææ¯ï¼åè®¸ç¨æ·æ ¹æ®å®å¨ä¸æ§è½éæ±çµæ´»éæ©åºå±éç¦»æ¹æ¡ã</li>
<li><strong>åæ²¿æ¢ç´¢ï¼</strong> ç¤¾åºæ­£å¨è¯ä¼° Wasm (WebAssembly) ææ¯ï¼è®¡åå¨æªæ¥çæ¬ä¸­æ¢ç´¢å¶å¨æè½»éçº§ Agent ä»»å¡ä¸­çåºç¨ï¼ä»¥æä¾æ´å¤æ ·åçç®åä¾ç»ã</li>
</ul>
<h3><strong>2. ååéæï¼æå¡ä¸»æµAgentæ¡æ¶</strong></h3>
<p>å¨åºç¨å±ï¼AgentCube è´åäºæä¸º DifyãLangChainãCrewAIãLlamaIndex ç­Agentæ¡æ¶çæ ååºç¡è®¾æ½åºåº§ï¼ç¸å³ééå·¥ä½æ­£å¨å¿«éè¿­ä»£ä¸­ã</p>
<ul>
<li><strong>å£°æå¼ç®¡çï¼</strong> å°éè¿ Operator æ¨¡å¼æä¾å£°æå¼èµæºæ¥å£ï¼å¸®å©ä¸å±æ¡æ¶å¥ç¦»åºå±çæ²ç®±é¢ç­æ± ç®¡çä¸ç½ç»éç½®ç­é»è¾ã</li>
<li><strong>ç»ä¸åºåº§ï¼</strong> ç®æ æ¯å®ç°ä¸å¡ç¼æä¸èµæºè°åº¦çè§£è¦ï¼ä½¿ä¸åæ¡æ¶å¼åçåºç¨è½å¤ç¨åä¸å¥äºåçè¿ç»´ä½ç³»ï¼éä½åºç¡è®¾æ½çç»´æ¤ææ¬ä¸ç¢çåç¨åº¦ã</li>
</ul>
<p>&nbsp;</p>
<h2><strong>çµæ´»æ¥å¥ï¼å¼é¡¾å¼åä¸è¿ç»´ä½éª</strong></h2>
<p>AgentCube è®¾è®¡äºåå±çæ¥å¥æ¥å£ï¼æ¨å¨åæ¶æ»¡è¶³ä¸å±ä¸å¡å¼åèä¸åºå±å¹³å°å·¥ç¨å¸çè¯æ±ï¼è®©åºç¡è®¾æ½ä¸åæä¸ºé»çã</p>
<p><strong>1. é¢å Agent å¼åèï¼æ å API æ¥å¥</strong></p>
<p>ä¸ºäºè¿ä¸æ­¥éä½æ¥å¥é¨æ§ï¼AgentCube æä¾äºå¼ç®±å³ç¨ç<a href="https://github.com/volcano-sh/agentcube/tree/main/sdk-python" rel="noopener nofollow"><strong>Python SDK</strong></a>ãå¼åèæ éæ·±å¥çè§£ Kubernetes çå¤ææ¦å¿µï¼å³å¯åè°ç¨æ¬å°å½æ°ä¸æ ·ç³è¯·ãæ§è¡åéæ¾æ²ç®±ãè¿ä½¿å¾ AgentCube è½å¤è½»æ¾éæå° DifyãLangChainãCrewAIãLlamaIndex ç­ä¸»æµæ¡æ¶ä¸­ã</p>
<p>ç¤ºä¾1ï¼å¨agentä»£ç ä¸­å¨ææèµ·ä¸ä¸ªCodeInterpreterå¹¶è¿è¡ä¸´æ¶ä»£ç </p>
<div align="center">
<div class="cnblogs_Highlighter" style="text-align: left">
<p># python</p>
<p>from agentcube import CodeInterpreterClient</p>
<p>&nbsp;</p>
<p># Initialize client (uses env vars for configuration)</p>
<p>with CodeInterpreterClient() as client:</p>
<p>&nbsp;&nbsp;&nbsp; # 1. Run a simple shell command</p>
<p>&nbsp;&nbsp;&nbsp; print("User: whoami")</p>
<p>&nbsp;&nbsp;&nbsp; print(client.execute_command("whoami"))</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp; # 2. Execute Python code</p>
<p>&nbsp;&nbsp;&nbsp; code = """</p>
<p>&nbsp;&nbsp;&nbsp; import math</p>
<p>&nbsp;&nbsp;&nbsp; print(f"Pi is approximately {math.pi:.4f}")</p>
<p>&nbsp;&nbsp;&nbsp; """</p>
<p>&nbsp;&nbsp;&nbsp; output = client.run_code("python", code)</p>
<pre class="brush:csharp;gutter:true;">&nbsp;&nbsp;&nbsp; print(f"Result: {output}")ã</pre>
</div>
</div>
<p>ç¤ºä¾2ï¼éè¿kubectl agentcubeå½ä»¤è¡å·¥å·åå»ºä¸ä¸ªAgent</p>
<div class="cnblogs_Highlighter">
<p><strong># 1. Package an existing agent:</strong></p>
<p>kubectl agentcube pack -f examples/hello-agent --agent-name "my-agent"</p>
<p><strong># 2. Build the container image:</strong></p>
<p>kubectl agentcube build -f examples/hello-agent</p>
<p><strong># 3. Publish to AgentCube:</strong></p>
<p>kubectl agentcube publish \</p>
<p>&nbsp;&nbsp; -f examples/hello-agent \</p>
<p>&nbsp;&nbsp; --image-url "docker.io/username/my-agent" \</p>
<p><strong># 4. Invoke your agent:</strong></p>
<p>kubectl agentcube invoke -f examples/hello-agent --payload '{"prompt": "Hello World!"}'</p>
<p><strong># 5. Check status:</strong></p>
<pre class="brush:csharp;gutter:true;">kubectl agentcube status -f examples/hello-agent</pre>
</div>
<p><strong>2. é¢åå¹³å°å·¥ç¨å¸ï¼å£°æå¼ CRD ç®¡ç</strong></p>
<p>AgentCube å»¶ç»­äºäºåççå£°æå¼ç®¡çæ¨¡å¼ãè¿ç»´å¢éå¯ä»¥éè¿ CRD (AgentRuntime, CodeInterpreter) ç²¾ç»åå®ä¹èµæºæ± ç­ç¥ï¼ç´æ¥å¤ç¨ç°æç Kubernetes è¿ç»´ä½ç³»ä¸å·¥å·é¾è¿è¡ç»ä¸ç®¡çã</p>
<p>ç¤ºä¾ï¼å®ä¹ä¸ä¸ªCodeInterpreterï¼å§ç»ä¿æ 10 ä¸ªç­å¤æ²ç®±</p>
<div class="cnblogs_Highlighter">
<p># YAML</p>
<p>apiVersion: runtime.agentcube.volcano.sh/v1alpha1</p>
<p>kind: CodeInterpreter</p>
<p>metadata:</p>
<p>&nbsp; name: simple-codeinterpreter</p>
<p>&nbsp; namespace: default</p>
<p>spec:</p>
<p>&nbsp; template:</p>
<p>&nbsp;&nbsp;&nbsp; image: ghcr.io/volcano-sh/picod:latest</p>
<p>&nbsp; sessionTimeout: "15m"</p>
<p>&nbsp; maxSessionDuration: "8h"</p>
<pre class="brush:csharp;gutter:true;">&nbsp; warmPoolSize: 10 &nbsp;&nbsp;# é¢ç­æ°´ä½</pre>
</div>
<p><strong>æ³äº²èªä½éªï¼</strong> å®æ´çå®è£é¨ç½²ææ¡£ä¸ Demo ç¤ºä¾ï¼è¯·è®¿é® GitHub ä»åºï¼<a href="https://www.google.com/search?q=https://github.com/volcano-sh/agentcube&amp;authuser=5" rel="noopener nofollow">https://github.com/volcano-sh/agentcube</a></p>
<p>&nbsp;</p>
<h2><strong>å å¥ç¤¾åº</strong></h2>
<p>AgentCube æ¯ Volcano ç¤¾åºçä¸é¨åï¼éµå¾ªå¼æºå¼æ¾çååãæä»¬è¯æéè¯·å¯¹ <strong>AI InfraãKubernetes è°åº¦ãServerless æ¶æ</strong> æå´è¶£çå¼åèå å¥æä»¬ï¼</p>
<ul>
<li><strong>AgentCube GitHub:</strong> <a href="https://www.google.com/search?q=https://github.com/volcano-sh/agentcube" rel="noopener nofollow">github.com/volcano-sh/agentcube</a> (æ¬¢è¿ Star )</li>
<li><strong>Slack:</strong> CNCF Slack #volcano é¢é</li>
<li><strong>Community Meeting:</strong> <a href="https://zoom.us/j/91804791393" rel="noopener nofollow">https://zoom.us/j/91804791393</a></li>
</ul>
<p>è®©æä»¬ä¸èµ·ï¼ä¸º AI Agent æ¶ä»£æå»ºæ´å¼ºå¤§çåºç¡è®¾æ½ï¼</p>
<div align="center"><hr align="center" size="2" width="100%"></div>
<p>Volcano ï¼<a href="https://volcano.sh/" rel="noopener nofollow">https://volcano.sh</a>ï¼æ¯ä¸çé¦ä¸ªäºåçæ¹éè®¡ç®å¼æï¼ä¹æ¯ CNCF é¦ä¸ªåå¯ä¸çæ¹éè®¡ç®é¡¹ç®ãé¡¹ç®ä¸»è¦ç¨äº AIãå¤§æ°æ®ãåºå ãæ¸²æç­è¯¸å¤é«æ§è½è®¡ç®åºæ¯ï¼å¯¹ä¸»æµéç¨è®¡ç®æ¡æ¶åæå¾å¥½çæ¯æãç®åï¼Volcanoå¨äººå·¥æºè½ãå¤§æ°æ®ãåºå æµåºç­æµ·éæ°æ®è®¡ç®ååæåºæ¯å·²å¾å°å¿«éåºç¨ï¼å·²å®æå¯¹ SparkãFlinkãRayã TensorflowãPyTorchãArgoãMindSporeãPaddlepaddle ãKubeflowãMPIãHorovodãMxnetãKubeGene ç­ä¼å¤ä¸»æµè®¡ç®æ¡æ¶çæ¯æï¼å¹¶æå»ºèµ·å®åçä¸ä¸æ¸¸çæã</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 12:24">2026-01-14 12:23</span>&nbsp;
<a href="https://www.cnblogs.com/huaweiyun">åä¸ºäºå¼åèèç</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19481441);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19481441', targetLink: 'https://www.cnblogs.com/huaweiyun/p/19481441', title: 'éç£ï¼Volcanoåå¸AgentCubeï¼æå»ºAI Agentæ¶ä»£çäºåçåºç¡è®¾æ½' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ PHP 8.5 åçº§çå­æåï¼é¿ååæ¨ä¸¤ç¹åæ»çæ£æ¥æ¸å ]]></title>
    <link>https://www.cnblogs.com/catchadmin/p/19479967</link>
    <guid>d088b37c914c481da8416f6e7c9f37ca</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/catchadmin/p/19479967" title="åå¸äº 2026-01-14 07:43">
    <span role="heading" aria-level="2">PHP 8.5 åçº§çå­æåï¼é¿ååæ¨ä¸¤ç¹åæ»çæ£æ¥æ¸å</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="php-85-åçº§çå­æåé¿ååæ¨ä¸¤ç¹åæ»çæ£æ¥æ¸å">PHP 8.5 åçº§çå­æåï¼é¿ååæ¨ä¸¤ç¹åæ»çæ£æ¥æ¸å</h1>
<h2 id="åçº§-php-ä¸é¾è¢«åæé¾">åçº§ PHP ä¸é¾ï¼è¢«åæé¾</h2>
<p>ä¸æåæ¯åé£ç§"ä½ æ°¸è¿ä¸æ³èµ¶å·¥"çå·¥ä½çå¥½æ¶æºï¼è¿è¡æ¶åçº§ã</p>
<p>å¤§å¤æ° PHP 8.x å°çæ¬åçº§å¾é¡ºå©ï¼ä½"é¡ºå©"ä¸ç­äº"é¶é£é©"ãçæ­£çé®é¢éå¸¸æ¥èªï¼</p>
<ul>
<li>éèçå¹³å°çº¦æï¼æ©å±ãç³»ç»åºãSAPIï¼ï¼</li>
<li>è½ç¼è¯ä½è¡ä¸ºä¸åçä¾èµï¼</li>
<li>è¢«å¿½ç¥å¤å¹´çè­¦å/å¼ç¨çªç¶æ·¹æ²¡æ¥å¿ï¼</li>
<li>åè®¾åæ»"å¾ç®å"çä¸çº¿è®¡åï¼å®éä¸å¾å°ç®åï¼ã</li>
</ul>
<p>è¿ç¯æç« ä¾§éå®æãæä¸ä¼éæ°è®² PHP 8.5 çæ°ç¹æ§ï¼æ¯å¦ç®¡éæä½ç¬¦æ URI å¤çãæ°ç¹æ§åªä¼ä½ä¸ºå¼å®¹æ§æ£æ¥ç¹ç®åæåãç®æ æ¯åæå¹´äººä¸æ ·åå¸ PHP 8.5ï¼æè®¡åãæé²æ¤ãæçæ§ãæçæ­£è½ç¨çåæ»è·¯å¾ã</p>
<p>PHP 8.5 çç¨³å®çäº 2025 å¹´ 11 æ 20 æ¥åå¸ï¼éµå¾ªæ­£å¸¸ç PHP æ¯æå¨æã</p>
<p><a href="https://catchadmin.com/post/2026-01/php85-upgrade-survival-guide-checklist" target="_blank" rel="noopener nofollow">åæ PHP 8.5 åçº§çå­æåï¼é¿ååæ¨ä¸¤ç¹åæ»çæ£æ¥æ¸å</a></p>
<h2 id="ç¡®å®ç®æ çæ¬å®ä¹åé¨æ¯æç­ç¥">ç¡®å®ç®æ çæ¬ï¼å®ä¹åé¨æ¯æç­ç¥</h2>
<p>å¨å¨ CI æ Composer ä¹åï¼ååç­ä¸ä¸ªé®é¢ï¼</p>
<p><strong>å¨ä½ çç»ç»éï¼è¿æ¬¡åçº§"å®æ"æå³çä»ä¹ï¼</strong></p>
<h3 id="ç¡®å®ç®æ åæªæ­¢æ¥æ">ç¡®å®ç®æ åæªæ­¢æ¥æ</h3>
<p>PHP åæ¯æä¸¤å¹´çæ´»è·æ¯æï¼ç¶åæ¯ä¸¤å¹´çå®å¨ä¿®å¤ã</p>
<p>å®æ¹æ¯æè¡¨ï¼</p>
<ul>
<li>PHP 8.5ï¼2025 å¹´ 11 æ 20 æ¥åå§åå¸</li>
<li>æ´»è·æ¯æè³ 2027 å¹´ 12 æ 31 æ¥</li>
<li>å®å¨æ¯æè³ 2029 å¹´ 12 æ 31 æ¥</li>
</ul>
<p>æ¯æçªå£å¾å®½è£ââä½ä½ çåé¨æªæ­¢æ¥æéå¸¸ç±ä»¥ä¸å ç´ é©±å¨ï¼</p>
<ul>
<li>åè§è¦æ±ï¼</li>
<li>æç®¡éå / åºç¡å®¹å¨ï¼</li>
<li>æ¡æ¶æ¯æçªå£ï¼</li>
<li>åçå¨"ä»å®å¨ä¿®å¤"é¶æ®µçææ¬ã</li>
</ul>
<h3 id="å®ä¹èå´åçº§å¸¸å¸¸å¨è¿éæ å£°å¤±è´¥">å®ä¹èå´ï¼åçº§å¸¸å¸¸å¨è¿éæ å£°å¤±è´¥ï¼</h3>
<p>åä¸ä»ä¹åå«ãä»ä¹ä¸åå«ï¼</p>
<p><strong>åå«ï¼</strong></p>
<ul>
<li>è¿è¡æ¶çæ¬åçº§ï¼FPM/CLIï¼ï¼</li>
<li>Composer ä¾èµè°æ´ï¼</li>
<li>CI ç©éµæ´æ°ï¼</li>
<li>çäº§ç¯å¢ä¸çº¿ç­ç¥ï¼</li>
<li>åçº§åéªè¯ã</li>
</ul>
<p><strong>ä¸åå«ï¼é¤éä½ æç¡®å è¿å»ï¼ï¼</strong></p>
<ul>
<li>éæä»£ç ä»¥ä½¿ç¨ PHP 8.5 æ°ç¹æ§ï¼</li>
<li>ä¸ PHP 8.5 æ å³çä¸»è¦æ¡æ¶åçº§ï¼</li>
<li>"é¡ºææ¹"çéåã</li>
</ul>
<p>å¦æä¸å®ä¹èå´ï¼"åçº§"ä¼åæ"éå"ï¼ç¶åå°±ä¼åæ»ã</p>
<h3 id="æåå³å®å¼å®¹æ§ç­ç¥">æåå³å®å¼å®¹æ§ç­ç¥</h3>
<p>å¦æä»£ç åºéè¦å¨æ§ç PHP å 8.5 ä¸åæ¶è¿è¡ä¸æ®µæ¶é´ï¼</p>
<ul>
<li>ç¨ CI å¼ºå¶åçæ¬å¼å®¹ï¼</li>
<li>å¨çäº§ç¯å¢åå° 8.5 ä¹åï¼ä¸è¦åå¹¶ 8.5 ä¸å±è¯­æ³ï¼æ¯å¦ <code>|&gt;</code>ï¼ã</li>
</ul>
<p>å¦æåç¡¬åæ¢ï¼</p>
<ul>
<li>ç¡®ä¿ä¸çº¿/åæ»æ¹æ¡ä¸æ ä¸å¤±ï¼</li>
<li>æ¥ååè½åæ¯å¯è½æ´æ©å¼å§ä½¿ç¨ 8.5 ä¸å±è¯­æ³ã</li>
</ul>
<h2 id="åå§å®¡è®¡å½å-phpæ©å±åä¾èµçº¦æ">åå§å®¡è®¡ï¼å½å PHPãæ©å±åä¾èµçº¦æ</h2>
<p>å¤§å¤æ°"PHP åçº§"bug ä¸æ¯è¯­è¨ bugï¼èæ¯ç¯å¢ä¸å¹éã</p>
<h3 id="å¿«ç§å®éè¿è¡çè¿è¡æ¶">å¿«ç§å®éè¿è¡çè¿è¡æ¶</h3>
<p>å¨çäº§ç¯å¢è¿è¡è¿äºå½ä»¤ï¼ä¸æ¯ä½ çç¬è®°æ¬ï¼</p>
<pre><code class="language-bash">php -v
php -m
php --ini
php -i | head -n 50
</code></pre>
<p>å¦æç¨ PHP-FPMï¼è¿è¦æè·ï¼</p>
<ul>
<li>FPM pool éç½®ï¼</li>
<li>ini è¦çï¼</li>
<li>ä¼ ç» FPM çç¯å¢åéï¼</li>
<li>opcache/JIT è®¾ç½®ï¼è¿äºå¨ä¸åç¯å¢å¯è½ä¸åï¼ã</li>
</ul>
<h3 id="åå»ºå¯å¤ç¨çå¹³å°å¿«ç§èæ¬">åå»ºå¯å¤ç¨ç"å¹³å°å¿«ç§"èæ¬</h3>
<p>æè¿æ ·ä¸ä¸ªèæ¬æ¾å° <code>tools/php-platform-snapshot.php</code>ï¼å¨æ¯ä¸ªç¯å¢ï¼å¼å/é¢å/çäº§ï¼è¿è¡ãæäº¤èæ¬æ¬èº«ï¼ä¸è¦è®©å®æä¸ºå£å£ç¸ä¼ çç¥è¯ã</p>
<pre><code class="language-php">&lt;?php
declare(strict_types=1);
function ext_version(string $ext): ?string {
    $v = phpversion($ext);
    return $v === false ? null : $v;
}
$snapshot = [
    'php_version' =&gt; PHP_VERSION,
    'php_version_id' =&gt; PHP_VERSION_ID,
    'sapi' =&gt; PHP_SAPI,
    'os' =&gt; PHP_OS_FAMILY . ' ' . php_uname('r'),
    'ini_loaded' =&gt; php_ini_loaded_file(),
    'ini_scanned' =&gt; php_ini_scanned_files(),
    'extensions' =&gt; [],
];
$exts = get_loaded_extensions();
sort($exts);
foreach ($exts as $ext) {
    $snapshot['extensions'][$ext] = ext_version($ext);
}
echo json_encode($snapshot, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES) . PHP_EOL;
</code></pre>
<p>è¿è½ç»ä½ ä¸¤ä¸ªæç¨çä¸è¥¿ï¼</p>
<ul>
<li>æµè¯ 8.5 æ¶å¯ä»¥ diff ç"ä»ä¹åäº"è®°å½ï¼</li>
<li>å¿«éåç°"é¢åè½è·çäº§ä¸è½è·"é®é¢çæ¹æ³ââå¾å¾æ¯çäº§å¤äºä¸ä¸ªæ©å±æ ini ä¸åã</li>
</ul>
<h3 id="çç¹-composer-å¹³å°è¦æ±">çç¹ Composer å¹³å°è¦æ±</h3>
<p>Composer æä½ ç PHP è¿è¡æ¶åæ©å±å½ä½"å¹³å°å"ï¼ä¾èµå¯ä»¥ require å®ä»¬ã</p>
<p>æç¨çå½ä»¤ï¼</p>
<pre><code class="language-bash">composer show --platform
composer check-platform-reqs
</code></pre>
<ul>
<li><code>composer show --platform</code> ååº Composer çå°çå¹³å°åã</li>
<li><code>composer check-platform-reqs</code> éªè¯ä½ ççå®æå¡å¨æ¯å¦æ»¡è¶³å·²å®è£åç PHP/ext è¦æ±ï¼å®ä¼ææå¿½ç¥ <code>config.platform</code>ï¼ã</li>
</ul>
<p>è¿æ¯å¨é¨ç½²ååç°"çäº§ç¼º ext-intl"æå¿«çæ¹æ³ã</p>
<h2 id="æå»º-ci-ç©éµå¨æ§ç-php-å-85-ä¸è¿è¡æµè¯æè­¦åå½ä¿¡å·">æå»º CI ç©éµï¼å¨æ§ç PHP å 8.5 ä¸è¿è¡æµè¯ï¼æè­¦åå½ä¿¡å·ï¼</h2>
<p>CI æ¯è®©åçº§åå¾å¯é¢æµçå°æ¹ã</p>
<h3 id="è§åå¨çäº§ç¨³å®è¿è¡-85-ä¹åä¿çæ§è¿è¡æ¶å¨-ci-ä¸­">è§åï¼å¨çäº§ç¨³å®è¿è¡ 8.5 ä¹åï¼ä¿çæ§è¿è¡æ¶å¨ CI ä¸­</h3>
<p>å³ä½¿ä½ è®¡åç¡¬åæ¢ï¼ç­æçéå æä¹è½å¸®ä½ é¿å"æä»¬å¨çäº§åå¤å¥½ä¹ååå¹¶äº 8.5 ä¸å±ä»£ç "ã</p>
<h3 id="github-actions-ç©éµç¤ºä¾æ§ç-php--php-85">GitHub Actions ç©éµç¤ºä¾ï¼æ§ç PHP + PHP 8.5ï¼</h3>
<p>å¦æç¨ GitHub Actionsï¼shivammathur/setup-php æ¯æç´æ¥æå® <code>'8.5'</code>ã</p>
<pre><code class="language-yaml">name: CI
on:
  push:
  pull_request:
jobs:
  tests:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        php: ['8.3', '8.5'] # è°æ´ä¸ºä½ çå½åçæ¬ + ç®æ çæ¬
    steps:
      - uses: actions/checkout@v4
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php }}
          tools: composer:v2
          coverage: none
      - name: Install dependencies
        run: composer install --no-interaction --prefer-dist
      - name: Run tests
        run: vendor/bin/phpunit
</code></pre>
<h3 id="åºåéè¯¯è­¦ååå¼ç¨">åºå"éè¯¯"ã"è­¦å"å"å¼ç¨"</h3>
<p>ä¸è¦ç«å»æææä¸è¥¿é½å½å¤±è´¥ãååç±»ï¼</p>
<ul>
<li><strong>è§£æéè¯¯ / è´å½éè¯¯</strong>ï¼é»æ­¢åçº§ã</li>
<li><strong>è¡ä¸ºåæ´</strong>ï¼éå¸¸éè¦æµè¯ + ä»£ç ä¿®å¤ã</li>
<li><strong>å¼ç¨</strong>ï¼ä¸ä¸å®é»æ­¢åçº§ï¼ä½å®ä»¬é¢ç¤ºæªæ¥ä¼åââèä¸å¯è½å¾å¿«æ·¹æ²¡æ¥å¿ã</li>
</ul>
<p>PHPUnit æ¬èº«å°±åºå outcomesï¼failed/erroredï¼å issuesï¼warningsãrisky tests ç­ï¼ã</p>
<p>ä¸ä¸ªå®ç¨çåçº§ç­ç¥ï¼</p>
<ul>
<li>å³ä½¿å­å¨å¼ç¨ï¼ä¹è®©æµè¯å¨ 8.5 ä¸éè¿ï¼</li>
<li>ä½å ä¸ä¸ªåç¬ç CI job æ¥ç»è®¡å¼ç¨æ°éå¹¶å¼ºå¶æ§è¡é¢ç®ï¼æ¯å¦"å¼ç¨ä¸è½è¶è¿ N æ¡"ï¼ã</li>
</ul>
<p>è¿éå¸¸æ¯ä¸å¤ä¹é´æå¼"ä»»ä½å¼ç¨é½å¤±è´¥"æ´ç°å®ã</p>
<h2 id="å¼ç¨åè¡ä¸ºåæ´åå¤çæéä¸æ ·åç±»èéå½éæ">å¼ç¨åè¡ä¸ºåæ´ï¼åå¤çæéä¸æ ·åç±»ï¼èéå½éæ</h2>
<p>PHP 8.5 æ°å¢äºä¸æ¹å¼ç¨ç¹æ§åå ä¸ªå¯è½è®©äººæå¤çä¸å¼å®¹åæ´ãå®æ¹è¿ç§»æåå¯¹æ­¤æè¯¦ç»è¯´æã</p>
<h3 id="ä¸ä¸ªææçåç±»å·¥ä½æµ">ä¸ä¸ªææçåç±»å·¥ä½æµ</h3>
<ol>
<li>
<p><strong>æ´é²</strong>ï¼å¨ CI åé¢åç¯å¢å¯ç¨ E_ALLã</p>
</li>
<li>
<p><strong>åç»</strong>ï¼ææ¶æ¯ç­¾åèç±»ï¼ç¸åæä»¶/è¡/æ¶æ¯ï¼ã</p>
</li>
<li>
<p><strong>æåº</strong>ï¼æé£é©ä¼åï¼</p>
<ul>
<li>å®å¨ç¸å³ï¼</li>
<li>è¿è¡æ¶æ­£ç¡®æ§ï¼</li>
<li>æ¥å¿é / è¿ç»´åªé³ï¼</li>
<li>æªæ¥ç ´åå¯è½æ§ã</li>
</ul>
</li>
<li>
<p><strong>ä¿®å¤</strong>ï¼æå°çå®å¨åæ´ã</p>
</li>
<li>
<p><strong>é²æ­¢åå½</strong>ï¼æ·»å éå¯¹æ§æµè¯æéæè§åã</p>
</li>
</ol>
<h3 id="å°å¤é½ä¼ååºæ¥çå¸¸è§å¼ç¨">å°å¤é½ä¼ååºæ¥çå¸¸è§å¼ç¨</h3>
<p>è¿äºæ¯è®©å¢éè¯´"ç­ç­ï¼è¿ä»¥åå±ç¶åè®¸ï¼"çé®é¢ï¼</p>
<p><strong>éè§èçç±»åè½¬æ¢åç§°å·²å¼ç¨</strong>ï¼<code>(boolean)</code>ã<code>(integer)</code>ã<code>(double)</code>ã<code>(binary)</code> â ç¨ <code>(bool)</code>ã<code>(int)</code>ã<code>(float)</code>ã<code>(string)</code>ã</p>
<p>å¿«éæç´¢ï¼</p>
<ul>
<li>grep æ <code>\(integer\)</code> / <code>\(boolean\)</code> ç­ï¼</li>
<li>åºç¨ codemodï¼æ Rectorââåé¢ä¼è®²ï¼ã</li>
</ul>
<p><strong>case è¯­å¥ç¨åå·ç»å°¾å·²å¼ç¨</strong>ï¼ç¨ <code>:</code>ï¼ã</p>
<p>è¿å¸¸åºç°å¨"ä¸ç´è½è·"çè switch åéã</p>
<p><strong>ç¨ null ä½ä¸ºæ°ç»åç§»ï¼æå¨ array_key_exists ä¸­ï¼å·²å¼ç¨</strong>ï¼PHP å»ºè®®ç¨ç©ºå­ç¬¦ä¸²ä»£æ¿ã</p>
<p>è¿éå¸¸æåè¾å¥è§èå bugââä¿®æ ¹æ¬åå ï¼ä¸åªæ¯ä¿®è­¦åã</p>
<p><strong>éå¢éæ°å­å­ç¬¦ä¸²å·²å¼ç¨</strong>ï¼ç¨ <code>str_increment()</code> ä»£æ¿ã</p>
<p>å¦æä½ æä»£ç ç¨ <code>$s++</code> åå­æ¯éå¢ï¼ä¼çå°è¿ä¸ªã</p>
<p><strong>åå¼å·æä½ç¬¦å·²å¼ç¨</strong>ï¼å®æ¯ shell_exec çå«åï¼ã</p>
<p>å³ä½¿ä½ æ¥åå®å¨é£é©ï¼ä¹ä¸æ³è®©å¼ç¨è­¦åé£æ´æ·¹æ²¡çäº§æ¥å¿ã</p>
<p><strong><code>__sleep()</code> å <code>__wakeup()</code> è½¯å¼ç¨</strong>ï¼ä¼åç¨ <code>__serialize()</code> / <code>__unserialize()</code>ï¼æå¨è¿æ¸¡æåæ¶æ¯æä¸¤èï¼ã</p>
<h3 id="è¿ç»´ç¸å³çå¼ç¨æ©å±iniç©ºæä½å½æ°">è¿ç»´ç¸å³çå¼ç¨ï¼æ©å±ãiniã"ç©ºæä½"å½æ°ï¼</h3>
<p>æäºå¼ç¨æ¯"ä½ ä¸åéè¦è¿ä¸ªäº"ï¼ä½ä»å¯è½è®©ä½ æªæä¸åï¼</p>
<ul>
<li><code>curl_close()</code> å <code>curl_share_close()</code> å·²å¼ç¨ï¼å ä¸ºå¥æä¼èªå¨éæ¾ã</li>
<li><code>imagedestroy()</code> å·²å¼ç¨ï¼å ä¸º GdImage ä¼èªå¨éæ¾ã</li>
<li><code>finfo_close()</code> å·²å¼ç¨ï¼å ä¸º finfo å¯¹è±¡ä¼èªå¨éæ¾ã</li>
<li><code>MHASH_*</code> å¸¸éå·²å¼ç¨ã</li>
<li>PDO <code>"uri:"</code> DSN scheme å å®å¨åå å·²å¼ç¨ã</li>
</ul>
<p>å¦æä½ è¿ç»´å¤§ååºç¨ï¼è¿äºå¾éè¦ï¼å ä¸ºå®ä»¬å¯è½ï¼</p>
<ul>
<li>æ¥å¿çç¸ï¼åªé³ï¼ï¼</li>
<li>æ©ççæ­£çéè¯¯ï¼</li>
<li>ææç¤ºå¼å¾å®¡æ¥çå®å¨ææè¡ä¸ºï¼è¿ç¨ URI ç PDO DSNï¼ã</li>
</ul>
<h3 id="å¼å¾å°½æ©æ£æ¥çä¸å¼å®¹åæ´">å¼å¾å°½æ©æ£æ¥çä¸å¼å®¹åæ´</h3>
<p>æ¥èªå®æ¹åè¡¨ï¼</p>
<ul>
<li><code>class_alias()</code> ä¸è½åç¨ "array" æ "callable" ä½ä¸ºå«åã</li>
<li>å¯¹è±¡å°å¸å°çæ¾æ£æ¯è¾è¢«ç»ä¸ä¸ºä¸ <code>(bool)$object</code> è¡ä¸ºä¸è´ã</li>
<li>Trait å¨ç¶ç±»ä¹åç»å®ï¼å¾®å¦çè¡ä¸ºåæ´ï¼ã</li>
<li>æäº attribute ç®æ éªè¯éè¯¯ç°å¨å¨ç¼è¯æåçï¼æéé¡¹å¯ä»¥å»¶è¿ï¼ã</li>
</ul>
<p>ä½ å¯è½æ°¸è¿ä¸ä¼éå°è¿äºãä½å¦æéå°ï¼ä½ å¸æå®ä»¬å¨ CI ç«å»å¤±è´¥ââèä¸æ¯å¨çäº§ç¯å¢ã</p>
<h2 id="composer-ç­ç¥lock-æä»¶å¹³å°è¦æ±ååé¶æ®µæ´æ°">Composer ç­ç¥ï¼lock æä»¶ãå¹³å°è¦æ±ååé¶æ®µæ´æ°</h2>
<p>ä¾èµç®¡çæ¯åçº§åºé®é¢çå°æ¹ã</p>
<h3 id="çè§£-composer-å¨æ£æ¥ä»ä¹">çè§£ Composer å¨æ£æ¥ä»ä¹</h3>
<p>Composer æå½å PHP çæ¬å»ºæ¨¡ä¸ºå¹³å°åï¼<code>php</code>ï¼ï¼å¹¶æ®æ­¤æ£æ¥ä½ çä¾èµã</p>
<p>æä»¥ä½ æä¸¤ä¸ªç¸å³çé®é¢ï¼</p>
<ol>
<li>"æçä¾èµå¾è½å¨ PHP 8.5 ä¸è§£æåï¼"</li>
<li>"æççäº§ç¯å¢ççæ»¡è¶³è§£æåºçä¾èµå¾åï¼"</li>
</ol>
<h3 id="åé¶æ®µæ´æ°ä¾èµä¸è¦ä¸æ¬¡æ§æå®">åé¶æ®µæ´æ°ä¾èµï¼ä¸è¦"ä¸æ¬¡æ§æå®"ï¼</h3>
<p>ä¸ä¸ªå®ç¨çåé¶æ®µæ¹æ³ï¼</p>
<p><strong>é¶æ®µ Aï¼ä¸æ¹åè¿è¡æ¶ï¼è§£æä¾èµ</strong></p>
<ul>
<li>å¨å½å PHP çæ¬ä¸æ´æ°ä¾èµï¼å¦æå¯è½ï¼ã</li>
<li>ç®æ ï¼åå°åæ¶åºç°çæªç¥æ°ã</li>
</ul>
<p><strong>é¶æ®µ Bï¼åè®¾å¨ PHP 8.5 ä¸è§£æä¾èµ</strong></p>
<ul>
<li>å¨ <code>composer.json</code> ä¸­ç¨ <code>config.platform.php</code> æ¨¡æ PHP 8.5 è¿è¡ä¾èµè§£æï¼ä¸´æ¶çï¼å¨åæ¯ä¸ï¼ã</li>
<li>ç¶åå¯æ§å°è¿è¡ <code>composer update</code>ã</li>
</ul>
<p><strong>é¶æ®µ Cï¼å¨çå® PHP 8.5 è¿è¡æ¶ä¸å®è£</strong></p>
<ul>
<li>å¨ CI/é¢åç¯å¢ççå® 8.5 ä¸è¿è¡å®æ´æµè¯å¥ä»¶ã</li>
</ul>
<h3 id="æ­£ç¡®ä½¿ç¨-composer-çå¹³å°æ£æ¥">æ­£ç¡®ä½¿ç¨ Composer çå¹³å°æ£æ¥</h3>
<ul>
<li><code>platform-check</code> æ§å¶å¨ Composer ç autoloader bootstrap ä¸­çæ <code>platform_check.php</code>ã</li>
<li><code>composer check-platform-reqs</code> éªè¯çå®è¿è¡æ¶æ¯å¦å¹éå·²å®è£åçè¦æ±ã</li>
</ul>
<p>æ¢å¥è¯è¯´ï¼</p>
<ul>
<li>ç¨ <code>config.platform</code> æ¥æ¨¡æåè§£æã</li>
<li>ç¨ <code>check-platform-reqs</code> æ¥ç¡®ä¿çäº§å®éå¼å®¹ã</li>
</ul>
<h3 id="åçº§æé´ä¼åå¤ä½¿ç¨çå®å¨æ´æ°å½ä»¤">åçº§æé´ä¼åå¤ä½¿ç¨çå®å¨æ´æ°å½ä»¤</h3>
<p>å¸¸è§æ¨¡å¼ï¼</p>
<pre><code class="language-bash"># ä¿å®å°æ´æ°ä¾èµ
composer update --no-interaction --with-all-dependencies

# ä¸¥æ ¼æ lock æä»¶å®è£
composer install --no-interaction --prefer-dist
</code></pre>
<p>å¦æéè¦è¿½æ¥ä¸ä¸ªæé®é¢çåï¼</p>
<ul>
<li>æ¾å¼æ´æ°å®ï¼å ä¾èµï¼ï¼</li>
<li>å¨ CI çä¸¤ä¸ªè¿è¡æ¶ä¸éæ°è¿è¡ã</li>
</ul>
<p>é¿åæ"å¿½ç¥å¹³å°è¦æ±"å½æè§£å³æ¹æ¡ãå®è½è®©ä½ æ¬å°è±å°ï¼ä½ä¸æ¯è¿ç§»ç­ç¥ã</p>
<h2 id="é¨ç½²åæ·»å å¯è§æµæ§è¿æ ·ä½ è½è¯æåçº§æ¯å¥åº·ç">é¨ç½²åæ·»å å¯è§æµæ§ï¼è¿æ ·ä½ è½è¯æåçº§æ¯å¥åº·çï¼</h2>
<p>å¦æä¸è½åº¦éï¼å°±ä¼äºè®ºã</p>
<h3 id="åºçº¿åå¥åº·çå«ä¹">åºçº¿å"å¥åº·"çå«ä¹</h3>
<p>å¨é¨ç½² PHP 8.5 ä¹åï¼æè·ï¼</p>
<ul>
<li>éè¯¯çï¼HTTP 5xx + æªæè·å¼å¸¸ï¼ï¼</li>
<li>æ¢è¯·æ±çï¼p95/p99ï¼ï¼</li>
<li>åå­ä½¿ç¨è¶å¿ï¼FPM workerï¼ï¼</li>
<li>éåå»¶è¿ï¼å¦æä½ è· workerï¼ï¼</li>
<li>æ¥å¿éï¼å°¤å¶æ¯è­¦å/å¼ç¨ï¼ã</li>
</ul>
<h3 id="ä¸´æ¶å¢å æ¥å¿ä¿¡å·ä½ä¸è¦è®©æ¥å¿åæåå¾åº">ä¸´æ¶å¢å æ¥å¿ä¿¡å·ï¼ä½ä¸è¦è®©æ¥å¿åæåå¾åºï¼</h3>
<p>å¨åçº§çªå£æé´ï¼å ä¸ä¸ªç­æç"åçº§è§è§"æ¯åççï¼</p>
<ul>
<li>å¨è¿ç¨å¯å¨æ¶è®°å½ PHP çæ¬ï¼FPM/CLI workerï¼ï¼</li>
<li>ç»éè¯¯æä¸è¿è¡æ¶æ ç­¾ï¼æ§ç vs 8.5ï¼ï¼</li>
<li>æç«¯ç¹/worker ç±»åç»è®¡å¼ç¨æ°éã</li>
</ul>
<p>å¨ PHP ä¸­ï¼ä½ å¯ä»¥å¨åç«¯æ§å¶å¨ï¼ææ¡æ¶ bootstrapï¼éä¸ºé¢åç¯å¢æ·»å ä¸ä¸ªæå°çéè¯¯å¤çå¨ï¼</p>
<pre><code class="language-php">set_error_handler(static function (int $severity, string $message, string $file, int $line): bool {
    if (!(error_reporting() &amp; $severity)) {
        return false;
    }
    // ç¤ºä¾ï¼æå¼ç¨/è­¦åè·¯ç±å°ä¸ç¨ logger channel
    if ($severity === E_DEPRECATED || $severity === E_USER_DEPRECATED) {
        error_log("[DEPRECATED] {$message} in {$file}:{$line}");
        return true; // å·²å¤ç
    }
    return false; // è®©æ­£å¸¸å¤çå¨è¿è¡
});
</code></pre>
<p>ä¿æä¸´æ¶æ§ãç®æ æ¯ä¸çº¿æé´çæ¸æ°åº¦ï¼ä¸æ¯ä¸ä¸ªæ°¸ä¹çèªå®ä¹éè¯¯æ¡æ¶ã</p>
<h3 id="ç¡®ä¿ç»è¿å¤çå¨çè­¦åä¸ä¼è®©ä½ æªæä¸å">ç¡®ä¿"ç»è¿å¤çå¨çè­¦å"ä¸ä¼è®©ä½ æªæä¸å</h3>
<p>PHP 8.5 å¼ç¨äºå¨ç¨æ·è¾åºå¤çå¨åé¨äº§çè¾åºçè¡ä¸ºï¼å¹¶æåºè­¦åä¼ç»è¿å¤çå¨ä»¥ç¡®ä¿å¯è§æ§ã</p>
<p>å¦æä½ åèªå®ä¹è¾åºç¼å²çéªæä½ï¼å¨é¢åç¯å¢ç¨çå®æµéæ¨¡å¼æµè¯å®ä»¬ã</p>
<h2 id="ä¸çº¿ç­ç¥éä¸éæèç»¿é¨ç½²å ä¸å®éè½ç¨çåæ»">ä¸çº¿ç­ç¥ï¼éä¸éæèç»¿é¨ç½²ï¼å ä¸å®éè½ç¨çåæ»</h2>
<p>è¿æ¯è¿ç»´åçº§æè´¥çå³é®ã</p>
<h3 id="éä¸éåºç¡æå°å¯è¡çå®å¨ä¸çº¿">éä¸éåºç¡ï¼æå°å¯è¡çå®å¨ä¸çº¿ï¼</h3>
<ol>
<li>åæ PHP 8.5 é¨ç½²å°å°æ¯ä¾çæµéã</li>
<li>å¯¹æ¯éè¯¯çåå»¶è¿ä¸åºçº¿ã</li>
<li>ä¿æéä¸éè¶³å¤é¿çæ¶é´ä»¥è¦ççå®ä¸å¡æµç¨ï¼ä¸åªæ¯å¥åº·æ£æ¥ï¼ã</li>
</ol>
<p>å®ç°åå³äºä½ çææ¯æ ï¼</p>
<ul>
<li>è´è½½åè¡¡å¨åé¢çä¸¤ä¸ª FPM poolï¼</li>
<li>Kubernetes deployment å æéè·¯ç±ï¼</li>
<li>ä¸¤ä¸ª ASG / ä¸¤ä¸ª service å æ¸è¿æµéåæ¢ã</li>
</ul>
<h3 id="èç»¿é¨ç½²éåå¤§çç¸å¼ç»ç»">èç»¿é¨ç½²éå"å¤§çç¸"å¼ç»ç»</h3>
<p>å¦æä½ çç»ç»åå¥½ç¡¬åæ¢ï¼</p>
<ul>
<li>ä¿ææ°æ§ç¯å¢é½å¨çº¿ï¼</li>
<li>åæ¢æµéï¼</li>
<li>ä¿ææ§ç¯å¢ç­å¤ä»¥ä¾¿å¿«éåæ»ã</li>
</ul>
<h3 id="åæ»è®¡åå¿é¡»åå«ä¾èµåç¼å­">åæ»è®¡åå¿é¡»åå«ä¾èµåç¼å­</h3>
<p>åæ»ä¸åªæ¯"æåæ§ç PHP äºè¿å¶"ã</p>
<p>åæ»ç°å®æ§æ£æ¥æ¸åï¼</p>
<ul>
<li>ä¿çä¹åçå®¹å¨éåï¼æåï¼ã</li>
<li>ä¿çä¹åç <code>composer.lock</code> å¶åã</li>
<li>ç¥éåæ¢è¿è¡æ¶æ¶ opcache/APCu ææ¡æ¶ç¼å­æ¯å¦éè¦æ¸çã</li>
<li>ç¡®ä¿æ°æ®åºè¿ç§»æ¯ååå¼å®¹çï¼ææç¡®æé¤å¨åçº§èå´å¤ï¼ã</li>
</ul>
<p>å¦æåæ»éè¦ä¸ä¸ªäººåä¸ä»½ wiki é¡µé¢ï¼å¨ååä¸å®ä¼å¤±è´¥ã</p>
<h2 id="åçº§åæ£æ¥æ¸ååéªè¯æ­£ç¡®æ§åéªè¯æ§è½ç¶åæ¸ç">åçº§åæ£æ¥æ¸åï¼åéªè¯æ­£ç¡®æ§ï¼åéªè¯æ§è½ï¼ç¶åæ¸ç</h2>
<p>ä¸æ¦ PHP 8.5 å¼å§æå¡çå®æµéï¼ä½ çå·¥ä½è¿æ²¡å®ãç°å¨è¿å¥"éªè¯åç¨³å®"æ¨¡å¼ã</p>
<h3 id="å³æ¶æ£æ¥ç¬¬ä¸å°æ¶">å³æ¶æ£æ¥ï¼ç¬¬ä¸å°æ¶ï¼</h3>
<ul>
<li>æ«æéè¯¯æ¥å¿æ¥æ¾æ°çè´å½éè¯¯/å¼å¸¸ã</li>
<li>è§å¯æ¥å¿éæ¯å¦çªç¶å¢é¿ï¼éå¸¸æ¯å¼ç¨ï¼ã</li>
<li>å¨çäº§ä¸»æºä¸éªè¯ <code>composer check-platform-reqs</code>ã</li>
<li>ç¨åææ£æ¥éªè¯æ ¸å¿æµç¨ï¼ç»å½ãç»è´¦ãä¸ä¼ ãå®æ¶ä»»å¡ç«¯ç¹ï¼ã</li>
</ul>
<h3 id="é¦æ¥æ£æ¥">é¦æ¥æ£æ¥</h3>
<ul>
<li>å¯¹æ¯ p95/p99 å»¶è¿ä¸åºçº¿ã</li>
<li>æ£æ¥åå­ä½¿ç¨ï¼
<ul>
<li>FPM worker RSS å¢é¿ï¼</li>
<li>worker åæ¶é¢çï¼</li>
<li>éå worker åå­æ³æ¼ã</li>
</ul>
</li>
<li>éªè¯åå°ä»»å¡ï¼
<ul>
<li>worker å¨æ°è¿è¡æ¶ä¸å·²éå¯ï¼</li>
<li>æ²¡æ"å¡ä½"çéåï¼</li>
<li>æ²¡æéé»å¤±è´¥ã</li>
</ul>
</li>
</ul>
<h3 id="é¦å¨æ¸ç">é¦å¨æ¸ç</h3>
<ul>
<li>ç§»é¤ä½ ä¸ºä¸çº¿è§è§æ·»å çä¸´æ¶é¢å¤æ¥å¿ã</li>
<li>æé«é¢å¼ç¨è½¬æè·è¸ªçå·¥åå¹¶éæ­¥æ¶ç­ã</li>
<li>åæ¬¡æ¶ç´§ CIï¼
<ul>
<li>æé«å¼ç¨çæ åï¼</li>
<li>ç¡®è®¤ç¨³å®åä»ç©éµä¸­ç§»é¤æ§ PHP çæ¬ã</li>
</ul>
</li>
</ul>
<h2 id="å³äº-php-85-ç¹æ§çå¿«éå¼å®¹æ§è¯´æä¸å±å¼æç¨">å³äº PHP 8.5 ç¹æ§çå¿«éå¼å®¹æ§è¯´æï¼ä¸å±å¼æç¨ï¼</h2>
<p>PHP 8.5 å¼å¥äºæ°çè¯­è¨åè¿è¡æ¶ç¹æ§ï¼å¦ç®¡éæä½ç¬¦ãURI æ©å±ãclone-with ç­ã</p>
<p>åçº§æé´ä¸éè¦éç¨å®ä»¬ãä½ä½ åºè¯¥ï¼</p>
<ul>
<li>ç¡®ä¿ä½ ç linter/formatter è¯å« PHP 8.5 è¯­æ³ï¼</li>
<li>ç¡®ä¿ CI å¨ PHP 8.5 ä¸è¿è¡åååå¹¶ä»»ä½ 8.5 ä¸å±è¯­æ³ï¼</li>
<li>æç¹æ§éç¨åè¿è¡æ¶è¿ç§»åå¼ï¼èå´æ§å¶ï¼ã</li>
</ul>
<h2 id="ç»è®ºæåçº§å½é¨ç½²æ¥å¯¹å¾å°±ä¼é¡ºå©">ç»è®ºï¼æåçº§å½é¨ç½²æ¥å¯¹å¾ï¼å°±ä¼é¡ºå©</h2>
<p>åçº§å° PHP 8.5 éå¸¸ä¸æ¯"éå"é®é¢ãæ¯çºªå¾é®é¢ï¼</p>
<ul>
<li>å®ä¹èå´ï¼</li>
<li>å®¡è®¡çå®å¹³å°ï¼</li>
<li>è¿è¡ CI ç©éµï¼</li>
<li>ç³»ç»å°åç±»å¼ç¨åä¸å¼å®¹ï¼</li>
<li>ææè¯å°ç®¡çä¾èµï¼</li>
<li>ä¸çº¿åæ·»å å¯è§æµæ§ï¼</li>
<li>å¸¦çç­ç¥ååæ»è·¯å¾é¨ç½²ï¼</li>
<li>åæ¢åéªè¯åç¨³å®ã</li>
</ul>
<p>å¦æä½ éµå¾ªè¿ä¸ªé¡ºåºï¼PHP åçº§å°±ä¸åå¯æââå®åªæ¯å¦ä¸ä¸ªå¸¸è§çè¿ç»´åæ´ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.002777777777777778" data-date-updated="2026-01-14 07:47">2026-01-14 07:43</span>&nbsp;
<a href="https://www.cnblogs.com/catchadmin">JaguarJack</a>&nbsp;
éè¯»(<span id="post_view_count">10</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479967);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479967', targetLink: 'https://www.cnblogs.com/catchadmin/p/19479967', title: 'PHP 8.5 åçº§çå­æåï¼é¿ååæ¨ä¸¤ç¹åæ»çæ£æ¥æ¸å' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ LangChainãLangFlowãLangGraphï¼ä¸æè®²æ¸ä¸å¤§ LLM æ¡æ¶çå®ä½ä¸å·®å¼ ]]></title>
    <link>https://www.cnblogs.com/jyzhao/p/19479470/langchainlangflowlanggraph-yi-wen-jiang-qing-san-d</link>
    <guid>88c9b78cc1ca2c9bde876d7c031b53cb</guid>
    <description>
    <![CDATA[ 
    <a name="top"></a>
    <h2><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jyzhao/p/19479470/langchainlangflowlanggraph-yi-wen-jiang-qing-san-d" title="åå¸äº 2026-01-13 23:25">
    <span role="heading" aria-level="2">LangChainãLangFlowãLangGraphï¼ä¸æè®²æ¸ä¸å¤§ LLM æ¡æ¶çå®ä½ä¸å·®å¼</span>
    

</a>
</h2>
    <small>
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 23:25">2026-01-13 23:25</span>&nbsp;
<a href="https://www.cnblogs.com/jyzhao">AlfredZhao</a>&nbsp;
éè¯»(<span id="post_view_count">163</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479470);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479470', targetLink: 'https://www.cnblogs.com/jyzhao/p/19479470/langchainlangflowlanggraph-yi-wen-jiang-qing-san-d', title: 'LangChainãLangFlowãLangGraphï¼ä¸æè®²æ¸ä¸å¤§ LLM æ¡æ¶çå®ä½ä¸å·®å¼' })">ä¸¾æ¥</a>
</small>
    <div class="entry">
        <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>éçå¤§æ¨¡åï¼LLMï¼è¿å¥å·¥ç¨åè½å°é¶æ®µï¼<strong>âå¦ä½ææ¨¡ååæçæ­£å¯ç¨çåºç¨â</strong> æäºå¾å¤ä»ä¸èç»ä¸å¼çé®é¢ã<br>
å´ç»è¿ä¸ªç®æ ï¼ç¤¾åºééæ¸å½¢æäºä¸æ¹æççå¼æºæ¡æ¶ï¼å¶ä¸­è¢«è®¨è®ºæå¤çå°±æ¯ <strong>LangChainãLangFlowãLangGraph</strong>ã</p>
<p>å®ä»¬åå­ç¸ä¼¼ï¼ä½<strong>è§£å³çé®é¢å¹¶ä¸ç¸å</strong>ãæ¬æç¬èå°åºäºå®æ¹ææ¡£ä¸å¼æºå®è·µï¼ä»<strong>å®ä½ãè½åãä½¿ç¨åºæ¯åå·®å¼</strong>å ä¸ªè§åº¦ï¼å¸®ä½ ä¸æ¬¡æ§çæ¸ã</p>
<hr>
<h2 id="01--langchainllm-åºç¨çåºç¡è®¾æ½å±">01 | LangChainï¼LLM åºç¨çâåºç¡è®¾æ½å±â</h2>
<h3 id="-langchain-æ¯ä»ä¹">â  LangChain æ¯ä»ä¹ï¼</h3>
<p>LangChain æ¯ä¸ä¸ª<strong>ç¨äºæå»º LLM åºç¨çéç¨æ¡æ¶</strong>ï¼æ ¸å¿ç®æ åªæä¸å¥è¯ï¼</p>
<blockquote>
<p>æãå¤§æ¨¡å + å¤é¨å·¥å· + æ°æ®æº + Promptãç³»ç»åå°ç»ç»èµ·æ¥ã</p>
</blockquote>
<p>å®å¹¶ä¸æ¯ä¸ä¸ªâäº§åâï¼èæ¯ä¸å¥ <strong>å¼åèå¼åç»ä»¶åº</strong>ã</p>
<hr>
<h3 id="-langchain-è§£å³ä»ä¹é®é¢">â¡ LangChain è§£å³ä»ä¹é®é¢ï¼</h3>
<p>å¨æ²¡æ LangChain ä¹åï¼å¼åèéå¸¸éè¦èªå·±å¤çï¼</p>
<ul>
<li>Prompt æ¼æ¥</li>
<li>æ¨¡åè°ç¨</li>
<li>ä¸ä¸æç®¡ç</li>
<li>å·¥å·è°ç¨ï¼SQLãæç´¢ãAPIï¼</li>
<li>RAGï¼æ£ç´¢å¢å¼ºçæï¼</li>
</ul>
<p>LangChain æè¿äºæ½è±¡æäºæ åç»ä»¶ï¼ä¾å¦ï¼</p>
<ul>
<li>LLM / ChatModel</li>
<li>PromptTemplate</li>
<li>Chain</li>
<li>Tool / Agent</li>
<li>Memory</li>
</ul>
<hr>
<h3 id="-å¸ååºç¨åºæ¯">â¢ å¸ååºç¨åºæ¯</h3>
<ul>
<li>RAG é®ç­ç³»ç»</li>
<li>NL2SQL</li>
<li>AI å©æ / Copilot</li>
<li>å·¥å·å Agent</li>
</ul>
<p><strong>ä¸å¥è¯æ»ç»</strong>ï¼<br>
<strong>LangChain = å LLM åºç¨çâåç«¯å¼åæ¡æ¶â</strong></p>
<hr>
<h2 id="02--langflowlangchain-çå¯è§åä½ä»£ç å¥å£">02 | LangFlowï¼LangChain çå¯è§åâä½ä»£ç å¥å£â</h2>
<h3 id="-langflow-æ¯ä»ä¹">â  LangFlow æ¯ä»ä¹ï¼</h3>
<p>LangFlow æ¯ä¸ä¸ª <strong>åºäº LangChain çå¯è§åç¼æå·¥å·</strong>ã</p>
<p>ä½ å¯ä»¥çè§£ä¸ºï¼</p>
<blockquote>
<p>ç¨âææ½æµç¨å¾âçæ¹å¼æ¥æ­ LangChain åºç¨ã</p>
</blockquote>
<p>å®æ¬è´¨ä¸æ¯ï¼</p>
<ul>
<li>åç«¯å¯è§å</li>
<li>åç«¯ä»ç¶è¿è¡ LangChain é»è¾</li>
</ul>
<hr>
<h3 id="-langflow-çæ ¸å¿ä»·å¼">â¡ LangFlow çæ ¸å¿ä»·å¼</h3>
<p>LangFlow å¹¶æ²¡æå¼å¥æ°çæ¨¡åè½åï¼å®çä¼å¿å¨äºï¼</p>
<ul>
<li><strong>éä½å­¦ä¹ é¨æ§</strong></li>
<li>å¿«éååéªè¯</li>
<li>Prompt / Chain å¯è§åè°è¯</li>
</ul>
<p>å¯¹ä¸çæ Python æåæ¥è§¦ LLM çäººéå¸¸åå¥½ã</p>
<hr>
<h3 id="-å¸ååºç¨åºæ¯-1">â¢ å¸ååºç¨åºæ¯</h3>
<ul>
<li>äº§åç»ç / å¨è¯¢é¡¾é®å Demo</li>
<li>Prompt è°ä¼ä¸æµç¨éªè¯</li>
<li>æå­¦ä¸åäº«æ¼ç¤º</li>
<li>å°å PoC é¡¹ç®</li>
</ul>
<p><strong>ä¸å¥è¯æ»ç»</strong>ï¼<br>
<strong>LangFlow = LangChain çâå¯è§åæä½å°â</strong></p>
<hr>
<h2 id="03--langgraphä¸ºå¤æ-agent-èççç¶ææºæ¡æ¶">03 | LangGraphï¼ä¸ºå¤æ Agent èççâç¶ææºæ¡æ¶â</h2>
<h3 id="-langgraph-æ¯ä»ä¹">â  LangGraph æ¯ä»ä¹ï¼</h3>
<p>LangGraph æ¯ LangChain å®æ¹æ¨åºçä¸ä¸ª<strong>æ°æ¡æ¶</strong>ï¼ä¸é¨è§£å³ä¸ä¸ªé®é¢ï¼</p>
<blockquote>
<p>å½ Agent é»è¾åå¤æï¼Chain å·²ç»ä¸å¤ç¨äºï¼æä¹åï¼</p>
</blockquote>
<p>LangGraph å¼å¥çæ¯ï¼</p>
<ul>
<li><strong>Graphï¼å¾ï¼</strong></li>
<li><strong>Stateï¼ç¶æï¼</strong></li>
<li><strong>èç¹ + è¾¹ + å¾ªç¯</strong></li>
</ul>
<p>æ¬è´¨ä¸æ¯ï¼<br>
<strong>æ LLM Agent å½æä¸ä¸ªâæç¶æçå·¥ä½æµ/ç¶ææºâæ¥å»ºæ¨¡</strong>ã</p>
<hr>
<h3 id="-langgraph-ä¸ºä»ä¹åºç°">â¡ LangGraph ä¸ºä»ä¹åºç°ï¼</h3>
<p>å¨çå®é¡¹ç®ä¸­ï¼Agent å¾å¾éè¦ï¼</p>
<ul>
<li>å¤è½®å³ç­</li>
<li>æ¡ä»¶åæ¯</li>
<li>åé / éè¯</li>
<li>äººå·¥ä»å¥ï¼Human-in-the-loopï¼</li>
</ul>
<p>è¿äºç¨ä¼ ç» Chain éå¸¸å«æ­ï¼è LangGraph å¤©ç¶æ¯æï¼</p>
<ul>
<li>å¾ªç¯</li>
<li>åæ¯</li>
<li>å¹¶è¡</li>
<li>å¯æ¢å¤æ§è¡</li>
</ul>
<hr>
<h3 id="-å¸ååºç¨åºæ¯-2">â¢ å¸ååºç¨åºæ¯</h3>
<ul>
<li>å¤ Agent åä½ç³»ç»</li>
<li>å¤æä¸å¡æµç¨èªå¨å</li>
<li>é¿ä»»å¡ AI å©æ</li>
<li>éè¦âå¯æ§è¡ä¸ºâçæºè½ä½</li>
</ul>
<p><strong>ä¸å¥è¯æ»ç»</strong>ï¼<br>
<strong>LangGraph = é¢åå¤æ Agent çâæµç¨ä¸ç¶ææ§å¶å±â</strong></p>
<hr>
<h2 id="04--ä¸èæ ¸å¿å·®å¼ä¸å¾è¯»æ">04 | ä¸èæ ¸å¿å·®å¼ä¸å¾è¯»æ</h2>
<table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>LangChain</th>
<th>LangFlow</th>
<th>LangGraph</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ ¸å¿å®ä½</td>
<td>LLM åºç¨æ¡æ¶</td>
<td>å¯è§åç¼æå·¥å·</td>
<td>Agent ç¶ææºæ¡æ¶</td>
</tr>
<tr>
<td>æ½è±¡æ¨¡å</td>
<td>Chain / Agent</td>
<td>Flow</td>
<td>Graph / State</td>
</tr>
<tr>
<td>ä½¿ç¨æ¹å¼</td>
<td>åä»£ç </td>
<td>ææµç¨</td>
<td>åå¾ç»æä»£ç </td>
</tr>
<tr>
<td>éåäººç¾¤</td>
<td>å·¥ç¨å¸</td>
<td>åå­¦è / äº§å</td>
<td>é«çº§å·¥ç¨å¸</td>
</tr>
<tr>
<td>å¤æé»è¾</td>
<td>ä¸è¬</td>
<td>ä¸è¬</td>
<td>éå¸¸å¼º</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="05--åºè¯¥å¦ä½éæ©">05 | åºè¯¥å¦ä½éæ©ï¼</h2>
<p>ç¬èç»ä½ ä¸ä¸ª<strong>ä¸è¸©åçéæ©å»ºè®®</strong>ï¼</p>
<ul>
<li><strong>æ³ç³»ç»å LLM åºç¨</strong> â åå­¦ <strong>LangChain</strong></li>
<li><strong>æ³å¿«éåº Demo / å­¦æ¦å¿µ</strong> â ç¨ <strong>LangFlow</strong></li>
<li><strong>Agent é»è¾å¼å§åå¤æ</strong> â ä¸ <strong>LangGraph</strong></li>
</ul>
<p>ç°å®é¡¹ç®ä¸­ï¼<strong>ä¸èæ¯å¯ä»¥ç»åä½¿ç¨ç</strong>ï¼</p>
<blockquote>
<p>LangFlow ç»æµç¨ â LangChain è½ä»£ç  â LangGraph æ§å¤ææ§å¶</p>
</blockquote>
<hr>
<h2 id="06--åå¨æå">06 | åå¨æå</h2>
<p>LangChain çæçæ¼è¿ï¼æ¬è´¨ä¸åæ äºä¸ä»¶äºï¼</p>
<blockquote>
<p>LLM åºç¨ï¼æ­£å¨ä»âPrompt å·¥ç¨âï¼èµ°åçæ­£çè½¯ä»¶å·¥ç¨ã</p>
</blockquote>
<p>çè§£è¿ä¸èçè¾¹çï¼æ¯æ­»è®° API æ´éè¦ã<br>
å¦æä½ æ­£å¨å <strong>RAGãNL2SQLãAI Agent</strong>ï¼è¿å¥è®¤ç¥å ä¹æ¯ç»ä¸å¼çåºç¡ã</p>
<p>å¸æè¿ç¯æç« ï¼è½å¸®ä½ å°èµ°ä¸äºå¼¯è·¯ã</p>

</div>
<div id="MySignature" role="contentinfo">
    <a href="https://www.cnblogs.com/jyzhao/" target="_blank">AlfredZhao</a>Â©çæææãä»Oracleèµ·èªï¼é¢ç¥ç²¾å½©çITææ¯ãã<br>
è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/jyzhao/p/19479470/langchainlangflowlanggraph-yi-wen-jiang-qing-san-d" target="_blank">https://www.cnblogs.com/jyzhao/p/19479470/langchainlangflowlanggraph-yi-wen-jiang-qing-san-d</a>
<hr>
<div style="text-align:center; margin-top:30px;">
  <p style="font-size:14px;color:#555;">
    ð æè°¢éè¯»ï¼æ¬¢è¿å³æ³¨æçå¬ä¼å· <b>ãèµµéå®ã</b>
  </p>
  <img src="https://images.cnblogs.com/cnblogs_com/jyzhao/824234/o_250208075013_qrcode-zjy.jpg" width="160" style="border:1px solid #ddd;border-radius:8px;">
</div>
</div>
<div class="clear"></div>

        <div class="clear"></div>
        
</div>
    <ul class="postmetadata">
        <vc:categories-tags blog-app="jyzhao" blog-id="186567" post-id="19479470"></vc:categories-tags>
    </ul>
 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æµèç®æ³ç«èµä¸­ç»´æ¤ä¸­ä½æ°çå°æå·§ ]]></title>
    <link>https://www.cnblogs.com/GroundhogKing/p/19479345</link>
    <guid>78576c713959f1fba2ffcc2d440488b6</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/GroundhogKing/p/19479345" title="åå¸äº 2026-01-13 23:13">
    <span role="heading" aria-level="2">æµèç®æ³ç«èµä¸­ç»´æ¤ä¸­ä½æ°çå°æå·§</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>é¦åæ¥çæåæ­çµå¤æ ¡çä¸éé¢ç®ï¼</p>
<hr>
<p>å¯¹äºä¸ä¸ªé¿åº¦ä¸º <span class="math inline">\(L\)</span>(<span class="math inline">\(L\)</span>ä¸ºå¥æ°) çæ°ç» <span class="math inline">\(a\)</span>ï¼å®ä¹å®çä¸­ä½æ° <span class="math inline">\(median(a)\)</span> ä¸º <span class="math inline">\(a\)</span> ä¸­ç¬¬ <span class="math inline">\(\frac{L+1}{2}\)</span> å¤§çæ°ãç°å¨ç»ä½ ä¸ä¸ªé¿åº¦ä¸º <span class="math inline">\(n\)</span> çæåï¼å¯¹äºæ¯å¯¹æ»¡è¶³ <span class="math inline">\(1\leq i \leq j \leq n\)</span> ä¸ <span class="math inline">\(j-i \equiv 0 (mod 2)\)</span> ç <span class="math inline">\((i,j)\)</span>ï¼ä½ éè¦è®¡ç® <span class="math inline">\(i*j*median(p[i,j])\)</span>ãè¾åºææå¼çåã</p>
<p>å¤æµæ° <span class="math inline">\(T \leq 20\)</span>ï¼æåé¿åº¦ <span class="math inline">\(n \leq 2000\)</span>ã</p>
<hr>
<p>å¯¹äºè¿éé¢ï¼é¦åæ³å°çæ¯æä¸¾ææ <span class="math inline">\([i,j]\)</span>ï¼éè¿æ°æ®ç»æ(å¯¹é¡¶å ç­)ç»´æ¤ä¸­ä½æ°ãç±äºè¿äºæ¹æ³é½å¸¦logï¼å¹¶ä¸æ¬é¢å¤æµæ°æ®ä¸ä¿è¯ <span class="math inline">\(n\)</span> çæ»åãå æ­¤å¤æåº¦ <span class="math inline">\(O(n^2lognT)\)</span>ï¼æ æ³éè¿æ¬é¢ã</p>
<p>æ¢ä¸ªæè·¯ï¼æä¸¾åºé´ä¸è¡ï¼å°±è®¡ç®æ¯ä¸ªä½ç½®çè´¡ç®ãæ³æ³ä¸ä¸ªä½ç½®è½æä¸ºä¸ä¸ªåºé´çä¸­ä½æ°ï¼éè¦æ»¡è¶³ä»ä¹æ¡ä»¶ï¼è¯¥åºé´ä¸­å¤§äºå®åå°äºå®çæ°çæ°éç¸ç­ã</p>
<p>ä¸ä¸ªå¾ç»å¸çå¤çå°±æ¯ï¼å°å°äº <span class="math inline">\(x\)</span> çæ°èµ-1ï¼å°å¤§äº <span class="math inline">\(x\)</span> çæ°èµ1ï¼æä»¬å¯¹è¿ä¸ªæ°ç»ååç¼åï¼è®°ä½ <span class="math inline">\(pre\)</span>ãäºæ¯é®é¢å°±è½¬æ¢ä¸ºï¼å¨ <span class="math inline">\(x\)</span> çå·¦è¾¹æ¾å° <span class="math inline">\(pre_i\)</span>ï¼å¨ <span class="math inline">\(x\)</span> çå³è¾¹æ¾å° <span class="math inline">\(pre_j\)</span>ï¼ä½¿å¾ <span class="math inline">\(pre_i = pre_j\)</span>ãé£ä¹ <span class="math inline">\(pre_j - pre_i = 0\)</span>ï¼è¿å°±æå³çï¼åºé´ <span class="math inline">\([l+1,r]\)</span> ä¸­å¤§äº <span class="math inline">\(x\)</span> åå°äº <span class="math inline">\(x\)</span> çæ°çæ°éç¸ç­ã</p>
<p>å¯¹äºæ¯ä¸ªæ°å¤çä¸æ¬¡è¿æ ·çåç¼åæ°ç»æ¯ <span class="math inline">\(O(n)\)</span> çï¼å æ­¤å¯ä»¥å¨ <span class="math inline">\(O(n^2T)\)</span> çæ¶é´ä¸éè¿æ¬é¢ã</p>
<p><strong>Code:</strong></p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;vector&gt;
using namespace std;

using ll = long long;

void solve()
{
    int n;
    cin &gt;&gt; n;
    vector&lt;int&gt; a(n+10);
    for (int i = 1 ; i &lt;= n ; i++) cin &gt;&gt; a[i];

    ll ans = 0;
    for (int i = 1 ; i &lt;= n ; i++) //æä¸¾ä¸­ä½æ°
    {
        vector&lt;int&gt; pre(n+10);
        vector&lt;int&gt; t(2*n+10); //æ¡¶,å ä¸ºä¼åºç°è´æ°ï¼è¦å¸¦nçåç§»
        t[n]++;
        for (int j = 1 ; j &lt;= n ; j++)
        {
            pre[j] = pre[j-1];
            if (a[j] &gt; a[i]) pre[j]++;
            else if (a[j] &lt; a[i]) pre[j]--;

            if (j &lt; i) t[pre[j]+n] += j + 1;
            else ans += (ll)a[i] * t[pre[j]+n] * j;
        }
    }

    cout &lt;&lt; ans &lt;&lt; endl;
}

int main()
{
    ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);

    int T;
    cin &gt;&gt; T;
    while (T--) solve();

    return 0;
}
</code></pre>
<p>åºäºæ¬é¢ï¼å¯ä»¥å½çº³ä¸ä¸ªç»´æ¤ä¸­ä½æ°çå°æå·§ï¼éè¿ç»å¤§äº <span class="math inline">\(x\)</span> å å°äº <span class="math inline">\(x\)</span> çæ°åå«èµå¼ï¼å¹¶æ±åç¼åï¼å°±å¯ä»¥ææ±ä¸­ä½æ°é®é¢ï¼è½¬åæç»´æ¤åç¼åä¹å·®ä¸º0ã</p>
<p>ä»¥ä¸ååä¸ªæå±ï¼åºå <span class="math inline">\(a\)</span> çä¸­ä½æ° <span class="math inline">\(median(a) \ge v\)</span>ï¼å½ä¸ä»å½ <span class="math inline">\(a\)</span> ä¸­ <span class="math inline">\(cnt_{a_i \geq v} \geq cnt_{a_i &lt; v}\)</span>ï¼å¼ä¸­æ¯å¦åç­å·åå³äºé¢ç®æä¹å®ä¹ä¸­ä½æ°ï¼ãä¹å°±æ¯è¯´ï¼<span class="math inline">\(median(a) \geq v\)</span> çåè¦æ¡ä»¶æ¯ <span class="math inline">\(a\)</span> ä¸­ <span class="math inline">\(\geq v\)</span> çæ°çæ°éå¤äºæç­äº <span class="math inline">\(&lt; v\)</span> çæ°çæ°éãè¿ä¸ªå¼å­æ¯è¾å¥½çè§£ï¼è¿éä¸åè¯æã</p>
<p>è¿ä¸ªå¼å­ç»æä»¬æä¾äºä¸ç§äºåçæè·¯ã</p>
<p>çä¸é¢è¿éé¢<a href="https://codeforces.com/contest/2128/problem/E1" target="_blank" rel="noopener nofollow">Submedians (Easy Version)</a>ï¼</p>
<hr>
<p>å¯¹äºé¿åº¦ä¸º <span class="math inline">\(m\)</span> çæ°ç» <span class="math inline">\(b\)</span>ï¼æ´æ° <span class="math inline">\(v\)</span> æ¯ <span class="math inline">\(b\)</span> çä¸­ä½æ°ï¼å½ä¸ä»å½ï¼</p>
<ul>
<li><span class="math inline">\(v\)</span> è³å°å¤§äºç­äºæ°ç»ä¸­ <span class="math inline">\(\lceil \frac{m}{2} \rceil\)</span> ä¸ªåç´ ï¼å¹¶ä¸</li>
<li><span class="math inline">\(v\)</span> è³å°å°äºç­äºæ°ç»ä¸­ <span class="math inline">\(\lceil \frac{m}{2} \rceil\)</span> ä¸ªåç´ ã</li>
</ul>
<p>ç°å¨ç»å®ä¸ä¸ªæ´æ° <span class="math inline">\(k\)</span> åä¸ä¸ªç± <span class="math inline">\(1\)</span> å° <span class="math inline">\(n\)</span> ä¹é´çæ´æ°ææçæ°ç» <span class="math inline">\(a_1, \ldots, a_n\)</span>ã</p>
<p>å¦æå­å¨è³å°ä¸å¯¹ä¸æ  <span class="math inline">\((l, r)\)</span> æ»¡è¶³ï¼</p>
<ul>
<li><span class="math inline">\(1 \leq l \leq r \leq n\)</span>ï¼</li>
<li><span class="math inline">\(r - l + 1 \geq k\)</span>ï¼</li>
<li><span class="math inline">\(v\)</span> æ¯å­æ°ç» <span class="math inline">\([a_l, \ldots, a_r]\)</span> çä¸­ä½æ°ï¼</li>
</ul>
<p>åç§° <span class="math inline">\(1\)</span> å° <span class="math inline">\(n\)</span> ä¹é´çæ´æ° <span class="math inline">\(v\)</span> æ¯ä¸ä¸ªå­ä¸­ä½æ°ã</p>
<p>å¯ä»¥è¯æï¼è³å°å­å¨ä¸ä¸ªå­ä¸­ä½æ°ãè¯·ä½ æ¾åºæå¤§çå­ä¸­ä½æ° <span class="math inline">\(v_{\max}\)</span>ï¼ä»¥åä»»æä¸ç»å¯¹åºçä¸æ å¯¹ <span class="math inline">\((l, r)\)</span>ã</p>
<hr>
<p>èèäºåï¼å½ <span class="math inline">\(v\)</span> è¶å¤§ï¼<span class="math inline">\(cnt_{a_i\geq v}\)</span> è¶å°ï¼åä¹ <span class="math inline">\(cnt_{a_i &lt; v}\)</span> è¶å¤§ï¼å æ­¤è¶å¤§çæ°è¶ä¸å¯è½ä½ä¸ºä¸­ä½æ°ã</p>
<p>åæ ·å° <span class="math inline">\(\geq v\)</span> çæ°èµ1ï¼<span class="math inline">\(&lt; v\)</span> çæ°èµ-1ï¼ååç¼åç»´æ¤å³å¯ã</p>
<p><strong>Code:</strong></p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;vector&gt;
using namespace std;

void solve()
{
    int n,k;
    cin &gt;&gt; n &gt;&gt; k;
    vector&lt;int&gt; a(n+10);
    for (int i = 1 ; i &lt;= n ; i++) cin &gt;&gt; a[i];

    int ansl, ansr;
    auto check = [&amp;](int mid)
    {
        vector&lt;int&gt; sum(n+10);
        for (int i = 1 ; i &lt;= n ; i++)
        {
            sum[i] = sum[i-1];
            if (a[i] &gt;= mid) sum[i]++;
            else sum[i]--;
        }

        int minn = 2e9;
        int l;
        for (int i = k ; i &lt;= n ; i++)
        {
            if (sum[i-k] &lt; minn)
            {
                minn = sum[i-k];
                l = i - k + 1;
            }
            if (sum[i]-minn &gt;= 0)
            {
                ansl = l;
                ansr = i;
                return true;
            }
        }

        return false;
    };

    int l = 0;
    int r = n + 1;
    while (l+1 != r)
    {
        int mid = (l+r) &gt;&gt; 1;
        if (check(mid)) l = mid;
        else r = mid;
    }

    check(l);
    cout &lt;&lt; l &lt;&lt; " " &lt;&lt; ansl &lt;&lt; " " &lt;&lt; ansr &lt;&lt; endl;
}

int main()
{
    ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);

    int T;
    cin &gt;&gt; T;
    while (T--) solve();

    return 0;
}
</code></pre>
<p>ä¸éä¸ä¸é¢å ä¹ä¸æ ·çé¢ç®<a href="https://codeforces.com/contest/1486/problem/D" target="_blank" rel="noopener nofollow">Max Median</a>ï¼</p>
<p>é¢ç®å¾ç­ï¼è¿éä¸åé¢ææ¦è¿°ãéè¦æ³¨æçæ¯ï¼ç±äºæ¬é¢å®ä¹ä¸­ä½æ°ä¸ºç¬¬ <span class="math inline">\(\lfloor \frac{L+1}{2} \rfloor\)</span> å¤§çæ°ï¼å æ­¤æ¬é¢ <span class="math inline">\(median(a) \geq v\)</span> çæ¡ä»¶ä¸ºï¼<span class="math inline">\(cnt_{a_i \geq v} &gt; cnt_{a_i &lt; v}\)</span>ã</p>
<p><strong>Code:</strong></p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;vector&gt;
using namespace std;

void solve()
{
    int n,k;
    cin &gt;&gt; n &gt;&gt; k;
    vector&lt;int&gt; a(n+10);
    for (int i = 1 ; i &lt;= n ; i++) cin &gt;&gt; a[i];

    int ansl, ansr;
    auto check = [&amp;](int mid)
    {
        vector&lt;int&gt; sum(n+10);
        for (int i = 1 ; i &lt;= n ; i++)
        {
            sum[i] = sum[i-1];
            if (a[i] &gt;= mid) sum[i]++;
            else sum[i]--;
        }

        int minn = 2e9;
        int l;
        for (int i = k ; i &lt;= n ; i++)
        {
            if (sum[i-k] &lt; minn)
            {
                minn = sum[i-k];
                l = i - k + 1;
            }
            if (sum[i]-minn &gt; 0)
            {
                ansl = l;
                ansr = i;
                return true;
            }
        }

        return false;
    };

    int l = 0;
    int r = n + 1;
    while (l+1 != r)
    {
        int mid = (l+r) &gt;&gt; 1;
        if (check(mid)) l = mid;
        else r = mid;
    }

    check(l);
    cout &lt;&lt; l &lt;&lt; endl;
}

int main()
{
    ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);

    int T = 1;
    while (T--) solve();

    return 0;
}
</code></pre>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 23:13">2026-01-13 23:13</span>&nbsp;
<a href="https://www.cnblogs.com/GroundhogKing">GroundhogKing</a>&nbsp;
éè¯»(<span id="post_view_count">51</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479345);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479345', targetLink: 'https://www.cnblogs.com/GroundhogKing/p/19479345', title: 'æµèç®æ³ç«èµä¸­ç»´æ¤ä¸­ä½æ°çå°æå·§' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å½æ¡å½¢å¾éä¸æåæ ï¼å¾åä¸åå½¢æ¡å½¢å¾çè§è§é©å½ ]]></title>
    <link>https://www.cnblogs.com/wang_yb/p/19479454</link>
    <guid>3df46e653b4c65413fc3368a038ee851</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/wang_yb/p/19479454" title="åå¸äº 2026-01-13 23:10">
    <span role="heading" aria-level="2">å½æ¡å½¢å¾éä¸æåæ ï¼å¾åä¸åå½¢æ¡å½¢å¾çè§è§é©å½</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ³è±¡ä¸ä¸ï¼ä½ æ­£ç«å¨ä¸ä¸ªåå½¢å¹¿åºçä¸­å¿ï¼å¨å´ååæåç12æ ¹é«åº¦ä¸åçç¯æ±ï¼è¿å°±æ¯<strong>å¾åæ¡å½¢å¾</strong>å¸¦ç»æä»¬çè§è§ä½éªã</p>
<p>å¨æ°æ®å¯è§åé¢åï¼æä»¬å¸¸å¸¸æ»¡è¶³äºä¼ ç»çç´è§åæ ç³»æ¡å½¢å¾ï¼ä½å½æ°æ®å·æå¨ææ§ææ¯è¾æ§æ¶ï¼<strong>å¾åæ¡å½¢å¾</strong>å<strong>åå½¢æ¡å½¢å¾</strong>ä¸ºæä»¬æå¼äºæ°çå¯è½æ§ã</p>
<h1 id="1-è®¾è®¡åç">1. è®¾è®¡åç</h1>
<p>è¿ä¸¤ç§å¾è¡¨æä¼ ç»ç<strong>ç¬å¡å°åæ ç³»</strong>æ¢æ<strong>æåæ ç³»</strong>ï¼è§åº¦è¡¨ç¤ºç±»å«ï¼åå¾æè§åº¦é¿åº¦è¡¨ç¤ºæ°å¼ã</p>
<h2 id="11-å¾åæ¡å½¢å¾">1.1. å¾åæ¡å½¢å¾</h2>
<p><strong>å¾åæ¡å½¢å¾</strong>æ¬è´¨ä¸æ¯å°ä¼ ç»æ¡å½¢å¾çç´è§åæ ç³»è½¬æ¢ä¸ºæåæ ç³»ã</p>
<p>å¨æåæ ç³»ä¸­ï¼æ¯ä¸ªæ°æ®ç¹ä¸åç±<code>(x, y)</code>å®ä½ï¼èæ¯ç±<strong>(è§åº¦, åå¾)</strong>ç¡®å®ï¼æ¡å½¢çé«åº¦ï¼æé¿åº¦ï¼ç±åå¾å¼è¡¨ç¤ºï¼èæ¡å½¢çæååæ²¿çåå¨æ¹åã</p>

<p><img src="https://img2024.cnblogs.com/blog/83005/202601/83005-20260113230907077-321355021.png" alt="" loading="lazy"></p>
<p><strong>è®¾è®¡çµæ</strong>ï¼å¦åéè¡¨çæéæé·è¾¾çæ«æçº¿ï¼å¾åæ¡å½¢å¾åé´äºèªç¶çåäººå·¥å¶åä¸­å¸¸è§çåå½¢å¸å±ï¼å©ç¨äºäººç±»å¯¹è§åº¦åå¯¹ç§°æ§çå¤©ç¶æç¥è½åã</p>
<h2 id="12-åå½¢æ¡å½¢å¾">1.2. åå½¢æ¡å½¢å¾</h2>
<p><strong>åå½¢æ¡å½¢å¾</strong>æ¯å¾åæ¡å½¢å¾çä¸ç§ç¹æ®å½¢å¼ï¼å®åºå®äºèµ·ç¹åç»ç¹ï¼ä½¿æææ¡å½¢é½å¨åä¸åå¨ä¸å¼å§ï¼åªå¨åå¾æ¹åä¸å»¶ä¼¸ã</p>
<p>è¿ç§è®¾è®¡è§£å³äºå®å¨å¾åå¸å±å¯è½å¯¼è´ç<strong>æ°æ®æ¯è¾å°é¾</strong>é®é¢ï¼å ä¸ºæææ¡å½¢çåºåçº¿æ¯ä¸è´çã</p>

<p><img src="https://img2024.cnblogs.com/blog/83005/202601/83005-20260113230907250-2040360098.png" alt="" loading="lazy"></p>
<p><strong>è®¾è®¡æ¯å»</strong>ï¼æ³è±¡ä¸ç»è·³é«è¿å¨åï¼ä»ä»¬é½ä»åä¸é«åº¦èµ·è·³ï¼åªæ¯è·³è·çé«åº¦ä¸åââåå½¢æ¡å½¢å¾å°±æ¯è¿æ ·å¬å¹³ç"ç«æåº"ã</p>
<h1 id="2-åºç¨ç¤ºä¾">2. åºç¨ç¤ºä¾</h1>
<p>ä¸é¢éè¿ç¤ºä¾æ¥æ¼ç¤ºè¿ä¸¤ç§å¾å¨å®éåºæ¯ä¸­çåºç¨ã</p>
<h2 id="21-å¾åæ¡å½¢å¾">2.1. å¾åæ¡å½¢å¾</h2>
<pre><code class="language-python"># --- 1. æé æµè¯æ°æ® ---
# åè®¾æä»¬æ³æ¯è¾ä¸å¹´ä¸­æ¯ä¸ªæçå¹³åéæ°´é
æä»½ = [
    "ä¸æ",
    "äºæ",
    "ä¸æ",
    "åæ",
    "äºæ",
    "å­æ",
    "ä¸æ",
    "å«æ",
    "ä¹æ",
    "åæ",
    "åä¸æ",
    "åäºæ",
]
# çææ¨¡æçéæ°´éæ°æ® (åä½: mm)
np.random.seed(42)  # ä¸ºäºç»æå¯å¤ç°
éæ°´é = np.random.uniform(30, 150, size=len(æä»½))  # éæºçæ30-150mmçæ°æ®

# --- 2. åå»ºå¾å½¢ ---
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 7), facecolor="white")

# --- 2.1 ç»å¶ä¼ ç»æ¡å½¢å¾ ---
# ... çç¥ ...

# --- 2.2 ç»å¶å¾åæ¡å½¢å¾ ---
# è®¡ç®æ¯ä¸ªæ¡å½¢çè§åº¦ä½ç½®
# ... çç¥ ...

# ä½¿ç¨æåæ å­å¾
ax2 = plt.subplot(122, projection="polar")
# å³é®ï¼è®¾ç½® 'bottom' åæ°ä¸º inner_radiusï¼è¿æ ·æ¡å½¢å°±ä» inner_radius å¼å§ç»ï¼é¿åº¦ä¸º radii
bars = ax2.bar(
    theta,
    radii,
    width=0.4,
    bottom=inner_radius,
    color="lightcoral",
    edgecolor="darkred",
    alpha=0.7,
)

# æ·»å æ°å¼æ ç­¾ (å¨æ¡å½¢åé¨ï¼é è¿å¤ä¾§)
for angle, radius, month in zip(theta, radii, æä»½):
    ax2.text(
        angle,
        inner_radius + radius / 2,
        f"{radius:.1f}",
        ha="center",
        va="center",
        fontsize=8,
        color="black",
    )

# æ·»å æä»½æ è®° (å¨æ¡å½¢å¤é¨)
# ... çç¥ ...

# --- 3. æ¾ç¤ºå¾å½¢ ---
plt.tight_layout()
plt.show()
</code></pre>
<p>è¿æ®µä»£ç é¦åçæäºæ¨¡æçæåº¦éæ°´éæ°æ®ï¼ç¶åå¨åä¸ä¸ªå¾å½¢çªå£ä¸­åå»ºäºä¸¤ä¸ªå­å¾ã</p>
<p>å·¦ä¾§æ¯ä½¿ç¨ <code>plt.bar</code> åå»ºçä¼ ç»æ¡å½¢å¾ï¼å³ä¾§æ¯ä½¿ç¨ <code>plt.subplot(..., projection='polar')</code> å <code>ax.bar</code> åå»ºçå¾åæ¡å½¢å¾ã</p>
<p><strong>å¾åæ¡å½¢å¾</strong>å©ç¨äºæåæ ç³»ï¼å°ç±»å«ï¼æä»½ï¼åå¸å¨åå¨ä¸ï¼å°æ°å¼ï¼éæ°´éï¼æ å°å°å¾åé¿åº¦ä¸ã</p>

<p><img src="https://img2024.cnblogs.com/blog/83005/202601/83005-20260113230907232-60855079.png" alt="" loading="lazy"></p>
<p><strong>å¾åæ¡å½¢å¾</strong>æ¯ä¸ç§å¨æåæ ç³»ä¸ç»å¶çå¾è¡¨ï¼å¯ä»¥æä¾æ¯ä¼ ç»æ¡å½¢å¾æ´å·è§è§å¸å¼åçæ¿ä»£æ¹æ¡ãå®éè¿å¼§é¿æ¥è¡¨ç¤ºæ°å¼ï¼å¹¶ä¸å¯ä»¥ææå°å©ç¨ç©ºé´ï¼å°¤å¶æ¯å¨å¤çç±»å«è¾å¤æéè¦å¼ºè°å¨ææ§æ¨¡å¼ï¼ä¾å¦ææä»½æå­£åº¦åç»çæ°æ®ï¼æ¶ã</p>
<h2 id="22-åå½¢æ¡å½¢å¾">2.2. åå½¢æ¡å½¢å¾</h2>
<pre><code class="language-python">from matplotlib import cm
from math import log10

labels = list("ABCDEFG")
data = [21, 57, 88, 14, 76, 91, 26]
# ... çç¥ ...

#create colors along a chosen colormap
colors = [cm.terrain(i / n) for i in range(n)]

#create figure, axis
fig, ax = plt.subplots()

#create rings of donut chart
for i in range(n):
    current_outer_radius = r - i * w
    innerring, _ = ax.pie([m - data[i], data[i]], 
                          radius = current_outer_radius, 
                          startangle = 90, 
                          colors = ["white", colors[i]])

    # æ·»å æ ç­¾
    # ... çç¥ ...

plt.show()
</code></pre>

<p><img src="https://img2024.cnblogs.com/blog/83005/202601/83005-20260113230907034-1742470964.png" alt="" loading="lazy"></p>
<p><strong>åå½¢æ¡å½¢å¾</strong>ä»åä¸åºåçº¿å¼å§ï¼é¿åäº<strong>å¾åæ¡å½¢å¾</strong>ä¸­ä¸åè§åº¦èµ·å§ç¹ä¸åçé®é¢ï¼æ´å ä¾¿äºæ¯è¾ã</p>
<h1 id="3-æ»ç»">3. æ»ç»</h1>
<p><strong>å¾åæ¡å½¢å¾</strong>å<strong>åå½¢æ¡å½¢å¾</strong>ä»£è¡¨äºæ°æ®å¯è§åä»çº¯åè½ååè½ç¾å­¦å¹³è¡¡çæ¼è¿ã</p>
<p>å®ä»¬ä¸æ¯è¦å®å¨åä»£ä¼ ç»æ¡å½¢å¾ï¼èæ¯ä¸ºæä»¬æä¾äºæ´å¤è§è§åäºçå·¥å·ã</p>
<p>å°±åä¸ä½çç»çå¨å¸æ¥æå¤ç§åå·ä¸æ ·ï¼ä¼ç§çæ°æ®åæå¸ä¹åºè¯¥ææ¡å¤ç§å¯è§åææ¯ï¼æ ¹æ®æ°æ®ç¹æ§åæ²éç®æ éæ©æåéç"åå·"ã</p>
<p>å½ä½ çæ°æ®è®²è¿°çå¨ææ§çæäºï¼æéè¦å¨æéç©ºé´åè¿è¡å¤ç»´åº¦æ¯è¾æ¶ï¼ä¸å¦¨å°è¯è¿äºåå½¢å¯è§åæ¹æ³ãå®ä»¬ä¸ä»è½æ´ææå°ä¼ è¾¾ä¿¡æ¯ï¼è¿è½ä¸ºä½ çæ¥åæä»ªè¡¨æ¿å¢æ·»ç¬ç¹çè§è§é­åã</p>
<p>æå¥½çå¯è§åä¸æ¯æå¤æçï¼èæ¯æè½æ¸æ°ä¼ è¾¾æ°æ®æäºçã</p>
<p><strong>å¾å</strong>å<strong>åå½¢æ¡å½¢å¾</strong>æ­£æ¯è¿æ ·ä¸ç§å·¥å·ï¼å¨ä¼ ç»ä¸ç°ä»£ä¹é´ï¼å¨åè½ä¸ç¾å­¦ä¹é´ï¼æ¾å°äºä¼éçå¹³è¡¡ç¹ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 23:10">2026-01-13 23:10</span>&nbsp;
<a href="https://www.cnblogs.com/wang_yb">wang_yb</a>&nbsp;
éè¯»(<span id="post_view_count">47</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479454);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479454', targetLink: 'https://www.cnblogs.com/wang_yb/p/19479454', title: 'å½æ¡å½¢å¾éä¸æåæ ï¼å¾åä¸åå½¢æ¡å½¢å¾çè§è§é©å½' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Spring çè¥¿è¥¿å¼æ¯ä¹ç³ï¼çè§£ BeanFactoryãFactoryBean ä¸ ObjectFactory ]]></title>
    <link>https://www.cnblogs.com/xzqcsj/p/19479429</link>
    <guid>5f42092059049f38cc1030daeae31568</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xzqcsj/p/19479429" title="åå¸äº 2026-01-13 22:46">
    <span role="heading" aria-level="2">Spring çè¥¿è¥¿å¼æ¯ä¹ç³ï¼çè§£ BeanFactoryãFactoryBean ä¸ ObjectFactory</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3703499/202601/3703499-20260113224556329-1020363253.png" alt="Spring çè¥¿è¥¿å¼æ¯ä¹ç³ï¼çè§£ BeanFactoryãFactoryBean ä¸ ObjectFactory" class="desc_img">
        ä»å¤©ï¼ä»£ç åæ¥éäºãæèä¹è®¸æ¯æ¨å¤©ï¼æä¸æ¸æ¥ã
ä¸ç®¡ææ ·ï¼Spring å®¹å¨æåºäºä¸ä¸ª BeanCreationExceptionãä¸ºäºè§£å³å®ï¼æè¢«è¿«æ½å¥æ¡æ¶çæ·±å¤ï¼å»æ³¨è§é£äºå¹³æ¶è¢« @Autowired æ©ççé½¿è½®ã
å¨ Spring çä¸çéï¼å­å¨çä¸ç§å¿ç¶çå¤ææ§ãè¿ç§å¤ææ§å¹¶éè®¾è®¡èçæ¶è¶£å³ï¼èæ¯ä¸ºäºå¨ä¸ä¸ªéæçè¯­è¨ä¸­æå»ºå¨æä¸çæä»åºçä»£ä»·ã
å¨è¿ä¸ªåºå¤§çæºå¨ä¸­ï¼æä¸ä¸ªåå­æå¶ç¸ä¼¼çæ¦å¿µç»å¸¸è¢«æ··æ·ï¼BeanFactoryãFactoryBean å ObjectFactoryãè¿å¹¶ä¸æ¯å½åçè´«ç ï¼èæ¯å®ä»¬å¨æ¬è´¨ä¸ç¡®å®å­å¨çå¾®å¦ççº ç¼ ã
ä»å¤©ï¼æä»¬å¥ç¦»æé£äºè±å¨çæ¯å»åæ ç¨çç³è¡£ï¼ç¨ä¸ç§å·éçãè¿ä¹è§£åå­¦çè§è§ï¼å»å®¡è§è¿ä¸ä¸ªæ¦å¿µçæ¬è´¨ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>ä»å¤©ï¼ä»£ç åæ¥éäºãæèä¹è®¸æ¯æ¨å¤©ï¼æä¸æ¸æ¥ã<br>
ä¸ç®¡ææ ·ï¼Spring å®¹å¨æåºäºä¸ä¸ª <code>BeanCreationException</code>ãä¸ºäºè§£å³å®ï¼æè¢«è¿«æ½å¥æ¡æ¶çæ·±å¤ï¼å»æ³¨è§é£äºå¹³æ¶è¢« <code>@Autowired</code> æ©ççé½¿è½®ã</p>
<p>å¨ Spring çä¸çéï¼å­å¨çä¸ç§å¿ç¶çå¤ææ§ãè¿ç§å¤ææ§å¹¶éè®¾è®¡èçæ¶è¶£å³ï¼èæ¯ä¸ºäºå¨ä¸ä¸ªéæçè¯­è¨ä¸­æå»ºå¨æä¸çæä»åºçä»£ä»·ã</p>
<p>å¨è¿ä¸ªåºå¤§çæºå¨ä¸­ï¼æä¸ä¸ªåå­æå¶ç¸ä¼¼çæ¦å¿µç»å¸¸è¢«æ··æ·ï¼<code>BeanFactory</code>ã<code>FactoryBean</code> å <code>ObjectFactory</code>ãè¿å¹¶ä¸æ¯å½åçè´«ç ï¼èæ¯å®ä»¬å¨æ¬è´¨ä¸ç¡®å®å­å¨çå¾®å¦ççº ç¼ ã</p>
<p>ä»å¤©ï¼æä»¬å¥ç¦»æé£äºè±å¨çæ¯å»åæ ç¨çç³è¡£ï¼ç¨ä¸ç§å·éçãè¿ä¹è§£åå­¦çè§è§ï¼å»å®¡è§è¿ä¸ä¸ªæ¦å¿µçæ¬è´¨ã</p>
<hr>
<h2 id="ä¸beanfactoryå­å¨çå®¹å¨">ä¸ãBeanFactoryï¼å­å¨çå®¹å¨</h2>
<p><strong>è®©æä»¬é¦åçº æ­£ä¸ä¸ªè§å¿µï¼BeanFactory åä¸ºå·¥åï¼ä½å¶æ¬è´¨æ¯å®¹å¨ï¼Containerï¼ã</strong></p>
<p>å½æä»¬è°è®º Spring å®¹å¨æ¶ï¼æä»¬å®éä¸æ¯å¨è°è®º <code>BeanFactory</code>ãå®æ¯ Spring IoC å®¹å¨çæ ¹æ¥å£ï¼æ¯æ´ä¸ªä¸ççç©çæ³åã</p>
<h3 id="11-å¯ä¸çèè´£">1.1 å¯ä¸çèè´£</h3>
<p>å®çå®ä¹æå¶åå¶ãå®ä¸å³å¿ä¸å¡é»è¾ï¼åªå³å¿ä¸ä»¶äºï¼<strong>ç®¡çå¯¹è±¡ççå½å¨æ</strong>ã</p>
<pre><code class="language-java">public interface BeanFactory {
    Object getBean(String name) throws BeansException;
    &lt;T&gt; T getBean(String name, Class&lt;T&gt; requiredType);
    boolean containsBean(String name);
    // ...
}
</code></pre>
<p>å½ä½ å¯å¨ä¸ä¸ª Spring Boot åºç¨æ¶ï¼<code>ApplicationContext</code> å°±åä¸ä¸ªåæ»¡æ´»åçåå¸ï¼è <code>BeanFactory</code> åæ¯æ¯æè¿åº§åå¸çå°ä¸ç®¡ç½ãææç BeanDefinitionï¼å³äº Bean åºè¯¥å¦ä½åå»ºçèå¾ï¼é½æ³¨åå¨è¿éã</p>
<h3 id="12-æ®é·çç°å®">1.2 æ®é·çç°å®</h3>
<p>å¨å¤§å¤æ°æåµä¸ï¼ä½ ä¸éè¦ç´æ¥ä¸ <code>BeanFactory</code> å¯¹è¯ãå ä¸º <code>ApplicationContext</code> å·²ç»ä¸ºä½ å°è£å¥½äºä¸åã<br>
ä½å½ä½ è¯å¾çè§£ä¸ºä»ä¹ä½ ç Bean æ²¡æè¢«æ­£ç¡®åå§åï¼æèä¸ºä»ä¹ä½ çå¾ªç¯ä¾èµå¤±ææ¶ï¼ä½ å°±å¿é¡»æè¯å°ï¼<strong>ä½ ææç Beanï¼é½åªæ¯ <code>BeanFactory</code> ä¸­ç entriesï¼æ¡ç®ï¼ã</strong></p>
<p>å®æ¯ä¸ä¸ªå·¨å¤§ç <code>Map&lt;String, BeanDefinition&gt;</code> å <code>Map&lt;String, Object&gt;</code> çç®¡çèãå®å·é·æ æï¼åªæç§å®ä¹çè§åï¼Scope, Lazy, Dependenceï¼æ¥å®ä¾åå¯¹è±¡ã</p>
<hr>
<h2 id="äºfactorybeanå¿è¦çæ¬ºéª">äºãFactoryBeanï¼å¿è¦çæ¬ºéª</h2>
<p>å¦æè¯´ <code>BeanFactory</code> æ¯å®è§è§åçå¶å®èï¼é£ä¹ <code>FactoryBean</code> å°±æ¯å¾®è§è§åç<strong>æ½è¡è</strong>ã</p>
<h3 id="21-éæè¯­è¨çå°å¢">2.1 éæè¯­è¨çå°å¢</h3>
<p>æ³è±¡è¿æ ·ä¸ä¸ªåºæ¯ï¼<strong>ä½ éè¦æ³¨å¥ä¸ä¸ªæ¥å£çå®ç°ï¼ä½è¿ä¸ªå®ç°ç±»å¹¶ä¸å­å¨äºä»£ç ä¸­ï¼å®æ¯éè¿å¨æä»£çå¨è¿è¡æ¶çæçã</strong><br>
è¿å¨ RPC æ¡æ¶ï¼å¦ DubboãFeignï¼å ORM æ¡æ¶ï¼å¦ MyBatisï¼ä¸­æå¶å¸¸è§ã</p>
<p>ä½ æ æ³éè¿ç®åç <code>&lt;bean class="..."&gt;</code> æ <code>@Component</code> æ¥æè¿°ä¸ä¸ªâä¸å­å¨çç±»âã<br>
è¿æ¶åï¼ä½ éè¦ä¸ä¸ªä¸­é´äººãè¿ä¸ªä¸­é´äººè¡¨é¢ä¸æ¯ä¸ä¸ªæ®éç Beanï¼ä½å®éä¸ï¼å®æ¯ä¸ä¸ªå·¥åã</p>
<h3 id="22-ä¼ªè£çèºæ¯ä»¥-mybatis-ä¸ºä¾">2.2 ä¼ªè£çèºæ¯ï¼ä»¥ MyBatis ä¸ºä¾</h3>
<p>ä¸ºä»ä¹ä½ åªéè¦åä¸ä¸ª <code>UserMapper</code> æ¥å£ï¼å°±è½ç´æ¥ <code>@Autowired</code> ä½¿ç¨ï¼<br>
å ä¸º Spring å®¹å¨éæ³¨åçé£ä¸ª "userMapper" Beanï¼æ ¹æ¬ä¸æ¯ä½ çæ¥å£å®ç°ï¼èæ¯ä¸ä¸ª <code>MapperFactoryBean</code>ã</p>
<pre><code class="language-java">// ç®åçé»è¾ç¤ºæ
public class MapperFactoryBean&lt;T&gt; implements FactoryBean&lt;T&gt; {
    
    private Class&lt;T&gt; mapperInterface;

    @Override
    public T getObject() throws Exception {
        // å¾éè·è¿ï¼æç»è¿éåçäºé­æ³ï¼éè¿ JDK å¨æä»£ççææ¥å£çå®
        return (T) Proxy.newProxyInstance(
            mapperInterface.getClassLoader(), 
            new Class[] { mapperInterface }, 
            new MapperProxy&lt;&gt;()
        );
    }

    @Override
    public Class&lt;?&gt; getObjectType() {
        return mapperInterface;
    }

    @Override
    public boolean isSingleton() {
        return true;
    }
}
</code></pre>
<h3 id="23-è¿éççç¸">2.3 è¿éççç¸</h3>
<p>å½å®¹å¨è°ç¨ <code>getBean("userMapper")</code> æ¶ï¼å®åç°è¿æ¯ä¸ä¸ª <code>FactoryBean</code>ãäºæ¯ï¼å®ä¸ä¼è¿å <code>FactoryBean</code> å®ä¾æ¬èº«ï¼èæ¯é»é»å°è°ç¨ <code>getObject()</code>ï¼å¹¶è¿åé£ä¸ªä»£çå¯¹è±¡ã</p>
<p>è¿å°±æ¯æ¬ºéªã<strong>ä½ ä»¥ä¸ºä½ æ¿å°äºä¸ä¸ª Beanï¼å¶å®ä½ æ¿å°çæ¯ Bean çäº§çäº§åã</strong></p>
<p>å¦æä½ æ¸´æçå°çç¸ï¼çå°é£ä¸ªæçºµåå¡çå¹åé»æï¼ä½ éè¦å¨ Bean åç§°åå ä¸ <code>&amp;</code>ï¼</p>
<pre><code class="language-java">// è·åçæ¯ MapperProxy ä»£çå¯¹è±¡
Object product = context.getBean("userMapper"); 

// è·åçæ¯ FactoryBean å·¥åæ¬èº«
Object factory = context.getBean("&amp;userMapper");
</code></pre>
<hr>
<h2 id="ä¸objectfactoryæ¶é´çå»¶è¿">ä¸ãObjectFactoryï¼æ¶é´çå»¶è¿</h2>
<p><code>BeanFactory</code> è´è´£ææ§ç©ºé´ï¼å®¹å¨ï¼ï¼<code>FactoryBean</code> è´è´£ææ§æé ï¼é»è¾ï¼ï¼è <code>ObjectFactory</code> åæ¯ä¸ºäºææ§<strong>æ¶é´</strong>ã</p>
<h3 id="31-å¾ªç¯çæ­»ç»">3.1 å¾ªç¯çæ­»ç»</h3>
<p>å¨ Spring çä¸çéï¼æä¸ä¸ªç»å¸çèè°¬ï¼A éè¦ Bï¼B éè¦ Aã<br>
å¦ææ¯æé å¨æ³¨å¥ï¼åªéå¦ç¶æ¿è®¤å¤±è´¥ãä½å¦ææ¯ Setter æ³¨å¥ï¼Spring è¯å¾æ½æè¿ç§æ­»ç»ã</p>
<p>å¨ A åå»ºçè¿ç¨ä¸­ï¼éè¦æ³¨å¥ BãB åå»ºæ¶ï¼åéè¦æ³¨å¥ Aã<br>
æ­¤æ¶ A è¿å¨åå»ºä¸­ï¼å°ä¸æ¯ä¸ä¸ªå®æ´ç Beanãæä¹åï¼<br>
Spring å¼å¥äºä¸çº§ç¼å­çæ¦å¿µãèç¬¬ä¸çº§ç¼å­ï¼å­æ¾çå°±æ¯ä¸ä¸ª <code>ObjectFactory</code>ã</p>
<h3 id="32-åè°çæ¬è´¨">3.2 åè°çæ¬è´¨</h3>
<p><code>ObjectFactory</code> å¨æºç ä¸­ç®åå¾ä»¤äººåæï¼</p>
<pre><code class="language-java">@FunctionalInterface
public interface ObjectFactory&lt;T&gt; {
    T getObject() throws BeansException;
}
</code></pre>
<p>å®åªæ¯ä¸ä¸ª<strong>å½æ°å¼æ¥å£</strong>ï¼ä¸ä¸ªåè°ã<br>
å®å­å¨çæä¹å¨äºï¼<strong>æç°å¨ä¸æ³è¦è¿ä¸ªå¯¹è±¡ï¼ä½ææ³è¦ä¸ä¸ªâå¨æªæ¥æä¸ªæ¶å»è½è·åè¿ä¸ªå¯¹è±¡âçè½åã</strong></p>
<p>å¨å¾ªç¯ä¾èµä¸­ï¼Spring æåæ´é²äºä¸ä¸ª <code>ObjectFactory</code>ï¼</p>
<pre><code class="language-java">addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));
</code></pre>
<p>å½ B éè¦ A æ¶ï¼å®éè¿è¿ä¸ª <code>ObjectFactory</code> æ¿å°äº A çæ©æå¼ç¨ï¼Early Referenceï¼ãå°½ç®¡ A è¿æ²¡å®å¨åå§åå¥½ï¼ä½ B å·²ç»å¯ä»¥ææå®çå¼ç¨äºãæ­»ç»è§£å¼äºã</p>
<h3 id="33-ä½ç¨åçéä½">3.3 ä½ç¨åçéä½</h3>
<p>å¦ä¸ä¸ªåºæ¯æ¯ï¼ä¸ä¸ªåä¾ï¼Singletonï¼ç Service éè¦ä½¿ç¨ä¸ä¸ª ååï¼Prototypeï¼ç Beanã<br>
å¦æä½ ç´æ¥ <code>@Autowired</code>ï¼ååç Bean åªæå¨ Service åå»ºæ¶è¢«æ³¨å¥ä¸æ¬¡ï¼ä¹åä¹å°±æ¯æ°¸è¿åä¸ä¸ªå¯¹è±¡äºãè¿è¿èäºååçåè¡·ã</p>
<p>å¦ä½è§£å³ï¼ä½¿ç¨ <code>ObjectFactory</code> å»¶è¿è·åã</p>
<pre><code class="language-java">@Service
public class ReportService {
    
    @Autowired
    private ObjectFactory&lt;ReportBuilder&gt; builderFactory;

    public void generate() {
        // æ¯æ¬¡è°ç¨ getObject()ï¼å®¹å¨é½ä¼åå»ºä¸ä¸ªå¨æ°ç ReportBuilder
        ReportBuilder builder = builderFactory.getObject();
        builder.build();
    }
}
</code></pre>
<p>å¨è¿éï¼<strong><code>ObjectFactory</code> å°±åæ¯ä¸ä¸ªéå¾å®¹å¨çå¥æï¼è®©ä½ éæ¶å¯ä»¥ä¼¸æè¿å»æ¿ä¸ä¸ªæ°çå¯¹è±¡ï¼èä¸æ¯å®çéæ§çç¼å­ã</strong></p>
<hr>
<h2 id="åå®¡å¤ä¸è£å³">åãå®¡å¤ä¸è£å³</h2>
<p>è®©æä»¬å¨æåï¼ç¨æå®¢è§çè¡¨æ ¼æ¥å®¡å¤è¿ä¸èçåºå«ãè¿ä¸æ¯ä¸ºäºèè¯µï¼èæ¯ä¸ºäºçæ¸æ··ä¹±ã</p>
<table>
<thead>
<tr>
<th style="text-align: left">ç»´åº¦</th>
<th style="text-align: left">BeanFactory</th>
<th style="text-align: left">FactoryBean</th>
<th style="text-align: left">ObjectFactory</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>å­å¨å½¢å¼</strong></td>
<td style="text-align: left"><strong>å®¹å¨</strong> (Container)</td>
<td style="text-align: left"><strong>Bean</strong> (Component)</td>
<td style="text-align: left"><strong>æ¥å£</strong> (Interface/Callback)</td>
</tr>
<tr>
<td style="text-align: left"><strong>åºå±é»è¾</strong></td>
<td style="text-align: left"><code>ApplicationContext</code> çç¶çº§æ¥å£ / <strong>å®è§å·¥å</strong></td>
<td style="text-align: left">å®ç°äº <code>FactoryBean</code> æ¥å£çç±» / <strong>å¾®è§å·¥å</strong></td>
<td style="text-align: left">å½æ°å¼æ¥å£ / <strong>å»¶è¿åè°</strong></td>
</tr>
<tr>
<td style="text-align: left"><strong>æ ¸å¿èè´£</strong></td>
<td style="text-align: left">ç®¡çææ Bean ççå½å¨æ</td>
<td style="text-align: left">æ­¤ Bean è´è´£<strong>çäº§</strong>å¦ä¸ä¸ªå¤æç Bean</td>
<td style="text-align: left">å°è£å¯¹è±¡çåå»ºè¿ç¨ï¼æä¾<strong>å»¶è¿</strong>è·åè½å</td>
</tr>
<tr>
<td style="text-align: left"><strong>è·åæ¹å¼</strong></td>
<td style="text-align: left"><code>ApplicationContext</code> æ¯å®çè¶é</td>
<td style="text-align: left"><code>getBean("name")</code> æ¿äº§å<br><code>getBean("&amp;name")</code> æ¿å·¥å</td>
<td style="text-align: left">æ³¨å¥ <code>ObjectFactory&lt;T&gt;</code> åè°ç¨ <code>getObject()</code></td>
</tr>
<tr>
<td style="text-align: left"><strong>çå®åºæ¯</strong></td>
<td style="text-align: left">Spring æ¡æ¶çåºç³</td>
<td style="text-align: left">Mybatis <code>MapperFactoryBean</code>, <code>ProxyFactoryBean</code></td>
<td style="text-align: left">è§£å³å¾ªç¯ä¾èµ(ä¸çº§ç¼å­), Scope(ååæ¨¡å¼)éé</td>
</tr>
</tbody>
</table>
<h2 id="äºç»è¯­">äºãç»è¯­</h2>
<p>å¨ä»£ç çèåä¸ï¼æä»¬éè¿æå»ºæ½è±¡æ¥å¯¹ææ··ä¹±ã</p>
<ul>
<li><strong>BeanFactory</strong> æ¯æä»¬èä¸çå¤§å°ã<strong>å®è¢«ç§°ä¸ºå·¥åï¼ä½å®å®éæ¯å­è²ä¸ç©çåå£¤ï¼å®¹å¨ï¼ã</strong></li>
<li><strong>FactoryBean</strong> æ¯æä»¬æä¸­çç²¾å¯æºåºã<strong>å®æ¯ä¸ä¸ªç¹æ®ç Beanï¼å­å¨çç®çå´æ¯ä¸ºäºå¶é å¦ä¸ä¸ª Beanã</strong></li>
<li><strong>ObjectFactory</strong> æ¯æä»¬é¢ççæ¶é´è¶åã<strong>å®åªæ¯ä¸ä¸ªåçº¯çæ¥å£ï¼ä¸ºäºåºå¯¹å¾ªç¯ä¸æªæ¥çä¸ç¡®å®æ§ã</strong></li>
</ul>
<p>çè§£å®ä»¬ï¼å¹¶ä¸æ¯ä¸ºäºéè¿é¢è¯ï¼èæ¯ä¸ºäºå¨ä¸ä¸æ¬¡æåºå¼å¸¸æ¶ï¼ä½ è½å·éå°åè§å æ ä¿¡æ¯ï¼ç¥éæºå¨çåªä¸ªé½¿è½®åçäºéä½ã</p>
<p>æ¢ç¶æä»¬éæ©äºä¸æºå¨å±èï¼å°±å¿é¡»çè§£æºå¨çé»è¾ãè¿æè®¸å°±æ¯ä½ä¸ºå¼åèçè¥¿è¥¿å¼æ¯å¼å½è¿ââ<strong>æä»¬éè¦ä¸æ¬¡åä¸æ¬¡å°å°å·¨ç³æ¨åå±±é¡¶ï¼ä»¥æ­¤è¯ææä»¬å¯¹è¿ä¸ªåºå¤§ç³»ç»çææ§</strong>ã</p>
<blockquote>
<p><strong>æ¬æéè¿ AI æ¶¦è²ï¼å ç¼ªé£æ ¼ï¼ï¼è¯å¾ä»¥ä¸ç§å·éãå®¢è§çè³å­å¨ä¸»ä¹çè§è§ï¼å»è§£æè¿äºå¨æ¥å¸¸ Coding ä¸­è¢«æä»¬ä¹ ä»¥ä¸ºå¸¸çæ¦å¿µãå¸æè¿ç§ç¬ç¹çåäºé£æ ¼ï¼è½è®©ä½ å¯¹è¿äºæ¯ç¥çææ¯æ¦å¿µææ´æ·±å»çâå­å¨æâã</strong></p>
</blockquote>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 22:47">2026-01-13 22:46</span>&nbsp;
<a href="https://www.cnblogs.com/xzqcsj">ä¸æäºº</a>&nbsp;
éè¯»(<span id="post_view_count">77</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479429);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479429', targetLink: 'https://www.cnblogs.com/xzqcsj/p/19479429', title: 'Spring çè¥¿è¥¿å¼æ¯ä¹ç³ï¼çè§£ BeanFactoryãFactoryBean ä¸ ObjectFactory' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºï¼èªç¶è¯­è¨å¤ç  ç¬¬ä¸å¨ï¼å¾ªç¯ç¥ç»ç½ç» ï¼ä¸ï¼åå RNN ä¸æ·±å± RNN ]]></title>
    <link>https://www.cnblogs.com/Goblinscholar/p/19479253</link>
    <guid>837c20fdbd1f629c1bd95d615a2a784e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Goblinscholar/p/19479253" title="åå¸äº 2026-01-13 22:37">
    <span role="heading" aria-level="2">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºï¼èªç¶è¯­è¨å¤ç  ç¬¬ä¸å¨ï¼å¾ªç¯ç¥ç»ç½ç» ï¼ä¸ï¼åå RNN ä¸æ·±å± RNN</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ­¤åç±»ç¨äºè®°å½å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨çå­¦ä¹ ç¬è®°ã<br>
è¯¾ç¨ç¸å³ä¿¡æ¯é¾æ¥å¦ä¸ï¼</p>
<ol>
<li>åè¯¾ç¨è§é¢é¾æ¥ï¼<a href="https://www.bilibili.com/video/BV1FT4y1E74V?buvid=XU762317353676D786954061C192FE625463B&amp;from_spmid=playlist.playlist-detail.0.0&amp;is_story_h5=false&amp;mid=zqernykrmpf7XfIorMR%2FnA%3D%3D&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=ce0bc526-db69-428a-962e-c65ed8c267bc&amp;share_source=COPY&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1713085655&amp;unique_k=DfBgvFW&amp;up_id=8654113&amp;vd_source=e035e9878d32f414b4354b839a4c31a4" target="_blank" rel="noopener nofollow">[åè¯­å­å¹]å´æ©è¾¾æ·±åº¦å­¦ä¹ deeplearning.ai</a></li>
<li>githubè¯¾ç¨èµæï¼å«è¯¾ä»¶ä¸ç¬è®°:<a href="https://github.com/robbertliu/deeplearning.ai-andrewNG" target="_blank" rel="noopener nofollow">å´æ©è¾¾æ·±åº¦å­¦ä¹ æå­¦èµæ</a></li>
<li>è¯¾ç¨éå¥ç»ä¹ ï¼ä¸­è±ï¼ä¸ç­æ¡ï¼<a href="https://blog.csdn.net/u013733326/article/details/79827273" target="_blank" rel="noopener nofollow">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾åä¹ é¢ä¸ç­æ¡</a></li>
</ol>
<p>æ¬ç¯ä¸ºç¬¬äºè¯¾çç¬¬ä¸å¨åå®¹ï¼<a href="https://www.bilibili.com/video/BV1FT4y1E74V?spm_id_from=333.788.videopod.episodes&amp;vd_source=e035e9878d32f414b4354b839a4c31a4&amp;p=161" target="_blank" rel="noopener nofollow">1.11</a>å°<a href="https://www.bilibili.com/video/BV1FT4y1E74V?spm_id_from=333.788.videopod.episodes&amp;vd_source=e035e9878d32f414b4354b839a4c31a4&amp;p=162" target="_blank" rel="noopener nofollow">1.12</a>çåå®¹ï¼åæ¶ä¹æ¯æ¬å¨çè®ºé¨åçæåä¸ç¯ã</p>
<hr>
<p>æ¬å¨ä¸ºç¬¬äºè¯¾çç¬¬ä¸å¨åå®¹ï¼ä¸ CV ç¸å¯¹åºçï¼è¿ä¸è¯¾ææåå®¹çä¸­å¿åªæä¸ä¸ªï¼<strong>èªç¶è¯­è¨å¤çï¼Natural Language Processingï¼NLPï¼</strong>ã<br>
åºç¨å¨æ·±åº¦å­¦ä¹ éï¼å®æ¯ä¸é¨ç¨æ¥è¿è¡<strong>ææ¬ä¸åºåä¿¡æ¯å»ºæ¨¡</strong>çæ¨¡ååææ¯ï¼æ¬è´¨ä¸æ¯å¨å¨è¿æ¥ç½ç»ä¸ç»è®¡è¯­è¨æ¨¡ååºç¡ä¸çä¸æ¬¡âç»æåç¹åâï¼ä¹æ¯äººå·¥æºè½ä¸­<strong>æè´´è¿äººç±»æç»´è¡¨è¾¾æ¹å¼</strong>çéè¦ç ç©¶æ¹åä¹ä¸ã<br>
<strong>è¿ä¸æ´èè¯¾åæ ·æ¶åå¤§ééè¦åå¤æ¶åçåå®¹ï¼æ¨ªè·¨æºå¨å­¦ä¹ ãæ¦çç»è®¡ãçº¿æ§ä»£æ°ä»¥åè¯­è¨å­¦ç´è§ã</strong><br>
è¯­è¨ä¸åå¾åé£æ ·âç´è§å¯è§âï¼æ´å¤æ¯æ½è±¡ç¬¦å·ä¸ä¸ä¸æå³ç³»çç»åï¼å æ­¤<strong>çè§£é¨æ§åèæ´é«</strong>ã<br>
å æ­¤ï¼æåæ ·ä¼å°½éè¡¥è¶³å¿è¦çèæ¯ç¥è¯ï¼å°½å¯è½ç¨æ¯å»åå®ä¾éä½çè§£é¾åº¦ã<br>
æ¬ç¯çåå®¹å³äº<strong>åå RNN ä¸æ·±å± RNN</strong>ï¼æ¯å¯¹åºç¡ RNN ç»æçä¸äºè¡¥åã</p>
<h1 id="1-åå-rnnbidirectional-rnn">1. åå RNNï¼Bidirectional RNNï¼</h1>
<p>å¨åé¢å¯¹ <strong><a href="https://www.cnblogs.com/Goblinscholar/p/19449622" target="_blank">RNN</a>ã<a href="https://www.cnblogs.com/Goblinscholar/p/19463351" target="_blank">GRU</a> ä¸ <a href="https://www.cnblogs.com/Goblinscholar/p/19474433" target="_blank">LSTM</a></strong> çè®¨è®ºä¸­ï¼æä»¬å§ç»é»è®¤äºä¸ä¸ªåæï¼<strong>åºååªè½æ²¿æ¶é´è½´ååå±å¼ï¼æ¨¡åå¨å½åæ¶å»åªè½å©ç¨å·²ç»åºç°çåå²ä¿¡æ¯ã</strong></p>
<p>è¿ç§è®¾å®å¨ä¸äºç®åä»»å¡ä¸­æ¯åççï¼ä½å¨å¤§é<strong>åºåçè§£ä¸æ æ³¨ä»»å¡</strong>ä¸­ï¼å´éèçä¸ä¸ªç»ææ§éå¶ï¼  <strong>å½åæ¶å»çè¯­ä¹æç¶æï¼å¾å¾åæ¶ä¾èµäºè¿å»åæªæ¥çä¸ä¸æä¿¡æ¯ã</strong><br>
ä¸¾ä¸ªè¯¾ç¨éçä¾å­ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260113211513804-150472822.png" alt="image.png" loading="lazy"><br>
äºæ¯ï¼é®é¢åºç°äºï¼<strong>å¦ææªæ¥ä¿¡æ¯ææ¯å¤å®å½åç¶æçéè¦ä¾æ®ï¼è¯¥æä¹åï¼</strong></p>
<p>æ­£æ¯å¨è¿æ ·çèæ¯ä¸ï¼<strong>åå RNNï¼Bidirectional Recurrent Neural Networksï¼</strong> è¢«æåºã<br>
æ©å¨ <strong>1997 å¹´</strong>ï¼<strong><a href="https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&amp;arnumber=650093" target="_blank" rel="noopener nofollow">Bidirectional Recurrent Neural Networks</a></strong> è¿ç¯è®ºæä¸­å°±æåºï¼å¯¹äºåºåæ æ³¨ä¸æ´ä½çè§£ä»»å¡ï¼ä»ä¾èµè¿å»ä¸ä¸æä¼é æä¿¡æ¯å©ç¨ä¸çåå¤©ä¸è¶³ï¼å æ­¤æå¿è¦å¨æ¨¡åç»æå±é¢<strong>åæ¶å»ºæ¨¡æ­£åä¸ååçæ¶é´ä¾èµå³ç³»</strong>ã</p>
<p>éè¦å¼ºè°çæ¯ï¼åå RNN å¹¶ä¸æ¯ä¸ç§æ°çå¾ªç¯ååè®¾è®¡ã<br>
å®å¹¶ä¸æ¹å RNNãLSTM æ GRU åé¨çè®¡ç®å½¢å¼ï¼èæ¯éè¿å¨æ¶é´ç»´åº¦ä¸å¼å¥<strong>ååä¸ååä¸¤æ¡ç¬ç«çç¶æä¼ æ­é¾è·¯</strong>ï¼ä½¿æ¨¡åå¨æ¯ä¸ä¸ªæ¶é´æ­¥é½è½å¤èå<strong>åå²ä¸æªæ¥çä¸ä¸æä¿¡æ¯</strong>ã</p>
<p>ä¹æ­£å ä¸ºè¿ç§âç»æç¬ç«äºååâçç¹æ§ï¼åå RNN å¯ä»¥èªç¶å°ä¸ LSTMãGRU ç»åï¼å½¢æ <strong>Bi-LSTMãBi-GRU</strong>ï¼æä¸ºæåä¸ä¸æå»ºæ¨¡è½åçæ åéç½®ã</p>
<p>å®çå®ç°é»è¾å¹¶ä¸å¤æï¼è¿éå¼ç¨ä¸å¼ æ¯è¾æ¸æ°ææçä¼ æ­å¾ï¼ï¼<a href="https://medium.com/@fraidoonomarzai99/bidirectional-rnn-in-depth-1efd32c3cf46" target="_blank" rel="noopener nofollow">åºå¤</a>ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260113211514563-1603287401.png" alt="image.png" loading="lazy"><br>
è¿æ ·ï¼ä½ å°±ä¼åç°ï¼åä¸åºåè¢« <strong>æ­£åï¼èè²ï¼</strong> å <strong>ååï¼ç»¿è²ï¼</strong> ä¸¤æ¡ RNN åæ¶å»ºæ¨¡ï¼æ¯ä¸ªæ¶é´æ­¥ <span class="math inline">\(t\)</span> é½è½âçå°âæ­£åçåå²ä¸ä¸æåååçæªæ¥ä¸ä¸æï¼æç»è¾åº <span class="math inline">\(\hat y^{\langle t\rangle}\)</span> ç±ä¸¤ä¸ªæ¹åçä¿¡æ¯å±åå³å®ã</p>
<p></p><div class="math display">\[h^{(t)}
=
\operatorname{concat}\!\left(
\overrightarrow{{h}^{(t)}},
\overleftarrow{{h}^{(t)}}
\right)
\quad \text{or} \quad
\overrightarrow{{h}^{(t)}} + \overleftarrow{{h}^{(t)}}
\]</div><p></p><p>å¨å®è·µä¸­ï¼åå RNN æ´å¸¸éç¨<strong>æ¼æ¥æ¹å¼</strong>ä¿çæ¥èªä¸¤ä¸ªæ¶é´æ¹åçå®æ´ä¿¡æ¯ï¼è<strong>éåç´ ç¸å </strong>åæ¯ä¸ç§æ´ç´§åãä½è¡¨è¾¾è½ååéçæä¸­éæ©ã</p>
<p>æåï¼åæä¸ªæ¯æ¹ï¼æåºåæ¯ä½ä¸åº§<strong>è¦å»ºçæ¡¥</strong>ï¼åå RNN å°±åæ¯ä¸¤éå·¥äººä»ä¸¤ä¾§åæ¶æ½å·¥å¹¶ä¸æ­äº¤æµè¿åº¦ï¼ç¡®ä¿ç²¾åï¼ä½åæ¶ï¼æ½å·¥éä¼ç¿»åï¼æ´ä½ææ¬ä¹éä¹ä¸åã<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260113211553645-1826290875.png" alt="image.png" loading="lazy"></p>
<h1 id="2-æ·±å±-rnn">2. æ·±å± RNN</h1>
<p>æ·±å± RNN çæ¦å¿µåæ ·ä¸é¾çè§£ã<br>
å¨æå¼å§å¼å¥ <strong><a href="https://www.cnblogs.com/Goblinscholar/p/19449622" target="_blank">å¾ªç¯ç¥ç»ç½ç»</a></strong> æ¶ï¼æä»¬è¯´æè¿ï¼é»è®¤ä½¿ç¨<strong>åå± RNN</strong> æ¥è¿è¡æ¼ç¤ºï¼<br>
å¨æ¯ä¸ä¸ªæ¶é´æ­¥ <span class="math inline">\(t\)</span>ï¼è¾å¥ <span class="math inline">\(x^{(t)}\)</span> ç»è¿ä¸æ¬¡å¾ªç¯è®¡ç®ï¼å¾å°å¯¹åºçéèç¶æ <span class="math inline">\(a^{(t)}\)</span>ï¼å¹¶æ²¿æ¶é´è½´ä¸æ­ä¼ éã</p>
<p>ä½ä»æ¨¡åè¡¨è¾¾è½åçè§åº¦æ¥çï¼è¿ç§ç»æå­å¨éå¶ï¼<strong>æ¯ä¸ªæ¶é´æ­¥åé¨ï¼åªè¿è¡äºä¸æ¬¡éçº¿æ§åæ¢ã</strong><br>
è¿æå³çï¼æ è®ºåºåæ¬èº«æå¤å¤æï¼å¨âåä¸æ¶å»âå¯¹è¾å¥ä¿¡æ¯çå¤çæ·±åº¦é½æ¯æéçã<br>
å°è¿éï¼å°±åä¹åçå¨è¿æ¥ãå·ç§¯ç½ç»ç¸éäºï¼<br>
<strong>å¦ææä»¬å¸ææ¨¡åå¨æ¯ä¸ä¸ªæ¶é´æ­¥ä¸ï¼ä¹å·å¤ç±»ä¼¼æ·±åº¦åé¦ç½ç»ãå·ç§¯ç½ç»é£æ ·çå±çº§è¡¨è¾¾è½åï¼è¯¥æä¹åï¼</strong><br>
ç­æ¡èªç¶å°±æ¯ï¼<strong>å¨æ¶é´ç»´åº¦ä¹å¤ï¼åå¼å¥å±çº§ç»´åº¦ã</strong></p>
<p>å¨æ·±å± RNN ä¸­ï¼å¾ªç¯ç»æä¸ååªæä¸å±ï¼èæ¯<strong>å¨åä¸æ¶é´æ­¥ä¸å å å¤å± RNN åå</strong>ã<br>
å®çä¼ æ­å¾æ¯è¿æ ·çï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260113211513339-2004923823.png" alt="image.png" loading="lazy"><br>
å³äºæ·±åº¦çé»è¾åä¹åé½æ¯ç¸åçï¼æ·±å± RNN éè¿å¨åä¸æ¶é´æ­¥ä¸çå å ï¼è®©æ¨¡åå¯ä»¥è¿è¡æ´å¤æçéçº¿æ§åæ¢ï¼<strong>å¢å¼ºäºå¶è¡¨è¾¾è½å</strong>ãä½åæ ·ä¹ä¼å¢å è®¡ç®ææ¬ï¼<strong>å¸¦æ¥æ¢¯åº¦é®é¢ä¸è¿æåé£é©</strong>ï¼è¿äºé½æ¯æä»¬çèçå¸¸è°äºã</p>
<p>äºæ­¤åæ¶ï¼ååå RNN ç±»ä¼¼ï¼<strong>æ·±å±ç»æåæ ·ç¬ç«äºå·ä½çå¾ªç¯ååè®¾è®¡</strong>ã  èä¸å¨å·¥ç¨å®è·µä¸­ï¼<strong>æ·±åº¦ãæ¹åæ§åé¨æ§æºå¶å¾å¾æ¯å¯ä»¥åæ¶å å ç</strong>ï¼ä¾å¦ï¼</p>
<ul>
<li>å¤å± Bi-LSTM</li>
<li>å¤å± Bi-GRU</li>
</ul>
<p>æä»¬æåä¸ªç»ä»¶ç»åæåæ°ï¼ä¾¿å½¢æäºæ·±åº¦å­¦ä¹  NLP ä¸­çº·ç¹å¤æçè¯¸å¤æ¨¡åã</p>
<p>æåï¼å¦æç»§ç»­æ²¿ç¨åé¢çæ¯å»ï¼<br>
<strong>åå RNN</strong> åæ¯ä»æ¡¥çä¸¤ç«¯åæ¶æ½å·¥ã<br>
é£ä¹ <strong>æ·±å± RNN</strong> æ´åæ¯ï¼ æ¯ä¸ä¸ªæ½å·¥ç¹ä¸ï¼ä¸åªæ¯éºä¸å±è·¯é¢ï¼èæ¯<strong>ä¸å±å±æå°åºãå ç»æãåéºè¡¨å±ã</strong> è¿æ ·ç»ææ´ç¨³ãè¡¨è¾¾æ´å¼ºï¼ä½æ½å·¥æµç¨æ´å¤æï¼ææ¬åè®­ç»é¾åº¦ä¹éä¹ä¸åã<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260113211517590-653078512.png" alt="image.png" loading="lazy"></p>
<h1 id="3æ»ç»">3.æ»ç»</h1>
<table>
<thead>
<tr>
<th>æ¦å¿µ</th>
<th>åç</th>
<th>æ¯å»</th>
</tr>
</thead>
<tbody>
<tr>
<td>åå RNNï¼Bidirectional RNNï¼</td>
<td>å¨æ¶é´ç»´åº¦ä¸å¼å¥<strong>æ­£ååååä¸¤æ¡ç¬ç«ç¶æé¾è·¯</strong>ï¼æ¯ä¸ªæ¶é´æ­¥åæ¶å©ç¨è¿å»åæªæ¥ä¸ä¸æä¿¡æ¯ãéç¨äºåºåæ æ³¨ä¸æ´ä½çè§£ä»»å¡ãå¯ä»¥ä¸ RNN/LSTM/GRU ç»åï¼å½¢æ Bi-RNNãBi-LSTMãBi-GRUã</td>
<td>åºåæ¯ä½æ¡¥ï¼ä¸¤éå·¥äººä»ä¸¤ç«¯åæ¶æ½å·¥å¹¶äº¤æµè¿åº¦ï¼ç¡®ä¿ç²¾åï¼ä½æ½å·¥éä¼ç¿»åï¼ææ¬å¢å ã</td>
</tr>
<tr>
<td>æ·±å± RNNï¼Deep RNNï¼</td>
<td>å¨åä¸æ¶é´æ­¥ä¸<strong>å å å¤å± RNN åå</strong>ï¼å¢å æ¯ä¸ªæ¶é´æ­¥åé¨çéçº¿æ§è¡¨è¾¾è½åï¼ä»èå¢å¼ºæ¨¡åçè¡¨ç¤ºè½åãå¯ä¸é¨æ§æºå¶åååç»æå å ï¼å½¢æå¤å± Bi-LSTMãBi-GRU ç­ã</td>
<td>æ¯ä¸ªæ½å·¥ç¹ä¸ä¸æ¯åªéºä¸å±è·¯é¢ï¼èæ¯<strong>ä¸å±å±æå°åºãå ç»æãåéºè¡¨å±</strong>ï¼ç»ææ´ç¨³ãè¡¨è¾¾æ´å¼ºï¼ä½æ½å·¥æµç¨å¤æï¼ææ¬åè®­ç»é¾åº¦å¢å ã</td>
</tr>
</tbody>
</table>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 22:37">2026-01-13 22:37</span>&nbsp;
<a href="https://www.cnblogs.com/Goblinscholar">å¥å¸æå­¦è</a>&nbsp;
éè¯»(<span id="post_view_count">24</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479253);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479253', targetLink: 'https://www.cnblogs.com/Goblinscholar/p/19479253', title: 'å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºï¼èªç¶è¯­è¨å¤ç  ç¬¬ä¸å¨ï¼å¾ªç¯ç¥ç»ç½ç» ï¼ä¸ï¼åå RNN ä¸æ·±å± RNN' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ synchronizedå³é®å­ç¸å³ ]]></title>
    <link>https://www.cnblogs.com/xi-yongqi/p/19479394</link>
    <guid>478f0dee31a30b459b4667c9d97a16b7</guid>
    <description>
    <![CDATA[ 
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xi-yongqi/p/19479394" title="åå¸äº 2026-01-13 22:24">
    <span role="heading" aria-level="2">synchronizedå³é®å­ç¸å³</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h5 id="synchronizedæ¯javaä¸­ç¨äºè§£å³å¹¶åé®é¢çæ ¸å¿å³é®å­å®éè¿ç¡®ä¿å¤ä¸ªçº¿ç¨å¯¹å±äº«èµæºçäºæ¥è®¿é®æ¥é¿åçº¿ç¨å®å¨é®é¢å¦ç«ææ¡ä»¶æ°æ®ä¸ä¸è´ç­">synchronizedæ¯Javaä¸­ç¨äºè§£å³å¹¶åé®é¢çæ ¸å¿å³é®å­ï¼å®éè¿ç¡®ä¿å¤ä¸ªçº¿ç¨å¯¹å±äº«èµæºçäºæ¥è®¿é®ï¼æ¥é¿åçº¿ç¨å®å¨é®é¢ï¼å¦ç«ææ¡ä»¶ãæ°æ®ä¸ä¸è´ç­ï¼ã</h5>
<h4 id="synchronizedçæ ¸å¿ç¹æ§">synchronizedçæ ¸å¿ç¹æ§</h4>
<ul>
<li>åå­æ§ï¼Atomicityï¼ï¼ç¡®ä¿ä¸ä¸ªæå¤ä¸ªæä½è¦ä¹å¨é¨æ§è¡æåï¼è¦ä¹å¨é¨æ§è¡å¤±è´¥ãå¨synchronizedä»£ç åä¸­çä»£ç æ¯ä¸å¯ä¸­æ­çï¼åä¸æ¶å»åªæä¸ä¸ªçº¿ç¨è½æ§è¡ã</li>
<li>å¯è§æ§ï¼Visibilityï¼ï¼ä¿è¯ä¸ä¸ªçº¿ç¨å¯¹å±äº«åéçä¿®æ¹ï¼å¯¹äºå¶ä»åç»­è¿å¥åæ­¥ä»£ç åççº¿ç¨æ¯å¯è§çãå½çº¿ç¨éæ¾éæ¶ï¼ä¼å°ç§æåå­ä¸­çåéå¼å·æ°åä¸»åå­ã</li>
<li>æåºæ§ï¼Orderingï¼ï¼è½ç¶ç¼è¯å¨åå¤çå¨ä¸ºäºä¼åä¼è¿è¡æä»¤éæï¼ä½synchronizedå¯ä»¥ä¿è¯å¤çº¿ç¨ç¨åºå¨é»è¾ä¸çæ§è¡é¡ºåºï¼å³âåæ­¥ååçä»£ç å¨æ§è¡ä¸å·æååé¡ºåºâã</li>
<li>å¯éå¥æ§ï¼å¯éå¥æ§æ¯æä¸ä¸ªçº¿ç¨å·²ç»è·åå°æä¸ªéåï¼åæ¬¡è¯·æ±è¯¥éæ¶å¯ä»¥ç´æ¥è·åï¼æ ééæ°ç«äºãsynchronizedæ¯å¯éå¥éï¼å¶åé¨éè¿è®¡æ°å¨è®°å½éçæææ¬¡æ°ï¼åå§ä¸º0ï¼è·åéæ¶å 1ï¼éæ¾éæ¶å1ï¼è®¡æ°å¨ä¸º0æ¶éæè¢«çæ­£éæ¾ï¼ãè¿ä¸ç¹æ§é¿åäºçº¿ç¨å¨éå½è°ç¨åæ­¥æ¹æ³/ä»£ç åæ¶åºç°æ­»éãä¾å¦ï¼ä¸ä¸ªåæ­¥æ¹æ³Aè°ç¨å¦ä¸ä¸ªåæ­¥æ¹æ³Bï¼ä¸¤èéå¯¹è±¡ç¸åï¼ï¼çº¿ç¨è·åAçéåï¼è°ç¨Bæ¶å¯ç´æ¥è·åéã</li>
</ul>
<h4 id="synchronizedçä½¿ç¨æ¹å¼">synchronizedçä½¿ç¨æ¹å¼</h4>
<h5 id="synchronizedçä½¿ç¨çµæ´»å¯ä¿®é¥°ä¸åçä»£ç ç»ææ ¸å¿æ¯æç¡®éå¯¹è±¡çº¿ç¨ç«äºçæ¯éå¯¹è±¡åªæè·åå°éå¯¹è±¡ççº¿ç¨æè½æ§è¡åæ­¥ä»£ç å¸¸è§ä½¿ç¨æ¹å¼æ3ç§">synchronizedçä½¿ç¨çµæ´»ï¼å¯ä¿®é¥°ä¸åçä»£ç ç»æï¼æ ¸å¿æ¯æç¡®âéå¯¹è±¡âââçº¿ç¨ç«äºçæ¯éå¯¹è±¡ï¼åªæè·åå°éå¯¹è±¡ççº¿ç¨æè½æ§è¡åæ­¥ä»£ç ï¼å¸¸è§ä½¿ç¨æ¹å¼æ3ç§ã</h5>
<ol>
<li>ä¿®é¥°å®ä¾æ¹æ³ï¼å¯¹è±¡éï¼ï¼è¯­æ³ï¼<code>public synchronized void methodName() { ... }</code></li>
</ol>
<ul>
<li>éå¯¹è±¡ï¼å½åç±»çå®ä¾å¯¹è±¡ï¼thisï¼ã</li>
<li>ç¹ç¹ï¼ä¸åå®ä¾å¯¹è±¡çéç¸äºç¬ç«ï¼å³å¤ä¸ªçº¿ç¨è®¿é®åä¸ä¸ªå®ä¾çåæ­¥å®ä¾æ¹æ³æ¶ä¼ç«äºéï¼è®¿é®ä¸åå®ä¾çåæ­¥å®ä¾æ¹æ³æ¶ï¼å éå¯¹è±¡ä¸åï¼ä¸ä¼ç«äºã</li>
<li>ç¤ºä¾ï¼åä¸Userå®ä¾çadd()æ¹æ³è¢«å¤çº¿ç¨è°ç¨æ¶äºæ¥ï¼ä¸åUserå®ä¾çadd()æ¹æ³å¯å¹¶è¡æ§è¡ã</li>
</ul>
<ol start="2">
<li>ä¿®é¥°éææ¹æ³ï¼ç±»éï¼è¯­æ³ï¼<code>public static synchronized void methodName() { ... }</code></li>
</ol>
<ul>
<li>éå¯¹è±¡ï¼å½åç±»çClasså¯¹è±¡ï¼æ¯ä¸ªç±»å¨JVMä¸­åªæä¸ä¸ªClasså¯¹è±¡ï¼æ¯å¨å±å¯ä¸çï¼ã</li>
<li>ç¹ç¹ï¼ç±»éæ¯å¨å±éï¼æ è®ºåå»ºå¤å°ä¸ªç±»çå®ä¾ï¼ææçº¿ç¨è®¿é®è¯¥ç±»çåæ­¥éææ¹æ³æ¶ï¼é½ä¼ç«äºåä¸ä¸ªClasså¯¹è±¡éã</li>
<li>æ³¨æï¼ç±»éä¸å¯¹è±¡éç¸äºç¬ç«ï¼å³åæ­¥éææ¹æ³ååæ­¥å®ä¾æ¹æ³çéå¯¹è±¡ä¸åï¼çº¿ç¨è®¿é®æ¶ä¸ä¼ç«äºã</li>
</ul>
<ol start="3">
<li>ä¿®é¥°ä»£ç åï¼èªå®ä¹éå¯¹è±¡ï¼ï¼è¯­æ³ï¼<code>synchronized (éå¯¹è±¡) { ... åæ­¥ä»£ç  ... }</code></li>
</ol>
<ul>
<li>éå¯¹è±¡ï¼å¯èªå®ä¹ï¼æ¯æä¸¤ç§ç±»åï¼â  å®ä¾å¯¹è±¡ï¼thisæå¶ä»å®ä¾ï¼ï¼â¡ Classå¯¹è±¡ï¼ç±»å.classï¼ã</li>
<li>ç¹ç¹ï¼ç²åº¦æç»ï¼å¯ç²¾åæ§å¶éè¦åæ­¥çä»£ç çæ®µï¼èéæ´ä¸ªæ¹æ³ï¼ï¼åå°éç«äºï¼æé«ç¨åºæ§è½ã</li>
<li>å¸¸è§åºæ¯ï¼
<ul>
<li>éå½åå®ä¾ï¼<code>synchronized (this) { ... }</code>ï¼ææä¸ä¿®é¥°å®ä¾æ¹æ³ä¸è´ï¼ä½ä»åæ­¥ä»£ç ååçé»è¾ã</li>
<li>éClasså¯¹è±¡ï¼<code>synchronized (User.class) { ... }</code>ï¼ææä¸ä¿®é¥°éææ¹æ³ä¸è´ã</li>
<li>éèªå®ä¹å¯¹è±¡ï¼<code>private Object lock = new Object(); synchronized (lock) { ... }</code>ï¼éè¿ç¬ç«çéå¯¹è±¡ï¼é¿åä¸å¶ä»åæ­¥é»è¾ç«äºéï¼çµæ´»æ§æé«ã</li>
</ul>
</li>
</ul>
<h4 id="synchronizedçéæºå¶">synchronizedçéæºå¶</h4>
<ul>
<li>Java 6åä»¥åå¯¹synchronizedè¿è¡äºå¤§å¹ä¼åï¼å¼å¥äºâååéãè½»éçº§éãééçº§éâä¸ç§éç¶æï¼ç®çæ¯æ ¹æ®çº¿ç¨ç«äºçæ¿çç¨åº¦å¨æåæ¢éç¶æï¼å¹³è¡¡æ§è½ä¸çº¿ç¨å®å¨ãéæºå¶çæ ¸å¿æ¯âå¯¹è±¡å¤´âââJavaå¯¹è±¡å¨åå­ä¸­çå¸å±åæ¬å¯¹è±¡å¤´ãå®ä¾æ°æ®ãå¯¹é½å¡«åï¼å¶ä¸­å¯¹è±¡å¤´å­å¨äºéçç¶æä¿¡æ¯ï¼Mark Wordï¼ãç±»åæ°æ®æéç­ã</li>
<li>ä¸ç§éç¶æçä¼åçº§ï¼æ é &lt; ååé &lt; è½»éçº§é &lt; ééçº§éï¼éççº¿ç¨ç«äºçå å§ï¼éä¼ä»ä½çº§å«åé«çº§å«åçº§ï¼ä¸åçº§è¿ç¨ä¸å¯éï¼ä¸æ¦åçº§ä¸ºééçº§éï¼æ æ³åéä¸ºè½»éçº§éæååéï¼ã
<ul>
<li>æ éï¼No Lockï¼ï¼åå§ç¶æã</li>
<li>ååéï¼Biased Lockï¼ï¼å½åªæä¸ä¸ªçº¿ç¨è®¿é®åæ­¥åæ¶ï¼ç´æ¥å¨å¯¹è±¡å¤´è®°å½çº¿ç¨IDï¼ä¸æ¬¡è¯¥çº¿ç¨è¿å¥æ¶æ éCASæä½ï¼æ§è½æé«ã</li>
<li>è½»éçº§éï¼Lightweight Lockï¼ï¼å½åºç°ç«äºï¼ä½ç«äºä¸æ¿çæ¶ï¼éè¿CASèªææ¥å°è¯è·åéï¼é¿åçº¿ç¨é»å¡ã</li>
<li>ééçº§éï¼Heavyweight Lockï¼ï¼å½èªæè¶è¿ä¸å®æ¬¡æ°æç«äºéå¸¸æ¿çæ¶ï¼åçº§ä¸ºééçº§éãæ­¤æ¶æªè·åå°éççº¿ç¨ä¼è¿å¥é»å¡ï¼Blockedï¼ç¶æï¼äº¤ç»æä½ç³»ç»ç®¡çã</li>
</ul>
</li>
</ul>
<h5 id="éä¼åè¡¥å">éä¼åè¡¥å</h5>
<ul>
<li><strong>éæ¶é¤</strong>ï¼JVMçå³æ¶ç¼è¯å¨ï¼JITï¼å¨è¿è¡æ¶ï¼ä¼å¯¹ä¸äºâä¸å¯è½å­å¨ç«äºçéâè¿è¡æ¶é¤ãä¾å¦ï¼å±é¨åéä½ä¸ºéå¯¹è±¡ï¼æ¯ä¸ªçº¿ç¨é½æç¬ç«çå±é¨åéï¼æ å±äº«ï¼ï¼JVMä¼ç´æ¥å é¤è¯¥synchronizedä¿®é¥°ï¼é¿åä¸å¿è¦çéå¼éã</li>
<li><strong>éç²å</strong>ï¼å½å¤ä¸ªè¿ç»­çsynchronizedä»£ç åä½¿ç¨åä¸ä¸ªéå¯¹è±¡æ¶ï¼JVMä¼å°è¿äºä»£ç ååå¹¶ä¸ºä¸ä¸ªå¤§çåæ­¥ä»£ç åï¼åå°éçè·å/éæ¾æ¬¡æ°ï¼æ¯æ¬¡è·å/éæ¾éé½æå¼éï¼ãä¾å¦ï¼å¾ªç¯åå¤æ¬¡è°ç¨åæ­¥æ¹æ³ï¼JVMå¯è½å°éç²åå°å¾ªç¯å¤é¨ã</li>
</ul>
<hr>
<h4 id="cas-compare-and-swapæ¯è¾å¹¶äº¤æ¢-æ¯å¹¶åç¼ç¨ä¸­å®ç°åå­æä½çæ ¸å¿ç®æ³æ¯ä¸ç§ä¹è§éçå®ç°ç­ç¥">CAS (Compare And Swapï¼æ¯è¾å¹¶äº¤æ¢) æ¯å¹¶åç¼ç¨ä¸­å®ç°åå­æä½çæ ¸å¿ç®æ³ï¼æ¯ä¸ç§ä¹è§éçå®ç°ç­ç¥ã</h4>
<ol>
<li>CASçå·¥ä½åçï¼åå«ä¸ä¸ªæ ¸å¿åæ°ï¼</li>
</ol>
<ul>
<li>åå­å°å V (Memory Location)ï¼åéå¨åå­ä¸­çå®éå¼ã</li>
<li>ææå¼ A (Expected Value)ï¼çº¿ç¨è®¤ä¸ºè¯¥åéå½ååºè¯¥æ¯ä»ä¹å¼ã</li>
<li>æ°å¼ B (New Value)ï¼çº¿ç¨æ³è¦æ´æ°æçå¼ã</li>
<li>æ§è¡é»è¾ï¼å½ä¸ä»å½åå­å°å V çå¼ç­äºææå¼ A æ¶ï¼å¤çå¨æä¼å° V çå¼æ´æ°ä¸º Bãå¦åï¼è¯´æè¯¥åéå·²è¢«å¶ä»çº¿ç¨ä¿®æ¹ï¼å½åçº¿ç¨ä»ä¹é½ä¸åï¼éå¸¸ä¼è¿å¥èªæï¼æ­»å¾ªç¯éè¯ï¼ã</li>
</ul>
<ol start="2">
<li>CASçä¼ç¼ºç¹<br>
<strong>ä¼ç¹ï¼</strong></li>
</ol>
<ul>
<li>éé»å¡æ§ï¼CAS æ¯ä¸ç§éé»å¡ç®æ³ï¼Non-blockingï¼ï¼å®ä¸éè¦å synchronized é£æ ·æèµ·åæ¢å¤çº¿ç¨ã</li>
<li>æ§è½é«ï¼å¨ä½ãä¸­åº¦ç«äºçæåµä¸ï¼ç±äºåå°äºçº¿ç¨ä¸ä¸æåæ¢çå¼éï¼æçè¿é«äºééçº§éã<br>
<strong>ç¼ºç¹ï¼</strong></li>
<li>å¾ªç¯æ¶é´é¿ï¼èªæå¼éï¼ï¼å¦æé«å¹¶åä¸ç«äºæ¿çï¼CAS ä¼é¢ç¹å¤±è´¥å¹¶ä¸æ­èªæï¼è¿ä¼ç» CPU å¸¦æ¥å·¨å¤§çè®¡ç®ååã</li>
<li>åªè½ä¿è¯ä¸ä¸ªå±äº«åéçåå­æä½ï¼å¯¹äºå¤ä¸ªåéçæä½ï¼ä»éä½¿ç¨ synchronized æ ReentrantLockã</li>
<li>ABA é®é¢ï¼æç»å¸çç¼ºç¹ï¼ã</li>
</ul>
<ol start="3">
<li>ä»ä¹æ¯ ABA é®é¢ï¼</li>
</ol>
<ul>
<li>å¦æåéåå§å¼ä¸ºAï¼å¨çº¿ç¨1åå¤ä¿®æ¹å®çè¿ç¨ä¸­ï¼çº¿ç¨2å¿«éå°å°å¶æ¹æäºBï¼ç¶ååæ¹åäºAã ç°è±¡ï¼çº¿ç¨1è§å¯å°å¼ä¾ç¶æ¯Aï¼è®¤ä¸ºå®æ²¡åè¿ï¼äºæ¯CASæåã é£é©ï¼è½ç¶æ°å¼æ²¡åï¼ä½åéçç¶æï¼æå¯¹è±¡åé¨çå±æ§ï¼å¯è½å·²ç»åçäºååï¼å¯¼è´é»è¾éè¯¯ã</li>
<li>Javaæä¾äºAtomicStampedReferenceç±»ï¼éè¿å¼å¥çæ¬å·ï¼Stampï¼æ¥è§£å³ï¼ æ¯æ¬¡åéæ´æ°æ¶ï¼ä¸ä»æ´æ°å¼ï¼è¿å¢å ä¸ä¸ªçæ¬å·ãåªæå¼åçæ¬å·é½ä¸è´ï¼CASæä¼æåã</li>
<li>è¿å¯ä»¥è®¾ç½®æ¶é´æ³æ¥è§£å³ã</li>
</ul>
<ol start="4">
<li>CAS å¨Javaä¸­çå®ç°</li>
</ol>
<ul>
<li>å¨Javaä¸­ï¼CASä¸»è¦ç± sun.misc.Unsafe ç±»æä¾æ¯æãè¯¥ç±»ä¸­çæ¹æ³ï¼å¦ compareAndSwapIntï¼æ¯ native çï¼ç´æ¥è°ç¨ç¡¬ä»¶åºå±çæä»¤ã</li>
</ul>
<hr>
<h4 id="reentrantlockå¯éå¥é">ReentrantLockï¼å¯éå¥éï¼</h4>
<ul>
<li>ReentrantLockæ¯ Java java.util.concurrent.locks åä¸çå¯éå¥éå®ç°ï¼åºäº AQSï¼æ½è±¡éååæ­¥å¨ï¼æå»ºï¼æ¯ synchronized ç âå¢å¼ºçâââ æ¢ä¿çäº synchronized çå¯éå¥ç¹æ§ï¼åæä¾äºæ´çµæ´»çåæ­¥æ§å¶è½åã</li>
</ul>
<h5 id="ä¸¤èå¯¹æ¯">ä¸¤èå¯¹æ¯:</h5>
<table>
<thead>
<tr>
<th>ç¹æ§</th>
<th>synchronized</th>
<th>ReentrantLock</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®ç°å±é¢</td>
<td>JVM å±é¢ï¼å³é®å­ï¼ï¼ç± C++ å®ç°</td>
<td>JDK å±é¢ï¼APIï¼ï¼ç± Java ç¼åï¼åºäº AQSï¼</td>
</tr>
<tr>
<td>éçéæ¾</td>
<td>èªå¨éæ¾ï¼ä»£ç æ§è¡å®æå¼å¸¸åï¼</td>
<td>æå¨éæ¾ï¼å¿é¡»å¨ finally ä¸­è°ç¨ unlock()ï¼</td>
</tr>
<tr>
<td>çµæ´»æ§</td>
<td>ä½ï¼ä¸å¯ä¸­æ­ï¼æ è¶æ¶æºå¶ï¼</td>
<td>é«ï¼æ¯æå°è¯è·åãè¶æ¶è·åãå¯ä¸­æ­è·åï¼</td>
</tr>
<tr>
<td>å¬å¹³æ§</td>
<td>åªæ¯æéå¬å¹³é</td>
<td>æ¯æå¬å¹³éä¸éå¬å¹³éï¼é»è®¤éå¬å¹³ï¼</td>
</tr>
<tr>
<td>ç­å¾éå</td>
<td>åªè½å³è 1 ä¸ª ç­å¾éåï¼wait/notifyï¼</td>
<td>å¯ä»¥ç»å® å¤ä¸ª Conditionï¼ç²¾ç»åå¤éï¼</td>
</tr>
</tbody>
</table>
<h5 id="reentrantlockçç¹æé«çº§åè½">ReentrantLockçç¹æé«çº§åè½</h5>
<ol>
<li>ååºä¸­æ­ (lockInterruptibly)</li>
</ol>
<ul>
<li>synchronizedä¸æ¦è¿å¥é»å¡ç­å¾ï¼é¤éæ¿å°éï¼å¦åæ æ³è¢«ä¸­æ­ãèReentrantLockåè®¸çº¿ç¨å¨ç­å¾éçè¿ç¨ä¸­ååºThread.interrupt()ï¼ä»èé¿åæ­»ç­ã</li>
</ul>
<ol start="2">
<li>è¶æ¶æºå¶ (tryLock)</li>
</ol>
<ul>
<li>çº¿ç¨å¯ä»¥å°è¯è·åéï¼å¦æéè¢«å ç¨ï¼ç«å³è¿å false æèç­å¾ä¸æ®µæ¶é´åè¿åï¼èä¸æ¯ä¸ç´é»å¡ãè¿å¨é¢é²æ­»éæ¶éå¸¸æç¨ã</li>
</ul>
<ol start="3">
<li>å¬å¹³é (Fairness)</li>
</ol>
<ul>
<li>å¬å¹³éï¼æç§çº¿ç¨è¯·æ±éçé¡ºåºåéï¼åå°åå¾ã</li>
<li>éå¬å¹³éï¼é»è®¤ï¼ï¼åè®¸âæéâãå¦ææ°æ¥ççº¿ç¨æ­£å¥½ç¢°å°ééæ¾ï¼å®å¯ä»¥ç´æ¥æ¢å ï¼æ§è½éå¸¸æ¯å¬å¹³éé«ã</li>
</ul>
<ol start="4">
<li>å¤ä¸ª Condition å¯¹è±¡</li>
</ol>
<ul>
<li>éè¿lock.newCondition()ï¼ä½ å¯ä»¥åå»ºå¤ä¸ªç­å¾éãä¾å¦å¨é»å¡éåä¸­ï¼å¯ä»¥å®ä¹ notFull å notEmpty ä¸¤ä¸ªæ¡ä»¶ï¼å®ç°æ¯ notifyAll æ´ç²¾åççº¿ç¨å¤éã</li>
</ul>
<h5 id="åºæ¬ä½¿ç¨ç¤ºä¾">åºæ¬ä½¿ç¨ç¤ºä¾ï¼</h5>
<pre><code class="language-java">import java.util.concurrent.locks.ReentrantLock;

public class ReentrantLockDemo {
    // åå»ºéå¬å¹³éï¼é»è®¤ï¼ï¼è¥éå¬å¹³éï¼new ReentrantLock(true)
    private static final ReentrantLock lock = new ReentrantLock();

    public static void doTask() {
        // 1. æ®éè·åéï¼ä¸å¯ä¸­æ­ï¼
        lock.lock();
        try {
            // ä¸´çåºä»£ç ï¼çº¿ç¨å®å¨ï¼
            System.out.println(Thread.currentThread().getName() + " æ§è¡ä»»å¡");
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        } finally {
            // å¿é¡»å¨finallyä¸­éæ¾éï¼å¦åéæ°¸è¿æ æ³éæ¾
            lock.unlock();
        }
    }

    // è¶æ¶è·åéç¤ºä¾
    public static void tryLockWithTimeout() {
        try {
            // å°è¯å¨2ç§åè·åéï¼è·åæåè¿åtrueï¼å¤±è´¥è¿åfalse
            if (lock.tryLock(2, java.util.concurrent.TimeUnit.SECONDS)) {
                try {
                    System.out.println(Thread.currentThread().getName() + " è¶æ¶è·åéæå");
                } finally {
                    lock.unlock();
                }
            } else {
                System.out.println(Thread.currentThread().getName() + " è¶æ¶è·åéå¤±è´¥");
            }
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }

    public static void main(String[] args) {
        // æµè¯æ®éè·åé
        new Thread(ReentrantLockDemo::doTask, "çº¿ç¨1").start();
        new Thread(ReentrantLockDemo::doTask, "çº¿ç¨2").start();
        
        // æµè¯è¶æ¶è·åé
        new Thread(ReentrantLockDemo::tryLockWithTimeout, "çº¿ç¨3").start();
    }
}
</code></pre>

</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 22:24">2026-01-13 22:24</span>&nbsp;
<a href="https://www.cnblogs.com/xi-yongqi">æä¼æ¿é£å»</a>&nbsp;
éè¯»(<span id="post_view_count">26</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479394);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479394', targetLink: 'https://www.cnblogs.com/xi-yongqi/p/19479394', title: 'synchronizedå³é®å­ç¸å³' })">ä¸¾æ¥</a>
</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Spring IOC æºç å­¦ä¹  ä¸æå­¦ä¹ å®æ´çå è½½æµç¨ ]]></title>
    <link>https://www.cnblogs.com/dddy/p/19479364</link>
    <guid>e7fbb96de3c88cf71a86c8f462dbbb02</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/dddy/p/19479364" title="åå¸äº 2026-01-13 22:09">
    <span role="heading" aria-level="2">Spring IOC æºç å­¦ä¹  ä¸æå­¦ä¹ å®æ´çå è½½æµç¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ioc-çå¥å£è¯´æ">IOC çå¥å£è¯´æ</h1>
<h2 id="applicationcontext-å¯¹è±¡">ApplicationContext å¯¹è±¡</h2>
<p><strong>in short å¯ä»¥çè§£ä¸ºä½ä¸ºå·ç°åç IOC çå¯¹è±¡æ ¹æ¥å£, å®æ¯ä¸ä¸ªééçº§çå¯¹è±¡, æ´ä¸ªåºç¨æé´åºè¯¥ä¿æåä¾</strong></p>
<p>å®æ Container Overview: <a href="https://docs.spring.io/spring-framework/reference/core/beans/basics.html" target="_blank" rel="noopener nofollow">https://docs.spring.io/spring-framework/reference/core/beans/basics.html</a></p>
<blockquote>
<p>The&nbsp;<code>org.springframework.context.ApplicationContext</code>&nbsp;interface represents the Spring IoC container and is responsible for instantiating, configuring, and assembling the beans. The container gets its instructions on the components to instantiate, configure, and assemble by reading configuration metadata. The configuration metadata can be represented as annotated component classes, configuration classes with factory methods, or external XML files or Groovy scripts.</p>
</blockquote>
<blockquote>
<p><code>org.springframework.context.ApplicationContext</code>&nbsp;æ¥å£ä»£è¡¨ Spring IoC å®¹å¨ï¼è´è´£å®ä¾åãéç½®åç»è£ beanãå®¹å¨éè¿è¯»åéç½®åæ°æ®æ¥è·åå®ä¾åãéç½®åç»è£ç»ä»¶çæä»¤ãéç½®åæ°æ®å¯ä»¥è¡¨ç¤ºä¸ºå¸¦æ³¨è§£çç»ä»¶ç±»ãå·æå·¥åæ¹æ³çéç½®ç±»ï¼æå¤é¨ XML æä»¶æ Groovy èæ¬ã</p>
</blockquote>
<p>Several implementations of the&nbsp;<code>ApplicationContext</code>&nbsp;interface are part of core Spring. In stand-alone applications, it is common to create an instance of&nbsp;<a href="https://docs.spring.io/spring-framework/docs/7.0.1/javadoc-api/org/springframework/context/annotation/AnnotationConfigApplicationContext.html" target="_blank" rel="noopener nofollow"><code>AnnotationConfigApplicationContext</code></a>&nbsp;or&nbsp;<a href="https://docs.spring.io/spring-framework/docs/7.0.1/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html" target="_blank" rel="noopener nofollow"><code>ClassPathXmlApplicationContext</code></a>.</p>
<blockquote>
<p><code>ApplicationContext</code>&nbsp;æ¥å£æå¤ä¸ªå®ç° , æ¯Spring æ ¸å¿çä¸é¨åãå¨ç¬ç«åºç¨ç¨åºä¸­ï¼éå¸¸åå»º&nbsp;<a href="https://docs.spring.io/spring-framework/docs/7.0.1/javadoc-api/org/springframework/context/annotation/AnnotationConfigApplicationContext.html" target="_blank" rel="noopener nofollow"><code>AnnotationConfigApplicationContext</code></a>&nbsp;or&nbsp;<a href="https://docs.spring.io/spring-framework/docs/7.0.1/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html" target="_blank" rel="noopener nofollow"><code>ClassPathXmlApplicationContext</code></a>&nbsp;çå®ä¾ã</p>
</blockquote>
<h2 id="xmlåæ³¨è§£-éç½®ç-applicationcontext">XMLåæ³¨è§£ éç½®ç ApplicationContext</h2>
<p>æä»¬éå¸¸ä½¿ç¨ Spring IOC éç½®å®¹å¨çæ¹å¼ä¸è¬æä¸¤ç§: 1. éè¿XMLéç½®æä»¶,  2. åºäºæ³¨è§£çå½¢å¼éç½®, å®ä»¬åå«æ¯å¥å£ç±»ä¸ä¸æ ·.</p>
<ol>
<li>
<p>åºäºXMLéç½®, å®éæä¸¤ä¸ªç±»å®ç°  <strong>ClassPathXmlApplicationContext</strong> è¿æä¸ä¸ªæ¯ <strong>FileSystemXmlApplicationContext</strong> <s>(å¾å°ç¨å°±æ¯äº)</s> å®ä»¬ä¸»è¦çä»£ç é»è¾é½æ¯å¨å®ç¶ <code>AbstractXmlApplicationContext</code> ä¸­.</p>
</li>
<li>
<p>åºäºæ³¨è§£çå½¢å¼éç½®,  <a href="https://docs.spring.io/spring-framework/reference/core/beans/annotation-config.html" target="_blank" rel="noopener nofollow">Annotation-based configuration</a>  åºäº Spring èªå®ä¹, ä½¿ç¨<a href="https://docs.spring.io/spring-framework/reference/core/beans/factory-extension.html#beans-factory-extension-bpp-examples-aabpp" target="_blank" rel="noopener nofollow"><code>AutowiredAnnotationBeanPostProcessor</code></a> å¤çè§£æç¸å³æ³¨è§£çå®ç°, å¦å¤ JSR 330 ä¸­æ åçæ³¨è§£ä¹æ¯å®å¤çç.</p>
</li>
</ol>
<p>æ¬åæä»¥ XML å è½½ä½ä¸ºæºç å¥å£ç¹è¿è¡åæ:</p>
<h1 id="ä¸æ±æ»å¤§å¾">ä¸æ±æ»å¤§å¾</h1>
<p>ççå¾å¤§çå¤§å¾..</p>
<p><img alt="Spring IOC å®¹å¨å è½½çè¯¦ç»æµç¨" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3723410/202601/3723410-20260113220603061-1916535706.jpg" class="lazyload"></p>
<p>çä¸æ¸, è¯·ä½¿ç¨åçæµè§å¨æå¼é¾æ¥: <a href="https://img2024.cnblogs.com/blog/3723410/202601/3723410-20260113220603061-1916535706.jpg" target="_blank">https://img2024.cnblogs.com/blog/3723410/202601/3723410-20260113220603061-1916535706.jpg</a></p>
<h1 id="xml-å®ä¾å¥å£">XML å®ä¾å¥å£</h1>
<h2 id="å®ä¾ä»£ç ">å®ä¾ä»£ç </h2>
<p><code>org.yang.learn.spring.dto.Address</code></p>
<pre><code class="language-java">package org.yang.learn.spring.dto;

import org.springframework.beans.BeansException;
import org.springframework.beans.factory.config.BeanPostProcessor;

/**
 * @author yangfh
 * @date 2023-12-14 21:30
 **/
public class Address  {
	String city;
	String country;
	String street;

	public Address() {
		System.out.println("Address æ åæé å½æ°: "+ this.toString());
	}

	public Address(String city, String country, String street) {
		this.city = city;
		this.country = country;
		this.street = street;
		System.out.println("Address æé å½æ°: "+ this.toString());
	}
	... getter  setter ...
}

</code></pre>
<p><code>org.yang.learn.spring.dto.User</code></p>
<pre><code class="language-java">package org.yang.learn.spring.dto;

import org.springframework.beans.BeansException;
import org.springframework.beans.factory.DisposableBean;
import org.springframework.beans.factory.InitializingBean;
import org.springframework.beans.factory.config.BeanFactoryPostProcessor;
import org.springframework.beans.factory.config.BeanPostProcessor;
import org.springframework.core.PriorityOrdered;
import org.springframework.lang.Nullable;

/**
 * @author yangfh
 * @date 2023-12-14 21:30
 **/
public class User implements InitializingBean, DisposableBean {
	private Long id;
	private String username;
	private String email;
	private Address address;
	private Long age;

	public User() {
		System.out.println("User æ åæé å½æ°: "+ this.toString());
	}

	public User(Long id, String username, String email, Address address) {
		this.id = id;
		this.username = username;
		this.email = email;
		this.address = address;
		System.out.println("User æåæé å½æ°: "+ this.toString());
	}

	public void initMethod(){
		System.out.println("User initMethod");
	}

	public void destroyMethod(){
		System.out.println("User destroyMethod");
	}

	@Override
	public void afterPropertiesSet() throws Exception {
		System.out.println("User afterPropertiesSet");
	}

	@Override
	public void destroy() throws Exception {
		System.out.println("User destroy");
	}
	
	
	... getter  setter ...
}
</code></pre>
<p><code>org.yang.learn.spring.dto.UserServiceImpl</code></p>
<pre><code class="language-java">public class UserServiceImpl implements BeanPostProcessor, BeanFactoryPostProcessor, ApplicationContextAware {
	public UserServiceImpl(){
		System.out.println("UserServiceImpl æ åæé ");
	}

	@Override
	public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
		System.out.println("UserServiceImpl postProcessBeforeInitialization å¢å¼ºå¤ç ["+beanName+"]");
		return BeanPostProcessor.super.postProcessBeforeInitialization(bean, beanName);
	}

	@Override
	public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
		System.out.println("UserServiceImpl postProcessAfterInitialization å¢å¼ºå¤ç ["+beanName+"]");
		return BeanPostProcessor.super.postProcessAfterInitialization(bean, beanName);
	}

	@Override
	public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {
		System.out.println("UserServiceImpl postProcessBeanFactory beanFactory å¢å¼ºå¤ç ["+beanFactory+"]");
	}

	@Override
	public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
		System.out.println("UserServiceImpl setApplicationContext ");
	}
}
</code></pre>
<p><code>application.xml</code></p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:aop="http://www.springframework.org/schema/cache"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
		https://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context
		https://www.springframework.org/schema/context/spring-context.xsd
		http://www.springframework.org/schema/cache
		http://www.springframework.org/schema/cache/spring-cache.xsd"&gt;

	&lt;bean id="address" class="org.yang.learn.spring.dto.Address" &gt;
		&lt;constructor-arg value="æ·±å³"/&gt;
		&lt;constructor-arg value="ç½æ¹"/&gt;
		&lt;constructor-arg value="xxxè¡é101å·"/&gt;
	&lt;/bean&gt;
	&lt;bean id="user" class="org.yang.learn.spring.dto.User" init-method="initMethod" destroy-method="destroyMethod" &gt;
		&lt;property name="username" value="å¼ ä¸"&gt;&lt;/property&gt;
		&lt;property name="age" value="9764534"&gt;&lt;/property&gt;
	&lt;/bean&gt;
	&lt;bean id="userService" class="org.yang.learn.spring.dto.UserServiceImpl" &gt;
	&lt;/bean&gt;

&lt;/beans&gt;


</code></pre>
<pre><code class="language-java">public static void main(String[] args) throws Exception {
	System.out.println("===========================å®¹å¨å¯å¨===============================\n");
	ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext("application.xml");
	System.out.println("\n==========================å®¹å¨å®æ================================");
	User user = context.getBean("user", User.class);
	System.out.println("è·åå®¹å¨çuser Bean: "+user);
	context.close();
}
</code></pre>
<h2 id="å®¹å¨çåå»º-classpathxmlapplicationcontext">å®¹å¨çåå»º (ClassPathXmlApplicationContext)</h2>
<p><code>org.springframework.context.support.ClassPathXmlApplicationContext#ClassPathXmlApplicationContext(java.lang.String)</code><br>
<code>org.springframework.context.support.ClassPathXmlApplicationContext#ClassPathXmlApplicationContext(java.lang.String[], boolean, org.springframework.context.ApplicationContext)</code></p>
<pre><code class="language-java">/**
 * Create a new ClassPathXmlApplicationContext with the given parent,
 * loading the definitions from the given XML files.
 * @param configLocations array of resource locations
 * @param refresh whether to automatically refresh the context,
 * loading all bean definitions and creating all singletons.
 * Alternatively, call refresh manually after further configuring the context.
 * @param parent the parent context
 * @throws BeansException if context creation failed
 * @see #refresh()
 */
public ClassPathXmlApplicationContext(
		String[] configLocations, boolean refresh, @Nullable ApplicationContext parent)
		throws BeansException {
	/**
	 * è°ç¨ç¶ç±»æé , åå§äºä¸äºå¯¹è±¡åå­æ®µå±æ§, ä¾å¦:
	 *  1. å½å context çå±æ§åå§å:
	 *   - å­å¨BeanFactoryPostProcessor(BFPP)çéå  {@link org.springframework.context.support.AbstractApplicationContext#beanFactoryPostProcessors}
	 *	 - id å®¹å¨ID, displayName å®¹å¨åç§°,  closed, active å®¹å¨å³é­å¯å¨ æ´»å¨ç AtomicBooleanæ è¯ç¬¦ ; {@link org.springframework.context.support.AbstractApplicationContext#id}
	 *   - startupShutdownMonitor å®¹å¨éå¯¹è±¡, å¨å®¹å¨'å·æ°'å'éæ¯'æ¶éè¦éä½(åæ­¥)ç {@link AbstractApplicationContext#startupShutdownMonitor}
	 *    shutdownHook; JVM ç HOOK {@link AbstractApplicationContext#shutdownHook}
	 *
	 *  2. å¦ææç¶å®¹å¨,åè®¾ç½®ç¶å®¹å¨,è¿ä¼åå¹¶éç½®;
	 *  {@link org.springframework.context.support.AbstractApplicationContext#setParent(org.springframework.context.ApplicationContext)}
	 *
	 *  3. åå»ºæ¯æanté£æ ¼è§£æçèµæºè§£æå¨,æ¯æééç¬¦çç±»ä¼¼`"classpath*:applicationContext-*.xml"` è¿ç§, è§£æå®¹å¨æéè¦ç xml, yml, properties ç­éç½®æä»¶; `spring.profiles.active` çåé ä¹æ¯ç±è¿ä¸ªè§£æå¨è¿è¡å¤ç
	 * 	è§£æå®¹å¨æéè¦ç xml, yml, properties ç­éç½®æä»¶;  {@link AbstractApplicationContext#AbstractApplicationContext()}
	 */
	super(parent);
	/**
	 * è§£æè·¯å¾, è·¯å¾ä¸­æ¯æè¡¨è¾¾å¼çåé, ä¾å¦: æä»¶å application-${env}.xml ç¯å¢å¯¹è±¡éé¢æenvåéä¼æ¿æ¢ä¹
	 */
	setConfigLocations(configLocations);
	if (refresh) {
		refresh();
	}
}
</code></pre>
<h3 id="æ»ç»">æ»ç»</h3>
<p>è°ç¨ç¶ç±»æé , åå§äºä¸äºå¯¹è±¡åå­æ®µå±æ§, ä¾å¦:</p>
<ol>
<li>å½å context çå±æ§åå§å:</li>
</ol>
<ul>
<li>å­å¨ BeanFactoryPostProcessor(BFPP) çéå </li>
<li>id å®¹å¨ID, displayName å®¹å¨åç§°,  closed, active å®¹å¨å³é­å¯å¨ æ´»å¨ç AtomicBooleanæ è¯ç¬¦ ;</li>
<li><code>startupShutdownMonitor</code> å®¹å¨éå¯¹è±¡, å¨å®¹å¨'å·æ°'å'éæ¯'æ¶éè¦éä½(åæ­¥)ç</li>
<li>shutdownHook; JVM ç HOOK</li>
</ul>
<ol start="2">
<li>å¦ææç¶å®¹å¨,åè®¾ç½®ç¶å®¹å¨,è¿ä¼åå¹¶éç½®;</li>
</ol>
<ul>
<li></li>
</ul>
<ol start="3">
<li>åå»ºæ¯æanté£æ ¼è§£æçèµæºè§£æå¨,æ¯æééç¬¦çç±»ä¼¼<code>"classpath*:applicationContext-*.xml"</code> è¿ç§, è§£æå®¹å¨æéè¦ç xml, yml, properties ç­éç½®æä»¶; <code>spring.profiles.active</code> çåé ä¹æ¯ç±è¿ä¸ªè§£æå¨è¿è¡å¤ç<br>
è§£æå®¹å¨æéè¦ç xml, yml, properties ç­éç½®æä»¶; </li>
</ol>
<h2 id="refresh-æ¹æ³">refresh() æ¹æ³</h2>
<p>è¿ä¸ªæ¯éç¹æ¹æ³,  å ä¹æ´ä¸ªçå½å¨æçä»£ç , é½å¯ä»¥å¨è¿ä¸ªæ¹æ³åæ¾å°, æä»¥ä»£ç æ­ç¹ ä¹¦ç­¾ è°è¯, é½ç»å®å¹²ä¸..</p>
<p><code>org.springframework.context.support.AbstractApplicationContext#refresh</code></p>
<pre><code class="language-java">
	@Override
	public void refresh() throws BeansException, IllegalStateException {
		// å®¹å¨å·æ°, æ§è¡æ¶, éè¦éä½
		synchronized (this.startupShutdownMonitor) {
			//è®°å½å®¹å¨ å¯å¨æ¶é´, æ­¥éª¤ ç¨äºåææ§è½ç (ä¸éè¦)
			StartupStep contextRefresh = this.applicationStartup.start("spring.context.refresh");

			// Prepare this context for refreshing.
			/**
			 * ä¸, (ApplicationContext)çé¢åå¤å·¥ä½;
			 * å®¹å¨å·æ°åçåå¤å·¥ä½
			 * 1. è®¾ç½®å®¹å¨çä¸äºç¶ææ å¿ç¬¦;è®¾ç½®å¯å¨æ¶é´, æ´»å¨æ å¿ç¬¦; {@link AbstractApplicationContext#prepareRefresh()}
			 * 2. è·åæèåå»º Environment å¯¹è±¡; å è½½ System.getProperties(); {@see AbstractApplicationContext#environment}
			 * 3. éªè¯ç¯å¢æ¯å¦åå«æéç½®; æå¨æ·»å éç½®. {@link AbstractApplicationContext#initPropertySources()}
			 * 4. åå¤å­å¨ äºä»¶çå¬å¨ å äºä»¶ çéåå®¹å¨, é»è®¤ä¸ºç©º {@link AbstractApplicationContext#prepareRefresh()};
			 */
			prepareRefresh();

			// Tell the subclass to refresh the internal bean factory.
			/**
			 * äº, åå»º BeanFactory;
			 * 1. éæ¯ä¹åç beanFactory (å¦ææçè¯) {@link AbstractRefreshableApplicationContext#refreshBeanFactory()}
			 * 2. å®ä¾å/åå»º beanFactory, è¿éæ¯å®ä¾ç±»æ¯ `DefaultListableBeanFactory` {@link org.springframework.context.support.AbstractRefreshableApplicationContext#createBeanFactory}
			 * 3. è®¾ç½® beanFactory å¿½ç¥  BeanNameAware, BeanClassLoaderAware, BeanFactoryAwareè¿ä¸ä¸ªAwareçæ¥å£ {@link AbstractAutowireCapableBeanFactory#AbstractAutowireCapableBeanFactory()}
			 * 		å ä¸ºå¨åå§åBeanæ¶, ä¼ç´æ¥è°ç¨å®ä»¬(èä¸æ¯éè¿éè¿ BeanPostProcessoræ©å±çAwareæºå¶è°ç¨) {@link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#initializeBean(java.lang.String, java.lang.Object, org.springframework.beans.factory.support.RootBeanDefinition)}
			 * 4. è®¾ç½® beanFactory åºååID, åç§° {@link AbstractRefreshableApplicationContext#refreshBeanFactory()}
			 * 5. æ©å±ç¹, å®å¶åè¿ä¸ª BeanFactory ä¾å¦: æ¯å¦åè®¸ BeanDefinition è¦ç; æ¯å¦èªå¨å¤çå¾ªç¯ä¾èµ;
			 * 6. åå»º(XMLè§£æå¨/è¯»åå¨) XmlBeanDefinitionReader, å¹¶åå§å; çä¸æ©å±ç¹, æ©å±Reader ä¾å¦ æ¯å¦éªè¯xmlç­ {@link AbstractXmlApplicationContext#loadBeanDefinitions(DefaultListableBeanFactory)}
			 * 7. åå»ºç¸å³å¯¹è±¡DocumentLoader, BeanDefinitionDocumentReader,BeanDefinitionParserDelegate {@link org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions(org.w3c.dom.Document, org.springframework.core.io.Resource)}
			 * 		{@link DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions(Element)}
			 *    å è½½/è§£æ XMLæ ç­¾/åç´ /å±æ§ç­å°å¶å°è£ä¸º ä¸ä¸ªä¸ª BeanDefinition å¯¹è±¡
			 * 8. å° BeanDefinitions æ³¨åå° registry {@link BeanDefinitionReaderUtils#registerBeanDefinition(BeanDefinitionHolder, BeanDefinitionRegistry)}
			 */
			ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();

			/**
			 * ä¸,(BeanFactory)é¢åå¤å·¥ä½;
			 * {@link AbstractApplicationContext#prepareBeanFactory(ConfigurableListableBeanFactory)}
			 * 1. ä¸º beanFactory è®¾ç½® bean çç±»å è½½å¨ {@link ConfigurableBeanFactory#setBeanClassLoader(ClassLoader)}
			 * 2. ä¸º beanFactory è®¾ç½® bean ç StandardBeanExpressionResolver (è¡¨è¾¾å¼(Spring EL)è§£æå¨) {@link ConfigurableBeanFactory#setBeanExpressionResolver(BeanExpressionResolver)}
			 *   å³äº (Spring EL)è§£æå¨: StandardBeanExpressionResolver çè®¾è®¡æ¯ç»åä¼äºç»§æ¿, åé¨æä¸¤ä¸ª SpelExpressionParser(çæ­£è§£æç) SpelParserConfiguration(éç½®ç±»)
			 * 3. ä¸º beanFactory è®¾ç½® PropertyEditorRegistrar (ä¸»è¦ä¸º Bean è®¾ç½®å±æ§çç®¡çç±»){@link ConfigurableBeanFactory#addPropertyEditorRegistrar(PropertyEditorRegistrar)}
			 * 		 *  PropertyEditorRegistrar è¿ä¸ªä¸»è¦ä¸º Bean è®¾ç½®å±æ§çç®¡çç±», æ¯å¦, æ¥æç±»åçæ°æ®: å¯ä»¥æ¯ç¹å®æ ¼å¼çå­ç¬¦ä¸², æ°å­, è¿å¯ä»¥æ¯æ¶é´æ³...
			 * 		 *  Spring ä¸º bean å¡«åå±æ§, ä½¿ç¨ BeanWrapperImpl åè£äºä¸ä¸(è£é¥°æ¨¡å¼)
			 * 		 *  BeanWrapperImpl å®ç°äº PropertyEditorRegistry, å¯ä»¥å¾éé¢æ³¨å PropertyEditor, å¯ä»¥èªå®ä¹å±æ§çè½¬æ¢, ç¼è¾é»è¾
			 * 4. ç» beanFactory æ·»å ä¸ä¸ª å¤çAwareç BeanPostProcessor (ApplicationContextAwareProcessor) å¹¶å¿½ç¥æè¿7ä¸ªæ¥å£çèªå¨æ³¨å¥:{@link ConfigurableBeanFactory#addBeanPostProcessor(BeanPostProcessor)}
			 * 		EnvironmentAware.class, EmbeddedValueResolverAware.class, ResourceLoaderAware.class, ApplicationEventPublisherAware.class, MessageSourceAware.class, ApplicationContextAware.class, ApplicationStartupAware.class
			 * 5. æå®åç½®ç BeanFactory,ResourceLoader,ApplicationEventPublisher,ApplicationContext {@link ConfigurableListableBeanFactory#registerResolvableDependency(Class, Object)}
			 * 		è¿å ä¸ªBeanå¯¹è±¡,  èªå¨æ³¨å¥ç Primary
			 * 6. ç» beanFactory æ·»å ä¸ä¸ª BeanPostProcessor (ApplicationListenerDetector)TODO (äºä»¶çå¬ç¸å³)
			 * 7. ç» beanFactory æ·»å ä¸ä¸ª BeanPostProcessor(LoadTimeWeaverAwareProcessor) TODO (AOP AspectJ ç»å¥å¤çç¸å³ç)
			 * 8. beanFactoryä¸­å¦ææ²¡æä»¥ä¸åç§°ç bean, åç´æ¥ç» BeanFactory çä¸çº§ç¼å­, æ³¨åå ä¸ªç¯å¢å¯¹è±¡ Bean {@link SingletonBeanRegistry#registerSingleton(String, Object)}
			 *  åç§°å¸¸éåå«æ¯:
			 *  org.springframework.context.ConfigurableApplicationContext#ENVIRONMENT_BEAN_NAME
			 *  org.springframework.context.ConfigurableApplicationContext#SYSTEM_PROPERTIES_BEAN_NAME
			 *  org.springframework.context.ConfigurableApplicationContext#SYSTEM_ENVIRONMENT_BEAN_NAME
			 *  org.springframework.context.ConfigurableApplicationContext#APPLICATION_STARTUP_BEAN_NAME
			 *
			 */
			// Prepare the bean factory for use in this context.
			prepareBeanFactory(beanFactory);

			try {
				// Allows post-processing of the bean factory in context subclasses.
				/**
				 * å, beanFactory å·²ç»åå¤å¥½äº, è®¾è®¡ç®çæ¯ç»(Context)å­ç±»é¢çä¸ä¸ªæ©å±ç¹, å¨æ­¤æ¶è¿éææç Bean å·²ç»è¢«æ³¨åäº, å°æªå®ä¾åä»»ä½bean;
				 * BeanPostProcessors
				 * (è¿éæ¯ç©ºå®ç°)
				 */
				postProcessBeanFactory(beanFactory);

				StartupStep beanPostProcess = this.applicationStartup.start("spring.context.beans.post-process");

				// Invoke factory processors registered as beans in the context.
				/**
				 * äº, è°ç¨ BeanFactoryPostProcessor å BeanDefinitionRegistryPostProcessor
				 * è¥æ¯æ³¨åçbean definition å®ç°äºè¿ä¸¤ä¸ªæ¥å£, åä¼è°ç¨(getBean)å®ä¾åå®, åè°ç¨ç¸åºçæ¥å£æ¹æ³;
				 * (æ³¨æä¸ä¸ BeanDefinitionRegistryPostProcessor æ¯ç»§æ¿èª BeanFactoryPostProcessorç)
				 * æ»çæ¥è¯´ è°ç¨çä¼åçº§æ¯:
				 * 1. è°ç¨æ¥å£çä¼åçº§:
				 *    1. ä¼åè°ç¨(å­ç±») BeanDefinitionRegistryPostProcessor
				 *    2. åè°ç¨(ç¶ç±») BeanFactoryPostProcessor
				 * 2. è°ç¨æ·»å çæ¹å¼çä¼åçº§:
				 *    1. ä¼åè°ç¨å¤é¨å¥å, å³ç´æ¥éè¿{@link AbstractApplicationContext#addBeanFactoryPostProcessor(org.springframework.beans.factory.config.BeanFactoryPostProcessor)} ä»£ç æ·»å ç
				 *    2. åè°ç¨å®¹å¨ä¸­å®ç° BeanFactoryPostProcessor æè BeanDefinitionRegistryPostProcessor ç Bean
				 * è§: {@link org.springframework.context.support.PostProcessorRegistrationDelegate#invokeBeanFactoryPostProcessors(org.springframework.beans.factory.config.ConfigurableListableBeanFactory, java.util.List)}
				 *
				 * å¼å¾ä¸æçæ¯:  Spring å¯¹äºæ¯æ SPELè¡¨è¾¾å¼, å°±æ¯éè¿ `PropertySourcesPlaceholderConfigurer` è¿ç§æ¹å¼æ©å±å®ç°ç
				 * {@link org.springframework.context.support.PropertySourcesPlaceholderConfigurer}
				 */
				invokeBeanFactoryPostProcessors(beanFactory);

				// Register bean processors that intercept bean creation.
				/**
				 *  å­, æ³¨å BeanPostProcessor (BPP)å¤çå¨;
				 *
				 *  1. æ¿å°ææ BeanPostProcessor ç±»åç bean
				 *  2. å®ä¾å BeanPostProcessor
				 *  	ä¼åå®ä¾å å®ç°äº PriorityOrdered æ¥å£ç, å¨å®ä¾åå¶å®ç(BPP)
				 *  3. è¿è¡åç±»å­å°éå {@link PostProcessorRegistrationDelegate#registerBeanPostProcessors(ConfigurableListableBeanFactory, AbstractApplicationContext)}
				 *   	* å¯¹ BeanPostProcessor è¿è¡åç±»å­èµ·æ¥,  åè°ç¨, æ¯ä¸ªéååå«æ¯
				 * 		 * 1. priorityOrderedPostProcessors //æå®ç°(PriorityOrdered)æåºæ¥å£ç
				 * 		 * 2. internalPostProcessors //Springåé¨çbean, è§: Springå°beanåä¸ºä¸ç§è§è²
				 * 		 * 3. orderedPostProcessorNames //å®ç° Ordered æ¥å£
				 * 		 * 4. nonOrderedPostProcessorNames //æ²¡ææå®é¡ºåº, æ åºç
				 *  è¿æä¸ç¹, Spring å¯¹ BeanDefinition åæä¸ç§è§è²:
				 *  	1. ç¨æ·å®ä¹ç ä¸å¡ç¸å³ç Bean Bean (ROLE_APPLICATION)
				 *      2. è¾å¤æç (ROLE_SUPPORT) è¾å¤æç, æ¯æ AOPãäºå¡ç­åè½çåé¨å®ç°?  (ä¸éè¦, ä¸è¦æ¯ä¸ä¸ªç»èé½æ£...)
				 *      3. Spring åç½®ç(ROLE_INFRASTRUCTURE)
				 *
				 *  4. æåºå¹¶æ³¨åå° beanFactory
				 *    	1. è¿éæå®ç°(PriorityOrdered)æåºæ¥å£çã@Orderedæ³¨è§£ç ç­æåºå­èµ·æ¥. å®éè°ç¨çé¡ºåº å¶å®å°±æ¯å­èµ·æ¥çé¡ºåº
				 *      2. å¦å¤ BeanPostProcessor æ¥å£ç²ç²åº¦å¤ªå¤§äº, Spring è¿ç»åä¸äºå­æ¥å£:
				 *         1. SmartInstantiationAwareBeanPostProcessor å®æä¾äºæ´é«çº§çBeanå®ä¾åæ§å¶æ¹æ³ãä¸»è¦ä½ç¨å¨äºåè®¸å¯¹Beançå®ä¾åè¿ç¨è¿è¡æ´ç²¾ç»çæ§å¶åå®å¶ã
				 *         2. MergedBeanDefinitionPostProcessor å¨åå¹¶Beanå®ä¹ï¼MergedBeanDefinitionï¼ä¹åä½å¨å®ä¾åBeanä¹åï¼åè®¸å¯¹åå¹¶åçBeanå®ä¹è¿è¡ä¿®æ¹ãè°æ´æéå åæ°æ®ã
				 *         3. DestructionAwareBeanPostProcessor å®åè®¸å¨Beanè¢«éæ¯ä¹åï¼ä¾å¦ï¼å®¹å¨å³é­æç¹å®ä½ç¨åçBeanéæ¯ï¼æ§è¡ä¸äºæä½ã
				 *         ç­ç­ä»¥ä¸ä¹ä¼å­èµ·æ¥
				 *      3. æç»è°ç¨ BPPæ¯å¨ {@link AbstractApplicationContext#finishBeanFactoryInitialization(ConfigurableListableBeanFactory)} å®ä¾åå§åå¶ä»Beanè°ç¨
				 */
				registerBeanPostProcessors(beanFactory);

				beanPostProcess.end();

				// Initialize message source for this context.
				/**
				 * ä¸, åå§åå½éå(I18N) ä¿¡æ¯æº;
				 * éé¢å¾ç®å:
				 * 1. å¦æbeanFactoryä¸­æåç§°ä¸º messageSource çBeanå®ä¹ ï¼å°±ä½¿ç¨è¿beanä½ç©å½éåæ¶æ¯æº
				 * å¦ææ²¡æåé»è®¤ä½¿ç¨ org.springframework.context.support.DelegatingMessageSource å¹¶æ³¨åå° beanFactory
				 */
				initMessageSource();

				// Initialize event multicaster for this context.
				/**
				 * å«, åå§åäºä»¶å¤æ­å¨;
				 * 1. å¦æ beanFactory ä¸­åå«åç§°ä¸º applicationEventMulticaster çbeanå®ä¹, åä½¿ç¨è¿ä¸ªBeanä½ä¸ºäºä»¶å¤æ­å¨;
				 *   å¦æä¸åå«ååå»º SimpleApplicationEventMulticasterä½ä¸ºäºä»¶å¤æ­å¨;
				 * 2.åå»ºSimpleApplicationEventMulticasterå¶å®å°±æ¯åå§åäºä¸ä¸ª,ç¨äºå­æ¾/ç®¡ç ApplicationListener çå¬å¨(è§å¯è)çç±», å¹¶æ³¨åå° beanFactory
				 * 	ä¸»è¦æ¯ {@link org.springframework.context.event.AbstractApplicationEventMulticaster#defaultRetriever} ç¨äºå­æ¾/ç®¡ç åä¸ªçå¬å¨ç(è§å¯è)
				 *  {@link org.springframework.context.event.SimpleApplicationEventMulticaster#multicastEvent(org.springframework.context.ApplicationEvent, org.springframework.core.ResolvableType) }è°ç¨å®¹å¨åå¸äºä»¶
				 */
				initApplicationEventMulticaster();

				// Initialize other special beans in specific context subclasses.
				/**
				 * ä¹, ç»å­ç±»(Context)çä¸ä¸ä¸ªæ©å±ç¹
				 * æ²¡ä»ä¹å¥½è¯´ç, è¿éæ¯ç©ºå®ç°
				 */
				onRefresh();

				// Check for listener beans and register them.
				/**
				 * å, åå¤æ­å¨æ³¨åçå¬å¨;
				 * 1. åå¤æ­å¨ä¸­æ³¨å å¨contextä¸­ççå¬å¨(è§å¯è);
				 * 2. åå¤æ­å¨ä¸­æ³¨å å¨beanFactoryä¸­çbeanæ¯çå¬å¨(ApplicationListener.class)ç(è§å¯è)
				 * 3. å¹¿æ­ this.earlyApplicationEvents å±æ§ä¸­çäºä»¶;
				 * ä¸ºä»ä¹?
				 * å ä¸ºæå¯è½ å¨å®¹å¨çå½å¨æä¸­è°ç¨äºå½å `AbstractApplicationContext#publishEvent` åå¸äºä»¶, ä½æ¯å¤æ­å¨æ²¡æåå§åå®æ, æä»¥ä¼å°äºä»¶å­å¨this.earlyApplicationEvents ä¸­;
				 * å¾å®¹å¨åå§åå®æåå¨æµç¨  {@link org.springframework.context.support.AbstractApplicationContext#registerListeners()} ä¸­ä¼åå¸å­å¨è¿éé¢çäºä»¶
				 * (ä¾å¦: å¨ BeanFactoryPostProcessor çä¸å¡é»è¾è§¦åå®¹å¨çå¹¿æ­äºä»¶, è¿æ¶åå¤æ­å¨é½ä¸å­å¨)
				 * @see AbstractApplicationContext#prepareRefresh()
				 */
				registerListeners();

				// Instantiate all remaining (non-lazy-init) singletons.
				/**
				 * åä¸, å®ä¾åå©ä¸çææåä¾bean
				 *
				 * 1. ä¸º beanFactory è®¾ç½®ç±»åè½¬æ¢å¨(ConversionService) å±æ§å¡«åæ¶ä¼ç¨å° {@link AbstractApplicationContext#finishBeanFactoryInitialization(ConfigurableListableBeanFactory)}
				 * 2. ä¸º beanFactory æ·»å åéè§£æå¨ (StringValueResolver)
				 * 	å¦æ beanFactory ä¸ä¸æä¸­ä¸åå« "é»è®¤çåéè§£æå¨ (ç±»ä¼¼ PropertySourcesPlaceholderConfigurer) è§£æç±»ä¼¼ '${}' è¿æ ·çåé "
				 * 	åä½¿ç¨ç¯å¢å¯¹è±¡(ConfigurableEnvironment)ä¸­ç ConfigurablePropertyResolverå®ç°æ¥ä½ä¸º StringValueResolver æ·»å è¿å»
				 * 3. å»ç»éç½®, æ­¤åå°±ä¸ååè®¸æ´æ¹ beanDefinition äº
				 * 4. å®ä¾åææå©ä½ç (élazy-init) åä¾ Bean
				 * 5. å¤ç FactoryBean ç±»åçbean {@link DefaultListableBeanFactory#preInstantiateSingletons()}
				 * 	å¦æè¯¥beanæ¯ FactoryBean, åå¨ bean name åé¢å ä¸ä¸ª '&amp;' åç¼, åè·å/å®ä¾å FactoryBean æ¬èº«;
				 * 	(æ³¨æä¸ä¸ FactoryBean çæå¯¹è±¡æ¯ä¸éµå¾ª Spring çbeançå½å¨æç)
				 * 	è¿æä¸¤ä¸ªå¯¹è±¡, å¦ä½è·å? getBean(beanName) :
				 * 	1. ä¼ å¥ FactoryBean ç name è¿åçæ¯å¶ getObject çç®æ å¯¹è±¡å®ä¾;
				 * 	2. å¦ææ³è·å FactoryBean æ¬èº«å®ä¾, ååé¢éè¦å ä¸ä¸ª '&amp;' åç¼;
				 * 6. å°è¯ä»å½åå®¹å¨ ä¸ äº ä¸çº§ç¼å­è·å {@link AbstractBeanFactory#doGetBean(String, Class, Object[], boolean)}
				 * 7. å¤ç AOP ä»£çå¯¹è±¡çæ {@link AbstractAutowireCapableBeanFactory#createBean(String, RootBeanDefinition, Object[])}
				 * 8. å¨JVMå±é¢å®ä¾åå¯¹è±¡ {@link AbstractAutowireCapableBeanFactory#doCreateBean(String, RootBeanDefinition, Object[])}
				 * 	1.çæ­£å¨jvmå±é¢å®ä¾åå¯¹è±¡;
				 * 		1. å¦æè¯¥ BeanDefinition æéç½® instanceSupplierå±æ§(java.util.function.Supplier),
				 * 		 å°ä½¿ç¨å¶Supplier#getæ¹æ³çè¿å, ä½ä¸ºå®ä¾å¯¹è±¡
				 * 		2. å¦æè¯¥ BeanDefinition æéç½® factory-method å°ä½¿ç¨è¯¥æ¹æ³è¿åç, ä½ä¸ºå®ä¾å¯¹è±¡
				 * 		 è¿éè¿éåæ¬'éæå·¥å'å'å®ä¾å·¥å'çå¤ç(éè¿bdçfactoryBeanName è¿è¡å¤æ­, å¦æå­å¨åæ¯'å®ä¾å·¥å')
				 * 		3. ä½¿ç¨åå°å®ä¾å, æ ¹æ®ç­ç¥å®ä¾åBeanå¯¹è±¡ {@link org.springframework.beans.factory.support.SimpleInstantiationStrategy}
				 * 		- ä½¿ç¨æåæé å½æ°æ³¨å¥,åå»º (new)
				 * 		- ä½¿ç¨æ åæé å½æ°åå»º (new)
				 * 		- å·¥åæ¹æ³å®ä¾å ('éæå·¥å' 'å®ä¾å·¥å' )
				 * 		`&lt;bean  factory-bean="bookFactoryBean"  factory-method="getBook()"/&gt;`
				 * 		éæå·¥å: factory-bean è¥æ¯ å¨éå®ç±»å åä½¿ç¨ BookFactoryBean::getBook çéææ¹æ³è¿åçå¯¹è±¡
				 * 		å®ä¾å·¥å:  factory-bean è¥æ¯ bean å åä½¿ç¨è¯¥å®ä¾æ¹æ³è¿åçå¯¹è±¡
				 * 	2. ç¨ BeanWrapper åè£åå§bean (è£é¥°æ¨¡å¼)
				 * 	3. åå§å BeanWrapper
				 * 		1. ç» BeanWrapper è®¾ç½®äº, ConversionService
				 * 		2. ç» BeanWrapper æ³¨åäº, å½å bean factory (propertyEditorRegistrars)ä¸­çå¨é¨ PropertyEditor
				 * 		3. å¤ç MergedBeanDefinitionPostProcessor çæ¥å£åè° {@link AbstractAutowireCapableBeanFactory#applyMergedBeanDefinitionPostProcessors(RootBeanDefinition, Class, String)}
				 * 		è°ç¨ æ·»å å¨ context ä¸­ BeanPostProcessor ç MergedBeanDefinitionPostProcessor çæ¥å£åè°
				 * 		è§£æå°è¯¸å¦`@Autowired`ä¹ç±»çæ³¨è§£ (Metadata)åä¿¡æ¯,åå¹¶å°BeanDefinitionä¸­
				 * 	4. å¡«åBeanå±æ§ {@link AbstractAutowireCapableBeanFactory#populateBean(String, RootBeanDefinition, BeanWrapper)}
				 * 		1. å¦ææ¯AOP, pointcut, adviceç¸å³ç, synthetic ä¼éç½®ä¸º true  è°ç¨ BeanPostProcessor çå­æ¥å£ InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation
				 * 		(ä½ç¨æ¯ å¨å®ä¾åä¹åï¼å±æ§å¡«åä¹åæ§è¡æä½, å¯ä»¥æ¦æªå±æ§å¡«åæä½)
				 * 		2. å¤çæ³¨è§£ç  byName æè byType æ³¨å¥çå±æ§
				 * 		3. åè°ææ InstantiationAwareBeanPostProcessor#postProcessProperties æ¹æ³
				 * 		æ¯å¦, `@Autowired` çå¤çå¯¹åºå®ç°ç±»: {@link org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor}
				 * 		(ä½ç¨æ¯: å¨å·¥åå°å±æ§å¼åºç¨å°ç»å®beanä¹åï¼å¯¹å®ä»¬è¿è¡å¤ç)
				 * 		æ³¨æè¿éä¹åªæ¯è§£æ, å¹¶æ²¡æè®¾ç½®è¿å», å®éèµå¼æ¹æ³è§: {@link AbstractAutowireCapableBeanFactory#applyPropertyValues(java.lang.String, org.springframework.beans.factory.config.BeanDefinition, org.springframework.beans.BeanWrapper, org.springframework.beans.PropertyValues)}
				 * 	5.åå§åBeanå¯¹è±¡ {@link AbstractAutowireCapableBeanFactory#initializeBean(String, Object, RootBeanDefinition)}
				 * 		1. åè°ç¨è¿ä¸ä¸ª BeanNameAware, BeanClassLoaderAware, BeanFactoryAware {@link AbstractAutowireCapableBeanFactory#invokeAwareMethods(String, Object)}
				 * 		è¿ä¸ä¸ªæ¯å¨åå»ºBeanFactory æ¶å¿½ç¥çä¸ä¸ª Aware æ¥å£
				 * 		2. è°ç¨ææ BeanPostProcessors#postProcessBeforeInitialization (ä½ç¨: å¨Beanåå§åä¹åè°ç¨) {@link AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsBeforeInitialization(Object, String)}
				 * 		3. è°ç¨ init-method æ¹æ³ {@link AbstractAutowireCapableBeanFactory#invokeInitMethods(String, Object, RootBeanDefinition)}
				 * 		4. è°ç¨ææ BeanPostProcessors#postProcessAfterInitialization (ä½ç¨: å¨Beanåå§åä¹åè°ç¨) {@link AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsAfterInitialization(Object, String)}
				 * 	6. æ³¨å beanéæ¯çå·¥ä½(å¦æéè¦){@link AbstractBeanFactory#registerDisposableBeanIfNecessary(String, Object, RootBeanDefinition)}
				 * 			1. org.springframework.beans.factory.config.DestructionAwareBeanPostProcessor#postProcessBeforeDestruction(Object,String) BPPæ¥å£
				 * 			2. org.springframework.beans.factory.DisposableBean æ¥å£
				 * 			3. èªå®ä¹ destroyæ¹æ³
				 * 			(å¨å®¹å¨å³é­æ¶ä¼è°ç¨ä¼æè¿ä¸ªé¡ºåºè°ç¨)
				 *
				 */
				finishBeanFactoryInitialization(beanFactory);

				// Last step: publish corresponding event.
				/**
				 * åäº, å®æå®¹å¨å·æ°
				 * 1. æ¸çåç§ç¼å­èµæº
				 * 2. ä¸ºå½åä¸ä¸æåå§åçå½å¨æå¤çå¨
				 * 3. åå¸ ContextRefreshedEvent (Context å®æå·æ°)äºä»¶
				 */
				finishRefresh();
			}

			catch (RuntimeException | Error ex ) {
				if (logger.isWarnEnabled()) {
					logger.warn("Exception encountered during context initialization - " +
							"cancelling refresh attempt: " + ex);
				}
				// Destroy already created singletons to avoid dangling resources.
				destroyBeans();

				// Reset 'active' flag.
				cancelRefresh(ex);

				// Propagate exception to caller.
				throw ex;
			}

			finally {
				contextRefresh.end();
			}
		}
	}
</code></pre>
<h2 id="ä¸--applicationcontextçé¢åå¤å·¥ä½">ä¸.  (ApplicationContext)çé¢åå¤å·¥ä½</h2>
<p>ApplicationContext çé¢åå¤å·¥ä½, å®¹å¨å·æ°åçåå¤å·¥ä½<br>
<code>org.springframework.context.support.AbstractApplicationContext#prepareRefresh</code></p>
<pre><code class="language-java">/**
	 * Prepare this context for refreshing, setting its startup date and
	 * active flag as well as performing any initialization of property sources.
	 * å®¹å¨å·æ°åçåå¤å·¥ä½
	 * 1. è®¾ç½®å®¹å¨çä¸äºç¶ææ å¿ç¬¦;è®¾ç½®å¯å¨æ¶é´, æ´»å¨æ å¿ç¬¦; {@link AbstractApplicationContext#prepareRefresh()}
	 * 2. è·åæèåå»º Environment å¯¹è±¡; å è½½ System.getProperties(); {@see AbstractApplicationContext#environment}
	 * 3. éªè¯ç¯å¢æ¯å¦åå«æéç½®; æå¨æ·»å éç½®. {@link AbstractApplicationContext#initPropertySources()}
	 * 4. åå¤å­å¨ äºä»¶çå¬å¨ å äºä»¶ çéåå®¹å¨, é»è®¤ä¸ºç©º {@link AbstractApplicationContext#prepareRefresh()};
	 */
	protected void prepareRefresh() {
		// è®¾ç½®å®¹å¨çä¸äºç¶ææ å¿ç¬¦;è®¾ç½®å¯å¨æ¶é´, æ´»å¨æ å¿ç¬¦;
		// Switch to active.
		this.startupDate = System.currentTimeMillis();
		this.closed.set(false);
		this.active.set(true);

		if (logger.isDebugEnabled()) {
			if (logger.isTraceEnabled()) {
				logger.trace("Refreshing " + this);
			}
			else {
				logger.debug("Refreshing " + getDisplayName());
			}
		}

		// Initialize any placeholder property sources in the context environment.
		//çç»å­ç±»æ©å±çæ¹æ³: éªè¯ç¯å¢æ¯å¦åå«æéç½®; æå¨æ·»å éç½®;...
		initPropertySources();

		// Validate that all properties marked as required are resolvable:
		/**
		 *  éªè¯å¿é¡»çå­å¨çéç½®. ä¾å¦è°ç¨ `setRequiredProperties("iot.config.thread")`ä¹å, å¨è¿éä¼éªè¯æ¯å¦å­å¨ iot.config.thread éç½®,å¦åä¼æåºå¼å¸¸ MissingRequiredPropertiesException
		 * 	 {@link ConfigurablePropertyResolver#setRequiredProperties(String...) }
		 */
		getEnvironment().validateRequiredProperties();

		// s tore pre-refresh ApplicationListeners...
		//å­å¨çå¬å¨çéååå§å; this.earlyApplicationEvents(å·æ°åççå¬å¨)
		if (this.earlyApplicationListeners == null) {
			//å¦æä¸ºç©º,åæ·»å  this.applicationListeners å¨bootä¸­æ¯æå¼ç
			this.earlyApplicationListeners = new LinkedHashSet&lt;&gt;(this.applicationListeners);
		}
		else {
			// å¦æä¸ä¸ºç©º, åæ¸ç©º; æ³¨æè¿æ¯ content çå¤ç¨æ¹æ³ Refresh()
			// Reset local application listeners to pre-refresh state.
			this.applicationListeners.clear();
			this.applicationListeners.addAll(this.earlyApplicationListeners);
		}

		// Allow for the collection of early ApplicationEvents,
		// to be published once the multicaster is available...
		this.earlyApplicationEvents = new LinkedHashSet&lt;&gt;();
	}
</code></pre>
<h3 id="æ»ç»-1">æ»ç»</h3>
<ol>
<li>è®¾ç½®å®¹å¨çä¸äºç¶ææ å¿ç¬¦;è®¾ç½®å¯å¨æ¶é´, æ´»å¨æ å¿ç¬¦;</li>
<li>è·åæèåå»º Environment å¯¹è±¡; å è½½ System.getProperties();</li>
<li>éªè¯ç¯å¢æ¯å¦åå«æéç½®; æå¨æ·»å éç½®.</li>
<li>åå¤å­å¨ äºä»¶çå¬å¨ å äºä»¶ çéåå®¹å¨, é»è®¤ä¸ºç©º {@link AbstractApplicationContext#prepareRefresh()};</li>
</ol>
<h2 id="äº-åå»º-beanfactory---obtainfreshbeanfactory">äº. åå»º BeanFactory - obtainFreshBeanFactory()</h2>
<h3 id="åå»º-beanfactory">åå»º BeanFactory</h3>
<p>ç¬¬ä¸æ­¥å½ç¶æ¯åå»ºå­å¨Beançå®¹å¨å¦..<br>
<code>org.springframework.context.support.AbstractApplicationContext#obtainFreshBeanFactory</code><br>
<code>org.springframework.context.support.AbstractRefreshableApplicationContext#refreshBeanFactory</code></p>
<pre><code class="language-java">
	/**
	 * This implementation performs an actual refresh of this context's underlying
	 * bean factory, shutting down the previous bean factory (if any) and
	 * initializing a fresh bean factory for the next phase of the context's lifecycle.
	 *  {@link org.springframework.context.support.AbstractRefreshableApplicationContext#refreshBeanFactory}
	 */
	@Override
	protected final void refreshBeanFactory() throws BeansException {
		// å¦ææ åéæ¯ä¹åç BeanFactory
		if (hasBeanFactory()) {
			destroyBeans();
			closeBeanFactory();
		}
		try {
			/**
			 * &lt;!&gt; åå»º DefaultListableBeanFactory {@link org.springframework.context.support.AbstractRefreshableApplicationContext#createBeanFactory}
			 *  è®¾ç½® beanFactory å¿½ç¥  BeanNameAware, BeanClassLoaderAware, BeanFactoryAwareè¿ä¸ä¸ªAwareçæ¥å£ {@link AbstractAutowireCapableBeanFactory#AbstractAutowireCapableBeanFactory()}
			 *  å ä¸ºå¨åå§åBeanæ¶, ä¼ç´æ¥è°ç¨å®ä»¬(èä¸æ¯éè¿éè¿ BeanPostProcessoræ©å±çAwareæºå¶è°ç¨) {@link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#initializeBean(java.lang.String, java.lang.Object, org.springframework.beans.factory.support.RootBeanDefinition)}
			 */
			DefaultListableBeanFactory beanFactory = createBeanFactory();
			// è®¾ç½® beanFactory åºååID
			beanFactory.setSerializationId(getId());
			/**
			 *  å®å¶å BeanFactory &lt;!&gt; å¯æ©å±ç¹
			 *  {@link org.springframework.context.support.AbstractRefreshableApplicationContext#customizeBeanFactory(org.springframework.beans.factory.support.DefaultListableBeanFactory)}
			 *  1. æ¯å¦åè®¸ BeanDefinition è¦ç; å¦æä¸æ¯null,åè¦çé»è®¤å¼, å¯ä»¥çç»å­ç±»æ©å±ç
			 *  2. æ¯å¦èªå¨å¤çå¾ªç¯ä¾èµ; å¯ä»¥çç»å­ç±»æ©å±ç
			 */
			customizeBeanFactory(beanFactory);
			/**
			 * å è½½ BeanDefinitions &lt;!&gt;éç¹ {@link AbstractRefreshableApplicationContext#loadBeanDefinitions(DefaultListableBeanFactory)}
			 * 1. åå»º(XMLè§£æå¨/è¯»åå¨) XmlBeanDefinitionReader, å¹¶åå§å; çä¸æ©å±ç¹, æ©å±Reader ä¾å¦ æ¯å¦éªè¯xmlç­
			 * 2. åå»ºç¸å³å¯¹è±¡ DocumentLoader, BeanDefinitionDocumentReader, BeanDefinitionParserDelegate
			 *    å è½½è§£æ XMLçæ ç­¾/åç´ /å±æ§ ç­å¹¶ä¸å°å¶å°è£ä¸º ä¸ä¸ªä¸ª BeanDefinition å¯¹è±¡
			 * 3. å° BeanDefinitions æ³¨åå° registry
			 */
			loadBeanDefinitions(beanFactory);
			this.beanFactory = beanFactory;
		}
		catch (IOException ex) {
			throw new ApplicationContextException("I/O error parsing bean definition source for " + getDisplayName(), ex);
		}
	}
</code></pre>
<p><code>org.springframework.context.support.AbstractRefreshableApplicationContext#createBeanFactory</code></p>
<pre><code class="language-java">/**
	 * Create an internal bean factory for this context.
	 * Called for each {@link #refresh()} attempt.
	 * &lt;p&gt;The default implementation creates a
	 * {@link org.springframework.beans.factory.support.DefaultListableBeanFactory}
	 * with the {@linkplain #getInternalParentBeanFactory() internal bean factory} of this
	 * context's parent as parent bean factory. Can be overridden in subclasses,
	 * for example to customize DefaultListableBeanFactory's settings.
	 * @return the bean factory for this context
	 * @see org.springframework.beans.factory.support.DefaultListableBeanFactory#setAllowBeanDefinitionOverriding
	 * @see org.springframework.beans.factory.support.DefaultListableBeanFactory#setAllowEagerClassLoading
	 * @see org.springframework.beans.factory.support.DefaultListableBeanFactory#setAllowCircularReferences
	 * @see org.springframework.beans.factory.support.DefaultListableBeanFactory#setAllowRawInjectionDespiteWrapping
	 */
	protected DefaultListableBeanFactory createBeanFactory() {
		return new DefaultListableBeanFactory(getInternalParentBeanFactory());
	}
</code></pre>
<p>åå»ºçå®ä¾æ¯ <code>DefaultListableBeanFactory</code></p>
<h3 id="åå»º-xmlbeandefinitionreader">åå»º XmlBeanDefinitionReader</h3>
<p><code>XmlBeanDefinitionReader</code> è¿ä¸ªå¯¹è±¡æ¯ç¨æ¥è¯»å xml éç½®ç</p>
<p><code>org.springframework.context.support.AbstractXmlApplicationContext#loadBeanDefinitions(org.springframework.beans.factory.support.DefaultListableBeanFactory)</code></p>
<pre><code class="language-java">/**
 * Loads the bean definitions via an XmlBeanDefinitionReader.
 *
 *  1. åå»º(XMLè§£æå¨/è¯»åå¨) XmlBeanDefinitionReader {@link AbstractXmlApplicationContext#loadBeanDefinitions(DefaultListableBeanFactory)}
 *    - ç» beanDefinitionReader è®¾ç½®ç¯å¢å¯¹è±¡, å¯ä»¥è®© XmlBeanDefinitionReader ååéè¡¨è¾¾å¼è§£ææ¯å¦ ${jdbc.url}
 *    - ç» beanDefinitionReader è®¾ç½® BeanFactory
 * 	  - ç» beanDefinitionReader è®¾ç½® è¦ç¨äºè§£æçSAXå®ä½è§£æå¨; (SAXå¨ç§° Simple API for XMLï¼æ¢æ¯ä¸ç§æ¥å£ï¼ä¹æ¯ä¸ç§è½¯ä»¶åãå®æ¯ä¸ç§XMLè§£æçæ¿ä»£æ¹æ³)
 * 			æ³¨æè¿éå è½½äºä¸¤ä¸ªå¯¹è±¡: 1. BeansDtdResolver (XSD,DTDè§£æå¨); 2. PluggableSchemaResolver  æ å°(æ¬å°æä»¶xsdæ£éª) 'META-INF/spring.schemas'æä»¶ä¿¡æ¯
 * 			ä¾å¦, context å½åç©ºé´xmlæ£éªçæ å°:
 * 			&lt;code&gt; http\://www.springframework.org/schema/context/spring-context.xsd=org/springframework/context/config/spring-context.xsd&lt;/code&gt;
 * 			@see DelegatingEntityResolver#DelegatingEntityResolver(java.lang.ClassLoader)
 * {@link AbstractXmlApplicationContext#initBeanDefinitionReader(XmlBeanDefinitionReader)}
 *  2. è°ç¨æ©å±ç¹æ¹æ³, æ©å±/å®å¶ XmlBeanDefinitionReader
 *  3. å è½½ BeanDefinitions &lt;!&gt;
 *
 * @see org.springframework.beans.factory.xml.XmlBeanDefinitionReader
 * @see #initBeanDefinitionReader
 * @see #loadBeanDefinitions
 */
@Override
protected void loadBeanDefinitions(DefaultListableBeanFactory beanFactory) throws BeansException, IOException {
	// Create a new XmlBeanDefinitionReader for the given BeanFactory.
	/**
	 * åå»º(XMLè§£æå¨/è¯»åå¨) XmlBeanDefinitionReader {@link AbstractXmlApplicationContext#loadBeanDefinitions(DefaultListableBeanFactory)}
	 * æ³¨æä¼ è¿å»ç DefaultListableBeanFactory å®å®ç°äº BeanDefinitionRegistry ä½ä¸º Registry ä¼ éè¿å»
	 * æåè§£æåºæ¥ç BeanDefinition, ä½¿ç¨è¯¥ Registry ä½ä¸ºæ³¨åä¸­å¿
	 */
	XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory);
	// Configure the bean definition reader with this context's
	// resource loading environment.
	// ç» beanDefinitionReader è®¾ç½®ç¯å¢å¯¹è±¡, å¯ä»¥è®© XmlBeanDefinitionReader ååéè¡¨è¾¾å¼è§£ææ¯å¦ ${jdbc.url}
	beanDefinitionReader.setEnvironment(getEnvironment());
	// ç» beanDefinitionReader è®¾ç½® BeanFactory
	beanDefinitionReader.setResourceLoader(this);
	/**
	 * ç» beanDefinitionReader è®¾ç½® è¦ç¨äºè§£æçSAXå®ä½è§£æå¨; (SAXå¨ç§° Simple API for XMLï¼æ¢æ¯ä¸ç§æ¥å£ï¼ä¹æ¯ä¸ç§è½¯ä»¶åãå®æ¯ä¸ç§XMLè§£æçæ¿ä»£æ¹æ³)
	 * 		æ³¨æè¿éå è½½äºä¸¤ä¸ªå¯¹è±¡: 1. BeansDtdResolver (XSD,DTDè§£æå¨); 2. PluggableSchemaResolver  æ å°(æ¬å°æä»¶xsdæ£éª) 'META-INF/spring.schemas'æä»¶ä¿¡æ¯
	 * 				ä¾å¦, context å½åç©ºé´xmlæ£éªçæ å°: `http\://www.springframework.org/schema/context/spring-context.xsd=org/springframework/context/config/spring-context.xsd`
	 * 		ä½¿ç¨è¿ä¸¤ä¸ªè§£æå¨é¿åä»ç½ç»ä¸è½½DTDæXSD,è§£æå¨ä¼æ ¹æ®è¿äºæ¨¡å¼å®ä¹éªè¯éç½®æä»¶çç»ææ¯å¦æ­£ç¡®ãå¦æéªè¯å¤±è´¥ï¼å®¹å¨å°æ æ³å¯å¨
	 * @see DelegatingEntityResolver#DelegatingEntityResolver(java.lang.ClassLoader)
	 */
	beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this));

	// Allow a subclass to provide custom initialization of the reader,
	// then proceed with actually loading the bean definitions.
	/**
	 * è°ç¨æ©å±ç¹æ¹æ³, æ©å±/å®å¶ XmlBeanDefinitionReader {@link AbstractXmlApplicationContext#initBeanDefinitionReader(XmlBeanDefinitionReader)}
	 */
	initBeanDefinitionReader(beanDefinitionReader);
	
	/**
	 * å è½½ BeanDefinitions, å¹¶æ³¨åå° Registry ä¸­, è¿ä¸ªæ­¥éª¤, ä¸ºäºå¤ç¨ä»£ç åµå¥çæ¹æ³éå¸¸å¤, æ»ç»ä¸ä¸å³é®ç¹
	 * 1. ä¸ºäºä»£ç å¤ç¨,å¤ä¸ªæ¹æ³éè½½ éç½®æä»¶è·¯å¾ (Stringåæ°), å¤éç½®æä»¶(æ°ç»åæ°) , å¨ç»ä¸è½¬ä¸º `org.springframework.core.io.Resource` å¯¹è±¡å»è¿­ä»£
	 * 		æç»è¯»åéç½®æä»¶çè¾å¥æµå¨ {@link org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.support.EncodedResource)}
	 * 2.
	 */
	loadBeanDefinitions(beanDefinitionReader);
}
</code></pre>
<h4 id="èªå®ä¹å½åç©ºé´å¤çå¨">èªå®ä¹å½åç©ºé´å¤çå¨</h4>
<p>æ³¨æä¸ç¹  <code>XmlBeanDefinitionReader</code> ææ ä¸ä¸ª <code>namespaceHandlerResolver</code>, é»è®¤å®çåå»ºé»è¾æ¯å¨<br>
<code>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#createDefaultNamespaceHandlerResolver</code></p>
<pre><code class="language-java">
/**
	 * Create the default implementation of {@link NamespaceHandlerResolver} used if none is specified.
	 * &lt;p&gt;The default implementation returns an instance of {@link DefaultNamespaceHandlerResolver}.
	 * @see DefaultNamespaceHandlerResolver#DefaultNamespaceHandlerResolver(ClassLoader)
	 */
	protected NamespaceHandlerResolver createDefaultNamespaceHandlerResolver() {
		ResourceLoader resourceLoader = getResourceLoader();
		ClassLoader cl = (resourceLoader != null ? resourceLoader.getClassLoader() : getBeanClassLoader());
		// è§£æèªå®ä¹æ ç­¾ç NamespaceHandlerResolver å½åç©ºé´ handle æ å°
		//
		return new DefaultNamespaceHandlerResolver(cl);
	}
</code></pre>
<h3 id="å è½½-beandefinition-å°å®¹å¨">å è½½ BeanDefinition å°å®¹å¨</h3>
<p>è¿ä¸æ­¥ ä¸ºäºå¤ç¨, åµå¥çæ¹æ³éå¸¸å¤, è¿éååºå³é®æ¹æ³</p>
<h4 id="è½¬ä¸ºæ°ç»åæ°è¿­ä»£">è½¬ä¸ºæ°ç»åæ°è¿­ä»£</h4>
<p>æ°ç»æ¹å¼è¿­ä»£ä»¥æ¯æå¤éç½®æä»¶</p>
<pre><code class="language-java">	/**
	 * Load the bean definitions with the given XmlBeanDefinitionReader.
	 * &lt;p&gt;The lifecycle of the bean factory is handled by the {@link #refreshBeanFactory}
	 * method; hence this method is just supposed to load and/or register bean definitions.
	 *
	 * æ ¹æ®èµæºæä»¶æ°ç»è¿­ä»£å è½½è§£æ
	 * 		å è½½ Resource[] å½¢å¼çéç½®æä»¶
	 * 		å è½½ String[] å½¢å¼çéç½®æä»¶
	 *
	 * @param reader the XmlBeanDefinitionReader to use
	 * @throws BeansException in case of bean registration errors
	 * @throws IOException if the required XML document isn't found
	 * @see #refreshBeanFactory
	 * @see #getConfigLocations
	 * @see #getResources
	 * @see #getResourcePatternResolver
	 */
	protected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws BeansException, IOException {
		//å è½½ Resource[] å½¢å¼çéç½®æä»¶
		Resource[] configResources = getConfigResources();
		if (configResources != null) {
			reader.loadBeanDefinitions(configResources);
		}
		//å è½½ String[] å½¢å¼çéç½®æä»¶
		String[] configLocations = getConfigLocations();
		if (configLocations != null) {
			reader.loadBeanDefinitions(configLocations);
		}
	}
</code></pre>
<h4 id="è½¬ä¸º-resource">è½¬ä¸º Resource</h4>
<p>ç»ä¸è½¬ä¸º <code>Resource</code> å¯¹è±¡ä»¥æ¹ä¾¿å è½½</p>
<pre><code class="language-java">	/**
	 * Load bean definitions from the specified resource location.
	 * &lt;p&gt;The location can also be a location pattern, provided that the
	 * ResourceLoader of this bean definition reader is a ResourcePatternResolver.
	 * @param location the resource location, to be loaded with the ResourceLoader
	 * (or ResourcePatternResolver) of this bean definition reader
	 * @param actualResources a Set to be filled with the actual Resource objects
	 * that have been resolved during the loading process. May be {@code null}
	 * to indicate that the caller is not interested in those Resource objects.
	 * @return the number of bean definitions found
	 * @throws BeanDefinitionStoreException in case of loading or parsing errors
	 * @see #getResourceLoader()
	 * @see #loadBeanDefinitions(org.springframework.core.io.Resource)
	 * @see #loadBeanDefinitions(org.springframework.core.io.Resource[])
	 */
	public int loadBeanDefinitions(String location, @Nullable Set&lt;Resource&gt; actualResources) throws BeanDefinitionStoreException {
		ResourceLoader resourceLoader = getResourceLoader();
		if (resourceLoader == null) {
			throw new BeanDefinitionStoreException(
					"Cannot load bean definitions from location [" + location + "]: no ResourceLoader available");
		}
		if (resourceLoader instanceof ResourcePatternResolver resourcePatternResolver) {
			// Resource pattern matching available.
			try {
				/**
				 * å¯¹äºåéå¤ç å¨ {@link org.springframework.context.support.AbstractRefreshableConfigApplicationContext#setConfigLocations(String...)} å·²ç»å¤çè¿ä¸éäº, è¿éåå¤çä¸é?
				 *
				 * è¿éçéç¹æ¯: å° String è·¯å¾ è½¬ä¸ºResourcedå¯¹è±¡, å¤ä¸å¤çåéæ æè°, ä¸æ¯éç¹
				 * å¤çæä»¶ååå«åéè¡¨è¾¾å¼ç, ä¾å¦: application-${active}.xml, ç¨ç¯å¢å¯¹è±¡åéæ¿æ¢ä¹
				 */
				Resource[] resources = resourcePatternResolver.getResources(location);
				int count = loadBeanDefinitions(resources);
				if (actualResources != null) {
					Collections.addAll(actualResources, resources);
				}
				if (logger.isTraceEnabled()) {
					logger.trace("Loaded " + count + " bean definitions from location pattern [" + location + "]");
				}
				return count;
			}
			catch (IOException ex) {
				throw new BeanDefinitionStoreException(
						"Could not resolve bean definition resource pattern [" + location + "]", ex);
			}
		}
		else {
			// Can only load single resources by absolute URL.
			Resource resource = resourceLoader.getResource(location);
			int count = loadBeanDefinitions(resource);
			if (actualResources != null) {
				actualResources.add(resource);
			}
			if (logger.isTraceEnabled()) {
				logger.trace("Loaded " + count + " bean definitions from location [" + location + "]");
			}
			return count;
		}
	}
</code></pre>
<h4 id="è½¬ä¸º-encodedresource">è½¬ä¸º EncodedResource</h4>
<p>è½¬ä¸º <code>EncodedResource</code> å¯¹è±¡ä»¥è§£å³ç¼ç <br>
<code>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.Resource)</code></p>
<pre><code class="language-java">/**  
 * å° Resource åè£ä¸º EncodedResource å è½½, åºè¯¥ä¸»è¦æ¯è§£å³ç¼ç çé®é¢  
 * Load bean definitions from the specified XML file.  
 * @param resource the resource descriptor for the XML file  
 * @return the number of bean definitions found  
 * @throws BeanDefinitionStoreException in case of loading or parsing errors  
 */@Override  
public int loadBeanDefinitions(Resource resource) throws BeanDefinitionStoreException {  
    return loadBeanDefinitions(new EncodedResource(resource));  
}

</code></pre>
<h4 id="è¯»åéç½®æä»¶è¾å¥æµ">è¯»åéç½®æä»¶è¾å¥æµ</h4>
<p><code>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.support.EncodedResource)</code></p>
<pre><code class="language-java">/**
	 * æ ¡éªä¸ä¸, è¿éè§£å³å¾ªç¯å¯¼å¥
	 * Load bean definitions from the specified XML file.
	 * @param encodedResource the resource descriptor for the XML file,
	 * allowing to specify an encoding to use for parsing the file
	 * @return the number of bean definitions found
	 * @throws BeanDefinitionStoreException in case of loading or parsing errors
	 */
	public int loadBeanDefinitions(EncodedResource encodedResource) throws BeanDefinitionStoreException {
		Assert.notNull(encodedResource, "EncodedResource must not be null");
		if (logger.isTraceEnabled()) {
			logger.trace("Loading XML bean definitions from " + encodedResource);
		}

		//ä½¿ç¨Setå­å¨å·²å è½½çéç½®èµæº
		Set&lt;EncodedResource&gt; currentResources = this.resourcesCurrentlyBeingLoaded.get();

		// å½éå°å¾ªç¯ import definitions æ¶æåºå¼å¸¸
		if (!currentResources.add(encodedResource)) {
			throw new BeanDefinitionStoreException(
					"Detected cyclic loading of " + encodedResource + " - check your import definitions!");
		}
		// è·å¾éç½®æä»¶çè¾å¥æµ; è¿éçæ­£çå¼å§è¯»
		try (InputStream inputStream = encodedResource.getResource().getInputStream()) {
			InputSource inputSource = new InputSource(inputStream);
			if (encodedResource.getEncoding() != null) {
				inputSource.setEncoding(encodedResource.getEncoding());
			}
			return doLoadBeanDefinitions(inputSource, encodedResource.getResource());
		}
		catch (IOException ex) {
			throw new BeanDefinitionStoreException(
					"IOException parsing XML document from " + encodedResource.getResource(), ex);
		}
		finally {
			currentResources.remove(encodedResource);
			if (currentResources.isEmpty()) {
				this.resourcesCurrentlyBeingLoaded.remove();
			}
		}
	}
</code></pre>
<h4 id="åå»º--beandefinitiondocumentreader">åå»º  BeanDefinitionDocumentReader</h4>
<p><code>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions</code></p>
<pre><code class="language-java">/**
	 * Register the bean definitions contained in the given DOM document.
	 * Called by {@code loadBeanDefinitions}.
	 * &lt;p&gt;Creates a new instance of the parser class and invokes
	 * {@code registerBeanDefinitions} on it.
	 * @param doc the DOM document
	 * @param resource the resource descriptor (for context information)
	 * @return the number of bean definitions found
	 * @throws BeanDefinitionStoreException in case of parsing errors
	 * @see #loadBeanDefinitions
	 * @see #setDocumentReaderClass
	 * @see BeanDefinitionDocumentReader#registerBeanDefinitions
	 */
	public int registerBeanDefinitions(Document doc, Resource resource) throws BeanDefinitionStoreException {
		/**
		 *  è¿éååå»ºäºä¸ä¸ª BeanDefinitionDocumentReader å¯¹è±¡, ç¨æ¥è¯»å/è§£æ Document
		 */
		BeanDefinitionDocumentReader documentReader = createBeanDefinitionDocumentReader();
		int countBefore = getRegistry().getBeanDefinitionCount();

		/**
		 * è§£æå¹¶æ³¨å bean definitions å° Registry ä¸­
		 * &lt;br /&gt;
		 * è§£æXMLèªå®ä¹æ ç­¾ éè¦æ³¨æä¸ä¸, è¿éçç¬¬2ä¸ªåæ°åå»ºç XmlReaderContext;
		 * 		å®ä»è¿éåå»ºäº {@link XmlBeanDefinitionReader#getNamespaceHandlerResolver()} å½åç©ºé´å¤çå¨è§£æå¨, åç»­è§£æå°å¯¹åºçå½åç©ºé´å¤ç, è°ç¨å¶ NamespaceHandler#parse è¿è¡è§£æ
		 * 		å®é»è®¤è¯»åçéç½®æ¯ `META-INF/spring.handlers`
		 * 		ä¾å¦:
		 * 		spring-context æ¨¡åçä¸­ `META-INF/spring.handlers` å®ä¹çhandlesæå¦ä¸è¿äº
		 * http\://www.springframework.org/schema/context=org.springframework.context.config.ContextNamespaceHandler
		 * http\://www.springframework.org/schema/jee=org.springframework.ejb.config.JeeNamespaceHandler
		 * http\://www.springframework.org/schema/lang=org.springframework.scripting.config.LangNamespaceHandler
		 * http\://www.springframework.org/schema/task=org.springframework.scheduling.config.TaskNamespaceHandler
		 * http\://www.springframework.org/schema/cache=org.springframework.cache.config.CacheNamespaceHandler
		 *
		 * 		spring-aop æ¨¡åçä¸­ `META-INF/spring.handlers` å®ä¹çhandlesæå¦ä¸è¿äº
		 * http\://www.springframework.org/schema/aop=org.springframework.aop.config.AopNamespaceHandler
		 */
		documentReader.registerBeanDefinitions(doc, createReaderContext(resource));
		// è¿åè§£æ bean definitions çæ°é
		return getRegistry().getBeanDefinitionCount() - countBefore;
	}
</code></pre>
<h4 id="éå½åµå¥å è½½">éå½åµå¥å è½½</h4>
<p><code>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions</code></p>
<pre><code class="language-java">/**
	 * Register each bean definition within the given root {@code &lt;beans/&gt;} element.
	 *  å¨ç»å®ç(beans)æ ¹åç´ ä¸­æ³¨åæ¯ä¸ªbeanå®ä¹, è¿éç Element æ¯ xml æ ¹åç´ 
	 */
	@SuppressWarnings("deprecation")  // for Environment.acceptsProfiles(String...)
	protected void doRegisterBeanDefinitions(Element root) {
		// Any nested &lt;beans&gt; elements will cause recursion in this method. In
		// order to propagate and preserve &lt;beans&gt; default-* attributes correctly,
		// keep track of the current (parent) delegate, which may be null. Create
		// the new (child) delegate with a reference to the parent for fallback purposes,
		// then ultimately reset this.delegate back to its original (parent) reference.
		// this behavior emulates a stack of delegates without actually necessitating one.
		/**
		 * å¨æ­¤æ¹æ³ä¸­ï¼ä»»ä½åµå¥ç&lt;beans&gt;åç´ é½å°å¯¼è´éå½è°ç¨
		 *   ä¸ºäºæ­£ç¡®å°ä¼ æ­åä¿å­&lt;beans&gt;é»è®¤å±æ§ï¼è¯·è·è¸ªå½å(ç¶)å§æ(å®å¯è½ä¸ºç©º)ã
		 *   åå»ºæ°ç(å­)å§æï¼å¹¶å°å¶å¼ç¨å°ç¶(ç¶)å§æç¨äºåéç®çï¼ç¶åæç»å° this.delegateéç½®ä¸ºå¶åå§(ç¶)å¼ç¨ã
		 *   æ­¤è¡ä¸ºæ¨¡æå§æå æ ï¼èå®éä¸ä¸éè¦å§æå æ ã
		 *
		 * åºè¯¥æ¯åµå¥è§£æ/éå½æ¶, é½ç¨è¿ä¸ä¸ª delegateè§£æ, ä¿å­ç¶æ, ç¨äºä¼ éä¸ä¸æçåæ°;
		 */
		BeanDefinitionParserDelegate parent = this.delegate;
		/**
		 * å§æ namespaceHandlerResolver
		 */
		this.delegate = createDelegate(getReaderContext(), root, parent);//parent å§æ´¾, ä¸çº§çparent

		/**
		 * æ¯å¦é»è®¤å½åç©ºé´; è¿éæ¯ xml çå½åç©ºé´è§£æå¤æ­
		 *    ç®èè¨ä¹é»è®¤å½åç©ºé´å¤å®æ¯: http://www.springframework.org/schema/beans æèæ¯ org/springframework/beans/factory/xml/spring-beans.dtd å¶DTDå®ä¹çæ ç­¾
		 *    å¦:
		 *    &lt;beans..&gt;&lt;/beans&gt;, &lt;bean&gt;&lt;/bean&gt;, &lt;import resource="" /&gt; è¿äºæ ç­¾æ¯é»è®¤å½åç©ºé´
		 *    &lt;tx:TAG ...&gt; , &lt;aop:TAG ...&gt; è¿äºæ ç­¾ä¸æ¯é»è®¤å½åç©ºé´
		 */
		if (this.delegate.isDefaultNamespace(root)) {
			String profileSpec = root.getAttribute(PROFILE_ATTRIBUTE);
			if (StringUtils.hasText(profileSpec)) {
				String[] specifiedProfiles = StringUtils.tokenizeToStringArray(
						profileSpec, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS);
				// We cannot use Profiles.of(...) since profile expressions are not supported
				// in XML config. See SPR-12458 for details.
				if (!getReaderContext().getEnvironment().acceptsProfiles(specifiedProfiles)) {
					if (logger.isDebugEnabled()) {
						logger.debug("Skipped XML bean definition file due to specified profiles [" + profileSpec +
								"] not matching: " + getReaderContext().getResource());
					}
					return;
				}
			}
		}
		// åç½®-é©å­æ¹æ³, é¢çæ©å±, è¿éæ¯ç©ºå®ç°
		preProcessXml(root);
		// çæ­£è§£æé»è¾
		parseBeanDefinitions(root, this.delegate);
		// åç½®-é©å­æ¹æ³, é¢çæ©å±, è¿éæ¯ç©ºå®ç°
		postProcessXml(root);

		this.delegate = parent;
	}
</code></pre>
<h4 id="è§£æé»è®¤å½åç©ºé´">è§£æé»è®¤å½åç©ºé´</h4>
<pre><code class="language-java">/**
	 * Parse the elements at the root level in the document:
	 * "import", "alias", "bean".
	 * @param root the DOM root element of the document
	 */
	protected void parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) {
		if (delegate.isDefaultNamespace(root)) {
			NodeList nl = root.getChildNodes();
			for (int i = 0; i &lt; nl.getLength(); i++) {
				Node node = nl.item(i);
				if (node instanceof Element ele) {//æ¯å¦ æ¯åç´ æ ç­¾
					/**
					 * å¤çé»è®¤å½åç©ºé´çæ ç­¾, æå¦ä¸åä¸ª
					 * &lt;import&gt;&lt;/import&gt;, &lt;alias&gt;&lt;/alias&gt;, &lt;bean&gt;&lt;/bean&gt;, &lt;beans&gt;&lt;/beans&gt;
					 *
					 */
					if (delegate.isDefaultNamespace(ele)) {
						parseDefaultElement(ele, delegate);
					}
					else {
						/**
						 * å¤ç éé»è®¤å½åç©ºé´çæ ç­¾;
						 * 	æ³¨æè¿éåæ¬ &lt;context:bean ...&gt; &lt;aop:xx ...&gt; &lt;tx:xx ...&gt; ç­ç­æææå®å½åç©ºé´çxmléç½®
						 */
						delegate.parseCustomElement(ele);
					}
				}
			}
		}
		else {
			delegate.parseCustomElement(root);
		}
	}
</code></pre>
<p><code>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#parseDefaultElement</code></p>
<pre><code class="language-java">/**
	 * é»è®¤å½åç©ºé´çå¤ç
	 * @param ele
	 * @param delegate
	 */
	private void parseDefaultElement(Element ele, BeanDefinitionParserDelegate delegate) {
		// é»è®¤å½åç©ºé´ç import åç´ å¤ç
		if (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) {
			importBeanDefinitionResource(ele);
		}
		// é»è®¤å½åç©ºé´ç alias åç´ å¤ç
		else if (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) {
			processAliasRegistration(ele);
		}
		// é»è®¤å½åç©ºé´ç bean åç´ å¤ç
		else if (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) {
			processBeanDefinition(ele, delegate);
		}
		// é»è®¤å½åç©ºé´ç beans åç´ å¤ç
		else if (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) {
			// recurse
			doRegisterBeanDefinitions(ele);
		}
	}
</code></pre>
<h4 id="è§£æèªå®ä¹æ ç­¾">è§£æèªå®ä¹æ ç­¾</h4>
<p><code>org.springframework.beans.factory.xml.BeanDefinitionParserDelegate#parseCustomElement(org.w3c.dom.Element, org.springframework.beans.factory.config.BeanDefinition)</code></p>
<pre><code class="language-java">	/**
	 * ä¸»è¦é»è¾æ¯ æ¿å°åç´ çå½åç©ºé´URI, åä» XmlReaderContext æ¾å°å¯¹åºç NamespaceHandler è°ç¨è§£æ `parse`æ¹æ³è§£æå° BeanDefinition è¿å
	 *  Parse a custom element (outside the default namespace).
	 * @param ele the element to parse
	 * @param containingBd the containing bean definition (if any)
	 * @return the resulting bean definition
	 */
	@Nullable
	public BeanDefinition parseCustomElement(Element ele, @Nullable BeanDefinition containingBd) {
		//æ¿å° å½åç©ºé´URI
		String namespaceUri = getNamespaceURI(ele);
		if (namespaceUri == null) {
			return null;
		}
		/**
		 * æ¿å°å¯¹åºå½åç©ºé´ç Handler , this.readerContext æ¯å¨
		 * @see org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions(org.w3c.dom.Document, org.springframework.core.io.Resource) åå»ºç
		 * 		å®ä¼ä»ç¶å±æ§ç namespaceHandlerResolver ä¸­æ¿å°å½åç©ºé´å¤çå¨, è°ç¨NamespaceHandler#parse è¿è¡è§£æ
		 * 		å®é»è®¤è¯»åçéç½®æ¯ `META-INF/spring.handlers` æä»¶
		 *
		 * spring å¯¹äº æ³¨è§£ AOP TXäºå¡ çæ¯æ, åæ¯åä¸ªè¿ç§æ¹å¼æ©å±ç, ä½è¿äºä¸å±IOCåå®¹, æ¬ç¯ä¸ä½è¯´æ..
		 */
		NamespaceHandler handler = this.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);
		if (handler == null) {
			error("Unable to locate Spring NamespaceHandler for XML schema namespace [" + namespaceUri + "]", ele);
			return null;
		}
		// è°ç¨ Handler è§£æ, è¿åçæ¯ BeanDefinition;
		return handler.parse(ele, new ParserContext(this.readerContext, this, containingBd));
	}
</code></pre>
<h4 id="æ³¨å-beandefinition-å°-registry">æ³¨å BeanDefinition å° Registry</h4>
<p><code>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#processBeanDefinition</code></p>
<pre><code class="language-java">/**
	 * Process the given bean element, parsing the bean definition
	 * and registering it with the registry.
	 *
	 * - å¤çbeanåç´ ï¼è§£æ BeanDefinition å¹¶å°å¶æ³¨åå°æ³¨åä¸­å¿ã
	 * - å¶å®å°±æ¯å¾ DefaultListableBeanFactory çè¿ä¸¤ä¸ªéåå±æ§æ·»å :
	 * 		1. è¿ä¸ªlist å­å¨ææç bean definition åç§° {@link org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionNames}
	 * 		2. è¿ä¸ªmapå­å¨ææçBeanDefinition, keyæ¯beanä¸»name, valueæ¯BeanDefinition {@link org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionMap}
	 */
	protected void processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate) {
		/**
		 * å¯¹äº BeanDefinitionHolder å¶å®å®å°±æ¯ä¸ä¸ªDTOå¯¹è±¡, å®åå«ä»¥ä¸å±æ§:
		 * 	private final BeanDefinition beanDefinition;//Bean  beanDefinition
		 * 	private final String beanName; 				//Bean åç§°
		 *  private final String[] aliases;				//Bean å«ååè¡¨
		 *
		 */
		BeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele);

		// æ­¤æ¶, å°±å®æäº å¯¹ BeanDefinition è§£æäº
		if (bdHolder != null) {
			/**
			 * è£é¥° BeanDefinitionï¼å¦æéè¦ï¼, ç±»ä¼¼äº:
			 * 		&lt;bean id="user" class=".."&gt;
			 *  		&lt;myBean:user username="è¿æ¯ Spring"/&gt;
			 * 		&lt;/bean&gt;
			 *  å¯¹åº`myBean:user` è¿ç§èªå®ä¹æ ç­¾è¿è¡å¤ç;
			 *  åé¢ä¼æ¾å°å¯¹åºçå½åç©ºé´ Handler (NamespaceHandler) è¿è¡å¤ç : NamespaceHandler handler = this.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);
			 */
			bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder);
			try {
				/**
				 * æ³¨åå° Registry
				 */
				// Register the final decorated instance.
				BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());
			}
			catch (BeanDefinitionStoreException ex) {
				getReaderContext().error("Failed to register bean definition with name '" +
						bdHolder.getBeanName() + "'", ele, ex);
			}
			// Send registration event.
			getReaderContext().fireComponentRegistered(new BeanComponentDefinition(bdHolder));
		}
	}
</code></pre>
<p><code>org.springframework.beans.factory.support.BeanDefinitionReaderUtils#registerBeanDefinition</code></p>
<pre><code class="language-java">/**
	 * Register the given bean definition with the given bean factory.
	 * @param definitionHolder the bean definition including name and aliases
	 * @param registry the bean factory to register with
	 * @throws BeanDefinitionStoreException if registration failed
	 */
	public static void registerBeanDefinition(
			BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry)
			throws BeanDefinitionStoreException {

		// Register bean definition under primary name.
		/**
		 * ä»¥ beanName å Register æ³¨å
		 * å¶å®å°±æ¯å¾ DefaultListableBeanFactory çè¿ä¸¤ä¸ªéåå±æ§æ·»å :
		 * 1. è¿ä¸ªlist å­å¨ææç bean definition åç§° {@link org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionNames}
		 * 2. è¿ä¸ªmapå­å¨ææçBeanDefinition, keyæ¯beanä¸»name, valueæ¯BeanDefinition {@link org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionMap}
		 */
		String beanName = definitionHolder.getBeanName();
		registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition());

		/**
		 * å Register æ³¨åå«ååè¡¨
		 * å¶å®å°±æ¯ {@link org.springframework.core.SimpleAliasRegistry#aliasMap}
		 * å¨è¿ä¸ª mapå­å¨bean çå«å, keyæ¯å«å, value æ¯beanä¸»name;
		 */
		// Register aliases for bean name, if any.
		String[] aliases = definitionHolder.getAliases();
		if (aliases != null) {
			for (String alias : aliases) {
				registry.registerAlias(beanName, alias);
			}
		}
	}
</code></pre>
<p>è³æ­¤, BeanDefinition ç®æ¯æåè§£æ, å¹¶æ³¨åå° Register ä¸­äº</p>
<h3 id="æ»ç»-2">æ»ç»</h3>
<ol>
<li>éæ¯ä¹åç beanFactory (å¦ææçè¯)</li>
<li>å®ä¾å/åå»º beanFactory, è¿éæ¯å®ä¾ç±»æ¯ <code>DefaultListableBeanFactory</code></li>
<li>è®¾ç½® beanFactory å¿½ç¥  BeanNameAware, BeanClassLoaderAware, BeanFactoryAwareè¿ä¸ä¸ªAwareçæ¥å£ {@link AbstractAutowireCapableBeanFactory#AbstractAutowireCapableBeanFactory()}<br>
å ä¸ºå¨åå§åBeanæ¶, ä¼ç´æ¥è°ç¨å®ä»¬(èä¸æ¯éè¿éè¿ BeanPostProcessoræ©å±çAwareæºå¶è°ç¨)</li>
<li>è®¾ç½® beanFactory åºååID, åç§°</li>
<li>æ©å±ç¹, å®å¶åè¿ä¸ª BeanFactory ä¾å¦: æ¯å¦åè®¸ BeanDefinition è¦ç; æ¯å¦èªå¨å¤çå¾ªç¯ä¾èµ;</li>
<li>åå»º(XMLè§£æå¨/è¯»åå¨) XmlBeanDefinitionReader, å¹¶åå§å; çä¸æ©å±ç¹, æ©å±Reader ä¾å¦ æ¯å¦éªè¯xmlç­</li>
<li>åå»ºç¸å³å¯¹è±¡DocumentLoader, BeanDefinitionDocumentReader,BeanDefinitionParserDelegate {@link org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions(org.w3c.dom.Document, org.springframework.core.io.Resource)}<br>
{@link DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions(Element)}<br>
å è½½/è§£æ XMLæ ç­¾/åç´ /å±æ§ç­å°å¶å°è£ä¸º ä¸ä¸ªä¸ª BeanDefinition å¯¹è±¡</li>
<li>å° BeanDefinitions æ³¨åå° registry</li>
</ol>
<h2 id="ä¸-beanfactoryé¢åå¤å·¥ä½">ä¸. (BeanFactory)é¢åå¤å·¥ä½</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#prepareBeanFactory</code></p>
<pre><code class="language-java">	/**
	 * Configure the factory's standard context characteristics,
	 * such as the context's ClassLoader and post-processors.
	 * @param beanFactory the BeanFactory to configure
	 */
	protected void prepareBeanFactory(ConfigurableListableBeanFactory beanFactory) {
		// Tell the internal bean factory to use the context's class loader etc.
		/**
		 * ä¸º beanFactory è®¾ç½® bean çç±»å è½½å¨
		 */
		beanFactory.setBeanClassLoader(getClassLoader());
		/**
		 * ä¸º beanFactory è®¾ç½® bean çè¡¨è¾¾å¼(Spring EL)è§£æå¨
		 * é»è®¤é£æ ¼æ¯: `#{var}`  å½ç¶è¿äº åç¼ åç¼é½æ¯å¯ä»¥èªå®ä¹
		 * å³äº (Spring EL)è§£æå¨: StandardBeanExpressionResolver çè®¾è®¡æ¯ç»åä¼äºç»§æ¿, åé¨æä¸¤ä¸ª SpelExpressionParser(çæ­£è§£æç) SpelParserConfiguration(éç½®ç±»)
		 */
		beanFactory.setBeanExpressionResolver(new StandardBeanExpressionResolver(beanFactory.getBeanClassLoader()));

		/**
		 *  ä¸º beanFactory è®¾ç½® PropertyEditorRegistrar
		 *  è¿ä¸ªä¸»è¦ä¸º Bean è®¾ç½®å±æ§çç®¡çç±», æ¯å¦, æ¥æç±»åçæ°æ®: å¯ä»¥æ¯ç¹å®æ ¼å¼çå­ç¬¦ä¸², æ°å­, è¿å¯ä»¥æ¯æ¶é´æ³...
		 *  Spring ä¸º bean å¡«åå±æ§, ä½¿ç¨ BeanWrapperImpl åè£äºä¸ä¸(è£é¥°æ¨¡å¼)
		 *  BeanWrapperImpl å®ç°äº PropertyEditorRegistry, å¯ä»¥å¾éé¢æ³¨å PropertyEditor, å¯ä»¥èªå®ä¹å±æ§çè½¬æ¢, ç¼è¾é»è¾
		 */
		beanFactory.addPropertyEditorRegistrar(new ResourceEditorRegistrar(this, getEnvironment()));

		/**
		 * æ·»å ä¸ä¸ª BeanPostProcessor åè°, ä½ç¨æ¯å¦æBeanå®ç°è¿äºæ¥å£:
		 * (bean instanceof EnvironmentAware || bean instanceof EmbeddedValueResolverAware ||
		 * 				bean instanceof ResourceLoaderAware || bean instanceof ApplicationEventPublisherAware ||
		 * 				bean instanceof MessageSourceAware || bean instanceof ApplicationContextAware ||
		 * 				bean instanceof ApplicationStartupAware)
		 *  å®è´è´£è°ç¨å¶å¯¹åº Aware çæ¹æ³, ç»Bean æ³¨å¥å¯¹è±¡
		 *
		 * in short å°±æ¯ç» bean è®¾ç½® ä¸ä¸æ, åç½®çå¯¹è±¡; æ³¨ææ¯ (postProcessBeforeInitialization)
		 */
		// Configure the bean factory with context callbacks.
		beanFactory.addBeanPostProcessor(new ApplicationContextAwareProcessor(this));

		/**
		 * å ä¸ºä¸é¢ç± ApplicationContextAwareProcessor è´è´£æ³¨å¥ 7ä¸ªæ¥å£
		 * è¿éå°±å¿½ç¥æè¿7ä¸ªæ¥å£çèªå¨æ³¨å¥
		 * 		EnvironmentAware.class, EmbeddedValueResolverAware.class, ResourceLoaderAware.class,
		 * 		ApplicationEventPublisherAware.class, MessageSourceAware.class, ApplicationContextAware.class, ApplicationStartupAware.class
		 */
		beanFactory.ignoreDependencyInterface(EnvironmentAware.class);
		beanFactory.ignoreDependencyInterface(EmbeddedValueResolverAware.class);
		beanFactory.ignoreDependencyInterface(ResourceLoaderAware.class);
		beanFactory.ignoreDependencyInterface(ApplicationEventPublisherAware.class);
		beanFactory.ignoreDependencyInterface(MessageSourceAware.class);
		beanFactory.ignoreDependencyInterface(ApplicationContextAware.class);
		beanFactory.ignoreDependencyInterface(ApplicationStartupAware.class);

		/**
		 * ç±»ä¼¼ @Primary, å½æå¤ä¸ªçç¸åç±»åçæ¶å, æå®è°ä¼åæ³¨å¥
		 * æå®åç½®ç BeanFactory,ResourceLoader,ApplicationEventPublisher,ApplicationContext
		 *  å ä¸ªBeanå¯¹è±¡,  èªå¨æ³¨å¥ç Primary
		 * registerResolvableDependency
		 */
		// BeanFactory interface not registered as resolvable type in a plain factory.
		// MessageSource registered (and found for autowiring) as a bean.
		beanFactory.registerResolvableDependency(BeanFactory.class, beanFactory);
		beanFactory.registerResolvableDependency(ResourceLoader.class, this);
		beanFactory.registerResolvableDependency(ApplicationEventPublisher.class, this);
		beanFactory.registerResolvableDependency(ApplicationContext.class, this);

		// Register early post-processor for detecting inner beans as ApplicationListeners.
		/**
		 * TODO æ¶é´çå¬å¨ç¸å³
		 */
		beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(this));

		/**
		 * TODO  è¿éæ¯ AOP AspectJå¤ç
		 * LoadTimeWeaver (AOPçå è½½æ¶ç»å¥)
		 */
		// Detect a LoadTimeWeaver and prepare for weaving, if found.
		if (!NativeDetector.inNativeImage() &amp;&amp; beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) {
			beanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory));
			// Set a temporary ClassLoader for type matching.
			beanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));
		}

		/**
		 * beanFactory ä¸­å¦ææ²¡æä»¥ä¸è¿äºåç§°ç bean å ç´æ¥ç» BeanFactory çä¸çº§ç¼å­, æ³¨åå ä¸ªé»è®¤ç¯å¢ Bean
		 */
		// Register default environment beans.
		if (!beanFactory.containsLocalBean(ENVIRONMENT_BEAN_NAME)) {
			beanFactory.registerSingleton(ENVIRONMENT_BEAN_NAME, getEnvironment());
		}
		if (!beanFactory.containsLocalBean(SYSTEM_PROPERTIES_BEAN_NAME)) {
			beanFactory.registerSingleton(SYSTEM_PROPERTIES_BEAN_NAME, getEnvironment().getSystemProperties());
		}
		if (!beanFactory.containsLocalBean(SYSTEM_ENVIRONMENT_BEAN_NAME)) {
			beanFactory.registerSingleton(SYSTEM_ENVIRONMENT_BEAN_NAME, getEnvironment().getSystemEnvironment());
		}
		if (!beanFactory.containsLocalBean(APPLICATION_STARTUP_BEAN_NAME)) {
			beanFactory.registerSingleton(APPLICATION_STARTUP_BEAN_NAME, getApplicationStartup());
		}
	}
</code></pre>
<h3 id="æ»ç»-3">æ»ç»</h3>
<p>{@link AbstractApplicationContext#prepareBeanFactory(ConfigurableListableBeanFactory)}</p>
<ol>
<li>ä¸º beanFactory è®¾ç½® bean çç±»å è½½å¨</li>
<li>ä¸º beanFactory è®¾ç½® bean ç StandardBeanExpressionResolver (è¡¨è¾¾å¼(Spring EL)è§£æå¨) {@link ConfigurableBeanFactory#setBeanExpressionResolver(BeanExpressionResolver)}<br>
å³äº (Spring EL)è§£æå¨: StandardBeanExpressionResolver çè®¾è®¡æ¯ç»åä¼äºç»§æ¿, åé¨æä¸¤ä¸ª SpelExpressionParser(çæ­£è§£æç) SpelParserConfiguration(éç½®ç±»)</li>
<li>ä¸º beanFactory è®¾ç½® PropertyEditorRegistrar (ä¸»è¦ä¸º Bean è®¾ç½®å±æ§çç®¡çç±»){@link ConfigurableBeanFactory#addPropertyEditorRegistrar(PropertyEditorRegistrar)}<br>
PropertyEditorRegistrar è¿ä¸ªä¸»è¦ä¸º Bean è®¾ç½®å±æ§çç®¡çç±», æ¯å¦, æ¥æç±»åçæ°æ®: å¯ä»¥æ¯ç¹å®æ ¼å¼çå­ç¬¦ä¸², æ°å­, è¿å¯ä»¥æ¯æ¶é´æ³...<br>
Spring ä¸º bean å¡«åå±æ§, ä½¿ç¨ BeanWrapperImpl åè£äºä¸ä¸(è£é¥°æ¨¡å¼)<br>
BeanWrapperImpl å®ç°äº PropertyEditorRegistry, å¯ä»¥å¾éé¢æ³¨å PropertyEditor, å¯ä»¥èªå®ä¹å±æ§çè½¬æ¢, ç¼è¾é»è¾</li>
<li>ç» beanFactory æ·»å ä¸ä¸ª å¤çAwareç BeanPostProcessor (ApplicationContextAwareProcessor) å¹¶å¿½ç¥æè¿7ä¸ªæ¥å£çèªå¨æ³¨å¥:{@link ConfigurableBeanFactory#addBeanPostProcessor(BeanPostProcessor)}<br>
EnvironmentAware.class, EmbeddedValueResolverAware.class, ResourceLoaderAware.class, ApplicationEventPublisherAware.class, MessageSourceAware.class, ApplicationContextAware.class, ApplicationStartupAware.class</li>
<li>æå®åç½®ç BeanFactory,ResourceLoader,ApplicationEventPublisher,ApplicationContext {@link ConfigurableListableBeanFactory#registerResolvableDependency(Class, Object)}<br>
è¿å ä¸ªBeanå¯¹è±¡,  èªå¨æ³¨å¥ç Primary</li>
<li>ç» beanFactory æ·»å ä¸ä¸ª BeanPostProcessor (ApplicationListenerDetector)TODO (äºä»¶çå¬ç¸å³)</li>
<li>ç» beanFactory æ·»å ä¸ä¸ª BeanPostProcessor(LoadTimeWeaverAwareProcessor) TODO (AOP AspectJ ç»å¥å¤çç¸å³ç)</li>
<li>beanFactoryä¸­å¦ææ²¡æä»¥ä¸åç§°çbean, åç´æ¥ç» BeanFactory çä¸çº§ç¼å­, æ³¨åå ä¸ªç¯å¢å¯¹è±¡ Bean {@link SingletonBeanRegistry#registerSingleton(String, Object)}<br>
åç§°å¸¸éåå«æ¯:<br>
org.springframework.context.ConfigurableApplicationContext#ENVIRONMENT_BEAN_NAME<br>
org.springframework.context.ConfigurableApplicationContext#SYSTEM_PROPERTIES_BEAN_NAME<br>
org.springframework.context.ConfigurableApplicationContext#SYSTEM_ENVIRONMENT_BEAN_NAME<br>
org.springframework.context.ConfigurableApplicationContext#APPLICATION_STARTUP_BEAN_NAME</li>
</ol>
<h2 id="å-postprocessbeanfactory-æ©å±ç¹è°ç¨">å. postProcessBeanFactory æ©å±ç¹è°ç¨</h2>
<p>beanFactory å·²ç»åå¤å¥½äº, ç»å­ç±»(Context)é¢çä¸ä¸ªæ©å±ç¹;</p>
<p><code>org.springframework.context.support.AbstractApplicationContext#postProcessBeanFactory</code> (è¿éæ¯ç©ºå®ç°)</p>
<pre><code class="language-java">/**
 * Modify the application context's internal bean factory after its standard
 * initialization. The initial definition resources will have been loaded but no
 * post-processors will have run and no derived bean definitions will have been
 * registered, and most importantly, no beans will have been instantiated yet.
 * &lt;p&gt;This template method allows for registering special BeanPostProcessors
 * etc in certain AbstractApplicationContext subclasses.
 * @param beanFactory the bean factory used by the application context
 */
protected void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {
}
</code></pre>
<h2 id="äº-è°ç¨-beanfactorypostprocessor-å¤çå¨">äº. è°ç¨ BeanFactoryPostProcessor å¤çå¨</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#invokeBeanFactoryPostProcessors</code></p>
<pre><code class="language-java">/**
	 * Instantiate and invoke all registered BeanFactoryPostProcessor beans,
	 * respecting explicit order if given.
	 * &lt;p&gt;Must be called before singleton instantiation.
	 */
	protected void invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory beanFactory) {
		/**
		 * è°ç¨ BeanFactory åçææ BeanFactoryPostProcessor å BeanDefinitionRegistryPostProcessor
		 */
		PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());

		/**
		 * LOAD_TIME_WEAVER_BEAN_NAME bean æ¯AOPç¸å³ç.
		 * å¨ GraalVM ä¸­è½ç¼è¯ä¸ºæ¬å°ä»£ç , ä¸æ¯æAOPç
		 */
		// Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime
		// (e.g. through an @Bean method registered by ConfigurationClassPostProcessor)
		if (!NativeDetector.inNativeImage() &amp;&amp; beanFactory.getTempClassLoader() == null &amp;&amp;
				beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) {//è¿é beanFactory ä¸åå« LOAD_TIME_WEAVER_BEAN_NAME
			beanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory));
			beanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));
		}
	}
</code></pre>
<p><code>org.springframework.context.support.PostProcessorRegistrationDelegate#invokeBeanFactoryPostProcessors(org.springframework.beans.factory.config.ConfigurableListableBeanFactory, java.util.List&lt;org.springframework.beans.factory.config.BeanFactoryPostProcessor&gt;)</code></p>
<pre><code class="language-java">	/**
	 * æ³¨æä¸ç¹ BeanDefinitionRegistryPostProcessor æ¯ç»§æ¿èª BeanFactoryPostProcessorç
	 * æ»çæ¥è¯´, è°ç¨çæ¶åä¼åçº§æ¯:
	 * 1. è°ç¨æ¥å£çä¼åçº§
	 * ä¼åè°ç¨(å­ç±») BeanDefinitionRegistryPostProcessor
	 * åè°ç¨(ç¶ç±») BeanFactoryPostProcessor
	 *
	 * 2. è°ç¨æ·»å çæ¹å¼çä¼åçº§
	 * ä¼åè°ç¨å¤é¨å¥åç±», å³ç´æ¥éè¿ {@link AbstractApplicationContext#addBeanFactoryPostProcessor(org.springframework.beans.factory.config.BeanFactoryPostProcessor)} ä»£ç æ·»å ç
	 * åè°ç¨å®¹å¨ä¸­ å®ç° BeanFactoryPostProcessoræè BeanDefinitionRegistryPostProcessor ç Bean
	 */
	public static void invokeBeanFactoryPostProcessors(
			ConfigurableListableBeanFactory beanFactory, List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors) {

		// WARNING: Although it may appear that the body of this method can be easily
		// refactored to avoid the use of multiple loops and multiple lists, the use
		// of multiple lists and multiple passes over the names of processors is
		// intentional. We must ensure that we honor the contracts for PriorityOrdered
		// and Ordered processors. Specifically, we must NOT cause processors to be
		// instantiated (via getBean() invocations) or registered in the ApplicationContext
		// in the wrong order.
		//
		// Before submitting a pull request (PR) to change this method, please review the
		// list of all declined PRs involving changes to PostProcessorRegistrationDelegate
		// to ensure that your proposal does not result in a breaking change:
		// https://github.com/spring-projects/spring-framework/issues?q=PostProcessorRegistrationDelegate+is%3Aclosed+label%3A%22status%3A+declined%22

		// Invoke BeanDefinitionRegistryPostProcessors first, if any.
		/**
		 * å­å¨å·²ç»è°ç¨ BeanDefinitionRegistryPostProcessor è¿ç bean name
		 * é¿åéå¤å¤ç
		 */
		Set&lt;String&gt; processedBeans = new HashSet&lt;&gt;();

		if (beanFactory instanceof BeanDefinitionRegistry registry) {

			/**
			 * å­å¨ BeanFactoryPostProcessor çéå, åé¢ç»ä¸è°ç¨
			 */
			List&lt;BeanFactoryPostProcessor&gt; regularPostProcessors = new ArrayList&lt;&gt;();

			/**
			 * å­å¨å·²ç»è°ç¨è¿ç BeanDefinitionRegistryPostProcessor éå
			 */
			List&lt;BeanDefinitionRegistryPostProcessor&gt; registryProcessors = new ArrayList&lt;&gt;();

			/**
			 * åè°ç¨å¤é¨å¥åç BeanDefinitionRegistryPostProcessor (ä»£ç æ·»å ç)
			 */
			for (BeanFactoryPostProcessor postProcessor : beanFactoryPostProcessors) {
				if (postProcessor instanceof BeanDefinitionRegistryPostProcessor registryProcessor) {
					// è¿å°±è°äº
					registryProcessor.postProcessBeanDefinitionRegistry(registry);
					// æ¯ BeanDefinitionRegistryPostProcessor æ¥å£ å­å¥registryProcessors
					registryProcessors.add(registryProcessor);
				}
				else {
					// ä¸æ¯ BDRPP  æ¯ BeanFactoryPostProcessor(BFPP) å­å¥regularPostProcessors, åé¢å¨ç»ä¸è°ç¨
					regularPostProcessors.add(postProcessor);
				}
			}

			// Do not initialize FactoryBeans here: We need to leave all regular beans
			// uninitialized to let the bean factory post-processors apply to them!
			// Separate between BeanDefinitionRegistryPostProcessors that implement
			// PriorityOrdered, Ordered, and the rest.
			/**
			 * å½åå°è°ç¨ç BeanDefinitionRegistryPostProcessor éå
			 */
			List&lt;BeanDefinitionRegistryPostProcessor&gt; currentRegistryProcessors = new ArrayList&lt;&gt;();

			// First, invoke the BeanDefinitionRegistryPostProcessors that implement PriorityOrdered.
			// 1. åè°ç¨ å®ç°PriorityOrdered (æåº)ç BDRPP
			String[] postProcessorNames =
					beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);
			for (String ppName : postProcessorNames) {
				if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) {
					//&lt;!&gt; beanFactory.getBean, åèµ°å®ä¾åbeanæµç¨;
					currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));
					processedBeans.add(ppName);
				}
			}
			//æåº
			sortPostProcessors(currentRegistryProcessors, beanFactory);
			registryProcessors.addAll(currentRegistryProcessors);
			//è°ç¨ BDRPP
			invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());
			//è°å®äºå°±æ¸è°
			currentRegistryProcessors.clear();

			// Next, invoke the BeanDefinitionRegistryPostProcessors that implement Ordered.
			// 2. åè°ç¨ å®ç° Ordered (æåº)ç BDRPP
			postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);
			for (String ppName : postProcessorNames) {
				if (!processedBeans.contains(ppName) &amp;&amp; beanFactory.isTypeMatch(ppName, Ordered.class)) {
					currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));
					processedBeans.add(ppName);
				}
			}
			sortPostProcessors(currentRegistryProcessors, beanFactory);
			registryProcessors.addAll(currentRegistryProcessors);
			invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());
			currentRegistryProcessors.clear();

			// Finally, invoke all other BeanDefinitionRegistryPostProcessors until no further ones appear.
			// 3. åè°ç¨å¨å®¹å¨ä¸­å®ç° BeanDefinitionRegistryPostProcessors (BDRPP)ç
			boolean reiterate = true;
			while (reiterate) {
				reiterate = false;
				postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);
				for (String ppName : postProcessorNames) {
					if (!processedBeans.contains(ppName)) {
						currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));
						processedBeans.add(ppName);
						reiterate = true;
					}
				}
				sortPostProcessors(currentRegistryProcessors, beanFactory);
				registryProcessors.addAll(currentRegistryProcessors);
				invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());
				currentRegistryProcessors.clear();
			}
			// Now, invoke the postProcessBeanFactory callback of all processors handled so far.
			invokeBeanFactoryPostProcessors(registryProcessors, beanFactory);
			// 3. æååè°ç¨BeanFactoryPostProcessor(BFPP)
			invokeBeanFactoryPostProcessors(regularPostProcessors, beanFactory);
		}

		else {
			// Invoke factory processors registered with the context instance.
			invokeBeanFactoryPostProcessors(beanFactoryPostProcessors, beanFactory);
		}

		// Do not initialize FactoryBeans here: We need to leave all regular beans
		// uninitialized to let the bean factory post-processors apply to them!
		String[] postProcessorNames =
				beanFactory.getBeanNamesForType(BeanFactoryPostProcessor.class, true, false);

		// Separate between BeanFactoryPostProcessors that implement PriorityOrdered,
		// Ordered, and the rest.
		List&lt;BeanFactoryPostProcessor&gt; priorityOrderedPostProcessors = new ArrayList&lt;&gt;();
		List&lt;String&gt; orderedPostProcessorNames = new ArrayList&lt;&gt;();
		List&lt;String&gt; nonOrderedPostProcessorNames = new ArrayList&lt;&gt;();
		for (String ppName : postProcessorNames) {
			if (processedBeans.contains(ppName)) {
				// skip - already processed in first phase above
			}
			else if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) {
				priorityOrderedPostProcessors.add(beanFactory.getBean(ppName, BeanFactoryPostProcessor.class));
			}
			else if (beanFactory.isTypeMatch(ppName, Ordered.class)) {
				orderedPostProcessorNames.add(ppName);
			}
			else {
				nonOrderedPostProcessorNames.add(ppName);
			}
		}

		// First, invoke the BeanFactoryPostProcessors that implement PriorityOrdered.
		sortPostProcessors(priorityOrderedPostProcessors, beanFactory);
		invokeBeanFactoryPostProcessors(priorityOrderedPostProcessors, beanFactory);

		// Next, invoke the BeanFactoryPostProcessors that implement Ordered.
		List&lt;BeanFactoryPostProcessor&gt; orderedPostProcessors = new ArrayList&lt;&gt;(orderedPostProcessorNames.size());
		for (String postProcessorName : orderedPostProcessorNames) {
			orderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));
		}
		sortPostProcessors(orderedPostProcessors, beanFactory);
		invokeBeanFactoryPostProcessors(orderedPostProcessors, beanFactory);

		// Finally, invoke all other BeanFactoryPostProcessors.
		List&lt;BeanFactoryPostProcessor&gt; nonOrderedPostProcessors = new ArrayList&lt;&gt;(nonOrderedPostProcessorNames.size());
		for (String postProcessorName : nonOrderedPostProcessorNames) {
			nonOrderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));
		}
		invokeBeanFactoryPostProcessors(nonOrderedPostProcessors, beanFactory);

		// Clear cached merged bean definitions since the post-processors might have
		// modified the original metadata, e.g. replacing placeholders in values...
		beanFactory.clearMetadataCache();
	}
</code></pre>
<h3 id="æ»ç»-4">æ»ç»</h3>
<p>è¥æ¯æ³¨åçbean definition å®ç°äºè¿ä¸¤ä¸ªæ¥å£, åä¼è°ç¨(getBean)å®ä¾åå®, åè°ç¨ç¸åºçæ¥å£æ¹æ³;<br>
(æ³¨æä¸ä¸ BeanDefinitionRegistryPostProcessor æ¯ç»§æ¿èª BeanFactoryPostProcessorç)<br>
æ»çæ¥è¯´ è°ç¨çä¼åçº§æ¯:</p>
<ol>
<li>è°ç¨æ¥å£çä¼åçº§:
<ol>
<li>ä¼åè°ç¨(å­ç±») BeanDefinitionRegistryPostProcessor</li>
<li>åè°ç¨(ç¶ç±») BeanFactoryPostProcessor</li>
</ol>
</li>
<li>è°ç¨æ·»å çæ¹å¼çä¼åçº§:
<ol>
<li>ä¼åè°ç¨å¤é¨å¥å, å³ç´æ¥éè¿{@link AbstractApplicationContext#addBeanFactoryPostProcessor(org.springframework.beans.factory.config.BeanFactoryPostProcessor)} ä»£ç æ·»å ç</li>
<li>åè°ç¨å®¹å¨ä¸­å®ç° BeanFactoryPostProcessor æè BeanDefinitionRegistryPostProcessor ç Bean<br>
è§:</li>
</ol>
</li>
</ol>
<blockquote>
<p>å¼å¾ä¸æçæ¯:  Spring å¯¹äºæ¯æ SPELè¡¨è¾¾å¼, å°±æ¯éè¿ <code>PropertySourcesPlaceholderConfigurer</code> è¿ç§æ¹å¼æ©å±å®ç°ç</p>
</blockquote>
<h2 id="å­-æ³¨å-beanpostprocessor-bppå¤çå¨">å­. æ³¨å BeanPostProcessor (BPP)å¤çå¨</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#registerBeanPostProcessors</code><br>
<code>org.springframework.context.support.PostProcessorRegistrationDelegate#registerBeanPostProcessors(org.springframework.beans.factory.config.ConfigurableListableBeanFactory, org.springframework.context.support.AbstractApplicationContext)</code></p>
<pre><code class="language-java">/**
	 *  in short:
	 *  1. æ¿å°ææå®ç° BeanPostProcessor ç bean, ç¶åè¿è¡åç±»å­èµ·æ¥
	 *  è¿æä¸ç¹, Spring å¯¹ BeanDefinition åæä¸ç§è§è²:
	 *  	1. ç¨æ·å®ä¹ç Bean (ROLE_APPLICATION)
	 *      2. è¾å¤æç (ROLE_SUPPORT) è¾å¤æç? éå¸¸æ¯ä¸ä¸ªå¤é¨éç½®
	 *      3. Spring åç½®ç(ROLE_INFRASTRUCTURE)
	 *  2. å¦æå®ç°äº BeanPostProcessor åä¼å®ä¾åè¿ä¸ªbean, ä½æ³¨æè¿éåªæ¯æ³¨å,å¹¶ä¸ä¼è°ç¨BeanPostProcessorçç¸å³æ¹æ³
	 *
	 *  å¦å¤ BeanPostProcessor ç²ç²åº¦å¤ªå¤§, Spring è¿ç»åä¸äºå­æ¥å£:
	 *  - SmartInstantiationAwareBeanPostProcessor å®æä¾äºæ´é«çº§çBeanå®ä¾åæ§å¶æ¹æ³ãä¸»è¦ä½ç¨å¨äºåè®¸å¯¹Beançå®ä¾åè¿ç¨è¿è¡æ´ç²¾ç»çæ§å¶åå®å¶ã
	 *  - MergedBeanDefinitionPostProcessor å¨åå¹¶Beanå®ä¹ï¼MergedBeanDefinitionï¼ä¹åä½å¨å®ä¾åBeanä¹åï¼åè®¸å¯¹åå¹¶åçBeanå®ä¹è¿è¡ä¿®æ¹ãè°æ´æéå åæ°æ®ã
	 *  - DestructionAwareBeanPostProcessor å®åè®¸å¨Beanè¢«éæ¯ä¹åï¼ä¾å¦ï¼å®¹å¨å³é­æç¹å®ä½ç¨åçBeanéæ¯ï¼æ§è¡ä¸äºæä½ã
	 */
	public static void registerBeanPostProcessors(
			ConfigurableListableBeanFactory beanFactory, AbstractApplicationContext applicationContext) {

		// WARNING: Although it may appear that the body of this method can be easily
		// refactored to avoid the use of multiple loops and multiple lists, the use
		// of multiple lists and multiple passes over the names of processors is
		// intentional. We must ensure that we honor the contracts for PriorityOrdered
		// and Ordered processors. Specifically, we must NOT cause processors to be
		// instantiated (via getBean() invocations) or registered in the ApplicationContext
		// in the wrong order.
		//
		// Before submitting a pull request (PR) to change this method, please review the
		// list of all declined PRs involving changes to PostProcessorRegistrationDelegate
		// to ensure that your proposal does not result in a breaking change:
		// https://github.com/spring-projects/spring-framework/issues?q=PostProcessorRegistrationDelegate+is%3Aclosed+label%3A%22status%3A+declined%22
		/**
		 * æ¿å°ææå®ç° BeanPostProcessor ç beanåç§°
		 */
		String[] postProcessorNames = beanFactory.getBeanNamesForType(BeanPostProcessor.class, true, false);

		// Register BeanPostProcessorChecker that logs an info message when
		// a bean is created during BeanPostProcessor instantiation, i.e. when
		// a bean is not eligible for getting processed by all BeanPostProcessors.
		/**
		 * è®¡ç® BeanPostProcessor(BPP) çæ»æ°.
		 * +1 æ¯ä»ä¹æä½? åå æ¯: ä¸ä¸è¡,åå äºä¸ä¸ª BeanPostProcessorChecker
		 */
		int beanProcessorTargetCount = beanFactory.getBeanPostProcessorCount() + 1 + postProcessorNames.length;
		// BeanPostProcessorChecker è¿ä¸ªBeanPostProcessor, æ²¡å¥å®éä½ç¨, å°±æ¯è®°å½äºä¸äºæ¥å¿;
		beanFactory.addBeanPostProcessor(
				new BeanPostProcessorChecker(beanFactory, postProcessorNames, beanProcessorTargetCount));
		// Separate between BeanPostProcessors that implement PriorityOrdered,
		// Ordered, and the rest.
		/**
		 * å¯¹ BeanPostProcessor è¿è¡åç±»å­èµ·æ¥,  åè°ç¨, æ¯ä¸ªéååå«æ¯
		 * 1. priorityOrderedPostProcessors //æå®ç°(PriorityOrdered)æåºæ¥å£ç
		 * 2. internalPostProcessors //Springåé¨çbean, è§: Springå°beanåä¸ºä¸ç§è§è²
		 * 3. orderedPostProcessorNames //å®ç° Ordered æ¥å£
		 * 4. nonOrderedPostProcessorNames //æ²¡ææå®é¡ºåº, æ åºç
		 */
		List&lt;BeanPostProcessor&gt; priorityOrderedPostProcessors = new ArrayList&lt;&gt;();
		List&lt;BeanPostProcessor&gt; internalPostProcessors = new ArrayList&lt;&gt;();
		List&lt;String&gt; orderedPostProcessorNames = new ArrayList&lt;&gt;();
		List&lt;String&gt; nonOrderedPostProcessorNames = new ArrayList&lt;&gt;();
		for (String ppName : postProcessorNames) {
			if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) {
				/**
				 * æ³¨æ, è¥ bean å®ç°äº PriorityOrdered æ¥å£, åä¼ä¼åå®ä¾åå®;
				 */
				BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);
				priorityOrderedPostProcessors.add(pp);
				if (pp instanceof MergedBeanDefinitionPostProcessor) {
					internalPostProcessors.add(pp);
				}
			}
			else if (beanFactory.isTypeMatch(ppName, Ordered.class)) {
				orderedPostProcessorNames.add(ppName);
			}
			else {
				nonOrderedPostProcessorNames.add(ppName);
			}
		}

		// First, register the BeanPostProcessors that implement PriorityOrdered.
		sortPostProcessors(priorityOrderedPostProcessors, beanFactory);
		registerBeanPostProcessors(beanFactory, priorityOrderedPostProcessors);

		// Next, register the BeanPostProcessors that implement Ordered.
		List&lt;BeanPostProcessor&gt; orderedPostProcessors = new ArrayList&lt;&gt;(orderedPostProcessorNames.size());
		for (String ppName : orderedPostProcessorNames) {
			BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);
			orderedPostProcessors.add(pp);
			if (pp instanceof MergedBeanDefinitionPostProcessor) {
				internalPostProcessors.add(pp);
			}
		}
		sortPostProcessors(orderedPostProcessors, beanFactory);
		registerBeanPostProcessors(beanFactory, orderedPostProcessors);

		/**
		 * æ³¨åææå¸¸è§BeanPostProcessors
		 * è¿é getBean å®ä¾åbean !;
		 */
		// Now, register all regular(å¸¸è§) BeanPostProcessors.
		List&lt;BeanPostProcessor&gt; nonOrderedPostProcessors = new ArrayList&lt;&gt;(nonOrderedPostProcessorNames.size());
		for (String ppName : nonOrderedPostProcessorNames) {
			BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);
			nonOrderedPostProcessors.add(pp);
			if (pp instanceof MergedBeanDefinitionPostProcessor) {
				internalPostProcessors.add(pp);
			}
		}
		registerBeanPostProcessors(beanFactory, nonOrderedPostProcessors);

		/**
		 * æå, æ³¨åææ åç½® BeanPostProcessor
		 */
		// Finally, re-register all internal BeanPostProcessors.
		sortPostProcessors(internalPostProcessors, beanFactory);
		registerBeanPostProcessors(beanFactory, internalPostProcessors);

		//æååæ¾ä¸ä¸ª ApplicationListenerDetector è®©å®å¨æå (ä¸æ¯éç¹, è§ååºè¯¥æ¯äºä»¶ç¸å³ç)
		// Re-register post-processor for detecting inner beans as ApplicationListeners,
		// moving it to the end of the processor chain (for picking up proxies etc).
		beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(applicationContext));
	}
</code></pre>
<h3 id="æ»ç»-5">æ»ç»</h3>
<ol>
<li>æ¿å°ææ BeanPostProcessor ç±»åç bean</li>
<li>å®ä¾å BeanPostProcessor<br>
ä¼åå®ä¾å å®ç°äº PriorityOrdered æ¥å£ç, å¨å®ä¾åå¶å®ç(BPP)</li>
<li>è¿è¡åç±»å­å°éå {@link PostProcessorRegistrationDelegate#registerBeanPostProcessors(ConfigurableListableBeanFactory, AbstractApplicationContext)}<br>
å¯¹ BeanPostProcessor è¿è¡åç±»å­èµ·æ¥,  åè°ç¨, æ¯ä¸ªéååå«æ¯
<ol>
<li>priorityOrderedPostProcessors //æå®ç°(PriorityOrdered)æåºæ¥å£ç</li>
<li>internalPostProcessors //Springåé¨çbean, è§: Springå°beanåä¸ºä¸ç§è§è²</li>
<li>orderedPostProcessorNames //å®ç° Ordered æ¥å£</li>
<li>nonOrderedPostProcessorNames //æ²¡ææå®é¡ºåº, æ åºç<br>
è¿æä¸ç¹, Spring å¯¹ BeanDefinition åæä¸ç§è§è²:
<ul>
<li>ç¨æ·å®ä¹ç ä¸å¡ç¸å³ç Bean Bean (ROLE_APPLICATION)</li>
<li>è¾å¤æç (ROLE_SUPPORT) è¾å¤æç, æ¯æ AOPãäºå¡ç­åè½çåé¨å®ç°?  (ä¸éè¦, ä¸è¦æ¯ä¸ä¸ªç»èé½æ£...)</li>
<li>Spring åç½®ç(ROLE_INFRASTRUCTURE)</li>
</ul>
</li>
</ol>
</li>
<li>æåºå¹¶æ³¨åå° beanFactory
<ol>
<li>è¿éæå®ç°(PriorityOrdered)æåºæ¥å£çã@Orderedæ³¨è§£ç ç­æåºå­èµ·æ¥. å®éè°ç¨çé¡ºåº å¶å®å°±æ¯å­èµ·æ¥çé¡ºåº</li>
<li>å¦å¤ BeanPostProcessor æ¥å£ç²ç²åº¦å¤ªå¤§äº, Spring è¿ç»åä¸äºå­æ¥å£:
<ol>
<li>SmartInstantiationAwareBeanPostProcessor å®æä¾äºæ´é«çº§çBeanå®ä¾åæ§å¶æ¹æ³ãä¸»è¦ä½ç¨å¨äºåè®¸å¯¹Beançå®ä¾åè¿ç¨è¿è¡æ´ç²¾ç»çæ§å¶åå®å¶ã</li>
<li>MergedBeanDefinitionPostProcessor å¨åå¹¶Beanå®ä¹ï¼MergedBeanDefinitionï¼ä¹åä½å¨å®ä¾åBeanä¹åï¼åè®¸å¯¹åå¹¶åçBeanå®ä¹è¿è¡ä¿®æ¹ãè°æ´æéå åæ°æ®ã</li>
<li>DestructionAwareBeanPostProcessor å®åè®¸å¨Beanè¢«éæ¯ä¹åï¼ä¾å¦ï¼å®¹å¨å³é­æç¹å®ä½ç¨åçBeanéæ¯ï¼æ§è¡ä¸äºæä½ã<br>
ç­ç­ä»¥ä¸ä¹ä¼å­èµ·æ¥</li>
</ol>
</li>
</ol>
</li>
<li>æç»è°ç¨ BPPæ¯å¨ {@link AbstractApplicationContext#finishBeanFactoryInitialization(ConfigurableListableBeanFactory)} å®ä¾åå§åå¶ä»Beanè°ç¨</li>
</ol>
<h2 id="ä¸-åå§åå½éåi18n-ä¿¡æ¯æº">ä¸. åå§åå½éå(I18N) ä¿¡æ¯æº</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#initMessageSource</code></p>
<pre><code class="language-java">/**
	 * Initialize the MessageSource.
	 * Use parent's if none defined in this context.
	 * ä¸»è¦æ¯å¯¹I18Nå½éåçå¤çï¼
	 */
	protected void initMessageSource() {
		/**
		 * //æ¿å° bean factory
		 */
		ConfigurableListableBeanFactory beanFactory = getBeanFactory();
		/**
		 * æ¯å¦æå®ä¹åç§°ä¸º MESSAGE_SOURCE_BEAN_NAME ç Bean
		 *  {@link org.springframework.context.support.AbstractApplicationContext#MESSAGE_SOURCE_BEAN_NAME }
		 */
		if (beanFactory.containsLocalBean(MESSAGE_SOURCE_BEAN_NAME)) {
			this.messageSource = beanFactory.getBean(MESSAGE_SOURCE_BEAN_NAME, MessageSource.class);
			// Make MessageSource aware of parent MessageSource.
			if (this.parent != null &amp;&amp; this.messageSource instanceof HierarchicalMessageSource hms &amp;&amp;
					hms.getParentMessageSource() == null) {
				// Only set parent context as parent MessageSource if no parent MessageSource
				// registered already.
				/**
				 * å¦ææçè¯ï¼å°±ä½¿ç¨è¯¥å®ä¹çMessageSource å¤çæ¶æ¯å½éå
				 */
				hms.setParentMessageSource(getInternalParentMessageSource());
			}
			if (logger.isTraceEnabled()) {
				logger.trace("Using MessageSource [" + this.messageSource + "]");
			}
		}
		else {
			/**
			 *  å¦ææ²¡æ MESSAGE_SOURCE_BEAN_NAME åé»è®¤ä½¿ç¨ DelegatingMessageSource;
			 *  æ³¨åå° beanFactory
			 */
			// Use empty MessageSource to be able to accept getMessage calls.
			DelegatingMessageSource dms = new DelegatingMessageSource();
			dms.setParentMessageSource(getInternalParentMessageSource());
			//æ³¨æè¿ Contextå±æ§
			this.messageSource = dms;
			beanFactory.registerSingleton(MESSAGE_SOURCE_BEAN_NAME, this.messageSource);
			if (logger.isTraceEnabled()) {
				logger.trace("No '" + MESSAGE_SOURCE_BEAN_NAME + "' bean, using [" + this.messageSource + "]");
			}
		}
	}
</code></pre>
<h3 id="æ»ç»-6">æ»ç»</h3>
<p>å¾ç®å:</p>
<ol>
<li>å¦æbeanFactoryä¸­æåç§°ä¸º messageSource çBeanå®ä¹ï¼å°±ä½¿ç¨è¿beanä½ç©å½éåæ¶æ¯æº<br>
å¦ææ²¡æåé»è®¤ä½¿ç¨ org.springframework.context.support.DelegatingMessageSource å¹¶æ³¨åå° beanFactory</li>
</ol>
<p><s>ç¨äºå½éåç, ä¸éè¦, æ¬å±ä½ä¸ºç¤¾ä¼åºå±çé©¬, ææªåè¿è·¨å½é¡¹ç®</s></p>
<h2 id="å«-åå§åäºä»¶å¤æ­å¨">å«. åå§åäºä»¶å¤æ­å¨</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#initApplicationEventMulticaster</code></p>
<pre><code class="language-java">	/**
	 * Initialize the ApplicationEventMulticaster.
	 * Uses SimpleApplicationEventMulticaster if none defined in the context.
	 * @see org.springframework.context.event.SimpleApplicationEventMulticaster
	 */
	protected void initApplicationEventMulticaster() {
		ConfigurableListableBeanFactory beanFactory = getBeanFactory();
		/**
		 * 1. å¦æ beanFactory ä¸­åå«åç§°ä¸º APPLICATION_EVENT_MULTICASTER_BEAN_NAMEçbeanå®ä¹, åä½¿ç¨è¿ä¸ª ApplicationEventMulticaster ä½ä¸º äºä»¶å¤æ­å¨
		 * å¦æä¸åå«ååå»º SimpleApplicationEventMulticasterä½ä¸ºäºä»¶å¤æ­å¨;
		 */
		if (beanFactory.containsLocalBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME)) {
			this.applicationEventMulticaster =
					beanFactory.getBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, ApplicationEventMulticaster.class);
			if (logger.isTraceEnabled()) {
				logger.trace("Using ApplicationEventMulticaster [" + this.applicationEventMulticaster + "]");
			}
		}
		else {
			/**
			 * 2. åå»º SimpleApplicationEventMulticaster ä½ä¸ºé»è®¤çäºä»¶å¤æ­å¨ (Event Channel)
			 *  å¶å®å°±æ¯åå§åäºä¸ä¸ª ç¨äºå­æ¾/ç®¡ç ApplicationListener çå¬å¨(è§å¯è)çç±»
			 *   å¨Spring äºä»¶æºå¶ä¸­, å¨å®¹å¨åå¸äºä»¶æ¶ `this.applicationEventMulticaster.multicastEvent(new ObjectEvent());`
			 *  @see org.springframework.context.event.AbstractApplicationEventMulticaster#defaultRetriever ç¨æ·å­æ¾/ç®¡ç åä¸ªçå¬å¨ç(è§å¯è)
			 *  @see AbstractApplicationContext#publishEvent(Object, ResolvableType) è°ç¨å®¹å¨åå¸äºä»¶
			 *
			 *  è¿ä¸ª applicationEventMulticaster é¤äºå¨å®¹å¨åå¸äºä»¶æ¶ç¨å®, å¨æ³¨åçå¬å¨æ¶ç´æ¥ç¨å® {@link AbstractApplicationContext#registerListeners()}
			 */
			this.applicationEventMulticaster = new SimpleApplicationEventMulticaster(beanFactory);
			/**
			 * å°å¶æ³¨åå° beanFactory;
			 * æ³¨æ è¿æ¯å®ä¾, å®ç´æ¥æ¾å°ä¸çº§ç¼å­ä¸­.
			 */
			beanFactory.registerSingleton(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, this.applicationEventMulticaster);
			if (logger.isTraceEnabled()) {
				logger.trace("No '" + APPLICATION_EVENT_MULTICASTER_BEAN_NAME + "' bean, using " +
						"[" + this.applicationEventMulticaster.getClass().getSimpleName() + "]");
			}
		}
	}
</code></pre>
<h3 id="æ»ç»-7">æ»ç»</h3>
<ol>
<li>å¦æ beanFactory ä¸­åå«åç§°ä¸º applicationEventMulticaster çbeanå®ä¹, åä½¿ç¨è¿ä¸ªBeanä½ä¸ºäºä»¶å¤æ­å¨;<br>
å¦æä¸åå«ååå»º SimpleApplicationEventMulticasterä½ä¸ºäºä»¶å¤æ­å¨;</li>
<li>åå»ºSimpleApplicationEventMulticasterå¶å®å°±æ¯åå§åäºä¸ä¸ª,ç¨äºå­æ¾/ç®¡ç ApplicationListener çå¬å¨(è§å¯è)çç±», å¹¶æ³¨åå° beanFactory</li>
</ol>
<ul>
<li>ä¸»è¦æ¯ {@link org.springframework.context.event.AbstractApplicationEventMulticaster#defaultRetriever} ç¨äºå­æ¾/ç®¡ç åä¸ªçå¬å¨ç(è§å¯è)</li>
<li>{@link org.springframework.context.event.SimpleApplicationEventMulticaster#multicastEvent(org.springframework.context.ApplicationEvent, org.springframework.core.ResolvableType) }è°ç¨å®¹å¨åå¸äºä»¶</li>
</ul>
<p>åèæ­¤åçåå®¢ - <a href="https://www.cnblogs.com/dddy/p/19191523" title="åå¸äº 2025-11-04 22:25" target="_blank">Spring ä¸­çEventæºå¶</a></p>
<h2 id="ä¹-ç»å­ç±»contextçä¸ä¸ä¸ªæ©å±ç¹">ä¹. ç»å­ç±»(Context)çä¸ä¸ä¸ªæ©å±ç¹</h2>
<p>æ²¡ä»ä¹å¥½è¯´ç, è¿éæ¯ç©ºå®ç°</p>
<p><code>org.springframework.context.support.AbstractApplicationContext#onRefresh</code></p>
<pre><code class="language-java">/**
 * Template method which can be overridden to add context-specific refresh work.
 * Called on initialization of special beans, before instantiation of singletons.
 * &lt;p&gt;This implementation is empty.
 * @throws BeansException in case of errors
 * @see #refresh()
 */
protected void onRefresh() throws BeansException {
	// For subclasses: do nothing by default.
}
</code></pre>
<h2 id="å-åå¤æ­å¨æ³¨åçå¬å¨">å. åå¤æ­å¨æ³¨åçå¬å¨</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#registerListeners</code></p>
<pre><code class="language-java">/**
	 * Add beans that implement ApplicationListener as listeners.
	 * Doesn't affect other listeners, which can be added without being beans.
	 */
	protected void registerListeners() {
		/**
		 * 1. åå¤æ­å¨ä¸­æ³¨å å¨contextä¸­ççå¬å¨(è§å¯è)
		 */
		// Register statically specified listeners first.
		for (ApplicationListener&lt;?&gt; listener : getApplicationListeners()) {
			getApplicationEventMulticaster().addApplicationListener(listener);
		}

		// Do not initialize FactoryBeans here: We need to leave all regular beans
		// uninitialized to let post-processors apply to them!
		/**
		 *  2. åå¤æ­å¨ä¸­æ³¨å å¨beanFactoryä¸­çbeanæ¯çå¬å¨(ApplicationListener.class)ç(è§å¯è)
		 *  æ³¨æ:
		 *  2.1 è¿éæ¯ä¼åä» BeanFactory (getBeanNamesForType)è·åæ¯ ApplicationListener.class ç bean name
		 *  2.2 æ³¨æåªæ¯æ¥æ¾å¹éç±»åç bean åç§°, æ²¡æå®ä¾å å­çä¹æ¯ bean name;
		 */
		String[] listenerBeanNames = getBeanNamesForType(ApplicationListener.class, true, false);
		for (String listenerBeanName : listenerBeanNames) {
			getApplicationEventMulticaster().addApplicationListenerBean(listenerBeanName);
		}

		/**
		 * 3. å¹¿æ­ this.earlyApplicationEvents å±æ§ä¸­çäºä»¶;
		 * ä¸ºä»ä¹?
		 * å ä¸ºæå¯è½ å¨å®¹å¨çå½å¨æä¸­è°ç¨äºå½å `AbstractApplicationContext#publishEvent` åå¸äºä»¶, ä½æ¯å¤æ­å¨æ²¡æåå§åå®æ, æä»¥ä¼å°äºä»¶å­å¨this.earlyApplicationEvents ä¸­;
		 * å¾å®¹å¨åå§åå®æå, 	å¨æµç¨  {@link org.springframework.context.support.AbstractApplicationContext#registerListeners()} ä¸­ä¼åå¸å­å¨è¿éé¢çäºä»¶
		 * (ä¾å¦: å¨ BeanFactoryPostProcessor çä¸å¡é»è¾è§¦åå®¹å¨çå¹¿æ­äºä»¶, è¿æ¶åå¤æ­å¨é½ä¸å­å¨, ä¹ä¸ç¥éæåªäº beanä½ä¸ºè§å¯è)
		 * @see AbstractApplicationContext#prepareRefresh()
		 */
		// Publish early application events now that we finally have a multicaster...
		Set&lt;ApplicationEvent&gt; earlyEventsToProcess = this.earlyApplicationEvents;
		this.earlyApplicationEvents = null;//ä¸ä¸æ­¥ multicastEvent åå°±æ²¡ç¨äº, èµ null éæ¾èµæº.
		if (!CollectionUtils.isEmpty(earlyEventsToProcess)) {
			for (ApplicationEvent earlyEvent : earlyEventsToProcess) {
				getApplicationEventMulticaster().multicastEvent(earlyEvent);
			}
		}
	}
</code></pre>
<h3 id="æ»ç»-8">æ»ç»</h3>
<ol>
<li>åå¤æ­å¨ä¸­æ³¨å å¨contextä¸­ççå¬å¨(è§å¯è);</li>
<li>åå¤æ­å¨ä¸­æ³¨å å¨beanFactoryä¸­çbeanæ¯çå¬å¨(ApplicationListener.class)ç(è§å¯è)</li>
<li>å¹¿æ­ this.earlyApplicationEvents å±æ§ä¸­çäºä»¶;<br>
ä¸ºä»ä¹?
<ul>
<li>å ä¸ºæå¯è½ å¨å®¹å¨çå½å¨æä¸­è°ç¨äºå½å <code>AbstractApplicationContext#publishEvent</code> åå¸äºä»¶, ä½æ¯å¤æ­å¨æ²¡æåå§åå®æ, æä»¥ä¼å°äºä»¶å­å¨this.earlyApplicationEvents ä¸­;  è¿éå¤æ­å¨å·²ç»åå¤ ä¼åå¸å­å¨è¿éé¢çäºä»¶ (ä¾å¦: å¨ BeanFactoryPostProcessor çä¸å¡é»è¾è§¦åå®¹å¨çå¹¿æ­äºä»¶, è¿æ¶åå¤æ­å¨é½ä¸å­å¨)</li>
</ul>
<ul>
<li>@see AbstractApplicationContext#prepareRefresh()</li>
</ul>
</li>
</ol>
<h2 id="åä¸-å®ä¾åå©ä¸çææåä¾bean">åä¸. å®ä¾åå©ä¸çææåä¾bean</h2>
<h3 id="åå¤ç±»åè½¬æ¢å¨-åéè§£æå¨ç­">åå¤ç±»åè½¬æ¢å¨ åéè§£æå¨ç­</h3>
<p><code>org.springframework.context.support.AbstractApplicationContext#finishBeanFactoryInitialization</code></p>
<pre><code class="language-java">/**
	 * Finish the initialization of this context's bean factory,
	 * initializing all remaining singleton beans.
	 */
	protected void finishBeanFactoryInitialization(ConfigurableListableBeanFactory beanFactory) {
		// Initialize conversion service for this context.
		/**
		 *
		 * 1. ä¸º beanFactory åå§åç±»åè½¬æ¢å¨(ConversionService)
		 *   æ³¨æ: å¨ Spring ä¸­`ConversionService` æ¯ç¨äºç±»åè½¬æ¢çæå¡æ¥å£, å®æ¯è½¬æ¢ç±»åçå¥å£ç¹, ä½æ¯çæ­£çè½¬æ¢é»è¾åè½ åç± Converter å GenericConverter æ¥å£çå®ç°å¤çç
		 */
		if (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp;
				beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) {
			beanFactory.setConversionService(
					beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class));
		}

		// Register a default embedded value resolver if no BeanFactoryPostProcessor
		// (such as a PropertySourcesPlaceholderConfigurer bean) registered any before:
		// at this point, primarily for resolution in annotation attribute values.
		/**
		 * 2. å¦æ beanFactory ä¸ä¸æä¸­ä¸åå« "é»è®¤çåéè§£æå¨ (ç±»ä¼¼ PropertySourcesPlaceholderConfigurer) è§£æç±»ä¼¼ '${}' è¿æ ·çåé "
		 * åä½¿ç¨ç¯å¢å¯¹è±¡(ConfigurableEnvironment)ä¸­ç ConfigurablePropertyResolverå®ç°æ¥ä½ä¸º StringValueResolver æ·»å è¿å»
		 */
		if (!beanFactory.hasEmbeddedValueResolver()) {
			beanFactory.addEmbeddedValueResolver(strVal -&gt; getEnvironment().resolvePlaceholders(strVal));
		}
		// Initialize LoadTimeWeaverAware beans early to allow for registering their transformers early.
		/**
		 * 3. åå®ä¾åå LoadTimeWeaverAware beanï¼ä»¥ä¾¿å°½æ©æ³¨åå®ä»¬çè½¬æ¢å¨ã
		 * TODO AOP ç¸å³ç
		 */
		String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, false, false);
		for (String weaverAwareName : weaverAwareNames) {
			getBean(weaverAwareName);
		}

		// Stop using the temporary ClassLoader for type matching.
		// åæ­¢ä½¿ç¨ä¸´æ¶ClassLoaderè¿è¡ç±»åå¹é
		beanFactory.setTempClassLoader(null);

		// Allow for caching all bean definition metadata, not expecting further changes.
		/**
		 * 4. å»ç»éç½®, è¿æ¶åå°±ä¸ååè®¸æ´æ¹ beanDefinition äº; (å¶å®å°±æ¯ clearMetadataCache å è®¾ç½®äºä¸ä¸ªæ è¯ç¬¦)
		 */
		beanFactory.freezeConfiguration();

		// Instantiate all remaining (non-lazy-init) singletons.
		/**
		 * 5. å®ä¾åææå©ä½ç (élazy-init) åä¾ Bean
		 */
		beanFactory.preInstantiateSingletons();
	}
</code></pre>
<h3 id="å¤ç-factorybean-ç­">å¤ç FactoryBean ç­</h3>
<p><code>org.springframework.beans.factory.support.DefaultListableBeanFactory#preInstantiateSingletons</code></p>
<pre><code class="language-java">@Override
	public void preInstantiateSingletons() throws BeansException {
		if (logger.isTraceEnabled()) {
			logger.trace("Pre-instantiating singletons in " + this);
		}
		// Iterate over a copy to allow for init methods which in turn register new bean definitions.
		// While this may not be part of the regular factory bootstrap, it does otherwise work fine.
		/**
		 *  ææå·²æ³¨åçBean name åè¡¨;
		 *  è¿éå¤å¶ä¸ä»½, æ¹ä¾¿éå;
		 */
		List&lt;String&gt; beanNames = new ArrayList&lt;&gt;(this.beanDefinitionNames);

		// Trigger initialization of all non-lazy singleton beans...
		for (String beanName : beanNames) {
			/**
			 * åå¹¶å°ç¶ç±»ç BeanDefinition å¾å° RootBeanDefinition, æ¾å¥ç¼å­ä¸­.
			 * (æ¯ä¸ä¸ªBeané½æ RootBeanDefinition, æ²¡æçè¯ getMergedLocalBeanDefinition ä¼åå»ºä¸ä¸ª, å¹¶æ¾å¥ç¼å­ä¸­)
			 *
			 * ä¸ºä»ä¹éè¦å¾ä¸ç¼å­ RootBeanDefinition ?
			 * å®ä¾åä¸ä¸ªå¯¹è±¡çæ¶å, è¯å®æ¯åå®ä¾åç¶å¯¹è±¡, æç¶å¯¹è±¡æè½å®ä¾å­å¯¹è±¡
			 */
			RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName);
			//å¦æè¯¥ bean æ¯: éæ½è±¡, æ¯åä¾, éæå è½½
			if (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) {
				/**
				 * å¦æè¯¥beanæ¯ FactoryBean, åå¨ bean name åé¢å ä¸ä¸ª '&amp;' åç¼, åè·å/å®ä¾å FactoryBean æ¬èº«;
				 *  æ³¨æä¸ä¸ FactoryBean çæå¯¹è±¡æ¯ä¸éµå¾ª Spring çbeançå½å¨æç
				 *
				 * è¿æä¸¤ä¸ªå¯¹è±¡, å¦ä½è·å? getBean(beanName) :
				 * 1. ä¼ å¥ FactoryBean ç name è¿åçæ¯å¶ getObject çç®æ å¯¹è±¡å®ä¾;
				 * 2. å¦ææ³è·å FactoryBean æ¬èº«å®ä¾, ååé¢éè¦å ä¸ä¸ª '&amp;' åç¼;
				 *
				 */
				if (isFactoryBean(beanName)) {
					/**
					 * è·å/å®ä¾å factoryBean æ¬èº«
					 */
					Object bean = getBean(FACTORY_BEAN_PREFIX + beanName);
					if (bean instanceof SmartFactoryBean&lt;?&gt; smartFactoryBean
							&amp;&amp; smartFactoryBean.isEagerInit()) {
						/**
						 * å¦ææ¯ SmartFactoryBean å¹¶ä¸ æ¯æ¥å è½½:
						 * ååè·å/å®ä¾åè¯¥ FactoryBean çç®æ å¯¹è±¡
						 */
						getBean(beanName);
					}
				}
				else {
					getBean(beanName);
				}
			}
		}

		// Trigger post-initialization callback for all applicable beans...
		for (String beanName : beanNames) {
			Object singletonInstance = getSingleton(beanName);
			if (singletonInstance instanceof SmartInitializingSingleton smartSingleton) {
				StartupStep smartInitialize = getApplicationStartup().start("spring.beans.smart-initialize")
						.tag("beanName", beanName);
				smartSingleton.afterSingletonsInstantiated();
				smartInitialize.end();
			}
		}
	}
</code></pre>
<h3 id="å°è¯ä»-ä¸-äº-ä¸çº§ç¼å­ä¸­è·å">å°è¯ä» ä¸ äº ä¸çº§ç¼å­ä¸­è·å</h3>
<p><code>org.springframework.beans.factory.support.AbstractBeanFactory#getBean(java.lang.String)</code><br>
<code>org.springframework.beans.factory.support.AbstractBeanFactory#doGetBean</code></p>
<pre><code class="language-java">/**
	 * Return an instance, which may be shared or independent, of the specified bean.
	 * @param name the name of the bean to retrieve
	 * @param requiredType the required type of the bean to retrieve
	 * @param args arguments to use when creating a bean instance using explicit arguments
	 * (only applied when creating a new instance as opposed to retrieving an existing one)
	 * @param typeCheckOnly whether the instance is obtained for a type check,
	 * not for actual use
	 * @return an instance of the bean
	 * @throws BeansException if the bean could not be created
	 */
	@SuppressWarnings("unchecked")
	protected &lt;T&gt; T doGetBean(
			String name, @Nullable Class&lt;T&gt; requiredType, @Nullable Object[] args, boolean typeCheckOnly)
			throws BeansException {

		/**
		 *
		 * è½¬æ¢ bean name; å¦æåç§°ä¸­å¸¦ BeanFactory.FACTORY_BEAN_PREFIX, åä¼å»æå®;
		 * {@link BeanFactory#FACTORY_BEAN_PREFIX}
		 */
		String beanName = transformedBeanName(name);
		Object beanInstance;
		// Eagerly check singleton cache for manually registered singletons.
		/**
		 * å°è¯ä»å½åå®¹å¨ ä¸ äº ä¸çº§ç¼å­è·å
		 */
		Object sharedInstance = getSingleton(beanName);
		if (sharedInstance != null &amp;&amp; args == null) {
			/**
			 * å¦æç¼å­ä¸­æ
			 */
			if (logger.isTraceEnabled()) {
				if (isSingletonCurrentlyInCreation(beanName)) {
					logger.trace("Returning eagerly cached instance of singleton bean '" + beanName +
							"' that is not fully initialized yet - a consequence of a circular reference");
				}
				else {
					logger.trace("Returning cached instance of singleton bean '" + beanName + "'");
				}
			}
			/**
			 * å¦ææ¿å°çBeanæ¯ FactoryBean å®ç°, åä¼è°ç¨ `T getObject() throws Exception` è·åå¶å¯¹è±¡
			 * åå°ç®æ å¯¹è±¡æ¾å¥org.springframework.beans.factory.support.FactoryBeanRegistrySupport#factoryBeanObjectCacheç¼å­ä¸­
			 * æç»å¨ {@link org.springframework.beans.factory.support.FactoryBeanRegistrySupport#doGetObjectFromFactoryBean}
			 */
			beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, null);
		}
		else {
			/**
			 * å¦æç¼å­ä¸­æ²¡æ
			 */

			/**
			 *  å¤æ­è¯¥beanæ¯å¦å¨åå»ºä¸­ (å¾ªç¯åå»º), ç¨çæ¯ä¸ä¸ªThreadLocal
			 *  {@link org.springframework.beans.factory.support.AbstractBeanFactory#prototypesCurrentlyInCreation}
			 */
			// Fail if we're already creating this bean instance:
			// We're assumably within a circular reference.
			if (isPrototypeCurrentlyInCreation(beanName)) {
				throw new BeanCurrentlyInCreationException(beanName);
			}
			/**
			 * ä¼åå°è¯ä» ç¶ BeanFactoryä¸­æ¿, ç±»ä¼¼ç±»å è½½å¨çåäº²å§ææºå¶
			 * ä¸è¬ ç¶å®¹å¨é½æ¯ç©ºç
			 */
			// Check if bean definition exists in this factory.
			BeanFactory parentBeanFactory = getParentBeanFactory();
			if (parentBeanFactory != null &amp;&amp; !containsBeanDefinition(beanName)) {
				// Not found -&gt; check parent.
				String nameToLookup = originalBeanName(name);
				if (parentBeanFactory instanceof AbstractBeanFactory abf) {
					return abf.doGetBean(nameToLookup, requiredType, args, typeCheckOnly);
				}
				else if (args != null) {
					// Delegation to parent with explicit args.
					return (T) parentBeanFactory.getBean(nameToLookup, args);
				}
				else if (requiredType != null) {
					// No args -&gt; delegate to standard getBean method.
					return parentBeanFactory.getBean(nameToLookup, requiredType);
				}
				else {
					return (T) parentBeanFactory.getBean(nameToLookup);
				}
			}

			/**
			 * æ è®°è¯¥ beanä¸ºåå»ºä¸­æèå·²åå»º;
			 * å¶å®å°±æ¯ç¨ Setéå {@link org.springframework.beans.factory.support.AbstractBeanFactory#alreadyCreated} å­èµ·æ¥
			 */
			if (!typeCheckOnly) {
				markBeanAsCreated(beanName);
			}

			/**
			 * è®°å½å¨ (æå°æäºå³é®è¿ç¨æ¥å¿, æ¶éåæ, ä¸éè¦)
			 */
			StartupStep beanCreation = this.applicationStartup.start("spring.beans.instantiate")
					.tag("beanName", name);
			try {
				if (requiredType != null) {
					beanCreation.tag("beanType", requiredType::toString);
				}
				/**
				 * æ¿å°å¶ RootBeanDefinition (å®æ´çBeanåæ°æ®æè¿°)
				 */
				RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);
				//æ£æ¥BeanDefinition, å°±å¤æ­ä¸ä¸æ¯è¯¥bean å¦æ½è±¡ç±»
				checkMergedBeanDefinition(mbd, beanName, args);

				/**
				 * å¦æå­å¨ä¾èµéç½®, åååå»ºä¾èµçBean
				 * (å³XMLç &lt;bean id="..." depends-on="" ...&gt;&lt;/bean&gt; éç½®)
				 */
				// Guarantee initialization of beans that the current bean depends on.
				String[] dependsOn = mbd.getDependsOn();
				if (dependsOn != null) {
					for (String dep : dependsOn) {
						if (isDependent(beanName, dep)) {
							throw new BeanCreationException(mbd.getResourceDescription(), beanName,
									"Circular depends-on relationship between '" + beanName + "' and '" + dep + "'");
						}
						registerDependentBean(dep, beanName);
						try {
							getBean(dep);
						}
						catch (NoSuchBeanDefinitionException ex) {
							throw new BeanCreationException(mbd.getResourceDescription(), beanName,
									"'" + beanName + "' depends on missing bean '" + dep + "'", ex);
						}
					}
				}

				// Create bean instance.
				if (mbd.isSingleton()) {
					/**
					 * å¦ææ¯åä¾ç Bean
					 * =============================
					 */

					/**
					 * æ³¨æ ä¼ éä¸ä¸ª 'åå»ºBean' çLambdaå½æ°/å¯¹è±¡ (ObjectFactory)
					 * getSingleton çé»è¾æ¯:
					 * 	 1. å°è¯ä»ä¸çº§ç¼å­ä¸­æ¿
					 * 	 2. å°Bean Name æ·»å å° åå»ºä¸­ç¶æçéå è®°å½èµ·æ¥;
					 * 	  {@link org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#singletonsCurrentlyInCreation}
					 *   3. è°ç¨ ObjectFactory#getObject() åè°åæ¥ createBean
					 *   4. å¦ææ¯æ°åå»ºçæ·»å å°ä¸çº§ç¼å²ä¸­
					 */
					sharedInstance = getSingleton(beanName, () -&gt; {
						try {
							/**
							 * è§: {@link AbstractAutowireCapableBeanFactory#createBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, java.lang.Object[])}
							 */
							return createBean(beanName, mbd, args);
						}
						catch (BeansException ex) {
							// Explicitly remove instance from singleton cache: It might have been put there
							// eagerly by the creation process, to allow for circular reference resolution.
							// Also remove any beans that received a temporary reference to the bean.
							destroySingleton(beanName);
							throw ex;
						}
					});
					beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);
				}
				else if (mbd.isPrototype()) {
					/**
					 * å¦ææ¯ååç Bean
					 * =============================
					 */
					// It's a prototype -&gt; create a new instance.
					Object prototypeInstance = null;
					try {
						beforePrototypeCreation(beanName);
						prototypeInstance = createBean(beanName, mbd, args);
					}
					finally {
						afterPrototypeCreation(beanName);
					}
					beanInstance = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);
				}

				else {
					String scopeName = mbd.getScope();
					if (!StringUtils.hasLength(scopeName)) {
						throw new IllegalStateException("No scope name defined for bean '" + beanName + "'");
					}
					Scope scope = this.scopes.get(scopeName);
					if (scope == null) {
						throw new IllegalStateException("No Scope registered for scope name '" + scopeName + "'");
					}
					try {
						Object scopedInstance = scope.get(beanName, () -&gt; {
							beforePrototypeCreation(beanName);
							try {
								return createBean(beanName, mbd, args);
							}
							finally {
								afterPrototypeCreation(beanName);
							}
						});
						beanInstance = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);
					}
					catch (IllegalStateException ex) {
						throw new ScopeNotActiveException(beanName, scopeName, ex);
					}
				}
			}
			catch (BeansException ex) {
				beanCreation.tag("exception", ex.getClass().toString());
				beanCreation.tag("message", String.valueOf(ex.getMessage()));
				cleanupAfterBeanCreationFailure(beanName);
				throw ex;
			}
			finally {
				beanCreation.end();
				if (!isCacheBeanMetadata()) {
					clearMergedBeanDefinition(beanName);
				}
			}
		}

		/**
		 * ééè½¬æ¢ä¸º éæ±çç®æ ç±»å requiredType
		 * å¤æ: å­ç±»æ¯å¯ä»¥åä¸è½¬åç
		 */
		return adaptBeanInstance(name, beanInstance, requiredType);
	}
</code></pre>
<h3 id="å¤çinstantiationawarebeanpostprocessor-aopä»£ç">å¤çInstantiationAwareBeanPostProcessor AOPä»£ç</h3>
<p><code>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#createBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, java.lang.Object[])</code></p>
<pre><code class="language-java">/**
	 * Central method of this class: creates a bean instance,
	 * populates the bean instance, applies post-processors, etc.
	 * @see #doCreateBean
	 */
	@Override
	protected Object createBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)
			throws BeanCreationException {

		if (logger.isTraceEnabled()) {
			logger.trace("Creating instance of bean '" + beanName + "'");
		}
		RootBeanDefinition mbdToUse = mbd;

		// Make sure bean class is actually resolved at this point, and
		// clone the bean definition in case of a dynamically resolved Class
		// which cannot be stored in the shared merged bean definition.
		/**
		 * 1. è§£æå° BeanDefinition ç Class
		 */
		Class&lt;?&gt; resolvedClass = resolveBeanClass(mbd, beanName);
		/**
		 * 2. åå»ºBeanDefinition å¤å¶ä¸ä»½ RootBeanDefinition
		 */
		if (resolvedClass != null &amp;&amp; !mbd.hasBeanClass() &amp;&amp; mbd.getBeanClassName() != null) {
			mbdToUse = new RootBeanDefinition(mbd);
			mbdToUse.setBeanClass(resolvedClass);
		}

		// Prepare method overrides.
		try {
			/**
			 * 3. åå¤åéªè¯ lookup-method å replace-method;
			 * æ³¨æ: è¿éåªæ¯æ è®°, çæ­£å¤çæ¯å¨å®ä¾åæ¶, éæ©ç­ç¥çæä¸ä¸ªCgLibçä»£çå¯¹è±¡ {@link org.springframework.beans.factory.support.CglibSubclassingInstantiationStrategy}
			 * å³äºå®ä»¬çä½ç¨è§ç¬è®° [[Spring lookup-method å replace-method.md]]
			 */
			mbdToUse.prepareMethodOverrides();
		}
		catch (BeanDefinitionValidationException ex) {
			throw new BeanDefinitionStoreException(mbdToUse.getResourceDescription(),
					beanName, "Validation of method overrides failed", ex);
		}

		try {
			// Give BeanPostProcessors a chance to return a proxy instead of the target bean instance.
			/**
			 * 4. ç» BeanPostProcessors ä¸ä¸ªè¿å(ç¨æ·èªå®ä¹, å¦ææAOP, åä¼ ç¨æ·ä»£ç å Springä»£ç)ä»£çå®ä¾çæºä¼;
			 * è°ç¨ InstantiationAwareBeanPostProcessor ç
			 * {@link InstantiationAwareBeanPostProcessor#postProcessBeforeInstantiation(java.lang.Class, java.lang.String)}
			 * å
			 * {@link InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation(java.lang.Class, java.lang.String)}
			 * å¯ä»¥èªå®ä¹åå»º beanå¨æä»£çå®ä¾è¿å (AOPç¸å³)
			 *  
			 * è§ç¬è®°:
			 * [[BeanPostProcessoræ¥å£.md]]
			 * [[Spring ä¸­çAOP]]
			 *
			 * æ³¨æ, è¿éçé»è¾:
			 * å¦æå¶ InstantiationAwareBeanPostProcessor è¿åä¸ä¸ºnull, åç´æ¥ä½¿ç¨è¿ä¸ªbeanå®ä¾è¿åäº, ä¸èµ° doCreateBeanç­ä¸é¢çæµç¨
			 * (æ³¨æçæ³¨æ! å¦ææç¨æ·èªå®ä¹çæ¦æªåå»º, çè³ä¼åSpringçAOPä»£çåå»º)
			 */
			Object bean = resolveBeforeInstantiation(beanName, mbdToUse);
			if (bean != null) {
				return bean;
			}
		}
		catch (Throwable ex) {
			throw new BeanCreationException(mbdToUse.getResourceDescription(), beanName,
					"BeanPostProcessor before instantiation of bean failed", ex);
		}

		try {
			/**
			 * ç»§ç»­
			 */
			Object beanInstance = doCreateBean(beanName, mbdToUse, args);
			if (logger.isTraceEnabled()) {
				logger.trace("Finished creating instance of bean '" + beanName + "'");
			}
			return beanInstance;
		}
		catch (BeanCreationException | ImplicitlyAppearedSingletonException ex) {
			// A previously detected exception with proper bean creation context already,
			// or illegal singleton state to be communicated up to DefaultSingletonBeanRegistry.
			throw ex;
		}
		catch (Throwable ex) {
			throw new BeanCreationException(
					mbdToUse.getResourceDescription(), beanName, "Unexpected exception during bean creation", ex);
		}
	}
</code></pre>
<h3 id="çæ­£å¨jvmå±é¢å®ä¾åå¯¹è±¡">çæ­£å¨jvmå±é¢å®ä¾åå¯¹è±¡</h3>
<p><code>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#doCreateBean</code></p>
<pre><code class="language-java">/**
	 * Actually create the specified bean. Pre-creation processing has already happened
	 * at this point, e.g. checking {@code postProcessBeforeInstantiation} callbacks.
	 * &lt;p&gt;Differentiates between default bean instantiation, use of a
	 * factory method, and autowiring a constructor.
	 *
	 * çæ­£ç å¨JVMå± åå»ºBeanå®ä¾
	 *
	 * @param beanName the name of the bean
	 * @param mbd the merged bean definition for the bean
	 * @param args explicit arguments to use for constructor or factory method invocation
	 * @return a new instance of the bean
	 * @throws BeanCreationException if the bean could not be created
	 * @see #instantiateBean
	 * @see #instantiateUsingFactoryMethod
	 * @see #autowireConstructor
	 *
	 */
	protected Object doCreateBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)
			throws BeanCreationException {

		// Instantiate the bean.
		BeanWrapper instanceWrapper = null;
		if (mbd.isSingleton()) {
			instanceWrapper = this.factoryBeanInstanceCache.remove(beanName);
		}
		if (instanceWrapper == null) {
			/**
			 *  1. çæ­£å¨jvmå±é¢å®ä¾åå¯¹è±¡;
			 *    1.1 å¦æè¯¥ BeanDefinition æéç½® instanceSupplierå±æ§(java.util.function.Supplier),
			 * 		 å°ä½¿ç¨å¶Supplier#getæ¹æ³çè¿å, ä½ä¸ºå®ä¾å¯¹è±¡
			 *    1.2 å¦æè¯¥ BeanDefinition æéç½® factory-method å°ä½¿ç¨è¯¥æ¹æ³è¿åç, ä½ä¸ºå®ä¾å¯¹è±¡
			 * 		 è¿éè¿éåæ¬'éæå·¥å'å'å®ä¾å·¥å'çå¤ç(éè¿bdçfactoryBeanName è¿è¡å¤æ­, å¦æå­å¨åæ¯'å®ä¾å·¥å')
			 * 	  1.3 ä½¿ç¨åå°å®ä¾å, æ ¹æ®ç­ç¥å®ä¾åBeanå¯¹è±¡ {@link org.springframework.beans.factory.support.SimpleInstantiationStrategy}
			 * 	   - ä½¿ç¨æåæé å½æ°æ³¨å¥,åå»º (new)
			 * 	   - ä½¿ç¨æ åæé å½æ°åå»º (new)
			 * 	   - å·¥åæ¹æ³å®ä¾å ('éæå·¥å' 'å®ä¾å·¥å' )
			 * 	     `&lt;bean  factory-bean="bookFactoryBean"  factory-method="getBook()"/&gt;`
			 * 	        éæå·¥å: factory-bean è¥æ¯ å¨éå®ç±»å åä½¿ç¨ BookFactoryBean::getBook çéææ¹æ³è¿åçå¯¹è±¡
			 * 	        å®ä¾å·¥å:  factory-bean è¥æ¯ bean å åä½¿ç¨è¯¥å®ä¾æ¹æ³è¿åçå¯¹è±¡
			 *
			 * 	{@link AbstractAutowireCapableBeanFactory#createBeanInstance(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, java.lang.Object[])}
			 *  2. ç¨BeanWrapper åè£åå§bean (è£é¥°æ¨¡å¼)
			 *  åå§å BeanWrapper
			 * 	 2.1 ç» BeanWrapper è®¾ç½®äº, ConversionService
			 *   2.2 ç» BeanWrapper æ³¨åäº, å½å bean factory (propertyEditorRegistrars)ä¸­çå¨é¨ PropertyEditor
			 * {@link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#instantiateBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition)}
			 *
			 */
			instanceWrapper = createBeanInstance(beanName, mbd, args);
		}
		/**
		 * è·å BeanWrapperä¸­çåå§ Bean å®ä¾
		 */
		Object bean = instanceWrapper.getWrappedInstance();
		/**
		 * è·å Bean Classç±»å
		 */
		Class&lt;?&gt; beanType = instanceWrapper.getWrappedClass();
		if (beanType != NullBean.class) {
			mbd.resolvedTargetType = beanType;
		}

		// Allow post-processors to modify the merged bean definition.
		synchronized (mbd.postProcessingLock) {
			if (!mbd.postProcessed) {
				try {
					/**
					 * 3. å¤ç MergedBeanDefinitionPostProcessor çæ¥å£åè°
					 * è°ç¨ æ·»å å¨ context ä¸­ BeanPostProcessor ç MergedBeanDefinitionPostProcessor çæ¥å£åè°
					 * è§£æå°è¯¸å¦`@Autowired`ä¹ç±»çæ³¨è§£ (Metadata)åä¿¡æ¯,åå¹¶å°BeanDefinitionä¸­
					 *
					 * æ³¨æå¨å½åæ­¥éª¤ä¸­,åªæ¯è§£æ,å¹¶æ³¨å(ä¿®æ¹)å° BeanDefinition ä¸­, å¹¶æ²¡æè°ç¨;
					 *
					 * ä¾å¦:
					 *  1. å¤ç `@Autowired` `@Value`, `@Inject`
					 * å¯¹åºå¤çç±»æ¯ `org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor`
					 * è¿ä¸ª çæ­£å¤çæ¯å¨å¡«åå±æ§æ¶, [[åè°ææ InstantiationAwareBeanPostProcessor#postProcessProperties æ¹æ³]] {@link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#populateBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, org.springframework.beans.BeanWrapper)}
					 * è´è´£æ¥æ¾ç¸åºçæ³¨è§£æ¹æ³ä¿¡æ¯, å°è£ä¸º Metadata åæ°æ®(ä½¿ç¨éåå­èµ·æ¥), åå°è¿äº Metadata åæ°æ®, æ³¨å(ä¿®æ¹)å° BeanDefinition ä¸­
					 *
					 *  2. å¤ç `@Resource`
					 * å¯¹åºå¤çç±» `org.springframework.context.annotation.CommonAnnotationBeanPostProcessor`
					 *
					 *  3. å¤ç `init-method`, `@PostConstruct`, `@PreDestroy`
					 * å¯¹åºå¤çç±» `org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor`
					 *
					 */
					applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);
				}
				catch (Throwable ex) {
					throw new BeanCreationException(mbd.getResourceDescription(), beanName,
							"Post-processing of merged bean definition failed", ex);
				}
				mbd.markAsPostProcessed();
			}
		}

		// Eagerly cache singletons to be able to resolve circular references
		// even when triggered by lifecycle interfaces like BeanFactoryAware.
		/**
		 * å¤æ­å½å:  æ¯å¦åä¾ &amp;&amp; æ¯å¦åè®¸å¾ªç¯ä¾èµ &amp;&amp; æ¯å¦æ­£å¨åå»ºè¿ç¨ä¸­
		 *(å¾ªç¯ä¾èµAOP)
		 */
		boolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp;
				isSingletonCurrentlyInCreation(beanName));
		if (earlySingletonExposure) {
			if (logger.isTraceEnabled()) {
				logger.trace("Eagerly caching bean '" + beanName +
						"' to allow for resolving potential circular references");
			}
			/**
			 * æ¾å°ä¸çº§ç¼å­(ä¸çº§ç¼å­ å­æ¾Lambda)
			 * &lt;!&gt; å¾ªç¯ä¾èµ AOP :è¿éå¶å®å°±æ¯ä¼è°ç¨å° AutoProxyCreator å¨å¶è¿è¡å¤æ­æ¯å¦éè¦, æç»ä¼è°ç¨å° createProxy è¿è¡å¨æä»£çå¯¹è±¡åå»º
			 * {@link org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator#getEarlyBeanReference(java.lang.Object, java.lang.String)}
			 *
			 */
			addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));
		}

		// Initialize the bean instance.
		Object exposedObject = bean;
		try {
			/**
			 * 2.å¡«åBeanå±æ§
			 * å¦ææ¯AOP, pointcut, adviceç¸å³ç, synthetic ä¼éç½®ä¸º true
			 *   1. è°ç¨ BeanPostProcessor çå­æ¥å£ InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation
			 * 	 (ä½ç¨æ¯ å¨å®ä¾åä¹åï¼å±æ§å¡«åä¹åæ§è¡æä½, å¯ä»¥æ¦æªå±æ§å¡«åæä½)
			 */
			populateBean(beanName, mbd, instanceWrapper);
			/**
			 * 3.åå§åBeanå¯¹è±¡
			 *   1.åè°ç¨è¿ä¸ä¸ª BeanNameAware, BeanClassLoaderAware, BeanFactoryAware
			 * 	  è¿ä¸ä¸ªæ¯å¨åå»ºBeanFactory æ¶å¿½ç¥çä¸ä¸ª Aware æ¥å£
			 *   2. è°ç¨ææ BeanPostProcessors#postProcessBeforeInitialization (ä½ç¨: å¨Beanåå§åä¹åè°ç¨)
			 *   3. è°ç¨ init-method æ¹æ³
			 *   4. è°ç¨ææ BeanPostProcessors#postProcessAfterInitialization (ä½ç¨: å¨Beanåå§åä¹åè°ç¨)
			 */
			exposedObject = initializeBean(beanName, exposedObject, mbd);
		}
		catch (Throwable ex) {
			if (ex instanceof BeanCreationException bce &amp;&amp; beanName.equals(bce.getBeanName())) {
				throw bce;
			}
			else {
				throw new BeanCreationException(mbd.getResourceDescription(), beanName, ex.getMessage(), ex);
			}
		}

		if (earlySingletonExposure) {
			/**
			 * å¾ªç¯ä¾èµAOP ç¸å³ (å¾ªç¯ä¾èµAOP)
			 * =======================
			 */

			/**
			 * åä»ç¼å­ä¸­æ¿ä¸æ¬¡è·åå¹¶æ¿æ¢,æ¯å ä¸ºæå¯è½æ¯è¢«ä»£ç(earlySingletonReference)
			 */
			Object earlySingletonReference = getSingleton(beanName, false);
			if (earlySingletonReference != null) {
				/**
				 *  (å¾ªç¯ä¾èµAOP)
				 *  æ³¨æ: è¿ä¸ªbeanæ¯åå§å®ä¾, åä»ç¼å­ä¸­æ¿ä¸æ¬¡,æ¯å ä¸ºæå¯è½æ¯è¢«ä»£ç(earlySingletonReference)
				 */
				if (exposedObject == bean) {
					// ä¸ä¸è´å°±æ¯è¢«ä»£çäº
					exposedObject = earlySingletonReference;
				}
				else if (!this.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) {
					String[] dependentBeans = getDependentBeans(beanName);
					Set&lt;String&gt; actualDependentBeans = new LinkedHashSet&lt;&gt;(dependentBeans.length);
					for (String dependentBean : dependentBeans) {
						if (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) {
							actualDependentBeans.add(dependentBean);
						}
					}
					if (!actualDependentBeans.isEmpty()) {
						throw new BeanCurrentlyInCreationException(beanName,
								"Bean with name '" + beanName + "' has been injected into other beans [" +
										StringUtils.collectionToCommaDelimitedString(actualDependentBeans) +
										"] in its raw version as part of a circular reference, but has eventually been " +
										"wrapped. This means that said other beans do not use the final version of the " +
										"bean. This is often the result of over-eager type matching - consider using " +
										"'getBeanNamesForType' with the 'allowEagerInit' flag turned off, for example.");
					}
				}
			}
		}

		// Register bean as disposable.
		try {
			/**
			 * æ³¨å beanéæ¯çå·¥ä½(å¦æéè¦)
			 * 1. org.springframework.beans.factory.config.DestructionAwareBeanPostProcessor#postProcessBeforeDestruction(Object,String) BPPæ¥å£
			 * 2. org.springframework.beans.factory.DisposableBean æ¥å£
			 * 3. èªå®ä¹ destroyæ¹æ³
			 * å¨å®¹å¨å³é­æ¶ä¼è°ç¨ä¼æè¿ä¸ªé¡ºåºè°ç¨
			 */
			registerDisposableBeanIfNecessary(beanName, bean, mbd);
		}
		catch (BeanDefinitionValidationException ex) {
			throw new BeanCreationException(
					mbd.getResourceDescription(), beanName, "Invalid destruction signature", ex);
		}

		return exposedObject;
	}
</code></pre>
<h3 id="å®ä¾å-æé å½æ°çç»è">å®ä¾å æé å½æ°çç»è</h3>
<pre><code class="language-java">
	/**
	 * å®ä¾åè¯¦ç»è¿ç¨
	 * 
	 * Create a new instance for the specified bean, using an appropriate instantiation strategy:
	 * factory method, constructor autowiring, or simple instantiation.
	 * @param beanName the name of the bean
	 * @param mbd the bean definition for the bean
	 * @param args explicit arguments to use for constructor or factory method invocation
	 * @return a BeanWrapper for the new instance
	 * @see #obtainFromSupplier
	 * @see #instantiateUsingFactoryMethod
	 * @see #autowireConstructor
	 * @see #instantiateBean
	 *
	 */
	protected BeanWrapper createBeanInstance(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) {
		// Make sure bean class is actually resolved at this point.
		// ç¡®ä¿Class æ¯å¯ä»¥å®ä¾åç
		Class&lt;?&gt; beanClass = resolveBeanClass(mbd, beanName);
		/**
		 * éªè¯ä¸ä¸æé æ¹æ³ è®¿é®ä¿®é¥°ç¬¦
		 */
		if (beanClass != null &amp;&amp; !Modifier.isPublic(beanClass.getModifiers()) &amp;&amp; !mbd.isNonPublicAccessAllowed()) {
			throw new BeanCreationException(mbd.getResourceDescription(), beanName,
					"Bean class isn't public, and nonpublic access not allowed: " + beanClass.getName());
		}
		/**
		 * å¦æè¯¥ BeanDefinition æéç½® instanceSupplierå±æ§(java.util.function.Supplier),
		 * å°ä½¿ç¨å¶Supplier#getæ¹æ³çè¿å, ä½ä¸ºå®ä¾å¯¹è±¡
		 */
		Supplier&lt;?&gt; instanceSupplier = mbd.getInstanceSupplier();
		if (instanceSupplier != null) {
			return obtainFromSupplier(instanceSupplier, beanName, mbd);
		}

		/**
		 * å¦æè¯¥ BeanDefinition æéç½® factory-method å°ä½¿ç¨è¯¥æ¹æ³çè¿å ä½ä¸ºå®ä¾å¯¹è±¡
		 * è¿éè¿éåæ¬'éæå·¥å'å'å®ä¾å·¥å'çå¤ç(éè¿bdçfactoryBeanName è¿è¡å¤æ­, å¦æå­å¨åæ¯'å®ä¾å·¥å')
		 *
		 * éæå·¥å(æ³¨æ å·¥åæ¹æ³æ¯staticæ¹æ³)
		 * &lt;bean id="user" class="org.yang.User"  factory-method="createUser"/&gt;
		 *
		 * å®ä¾å·¥å(æ³¨æ å·¥åå¯¹è±¡æ¯ä¸ä¸ªå®ä¾, ä½¿ç¨è¯¥å®ä¾æ¹æ³è¿åç)
		 * &lt;bean id="userFactory" class="org.yang.UserFactory"/&gt;
		 *  &lt;! -- factory-bean æåå®ä¾å·¥å Bean --&gt;
		 * &lt;bean id="user" class="org.yang.User" factory-bean="userFactory" factory-method="createUser"/&gt;
		 *
		 */
		if (mbd.getFactoryMethodName() != null) {
			return instantiateUsingFactoryMethod(beanName, mbd, args);
		}

		/**
		 *  =======================
		 *  in short : ä¸é¢ä¸»è¦é»è¾å°±æ¯ æ¾å°ä¸ä¸ªåéçæé å½æ°åæ³¨å¥æ¹å¼, ç¶åå­èµ·æ¥, éè¿åå°å®ä¾å
		 *  å¦æä¸æ¬¡è¿éè¦å°±ç´æ¥æ ¹æ®æåµç´æ¥æ§è¡(ä»ååBeanææéå¤åå»ºçæåµ)
		 */
		// Shortcut when re-creating the same bean...
		/**
		 * æ¯å¦å·²ç»è§£æ/åå»ºè¿äº
		 */
		boolean resolved = false;
		/**
		 * æ¯å¦éè¦èªå¨æ³¨å¥
		 */
		boolean autowireNecessary = false;
		if (args == null) {
			synchronized (mbd.constructorArgumentLock) {
				/**
				 * ç±»ä¼¼ä¸ä¸ªç¼å­æºå¶, åé¢å¨ {@link org.springframework.beans.factory.support.SimpleInstantiationStrategy#instantiate(org.springframework.beans.factory.support.RootBeanDefinition, java.lang.String, org.springframework.beans.factory.BeanFactory)}
				 * è§£æè¿ç¨ä¸­ä¼ç»å®èµå¼å­èµ·æ¥; ä¸é¢å°±æ ¹æ®è§£æçæåµæ§è¡
				 */
				if (mbd.resolvedConstructorOrFactoryMethod != null) {
					resolved = true;
					autowireNecessary = mbd.constructorArgumentsResolved;
				}
			}
		}
		/**
		 * å·²ç»è§£æè¿äº, æ ¹æ®è§£æçæåµ, æ§è¡
		 */
		if (resolved) {
			if (autowireNecessary) {
				/**
				 * ä½¿ç¨æåæé å½æ°æ³¨å¥,åå»º (new)
				 */
				return autowireConstructor(beanName, mbd, null, null);
			}
			else {
				/**
				 * ä½¿ç¨æ åæé å½æ°æ³¨å¥,åå»º (new)
				 */
				return instantiateBean(beanName, mbd);
			}
		}
		/**
		 * é¦æ¬¡è§£æåå»ºBean
		 * =============================
		 */

		// Candidate constructors for autowiring?
		/**
		 * ä» BeanPostProcessors éé¢æ¨æ­æé æ¹æ³
		 * SmartInstantiationAwareBeanPostProcessor æ¥å£å¯ä»¥å¯¹ 'æé æ¹æ³æ³¨å¥çéæ©' è¿è¡è°æ´(æ¨è?)
		 * {@link org.springframework.beans.factory.config.SmartInstantiationAwareBeanPostProcessor#determineCandidateConstructors(java.lang.Class, java.lang.String)}
		 *
		 */
		Constructor&lt;?&gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName);
		/**
		 * èªå¨è½¬éçæ¹å¼, æäºç§ (è§ {@link org.springframework.beans.factory.config.AutowireCapableBeanFactory}çå ä¸ªå¸¸é):
		 *  1. AUTOWIRE_NO = 0; æªæå®, ä¸æ³¨å¥
		 * 	2. AUTOWIRE_BY_NAME = 1; byName
		 * 	3. AUTOWIRE_BY_TYPE = 2; byType
		 * 	4. AUTOWIRE_CONSTRUCTOR = 3; byæé 
		 *  5. AUTOWIRE_AUTODETECT = 4;(å°å¼ç¨)
		 *
		 */
		if (ctors != null || mbd.getResolvedAutowireMode() == AUTOWIRE_CONSTRUCTOR ||
				mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) {
			/**
			 * ä½¿ç¨æåæé å½æ°æ³¨å¥,åå»º
			 */
			return autowireConstructor(beanName, mbd, ctors, args);
		}

		// Preferred constructors for default construction?
		/**
		 *  æ²¡ææ¾å°åéçæé å½æ°, å¦æmbdæéç½® é¦éçæé å½æ°, å°±ç¨å®
		 */
		ctors = mbd.getPreferredConstructors();
		if (ctors != null) {
			return autowireConstructor(beanName, mbd, ctors, null);
		}

		// No special handling: simply use no-arg constructor.
		/**
		 * ä½¿ç¨æ åæé å½æ°æ³¨å¥,åå»º
		 */
		return instantiateBean(beanName, mbd);
	}
</code></pre>
<h3 id="å¡«åå±æ§">å¡«åå±æ§</h3>
<pre><code class="language-java">/**
	 * Populate the bean instance in the given BeanWrapper with the property values
	 * from the bean definition.
	 * @param beanName the name of the bean
	 * @param mbd the bean definition for the beanT
	 * @param bw the BeanWrapper with bean instance
	 */
	protected void populateBean(String beanName, RootBeanDefinition mbd, @Nullable BeanWrapper bw) {
		// éªè¯ä¸ä¸å¥å
		if (bw == null) {
			if (mbd.hasPropertyValues()) {
				throw new BeanCreationException(
						mbd.getResourceDescription(), beanName, "Cannot apply property values to null instance");
			}
			else {
				// Skip property population phase for null instance.
				return;
			}
		}

		if (bw.getWrappedClass().isRecord()) {
			if (mbd.hasPropertyValues()) {
				throw new BeanCreationException(
						mbd.getResourceDescription(), beanName, "Cannot apply property values to a record");
			}
			else {
				// Skip property population phase for records since they are immutable.
				return;
			}
		}

		// Give any InstantiationAwareBeanPostProcessors the opportunity to modify the
		// state of the bean before properties are set. This can be used, for example,
		// to support styles of field injection.
		/**
		 * å¦ææ¯AOP, pointcut, adviceç¸å³ç, synthetic ä¼éç½®ä¸º true
		 * 1. è°ç¨ BeanPostProcessor çå­æ¥å£ InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation
		 * (ä½ç¨æ¯ å¨å®ä¾åä¹åï¼å±æ§å¡«åä¹åæ§è¡æä½, å¯ä»¥æ¦æªå±æ§å¡«åæä½)
		 */
		if (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) {
			for (InstantiationAwareBeanPostProcessor bp : getBeanPostProcessorCache().instantiationAware) {
				if (!bp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName)) {
					//postProcessAfterInstantiation è¿å false , æ¦æªå±æ§å¡«å;
					return;
				}
			}
		}
		/**
		 * åå«ä¸ä¸ªæå¤ä¸ª{@link PropertyValue}å¯¹è±¡çHolderï¼éå¸¸éå¯¹ç¹å®ç®æ beançä¸æ¬¡æ´æ°
		 * å¯ä»¥çè§£ä¸º: è¯¥beanææå±æ§çæè¿°
		 */
		PropertyValues pvs = (mbd.hasPropertyValues() ? mbd.getPropertyValues() : null);

		/**
		 * è·åèªå¨æ³¨å¥çæ¹å¼
		 */
		int resolvedAutowireMode = mbd.getResolvedAutowireMode();
		if (resolvedAutowireMode == AUTOWIRE_BY_NAME || resolvedAutowireMode == AUTOWIRE_BY_TYPE) {
			/**
			 * 2. å¤çæ³¨è§£ç  byName æè byType æ³¨å¥çå±æ§
			 * (ææ³¨è§£æä¼èµ°è¿ä¸ªåæ¯)
			 * ===============================
			 */
			MutablePropertyValues newPvs = new MutablePropertyValues(pvs);
			// Add property values based on autowire by name if applicable.
			if (resolvedAutowireMode == AUTOWIRE_BY_NAME) {
				/**
				 * éè¿åç§°æ³¨å¥
				 */
				autowireByName(beanName, mbd, bw, newPvs);
			}
			// Add property values based on autowire by type if applicable.
			if (resolvedAutowireMode == AUTOWIRE_BY_TYPE) {
				/**
				 * éè¿ç±»åæ³¨å¥
				 */
				autowireByType(beanName, mbd, bw, newPvs);
			}
			pvs = newPvs;
		}
		/**
		 *  3. åè°ææ InstantiationAwareBeanPostProcessor#postProcessProperties æ¹æ³
		 *  æ¯å¦, `@Autowired` çå¤çå¯¹åºå®ç°ç±»: {@link org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor}
		 *  (ä½ç¨æ¯: å¨å·¥åå°å±æ§å¼åºç¨å°ç»å®beanä¹åï¼å¯¹å®ä»¬è¿è¡å¤ç)
		 * 	 æ³¨æè¿éä¹åªæ¯è§£æ, å¹¶æ²¡æè®¾ç½®è¿å», å®éèµå¼æ¹æ³è§ä¸: {@link AbstractAutowireCapableBeanFactory#applyPropertyValues(java.lang.String, org.springframework.beans.factory.config.BeanDefinition, org.springframework.beans.BeanWrapper, org.springframework.beans.PropertyValues)}
		 *
		 */
		if (hasInstantiationAwareBeanPostProcessors()) {
			if (pvs == null) {
				pvs = mbd.getPropertyValues();
			}
			for (InstantiationAwareBeanPostProcessor bp : getBeanPostProcessorCache().instantiationAware) {
				PropertyValues pvsToUse = bp.postProcessProperties(pvs, bw.getWrappedInstance(), beanName);
				if (pvsToUse == null) {
					return;
				}
				pvs = pvsToUse;
			}
		}

		boolean needsDepCheck = (mbd.getDependencyCheck() != AbstractBeanDefinition.DEPENDENCY_CHECK_NONE);
		if (needsDepCheck) {
			PropertyDescriptor[] filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);
			checkDependencies(beanName, mbd, filteredPds, pvs);
		}
		/**
		 * 4. è§£æBeanDefinitionçæè¿°å¼, åå°è°ç¨ èµå¼ bean å±æ§ (å°è§£æå°ç pvs èµå¼å° bw)
		 */
		if (pvs != null) {
			applyPropertyValues(beanName, mbd, bw, pvs);
		}
	}
</code></pre>
<h3 id="åå§å-è°ç¨-init-method-aware-bppæ¹æ³">åå§å è°ç¨ init-method Aware BPPæ¹æ³</h3>
<p><code>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#initializeBean(java.lang.String, java.lang.Object, org.springframework.beans.factory.support.RootBeanDefinition)</code></p>
<pre><code class="language-java">/**
	 * Initialize the given bean instance, applying factory callbacks
	 * as well as init methods and bean post processors.
	 * &lt;p&gt;Called from {@link #createBean} for traditionally defined beans,
	 * and from {@link #initializeBean} for existing bean instances.
	 * @param beanName the bean name in the factory (for debugging purposes)
	 * @param bean the new bean instance we may need to initialize
	 * @param mbd the bean definition that the bean was created with
	 * (can also be {@code null}, if given an existing bean instance)
	 * @return the initialized bean instance (potentially wrapped)
	 * @see BeanNameAware
	 * @see BeanClassLoaderAware
	 * @see BeanFactoryAware
	 * @see #applyBeanPostProcessorsBeforeInitialization
	 * @see #invokeInitMethods
	 * @see #applyBeanPostProcessorsAfterInitialization
	 */
	@SuppressWarnings("deprecation")
	protected Object initializeBean(String beanName, Object bean, @Nullable RootBeanDefinition mbd) {

		/**
		 * åè°ç¨è¿ä¸ä¸ª BeanNameAware, BeanClassLoaderAware, BeanFactoryAware
		 * è¿ä¸ä¸ªæ¯å¨åå»º BeanFactory æ¶å¿½ç¥çä¸ä¸ª Aware æ¥å£
		 * { @link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#AbstractAutowireCapableBeanFactory() }
		 *
		 */
		invokeAwareMethods(beanName, bean);

		Object wrappedBean = bean;
		if (mbd == null || !mbd.isSynthetic()) {
			/**
			 * è°ç¨ææ BeanPostProcessors#postProcessBeforeInitialization
			 * (ä½ç¨ å¨Beanåå§åä¹åè°ç¨)
			 * æ¯å¦ Spring ä¸­Awareå±æ§çè®¾ç½®, æ¯éè¿è¿ç§æ¹å¼æ©å±ç
			 * - org.springframework.context.support.ApplicationContextAwareProcessor
			 * å¯¹åºè°ç¨ ApplicationContextAware, EnvironmentAware, ApplicationEventPublisherAware ç­Awareæ¹æ³
			 *
			 */
			wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);
		}

		try {
			/**
			 * è°ç¨ init-method æ¹æ³
			 */
			invokeInitMethods(beanName, wrappedBean, mbd);
		}
		catch (Throwable ex) {
			throw new BeanCreationException(
					(mbd != null ? mbd.getResourceDescription() : null), beanName, ex.getMessage(), ex);
		}
		if (mbd == null || !mbd.isSynthetic()) {
			/**
			 * è°ç¨ææ BeanPostProcessors#postProcessAfterInitialization
			 * (ä½ç¨ å¨Beanåå§åä¹åè°ç¨)
			 *
			 * - AspectJAwareAdvisorAutoProxyCreator.class
			 * org.springframework.aop.config.internalAutoProxyCreator å¯¹åºçç±»ææ ¹æ®æåµæä¸ä¸ªå¯è½
			 *   InfrastructureAdvisorAutoProxyCreator.class,
			 *   AspectJAwareAdvisorAutoProxyCreator.class,
			 *   AnnotationAwareAspectJAutoProxyCreator.class
			 *
			 *  å¦æéè¦ä»£ç, è¿éä¼çæ­£çå¯¹åå§ bean è¿è¡ä»£ç  è¿è¡ä»£ççåå»º createProxy
			 *
			 */
			wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);
		}

		return wrappedBean;
	}
</code></pre>
<h3 id="æ»ç»-9">æ»ç»</h3>
<pre><code>1. ä¸º beanFactory è®¾ç½®ç±»åè½¬æ¢å¨(ConversionService) å±æ§å¡«åæ¶ä¼ç¨å° {@link AbstractApplicationContext#finishBeanFactoryInitialization(ConfigurableListableBeanFactory)}
2. ä¸º beanFactory æ·»å åéè§£æå¨ (StringValueResolver)
	å¦æ beanFactory ä¸ä¸æä¸­ä¸åå« "é»è®¤çåéè§£æå¨ (ç±»ä¼¼ PropertySourcesPlaceholderConfigurer) è§£æç±»ä¼¼ '${}' è¿æ ·çåé "
	åä½¿ç¨ç¯å¢å¯¹è±¡(ConfigurableEnvironment)ä¸­ç ConfigurablePropertyResolverå®ç°æ¥ä½ä¸º StringValueResolver æ·»å è¿å»
3. å»ç»éç½®, æ­¤åå°±ä¸ååè®¸æ´æ¹ beanDefinition äº
4. å®ä¾åææå©ä½ç (élazy-init) åä¾ Bean
5. å¤ç FactoryBean ç±»åçbean {@link DefaultListableBeanFactory#preInstantiateSingletons()}
	å¦æè¯¥beanæ¯ FactoryBean, åå¨ bean name åé¢å ä¸ä¸ª '&amp;' åç¼, åè·å/å®ä¾å FactoryBean æ¬èº«;
	(æ³¨æä¸ä¸ FactoryBean çæå¯¹è±¡æ¯ä¸éµå¾ª Spring çbeançå½å¨æç)
	è¿æä¸¤ä¸ªå¯¹è±¡, å¦ä½è·å? getBean(beanName) :
	1. ä¼ å¥ FactoryBean ç name è¿åçæ¯å¶ getObject çç®æ å¯¹è±¡å®ä¾;
	2. å¦ææ³è·å FactoryBean æ¬èº«å®ä¾, ååé¢éè¦å ä¸ä¸ª '&amp;' åç¼;
6. å°è¯ä»å½åå®¹å¨ ä¸ äº ä¸çº§ç¼å­è·å {@link AbstractBeanFactory#doGetBean(String, Class, Object[], boolean)}
7. å¤ç AOP ä»£çå¯¹è±¡çæ {@link AbstractAutowireCapableBeanFactory#createBean(String, RootBeanDefinition, Object[])}
8. å¨JVMå±é¢å®ä¾åå¯¹è±¡ {@link AbstractAutowireCapableBeanFactory#doCreateBean(String, RootBeanDefinition, Object[])}
	1.çæ­£å¨jvmå±é¢å®ä¾åå¯¹è±¡;
		1. å¦æè¯¥ BeanDefinition æéç½® instanceSupplierå±æ§(java.util.function.Supplier),
		 å°ä½¿ç¨å¶Supplier#getæ¹æ³çè¿å, ä½ä¸ºå®ä¾å¯¹è±¡
		2. å¦æè¯¥ BeanDefinition æéç½® factory-method å°ä½¿ç¨è¯¥æ¹æ³è¿åç, ä½ä¸ºå®ä¾å¯¹è±¡
		 è¿éè¿éåæ¬'éæå·¥å'å'å®ä¾å·¥å'çå¤ç(éè¿bdçfactoryBeanName è¿è¡å¤æ­, å¦æå­å¨åæ¯'å®ä¾å·¥å')
		3. ä½¿ç¨åå°å®ä¾å, æ ¹æ®ç­ç¥å®ä¾åBeanå¯¹è±¡ {@link org.springframework.beans.factory.support.SimpleInstantiationStrategy}
		- ä½¿ç¨æåæé å½æ°æ³¨å¥,åå»º (new)
		- ä½¿ç¨æ åæé å½æ°åå»º (new)
		- å·¥åæ¹æ³å®ä¾å ('éæå·¥å' 'å®ä¾å·¥å' )
		`&lt;bean  factory-bean="bookFactoryBean"  factory-method="getBook()"/&gt;`
		éæå·¥å: factory-bean è¥æ¯ å¨éå®ç±»å åä½¿ç¨ BookFactoryBean::getBook çéææ¹æ³è¿åçå¯¹è±¡
		å®ä¾å·¥å:  factory-bean è¥æ¯ bean å åä½¿ç¨è¯¥å®ä¾æ¹æ³è¿åçå¯¹è±¡
	2. ç¨BeanWrapper åè£åå§bean (è£é¥°æ¨¡å¼)
	3. åå§å BeanWrapper
		1. ç» BeanWrapper è®¾ç½®äº, ConversionService
		2. ç» BeanWrapper æ³¨åäº, å½å bean factory (propertyEditorRegistrars)ä¸­çå¨é¨ PropertyEditor
		3. å¤ç MergedBeanDefinitionPostProcessor çæ¥å£åè° {@link AbstractAutowireCapableBeanFactory#applyMergedBeanDefinitionPostProcessors(RootBeanDefinition, Class, String)}
		è°ç¨ æ·»å å¨ context ä¸­ BeanPostProcessor ç MergedBeanDefinitionPostProcessor çæ¥å£åè°
		è§£æå°è¯¸å¦`@Autowired`ä¹ç±»çæ³¨è§£ (Metadata)åä¿¡æ¯,åå¹¶å°BeanDefinitionä¸­
	4. å¡«åBeanå±æ§ {@link AbstractAutowireCapableBeanFactory#populateBean(String, RootBeanDefinition, BeanWrapper)}
		1. å¦ææ¯AOP, pointcut, adviceç¸å³ç, synthetic ä¼éç½®ä¸º true  è°ç¨ BeanPostProcessor çå­æ¥å£ InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation
		(ä½ç¨æ¯ å¨å®ä¾åä¹åï¼å±æ§å¡«åä¹åæ§è¡æä½, å¯ä»¥æ¦æªå±æ§å¡«åæä½)
		2. å¤çæ³¨è§£ç  byName æè byType æ³¨å¥çå±æ§
		3. åè°ææ InstantiationAwareBeanPostProcessor#postProcessProperties æ¹æ³
		æ¯å¦, `@Autowired` çå¤çå¯¹åºå®ç°ç±»: {@link org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor}
		(ä½ç¨æ¯: å¨å·¥åå°å±æ§å¼åºç¨å°ç»å®beanä¹åï¼å¯¹å®ä»¬è¿è¡å¤ç)
		æ³¨æè¿éä¹åªæ¯è§£æ, å¹¶æ²¡æè®¾ç½®è¿å», å®éèµå¼æ¹æ³è§: {@link AbstractAutowireCapableBeanFactory#applyPropertyValues(java.lang.String, org.springframework.beans.factory.config.BeanDefinition, org.springframework.beans.BeanWrapper, org.springframework.beans.PropertyValues)}
	5. åå§åBeanå¯¹è±¡ {@link AbstractAutowireCapableBeanFactory#initializeBean(String, Object, RootBeanDefinition)}
		1. åè°ç¨è¿ä¸ä¸ª BeanNameAware, BeanClassLoaderAware, BeanFactoryAware {@link AbstractAutowireCapableBeanFactory#invokeAwareMethods(String, Object)}
		è¿ä¸ä¸ªæ¯å¨åå»ºBeanFactory æ¶å¿½ç¥çä¸ä¸ª Aware æ¥å£
		2. è°ç¨ææ BeanPostProcessors#postProcessBeforeInitialization (ä½ç¨: å¨Beanåå§åä¹åè°ç¨) {@link AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsBeforeInitialization(Object, String)}
		3. è°ç¨ init-method æ¹æ³ {@link AbstractAutowireCapableBeanFactory#invokeInitMethods(String, Object, RootBeanDefinition)}
		4. è°ç¨ææ BeanPostProcessors#postProcessAfterInitialization (ä½ç¨: å¨Beanåå§åä¹åè°ç¨) {@link AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsAfterInitialization(Object, String)}
	6. æ³¨å beanéæ¯çå·¥ä½(å¦æéè¦){@link AbstractBeanFactory#registerDisposableBeanIfNecessary(String, Object, RootBeanDefinition)}
		1. org.springframework.beans.factory.config.DestructionAwareBeanPostProcessor#postProcessBeforeDestruction(Object,String) BPPæ¥å£
		2. org.springframework.beans.factory.DisposableBean æ¥å£
		3. èªå®ä¹ destroyæ¹æ³
		(å¨å®¹å¨å³é­æ¶ä¼è°ç¨ä¼æè¿ä¸ªé¡ºåºè°ç¨)

</code></pre>
<h2 id="åäº-å®æå®¹å¨å·æ°">åäº å®æå®¹å¨å·æ°</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#finishRefresh</code></p>
<pre><code class="language-java">/**  
 * Finish the refresh of this context, invoking the LifecycleProcessor's * onRefresh() method and publishing the * {@link org.springframework.context.event.ContextRefreshedEvent}.  
 */
 protected void finishRefresh() {  
   
}
</code></pre>
<h3 id="æ»ç»-10">æ»ç»</h3>
<ol>
<li>æ¸çåç§ç¼å­</li>
<li>ä¸ºå½åä¸ä¸æåå§åçå½å¨æå¤çå¨</li>
<li>åå¸ ContextRefreshedEvent (Context å®æå·æ°)äºä»¶</li>
</ol>
<h1 id="å³äº-bean-çç»§æ¿parentå±æ§">å³äº Bean çç»§æ¿(parentå±æ§)</h1>
<p>è¿éçç»§æ¿å java è¯­æ³ä¸­çç»§æ¿æ²¡æä»»ä½å³ç³», ä¸è¿æè·¯æ¯ç¸éç; child bean ä¼ç»§æ¿ parent bean çææéç½®, ä¹å¯ä»¥è¦çä¸äºéç½®, å½ç¶ä¹å¯ä»¥æ°å¢é¢å¤çéç½®;</p>
<p>Spring ä¸­æä¾äºç»§æ¿èª AbstractBeanDefinition ç ChildBeanDefinition æ¥è¡¨ç¤º child bean;</p>
<p>çå¦ä¸ä¸ä¸ªä¾å­:</p>
<pre><code class="language-xml">&lt;bean id="inheritedTestBean" abstract="true" class="org.springframework.beans.TestBean"&gt;
    &lt;property name="name" value="parent"/&gt;
    &lt;property name="age" value="1"/&gt;
&lt;/bean&gt;

&lt;bean id="inheritsWithDifferentClass" class="org.springframework.beans.DerivedTestBean"
        parent="inheritedTestBean" init-method="initialize"&gt;

    &lt;property name="name" value="override"/&gt;
&lt;/bean&gt;

</code></pre>
<p>parent bean è®¾ç½®äº <code>abstract="true"</code> æä»¥å®ä¸ä¼è¢«å®ä¾å, child bean<strong>(inheritsWithDifferentClass)</strong>ç»§æ¿äº parent bean<strong>(inheritedTestBean)</strong> ç<code> name</code> <code>age</code> ä¸¤ä¸ªå±æ§, ä½æ¯å¯¹ <code>name</code> å±æ§è¿è¡äºè¦å, å¢å äº<code>init-method</code>;</p>
<p><strong>in short: å³éç½®ç»§æ¿, child bean ä¼ç»§æ¿ scope, æé å¨åæ°å¼, å±æ§å¼, init-method, destroy-method ç­ç­éç½®</strong></p>
<pre><code class="language-java">@Configuration
public class WebConfigBeans {
	
	@Autowired
	private RequestMappingHandlerAdapter handlerAdapter;
	
	@PostConstruct
	public void initEditableValidation(){
		//è·å¾ RequestMappingHandler ä¸­ç ConfigurableWebBindingInitializer
		ConfigurableWebBindingInitializer initializer =(ConfigurableWebBindingInitializer)handlerAdapter.getWebBindingInitializer();
		if(initializer.getConversionService()!=null){
			GenericConversionService genericConversionService=(GenericConversionService)initializer.getConversionService();
			//æ·»å èªå®ä¹è½¬æ¢å¨
			genericConversionService.addConverter(new StringToDateConverter());
		}
	}
	
}
</code></pre>
<h1 id="å³äº-factorybean">å³äº FactoryBean</h1>
<p><code>org.springframework.beans.factory.FactoryBean</code> éç¨äº Bean çåå»ºè¿ç¨æ¯è¾å¤æçåºæ¯, æ¯å¦æ°æ®åºè¿æ¥æ± çåå»º;</p>
<p>æä»¬åè®¾ç°å¨éè¦åå»ºä¸ä¸ª Person ç Bean, é¦åæä»¬éè¦ä¸ä¸ª Car çå®ä¾, æä»¬è¿éåè®¾ Car çå®ä¾åå»ºå¾éº»ç¦, é£ä¹æä»¬å¯ä»¥æåå»º Car çå¤æè¿ç¨åè£èµ·æ¥:</p>
<p><strong>æ³¨æ: ä½¿ç¨FactoryBean å®å¨èªå®ä¹åå»ºBean, ä¸ä¼èµ°Beançå½å¨æçåç§ Processoråè°.</strong></p>
<pre><code class="language-java">public class MyCarFactoryBean implements FactoryBean&lt;Car&gt;{
    private String make; 
    private int year ;

    public void setMake(String m){ this.make =m ; }

    public void setYear(int y){ this.year = y; }

    public Car getObject(){ 
      // è¿éæä»¬åè®¾ Car çå®ä¾åè¿ç¨éå¸¸å¤æ, åæ­£å°±ä¸æ¯å è¡ä»£ç å¯ä»¥åå®çé£ç§
      CarBuilder cb = CarBuilder.car();

      if(year!=0) cb.setYear(this.year);
      if(StringUtils.hasText(this.make)) cb.setMake( this.make ); 
      return cb.factory(); 
    }

    public Class&lt;Car&gt; getObjectType() { return Car.class ; } 

    public boolean isSingleton() { return false; }
}
</code></pre>
<p>è£éçæ¶åæ¯æä¹éç½®ç:</p>
<pre><code class="language-xml">&lt;bean class = "com.javadoop.MyCarFactoryBean" id = "car"&gt;
  &lt;property name = "make" value ="Honda"/&gt;
  &lt;property name = "year" value ="1984"/&gt;
&lt;/bean&gt;
&lt;bean class = "com.javadoop.Person" id = "josh"&gt;
  &lt;property name = "car" ref = "car"/&gt;
&lt;/bean&gt;
</code></pre>
<p><strong>ç®èè¨ä¹ å°±æ¯å®ç° FactoryBeançæ¥å£çbean, æå ä¸ªæ¹æ³:<code>T getObject()</code> ,<code>Class&lt;?&gt; getObjectType();</code> <code>default boolean isSingleton()</code>, ç¨æ¥å°è£åå»ºå¤æçbean</strong></p>
<h1 id="å³äºå¾ªç¯ä¾èµçå¤ç">å³äºå¾ªç¯ä¾èµçå¤ç</h1>
<h2 id="ä¸ºä»ä¹è¦éè¦ä¸çº§ç¼å­">ä¸ºä»ä¹è¦éè¦ä¸çº§ç¼å­?</h2>
<p><code>singletonObjects</code>:<br>
ç¬¬ä¸çº§ç¼å­, éé¢æ¾ç½®çæ¯å·²ç»å®ä¾åå¥½çåä¾å¯¹è±¡, æ¯åä¾ç¼å­æ± ï¼singletonObjectsï¼</p>
<p><code>earlySingletonObjects</code>:<br>
ç¬¬äºçº§ç¼å­, éé¢å­æ¾çæ¯ææ©æåçåä¾å¯¹è±¡, æ©æå¯¹è±¡ï¼earlySingletonObjectsï¼. ç®åç²æ´çè¯´å°±æ¯newçå¯¹è±¡, å¯æ¯è¿ä¸ªå¯¹è±¡è¿æ²¡å¡«åå±æ§</p>
<p><code>singletonFactories</code>:<br>
ç¬¬ä¸çº§ç¼å­, éé¢å­æ¾çæ¯å°è¦è¢«å®ä¾åçå¯¹è±¡çå¯¹è±¡å·¥åï¼å­æ¾ bean å·¥åå¯¹è±¡ï¼, æ¯ä¸ä¸ªåè£¹å¯¹è±¡<code>ObjectFactory(registeredSingletons)</code>, ç»è¿getObjectè·åå°æ©æå¯¹è±¡.</p>
<p>æ­£å¸¸æ¥è®², å¤çå¾ªç¯ä¾èµ, ç±»ä¼¼äº¤æ¢åé, åªéè¦ä¸çº§ç¼å­å°±å¯ä»¥äº; å ä¸åä¾ç¼å­æ± , ä¸¤çº§ç¼å­æ± å³å¯;</p>
<pre><code class="language-js">function swap(a, b){
	temp = a;
	a = b;
	b = temp;
}
</code></pre>
<p>ä¾å¦: <code>Aservice</code> ä¾èµ Bservice, <code>Bservice</code> ä¾èµ <code>Aservice</code>.</p>
<p>åå»º <code>Aservice</code> æ¶, å°çæAçlambdaæ¾å¥ä¸çº§ç¼å­, å¡«åå±æ§ <code>Bservice</code>, ä¸äºä¸çº§ç¼å­ä¸­é½æ²¡,<br>
å»åå»º <code>Bservice</code>, å°çæBçlambdaæ¾å¥ä¸çº§ç¼å­, å¡«å <code>Aservice</code> å±æ§, åç°ä¸çº§ç¼å­ä¸­æA, æ§è¡Açlambdaçæ <code>Aservice</code> å¯¹è±¡, æ¾å¥äºçº§ç¼å­(ä¸è½æ¾ä¸çº§è¿æ¶åAçBserviceå±æ§è¿æ¯null), å¹¶å é¤Açä¸çº§ç¼å­,<br>
ç»§ç»­æ§è¡Bç lambda çæ <code>Bservice</code> å¯¹è±¡, æ¾å¥ä¸çº§ç¼å­, å¹¶å é¤Bçä¸çº§ç¼å­;<br>
åå»º <code>Aservice</code> çæµç¨ä¸­è·åå°Bserviceå¯¹è±¡ä¹å, æäºçº§ç¼å­ç <code>Aservice</code> å¯¹è±¡å é¤, å¹¶æ¾å¥ä¸çº§ç¼å­.</p>
<p>ç¬¬ä¸çº§ç¼å­æ¯å¤ç AOP å¢å¼ºçbean é®é¢:<br>
<strong>å ä¸ºä¸ç¥éå½åå¯¹è±¡ä»ä¹æ¶åä¼è¢«å¼ç¨, æä»¥åªè½å¨ç¬¬ä¸æ¬¡å¼ç¨çæ¶åæ¥å¤æ­å¯¹è±¡æ¯å¦éè¦è¢«ä»£ç, æä»¥å®æ¯ä¸ä¸ªlambdaè¡¨è¾¾å¼</strong></p>
<h1 id="å³äºçå½å¨æ">å³äºçå½å¨æ</h1>
<h2 id="springä¸­çbeançå½å¨æ">Springä¸­çBeançå½å¨æ</h2>
<p>Springä¸­çBeançå½å¨æå¯ä»¥åä¸ºä»¥ä¸å ä¸ªé¶æ®µ:</p>
<ol>
<li>å®ä¾åï¼Instantiationï¼: å¨è¿ä¸ªé¶æ®µ, Springå®¹å¨æ ¹æ®Beançéç½®ä¿¡æ¯åå»ºBeanå®ä¾. éå¸¸, è¿æ¯éè¿æé å½æ°æå·¥åæ¹æ³æ¥å®æç.</li>
<li>å±æ§èµå¼ï¼Property Assignmentï¼: å¨å®ä¾åä¹å, Springå®¹å¨å°ä¼å¯¹Beançå±æ§è¿è¡èµå¼. è¿å¯ä»¥éè¿setteræ¹æ³ãæ³¨è§£ãææé å½æ°åæ°æ¥å®ç°.</li>
<li>Awareæ¥å£åè°ï¼Aware Interface Callbacksï¼: å¨å±æ§èµå¼ä¹å, Springå®¹å¨ä¼æ£æ¥Beanæ¯å¦å®ç°äºAwareæ¥å£. å¦æå®ç°äº, å®¹å¨ä¼è°ç¨ç¸åºçAwareæ¥å£åè°æ¹æ³, è®©Beanè·åä¸å®¹å¨ç¸å³çé¢å¤ä¿¡æ¯.</li>
<li>åå§åï¼Initializationï¼: å¨å±æ§èµå¼å®æå, Springå®¹å¨ä¼è°ç¨Beançåå§ååè°æ¹æ³. è¿å¯ä»¥éè¿å®ç°InitializingBeanæ¥å£çafterPropertiesSet()æ¹æ³æå¨éç½®æä»¶ä¸­å£°æçèªå®ä¹åå§åæ¹æ³æ¥å®ç°.</li>
<li>BeanPostProcessoråè°ï¼BeanPostProcessor Callbacksï¼: å¨Beanåå§åä¹ååä¹å, Springå®¹å¨ä¼è°ç¨æ³¨åçBeanPostProcessoræ¥å£çæ¹æ³. è¿åè®¸æ¨å¨Beançåå§åè¿ç¨ä¸­è¿è¡èªå®ä¹å¤ç, å¦æ·»å é¢å¤çé»è¾æå¯¹Beanè¿è¡ä»£çåè£.</li>
<li>ä½¿ç¨ï¼Bean in Useï¼: å¨åå§åå®æå, Beanå°±å¯ä»¥è¢«åºç¨ç¨åºä½¿ç¨äº</li>
<li>éæ¯ï¼Destructionï¼: å½å®¹å¨å³é­æèä»å®¹å¨ä¸­ç§»é¤Beanæ¶, ä¼è§¦åBeançéæ¯. è¿å¯ä»¥éè¿å®ç° DisposableBean æ¥å£çdestroy()æ¹æ³æå¨éç½®æä»¶ä¸­å£°æçèªå®ä¹éæ¯æ¹æ³æ¥å®ç°.</li>
</ol>
<p>å®ä¾å -&gt; å¡«åå±æ§ -&gt; åç§Aware<br>
-&gt; è°ç¨ BeanPostProcessor (åå§å)<br>
-&gt; è°ç¨ InitializingBean -&gt; è°ç¨èªå®ä¹ init-method<br>
-&gt; è°ç¨ BeanPostProcessor (åå§å)<br>
&lt;ä½¿ç¨&gt;<br>
-&gt; è°ç¨ DisposableBean -&gt; è°ç¨èªå®ä¹ destroy-method</p>

</div>
<div id="MySignature" role="contentinfo">
    é¢é²èå¹´ç´åï¼ä¿æç»èº«å­¦ä¹ !    ââ <a href="https://www.cnblogs.com/dddy/" target="_blank">daidaidaiyu</a>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.5236111111111111" data-date-updated="2026-01-14 10:43">2026-01-13 22:09</span>&nbsp;
<a href="https://www.cnblogs.com/dddy">daidaidaiyu</a>&nbsp;
éè¯»(<span id="post_view_count">47</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479364);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479364', targetLink: 'https://www.cnblogs.com/dddy/p/19479364', title: 'Spring IOC æºç å­¦ä¹  ä¸æå­¦ä¹ å®æ´çå è½½æµç¨' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>