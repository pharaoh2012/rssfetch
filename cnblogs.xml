<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-14T16:24:59.922Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ Flinkæºç éè¯»ï¼JobManagerçHAæºå¶ ]]></title>
    <link>https://www.cnblogs.com/Jackeyzhe/p/19484622</link>
    <guid>426abbc2dbe37130daba894a07fe9ee8</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Jackeyzhe/p/19484622" title="åå¸äº 2026-01-14 23:45">
    <span role="heading" aria-level="2">Flinkæºç éè¯»ï¼JobManagerçHAæºå¶</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/1828322/202601/1828322-20260114234320282-1778052120.png" alt="Flinkæºç éè¯»ï¼JobManagerçHAæºå¶" class="desc_img">
        JobManager å¨ Flink éç¾¤ä¸­åæ¥çéè¦çä½ç¨ï¼åæ¬ä»»å¡è°åº¦åèµæºç®¡çç­å·¥ä½ãå¦æ JobManager å®æºï¼é£ä¹æ´ä¸ªéç¾¤çä»»å¡é½å°å¤±è´¥ãä¸ºäºè§£å³ JobManager çåç¹é®é¢ï¼Flink ä¹è®¾è®¡äº HA æºå¶æ¥ä¿éæ´ä¸ªéç¾¤çç¨³å®æ§ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>JobManager å¨ Flink éç¾¤ä¸­åæ¥çéè¦çä½ç¨ï¼åæ¬ä»»å¡è°åº¦åèµæºç®¡çç­å·¥ä½ãå¦æ JobManager å®æºï¼é£ä¹æ´ä¸ªéç¾¤çä»»å¡é½å°å¤±è´¥ãä¸ºäºè§£å³ JobManager çåç¹é®é¢ï¼Flink ä¹è®¾è®¡äº HA æºå¶æ¥ä¿éæ´ä¸ªéç¾¤çç¨³å®æ§ã</p>
<h3 id="åºæ¬æ¦å¿µ">åºæ¬æ¦å¿µ</h3>
<p>å¨ JobManager å¯å¨æ¶ï¼è°ç¨ <code>HighAvailabilityServicesUtils.createHighAvailabilityServices</code> æ¥åå»º HA æå¡ï¼HA ä¾èµçæå¡é½è¢«å°è£å¨ HighAvailabilityServices ä¸­ãå½å Flink åé¨æ¯æä¸¤ç§é«å¯ç¨æ¨¡å¼ï¼åå«æ¯ ZooKeeper å KUBERNETESã</p>
<pre><code class="language-java">case ZOOKEEPER:
    return createZooKeeperHaServices(configuration, executor, fatalErrorHandler);
case KUBERNETES:
    return createCustomHAServices(
            "org.apache.flink.kubernetes.highavailability.KubernetesHaServicesFactory",
            configuration,
            executor);
</code></pre>
<p>HighAvailabilityServices ä¸­æä¾çå³é®ç»ä»¶åæ¬ï¼</p>
<ul>
<li>
<p>LeaderRetrievalServiceï¼æå¡åç°ï¼ç¨äºè·åå½å leader çå°åãç®åç¨å°æå¡åç°çç»ä»¶æ ResourceManagerãDispatcherãJobManagerãClusterRestEndpointã</p>
</li>
<li>
<p>LeaderElectionï¼éä¸¾æå¡ï¼ä»å¤ä¸ªåéèä¸­éåºä¸ä¸ªä½ä¸º leaderãç¨å°éä¸¾æå¡çåæ ·æ¯ ResourceManagerãDispatcherãJobManagerãClusterRestEndpoint è¿åä¸ªã</p>
</li>
<li>
<p>CheckpointRecoveryFactoryï¼Checkpoint æ¢å¤ç»ä»¶çå·¥åç±»ï¼æä¾äºåå»º CompletedCheckpointStore å CheckpointIDCounter çæ¹æ³ãCompletedCheckpointStore æ¯ç¨äºå­å¨å·²å®æç checkpoint çåä¿¡æ¯ï¼CheckpointIDCounter æ¯ç¨äºçæ checkpoint IDã</p>
</li>
<li>
<p>ExecutionPlanStoreï¼ç¨äºå­å¨æ§è¡è®¡åã</p>
</li>
<li>
<p>JobResultStoreï¼ç¨äºå­å¨ä½ä¸ç»æï¼è¿éæä¸¤ç§ç¶æï¼ä¸ç§æ¯ dirtyï¼è¡¨ç¤ºä½ä¸æ²¡æè¢«å®å¨æ¸çï¼å¦ä¸ç§æ¯ cleanï¼è¡¨ç¤ºä½ä¸æ¸çå·¥ä½å·²ç»æ§è¡å®æäºã</p>
</li>
<li>
<p>BlobStoreï¼å­å¨ä½ä¸è¿è¡æé´çä¸äºäºè¿å¶æä»¶ã</p>
</li>
</ul>
<h4 id="éä¸¾æå¡">éä¸¾æå¡</h4>
<p>Flink çéä¸¾æ¯ä¾é  LeaderElection å LeaderContender éåå®æçãLeaderElection æ¯ LeaderElectionService çä»£çæ¥å£ï¼æä¾äºæ³¨ååéèãç¡®è®¤ leader å å¤æ­åéèæ¯å¦æ¯ leader ä¸ä¸ªæ¥å£ãLeaderContender åæ¯ç¨æ¥è¡¨ç¤ºåéèå¯¹è±¡ãå½ä¸ä¸ª LeaderContender å½é leader åï¼LeaderElectionService ä¼ä¸ºå¶çæä¸ä¸ª leaderSessionIdï¼LeaderContender ä¼è°ç¨ confirmLeadershipAsync åå¸èªå·±çå°åãéä¸¾æå¡çå·ä½å®ç°å¨ LeaderElectionDriver æ¥å£ä¸­ã</p>
<h4 id="æå¡åç°">æå¡åç°</h4>
<p>æå¡åç°çä½ç¨æ¯è·ååç»ä»¶ç leader å°åãæå¡åç°ä¾èµ LeaderRetrievalService å LeaderRetrievalListenerãLeaderRetrievalService å¯ä»¥å¯å¨ä¸ä¸ªçå¬ï¼å½ææ°ç leader å½éæ¶ï¼ä¼è°ç¨ LeaderRetrievalListener ç notifyLeaderAddress æ¹æ³ã</p>
<h4 id="ä¿¡æ¯ä¿å­">ä¿¡æ¯ä¿å­</h4>
<p>å½ leader åçåæ¢æ¶ï¼æ°ç leader éè¦è·åå°æ§ leader å­å¨çä¿¡æ¯ï¼è¿å°±éè¦æ§ leader æè¿äºä¿¡æ¯å­å¨ä¸ä¸ªå¬å±çå­å¨ä¸ãå®å¯ä»¥æ¯ ZooKeeper æ Kubernetes çå­å¨ï¼ä¹å¯ä»¥æ¯åå¸å¼æä»¶ç³»ç»çå­å¨ã</p>
<h3 id="åºäº-zookeeper-ç-ha">åºäº ZooKeeper ç HA</h3>
<h4 id="éä¸¾æå¡-1">éä¸¾æå¡</h4>
<p>åé¢æä»¬æå°äºéä¸¾æå¡ä¸»è¦ä¾èµ LeaderElection å LeaderContender éåå®æãæä»¬å°±ä»¥ JobManager ä¸ºä¾ï¼çä¸ä¸æºé ZooKeeper çéä¸¾æµç¨çå·ä½å®ç°ã</p>
<p><img alt="ZKLeaderElection" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1767924499/Blog/flink/20/ZKLeaderElection.png" class="lazyload"></p>
<p>å¾ä¸­ JobMasterServiceLeadershipRunner æ¯ LeaderContender çå®ç°ç±»ãå¨å¯å¨æå¡æ¶ï¼ä¼å LeaderElection æ³¨åèªå·±çä¿¡æ¯ï¼å®éæ§è¡èæ¯ DefaultLeaderElectionServiceãå®ååå»ºäº LeaderElectionDriverï¼ç¶åå° LeaderContender ä¿å­å¨ leaderContenderRegistry ä¸­ãéä¸¾çæ ¸å¿é»è¾å°è£å¨ LeaderElectionDriver ä¸­ã</p>
<p>å¨åå»º LeaderElectionDriver æ¶ï¼ä¼åå»º LeaderLatch å¯¹è±¡å TreeCache å¯¹è±¡ï¼ LeaderLatch å°è£äºä¸ ZooKeeper å³èçåè°ï¼ä¼æ¥æ¶ä¸ä¸ª LeaderElectionDriver ä½ä¸ºçå¬ãTreeCache ä¸»è¦ç¨äºçå¬ ZooKeeper ä¸­ leader èç¹çåæ´ã</p>
<pre><code class="language-java">public ZooKeeperLeaderElectionDriver(
        CuratorFramework curatorFramework, LeaderElectionDriver.Listener leaderElectionListener)
        throws Exception {
    ...
    this.leaderLatch = new LeaderLatch(curatorFramework, ZooKeeperUtils.getLeaderLatchPath());
    this.treeCache =
            ZooKeeperUtils.createTreeCache(
                    curatorFramework,
                    "/",
                    new ZooKeeperLeaderElectionDriver.ConnectionInfoNodeSelector());

    treeCache
            .getListenable()
            .addListener(
                    (client, event) -&gt; {
                        switch (event.getType()) {
                            case NODE_ADDED:
                            case NODE_UPDATED:
                                Preconditions.checkNotNull(
                                        event.getData(),
                                        "The ZooKeeper event data must not be null.");
                                handleChangedLeaderInformation(event.getData());
                                break;
                            case NODE_REMOVED:
                                Preconditions.checkNotNull(
                                        event.getData(),
                                        "The ZooKeeper event data must not be null.");
                                handleRemovedLeaderInformation(event.getData().getPath());
                                break;
                        }
                    });

    leaderLatch.addListener(this);
    ...
    leaderLatch.start();
    treeCache.start();
}
</code></pre>
<p>æä»¬è¿å¥å° LeaderLatch ç start æ¹æ³ãå®çåé¨æ¯å¨ ZooKeeper ä¸åå»º latch-xxx èç¹ãxxx æ¯å½å LeaderLatch ç IDï¼å®ç± ZooKeeper çæï¼ID æå°çå½é Leaderã</p>
<pre><code class="language-java">private void checkLeadership(List&lt;String&gt; children) throws Exception {
    if (this.debugCheckLeaderShipLatch != null) {
        this.debugCheckLeaderShipLatch.await();
    }

    String localOurPath = (String)this.ourPath.get();
    List&lt;String&gt; sortedChildren = LockInternals.getSortedChildren("latch-", sorter, children);
    int ourIndex = localOurPath != null ? sortedChildren.indexOf(ZKPaths.getNodeFromPath(localOurPath)) : -1;
    this.log.debug("checkLeadership with id: {}, ourPath: {}, children: {}", new Object[]{this.id, localOurPath, sortedChildren});
    if (ourIndex &lt; 0) {
        this.log.error("Can't find our node. Resetting. Index: " + ourIndex);
        this.reset();
    } else if (ourIndex == 0) {
        this.lastPathIsLeader.set(localOurPath);
        this.setLeadership(true);
    } else {
        this.setLeadership(false);
        String watchPath = (String)sortedChildren.get(ourIndex - 1);
        Watcher watcher = new Watcher() {
            public void process(WatchedEvent event) {
                if (LeaderLatch.this.state.get() == LeaderLatch.State.STARTED &amp;&amp; event.getType() == EventType.NodeDeleted) {
                    try {
                        LeaderLatch.this.getChildren();
                    } catch (Exception ex) {
                        ThreadUtils.checkInterrupted(ex);
                        LeaderLatch.this.log.error("An error occurred checking the leadership.", ex);
                    }
                }

            }
        };
        BackgroundCallback callback = new BackgroundCallback() {
            public void processResult(CuratorFramework client, CuratorEvent event) throws Exception {
                if (event.getResultCode() == Code.NONODE.intValue()) {
                    LeaderLatch.this.getChildren();
                }

            }
        };
        ((ErrorListenerPathable)((BackgroundPathable)this.client.getData().usingWatcher(watcher)).inBackground(callback)).forPath(ZKPaths.makePath(this.latchPath, watchPath));
    }

}
</code></pre>
<p>å½é Leader åï¼ä¼åè° LeaderElectionDriver ç isLeader æ¹æ³ï¼å¦ææªå½éï¼åç»§ç»­çå¬ latch èç¹çåæ´ãisLeader ä¼ç»§ç»­åè° LeaderElection ç onGrantLeadership æ¹æ³ï¼æ¥çè°ç¨ LeaderContender ç grantLeadershipãè¿æ¶ä¼å¯å¨ JobMaster æå¡ï¼ç¶åè°ç¨ LeaderElection ç confirmLeadershipAsync æ¥ç¡®è®¤å½éæåãç¡®è®¤çè¿ç¨æ¯ç± LeaderElectionDriver æ¥æ§è¡çãä¸»è¦ä½ç¨æ¯æå½å leader çä¿¡æ¯ååå° ZooKeeper ç connection_info èç¹ã</p>
<pre><code class="language-java">public void publishLeaderInformation(String componentId, LeaderInformation leaderInformation) {
    Preconditions.checkState(running.get());

    if (!leaderLatch.hasLeadership()) {
        return;
    }

    final String connectionInformationPath =
            ZooKeeperUtils.generateConnectionInformationPath(componentId);

    LOG.debug(
            "Write leader information {} for component '{}' to {}.",
            leaderInformation,
            componentId,
            ZooKeeperUtils.generateZookeeperPath(
                    curatorFramework.getNamespace(), connectionInformationPath));

    try {
        ZooKeeperUtils.writeLeaderInformationToZooKeeper(
                leaderInformation,
                curatorFramework,
                leaderLatch::hasLeadership,
                connectionInformationPath);
    } catch (Exception e) {
        leaderElectionListener.onError(e);
    }
}
</code></pre>
<h4 id="æå¡åç°-1">æå¡åç°</h4>
<p>æ¢³çå®éä¸¾æå¡çæºç åï¼æä»¬åæ¥çä¸ä¸æå¡åç°çè¿ç¨ãæä»¬ä»¥ TaskManager è·å JobManager ç leader ä¸ºä¾ã</p>
<p><img alt="ZKLeaderRetrieval" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1767929447/Blog/flink/20/ZKLeaderRetrieval.png" class="lazyload"></p>
<p>å½æä»¬å¾ TaskManager æ·»å ä»»å¡æ¶ï¼ä¼è°ç¨ JobLeaderService ç addJob æ¹æ³ãè¿éä¼åè·å LeaderRetrievalï¼ç¶åè°ç¨ start æ¹æ³æ³¨å LeaderRetrievalListener çå¬ï¼å¹¶åå»º LeaderRetrievalDriverãå¨ LeaderRetrievalDriver ä¸­ä¸»è¦æ¯å ZooKeeper æ³¨å connection_info èç¹çåæ´ã</p>
<p>å¦æåçåæ´ï¼ZooKeeper ä¼åè° <code>LeaderRetrievalDriver.retrieveLeaderInformationFromZooKeeper</code> æ¹æ³ãæä»¬ä» ZooKeeper è·åå° leader çå°åå sessionId åï¼å°±åè° <code>LeaderRetrievalService.notifyLeaderAddress</code> æ¹æ³ãæç»è°ç¨å° JobLeaderService ç notifyLeaderAddress æ¹æ³ï¼è¿ä¸ªæ¹æ³ä¸­å°±æ¯æ­å¼ä¸æ§ leader çè¿æ¥ï¼å¢å ä¸æ° leader çè¿æ¥ã</p>
<h4 id="ä¿¡æ¯ä¿å­-1">ä¿¡æ¯ä¿å­</h4>
<p>æåæä»¬åæ¥çä¿¡æ¯ä¿å­ç¸å³çæºç ãå¨ JobManager å®æä¸æ¬¡ Checkpoint æ¶ï¼ä¼æ§è¡ <code>CheckpointCoordinator.completePendingCheckpoint</code> æ¹æ³ï¼è·éè°ç¨é¾è·¯å¯ä»¥æ¾å° <code>ZooKeeperStateHandleStore.addAndLock</code> æ¹æ³ï¼è¿éä¼æç¶æåå¥å°æä»¶ç³»ç»ä¸­ï¼ç¶åææä»¶è·¯å¾ä¿å­å¨ ZooKeeper ä¸­ã</p>
<pre><code class="language-java">public RetrievableStateHandle&lt;T&gt; addAndLock(String pathInZooKeeper, T state)
        throws PossibleInconsistentStateException, Exception {
    checkNotNull(pathInZooKeeper, "Path in ZooKeeper");
    checkNotNull(state, "State");
    final String path = normalizePath(pathInZooKeeper);
    final Optional&lt;Stat&gt; maybeStat = getStat(path);

    if (maybeStat.isPresent()) {
        if (isNotMarkedForDeletion(maybeStat.get())) {
            throw new AlreadyExistException(
                    String.format("ZooKeeper node %s already exists.", path));
        }

        Preconditions.checkState(
                releaseAndTryRemove(path),
                "The state is marked for deletion and, therefore, should be deletable.");
    }

    final RetrievableStateHandle&lt;T&gt; storeHandle = storage.store(state);
    final byte[] serializedStoreHandle = serializeOrDiscard(storeHandle);
    try {
        writeStoreHandleTransactionally(path, serializedStoreHandle);
        return storeHandle;
    } catch (KeeperException.NodeExistsException e) {
        // Transactions are not idempotent in the curator version we're currently using, so it
        // is actually possible that we've re-tried a transaction that has already succeeded.
        // We've ensured that the node hasn't been present prior executing the transaction, so
        // we can assume that this is a result of the retry mechanism.
        return storeHandle;
    } catch (Exception e) {
        if (indicatesPossiblyInconsistentState(e)) {
            throw new PossibleInconsistentStateException(e);
        }
        // In case of any other failure, discard the state and rethrow the exception.
        storeHandle.discardState();
        throw e;
    }
}
</code></pre>
<p>è³æ­¤ï¼åºäº ZooKeeper ç HA é»è¾æä»¬å°±æ¢³çå®äºãä» 1.12 çæ¬å¼å§ï¼Flink è¿æ¯æäº Kubernetes é«å¯ç¨ï¼ä¸é¢æä»¬åæ¥ä¸ä¸å®æ¯å¦ä½å®ç°çã</p>
<h3 id="åºäº-kubernetes-ç-ha">åºäº Kubernetes ç HA</h3>
<h4 id="éä¸¾æå¡-2">éä¸¾æå¡</h4>
<p>éè¿åé¢çå­¦ä¹ ï¼æä»¬å·²ç»äºè§£å°ï¼éä¸¾çä¸»è¦é»è¾æ¯å¨ LeaderElectionDriver ä¸­ï¼å æ­¤ï¼æä»¬ç´æ¥æ¥ç KubernetesLeaderElectionDriver çé»è¾å³å¯ãåå»º KubernetesLeaderElectionDriver æ¶ï¼åå»ºå¹¶å¯å¨äº KubernetesLeaderElectorãè¿ä¸ªç±»ä¼¼äº ZooKeeper é»è¾ä¸­ LeaderLatchï¼ä¼è· Kubernetes åºå±çéä¸¾é»è¾äº¤äºï¼åæ¶æ³¨åçå¬ã</p>
<pre><code class="language-java">public KubernetesLeaderElector(
        NamespacedKubernetesClient kubernetesClient,
        KubernetesLeaderElectionConfiguration leaderConfig,
        LeaderCallbackHandler leaderCallbackHandler,
        ExecutorService executorService) {
    this.kubernetesClient = kubernetesClient;
    this.leaderElectionConfig =
            new LeaderElectionConfigBuilder()
                    .withName(leaderConfig.getConfigMapName())
                    .withLeaseDuration(leaderConfig.getLeaseDuration())
                    .withLock(
                            new ConfigMapLock(
                                    new ObjectMetaBuilder()
                                            .withNamespace(kubernetesClient.getNamespace())
                                            .withName(leaderConfig.getConfigMapName())
                                            // Labels will be used to clean up the ha related
                                            // ConfigMaps.
                                            .withLabels(
                                                    KubernetesUtils.getConfigMapLabels(
                                                            leaderConfig.getClusterId()))
                                            .build(),
                                    leaderConfig.getLockIdentity()))
                    .withRenewDeadline(leaderConfig.getRenewDeadline())
                    .withRetryPeriod(leaderConfig.getRetryPeriod())
                    .withReleaseOnCancel(true)
                    .withLeaderCallbacks(
                            new LeaderCallbacks(
                                    leaderCallbackHandler::isLeader,
                                    leaderCallbackHandler::notLeader,
                                    newLeader -&gt;
                                            LOG.info(
                                                    "New leader elected {} for {}.",
                                                    newLeader,
                                                    leaderConfig.getConfigMapName())))
                    .build();
    this.executorService = executorService;

    LOG.info(
            "Create KubernetesLeaderElector on lock {}.",
            leaderElectionConfig.getLock().describe());
}
</code></pre>
<p>éä¸¾æååï¼ä¼åè° <code>LeaderElectionListener.onGrantLeadership</code> æ¹æ³ãåç»­çè°ç¨é¾è·¯è¿æ¯ä¼è°ç¨å° <code>KubernetesLeaderElectionDriver.publishLeaderInformation</code> æ¹æ³ãè¿ä¸ªæ¹æ³æ¯æ leader ä¿¡æ¯åå° Kubernetes ç configMap ä¸­ã</p>
<pre><code class="language-java">public void publishLeaderInformation(String componentId, LeaderInformation leaderInformation) {
    Preconditions.checkState(running.get());

    try {
        kubeClient
                .checkAndUpdateConfigMap(
                        configMapName,
                        updateConfigMapWithLeaderInformation(componentId, leaderInformation))
                .get();
    } catch (InterruptedException | ExecutionException e) {
        leaderElectionListener.onError(e);
    }

    LOG.debug(
            "Successfully wrote leader information {} for leader {} into the config map {}.",
            leaderInformation,
            componentId,
            configMapName);
}
</code></pre>
<h4 id="æå¡åç°-2">æå¡åç°</h4>
<p>æå¡åç°çé»è¾å¨ KubernetesLeaderRetrievalDriver ç±»ä¸­ï¼å¨åå»ºæ¶ï¼ä¼å°åé¨ç±» ConfigMapCallbackHandlerImpl æ³¨åä¸ºçå¬åè°ç±»ã</p>
<p>å½ configMap ææ°å¢æåæ´åï¼ä¼åè° <code>LeaderRetrievalService.notifyLeaderAddress</code> æ¹æ³ã</p>
<pre><code class="language-java">private class ConfigMapCallbackHandlerImpl
        implements FlinkKubeClient.WatchCallbackHandler&lt;KubernetesConfigMap&gt; {

    @Override
    public void onAdded(List&lt;KubernetesConfigMap&gt; configMaps) {
        // The ConfigMap is created by KubernetesLeaderElectionDriver with
        // empty data. We don't really need to process anything unless the retriever was started
        // after the leader election has already succeeded.
        final KubernetesConfigMap configMap = getOnlyConfigMap(configMaps, configMapName);
        final LeaderInformation leaderInformation = leaderInformationExtractor.apply(configMap);
        if (!leaderInformation.isEmpty()) {
            leaderRetrievalEventHandler.notifyLeaderAddress(leaderInformation);
        }
    }

    @Override
    public void onModified(List&lt;KubernetesConfigMap&gt; configMaps) {
        final KubernetesConfigMap configMap = getOnlyConfigMap(configMaps, configMapName);
        leaderRetrievalEventHandler.notifyLeaderAddress(
                leaderInformationExtractor.apply(configMap));
    }
    ...
}
</code></pre>
<h4 id="ä¿¡æ¯ä¿å­-2">ä¿¡æ¯ä¿å­</h4>
<p>ä¿¡æ¯ä¿å­çé»è¾å ZooKeeper ä¹éå¸¸ç±»ä¼¼ãå³åæ state ä¿å­å¨æä»¶ç³»ç»ï¼ç¶åæå­å¨è·¯å¾åå° Kubernetes åå° configMap ä¸­ãå·ä½å¯ä»¥ç <code>KubernetesStateHandleStore.addAndLock</code> æ¹æ³ã</p>
<h3 id="æ»ç»">æ»ç»</h3>
<p>æ¬ææä»¬ä¸èµ·æ¢³çäº Flink ä¸­ JobManager ç HA æºå¶ç¸å³æºç ãç®å Flink æ¯æ ZooKeeper å Kubernetes ä¸¤ç§å®ç°ãå¨æ¢³çè¿ç¨ä¸­ï¼æä»¬ä»¥ JobManager ä¸ºä¾ï¼å¶ä»å ä¸ªç¨å°é«å¯ç¨çæå¡çéä¸¾é»è¾ä¹æ¯ä¸æ ·çã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 23:46">2026-01-14 23:45</span>&nbsp;
<a href="https://www.cnblogs.com/Jackeyzhe">Jackeyzhe</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19484622);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19484622', targetLink: 'https://www.cnblogs.com/Jackeyzhe/p/19484622', title: 'Flinkæºç éè¯»ï¼JobManagerçHAæºå¶' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å°ç½å­¦AIå¼å01ï¼åå»ºç¬¬ä¸ä¸ªç¤ºä¾Agent ]]></title>
    <link>https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l</link>
    <guid>445f0dafcb9d3942e311ecccb283a175</guid>
    <description>
    <![CDATA[ 
    <a name="top"></a>
    <h2><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l" title="åå¸äº 2026-01-14 23:43">
    <span role="heading" aria-level="2">å°ç½å­¦AIå¼å01ï¼åå»ºç¬¬ä¸ä¸ªç¤ºä¾Agent</span>
    

</a>
</h2>
    <small>
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 23:43">2026-01-14 23:43</span>&nbsp;
<a href="https://www.cnblogs.com/jyzhao">AlfredZhao</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19484508);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19484508', targetLink: 'https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l', title: 'å°ç½å­¦AIå¼å01ï¼åå»ºç¬¬ä¸ä¸ªç¤ºä¾Agent' })">ä¸¾æ¥</a>
</small>
    <div class="entry">
        <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨ LangChain å¼åä¸­ï¼æä»¬çæ ¸å¿å·¥ä½æ¯å Promptï¼æç¤ºè¯ï¼ã</p>
<p>é¤æ­¤ä¹å¤ï¼è¿éè¦äºè§£ä¸pythonåºç¡ï¼ç®åäºè§£å³å¯ï¼ä¸éè¦ç³»ç»å­¦ä¹ ï¼è¿å°±æ¯AIæ¶ä»£å¯¹ææ¯ç±å¥½èççº¢å©ã</p>
<h2 id="01--æå»ºç¬ç«çpythonç¯å¢">01 | æå»ºç¬ç«çpythonç¯å¢</h2>
<p>ä½¿ç¨minicondaæå»ºç¬ç«çpythonç¯å¢ã</p>
<p>å®æ¹ç½ç«ï¼<a href="https://www.anaconda.com/" target="_blank" rel="noopener nofollow">https://www.anaconda.com/</a></p>
<p>éæ©éåä½ çï¼æè¿éç´æ¥éæ©å¾å½¢åå®è£çMinicondaï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202601/635610-20260114224646258-840865368.jpg" alt="" loading="lazy"></p>
<p>ä¸è½½åå®è£ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202601/635610-20260114224646142-163182582.jpg" alt="" loading="lazy"></p>
<p>å³é­å¹¶éæ°æå¼ç»ç«¯ãæ­¤æ¶ä½ ä¼çå°å½ä»¤è¡åé¢å¤äºä¸ª (base)ï¼è¿è¯´æ Conda å·²ç»æ¥ç®¡äºç¯å¢ã</p>
<p>ç¶ååå»º Python 3.12 ä¸å±å­¦ä¹ ç¯å¢ï¼</p>
<pre><code class="language-BASH"># åå»ºç¯å¢å¹¶æå® Python çæ¬
conda create -n lc python=3.12 -y

# æ¿æ´»ç¯å¢
conda activate lc
</code></pre>
<p>Tipsï¼å¦æåå»ºç¯å¢ï¼éå°è®©åææå¡/æ¡æ¬¾ä¹ç±»ï¼ç´æ¥ææç¤ºå½ä»¤æ§è¡åæå³å¯ã</p>
<p>åé¢æµè¯ä¸ååè½çpythonç¨åºè¯å®åä¸äºå¼ç¨åç§ç±»åçåï¼æä»¬ç»ä¸æ¾å° requirements.txt ä¸­ï¼åç»­æ°ç¯å¢ä¹å¯ä»¥ç´æ¥ä¸é®å®è£éè¦å¼å¥çç¸å³åã</p>
<pre><code class="language-BASH">pip install -r requirements.txt
</code></pre>
<p>å®æç»´æ¤requirements.txtæä»¶ï¼</p>
<pre><code class="language-BASH">langchain
langchain-openai
python-dotenv
</code></pre>
<h2 id="02--åå»ºç¬¬ä¸ä¸ªç¤ºä¾agent">02 | åå»ºç¬¬ä¸ä¸ªç¤ºä¾Agent</h2>
<p>è¿éä»¿ç§LangChainå®æ¹ææ¡£ï¼æå»ºä¸ä¸ªç®åçAgentã</p>
<ul>
<li><a href="https://docs.langchain.com/oss/python/langchain/quickstart" target="_blank" rel="noopener nofollow">https://docs.langchain.com/oss/python/langchain/quickstart</a></li>
</ul>
<p>å ä¸ºç¬èææ¶æ²¡æClaudeæ¨¡åå¯ç¨ï¼æä»¥æ¿æ¢ä¸ºå½åçæ¨¡åï¼å¨æä»¬å­¦ä¹ æµè¯é¶æ®µï¼åºæ¬æ¯æ²¡å¥å½±åçã</p>
<p>vi basic.py</p>
<pre><code class="language-python">import os
from dotenv import load_dotenv
from langchain.agents import create_agent
from langchain_openai import ChatOpenAI
from langchain.tools import tool

# å è½½ .env æä»¶ä¸­ç SILICONFLOW_API_KEY
load_dotenv()

# 1. å®ä¹å·¥å·ï¼å¿é¡»è¦åæ¸æ°ç Docstringï¼å½æ°æ³¨éï¼
@tool
def get_weather(city: str) -&gt; str:
    """è·åæå®åå¸çå®æ¶å¤©æ°æåµã"""
    return f"{city} çå¤©æ°æ»æ¯é´é¨è¿è¿ï¼"

# 2. åå§å SiliconFlow æ¨¡å
llm = ChatOpenAI(
    model="deepseek-ai/DeepSeek-V3", 
    api_key=os.getenv("SILICONFLOW_API_KEY"),
    base_url="https://api.siliconflow.cn/v1",
    temperature=0.1
)

# 3. åå»º Agent
agent = create_agent(
    model=llm,
    tools=[get_weather],
    system_prompt="ä½ æ¯ä¸ä¸ªä¹äºå©äººçå¤©æ°å©æã"
)

# 4. è¿è¡
if __name__ == "__main__":
    response = agent.invoke(
        {"messages": [{"role": "user", "content": "åäº¬å¤©æ°æä¹æ ·ï¼"}]}
    )
    # æå°æåä¸æ¡æ¶æ¯ï¼AI çåç­ï¼
    print(response["messages"][-1].content)
</code></pre>
<h2 id="03--å¢å¼ºè¿ä¸ªç¤ºä¾agent">03 | å¢å¼ºè¿ä¸ªç¤ºä¾Agent</h2>
<p>æ±åå¹¶ç¨å¾®æ¹é ä¸å®æ¹çç¤ºä¾ï¼ä½¿å¶éç¨äºæä»¬çæµè¯ç¯å¢ï¼</p>
<p>vi enhance.py</p>
<pre><code class="language-PYTHON">import os
from dataclasses import dataclass
from dotenv import load_dotenv

from langchain_openai import ChatOpenAI
from langchain.agents import create_agent
from langchain.tools import tool, ToolRuntime
from langgraph.checkpoint.memory import InMemorySaver
from langchain.agents.structured_output import ToolStrategy

load_dotenv()

# 1. å®ä¹ç³»ç»æç¤ºè¯ï¼è¦æ± AI åä¸ªâè°é³æ¢âä¸å®¶ï¼
SYSTEM_PROMPT = """ä½ æ¯ä¸ä½ä¸ä¸çèµæ·±å¤©æ°é¢æ¥åï¼è¯´è¯æå¶å¹½é»ï¼ç¹å«åæ¬¢è®²âè°é³æ¢âã

ä½ ææä½¿ç¨ä»¥ä¸ä¸¤ä¸ªå·¥å·ï¼
- get_weather_for_location: è·åç¹å®åå¸çå¤©æ°ã
- get_user_location: è·åå½åç¨æ·çæå¨å°ã

å¦æç¨æ·è¯¢é®å¤©æ°ï¼è¯·å¡å¿ç¡®è®¤å°ç¹ãå¦æç¨æ·è¯´çæ¯âæè¿å¿âæâæè¿éâï¼è¯·è°ç¨ get_user_location è·åä»ä»¬çä½ç½®ã"""

# 2. å®ä¹ä¸ä¸æç»æï¼å­å¨ç¨æ·ä¿¡æ¯ï¼
@dataclass
class Context:
    """èªå®ä¹è¿è¡æ¶ä¸ä¸æã"""
    user_id: str

# 3. å®ä¹å·¥å·
@tool
def get_weather_for_location(city: str) -&gt; str:
    """è·åæå®åå¸çå¤©æ°æåµã"""
    return f"{city} çå¤©æ°æ»æ¯é³åç¿çï¼"

@tool
def get_user_location(runtime: ToolRuntime[Context]) -&gt; str:
    """æ ¹æ®ç¨æ· ID è·åå¶å°çä½ç½®ã"""
    user_id = runtime.context.user_id
    # æ¨¡ææ°æ®åºï¼ç¨æ· 1 å¨åäº¬ï¼å¶ä»å¨ç æµ·
    return "åäº¬" if user_id == "1" else "ç æµ·"

# 4. éç½®ä½ çæ¨¡å (SiliconFlow)
model = ChatOpenAI(
    model="deepseek-ai/DeepSeek-V3",
    api_key=os.getenv("SILICONFLOW_API_KEY"),
    base_url="https://api.siliconflow.cn/v1",
    temperature=0.7  # ç¨å¾®æé«éæºæ§ï¼è®©è°é³æ¢æ´æåæ
)

# 5. å®ä¹ååºæ ¼å¼ï¼æ±åå­æ®µæè¿°ï¼è®© AI æç½å¡«ä»ä¹ï¼
@dataclass
class ResponseFormat:
    """Agent çç»æååå¤æ ¼å¼ã"""
    # å¹½é»çè°é³æ¢åå¤
    punny_response: str
    # ä»»ä½å³äºå¤©æ°çæè¶£ä¿¡æ¯ï¼å¦ææçè¯ï¼
    weather_conditions: str | None = None

# 6. è®¾ç½®è®°å¿å­å¨
checkpointer = InMemorySaver()

# 7. åå»º Agent
agent = create_agent(
    model=model,
    system_prompt=SYSTEM_PROMPT,
    tools=[get_user_location, get_weather_for_location],
    context_schema=Context,
    response_format=ToolStrategy(ResponseFormat),
    checkpointer=checkpointer
)

# --- è¿è¡æµè¯ ---

# è®¾ç½®ä¼è¯ ID
config = {"configurable": {"thread_id": "test_user_001"}}

# ç¬¬ä¸æ¬¡æé®
print("--- ç¬¬ä¸æ¬¡å¯¹è¯ ---")
response = agent.invoke(
    {"messages": [{"role": "user", "content": "å¤é¢å¤©æ°æä¹æ ·ï¼"}]},
    config=config,
    context=Context(user_id="1")
)

# è®¿é®ç»æåç»æ
res = response['structured_response']
print(f"AI: {res.punny_response}")
print(f"è¯¦æ: {res.weather_conditions}")

print("\n--- ç¬¬äºæ¬¡å¯¹è¯ï¼æµè¯è®°å¿ï¼ ---")
# ç¬¬äºæ¬¡æé®
response = agent.invoke(
    {"messages": [{"role": "user", "content": "è°¢è°¢ä½ ï¼æå¨åªéï¼"}]},
    config=config,
    context=Context(user_id="1")
)

res = response['structured_response']
print(f"AI: {res.punny_response}")
</code></pre>
<p>è¿æ®µç¤ºä¾ä»£ç çæ ¸å¿é»è¾æ¯ï¼</p>
<p><strong>ç¬¬ä¸æ¬¡å¯¹è¯ï¼</strong></p>
<p>ç¨æ·é®ï¼âå¤é¢å¤©æ°æä¹æ ·ï¼âï¼æ²¡è¯´å°ç¹ï¼ã<br>
AI æèï¼ç³»ç»æç¤ºè¯åè¯æï¼å¦æå°ç¹ä¸æï¼åå»æ¥ç¨æ·å¨åªã<br>
å¨ä½ï¼AI è°ç¨ get_user_location -&gt; å¾å°âåäº¬â -&gt; è°ç¨ get_weather_for_location -&gt; å¾å°å¤©æ°ã<br>
åå¤ï¼æ ¹æ® ResponseFormat ååºä¸ä¸ªè°é³æ¢ã</p>
<p><strong>ç¬¬äºæ¬¡å¯¹è¯ï¼</strong></p>
<p>ç¨æ·é®ï¼âè°¢è°¢ä½ ï¼æå¨åªéï¼â<br>
AI æèï¼ç±äºæ thread_id å checkpointerï¼AI è®°å¾ä¸ä¸æ¬¡æ¥è¯¢çç»æã<br>
å¨ä½ï¼å®ä¸éè¦åæ¬¡æ¥å·¥å·ï¼ç´æ¥ä»è®°å¿éæåä¿¡æ¯å¹¶åå¤ã</p>
<p>ç¶åæå·¥å°ä»£ç ä¸­ç user_id æ¹ä¸º2ï¼åæ¬¡è¿è¡ï¼å°±ä¼æ ¹æ®å·¥å· <code>get_user_location</code> ä¸­çç¤ºä¾é»è¾ï¼å¾å°å°ç¹ä¸ºâç æµ·âï¼ä¸¤æ¬¡æ§è¡çææåèå¦ä¸ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202601/635610-20260114224646132-69223909.jpg" alt="" loading="lazy"></p>
<p>è¯¥æ®µç¤ºä¾ä»£ç è½ç¶ç®åï¼ä½å¶å®å·²ç»è½å±ç°åºä¸ä¸ªä¼ä¸çº§ AI æºè½ä½ï¼Agentï¼çç¼©å½±ãå®æ¶µçäºç°ä»£ AI å¼åä¸­ææ ¸å¿çä¸ä¸ªæ¯æ±ï¼å·¥å·è°ç¨ï¼Tool Useï¼ãä¸ä¸æè®°å¿ï¼Memoryï¼ãä»¥åç»æåè¾åºï¼Structured Outputï¼ã</p>

</div>
<div id="MySignature" role="contentinfo">
    <a href="https://www.cnblogs.com/jyzhao/" target="_blank">AlfredZhao</a>Â©çæææãä»Oracleèµ·èªï¼é¢ç¥ç²¾å½©çITææ¯ãã<br>
è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l" target="_blank">https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l</a>
<hr>
<div style="text-align:center; margin-top:30px;">
  <p style="font-size:14px;color:#555;">
    ð æè°¢éè¯»ï¼æ¬¢è¿å³æ³¨æçå¬ä¼å· <b>ãèµµéå®ã</b>
  </p>
  <img src="https://images.cnblogs.com/cnblogs_com/jyzhao/824234/o_250208075013_qrcode-zjy.jpg" width="160" style="border:1px solid #ddd;border-radius:8px;">
</div>
</div>
<div class="clear"></div>

        <div class="clear"></div>
        
</div>
    <ul class="postmetadata">
        <vc:categories-tags blog-app="jyzhao" blog-id="186567" post-id="19484508"></vc:categories-tags>
    </ul>
 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Claude Code æä½³å®è·µç 8 æ¡é»éæ³å ]]></title>
    <link>https://www.cnblogs.com/didispace/p/19484090</link>
    <guid>3b877ccb5da5ed512523a6abc76d9854</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/didispace/p/19484090" title="åå¸äº 2026-01-14 19:53">
    <span role="heading" aria-level="2">Claude Code æä½³å®è·µç 8 æ¡é»éæ³å</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>ä¸ºä»ä¹åæ ·æ¯è°ç¨ Claudeï¼æçäººè½ååºå·¥ä¸çº§ä»£ç ï¼èæçäººåªæ¯å¨ä¸æ­å ç§¯âææ¯åºâï¼ ä»å¤©åäº«ä¸ä½æ¥æ 7 å¹´ AmazonãDisney å¤§åç»éªãç°ä»»åä¸å¬å¸ CTO åäº«çå®ææåãä»æ Claude Code å½ä½æ¯æ¥ä¸»åå·¥å·ï¼å¹¶æ»ç»åºäºä¸å¥é«é¶ç©å®¶æåãä»âåæèåæ²å­âçæ¶æéå¾ï¼å°è®© AI ç§æä½ ç CLAUDE.md æ·±åº¦éç½®ï¼å¨æ¯é¿åæåãå¦æä½ æ³è®© AI çæ­£æä¸ºä½ ççäº§åé£è½®ï¼è¿ç¯æç« ç»å¯¹å¼å¾æ¶èåå¤è¯»ï¼</p>
<p><img alt="f02adbeb1a8c005df0134224ed8c0d1b.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/626506/202601/626506-20260114195205678-715088109.png" class="lazyload"></p>
<p>ä¸é¢æ¯å¯¹è¿ç¯æç« çæ»ç»è§£è¯»ï¼å¦æå¯¹åææå´è¶£ä¹å¯ä»¥æ³è¿éæ¥çï¼<a href="https://x.com/eyad_khrais/status/2010076957938188661" target="_blank" rel="noopener nofollow">ãThe complete claude code tutorial ã</a></p>
<h2 id="æ³åä¸åæèåè¾å¥è®¡åæ¨¡å¼æ¯ä½ æå¼ºå¤§çæ­¦å¨">æ³åä¸ï¼åæèï¼åè¾å¥ï¼è®¡åæ¨¡å¼æ¯ä½ æå¼ºå¤§çæ­¦å¨ã</h2>
<p>å¤§å¤æ°äººè®¤ä¸ºä½¿ç¨AIå·¥å·çç¬¬ä¸æ­¥å°±æ¯ç´æ¥å¼å§è¾å¥æç¤ºè¯ãè¿æ¯ä½ è½ç¯ä¸çæå¤§éè¯¯ä¹ä¸ãçæ­£è³å³éè¦ä¸å¿é¡»ååçç¬¬ä¸æ­¥æ¯ââæèåè®¡åã</p>
<p>æ100%çç»éªè¡¨æï¼ä½¿ç¨âè®¡åæ¨¡å¼âï¼è¿æä¸¤æ¬¡ Shift+Tab é®è¿å¥ï¼å¾å°çè¾åºï¼è¿èäºç´æ¥æ»æ»ä¸ç»å°è¾å¥æ³æ³ãè¿ç§å·®è·æ¯ååæ§çã</p>
<p>å½ç¶ï¼å¯¹äºä¸äºç»éªä¸è¶³çå·¥ç¨å¸æ¥è¯´ï¼è¿å¯è½è¯´èµ·æ¥å®¹æåèµ·æ¥é¾ãå¯¹æ­¤ï¼ææä¸¤æ¡å»ºè®®ï¼</p>
<ol>
<li>å¼å§å­¦ä¹ ã å³ä½¿æ¯æ¬¡åªå­¦ä¸ç¹ï¼ä¹å¿é¡»å¼å§ç§¯ç´¯ãå¦æä½ æ°¸è¿ä¸ææ¡è§åè½åï¼ä½ å°±æ¯å¨ç»èªå·±è®¾ç½®éç¢ã</li>
<li>ä¸AIæ·±åº¦äº¤æµã åClaudeè¿è¡ä¸åºæ·±å¥çãååçå¯¹è¯ãè¯¦ç»æè¿°ä½ æ³æå»ºä»ä¹ï¼è¯¢é®å®å¨ç³»ç»è®¾è®¡ä¸æä»ä¹ä¸åçéæ©ï¼æç»å±åç¡®å®ä¸ä¸ªæ¹æ¡ãä½ åAIåºè¯¥äºç¸æé®ï¼èä¸æ¯åè¡éã</li>
</ol>
<h2 id="æ³åäºclaudemdä¸æ¯ææ¡£èæ¯aiçå¤§è">æ³åäºï¼CLAUDE.mdä¸æ¯ææ¡£ï¼èæ¯AIçå¤§èã</h2>
<p>CLAUDE.mdæ¯ä¸ä¸ªæå¶éè¦ä½å¸¸è¢«è¯¯ç¨çéç½®æä»¶ãå¨ä½ æ¯æ¬¡å¯å¨ä¼è¯æ¶ï¼Claudeé½ä¼é¦åè¯»åå®ãå¤§å¤æ°äººè¦ä¹å®å¨å¿½ç¥å®ï¼è¦ä¹ç¨ä¸äºåå¾ä¿¡æ¯å¡«æ»¡å®ï¼ç»æåèè®©Claudeçè¡¨ç°æ´ç³ã</p>
<p>è¦åå¥½ä¸ä¸ªCLAUDE.mdï¼è¯·éµå¾ªä»¥ä¸åä¸ªå³é®æ³åï¼</p>
<ul>
<li>ä¿æç®ç­ï¼ Claudeä¸æ¬¡åªè½å¯é å°éµå¾ªå¤§çº¦150-200æ¡æä»¤ï¼èç³»ç»æç¤ºæ¬èº«å·²ç»å ç¨äºå¤§çº¦50æ¡ãä½ çæ¯ä¸æ¡æ°æä»¤é½å¨äºå¤ºå®çæ³¨æåãå¦æä½ çCLAUDE.mdåå¾åæ¬å°è¯´ï¼Claudeå°±ä¼å¼å§éæºå¿½ç¥æäºåå®¹ã</li>
<li>ä¸æ³¨äºé¡¹ç®ç¹æ§ï¼ ä¸è¦åè¯å®ä»ä¹æ¯âç»ä»¶âæä»¶å¤¹ï¼å®æ©å°±ç¥éäºãä½ åºè¯¥åè¯å®ä½ é¡¹ç®éé£äºâå¥æªâçä¸è¥¿ï¼æ¯å¦ä½ ç¹æçbashå½ä»¤æå·¥ä½æµç¨ã</li>
<li>è§£éâä¸ºä»ä¹âï¼èä¸ä»æ¯âåä»ä¹âï¼ å½ä½ ç»åºæä»¤èåçåå æ¶ï¼Claudeè½æ´å¥½å°çè§£æå¾å¹¶ååºæ´ä¼çå¤æ­ãåªè¯´âä½¿ç¨TypeScriptä¸¥æ ¼æ¨¡å¼âæ¯å¯ä»¥çï¼ä½è¯´âä½¿ç¨TypeScriptä¸¥æ ¼æ¨¡å¼ï¼å ä¸ºæä»¬æ¾å éå¼anyç±»åå¯¼è´è¿çäº§ç¯å¢çbugâææä¼å¥½å¾å¤ã</li>
<li>æç»­æ´æ°ï¼ CLAUDE.mdåºè¯¥æ¯ä¸ä»½âæ´»ææ¡£âãå½ä½ å·¥ä½æ¶ï¼å¯ä»¥æ # é®å¿«éå°å½åæä»¤æ·»å å°æä»¶ä¸­ãæ¯å½ä½ åç°èªå·±ç¬¬äºæ¬¡çº æ­£Claudeåä¸ä¸ªé®é¢æ¶ï¼è¿å°±æ¯ä¸ä¸ªæç¡®çä¿¡å·ï¼è¿æ¡è§ååºè¯¥è¢«åå¥CLAUDE.mdã</li>
</ul>
<p>ä¸ä¸ªç³ç³ç CLAUDE.md è¯»èµ·æ¥åæ¯ç»æ°åå·¥åçå¥èææ¡£ãèä¸ä¸ªä¼ç§ç CLAUDE.md è¯»èµ·æ¥åæ¯ä½ ä¸ºæå¤©ä¼å¤±å¿çèªå·±çä¸çæ ¸å¿ç¬è®°ã</p>
<h2 id="æ³åä¸200kä¸ä¸ææ¯çèçé·é±å«æè¿å»">æ³åä¸ï¼200kä¸ä¸ææ¯çèçé·é±ï¼å«æè¿å»ã</h2>
<p>è¿æ¯ä¸ä¸ªåç´è§çäºå®ï¼æ¨¡åæ§è½çä¸éè¿å¨ä¸ä¸æçªå£è¢«å®å¨å¡«æ»¡ä¹åå°±å¼å§äºï¼éå¸¸å¨ä½¿ç¨çè¾¾å°20-40%æ¶å°±ä¼åºç°ææ¾çè¡°åã</p>
<p>è¿å°±æ¯ä¸ºä»ä¹ææ¶åå³ä½¿ä½ åç¼©äºä¸ä¸æï¼ä½¿ç¨ /compact å½ä»¤ï¼ï¼Claudeä»ç¶ä¼ç»åºç³ç³çè¾åºãå ä¸ºå¨åç¼©ä¹åï¼æ¨¡åçæ§è½å°±å·²ç»éåäºã</p>
<p>ä»¥ä¸æ¯ææç®¡çä¸ä¸æçå ä¸ªå®ç¨ç­ç¥ï¼</p>
<ul>
<li>ååå¯¹è¯èå´ (Scope your conversations): æ¯ä¸ªåè½æä»»å¡ä½¿ç¨ä¸ä¸ªç¬ç«çå¯¹è¯ãä¸è¦å¨åä¸ä¸ªå¯¹è¯éæ¢æå»ºè®¤è¯ç³»ç»åéææ°æ®åºå±ã</li>
<li>ä½¿ç¨å¤é¨è®°å¿ (Use external memory): å¯¹äºå¤æçä»»å¡ï¼è®©Claudeå°è®¡ååè¿åº¦åå¥å SCRATCHPAD.md è¿æ ·çå¤é¨æä»¶ä¸­ãè¿æ ·ç¬¬äºå¤©ä½ åæ¥æ¶ï¼Claudeå¯ä»¥è¯»åæä»¶ï¼ä»ä¸æ¬¡ä¸­æ­çå°æ¹ç»§ç»­ã</li>
<li>âå¤å¶-ç²è´´âéç½®æ³ (The copy-paste reset): å½ä¸ä¸æåå¾èè¿æ¶ï¼å¤å¶å¯¹è¯ä¸­çå³é®ä¿¡æ¯ï¼è¿è¡ /compact å /clear æ¸ç©ºä¸ä¸æï¼ç¶ååªææéè¦çä¿¡æ¯ç²è´´åæ¥ãä¸ä¸ªæ¸ç½çä¸ä¸æè¿èäºéåçä¸ä¸æã</li>
<li>ææ­æ¸ç©º (Know when to clear): å¦æä¸ä¸ªå¯¹è¯å·²ç»åç¦»äºè½¨éï¼ç´æ¥ç¨ /clear éæ°å¼å§ãè¿å ä¹æ»æ¯æ¯è¯å¾çº æ­£ä¸ä¸ªæ··ä¹±çå¯¹è¯è¦å¥½ã</li>
</ul>
<p>è®°ä½è¿ä¸ªå¿æºæ¨¡åï¼Claudeæ¯æ ç¶æçãé¤äºä½ æç¡®ç»å®çä¸è¥¿ï¼æ¯ä¸ªå¯¹è¯é½æ¯ä»é¶å¼å§ãè¯·æ®æ­¤è§åã</p>
<h2 id="æ³ååæ¶æå³å®ä¸åè§åæ å¯æ¿ä»£">æ³ååï¼æ¶æå³å®ä¸åï¼è§åæ å¯æ¿ä»£ã</h2>
<p>æ¶æè³å³éè¦ï¼å°¤å¶æ¯å¨è½¯ä»¶å·¥ç¨ä¸­ãå¦æä½ ä¸åæèç»æï¼AIçæçä»£ç å°±ä¼æå·¨å¤§çâèªç±åæ¥âç©ºé´ï¼èè¿æ°æ°æ¯é®é¢çæ ¹æºãä½ ä¸è½è·³è¿è§åã</p>
<p>æ¯è¾ä¸ä¸è¿ä¸¤ç§æé®æ¹å¼çå¤©å£¤ä¹å«ï¼æ¨¡ç³çè¯·æ±æ¯âç»æå»ºä¸ä¸ªè®¤è¯ç³»ç»âï¼èä¸ä¸ªç»è¿è§åçãå·ä½çè¯·æ±æ¯âä½¿ç¨ç°æçUseræ¨¡åæå»ºçµå­é®ä»¶/å¯ç è®¤è¯åè½ï¼å°sessionå­å¨å¨Redisä¸­å¹¶è®¾ç½®24å°æ¶è¿æï¼å¹¶æ·»å ä¸­é´ä»¶ä¿æ¤/api/protectedä¸çææè·¯ç±ãâ</p>
<p>åèç»äºAIè¿å¤çèªç±ï¼ç»æå¯è½æ¯æ··ä¹±çãåèç»äºå®ä¸ä¸ªæ¸æ°çèå¾ï¼ç»æä¼ç²¾åå¾å¤ãè±5åéè¿è¡æ¶æè§åï¼å¯ä»¥ä¸ºä½ çä¸åç»­æ°å°æ¶çè°è¯æ¶é´ã</p>
<h2 id="æ³åäºåæ­¢æ±æ¨æ¨¡åç³ç³çè¾åºæºäºä½ ç³ç³çè¾å¥">æ³åäºï¼åæ­¢æ±æ¨æ¨¡åï¼ç³ç³çè¾åºæºäºä½ ç³ç³çè¾å¥ã</h2>
<p>å½å¾å°ä¸çæ³çç»ææ¶ï¼äººä»¬çç¬¬ä¸ååºå¾å¾æ¯æ±æ¨æ¨¡åãä½ç°å®æ¯æ®é·çï¼å«åæªæ¨¡åäºãå¦æä½ ç¨Opus 4.5è¿å¾ä¸å°å¥½ç»æï¼é®é¢åºå¨ä½ èº«ä¸ï¼èä¸æ¯AIãä½ çè¾å¥åæç¤ºæ¹å¼çéäºï¼å¥å·ã</p>
<p>æ³è¦æåè¾åºè´¨éï¼åè¦æåä½ çè¾å¥è´¨éï¼</p>
<ul>
<li>å·ä½è¯´æä½ æ³è¦ä»ä¹ (Be specific about what you want)ï¼ ä½ çæä»¤è¶æ¸æ°ãè¶å·ä½ï¼ç»æå°±è¶å¥½ã</li>
<li>åè¯å®ä¸è¦åä»ä¹ (Tell it what NOT to do)ï¼ Claude 4.5å°¤å¶æè¿åº¦è®¾è®¡çå¾åãå¦æä½ æ³è¦ä¸ä¸ªç®çº¦çæ¹æ¡ï¼å°±æç¡®åè¯å®ï¼âä¿æç®åï¼ä¸è¦æ·»å ææ²¡è¦æ±çæ½è±¡ï¼å¦æå¯è½çè¯ï¼åªç¨ä¸ä¸ªæä»¶ãâ</li>
<li>æä¾âä¸ºä»ä¹âçèæ¯ (Give it context about why)ï¼ åè¯å®âè¿ä¸ªåè½éè¦å¨æ¯ä¸ªè¯·æ±ä¸è¿è¡ï¼æä»¥æ§è½è³å³éè¦âï¼æèâè¿åªæ¯ä¸ä¸ªååï¼ç¨å®å°±æâï¼è¿äºçº¦æä¼å½»åºæ¹åæ¨¡åè§£å³é®é¢çæè·¯ã</li>
</ul>
<p>ä¸ä¸ªä¸å®¶çº§çå·¥ä½æµæ¯ï¼ç¨Opusè¿è¡è§ååæ¶æè®¾è®¡ï¼ç¶ååæ¢å°Sonnetè¿è¡å·ä½å®ç°ã Opusæ´æé¿å¤ææ¨çï¼èSonnetæ´å¿«ãæ´ä¾¿å®ï¼éå¸¸éåæ§è¡æç¡®çä»»å¡ãå½ç¶ï¼å¦æä½ æ¯éè¿APIæéä»è´¹ï¼ç¨Opusåæ¯ä¸è¡ä»£ç ï¼é£ä½ å¯è½å¾èèåæä¸ä¸ªè¾äºã</p>
<p>è®°ä½è¿ä¸ªççï¼å¦æä½ çè¾åºå¾ç³ç³ï¼é£æ¯å ä¸ºä½ çè¾å¥å¾ç³ç³ãæ²¡ææ·å¾å¯èµ°ã</p>
<h2 id="æ³åå­åäºå®éªéç½®å³å®ä½ çä¸é">æ³åå­ï¼åäºå®éªï¼éç½®å³å®ä½ çä¸éã</h2>
<p>Claudeæ¥æä¸ä¸ªæå¶ä¸°å¯çåè½çæç³»ç»ï¼MCPæå¡å¨ãHooksãèªå®ä¹ææ å½ä»¤ãsettings.jsonéç½®ç­ç­ãä½ ä¸éè¦å¨é¨ææ¡ï¼ä½ä½ åºè¯¥å»å°è¯åå®éªã</p>
<ul>
<li>MCP (Model Context Protocol): è®©Claudeè¿æ¥å°å¤é¨æå¡ï¼å¦SlackãGitHubãæ°æ®åºãå¦æä½ åç°èªå·±æ»æ¯å¨å¤å¶ç²è´´ä¿¡æ¯ï¼å¾å¯è½æMCPæå¡å¨è½å¸®ä½ èªå¨åã</li>
<li>Hooks: è®©ä»£ç å¨Claudeä¿®æ¹ååèªå¨è¿è¡ãæ³è®©Prettieræ ¼å¼åæ¯ä¸ªæä»¶ï¼ç¨Hookãæ³å¨æ¯æ¬¡ç¼è¾åè¿è¡ç±»åæ£æ¥ï¼ç¨Hookãè¿è½ç«å³æè·é®é¢ã</li>
<li>èªå®ä¹ææ å½ä»¤: æä½ éå¤ä½¿ç¨çæç¤ºè¯æåæå½ä»¤ãå¨.claude/commandsæä»¶å¤¹éåå»ºmarkdownæä»¶ï¼ç¶åä½ å°±å¯ä»¥ç¨/commandnameæ¥è¿è¡å®ä»¬ã</li>
</ul>
<p>è¿äºæ¨¡åæ¯å¨é½å¨è¿æ­¥ãä¸ä¸ªæåè¡ä¸éçåè½ï¼ç°å¨å¯è½å·²ç»å¯ä»¥äºãä¿æå¥½å¥å¿ï¼ä¸æ­éæ°æµè¯ã</p>
<h2 id="æ³åä¸å½ä½ è¢«å¡ä½æ¶åæ­¢å¼ºæ¨æ¹åæ¹æ³">æ³åä¸ï¼å½ä½ è¢«å¡ä½æ¶ï¼åæ­¢å¼ºæ¨ï¼æ¹åæ¹æ³ã</h2>
<p>ææ¶Claudeä¼é·å¥ä¸ä¸ªå¾ªç¯ï¼å°è¯ãå¤±è´¥ãåå°è¯ãåå¤±è´¥ãå¨è¿ç§æåµä¸ï¼äººçæ¬è½æ¯ç»§ç»­è§£éãæä¾æ´å¤æä»¤ãä½æ´å¥½çåæ³æ¯å½»åºæ¹åä½ çæ¹æ³ã</p>
<ul>
<li>æ¸ç©ºå¯¹è¯ (Clear the conversation)ï¼ ç´¯ç§¯çä¸ä¸æå¯è½æ­£å¨è¿·æå®ï¼ä¸ä¸ªå¨æ°çå¼å§å¯ä»¥è§£å³é®é¢ã</li>
<li>ç®åä»»å¡ (Simplify the task)ï¼ å¦æä¸ä¸ªå¤æä»»å¡è®©Claudeä¸¾æ­¥ç»´è°ï¼æå®åè§£ææ´å°çé¨åãé¡ºä¾¿è¯´ä¸å¥ï¼å¦æClaudeå¤çå¤æä»»å¡å¾ååï¼è¿éå¸¸æå³çä½ çåå§è®¡åå°±ä¸å¤ååã</li>
<li>å±ç¤ºèéåç¥ (Show instead of tell)ï¼ å¦æClaudeä¸ç´æ æ³çè§£ï¼äº²æåä¸ä¸ªæå°åçæ­£ç¡®ç¤ºä¾ï¼ç¶ååè¯å®ï¼âçï¼æç»è¾åºåºè¯¥åè¿æ ·ãç°å¨æè¿ä¸ªæ¨¡å¼åºç¨å°å¶ä»é¨åãâ</li>
<li>éæé®é¢ (Be creative)ï¼ æ¢ä¸ä¸ªè§åº¦æ¥æè¿°ä½ çé®é¢ãææ¶åä½ æåçè¡¨è¿°æ¹å¼å¯è½ä¸ç¬¦åClaudeçâæç»´æ¨¡åâã</li>
</ul>
<p>å¦æä½ åç°èªå·±å·²ç»éå¤è§£éäºä¸éï¼æ¯æ¶åæ¹åç­ç¥äºã</p>
<h2 id="æ³åå«è¶è¶èå¤©æ¨¡å¼æå»ºèªå¨åç³»ç»">æ³åå«ï¼è¶è¶èå¤©æ¨¡å¼ï¼æå»ºèªå¨åç³»ç»ã</h2>
<p>çæ­£ä»Claudeä¸­è·å¾å·¨å¤§ä»·å¼çäººï¼å¹¶ä¸ä»ä»æå®å½ä½ä¸ä¸ªäº¤äºå¼å·¥å·ãä»ä»¬æ­£å¨æå»ºä»¥Claudeä¸ºæ ¸å¿ç»ä»¶çèªå¨åç³»ç»ã</p>
<p>éè¿ -p æ å¿ï¼ä½ å¯ä»¥å¨æ å¤´æ¨¡å¼ï¼headless modeï¼ä¸è¿è¡Claudeãè¿æå³çä½ å¯ä»¥ç¼åèæ¬ï¼å°å®çè¾åºéè¿ç®¡éä¼ éç»å¶ä»å·¥å·ï¼ä¸bashå½ä»¤é¾æ¥ï¼å¹¶å°å¶éæå°èªå¨åå·¥ä½æµä¸­ã</p>
<p>ä¼ä¸æ­£å¨ç¨è¿ç§æ¹å¼å®ç°èªå¨åçä»£ç å®¡æ¥ï¼PR reviewï¼ãæ¯æå·¥åååºãæ¥å¿è®°å½åææ¡£æ´æ°ãææè¿äºé½æ¯å¯è®°å½ãå¯å®¡è®¡çï¼å¹¶ä¸éçæ¶é´çæ¨ç§»ä¸æ­æ¹è¿ã</p>
<p>è¿å°±å½¢æäºä¸ä¸ªå¼ºå¤§çé£è½®æåºï¼Claudeç¯äºä¸ä¸ªéè¯¯ï¼ä½ å®¡æ¥æ¥å¿ï¼ç¶åæ¹è¿CLAUDE.mdæç¸å³å·¥å·ï¼ä¸ä¸æ¬¡Claudeå°±ä¼åå¾æ´å¥½ãè¿ç§æ¹è¿æ¯å¤åå¼çãå¦æä½ åªå¨äº¤äºæ¨¡å¼ä¸ä½¿ç¨Claudeï¼ä½ æ­£å¨éå¤±å®çæ­£çä»·å¼ã</p>
<h2 id="ç»è¯­ä½ çaiä½ çè´£ä»»">ç»è¯­ï¼ä½ çAIï¼ä½ çè´£ä»»</h2>
<p>çæ­£ææ¡åClaudeè¿æ ·çAIå¼åå·¥å·ï¼å³é®å¨äºæç»´æ¨¡å¼çè½¬åââä»ä¸ä¸ªç®åçæä»¤ååºèï¼è½¬åä¸ºä¸ä¸ª meticulous çè§åèãéç½®èåç³»ç»æå»ºèãä½ ä¸æ¯å¨åå®èå¤©ï¼ä½ æ¯å¨ç¼ç¨å®ã</p>
<p>æåï¼çç»ä½ ä¸ä¸ªé®é¢æèï¼ å¦æä½ ä¸æClaudeå½ä½èå¤©æºå¨äººï¼èæ¯çä½ä¸ä¸ªå¯ç¼ç¨çå¢éæåï¼ä½ æåä¼èªå¨åå·¥ä½æµç¨çåªä¸ªé¨åï¼</p>
<p>æ´å¤å³äºAI Codingçåå®¹å¯å³æ³¨æç<a href="https://didispace.com" target="_blank" rel="noopener nofollow">åå®¢</a>è·åæç»­æ´æ°ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 19:53">2026-01-14 19:53</span>&nbsp;
<a href="https://www.cnblogs.com/didispace">ç¨åºç¿DD</a>&nbsp;
éè¯»(<span id="post_view_count">67</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19484090);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19484090', targetLink: 'https://www.cnblogs.com/didispace/p/19484090', title: 'Claude Code æä½³å®è·µç 8 æ¡é»éæ³å' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ `i` å `e` ååå¼åçè¡æ¡ï¼å½ AI çâçº éçâéä¸ NexusContract çâç§å¦éâ ]]></title>
    <link>https://www.cnblogs.com/jieky/p/19481961</link>
    <guid>bf5ee1a0d5dcb0f2779bc7907a128f9b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jieky/p/19481961" title="åå¸äº 2026-01-14 14:19">
    <span role="heading" aria-level="2">`i` å `e` ååå¼åçè¡æ¡ï¼å½ AI çâçº éçâéä¸ NexusContract çâç§å¦éâ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        å¨å¯¹æ¥æå¤´é¨æ¯ä»ç½å³æ¶ï¼æé­éäºä¸æ¬¡å®ç¾çâéç»´æå»âãå®æ¹ææ¡£éä¸ä¸ªæ `ei` åæ `ie` çè±è¯­è¯­æ³éè¯¯ï¼éªè¿äº AI çè¯­æ³æ£æ¥ï¼ä¹éªè¿äºæçèç¼ Reviewãæ¬æå°æ¢è®¨ NexusContract å¦ä½éè¿**åæ°æ®éç¦»**æºå¶ï¼å¨æ··ä¹±çéçæ¥å£ä¸ç°ä»£åçæ´æ´ä»£ç ä¹é´å»ºç«ä¸éé²çº¿ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="i-å-e-ååå¼åçè¡æ¡å½-ai-ççº éçéä¸-nexuscontract-çç§å¦é"><code>i</code> å <code>e</code> ååå¼åçè¡æ¡ï¼å½ AI çâçº éçâéä¸ NexusContract çâç§å¦éâ</h1>
<blockquote>
<p><strong>æè¦</strong>ï¼å¨å¯¹æ¥æå¤´é¨æ¯ä»ç½å³æ¶ï¼æé­éäºä¸æ¬¡å®ç¾çâéç»´æå»âãå®æ¹ææ¡£éä¸ä¸ªæ <code>ei</code> åæ <code>ie</code> çè±è¯­è¯­æ³éè¯¯ï¼éªè¿äº AI çè¯­æ³æ£æ¥ï¼ä¹éªè¿äºæçèç¼ Reviewãæ¬æå°æ¢è®¨ NexusContract å¦ä½éè¿<strong>åæ°æ®éç¦»</strong>æºå¶ï¼å¨æ··ä¹±çéçæ¥å£ä¸ç°ä»£åçæ´æ´ä»£ç ä¹é´å»ºç«ä¸éé²çº¿ã</p>
</blockquote>
<h2 id="1-è¯¡å¼ç-parameter_missing">1. è¯¡å¼ç <code>PARAMETER_MISSING</code></h2>
<p>æäºåçå¨ä¸ä¹åï¼æä»¬æ­£å¨éæåé¨çä¸ä¸ªè¿è¡äºå å¹´çèæ§æ¯ä»ç½å³ã</p>
<p>ä¸ºäºæé«éææçï¼æææ§çææ¡£æªå¾åç»äº AIï¼æç¥åå¤§æ¨¡åï¼ï¼è®©å®å¸®æçæç¬¦å NexusContract è§èç C# DTOï¼æ°æ®ä¼ è¾å¯¹è±¡ï¼ãAI çè¡¨ç°å ªç§°å®ç¾ï¼ç¬é´ååºäºç»ææ¸æ°çä»£ç ï¼</p>
<pre><code class="language-csharp">public string ReceiverId { get; set; } // æ¶æ¬¾æ¹ID

</code></pre>
<p>ä»£ç ççæ²¡æ¯çï¼å½åä¹è§èãææ»¡æä¿¡å¿å°å¯å¨æå¡ï¼å¼å§<strong>æ¬å°èè°</strong>ã</p>
<p><strong>ç»æï¼æ¥å£æ­»æ´»ä¸éã</strong></p>
<p>ä¸æ¸¸ç½å³ä¸ç´è¿åå·å°å°çéè¯¯ï¼<code>PARAMETER_MISSING</code>ã</p>
<p>è¿å°±å¾éªé¨äºã<br>
ææäºæ­ç¹ï¼æ°æ®å¨ï¼<br>
æäºåï¼JSON å­æ®µä¹æï¼<br>
æèç¼æ£æ¥äºä¸éï¼<code>ReceiverId</code> æ¼åç»å¯¹æ²¡é®é¢ï¼<br>
æåè®© AI æ£æ¥äºä¸éä»£ç ï¼å®ä¹ä¿¡èªæ¦æ¦å°è¯´æ²¡æè¯­æ³éè¯¯ã</p>
<p><strong>æ´æ´ä¸¤ä¸ªå°æ¶ï¼æå°±å¡å¨è¿ä¸ªè«åå¶å¦çéè¯¯ä¸ï¼çè³å¼å§æçæ¯ä¸æ¯ HTTP åè®®å¤´çé®é¢ï¼æèæ¯ JSON åºåååºç Bugã</strong></p>
<p>ç´å°æå®å¨æ²¡æäºï¼åæ¬¡æå¼é£ä»½ææ¡£ï¼å¼ºè¿«èªå·±ä¸ä¸ªå­æ¯ä¸ä¸ªå­æ¯å°è·æçä»£ç æ¯å¯¹æ¶ï¼ææåç°äºä¸ä¸ªä»¤äººçªæ¯çç»èï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/45234/202601/45234-20260114141433336-590884100.png" alt="image" loading="lazy"></p>
<p><strong>ææ¡£éåçå­æ®µåï¼æ¯ <code>recieverId</code>ã</strong></p>
<p>æ³¨æå°äºåï¼<strong><code>i</code> å <code>e</code> ååäºï¼</strong></p>
<p>æ­£ç¡®çè±è¯­åè¯æ¯ <code>Receiver</code>ï¼c åé¢æ¥ eiï¼ï¼ä½ææ¡£éåæäº <code>Reciever</code>ï¼ieï¼ãè¿ç§âé¿å¾æåâçéè¯¯ï¼æå¶å®¹æåçè§éè§ã</p>
<p>é£ä¸å»æç®ç´æ³æé®çï¼<strong>AI å¤ªâèªæâäºã</strong> å®è¯å«åºè¿æ¯âæ¶æ¬¾æ¹âçææï¼åç°äºè¿ä¸ªè¯­æ³éè¯¯ï¼äºæ¯<strong>å¥½å¿å°å¨çæä»£ç æ¶å¸®ææå®âæ¹å¯¹âäº</strong>ãèæï¼ä½ä¸ºä¸ä¸ªæ­£å¸¸çäººç±»ç¨åºåï¼å¤§èä¹èªå¨è¿æ»¤äºè¿ä¸ªæ¼åéè¯¯ã</p>
<p>å¨éçç³»ç»çéæä¸­ï¼<strong>âåå²çéè¯¯âå¾å¾æ¯âæ­£ç¡®çè¯­æ³âæ´éè¦</strong>ã</p>
<h2 id="2-æ¶æçåå»ä»£ç æ´çä¸è®èç°å®">2. æ¶æçåå»ï¼ä»£ç æ´çä¸è®èç°å®</h2>
<p>é¢å¯¹è¿ç§åºæ¯ï¼ä¼ ç»åæ³éå¸¸æä¸¤ç§ï¼</p>
<ol>
<li><strong>åæµåæ±¡æ´¾ï¼</strong> ç´æ¥æ C# å±æ§åä¹åéã</li>
</ol>
<pre><code class="language-csharp">public string RecieverId { get; set; } // ççå°±é¾åï¼é¼æ­»å¼ºè¿«ç

</code></pre>
<p>è¿æä¸ªå·¨å¤§çéæ£ï¼æ°æ¥çåäºæèåæ¥ç»´æ¤ç AIï¼çå°è¿ä¸ªâéè¯¯æ¼åâï¼å¾æå¯è½ä¼é¡ºææå®âä¿®å¤âææ­£ç¡®ç <code>ReceiverId</code>ï¼ç¶å<strong>ç °ï¼ç³»ç»åæäºã</strong><br>
2. <strong>æå¨æ å°æ´¾ï¼</strong> å¨ä¸å¡ä»£ç éæå¨å <code>json["recieverId"] = request.ReceiverId</code>ã<br>
è¿ä¼å¯¼è´ä¸å¡é»è¾éåæ¥çå¤§éçå­ç¬¦ä¸²ç¡¬ç¼ç ï¼ç»´æ¤ææ¬æé«ã</p>
<p><strong>NexusContract çå²å­¦æ¯ï¼</strong> æä»¬æ¹åä¸äºå¤é¨ä¸ççâæç²âæ¼åï¼ä½æä»¬å¯ä»¥éè¿æ¶æææ®µï¼ä¸è®©è¿äºâèä¸è¥¿âæ±¡ææä»¬çæ ¸å¿ä»£ç ã</p>
<p>æä»¬éç¨äº <strong>[ApiField]</strong> ç¹æ§æ¥å®ç° <strong>ç©çéç¦»</strong>ï¼</p>
<pre><code class="language-csharp">[ApiOperation("payment.gateway.pay", HttpVerb.POST)]
public class PaymentRequest : IApiRequest
{
    // ç»å¯¹æ¹ççï¼å¿é¡»éï¼ï¼æ å°å°é£ä¸ªæ ie ååçèå­æ®µ
    [ApiField("recieverId", IsRequired = true)]
    
    // ç»èªå·±ççï¼å¿é¡»å¯¹ï¼ï¼ä¿æåé¨é¢åè¯­è¨ççº¯æ´æ§
    public string ReceiverId { get; set; }
}

</code></pre>
<p>è¿ä¸ä»æ¯ç®åçéå½åï¼è¿æ¯ <strong>è¯­ä¹è§£è¦ (Semantic Decoupling)</strong>ã</p>
<ul>
<li><strong>å±æ§å (Property):</strong> æå¡äºåé¨é»è¾ï¼ä½¿ç¨ <strong>Ubiquitous Language (éç¨è¯­è¨)</strong>ï¼å¿é¡»æ­£ç¡®ãå¯è¯»ã</li>
<li><strong>ç¹æ§å (Attribute):</strong> æå¡äºå¤é¨å¥çº¦ï¼æ¯å¯¹åå²äºå®ç <strong>å¿«ç§</strong>ï¼å¿é¡»çå®ãåªææ¯éçã</li>
</ul>
<h2 id="3-æ·±åº¦è§£å¯nexuscontractcore-çé»ç">3. æ·±åº¦è§£å¯ï¼NexusContract.Core çé»ç</h2>
<p>è¿æ¶ä½ å¯è½ä¼é®ï¼<em>âå¸é¢ä¸å¾å¤ JSON åºé½æ <code>JsonProperty</code>ï¼è¿æä»ä¹ç¨å¥çï¼â</em></p>
<p>åºå«å¨äº <strong>å¤çæ¶æº</strong> å <strong>ç¡®å®æ§</strong>ã</p>
<p>NexusContract å¨ <strong>ç³»ç»å¯å¨ (Startup)</strong> æ¶ï¼ä¼æ§è¡ä¸ä¸ª <strong>[å³ç­ A-301] åæ°æ®å·å» (Metadata Freezing)</strong> æµç¨ã</p>
<p>è½ç¶æ¡æ¶å¨å¯å¨æ¶æ æ³ç¥éå¤é¨æ¥å£å°åºå« <code>recieverId</code> è¿æ¯ <code>receiverId</code>ï¼é¤éæä»¬æ Schema æä»¶ï¼ï¼ä½å®åäºä¸ä»¶æ´éè¦çäºï¼<strong>ç¡®ç«å¥çº¦çç»å¯¹æå¨</strong>ã</p>
<h3 id="æ ¸å¿ä»£ç å±ç¤º">æ ¸å¿ä»£ç å±ç¤º</h3>
<pre><code class="language-csharp">// Copyright (c) 2026 NexusContract. All rights reserved.

using System.Collections.Concurrent;
using System.Reflection;
using NexusContract.Abstractions.Exceptions;

namespace NexusContract.Core.Reflection
{
    /// &lt;summary&gt;
    /// ãå³ç­ A-301ãNexusContractMetadataRegistryï¼å¥çº¦åæ°æ®æ³¨åè¡¨ï¼
    /// 
    /// æ ¸å¿èè½ï¼
    /// 1. åç°ï¼Discoveryï¼ï¼å¯å¨æ¶æ«æææå¥çº¦ç±»ç Attribute ç»æ
    /// 2. éªè¯ï¼Validationï¼ï¼æ§è¡ ContractValidator ç¡®ä¿åé¨çº¦æï¼å¦ Getter/Setter å®æ´æ§ï¼
    /// 3. å»ç»ï¼Freezingï¼ï¼å°åå°ç»æè½¬ä¸ºä¸å¯åå¯¹è±¡ï¼è¿è¡æé¶åå°æè
    /// &lt;/summary&gt;
    public sealed class NexusContractMetadataRegistry
    {
        // åä¾æ¨¡å¼ï¼ç¡®ä¿å¨å±å¯ä¸æ³¨åè¡¨
        private static readonly Lazy&lt;NexusContractMetadataRegistry&gt; _instance = new(() =&gt; new NexusContractMetadataRegistry());
        public static NexusContractMetadataRegistry Instance =&gt; _instance.Value;

        // ãå³ç­ A-302ãæ ¸å¿å·å»åº
        // Key: å¥çº¦ç±»å, Value: é¢ç¼è¯å¥½çåæ°æ®ï¼åå« Expression Tree å§æï¼
        private readonly ConcurrentDictionary&lt;Type, ContractMetadata&gt; _cache = new();

        private NexusContractMetadataRegistry() { }

        /// &lt;summary&gt;
        /// ãå³ç­ A-308ãå¯å¨æä½æ£ï¼Startup Health Checkï¼
        /// è¿ä¸æ¯ç®åçå è½½ï¼èæ¯ä¸æ¬¡å¨éçâCTæ«æâã
        /// ç¡®ä¿ææå¥çº¦å¨ç©çä¸æ¯åæ³çï¼ä¾å¦é²æ­¢ Attribute éå¤å®ä¹ï¼ã
        /// &lt;/summary&gt;
        public DiagnosticReport Preload(IEnumerable&lt;Type&gt; types)
        {
            var globalReport = new DiagnosticReport();

            foreach (var type in types)
            {
                // 1. éæéªè¯ï¼å­æ®µæ¼åãAttribute å²çªç­ï¼
                var perTypeReport = new DiagnosticReport();
                ContractValidator.Validate(type, perTypeReport);

                // 2. å¦æéªè¯éè¿ï¼æå»ºä¸å¯ååæ°æ®
                if (!perTypeReport.HasErrors)
                {
                    try 
                    {
                        var metadata = BuildMetadata(type, perTypeReport);
                        _cache.TryAdd(type, metadata); // å»ç»å¥åº
                    }
                    catch (Exception ex)
                    {
                        perTypeReport.AddCritical(type.Name, $"Metadata freeze failed: {ex.Message}");
                    }
                }
                globalReport.Merge(perTypeReport);
            }
            return globalReport; // è¿åä½æ£æ¥å
        }

        /// &lt;summary&gt;
        /// æå»ºåæ°æ®æ ¸å¿æµï¼å®¡è®¡ -&gt; ç¼è¯ -&gt; å°è£
        /// &lt;/summary&gt;
        private ContractMetadata BuildMetadata(Type type, DiagnosticReport report)
        {
            // ... (çç¥é¨åä»£ç ) ...

            // ãå³ç­ A-309ãå¯ç¨ Expression Tree é¢ç¼è¯ï¼çæ­£é¶åå°ï¼
            // å°åå°è¯»åè½¬æ¢ä¸ºå¼ºç±»åå§æï¼æ§è½æå 10 å
            var projector = ContractMetadataCompiler.CompileProjector(type, propertyMetadatas);
            var hydrator = ContractMetadataCompiler.CompileHydrator(type, propertyMetadatas);

            return new ContractMetadata(type, opAttr, propertyMetadatas.AsReadOnly(), projector, hydrator);
        }
    }
}

</code></pre>
<h3 id="ææ¯åçè§£è¯»">ææ¯åçè§£è¯»</h3>
<p><strong>ä¸ºä»ä¹è¿å¯¹ææ¥ Bug å¾æç¨ï¼</strong></p>
<p>è½ç¶ <code>PARAMETER_MISSING</code> æ¯å¨è¿è¡æ¶æ¥åºæ¥çï¼ä½ NexusContract çæºå¶ä¿è¯äº<strong>ä¿®å¤çå»ä»·æ§ä¸ç¡®å®æ§</strong>ã</p>
<ol>
<li><strong>Expression Tree é¢ç¼è¯ï¼</strong><br>
ä¸æ¦æä»¬å¨ Attribute éæåå­ä¿®æ­£ä¸º <code>[ApiField("recieverId")]</code>ï¼æ¡æ¶å¨ä¸æ¬¡å¯å¨æ¶ï¼ä¼éè¿ <strong>Expression Tree</strong> æè¿ä¸ªæ å°å³ç³»ç¼è¯æé«æç Delegateã<br>
è¿æå³çï¼å³ä½¿ä¸ºäºå¼å®¹èæ¥å£èå äº Attributeï¼<strong>è¿è¡æ¶æ§è½ä¾ç¶ç­åäºæåä»£ç </strong>ï¼å®å¨æ²¡æåå°çé¢å¤å¼éã</li>
<li><strong>å¥çº¦çæ¾å¼åï¼</strong><br>
è¿ç§åæ³å¼ºè¿«å¼åèå»ç¡®è®¤æ¯ä¸ä¸ªå­æ®µçæ å°å³ç³»ãä»£ç éç <code>[ApiField]</code> å°±åä¸ä¸ªä¸ªè­¦ç¤ºçï¼æ¶å»æéçåæ¥èï¼<strong>âæ³¨æï¼è¿éæä¸ªåï¼å«å¨ï¼â</strong></li>
</ol>
<h2 id="4-ç»è¯­">4. ç»è¯­</h2>
<p>ä»¥åæä»¬æ AI çç¼ä»£ç ï¼å¹»è§ï¼ï¼ç°å¨æä»¬æ AI <strong>ä»£ç åå¾å¤ªå¯¹</strong>ã</p>
<p>é¢å¯¹æèãæé¶è¡ãææ¯ä»é£äºåå å¹´åçâèå¤çº§âæ¥å£ï¼AI è¿ç§æ¿çæ´¥è¯å¸å½æ åçâé«æçâæ ¹æ¬æ°´åä¸æãå®ä¸ç¥é <code>recieverId</code> å¨è¿éä¸æ¯æ¼åéè¯¯ï¼å®æ¯<strong>æ³å¾</strong>ï¼æ¯<strong>ä¸å¯å¨æçå¥çº¦</strong>ã</p>
<p>è¿å°±æ¯ä¸ºä»ä¹æä»¬éè¦ NexusContract ââ <strong>å®åè®¸æä»¬å¨ä»£ç éä¼éå°âæé¹¿ä¸ºé©¬âï¼å¹¶ç¨æåºå±çææ¯ææ®µï¼åæ°æ®å·å»ï¼ï¼å°è¿ä»½âè®èçç°å®âé«æ§è½å°å°è£èµ·æ¥ã</strong></p>
<hr>

</div>
<div id="MySignature" role="contentinfo">
    <p>______________________________________<br>çæ´»ï¼è¦ç¨å£äººçè¸æé¢å¯¹ï¼ç¨ç§å­¦çæ¹æ³æ¯éï¼ <br>&nbsp; &nbsp; &nbsp; &nbsp; ç¨çå¸çå¾¡è³å»èï¼ç¨æ¸æ´çç©ºæ°æ´èºï¼ <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ç¨å°çªçæè§å»ç¡ï¼ç¨å¤ªé³çç­æçæ°´ã<br>______________________________________</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 14:20">2026-01-14 14:19</span>&nbsp;
<a href="https://www.cnblogs.com/jieky">æ¶å¤±è</a>&nbsp;
éè¯»(<span id="post_view_count">45</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19481961);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19481961', targetLink: 'https://www.cnblogs.com/jieky/p/19481961', title: '`i` å `e` ååå¼åçè¡æ¡ï¼å½ AI çâçº éçâéä¸ NexusContract çâç§å¦éâ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åºäºæ¬å°çComfyUIçAPIè°ç¨æå ]]></title>
    <link>https://www.cnblogs.com/zer0Black/p/19484326</link>
    <guid>6fb979ce95cb42c0b62459e941f203d7</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/zer0Black/p/19484326" title="åå¸äº 2026-01-14 21:31">
    <span role="heading" aria-level="2">åºäºæ¬å°çComfyUIçAPIè°ç¨æå</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="åºäºæ¬å°çcomfyui-apiè°ç¨æå">åºäºæ¬å°çComfyUI APIè°ç¨æå</h1>
<p>ComfyUIä½ä¸ºæçå¾ãæçè§é¢ãå¾çå¾ãå¾çè§é¢çåç±»æ¨¡åçå·¥ä½æµé½éå¸¸å¥½ç¨ï¼å¯ç»ååç§æ¨¡ååLoraãä½æ¯æ³è¦éè¿APIè°ç¨ç¸å¯¹æ¯è¾å¤æï¼ä¸æ å®åçææ¡£ã</p>
<p>æ¬æéè¿°äºComfyUI APIè°ç¨å®æ´æå,æ¶µçå·¥ä½æµå¯¼åºãAPIè°ç¨æµç¨ãåæ°è¯´æåPythonä»£ç å®ç°ã</p>
<h2 id="é¶ä»£ç ">é¶ãä»£ç </h2>
<p>ä¸æ³çå¤ªå¤å­ï¼ç´æ¥ä¸è½½Demoæ¥çç¤ºä¾å³å¯<br>
<code>https://github.com/zer0Black/ComfyUI-Api-Demo</code></p>
<h2 id="ä¸æ¦è¿°">ä¸ãæ¦è¿°</h2>
<p>ComfyUIæä¾äºå¼ºå¤§çAPIæ¥å£,åè®¸å¼åèéè¿ç¼ç¨æ¹å¼è°ç¨ComfyUIå·¥ä½æµ,å®ç°AIå¾åçæçèªå¨åãéè¿APIè°ç¨,å¯ä»¥æ¹éçæå¾åãéæå°ç°æç³»ç»ä¸­,å¤§å¹æåå·¥ä½æçã</p>
<h2 id="äºåå¤å·¥ä½">äºãåå¤å·¥ä½</h2>
<h3 id="21-æ­å»ºå·¥ä½æµ">2.1 æ­å»ºå·¥ä½æµ</h3>
<p>å¨ComfyUI WebUIä¸­æç§éæ±æ­å»ºå·¥ä½æµ:</p>
<ol>
<li>æå¼ComfyUIçé¢,ææ½æéçèç¹</li>
<li>è¿æ¥èç¹ä¹é´çæ°æ®æµ</li>
<li>éç½®èç¹åæ°(æ¨¡åãæç¤ºè¯ãéæ ·å¨ç­)</li>
<li>ç¹å»"Queue Prompt"æµè¯å·¥ä½æµæ¯å¦è½æ­£å¸¸çæå¾å</li>
<li>ç¡®è®¤å·¥ä½æµè¿è¡æ è¯¯å,åå¤å¯¼åº</li>
</ol>
<h3 id="22-å¯¼åºapiæ ¼å¼çjsonæä»¶">2.2 å¯¼åºAPIæ ¼å¼çJSONæä»¶</h3>
<p>å¯¼åºæ­¥éª¤:</p>
<ol>
<li>å¨ComfyUIçé¢ç¹å»é¡¶é¨èåæ ç<strong>å·¥ä½æµ</strong> (Workflow)</li>
<li>éæ©<strong>å¯¼åº(API)</strong> (Export API)</li>
<li>æµè§å¨ä¼èªå¨ä¸è½½ä¸ä¸ªJSONæä»¶,éå¸¸å½åä¸º<code>workflow_api.json</code></li>
</ol>
<p><img alt="file-20260114211440458" loading="lazy" data-src="https://img2024.cnblogs.com/blog/646489/202601/646489-20260114211512713-2001041398.png" class="lazyload"></p>
<p><mark style="background: rgba(255, 184, 108, 0.65)">éè¦æç¤º</mark>: å¯¼åºçJSONæä»¶åå«äºå·¥ä½æµçå®æ´éç½®,åæ¬ææèç¹çIDãåæ°åè¿æ¥å³ç³»ãè¿ä¸ªæä»¶æ¯APIè°ç¨çæ ¸å¿è¾å¥ã</p>
<h2 id="ä¸jsonæä»¶è¯¦è§£">ä¸ãJSONæä»¶è¯¦è§£</h2>
<h3 id="31-jsonæä»¶ç»æ">3.1 JSONæä»¶ç»æ</h3>
<p>å¯¼åºç<code>workflow_api.json</code>æä»¶æ¯ä¸ä¸ªå­å¸,é®ä¸ºèç¹ID,å¼ä¸ºèç¹éç½®:</p>
<pre><code>{
  "60": {
    "inputs": {
      "filename_prefix": "Qwen-Image-2512",
      "images": [
        "86:8",
        0
      ]
    },
    "class_type": "SaveImage",
    "_meta": {
      "title": "ä¿å­å¾å"
    }
  },
  "91": {
    "inputs": {
      "value": "æç¤ºè¯åå¨è¿"
    },
    "class_type": "PrimitiveStringMultiline",
    "_meta": {
      "title": "Prompt"
    }
  },
  "86:39": {
    "inputs": {
      "vae_name": "qwen_image_vae.safetensors"
    },
    "class_type": "VAELoader",
    "_meta": {
      "title": "å è½½VAE"
    }
  },
  "86:38": {
    "inputs": {
      "clip_name": "qwen_2.5_vl_7b_fp8_scaled.safetensors",
      "type": "qwen_image",
      "device": "default"
    },
    "class_type": "CLIPLoader",
    "_meta": {
      "title": "å è½½CLIP"
    }
  },
  "86:37": {
    "inputs": {
      "unet_name": "qwen_image_2512_fp8_e4m3fn.safetensors",
      "weight_dtype": "default"
    },
    "class_type": "UNETLoader",
    "_meta": {
      "title": "UNetå è½½å¨"
    }
  },
  "86:3": {
    "inputs": {
      "seed": 4,
      "steps": 50,
      "cfg": 4,
      "sampler_name": "euler",
      "scheduler": "simple",
      "denoise": 1,
      "model": [
        "86:66",
        0
      ],
      "positive": [
        "86:81",
        0
      ],
      "negative": [
        "86:7",
        0
      ],
      "latent_image": [
        "86:58",
        0
      ]
    },
    "class_type": "KSampler",
    "_meta": {
      "title": "Kéæ ·å¨"
    }
  },
  "86:58": {
    "inputs": {
      "width": 1664,
      "height": 928,
      "batch_size": 1
    },
    "class_type": "EmptySD3LatentImage",
    "_meta": {
      "title": "ç©ºLatentå¾åï¼SD3ï¼"
    }
  },
  "86:81": {
    "inputs": {
      "text": [
        "91",
        0
      ],
      "clip": [
        "86:38",
        0
      ]
    },
    "class_type": "CLIPTextEncode",
    "_meta": {
      "title": "CLIP Text Encode (Positive Prompt)"
    }
  },
  "86:8": {
    "inputs": {
      "samples": [
        "86:3",
        0
      ],
      "vae": [
        "86:39",
        0
      ]
    },
    "class_type": "VAEDecode",
    "_meta": {
      "title": "VAEè§£ç "
    }
  },
  "86:66": {
    "inputs": {
      "shift": 3.1000000000000005,
      "model": [
        "86:37",
        0
      ]
    },
    "class_type": "ModelSamplingAuraFlow",
    "_meta": {
      "title": "éæ ·ç®æ³ï¼AuraFlowï¼"
    }
  },
  "86:7": {
    "inputs": {
      "text": "ä½åè¾¨çï¼ä½ç»è´¨ï¼è¢ä½ç¸å½¢ï¼ææç¸å½¢ï¼ç»é¢è¿é¥±åï¼è¡åæï¼äººè¸æ ç»èï¼è¿åº¦åæ»ï¼ç»é¢å·æAIæãæå¾æ··ä¹±ãæå­æ¨¡ç³ï¼æ­æ²",
      "clip": [
        "86:38",
        0
      ]
    },
    "class_type": "CLIPTextEncode",
    "_meta": {
      "title": "CLIP Text Encode (Negative Prompt)"
    }
  }
}
</code></pre>
<h3 id="32-jsonæä»¶çæ¥æº">3.2 JSONæä»¶çæ¥æº</h3>
<p>JSONæä»¶æ¯éè¿ComfyUI WebUIç"å·¥ä½æµ &gt; å¯¼åº(API)"åè½èªå¨çæç,å®åç¡®åæ äºå½åå¯è§åå·¥ä½æµçç¶æã</p>
<h3 id="33-éè¦ä¿®æ¹çåæ°">3.3 éè¦ä¿®æ¹çåæ°</h3>
<p>éå¸¸æåµä¸,ä½ éè¦ä¿®æ¹ä»¥ä¸åæ°æ¥å®ç°å¨æè°ç¨:</p>
<table>
<thead>
<tr>
<th>èç¹ç±»å</th>
<th>åæ°åç§°</th>
<th>è¯´æ</th>
<th>ä¿®æ¹å»ºè®®</th>
</tr>
</thead>
<tbody>
<tr>
<td>KSampler</td>
<td><code>seed</code></td>
<td>éæºç§å­</td>
<td>è®¾ç½®ä¸º-1å¯èªå¨çæéæºæ°,ææ¯æ¬¡è¯·æ±æå®ä¸åçå¼</td>
</tr>
<tr>
<td>KSampler</td>
<td><code>steps</code></td>
<td>éæ ·æ­¥æ°</td>
<td>æ ¹æ®è´¨ééæ±è°æ´,éå¸¸20-50</td>
</tr>
<tr>
<td>KSampler</td>
<td><code>cfg</code></td>
<td>æç¤ºè¯ç¸å³æ§</td>
<td>éå¸¸7-12,æ°å¼è¶é«è¶éµå¾ªæç¤ºè¯</td>
</tr>
<tr>
<td>CLIPTextEncode</td>
<td><code>text</code></td>
<td>æç¤ºè¯</td>
<td>ä¿®æ¹ä¸ºä½ è¦çæçå¾åæè¿°</td>
</tr>
<tr>
<td>EmptyLatentImage</td>
<td><code>width</code></td>
<td>å¾åå®½åº¦</td>
<td>æ ¹æ®éæ±è°æ´(å¦512, 768, 1024)</td>
</tr>
<tr>
<td>EmptyLatentImage</td>
<td><code>height</code></td>
<td>å¾åé«åº¦</td>
<td>æ ¹æ®éæ±è°æ´</td>
</tr>
<tr>
<td>CheckpointLoaderSimple</td>
<td><code>ckpt_name</code></td>
<td>æ¨¡åæä»¶å</td>
<td>åæ¢ä¸åçåºç¡æ¨¡å</td>
</tr>
</tbody>
</table>
<p><mark style="background: rgba(255, 184, 108, 0.65)">ä¿®æ¹ç¤ºä¾</mark>:</p>
<p>ç±äºæ¯ä¸ªå·¥ä½æµéç½®åºçèç¹åç§°ä¸ä¸æ ·ï¼éè¦æ ¹æ®å°å¤çjsonæ ¼å¼è¿è¡ä¿®æ¹</p>
<pre><code class="language-python"># å è½½åå§JSON
with open("workflow_api.json", "r", encoding="utf-8") as f:
    workflow = json.load(f)

# ä¿®æ¹æç¤ºè¯
workflow["91"]["inputs"]["text"] = "ä¸åªå¯ç±çç«åªå¨è±å­éç©è,é«æ¸æå½±,8K"

# ä¿®æ¹å¾åå°ºå¯¸
workflow["86:58"]["inputs"]["width"] = 1024
workflow["86:58"]["inputs"]["height"] = 1024

# éæºç§å­
workflow["86:3"]["inputs"]["seed"] = -1
</code></pre>
<h2 id="åapiè°ç¨æµç¨">åãAPIè°ç¨æµç¨</h2>
<h3 id="41-è°ç¨æµç¨å¾">4.1 è°ç¨æµç¨å¾</h3>
<pre><code>1. æ­å»ºComfyUIå·¥ä½æµ
       â
2. å¨WebUIä¸­æµè¯å¹¶ç¡®è®¤å·¥ä½æ­£å¸¸
       â
3. å¯¼åºAPIæ ¼å¼JSONæä»¶
       â
4. å¨ä»£ç ä¸­å è½½JSON
       â
5. ä¿®æ¹éè¦å¨æè°æ´çåæ°
       â
6. åéPOSTè¯·æ±å°ComfyUIæå¡å¨
       â
7. ç­å¾å¹¶æ¥æ¶çæç»æ
       â
8. å¤çè¿åçå¾åæ°æ®
</code></pre>
<h3 id="42-è·åcomfyuiæå¡å¨å°å">4.2 è·åComfyUIæå¡å¨å°å</h3>
<ul>
<li><strong>æ¬å°é¨ç½²</strong>: éå¸¸ä¸º <code>http://127.0.0.1:8188/api</code></li>
<li><strong>äºæå¡å¨</strong>: æ¿æ¢ä¸ºä½ çå¬ç½IPæåå</li>
</ul>
<h2 id="äºpythonä»£ç å®ç°">äºãPythonä»£ç å®ç°</h2>
<h3 id="51-åºç¡åæ­¥è°ç¨">5.1 åºç¡åæ­¥è°ç¨</h3>
<p>æç®åçè°ç¨æ¹å¼,ç´æ¥ç­å¾ç»æè¿å:</p>
<pre><code class="language-python">import requests
import json

# ComfyUIæå¡å¨å°å
COMFYUI_ADDRESS = "http://127.0.0.1:8188/api"

def generate_image_sync(prompt_text, width=512, height=512):
    """
    åæ­¥è°ç¨ComfyUI APIçæå¾å
    """
    # 1. å è½½å·¥ä½æµJSON
    with open("workflow_api.json", "r", encoding="utf-8") as f:
        workflow = json.load(f)

    # 2. ä¿®æ¹åæ°
    workflow["91"]["inputs"]["text"] = prompt_text  # ä¿®æ¹æç¤ºè¯
    workflow["86:58"]["inputs"]["width"] = width
    workflow["86:58"]["inputs"]["height"] = height
    workflow["86:3"]["inputs"]["seed"] = -1  # éæºç§å­

    # 3. åéPOSTè¯·æ±
    endpoint = f"{COMFYUI_ADDRESS}/prompt"
    response = requests.post(
        endpoint,
        json={"prompt": workflow},
        headers={"Content-Type": "application/json"}
    )

    # 4. è·åprompt_id
    result = response.json()
    prompt_id = result["prompt_id"]
    print(f"ä»»å¡å·²æäº¤,prompt_id: {prompt_id}")

    # 5. ç­å¾çæå®æ
    history_endpoint = f"{COMFYUI_ADDRESS}/history/{prompt_id}"
    import time
    while True:
        history_response = requests.get(history_endpoint)
        history_data = history_response.json()

        if prompt_id in history_data:
            # è·åçæçå¾å
            outputs = history_data[prompt_id]["outputs"]
            for node_id, output_data in outputs.items():
                if "images" in output_data:
                    for img in output_data["images"]:
                        image_filename = img["filename"]
                        print(f"å¾åå·²çæ: {image_filename}")
                        return {
                            "prompt_id": prompt_id,
                            "filename": image_filename,
                            "full_path": f"{COMFYUI_ADDRESS}/view?filename={image_filename}"
                        }
            break

        time.sleep(1)

    return None

# ä½¿ç¨ç¤ºä¾
if __name__ == "__main__":
    result = generate_image_sync(
        prompt_text="ä¸åªå¯ç±çç«åªå¨è±å­éç©è,é«æ¸æå½±,8K,ç»èä¸°å¯",
        width=768,
        height=768
    )
    print(result)
</code></pre>
<h3 id="52-ä½¿ç¨websocketå®æ¶çå¬">5.2 ä½¿ç¨WebSocketå®æ¶çå¬</h3>
<p>è·åå®æ¶è¿åº¦,éåéè¦æ¾ç¤ºçæè¿ç¨çåºæ¯:</p>
<pre><code class="language-python">import websocket
import json
import uuid
import requests
import time

class ComfyUIWebSocketClient:
    def __init__(self, server_address="127.0.0.1:8188"):
        self.server_address = server_address
        self.client_id = str(uuid.uuid4())
        self.ws = None
        self.result = None

    def send_prompt(self, workflow):
        """
        éè¿WebSocketåéå·¥ä½æµ
        """
        # è¿æ¥WebSocket
        ws_url = f"ws://{self.server_address}/ws?clientId={self.client_id}"
        self.ws = websocket.create_connection(ws_url)

        # åéPOSTè¯·æ±
        prompt_endpoint = f"http://{self.server_address}/api/prompt"
        payload = {
            "prompt": workflow,
            "client_id": self.client_id
        }

        response = requests.post(
            prompt_endpoint,
            json=payload,
            headers={"Content-Type": "application/json"}
        )

        return response.json()

    def listen_progress(self, prompt_id):
        """
        çå¬çæè¿åº¦
        """
        try:
            while True:
                message = self.ws.recv()
                data = json.loads(message)

                # å¤çä¸åç±»åçæ¶æ¯
                if data["type"] == "status":
                    print(f"ç¶ææ´æ°: {data['data']}")

                elif data["type"] == "executing":
                    node_id = data["data"].get("node")
                    print(f"æ­£å¨æ§è¡èç¹: {node_id}")

                elif data["type"] == "progress":
                    value = data["data"]["value"]
                    max_value = data["data"]["max"]
                    print(f"è¿åº¦: {value}/{max_value}")

                elif data["type"] == "execution_start":
                    print("å¼å§æ§è¡")

                elif data["type"] == "execution_success":
                    print("æ§è¡æå!")
                    self.result = data
                    break

                elif data["type"] == "execution_cached":
                    print("ä½¿ç¨äºç¼å­")

        except KeyboardInterrupt:
            print("çå¬ä¸­æ­")
        finally:
            self.ws.close()

def generate_image_with_websocket(prompt_text):
    """
    ä½¿ç¨WebSocketæ¹å¼çæå¾å
    """
    client = ComfyUIWebSocketClient()

    # å è½½å¹¶ä¿®æ¹å·¥ä½æµ
    with open("workflow_api.json", "r", encoding="utf-8") as f:
        workflow = json.load(f)

    workflow["91"]["inputs"]["text"] = prompt_text  # ä¿®æ¹æç¤ºè¯
    workflow["86:3"]["inputs"]["seed"] = -1  # éæºç§å­

    # åéå·¥ä½æµ
    result = client.send_prompt(workflow)
    prompt_id = result["prompt_id"]
    print(f"Prompt ID: {prompt_id}")

    # çå¬è¿åº¦
    client.listen_progress(prompt_id)

    return client.result

# ä½¿ç¨ç¤ºä¾
if __name__ == "__main__":
    result = generate_image_with_websocket("æ¥è½æ¶åçæµ·è¾¹é£å,éé»è²çé³åæ´å¨æ²æ»©ä¸")
    print(f"çæå®æ: {result}")
</code></pre>
<h3 id="53-æ¹éçæå¾å">5.3 æ¹éçæå¾å</h3>
<p>èªå¨åæ¹éçæå¤ä¸ªå¾å:</p>
<pre><code class="language-python">import requests
import json
import time
import concurrent.futures

COMFYUI_ADDRESS = "http://127.0.0.1:8188"

def generate_single_image(prompt_text, seed=None, width=512, height=512):
    """
    çæåå¼ å¾å
    """
    with open("workflow_api.json", "r", encoding="utf-8") as f:
        workflow = json.load(f)

    workflow["91"]["inputs"]["text"] = prompt_text  # ä¿®æ¹æç¤ºè¯
    workflow["86:58"]["inputs"]["width"] = width
    workflow["86:58"]["inputs"]["height"] = height
    workflow["86:3"]["inputs"]["seed"] = -1  # éæºç§å­
    

    if seed is None:
        workflow["86:3"]["inputs"]["seed"] = -1  # éæºç§å­
    else:
        workflow["86:3"]["inputs"]["seed"] = seed

    endpoint = f"{COMFYUI_ADDRESS}/prompt"
    response = requests.post(
        endpoint,
        json={"prompt": workflow},
        headers={"Content-Type": "application/json"}
    )

    result = response.json()
    prompt_id = result["prompt_id"]

    # ç­å¾å®æ
    while True:
        history_response = requests.get(f"{COMFYUI_ADDRESS}/history/{prompt_id}")
        history_data = history_response.json()

        if prompt_id in history_data:
            outputs = history_data[prompt_id]["outputs"]
            for node_id, output_data in outputs.items():
                if "images" in output_data:
                    filename = output_data["images"][0]["filename"]
                    return {
                        "prompt": prompt_text,
                        "seed": workflow["86:3"]["inputs"]["seed"],
                        "filename": filename,
                        "url": f"{COMFYUI_ADDRESS}/view?filename={filename}"
                    }
        time.sleep(0.5)

def batch_generate(prompts, max_workers=2):
    """
    æ¹éçæå¾å(å¹¶å)
    """
    results = []
    with concurrent.futures.ThreadPoolExecutor(max_workers=max_workers) as executor:
        future_to_prompt = {
            executor.submit(generate_single_image, prompt): prompt
            for prompt in prompts
        }

        for future in concurrent.futures.as_completed(future_to_prompt):
            prompt = future_to_prompt[future]
            try:
                result = future.result()
                results.append(result)
                print(f"â å®æ: {prompt}")
            except Exception as e:
                print(f"â å¤±è´¥: {prompt}, éè¯¯: {e}")

    return results

# ä½¿ç¨ç¤ºä¾
if __name__ == "__main__":
    prompts = [
        "ä¸åªå¯ç±çç«åªå¨è±å­éç©è",
        "ç¾ä¸½çæ¥è½é£æ¯,éè²é³å",
        "é«å±±æ¹æ³,åå½±æ¸æ°",
        "åå¸å¤æ¯,éè¹éªç",
        "æ£®æå°å¾,é³åæé©³"
    ]

    print("å¼å§æ¹éçæ...")
    results = batch_generate(prompts, max_workers=2)

    print(f"\nçæå®æ,å± {len(results)} å¼ å¾å:")
    for i, result in enumerate(results, 1):
        print(f"{i}. {result['prompt']}")
        print(f"   æä»¶: {result['filename']}")
        print(f"   é¾æ¥: {result['url']}\n")
</code></pre>
<h3 id="54-ä¸è½½çæçå¾å">5.4 ä¸è½½çæçå¾å</h3>
<p>å°çæçå¾åä¿å­å°æ¬å°:</p>
<pre><code class="language-python">import requests
import os

def download_image(image_url, save_path, filename=None):
    """
    ä¸è½½çæçå¾åå°æ¬å°
    """
    try:
        response = requests.get(image_url)
        response.raise_for_status()

        if filename is None:
            filename = image_url.split("filename=")[-1]

        full_path = os.path.join(save_path, filename)
        os.makedirs(save_path, exist_ok=True)

        with open(full_path, "wb") as f:
            f.write(response.content)

        print(f"å¾åå·²ä¿å­: {full_path}")
        return full_path

    except Exception as e:
        print(f"ä¸è½½å¤±è´¥: {e}")
        return None

# ä½¿ç¨ç¤ºä¾
if __name__ == "__main__":
    image_url = "http://127.0.0.1:8188/view?filename=ComfyUI_00001.png"
    save_path = "./generated_images"
    download_image(image_url, save_path)
</code></pre>
<h2 id="å­ä¼ åè¦æ±è¯¦è§£">å­ãä¼ åè¦æ±è¯¦è§£</h2>
<h3 id="61-è¯·æ±åæ°">6.1 è¯·æ±åæ°</h3>
<table>
<thead>
<tr>
<th>åæ°</th>
<th>ç±»å</th>
<th>å¿å¡«</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>prompt</code></td>
<td>object</td>
<td>æ¯</td>
<td>å·¥ä½æµJSONå¯¹è±¡</td>
</tr>
<tr>
<td><code>client_id</code></td>
<td>string</td>
<td>å¦</td>
<td>å®¢æ·ç«¯æ è¯ç¬¦,ç¨äºåºåä¸åè¯·æ±</td>
</tr>
</tbody>
</table>
<h3 id="62-ååºåæ°">6.2 ååºåæ°</h3>
<table>
<thead>
<tr>
<th>åæ°</th>
<th>ç±»å</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>prompt_id</code></td>
<td>string</td>
<td>ä»»å¡çå¯ä¸æ è¯ç¬¦</td>
</tr>
<tr>
<td><code>number</code></td>
<td>number</td>
<td>éåä¸­æéçä»»å¡æ°</td>
</tr>
<tr>
<td><code>node_errors</code></td>
<td>object</td>
<td>èç¹éè¯¯ä¿¡æ¯</td>
</tr>
</tbody>
</table>
<h3 id="63-å¸¸è§httpç¶æç ">6.3 å¸¸è§HTTPç¶æç </h3>
<table>
<thead>
<tr>
<th>ç¶æç </th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>200</td>
<td>è¯·æ±æå</td>
</tr>
<tr>
<td>400</td>
<td>è¯·æ±åæ°éè¯¯</td>
</tr>
<tr>
<td>500</td>
<td>æå¡å¨åé¨éè¯¯</td>
</tr>
</tbody>
</table>
<h2 id="ä¸å¸¸è§é®é¢">ä¸ãå¸¸è§é®é¢</h2>
<h3 id="q1-æç¤ºè¯ä¸çææä¹å">Q1: æç¤ºè¯ä¸çææä¹å?</h3>
<p>æ£æ¥èç¹IDæ¯å¦æ­£ç¡®ãå¯¼åºçJSONä¸­,CLIPTextEncodeèç¹çIDå¯è½ä¸ä½ çä¸å,éè¦æ ¹æ®å®éJSONè°æ´ã</p>
<h3 id="q2-å¦ä½è·åçæçå¾åæä»¶">Q2: å¦ä½è·åçæçå¾åæä»¶?</h3>
<p>æ¹æ³1: éè¿<code>/view</code>ç«¯ç¹ç´æ¥è®¿é®</p>
<pre><code class="language-python">image_url = f"{COMFYUI_ADDRESS}/view?filename={filename}"
</code></pre>
<p>æ¹æ³2: ä»ComfyUIç<code>output</code>ç®å½ç´æ¥å¤å¶æä»¶</p>
<h3 id="q3-æ¹éçæéåº¦æ¢æä¹å">Q3: æ¹éçæéåº¦æ¢æä¹å?</h3>
<ol>
<li>ä½¿ç¨å¤çº¿ç¨å¹¶åè¯·æ±</li>
<li>ä¼åå·¥ä½æµ,åå°ä¸å¿è¦çèç¹</li>
<li>ä½¿ç¨æ´å¼ºå¤§çGPU</li>
<li>èèä½¿ç¨äºå¹³å°çServerless API,æ¯æå¤å®ä¾å¹¶å</li>
</ol>
<h3 id="q4-apiè°ç¨è¿åéè¯¯">Q4: APIè°ç¨è¿åéè¯¯?</h3>
<p>æ£æ¥:</p>
<ol>
<li>ComfyUIæå¡å¨æ¯å¦æ­£å¸¸è¿è¡</li>
<li>å·¥ä½æµJSONæ ¼å¼æ¯å¦æ­£ç¡®</li>
<li>èç¹è¿æ¥å³ç³»æ¯å¦å®æ´</li>
<li>æ¨¡åæä»¶æ¯å¦å­å¨</li>
</ol>
<h2 id="å«è¿é¶æå·§">å«ãè¿é¶æå·§</h2>
<h3 id="81-å¨ææ¿æ¢æ¨¡å">8.1 å¨ææ¿æ¢æ¨¡å</h3>
<pre><code class="language-python">def change_model(workflow, model_name):
    """
    åæ¢æ¨¡å
    """
    # åè®¾èç¹4æ¯CheckpointLoaderSimple
    workflow["4"]["inputs"]["ckpt_name"] = model_name
    return workflow

# ä½¿ç¨
workflow = change_model(workflow, "sd_xl_base_1.0.safetensors")
</code></pre>
<h3 id="82-æ·»å controlnet">8.2 æ·»å ControlNet</h3>
<p>å¯¼åºçJSONå¦æåå«ControlNet,éè¦ç¡®ä¿ControlNetæ¨¡åå·²å è½½:</p>
<pre><code class="language-python"># ControlNeté¢å¤çå¨èç¹éå¸¸éè¦é¢å¤çåæ°
workflow["controlnet_node"]["inputs"]["image"] = ["load_image_node", 0]
</code></pre>
<h3 id="83-loraè°ç¨">8.3 Loraè°ç¨</h3>
<pre><code class="language-python"># å¨KSamplerä¹åæ·»å Loraå è½½èç¹
# ä¿®æ¹modelçè¿æ¥,ä»CheckpointLoaderæ¹ä¸ºLoraLoader
workflow["3"]["inputs"]["model"] = ["lora_loader_node", 0]
</code></pre>
<h2 id="ä¹æ»ç»">ä¹ãæ»ç»</h2>
<p>éè¿ComfyUI API,æä»¬å¯ä»¥å®ç°:</p>
<ul>
<li>â å·¥ä½æµèªå¨åæ§è¡</li>
<li>â æ¹éå¾åçæ</li>
<li>â éæå°ç°æç³»ç»</li>
<li>â å®æ¶è¿åº¦çæ§</li>
<li>â äºç«¯é¨ç½²åæ©å±</li>
</ul>
<p>å³é®æ­¥éª¤:</p>
<ol>
<li>å¨ComfyUI WebUIä¸­æ­å»ºå¹¶æµè¯å·¥ä½æµ</li>
<li>å¯¼åºAPIæ ¼å¼JSONæä»¶</li>
<li>å¨ä»£ç ä¸­å è½½JSONå¹¶ä¿®æ¹åæ°</li>
<li>éè¿HTTP/WebSocketåéè¯·æ±</li>
<li>å¤çè¿åç»æ</li>
</ol>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 21:31">2026-01-14 21:31</span>&nbsp;
<a href="https://www.cnblogs.com/zer0Black">éæ»çç¨åºäººç</a>&nbsp;
éè¯»(<span id="post_view_count">5</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19484326);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19484326', targetLink: 'https://www.cnblogs.com/zer0Black/p/19484326', title: 'åºäºæ¬å°çComfyUIçAPIè°ç¨æå' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ è§é¢çè§£æ¨¡åæ¨çä¸å¾®è° ]]></title>
    <link>https://www.cnblogs.com/zackstang/p/19481125</link>
    <guid>82405bea4d750ff18b315c8cff7603a4</guid>
    <description>
    <![CDATA[ 
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/zackstang/p/19481125" title="åå¸äº 2026-01-14 20:54">
    <span role="heading" aria-level="2">è§é¢çè§£æ¨¡åæ¨çä¸å¾®è°</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>è§é¢çè§£æ¨¡åæ¨çä¸å¾®è°</h1>
<p>éçå¤æ¨¡æå¤§æ¨¡åçæç»­åå±ï¼è§é¢çè§£ãå¤æ¨¡ææ£ç´¢åæºè½æ æ³¨ç­åºç¨åºæ¯éæ¸è½å°ãä¸ºäºè¿ä¸æ­¥æ¢ç©¶å¤æ¨¡æè§é¢çè§£æ¨¡åå¨å®éå·¥ç¨ä¸­çåºç¨æ¹å¼ï¼æ¬æä»¥ Qwen3-VL ç³»åæ¨¡åä¸ºä¾ï¼ç³»ç»æ¢³çå¶å¨è§é¢åºæ¯ä¸çæ¨çä¸å¨åæ°å¾®è°å®è·µãæç« é¦åéè¿ä¸ä¸ªå®æ´çè§é¢æ¬å°æ¨çç¤ºä¾ï¼è¯¦ç»æè§£æ¨¡åè¾å¥çæå»ºæµç¨ï¼åæ¬è§é¢å¸§éæ ·ãpatch ååä»¥åæ¶åºä¸ç©ºé´ç»´åº¦çåå¹¶ç­å³é®ç»èï¼éååºäºçå®æ¸¸æè§é¢æ°æ®ï¼ä»ç»è§é¢æä»¤å¾®è°æ°æ®éçæå»ºæ¹æ³ï¼å¹¶å®æä¸æ¬¡å¨åæ°å¾®è°ä¸ææéªè¯ã</p>
<p>&nbsp;</p>
<h2>1. è§é¢æ¨ç</h2>
<p>é¦åçä¸ä¸ªqwen3-vl-4b-instructæ¨¡ååè§é¢æ¬å°æ¨ççä¾å­ï¼ç¤ºä¾ä»£ç å¦ä¸ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">from transformers import AutoProcessor, AutoModelForVision2Seq
from qwen_vl_utils import process_vision_info
import warnings
warnings.filterwarnings("ignore", category=FutureWarning, module="transformers")
import os 

# å è½½æ¨¡ååå¤çå¨
model_path = "Qwen/Qwen3-VL-4B-Instruct"
processor = AutoProcessor.from_pretrained(model_path)

# å è½½è§è§-ææ¬æ¨¡å
model, output_loading_info = AutoModelForVision2Seq.from_pretrained(
    model_path, 
    torch_dtype="auto", 
    device_map="auto", 
    output_loading_info=True
)
print("output_loading_info", output_loading_info)


# éç½®è§é¢å¤çåæ°
video = "./1.mp4"
total_pixels = 20480 * 32 * 32  # æ»åç´ éå¶
min_pixels = 64 * 32 * 32  # æå°åç´ éå¶
max_frames = 2048  # æå¤§å¸§æ°
sample_fps = 2  # éæ ·å¸§ç
max_new_tokens = 2048  # çæçæå¤§ token æ°

prompt = "è¯·æè¿°è¿ä¸ªè§é¢çåå®¹"

# æå»ºå¯¹è¯æ¶æ¯
messages = [
    {
        "role": "user",
        "content": [
            {
                "video": video,
                "total_pixels": total_pixels,
                "min_pixels": min_pixels,
                "max_frames": max_frames,
                'sample_fps': sample_fps
            },
            {
                "type": "text", 
                "text": prompt
            },
        ]
    },
]

# åºç¨å¯¹è¯æ¨¡æ¿
text = processor.apply_chat_template(messages, tokenize=False, add_generation_prompt=True)

# å¤çè§è§ä¿¡æ¯
image_inputs, video_inputs, video_kwargs = process_vision_info(
    [messages], 
    return_video_kwargs=True, 
    image_patch_size=16,
    return_video_metadata=True
)

# åç¦»è§é¢æ°æ®ååæ°æ®
if video_inputs is not None:
    video_inputs, video_metadatas = zip(*video_inputs)
    video_inputs, video_metadatas = list(video_inputs), list(video_metadatas)
else:
    video_metadatas = None


# åå¤æ¨¡åè¾å¥
inputs = processor(
    text=[text], 
    images=image_inputs, 
    videos=video_inputs, 
    video_metadata=video_metadatas, 
    **video_kwargs, 
    do_resize=False, 
    return_tensors="pt"
)
inputs = inputs.to('cuda')

# çæè¾åº
output_ids = model.generate(**inputs, max_new_tokens=max_new_tokens)

# æåçæçé¨åï¼å»é¤è¾å¥ï¼
generated_ids = [
    output_ids[len(input_ids):] 
    for input_ids, output_ids in zip(inputs.input_ids, output_ids)
]

# è§£ç ä¸ºææ¬
output_text = processor.batch_decode(
    generated_ids, 
    skip_special_tokens=True, 
    clean_up_tokenization_spaces=True
)

print(output_text)
['è§é¢ç±å¤ä¸ªéå¤´ç»æï¼å±ç°äºå¨æ¼«é£æ ¼çç»é¢åäººç©ãç¬¬ä¸é¨åæ¯ä¸ä¸ªç·æ§è§è²çç¹åï¼ä»æçé»è²é¿åï¼é¢å¤´ä¸­å¤®æä¸éçº¢è²å°è®°ï¼ç¼ç¥éå©ï¼ææè½»è§¦è¸é¢ï¼è¡¨æä¸¥èãç»é¢ä¸­åºç°å­å¹ï¼âé¡¾é¿æ­çæ¯åååâï¼âå ç¾å²çèå¥³äººçä¸»æä»ä¹æâï¼âå°±å¨é¡¾é¿æ­é·å®³åå¤©åâãè¿æç¤ºäºè§è²é¡¾é¿æ­çç¡ç¾åä»æç­åçé´è°ã\n\nç¬¬äºé¨ååæ¢å°ä¸ä¸ªå¥³æ§è§è²çç¹åï¼å¥¹æçé¿é¿çé»åï¼çç®é´æµé²åºä¸ä¸å·ç¬ï¼å´è§ä¸æ¬ï¼ä¼¼ä¹å¨ç­åææ§è¡æä¸ªè®¡åãå­å¹æ¾ç¤ºï¼âä»å©åå°¹æ¹âï¼âè®©åå¤©çå§å§åå©äº²èªè¿æ¥èµäººâãè¿è¡¨æå¥¹è¢«é¡¾é¿æ­ææ´¾å»æ§è¡æä¸ªä»»å¡ã\n\nç¬¬ä¸é¨åæ¯å¦ä¸ä¸ªå¥³æ§è§è²çç¹åï¼å¥¹çç´«è²ç¼çéå¸¸éç®ï¼ç¼ç¥ä¸­éé²åºæè®¶åéæãå­å¹æ¾ç¤ºï¼âåå©æçä¸é¨é¢ç¥ç¥¸ç¦çæ¯æ³ç¥éâï¼âå½å¥¹ç¨è¿ç§æ¯æ³âï¼âå¯¹è¿æ¬¡èµäººä¹çº¦æ¨æ¼æ¶âï¼âå´æå¤çæå°äºåâãè¿è¯´æåå©æ¥ææç§é¢ç¥è½åï¼ä½å¨æ¨æ¼æ¶å´æå¤å°éå°äºä»ä¹ï¼æç¤ºäºå§æçè½¬æã\n\næ´ä¸ªè§é¢éè¿è¿äºç¹åéå¤´ï¼å±ç°äºè§è²ä¹é´çå¤æå³ç³»åå§æçåå±ï¼åæ»¡äºç´§å¼ åæ¬å¿µã']
</pre>
</div>
<p>ãã</p>
<h3>1.1. æ¨¡åè¾å¥è¯´æ</h3>
<p>è¿éçéæ³¨æä¸ä¸æ¨¡åçè¾å¥é¨åå¤çãå¯ä»¥çå°å¨æå»ºinputsæ¶ï¼éè¦æå ä¸ªè¾å¥ï¼åå«ä¸º[text]ãimage_inputsãvideo_inputsãvideo_metadatasåvideo_kwargsï¼ä»¥ådo_resize=Falseã</p>
<p>é¦åtextæ¯å¯¹è¯æ¨¡æ¿ï¼å¶å¯¹åºçåå®¹ä¸ºï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">'&lt;|im_start|&gt;user\n&lt;|vision_start|&gt;&lt;|video_pad|&gt;&lt;|vision_end|&gt;è¯·æè¿°è¿ä¸ªè§é¢çåå®¹&lt;|im_end|&gt;\n&lt;|im_start|&gt;assistant\n'
</pre>
</div>
<p>ãã</p>
<p>å¯ä»¥çå°ï¼textå®ä¹äºåç»­è¾å¥å°æ¨¡åçæ¨¡æ¿ï¼å¶ä¸­video_padå³ä¸ºå ä½tokenï¼åç»­å°ç±å®éçvideoæ°æ®è¿è¡è¡¥åã</p>
<p>&nbsp;</p>
<h3>1.2. è§é¢å¸§ä¿¡æ¯åå¤</h3>
<p>image_inputs, video_inputsåvideo_kwargsä¸º process_vision_info() æ¹æ³å¤çåçè¿åãè¿ä¸ªæ¹æ³æ¯å°åå§è§é¢æä»¶è½¬æ¢ä¸ºæ¨¡åå¯ä»¥çè§£çæ ¼å¼ï¼å·ä½å°è¯´ï¼ä¼åä»¥ä¸å ä»¶äºæï¼</p>
<ol>
<li>ä½¿ç¨opencvè¯»åè§é¢åºæ¬ä¿¡æ¯ï¼åæ¬è§é¢çfpsï¼åè®¾æ¯60 fpsï¼, total_framesï¼åè®¾è§é¢ä¸º15sï¼åä¸º900å¸§ï¼, widthï¼1280ï¼åheightï¼720ï¼</li>
<li>æç§æå®çsample_fpsè¿è¡å¸§éæ ·ï¼è¿éæå®ä¸º2ï¼ä¹å°±æ¯æ¯1sé2å¸§ãåè§é¢ä¸º15ç§900å¸§çè¯ï¼å¨éæ ·åå°±æ¯30å¸§ï¼éæ ·é´éå°±æ¯60/2=30ï¼ä¹å°±æ¯æ¯30å¸§å1å¸§ã<span style="color: rgba(255, 0, 0, 1)">è¿æ ·å°±å¾å°äºåç»­ç¨äºæ¨ççå¸§åºåï¼0, 31, 62, â¦, 899ï¼</span></li>
<li>å¨æè°æ´åè¾¨çãå¨ä¼ å¥çmessagesåæ°éé¤äºvideoçè·¯å¾å¤ï¼è¿åæ¬, min_pixelsï¼æå®ä¸º64 * 32 * 32 = 65,536ï¼, total_pixelsï¼æå®ä¸º20480 * 32 * 32=20,971,520ï¼ å sample_fpsçä¿¡æ¯ãsample_fpsçä½ç¨ä¸é¢å·²ç»æå°ãtotal_pixelsåmin_pixelsç¨äºçº¦æè°æ´åè¾¨çã<ol>
<li>åè®¾åå§è§é¢æ¯1280 x 720çåè¾¨çï¼ä¹å°±æ¯æ¯å¸§åå«921,600ä¸ªåç´ ãé£30å¸§ * 921,600 = 27,648,000æ»åç´ ï¼å¤§äºæå®çmax_pixelsãæä»¥ä¼ç»§ç»­å¯¹å¸§åºåè¿è¡åç´ ç¼©æ¾</li>
</ol></li>
<li>è°æ´å°patch_sizeçæ´æ°åãPatch sizeæ¯ViTï¼Vision Transformerï¼æ¶æçæ ¸å¿è®¾è®¡ï¼å®æ¯å°å¾åååä¸ºåºå®å¤§å°çpatchï¼æ¯ä¸ªpatchæç»ä½ä¸º1ä¸ªtokenè¾å¥å°transformerä¸­ãè¿épatch sizeæå®ä¸º16ï¼ä¹å°±æ¯æ¯ä¸ªtokenæ¬è´¨ä¸æ¯ä¸ä¸ª16x16çåç´ åºåãæä»¥éè¦åºäºpatch_sizeçè®¾ç½®ï¼å°æ¯å¸§è°æ´å°patch_sizeçæ´æ°å<ol>
<li><span style="color: rgba(255, 0, 0, 1)">å¯¹é½å°patch_sizeçæ´æ°ååï¼æç»åè¾¨çä¸º1152 x 640</span></li>
</ol></li>
<li>æåå°å¸§åè¡¨ï¼ä¹å°±æ¯æ½åç30å¸§ï¼åäºåè¾¨çè°æ´ï¼åäºåºäºpatch_sizeè°æ´åçå¸§åºåï¼è½¬ä¸ºPyTorchå¼ éå¹¶è¿åã</li>
</ol>
<p>æåå¯ä»¥çå°video_inputsçç»æä¸ºååç´ çlistï¼è¿åä¸ªåç´ éä¸º1ä¸ªtupleï¼åå«2é¨åï¼</p>
<ol>
<li>ä¸ä¸ªshapeä¸º([30, 3, 640, 1152]) çå¼ éï¼åå«ä»£è¡¨å¸§idãRGBééãç¼©æ¾åçåè¾¨ç640 x 1152</li>
<li>å¦ä¸ä¸ªä¸ºè§é¢çmetadataä¿¡æ¯ï¼åæ¬fpsåframe_indicesï¼éæ ·åçå¸§åºåï¼ï¼ä»¥åtotal_num_frames</li>
</ol>
<p>æä»¥å¨åç»­ä»£ç ä¸­è¿æä¸æ­¥æ¯ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">if video_inputs is not None:
    video_inputs, video_metadatas = zip(*video_inputs)
video_inputs, video_metadatas = list(video_inputs), list(video_metadatas)
</pre>
</div>
<p>ãã</p>
<p>è¿æ¯å°video_inputsåvideo_metadatasæå¼ï¼å¨video_inputsä¸­åªä¿çå¸§çä¿¡æ¯ã</p>
<p>&nbsp;</p>
<h3>1.3. æ¨¡åè¾å¥ä¿¡æ¯åå¤</h3>
<p>å¨è§é¢å¸§ä¿¡æ¯åå¤å¥½ä¹åï¼è¿ææåä¸æ­¥ï¼å°è§é¢å¸§ä¿¡æ¯æ·»å å°textæ¨¡æ¿ä¸­ï¼ä¹å°±æ¯è¿æ®µä»£ç ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">inputs = processor(text=[text], images=image_inputs, videos=video_inputs, video_metadata=video_metadatas, **video_kwargs, do_resize=False, return_tensors="pt")
</pre>
</div>
<p>ã</p>
<p>æ­¤æ¶è¾å¥æ°æ®ä¸ºï¼</p>
<p>text = '&lt;|im_start|&gt;user\n&lt;|vision_start|&gt;&lt;|video_pad|&gt;&lt;|vision_end|&gt;è¯·æè¿°è¿ä¸ªè§é¢çåå®¹&lt;|im_end|&gt;\n&lt;|im_start|&gt;assistant\n'</p>
<p>video_inputs = [torch.Tensor([30, 3, 640, 1152])]</p>
<p>video_metadatas = [{"fps":30, "frame_indices":[0, 31, 62, â¦, 899], "total_num_frames": 900}</p>
<p>ç»è¿processorå¤çåçinputsç»æä¸ºï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">{'input_ids': tensor([[151644,    872,    198,  ..., 151644,  77091,    198]]), 'attention_mask': tensor([[1, 1, 1,  ..., 1, 1, 1]]), 'pixel_values_videos': tensor([[ 0.2000,  0.2000,  0.2000,  ..., -0.1529, -0.2549, -0.3176],
        [ 0.1843,  0.1843,  0.1843,  ...,  0.1843,  0.1137,  0.0824],
        [ 0.1451,  0.1451,  0.1451,  ..., -0.1373, -0.0667, -0.0275],
        ...,
        [ 0.4431,  0.4588,  0.4745,  ...,  0.2078,  0.2000,  0.2000],
        [ 0.4510,  0.4588,  0.4588,  ...,  0.2157,  0.2314,  0.2471],
        [ 0.5451,  0.5529,  0.5686,  ...,  0.3725,  0.3882,  0.3882]]), 'video_grid_thw': tensor([[15, 40, 72]])}
</pre>
</div>
<p>ã</p>
<p>é¦åçvideo_grid_thwï¼è¿ä¸ªè¡¨ç¤ºçpatchå¸å±ï¼åé¢æå°ç¼©æ¾åçåè¾¨çä¸º640 x 1152ï¼å¯¹åºå°patch=16åçpatchå¸å±åä¸º40 x 72ãä½è¿éæä¸ªé®é¢ï¼<span style="color: rgba(255, 0, 0, 1)">ä¸ºä»ä¹éæ ·æ¶å¸§æ°ä¸º30ï¼è¿éåæäº15ï¼</span></p>
<p>éè¿éè¯»Qwen3VLVideoProcessorçæºç [1]å¯ä»¥äºè§£å°æä¸ä¸ªéè¦åæ°æ¯temporal_patch_size=2ï¼ä¹å¯ä»¥å¨æ¨¡åçconfigæä»¶éçå°è¿ä¸ªåæ°ï¼ã<span style="color: rgba(255, 0, 0, 1)">è¿ä¸ªåæ°ä»£è¡¨çå«ä¹æ¯ï¼æ¨¡åä¸æ¬¡çå¤å°å¸§ä½ä¸ºä¸ä¸ªtokenãä¹å¯ä»¥çè§£ä¸ºæ¯ä¸ªvideo tokenè¦ççè¿ç»­å¸§æ°ãå¨è¿éæå®ä¸º2ï¼ä¹å°±è¡¨ç¤ºæ¯2å¸§åå¹¶æ1ä¸ªæ¶é´patchï¼è¿æ ·å°±å¤©ç¶åå«äºå¸§åºåä¸­è¿å¨/ååçä¿¡æ¯</span>ãè¿ä¸ªåæ°è¶å°ï¼è½ææå°çå¨ä½ååå°±è¶ç»ï¼å¯¹åºæ¶èçtokenä¹è¶å¤ãæä»¥è¿å°±è§£éäºä¸ºä»ä¹è¾å¥æ¨¡åçpatchå¸å±ä¸º15 * 40 * 72ã</p>
<p>åçpixel_value_videosçshapeä¸ºtorch.Size([43200, 1536])ï¼</p>
<ol>
<li>ç¬¬ä¸ç»´ç43200å¾å¥½çè§£ï¼å°±æ¯è¿ä¸ªè§é¢çpatchæ°éï¼ä¹å°±æ¯15 * 40 * 72 = 43,200ã</li>
<li>ç°å¨æä»¬å·²ç¥è¾å¥æ¨¡åç1ä¸ªvision tokenï¼ä¹å°±æ¯patch tokenï¼çç»æä¸ºï¼2å¸§ * patchåç´ ãæ¯ä¸ªpatchå¯¹åºçåç´ ä¸ºï¼2 * 3(RGBéé) * (16*16) =1536ï¼è¿å°±å¯¹åºå°äºpixel_value_videosçç¬¬äºç»´ï¼ä¹å°±æ¯æ¯ä¸ªpatchçç»´åº¦ã</li>
</ol>
<p>æååçinput_idsç»æï¼å¶shapeä¸º([1, 10938])ï¼å¯¹å¶ådecodeçç»æä¸ºï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">&lt;|im_start|&gt;user
&lt;0.3 seconds&gt;&lt;|vision_start|&gt;
<span style="color: rgba(255, 0, 0, 1)">&lt;|video_pad|&gt;*10800 ï¼è¡¨ç¤ºåºç°10800æ¬¡&lt;|video_pad|&gt;ï¼
</span>&lt;|vision_end|&gt;è¯·æè¿°è¿ä¸ªè§é¢çåå®¹&lt;|im_end|&gt;
&lt;|im_start|&gt;assistant
</pre>
</div>
<p>ãã</p>
<p>è¿éæä»¬å·²ç¥&lt;|video_pad|&gt;æ¯ä½ä¸ºåç»­video patch tokençå ä½ç¬¦ãé£ä¸ºä»ä¹ä¸é¢è®¡ç®å¾å°ç<span style="color: rgba(255, 0, 0, 1)">åå§vision patchçæ°éä¸º43200ï¼ä½å°çæ­£è½¬ä¸ºtoken idsæ¶å°±åªæ10800ä¸ªvision tokenäºï¼è¿æ¶åå°å¦ä¸ä¸ªåæ°ä¸ºspatial_merge_sizeï¼Qwen3-VL-4B-Instructéé»è®¤ä¸º2ï¼ã</span>è¿ä¸ªåæ°æ¯ä¸ä¸ªç©ºé´ä¸éæ ·/ç¹å¾åå¹¶åæ°ï¼ç¨æ¥æ§å¶âæç¸é»çå° patch èåæä¸ä¸ªå¤§ tokenâçç²åº¦ï¼ä»èç´æ¥å³å®è§è§åºåçé¿åº¦ä¸åç»­è®¡ç®éãæ´ç´æ¥ç¹è¯´ï¼å°±æ¯ä¸ºäºåå°åç»­attentionçè®¡ç®éä»èèçº¦è®¡ç®èµæºãå¦æåå¼ä¸º2ï¼åè¡¨ç¤ºæ2 x 2 ä¸ªåå§patchç¹å¾åæ¼æ¥æ1ä¸ªtokenï¼ä»èåå°4åçåºåé¿åº¦ï¼æä»¥mergeåä¸º10800ä¸ªtoken idï¼ä¹å°±æ¯43200 / 4 = 10800ã</p>
<p>æåï¼å¨è¿è¡model.generate()æ¶ï¼å°&lt;|video_pad|&gt;æ¿æ¢ä¸ºmergeåçpatchç¹å¾ï¼ä¾¿æé äºè§é¢æ¨çæ¨¡åçè¾å¥ï¼å¼å§æ§è¡prefill+decodeæ¨çæµç¨ã</p>
<p>&nbsp;</p>
<h2>2. æ¨¡åå¨åå¾®è°</h2>
<p>å¨çè§£äºè§é¢æ¨ççæµç¨åï¼ç»§ç»­è¿è¡æ¨¡åå¾®è°ãé¦åéè¦åå¤ä¸äºè§é¢ç´ æå¹¶è¿è¡ææ ã</p>
<h3>2.1. è§é¢è®­ç»æ°æ®åå¤</h3>
<p>è¿éæä»¬ä»å¼æºæ°æ®éMicroLens[2]ä¸­éåäºé¨åçèè£èè§é¢çæ°æ®ï¼å¹¶å¯¹å¶åäºååï¼å°è§é¢ååä¸º15sä»¥ä¸ççæ®µï¼ç¶åäººå·¥è¡¥åæè¿°ã</p>
<p>å¯¹äºä¸ä¸ªç¤ºä¾çæ®µï¼</p>
<p>&nbsp;<img src="https://img2024.cnblogs.com/blog/1287132/202601/1287132-20260114123635037-1219532860.png" alt="image" width="402" height="226" loading="lazy"></p>
<p>&nbsp;<img src="https://img2024.cnblogs.com/blog/1287132/202601/1287132-20260114123522486-441416678.png" alt="image" width="402" height="226" loading="lazy"></p>
<p>è®©Qwen3-VL-4B-Instructè¿è¡æè¿°ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">è¾å¥ï¼æè¿°è¿ä¸ªè§é¢å¹¶è¿è¡ææ ,ä½¿ç¨jsonè¾åºæ ç­¾

è¾åºä¸ºï¼
{
    "video_description": "è§é¢å±ç¤ºäºä¸æ¬¾å¤äººå¨çº¿ææç«ææ¸¸æçå®æ¶å¯¹æåºæ¯ãç»é¢ä¸­ï¼ç©å®¶ææ§è§è²å¨æ¸¸æå°å¾ä¸è¿è¡æ¿çææï¼ä½¿ç¨æè½åè£å¤è¿è¡æ»å»åé²å¾¡ãå±å¹å·¦ä¸è§æ¾ç¤ºäºä¸ä½ç©å®¶æ­£å¨ç´æ­ï¼ä»ä¸æ³¨å°æä½çæ¸¸æï¼èæ¯æ¯èè²æ¡çº¹çªå¸ãæ¸¸æçé¢æ¾ç¤ºäºè§è²çè¡éãæè½å·å´ãè£å¤ç¶æä»¥åå°å°å¾ç­ä¿¡æ¯ãææè¿ç¨ä¸­ï¼è§è²ä¸æ­éæ¾æè½ï¼é æä¼¤å®³å¹¶è·å¾éå¸ãå±å¹å³ä¸è§ææä½æé®ï¼åæ¬æè½éæ¾åç§»å¨æ§å¶ãç»é¢ä¸­è¿åºç°äºä¸­ææå­æç¤ºï¼å¦âèå¤«å­è·æä»¬å¼å¢å§âåâä»å­ä»ä¹è·ææâï¼æ¾ç¤ºäºç©å®¶å¨æ¸¸æä¸­çå¯¹è¯åç­ç¥ãæ´ä½æ°å´ç´§å¼ åºæ¿ï¼åæ»¡ç«ææ§ã",
    "tags": [
        "æ¸¸æç´æ­",
        "å¤äººå¨çº¿ææç«æ",
        "è§è²æ®æ¼",
        "æè½ææ",
        "æ¸¸æçé¢",
        "ç´æ­ä¸»æ­",
        "ç«æå¯¹æ",
        "æ¸¸æç­ç¥",
        "ä¸­ææå­",
        "å®æ¶ææ"
    ]
}
</pre>
</div>
<p>ãã</p>
<p>ä¸é¢æä»¬å¯¹è¿ç±»æ¸¸æè§é¢ä½¿ç¨ä»¥ä¸æ¨¡å¼è¿è¡ææ ï¼ä¾å¦ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">{
	"video": "wzry/4/1.mp4",
	"conversations": [{
			"from": "human",
			"value": "&lt;video&gt;\næè¿°è¿ä¸ªè§é¢å¹¶è¿è¡ææ ,ä½¿ç¨jsonè¾åºæ ç­¾"
		},
		{
			"from": "gpt",
			"value": {
				"video_description": "è§é¢å±ç¤ºççèè£èæ¸¸æççé¢ãå¨ç»é¢ä¸­ï¼é¦åå±ç¤ºçæ¯è§è²ä¿¡æ¯çé¢åä»ä»¬çæç»©ï¼è§è²åæ¬å¯ãåæ­ãå¬´æ¿ãç¶ååå±ç¤ºäºè§è²æ¾ãçä»æ°åä¸ç¥ç«èãæ¥ä¸æ¥æ¯ç·ä¸»æ­æä½å¯çè®°å½ï¼ç»é¢å·¦ä¸è§çå°æ¡æ¯ç·ä¸»æ­çè§é¢ãæ´ä½ç»é¢ä¸­å±ç¤ºäºå¯åææ¹äº¤æçåºæ¯ï¼å¶ä¸­å¯åå¨äºåèº«æè½åä¸ä¸ªææ¹åä½è¿è¡äº¤æãå¨äº¤æè¿ç¨ä¸­å¯ç»ç»äºçä»æ°ã",
				"tags": [
					"æ¸¸æç´æ­",
					"çèè£è",
					"å¯",
					"çä»æ°",
					"æ¾",
					"ææç»é¢"
				]
			}

		}
	]
</pre>
</div>
<p>ãã</p>
<p>åç»­æç§è¿ä¸ªæ¨¡å¼åå¤å¯¹åºçè®­ç»æ°æ®ã</p>
<h3>2.2. æ¨¡åè®­ç»</h3>
<p>é¦åæä»¬ä½¿ç¨å°æ¨¡åè¿è¡æµè¯å¹¶éªè¯ææï¼ä½¿ç¨Qwen3-VL-4B-Instructæ¨¡åï¼åèå®æ¹æä¾çè®­ç»èæ¬è¿è¡è®­ç»[3]ã</p>
<p>è®­ç»æ¨¡åçå½ä»¤ä¸ºï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">torchrun \
  # ========== åå¸å¼å¯å¨ ==========
  --nproc_per_node=8 \
  --master_addr=127.0.0.1 \
  --master_port=29500 \

  # ========== è®­ç»å¥å£ ==========
  Qwen3-VL/qwen-vl-finetune/qwenvl/train/train_qwen.py \

  # ========== DeepSpeed ==========
  --deepspeed=Qwen3-VL/qwen-vl-finetune/scripts/zero3.json \

  # ========== æ¨¡åä¸æ°æ® ==========
  --model_name_or_path=Qwen/Qwen3-VL-4B-Instruct \
  --dataset_use=wzry_video%100 \

  # ========== è¾åºä¸å®éªæ è¯ ==========
  --output_dir=./output/wzry_video_finetune \
  --run_name=wzry_video_qwen3vl_4b \

  # ========== å¤æ¨¡æå¯è®­ç»æ¨¡å ==========
  --tune_mm_vision=True \
  --tune_mm_mlp=True \
  --tune_mm_llm=True \

  # ========== ç²¾åº¦ä¸è®­ç»è½®æ° ==========
  --bf16 \
  --num_train_epochs=20 \

  # ========== Batch &amp; ç´¯ç§¯ ==========
  --per_device_train_batch_size=2 \
  --per_device_eval_batch_size=4 \
  --gradient_accumulation_steps=4 \

  # ========== å­¦ä¹ çï¼åæ¨¡åï¼ ==========
  --learning_rate=2e-05 \
  --mm_projector_lr=4e-05 \
  --vision_tower_lr=2e-06 \

  # ========== ä¼åå¨ä¸è°åº¦ ==========
  --weight_decay=0.01 \
  --warmup_ratio=0.03 \
  --lr_scheduler_type=cosine \
  --max_grad_norm=1.0 \

  # ========== ä¸ä¸æä¸æ°æ®ç»ç» ==========
  --model_max_length=8192 \
  --data_flatten=True \
  --data_packing=False \

  # ========== è§é¢éæ ·åæ° ==========
  --video_fps=4 \
  --video_max_frames=32 \
  --video_min_frames=16 \

  # ========== è§é¢åè¾¨ç / token æ§å¶ ==========
  --video_max_pixels=1003520 \
  --video_min_pixels=401408 \
  --max_pixels=602112 \
  --min_pixels=100352 \

  # ========== è¯ä¼°ä¸ä¿å­ ==========
  --eval_strategy=no \
  --save_strategy=epoch \
  --save_steps=2 \
  --save_total_limit=3 \

  # ========== æ¥å¿ ==========
  --logging_steps=2 \
  --report_to=tensorboard \
  --gradient_checkpointing=True \
  --dataloader_num_workers=4
</pre>
</div>
<p>&nbsp;</p>
<p>å¶ä¸­æä»¬ä»ç»å ä¸ªå¨è§é¢çè§£æ¨¡åéçåæ°ï¼<br>1.	å¤æ¨¡æåæ°æ¯å¦å¯è®­ç»ï¼åæ¬Vision Encoderï¼å¤æ¨¡ææå½±å±åè¯­è¨æ¨¡åï¼<br>ããa)	--tune_mm_vision=True --tune_mm_mlp=True --tune_mm_llm=True<br>ããb)	ä¹å°±æ¯è¯´ï¼è¿æ¯ä¸ªå¨åå¾®è°ï¼éåäºGPUèµæºæ¯è¾åè¶³çæåµï¼è¾¾å°æ´å¥½çææãå¦åå¯ä»¥å»ç»é¨ä»½åæ°<br>2.	è§é¢åæ°ï¼<br>ããa)	--video_fps=4 --video_max_frames=32 --video_min_frames=16<br>ããb)	--video_max_pixels=1003520 --video_min_pixels=401408 --max_pixels=602112 --min_pixels=100352<br>ããc)	è¿å ä¸ªåæ°æ¯æ§å¶å¸§éæ ·ä¸åå¸§åè¾¨çï¼é²æ­¢GPU OOMåtokenå¸§æ°å¤ªå¤çæåµï¼å°tokenæ°resizeå°åççç©ºé´èå´åãåæ¨çæ¶æå®çåæ°ç±»ä¼¼</p>
<p>æä»¥ï¼å¨gpuèµæºæéæ¶ï¼é¤äºå¸¸è§çåå°batch sizeãmodel_max_lengthãåæ¢zero stageãä½¿ç¨loraç­ï¼è¿å¯ä»¥è°æ´ä¸è¿°çä¾å¦å»ç»Vision Encoderå±ãæ§å¶è§é¢åæ°ç­æ¥è¿è¡è¿ä¸æ­¥çåå°gpuçéæ±ã</p>
<p>&nbsp;</p>
<p>ä»è®­ç»è¿ç¨æ¥çï¼æ¶æè¯å¥½ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1287132/202601/1287132-20260114112650206-1402113901.png" width="833" height="290"></p>
<p>&nbsp;</p>
<p>ä¸é¢æµè¯å¨åå¾®è°åä¸åå§æ¨¡åçå¯¹æ¯ææï¼ä½¿ç¨å¦ä¸ä¸ªç¤ºä¾è§é¢ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1287132/202601/1287132-20260114123720076-1055836250.png" alt="image" width="438" height="247" loading="lazy">&nbsp; &nbsp;</p>
<p><img src="https://img2024.cnblogs.com/blog/1287132/202601/1287132-20260114123805605-2070787796.png" alt="image" width="437" height="246" loading="lazy"></p>
<p>&nbsp;</p>
<p>å¯ä»¥çå°åå§æ¨¡åå¯¹è§é¢åäºæ´ä½ççè§£ï¼å¯ä»¥æ­£å¸¸çè§£ä¸ºæ¸¸æç»é¢ï¼ä»¥åè§é¢çå¤§è´åå®¹ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">python test_inference.py --model Qwen/Qwen3-VL-4B-Instruct --video ../data/wzry/57/2.mp4 --prompt "æè¿°è¿ä¸ªè§é¢å¹¶è¿è¡ææ ,ä½¿ç¨jsonè¾åºæ ç­¾ï¼ä½¿ç¨ä¸­æã"

{
  "video_description": "è¿æ¯ä¸æ®µãçèè£èãçæ¸¸æå½åï¼å±ç¤ºäºç©å®¶å¨æ¸¸æä¸­çææåæä½è¿ç¨ãç»é¢ä¸­å¯ä»¥çå°å¤ä¸ªè±éè§è²å¨æ²³éåºåè¿è¡æ¿çå¯¹æï¼å¶ä¸­åæ¬ä½¿ç¨æè½æ»å»ææ¹åä½ãèº²é¿ä¼¤å®³ä»¥åå©ç¨å°å½¢ä¼å¿è¿è¡ææ¯éåãå±å¹å·¦ä¸è§æ¾ç¤ºäºå°å°å¾åéä¼ç¶æï¼å³ä¸è§åææè½æé®åä¼¤å®³æ°å¼æç¤ºãæ´ä¸ªåºæ¯åæ»¡å¨æï¼å±ç°äºå¿«èå¥çMOBAç«æé£æ ¼ã",
  "tags": [
    "çèè£è",
    "MOBAæ¸¸æ",
    "è±éå¯¹æ",
    "æè½éæ¾",
    "å¢éåä½",
    "æ¸¸æç´æ­",
    "ææåºé¢",
    "æ¸¸æç­ç¥"
  ]
}
</pre>
</div>
<p>ãã</p>
<p>ç¶ååçå¾®è°åçæ¨¡åææï¼å¯ä»¥çå°è§é¢å¯¹åå®¹çè§£çæ´ä¸ºç²¾åï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">python test_inference.py --model ~/multi-model-train/output/wzry_video_finetune/ --video ../data/wzry/57/2.mp4 --prompt "æè¿°è¿ä¸ªè§é¢å¹¶è¿è¡ææ ,ä½¿ç¨jsonè¾åºæ ç­¾"

{
  "video_description": "è¿æ¯çèè£èæ¸¸æçé¢ï¼åå¼å§æ¯è§è²âç¾éå®çº¦âçæ¸¸ç©è®°å½ï¼å·¦ä¸è§æ¾ç¤ºçæ¯ææ¹ä¿¡æ¯åæçæ¹ä¿¡æ¯ãå¨ç»é¢ä¸­ï¼âç¾éå®çº¦âå¼æªå»è´¥äºè§è²âèçâãç¶åâç¾éå®çº¦âåå°äºææ¹çæ»å»ï¼å¨ä½¿ç¨æè½ä½ç§»äºä¸æ®µè·ç¦»ååå¨æè½ä¸å¯¹æ¹è§è²âæ¾âäº¤æï¼å¹¶å°å¯¹æ¹æææ®è¡ã",
  "tags": [
    "çèè£è",
    "ç¾éå®çº¦",
    "æ¾",
    "ææç»é¢"
  ]
}</pre>
</div>
<p>ãã</p>
<h2>3. æ»ç»</h2>
<p>æ¬æå´ç» qwen3-vl-4b-instructï¼å¯¹å¤æ¨¡æè§é¢çè§£ä¸­çæ¨çä¸å¨åæ°å¾®è°è¿ç¨è¿è¡äºå®æ´å®è·µï¼ä»è§é¢è¾å¥æå»ºãæ¨çæ§è¡ï¼å°åºäºçå®æ¸¸æè§é¢çæ°æ®åå¤ä¸è®­ç»éç½®ï¼ç³»ç»æ¢³çäºå¤æ¨¡ææ¨¡åå¨è§é¢åºæ¯ä¸çå·¥ç¨ç»èãåç»­æä»¬å°è¿ä¸æ­¥ä»ç»å¦ä½å¯¹è§é¢è¿ç±»éç»æåç¹å¾è¿è¡ç»ä¸ç®¡çï¼å¹¶éæ­¥å®åæ¨¡åçæç»­è®­ç» pipelineï¼åæ¬ç¹å¾å¤çãçæ¬åä¸ç®¡çæºå¶ï¼ä»¥åæ¨¡åçæ¬çç®¡çä¸é¨ç½²ï¼ä»¥æ¯ææ´ç¨³å®ãå¯æ©å±çå¤æ¨¡æåºç¨è½å°ã</p>
<p>&nbsp;</p>
<h2>References</h2>
<p>1. video_processing_qwen3_vl.pyï¼<a href="https://github.com/huggingface/transformers/blob/main/src/transformers/models/qwen3_vl/video_processing_qwen3_vl.py" rel="noopener nofollow">https://github.com/huggingface/transformers/blob/main/src/transformers/models/qwen3_vl/video_processing_qwen3_vl.py</a></p>
<p>2. MicroLens Githubï¼<a href="https://github.com/westlake-repl/MicroLens" rel="noopener nofollow">https://github.com/westlake-repl/MicroLens</a></p>
<p>3. QwenVL Training Framework: <a href="https://github.com/QwenLM/Qwen3-VL/tree/main/qwen-vl-finetune" rel="noopener nofollow">https://github.com/QwenLM/Qwen3-VL/tree/main/qwen-vl-finetune</a></p>
<p>&nbsp;</p>
</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.006944444444444444" data-date-updated="2026-01-14 21:04">2026-01-14 20:54</span>&nbsp;
<a href="https://www.cnblogs.com/zackstang">ZacksTang</a>&nbsp;
éè¯»(<span id="post_view_count">28</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19481125);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19481125', targetLink: 'https://www.cnblogs.com/zackstang/p/19481125', title: 'è§é¢çè§£æ¨¡åæ¨çä¸å¾®è°' })">ä¸¾æ¥</a>
</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸æ¬¡åç½å¼åç¯å¢è®¿é®æ¹å¼çæ¹è¿å®è·µï¼ä½¿ç¨ FRP æ¿ä»£è¿ç¨æ¡é¢ ]]></title>
    <link>https://www.cnblogs.com/YpEng-Codeme/p/19484150</link>
    <guid>fcc0e0963f2674fbd57eed1536f342c3</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/YpEng-Codeme/p/19484150" title="åå¸äº 2026-01-14 20:15">
    <span role="heading" aria-level="2">ä¸æ¬¡åç½å¼åç¯å¢è®¿é®æ¹å¼çæ¹è¿å®è·µï¼ä½¿ç¨ FRP æ¿ä»£è¿ç¨æ¡é¢</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ä¸æ¬¡åç½å¼åç¯å¢è®¿é®æ¹å¼çæ¹è¿å®è·µä½¿ç¨-frp-æ¿ä»£è¿ç¨æ¡é¢">ä¸æ¬¡åç½å¼åç¯å¢è®¿é®æ¹å¼çæ¹è¿å®è·µï¼ä½¿ç¨ FRP æ¿ä»£è¿ç¨æ¡é¢</h1>
<h2 id="ä¸èæ¯">ä¸ãèæ¯</h2>
<p>å¨å¬å¸é¡¹ç®ä¸­ï¼ç»å¸¸ä¼éå°è¿æ ·ä¸ç§å¼åç¯å¢éå¶ï¼</p>
<blockquote>
<p><strong>é¡¹ç®åç½æå¡å¨ç¦æ­¢ç´æ¥è®¿é®å¤ç½</strong></p>
</blockquote>
<p>ä¸ºäºå¨è¯¥ç¯å¢ä¸è¿è¡å¼ååè°è¯ï¼å¸¸è§çåæ³æ¯ï¼</p>
<ul>
<li>åå¤ä¸å° <strong>å¯ä»¥èç½çå°å¼æº</strong></li>
<li>éè¿ <strong>åæ¥èµ / ToDesk / Windows è¿ç¨æ¡é¢</strong> ç­æ¹å¼è¿ç¨æ§å¶è¿å°æºå¨</li>
<li>åç±è¯¥æºå¨è®¿é®åç½æå¡å¨è¿è¡å¼åãè°è¯ç­æä½</li>
</ul>
<hr>
<h2 id="äºé®é¢æè¿°">äºãé®é¢æè¿°</h2>
<h3 id="21-ç°ææ¹æ¡ççç¹">2.1 ç°ææ¹æ¡ççç¹</h3>
<p>è¿ç¨æ¡é¢ä¸»è¦æä¸é¢å ä¸ªé®é¢ï¼</p>
<ol>
<li>
<p><strong>åç½ç»è´¨éå½±åè¾å¤§</strong><br>
ç½ç»å¦ææ³¢å¨ï¼ç»é¢å°±ä¼å¡é¡¿ãå»¶è¿æ­è¿ï¼å½±åå¼åä½éªã</p>
</li>
<li>
<p><strong>å¼åç¯å¢éå¤æ­å»º</strong><br>
éè¦å¨âä¸­è½¬çèç½æºå¨âä¸å®è£ IDEãSDKãç¼è¯å·¥å·ä»¥ååç§ä¾èµï¼ç»´æ¤ææ¬è¾é«ã</p>
</li>
<li>
<p><strong>å¾å½¢åå¹¶éå¿é</strong><br>
å®éå¼åè¿ç¨ä¸­ï¼å¤§å¤æ°æä½ï¼ä»£ç ç¼è¾ãæå¡è¿è¡ãæ¥å¿æ¥çç­ï¼å®å¨å¯ä»¥éè¿ SSH å®æï¼å¹¶ä¸ä¾èµ GUIï¼çè³å½ä½ éè¦è°è¯åç«¯ä»£ç æ¶ä¹å¯ä»¥éè¿å°è¯¥åç«¯ç«¯å£ä¹æ å°åºæ¥çæ¹å¼å®ç°ã</p>
</li>
</ol>
<hr>
<h2 id="ä¸æè·¯åæ">ä¸ãæè·¯åæ</h2>
<p>ä»ç»æ³æ³ï¼</p>
<blockquote>
<p><strong>æä»¬ä¸»è¦ä¸ºçä¸æ¯âè¿ç¨æ§å¶ä¸å°çµèâï¼èæ¯âè®¿é®åç½æå¡å¨âã</strong></p>
</blockquote>
<p>ç±æ­¤ä¾¿å¯å¾åºä¸ä¸ªæ°è·¯çº¿ï¼</p>
<ul>
<li>èç½å°å¼æºå¯ä»¥è®¿é®åç½æå¡å¨</li>
<li>èç½å°å¼æºå¯ä»¥è®¿é®å¤ç½</li>
<li>é£ä¹å®å¤©ç¶å¯ä»¥ä½ä¸ºä¸ä¸ª <strong>ç½ç»è½¬åèç¹</strong></li>
</ul>
<p>ç±æ­¤å¼å¥ <strong>FRPï¼Fast Reverse Proxyï¼</strong>ï¼éè¿ç«¯å£æ å°çæ¹å¼ï¼å°åç½æå¡å¨çæå¡æ´é²å°å¤ç½ã</p>
<hr>
<h2 id="åæ¹æ¡è®¾è®¡">åãæ¹æ¡è®¾è®¡</h2>
<h3 id="41-ç½ç»ç»æç¤ºæ">4.1 ç½ç»ç»æç¤ºæ</h3>
<pre><code class="language-text">æ¬å°å¼åçµè
        |
        | SSH
        v
å¤ç½æå¡å¨ (frps)
        |
        | ç«¯å£è½¬å
        v
èç½å°å¼æº (frpc)
        |
        | åç½è®¿é®
        v
åç½æå¡å¨ (192.168.1.144:22)
</code></pre>
<hr>
<h3 id="42-ç«¯å£æ å°è¯´æ">4.2 ç«¯å£æ å°è¯´æ</h3>
<p>åè®¾ç¯å¢å¦ä¸ï¼</p>
<ul>
<li>åç½æå¡å¨ SSH å°åï¼<code>192.168.1.144:22</code></li>
<li>å¤ç½æå¡å¨å°åï¼<code>114.113.112.111</code></li>
<li>æ å°ç«¯å£ï¼<code>6666</code></li>
</ul>
<p>æç»å¯ä»¥éè¿ä»¥ä¸æ¹å¼è®¿é®åç½æå¡å¨ï¼</p>
<pre><code class="language-bash">ssh user@114.113.112.111 -p 6666
</code></pre>
<p>ç­ä»·äºï¼</p>
<pre><code class="language-bash">ssh user@192.168.1.144 -p 22
</code></pre>
<hr>
<h3 id="43-frp-å®¢æ·ç«¯éç½®ç¤ºä¾">4.3 FRP å®¢æ·ç«¯éç½®ç¤ºä¾</h3>
<p><code>frpc</code> è¿è¡å¨ <strong>èç½å°å¼æº</strong> ä¸ï¼éç½®ç¤ºä¾ï¼</p>
<pre><code class="language-ini">[ssh_proxy]
type = tcp
local_ip = 192.168.1.144
local_port = 22
remote_port = 6666
</code></pre>
<p><code>frps</code> é¨ç½²å¨å¤ç½æå¡å¨ä¸ï¼ç¨äºæ¥æ¶å¤é¨è¿æ¥å¹¶è½¬åæµéã</p>
<hr>
<h2 id="äºç»æä¸ææ">äºãç»æä¸ææ</h2>
<h3 id="51-æ¹æ¡å¯¹æ¯">5.1 æ¹æ¡å¯¹æ¯</h3>
<table>
<thead>
<tr>
<th>æ¹æ¡</th>
<th>ç¨³å®æ§</th>
<th>å»¶è¿</th>
<th>ç»´æ¤ææ¬</th>
</tr>
</thead>
<tbody>
<tr>
<td>è¿ç¨æ¡é¢</td>
<td>è¾å·®</td>
<td>é«</td>
<td>é«</td>
</tr>
<tr>
<td>SSH + FRP</td>
<td>ç¨³å®</td>
<td>ä½</td>
<td>ä½</td>
</tr>
</tbody>
</table>
<h3 id="52-å®éæ¶ç">5.2 å®éæ¶ç</h3>
<ul>
<li>ä¸åä¾èµå¾å½¢åè¿ç¨æ¡é¢</li>
<li>SSH è¿æ¥ç¨³å®æ§æ¾èæå</li>
<li>ä¸­è½¬æºå¨åªéä¿æå¼æºï¼æ éé¿æå ç¨</li>
<li>ä¸å½±åç°åºå·¥ä½äººåæ­£å¸¸ä½¿ç¨èç½å°å¼æº</li>
</ul>
<hr>
<h2 id="å­æ»ç»">å­ãæ»ç»</h2>
<ol>
<li>
<p><strong>é»è®¤æ¹æ¡ä¸ä¸å®æ¯æä¼æ¹æ¡</strong><br>
è¿ç¨æ¡é¢æ´éåè¿ç»´æä¸´æ¶æä½ï¼èéé«é¢å¼ååºæ¯ã</p>
</li>
<li>
<p><strong>FRP éå¸¸éååå¤ç½æ¡¥æ¥åºæ¯</strong><br>
æ¾èæåå¼åæçåä½éªã</p>
</li>
</ol>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 20:16">2026-01-14 20:15</span>&nbsp;
<a href="https://www.cnblogs.com/YpEng-Codeme">YounGp_oo</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19484150);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19484150', targetLink: 'https://www.cnblogs.com/YpEng-Codeme/p/19484150', title: 'ä¸æ¬¡åç½å¼åç¯å¢è®¿é®æ¹å¼çæ¹è¿å®è·µï¼ä½¿ç¨ FRP æ¿ä»£è¿ç¨æ¡é¢' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãå¼æºèªèãä¸ºAIç­è§é¢æé ä¸ä¸ªåéç®¡çå¹³å° ]]></title>
    <link>https://www.cnblogs.com/Z7TS/p/19483978</link>
    <guid>1e9a441a00cd9f283baa8ae46a5bfdbb</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Z7TS/p/19483978" title="åå¸äº 2026-01-14 19:31">
    <span role="heading" aria-level="2">ãå¼æºèªèãä¸ºAIç­è§é¢æé ä¸ä¸ªåéç®¡çå¹³å°</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>åæ§½ï¼åè¿ç¯æç« çæ¶é´ï¼æ¯æå¼åè¿ä¸ªé¡¹ç®è¿è¦ä¹ãð</p>
</blockquote>
<p>ä» 2022 å° 2026ï¼æç®æ¯ä¸è·¯è¿½ç AI è·çé£æ¹ç¨åºåã</p>
<p>IDE ä» VS Studio éæ CopilotãCursorãAugmentãWindsurfãAntigravityâ¦â¦æè¾ä¸åï¼æåååå½ <strong>VS Code + Copilot</strong>ã<br>
æ¨¡åä» GPT-3.5ï¼å° Claude CodeãGrokãDeepSeekãQwenï¼<br>
çå¾/è§é¢ä» MidjourneyãStable Diffusionï¼å° Veoãå³æ¢¦ãå¯çµãBanana Proâ¦â¦ä¸è·¯è¿½çä½éªæ´æ°ã</p>
<p>ï¼ä»ç¯çç½å«å°ç­è¡·ä»è´¹ï¼å è½äºå......ï¼</p>
<p>é¢å¯¹ AIï¼æçå¿æä¸ç´æ¯äºå³æéï¼</p>
<ul>
<li>
<p><strong>é¸ï¼</strong> ä»¥åä¸ºäºä¼åæ§è½ç¬å¤æ­»ç£æºç ãæ°æ®ç»æï¼ç°å¨ AI ç»åºçä»£ç æ¯æåçå¥½å¤äºï¼å¸®æå¹²æ´»çåæ¶è¿ç»ææç»ªä½éªï¼ æç§âåå¹´å¯çªä¸å¦ AI ä¸ç¬âçè½å·®æï¼çæ¯è¾é¸</p>
</li>
<li>
<p><strong>çï¼</strong> æçè´¼é«ï¼ä»¥åè¦ç£¨åå¤©çåè½ï¼ç°å¨å åéå°±è½è·èµ·æ¥ï¼ç½æ­ªæ­ª</p>
</li>
<li>
<p><strong>è¦ï¼</strong> AI å¼ºå½å¼ºï¼tokenä¹æ¯ççè´µï¼ä¸å¤ç¨æ ¹æ¬ä¸å¤ç¨ï¼å¬å¸è¿ä¸ç»æ¥éï¼å½è¦ï¼</p>
</li>
<li>
<p><strong>è¾£ï¼</strong> èå¥è¶æ¥è¶å¿«ï¼å¨æç¼©ç­ãå¹¶è¡é¡¹ç®åå¤ï¼èå­æ¯å¤©é½å¨é«è´è½½è¿è½¬</p>
</li>
<li>
<p><strong>å¸ï¼</strong> æ¶ä»£äº¤æ¿éï¼ä¸ä¸ªåå¹´èåµä¸æ³æéçç¼æ³ª</p>
</li>
</ul>
<p>å¨è¿ä¸åå¹´æå¤§çæåå°±æ¯ï¼<strong>æ¶é´å¥½å¿«ï¼æ¶ä»£ååæ´å¿«ï¼å¿«çæé½æ¥ä¸åæ¥æ±ååðµð«</strong>ã</p>
<hr>
<h1 id="1è¨å½æ­£ä¼ 24å°æ¶0-æåä»£ç æåäºä¸ªå¥">1ï¼è¨å½æ­£ä¼ ï¼24å°æ¶ï¼0 æåä»£ç ï¼æåäºä¸ªå¥ï¼</h1>
<p>æåäºä¸ä¸ªæ¬å°å®¢æ·ç«¯é¡¹ç®ï¼<strong>Storyboardï¼éå¤´ç®¡çæ¿</strong>ã ç®æ å¾ç®åï¼é¢åç­è§é¢åä½èä¸å¶ä½å¢éçæ¬å°åéå·¥ä½å°ï¼ä»çæ¬¾è§é¢å¯¼å¥ï¼æ¨¡ä»¿å¯¹è±¡ï¼ãæ½å¸§ãæ¨¡ååæ¢ãAI åæãå¾å/è§é¢çæï¼å°æ¹éä»»å¡ä¸æçåæï¼ä¸æ¡é¾è·¯å®æç®¡çä¸è¾åºã</p>
<p><strong>æå¨è¿ä¸ªé¡¹ç®å¼åä¸­ç¨å°çå·¥å·/æ¨¡åï¼</strong></p>
<ul>
<li>
<p>Chat æ¨¡åï¼ChatGPT / Gemini / DeepSeek</p>
</li>
<li>
<p>UI è®¾è®¡ï¼Figma / å¢¨å</p>
</li>
<li>
<p>ç¼ç¨æ¨¡åï¼Claude Code 4.5 Sonnet / GPT-5.2 Codex</p>
</li>
<li>
<p>ç¼ç¨å·¥å·ï¼VS Code Copilot / Codex</p>
</li>
</ul>
<p><strong>ææ¯æ ï¼</strong> Avalonia + SQLite + EF Core + .NET 8+ Semantic Kernel + Provider</p>
<blockquote>
<p>Talk is cheap. Show me the code.</p>
</blockquote>
<ul>
<li>
<p>é¡¹ç®å°åï¼<a href="https://github.com/BroderQi/Storyboard" target="_blank" rel="noopener nofollow">GitHub å¼æºä»åºï¼æ±ä¸ª Star â­ï¸ï¼</a></p>
</li>
<li>
<p>å¨çº¿ä½éªï¼<a href="http://47.100.163.84/" target="_blank" rel="noopener nofollow">Web Demoï¼ä» UI å±ç¤ºï¼</a></p>
</li>
<li>
<p>å®¢æ·ç«¯ä¸è½½ï¼<a href="https://github.com/BroderQi/Storyboard" target="_blank" rel="noopener nofollow">å®æ´åè½çæ¬</a></p>
</li>
</ul>
<p>ä¸»é¡µé¢ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114191819902-1798076118.png" alt="image" loading="lazy"></p>
<hr>
<h1 id="2é¡¹ç®èæ¯ai-ç­è§é¢ç´ æç®¡çæ··ä¹±">2ï¼é¡¹ç®èæ¯ï¼AI ç­è§é¢ç´ æç®¡çæ··ä¹±</h1>
<p>æè¿ AI æ¼«å§ãAI è§é¢ç«å¾ç¦»è°±ï¼æä¹å»ç©äºå å¤©ã</p>
<p>å®æä¸­éè§é®é¢ï¼åä¸æ¡âå·®ä¸å¤âçè§é¢ï¼å¾å¾è¦å åä¸ç¾ä¸ªéå¤´å¾çï¼æ¥ååæ¨¡åãåå¤æ½å¡ï¼</p>
<ul>
<li>
<p>ç´ ææ£è½åå¤</p>
</li>
<li>
<p>æç¤ºè¯åæçåç¦»ï¼åç»­æ æ³è¿½æº¯</p>
</li>
<li>
<p>å¤ä¸ªé¡¹ç®æ··å¨ä¸èµ·ï¼ç®¡çæ··ä¹±</p>
</li>
<li>
<p>ä¸æ¡è§é¢ä¸æ¥ï¼éå¤å³å¨å äºå¤§å¤´</p>
</li>
</ul>
<p>ç¶åç¨åºåçâèä¸çâå°±åä½äºï¼ <strong>è½ä¸è½æå®æµç¨åãæ¹éåãèªå¨åï¼</strong></p>
<p>äºæ¯ææ³åä¸ä¸ªâéå¤´ç®¡çè½¯ä»¶âï¼ æ <strong>çæ¬¾è§é¢å¯¼å¥ãæºè½æ½å¸§ãAIæ¨¡ååæ¢ãAI åæãæ¹éä»»å¡ãæçåæ</strong> å¨é¨éæå¨æ¬å°ã</p>
<hr>
<h1 id="3éæ±æ´çæ¢³çæä½æµç¨">3ï¼éæ±æ´çï¼æ¢³çæä½æµç¨</h1>
<p>ä¸å¼å§æçæ³æ³ï¼</p>
<pre><code class="language-Plain">å¯¹åèè§é¢åå¨å±çè§£ï¼çæå¤ä¸ªåéèæ¬
* ç¨æ·å¯ä»¥ç¼è¾åéèæ¬
* æ¯ä¸ªåééæ©ä¸åæ¨¡åï¼é¦å°¾å¸§âå¾çè§é¢âéé³âåæ
* æç»å½¢æä¸å¼ âåéè¡¨æ ¼âï¼éå¤´å·ãæ¶é¿ãé¦å°¾å¸§æç¤ºè¯ãéå¤´ç±»åãç»é¢ãå¨ä½ãåºæ¯ç­
</code></pre>
<p>ææè¿å¥æ³æ³ä¸¢ç» ChatGPTãGeminiãDeepSeek æ¥åæå°çº éãæåæ¶ææä¸æ¡æ´ç°å®çæµç¨ï¼</p>
<p><strong>æç»ç¡®å®çæ ¸å¿é¾è·¯ï¼</strong></p>
<pre><code class="language-Plain">è¾å¥ï¼ ç¨æ·ä¸ä¼ åèè§é¢
å¤çé¾ï¼
    è§é¢çè§£ä¸åéï¼ä¼ ç» CVï¼éå¤´åæ¢æ£æµï¼åå + å¤æ¨¡ææ¨¡åè¾å©æè¿°ï¼çæåæ­¥åéè¡¨
    åéç¼è¾ï¼è¡¨æ ¼åææå­æ®µé½å¯ç¼è¾ï¼éç¹æ¯âç»é¢æè¿°/å³é®å¸§æç¤ºè¯â
    çæé¾ï¼
        é¦å°¾å¸§ï¼æç¤ºè¯ â SD / MJ ç­çæå³é®å¸§
        å¨ä½ï¼å³é®å¸§ + å¨ä½æè¿° â å¾çè§é¢æ¨¡åçæçæ®µ
        é³é¢ï¼æ½ååé³é¢æ TTS çææ°é³é¢
è§é¢åæï¼çæ®µ + é³é¢å¯¹é½ â è¾åºæç
</code></pre>
<hr>
<h1 id="4æ ¸å¿åè½æ¸å">4ï¼æ ¸å¿åè½æ¸å</h1>
<p>åAIç»§ç»­æ²å®åè½ç»èï¼è®©AIæ´çåç»æå®æ´åè½ææ¡£ï¼çº¯äº«çï¼ã</p>
<p><strong>æå½ç®ååé¨ååè½ï¼</strong></p>
<ul>
<li>
<p>é¡¹ç®ç®¡çï¼åå»º/æå¼/æè¿é¡¹ç®/èµæºç®å½</p>
</li>
<li>
<p>è§é¢å¯¼å¥ï¼åä¿¡æ¯è§£æï¼æ¶é¿/åè¾¨ç/å¸§çï¼</p>
</li>
<li>
<p>æ½å¸§ï¼å®æ°æ½å¸§ / ç­æ¶æ½å¸§ / å³é®å¸§æ½å</p>
</li>
<li>
<p>åéè¡¨æ ¼ï¼éå¤´å·/æ¶é¿/ç»é¢/å¨ä½/åºæ¯/æç¤ºè¯/æ¨¡åéæ©/ç¶æ</p>
</li>
<li>
<p>æ¹éçæï¼ä»»å¡éå/å¹¶å/å¤±è´¥éè¯/æ¥å¿è¿½è¸ª</p>
</li>
<li>
<p>èµæºç®¡çï¼å¾ç/è§é¢/æç¤ºè¯çæ¬/å¯è¿½æº¯</p>
</li>
<li>
<p>åæåºçï¼çæ®µæ¼æ¥/é³é¢å¯¹é½/å¯¼åº</p>
</li>
</ul>
<p><strong>è¯¦ç»æä»¶å°å:<strong><strong><a href="https://github.com/BroderQi/Storyboard/blob/main/%E5%8A%9F%E8%83%BD%E6%96%87%E6%A1%A3.md" target="_blank" rel="noopener nofollow">åè½ææ¡£</a></strong></strong>ã</strong></p>
<hr>
<h1 id="5ææ¯éåä¸ºä»ä¹åå®¢æ·ç«¯">5ï¼ææ¯éåï¼ä¸ºä»ä¹åå®¢æ·ç«¯ï¼</h1>
<p>æä¸»è¦çº ç»äºåä¸ªé®é¢ï¼</p>
 td {white-space:nowrap;border:0.5pt solid #dee0e3;font-size:10pt;font-style:normal;font-weight:normal;vertical-align:middle;word-break:normal;word-wrap:normal;}
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>ææ³è¦çç®æ </td>
<td>æ¾å¼åå ï¼ä¸éçåï¼</td>
<td>æç»éæ©</td>
</tr>
<tr>
<td>Web vs å®¢æ·ç«¯</td>
<td>å¿«éåº UI + æ¬å°é«æ§è½å¤ç</td>
<td>Web éè¦åååç¦»ãé¨ç½²ç¹çï¼  <br>æé/å­å¨/ä»»å¡éåé¾è·¯å¤æï¼  <br>ä¸ ffmpeg/OpenCV æ¬å°åèµæºæ´éåå®¢æ·ç«¯</td>
<td>å®¢æ·ç«¯</td>
</tr>
<tr>
<td>Python vs .NET</td>
<td>å·¥ç¨åãå¯ç»´æ¤ãå¯æ©å±</td>
<td>Python å·¥å·é¾å¼ºä½å®¢æ·ç«¯å·¥ç¨åãç»æåç»´æ¤ææ¬æ´é«ï¼  <br>.NETæ¬å½+å¹´åº¦è¯­è¨ï¼å¿é¡»æCall</td>
<td>.NET 8</td>
</tr>
<tr>
<td>WPF vs Avalonia</td>
<td>è·¨å¹³å° + å­¦æ°ææ¯</td>
<td>WPF ä¸è·¨å¹³å°ï¼éå¶æªæ¥ç¨æ·èå´</td>
<td>Avalonia</td>
</tr>
<tr>
<td>WebView vs åçå¤å»</td>
<td>UI è¿ååº¦ + å¯ç»´æ¤æ§éªè¯</td>
<td>WebViewæ§è½/ä½éªä¸ç¡®å®</td>
<td>Avalonia åçå¤å»</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="6ui-è®¾è®¡åç¨-ai-åè½è·çè®¾è®¡ç¨¿">6ï¼UI è®¾è®¡ï¼åç¨ AI åâè½è·çè®¾è®¡ç¨¿â</h1>
<p>æ¿å°æ ¸å¿åè½åï¼æç´æ¥å¨ <strong>Figma / å¢¨å</strong> èµ° vibe codingï¼ èªç¶è¯­è¨æ²ééæ± â è¾åºå¯è¿è¡ç React é¡¹ç® â è¿å°±æ¯âè®¾è®¡ç¨¿ + äº¤äºç¨¿ + å¯è¿è¡ååâã</p>
<p>æå°±å°åè½è´´å°å¯¹è¯æ¡ï¼åå»ºWebçé¢ãå°±å¾å°ä¸¤ä¸ªå¯è¿è¡ååï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114192410233-2084263044.png" alt="308b428a54192c39f3a168ab6be766b9" loading="lazy"></p>
<p>å¢¨åæç»æåæªå¾ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114192546823-363850222.png" alt="cf082781dc06dbf30dd3bd2035dccce6" loading="lazy"></p>
<p>figmaï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114192607008-1830546258.png" alt="81eddd65cfffdb55090c6b74b092b95e" loading="lazy"></p>
<p>å¯¼åºæReacté¡¹ç®æä»¶<br>
<img src="https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114192624142-128403351.png" alt="87865bc53fe5dcec2441f8152e60e864" loading="lazy"></p>
<hr>
<h1 id="7ä»£ç å®ç°æç-0-æåä»£ç æµæ°´çº¿">7ï¼ä»£ç å®ç°ï¼æç 0 æåä»£ç æµæ°´çº¿</h1>
<p>æåºæ¬æè¿ä¸ªâAIåä½æµæ°´çº¿âè·ï¼</p>
<ol>
<li>æ°å»ºé¡¹ç®æä»¶å¤¹ï¼æåè½ææ¡£å¤å¶è¿æ¥ï¼æ React ååé¡¹ç®æè¿æ¥</li>
</ol>
<p><img src="https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114192743020-232735968.jpg" alt="b56a1adbf05d831de33c882281f1e395" loading="lazy"></p>
<ol start="2">
<li><strong>UI</strong> <strong>å¤å»é¶æ®µï¼</strong> ç¨ Avalonia å¯¹ç§ React éé¡µé¢ 1:1 è¿åï¼ä¸åè®¸èè¡¥ï¼ä¸åè®¸ç®åï¼ã è¿ä¸ªæ¨¡åç¨Claude Code 4.5 Sonnet è¿ååº¦æ¯è¾é«ã</li>
</ol>
<p><img src="https://img2024.cnblogs.com/blog/1148127/202601/1148127-20260114192801765-1251944392.jpg" alt="4044fbab3b46b72a769e966abc00d82a" loading="lazy"></p>
<ol start="3">
<li>
<p>è¿è¡å±é¨UIä¿®å¤ãæªå¾ãå¼å¥ç¸å³æä»¶ï¼AIä¿®å¤</p>
</li>
<li>
<p><strong>æ°æ®è´¯éé¶æ®µï¼</strong> å é¤ React é¡¹ç®ï¼åªä¿ç UIï¼è¦æ± SQLite + EF Coreï¼ååç«¯å­æ®µä¸è´ï¼æ°æ®æµè½¬è·é</p>
</li>
<li>
<p>åæ¢å¦ä¸ä¸ªæ¨¡ååå¨é code reviewï¼ç»æãè¾¹çãéè¯¯å¤çãå¯ç»´æ¤æ§ï¼</p>
</li>
<li>
<p>ä¿®å¤ â è¿è¡æå â æå â å¼æº</p>
</li>
</ol>
<hr>
<h1 id="8ä¸ªäººææ">8ï¼ä¸ªäººææï¼</h1>
<blockquote>
<p>AI æå¹³äºåä»£ç çé¨æ§ï¼ä½âæäºåæâçè½åä¾ç¶ç¨ç¼ºã</p>
</blockquote>
<p>å¯¹ç¨åºäººæ¥è®²ï¼ç¼ç¨è½åå¤±å»äºç¨ç¼ºæ§ï¼å¨AIé¢åéæ¸æ¶éã</p>
<p>ä½æ¯å¯¹æ³åäº§åçäººï¼é»éæ¶ä»£å°äºï¼</p>
<p>è¶AIå°æªå®å¨èªä¸»ãæ®éäººè¿ä¸è½è½»æ¾é©¾é©­ççªå£æï¼</p>
<p>æä»¬å¯ä»¥å°çµæï¼å¿«éåæè½è¿è¡ãè½éªè¯çååã</p>
<p>æä½è¿ä¸ªæ¶ä»£çº¢å©ï¼ä»ææ¯è½¬åäº§åãè½¬åå¸åºã</p>
<p>æå Storyboardï¼æ¯æ³è¯æï¼å½çµæéªç°ï¼æè½ä»¥æå¿«éåº¦è®©å®è½å°æçã</p>
<p>å¦æä½ ä¹æ³å¿«éè½å°äº§åã</p>
<p>å¦æä½ ä¹æ³åAIè§é¢/æ¼«å§ã</p>
<p>æ¬¢è¿æ¥æéæ±ãäº¤PRï¼ä¸èµ·æè¿ä¸ªå·¥å·æç£¨å¾æ´è¶æã</p>
<p>æ³æ³ä¸å¼é±ï¼ååºæ¥æå¼é±ã</p>
<p>ç°å¨ï¼æ­£æ¯å¨æçæå¥½æ¶åã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 19:32">2026-01-14 19:31</span>&nbsp;
<a href="https://www.cnblogs.com/Z7TS">Broder</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19483978);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19483978', targetLink: 'https://www.cnblogs.com/Z7TS/p/19483978', title: 'ãå¼æºèªèãä¸ºAIç­è§é¢æé ä¸ä¸ªåéç®¡çå¹³å°' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ é«å¾·å°å¾å®ç°å®æ¶è½¨è¿¹å±ç¤º ]]></title>
    <link>https://www.cnblogs.com/lijinhuaboke/p/19457121</link>
    <guid>8488ade48bc039f063c2243a2424896b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lijinhuaboke/p/19457121" title="åå¸äº 2026-01-14 14:35">
    <span role="heading" aria-level="2">é«å¾·å°å¾å®ç°å®æ¶è½¨è¿¹å±ç¤º</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="vue3--é«å¾·å°å¾amap-å®ç°å¹³æ»çå®æ¶è½¨è¿¹åæ¾ä¸è¿½è¸ª">Vue3 + é«å¾·å°å¾(AMap) å®ç°å¹³æ»çå®æ¶è½¨è¿¹åæ¾ä¸è¿½è¸ª</h1>
<h2 id="åè¨">åè¨</h2>
<p>å¨ç©èç½ãç©æµçæ§æå®é²è°åº¦ç³»ç»ä¸­ï¼å®æ¶å±ç¤ºè®¾å¤ï¼å¦æ äººæºãè½¦è¾ãæç¯ï¼çç§»å¨è½¨è¿¹æ¯ä¸ä¸ªå¸¸è§éæ±ãå¦æä»ä»æ¯ç®åçæ´æ°æ è®°ç¹ä½ç½®ï¼è§è§ä¸ä¼åºç°âè·³åâç°è±¡ï¼ä½éªå¾ä¸æµçã</p>
<p>æ¬æå°åäº«å¦ä½å¨ <strong>Vue 3</strong> é¡¹ç®ä¸­ï¼å©ç¨ <strong>é«å¾·å°å¾ (AMap) JS API</strong> å®ç°æ¯è¾ä¸æ»çå®æ¶è½¨ææã</p>
<h2 id="æ ¸å¿çç¹">æ ¸å¿çç¹</h2>
<ol>
<li><strong>å¹³æ»ç§»å¨</strong>ï¼ç¹ä½æ´æ°æ¶ï¼Marker éè¦ä»æ§ä½ç½®å¹³æ»è¿æ¸¡å°æ°ä½ç½®ï¼èä¸æ¯ç¬é´è·³è¿å»ã</li>
<li><strong>è½¨è¿¹è·é</strong>ï¼éç Marker çç§»å¨ï¼è½¨è¿¹çº¿ï¼Polylineï¼éè¦å®æ¶âçé¿âï¼ç´§è·å¨ Marker åé¢ã</li>
<li><strong>å¢éæ´æ°</strong>ï¼åç«¯éå¸¸è¿åå®æ´çåå²è·¯å¾æå½åç¶æï¼åç«¯éè¦è®¡ç®åºâæ°å¢çè·¯å¾æ®µâè¿è¡å¨ç»æ­æ¾ã</li>
</ol>
<h2 id="å®ç°é»è¾è§£æ">å®ç°é»è¾è§£æ</h2>
<p>æ ¸å¿æ¯å©ç¨é«å¾·å°å¾ API çè½¨è¿¹åæ¾åè½ãè½ç¶å®æ¹ææ¡£æä¾äºåºç¡çè½¨è¿¹åæ¾ç¤ºä¾ï¼åèï¼<a href="https://lbs.amap.com/demo/javascript-api-v2/example/marker/replaying-historical-running-data" target="_blank" rel="noopener nofollow">è½¨è¿¹åæ¾ç¤ºä¾</a>ï¼ï¼ä½å®æ¹ç¤ºä¾éå¸¸æ¯ä¸æ¬¡æ§å è½½å®æ´è·¯å¾ï¼ä¾å¦ï¼åè·åå®æ´ç»çº¬åº¦æ°ç»ï¼æ¸²æåºæµèè²èæ¯çº¿ï¼åè®©å°è½¦æ²¿çè·¯å¾è·å¹¶ç»åºæµç»¿è²è½¨è¿¹ï¼ã</p>
<p><strong>æä»¬çä¸å¡åºæ¯ä¸å®æ¹ç¤ºä¾çä¸»è¦åºå«å¨äºï¼</strong><br>
æä»¬çè·¯å¾æ°æ®æ¯<strong>å®æ¶å¢éæ´æ°</strong>çãåç«¯å¹¶æ²¡æä¸å¼å§å°±æ¿å°å®æ´çè·¯å¾ï¼èæ¯éè¿ WebSocket æè½®è¯¢å®æ¶è·ååç«¯è¿åçææ°è·¯å¾æ°æ®ãå æ­¤ï¼æä»¬éè¦èªè¡è®¾è®¡é»è¾ï¼è®¡ç®åºæ¯æ¬¡æ´æ°çâå¢éçæ®µâï¼å¹¶è®© Marker å¹³æ»å°èµ°å®è¿ä¸æ®µã</p>
<h3 id="æ ¸å¿æè·¯">æ ¸å¿æè·¯ï¼</h3>
<ol>
<li>
<p><strong>ååç«¯æ°æ®çº¦å®</strong>ï¼</p>
<ul>
<li>çæ³æåµä¸ï¼åç«¯æå¥½ç´æ¥è¿åâå¢éè·¯å¾âï¼å³ä¸ä¸æ¬¡ä½ç½®å°å½åä½ç½®çåæ éåï¼ã</li>
<li>ä½å¨å®éé¡¹ç®ä¸­ï¼æ¯å¦æ¬æ¡ä¾ï¼ï¼åç«¯æ¥å£è¿åçæ¯<strong>å½åæ¶å»çå®æ´ç´¯ç§¯è·¯å¾</strong>ãå æ­¤ï¼åç«¯éè¦èªè¡æ¯å¯¹ç¼å­çâä¸ä¸æ¬¡è·¯å¾âåâææ°è·¯å¾âï¼è®¡ç®åºå¢éé¨åã</li>
</ul>
</li>
<li>
<p><strong>ç¶æç®¡ç (ç¼å­å®ä¾)</strong>ï¼</p>
<ul>
<li>ä½¿ç¨ <code>Map</code> æ°æ®ç»ææ¥ç¼å­æ¯ä¸ªè®¾å¤ï¼å¦æ äººæºãæç¯ï¼ç <code>Marker</code>ï¼å¾æ ï¼å <code>Polyline</code>ï¼è½¨è¿¹çº¿ï¼å®ä¾ã</li>
<li>ç¡®ä¿æ¯ä¸ªè®¾å¤ ID å¯¹åºå¯ä¸çå°å¾å®ä¾ï¼é¿åæ°æ®å·æ°æ¶éå¤åå»ºå¯¼è´åå­æ³æ¼æéªçã</li>
</ul>
</li>
<li>
<p><strong>è®¡ç®å¢éè·¯å¾</strong>ï¼</p>
<ul>
<li>å½æ°æ°æ®å°è¾¾æ¶ï¼éè¿å¯¹æ¯æ°æ§è·¯å¾é¿åº¦ï¼æªååº<strong>æ°å¢çè·¯å¾æ®µ</strong>ã</li>
<li>è¿æ®µæ°å¢è·¯å¾å°±æ¯ Marker æ¥ä¸æ¥éè¦âå¹³æ»ç§»å¨âçè½¨è¿¹ã</li>
</ul>
</li>
<li>
<p><strong>å¹³æ»å¨ç» (<code>moveAlong</code>)</strong>ï¼</p>
<ul>
<li>è°ç¨é«å¾·å°å¾ç <code>marker.moveAlong()</code> æ¹æ³ï¼è®© Marker æ²¿çæ°å¢è·¯å¾å¹³æ»ç§»å¨ï¼èä¸æ¯ç¬é´è·³åã</li>
</ul>
</li>
<li>
<p><strong>å®æ¶ç»å¶è½¨è¿¹ (<code>moving</code> äºä»¶)</strong>ï¼</p>
<ul>
<li>çå¬ Marker ç <code>moving</code> äºä»¶ãå¨ç§»å¨è¿ç¨ä¸­ï¼å®æ¶æ´æ°è½¨è¿¹çº¿ï¼Polylineï¼çè·¯å¾ï¼ä»èå®ç°âè¾¹èµ°è¾¹ç»âçææã</li>
<li><strong>å³é®ç¹</strong>ï¼ä¸ºä»ä¹è¦å¨ <code>moving</code> äºä»¶ä¸­æ´æ°æ»è½¨è¿¹ï¼èä¸æ¯å¨å¨ç»ç»æ (<code>moveend</code>) åæ´æ°ï¼
<ul>
<li>è¿æ¯ä¸ºäºé²æ­¢æ°æ®æ¨éé¢çè¿å¿«ãå¦æç­å°å¨ç»ç»æåæ´æ°ï¼å¯è½ä¼åºç°âæ°çæ°æ®æ¨éæ¥äºï¼ä½ä¸ä¸æ¬¡å¨ç»è¿æ²¡ç»æï¼å¯¼è´è½¨è¿¹æ°æ®ä¸¢å¤±æè¡æ¥ä¸ä¸âçé®é¢ãå¨ <code>moving</code> è¿ç¨ä¸­å®æ¶å° <code>passedPath</code>ï¼å·²èµ°è¿çè·¯å¾ï¼æ¼æ¥å°æ»è½¨è¿¹ä¸­ï¼æ¯æç¨³å¦¥çæ¹å¼ã</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>å¨ç»ç»ææ¸ç</strong>ï¼</p>
<ul>
<li>å¨ç»ç»ææ¶ (<code>moveend</code>)ï¼æ¸çä¸´æ¶ç»å¶çè¾å©çº¿ï¼ç§»é¤çå¬å¨ï¼é²æ­¢åå­æ³æ¼ã</li>
</ul>
</li>
</ol>
<hr>
<h3 id="ä»£ç è¯¦è§£">ä»£ç è¯¦è§£</h3>
<h4 id="1-ç¶æç®¡çä¸åå§å">1. ç¶æç®¡çä¸åå§å</h4>
<p>æä»¬ä½¿ç¨ <code>Map</code> æ¥ç®¡çå°å¾ä¸ç Marker å Polyline å®ä¾ã</p>
<pre><code class="language-javascript">// å­å¨ Marker å®ä¾ (Key: è®¾å¤ID, Value: AMap.Marker)
const uavMarkers = ref(new Map());
// å­å¨è½¨è¿¹çº¿ Polyline å®ä¾ (Key: è®¾å¤ID, Value: AMap.Polyline)
const uavPaths = ref(new Map());
</code></pre>
<h4 id="2-æ ¸å¿å¤çå½æ°-refreshtemppoint">2. æ ¸å¿å¤çå½æ° <code>refreshTempPoint</code></h4>
<p>è¿ä¸ªå½æ°è´è´£å¤çåæ¡è®¾å¤æ°æ®çæ´æ°é»è¾ã</p>
<pre><code class="language-javascript">// å·æ°è®¾å¤ç¹ä½ä¸è½¨è¿¹
// item: åç«¯è¿åçè®¾å¤æ°æ®å¯¹è±¡
// position: å½åææ°çåæ ç¹
// type: æ´æ°ç±»åï¼'init' ä¸ºåå§åï¼å¶ä»ä¸ºå¢éæ´æ°ï¼
const refreshTempPoint = async (item, position, type, marker, tempOverlay, pathOverlay) =&gt; {
  // 1. æ¸çä¸ä¸è½®çä¸´æ¶è¦çç©ï¼å¦ä¸´æ¶è·¯çº¿ãè·ç¦»ææ¬ï¼
  tempOverlay?.clearOverlays();

  if (item.coordinatesLine) {
    const coordinatesLine = JSON.parse(item.coordinatesLine); // è§£æåç«¯è¿åçå®æ´è·¯å¾æ°ç»

    // --- A. åå§åèµ·ç¹ Marker ---
    let tempMarker = tempUavMarkers.value.get(item.id);
    if (!tempMarker) {
      // å¦ææ¯ç¬¬ä¸æ¬¡åºç°ï¼æ¸²æèµ·ç¹
      tempMarker = renderPoint(coordinatesLine[0], item, "", pathOverlay);
      tempUavMarkers.value.set(item.id, tempMarker);
    }

    // --- B. è·åæåå»ºåå²è½¨è¿¹çº¿ (Polyline) ---
    let polyline = uavPaths.value.get(item.id);
    if (!polyline) {
      polyline = trajectoryLine(item, pathOverlay); // åå»ºæ°ççº¿å®ä¾
      uavPaths.value.set(item.id, polyline);
    }

    // è·åå½åå°å¾ä¸å·²æçè·¯å¾ï¼ç¼å­çæ§è·¯å¾ï¼
    const existingPath = polyline.getPath() || [];

    if (type != "init") {
      // --- C. å¢éæ´æ°é»è¾ ---
      
      // 1. è®¡ç®å¢éè·¯å¾ï¼ä»å·²æè·¯å¾çæåä¸ä¸ªç¹å¼å§æªåï¼ç´å°ææ°è·¯å¾çæ«å°¾
      const newPathSegment = coordinatesLine.slice(
        existingPath.length ? existingPath.length - 1 : 0
      );

      // 2. åå»ºä¸æ¡ä¸´æ¶çâéå½¢âçº¿æ®µï¼ç¨äºè¾å©è®¡ç®æå±ç¤ºï¼è§éæ±èå®ï¼
      const newPolyline = trajectoryLine(item, tempOverlay);

      // 3. å¦æææ°å¢è·¯å¾ï¼å¼å§å¨ç»
      if (newPathSegment &amp;&amp; newPathSegment.length &gt; 0) {
        
        // çå¬ç§»å¨è¿ç¨
        marker.on("moving", function (e) {
          // e.passedPath æ¯ Marker å¨å½åå¨ç»çæ®µä¸­å·²ç»èµ°è¿çè·¯å¾
          newPolyline.setPath(e.passedPath);
          
          // [å³é®] å®æ¶å°èµ°è¿çè·¯å¾æ¼æ¥å°åå²æ»è½¨è¿¹ä¸­
          // è¿æ ·å³ä½¿ WebSocket æ¨éé¢çå¾å¿«ï¼ä¹è½ä¿è¯è½¨è¿¹æ°æ®çè¿ç»­æ§
          polyline.setPath([...existingPath, ...e.passedPath]);
        });

        // å¼å§å¹³æ»ç§»å¨
        marker.moveAlong(newPathSegment, {
          duration: 1000,    // å¨ç»æ¶é¿ï¼éæ ¹æ® WebSocket æ¨éé¢çè°æ´
          autoRotation: true, // è½¦å¤´èªå¨å¯¹åè·¯å¾æ¹å
        });

        // çå¬ç§»å¨ç»æ
        marker.on("moveend", function () {
          // å¨ç»ç»æï¼æ¸çä¸´æ¶è¦çç©
          tempOverlay?.clearOverlays();
          
          // æ´æ°è·ç¦»ææ¬ç­ä¿¡æ¯
          if (item.distance) {
            renderText(
              coordinatesLine[Math.ceil(coordinatesLine.length - 2)],
              `${item.distance}ç±³`,
              tempOverlay
            );
          }
          
          // ç§»é¤çå¬å¨ï¼é²æ­¢éå¤ç»å®
          marker.off("moveend");
        });
      } else {
        // å¦ææ²¡ææ°å¢è·¯å¾ï¼ä½ç½®æ²¡åï¼ï¼ä»æ´æ°æå­ä¿¡æ¯
        if (item.distance) {
          renderText(..., `${item.distance}ç±³`, tempOverlay);
        }
      }

    } else {
      // --- D. åå§åé»è¾ ---
      // å¦ææ¯åå§åå è½½ï¼ç´æ¥è®¾ç½®å®æ´è·¯å¾ï¼ä¸è¿è¡å¨ç»åæ¾
      if (item.distance) {
         renderText(..., `${item.distance}ç±³`, tempOverlay);
      }
      polyline.setPath(coordinatesLine);
    }
  } else {
    // --- E. æ è½¨è¿¹æ°æ®æ¶çéçº§å¤ç ---
    // å¦æåç«¯æ²¡æè¿åè·¯å¾æ°æ®ï¼ç´æ¥è·³åå°ææ°ä½ç½®
    marker.setPosition(position);
    
    // æ¸çç¸å³çè½¨è¿¹å®ä¾åç¼å­
    let tempMarker = tempUavMarkers.value.get(item.id);
    if (tempMarker) {
      tempMarker.setMap(null);
      pathOverlay &amp;&amp; pathOverlay.removeOverlay(tempMarker);
      tempUavMarkers.value.delete(item.id);
    }
    
    let polyline = uavPaths.value.get(item.id);
    if (polyline) {
      polyline.setMap(null);
      pathOverlay &amp;&amp; pathOverlay.removeOverlay(polyline);
      uavPaths.value.delete(item.id);
    }
  }
};
</code></pre>
<p>}<br>
};</p>
<pre><code class="language-javascript">
// æ äººæºåæç¯è½¨è¿¹ææ¶
const refreshAirMap = async (type, data) =&gt; {
  const res = await getUavElement();
  // console.log("æ äººæºæ°æ®", res.result);
  res.result.map(async (item) =&gt; {
    // data.map(async (item) =&gt; {
    if (item.type == "1") {
      let position = JSON.parse(item.coordinates);
      // è·åæåå»ºæ äººæºæ è®°
      let marker = uavMarkers.value.get(item.id);
      if (!marker) {
        // åå»ºæ äººæºãæç¯ç¹ä½ã
        marker = renderPoint(position, item, "", overlayGroups.value);
        uavMarkers.value.set(item.id, marker);
      }else{
        
        if (item.elementType == "2") {
          // å·²æç¹ä½ä¸æ¯æç¯ç¹ä½å°±æ´æ°çµé
          marker.setLabel({
            content: `&lt;div class="marker-label-container"&gt;
              &lt;div class="info-name"&gt;${item.name}&lt;/div&gt;
              &lt;div class="icon-placeholder"&gt;&lt;/div&gt;
              ${batteryHtml(item)}
            &lt;/div&gt;`,
            offset: new AMaps.value.Pixel(0, 0),
            direction: "center",
          });
        }
      }

      if (item.elementType == "1") {
        // æ äººæºè½¨è¿¹
        refreshTempPoint(
          item,
          position,
          type,
          marker,
          pathOverlayGroups.value,
          pathsStartPointOverlayGroups.value
        );
      } else if (item.elementType == "2") {
        // æç¯è½¨è¿¹
        refreshTempPoint(
          item,
          position,
          type,
          marker,
          rescuePathsOverlayGroups.value,
          rescueOverlayGroups.value
        );
      }
      // è½¨è¿¹é¨åï¼å¤æ­æ¯å¦æè½¨è¿¹
    }
  });
  // });
};
</code></pre>
<p>è¯´æä¸ä¸å¦ï¼æçé¡¹ç®ä¸­è¿éè¦å®ç°å¶ä»åè½åæ¯æç¯çµéå±ç¤ºï¼ç¹å»æé®å¯éèæ äººæºè½¨è¿¹ï¼ç¹å»æé®å¯éèæç¯è½¨è¿¹ï¼æ äººæºåæç¯è½¨è¿¹èµ·å§ç¹ä¹éè¦å±ç¤ºä¸ä¸ªç¹ä½å¾æ ï¼è½¨è¿¹çº¿ä¸æ¾ç¤ºè·ç¦»ï¼è¿èèäºç¬¬ä¸æ¬¡è¿å¥é¡¹ç®ï¼å¦æ è½¨è¿¹å°±åªæ´æ°ç¹ä½åæ ç­ç­è¿äºï¼æ å³çè½¨è¿¹å±ç¤ºé»è¾çåä½è§ä¼èç·ç¥è¿å°±å¥½ï¼è¿ç¯æç« ä¸»è¦æ¯åäº«ä¸ä¸å®æ¶è½¨è¿¹å®ç°çé»è¾ï¼æè½¨è¿¹ç¸å³é»è¾æ½åºæ¥éæ°åä¸ä»½ä»£ç ï¼æå«éº»ç¦å»å»ã</p>
<h2 id="æ»ç»">æ»ç»</h2>
<p>éè¿ç»å å¢éè·¯å¾è®¡ç®<code>moveAlong</code> è½¨è¿¹åæ¾ ä»¥å <code>moving</code> äºä»¶çå¬ï¼æä»¬å®ç°äºä¸ä¸ªé«æ§è½ä¸è§è§æµççå®æ¶è½¨è¿¹è¿½è¸ªåè½ãè¿ç§æ¹æ¡ç¹å«éåæ äººæºå·¡èªãè½¦è¾å®æ¶å®ä½ç­éè¦é«é¢æ´æ°ä½ç½®çåºæ¯ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.003472222222222222" data-date-updated="2026-01-14 14:40">2026-01-14 14:35</span>&nbsp;
<a href="https://www.cnblogs.com/lijinhuaboke">æ­¤é¢å·®ç£ã</a>&nbsp;
éè¯»(<span id="post_view_count">325</span>)&nbsp;
è¯è®º(<span id="post_comment_count">3</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19457121);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19457121', targetLink: 'https://www.cnblogs.com/lijinhuaboke/p/19457121', title: 'é«å¾·å°å¾å®ç°å®æ¶è½¨è¿¹å±ç¤º' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Webå®å¨æ¸åââXSSãCSRFãSQLæ³¨å¥ãé²éæ¾ä¸æææ°æ®ä¿æ¤çåå±ç­ç¥ ]]></title>
    <link>https://www.cnblogs.com/shiyuelp/p/19481124</link>
    <guid>f89989ea26e7b5a64c29a346a1bee486</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/shiyuelp/p/19481124" title="åå¸äº 2026-01-14 11:24">
    <span role="heading" aria-level="2">Webå®å¨æ¸åââXSSãCSRFãSQLæ³¨å¥ãé²éæ¾ä¸æææ°æ®ä¿æ¤çåå±ç­ç¥</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p><strong>åå¨åé¢ï¼æ¬äººç®åå¤äºæ±èä¸­ï¼å¦æåéåæ¨å²ä½ï¼è¯·å ï¼lpshiyue æè°¢ãåæ¶è¿æå¤§å®¶ä¸é®ä¸è¿ï¼èµç¹å¥¶ç²é±ã</strong></p>
<blockquote>
<p>ç°ä»£Webå®å¨é²å¾¡ä¸æ¯åç¹å·¥å·çç»åï¼èæ¯ä»æ¸²æå±å°æ°æ®å±ççºµæ·±é²å¾¡ä½ç³»</p>
</blockquote>
<p>å¨å»ºç«å®åçè®¤è¯ææä½ç³»åï¼æä»¬éè¦å³æ³¨Webåºç¨çåºç¡å®å¨é²çº¿ãæ è®ºæ¯ä¼ ç»Webåºç¨è¿æ¯ç°ä»£APIæå¡ï¼é½é¢ä¸´çæ¥èªå¤å±é¢çå®å¨å¨èãæ¬æå°ç³»ç»éè¿°XSSãCSRFãSQLæ³¨å¥ç­æ ¸å¿æ»å»çé²å¾¡ç­ç¥ï¼å¹¶æä¾ä»åç«¯å°æ°æ®åºçå®æ´å®å¨æ¸åã</p>
<h2 id="1-webå®å¨é²å¾¡çæ´ä½è§è§çºµæ·±é²å¾¡æç¥">1 Webå®å¨é²å¾¡çæ´ä½è§è§ï¼çºµæ·±é²å¾¡æç¥</h2>
<h3 id="11-ç°ä»£webå®å¨çå±æ¬¡åé²å¾¡çå¿µ">1.1 ç°ä»£Webå®å¨çå±æ¬¡åé²å¾¡çå¿µ</h3>
<p>Webå®å¨æ¬è´¨ä¸æ¯ä¸åº<strong>æ»é²ä¸å¯¹ç§°</strong>çæäºãæ»å»èåªéæ¾å°ä¸ä¸ªæ¼æ´å³å¯å®ç°å¥ä¾µï¼èé²å¾¡èéè¦ä¿æ¤æ´ä¸ªç³»ç»ãå æ­¤ï¼<strong>çºµæ·±é²å¾¡</strong>ï¼Defense in Depthï¼æä¸ºç°ä»£Webå®å¨çæ ¸å¿çå¿µã</p>
<p><strong>çºµæ·±é²å¾¡çä¸ä¸ªæ ¸å¿å±é¢</strong>ï¼</p>
<ul>
<li><strong>æ¸²æå±å®å¨</strong>ï¼æµè§å¨ç¯å¢ä¸çXSSãCSRFç­å®¢æ·ç«¯æ»å»é²æ¤</li>
<li><strong>åºç¨å±å®å¨</strong>ï¼æå¡ç«¯é»è¾å±é¢çSQLæ³¨å¥ãå½ä»¤æ³¨å¥ç­æ¼æ´é²æ¤</li>
<li><strong>æ°æ®å±å®å¨</strong>ï¼æææ°æ®å­å¨ãä¼ è¾è¿ç¨ä¸­çå å¯ä¿æ¤</li>
</ul>
<h3 id="12-å®å¨è¾¹ççéæ°å®ä¹">1.2 å®å¨è¾¹ççéæ°å®ä¹</h3>
<p>éçååç«¯åç¦»åAPIä¼åæ¶æçæ®åï¼Webå®å¨ç<strong>æ»å»é¢</strong>åçäºæ¾èååãä¼ ç»ä»¥æå¡å¨ä¸ºä¸­å¿çé²æ¤æ¨¡å¼éè¦æ©å±ä¸º<strong>å¨é¾è·¯é²æ¤</strong>ï¼</p>
<pre><code>å®¢æ·ç«¯å®å¨ â ä¼ è¾å®å¨ â æå¡ç«¯å®å¨ â æ°æ®å­å¨å®å¨
</code></pre>
<p>æ¯ä¸ªç¯èé½éè¦ç¹å®çé²æ¤ç­ç¥ï¼ä¸ç¯èé´éè¦å®å¨ååãä¾å¦ï¼CSPï¼åå®¹å®å¨ç­ç¥ï¼éè¦å¨HTTPååºå¤´ä¸­è®¾ç½®ï¼ä½å½±åçæ¯æµè§å¨ç«¯çèµæºå è½½è¡ä¸ºã</p>
<h2 id="2-xssé²æ¤ä»è¾å¥å°è¾åºçå¨æµç¨æ§å¶">2 XSSé²æ¤ï¼ä»è¾å¥å°è¾åºçå¨æµç¨æ§å¶</h2>
<h3 id="21-xssæ»å»çæ¬è´¨ä¸åç§">2.1 XSSæ»å»çæ¬è´¨ä¸åç§</h3>
<p>XSSï¼è·¨ç«èæ¬æ»å»ï¼çæ ¸å¿é®é¢æ¯<strong>å°ç¨æ·è¾å¥éè¯¯å°æ§è¡ä¸ºä»£ç </strong>ãæ ¹æ®æ»å»ææ³çä¸åï¼XSSä¸»è¦åä¸ºä¸ç±»ï¼</p>
<p><strong>åå°åXSS</strong>ï¼æ¶æèæ¬ä½ä¸ºè¯·æ±åæ°åéå°æå¡å¨ï¼å¹¶ç«å³è¿åæ§è¡ãå¸¸è§äºæç´¢æ¡ãéè¯¯æ¶æ¯é¡µé¢ã</p>
<p><strong>å­å¨åXSS</strong>ï¼æ¶æèæ¬è¢«æä¹åå°æ°æ®åºï¼æ¯æ¬¡é¡µé¢è®¿é®é½ä¼æ§è¡ãå¸¸è§äºè®ºåè¯è®ºãç¨æ·åé¦ç­UGCåå®¹ã</p>
<p><strong>DOMåXSS</strong>ï¼å®å¨å¨æµè§å¨ç«¯åçï¼éè¿ä¿®æ¹DOMæ æ¥æ§è¡æ¶æèæ¬ãä¸æ¶åæå¡å¨ç«¯åä¸ã</p>
<h3 id="22-å¤å±æ¬¡xssé²æ¤ç­ç¥">2.2 å¤å±æ¬¡XSSé²æ¤ç­ç¥</h3>
<p><strong>è¾å¥éªè¯ä¸è¿æ»¤</strong>æ¯Xé²æ¤çç¬¬ä¸éé²çº¿ï¼ä½ä¸åºæ¯å¯ä¸é²çº¿ã</p>
<pre><code class="language-java">// ä½¿ç¨JSoupè¿è¡HTMLæ ç­¾è¿æ»¤çç¤ºä¾
public class XssFilter {
    private static final Whitelist WHITELIST = Whitelist.basic();
    
    public static String clean(String input) {
        if (input == null) return "";
        return Jsoup.clean(input, WHITELIST);  // ä»åè®¸å®å¨çHTMLæ ç­¾
    }
}
</code></pre>
<p><strong>è¾åºç¼ç </strong>æ¯æ´å¯é çé²æ¤ææ®µï¼ç¡®ä¿æ°æ®å¨æ¸²ææ¶ä¸è¢«æ§è¡ä¸ºä»£ç ã</p>
<pre><code class="language-html">&lt;!-- å¨æ¨¡æ¿ä¸­è¿è¡è¾åºç¼ç  --&gt;
&lt;div th:text="${userContent}"&gt;&lt;/div&gt;  &lt;!-- å®å¨ï¼Thymeleafèªå¨ç¼ç  --&gt;
&lt;div&gt;[[${userContent}]]&lt;/div&gt;         &lt;!-- å®å¨ï¼Thymeleafç®åè¯­æ³ --&gt;

&lt;!-- å±é©ï¼ç´æ¥è¾åºæªç¼ç çåå®¹ --&gt;
&lt;div th:utext="${userContent}"&gt;&lt;/div&gt;  &lt;!-- å¯è½æ§è¡æ¶æèæ¬ --&gt;
</code></pre>
<p><strong>åå®¹å®å¨ç­ç¥ï¼CSPï¼</strong> æä¾äºæç»çé²çº¿ï¼éè¿ç½ååæ§å¶èµæºå è½½ã</p>
<pre><code class="language-http">Content-Security-Policy: default-src 'self'; script-src 'self' https://trusted.cdn.com; style-src 'self' 'unsafe-inline';
</code></pre>
<h3 id="23-ç°ä»£åç«¯æ¡æ¶çxssé²æ¤">2.3 ç°ä»£åç«¯æ¡æ¶çXSSé²æ¤</h3>
<p>ç°ä»£åç«¯æ¡æ¶å¦ReactãVueç­æä¾äº<strong>ä¸å®ç¨åº¦çèªå¨é²æ¤</strong>ï¼ä½ä»ææ³¨æäºé¡¹ï¼</p>
<p><strong>Reactçèªå¨è½¬ä¹æºå¶</strong>ï¼</p>
<pre><code class="language-jsx">// å®å¨ï¼Reactä¼èªå¨å¯¹åéè¿è¡è½¬ä¹
function Welcome(props) {
    return &lt;h1&gt;Hello, {props.username}&lt;/h1&gt;;  // usernameä¸­çHTMLä¼è¢«è½¬ä¹
}

// å±é©ï¼ä½¿ç¨dangerouslySetInnerHTMLç»è¿é²æ¤
function DangerousComponent({ content }) {
    return &lt;div dangerouslySetInnerHTML={{ __html: content }} /&gt;;
}
</code></pre>
<p><strong>Vueçç±»ä¼¼æºå¶</strong>ï¼</p>
<pre><code class="language-html">&lt;!-- å®å¨ï¼Vueèªå¨è½¬ä¹ --&gt;
&lt;div&gt;{{ userInput }}&lt;/div&gt;

&lt;!-- å±é©ï¼ä½¿ç¨v-htmlæä»¤ --&gt;
&lt;div v-html="userInput"&gt;&lt;/div&gt;
</code></pre>
<h2 id="3-csrfé²æ¤ç¡®ä¿è¯·æ±çåæ³æ§éªè¯">3 CSRFé²æ¤ï¼ç¡®ä¿è¯·æ±çåæ³æ§éªè¯</h2>
<h3 id="31-csrfæ»å»åçä¸å±å®³">3.1 CSRFæ»å»åçä¸å±å®³</h3>
<p>CSRFï¼è·¨ç«è¯·æ±ä¼ªé ï¼æ»å»å©ç¨<strong>æµè§å¨çåç«Cookieåéæºå¶</strong>ï¼è¯±ä½¿ç¨æ·å¨ä¸ç¥æçæåµä¸åèµ·æ¶æè¯·æ±ã</p>
<p><strong>å¸åæ»å»æµç¨</strong>ï¼</p>
<ol>
<li>ç¨æ·ç»å½æ­£è§ç½ç«Aï¼è·å¾è®¤è¯Cookie</li>
<li>ç¨æ·è®¿é®æ¶æç½ç«Bï¼é¡µé¢ä¸­åå«åç½ç«Aåè¯·æ±çä»£ç </li>
<li>æµè§å¨èªå¨æºå¸¦ç½ç«AçCookieååºè¯·æ±</li>
<li>ç½ç«Aè®¤ä¸ºè¿æ¯ç¨æ·çåæ³æä½ï¼æ§è¡æ¶æè¯·æ±</li>
</ol>
<h3 id="32-csrfé²æ¤çååç­ç¥">3.2 CSRFé²æ¤çååç­ç¥</h3>
<p><strong>CSRF Token</strong>æ¯é²æ¤CSRFæææçææ®µï¼è¦æ±æ¯ä¸ªè¯·æ±æºå¸¦ä¸å¯é¢æµçä»¤çã</p>
<pre><code class="language-java">// Spring Securityä¸­çCSRFé²æ¤éç½®
@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .csrf().csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse());
    }
}

// åç«¯å¨è¯·æ±ä¸­æºå¸¦CSRF Token
// &lt;form&gt;ä¸­èªå¨åå«ï¼&lt;input type="hidden" name="_csrf" th:value="${_csrf.token}"&gt;
// AJAXè¯·æ±éè¦æå¨è®¾ç½®å¤´ï¼X-CSRF-TOKEN: tokenå¼
</code></pre>
<p><strong>SameSite Cookieå±æ§</strong>ä»æµè§å¨å±é¢æä¾é²æ¤ï¼éå¶ç¬¬ä¸æ¹Cookieçä½¿ç¨ã</p>
<pre><code class="language-java">// è®¾ç½®SameSiteå±æ§çCookie
Cookie sessionCookie = new Cookie("JSESSIONID", sessionId);
sessionCookie.setSecure(true);  // ä»HTTPSä¼ è¾
sessionCookie.setHttpOnly(true); // ç¦æ­¢JavaScriptè®¿é®
// è®¾ç½®SameSite=Strictï¼å®å¨ç¦æ­¢ç¬¬ä¸æ¹ä½¿ç¨
response.addHeader("Set-Cookie", "JSESSIONID=" + sessionId + "; SameSite=Strict");
</code></pre>
<p><strong>å³é®æä½äºæ¬¡éªè¯</strong>éå¯¹éè¦æä½ï¼å¦æ¯ä»ãä¿®æ¹å¯ç ï¼è¦æ±éæ°è®¤è¯ã</p>
<h2 id="4-sqlæ³¨å¥é²æ¤æ°æ®å±è®¿é®çå®å¨è¾¹ç">4 SQLæ³¨å¥é²æ¤ï¼æ°æ®å±è®¿é®çå®å¨è¾¹ç</h2>
<h3 id="41-sqlæ³¨å¥çæ¼åä¸å±å®³">4.1 SQLæ³¨å¥çæ¼åä¸å±å®³</h3>
<p>SQLæ³¨å¥ä¸ä»ä»æ¯ä¼ ç»ç<code>' OR '1'='1</code>æ»å»ï¼ç°ä»£SQLæ³¨å¥åæ¬<strong>ç²æ³¨ãæ¶é´ç²æ³¨ãå å æ¥è¯¢</strong>ç­å¤æå½¢å¼ã</p>
<p><strong>SQLæ³¨å¥çä¸»è¦å±å®³</strong>ï¼</p>
<ul>
<li><strong>æ°æ®æ³é²</strong>ï¼è·åææä¿¡æ¯ï¼å¦ç¨æ·å­è¯ãä¸ªäººæ°æ®</li>
<li><strong>æ°æ®ç¯¡æ¹</strong>ï¼ä¿®æ¹ãå é¤éè¦ä¸å¡æ°æ®</li>
<li><strong>æéæå</strong>ï¼è·åæ°æ®åºç®¡çåæé</li>
<li><strong>æå¡å¨æ²¦é·</strong>ï¼éè¿æ°æ®åºæ§è¡ç³»ç»å½ä»¤</li>
</ul>
<h3 id="42-æ ¹æ¬æ§è§£å³æ¹æ¡åæ°åæ¥è¯¢">4.2 æ ¹æ¬æ§è§£å³æ¹æ¡ï¼åæ°åæ¥è¯¢</h3>
<p><strong>é¢ç¼è¯è¯­å¥ï¼PreparedStatementï¼</strong> éè¿å°SQLä»£ç ä¸æ°æ®åç¦»ï¼ä»æ ¹æ¬ä¸æç»æ³¨å¥å¯è½ã</p>
<pre><code class="language-java">// å±é©ï¼å­ç¬¦ä¸²æ¼æ¥SQL
String query = "SELECT * FROM users WHERE username = '" + username + "'";
Statement stmt = connection.createStatement();
ResultSet rs = stmt.executeQuery(query);

// å®å¨ï¼ä½¿ç¨PreparedStatement
String query = "SELECT * FROM users WHERE username = ?";
PreparedStatement pstmt = connection.prepareStatement(query);
pstmt.setString(1, username);  // åæ°ä¼è¢«æ­£ç¡®è½¬ä¹åå¤ç
ResultSet rs = pstmt.executeQuery();
</code></pre>
<p><strong>ORMæ¡æ¶çå®å¨ä½¿ç¨</strong>ï¼</p>
<pre><code class="language-java">// JPA/Hibernateå®å¨ç¨æ³
public interface UserRepository extends JpaRepository&lt;User, Long&gt; {
    // å®å¨ï¼ä½¿ç¨å½ååæ°
    @Query("SELECT u FROM User u WHERE u.username = :username")
    User findByUsername(@Param("username") String username);
    
    // å±é©ï¼ä½¿ç¨åçSQLæ¼æ¥ï¼ä¸æ¨èï¼
    @Query(value = "SELECT * FROM users WHERE username = '" + ":username" + "'", nativeQuery = true)
    User findByUsernameUnsafe(@Param("username") String username);
}
</code></pre>
<h3 id="43-æ·±åº¦é²å¾¡æå°æéåå">4.3 æ·±åº¦é²å¾¡ï¼æå°æéåå</h3>
<p><strong>æ°æ®åºç¨æ·æéåç¦»</strong>æ¯åå°SQLæ³¨å¥å±å®³çéè¦æªæ½ï¼</p>
<pre><code class="language-sql">-- åå»ºä»å·ææ¥è¯¢æéçæ°æ®åºç¨æ·
CREATE USER 'webapp'@'localhost' IDENTIFIED BY 'securepassword';
GRANT SELECT ON app_db.* TO 'webapp'@'localhost';

-- éè¦æä½ä½¿ç¨å­å¨è¿ç¨ï¼ä»æææ§è¡æé
GRANT EXECUTE ON PROCEDURE update_user_profile TO 'webapp'@'localhost';
</code></pre>
<h2 id="5-é²éæ¾æ»å»ç¡®ä¿è¯·æ±çæ°é²æ§">5 é²éæ¾æ»å»ï¼ç¡®ä¿è¯·æ±çæ°é²æ§</h2>
<h3 id="51-éæ¾æ»å»çåçä¸åºæ¯">5.1 éæ¾æ»å»çåçä¸åºæ¯</h3>
<p>éæ¾æ»å»ææ»å»è<strong>æªè·åæ³è¯·æ±å¹¶éå¤åé</strong>ï¼å¯¼è´éé¢ææä½ãå¸¸è§äºæ¯ä»ãéè¦ç¶æåæ´ç­åºæ¯ã</p>
<p><strong>éæ¾æ»å»çé²æ¤ç®æ </strong>ï¼</p>
<ul>
<li>ç¡®ä¿è¯·æ±ç<strong>æ°é²æ§</strong>ï¼ä¸æ¯æ§çéå¤è¯·æ±ï¼</li>
<li>ä¿è¯è¯·æ±ç<strong>å¯ä¸æ§</strong>ï¼åä¸è¯·æ±ä¸è½æ§è¡ä¸¤æ¬¡ï¼</li>
</ul>
<h3 id="52-åºäºnonceåæ¶é´æ³çé²æ¤æ¹æ¡">5.2 åºäºNonceåæ¶é´æ³çé²æ¤æ¹æ¡</h3>
<p><strong>Nonceï¼ä¸æ¬¡æ§æ°å­ï¼æ¹æ¡</strong>ç¡®ä¿æ¯ä¸ªè¯·æ±çå¯ä¸æ§ã</p>
<pre><code class="language-java">@Service
public class NonceService {
    @Autowired
    private RedisTemplate&lt;String, String&gt; redisTemplate;
    
    private static final long NONCE_TIMEOUT = 5 * 60; // 5åé
    
    public boolean validateNonce(String nonce, long timestamp) {
        // æ£æ¥æ¶é´æ³æææ§ï¼é²æ­¢æ¶éåç§»æ»å»ï¼
        long currentTime = System.currentTimeMillis() / 1000;
        if (Math.abs(currentTime - timestamp) &gt; 300) { // 5åéå®¹å¿
            return false;
        }
        
        // æ£æ¥Nonceæ¯å¦å·²ä½¿ç¨ï¼Redisåå­æä½ï¼
        String key = "nonce:" + nonce;
        return redisTemplate.opsForValue().setIfAbsent(key, "used", 
            Duration.ofSeconds(NONCE_TIMEOUT));
    }
}
</code></pre>
<p><strong>ç­¾åæºå¶</strong>é²æ­¢è¯·æ±è¢«ç¯¡æ¹ï¼</p>
<pre><code class="language-java">public class SignatureUtils {
    public static String generateSignature(String data, String secret) {
        String message = data + secret;
        return DigestUtils.sha256Hex(message);
    }
    
    public static boolean validateSignature(String data, String signature, String secret) {
        String expected = generateSignature(data, secret);
        return MessageDigest.isEqual(expected.getBytes(), signature.getBytes());
    }
}
</code></pre>
<h2 id="6-æææ°æ®ä¿æ¤å¨çå½å¨æå®å¨">6 æææ°æ®ä¿æ¤ï¼å¨çå½å¨æå®å¨</h2>
<h3 id="61-æ°æ®ä¼ è¾å®å¨tlsæä½³å®è·µ">6.1 æ°æ®ä¼ è¾å®å¨ï¼TLSæä½³å®è·µ</h3>
<p><strong>HTTPSéç½®ä¼å</strong>ç¡®ä¿æ°æ®ä¼ è¾è¿ç¨ä¸­çæºå¯æ§åå®æ´æ§ã</p>
<pre><code class="language-nginx"># Nginx TLSä¼åéç½®
server {
    listen 443 ssl http2;
    server_name example.com;
    
    # è¯ä¹¦éç½®
    ssl_certificate /path/to/fullchain.pem;
    ssl_certificate_key /path/to/privkey.pem;
    
    # åè®®åå¯ç å¥ä»¶ä¼å
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;
    ssl_prefer_server_ciphers off;
    
    # HSTSå¼ºå¶HTTPS
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # å®å¨å¤´é¨
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
}
</code></pre>
<h3 id="62-æææ°æ®å­å¨å®å¨">6.2 æææ°æ®å­å¨å®å¨</h3>
<p><strong>å¯ç åå¸å¤ç</strong>ä½¿ç¨éåçç®æ³åçå¼ã</p>
<pre><code class="language-java">@Service
public class PasswordService {
    private final BCryptPasswordEncoder passwordEncoder = new BCryptPasswordEncoder();
    
    public String hashPassword(String rawPassword) {
        return passwordEncoder.encode(rawPassword);
    }
    
    public boolean matches(String rawPassword, String encodedPassword) {
        return passwordEncoder.matches(rawPassword, encodedPassword);
    }
}
</code></pre>
<p><strong>å¯éå å¯æ°æ®</strong>ä½¿ç¨å¼ºå å¯ç®æ³ã</p>
<pre><code class="language-java">@Component
public class AesEncryptionService {
    private static final String ALGORITHM = "AES/GCM/NoPadding";
    private final SecretKey secretKey;
    
    public AesEncryptionService(@Value("${encryption.key}") String base64Key) {
        byte[] keyBytes = Base64.getDecoder().decode(base64Key);
        this.secretKey = new SecretKeySpec(keyBytes, "AES");
    }
    
    public String encrypt(String data) throws GeneralSecurityException {
        Cipher cipher = Cipher.getInstance(ALGORITHM);
        cipher.init(Cipher.ENCRYPT_MODE, secretKey);
        
        byte[] encrypted = cipher.doFinal(data.getBytes(StandardCharsets.UTF_8));
        byte[] iv = cipher.getIV();
        
        // ç»åIVåå å¯æ°æ®
        byte[] result = new byte[iv.length + encrypted.length];
        System.arraycopy(iv, 0, result, 0, iv.length);
        System.arraycopy(encrypted, 0, result, iv.length, encrypted.length);
        
        return Base64.getEncoder().encodeToString(result);
    }
}
</code></pre>
<h2 id="7-å®å¨å¤´é¨éç½®æµè§å¨ç«¯çå®å¨å åº">7 å®å¨å¤´é¨éç½®ï¼æµè§å¨ç«¯çå®å¨å åº</h2>
<h3 id="71-å³é®å®å¨å¤´é¨åå¶ä½ç¨">7.1 å³é®å®å¨å¤´é¨åå¶ä½ç¨</h3>
<p><strong>å®å¨å¤´é¨</strong>ä¸ºæµè§å¨æä¾é¢å¤çå®å¨æä»¤ï¼æ¯ç°ä»£Webåºç¨çéè¦é²æ¤å±ã</p>
<pre><code class="language-nginx"># å®æ´çå®å¨å¤´é¨éç½®
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';" always;
</code></pre>
<h3 id="72-cspçç²¾ç»æ§å¶ç­ç¥">7.2 CSPçç²¾ç»æ§å¶ç­ç¥</h3>
<p><strong>åå®¹å®å¨ç­ç¥</strong>éè¿ç½ååæ§å¶èµæºå è½½ï¼ææåç¼XSSæ»å»ã</p>
<pre><code class="language-http"># ä¸¥æ ¼çCSPç­ç¥ç¤ºä¾
Content-Security-Policy: 
  default-src 'none';
  script-src 'self' 'sha256-abc123...';
  style-src 'self' 'unsafe-inline';
  img-src 'self' data: https:;
  font-src 'self';
  connect-src 'self';
  frame-ancestors 'none';
  base-uri 'self';
  form-action 'self';
</code></pre>
<h2 id="8-èªå¨åå®å¨æ£æµä¸çæ§">8 èªå¨åå®å¨æ£æµä¸çæ§</h2>
<h3 id="81-å®å¨å·¥å·éæ">8.1 å®å¨å·¥å·éæ</h3>
<p><strong>SASTï¼éæåºç¨å®å¨æµè¯ï¼</strong> å¨å¼åé¶æ®µåç°æ½å¨æ¼æ´ã</p>
<pre><code class="language-yaml"># GitLab CIå®å¨æ«æç¤ºä¾
stages:
  - test
  - security

sast:
  stage: security
  image: owasp/zap2docker-stable
  script:
    - zap-baseline.py -t https://${STAGING_URL} -r report.html
  artifacts:
    paths:
      - report.html
</code></pre>
<p><strong>ä¾èµé¡¹æ¼æ´æ«æ</strong>åæ¶åç°ç¬¬ä¸æ¹ç»ä»¶é£é©ã</p>
<pre><code class="language-xml">&lt;!-- OWASPä¾èµæ£æ¥Mavenæä»¶ --&gt;
&lt;plugin&gt;
    &lt;groupId&gt;org.owasp&lt;/groupId&gt;
    &lt;artifactId&gt;dependency-check-maven&lt;/artifactId&gt;
    &lt;version&gt;6.0.0&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;goals&gt;
                &lt;goal&gt;check&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre>
<h3 id="82-å®å¨çæ§ä¸åºæ¥ååº">8.2 å®å¨çæ§ä¸åºæ¥ååº</h3>
<p><strong>å®å¨äºä»¶æ¥å¿è®°å½</strong>ä¸ºäºä»¶è¿½æº¯æä¾ä¾æ®ã</p>
<pre><code class="language-java">@Aspect
@Component
public class SecurityLoggingAspect {
    private static final Logger SECURITY_LOGGER = LoggerFactory.getLogger("SECURITY");
    
    @AfterReturning(pointcut = "execution(* com.example.controller.AuthController.login(..))", returning = "result")
    public void logLoginAttempt(JoinPoint joinPoint, Object result) {
        Object[] args = joinPoint.getArgs();
        String username = (String) args[0];
        String ip = getClientIP();
        
        SECURITY_LOGGER.info("ç»å½å°è¯: ç¨æ·={}, IP={}, ç»æ={}", 
            username, ip, ((LoginResult)result).isSuccess() ? "æå" : "å¤±è´¥");
    }
}
</code></pre>
<h2 id="æ»ç»">æ»ç»</h2>
<p>Webå®å¨æ¯ä¸ä¸ªéè¦<strong>æç»­å³æ³¨åæå¥</strong>çé¢åãææçå®å¨é²æ¤ä¸æ¯åä¸ææ¯æå·¥å·çåºç¨ï¼èæ¯<strong>å¤å±æ¬¡ãå¤ç»´åº¦é²æ¤ç­ç¥çææºç»å</strong>ã</p>
<p><strong>çºµæ·±é²å¾¡çæ ¸å¿åå</strong>ï¼</p>
<ol>
<li><strong>è¾å¥éªè¯</strong>ï¼ææç¨æ·è¾å¥é½ä¸å¯ä¿¡ï¼å¿é¡»ç»è¿ä¸¥æ ¼éªè¯</li>
<li><strong>æå°æé</strong>ï¼æ¯ä¸ªç»ä»¶åªæ¥æå®æå¶åè½æéçæå°æé</li>
<li><strong>é»è®¤æç»</strong>ï¼ç½ååä¼äºé»ååï¼æç¡®åè®¸èéé»è®¤åè®¸</li>
<li><strong>å¨é¢é²æ¤</strong>ï¼ä»å®¢æ·ç«¯å°æ°æ®åºï¼æ¯ä¸ªç¯èé½éè¦ç¸åºçé²æ¤æªæ½</li>
<li><strong>æç»­çæ§</strong>ï¼å®å¨æ¯ä¸ä¸ªè¿ç¨ï¼éè¦æç»­çæ§åæ¹è¿</li>
</ol>
<p>éè¿å®æ½æ¬ææä¾çåå±é²æ¤ç­ç¥ï¼å¯ä»¥æ¾èæåWebåºç¨çå®å¨æ§ï¼ä¸ºä¸å¡åå±æä¾å¯é çåºç¡ä¿éã</p>
<hr>
<p><strong>ð ä¸ç¯é¢å</strong><br>
ãå¥çº¦ä¼åä¸åä½æçââæ¶è´¹èé©±å¨å¥çº¦æç»´å¸¦æ¥çå¢éææ¬ä¸éãââ æä»¬å°æ·±å¥æ¢è®¨ï¼</p>
<ul>
<li>ð <strong>å¥çº¦æµè¯æ¬è´¨</strong>ï¼æ¶è´¹èé©±å¨å¥çº¦ï¼CDCï¼å¦ä½è§£è¦å¾®æå¡éæä¾èµ</li>
<li>ð¤ <strong>å¢éåä½ä¼å</strong>ï¼å¥çº¦ä¼åå¼åæ¨¡å¼å¦ä½åå°è·¨å¢éæ²éææ¬</li>
<li>ð§ <strong>å®è·µè½å°è·¯å¾</strong>ï¼Pactç­å·¥å·å¨æç»­éæä¸­çéç½®ä¸æ§è¡ç­ç¥</li>
<li>ð° <strong>ææ¬æçåæ</strong>ï¼å¥çº¦æµè¯å¸¦æ¥çå¼åæçæåä¸ç¼ºé·é¢é²æ¶ç</li>
<li>ð <strong>å¹³æ»è¿ç§»æ¹æ¡</strong>ï¼ä»ä¼ ç»éææµè¯å°å¥çº¦æµè¯çæ¸è¿å¼è¿ç§»</li>
</ul>
<p><strong>ç¹å»å³æ³¨ï¼ææ¡å¾®æå¡åä½çæçæåä¹éï¼</strong></p>
<blockquote>
<p><strong>ä»æ¥è¡å¨å»ºè®®</strong>ï¼</p>
<ol>
<li>æ£æ¥ç°æé¡¹ç®çå®å¨å¤´é¨éç½®ï¼ç¡®ä¿å³é®å¤´é¨æ­£ç¡®è®¾ç½®</li>
<li>å¯¹éè¦æ¥å£æ·»å é²éæ¾æºå¶ï¼ç¹å«æ¯æ¯ä»ãç¶æåæ´ç­å³é®æä½</li>
<li>å»ºç«ä¾èµç»ä»¶æ¼æ´æ«ææµç¨ï¼éæå°CI/CDæµæ°´çº¿</li>
<li>å®¡æ¥æ°æ®å å¯æ¹æ¡ï¼ç¡®ä¿ææä¿¡æ¯å¾å°éå½ä¿æ¤</li>
</ol>
</blockquote>

</div>
<div id="MySignature" role="contentinfo">
    ä¸ªäººå¾®ä¿¡ï¼lpshiyue æ·»å æå·ï¼éçä¸ <br>
æ¬¢è¿æç´¢å³æ³¨å¾®ä¿¡å¬ä¼å·ï¼ åºç¡è¿é¶ï¼ç¬¬ä¸æ¶é´éè¯»ææ°æç« 
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 11:25">2026-01-14 11:24</span>&nbsp;
<a href="https://www.cnblogs.com/shiyuelp">åæåå</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19481124);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19481124', targetLink: 'https://www.cnblogs.com/shiyuelp/p/19481124', title: 'Webå®å¨æ¸åââXSSãCSRFãSQLæ³¨å¥ãé²éæ¾ä¸æææ°æ®ä¿æ¤çåå±ç­ç¥' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>