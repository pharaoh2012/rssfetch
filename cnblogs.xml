<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-10T04:31:24.991Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ uniapp+deepseekæµå¼aiå©ç|uniapp+vue3å¯¹æ¥deepseekä¸ç«¯Aié®ç­æ¨¡æ¿ ]]></title>
    <link>https://www.cnblogs.com/xiaoyan2017/p/19599014</link>
    <guid>856b875fc67e1280f2fd7ec7deed49d3</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/19599014" title="åå¸äº 2026-02-10 12:24">
    <span role="heading" aria-level="2">uniapp+deepseekæµå¼aiå©ç|uniapp+vue3å¯¹æ¥deepseekä¸ç«¯Aié®ç­æ¨¡æ¿</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><span style="font-size: 18px; font-family: å®ä½, &quot;Songti SC&quot;; color: rgba(58, 89, 196, 1)">2026éç£ç¬å<span style="background-color: rgba(204, 255, 255, 1)">uni-app+mphtmlæ¥å¥deepseek api</span><strong>è·¨ä¸ç«¯</strong>æµå¼æå­aièå¤©å¯¹è¯ç³»ç»ã</span></p>
<p><span style="font-size: 12px"><strong>uni-deepseek-ai</strong>ææ°æ¬¾2026è·¨ç«¯aiåºç¨<span style="background-color: rgba(255, 255, 153, 1)">uniapp+vue3+mp-html+markdownéædeepseek-v3.2</span>èå¤©å¯¹è¯æ¨¡åãæä¾<strong>æµè²+æ·±è²</strong>ä¸»é¢ãæ°å¢<span style="background-color: rgba(255, 204, 255, 1)">æ·±åº¦æèé¾ãkatexæ°å­¦å¬å¼ãä»£ç å¤å¶/é«äº®ãé¾æ¥/å¾çé¢è§</span>ï¼æ¯æè¿è¡å°<strong>H5+å°ç¨åºç«¯+APPç«¯</strong>ã</span></p>
<h3>ä¸ç«¯ææ</h3>
<p><span style="font-size: 12px">è¿è¡å°<strong>web+å°ç¨åºç«¯+å®åç«¯</strong>ææã</span></p>
<p><img alt="æªæ é¢-20" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210112032816-1055173519.png" class="lazyload"></p>
<h3>ä½¿ç¨ææ¯</h3>
<ul>
<li><span style="font-size: 12px">ç¼è¾å¨ï¼HbuilderX 4.87</span></li>
<li><span style="font-size: 12px">ææ¯æ¡æ¶ï¼uni-app+vue3+pinia2+vite5</span></li>
<li><span style="font-size: 12px">å¤§æ¨¡åæ¡æ¶ï¼DeepSeek-V3.2</span></li>
<li><span style="font-size: 12px">ç»ä»¶åºï¼uni-ui+uv-ui</span></li>
<li><span style="font-size: 12px">é«äº®æä»¶ï¼highlight.js</span></li>
<li><span style="font-size: 12px">markdownè§£æï¼ua-markdown+mp-html</span></li>
<li><span style="font-size: 12px">æ¬å°ç¼å­ï¼pinia-plugin-unistorage</span></li>
<li><span style="font-size: 12px">æ¯æç¼è¯ï¼Web+å°ç¨åº+APPç«¯</span></li>
</ul>
<p><img alt="æªæ é¢-18" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210112337388-402247900.png" class="lazyload"></p>
<p><img alt="p1-1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210112717547-74001188.gif" class="lazyload"></p>
<p><span style="font-size: 12px">uniapp-vue3-deepseekæ°å¢<strong>æ·±åº¦æèé¾</strong>ã<strong>latexæ°å­¦å¬å¼</strong>ã<strong>ä»£ç å¤å¶</strong>ï¼<strong>å¾çé¢è§</strong>ãæ¯æ<span style="background-color: rgba(255, 204, 153, 1)">h5+å°ç¨åº+appç«¯</span>ã</span></p>
<p><img alt="p2-3" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210113223243-1273198101.gif" class="lazyload"></p>
<h3>åè½ç¹æ§</h3>
<ol>
<li><span style="font-size: 12px">åºäºuni-app+vue3æ¥å¥deepseek apiå®ç°æµå¼æå­ææ</span></li>
<li><span style="font-size: 12px">æ¯æç¼è¯å°<strong>H5+å°ç¨åºç«¯+å®åAPP</strong></span></li>
<li><span style="font-size: 12px">æ°å¢<strong>æ·±åº¦æèé¾</strong></span></li>
<li><span style="font-size: 12px">æ°å¢<strong>æ¯ækatexæ°å­¦å¬å¼</strong></span></li>
<li><span style="font-size: 12px">æ¯æMermaidå¾è¡¨æ¸²æ(ä»H5ç«¯)</span></li>
<li><span style="font-size: 12px">æ¯æ<strong>ä»£ç åé¡¶é¨stickyç²æ§ãæ¨ªåæ»å¨ãè¡å·ãä»£ç å¤å¶</strong>åè½</span></li>
<li><span style="font-size: 12px">æ¯æåç§ä»£ç é«äº®/å¤å¶ä»£ç ãä¸ä¸æå¤è½®å¯¹è¯/æ¬å°ä¼è¯å­å¨</span></li>
<li><span style="font-size: 12px">æ¯æ<strong>é¾æ¥è·³è½¬ãå¾çé¢è§</strong>åè½</span></li>
<li><span style="font-size: 12px">ä¿®å¤å°ç¨åºç«¯è¡¨æ ¼è¾¹æ¡çº¿ååç±»æ ç­¾éæ©å¨æ ·å¼å¤±æ</span></li>
</ol>
<p><img alt="p3-1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210114103923-1782884002.gif" class="lazyload"></p>
<p><img alt="p3" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210114233090-890125790.gif" class="lazyload"></p>
<h3>é¡¹ç®ç»æç®å½</h3>
<p><span style="font-size: 12px">åºäº&nbsp;<span class="cnblogs_code">uni-app+vue3</span>&nbsp;æ­å»ºé¡¹ç®æ¨¡æ¿ï¼æ¥å¥ææ°ç&nbsp;<span class="cnblogs_code">deepseek-v3.<span style="color: rgba(128, 0, 128, 1)">2</span></span>&nbsp;å¤§æ¨¡åã</span></p>
<p><img alt="360æªå¾20260208115436883" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210114423916-997402291.png" class="lazyload"></p>
<p><img alt="app1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210114712217-851001040.gif" class="lazyload"></p>
<p><span style="font-size: 12px">å¦å¤æ¯æè¿è¡å°webç«¯ä»¥<strong>750pxæç</strong>å±ä¸­å¸å±ã</span></p>
<p><img alt="015360æªå¾20260207222454496" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210114944492-383061406.png" class="lazyload"></p>
<p><img alt="016360æªå¾20260207222615937" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210115007962-1172084387.png" class="lazyload"></p>
<p><img alt="017360æªå¾20260207225332423" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210115019949-1113234670.png" class="lazyload"></p>
<p><img alt="017360æªå¾20260207225332428" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210115039046-752784793.png" class="lazyload"></p>
<p><img alt="018360æªå¾20260207225701329" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210115050923-1344938919.png" class="lazyload"></p>
<h3>uni-appç¯å¢éç½®.env</h3>
<p><img alt="24112456b3805c692e370f295d7345b0_1289798-20250429123238198-208491377" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210115147282-482971435.png" class="lazyload"></p>
<p><span style="font-size: 12px">æ¿æ¢é¡¹ç®æ ¹ç®å½ä¸.envæä»¶éçkeyï¼å³å¯ä½éªè·¨ç«¯aiæµå¼å¯¹è¯ã</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)"># é¡¹ç®åç§°
VITE_APPNAME </span>= 'Uniapp-DeepSeek'<span style="color: rgba(0, 0, 0, 1)">

# è¿è¡ç«¯å£
VITE_PORT </span>= 5173<span style="color: rgba(0, 0, 0, 1)">

# DeepSeek APIéç½®
VITE_DEEPSEEK_API_KEY </span>=<span style="color: rgba(0, 0, 0, 1)"> æ¿æ¢ä¸ºä½ çAPIKey
VITE_DEEPSEEK_BASE_URL </span>= https:<span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">api.deepseek.com</span></pre>
</div>
<p><img alt="æªæ é¢-2" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210115354270-1711989573.png" class="lazyload"></p>
<p><img alt="æªæ é¢-16" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210115558243-1007427259.png" class="lazyload"></p>
<h3>é¡¹ç®å¸å±æ¨¡æ¿</h3>
<p><img alt="2eb609f0920c9a3d5842360719e6bad2_1289798-20250429123918114-670451265" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210115630289-736325316.png" class="lazyload"></p>
<p><img alt="35fe2a0acd5daa8220cb88ee3ef23b53_1289798-20250429124238620-248568351" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210115645394-1780095662.png" class="lazyload"></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">template</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
    <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">uv3-layout</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
        <span style="color: rgba(0, 128, 0, 1)">&lt;!--</span><span style="color: rgba(0, 128, 0, 1)"> å¯¼èªæ  </span><span style="color: rgba(0, 128, 0, 1)">--&gt;</span>
        <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">template </span><span style="color: rgba(255, 0, 0, 1)">#header</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
            <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">Toolbar </span><span style="color: rgba(255, 0, 0, 1)">:title</span><span style="color: rgba(0, 0, 255, 1)">="chatSession?.title"</span> <span style="color: rgba(0, 0, 255, 1)">/&gt;</span>
        <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">template</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
        
        <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">v-if</span><span style="color: rgba(0, 0, 255, 1)">="chatSession &amp;&amp; !isEmpty(chatSession.data)"</span><span style="color: rgba(255, 0, 0, 1)"> class</span><span style="color: rgba(0, 0, 255, 1)">="vu__chatview flexbox flex-col"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
            <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">scroll-view </span><span style="color: rgba(255, 0, 0, 1)">:scroll-into-view</span><span style="color: rgba(0, 0, 255, 1)">="scrollIntoView"</span><span style="color: rgba(255, 0, 0, 1)"> scroll-y</span><span style="color: rgba(0, 0, 255, 1)">="true"</span><span style="color: rgba(255, 0, 0, 1)"> @scrolltolower</span><span style="color: rgba(0, 0, 255, 1)">="onScrollToLower"</span><span style="color: rgba(255, 0, 0, 1)"> @scroll</span><span style="color: rgba(0, 0, 255, 1)">="onScroll"</span><span style="color: rgba(255, 0, 0, 1)"> style</span><span style="color: rgba(0, 0, 255, 1)">="height: 100%;"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="vu__chatbot"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span><span style="color: rgba(0, 0, 0, 1)">
                    ...
                </span><span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">id</span><span style="color: rgba(0, 0, 255, 1)">="scrollbottom-placeholder"</span><span style="color: rgba(255, 0, 0, 1)"> style</span><span style="color: rgba(0, 0, 255, 1)">="height: 1px;"</span><span style="color: rgba(0, 0, 255, 1)">&gt;&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
            <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">scroll-view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
            <span style="color: rgba(0, 128, 0, 1)">&lt;!--</span><span style="color: rgba(0, 128, 0, 1)"> æ»å¨å°åºé¨ </span><span style="color: rgba(0, 128, 0, 1)">--&gt;</span>
            <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="vu__scrollbottom"</span><span style="color: rgba(255, 0, 0, 1)"> @click</span><span style="color: rgba(0, 0, 255, 1)">="scrollToBottom"</span><span style="color: rgba(0, 0, 255, 1)">&gt;&lt;</span><span style="color: rgba(128, 0, 0, 1)">text </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="iconfont ai-arrD fw-700"</span><span style="color: rgba(0, 0, 255, 1)">&gt;&lt;/</span><span style="color: rgba(128, 0, 0, 1)">text</span><span style="color: rgba(0, 0, 255, 1)">&gt;&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
        <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
        <span style="color: rgba(0, 128, 0, 1)">&lt;!--</span><span style="color: rgba(0, 128, 0, 1)"> æ¬¢è¿ä¿¡æ¯ </span><span style="color: rgba(0, 128, 0, 1)">--&gt;</span>
        <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">v-else class</span><span style="color: rgba(0, 0, 255, 1)">="vu__welcomeinfo"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
            <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="intro flex-c flex-col"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="logo flex-c"</span><span style="color: rgba(255, 0, 0, 1)"> style</span><span style="color: rgba(0, 0, 255, 1)">="gap: 15px;"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                    <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="iconfont ai-deepseek"</span><span style="color: rgba(255, 0, 0, 1)"> style</span><span style="color: rgba(0, 0, 255, 1)">="font-size: 40px;"</span><span style="color: rgba(0, 0, 255, 1)">&gt;&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                    <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">text </span><span style="color: rgba(255, 0, 0, 1)">style</span><span style="color: rgba(0, 0, 255, 1)">="color: #999; font-size: 20px;"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>+<span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">text</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                    <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">image </span><span style="color: rgba(255, 0, 0, 1)">src</span><span style="color: rgba(0, 0, 255, 1)">="/static/uni.png"</span><span style="color: rgba(255, 0, 0, 1)"> mode</span><span style="color: rgba(0, 0, 255, 1)">="widthFix"</span><span style="color: rgba(255, 0, 0, 1)"> style</span><span style="color: rgba(0, 0, 255, 1)">="height: 30px; width: 30px;"</span> <span style="color: rgba(0, 0, 255, 1)">/&gt;</span>
                <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="name"</span><span style="color: rgba(0, 0, 255, 1)">&gt;&lt;</span><span style="color: rgba(128, 0, 0, 1)">text </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="txt text-gradient"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>å¿~ Uniapp-DeepSeek<span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">text</span><span style="color: rgba(0, 0, 255, 1)">&gt;&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="desc"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>æå¯ä»¥å¸®ä½ åä»£ç ãç­çè§£æãåä½åç§åæåå®¹ï¼è¯·æä½ çä»»å¡äº¤ç»æå§~<span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
            <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
            <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="prompt"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="tip flex-c"</span><span style="color: rgba(0, 0, 255, 1)">&gt;&lt;</span><span style="color: rgba(128, 0, 0, 1)">text </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="flex1"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>è¯è¯è¿æ ·é®<span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">text</span><span style="color: rgba(0, 0, 255, 1)">&gt;&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="flex-c"</span><span style="color: rgba(255, 0, 0, 1)"> @click</span><span style="color: rgba(0, 0, 255, 1)">="refreshPrompt"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>æ¢ä¸æ¢<span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">uni-icons </span><span style="color: rgba(255, 0, 0, 1)">type</span><span style="color: rgba(0, 0, 255, 1)">="refreshempty"</span><span style="color: rgba(255, 0, 0, 1)"> color</span><span style="color: rgba(0, 0, 255, 1)">="#999"</span><span style="color: rgba(255, 0, 0, 1)"> size</span><span style="color: rgba(0, 0, 255, 1)">="14"</span> <span style="color: rgba(0, 0, 255, 1)">/&gt;&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">v-for</span><span style="color: rgba(0, 0, 255, 1)">="(item,index) in promptList"</span><span style="color: rgba(255, 0, 0, 1)"> :key</span><span style="color: rgba(0, 0, 255, 1)">="index"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                    <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="option"</span><span style="color: rgba(255, 0, 0, 1)"> @click</span><span style="color: rgba(0, 0, 255, 1)">="changePrompt(item.prompt)"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>{{item.emoji}} {{item.prompt}} <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">text </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="arrow iconfont ai-arrR c-999"</span><span style="color: rgba(0, 0, 255, 1)">&gt;&lt;/</span><span style="color: rgba(128, 0, 0, 1)">text</span><span style="color: rgba(0, 0, 255, 1)">&gt;&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
            <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
        <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
        
        <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">template </span><span style="color: rgba(255, 0, 0, 1)">#footer</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
            <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">:style</span><span style="color: rgba(0, 0, 255, 1)">="{'padding-bottom': keyboardHeight + 'px'}"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
                <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">ChatEditor </span><span style="color: rgba(255, 0, 0, 1)">ref</span><span style="color: rgba(0, 0, 255, 1)">="editorRef"</span><span style="color: rgba(255, 0, 0, 1)"> v-model</span><span style="color: rgba(0, 0, 255, 1)">="promptValue"</span><span style="color: rgba(255, 0, 0, 1)"> :scrollBottom</span><span style="color: rgba(0, 0, 255, 1)">="scrollToBottom"</span> <span style="color: rgba(0, 0, 255, 1)">/&gt;</span>
            <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
        <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">template</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
    <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">uv3-layout</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
<span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">template</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span></pre>
</div>
<p><img alt="p2" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210120034812-898587876.gif" class="lazyload"></p>
<h3>uni-app+vue3æ¸²æmarkdown</h3>
<p><span style="font-size: 12px">ç±äºrich-textç»ä»¶å¯¹å°ç¨åºæä¸äºéå¶ï¼æ¹ä¸ºä½¿ç¨mphtmlåmarkdown-itç»ä»¶è§£ææ ç­¾ç»æãäº²æµå®ç¾æ¯æå¨H5ç«¯+å°ç¨åºç«¯+Appç«¯æµå¼ã</span></p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210120219009-536359625.png" class="lazyload"></p>
<p><span style="font-size: 12px">ä¿®å¤å¾®ä¿¡å°ç¨åºéä¸äºå¸¸ç¨æ ç­¾tableãh1-h6 hr...ï¼å¯¼è´æ ·å¼ä¼å¤±æé®é¢ã</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">template</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
    <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">view </span><span style="color: rgba(255, 0, 0, 1)">class</span><span style="color: rgba(0, 0, 255, 1)">="ua__markdown"</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
        <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">mp-html </span><span style="color: rgba(255, 0, 0, 1)">:content</span><span style="color: rgba(0, 0, 255, 1)">="parseNodes"</span><span style="color: rgba(255, 0, 0, 1)"> @linktap</span><span style="color: rgba(0, 0, 255, 1)">="handleLinkTap"</span> <span style="color: rgba(0, 0, 255, 1)">/&gt;</span>
    <span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">view</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
<span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">template</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span></pre>
</div>
<div class="cnblogs_code">
<pre>const props =<span style="color: rgba(0, 0, 0, 1)"> defineProps({
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è§£æåå®¹</span>
<span style="color: rgba(0, 0, 0, 1)">    source: String,
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¯å¦æ¾ç¤ºä»£ç åè¡å·(å³é­åæ§è½æ´ä¼)</span>
    showLine: { type: [Boolean, String], <span style="color: rgba(0, 0, 255, 1)">default</span>: <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¼å¯katex</span>
    katex: { type: Boolean, <span style="color: rgba(0, 0, 255, 1)">default</span>: <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> markdown-itæä»¶éç½®</span>
<span style="color: rgba(0, 0, 0, 1)">    plugins: {
        type: Array,
        </span><span style="color: rgba(0, 0, 255, 1)">default</span>: () =&gt;<span style="color: rgba(0, 0, 0, 1)"> []
    },
})</span></pre>
</div>
<p><img alt="æªæ é¢-12-xcx5" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210120727386-643460046.png" class="lazyload"></p>
<p><img alt="æªæ é¢-12-xcx4" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210120818946-1712495072.png" class="lazyload"></p>
<p><img alt="001360æªå¾20260207200011564" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210120909192-1548746293.png" class="lazyload"></p>
<p><img alt="002360æªå¾20260207201444787" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210120929821-170934542.png" class="lazyload"></p>
<p><img alt="003360æªå¾20260207202307274" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210120943499-2027058649.png" class="lazyload"></p>
<p><img alt="002360æªå¾20260207201208323" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210121005430-776561073.png" class="lazyload"></p>
<p><img alt="010360æªå¾20260207220254777" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210121027543-1454844381.png" class="lazyload"></p>
<p><img alt="006360æªå¾20260207205035354" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210121051915-210582217.png" class="lazyload"></p>
<p><img alt="004360æªå¾20260207203358426" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210121118030-2107414688.png" class="lazyload"></p>
<p><img alt="007360æªå¾20260207211345929" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210121135981-682529484.png" class="lazyload"></p>
<p><img alt="007360æªå¾20260207210726233" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210121156196-1117785471.png" class="lazyload"></p>
<p><img alt="009360æªå¾20260207213420201" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210121219745-827341110.png" class="lazyload"></p>
<p><img alt="011360æªå¾20260207221118535" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210121235004-465808560.png" class="lazyload"></p>
<p><img alt="012360æªå¾20260207221217703" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210121251462-1955732457.png" class="lazyload"></p>
<p><img alt="018360æªå¾20260207225745055" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210121317708-2080056926.png" class="lazyload"></p>
<h3>uni-app+deepseekæµå¼sseæå­ææ</h3>
<p><span style="font-size: 12px">å°ç¨åºç«¯ä½¿ç¨uni.requestå¼å¯&nbsp;<span class="cnblogs_code">enableChunked</span>&nbsp;å®ç°æµå¼ï¼H5åAppç«¯éç¨<strong>renderjs</strong>æ¹å¼fetchæ¥å®ç°æµå¼åè½ã</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> H5åAPPç«¯è°ç¨renderjséçfetch</span><span style="color: rgba(0, 128, 0, 1)">
//</span><span style="color: rgba(0, 128, 0, 1)"> #ifdef APP-PLUS || H5</span>
<span style="color: rgba(0, 0, 255, 1)">this</span><span style="color: rgba(0, 0, 0, 1)">.fetchAppH5({
    url: baseURL</span>+'/v1/chat/completions'<span style="color: rgba(0, 0, 0, 1)">,
    method: </span>'POST'<span style="color: rgba(0, 0, 0, 1)">,
    headers: {
        </span>"Content-Type": "application/json"<span style="color: rgba(0, 0, 0, 1)">,
        </span>"Authorization"<span style="color: rgba(0, 0, 0, 1)">: `Bearer ${apiKEY}`,
    },
    body: {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¤è½®ä¼è¯</span>
        messages: <span style="color: rgba(0, 0, 255, 1)">this</span>.multiConversation ? <span style="color: rgba(0, 0, 255, 1)">this</span>.historySession : [{role: 'user'<span style="color: rgba(0, 0, 0, 1)">, content: editorValue}],
        model: </span><span style="color: rgba(0, 0, 255, 1)">this</span>.chatState.thinkingEnabled ? 'deepseek-reasoner' : 'deepseek-chat', <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> deepseek-chatå¯¹è¯æ¨¡å deepseek-reasoneræ¨çæ¨¡å</span>
        stream: <span style="color: rgba(0, 0, 255, 1)">true</span>, <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æµå¼è¾åº</span>
        max_tokens: 8192, <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éå¶ä¸æ¬¡è¯·æ±ä¸­æ¨¡åçæ completion çæå¤§ token æ°(é»è®¤ä½¿ç¨ 4096)</span>
        temperature: 0.4, <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä¸¥è°¨éæ · è¶ä½è¶ä¸¥è°¨(é»è®¤1)</span>
<span style="color: rgba(0, 0, 0, 1)">    }
})
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> #endif</span></pre>
</div>
<p><strong><span style="font-size: 12px">å°ç¨åºç«¯sse</span></strong></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> #ifdef MP-WEIXIN</span>
<span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)"> {
    </span><span style="color: rgba(0, 0, 255, 1)">this</span>.loading = <span style="color: rgba(0, 0, 255, 1)">true</span>
    <span style="color: rgba(0, 0, 255, 1)">this</span>.answerText = ''
    <span style="color: rgba(0, 0, 255, 1)">this</span>.reasoningText = ''
    <span style="color: rgba(0, 0, 255, 1)">this</span>.lastUpdate = 0
    
    <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åèµ·æ°è¯·æ±åç»æ­¢æ§è¯·æ±</span>
    const requestTask =<span style="color: rgba(0, 0, 0, 1)"> await uni.request({
        url: baseURL</span>+'/v1/chat/completions'<span style="color: rgba(0, 0, 0, 1)">,
        method: </span>'POST'<span style="color: rgba(0, 0, 0, 1)">,
        header: {
            </span>"Content-Type": "application/json"<span style="color: rgba(0, 0, 0, 1)">,
            </span>"Authorization"<span style="color: rgba(0, 0, 0, 1)">: `Bearer ${apiKEY}`,
        },
        data: {
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¤è½®ä¼è¯</span>
            messages: <span style="color: rgba(0, 0, 255, 1)">this</span>.multiConversation ? <span style="color: rgba(0, 0, 255, 1)">this</span>.historySession : [{role: 'user'<span style="color: rgba(0, 0, 0, 1)">, content: editorValue}],
            model: </span><span style="color: rgba(0, 0, 255, 1)">this</span>.chatState.thinkingEnabled ? 'deepseek-reasoner' : 'deepseek-chat'<span style="color: rgba(0, 0, 0, 1)">,
            stream: </span><span style="color: rgba(0, 0, 255, 1)">true</span>, <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æµå¼è¾åº</span>
            max_tokens: 8192, <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éå¶ä¸æ¬¡è¯·æ±ä¸­æ¨¡åçæ completion çæå¤§ token æ°(é»è®¤ä½¿ç¨ 4096)</span>
            temperature: 0.4, <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä¸¥è°¨éæ · è¶ä½è¶ä¸¥è°¨(é»è®¤1)</span>
<span style="color: rgba(0, 0, 0, 1)">        },
        enableChunked: </span><span style="color: rgba(0, 0, 255, 1)">true</span>, <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">å¼å¯ååä¼ è¾ transfer-encoding chunked</span>
        success: (res) =&gt;<span style="color: rgba(0, 0, 0, 1)"> {
            const { statusCode } </span>=<span style="color: rgba(0, 0, 0, 1)">  res
            </span><span style="color: rgba(0, 0, 255, 1)">if</span> (statusCode !== 200<span style="color: rgba(0, 0, 0, 1)">) {
                </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå¨å¤çéè¯¯ç </span>
                console.error('è¯·æ±å¤±è´¥ï¼ç¶æç :'<span style="color: rgba(0, 0, 0, 1)">, statusCode)
                </span><span style="color: rgba(0, 0, 255, 1)">this</span>.loading = <span style="color: rgba(0, 0, 255, 1)">false</span>
                <span style="color: rgba(0, 0, 255, 1)">this</span>.answerText = ''
                <span style="color: rgba(0, 0, 255, 1)">this</span>.reasoningText = ''<span style="color: rgba(0, 0, 0, 1)">
                uni.showToast({
                    title: errorMsgCode[statusCode],
                    icon: </span>'none'<span style="color: rgba(0, 0, 0, 1)">
                })
                </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)">
            }
            console.log(</span>'request success'<span style="color: rgba(0, 0, 0, 1)">, res)
        },
        fail: (error) </span>=&gt;<span style="color: rgba(0, 0, 0, 1)"> {
            console.log(</span>'request fail'<span style="color: rgba(0, 0, 0, 1)">, error)
            </span><span style="color: rgba(0, 0, 255, 1)">this</span>.loading = <span style="color: rgba(0, 0, 255, 1)">false</span>
            <span style="color: rgba(0, 0, 255, 1)">this</span>.answerText = ''
            <span style="color: rgba(0, 0, 255, 1)">this</span>.reasoningText = ''<span style="color: rgba(0, 0, 0, 1)">
            uni.showToast({
                title: error.errMsg,
                icon: </span>'none'<span style="color: rgba(0, 0, 0, 1)">
            })
        }
    })
    requestTask.onChunkReceived((res) </span>=&gt;<span style="color: rgba(0, 0, 0, 1)"> {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> console.log('Received chunk', res)</span>
        
        <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ...</span>
<span style="color: rgba(0, 0, 0, 1)">    })
} </span><span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (error) {
    </span><span style="color: rgba(0, 0, 255, 1)">this</span>.loading = <span style="color: rgba(0, 0, 255, 1)">false</span>
    <span style="color: rgba(0, 0, 255, 1)">this</span>.chatState.updateSession(<span style="color: rgba(0, 0, 255, 1)">this</span>.botKey, {loading: <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">})
    </span><span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> Error(`request error: ${error.message || 'è¯·æ±å¼å¸¸'<span style="color: rgba(0, 0, 0, 1)">}`)
}
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> #endif</span></pre>
</div>
<p><img alt="æªæ é¢-19" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202602/1289798-20260210121830119-1859169974.png" class="lazyload"></p>
<p>ç»¼ä¸å°±æ¯Uniapp+Vue3å¯¹æ¥DeepSeek Apiæ­å»ºè·¨ä¸ç«¯æµå¼aiçä¸äºé¡¹ç®åäº«ï¼æè°¢éè¯»ä¸æ¯æï¼</p>
<p><strong>éä¸å ä¸ªææ°å®æé¡¹ç®</strong></p>
<blockquote>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/19440082" target="_blank">Vite7+DeepSeekç½é¡µçAiå©æ|vue3+arcoç½é¡µwebæµå¼çæaièå¤©é®ç­ç³»ç»</a></span></p>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/19474565">electron39-vue3aiçµèç«¯AIæ¨¡æ¿|electron39+deepseek+vite7èå¤©aiåºç¨</a></span></p>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/19385909" target="_blank">vite7+deepseekæµå¼aiæ¨¡æ¿|vue3.5+deepseek3.2+markdownæå­è¾åºaiå©æ</a></span></p>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/19136187" target="_blank">Electron38-Vue3OSå®¢æ·ç«¯OSç³»ç»|vite7+electron38+arcoæ¡é¢osåå°ç®¡ç</a></span></p>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/19116145" target="_blank">electron38-adminæ¡é¢ç«¯åå°|Electron38+Vue3+ElementPlusç®¡çç³»ç»</a></span></p>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/19088804" target="_blank">Electron38-Wechatçµèç«¯èå¤©|vite7+electron38ä»¿å¾®ä¿¡æ¡é¢ç«¯èå¤©ç³»ç»</a></span></p>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/19313982" target="_blank">ææ°çFlutter3.38+Dart3.10ä»¿åæé³APPç´æ­+ç­è§é¢+èå¤©åºç¨ç¨åº</a></span></p>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/18894117" target="_blank">flutter3-deepseekæµå¼AIæ¨¡æ¿|Flutter3.27+Dio+DeepSeeekèå¤©aiå©æ</a></span></p>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/18962574" target="_blank">ææ°çuniapp+vue3+uv-uiè·¨ä¸ç«¯ç­è§é¢+ç´æ­+èå¤©ãH5+å°ç¨åº+Appç«¯ã</a></span></p>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/19031695" target="_blank">ææ°çuni-app+vue3+uv-uiè·¨ä¸ç«¯ä»¿å¾®ä¿¡appèå¤©åºç¨ãh5+å°ç¨åº+appç«¯ã</a></span></p>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/19018641" target="_blank">Flutter3-MacOSæ¡é¢OSç³»ç»|flutter3.32+window_managerå®¢æ·ç«¯OSæ¨¡æ¿</a></span></p>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/19181509" target="_blank">Tauri2-Vite7Adminå®¢æ·ç«¯ç®¡çåå°|tauri2.9+vue3+element-plusåå°ç³»ç»</a></span></p>
<p><span style="font-size: 12px"><a class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoyan2017/p/19235565" target="_blank">Tauri2.9+Vue3æ¡é¢çOSç³»ç»|vite7+tauri2+arcoDesignçµèç«¯osåå°æ¨¡æ¿</a></span></p>
</blockquote>
<p><img alt="s13.sinaimg" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1289798/202511/1289798-20251107235037424-153089694.gif" class="lazyload"></p>
<p>&nbsp;</p>

</div>
<div id="MySignature" role="contentinfo">
    æ¬æä¸ºåä¸»ååæç« ï¼æªç»åä¸»åè®¸ä¸å¾è½¬è½½ï¼æ¬¢è¿å¤§å®¶ä¸èµ·äº¤æµ QQï¼282310962ï¼ wxï¼xy190310ï¼
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-10 12:24">2026-02-10 12:24</span>&nbsp;
<a href="https://www.cnblogs.com/xiaoyan2017">xiaoyan2017</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19599014);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19599014', targetLink: 'https://www.cnblogs.com/xiaoyan2017/p/19599014', title: 'uniapp+deepseekæµå¼aiå©ç|uniapp+vue3å¯¹æ¥deepseekä¸ç«¯Aié®ç­æ¨¡æ¿' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ è§£å Pythonï¼å³äºæéãGIL ä¸å¼æ­¥åæ ¸ ]]></title>
    <link>https://www.cnblogs.com/kaiux/p/19598962</link>
    <guid>a25c11cf45795bc42947d9f00f5f1b04</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/kaiux/p/19598962" title="åå¸äº 2026-02-10 12:01">
    <span role="heading" aria-level="2">è§£å Pythonï¼å³äºæéãGIL ä¸å¼æ­¥åæ ¸</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/1158182/202602/1158182-20260210120046308-982867969.png" alt="è§£å Pythonï¼å³äºæéãGIL ä¸å¼æ­¥åæ ¸" class="desc_img">
        æ¬æä»¥ C++ ç³»ç»è§è§ï¼è§£æ Python çåºå±åçãæ·±åº¦åæ `PyObject` åå­å¸å±ãGIL çåå­æ§å¹»è§å `asyncio` ç epoll æ¬è´¨ãéè¿ C++ æ©å±æç ´è¾¹çï¼æ­ç¤ºâè¶æ°´è¯­è¨âå¦ä½éè¿çºç²åæ ¸è®¡ç®ï¼æ¢åæè´çè°åº¦æçä¸çæåæ­ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p><img src="https://img2024.cnblogs.com/blog/1158182/202602/1158182-20260210120115327-1286094950.jpg" alt="python_overview" loading="lazy"></p>
<h2 id="1-ai-æ¶ä»£çæ°å­è¶æ°´-the-necessity-in-ai-era">1. AI æ¶ä»£çâæ°å­è¶æ°´â (The Necessity in AI Era)</h2>
<h3 id="11-çæä½çåæ­ä½ä¸º-c-çé«å±æä»¤æé-ip">1.1. çæä½çåæ­ï¼ä½ä¸º C++ çé«å±æä»¤æé (IP)</h3>
<p>ä»»ä½å¯¹è®¡ç®æºä½ç³»ç»ææè®¤ç¥çå¼åèé½æ¸æ¥ï¼Python çåçæ§è½æ¯ç¾é¾çº§çãå®æ¬è´¨ä¸æ¯ä¸ä¸ªåºäºæ çèææºï¼æ¯ä¸ä¸ªæ´æ°å æ³ (<code>a + b</code>) é½è¦ç»åç±»åæ£æ¥ãå¼ç¨è®¡æ°æ´æ° (<code>Py_INCREF/DECREF</code>) åå·¨å¤§çåæ´¾å¼éãå¦æä½ è¯å¾ç¨çº¯ Python å»åç©éµä¹æ³ï¼CPU çåæ¯é¢æµåå (Branch Predictor) ä¼è¢«ä½ æä¹±æ ç« çæä»¤æµæå¾ä¸å¡ç³æ¶ï¼L1/L2 Cache ä¹ä¼å ä¸ºæ£è½å¨å ä¸ç <code>PyObject</code> èé¢ç¹å¤±æã</p>
<p><strong>ç¶èï¼AI ä¸éè¦ Python å»åè®¡ç®ï¼AI åªéè¦ Python å»âä¸ä»¤âã</strong></p>
<p>å¨ PyTorch æ TensorFlow çæ¶æä¸­ï¼Python ä»£ç æ®æ¼çè§è²å®éä¸æ¯<strong>æ§å¶å¹³é¢ (Control Plane)</strong>ï¼è C++/CUDA ææ¯<strong>æ°æ®å¹³é¢ (Data Plane)</strong>ãå½ä½ åä¸ <code>z = torch.matmul(x, y)</code> æ¶ï¼Python è§£éå¨æåçä»ä»æ¯æå»ºè®¡ç®å¾ãè¿è¡åæ°æ ¡éªï¼ç¶åå°æä»¤æéï¼Instruction Pointerï¼çæ§å¶æéè¿ C ABI (Application Binary Interface) ç§»äº¤ç»åºå±ç C++ å¨æåºã</p>
<p>ä¸æ¦è¿å¥åºå±ï¼SIMD æä»¤éãAVX-512 çè³ GPU ç Tensor Cores ä¾¿æ¥ç®¡äºä¸åãæ­¤æ¶ï¼Python çé£ç¹è§£éå¨å¼éå¨èæ¶æ°æ¯«ç§çè³æ°ç§çç©éµè¿ç®é¢åï¼å®å¨å¯ä»¥å¿½ç¥ä¸è®¡ï¼Amdahl's Law çåååºç¨ï¼ã</p>
<p><strong>Trade-off åæï¼</strong></p>
<ul>
<li><strong>çºç²ï¼</strong> åçº¿ç¨æ éè®¡ç®æ§è½ï¼ææ¢ï¼ã</li>
<li><strong>æ¢åï¼</strong> æè´ç C/C++ äºæä½æ§ãPython æ¯å¯ä¸ä¸ä¸ªè½è®© C++ å¼åèæå°âåæ¯å¨åä¼ªä»£ç ï¼ä½è½æ ç¼è°ç¨ <code>.so</code> åºâçè¯­è¨ãå®æ¯ AI åºç¡è®¾æ½ï¼C++ï¼ä¸ä¸å¡é»è¾ï¼Human Logicï¼ä¹é´æèçâè¶æ°´å±âã</li>
</ul>
<p>è¿ç§åå±æ¶æçè³å¯¼è´äº AI åºç¡è®¾æ½çè¿ä¸æ­¥ä¸æ²ãä¸ºäºé¿å Python å¨æ°æ®é¢å¤çï¼å¦ TokenizerãImage Decodeï¼é¶æ®µæä¸ºç¶é¢ï¼ç°å¨çè¶å¿æ¯å°æ´ä¸ªæ°æ®å è½½ç®¡çº¿ï¼DataLoaderï¼ä¹ä¸æ²å° C++ æ Rust ä¸­ï¼ä¾å¦ NVIDIA DALI æ HuggingFace Tokenizersï¼ãPython éæ¸éåä¸ºçº¯ç²¹çéç½®è¯­è¨åè¶æ°´å±ã</p>
<h3 id="12-ä»è®¡ç®å°ååio-å¯éåçèå©">1.2. ä»è®¡ç®å°ååï¼IO å¯éåçèå©</h3>
<p>å¨ä¼ ç»çé«æ§è½è®¡ç® (HPC) æ¶ä»£ï¼æä»¬ä¸ºäºåå°çº³ç§çº§çå»¶è¿ï¼ä¸ææåæ±ç¼ä¼åä¸ä¸æåæ¢ (Context Switch)ãä½å¨ LLM é©±å¨ç Agent æ¶ä»£ï¼ç¶é¢åçäºè´¨çè½¬ç§»ã</p>
<p>ä¸ä¸ªå¸åç RAG (Retrieval-Augmented Generation) æµç¨æ ChatBI ç³»ç»ï¼å¶ 90% ççå½å¨æå¤äº <strong>Wait ç¶æ</strong>ï¼</p>
<ol>
<li>ç­å¾åéæ°æ®åºæ£ç´¢ (Network I/O)ã</li>
<li>ç­å¾ LLM API Token çæ (Network I/O)ã</li>
<li>ç­å¾æ°æ®åº SQL æ§è¡ç»æ (Network I/O)ã</li>
</ol>
<p>æ­¤æ¶ï¼CPU å¹¶ä¸æ¯å¨è®¡ç®ï¼èæ¯å¨æèµ·ãå¦æä½¿ç¨ C++ï¼ä½ éè¦å¤çå¤æç <code>epoll</code>ãåè°å°ç±æèåç¨åºï¼å¦ <code>boost::asio</code> æ C++20 coroutinesï¼ï¼å¼åææ¬æé«ã</p>
<p>Python å¨è¿éçä¼å¿å¨äºå¶<strong>æ½è±¡ææ¬æä½</strong>ãè½ç¶ Python ç GIL (Global Interpreter Lock) è­åæ­èï¼ä½å¨ IO å¯éååºæ¯ä¸ï¼OS ççº¿ç¨è°åº¦å¨æè Python ç <code>asyncio</code> äºä»¶å¾ªç¯ï¼Event Loopï¼è½å¾å¥½å°æ©ç CPU çç©ºé²ãæä»¬ä¸åå³æ³¨ TLB (Translation Lookaside Buffer) çå·æ°å¼éï¼èæ¯å³æ³¨å¦ä½ç¨æå°çä»£ç è¡æ°ï¼ç¼ææå¤æç API è°ç¨é¾è·¯ã</p>
<h3 id="13-ä»£ç å®ç°">1.3. ä»£ç å®ç°</h3>
<h4 id="131-åºæ¯ä¸æµå¼å¤çä¸åå­åå¥½-the-generator">1.3.1. åºæ¯ä¸ï¼æµå¼å¤çä¸åå­åå¥½ (The Generator)</h4>
<p>å¨ C++ ä¸­ï¼ä¸ºäºé¿åä¸æ¬¡æ§å è½½ 10GB çæ¥å¿æä»¶å¯¼è´ OOM (Out of Memory)ï¼æä»¬éè¦æå Buffer ç®¡çåè¿­ä»£å¨ãå¨ Python ä¸­ï¼<code>yield</code> å³é®å­æ¬è´¨ä¸æ¯ä¸ä¸ª<strong>ç¨æ·æçæ å¸§æèµ· (Stack Frame Suspension)</strong>ãå®åè®¸å½æ°å¨ä¿æå±é¨åéç¶æçæåµä¸æåæ§è¡ï¼å°æ§å¶æäº¤è¿ç»è°ç¨èï¼è¿æ¯ä¸ç§æå¶å»ä»·çâä¸ä¸æåæ¢âã</p>
<pre><code class="language-python">import time
import os

def raw_log_streamer(file_path: str, block_size: int = 4096):
    """
    æ¨¡æ C++ ç Buffered Readerã
    ä¸ä¸æ¬¡æ§è¯»åæ´ä¸ªæä»¶ï¼èæ¯å©ç¨ Generator æºå¶
    å¨ç¨æ·ææèµ·æ å¸§ï¼å®ç° Lazy Loadingã
    """
    # è¿éç file_obj å®éä¸æ¯å¯¹åºå±æä»¶æè¿°ç¬¦ (fd) çå°è£
    with open(file_path, 'rb') as f:
        while True:
            # è§¦å syscall: read()
            chunk = f.read(block_size)
            if not chunk:
                break
            # æ­¤æ¶å½æ°ç Stack Frame è¢«å»ç»ï¼
            # æä»¤æé IP æåä¸ä¸è¡ï¼å±é¨åéä¿çå¨å åå­ç PyFrameObject ä¸­
            yield chunk 

# ä½¿ç¨åºæ¯ï¼å¤çå·¨å¤§çæ°æ®éèä¸ç¸æ RAM
# è¿ç§åæ³å¨å¤ç AI æ°æ® Pipeline (å¦ DataLoader) æ¶æ¯æ åèå¼
# for data in raw_log_streamer("large_dataset.bin"):
#     process(data)

</code></pre>
<h4 id="132-åºæ¯äºåæ ¸æåæ¢-vs-ç¨æ·æè°åº¦-threading-vs-asyncio">1.3.2. åºæ¯äºï¼åæ ¸æåæ¢ vs ç¨æ·æè°åº¦ (Threading vs Asyncio)</h4>
<p>ä½ä¸ºç³»ç»å¼åèï¼ä½ å¿é¡»æç½ <code>threading</code> å <code>asyncio</code> çæ¬è´¨åºå«ï¼</p>
<ul>
<li><strong>Threading:</strong> æ å°å° OS çåççº¿ç¨ (pthreads)ãåæ¢éè¦åæ ¸ä»å¥ (Kernel Trap)ï¼æ¶åå¯å­å¨ä¿å­ãTLB å·æ°ï¼å¼éæè´µãä¸åå¶äº GILï¼Python å¤çº¿ç¨æ æ³å©ç¨å¤æ ¸ã</li>
<li><strong>Asyncio:</strong> åçº¿ç¨åçäºä»¶å¾ªç¯ãåæ¢åªæ¯ç®åçå½æ°æéè·³è½¬ (User-space switching)ï¼ <strong>é¶åæ ¸ä¸ä¸æåæ¢å¼é (Zero Kernel Context Switch Overhead)</strong>ã<em>(æ³¨ï¼è½ç¶é¿åäºæè´µç syscallï¼ä½ Python è§£éå¨æ¬èº«çå­èç åæ´¾ä¾ç¶æææ¬ï¼ä½å¨é«å¹¶å IO é¢åï¼è¿éå¸¸æ¯åç®çã)</em></li>
</ul>
<p>ä»¥ä¸ä»£ç ç´è§å±ç¤ºäºå¨ IO å¯éåä»»å¡ä¸­ï¼ä¸ºä»ä¹æä»¬éè¦ä»âçº¿ç¨æç»´âè½¬åâåç¨æç»´âã</p>
<pre><code class="language-python">import threading
import asyncio
import time

# æ¨¡æä¸ä¸ªé«å»¶è¿ç IO æä½ (ä¾å¦ç­å¾ LLM è¿å token)
# å¨ C++ è§è§ï¼è¿å°±æ¯ä¸ä¸ªå¯¼è´å½åçº¿ç¨è¢«æèµ·å° Wait Queue çæä½
IO_DELAY = 1.0 
TASK_COUNT = 50

def heavy_io_task_sync(idx):
    # é»å¡å¼ IOï¼çº¿ç¨è¢« OS æèµ·
    time.sleep(IO_DELAY) 

async def heavy_io_task_async(idx):
    # éé»å¡ IOï¼æ§å¶æäº¤è¿ç» Event Loopï¼
    # ä»ä»æ¯å¨ epoll/kqueue æ³¨åäºä¸ä¸ªäºä»¶
    await asyncio.sleep(IO_DELAY)

def run_threading():
    start = time.perf_counter()
    threads = []
    for i in range(TASK_COUNT):
        t = threading.Thread(target=heavy_io_task_sync, args=(i,))
        t.start()
        threads.append(t)
    
    for t in threads:
        t.join()
    print(f"[Threading] Completed {TASK_COUNT} tasks in {time.perf_counter() - start:.4f}s")
    # ä»£ä»·ï¼åå»ºäº 50 ä¸ª OS çº¿ç¨ï¼ä¸ä¸æåæ¢å¼éå¤§ï¼åå­å ç¨é« (æ¯ä¸ªçº¿ç¨é»è®¤æ å¤§å° ~8MB)

async def run_asyncio():
    start = time.perf_counter()
    tasks = [heavy_io_task_async(i) for i in range(TASK_COUNT)]
    # ææçä»»å¡å¨ä¸ä¸ª OS çº¿ç¨åå®æï¼æ åæ ¸æåæ¢
    await asyncio.gather(*tasks)
    print(f"[Asyncio]   Completed {TASK_COUNT} tasks in {time.perf_counter() - start:.4f}s")

if __name__ == "__main__":
    print(f"--- Benchmarking IO Concurrency (Tasks: {TASK_COUNT}) ---")
    run_threading()
    asyncio.run(run_asyncio())

"""
é¢æè¾åºç»æ (Trade-off æ¾èæè§):
--- Benchmarking IO Concurrency (Tasks: 50) ---
[Threading] Completed 50 tasks in 1.0xxx s (å ä¸æ¾èççº¿ç¨åå»ºåè°åº¦å¼é)
[Asyncio]   Completed 50 tasks in 1.00xx s (å ä¹ä»åéäºææ¢çé£ä¸ª IO)
"""

</code></pre>
<h3 id="14-æ»ç»">1.4. æ»ç»</h3>
<p>Python ä¸å¿«ï¼ä½å®è®©âå¿«âåå¾å®¹æè®¿é®ãæ¥ä¸æ¥æä»¬å°æ·±å¥æ¢è®¨ Python åå­ç®¡ççè³ææ¶å»ï¼ <strong>å¼ç¨è®¡æ°æºå¶ (Reference Counting) ä¸åå¾åæ¶ (GC) çä»£éåè¯´</strong>ï¼å¹¶åæä¸ºä½å¨æäºé«æ§è½åºæ¯ä¸ï¼æä»¬éè¦æå¨å¹²é¢è¿ä¸æºå¶ä»¥é¿å "Stop-the-World"ã</p>
<h2 id="2-åè®®å±æ¾å¼çæ§å¶-explicit-resource-management">2. åè®®å±ââæ¾å¼çæ§å¶ (Explicit Resource Management)</h2>
<p>å¦æè¯´ C++ çå²å­¦æ¯âä½ æ²¡æè°ç¨çä¸è¥¿å°±ä¸éè¦ä»åºä»£ä»·âï¼é£ä¹ Python çå²å­¦åæ¯âä¸ºäºå¼åæçï¼ä½ å¿é¡»æ¥åè¿è¡æ¶å¼éâãå¨èµæºç®¡çåæ§å¶æµè¿ä¸å±ï¼è¿ç§ Trade-off è¡¨ç°å¾æ·æ¼å°½è´ã</p>
<h3 id="21-raii-ç-python-æ å°ä»éå¼ææå°æ¾å¼ä¸ä¸æ">2.1. RAII ç Python æ å°ï¼ä»éå¼ææå°æ¾å¼ä¸ä¸æ</h3>
<p>å¨ C++ ä¸­ï¼RAII (Resource Acquisition Is Initialization) æ¯èµæºç®¡ççé»éæ³åãæä»¬ä¾èµæ å¯¹è±¡çç¡®å®æ§çå½å¨æï¼å½ <code>std::lock_guard</code> ç¦»å¼ä½ç¨åæ¶ï¼ææå½æ° <code>~lock_guard()</code> ä¼èªå¨éæ¾äºæ¥éãè¿ä¸åé½åçå¨ç¼è¯æç¡®å®çæ±ç¼æä»¤ä¸­ï¼é¶è¿è¡æ¶å¼éã</p>
<p>ä½å¨ Python ä¸­ï¼ä½ é¢å¯¹çæ¯ä¸ä¸ªå¸¦ GC çè¿è¡æ¶ã<strong>å¯¹è±¡ççå½å¨æä¸ä½ç¨åæ¯è§£è¦ç</strong>ã<br>
å½ä½ åä¸ <code>f = open("file.txt")</code> åï¼å³ä½¿å½æ°è¿åï¼<code>f</code> æåç <code>PyObject</code> ä¹å¯è½å ä¸ºå¼ç¨è®¡æ°æªå½é¶ï¼ä¾å¦è¢«é­åæè·ï¼ææ¯å¤äºå¾ªç¯å¼ç¨ä¸­ç­å¾ GC æ«æï¼èè¿è¿ä¸è°ç¨ <code>__del__</code>ã</p>
<p><strong>åºå±ççç¸ï¼</strong> ä¾èµ <code>__del__</code> ç®¡çæä»¶å¥æææ°æ®åºè¿æ¥æ¯ç³»ç»ç¼ç¨ä¸­çèªæè¡ä¸ºãä½ æ æ³é¢æµ GC ä½æ¶åçï¼Stop-the-Worldï¼ï¼è¿æå³çä½ çæä»¶æè¿°ç¬¦ (fd) å¯è½ä¼è¢«èå°½ã</p>
<p>ä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼Python å¼å¥äº <strong>ä¸ä¸æç®¡çå¨åè®® (Context Manager Protocol)</strong>ââå³ <code>with</code> è¯­å¥ã</p>
<h4 id="211-åè®®è§£æ__enter__-ä¸-__exit__">2.1.1. åè®®è§£æï¼<code>__enter__</code> ä¸ <code>__exit__</code></h4>
<p><code>with</code> è¯­å¥æ¬è´¨ä¸æ¯ç¼è¯å¨æ³¨å¥ç <code>try...finally</code> åçè¯­æ³ç³ï¼ä½å®å°èµæºç®¡ççé»è¾å°è£å°äºå¯¹è±¡åé¨ã</p>
<ul>
<li><strong><code>__enter__(self)</code></strong>: å¯¹åº C++ çæé é»è¾ãåéèµæºï¼è¿åå¥æã</li>
<li><strong><code>__exit__(self, exc_type, exc_val, exc_tb)</code></strong>: å¯¹åº C++ çææé»è¾ãæ è®ºä»£ç åæ¯æ­£å¸¸ç»æè¿æ¯æåºå¼å¸¸ï¼VM é½ä¼å¼ºå¶è·³è½¬å°è¿éã</li>
</ul>
<p><strong>ä»£ç å®ç°ï¼æåä¸ä¸ªåå­çº§éå«å£«</strong></p>
<p>è®©æä»¬ç¨ Python å®ç°ä¸ä¸ªç±»ä¼¼ C++ <code>std::lock_guard</code> çæºå¶ãæ³¨æç <code>__exit__</code> å¦ä½å¤çå¼å¸¸ä¼ æ­ââè¿æ¯ C++ ææå½æ°éå¸¸æåé¿åçï¼æææåºå¼å¸¸ä¼å¯¼è´ <code>std::terminate</code>ï¼ï¼èå¨ Python ä¸­å´æ¯æ§å¶æµçä¸é¨åã</p>
<pre><code class="language-python">import threading
from types import TracebackType
from typing import Optional, Type

class ScopedLock:
    """
    æ¨¡æ C++ std::lock_guard ç RAII è¡ä¸ºã
    åºå±å¯¹åº opcode: SETUP_WITH -&gt; ... -&gt; WITH_EXCEPT_START / CALL_FUNCTION (__exit__)
    """
    __slots__ = ('_lock',) # åå­ä¼åï¼ç¦æ­¢ __dict__ï¼ä»åéæéå¤§å°çåå­

    def __init__(self, lock: threading.Lock):
        self._lock = lock

    def __enter__(self):
        # å¯¹åº lock.acquire()ï¼é»å¡ç´å°è·å¾é
        # è¿åå¼ç»å®å° with ... as target ç target
        self._lock.acquire()
        return self 

    def __exit__(self, 
                 exc_type: Optional[Type[BaseException]], 
                 exc_val: Optional[BaseException], 
                 exc_tb: Optional[TracebackType]):
        # å¯¹åº lock.release()
        # è¿æ¯ä¸ä¸ªç¡®å®æ§çæ¸çç¹ï¼ä¸ä¾èµ GC
        self._lock.release()
        
        # Trade-off: 
        # å¦æè¿å Trueï¼å¼å¸¸è¢«åå¬ï¼ç±»ä¼¼ catch {...}ï¼ã
        # å¦æè¿å False æ Noneï¼å¼å¸¸ç»§ç»­åä¸ä¼ æ­ï¼Rethrowï¼ã
        if exc_type:
            print(f"[System Logic] Detecting Unwind: {exc_type.__name__}")
            # è¿éå¯ä»¥éæ©å¤çå¼å¸¸ï¼æèè®©å®ç»§ç»­å¯¼è´æ å±å¼
        return False

# Usage
lock = threading.Lock()
with ScopedLock(lock):
    # Critical Section
    print("In Critical Section")
    # å³ä½¿è¿éåç 1/0 å¼å¸¸ï¼_lock.release() ä¾ç¶ä¼è¢«ç²¾åæ§è¡

</code></pre>
<p>ä»å­èç è§åº¦çï¼<code>with</code> è¯­å¥çæäº <code>SETUP_WITH</code> æä»¤ï¼å®å° <code>__exit__</code> æ¹æ³åå¥<strong>è¿è¡æ¶æ  (Evaluation Stack)</strong>ãè¿æ¯ C++ çç¼è¯å¨éææå¥ææè°ç¨è¦éå¾å¤ï¼ä½å®èµäºäºè¿è¡æ¶å¨æå¤çå¼å¸¸ççµæ´»æ§ã</p>
<h3 id="22-ç¶ææºçé­æ³çæå¨-generators-ä¸æ å¸§æä¹å">2.2. ç¶ææºçé­æ³ï¼çæå¨ (Generators) ä¸æ å¸§æä¹å</h3>
<p>å¨ Java ä¸­ï¼å¦æä½ æ³å®ç°ä¸ä¸ªæ°æ§è¿­ä»£å¨ï¼Iteratorï¼ï¼ä½ éå¸¸éè¦å®ä¹ä¸ä¸ªç±»ï¼ç»´æ¤ <code>currentIndex</code> ç¶æï¼å¹¶å®ç° <code>hasNext()</code> å <code>next()</code>ãè¿æ¯ä¸ç§<strong>æ¾å¼çç¶ææº</strong>ç»´æ¤ã</p>
<p>Python ç Generator åå¼å¥äºä¸ç§æ´é«é¶çæ½è±¡ï¼<strong>éå¼ç¶ææº</strong>ï¼æèæ´åç¡®å°è¯´ï¼<strong>ç¨æ·æçæ å¸§æèµ·</strong>ã</p>
<h4 id="221-æ ¸å¿å·®å¼c-æ -vs-python-æ ">2.2.1. æ ¸å¿å·®å¼ï¼C æ  vs. Python æ </h4>
<p>çè§£ Generator çå³é®å¨äºçè§£ Python çå½æ°è°ç¨æ¨¡åï¼</p>
<ol>
<li><strong>C Stack (ç³»ç»æ ):</strong> Python è§£éå¨ï¼Cç¨åºï¼èªèº«çå½æ°è°ç¨æ ã</li>
<li><strong>Python Stack (èææ ):</strong> Python ä»£ç æ§è¡æ¶çæ å¸§ (<code>PyFrameObject</code>) é¾è¡¨ã</li>
</ol>
<p>å³é®ç¹æ¥äºï¼<strong><code>PyFrameObject</code> æ¯åéå¨å ï¼Heapï¼ä¸çå¯¹è±¡</strong>ã</p>
<p>å½ä½ è°ç¨ä¸ä¸ªæ®éå½æ°æ¶ï¼Python åå»ºä¸ä¸ª Frameï¼æ§è¡å®åéæ¯ã<br>
ä½å½ä½ è°ç¨ä¸ä¸ª Generator å½æ°æ¶ï¼</p>
<ol>
<li>Python åå»ºä¸ä¸ª Frameã</li>
<li>éå° <code>yield</code> å³é®å­æ¶ï¼è§£éå¨<strong>æå</strong>è¯¥ Frame çæ§è¡ã</li>
<li><strong>ä¿å­æä»¤æé (f_lasti)</strong>ï¼è®°å½å½åæ§è¡å°äºåªæ¡å­èç ã</li>
<li><strong>ä¿å­æä½æ°æ </strong>ï¼è®°å½å½åçä¸´æ¶åéã</li>
<li>å°æ§å¶æè¿åç»è°ç¨èï¼ä½<strong>ä¸éæ¯è¯¥ Frame</strong>ã</li>
</ol>
<p>è¿æå³çï¼Generator æ¬è´¨ä¸æ¯ä¸ä¸ª<strong>éé¸äºçå½å¨æçæ å¸§</strong>ã</p>
<h4 id="222-ä»£ç å®ç°çª¥æ¢æèµ·çåæ ¸">2.2.2. ä»£ç å®ç°ï¼çª¥æ¢æèµ·çåæ ¸</h4>
<p>æä»¬å¯ä»¥éè¿ <code>inspect</code> æ¨¡åç´æ¥è§å¯è¿ä¸ªâåµå°¸âæ å¸§çåé¨ç¶æãè¿å¨ C++ ä¸­éè¦ GDB æè½åå°ï¼èå¨ Python ä¸­ï¼è¿æ¯è¯­è¨ç¹æ§çä¸é¨åã</p>
<pre><code class="language-python">import inspect

def stateful_execution():
    """
    ä¸ä¸ªç®åççæå¨ï¼æ¼ç¤ºæ å¸§çæèµ·ä¸æ¢å¤ã
    """
    x = 10          # å±é¨åéï¼å­å¨å¨ f_locals
    yield x         # ç¬¬ä¸æ¬¡æèµ·ï¼ä¿å­ IPï¼è¿å 10
    
    x += 5
    y = "System"
    yield x + 10    # ç¬¬äºæ¬¡æèµ·ï¼è¿å 25
    
    return "EOF"    # æåº StopIteration

# 1. åå»ºçæå¨å¯¹è±¡ï¼æ­¤æ¶å½æ°ä½åçä»£ç ä¸è¡é½è¿æ²¡æ§è¡
gen = stateful_execution()

# 2. ç¬¬ä¸æ¬¡æ¿æ´»
val1 = next(gen)
print(f"Yielded: {val1}")

# --- Hardcore Inspection ---
# è·åçæå¨å³èçæ å¸§å¯¹è±¡ (PyFrameObject)
frame = gen.gi_frame

print(f"\n[Frame Inspection]")
print(f"Instruction Pointer (f_lasti): {frame.f_lasti}") # å½åå­èç åç§»é
print(f"Local Variables (f_locals):  {frame.f_locals}") # {'x': 10}

# 3. æ¢å¤æ§è¡
# è§£éå¨è¯»å frame.f_lastiï¼æ¢å¤ CPU å¯å­å¨ç¶æï¼ç»§ç»­æ§è¡
val2 = next(gen)
print(f"\nYielded: {val2}")
print(f"Local Variables Updated:     {gen.gi_frame.f_locals}") # {'x': 15, 'y': 'System'}

</code></pre>
<h4 id="223-è¿åæä¹ä»è¿­ä»£å¨å°åç¨">2.2.3. è¿åæä¹ï¼ä»è¿­ä»£å¨å°åç¨</h4>
<p>è¿ç§æºå¶çæ·±è¿æä¹å¨äºï¼å®è®©<strong>å¼æ­¥ç¼ç¨</strong>æä¸ºå¯è½ã</p>
<p>å¦æ <code>yield</code> ä¸ä»è½äº§åºå¼ï¼è¿è½æ¥æ¶å¼ï¼éè¿ <code>gen.send()</code>ï¼ï¼é£ä¹è¿ä¸ªå½æ°å°±åæäºä¸ä¸ªå¯ä»¥éè¿æ¶æ¯ä¼ éè¿è¡åä½ç<strong>åç¨ (Coroutine)</strong>ã</p>
<ul>
<li><strong>Java Iterator:</strong> ä»ä»æ¯æ°æ®ççäº§èã</li>
<li><strong>Python Generator:</strong> æ¯ä¸ä¸ªæ¥æç¬ç«æ ç©ºé´ãå¯ä»¥æåãå¯ä»¥æ¢å¤ãå¯ä»¥äº¤äºç<strong>å¾®çº¿ç¨</strong>ã</li>
</ul>
<p>å¨ Python 3.5 ä¹åï¼<code>@asyncio.coroutine</code> æ­£æ¯å©ç¨ <code>yield from</code> å®ç°çãèå¨ Python 3.5 ä¹åï¼<code>async/await</code> åªæ¯å°è¿ç§åºäºçæå¨çåç§é»é­æ³åè£æäºåçè¯­æ³ï¼åºå±ç <code>PyFrameObject</code> è°åº¦é»è¾ä¾ç¶æ¯ä¸èç¸æ¿çã</p>
<p><strong>Trade-off åæï¼</strong></p>
<ul>
<li><strong>æ§è½æèï¼</strong> æ¯æ¬¡ <code>yield</code> åæ¢å¤ç¡®å®æ¯ç®åç C æééå¢è¦æ¢ï¼æ¶å Python å¯¹è±¡å­åï¼ã</li>
<li><strong>æ¶ææ¶çï¼</strong> ä½ ç¨åæ­¥çä»£ç é»è¾ï¼çº¿æ§ç <code>for</code>, <code>while</code>ï¼ï¼ååºäºæå¶å¤æçå¼æ­¥æµå¼å¤çé»è¾ãå¨å¤çæ°ä»¥äº¿è®¡ç AI Token æµæ¶ï¼è¿ç§åå­åå¥½ä¸é»è¾æ¸æ°çæ½è±¡ï¼æ¯æ ä»·çã</li>
</ul>
<h2 id="3-æ·éå±è¢«å¨çè°åº¦-the-reality-of-gil">3. æ·éå±ââè¢«å¨çè°åº¦ (The Reality of GIL)</h2>
<h3 id="31-åå­å®å¨çæè¡¡c-è§è§ä¸ç-ob_refcnt">3.1. åå­å®å¨çæè¡¡ï¼C++ è§è§ä¸ç <code>ob_refcnt</code></h3>
<p>å¨ C++ ä¸­ï¼æä»¬ä½¿ç¨ <code>std::shared_ptr</code> æ¥ç®¡çå¼ç¨è®¡æ°ãä¸ºäºä¿è¯çº¿ç¨å®å¨ï¼<code>std::shared_ptr</code> çå¼ç¨è®¡æ°æä½ï¼<code>incref</code>/<code>decref</code>ï¼åé¨å¿é¡»ä½¿ç¨åå­æä½ï¼Atomic Operationsï¼ï¼éå¸¸å¯¹åºæ±ç¼æä»¤ <code>LOCK XADD</code>ã</p>
<p><strong>Trade-off çæ ¸å¿ï¼</strong><br>
åå­æä½ä¸æ¯åè´¹çãå¨å¤æ ¸ CPU ä¸ï¼åå­æä½ä¼å¯¼è´ç¼å­ä¸è´æ§æµéï¼Cache Coherence Trafficï¼æ¿å¢ï¼è¿æ¯æ®éçåå­è¯»åè¦æ¢ä¸ä¸ªæ°éçº§ã</p>
<p>Python çè®¾è®¡èé¢ä¸´ä¸ä¸ªéæ©ï¼</p>
<ol>
<li><strong>ç»ç²åº¦éï¼Fine-grained Lockingï¼ï¼</strong> è®©æ¯ä¸ª <code>PyObject</code> èªå¸¦ä¸ä¸ª <code>std::mutex</code>ï¼æèä½¿ç¨åå­æä½æ´æ°å¼ç¨è®¡æ°ã</li>
</ol>
<ul>
<li><em>åæï¼</em> åçº¿ç¨æ§è½ä¸é 30%~50%ï¼åå²å®æµæ°æ®ï¼ãå ä¸ºå³ä½¿å¨åçº¿ç¨ä¸ï¼ä½ ä¹å¿é¡»æ¯ä»åå­æä½çæè´µå¼éã</li>
</ul>
<ol start="2">
<li><strong>å·¨éï¼Coarse-grained Lockingï¼ï¼</strong> å¼å¥ä¸æå¨å±çå¤§éï¼GILï¼ï¼ä¿æ¤æ´ä¸ªè§£éå¨ç¶æã</li>
</ol>
<ul>
<li><em>åæï¼</em> å¤æ ¸å¹¶åæä¸ºæ³¡å½±ï¼å¤çº¿ç¨æ²¦ä¸ºå¹¶åï¼Concurrencyï¼èéå¹¶è¡ï¼Parallelismï¼ã</li>
<li><em>æ¶çï¼</em> åçº¿ç¨æå¶é«æï¼æ éå¼éï¼ï¼C æ©å±ç¼åæå¶ç®åï¼é»è®¤ä¸éè¦èèçº¿ç¨å®å¨ï¼ã</li>
</ul>
<p>Python éæ©äºåèãGIL æ¬è´¨ä¸æ¯ä¸ä¸ª <strong>äºæ¥é (Mutex)</strong>ï¼å®ä¿æ¤çä¸æ¯ä½ çåéï¼èæ¯ <code>PyObject</code> ç»æä½ä¸­ç <code>ob_refcnt</code> å­æ®µä»¥åè§£éå¨çå¨å±ç¶æã</p>
<blockquote>
<p><strong>C++ ç¨åºåçé¡¿æï¼</strong><br>
GIL çå­å¨ï¼æ¯ä¸ºäºè®© CPython ç <code>malloc</code> å <code>free</code>ï¼å³ <code>Py_INCREF</code>/<code>Py_DECREF</code>ï¼å¨ä¸ä½¿ç¨åå­æä»¤çæåµä¸ï¼ä¾ç¶è½ä¿æåå­çä¸è´æ§ã</p>
</blockquote>
<h3 id="32-ç«ææ¡ä»¶ççç¸åå­æ§çå¹»è§">3.2. ç«ææ¡ä»¶ççç¸ï¼åå­æ§çå¹»è§</h3>
<p>å¾å¤åå­¦èè¯¯ä»¥ä¸ºï¼âæ¢ç¶æ GILï¼åä¸æ¶å»åªæä¸ä¸ªçº¿ç¨å¨è·ï¼é£æå°±ä¸éè¦éäºãâ<br>
è¿æ¯å¤§éç¹éçã</p>
<p><strong>GIL ä¿è¯çæ¯å­èç ï¼Bytecodeï¼æ§è¡çåå­æ§ï¼èä¸æ¯ä¸å¡é»è¾çåå­æ§ã</strong></p>
<p>æä½ç³»ç»ï¼æè Python è§£éå¨åé¨çè°åº¦å¨ï¼å¯ä»¥å¨<strong>ä»»æä¸¤ä¸ªå­èç ä¹é´</strong>è¿è¡ä¸ä¸æåæ¢ãå¦æä½ çä¸å¡é»è¾ç±å¤æ¡å­èç ç»æï¼é£ä¹å¨ä¸­é´è¢«åèµ°å°±æ¯å¿ç¶åççã</p>
<h4 id="321-ä»£ç å®ç°è§£å-n--1">3.2.1. ä»£ç å®ç°ï¼è§£å <code>n += 1</code></h4>
<p>å¨ C++ ä¸­ï¼<code>n++</code> éå¸¸ä¹ä¸æ¯åå­çï¼é¤éç¨ <code>std::atomic&lt;int&gt;</code>ï¼ï¼å®å¯¹åº <code>Read-Modify-Write</code> ä¸ä¸ªæ­¥éª¤ãPython ä¸­äº¦ç¶ï¼ä½æ´å å¤æã</p>
<p>è®©æä»¬ç¨ <code>dis</code> æ¨¡åæ¥çç <code>n += 1</code> å¨åºå±å°åºåçäºä»ä¹ã</p>
<pre><code class="language-python">import dis
import threading

n = 0

def race_condition():
    global n
    # è¿ä¸è¡çä¼¼ç®åçä»£ç ï¼å¨ VM ç¼éæ¯ 4 æ¡æä»¤
    n += 1

print(f"--- Bytecode Disassembly for 'n += 1' ---")
dis.dis(race_condition)

</code></pre>
<p><strong>è¾åºåæï¼æ±ç¼è§è§ï¼ï¼</strong></p>
<pre><code class="language-text">  7           0 LOAD_GLOBAL              0 (n)    &lt;-- Step 1: è¯»å n å°æ é¡¶
              2 LOAD_CONST               1 (1)    &lt;-- Step 2: åå¥å¸¸æ° 1
              4 INPLACE_ADD                       &lt;-- Step 3: æ§è¡å æ³
              6 STORE_GLOBAL             0 (n)    &lt;-- Step 4: åå n

</code></pre>
<p><strong>ç¾é¾åççç¬é´ï¼</strong></p>
<ol>
<li><strong>çº¿ç¨ A</strong> æ§è¡äº <code>LOAD_GLOBAL</code>ï¼æ¿å°äº <code>n=0</code>ï¼æ¾å¥èªå·±çæ å¸§ã</li>
<li><strong>GIL éæ¾ï¼</strong> (å¯è½æ¯æ¶é´çå°äºï¼Python 3.2+ é»è®¤ <code>sys.getswitchinterval()</code> ä¸º 5ms)ã</li>
<li><strong>çº¿ç¨ B</strong> è·å¾ GILï¼æ§è¡å®æ´ç <code>n += 1</code>ãæ­¤æ¶åå­ä¸­ç <code>n</code> åæäº 1ã</li>
<li><strong>GIL éæ°è¢«çº¿ç¨ A è·åã</strong></li>
<li><strong>çº¿ç¨ A</strong> ç»§ç»­æ§è¡ <code>INPLACE_ADD</code>ãæ³¨æï¼å®æ éç <code>n</code> ä¾ç¶æ¯ 0ï¼å ä¸ºå®æ¯ä»èªå·±çæ å¸§ä¸­è¯»åæä½æ°ï¼èä¸æ¯éæ°å»åå­è¯»ï¼ã</li>
<li><strong>çº¿ç¨ A</strong> è®¡ç® <code>0 + 1 = 1</code>ã</li>
<li><strong>çº¿ç¨ A</strong> æ§è¡ <code>STORE_GLOBAL</code>ï¼æ <code>1</code> åå¥åå­ï¼è¦çäºçº¿ç¨ B çç»æã</li>
</ol>
<p><strong>ç»æï¼</strong> ä¸¤ä¸ªçº¿ç¨åå äºä¸æ¬¡ï¼ç»æåºè¯¥æ¯ 2ï¼ä½å®éæ¯ 1ãè¿å°±æ¯å¸åç <strong>Lost Update</strong> é®é¢ã</p>
<h4 id="322-å¤æ ¸æ¶ä»£çæ¤èªæåº-the-convoy-effect">3.2.2. å¤æ ¸æ¶ä»£çâæ¤èªæåºâ (The Convoy Effect)</h4>
<p>å¨åæ ¸æ¶ä»£ï¼GIL åªæ¯ç®åçåæ¶å¤ç¨ãä½å¨å¤æ ¸ CPU ä¸ï¼æåµä¼åå¾æ´ç³ã</p>
<p>å½ææ GIL ççº¿ç¨ A éæ¾éï¼ä¾å¦å ä¸º I/O æå¼ºå¶åæ¢ï¼æ¶ï¼OS å¯è½ä¼åæ¶å¤éçº¿ç¨ BãC å Dãå®ä»¬ä¼å¨ä¸åç CPU æ ¸å¿ä¸éæ¥ï¼ç¯çäºæ¢è¿æå¯ä¸çéãç»æåªæ B æ¢å°äºï¼C å D äºæ¢å¤±è´¥ï¼åæ¬¡è¢« OS æèµ·ã</p>
<p>è¿ç§ <strong>âå¤é-äºæ¢-å¤±è´¥-æèµ·â</strong> çå¾ªç¯ä¼å¯¼è´ä¸¥éç CPU æå¨ (Thrashing)ãè¿ä¹æ¯ä¸ºä»ä¹å¨è®¡ç®å¯éåä»»å¡ä¸­ï¼Python å¤çº¿ç¨å¾å¾æ¯åçº¿ç¨è¿è¦æ¢ââæä»¬ä¸ä»æ²¡æå©ç¨å¤æ ¸ï¼åèæµªè´¹äºå¤§éç CPU å¨æå¨ OS çè°åº¦å¼éä¸ã</p>
<h4 id="323-ä¸ºä»ä¹å¿é¡»ä½¿ç¨-threadinglock">3.2.3. ä¸ºä»ä¹å¿é¡»ä½¿ç¨ <code>threading.Lock</code>ï¼</h4>
<p>å¨ Python ä¸­ä½¿ç¨ <code>threading.Lock</code>ï¼å®éä¸æ¯å¨åºç¨å±å¼å¥äºç¬¬äºæéã</p>
<pre><code class="language-python">lock = threading.Lock()

def safe_increment():
    global n
    # ç³è¯·éï¼å¦ææ¿ä¸å°ï¼çº¿ç¨è¿å¥é»å¡ç¶æï¼GIL èªå¨éæ¾ç»å«äºº
    with lock:
        # ä¸´çåº (Critical Section)
        # å³ä½¿ GIL å¨è¿ééæ¾ï¼å¶ä»çº¿ç¨ä¹æ æ³è¿å¥è¿ä¸ªä»£ç å
        # å ä¸ºå®ä»¬æ¿ä¸å°åºç¨å±ç lock
        n += 1

</code></pre>
<p><strong>åºå±é»è¾ï¼</strong></p>
<ul>
<li><strong>GIL</strong> ä¿æ¤çæ¯ <code>ob_refcnt</code> ä¸ä¹±å¥ï¼é²æ­¢è§£éå¨å´©æºï¼ã</li>
<li><strong>threading.Lock</strong> ä¿æ¤çæ¯ <code>n</code> çå¼ç¬¦åé¢æï¼é²æ­¢ä¸å¡é»è¾éè¯¯ï¼ã</li>
</ul>
<h3 id="33-io-éæ¾ä¸-cpu-å¯éåçæ­»å±">3.3. I/O éæ¾ä¸ CPU å¯éåçæ­»å±</h3>
<p>æä»¬å¸¸è¯´âPython å¤çº¿ç¨éå I/O å¯éåâï¼å¶åºå±æºçå¨äºï¼</p>
<p>å½ Python æ§è¡ç³»ç»è°ç¨ï¼å¦ <code>read()</code>, <code>write()</code>, <code>recv()</code>, <code>sleep()</code>ï¼æ¶ï¼C ä»£ç ä¼å¨è°ç¨é»å¡ç C å½æ°ä¹åï¼<strong>ä¸»å¨éæ¾ GIL</strong>ï¼è°ç¨ <code>Py_BEGIN_ALLOW_THREADS</code> å®ï¼ã</p>
<pre><code class="language-c">/* CPython æºç ä¼ªä»£ç  (socket module) */
static PyObject *
sock_recv(PySocketSockObject *s, PyObject *args)
{
    // ... è§£æåæ° ...
    
    // éæ¾ GILï¼åè®¸å¶ä» Python çº¿ç¨è¿è¡
    Py_BEGIN_ALLOW_THREADS
    
    // é»å¡çç³»ç»è°ç¨ï¼æ­¤æ¶ CPU ä¸å¨ Python æé
    count = recv(s-&gt;sock_fd, buffer, len, flags);
    
    // éæ°è·å GILï¼åå¤è¿å Python å¯¹è±¡
    Py_END_ALLOW_THREADS
    
    // ... åè£ç»æ ...
    return result;
}

</code></pre>
<p>è¿æå³çï¼å½ä¸ä¸ªçº¿ç¨å¨ç­ç½ç»åæ¶ï¼å¦ä¸ä¸ªçº¿ç¨å¯ä»¥æ¿å° GIL å»è· Python ä»£ç ãè¿å°±æ¯ä¸ºä»ä¹å¨ç¬è«ãWeb æå¡ä¸­ï¼Python çå¤çº¿ç¨ä¾ç¶ææã</p>
<p>ä½å¦ææ¯ <strong>CPU å¯éå</strong>ï¼å¦å¾åå¤çãç©éµè®¡ç®ï¼ï¼çº¿ç¨ä¸ä¼ä¸»å¨éæ¾ GILï¼åªè½ç­å¾è§£éå¨å¼ºå¶åæ¢ï¼Check Intervalï¼ãè¿ä¸ä»æ æ³å©ç¨å¤æ ¸ï¼åèå ä¸ºé¢ç¹çéäºæ¢ï¼Lock Contentionï¼åä¸ä¸æåæ¢ï¼å¯¼è´å¤çº¿ç¨æ¯åçº¿ç¨è¿è¦æ¢ï¼</p>
<h2 id="4-è¿åå±ä¸»å¨çåä½-cooperative-concurrency">4. è¿åå±ââä¸»å¨çåä½ (Cooperative Concurrency)</h2>
<h3 id="41-ä»çæå¨å°åç¨æ æ çèå©ä¸ä»£ä»·">4.1. ä»çæå¨å°åç¨ï¼æ æ çèå©ä¸ä»£ä»·</h3>
<p>å¨ C++20 å¼å¥ Coroutines ä¹åï¼æä»¬ä¹ æ¯ç¨ç¶ææºæååè°ãPython çåç¨æ¬è´¨ä¸å°±æ¯<strong>ç¼è¯å¨èªå¨çæçæéç¶ææº</strong>ã</p>
<h4 id="411-æ ¸å¿å¯¹å³python-stackless-vs-go-stackful">4.1.1. æ ¸å¿å¯¹å³ï¼Python (Stackless) vs. Go (Stackful)</h4>
<ul>
<li>
<p><strong>Go (Goroutine):</strong><br>
Go è¿è¡æ¶ä¸ºæ¯ä¸ª Goroutine åéä¸ä¸ª<strong>çå®çãå¯å¢é¿çæ </strong>ï¼åå§çº¦ 2KBï¼ãå½ Goroutine é»å¡æ¶ï¼Go çè°åº¦å¨ä¿å­å½åçå¯å­å¨ç¶æï¼SP, PC ç­ï¼å°è¯¥æ ä¸­ï¼ç¶ååæ¢å°å¦ä¸ä¸ª Goroutineãè¿å ä¹ç­åäºç¨æ·æçº¿ç¨ã</p>
</li>
<li>
<p><em>ä¼ç¹ï¼</em> æ­¤æ¶ï¼ä»£ç æ¯åæ­¥åçï¼åºå±æ¯å¼æ­¥è·çãä½ ä¸éè¦ <code>await</code>ï¼å ä¸ºè°åº¦å¨æ¯éå¼çã</p>
</li>
<li>
<p><em>ç¼ºç¹ï¼</em> æ¯ä¸ª Goroutine é½æåå­å¼éï¼è½å°ä½æï¼ï¼ä¸éè¦å¤æçè¿è¡æ¶è°åº¦å¨ã</p>
</li>
<li>
<p><strong>Python (Coroutine):</strong><br>
Python çåç¨è¢«ç§°ä¸º <strong>æ æ åç¨ (Stackless)</strong>ãä½è¿å¹¶ä¸æå³çå®æ²¡ææ ï¼èæ¯æå® <strong>ä¸ä¿ç C è¯­è¨å±é¢çç³»ç»è°ç¨æ </strong>ã<br>
å½ä½  <code>await</code> æ¶ï¼Python ä»ä»æ¯å°å½åçèææºæ å¸§ (<code>PyFrameObject</code>ï¼ä¸ä¸ªåéå¨å ä¸çå¯¹è±¡) æèµ·ï¼å¹¶å° C æ åéï¼Unwindï¼å° Event Loopãç¸æ¯ä¹ä¸ï¼Go ç Goroutine æ¯ <strong>ææ ç (Stackful)</strong>ï¼å®æ¥æç¬ç«çãå¯å¨ææ©å®¹çè¿ç»­åå­ç©ºé´ï¼åå§çº¦ 2KBï¼ï¼è½ä¿å­å®æ´çè°ç¨é¾è·¯ç¶æã</p>
</li>
</ul>
<h4 id="412-å¼æ­¥çä¼ ææ§-function-coloring">4.1.2. å¼æ­¥çâä¼ ææ§â (Function Coloring)</h4>
<p>è¿å°±æ¯ä¸ºä»ä¹ Python çå¼æ­¥å·æ<strong>ä¼ ææ§</strong>ï¼<br>
å¦æå½æ° A è°ç¨äºå¼æ­¥å½æ° B (<code>await B()</code>)ï¼é£ä¹ A èªèº«å¿é¡»åæå¼æ­¥å½æ° (<code>async def A()</code>)ã</p>
<p><strong>åºå±é»è¾ï¼</strong><br>
å ä¸º Python æ²¡æç¬ç«çåç¨æ ï¼å®æ æ³å¨æ®éå½æ°ç C æ å¸§ä¸­é´æåãåªæè¢«æ è®°ä¸º <code>async</code> çå½æ°ï¼å³çæå¨ï¼ï¼æå·å¤âæå-æ¢å¤âçå­èç æä»¤ (<code>YIELD_FROM</code> / <code>SEND</code>)ã</p>
<p>è¿æ¯ä¸ä¸ªå·¨å¤§ç Trade-offï¼</p>
<ul>
<li><strong>çºç²ï¼</strong> å¼åä½éªçå²è£ï¼åæ­¥ä»£ç æ æ³ç´æ¥å¤ç¨å¼æ­¥åºï¼ã</li>
<li><strong>æ¢åï¼</strong> æè´çè½»éçº§ãåå»ºä¸ä¸ª Python åç¨å ä¹åªæ¶èä¸ä¸ª Python å¯¹è±¡çåå­ï¼ä¸åæ¢å¼éä»ä¸ºä¸æ¬¡å½æ°è°ç¨ï¼å®å¨ä¸æ¶åå¯å­å¨ä¿å­æå¤æçæ æ·è´ã</li>
</ul>
<h3 id="42-event-loop-çåæ ¸reactor-æ¨¡å¼ç-python-å®ç°">4.2. Event Loop çåæ ¸ï¼Reactor æ¨¡å¼ç Python å®ç°</h3>
<p>å¥å» <code>asyncio</code> åä¸½çå°è£ï¼å¶æ ¸å¿åªæ¯ä¸ä¸ªæ­»å¾ªç¯ï¼ä¸æ­æ¥è¯¢æä½ç³»ç»åæ ¸ï¼âåªäºæä»¶æè¿°ç¬¦ (fd) åå¤å¥½äºï¼â</p>
<p>è¿æ­£æ¯ç»å¸ç <strong>Reactor æ¨¡å¼</strong>ã</p>
<p>å¨ Linux ä¸ï¼è¿å¯¹åº <code>epoll_wait</code>ï¼å¨ macOS/BSD ä¸ï¼æ¯ <code>kevent</code>ï¼å¨ Windows ä¸ï¼æ¯ <code>IOCP</code>ã</p>
<h4 id="421-ä»£ç å®ç°æåä¸ä¸ª-mini-asyncio">4.2.1. ä»£ç å®ç°ï¼æåä¸ä¸ª mini-asyncio</h4>
<p>ä¸ºäºè¯æ <code>asyncio</code> æ²¡æä»»ä½é»é­æ³ï¼æä»¬å°ç»è¿ <code>asyncio</code> åºï¼ç´æ¥ä½¿ç¨ <code>selectors</code> æ¨¡åï¼å¯¹ <code>epoll</code>/<code>kqueue</code> çä½çº§å°è£ï¼æ¥å®ç°ä¸ä¸ªå¼æ­¥è¿è¡æ¶ã</p>
<p><strong>C++ å¼åèè¯·æ³¨æï¼</strong> ä¸é¢çä»£ç å±ç¤ºäºå¦ä½å°âåè°å°ç±âéè¿çæå¨åå¹³æâåæ­¥å¤è§âã</p>
<pre><code class="language-python">import selectors
import socket
import time
from collections import deque

# 1. å¨å±äºä»¶å¾ªç¯ (The Reactor)
selector = selectors.DefaultSelector()
task_queue = deque() # å°±ç»ªä»»å¡éå

class Future:
    """
    å¯¹åº C++ std::future æ JavaScript Promiseã
    å®æ¯å¼æ­¥æä½ç»æçå ä½ç¬¦ã
    """
    def __init__(self):
        self.result = None
        self._callbacks = []

    def set_result(self, value):
        self.result = value
        for cb in self._callbacks:
            cb(self)

    def __await__(self):
        # é­æ³æå¨ï¼yield self åè¯ Task "æè¿æ²¡å¥½ï¼è¯·æèµ·"
        yield self 
        return self.result

def async_socket_read(sock):
    """
    ä¸ä¸ªæ¨¡æçä½çº§å¼æ­¥ socket è¯»åã
    """
    f = Future()

    def on_readable():
        f.set_result(sock.recv(4096))
        # è¯»åå®æ¯ï¼ä» epoll ä¸­æ³¨é
        selector.unregister(sock)

    # æ³¨åå° epoll/kqueueï¼å½ sock å¯è¯»æ¶ï¼è°ç¨ on_readable
    # C++ å¯¹åº: epoll_ctl(epfd, EPOLL_CTL_ADD, fd, &amp;event)
    selector.register(sock, selectors.EVENT_READ, on_readable)
    
    # ç«å³è¿å Futureï¼ä¸é»å¡
    return f

class Task:
    """
    é©±å¨åç¨æ§è¡çå®¹å¨ã
    ç±»ä¼¼äº asyncio.Taskã
    """
    def __init__(self, coro):
        self.coro = coro
        self.step() # å¯å¨åç¨

    def step(self, future=None):
        try:
            # æ¢å¤åç¨æ§è¡ï¼send(result)
            if future is None:
                next_future = self.coro.send(None)
            else:
                next_future = self.coro.send(future.result)
            
            # åç¨éå°äº awaitï¼è¿åäºä¸ä¸ª Future
            # æä»¬ç»è¿ä¸ª Future å ä¸ªåè°ï¼ä¸æ¦å®å®æäºï¼å°±ç»§ç»­ step()
            next_future._callbacks.append(self.step)
            
        except StopIteration:
            # åç¨æ§è¡å®æ¯
            pass

# --- ä¸å¡é»è¾ (User Code) ---
# æ³¨æï¼async def æ¬è´¨ä¸æ¯çæå¨å·¥å
async def fetch_url(url):
    # æ¨¡æå»ºç« socket
    sock = socket.socket()
    sock.setblocking(False)
    try:
        sock.connect(('example.com', 80))
    except BlockingIOError:
        pass # æ­£å¸¸ç°è±¡
    
    # åé HTTP è¯·æ±
    req = f"GET / HTTP/1.0\r\nHost: example.com\r\n\r\n".encode()
    # ç®åçï¼è¿éå¶å®ä¹åºè¯¥ await write
    sock.send(req) 

    print(f"[{url}] Waiting for data...")
    
    # å³é®ç¹ï¼await æèµ·å½åæ å¸§ï¼äº¤åºæ§å¶æ
    # æ­¤æ¶ï¼Event Loop å¯ä»¥å»å¤çå¶ä» Task
    data = await async_socket_read(sock)
    
    print(f"[{url}] Received {len(data)} bytes")

# --- é©±å¨å± (Event Loop Driver) ---
def run_loop():
    # åå»ºä¸¤ä¸ªå¹¶åä»»å¡
    Task(fetch_url("Task-A"))
    Task(fetch_url("Task-B"))

    print("--- Event Loop Started ---")
    while True:
        # 1. é»å¡ç­å¾ IO äºä»¶ (epoll_wait)
        # å¦ææ²¡æ IO å°±ç»ªï¼CPU ä½¿ç¨çä¸º 0
        events = selector.select()
        
        # 2. å¤çäºä»¶ (Callback Dispatch)
        for key, mask in events:
            callback = key.data
            callback()
        
        # ç®åçéåºæ¡ä»¶
        if not selector.get_map():
            break
    print("--- Event Loop Finished ---")

if __name__ == "__main__":
    run_loop()

</code></pre>
<h4 id="422-æ·±åº¦è§£ææ§å¶æµçç¿»è½¬">4.2.2. æ·±åº¦è§£æï¼æ§å¶æµçç¿»è½¬</h4>
<ol>
<li><strong>Callback (C é£æ ¼):</strong> ææçé»è¾è¢«ææ£å¨ <code>on_readable</code>, <code>on_writable</code> ç­åè°å½æ°ä¸­ï¼ç¶æç»´æ¤æå¶çè¦ï¼å¿é¡»æ¾å¼ä¼ é context æéï¼ã</li>
<li><strong>Coroutine (Python é£æ ¼):</strong></li>
</ol>
<ul>
<li><code>await</code> å³é®å­å° <code>async_socket_read</code> ç <code>Future</code> æç» Event Loopã</li>
<li>Event Loop å° <code>Task.step</code> æ³¨åä¸ºåè°ã</li>
<li>å½ <code>epoll</code> å¤éæ¶ï¼éè¿åè°è§¦å <code>Task.step</code>ã</li>
<li><code>Task.step</code> è°ç¨ <code>coro.send()</code>ï¼<strong>æ¢å¤</strong> ä¹åæèµ·ç <code>fetch_url</code> æ å¸§ã</li>
</ul>
<p><strong>å¯¹ C++ ç¨åºåçå¯ç¤ºï¼</strong><br>
Python ç <code>asyncio</code> å®éä¸æ¯å¨åçº¿ç¨åå®ç°äºä¸ä¸ª<strong>éæ¢å å¼æä½ç³»ç»</strong>ã<code>Task</code> æ¯è¿ç¨ï¼<code>Future</code> æ¯ç³»ç»è°ç¨ï¼è <code>Event Loop</code> å°±æ¯åæ ¸è°åº¦å¨ã</p>
<h2 id="5-ç ´å±å±æç ´è¾¹ç-extending-with-c">5. ç ´å±å±ââæç ´è¾¹ç (Extending with C++)</h2>
<p>å¨åå ç« ä¸­ï¼æä»¬ææçä¼åé½å¨ Python èææºçå´å¢ä¹åï¼æ è®ºæ¯ <code>asyncio</code> çç¨æ·æè°åº¦ï¼è¿æ¯ <code>multiprocessing</code> çè¿ç¨é´éä¿¡ï¼æ¬è´¨ä¸é½æ¯å¨è§é¿ GILã</p>
<p>ä½å¨è¿ä¸ç« ï¼æä»¬è¦æ­£é¢<strong>å»ç©¿</strong>è¿å µå¢ãæä»¬å°ç¼å C++ æ©å±ï¼ä¸»å¨éæ¾ GILï¼è®© Python çº¿ç¨éåä¸ºåçº¯ç C++ çº¿ç¨ï¼ä»èåæ¦¨åº CPU çæ¯ä¸ä¸ªæ¶éå¨æã</p>
<p>å½ä½ ç Profilerï¼æ§è½åæå¨ï¼æ¾ç¤ºç¶é¢ä¸åæ¯ IO ç­å¾ï¼èæ¯ CPU ç <code>ALU</code>ï¼ç®æ¯é»è¾ååï¼æ»¡è½½æ¶ï¼ä»»ä½ Python å±é¢çä¼åï¼åæ¬ PyPyï¼é½æ¯éé´æçãæ­¤æ¶ï¼å¯ä¸çåºè·¯æ¯å°è®¡ç®å¯éååæ ¸ä¸æ²å° C++ã</p>
<h3 id="51-éæ¾-gil-çèºæ¯ä»ææèå°æè§è">5.1. éæ¾ GIL çèºæ¯ï¼ä»ææèå°æè§è</h3>
<p>æä»¬å¨ç¬¬ä¸ç« æå°ï¼Python è§£éå¨æ¯ä¸ä¸ªå·¨å¤§çç¶ææºï¼GIL ä¿æ¤çè¿ä¸ªç¶ææºçä¸è´æ§ãä½æ¯ï¼<strong>å¦æä½ çä»£ç ä¸æ¶åä»»ä½ Python å¯¹è±¡ï¼PyObjectï¼çæä½ï¼ä½ å°±ä¸éè¦ GILã</strong></p>
<p>æ¯å¦ï¼ç©éµä¹æ³ãå¾åç¼è§£ç ãå¤æçæ°å¼ç§¯åãè¿äºæä½åªéè¦åå§çåå­æéï¼<code>double*</code>, <code>uint8_t*</code>ï¼ã</p>
<h4 id="511-åè®®py_begin_allow_threads">5.1.1. åè®®ï¼<code>Py_BEGIN_ALLOW_THREADS</code></h4>
<p>å¨ C-API å±é¢ï¼Python æä¾äºä¸¤ä¸ªå®æ¥æå¨æ§å¶ GILï¼</p>
<ol>
<li><strong><code>Py_BEGIN_ALLOW_THREADS</code></strong>:</li>
</ol>
<ul>
<li>ä¿å­å½åçº¿ç¨çä¸ä¸æï¼Thread Stateï¼ã</li>
<li><strong>éæ¾äºæ¥é (Release Mutex)</strong>ã</li>
<li>æ­¤æ¶ï¼å¶ä» Python çº¿ç¨å¯ä»¥æ¢å  GIL å¹¶æ§è¡å­èç ã</li>
<li><strong>è­¦åï¼</strong> å¨æ­¤å®ä¹åï¼ä¸¥ç¦è®¿é®ä»»ä½ <code>PyObject</code>ï¼å¦åä¼å¯¼è´ç«å³ç Segfault ææ´éè½çå æåã</li>
</ul>
<ol start="2">
<li><strong><code>Py_END_ALLOW_THREADS</code></strong>:</li>
</ol>
<ul>
<li><strong>é»å¡ç­å¾</strong>ï¼ç´å°éæ°è·å¾äºæ¥éã</li>
<li>æ¢å¤çº¿ç¨ä¸ä¸æã</li>
<li>ç»§ç»­å¤ç Python å¯¹è±¡ï¼å¦å° C++ ç»æåè£æ <code>PyFloat</code>ï¼ã</li>
</ul>
<p>è¿å°±åæ¯å½ä½ ï¼C++ ä»£ç ï¼éè¦å»è¿è¡ä¸åºæ¼«é¿çé­å³ä¿®ç¼ï¼ç¹éè®¡ç®ï¼æ¶ï¼ä½ ä¸»å¨äº¤åºäºä»¤çï¼GILï¼ï¼åè¯è§£éå¨ï¼âä½ ä»¬åç©ï¼æç®å®äºååæ¥æéãâ</p>
<h3 id="52-å®æ-pybind11raii-é£æ ¼çééæ¾">5.2. å®æ Pybind11ï¼RAII é£æ ¼çééæ¾</h3>
<p>ç´æ¥å C-API æå¶ç¹çä¸å®¹æåºéï¼å¼ç¨è®¡æ°å°ç±ï¼ãç°ä»£ C++ å¼åèåºé¦é <code>pybind11</code>ãå®å©ç¨ C++ ç RAII æºå¶ï¼å° GIL çéæ¾å°è£å¾ä¼éä¸å®å¨ã</p>
<h4 id="521-åºæ¯å¤çº¿ç¨èç¹å¡æ´æ¨¡æ-cpu-bound">5.2.1. åºæ¯ï¼å¤çº¿ç¨èç¹å¡æ´æ¨¡æ (CPU Bound)</h4>
<p>åè®¾æä»¬éè¦è®¡ç®  çè¿ä¼¼å¼ï¼è¿æ¯ä¸ä¸ªçº¯è®¡ç®ä»»å¡ã</p>
<p><strong>C++ Extension (<code>cpu_bound.cpp</code>):</strong></p>
<pre><code class="language-cpp">#include &lt;pybind11/pybind11.h&gt;
#include &lt;random&gt;
#include &lt;thread&gt;
#include &lt;vector&gt;

namespace py = pybind11;

// çº¯ C++ é»è¾ï¼ä¸ä¾èµä»»ä½ Python å¤´æä»¶
double monte_carlo_pi(size_t samples) {
    std::random_device rd;
    std::mt19937 gen(rd());
    std::uniform_real_distribution&lt;&gt; dis(0.0, 1.0);

    size_t inside_circle = 0;
    for (size_t i = 0; i &lt; samples; ++i) {
        double x = dis(gen);
        double y = dis(gen);
        if (x * x + y * y &lt;= 1.0) {
            inside_circle++;
        }
    }
    return 4.0 * inside_circle / samples;
}

// åè£å±
double heavy_computation(size_t samples) {
    // 1. è¿å¥ C++ ä¸çï¼ææ GIL
    
    // 2. éæ¾ GIL (RAII)
    // æé å½æ°è°ç¨ PyEval_SaveThread()ï¼ææå½æ°è°ç¨ PyEval_RestoreThread()
    // å¨è¿ä¸ªä½ç¨ååï¼Python è§£éå¨å¯ä»¥å¹¶åè¿è¡å¶ä» Python çº¿ç¨ï¼
    py::gil_scoped_release release; 

    // 3. æ§è¡ç¹éç CPU è®¡ç®
    // æ­¤æ¶ OS å¯ä»¥å¨å¤æ ¸ä¸å¹¶è¡è°åº¦è¿ä¸ªçº¿ç¨
    double result = monte_carlo_pi(samples);

    // 4. ç¦»å¼ä½ç¨åï¼èªå¨éæ°è·å GIL
    return result; 
}

PYBIND11_MODULE(fast_calc, m) {
    m.def("compute_pi", &amp;heavy_computation, "Calculate Pi without GIL");
}

</code></pre>
<h4 id="522-python-ä¾§ççæ­£å¹¶è¡">5.2.2. Python ä¾§ççæ­£å¹¶è¡</h4>
<p>ç°å¨ï¼æä»¬åå° Pythonãæäº <code>py::gil_scoped_release</code>ï¼Python ç <code>threading</code> æ¨¡åå°ä¸åæ¯âä¼ªå¤çº¿ç¨âã</p>
<pre><code class="language-python">import threading
import time
import fast_calc # æä»¬ç¼è¯å¥½ç C++ æ©å±

SAMPLES = 10_000_000
THREAD_COUNT = 4

def worker():
    # å½è¿å¥ fast_calc.compute_pi åé¨æ¶ï¼
    # GIL è¢«éæ¾ï¼è¯¥çº¿ç¨åæäºä¸ä¸ªçº¯ç²¹ç OS çº¿ç¨ (Native Thread)
    # å®å¯ä»¥è·æ»¡ä¸ä¸ªç©ç CPU æ ¸å¿
    pi = fast_calc.compute_pi(SAMPLES)

def run_benchmark():
    start = time.perf_counter()
    threads = []
    
    # å¯å¨ 4 ä¸ªçº¿ç¨
    for _ in range(THREAD_COUNT):
        t = threading.Thread(target=worker)
        t.start()
        threads.append(t)
        
    for t in threads:
        t.join()
        
    end = time.perf_counter()
    print(f"Total time: {end - start:.4f}s")

# ç»æé¢æµï¼
# å¦æä¸éæ¾ GILï¼èæ¶çº¦ç­äº sum(T_i)ï¼å ä¸ºæ¯ä¸²è¡æ§è¡ã
# éæ¾ GIL åï¼  èæ¶çº¦ç­äº max(T_i)ï¼å®ç°çæ­£ç 4 åå é (Amdahl's Law åè®¸èå´å)ã

</code></pre>
<h3 id="53-æ°æ®ä¼ è¾çéå½¢ç¨buffer-protocol-ä¸åå­å¸å±">5.3. æ°æ®ä¼ è¾çéå½¢ç¨ï¼Buffer Protocol ä¸åå­å¸å±</h3>
<p>éæ¾ GIL è§£å³äº<strong>è®¡ç®</strong>çç¶é¢ï¼ä½å¦æä½ çæ°æ®è¿å¨ Python å ä¸ï¼æ¯å¦ä¸å¼  4K å¾çï¼ï¼å¦ä½ä¼ ç» C++ï¼</p>
<p>å¦æä½ ç®åå°å®ä¹å½æ°ä¸º <code>void foo(std::vector&lt;double&gt; v)</code>ï¼<code>pybind11</code> ä¼å°½èå°½è´£å°éå Python åè¡¨ï¼è§£åæ¯ä¸ª <code>PyFloatObject</code>ï¼å¹¶åç<strong>æ·±æ·è´</strong>å°æ°æ®å¤å¶å° C++ çå ä¸ãè¿ä¸ä»æ¶åå·¨å¤§ç <code>malloc</code> å¼éï¼è¿ç ´åäº CPU ç¼å­å±é¨æ§ã</p>
<p><strong>è§£å³æ¹æ¡ï¼ç¼å²åè®® (Buffer Protocol)</strong></p>
<p>Python ç <code>memoryview</code>ãNumPy ç <code>ndarray</code> é½å®ç°äº Buffer Protocolãå®åè®¸ C++ ç´æ¥è®¿é® Python å¯¹è±¡çåºå±åå­åï¼Raw Bufferï¼ï¼å®ç° <strong>Zero-Copy</strong>ã</p>
<p>ç¶èï¼è¿ééèçä¸ä¸ªå·¨å¤§çé·é±ï¼<strong>åå­è¿ç»­æ§ (Contiguity)</strong>ã</p>
<p>Python çåçæä½ï¼å¦ <code>img[:, ::2]</code>ï¼æ¯<strong>é¶æ·è´</strong>çï¼å®ä»ä»æ¯ä¿®æ¹äºåæ°æ®ä¸­ç <strong>Strides (æ­¥é¿)</strong>ï¼èä¸ä¼éæ°æååå­ãå¦æä½ ç´æ¥æè¿ä¸ªåççæéæ¿æ¥å½æè¿ç»­æ°ç»éåï¼ä½ ä¼è¯»å°éè¯¯çæ°æ®ï¼çè³å¼å Segmentation Faultã</p>
<p>å æ­¤ï¼ä¸¥è°¨ç C++ æ©å±å¿é¡»æ£æ¥åå­å¸å±ã</p>
<h4 id="531-ä»£ç å®ç°å®å¨çé«æ§è½å¾ååè²">5.3.1. ä»£ç å®ç°ï¼å®å¨çé«æ§è½å¾ååè²</h4>
<pre><code class="language-cpp">#include &lt;pybind11/pybind11.h&gt;
#include &lt;pybind11/numpy.h&gt;
#include &lt;stdexcept&gt;

namespace py = pybind11;

// C++ æ¥æ¶ NumPy æ°ç»ï¼é¶æ·è´ (Zero-Copy)
// æ³¨æï¼py::array_t&lt;uint8_t&gt; åªæ¯ä¸ä¸ªåè£å¨ï¼å¹¶ä¸æ¥ææ°æ®çæææ
void process_image(py::array_t&lt;uint8_t&gt; input_array) {
    // 1. è¯·æ±ç¼å²åºä¿¡æ¯ (Buffer Info)
    // è¿ä¼æ¥è¯¢å¯¹è±¡ç __buffer__ æ¥å£
    py::buffer_info buf = input_array.request();

    // 2. ç»´åº¦æ£æ¥
    if (buf.ndim != 2) {
        throw std::runtime_error("Number of dimensions must be 2");
    }

    // 3. [å³é®ç³»ç»çº§æ£æ¥] åå­å¸å±éªè¯
    // Python çåçå¯è½äº§çä¸è¿ç»­åå­ (Non-contiguous Memory)ã
    // åªæå½ Row Stride == Width * ElementSize ä¸ Col Stride == ElementSize æ¶ï¼
    // æä»¬æè½å°å¶è§ä¸ºä¸ç»´çº¿æ§æ°ç»å¤çã
    auto expected_stride_row = buf.shape[1] * sizeof(uint8_t);
    auto expected_stride_col = sizeof(uint8_t);

    if (buf.strides[0] != expected_stride_row || buf.strides[1] != expected_stride_col) {
        // éå°è¿ç§æåµï¼éå¸¸æä¸¤ç§éæ©ï¼
        // A. æåºå¼å¸¸ï¼å¼ºè¿«ç¨æ·å¨ Python ç«¯åè°ç¨ .copy() æ np.ascontiguousarray()
        // B. å¨ C++ ç«¯æå¨å¤ç stridesï¼æ§è½ç¥ä½ï¼ä½å¼å®¹æ§å¥½ï¼
        // è¿éä¸ºäºæ¼ç¤ºæè´æ§è½ï¼æä»¬éæ© Aï¼æç»å¤çéè¿ç»­åå­
        throw std::runtime_error("Input array must be C-style contiguous (no slices allowed)");
    }

    // 4. è·åè£¸æé (Raw Pointer)
    // æ­¤æ¶æä»¬å¯ä»¥å®å¨å°åæä½ C æ°ç»ä¸æ ·æä½å®
    uint8_t* ptr = static_cast&lt;uint8_t*&gt;(buf.ptr);
    size_t rows = buf.shape[0];
    size_t cols = buf.shape[1];
    size_t total_elements = rows * cols;

    // 5. éæ¾ GIL å¹¶å¨éè®¡ç®
    // è¿æ¯ä¸ä¸ªçº¯ç²¹çåå­è¯»åæä½ï¼ä¸æ¶åä»»ä½ Python API
    {
        py::gil_scoped_release release;
        
        // ç¼è¯å¨ç°å¨çèªå¨åéå (Auto-Vectorization) å¯ä»¥è½»æä¼åè¿ä¸ªå¾ªç¯
        // çæ SIMD æä»¤ (å¦ AVX2)
        for (size_t i = 0; i &lt; total_elements; ++i) {
            ptr[i] = 255 - ptr[i]; // åè²æä½
        }
    }
    // ä½ç¨åç»æï¼èªå¨éæ°è·å GIL
}

PYBIND11_MODULE(fast_img, m) {
    m.def("process_image", &amp;process_image, "Invert image colors (Zero-Copy, release GIL)");
}

</code></pre>
<p><strong>Python ä¾§è°ç¨ç¤ºä¾ï¼</strong></p>
<pre><code class="language-python">import numpy as np
import fast_img

# åå»ºä¸ä¸ª 4K å¾å (3840x2160)
img = np.random.randint(0, 256, (2160, 3840), dtype=np.uint8)

# Case 1: æ­£å¸¸è°ç¨ (åå­è¿ç»­)
# èæ¶ï¼C++ ä¹å°±æ¯æ¯«ç§çº§ï¼Python å¾ªç¯åéè¦æ°ç§
fast_img.process_image(img) 

# Case 2: åçè°ç¨ (åå­ä¸è¿ç»­)
# slice = img[:, ::2] 
# fast_img.process_image(slice) 
# -&gt; RuntimeError: Input array must be C-style contiguous

</code></pre>
<p>éè¿è¿ç§æ¹å¼ï¼æä»¬ä¸ä»å©ç¨äº C++ çæ§è½ï¼è¿ä¿è¯äºç³»ç»ç<strong>é²æ£æ§ (Robustness)</strong>ãè¿ææ¯ç³»ç»æ¶æå¸å¨å¤çè·¨è¯­è¨äºæä½æ¶åºæçæç»´æ¹å¼ã</p>
<h3 id="54-æ»ç»æ¶æå¸çæç»ææ©">5.4. æ»ç»ï¼æ¶æå¸çæç»ææ©</h3>
<p>è³æ­¤ï¼æä»¬ä»åºå±çå­èç ï¼Generatorï¼è®²å°äºåå­ç®¡çï¼Ref Countingï¼ï¼åå°å¹¶åæ¨¡åï¼Asyncio vs GILï¼ï¼æåæç ´äºè¯­è¨çè¾¹çï¼C++ Extensionï¼ã</p>
<p>ä½ä¸ºä¸ä¸ªç³»ç»çº§å¼åèï¼ä½¿ç¨ Python çæä½³å§¿å¿å¹¶éæå®å½ä½âèæ¬âï¼èæ¯æå®å½ä½<strong>è¶æ°´</strong>ï¼</p>
<ol>
<li><strong>æ§å¶æµ (Python):</strong> å¤çå¤æçä¸å¡é»è¾ãéç½®è§£æãREST API ç¼æãå©ç¨å¶å¨æç¹æ§åä¸°å¯ççæã</li>
<li><strong>æ°æ®æµ (C++/Rust):</strong> å¤çç¹éçè®¡ç®ãå¤§è§æ¨¡åå­æä½ãä½å»¶è¿ IOãå©ç¨å¶å¯¹ç¡¬ä»¶çææ§åã</li>
</ol>
<p><strong>Python is slow, but your Architecture doesn't have to be.</strong></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-10 12:01">2026-02-10 12:01</span>&nbsp;
<a href="https://www.cnblogs.com/kaiux">å¿µé£é¶å£¹</a>&nbsp;
éè¯»(<span id="post_view_count">3</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19598962);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19598962', targetLink: 'https://www.cnblogs.com/kaiux/p/19598962', title: 'è§£å Pythonï¼å³äºæéãGIL ä¸å¼æ­¥åæ ¸' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ spring-äºå¡ç®¡ç ]]></title>
    <link>https://www.cnblogs.com/alineverstop/p/19598826</link>
    <guid>5b5b5dde53a13a9d0ea9469c87443fc5</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/alineverstop/p/19598826" title="åå¸äº 2026-02-10 11:39">
    <span role="heading" aria-level="2">spring-äºå¡ç®¡ç</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="äºå¡æ¯æ">äºå¡æ¯æ</h1>
<h2 id="ä»ä¹æ¯äºå¡">ä»ä¹æ¯äºå¡ï¼</h2>
<p>å¨ä¸ä¸ªä¸å¡æµç¨ä¸­ï¼éè¦å¤æ¡DMLï¼insertãdeleteãupdateï¼è¯­å¥èåæè½å®æãè¿äºè¯­å¥å¿é¡»åæ¶æåæèåæ¶å¤±è´¥ãè¿æ ·æè½ä¿è¯æ°æ®å®å¨ã</p>
<p>å¤æ¡DMLåæ¶æåæèåæ¶å¤±è´¥ï¼å«åäºå¡ã</p>
<h3 id="äºå¡å¤ççåä¸ªè¿ç¨">äºå¡å¤ççåä¸ªè¿ç¨</h3>
<ol>
<li>å¼å¯äºå¡</li>
<li>æ§è¡ä¸å¡ä»£ç </li>
<li>æäº¤äºå¡ï¼æ²¡åºç°å¼å¸¸ï¼æäº¤æåãcommit transactionï¼</li>
<li>åæ»äºå¡ï¼åºç°å¼å¸¸ãæ§è¡åæ»äºå¡. rollback transactionï¼</li>
</ol>
<h3 id="äºå¡çåä¸ªç¹æ§acid">äºå¡çåä¸ªç¹æ§ï¼ACIDï¼</h3>
<ol>
<li>Aåå­æ§ï¼äºå¡æ¯æå°çå·¥ä½ååï¼ä¸å¯å</li>
<li>Cä¸è´æ§ï¼äºå¡è¦ä¹åæ¶æåï¼è¦ä¹åæ¶å¤±è´¥</li>
<li>Iéç¦»æ§ï¼äºå¡ä¸äºå¡ä¹é´ä¿è¯åäºä¸å¹²æ°</li>
<li>Dæä¹æ§ï¼æä¹æ§æ¯äºå¡ç»æçæ å¿ã</li>
</ol>
<h2 id="springå¯¹äºå¡çæ¯æ">springå¯¹äºå¡çæ¯æ</h2>
<p>springå®ç°äºå¡ç2ç§æ¹å¼ï¼</p>
<ol>
<li>ç¼ç¨å¼äºå¡ï¼éè¿ç¼åä»£ç çæ¹å¼æ¥å®ç°äºå¡ç®¡ç</li>
<li>å£°æå¼äºå¡ï¼åºäºæ³¨è§£æ¹å¼ååºäºxmlæ¹å¼ï¼æ¨èä½¿ç¨ï¼</li>
</ol>
<h3 id="springäºå¡ç®¡çapi">springäºå¡ç®¡çapi</h3>
<p>springå¯¹äºå¡çç®¡çæ¯åºäºaopå®ç°çãæä»¥springä¸é¨éå¯¹äºå¡å¼åäºä¸å¥apiï¼å¶æ ¸å¿æ¥å£å¦ä¸ï¼PlatformTransactionManager æ¥å£ã</p>
<h3 id="å£°æå¼äºå¡åºäºæ³¨è§£æ¹å¼å®ç°">å£°æå¼äºå¡åºäºæ³¨è§£æ¹å¼å®ç°</h3>
<p>éè¦éç½®xmlæä»¶</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                          http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd" &gt;

&lt;!--    ç»ä»¶æ«æ--&gt;
    &lt;context:component-scan base-package="com.ali" /&gt;

&lt;!--    éç½®æ°æ®æº--&gt;
    &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource"&gt;
        &lt;property name="url" value="jdbc:mysql://localhost:3306/bank"/&gt;
        &lt;property name="username" value="root"/&gt;
        &lt;property name="password" value="123456"/&gt;
        &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt;
    &lt;/bean&gt;
&lt;!--    éç½®jdbcTemplate--&gt;
    &lt;bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate"&gt;
        &lt;property name="dataSource" ref="dataSource"/&gt;
    &lt;/bean&gt;

&lt;!--    éç½®äºå¡ç®¡çå¨--&gt;
    &lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
        &lt;property name="dataSource" ref="dataSource"/&gt;
    &lt;/bean&gt;
&lt;!--    å¼å¯äºå¡æ³¨è§£é©±å¨å¨ï¼å¼å¯äºå¡æ³¨è§£ï¼éè¦å ä¸txçå½åç©ºé´--&gt;
    &lt;tx:annotation-driven transaction-manager="transactionManager"/&gt;
&lt;/beans&gt;
</code></pre>
<p>å¯ä»¥å¨ç±»åæ¹æ³ä¸å @Transactional å¼å¯äºå¡</p>
<ul>
<li>å å¨ç±»ä¸è¡¨ç¤ºè¿ä¸ªç±»ä¸çæææ¹æ³é½å¼å¯äºå¡</li>
<li>å å¨æ¹æ³æ¹æ³ä¸è¡¨ç¤ºåªæè¿ä¸ªæ¹æ³å¼å¯äºå¡</li>
</ul>
<h3 id="äºå¡çä¼ æ­è¡ä¸º">äºå¡çä¼ æ­è¡ä¸º</h3>
<p>ä»ä¹æ¯äºå¡çä¼ æ­è¡ä¸ºï¼</p>
<p>å¨serviceç§æaï¼ï¼åbï¼ï¼2ä¸ªæ¹æ³ï¼aï¼ï¼ä¸æäºå¡ï¼bï¼ï¼ä¸ä¹æäºå¡ï¼å½aï¼ï¼å¨æ§è¡è¿ç¨ä¸­è°ç¨äºbï¼ï¼ï¼äºå¡æ¯å¦ä½ä¼ éçï¼æ¯åå¹¶å°ä¸ä¸ªäºå¡ï¼è¿æ¯å¼å¯ä¸ä¸ªæ°äºå¡ï¼è¿å°±æ¯äºå¡çä¼ æ­è¡ä¸ºã</p>
<p>ä¸å±æ7ç§ä¼ æ­è¡ä¸ºï¼</p>
<ol>
<li>REQUIRD:æ¯æå½åäºå¡ï¼å¦æä¸å­å¨å°±æ°å»ºä¸ä¸ªäºå¡ï¼é»è®¤ï¼ãæ²¡æå°±æ°å»ºï¼æå°±å å¥ã</li>
<li>SUPPORTSï¼æ¯æå½åäºå¡ï¼å¦æå½åæ²¡æäºå¡ï¼å°±ä»¥éäºå¡æ¹å¼æ§è¡ãæå°±å å¥ï¼æ²¡æå°±ä¸ç®¡äºã</li>
<li>MANDATORYï¼å¿é¡»è¿è¡å¨ä¸ä¸ªäºå¡ä¸­ï¼å¦æå½åæ²¡æäºå¡åçï¼å°æåºå¼å¸¸ãæå°±å å¥ï¼æ²¡æå°±æå¼å¸¸ã</li>
<li>REQUIRES_NEWï¼å¼å¯ä¸ä¸ªæ°äºå¡ï¼å¦æä¸ä¸ªäºå¡å·²ç»å­å¨ï¼åå°è¿ä¸ªå­å¨çäºå¡æèµ·ãä¸ç®¡ææ²¡æãç´æ¥å¼å¯ä¸ä¸ªæ°äºå¡ãæ°äºå¡åæ§äºå¡ä¸å­å¨åµå¥å³ç³»ï¼æ§äºå¡è¢«æèµ·äºã</li>
<li>NOT_SUPPORTEDï¼ä»¥éäºå¡æ¹å¼è¿è¡ãå¦ææäºå¡ãåæèµ·å½åäºå¡ãä¸æ¯æäºå¡ï¼å­å¨å°±æèµ·ã</li>
<li>NEVERï¼ä»¥éäºå¡æ¹å¼è¿è¡ãå¦ææäºå¡ãåæå¼å¸¸ãä¸æ¯æäºå¡ï¼å­å¨å°±æå¼å¸¸ã</li>
<li>NESTEDï¼å¦æå½åæä¸ä¸ªäºå¡å¨è¿è¡ä¸­ï¼åè¯¥æ¹æ³åºå½è¿è¡å¨ä¸ä¸ªåµå¥äºå¡ä¸­ãè¢«åµå¥çäºå¡å¯ä»¥ç¬ç«äºå¤å±äºå¡è¿è¡æäº¤æåæ»ãå¦æå¤å±äºå¡ä¸å­å¨ãè¡ä¸ºå°±åREQUIRDä¸æ ·ãæäºå¡çè¯ï¼å°±å¨è¿ä¸ªäºå¡éåµå¥ä¸ä¸ªå®å¨ç¬ç«çäºå¡ï¼åµå¥çäºå¡å¯ä»¥ç¬ç«çæäº¤ååæ»ãæ²¡æäºå¡å°±åREQUIRDä¸æ ·ã</li>
</ol>
<p>å¨ä»£ç ä¸­è®¾ç½®äºå¡çä¼ æ­è¡ä¸ºï¼</p>
<pre><code class="language-java">@Transactional(propagation = Propagation.MANDATORY)
</code></pre>
<h3 id="äºå¡éç¦»çº§å«">äºå¡éç¦»çº§å«</h3>
<p>æ°æ®åºä¸­è¯»åæ°æ®å­å¨ä¸å¤§é®é¢ï¼</p>
<ol>
<li>èè¯»ï¼è¯»åå°æ²¡ææäº¤å°æ°æ®åºçæ°æ®</li>
<li>ä¸å¯éå¤è¯»ï¼å¨åä¸ä¸ªäºå¡ä¸­ï¼ç¬¬ä¸æ¬¡åç¬¬äºæ¬¡è¯»åçæ°æ®ä¸ä¸æ ·</li>
<li>å¹»è¯»ï¼è¯»å°çæ°æ®æ¯åçï¼ï¼</li>
</ol>
<p>äºå¡çéç¦»çº§å«æ4ä¸ªï¼</p>
<ol>
<li>è¯»æªæäº¤READ_UNCOMMITTEDï¼ å­å¨èè¯»ãä¸å¯éå¤è¯»ãå¹»è¯»é®é¢</li>
<li>è¯»æäº¤READ_COMMITTEDï¼äºå¡æäº¤ä¹åæè¯»å°ãå­å¨ä¸å¯éå¤è¯»ãå¹»è¯»é®é¢</li>
<li>å¯éå¤è¯»REPEATABLE_READï¼è§£å³ä¸å¯éå¤è¯»çé®é¢ï¼å­å¨å¹»è¯»é®é¢</li>
<li>åºååSERIALIZABLEï¼è§£å³å¹»è¯»é®é¢ï¼äºå¡æéæ§è¡ãä¸æ¯æå¹¶åã</li>
</ol>
<p><strong>MySQLé»è®¤å¯éå¤è¯»ï¼Oracleé»è®¤è¯»æäº¤</strong></p>
<p>ä»å¨è¯»çäºå¡ä¸­è®¾ç½®éç¦»çº§å«å°±è¡ï¼åçäºå¡æ²¡å¿è¦è®¾ç½®</p>
<p>ä»£ç ä¸­è®¾ç½®äºå¡çéç¦»çº§å«ï¼</p>
<pre><code class="language-java">@Transactional(isolation = Isolation.DEFAULT)
</code></pre>
<h3 id="äºå¡è¶æ¶">äºå¡è¶æ¶</h3>
<pre><code class="language-java">@Transactional(timeout = 10)
</code></pre>
<p>ä»¥ä¸ä»£ç è®¾ç½®äºå¡è¶æ¶æ¶é´ä¸º10s</p>
<p>è¡¨ç¤ºè¶è¿10sï¼å¦æäºå¡ä¸­ææçDMLè¯­å¥è¿æ²¡ææ§è¡å®æ¯çè¯ï¼æç»ç»æä¼åæ»ã</p>
<p>é»è®¤å¼-1ï¼è¡¨ç¤ºæ²¡ææ¶é´éå¶ã</p>
<p><strong>äºå¡çè¶æ¶æ¶é´å¼å¾æ¯åªæ®µæ¶é´ï¼</strong></p>
<p>å¨å½åäºå¡ä¸­ï¼æåä¸æ¡DMLè¯­å¥æ§è¡ä¹åçæ¶é´ï¼å¦ææåä¸æ¡DMLè¯­å¥åé¢æå¾å¤ä¸å¡é»è¾ï¼è¿äºä¸å¡ä»£ç æ§è¡çæ¶é´ä¸è¢«è®¡å¥è¶æ¶æ¶é´ã</p>
<h3 id="åªè¯»äºå¡">åªè¯»äºå¡</h3>
<pre><code class="language-java">@Transactional(readOnly = true)
</code></pre>
<p>å°å½åäºå¡è®¾ä¸ºåªè¯»äºå¡ï¼å¨è¯¥äºå¡ä¸­åªåè®¸æ§è¡select è¯­å¥ã</p>
<p>è¯¥ç¹æ§çä½ç¨æ¯ï¼å¯å¨springçä¼åç­ç¥ãæé«selectè¯­å¥çæ§è¡æçã</p>
<h3 id="è®¾ç½®åªäºå¼å¸¸åæ»äºå¡">è®¾ç½®åªäºå¼å¸¸åæ»äºå¡</h3>
<pre><code class="language-java">@Transactional(rollbackFor = RuntimeException.class)
</code></pre>
<p>è¡¨ç¤ºåçRuntimeExceptionå¼å¸¸æè¯¥å¼å¸¸çå­ç±»å¼å¸¸æåæ»</p>
<h3 id="è®¾ç½®åªäºå¼å¸¸ä¸åæ»äºå¡">è®¾ç½®åªäºå¼å¸¸ä¸åæ»äºå¡</h3>
<pre><code class="language-java">@Transactional(noRollbackFor = NullPointerException.class)
</code></pre>
<p>è¡¨ç¤ºåçNullPointerExceptionå¼å¸¸æè¯¥å¼å¸¸çå­ç±»ä¸åæ»ï¼å¶ä»å¼å¸¸æåæ»</p>
<h3 id="äºå¡çå¨æ³¨è§£å¼å¼å">äºå¡çå¨æ³¨è§£å¼å¼å</h3>
<p>ç¼åéç½®ç±»</p>
<pre><code class="language-java">@Configuration // ä»£æ¿xmléç½®æä»¶
@ComponentScan("com.ali") // æ«æcom.aliåä¸çææç±»
@EnableTransactionManagement // å¼å¯äºå¡ç®¡ç
public class Spring6Config {

    // @Beanæ³¨è§£ç¨äºå°æ¹æ³çè¿åå¼æ³¨åä¸ºSpringå®¹å¨ä¸­çä¸ä¸ªBean
    @Bean(name = "druidDataSource")
    public DruidDataSource druidDataSource() {
        DruidDataSource druidDataSource = new DruidDataSource();
        druidDataSource.setUrl("jdbc:mysql://localhost:3306/spring6?useSSL=false&amp;serverTimezone=UTC");
        druidDataSource.setUsername("root");
        druidDataSource.setDriverClassName("com.mysql.jdbc.Driver");
        druidDataSource.setPassword("123456");
        return druidDataSource;
    }

    @Bean(name = "transactionManager")
    public DataSourceTransactionManager transactionManager(DataSource dataSource) {
        DataSourceTransactionManager transactionManager = new DataSourceTransactionManager();
        transactionManager.setDataSource(dataSource);
        return transactionManager;
    }

    @Bean(name = "jdbcTemplate")
    // è¯¥æ¹æ³çåæ°DataSource dataSourceä¼èªå¨ä»Springå®¹å¨ä¸­æ¾å°ç±»åä¸ºDataSourceçBeanå¹¶æ³¨å¥
    public JdbcTemplate jdbcTemplate(DataSource dataSource) {
        JdbcTemplate jdbcTemplate = new JdbcTemplate();
        jdbcTemplate.setDataSource(dataSource);
        return jdbcTemplate;
    }
}
</code></pre>
<p>ä½¿ç¨æ¶åå¶ä»æ¹å¼ä¸æ ·ã</p>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/alineverstop/" target="_blank">NE_STOP</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/alineverstop/p/19598826" target="_blank">https://www.cnblogs.com/alineverstop/p/19598826</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-10 11:39">2026-02-10 11:39</span>&nbsp;
<a href="https://www.cnblogs.com/alineverstop">NE_STOP</a>&nbsp;
éè¯»(<span id="post_view_count">3</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19598826);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19598826', targetLink: 'https://www.cnblogs.com/alineverstop/p/19598826', title: 'spring-äºå¡ç®¡ç' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ£å­Cozeå®æï¼ä¸é®æé èªå·±çå£æ­æ°å­äººè§é¢ï¼ä¿å§çº§æç¨ï¼ ]]></title>
    <link>https://www.cnblogs.com/tangshiye/p/19598717</link>
    <guid>80d27e0510c07f4d660a2f294d160bd0</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/tangshiye/p/19598717" title="åå¸äº 2026-02-10 11:22">
    <span role="heading" aria-level="2">æ£å­Cozeå®æï¼ä¸é®æé èªå·±çå£æ­æ°å­äººè§é¢ï¼ä¿å§çº§æç¨ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¤§å®¶å¥½ï¼ææ¯æ±¤å¸ç·ï¼ä¸æ³¨AIæºè½ä½åäº«~</p>
<p>ç¸ä¿¡æä¸å°æåå¨é®ï¼ææ²¡æåæ³ä¸åºå¢ï¼ä¹è½æåºä¸ä¸çå£æ­è§é¢ï¼</p>
<p>æ¯ç«å¾å¤æ¶åï¼æä»¬æ³åäº«åå®¹ï¼å´å ä¸ºä¸æ¢åºéï¼è¿è¿ä¸æ¢å¼å§ã</p>
<p>å½å¶è§é¢æ¶æ»æ¯è§å¾èªå·±è¡¨æä¸èªç¶ï¼ä¸éééå½ã</p>
<p>æ°æææå¸¸è§çä¸å¤§é¾é¢ï¼è®©å¾å¤äººæèå´æ­¥ï¼</p>
<p><strong>1. éå¤´ææ§</strong></p>
<p>é¢å¯¹éå¤´æ¶å®¹æç´§å¼ ãç»å·´ï¼çè³å®å¨å¿è®°åå¤å¥½çå°è¯ã</p>
<p>å¾å¤äººéè¦åå¤ææå åæ¬¡æè½å®æä¸ä¸ªç®åççæ®µï¼è¿ä¸¥éå½±åäºæææçã<br>
<strong>2. è¡¨ç°åä¸è¶³</strong></p>
<p>å³ä½¿åæäºç´§å¼ æï¼å¾å¤æ°æå¨éå¤´åä¾ç¶æ¾å¾çç¡¬ãä¸èªç¶ã</p>
<p>è¯­æ°å¹³æ·¡ãè¡¨æåµç¡¬ãè¢ä½å¨ä½ä¸åè°ç­é®é¢éè¦å¤§éç»ä¹ æè½æ¹åï¼è¿ä¸ªè¿ç¨å¾å¾éè¦å ä¸ªæçè³æ´é¿æ¶é´ã<br>
<strong>3. ææ¬åå</strong></p>
<p>æ³è¦å¶ä½ä¼è´¨è§é¢ï¼æå¥ææ¬è¿è¶å¾å¤äººçæ³è±¡ã</p>
<p>ä¸ä»è¦ç§ç¨ä¸ä¸çåºå°åè®¾å¤ï¼å¦è¡¥åç¯ãæåæºãæ¶é³è®¾å¤ç­ï¼ï¼è¿éè¦èè¯·ä¸ä¸å¢éï¼åæ¬åå¦å¸ãæåå¸ãåªè¾å¸ç­ï¼ï¼è¿äºæ¯åºå èµ·æ¥å¾å¾è®©åä½èæèå´æ­¥ã</p>
<p>ä»å¤©æå°±æä½ æ­å»ºä¸ä¸ªå£æ­æ°å­äººæºè½ä½ï¼ä¸é²è¸ä¹è½è½»æ¾æå®ã</p>
<p>åå©Cozeå·¥ä½æµï¼ç´æ¥ç¨ææ¡å°±è½çæé¼ççæ°å­äººå£æ­è§é¢ã</p>
<p>ç¯å¹ä¸ç­ï¼æ¬¢è¿åæ¶èï¼åæ¢æ¢çãå¦æè§å¾æå¸®å©ï¼ä¹è¯·é¡ºæç¹ä¸ªèµãå¨çãè½¬åæ¯æä¸ä¸~</p>
<h3 id="1éæ©æ°å­äººæä»¶">1.éæ©æ°å­äººæä»¶</h3>
<p>Cozeæ¬èº«å¹¶æ²¡ææä¾å®æ¹çæ°å­äººæä»¶ï¼ä½å¸é¢ä¸å´æå¾å¤ç¬¬ä¸æ¹æä»¶å¯ä»¥ç¨ã</p>
<p>ä»å¤©æä»¬è¦ç¨å°çï¼å°±æ¯ãé£å½±æ°å­äººæä»¶ãã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201196-1630936675.jpg" class="lazyload"></p>
<p>æä»¶è¿ä¹å¤ï¼æä»¬æä¹éå¢ï¼</p>
<p>å»ºè®®å¤§å®¶å³æ³¨å ä¸ªæ ¸å¿ææ ï¼æºè½ä½ä½¿ç¨æ°ãè°ç¨éãæåçãæ§è¡æ¶é´ã</p>
<p>è¿äºæ°æ®ï¼å¯ä»¥å¸®å©æä»¬å¿«éç­éåºä¼è´¨çæä»¶ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201185-2025723018.jpg" class="lazyload"></p>
<h2 id="2-åæåå¤é¶æ®µ">2. åæåå¤é¶æ®µ</h2>
<p>å¨æ­å»ºå£æ­æ°å­äººæºè½ä½ä¹åï¼éè¦åå¤ä»¥ä¸ä»»å¡ï¼</p>
<ol>
<li>ç»éé£å½±å®ç½ï¼<a href="https://hifly.cc/?promoterCode=XmcyWURYbnVW77Vn" target="_blank" rel="noopener nofollow">https://hifly.cc?promoterCode=XmcyWURYbnVW77Vn</a>ï¼</li>
<li>åéèªå·±çä¸å±æ°å­äººå½¢è±¡å¤ç¨ã</li>
<li>åéèªå·±çå£°é³å¤ç¨ã</li>
</ol>
<p>å®ææ°å­äººåå£°é³åéåï¼æä»¬å°±å¯ä»¥å¼å§æ­å»ºå£æ­æ°å­äººæºè½ä½äºã</p>
<h2 id="3æºè½ä½çæ­å»ºæµç¨">3.æºè½ä½çæ­å»ºæµç¨</h2>
<p>æºè½ä½çæ­å»ºæµç¨ä¸»è¦åä¸ºä¸¤ä¸ªæ­¥éª¤ï¼æ¢³çå·¥ä½æµãè®¾ç½®æºè½ä½ã</p>
<h3 id="31-æ¢³çå·¥ä½æµ"><strong>3.1 æ¢³çå·¥ä½æµ</strong></h3>
<p>å°å£æ­æ°å­äººè§é¢åä½æµç¨ï¼è½¬åä¸ºå¯èªå¨åè¿è¡çå·¥ä½æµèç¹ã</p>
<ol>
<li>éè¿å¼å§èç¹ï¼æ¶éå¿è¦çåæ°</li>
<li>ä½¿ç¨é£å½±æ°å­äººæä»¶ï¼ä¸é®çææ°å­äººè§é¢</li>
<li>çæ§æ°å­äººçä»»å¡ç¶æï¼ç´å°ä»»å¡å®æ</li>
<li>è¾åºæ°å­äººçè§é¢é¾æ¥</li>
</ol>
<h3 id="32-è®¾ç½®æºè½ä½">3.2 è®¾ç½®æºè½ä½</h3>
<ol>
<li>è®¾ç½®äººè®¾ä¸é»è¾ï¼éç½®å£æ­æ°å­äººæºè½ä½çå³ç­é»è¾</li>
<li>è®¾ç½®å¿«æ·æä»¤ï¼éç½®æºè½åçå¿«æ·æä»¤ï¼è®©æºè½ä½æ´å¿«éãä¾¿æ·å°ååºç¨æ·çéæ±</li>
<li>æµè¯å¹¶åå¸ï¼å¨é¢çåè½æµè¯ï¼ç¡®è®¤æ­£å¸¸åï¼å°æºè½ä½æ­£å¼åå¸å°çäº§ç¯å¢</li>
</ol>
<h2 id="4åå»ºå·¥ä½æµ">4.åå»ºå·¥ä½æµ</h2>
<p>ç»å½Cozeå®ç½ï¼å¨âèµæºåº-å·¥ä½æµâéæ°å»ºä¸ä¸ªç©ºç½å·¥ä½æµï¼ååâspoken_digital_humanâã</p>
<h3 id="31-å¼å§èç¹">3.1 å¼å§èç¹</h3>
<ul>
<li>è¾å¥ï¼
<ul>
<li>hifly_idï¼hifly_agent_tokenï¼é£å½±æ°å­äººäº§åçç§é¥</li>
<li>speaker_idï¼åéå£°é³ ID</li>
<li>digital_human_idï¼åéæ°å­äºº ID</li>
<li>textï¼è§é¢ææ¡</li>
</ul>
</li>
</ul>
<p><strong>å³äºhifly_idãspeaker_idãdigital_human_idå¦ä½è·åï¼ä¸æä¼éç¹ä»ç»ã</strong></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201443-1723189816.jpg" class="lazyload"></p>
<h3 id="32-ä¸é®çææ°å­äººè§é¢">3.2 ä¸é®çææ°å­äººè§é¢</h3>
<p>æä»¬å°ä½¿ç¨ãé£å½±æ°å­äººãæä»¶çcreate_lipsync_video2åè½ã</p>
<p>éè¿è¿ä¸ªåè½ï¼æä»¬å¯ä»¥ä¸é®çæå£æ­æ°å­äººè§é¢ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201445-728456624.jpg" class="lazyload"></p>
<p>æä»¬éæ©é£å½±æ°å­äººæä»¶çcreate_lipsync_video2åè½ï¼æä»¶èç¹å½åä¸ºãä¸é®çææ°å­äººè§é¢ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201181-1007614087.jpg" class="lazyload"></p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>hifly_idï¼å¼å§ - hifly_id</li>
<li>speaker_idï¼å¼å§ - speaker_id</li>
<li>digital_human_idï¼å¼å§ - digital_human_id</li>
<li>textï¼å¼å§ - text</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201549-1924044982.jpg" class="lazyload"></p>
<h3 id="33-è®¾å®å¾ªç¯æ¯10sçæ§ä»»å¡çç¶æ">3.3 è®¾å®å¾ªç¯ï¼æ¯10Sçæ§ä»»å¡çç¶æ</h3>
<p>æ°å­äººè§é¢çæéå¸¸éè¦å åéï¼æä»¬ä¼ç¨ä»»å¡æ¥è¯¢æä»¶ï¼è®¾å®ä¸ä¸ªæ éå¾ªç¯ï¼æ¯é10ç§å°±èªå¨æ£æ¥ä¸æ¬¡ã</p>
<p>å½æä»¶è¿åä»»å¡å®æç¶ææ¶ï¼å°±ä¼èªå¨åæ­¢å¾ªç¯ï¼çæçè§é¢é¾æ¥å°±è½é¡ºå©æ¿å°ã</p>
<p>æä»¬å°è®¾å®ãå¾ªç¯ãèç¹ï¼æ¯10Sçæ§ä»»å¡çç¶æã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201179-2017203599.jpg" class="lazyload"></p>
<ul>
<li>å¾ªç¯è®¾ç½®ï¼æ éå¾ªç¯</li>
<li>è¾åºï¼
<ul>
<li>outputï¼çæ§æ°å­äººçä»»å¡ç¶æ - video_Url</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201439-1489400554.jpg" class="lazyload"></p>
<h3 id="35-éç½®å¾ªç¯ä½">3.5 éç½®å¾ªç¯ä½</h3>
<p><strong>1.æä»¬å°ä½¿ç¨ãé£å½±æ°å­äººãæä»¶çinspect_video_creation_statusåè½ã</strong></p>
<p>çæ§ä»»å¡çç¶æï¼å½ä»»å¡å®æåï¼è¾åºæ°å­äººè§é¢çé¾æ¥ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201458-454387379.jpg" class="lazyload"></p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>job_idï¼ä½åIDï¼ä¸é®çææ°å­äººè§é¢-job_id</li>
<li>hifly_idï¼å¼å§-hifly_id</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201268-688786360.jpg" class="lazyload"></p>
<p><strong>2.éè¿éæ©å¨èç¹ï¼å¤æ­ä»»å¡æ¯å¦å®æã</strong></p>
<p>å¦æçæ§æ°å­äººçä»»å¡ç¶æ - status = 2ï¼è¯´æè§é¢è¿å¨çæä¸­ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201233-1129989602.jpg" class="lazyload"></p>
<p><strong>3.å¦æè§é¢è¿å¨çæä¸­ï¼åä½¿ç¨ãå®æ¶å¨ãæä»¶ï¼ç­å¾10ç§ã</strong></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201453-1568123775.jpg" class="lazyload"></p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>secondsï¼ç­å¾æ¶é´</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201393-1645039480.jpg" class="lazyload"></p>
<p><strong>4.å¦æè§é¢çæå®æï¼åä½¿ç¨ãç»æ­¢å¾ªç¯ãæä»¶ã</strong></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201450-916233180.jpg" class="lazyload"></p>
<h3 id="36-ç»æèç¹è¾åºæ°å­äººè§é¢é¾æ¥">3.6 ç»æèç¹ï¼è¾åºæ°å­äººè§é¢é¾æ¥</h3>
<ul>
<li>è¾åºï¼
<ul>
<li>outputï¼è®¾å®å¾ªç¯ï¼æ¯10Sçæ§ä»»å¡çç¶æ-output</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201423-297794017.jpg" class="lazyload"></p>
<p>è¿æ ·ï¼å·¥ä½æµå°±æ­å»ºå¥½äºï¼æåç¹å»åå¸å·¥ä½æµã</p>
<h2 id="4åå»ºæºè½ä½">4.åå»ºæºè½ä½</h2>
<h3 id="41-æ°å»ºæºè½ä½">4.1 æ°å»ºæºè½ä½</h3>
<p>å¨Cozeå¹³å°åå»ºä¸ä¸ªæ°çæºè½ä½ï¼å½åâå£æ­æ°å­äººæºè½ä½âã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201456-1475184476.jpg" class="lazyload"></p>
<h3 id="42-è®¾ç½®äººè®¾ä¸é»è¾">4.2 è®¾ç½®äººè®¾ä¸é»è¾</h3>
<p>éç½®æºè½ä½çç¹å¾ãåå¤é£æ ¼åå³ç­é»è¾ã</p>
<pre><code class="language-markdown"># è§è²
ä½ æ¯å£æ­è§é¢çæç¥å¨ï¼è´è´£å¤çç¨æ·ä¸ä¼ çè§é¢ãææ¬æé³é¢ï¼çæä¸å±å®å¶æ°å­äººè§é¢ï¼å¹¶æä¾ç¸å³æå¡ã

## æè½
### æè½ 1: çæå¹¶åé¦è§é¢
1. æ¥æ¶ç¨æ·ä¸ä¼ çè§é¢ãææ¬æé³é¢åï¼å¯å¨åä¸ºâæ°å­äººè§é¢çæâçå·¥ä½æµè¿è¡å¤çã
2. å¨å·¥ä½æµè¿è¡å®æ¯åï¼åç¨æ·å±ç¤ºçæçè§é¢é¾æ¥ï¼å¹¶å»ºè®®ç¨æ·å¤å¶é¾æ¥ä¸è½½è§é¢ã

## éå¶
- ä¸¥æ ¼å¨âæ°å­äººè§é¢çæâå·¥ä½æµè¿è¡ç»æåï¼æè¦æ±å±ç¤ºè§é¢é¾æ¥å¹¶ç»åºä¸è½½å»ºè®®ã
- å°âæ°å­äººè§é¢çæâå·¥ä½æµæ·»å è¿æºè½ä½ã
</code></pre>
<h3 id="43-è®¾ç½®å¿«æ·æä»¤">4.3 è®¾ç½®å¿«æ·æä»¤</h3>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201387-1857024676.jpg" class="lazyload"></p>
<p><strong>1.æé®åç§°ï¼æ ¹æ®ææ¬ï¼çæå£æ­æ°å­äººè§é¢</strong></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201351-952019553.jpg" class="lazyload"></p>
<p><strong>2.æä»¤åç§°ï¼digital_human</strong></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201230-1187322886.jpg" class="lazyload"></p>
<p><strong>3.å·¥å·ï¼ç´æ¥ä½¿ç¨å·¥ä½æµ</strong></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201468-273146057.jpg" class="lazyload"></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201178-1399095360.jpg" class="lazyload"></p>
<p><strong>4.æä»¤åå®¹ï¼çææ°å­äººè§é¢ {{digital_human_id}}{{hifly_id}}{{speaker_id}}{{text}}</strong></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201379-895143177.jpg" class="lazyload"></p>
<h3 id="44-æµè¯å¹¶åå¸">4.4 æµè¯å¹¶åå¸</h3>
<p>å¨é¢çåè½æµè¯ï¼ç¡®è®¤æ­£å¸¸åï¼å°æºè½ä½æ­£å¼åå¸å°çäº§ç¯å¢ã</p>
<p><strong>1.ç¹å»å¿«æ·æé®ï¼æ ¹æ®ææ¬ï¼çæå£æ­æ°å­äººè§é¢</strong></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201445-340123184.jpg" class="lazyload"></p>
<p><strong>2.è·åhifly_id</strong></p>
<p>hifly_idå°±æ¯é£å½±æ°å­äººä¼åçç§é¥ï¼hifly_agent_tokenï¼å¨ä¸ªäººä¸­å¿è·åã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201218-2017836565.jpg" class="lazyload"></p>
<p><strong>3.è·åspeaker_id</strong></p>
<p>speaker_idæ¯åéå£°é³ IDï¼å¨å£°é³åéèåä¸ï¼è·åå£°é³ IDã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201458-1821932218.jpg" class="lazyload"></p>
<p><strong>4.è·ådigital_human_id</strong></p>
<p>digital_human_idæ¯åéæ°å­äºº IDï¼å¨æ°å­äººèåä¸ï¼è·åç´ æ IDã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201212-701996376.jpg" class="lazyload"></p>
<p><strong>5.å¡«åææåæ°ï¼å¹¶æµè¯æºè½ä½</strong></p>
<ul>
<li>hifly_idï¼hifly_agent_tokenï¼é£å½±æ°å­äººäº§åçç§é¥</li>
<li>speaker_idï¼åéå£°é³ ID</li>
<li>digital_human_idï¼åéæ°å­äºº ID</li>
<li>textï¼è§é¢ææ¡</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201397-292038925.jpg" class="lazyload"></p>
<p>æ§è¡åï¼ä¼è¾åºæ°å­äººè§é¢çé¾æ¥ï¼</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260210112201233-213412221.jpg" class="lazyload"></p>
<p>æåï¼ç¨åªæ ç»è§é¢å ä¸é³ä¹åå­å¹ï¼å°±å¯ä»¥çææç»çå£æ­è§é¢å¦~</p>
<h2 id="5æ»ç»">5.æ»ç»</h2>
<p>éè¿æ¬æçä»ç»ï¼æä»¬å­¦ä¼äºå¦ä½ä½¿ç¨Cozeå·¥ä½æµåé£å½±æ°å­äººæä»¶ï¼è½»æ¾æé ä¸ä¸ªä¸ä¸çå£æ­æ°å­äººæºè½ä½ã</p>
<p>è¿å¥æ¹æ¡ä¸ä»è®©æä»¬æè±äºåºéçå°æ°ï¼è¿è½å¤§å¤§æååå®¹åä½çæçã</p>
<p>å¸æè¿ä¸ªæ¹æ³è½å¸®å©ä½ æ´å¥½å°ä¼ éä»·å¼ï¼åä½åºæ´å¤ä¼è´¨çåå®¹ã</p>
<p>å¦æä½ è§å¾è¿ç¯æç« å¯¹ä½ æå¸®å©ï¼æ¬¢è¿ç¹èµãæ¶èï¼ä¸è¿·è·¯ï¼å¹¶è½¬åç»æéè¦çæå</p>
<p>ä½ çæ¯ä¸æ¬¡äºå¨é½æ¯ææç»­åä½çå¨åï¼æè°¢æ¯æï½</p>
<blockquote>
<p>å¯¹äºï¼ææ´çäºä¸ä»½å¼æºãæºè½ä½å­¦ä¹ æåãï¼çè 10 ä¸å­ï¼ä»·å¼ 999 åãéæ¶å¼æ¾é¢åðï¼<a href="https://tangshiye.cn" target="_blank" rel="noopener nofollow">tangshiye.cn</a></p>
</blockquote>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/tangshiye/" target="_blank">AIæ¶æå¸æ±¤å¸ç·</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/tangshiye/p/19598717" target="_blank">https://www.cnblogs.com/tangshiye/p/19598717</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-10 11:22">2026-02-10 11:22</span>&nbsp;
<a href="https://www.cnblogs.com/tangshiye">AIæ¶æå¸æ±¤å¸ç·</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19598717);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19598717', targetLink: 'https://www.cnblogs.com/tangshiye/p/19598717', title: 'æ£å­Cozeå®æï¼ä¸é®æé èªå·±çå£æ­æ°å­äººè§é¢ï¼ä¿å§çº§æç¨ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åºäºDWSçåéè®¡ç®åè½å®ç°ç®åçååæç´¢æ¨èç³»ç» ]]></title>
    <link>https://www.cnblogs.com/huaweiyun/p/19598674</link>
    <guid>950e788755b79bc077f8b607225cdefe</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huaweiyun/p/19598674" title="åå¸äº 2026-02-10 11:14">
    <span role="heading" aria-level="2">åºäºDWSçåéè®¡ç®åè½å®ç°ç®åçååæç´¢æ¨èç³»ç»</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p data-tool="mdniceç¼è¾å¨">æ¬æåäº«èªåä¸ºäºç¤¾åºã<a href="https://bbs.huaweicloud.com/blogs/470986?utm_source=oschina&amp;utm_medium=bbs-ex&amp;utm_campaign=other&amp;utm_content=content" target="_blank" rel="noopener nofollow">åºäºDWSçåéè®¡ç®åè½å®ç°ç®åçååæç´¢æ¨èç³»ç»</a>ã</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content">1. åè¨</span></span></h2>
<ul data-tool="mdniceç¼è¾å¨">
<li>éç¨çæ¬ï¼ã9.1.1.200ï¼åä»¥ä¸ï¼ã</li>
</ul>
<p data-tool="mdniceç¼è¾å¨">å¨çæå¼ AI ä¸å¤§æ¨¡åï¼LLMï¼éå¡ææ¯æ çä»å¤©ï¼æ°æ®å¤ççéæ±å·²ç»ä»åä¸çâç²¾ç¡®å¹éâè½¬åäºâè¯­ä¹çè§£âãä¼ ç»çæ°æ®åºç³»ç»å¨å¤çç»æåæ°æ®ï¼å¦è®¢åéé¢ãç¨æ·IDï¼æ¹é¢è¡¨ç°å®ç¾ï¼ä½å¨é¢å¯¹ AI æ¶ä»£çåçéç»æåæ°æ®ï¼ææ¬ãå¾åãé³è§é¢ï¼æ¶ï¼åºäºå³é®è¯æç´¢çä¼ ç»æ¹å¼ç±äºæ æ³çè§£æ°æ®æ¬èº«èåçâ<strong>ææ</strong>âä»èæ¾å¾åä¸ä»å¿ã</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ ¸å¿çç¹</strong>ï¼ä¼ ç»æ°æ®åºæ¬è´¨ä¸ä¾èµç²¾ç¡®å¹éï¼exact matchï¼æå­æ®µç´¢å¼æ¥è¯¢ï¼ç¼ºå°ä»¥â<strong>å«ä¹</strong>âä¸ºä¸­å¿çæ¨¡ç³ç¸ä¼¼æç´¢è½åãAIç¸å³åºç¨ä¸æ¨èç³»ç»åºæ¯å¸¦æ¥äºæµ·éåéæ£ç´¢éæ±ï¼ç¸ä¼¼æ§æç´¢æ¯æ ¸å¿éæ±ï¼å¯¹åéæ°æ®åºå¸¸è§åºç¨åºæ¯ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li>
<p>ä»¥ææå¾/ä»¥å¾æå¾ï¼ æ¾å°ä¸è¾å¥å¾çæç¸ä¼¼çå¾ç</p>
</li>
<li>
<p>æºè½é®ç­/RAGï¼å¨ç¥è¯åºä¸­æ¾å°ä¸ç¨æ·é®é¢æç¸å³çææ¡£çæ®µ</p>
</li>
<li>
<p>æ¨èç³»ç»ï¼æ¾å°ä¸ç¨æ·å´è¶£åéæç¸ä¼¼çåå</p>
</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>è§£å³æ¹æ¡</strong>ï¼DWSéæ pgvector(0.8.0) æä»¶ï¼å¯ææå¼å è½½ï¼å®ç°åºååéè®¡ç®æ£ç´¢è½åã</p>
<p data-tool="mdniceç¼è¾å¨"><strong>å®ä¹</strong>ï¼ DWSåéè®¡ç®å¹¶éç¬ç«çæ°æ®åºç³»ç»ï¼èæ¯éè¿æä»¶å½¢å¼æ©å±ä¼ ç»æ°æ®åºåè½ï¼ä½¿å¶è½å¤å¤çé«ç»´åéæ°æ®ï¼æ éç¨æ·è¿å¾æ°æ®æéæåºç¨æ¶æï¼å³å¯å¨ç°æç³»ç»ä¸­å®ç°åéæ£ç´¢ç¸å³åè½ã</p>
<img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202602/2030258-20260210111417580-912227321.png" class="lazyload"><br>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content">2. DWSåéè®¡ç®åè½ç®ä»</span></span></h2>
<ol data-tool="mdniceç¼è¾å¨">
<li>åéæ°æ®ç±»åï¼</li>
</ol>
<p><img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202602/2030258-20260210111417526-2044915800.png" class="lazyload"></p>
<ol start="2" data-tool="mdniceç¼è¾å¨">
<li>åéè·ç¦»/ç¸ä¼¼åº¦æä½ç¬¦ï¼&nbsp;</li>
</ol>
<p><img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202602/2030258-20260210111417523-2102871759.png" class="lazyload"></p>
<ol start="3" data-tool="mdniceç¼è¾å¨">
<li>ç´¢å¼ç±»åï¼</li>
</ol>
<p><img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202602/2030258-20260210111417561-1899020612.png" class="lazyload"></p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content">3. å®æ´ç¤ºä¾</span></span></h2>
<p data-tool="mdniceç¼è¾å¨">åè®¾æä»¬æ­£å¨åä¸ä¸ªååæ¨èæç´¢ç³»ç»ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li>ååæ¬èº«ææ é¢ãæè¿°ãåç±»ãä»·æ ¼ç­å­æ®µ</li>
<li>åå©å¤§æ¨¡åembeddingè½åï¼æä»¬è½å¤å°ååæè¿°ç¼ç ä¸ºåé</li>
<li>åæ ·çï¼å°ç¨æ·çæç´¢å³é®å­ä¹è½¬åä¸ºåé</li>
<li><strong>ç®ç</strong>ï¼éè¿<strong>ç¸ä¼¼æ§</strong>æç´¢æ¾åºæç¬¦åç¨æ·<strong>æç´¢æå¾</strong>çåå</li>
</ul>
<blockquote class="custom-blockquote multiquote-1" data-tool="mdniceç¼è¾å¨">
<p>å¦éä½¿ç¨åéè®¡ç®åè½ï¼è¯·èç³»ææ¯æ¯æä¿®æ¹feature_support_optionsåæ°, å¼å¯enable_pgvectoréé¡¹ãè¯¦ç»è¯­æ³ä»ç»ï¼è¯·åèDWSäº§åææ¡£ <a href="https://support.huaweicloud.com/devg-911-dws/dws_04_1462.html" rel="noopener nofollow">åéè®¡ç®</a>ç« è</p>
</blockquote>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content">3.1 åºç¡æ¥è¯¢</span></span></h3>
<ol data-tool="mdniceç¼è¾å¨">
<li>
<p>å®è£æ©å±ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">create extension pgvector;</pre>
</div>
</li>
<li>
<p>åå»ºååè¡¨ï¼å¨å­åéembeddingï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">CREATE TABLE products (
    id bigserial PRIMARY KEY,
    title text,
    description text,
    price numeric,
    embedding vector(768)   --768ç»´åéï¼ç±ååæè¿°(description)çæ
);</pre>
</div>
</li>
<li>
<p>æå¥æ°æ®</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">INSERT INTO products (title, description, price, embedding) VALUES
('Wireless Earbuds', 'Bluetooth wireless earbuds with charging case', 59.9, '[0.12, 0.34, -0.21, ...]'),
('Noise Cancelling Headphones', 'Over-ear headphones with active noise cancellation', 129.9, '[0.11, 0.36, -0.19, ...]'),
('Gaming Headset', 'Wired gaming headset with microphone', 79.9, '[0.10, 0.33, -0.25, ...]'),
('Smartphone Stand', 'Adjustable phone stand for desk use', 12.9, '[0.45, -0.12, 0.08, ...]'),
('USB-C Charger', 'Fast charging USB-C power adapter', 19.9, '[0.42, -0.15, 0.05, ...]'),
('Mechanical Keyboard', 'Mechanical keyboard with blue switches', 89.9, '[0.55, 0.02, -0.31, ...]'),
('Wireless Mouse', 'Ergonomic wireless mouse', 29.9, '[0.53, 0.01, -0.28, ...]'),
('Laptop Backpack', 'Water-resistant laptop backpack', 49.9, '[0.60, -0.05, -0.10, ...]'),
('4K Monitor', '27-inch 4K UHD computer monitor', 299.9, '[0.58, 0.04, -0.35, ...]'),
('Webcam', 'HD webcam for video conferencing', 39.9, '[0.52, -0.01, -0.20, ...]'),
('Bluetooth Speaker', 'Portable Bluetooth speaker with deep bass', 45.9, '[0.14, 0.30, -0.18, ...]'),
('Smart Watch', 'Fitness tracking smart watch', 99.9, '[0.20, 0.40, -0.22, ...]'),
('Fitness Tracker', 'Lightweight activity and sleep tracker', 49.9, '[0.22, 0.38, -0.24, ...]'),
('Tablet Stylus', 'Stylus pen for tablets', 25.9, '[0.48, -0.10, 0.12, ...]'),
('Laptop Cooling Pad', 'Cooling pad with dual fans', 34.9, '[0.57, -0.02, -0.15, ...]');</pre>
</div>
</li>
<li>
<p>ç¸ä¼¼åº¦æ¥è¯¢ï¼</p>
<p>éè¿ä»¥ä¸æ¥è¯¢ï¼è½å¤è·åä¸ç¨æ·åéç¸ä¼¼åº¦æé«/è·ç¦»æè¿çtopkä¸ªåå</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">SELECT id, title, price
FROM products
ORDER BY embedding &lt;-&gt; '[0.091, -0.054, 0.92, ...]'   -- ç¨æ·åé, éè¿L2è·ç¦»è®¡ç®ç¸ä¼¼åº¦
LIMIT 10;</pre>
</div>
</li>
<li>
<p>æ··åæ¥è¯¢:</p>
<p>DWSåéè®¡ç®æ¯æä¼ ç»è¿æ»¤æ¹å¼åè¯­ä¹ç¸ä¼¼åº¦æ¥è¯¢çæ··åä½¿ç¨</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">SELECT id,title,price
FROM products
WHERE price &lt; 2000
ORDER BY embedding &lt;-&gt; '[0.091, -0.054, 0.92, ...]'
LIMIT 10;</pre>
</div>
</li>
</ol>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content">3.2 ä½¿ç¨ç´¢å¼</span></span></h3>
<p data-tool="mdniceç¼è¾å¨">DWSåéè®¡ç®é»è®¤ä½¿ç¨ç²¾ç¡®è¿é»æç´¢ï¼æä¾ç¾åä¹ç¾å¬åçä½æ¥è¯¢éåº¦è¾æ¢ãå¯ä»¥æéä½¿ç¨è¿ä¼¼ç¸é»æç´¢ç´¢å¼æ¥çºç²é¨åå¬åçä»¥æé«æ¥è¯¢éåº¦ãä¸åäºä¼ ç»ç´¢å¼ï¼è¿ä¼¼æç´¢ç´¢å¼å¯è½ä¼è¿åä¸åçæ¥è¯¢ç»æãDWSåéè®¡ç®ç®åæ¯æçç´¢å¼ç±»ååæ¬HNSWåIVFFlatã</p>
<ol data-tool="mdniceç¼è¾å¨">
<li>åå»ºç´¢å¼
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">-- HNSW ç´¢å¼
CREATE INDEX ON products USING hnsw (embedding vector_l2_ops) WITH (m = 16, ef_construction = 200);

-- æè IVFFlat ç´¢å¼
CREATE INDEX ON products USING ivfflat (embedding vector_l2_ops) WITH (lists = 100);</pre>
</div>
<pre class="custom"><code class="hljs">&nbsp;</code></pre>
</li>
<li>ä½¿ç¨ç´¢å¼ åå»ºç´¢å¼åæ§è¡topkæ¥è¯¢ï¼å¨è·ç¦»æä½ç¬¦å¹éçåºæ¯ä¸ä¼ä½¿ç¨index scanï¼å¯ä»¥éè¿explainè§å¯è®¡å
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;"> id |                            operation                             
----+------------------------------------------------------------------
  1 | -&gt;  Limit                                                        
  2 |    -&gt;  Streaming (type: GATHER)                                  
  3 |       -&gt;  Limit                                                  
  4 |          -&gt;  Index Scan using products_embedding_idx on products</pre>
</div>
</li>
</ol>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content">3.3 ç»æè§£è¯»</span></span></h3>
<ul data-tool="mdniceç¼è¾å¨">
<li>ç¨æ·æç´¢è¯ä¸º <code>wireless audio headset</code></li>
</ul>
<pre class="custom" data-tool="mdniceç¼è¾å¨"><code class="hljs">&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;id,&nbsp;title<br>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;products<br>&nbsp;&nbsp;&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;embedding&nbsp;&lt;-&gt;&nbsp;<span class="hljs-string">'[0.13,&nbsp;0.35,&nbsp;-0.20,&nbsp;...]'&nbsp;&nbsp;&nbsp;--ç¨æ·æç´¢è¯çembedding<br>&nbsp;&nbsp;&nbsp;&nbsp;LIMIT&nbsp;10;<br></span></code></pre>
<p data-tool="mdniceç¼è¾å¨">æ¥è¯¢ç»æï¼ åååä¸ºè³æºãé³åç±»åçæ°æ®ç¸è¾äºè¡¨ä¸­å¶ä»ååç±»å«ä¸ç¨æ·æç´¢è¯å¨è¯­ä¹ä¸æ´ä¸ºæ¥è¿ï¼å³ä¾¿æ²¡æç²¾ç¡®åå«<code>headset</code>ä»ç¶ä¼å¨ç»æä¸­æåºæ´é å</p>
<img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202602/2030258-20260210111417537-2120302191.png" class="lazyload"><br>
<ul data-tool="mdniceç¼è¾å¨">
<li>ç¨æ·æ­£å¨æµè§ <code>Noise Cancelling Headphones</code> ååï¼æ ¹æ®ç¸å³æ§è¿è¡æ¨èï¼</li>
</ul>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">SELECT p2.title, p2.price
FROM products p1
JOIN products p2 ON p1.id &lt;&gt; p2.id
WHERE p1.title = 'Noise Cancelling Headphones'
ORDER BY p2.embedding &lt;-&gt; p1.embedding
LIMIT 10;</pre>
</div>
<p data-tool="mdniceç¼è¾å¨">æ¥è¯¢ç»æï¼ è³æºé³åç±»ååä¸ç¨æ·æ­£å¨æµè§ç <code>Noise Cancelling Headphones</code> äº§åç¸å³æ§æ´é«</p>
<p data-tool="mdniceç¼è¾å¨"><img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202602/2030258-20260210111417566-890623509.png" class="lazyload"></p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content">4 æ§è½</span></span></h2>
<p data-tool="mdniceç¼è¾å¨">ä»¥ä¸å¾ç¤ºå±ç¤ºäºdws pgvectoræä»¶å¨ä¸åæ°æ®éåç´¢å¼ä¸çæ£ç´¢æ§è½</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2030258/202602/2030258-20260210110919072-1321574869.png" class="lazyload"></p>
<p>&nbsp;å®æµè¡¨æï¼dws pgvectoræä»¶è½å¤åå°åä¸çº§åéæ°æ®ï¼</p>
<ol data-tool="mdniceç¼è¾å¨">
<li>ä½äºå°æ¶çº§ç´¢å¼æå»ºæ¶é´</li>
<li>æ¯«ç§çº§æ¥è¯¢</li>
<li>ç¨³å®é«å¬åçï¼æéè°åæ§å¶</li>
</ol>
<p data-tool="mdniceç¼è¾å¨">å¯¹æ¯ä¸¤ç§ç´¢å¼ï¼æä»¬å¯ä»¥åç°ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li>hnswç´¢å¼æå»ºæ¶é´ä¸æ°æ®éåç»´åº¦å¼ºç¸å³ãç¸åæ°æ®éåç»´åº¦åºæ¯ä¸æå»ºæ¶é´ç¸è¾ivfflatæ¾èå¢å ï¼æ¢åæ´å¿«å¾æ¥è¯¢éåº¦åæ´å¥½çå¬åç</li>
<li>ivfflatç´¢å¼æå»ºæ¶é´æ´ç­ï¼ä¸»è¦åæå»ºåæ°listså½±åï¼å¯¹æ°æ®éä¸ææãç¸åæ°æ®éåç»´åº¦åºæ¯ä¸æ¥è¯¢èæ¶åå¬åçè¡¨ç°ä½äºhnsw</li>
</ul>
<p data-tool="mdniceç¼è¾å¨">å æ­¤ï¼ä¸¤èçæ¨èä½¿ç¨åºæ¯åå«ä¸ºï¼ HNSW</p>
<ul data-tool="mdniceç¼è¾å¨">
<li>çº¿ä¸å®æ¶æ£ç´¢ æç´¢ / æ¨è / RAG</li>
<li>é«å¬åè¦æ± Recall â¥ 0.9</li>
<li>å¤ç§æ·/é¿æè¿ç»´ç³»ç»</li>
</ul>
<p data-tool="mdniceç¼è¾å¨">IVFFLAT</p>
<ul data-tool="mdniceç¼è¾å¨">
<li>ç¦»çº¿ / æ¹éæ£ç´¢</li>
<li>æ£ç´¢ææ¬ä¼å</li>
<li>ä½ä¸ºå¤çº§æ£ç´¢çç¬¬ä¸å±ç²ç­</li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content">5 æ»ç»</span></span></h2>
<p data-tool="mdniceç¼è¾å¨">éè¿å¨ DWS åéè®¡ç®æ©å±è½åï¼æä»¬å°ä¼ ç»ä»¥ç»æåæ¥è¯¢ä¸ºæ ¸å¿çæ°æ®åºç³»ç»åçº§ä¸ºè½å¤å·å¤è¯­ä¹çè§£ä¸ç¸ä¼¼åº¦è®¡ç®è½åçç»ä¸æ°æ®åºåº§ãç³»ç»ä¸ä»æ¯æåéæ°æ®çå­å¨ä¸é«æç¸ä¼¼åº¦æ£ç´¢ï¼è¿åè®¸ä¸å¡æ¹ç´æ¥éè¿æ å SQL å®æè¯­ä¹æç´¢ãæ¨èä¸ç¸ä¼¼åå®¹å¹éï¼æ éå¼å¥é¢å¤çåéå¼ææå¤æçæ°æ®åæ­¥é¾è·¯ã</p>
<p data-tool="mdniceç¼è¾å¨">ä¾æ HNSWãIVFFlat è¿ä¼¼æè¿é»ç´¢å¼ï¼åéæ¥è¯¢å¨å¤§è§æ¨¡æ°æ®åºæ¯ä¸ä¾ç¶å·å¤å¯æ§çæ§è½ä¸ç¨³å®çååºè½åãåæ¶ï¼åéæ£ç´¢è½åä¸ä¼ ç»ç»æåæ¥è¯¢ãè¿æ»¤æ¡ä»¶ãJOIN é»è¾çæ·±åº¦èåï¼ä½¿å¾æç´¢æ¨èãä¸ªæ§ååæä»¥å RAG ç­ AI åºç¨å¯ä»¥èªç¶è½å°å¨ç°ææ°ä»ä¸ä¸å¡ä½ç³»ä¹ä¸ã</p>
<p data-tool="mdniceç¼è¾å¨">æç»ï¼è¿ä¸è½åæ©å±ä¸ä»éä½äºç³»ç»æ¶æå¤æåº¦ï¼ä¹æ¾èæåäºæ°æ®å¹³å°å¯¹æ°ä¸ä»£æºè½åºç¨çæ¯æè½åï¼å®ç°äºä»âæ°æ®æ¥è¯¢âåâè¯­ä¹è®¡ç®ä¸ä¸å¡å³ç­æ¯æâçæ¼è¿ã</p>
<p data-tool="mdniceç¼è¾å¨">&nbsp;</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-10 11:14">2026-02-10 11:14</span>&nbsp;
<a href="https://www.cnblogs.com/huaweiyun">åä¸ºäºå¼åèèç</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19598674);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19598674', targetLink: 'https://www.cnblogs.com/huaweiyun/p/19598674', title: 'åºäºDWSçåéè®¡ç®åè½å®ç°ç®åçååæç´¢æ¨èç³»ç»' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Linux Docker Compose é¨ç½².NET+Vue+MySQL+Redis+Nginx å®æ´è®°å½ï¼äº²æµæ åï¼ ]]></title>
    <link>https://www.cnblogs.com/huyong/p/19598103</link>
    <guid>477b8a955cf977b2ae52e08cb4300523</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huyong/p/19598103" title="åå¸äº 2026-02-10 10:18">
    <span role="heading" aria-level="2">Linux Docker Compose é¨ç½².NET+Vue+MySQL+Redis+Nginx å®æ´è®°å½ï¼äº²æµæ åï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093515706-1791754599.png" alt="Linux Docker Compose é¨ç½².NET+Vue+MySQL+Redis+Nginx å®æ´è®°å½ï¼äº²æµæ åï¼" class="desc_img">
        æ¬æè¯¦ç»ä»ç»äº Linux ç³»ç»ä¸ï¼åºäº Docker Compose é¨ç½².NET+Vue+MySQL8+Redis+Nginx å¤æå¡é¡¹ç®çå®æ´æµç¨ãé¦åè¯´æ Docker Compose ä¸é®å¯åãéç½®ç»ä¸ç­æ ¸å¿ä¼å¿ï¼æ¥çè®²è§£é¨ç½²åçç¯å¢åå¤ï¼ç³»ç»éç½®ãè½¯ä»¶çæ¬ãæ¬å°æä»¶æåï¼ãDocker å Compose çå®è£ä¸éåå ééç½®ï¼è§èé¡¹ç®ç®å½ç»æåï¼éç¹ç¼å docker-compose.yml å®ç°å¤å®¹å¨ç¼æï¼å¹¶æä¾æ¬å°æåéåæåãæå¡å¨ç¦»çº¿å¯¼å¥çæ¹æ¡ãæä¸­è¿æ»ç»äºé¨ç½²ä¸­ç«¯å£ä¸å¹éãMySQL è¿æ¥å¤±è´¥ãæ¶åºå·®å¼ç­ 8 ç±»å¸¸è§é®é¢åè§£å³æ¹æ¡ï¼æ´çäºè¿ç»´å¸¸ç¨å½ä»¤ãå¼æºèªå¯éç½®åååç«¯æ´æ°æ¹æ³ï¼æåç»åºçäº§ç¯å¢ä¼åå»ºè®®ãæ´å¥æ¹æ¡å®ç°äºæå¡ä¸é®å¯åãæ°æ®æä¹åï¼ééæµè¯ / å°åé¡¹ç®é¨ç½²ï¼æç»´æ¤ãæè¿ç§»ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422798-1508819059.png" alt="å°é¢" loading="lazy"></p>
<h2 id="åå¨åé¢ä¸ºä»ä¹ç¨-docker-composeæ¯åå®¹å¨é¨ç½²å¥½å¨åª">åå¨åé¢ï¼ä¸ºä»ä¹ç¨ Docker Composeï¼æ¯åå®¹å¨é¨ç½²å¥½å¨åªï¼</h2>
<p>åå®¹å¨åé¨ç½²æ¶ï¼åé <code>docker run</code>å½ä»¤éä¸ªå¯å¨ MySQLãRedisãåç«¯ãNginx å®¹å¨ä¼éå¸¸ç¹ç ââ ä¸ä»è¦è®°å¤§éå½ä»¤åæ°ï¼è¿å¾æå¨æ§å¶å®¹å¨å¯å¨é¡ºåºãéç½®ç½ç»èå¨ï¼ä¸æ¦æå¡å¨éå¯ï¼ææå®¹å¨è¦éæ°éä¸ªå¯å¨ï¼ç»´æ¤ææ¬æé«ã</p>
<p><strong>Docker Compose</strong>æ¯ Docker å®æ¹çå¤å®¹å¨ç¼æå·¥å·ï¼æ ¸å¿æ¯éè¿ä¸ä¸ª<code>docker-compose.yml</code>éç½®æä»¶ï¼éä¸­ç®¡çææå®¹å¨ç<strong>éåãç«¯å£ãæè½½ãç¯å¢åéãç½ç»ãä¾èµå³ç³»</strong>ç­ææéç½®ï¼è½å®ç¾è§£å³åå®¹å¨é¨ç½²ççç¹ã</p>
<h3 id="docker-compose-æ ¸å¿ä¼ç¹ä¹æ¯æ¬æ¬¡é¨ç½²éæ©å®çåå ">Docker Compose æ ¸å¿ä¼ç¹ï¼ä¹æ¯æ¬æ¬¡é¨ç½²éæ©å®çåå ï¼</h3>
<ol>
<li><strong>ä¸é®å¯å</strong>ï¼ä¸æ¡<code>docker-compose up -d</code>å¯å¨æææå¡ï¼<code>docker-compose down</code>åæ­¢å¹¶æ¸çï¼æ ééä¸ªæ§è¡<code>docker run</code>/<code>docker stop</code>ï¼</li>
<li><strong>éç½®ç»ä¸</strong>ï¼ææå®¹å¨éç½®éä¸­å¨ä¸ä¸ª yaml æä»¶ï¼æç¼è¾ãæå¤ä»½ï¼åç»­ä¿®æ¹åªéæ¹éç½®æä»¶ï¼æ éè®°å¤æå½ä»¤ï¼</li>
<li><strong>å®¹å¨èªå¨èå¨</strong>ï¼èªå¨åå»ºä¸å±ç½ç»ï¼å®¹å¨é´éè¿<strong>æå¡å</strong>å³å¯éä¿¡ï¼æ éæå¨éç½®ç½ç»ï¼å¯éè¿<code>depends_on</code>æ§å¶å¯å¨é¡ºåºï¼è§£å³æå¡ä¾èµé®é¢ï¼</li>
<li><strong>ç¯å¢ä¸è´æ§</strong>ï¼éç½®æä»¶å¯è·¨ç¯å¢å¤ç¨ï¼æ¬å°æµè¯ãæå¡å¨é¨ç½²ç¨åä¸å¥éç½®ï¼é¿å âæ¬å°è½è·ï¼æå¡å¨ä¸è¡âï¼</li>
<li><strong>æç»´æ¤æè¿ç§»</strong>ï¼é¡¹ç®ç®å½ + éç½®æä»¶ + ç¦»çº¿éååï¼å¯ç´æ¥è¿ç§»å°å¶ä»æå¡å¨ï¼è§£ååä¸é®å¯å¨ï¼æ ééæ°éç½®ï¼</li>
<li><strong>æ°æ®å· / ç½ç»èªå¨ç®¡ç</strong>ï¼èªå¨åå»ºæ°æ®å·ãèªå®ä¹ç½ç»ï¼æ éæå¨æ§è¡<code>docker volume create</code>/<code>docker network create</code>ã</li>
</ol>
<p>ç¸æ¯åå®¹å¨é¨ç½²ï¼Docker Compose è®©å¤æå¡å®¹å¨åé¨ç½²çæçæåæ°åï¼å°¤å¶éå<strong>åç«¯ + åç«¯ + æ°æ®åº + ç¼å­ + ä»£ç</strong>è¿ç±»å¤ç»ä»¶çé¡¹ç®é¨ç½²ï¼ä¹æ¯ç®åä¸­å°åé¡¹ç®å®¹å¨åçä¸»æµæ¹æ¡ã</p>
<h2 id="ä¸é¨ç½²ç¯å¢åå¤æåç¡®è®¤é¿ååç»­å¼å®¹é®é¢">ä¸ãé¨ç½²ç¯å¢åå¤ï¼æåç¡®è®¤ï¼é¿ååç»­å¼å®¹é®é¢ï¼</h2>
<h3 id="1-èææºç¯å¢ä¸ªäººæµè¯ç¨éçäº§">1. èææºç¯å¢ï¼ä¸ªäººæµè¯ç¨ï¼éçäº§ï¼</h3>
<ul>
<li>ç³»ç»ï¼CentOS 7.9ï¼æå°åå®è£ï¼å·²éç½®éæ IPï¼192.168.1.100ï¼èæ IPï¼æ¿æ¢çå® IPï¼</li>
<li>åå­ï¼4Gï¼å»ºè®®ä¸ä½äº 2Gï¼å¦å Docker å®¹å¨å¯å¨å¯è½å¡é¡¿ï¼</li>
<li>ç¡¬çï¼50Gï¼è¶³å¤å­æ¾éåãé¡¹ç®æä»¶åæ°æ®åºæ°æ®ï¼</li>
<li>ç½ç»ï¼è½è®¿é®å¤ç½ï¼åææåéå / å®è£ä¾èµç¨ï¼åæå¯æ­ç½è¿è¡ï¼</li>
</ul>
<h3 id="2-è½¯ä»¶çæ¬å¨ç¨ç»ä¸çæ¬é¿åå¼å®¹é®é¢">2. è½¯ä»¶çæ¬ï¼å¨ç¨ç»ä¸çæ¬ï¼é¿åå¼å®¹é®é¢ï¼</h3>
<ul>
<li>Dockerï¼Docker CE 24.0.7ï¼CentOS7 ç¨³å®çï¼</li>
<li>Docker Composeï¼V2.27.1ï¼è§£å³æ§çéç½®å¼å®¹é®é¢ï¼</li>
<li>åç«¯ï¼.NET 8ï¼æ¬å° VS2022 åå¸å° publish æä»¶å¤¹ï¼</li>
<li>åç«¯ï¼Vue3ï¼æ¬å° yarn æåå° dist æä»¶å¤¹ï¼</li>
<li>MySQLï¼8.0ï¼Docker éåï¼æ°æ®æä¹åï¼</li>
<li>Redisï¼7-alpineï¼è½»éçï¼éåå®¹å¨é¨ç½²ï¼</li>
<li>Nginxï¼alpineï¼è½»éçï¼ä»£çåç«¯éææä»¶ + åç«¯æ¥å£ï¼</li>
</ul>
<h3 id="3-æ¬å°åå¤æä»¶æåæåå¥½ä¸ä¼ å°èææº">3. æ¬å°åå¤æä»¶ï¼æåæåå¥½ï¼ä¸ä¼ å°èææºï¼</h3>
<ul>
<li>åç«¯ï¼publish æä»¶å¤¹ï¼VS2022 åå¸åç.NET8 é¡¹ç®æä»¶ï¼å«æ ¸å¿ dllãéç½®æä»¶ï¼</li>
<li>åç«¯ï¼dist æä»¶å¤¹ï¼Vue3 æååçéææä»¶ï¼å« index.htmlãcssãjsï¼</li>
<li>éå tar åï¼rdif-all-images.tarï¼ç¦»çº¿éååï¼å« MySQLãRedisãNginx ç­ 6 ä¸ªæééåï¼è§£å³ç½ç»æåè¶æ¶ï¼</li>
<li>éç½®æä»¶ï¼my.cnfï¼MySQL éç½®ï¼ãnginx.confï¼Nginx éç½®ï¼ãinit.sqlï¼MySQL åå§å SQLï¼ãdocker-compose.ymlï¼æ ¸å¿ç¼ææä»¶ï¼</li>
</ul>
<h2 id="äºåæåå¤å·¥ä½å¿åå¥ å®é¨ç½²åºç¡">äºãåæåå¤å·¥ä½ï¼å¿åï¼å¥ å®é¨ç½²åºç¡ï¼</h2>
<h3 id="1-centos7-ç³»ç»åºç¡éç½®æå°åå®è£è¡¥åä¾èµ">1. CentOS7 ç³»ç»åºç¡éç½®ï¼æå°åå®è£è¡¥åä¾èµï¼</h3>
<p>æå°åå®è£ç CentOS7 ç¼ºå°å¾å¤åºç¡å·¥å·ï¼åå®è£å¿è¦ä¾èµï¼é¿ååç»­ Docker å®è£ãå½ä»¤æ§è¡å¤±è´¥ï¼</p>
<pre><code class="language-bash"># æ´æ°ç³»ç»è½¯ä»¶åï¼å¯éï¼å»ºè®®æ§è¡ï¼é¿åä¾èµçæ¬è¿ä½ï¼
yum update -y

# å®è£åºç¡å·¥å·ï¼wgetãvimãnet-toolsç­ï¼åç»­å¸¸ç¨ï¼
yum install -y wget vim net-tools epel-release
</code></pre>
<h3 id="2-å®è£-docker-cecentos7-ç¨³å®çæ­¥éª¤åºå®">2. å®è£ Docker CEï¼CentOS7 ç¨³å®çï¼æ­¥éª¤åºå®ï¼</h3>
<p>CentOS7 é»è®¤æºæ²¡æ Dockerï¼éè¦éç½® Docker å®æ¹æºï¼åæ¶è§£å³ä¾èµç¼ºå¤±é®é¢ï¼éç¹è§£å³ container-selinux ä¾èµï¼ï¼</p>
<pre><code class="language-bash"># 1. å¸è½½æ§çæ¬Dockerï¼å¦æä¹åè£è¿ï¼é¿åå²çªï¼æ²¡è£è¿å¯è·³è¿ï¼
yum remove -y docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine

# 2. å®è£Dockerä¾èµï¼å¿åï¼å¦åå®è£å¤±è´¥ï¼
yum install -y yum-utils device-mapper-persistent-data lvm2 container-selinux

# 3. éç½®Dockerå®æ¹æº
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

# 4. å®è£Docker CEï¼ç¨³å®çï¼
yum install -y docker-ce docker-ce-cli containerd.io

# 5. å¯å¨Dockeræå¡ï¼å¹¶è®¾ç½®å¼æºèªå¯ï¼æåéç½®ï¼åç»­ä¸ç¨åæ¹ï¼
systemctl start docker
systemctl enable docker

# 6. éªè¯Dockerå®è£æåï¼è¾åºçæ¬å·å³æåï¼
docker --version
</code></pre>
<p>â æåæ è¯ï¼<code>Docker version 24.0.7, build afdd53b</code></p>
<h3 id="3-éç½®-docker-éåå éå½åå¿åå¦åéåæåè¶æ¶">3. éç½® Docker éåå éï¼å½åå¿åï¼å¦åéåæåè¶æ¶ï¼</h3>
<p>Docker é»è®¤æåå®æ¹éåï¼å½å¤æºï¼ï¼å½åè®¿é®ææ¢ï¼çè³è¶æ¶ãè¿éç¨é¿éäºä¸ªäººä¸å±éåå éï¼æ¯å¬å±æºæ´ç¨³å®ï¼ï¼æ­¥éª¤å¦ä¸ï¼</p>
<ol>
<li>
<p>ç»å½é¿éäºå®ç½ï¼<a href="https://www.aliyun.com/%EF%BC%89%EF%BC%8C%E6%90%9C%E7%B4%A2" target="_blank" rel="noopener nofollow">https://www.aliyun.com/ï¼ï¼æç´¢</a> âå®¹å¨éåæå¡âï¼è¿å¥ âéåå éå¨âï¼å¤å¶èªå·±çä¸å±å éå°åï¼ç¤ºä¾ï¼<a href="https://xxxxxx.mirror.aliyuncs.com" target="_blank" rel="noopener nofollow">https://xxxxxx.mirror.aliyuncs.com</a>ï¼æ¿æ¢æèªå·±çï¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422503-1546470148.png" alt="éåå éå¨" loading="lazy"></p>
</li>
<li>
<p>éç½®éåå éï¼ä¿®æ¹ Docker å®æ¤è¿ç¨éç½®æä»¶ï¼</p>
</li>
</ol>
<pre><code class="language-bash"># åå»ºDockeréç½®ç®å½ï¼å¦æä¸å­å¨ï¼
mkdir -p /etc/docker

# åå¥å ééç½®ï¼æ¿æ¢æèªå·±çé¿éäºä¸å±å éå°åï¼
tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
  "registry-mirrors": ["https://xxxxxx.mirror.aliyuncs.com", "https://mirror.ccs.tencentyun.com"]
}
EOF

# éæ°å è½½éç½®ï¼éå¯Dockerï¼è®©å éçæ
systemctl daemon-reload
systemctl restart docker

# éªè¯å ééç½®æ¯å¦çæï¼è¾åºéç½®çå éå°åå³æåï¼
docker info | grep -A 2 "Registry Mirrors"
</code></pre>
<p>â æåæ è¯ï¼è¾åºä¸­åå«èªå·±éç½®çé¿éäºå éå°åã</p>
<h3 id="4-åçº§-docker-composeè§£å³æ§çéç½®å¼å®¹é®é¢">4. åçº§ Docker Composeï¼è§£å³æ§çéç½®å¼å®¹é®é¢ï¼</h3>
<p>CentOS7 é»è®¤å®è£ç Docker Compose æ¯ 1.x çæ¬ï¼ä¸æ¯ææ°ç docker-compose.yml ä¸­çéç½®ï¼å¦ conditionãstart_periodï¼ï¼åçº§å° V2 çæ¬ï¼å®æ¹æ¨èï¼ï¼</p>
<pre><code class="language-bash"># 1. å é¤æ§çdocker-composeï¼å¦æä¹åè£è¿ï¼
rm -f /usr/local/bin/docker-compose

# 2. å®è£Docker Compose V2ï¼æä»¶å½¢å¼ï¼ç¨³å®ï¼
yum install -y docker-compose-plugin

# 3. å»ºç«è½¯é¾æ¥ï¼ä¿ædocker-composeå½ä»¤å¯ç¨ï¼åæ§çç¨æ³ä¸è´ï¼
ln -s /usr/libexec/docker/cli-plugins/docker-compose /usr/local/bin/docker-compose

# 4. éªè¯åçº§æåï¼è¾åºV2çæ¬å·å³æåï¼
docker-compose --version
</code></pre>
<p>â æåæ è¯ï¼<code>Docker Compose version v2.27.1</code>ï¼çæ¬å·å¯ä¸åï¼</p>
<h3 id="5-å³é­é²ç«å¢æµè¯ç¯å¢é¿åç«¯å£è®¿é®å¤±è´¥">5. å³é­é²ç«å¢ï¼æµè¯ç¯å¢ï¼é¿åç«¯å£è®¿é®å¤±è´¥ï¼</h3>
<p>ä¸ªäººæµè¯ç¨ï¼ç´æ¥å³é­ CentOS7 ç FirewallD é²ç«å¢ï¼é¿ååç«¯ãåç«¯ãæ°æ®åºç«¯å£è¢«æ¦æªï¼çäº§ç¯å¢å¯æéå¼æ¾ç«¯å£ï¼</p>
<pre><code class="language-bash"># 1. ç«å³åæ­¢é²ç«å¢æå¡
systemctl stop firewalld

# 2. ç¦æ­¢é²ç«å¢å¼æºèªå¯ï¼é¿åèææºéå¯åé²ç«å¢åå¼å¯ï¼
systemctl disable firewalld

# 3. éªè¯é²ç«å¢ç¶æï¼è¾åºinactiveå³æåå³é­ï¼
systemctl status firewalld
</code></pre>
<h2 id="ä¸é¡¹ç®ç®å½ç»ææ´çè§èç®å½é¿ååç»­æ··ä¹±">ä¸ãé¡¹ç®ç®å½ç»ææ´çï¼è§èç®å½ï¼é¿ååç»­æ··ä¹±ï¼</h2>
<p>å°æ¬å°åå¤å¥½çæææä»¶ï¼ä¸ä¼ å° CentOS7 èææºç<code>/root/rdif-docker</code>ç®å½ï¼èªå®ä¹ç®å½ï¼æ¹ä¾¿è®°å¿ï¼ï¼æç»ç®å½ç»æå¦ä¸ï¼éç¹ï¼ååç«¯ä»ä¿çæå / åå¸æä»¶ï¼æ æºç ãæ å¤ä½æä»¶ï¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422563-1614578929.png" alt="é¡¹ç®ç®å½ç»æ" loading="lazy"></p>
<pre><code class="language-plaintext">rdif-docker/                 # é¡¹ç®æ ¹ç®å½ï¼æææä»¶é½æ¾å¨è¿éï¼
âââ docker-compose.yml       # æ ¸å¿ç¼ææä»¶ï¼ç®¡çææå®¹å¨
âââ backend/                 # åç«¯ç®å½ï¼ä»ä¿çVSåå¸çpublishï¼
â   âââ publish/             # .NET8åå¸æä»¶ï¼å«RDIF.WebHost.dllãappsettings.jsonï¼
âââ frontend/                # åç«¯ç®å½ï¼ä»ä¿çVue3æåçdistï¼
â   âââ dist/                # Vue3éææä»¶ï¼index.htmlãcssãjsãassetsï¼
âââ nginx/                   # Nginxéç½®ç®å½
â   âââ nginx.conf           # Nginxéç½®æä»¶ï¼ä»£çåç«¯+åç«¯æ¥å£ï¼
âââ mysql/                   # MySQLéç½®ç®å½
â   âââ my.cnf               # MySQLéç½®ï¼ä¸åºåå¤§å°åãå­ç¬¦éç­ï¼
â   âââ init.sql             # MySQLåå§åSQLï¼åå»ºåºãè¡¨ãåå§åæ°æ®ï¼
âââ rdif-all-images.tar      # ç¦»çº¿éååï¼å«æææééåï¼é¿åæåè¶æ¶ï¼
</code></pre>
<h3 id="ä¸ä¼ æä»¶æ¹æ³æ°ææ¨èå¯è§åæä½">ä¸ä¼ æä»¶æ¹æ³ï¼æ°ææ¨èï¼å¯è§åæä½ï¼</h3>
<p>ç¨ MobaXtermæXftp æ WinSCP å·¥å·ï¼è¿æ¥èææºï¼IPï¼192.168.1.100ï¼è´¦å·ï¼rootï¼å¯ç ï¼Root@123456ï¼èæå¯ç ï¼ï¼å°æ¬å°ç publishãdistãéç½®æä»¶ãéå tar åï¼æå°å¯¹åºç®å½ä¸å³å¯ã</p>
<h2 id="åç¼å-docker-composeymlæ ¸å¿éç½®éä¸­ä¹é">åãç¼å docker-compose.ymlï¼æ ¸å¿éç½®ï¼éä¸­ä¹éï¼</h2>
<p>è¿æ¯æ´ä¸ªé¨ç½²çæ ¸å¿ï¼ææå®¹å¨ï¼MySQLãRedisãåç«¯ãNginxï¼çèå¨ãç«¯å£æ å°ãç®å½æè½½ï¼é½å¨è¿ééç½®ãç»åæ¬æ¬¡éæ±ï¼ååç«¯å·²æå / åå¸ï¼æ éç¼è¯æå»ºï¼ï¼ç¼åå¦ä¸éç½®ï¼æ³¨éè¯¦ç»ï¼å¯ç´æ¥å¤å¶ä¿®æ¹ï¼æ¿æ¢èªå·±çå¯¹åºä¿¡æ¯ï¼<strong>Redis å¯ç å·²æ¿æ¢ä¸ºéç¨èæå¯ç </strong>ï¼ï¼</p>
<pre><code class="language-yaml">version: '3.8'

# æææå¡çéå
services:
  # 1. MySQL8 æå¡ï¼æ°æ®åºï¼æ°æ®æä¹åï¼
  mysql:
    image: mysql:8.0                # ä½¿ç¨çéåï¼æ¬å°å·²å¯¼å¥ï¼æ éæåï¼
    container_name: rdif-mysql      # èªå®ä¹å®¹å¨åï¼æ¹ä¾¿ç®¡ç
    restart: always                 # å®¹å¨å¼å¸¸éåº/ Dockerå¯å¨æ¶ï¼èªå¨éå¯
    environment:
      MYSQL_ROOT_PASSWORD: Root@123456   # MySQL rootå¯ç ï¼èæï¼æ¿æ¢æèªå·±çï¼
      MYSQL_USER: guosisoft         # é¡¹ç®è®¿é®MySQLçç¨æ·åï¼èªå®ä¹ï¼
      MYSQL_PASSWORD: Mysql@123456  # é¡¹ç®è®¿é®MySQLçå¯ç ï¼èæï¼
      MYSQL_DATABASE: rdif_vue3     # é¡¹ç®æç¨æ°æ®åºåï¼èªå®ä¹ï¼
      MYSQL_TZINFO_TO_SYS_TABLES: 1 # åå§åMySQLæ¶åºè¡¨ï¼è§£å³æ¶å·®é®é¢
      TZ: Asia/Shanghai             # å¼ºå¶å®¹å¨æ¶åºä¸ºä¸å«åºï¼æ ¸å¿ï¼è§£å³æ¶å·®ï¼
    ports:
      - "3306:3306"                 # ç«¯å£æ å°ï¼å®¿ä¸»æº3306 â å®¹å¨å3306ï¼æ¬å°å·¥å·å¯è¿æ¥ï¼
    volumes:
      # æè½½MySQLéç½®æä»¶ï¼å®ç°èªå®ä¹éç½®
      - ./mysql/my.cnf:/etc/mysql/conf.d/my.cnf
      # æè½½åå§åSQLï¼å®¹å¨å¯å¨æ¶èªå¨æ§è¡ï¼åå»ºåºè¡¨
      - ./mysql/init.sql:/docker-entrypoint-initdb.d/init.sql
      # æè½½æ°æ®å·ï¼æä¹åMySQLæ°æ®ï¼docker-compose downä¸ä¼å é¤æ°æ®ï¼
      - mysql-data:/var/lib/mysql
      # æè½½å®¿ä¸»æºæ¶åºæä»¶ï¼åéä¿éæ¶åºåæ­¥ï¼åªè¯»ï¼é¿åå®¹å¨ä¿®æ¹ï¼
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro
    command: --lower_case_table_names=1 # MySQLä¸åºåå¤§å°åï¼é¿åé¡¹ç®è¡¨åå¤§å°åé®é¢ï¼
    networks:
      - rdif-network                # å å¥èªå®ä¹ç½ç»ï¼å®ç°å®¹å¨é´éä¿¡
    # å¥åº·æ£æ¥ï¼æ£æµMySQLæ¯å¦çæ­£å°±ç»ªï¼é¿ååç«¯å¯å¨æ©äºMySQL
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uguosisoft", "-pMysql@123456"]
      interval: 5s                  # æ¯5ç§æ£æµä¸æ¬¡
      timeout: 30s                  # è¶æ¶æ¶é´30ç§
      retries: 10                   # éè¯10æ¬¡ï¼å¤±è´¥åè®¤ä¸ºå®¹å¨æªå°±ç»ª
      start_period: 20s             # å®¹å¨å¯å¨åï¼å»¶è¿20ç§å¼å§æ£æµ

  # 2. Redis æå¡ï¼ç¼å­ï¼è½»éçï¼å¯ç å·²æ¿æ¢ä¸ºèæéç¨å¯ç ï¼
  redis:
    image: redis:7-alpine           # è½»éçRedisï¼å ç¨èµæºå°
    container_name: rdif-redis      # èªå®ä¹å®¹å¨å
    restart: always                 # èªå¨éå¯
    ports:
      - "6379:6379"                 # ç«¯å£æ å°ï¼å®¿ä¸»æº6379 â å®¹å¨å6379
    volumes:
      - redis-data:/data            # æ°æ®å·æä¹åRedisæ°æ®
    command: redis-server --requirepass "Redis@123456" # Redisèæå¯ç ï¼æ¿æ¢æèªå·±çå¤æå¯ç 
    networks:
      - rdif-network                # å å¥èªå®ä¹ç½ç»
    environment:
      TZ: Asia/Shanghai             # åæ­¥ä¸å«åºæ¶åº

  # 3. .NET8 åç«¯æå¡ï¼å·²åå¸ï¼ç´æ¥æè½½è¿è¡ï¼Redisè¿æ¥å¯ç åæ­¥æ¿æ¢ï¼
  backend:
    image: mcr.microsoft.com/dotnet/aspnet:8.0 # .NET8è¿è¡æ¶éåï¼æ éæå»ºï¼
    container_name: rdif-backend    # èªå®ä¹å®¹å¨å
    restart: always                 # èªå¨éå¯
    ports:
      - "58588:58588"               # ç«¯å£æ å°ï¼å®¿ä¸»æº58588 â å®¹å¨å58588ï¼åç«¯æ¥å£ç«¯å£ï¼
    depends_on:
      mysql:
        condition: service_healthy  # ä»å¨MySQLå¥åº·æ£æ¥éè¿ï¼å°±ç»ªï¼åï¼æå¯å¨åç«¯
      redis:
        condition: service_started  # Rediså¯å¨åï¼å³å¯å¯å¨åç«¯
    volumes:     
      # æ ¸å¿ï¼æè½½æ¬å°publishå°å®¹å¨ç/appç®å½
      - ./backend/publish:/app
      # å®¿ä¸»æºï¼/wwwroot/Resources â å®¹å¨åï¼/wwwroot/Resources
      - /wwwroot/Resources:/wwwroot/Resources
    environment:
      TZ: Asia/Shanghai             # åæ­¥ä¸å«åºæ¶åº
      ASPNETCORE_URLS: "http://*:58588" # å¼ºå¶.NET8å®¹å¨åçå¬58588ç«¯å£ï¼è§£å³ç«¯å£ä¸éï¼
      ASPNETCORE_ENVIRONMENT: Production # .NETç¯å¢ï¼çäº§ç¯å¢ï¼
      # MySQLè¿æ¥å­ç¬¦ä¸²ï¼æ¿æ¢æèªå·±çç¨æ·åãå¯ç ãæ°æ®åºåï¼serverç¨å®¹å¨åmysqlï¼
      ConnectionStrings__MySQL: "server=mysql;port=3306;database=rdif_vue3;user=guosisoft;password=Mysql@123456;charset=utf8mb4;AllowPublicKeyRetrieval=True;SslMode=None"
      # Redisè¿æ¥å­ç¬¦ä¸²ï¼serverç¨å®¹å¨åredisï¼å¯ç åæ­¥æ¿æ¢ä¸ºèæå¯ç ï¼
      ConnectionStrings__Redis: "redis:6379,password=Redis@123456,defaultDatabase=0,ssl=false,abortConnect=false"
    working_dir: /app               # å®¹å¨å·¥ä½ç®å½ï¼æåæè½½çpublishç®å½
    entrypoint: ["dotnet", "RDIF.WebHost.dll"] # å¯å¨åç«¯æ ¸å¿dllï¼æ¿æ¢æèªå·±çdllåï¼
    networks:
      - rdif-network                # å å¥èªå®ä¹ç½ç»

  # 4. Nginx æå¡ï¼ä»£çåç«¯éææä»¶+åç«¯æ¥å£ï¼
  nginx:
    image: nginx:alpine             # è½»éçNginx
    container_name: rdif-nginx      # èªå®ä¹å®¹å¨å
    restart: always                 # èªå¨éå¯
    ports:
      - "6866:6866"                 # ç«¯å£æ å°ï¼å®¿ä¸»æº6866 â å®¹å¨å6866ï¼åç«¯è®¿é®ç«¯å£ï¼
    volumes:
      # æè½½Nginxéç½®æä»¶ï¼å®ç°åç«¯ä»£çåæ¥å£è½¬å
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      # æè½½åç«¯distç®å½ï¼Nginxç´æ¥ä»£çéææä»¶ï¼æ ¸å¿ï¼
      - ./frontend/dist:/usr/share/nginx/html
    depends_on:
      - backend                     # åç«¯å¯å¨åï¼åå¯å¨Nginx
    networks:
      - rdif-network                # å å¥èªå®ä¹ç½ç»
    environment:
      TZ: Asia/Shanghai             # åæ­¥ä¸å«åºæ¶åº

# æ°æ®å·ï¼æä¹åMySQLåRedisæ°æ®ï¼docker-compose downä¸ä¼å é¤ï¼
volumes:
  mysql-data:
  redis-data:

# èªå®ä¹ç½ç»ï¼ææå®¹å¨å å¥åä¸ç½ç»ï¼å®ç°å®¹å¨é´éä¿¡ï¼ç¨å®¹å¨åå³å¯è®¿é®ï¼
networks:
  rdif-network:
    driver: bridge
</code></pre>
<h3 id="å³é®éç½®è¯´æå¿çé¿åè¸©å">å³é®éç½®è¯´æï¼å¿çï¼é¿åè¸©åï¼</h3>
<ol>
<li>ææå®¹å¨é½éç½®äº<code>restart: always</code>ï¼éå Docker å¼æºèªå¯ï¼å®ç°èææºéå¯åæææå¡èªå¨å¯å¨ï¼</li>
<li>åç«¯éç½®<code>ASPNETCORE_URLS: "http://*:58588"</code>ï¼å¼ºå¶çå¬ 58588 ç«¯å£ï¼åç«¯å£æ å°ä¸è´ï¼è§£å³.NET8 é»è®¤çå¬ 8080 å¯¼è´çç«¯å£ä¸éï¼</li>
<li>MySQL è¿æ¥å­ç¬¦ä¸²ä¸­ï¼<code>server=mysql</code>ï¼ç¨å®¹å¨åï¼ï¼èéèææº IPï¼å®¹å¨é´éä¿¡å¿é¡»è¿æ ·éç½®ï¼è¡¥å<code>AllowPublicKeyRetrieval=True;SslMode=None</code>ï¼è§£å³å®¹å¨åè¿æ¥ MySQL å¤±è´¥ï¼</li>
<li>ææå®¹å¨é½éç½®<code>TZ: Asia/Shanghai</code>ï¼åæ­¥ä¸å«åºæ¶åºï¼è§£å³ MySQL æ¶å·® 8 å°æ¶é®é¢ï¼</li>
<li>åç«¯<code>depends_on</code>éç½®äº<code>condition: service_healthy</code>ï¼ç¡®ä¿ MySQL å®å¨å°±ç»ªååå¯å¨åç«¯ï¼é¿ååç«¯å¯å¨æ¶ MySQL æªåå§åå®æå¯¼è´çè¿æ¥å¤±è´¥ï¼</li>
<li>ææææå¯ç ï¼MySQL/Redisï¼åä¸ºèæç¤ºä¾ï¼å®éé¨ç½²è¯·æ¿æ¢ä¸º<strong>å­æ¯ + æ°å­ + ç¹æ®ç¬¦å·</strong>çå¤æå¯ç ï¼æåå®å¨æ§ã</li>
</ol>
<h2 id="äºæ¬å°æåéåå¹¶æåä¸º-tarç¦»çº¿æ¹æ¡åç½®æ­¥éª¤å³é®">äºãæ¬å°æåéåå¹¶æåä¸º tarï¼ç¦»çº¿æ¹æ¡åç½®æ­¥éª¤ï¼å³é®ï¼ï¼</h2>
<p>æ¬æ¬¡é¨ç½²éç¨<strong>ç¦»çº¿éåå¯¼å¥</strong>æ¹æ¡ï¼è§£å³æå¡å¨ç½ç»æåè¶æ¶é®é¢ï¼ï¼éå¨<strong>æ¬å°è½æ­£å¸¸èç½ççµè</strong>ä¸æåæåæææééåï¼åæåä¸º tar æä»¶ï¼æåä¸ä¼ å° CentOS æå¡å¨ã</p>
<h3 id="51-æ¬å°æåéåçåææ¡ä»¶">5.1 æ¬å°æåéåçåææ¡ä»¶</h3>
<p>æ¬å°çµèï¼Windows/macOSï¼éå®è£<strong>Docker Desktop</strong>ï¼Docker æ¡é¢çï¼ï¼åç½® Docker å¼æåéåç®¡çåè½ï¼æ¯æ¬å°æä½ Docker çå¿å¤å·¥å·ï¼</p>
<ul>
<li>ä¸è½½å°åï¼<a href="https://www.docker.com/products/docker-desktop/" target="_blank" rel="noopener nofollow">https://www.docker.com/products/docker-desktop/</a></li>
<li>å®è£åéªè¯ï¼æå¼ Docker Desktopï¼å¯å¨åå¨æ¬å°ç»ç«¯ï¼CMD/PowerShell/ ç»ç«¯ï¼æ§è¡<code>docker --version</code>ï¼è¾åºçæ¬å·å³å®è£æåï¼</li>
<li>å³é®è®¾ç½®ï¼Docker Desktop ä¸­éç½®<strong>éåå é</strong>ï¼åæå¡å¨ç«¯ä¸è´ï¼é¿éäº / ç½æäºåå¯ï¼ï¼é¿åæ¬å°æåéåè¶æ¶ã</li>
</ul>
<h3 id="52-æ¬å°ç»ç«¯æåæ¬æ¬¡é¨ç½²æææééå">5.2 æ¬å°ç»ç«¯æåæ¬æ¬¡é¨ç½²æææééå</h3>
<p>æå¼æ¬å°ç»ç«¯ï¼Windows ç¨ PowerShell/CMDï¼macOS/Linux ç¨ç»ç«¯ï¼ï¼æ§è¡ä»¥ä¸<code>docker pull</code>å½ä»¤ï¼éä¸ªæåéåï¼ææ¬æ¬¡é¨ç½²ççæ¬å·æåï¼ç¡®ä¿çæ¬ä¸è´ï¼ï¼</p>
<pre><code class="language-bash"># 1. æåMySQL8.0éå
docker pull mysql:8.0
# 2. æåRedis7è½»éçéå
docker pull redis:7-alpine
# 3. æå.NET8è¿è¡æ¶éåï¼åç«¯è¿è¡ä¾èµï¼
docker pull mcr.microsoft.com/dotnet/aspnet:8.0
# 4. æåNginxè½»éçéå
docker pull nginx:alpine
</code></pre>
<p>â æåæåéªè¯ï¼æ¬å°ç»ç«¯æ§è¡<code>docker images</code>ï¼è½çå°ä»¥ä¸ 4 ä¸ªéåï¼æ æ¥éå³æåå®æã</p>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422507-1702697897.png" alt="4 ä¸ªéå" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422557-1102222342.png" alt="docker images" loading="lazy"></p>
<h3 id="53-æ¬å°å°éåæåä¸º-tar-æä»¶åéå--æ¹ééåä¸¤ç§æ¹å¼">5.3 æ¬å°å°éåæåä¸º tar æä»¶ï¼åéå / æ¹ééåä¸¤ç§æ¹å¼ï¼</h3>
<p>æåéåæ<strong>åéåæå</strong>å<strong>æ¹ééåæå</strong>ä¸¤ç§æ¹å¼ï¼æ¨è<strong>æ¹éæåä¸ºä¸ä¸ª tar æä»¶</strong>ï¼æ¹ä¾¿ä¸ä¼ åæå¡å¨å¯¼å¥ï¼ï¼ä»¥ä¸ä¸¤ç§æ¹å¼åæä¾ä»£ç ç¤ºä¾ã</p>
<h4 id="æ¹å¼-1æ¹éæåææéåä¸ºä¸ä¸ª-tar-æä»¶æ¨èä¸æ¬¡å¯¼å¥ææ">æ¹å¼ 1ï¼æ¹éæåææéåä¸ºä¸ä¸ª tar æä»¶ï¼æ¨èï¼ä¸æ¬¡å¯¼å¥ææï¼</h4>
<p>å°æææåçéåæåä¸ºä¸ä¸ªç»ä¸ç tar æä»¶ï¼ç¤ºä¾ï¼rdif-all-images.tarï¼ï¼æ¾å¨æ¬å°<strong>ææ¾å°çç®å½</strong>ï¼å¦æ¡é¢ï¼ï¼æ§è¡å½ä»¤åååæ¢å°ç®æ ç®å½ï¼å¦ Windows æ¡é¢ç®å½ï¼ï¼</p>
<pre><code class="language-bash"># Windows PowerShellåæ¢å°æ¡é¢ç®å½ï¼ç¤ºä¾ï¼å¯æ¿æ¢ä¸ºèªå·±çç®å½ï¼
cd C:\Users\ä½ çç¨æ·å\Desktop

# æ¹éæåéåä¸ºrdif-all-images.tarï¼æ ¸å¿å½ä»¤ï¼åå«æææééåï¼
docker save -o rdif-all-images.tar mysql:8.0 redis:7-alpine mcr.microsoft.com/dotnet/aspnet:8.0 nginx:alpine
</code></pre>
<ul>
<li>å³é®åæ°ï¼<code>-o</code> æå®è¾åºç tar æä»¶ååè·¯å¾ï¼åé¢è·<strong>ææéè¦æåçéååï¼çæ¬</strong>ï¼ç¨ç©ºæ ¼åéã</li>
</ul>
<h4 id="æ¹å¼-2åä¸ªéååç¬æåæéä½¿ç¨éååç¬æ´æ°éå">æ¹å¼ 2ï¼åä¸ªéååç¬æåï¼æéä½¿ç¨ï¼éååç¬æ´æ°éåï¼</h4>
<p>å¦æåç»­åªéæ´æ°æä¸ªéåï¼å¦ä»æ´æ° MySQLï¼ï¼å¯åç¬æåè¯¥éåï¼å½ä»¤å¦ä¸ï¼</p>
<pre><code class="language-bash"># æåMySQL8.0ä¸ºåç¬çtaræä»¶
docker save -o mysql_8.0.tar mysql:8.0
# æåRedis7-alpineä¸ºåç¬çtaræä»¶
docker save -o redis_7_alpine.tar redis:7-alpine
# æå.NET8è¿è¡æ¶ä¸ºåç¬çtaræä»¶
docker save -o dotnet_aspnet_8.0.tar mcr.microsoft.com/dotnet/aspnet:8.0
# æåNginx-alpineä¸ºåç¬çtaræä»¶
docker save -o nginx_alpine.tar nginx:alpine
</code></pre>
<h3 id="54-éªè¯æ¬å°æåæå">5.4 éªè¯æ¬å°æåæå</h3>
<p>æåå®æåï¼å¨æ¬å°ç®æ ç®å½ï¼å¦æ¡é¢ï¼è½çå°çæç tar æä»¶ï¼å¦ rdif-all-images.tarï¼ï¼æä»¶å¤§å°çº¦ 2-3Gï¼æ­£å¸¸å¤§å°ï¼ï¼å³æåæåï¼åç»­ç¨ MobaXterm/Xftp/WinSCP å°è¯¥ tar æä»¶ä¸ä¼ å° CentOS æå¡å¨ç<code>/root/rdif-docker</code>ç®å½å³å¯ã</p>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422376-1797960651.png" alt="CentOS æå¡å¨ç" loading="lazy"></p>
<h2 id="å­æå¡å¨ç«¯æ ¸å¿é¨ç½²æ­¥éª¤ç¦»çº¿å¯¼å¥éå--å¯å¨æå¡">å­ãæå¡å¨ç«¯æ ¸å¿é¨ç½²æ­¥éª¤ï¼ç¦»çº¿å¯¼å¥éå + å¯å¨æå¡ï¼</h2>
<h3 id="61-ç¦»çº¿å¯¼å¥éåè§£å³ç½ç»æåè¶æ¶æ ¸å¿æ­¥éª¤">6.1 ç¦»çº¿å¯¼å¥éåï¼è§£å³ç½ç»æåè¶æ¶ï¼æ ¸å¿æ­¥éª¤ï¼</h3>
<p>å°æ¬å°æåå¥½çéå tar æä»¶ä¸ä¼ å°æå¡å¨åï¼æ§è¡ä»¥ä¸å½ä»¤ç¦»çº¿å¯¼å¥ï¼æ éåèç½æåï¼</p>
<pre><code class="language-bash"># 1. è¿å¥é¡¹ç®æ ¹ç®å½ï¼ç¡®ä¿éåtaråå¨è¯¥ç®å½ä¸ï¼
cd /root/rdif-docker

# 2. æ¥çéåtaråæ¯å¦å­å¨ï¼è½çå°rdif-all-images.tarå³æ­£å¸¸ï¼
ls -l

# 3. ç¦»çº¿å¯¼å¥ææéåï¼èå¿ç­å¾ï¼çº¦1-2åéï¼éååçº¦2-3Gï¼
docker load -i rdif-all-images.tar

# 4. éªè¯éåå¯¼å¥æåï¼è½çå°4ä¸ªæééåå³æ­£å¸¸ï¼
docker images
</code></pre>
<p>â æåæ è¯ï¼<code>docker images</code>è¾åºä¸­åå«<code>mysql:8.0</code>ã<code>redis:7-alpine</code>ã<code>nginx:alpine</code>ã<code>mcr.microsoft.com/dotnet/aspnet:8.0</code>ç­éåã</p>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422367-1290821445.png" alt="rdif-docker" loading="lazy"></p>
<h3 id="62-å¯å¨æææå¡æ ¸å¿å½ä»¤ä¸é®å¯å¨">6.2 å¯å¨æææå¡ï¼æ ¸å¿å½ä»¤ï¼ä¸é®å¯å¨ï¼</h3>
<p>ææéç½®ååå¤å·¥ä½å®æåï¼æ§è¡ä»¥ä¸å½ä»¤ï¼ä¸é®å¯å¨ææå®¹å¨ï¼æ éæå¨éä¸ªå¯å¨ï¼</p>
<pre><code class="language-bash"># è¿å¥é¡¹ç®æ ¹ç®å½ï¼å¿é¡»å¨docker-compose.ymlæå¨ç®å½æ§è¡ï¼
cd /root/rdif-docker

# åå°å¯å¨æææå¡ï¼-dï¼åå°è¿è¡ï¼æ éæå»ºï¼å ä¸ºååç«¯å·²æåï¼
docker-compose up -d

# æ¥çæææå¡è¿è¡ç¶æï¼æææå¡Stateåæ¾ç¤ºUpå³æ­£å¸¸ï¼
docker-compose ps
</code></pre>
<p>â æåæ è¯ï¼<code>docker-compose ps</code>è¾åºä¸­ï¼mysqlãredisãbackendãnginx åä¸ªæå¡ç State ååä¸º<code>Up (healthy)</code>æ<code>Up</code>ã</p>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422483-1638354417.png" alt="docker-compose ps" loading="lazy"></p>
<h3 id="63-éªè¯æå¡å¯å¨æåéä¸ªéªè¯ç¡®ä¿æ é®é¢">6.3 éªè¯æå¡å¯å¨æåï¼éä¸ªéªè¯ï¼ç¡®ä¿æ é®é¢ï¼</h3>
<p>å¯å¨åï¼éä¸ªéªè¯åç«¯ãåç«¯ãæ°æ®åºãRedis æ¯å¦æ­£å¸¸ï¼é¿ååç»­ä½¿ç¨æ¶åºç°é®é¢ï¼</p>
<h4 id="1éªè¯åç«¯æå¡swagger-è®¿é®æ ¸å¿">ï¼1ï¼éªè¯åç«¯æå¡ï¼Swagger è®¿é®ï¼æ ¸å¿ï¼</h4>
<p>.NET8 åç«¯é»è®¤éæ Swaggerï¼è®¿é®å°åï¼<code>http://192.168.1.100:58588/swagger/index.html</code>ï¼æ¿æ¢æèªå·±çèææº IP ååç«¯ç«¯å£ï¼</p>
<ul>
<li>
<p>â æåæ è¯ï¼æµè§å¨è½æ­£å¸¸æå¼ Swagger é¡µé¢ï¼æ æ¥éï¼è½çå°æææ¥å£ï¼</p>
</li>
<li>
<p>â å¤±è´¥ææ¥ï¼å¦ææä¸å¼ï¼æ§è¡<code>docker-compose logs -f backend</code>ï¼æ¥çåç«¯å®æ¶æ¥å¿ï¼ææ¥é®é¢ï¼å¦ç«¯å£çå¬éè¯¯ãMySQL è¿æ¥å¤±è´¥ï¼ã</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422711-690050077.png" alt="Swagger" loading="lazy"></p>
<h4 id="2éªè¯åç«¯æå¡éæé¡µé¢è®¿é®">ï¼2ï¼éªè¯åç«¯æå¡ï¼éæé¡µé¢è®¿é®ï¼</h4>
<p>åç«¯ç± Nginx ä»£çï¼è®¿é®å°åï¼<code>http://192.168.1.100:6866</code>ï¼æ¿æ¢æèªå·±çèææº IP ååç«¯ç«¯å£ï¼</p>
<ul>
<li>
<p>â æåæ è¯ï¼æµè§å¨è½æ­£å¸¸æå¼ Vue3 åç«¯é¡µé¢ï¼æ ·å¼ãå¾çæ­£å¸¸æ¾ç¤ºï¼</p>
</li>
<li>
<p>â å¤±è´¥ææ¥ï¼æä¸å¼åæ¥ç Nginx æ¥å¿ï¼å½ä»¤ï¼<code>docker-compose logs -f nginx</code>ï¼æ£æ¥ Nginx éç½®æ¯å¦æ­£ç¡®ãdist ç®å½æ¯å¦æè½½æåã</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422720-1858789771.png" alt="åç«¯é¡µé¢" loading="lazy"></p>
<h4 id="3éªè¯-mysql-æå¡æ¬å°å·¥å·è¿æ¥">ï¼3ï¼éªè¯ MySQL æå¡ï¼æ¬å°å·¥å·è¿æ¥ï¼</h4>
<p>ç¨ Navicat æ DBeaver ç­æ¬å°æ°æ®åºå·¥å·ï¼è¿æ¥èææºä¸ç MySQLï¼</p>
<ul>
<li>ä¸»æºï¼192.168.1.100ï¼èææº IPï¼</li>
<li>ç«¯å£ï¼3306</li>
<li>ç¨æ·åï¼guosisoftï¼èªå®ä¹ç MySQL ç¨æ·åï¼</li>
<li>å¯ç ï¼Mysql@123456ï¼èªå®ä¹çå¯ç ï¼</li>
<li>æ°æ®åºï¼rdif_vue3ï¼èªå®ä¹çæ°æ®åºåï¼</li>
<li>â æåæ è¯ï¼è½æ­£å¸¸è¿æ¥ï¼è½çå° init.sql åå§åçåºãè¡¨åæ°æ®ã</li>
</ul>
<h4 id="4éªè¯-redis-æå¡å¯éæééªè¯">ï¼4ï¼éªè¯ Redis æå¡ï¼å¯éï¼æééªè¯ï¼</h4>
<p>ç¨ Redis å®¢æ·ç«¯å·¥å·ï¼å¦ Another Redis Desktop Managerï¼ï¼è¿æ¥èææºä¸ç Redisï¼</p>
<ul>
<li>ä¸»æºï¼192.168.1.100ï¼èææº IPï¼</li>
<li>ç«¯å£ï¼6379</li>
<li>å¯ç ï¼Redis@123456ï¼èªå®ä¹ç Redis å¯ç ï¼</li>
<li>â æåæ è¯ï¼è½æ­£å¸¸è¿æ¥ï¼è½æ§è¡ setãget ç­å½ä»¤ã</li>
</ul>
<h2 id="ä¸é¨ç½²è¿ç¨ä¸­éå°çååè§£å³æ¹æ¡éç¹é¿åæå">ä¸ãé¨ç½²è¿ç¨ä¸­éå°çååè§£å³æ¹æ¡ï¼éç¹ï¼é¿åæåï¼</h2>
<p>è¿é¨åæ¯æ ¸å¿ï¼è®°å½äºæé¨ç½²è¿ç¨ä¸­éå°çææé®é¢ï¼æ¯ä¸ªé®é¢é½æè¯¦ç»çææ¥è¿ç¨åè§£å³æ¹æ¡ï¼äº²æµææï¼å¸®ä½ å°èµ°å¼¯è·¯ã</p>
<h3 id="å-1docker-éåæåè¶æ¶æç¤º-dial-tcp--io-timeout">å 1ï¼Docker éåæåè¶æ¶ï¼æç¤º âdial tcp ... i/o timeoutâ</h3>
<ul>
<li>ç°è±¡ï¼æ§è¡<code>docker pull mysql:8.0</code>æ<code>docker-compose up -d</code>æ¶ï¼æåéåè¶æ¶ï¼æç¤ºè®¿é®<code>registry-1.docker.io</code>å¤±è´¥ï¼</li>
<li>ææ¥ï¼èææºè½ ping éç¾åº¦ï¼å¤ç½æ­£å¸¸ï¼ï¼éåå ééç½®ä¹çæï¼ä½ä»æåè¶æ¶ï¼æ¨æµæ¯èææºç½ç»æéæ§éå¶ï¼å¦åç½æ¦æªï¼ï¼</li>
<li>è§£å³æ¹æ¡ï¼éç¨<strong>ç¦»çº¿å¯¼å¥éåæ¹æ¡</strong>ï¼åæ 5ã6 å°èå·²è¯¦ç»è¯´æï¼ï¼å¨æ¬å°è½èç½ççµèä¸æåéåãæåæ tar åï¼ä¸ä¼ å°æå¡å¨åç¨<code>docker load -i</code>å¯¼å¥ï¼å½»åºè·³è¿ç½ç»æåã</li>
</ul>
<h3 id="å-2åç«¯æå¡å¯å¨æåä½è®¿é®http192168110058588æä¸å¼-swagger">å 2ï¼åç«¯æå¡å¯å¨æåï¼ä½è®¿é®<code>http://192.168.1.100:58588</code>æä¸å¼ Swagger</h3>
<ul>
<li>
<p>ç°è±¡ï¼<code>docker-compose ps</code>æ¾ç¤º backend æå¡æ¯ Up ç¶æï¼ä½æµè§å¨è®¿é®åç«¯å°åæä¸å¼ï¼æ¥çåç«¯æ¥å¿ï¼æ¾ç¤º<code>Now listening on: http://[::]:8080</code>ï¼</p>
</li>
<li>
<p>ææ¥ï¼åç«¯å®¹å¨é»è®¤çå¬ 8080 ç«¯å£ï¼ä½ docker-compose.yml ä¸­æ å°çæ¯ 58588:58588ï¼ç«¯å£ä¸å¹éï¼å¯¼è´è®¿é®ä¸éï¼</p>
</li>
<li>
<p>è§£å³æ¹æ¡ï¼å¨ backend æå¡ç environment ä¸­ï¼æ·»å <code>ASPNETCORE_URLS: "http://*:58588"</code>ï¼å¼ºå¶.NET8 å®¹å¨åçå¬ 58588 ç«¯å£ï¼åç«¯å£æ å°ä¸è´ï¼éå¯åç«¯å®¹å¨å³å¯ã</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422720-938480573.png" alt="ASPNETCORE_URLS" loading="lazy"></p>
<h3 id="å-3åç«¯æ¥å¿æç¤º-unable-to-connect-to-any-of-the-specified-mysql-hosts">å 3ï¼åç«¯æ¥å¿æç¤º âUnable to connect to any of the specified MySQL hostsâ</h3>
<ul>
<li>
<p>ç°è±¡ï¼åç«¯å¯å¨åï¼æ¥å¿æç»­æ¥éï¼æ æ³è¿æ¥ MySQLï¼ä½æ¬å° Navicat è½æ­£å¸¸è¿æ¥èææºä¸ç MySQLï¼</p>
</li>
<li>
<p>ææ¥ï¼æ¬å°è½è¿æ¥ï¼è¯´æ MySQL ç«¯å£æ å°æ­£å¸¸ï¼åç«¯å®¹å¨å MySQL å®¹å¨å¨åä¸ Docker ç½ç»ï¼åºè¯¥ç¨å®¹å¨åï¼mysqlï¼è®¿é®ï¼èéèææº IPï¼ææ¥ååç°è¿æ¥å­ç¬¦ä¸²æ­£ç¡®ï¼ä½åç«¯å¯å¨æ©äº MySQL åå§åå®æï¼</p>
</li>
<li>
<p>è§£å³æ¹æ¡ï¼</p>
<ol>
<li>ç» MySQL æå¡æ·»å å¥åº·æ£æ¥ï¼åæ docker-compose.yml ä¸­ç healthcheck éç½®ï¼ï¼æ£æµ MySQL æ¯å¦çæ­£å°±ç»ªï¼</li>
<li>åç«¯æå¡ç depends_on ä¸­ï¼æ·»å <code>condition: service_healthy</code>ï¼ç¡®ä¿ MySQL å¥åº·æ£æ¥éè¿åï¼åå¯å¨åç«¯ï¼</li>
<li>ç» MySQL è¿æ¥å­ç¬¦ä¸²è¡¥å<code>AllowPublicKeyRetrieval=True;SslMode=None</code>ï¼è§£å³å®¹å¨åè¿æ¥ MySQL çå¬é¥æ£ç´¢å SSL éå¶ã</li>
</ol>
</li>
</ul>
<h3 id="å-4æ§è¡docker-compose-downæç¤ºéç½®æ æunsupported-config-option-for-servicesbackend-condition">å 4ï¼æ§è¡<code>docker-compose down</code>æç¤ºéç½®æ æï¼âUnsupported config option for services.backend: 'condition'â</h3>
<ul>
<li>ç°è±¡ï¼æ§è¡ docker-compose å½ä»¤æ¶ï¼æç¤ºéç½®æ æï¼ä¸æ¯æ<code>condition</code>å<code>start_period</code>ï¼</li>
<li>ææ¥ï¼æ¥ç docker-compose çæ¬ï¼åç°æ¯ 1.x çæ¬ï¼ä¸æ¯ææ°çéç½®é¡¹ï¼</li>
<li>è§£å³æ¹æ¡ï¼åçº§ Docker Compose å° V2 çæ¬ï¼åæäºã4 å°èå·²è¯¦ç»è¯´æï¼ï¼åçº§åå³å¯æ¯æææéç½®ã</li>
</ul>
<h3 id="å-5mysql-å®¹å¨æ¶é´æ¯åäº¬æ¶é´æ¢-8-å°æ¶">å 5ï¼MySQL å®¹å¨æ¶é´æ¯åäº¬æ¶é´æ¢ 8 å°æ¶</h3>
<ul>
<li>
<p>ç°è±¡ï¼MySQL ä¸­æ¥è¯¢å½åæ¶é´ï¼<code>select now();</code>ï¼ï¼æ¯åäº¬æ¶é´æ¢ 8 å°æ¶ï¼å½±åé¡¹ç®æ¶é´ç¸å³åè½ï¼</p>
</li>
<li>
<p>ææ¥ï¼Docker å®¹å¨é»è®¤ä½¿ç¨ UTC ä¸çæ åæ¶é´ï¼å½åä½¿ç¨ä¸å«åºï¼CSTï¼ï¼ä¸¤èç¸å·® 8 å°æ¶ï¼</p>
</li>
<li>
<p>è§£å³æ¹æ¡ï¼</p>
<ol>
<li>
<p>ç» MySQL æå¡æ·»å ç¯å¢åé<code>TZ: Asia/Shanghai</code>ï¼å¼ºå¶å®¹å¨æ¶åºä¸ºä¸å«åºï¼æ ¸å¿ï¼ï¼</p>
</li>
<li>
<p>æè½½å®¿ä¸»æºçæ¶åºæä»¶ï¼<code>/etc/localtime:/etc/localtime:ro</code>ï¼ï¼åéä¿éæ¶åºåæ­¥ï¼</p>
</li>
<li>
<p>ç»åç«¯ãNginxãRedis å®¹å¨ä¹æ·»å ç¸åç<code>TZ</code>ç¯å¢åéï¼å®ç°å¨æå¡æ¶é´ç»ä¸ï¼</p>
</li>
<li>
<p>éå»º MySQL å®¹å¨ï¼ç¯å¢åéä¿®æ¹åï¼åçº¯ restart ä¸çæï¼é<code>docker-compose stop mysql &amp;&amp; docker-compose rm -f mysql &amp;&amp; docker-compose up -d mysql</code>ï¼ã</p>
</li>
</ol>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210102245661-1868000854.png" alt="MySQL æå¡æ·»å ç¯å¢åéTZ" loading="lazy"></p>
<h3 id="å-6èææºéå¯åææ-docker-æå¡é½éè¦æå¨å¯å¨">å 6ï¼èææºéå¯åï¼ææ Docker æå¡é½éè¦æå¨å¯å¨</h3>
<ul>
<li>ç°è±¡ï¼èææºéå¯åï¼Docker æå¡åææå®¹å¨é½åæ­¢äºï¼éè¦æå¨æ§è¡<code>systemctl start docker</code>å<code>docker-compose up -d</code>ï¼</li>
<li>ææ¥ï¼Docker æå¡æªè®¾ç½®å¼æºèªå¯ï¼å®¹å¨ç<code>restart: always</code>éç½®ï¼éè¦ Docker æå¡å¯å¨åæä¼çæï¼</li>
<li>è§£å³æ¹æ¡ï¼è®¾ç½® Docker æå¡å¼æºèªå¯ï¼å½ä»¤ï¼<code>systemctl enable docker</code>ï¼åç»­èææºéå¯åï¼Docker ä¼èªå¨å¯å¨ï¼ææå®¹å¨ä¹ä¼èªå¨åå°å¯å¨ã</li>
</ul>
<h3 id="å-7æ¬å°æåéååæå¡å¨å¯¼å¥æç¤º-no-such-image">å 7ï¼æ¬å°æåéååï¼æå¡å¨å¯¼å¥æç¤º âno such imageâ</h3>
<ul>
<li>ç°è±¡ï¼æ§è¡<code>docker load -i rdif-all-images.tar</code>æ¶ï¼æç¤ºéåä¸å­å¨ï¼</li>
<li>ææ¥ï¼æ¬å°æåçéåçæ¬åæå¡å¨ docker-compose.yml ä¸­éç½®ççæ¬ä¸ä¸è´ï¼ææåæ¶éååæ¼åéè¯¯ï¼</li>
<li>è§£å³æ¹æ¡ï¼æ¬å°æ§è¡<code>docker images</code>ç¡®è®¤éåååçæ¬ï¼ç¡®ä¿å docker-compose.yml ä¸­å®å¨ä¸è´ï¼éæ°æåå¹¶ä¸ä¼ ã</li>
</ul>
<h3 id="å-8èææºéå¯åipåæ´é®é¢">å 8ï¼èææºéå¯åIPåæ´é®é¢</h3>
<p>é¦åæ¥çæ¬å°ç½ç»éç½®ï¼å¦ä¸åèï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422554-35499731.png" alt="æ¬å°ç½ç»éç½®" loading="lazy"></p>
<p>èææºç½ç»ééå¨è®¾ç½®ä¸ºæ¡¥æ¥æ¨¡å¼ã</p>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422517-1315584570.png" alt="æ¡¥æ¥æ¨¡å¼" loading="lazy"></p>
<p>å¨linuxä¸­æ§è¡å½ä»¤ï¼</p>
<pre><code class="language-bash">vim /etc/sysconfig/network-scripts/ifcfg-ens33
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422595-392661691.png" alt="" loading="lazy"></p>
<p>ä¿å­åéå¯ç½ç»æå¡</p>
<pre><code class="language-bash">systemctl restart network
</code></pre>
<h2 id="å«å¸¸ç¨-dockercompose-ç®¡çå½ä»¤æ¥å¸¸è¿ç»´å¿å¤">å«ãå¸¸ç¨ Docker/Compose ç®¡çå½ä»¤ï¼æ¥å¸¸è¿ç»´å¿å¤ï¼</h2>
<p>é¨ç½²å®æåï¼æ¥å¸¸ç»´æ¤ãæéï¼é½ä¼ç¨å°ä»¥ä¸å½ä»¤ï¼æ´çå¥½æ¾å¨è¿éï¼æ¹ä¾¿åç»­ä½¿ç¨ï¼ææå½ä»¤åäº²æµå¯ç¨ï¼ã</p>
<h3 id="ä¸docker-åºç¡å½ä»¤å¨å±éç¨">ï¼ä¸ï¼Docker åºç¡å½ä»¤ï¼å¨å±éç¨ï¼</h3>
<pre><code class="language-bash"># 1. Dockeræå¡ç®¡çï¼æ ¸å¿ï¼å¼æºèªå¯/å¯åï¼
systemctl start docker        # å¯å¨Dockeræå¡
systemctl stop docker         # åæ­¢Dockeræå¡
systemctl restart docker      # éå¯Dockeræå¡
systemctl enable docker       # Dockerå¼æºèªå¯ï¼æ°¸ä¹çæï¼
systemctl disable docker      # å³é­Dockerå¼æºèªå¯
systemctl status docker       # æ¥çDockeræå¡ç¶æ
systemctl is-enabled docker   # æ£æ¥Dockeræ¯å¦å¼æºèªå¯ï¼è¾åºenabledåæ¯ï¼

# 2. å®¹å¨ç®¡çï¼æ¥å¸¸æéãå¯åå¸¸ç¨ï¼
docker ps                     # æ¥ç**è¿è¡ä¸­**çå®¹å¨
docker ps -a                  # æ¥ç**ææ**å®¹å¨ï¼è¿è¡+åæ­¢ï¼
docker start &lt;å®¹å¨å/ID&gt;       # å¯å¨æå®å®¹å¨ï¼ç¨å®¹å¨åï¼æ´æ¹ä¾¿ï¼
docker stop &lt;å®¹å¨å/ID&gt;        # åæ­¢æå®å®¹å¨
docker restart &lt;å®¹å¨å/ID&gt;     # éå¯æå®å®¹å¨ï¼å¦åç«¯å®¹å¨ï¼docker restart rdif-backendï¼
docker rm &lt;å®¹å¨å/ID&gt;          # å é¤æå®åæ­¢çå®¹å¨
docker rm -f &lt;å®¹å¨å/ID&gt;       # å¼ºå¶å é¤**è¿è¡ä¸­**çå®¹å¨ï¼è°¨æä½¿ç¨ï¼
docker exec -it &lt;å®¹å¨å/ID&gt; /bin/bash  # è¿å¥å®¹å¨äº¤äºç»ç«¯ï¼Alpineéåç¨shæ¿ä»£/bin/bashï¼
docker logs &lt;å®¹å¨å/ID&gt;       	# æ¥çå®¹å¨æ¥å¿ï¼ææ°ï¼
docker logs -f &lt;å®¹å¨å/ID&gt;   		# å®æ¶æ¥çå®¹å¨æ¥å¿ï¼æéæ ¸å¿ï¼éç¹ï¼
docker logs --tail 100 &lt;å®¹å¨å/ID&gt; # æ¥çå®¹å¨æå100è¡æ¥å¿

# 3. éåç®¡çï¼ç¦»çº¿å¯¼å¥/æåå¸¸ç¨ï¼
docker images                 # æ¥çæ¬å°ææéå
docker rmi &lt;éåå/ID&gt;         # å é¤æå®éåï¼æ å®¹å¨ä¾èµæ¶ï¼
docker rmi -f &lt;éåå/ID&gt;      # å¼ºå¶å é¤éåï¼å¿½ç¥å®¹å¨ä¾èµï¼è°¨æï¼å¦ï¼docker rmi -f mysql:8.0ï¼
docker load -i &lt;éåtarå&gt;    # ç¦»çº¿å¯¼å¥éåï¼å¦ï¼docker load -i rdif-all-images.tarï¼
docker save -o &lt;è¾åºtarå&gt; &lt;éåå&gt; # æåæ¬å°éåä¸ºtaråï¼å¦ï¼docker save -o mysql8.tar mysql:8.0ï¼
docker pull &lt;éåå:çæ¬&gt;      # æåè¿ç¨éå
docker system prune -f        # æ¸çæ ç¨å®¹å¨/éå/ç¼å­ï¼æ é£é©ï¼æ¨èå®ææ§è¡ï¼

# 4. æ°æ®å·/ç½ç»ç®¡çï¼æ¬æ¬¡èªå¨åå»ºï¼æéæ¥çï¼
docker volume ls              # æ¥çææDockeræ°æ®å·ï¼ä¿å­MySQL/Redisæ°æ®ï¼
docker network ls             # æ¥çææDockerç½ç»ï¼æ¬æ¬¡ä¸ºrdif-networkï¼
</code></pre>
<h3 id="äºdocker-compose-å½ä»¤é¡¹ç®ç®¡çæ ¸å¿éå¨é¡¹ç®æ ¹ç®å½æ§è¡">ï¼äºï¼Docker Compose å½ä»¤ï¼é¡¹ç®ç®¡çæ ¸å¿ï¼éå¨é¡¹ç®æ ¹ç®å½æ§è¡ï¼</h3>
<pre><code class="language-bash"># 1. æ ¸å¿å¯åå½ä»¤ï¼æå¸¸ç¨ï¼
docker-compose up -d          # åå°å¯å¨æææå¡ï¼æ æå»ºï¼æ¬æ¬¡æ ¸å¿ç¨ï¼
docker-compose up -d --build  # åå°å¯å¨+æå»ºéåï¼æDockerfileæ¶ç¨ï¼
docker-compose down           # åæ­¢å¹¶å é¤ææå®¹å¨ï¼ä¿çæ°æ®å·/éåï¼å®å¨ï¼
docker-compose stop           # ä»åæ­¢ææå®¹å¨ï¼ä¸å é¤ï¼å®¹å¨ä»å­å¨ï¼
docker-compose start          # å¯å¨å·²åæ­¢çææå®¹å¨
docker-compose restart        # éå¯æææå¡ï¼éç½®æªæ¹æ¶ç¨ï¼
docker-compose restart backend # éå¯æå®æå¡ï¼å¦åç«¯ï¼æ ééå¯æææå¡ï¼

# 2. ç¶æ/æ¥å¿æ¥çï¼æéå¸¸ç¨ï¼
docker-compose ps             # æ¥çæææå¡è¿è¡ç¶æï¼çæ¯å¦Upï¼
docker-compose logs -f        # å®æ¶æ¥çæææå¡æ¥å¿
docker-compose logs -f &lt;æå¡å&gt; # å®æ¶æ¥çæå®æå¡æ¥å¿ï¼å¦docker-compose logs -f backendï¼å®æ¶æ¥çåç«¯æ¥å¿ï¼æééç¹ï¼

# 3. å¶ä»å¸¸ç¨
docker-compose config         # éªè¯docker-compose.ymléç½®è¯­æ³æ¯å¦æ­£ç¡®ï¼é¿åéç½®éè¯¯ï¼
docker-compose rm &lt;æå¡å&gt;     # å é¤æå®åæ­¢çæå¡å®¹å¨

</code></pre>
<h2 id="ä¹å¼æºèªå¯éç½®æ éæå¨å¹²é¢èææºéå¯èªå¨æ¢å¤">ä¹ãå¼æºèªå¯éç½®ï¼æ éæå¨å¹²é¢ï¼èææºéå¯èªå¨æ¢å¤ï¼</h2>
<p>åé¢å·²ç»æå°ï¼è¿éååç¬æ´çä¸éï¼ç¡®ä¿èææºéå¯åï¼æææå¡èªå¨å¯å¨ï¼æ éæå¨æä½ï¼</p>
<pre><code class="language-bash"># 1. ç¡®ä¿Dockeræå¡å¼æºèªå¯ï¼å·²éç½®ï¼åæ¬¡éªè¯ï¼
systemctl enable docker
systemctl is-enabled docker   # è¾åºenabledå³æå

# 2. éªè¯å®¹å¨èªå¨éå¯ç­ç¥ï¼docker-compose.ymlå·²éç½®restart: alwaysï¼
docker-compose config | grep -i restart # è¾åº4ä¸ªrestart: alwayså³æ­£å¸¸

# 3. æµè¯éªè¯ï¼å¯éï¼æå¨éå¯èææºï¼
reboot # éå¯èææºï¼éæ°è¿æ¥åï¼ç´æ¥è®¿é®æå¡ï¼ç¡®è®¤è½æ­£å¸¸æå¼
</code></pre>
<p>â æåæ è¯ï¼èææºéå¯åï¼æ éæ§è¡ä»»ä½å½ä»¤ï¼<code>docker-compose ps</code>æ¾ç¤ºæææå¡é½æ¯ Up ç¶æï¼åç«¯ãåç«¯ãSwagger é½è½æ­£å¸¸è®¿é®ã</p>
<h2 id="åååç«¯æ´æ°æ¹æ³æ¥å¸¸ç»´æ¤ç®åé«æ">åãååç«¯æ´æ°æ¹æ³ï¼æ¥å¸¸ç»´æ¤ï¼ç®åé«æï¼</h2>
<p>åç»­éè¦æ´æ°åç«¯æåç«¯ä»£ç æ¶ï¼æ ééæ°é¨ç½²æ´ä¸ªç¯å¢ï¼ç´æ¥æ¿æ¢æå / åå¸æä»¶ï¼éå¯å¯¹åºæå¡å³å¯ï¼æ­¥éª¤å¦ä¸ï¼</p>
<h3 id="1-åç«¯æ´æ°vs2022-éæ°åå¸å">1. åç«¯æ´æ°ï¼VS2022+ éæ°åå¸åï¼</h3>
<ol>
<li>æ¬å° VS2022+ éæ°åå¸.NET8 é¡¹ç®ï¼çææ°ç publish æä»¶å¤¹ï¼</li>
<li>ç¨ Xftp å·¥å·ï¼å°æ°ç publish æä»¶å¤¹ï¼è¦çæå¡å¨<code>/root/rdif-docker/backend/</code>ä¸çæ§ publish æä»¶å¤¹ï¼</li>
<li>éå¯åç«¯å®¹å¨ï¼æ´æ°çæï¼</li>
</ol>
<pre><code class="language-bash">cd /root/rdif-docker
docker-compose restart backend
</code></pre>
<h3 id="2-åç«¯æ´æ°vue3-éæ°æåå">2. åç«¯æ´æ°ï¼Vue3 éæ°æååï¼</h3>
<ol>
<li>æ¬å° Vue3 é¡¹ç®éæ°æåï¼yarn build/npm run buildï¼ï¼çææ°ç dist æä»¶å¤¹ï¼</li>
<li>ç¨ Xftp å·¥å·ï¼å°æ°ç dist æä»¶å¤¹ï¼è¦çæå¡å¨<code>/root/rdif-docker/frontend/</code>ä¸çæ§ dist æä»¶å¤¹ï¼</li>
<li>éå¯ Nginx å®¹å¨ï¼æ´æ°çæï¼</li>
</ol>
<pre><code class="language-bash">cd /root/rdif-docker
docker-compose restart nginx
</code></pre>
<h2 id="åä¸æ»ç»ä¸æ³¨æäºé¡¹æåæéé¿åæ¶å°¾">åä¸ãæ»ç»ä¸æ³¨æäºé¡¹ï¼æåæéï¼é¿åæ¶å°¾ï¼</h2>
<h3 id="æ»ç»">æ»ç»</h3>
<p>æ¬æ¬¡é¨ç½²åºäº<strong>Docker Compose</strong>å®ç°äº.NET8 åç«¯ï¼å·²åå¸ï¼+Vue åç«¯ï¼å·²æåï¼+MySQL8+Redis+Nginx çæ´å¥å¤æå¡å®¹å¨åé¨ç½²ï¼å¨ç¨äº²æµå¯å¤ç°ï¼æ ¸å¿äº®ç¹ï¼</p>
<ol>
<li>éç¨<strong>ç¦»çº¿éåå¯¼å¥</strong>æ¹æ¡ï¼è§£å³æå¡å¨ç½ç»æåéåè¶æ¶é®é¢ï¼éæ¬å°æå + æåå®æ´æ­¥éª¤ï¼æ°æä¹è½ä¸æï¼</li>
<li>ååç«¯æ éå®¹å¨åç¼è¯æå»ºï¼ç´æ¥æè½½æ¬å°æå / åå¸æä»¶ï¼å¯å¨æ´å¿«ãæ´æ°æ´æ¹ä¾¿ï¼éåå·²å®ææ¬å°å¼åçé¡¹ç®ï¼</li>
<li>è§£å³äº<strong>ç«¯å£ä¸éãMySQL è¿æ¥å¤±è´¥ãæ¶åºæ¶å·®ãå®¹å¨å¯å¨é¡ºåºãéç½®å¼å®¹ãå¼æºèªå¯</strong>ç­ 6 å¤§æ ¸å¿é®é¢ï¼éè¯¦ç»é¿åæ¹æ¡ï¼</li>
<li>ææéç½®éä¸­å¨<code>docker-compose.yml</code>ï¼ä¸é®å¯åãæç»´æ¤ãæè¿ç§»ï¼èææºéå¯åæå¡èªå¨æ¢å¤ï¼æ éæå¨å¹²é¢ï¼</li>
<li>å¨ç¨éç¨è½»éçéåï¼alpineï¼ï¼éä½æå¡å¨èµæºå ç¨ï¼éåä¸ªäººæµè¯ / å°åé¡¹ç®é¨ç½²ã</li>
</ol>
<h3 id="æ³¨æäºé¡¹éç¹é¿åçäº§ç¯å¢å¿ç">æ³¨æäºé¡¹ï¼éç¹é¿åï¼çäº§ç¯å¢å¿çï¼</h3>
<ol>
<li>
<p><strong>çæ¬å¼ºä¸è´</strong>ï¼æ¬å°æåçéåçæ¬ãdocker-compose.yml ä¸­çéåçæ¬ãåç«¯ / åç«¯çè¿è¡ä¾èµçæ¬ï¼å¿é¡»å®å¨ä¸è´ï¼é¿åå¼å®¹é®é¢ï¼</p>
</li>
<li>
<p><strong>å®¹å¨é´éä¿¡è§å</strong>ï¼åä¸ Docker èªå®ä¹ç½ç»åï¼æå¡é´è®¿é®<strong>å¿é¡»ç¨å®¹å¨å / æå¡å</strong>ï¼å¦åç«¯è¿ MySQL ç¨<code>server=mysql</code>ï¼ï¼èéæå¡å¨ IPï¼æ¬å°å·¥å·ï¼Navicat/Redis å®¢æ·ç«¯ï¼è¿æ¥æç¨æå¡å¨ IPï¼</p>
</li>
<li>
<p><strong>ç¯å¢åéä¿®æ¹è§å</strong>ï¼ä¿®æ¹å®¹å¨çç¯å¢åéï¼å¦ TZãASPNETCORE_URLSãå¯ç ï¼åï¼<strong>å¿é¡»éå»ºå®¹å¨</strong>ï¼<code>stop+rm+up -d</code>ï¼ï¼åçº¯<code>restart</code>ä¸ä¼å è½½æ°éç½®ï¼</p>
</li>
<li>
<p><strong>æ°æ®æä¹å</strong>ï¼MySQL/Redis æ°æ®éè¿ Docker<strong>æ°æ®å·</strong>æä¹åï¼<code>docker-compose down</code>ä¸ä¼å é¤æ°æ®å·ï¼ä½æå¨æ§è¡<code>docker volume rm</code>ä¼ä¸¢å¤±æ°æ®ï¼è°¨ææä½ï¼</p>
</li>
<li>
<p><strong>ææä¿¡æ¯ä¿æ¤</strong>ï¼æ¬æä¸­ç IPãå¯ç ãéåå éå°ååä¸ºèæç¤ºä¾ï¼å®éé¨ç½²è¯·<strong>æ¿æ¢ä¸ºèªå·±ççå®ä¿¡æ¯</strong>ï¼å¹¶è®¾ç½®å¤æå¯ç ï¼å­æ¯ + æ°å­ + ç¹æ®ç¬¦å·ï¼ï¼</p>
</li>
<li>
<p>çäº§ç¯å¢ä¼å</p>
<p>ï¼æ¬æä¸ºä¸ªäººæµè¯ç¯å¢</p>
<p>éç½®ï¼çäº§ç¯å¢éåä»¥ä¸ä¼åï¼</p>
<ul>
<li>å¼å¯é²ç«å¢ï¼ä»å¼æ¾é¡¹ç®æéç«¯å£ï¼6866/58588/3306ï¼ï¼æ§è¡<code>firewall-cmd --add-port=ç«¯å£/tcp --permanent &amp;&amp; firewall-cmd --reload</code>ï¼</li>
<li>ç¦ç¨ root è´¦å·ç´æ¥ç»å½ï¼åå»ºæ®éç¨æ·å¹¶èµäº Docker æä½æéï¼</li>
<li>éç½® SSL è¯ä¹¦ï¼å®ç° HTTPS è®¿é®ï¼</li>
<li>å¯¹ MySQL/Redis åä¸»ä»å¤å¶ / éç¾¤ï¼æåå¯ç¨æ§ï¼</li>
</ul>
</li>
<li>
<p><strong>æéæ ¸å¿æè·¯</strong>ï¼ä»»ä½æå¡å¯å¨å¤±è´¥ãè®¿é®ä¸éï¼<strong>ä¼åæ¥çå®¹å¨æ¥å¿</strong>ï¼<code>docker-compose logs -f æå¡å</code>ï¼ï¼æ¥å¿æ¯å®ä½é®é¢çæç´æ¥ä¾æ®ï¼</p>
</li>
</ol>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260210093422691-908014533.png" alt="æ¥çå®¹å¨æ¥å¿" loading="lazy"></p>
<ol start="8">
<li><strong>éåå¤ä»½</strong>ï¼æå¡å¨ç«¯çç¦»çº¿éå tar åå»ºè®®ä¿çï¼åç»­æå¡å¨éè£å¯ç´æ¥å¯¼å¥ï¼æ ééæ°æ¬å°æåã</li>
</ol>
<p>æ´ä¸ªé¨ç½²è¿ç¨è½ç¶è¸©äºä¸å°åï¼ä½æ ¸å¿é®é¢é½æ¯å¿½ç¥äº<strong>å®¹å¨åçç»è</strong>ï¼å¦ç«¯å£å¹éãæ¶åºéç½®ãå®¹å¨éä¿¡è§åãå¯å¨é¡ºåºï¼ï¼åªè¦ææ­¥éª¤åå¥½éç½®ãéä¸éªè¯ï¼å°±è½é¡ºå©å®æé¨ç½²ãDocker Compose çç¼æè½åè®©å¤æå¡é¨ç½²åå¾ç®åï¼ä¹æ¯åç«¯å¼åå¿å¤çæè½ä¹ä¸ã</p>
<p>å¸æè¿ç¯è¯¦ç»çé¨ç½²è®°å½ï¼è½å¸®å°æåæ ·éæ±çæåï¼å°èµ°å¼¯è·¯ï¼é«æå®æ.NET8+Vue é¡¹ç®ç Docker å®¹å¨åé¨ç½²ãå¦æå¤§å®¶å¨é¨ç½²è¿ç¨ä¸­éå°å¶ä»é®é¢ï¼æ¬¢è¿å¨è¯è®ºåºçè¨ï¼ä¸èµ·äº¤æµè§£å³ï½</p>
<h2 id="åäºç»è¯­">åäºãç»è¯­</h2>
<p>å¦ææ¬æå¯¹ä½ æä¸ç¹ç¹å¸®å©ï¼ç¹ä¸ªèµæ¯æä¸ä¸å§ï¼ä½ çæ¯ä¸ä¸ªãèµãé½æ¯æåä½çæå¤§å¨å _</p>
<p>æ´å¤ææ¯æç« è¯·å¾:</p>
<p><a href="http://www.guosisoft.com/article" target="_blank" rel="noopener nofollow">http://www.guosisoft.com/article</a></p>
<p><a href="http://www.rdiframework.net/article" target="_blank" rel="noopener nofollow">http://www.rdiframework.net/article</a></p>
<p>å¤§å®¶ä¸èµ·å±åäº¤æµåè¿æ­¥å!!</p>


</div>
<div id="MySignature" role="contentinfo">
    <span style="font-size:10pt;">
</span>
<p>
	<br>
</p>
<p style="background-color:#f8f8ee;font-family:å¾®è½¯éé»;font-size:12px;" id="mySignature">
	<span style="font-size:10pt;">ä½èï¼</span>
	<strong>
		<span style="color:red;font-size:12px;">
			<a href="http://www.guosisoft.com/" target="_blank">
				<span>
					<span style="font-size:10pt;">RDIF</span>
				</span>
			</a>
		</span>
	</strong>
	<br>
	<span style="font-size:10pt;">åºå¤ï¼</span>
	<a href="http://www.cnblogs.com/huyong/" target="_blank">
		<span style="font-size:10pt;">http://www.cnblogs.com/huyong/</span>
	</a>
	<br>
	<span style="font-size:10pt;">Emailï¼</span>
	<a href="mailto:406590790@qq.com" target="_blank">
		<span style="font-size:10pt;">406590790@qq.com</span>
	</a>
	<br>
	<span style="font-size:10pt;">QQï¼</span>
	<span style="font-size:10pt;">406590790</span>
	<br>
	<span style="font-size:10pt;">å¾®ä¿¡ï¼</span>
	<span style="font-size:10pt;">13005007127(åææºå·)</span>
	<br>
	<span style="font-size:10pt;">æ¡æ¶å®ç½ï¼</span>  
   <a href="http://www.guosisoft.com/" target="_blank">
		<span style="font-size:10pt;">http://www.guosisoft.com/</span>
	</a>
  &nbsp;&nbsp;&nbsp;
	<a href="http://www.rdiframework.net/" target="_blank">
		<span style="font-size:10pt;">http://www.rdiframework.net/</span>
	</a>
	<br>
	<span style="font-size:10pt;">æ¡æ¶å¶ä»åå®¢ï¼</span>
	<a href="http://blog.csdn.net/chinahuyong" target="_blank">
		<span style="font-size:10pt;">http://blog.csdn.net/chinahuyong</span>
	</a>
	<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="http://www.cnblogs.com/huyong" target="_blank">
		<span style="font-size:10pt;">http://www.cnblogs.com/huyong</span>
	</a>
	<br>
	<a href="http://www.guosisoft.com/" target="_blank">
		<span style="font-size:10pt;">å½æRDIFå¼åæ¡æ¶</span>
	</a>ï¼
	<span style="font-size:10pt;color:#FFFFFF;background-color:#009900;">ç»ç¨æ·åå¼åèæä½³ç.Netæ¡æ¶å¹³å°æ¹æ¡ï¼ä¸ºä¼ä¸å¿«éæå»ºè·¨å¹³å°ãä¼ä¸çº§çåºç¨æä¾å¼ºå¤§æ¯æã</span>
	<br>
	<span style="font-size:10pt;">å³äºä½èï¼ç³»ç»æ¶æå¸ãä¿¡æ¯ç³»ç»é¡¹ç®ç®¡çå¸ãDBAãä¸æ³¨äºå¾®è½¯å¹³å°é¡¹ç®æ¶æãç®¡çåä¼ä¸è§£å³æ¹æ¡ï¼å¤å¹´é¡¹ç®å¼åä¸ç®¡çç»éªï¼æ¾å¤æ¬¡ç»ç»å¹¶å¼åå¤ä¸ªå¤§åé¡¹ç®ï¼å¨é¢åå¯¹è±¡ãé¢åæå¡ä»¥åæ°æ®åºé¢åæä¸å®çé è¯£ãç°ä¸»è¦ä»äºåºäº</span>
	<a href="http://www.guosisoft.com/" target="_blank">
		<span style="font-size:10pt;">RDIF</span>
	</a>
	<span style="font-size:10pt;">æ¡æ¶çææ¯å¼åãå¨è¯¢å·¥ä½ï¼ä¸»è¦æå¡äºéèãå»çå«çãéè·¯ãçµä¿¡ãç©æµãç©èç½ãå¶é ãé¶å®ç­è¡ä¸ã</span>
	<br>
	<span style="font-size:10pt;">å¦æé®é¢æå»ºè®®ï¼è¯·å¤å¤èµæï¼</span>
	<br>
	<span style="font-size:10pt;">æ¬æçæå½ä½èåCNBLOGSåå®¢å±æï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»ä¿çæ­¤æ®µå£°æï¼ä¸å¨æç« é¡µé¢ææ¾ä½ç½®ç»åºåæè¿æ¥ï¼å¦æé®é¢ï¼å¯ä»¥éè¿å¾®ä¿¡ãé®ç®±ãQQç­èç³»æï¼éå¸¸æè°¢ã</span>
</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.003472222222222222" data-date-updated="2026-02-10 10:23">2026-02-10 10:18</span>&nbsp;
<a href="https://www.cnblogs.com/huyong">.NETå¿«éå¼åæ¡æ¶</a>&nbsp;
éè¯»(<span id="post_view_count">24</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19598103);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19598103', targetLink: 'https://www.cnblogs.com/huyong/p/19598103', title: 'Linux Docker Compose é¨ç½².NET+Vue+MySQL+Redis+Nginx å®æ´è®°å½ï¼äº²æµæ åï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æè§£ OpenDeepWiki ç Agent Skills æºå¶ï¼ä» SKILL.md å° AI å·¥å·è°ç¨çå®æ´é¾è·¯ ]]></title>
    <link>https://www.cnblogs.com/token-ai/p/19598343</link>
    <guid>a817e8fbeff52a44bd6dd5a59cc9446d</guid>
    <description>
    <![CDATA[ 
        <div class="postTitle">
            <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/token-ai/p/19598343" title="åå¸äº 2026-02-10 10:15">
    <span role="heading" aria-level="2">æè§£ OpenDeepWiki ç Agent Skills æºå¶ï¼ä» SKILL.md å° AI å·¥å·è°ç¨çå®æ´é¾è·¯</span>
    

</a>

        </div>
        <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æè¿å¨è¯» OpenDeepWiki çæºç ï¼åç°å®å®ç°äºä¸å¥æºæææç Skill æ©å±ä½ç³»ãç®åè¯´å°±æ¯ï¼ä½ åä¸ä¸ª <code>SKILL.md</code> æä»¶ï¼æåæ ZIP ä¸ä¼ ï¼ç³»ç»å°±è½æå®åæ AI Agent å¯è°ç¨çå·¥å·ãæ´ä¸ªè¿ç¨æ¶åæä»¶è§£æãæ°æ®åºæä¹åãè¿è¡æ¶å·¥å·æ³¨å¥ç­å¤ä¸ªç¯èï¼è¿ç¯æç« æè¿æ¡é¾è·¯ä»å¤´å°å°¾æä¸éã</p>
<h2 id="ä¸åææ¸æ¥-skill-æ¯ä»ä¹">ä¸ãåææ¸æ¥ Skill æ¯ä»ä¹</h2>
<p>OpenDeepWiki ç Skill éµå¾ª <a href="https://agentskills.io" target="_blank" rel="noopener nofollow">agentskills.io</a> å¼æ¾æ åï¼Anthropic æåºç Agent Skills è§èï¼ãä¸ä¸ª Skill æ¬è´¨ä¸å°±æ¯ä¸ä¸ªæä»¶å¤¹ï¼æ ¸å¿æ¯ä¸ä¸ª <code>SKILL.md</code> æä»¶ï¼éé¢ç¨ YAML frontmatter å£°æåæ°æ®ï¼æ­£æé¨åæ¯ç» AI ç prompt æä»¤ã</p>
<p>ä¸ä¸ªå¸åç Skill æä»¶å¤¹é¿è¿æ ·ï¼</p>
<pre><code>code-review/
âââ SKILL.md          # æ ¸å¿æä»¶ï¼frontmatter + prompt
âââ scripts/          # å¯éï¼è¾å©èæ¬
âââ references/       # å¯éï¼åèèµæ
âââ assets/           # å¯éï¼éæèµæº
</code></pre>
<p><code>SKILL.md</code> çæ ¼å¼å¤§æ¦æ¯ï¼</p>
<pre><code class="language-markdown">---
name: code-review
description: å¯¹ä»£ç è¿è¡æ·±åº¦å®¡æ¥ï¼åç°æ½å¨é®é¢åæ¹è¿å»ºè®®
license: MIT
compatibility: "gpt-4, claude-3"
allowed-tools: "read_file search_code"
metadata:
  author: token
  version: 1.0.0
---

ä½ æ¯ä¸ä¸ªä»£ç å®¡æ¥ä¸å®¶ãå½ç¨æ·è¯·æ±ä»£ç å®¡æ¥æ¶ï¼è¯·æä»¥ä¸æ­¥éª¤æ§è¡ï¼

1. åéè¯»ç®æ æä»¶ï¼çè§£æ´ä½ç»æ
2. æ£æ¥å¸¸è§é®é¢ï¼ç©ºæéãèµæºæ³æ¼ãå¹¶åå®å¨...
3. ç»åºå·ä½çæ¹è¿å»ºè®®ï¼éå¸¦ä»£ç ç¤ºä¾
</code></pre>
<p>frontmatter éç <code>name</code> å°±æ¯ Skill çå¯ä¸æ è¯ï¼åæ¶ä¹æ¯æä»¶å¤¹åï¼å¿é¡»æ¯ <code>kebab-case</code> æ ¼å¼ã<code>description</code> ä¼å±ç¤ºå¨å·¥å·åè¡¨éä¾ AI éæ©ãæ­£æé¨åï¼<code>---</code> ä¹åçåå®¹ï¼ææ¯çæ­£æ³¨å¥ç» AI ç promptã</p>
<h2 id="äºæ°æ®æ¨¡åskillconfig-å®ä½">äºãæ°æ®æ¨¡åï¼SkillConfig å®ä½</h2>
<p>Skill çåæ°æ®å­å¨æ°æ®åºéï¼å¯¹åºçå®ä½ç±»æ¯ <code>SkillConfig</code>ï¼</p>
<pre><code class="language-csharp">// src/OpenDeepWiki.Entities/Tools/SkillConfig.cs

public class SkillConfig : AggregateRoot&lt;string&gt;
{
    /// Skill åç§°ï¼å¯ä¸æ è¯ç¬¦ï¼åæ¶ä¹æ¯æä»¶å¤¹åï¼
    /// è§èï¼æå¤§64å­ç¬¦ï¼ä»å°åå­æ¯ãæ°å­åè¿å­ç¬¦
    [Required]
    [StringLength(64)]
    [RegularExpression(@"^[a-z0-9]+(-[a-z0-9]+)*$", 
        ErrorMessage = "åç§°åªè½åå«å°åå­æ¯ãæ°å­åè¿å­ç¬¦ï¼ä¸ä¸è½ä»¥è¿å­ç¬¦å¼å¤´æç»å°¾")]
    public string Name { get; set; } = string.Empty;

    [Required]
    [StringLength(1024)]
    public string Description { get; set; } = string.Empty;

    [StringLength(100)]
    public string? License { get; set; }

    [StringLength(500)]
    public string? Compatibility { get; set; }

    /// é¢æ¹åçå·¥å·åè¡¨ï¼ç©ºæ ¼åéï¼
    [StringLength(1000)]
    public string? AllowedTools { get; set; }

    /// Skill æä»¶å¤¹çç¸å¯¹è·¯å¾ï¼ç¸å¯¹äº skills æ ¹ç®å½ï¼
    [Required]
    [StringLength(200)]
    public string FolderPath { get; set; } = string.Empty;

    public bool IsActive { get; set; } = true;
    public int SortOrder { get; set; } = 0;
    public string? Author { get; set; }
    public new string Version { get; set; } = "1.0.0";
    public SkillSource Source { get; set; } = SkillSource.Local;
    public string? SourceUrl { get; set; }

    // æä»¶å¤¹ç»ææ è®°
    public bool HasScripts { get; set; }
    public bool HasReferences { get; set; }
    public bool HasAssets { get; set; }
    public long SkillMdSize { get; set; }
    public long TotalSize { get; set; }
}

public enum SkillSource
{
    Local = 0,       // æ¬å°ä¸ä¼ 
    Remote = 1,      // ä» URL å¯¼å¥
    Marketplace = 2  // ä»å¸åºå®è£
}
</code></pre>
<p>å ä¸ªå¼å¾æ³¨æçè®¾è®¡ç¹ï¼</p>
<ul>
<li><strong>Name çæ­£åæ ¡éª</strong>ï¼<code>^[a-z0-9]+(-[a-z0-9]+)*$</code>ï¼å¼ºå¶ kebab-caseï¼è·æä»¶å¤¹åä¿æä¸è´ï¼é¿åè·¯å¾é®é¢</li>
<li><strong>SkillSource æä¸¾</strong>ï¼é¢çäºä¸ç§æ¥æºï¼ç®åä¸»è¦ç¨ <code>Local</code>ï¼ä½æ¶æä¸å·²ç»ä¸ºè¿ç¨å¯¼å¥åå¸åºå®è£çäºå£å­</li>
<li><strong>HasScripts / HasReferences / HasAssets</strong>ï¼è®°å½æä»¶å¤¹ç»æï¼åç«¯å±ç¤ºè¯¦ææ¶ä¸ç¨åå»æ«ç£ç</li>
</ul>
<p>å¨ EF Core ç <code>MasterDbContext</code> éï¼<code>SkillConfig</code> æ³¨åäº Name å¯ä¸ç´¢å¼ï¼</p>
<pre><code class="language-csharp">// src/OpenDeepWiki.EFCore/MasterDbContext.cs

modelBuilder.Entity&lt;SkillConfig&gt;()
    .HasIndex(s =&gt; s.Name)
    .IsUnique();
</code></pre>
<h2 id="ä¸skill-çä¸ä¼ ä¸è§£æadmintoolsservice">ä¸ãSkill çä¸ä¼ ä¸è§£æï¼AdminToolsService</h2>
<p>Skill ççå½å¨æç®¡çå¨ <code>AdminToolsService</code> éï¼è¿æ¯æ´ä¸ªç³»ç»éæ"èæ´»ç´¯æ´»"éä¸­çå°æ¹ââè§£å ZIPãè§£æ YAMLãæ ¡éªæ ¼å¼ãåç£çãåæ°æ®åºï¼ä¸æ¡é¾ã</p>
<h3 id="31-ä¸ä¼ æµç¨">3.1 ä¸ä¼ æµç¨</h3>
<pre><code class="language-csharp">// src/OpenDeepWiki/Services/Admin/AdminToolsService.cs

public async Task&lt;SkillConfigDto&gt; UploadSkillAsync(Stream zipStream, string fileName)
{
    var tempDir = Path.Combine(Path.GetTempPath(), Guid.NewGuid().ToString());
    Directory.CreateDirectory(tempDir);
    try
    {
        // 1. è§£åå°ä¸´æ¶ç®å½
        using (var archive = new ZipArchive(zipStream, ZipArchiveMode.Read))
            archive.ExtractToDirectory(tempDir);

        // 2. æ¾å° SKILL.mdï¼æ¯ææ ¹ç®å½æä¸çº§å­ç®å½ï¼
        var skillMdPath = FindSkillMd(tempDir) 
            ?? throw new InvalidOperationException("åç¼©åä¸­æªæ¾å° SKILL.md");
        var skillRootDir = Path.GetDirectoryName(skillMdPath)!;

        // 3. è§£æ frontmatter
        var (frontmatter, _) = ParseSkillMd(await File.ReadAllTextAsync(skillMdPath));

        // 4. æ ¡éªå¿å¡«å­æ®µ
        if (!frontmatter.TryGetValue("name", out var nameObj) 
            || string.IsNullOrEmpty(nameObj?.ToString()))
            throw new InvalidOperationException("SKILL.md ç¼ºå° name å­æ®µ");

        var name = nameObj.ToString()!;
        if (!Regex.IsMatch(name, @"^[a-z0-9]+(-[a-z0-9]+)*$"))
            throw new InvalidOperationException("name æ ¼å¼æ æ");

        if (!frontmatter.TryGetValue("description", out var descObj) 
            || string.IsNullOrEmpty(descObj?.ToString()))
            throw new InvalidOperationException("SKILL.md ç¼ºå° description å­æ®µ");

        // 5. æ¥é
        if (await _context.SkillConfigs.AnyAsync(s =&gt; s.Name == name &amp;&amp; !s.IsDeleted))
            throw new InvalidOperationException($"å·²å­å¨åå Skill: {name}");

        // 6. ç§»å¨å°æ­£å¼ç®å½
        var targetPath = Path.Combine(_skillsBasePath, name);
        if (Directory.Exists(targetPath)) Directory.Delete(targetPath, true);
        Directory.Move(skillRootDir, targetPath);

        // 7. æå»ºå®ä½å¹¶å¥åº
        var config = new SkillConfig
        {
            Id = Guid.NewGuid().ToString(),
            Name = name,
            Description = descObj.ToString()!,
            License = frontmatter.TryGetValue("license", out var l) ? l?.ToString() : null,
            Compatibility = frontmatter.TryGetValue("compatibility", out var c) ? c?.ToString() : null,
            AllowedTools = frontmatter.TryGetValue("allowed-tools", out var t) ? t?.ToString() : null,
            FolderPath = name,
            IsActive = true,
            SortOrder = 0,
            Version = "1.0.0",
            Source = SkillSource.Local,
            HasScripts = Directory.Exists(Path.Combine(targetPath, "scripts")),
            HasReferences = Directory.Exists(Path.Combine(targetPath, "references")),
            HasAssets = Directory.Exists(Path.Combine(targetPath, "assets")),
            SkillMdSize = new FileInfo(Path.Combine(targetPath, "SKILL.md")).Length,
            TotalSize = CalculateDirectorySize(targetPath),
            CreatedAt = DateTime.UtcNow
        };

        _context.SkillConfigs.Add(config);
        await _context.SaveChangesAsync();
        // ... è¿å DTO
    }
    finally 
    { 
        if (Directory.Exists(tempDir)) 
            try { Directory.Delete(tempDir, true); } catch { } 
    }
}
</code></pre>
<p>è¿æ®µä»£ç çæµç¨å¾æ¸æ°ï¼è§£å â æ¾ SKILL.md â è§£æ YAML â æ ¡éª â æ¥é â è½ç â å¥åºãæå ä¸ªç»èå¼å¾è¯´è¯´ï¼</p>
<ol>
<li><strong>FindSkillMd æ¯æä¸¤çº§æ¥æ¾</strong>ï¼ZIP åé SKILL.md å¯è½å¨æ ¹ç®å½ï¼ä¹å¯è½å¨ä¸çº§å­ç®å½ä¸ï¼æ¯å¦ä½ æåçæ¶åå¤å¥äºä¸å±æä»¶å¤¹ï¼ï¼å®é½è½æ¾å°</li>
<li><strong>ä¸´æ¶ç®å½ç¨ GUID å½å</strong>ï¼é¿åå¹¶åä¸ä¼ å²çª</li>
<li><strong>finally ééé»å é¤ä¸´æ¶ç®å½</strong>ï¼<code>catch { }</code> åæå¼å¸¸ï¼å ä¸ºæ¸çå¤±è´¥ä¸åºè¯¥å½±åä¸»æµç¨</li>
</ol>
<h3 id="32-yaml-frontmatter-è§£æ">3.2 YAML Frontmatter è§£æ</h3>
<pre><code class="language-csharp">private static (Dictionary&lt;string, object?&gt; frontmatter, string body) ParseSkillMd(string content)
{
    var frontmatter = new Dictionary&lt;string, object?&gt;();
    var body = content;
    if (content.StartsWith("---"))
    {
        var endIndex = content.IndexOf("---", 3);
        if (endIndex &gt; 0)
        {
            var yamlContent = content[3..endIndex].Trim();
            body = content[(endIndex + 3)..].Trim();
            try
            {
                var deserializer = new DeserializerBuilder()
                    .WithNamingConvention(HyphenatedNamingConvention.Instance)
                    .Build();
                frontmatter = deserializer.Deserialize&lt;Dictionary&lt;string, object?&gt;&gt;(yamlContent) ?? new();
            }
            catch { }
        }
    }
    return (frontmatter, body);
}
</code></pre>
<p>ç¨çæ¯ YamlDotNet åºï¼<code>HyphenatedNamingConvention</code> å¯¹åº <code>kebab-case</code> ç key æ ¼å¼ï¼æ¯å¦ <code>allowed-tools</code>ï¼ãè§£æå¤±è´¥ç´æ¥åå¼å¸¸è¿åç©ºå­å¸ââè¿ä¸ªè®¾è®¡æç¹ç²æ´ï¼ä½èèå° frontmatter éå¤§é¨åå­æ®µé½æ¯å¯éçï¼ä¹è¯´å¾è¿å»ã</p>
<h3 id="33-ç£çæ«æå·æ°">3.3 ç£çæ«æå·æ°</h3>
<p>é¤äºä¸ä¼ ï¼è¿æä¸ä¸ª <code>RefreshSkillsFromDiskAsync</code> æ¹æ³ï¼ç¨æ¥æ«æ skills ç®å½ä¸çæä»¶å¤¹ï¼æè¿æ²¡å¥åºç Skill èªå¨æ³¨åè¿å»ï¼</p>
<pre><code class="language-csharp">public async Task RefreshSkillsFromDiskAsync()
{
    if (!Directory.Exists(_skillsBasePath)) return;

    var existingNames = (await _context.SkillConfigs
        .Where(s =&gt; !s.IsDeleted).ToListAsync())
        .Select(s =&gt; s.Name).ToHashSet();

    foreach (var dir in Directory.GetDirectories(_skillsBasePath))
    {
        var skillMdPath = Path.Combine(dir, "SKILL.md");
        if (!File.Exists(skillMdPath)) continue;

        var folderName = Path.GetFileName(dir);
        if (existingNames.Contains(folderName)) continue;

        try
        {
            var (frontmatter, _) = ParseSkillMd(await File.ReadAllTextAsync(skillMdPath));
            if (!frontmatter.TryGetValue("name", out var nameObj)) continue;
            var name = nameObj?.ToString();
            if (string.IsNullOrEmpty(name) || name != folderName) continue;
            // ... æå»º SkillConfig å¹¶å¥åº
        }
        catch (Exception ex) 
        { 
            _logger.LogWarning(ex, "è§£æå¤±è´¥: {Path}", dir); 
        }
    }
    await _context.SaveChangesAsync();
}
</code></pre>
<p>è¿ä¸ªæ¹æ³çä½¿ç¨åºæ¯æ¯ï¼ä½ ç´æ¥æ Skill æä»¶å¤¹ä¸¢å° skills ç®å½ä¸ï¼æ¯å¦éè¿ Docker volume æè½½ï¼ï¼ç¶åè°ä¸ä¸å·æ°æ¥å£ï¼ç³»ç»å°±è½è¯å«å°ãæ³¨æå®æä¸ªæ ¡éªï¼<strong>æä»¶å¤¹åå¿é¡»å SKILL.md éç name å­æ®µä¸è´</strong>ï¼ä¸ä¸è´çä¼è¢«è·³è¿ã</p>
<h2 id="åapi-ç«¯ç¹minimal-api-é£æ ¼">åãAPI ç«¯ç¹ï¼Minimal API é£æ ¼</h2>
<p>Skill çç®¡çæ¥å£å¨ <code>AdminToolsEndpoints</code> éï¼ç¨çæ¯ ASP.NET Core ç Minimal APIï¼</p>
<pre><code class="language-csharp">// src/OpenDeepWiki/Endpoints/Admin/AdminToolsEndpoints.cs

private static void MapSkillEndpoints(RouteGroupBuilder group)
{
    var skillGroup = group.MapGroup("/skills");

    // åè¡¨
    skillGroup.MapGet("/", async ([FromServices] IAdminToolsService toolsService) =&gt;
    {
        var result = await toolsService.GetSkillConfigsAsync();
        return Results.Ok(new { success = true, data = result });
    }).WithName("AdminGetSkills");

    // è¯¦æ
    skillGroup.MapGet("/{id}", async (string id, [FromServices] IAdminToolsService toolsService) =&gt;
    {
        var result = await toolsService.GetSkillDetailAsync(id);
        return result != null 
            ? Results.Ok(new { success = true, data = result })
            : Results.NotFound(new { success = false, message = "Skill ä¸å­å¨" });
    }).WithName("AdminGetSkillDetail");

    // ä¸ä¼ ï¼ZIPï¼
    skillGroup.MapPost("/upload", async (HttpRequest request, [FromServices] IAdminToolsService toolsService) =&gt;
    {
        // ... æ ¡éª Content-Typeãæä»¶æ ¼å¼
        using var stream = file.OpenReadStream();
        var result = await toolsService.UploadSkillAsync(stream, file.FileName);
        return Results.Ok(new { success = true, data = result });
    }).WithName("AdminUploadSkill").DisableAntiforgery();

    // æ´æ°ï¼ä»ç®¡çå­æ®µï¼IsActiveãSortOrderï¼
    skillGroup.MapPut("/{id}", ...);

    // å é¤ï¼åæ¶å é¤ç£çæä»¶ï¼
    skillGroup.MapDelete("/{id}", ...);

    // è¯»å Skill åé¨æä»¶ï¼å¸¦è·¯å¾ç©¿è¶é²æ¤ï¼
    skillGroup.MapGet("/{id}/files/{*filePath}", ...);

    // ä»ç£çå·æ°
    skillGroup.MapPost("/refresh", ...);
}
</code></pre>
<p>å¼å¾ä¸æçæ¯æä»¶è¯»åæ¥å£éçè·¯å¾ç©¿è¶é²æ¤ï¼</p>
<pre><code class="language-csharp">public async Task&lt;string?&gt; GetSkillFileContentAsync(string id, string filePath)
{
    var config = await _context.SkillConfigs.FirstOrDefaultAsync(s =&gt; s.Id == id &amp;&amp; !s.IsDeleted);
    if (config == null) return null;

    var normalizedPath = Path.GetFullPath(Path.Combine(_skillsBasePath, config.FolderPath, filePath));
    var skillBasePath = Path.GetFullPath(Path.Combine(_skillsBasePath, config.FolderPath));

    // å³é®ï¼ç¡®ä¿è§£æåçç»å¯¹è·¯å¾å¨ Skill ç®å½å
    if (!normalizedPath.StartsWith(skillBasePath)) 
        throw new UnauthorizedAccessException("éæ³è·¯å¾");

    return File.Exists(normalizedPath) ? await File.ReadAllTextAsync(normalizedPath) : null;
}
</code></pre>
<p>ç¨ <code>Path.GetFullPath</code> æ <code>../../etc/passwd</code> è¿ç±»è·¯å¾è§£ææç»å¯¹è·¯å¾ï¼ç¶åæ£æ¥æ¯å¦è¿å¨ Skill ç®å½èå´åãè¿æ¯æ åçè·¯å¾ç©¿è¶é²å¾¡ææ³ã</p>
<h2 id="äºæ ¸å¿è½¬æ¢å¨skilltoolconverter">äºãæ ¸å¿è½¬æ¢å¨ï¼SkillToolConverter</h2>
<p>å°è¿éï¼Skill å·²ç»å­å¨ç£çåæ°æ®åºéäºãä½ AI Agent å¹¶ä¸è®¤è¯ <code>SkillConfig</code>ï¼å®åªè®¤ <code>AITool</code>ã<code>SkillToolConverter</code> å°±æ¯åè¿ä¸ªæ¡¥æ¥çã</p>
<p>æ´ä¸ªè½¬æ¢å¨çè®¾è®¡æè·¯å¾å·§å¦ï¼<strong>ä¸æ¯ææ¯ä¸ª Skill åæä¸ä¸ªç¬ç«ç Toolï¼èæ¯æææ Skill åå¹¶æä¸ä¸ªå« <code>Skill</code> ç Tool</strong>ãè¿ä¸ª Tool ç description éååºäºææå¯ç¨ Skill çåç§°åæè¿°ï¼AI è°ç¨æ¶ä¼ å¥ Skill åç§°ï¼Tool å°±å»è¯»å¯¹åºç SKILL.md è¿å prompt åå®¹ã</p>
<pre><code class="language-csharp">// src/OpenDeepWiki/Services/Chat/SkillToolConverter.cs

public class SkillToolConverter : ISkillToolConverter
{
    private readonly IContext _context;
    private readonly ILogger&lt;SkillToolConverter&gt; _logger;
    private readonly string _skillsBasePath;

    public SkillToolConverter(
        IContext context,
        ILogger&lt;SkillToolConverter&gt; logger,
        IConfiguration configuration)
    {
        _context = context;
        _logger = logger;
        _skillsBasePath = configuration["Skills:BasePath"] 
            ?? Path.Combine(AppContext.BaseDirectory, "skills");
    }

    public async Task&lt;List&lt;AITool&gt;&gt; ConvertSkillConfigsToToolsAsync(
        List&lt;string&gt; skillIds,
        CancellationToken cancellationToken = default)
    {
        var tools = new List&lt;AITool&gt;();
        if (skillIds == null || skillIds.Count == 0) return tools;

        // ä»æ°æ®åºå è½½å¯ç¨ç Skill éç½®
        var skillConfigs = await _context.SkillConfigs
            .Where(s =&gt; skillIds.Contains(s.Id) &amp;&amp; s.IsActive &amp;&amp; !s.IsDeleted)
            .OrderBy(s =&gt; s.SortOrder)
            .ThenBy(s =&gt; s.Name)
            .ToListAsync(cancellationToken);

        if (skillConfigs.Count == 0) return tools;

        // åå»ºå¯ä¸ç LoadSkills å·¥å·
        var loadSkillsTool = CreateLoadSkillsTool(skillConfigs);
        tools.Add(loadSkillsTool);

        _logger.LogInformation(
            "Created LoadSkills tool with {Count} available skills", 
            skillConfigs.Count);

        return tools;
    }
    // ...
}
</code></pre>
<h3 id="51-æå»º-tool-æè¿°">5.1 æå»º Tool æè¿°</h3>
<p><code>CreateLoadSkillsTool</code> æ¯æå³é®çæ¹æ³ãå®åäºä¸¤ä»¶äºï¼æå»ºä¸ä¸ªåå« Skill ç®å½ç descriptionï¼ä»¥åå®ä¹è°ç¨æ¶çå¤çé»è¾ã</p>
<pre><code class="language-csharp">private AITool CreateLoadSkillsTool(List&lt;SkillConfig&gt; skillConfigs)
{
    // æå»ºæ¥æ¾è¡¨
    var skillLookup = skillConfigs.ToDictionary(
        s =&gt; s.Name, s =&gt; s, StringComparer.OrdinalIgnoreCase);

    // å®ä¹å®éçå¤çå½æ°
    var loadSkillAsync = async (
        [Description("The name of the skill to load (select from available skills listed in this tool's description)")] string name,
        CancellationToken cancellationToken) =&gt;
    {
        return await LoadSkillInternalAsync(name, skillLookup);
    };

    // æå»º descriptionï¼åå«ææå¯ç¨ Skill çç®å½
    var description = new StringBuilder();
    description.AppendLine("""
Execute a skill within the main conversation
&lt;skills_instructions&gt;
When users ask you to perform tasks, check if any of the available skills
below can help complete the task more effectively. Skills provide specialized
capabilities and domain knowledge.
How to use skills:
- Invoke skills using this tool with the skill name only (no arguments)
- When you invoke a skill, you will see &lt;command-message&gt;The "{name}" skill is loading&lt;/command-message&gt;
- The skill's prompt will expand and provide detailed instructions on how to complete the task
- Examples:
  - `skill: "pdf"` - invoke the pdf skill
  - `skill: "xlsx"` - invoke the xlsx skill
  - `skill: "ms-office-suite:pdf"` - invoke using fully qualified name

Important:
    - Only use skills listed in &lt;available_skills&gt; below
    - Do not invoke a skill that is already running
    - Do not use this tool for built-in CLI commands (like /help, /clear, etc.)
&lt;/skills_instructions&gt;

&lt;available_skills&gt;
""");

    foreach (var skill in skillConfigs)
    {
        description.AppendLine($"- name: {skill.Name} - {skill.Description}");
    }
    description.Append("&lt;/available_skills&gt;");

    // ç¨ AIFunctionFactory åå»º Tool
    return AIFunctionFactory.Create(
        loadSkillAsync,
        new AIFunctionFactoryOptions
        {
            Name = "Skill",
            Description = description.ToString()
        });
}
</code></pre>
<p>è¿æ®µä»£ç çç²¾é«å¨äº description çæé æ¹å¼ãå®ç¨ XML æ ç­¾ï¼<code>&lt;skills_instructions&gt;</code> å <code>&lt;available_skills&gt;</code>ï¼æ¥ç»æåæè¿°ä¿¡æ¯ï¼è¿æ · AI æ¨¡åè½æ´åç¡®å°çè§£å·¥å·çç¨éåå¯éåæ°ãæ¯ä¸ª Skill ç name å description é½åå¨éé¢ï¼AI çå°ç¨æ·çè¯·æ±åï¼ä¼èªä¸»å¤æ­è¦ä¸è¦è°ç¨æä¸ª Skillã</p>
<h3 id="52-è¿è¡æ¶å è½½-skill-prompt">5.2 è¿è¡æ¶å è½½ Skill Prompt</h3>
<p>å½ AI å³å®è°ç¨ <code>Skill</code> å·¥å·æ¶ï¼<code>LoadSkillInternalAsync</code> è´è´£è¯»å SKILL.md å¹¶è¿å prompt æ­£æï¼</p>
<pre><code class="language-csharp">private async Task&lt;string&gt; LoadSkillInternalAsync(
    string name,
    Dictionary&lt;string, SkillConfig&gt; skillLookup)
{
    if (string.IsNullOrWhiteSpace(name))
    {
        return JsonSerializer.Serialize(new { error = true, message = "Skill name cannot be empty." });
    }

    if (!skillLookup.TryGetValue(name, out var skill))
    {
        var availableNames = string.Join(", ", skillLookup.Keys);
        return JsonSerializer.Serialize(new
        {
            error = true,
            message = $"Skill '{name}' not found. Available skills: {availableNames}"
        });
    }

    var skillMdPath = Path.Combine(_skillsBasePath, skill.FolderPath, "SKILL.md");
    if (!File.Exists(skillMdPath))
    {
        return JsonSerializer.Serialize(new { error = true, message = $"SKILL.md not found for skill '{name}'." });
    }

    try
    {
        var content = await File.ReadAllTextAsync(skillMdPath);
        // å»æ YAML frontmatterï¼åªè¿å prompt æ­£æ
        var prompts = ExtractPromptsBody(content);
        return prompts;
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "Failed to load SKILL.md for skill: {Name}", name);
        return JsonSerializer.Serialize(new { error = true, message = $"Failed to load skill: {ex.Message}" });
    }
}

private static string ExtractPromptsBody(string content)
{
    if (!content.StartsWith("---")) return content;

    var endIndex = content.IndexOf("---", 3);
    if (endIndex &lt; 0) return content;

    return content[(endIndex + 3)..].Trim();
}
</code></pre>
<p>æ³¨æéè¯¯å¤ççæ¹å¼ï¼ä¸æ¯æå¼å¸¸ï¼èæ¯è¿å JSON æ ¼å¼çéè¯¯ä¿¡æ¯ãå ä¸ºè¿ä¸ªè¿åå¼ä¼ç´æ¥ä½ä¸º Tool çè¾åºä¼ åç» AIï¼AI è½çè§£è¿ä¸ªéè¯¯å¹¶ååºç¸åºååºï¼æ¯å¦æ¢ä¸ä¸ª Skill è¯è¯ï¼æèåè¯ç¨æ· Skill ä¸å­å¨ï¼ã</p>
<h2 id="å­å·¥å·æ³¨å¥ä¸¤æ¡æ¶è´¹è·¯å¾">å­ãå·¥å·æ³¨å¥ï¼ä¸¤æ¡æ¶è´¹è·¯å¾</h2>
<p><code>SkillToolConverter</code> äº§åºç <code>AITool</code> ä¼è¢«æ³¨å¥å°ä¸¤ä¸ªå°æ¹ï¼<strong>Chat å¯¹è¯å©æ</strong>å <strong>Wiki çæå¨</strong>ã</p>
<h3 id="61-chat-å¯¹è¯å©æ">6.1 Chat å¯¹è¯å©æ</h3>
<p>å¨ <code>ChatAssistantService.StreamChatAsync</code> éï¼Skill å·¥å·åå¶ä»å·¥å·ï¼Git å·¥å·ãææ¡£éè¯»å·¥å·ãMCP å·¥å·ï¼ä¸èµ·è¢«ç»è£ï¼</p>
<pre><code class="language-csharp">// src/OpenDeepWiki/Services/Chat/ChatAssistantService.cs

public async IAsyncEnumerable&lt;SSEEvent&gt; StreamChatAsync(
    ChatRequest request,
    CancellationToken cancellationToken = default)
{
    var config = await GetConfigAsync(cancellationToken);
    // ... æ ¡éªéç½®åæ¨¡å

    var tools = new List&lt;AITool&gt;();

    // 1. Git å·¥å·ï¼è¯»æä»¶ãæç´¢ä»£ç ç­ï¼
    if (Directory.Exists(repositoryPath))
    {
        var gitTool = new GitTool(repositoryPath);
        tools.AddRange(gitTool.GetTools());
    }

    // 2. ææ¡£éè¯»å·¥å·
    var chatDocReaderTool = await ChatDocReaderTool.CreateAsync(
        _context, request.Context.Owner, request.Context.Repo,
        request.Context.Branch, request.Context.Language, cancellationToken);
    tools.Add(chatDocReaderTool.GetTool());

    // 3. MCP å·¥å·
    if (config.EnabledMcpIds.Count &gt; 0)
    {
        var mcpTools = await _mcpToolConverter.ConvertMcpConfigsToToolsAsync(
            config.EnabledMcpIds, cancellationToken);
        tools.AddRange(mcpTools);
    }

    // 4. Skill å·¥å· â å°±æ¯è¿é
    if (config.EnabledSkillIds.Count &gt; 0)
    {
        var skillTools = await _skillToolConverter.ConvertSkillConfigsToToolsAsync(
            config.EnabledSkillIds, cancellationToken);
        tools.AddRange(skillTools);
    }

    // 5. åå»º Agent å¹¶å¼å§æµå¼å¯¹è¯
    var agentOptions = new ChatClientAgentOptions
    {
        ChatOptions = new ChatOptions
        {
            Tools = tools.ToArray(),
            ToolMode = ChatToolMode.Auto,
            MaxOutputTokens = 32000
        }
    };

    var (agent, _) = _agentFactory.CreateChatClientWithTools(
        modelConfig.ModelId, tools.ToArray(), agentOptions, requestOptions);

    // ... æµå¼è¾åº
}
</code></pre>
<p><code>config.EnabledSkillIds</code> æ¥èª <code>ChatAssistantConfig</code> è¡¨ï¼ç®¡çåå¨åå°éç½®åªäº Skill å¯¹å¯¹è¯å©æå¯ç¨ã</p>
<h3 id="62-wiki-çæå¨">6.2 Wiki çæå¨</h3>
<p>å¨ <code>WikiGenerator</code> éï¼Skill å·¥å·çæ³¨å¥æ¹å¼ç¥æä¸åââå®ä¸ä¾èµ ChatAssistantConfigï¼èæ¯ç´æ¥æ¥ææå¯ç¨ç Skillï¼</p>
<pre><code class="language-csharp">// src/OpenDeepWiki/Services/Wiki/WikiGenerator.cs

private async Task&lt;AITool[]&gt; BuildToolsAsync(
    IEnumerable&lt;AITool&gt; baseTools,
    CancellationToken cancellationToken)
{
    var tools = baseTools.ToList();

    var enabledSkillIds = await GetEnabledSkillIdsAsync(cancellationToken);
    if (enabledSkillIds.Count == 0) return tools.ToArray();

    try
    {
        var skillTools = await _skillToolConverter.ConvertSkillConfigsToToolsAsync(
            enabledSkillIds, cancellationToken);

        if (skillTools.Count &gt; 0)
        {
            tools.AddRange(skillTools);
            _logger.LogDebug("Added {SkillCount} skill tools to wiki generator", skillTools.Count);
        }
    }
    catch (Exception ex)
    {
        _logger.LogWarning(ex, "Failed to load skill tools for wiki generator");
    }

    return tools.ToArray();
}

private async Task&lt;List&lt;string&gt;&gt; GetEnabledSkillIdsAsync(CancellationToken cancellationToken)
{
    using var context = _contextFactory.CreateContext();
    return await context.SkillConfigs
        .Where(s =&gt; s.IsActive &amp;&amp; !s.IsDeleted)
        .OrderBy(s =&gt; s.SortOrder)
        .ThenBy(s =&gt; s.Name)
        .Select(s =&gt; s.Id)
        .ToListAsync(cancellationToken);
}
</code></pre>
<p>Wiki çæå¨éæä¸ª <code>try-catch</code> åè£¹ Skill å è½½é»è¾ï¼Skill å è½½å¤±è´¥ä¸ä¼é»æ­ Wiki çææµç¨ãè¿æ¯ä¸ªä¸éçå®¹éè®¾è®¡ââSkill æ¯é¦ä¸æ·»è±çä¸è¥¿ï¼ä¸åºè¯¥å ä¸ºå®åºé®é¢å°±ææ ¸å¿åè½ææã</p>
<h2 id="ä¸agent-å·¥åæåä¸å¬é">ä¸ãAgent å·¥åï¼æåä¸å¬é</h2>
<p>ææå·¥å·æç»é½è¦éè¿ <code>AgentFactory</code> æ³¨å¥å° AI Agent éã<code>AgentFactory</code> æ¯æä¸ç§åç«¯ï¼OpenAI ChatãOpenAI ResponsesãAnthropicã</p>
<pre><code class="language-csharp">// src/OpenDeepWiki/Agents/AgentFactory.cs

public (ChatClientAgent Agent, IList&lt;AITool&gt; Tools) CreateChatClientWithTools(
    string model,
    AITool[] tools,
    ChatClientAgentOptions clientAgentOptions,
    AiRequestOptions? requestOptions = null)
{
    var option = ResolveOptions(requestOptions ?? _options, true);

    clientAgentOptions.ChatOptions ??= new ChatOptions();
    clientAgentOptions.ChatOptions.Tools = tools;
    clientAgentOptions.ChatOptions.ToolMode = ChatToolMode.Auto;

    var agent = CreateAgentInternal(model, clientAgentOptions, option);
    return (agent, tools);
}

public static ChatClientAgent CreateAgentInternal(
    string model,
    ChatClientAgentOptions clientAgentOptions,
    AiRequestOptions options)
{
    // åè§£æéç½®ï¼åå¹¶ä¼ å¥åæ°ãç¯å¢åéãé»è®¤å¼
    var option = ResolveOptions(options, true);
    var httpClient = CreateHttpClient();

    if (option.RequestType == AiRequestType.OpenAI)
    {
        var clientOptions = new OpenAIClientOptions()
        {
            Endpoint = new Uri(option.Endpoint ?? DefaultEndpoint),
            // æ³¨æï¼OpenAI åæ¯åæ ·æ³¨å¥äºèªå®ä¹ HttpClientï¼ç¨äºæ¥å¿æ¦æªç­ï¼
            Transport = new HttpClientPipelineTransport(httpClient)
        };
        var openAiClient = new OpenAIClient(
            new ApiKeyCredential(option.ApiKey ?? string.Empty), clientOptions);
        return openAiClient.GetChatClient(model).AsAIAgent(clientAgentOptions);
    }
    else if (option.RequestType == AiRequestType.OpenAIResponses)
    {
        // Responses åæ¯ç»æä¸ Chat åæ¯ç±»ä¼¼ï¼ä½èµ° GetResponsesClient
        var clientOptions = new OpenAIClientOptions()
        {
            Endpoint = new Uri(option.Endpoint ?? DefaultEndpoint),
            Transport = new HttpClientPipelineTransport(httpClient)
        };
        var openAiClient = new OpenAIClient(
            new ApiKeyCredential(option.ApiKey ?? string.Empty), clientOptions);
        return openAiClient.GetResponsesClient(model).AsAIAgent(clientAgentOptions);
    }
    else if (option.RequestType == AiRequestType.Anthropic)
    {
        AnthropicClient client = new()
        {
            BaseUrl = option.Endpoint ?? DefaultEndpoint,
            ApiKey = option.ApiKey,
            HttpClient = httpClient,
        };
        clientAgentOptions.ChatOptions.ModelId = model;
        return client.AsAIAgent(clientAgentOptions);
    }

    throw new NotSupportedException("Unknown AI request type.");
}
</code></pre>
<p>å ä¸ªè¦ç¹ï¼</p>
<ul>
<li><code>ResolveOptions</code> ä¼ä¾æ¬¡ä»ä¼ å¥åæ°ãç¯å¢åéï¼<code>CHAT_API_KEY</code>ã<code>ENDPOINT</code>ã<code>CHAT_REQUEST_TYPE</code>ï¼ãé»è®¤å¼ä¸­è§£æéç½®ï¼ä¿è¯å³ä½¿è°ç¨æ¹æ²¡ä¼ å®æ´åæ°ä¹è½æ­£å¸¸å·¥ä½</li>
<li>ä¸ä¸ªåæ¯é½éè¿èªå®ä¹ <code>HttpClient</code> æ³¨å¥äº <code>LoggingHttpHandler</code>ï¼ç¨äºè¯·æ±æ¥å¿æ¦æªï¼ä¸åªæ¯ Anthropic åæ¯éè¦</li>
<li><code>ChatToolMode.Auto</code> æå³ç AI èªå·±å³å®ä»ä¹æ¶åè°ç¨å·¥å·ãSkill å·¥å·ç description éå·²ç»åæ¸æ¥äºä½¿ç¨åºæ¯ï¼AI ä¼æ ¹æ®ç¨æ·çè¯·æ±èªå¨å¤æ­æ¯å¦éè¦å è½½æä¸ª Skill</li>
</ul>
<h2 id="å«å®æ´è°ç¨é¾è·¯æ»ç»">å«ãå®æ´è°ç¨é¾è·¯æ»ç»</h2>
<p>æä¸é¢çåå®¹ä¸²èµ·æ¥ï¼ä¸æ¬¡ Skill è°ç¨çå®æ´é¾è·¯æ¯è¿æ ·çï¼</p>
<pre><code>ç¨æ·ä¸ä¼  ZIP
    â
AdminToolsService.UploadSkillAsync()
    â è§£å â è§£æ SKILL.md â æ ¡éª â åç£ç â åæ°æ®åº
    â
âââââââââââââââââââââââââââââââââââââââââââââââââââââââ
â  è·¯å¾ Aï¼Chat å¯¹è¯å©æ                                â
â  ç®¡çåå¨åå°éç½® ChatAssistantConfig.EnabledSkillIds  â
â  â åªæè¢«æ¾å¼éä¸­ç Skill æä¼æ³¨å¥                     â
âââââââââââââââââââââââââââââââââââââââââââââââââââââââ¤
â  è·¯å¾ Bï¼Wiki çæå¨                                   â
â  ç´æ¥æ¥è¯¢ææ IsActive &amp;&amp; !IsDeleted ç Skill          â
â  â ä¸ä¾èµ ChatAssistantConfigï¼ææå¯ç¨ç Skill é½åä¸ â
âââââââââââââââââââââââââââââââââââââââââââââââââââââââ
    â
SkillToolConverter.ConvertSkillConfigsToToolsAsync()
    â ä»æ°æ®åºå è½½ SkillConfig
    â æå»º "Skill" AIToolï¼description å«ææ Skill ç®å½ï¼
    â
AgentFactory.CreateChatClientWithTools()
    â ResolveOptions() åå¹¶éç½®
    â åå»º ChatClientAgentï¼OpenAI / OpenAIResponses / Anthropicï¼
    â Tools æ³¨å¥å° ChatOptions
    â
AI Agent è¿è¡
    â AI æ ¹æ®ç¨æ·è¯·æ±å¤æ­æ¯å¦éè¦è°ç¨ Skill
    â è°ç¨ Skill("code-review")
    â LoadSkillInternalAsync() è¯»å SKILL.md æ­£æ
    â è¿å prompt åå®¹ç» AI
    â AI æç§ prompt æä»¤æ§è¡ä»»å¡
</code></pre>
<h2 id="ä¹ä¸äºä¸ªäººæè">ä¹ãä¸äºä¸ªäººæè</h2>
<p>è¯»å®è¿å¥ä»£ç ï¼æå ä¸ªå°æ¹è§å¾è®¾è®¡å¾ä¸éï¼</p>
<ol>
<li>
<p><strong>å Tool èåè®¾è®¡</strong>ï¼æ²¡æç»æ¯ä¸ª Skill åå»ºç¬ç«ç Toolï¼èæ¯ç¨ä¸ä¸ª <code>Skill</code> Tool åå¥å£ï¼éè¿ description ååºç®å½ãè¿æ ·ä¸ç®¡æå¤å°ä¸ª Skillï¼åªå ç¨ä¸ä¸ª Tool æ§½ä½ï¼é¿åäº Tool æ°éçç¸çé®é¢ï¼å¾å¤æ¨¡åå¯¹ Tool æ°éæéå¶ï¼ã</p>
</li>
<li>
<p><strong>Prompt å»¶è¿å è½½</strong>ï¼Skill ç prompt ä¸æ¯å¨æå»º Tool æ¶å°±å¨é¨å è½½å° description éï¼èæ¯ AI è°ç¨æ¶æå»è¯»æä»¶ãè¿æ · description ä¿æç²¾ç®ï¼ä¸ä¼å ä¸º Skill å¤ªå¤å¯¼è´ context è¨èã</p>
</li>
<li>
<p><strong>ç£ç + æ°æ®åºåå­å¨</strong>ï¼æä»¶åå®¹å­ç£çï¼æ¹ä¾¿ç´æ¥ç¼è¾å volume æè½½ï¼ï¼åæ°æ®å­æ°æ®åºï¼æ¹ä¾¿æ¥è¯¢åç®¡çï¼ãä¸¤èéè¿ <code>FolderPath</code> å³èã</p>
</li>
<li>
<p><strong>å®¹ééç¦»</strong>ï¼WikiGenerator é Skill å è½½å¤±è´¥ä¸å½±åä¸»æµç¨ï¼ChatAssistantService é Skill æ¯å¯éçæ©å±è½åã</p>
</li>
</ol>
<p>ä¹æä¸äºå¯ä»¥æ¹è¿çå°æ¹ï¼</p>
<ul>
<li><code>ParseSkillMd</code> é YAML è§£æå¤±è´¥ç´æ¥åå¼å¸¸ï¼ä¸ä¼ æ¶è¿å¥½ï¼åé¢ææ ¡éªï¼ï¼ä½ <code>RefreshSkillsFromDiskAsync</code> éå¦æ YAML æ ¼å¼æé®é¢ï¼ç¨æ·å®å¨ä¸ç¥éä¸ºä»ä¹ Skill æ²¡è¢«è¯å«å°</li>
<li><code>SkillToolConverter</code> æ¯æ¬¡è°ç¨é½ä¼æ¥æ°æ®åºï¼å¦æ Skill åè¡¨ä¸å¸¸ååï¼å ä¸ªç¼å­ä¼æ´å¥½</li>
<li><code>AllowedTools</code> å­æ®µç®ååªæ¯å­äºä¸æ¥ï¼å¹¶æ²¡æå¨è¿è¡æ¶åä»»ä½æéæ§å¶</li>
</ul>
<p>æ»çæ¥è¯´ï¼è¿å¥ Skill æºå¶çè®¾è®¡æè·¯å¾æ¸æ°ï¼<strong>ç¨æä»¶ç³»ç»åå­å¨ï¼ç¨æ°æ®åºåç´¢å¼ï¼ç¨ Tool description ååç°ï¼ç¨å»¶è¿å è½½åæ³¨å¥</strong>ãå¦æä½ ä¹å¨åç±»ä¼¼ç AI Agent æ©å±ç³»ç»ï¼è¿ä¸ªå®ç°å¯ä»¥ä½ä¸ºä¸ä¸ªä¸éçåèã</p>
<hr>
<p><em>å¦æè¿ç¯æç« å¯¹ä½ æå¸®å©ï¼æ¬¢è¿ star <a href="https://github.com/AIDotNet/OpenDeepWiki" target="_blank" rel="noopener nofollow">OpenDeepWiki</a> é¡¹ç®ã</em></p>


</div>
<div class="clear"></div>

        <div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-10 10:15">2026-02-10 10:15</span>&nbsp;
<a href="https://www.cnblogs.com/token-ai">239573049</a>&nbsp;
éè¯»(<span id="post_view_count">37</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19598343);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19598343', targetLink: 'https://www.cnblogs.com/token-ai/p/19598343', title: 'æè§£ OpenDeepWiki ç Agent Skills æºå¶ï¼ä» SKILL.md å° AI å·¥å·è°ç¨çå®æ´é¾è·¯' })">ä¸¾æ¥</a>
</div>
     ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä»æ¨¡åè¯ä¼°ãæ¢¯åº¦é¾é¢å°ç§å­¦åå§åï¼ä¸æ­¥æ­¥è§£ææ·±åº¦å­¦ä¹ çè®­ç»é®é¢ ]]></title>
    <link>https://www.cnblogs.com/yldeveloper/p/19597056</link>
    <guid>18b529031b00aa9bb50e0e386b40ab79</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yldeveloper/p/19597056" title="åå¸äº 2026-02-09 21:47">
    <span role="heading" aria-level="2">ä»æ¨¡åè¯ä¼°ãæ¢¯åº¦é¾é¢å°ç§å­¦åå§åï¼ä¸æ­¥æ­¥è§£ææ·±åº¦å­¦ä¹ çè®­ç»é®é¢</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        è¦è§£å³æ¨¡åæ³åè½åä¸è®­ç»ç¨³å®æ§ä¸¤å¤§é¾é¢ï¼å³é®å¨äºçè§£åå·®-æ¹å·®æè¡¡ãæ¢¯åº¦ä¼ æ­ååæ°åå§åä¸èé´çæ·±å±èç³»ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å¼è¨">å¼è¨</h2>
<p>è®­ç»ä¸ä¸ªç¥ç»ç½ç»è¿ç¨ä¸­ï¼æä»¬ä¼å³æ³¨ä¸¤ä¸ªé®é¢ï¼</p>
<ol>
<li>æ¨¡åè½å¦æ¯«ä¸è´¹åå¤çåºç¨ç¯å¢ä¸­æ²¡è§è¿çæ°æ®ï¼</li>
<li>æ¨¡åè½å¦è¢«ææè®­ç»ï¼</li>
</ol>
<p>ç¬¬ä¸ä¸ªé®é¢æ¶å<strong>åå·®ä¸æ¹å·®çæè¡¡</strong>ï¼ç¬¬äºä¸ªé®é¢æ¶å<strong>æ¢¯åº¦ä¼ æ­çç¨³å®æ§</strong>ãæ¬æé¦åæ¢è®¨åå·®ä¸æ¹å·®ï¼ç¶ååææ¢¯åº¦é®é¢ï¼æåå¼åºè§£å³æ¢¯åº¦é®é¢çå³é®ä¹ä¸ââ<strong>ç§å­¦çåå§åæ¹æ³</strong>ã</p>
<h2 id="åå·®--æ¹å·®">åå·® &amp; æ¹å·®</h2>
<p>è¦çè§£æ¨¡åçæ³åè½åï¼æä»¬é¦åè¦éåå®çâæ³åè¯¯å·®âï¼å³æ¨¡åå¨æªç¥æ°æ®ä¸çè¡¨ç°ãç¶èï¼æ³åè¯¯å·®å¹¶éä¸ä¸ªåä¸çé®é¢ï¼å®æºäºä¸ç§ä¸åæ§è´¨çéè¯¯ï¼æ¨¡ååºæçè¿ä¼¼è½åä¸è¶³ãå¯¹è®­ç»æ°æ®çè¿åº¦ææãæ¨¡åæ°æ®æ¬èº«çä¸å¯çº¦åªå£°ã</p>
<h4 id="åå·®---æ¹å·®åè§£å¬å¼">åå·® - æ¹å·®åè§£å¬å¼</h4>
<p>è§å®ï¼</p>
<ul>
<li><span class="math inline">\(P_{\text{data}}(x,y)\)</span>ï¼æ°æ®çæåå¸</li>
<li><span class="math inline">\(\mathcal{D}\)</span>ï¼ä»<span class="math inline">\(P_{\text{data}}\)</span>ä¸­ç¬ç«ååå¸éæ ·å¾å°çè®­ç»æ°æ®é</li>
<li><span class="math inline">\(f(x;\mathcal{D})\)</span>ï¼ç±è®­ç»é <span class="math inline">\(\mathcal{D}\)</span> å­¦å¾çæ¨¡å <span class="math inline">\(f\)</span> å¯¹ <span class="math inline">\(x\)</span> çé¢æµè¾åºã</li>
<li><span class="math inline">\(\overline f(x)\)</span>ï¼<span class="math inline">\(\mathbb{E}_{\mathcal{D} \sim P_{\text{data}}^{\otimes n}}[f(x; \mathcal{D})]\)</span>ï¼å¯¹ææå¯è½è®­ç»éçææ</li>
<li><span class="math inline">\(\mathbb{E}_{\mathcal{D} \sim P_{\text{data}}^{\otimes n}}[\cdot]\)</span>ï¼å¯¹è®­ç»ééæ ·çææ</li>
</ul>
<p>æï¼</p>
<p></p><div class="math display">\[\mathbb{E}_{y|x} \mathbb{E}_{\mathcal{D}}[(f(x; \mathcal{D}) - y)^2] = \text{Bias}^2(f(x)) + \text{Var}(f(x)) + \sigma_\epsilon^2
\]</div><p></p><p>å¶ä¸­ï¼</p>
<ul>
<li><span class="math inline">\(\text{Bias}^2(f(x))\)</span>ï¼åå·®ï¼åæ æ¨¡åæåè½åãè®¾çå®å½æ°ä¸º <span class="math inline">\(h(x) = \mathbb{E}[y|x]\)</span>ï¼æ¡ä»¶ææï¼ï¼ååå·®åºå®ä¹ä¸º <span class="math inline">\((\overline f(x) - h(x))^2\)</span></li>
<li><span class="math inline">\(\text{Var}(f(x))\)</span>ï¼æ¹å·®ï¼åæ ä¸åæ°æ®éè¡¨ç°æ³¢å¨æåµå³æ³åè½åï¼<span class="math inline">\(:=\mathbb{E}_\mathcal{D}[(f(x;\mathcal{D})-\overline f(x))^2]\)</span></li>
<li><span class="math inline">\(\sigma_\epsilon ^2\)</span>ï¼åªå£°ï¼åæ å­¦ä¹ é¾åº¦ï¼<span class="math inline">\(:=\mathbb{E}[(y - h(x))^2]\)</span></li>
</ul>
<p>è¿éæ­£å¥½å¯¹åºä¸¤ç§æ¨¡åï¼çº¿æ§æå vs. ç¥ç»ç½ç»</p>
<ul>
<li>è¥çº¿æ§æåï¼æ¨¡åå®¹éä½ï¼å¹¶ä¸åè®¾ç©ºé´ç®åï¼å³å¤§åå·®å°æ¹å·®ï¼æ³åè¯¯å·®å¤§ï¼æ¬ æåã</li>
<li>è¥å¤æåº¦è¿é«çç¥ç»ç½ç»ï¼å¦æªæ­£ååï¼ï¼ä¼å­¦å°è®­ç»æ°æ®ä¸­çåªå£°ï¼å¯¼è´å¨è®­ç»æ°æ®ä¸è¡¨ç°å¾å¥½ï¼å°åå·®ï¼ï¼ä½å¨æªè§è¿çæ°æ®ä¸è¡¨ç°æ³¢å¨å¾å¤§ï¼å¤§æ¹å·®ï¼ï¼æ³åè¯¯å·®å¤§ï¼è¿æåã</li>
<li>è¥å¤æåº¦éä¸­çç¥ç»ç½ç»ï¼ä¸­ç­åå·®ä¸­ç­æ¹å·®ï¼æ³åè¯¯å·®å°ï¼æä½³äºã</li>
</ul>
<p>å¾åºç»è®ºï¼<em>åå·®å¤§ï¼æ¬ æåï¼æå³çæ¨¡åè½åä¸è¶³ï¼æªè½æææ°æ®ä¸­ççå®æ¨¡å¼ï¼æ¹å·®å¤§ï¼è¿æåï¼æå³çæ¨¡åè¿äºå¤æï¼å¯¹è®­ç»æ°æ®ä¸­çåªå£°åéæºæ³¢å¨è¿åº¦ææã</em></p>
<h4 id="å½±ååå·®ä¸æ¹å·®çä¸å¤§å ç´ ">å½±ååå·®ä¸æ¹å·®çä¸å¤§å ç´ </h4>
<p><strong>1. å­¦ä¹ ç®æ³è½åï¼æ¨¡åå¤æåº¦ï¼</strong></p>
<p>å¦ææ¨¡åæ¬ æåï¼åå·®å¤§ï¼ï¼å°±æ¢æ´å¤æçæ¨¡åï¼å¦æè¿æåï¼æ¹å·®å¤§ï¼ï¼å°±æ¢æ´ç®åçæ¨¡åï¼æå¯¹å¤ææ¨¡ååæ­£ååï¼ã</p>
<p><strong>2. è®­ç»æ°æ®é</strong></p>
<p>å¯é´æ¥éä½åå·®ï¼å¯¹æ¹å·®å½±åå¤§<br>
å¦ææ¨¡åè¿æåï¼æ¹å·®å¤§ï¼ï¼ä¼åå¢å è®­ç»æ°æ®ã</p>
<p><strong>3. å­¦ä¹ ä»»å¡æ¬èº«çé¾åº¦ï¼ä»»å¡å¤æåº¦ï¼</strong></p>
<p>å¦æä»»å¡ç®åä½æ¹å·®å¤§ï¼å°±æ§å¶æ¨¡åå¤æåº¦æå¢å æ°æ®ï¼å¦æä»»å¡å¤æå¯¼è´åå·®å¤§ï¼å°±æåæ¨¡åå¤æåº¦</p>
<h4 id="å¤çæ¨¡åé«åå·®é«æ¹å·®çä¸äºæ¹æ³">å¤çæ¨¡åé«åå·®ãé«æ¹å·®çä¸äºæ¹æ³</h4>
<p><strong>æ¬ æåï¼é«åå·®ï¼</strong>ï¼åºè¯¥æ¢æ´å¤æçæ¨¡åãå¢å ç¹å¾ç»´æ°ãä»ç»å¤æ­è®­ç»è¯¯å·®æ¯å¦æ¶æå°æä½ã</p>
<p><strong>è¿æåï¼é«æ¹å·®ï¼</strong>ï¼åºè¯¥å¢å è®­ç»æ°æ®ãæ­£ååï¼å¦ä½¿ç¨L1æ­£ååãL2æ­£ååï¼å³æéè¡°åï¼ãDropoutç­ï¼ãæ¹éå½ä¸åãåªæéå¤æåº¦ãéä½ç¹å¾ç»´åº¦ã</p>
<h4 id="åå·®-æ¹å·®æè¡¡">åå·®-æ¹å·®æè¡¡</h4>
<p>åå·®ä¸æ¹å·®éå¸¸æ¯å¯¹ç«çï¼æé«æ¨¡åå¤æåº¦å¯ä»¥åå°åå·®ï¼ä½å¯è½å¢å æ¹å·®ï¼åä¹ï¼éä½æ¨¡åå¤æåº¦å¯ä»¥åå°æ¹å·®ï¼ä½åå·®å¯è½ä¼åé«ãè¿ç§æè¡¡å³ç³»è¢«ç§°ä¸º <strong>åå·®-æ¹å·®æè¡¡ï¼Bias-Variance Tradeoffï¼</strong></p>
<p><strong>å¨æ­¤æä»¬åºè¯¥æå±ä¸ä¸</strong>ï¼ç»å¸çè®ºè®¤ä¸ºæ¨¡åå¤æåº¦ï¼å¦åæ°æ°éï¼å¢å ï¼æ³åè¯¯å·®ä¼åå åå·®éä½èä¸éï¼åå æ¹å·®å¢å¤§èä¸åï¼å½¢æåä¸çUåæ²çº¿ã<strong>åéä¸é</strong>åæ­ç¤ºäºå¨æå¼éå¼ï¼æ¨¡ååå¥½è½å®ç¾æåè®­ç»æ°æ®ï¼åï¼éçå¤æåº¦è¿ä¸æ­¥å¢å ï¼è¯¯å·®ä¼åæ¬¡ä¸éï¼å½¢æâä¸é-ä¸å-ä¸éâçæ³¢æµªå½¢æ²çº¿ãå¨è¿åæ°ååºåï¼æ¨¡åå¹¶éå¿ç¶è¿æåå°æ´å·®çç¨åº¦ï¼ä¼åè¿ç¨ä¼å¼å¯¼å¶æ¾å°ä¸ä¸ªæ³åè¯å¥½çè§£ãå¨è¿åæ°åä½å¶ä¸ï¼æ¨¡åå¥½åæ¯åâè®°å¿âï¼æååªå£°ï¼ï¼åéè¿æ¼«é¿çä¼åè¿ç¨âéæ¸è·å¾âæ³åè§åãï¼å¶å®çæ­£çåå æ¯<strong>éå¼æ­£åå</strong>ä½¿å¾ä¼åç®æ³ï¼å¦SGDï¼å¾åäºæ¾å°æå°èæ°è§£æå¹³å¦æå°å¼ï¼</p>
<p>è¿åè¯æä»¬ï¼å¦æè§å¯å°å¢å æ¨¡ååæ°åæ§è½ååå·®ï¼ä¸è¦ç«å³æ­¢æ­¥ãè¿å¯è½åªæ¯å¤äºæå¼éå¼éè¿çå±é©åºãç»§ç»­å¢å è§æ¨¡ï¼å¹¶éåè¶³å¤çè®­ç»ï¼æ§è½å¯è½ä¼çªç ´å¹¶åå¾æ´å¥½ã</p>
<p>çè§£äºæ¨¡åçè¯¯å·®é®é¢ç±åå·®ãæ¹å·®é´çæè¡¡å³å®ï¼æä»¬å¤§ä½äºè§£å¦ä½éæ©æ¨¡åçå¤æåº¦ãä½æ¯ï¼å½æä»¬çæè®­ç»ä¸ä¸ªå¤ææ·±å±æ¨¡åï¼å°¤å¶æ¯ç°ä»£ç½ç»å±æ°ä¸æ­å æ·±æ¶ï¼æä»¬åºè¯¥èèï¼è®­ç»æ¬èº«æ¯å¦è½å¤æ­£å¸¸è¿è¡ï¼å¦åç»æä¸çâåå·®ãæ¹å·®âé½æç©ºè°ãè¿å°±å¼åºäºæ·±åº¦å­¦ä¹ ä¸­ç <strong>æ¢¯åº¦é®é¢</strong> ã</p>
<h2 id="æ¢¯åº¦é®é¢">æ¢¯åº¦é®é¢</h2>
<p>æä»¬å¯ä»¥è®¤ä¸ºï¼</p>
<p><span class="math inline">\(\mathbf{h}^{(l)} = f_l (\mathbf{h}^{(l-1)})\)</span></p>
<p>å æ­¤</p>
<p><span class="math inline">\(\mathbf{o} = f_L \circ f_{L-1}\circ \ldots\circ f_2\circ f_1(\mathbf{x})\)</span></p>
<p>é£ä¹ä¸é¾å¾å°ï¼</p>
<p></p><div class="math display">\[\partial_{\mathbf{W}^{(l)}} \mathbf{o} = \underbrace{\partial_{\mathbf{h}^{(L-1)}} \mathbf{h}^{(L)}}_{ \mathbf{M}^{(L)} \stackrel{\mathrm{def}}{=}} \cdot \ldots \cdot \underbrace{\partial_{\mathbf{h}^{(l)}} \mathbf{h}^{(l+1)}}_{ \mathbf{M}^{(l+1)} \stackrel{\mathrm{def}}{=}} \underbrace{\partial_{\mathbf{W}^{(l)}} \mathbf{h}^{(l)}}_{ \mathbf{v}^{(l)} \stackrel{\mathrm{def}}{=}}.
\]</div><p></p><p>ä¹å æ­¤ï¼æ¢¯åº¦ <span class="math inline">\(\partial_{\mathbf{W}^{(l)}} \mathbf{o}\)</span> æ¯ <span class="math inline">\((L-l)\)</span> ä¸ªéå¯æ¯ç©éµ <span class="math inline">\(\mathbf{M}^{(L)}, \dots, \mathbf{M}^{(l+1)}\)</span> ä¸ä¸ä¸ªäºç»´å¼ é <span class="math inline">\(\mathbf{v}^{(l)}\)</span> çä¹ç§¯ãå¨æ·±å±ç½ç»ä¸­ï¼è¿ç»­ç©éµä¹æ³å¯è½å¯¼è´ç»ææ°å¼è¿å¤§ï¼<strong>çç¸</strong>ï¼æè¿å°ï¼<strong>æ¶å¤±</strong>ï¼ã</p>
<p><strong>æ¢¯åº¦æ¶å¤±</strong>ï¼</p>
<p>å¦æä½¿ç¨Sigmoidå½æ°ï¼å°±è¦èè Sigmoid å½æ°å¨å¶é¥±ååºæ¢¯åº¦é¼è¿äºé¶çæåµãå æ­¤å½è¾å¥å¾å¤§æå¾å°æ¶ï¼æ¢¯åº¦æ¶å¤±ãä¸ºæ­¤æä»¬æå¥½ç¨ReLUå½æ°æ¿ä»£ä¹ã</p>
<p>å¦ææ¯ä¸æ¬¡ç æ¢¯åº¦é½åå°ä¸ç¹ï¼é£ä¹å¤å±ä¼ æ­åæ¢¯åº¦å¼ä¼éå¸¸å°ã</p>
<p>å¦ææéçåå§å¼å¤ªå°ï¼ååä¼ æ­è¿ç¨ä¸­æ¯å±çº¿æ§åæ¢çè¾åºæ¹å·®å¤§å¹è¡°åï¼è¿èä½¿æ¿æ´»å½æ°çè¾å¥è½å¥è¯¥å½æ°çå±é©åºï¼å¦ Sigmoid çé¥±ååºãReLUçæ©æåºï¼ã</p>
<p><strong>æ¢¯åº¦çç¸</strong>ï¼</p>
<p>ç¹æååä¼ æ­è¿ç¨ä¸­ï¼æ¢¯åº¦å¼éçå±çº§å¢å èä¸æ­åå¤§ï¼ä¹è³ææ°åå¢å ã</p>
<p>å¾å¯è½å ä¸º <span class="math inline">\(weight\)</span> çåå§å¼å¤ªå¤§ï¼å±æ°è¿å¤ç­ç­</p>
<p><strong>åæ°åçå¯¹ç§°æ§</strong>ï¼<br>
è¥åä¸å±åççæææéååå§åä¸ºç¸åå¼ï¼é£ä¹è¯¥å±ææçç¥ç»åå¨ååä¼ æ­ä¸­é½ä¼è·å¾å®å¨ä¸æ ·çæ¢¯åº¦ï¼æ°¸è¿å­¦ä¹ ç¸åçç¹å¾ï¼æå¤§éä½æ¨¡åå®¹éã</p>
<p>é£ä¹ï¼å¦ä½ä¸ºæä»¬æ¨¡åçè®­ç»æä¾ä¸ä¸ªè¯å¥½ãç¨³å¥çèµ·ç¹å¢ï¼è¿å°±æ¯ç¥ç»ç½ç» <strong>åæ°åå§å</strong> çshowtimeäºãè¯å¥½çåå§åæ¹å¼ï¼è½å¤ååä¼ æ­ä¸­ä¿æä¼ éå¼ºåº¦ï¼å¨ååä¼ æ­ä¸­ä¿è¯æ¢¯åº¦æµå¨ï¼ä»èæç ´ä¸æç <em>åæ°åçå¯¹ç§°æ§</em> ç­ç­é®é¢ã</p>
<h3 id="ä¸ç§å¸¸è§çåå§å">ä¸ç§å¸¸è§çåå§å</h3>
<h4 id="xavieråå§å">Xavieråå§å</h4>
<p>ç®æ ï¼ä¿æåå±æ¿æ´»å¼æ¹å·®ç¨³å®ï¼ç¡®ä¿ååä¼ æ­çä¿¡å·å¼ºåº¦åååä¼ æ­çæ¢¯åº¦å¼ºåº¦å¨åå§åæ¶ä¸è¡°åä¹ä¸çç¸ã</p>
<p>Xavier åå§åå ä¸ºæåºçæ¶é´è¾æ©ï¼å®ä¸»è¦éå¯¹å <span class="math inline">\(tanh\)</span> è¿æ ·å¨åç¹éè¿è¿ä¼¼çº¿æ§ä¸å¯¹ç§°çé¥±åæ¿æ´»å½æ°ãå æ­¤å¯¹äºåæ¥å¹¿æ³ä½¿ç¨ç ReLU åå¶åç§ï¼å®çææå¹¶éæä¼ã</p>
<p>è¿éç3ä¸ªå½æ°é½æé¥±ååºï¼ä¹å°±æ¯æ¢¯åº¦æ¶å¤±çé£æ®µåºåï¼å¤ªå¤§æå¤ªå°æ¶å½æ°å¯¼æ°è¶äº <span class="math inline">\(0\)</span> ã</p>
<p>è¿ä¸ªçè®ºçåºæ¬ååå°±æ¯ï¼<strong>å¨ååä¼ æ­ä¸­ï¼ä¿æåå±æ¿æ´»å¼çæ¹å·®ä¸è´ï¼å¨ååä¼ æ­ä¸­ï¼ä¿æåå±æ¢¯åº¦çæ¹å·®ä¸è´</strong>ã ä¹å°±æ¯è¯´åå§åé¶æ®µçæ¿æ´»å¼åæ¢¯åº¦çææåä¸º <span class="math inline">\(0\)</span>ãXavieråå§åæ¯ä¸º <span class="math inline">\(tanh\)</span> è¿ç±»å¨é¶ç¹éè¿è¿ä¼¼çº¿æ§ä¸å¯¹ç§°çæ¿æ´»å½æ°è®¾è®¡çï¼å¯¹äº <span class="math inline">\(Sigmoid\)</span>ï¼è½ç¶ Xavieråå§åå¯ä»¥ç¨äº <span class="math inline">\(Sigmoid\)</span> ï¼ä½ä¸æ¯æä¼çãå®éåºç¨ä¸­ï¼å¯¹ <span class="math inline">\(Sigmoid\)</span> å¯ä»¥ä½¿ç¨ Xavieråå§åï¼ä½å¯è½éè¦è°æ´ç¼©æ¾å å­ã</p>
<p>ç¨æ°å­¦è¯­è¨è¡¨è¿°ï¼å°±æ¯è¦æ¿æ´»å½æ°å¨åç¹æ³°åå±å¼çä¸é¶è¿ä¼¼ï¼å½ç¶ <span class="math inline">\(x\)</span> ä¹å¨ <span class="math inline">\(0\)</span> éè¿ï¼ <span class="math inline">\(f(x)\)</span> æ»¡è¶³ï¼</p>
<p></p><div class="math display">\[\begin{split}
&amp;f(x) = -f(-x)ï¼å³f(0)=0\\
&amp;f'(0)=1\end{split}
\]</div><p></p><p>åæ¢å¥è¯ï¼ç±è§å¯ï¼æä»¬å¸æä»»æå±çè¾å¥ä¿¡å·æ¹å·®åºç­äºå¶è¾åºä¿¡å·æ¹å·®ï¼</p>
<p></p><div class="math display">\[Var(a^{(l-1)}) \approx Var(a^{(l)})
\]</div><p></p><p>è§å¯ç¬¬ <span class="math inline">\(l\)</span> å±ççº¿æ§åæ¢ï¼</p>
<p></p><div class="math display">\[\mathcal{z_i^{l}}=\sum_{j=1}^{n_{in}}w_{ij}^{(l)}\cdot a_j^{(l-1)}
\]</div><p></p><p>è¿éååºæ¬åè®¾ä¸ä¸ï¼</p>
<ol>
<li>æé <span class="math inline">\(w_{ij}^{(l)}\)</span> ç¬ç«ååå¸ï¼åå¼ä¸º <span class="math inline">\(0\)</span>ï¼æ¹å·® <span class="math inline">\(\sigma _w^2\)</span></li>
<li>æ¿æ´»å¼ <span class="math inline">\(a_{j}^{(l-1)}\)</span> ç¬ç«ååå¸ï¼åå¼ä¸º <span class="math inline">\(0\)</span>ï¼æ¹å·® <span class="math inline">\(\sigma _a^2\)</span></li>
<li>æéåæ¿æ´»å¼ç¸äºç¬ç«</li>
</ol>
<h5 id="åççææ">åççææï¼</h5>
<p></p><div class="math display">\[\begin{split}
\mathbb{E}[z^{(l)}_i]&amp;=\mathbb{E}\bigg[ \sum^{n_{in}}_{j=1}w_{ij}^{(l)}a_j^{(l-1)} \bigg]\\
\mathbb{E}[z_i^{(l)}]&amp;=\sum_{j=1}^{n_{in}}\mathbb{E}[w_{ij}^{(l)}]\cdot \mathbb{E}[a_j^{(l - 1)}]\\
\mathbb{E}[z_i^{(l)}]&amp;=0

\end{split}
\]</div><p></p><h5 id="åççæ¹å·®åçç¼äºååä¼ æ­çè¿ç¨">åççæ¹å·®ï¼åçç¼äºååä¼ æ­çè¿ç¨ï¼</h5>
<p></p><div class="math display">\[\begin{split}
Var(\mathcal{z_i^{(l)}})&amp;=\mathbb E[(\mathcal{z_i^{(l)}})^2]-(\mathbb E[\mathcal z_i^{(l)}])^2\\
&amp;=\mathbb E[(\mathcal{z_i^{(l)}})^2]
\\
&amp;=  \mathbb{E} \left[ \left( \sum_{j=1}^{n_{\text{in}}} w_{ij}^{(l)} a_j^{(l-1)} \right)^2 \right] \\
&amp;= \mathbb{E} \left[ \sum_{j=1}^{n_{\text{in}}} \sum_{k=1}^{n_{\text{in}}} w_{ij}^{(l)} w_{ik}^{(l)} a_j^{(l-1)} a_k^{(l-1)} \right]\\
&amp;= \ldots\\
&amp;= \sum_{j=1}^{n_{in}}\mathbb E[(\mathcal{w}_{ij}^{(l)})^2]\cdot\mathbb E [(a_j^{(l - 1)})^2] \space(j=k)\\
&amp;=n_{in}\cdot\sigma_w^2\cdot\sigma_a^2\\
\end{split}\]</div><p></p><p>ä¸æå¬å¼æ¨å¯¼çç¥å·ä¸­çåå®¹ï¼</p>
<ul>
<li>å½ <span class="math inline">\(j\neq k\)</span>ï¼å¼å­ä¸º <span class="math inline">\(0\)</span></li>
<li>å½ <span class="math inline">\(j=k\)</span>ï¼å¼å­ä¸º <span class="math inline">\(\sum_{j=1}^{n_{in}}\mathbb E[(\mathcal{w}_{ij}^{(l)})^2]\cdot\mathbb E [(a_j^{(l = 1)})^2]\)</span></li>
<li>å æ­¤ï¼æ±åä¸­ä» <span class="math inline">\(j=k\)</span> çé¡¹æè´¡ç®ã</li>
</ul>
<p>ä¸ºäºä¿è¯æ¿æ´»æ¹å·®ä¸åï¼å³</p>
<p></p><div class="math display">\[\begin{split}
Var(z_i^{(l)})&amp;=Var(a_j^{(l - 1)})\\
n_{in}\cdot\sigma^2\cdot\sigma_a^2&amp;=\sigma_a^2\\
n_{in}\cdot\sigma_w^2&amp;=1\\
\end{split}
\]</div><p></p><h5 id="æ¥çæ¨å¯¼ä¸ä¸ååä¼ æ­">æ¥çæ¨å¯¼ä¸ä¸ååä¼ æ­ï¼</h5>
<p>ååä¼ æ­çæ¢¯åº¦ä¼ æ­å¬å¼å¦ä¸</p>
<p></p><div class="math display">\[\frac{\partial L}{\partial a_j^{(l-1)}}=\sum_{i=1}^{n_{out}}w_{ij}^{(l)}\cdot\frac{\partial L}{\partial z_i^{(l)}}
\]</div><p></p><p>é£ä¹åè®¾ <span class="math inline">\(\frac{\partial L}{\partial z_i^{(l)}}\)</span> ç¬ç«ååå¸ï¼æ¹å·®ä¸º <span class="math inline">\(\sigma_g^2\)</span> ï¼å¯ä»¥å¾å°æ¢¯åº¦æ¹å·®çè¡¨ç¤ºï¼</p>
<p></p><div class="math display">\[\begin{split}
Var\left( \frac{\partial L}{\partial a_j^{(l-1)}} \right)&amp;=\sum_{i=1}^{n_{out}}\mathbb{E}[(w_{ij}^{(l)})^2]\cdot\mathbb{E}\left[ \left( \frac{\partial L}{\partial z_i^{(l)}} \right)^2 \right] \\

&amp;=n_{out}\cdot\sigma_w^2\cdot\sigma_g^2\\
\end{split}
\]</div><p></p><p>æä»¬å¸æååä¼ æ­ååæ¢¯åº¦æ¹å·®ä¸åãå³å¸æï¼</p>
<p></p><div class="math display">\[Var\left( \frac{\partial L}{\partial a_j^{(l-1)}} \right)=Var\left( \frac{\partial L}{\partial z_i^{(l)}} \right)
\]</div><p></p><p>é£ä¹å°±å¯ä»¥å¾å°ååä¼ æ­ä¿ææ¹å·®ä¸åæ¶åºæ»¡è¶³çæ¡ä»¶ï¼</p>
<p></p><div class="math display">\[\begin{split}

n_{out}\cdot\sigma_w^2\cdot\sigma_g^2&amp;=\sigma_g^2\\
n_{out}\cdot\sigma_w^2&amp;=1

\end{split}
\]</div><p></p><h5 id="å æ­¤è¿ç§ä¸ä¸è¿ä¸¤ä¸ªæ¡ä»¶åè°åå¹³å">å æ­¤ï¼è¿ç§ä¸ä¸è¿ä¸¤ä¸ªæ¡ä»¶ï¼åè°åå¹³åï¼</h5>
<p></p><div class="math display">\[\begin{split}
n_{in}\cdot\sigma_w^2&amp;=1\\
n_{out}\cdot\sigma_w^2&amp;=1\\
\sigma_w^2&amp;=\frac{2}{n_{in}+n_{out}}\\
\end{split}
\]</div><p></p><p>å³ï¼</p>
<p></p><div class="math display">\[Var(\mathcal w) = \frac{2}{n_{in}+n_{out}}
\]</div><p></p><p>è¿æ ·ï¼æ åå·®å°±åºæ¥äºï¼</p>
<p></p><div class="math display">\[\sigma = \sqrt \frac{2}{n_{in}+n_{out}}
\]</div><p></p><p>å æ­¤åå§æå¼åºç¬¦åçæ­£æåå¸ï¼</p>
<p></p><div class="math display">\[W\sim \mathcal N(0,\sigma^2)
\]</div><p></p><p>æèè½¬åä¸ºåååå¸å½¢å¼ï¼å³</p>
<p></p><div class="math display">\[w\sim U\left[ -\sqrt{\frac{6}{n_{in}+n_{out}}},\sqrt{\frac{6}{n_{in}+n_{out}}} \right]
\]</div><p></p><p>ç¶èï¼Xavieråå§åæåºçæ¶é´æç¹æ©ï¼ReLUæ¿æ´»å½æ°è¿æ²¡æå¾å°å¹¿æ³åºç¨ã<br>
å¯¹äºReLUå½æ°ï¼Xavieråå§ååä¸ä»å¿ï¼</p>
<ol>
<li>ReLUçå½æ°è¾åºéå¯¹ç§°ï¼<span class="math inline">\(y \in [0,+â)\)</span></li>
<li>è´çè¾å¥ååè¾åºæ¶æ¢¯åº¦ä¸º <span class="math inline">\(0\)</span></li>
<li>ä¼å° <span class="math inline">\(50\%\)</span> çç¥ç»åè¾åºæ¸é¶ï¼ä»è</li>
</ol>
<ul>
<li>ååä¼ æ­ï¼<span class="math inline">\(Var(a) \approx \frac{1}{2}Var(y)\)</span></li>
<li>ååä¼ æ­ï¼æ¢¯åº¦æ¹å·®åæ ·åå</li>
</ul>
<p>èä¸å¯¹äºæ·±å±ç¥ç»ç½ç»èè¨ï¼çº¿æ§æ¿æ´»å½æ°ä»·å¼ä¸å¤§ï¼å ä¸ºå®éè¦éçº¿æ§æ¿æ´»å½æ°æ¥æå»ºå¤æçéçº¿æ§ç¥ç»ç½ç»ã</p>
<p>é¢å¯¹è¿äºé®é¢ï¼Heåå§åï¼Kaimingåå§åï¼è¢«æäºåºæ¥ã</p>
<h4 id="kaiming-åå§å">Kaiming åå§å</h4>
<p>ä¸ Xavier åå§åç±»ä¼¼ï¼Kaiming åå§åçç®çä¹æ¯å°½éè®©æ¯ä¸å±è¾åºå±çæ¹å·®ä¸è¾å¥å±çæ¹å·®ä¸è´ï¼ä»¥ç¼è§£æ·±å±ç½ç»ä¸­çæ¢¯åº¦æ¶å¤±ãæ¢¯åº¦çç¸é®é¢ï¼æåä½¿ææ·±æ´æµç½ç»ï¼å¦30å±ï¼è½ä»é¶å¼å§ç´æ¥è®­ç»å¹¶æ¶æã</p>
<p>å¯¹äºååä¼ æ­ï¼</p>
<p></p><div class="math display">\[\begin{split}
\text{Var}(y_i) &amp;= \text{Var} \left( \sum_{j=1}^{n_{\text{in}}} w_{ij} \cdot x_j \right) \\&amp;= n_{\text{input}}\cdot\text{Var}(w_{ij}) \cdot \text{Var}(x_j)
\end{split}
\]</div><p></p><p>å¯¹<span class="math inline">\(y_i\)</span>å å¥ReLUå½æ°å¾å°<span class="math inline">\(a_i\)</span>ï¼é£ä¹æä»¬å°±å¸æï¼</p>
<p></p><div class="math display">\[\text{Var}(a_i) \approx \text{Var}(x_j),\quad \forall i,j
\]</div><p></p><p>è¿éçåå§ååè®¾ä¸ Xavier ç¸åã</p>
<p>å ä¸º <span class="math inline">\(w_{ij}\)</span> ä¸ <span class="math inline">\(x_j\)</span> ç¬ç«ä¸åå¼ä¸º <span class="math inline">\(0\)</span>ï¼æ</p>
<p></p><div class="math display">\[\text{Var}(w_{ij}x_j)=\text{Var}(w_{ij})\text{Var}(x_j)=\sigma_w^2\sigma_x^2
\]</div><p></p><p>å <span class="math inline">\(y_i\)</span> çæ¹å·®ä¸ºï¼</p>
<p></p><div class="math display">\[\begin{split}
\text{Var}(y_i) &amp;= \text{Var}\left( \sum_{j=1}^{n_{in}}w_{ij}x_j \right)\\ 
&amp;=\sum_{j=1}^{n_{in}}\text{Var}(w_{ij}x_j)\\
&amp;=\sum_{j=1}^{n_{in}}\sigma_w^2\sigma_x^2\\
&amp;=n_{in}\sigma_w^2\sigma_x^2\\
&amp;=n_{in}\cdot\text{Var}(w)\cdot\text{Var}(x)
\end{split}
\]</div><p></p><p>æä»¬åè®¾ <span class="math inline">\(y_i\)</span> çåå¸æ¯å³äº 0 å¯¹ç§°çï¼é£ä¹ <span class="math inline">\(y_i\)</span> åæ­£æ°ååè´æ°çæ¦çåå ä¸åã</p>
<p>åç <span class="math inline">\(y_i^2\)</span>ãå ä¸ºå¹³æ¹ææ­£è´é½åæäºæ­£æ°ï¼æä»¥ <span class="math inline">\(y_i^2\)</span> çææå¼ <span class="math inline">\(E[y_i^2]\)</span> å¯ä»¥ææä¸¤åï¼ä¸åæ¥èª <span class="math inline">\(y_i&gt;0\)</span>ï¼ä¸åæ¥èª <span class="math inline">\(y_i&lt;0\)</span>ãç±äºå¯¹ç§°ï¼è¿ä¸¤åçè´¡ç®æ¯ä¸æ¨¡ä¸æ ·çã</p>
<p>è ReLU å½æ° <span class="math inline">\(a_i = \max(0, y_i)\)</span> åªå <span class="math inline">\(y_i\)</span> çæ­£å¼é¨åï¼è´æ°é¨åç´æ¥å½é¶ãæä»¥ <span class="math inline">\(a_i^2\)</span> å¶å®å°±æ¯ <span class="math inline">\(y_i^2\)</span> å¨ <span class="math inline">\(y_i&gt;0\)</span> æ¶çå¼ï¼å¶ä»æåµä¸º 0ã</p>
<p>å æ­¤ï¼<span class="math inline">\(a_i^2\)</span> çææ <span class="math inline">\(E[a_i^2]\)</span> æ­£å¥½å°±ç­äº <span class="math inline">\(y_i^2\)</span> ææçä¸åï¼å³</p>
<p></p><div class="math display">\[E[a_i^2]=\frac{1}{2}E[y_i^2]
\]</div><p></p><p>è <span class="math inline">\(E[y_i]=0\)</span>ï¼æ <span class="math inline">\(E[y_i^2]=\text{Var}(y_i)\)</span>ï¼æ</p>
<p></p><div class="math display">\[E[a_i^2]=\frac{1}{2}\text{Var}(y_i)
\]</div><p></p><p>å½ <span class="math inline">\((E[a_i])^2\)</span> ç¸è¾äº <span class="math inline">\(E[a_i^2]\)</span> å¯ä»¥å¿½ç¥æ¶ï¼å¯è¿ä¼¼ä¸ºï¼</p>
<p></p><div class="math display">\[\text{Var}(a_i)\approx\frac{1}{2}\text{Var}(y_i)
\]</div><p></p><p>æä»¬å¸æ <span class="math inline">\(\text{Var}(a_i) = \text{Var}(x)\)</span>ï¼å½ç¶è³å°å¾æ¯è¿ä¼¼çï¼ï¼ç»åå¯å¾ï¼</p>
<p></p><div class="math display">\[\begin{split}
\frac{1}{2}\cdot n_{in}\cdot Var(w)\cdot Var(x) &amp;=Var{(x)}\\
Var(w)&amp;=\frac{2}{n_{in}}
\end{split}\]</div><p></p><p>ä»¥æ­¤ç±»æ¨ï¼å¯ä»¥å¾å°ååä¼ æ­æ¶ï¼</p>
<p></p><div class="math display">\[Var(w)=\frac{2}{n_{out}}
\]</div><p></p><p>ä¸è¿ä¸è¬æåµï¼æä»¬ä½¿ç¨ååä¼ æ­ä¼åï¼å³</p>
<p></p><div class="math display">\[W\sim \mathcal{N}(0,\sqrt \frac{2}{n_{in}})
\]</div><p></p><p>æä»¬ä¸ºä»ä¹ä¸å¸¸è§ç±»æ¯Xavieråè°åå¹³åå¢ï¼ï¼å¶å®æ¯å¯ä»¥çï¼è§ PyTorch ä¸­ç <code>mode='fan_avg'</code> ï¼å ä¸º<strong>ReLUçååæ¿æ´»ç¹æ§</strong>ä½¿å¾ååä¼ æ­åååä¼ æ­çæ¹å·®ä¼ æ­è§å¾ä¸åï¼</p>
<ul>
<li>å¯¹ååä¼ æ­ï¼ReLU ææ­»ä¸åçç¥ç»åï¼æ¹å·®ååï¼å¯¹ååä¼ æ­ï¼ç¸å½äºç®åçä¼¯åªå©æ©ç ï¼æ¹å·®ä¾æ§ååã</li>
<li>é®é¢å¨äºæ­£åååçç½æ ¼ç»æå¯è½æ¯ä¸åçï¼ä¸æ­£åååçè¡°åæºå¶æå¸­ä½å·®å«ã</li>
</ul>
<p>pytorchå®ç°ï¼</p>
<pre><code class="language-python">layer = nn.Linear(64, 128)
init.kaiming_normal_(layer.weight, a=0, mode='fan_in', nonlinearity='relu')
# aï¼è´æçï¼Leaky ReLU çæåµï¼é»è®¤ä¸º0ï¼
# Leaky ReLU : è´xè½´è®¾ç½®ä¸º ax ï¼èä¸æ¯ 0 ï¼éå¸¸ a = 0.01
</code></pre>
<h4 id="æ­£äº¤åå§å">æ­£äº¤åå§å</h4>
<p>ä¸é¢ä¸¤ç§æ¹æ³é½æ¯å¯¹æ¯ä¸ªæéåå«è¿è¡éæºç¬ç«éæ ·ï¼ä½æ¯ç±äºéæ ·çéæºæ§ï¼ä»ä¸å¯é¿ååºç°åç§æ¢¯åº¦é®é¢ã</p>
<p>å¯¹äºä¸ä¸ª L å±çç­å®½çº¿æ§ç½ç»ï¼å¯ä»¥å¾å®¹æå¾å°è¿ä¸ªç­å¼ï¼</p>
<p></p><div class="math display">\[y=W^{(L)}W^{(L-1)}W^{(L-2)}\cdots W^{(2)}W^{(1)}x
\]</div><p></p><p>é£ä¹ï¼æä»¬å¯ä»¥ç´æ¥å° <span class="math inline">\(W^{(i)}\)</span> åå§åä¸ºæ­£äº¤ç©éµã</p>
<p>æ ¹æ®çº¿ä»£ç¥è¯ï¼æä»¬å¯¹è¿ä¸ªåå§æéç©éµçæå»ºåä¸ºä¸¤æ­¥ï¼</p>
<ol>
<li>ç¨åå¼ <span class="math inline">\(0\)</span> , æ¹å·® <span class="math inline">\(1\)</span> çé«æ¯åå¸æå»ºä¸ä¸ªç©éµ</li>
<li>å¥å¼å¼åè§£è¿ä¸ªç©éµï¼å¾å°ä¸¤ä¸ªæ­£äº¤ç©éµï¼éæ©å¶ä¸­ä¸ä¸ªä½ä¸ºæéç©éµ</li>
</ol>
<p>æ ¹æ®æ­£äº¤ç©éµçæ§è´¨ï¼è¿ä¸ªçº¿æ§ç½ç»å°±ä¼å¨ååãååä¼ æ­ä¸­é½æä¸å®çèæ°ä¿ææ§ãå¦æè¿ä¸ªç½ç»æ¯éçº¿æ§çï¼åªéå¨ç©éµåé¢ä¹ä¸ä¸ä¸ªç³»æ° <span class="math inline">\(\rho\)</span>ï¼è¿ä¸ªç³»æ°ä¸æ¿æ´»å½æ°æå³ï¼å¦å¯¹äº <span class="math inline">\(ReLU\)</span> åºè¯¥ <span class="math inline">\(\rho=\sqrt 2\)</span> ï¼å¯¹äº <span class="math inline">\(tanh\)</span> åºè¯¥ <span class="math inline">\(\rho\approx 1.0\)</span>ï¼è¿æ¯ä¸ºäºè¡¥å¿æ¿æ´»å½æ°å¯¹ä¿¡å·å¹åº¦çåç¼©ï¼æ©å¼ ï¼æåºã</p>
<h3 id="æ´å ç°ä»£çåå§åæ¹æ³">æ´å ç°ä»£çåå§åæ¹æ³</h3>
<h4 id="fixup">Fixup</h4>
<p>å¯ä½¿å¨ä¸ä½¿ç¨æ¹éå½ä¸åçæåµä¸å®ææ·±åº¦æ®å·®ç½ç»è®­ç»ã</p>
<p>éè¿ç¼©æ¾æ®å·®ç½ç»åæ¯çæéæ¥æ§å¶æ¢¯åº¦è§æ¨¡ï¼é¿åæ·±å±ç½ç»çæ¢¯åº¦çç¸</p>
<p>æ¹æ³ï¼</p>
<ul>
<li>å°åç±»å±ãæ®å·®åæ¯çæåä¸å±åå§åä¸º <span class="math inline">\(0\)</span></li>
<li>å¯¹å¶ä»å±ä½¿ç¨æ åæ¹æ³çåå§åï¼ç¶åå°æ®å·®åæ¯ä¸­çæéå±ä¹ä»¥ç¼©æ¾ç³»æ° <span class="math inline">\(L^{-\frac{1}{2m-2}}\)</span></li>
<li>å¨æ¯ä¸ªåæ¯ä¸­æ·»å ä¸ä¸ªæ éä¹æ°ï¼å°±æ¯åé¢çç¼©æ¾ç³»æ°ï¼ï¼å¨æ¯ä¸ªå·ç§¯ãçº¿æ§ååç´ çº§æ¿æ´»å±åé¢æ·»å ä¸ä¸ªå¯å­¦ä¹ æ éåå·®ï¼åå§ä¸º <span class="math inline">\(0\)</span> ï¼ã</li>
</ul>
<p>å¶ä¸­</p>
<ul>
<li><span class="math inline">\(m\)</span>ï¼æ¯ä¸ªæ®å·®åä¸­çæéå±æ°</li>
<li><span class="math inline">\(L\)</span>ï¼ç½ç»æ»æ®å·®åæ°</li>
</ul>
<h4 id="t-fixup">T-Fixup</h4>
<p>å¨å®å¨ç§»é¤å±å½ä¸åçæåµä¸ï¼ç¨³å®å¹¶é«æå°è®­ç» Transformer æ¨¡å</p>
<p>éè¿ç²¾å¿è®¾è®¡çåæ°åå§ååç®åçæ éåå·®ï¼å¨æ°å­¦ä¸ä½¿ååä¼ æ­çä¿¡å·å¹åº¦åååä¼ æ­çæ¢¯åº¦èæ°å¨åå§åæ¶ä¿æç¨³å®ï¼ä»èå®å¨ç§»é¤ææ LN å±ã</p>
<h2 id="åèæç®">åèæç®</h2>
<p>Glorot &amp; Bengio. Understanding the difficulty of training deep feedforward neural networks. Jan 2010</p>
<p>He et al. Deep Residual Learning for Image Recognition. arXiv:1512.03385 [cs.CV] 10 Dec 2015</p>
<p>Saxe et al. Sparser, Better, Deeper, Stronger: Improving Static Sparse Training with Exact Orthogonal Initialization. arXiv:2406.01755v1 [cs.LG] 03 Jun 2024</p>
<p>Yilmaz &amp; Heckel. Regularization-wise Double Descent: Why It Occurs and How to Eliminate It. arXiv:2206.09012, 2022.</p>
<p>Zhang et al. Fixup Initialization: Residual Learning Without Normalization. arXiv:1901.09321 [cs.LG] 27 Jan 2019</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 21:47">2026-02-09 21:47</span>&nbsp;
<a href="https://www.cnblogs.com/yldeveloper">yLDeveloper</a>&nbsp;
éè¯»(<span id="post_view_count">50</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19597056);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19597056', targetLink: 'https://www.cnblogs.com/yldeveloper/p/19597056', title: 'ä»æ¨¡åè¯ä¼°ãæ¢¯åº¦é¾é¢å°ç§å­¦åå§åï¼ä¸æ­¥æ­¥è§£ææ·±åº¦å­¦ä¹ çè®­ç»é®é¢' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Lab3-page tables  && MIT6.1810æä½ç³»ç»å·¥ç¨ãæç»­æ´æ°ã ]]></title>
    <link>https://www.cnblogs.com/xiaobai1523/p/19596981</link>
    <guid>4ed9abe34eeab198bc43d458728761b1</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaobai1523/p/19596981" title="åå¸äº 2026-02-09 21:21">
    <span role="heading" aria-level="2">Lab3-page tables  &amp;&amp; MIT6.1810æä½ç³»ç»å·¥ç¨ãæç»­æ´æ°ã</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="labpage-tables">Labï¼page tables</h1>
<p>â	å¨è¿ä¸ªlabä¸­<a href="https://pdos.csail.mit.edu/6.828/2025/labs/pgtbl.html" target="_blank" rel="noopener nofollow">6.1810 / Fall 2025</a>ï¼è¦æ±æä»¬åéè¯»xv6è¯¾æ¬ç<a href="https://pdos.csail.mit.edu/6.828/2025/xv6/book-riscv-rev5.pdf" target="_blank" rel="noopener nofollow">Chapter 3 Page tables</a>(ç¬¬ä¸ç« )ãè¦æ±æä»¬æ¢ç´¢xv6å½ä¸­å³äºé¡µè¡¨çåå®¹ãå¹¶ä¸è¦æ±æä»¬å®ç°ä¸äºé¡µè¡¨ç¸å³åè½çå®ç°ï¼ä¾å¦ï¼èå°ååç©çå°åçæ å°/è§£é¤æ å°ï¼é¡µè¡¨çåå»ºåéæ¾ç­ï¼ã</p>
<p>â	å¹¶ä¸å®ç½ä¹ç»åºäºæç¤ºï¼</p>
<ul>
<li>å¨<code>kernel/memlayout.h</code>å½ä¸­å­æ¾äºåå­å¸å±ï¼é¡µè¡¨å¤§å°ç¸å³çå¸¸éå°±å¨æ­¤ã</li>
<li>å¨<code>kernel/vm.c</code>å½ä¸­æ¯é¡µè¡¨ç¸å³é»è¾çå®ç°ï¼æ¥ä¸æ¥çå¤§é¨ålabåå®¹å°±å¨æ­¤å®ç°ã</li>
<li>å¨<code>kernel/kalloc.c</code>å½ä¸­å­æ¾çæ¶åå­åéç¸å³çé»è¾ï¼å¨æ°å»º/å é¤é¡µè¡¨æ¶ä¼ç¨å°è¿éçå½æ°ã</li>
</ul>
<h2 id="speed-up-system-calls-ç®å">Speed up system calls ï¼ç®åï¼</h2>
<p>â	å¨è¿ä¸ªlabå½ä¸­ï¼è¦æ±æä»¬å¨ xv6 ä¸­æ·»å ä¸ä¸ªæ°ç <strong>ç¨æ·å¯è¯»çåªè¯»åå­æ å°ï¼USYSCALLï¼</strong>ï¼ç¨æ¥è®©ç¨æ·æç¨åºå¨ä¸é·å¥åæ ¸çæåµä¸ï¼ç´æ¥è¯»åé¨ååæ ¸æ°æ®ï¼å¦ <code>pid</code>ï¼ï¼å¹¶æ­£ç¡®å¤çå¶ <strong>åå»ºãæ å°ãè®¿é®ä¸éæ¾çå®æ´çå½å¨æ</strong>ã</p>
<h3 id="å¦ä½å°ä¸ä¸ªç¨æ·å¯è¯»çåªè¯»åå­æ å°usyscallæ·»å å°è¿ç¨é¡µè¡¨åä»¥åå¦ä½å é¤è¯¥æ å°">å¦ä½å°ä¸ä¸ª<strong>ç¨æ·å¯è¯»çåªè¯»åå­æ å°ï¼USYSCALLï¼</strong>æ·»å å°è¿ç¨é¡µè¡¨åï¼ä»¥åå¦ä½å é¤è¯¥æ å°ï¼</h3>
<p>â	<strong>åè¨åæ³¨æäºé¡¹</strong>ï¼å¨xv6å½ä¸­çæå³è¿ç¨çåå»º/éæ¾ï¼è¿ç¨é¡µè¡¨çåå»º/éæ¾çè¿ç¨é½å¨<code>kernel/proc.h</code>,å¹¶ä¸æç§å®ç½çè¯´æ³ï¼æä»¬éè¦å°è¿ç¨ç<strong>pid</strong>å­æ¾å°åå­å½ä¸­ï¼è¿æ ·å¨è°ç¨<strong><code>gitpid</code>ç³»ç»è°ç¨</strong>æ¶ï¼åç´æ¥éæ©ä»åå­ç©ºé´å½ä¸­è¯»åè¯¥pidï¼å¤§å¤§æé«äºæ§è¡æçï¼å¹¶ä¸ä¸ç¨é·å¥å°åæ ¸æï¼è¿å°±æå³çæä»¬éè¦å¨<strong>è¿ç¨çç»æä½</strong>å½ä¸­æ·»å ä¸ä¸ªæåç¨äºæåå­æ¾å½åè¿ç¨ç<strong>pid</strong>çç©ºé´ï¼ä¸ºäºä¹åçè¯»åã</p>
<p>â	<strong>ä¸ãåéç©çåå­</strong>ï¼</p>
<p>â		åé¢æå°è¿ï¼è¿ç¨çç»æä½æåå½ä¸­ææåè¿ç¨pidçæé<code>(struct usyscall *)</code>ï¼å æ­¤ï¼æä»¬éè¦åç»ä»åéç©çåå­ï¼ç±åæ ¸åéï¼ã</p>
<pre><code class="language-c">p-&gt;usyscall = (struct usyscall *)kalloc(); //åéç©çåå­
</code></pre>
<p>â	<strong>äºãåå§ååå®¹ï¼</strong></p>
<p>â		å°å½åè¿ç¨ç<strong>pid</strong>å­æ¾å°åæçæé<code>p-&gt;usyscall</code>ææåçç©ºé´ä¸­ã</p>
<pre><code class="language-c">p-&gt;usyscall-&gt;pid = p-&gt;pid;

// ä»¥ä¸æ¯xv6æååå¥½çï¼æ¹è¿åçugetpidæ¹æ³
int
ugetpid(void)
{
  struct usyscall *u = (struct usyscall *)USYSCALL;  //éè¿èæå°åUSYSCALLè®¿é®ç¹ç¹åå­
  return u-&gt;pid;
}
</code></pre>
<p>â		ä¸ºä»ä¹æä»¬å¿é¡»éè¿<code>struct usyscall *</code>æ¥è®¿é®ï¼èä¸æ¯ç´æ¥è¿åè¿ç¨ç»æä½å½ä¸­ç<strong>pid</strong>å¢ï¼</p>
<p>â		ç­ï¼é¦åï¼xv6æ<strong>åæ ¸é¡µè¡¨</strong>å<strong>ç¨æ·é¡µè¡¨</strong>ï¼å¹¶ä¸ç¨æ·æä¸çè¿ç¨åªè½çå¾è§åå­ãå ä¸ºè¿ç¨çç»æä½å­æ¾å¨åæ ¸é¡µè¡¨å½ä¸­ï¼å¨ç¨æ·æä¸æä»¬åªè½è®¿é®å°ç¨æ·é¡µè¡¨ï¼æä»¥åç¡®æ¥è¯´æä»¬åªè½éè¿<strong>èæåå­</strong>æ­é<strong>é¡µè¡¨æºå¶</strong>çæ¹å¼æ¥è®¿é®å­æ¾å¨è¯¥ç©çç©ºé´å½ä¸­åå®¹ãæä»¬å¨åæ ¸æä¸éè¿<code>p-&gt;usyscall = (struct usyscall *)kalloc(); </code>åéçåå­ä¼¼ä¹ä¹æ¯è¢«åæ ¸æç®¡çï¼ä½æ¯æä»¬å°<strong>USYSCALL</strong>è¿ä¸ªèæå°ååç©çå°åç¸æ å°äºèµ·æ¥ï¼å æ­¤æä»¬å¯ä»¥éè¿å¨ç¨æ·æä¸è®¿é®è¯¥èæå°åçæ¹å¼ä¸è®¿é®å°å·ä½çç©çå°åå½ä¸­çå¼ã</p>
<p>â	<strong>ä¸ãåå»ºç¨æ·é¡µè¡¨ï¼</strong></p>
<p>â		ä¼æå¨ç¥ï¼OSå½ä¸­çè¿ç¨éç¨é¡µè¡¨æºå¶æ¥å°è¿ç¨çèå°åæ å°å°ç©çå°åä¸ï¼æä»¥è¯´æ è®ºæä»¬æ¯å¦è¦æ·»å æ å°å°é¡µè¡¨ä¸­ï¼æä»¬é½å¿ä¸å¯åå°è¦åå»ºä¸ä¸ªç¨æ·é¡µè¡¨ã</p>
<pre><code class="language-c">p-&gt;pagetable = proc_pagetable(p);
</code></pre>
<p>â	<strong>åãå»ºç«èæå°å  å°  ç©çå°åæ å°:</strong></p>
<p>â		è¯´ç½äºå°±æ¯å¨ç¨æ·é¡µè¡¨ä¸­æ·»å ä¸ä¸ªæ°çé¡µè¡¨é¡¹ï¼æä»¥è¿ä¸æ­¥çæä½è¦å¨<strong>é¡µè¡¨çç¸å³é»è¾</strong>å½ä¸­è¿è¡ï¼è¯¥é¡µè¡¨é¡¹ç¨äºæ å°å°åæåéçç©çåå­ãå¨<code>kernel/defs.h</code>å½ä¸­ï¼æä»¬å¯ä»¥çå°<strong><code>mappages</code></strong>çå£°æï¼è¯¥å½æ°ç¨äºæ·»å æ å°å°é¡µè¡¨ï¼ã</p>
<p>â		æ³¨æï¼é¡µè¡¨æºå¶æ¯å°è¿ç¨çèæå°åæ å°ä¸ºåå­ä¸­çå®çç©çå°åï¼æä»¥å¨æ·»å æ°çæ å°æ¶ï¼è¦ä¸å¹¶ç»åºè¿äºåæ°ä»¥åæ å°å¤§å°åæéã</p>
<pre><code class="language-c">// æ å° USYSCALL
  if(mappages(pagetable,
              USYSCALL,  //èæå°å
              PGSIZE,  // æ å°å¤§å°
              (uint64)p-&gt;usyscall, //ç©çå°å
              PTE_R | PTE_U | PTE_V) &lt; 0){  // å®ç½è¦æ±è®¾ç½®çæé
    uvmfree(pagetable, 0);
    return 0;
  }
</code></pre>
<p>â		<strong>xv6</strong>çæéï¼æ·»å æéçç®çæ¯é²æ­¢âç¯¡æ¹âï¼âéæ³è®¿é®âç­ç­æä½ï¼ï¼</p>
<table>
<thead>
<tr>
<th>ä½</th>
<th>å«ä¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>PTE_R</td>
<td>ç¨æ·å¯è¯»</td>
</tr>
<tr>
<td>PTE_W</td>
<td>é²æ­¢ç¨æ·å</td>
</tr>
<tr>
<td>PTE_X</td>
<td>é²æ­¢æ§è¡</td>
</tr>
<tr>
<td>PTE_U</td>
<td>ç¨æ·æå¯è®¿é®</td>
</tr>
<tr>
<td>PTE_V</td>
<td>æ å°ææ</td>
</tr>
</tbody>
</table>
<p>â	<strong>äºãå é¤/éæ¾æ å°:</strong></p>
<p>â		é¦åå¨<strong>é¡µè¡¨éæ¾çç¸å³é»è¾</strong>å½ä¸­è¿è¡éæ¾æ å°çæä½ï¼å¨<code>kernel/defs.h</code>å½ä¸­ï¼æä»¬å¯ä»¥çå°<code>uvmunmap</code>çå£°æï¼è¯¥å½æ°ç¨äºå é¤/éæ¾æ å°å°é¡µè¡¨ï¼ã</p>
<pre><code class="language-c">uvmunmap(pagetable, USYSCALL, 1, 0); //éæ¾USYSCALL
</code></pre>
<p>â		ä¹åå¨<strong>è¿ç¨éæ¾çç¸å³é»è¾</strong>è¿è¡éæ¾ä¹åè®¿é®çç©çç©ºé´çæä½ï¼å¨<code>kernel/defs.h</code>å½ä¸­ï¼æä»¬å¯ä»¥çå°<code>kfree</code>çå£°æï¼è¯¥å½æ°ç¨äºéæ¾åéçåå­ï¼ã</p>
<pre><code class="language-c">kfree(p-&gt;usyscall);
</code></pre>
<p>â	<strong>å­ãæ·±å¥äºè§£è¿ç¨åé¡µè¡¨çåºå±é»è¾ï¼</strong></p>
<table>
<thead>
<tr>
<th>å½æ°ï¼kernel/proc.cï¼</th>
<th>è´è´£ä»ä¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allocproc</code></td>
<td>åéâè¿ç¨èµæºâï¼pidãusyscallãtrapframeãkstackï¼<strong>(ç¬¬ä¸ï¼äºï¼ä¸æ­¥å¨æ­¤è¿è¡)</strong></td>
</tr>
<tr>
<td><code>freeproc</code></td>
<td>éæ¾âè¿ç¨èµæºâ <strong>ï¼ç¬¬äºæ­¥ååé¨åå¨æ­¤è¿è¡ï¼</strong></td>
</tr>
<tr>
<td><code>proc_pagetable</code></td>
<td>æé é¡µè¡¨ç»æ <strong>ï¼ç¬¬äºæ­¥ååé¨åå¨æ­¤è¿è¡ï¼</strong></td>
</tr>
<tr>
<td><code>proc_freepagetable</code></td>
<td>æé¤é¡µè¡¨ç»æ <strong>ï¼ç¬¬åæ­¥å¨æ­¤è¿è¡ï¼</strong></td>
</tr>
</tbody>
</table>
<p>â		ç±æ­¤æä»¬å¯ä»¥å¾ç¥é¡µè¡¨ççå½å¨æå ä¹ä¼´éæ´ä¸ªè¿ç¨ã</p>
<h3 id="ä»£ç çç¸å³åå®¹">ä»£ç çç¸å³åå®¹ï¼</h3>
<pre><code class="language-c">/* kernel/proc.c */
static struct proc*
allocproc(void)
{
  struct proc *p;

  for(p = proc; p &lt; &amp;proc[NPROC]; p++) {
    acquire(&amp;p-&gt;lock);
    if(p-&gt;state == UNUSED) {
      goto found;
    } else {
      release(&amp;p-&gt;lock);
    }
  }
  return 0;

found:
  p-&gt;pid = allocpid();
  p-&gt;state = USED;
  // åéç©çåå­
  p-&gt;usyscall = (struct usyscall *)kalloc();
  if(p-&gt;usyscall == 0){
    freeproc(p);
    release(&amp;p-&gt;lock);
    return 0;
  }
  // åå§ååå®¹
  p-&gt;usyscall-&gt;pid = p-&gt;pid;

  // Allocate a trapframe page.
  if((p-&gt;trapframe = (struct trapframe *)kalloc()) == 0){
    freeproc(p);
    release(&amp;p-&gt;lock);
    return 0;
  }

  // An empty user page table.
  p-&gt;pagetable = proc_pagetable(p);
  if(p-&gt;pagetable == 0){
    freeproc(p);
    release(&amp;p-&gt;lock);
    return 0;
  }

  // Set up new context to start executing at forkret,
  // which returns to user space.
  memset(&amp;p-&gt;context, 0, sizeof(p-&gt;context));
  p-&gt;context.ra = (uint64)forkret;
  p-&gt;context.sp = p-&gt;kstack + PGSIZE;

  return p;
}

// free a proc structure and the data hanging from it,
// including user pages.
// p-&gt;lock must be held.
static void
freeproc(struct proc *p)
{
  // éæ¾ä¹ååéçç©çåå­
  if(p-&gt;usyscall){
    kfree((void*)p-&gt;usyscall);
    p-&gt;usyscall = 0;
  }
  if(p-&gt;trapframe)
    kfree((void*)p-&gt;trapframe);
  p-&gt;trapframe = 0;
  if(p-&gt;pagetable)
    proc_freepagetable(p-&gt;pagetable, p-&gt;sz);
  p-&gt;pagetable = 0;
  p-&gt;sz = 0;
  p-&gt;pid = 0;
  p-&gt;parent = 0;
  p-&gt;name[0] = 0;
  p-&gt;chan = 0;
  p-&gt;killed = 0;
  p-&gt;xstate = 0;
  p-&gt;state = UNUSED;
}

// Create a user page table for a given process, with no user memory,
// but with trampoline and trapframe pages.
pagetable_t
proc_pagetable(struct proc *p)
{
  pagetable_t pagetable;

  // An empty page table.
  pagetable = uvmcreate();
  if(pagetable == 0)
    return 0;

  // æ å° USYSCALLï¼ä¹æ¯å³é®é¨åï¼
  if(mappages(pagetable,
              USYSCALL,  //èæå°å
              PGSIZE,  // æ å°å¤§å°
              (uint64)p-&gt;usyscall,  //ç©çå°å
              PTE_R | PTE_U | PTE_V) &lt; 0){ // æé
    uvmfree(pagetable, 0);
    return 0;
  }
  

  // map the trampoline code (for system call return)
  // at the highest user virtual address.
  // only the supervisor uses it, on the way
  // to/from user space, so not PTE_U.
  if(mappages(pagetable, TRAMPOLINE, PGSIZE,
              (uint64)trampoline, PTE_R | PTE_X) &lt; 0){
    uvmfree(pagetable, 0);
    return 0;
  }

  // map the trapframe page just below the trampoline page, for
  // trampoline.S.
  if(mappages(pagetable, TRAPFRAME, PGSIZE,
              (uint64)(p-&gt;trapframe), PTE_R | PTE_W) &lt; 0){
    uvmunmap(pagetable, TRAMPOLINE, 1, 0);
    uvmfree(pagetable, 0);
    return 0;
  }

  return pagetable;
}

// Free a process's page table, and free the
// physical memory it refers to.
void
proc_freepagetable(pagetable_t pagetable, uint64 sz)
{
  uvmunmap(pagetable, USYSCALL, 1, 0);  //éæ¾/å é¤USYSCALLå¯¹åºçæ å°
  uvmunmap(pagetable, TRAMPOLINE, 1, 0);
  uvmunmap(pagetable, TRAPFRAME, 1, 0);
  uvmfree(pagetable, sz);
}

</code></pre>
<h2 id="print-a-page-table-ç®å">Print a page table ï¼ç®åï¼</h2>
<p>â	è¿ä¸ªlabè¦æ±æä»¬å®ç°ä¸ä¸ªæå°é¡µè¡¨çå½æ°ï¼åæ¶ä¹è½å¸®å©æä»¬çè§£xv6å½ä¸­ï¼é¡µè¡¨æ¯å¦ä½å®ç°çãå¨æ¬æ¬¡å®éªåï¼è¿é¨è¯¾ç¨çä½èå·²ç»å°<code>kpgtblï¼ï¼</code>è¿ä¸ªç³»ç»è°ç¨æ·»å å°åæ ¸å½ä¸­äºï¼ç°å¨æä»¬è¦åçå°±æ¯å®å<code>kernel/vm.c</code>å½ä¸­ç<strong><code>vmprint()</code></strong>å½æ°ï¼è¿ä¸ªå½æ°æ¥æ¶ä¸ä¸ª<strong>pagetable_t</strong>ï¼é¡µè¡¨ç±»åï¼çåæ°ã</p>
<h3 id="xv6å½ä¸­çé¡µè¡¨æ¯ææ ·ç">xv6å½ä¸­çé¡µè¡¨æ¯ææ ·çï¼</h3>
<p>â	<strong>é¶ãä¸ä¸è¯æ±éè¿°</strong></p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>VA</td>
<td>èæå°åï¼CPU ä½¿ç¨ï¼</td>
</tr>
<tr>
<td>PTE</td>
<td>é¡µè¡¨é¡¹ï¼æ å° + æéï¼</td>
</tr>
<tr>
<td>PA</td>
<td>ç©çå°åï¼RAM ç´¢å¼ï¼</td>
</tr>
<tr>
<td>PPN</td>
<td>ç©çé¡µå·ï¼PA çé«ä½ï¼</td>
</tr>
</tbody>
</table>
<p>â	<strong>ä¸ãèæå°åvaçç»æåxv6å½ä¸­çä¸çº§é¡µè¡¨</strong></p>
<p>â		æ ¹æ®æ¬è¯¾ç¨å¯¹åºçè¯¾æ¬<a href="https://pdos.csail.mit.edu/6.828/2025/xv6/book-riscv-rev5.pdf" target="_blank" rel="noopener nofollow">xv6 book</a> å½ä¸­çç¬¬ä¸ç« ï¼æä»¬å¯ä»¥å¾ç¥å¨xv6å½ä¸­ï¼èæå°åvaçä½æ°ä¸º64ä½ï¼å¹¶ä¸æä»¬åªä½¿ç¨<strong>ä½39ä½</strong>ï¼é«25ä½ç¨äºæ©å±ãç¸ä¿¡ä½ å¨çå°è¿éæ¶è¯å®å­¦è¿æä½ç³»ç»è¿é¨è¯¾ç¨ï¼å¨ä»»ä½ä¸æ¬æä½ç³»ç»çæç§ä¹¦å½ä¸­ï¼å¯¹äºèæå°åvaçææçæè¿°é½æ¯ä½nä½æ¯é¡µååç§»å°åï¼ç¨äºå®ä½æé¡µåçé¡µè¡¨é¡¹ï¼å©ä¸çé«ä½é½æ¯ç´¢å¼ï¼ç¨äºå®ä½å°æä¸é¡µã</p>
<p>â		å¨xv6å½ä¸­ï¼é¡µè¡¨ç<strong>æ¯é¡µå¤§å°ä¸º4096B</strong>ï¼<strong>æ¯ä¸ªé¡µè¡¨é¡¹ï¼PTEï¼çå¤§å°ä¸º8B</strong>ï¼æä»¥<strong>ä¸ä¸ªé¡µè¡¨çå½ä¸­æ4096/8 = 512ä¸ªPTE</strong>ãæä»¥39ä½çèæå°åvaå½ä¸­ï¼ä½12ä½ä¸ºé¡µååç§»éï¼çä¸ç27ä½ç¨äºç´¢å¼é¡µè¡¨ã</p>
<p>â		xv6éç¨ä¸çº§é¡µè¡¨ï¼ä¹å°±æ¯è¯´27ä½çç´¢å¼å°åï¼æ¯9ä½ææä¸ä¸ªå±çº§ï¼ç±»ä¼¼ä¸ä¸ªæ ãä»¥ä¸åå®¹æ¯39ä½èæå°åçææã</p>
<p>â		PSï¼ï¼åºå¾ç½ç«éæ¶å¯è½å¤±æï¼æä»¥ä¸é¢æå°½éä½¿ç¨æå­æ¥è¿è¡æè¿°ï¼ã</p>
<pre><code class="language-c">|VPN[2] | VPN[1] | VPN[0]|é¡µååç§»|
  9        9        9		12       å±39ä½
ä¸çº§ç´¢å¼  äºçº§ç´¢å¼  ä¸çº§ç´¢å¼  é¡µååç§»é   æ»ä½æ°
  æ ¹                å¶å­
</code></pre>
<p>â		å¯»åæ¶ï¼åè®¿é®VPN[2]å½ä¸­çæä¸ªPTEï¼è¯¥PTEæåVPN[1]ï¼ä¹åä»VPN[1]ä¸­éåæ°çPTEï¼åæ¬¡éè¿æ°çPTEå¯»åVPN[0]ï¼ç¨VPN[0]è·å¾æç»çPTEåå³å¯è·å¾PNNï¼ç©çé¡µå·ï¼ãæåéè¿å¯¹PNNæä½å¾å°PAï¼ç©çå°åï¼ãæ´ä¸ªè¿ç¨ç±»ä¼¼å¯»æ¾æ çå¶å­ç»ç¹é£æ ·ï¼ä¸å±ä¸å±åä¸å¯»æ¾ã</p>
<p>â	<strong>äºãä¸ºä»ä¹xv6éç¨ä¸çº§é¡µè¡¨ï¼</strong></p>
<p>â		 è¿ç¨å¨åå»ºä¹åï¼å¿é¡»ä¸è³å°æ¥æä¸ä¸ªé¡µè¡¨ã<br>
å¦æéç¨ä¸çº§é¡µè¡¨è®¾è®¡ï¼ä¸ºäºæ»¡è¶³è¿ä¸å¿é¡»çæ¡ä»¶ï¼æä½ç³»ç»å¿é¡»ä¸æ¬¡æ§åéä¸å¼ è¦çæ´ä¸ªèæå°åç©ºé´çé¡µè¡¨ï¼å³ä½¿è¿ç¨åªä½¿ç¨å¶ä¸­æå°çä¸é¨åï¼å¤§é¨ååå­ç©ºé´ä¼æµªè´¹æï¼ï¼ä¹å¿é¡»éµå®è¯¥è§å®ã</p>
<p>â		èå¨éç¨ä¸çº§é¡µè¡¨çè®¾è®¡ä¸­ï¼è¿ç¨åå»ºæ¶åªéè¦åéä¸ä¸ª 4KB çæ ¹é¡µè¡¨é¡µï¼å¶ä½é¡µè¡¨é¡µå¨èæå°åç©ºé´è¢«å®éä½¿ç¨æ¶ææéåéã</p>
<p>â	<strong>äºãPTEçåå®¹</strong></p>
<p>â		å·²ç¥æ¯ä¸ªPTEçå¤§å°ä¸º8Bï¼å³ä¸å±64ä½ãå¶ä¸­ä½10ä½ï¼9<sub>0ä½ï¼ä¸ºflagsï¼æéä½/æ è®°ï¼ï¼å©ä¸çé«ä½ï¼53</sub>10ä½å±44bitï¼ä¸ºPNNï¼ç©çé¡µæ¡å·ï¼åéåå­ä¹æ¶ï¼OSä»ç©ºé²é¡µæ¡è¡¨å½ä¸­çè¡¨å¤´åä¸æ¥çï¼ãæåç10ä½ï¼63~54ä½ï¼ææ¶æªç¨ï¼ç½®ä¸º0ã</p>
<p>â		flagsçåå®¹ï¼</p>
<table>
<thead>
<tr>
<th>ä½</th>
<th>å«ä¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>V</td>
<td>æ¯å¦ææ</td>
</tr>
<tr>
<td>R</td>
<td>å¯è¯»</td>
</tr>
<tr>
<td>W</td>
<td>å¯å</td>
</tr>
<tr>
<td>X</td>
<td>å¯æ§è¡</td>
</tr>
<tr>
<td>U</td>
<td>ç¨æ·å¯è®¿é®</td>
</tr>
<tr>
<td>A/D</td>
<td>ç¡¬ä»¶è®¿é®/ä¿®æ¹æ è®°</td>
</tr>
</tbody>
</table>
<p>â	å½ä¸ä¸ª PTE ç <strong>R/W/X ä»»ä¸ä½ä¸º 1 æ¶</strong>ï¼è¯¥ PTE æ¯å¶å­ç»ç¹ï¼æåçå®ç©çé¡µï¼</p>
<p>â	è¥ <strong>R/W/X å¨ä¸º 0 ä¸ V=1</strong>ï¼åè¯¥ PTE æåä¸ä¸çº§é¡µè¡¨ã</p>
<p>â	é¡µè¡¨çæ¬è´¨é¤äºææèæå°åæ å°å°åªéå¤ï¼è¿å¯ä»¥å³å®è¿ä¸ªå°å<strong>æ¯å¦å¯è¯»ï¼æ¯å¦å¯åï¼æ¯å¦å¯æ§è¡ï¼æ¯å¦å¯ç¨æ·æè®¿é®/æ§è¡</strong>ã</p>
<p><strong>ä¸ãPNNå¦ä½è½¬ä¸ºç©çå°å</strong></p>
<p>â		xv6å½ä¸­è§å®ç©çå°åçä½æ°ä¸º56ä½ï¼ç±PNNåvaçä½12ä½æ¼æ¥èæï¼å·ä½æä½ææ³å¦ä¸ï¼</p>
<p>â		1ãé¦åè®²PTEå³ç§»10ä½ï¼è¿æ ·ä½10ä½çflagsä¼æ¶å¤±ã</p>
<p>â		2ãä¹åè®²PTEå·¦ç§»12ä½ï¼è¿æ ·ä½12ä½çç©ºç½æ­£å¥½å¯ä»¥ç±èæå°åçä½12ä½åç§»éè¿è¡å¡«è¡¥ã</p>
<p>â		3ãæä»¬ç°å¨éè¦å°èæå°åvaçç¬¬12ä½è¿è¡å¡«è¡¥ï¼æä»¥æä»¬<strong>å°vaå0xFFFç¸ä¸</strong>ï¼è¿æ ·vaå°±åªå©ä¸äºç¬¬12ä½çåç§»éã</p>
<p>â		4ãå°PTEåvaç¸å æçè¿è¡âé»è¾æâæä½ï¼è¿æ ·å°±æ¼æ¥å¥½äºä¸ä¸ªå®æ´çç©çå°åã</p>
<p>â		æ³¨æï¼å¨xv6å½ä¸­ï¼ä»¥ä¸çæä½é½æçå¯¹åºçå®ï¼å¨ç¼ç æ¶å¯ä»¥ç´æ¥ä½¿ç¨å®æä½ã</p>
<h3 id="è¯¥labçå®ç°åä»£ç ç¸å³åå®¹">è¯¥labçå®ç°åä»£ç ç¸å³åå®¹</h3>
<p>â	<strong>ä¸ãä¸ªäººçè§£æåå®ç½æç¤º</strong></p>
<ol>
<li>æå°æ ¼å¼ï¼ç¬¬ä¸è¡æ¾ç¤º vmprint çåæ°ãä¹åï¼æ¯ä¸ªé¡µè¡¨é¡¹ï¼PTEï¼å¯¹åºä¸è¡ï¼åæ¬é£äºæåæ ä¸­æ´æ·±å±æ¬¡é¡µè¡¨é¡µçé¡µè¡¨é¡¹ãæ¯ä¸ªé¡µè¡¨é¡¹è¡é½ç¼©è¿è¥å¹²ä¸ª â..âï¼ä»¥è¡¨ç¤ºå¶å¨æ ä¸­çæ·±åº¦ãæ¯ä¸ªé¡µè¡¨é¡¹è¡é½ä¼æ¾ç¤ºå¶èæå°åãé¡µè¡¨é¡¹ä½ä»¥åä»è¯¥é¡µè¡¨é¡¹ä¸­æåçç©çå°åãä¸è¦æå°æ æçé¡µè¡¨é¡¹ã</li>
<li>å¨<code>kernel/riscv.h</code>çæä»¶æ«å°¾ï¼æå³äºvaè½¬paçå®ã</li>
<li><code>freewalk</code>è¿ä¸ªå½æ°ä¹è®¸ä¼å¸¦æ¥å¯åã</li>
<li>å¨printfè°ç¨ä¸­ä½¿ç¨%pï¼ä»¥å®ç½ä¸ç¤ºä¾æç¤ºçæ¹å¼æå°å®æ´ç64ä½åå­è¿å¶é¡µè¡¨é¡¹ï¼PTEï¼åå°åã</li>
</ol>
<p>â	<strong>äºãä»£ç ç¸å³åå®¹</strong></p>
<pre><code class="language-c">##å¨kernel/vm.cæä»¶åï¼

static void
vmprint_walk(pagetable_t pagetable, int level, uint64 va){
  //æ¯ä¸ªé¡µè¡¨521ä¸ªPTE
  for(int i = 0; i &lt; 512; i++){
    pte_t pte = pagetable[i];
    // pteææ å¹¶ä¸ Vä½ä¸º1åä¸æ¯å¶å­ç»ç¹
    if((pte &amp; PTE_V) == 0)
      continue;
    // å°ä¼ å¥çPAç©çå°åï¼æ­¤æ¶PAç¬¬12ä½ä¸ºç©ºï¼ååç§»éç¸å åå¹¶ä¸ºå®æ´çç©çå°å
    uint64 newva = va | ((uint64)i &lt;&lt; (12 + 9 * level));

    // æå°å±çº§ï¼ depth = 2 - level
    for(int d = 0; d &lt; 2 - level; d++)
      printf(" ..");

    printf("%p: pte %p pa %p\n",
           (void*)newva,
           (void*)pte,
           (void*)PTE2PA(pte));

    // ä¸æ¯å¶å­ç»ç¹ååä¸éå½
    if((pte &amp; (PTE_R | PTE_W | PTE_X)) == 0){
      // PTE2PAæ¯å°pteè½¬ä¸ºäºç©çå°åPAï¼æ­¤æ¶ä½12ä½ä¸ºç©ºï¼
      pagetable_t child = (pagetable_t)PTE2PA(pte);
      vmprint_walk(child, level - 1, newva);
    }
  }

}

#if defined(LAB_PGTBL) || defined(SOL_MMAP) || defined(SOL_COW)
void
vmprint(pagetable_t pagetable) {
  // your code here
  // æå°ç¬¬ä¸è¡ï¼ä¹åéå½è¿è¡éå
  printf("page table %p\n", pagetable);
  vmprint_walk(pagetable, 2, 0);
  
}
#endif
</code></pre>
<h2 id="use-superpages-å°é¾">Use superpages (å°é¾)</h2>
<p>â	è¿ä¸ªlabå¯ä»¥è¯´æ¯æé¾çlabãå¡äºæå¿«20ä¸ªå°æ¶ãå½ç¨æ·éè¿<code>sbrk()</code>ç³è¯·åå­æ¶ï¼å¦æç³è¯·çåå­<strong>â¥2MB</strong>æ¶ï¼xv6ä¸åä½¿ç¨ä¼ ç»çä¸çº§é¡µè¡¨ï¼å³å¤§å°ä¸º4Kçé¡µï¼ï¼èæ¯éç¨äºçº§é¡µè¡¨ï¼å³1ä¸ª2MBçè¶çº§é¡µï¼ãå¹¶ä¸ç¸å³çå½æ°ä¹è¦ééå¤çè¶çº§é¡µçåè½ã</p>
<p>â	éç¨è¶çº§é¡µåçå°åç»æå¦ä¸ï¼</p>
<pre><code>|VPN[2] | VPN[1]ï¼åå«VPN[0]ï¼|é¡µååç§»|
  9        9        9		   12       å±39ä½
ä¸çº§ç´¢å¼         äºçº§ç´¢å¼      é¡µååç§»é   æ»ä½æ°
  æ ¹              å¶å­
===============================
level-2 (512GB)
  |
level-1 (2MB)   â â superpage å¨è¿éï¼ç¬¬ä¸å±ï¼
  |
level-0 (4KB)   â æ®éçé¡µé¢å¨è¿éï¼ç¬¬0å±ï¼
</code></pre>
<p>â	èµ·å§è¯¥labçæäºå°æ¹çåæ³æ¯æè¿¹å¯å¾ªçï¼ä½ å¯ä»¥ç´æ¥ç§æ¬ä¹ååå çé¨åä»£ç ã</p>
<h3 id="é¡ºè¾æ¸çå¯»æ¾éè¦ä¿®æ¹çåå®¹">é¡ºè¾æ¸çå¯»æ¾éè¦ä¿®æ¹çåå®¹</h3>
<p>â	ä¸ãå¨<code>kernel/kalloc.c</code>æä»¶å½ä¸­çå½æ°æ¯è´è´£åéé¡µè¡¨åå­çï¼ç®åè¿éåªææ®éé¡µçåå®¹ï¼æä»¬éè¦æ·»å è¶çº§é¡µçç¸å³åå®¹ãå¨<code>kmem</code>ä¸­æ·»å ä¸ä¸ª<code>run</code>ç»æï¼è®©å¶æåä¸ä¸ªè¶çº§é¡µçç©ºé²é¡µè¡¨ã ä¹åå¨<code>freerange</code>å½æ°å½ä¸­ä»¿ç§æ®éé¡µçåå­åéé»è¾ï¼ç§è«è¦ç»ç¢åä¸ä¸ªè¶çº§é¡µçåå­åéé»è¾ãåæ¶ä»¿ç§<code>kfree</code>å<code>kalloc</code>åä¸ä¸ª<code>superalloc</code>å<code>superfree</code>ï¼è¿ä¸¤ä¸ªåå«æ¯è¶çº§é¡µçåéåéæ¾ã</p>
<p>â	äºã<code>sbrk()</code>å½ä¸­è°ç¨äº<code>growproc()</code>å½æ°ï¼ä½¿ç¨åæ°<strong>n</strong>è°æ´åå­çå¤§å°ãå½<strong>n</strong>ä¸ºææå¼æ¶åè°ç¨<code>uvmalloc</code>å½æ°æ¥å¯¹ç¨æ·è¿è¡èæåå­çåé<strong>ï¼è¿ééè¦ä¿®æ¹uvmallocï¼</strong>ãè¿ä¸æ­¥è¿å¥<code>uvmalloc</code>å½æ°å½ä¸­ï¼å¶ä¸­æ¶åäº<code>mappages</code>å½æ°ï¼è¯¥å½æ°è´è´£ä¸ºæ¯ä¸ªé¡µè¡¨é¡¹æ å°ç©çå°å<strong>ï¼è¿ééè¦ä¿®æ¹mappagesï¼</strong>ï¼åæ¶ä¹æ¶åäº<code>uvmdealloc</code>å½æ°ï¼è¯¥å½æ°çåè½æ¯éæ¾ç¨æ·é¡µé¢ï¼å¶åé¨æ¶å<code>uvmunmap</code>å½æ°ï¼è¿ä¸ªå½æ°æ¯é¡µé¢éæ¾çå·ä½å®ç°<strong>ï¼è¿ééè¦ä¿®æ¹uvmunmapï¼</strong>ãå¨<code>mappages</code>å½æ°å½ä¸­æ¶åäº<code>walk</code>å½æ°ï¼è¯¥å½æ°è´è´£è¿åèæå°å va å¯¹åºçé¡µè¡¨é¡¹ï¼PTEï¼çå°å<strong>ï¼è¿ééè¦ä¿®æ¹walkï¼</strong>ã</p>
<p>â	ä¸ãå®ç½è¯´äºï¼éè¿ç¨æ·ç¨åº<code>pgtbltest</code>æ¥æµè¯è¶çº§é¡µåè½æ¯å¦å®æï¼æä»¥æä»¬é¡ºè¤æ¸çå¨<code>kernel/pgtbltest.c</code>å½ä¸­åç°<code>superpg_kfork</code>å½æ°è°ç¨äº<code>fork</code>è¿ç¨æ¥åå»ºæ°è¿ç¨ï¼æç®è®©æ°çè¿ç¨éç¨è¶çº§é¡µãæä»¥æä»¬åæ¬¡é¡ºè¾æ¸çæ¾å°äº<code>kfork</code>å½æ°ï¼éé¢æ¶åäº<code>uvmcopy</code>å½æ°ï¼è¿ä¸ªå½æ°è´è´£å°ç¶è¿ç¨çé¡µè¡¨å¤å¶ç»å­è¿ç¨ï¼æç¶è¿ç¨çæ°æ®æ·è´ä¸ä»½ç»å­è¿ç¨ï¼ï¼<strong>ï¼è¿ééè¦ä¿®æ¹uvmcopyï¼</strong>ã</p>
<h3 id="ä»£ç ç¸å³åå®¹">ä»£ç ç¸å³åå®¹</h3>
<p>â	<strong>è¿ä¸å°èæ¬äººä¸å¼å§æ²¡ååºæ¥ï¼å æ­¤åèäºå¾å¤å¤§ä½¬çåå®¢åè§é¢æå¾ä»¥ååºï¼ä»¥ä¸ä»£ç åèäºè¿ä½å¤§ä½¬çåå®¢â<a href="https://chenby99.github.io/p/mit6.1810lab3-page-tables/#use-superpages" target="_blank" rel="noopener nofollow">mit6.1810]Lab3: page tables</a>ã</strong></p>
<p>â	1ãå¨<code>kalloc.c</code>å½ä¸­ç§è«è¦ç»ç¢æ·»å å¯¹è¶çº§é¡µçç®¡çã</p>
<pre><code class="language-c">struct {
  struct spinlock lock;
  struct run *freelist;
  struct run *superfreelist;   // ä»¿ç§ä¸é¢çfreelist
} kmem;

void
freerange(void *pa_start, void *pa_end)
{
  char *p;
  p = (char*)PGROUNDUP((uint64)pa_start);
#ifndef LAB_PGTBL
  for(; p + PGSIZE &lt;= (char*)pa_end; p += PGSIZE)
    kfree(p);
#else
  int superpg_num = 10;
  // è®¡ç®è¶çº§é¡µçèµ·å§å°åï¼ä» pa_end åä¸å¯¹é½å°è¶çº§é¡µè¾¹ç
  char *superp = (char*)SUPERPGROUNDUP((uint64)pa_end - superpg_num * SUPERPGSIZE);
  // åéæ¾æ®éé¡µé¢é¨å
  for(; p + PGSIZE &lt;= superp; p += PGSIZE)
    kfree(p);
   // åéæ¾è¶çº§é¡µé¨å
  for(; superp + SUPERPGSIZE &lt;= (char*)pa_end; superp += SUPERPGSIZE)
    superfree(superp);
#endif
}

#ifdef LAB_PGTBL
// è¶çº§é¡µéæ¾å½æ°
void
superfree(void *pa)
{
  struct run *r;
  // åæ°éªè¯ï¼ç¡®ä¿ pa å¯¹é½å°è¶çº§é¡µå¤§å°ä¸å¨åæ³åå­èå´å
  if(((uint64)pa % SUPERPGSIZE) != 0 || (char*)pa &lt; end || (uint64)pa &gt;= PHYSTOP)
    panic("superfree"); 
  
  memset(pa, 1, SUPERPGSIZE);
  r = (struct run*)pa;
  //å é
  acquire(&amp;kmem.lock);
  r-&gt;next = kmem.superfreelist;
  // å°è¶çº§é¡µæå¥ç©ºé²é¾è¡¨å¤´é¨
  kmem.superfreelist = r;
  //è§£é
  release(&amp;kmem.lock);
}

// è¶çº§é¡µåéå½æ°
void *
superalloc(void)
{
  struct run *r;
  acquire(&amp;kmem.lock);
  // ä»ç©ºé²é¾è¡¨ä¸­ååºä¸ä¸ªè¶çº§é¡µ
  r = kmem.superfreelist; 
  if(r)
    kmem.superfreelist = r-&gt;next;
  release(&amp;kmem.lock);
  if(r)
    memset((char*)r, 5, SUPERPGSIZE);
   // è¿ååéçè¶çº§é¡µå°å
  return (void*)r;
}
#endif
</code></pre>
<p>â	2ã<code>kalloc.h</code>å½ä¸­ï¼æä»¬ç»æ®éé¡µåéåå­æ¶ç¨å°äº<code>PGROUNDUP</code>ï¼äºæ¯è¶çº§é¡µçåå­åéä¹éè¦ç±»ä¼¼çåå®¹ãæä»¬é¡ºè¾æ¸çæ¾å°<code>riscv.h</code>ï¼å¨éé¢ä»¿ç§<code>PGROUNDUP</code>å<code>PGROUNDDOWN</code>ï¼æ°å¢<code>SUPERPGROUNDUP</code>å<code>SUPERPGROUNDDOWN</code>ã</p>
<pre><code class="language-c">#define SUPERPGROUNDUP(sz)  (((sz)+SUPERPGSIZE-1) &amp; ~(SUPERPGSIZE-1))
#define SUPERPGROUNDDOWN(a) (((a)) &amp; ~(SUPERPGSIZE-1)) 
</code></pre>
<p>â	3ãå¨<code>defs.h</code>ä¸­æ·»å ä¸åæçæ°å¢çå£°æã</p>
<pre><code class="language-c">void *          superalloc(void);
void            superfree(void *pa);
pte_t *         superwalk(pagetable_t, uint64, int, int *);
</code></pre>
<p>â	<strong>æ¥ä¸æ¥çåå®¹é½å¨kernel/vm.cå½ä¸­å®ç°</strong>ã</p>
<p>â	4ãæ·»å <code>uvmalloc</code>å½æ°ã</p>
<pre><code class="language-c">uint64
uvmalloc(pagetable_t pagetable, uint64 oldsz, uint64 newsz, int xperm)
{
  char *mem;
  uint64 a;
  int sz;

  if(newsz &lt; oldsz)
    return oldsz;

  oldsz = PGROUNDUP(oldsz);
  for(a = oldsz; a &lt; newsz; a += sz){
    sz = PGSIZE;
#ifdef LAB_PGTBL
    //å¤æ­å½åå¤§å°æ¯å¦æ»¡è¶³ä½¿ç¨è¶çº§é¡µçå¼é
    if (newsz - a &gt;= SUPERPGSIZE &amp;&amp; a % SUPERPGSIZE == 0) {
      //æ´æ°å¤§å°ä¸ºè¶çº§é¡µæ¹ä¾¿æ¥ä¸æ¥çéå¢
      sz = SUPERPGSIZE;
      //åéè¶çº§é¡µå¤§å°çç©çåå­
      mem = superalloc();
    } else
#endif
    mem = kalloc();
    if(mem == 0){
      uvmdealloc(pagetable, a, oldsz);
      return 0;
    }
#ifndef LAB_SYSCALL
    memset(mem, 0, sz);
#endif
    //ç»åéçé¡µæ·»å æ å°
    if(mappages(pagetable, a, sz, (uint64)mem, PTE_R|PTE_U|xperm) != 0){
#ifdef LAB_PGTBL
       // å¦æåéçæ¯è¶çº§é¡µå¤§å°åå­åéæ¾è¶çº§é¡µåå­
      if(sz == SUPERPGSIZE)
        superfree(mem);
      else
#endif
      kfree(mem);
      uvmdealloc(pagetable, a, oldsz);
      return 0;
    }
  }
  return newsz;
}
</code></pre>
<p>â	5ãä¿®æ¹<code>mappages</code>å½æ°ã</p>
<pre><code class="language-c">int
mappages(pagetable_t pagetable, uint64 va, uint64 size, uint64 pa, int perm)
{
  uint64 a, last;
  pte_t *pte;

  if((va % PGSIZE) != 0)
    panic("mappages: va not aligned");

  if((size % PGSIZE) != 0)
    panic("mappages: size not aligned");

  if(size == 0)
    panic("mappages: size");
  
  a = va;
  last = va + size - PGSIZE;
  for (;;) {
#ifdef LAB_PGTBL
    int use_superpage = 0; // ç¨äºæ è¯æ¯å¦ä½¿ç¨è¶çº§é¡µé¢æ å°
    // å¤æ­æ¯å¦å¯ä»¥ä½¿ç¨è¶çº§é¡µé¢æ å°
    if ((a % SUPERPGSIZE) == 0 &amp;&amp; (a + SUPERPGSIZE &lt;= last + PGSIZE) &amp;&amp; (perm &amp; PTE_U)) {
      use_superpage = 1; // æ´æ¹æ è¯
    }
    // å¦ææ¯è¶çº§é¡µåè®¾ç½®lä¸º1ï¼ä»£è¡¨æ¥ä¸æ¥å¨superwalkå½ä¸­å°1å±ååæ­¢
    // ä¼ ç»çwalkä¼èµ°å°level0ï¼ä¹åè¿åpteï¼é¡µè¡¨é¡¹å°åï¼
    // èæ¹è¿è¿çsuperwalkå¯ä»¥è¢«äººä¸ºææ§åå°æå®çå±çº§ã
    //  å±çº§ä»é«å°åºä¸ºï¼2 1 0
    if (use_superpage) {
      int l = 1;
      if ((pte = superwalk(pagetable, a, 1, &amp;l)) == 0)
        return -1;
    } else {
      if ((pte = walk(pagetable, a, 1)) == 0)
        return -1;
    }
#else 
    // å¦æä¸è½ä½¿ç¨è¶çº§é¡µé¢æ å° å°±ç¨æ®éé¡µ
    if ((pte = walk(pagetable, a, 1)) == 0)
      return -1;
#endif
    // æ£æ¥PTEæ¯å¦å·²ç»è¢«æ è®°ä¸ºææ
    if (*pte &amp; PTE_V)
      panic("mappages: remap");
    // å¦æææåå°ç©çå°åè½¬æ¢ä¸ºPTEæ ¼å¼ å¹¶å ä¸æéä½åææä½
    // è¿éå°±æ¯æ·»å æ å°çæ ¸å¿
    *pte = PA2PTE(pa) | perm | PTE_V; 
#ifdef LAB_PGTBL
    //å¦æä½¿ç¨è¶çº§é¡µ
    if (use_superpage) { 
      // åæ£æ¥æ¯å¦å·²ç»æ å°å°æåä¸ä¸ªè¶çº§é¡µé¢
      if (a + SUPERPGSIZE == last + PGSIZE) 
        break;
      // æ´æ°èµ·å§å°ååç©çå°å
      a += SUPERPGSIZE;
      pa += SUPERPGSIZE;
    } else {
      if (a == last)
        break;
      a += PGSIZE;
      pa += PGSIZE;
    }
#else 
    //ä¸ä½¿ç¨è¶çº§é¡µï¼åæ¯æ¬¡èªå¢ä¸ä¸ªæ®éé¡µçå¤§å°
    if (a == last)
      break;
    a += PGSIZE;
    pa += PGSIZE;
#endif
    }
    return 0;
}
</code></pre>
<p>â	6ãä¿®æ¹<code>uvmunmap</code>å½æ°ã</p>
<p><strong>æ³¨æï¼</strong>å¨éæ¾æ´ä¸ªé¡µæ¶æ¶åä¸ç§æåµï¼é¡µåªä¼å¨å¶å¯¹åºçèæå°åè¢«å®å¨ unmap æ¶è¢«éæ¾ï¼ï¼</p>
<ol>
<li>ç¬¬ä¸ç§æåµæ¯éæ¾æ®éé¡µï¼å·²ç¥æ¯ä¸ªæ®éé¡µé½æ¯4KBï¼å¹¶ä¸xv6çä¸çº§é¡µè¡¨çæä½çº§ä¹é½æ¯4KBï¼æä»¥ç´æ¥éæ¾å³å¯ã</li>
<li>ç¬¬äºç§æåµæ¯éæ¾è¶çº§é¡µï¼æ´åéæ¾ï¼ï¼è¶çº§é¡µçå¤§å°ä¸º2Mï¼å ä¸ºxv6çä¸çº§é¡µè¡¨çç¬¬äºå±æ¯è¡¨ç¤ºè¶çº§é¡µçå±çº§ï¼å¦æç¬¬äºå± PTE æ¯ leaf å¹¶ä¸è¦ç 2MBï¼åæ¯è¶çº§é¡µï¼ï¼æ­¤æ¶å¨å°åå¯¹å¶çæåµä¸å¹¶ä¸éæ¾è¯¥é¡µä¸ä¼å¯¹å¶å®çé¡µé æå½±ååç´æ¥éæ¾å³å¯ã</li>
<li>ç¬¬ä¸ç§æåµæ¯éæ¾è¶çº§é¡µï¼éæ´åéæ¾ï¼å¯è½æ¯ä¸åå°ä¹å¯è½æ¯ä¸åå¤§ï¼ï¼ä¼æå¨ç¥ï¼å¨æä½ç³»ç»å½ä¸­ï¼ä¸ä¸ª leaf PTE è¦ä¹æ å°æ´ä¸ª 4KB é¡µæ¡ï¼è¦ä¹æ å°æ´ä¸ª 2MB é¡µæ¡ï¼ä¸è½åªæ å°å¶ä¸­ä¸é¨åãæä»¥ï¼å½æä»¬éæ¾åå­æ¶ï¼è¢«éæ¾çåå­å¤§å°æ²¡æè¶è¿ä¸ä¸ªè¶çº§é¡µ æè è¶è¿äºä¸ä¸ªè¶çº§é¡µï¼é£ä¹å°±å¿ç¶å¯¼è´æä¸ä¸ªé¡µçå®æ´æ§è¢«æç ´ï¼ä»èè¿åæä½ç³»ç»å¯¹åä¸ªé¡µå®æ´æ§çè§å®ãæä»¥æä»¬è¦å°åªäºè¢«ç ´åäºå®æ´æ§çè¶çº§é¡µè¿è¡éçº§æä½ï¼ä½¿å¾å¶éä¸ºæ®éé¡µãéçº§çè¿ç¨å°±æ¯åå¼è¾æ°çæ®éé¡µï¼ç¶åå°åæ¥è¶çº§é¡µçåå®¹ï¼æ­£å¸¸å­å¨æ ééæ¾çåå®¹ï¼å¤å¶å°æ°çæ®éé¡µï¼ä¹åæä»¬å é¤/éæ¾åæ¥çè¶çº§é¡µã</li>
</ol>
<p><strong>é®ï¼</strong>ä¸ºä»ä¹2MBçè¶çº§é¡µçå®æ´æ§è¢«ç ´ååå°±å¿é¡»éçº§ä¸º4KBçæ®éé¡µï¼<br>
<strong>ç­ï¼</strong>xv6æ¯æ3çº§é¡µè¡¨ï¼æ®éé¡µï¼4KBï¼å·²ç»æ¯æå°çç¡¬ä»¶æ å°ç²åº¦ï¼ä¸è½åç»åï¼æä»¥ä¸å­å¨âæ®éé¡µè¢«é¨åç ´åååéçº§âçé®é¢ã</p>
<pre><code class="language-c">void
uvmunmap(pagetable_t pagetable, uint64 va, uint64 npages, int do_free)
{
  uint64 a;
  pte_t *pte;
  int sz;

  if((va % PGSIZE) != 0)
    panic("uvmunmap: not aligned");

  for(a = va; a &lt; va + npages*PGSIZE; a += sz){
    sz = PGSIZE;
#ifdef LAB_PGTBL
    int l = 0; // æ å¿åé ç¨äºç¡®å®æ¯è¶çº§é¡µè¿æ¯æ®éé¡µã
    int flag = 0; // æ è®°æ¯å¦å·²ç»å¤çè¿è¶çº§é¡µ
    if((pte = superwalk(pagetable, a, 0, &amp;l)) == 0)
      panic("uvmunmap: walk");
#else
    if((pte = walk(pagetable, a, 0)) == 0)
      panic("uvmunmap: walk");
#endif
    if((*pte &amp; PTE_V) == 0) {
      printf("va=%ld pte=%ld\n", a, *pte);
      panic("uvmunmap: not mapped");
    }
    if(PTE_FLAGS(*pte) == PTE_V)
      panic("uvmunmap: not a leaf");
    
    /*ä¸é¢å¼å§è§£é¤é¡µé¢æ å°*/
    if(do_free){
      uint64 pa = PTE2PA(*pte); //  ä»é¡µè¡¨é¡¹ä¸­æåç©çå°å
#ifdef LAB_PGTBL
      if(l == 1) { 
        // å¦ææ¯è¶çº§é¡µåè·åæé
        int perm = *pte &amp; 0xFFF;
        // ç¶åæ¸ç©ºé¡µè¡¨é¡¹
        *pte = 0; 
        // è®¾ç½®æ å¿
        flag = 1; 
        // æ´æ°å¤§å°ä¸ºè¶çº§é¡µå¤§å°
        sz = SUPERPGSIZE;
        // è¿éæ¯ä¸è¿°çç¬¬ä¸ç§æåµï¼å¦æèæå°åæªå¯¹é½å°è¶çº§é¡µ
        if(a % SUPERPGSIZE != 0){ 
          // å¯¹é½å°è¶çº§é¡µè¾¹ç
          for(uint64 i = SUPERPGROUNDDOWN(a); i &lt; va; i += PGSIZE) {
            char *mem = kalloc(); // åéæ°çç©çé¡µé¢
            if(mem == 0)
              panic("uvmunmap: kalloc");
            mappages(pagetable, i, PGSIZE, (uint64)mem, perm); // å°æ°åéçé¡µé¢æ å°å°èæå°åç©ºé´
            memmove(mem, (char*)pa + i - SUPERPGROUNDDOWN(a), PGSIZE); // å°æ°æ®ä»è¶çº§é¡µå¤å¶å°æ°åéçé¡µé¢
          }
          a = SUPERPGROUNDUP(a); // æ´æ°èæå°å
          sz = 0; // æ´æ°å¤§å°
        }
        superfree((void*)pa); // éæ¾è¶çº§é¡µ
      } else
#endif
      // å¦ææ¯æ®éé¡µ
      kfree((void*)pa); // éæ¾æ®éé¡µ
    }
#ifdef LAB_PGTBL
    if(flag == 0) // é¿åä½¿ç¨è¶çº§é¡µæ¶åè¢«éå¤æ¸é¤
#endif
    *pte = 0;
  }
}
</code></pre>
<p>â	7ãä»¿ç§<code>walk</code>æ·»å <code>superwalkã</code></p>
<pre><code class="language-c">#ifdef LAB_PGTBL
// åæ°lç¨äºæå®é¡µè¡¨çèµ·å§çº§å«
pte_t *
superwalk(pagetable_t pagetable, uint64 va, int alloc, int *l)
{
  if(va &gt;= MAXVA)
    panic("superwalk");

  for(int level = 2; level &gt; *l; level--) {
    // è·åå½åå±çé¡µè¡¨é¡¹å°å
    pte_t *pte = &amp;pagetable[PX(level, va)]; 
    if(*pte &amp; PTE_V) { 
      // å¦æé¡µè¡¨é¡¹ææ,å°å¶è½¬ä¸ºç©çå°å
      pagetable = (pagetable_t)PTE2PA(*pte); 
      if(PTE_LEAF(*pte)) { 
        // å¦ææ¯å¶èç¹ä»£è¡¨æ¾å°æ³è¦çäºï¼æ´æ°é¡µè¡¨çº§å«ï¼è¿åé¡µè¡¨å°åã
        *l = level;
        return pte;
      }
    } else {
      //é¡µè¡¨é¡¹æ æåå°è¯åéï¼åéå¤±è´¥è¿å0
      if(!alloc || (pagetable = (pde_t*)kalloc()) == 0) 
        return 0;
      // åå§åæ°åéçé¡µè¡¨
      memset(pagetable, 0, PGSIZE);
      // æ´æ°é¡µè¡¨é¡¹ä¸ºææ
      *pte = PA2PTE(pagetable) | PTE_V; 
    }
  }
  // è¿åç®æ é¡µè¡¨é¡¹å°å
  return &amp;pagetable[PX(*l, va)]; 
}
#endif
</code></pre>
<p>â	8ãæ·»å <code>uvmcopy</code>å½æ°ã</p>
<pre><code class="language-c">int
uvmcopy(pagetable_t old, pagetable_t new, uint64 sz)
{
  pte_t *pte;
  uint64 pa, i;
  uint flags;
  char *mem;
  int szinc;

  for(i = 0; i &lt; sz; i += szinc){
    szinc = PGSIZE;
#ifdef LAB_PGTBL
    int l = 0; // æ å¿åé ç¨äºç¡®å®æ¯æ®éé¡µè¿æ¯è¶çº§é¡µ
    if((pte = superwalk(old, i, 0, &amp;l)) == 0)
      // å¦ææ¯è¶çº§é¡µl=1,æ®éé¡µl=0
      panic("uvmcopy: pte should exist");
#else
    if((pte = walk(old, i, 0)) == 0)
      panic("uvmcopy: pte should exist");
#endif
    if((*pte &amp; PTE_V) == 0)
      panic("uvmcopy: page not present");
    pa = PTE2PA(*pte);
    flags = PTE_FLAGS(*pte);
#ifdef LAB_PGTBL
    if(l == 1) { 
      // å¦ææ¯è¶çº§é¡µåå°å°åå¢éè®¾ç½®ä¸ºè¶çº§é¡µçå¤§å°
      szinc = SUPERPGSIZE;
      // åéè¶çº§é¡µå¤§å°çåå­
      if((mem = superalloc()) == 0)
        goto err;
      // å°è¶çº§é¡µå¤§å°çç©çåå­ä»æ§å°åå¤å¶å°æ°åéçåå­å°åï¼ç¶è¿ç¨çæ°æ®è´è´£ç»å­è¿ç¨ï¼
      memmove(mem, (char*)pa, SUPERPGSIZE); 
      // å°è¶çº§é¡µå¤§å°çæ°åå­æ å°å°æ°é¡µè¡¨çèæå°å
      if(mappages(new, i, SUPERPGSIZE, (uint64)mem, flags) != 0){ 
        // éæ¾ä¹ååéçè¶çº§é¡µåå­
        superfree(mem); 
        goto err;
      }
    } else { 
      // å¦ææ¯æ®éé¡µ
#endif
    if((mem = kalloc()) == 0)
      goto err;
    memmove(mem, (char*)pa, PGSIZE);
    if(mappages(new, i, PGSIZE, (uint64)mem, flags) != 0){
      kfree(mem);
      goto err;
    }
#ifdef LAB_PGTBL
    }
#endif
  }
  return 0;

 err:
  uvmunmap(new, 0, i / PGSIZE, 1);
  return -1;
}
</code></pre>
<h2 id="åå¨åé¢">åå¨åé¢</h2>
<p>â	è¿ä¸labï¼å°¤å¶æ¯æåç<strong>ç¨æ·é¡µè¡¨lab</strong>ç¡®å®éå¸¸é¾ï¼ä¸å¼å§è±è´¹äºå¥½é¿æ¶é´é½æ²¡ååºæ¥ï¼å¥½å¨ç½ç»ä¸æå¾å¤å¤§ä½¬å¯¹è¯¥labè¿è¡äºè®²è§£åæä¾äºæåä»£ç ï¼ä½¿å¾æ¬äººå¨åç»­çç ç©¶ä¸­æå¾ä»¥æç½è¯¥labçåºå±é»è¾ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.002777777777777778" data-date-updated="2026-02-09 21:25">2026-02-09 21:21</span>&nbsp;
<a href="https://www.cnblogs.com/xiaobai1523">å°ç½åå­¦_C</a>&nbsp;
éè¯»(<span id="post_view_count">22</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19596981);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19596981', targetLink: 'https://www.cnblogs.com/xiaobai1523/p/19596981', title: 'Lab3-page tables  &amp;amp;&amp;amp; MIT6.1810æä½ç³»ç»å·¥ç¨ãæç»­æ´æ°ã' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å½äº§AIç¼ç¨å·¥å·Skillçæè½åæµè¯ï¼CodeBuddy VS Trae ]]></title>
    <link>https://www.cnblogs.com/haibindev/p/19596593</link>
    <guid>6ff13c3abd6ec0df1605133e3b27faba</guid>
    <description>
    <![CDATA[ 
	<div class="postTitle">
		<h1><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/haibindev/p/19596593" title="åå¸äº 2026-02-09 18:28">
    <span role="heading" aria-level="2">å½äº§AIç¼ç¨å·¥å·Skillçæè½åæµè¯ï¼CodeBuddy VS Trae</span>
    

</a>
</h1>
	</div>
	    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209182637956-413663675.png" alt="å½äº§AIç¼ç¨å·¥å·Skillçæè½åæµè¯ï¼CodeBuddy VS Trae" class="desc_img">
        å½äº§AIç¼ç¨å·¥å·Skillè½åå¤§å¯¹å³ï¼CodeBuddy vs Trae
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="å½äº§aiç¼ç¨å·¥å·skillçæè½åæµè¯codebuddy-vs-trae">å½äº§AIç¼ç¨å·¥å·Skillçæè½åæµè¯ï¼CodeBuddy vs Trae</h1>
<blockquote>
<p><strong>åå¨åé¢</strong></p>
<ul>
<li><strong>éåäººç¾¤</strong>ï¼AI ç¼ç¨æ¢ç´¢èãå·¥å·æçæ§ãæ³ç¨ AI è§£å³å¤æä»»å¡çå¼åèã</li>
<li><strong>éè¯»å¥æº</strong>ï¼ä½ ææ¡ CodeBuddy/Trae å´åªç¨æ¥åç®åèæ¬ï¼æ³ç¥éå®ä»¬å¤çå¤æ Agent ä»»å¡ççå®ä¸éã</li>
<li><strong>æ ¸å¿æ¶è·</strong>ï¼çå®çâç­è§é¢çæ Agentâå¼åå®å½ï¼åå«è¸©åç»èï¼éä»£ç çæ®µï¼ãåºå±é»è¾åæåæªæ¥ Agent ç¼ç¨çæèã</li>
</ul>
</blockquote>
<h2 id="1-å¼è¨ä»ä»¥äººä¸ºæ¬å°äººæºå±çççäº§åè·è¿">1. å¼è¨ï¼ä»"ä»¥äººä¸ºæ¬"å°"äººæºå±ç"ççäº§åè·è¿</h2>
<p>å¨è¿å»çä¸å¹´éï¼æä»¬è§è¯äº AI ç¼ç¨å·¥å·ä»ç®åç"ä»£ç è¡¥å¨"ï¼Copilotï¼è¿åå°äº"èªä¸»æ§è¡"ï¼Agentï¼ãè¿ç§è¿åèåçæ ¸å¿ï¼æ¯æä»¬å¯¹<strong>çäº§å</strong>å®ä¹çéæã</p>
<p>è¦éè¿ AI æåä¸ªäººçäº§åï¼æä»¬éè¦åæ¸ä¸ä¸ªå³é®æ¦å¿µï¼<strong>å·¥ä½æµ (Workflow)</strong>ã<strong>æè½ (Skill)</strong> å <strong>Agent (æºè½ä½)</strong>ã</p>
<ul>
<li>
<p><strong>å·¥ä½æµ (Workflow)</strong>ï¼æ¯æäºç"å°å¾"ãå®å®ä¹äºä»èµ·ç¹ï¼éæ±ï¼å°ç»ç¹ï¼äº¤ä»ï¼çæ ååè·¯å¾ï¼SOPï¼ãæ²¡æå·¥ä½æµï¼AI åªè½åç¹ç¶çè¾å©ï¼æäºå·¥ä½æµï¼AI æè½ä¸²èèµ·é¾ç¶çä»·å¼ã</p>
</li>
<li>
<p><strong>æè½ (Skill)</strong>ï¼æ¯å·¥ä½æµä¸­å¯æ§è¡ç"åå­åå"ãå°±åä¸ä¸ª Python å½æ°æä¸ä¸ª Shell èæ¬ï¼å®æ¯è¢«å°è£å¥½çè½ååã</p>
</li>
<li>
<p><strong>Agent (æºè½ä½)</strong>ï¼åæ¯è¿æ¥æå¾ä¸å®ç°ç"æ¡¥æ¢"ãå¨ Agent æ¶ä»£ï¼æä»¬ä¸ååªæ¯åä»£ç ï¼èæ¯å¨<strong>ç¼åæè½</strong>ï¼è®© Agent æ ¹æ®æä»¬çèªç¶è¯­è¨æè¿°ï¼èªå¨çæè½å®æç¹å®ä»»å¡ç Skillã</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301441-1806002280.png" alt="Agentæ¦å¿µéå­å¡" loading="lazy"></p>
<p><strong>å®ä»¬çå³ç³»æ¯ï¼Agent æ¯æä»¬æä¸­çææ¥å®ï¼æä»¬ç¨å®ç¼ååºä¸ä¸ªä¸ª Skillï¼æç»ç»è£æé«æç Workflowã</strong></p>
<p>ä»å¤©ï¼æä»¬å°±æ¥ä¸åºå®æå¯¹å³ãççä¸¤æ¬¾å½äº§ AI ç¼ç¨å·¥å·ââ<strong>CodeBuddy</strong> å <strong>Trae</strong>ï¼å¨"ç¼å Skill"è¿ä¸æ ¸å¿è½åä¸ï¼ç©¶ç«è°æ´èä¸ç­¹ã</p>
<h2 id="2-èé¢åå»ºä¸ä¸ªç­è§é¢çæ-agent">2. èé¢ï¼åå»ºä¸ä¸ª"ç­è§é¢çæ Agent"</h2>
<p>ä¸ºäºæµè¯ä¸éï¼ææ²¡æéæ©å"è´ªåè"è¿ç§ç®åä»£ç ï¼èæ¯è®¾è®¡äºä¸ä¸ªç¨å¾®å¤æç¹ç<strong>å¤æ­¥éª¤ Agent ä»»å¡</strong>ã</p>
<p><strong>ä»»å¡ç®æ </strong>ï¼ç¼åä¸ä¸ª Skillï¼è®©ç¨æ·è¾å¥ä¸ä¸ªè¯é¢ï¼å¨èªå¨çæä¸ä¸ªç­è§é¢ã</p>
<p><strong>æ ¸å¿æµç¨ (Pipeline)</strong>ï¼</p>
<ol>
<li>
<p><strong>åæç­å</strong>ï¼æ ¹æ®ç¨æ·è¯é¢ï¼ç»åé¢è®¾ä¸»é¢ï¼çæç­è§é¢èæ¬ååéææ¡ã</p>
</li>
<li>
<p><strong>è§è§è®¾è®¡</strong>ï¼æ ¹æ®åéåå®¹ï¼çæ AI ç»ç»æç¤ºè¯ã</p>
</li>
<li>
<p><strong>ç´ æçäº§</strong>ï¼è°ç¨ç»å¾æ¥å£çæå¾çï¼çæè¯­é³ã</p>
</li>
<li>
<p><strong>è§é¢åæ</strong>ï¼å°å¾çãè¯­é³ãå­å¹èªå¨åªè¾åææç»è§é¢ã</p>
</li>
</ol>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301418-369916563.png" alt="Video Agent Pipeline" loading="lazy"></p>
<p>ä¹åæå¨æ£å­ä¸ç¨å·¥ä½æµçå½¢å¼ï¼æè¿è¿ä¸å¥ï¼æä»¥ä»å¤©æ´åæ³è¯è¯åä¸ä¸ªè¿ä¸ªçskillï¼æ¯æ­å·¥ä½æµå¿«å¤å°<br>
<img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301376-1135383258.png" alt="æ£å­å·¥ä½æµ" loading="lazy"></p>
<p>è¿ä¸ä»èå¯ä»£ç çæè½åï¼æ´èå¯å·¥å·å¯¹<strong>å¤æä¸å¡é»è¾</strong>ççè§£ã<strong>å¤æä»¶å·¥ç¨</strong>çç»ç»ä»¥å<strong>éè¯¯å¤ç</strong>è½åã</p>
<hr>
<h2 id="3-ç¬¬ä¸ååcodebuddy--æéä½ç¥æ¾ç²ç³çç´è§æ´¾">3. ç¬¬ä¸ååï¼CodeBuddy ââ æéä½ç¥æ¾ç²ç³ç"ç´è§æ´¾"</h2>
<p>CodeBuddy ç»æçç¬¬ä¸å°è±¡æ¯<strong>å¿«</strong>ã</p>
<h3 id="31-åå»ºè¿ç¨">3.1 åå»ºè¿ç¨</h3>
<p>æè¾å¥äºå®æ´ç Promptï¼CodeBuddy è¿éçè§£äºæå¾ï¼å¹¶å¼å§åå»º Skill ä»»å¡ã</p>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301353-1434975961.jpg" alt="Skillåå»º" loading="lazy"></p>
<p>å®é¦ååå»ºäºä¸ä¸ª <code>README.md</code> ææ¡£æ¥æ¢³çæè·¯ï¼è¿ç¹å¥½è¯ã</p>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301382-1126659275.jpg" alt="ææ¡£åè¡" loading="lazy"></p>
<p>ç´§æ¥çï¼å®å¨ 5 åéåå°±å®æäºä»£ç ç¼åï¼å¹¶æç¤ºæå¯ä»¥å¼å§æµè¯ãè¿å¯æ¯æ­å·¥ä½æµå¿«å¤äºã</p>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301358-886069795.jpg" alt="æéå®æ" loading="lazy"></p>
<h3 id="32-ç»æåæ">3.2 ç»æåæ</h3>
<p>ä½å¨ä»£ç å®¡æ¥åå®éè¿è¡ä¸­ï¼æåç°äºä¸äºé®é¢ï¼</p>
<ol>
<li>
<p><strong>ç»æè¿äºç®å</strong>ï¼æ´ä¸ª Skill çæä»¶ç»æéå¸¸æå¹³ï¼ç¼ºä¹æ¨¡ååè®¾è®¡ã</p>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301371-2005704407.jpg" alt="ç»æç®å" loading="lazy"></p>
<p>çæçå·¥ç¨ç®å½éå¸¸"æ¸ç½"ï¼ä½ä¹æ´é²äºé»è¾çåèï¼</p>
<pre><code class="language-text">/project
âââ main.py          # ä¸»é»è¾
âââ utils.py         # å·¥å·å½æ°
âââ requirements.txt # ä¾èµ
âââ README.md        # è¯´æææ¡£
</code></pre>
</li>
<li>
<p><strong>Hardcode é®é¢</strong>ï¼æè´å½çæ¯ï¼å®å°çæè§é¢ç Prompt <strong>åæ­»</strong>å¨èæ¬éäºï¼æ²¡ææ ¹æ®ç¨æ·è¾å¥å¨æçæã</p>
<p>æå¨æ£æ¥ <code>main.py</code> æ¶åç°äºè¿æ ·å°´å°¬çä»£ç ï¼</p>
<pre><code class="language-python"># CodeBuddy çæçä»£ç çæ®µ
def generate_script(topic):
    # éè¯¯ï¼æ è®ºç¨æ·è¾å¥ä»ä¹ topicï¼æç¤ºè¯éç theme é½æ¯åºå®ç
    prompt = "åä¸ä¸ªå³äºãäººå·¥æºè½ãçç­è§é¢èæ¬..." 
    return call_llm(prompt)
</code></pre>
<p>è¿é¤äºé ææ¹å¨ä¸æ¹ä¾¿ï¼ä¹æå³çå®éåæäºä¸ä¸ª"æ¨¡æ¿å¡«åæº"ï¼èéçæ­£ç Agentã</p>
</li>
<li>
<p><strong>é£æ ¼å¹»è§</strong>ï¼çæçè§é¢é£æ ¼ä¸å¯æ§ï¼æåä¸ä¸ªå¾çï¼å±ç¶åæäºæ¼«ç»é£ï¼èä¸ä¸ææ¡å¹éåº¦ä¸è¬ï¼å¥¶å¥¶å¢ï¼/emojiç¬ï¼ã</p>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301435-443009124.png" alt="é£æ ¼åå·®" loading="lazy"></p>
</li>
<li>
<p><strong>å­å¹ç¿»è½¦</strong>ï¼èªå¨ç§å½å­å¹å¤±è´¥ï¼ä¸å¾ä¸éè¿æ­æ¾å¨æè½½å¤æå­å¹ã</p>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301417-1410064111.png" alt="å­å¹å¤±è´¥" loading="lazy"></p>
</li>
</ol>
<p><strong>å°ç»</strong>ï¼CodeBuddy èµ¢å¨äºéåº¦åäº¤äºçæµçåº¦ï¼ä½å¨è§£å³å¤æé®é¢ç"ç²¾åº¦"å"å·¥ç¨å"ä¸ï¼è¿æå¾æç£¨ï¼èä¸ä¸­é´èæ¬éè¯¯è¿å¤ï¼ä»è±äºå¤§éæ¶é´å¨ä¿®å¤èæ¬éè¯¯ä¸ã</p>
<hr>
<h2 id="4-ç¬¬äºååtrae--ç¨³å¥ä½åæ ·æå±éçå·¥ç¨æ´¾">4. ç¬¬äºååï¼Trae ââ ç¨³å¥ä½åæ ·æå±éç"å·¥ç¨æ´¾"</h2>
<p>é¦åè¯´æä¸ä¸ï¼TraeCNè¦ä½¿ç¨skillè½åï¼å¿é¡»å¨âsoloæ¨¡å¼âï¼è¿ä¸ªæåµä¸ä»åºæ¬ä¸å¨é¢æ¥ç®¡ï¼ä½ è¦å¨æçæºä¼ä¸å¤ï¼æ´ä¸ªè¿ç¨é¡¶å¤ç¹ä¸ä¸¤æ¬¡ç¡®è®¤æé®ï¼è¿ä¸ªæ¯codeBuddyä½éªå¥½å¤äºã</p>
<h3 id="41-åå»ºè¿ç¨">4.1 åå»ºè¿ç¨</h3>
<p>Trae çç¬¬ä¸æ­¥æ¯ååºè¯¦ç»çä»»å¡æ¸åï¼è½ç¶å®æ²¡æå CodeBuddy é£æ ·ååææ¡£ï¼ä½å®çèæ¬æ°éææ¾æ´å¤ã</p>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301358-1004692129.jpg" alt="ä»»å¡æ¸å" loading="lazy"></p>
<p>å®è±è´¹äºçº¦ 4 åéå®æï¼çæäº 7 ä¸ªèæ¬æä»¶ï¼ä¸ä»æä¸»é»è¾ï¼è¿æä¸é¨çéç½®ãå·¥å·ç±»ï¼å·¥ç¨ç»æææ¾ä¼äº CodeBuddyã</p>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209195208953-570032885.jpg" alt="å·¥ç¨ç»æ" loading="lazy"></p>
<h3 id="42-ç»æåæ">4.2 ç»æåæ</h3>
<p>å®éè¿è¡ä¸æ¥ï¼Trae çäº®ç¹åæ§½ç¹å¹¶å­ï¼</p>
<ol>
<li>
<p><strong>å­å¹ç§å½æå</strong>ï¼è¿æ¯å®æ¯ CodeBuddy å¼ºçå°æ¹ï¼ffmpeg çåæ°è°æå¾æ´åï¼å­å¹å®ç¾ç§å½è¿è§é¢ã</p>
<p>æ¥ç <code>video_maker.py</code>ï¼åç°å®çæäºéå¸¸æ åç FFmpeg æ»¤éé¾ï¼</p>
<pre><code class="language-python">cmd = [
    "ffmpeg", "-i", input_video, 
    "-vf", f"subtitles={subtitle_file}:force_style='Fontname=SimHei,FontSize=24'",
    "-c:a", "copy", output_video
]
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301396-81113065.jpg" alt="å­å¹æå" loading="lazy"></p>
</li>
<li>
<p><strong>åæ ·çç¡¬ä¼¤</strong>ï¼ä»¤ææå¤çæ¯ï¼Trae åæ ·ç¯äº"æç¤ºè¯åæ­»"çéè¯¯ãçæ¥å¯¹äºå¤æç Prompt Engineering é»è¾ï¼ç®åç AI å¨æ²¡ææç¡®æå¼ä¸ï¼é½å¾åäºå·æã</p>
<p>å¨ <code>config.py</code> ä¸­ï¼ææ¾å°äºç½ªé­ç¥¸é¦ï¼</p>
<pre><code class="language-python"># Trae çéç½®æä»¶
VIDEO_PROMPT = "A futuristic city with flying cars..." # ç¡¬ç¼ç å¨éç½®é
</code></pre>
<p>èæ¬è¿å¤ï¼è½ç¶çæéåº¦å¿«äºï¼ä½æ¯å¤§æ¨¡åå©ç¨è½åä¸éï¼ç®åé®é¢å¤æåäºã</p>
</li>
<li>
<p><strong>ææ¡çæ</strong>ï¼æç¶ï¼Traeçæçææ¡å·®å¤äºï¼æ¾å¾æ¯è¾çç¡¬ï¼ä¹æ²¡ä»ä¹æé£ãå¯è½æ¯å ä¸ºå®æ Prompt ææ£å°äºä¸åæä»¶ï¼å¯¼è´ä¸ä¸æä¸¢å¤±ã</p>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301362-906782533.jpg" alt="ææ¡å¯¹æ¯" loading="lazy"></p>
</li>
<li>
<p><strong>å°ºå¯¸é®é¢</strong>ï¼çæçè§é¢å°ºå¯¸ä¸é¢ææåå·®ï¼æ¨ªç«å±å¤çä¸å¤æºè½ã</p>
<p><strong>TTS çè°ç¨ä¹ä¸å¦ CodeBuddy</strong>ãCodeBuddy è°ç¨äº <code>edge-tts</code> è¿ç§é«è´¨éåºï¼è Trae ä¼¼ä¹ç´æ¥è°ç¨äºç³»ç»åæ¬ç <code>pyttsx3</code>ï¼çæçè¯­é³æ¯å¾æºæ¢°åçï¼<strong>æ¯«æ ææè²å½©</strong>ãæè§æ¯åæ°æ²¡æè°éï¼æçè¯´ä¸¤ä¸ªé½åºè¯¥æ¯è°ç¨ç Windows æ¬å° TTSï¼ä½ææå¤©å·®å°å«ã</p>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301399-126502845.jpg" alt="å°ºå¯¸åå·®" loading="lazy"></p>
</li>
</ol>
<p><strong>å°ç»</strong>ï¼Trae å±ç°äºæ´å¥½ç<strong>ä»£ç ç»ç»è½å</strong>å<strong>åºå±å·¥å·æ§å¶å</strong>ï¼å¦ ffmpegï¼ï¼ä½å¨ä¸å¡é»è¾ï¼æç¤ºè¯çæï¼ççµæ´»æ§ä¸ï¼ä¾ç¶æ²¡æçªç ´ã</p>
<hr>
<h2 id="5-æç»å¤çä¸å±æ">5. æç»å¤çä¸å±æ</h2>
<h3 id="51-å¯¹æ¯æ»ç»">5.1 å¯¹æ¯æ»ç»</h3>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301472-1704466314.png" alt="è½åå¯¹æ¯é·è¾¾å¾" loading="lazy"></p>
<table>
<thead>
<tr>
<th style="text-align: left">ç»´åº¦</th>
<th style="text-align: left">CodeBuddy</th>
<th style="text-align: left">Trae</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>çæéåº¦</strong></td>
<td style="text-align: left">â¡ï¸ å¿« (&lt; 5min)</td>
<td style="text-align: left">ð è¾å¿« (&lt; 5min)</td>
</tr>
<tr>
<td style="text-align: left"><strong>å·¥ç¨ç»æ</strong></td>
<td style="text-align: left">ç®åï¼åæä»¶ä¸ºä¸»</td>
<td style="text-align: left">å¤æï¼æ¨¡åååç¦»</td>
</tr>
<tr>
<td style="text-align: left"><strong>ææ¡£ä¹ æ¯</strong></td>
<td style="text-align: left">â åå README</td>
<td style="text-align: left">â ç´æ¥åä»£ç </td>
</tr>
<tr>
<td style="text-align: left"><strong>åºå±æ§å¶</strong></td>
<td style="text-align: left">â å­å¹ç§å½å¤±è´¥</td>
<td style="text-align: left">â å­å¹ç§å½æå</td>
</tr>
<tr>
<td style="text-align: left"><strong>é»è¾çµæ´»æ§</strong></td>
<td style="text-align: left">â æç¤ºè¯ç¡¬ç¼ç </td>
<td style="text-align: left">â æç¤ºè¯ç¡¬ç¼ç </td>
</tr>
</tbody>
</table>
<h3 id="52-å¯ç¤º">5.2 å¯ç¤º</h3>
<p>è¿æ¬¡æµè¯ä¸ä»æ¯å¯¹å·¥å·çç¥é­ï¼æ´æ¯å¯¹æä»¬ä½¿ç¨æ¹å¼çæéï¼</p>
<ol>
<li>
<p><strong>AI ä»é"å¼å¯¼"</strong>ï¼å³ä¾¿æ¯ Agent æ¨¡å¼ï¼å¯¹äº"æ ¹æ®è¯é¢å¨æçæ Prompt"è¿ç§åè®¤ç¥å±é¢çé»è¾ï¼AI å¾å¾ä¼çè§£æ"åä¸ä¸ªåºå®ç Prompt æ¨¡æ¿"ãæä»¬éè¦å¨ Prompt ä¸­æç¡®è¦æ±ï¼"è¯·ç¼åä¸ä¸ªå½æ°ï¼æ ¹æ®è¾å¥ç topic å¨æç»è£ prompt"ã</p>
</li>
<li>
<p><strong>Skill çä»·å¼</strong>ï¼è½ç¶ä¸¤ä¸ªå·¥å·çæç Skill é½ä¸å®ç¾ï¼ä½å®ä»¬é½å¤§å¤§éä½äºæä»¬å¼åå¤æåºç¨çé¨æ§ãè¿å»åè¿æ ·ä¸ä¸ªè§é¢çæå¨éè¦ä¸ä¸¤å¤©ï¼ç°å¨åªéè¦ 5 åéæ­æ¶å­ï¼å©ä¸çä¿®ä¿®è¡¥è¡¥å³å¯ã</p>
</li>
<li>
<p><strong>æªæ¥ç Agent</strong>ï¼çæ³ç Agent ç¼ç¨å·¥å·ï¼ä¸åºåªæ¯åä»£ç ï¼æ´åºè¯¥æ¯ä¸ä¸ª<strong>æ¶æå¸</strong>ã</p>
<p>å®åºè¯¥è½ä¸»å¨è¿è¡è¿æ ·çå¯¹è¯ï¼</p>
<blockquote>
<p><strong>Agent</strong>: "ææ£æµå°èæ¬éæä¸ä¸ª Prompt æ¯åæ­»çãè¯·é®è¿ä¸ª Prompt æ¯åºå®çï¼è¿æ¯éè¦æ ¹æ®ç¨æ·ç Topic å¨æçæï¼"<br>
<strong>User</strong>: "å¨æçæã"<br>
<strong>Agent</strong>: "å¥½çï¼é£æå°å¢å ä¸ä¸ª LLM è°ç¨å½æ°ï¼ä¸é¨ç¨äºçæ Promptã"</p>
</blockquote>
<p>ç°å¨çå·¥å·ï¼å¤ªæ¥äº"äº¤å·"äºï¼åèå°äºè¿ç§å³é®ç"éæ±æ¾æ¸"ã</p>
</li>
</ol>
<p><img src="https://img2024.cnblogs.com/blog/254714/202602/254714-20260209181301400-1756523778.png" alt="æªæ¥Agentæ¶æå¸" loading="lazy"></p>
<p>å¨ AI ç¼ç¨çä¸ååºï¼è°è½æ´å¥½å°çè§£<strong>ä¸å¡æµ (Workflow)</strong>ï¼è°å°±è½å®ä¹æ°æ¶ä»£ç<strong>ç¼ç¨æè½ (Skill)</strong>ã CodeBuddy å Traeï¼é½è¿å¨è·¯ä¸ã</p>
<hr>
<p><strong>ä½èç®ä»ï¼</strong> 10å¹´+è§é¢ææ¯ãåç§ç½ç»åè®®ãåç«¯ææ¯ãå¼åç»éªï¼æ¾ä»»æäºèç½å¤§åææ¯ä¸å®¶ãå¯¹AIç¼ç¨å·¥å·ãäºåçæ¶æãè§é¢å¤çææ¯ææ·±å¥ç ç©¶ã</p>
<p><img src="https://img2023.cnblogs.com/blog/254714/202307/254714-20230701143418754-1351786962.jpg" alt="" loading="lazy"></p>
<p><strong>åä½è¯·å WXï¼hbstream</strong><br>
<strong>ï¼<a href="http://haibindev.cnblogs.com" target="_blank">http://haibindev.cnblogs.com</a>ï¼ï¼è½¬è½½è¯·æ³¨æä½èååºå¤</strong></p>


</div>
<div class="clear"></div>

	<div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0.059027777777777776" data-date-updated="2026-02-09 19:53">2026-02-09 18:28</span>&nbsp;
<a href="https://www.cnblogs.com/haibindev">haibindev</a>&nbsp;
éè¯»(<span id="post_view_count">153</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19596593);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19596593', targetLink: 'https://www.cnblogs.com/haibindev/p/19596593', title: 'å½äº§AIç¼ç¨å·¥å·Skillçæè½åæµè¯ï¼CodeBuddy VS Trae' })">ä¸¾æ¥</a>
</div>
 ]]>
    </description>
    </item>
        </channel>
        </rss>