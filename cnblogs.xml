<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-09T04:24:49.908Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ C++å°ç½è®­ç»ç¬¬åä¸å¤© ]]></title>
    <link>https://www.cnblogs.com/godjian/p/19594585</link>
    <guid>146724f09c15d6b6d2cb69a20f8de96d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/godjian/p/19594585" title="åå¸äº 2026-02-09 12:13">
    <span role="heading" aria-level="2">C++å°ç½è®­ç»ç¬¬åä¸å¤©</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="cå°ç½è®­ç»ç¬¬åä¸å¤©">C++å°ç½è®­ç»ç¬¬åä¸å¤©</h2>
<p>ä»¥ä¸ä¸ºçå®¢ææ</p>
<h2 id="ä»æ¥æ¶è·">ä»æ¥æ¶è·</h2>
<pre><code> vector&lt;pair&lt;int,int&gt;&gt;v;ç¨äºå­å¨åæ ï¼å¦æåæ ï¼
 æ¹å¼ï¼v.push_back({i,j}),v.emplace_back(i,j);
 
 v.push_back(make_pair(i, j));

dpèæ³çåä¸ä¸ªæ¡ä»¶ï¼å°±æ¯å ä¸ºéå¶åªå­å¨ä¸ç¸é»ï¼é£å°±ååé¢æ²¡æå³ç³»ï¼æä»¥èèdp


çè§£äºç½®æ¢ç¯ï¼n-ç¯æ°ç­äºæä½æ°ã
</code></pre>
<h2 id="çå®¢å¨èµ-round-130">çå®¢å¨èµ Round 130</h2>
<h3 id="çº¢ç¾éçè®¿å®¢ç»è®°">çº¢ç¾éçè®¿å®¢ç»è®°</h3>
<p><a href="https://ac.nowcoder.com/acm/contest/127702/A" target="_blank" rel="noopener nofollow">A-çº¢ç¾éçè®¿å®¢ç»è®°_çå®¢å¨èµ Round 130 (nowcoder.com)</a></p>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121302221-750510719.png" alt="image-20260209082136953" loading="lazy"></p>
<h4 id="è§£é¢ä»£ç ">è§£é¢ä»£ç </h4>
<pre><code class="language-c++">#include&lt;bits/stdc++.h&gt;
#define int long long
#define lll __uint128_t
#define PII pair&lt;int ,int&gt;
#define endl '\n'
using namespace std;
#define yn(ans) printf("%s\n", (ans)?"Yes":"No");//å¿«éæå°
#define YN(ans) printf("%s\n", (ans)?"YES":"NO");
#define REP(i, e) for (int i = 0; i &lt; (e); ++i)
#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)
#define TESTS int t; cin &gt;&gt; t; while (t--)
#define TEST
const int N=2e5+10,M=1e3+10,mod=1e9+7;
int a[N],b[N],c[N],pre[N];

signed main(){

	std::ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    string s;
    cin&gt;&gt;s;
    int count=0;
    for(int i=0;i&lt;s.size();i++){
        if(s[i]!='0'){
            count=i;
            break;
        }
    }
    for(int i=count;i&lt;s.size();i++){
        cout&lt;&lt;s[i];
    }
    

	return 0;
}
</code></pre>
<h3 id="ç±ä¸½ä¸çé­åé¶ä»¶åç±»">ç±ä¸½ä¸çé­åé¶ä»¶åç±»</h3>
<p><a href="https://ac.nowcoder.com/acm/contest/127702/B" target="_blank" rel="noopener nofollow">B-ç±ä¸½ä¸çé­åé¶ä»¶åç±»_çå®¢å¨èµ Round 130 (nowcoder.com)</a></p>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121303147-1985436397.png" alt="image-20260209084218695" loading="lazy"></p>
<pre><code>3
5
.....
.....
.***.
..*..
.....
5
.....
..*..
..*..
.**..
.....
6
......
..*...
.**...
..*...
......
......
</code></pre>
<pre><code>T
L
T
</code></pre>
<p><strong>é¢è§£</strong></p>
<h4 id="è§£é¢ä»£ç -1">è§£é¢ä»£ç </h4>
<p>å¯ä»¥åæè¿äºä¸º*çç¹åå­èµ·æ¥ï¼ç¶åå»å¤æ­ä»ä»¬çåº¦æ°åéå¾ªç¯ï¼æ¥å¤æ­ï¼å½æä»¬åç°æå¤åº¦æ°ä¸º3çæ¶åå°±å°±æ¯tï¼å¶ä»çå°±ä¸æ¯tï¼æ¯l</p>
<pre><code class="language-c++">#include&lt;bits/stdc++.h&gt;
#define int long long
#define lll __uint128_t
#define PII pair&lt;int ,int&gt;
#define endl '\n'
using namespace std;
#define yn(ans) printf("%s\n", (ans)?"Yes":"No");//å¿«éæå°
#define YN(ans) printf("%s\n", (ans)?"YES":"NO");
#define REP(i, e) for (int i = 0; i &lt; (e); ++i)
#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)
#define TESTS int t; cin &gt;&gt; t; while (t--)
#define TEST
const int N=2e5+10,M=1e3+10,mod=1e9+7;
int a[N],b[N],c[N],pre[N];
void solve(){
    int n;
    cin&gt;&gt;n;
    vector&lt;pair&lt;int,int&gt;&gt;v;
    for(int i=1;i&lt;=n;i++){
        for(int j=1;j&lt;=n;j++){
            char m;
            cin&gt;&gt;m;
            if(m=='*'){
                v.emplace_back(i,j);
            }
        }
    }
    int mx=0;
    for(auto [x,y]:v){
        int degree=0;
        for(auto [nx,ny]:v){
            if(abs(x-nx)+abs(y-ny)==1){
                degree++;
            }
        }
        mx=max(degree,mx);
    }
    if(mx==3){
        cout&lt;&lt;"T"&lt;&lt;endl;
    }else{
        cout&lt;&lt;"L"&lt;&lt;endl;
    }

};
signed main(){

	std::ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    TESTS{
        solve();
    };

	return 0;
}
</code></pre>
<h3 id="åä¸½å¤§ç»ççç¨³å®è½´å¿">åä¸½å¤§ç»ççç¨³å®è½´å¿</h3>
<p><a href="https://ac.nowcoder.com/acm/contest/127702/C" target="_blank" rel="noopener nofollow">C-åä¸½å¤§ç»ççç¨³å®è½´å¿_çå®¢å¨èµ Round 130 (nowcoder.com)</a></p>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121303545-355177775.png" alt="image-20260209090135699" loading="lazy"></p>
<pre><code>5
1 2
1 3
1 4
4 5
</code></pre>
<pre><code>4
</code></pre>
<p>æä»¬å¯ä»¥å»åæä¸ä¸äºåæ çç¹ç¹ï¼æ¯ä¸æ¯æå¤çèç¹æ°å¨3ä¸ªä»¥ä¸ï¼ä¸è¿ä¸ª3ä¸ªçèç¹ä¸ä¼ä½ä¸ºè½´å¿ç¹ã</p>
<p>ä¸¤ä¸ªçåä¸ä¸ªçé½å¯ä»¥ä½ä¸ºè½´å¿ç¹ã</p>
<p>æææä»¬å¯ä»¥å»åå¤æ­å°åºåªä¸ªæå¤§çç¹æ°æå¤å¤§ãå¤§äº3å°±ç´æ¥æ¯é¶ï¼å°äºç3å°±å¯ä»¥ä½ä¸ºè½´å¿ç¹ã</p>
<h4 id="è§£é¢ä»£ç -2">è§£é¢ä»£ç </h4>
<pre><code class="language-c++">#include&lt;bits/stdc++.h&gt;
#define int long long
#define lll __uint128_t
#define PII pair&lt;int ,int&gt;
#define endl '\n'
using namespace std;
#define yn(ans) printf("%s\n", (ans)?"Yes":"No");//å¿«éæå°
#define YN(ans) printf("%s\n", (ans)?"YES":"NO");
#define REP(i, e) for (int i = 0; i &lt; (e); ++i)
#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)
#define TESTS int t; cin &gt;&gt; t; while (t--)
#define TEST
const int N=2e5+10,M=1e3+10,mod=1e9+7;
int a[N],b[N],c[N],pre[N];

signed main(){

	std::ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    int n;
    cin&gt;&gt;n;
    vector&lt;vector&lt;int&gt;&gt;g(n+1);
    for(int i=1;i&lt;n;i++){
        int u,v;
        cin&gt;&gt;u&gt;&gt;v;
        g[u].push_back(v);
        g[v].push_back(u);
    }
    int mx=0;
    int ans=0;
    for(int i=1;i&lt;=n;i++){
        mx=max(mx,(int)g[i].size());
    }
    if(mx&lt;=3){
        for(int i=1;i&lt;=n;i++){
            if(g[i].size()&lt;=2){
                ans++;
            }
        }
    }
    cout&lt;&lt;ans&lt;&lt;endl;

	return 0;
}
</code></pre>
<h3 id="é­æ³äººå¶çåè¿å¶æ ¡å">é­æ³äººå¶çåè¿å¶æ ¡å</h3>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121303963-2021372242.png" alt="image-20260209094949846" loading="lazy"></p>
<pre><code>3
1 5
2 3
5 7
</code></pre>
<pre><code>1 2
1 3
3 7
</code></pre>
<p>é¦åæä»¬éè¿ææ ç¡®å®ä¸ä¸è§å¾ã</p>
<pre><code class="language-c++">for(double y=2;y&lt;=1000;y++){
	cout&lt;&lt;fixed&lt;&lt;setprecision(10)&lt;&lt;(1.0/y)&lt;&lt;endl;
}
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121304411-1460739702.png" alt="image-20260209095354057" loading="lazy"></p>
<p>å¯ä»¥åç°ç¹æ®ç</p>
<pre><code>1/9----ãå¾å°è¿ä¸ªã0.1111111ï¼è¿ä¸ªæä»¬å°±å¯ä»¥å»æé ä¸ä¸äºï¼ä½æ¯ï¼b/9

ç¶åç¹å¤å«çï¼åºä¸ºæ²¡æ9/9ï¼æä»¥æä»¬çå°0.9090...
æä»¬å¯ä»¥éè¿å¥å¶ä»£æ¢Ãä¸ä¸ª10å°±å¯ä»¥äºï¼æä»¬ç´æ¥9å¾å°è¿ä¸ªæ°.
ç¶åç¹å¤ä¸äº0ï¼åå¯ä»¥è¢«3ï¼6çæåµå°±è¡äº
</code></pre>
<h4 id="è§£é¢ä»£ç -3">è§£é¢ä»£ç </h4>
<pre><code class="language-c++">#include&lt;bits/stdc++.h&gt;
#define int long long
#define lll __uint128_t
#define PII pair&lt;int ,int&gt;
#define endl '\n'
using namespace std;
#define yn(ans) printf("%s\n", (ans)?"Yes":"No");//å¿«éæå°
#define YN(ans) printf("%s\n", (ans)?"YES":"NO");
#define REP(i, e) for (int i = 0; i &lt; (e); ++i)
#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)
#define TESTS int t; cin &gt;&gt; t; while (t--)
#define TEST
const int N=2e5+10,M=1e3+10,mod=1e9+7;

void solve(){
    int a,b;
    cin&gt;&gt;a&gt;&gt;b;
    if(b==0){
        if(a==1){
            cout&lt;&lt;1&lt;&lt;" "&lt;&lt;1000&lt;&lt;endl;
        }else{
            cout&lt;&lt;1&lt;&lt;" "&lt;&lt;2&lt;&lt;endl;
        }
        return;
    }else if(b==9){
        if(a%2){
            cout&lt;&lt;10&lt;&lt;" "&lt;&lt;11&lt;&lt;endl;
        }else{
            cout&lt;&lt;1&lt;&lt;" "&lt;&lt;11&lt;&lt;endl;
        }
        return;
    }
    if(b==3){
        cout&lt;&lt;1&lt;&lt;" "&lt;&lt;3&lt;&lt;endl;
        return;
    }
    if(b==6){
        cout&lt;&lt;2&lt;&lt;" "&lt;&lt;3&lt;&lt;endl;
        return;
    }
    cout&lt;&lt;b&lt;&lt;" "&lt;&lt;9&lt;&lt;endl;
};
signed main(){

	std::ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    TESTS{
        solve();
    };

	return 0;
}
</code></pre>
<h3 id="ç±ä¸½ä¸çäººå¶åèæ²">ç±ä¸½ä¸çäººå¶åèæ²</h3>
<p><a href="https://ac.nowcoder.com/acm/contest/127702/E" target="_blank" rel="noopener nofollow">E-ç±ä¸½ä¸çäººå¶åèæ²_çå®¢å¨èµ Round 130 (nowcoder.com)</a></p>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121304824-570108632.png" alt="image-20260209112816198" loading="lazy"></p>
<pre><code>abca
</code></pre>
<pre><code>1
</code></pre>
<p>å ä¸ºéå¶åªå­å¨ä¸ç¸é»ãæä»¬å°±å¯ä»¥å»èèdpçåæ³</p>
<p>è¿ä¸ªæ¯ä¸ä¸ªçº¿æ§dpçé¢ç®ï¼æä»¬å¯ä»¥å®ä¹ä¸ä¸ª</p>
<p>å ä¸ºdæ²¡æç¡®è®¤ï¼æä»¥æä»¬å»æä¸¾d</p>
<pre><code>f[i][j]---&gt;è¡¨ç¤ºåiä¸ªä½ç½®ååæ³ï¼ä¸si=jçæå°æ¬¡æ°

ä½ ä»¬è½¬ç§»å°±æ¯
minï¼f[i-1][(j-d+26)%26],f[(i+d)%26]ï¼+è¿ä¸ªæ°å°åºæ¯ä¸æ¯ç­äºjï¼ä¸ç­äºå°±è¦ç¨ä¸æ¬¡ï¼æååç®åºæå°å¼ã
</code></pre>
<h4 id="è§£é¢ä»£ç -4">è§£é¢ä»£ç </h4>
<pre><code class="language-c++">#include&lt;bits/stdc++.h&gt;
#define int long long
#define lll __uint128_t
#define PII pair&lt;int ,int&gt;
#define endl '\n'
using namespace std;
#define yn(ans) printf("%s\n", (ans)?"Yes":"No");//å¿«éæå°
#define YN(ans) printf("%s\n", (ans)?"YES":"NO");
#define REP(i, e) for (int i = 0; i &lt; (e); ++i)
#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)
#define TESTS int t; cin &gt;&gt; t; while (t--)
#define TEST
const int N=2e5+10,M=1e3+10,mod=1e9+7;
int a[N],b[N],c[N],pre[N];

signed main(){

	std::ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    string s;
    cin&gt;&gt;s;

    int n=s.size();
    s=" "+s;

    //dpåå§åã
    int mx=2e8;
    for(int d=0;d&lt;=25;d++){
        vector&lt;vector&lt;int&gt;&gt;f(n+1,vector&lt;int&gt;(26,2e8));
        for(int j=0;j&lt;=25;j++){
            if(j==s[1]-'a'){
                f[1][j]=0;
            }else{
                f[1][j]=1;
            }
        }
        for(int i=2;i&lt;=n;i++){
            for(int j=0;j&lt;=25;j++){
                f[i][j]=min(f[i-1][(j-d+26)%26],f[i-1][(j+d)%26])+(j!=s[i]-'a');
            }
        }

        for(int i=0;i&lt;=25;i++){
            mx=min(mx,f[n][i]);
        }

    }
    cout&lt;&lt;mx&lt;&lt;endl;




	return 0;
}
</code></pre>
<h3 id="çº¢é­é¦çå¾®çåºä½">çº¢é­é¦çå¾®çåºä½</h3>
<p><a href="https://ac.nowcoder.com/acm/contest/127702/F" target="_blank" rel="noopener nofollow">F-çº¢é­é¦çå¾®çåºä½_çå®¢å¨èµ Round 130 (nowcoder.com)</a></p>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121305276-651327063.png" alt="image-20260209120106423" loading="lazy"></p>
<pre><code>2
5
1 2 4 3 5
2
1 2
</code></pre>
<pre><code>0
1
</code></pre>
<p>æ¬é¢èçä¸ä¸ªç»å¸ç½®æ¢ç¯</p>
<pre><code>å¦æä¸ä¸ª1-nçæåï¼è¦äº¤æ¢å æ¬¡æè½ä½¿å¾å®æ¯ä¸ä¸ªæåã
ç»è®ºæ¯
n-ç¯çä¸ªæ°ï¼ç¸å½äºæç¯ã
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121305664-904288544.png" alt="image-20260209120521887" loading="lazy"></p>
<p>å¦å¾æ¯4åç¯</p>
<p>æä»¬éå¾å°2ï¼è¯å®å¾ä¸ä¸ªä¸¤ä¸ªç¸é»çåç´ ä¹é´æ²¡æå»äº¤æ¢</p>
<pre><code>1 2 4 3 5
</code></pre>
<p>é£æä»¬åæäº¤æ¢çæ¬¡æ°ç®åºæ¥ï¼åèèåæ¥å°åºå­ä¸å­å¨ç¸é»çç¯ã</p>
<h4 id="è§£é¢ä»£ç -5">è§£é¢ä»£ç </h4>
<pre><code class="language-c++">#include&lt;bits/stdc++.h&gt;
#define int long long
#define lll __uint128_t
#define PII pair&lt;int ,int&gt;
#define endl '\n'
using namespace std;
#define yn(ans) printf("%s\n", (ans)?"Yes":"No");//å¿«éæå°
#define YN(ans) printf("%s\n", (ans)?"YES":"NO");
#define REP(i, e) for (int i = 0; i &lt; (e); ++i)
#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)
#define TESTS int t; cin &gt;&gt; t; while (t--)
#define TEST
const int N=2e5+10,M=1e3+10,mod=1e9+7;
int a[N],b[N],c[N],pre[N];
void solve(){
    int n;
    cin&gt;&gt;n;
    vector&lt;int&gt;v(n+1);
    for(int i=1;i&lt;=n;i++){
        cin&gt;&gt;a[i];
    }
    int loop=0;
    for(int i=1;i&lt;=n;i++){
        if(v[i])continue;
        int j=i;
        loop++;
        while (!v[j]){
            v[j]=loop;
            j=a[j];
        }
    }
    int ans=n-loop+1;
    for(int i=2;i&lt;=n;i++){//å¤æ­æ¯ä¸æ¯ç¸é»çç¯
        if(v[i-1]==v[i]){
            ans-=2;
            break;
        }
    }
    cout&lt;&lt;ans&lt;&lt;endl;
};
signed main(){

	std::ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    TESTS{
        solve();
    };

	return 0;
}
</code></pre>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 12:14">2026-02-09 12:13</span>&nbsp;
<a href="https://www.cnblogs.com/godjian">Godjian</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19594585);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19594585', targetLink: 'https://www.cnblogs.com/godjian/p/19594585', title: 'C++å°ç½è®­ç»ç¬¬åä¸å¤©' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ£å­Cozeå®æï¼ä»0å°1æ­å»ºå°çº¢ä¹¦å¾ææ¹åæºè½ä½ ]]></title>
    <link>https://www.cnblogs.com/tangshiye/p/19594522</link>
    <guid>3b3a5c30d278f35e4b18e511dd8f2a9e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/tangshiye/p/19594522" title="åå¸äº 2026-02-09 11:59">
    <span role="heading" aria-level="2">æ£å­Cozeå®æï¼ä»0å°1æ­å»ºå°çº¢ä¹¦å¾ææ¹åæºè½ä½</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¤§å®¶å¥½ï¼ææ¯æ±¤å¸ç·ï¼ä¸æ³¨AIæºè½ä½åäº«ï¼è´åäºå¸®å©100Wäººç¨æºè½ä½åå¯~</p>
<p>è¿å¨ä¸ºå°çº¢ä¹¦ç¬è®°åä½åæåï¼</p>
<p>æ¯å¤©é½è¦ç»å°½èæ±æ³ææ¡ï¼ççå«äººççæ¬¾ç¬è®°å´ä¸ç¥éå¦ä½æ¨¡ä»¿ï¼</p>
<p>ä»å¤©ï¼æå°±æä½ å¦ä½å©ç¨AIæºè½ä½ï¼è½»æ¾å®ç°å°çº¢ä¹¦å¾ææ¹åï¼è®©åä½æçæå10åï¼</p>
<p>æä»¬åçä¸æºè½ä½çæ§è¡ææï¼</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849425-348751088.jpg" class="lazyload"></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849389-79233689.jpg" class="lazyload"></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849436-87560495.jpg" class="lazyload"></p>
<h2 id="1æ´ä½å·¥ä½æµ">1.æ´ä½å·¥ä½æµ</h2>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849359-444735043.jpg" class="lazyload"></p>
<p>1.è·åå°çº¢ä¹¦ç¬è®°è¯¦æ</p>
<p>2.ä½¿ç¨OCRææ¯ï¼æåå¾çä¸­çæå­</p>
<p>3.å°å¾çææ¡è¿è¡æ´ç</p>
<p>4.å¾çææ¡ä»¿å</p>
<h2 id="2è¯¦ç»å·¥ä½æµèç¹">2.è¯¦ç»å·¥ä½æµèç¹</h2>
<h3 id="21-å¼å§èç¹">2.1 å¼å§èç¹</h3>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849454-1421324949.jpg" class="lazyload"></p>
<p>å¼å§èç¹æä¸¤ä¸ªè¾å¥åéã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>noteUrlï¼å°çº¢ä¹¦ç¬è®°é¾æ¥</li>
<li>cookieStrï¼å°çº¢ä¹¦cookie</li>
</ul>
</li>
</ul>
<h3 id="22-å¦ä½è·åå°çº¢ä¹¦cookie">2.2 å¦ä½è·åå°çº¢ä¹¦cookieï¼</h3>
<p>1.ç»é<a href="https://www.xiaohongshu.com/" target="_blank" rel="noopener nofollow">https://www.xiaohongshu.com/</a></p>
<p>2.å¨é¡µé¢ç©ºç½å¤å³å»é¼ æ ï¼éæ©ãæ£æ¥ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849458-1366667585.jpg" class="lazyload"></p>
<p>3.å¨ååæå¼çé¢æ¿ä¸­ï¼ç¹å»ãç½ç»ãéé¡¹å¡</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849445-295607363.jpg" class="lazyload"></p>
<p>4.å·æ°å½åé¡µé¢</p>
<p>5.ç¹å»ç¬¬ä¸æ¡è®°å½ï¼å¨å³ä¾§ãæ å¤´ãé¨ååä¸æ»å¨ï¼æ¾å°cookieä¸è¡ï¼å°å¶åå®¹å¤å¶ä¸ï¼è¿å°±æ¯æä»¬éè¦çcookieStr</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849421-829853038.jpg" class="lazyload"></p>
<h3 id="23-è·åå°çº¢ä¹¦ç¬è®°è¯¦æ">2.3 è·åå°çº¢ä¹¦ç¬è®°è¯¦æ</h3>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849435-90047701.jpg" class="lazyload"></p>
<p>æä»¬å°ä½¿ç¨ãå°çº¢ä¹¦ãæä»¶çxhs_note_detailåè½ã</p>
<p>éè¿è¿ä¸ªåè½ï¼æä»¬å¯ä»¥æ ¹æ®ç¬è®°é¾æ¥è·åç¬è®°è¯¦æã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>cookieStrï¼å¼å§ - cookieStr</li>
<li>noteUrlï¼å¼å§ - noteUrl</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849369-1430779758.jpg" class="lazyload"></p>
<h3 id="24-ä½¿ç¨ocrææ¯æåå¾çä¸­çæå­">2.4 ä½¿ç¨OCRææ¯ï¼æåå¾çä¸­çæå­</h3>
<p><strong>1.æ¥ä¸æ¥ï¼æä»¬ä½¿ç¨å¾ªç¯èç¹ï¼æ¹éæåå¾çä¸­çæå­ã</strong></p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>inputï¼è·åå°çº¢ä¹¦ç¬è®°è¯¦æ-note_image_list</li>
</ul>
</li>
<li>è¾åº
<ul>
<li>outputï¼ä»å¾çä¸­æåæå­-data</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849354-1469357748.jpg" class="lazyload"></p>
<p><strong>2.ä½¿ç¨å¾ªç¯ä½ï¼æ¹éæåå¾ççæå­</strong></p>
<p>æä»¬ä¼ä½¿ç¨ãOCRãæä»¶ï¼æåå¾ççæå­ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849192-2085345149.jpg" class="lazyload"></p>
<p>è¾å¥åæ°å¦ä¸å¾æç¤ºã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849459-913346874.jpg" class="lazyload"></p>
<h3 id="25-ä½¿ç¨å¤§æ¨¡åå°ææ¡åå®¹è¿è¡æ´çæç">2.5 ä½¿ç¨å¤§æ¨¡åå°ææ¡åå®¹è¿è¡æ´çãæç</h3>
<p>å¨è¿ä¸æ­¥ï¼æä»¬ä¼ä½¿ç¨å¤§æ¨¡åèç¹ï¼å¯¹ææ¡åå®¹è¿è¡æ´çãæçã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849386-2050592021.jpg" class="lazyload"></p>
<p>å¤§æ¨¡åèç¹çç³»ç»æç¤ºè¯å¦ä¸ï¼</p>
<pre><code class="language-markdown">## è§è²ï¼Roleï¼
ä½ æ¯ä¸ä½ç²¾éåå®¹æ´çå Markdown æçç AI å©æãä½ æé¿éè¯»åçè§£éç»æåçææ¬åå®¹ï¼å¹¶è½å¤å°å¶è½¬åä¸ºç»ææ¸æ°ãæ ¼å¼ä¼ç¾ç Markdown ææ¡£ã

## èæ¯ï¼Backgroundï¼
éçç¤¾äº¤åªä½å¹³å°çæ®åï¼å¤§éçå¾æåå®¹è¢«åä½ååäº«ãç¶èï¼è¿äºåå®¹å¾å¾ç¼ºä¹è¯å¥½çç»æåæ ¼å¼ï¼ä¸å©äºéè¯»åçè§£ãå°è¿äºåå®¹æ´çæç»æåç Markdown ææ¡£ï¼å¯ä»¥å¤§å¤§æé«åå®¹çå¯è¯»æ§åä»·å¼ã

## ä»»å¡ï¼Taskï¼
ä½ çä»»å¡æ¯æ¥æ¶ä¸æ®µä»æä»¶è¾åºçéç»æåææ¬åå®¹ï¼ä¸»è¦æ¯æé³å¾æä¸­çæå­ï¼ï¼ä»ç»éè¯»å¹¶çè§£åå®¹ï¼ç¶åå°å¶è½¬åä¸ºç»ææ¸æ°ãæ ¼å¼è§èç Markdown ææ¡£ãä½ éè¦ï¼

1. è¯å«å¹¶æåææ¬ä¸­çå³é®ä¿¡æ¯ï¼å¦æ é¢ãä½èãä¸»è¦åå®¹ç­
2. æ ¹æ®åå®¹çé»è¾å³ç³»ï¼å¯¹ææ¬è¿è¡åç±»åæ´ç
3. ä½¿ç¨ Markdown è¯­æ³è¿è¡æçï¼åæ¬ä½ä¸éäºä½¿ç¨æ é¢ãç²ä½ãæä½ãåè¡¨ç­æ ¼å¼
4. ç¡®ä¿ææåå§åå®¹é½è¢«åå«å¨æç»ç Markdown ææ¡£ä¸­ï¼ä¸éæ¼ä»»ä½ä¿¡æ¯

## è§åä¸éå¶ï¼Rules &amp; Restrictionsï¼
1. å¿é¡»ä½¿ç¨ Markdown è¯­æ³è¿è¡æç
2. ä½¿ç¨ #ã##ã### ç­è¿è¡æ é¢ååï¼å±çº§ä¸è¶è¿ 3 çº§
3. ä½¿ç¨ - æ * è¿è¡æ åºåè¡¨ç¼åï¼ä½¿ç¨ 1. 2. 3. ç­è¿è¡æåºåè¡¨ç¼å
4. éè¦åå®¹ä½¿ç¨ç²ä½ï¼**æå­**ï¼æ æ³¨ï¼éè¦å¼ºè°çåå®¹ä½¿ç¨æä½ï¼*æå­*ï¼æ æ³¨
5. ä¿æåæçä¸»è¦ç»æåé¡ºåºï¼ä½å¯ä»¥éå½è°æ´ä»¥æé«å¯è¯»æ§
6. ä¸å¾æ·»å ãå é¤æä¿®æ¹åæçå®è´¨åå®¹
7. å¦éå°ä¸ç¡®å®çåå®¹ï¼ä¿çåæ ·å¹¶ç¨æ¬å·æ æ³¨

## åèç­è¯­ï¼Reference sentencesï¼
- åå®¹å®æ´ï¼ä¸éæ¼ä»»ä½ä¿¡æ¯
- ç»ææ¸æ°ï¼å±æ¬¡åæ
- æ ¼å¼è§èï¼ç¾è§å®ç¨
- é»è¾ä¸¥å¯ï¼æ¡çæ¸æ°
- éç¹çªåºï¼æäºéè¯»

## æ¡ä¾å±ç¤ºï¼Case Showï¼
### è¾å¥ï¼
{
  "code": 0,
  "data": {
    "results": [
      {
        "words": [
          {
            "lang": "auto",
            "text": "æ±å¤§è¿è¿ä¸¤ä¸ª"
          },
          {
            "lang": "auto",
            "text": "å°æ¹æå¥"
          },
          {
            "lang": "auto",
            "text": "åºå«åï¼ï¼"
          }
        ]
      }
    ]
  },
  "log_id": "20250325123913080C6F506498C6F581B7",
  "msg": "success"
}

## é£æ ¼åè¯­æ°ï¼Style &amp; Toneï¼
- ä¿æä¸ä¸ãæ¸æ°çè¯­æ°
- ä½¿ç¨ç®æ´ãç´æ¥çè¡¨è¾¾æ¹å¼
- ä¿æåæçéç¹åå¼ºè°

## åä¼ç¾¤ä½ï¼Audienceï¼
- å°çº¢ä¹¦çµåæ°æåå®¶
- å¯¹å¼è®¾å°çº¢ä¹¦åºéºæå´è¶£çäººç¾¤
- æ³è¦äºè§£å°çº¢ä¹¦çµåè¿è¥çäººç¾¤

## è¾åºæ ¼å¼ï¼Output formatï¼
ä½¿ç¨ Markdown æ ¼å¼è¾åºï¼åæ¬ï¼
1. ä¸çº§æ é¢ï¼#ï¼ç¨äºæç« ä¸»æ é¢
2. äºçº§æ é¢ï¼##ï¼ç¨äºä¸»è¦ç« è
3. ä¸çº§æ é¢ï¼###ï¼ç¨äºå­ç« è
4. æ åºåè¡¨ä½¿ç¨ - æ *
5. æåºåè¡¨ä½¿ç¨ 1. 2. 3. ç­
6. éè¦åå®¹ä½¿ç¨ç²ä½ï¼**æå­**ï¼
7. éè¦å¼ºè°çåå®¹ä½¿ç¨æä½ï¼*æå­*ï¼

## å·¥ä½æµç¨ï¼Workflowï¼
1. ä»ç»éè¯»è¾å¥çææ¬åå®¹ï¼çè§£å¶ç»æåä¸»è¦ä¿¡æ¯ç¹
2. æåæ é¢ãä½èãæ ç­¾ç­åä¿¡æ¯
3. è¯å«ä¸»è¦ç« èåå­ç« èï¼è§åææ¡£ç»æ
4. æç§è§åçç»æï¼ä½¿ç¨ Markdown è¯­æ³éæ°æçåå®¹
5. ä½¿ç¨ç²ä½åæä½çªåºéè¦ä¿¡æ¯åéè¦å¼ºè°çåå®¹
6. æ£æ¥ç¡®ä¿ææåå§åå®¹é½è¢«åå«ï¼æ²¡æéæ¼
7. æåæ£æ¥ Markdown æ ¼å¼æ¯å¦æ­£ç¡®ï¼è°æ´ä»¥ç¡®ä¿æä½³å¯è¯»æ§

## åå§åï¼Initializationï¼

ä¸é¢æ¯ä½ éè¦æ´çåæ ¼å¼åçææ¬åå®¹ï¼

&lt;è¯ä»·åå®¹&gt;

è¯·æä¾éè¦æ´çåæ ¼å¼åçææ¬åå®¹ãæä¼ä»ç»éè¯»å¹¶æç§ä¸è¿°è¦æ±å°å¶è½¬åä¸ºç»ææ¸æ°ç Markdown ææ¡£ãä¸éè¦è¾åºé¢å¤é¤å¾çè¯å«æå­ä»¥å¤çåå®¹ã
</code></pre>
<h3 id="26-å¾çææ¡ä»¿å">2.6 å¾çææ¡ä»¿å</h3>
<p>æ¥ä¸æ¥ï¼æä»¬éè¦éè¿å¤§æ¨¡åèç¹éå¾çææ¡è¿è¡ä»¿åã</p>
<p><img alt="image.png" loading="lazy" data-src="%E6%89%A3%E5%AD%90Coze%E6%99%BA%E8%83%BD%E4%BD%93%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BB%8E0%E5%88%B01%E6%90%AD%E5%BB%BA%E5%B0%8F%E7%BA%A2%E4%B9%A6%E5%9B%BE%E6%96%87%E6%94%B9%E5%86%99%E6%99%BA%E8%83%BD%E4%BD%93/image%2014.png" class="lazyload"></p>
<p>å¤§æ¨¡åèç¹çç³»ç»æç¤ºè¯å¦ä¸ï¼</p>
<pre><code class="language-markdown"># è§è²è¯´æ
ä½ æ¯ä¸ä½ä¸ä¸çå¾æåå®¹ä»¿åå©æï¼è´è´£æ ¹æ®å¾çä¸­æåçæå­åå®¹ï¼ç»åè§è§åç´ åèæ¯ä¿¡æ¯ï¼åä½é£æ ¼ä¸è´çä»¿ååå®¹ã

# èæ¯è¯´æ
å¤çç¨æ·æä¾çå¾çæå­åå®¹æ¶ï¼ä½ éè¦ï¼
1. çè§£å¾ççæ´ä½é£æ ¼åèæ¯ï¼äº§åä»ç»ãæç¨æ­¥éª¤ãä½¿ç¨å¿å¾ç­ï¼
2. åææå­çè¯­è¨ç¹ç¹ï¼æ­£å¼/å£è¯­åãå¥å¼ç¹å¾ãä¸ä¸æ¯è¯­ç­ï¼
3. ç»åå¾çåç°çè§è§ä¿¡æ¯ï¼äº§åå¤è§ãä½¿ç¨åºæ¯ç­ï¼
4. å¨ä¿æåæçåºç¡ä¸è¿è¡èªç¶çä»¿åæ©å±

# ä»¿ååå
1. ä¿æåæå®æ´æ§
2. å¹éåæè¯­è¨é£æ ¼
3. è¡¥åæ°å½çç»è
4. ä¸å¾çåå®¹ä¿æä¸è´
5. é¿åæ·»å èåä¿¡æ¯

# å·¥ä½æµç¨
1. æ¥æ¶å¾çæå­åå®¹
2. åæå¾çèæ¯ä¿¡æ¯ï¼å¯éï¼
3. åæåæç¹ç¹ï¼
   - è¯­è¨é£æ ¼
   - åå®¹ç»æ
   - å³é®è¯ä½¿ç¨
4. åä½ä¸ä¸ªçæ¬ï¼
   - è´´è¿åæçä¿å®ç
   - éåº¦ä¼åçæ¹è¿ç
   - åæå å¼ºçäº®ç¹ç

# è¾åºç¤ºä¾
## åæï¼
"å¤æ¥å¿å¤é²æé
SPF50+ PA++++
æ¸ç½ä¸æ²¹è»"

## ä»¿åçæ¬ï¼
1. ãä¿å®çã
"å¤å­£å¿å¤é²æäº§å
é²æææ°SPF50+ PA++++
è´¨å°æ¸ç½ä¸æ²¹è»"

2. ãä¼åçã
"å¤æ¥é²ææ¨è
é«åé²æ¤SPF50+ PA++++
è½»èæ°´æè´¨å°ï¼èè¤é¶è´æ"

3. ãåæçã
"ä»å¤é²æå¤©è±æ¿ï¼
SPF50+ PA++++è¶å¼ºé²æ¤
ä¸æ¹åæ°´ï¼æ¸ç½ä¸é»è»"

# æ§è¡è¦æ±
è¯·æä¾ï¼
1. å¾çæå­æååå®¹
2. å¾çèæ¯è¯´æï¼å¦æï¼

æå°æç§ä»¥ä¸è§èè¿è¡ä»¿ååä½ã
</code></pre>
<h3 id="27-ä½¿ç¨ææ¬å¤çæä»¶æ¼æ¥å­ç¬¦ä¸²">2.7 ä½¿ç¨ææ¬å¤çæä»¶æ¼æ¥å­ç¬¦ä¸²</h3>
<ul>
<li>è¾å¥ï¼
<ul>
<li>String1ï¼è·åå°çº¢ä¹¦ç¬è®°è¯¦æ-note</li>
<li>String2ï¼å¾çææ¡åå®¹æ´ç-output</li>
<li>String3ï¼å¾çææ¡ä»¿å-output</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849406-1197371456.jpg" class="lazyload"></p>
<h3 id="28-ç»æèç¹">2.8 ç»æèç¹</h3>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849192-257301299.jpg" class="lazyload"></p>
<h2 id="3æ»ç»">3.æ»ç»</h2>
<p>éè¿ä»¥ä¸ä»ç»ï¼ç¸ä¿¡ä½ äºè§£äºå¦ä½å©ç¨DeepSeek+Cozeæ¥æå»ºé«æçå°çº¢ä¹¦å¾çææ¡æ¹åæºè½ä½ã</p>
<p>å¨AIæ¶ä»£ï¼ææ¯é¨æ§å°è¶æ¥è¶ä½ï¼å°ç½ä¹è½æ­å»ºæºè½ä½ï¼ç¨AIå·¥å·æ¥æåå·¥ä½æçã</p>
<p>ç¨AIæºè½ä½ä¸æ¯æªæ¥ï¼èæ¯AIæ¶ä»£æ¯ä¸ªäººççå­æè½ï¼å­¦ä¼AIæºè½ä½ï¼äººäººé½æ¯è¶çº§ä¸ªä½ã</p>
<p>å¦æä½ è§å¾è¿ç¯æç« æå¸®å©ï¼å«å¿äºç¹èµãå³æ³¨ãæ¶èï¼æä»¬ä¸æåè§ï¼</p>
<blockquote>
<p>å¯¹äºï¼ææ´çäºä¸ä»½å¼æºãæºè½ä½å­¦ä¹ æåãï¼çè 10 ä¸å­ï¼ä»·å¼ 999 åãéæ¶å¼æ¾é¢åðï¼<a href="https://tangshiye.cn" target="_blank" rel="noopener nofollow">tangshiye.cn</a></p>
</blockquote>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/tangshiye/" target="_blank">AIæ¶æå¸æ±¤å¸ç·</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/tangshiye/p/19594522" target="_blank">https://www.cnblogs.com/tangshiye/p/19594522</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 11:59">2026-02-09 11:59</span>&nbsp;
<a href="https://www.cnblogs.com/tangshiye">AIæ¶æå¸æ±¤å¸ç·</a>&nbsp;
éè¯»(<span id="post_view_count">2</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19594522);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19594522', targetLink: 'https://www.cnblogs.com/tangshiye/p/19594522', title: 'æ£å­Cozeå®æï¼ä»0å°1æ­å»ºå°çº¢ä¹¦å¾ææ¹åæºè½ä½' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ FastAPIä¸æ­¢äºAPIï¼ææææä½ ç¨Jinja2æé å¨æWebé¡µé¢ ]]></title>
    <link>https://www.cnblogs.com/ymtianyu/p/19594466</link>
    <guid>51f4cb54d9b23eb5577a58fd5b6cb570</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ymtianyu/p/19594466" title="åå¸äº 2026-02-09 11:48">
    <span role="heading" aria-level="2">FastAPIä¸æ­¢äºAPIï¼ææææä½ ç¨Jinja2æé å¨æWebé¡µé¢</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æç³»ç»ä»ç»äºå¦ä½å¨FastAPIæ¡æ¶ä¸­éæJinja2æ¨¡æ¿å¼ææ¥æå»ºå¨æWebé¡µé¢ãåå®¹æ¶µçä»å®è£éç½®ãæ¨¡æ¿ä¸ä¸ææ°æ®ä¼ éï¼åæ¬è¯·æ±çº§åå¨å±ä¸¤ç§æ¹å¼ï¼ãéææä»¶æ­£ç¡®å¼å¥ï¼å°å®æ´å®ææ¼ç¤ºä¸å¸¸è§é¿åæåãå¸®å©å¼åèå¿«éææ¡å©ç¨FastAPIæå¡ç«¯æ¸²æé¡µé¢çæè½ï¼éç¨äºå¿«éååãç®¡çåå°ç­åºæ¯ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Helvetica Neue&quot;, sans-serif; line-height: 1.6; color: rgba(51, 51, 51, 1)">
<p>ä½ æ¯ä¸æ¯ä¹è§å¾ï¼ç¨FastAPIåæ¥å£ç½å°é£èµ·ï¼ä½ä¸æ³å°è¦è¿åä¸ªå¸¦æ°æ®çHTMLé¡µé¢ï¼å°±ç¬é´å¤´å¤§ï¼ð¯</p>
<p>æåç¨FastAPIé£ä¼å¿ä¹è¿æ ·ï¼ä»¥ä¸ºå®å°±æ¯ä¸ªâAPIä¸ç¨æ¡æ¶âï¼æ¸²æé¡µé¢ï¼é£ä¸æ¯DjangoåFlaskçæ´»å¿åï¼ç´å°æå¨ä¸ä¸ªç´§æ¥é¡¹ç®éï¼éè¦å¿«éç»åé¨ç³»ç»åä¸ªå¸¦æ°æ®çæ¿çç®¡çåå°ï¼ææåç°ï¼<strong style="color: rgba(186, 55, 42, 1)">FastAPIéåJinja2æ¨¡æ¿ï¼åæ¥å¯ä»¥è¿ä¹é¦ï¼</strong> ä»å¤©å°±è·ä½ å æç½è¿äºå¿ï¼ä¿ä½ 10åéä¸æï¼åå«âååç«¯åç¦»å¼ºè¿«çâå¨ç®ååºæ¯ä¸ççº ç»ã</p>
<h2 style="color: rgba(52, 152, 219, 1); border-bottom: 2px solid rgba(52, 152, 219, 1); padding-bottom: 5px">ð æ¬æè½å¸®ä½ è§£å³</h2>
<div style="background-color: rgba(248, 249, 250, 1); padding: 15px; border-left: 4px solid rgba(52, 152, 219, 1); margin: 20px 0">
<p>1. å¨FastAPIä¸­å¦ä½å®è£ãéç½®Jinja2æ¨¡æ¿å¼æã</p>
<p>2. å¦ä½æåå°æ°æ®ï¼ä¸ä¸æï¼å®å¨åæ¹ä¾¿å°âå¡âç»åç«¯æ¨¡æ¿ã</p>
<p>3. å¦ä½å¨æ¨¡æ¿éæ­£ç¡®å¼å¥CSSãJSç­éææä»¶ï¼é¿åâ404æ¨æ¡âã</p>
<p>4. æè¸©è¿çå ä¸ªååæä½³å®è·µï¼è®©ä½ ä¸æ¬¡åå¯¹ã</p>
</div>
<h2>ð ä¸»è¦åå®¹èç»</h2>
<p>ð åèèï¼ä¸ºä»ä¹éè¦æ¨¡æ¿å¼æï¼ï¼ä¸åªæ¯ä¸ºäºçäºï¼</p>
<p>ð æ ¸å¿æä½ï¼å®è£ãéç½®ãä¼ éæ°æ®çâä¸¤æ¡è·¯å¾âã</p>
<p>ð å®ææ¼ç¤ºï¼ä¸ä¸ªåå«ç¨æ·åè¡¨åæ ·å¼çå°é¡¹ç®ã</p>
<p>ð é¿åæåï¼éææä»¶é£äºâè·¯å¾çå­¦âä¸è¿é¶æèã</p>
<hr style="border: none; height: 1px; background-color: rgba(238, 238, 238, 1); margin: 30px 0">
<h2>ð ä¸ãé®é¢ä¸èæ¯ï¼FastAPIåªè½âåâJSONï¼</h2>
<p>FastAPIä»¥æå»ºé«æ§è½APIé»åï¼<code style="color: rgba(186, 55, 42, 1)">return JSONResponse</code> å ä¹æ¯èèè®°å¿ãä½å¾å¤åºæ¯ä¸ï¼æ¯å¦ï¼</p>
<div>
<p>- å¿«éååå¼åï¼æä¸ªå¸¦é¡µé¢çdemoã</p>
<p>- åé¨ç®¡çåå°ï¼å¤æåº¦ä¸é«ï¼ä¸æ³å¨ç¨åç«¯æ¡æ¶ã</p>
<p>- éè¦æå¡ç«¯æ¸²æï¼SSRï¼çç®åé¡µé¢ã</p>
</div>
<p>è¿æ¶åï¼ä½ ç¡¬è¦ååç«¯å½»åºåç¦»ï¼åèæç§âæé¸¡ç¨çåâçç¹çãå°±å¥½æ¯ä½ åªæ³å¨å®¶é¨å£åç¢é¢ï¼ç»æéè¦å¼è½¦å»å¸ä¸­å¿çé«çº§é¤åç¹åãç­é¤ãæåååæ¥ã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">æ¨¡æ¿å¼æï¼å°±æ¯è®©ä½ å¨FastAPIè¿ä¸ªâé«æ§è½å¨æ¿âéï¼ç´æ¥å¼ä¸ªâå é£çªå£âã</strong> Jinja2å°±æ¯è¿ä¸ªçªå£æå¾åçä¼è®¡ï¼å®è½æä½ çæ°æ®ï¼èãèï¼åHTMLæ¨¡æ¿ï¼ç¢ãæ±¤åºï¼å¿«éç»åæä¸ç¢ç­è¾è¾çé¢ï¼æç»é¡µé¢ï¼ã</p>
<h2>ð§  äºãæ ¸å¿åçä¸æ­¥éª¤ï¼âä¸¤æ¡è¿âèµ°è·¯</h2>
<p>å¥½ï¼å±ä»¬åæ¥è§£å³ææ ¸å¿çé®é¢ï¼æ°æ®æä¹ä»åç«¯âèµ°âå°æ¨¡æ¿éï¼</p>
<p>æ ¸å¿å°±ä¸¤æ­¥ï¼1. éç½®å¼æï¼2. ä¼ éæ°æ®ãæ°æ®ä¼ éæä¸¤æ¡å³é®âè·¯å¾âï¼æç»ä¸ªçµé­å¾ç¤ºç»ä½ çï¼</p>
<div style="background-color: rgba(248, 249, 250, 1); padding: 15px; border-radius: 5px; margin: 20px 0">
<p><strong>è·¯å¾Aï¼ä¾èµé¡¹æ³¨å¥ï¼å¨å±/è¯·æ±çº§ä¸ä¸æï¼</strong></p>
<p>å¨è·¯ç±å¤çå½æ°éï¼éè¿ <code style="color: rgba(186, 55, 42, 1)">TemplateResponse</code> ç <code style="color: rgba(186, 55, 42, 1)">context</code> åæ°ä¼ éãè¿æ¯<strong style="color: rgba(186, 55, 42, 1)">æå¸¸ç¨ãæçµæ´»</strong>çæ¹å¼ï¼æ°æ®éå¯¹æ¯æ¬¡è¯·æ±ã</p>
<p><strong>è·¯å¾Bï¼å¨å±æ¨¡æ¿ä¸ä¸æï¼æ¯ä¸ªæ¨¡æ¿é½è½ç¨ï¼</strong></p>
<p>å¨åå§å <code style="color: rgba(186, 55, 42, 1)">Jinja2Templates</code> æ¶ï¼éè¿ <code style="color: rgba(186, 55, 42, 1)">context</code> åæ°ä¼ éãæ¯å¦ç«ç¹åãå½åå¹´ä»½ç­<strong style="color: rgba(186, 55, 42, 1)">å¨å±éç¨æ°æ®</strong>ã</p>
</div>
<p>æ¯ä¸æ¯æç¹æ½è±¡ï¼å«æ¥ï¼å±ä»¬æ¥ççå®æï¼ä»£ç ä¸åä½ å°±å¨æç½äºã</p>
<h2>ð» ä¸ãå®ææ¼ç¤ºï¼ä»é¶æ­å»ºä¸ä¸ªç¨æ·åè¡¨é¡µ</h2>
<p>æ¥ä¸æ¥éç¹æ¥äºï¼å±ä»¬ä¸æ­¥æ­¥æ¥ãåè®¾æä»¬è¦åä¸ä¸ªæ¾ç¤ºç¨æ·åè¡¨çé¡µé¢ã</p>
<h3>1ï¸â£ å®è£ä¸é¡¹ç®ç»æ</h3>
<p>åå®è£å¿å¤åºï¼</p>
<pre class="language-powershell highlighter-hljs"><code>pip install fastapi jinja2 uvicorn</code></pre>
<p>é¡¹ç®ç®å½ç»æå»ºè®®è¿æ ·å®æï¼æ¸æ°æäºï¼</p>
<div>
<pre class="language-powershell highlighter-hljs"><code>ð your_project/
âââ ð templates/ # å­æ¾ææJinja2 HTMLæ¨¡æ¿
â     âââ index.html
âââ ð static/ # å­æ¾CSS, JS, å¾çç­éææä»¶
â     âââ style.css
âââ main.py # FastAPI ä¸»åºç¨æä»¶</code></pre>
</div>
<h3>2ï¸â£ éç½®FastAPIä¸Jinja2</h3>
<p>å¨ <code style="color: rgba(186, 55, 42, 1)">main.py</code> éè¿è¡åå§åãè¿éæä¸ª<strong style="color: rgba(186, 55, 42, 1)">å³é®ç¹</strong>ï¼<code style="color: rgba(186, 55, 42, 1)">directory</code> åæ°å¿é¡»æ¯<strong style="color: rgba(186, 55, 42, 1)">å­ç¬¦ä¸²è·¯å¾</strong>ï¼ä¸è½æ¯Pathå¯¹è±¡ï¼Jinja2çèè§ç©ï¼ã</p>
<pre class="language-python highlighter-hljs"><code>from fastapi import FastAPI, Request
from fastapi.responses import HTMLResponse
from fastapi.templating import Jinja2Templates
from fastapi.staticfiles import StaticFiles

app = FastAPI(title="FastAPI+Jinja2 Demo")

# éç½®æ¨¡æ¿å¼æï¼åè¯å®æ¨¡æ¿æä»¶å¨åª
templates = Jinja2Templates(directory="templates")

# éç½®éææä»¶æå¡ï¼æè½½å°`/static`è·¯å¾
app.mount("/static", StaticFiles(directory="static"), name="static")</code></pre>
<h3>3ï¸â£ å®ä¹è·¯ç±ä¸ä¼ éæ°æ®ï¼è·¯å¾Aï¼</h3>
<p>æä»¬å®ä¹ä¸ä¸ªè·¯ç±ï¼æ¨¡æä»æ°æ®åºè·åç¨æ·åè¡¨ï¼å¹¶ä¼ éç»æ¨¡æ¿ï¼</p>
<pre class="language-python highlighter-hljs"><code>@app.get("/", response_class=HTMLResponse)
async def read_users(request: Request):
    # æ¨¡ææ°æ®ï¼å®éä¸­å¯è½æ¥èªæ°æ®åº
    user_list = [
        {"id": 1, "name": "å¼ ä¸", "role": "ç®¡çå"},
        {"id": 2, "name": "æå", "role": "ç¼è¾"},
        {"id": 3, "name": "çäº", "role": "è®¢éç¨æ·"},
    ]
    # ç½ç«æ é¢ï¼ä½ä¸ºé¢å¤æ°æ®ä¼ é
    site_title = "åé¨ç¨æ·ç®¡çç³»ç»"
    
    # æ ¸å¿æä½ï¼æ¸²ææ¨¡æ¿ï¼å¹¶éè¿contextä¼ éæ°æ®
    return templates.TemplateResponse(
        request=request,
        name="index.html", # æ¨¡æ¿æä»¶å
        context={
            "request": request, # è¿ä¸ªå¿é¡»æï¼Jinja2Templatesè¦æ±
            "users": user_list,
            "title": site_title
        }
    )</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">åä¸æ³¨æ</strong>ï¼<code style="color: rgba(186, 55, 42, 1)">context</code> å­å¸é<strong style="color: rgba(186, 55, 42, 1)">å¿é¡»åå« "request" é®</strong>ï¼è¿æ¯ <code style="color: rgba(186, 55, 42, 1)">Jinja2Templates</code> çå·¥ä½æºå¶è¦æ±çï¼ä¸ç¶æ¨¡æ¿éä¸äºåºäºè¯·æ±çåè½ä¼å¤±æã</p>
<h3>4ï¸â£ ç¼åæ¨¡æ¿æä»¶ (templates/index.html)</h3>
<p>ççæ°æ®å¨æ¨¡æ¿éæä¹ç¨ï¼</p>
<pre class="language-html highlighter-hljs"><code>&lt;!DOCTYPE html&gt;
&lt;html lang="zh-CN"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;{{ title }}&lt;/title&gt;
    &lt;!-- éç¹ï¼å¼å¥éæCSSæä»¶ --&gt;
    &lt;link rel="stylesheet" href="{{ url_for('static', path='/style.css') }}"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;æ¬¢è¿ä½¿ç¨ {{ title }}&lt;/h1&gt;
    &lt;table border="1"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;ID&lt;/th&gt;
                &lt;th&gt;å§å&lt;/th&gt;
                &lt;th&gt;è§è²&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            {% for user in users %}
            &lt;tr&gt;
                &lt;td&gt;{{ user.id }}&lt;/td&gt;
                &lt;td&gt;{{ user.name }}&lt;/td&gt;
                &lt;td&gt;{{ user.role }}&lt;/td&gt;
            &lt;/tr&gt;
            {% endfor %}
        &lt;/tbody&gt;
    &lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">æ²é»æ¿</strong>ï¼å¼å¥éææä»¶ç¨çæ¯ <code style="color: rgba(186, 55, 42, 1)">url_for('static', path='/style.css')</code>ãè¿éç <code style="color: rgba(186, 55, 42, 1)">'static'</code> å¯¹åºæä»¬ <code style="color: rgba(186, 55, 42, 1)">app.mount</code> æ¶è®¾ç½®ç <code style="color: rgba(186, 55, 42, 1)">name="static"</code>ãè¿æ¯æåæå¸¸ééçå°æ¹ï¼<strong style="color: rgba(186, 55, 42, 1)">nameå¿é¡»ä¸è´</strong>ï¼</p>
<h3>5ï¸â£ ç¼åéææä»¶ (static/style.css)</h3>
<p>éä¾¿åç¹æ ·å¼ï¼ç¡®è®¤å®è½è¢«å è½½ï¼</p>
<pre class="language-css highlighter-hljs"><code>body {
    font-family: sans-serif;
    padding: 20px;
    background-color: #f5f5f5;
}
h1 {
    color: #2c3e50;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}
th, td {
    padding: 10px;
    text-align: left;
}
thead {
    background-color: #3498db;
    color: white;
}</code></pre>
<p>å¥½äºï¼ç°å¨è¿è¡ <code style="color: rgba(186, 55, 42, 1)">uvicorn main:app --reload</code>ï¼æå¼ <code style="color: rgba(186, 55, 42, 1)">http://127.0.0.1:8000</code>ï¼ä¸ä¸ªå¸¦æ ·å¼åå¨ææ°æ®çç¨æ·åè¡¨é¡µé¢å°±åºæ¥äºï¼æ°æ®ä»åç«¯âæµâå°äºåç«¯ï¼éææä»¶ä¹æ­£å¸¸å è½½ã</p>
<h2>â ï¸ åãæ³¨æäºé¡¹ä¸è¿é¶æè</h2>
<p>æ¯ä¸æ¯ä»¥ä¸ºè¿æ ·å°±å®äºï¼åè¯´å ä¸ªå®¹æç¿»è½¦çç¹ã</p>
<h3>ð¯ é¿åæå</h3>
<div>
<p><strong>1. éææä»¶404ï¼</strong></p>
<p>- æ£æ¥ <code style="color: rgba(186, 55, 42, 1)">app.mount</code> ç <code style="color: rgba(186, 55, 42, 1)">directory</code> è·¯å¾æ¯å¦æ­£ç¡®ï¼ç¸å¯¹è·¯å¾ä»é¡¹ç®æ ¹ç®å½ç®èµ·ï¼ã</p>
<p>- æ£æ¥æ¨¡æ¿ä¸­ <code style="color: rgba(186, 55, 42, 1)">url_for</code> ç <code style="color: rgba(186, 55, 42, 1)">name</code> åæ°æ¯å¦ä¸ <code style="color: rgba(186, 55, 42, 1)">mount</code> ç <code style="color: rgba(186, 55, 42, 1)">name</code> ä¸è´ã</p>
<p>- çäº§ç¯å¢éå¸¸ç¨Nginxç­ä¸é¨å¤çéææä»¶ï¼å¼åæ¶ç¨ <code style="color: rgba(186, 55, 42, 1)">StaticFiles</code> å¾æ¹ä¾¿ã</p>
<p><strong>2. å¨å±ä¸ä¸æï¼è·¯å¾Bï¼æä¹ç¨ï¼</strong></p>
<p>æ¯å¦ä½ æ³å¨æ¯ä¸ªé¡µé¢é½æ¾ç¤ºçæå¹´ä»½ï¼</p>
</div>
<pre class="language-python highlighter-hljs"><code>templates = Jinja2Templates(
    directory="templates",
    context={"current_year": 2024} # å¨å±æ³¨å¥
)
# ç¶åï¼å¨ä»»ä½æ¨¡æ¿éé½å¯ä»¥ç´æ¥ä½¿ç¨ {{ current_year }}</code></pre>
<h3>ð è¿é¶æè</h3>
<p><strong>æ¨¡æ¿ç»§æ¿æ¯ççï¼</strong> ç¨ <code style="color: rgba(186, 55, 42, 1)">{% extends "base.html" %}</code> å <code style="color: rgba(186, 55, 42, 1)">{% block content %}...{% endblock %}</code> æ¥å¤ç¨å¸å±ï¼å¦å¯¼èªæ ãé¡µèï¼ï¼è½è®©ä½ çæ¨¡æ¿ä»£ç å¹²åååãå¼ºçå»ºè®®ä½ ç¨èµ·æ¥ã</p>
<p><strong>ä¸ä¸æå¤çå¨ï¼</strong> å¦æä½ æ³å¨æ¯ä¸ªè¯·æ±çæ¨¡æ¿éé½èªå¨æ³¨å¥ä¸äºæ°æ®ï¼æ¯å¦å½åç»å½ç¨æ·ï¼ï¼å¯ä»¥èªå®ä¹ä¾èµé¡¹ï¼å¹¶å¨æ¯ä¸ªè·¯ç±ç <code style="color: rgba(186, 55, 42, 1)">TemplateResponse</code> éè°ç¨ãè½ç¶æç¹ç»ï¼ä½ç»ææ´æ¸æ°ã</p>
<p><strong>ä½æ¶ç¨ï¼ä½æ¶ä¸ç¨ï¼</strong> å¯¹äºå¤æçãäº¤äºæ§å¼ºçç°ä»£Webåºç¨ï¼ååç«¯åç¦»ï¼React/Vue + FastAPI APIï¼ä»æ¯é¦éãä½å¯¹äºå·¥å·ç±»ãç®¡çç±»ãéè¦SEOçç®ååå®¹é¡µï¼<strong style="color: rgba(186, 55, 42, 1)">FastAPI + Jinja2 çç»åè½è®©ä½ ä¸äººé¡¶ä¸ä¸ªå¨æ å¢éï¼å¼åéåº¦é£å¿«</strong>ã</p>
<hr style="border: none; height: 1px; background: linear-gradient(90deg, rgba(0, 0, 0, 0), rgba(52, 152, 219, 1), rgba(0, 0, 0, 0)); margin: 40px 0">
<p>å¥½äºï¼ä»å¤©çåäº«å°±å°è¿å¿ãå¸æè¿ç¯âè¸©åç»éªæ»ç»âè½å¸®ä½ æFastAPIçâå¦ä¸é¢âä¹å©ç¨èµ·æ¥ã</p>
<p>ææ¯éåæ²¡æé¶å¼¹ï¼<strong style="color: rgba(186, 55, 42, 1)">æå¥½çå·¥å·æ¯é£ä¸ªè½å¸®ä½ é«æãç¨³å®è§£å³é®é¢çå·¥å·</strong>ãä¸æ¬¡å½ä½ éè¦å¿«éæ£é¼ä¸ªå¸¦çé¢çå°å·¥å·æ¶ï¼ä¸å¦¨è¯è¯è¿ä¸ªç»åã</p>
<p>ä½ å¨ç¨FastAPIåWebé¡µé¢æ¶è¿éå°è¿ä»ä¹å¥è©é®é¢ï¼æèææ´ä¼éçå®è·µï¼<strong style="color: rgba(186, 55, 42, 1)">æ¬¢è¿å¨è¯è®ºåºä¸èµ·èè</strong>ï¼ä½ çç»éªå¾å¯è½ä¹è½å¸®å°å«äººã</p>
<p style="text-align: center; color: rgba(127, 140, 141, 1); font-size: 0.9em">è§å¾æç¨çè¯ï¼è®°å¾æ¶èãç¹èµãå³æ³¨å¦~ å±ä»¬ä¸æè§ï¼</p>
</div>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 11:49">2026-02-09 11:48</span>&nbsp;
<a href="https://www.cnblogs.com/ymtianyu">ä¸åç¨åºåªå</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19594466);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19594466', targetLink: 'https://www.cnblogs.com/ymtianyu/p/19594466', title: 'FastAPIä¸æ­¢äºAPIï¼ææææä½ ç¨Jinja2æé å¨æWebé¡µé¢' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ é¸¿èåºç¨å¼åUIåºç¡ç¬¬åèï¼UIAbility å¯å¨æ¨¡å¼è¯¦è§£ ]]></title>
    <link>https://www.cnblogs.com/san-xiu/p/19594371</link>
    <guid>dd74475c66f0e7bbe7a332ff95a41205</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/san-xiu/p/19594371" title="åå¸äº 2026-02-09 11:33">
    <span role="heading" aria-level="2">é¸¿èåºç¨å¼åUIåºç¡ç¬¬åèï¼UIAbility å¯å¨æ¨¡å¼è¯¦è§£</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å­¦ä¹ ç®æ ">ãå­¦ä¹ ç®æ ã</h2>
<ol>
<li>ææ¡ multitonãsingletonãspecified ä¸ç§å¯å¨æ¨¡å¼çæ ¸å¿å®ä¹ä¸å·®å¼</li>
<li>çè§£ä¸åæ¨¡å¼ä¸ UIAbility å®ä¾ç<strong>åå»º/å¤ç¨è§å</strong>åçå½å¨æèå¨é»è¾</li>
<li>ææ¡ AbilityStage çæ ¸å¿ä½ç¨åä¸ specified æ¨¡å¼çå³èå³ç³»</li>
<li>å­¦ä¼å¨ module.json5 ä¸­éç½®å¯å¨æ¨¡å¼ï¼åå¤ Ability å·¥ç¨çæ ååæ­å»º</li>
<li>è½éè¿å®æå®ç°ä¸ç§æ¨¡å¼ï¼å¹¶éªè¯å®ä¾åå»º/å¤ç¨çè¡ä¸ºå·®å¼</li>
</ol>
<h2 id="è¯¾åéºå«">ãè¯¾åéºå«ã</h2>
<p>ä¸ä¸èæä»¬å·²ææ¡ UIAbility çåºç¡çå½å¨æåé¡µé¢è·³è½¬é»è¾ï¼å¶é»è®¤å¯å¨æ¨¡å¼ä¸º <strong>singletonï¼åå®ä¾ï¼</strong>ã</p>
<p>å®éå¼åä¸­ï¼ä¸åä¸å¡åºæ¯ï¼å¦å¤æ ç­¾é¡µãå¯ä¸ä¸ªäººä¸­å¿ãæä¸å¡ç»´åº¦å¤ç¨å®ä¾ï¼éè¦ä¸åçå®ä¾ç®¡çç­ç¥ï¼å æ­¤é¸¿èæä¾äºä¸ç§å¯å¨æ¨¡å¼ï¼æ ¸å¿è§£å³<strong>ãéå¤å¯å¨æ¶ï¼ç³»ç»æ¯åå»ºæ°å®ä¾è¿æ¯å¤ç¨å·²æå®ä¾ã</strong>çé®é¢ã</p>
<h2 id="æ ¸å¿é®é¢å¯¼å¥">ãæ ¸å¿é®é¢å¯¼å¥ã</h2>
<ul>
<li>ä¸ºä»ä¹æµè§å¨æå¼æ°æ ç­¾æ¯æ°çªå£ï¼èæå¼ä¸ªäººä¸­å¿å§ç»æ¯åä¸ä¸ªçªå£ï¼</li>
<li>ä¸ºä»ä¹é¨åé¡µé¢è·³è½¬è§¦å onCreateï¼é¨åä»è§¦å onNewWantï¼</li>
<li>specified æ¨¡å¼ç instanceKey ä½ç¨æ¯ä»ä¹ï¼ä¸ºä½å¿é¡»ä¾èµ AbilityStageï¼</li>
<li>å¦ä½æ ¹æ®ä¸å¡åºæ¯éæ©åéçå¯å¨æ¨¡å¼ï¼</li>
</ul>
<h2 id="ä¸æ ¸å¿æ¦å¿µuiability-ä¸ç§å¯å¨æ¨¡å¼">ä¸ãæ ¸å¿æ¦å¿µï¼UIAbility ä¸ç§å¯å¨æ¨¡å¼</h2>
<p>UIAbility çå¯å¨æ¨¡å¼å³å®äº<strong>ç³»ç»å¯¹å®ä¾çç®¡çç­ç¥</strong>ï¼é¸¿èå®æ¹æä¾ä¸ç§æ ååæ¨¡å¼ï¼è¦çææä¸å¡åºæ¯ï¼æ ¸å¿å·®å¼éä¸­å¨<strong>å®ä¾æ°é</strong>å<strong>å¤ç¨è§å</strong>ä¸ï¼</p>
<h3 id="1-singletonåå®ä¾æ¨¡å¼--å¨å±å¯ä¸">1. singletonï¼åå®ä¾æ¨¡å¼ï¼- å¨å±å¯ä¸</h3>
<ul>
<li><strong>æ ¸å¿å®ä¹</strong>ï¼è¯¥ç±»å UIAbility å¨å±ä»å­å¨<strong>ä¸ä¸ªå®ä¾</strong>ï¼æ è®ºå¤å°æ¬¡å¯å¨ï¼ç³»ç»é½ä¼å¤ç¨å·²æå®ä¾</li>
<li><strong>æ ¸å¿è§å</strong>ï¼é¦æ¬¡å¯å¨åå»ºå®ä¾ï¼åç»­ææå¯å¨è¯·æ±åè·¯ç±å°å·²æå®ä¾</li>
<li><strong>éç¨åºæ¯</strong>ï¼åºç¨ä¸»çé¢ãä¸ªäººä¸­å¿ãè´­ç©è½¦ç­<strong>éè¦å¨å±å¯ä¸ç¶æ</strong>çé¡µé¢</li>
</ul>
<h3 id="2-multitonå¤å®ä¾æ¨¡å¼--æ¯æ¬¡æ°å»º">2. multitonï¼å¤å®ä¾æ¨¡å¼ï¼- æ¯æ¬¡æ°å»º</h3>
<ul>
<li><strong>æ ¸å¿å®ä¹</strong>ï¼æ¯æ¬¡å¯å¨è¯¥ç±»å UIAbilityï¼ç³»ç»é½ä¼<strong>åå»ºæ°çå®ä¾</strong>ï¼å®ä¾ä¹é´ç¸äºç¬ç«</li>
<li><strong>æ ¸å¿è§å</strong>ï¼æ å¤ç¨é»è¾ï¼æ¯æ¬¡å¯å¨åèµ°å®æ´çå®ä¾åå»ºçå½å¨æ</li>
<li><strong>éç¨åºæ¯</strong>ï¼æµè§å¨å¤æ ç­¾é¡µãå¤çªå£ææ¡£ç¼è¾ãå¤ä»»å¡å¤çç­<strong>éè¦ç¬ç«ç¶æ</strong>çé¡µé¢</li>
</ul>
<blockquote>
<p>è¯´æï¼standard æ¯ multiton çæ¾ç¨åï¼é¸¿èä½çæ¬ä¸­ä½¿ç¨ï¼åè½ä¸ multiton å®å¨ä¸è´</p>
</blockquote>
<h3 id="3-specifiedæå®å®ä¾æ¨¡å¼--ææ è¯å¤ç¨">3. specifiedï¼æå®å®ä¾æ¨¡å¼ï¼- ææ è¯å¤ç¨</h3>
<ul>
<li><strong>æ ¸å¿å®ä¹</strong>ï¼ç³»ç»æ ¹æ®<strong>å¯ä¸æ è¯</strong>å¤æ­å®ä¾å¤ç¨é»è¾ï¼ç¸åæ è¯å¤ç¨å®ä¾ï¼ä¸åæ è¯åå»ºæ°å®ä¾</li>
<li><strong>æ ¸å¿è§å</strong>ï¼æ è¯ç± AbilityStage ç onAcceptWant æ¹æ³çæï¼éå¸¸ç»å®ä¸å¡å¯ä¸å¼ï¼å¦ instanceKeyï¼</li>
<li><strong>éç¨åºæ¯</strong>ï¼èå¤©çªå£ï¼æèç³»äººIDå¤ç¨ï¼ãååè¯¦æé¡µï¼æååIDå¤ç¨ï¼ãæä¸å¡ç»´åº¦éç¦»çå®ä¾åºæ¯</li>
</ul>
<h2 id="äºabilitystage-æ ¸å¿ä½ç¨ä¸æ ¸å¿æ¹æ³">äºãAbilityStage æ ¸å¿ä½ç¨ä¸æ ¸å¿æ¹æ³</h2>
<h3 id="1-abilitystage-åºç¡è®¤ç¥">1. AbilityStage åºç¡è®¤ç¥</h3>
<ul>
<li>AbilityStage æ¯<strong>æ¨¡åçº§ççå½å¨æç®¡çå¨</strong>ï¼æ¯ä¸ª HAP æ¨¡åå¯¹åºä¸ä¸ª AbilityStage å®ä¾ï¼ç±ç³»ç»é¦æ¬¡å è½½æ¨¡åæ¶èªå¨åå»º</li>
<li>è¥æ éçå¬æ¨¡åçå½å¨ææå¤ç specified æ¨¡å¼ï¼æ éæå¨åå»ºï¼ç³»ç»ä½¿ç¨é»è®¤å®ä¾ï¼è¥éå®ç° specified æ¨¡å¼ï¼<strong>å¿é¡»æå¨åå»ºå¹¶éç½®èªå®ä¹ AbilityStage</strong></li>
</ul>
<h3 id="2-abilitystage-ä¸-specified-æ¨¡å¼çå³è">2. AbilityStage ä¸ specified æ¨¡å¼çå³è</h3>
<p>specified æ¨¡å¼æ¯<strong>å¯ä¸ä¾èµ AbilityStage çå¯å¨æ¨¡å¼</strong>ï¼åå æ¯ï¼ç³»ç»æ¬èº«æ æ³è¯å«ãåªäºå¯å¨è¯·æ±éè¦å¤ç¨å®ä¾ãï¼ééè¿ AbilityStage æä¾<strong>å®ä¾å¯ä¸æ è¯</strong>ï¼ç³»ç»æ ¹æ®è¯¥æ è¯å®æå¹é/å¤ç¨ã</p>
<h3 id="3-abilitystage-æ ¸å¿æ¹æ³onacceptwant">3. AbilityStage æ ¸å¿æ¹æ³ï¼onAcceptWant</h3>
<ul>
<li>ä½ç¨ï¼<strong>çæå¹¶è¿å specified æ¨¡å¼çå®ä¾å¯ä¸æ è¯</strong>ï¼ç³»ç»æ ¹æ®è¯¥æ è¯å¤æ­æ¯å¦å¤ç¨å®ä¾</li>
<li>å¥åï¼Want å¯¹è±¡ï¼åå«å¯å¨è¯·æ±çææä¿¡æ¯ï¼å¦ abilityNameãparameters ç­ï¼</li>
<li>è¿åå¼ï¼å­ç¬¦ä¸²ç±»åçå¯ä¸æ è¯ï¼ç¸åæ è¯å¤ç¨å®ä¾ï¼ä¸åæ è¯/ç©ºå­ç¬¦ä¸²åå»ºæ°å®ä¾ï¼</li>
<li>æ ¸å¿é»è¾ï¼ä» Want åæ°ä¸­æåä¸å¡å¯ä¸å¼ï¼å¦ instanceKeyï¼ï¼æ¼æ¥æå¨å±å¯ä¸çæ è¯å­ç¬¦ä¸²</li>
</ul>
<h2 id="ä¸å·¥ç¨æ­å»ºä¸ä¸ç§æ¨¡å¼è½å°">ä¸ãå·¥ç¨æ­å»ºä¸ä¸ç§æ¨¡å¼è½å°</h2>
<h3 id="ä¸å·¥ç¨ç»æè§å">ï¼ä¸ï¼å·¥ç¨ç»æè§å</h3>
<p>åºäº <code>FirstApplication</code> å·¥ç¨ï¼æ°å¢ 2 ä¸ª UIAbilityï¼åå«å¯¹åº multiton/specified æ¨¡å¼ï¼åå¯¹åºé¡µé¢ï¼ä¿çåæ EntryAbilityï¼singleton æ¨¡å¼ï¼ï¼æ ååå·¥ç¨ç»æå¦ä¸ï¼æ°å¢ç®å½/æä»¶æ æ³¨âï¼ï¼</p>
<pre><code>FirstApplication
âââ AppScope                 # åºç¨å¨å±éç½®ç®å½
â   âââ app.json5            # å¨å±éç½®ï¼ååï¼com.sanxiu.firstappï¼
âââ entry                    # ä¸»æ¨¡åç®å½ï¼Entry HAPï¼
â   âââ src/main
â   â   âââ ets              # ArkTSä»£ç æ ¸å¿ç®å½
â   â   âââ applicationâ     # èªå®ä¹AbilityStageç®å½ï¼specifiedæ¨¡å¼æ ¸å¿ï¼
â   â   â   âââ MyAbilityStage.etsâ # èªå®ä¹AbilityStageï¼å®ç°onAcceptWantï¼
â   â   âââ entryability     # åå®ä¾Abilityç®å½ï¼singletonæ¨¡å¼ï¼
â   â   â   âââ EntryAbility.ets       # é»è®¤Abilityï¼å¯å¨å¥å£ï¼
â   â   âââ multitonabilityâ # å¤å®ä¾Abilityç®å½ï¼multitonæ¨¡å¼ï¼
â   â   â   âââ MultitonAbility.etsâ   # multitonæ¨¡å¼Ability
â   â   âââ specifiedabilityâ# æå®å®ä¾Abilityç®å½ï¼specifiedæ¨¡å¼ï¼
â   â   â   âââ SpecifiedAbility.etsâ  # specifiedæ¨¡å¼Ability
â   â   âââ pages            # Pageé¡µé¢ç®å½
â   â   â   âââ Index.ets              # å¤ç¨é¦é¡µ
â   â   â   âââ Home.etsâ               # æµè¯é¦é¡µï¼å¯å¨åæ¨¡å¼Abilityï¼
â   â   â   âââ MultitonPage.etsâ       # multitonæ¨¡å¼å¯¹åºé¡µé¢
â   â   â   âââ SpecifiedPage.etsâ      # specifiedæ¨¡å¼å¯¹åºé¡µé¢
â   â   âââ resources        # éæèµæºç®å½ï¼æ ä¿®æ¹ï¼
â   â   âââ module.json5     # æ¨¡åéç½®æä»¶ï¼æ°å¢Ability+éç½®å¯å¨æ¨¡å¼+AbilityStageï¼
âââ å¶ä»ç®å½ï¼æå»º/æµè¯ç¸å³ï¼æ ä¿®æ¹ï¼
</code></pre>
<h3 id="äºç¬¬ä¸æ­¥åå»ºèªå®ä¹-abilitystage">ï¼äºï¼ç¬¬ä¸æ­¥ï¼åå»ºèªå®ä¹ AbilityStage</h3>
<h4 id="1-åå»ºæ­¥éª¤">1. åå»ºæ­¥éª¤</h4>
<p>â  éä¸­ <code>src/main/ets</code> ç®å½ â å³é® â New â Directory â å½åä¸º <code>application</code>ï¼<br>
â¡ è¿å¥ <code>application</code> ç®å½ â å³é® â New â ArkTS File â å½åä¸º <code>MyAbilityStage.ets</code>ã</p>
<h4 id="2-ä»£ç å®ç°">2. ä»£ç å®ç°</h4>
<pre><code class="language-javascript">import { AbilityStage, Want } from '@kit.AbilityKit';
import { hilog } from '@kit.PerformanceAnalysisKit';

const TAG = '[Sample_StartMode]';
const DOMAIN = 0x0000;

// ç»§æ¿ç³»ç»AbilityStageï¼å®ç°èªå®ä¹é»è¾
export default class MyAbilityStage extends AbilityStage {
    // AbilityStageåå§åçå½å¨æï¼æ¨¡åå è½½æ¶è§¦åï¼
    onCreate() {
        hilog.info(DOMAIN, TAG, 'MyAbilityStage åå§åæå');
    }

    // æ ¸å¿æ¹æ³ï¼ä¸ºspecifiedæ¨¡å¼çæå®ä¾å¯ä¸æ è¯
    onAcceptWant(want: Want): string {
        hilog.info(DOMAIN, TAG, 'å¼å§å¤çspecifiedæ¨¡å¼å®ä¾æ è¯');
        
        // ä»å¯¹SpecifiedAbilityåæ è¯å¤çï¼é¿åå½±åå¶ä»Ability
        if (want &amp;&amp; want.abilityName === 'SpecifiedAbility') {
            // ä»Wantåæ°ä¸­æåä¸å¡å¯ä¸æ è¯instanceKey
            const instanceKey = want.parameters?.instanceKey;
            // æææKeyåæ¼æ¥å¯ä¸æ è¯ï¼æ åè¿åç©ºï¼åå»ºæ°å®ä¾ï¼
            if (instanceKey) {
                return `SpecifiedAbility_${instanceKey}`;
            }
        }
        
        // éspecifiedæ¨¡å¼/æ ææKeyï¼è¿åç©ºå­ç¬¦ä¸²
        return '';
    }
}
</code></pre>
<h3 id="ä¸ç¬¬äºæ­¥åå»ºä¸ç§æ¨¡å¼ç-uiability-åå¯¹åºé¡µé¢">ï¼ä¸ï¼ç¬¬äºæ­¥ï¼åå»ºä¸ç§æ¨¡å¼ç UIAbility åå¯¹åºé¡µé¢</h3>
<h4 id="1-singleton-æ¨¡å¼entryabilityé»è®¤æ éä¿®æ¹">1. singleton æ¨¡å¼ï¼EntryAbilityï¼é»è®¤æ éä¿®æ¹ï¼</h4>
<ul>
<li>å¯å¨æ¨¡å¼é»è®¤ä¸º singletonï¼æ éå¨ module.json5 ä¸­é¢å¤éç½®</li>
<li>æ ¸å¿ä¿®æ¹ï¼å°é»è®¤é¡µé¢æ¹ä¸ºæµè¯é¦é¡µ <code>pages/Home</code>ï¼ä½ä¸ºæææ¨¡å¼çå¯å¨å¥å£</li>
</ul>
<pre><code class="language-javascript">// entryability/EntryAbility.ets å³é®ä»£ç 
onWindowStageCreate(windowStage: window.WindowStage): void {
    windowStage.loadContent('pages/Home'); // æ¹ä¸ºæµè¯é¦é¡µ
}
</code></pre>
<h4 id="2-multiton-æ¨¡å¼multitonability--multitonpage">2. multiton æ¨¡å¼ï¼MultitonAbility + MultitonPage</h4>
<h5 id="1åå»º-multitonability">ï¼1ï¼åå»º MultitonAbility</h5>
<p>éä¸­ <code>src/main/ets</code> â å³é® â New â Ability â å½åä¸º <code>MultitonAbility</code>ï¼ä»£ç å®ç°å¦ä¸ï¼æ ¸å¿ï¼æ¯æ¬¡å¯å¨è§¦å onCreateï¼ï¼</p>
<pre><code class="language-javascript">import { UIAbility, AbilityConstant, Want } from '@kit.AbilityKit';
import { window } from '@kit.ArkUI';
import { hilog } from '@kit.PerformanceAnalysisKit';
import { BusinessError } from '@ohos.base';

const TAG = 'MultitonAbility';
const DOMAIN = 0x0000;

export default class MultitonAbility extends UIAbility {
    // æ¯æ¬¡å¯å¨é½ä¼è§¦åï¼å¤å®ä¾æ¨¡å¼æ ¸å¿ç¹å¾ï¼
    onCreate(want: Want, launchParam: AbilityConstant.LaunchParam) {
        // çææ¶é´æ³ä½ä¸ºå®ä¾å¯ä¸IDï¼åºåä¸åå®ä¾
        const instanceId = `å®ä¾ID_${Date.now()}`;
        hilog.info(DOMAIN, TAG, `å¤å®ä¾åå»ºæåï¼${instanceId}`);
    }

    // å è½½å¤å®ä¾å¯¹åºé¡µé¢
    onWindowStageCreate(windowStage: window.WindowStage): void {
        windowStage.loadContent('pages/MultitonPage')
            .catch((err: BusinessError) =&gt; {
                hilog.error(DOMAIN, TAG, `é¡µé¢å è½½å¤±è´¥ï¼${err.message}`);
            });
    }
}
</code></pre>
<h5 id="2åå»º-multitonpage">ï¼2ï¼åå»º MultitonPage</h5>
<p>éä¸­ <code>src/main/ets/pages</code> â å³é® â New â Page â å½åä¸º <code>MultitonPage</code>ï¼ä»£ç å®ç°å¦ä¸ï¼</p>
<pre><code class="language-javascript">@Entry
@Component
struct MultitonPage {
    @State message: string = 'å¤å®ä¾ï¼multitonï¼æ¨¡å¼é¡µé¢';
    // æ¾ç¤ºå½åå®ä¾åå»ºæ¶é´ï¼ç´è§åºåä¸åå®ä¾
    @State createTime: string = `åå»ºæ¶é´ï¼${new Date().toLocaleTimeString()}`;

    build() {
        Column({ space: 20, alignItems: ItemAlign.Center }) {
            Text(this.message)
                .fontSize(30)
                .fontWeight(FontWeight.Bold);
                
            Text(this.createTime)
                .fontSize(20)
                .fontColor(Color.Blue);
                
            Text('æ¯æ¬¡ç¹å»å¯å¨é½ä¼åå»ºæ°å®ä¾ï¼å®ä¾ç¸äºç¬ç«')
                .fontSize(16)
                .fontColor(Color.Grey);
        }
        .width('100%')
        .height('100%')
        .justifyContent(FlexAlign.Center);
    }
}
</code></pre>
<h4 id="3-specified-æ¨¡å¼specifiedability--specifiedpage">3. specified æ¨¡å¼ï¼SpecifiedAbility + SpecifiedPage</h4>
<h5 id="1åå»º-specifiedability">ï¼1ï¼åå»º SpecifiedAbility</h5>
<p>éä¸­ <code>src/main/ets</code> â å³é® â New â Ability â å½åä¸º <code>SpecifiedAbility</code>ï¼ä»£ç å®ç°å¦ä¸ï¼æ ¸å¿ï¼å¤ç¨å®ä¾æ¶è§¦å onNewWantï¼ï¼</p>
<pre><code class="language-javascript">import { UIAbility, AbilityConstant, Want } from '@kit.AbilityKit';
import { window, AppStorage } from '@kit.ArkUI';
import { hilog } from '@kit.PerformanceAnalysisKit';
import { BusinessError } from '@ohos.base';

const TAG = 'SpecifiedAbility';
const DOMAIN = 0x0000;

export default class SpecifiedAbility extends UIAbility {
    private currentInstanceKey: string = 'default';

    // æ°æ è¯ï¼åå»ºå®ä¾æ¶è§¦å
    onCreate(want: Want, launchParam: AbilityConstant.LaunchParam) {
        this.currentInstanceKey = `${want.parameters?.instanceKey}` || 'default';
        // åæ­¥æ è¯å°é¡µé¢ï¼ç¨äºå±ç¤º
        AppStorage.setOrCreate('instanceKey', `å½åå®ä¾Keyï¼${this.currentInstanceKey}`);
        hilog.info(DOMAIN, TAG, `æå®å®ä¾åå»ºæåï¼${this.currentInstanceKey}`);
    }

    // åæ è¯ï¼å¤ç¨å®ä¾æ¶è§¦åï¼æ ¸å¿ï¼æ¿ä»£onCreateï¼
    onNewWant(want: Want, launchParam: AbilityConstant.LaunchParam) {
        this.currentInstanceKey = `${want.parameters?.instanceKey}` || 'default';
        AppStorage.setOrCreate('instanceKey', `å½åå®ä¾Keyï¼${this.currentInstanceKey}`);
        hilog.info(DOMAIN, TAG, `æå®å®ä¾å¤ç¨æåï¼${this.currentInstanceKey}`);
    }

    // å è½½æå®å®ä¾å¯¹åºé¡µé¢
    onWindowStageCreate(windowStage: window.WindowStage): void {
        windowStage.loadContent('pages/SpecifiedPage')
            .catch((err: BusinessError) =&gt; {
                hilog.error(DOMAIN, TAG, `é¡µé¢å è½½å¤±è´¥ï¼${err.message}`);
            });
    }
}
</code></pre>
<h5 id="2åå»º-specifiedpage">ï¼2ï¼åå»º SpecifiedPage</h5>
<p>éä¸­ <code>src/main/ets/pages</code> â å³é® â New â Page â å½åä¸º <code>SpecifiedPage</code>ï¼ä»£ç å®ç°å¦ä¸ï¼éè¿ AppStorage åæ­¥å®ä¾æ è¯ï¼ï¼</p>
<pre><code class="language-javascript">@Entry
@Component
struct SpecifiedPage {
    @State message: string = 'æå®å®ä¾ï¼specifiedï¼æ¨¡å¼é¡µé¢';
    // ååç»å®Abilityä¸­çå®ä¾æ è¯ï¼å®æ¶æ´æ°
    @StorageLink('instanceKey') instanceKey: string = 'å½åå®ä¾Keyï¼default';

    build() {
        Column({ space: 20, alignItems: ItemAlign.Center }) {
            Text(this.message)
                .fontSize(30)
                .fontWeight(FontWeight.Bold);
                
            Text(this.instanceKey)
                .fontSize(20)
                .fontColor(Color.Green);
                
            Text('ç¸åKeyå¤ç¨å®ä¾ï¼ä¸åKeyåå»ºæ°å®ä¾')
                .fontSize(16)
                .fontColor(Color.Grey);
        }
        .width('100%')
        .height('100%')
        .justifyContent(FlexAlign.Center);
    }
}
</code></pre>
<h4 id="4-æµè¯é¦é¡µhomepageå¯å¨åæ¨¡å¼-ability-å¥å£">4. æµè¯é¦é¡µï¼HomePageï¼å¯å¨åæ¨¡å¼ Ability å¥å£ï¼</h4>
<p>ä¿®æ¹ <code>src/main/ets/pages/Home.ets</code>ï¼å®ç°ä¸ä¸ªæ¨¡å¼çå¯å¨æé®ä»£ç å¦ä¸ï¼</p>
<pre><code class="language-javascript">import { common, Want } from '@kit.AbilityKit';
import { getContext } from '@kit.ArkUI';
import { BusinessError } from '@ohos.base';

@Entry
@Component
struct Home {
    @State message: string = 'UIAbility å¯å¨æ¨¡å¼æµè¯';
    // è·åé¡µé¢ä¸ä¸æï¼ç¨äºå¯å¨Ability
    private context: common.UIAbilityContext = getContext(this) as common.UIAbilityContext;

    // å¯å¨multitonæ¨¡å¼ï¼å¤å®ä¾ï¼
    private launchMultiton() {
        const want: Want = {
            bundleName: 'com.sanxiu.firstapp',
            abilityName: 'MultitonAbility',
            parameters: { timestamp: Date.now().toString() }
        };
        this.context.startAbility(want).catch((err: BusinessError) =&gt; {
            console.error('å¯å¨å¤å®ä¾å¤±è´¥ï¼', err);
        });
    }

    // å¯å¨specifiedæ¨¡å¼ï¼æå®å®ä¾ï¼ä¼ åinstanceKeyï¼
    private launchSpecified(key: string) {
        const want: Want = {
            bundleName: 'com.sanxiu.firstapp',
            abilityName: 'SpecifiedAbility',
            parameters: { instanceKey: key }
        };
        this.context.startAbility(want).catch((err: BusinessError) =&gt; {
            console.error(`å¯å¨æå®å®ä¾${key}å¤±è´¥ï¼`, err);
        });
    }

    build() {
        Column({ space: 15, alignItems: ItemAlign.Center }) {
            Text(this.message)
                .fontSize(30)
                .fontWeight(FontWeight.Bold)
                .margin(20);
            
            // åå®ä¾æ¨¡å¼ï¼é»è®¤EntryAbilityï¼æ­¤å¤ä»ä½è¯´æï¼
            Text('singletonï¼å¨å±å¯ä¸ï¼å½åé¦é¡µï¼')
                .fontSize(16)
                .fontColor(Color.Grey);
            
            // å¤å®ä¾æ¨¡å¼å¯å¨æé®
            Button('å¯å¨multitonï¼å¤å®ä¾ï¼', { type: ButtonType.Capsule })
                .width('80%')
                .height(50)
                .onClick(() =&gt; this.launchMultiton());
            
            // æå®å®ä¾æ¨¡å¼å¯å¨æé®ï¼ä¸åKeyï¼
            Button('å¯å¨specifiedï¼Key=chat_1001ï¼', { type: ButtonType.Capsule })
                .width('80%')
                .height(50)
                .onClick(() =&gt; this.launchSpecified('chat_1001'));
                
            Button('å¯å¨specifiedï¼Key=chat_1002ï¼', { type: ButtonType.Capsule })
                .width('80%')
                .height(50)
                .onClick(() =&gt; this.launchSpecified('chat_1002'));
                
            Button('åæ¬¡å¯å¨specifiedï¼Key=chat_1001ï¼', { type: ButtonType.Capsule })
                .width('80%')
                .height(50)
                .onClick(() =&gt; this.launchSpecified('chat_1001'));
        }
        .width('100%')
        .height('100%')
        .justifyContent(FlexAlign.Center);
    }
}
</code></pre>
<h3 id="åç¬¬ä¸æ­¥éç½®æä»¶ä¿®æ¹æ ¸å¿å¯å¨æ¨¡å¼--abilitystage">ï¼åï¼ç¬¬ä¸æ­¥ï¼éç½®æä»¶ä¿®æ¹ï¼æ ¸å¿ï¼å¯å¨æ¨¡å¼ + AbilityStageï¼</h3>
<h4 id="1-é¡µé¢è·¯ç±æ³¨åmain_pagesjson">1. é¡µé¢è·¯ç±æ³¨åï¼main_pages.json</h4>
<p>éè¿pageåå»ºçé¡µé¢ï¼è·¯ç±è·¯å¾èªå¨çæï¼éè¿ArkTS File åå»ºéæå¨ç®¡çè·¯ç±ã<br>
è·¯ç±è·¯å¾ï¼<code>src/main/resources/base/profile/main_pages.json</code></p>
<pre><code class="language-json">{
  "src": [
    "pages/Index",
    "pages/Home",
    "pages/MultitonPage",
    "pages/SpecifiedPage"
  ]
}
</code></pre>
<h4 id="2-æ¨¡åæ ¸å¿éç½®modulejson5å¯å¨æ¨¡å¼--abilitystage-éç½®">2. æ¨¡åæ ¸å¿éç½®ï¼module.json5ï¼å¯å¨æ¨¡å¼ + AbilityStage éç½®ï¼</h4>
<p>åå»ºAbilityçæ¶åç³»ç»ä¼èªå¨å¨<code>abilities</code>åå»ºå¯¹åºçéç½®ï¼ä½éè¦æå¨ä¿®æ¹å¯å¨æ¨¡å¼ãèªå®ä¹AbilityStageéæå¨éç½®å è½½è·¯å¾ãä¿®æ¹å®æåæå¨Sync Nowåæ­¥éç½®.</p>
<pre><code class="language-json">{
  "module": {
    "name": "entry",
    "type": "entry",
    "description": "$string:module_desc",
    "srcEntry": "./ets/application/MyAbilityStage.ets", // æå¨æ°å¢
    "mainElement": "EntryAbility",
    "deviceTypes": [
      "phone"
    ],
    "deliveryWithInstall": true,
    "installationFree": false,
    "pages": "$profile:main_pages",
    "abilities": [
      {
        "name": "EntryAbility",
        "srcEntry": "./ets/entryability/EntryAbility.ets",
        "description": "$string:EntryAbility_desc",
        "icon": "$media:layered_image",
//        "label": "$string:EntryAbility_label",
        "startWindowIcon": "$media:app_module_icon",
        "startWindowBackground": "$color:start_window_background",
        "exported": true,
        "launchType": "singleton",  // é»è®¤çå¯å¨æ¨¡å¼ï¼å¯ä»¥ä¸å

        "skills": [
          {
            "entities": [
              "entity.system.home"
            ],
            "actions": [
              "ohos.want.action.home"
            ]
          }
        ]
      },
      {
        "name": "MultitonAbility",
        "launchType": "multiton", // å¤å®ä¾æ¨¡å¼
        "srcEntry": "./ets/multitonability/MultitonAbility.ets",
        "description": "$string:MultitonAbility_desc",
        "icon": "$media:layered_image",
        "label": "$string:MultitonAbility_label",
        "startWindowIcon": "$media:startIcon",
        "startWindowBackground": "$color:start_window_background"
      },
      {
        "name": "SpecifiedAbility",
        "launchType": "specified", // æå®æ¨¡å¼
        "srcEntry": "./ets/specifiedability/SpecifiedAbility.ets",
        "description": "$string:SpecifiedAbility_desc",
        "icon": "$media:layered_image",
        "label": "$string:SpecifiedAbility_label",
        "startWindowIcon": "$media:startIcon",
        "startWindowBackground": "$color:start_window_background"
      }
    ],
    "extensionAbilities": [
      {
        "name": "EntryBackupAbility",
        "srcEntry": "./ets/entrybackupability/EntryBackupAbility.ets",
        "type": "backup",
        "exported": false,
        "metadata": [
          {
            "name": "ohos.extension.backup",
            "resource": "$profile:backup_config"
          }
        ],
      }
    ]
  }
}
</code></pre>
<h3 id="äºç¬¬åæ­¥éç½®ä¸åè½éªè¯">ï¼äºï¼ç¬¬åæ­¥ï¼éç½®ä¸åè½éªè¯</h3>
<h4 id="1-abilitystage-éç½®éªè¯">1. AbilityStage éç½®éªè¯</h4>
<p>è¿è¡é¡¹ç®åï¼æ¥çæ¥å¿æ§å¶å°ï¼è¥è¾åºä»¥ä¸æ¥å¿ï¼è¯´æèªå®ä¹ AbilityStage åå§åæåï¼</p>
<pre><code>[Sample_StartMode] MyAbilityStage åå§åæå
</code></pre>
<h4 id="2-ä¸ç§æ¨¡å¼è¡ä¸ºéªè¯">2. ä¸ç§æ¨¡å¼è¡ä¸ºéªè¯</h4>
<table>
<thead>
<tr>
<th>æä½</th>
<th>é¢æç°è±¡</th>
<th>éªè¯ç¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¤æ¬¡ç¹å»ãå¯å¨multitonã</td>
<td>æ¯æ¬¡çææ°çªå£ï¼åå»ºæ¶é´ä¸å</td>
<td>å¤å®ä¾æ¨¡å¼æ¯æ¬¡è§¦åonCreate</td>
</tr>
<tr>
<td>é¦æ¬¡ç¹å»ãKey=chat_1001ã</td>
<td>çææ°çªå£ï¼æ¾ç¤ºKey=chat_1001</td>
<td>æå®å®ä¾æ°æ è¯è§¦åonCreate</td>
</tr>
<tr>
<td>åæ¬¡ç¹å»ãKey=chat_1001ã</td>
<td>å¤ç¨åæçªå£ï¼æ¥å¿è¾åºâå¤ç¨æåâ</td>
<td>æå®å®ä¾åæ è¯è§¦åonNewWant</td>
</tr>
<tr>
<td>ç¹å»ãKey=chat_1002ã</td>
<td>çææ°çªå£ï¼æ¾ç¤ºKey=chat_1002</td>
<td>æå®å®ä¾ä¸åæ è¯è§¦åonCreate</td>
</tr>
<tr>
<td>éå¤è¿åé¦é¡µåæå¼</td>
<td>singletonæ¨¡å¼å§ç»ä¸ºåä¸ä¸ªçªå£</td>
<td>åå®ä¾æ¨¡å¼å¨å±å¯ä¸</td>
</tr>
</tbody>
</table>
<h2 id="åæ ¸å¿å·®å¼æ»ç»ä¸ç§å¯å¨æ¨¡å¼å¯¹æ¯">åãæ ¸å¿å·®å¼æ»ç»ï¼ä¸ç§å¯å¨æ¨¡å¼å¯¹æ¯</h2>
<table>
<thead>
<tr>
<th>ç¹æ§</th>
<th>singletonï¼åå®ä¾ï¼</th>
<th>multitonï¼å¤å®ä¾ï¼</th>
<th>specifiedï¼æå®å®ä¾ï¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®ä¾æ°é</td>
<td>å¨å±å¯ä¸</td>
<td>æ éå¶ï¼æ¯æ¬¡æ°å»º</td>
<td>ææ è¯åç»ï¼æ¯ç»ä¸ä¸ª</td>
</tr>
<tr>
<td>å¤ç¨è§å</td>
<td>å§ç»å¤ç¨å·²æå®ä¾</td>
<td>æ°¸ä¸å¤ç¨ï¼æ¯æ¬¡æ°å»º</td>
<td>ç¸åæ è¯å¤ç¨ï¼ä¸åæ è¯æ°å»º</td>
</tr>
<tr>
<td>æ ¸å¿çå½å¨æ</td>
<td>é¦æ¬¡onCreateï¼åç»­onNewWant</td>
<td>æ¯æ¬¡å¯å¨åonCreate</td>
<td>æ°æ è¯onCreateï¼åæ è¯onNewWant</td>
</tr>
<tr>
<td>ä¾èµAbilityStage</td>
<td>å¦</td>
<td>å¦</td>
<td>æ¯ï¼å¿é¡»èªå®ä¹å®ç°ï¼</td>
</tr>
<tr>
<td>å³é®åæ°</td>
<td>æ </td>
<td>æ </td>
<td>instanceKeyï¼ä¸å¡å¯ä¸æ è¯ï¼</td>
</tr>
<tr>
<td>éç¨åºæ¯</td>
<td>ä¸»çé¢ãä¸ªäººä¸­å¿ãè´­ç©è½¦</td>
<td>å¤æ ç­¾é¡µãå¤ææ¡£ç¼è¾</td>
<td>èå¤©çªå£ãååè¯¦æé¡µãæä¸å¡éç¦»</td>
</tr>
<tr>
<td>éè¯¯ç æ³¨æ</td>
<td>å¯å¨ä¸­éå¤è°ç¨è¿å16000082</td>
<td>æ </td>
<td>æ è¯ä¸å¯ä¸ä¼å¯¼è´å®ä¾éè¯¯å¤ç¨</td>
</tr>
</tbody>
</table>
<h2 id="äºå®æå³é®æ³¨æäºé¡¹">äºãå®æå³é®æ³¨æäºé¡¹</h2>
<ol>
<li><strong>éç½®çæè§å</strong>ï¼ä¿®æ¹ module.json5ï¼å¯å¨æ¨¡å¼/AbilityStageï¼ æ AbilityStage ä»£ç åï¼<strong>ç­éè½½/ç­æ´æ°åä¸çæ</strong>ï¼å¿é¡»<strong>åæ­¢åºç¨è¿ç¨ â éæ°è¿è¡é¡¹ç®</strong>ï¼å¦åç³»ç»æ æ³è¯å«éç½®åæ´ã</li>
<li><strong>AbilityStage è·¯å¾æ ¡éª</strong>ï¼<code>srcEntry</code> è·¯å¾å¿é¡»ä¸å®éæä»¶è·¯å¾å®å¨ä¸è´ï¼é¸¿èç³»ç»<strong>ä¸¥æ ¼åºåå¤§å°å</strong>ï¼è·¯å¾éè¯¯ä¼å¯¼è´ AbilityStage åå§åå¤±è´¥ã</li>
<li><strong>instanceKey å¤ç©º</strong>ï¼å¨ AbilityStage ç onAcceptWant æ¹æ³ä¸­ï¼å¿é¡»å¯¹ instanceKey åç©ºå¼å¤æ­ï¼é¿åå åæ°ç¼ºå¤±å¯¼è´æ è¯çæå¤±è´¥ã</li>
<li><strong>æ è¯å¯ä¸æ§</strong>ï¼onAcceptWant è¿åçæ è¯å¿é¡»<strong>å¨å±å¯ä¸</strong>ï¼å»ºè®®æ¼æ¥ AbilityName + ä¸å¡å¯ä¸å¼ï¼é¿åä¸å Ability çæ è¯å²çªã</li>
<li><strong>AppStorage ä½ç¨</strong>ï¼specified æ¨¡å¼ä¸­ï¼éè¿ AppStorage + @StorageLink å®ç° Ability ä¸é¡µé¢ç<strong>ç¶æåååæ­¥</strong>ï¼å¤ç¨å®ä¾æ¶é¡µé¢è½å®æ¶æ´æ°ä¸å¡æ è¯ã</li>
<li><strong>onNewWant æ ¸å¿</strong>ï¼specified/singleton æ¨¡å¼ä¸­ï¼å¤ç¨å®ä¾æ¶ä¸ä¼è§¦å onCreateï¼ææå¯å¨åæ°çå¤çå¿é¡»æ¾å¨ <strong>onNewWant</strong> æ¹æ³ä¸­ï¼å¦åä¼å¯¼è´åæ°ä¸¢å¤±ã</li>
</ol>
<h2 id="å­åå®¹æ»ç»">å­ãåå®¹æ»ç»</h2>
<ol>
<li>å¯å¨æ¨¡å¼ç<strong>æ¬è´¨</strong>æ¯ãç³»ç»å¯¹ UIAbility å®ä¾çç®¡çç­ç¥ãï¼æ ¸å¿è§£å³âåå»ºæ°å®ä¾è¿æ¯å¤ç¨å·²æå®ä¾âçé®é¢ã</li>
<li>ä¸ç§æ¨¡å¼åæéç¨åºæ¯ï¼æ ¸å¿éæ©ä¾æ®æ¯<strong>ãä¸å¡æ¯å¦éè¦å¯ä¸å®ä¾ã</strong>å<strong>ãæ¯å¦éè¦æä¸å¡ç»´åº¦éç¦»å®ä¾ã</strong>ã</li>
<li>AbilityStage æ¯<strong>æ¨¡åçº§çå½å¨æç®¡çå¨</strong>ï¼ä¹æ¯ specified æ¨¡å¼ç<strong>å¿è¦æ¡ä»¶</strong>ï¼å¶æ ¸å¿ä½ç¨æ¯ä¸º specified æ¨¡å¼çæ<strong>å®ä¾å¯ä¸æ è¯</strong>ã</li>
<li>specified æ¨¡å¼çæ ¸å¿é»è¾æ¯ï¼<strong>å¯å¨ä¼ å instanceKey â AbilityStage çæå¯ä¸æ è¯ â ç³»ç»ææ è¯å¹é/å¤ç¨å®ä¾ â å¤ç¨è§¦å onNewWant</strong>ã</li>
<li>çå½å¨æèå¨çæ ¸å¿è§åï¼<strong>åå»ºå®ä¾è§¦å onCreateï¼å¤ç¨å®ä¾è§¦å onNewWant</strong>ï¼onWindowStageCreate/onForeground ç­æ¹æ³ä¸åå¯å¨æ¨¡å¼å½±åï¼æéè§¦åã</li>
</ol>
<h2 id="ä¸ä»£ç ä»åº">ä¸ãä»£ç ä»åº</h2>
<ul>
<li>å·¥ç¨åç§°ï¼FirstApplication</li>
<li>ä»åºå°åï¼<a href="https://gitee.com/HarmonyOS-UI-Basics/harmony-os-ui-basics.git" target="_blank" rel="noopener nofollow">https://gitee.com/HarmonyOS-UI-Basics/harmony-os-ui-basics.git</a></li>
</ul>
<h2 id="å«ä¸èé¢å">å«ãä¸èé¢å</h2>
<p>ä¸ä¸èæä»¬å°å­¦ä¹  <strong>Contextä¸ä¸ææ ¸å¿è®²è§£ä¸å®æ</strong>ï¼éç¹ææ¡ï¼</p>
<ol>
<li>çè§£ Context æ ¸å¿å®ä½åâåºç¨âæ¨¡åâç»ä»¶âUIå®ä¾âå±çº§å³ç³»ï¼è½ç²¾åè·ååå±çº§ Context å®ä¾ï¼</li>
<li>ææ¡ 5 ç±» Context é«é¢æ ¸å¿è½åï¼æä»¶è®¿é®ãç¯å¢çå¬ãå å¯ååºãUIäº¤äºãæ©å±è½åï¼ï¼å®ç°åºç¡ä¸å¡é­ç¯ï¼</li>
<li>æç¡® Context è½åè¾¹çä¸æ ¸å¿çº¦æï¼çå½å¨æï¼ï¼è§é¿å¼åè¸©åï¼</li>
<li>åºåä¸å Context éç¨åºæ¯ï¼è½ç»åå®éä¸å¡éæ©æä¼ä¸ä¸æã</li>
</ol>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 11:33">2026-02-09 11:33</span>&nbsp;
<a href="https://www.cnblogs.com/san-xiu">é¸¿è-æ£ä¿®</a>&nbsp;
éè¯»(<span id="post_view_count">6</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19594371);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19594371', targetLink: 'https://www.cnblogs.com/san-xiu/p/19594371', title: 'é¸¿èåºç¨å¼åUIåºç¡ç¬¬åèï¼UIAbility å¯å¨æ¨¡å¼è¯¦è§£' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#11-Immutableç¶æç»´æ¤ä¸å¢éæ¸²æ ]]></title>
    <link>https://www.cnblogs.com/WindrunnerMax/p/19594114</link>
    <guid>2d32f90dbc86396c4ad18c98554ac840</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/WindrunnerMax/p/19594114" title="åå¸äº 2026-02-09 10:51">
    <span role="heading" aria-level="2">ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#11-Immutableç¶æç»´æ¤ä¸å¢éæ¸²æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨ååæä»¬è®¨è®ºäºè§å¾å±çééå¨è®¾è®¡ï¼ä¸»è¦æ¯å¨éçè§å¾åå§åæ¸²æï¼åæ¬çå½å¨æåæ­¥ãç¶æç®¡çãæ¸²ææ¨¡å¼ã<code>DOM</code>æ å°ç¶æç­ãå¨è¿éæä»¬éè¦å¤çåæ´çå¢éæ´æ°ï¼è¿å±äºæ§è½æ¹é¢çèéï¼éè¦èèå¦ä½å®ç°ä¸å¯åçç¶æå¯¹è±¡ï¼ä»¥æ­¤æ¥å®ç°<code>Op</code>æä½ä»¥åæå°å<code>DOM</code>åæ´ã</p>
<ul>
<li>å¼æºå°å: <a href="https://github.com/WindRunnerMax/BlockKit" target="_blank" rel="noopener nofollow">https://github.com/WindRunnerMax/BlockKit</a></li>
<li>å¨çº¿ç¼è¾: <a href="https://windrunnermax.github.io/BlockKit/" target="_blank" rel="noopener nofollow">https://windrunnermax.github.io/BlockKit/</a></li>
<li>é¡¹ç®ç¬è®°: <a href="https://github.com/WindRunnerMax/BlockKit/blob/master/NOTE.md" target="_blank" rel="noopener nofollow">https://github.com/WindRunnerMax/BlockKit/blob/master/NOTE.md</a></li>
</ul>
<details>
<summary><strong>ä»é¶å®ç°å¯ææ¬ç¼è¾å¨ç³»åæç« </strong></summary>
<ul>
<li><a href="https://www.cnblogs.com/WindrunnerMax/p/18816107" target="_blank">æ·±æä¸æ æé¿ï¼åå¤è¯çä»é¶å¼å§åä¸ªå¯ææ¬ç¼è¾å¨</a></li>
<li><a href="https://www.cnblogs.com/WindrunnerMax/p/18826249" target="_blank">ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#2-åºäºMVCæ¨¡å¼çç¼è¾å¨æ¶æè®¾è®¡</a></li>
<li><a href="https://www.cnblogs.com/WindrunnerMax/p/18840221" target="_blank">ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#3-åºäºDeltaççº¿æ§æ°æ®ç»ææ¨¡å</a></li>
<li><a href="https://www.cnblogs.com/WindrunnerMax/p/18899981" target="_blank">ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#4-æµè§å¨éåºæ¨¡åçæ ¸å¿äº¤äºç­ç¥</a></li>
<li><a href="https://www.cnblogs.com/WindrunnerMax/p/18921725" target="_blank">ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#5-ç¼è¾å¨éåºæ¨¡åçç¶æç»æè¡¨è¾¾</a></li>
<li><a href="https://www.cnblogs.com/WindrunnerMax/p/19022750" target="_blank">ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#6-æµè§å¨éåºä¸ç¼è¾å¨éåºæ¨¡ååæ­¥</a></li>
<li><a href="https://www.cnblogs.com/WindrunnerMax/p/19069539" target="_blank">ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#7-åºäºç»åäºä»¶çååæ§è¾å¥æ¨¡å¼</a></li>
<li><a href="https://www.cnblogs.com/WindrunnerMax/p/19152103" target="_blank">ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#8-æµè§å¨è¾å¥æ¨¡å¼çéåæ§DOMè¡ä¸º</a></li>
<li><a href="https://www.cnblogs.com/WindrunnerMax/p/19381254" target="_blank">ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#9-ç¼è¾å¨ææ¬ç»æåæ´çåæ§å¤ç</a></li>
<li><a href="https://www.cnblogs.com/WindrunnerMax/p/19470679" target="_blank">ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#10-Reactè§å¾å±ééå¨çæ¨¡å¼æ©å±</a></li>
<li><a href="" rel="noopener nofollow">ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#11-Immutableç¶æç»´æ¤ä¸å¢éæ¸²æ</a></li>
</ul>
</details>
<h2 id="è¡çº§ä¸å¯åç¶æ">è¡çº§ä¸å¯åç¶æ</h2>
<p>å¨è¿éæä»¬åä¸å¼å¥è§å¾å±çæ¸²æé®é¢ï¼èæ¯ä»å¨<code>Model</code>å±é¢ä¸å®ç°ç²¾ç»åçå¤çï¼å·ä½æ¥è¯´å°±æ¯å®ç°ä¸å¯åçç¶æå¯¹è±¡ï¼ä»æ´æ°çèç¹æä¼è¢«éæ°åå»ºï¼å¶ä»èç¹åç´æ¥å¤ç¨ãç±æ­¤æ³æ¥æ­¤æ¨¡åçå®ç°é¢ä¸ºå¤æï¼ä¹å¹¶æªå¼å¥<code>immer</code>ç­æ¡æ¶ï¼èæ¯ç´æ¥å¤ççç¶æå¯¹è±¡ï¼å æ­¤åä»ç®åçæ´æ°æ¨¡å¼å¼å§èèã</p>
<p>åå°æå¼å§å®ç°ç<code>State</code>æ¨¡åæ´æ°ææ¡£åå®¹ï¼æä»¬æ¯ç´æ¥éå»ºäºææç<code>LineState</code>ä»¥å<code>LeafState</code>å¯¹è±¡ï¼ç¶åå¨<code>React</code>è§å¾å±ç<code>BlockModel</code>ä¸­çå¬äº<code>OnContentChange</code>äºä»¶ï¼ä»¥æ­¤æ¥å°<code>BlockState</code>çæ´æ°åºç¨å°è§å¾å±ã</p>
<pre><code class="language-js">delta.eachLine((line, attributes, index) =&gt; {
  const lineState = new LineState(line, attributes, this);
  lineState.index = index;
  lineState.start = offset;
  lineState.key = Key.getId(lineState);
  offset = offset + lineState.length;
  this.lines[index] = lineState;
});
</code></pre>
<p>è¿ç§æ¹å¼ç®åç´æ¥ï¼å¨éæ´æ°ç¶æè½å¤ä¿è¯å¨<code>React</code>çç¶ææ´æ°ï¼ç¶èè¿ç§æ¹å¼çé®é¢å¨äºæ§è½ãå½ææ¡£åå®¹éå¸¸å¤§çæ¶åï¼å¨éè®¡ç®å°ä¼å¯¼è´å¤§éçç¶æéå»ºï¼å¹¶ä¸å¶æ¬èº«çæ¹åä¹ä¼å¯¼è´<code>React</code>ç<code>diff</code>å·®å¼è¿èå¨éæ´æ°ææ¡£è§å¾ï¼è¿æ ·çæ§è½å¼ééå¸¸æ¯ä¸å¯æ¥åçã</p>
<p>é£ä¹éå¸¸æ¥è¯´æä»¬å°±éè¦åºäºåæ´æ¥ç¡®å®ç¶æçæ´æ°ï¼é¦åæä»¬éè¦ç¡®å®æ´æ°çç²åº¦ï¼ä¾å¦ä»¥è¡ä¸ºåºååæªåæ´çæ¶åå°±ç´æ¥ååæç<code>LineState</code>ãç¸å½äºå°½å¯è½å¤ç¨<code>Origin List</code>ç¶åçæ<code>Target List</code>ï¼è¿æ ·çæ¹å¼èªç¶å¯ä»¥é¿åé¨åç¶æçéå»ºï¼å°½å¯è½å¤ç¨åæ¬çå¯¹è±¡ã</p>
<p>æ´ä½æè·¯å¤§æ¦æ¯åæ§è¡åæçæææ°çåè¡¨ï¼ç¶ååå«è®¾ç½®æ§åè¡¨åæ°åè¡¨ç<code>row</code>å<code>col</code>ä¸¤ä¸ªæéå¼ï¼ç¶åæ´æ°æ¶è®°å½èµ·å§<code>row</code>ï¼å é¤åæ°å¢èªç¶æ¯æ­£å¸¸å¤çï¼å¯¹äºæ´æ°åè®¤ä¸ºæ¯åå åå¢ãå¯¹äºåå®¹çå¤çåéè¦åå«è®¨è®ºåè¡åè·¨è¡çé®é¢ï¼ä¸­é´é¨åçåå®¹å°±ä½ä¸ºéå»ºçæä½ã</p>
<p>æåå¯ä»¥å°è¿é¨åå¢å <code>LineState</code>æ°æ®æ¾ç½®äº<code>Changes</code>ä¸­ï¼å°±å¯ä»¥å¾å°å®éå¢å ç<code>Ops</code>äºï¼è¿æ ·æä»¬å°±å¯ä»¥ä¼åé¨åçæ§è½ï¼å ä¸ºä»ååè¡¨åç®æ åè¡¨çä¸­é´é¨åæä¼éå»ºï¼å¶ä»é¨åçè¡ç¶æç´æ¥å¤ç¨ãæ­¤å¤è¿é¨åæ°æ®å¨<code>apply</code>ç<code>delta</code>ä¸­æ¯ä¸å­å¨çï¼åæ ·å¯ä»¥è®¤ä¸ºæ¯æ°æ®çè¡¥åã</p>
<pre><code class="language-js">  Origin List (Old)                          Target List (New)
+-------------------+                      +-------------------+
| [0] LineState A   | &lt;---- Retain ------&gt; | [0] LineState A   | (Reused)
+-------------------+                      +-------------------+
| [1] LineState B   |          |           | [1] LineState B2  | (Update)
+-------------------+       Changes        |     (Modified)    | (Del C)
| [2] LineState C   |          |           +-------------------+
+-------------------+          V           | [2] NewState X    | (Inserted)
| [3] LineState D   | ---------------\     +-------------------+
+-------------------+                 \--&gt; | [3] LineState D   | (Reused)
| [4] LineState E   | &lt;---- Retain ------&gt; | [4] LineState E   | (Reused)
+-------------------+                      +-------------------+
</code></pre>
<p>é£ä¹è¿éå®éä¸æ¯å­å¨éå¸¸éè¦å³æ³¨çç¹ï¼æä»¬ç°å¨ç»´æ¤çæ¯ç¶ææ¨¡åï¼ä¹å°±æ¯è¯´ææçæ´æ°å°±ä¸åæ¯ç´æ¥ç<code>compose</code>ï¼èæ¯æä½æä»¬å®ç°çç¶æå¯¹è±¡ãæ¬è´¨ä¸æä»¬æ¯éè¦å®ç°è¡çº§å«ç<code>compose</code>æ¹æ³ï¼è¿éçå®ç°éå¸¸éè¦ï¼åå¦æä»¬å¯¹äºæ°æ®çå¤çå­å¨åå·®çè¯ï¼é£ä¹å°±ä¼å¯¼è´ç¶æåºç°é®é¢ã</p>
<p>æ­¤å¤å¨è¿ç§æ¹å¼ä¸­ï¼æä»¬å¤æ­<code>LineState</code>æ¯å¦éè¦æ°å»ºåæ¯æ ¹æ®æ´ä¸ªè¡åçææ<code>LeafState</code>æ¥éå»ºçãä¹å°±æ¯è¯´è¿ç§æ¶åæä»¬æ¯éè¦åæ¬¡å°ææç<code>op</code>éåä¸éï¼å½ç¶å®éä¸ç±äºæåè¿éè¦å°<code>compose</code>åç<code>Delta</code>åå²ä¸ºè¡çº§å«çåå®¹ï¼æä»¥å¶å®å³ä½¿å¨åºç¨åæ´åä¹æå°éè¦åéåä¸¤æ¬¡ã</p>
<p>é£ä¹æ­¤æ¶æä»¬éè¦æèä¼åæ¹åï¼é¦åæ¯é¦ä¸ª<code>retain</code>ï¼å¨è¿éæä»¬åºè¯¥ç´æ¥å®æ´å¤ç¨åæ¬ç<code>LineState</code>ï¼åæ¬å¤çåçå©ä½èç¹ä¹æ¯å¦æ­¤ãèå¯¹äºä¸­é´çèç¹ï¼æä»¬å°±éè¦ä¸ºå¶ç¬ç«è®¾è®¡æ´æ°ç­ç¥ï¼è¿é¨åçè®ºä¸æ¥è¯´æ¯éè¦å®å¨ç¬ç«å¤çä¸ºæ°çç¶æå¯¹è±¡çï¼è¿æ ·å¯ä»¥åå°é¨å<code>Leaf Op</code>çéåã</p>
<pre><code class="language-js">new Delta().retain(5).insert("xx")
insert("123"), insert("\n") // skip 
insert("456"), insert("\n") // new line state
</code></pre>
<p>å¶ä¸­ï¼å¦ææ¯æ°å»ºçèç¹ï¼æä»¬ç´æ¥æå»ºæ°ç<code>LineState</code>å³å¯ï¼å é¤çèç¹åä¸ä»åæ¬ç<code>LineState</code>ä¸­æ¾ç½®äºæ°çåè¡¨ãèå¯¹äºæ´æ°çèç¹ï¼æä»¬éè¦æ´æ°åæ¬ç<code>LineState</code>å¯¹è±¡ï¼å ä¸ºå®éä¸è¡æ¯å­å¨æ´æ°çï¼èéç¹æ¯æä»¬éè¦å°åæ¬ç<code>LineState</code>ç<code>key</code>å¼å¤ç¨ã</p>
<p>è¿éæä»¬åç®åå®ç°å®ç°æè¿°ä¸ä¸å¤ç¨çé®é¢ï¼æ¯è¾æ¹ä¾¿çå®ç°åæ¯ç´æ¥ä»¥<code>\n</code>çæ è¯ä¸ºç®æ ç<code>State</code>ï¼è¿å°±æå³çæä»¬è¦ç¬ç«<code>\n</code>ä¸ºç¬ç«çç¶æãå³å¦æå¨<code>123|456\n</code>ç<code>|</code>ä½ç½®æå¥<code>\n</code>çè¯ï¼é£ä¹æä»¬å°±æ¯<code>123</code>æ¯æ°ç<code>LineState</code>ï¼<code>456</code>æ¯åæ¬ç<code>LineState</code>ï¼ä»¥æ­¤æ¥å®ç°<code>key</code>çå¤ç¨ã</p>
<pre><code class="language-js">[
  insert("123"), insert("\n"), 
  insert("456"), insert("\n")
]
// ===&gt;
[ 
  LineState(LeafState("123"), LeafState("\n")), 
  LineState(LeafState("456"), LeafState("\n"))
]
</code></pre>
<p>å¶å®è¿éæä¸ªéå¸¸å¼å¾å³æ³¨çç¹æ¯ï¼<code>LineState</code>å¨<code>Delta</code>ä¸­æ¯æ²¡æå·ä½å¯¹åºç<code>Op</code>çï¼èç¸å¯¹åºç<code>LeafState</code>åæ¯æå·ä½ç<code>Op</code>çãè¿å°±æå³çæä»¬å¨å¤ç<code>LineState</code>çæ´æ°æ¶ï¼æ¯ä¸è½ç´æ¥æ ¹æ®åæ´æ§å¶çï¼å æ­¤å¿é¡»è¦æ¾å°è½å¤æ å°çç¶æï¼å æ­¤æç®åçæ¹æ¡å³æ ¹æ®<code>\n</code>èç¹æ å°ã</p>
<pre><code class="language-js">LeafState("\n", key="1") &lt;=&gt; LineState(key="L1")
</code></pre>
<p>å®éä¸æä»¬å¯ä»¥æ»ç»ä¸ä¸ï¼æå¼å§æä»¬èèåæ´æ°å<code>diff</code>ï¼åæ¥èèçæ¯è¾¹æ´æ°è¾¹è®°å½ãè¾¹æ´æ°è¾¹è®°å½çä¼ç¹å¨äºï¼å¯ä»¥é¿ååæ¬¡éåä¸è¾¹ææ<code>Leaf</code>èç¹çæ¶èï¼åæ¶ä¹å¯ä»¥é¿å<code>diff</code>çå¤ææ§ãä½æ¯è¿éä¹å­å¨ä¸ªé®é¢ï¼å¦æåé¨è¿è¡äºå¤æ¬¡<code>retain</code>æä½ï¼åæ æ³ç´æ¥å¤ç¨<code>LineState</code>ã</p>
<p>ä¸è¿éå¸¸æ¥è¯´ï¼æé«é¢çæä½æ¯è¾å¥åå®¹ï¼è¿ç§æåµä¸é¦æä½ä¸è¬é½æ¯<code>retain</code>ï¼å°¾æä½ä¸ºç©ºä¼æ¶éå©ä½ææ¡£åå®¹ï¼å æ­¤è¿é¨åä¼åæ¯ä¼è¢«é«é¢è§¦åçãèå¦ææ¯å¤æ¬¡çåå®¹é¨ååæ´æä½ï¼è¿é¨åè½ç¶å¯ä»¥éè¿å¤æ­è¡åçå¶å­ç»ç¹æ¯å¦åæ´ï¼æ¥å¤æ­æ¯å¦å¤ç¨è¡å¯¹è±¡ï¼ä½æ¯ä¹å­å¨ä¸å®å¤ææ§ã</p>
<p>å³äºè¿é¨åçå·ä½å®ç°ï¼å¨ç¼è¾å¨çç¶ææ¨¡åéå­å¨ç¬ç«ç<code>Mutate</code>æ¨¡åï¼è¿é¨åå®ç°å¨åè¾¹å®ç°åä¸ªæ¨¡åæ¶ä¼ç¬ç«ä»ç»ãå°è¿éæä»¬å°±å¯ä»¥å®ç°ä¸ä¸ªç®åç<code>Immutable</code>ç¶æç»´æ¤ï¼å¦æ<code>Leaf</code>èç¹åçååä¹åï¼å¶ç¶èç¹<code>Line</code>ä¼è§¦åæ´æ°ï¼èå¶ä»èç¹åå¯ä»¥ç´æ¥å¤ç¨ã</p>
<h2 id="key-å¼ç»´æ¤">Key å¼ç»´æ¤</h2>
<p>è³æ­¤æä»¬å®ç°äºä¸å¥ç®åç<code>Immutable Delta+Iterator</code>æ¥å¤çæ´æ°ï¼è¿ç§æ¶åæä»¬å°±å¯ä»¥åå©ä¸å¯åçæ¹å¼æ¥å®ç°<code>React</code>è§å¾çæ´æ°ï¼é£ä¹å¨<code>React</code>çæ¸²ææ¨¡å¼ä¸­ï¼<code>key</code>å¼çç®¡çä¹æ¯ä¸ªå¼çæ¢è®¨çé®é¢ã</p>
<p>å¨è¿éæä»¬å°±å¯ä»¥æ ¹æ®ç¶æä¸å¯åæ¥çæ<code>key</code>å¼ï¼åå©<code>WeakMap</code>æ å°å³ç³»è·åå¯¹åºçå­ç¬¦ä¸²<code>id</code>å¼ï¼æ­¤æ¶å°±å¯ä»¥åå©<code>key</code>çç®¡çä»¥å<code>React.memo</code>æ¥å®ç°è§å¾çå¤ç¨ãå¶å®å¨è¿éåæ­¥çèµ·æ¥<code>key</code>å¼åºè¯¥æ¯éè¦ä¸»å¨æ§å¶å¼ºå¶å·æ°çæ¶åï¼ä»¥åå®å¨æ¯æ°èç¹æä¼ç¨å¾å°çã</p>
<p>ä½æ¯è¿ç§æ¹å¼ä¹æ¯æé®é¢çï¼å ä¸ºæ­¤æ¶æä»¬å³ä½¿è¾å¥ç®åçåå®¹ï¼ä¹ä¼å¯¼è´æ´ä¸ªè¡ç<code>key</code>åçæ¹åï¼èæ­¤æ¶æä»¬æ¯ä¸å¿è¦æ´æ°æ­¤æ¶ç<code>key</code>çãå æ­¤<code>key</code>å¼æ¯éè¦åç¬ç»´æ¤çï¼ä¸è½ç´æ¥ä½¿ç¨ä¸å¯åçå¯¹è±¡æ¥ç´¢å¼<code>key</code>å¼ï¼é£ä¹å¦ææ¯ç´æ¥ä½¿ç¨<code>index</code>ä½ä¸º<code>key</code>å¼çè¯ï¼å°±ä¼å­å¨æ½å¨çåå°å¤ç¨é®é¢ã</p>
<p><code>key</code>å¼åå°å¤ç¨ä¼å¯¼è´ç»ä»¶çç¶æè¢«éè¯¯ä¿çï¼ä¾å¦æ­¤æ¶æä¸ªéåæ§ç®¡çç<code>input</code>ç»ä»¶åè¡¨ï¼å¨æä¸ªè¾å¥æ¡åå·²ç»è¾å¥äºåå®¹ï¼å½å¶åçé¡ºåºååæ¶ï¼åå§è¾å¥åå®¹ä¼è·éçåå°å¤ç¨çç­ç¥çå¨åå§çä½ç½®ï¼èä¸æ¯è·éå°æ°çä½ç½®ï¼å ä¸ºå¶æ´ä½åè¡¨é¡ºåº<code>key</code>æªåçååå¯¼è´<code>React</code>ç´æ¥å¤ç¨èç¹ã</p>
<p>å¨<code>LineState</code>èç¹ç<code>key</code>å¼ç»´æ¤ä¸­ï¼å¦ææ¯åå§å¼åæ¯æ ¹æ®<code>state</code>å¼ç¨èªå¢çå¼ï¼å¨åæ´çæ¶ååæ¯å°½å¯è½å°å¤ç¨åå§è¡ç<code>key</code>ï¼è¿æ ·å¯ä»¥é¿åè¿å¤çè¡èç¹éå»ºå¹¶ä¸å¯ä»¥æ§å¶æ´è¡çå¼ºå¶å·æ°ã</p>
<p>èå¯¹äº<code>LeafState</code>èç¹ç<code>key</code>å¼æå¼å§æ¯ç´æ¥ä½¿ç¨<code>index</code>å¼ï¼è¿æ ·å®éä¸ä¼å­å¨éæ§çé®é¢ï¼èå¦æç´æ¥æ ¹æ®<code>Immutable</code>æ¥çæ<code>key</code>å¼çè¯ï¼ä»»ä½ææ¬åå®¹çæ´æ¹é½ä¼å¯¼è´<code>key</code>å¼æ¹åè¿èå¯¼è´<code>DOM</code>èç¹çé¢ç¹éå»ºã</p>
<pre><code class="language-js">export const NODE_TO_KEY = new WeakMap&lt;Object.Any, Key&gt;();
export class Key {
  /** å½åèç¹ id */
  public id: string;
  /** èªå¨éå¢æ è¯ç¬¦ */
  public static n = 0;

  constructor() {
    this.id = `${Key.n++}`;
  }

  /**
   * æ ¹æ®èç¹è·å id
   * @param node
   */
  public static getId(node: Object.Any): string {
    let key = NODE_TO_KEY.get(node);
    if (!key) {
      key = new Key();
      NODE_TO_KEY.set(node, key);
    }
    return key.id;
  }
}
</code></pre>
<p>éå¸¸ä½¿ç¨<code>index</code>ä½ä¸º<code>key</code>æ¯å¯è¡çï¼ç¶èå¨ä¸äºéåæ§åºæ¯ä¸åä¼ç±äºåå°å¤ç¨é ææ¸²æé®é¢ï¼<code>diff</code>ç®æ³å¯¼è´çæ§è½é®é¢æä»¬ææ¶åä¸èèãå¨ä¸é¢çä¾å­ä¸­æä»¬å¯ä»¥çåºï¼æ¯æ¬¡æä»¬é½æ¯ä»æ°ç»é¡¶é¨å é¤åç´ ï¼èå®éç<code>input</code>å¼ææè¡¨ç°åºæ¥åæ¯å é¤äºå°¾é¨çåç´ ï¼è¿å°±æ¯åå°å¤ç¨çé®é¢ãå¨éåæ§åºæ¯ä¸æ¯è¾ææ¾ï¼èæä»¬ç<code>ContentEditable</code>ç»ä»¶å°±æ¯ä¸ä¸ªéåæ§åºæ¯ï¼å æ­¤è¿éç<code>key</code>å¼éè¦åèèä¸ä¸ã</p>
<pre><code class="language-js">const { useState, Fragment, useRef, useEffect } = React;
function App() {
  const ref = useRef&lt;HTMLParagraphElement&gt;(null);
  const [nodes, setNodes] = useState(() =&gt; Array.from({ length: 10 }, (_, i) =&gt; i));

  const onClick = () =&gt; {
    const [_, ...rest] = nodes;
    console.log(rest);
    setNodes(rest);
  };

  useEffect(() =&gt; {
    const el = ref.current;
    el &amp;&amp; Array.from(el.children).forEach((it, i) =&gt; ((it as HTMLInputElement).value = i + ""));
  }, []);

  return (
    &lt;Fragment&gt;
      &lt;p ref={ref}&gt;
        {nodes.map((_, i) =&gt; (&lt;input key={i}&gt;&lt;/input&gt;))}
      &lt;/p&gt;
      &lt;button onClick={onClick}&gt;slice&lt;/button&gt;
    &lt;/Fragment&gt;
  );
}
</code></pre>
<p>èèå°ååæå°çæä»¬ä¸å¸æä»»ä½ææ¬åå®¹çæ´æ¹é½å¯¼è´<code>key</code>å¼æ¹åå¼åéå»ºï¼å æ­¤å°±ä¸è½ç´æ¥ä½¿ç¨è®¡ç®ç<code>immutable</code>å¯¹è±¡å¼ç¨æ¥å¤ç<code>key</code>å¼ï¼èæè¿°åä¸ª<code>op</code>çæ¹æ³é¤äº<code>insert</code>å°±åªå©ä¸<code>attributes</code>äºã</p>
<p>ä½æ¯å¦æåºäº<code>attributes</code>æ¥è·å¾å°±éè¦ç²¾åæ§å¶åå¹¶<code>insert</code>çæ¶ååéè¦åæ§çå¯¹è±¡å¼ç¨ï¼ä¸æ²¡æå±æ§ç<code>op</code>å°±ä¸å¥½å¤çäºï¼å æ­¤è¿éå¯è½åªè½å°å¶è½¬ä¸ºå­ç¬¦ä¸²å¤çï¼ä½æ¯è¿æ ·åæ ·ä¸è½ä¿æ<code>key</code>çå®å¨ç¨³å®ï¼å æ­¤åå¼çç´¢å¼æ¹åå°±ä¼å¯¼è´åç»­çå¼åºç°åæ´ã</p>
<pre><code class="language-js">const prefix = new WeakMap&lt;LineState, Record&lt;string, number&gt;&gt;();
const suffix = new WeakMap&lt;LineState, Record&lt;string, number&gt;&gt;();
const mapToString = (map: Record&lt;string, string&gt;): string =&gt; {
  return Object.keys(map)
    .map(key =&gt; `${key}:${map[key]}`)
    .join(",");
};
const toKey = (state: LineState, op: Op): string =&gt; {
  const key = op.attributes ? mapToString(op.attributes) : "";
  const prefixMap = prefix.get(state) || {};
  prefix.set(state, prefixMap);
  const suffixMap = suffix.get(state) || {};
  suffix.set(state, suffixMap);
  const prefixKey = prefixMap[key] ? prefixMap[key] + 1 : 0;
  const suffixKey = suffixMap[key] ? suffixMap[key] + 1 : 0;
  prefixMap[key] = prefixKey;
  suffixMap[key] = suffixKey;
  return `${prefixKey}-${suffixKey}`;
};
</code></pre>
<p>å¨<code>slate</code>ä¸­æååè®¤ä¸ºçæç<code>key</code>è·èç¹æ¯å®å¨ä¸ä¸å¯¹åºçå³ç³»ï¼ä¾å¦å½<code>A</code>èç¹ååæ¶ï¼å¶ä»£è¡¨çå±çº§<code>key</code>å¿ç¶ä¼åçååãç¶èå¨å³æ³¨è¿ä¸ªé®é¢ä¹åï¼æåç°å¶å¨æ´æ°çææ°ç<code>Node</code>ä¹åï¼ä¼åæ­¥æ´æ°<code>Path</code>ä»¥å<code>PathRef</code>å¯¹åºç<code>Node</code>èç¹æå¯¹åºç<code>key</code>å¼ã</p>
<pre><code class="language-js">for (const [pathRef, key] of pathRefMatches) {
  if (pathRef.current) {
    const [node] = Editor.node(e, pathRef.current)
    NODE_TO_KEY.set(node, key)
  }
  pathRef.unref()
}
</code></pre>
<p>å¨åç»­è§å¯<code>Lexical</code>å®ç°çéåºæ¨¡åæ¶ï¼åç°å¶æ¯ç¨<code>key</code>å¼å¯ä¸å°æ è¯æ¯ä¸ªå¶å­ç»ç¹çï¼éåºä¹æ¯åºäº<code>key</code>å¼æ¥æè¿°çãæ´ä½è¡¨è¾¾ä¸æ¯è¾ç±»ä¼¼äº<code>Slate</code>çéåºç»æï¼æèè¯´æ¯<code>DOM</code>æ çç»æãè¿éä»ä»æ¯å¼å¾<code>Range</code>éåºï¼<code>Lexical</code>å®éä¸è¿æå¶ä»ä¸ç§éåºç±»åã</p>
<pre><code class="language-js">{
  anchor: { key: "51", offset: 2, type: "text" },
  focus: { key: "51", offset: 3, type: "text" }
}
</code></pre>
<p>å¨è¿éæ¯è¾éè¦çæ¯<code>key</code>å¼åæ´æ¶çç¶æä¿æï¼å ä¸ºç¼è¾å¨çåå®¹å®éä¸æ¯éè¦ç¼è¾çãç¶èå¦æåå°<code>immutable</code>è¯ï¼å¾ææ¾ç´æ¥æ ¹æ®ç¶æå¯¹è±¡çå¼ç¨æ¥æ å°<code>key</code>ä¼å¯¼è´æ´ä¸ªç¼è¾å¨<code>DOM</code>æ æçéå»ºãä¾å¦è°æ´æ é¢çç­çº§ï¼å°±ç±äºæ´ä¸ªè¡<code>key</code>çååå¯¼è´æ´è¡éå»ºã</p>
<p>é£ä¹å¦ä½å°½å¯è½å°å¤ç¨<code>key</code>å¼å°±æäºéè¦ç ç©¶çé®é¢ï¼æä»¬çç¼è¾å¨è¡çº§å«ç<code>key</code>æ¯è¢«ç¹æ®ç»´æ¤çï¼å³å®ç°äº<code>immutable</code>ä»¥å<code>key</code>å¼å¤ç¨ãèç®åå¶å­ç¶æç<code>key</code>ä¾èµäº<code>index</code>å¼ï¼å æ­¤å¦æè°ç <code>Lexical</code>çå®ç°ï¼åæ ·å¯ä»¥å°å¶åºç¨å°æä»¬ç<code>key</code>å¼ç»´æ¤ä¸­ã</p>
<p>éè¿å¨<code>playground</code>ä¸­è°è¯å¯ä»¥åç°ï¼å³ä½¿æä»¬ä¸è½å¾ç¥å¶æ¯å¦ä¸º<code>immutable</code>çå®ç°ï¼ä¾ç¶å¯ä»¥åç°<code>Lexical</code>ç<code>key</code>æ¯ä»¥ä¸ç§åå·¦çæ¹å¼ç»´æ¤ãå æ­¤å¨æä»¬çç¼è¾å¨å®ç°ä¸­ï¼ä¹å¯ä»¥åå©åæ ·çæ¹å¼ï¼åå¹¶ç´æ¥ä»¥å·¦å¼ä¸ºåå¤ç¨ï¼æåæ¶è¥ä»¥<code>0</code>èµ·å§ç´æ¥å¤ç¨ï¼èµ·å§é<code>0</code>ååå»ºæ°<code>key</code>ã</p>
<ol>
<li><code>[123456(key1)][789(bold-key2)]</code>ææ¬ï¼å°<code>789</code>çå ç²åæ¶ï¼æ´æ®µææ¬ç<code>key</code>å¼ä¿æä¸º<code>key1</code>ã</li>
<li><code>[123456789(key1)]]</code>ææ¬ï¼å°<code>789</code>è¿æ®µææ¬å ç²ï¼å·¦ä¾§<code>123456</code>ææ¬ç<code>key</code>å¼ä¿æä¸º<code>key1</code>ï¼<code>789</code>åæ¯æ°ç<code>key</code>ã</li>
<li><code>[123456789(key1)]]</code>ææ¬ï¼å°<code>123</code>è¿æ®µææ¬å ç²ï¼å·¦ä¾§<code>123</code>ææ¬ç<code>key</code>å¼ä¿æä¸º<code>key1</code>ï¼<code>456789</code>åæ¯æ°ç<code>key</code>ã</li>
<li><code>[123456789(key1)]]</code>ææ¬ï¼å°<code>456</code>è¿æ®µææ¬å ç²ï¼å·¦ä¾§<code>123</code>ææ¬ç<code>key</code>å¼ä¿æä¸º<code>key1</code>ï¼<code>456</code>å<code>789</code>åå«æ¯æ°ç<code>key</code>ã</li>
</ol>
<p>å æ­¤ï¼æ­¤æ¶å¨ç¼è¾å¨ä¸­æä»¬ä¹æ¯ç¨ç±»ä¼¼åå·¦çæ¹å¼ç»´æ¤<code>key</code>ï¼ç±äºæä»¬éè¦ä¿æ<code>immutable</code>ï¼æä»¥è¿éçè¡¨è¾¾å®éä¸æ¯å°½å¯è½å¤ç¨ååç<code>key</code>ç¶æãè¿éä¸<code>LineState</code>ç<code>key</code>å¼ç»´æ¤æ¹å¼ç±»ä¼¼ï¼é½æ¯ååå»ºç¶æç¶åæ´æ°å¶<code>key</code>å¼ï¼å½ç¶è¿æå¾å¤ç»èçå°æ¹éè¦å¤çã</p>
<pre><code class="language-js">// èµ·å§ä¸è£åªä½ç½®ç­å NextOp =&gt; Immutable åå°å¤ç¨ State
if (offset === 0 &amp;&amp; op.insert.length &lt;= length) {
  return nextLeaf;
}
const newLeaf = new LeafState(retOp, nextLeaf.parent);
// è¥ offset æ¯ 0, åç´æ¥å¤ç¨åå§ç key å¼
offset === 0 &amp;&amp; newLeaf.updateKey(nextLeaf.key);
</code></pre>
<p>è¿éè¿å­å¨å¦ä¸ä¸ªå°é®é¢ï¼æä»¬åå»º<code>LeafState</code>å°±ç«å³å»è·å¾å¯¹åºç<code>key</code>å¼ï¼ç¶ååèèå»å¤ç¨åå§ç<code>key</code>å¼ãè¿æ ·å¶å®å°±ä¼å¯¼è´å¾å¤ä¸åä½¿ç¨ç<code>key</code>å¼è¢«åå»ºï¼å¯¼è´æ¯æ¬¡æ´æ°çæ¶åçèµ·æ¥<code>key</code>çæ°å­å·®å¼æ¯è¾å¤§ãå½ç¶è¿å¹¶ä¸å½±åæ´ä½çåè½ä¸æ§è½ï¼åªæ¯è°è¯çæ¶åçèµ·æ¥æ¯è¾æªã</p>
<p>å æ­¤æä»¬å¨è¿éè¿å¯ä»¥ä¼åè¿é¨åè¡¨ç°ï¼ä¹å°±æ¯è¯´æä»¬å¨åå»ºçæ¶åä¸ä¼å»ç«å³åå»º<code>key</code>å¼ï¼èæ¯å¨åå§åä»¥åæ´æ°çæ¶ååä»å¤é¨è®¾ç½®å¶<code>key</code>å¼ãè¿ä¸ªå®ç°å¶å®è·<code>index</code>ã<code>offset</code>çå¤çæ¹å¼æ¯è¾ç±»ä¼¼ï¼æä»¬æ´ä½å¨<code>update</code>æ¶å¤çææçç¸å³å¼ï¼ä¸å¼åæ¨¡å¼æ¸²ææ¶è¿è¡äºä¸¥æ ¼æ£æ¥ã</p>
<pre><code class="language-js">// BlockState
let offset = 0;
this.lines.forEach((line, index) =&gt; {
  line.index = index;
  line.start = offset;
  line.key = line.key || Key.getId(line);
  const size = line.isDirty ? line.updateLeaves() : line.length;
  offset = offset + size;
});
this.length = offset;
this.size = this.lines.length;
</code></pre>
<pre><code class="language-js">// LineState
let offset = 0;
const ops: Op[] = [];
this.leaves.forEach((leaf, index) =&gt; {
  ops.push(leaf.op);
  leaf.offset = offset;
  leaf.parent = this;
  leaf.index = index;
  offset = offset + leaf.length;
  leaf.key = leaf.key || Key.getId(leaf);
});
this._ops = ops;
this.length = offset;
this.isDirty = false;
this.size = this.leaves.length;
</code></pre>
<p>æ­¤å¤ï¼å¨å®ç°ååæµè¯æ¶è¿åç°ï¼å¨<code>leaf</code>ä¸ç¬ç«ç»´æ¤äº<code>key</code>å¼ï¼é£ä¹<code>\n</code>è¿ä¸ªç¹æ®çèç¹èªç¶ä¹ä¼æç¬ç«ç<code>key</code>å¼ãè¿ç§æåµä¸å¨<code>line</code>çº§å«ä¸ç»´æ¤ç<code>key</code>å¼åæ¯ä¹å¯ä»¥ç´æ¥å¤ç¨<code>\n</code>è¿ä¸ª<code>leaf</code>ç<code>key</code>å¼ãå½ç¶è¿åªæ¯çè®ºä¸çå®ç°ï¼å¯è½ä¼å¯¼è´ä¸äºææ³ä¸å°çå·æ°é®é¢ã</p>
<h2 id="è§å¾å¢éæ¸²æ">è§å¾å¢éæ¸²æ</h2>
<p>å¨è§å¾æ¨¡åæå¼å§çè®¾è®¡ä¸ï¼æä»¬çç¶æç®¡çå½¢å¼æ¯ç´æ¥å¨éæ´æ°<code>Delta</code>ï¼ç¶åä½¿ç¨<code>EachLine</code>éåéå»ºææçç¶æãå¹¶ä¸å®éä¸æä»¬ç»´æ¤äº<code>Delta</code>ä¸<code>State</code>ä¸¤ä¸ªæ°æ®æ¨¡åï¼å»ºç«å¶å³ç³»æ å°å³ç³»æ¬èº«ä¹æ¯ä¸ç§æèï¼æ¸²æçæ¶åçç®æ ç¶ææ¯<code>Delta</code>èé<code>State</code>ã</p>
<p>è¿æ ·çæ¨¡åå¿ç¶æ¯èè´¹æ§è½çï¼æ¯æ¬¡<code>Apply</code>çæ¶åé½éè¦å¨éæ´æ°ææ¡£å¹¶ä¸åæ¬¡éååå²è¡ç¶æãå½ç¶å®éä¸åªæ¯è®¡ç®è¿­ä»£çè¯ï¼å®éä¸æ¯ä¸ä¼å¤ªè¿äºèè´¹æ§è½ï¼ä½æ¯ç±äºæä»¬æ¯æ¬¡é½æ¯æ°çå¯¹è±¡ï¼é£ä¹å¨æ´æ°è§å¾çæ¶åï¼æ´å®¹æé ææ§è½çæèï¼è®¡ç®çæ§è½éå¸¸å¯æ¥åï¼èè§å¾æ´æ°æä½<code>DOM</code>ææ¬æ´é«ã</p>
<p>å®éä¸ï¼æä»¬ä¸è¾¹å¤ç¨å¶<code>key</code>å¼ï¼è§£å³çé®é¢æ¯é¿åæ´ä¸ªè¡ç¶æè§å¾<code>re-mount</code>ãèå³ä½¿å¤ç¨äº<code>key</code>å¼ï¼å ä¸ºéå»ºäºæ´ä¸ª<code>State</code>å®ä¾ï¼<code>React</code>ä¹ä¼ç»§ç»­åè¾¹ç<code>re-render</code>æµç¨ãå æ­¤æä»¬å¨è¿ééè¦è§£å³çé®é¢æ¯ï¼å¦ä½å¨æ åæ´çæåµä¸å°½å¯è½é¿åå¶è§å¾<code>re-render</code>ã</p>
<p>ç±äºæä»¬å®ç°äºè¡çº§ä¸å¯åç¶æç»´æ¤ï¼é£ä¹å¨è§å¾ä¸­å°±å¯ä»¥ç´æ¥å¯¹æ¯ç¶æå¯¹è±¡çå¼ç¨æ¯å¦ååæ¥å³å®æ¯å¦éè¦éæ¸²æãå æ­¤åªéè¦å¯¹äº<code>ViewModel</code>çèç¹è¡¥åäº<code>React.memo</code>ï¼å¨è¿ä¸ªåºæ¯ä¸çè³äºä¸éè¦éåå¯¹æ¯å½æ°ï¼åªéè¦ä¾èµæä»¬ç<code>immutable</code>ç¶æå¤ç¨è½å¤æ­£å¸¸èµ·å°ææã</p>
<pre><code class="language-js">const LeafView: FC&lt;{ editor: Editor; leafState: LeafState; }&gt; = props =&gt; {
  return (
    &lt;span {...{ [LEAF_KEY]: true }} &gt;
      {runtime.children}
    &lt;/span&gt;
  );
}
export const LeafModel = React.memo(LeafView);
</code></pre>
<p>åæ ·çï¼éå¯¹<code>LineView</code>ä¹éè¦è¡¥å<code>memo</code>ï¼èä¸ç±äºç»ä»¶åæ¬èº«å¯è½å­å¨ç¶æååï¼ä¾å¦<code>Composing</code>ç»åè¾å¥çæ§å¶ï¼æä»¥éå¯¹äºåé¨èç¹çè®¡ç®ä¹ä¼éç¨<code>useMemo</code>æ¥ç¼å­ç»æï¼é¿åéå¤è®¡ç®ã</p>
<pre><code class="language-js">const LineView: FC&lt;{ editor: Editor; lineState: LineState; }&gt; = props =&gt; {
  const elements = useMemo(() =&gt; {
     // ...
    return nodes;
  }, [editor, lineState]);
  return (
    &lt;div {...{ [NODE_KEY]: true }} &gt;
      {elements}
    &lt;/div&gt;
  );
}
export const LineModel = React.memo(LineView);
</code></pre>
<p>èè§å¾å·æ°ä»ç¶è¿æ¯ç´æ¥æ§å¶<code>lines</code>è¿ä¸ªç¶æçå¼ç¨å³å¯ï¼ç¸å½äºæ ¸å¿å±çåå®¹ååä¸è§å¾å±çéæ¸²æï¼æ¯ç´æ¥ä¾èµäºäºä»¶æ¨¡åéä¿¡å°±å¯ä»¥å®ç°çãç±äºæ¯æ¬¡å<code>lines</code>ç¶ææ¶é½æ¯æ°çå¼ç¨ï¼æä»¥<code>React</code>ä¼è®¤ä¸ºç¶æåçäºååï¼ä»èè§¦åéæ¸²æã</p>
<pre><code class="language-js">const onContentChange = useMemoFn(() =&gt; {
  if (flushing.current) return void 0;
  flushing.current = true;
  Promise.resolve().then(() =&gt; {
    flushing.current = false;
    setLines(state.getLines());
  });
});
</code></pre>
<p>èè½ç¶è§¦åäºæ¸²æï¼ä½æ¯ç±äº<code>key</code>ä»¥å<code>memo</code>çå­å¨ï¼ä¼ä»¥<code>line</code>çç¶æä¸ºåºåè¿è¡å¯¹æ¯ãåªæ<code>LineState</code>å¯¹è±¡çå¼ç¨åçäºååï¼<code>LineModel</code>è§å¾æä¼è§¦åæ´æ°é»è¾ï¼å¦åä¼å¤ç¨åæçè§å¾ï¼è¿é¨åæä»¬å¯ä»¥ç´æ¥ä¾èµ<code>React</code>ç<code>devtools</code>å½å¶æ<code>Highlight</code>å°±å¯ä»¥è§å¯å°ã</p>
<p>è§å¾å¢éæ´æ°è¿é¨åå¶å®æ¯è¾ç®åï¼ä¸»è¦æ¯å®ç°ä¸å¯åå¯¹è±¡ä»¥å<code>key</code>å¼ç»´æ¤çé»è¾é½å¨æ ¸å¿å±å®ç°ï¼è§å¾å±ä¸»è¦æ¯ä¾èµå¶åè®¡ç®ï¼å¯¹æ¯æ¯å¦éè¦éæ¸²æãå¶å®ç±»ä¼¼çå®ç°å¨ä½ä»£ç çåºæ¯ä¸­ä¹å¯ä»¥åºç¨ï¼æ¯ç«å®éä¸å¯ææ¬ä¹å°±æ¯ç¸å½äºä¸ä¸ªé¶ä»£ç çç¼è¾å¨ï¼åªä¸è¿ç»è£çä¸æ¯ç»ä»¶èæ¯ææ¬ã</p>
<h2 id="æ»ç»">æ»ç»</h2>
<p>å¨ååæä»¬ä¸»è¦è®¨è®ºäºè§å¾å±çééå¨è®¾è®¡ï¼ä¸»è¦æ¯å¨éçè§å¾åå§åæ¸²æï¼ä»¥åç¶ææ¨¡åå°<code>DOM</code>ç»ææ§çè§åè®¾å®ãå¨è¿éåä¸»è¦èèæ´æ°å¤çæ¶æ§è½çä¼åï¼ä¸»è¦æ¯å¨å¢éæ´æ°æ¶ï¼å¦ä½æå°å<code>DOM</code>ä»¥å<code>Op</code>æä½ã<code>key</code>å¼çç»´æ¤ãä»¥åå¨<code>React</code>ä¸­å®ç°å¢éæ¸²æçæ¹å¼ã</p>
<p>å¶å®æ¥ä¸æ¥éè¦èèè¾å¥åå®¹æ¶ï¼å¦ä½é¿åè§å®ç<code>DOM</code>çç»æè¢«ç ´åï¼ä¸»è¦æ¶åè<code>DOM</code>æ£æ¥ãéåºæ´æ°ãæ¸²æ<code>Hook</code>ç­ï¼è¿é¨ååå®¹å¨<code>#8</code>å<code>#9</code>çè¾å¥æ³å¤çä¸­å·²ç»æäºè¯¦ç»çè®¨è®ºï¼å æ­¤è¿éå°±ä¸åæ¬¡å±å¼äºã</p>
<p>é£ä¹æ¥ä¸æ¥æä»¬éè¦è®¨è®ºçæ¯ç¼è¾èç¹çç»ä»¶é¢è®¾ï¼ä¾å¦é¶å®½å­ç¬¦ã<code>Embed</code>èç¹ã<code>Void</code>èç¹ç­ãä¸»è¦æ¯ä¸ºç¼è¾å¨çæä»¶æ©å±æä¾é¢è®¾çç»ä»¶ï¼å¨è¿äºç»ä»¶åå­å¨ä¸äºé»è®¤çè¡ä¸ºï¼å¹¶ä¸åæ ·é¢è®¾äºé¨å<code>DOM</code>ç»æï¼ä»¥æ­¤æ¥å®ç°å¨è§å®èå´åçç¼è¾å¨æä½ã</p>
<h2 id="æ¯æ¥ä¸é¢">æ¯æ¥ä¸é¢</h2>
<ul>
<li><a href="https://github.com/WindRunnerMax/EveryDay" target="_blank" rel="noopener nofollow">https://github.com/WindRunnerMax/EveryDay</a></li>
</ul>
<h2 id="åè">åè</h2>
<ul>
<li><a href="https://18.react.dev/" target="_blank" rel="noopener nofollow">https://18.react.dev/</a></li>
<li><a href="https://18.react.dev/reference/react/memo" target="_blank" rel="noopener nofollow">https://18.react.dev/reference/react/memo</a></li>
<li><a href="https://18.react.dev/reference/react/useMemo" target="_blank" rel="noopener nofollow">https://18.react.dev/reference/react/useMemo</a></li>
</ul>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 10:51">2026-02-09 10:51</span>&nbsp;
<a href="https://www.cnblogs.com/WindrunnerMax">WindRunnerMax</a>&nbsp;
éè¯»(<span id="post_view_count">6</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19594114);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19594114', targetLink: 'https://www.cnblogs.com/WindrunnerMax/p/19594114', title: 'ä»é¶å®ç°å¯ææ¬ç¼è¾å¨#11-Immutableç¶æç»´æ¤ä¸å¢éæ¸²æ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ AIå¼å-python-langchainæ¡æ¶ï¼1-13 è¿åxml-æ ¼å¼è§£æå¨ï¼ ]]></title>
    <link>https://www.cnblogs.com/yclh/p/19594030</link>
    <guid>44679539e9246447b1b82a2678d8b436</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yclh/p/19594030" title="åå¸äº 2026-02-09 10:34">
    <span role="heading" aria-level="2">AIå¼å-python-langchainæ¡æ¶ï¼1-13 è¿åxml-æ ¼å¼è§£æå¨ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>æçæ¶åxmlæ ¼å¼ä¹æ¯å¼åä¸­æ¯æ¯è¾æ®éçæ°æ®æ ¼å¼ï¼å¦ä½è®©å¤§æ¨¡åè¿åçæ°æ®æ¯æ åçxmlæ ¼å¼ï¼</p>
<p>çå¦ä¸ä»£ç ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">from langchain.prompts import PromptTemplate
from langchain_openai import ChatOpenAI
from langchain.output_parsers import XMLOutputParser
import os

llm = ChatOpenAI(
    api_key=os.getenv("DEEPSEEK_API_KEY"),
    base_url=os.getenv("BASE_URL"),
    model="deepseek-v3:671b",
    temperature=0.7,
    max_tokens=1024
)

# ä¿®æ­£ XML æ ¼å¼æä»¤ï¼ç»ææ ç­¾å¿é¡»æ¯ &lt;/xml&gt;
format_instructions = """è¯·ä¸¥æ ¼æç§ä»¥ä¸XMLæ ¼å¼è¿åç»æï¼ä»è¾åºXMLåå®¹ï¼ä¸è¦åå«ä»»ä½å¶ä»æå­æè¯´æï¼

&lt;xml&gt;
  &lt;movie&gt;çµå½±åç§°1&lt;/movie&gt;
  &lt;movie&gt;çµå½±åç§°2&lt;/movie&gt;
  &lt;!-- å¯åå«å¤ä¸ª movie æ ç­¾ --&gt;
&lt;/xml&gt;"""

prompt = PromptTemplate(
    template="{format_instructions}\n\nç¨æ·è¯·æ±ï¼{query}",
    input_variables=["query"],
    partial_variables={"format_instructions": format_instructions},
)

actor_query = "çæééæççµå½±ç®å½ã"

#è¾åºæç¤ºè¯
print('#######################')
print(prompt.invoke({"query": actor_query}).text)
print('#######################')



chain = prompt | llm | XMLOutputParser()


result = chain.invoke({"query": actor_query})
print('----------------------')
print("è§£ææåï¼ç»æï¼")
print(result)
</pre>
</div>
<p>&nbsp;è¿ç»æï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">#######################
è¯·ä¸¥æ ¼æç§ä»¥ä¸XMLæ ¼å¼è¿åç»æï¼ä»è¾åºXMLåå®¹ï¼ä¸è¦åå«ä»»ä½å¶ä»æå­æè¯´æï¼

&lt;xml&gt;
  &lt;movie&gt;çµå½±åç§°1&lt;/movie&gt;
  &lt;movie&gt;çµå½±åç§°2&lt;/movie&gt;
  &lt;!-- å¯åå«å¤ä¸ª movie æ ç­¾ --&gt;
&lt;/xml&gt;

ç¨æ·è¯·æ±ï¼çæééæççµå½±ç®å½ã
#######################
----------------------
è§£ææåï¼ç»æï¼
{'xml': [{'movie': 'è±é'}, {'movie': 'æ é´é3ï¼ç»ææ é´'}, {'movie': 'å½æ¥'}, {'movie': 'åå±±å¤§å°é'}, {'movie': 'åº·ççæ'}, {'movie': 'å´å'}, {'movie': 'æç1919'}, {'movie': 'æ¥æ±ä¼ å¥'}]}
</pre>
</div>
<p>&nbsp;ä¸ä¸ªæ åçxmlæ ¼å¼è¿å</p>
<p>æ´å¤å­¦ä¹ èµæå°½å¨èèç½çèµæºï¼http://resources.kittytiger.cn/ <a style="text-shadow: 0 0 5px rgba(255, 255, 255, 1), 0 0 10px rgba(255, 255, 255, 1), 0 0 15px rgba(255, 255, 255, 1), 0 0 20px rgba(240, 201, 77, 1), 0 0 25px rgba(240, 201, 77, 1), 0 0 30px rgba(240, 201, 77, 1), 0 0 35px rgba(240, 201, 77, 1)" href="http://resources.kittytiger.cn/" target="_blank" rel="noopener nofollow">èèç½çèµæº</a></p>
<p><span style="font-size: 18pt"><strong>éç¹ç¥è¯ï¼</strong></span></p>
<h3 class="qwen-markdown-heading"><span class="qwen-markdown-text" data-spm-anchor-id="a2ty_o01.29997173.0.i1.7c905171941MVU">ä»£ç ç»æä¸åè½æ¦è¿°</span></h3>
<div class="qwen-markdown-paragraph"><span class="qwen-markdown-text">æ¬æ®µä»£ç æå»ºäºä¸ä¸ªåºäº LangChain çç»æåæ°æ®çæç®¡éï¼æ ¸å¿ç®æ æ¯è®©å¤§è¯­è¨æ¨¡åï¼LLMï¼ä»¥<strong class="qwen-markdown-strong"><span class="qwen-markdown-text">ä¸¥æ ¼æ åç XML æ ¼å¼</span></strong><span class="qwen-markdown-text">è¿åééæåæ¼ççµå½±åè¡¨ãæ´ä¸ªæµç¨éè¿æç¤ºè¯å·¥ç¨ãæ¨¡åè°ç¨ä¸è¾åºè§£æä¸æ­¥ååï¼ç¡®ä¿æç»ç»æå¯ç´æ¥è¢«ç¨åºè§£æä½¿ç¨ï¼é¿åéç»æåææ¬å¸¦æ¥çå¤çè´æã</span></span></div>
&nbsp;
<h3 class="qwen-markdown-heading"><span class="qwen-markdown-text">æç¤ºè¯æ¨¡æ¿ï¼å¼ºå¶ XML æ ¼å¼è¾åº</span></h3>
<div class="qwen-markdown-paragraph"><span class="qwen-markdown-text">ä»£ç éè¿ <code class="qwen-markdown-codespan" style="cursor: pointer">PromptTemplate</code><span class="qwen-markdown-text"> æ¾å¼å®ä¹æ ¼å¼æä»¤ï¼<code class="qwen-markdown-codespan" style="cursor: pointer">format_instructions</code><span class="qwen-markdown-text">ï¼ï¼è¦æ±æ¨¡åï¼ </span></span></span></div>
<ol class="qwen-markdown-list" dir="auto" start="1">
<li><strong class="qwen-markdown-strong"><span class="qwen-markdown-text">ä»è¾åº XML åå®¹</span></strong><span class="qwen-markdown-text">ï¼ç¦æ­¢éå è¯´æãæ³¨éæå¤ä½æå­ï¼ </span></li>
<li><strong class="qwen-markdown-strong"><span class="qwen-markdown-text">ä½¿ç¨æ å XML æ ç­¾ç»æ</span></strong><span class="qwen-markdown-text">ï¼ä»¥ <code class="qwen-markdown-codespan" style="cursor: pointer">&lt;xml&gt;</code><span class="qwen-markdown-text"> ä¸ºæ ¹èç¹ï¼æ¯ä¸ªçµå½±åç§°åè£¹å¨ç¬ç«ç <code class="qwen-markdown-codespan" style="cursor: pointer">&lt;movie&gt;</code><span class="qwen-markdown-text"> å­æ ç­¾ä¸­ï¼ </span></span></span></li>
<li><strong class="qwen-markdown-strong"><span class="qwen-markdown-text">ä¸¥æ ¼é­åæ ç­¾</span></strong><span class="qwen-markdown-text">ï¼å¦ <code class="qwen-markdown-codespan" style="cursor: pointer">&lt;/xml&gt;</code><span class="qwen-markdown-text"> ç»ææ ¹èç¹ï¼é¿åæ ¼å¼éè¯¯ã<br><span class="qwen-markdown-text">è¿ç§è®¾è®¡ä»æºå¤´çº¦ææ¨¡åè¡ä¸ºï¼å¤§å¹éä½åç»­è§£æå¤±è´¥é£é©ã</span></span></span></li>

</ol><br>
<h3 class="qwen-markdown-heading"><span class="qwen-markdown-text">æ¨¡åè°ç¨ï¼å®åçæç»æååå®¹</span></h3>
<div class="qwen-markdown-paragraph"><span class="qwen-markdown-text">éç¨ <code class="qwen-markdown-codespan" style="cursor: pointer">deepseek-v3:671b</code><span class="qwen-markdown-text"> æ¨¡åå¹¶è®¾ç½® <code class="qwen-markdown-codespan" style="cursor: pointer">temperature=0.7</code><span class="qwen-markdown-text">ï¼å¨ä¿è¯åé æ§çåæ¶ç»´æè¾åºç¨³å®æ§ãå³é®ç¹å¨äºï¼  </span></span></span></div>
<ul class="qwen-markdown-list" dir="auto">
<li><span class="qwen-markdown-text">æç¤ºè¯ä¸­æç¡®ç¨æ·è¯·æ±ï¼âçæééæççµå½±ç®å½âï¼ä¸æ ¼å¼æä»¤åç¦»ï¼ä½¿æ¨¡åèç¦äº<strong class="qwen-markdown-strong"><span class="qwen-markdown-text">åå®¹çæ</span></strong><span class="qwen-markdown-text">ä¸<strong class="qwen-markdown-strong"><span class="qwen-markdown-text">æ ¼å¼éµå¾ª</span></strong><span class="qwen-markdown-text">åéä»»å¡ï¼  </span></span></span></li>
<li><span class="qwen-markdown-text">éè¿ <code class="qwen-markdown-codespan" style="cursor: pointer">max_tokens=1024</code><span class="qwen-markdown-text"> éå¶è¾åºé¿åº¦ï¼é¿ååä½ä¿¡æ¯å¹²æ° XML ç»æå®æ´æ§ã</span></span></li>

</ul>
<br>
<h3 class="qwen-markdown-heading"><span class="qwen-markdown-text">è¾åºè§£æå¨ï¼éªè¯å¹¶è½¬æ¢ XML æ°æ®</span></h3>
<div class="qwen-markdown-paragraph"><code class="qwen-markdown-codespan" style="cursor: pointer">XMLOutputParser</code><span class="qwen-markdown-text"> ä½ä¸ºé¾å¼è°ç¨çæç»ç¯èï¼æ¿æåéèè´£ï¼  </span></div>
<ol class="qwen-markdown-list" dir="auto" start="1"><ol class="qwen-markdown-list" dir="auto" start="1">
<li><strong class="qwen-markdown-strong"><span class="qwen-markdown-text">æ ¼å¼æ ¡éª</span></strong><span class="qwen-markdown-text">ï¼èªå¨æ£æµ XML æ ç­¾é­åæ§ãåµå¥åæ³æ§ï¼è¥æ¨¡åè¾åºä¸ç¬¦åæ åï¼å¦ç¼ºå¤±ç»ææ ç­¾ï¼ï¼å°æåºè§£æå¼å¸¸ï¼  </span></li>
<li data-spm-anchor-id="a2ty_o01.29997173.0.i2.7c905171941MVU"><strong class="qwen-markdown-strong"><span class="qwen-markdown-text">ç»æåè½¬æ¢</span></strong><span class="qwen-markdown-text">ï¼å°åå§ XML å­ç¬¦ä¸²è½¬æ¢ä¸º Python å­å¸ï¼å¦ <code class="qwen-markdown-codespan" style="cursor: pointer">{'xml': {'movie': ['çµå½±A', 'çµå½±B']}}</code><span class="qwen-markdown-text">ï¼ï¼ä¾¿äºç¨åºç´æ¥æåæ°æ®ï¼æ éæå¨æ­£åå¹éã</span></span></li>

</ol></ol>
<p>&nbsp;</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 10:35">2026-02-09 10:34</span>&nbsp;
<a href="https://www.cnblogs.com/yclh">ä¸ç¬ä½</a>&nbsp;
éè¯»(<span id="post_view_count">13</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19594030);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19594030', targetLink: 'https://www.cnblogs.com/yclh/p/19594030', title: 'AIå¼å-python-langchainæ¡æ¶ï¼1-13 è¿åxml-æ ¼å¼è§£æå¨ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Dapperè½»éçº§æ©å±åºSmartDapper ]]></title>
    <link>https://www.cnblogs.com/mumaren/p/19593895</link>
    <guid>7aaf4ae51137edfac3ff737bf28188c9</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/mumaren/p/19593895" title="åå¸äº 2026-02-09 10:16">
    <span role="heading" aria-level="2">Dapperè½»éçº§æ©å±åºSmartDapper</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="smartdapper">SmartDapper</h2>
<p>SmartDapper æ¯ä¸ä¸ªåºäº Dapper çè½»éçº§æ©å±åºï¼æä¾ <strong>è¡¨è¾¾å¼æ è½¬ SQL</strong>ã<strong>é¾å¼æå»ºå¨ï¼Fluent Builderï¼QuerySet/InsertSet/UpdateSet/DeleteSetï¼æ¯æ Where/Select/Join/GroupBy/OrderBy/Union/Set/Fill ç­ï¼</strong>ã<strong>éç¨ CRUD</strong>ã<strong>åé¡µæ¥è¯¢</strong> ä¸ <strong>å¤æ°æ®åºéé</strong>ï¼SQL Server / MySQL / SQLiteï¼ãé»è®¤åæ°åæ§è¡ï¼ä»¥éä½ SQL æ³¨å¥é£é©ã</p>
<h3 id="å®è£">å®è£</h3>
<pre><code class="language-bash">dotnet add package SmartDapper
</code></pre>
<h3 id="å¿«éå¼å§sql-çæ--dapper-æ§è¡">å¿«éå¼å§ï¼SQL çæ + Dapper æ§è¡ï¼</h3>
<pre><code class="language-csharp">using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Dapper;
using Microsoft.Data.SqlClient;
using SmartDapper.SqlGenerator;

[Table("Users")]
public class User
{
    [Key]
    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
    public int Id { get; set; }

    public string UserName { get; set; } = string.Empty;
    public bool IsActive { get; set; }
}

var generator = SqlGeneratorFactory.CreateSqlServer&lt;User&gt;();
var (sql, parameters) = generator.GetSelectAll(u =&gt; u.IsActive);

using var conn = new SqlConnection("Server=.;Database=MyDb;Trusted_Connection=True;TrustServerCertificate=True;");
var users = conn.Query&lt;User&gt;(sql, parameters).ToList();
</code></pre>
<h3 id="ä½¿ç¨æ©å±æ¹æ³idbconnection">ä½¿ç¨æ©å±æ¹æ³ï¼<code>IDbConnection</code>ï¼</h3>
<pre><code class="language-csharp">using Microsoft.Data.SqlClient;
using SmartDapper.Extensions;

using var conn = new SqlConnection("Server=.;Database=MyDb;Trusted_Connection=True;TrustServerCertificate=True;");

// ---------------------------
// ç»ææ å°ï¼å¯éï¼ä½æ¨èï¼åå/å±æ§åä¸ä¸è´æ¶ï¼
// ---------------------------
// è®© Dapper å¨ materializeï¼ç»æé-&gt;å®ä½ï¼æ¶ä¼åä½¿ç¨ [Column("DbColumn")] æ å°ï¼
// å¹¶å¯éå¼å¯ä¸åçº¿å¹éï¼user_name -&gt; UserNameï¼ã
//
// æ³¨æï¼è¿æ¯ Dapper çå¨å±è®¾ç½®ï¼è¿ç¨åå¯¹è¯¥å®ä½ç±»åçæææ¥è¯¢é½ä¼åå½±åï¼ï¼å»ºè®®åªå¨å¯å¨é¶æ®µæ§è¡ä¸æ¬¡ã
DapperMappingExtensions.UseColumnAttributeTypeMap&lt;User&gt;(matchNamesWithUnderscores: true);

// æèï¼ä¸æ¬¡æ§å¯¹âå®ä½æå¨ç¨åºéâåçç±»åæ¹éæ³¨åï¼é»è®¤æ [Table]/[Key]/[Column] è¯å«å®ä½ï¼
// DapperMappingExtensions.UseColumnAttributeTypeMap(matchNamesWithUnderscores: true, typeof(User).Assembly);

// ---------------------------
// æ¥è¯¢ï¼éé¾å¼ / é Fluentï¼
// ---------------------------
var list = await conn.GetAllListAsync&lt;User&gt;(u =&gt; u.IsActive);
var (items, total) = await conn.GetPagedListAsync&lt;User&gt;(skip: 0, take: 20);

// æä¸»é®æ¥åæ¡ï¼ä¸å­å¨è¿å nullï¼
var one = await conn.GetAsync&lt;User&gt;(id: 1);

// First / Singleï¼æ³¨æï¼Single å¨å¤æ¡å½ä¸­æ¶ä¼æå¼å¸¸ï¼
var first = await conn.FirstOrDefaultAsync&lt;User&gt;(u =&gt; u.IsActive);
var single = await conn.SingleOrDefaultAsync&lt;User&gt;(u =&gt; u.Id == 1);

// æ¯å¦å­å¨ / è®¡æ°
var exists = await conn.AnyAsync&lt;User&gt;(u =&gt; u.IsActive);
var count = await conn.CountAsync&lt;User&gt;(u =&gt; u.IsActive);

// ---------------------------
// æ°å¢ï¼éé¾å¼ï¼
// ---------------------------
var newUser = new User { UserName = "Alice", IsActive = true };
await conn.InsertAsync(newUser);

// æå¥å¹¶è¿åèªå¢IDï¼è¦æ±å®ä½ä¸»é®æ æ³¨ [Key] ä¸ä¸º Identityï¼
var newId = await conn.InsertAndGetIdAsync(newUser);

// ---------------------------
// æ´æ°ï¼éé¾å¼ï¼
// ---------------------------
// 1) æä¸»é®æ´æ°æå®å­æ®µ
await conn.UpdateAsync&lt;User&gt;(
    updateFields: u =&gt; new { IsActive = false },
    keyValue: 1);

// 2) ææ¡ä»¶æ´æ°æå®å­æ®µ
await conn.UpdateAsync&lt;User&gt;(
    updateFields: u =&gt; new { IsActive = true },
    predicate: u =&gt; u.UserName == "Alice");

// ---------------------------
// å é¤ï¼éé¾å¼ï¼
// ---------------------------
// æä¸»é®å é¤
await conn.DeleteAsync&lt;User&gt;(id: 1);

// ææ¡ä»¶å é¤
await conn.DeleteAsync&lt;User&gt;(u =&gt; u.IsActive == false);

// ---------------------------
// è½¯å é¤ï¼SoftDeleteï¼éé¾å¼ï¼
// ---------------------------
// åæï¼å®ä½éè¦æ æ³¨ [SoftDelete]ï¼å¯æ å¨å®ä½ç±»ä¸æ IsDeleted å­æ®µå±æ§ä¸ï¼ï¼å¦åä¼æå¼å¸¸ï¼é¿åè¯¯ä»¥ä¸ºâå·²è½¯å âï¼ã
//
// 1) å¯éï¼å¼å¯æ¥è¯¢èªå¨è¿æ»¤å·²å é¤æ°æ®ï¼å¨å±å¼å³ï¼
DapperExtensions.ConfigureSoftDelete(o =&gt;
{
    o.FilterSoftDeleted = true;
});

// 2) é»è¾å é¤ / æ¢å¤ï¼æä¸»é®
await conn.SoftDeleteAsync&lt;User&gt;(id: 1);
await conn.RestoreAsync&lt;User&gt;(id: 1);

// 3) é»è¾å é¤ / æ¢å¤ï¼ææ¡ä»¶
await conn.SoftDeleteAsync&lt;User&gt;(u =&gt; u.UserName == "Alice");
await conn.RestoreAsync&lt;User&gt;(u =&gt; u.UserName == "Alice");
</code></pre>
<h3 id="å¤è¿æ¥ç»ä¸æ³¨åå¯édi-åºæ¯">å¤è¿æ¥ç»ä¸æ³¨åï¼å¯éï¼DI åºæ¯ï¼</h3>
<p>SmartDapper æ ¸å¿æ¯âä»¥ä½ ä¼ å¥ç <code>IDbConnection</code> ä¸ºåâï¼ä½ å¯ä»¥å¨ä¸ä¸ªé¡¹ç®éèªç±åå»º/ä½¿ç¨å¤ä¸ªè¿æ¥ã<br>
å¦æä½ å¸æå¨ DI ä¸­<strong>ç»ä¸æ³¨åå¤ä¸ªè¿æ¥éç½®</strong>ï¼å¯ä»¥ä½¿ç¨ <code>AddSmartDapperConnections(...)</code> æ³¨åä¸ä¸ªæ key åå»ºè¿æ¥çå·¥åï¼</p>
<pre><code class="language-csharp">using System.Data;
using Microsoft.Data.SqlClient;
using SmartDapper.Extensions;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddSmartDapperConnections(o =&gt;
{
    // æ¹å¼ 1ï¼æè¿æ¥å­ç¬¦ä¸² + å·¥å
    o.Add("Main", builder.Configuration.GetConnectionString("Main")!, cs =&gt; new SqlConnection(cs));
    o.Add("Log", builder.Configuration.GetConnectionString("Log")!, cs =&gt; new SqlConnection(cs));

    // å¯éï¼æå®é»è®¤ keyï¼ä¸è®¾åé»è®¤åç¬¬ä¸ä¸ª Add ç keyï¼
    o.DefaultKey = "Main";
});

// ä½¿ç¨ï¼æ key åå»ºè¿æ¥ï¼è¿æ¥ç±ä½ è´è´£éæ¾ï¼å¯æå usingï¼ä¹å¯ç¨è¾å©æ¹æ³èªå¨ usingï¼
// var factory = sp.GetRequiredService&lt;ISmartDapperConnectionFactory&gt;();
//
// æ¹å¼ 1ï¼æå using
// using var conn = factory.Create("Main");
// var users = await conn.GetAllListAsync&lt;User&gt;();
//
// æ¹å¼ 2ï¼è¾å©æ¹æ³ï¼åé¨ Create + Disposeï¼åå°éå¤ä»£ç ï¼
// var users2 = await factory.UseConnectionAsync("Main", c =&gt; c.GetAllListAsync&lt;User&gt;());
//
// é»è®¤è¿æ¥ï¼ç­ä»·äº factory.CreateDefault() / factory.UseDefaultXxx...ï¼
// var usersDefault = await factory.UseDefaultConnectionAsync(c =&gt; c.GetAllListAsync&lt;User&gt;());
//
// æ¹å¼ 3ï¼äºå¡è¾å©æ¹æ³ï¼åé¨ BeginTransaction + Commit/Rollback + Disposeï¼
// await factory.UseTransactionAsync("Main", async (c, tx) =&gt;
// {
//     await c.InsertAsync(new User { /* ... */ }, transaction: tx);
//     await c.UpdateAsync(new User { /* ... */ }, transaction: tx);
// });
//
// é»è®¤è¿æ¥çäºå¡çæ¬
// await factory.UseDefaultTransactionAsync(async (c, tx) =&gt;
// {
//     await c.InsertAsync(new User { /* ... */ }, transaction: tx);
//     await c.UpdateAsync(new User { /* ... */ }, transaction: tx);
// });
</code></pre>
<h3 id="sql-æ¥å¿è¾åºéç½®å¯éæ¨èå¨å¯å¨æ¶è®¾ç½®">SQL æ¥å¿è¾åºéç½®ï¼å¯éï¼æ¨èå¨å¯å¨æ¶è®¾ç½®ï¼</h3>
<p>SmartDapper å¨æ§è¡ CRUD/æ¥è¯¢æ¶ä¼è®°å½âçæç SQLâã<strong>é»è®¤ç­ç¥</strong>ï¼</p>
<ul>
<li><strong>Information</strong>ï¼ä»è¾åº SQLï¼ä¸è¾åºåæ°ï¼é¿åææä¿¡æ¯æ³é²ï¼</li>
<li><strong>Debug</strong>ï¼è¾åº SQL + åæ°ï¼ä¾¿äºæ¬å°/æµè¯ç¯å¢ææ¥ï¼</li>
</ul>
<p>ä½ å¯ä»¥å¨ç¨åºåå§åé¶æ®µéè¿ä»¥ä¸æ¹å¼è¿è¡éç½®ï¼</p>
<h4 id="æ¹å¼-1di-é£æ ¼æ¨è">æ¹å¼ 1ï¼DI é£æ ¼ï¼æ¨èï¼</h4>
<pre><code class="language-csharp">using Microsoft.Extensions.Logging;
using SmartDapper.Extensions;

var builder = WebApplication.CreateBuilder(args);

// 1) é»è®¤æ ééç½®ï¼Info åªè¾åº SQLï¼Debug è¾åº SQL + åæ°

// 2) å¦éå¨ Info çº§å«ä¹è¾åºåæ°ï¼æ³¨æææä¿¡æ¯é£é©ï¼
builder.Services.AddSmartDapper(configureSqlLogging: o =&gt;
{
    o.SqlLogLevel = LogLevel.Information;
    o.ParameterLogLevel = LogLevel.Information;
});

// 3) å¦éå½»åºç¦ç¨åæ°è¾åºï¼å³ä½¿ Debugï¼
builder.Services.AddSmartDapper(configureSqlLogging: o =&gt;
{
    o.ParameterLogLevel = LogLevel.None;
});
</code></pre>
<h4 id="æ¹å¼-11ç»ä¸æ³¨å¥æ¥å¿--è½¯å ä¸èµ·éç½®æ¨è">æ¹å¼ 1.1ï¼ç»ä¸æ³¨å¥ï¼æ¥å¿ + è½¯å ä¸èµ·éç½®ï¼æ¨èï¼</h4>
<pre><code class="language-csharp">using Microsoft.Extensions.Logging;
using SmartDapper.Extensions;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddSmartDapper(
    configureSqlLogging: o =&gt;
    {
        o.SqlLogLevel = LogLevel.Information;
        o.ParameterLogLevel = LogLevel.Information;
    },
    configureSoftDelete: o =&gt;
    {
        o.FilterSoftDeleted = true;
    },
    configureSqlServer: o =&gt;
    {
        // SQL Serverï¼æ¯å¦å¨ SELECT ç FROM è¡¨ååè¿½å  WITH (NOLOCK)
        o.UseNoLock = true;
    });
</code></pre>
<h3 id="ç»ææ å°typemapæ³¨åå¯édi-åºæ¯æ¨è">ç»ææ å°ï¼TypeMapï¼æ³¨åï¼å¯éï¼DI åºæ¯æ¨èï¼</h3>
<p>å½ä½ çâæ°æ®åºååâåâå®ä½å±æ§åâä¸ä¸è´æ¶ï¼ä¾å¦ <code>user_name</code> vs <code>UserName</code>ï¼ï¼å»ºè®®å¨å¯å¨é¶æ®µæ³¨åä¸æ¬¡æ å°è§åï¼</p>
<pre><code class="language-csharp">using SmartDapper.Extensions;

var builder = WebApplication.CreateBuilder(args);

// æâå®ä½æå¨ç¨åºéâæ¹éæ³¨åï¼é»è®¤æ [Table]/[Key]/[Column] è¯å«å®ä½ï¼
builder.Services.AddSmartDapperColumnMapping(
    matchNamesWithUnderscores: true,
    typeof(User).Assembly);
</code></pre>
<h3 id="å¨å±-queryfilterå¯éç±»ä¼¼å¶å®-orm-çå¨å±è¿æ»¤">å¨å± QueryFilterï¼å¯éï¼ç±»ä¼¼å¶å® ORM çå¨å±è¿æ»¤ï¼</h3>
<p>SmartDapper æ¯ææ³¨åâå¨å± QueryFilterâï¼å¨æ¥è¯¢æ¶èªå¨æè¿æ»¤æ¡ä»¶æ³¨å¥å° <code>WHERE</code>ï¼å¹¶ä¸ç¨æ·ä¼ å¥ç <code>Where(...)</code> æ¡ä»¶ç¨ <code>AND</code> ç»åï¼ã</p>
<p>å¸åç¨éï¼</p>
<ul>
<li><strong>è½¯å é¤ï¼æ¥å£é£æ ¼ï¼</strong>ï¼<code>ISoftDelete</code>ï¼å¯éæ¥å£ï¼+ <code>it =&gt; it.IsDeleted == false</code></li>
<li><strong>å¤ç§æ·/æ°æ®éç¦»</strong>ï¼<code>IHasTenant</code> + <code>it =&gt; it.TenantId == tenantId</code></li>
<li><strong>æ°æ®æé/åªçæææ°æ®</strong>ï¼<code>IHasCompany</code> / <code>IIsActive</code> ç­</li>
</ul>
<blockquote>
<p>å¼å®¹è¯´æï¼QueryFilter ä¸ç°æè½¯å å¼å³ <code>FilterSoftDeleted</code> <strong>å®å¨å¼å®¹</strong>ï¼å¯ä»¥åæ¶å¼å¯ï¼æç»ä¼ä¸èµ· <code>AND</code> å° <code>WHERE</code> éã<br>
æç¤ºï¼å¦æä½ åæ¶å¼å¯äº <code>FilterSoftDeleted=true</code>ï¼åéè¿ QueryFilter åäºåæ ·çè½¯å æ¡ä»¶ï¼ä¼äº§çâéå¤æ¡ä»¶âï¼ä¸å½±åç»æï¼åªæ¯åä½ï¼ã</p>
</blockquote>
<h4 id="æ¹å¼-1di-é£æ ¼æ¨è-1">æ¹å¼ 1ï¼DI é£æ ¼ï¼æ¨èï¼</h4>
<blockquote>
<p>æ³¨æï¼<code>AddSmartDapper(...)</code> çåæ°è¾å¤ï¼å»ºè®®ä½¿ç¨<strong>å½ååæ°</strong>ï¼é¿åé¡ºåºè¯¯ç¨ã</p>
</blockquote>
<pre><code class="language-csharp">using SmartDapper.Extensions;

builder.Services.AddSmartDapper(
    configureQueryFilters: o =&gt;
    {
        // ä¾ï¼æ¥å£è½¯å é¤ï¼éè¦å®ä½å®ç° ISoftDeleteï¼æä½ èªå®ä¹çæ¥å£/åºç±»ï¼
        o.AddTableFilter&lt;ISoftDelete&gt;(it =&gt; it.IsDeleted == false);
    });
</code></pre>
<h4 id="æ¹å¼-2é-di-åºæ¯ç´æ¥éç½®">æ¹å¼ 2ï¼é DI åºæ¯ï¼ç´æ¥éç½®ï¼</h4>
<pre><code class="language-csharp">using SmartDapper.Extensions;

DapperExtensions.ConfigureQueryFilters(o =&gt;
{
    o.AddTableFilter&lt;ISoftDelete&gt;(it =&gt; it.IsDeleted == false);
});
</code></pre>
<h4 id="æ¹å¼-3idbconnection-è¯­æ³ç³æ´æ¥è¿-dbqueryfilter">æ¹å¼ 3ï¼<code>IDbConnection</code> è¯­æ³ç³ï¼æ´æ¥è¿ <code>db.QueryFilter...</code>ï¼</h4>
<blockquote>
<p>è¯´æï¼C# ä¸æ¯ææ©å±âå±æ§âï¼å æ­¤è°ç¨å½¢æä¸º <code>db.QueryFilter().AddTableFilter(...)</code>ã</p>
</blockquote>
<pre><code class="language-csharp">using SmartDapper.Extensions;

using var conn = new SqlConnection("...");

conn.QueryFilter()
    .AddTableFilter&lt;ISoftDelete&gt;(it =&gt; it.IsDeleted == false);
</code></pre>
<h4 id="æ¹å¼-2é-di-åºæ¯ç´æ¥éç½®-1">æ¹å¼ 2ï¼é DI åºæ¯ï¼ç´æ¥éç½®ï¼</h4>
<pre><code class="language-csharp">using Microsoft.Extensions.Logging;
using SmartDapper.Extensions;

// SQL æ¥å¿
DapperExtensions.ConfigureSqlLogging(o =&gt;
{
    o.SqlLogLevel = LogLevel.Information;
    o.ParameterLogLevel = LogLevel.Debug; // é»è®¤å¼
});

// è½¯å ï¼æ¥è¯¢æ¯å¦èªå¨è¿æ»¤å·²å é¤ï¼
DapperExtensions.ConfigureSoftDelete(o =&gt;
{
    o.FilterSoftDeleted = true;
});

// SQL Server
DapperExtensions.ConfigureSqlServer(o =&gt;
{
    o.UseNoLock = true;
});
</code></pre>
<h3 id="è¡¨è¾¾å¼æ æ¯æèå´where--in--like--update-set">è¡¨è¾¾å¼æ æ¯æèå´ï¼WHERE / IN / LIKE / UPDATE SETï¼</h3>
<p>SmartDapper çâè¡¨è¾¾å¼æ è½¬ SQLâä¸»è¦ç¨äº <code>Expression&lt;Func&lt;T, bool&gt;&gt;</code>ï¼WHERE è°è¯ï¼ï¼ä»¥åæ´æ°åºæ¯ç <code>Expression&lt;Func&lt;T, object&gt;&gt;</code>ï¼SET å­æ®µéæ©/èµå¼ï¼ã</p>
<h4 id="whereexpressionfunct-boolæ¯æé¡¹">WHEREï¼<code>Expression&lt;Func&lt;T, bool&gt;&gt;</code>ï¼æ¯æé¡¹</h4>
<table>
<thead>
<tr>
<th>åºæ¯</th>
<th>ç¤ºä¾è¡¨è¾¾å¼ï¼C#ï¼</th>
<th>SQL å½¢æï¼æ¦å¿µï¼</th>
<th>å¤æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ç­å¼ / ä¸ç­</strong></td>
<td><code>x =&gt; x.Id == 1</code> / <code>x =&gt; x.Id != 1</code></td>
<td><code>Id = @Id</code> / <code>Id &lt;&gt; @Id</code></td>
<td>åæ°åé»è®¤æå­æ®µåçæ</td>
</tr>
<tr>
<td><strong>æ¯è¾</strong></td>
<td><code>x =&gt; x.Age &gt; 18</code> / <code>&gt;=</code> / <code>&lt;</code> / <code>&lt;=</code></td>
<td><code>Age &gt; @Age</code> ç­</td>
<td>ä»æ¯ææ¯è¾è¿ç®ç¬¦éå</td>
</tr>
<tr>
<td><strong>é»è¾ç»å</strong></td>
<td><code>x =&gt; x.IsActive &amp;&amp; x.Age &gt;= 18</code></td>
<td><code>(... ) AND (... )</code></td>
<td>æ¯æ <code>&amp;&amp;</code> / `</td>
</tr>
<tr>
<td><strong>NULL å¤æ­</strong></td>
<td><code>x =&gt; x.Name == null</code> / <code>!= null</code></td>
<td><code>Name IS NULL</code> / <code>IS NOT NULL</code></td>
<td>ä»å¯¹ <code>== null</code> / <code>!= null</code> ç¹å¤</td>
</tr>
<tr>
<td><strong>bool ç´æ¥ä½¿ç¨</strong></td>
<td><code>x =&gt; x.IsActive</code></td>
<td><code>IsActive = @IsActive</code>ï¼trueï¼</td>
<td>é¿åçæè£¸ååå¯¼è´ SQL ä¸å¯æ§è¡</td>
</tr>
<tr>
<td><strong>bool åå</strong></td>
<td><code>x =&gt; !x.IsDeleted</code></td>
<td><code>IsDeleted = 0</code></td>
<td>ä»å¯¹å®ä½ bool å­æ®µåååä¼å</td>
</tr>
<tr>
<td><strong>å­ç¬¦ä¸² Like</strong></td>
<td><code>Contains/StartsWith/EndsWith</code></td>
<td><code>LIKE @p</code></td>
<td>ä»æ¯æ <code>x =&gt; x.Column.Contains(value)</code> è¿ç±»âå®ä½å­æ®µå¨å·¦ä¾§âå½¢æ</td>
</tr>
<tr>
<td><strong>INï¼éååå«ï¼</strong></td>
<td><code>x =&gt; ids.Contains(x.Id)</code></td>
<td><code>Id IN (@Id_0, @Id_1, ...)</code></td>
<td>ä»æ¯æ <code>list.Contains(x.Property)</code>ï¼ç©ºéåä¼çæ <code>1 = 0</code></td>
</tr>
<tr>
<td><strong>Allï¼å¨æ»¡è¶³ï¼</strong></td>
<td><code>x =&gt; ages.All(a =&gt; x.Age &gt;= a)</code></td>
<td>å±å¼ä¸º <code>AND</code> ä¸²</td>
<td><code>All(empty)</code> ä¼çæ <code>1 = 1</code>ï¼è§ä¸æ¹å®å¨éå¶ï¼</td>
</tr>
</tbody>
</table>
<h4 id="update-ç-setexpressionfunct-objectæ¯æåæ³">UPDATE ç SETï¼<code>Expression&lt;Func&lt;T, object&gt;&gt;</code>ï¼æ¯æåæ³</h4>
<blockquote>
<p>éç¨äºï¼<code>conn.UpdateSet&lt;T&gt;().Set(...)</code> / <code>conn.Update(updateFields, predicate)</code> ç­ã</p>
</blockquote>
<table>
<thead>
<tr>
<th>åæ³</th>
<th>ç¤ºä¾</th>
<th>å»ºè®®</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¯¹è±¡åå§åå¨ï¼æ¨èï¼</strong></td>
<td><code>x =&gt; new User { Name = name, IsActive = true }</code></td>
<td>è¡¨è¾¾åæå¼ºï¼æ¯æå¸¸é/é­ååé</td>
</tr>
<tr>
<td><strong>åå­æ®µ</strong></td>
<td><code>x =&gt; x.Name</code></td>
<td>æ¯æï¼ä½éå¸¸ä»éæ­éæç¡®èµå¼ï¼æ´æ¨èå¯¹è±¡åå§åå¨ï¼</td>
</tr>
<tr>
<td><strong>å¿å new</strong></td>
<td><code>x =&gt; new { x.Name, x.IsActive }</code></td>
<td>å¯ç¨ï¼ä½æ´åâå­æ®µéæ©âï¼ä¸å¦å¯¹è±¡åå§åå¨è¯­ä¹æ¸æ°</td>
</tr>
</tbody>
</table>
<h4 id="å¸åä¸æ¯ææç¨">å¸åä¸æ¯æ/æç¨</h4>
<table>
<thead>
<tr>
<th>ç±»å</th>
<th>ç¤ºä¾</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ç®æ¯è¿ç®</strong></td>
<td><code>x =&gt; x.Age + 1 &gt; 18</code></td>
<td>ä¸æ¯æï¼WHERE äºåè¿ç®ä»å¤çæ¯è¾ä¸ AND/ORï¼</td>
</tr>
<tr>
<td><strong>æªç¥æ¹æ³è°ç¨</strong></td>
<td><code>x =&gt; x.Name.ToLower() == "a"</code></td>
<td>ä¸æ¯æï¼ä»æ¯æ string ç Contains/StartsWith/EndsWithï¼</td>
</tr>
<tr>
<td><strong>åå Contains</strong></td>
<td><code>x =&gt; x.Tags.Contains("a")</code></td>
<td>ä¸æ¯æï¼ä»æ¯æ <code>list.Contains(x.Prop)</code>ï¼</td>
</tr>
</tbody>
</table>
<h4 id="å®å¨éå¶éè¦">å®å¨éå¶ï¼éè¦ï¼</h4>
<ul>
<li><strong>UPDATE/DELETE ç¦æ­¢æçæ¡ä»¶</strong>ï¼ä¾å¦ <code>x =&gt; true</code>ãæ <code>All(empty)</code> å¯¼è´ç <code>1 = 1</code>ï¼ä¼è¢«æ¦æªï¼é²æ­¢è¯¯å¨è¡¨æä½ï¼ã</li>
<li><strong>Fluent æ¥è¯¢éå¶</strong>ï¼
<ul>
<li><code>Paging(skip, take)</code> <strong>ä¸è½</strong>ä¸èªå®ä¹ <code>OrderBy(...)</code> ç»åä½¿ç¨ï¼åé¡µ SQL å·²åç½®æåºè§åï¼ã</li>
<li>æå½±æ¥è¯¢ï¼<code>Select(projection)</code>ï¼<strong>ä¸æ¯æ</strong> <code>Paging(...)</code>ï¼ä¹<strong>ä¸æ¯æ</strong>ä¸ <code>SelectColumns(...)</code> æ··ç¨ï¼<code>SelectColumns</code> å·²æ è®° Obsoleteï¼ä»ä¸ºå¼å®¹ä¿çï¼ã</li>
</ul>
</li>
</ul>
<h3 id="é¾å¼æ©å±fluent-builder">é¾å¼æ©å±ï¼Fluent Builderï¼</h3>
<p>SmartDapper æä¾äºä¸ç»é¢å <code>IDbConnection</code> ç<strong>é¾å¼æå»ºå¨</strong>ï¼ç¨äºä»¥âå½ä»¤å¼é¾å¼ APIâç»ç»æ¥è¯¢/æå¥/æ´æ°/å é¤ï¼å¹¶å¨åé¨å¤ç¨ SmartDapper ç SQL çæè½åã</p>
<blockquote>
<p>å½åçº¦å®ï¼<code>QuerySet&lt;T&gt;() / InsertSet&lt;T&gt;() / UpdateSet&lt;T&gt;() / DeleteSet&lt;T&gt;()</code>ãæå»ºå¨å¯¹è±¡<strong>éçº¿ç¨å®å¨</strong>ï¼å»ºè®®æä¸æ¬¡è¯·æ±/ä¸æ¬¡æä½åå»ºå¹¶ä½¿ç¨ä¸æ¬¡ã</p>
</blockquote>
<h4 id="çº¿ç¨å®å¨è¯´æéè¦">çº¿ç¨å®å¨è¯´æï¼éè¦ï¼</h4>
<ul>
<li><strong>ä¸ºä»ä¹âçº¿ç¨ä¸å®å¨â</strong>ï¼æå»ºå¨åé¨ä¼ä¿å­å¯åç¶æï¼ä¾å¦ï¼<code>Where</code> è°è¯ã<code>Select</code> åã<code>OrderBy</code> æåºãåé¡µãäºå¡ãè¶æ¶ç­ï¼ãå¦æå¤ä¸ªçº¿ç¨/ä»»å¡å±äº«åä¸ä¸ªæå»ºå¨å®ä¾å¹¶å¹¶åä¿®æ¹ï¼ä¼äºç¸è¦çè¿äºç¶æï¼å¯¼è´çæç SQL/åæ°æ··ä¹±ã</li>
<li><strong>æ¨èç¨æ³</strong>ï¼æ¯æ¬¡æä½é½ä» <code>conn.QuerySet&lt;T&gt;() / InsertSet&lt;T&gt;() / ...</code> æ°å»ºä¸ä¸ªæå»ºå¨ï¼ç¨å®å³å¼ï¼ä¸è¦ææå»ºå¨ç¼å­ä¸ºéæ/åä¾ï¼ä¹ä¸è¦å¨å¹¶ååºæ¯å±äº«åä¸ä¸ªå®ä¾ã</li>
</ul>
<h4 id="æ¥è¯¢select">æ¥è¯¢ï¼Selectï¼</h4>
<pre><code class="language-csharp">using SmartDapper.Extensions;

public sealed class UserBriefDto
{
    public int Id { get; set; }
    public string UserName { get; set; } = string.Empty;
}

// 1) å¨å­æ®µæ¥è¯¢ + Where + OrderBy
var list = await conn.QuerySet&lt;User&gt;()
    .Where(u =&gt; u.IsActive &amp;&amp; u.Age &gt;= 18)
    .OrderBy(u =&gt; u.Id)
    .ToListAsync();

// 1.3) DISTINCTï¼æ¥è¯¢å»éï¼
var distinctList = await conn.QuerySet&lt;User&gt;()
    .Distinct()
    .Where(u =&gt; u.IsActive)
    .ToListAsync();

// 1.1) å¤å­æ®µæåºï¼æ¯æ new { ... }ï¼
var list2 = await conn.QuerySet&lt;User&gt;()
    .Where(u =&gt; u.IsActive)
    .OrderBy(u =&gt; new { u.Age, u.Id })
    .ToListAsync();

// 1.2) éåºæåºï¼ç¬ç«æ¹æ³ï¼
var list3 = await conn.QuerySet&lt;User&gt;()
    .Where(u =&gt; u.IsActive)
    .OrderByDescending(u =&gt; u.Id)
    .ToListAsync();

// 2) æå½±ï¼æ¨èï¼DTO/å¿åç±»åï¼
var dtoList = await conn.QuerySet&lt;User&gt;()
    .Select(u =&gt; new { u.Id, u.UserName })
    .Distinct()
    .Where(u =&gt; u.IsActive)
    .OrderBy(u =&gt; u.Id)
    .ToListAsync();

// 2.1) æå½±å° DTOï¼å¯¹è±¡åå§åå¨ï¼
var dtoList2 = await conn.QuerySet&lt;User&gt;()
    .Select(u =&gt; new UserBriefDto { Id = u.Id, UserName = u.UserName })
    .Where(u =&gt; u.IsActive)
    .ToListAsync();

// 3) æå®åï¼å­ç¬¦ä¸²ï¼ä»è¿åå®ä½ Tï¼ä½è¯·æ³¨ææªéåå°ä¸ºé»è®¤å¼ï¼
var columns = await conn.QuerySet&lt;User&gt;()
    .Select("Id", "UserName")
    .ToListAsync();

// 3.1) å­ç¬¦ä¸²ååæåºï¼ååº/éåºï¼
var columns2 = await conn.QuerySet&lt;User&gt;()
    .Select("Id", "UserName")
    .OrderBy("Id", "UserName")
    .ToListAsync();

var columns3 = await conn.QuerySet&lt;User&gt;()
    .Select("Id", "UserName")
    .OrderByDescending("Id", "UserName")
    .ToListAsync();

// 3.2) GroupByï¼åç»ï¼
// æ³¨æï¼GroupBy å¿é¡»éå Select("Col1", ...) æ Select(projection) æå®è¿åå
var grouped = await conn.QuerySet&lt;User&gt;()
    .Select("Age")
    .GroupBy(u =&gt; u.Age)
    .ToListAsync();

// 3.3) èå + Havingï¼æ¨èï¼æå½± + SqlFuncï¼
// æ³¨æï¼èåå½æ°éè¿ SqlFunc.* å¨è¡¨è¾¾å¼ä¸­å£°æï¼ç¨äºçæ SQLï¼ä¸ä¼å¨è¿è¡æ¶æ§è¡ï¼ã
// å¸åçæ SQL å½¢æï¼
// SELECT [Age] AS [Age], COUNT(*) AS [Cnt] FROM [Users] GROUP BY [Age] HAVING (COUNT(*) &gt; @value)
var grouped2 = await conn.QuerySet&lt;User&gt;()
    .Select(u =&gt; new { u.Age, Cnt = SqlFunc.Count() })
    .GroupBy(u =&gt; u.Age)
    .Having(u =&gt; SqlFunc.Count() &gt; 1)
    .ToListAsync();

// 4) å¼å®¹æ¹å¼ï¼ä¸æ¨èï¼ï¼SelectColumns(...) å·²æ è®° Obsoleteï¼è¿åâé¨åå­æ®µâçå®ä½ï¼æè¯¯ç¨
var legacyColumns = await conn.QuerySet&lt;User&gt;()
    .SelectColumns(u =&gt; new { u.Id, u.UserName })
    .ToListAsync();

// 5) JOINï¼Inner / Left / Rightï¼
// æ³¨æï¼JOIN éè¦ä½ æä¾ ON æ¡ä»¶ï¼è¡¨è¾¾å¼æ æåç SQL çæ®µï¼
var joined = await conn.QuerySet&lt;User&gt;()
    .InnerJoin&lt;Role&gt;((u, r) =&gt; u.RoleId == r.Id)
    .Where&lt;Role&gt;((u, r) =&gt; u.IsActive &amp;&amp; r.IsEnabled) // åè¡¨ WHERE
    .Select&lt;Role&gt;((u, r) =&gt; new { u.Id, u.UserName, r.RoleName }) // JOIN æå½±ï¼åæ¶å¼ç¨ä¸¤å¼ è¡¨ï¼å¿åç±»åæ éå objectï¼
    .Distinct()
    .ToListAsync();

// 5.1) JOIN + åç SQL WHEREï¼å¤æåºæ¯ååºï¼
var joined2 = await conn.QuerySet&lt;User&gt;()
    .LeftJoin&lt;Role&gt;((u, r) =&gt; u.RoleId == r.Id)
    .Where("[Role].[RoleName] LIKE @name", new { name = "%Admin%" })
    .ToListAsync();

// 5.2) ä¸¤æ¬¡ JOIN + ä¸è¡¨æå½± + ä¸è¡¨ WHERE
// æ³¨æï¼ç¬¬äºæ¬¡ JOIN å¯ä»¥ç¨âå·² Join çè¡¨âä½ä¸ºå·¦è¡¨ï¼ä¾å¦ Role -&gt; Deptï¼
var joined3 = await conn.QuerySet&lt;User&gt;()
    .InnerJoin&lt;Role&gt;((u, r) =&gt; u.RoleId == r.Id)
    .InnerJoin&lt;Role, Dept&gt;((r, d) =&gt; r.DeptId == d.Id) // ä»¥ Role ä½ä¸ºå·¦è¡¨å³è Dept
    .Select&lt;Role, Dept&gt;((u, r, d) =&gt; new { u.Id, u.UserName, r.RoleName, d.DeptName })
    .Where&lt;Role, Dept&gt;((u, r, d) =&gt; u.IsActive &amp;&amp; r.IsEnabled &amp;&amp; d.IsEnabled)
    .ToListAsync();

// 6) UNION / UNION ALLï¼åå¹¶ç»æéï¼
// æ³¨æï¼UNION è¦æ±ä¸¤ä¾§ SELECT çåæ°é/ç±»åå¯å¼å®¹ï¼åºä¸ä¼èªå¨å¯¹é½åã
// å¦å¤ï¼ä¸ºé¿åä¸¤ä¾§åæ°åå²çªï¼ä¾å¦é½çæ @Age / @w0_0ï¼ï¼UNION ä¼èªå¨å¯¹æ¯ä¸ªå­æ¥è¯¢ååæ°åç¼éç¦»ã
var unionList = await conn.QuerySet&lt;User&gt;()
    .Where(u =&gt; u.Age &gt; 18)
    .UnionAll(
        conn.QuerySet&lt;User&gt;().Where(u =&gt; u.Age &gt; 20))
    .OrderBy("Id")   // UNION ç»æéåå/å«åï¼åªåè®¸âç®åæ è¯ç¬¦âï¼
    .Paging(0, 20)   // SqlServer/Oracleï¼UNION åé¡µå¿é¡»å OrderBy(...)
    .ToListAsync();
</code></pre>
<h4 id="å é¤delete">å é¤ï¼Deleteï¼</h4>
<pre><code class="language-csharp">// 1) æ¡ä»¶å é¤
var affected = await conn.DeleteSet&lt;User&gt;()
    .Where(u =&gt; u.IsActive == false)
    .ExecuteAsync();

// 2) æä¸»é®å é¤
var affected2 = await conn.DeleteSet&lt;User&gt;()
    .ByKey(1)
    .ExecuteAsync();
</code></pre>
<h4 id="è½¯å é¤soft-delete">è½¯å é¤ï¼Soft Deleteï¼</h4>
<p>ç®åç­ç¥ï¼æ¨èï¼ï¼</p>
<ul>
<li><strong>ç©çå é¤</strong>ï¼<code>Delete(...) / DeleteSet&lt;T&gt;()</code> æ°¸è¿æ§è¡ <code>DELETE</code>ã</li>
<li><strong>é»è¾å é¤ï¼è½¯å ï¼</strong>ï¼æ¾å¼è°ç¨ <code>SoftDelete(...) / SoftDeleteSet&lt;T&gt;()</code>ï¼å¹¶ä¸å®ä½å¿é¡»æ æ³¨ <code>[SoftDelete]</code>ï¼å¦åä¼æåºå¼å¸¸ï¼é¿åè¯¯ä»¥ä¸ºå·²è½¯å ï¼ã</li>
<li><strong>æ¥è¯¢è¿æ»¤</strong>ï¼å¨å±å¼å³ <code>FilterSoftDeleted</code> æ§å¶æ¯å¦è¿æ»¤å·²å é¤æ°æ®ï¼é»è®¤ä¸è¿æ»¤ï¼æ¥è¯¢åå«å·²å é¤æ°æ®ï¼ãè¿æ»¤ä»å¯¹æ æ³¨äº <code>[SoftDelete]</code> çå®ä½çæã</li>
</ul>
<pre><code class="language-csharp">// 0) å®ä½å£°æè½¯å é¤ï¼å¯ä»¥æ å¨âå®ä½ç±»âæâè½¯å å­æ®µå±æ§âä¸
// - æ¨èæ å¨å±æ§ä¸ï¼æ ééç½® ColumnNameï¼é»è®¤ä½¿ç¨å±æ§åï¼æ [Column] æ å°åï¼
// - Flag æ¨¡å¼é»è®¤å¼ï¼NotDeletedValue=0ï¼DeletedValue=1
//
// class User
// {
//     [Key]
//     public int Id { get; set; }
//
//     [SoftDelete] // é»è®¤ Mode=Flagï¼NotDeletedValue=0ï¼DeletedValue=1
//     public int IsDeleted { get; set; }
// }

// 1) å¯ç¨è½¯å é¤ï¼å»ºè®®å¨å¯å¨é¶æ®µéç½®ä¸æ¬¡ï¼
// - DI é£æ ¼ï¼æ¨èï¼ï¼å¨ Program.cs ééç½®ï¼å¯ä¸ SQL æ¥å¿ä¸èµ·éä¸­éç½®
//   builder.Services.AddSmartDapper(configureSoftDelete: o =&gt;
//   {
//       o.FilterSoftDeleted = true; // å¼å¯åï¼æ¥è¯¢ä¼èªå¨æé¤âå·²å é¤âï¼ä»å¯¹æ æ³¨äº [SoftDelete] çå®ä½çæï¼
//   });
//
// - é DI åºæ¯ï¼ç´æ¥éç½®
DapperExtensions.ConfigureSoftDelete(o =&gt;
{
    o.FilterSoftDeleted = true; // å¼å¯åï¼æ¥è¯¢ä¼èªå¨æé¤âå·²å é¤âï¼ä»å¯¹æ æ³¨äº [SoftDelete] çå®ä½çæï¼
});

// 2) æ¥è¯¢ï¼é»è®¤åå«å·²å é¤ï¼å½ FilterSoftDeleted=true æ¶èªå¨æé¤å·²å é¤
var list = await conn.QuerySet&lt;User&gt;()
    .Where(u =&gt; u.IsActive)
    .ToListAsync();

// 3) ç©çå é¤ï¼DELETEï¼
await conn.DeleteSet&lt;User&gt;().ByKey(1).ExecuteAsync();

// 4) é»è¾å é¤ï¼SoftDeleteï¼ï¼å®ä½å¿é¡»æ æ³¨ [SoftDelete]ï¼å¦åä¼æå¼å¸¸
await conn.SoftDeleteSet&lt;User&gt;().ByKey(1).ExecuteAsync();

// 5) æ¢å¤ï¼åè½¯å ï¼
await conn.RestoreSet&lt;User&gt;().ByKey(1).ExecuteAsync();
</code></pre>
<h4 id="æå¥insert">æå¥ï¼Insertï¼</h4>
<pre><code class="language-csharp">// 1) èªå¨åå»ºå®ä½å¹¶å¡«å
var newId = await conn.InsertSet&lt;User&gt;()
    .Fill(u =&gt; { u.UserName = "Alice"; u.IsActive = true; })
    .ExecuteAndGetIdAsync();

// 2) åºäºå·²æå®ä½å®ä¾
var user = new User { UserName = "Bob", IsActive = true };
await conn.InsertSet(user).ExecuteAsync();
</code></pre>
<h4 id="æ´æ°update">æ´æ°ï¼Updateï¼</h4>
<pre><code class="language-csharp">// 1) æ¨èï¼å¯¹è±¡åå§åå¨ï¼è¡¨è¾¾å¼æ æåå¼ï¼
var rows = await conn.UpdateSet&lt;User&gt;()
    .Set(u =&gt; new User { UserName = "Alice", IsActive = true })
    .Where(u =&gt; u.Id == 1)
    .ExecuteAsync();

// 2) ä¹æ¯æï¼å¿åå¯¹è±¡ï¼å­æ®µåæâå±æ§å/ååâå¤çï¼
var rows2 = await conn.UpdateSet&lt;User&gt;()
    .Set(new { UserName = "Alice", IsActive = true })
    .Where(u =&gt; u.Id == 1)
    .ExecuteAsync();
</code></pre>
<h4 id="fluent-çå·²ç¥éå¶æ³¨æäºé¡¹">Fluent çå·²ç¥éå¶/æ³¨æäºé¡¹</h4>
<ul>
<li><strong>åé¡µä¸æåº</strong>ï¼<code>QuerySet&lt;T&gt;().Paging(skip, take)</code> ç®å<strong>ä¸æ¯æ</strong>ä¸èªå®ä¹ <code>OrderBy(...)</code> åç¨ï¼åé¡µ SQL å·²åç½®æåºè§åï¼ã</li>
<li><strong>åé¡µä¸æåºï¼éåºï¼</strong>ï¼åæ ·ä¸æ¯æä¸ <code>OrderByDescending(...)</code> åç¨ã</li>
<li><strong>åé¡µä¸åç»</strong>ï¼<code>QuerySet&lt;T&gt;().Paging(skip, take)</code> ç®å<strong>ä¸æ¯æ</strong>ä¸ <code>GroupBy(...)</code> åç¨ã</li>
<li><strong>DISTINCT æ³¨æäºé¡¹</strong>ï¼<code>Distinct()</code> ä¼å¯¹æ´è¡å»éï¼å¯è½å¸¦æ¥é¢å¤å¼éï¼å¹¶ä¸å¨ä¸åæ°æ®åºä¸ä¸ <code>ORDER BY</code>/åé¡µç»åæ¶å­å¨è¯­ä¹å·®å¼ï¼è¯·æä¸å¡è°¨æä½¿ç¨ã</li>
<li><strong>åç»éå¶</strong>ï¼<code>GroupBy(...)</code> éè¦æ¾å¼æå®è¿ååï¼<code>Select("Col1", ...)</code> æ <code>Select(projection)</code>ï¼ï¼ä¸æ¯æâå¨å­æ®µ + GroupByâã</li>
<li><strong>Having éå¶</strong>ï¼<code>Having(...)</code> éè¦æ¾å¼æå®è¿ååï¼<code>Select("Col1", ...)</code> æ <code>Select(projection)</code>ï¼ï¼éå¸¸åºä¸ <code>GroupBy(...)</code> éåä½¿ç¨ã
<ul>
<li>è¡¨è¾¾å¼ç <code>Having(predicate)</code> æ¯æ <code>SqlFunc.Count/Sum/Avg/Min/Max/CountDistinct</code> ç­èåå½æ°å£°æï¼</li>
<li>å¤æåºæ¯å¯ç¨ <code>Having("COUNT(*) &gt; @min", new { min = 1 })</code> ç´æ¥å SQL çæ®µï¼æ³¨æèªè¡ä¿è¯å®å¨ï¼ã</li>
</ul>
</li>
<li><strong>æå½±éå¶</strong>ï¼æå½±é¾ï¼<code>Select(projection)</code>ï¼ç®å<strong>ä¸æ¯æ</strong> <code>Paging(...)</code>ï¼ä¹<strong>ä¸æ¯æ</strong>ä¸ <code>SelectColumns(...)</code> æ··ç¨ï¼<code>SelectColumns</code> å·²æ è®° Obsoleteï¼ä»ä¸ºå¼å®¹ä¿çï¼ã</li>
<li><strong>JOIN æå½±éå¶</strong>ï¼
<ul>
<li><code>Select&lt;TJoin&gt;((t, j) =&gt; ...)</code>ï¼æ¯æ <strong>1 ä¸ª JOIN</strong>ï¼</li>
<li><code>Select&lt;TJoin1, TJoin2&gt;((t, j1, j2) =&gt; ...)</code>ï¼æ¯æ <strong>2 ä¸ª JOIN</strong>ï¼</li>
<li>å½åçæ¬ <code>Where(predicate)</code> çå¤è¡¨è°è¯ä»æ¯æ <strong>2 è¡¨/3 è¡¨</strong>ï¼ä¸ç¬¬ä¸ä¸ªåæ°å¿é¡»æ¯ä¸»è¡¨ <code>T</code>ã</li>
</ul>
</li>
<li><strong>UNION éå¶/æ³¨æ</strong>ï¼
<ul>
<li><code>Union/UnionAll</code> è¦æ±ä¸¤ä¾§æ¥è¯¢çååè¡¨ç»æå¼å®¹ï¼æ°é/ç±»åï¼ï¼åºä¸ä¼èªå¨è¡¥é½/å¯¹é½åï¼</li>
<li>UNION ç <code>OrderBy("Col")</code> ä»æ¯æ<strong>ç®ååå/å«å</strong>ï¼ä¸æ¯æ <code>Table.Col</code> è¿ç±»å¸¦ç¹å·å½¢å¼ï¼ï¼</li>
<li>SqlServer/Oracle ä¸ UNION ç <code>Paging(skip,take)</code> éè¦å <code>OrderBy(...)</code>ï¼å¦åæ æ³çæ OFFSET/FETCHï¼ã</li>
</ul>
</li>
<li><strong>First/Single</strong>ï¼<code>FirstOrDefault()/SingleOrDefault()</code> ä¸ä¼å¼ºå¶å  <code>TOP/LIMIT</code>ï¼ä»å¯¹ç»æéåâåç¬¬ä¸æ¡/åæ¡âçè¡ä¸ºï¼å¤æ¡å½ä¸­æ¶ <code>SingleOrDefault</code> ä¼æå¼å¸¸ï¼ã</li>
</ul>
<h3 id="å¤æ°æ®åºæ¯æ">å¤æ°æ®åºæ¯æ</h3>
<ul>
<li>SQL Serverï¼<code>SqlGeneratorFactory.CreateSqlServer&lt;T&gt;()</code></li>
<li>MySQLï¼<code>SqlGeneratorFactory.CreateMySql&lt;T&gt;()</code></li>
<li>SQLiteï¼<code>SqlGeneratorFactory.CreateSqlite&lt;T&gt;()</code></li>
</ul>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 10:17">2026-02-09 10:16</span>&nbsp;
<a href="https://www.cnblogs.com/mumaren">ç§é©¬äººwin</a>&nbsp;
éè¯»(<span id="post_view_count">133</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19593895);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19593895', targetLink: 'https://www.cnblogs.com/mumaren/p/19593895', title: 'Dapperè½»éçº§æ©å±åºSmartDapper' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãMongoDBãMongoDB æ¦è¿° ]]></title>
    <link>https://www.cnblogs.com/MeteorSeed/p/19588943</link>
    <guid>2a7f54f98b092f18d04412bb0e048ddc</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/MeteorSeed/p/19588943" title="åå¸äº 2026-02-09 10:09">
    <span role="heading" aria-level="2">ãMongoDBãMongoDB æ¦è¿°</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p data-pm-slice="2 2 []"><span>ããMongoDB æ¯ä¸æ¬¾å¼æºç NoSQL ææ¡£åæ°æ®åºï¼ä¸ä¼ ç»å³ç³»åæ°æ®åºï¼å¦&nbsp;<span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">PostgreSQLï¼çè¡¨ç»æä¸åï¼MongoDB ä»¥ç±»ä¼¼ JSON ç BSONï¼Binary JSONï¼æ ¼å¼å­å¨æ°æ®ï¼æ¯æå¨ææ©å±æ°æ®ç»æï¼éå¸¸éåå¤çéç»æåãåç»æåæ°æ®åé«å¹¶åãå¤§æ°æ®éçä¸å¡åºæ¯ã</span></span></p>
<p><span>ããBSON ä½ä¸º MongoDB çæ ¸å¿æ°æ®æ ¼å¼ï¼ä¸ä»å¼å®¹ JSON çæ°æ®ç»æï¼è¿æ¯æäºè¿å¶æ°æ®ãæ¥æãæ¶é´æ³ç­æ©å±ç±»åï¼è½æ´é«æå°æ»¡è¶³å¤ææ°æ®å­å¨éæ±ãæ¯ä¸ªæ°æ®è®°å½è¢«ç§°ä¸ºâææ¡£âï¼å¤ä¸ªææ¡£ç»æâéåâï¼éåå¯¹åºå³ç³»åæ°æ®åºä¸­çè¡¨ï¼ä½æ ééµå¾ªç»ä¸çå­æ®µç»æï¼åä¸éåä¸­çææ¡£å¯æ¥æä¸åçå­æ®µåæ°æ®ç±»åã</span></p>
<h1><span><span>MongoDB æ ¸å¿ç¹æ§</span></span></h1>
<p><span><span>ãã- çµæ´»çææ¡£æ¨¡åï¼ææ¡£ç»æä¸åºç¨ç¨åºä¸­çå¯¹è±¡æ¨¡åå¤©ç¶å¥åï¼æ éå¤æçå¯¹è±¡å³ç³»æ å°ï¼ORMï¼ï¼åµå¥å¼ææ¡£åæ°ç»å¯åå°è·¨è¡¨å³èæ¥è¯¢ï¼æåæ°æ®è®¿é®æçã</span></span></p>
<p><span><span>ãã- é«æ§è½ï¼å¨æµ·éæ°æ®å¤çæ¹é¢ï¼æ¥è¯¢éåº¦å¿«ï¼æ¯æå¤ç§ç±»åç´¢å¼ï¼è½é«æå¤çé«ååéè¯·æ±ãæ¯æåå¸å¼è®¡ç®è½åã</span></span></p>
<p><span><span>ãã- é«å¯ç¨æ§ï¼éè¿å¯æ¬éå®ç°æ°æ®åä½åèªå¨æéè½¬ç§»ï¼å½ä¸»èç¹æéæ¶ï¼éç¾¤å¯èªå¨éä¸¾æ°ä¸»èç¹ï¼ç¡®ä¿æå¡æç»­å¯ç¨ã</span></span></p>
<p><span><span>ãã- æ°´å¹³æ©å±æ§ï¼éè¿åçææ¯å°æ°æ®åå¸å¼å­å¨å¨å¤ä¸ªèç¹ï¼å¯æ ¹æ®æ°æ®éåå¹¶åéæ±å¨ææ©å±éç¾¤å®¹éï¼çªç ´åèç¹æ§è½ç¶é¢ã</span></span></p>
<p><span><span>ãã- äºå¡æ¯æï¼MongoDB æåå¹¶ä¸æ¯æäºå¡ãç¶èï¼éççæ¬è¿­ä»£ï¼MongoDB å¨å¶ 4.0 ç æ¬ä¸­å¼å§æ¯æå¤ææ¡£äºå¡ã</span></span></p>
<p><span><span>ãã- ä¸°å¯çæ¥è¯¢è½åï¼æ¯æèå´æ¥è¯¢ãæ¨¡ç³æ¥è¯¢ãå°çç©ºé´æ¥è¯¢ãå¨ææç´¢ç­å¤ç§æ¥è¯¢æ¹å¼ï¼éåå¼ºå¤§çèåè®¡ç®è½åå®ç°å¤ææ°æ®ç»è®¡åæï¼éåéç»æåæ°æ®ï¼ã</span></span></p>
<p><span><span>ãã- è·¨å¹³å°ï¼æ¯æå¤ç§æä½ç³»ç»ã</span></span></p>
<p><span><span>ãã- ç®åæç¨ï¼<span>MongoDB æ¯éç¨åææ¡£æ°æ®åºï¼è®¾è®¡åè¡·å°±æ¯è´´è¿å¼åä¹ æ¯ãéä½å­å¨åéç¨æ¥è¯¢çä½¿ç¨ææ¬ï¼ç¸æ¯äº Elasticsearchï¼MongoDB å¨å¼åãæ¥è¯¢è¯­å¥ãé¨ç½²è¿ç»´ç­æ¹é¢é½æ´ç®åï¼å­¦ä¹ ææ¬ä¹æ´ä½ã</span></span></span></p>
<h1 data-pm-slice="2 2 []"><span><span>MongoDB çè®¾è®¡æè·¯</span></span></h1>
<p><span>ããMongoDB ä¸åäº PostgreSQL è¿ç±»å³ç³»åæ°æ®åºï¼ä¸¤èçè®¾è®¡åè¡·æ¬è´¨å°±ä¸å ââ å³ç³»åæ°æ®åºæ¯å¼ºä¸è´æ§ãäºå¡å®å¨ä¼åçæ°æ®åºï¼<span>ä¸º âæ°æ®å³èç´§å¯ãäºå¡è¦æ±é«ãæ¥è¯¢å¤æâ çä¸å¡èçï¼<span>çºç²é¨åæ§è½æ¢æ°æ®å¯é æ§ï¼å æ­¤ï¼å¨æµ·éæ°æ®æåµä¸ä¼å¼åæ§è½é®é¢<span>ï¼è MongoDB æ¯é«å¹¶åãæ°´å¹³æ©å±ä¼åçæ°æ®åºï¼<span>æ¯ä¸ºçµæ´»ãæ©å±ãé«æ§è½åå¥è®¾è®¡çææ¡£å NoSQLï¼ä¸º âæ°æ®ç»æå¤åãæµ·éæ°æ®ãé«å¹¶ååå¥ãæ°´å¹³æ©å±â çäºèç½ä¸å¡èçãä¸ºäºä¸å³ç³»åæ°æ®åºå¯¹é½ï¼å¶äºå¡åè½æ¯<span>åç»­çæ¬éè¿è¿­ä»£è¡¥å¨çç¹æ§ï¼å å¶å¼ææ¬è´¨ä¸åï¼ä»æåå¤©å±éæ§ï¼ä¼å¨æ§è½ååè½ä¸å­å¨ä¸è¶³ã</span></span></span></span></span></span></p>
<h1><span><span>MongoDB éç¨åºæ¯</span></span></h1>
<p><span>ããMongoDB å­åå¶çµæ´»æ§åé«æ§è½ï¼å¹¿æ³åºç¨äºä»¥ä¸åºæ¯ï¼</span></p>
<p><span><span>ãã- äºèç½åºç¨ï¼ç¨æ·ç»åãæ¥å¿å­å¨ãç¤¾äº¤ç½ç»å¨æç­éç»æåæ°æ®å­å¨ã</span></span></p>
<p><span><span>ãã- æ¸¸æå¼åï¼ææ¡£æ¨¡åä¸æ°æ®ç»æå¤©ç¶å¹éï¼å®ç¾æ å°æ¸¸æå¤ææ°æ®ï¼åææ¡£å­å¨è§è²ãè£å¤ãæè½ãä»»å¡ç­å¨éæ°æ®ï¼è½ææé¿åå¤è¡¨ JOINï¼<span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">é«å¹¶åï¼æ§è½å¥½<span>ã</span></span></span></span></p>
<p><span>ãã-<span>&nbsp;çµåå¹³å°ï¼ååä¿¡æ¯ãè®¢åæ°æ®ãç¨æ·è¡ä¸ºè½¨è¿¹åæã</span></span></p>
<p><span><span>ãã- ç©èç½ï¼è®¾å¤çæ§æ°æ®ãä¼ æå¨ééæ°æ®ç­æ°æ®çå­å¨ä¸å®æ¶åæã</span></span></p>
<p><span><span>ãã- å¤§æ°æ®åºæ¯ï¼æ¯ææµ·éæ°æ®çå¿«éåå¥åæ¥è¯¢ã</span></span></p>
<h1><span><span>MongoDB ä¸éç¨åºæ¯</span></span></h1>
<h2><span><span>é«å¹¶åå¼ºäºå¡æ°æ®ä¸è´æ§åºæ¯</span></span></h2>
<p><span><span>ããæ¯å¦éèç³»ç»ä¸­çè´¦æ·è½¬è´¦ãæ¯ä»ç»ç®ãä¿¡è´·æ¾æ¬¾ãè´¦å¡æ¸ç®ï¼çµåçè®¢åæ¯ä» + åºå­æ£å + ä¼æ å¸æ ¸éçèå¨æä½ç­ãè½ç¶ MongoD<span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">B<span>&nbsp;ä¹æ¯æäºå¡ï¼ä½å±äºâè½ç¨ä½ä¸å¥½ç¨âç<span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ç¶æï¼éç²åº¦å¯¼è´äºå¡æ§è½ä¸ä½³ï¼<span>ã</span></span></span></span></span></span></p>
<h2><span><span>å¤æå¤è¡¨å³èçå¯éæ¥è¯¢åºæ¯</span></span></h2>
<p><span>ããæ¯å¦ï¼å¤ææ¥è¡¨åæ ãå¤ç»´åº¦èè¡¨æ¥è¯¢ãå¤§è§æ¨¡æ°æ®ç»è®¡åæã</span></p>
<h2><span><span>ä¸å¡ä¾èµé«çº§ç¹æ§æ¯æ</span></span></h2>
<p><span>ããå¯¹äºéè¦é«çº§ç¹æ§æ¯æçåºç¨ï¼æ¯å¦<span>ï¼å¶<span>å°çç©ºé´æ¯æè½å¯ç¨ï¼ä½ç¸æ¯å¶ä»æ°æ®åºï¼å¦ PostgreSQL ç PostGIS ï¼è¡¨ç°ä¸è¶³<span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ã</span></span></span></span></p>
<h2><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>æªæ¥æå½äº§åéæ±çé¡¹ç®</span></span></h2>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ããMongoDB å·²ç»æå¯¹åºçå½äº§åçæ¬ï¼è½å¤æ ç¼å¹³æ¿ï¼ä½å½äº§å MongoDB çææ¬é«ï¼ä¸å°ä¼ï¼ä¸ä¸å®è½éç¨äºææå½äº§åé¡¹ç®ãMongoDB æ°æ®å°å³ç³»åæ°æ®è¿ç§»ï¼è½ç¶å¯è¡ï¼ä½å ä¸ºè®¾è®¡æè·¯ä¸åï¼å¦æä¸æ¯é¢åå°±è§åè¿è¿ç§»å°å³ç³»åæ°æ®åºçéæ±ï¼å¹¶æ E-R å³ç³»è®¾è®¡ç»æï¼å°±ä¼å¯¼è´åæéè¦æè¡¨ï¼è¿ç§»ææ¬å¤§å¹æé«ï¼è½¯ä»¶æ¶æä¸ééç­é®é¢ã</span></span></p>
<h1><span><span>å°è</span></span></h1>
<p><span><span>ããMongoDB æ¯ä¸æ¬¾å¼æºãçµæ´»ãé«æ§è½çææ¡£å NoSQL æ°æ®åºï¼ä»¥ BSON æ ¼å¼å­å¨æ°æ®ï¼æ ¸å¿ä¼å¿å¨äºçµæ´»çææ¡£æ¨¡åãä¼å¼çé«å¹¶åå¤çè½åãä¾¿æ·çæ°´å¹³æ©å±æ§åé«å¯ç¨æ§ï¼è´´è¿å¼åä¹ æ¯ï¼å­¦ä¹ åè¿ç»´ææ¬è¾ä½ãå¶è®¾è®¡åè¡·èç¦äºæ°æ®ç»æå¤åãæµ·éæ°æ®ãé«å¹¶ååå¥çäºèç½ç±»åºæ¯ï¼å¹¿æ³åºç¨äºäºèç½ãæ¸¸æãçµåãç©èç½ç­é¢åãåæ¶ï¼MongoDB ä¹å­å¨ææ¾å±éï¼å¨å¼ºäºå¡ä¸è´æ§ãå¤æå¤è¡¨å³èæ¥è¯¢ãé«çº§ä¼ä¸çº§ç¹æ§æ¯æç­åºæ¯ä¸­è¡¨ç°ä¸è¶³ï¼ä¸å½äº§åééä»ææåç©ºé´ã</span></span></p>
<p><span> ããæ´ä½èè¨ï¼MongoDB è½éâä¸è½æ°æ®åºâï¼ä½ä»æææ¡çå¿è¦ï¼è¥ä¸å¡ä»¥éç»æå/åç»æåæ°æ®ä¸ºä¸»ãè¿½æ±é«å¹¶ååæ©å±æ§ï¼ä¸æ¶åå¼ºäºå¡ï¼æ°æ®éç¹å«å·¨å¤§<span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">æ¶<span>ï¼MongoDB æ¯ä¼éã</span></span></span></p>
<p><span>ããå¨ä¸­å¤§åé¡¹ç®ä¸­ï¼å¤ä¸ºå³ç³»åä¸éå³ç³»åæ··åä½¿ç¨ï¼ç¸æ¯ <span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">Elasticsearchï¼<span>MongoDB&nbsp;<span>å¥åä¸ªäºº âå¿«éä¸æãä½ææ¬å­¦ä¹ â åå°å¾®ä¼ä¸ âäººåæéãèµæºä¸è¶³ãéæ±ç®åâ çæ ¸å¿è¯æ±ï¼å æ­¤å­¦ä¹ åè¿ç»´ææ¬æ´ä½ï¼æ´éåä½ä¸ºä¸ªäººåå°å¾®ä¼ä¸ç NoSQL é¦éæ°æ®åºã</span></span></span></span></p>
<p>&nbsp;</p>
<p><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span>ããæå¸ææ¨åæ¬¢è¿ç¯æç« ï¼å¹¶ä¸å¦æ¢å¾å°æè°¢æ¨éè¯»å¹¶ä¸æåååäºåäº«æçæç« ã</span></span></span></span></p>
<p><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span><img src="https://img2024.cnblogs.com/blog/270073/202509/270073-20250926105511928-738986494.webp" alt="me" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></span></span></span></span></p>
<p>&nbsp;</p>

</div>
<div id="MySignature" role="contentinfo">
    <blockquote>
<p><strong>ä½èï¼</strong><a href="http://www.cnblogs.com/MeteorSeed">MeteorSeed</a></p>
<p><strong>æå¸ææ¨åæ¬¢è¿ç¯åæï¼å¹¶ä¸å¦æ¢å¾å°æè°¢æ¨éè¯»å¹¶ä¸æåååäºåäº«æçåæã</strong></p>
<p><strong>è½¬è½½è¯·æ³¨æåºå¤ã</strong></p>
</blockquote>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 10:09">2026-02-09 10:09</span>&nbsp;
<a href="https://www.cnblogs.com/MeteorSeed">MeteorSeed</a>&nbsp;
éè¯»(<span id="post_view_count">38</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19588943);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19588943', targetLink: 'https://www.cnblogs.com/MeteorSeed/p/19588943', title: 'ãMongoDBãMongoDB æ¦è¿°' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Antigravity-Managerï¼AI å¤è´¦å·ç®¡å®¶ + API åä»£ ]]></title>
    <link>https://www.cnblogs.com/bugshare/p/19593797</link>
    <guid>75c76f4d2817490ebb1f5434e2f3c060</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/bugshare/p/19593797" title="åå¸äº 2026-02-09 10:08">
    <span role="heading" aria-level="2">Antigravity-Managerï¼AI å¤è´¦å·ç®¡å®¶ + API åä»£</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨ AI åºç¨æ¥çå¢é¿çä»å¤©ï¼å¼åèå¾å¾éè¦åæ¶ç®¡çå¤ä¸ªæå¡è´¦å·ï¼å¦ OpenAIãClaudeãGemini ç­ï¼ï¼å¹¶ææå°è¿äºæå¡ç»ä¸è°åº¦ãå¹¶å¨æ¬å°ææå¡å¨ä¸ç¨³å®è¿è¡ã<br>
<strong>Antigravity-Manager</strong> æ­£æ¯è¿æ ·ä¸æ¬¾å¼ºå¤§çå¼æºå·¥å·ï¼å®ä¸ä»å·å¤ä¸ä¸çè´¦å·ç®¡çåè½ï¼è¿æ¯æåè®®è½¬æ¢ãä¸­ç»§ä»£çç­é«çº§åè½ï¼å¯ä»¥ä¸ Claude Code CLI ç­å®¢æ·ç«¯æ ç¼éæï¼è®©ä½ ç AI è°ç¨æ´ç¨³å®ãæ´æºè½ã</p>
<hr>
<h1 id="ä¸antigravity-manager-æ¯ä»ä¹">ä¸ãAntigravity-Manager æ¯ä»ä¹ï¼</h1>
<p><strong>Antigravity-Manager</strong> æ¯ç±ç¤¾åºå¼åçä¸æ¬¾è·¨å¹³å°ï¼Windows / macOS / Linuxï¼æ¡é¢åºç¨ï¼ç¨äºï¼</p>
<ul>
<li>ð§  <strong>è´¦å·ç®¡çä¸ä¸é®åæ¢</strong> å¤ä¸ª AI æå¡è´¦å·ï¼</li>
<li>ð <strong>åè®®è½¬æ¢ä¸åä»£ä»£ç</strong>ï¼å¼å®¹ OpenAIãAnthropicï¼Claude CLIï¼å Gemini ç­ï¼</li>
<li>âï¸ <strong>æºè½è°åº¦ä¸æ¨¡åè·¯ç±</strong>ï¼å®ç°éé¢ç®¡çåè¯·æ±ä¼åçº§è°åº¦ã</li>
</ul>
<p>ç®èè¨ä¹ï¼å®æ¯ä¸ä¸ªâå¨è½ AI è´¦å·ç®¡å®¶ + æ¬å°åä»£æå¡ç«¯âï¼å¸®å©ä½ æå»ºä¸ªäººæå¢éçº§ç AI è°ç¨ç½å³ã</p>
<hr>
<h1 id="äºä¸ºä½ä½¿ç¨è´¦å·ç®¡ç">äºãä¸ºä½ä½¿ç¨âè´¦å·ç®¡çâï¼</h1>
<p>å¨å¤ä¸ª AI å¹³å°åæ¶ä½¿ç¨æ¶ï¼ä½ å¯è½é¢ä¸´è¿äºçç¹ï¼</p>
<ul>
<li>ð åä¸è´¦å·éé¢èå°½å¯¼è´è¯·æ±å¤±è´¥ï¼</li>
<li>ð åæ¢è´¦å·ç¹çãç¼ºå°ä¸ä½åç®¡çï¼</li>
<li>ð é¾ä»¥å®æ¶æ¥çæ¯ä¸ªè´¦å·çéé¢ä¸ç¶æï¼</li>
<li>ð§  ç»å CLI å·¥å·æ¶ï¼æ²¡æç»ä¸åä»£å¥å£ã</li>
</ul>
<p><strong>Antigravity-Manager çè´¦å·ç®¡çï¼Account Managementï¼æ¨¡å</strong>æ­£æ¯ä¸ºäºè§£å³è¿äºé®é¢è®¾è®¡çï¼å®æä¾äº <strong>OAuth ææãToken å¯¼å¥ã403 èªå¨æ æ³¨ãè´¦å·ç¶æå¥åº·çæ§ç­å¨å¥åè½</strong>ã</p>
<hr>
<h1 id="ä¸å®è£-antigravity-manager">ä¸ãå®è£ Antigravity-Manager</h1>
<p>å®è£æ¹å¼éå¸¸çµæ´»ï¼è¦çæ¡é¢ä»¥åæå¡å¨ç¯å¢ã</p>
<h2 id="ï¸-æ¹å¼-1æ¡é¢å®è£æ¨è">âï¸ æ¹å¼ 1ï¼æ¡é¢å®è£ï¼æ¨èï¼</h2>
<p>macOS / Linuxï¼æ¨èï¼</p>
<p>å¦æä½ å·²å®è£ <strong>Homebrew</strong>ï¼</p>
<pre><code class="language-bash">brew tap lbjlaq/antigravity-manager https://github.com/lbjlaq/Antigravity-Manager
brew install --cask antigravity-tools
</code></pre>
<p>å®è£å®æåç´æ¥è¿è¡å®¢æ·ç«¯è¿å¥å¯è§åç®¡ççé¢ã</p>
<hr>
<h2 id="-æ¹å¼-2æå¨ä¸è½½å®è£">ðª æ¹å¼ 2ï¼æå¨ä¸è½½å®è£</h2>
<p>è®¿é® GitHub Releases é¡µé¢ï¼ä¸è½½å¯¹åºç³»ç»çå®è£åï¼</p>
<p>ð¦ macOSï¼<code>.dmg</code><br>
ð» Windowsï¼<code>.msi</code> / <code>.zip</code><br>
ð§ Linuxï¼<code>.deb</code> / <code>AppImage</code><br>
ï¼æ¯æ Apple SiliconãIntel ç­ä¸»æµæ¶æï¼</p>
<hr>
<h2 id="-æ¹å¼-3docker-é¨ç½²æå¡å¨--nas">ð³ æ¹å¼ 3ï¼Docker é¨ç½²ï¼æå¡å¨ &amp; NASï¼</h2>
<p>å¦æå¸æå¨NAS/æå¡å¨é¿æè¿è¡ï¼å¯åèï¼</p>
<pre><code class="language-bash">docker run -d \
	--name antigravity-manager \
  -p 8045:8045 \
  -e API_KEY=sk-your-api-key \
  -e WEB_PASSWORD=your-login-password \
  -v ~/.antigravity_tools:/root/.antigravity_tools \
  lbjlaq/antigravity-manager:latest

#### ð é´æé»è¾è¯´æ
*   **åºæ¯ Aï¼ä»è®¾ç½®äº `API_KEY`**
    - **Web ç»å½**ï¼ä½¿ç¨ `API_KEY` è¿å¥åå°ã
    - **API è°ç¨**ï¼ä½¿ç¨ `API_KEY` è¿è¡ AI è¯·æ±é´æã
*   **åºæ¯ Bï¼åæ¶è®¾ç½®äº `API_KEY` å `WEB_PASSWORD` (æ¨è)**
    - **Web ç»å½**ï¼**å¿é¡»**ä½¿ç¨ `WEB_PASSWORD`ï¼ä½¿ç¨ API Key å°è¢«æç»ï¼æ´å®å¨ï¼ã
    - **API è°ç¨**ï¼ç»ä¸ä½¿ç¨ `API_KEY`ãè¿æ ·æ¨å¯ä»¥å° API Key ååç»æåï¼èä¿çå¯ç ä»ä¾ç®¡çåä½¿ç¨ã
</code></pre>
<p>è¿æ · Antigravity-Manager ä¼å¨å®¹å¨åèªå¨å¯å¨åç«¯æå¡ååä»£ä»£çã</p>
<p><img alt="PixPin_2026-02-07_19-53-26.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3715916/202602/3715916-20260209100730483-1876218141.png" class="lazyload"></p>
<hr>
<h1 id="åç®¡çè´¦å·ä¸æ¥å¥-claude-code-cli">åãç®¡çè´¦å·ä¸æ¥å¥ Claude Code CLI</h1>
<h2 id="-1-æ·»å è´¦å·oauth--token">ð 1. æ·»å è´¦å·ï¼OAuth / Tokenï¼</h2>
<p>æå¼å®¢æ·ç«¯ â âAccounts / è´¦å·â â âæ·»å è´¦å·âï¼ä½ å¯ä»¥ï¼</p>
<ul>
<li>ä½¿ç¨ <strong>OAuth 2.0 ææ</strong> æ·»å è´¦å·ï¼å·¥å·ä¼æåçæææé¾æ¥ï¼å¨æµè§å¨å®æç»å½ææåèªå¨ä¿å­ï¼</li>
<li>æèéè¿ <strong>Token / JSON æ¹éå¯¼å¥</strong> å·²æç API Key/Sessionï¼éåå·²æè´¦å·å¤ä»½è¿ç§»ã</li>
</ul>
<p><img alt="1770467416323.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3715916/202602/3715916-20260209100728916-1926646552.png" class="lazyload"></p>
<hr>
<h2 id="-2-è´¦å·ä»ªè¡¨çä¸å¥åº·çæ§">ð 2. è´¦å·ä»ªè¡¨çä¸å¥åº·çæ§</h2>
<p>å¨ä»ªè¡¨çä¸­ï¼ä½ å¯ä»¥ï¼</p>
<ul>
<li>å®æ¶æ¥çè´¦å·ç±»åãå©ä½éé¢ãæ¯å¦è¢«ç¦ç¨ï¼</li>
<li>ç³»ç»èªå¨æ æ³¨å¼å¸¸è´¦å·ï¼ä¾å¦ 403 ç¦ç¨ï¼ï¼å¹¶è·³è¿è¿äºè´¦å·ï¼</li>
<li>ä¸é®åæ¢æ´»è·è´¦å·ï¼å¿«éè°åº¦è°ç¨é¾è·¯ã</li>
</ul>
<p>è¿å¯¹ç®¡çå¤ä¸ªä»è´¹ / åè´¹è´¦å·æä¸ºå®ç¨ã</p>
<p><img alt="PixPin_2026-02-07_20-28-11.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3715916/202602/3715916-20260209100730923-1182044159.png" class="lazyload"></p>
<hr>
<h2 id="-3-æ¥å¥-claude-code-cli-åä»£">ð  3. æ¥å¥ Claude Code CLI åä»£</h2>
<p>Antigravity-Manager åç½®äº <strong>Anthropic åè®®çåä»£æ¯æ</strong>ï¼å¯ä»¥è®© Claude Code CLI ç´æ¥èµ°æ¬å°ä»£çã</p>
<p><img alt="PixPin_2026-02-07_20-33-42.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3715916/202602/3715916-20260209100732274-2131575585.png" class="lazyload"></p>
<h3 id="-æ¹å¼1ç¯å¢åéæ¹å¼">ð æ¹å¼1ï¼ç¯å¢åéæ¹å¼</h3>
<ol>
<li>å¨ Antigravity-Manager åå¯ç¨ <strong>API åä»£æå¡</strong>ï¼</li>
<li>å¨ç»ç«¯è®¾ç½®ç¯å¢åéï¼</li>
</ol>
<pre><code class="language-bash">export ANTHROPIC_API_KEY="sk-antigravity"
export ANTHROPIC_BASE_URL="http://127.0.0.1:8045"
</code></pre>
<ol start="3">
<li>å¯å¨ <strong>Claude Code CLI</strong>ï¼</li>
</ol>
<pre><code class="language-bash">claude
</code></pre>
<h3 id="-æ¹å¼2ç´æ¥ç¹åæ­¥æé®æ´ç½">ð æ¹å¼2ï¼ç´æ¥ç¹åæ­¥æé®ï¼æ´ç½ï¼</h3>
<p>æ´è´´å¿çæ¯ä½èè¿æä¾äºéè¿çé¢âç«å³åæ­¥éç½®âã</p>
<p><img alt="1770467877401.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3715916/202602/3715916-20260209100729749-1964618628.png" class="lazyload"></p>
<p>æ­¤æ¶ææ CLI è¯·æ±å°éè¿ Antigravity-Manager çåä»£æå¡ååºï¼ä½ å¯ä»¥ç»åè´¦å·æ± è°åº¦ï¼æé«ç¨³å®æ§å¹¶ç»ä¸ç®¡çæ¥å¿ä¸éé¢ç»è®¡ã</p>
<p>ð¡ è¿ç§æ¹å¼å°¤å¶éç¨äºå¼åèå¸æå¨æ¬å°ç»ç«¯ç¯å¢ä½¿ç¨ Claude CLI å·¥å·æ¶ï¼æä¸ä¸ªç»ä¸çä»£çå±è¿è¡è´¦å·è½®æ¢åå¤±è´¥éè¯ã</p>
<p>â¶ï¸ <strong>é¤äºClaude Code CLIï¼è¿æ¯ææ¥å¥OpenCodeãKilo CodeãPython</strong>ï¼å¯ä»¥æå¿«çå¼åäºï¼</p>
<h2 id="-4-ä¹å¯ä»¥å¯ç¨å½åæºè°±æ¨¡å">â¡ 4. ä¹å¯ä»¥å¯ç¨å½åæºè°±æ¨¡å</h2>
<p>å¦æä½ éè¦æ··ç¨å½åæ¨¡åï¼åªè¦å¡« Key å³å¯ã</p>
<p><img alt="PixPin_2026-02-07_20-49-10.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3715916/202602/3715916-20260209100732066-1847990630.png" class="lazyload"></p>
<hr>
<h1 id="äºä½¿ç¨å»ºè®®ä¸å®ææå·§">äºãä½¿ç¨å»ºè®®ä¸å®ææå·§</h1>
<p>â¨ <strong>ä¼åè´¦å·æ± </strong>ï¼å°é«éé¢è´¦å·ç½®äºä¼åéåï¼å¹¶æ ¹æ®ä½¿ç¨åºæ¯å¨æåæ¢ï¼æåæåçã</p>
<p>â¨ <strong>æ¹éå¯¼å¥</strong>ï¼å¯¹äºå¤§éè´¦å·å¯ä»¥æåéè¿ JSON å¯¼å¥ï¼é¿åéå¤æå¨è¾å¥ã</p>
<p>â¨ <strong>ç»å CLI çæ§æ¥å¿</strong>ï¼å¨åä»£è¿è¡ä¸­ï¼å¡å¿çæ§ HTTP è¿åç ï¼å¦ 429/401ï¼ä»¥è°æ´è¯·æ±ç­ç¥ã</p>
<p>â ï¸ <strong>æ³¨æå®å¨</strong>ï¼OAuth åè°æ¯éè¿æ¬å°çå¬å®ç°çï¼ç¡®ä¿é²ç«å¢åè®¸æ¬å°åç¯è®¿é®ï¼é¿åææå¤±è´¥ã</p>
<hr>
<h1 id="å­æ»ç»">å­ãæ»ç»</h1>
<p>ð <strong>Antigravity-Manager</strong> ä¸ä»æ¯ä¸æ¬¾å¼ºå¤§ç <strong>AI è´¦å·ç®¡çå·¥å·</strong>ï¼è¿å·å¤åè®®åä»£ãæ¨¡åè·¯ç±ãå¥åº·çæ§ç­ä¸°å¯åè½ãéè¿å®ï¼ä½ å¯ä»¥ï¼</p>
<p>âï¸ ä¸ç«å¼ç®¡çå¤ä¸ª AI å¹³å°è´¦å·ï¼<br>
âï¸ å®ç°è´¦å·éé¢ä¼åçº§è°åº¦åèªå¨å¼å¸¸è·³è¿ï¼<br>
âï¸ å¨æ¬å°éè¿åä»£æ¥å¥ <strong>Claude Code CLI</strong> ç­å®¢æ·ç«¯ï¼<br>
âï¸ æåç¨³å®æ§ãå¯è§åç®¡çä½éªãé¿åæå¨åæ¢è¯¯æä½ã</p>
<p>æ è®ºä½ æ¯ AI å¼åèãç ç©¶èï¼è¿æ¯éè¦å¨ç»ç«¯é«æä½¿ç¨ Claude å·¥å·çç¨æ·ï¼é½å¯ä»¥ä» Antigravity-Manager ä¸­åçã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 10:08">2026-02-09 10:08</span>&nbsp;
<a href="https://www.cnblogs.com/bugshare">BugShare</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19593797);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19593797', targetLink: 'https://www.cnblogs.com/bugshare/p/19593797', title: 'Antigravity-Managerï¼AI å¤è´¦å·ç®¡å®¶ + API åä»£' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ spring6-ä»£çæ¨¡å¼åAOP ]]></title>
    <link>https://www.cnblogs.com/alineverstop/p/19593787</link>
    <guid>5d4a36cc4f1b61a256f7b615ed5c0583</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/alineverstop/p/19593787" title="åå¸äº 2026-02-09 10:07">
    <span role="heading" aria-level="2">spring6-ä»£çæ¨¡å¼åAOP</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="jdbctemplate">jdbcTemplate</h1>
<p>jdbcTemplateæ¯springæä¾çä¸ä¸ªjdbcæ¨¡æ¿ç±»ï¼æ¯å¯¹jdbcçå°è£ã</p>
<p>å½ç¶ä½ ä¹å¯ä»¥ä½¿ç¨å¶ä»æ¡æ¶èå¥MyBatisãHibernateã</p>
<h1 id="gofä¹ä»£çæ¨¡å¼">GoFä¹ä»£çæ¨¡å¼</h1>
<h2 id="ä»£çæ¨¡å¼çä½ç¨">ä»£çæ¨¡å¼çä½ç¨</h2>
<ol>
<li>å½ä¸ä¸ªå¯¹è±¡éè¦åå°ä¿æ¤çæ¶åï¼å¯ä»¥ä½¿ç¨ä»£çå¯¹è±¡å»å®ææä¸ªè¡ä¸ºã</li>
<li>éè¦ç»æä¸ªå¯¹è±¡è¿è¡åè½å¢å¼ºçæ¶åï¼å¯ä»¥æ¾ä¸ä¸ªä»£çè¿è¡å¢å¼ºã</li>
<li>Aå¯¹è±¡åBå¯¹è±¡æ æ³ç´æ¥äº¤äºæ¶ï¼ä¹å¯ä»¥ä½¿ç¨ä»£çæ¨¡å¼æ¥å®æã</li>
</ol>
<p>ä»£çæ¨¡å¼ä¸­çä¸ä¸ªè§è²ï¼</p>
<ol>
<li>ç®æ å¯¹è±¡</li>
<li>ä»£çå¯¹è±¡</li>
<li>ç®æ å¯¹è±¡åä»£çå¯¹è±¡çå¬å±æ¥å£</li>
</ol>
<p>å¦æä½¿ç¨ä»£çæ¨¡å¼çè¯ï¼å®¢æ·ç«¯ç¨åºæ¯æ æ³å¯è§çï¼å®¢æ·ç«¯å¨ä½¿ç¨ä»£çå¯¹è±¡çæ¶åå°±åå¨ä½¿ç¨ç®æ å¯¹è±¡ã</p>
<p>ä»£çæ¨¡å¼åä¸ºéæä»£çåå¨æä»£çã</p>
<h2 id="éæä»£ç">éæä»£ç</h2>
<p>ç®æ å¯¹è±¡ç±»ï¼</p>
<pre><code class="language-java">// ç®æ å¯¹è±¡
public class OrderServiceImpl implements OrderService{
    @Override
    public void generateOrder() {
        System.out.println("çæè®¢å");
    }

    @Override
    public void modifyOrder() {
        System.out.println("ä¿®æ¹è®¢å");
    }

    @Override
    public void detailOrder() {
        System.out.println("æ¥çè®¢åè¯¦æ");

    }
}
</code></pre>
<p>ä»£çå¯¹è±¡ç±»ï¼</p>
<pre><code class="language-java">// ä»£çå¯¹è±¡
public class OrderServiceProxy implements OrderService{
    // ä»£çå¯¹è±¡ä¸­å«æç®æ å¯¹è±¡çå¼ç¨
    // è¿éä½¿ç¨OrderServiceç±»åï¼å ä¸ºä»è¦ååº¦ä½
    private OrderService orderService;

    // æé æ¹æ³ä¼ å¥ç®æ å¯¹è±¡
    public OrderServiceProxy(OrderService orderService) {
        this.orderService = orderService;
    }

    @Override
    public void generateOrder() {
        // åè½å¢å¼ºï¼ç»è®¡æ¹æ³æ§è¡æ¶é´
        long begin = System.currentTimeMillis();
        orderService.generateOrder();
        long end = System.currentTimeMillis();
        System.out.println("çæè®¢åèæ¶ï¼" + (end - begin) + "ms");
    }

    @Override
    public void modifyOrder() {
        long begin = System.currentTimeMillis();
        orderService.modifyOrder();
        long end = System.currentTimeMillis();
        System.out.println("ä¿®æ¹è®¢åèæ¶ï¼" + (end - begin) + "ms");
    }

    @Override
    public void detailOrder() {
        long begin = System.currentTimeMillis();
        orderService.detailOrder();
        long end = System.currentTimeMillis();
        System.out.println("æ¥çè®¢åè¯¦æèæ¶ï¼" + (end - begin) + "ms");
    }
}
</code></pre>
<p>å¬å±æ¥å£ï¼</p>
<pre><code class="language-java">// è®¢åæå¡æ¥å£
// ç®æ å¯¹è±¡åä»£çå¯¹è±¡çå¬å±æ¥å£
public interface OrderService {

    // çæè®¢å
    void generateOrder();

    // ä¿®æ¹è®¢å
    void modifyOrder();

    // æ¥çè®¢åè¯¦æ
    void detailOrder();
}
</code></pre>
<p>æµè¯ï¼</p>
<pre><code class="language-java">// å®ç°ç®æ å¯¹è±¡æ¹æ³æ§è¡æ¶é´çç»è®¡
public static void main(String[] args) {
    // åå»ºç®æ å¯¹è±¡
    OrderService orderService = new OrderServiceImpl();
    // åå»ºä»£çå¯¹è±¡ï¼åæ¶å°ç®æ å¯¹è±¡ä¼ å¥ä»£çå¯¹è±¡ä¸­
    OrderServiceProxy orderServiceProxy = new OrderServiceProxy(orderService);
    // éè¿ä»£çå¯¹è±¡è°ç¨ç®æ å¯¹è±¡çæ¹æ³
    orderServiceProxy.generateOrder();
    orderServiceProxy.modifyOrder();
    orderServiceProxy.detailOrder();
}
</code></pre>
<p>éæä»£çä¼ç¹ï¼1.è§£å³äºocpé®é¢  2.éç¨ä»£çæ¨¡å¼çhas aãéä½äºè¦ååº¦ã</p>
<p>éæä»£ççç¼ºç¹ï¼åè®¾ç³»ç»ä¸­æä¸åä¸ªæ¥å£ï¼æ¯ä¸ªæ¥å£é½éè¦åä»£çç±»ï¼è¿æ ·ç±»çæ°éä¼æ¥å§è¨èï¼ä¸å¥½ç»´æ¤ã</p>
<p>é£æä¹è§£å³ç±»çç¸çé®é¢å¢ï¼</p>
<p>éç¨å¨æä»£çã  å¨æä»£çè¿æ¯ä»£çæ¨¡å¼ï¼åªä¸è¿æ¯å¨åå­ä¸­ä¸ºæä»¬å¨æççæä¸ä¸ªclasså­èç ï¼è¿ä¸ªå­èç å°±æ¯ä»£çç±»ã</p>
<h2 id="å¨æä»£ç">å¨æä»£ç</h2>
<p>å¨ç¨åºè¿è¡é¶æ®µï¼å¨åå­ä¸­å¨æçæä»£çç±»ï¼æä¸ºå¨æä»£çãç®çæ¯åå°ä»£çç±»çæ°éã</p>
<p>å¸¸è§çå¨æä»£çææ¯æï¼JDKå¨æä»£çï¼åªè½ä»£çæ¥å£ï¼ãCGLIBå¨æä»£çãJavassistå¨æä»£çã</p>
<h3 id="jdkå¨æä»£ç">JDKå¨æä»£ç</h3>
<p>å¬å±æ¥å£ åç®æ å¯¹è±¡ç±»å¼ç¨ ä¸é¢çä»£ç ãJdkå¨æä»£çä¸éè¦åä»£çç±»ï¼jdkä¼å¨åå­ä¸­èªå¨çæä»£çç±»ï¼å æ­¤ç´æ¥å¨å®¢æ·ç«¯ä»£ç éç´æ¥è°ç¨ï¼</p>
<p>å®¢æ·ç«¯ä»£ç ï¼</p>
<pre><code class="language-java">public class Client {
    public void main() {
        // 1. åå»ºç®æ å¯¹è±¡
        OrderService orderService = new OrderServiceImpl();
        // 2. åå»ºInvocationHandlerå¯¹è±¡

        // 3. åå»ºä»£çå¯¹è±¡
        //    1. Proxy.newProxyInstance çä½ç¨æ¯åå»ºä»£çå¯¹è±¡ãå¶å®åäºä¸¤ä»¶äº:
        //     1). å¨åå­ä¸­å¨æçæå»ºä¸ä¸ªç±»,
        //     2). è¿ä¸ªç±»è¦å®ç°æ¥å£, è¿ä¸ªæ¥å£å°±æ¯ç®æ å¯¹è±¡çæ¥å£,å¹¶ä¸newäºä¸ä¸ªå¯¹è±¡
        //  2. è¿ä¸ªæ¹æ³çä¸ä¸ªåæ°:
        //    1). ClassLoader: ç±»å è½½å¨, ç¨äºå è½½åå­ä¸­çä»£çå¯¹è±¡ç±». åç®æ å¯¹è±¡ä½¿ç¨ç¸åçç±»å è½½å¨
        //   2). Class[]: å­èç æ°ç», ä»£çå¯¹è±¡åç®æ å¯¹è±¡å®ç°ç¸åçæ¥å£. ç¨äºè®©ä»£çå¯¹è±¡åç®æ å¯¹è±¡å·æç¸åçæ¹æ³
        //  3). InvocationHandler: è°ç¨å¤çå¨å¯¹è±¡,ä»æ¯ä¸ä¸ªæ¥å£ï¼ è¿ä¸ªè°ç¨å¤çå¨ç¨äºç¼åå¢å¼ºä»£ç 
        OrderService o = (OrderService)Proxy.newProxyInstance(OrderService.class.getClassLoader(), 			                                                 orderService.getClass().getInterfaces(), 
                            new TimerInvocationHandler(orderService));
        // 4. éè¿ä»£çå¯¹è±¡è°ç¨æ¹æ³
        // è°ç¨ä»£çå¯¹è±¡çä»£çæ¹æ³æ¶ï¼å¦æä»£çæ¹æ³çä½ç¨æ¯åè½å¢å¼ºï¼é£ç®æ å¯¹è±¡çç®æ æ¹æ³å¿é¡»æ§è¡ã
        o.generateOrder();
    }
}
</code></pre>
<p>è°ç¨å¤çå¨ç±»ï¼</p>
<pre><code class="language-java">/**
 * è´è´£è®¡æ¶çä¸ä¸ªè°ç¨å¤çå¨ç±»
 * å¨è¿ä¸ªè°ç¨å¤çå¨ä¸­ç¼åå¢å¼ºä»£ç 
 * è¿ä¸ªè°ç¨å¤çå¨åªéè¦ä¸ä¸ªå°±å¥½
 */
public class TimerInvocationHandler implements InvocationHandler {

    // ç®æ å¯¹è±¡,å°±æ¯è¦è¢«å¢å¼ºçå¯¹è±¡
    private Object target;
	// æé æ¹æ³ä¼ å¥ç®æ å¯¹è±¡
    public TimerInvocationHandler(Object target) {
            this.target = target;
    }

    // è¿ä¸ªæ¹æ³å¿é¡»æ¯invoke()æ¹æ³,å ä¸ºjdkå¨åºå±ä¼è°ç¨è¿ä¸ªæ¹æ³
    // è¿ä¸ªæ¹æ³ä»ä¹æ¶åè°ç¨?
    //    ä»ä¹æ¶åéè¿ä»£çå¯¹è±¡è°ç¨æ¹æ³çæ¶åå°±ä¼è°ç¨è¿ä¸ªinvoke()æ¹æ³
    // è¿ä¸ªæ¹æ³çåæ°:
    //    proxy: ä»£çå¯¹è±¡,å°±æ¯éè¿Proxy.newProxyInstance()æ¹æ³åå»ºçä»£çå¯¹è±¡
    //    method: ç®æ å¯¹è±¡çç®æ æ¹æ³,è¿å°±æ¯è¦æ§è¡çç®æ æ¹æ³
    //    args: ç®æ æ¹æ³ä¸çåæ°
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        // åè½å¢å¼ºï¼
        Long begin = System.currentTimeMillis();
        Object invoke = method.invoke(target, args);
        Long end = System.currentTimeMillis();
        System.out.println("æ¹æ³æ§è¡èæ¶ï¼" + (end - begin) + "ms");
        return invoke;
    }
}
</code></pre>
<h3 id="cglibå¨æä»£ç">CGLIBå¨æä»£ç</h3>
<p>æ¢å¯ä»¥ä»£çæ¥å£ï¼ä¹å¯ä»¥ä»£çç±»ãåºå±éç¨ç»§æ¿çæ¹å¼å®ç°ï¼å æ­¤<strong>è¢«ä»£ççç®æ ç±»ä¸è½è¢«finalä¿®é¥°</strong>ã</p>
<p>ç®æ ç±»ï¼</p>
<pre><code class="language-java">// ç®æ ç±»
public class UserService {
    public boolean login(String username, String password) {
        System.out.println("ç¨æ·ç»å½ï¼ç¨æ·åï¼" + username + "ï¼å¯ç ï¼" + password);
        return "admin".equals(username) &amp;&amp; "123456".equals(password);
    }

    public void logout(String username) {
        System.out.println("ç¨æ·éåºç»å½ï¼ç¨æ·åï¼" + username);
    }
}
</code></pre>
<p>å®¢æ·ç«¯ä»£ç ï¼</p>
<pre><code class="language-java">public static void main(String[] args) {
    // åå»ºå­èç å¢å¼ºå¯¹è±¡
    // è¿ä¸ªå¯¹è±¡æ¯cglibçæ ¸å¿å¯¹è±¡ï¼ä¾é å®æ¥çæä»£çç±»
    Enhancer enhancer = new Enhancer();
    // è®¾ç½®ç¶ç±»ï¼ä¹å°±æ¯ç®æ ç±»
    enhancer.setSuperclass(UserService.class);
    // è®¾ç½®åè°å½æ°ï¼ç­åäºjdkå¨æä»£ççä¸­çè°ç¨å¤çå¨ï¼
    // å¨cglibä¸­æ¯å®ç°æ¹æ³æ¦æªå¨MethodInterceptoræ¥å£
    enhancer.setCallback(new TimerMethodInterceptor());

    UserService userServiceProxy = (UserService)enhancer.create();
    boolean login = userServiceProxy.login("admin", "123456");
    System.out.println(login?"ç»å½æå":"ç»å½å¤±è´¥");
    userServiceProxy.logout("admin");
}
</code></pre>
<p>å¢å¼ºä»£ç åå¨æ¹æ³æ¦æªå¨éé¢</p>
<pre><code class="language-java">public class TimerMethodInterceptor implements MethodInterceptor {

    @Override
    public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {
        Long startTime = System.currentTimeMillis();
        Object o1 = methodProxy.invokeSuper(o, objects);
        Long endTime = System.currentTimeMillis();
        System.out.println("æ¹æ³ " + method.getName() + " æ§è¡èæ¶ï¼" + (endTime - startTime) + "ms");
        return o1;
    }
}
</code></pre>
<p>æ³¨æ:å¨jdk17ç¯å¢ä¸ï¼cglibå¨æä»£çåè½å¯å¨æ¶ä¼æ¥éï¼éè¦æ·»å å¯å¨æ¶åæ°è®¾ç½®:</p>
<p>vm åæ°ï¼--add-opens java.base/java.lang=ALL-UNNAMED</p>
<p>program åæ°:--add-opens java.base/sun.net.util=ALL-UNNAMED</p>
<p><img alt="3-1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3388489/202602/3388489-20260209100631406-1917032911.png" class="lazyload"></p>
<h1 id="é¢ååé¢ç¼ç¨aop">é¢ååé¢ç¼ç¨AOP</h1>
<p>å¨ä¸ä¸ªç³»ç»ä¸­ä¸è¬ä¼æè®¸å¤ç³»ç»æå¡ï¼å¦ï¼æ¥å¿ï¼äºå¡ç®¡çãå®å¨ç­ãè¿äºæå¡æä¸ºäº¤åä¸å¡ã</p>
<p>è¿äºäº¤åä¸å¡æ¯éç¨çã</p>
<p>å¦æå¨æ¯ä¸ä¸ªä¸å¡å¤çè¿ç¨ä¸­ï¼é½æºæè¿äºäº¤åä¸å¡ä»£ç ä¼åºç°2ä¸ªé®é¢ï¼</p>
<ol>
<li>äº¤åä¸å¡ä»£ç å¨å¤ä¸ªä¸å¡ä¸­åå¤åºç°ãä»£ç æ²¡æå¾å°å¤ç¨ï¼ä¿®æ¹è¿äºä»£ç ä¼éå¸¸å°é¾ã</li>
<li>å¼åäººåæ æ³ä¸ä¸æ ¸å¿ä¸å¡ä»£ç ï¼å¨ç¼åæ ¸å¿ä¸å¡ä»£ç æ¶è¿è¦å¤çè¿äºäº¤åä¸å¡ä»£ç ã</li>
</ol>
<p>è¿å°±éè¦ä½¿ç¨AOPæ¥è§£å³ä»¥ä¸é®é¢ã</p>
<p><img alt="3-2" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3388489/202602/3388489-20260209100621253-1133728956.png" class="lazyload"></p>
<p><strong>æ»ä¹ï¼AOPå°±æ¯å°ä¸æ ¸å¿ä¸å¡æ å³çä»£ç ç¬ç«çæ½ååºæ¥ãå½¢æä¸ä¸ªç¬ç«çç»ä»¶ï¼ç¶åä»¥æ¨ªåäº¤åçæ¹å¼åºç¨å°ä¸å¡æµç¨å½ä¸­çè¿ç¨ã</strong></p>
<p>aopåºå±ä½¿ç¨å¨æä»£çææ¯å®ç°ã</p>
<p>spring AOP ä½¿ç¨çæ¶jdkå¨æä»£ç+cglibå¨æä»£çãspring å¨è¿2ç§å¨æä»£çç§çµæ´»åæ¢ãå¦ææ¯ä»£çæ¥å£ï¼åä½¿ç¨jdkå¨æä»£çï¼å¦æä»£çæä¸ªç±»ï¼åä½¿ç¨cglibãå½ç¶ä¹å¯ä»¥æå¨éç½®æ¥å¼ºå¶ä½¿ç¨cglibã</p>
<h2 id="aopçä¸å¤§æ¯è¯­">AOPçä¸å¤§æ¯è¯­</h2>
<h3 id="è¿æ¥ç¹joinpoint">è¿æ¥ç¹Joinpoint</h3>
<p>å¨ç¨åºæ§è¡æµç¨ä¸­ï¼å¯ä»¥ç»å¥åé¢çä½ç½®ãæ¹æ³çæ§è¡ååï¼å¼å¸¸æåºä¹åç­ä½ç½®ã</p>
<p>è¿æ¥ç¹æè¿°çæ¯ä½ç½®ã</p>
<h3 id="åç¹pointcut">åç¹Pointcut</h3>
<p>å¨ç¨åºæ§è¡æµç¨ä¸­ï¼çæ­£ç»å¥åé¢çæ¹æ³ãï¼ä¸ä¸ªåç¹å¯¹åºå¤ä¸ªè¿æ¥ç¹ï¼</p>
<p>åç¹æè¿°çæ¯æ¹æ³ã</p>
<h3 id="éç¥advice">éç¥Advice</h3>
<p>éç¥åå«å¢å¼ºï¼å°±æ¯å·ä½ä½ è¦ç»å¥çç<strong>ä»£ç </strong>ã</p>
<p>éç¥åæ¬ï¼åç½®éç¥ãåç½®éç¥ãç¯ç»éç¥ãå¼å¸¸éç¥ãæç»éç¥ã</p>
<p>éç¥æè¿°çæ¯ä»£ç ã</p>
<h3 id="åé¢aspect">åé¢Aspect</h3>
<p>åç¹+éç¥å°±æ¯åé¢ã</p>
<h3 id="ç»å¥weaving">ç»å¥Weaving</h3>
<p>æéç¥åºç¨å°ç®æ å¯¹è±¡ä¸çè¿ç¨ã</p>
<h3 id="ä»£çå¯¹è±¡proxy">ä»£çå¯¹è±¡Proxy</h3>
<p>ä¸ä¸ªç®æ å¯¹è±¡è¢«ç»å¥éç¥åäº§ççæ°å¯¹è±¡ã</p>
<h3 id="ç®æ å¯¹è±¡target">ç®æ å¯¹è±¡Target</h3>
<p>è¢«ç»å¥éç¥çå¯¹è±¡ã</p>
<pre><code class="language-java">public void main(String[] args) {
    try {
        // Joint point  è¿æ¥ç¹
        do1(); // Pointcut åç¹
        // Joint point  è¿æ¥ç¹
        do2();// Pointcut åç¹
        // Joint point  è¿æ¥ç¹
        do3();// Pointcut åç¹
        // Joint point  è¿æ¥ç¹
        do4();// Pointcut åç¹
        // Joint point  è¿æ¥ç¹
        do5();// Pointcut åç¹
        // Joint point  è¿æ¥ç¹
    } catch (Exception e) {
        // Joint point  è¿æ¥ç¹
    }
}
</code></pre>
<h2 id="åç¹è¡¨è¾¾å¼">åç¹è¡¨è¾¾å¼</h2>
<p>åç¹è¡¨è¾¾å¼ç¨æ¥å®ä¹éç¥ï¼Adviceï¼å¾åªäºæ¹æ³ä¸åå¥</p>
<h2 id="ä½¿ç¨springçaop">ä½¿ç¨SpringçAOP</h2>
<p>Springå¯¹AOPçå®ç°åæ¬ä¸ç§æ¹å¼ï¼</p>
<ol>
<li>Springç»åAspectJæ¡æ¶å®ç°çAOPï¼åºäºæ³¨è§£æ¹å¼</li>
<li>Springç»åAspectJæ¡æ¶å®ç°çAOPï¼åºäºXMLæ¹å¼</li>
<li>springèªå·±å®ç°çAOPï¼åºäºxmléç½®æ¹å¼</li>
</ol>
<p>å¸¸ç¨çæ¯å2ç§æ¹å¼ã</p>
<h3 id="åå¤å·¥ä½">åå¤å·¥ä½</h3>
<p>â	å¼å¥ä¾èµ</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;version&gt;6.0.4&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;
    &lt;version&gt;6.0.4&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>å¼å¥å½åç©ºé´ï¼contextåaopï¼åéç½®xmlæä»¶</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd" &gt;

&lt;!--    ç»ä»¶æ«æ--&gt;
    &lt;context:component-scan base-package="com.ali.service" /&gt;
&lt;!--    å¼å¯aspectjèªå¨ä»£çï¼springå®¹å¨å¨æ«æç±»çæ¶åï¼ä¼æ¥çç±»ä¸æ¯å¦æ@Aspectæ³¨è§£
        å¦ææãå°±ç»è¿ä¸ªç±»çæä»£çå¯¹è±¡ ã
        proxy-target-class="true" è¡¨ç¤ºå¼ºå¶ä½¿ç¨cglibå¨æä»£ç
        proxy-target-class="false" é»è®¤å¼ï¼è¡¨ç¤ºæ¥å£ä½¿ç¨jdkå¨æä»£çï¼åä¹ä½¿ç¨cglibå¨æä»£ç--&gt;
    &lt;aop:aspectj-autoproxy proxy-target-class="true"/&gt;
&lt;/beans&gt;
</code></pre>
<p>ç¼åç®æ ç±»</p>
<pre><code class="language-java">// ç®æ ç±»
@Service
public class UserService {
    // ç®æ æ¹æ³
    public void login() {
        System.out.println("UserService login....");
    }
}
</code></pre>
<p>ç¼ååé¢ç±»</p>
<pre><code class="language-java">// åé¢ç±»,éè¦@Aspect æ æ³¨
@Aspect
@Component("logAspect")
public class LogAspect {

    // åé¢ = éç¥+åç¹
    // éç¥å°±æ¯å¢å¼ºï¼å°±æ¯å·ä½è¦ç¼åçå¢å¼ºä»£ç 
    // è¿ééç¥ä»¥æ¹æ³çå½¢å¼åºç°ã
    // @Before æ æ³¨çæ¹æ³å°±æ¯ä¸ä¸ªåç½®éç¥
    @Before("execution(* com.ali.service.UserService.*(..))")
    public void advice( ) {
        System.out.println("è¿æ¯ä¸ä¸ªåç½®éç¥ï¼æ¹æ³æ§è¡åæ§è¡....");
    }
    
    // ç¯ç»éç¥æ¯æå¤§çéç¥ï¼å¨åç½®éç¥ä¹åï¼å¨åç½®éç¥ä¹å
    @Around("execution(* com.ali.service.UserService.*(..))")
    public void around(ProceedingJoinPoint joinPoint) throws Throwable {
        System.out.println("around start");
        // æ§è¡ç®æ æ¹æ³
        joinPoint.proceed();
        System.out.println("around end");
    }
}
</code></pre>
<p>æµè¯ä»£ç ï¼</p>
<pre><code class="language-java">@Test
public void test() {
    ApplicationContext context = new ClassPathXmlApplicationContext("spring.xml");
    UserService userService = context.getBean("userService", UserService.class);
    userService.login();
}
</code></pre>
<p>æ³¨æï¼å½æå¤ä¸ªåé¢ç±»æ¶ï¼å¯ä»¥ä½¿ç¨@Orderï¼ï¼æ³¨è§£è¿è¡ä¼åçº§æåºï¼æ°å­è¶å°ï¼ä¼åçº§è¶é«ï¼å°±åæ§è¡ãæ¯å¦ï¼@Order(2) æ¯@Orderï¼3ï¼ åæ§è¡ã</p>
<p>å¨æ¯ä¸ªæ¹æ³ä¸é½åä¸éåç¹è¡¨è¾¾å¼å¾éº»ç¦ï¼å¯ä»¥å®ä¹ä¸ä¸ªéç¨çåç¹è¡¨è¾¾å¼ï¼ç¶åå¨æ¹æ³ä¸ä½¿ç¨è¿ä¸ªéç¨çè¡¨è¾¾å¼å³å¯ã</p>
<pre><code class="language-java">// å®ä¹éç¨çåç¹è¡¨è¾¾å¼ï¼åç»­éç¥ç´æ¥ä½¿ç¨æ¹æ³åæ¥å¼ç¨åç¹è¡¨è¾¾å¼
// åç¹å°±æ¯ä¸ä¸ªè¡¨è¾¾å¼ï¼å®ä¹äºå¨åªäºè¿æ¥ç¹ä¸æ§è¡éç¥
@Pointcut("execution(* com.ali.service.UserService.*(..))")
public void commmonPointcut() {
    // è¿ä¸ªæ¹æ³åªæ¯ä¸ä¸ªæ è¯ï¼æ¹æ³ä½ä¸éè¦ç¼åä»»ä½ä»£ç 
}

@AfterReturning("commmonPointcut()")
public void afterAdvice( ) {
    System.out.println("è¿æ¯ä¸ä¸ªåç½®éç¥ï¼æ¹æ³æ§è¡åæ§è¡....");
}
</code></pre>
<h3 id="joinpointçä½¿ç¨">JoinPointçä½¿ç¨</h3>
<p>éç¥æ¹æ³å¯ä»¥å å¥åæ°JoinPointï¼è¿ä¸ªæ¯springå®¹å¨èªå¨ä¼ å¥çã</p>
<pre><code class="language-java">@Before("execution(* com.ali.service.UserService.*(..))")
public void advice(JoinPoint joinPoint) {
    System.out.println("è¿æ¯ä¸ä¸ªåç½®éç¥ï¼æ¹æ³æ§è¡åæ§è¡....");
    // ä½¿ç¨JoinPointå¯¹è±¡è·åè¿æ¥ç¹çä¿¡æ¯
    // joinPoint.getSignature() è·åè¿æ¥ç¹çæ¹æ³ç­¾å
    // éè¿æ¹æ³ç­¾åå¯ä»¥è·åå°è¿ä¸ªæ¹æ³çå·ä½ä¿¡æ¯
    // è·åæ¹æ³å
    String methodName = joinPoint.getSignature().getName();
    System.out.println("æ­£å¨æ§è¡çæ¹æ³æ¯ï¼" + methodName);
}
</code></pre>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/alineverstop/" target="_blank">NE_STOP</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/alineverstop/p/19593787" target="_blank">https://www.cnblogs.com/alineverstop/p/19593787</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 10:07">2026-02-09 10:07</span>&nbsp;
<a href="https://www.cnblogs.com/alineverstop">NE_STOP</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19593787);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19593787', targetLink: 'https://www.cnblogs.com/alineverstop/p/19593787', title: 'spring6-ä»£çæ¨¡å¼åAOP' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>