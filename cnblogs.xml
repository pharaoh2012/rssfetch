<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-22T12:38:55.701Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ TAOCP 1.2.1é¨åä¹ é¢ ]]></title>
    <link>https://www.cnblogs.com/SilverGo/p/19518861</link>
    <guid>cc2381d3ad456c46ed3c43032197cf70</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/SilverGo/p/19518861" title="åå¸äº 2026-01-22 19:40">
    <span role="heading" aria-level="2">TAOCP 1.2.1é¨åä¹ é¢</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="taocp-121é¨åä¹ é¢">TAOCP 1.2.1é¨åä¹ é¢</h1>
<h2 id="t9">T9</h2>
<p><strong>é¢ç®æ è®°</strong>ï¼[25]</p>
<p><strong>é¢ç®</strong>ï¼<br>
è¯æ±ä¸é¢å¼å­çæ±åè¡¨è¾¾å¼ï¼å¹¶äºä»¥è¯æï¼</p>
<p></p><div class="math display">\[1^2 , 2^2 -1^2 , 3^2 -2^2 +1^2 , 4^2 -3^2 +2^2 -1^2
\]</div><p></p><p><strong>ä»¥ä¸æ¯åæ</strong>ï¼<br>
æå¨è®¡ç®å ä¸ªï¼åç°å°±æ¯ç­å·®æ°åæ±åã<br>
äºæ¯æä»¬çæ³ï¼åné¡¹åä¸º <span class="math inline">\(\frac{n(n+1)}{2}\)</span> ã</p>
<p><strong>æ¥ä¸æ¥æ¯è¯æ</strong>ï¼</p>
<p>æä»¬ä½¿ç¨æ°å­¦å½çº³æ³è¯æã</p>
<p>å½ <span class="math inline">\(n=1\)</span> æ¶ï¼å·¦è¾¹ä¸º <span class="math inline">\(1^2=1\)</span>ï¼å³è¾¹ä¸º <span class="math inline">\(\frac{1(1+1)}{2}=1\)</span>ï¼æç«ã</p>
<p>åè®¾å½ <span class="math inline">\(n=k\)</span> æ¶ï¼ç­å¼æç«ï¼å³å½çº³åè®¾IHk:</p>
<p></p><div class="math display">\[k^2 - (k-1)^2 + (k-2)^2 - \cdots - (-1)^{k}= \frac{k(k+1)}{2}
\]</div><p></p><p>æç«ã</p>
<p>ç°å¨èè <span class="math inline">\(n=k+1\)</span> çæåµãè®°å <span class="math inline">\(n\)</span> é¡¹åä¸º <span class="math inline">\(F_n\)</span>ï¼åæ</p>
<p></p><div class="math display">\[F_k = \frac{k(k+1)}{2}
\]</div><p></p><p>æä»¬å°è¯è¡¨ç¤º <span class="math inline">\(F_{k+1}-F_k\)</span>ï¼æ³¨æå° <span class="math inline">\(F_{k+1}\)</span> ä¸ <span class="math inline">\(F_k\)</span> é¤é¦é¡¹å¤ï¼æ¯é¡¹ç¬¦å·ç¸åï¼å æ­¤ï¼å½æä»¬è®¡ç® <span class="math inline">\(F_{k+1}-F_k\)</span> æ¶ï¼åªæé¦é¡¹ <span class="math inline">\((k+1)^2\)</span> ä¼è¢«ä¿çï¼å¶ä½é¡¹åç¿»åã</p>
<p>å æ­¤ï¼</p>
<p></p><div class="math display">\[F_{k+1} -F_k = - 2F_k + (k+1)^2 \\
= - 2 \cdot \frac{k(k+1)}{2} + (k+1)^2 \\
= - k(k+1) + (k+1)^2 \\
= (k+1)(-k + k + 1) \\
= k+1
\]</div><p></p><p>å æ­¤ï¼</p>
<p></p><div class="math display">\[F_{k+1} = F_k + (k+1) \\
= \frac{k(k+1)}{2} + (k+1) \\
= \frac{k(k+1) + 2(k+1)}{2} \\
= \frac{(k+1)(k+2)}{2}
\]</div><p></p><p>è¯æ¯ã</p>
<h2 id="t10">T10</h2>
<p><strong>é¢ç®æ è®°</strong>ï¼[30]</p>
<p><strong>é¢ç®</strong>ï¼<br>
è¯æ±ä¸é¢å¼å­çæ±åè¡¨è¾¾å¼ï¼å¹¶äºä»¥è¯æï¼</p>
<p></p><div class="math display">\[\frac{1^3}{1^4+4} +\frac{3^3}{3^4+4}+ \cdots + \frac{(-1)^{n}(2n-1)^3}{(2n-1)^4+4}
\]</div><p></p><p><strong>ä»¥ä¸æ¯åæ</strong>ï¼<br>
æå¨è®¡ç®ï¼æä»¬æ³¨æå°ï¼åæ¯ä¹é´æ¯æ¬¡å·®4çåæ°ï¼äºæ¯æä»¬å¤§èçæ³ï¼æ¯å¦æåæ¯æ¯ç±»ä¼¼ <span class="math inline">\(1+4 \times 2+4 \times 3+ \cdots +4 \times n\)</span> çå½¢å¼ã</p>
<p>æ¾ç¶æ¯æçï¼è¿ä¸æ­¥å¤§çº¦è±è´¹äºæ5minçæ¶é´ã</p>
<p>éåæä»¬èèåå­ï¼èç¼å°±è½è§å¯å°ï¼åå­å°±æ¯ <span class="math inline">\(n\)</span> ã</p>
<p>ç»¼ä¸ï¼æä»¬æï¼</p>
<p></p><div class="math display">\[\frac{1^3}{1^4+4} +\frac{3^3}{3^4+4}+ \cdots + \frac{(-1)^{n}(2n-1)^3}{(2n-1)^4+4} \\
= \frac{(-1)^{n+1} \cdot n}{1+4n^2}
\]</div><p></p><p><strong>æ¥ä¸æ¥æ¯è¯æ</strong>ï¼</p>
<p>æä»¬ä½¿ç¨æ°å­¦å½çº³æ³è¯æã</p>
<p>å½ <span class="math inline">\(n=1\)</span> æ¶ï¼å·¦è¾¹ä¸º <span class="math inline">\(\frac{1^3}{1^3+4}=\frac{1}{5}\)</span>ï¼å³è¾¹ä¸º <span class="math inline">\(\frac{(-1)^{1+1} \cdot 1}{1+4 \cdot 1^2}=\frac{1}{5}\)</span>ï¼æç«ã</p>
<p>åè®¾å½ <span class="math inline">\(n=k\)</span> æ¶ï¼ç­å¼æç«ï¼å³</p>
<p></p><div class="math display">\[\frac{1^3}{1^4+4} +\frac{3^3}{3^4+4}+ \cdots + \frac{(-1)^{k}(2k-1)^3}{(2k-1)^4+4} \\
= \frac{(-1)^{k+1} \cdot k}{1+4k^2}
\]</div><p></p><p>ç°å¨èè <span class="math inline">\(n=k+1\)</span> çæåµãæä»¬è®°å <span class="math inline">\(n\)</span> é¡¹åä¸º <span class="math inline">\(F_n\)</span>ï¼åæ</p>
<p></p><div class="math display">\[F_k = \frac{(-1)^{k+1} \cdot k}{1+4k^2}
\]</div><p></p><p>åå·¦è¾¹ä¸º</p>
<p></p><div class="math display">\[\frac{1^3}{1^4+4} +\frac{3^3}{3^4+4}+ \cdots + \frac{(-1)^{k}(2k-1)^3}{(2k-1)^4+4} + \frac{(-1)^{k+1}(2(k+1)-1)^3}{(2(k+1)-1)^4+4} \\
= F_k + \frac{(-1)^{k+1}(2(k+1)-1)^3}{(2(k+1)-1)^4+4} \\
\]</div><p></p><p></p><div class="math display">\[= \frac{(-1)^{k+1} \cdot k}{1+4k^2} + \frac{(-1)^{k+1}(2k+1)^3}{(2k+1)^4+4} \\
\]</div><p></p><p></p><div class="math display">\[= \frac{(-1)^{k+1} \cdot k((2k+1)^4+4) + (-1)^{k+1}(2k+1)^3(1+4k^2)}{(1+4k^2)((2k+1)^4+4)} \\
\]</div><p></p><p></p><div class="math display">\[= \frac{(-1)^{k+1}((2k+1)^3(1+4k^2) + k((2k+1)^4+4))}{(1+4k^2)((2k+1)^4+4)} \\
\]</div><p></p><p></p><div class="math display">\[= \frac{(-1)^{k+1}((2k+1)^3 + 8k^2(2k+1)^3 + k(16k^4 + 32k^3 + 24k^2 + 8k + 5))}{(1+4k^2)((2k+1)^4+4)} \\
\]</div><p></p><p></p><div class="math display">\[= \frac{(-1)^{k+1}(16k^5 + 32k^4 + 24k^3 + 8k^2 + (2k+1)^3 + 8k^2(2k+1)^3)}{(1+4k^2)((2k+1)^4+4)} \\
\]</div><p></p><p></p><div class="math display">\[= \frac{(-1)^{k+1}(16k^5 + 32k^4 + 24k^3 + 8k^2 + 8k^3 + 12k^2 + 6k + 1 + 64k^5 + 96k^4 + 48k^3 + 8k^2)}{(1+4k^2)((2k+1)^4+4)} \\
\]</div><p></p><p></p><div class="math display">\[= \frac{(-1)^{k+1}(80k^5 + 128k^4 + 80k^3 + 28k^2 + 6k + 1)}{(1+4k^2)((2k+1)^4+4)} \\
\]</div><p></p><p></p><div class="math display">\[= \frac{(-1)^{k+1}((2k+2)(16k^4 + 48k^3 + 40k^2 + 12k + 1))}{(1+4k^2)((2k+1)^4+4)} \\
\]</div><p></p><p></p><div class="math display">\[= \frac{(-1)^{k+2} \cdot (k+1)}{1+4(k+1)^2}
\]</div><p></p><p>è¯æ¯ã</p>
<h2 id="t16t15å å¼ºçæ¬">T16ï¼ï¼T15å å¼ºçæ¬ï¼</h2>
<p><strong>é¢ç®</strong>ï¼<br>
æ±</p>
<p></p><div class="math display">\[\sum_{j=0}^{n}{jx^j}
\]</div><p></p><p><strong>è§£</strong>ï¼</p>
<p></p><div class="math display">\[\sum_{j=0}^{n}{jx^j} \\
= \sum_{0\leq i\leq n}{ix^i} \\
= x\sum_{1\leq i\leq n}{ix^{i-1}} \\
= x\sum_{0\leq i\leq n-1}{(i+1)x^i} \\
= x\sum_{0\leq i\leq n-1}{ix^i} + x\sum_{0\leq i\leq n-1}{x^i} \\
= x\sum_{0\leq i\leq n}{ix^i} -nx^{n+1} + x\sum_{0\leq i\leq n-1}{x^i}
\]</div><p></p><p>æ³¨æå°ï¼</p>
<p></p><div class="math display">\[x\sum_{0\leq i\leq n-1}{x^i} \\
= x\sum_{0\leq i\leq n}{x^i} -x^{n+1} \\
= x + x\sum_{1\leq i\leq n}{x^i} -x^{n+1} \\
= x + x^{2}\sum_{1\leq i\leq n}{x^{i-1}} -x^{n+1} \\
= x + x^{2}\sum_{0\leq i\leq n-1}{x^{i}} -x^{n+1}
\]</div><p></p><p>ä¸å¦¨ä»¤ï¼</p>
<p></p><div class="math display">\[S = x\sum_{0\leq i\leq n-1}{x^i}
\]</div><p></p><p>æä»¬æï¼</p>
<p></p><div class="math display">\[S = x+ xS -x^{n+1} \\
\]</div><p></p><p></p><div class="math display">\[S-Sx = x-x^{n+1} \\
\]</div><p></p><p></p><div class="math display">\[S = \frac{x-x^{n+1}}{1-x}
\]</div><p></p><p>æä»¥ï¼</p>
<p></p><div class="math display">\[\sum_{j=0}^{n}{jx^j} \\
= x\sum_{0\leq i\leq n}{ix^i} -nx^{n+1} + x\sum_{0\leq i\leq n-1}{x^i} \\
= x\sum_{0\leq i\leq n}{ix^i} -nx^{n+1} + \frac{x-x^{n+1}}{1-x}
\]</div><p></p><p>åä»¤ï¼</p>
<p></p><div class="math display">\[F = \sum_{1\leq i\leq n}{ix^i}
\]</div><p></p><p>æä»¬æï¼</p>
<p></p><div class="math display">\[F = x\sum_{0\leq i\leq n}{ix^i} -nx^{n+1} + \frac{x-x^{n+1}}{1-x} \\
\]</div><p></p><p></p><div class="math display">\[F-xF = -nx^{n+1} + \frac{x-x^{n+1}}{1-x} \\
\]</div><p></p><p></p><div class="math display">\[F = \frac{nx^{n+2}-(n+1)x^{n+1}+x}{(x-1)^2}
\]</div><p></p><p>ç»æã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.004861111111111111" data-date-updated="2026-01-22 19:47">2026-01-22 19:40</span>&nbsp;
<a href="https://www.cnblogs.com/SilverGo">Ghost-Face</a>&nbsp;
éè¯»(<span id="post_view_count">2</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19518861);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19518861', targetLink: 'https://www.cnblogs.com/SilverGo/p/19518861', title: 'TAOCP 1.2.1é¨åä¹ é¢' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ AIå¼å-python-langchainæ¡æ¶ï¼1-4å¨æå°æ ·æ¬æç¤ºï¼ ]]></title>
    <link>https://www.cnblogs.com/yclh/p/19518845</link>
    <guid>2a4e1d8cadf02304eaf0c4618c790d81</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yclh/p/19518845" title="åå¸äº 2026-01-22 19:31">
    <span role="heading" aria-level="2">AIå¼å-python-langchainæ¡æ¶ï¼1-4å¨æå°æ ·æ¬æç¤ºï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p class="qwen-markdown-paragraph" data-spm-anchor-id="a2ty_o01.29997173.0.i91.70db5171ppHPis"><span class="qwen-markdown-text">è¿ä¸ªä»£ç çæ ¸å¿åè½æ¯ï¼<strong class="qwen-markdown-strong"><span class="qwen-markdown-text">åºäºè¾å¥è¯çé¿åº¦å¨æéæ©åä¹è¯ç¤ºä¾ï¼å¹¶è°ç¨å¤§æ¨¡åçæåä¹è¯</span></strong><span class="qwen-markdown-text">ï¼ä½ç°äº <strong class="qwen-markdown-strong"><span class="qwen-markdown-text" data-spm-anchor-id="a2ty_o01.29997173.0.i90.70db5171ppHPis">âå¨æå°æ ·æ¬æç¤ºï¼Dynamic Few-Shot Promptingï¼â</span></strong><span class="qwen-markdown-text"> ä¸ <strong class="qwen-markdown-strong"><span class="qwen-markdown-text">âä¸ä¸æé¿åº¦æç¥çç¤ºä¾éæ©â</span></strong><span class="qwen-markdown-text"> çè½åã</span></span></span></span></p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">from langchain.prompts import FewShotPromptTemplate, PromptTemplate
from langchain.prompts.example_selector import LengthBasedExampleSelector
from langchain_core.output_parsers import StrOutputParser
from langchain_openai import ChatOpenAI
import os
from dotenv import load_dotenv


# å®ä¹åä¹è¯ä»»å¡çç¤ºä¾æ°æ®éï¼few-shot examplesï¼
# æ¯ä¸ªç¤ºä¾åå«ä¸ä¸ªè¾å¥è¯ï¼inputï¼åå¯¹åºçåä¹è¯ï¼outputï¼
examples = [
    {"input": "å¼å¿", "output": "ä¼¤å¿"},
    {"input": "é«", "output": "ç®"},
    {"input": "ç²¾ååæ²", "output": "æ²¡ç²¾æé"},
    {"input": "ç²", "output": "ç»"},
]

# å®ä¹åä¸ªç¤ºä¾çæ ¼å¼æ¨¡æ¿
# ä½¿ç¨ {input} å {output} ä½ä¸ºå ä½ç¬¦ï¼ç¨äºåç»­å¡«åå·ä½å¼
example_prompt = PromptTemplate(
    input_variables=["input", "output"],  # å£°ææ¨¡æ¿ä¸­ä½¿ç¨çåéå
    template="Input: {input}\nOutput: {output}",  # ç¤ºä¾çææ¬æ ¼å¼
)

# åå»ºä¸ä¸ªåºäºé¿åº¦çç¤ºä¾éæ©å¨ï¼LengthBasedExampleSelectorï¼
# ä½ç¨ï¼æ ¹æ®è¾å¥æç¤ºçæ»é¿åº¦å¨æéæ©æåéçç¤ºä¾æ°éï¼é¿åè¶åºæ¨¡åä¸ä¸æéå¶
example_selector = LengthBasedExampleSelector(
    examples=examples,  # æä¾ææåéç¤ºä¾
    example_prompt=example_prompt,  # ç¨äºæ ¼å¼åæ¯ä¸ªç¤ºä¾çæ¨¡æ¿
    max_length=25,  # è®¾å®æ´ä¸ª promptï¼å«åç¼ãç¤ºä¾ãåç¼ï¼çæå¤§ token é¿åº¦ï¼æ­¤å¤ä¸ºå­ç¬¦æ°è¿ä¼¼ï¼
    # æ³¨æï¼LengthBasedExampleSelector é»è®¤ä½¿ç¨ len(text) è®¡ç®é¿åº¦ï¼éç²¾ç¡® token æ°ï¼ï¼éç¨äºç®ååºæ¯
)

# æå»ºå¨æå°æ ·æ¬æç¤ºæ¨¡æ¿ï¼FewShotPromptTemplateï¼
# å®ä¼æ ¹æ®è¾å¥åå®¹çé¿åº¦ï¼èªå¨ä» examples ä¸­éæ©åéæ°éçç¤ºä¾æå¥å° prompt ä¸­
dynamic_prompt = FewShotPromptTemplate(
    example_selector=example_selector,  # ä½¿ç¨ä¸é¢å®ä¹çå¨æéæ©å¨ï¼èéåºå®ç¤ºä¾åè¡¨ï¼
    example_prompt=example_prompt,      # åä¸ªç¤ºä¾çæ ¼å¼
    prefix="ç»åºæ¯ä¸ªè¾å¥çåä¹è¯",       # æç¤ºçå¼å¤´é¨åï¼ä»»å¡æä»¤ï¼
    suffix="Input: {adjective}\nOutput:",  # æç¤ºçç»å°¾é¨åï¼åå«å¾é¢æµçè¾å¥å ä½ç¬¦
    input_variables=["adjective"],      # å£°ææç»ç¨æ·è¾å¥çåéåï¼ä¸ suffix ä¸­ç {adjective} å¯¹åºï¼
)

# === æµè¯ 1ï¼è¾å¥è¾ç­ï¼åºéæ©å¤ä¸ªç¤ºä¾ ===
print("ãæµè¯1ãè¾å¥è¾ç­ï¼éæ©å¤ä¸ªç¤ºä¾ï¼")
print(dynamic_prompt.format(adjective="big"))

print('------------')

# === æµè¯ 2ï¼è¾å¥å¾é¿ï¼åºåªéæ©å°éæä¸ä¸ªç¤ºä¾ä»¥æ§å¶æ»é¿åº¦ ===
long_string = "big and huge and massive and large and gigantic and tall and much much much much much bigger than everything else"
print("ãæµè¯2ãè¾å¥å¾é¿ï¼ä»éæ©ä¸ä¸ªç¤ºä¾ï¼")
print(dynamic_prompt.format(adjective=long_string))

print('------------')

# === æµè¯ 3ï¼å¨ææ·»å æ°ç¤ºä¾ ===
# åç¤ºä¾éæ©å¨ä¸­æ°å¢ä¸ä¸ªç¤ºä¾ï¼"è" -&gt; "ç¦"ï¼
new_example = {"input": "è", "output": "ç¦"}
dynamic_prompt.example_selector.add_example(new_example)
print("ãæµè¯3ãæ·»å æ°ç¤ºä¾åï¼æ¥è¯¢'ç­æ'ï¼")
print(dynamic_prompt.format(adjective="ç­æ"))

print('------------')

# === éç½®å¹¶è°ç¨ DeepSeek å¤§è¯­è¨æ¨¡å ===

llm = ChatOpenAI(
    api_key=os.getenv("DEEPSEEK_API_KEY"),
    base_url=os.getenv("DEEP_URL"),  # Deepseek ç API åºç¡å°å
    model="deepseek-v3:671b",  # Deepseek å¯¹è¯æ¨¡åï¼å¯éï¼deepseek-chat-pro ç­é«çº§æ¨¡åï¼
    temperature=0.7,  # æ¸©åº¦åæ°ï¼0-1ï¼è¶ä½è¶ç¨³å®ï¼
    max_tokens=1024  # æå¤§çæ tokens
)

# åå»ºå­ç¬¦ä¸²è¾åºè§£æå¨ï¼ç¨äºå°æ¨¡åè¿åç AIMessage è½¬æ¢ä¸ºçº¯ææ¬
output_parser = StrOutputParser()

# æå»ºå¤çé¾ï¼Chainï¼ï¼prompt â LLM â output parser
# ä½¿ç¨ LangChain çç®¡éæä½ç¬¦ `|` è¿æ¥åç»ä»¶
chain = dynamic_prompt | llm | output_parser

# è°ç¨é¾ï¼ä¼ å¥è¾å¥åé {"adjective": "ç­æ"}
# æ³¨æï¼chain.invoke() åé¨å·²åå« llm è°ç¨å output_parser è§£æï¼æ éåæå¨è°ç¨ output_parser
message = chain.invoke({"adjective": "ç­æ"})

# â ï¸ æ³¨æï¼ä¸ä¸è¡ `chain.invoke()` å·²ç»è¿åäºå­ç¬¦ä¸²ï¼å ä¸ºæåæ¯ StrOutputParserï¼
# æä»¥ä¸é¢è¿è¡æ¯å¤ä½çï¼çè³ä¼å¯¼è´éè¯¯ï¼å ä¸º message å·²æ¯ strï¼ä¸è½åæ¬¡ invokeï¼
# result = output_parser.invoke(message)  # â éè¯¯ï¼message æ¯ strï¼ä¸æ¯ AIMessage

# æ­£ç¡®åæ³ï¼ç´æ¥ä½¿ç¨ message ä½ä¸ºç»æ
result = message

print('###############')
print("ãæ¨¡åè¾åºã")
print(result)
</pre>
</div>
<h1 style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">è¾åºç»æï¼</h1>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">ãæµè¯1ãè¾å¥è¾ç­ï¼éæ©å¤ä¸ªç¤ºä¾ï¼
ç»åºæ¯ä¸ªè¾å¥çåä¹è¯

Input: å¼å¿
Output: ä¼¤å¿

Input: é«
Output: ç®

Input: ç²¾ååæ²
Output: æ²¡ç²¾æé

Input: ç²
Output: ç»

Input: big
Output:
------------
ãæµè¯2ãè¾å¥å¾é¿ï¼ä»éæ©ä¸ä¸ªç¤ºä¾ï¼
ç»åºæ¯ä¸ªè¾å¥çåä¹è¯

Input: å¼å¿
Output: ä¼¤å¿

Input: big and huge and massive and large and gigantic and tall and much much much much much bigger than everything else
Output:
------------
ãæµè¯3ãæ·»å æ°ç¤ºä¾åï¼æ¥è¯¢'ç­æ'ï¼
ç»åºæ¯ä¸ªè¾å¥çåä¹è¯

Input: å¼å¿
Output: ä¼¤å¿

Input: é«
Output: ç®

Input: ç²¾ååæ²
Output: æ²¡ç²¾æé

Input: ç²
Output: ç»

Input: è
Output: ç¦

Input: ç­æ
Output:
------------
###############
ãæ¨¡åè¾åºã
å·æ·¡
</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</h1>
<h1 style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">æ ¸å¿è¦ç¹æ»ç»</h1>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">è¿æ®µä»£ç æ¯åºäº LangChain æ¡æ¶å¯¹æ¥ DeepSeek å¤§æ¨¡åï¼å®ç°ãå¨æå°æ ·æ¬ï¼Few-Shotï¼åä¹è¯çæãçå®æ´æ¡ä¾ï¼æ ¸å¿è§£å³ãåºå®ç¤ºä¾æè¶åºæ¨¡åä¸ä¸æé¿åº¦ãçé®é¢ï¼éè¿å¨æç¤ºä¾éæ©å¨ééä¸åé¿åº¦è¾å¥ï¼åæ¶ç»å LangChain é¾å¼è°ç¨ç®åæ¨¡åè°ç¨æµç¨ï¼åæç¡®æ´ä½å®ä½ï¼åæè§£æ ¸å¿éç¹ï¼</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
<h2 style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">ä¸ãæ´ä½æµç¨æ¦è§ï¼æ ¸å¿é»è¾é¾ï¼</h2>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">ä»£ç éµå¾ª LangChain ãç¤ºä¾åå¤ â å¨ææç¤ºæå»º â æ¨¡åè°ç¨ â ç»æè§£æãçå°æ ·æ¬å­¦ä¹ ç»å¸æµç¨ï¼æ´ä½å¯æ¦æ¬ä¸ºï¼</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: flex; flex: 0 1 auto; flex-direction: column; padding: 0; margin: 8px 0 0; background: none">
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none" dir="ltr">
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">
<pre><code style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px Consolas, Monaco, Andale Mono, Ubuntu Mono, monospace; text-align: start; white-space: pre; display: inline; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">1. å®ä¹åä¹è¯ä»»å¡çåºå®ç¤ºä¾æ°æ®éï¼ä¸ºæ¨¡åæä¾åèæ¡ä¾
2. éç½®åºäºé¿åº¦çç¤ºä¾éæ©å¨ï¼æ ¹æ®è¾å¥ææ¬é¿åº¦å¨æç­éç¤ºä¾æ°é
3. æå»ºå¨æå°æ ·æ¬æç¤ºæ¨¡æ¿ï¼èªå¨ééè¾å¥é¿åº¦çæåè§ Prompt
4. åå§å DeepSeek æ¨¡åå®¢æ·ç«¯ï¼éç½®æ ¸å¿è°ç¨åæ°
5. æå»ºãæç¤ºæ¨¡æ¿ â å¤§æ¨¡å â è¾åºè§£æãçé¾å¼è°ç¨æµç¨
6. è°ç¨é¾æ¡å®æåä¹è¯çæï¼å¹¶è¾åºçº¯ææ¬ç»æ
</code></pre>
</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
</div>
</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
<h2 style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">äºãæ ¸å¿éç¹æè§£ï¼å¿ææ¡ï¼</h2>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
<h3 style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">1. å°æ ·æ¬æç¤ºï¼Few-Shot Promptï¼æ ¸å¿ç»ä»¶</h3>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">è¿æ¯å®ç°ãæ¨¡ååèç¤ºä¾çæç»æãçåºç¡ï¼ä¹æ¯ LangChain æç¤ºå·¥ç¨çæ ¸å¿ç¨æ³ï¼</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp; &nbsp;<code style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px Consolas, Monaco, Andale Mono, Ubuntu Mono, monospace; text-align: start; white-space: pre; display: inline; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">- ç¤ºä¾æ°æ®éï¼examplesï¼ï¼ä»¥é®å¼å¯¹å½¢å¼å­å¨ãè¾å¥-è¾åºãç¤ºä¾ï¼ä¸ºæ¨¡åæä¾ä»»å¡åèï¼å¦"å¼å¿"â"ä¼¤å¿"ï¼ï¼</code></div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none"><code style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px Consolas, Monaco, Andale Mono, Ubuntu Mono, monospace; text-align: start; white-space: pre; display: inline; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none"> - åç¤ºä¾æ¨¡æ¿ï¼example_promptï¼ï¼å®ä¹åä¸ªç¤ºä¾çææ¬æ ¼å¼ï¼Input/Output åºå®æ ·å¼ï¼ï¼ç»ä¸ç¤ºä¾å±ç¤ºå½¢å¼ï¼</code></div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: flex; flex: 0 1 auto; flex-direction: column; padding: 0; margin: 8px 0 0; background: none">
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none" dir="ltr">
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">
<pre><code style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px Consolas, Monaco, Andale Mono, Ubuntu Mono, monospace; text-align: start; white-space: pre; display: inline; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">- å¨æå°æ ·æ¬æ¨¡æ¿ï¼FewShotPromptTemplateï¼ï¼æ´åç¤ºä¾éæ©å¨ãåç¤ºä¾æ¨¡æ¿ãåç¼/åç¼ï¼çææç»åç»æ¨¡åçå®æ´ Promptï¼
  - prefixï¼ä»»å¡æä»¤ï¼"ç»åºæ¯ä¸ªè¾å¥çåä¹è¯"ï¼ï¼æç¡®æ¨¡åè¦æ§è¡çä»»å¡ï¼
  - suffixï¼å¾å¡«åçç¨æ·è¾å¥å ä½ç¬¦ï¼æ¿æ¥å¨æè¾å¥åå®¹ã
</code></pre>
</div>
</div>
</div>
<h3 style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">2. å¨æç¤ºä¾éæ©å¨ï¼LengthBasedExampleSelectorï¼</h3>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">è¿æ¯ä»£ç çæ ¸å¿äº®ç¹ï¼è§£å³ãåºå®ç¤ºä¾æ°éæè¶ä¸ä¸æé¿åº¦ãçé®é¢ï¼</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: flex; flex: 0 1 auto; flex-direction: column; padding: 0; margin: 8px 0 0; background: none">
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none" dir="ltr">
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">
<pre><code style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px Consolas, Monaco, Andale Mono, Ubuntu Mono, monospace; text-align: start; white-space: pre; display: inline; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">æ ¸å¿ä½ç¨ï¼æ ¹æ®è¾å¥ææ¬çé¿åº¦ï¼èªå¨è®¡ç®å¹¶éæ©åéæ°éçç¤ºä¾ï¼è¾å¥è¶é¿ï¼éçç¤ºä¾è¶å°ï¼ï¼é¿å Prompt æ»é¿åº¦è¶åºæ¨¡åä¸ä¸æéå¶ï¼
å³é®åæ°ï¼
  - examplesï¼åéç¤ºä¾åè¡¨ï¼
  - example_promptï¼ç¤ºä¾æ ¼å¼åæ¨¡æ¿ï¼ç¨äºè®¡ç®åç¤ºä¾é¿åº¦ï¼ï¼
  - max_lengthï¼Prompt åè®¸çæå¤§é¿åº¦ï¼æ­¤å¤ä¸ºå­ç¬¦æ°è¿ä¼¼å¼ï¼ã
</code></pre>
</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
</div>
</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
<h3 style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">3. LangChain é¾å¼è°ç¨ï¼| æä½ç¬¦ï¼</h3>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">ç®åå¤ç»ä»¶åä½æµç¨ï¼æ¯ LangChain æ ¸å¿è®¾è®¡çå¿µï¼</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: flex; flex: 0 1 auto; flex-direction: column; padding: 0; margin: 8px 0 0; background: none">
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none" dir="ltr">
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">
<pre><code style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px Consolas, Monaco, Andale Mono, Ubuntu Mono, monospace; text-align: start; white-space: pre; display: inline; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">- é¾æ¡ææï¼dynamic_promptï¼çæ Promptï¼ | llmï¼è°ç¨æ¨¡åï¼ | output_parserï¼è§£æç»æï¼ï¼
- æ ¸å¿ä¼å¿ï¼æ éæå¨åæ­¥è°ç¨ï¼åæ ¼å¼å Promptãåè°ç¨æ¨¡åãæåè§£æç»æï¼ï¼ä¸è¡ä»£ç å®æå¨æµç¨ï¼
- è°ç¨æ¹å¼ï¼chain.invoke({"adjective": "ç­æ"}) ä¼ å¥è¾å¥åéï¼ç´æ¥è¿åè§£æåççº¯ææ¬ç»æã
</code></pre>
</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
</div>
</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
<h3 style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">4. è¾åºè§£æå¨ï¼StrOutputParserï¼</h3>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">&nbsp;</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">è§£å³ãæ¨¡åè¿å AIMessage å¯¹è±¡âæåçº¯ææ¬ãçé®é¢ï¼</div>
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: flex; flex: 0 1 auto; flex-direction: column; padding: 0; margin: 8px 0 0; background: none">
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none" dir="ltr">
<div style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;; text-align: start; white-space: normal; display: block; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">
<pre><code style="color: rgba(0, 0, 0, 1); font: 400 16px / 24px Consolas, Monaco, Andale Mono, Ubuntu Mono, monospace; text-align: start; white-space: pre; display: inline; flex: 0 1 auto; flex-direction: row; padding: 0; margin: 0; background: none">æ ¸å¿ä½ç¨ï¼å° LangChain æ¨¡åè¿åç AIMessage ç±»åï¼å« content/metadata ç­å­æ®µï¼è½¬æ¢ä¸ºçº¯å­ç¬¦ä¸²ï¼ç®åç»æä½¿ç¨ï¼
å³é®æ³¨æç¹ï¼é¾å¼è°ç¨ä¸­å·²åå«è§£ææ­¥éª¤ï¼æ éæå¨åæ¬¡è°ç¨ output_parser.invoke()ï¼å¦åä¼æ¥éï¼ã</code></pre>
</div>
</div>
</div>
<p>&nbsp;</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0006944444444444445" data-date-updated="2026-01-22 19:32">2026-01-22 19:31</span>&nbsp;
<a href="https://www.cnblogs.com/yclh">ä¸ç¬ä½</a>&nbsp;
éè¯»(<span id="post_view_count">7</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19518845);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19518845', targetLink: 'https://www.cnblogs.com/yclh/p/19518845', title: 'AIå¼å-python-langchainæ¡æ¶ï¼1-4å¨æå°æ ·æ¬æç¤ºï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ SEALå¨åæå å¯BFVæ¹æ¡å¥é¨è¯¦è§£ ]]></title>
    <link>https://www.cnblogs.com/zhaoweiwei/p/19510487/bfv</link>
    <guid>5df73e2cabdcf50c9deafcd0340c8dcb</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/zhaoweiwei/p/19510487/bfv" title="åå¸äº 2026-01-22 15:50">
    <span role="heading" aria-level="2">SEALå¨åæå å¯BFVæ¹æ¡å¥é¨è¯¦è§£</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æä»ç»å¾®è½¯çå¼æºå¨åæé¡¹ç®SEALä¸­BFVæ¹æ¡çç¸å³æ°å­¦çè®ºåºç¡ï¼ä»¥åç¸åºå è§£å¯çä¸»è¦æµç¨ï¼æåç®åå°ä»ç»äºSEALæºç çç¼è¯è¿ç¨åç®ååºç¨ç¤ºä¾ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>Microsoft SEALï¼Simple Encrypted Arithmetic Libraryï¼æ¯å¾®è½¯å¼æºçè½»éçº§ãé«æ§è½å¨åæå å¯ï¼FHEï¼åºï¼ä¸ä¸ºæ´æ°/æµ®ç¹æ°çå¯æè¿ç®è®¾è®¡ï¼æ¯æBFVãCKKSãBGVç­ä¸»æµFHEæ¹æ¡ï¼å¹¿æ³åºç¨äºéç§è®¡ç®ãèé¦å­¦ä¹ ãæ°æ®å å¯ç­åºæ¯ï¼æºç ï¼<a href="https://github.com/microsoft/SEAL" target="_blank" rel="noopener nofollow">https://github.com/microsoft/SEAL</a>ã</p>
<h1>1 æ°å­¦åºç¡</h1>
<h2>1.1 å¤é¡¹å¼ç¯</h2>
<p>SEALä½¿ç¨çåºç¡ç¯æ¯ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260121153443048-88951557.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p align="left">BFVçææè¿ç®é½å¨è¿ä¸ªå¤é¡¹å¼ç¯ä¸­è¿è¡ï¼ç¬¦å·å«ä¹å¦ä¸ï¼</p>
<p align="left">Z<sub>q</sub>ï¼ç³»æ°åï¼å³å¤é¡¹å¼çææç³»æ°é½åèªâæ¨¡qçæ´æ°éåâï¼qç§°ä¸ºç³»æ°æ¨¡æ°ï¼ä¸ä¸ªå¤§ç´ æ°æå¤ä¸ªç´ æ°çä¹ç§¯ï¼ï¼å³å®å¯æçåªå£°å®¹å¿åº¦åè¿ç®æ·±åº¦ã</p>
<p align="left">x<sup>N</sup>+1ï¼å¤é¡¹å¼æ¨¡ï¼è¦æ±Næ¯2çæ´æ°å¹ï¼å¦4096ã8192ï¼ï¼æ»¡è¶³x<sup>N</sup>â¡-1 (mod x<sup>N</sup>+1)ï¼è¿æå³çææå¤é¡¹å¼çæ¬¡æ°é½ä¸ä¼è¶è¿N-1ï¼è¶è¿çé¡¹å¯éè¿x<sup>N</sup> = -1éæ¬¡ï¼ã</p>
<p align="left">R<sub>q</sub>åç´ å½¢å¼ï¼ä»»æåç´ æ¯ä¸ä¸ªæ¬¡æ°â¤ N - 1çå¤é¡¹å¼ï¼å½¢å¦ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260121154506434-1453063209.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>&nbsp;</p>
<h2>1.2 ææç©ºé´</h2>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260121155707555-629451098.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ææï¼å¾å å¯çæ´æ°ï¼ä¼è¢«ç¼ç ä¸ºR<sub>t</sub>ä¸­çå¤é¡¹å¼ï¼tæ»¡è¶³tâ¡1 (mod 2N)ï¼è¿æ¯æ¹éå å¯çç¡¬æ§è¦æ±ï¼ææå¨è¿è¡å å¯åè¦è¿è¡ç¼ç ï¼æä¸¤ç§ç¼ç æ¹å¼ï¼</p>
<p><strong>åæ´æ°ç¼ç </strong>ï¼å°åä¸ªæ´æ°mç¼ç ä¸ºå¸¸æ°å¤é¡¹å¼f(x)=mï¼å³ææé«æ¬¡é¡¹ç³»æ°ä¸º0ã</p>
<p><strong>æ¹éç¼ç </strong>ï¼å°Nä¸ªå°æ´æ°[m<sub>0</sub>,m<sub>1</sub>,...,m<sub>N-1</sub>]ç´æ¥åä¸ºå¤é¡¹å¼çç³»æ°ï¼ç¼ç ä¸ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260121160312132-985918846.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<h2>1.3 RLWEé®é¢</h2>
<p align="left">BFVçå®å¨æ§åºäºRLWEé®é¢ï¼Ring Learning With Errorsï¼çè®¡ç®å°é¾æ§ï¼ç®åæè¿°ä¸ºï¼</p>
<p align="left">ç»å®å¤é¡¹å¼R<sub>q</sub>ï¼éæ©ä¸ä¸ªç§å¯å¤é¡¹å¼s(x)âR<sub>q</sub>ï¼ç³»æ°ä¸º0/1çç­å¤é¡¹å¼ï¼ï¼ä»¥åå¤§éçâåªå£°å¤é¡¹å¼å¯¹âï¼a<sub>i</sub>(x), b<sub>i</sub>(x)ï¼ï¼å¶ä¸­a<sub>i</sub>(x)æ¯éæºçæçï¼b<sub>i</sub>(x)=-a<sub>i</sub>(x)s(x)+e<sub>i</sub>(x) (mod q)æ¯éè¿ç§å¯å¤é¡¹å¼s(x)è®¡ç®å¾å°çâååºå¤é¡¹å¼âï¼å å¥åªå£°e<sub>i</sub>(x)æ¯ä¸ºäºè®©b<sub>i</sub>(x)çèµ·æ¥åä¸ä¸ªå®å¨éæºçå¤é¡¹å¼ï¼ä»èéès(x)çå­å¨ï¼èå¨è®¡ç®ä¸æ æ³ä»è¿äºå¤é¡¹å¼å¯¹ä¸­æ¢å¤åºç§å¯å¤é¡¹å¼s(x)ãå¯¹äºb<sub>i</sub>(x)å¶çææ¶æ¯ä¸é¨åçä½ç¨å¦ä¸ï¼</p>
<p align="left">a<sub>i</sub>(x)ï¼ä»å¤é¡¹å¼ç¯R<sub>q</sub>ä¸­ååéæºçæçå¤é¡¹å¼ï¼ç¸å½äºâå¬å±è¾å¥âï¼å¯ä»¥å¬å¼ã</p>
<p align="left">s(x)ï¼ç§å¯å¤é¡¹å¼ï¼ç³»æ°ä»ä¸º0æ1ï¼ï¼æ¯æ´ä¸ªRLWEé®é¢çæ ¸å¿ï¼å¿é¡»ä¸¥æ ¼ä¿å¯ã</p>
<p align="left">e<sub>i</sub>(x)ï¼å°ç³»æ°åªå£°å¤é¡¹å¼ï¼ç³»æ°ä»ä¸º-1ã0ã1ï¼ï¼æ¯âéèç§å¯âçå³é®ã</p>
<p align="left">b<sub>i</sub>(x)ï¼ç±a<sub>i</sub>(x)s(x)å ä¸åªå£°å¾å°çç»æï¼ä¸ai(x)ä¸èµ·ææå¬å¼çâå¤é¡¹å¼å¯¹âã</p>
<p align="left">å¦ææ²¡æåªå£°e<sub>i</sub>(x)ï¼å³e<sub>i</sub>(x)=0ï¼é£ä¹b<sub>i</sub>(x)=-a<sub>i</sub>(x)s(x) (mod q)ï¼æ­¤æ¶æ»å»èå¯ä»¥éè¿å¤ç»(a<sub>i</sub>(x), b<sub>i</sub>(x))æå»ºçº¿æ§æ¹ç¨ç»ï¼ç´æ¥è§£å¯åºç§å¯å¤é¡¹å¼s(x)ï¼è¿å°±å®å¨å¤±å»äºå®å¨æ§ãèå å¥å°åªå£°e<sub>i</sub>(x)åï¼</p>
<p align="left">b<sub>i</sub>(x)ä¸åæ¯a<sub>i</sub>(x)s(x)çç²¾ç¡®ç»æï¼èæ¯ä¸ä¸ªâè¿ä¼¼å¼âï¼</p>
<p align="left">è¿ä¸ªè¿ä¼¼å¼çè¯¯å·®è¢«æ§å¶å¨å¾å°çèå´åï¼ç±e<sub>i</sub>(x)çç³»æ°å¤§å°å³å®ï¼ï¼</p>
<p align="left">ä»è®¡ç®è§åº¦ï¼ç®åæ²¡æä»»ä½ç®æ³ï¼åæ¬éå­ç®æ³ï¼è½é«æå°ä»è¿äºå¸¦åªå£°çè¿ä¼¼ç»æä¸­æ¢å¤åºs(x)ï¼è¿æ­£æ¯RLWEé®é¢çâè®¡ç®å°é¾æ§âæ¥æºï¼ä¹æ¯BFVéååéå­ç§å¯åºæ¯çåå ã</p>
<h2>1.4 ç¼©æ¾å å­</h2>
<p>å¨BFVåæå å¯æ¹æ¡ä¸­ï¼ç¼©æ¾å å­ï¼Scaling Factorï¼æ¯è¿æ¥ææç©ºé´ï¼Z<sub>t</sub>ï¼åå¯æç©ºé´ï¼Z<sub>q</sub>ï¼çæ ¸å¿ç³»æ°ï¼æ¬è´¨æ¯ä¸ºäºè®©ææå¤é¡¹å¼è½âééâç³»æ°æ¨¡æ°qçèå´ï¼åæ¶ä¿è¯è§£å¯æ¶å¯ä»¥ç²¾ç¡®è¿åææãBFVçæææ¨¡æ°tè¿å°äºç³»æ°æ¨¡æ°qï¼t&lt;&lt;q)ï¼æ¯å¦t=65537ï¼q=2<sup>60</sup>éçº§ã</p>
<p>ææå¤é¡¹å¼m(x)âR<sub>t</sub>çç³»æ°èå´æ¯[0, t-1]ï¼èå¯æå¤é¡¹å¼c(x)âR<sub>q</sub>çç³»æ°èå´æ¯[0, q-1]ï¼å¦æç´æ¥å°ææm(x)æ¾å¥å¯æå¬å¼ï¼ç±äºtå¤ªå°ï¼ææä¿¡æ¯ä¼è¢«åªå£°åæ©ç å®å¨æ·¹æ²¡ï¼æ æ³è§£å¯ãå æ­¤éè¦ä¸ä¸ªç¼©æ¾å å­ï¼å°ææç³»æ°æ¾å¤§å°qçéçº§ï¼ååä¸å¯æè®¡ç®ãç¼©æ¾å å­è´¯ç©¿å å¯åè§£å¯ä¸¤ä¸ªæ ¸å¿æ­¥éª¤ï¼æ¯ææåå¯æçâæ¡¥æ¢âã</p>
<p>ï¼1ï¼å å¯æ¶ï¼æææ¾å¤§</p>
<p>å¨å å¯æ­¥éª¤ä¸­ï¼ææå¤é¡¹å¼m(x)ä¸ä¼ç´æ¥ä»£å¥å¯æå¬å¼ï¼èæ¯åä¹äºç¼©æ¾å å­Îï¼åæ¾å¥å°å¬å¼ï¼</p>
<p>&nbsp;</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122103147623-1899019256.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ä½ç¨ï¼å°ææç³»æ°ä»[0, t-1]æ¾å¤§å°[0,&nbsp;Î*(t-1)]ï¼è¿ä¸ªèå´å¨qçéçº§åï¼è½é¿åææè¢«åªå£°è¦çã</p>
<p>ï¼2ï¼è§£å¯æ¶ï¼ææç¼©å°</p>
<p>è§£å¯çæ ¸å¿æ­¥éª¤æ¯åè®¡ç®èåå¤é¡¹å¼D(ct)ï¼ä»£å¥å å¯å¬å¼åå¯å¾ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122103532065-202805649.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>æ­¤æ¶éè¦ååç¼©æ¾æ¥è¿åææï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122103637412-765250880.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>æ¦æ¬æ¥è¯´ï¼ç¼©æ¾å å­ä¸ä¼ç´æ¥åä¸è¿ç®ï¼ä½ä¼é´æ¥å½±ååªå£°çå¢é¿éåº¦ï¼</p>
<p align="left">1) å æ³è¿ç®ï¼å¯æå æ³æ¯ç³»æ°ç´æ¥ç¸å ï¼åªå£°çº¿æ§å å ï¼ç¼©æ¾å å­ä¸å½±ååªå£°å¢é¿ï¼</p>
<p align="left">2) ä¹æ³è¿ç®ï¼å¯æä¹æ³æ¯å¤é¡¹å¼ä¹æ³ï¼åªå£°ä¼å¹³æ¹å¢é¿ï¼èç¼©æ¾å å­Îè¶å¤§ï¼åªå£°çè§æ¨¡ä¹ä¼è¶å¤§ï¼å¯¼è´è¿ç®æ·±åº¦éä½ã</p>
<p align="left">å æ­¤ï¼å¨åæ°éç½®æ¶ï¼éè¦å¨âææèå´ï¼tå¤§å°ï¼âåâè¿ç®æ·±åº¦ï¼qå¤§å°ï¼âä¹é´åæè¡¡ï¼</p>
<p align="left">è¥tå¢å¤§âÎåå°âåªå£°å®¹å¿åº¦æåâè¿ç®æ·±åº¦å¢å ï¼</p>
<p align="left">è¥tåå°âÎå¢å¤§âåªå£°å®¹å¿åº¦éä½âè¿ç®æ·±åº¦åå°ã</p>
<p align="left">æä»¥tä¸Îæåæ¯ï¼éæ ¹æ®ä¸å¡éæ±å¹³è¡¡ææèå´åè¿ç®æ·±åº¦ã</p>
<h1>2 BFVæ ¸å¿æµç¨</h1>
<h2>2.1 åæ°éç½®</h2>
<p>åæ°éç½®å³å®æ¹æ¡çæ§è½ä¸å®å¨æ§ï¼BFVæ ¸å¿åæ°æ4ä¸ªï¼éä¸¥æ ¼æ»¡è¶³æ°å­¦çº¦æï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260121155055832-1091265286.png" alt="image" width="798" height="249" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>åæ°çº¦æï¼éæ»¡è¶³q&gt;t*(2N)<sup>d</sup>*Bï¼dæ¯ç®æ è¿ç®æ·±åº¦ï¼Bæ¯åªå£°ä¸éï¼ï¼å¦åè¿ç®è¿ç¨ä¸­åªå£°ä¼âçç¸âå¯¼è´è§£å¯å¤±è´¥ã</p>
<h2>2.2 å¯é¥çæ</h2>
<p>åºäºRLWEé®é¢çæç§é¥ãå¬é¥ãéçº¿æ§åå¯é¥3ä¸­å¯é¥ï¼æ ¸å¿æ¯æé å«åªå£°çå¤é¡¹å¼å¯¹ã</p>
<p>ï¼1ï¼ç§é¥ï¼skï¼</p>
<p>éæºçæä¸ä¸ªç­å¤é¡¹å¼s(x)âR<sub>q</sub>ï¼ç³»æ°ä»ä¸º0æ1ï¼å¦s(x) = 1 + x<sup>2</sup> + x<sup>5</sup>ï¼ï¼ç§é¥å°±æ¯s(x)ã</p>
<p>ï¼2ï¼å¬é¥ï¼pkï¼</p>
<p>éæºçæå¤é¡¹å¼a(x)âR<sub>q</sub>ï¼çæå°å¸æ°åªå£°å¤é¡¹å¼e(x)âR<sub>q</sub>ï¼è®¡ç®b(x) = -a(x)s(x) + e(x) (mod q)ï¼å¬é¥æ¯å¤é¡¹å¼å¯¹pk = (b(x), a(x))ï¼å¯å¬å¼ä¼ æ­ãè¿éçåªå£°e(x)è®©æ»å»èæ æ³ä»å¬é¥å¯¹ä¸­æ¢å¤ç§é¥s(x)ï¼ç®çæ¯è§£å³âå¬é¥æ¬èº«çå®å¨æ§âã</p>
<p>ï¼3ï¼éçº¿æ§åå¯é¥ï¼rlkï¼</p>
<p>å¯æä¹æ³ä¼å¯¼è´å¯æä»â2é¡¹å¤é¡¹å¼âè¨èä¸ºâ3é¡¹å¤é¡¹å¼âï¼åç»­è¿ç®æçéª¤éãéçº¿æ§åå¯é¥ç¨äºå°è¨èåçå¯æåç¼©å2é¡¹ï¼çæé»è¾ä¸å¬é¥ç±»ä¼¼ï¼æ¬è´¨æ¯ä¸ç»æ©å±çRLWEå¤é¡¹å¼å¯¹ã</p>
<h2>2.3 å å¯</h2>
<p>å°ææå¤é¡¹å¼è½¬ä¸ºå¯æå¤é¡¹å¼ï¼BFVçå¯ææ¯R<sub>q</sub>ä¸­ç2é¡¹å¤é¡¹å¼å¯¹ct = (c<sub>0</sub>(x), c<sub>1</sub>(x))ï¼å å¯è¿ç¨åä¸¤æ­¥ï¼</p>
<p>ï¼1ï¼ææç¼ç ï¼å°æ´æ°ææmç¼ç ä¸ºææå¤é¡¹å¼m(x)âR<sub>t</sub>ï¼</p>
<p>ï¼2ï¼æ·»å åªå£°ä¸æ··æ·ï¼</p>
<p>éæºçæä¸¤ä¸ªå°åªå£°å¤é¡¹å¼e<sub>0</sub>(x),e<sub>1</sub>(x)âR<sub>q</sub>ï¼éæºçæä¸ä¸ªâæ©ç å¤é¡¹å¼âu(x)âR<sub>q</sub>ï¼ç³»æ°ä¸º0/1ï¼ï¼è®¡ç®å¯æï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122101343624-1971179879.png" alt="image" width="506" height="72" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>æ ¸å¿è®¾è®¡ï¼å¯æä¸­åå«ææä¿¡æ¯m(x)ï¼ä½è¢«åªå£°e<sub>0</sub>/e<sub>1</sub>åæ©ç u(x)æ··æ·ï¼åªæç§é¥è½å»é¤æ··æ·ååªå£°ãè¯¥æ­¥éª¤ä¸­çæ©ç å¤é¡¹å¼u(x)ååªå£°å¤é¡¹å¼e<sub>0</sub>(x),e<sub>1</sub>(x)æ¯ä¸¤å¥ç¬ç«çå®å¨æºå¶ï¼å®ä»¬è§£å³çæ¯å®å¨ä¸åçé®é¢ï¼ä¸è½äºç¸æ¿ä»£ï¼å¦ä¸å¾ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122145538684-995418377.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>u(x)éè¿éæºç¼©æ¾å®ç°å¬é¥åææé´çéåºå®çº¿æ§å³ç³»ï¼åªå£°éè¿âè¿ä¼¼âè¿ä¸æ­¥æç ´å®ä»¬ä¹é´ç²¾ç¡®çä»£æ°å³ç³»ï¼ä½¿å¾æ»å»èæ æ³ä»è¿ä¼¼å¼ä¸­è¿åç²¾ç¡®ææã</p>
<h2>2.4 åæè¿ç®</h2>
<p>è¿æ­¥çæ ¸å¿æ¯ï¼å¯æè¿ç®=å¤é¡¹å¼ç¯è¿ç®ï¼BFVæ¯æç§å¯&amp;å¯æï¼Ct&amp;Ctï¼åå¯æ&amp;ææï¼Ct&amp;Ptï¼çå åä¹è¿ç®ï¼ææè¿ç®é½å¨å¤é¡¹å¼ç¯R<sub>q</sub>ä¸­è¿è¡ï¼ä¸æ éå¯é¥ã</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122102234951-828568152.png" alt="image" width="925" height="252" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>è¿ç®åçå¯æä»ç¶æ¯åæ³çRLWEå¯æï¼å¯ç»§ç»­åä¸åç»­è¿ç®ââè¿å°±æ¯ãåææ§ãçä½ç°ã</p>
<h2>2.5 è§£å¯</h2>
<p>è§£å¯æ¯å å¯çéè¿ç®ï¼æ ¸å¿æ¯å»é¤åªå£°ãè¿åææå¤é¡¹å¼ï¼æ­¥éª¤å¦ä¸ï¼</p>
<p>ï¼1ï¼å¯æèå</p>
<p>ç¨ç§é¥s(x)è®¡ç®èåå¤é¡¹å¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122102616840-333286614.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ä»£å¥å å¯å¬å¼å¯æ¨å¯¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122102653366-486423113.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ï¼2ï¼åªå£°å»é¤</p>
<p>ç±äºæ»åªå£°e<sub>total</sub>&lt;q/(2t)ï¼å¯éè¿âèå¥+æ¨¡è¿ç®âè¿åææï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122102808245-1880527419.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto">ï¼3ï¼ææè§£ç </p>
<p>å°è§£å¯åçå¤é¡¹å¼m(x)è½¬æ¢åæ´æ°ï¼åæ´æ°åå¸¸æ°é¡¹ï¼æ¹éå å¯åææç³»æ°ï¼ã</p>
<p>è§£å¯æåæ¡ä»¶ï¼æ»åªå£°e<sub>total</sub>&lt;q/(2t)ï¼è¥è¿ç®æ¬¡æ°è¿å¤å¯¼è´åªå£°çç¸ï¼èå¥åæ æ³è¿åææï¼åä¼è§£å¯å¤±è´¥ââè¿æ¯BFVâå±æ¬¡æ§âçæ¬è´¨ï¼è¿ç®æ·±åº¦æéã</p>
<h2>2.6 pythonç¤ºä¾</h2>
<p>ä»¥ä¸æ¯ä¸ä¸ªå®æ´çpythonç¤ºä¾ç¨åºï¼</p>
<div class="cnblogs_code"><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" id="code_img_closed_09b97ffc-eef3-46ba-bb50-d1e4cf620627" class="code_img_closed"><img src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" id="code_img_opened_09b97ffc-eef3-46ba-bb50-d1e4cf620627" class="code_img_opened" style="display: none">
<div id="cnblogs_code_open_09b97ffc-eef3-46ba-bb50-d1e4cf620627" class="cnblogs_code_hide">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> numpy as np
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> random

</span><span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> PolynomialRing:
    </span><span style="color: rgba(0, 0, 255, 1)">def</span> <span style="color: rgba(128, 0, 128, 1)">__init__</span><span style="color: rgba(0, 0, 0, 1)">(self, n, modulus):
        self.n </span>=<span style="color: rgba(0, 0, 0, 1)"> n
        self.modulus </span>=<span style="color: rgba(0, 0, 0, 1)"> modulus
        self.phi </span>= np.zeros(n + 1, dtype=<span style="color: rgba(0, 0, 0, 1)">int)
        self.phi[0] </span>= 1<span style="color: rgba(0, 0, 0, 1)">
        self.phi[n] </span>= 1

    <span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> poly_add(self, a, b):
        result </span>= np.zeros(self.n, dtype=<span style="color: rgba(0, 0, 0, 1)">int)
        </span><span style="color: rgba(0, 0, 255, 1)">for</span> i <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(self.n):
            result[i] </span>= (a[i] + b[i]) %<span style="color: rgba(0, 0, 0, 1)"> self.modulus
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> result

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> poly_mul(self, a, b):
        result </span>= np.zeros(2 * self.n - 1, dtype=<span style="color: rgba(0, 0, 0, 1)">int)
        </span><span style="color: rgba(0, 0, 255, 1)">for</span> i <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(self.n):
            </span><span style="color: rgba(0, 0, 255, 1)">for</span> j <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(self.n):
                result[i </span>+ j] = (result[i + j] + a[i] * b[j]) %<span style="color: rgba(0, 0, 0, 1)"> self.modulus
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> self.poly_mod(result)

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> poly_mod(self, poly):
        result </span>=<span style="color: rgba(0, 0, 0, 1)"> poly.copy()
        </span><span style="color: rgba(0, 0, 255, 1)">for</span> i <span style="color: rgba(0, 0, 255, 1)">in</span> range(len(result) - 1, self.n - 1, -1<span style="color: rgba(0, 0, 0, 1)">):
            </span><span style="color: rgba(0, 0, 255, 1)">if</span> result[i] !=<span style="color: rgba(0, 0, 0, 1)"> 0:
                coeff </span>=<span style="color: rgba(0, 0, 0, 1)"> result[i]
                result[i] </span>=<span style="color: rgba(0, 0, 0, 1)"> 0
                idx </span>= i -<span style="color: rgba(0, 0, 0, 1)"> self.n
                </span><span style="color: rgba(0, 0, 255, 1)">if</span> idx &lt;<span style="color: rgba(0, 0, 0, 1)"> len(result):
                    result[idx] </span>= (result[idx] - coeff) %<span style="color: rgba(0, 0, 0, 1)"> self.modulus
        result </span>=<span style="color: rgba(0, 0, 0, 1)"> result[:self.n]
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> result

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> poly_sub(self, a, b):
        result </span>= np.zeros(self.n, dtype=<span style="color: rgba(0, 0, 0, 1)">int)
        </span><span style="color: rgba(0, 0, 255, 1)">for</span> i <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(self.n):
            result[i] </span>= (a[i] - b[i]) %<span style="color: rgba(0, 0, 0, 1)"> self.modulus
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> result

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> poly_scale(self, a, scalar):
        result </span>= np.zeros(self.n, dtype=<span style="color: rgba(0, 0, 0, 1)">int)
        </span><span style="color: rgba(0, 0, 255, 1)">for</span> i <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(self.n):
            result[i] </span>= (a[i] * scalar) %<span style="color: rgba(0, 0, 0, 1)"> self.modulus
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> result

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> random_poly(self):
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> np.random.randint(0, self.modulus, self.n)

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> binary_poly(self):
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> np.random.randint(0, 2<span style="color: rgba(0, 0, 0, 1)">, self.n)

    </span><span style="color: rgba(0, 0, 255, 1)">def</span> small_poly(self, bound=3<span style="color: rgba(0, 0, 0, 1)">):
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> np.random.randint(-bound, bound + 1<span style="color: rgba(0, 0, 0, 1)">, self.n)

</span><span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> BFV:
    </span><span style="color: rgba(0, 0, 255, 1)">def</span> <span style="color: rgba(128, 0, 128, 1)">__init__</span>(self, n=256, q=1048576, t=256<span style="color: rgba(0, 0, 0, 1)">):
        self.n </span>=<span style="color: rgba(0, 0, 0, 1)"> n
        self.q </span>=<span style="color: rgba(0, 0, 0, 1)"> q
        self.t </span>=<span style="color: rgba(0, 0, 0, 1)"> t
        self.ring </span>=<span style="color: rgba(0, 0, 0, 1)"> PolynomialRing(n, q)
        self.plaintext_ring </span>=<span style="color: rgba(0, 0, 0, 1)"> PolynomialRing(n, t)
        self.delta </span>= q //<span style="color: rgba(0, 0, 0, 1)"> t

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> keygen(self):
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> äº§çå¯é¥</span>
        s =<span style="color: rgba(0, 0, 0, 1)"> self.ring.binary_poly()
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ææå¤é¡¹å¼</span>
        a =<span style="color: rgba(0, 0, 0, 1)"> self.ring.random_poly()
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> éæºå¤é¡¹å¼</span>
        e =<span style="color: rgba(0, 0, 0, 1)"> self.ring.small_poly()
        a_s </span>=<span style="color: rgba(0, 0, 0, 1)"> self.ring.poly_mul(a, s)
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ååºå¤é¡¹å¼</span>
        pk0 =<span style="color: rgba(0, 0, 0, 1)"> self.ring.poly_sub(e, a_s)
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¬é¥</span>
        pk =<span style="color: rgba(0, 0, 0, 1)"> [pk0, a]
        sk </span>=<span style="color: rgba(0, 0, 0, 1)"> s
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> pk, sk

    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ç¼ç ææ</span>
    <span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> encode(self, message):
        </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> isinstance(message, int):
            </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> åæ´æ°ç¼ç </span>
            m = np.zeros(self.n, dtype=<span style="color: rgba(0, 0, 0, 1)">int)
            m[0] </span>= message %<span style="color: rgba(0, 0, 0, 1)"> self.t
        </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">:
            </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ¹éç¼ç </span>
            m = np.array(message, dtype=int) %<span style="color: rgba(0, 0, 0, 1)"> self.t
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> m

    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ä½¿ç¨å¬é¥å å¯</span>
    <span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> encrypt(self, pk, message):
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¯¹ææè¿è¡ç¼ç </span>
        m =<span style="color: rgba(0, 0, 0, 1)"> self.encode(message)
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¯¹ææç¼ç ç»æè¿è¡æ¾å¤§</span>
        m_scaled =<span style="color: rgba(0, 0, 0, 1)"> self.ring.poly_scale(m, self.delta)
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)">print("m_scaled: {}".format(m_scaled))</span>
        
        <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çææ©ç å¤é¡¹å¼</span>
        u =<span style="color: rgba(0, 0, 0, 1)"> self.ring.binary_poly()
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> äº§çä¸¤ä¸ªå°åªå£°å¤é¡¹å¼</span>
        e1 =<span style="color: rgba(0, 0, 0, 1)"> self.ring.small_poly()
        e2 </span>=<span style="color: rgba(0, 0, 0, 1)"> self.ring.small_poly()
        
        pk0_u </span>=<span style="color: rgba(0, 0, 0, 1)"> self.ring.poly_mul(pk[0], u)
        pk1_u </span>= self.ring.poly_mul(pk[1<span style="color: rgba(0, 0, 0, 1)">], u)
        
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çæå¯æc0</span>
        c0 =<span style="color: rgba(0, 0, 0, 1)"> self.ring.poly_add(pk0_u, e1)
        c0 </span>=<span style="color: rgba(0, 0, 0, 1)"> self.ring.poly_add(c0, m_scaled)
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çæå¯æc1</span>
        c1 =<span style="color: rgba(0, 0, 0, 1)"> self.ring.poly_add(pk1_u, e2)
        
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è¿åå¯æ</span>
        <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> [c0, c1]

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> decrypt(self, sk, ciphertext):
        c0, c1 </span>=<span style="color: rgba(0, 0, 0, 1)"> ciphertext
        s_c1 </span>=<span style="color: rgba(0, 0, 0, 1)"> self.ring.poly_mul(sk, c1)
        decrypted </span>=<span style="color: rgba(0, 0, 0, 1)"> self.ring.poly_add(c0, s_c1)
        
        result </span>= np.zeros(self.n, dtype=<span style="color: rgba(0, 0, 0, 1)">int)
        </span><span style="color: rgba(0, 0, 255, 1)">for</span> i <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(self.n):
            result[i] </span>= round(decrypted[i] * self.t / self.q) %<span style="color: rgba(0, 0, 0, 1)"> self.t
        
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> result

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> add(self, c1, c2):
        c0 </span>=<span style="color: rgba(0, 0, 0, 1)"> self.ring.poly_add(c1[0], c2[0])
        c1 </span>= self.ring.poly_add(c1[1], c2[1<span style="color: rgba(0, 0, 0, 1)">])
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> [c0, c1]

</span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> main():
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">=== BFV åæå å¯æ¹æ¡æ¼ç¤º ===\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    
    bfv </span>= BFV(n=256, q=1048576, t=256<span style="color: rgba(0, 0, 0, 1)">)
    
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åæ°è®¾ç½®:</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">  å¤é¡¹å¼æ¬¡æ° n = {bfv.n}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">  å¯ææ¨¡æ° q = {bfv.q}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">  æææ¨¡æ° t = {bfv.t}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">  ç¼©æ¾å å­ Î = {bfv.delta}\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    
    pk, sk </span>=<span style="color: rgba(0, 0, 0, 1)"> bfv.keygen()
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å¯é¥çæå®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ç§é¥ s å5ä¸ªç³»æ°: {sk[:5]}...\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span><span style="color: rgba(0, 0, 0, 1)">(sk)
    
    m1 </span>= 42<span style="color: rgba(0, 0, 0, 1)">
    m2 </span>= 17
    <span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ææ m1 = {m1}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ææ m2 = {m2}\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    
    c1 </span>=<span style="color: rgba(0, 0, 0, 1)"> bfv.encrypt(pk, m1)
    c2 </span>=<span style="color: rgba(0, 0, 0, 1)"> bfv.encrypt(pk, m2)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å å¯å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å¯æ c1[0] å5ä¸ªç³»æ°: {c1[0][:5]}...</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å¯æ c1[1] å5ä¸ªç³»æ°: {c1[1][:5]}...\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å¯æc1 {}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">.format(c1))
    
    d1 </span>=<span style="color: rgba(0, 0, 0, 1)"> bfv.decrypt(sk, c1)
    d2 </span>=<span style="color: rgba(0, 0, 0, 1)"> bfv.decrypt(sk, c2)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">è§£å¯å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">è§£å¯ç»æ d1 = {d1[0]}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">è§£å¯ç»æ d2 = {d2[0]}\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">=== åæå æ³æ¼ç¤º ===</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    c_sum </span>=<span style="color: rgba(0, 0, 0, 1)"> bfv.add(c1, c2)
    d_sum </span>=<span style="color: rgba(0, 0, 0, 1)"> bfv.decrypt(sk, c_sum)
    expected_sum </span>= (m1 + m2) %<span style="color: rgba(0, 0, 0, 1)"> bfv.t
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å¯æåæå æ³: c1 + c2</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">è§£å¯ç»æ: {d_sum[0]}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ææç»æ: {expected_sum}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">éªè¯: {'æå' if d_sum[0] == expected_sum else 'å¤±è´¥'}\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">=== å¤é¡¹å¼æææ¼ç¤º ===</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    m_poly </span>= np.array([1, 2, 3, 4, 5] + [0] * 251, dtype=<span style="color: rgba(0, 0, 0, 1)">int)
    c_poly </span>=<span style="color: rgba(0, 0, 0, 1)"> bfv.encrypt(pk, m_poly)
    d_poly </span>=<span style="color: rgba(0, 0, 0, 1)"> bfv.decrypt(sk, c_poly)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å¤é¡¹å¼ææå5ä¸ªç³»æ°: {m_poly[:5]}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">è§£å¯ç»æå5ä¸ªç³»æ°: {d_poly[:5]}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">éªè¯: {'æå' if np.array_equal(d_poly[:5], m_poly[:5]) else 'å¤±è´¥'}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

</span><span style="color: rgba(0, 0, 255, 1)">if</span> <span style="color: rgba(128, 0, 128, 1)">__name__</span> == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">__main__</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
    main()</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h1>3 SEALä½¿ç¨</h1>
<h2>3.1 æºç ç¼è¯</h2>
<p>è¿éä»ç®åä»ç»ä¸Windowsä¸ä½¿ç¨VS2022ç¯å¢è¿è¡ç¼è¯ï¼ä¸è½½æºç å¹¶å®è£cmakeï¼è¿è¡VS2022å®è£èåä¸çâDeveloper Command Prompt for VS 2022âå½ä»¤è¡ï¼æ§è¡å½ä»¤è¿è¡éç½®ï¼</p>
<div class="cnblogs_code">
<pre>cmake -S . -B build -G <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Visual Studio 17 2022</span><span style="color: rgba(128, 0, 0, 1)">"</span> -A x64 -DCMAKE_INSTALL_PREFIX=./<span style="color: rgba(0, 0, 255, 1)">out</span></pre>
</div>
<p>è¿éç¼è¯çæ¯64ä½çæ¬ï¼å¹¶å°å®è£ç®å½è®¾ç½®ä¸ºå½åç®å½ä¸çoutæä»¶å¤¹ï¼éç½®å®æååæ§è¡ä»¥ä¸å½ä»¤è¿è¡ç¼è¯</p>
<div class="cnblogs_code">
<pre>cmake --build build --<span style="color: rgba(0, 0, 0, 1)">config Release    #ç¼è¯Releaseçæ¬
cmake </span>--build build --config Debug      #ç¼è¯Debugçæ¬</pre>
</div>
<p>ç¼è¯å®æåä¼çæseal-4.1.libåºæä»¶ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122113702648-1311816022.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ç¶åæ§è¡ä»¥ä¸å½ä»¤è¿è¡å®è£ï¼</p>
<div class="cnblogs_code">
<pre>cmake --install build</pre>
</div>
<p>outä¸includeä¸­æ¯å¤´æä»¶ï¼libä¸­æ¯éæåºæä»¶ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122114032047-1402497300.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<h2>3.2 ç¤ºä¾ç¨åº</h2>
<p>ä½¿ç¨VS2022åå»ºç©ºé¡¹ç®ï¼å¹¶æ·»å demo.cppæä»¶ï¼åå®¹å¦ä¸ï¼</p>
<div class="cnblogs_code"><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" id="code_img_closed_1771d7b9-7319-4893-9ce5-5347e3e25b4a" class="code_img_closed"><img src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" id="code_img_opened_1771d7b9-7319-4893-9ce5-5347e3e25b4a" class="code_img_opened" style="display: none">
<div id="cnblogs_code_open_1771d7b9-7319-4893-9ce5-5347e3e25b4a" class="cnblogs_code_hide">
<pre><span style="color: rgba(0, 128, 128, 1)"> 1</span> #include &lt;iostream&gt;
<span style="color: rgba(0, 128, 128, 1)"> 2</span> #include &lt;SEAL/SEAL.h&gt;
<span style="color: rgba(0, 128, 128, 1)"> 3</span> 
<span style="color: rgba(0, 128, 128, 1)"> 4</span> <span style="color: rgba(0, 0, 255, 1)">using</span> <span style="color: rgba(0, 0, 255, 1)">namespace</span><span style="color: rgba(0, 0, 0, 1)"> std;
</span><span style="color: rgba(0, 128, 128, 1)"> 5</span> <span style="color: rgba(0, 0, 255, 1)">using</span> <span style="color: rgba(0, 0, 255, 1)">namespace</span><span style="color: rgba(0, 0, 0, 1)"> seal;
</span><span style="color: rgba(0, 128, 128, 1)"> 6</span> 
<span style="color: rgba(0, 128, 128, 1)"> 7</span> <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> main() {
</span><span style="color: rgba(0, 128, 128, 1)"> 8</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ­¥éª¤ 1ï¼éç½®å å¯åæ°ï¼BFV æ¹æ¡ï¼</span>
<span style="color: rgba(0, 128, 128, 1)"> 9</span> <span style="color: rgba(0, 0, 0, 1)">    EncryptionParameters parms(scheme_type::bfv);
</span><span style="color: rgba(0, 128, 128, 1)">10</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¤é¡¹å¼æ¨¡æ°ï¼4096ï¼2çå¹æ¬¡ï¼</span>
<span style="color: rgba(0, 128, 128, 1)">11</span>     size_t poly_modulus_degree = <span style="color: rgba(128, 0, 128, 1)">4096</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">12</span> <span style="color: rgba(0, 0, 0, 1)">    parms.set_poly_modulus_degree(poly_modulus_degree);
</span><span style="color: rgba(0, 128, 128, 1)">13</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æææ¨¡æ°ï¼æ¯ææ¹éè¿ç®ï¼åå¼èå´ 2^20</span>
<span style="color: rgba(0, 128, 128, 1)">14</span>     parms.set_plain_modulus(PlainModulus::Batching(poly_modulus_degree, <span style="color: rgba(128, 0, 128, 1)">20</span><span style="color: rgba(0, 0, 0, 1)">));
</span><span style="color: rgba(0, 128, 128, 1)">15</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ç³»æ°æ¨¡æ°ï¼ä½¿ç¨ BFV é»è®¤åæ°</span>
<span style="color: rgba(0, 128, 128, 1)">16</span> <span style="color: rgba(0, 0, 0, 1)">    parms.set_coeff_modulus(CoeffModulus::BFVDefault(poly_modulus_degree));
</span><span style="color: rgba(0, 128, 128, 1)">17</span> 
<span style="color: rgba(0, 128, 128, 1)">18</span>     cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æææ¨¡æ° t = </span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; parms.plain_modulus().value() &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
</span><span style="color: rgba(0, 128, 128, 1)">19</span>     cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æææ¨¡æ° t æ¯ç¹æ° = </span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; parms.plain_modulus().bit_count() &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
</span><span style="color: rgba(0, 128, 128, 1)">20</span>     cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">t mod 2N = </span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; (parms.plain_modulus().value() % (<span style="color: rgba(128, 0, 128, 1)">2</span> * poly_modulus_degree)) &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
</span><span style="color: rgba(0, 128, 128, 1)">21</span> 
<span style="color: rgba(0, 128, 128, 1)">22</span>     vector&lt;Modulus&gt; coeff_mods =<span style="color: rgba(0, 0, 0, 1)"> CoeffModulus::BFVDefault(poly_modulus_degree);
</span><span style="color: rgba(0, 128, 128, 1)">23</span> 
<span style="color: rgba(0, 128, 128, 1)">24</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 3. ç³»æ°æ¨¡æ° qï¼å¤ç´ æ°ä¹ç§¯ï¼</span>
<span style="color: rgba(0, 128, 128, 1)">25</span>     cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\nç³»æ°æ¨¡æ° q çææï¼ç´ æ°åè¡¨ï¼ï¼</span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
</span><span style="color: rgba(0, 128, 128, 1)">26</span>     <span style="color: rgba(0, 0, 255, 1)">int</span> total_bits = <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">27</span>     <span style="color: rgba(0, 0, 255, 1)">for</span> (size_t i = <span style="color: rgba(128, 0, 128, 1)">0</span>; i &lt; coeff_mods.size(); i++<span style="color: rgba(0, 0, 0, 1)">) {
</span><span style="color: rgba(0, 128, 128, 1)">28</span>         cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ç¬¬</span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; i + <span style="color: rgba(128, 0, 128, 1)">1</span> &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä¸ªç´ æ°ï¼</span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> coeff_mods[i].value()
</span><span style="color: rgba(0, 128, 128, 1)">29</span>             &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ï¼æ¯ç¹æ°ï¼</span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; coeff_mods[i].bit_count() &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ï¼</span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
</span><span style="color: rgba(0, 128, 128, 1)">30</span>         total_bits +=<span style="color: rgba(0, 0, 0, 1)"> coeff_mods[i].bit_count();
</span><span style="color: rgba(0, 128, 128, 1)">31</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">32</span>     cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ç³»æ°æ¨¡æ°æ»æ¯ç¹æ° = </span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; total_bits &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
</span><span style="color: rgba(0, 128, 128, 1)">33</span> 
<span style="color: rgba(0, 128, 128, 1)">34</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ­¥éª¤ 2ï¼åå»ºå å¯ä¸ä¸æï¼éªè¯åæ°åæ³æ§</span>
<span style="color: rgba(0, 128, 128, 1)">35</span> <span style="color: rgba(0, 0, 0, 1)">    SEALContext context(parms);
</span><span style="color: rgba(0, 128, 128, 1)">36</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°ä¸ä¸æä¿¡æ¯ï¼å¯éï¼æ¥çåæ°éç½®ï¼</span>
<span style="color: rgba(0, 128, 128, 1)">37</span>     cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Context created successfully, scheme type: BFV</span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
</span><span style="color: rgba(0, 128, 128, 1)">38</span> 
<span style="color: rgba(0, 128, 128, 1)">39</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ­¥éª¤ 3ï¼çæå¯é¥ï¼éé SEAL 4.1 APIï¼æ ¸å¿ä¿®æ¹é¨åï¼</span>
<span style="color: rgba(0, 128, 128, 1)">40</span> <span style="color: rgba(0, 0, 0, 1)">    KeyGenerator keygen(context);
</span><span style="color: rgba(0, 128, 128, 1)">41</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 4.1 çæ¬ï¼éè¿ create_public_key() çæå¬é¥ï¼æ¿ä»£å public_key()ï¼</span>
<span style="color: rgba(0, 128, 128, 1)">42</span> <span style="color: rgba(0, 0, 0, 1)">    PublicKey public_key;
</span><span style="color: rgba(0, 128, 128, 1)">43</span> <span style="color: rgba(0, 0, 0, 1)">    keygen.create_public_key(public_key);
</span><span style="color: rgba(0, 128, 128, 1)">44</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 4.1 çæ¬ï¼ç´æ¥éè¿æåå½æ°è·åç§é¥ï¼è¯¥æ¥å£æªåæ´ï¼</span>
<span style="color: rgba(0, 128, 128, 1)">45</span>     SecretKey secret_key =<span style="color: rgba(0, 0, 0, 1)"> keygen.secret_key();
</span><span style="color: rgba(0, 128, 128, 1)">46</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 4.1 çæ¬ï¼éè¿ create_relin_keys() çæè¯ä¼°å¯é¥ï¼æ¿ä»£å relin_keys()ï¼</span>
<span style="color: rgba(0, 128, 128, 1)">47</span> <span style="color: rgba(0, 0, 0, 1)">    RelinKeys relin_keys;
</span><span style="color: rgba(0, 128, 128, 1)">48</span> <span style="color: rgba(0, 0, 0, 1)">    keygen.create_relin_keys(relin_keys);
</span><span style="color: rgba(0, 128, 128, 1)">49</span> 
<span style="color: rgba(0, 128, 128, 1)">50</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ­¥éª¤ 4ï¼åå§åå å¯å¨ãè§£å¯å¨ãè¯ä¼°å¨</span>
<span style="color: rgba(0, 128, 128, 1)">51</span> <span style="color: rgba(0, 0, 0, 1)">    Encryptor encryptor(context, public_key);
</span><span style="color: rgba(0, 128, 128, 1)">52</span> <span style="color: rgba(0, 0, 0, 1)">    Decryptor decryptor(context, secret_key);
</span><span style="color: rgba(0, 128, 128, 1)">53</span> <span style="color: rgba(0, 0, 0, 1)">    Evaluator evaluator(context);
</span><span style="color: rgba(0, 128, 128, 1)">54</span> 
<span style="color: rgba(0, 128, 128, 1)">55</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ­¥éª¤ 5ï¼ææåå¤ï¼ä¸¤ä¸ªæ´æ°ï¼</span>
<span style="color: rgba(0, 128, 128, 1)">56</span>     Plaintext plain1(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">123</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">57</span>     Plaintext plain2(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">456</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">58</span>     cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Original plaintext 1: </span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; plain1.to_string() &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
</span><span style="color: rgba(0, 128, 128, 1)">59</span>     cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Original plaintext 2: </span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; plain2.to_string() &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
</span><span style="color: rgba(0, 128, 128, 1)">60</span> 
<span style="color: rgba(0, 128, 128, 1)">61</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ­¥éª¤ 6ï¼å å¯ææä¸ºå¯æ</span>
<span style="color: rgba(0, 128, 128, 1)">62</span> <span style="color: rgba(0, 0, 0, 1)">    Ciphertext cipher1, cipher2;
</span><span style="color: rgba(0, 128, 128, 1)">63</span> <span style="color: rgba(0, 0, 0, 1)">    encryptor.encrypt(plain1, cipher1);
</span><span style="color: rgba(0, 128, 128, 1)">64</span> <span style="color: rgba(0, 0, 0, 1)">    encryptor.encrypt(plain2, cipher2);
</span><span style="color: rgba(0, 128, 128, 1)">65</span>     cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Plaintext encrypted to ciphertext successfully</span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
</span><span style="color: rgba(0, 128, 128, 1)">66</span> 
<span style="color: rgba(0, 128, 128, 1)">67</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ­¥éª¤ 7ï¼å¯æåæè¿ç®ï¼å æ³ + ä¹æ³ï¼
</span><span style="color: rgba(0, 128, 128, 1)">68</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¯æå æ³</span>
<span style="color: rgba(0, 128, 128, 1)">69</span> <span style="color: rgba(0, 0, 0, 1)">    Ciphertext cipher_add;
</span><span style="color: rgba(0, 128, 128, 1)">70</span> <span style="color: rgba(0, 0, 0, 1)">    evaluator.add(cipher1, cipher2, cipher_add);
</span><span style="color: rgba(0, 128, 128, 1)">71</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¯æä¹æ³ + éçº¿æ§åï¼åå°å¯æå¤§å°ï¼</span>
<span style="color: rgba(0, 128, 128, 1)">72</span> <span style="color: rgba(0, 0, 0, 1)">    Ciphertext cipher_mult;
</span><span style="color: rgba(0, 128, 128, 1)">73</span> <span style="color: rgba(0, 0, 0, 1)">    evaluator.multiply(cipher1, cipher2, cipher_mult);
</span><span style="color: rgba(0, 128, 128, 1)">74</span> <span style="color: rgba(0, 0, 0, 1)">    evaluator.relinearize_inplace(cipher_mult, relin_keys);
</span><span style="color: rgba(0, 128, 128, 1)">75</span> 
<span style="color: rgba(0, 128, 128, 1)">76</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ­¥éª¤ 8ï¼è§£å¯å¯æï¼éªè¯ç»æ</span>
<span style="color: rgba(0, 128, 128, 1)">77</span> <span style="color: rgba(0, 0, 0, 1)">    Plaintext plain_add, plain_mult;
</span><span style="color: rgba(0, 128, 128, 1)">78</span> <span style="color: rgba(0, 0, 0, 1)">    decryptor.decrypt(cipher_add, plain_add);
</span><span style="color: rgba(0, 128, 128, 1)">79</span> <span style="color: rgba(0, 0, 0, 1)">    decryptor.decrypt(cipher_mult, plain_mult);
</span><span style="color: rgba(0, 128, 128, 1)">80</span>     cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Ciphertext add result: </span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; plain_add.to_string() &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
</span><span style="color: rgba(0, 128, 128, 1)">81</span>     cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Ciphertext multiply result: </span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; plain_mult.to_string() &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
</span><span style="color: rgba(0, 128, 128, 1)">82</span>     
<span style="color: rgba(0, 128, 128, 1)">83</span>     <span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">84</span> }</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>å°ä¹é´äº§ççoutæä»¶å¤¹ä¸çincludeålibæ·è´å°é¡¹ç®æä»¶å¤¹ä¸ï¼éç½®é¡¹ç®çC/C++ç¼è¯åå«å¤´æä»¶è·¯å¾ï¼åºæä»¶è·¯å¾ä»¥åè¾å¥åºï¼å³å¯è¿è¡ç¼è¯ã</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122114406545-2054417852.png" alt="image" width="593" height="434" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ç¼è¯å®æåè¿è¡ç¨åºï¼è¾åºå¦ä¸ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260122114732024-1409765149.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¨è¯¥ç¤ºä¾ç¨åºä¸­ï¼å¤é¡¹å¼æ¨¡æ°Næ¯4096ï¼æææ¨¡æ°tæ¯1032193ï¼ä½å®½ä¸º20bitsï¼ç³»æ°æ¨¡æ°qæ¯3ä¸ªç´ æ°çä¹ç§¯68719403009*68719230977*137438822401=0x1ffff4400622fecd904df7f92001ï¼ä½å®½æ¯109bitsï¼ç¤ºä¾ä¸­æ¼ç¤ºäº0x123å0x456çå æ³åä¹æ³è¿è¡ï¼å¯è§å å¯è¿ç®åçè§£å¯ç»æåæªå å¯è¿ç®çç»æå®å¨ä¸è´ã</p>
<p>&nbsp;</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.008333333333333333" data-date-updated="2026-01-22 16:02">2026-01-22 15:50</span>&nbsp;
<a href="https://www.cnblogs.com/zhaoweiwei">weiwei22844</a>&nbsp;
éè¯»(<span id="post_view_count">11</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19510487);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19510487', targetLink: 'https://www.cnblogs.com/zhaoweiwei/p/19510487/bfv', title: 'SEALå¨åæå å¯BFVæ¹æ¡å¥é¨è¯¦è§£' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æçâPythonæµ·é¾âè¯çäºä¸æéèå­µåºçå´æ¯ç²¾çµ ]]></title>
    <link>https://www.cnblogs.com/lixingqiu/p/19516100</link>
    <guid>d0489042c049b1f1955d55c9a4aede30</guid>
    <description>
    <![CDATA[ 
	<h1 class="postTitle"><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lixingqiu/p/19516100" title="åå¸äº 2026-01-22 11:17">
    <span role="heading" aria-level="2">æçâPythonæµ·é¾âè¯çäºä¸æéèå­µåºçå´æ¯ç²¾çµ</span>
    

</a>
</h1>
	<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>æ¶ååæº¯å°2010å¹´ï¼é£æ¯ä¸ä¸ªåæ»¡æ¢ç´¢ä¸æ±ç¥çå¹´ä»½ãå¨æ­¤ä¹åï¼ææ²æµ¸äºä½¿ç¨Visual Basicè¯­è¨å¼å3Då°æ¸¸æï¼é£ç§å¨ä»£ç çä¸çéåé åºå¥å¦èæåºæ¯çæè§ï¼è®©æä¹æ­¤ä¸ç²ãå½æ¶ï¼æèªè®¤ä¸ºBasicå·²ç»æ¯ç¸å½ç®åçè®¡ç®æºè¯­è¨äºï¼ç¶èï¼åå¿æ·±å¤å´å§ç»æä¸ªçé®ï¼æ¯å¦å­å¨ä¸ç§æ¯Basicæ´éåå°å¿ç¼ç¨çä¸ç¨è®¡ç®æºè¯­è¨å¢ï¼</p>
<p>å¸¦çè¿ä¸ªçé®ï¼æå¼å§å¨ç½ç»ä¸å¹¿æ³æå¯»ãåå¤«ä¸è´æå¿äººï¼æç»äºåç°äºScratch 1.4çãè¿åªæ¥èªç¾å½éº»ççå·¥çâå°ç«åªâï¼ç¬é´å¸å¼äºæçç®åï¼ä»æ­¤æä¾¿æ·±æ·±ç±ä¸äºå®ã2013å¹´ï¼ææ£çå¯¹å°å¿ç¼ç¨æè²çç­æï¼æå¼è®¾äºå°å¿ç¼ç¨å¹è®­ç­ãå°äº2015å¹´ï¼æåå°Pythonçº³å¥æå­¦ä½ç³»ï¼å¸æè½ä¸ºå­¦çä»¬å¸¦æ¥æ´ä¸°å¯çç¼ç¨ä½éªãç»è¿å å¹´çæå­¦å®è·µï¼å°2018å¹´æ¶ï¼æå·²ç»èªå·±ç¼åäºè¾å¤çéå°å¹´Pythonæå­¦èµæã</p>
<p>å¨è¿ä¸ªè¿ç¨ä¸­ï¼æéæ¸åç°Pythonçå°æµ·é¾åè½å­å¨ä¸å®çå±éæ§ãä¸ºäºæ·±å¥æ¢ç©¶å¶åçï¼ææå¼äºå®çturtle.pyæºä»£ç æä»¶ï¼ä»ç»ç ç©¶å¶ä¸­çå¥¥ç§ãä»2019å¹´å¼å§ï¼æåºäºPython turtleæ¨¡åï¼è¸ä¸äºå¼åPythonç²¾çµæ¨¡åçå¾ç¨ãPythonç²¾çµæ¨¡åçæ ¸å¿æ¯è®¾è®¡äºä¸ä¸ªåä¸ºSpriteçç±»ï¼è¿ä¸åæ°å¤§å¤§å¢å äºæµ·é¾çåè½ï¼ä¾å¦å®ç°äºåç´ çº§å«çç¢°ææ£æµç­ãå¦ä»ï¼ææäººé½å¯ä»¥éè¿ç®åçå½ä»¤âpip install spritesâæ¥å®è£å¹¶ä½¿ç¨è¿ä¸ªå¼ºå¤§çPythonç²¾çµæ¨¡åã</p>
<p>è¿å å¹´ï¼æå°ä¸»è¦ç²¾åæå¥å°ä¿¡æ¯å­¦å¥¥èµçæå­¦ä¸­ãæ¯æ¥é½å¨âè¦æå¥æ³âåç§é¾é¢ï¼åæ±ä¸ºå­¦çæ¾å°æ´ææçå­¦ä¹ æ¹æ³ã2025å¹´8æï¼æåç­ç»æï¼æåå¼å§æèä¸ä¸ªæ°çé®é¢ï¼å¦æC++çå¥é¨æå­¦è½å¤åPython turtleä¸æ ·ç®åææï¼é£æ çä¼ç»ä¸­å½ææå°å¹´å¸¦æ¥ç¦é³ã</p>
<p>ä¸ºäºå®ç°è¿ä¸ªç®æ ï¼æå¨GitHubä¸å¹¿æ³å¯»æ¾åäººçç ç©¶ææï¼ä¸è½½äºè®¸å¤ç¨Cè¯­è¨æèC++å¼åçç±»turtleåºãå¶ä¸­ï¼æå°çç«C++åºéèªå¸¦çCè¯­è¨æµ·é¾ä½å¾ï¼è¿æGoCç­ç¸å³åºãæè¿ç¹æè´­ä¹°äºç¸å³ä¹¦ç±ï¼åå¤ææä¸­å°å­¦çï¼çè³ä¹°äºä¸æ¬å°å¿3ç»´C++ç¼ç¨ä¹¦ãç¶èï¼ç»è¿æ·±å¥ç ç©¶åå¯¹æ¯ï¼ææç»å¹¶æ²¡æéæ©ä½¿ç¨å®ä»¬ï¼è¿èåæçå¤æ¹é¢çåå ã</p>
<p>å°±æ¿å°çç«C++åºéèªå¸¦çCè¯­è¨æµ·é¾ä½å¾æ¥è¯´ï¼å¶ä½èæ¾ç¶æ²¡æPythonå°å¿ç¼ç¨æè²çç»åãææ¾å°è¯èç³»ä½èï¼å¸æä»è½å°éé¢çå½ä»¤æ¹æç±»ä¼¼Python turtleçé£æ ¼ï¼ä½èèå°ä¸è½æ»æ¯éº»ç¦ä»äººï¼åæ¥ä¹å°±æ²¡æåç»§ç»­èç³»ãèGoCè¿ä¸ªåºï¼éé¢çå½ä»¤ä¹æ²¡ææ¿æ¥èªPython turtleãä¸ºäºæ¹ä¾¿å¿ç«¥è¾å¥å­ç¬¦ï¼å®å°å½ä»¤è®¾è®¡æä¸ä¸ªå­ç¬¦æä¸¤ä¸ªå­ç¬¦ï¼æ¯å¦pen.oæèpen.ooä¹ç±»çãå¶å½ä»¤ç¸å¯¹è¾å°ï¼åè½ä¹ä¸å¤ä¸°å¯ï¼èä¸ä¸»è¦æ¯å¨çº¿ä½¿ç¨ï¼ä½èè³ä»ä¼¼ä¹é½æ²¡æå¼åèªå·±çç¼è¾å¨ãä»¥åæä½¿ç¨è¿å®çç¦»çº¿çï¼è¿éè¦åå©notepad++ãä»æ¬è´¨ä¸è®²ï¼å®æ´åæ¯ä¸ºä¸æ»ä¿¡æ¯å­¦å¥¥èµè®¾è®¡çåç½®è¯¾ç¨å·¥å·ãç½ä¸æäººå»ºè®®ä¸ãäºå¹´çº§çå­¦çå°±å¼å§å­¦ä¹ GoCï¼ä½å¦æä¸æç®ä¸æ»ä¿¡å¥¥èµï¼å¶å®å¯ä»¥ä¸å¿å­¦ä¹ ãä¸ºä»ä¹å¢ï¼</p>
<p>ä»å¤§èåè²çè§åº¦æ¥çï¼ä¸ãäºå¹´çº§çå­¦çï¼ä»ä»¬çå¤§èå°å¤äºåè²é¶æ®µãç§å­¦ç ç©¶è¡¨æï¼è¿ä¸ªé¶æ®µçå­©å­ï¼å¤§èçåé¢å¶ç®è´¨å°æªå®å¨æçï¼æ½è±¡æç»´è½åç¸å¯¹è¾å¼±ãè½ç¶æäºå­©å­å¯è½å¨æ©æå°±å±ç°åºäºè¾å¼ºçå­¦ä¹ è½ååå¤©èµï¼å¦ææç»ç¼åç¬å°ï¼è½è¯å«åºè¿äºèå­ï¼è®©ä»ä»¬å°è¯å­¦ä¹ GoCä¹æªå°ä¸å¯ãä½ç°å®æåµæ¯ï¼ä¸å¯è½æ¯ä¸ªå°å­¦çé½å¾å»ä¸æ»ä¿¡æ¯å­¦å¥¥èµï¼æ¯ç«ä¿¡å¥¥èµçç«äºååæ¿çï¼å®å°±æ¯å­¦é¸ä»¬çæåºãèä¸ï¼å¯¹äºæ®éå­¦çèè¨ï¼ä»ä»¬çå°å¿ç¼ç¨å­¦ä¹ ç»ååºè¯¥æ¯ä¸°å¯å¤å½©çï¼ä¸åºå±éäºC++ç¼ç¨ãå ä¸ºå­¦ä¹ ç¼ç¨çæ¬è´¨å¹¶éä»ä»ææ¡æç§è®¡ç®æºè¯­è¨ï¼èæ¯å¹å»é»è¾æç»´ãåé åç­å¤æ¹é¢çè½åãæäºäººå¤§èåè²ç¸å¯¹è¿ç¼ä¸äºï¼å¦æç¡¬è¦ä»ä»¬å¨ä½å¹´çº§å°±å¼å§å­¦ä¹ C++ï¼å¾å¯è½ä¼éå¾å¶åï¼å°±æ¯æèå©é¿ãæ ¹æ®ç¥ç»ç§å­¦çç ç©¶ï¼å¿ç«¥å¨ä¸­ä½å¹´çº§é¶æ®µï¼å½¢è±¡æç»´æ´ä¸ºæ´»è·ï¼æ­¤æ¶å­¦ä¹ å¾å½¢åç¼ç¨æ´å ç¬¦åä»ä»¬çè®¤ç¥åå±è§å¾ãç­å°ä»ä»¬å¹´é¾ç¨å¤§ï¼å¿æºæ´å æçï¼åå»å­¦ä¹ C++ä¹ä¸è¿ãå¤§èéè¦å¾å°å¤æ¹é¢çåºæ¿ï¼æè½å¾å°ååçé»ç¼ååå±ãå°±åä¸é¢ç§å­ï¼éè¦å¨éå®çç¯å¢ä¸­ï¼ç»åä¸åçå»åæ»å»ï¼æè½èå£®æé¿ãæç»ï¼æäºå­¦çå°äºé«ä¸­é¶æ®µï¼éçå¤§èçè¿ä¸æ­¥åè²åç¥è¯çç§¯ç´¯ï¼ä¼çªç¶å¼çªï¼å¨å­¦ä¹ ç¼ç¨ç­æ¹é¢åå¾æ´å¤§çè¿æ­¥ã</p>
<p>é£ä¹ï¼é¢å¯¹ç»å¤§å¤æ°çæ®éå­¦çç¾¤ä½ï¼ä»ä»¬çå­¦ä¹ è·¯å¾éå¸¸æ¯ä¸ãäºå¹´çº§å­¦ä¹ å¾å½¢åç¼ç¨ï¼ä¸ãåå¹´çº§å­¦ä¹ Pythonç¼ç¨ï¼å°äºä¸å®é¶æ®µååå­¦ä¹ C++ç¼ç¨ãå¨è¿ç§æåµä¸ï¼æ¯å¦å­å¨ä¸ç§éå¯¹æ®éå­¦çï¼è½å¤å®ç¾è¡æ¥è¿ä¸è¯¾ç¨ä½ç³»çC++è¯¾ç¨å¢ï¼æ®æäºè§£ï¼è¿æ ·çè¯¾ç¨ç¸å¯¹æ¯è¾å°ï¼å³ä¾¿æï¼å¯è½ä¹ä¸å¬å¼æèéè¦æ¶è´¹ãæ¯ç«ä¸­å½å°åå¹¿éï¼å¾å¤äºææä¹é¾ä»¥å¨é¢ç¥æãä½ä¸ç®¡ææ ·ï¼æå³å®èªå·±å¨æ°å¼åä¸ä¸ªï¼æ­£æè°âéçªé¶çªä¸å¦èªå·±èçªâã</p>
<p>å¨å¼åè¿ç¨ä¸­ï¼é¦åé¢ä¸´çå°±æ¯éæ©åéçåºæ¥ä½ä¸ºåºç¡ãå¦æè®©æçC++åºåºäºOpenGLï¼è½ç¶å¯è¡ï¼ä½æéè¦åè±è´¹å¤§éæ¶é´å»å­¦ä¹ å®ï¼è¿å¯¹äºææ¥è¯´ï¼å­¦ä¹ ææ¬è¿é«ãäºæ¯ï¼ææ¾å°äºæ¾ç»ç¨è¿çeasyXï¼å¹¶ç¨å®å¼ååºäºåå½¢åºãç¶èï¼å¨ä½¿ç¨è¿ç¨ä¸­ï¼æåç°å¾å¤åºå±çä¸è¥¿ææ æ³ææ§ï¼æ å¥ä¹ä¸åªè½æ¾å¼ãæ¥çï¼æååç°äºraylibï¼å®åºäºSDL2ï¼æ¥å£ä¼å¤ï¼å°è£å¾è¾ä¸ºå¤æãéåï¼ææ³¨æå°äºSFMLï¼è¿æ¯ä¸ä¸ªå¾ä¸éçåºï¼ä½èèå°å®å·²ç»å°è£äºå¾å¤åå®¹ï¼ææ³è¦ææ¡æ´å¤åºå±ææ¯ï¼æç»è¿æ¯å¼ç¨äºå®ãæåï¼æéæ©äºå·¥ä¸çº§å«çSDL2åºãè¿ä¸ªåºåè½ç¸å¯¹è¾å°ï¼ä½ä¹æå³çæèªå·±çå¼åèªç±åº¦æ´å¤§ï¼å¯¹åºå±çææ§åæ´å¼ºã</p>
<p>æä»¥ï¼ç°å¨ççæ¬æ¯åºäºSDL2åºå¼åçãæåï¼æå°å¶å½åä¸ºC++ Spritesåºï¼åæ¥åæ­£å¼å½åä¸ºC++ç²¾çµåºãå¨å¼åè¿ç¨ä¸­ï¼æä¸æ­å°è¿è¡ä¿®æ¹åè°è¯ï¼åªä¸ºè®©æ®éç¨æ·è½å¤æ´å¥½å°ä¸æä½¿ç¨ãä¸ºäºè®©è¿ä¸ªåºæ´å å®åï¼æè¿ä¸­éå¼åäºpxC++ç¼è¾å¨ï¼è¿æ¯ä¸é¨ä¸ºC++ç²¾çµåºéèº«æé çç¼è¾å¨ãåæ¶ï¼æè¿å¼åäºDevC++5.11åçº§åï¼ä½¿DevC++5.11è½å¤æ¯æC++ç²¾çµåºï¼ä»èè®©å®æ´å¥½å°èå¥å°ä¸»æµçä¸­å°å­¦çC++æå­¦çæä¸­ã</p>
<p>ç°å¨çC++ç²¾çµåºï¼æ¯è¾å®ç¾å°ç»§æ¿äºPython turtleçè¡èãä¸ä»å¦æ­¤ï¼æè¿éå¯¹Python turtleå­å¨çä¸è¶³ä¹å¤è¿è¡äºæ¹è¿ä¸ä¼åãä¾å¦ï¼æç²¾å¿è®¾è®¡äºfillå½ä»¤ï¼è§è²éè¿ä½¿ç¨fillå½ä»¤ï¼å°±å¯ä»¥å¨å°é­åºåè¿è¡æ´ªæ°´å¡«åãå¨è®¾å®ç»ç¬é¢è²æ¹é¢ï¼ä¸ä»è½å¤è®©è§è²çç»ç¬é¢è²å½ä»¤æ¥åå­ç¬¦ä¸²ä½ä¸ºåæ°ï¼è¿è½æ¥å1ä¸ªæ´æ°æå¤ä¸ªæ´æ°ä½ä¸ºåæ°ãè¿æ¯å ä¸ºæå¯¹pencolorå½ä»¤è¿è¡äºå¤æ¬¡éè½½ï¼ä½¿å¶å·ææ´é«ççµæ´»æ§åèªç±åº¦ã</p>
<p>æ­¤å¤ï¼æè¿ä¸ºè§è²çç»ç¬å¢æ·»äºè®¸å¤å®ç¨çæ¹æ³ãæ¯å¦ï¼è®¾è®¡äºè®¾å®é´å½±åº¦çpenshadeæ¹æ³ï¼ä»¥åè®¾å®é¢è²é¥±ååº¦çpensatæ¹æ³åè®¾å®é¢è²æåº¦çpenvalueæ¹æ³ãåæ¥åè¿ä¸æ­¥è®¾è®¡äºç´æ¥è®¾å®é¢è²çHueãSaturationåValueçpenhsvæ¹æ³ï¼è¿æä¿®æ¹é¢è²éæåº¦çpenalphaæ¹æ³ãä¸ä»å¦æ­¤ï¼è¿ä¸ºè§è²è®¾è®¡äºè´å¡å°æ²çº¿ä¸æ ·æ¡æ²çº¿ç­æ¹æ³ãè¿äºç²¾å¿è®¾è®¡çè®¾å®ï¼å¯¹äºå®¡ç¾è½åå¼ºçç¾æ¯çæ¥è¯´ï¼æ çæä¾äºæå¤§çä¾¿å©ï¼ä½¿ä»ä»¬è½å¤æ´å è½»æ¾å°åä½åºå·æèºæ¯ææçå¾å½¢ã</p>
<p>ç°å¨æä»¬æçå°çâC++ç²¾çµåºâï¼æ¬è´¨ä¸æ¯åºäºlogoè®¡ç®æºè¯­è¨ç¼ç¨æè²çå¿µå¨C++ä¸ççå»¶ä¼¸å¹¶ææè¶è¶ãå®åé´äºPython turtleç®æ´çAPIï¼å¹¶éå¯¹æè²åºæ¯è¿è¡äºæ·±å¥ä¼åãè¿æ ·ä¸æ¥ï¼å­¦çä»¬å°±è½å¤å¨ä¸ä¸ªæ´å¼ºå¤§ãæ´æ¥è¿å·¥ä¸æ åçè¯­è¨ç¯å¢ä¸­ï¼ååä½éªå°âæµ·é¾ä½å¾âçä¹è¶£ä¸æºæ§ãæä»¬å¯ä»¥æPython turtleåC++ç²¾çµåºæ¯ä½æ¯äº²åå¼ï¼æ è®ºåå­¦ä¹ åªä¸ä¸ªï¼åå»å­¦ä¹ å¦ä¸ä¸ªï¼é½ä¼æä¸ç§âä¼¼æ¾ç¸è¯çå½æ¥âççææï¼è¿å°±æ¯æè°çâååèµè½âãå ä¸ºç¼ç¨çä¸çå¨åºå±æ¬æ¥å°±æ¯ç¸éçï¼å½ææå®ä»¬çå¤è§ä¹è®¾è®¡å¾ç¸ä¼¼çæ¶åï¼è¯·ä¸è¦æå°æè®¶ï¼</p>
<p>æ´å¼å¾ä¸æçæ¯ï¼ç±äºC++ç²¾çµåºæ¯åºäºSDL2åºè¿è¡å¼åçï¼å®è¿è½å¤å®ç¾èå¥SDL2åºçå½ä»¤ï¼ä¸ºå­¦çæä¾æ´æ·±å¥çç¼ç¨å­¦ä¹ æºä¼ãæ³è±¡ä¸ä¸ï¼SDL2åºå¨åè¡åä¸ä¸­çå¹¿æ³åºç¨åºæ¯ï¼C++ç²¾çµåºæ çä¸ºå­¦ççæªæ¥å­¦ä¹ åèä¸åå±èµäºäºå¶ä»ç±»C++ turtleåºæ æ³æ¯æçä¼å¿ã</p>
<p>&nbsp;</p>
</div>
<div class="clear"></div>

	<div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-22 11:17">2026-01-22 11:17</span>&nbsp;
<a href="https://www.cnblogs.com/lixingqiu">æå´ç</a>&nbsp;
éè¯»(<span id="post_view_count">124</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19516100);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19516100', targetLink: 'https://www.cnblogs.com/lixingqiu/p/19516100', title: 'æçâPythonæµ·é¾âè¯çäºä¸æéèå­µåºçå´æ¯ç²¾çµ' })">ä¸¾æ¥</a>
</div>
 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Claude Code æ¯æéç£æ©å± Skills ââ ç¨ææ° API æå»ºæ´é è°±ç AI é¡¹ç® ]]></title>
    <link>https://www.cnblogs.com/bugshare/p/19515937</link>
    <guid>cba4901b0065383586452ba3d9d62293</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/bugshare/p/19515937" title="åå¸äº 2026-01-22 10:55">
    <span role="heading" aria-level="2">Claude Code æ¯æéç£æ©å± Skills ââ ç¨ææ° API æå»ºæ´é è°±ç AI é¡¹ç®</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨ä¸ä¸ç¯ã<strong>Claude Code Ã æºè°± BigModel å®æéææå</strong>ãä¸­ï¼æä»¬å·²ç»å®æäºä¸æ¬¡å®æ´çé¡¹ç®å®æãé¡¹ç®<strong>å¯ä»¥æ­£å¸¸è¿è¡</strong>ï¼ä½å¨åç»­ä»£ç  Review æ¶ï¼ä¸ä¸ªé®é¢éæ¸æ´é²åºæ¥ï¼</p>
<blockquote>
<p><strong>çæçä»£ç è½ç¶è½è·ï¼ä½å¤§é API åç¨æ³å·²ç»è¿æ¶ï¼ä¸ææ°å®æ¹ææ¡£å­å¨ææ¾åå·®ã</strong></p>
</blockquote>
<p>è¿å¨ AI è¾å©å¼åä¸­å¶å®éå¸¸å¸¸è§ââæ¨¡åçè®­ç»æ°æ®æ´æ°éåº¦ï¼å¾å¾èµ¶ä¸ä¸æ¡æ¶å SDK çè¿­ä»£éåº¦ã</p>
<p>æ­£å·§è¿æ¶ï¼ä¸ä½æååææ¨èäº <strong>Anthropic ææ°åå¸ç Agent Skills</strong>ï¼éè¿ <em>plugins</em> çæ¹å¼ï¼è®© Claude å¨çæä»£ç æ¶ <strong>å¨æè¯»åææ°å®æ¹ææ¡£åå·¥å·è½å</strong>ï¼ä»èæ¾èéä½âåå¾åï¼ä½è·ä¸éâçæ¦çã</p>
<p>æ¬æå°±æ¯è¿æ¬¡æ¢ç´¢çå®æ´è®°å½ã</p>
<hr>
<h1 id="ä¸agent-skills-æ¯ä»ä¹">ä¸ãAgent Skills æ¯ä»ä¹ï¼</h1>
<p>å®æ¹ä»åºå°åï¼</p>
<blockquote>
<p><a href="https://github.com/anthropics/skills" target="_blank" rel="noopener nofollow">https://github.com/anthropics/skills</a></p>
</blockquote>
<p><strong>Agent Skills</strong> å¯ä»¥çè§£ä¸ºï¼</p>
<blockquote>
<p>ä¸å¥å¯ææçâè½åæ¨¡åâï¼ç¨äºæä¼ Claude <strong>å¦ä½ç¨æ­£ç¡®çæ¹æ³ãææ°çå·¥å·ãå¯éå¤çæµç¨</strong> æ¥å®æç¹å®ä»»å¡ã</p>
</blockquote>
<p>å¨ææ¯å±é¢ä¸ï¼</p>
<ul>
<li>
<p>æ¯ä¸ª Skill æ¬è´¨ä¸æ¯ä¸ä¸ªæä»¶å¤¹</p>
</li>
<li>
<p>åé¨åå«ï¼</p>
<ul>
<li>æä»¤ï¼instructionsï¼</li>
<li>èæ¬ï¼scriptsï¼</li>
<li>èµæºæä»¶ï¼resourcesï¼</li>
</ul>
</li>
<li>
<p>Claude Code ä¼å¨è¿è¡æ¶å¨æå è½½è¿äº Skills</p>
</li>
</ul>
<h2 id="å®è½è§£å³ä»ä¹é®é¢">å®è½è§£å³ä»ä¹é®é¢ï¼</h2>
<p>Agent Skills çæ ¸å¿ä»·å¼å¨äº <strong>âéä½å¹»è§ + æé«ä¸è´æ§â</strong>ï¼å¸ååºç¨åºæ¯åæ¬ï¼</p>
<ul>
<li>æå¬å¸/å¢éçç¼ç è§èçæä»£ç </li>
<li>æææ°å®æ¹ææ¡£è°ç¨ APIï¼èä¸æ¯é æ¨¡åè®°å¿ï¼</li>
<li>æ§è¡åºå®çå·¥ç¨åæµç¨ï¼åå§åé¡¹ç®ãçæç®å½ç»æãé¨ç½²èæ¬ç­ï¼</li>
<li>èªå¨åä¸ªäººæç»ç»çº§ä»»å¡</li>
</ul>
<p>ç®åæ¥è¯´ï¼</p>
<blockquote>
<p><strong>Skills ä¸æ¯è®©æ¨¡åæ´èªæï¼èæ¯è®©æ¨¡åæ´âå®è§ç©âã</strong></p>
</blockquote>
<hr>
<h1 id="äºå¨-claude-code-ä¸­å®è£-agent-skills">äºãå¨ Claude Code ä¸­å®è£ Agent Skills</h1>
<p>å¨ Claude Code å½ä»¤è¡ä¸­æ§è¡ï¼</p>
<pre><code class="language-bash">/plugin marketplace add anthropics/skills
</code></pre>
<p>å®è£å®æåï¼ä½ å°±å·²ç»å·å¤äºä½¿ç¨å®æ¹ Skills çè½åã</p>
<blockquote>
<p>è¿ä¸æ­¥ç¸å½äºä¸º Claude Code æå¼äºâå®æ¹å¢å¼ºæ¨¡å¼âã</p>
</blockquote>
<p><img alt="PixPin_2026-01-22_10-07-25.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3715916/202601/3715916-20260122104737596-1387531556.png" class="lazyload"></p>
<hr>
<h1 id="ä¸å®è£-context7-æä»¶å³é®æ­¥éª¤">ä¸ãå®è£ context7 æä»¶ï¼å³é®æ­¥éª¤ï¼</h1>
<p>æ¥ä¸æ¥æ¯æ¬æçéç¹ï¼<strong>context7</strong>ã</p>
<h2 id="1ï¸â£-æå¼æä»¶ç®¡ç">1ï¸â£ æå¼æä»¶ç®¡ç</h2>
<p>å¨ Claude Code ä¸­è¾å¥ï¼</p>
<pre><code class="language-shell">/plugins
</code></pre>
<p>ç¶åä½¿ç¨é®ç â¡ï¸ è¿å¥ <strong>Discover</strong>ã</p>
<h2 id="2ï¸â£-æç´¢å¹¶å®è£-context7">2ï¸â£ æç´¢å¹¶å®è£ context7</h2>
<p>å¨æç´¢æ¡ä¸­è¾å¥ <code>context7</code>ï¼å®æå®è£ã</p>
<blockquote>
<p>context7 æ¬è´¨ä¸æ¯ä¸ä¸ª MCPï¼Model Context Protocolï¼æä»¶ï¼<br>
è½è®© Claude <strong>ç´æ¥åèå¹¶å¯¹é½ææ°çå®æ¹ææ¡£åå®¹</strong>ã</p>
</blockquote>
<p><img alt="PixPin_2026-01-22_10-09-22.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3715916/202601/3715916-20260122104737593-1570344568.png" class="lazyload"></p>
<hr>
<h1 id="åä½¿ç¨-context7-çæé¡¹ç®ä»£ç ">åãä½¿ç¨ context7 çæé¡¹ç®ä»£ç </h1>
<p>å®è£å®æåï¼å°±å¯ä»¥å¨ Prompt ä¸­æ¾å¼å£°æä½¿ç¨ <code>context7</code>ã</p>
<h2 id="ç¤ºä¾-prompt">ç¤ºä¾ Prompt</h2>
<pre><code class="language-markdown">---
name: context7
description: ä½¿ç¨ Context7ï¼åºäºæ¡æ¶ææ°çå®æ¹ææ¡£
---

# context7

## æå
å·²ä½¿ç¨ä»¥ä¸ææ¯æ çæä¼ä¸çº§é¡¹ç®ï¼
- ä½¿ç¨ Context7ï¼åºäºææ°çå®æ¹ææ¡£
- FastAPI 0.128.0ï¼å¸¦ Token è®¤è¯
  - ä½¿ç¨ sqlite çæ token
  - ä¸ä½¿ç¨ JWTï¼ä»å Token æ ¡éª
- langchain 1.2.6ï¼ä½¿ç¨ create_agent
- langchain-ollama 1.0.1
  - modelï¼qwen3-vl:32b
  - embeddingï¼qwen3-embedding:8b
- langgraph 1.0.6
- Milvusï¼pymilvusï¼2.6.6
- langfuse 3.12.0
</code></pre>
<p>éè¿è¿ç§æ¹å¼ï¼ä½ æ¯å¨<strong>æç¡®åè¯ Claude</strong>ï¼</p>
<blockquote>
<p>ä¸è¦é âå°è±¡âåä»£ç ï¼èæ¯<strong>ä»¥å½åå®æ¹ææ¡£ä¸ºå</strong>ã</p>
</blockquote>
<p><img alt="PixPin_2026-01-22_10-29-45.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3715916/202601/3715916-20260122104737572-1611726017.png" class="lazyload"></p>
<hr>
<h1 id="äºå®éä½éªä¸é®é¢åæ">äºãå®éä½éªä¸é®é¢åæ</h1>
<h2 id="çå®ç»è®ºåªæä¸å¥è¯">çå®ç»è®ºåªæä¸å¥è¯ï¼</h2>
<blockquote>
<p><strong>ææææ¾æåï¼ä½ä¾ç¶ä¸è½âä¸æ¬¡çæç´æ¥å¯ç¨âã</strong></p>
</blockquote>
<h2 id="ä¼ç¹">ä¼ç¹</h2>
<ul>
<li>API ä½¿ç¨ææ¾æ´æ¥è¿ææ°ææ¡£</li>
<li>è¿æ¶åæ°ãåºå¼æ¹æ³æ¾èåå°</li>
<li>å·¥ç¨ç»ææ´åçï¼æè·¯æ´ååâçå®é¡¹ç®â</li>
</ul>
<h2 id="ä»ç¶å­å¨çé®é¢">ä»ç¶å­å¨çé®é¢</h2>
<ul>
<li>å¤æææ¯æ ç»åï¼LangChain + LangGraph + Milvus + Langfuseï¼</li>
<li>ä»ç¶éè¦ <strong>å¤è½®è°è¯æè½å®å¨è·é</strong></li>
<li>æäºè¾¹çç¨æ³ä¾ç¶å­å¨åå·®</li>
</ul>
<h2 id="æçå¤æ­">æçå¤æ­</h2>
<blockquote>
<p><strong>å¹¶ä¸æ¯ context7 ä¸è¡ï¼èæ¯æ¨¡åçæéåº¦ï¼ä¾ç¶è½åäºæ¡æ¶æ¼è¿éåº¦ã</strong></p>
</blockquote>
<p>context7 åå°çæ¯ï¼</p>
<ul>
<li>è®© Claude <em>çå¾å°</em> ææ°ææ¡£</li>
<li>ä½æç»âæä¹æ¼èµ·æ¥âï¼ä»ç¶ä¾èµæ¨¡åæ¬èº«çæ¨çä¸ä»£ç è½å</li>
</ul>
<hr>
<h1 id="å­æ»ç»">å­ãæ»ç»</h1>
<p>å¦æä½ æ­£å¨ä½¿ç¨ Claude Code ååå·¥ç¨åãåä¼ä¸çº§çé¡¹ç®å¼åï¼æçå»ºè®®æ¯ï¼</p>
<p>â <strong>ä¸å®è¦ä¸ Agent Skills</strong></p>
<p>â <strong>è½ç¨ context7 å°±ç¨ context7</strong></p>
<p>â ä¸è¦åå®å¨ç¸ä¿¡âæ¨¡åè®°å¿éç APIâ</p>
<p>ä½åæ¶ä¹è¦æä¸ä¸ªæ¸éè®¤ç¥ï¼</p>
<blockquote>
<p><strong>AI è¾å©å¼å = æ´å¿«çèµ·ç¹ï¼èä¸æ¯åè°è¯çç»ç¹ã</strong></p>
</blockquote>
<p>å¨å½åé¶æ®µï¼æçæ³çæ¨¡å¼ä¾ç¶æ¯ï¼</p>
<blockquote>
<p><strong>AI çæ + äººç±» Review + å¤è½®ä¿®æ­£</strong></p>
</blockquote>
<p>åç»­æä¹ä¼ç»§ç»­è®°å½ Claude Code + MCP + å¤æ¨¡ååä½ çå®è·µç»éªï¼æ¬¢è¿å³æ³¨ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-22 10:56">2026-01-22 10:55</span>&nbsp;
<a href="https://www.cnblogs.com/bugshare">BugShare</a>&nbsp;
éè¯»(<span id="post_view_count">71</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19515937);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19515937', targetLink: 'https://www.cnblogs.com/bugshare/p/19515937', title: 'Claude Code æ¯æéç£æ©å± Skills ââ ç¨ææ° API æå»ºæ´é è°±ç AI é¡¹ç®' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ç»æåå¼ï¼ä¸ä¼å¤§æ¨¡åå æççæ³æ¸¸æï¼äººç±»èçç«ä¸è¶³10%ï¼ ]]></title>
    <link>https://www.cnblogs.com/greywen/p/19512202</link>
    <guid>3cc1d48c9fd49e79bc4a58faecc2125b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/greywen/p/19512202" title="åå¸äº 2026-01-22 08:29">
    <span role="heading" aria-level="2">ç»æåå¼ï¼ä¸ä¼å¤§æ¨¡åå æççæ³æ¸¸æï¼äººç±»èçç«ä¸è¶³10%ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>åºäº LLM + Next.js çåå¼å®æçæ³æ¸¸æ</h1>
<p><strong>æè¦</strong>ï¼å½ä½ ä»¥ä¸ºèªå·±å¨åéæºæ°çæå¨ç©æ¸¸ææ¶ï¼å¯¹é¢ç AI æ­£å¨éè¯»ä½ ææçåå²åºæ³è®°å½ï¼å¹¶åäºä¸ç¯å³äºä½ å¿çç¶æçå°ä½æãæ¬æå¸¦ä½ æè§£è¿ä¸ªåºäº Next.js 16 + Tailwind v4 + LLM çâè¿åº¦è®¾è®¡â+âæ²¡å¥ææ¯å«éâ+âæé£ä¹ç¹ææâé¡¹ç®ã</p>
<p>ð <strong>åç»èæ¿ä»¬ä½éª:ï¼å·ä½è§åææå°±è½ç©ï¼ï¼</strong></p>
<p>ä¼åå°åï¼<a href="https://rps.anhejin.cn" target="_blank" rel="noopener nofollow">https://rps.anhejin.cn</a></p>
<p>ææ¡ä»¶çï¼<a href="https://rps-eta-ten.vercel.app" target="_blank" rel="noopener nofollow">https://rps-eta-ten.vercel.app<br></a></p>
<p><img alt="image" width="752" height="423" loading="lazy" data-src="https://img2024.cnblogs.com/blog/809672/202601/809672-20260121154520537-280291882.png" class="lazyload"></p>
<hr>
<p>æè¿é²çæ²¡äºï¼çªç¶æ³è¿ç¨AIåç¹ä»£ç ãä½ä¸ºä¸åè¦æâç®åéæ±å¤æåâå»å¨ DNA éçèåç«¯ï¼æå³å®æ¿æç®åçâåªåç³å¤´å¸âå¼åã</p>
<p>å¨è¿ä¸ª AI æ»¡å¤©é£çæ¶ä»£ï¼è¿å¨ç¨ <code>Math.random()</code> åå¯¹æé»è¾æªåå¤ªæ²¡è¿½æ±äºãäºæ¯ï¼æåºäºææ°çææ¯æ ï¼Next.js 16 + React 19ï¼ï¼æ¥å¥äº OpenAIç­ä¸ä¼å¤§æ¨¡åï¼æåºäºä¸ä¸ªä¼âè¯»å¿âãä¼å²è®½ï¼çè³æåå¼è®ºççæ³æ¸¸æã</p>
<h2>ä¸ºä»ä¹æ¯åªåç³å¤´å¸ï¼</h2>
<p>å«ç¬ï¼åªåç³å¤´å¸å¶å®æ¯ä¸ä¸ªæä½³çåå¼è®ºæ¨¡åã</p>
<ul>
<li><strong>æ°æ</strong>ï¼å®å¨éæºï¼Chaosï¼ã</li>
<li><strong>æ®éäºº</strong>ï¼èµ¢äºä¿æï¼è¾äºåæï¼Win-Stay, Lose-Shiftï¼ã</li>
<li><strong>é«æ</strong>ï¼é¢å¤ä½ çé¢å¤ã</li>










</ul>
<p>æçç®æ æ¯ï¼<strong>æå»ºä¸ä¸ªè½çç©¿ä½ å¿çç AIï¼å¹¶ä¸ç¨ç®åæåæ²¿çåç«¯ææ¯æ æå®è·èµ·æ¥ã</strong></p>
<h2>ææ¯éåï¼è¿å°±å«âæé¸¡ç¨çåâ</h2>
<p>ä¸ºäºéå¾ä¸è¿ä¸ªâé«æºåâAIï¼æå¨ææ¯æ ä¸ç´æ¥ææ»¡ï¼å¨é¨éç¨äºç®åï¼2025-2026ï¼çææ°ç¨³å®çï¼</p>
<ol>
<li><strong>Next.js 16.1 (App Router)</strong>ï¼æå¡ç«¯ç»ä»¶ï¼RSCï¼å¤çæ ¸å¿é»è¾ï¼éè AI ç Promptï¼ä¿è¯ä½ æ²¡æ³éè¿ F12 å·çç­æ¡ã</li>
<li><strong>React 19</strong>ï¼äº«åææ°ç Hooks åå¹¶åç¹æ§ã</li>
<li><strong>Tailwind CSS v4</strong>ï¼å¯¹ï¼å°±æ¯é£ä¸ªä¸ç¨éç½®æå»ºå·¥å·ãæ§è½èµ·é£ç v4 çæ¬ãå³é®æ¯AIåæ¬¢ç¨è¿ä¸ª</li>
<li><strong>SQLite + LibSQL</strong>ï¼è½»éçº§æ°æ®åºï¼ç¨æ¥è®°ä»ââåä¸ï¼è®°å½ä½ çèè´æ°æ®ã</li>










</ol>
<h2>æ ¸å¿ç©æ³ï¼AI æ¯æä¹âè¯»å¿âçï¼</h2>
<p>è¿ä¸ªé¡¹ç®çæ ¸å¿ä¸å¨äº UI æå¤ç«ï¼è½ç¶ Tailwind 4 ç¡®å®å¾æ¶¦ï¼ï¼èå¨äº <code>/lib/ai-service.ts</code> éçé£æ®µé»è¾ã</p>
<p>ä¼ ç»çæ¸¸æ AI å¾å¾æ¯é¢è®¾å¥½ç <code>if-else</code>ãä½å¨æçè®¾è®¡éï¼æ¯ä¸è½®æ¸¸æï¼æé½ä¼æä½ å¨è¿ä¸ª Session éçææåå²è®°å½æåï¼åè®²æäºä¸æ ·åç» LLMï¼å¤§è¯­è¨æ¨¡åï¼ï¼</p>
<pre><code class="language-typescript">
// lib/ai-service.ts

// æå»ºæ¸¸æåå²æè¿°
const historyDescription = history.length &gt; 0
  ? history.map((h) =&gt;
      `ç¬¬${h.round}è½®: ç©å®¶åº${translateChoice(h.player_choice)}, 
       AIåº${translateChoice(h.ai_choice)}, 
       ç»æ: ${translateResult(h.result)}`
    ).join("\n")
  : "è¿æ¯ç¬¬ä¸è½®ï¼æ²¡æåå²è®°å½ã";

// ...åéç» LLM
const response = await client.chat.completions.create({
  messages: [
    { role: "system", content: systemPrompt },
    { role: "user", content: userPrompt }, // è¿éåå«äº historyDescription
  ],
  // ...
});
</code></pre>
<blockquote>
<p>System: ä½ æ¯ä¸ä¸ªçæ³é«æï¼ä½ çå¯¹ææ¯ä¸ä¸ªæ®éäººç±»ã<br>
User: åå è½®æåµå¦ä¸ï¼ç¬¬1è½®ç©å®¶åºåªåï¼ä½ åºå¸ï¼è¾ï¼ï¼ç¬¬2è½®ç©å®¶åºç³å¤´ï¼ä½ åºå¸ï¼èµ¢ï¼ãç°å¨æ¯ç¬¬3è½®ï¼è¯·åæç©å®¶çå¿çï¼å¹¶ç»åºä½ çåºæ³ã</p>












</blockquote>
<p><strong>ä¸ä»å¦æ­¤ï¼æç» AI è®¾å®äºä¸¤ç§æ¨¡å¼ï¼</strong></p>
<ol>
<li><strong>ç­ç¥æ¨¡å¼ï¼Strategyï¼</strong>ï¼éä½æ¨¡åç <code>temperature</code>ï¼éæºæ§ï¼ï¼è®©å®è¿è¡ä¸¥å¯çé»è¾æ¨çãæ¯å¦å®ä¼åæï¼âç©å®¶ä¸ä¸æè¾äºï¼æ ¹æ®å¿çå­¦ï¼è¿æä»å¤§æ¦çä¼åºåå¶æä¸ä¸æçææ°ï¼æä»¥æé¢å¤ä»â¦â¦â</li>
<li><strong>æ··æ²æ¨¡å¼ï¼Chaosï¼</strong>ï¼æé« <code>temperature</code>ï¼è®© AI å½»åºæ¾é£èªæï¼ä¸»æä¸ä¸ªä¹±æ³ææ­»èå¸åã</li>












</ol>
<h2>ä¼ééçº§ï¼å½ GPT èå¹²ç¼ºå¤±æ¶</h2>
<p>ä½ä¸ºèå¨æ ï¼å¿é¡»è¦èèä¸ç§æåµï¼<strong>å¦æ API æäºï¼æèååºè¶æ¶äºæä¹åï¼</strong></p>
<p>é¾éè®©ç¨æ·å¹²ç­çè½¬ååï¼ç»å¯¹ä¸è¡ã</p>
<p>æå¨åç«¯å®ç°äºä¸å¥åºäºä¼ ç»ç»è®¡å­¦ç<strong>æ¬å°ç®æ³</strong>ä½ä¸ºâå¤èâãå¦æ LLM å¨è§å®æ¶é´åæ²¡æååºï¼ç³»ç»ä¼æ ç¼åæ¢å°æ¬å°é»è¾ãè¿ä¸ªæ¬å°é»è¾ä¸ç¹ä¹ä¸å¼±ï¼å®åç½®äºç»å¸çç­ç¥åºï¼ä»£ç å¨ <code>lib/game.ts</code>ï¼ï¼</p>
<pre><code class="language-typescript">
// lib/game.ts éçå¿çå­¦åå¼é»è¾

// 1. å¦æç©å®¶ä¸è½®è¾äºï¼å¾åäºåºè½åå¶AIä¸ä¸æçéé¡¹ (Win-Stay, Lose-Shiftçåç§)
if (lastResult === 'ai_win') {
  const lastAIChoice = lastRound.ai_choice as Choice;
  // é¢æµç©å®¶ä¼åºåå¶æä¸ä¸ä¸æçç
  const predictedPlayerChoice = whatBeatsAI[lastAIChoice];
  // é£æå°±é¢å¤ä½ çé¢å¤
  return counterMoves[predictedPlayerChoice];
}

// 2. å¦æç©å®¶ä¸è½®èµ¢äºï¼å¯è½ç»§ç»­ç¨åä¸æ
if (lastResult === 'player_win') {
  // ç©å®¶å¯è½ç»§ç»­ç¨åä¸æï¼ç´æ¥åå¶å®
  return counterMoves[lastPlayerChoice];
}
</code></pre>
<p>è¿äºç­ç¥åæ¬ï¼</p>
<ul>
<li><strong>é¢çåæ</strong>ï¼å¦æä½ ä¸ç´åºç³å¤´ï¼å®å°±ä¼ç¯çåºå¸ã</li>
<li><strong>åå¶è¿è</strong>ï¼å¦æä½ èµ¢äºï¼å®ä¼åè®¾ä½ ä¼ç»§ç»­åºä¸æ ·çï¼ç´æ¥åå¶ä½ ã</li>
</ul>
<p>å¨ä»£ç å®ç°ä¸ï¼è¿åªæ¯ä¸ä¸ªç®åç <code>try-catch</code> éçº§ï¼ä½å¯¹ç¨æ·ä½éªæ¥è¯´æ¯è´¨çé£è·ãç¨æ·æ ¹æ¬æè§ä¸å° AI æçº¿äºï¼åªä¼æè§âè¿å®¶ä¼æä¹åé£æ ¼äºï¼â</p>
<h2>å¨æ ä½éªï¼Next.js App Router çä¸æ»</h2>
<p>å¨ Next.js 16 ä¸­ï¼ååç«¯çè¾¹çåå¾éå¸¸æ¨¡ç³ï¼è¤ä¹ï¼ãæ¬é¡¹ç®ä½¿ç¨äº App Router ç Route Handlers æ¥å¤çæ¸¸æé»è¾ã</p>
<p>åç«¯ç»ä»¶è°ç¨åç«¯æ¥å£å°±åè°ç¨æ¬å°å½æ°ä¸æ ·èªç¶ï¼</p>
<pre><code class="language-typescript">
// src/app/game/[id]/page.tsx
const playRound = useCallback(async (choice: Choice | null, timeout: boolean = false) =&gt; {
    // ...
    const res = await fetch('/api/game/play', {
        method: 'POST',
        body: JSON.stringify({ /*...*/ }),
    });
    // ...
}, []);
</code></pre>
<p>èå¨æå¡ç«¯ (<code>src/app/api/game/play/route.ts</code>)ï¼æä»¬å®æäºå®æ´çä¸å¡é­ç¯ï¼</p>
<pre><code class="language-typescript">
// src/app/api/game/play/route.ts
export async function POST(request: NextRequest) {
    // 1. èº«ä»½æ ¡éªä¸æ°æ®åºè¯»å
    const { sessionId, playerChoice } = await request.json();
    const baseSession = await db.execute(/*...*/);

    // 2. è°ç¨ AI (å¸¦è¶æ¶éçº§)
    // å¦æ API ååºå¤ªæ¢ï¼è¿éä¼èªå¨åæ¢å°æ¬å°é»è¾
    const aiChoiceResult = await Promise.race([
        getAIChoiceFromAPI(aiConfig, history, difficulty),
        timeoutPromise // è®¾å®çè¶æ¶æ¶é´
    ]);

    // 3. å¤å®èè´ &amp; åå¥æ°æ®åº
    const result = determineWinner(playerChoice, aiChoiceResult.choice);
    // ...
    
    return NextResponse.json({ /*...*/ });
}
</code></pre>
<p>è¿ä¸å¥æµç¨è¡äºæµæ°´ï¼ç±»åå®å¨è½ç¶ä¸å¦ Server Actions æè´ï¼ä½éè¿å±äº«ç±»åå®ä¹ï¼Shared Typesï¼ï¼ä¾ç¶è½ä¿è¯ååç«¯çä¸è´æ§ãä¸ç¨åç¹çç Swaggerï¼ä¸ç¨æå¤æç Reduxï¼ä¸ææ¢­ã</p>
<h2>å®éä¸æï¼ç±äºå¤ªä¼å²è®½å¯¼è´ä¸æ³ç©äº</h2>
<p>ä¸ºäºå¢å è¶£å³æ§ï¼æè®© AI ä¸ä»è¾åºâç³å¤´/åªå/å¸âï¼è¿è¦è¾åºä¸æ®µ <strong>Reasoningï¼æ¨çè¿ç¨ï¼</strong> å <strong>Commentï¼èµåå²è®½ï¼</strong>ã</p>
<p>å½ä½ è¾ææ¯èµæ¶ï¼ä½ å¯è½ä¼çå°è¿æ ·çç»ç®è¯­ï¼<br>
<em>âæçä½ ç¬¬ä¸æç¹è±«äºå¾ä¹åºäºåªåï¼æå°±ç¥éä½ æ¯ä¸ªä¿å®çäººãä¸ä¸æå«è¿ä¹ææ¾äºï¼äººç±»ãâ</em></p>
<p>è¯´å®è¯ï¼ä»£ç åå®åæèªå·±æµè¯äºå æï¼èçå±ç¶åªæ 40% å·¦å³ãççå±å¹ä¸ AI çå²è®½ï¼æå³ä½¿ä½ä¸ºå¼åèä¹ä¸ç¦æçï¼è¿ç©æå¿æ¯ä¸æ¯çææè¯ï¼</p>
<h2>ä½éªå°å</h2>
<p>è½è¯´ä»£ç æ²¡ä»ä¹æ ¸å¿ç§æï¼ä½å¸¦æ¥çåå¼ä½éªç¡®å®å¾æè¶£ãæå·²ç»æé¡¹ç®é¨ç½²ä¸å»äºï¼æ¬¢è¿æ¥ææï¼æèè¢«èï¼ï¼</p>
<p>ð <strong>å¨çº¿ä½éª</strong></p>
<p>ä¼åå°åï¼<a href="https://rps.anhejin.cn" target="_blank" rel="noopener nofollow">https://rps.anhejin.cn</a></p>
<p>ææ¡ä»¶çï¼<a href="https://rps-eta-ten.vercel.app" target="_blank" rel="noopener nofollow">https://rps-eta-ten.vercel.app<br></a></p>
<h2>æ»ç»</h2>
<p>è¿ä¸ªé¡¹ç®è¯æäºä¸ä»¶äºï¼<strong>ææ¯æ¯å°å·çï¼ä½éè¿ç®åçåæç»åï¼å¯ä»¥åé åºææ¸©åº¦ï¼çè³æç¹ç«æï¼çäº¤äºä½éªã</strong> Next.js 16 å React 19 çç»åè®©å¨æ å¼åçé¨æ§è¿ä¸æ­¥éä½ï¼è®©æä»¬ææ´å¤ç²¾åå»å³æ³¨âç©æ³âæ¬èº«ï¼èä¸æ¯è¢«æå»ºéç½®æç£¨ã</p>
<p>å¦æä½ å¯¹æºç æå´è¶£ï¼æèæ³æ¹æ¹ Prompt æ AI è°ææâè®¨å¥½åäººæ ¼âï¼æ¬¢è¿å» <a href="https://github.com/greywen/rps" rel="noopener nofollow">GitHub</a> æä»£ç ã</p>
<hr>
<p><em>æ³¨ï¼</em></p>
<ol>
<li>æ¬æä»ä¾ææ¯äº¤æµï¼ç©æ¸¸æè¾ç» AI è¯·å¿ç¨æ³å¤´å»ææ¾ç¤ºå¨ï¼å¼åèæ¦ä¸è´è´£ã</li>
<li>è¿åªæ¯ä¸ä¸ªå¨±ä¹å°æ¸¸æï¼ç»æå·æéæºæ§ï¼ä¸ä»£è¡¨ä»»ä½AIå¤§æ¨¡åççå®è½åã</li>
<li>æ¸¸æç»æä»ä¾å¨±ä¹ï¼ä¸åºç¨äºè¯ä¼°ææ¯è¾AIæ¨¡åçå®éæ§è½ã</li>
<li>ç½ç«ä¸æ¶éãå­å¨æåäº«ä»»ä½ä¸ªäººä¿¡æ¯æç¨æ·æ°æ®ã</li>












</ol>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-22 08:30">2026-01-22 08:29</span>&nbsp;
<a href="https://www.cnblogs.com/greywen">æè¿å¶å®</a>&nbsp;
éè¯»(<span id="post_view_count">468</span>)&nbsp;
è¯è®º(<span id="post_comment_count">7</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19512202);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19512202', targetLink: 'https://www.cnblogs.com/greywen/p/19512202', title: 'ç»æåå¼ï¼ä¸ä¼å¤§æ¨¡åå æççæ³æ¸¸æï¼äººç±»èçç«ä¸è¶³10%ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ AspNetCoreå¼åç¬è®°ï¼WebApié¡¹ç®éæä¼ä¸å¾®ä¿¡åå¬ä¼å· ]]></title>
    <link>https://www.cnblogs.com/deali/p/19514332</link>
    <guid>848fcc3ce933b2c8fe4c8934bbd61bfa</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/deali/p/19514332" title="åå¸äº 2026-01-21 23:16">
    <span role="heading" aria-level="2">AspNetCoreå¼åç¬è®°ï¼WebApié¡¹ç®éæä¼ä¸å¾®ä¿¡åå¬ä¼å·</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="åè¨">åè¨</h2>
<p>å¾ä¹æ²¡åæç« äºï¼ç°å¨æäºAIï¼å¶å®å·²ç»ä¸æä¹éè¦åæç« ï¼åæ­£ä¸æå°±é®AIåã</p>
<p>ä¸è¿AIæ»æ¯æç²åºçï¼å°±æ¯å¦å½åçå¾®ä¿¡å¼åã</p>
<p>å¾®ä¿¡çææ¡£æ¯å¬è®¤ççï¼èä¸ç»å¸¸æåªåªæ¹æ¥å£åä¸æ´æ°ææ¡£ï¼æä»¥AIå¯¹å¾®ä¿¡å¼åçAPIå¶å®ä¸æä¹çæï¼ç»å¸¸ç»åºä¸äºéè¯¯çåå¤ã</p>
<p>æ¬æè®°å½ä¸ä¸æè¿æä½¿ç¨ C# WebApi é¡¹ç®æ¥å¥ä¼ä¸å¾®ä¿¡åå¬ä¼å·çè¿ç¨ï¼ä¸»è¦æ¯ç¨å°èªå¨åå¤åè½ã</p>
<h2 id="åç½®å·¥ä½">åç½®å·¥ä½</h2>
<h3 id="ä¾èµåº">ä¾èµåº</h3>
<p>æç¨å°äº <strong>SKIT.FlurlHttpClient.Wechat</strong> è¿ä¸ªç³»åçåºï¼<a href="https://github.com/fudiwei/DotNetCore.SKIT.FlurlHttpClient.Wechat" target="_blank" rel="noopener nofollow">https://github.com/fudiwei/DotNetCore.SKIT.FlurlHttpClient.Wechat</a></p>
<p>åæ¬æ³ç´æ¥ç¨ Flurl å¯¹æ¥çï¼æ¯ç«ç°å¨æéæäºé¤å­ï¼AIï¼ï¼çå¥é½æ¯éå­ï¼å¥é½æ³é è½®å­ã</p>
<p>ä¸è¿æäºä¸ä¸æçæ¶èå¤¹ï¼åç°æè¿ä¸ªé¡¹ç®ï¼å°è£äºå¾®ä¿¡çå¤§é¨åæ¥å£ï¼é£è¿è¦å¥èªè¡è½¦ï¼ç´æ¥ç¨å°±å®äºå¿äºã</p>
<p>å¶ä¸­ï¼</p>
<ul>
<li>ä¼ä¸å¾®ä¿¡ï¼SKIT.FlurlHttpClient.Wechat.Work</li>
<li>å¬ä¼å·ï¼SKIT.FlurlHttpClient.Wechat.Api</li>
</ul>
<h3 id="å¾®ä¿¡éç½®ä¿¡æ¯">å¾®ä¿¡éç½®ä¿¡æ¯</h3>
<p>éè¦åå¤è¿äºéç½®ä¿¡æ¯ï¼</p>
<p>ä¼ä¸å¾®ä¿¡ï¼</p>
<pre><code class="language-c#">public class WechatWorkOptions {
    public string CorpId { get; set; } = string.Empty;
    // åºç¨ID
    public int AgentId { get; set; }
    // åºç¨å¯é¥
    public string Secret { get; set; } = string.Empty;
    // åè° Token
    public string CallbackToken { get; set; } = string.Empty;
    // åè° EncodingAESKey
    public string CallbackEncodingAESKey { get; set; } = string.Empty;
}
</code></pre>
<p>å¬ä¼å·ï¼</p>
<pre><code class="language-c#">public class WechatApiClientOptions {
    public string AppId { get; set; } = string.Empty;
    public string AppSecret { get; set; } = string.Empty;
    public string CallbackToken { get; set; } = string.Empty;
    public string CallbackEncodingAESKey { get; set; } = string.Empty;
}
</code></pre>
<h3 id="æ³¨åæå¡">æ³¨åæå¡</h3>
<pre><code class="language-c#">// ä¼ä¸å¾®ä¿¡
builder.Services.AddSingleton&lt;WechatWorkClient&gt;(sp =&gt; {
    var options = sp.GetRequiredService&lt;IOptions&lt;WechatWorkOptions&gt;&gt;().Value;
    return WechatWorkClientBuilder.Create(options).Build();
});

// å¬ä¼å·
builder.Services.AddSingleton&lt;WechatApiClient&gt;(sp =&gt; {
    var options = sp.GetRequiredService&lt;IOptions&lt;WechatMpOptions&gt;&gt;().Value;
    return WechatApiClientBuilder.Create(options).Build();
});
</code></pre>
<p>åå¤å·¥ä½å°±æå®äºã</p>
<h2 id="ç®¡çtoken">ç®¡çtoken</h2>
<p>å¾®ä¿¡çæ¥å£é½éè¦ç¨ AccessToken æè½è°ç¨ï¼ä½å¾®ä¿¡åä¸æ³å¼åèæ¯æ¬¡é½å»è¯·æ±è·åtokenï¼æä»¥åªè½è·åä¸æ¬¡ç¶åèªå·±ä¿å­äºã</p>
<p>C# å¯ä»¥ç¨ IMemoryCache ç»ä»¶ï¼å¾æ¹ä¾¿çç®¡çè¿äºä¸´æ¶å­å¨çæ°æ®ï¼Djangoæ¡æ¶ä¹æåç½®çcacheæºå¶ï¼å¶ä»è¯­è¨æ¡æ¶å¯ä»¥ç¨Redisè¿ç±»NoSQLæ°æ®åºæ¥å­å¨ãæ¯è¿äºï¼æ¬æè¿æ¯ä»ç»C#çã</p>
<p>æç¨ä¸ä¸ª <code>WechatWorkTokenService</code> æå¡æ¥ç®¡çä¼ä¸å¾®ä¿¡çtokenï¼å¬ä¼å·ãå°ç¨åºè¿ç§ä¹æ¯åçï¼</p>
<pre><code class="language-c#">public class WechatWorkTokenService(
    WechatWorkClient client,
    IMemoryCache cache,
    IOptions&lt;WechatWorkOptions&gt; options
) : IWechatWorkTokenService {
    private const string CacheKey = "WechatWorkAccessToken";

    // ç¨äºå¹¶åæ§å¶ï¼é²æ­¢ç¬é´é«å¹¶åå¯¼è´å¤æ¬¡è¯·æ± Token æ¥å£
    private static readonly SemaphoreSlim Semaphore = new SemaphoreSlim(1, 1);

    /// &lt;summary&gt;
    /// è·å AccessToken
    /// &lt;/summary&gt;
    public async Task&lt;string&gt; GetAccessTokenAsync(CancellationToken cancellationToken = default) {
        // 1. å°è¯ä»ç¼å­è·å
        if (cache.TryGetValue(CacheKey, out string? accessToken) &amp;&amp; !string.IsNullOrEmpty(accessToken)) {
            return accessToken;
        }

        // 2. ç¼å­æªå½ä¸­ï¼å éè¯·æ±
        await Semaphore.WaitAsync(cancellationToken);
        try {
            // åéæ£æ¥ï¼é²æ­¢æéç­å¾ççº¿ç¨åæ¬¡è¯·æ±
            if (cache.TryGetValue(CacheKey, out accessToken) &amp;&amp; !string.IsNullOrEmpty(accessToken)) {
                return accessToken;
            }

            // 3. è°ç¨æ¥å£è·å Token
            var request = new CgibinGetTokenRequest();
            var response = await client.ExecuteCgibinGetTokenAsync(request, cancellationToken);

            if (!response.IsSuccessful()) {
                throw new Exception($"è·å AccessToken å¤±è´¥: {response.ErrorMessage} (Code: {response.ErrorCode})");
            }

            accessToken = response.AccessToken;

            // 4. è®¾ç½®ç¼å­
            // æå 5 åéè¿æï¼ç¡®ä¿å¨è¿æåå·æ°
            // å¦æ ExpiresIn å°äº 300 ç§ï¼åè®¾ä¸ºä¸åæ¶é´
            var expirySeconds = response.ExpiresIn &gt; 300 ? response.ExpiresIn - 300 : response.ExpiresIn / 2;
            var cacheEntryOptions = new MemoryCacheEntryOptions()
                .SetAbsoluteExpiration(TimeSpan.FromSeconds(expirySeconds));

            cache.Set(CacheKey, accessToken, cacheEntryOptions);

            return accessToken;
        }
        finally {
            Semaphore.Release();
        }
    }
}
</code></pre>
<h2 id="ä¼ä¸å¾®ä¿¡">ä¼ä¸å¾®ä¿¡</h2>
<p>ä¼ä¸å¾®ä¿¡çéå¶æ¯è¾å°ï¼å¯ä»¥ä¸»å¨ç»ç¨æ·åä¿¡æ¯ï¼æä»¥å¯ä»¥ææ¥æ¶ååéä¿¡æ¯åå¼ï¼ä¾å¦è°ç¨LLMå¤çåå¤çæ¶åï¼ä¼æ¯è¾æ¢ï¼å¯ä»¥æåå¤æ¾å°å¼æ­¥ä»»å¡éåéå»å®ç°ã</p>
<h3 id="éªè¯åè°">éªè¯åè°</h3>
<p>ç´æ¥ä¸æ¥å£ä»£ç ã</p>
<p>å¨éç½®ä¼ä¸å¾®ä¿¡åºç¨URLçæ¶åï¼å¾®ä¿¡æå¡å¨ä¼åéä¸ä¸ªGETè¯·æ±å°éç½®çURLè¿è¡éªè¯ï¼åç«¯ç¨åºéè¦éªè¯ç­¾åï¼è§£å¯åæåå®¹å¤è¯»ç»å¾®ä¿¡æå¡å¨ã</p>
<p>ä¸é¢è¿ä¸ªæ¥å£å°±å®ç°äºè¿ä¸ªéªè¯æ¹æ³ã</p>
<p>è¿æ ·å®ç°ä¹åå¡«å <code>https://example.com/api/wechat/work/callback</code> è¿ä¸ªå°åå°±å¥½äºã</p>
<pre><code class="language-c#">[ApiController]
[AllowAnonymous]
[Route("api/wechat/work/callback")]
public class WechatWorkController(
    WechatWorkClient client,
    IBackgroundTaskQueue queue,
    ILogger&lt;WechatWorkController&gt; logger
) : ControllerBase {
    /// &lt;summary&gt;
    /// åè°éªè¯ (GET)
    /// &lt;/summary&gt;
    [HttpGet]
    public IActionResult Echo(
        [FromQuery(Name = "msg_signature")] string msgSignature,
        [FromQuery(Name = "timestamp")] string timestamp,
        [FromQuery(Name = "nonce")] string nonce,
        [FromQuery(Name = "echostr")] string echoStr
    ) {
        // éªè¯ç­¾å
        var verifyResult = client.VerifyEventSignatureForEcho(
            timestamp, nonce, echoStr, msgSignature, out string? replyEcho
        );

        if (verifyResult.Result) {
            logger.LogInformation("Echo verification successful. ReplyEcho: {ReplyEcho}", replyEcho);
            return Content(replyEcho ?? string.Empty);
        }

        logger.LogWarning("Echo verification failed. Error: {Error}", verifyResult.Error?.Message);
        return BadRequest($"Verify signature failed: {verifyResult.Error?.Message}");
    }
}
</code></pre>
<h3 id="æ¥æ¶ä¿¡æ¯">æ¥æ¶ä¿¡æ¯</h3>
<p>æ¥æ¶ä¿¡æ¯åä¸é¢çéªè¯é½æ¯ä¸ä¸ªURLï¼åºå«æ¯æ¥æ¶ä¿¡æ¯æ¶ï¼å¾®ä¿¡æå¡å¨ä¼åURLåPOSTè¯·æ±ã</p>
<p>ä»£ç éæè¯¦ç»æ³¨éäºï¼åºè¯¥ä¸ç¨è§£éå¤ªå¤ã</p>
<pre><code class="language-c#">/// &lt;summary&gt;
/// æ¥æ¶æ¶æ¯ (POST)
/// &lt;/summary&gt;
[HttpPost]
public async Task&lt;IActionResult&gt; Callback(
    [FromQuery(Name = "msg_signature")] string msgSignature,
    [FromQuery(Name = "timestamp")] string timestamp,
    [FromQuery(Name = "nonce")] string nonce
) {
    // å¿é¡»è¯»ååå§ Request Body æµï¼èä¸è½ä½¿ç¨ [FromBody] ç»å®
    // åå ï¼
    // 1. å¾®ä¿¡ç­¾åéªè¯ä¾èµäºåå§è¯·æ±ä½ï¼ä»»ä½ç©ºæ ¼ãæ¢è¡ç¬¦çå·®å¼é½ä¼å¯¼è´ç­¾åæ ¡éªå¤±è´¥
    // 2. æ¨éåå®¹éå¸¸æ¯å å¯ç XMLï¼éè¦åè·ååå§å­ç¬¦ä¸²ä¼ ç» SDK è¿è¡è§£å¯
    using var reader = new StreamReader(Request.Body);
    var xml = await reader.ReadToEndAsync();

    logger.LogDebug("Callback Body (Length: {Length}): {Xml}", xml.Length, xml);

    // 1. éªè¯ç­¾å
    // è½ç¶ DeserializeEventFromXml åé¨å¯è½ä¼åå«è§£å¯è¿ç¨ï¼ä½æ¾å¼éªè¯ç­¾åæ¯æ´å®å¨çåæ³
    var verifyResult = client.VerifyEventSignatureFromXml(timestamp, nonce, xml, msgSignature);
    if (!verifyResult.Result) {
        logger.LogWarning("Callback signature verification failed. Error: {Error}", verifyResult.Error?.Message);
        return BadRequest($"Verify signature failed: {verifyResult.Error?.Message}");
    }

    // 2. ä½¿ç¨ SKIT åºæä¾çæ©å±æ¹æ³èªå¨è§£å¯å¹¶ååºåå
    // æ³¨æï¼éè¦å¨ WechatWorkClientOptions ä¸­éç½® PushToken å PushEncodingAESKey
    WechatWorkEvent wechatEvent;
    try {
        wechatEvent = client.DeserializeEventFromXml(xml);
        logger.LogInformation("Callback deserialized successfully. MessageType: {MessageType}, FromUser: {FromUser}, ToUser: {ToUser}", wechatEvent.MessageType, wechatEvent.FromUserName, wechatEvent.ToUserName);
    } catch (Exception ex) {
        // ååºååå¤±è´¥ï¼éå¸¸æ¯å ä¸ºç­¾åéªè¯å¤±è´¥æè§£å¯å¤±è´¥ï¼
        logger.LogError(ex, "Callback deserialization failed.");
        return BadRequest($"Deserialization failed: {ex.Message}");
    }

    // å¤çé»è¾
    if (string.Equals(wechatEvent.MessageType, "TEXT", StringComparison.OrdinalIgnoreCase)) {
        // åæ¬¡ååºååä¸ºå·ä½çææ¬æ¶æ¯äºä»¶ä»¥è·å Content
        var textEvent = client.DeserializeEventFromXml&lt;TextMessageEvent&gt;(xml);
        if (textEvent != null &amp;&amp; !string.IsNullOrEmpty(textEvent.Content) &amp;&amp;
            !string.IsNullOrEmpty(textEvent.FromUserName)) {
            logger.LogInformation("Processing TEXT message from {FromUser}: {Content}", textEvent.FromUserName, textEvent.Content);
            await ProcessTextMessageAsync(textEvent.FromUserName, textEvent.Content);
        }
    }
    else if (string.Equals(wechatEvent.MessageType, "IMAGE", StringComparison.OrdinalIgnoreCase)) {
        var imageEvent = client.DeserializeEventFromXml&lt;ImageMessageEvent&gt;(xml);
        if (imageEvent != null &amp;&amp; !string.IsNullOrEmpty(imageEvent.MediaId) &amp;&amp;
            !string.IsNullOrEmpty(imageEvent.FromUserName)) {
            logger.LogInformation("Processing IMAGE message from {FromUser}: {MediaId}", imageEvent.FromUserName, imageEvent.MediaId);
            await ProcessImageMessageAsync(imageEvent.FromUserName, imageEvent.MediaId);
        }
    }
    else {
        logger.LogInformation("Ignored message type: {MessageType}", wechatEvent.MessageType);
    }

    return Ok("success");
}

</code></pre>
<h3 id="å¼æ­¥å¤çä¿¡æ¯">å¼æ­¥å¤çä¿¡æ¯</h3>
<p>å ä¸ºä¼ä¸å¾®ä¿¡å¯ä»¥ä¸»å¨ç»ç¨æ·åä¿¡æ¯ï¼æä»¥å¯ä»¥ææ¥æ¶ååéä¿¡æ¯åå¼ï¼ä¾å¦è°ç¨LLMå¤çåå¤çæ¶åï¼ä¼æ¯è¾æ¢ï¼å¯ä»¥æåå¤æ¾å°å¼æ­¥ä»»å¡éåéå»å®ç°ã</p>
<h4 id="ææ¬ä¿¡æ¯">ææ¬ä¿¡æ¯</h4>
<p>çº¯ææ¬å¤çèµ·æ¥è¿æ¯æ¯è¾ç®åçã</p>
<pre><code class="language-c#">/// &lt;summary&gt;
/// å¼æ­¥å¤çææ¬æ¶æ¯
/// &lt;/summary&gt;
private async Task ProcessTextMessageAsync(string toUser, string content) {
    await queue.QueueBackgroundWorkItemAsync(async (serviceProvider, token) =&gt; {
        // å¨åå°ä»»å¡ä¸­è§£æ Scoped æå¡
        var chatBot = serviceProvider.GetRequiredService&lt;IChatBotService&gt;();
        var logger = serviceProvider.GetRequiredService&lt;ILogger&lt;WechatWorkController&gt;&gt;();

        try {
            logger.LogInformation("Processing background task for user {ToUser}", toUser);

            // 1. è°ç¨ ChatBot è·ååå¤
            string reply = await chatBot.ProcessMessageAsync(content);

            // 2. åéåå¤
            var accessToken = await _tokenService.GetAccessTokenAsync();
            var request = new CgibinMessageSendRequest {
                AccessToken = accessToken,
                AgentId = _agentId,
                ToUserIdList = [toUser],
                MessageType = "text",
                MessageContentAsText = new CgibinMessageSendRequest.Types.TextMessage {
                    Content = content
                }
            };
            var response = await _client.ExecuteCgibinMessageSendAsync(request);
            if (!response.IsSuccessful()){
                throw new Exception($"åéä¼ä¸å¾®ä¿¡æ¶æ¯å¤±è´¥: {response.ErrorMessage} (Code: {response.ErrorCode})");
            }

            logger.LogInformation("Reply sent to {ToUser}: {ReplyContent}", toUser, reply);
        } catch (Exception ex) {
            logger.LogError(ex, "Failed to process message for {ToUser}", toUser);
        }
    });
}
</code></pre>
<h4 id="å¾çä¿¡æ¯">å¾çä¿¡æ¯</h4>
<p>å¾çéº»ç¦ä¸ç¹ï¼å¾®ä¿¡ä¸ä¼ç´æ¥æå¾çæ°æ®åæ¥ï¼èæ¯æäºä¸ª mediaIdï¼è¦æä»¬æå¨å»ä¸è½½ã</p>
<p>C# è¿éè¿æ¯æ¹ä¾¿çï¼ç´æ¥æå¾çä¸è½½æ¾å°åå­éäº¤ç»ç¬¬ä¸æ¹æå¡å¤çï¼å¦OCRï¼ï¼ç¶ååæç»æååºæ¥ã</p>
<pre><code class="language-c#">/// &lt;summary&gt;
/// å¼æ­¥å¤çå¾çæ¶æ¯
/// &lt;/summary&gt;
private async Task ProcessImageMessageAsync(string toUser, string mediaId) {
    await queue.QueueBackgroundWorkItemAsync(async (serviceProvider, token) =&gt; {
        var chatBot = serviceProvider.GetRequiredService&lt;IChatBotService&gt;();
        var wechatService = serviceProvider.GetRequiredService&lt;IWechatWorkService&gt;();
        var tokenService = serviceProvider.GetRequiredService&lt;IWechatWorkTokenService&gt;();
        var logger = serviceProvider.GetRequiredService&lt;ILogger&lt;WechatWorkController&gt;&gt;();
        var wechatClient = serviceProvider.GetRequiredService&lt;WechatWorkClient&gt;();

        try {
            logger.LogInformation("Processing background image task for user {ToUser}", toUser);

            // 1. Download Image
            var accessToken = await tokenService.GetAccessTokenAsync(token);
            var request = new CgibinMediaGetRequest {
                AccessToken = accessToken,
                MediaId = mediaId
            };
            var resp = await wechatClient.ExecuteCgibinMediaGetAsync(request, cancellationToken: token);

            if (!resp.IsSuccessful()) {
                logger.LogError("Failed to download image: {Error}", resp.ErrorMessage);
                await wechatService.SendTextMessageAsync(toUser, "æ±æ­ï¼æ æ³è·åå¾çåå®¹ã");
                return;
            }

            var bytes = resp.GetRawBytes();
            var mimeType = "image/jpeg";
            if (bytes.Length &gt; 0 &amp;&amp; bytes[0] == 0x89 &amp;&amp; bytes[1] == 0x50 &amp;&amp; bytes[2] == 0x4E &amp;&amp; bytes[3] == 0x47) {
                mimeType = "image/png";
            }

            var items = new ChatMessageContentItemCollection {
                new ImageContent(bytes, mimeType)
            };

            // 2. Call ChatBot
            var chatMessage = new ChatMessageContent(AuthorRole.User, items);
            var reply = await chatBot.ProcessMessageAsync(chatMessage);

            // 3. Send Reply
            await wechatService.SendTextMessageAsync(toUser, reply);

            logger.LogInformation("Reply sent to {ToUser}", toUser);
        } catch (Exception ex) {
            logger.LogError(ex, "Failed to process image message for {ToUser}", toUser);
        }
    });
}
</code></pre>
<h2 id="å¬ä¼å·">å¬ä¼å·</h2>
<p>å¥½ï¼ä¼ä¸å¾®ä¿¡æå®äºãæ¥ä¸æ¥ççå¬ä¼å·ã</p>
<p>å¬ä¼å·åä¼ä¸å¾®ä¿¡ä¸ä¸æ ·ï¼æ æ³ä¸»å¨åä¿¡æ¯ï¼æä»¥å¨æ¶å°ç¨æ·ä¿¡æ¯æ¶ï¼è¦è¿åXMLæ ¼å¼çç¸åºï¼ä½ä¸ºåå¤åå®¹ï¼5ç§åå¿é¡»åå¤ã</p>
<p>éªè¯åè°è¿éå°±ä¸éå¤äºï¼åä¼ä¸å¾®ä¿¡æ¯ä¸æ ·çã</p>
<pre><code class="language-c#">/// &lt;summary&gt;
/// æ¥æ¶æ¶æ¯ (POST)
/// &lt;/summary&gt;
[HttpPost]
public async Task&lt;IActionResult&gt; Callback(
    [FromQuery(Name = "msg_signature")] string? msgSignature,
    [FromQuery(Name = "signature")] string? signature,
    [FromQuery(Name = "timestamp")] string timestamp,
    [FromQuery(Name = "nonce")] string nonce,
    [FromQuery(Name = "encrypt_type")] string? encryptType
) {
    using var reader = new StreamReader(Request.Body);
    var xml = await reader.ReadToEndAsync();

    _logger.LogDebug("Callback Body (Length: {Length}): {Xml}", xml.Length, xml);

    // 1. éªè¯ç­¾å
    // å¦ææ¯å®å¨æ¨¡å¼ (encryptType == "aes")ï¼ä½¿ç¨ VerifyEventSignatureFromXml (éè¦ msg_signature)
    // å¦ææ¯æææ¨¡å¼ï¼SDK åé¨ DeserializeEventFromXml ä¹ä¼åä¸äºæ ¡éªï¼ä½éå¸¸æææ¨¡å¼ç­¾åæ ¡éªä½¿ç¨ signature (VerifyEventSignatureForEcho logic)
    // è¿éä¸»è¦å¤çå®å¨æ¨¡å¼ï¼å ä¸ºæææ¨¡å¼ä¸éå¸¸ä¸éè¦å¤æçè§£å¯éªè¯
    if (string.Equals(encryptType, "aes", StringComparison.OrdinalIgnoreCase)) {
        if (string.IsNullOrEmpty(msgSignature)) {
            return BadRequest("msg_signature is required for aes encryption");
        }

        var verifyResult = _client.VerifyEventSignatureFromXml(timestamp, nonce, xml, msgSignature);
        if (!verifyResult.Result) {
            _logger.LogWarning("Callback signature verification failed. Error: {Error}", verifyResult.Error?.Message);
            return BadRequest($"Verify signature failed: {verifyResult.Error?.Message}");
        }
    }
    else {
        // æææ¨¡å¼ï¼å¯ä»¥ä½¿ç¨ signature éªè¯ (å¯é)
        // var verifyResult = _client.VerifyEventSignatureForEcho(timestamp, nonce, signature);
    }

    // 2. ä½¿ç¨ SKIT åºèªå¨è§£å¯å¹¶ååºåå
    WechatApiEvent wechatEvent;
    try {
        wechatEvent = _client.DeserializeEventFromXml(xml);
        _logger.LogInformation("Callback deserialized successfully. MessageType: {MessageType}, FromUser: {FromUser}, ToUser: {ToUser}",
                               wechatEvent.MessageType, wechatEvent.FromUserName, wechatEvent.ToUserName);
    } catch (Exception ex) {
        _logger.LogError(ex, "Callback deserialization failed.");
        return BadRequest($"Deserialization failed: {ex.Message}");
    }

    switch (wechatEvent.MessageType?.ToLower()) {
        case "text":
            var textEvent = _client.DeserializeEventFromXml&lt;TextMessageEvent&gt;(xml);
            if (!string.IsNullOrEmpty(textEvent.Content) &amp;&amp;
                !string.IsNullOrEmpty(textEvent.FromUserName)) {
                _logger.LogInformation("Processing TEXT message from {FromUser}: {Content}", textEvent.FromUserName, textEvent.Content);

                var isSafetyMode = string.Equals(encryptType, "aes", StringComparison.OrdinalIgnoreCase);

                var textReply = new TextMessageReply {
                    ToUserName = textEvent.FromUserName,
                    FromUserName = textEvent.ToUserName,
                    MessageType = "text",
                    Content = "è¿éæ¯åå¤ç»ç¨æ·çåå®¹",
                    CreateTimestamp = DateTimeOffset.Now.ToUnixTimeSeconds()
                };

                var replyXml = _client.SerializeEventToXml(textReply, isSafetyMode);
                return Content(replyXml, "application/xml");
            }
            break;

        default:
            _logger.LogInformation("Ignored message type: {MessageType}", wechatEvent.MessageType);
            break;
    }

    return Ok("success");
}
</code></pre>
<p>å¯ä»¥çå°ä»£ç éå¤æ­æ¯ text ç±»ååï¼æé äº TextMessageReply ç±»åçæ°æ®ï¼ç¶åè°ç¨ SKIT.FlurlHttpClient.Wechat åºæä¾ç XML åºååæ¹æ³ã</p>
<p>è¿ä¸ªåºå°è£äºç´æ¥åºååè¢«å¨åå¤äºä»¶çæ©å±æ¹æ³ï¼é»è®¤ä¼åºååä¸ºå®å¨æ¨¡å¼ã</p>
<h2 id="æ¥å¥ç»å½">æ¥å¥ç»å½</h2>
<p>å¾®ä¿¡ç»å½åå¤§é¨åç¬¬ä¸æ¹åç¹è®¤è¯æµç¨å·®ä¸å¤ï¼å·²ç»åè¿å¥½å¤æ¬¡äºã</p>
<p>ä¸åèµè¿°è¿ä¸ªæµç¨ï¼æå´è¶£çåå­¦å¯ä»¥çè¿ç¯æç« : <a href="https://blog.deali.cn/p/django-taro-wechat-work-login" target="_blank" rel="noopener nofollow">Django+Taroé¡¹ç®å®ç°ä¼ä¸å¾®ä¿¡ç»å½</a></p>
<p>æ¬æ¬¡ææ²¡ææ¥å¥ç»å½ï¼èæ¯ç¨äºå¦ä¸ç§æ¹å¼å®ç°å¾®ä¿¡åå¹³å°ç¨æ·çå³èï¼å°±æ¯å¹³å°ä¸çæä¸ä¸ªkeyï¼è®©ç¨æ·å¨å¾®ä¿¡åéï¼æè§è¿æºæææçï¼å¦è¾è¹å¾ã</p>
<p>æä»¥è¿éæ¬è¿ä¸ä¸æä¹ååçåç¹è®¤è¯é¡¹ç®éçä»£ç å§ï¼è¯¦æå¯ä»¥çè¿ç¯æç« : <a href="https://blog.deali.cn/p/almost-abandoned-project-open-source" target="_blank" rel="noopener nofollow">IdentityServerLiteé¡¹ç®åè¿æçå¼æºè®¡å</a></p>
<pre><code class="language-c#">/// &lt;summary&gt;
/// ä¼ä¸å¾®ä¿¡ç»å½ - ä½¿ç¨åè°ç code ç»å½
/// &lt;/summary&gt;
/// &lt;param name="code"&gt;&lt;/param&gt;
/// &lt;param name="state"&gt;ä¸äºè®©å¾®ä¿¡è½¬åä¼ ç»åç«¯çåæ°ï¼è¿éæ¯åç¹è®¤è¯é¡¹ç®çsession_id&lt;/param&gt;
[HttpGet("wecom/login")]
public async Task&lt;IActionResult&gt; WecomLogin(string code, string? state = null) {
    logger.LogInformation("ä¼ä¸å¾®ä¿¡ç»å½ï¼code: {code}, state: {state}, crop: {cropTag}", code, state, cropTag);

    if (string.IsNullOrWhiteSpace(state)) {
        return BadRequest(new ApiResponse { Message = "ä¼ä¸å¾®ä¿¡ç»å½ç state ä¸ºç©ºï¼æ æ³è·å session" });
    }

    var session = await authService.GetSession(state);
    if (session == null) {
        return NotFound(new ApiResponse { Message = $"session {state} ä¸å­å¨ï¼" });
    }

    var userInfo = await wecomService.GetUserInfo(code);
    if (userInfo == null) {
        return BadRequest(new ApiResponse { Message = "è·å userinfo éè¯¯ï¼" });
    }

    if (userInfo.Errcode != 0) {
        return BadRequest(new ApiResponse { Message = $"è·åç¨æ·ä¿¡æ¯å¤±è´¥ï¼ä¼å¾®éè¯¯ä¿¡æ¯: {userInfo.Errmsg}" });
    }

    var wechatUser = await wecomService.GetUser(userInfo.Userid);
    if (wechatUser == null) {
        return BadRequest(new ApiResponse { Message = "è·å user éè¯¯ï¼" });
    }

    var user = await userRepo.Where(a =&gt; a.PhoneNumber == wechatUser.Userid).FirstAsync();
    // ç¨æ·ä¸å­å¨çè¯ï¼èªå¨åå»ºç¨æ·
    if (user == null) {
        user = await accountService.CreateUser(
            await accountService.GenerateUsername(wechatUser.Name),
            wechatUser.Userid,
            wechatUser.Name
        );

        logger.LogInformation("ç¨æ· {Phone} ä¸å­å¨ï¼å·²åå»ºæ°ç¨æ· {UserId}", 
                              wechatUser.Userid, user.Id);
        // return NotFound(new ApiResponse { Message = $"ç¨æ· {wechatUser.Userid} ä¸å­å¨ï¼" });
    }

    try {
        var url = await authService.LoginSessionAndGetUri(session, user, true);
        logger.LogInformation("ä¼ä¸å¾®ä¿¡ç»å½æåï¼è·³è½¬å°é¾æ¥: {url}", url);
        return Redirect(url);
    }
    catch (Exception ex) {
        ex.ToExceptionless().Submit();
        return Problem($"ä¼ä¸å¾®ä¿¡ç»å½å¤±è´¥: LoginSessionAndGetUri å¤±è´¥ - {ex.Message}");
    }
}
</code></pre>
<h2 id="å°ç»">å°ç»</h2>
<p>å¤§æ¦å°±æ¯è¿äºäºï¼å¾ç¹çï¼ä¸è¿è¿æºå¥½ç¨çï¼è¿äºä»£ç åå®åå ä¹æ¯ä¸æ¬¡å°±å¯¹æ¥éè¿ï¼æ³èµ·æ¥ä»¥ååå¤è°è¯çç»åï¼æå¹ï¼æ¥å­ä¹æ¯å¥½èµ·æ¥äºåï¼ð</p>
<p>å¦ä¸ç¹æå¹ï¼Semantic Kernelçå¥½ç¨ï¼æç¨äºå¤ªä¹langchainï¼åºè¯¥æ©ç¹ä¸semantic kernelçã</p>

</div>
<div id="MySignature" role="contentinfo">
    å¾®ä¿¡å¬ä¼å·ï¼ãç¨åºè®¾è®¡å®éªå®¤ã
ä¸æ³¨äºäºèç½ç­é¨æ°ææ¯æ¢ç´¢ä¸å¢éææ·å¼åå®è·µï¼åæ¬æ¶æè®¾è®¡ãæºå¨å­¦ä¹ ä¸æ°æ®åæç®æ³ãç§»å¨ç«¯å¼åãLinuxãWebååç«¯å¼åç­ï¼æ¬¢è¿ä¸èµ·æ¢è®¨ææ¯ï¼åäº«å­¦ä¹ å®è·µç»éªã
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-21 23:17">2026-01-21 23:16</span>&nbsp;
<a href="https://www.cnblogs.com/deali">ç¨åºè®¾è®¡å®éªå®¤</a>&nbsp;
éè¯»(<span id="post_view_count">319</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19514332);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19514332', targetLink: 'https://www.cnblogs.com/deali/p/19514332', title: 'AspNetCoreå¼åç¬è®°ï¼WebApié¡¹ç®éæä¼ä¸å¾®ä¿¡åå¬ä¼å·' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ¢ç§ AgentRunï½åºäº Serverless ç AI Agent æ²ç®±å·¥ç¨åä¹è·¯ ]]></title>
    <link>https://www.cnblogs.com/Serverless/p/19518412</link>
    <guid>15978e9ef46c87e1ef732234969765a7</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Serverless/p/19518412" title="åå¸äº 2026-01-22 17:28">
    <span role="heading" aria-level="2">æ¢ç§ AgentRunï½åºäº Serverless ç AI Agent æ²ç®±å·¥ç¨åä¹è·¯</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>é¿éäºå½æ°è®¡ç® AgentRun å¨æ°åå¸åï¼æä»¬æ´çäºâæ¢ç§ AgentRunâç³»åæç« ï¼æ¬ç³»åå°æ¢³çä¼ä¸è½å°Agent å¸¸è§é¾é¢ï¼ç»åºå·ä½è§£æ³ï¼å©å Agentic AI å¿«éèµ°è¿çäº§çº§ç¯å¢ãæ¬¢è¿å å¥âå½æ°è®¡ç® AgentRun å®¢æ·ç¾¤âä¸æä»¬äº¤æµï¼ééç¾¤å·ï¼134570017218ã</p>
<h2 id="ai-agent-æ¶ä»£çæ²ç®±éæ±">AI Agent æ¶ä»£çæ²ç®±éæ±</h2>
<h3 id="ä»-copilot-å°-agentæ§è¡è½åçè´¨å">ä» Copilot å° Agentï¼æ§è¡è½åçè´¨å</h3>
<p>å¨çæå¼ AI çæ©æé¶æ®µï¼åºç¨ä¸»è¦ä»¥âCopilotâå½¢å¼å­å¨ï¼AI ä»ä½ä¸ºè¾å©çæå»ºè®®ãç¶èï¼éç AutoGPTãBabyAGI ä»¥å OpenAI Code Interpreterï¼ç°ä¸º Advanced Data Analysisï¼çåºç°ï¼AI å¼å§æ®æ¼âAgentâçè§è²ãAgent è¢«èµäºäºç®æ ï¼å¹¶è½èªä¸»è§åæ­¥éª¤ãä½¿ç¨å·¥å·æ¥è¾¾æç®æ ã</p>
<p>è¿ç§è´¨åçæ ¸å¿å¨äº<strong>ä»£ç æ§è¡ï¼Code Executionï¼</strong>ãä¸ºäºåç­âåæè¿å±æ¥¼çéå®æ°æ®å¹¶ç»å¶è¶å¿å¾âè¿æ ·çè¯·æ±ï¼LLM ä¸ååªæ¯çæä¸æ®µ Python ä»£ç ææ¬ï¼èæ¯éè¦å¨ä¸ä¸ªçå®ç Python ç¯å¢ä¸­è¿è¡è¿æ®µä»£ç ï¼å¹¶è·åç»å¾ç»æãåæ ·ï¼ä¸ºäºâå¸®æé¢è®¢ä¸å¼ å»ä¸äº¬çæºç¥¨âï¼Agent å¯è½éè¦å¨ä¸ä¸ªæ å¤´æµè§å¨ï¼Headless Browserï¼ä¸­æ¨¡æç¨æ·ç¹å»ã</p>
<h3 id="ä¸å¯ä¿¡ä»£ç çå®å¨éæ£">ä¸å¯ä¿¡ä»£ç çå®å¨éæ£</h3>
<p>å½ LLM çæä»£ç å¹¶æ§è¡æ¶ï¼è¿æ®µä»£ç å¨æ¬è´¨ä¸æ¯<strong>ä¸å¯ä¿¡çï¼Untrustedï¼</strong>ãå¦æç´æ¥å¨åºç¨æå¡å¨æç¨æ·çæ¬å°è®¾å¤ä¸è¿è¡ï¼å°é¢ä¸´ç¾é¾æ§çå®å¨é£é©ï¼</p>
<ul>
<li><strong>ç³»ç»ç ´å</strong>ï¼AI çæçä»£ç å¯è½æ æææ¶æå°åå« rm -rf / ç­ç ´åæ§æä»¤ï¼æèä¿®æ¹å³é®ç³»ç»éç½®æä»¶ã</li>
<li><strong>æ°æ®æ³é²</strong>ï¼ä»£ç å¯è½å°è¯è¯»åç¯å¢åéä¸­ç API Keyï¼æèæ«æåç½æ°æ®åºï¼å°æææ°æ®åéå°å¤é¨æå¡å¨ã</li>
<li><strong>èµæºèå°½</strong>ï¼æ­»å¾ªç¯æåå­æ³æ¼ä»£ç å¯è½å¯¼è´å®¿ä¸»æºå´©æºï¼å½±åå¶ä»ç§æ·çæå¡ã</li>
<li><strong>ç½ç»æ»å»</strong>ï¼æ¶æ Prompt æ³¨å¥ï¼Prompt Injectionï¼å¯è½è¯±å¯¼ AI å°æ§è¡ç¯å¢ä½ä¸ºè·³æ¿ï¼Jump Boxï¼ï¼å¯¹åé¨ç½ç»åèµ· DDoS æ»å»æç«¯å£æ«æã</li>
</ul>
<h3 id="agent-åºæ¯é¢ä¸´çç¬ç¹ææ">Agent åºæ¯é¢ä¸´çç¬ç¹ææ</h3>
<p>é¤äºåºç¡çå®å¨æ§ï¼AI Agent çäº¤äºç¹æ§è¿ç»æ²ç®±ç¯å¢å¸¦æ¥äºåææªæçå·¥ç¨ææï¼è¿ä¹æ¯ä¼ ç»æ²ç®±ï¼å¦ç®åç Docker å®¹å¨æèææºï¼é¾ä»¥åºå¯¹çï¼</p>
<ul>
<li><strong>ç¶æä¿æ</strong>ï¼ä¸ä¼ ç»çâè¯·æ±-ååºâæ¨¡å¼ä¸åï¼Agent å¾å¾éè¦è¿è¡å¤è½®å¯¹è¯ãä¸ä¸è½®å®ä¹çåéï¼å¦ df = load_data()ï¼éè¦å¨ä¸ä¸è½®ï¼df.plot()ï¼ä¸­ç»§ç»­å¯ç¨ãè¿å°±è¦æ±æ²ç®±ç¯å¢å¿é¡»å·å¤<strong>ä¸ä¸æè®°å¿è½å</strong>ï¼èéæ¯æ¬¡è¯·æ±é½éç½®ç¯å¢ã</li>
<li><strong>æéå¯å¨</strong>ï¼ç¨æ·æ æ³å¿åæ¯æ¬¡äº¤äºé½ç­å¾æ°ç§çè³æ°åç§çèææºå¯å¨æ¶é´ãä¸ºäºä¿è¯æµççå¯¹è¯ä½éªï¼Time to First Tokenï¼ï¼æ²ç®±å¿é¡»å·å¤æ¯«ç§çº§çå·å¯å¨è½åã</li>
<li><strong>ç¯å¢ä¾èµå¤æ ·æ§</strong>ï¼ä¸åç Agent ä»»å¡å¯è½éè¦å®å¨ä¸åçä¾èµåºï¼å¦ PandasãScipy ç¨äºæ°æ®åæï¼Puppeteer ç¨äºç½é¡µæä½ï¼ãæ²ç®±éè¦æ¯æçµæ´»çèªå®ä¹éåæå¨æä¾èµå è½½ï¼åæ¶ä¸è½å½±åå¯å¨éåº¦ã</li>
<li><strong>èµæºææ¬æ§å¶</strong>ï¼Agent çè°ç¨å¾å¾å·æç¨çæ§åçªåæ§ï¼ä¾å¦ä¸å¤©åªç¨å æ¬¡ï¼ä½ä¸æ¬¡ç¨å¾ä¹ï¼ãé¿æè¿è¡ç¬å çèææºï¼VMï¼ææ¬é«æä¸èµæºå©ç¨çä½ï¼èä¼ ç»ç FaaS è½ç¶ä¾¿å®ä½å¾å¾ç¼ºä¹ç¶æä¿æè½åãå¦ä½å¨ä½ææ¬åé«æ§è½ä¹é´æ¾å°å¹³è¡¡ç¹ï¼æ¯ä¸ä¸ªå·¨å¤§çææã<br>
å æ­¤ï¼æå»ºä¸ä¸ª<strong>æ²ç®±</strong>ï¼Sandboxï¼ââä¸ä¸ªä¸å®¿ä¸»æºãåç½ä»¥åå¶ä»ç¨æ·æ°æ®ä¸¥æ ¼éç¦»ï¼åæ¶å·å¤é«æ§è½ãä½ææ¬ãæç¶æçå°é­æ§è¡ç¯å¢ââæä¸ºäº AI Agent æ²ç®±è½å°çåææ¡ä»¶ã</li>
</ul>
<h2 id="agentrun-sandboxä¸ä¸º-agent-è®¾è®¡çå·¥ç¨åæ¹æ¡">AgentRun Sandboxï¼ä¸ä¸º Agent è®¾è®¡çå·¥ç¨åæ¹æ¡</h2>
<p>ä¸ºäºè§£å³ä¸è¿°ææï¼æä»¬æ¨åºäº <strong>AgentRun Sandbox</strong>ãè¿æ¯ä¸ä¸ª<strong>ä»¥é«ä»£ç ä¸ºæ ¸å¿ï¼å¼æ¾çæãçµæ´»ç»è£</strong>çä¸ç«å¼ Agentic AI åºç¡è®¾æ½å¹³å°ã</p>
<p>AgentRun å¹¶éä»é¶æå»ºä¼ ç»çèææºéç¾¤ï¼èæ¯<strong>åºäºé¿éäºå½æ°è®¡ç®ï¼FCï¼è¿ä¸å¼ºå¤§ç Serverless åºåº§æå»º</strong>ãéè¿ååå©ç¨ Serverless ç<strong>æéä»è´¹ãæè´å¼¹æ§ä»¥ååè¿ç»´ï¼NoOpsï¼</strong> ç¹æ§ï¼AgentRun è§£å³äºä¸ç´å°æ°æ²ç®±é¢åçææ¬ä¸æçé¾é¢ï¼å¹¶å¨æ­¤åºç¡ä¸éè¿å·¥ç¨åå°è£ï¼æä¾äºé¢å Agent åºæ¯çä¸ä¸è½åã</p>
<h3 id="ä¸ºä»ä¹éæ©å½æ°è®¡ç®ä½ä¸º-sandbox-infra">ä¸ºä»ä¹éæ©å½æ°è®¡ç®ä½ä¸º Sandbox Infra</h3>
<p>å¨æå»º Agent æ²ç®±æ¶ï¼æä»¬åå®å°éæ©äºå½æ°è®¡ç®ï¼FCï¼ä½ä¸ºåºå±åºç¡è®¾æ½ï¼è¿ä¸»è¦åºäºä»¥ä¸æ ¸å¿ä¼å¿çèéï¼</p>
<ul>
<li><strong>å¼ºå®å¨éç¦»</strong>ï¼ æ²ç®±çæ ¸å¿è¯æ±æ¯å®å¨ãå½æ°è®¡ç®åºå±éç¨ç¥é¾è£¸éå±ä¸ RunD å®å¨å®¹å¨ææ¯ï¼æ¯ä¸ªæ§è¡ç¯å¢é½è¿è¡å¨ç¬ç«ç MicroVM ä¸­ãè¿ç§åºäºèæåææ¯çåæ ¸çº§éç¦»ï¼ç¸æ¯ä¼ ç»ç Docker å®¹å¨éç¦»å·ææ´é«çå®å¨æ§ï¼è½ææé²æ­¢æ¶æä»£ç éé¸ï¼ä¸ºä¸å¯ä¿¡ä»£ç æ§è¡æä¾äºåå®å±éã</li>
<li><strong>æè´å¼¹æ§ä¸å·å¯å¨ä¼å</strong>ï¼ Agent çè°ç¨å¾å¾å·æçªåæ§ãå½æ°è®¡ç®å·å¤æ¯«ç§çº§çå¼¹æ§ä¼¸ç¼©è½åï¼ç»å RunD ææ¯å¯¹å¯å¨éåº¦çæè´ä¼åï¼ä½¿å¾æ²ç®±è½å¤å¨æ°ç§çè³æ¯«ç§åå®æåå»ºåå¯å¨ãè¿ä¸ä»æ»¡è¶³äºé«å¹¶ååºæ¯ä¸çéæ±ï¼ä¹ä¿è¯äº Agent äº¤äºçæµçæ§ï¼é¿åäºä¼ ç»èææºå¯å¨æ¢å¸¦æ¥çå»¶è¿æã</li>
<li><strong>ææ¬æç</strong>ï¼èªå»ºèææºéç¾¤éå¸¸éè¦ä¸ºå³°å¼æµéé¢çèµæºï¼å¯¼è´ä½è°·æèµæºæµªè´¹ãå½æ°è®¡ç®éç¨æéä»è´¹ï¼Pay-as-you-goï¼æ¨¡å¼ï¼ä¸ AgentRun å©ç¨äº FC çç©ºé²èªå¨åæ¶æºå¶ï¼çæ­£åå°äºâæè¯·æ±æè®¡è´¹âãå¯¹äºç¨çè°ç¨ç Agent åºæ¯ï¼è¿ç§æ¨¡å¼è½æ¾èéä½åºç¡è®¾æ½ææ¬ã</li>
<li><strong>åè¿ç»´</strong>ï¼ åºäº Serverless æ¶æï¼å¼åèæ éå³å¿åºå±æå¡å¨çæä½ç³»ç»è¡¥ä¸ãç½ç»éç½®åéç¾¤ç»´æ¤ãAgentRun å¢éå¯ä»¥å°ç²¾åéä¸­å¨æ²ç®±çæ ¸å¿é»è¾ä¸ä¸å¡ä½éªä¸ï¼èéåºå±åºç¡è®¾æ½çç¹çè¿ç»´ã</li>
<li><strong>ä¼è¯è½å</strong>ï¼å½æ°è®¡ç®å´ç» AI Agent Sandbox åºæ¯æ¨åºäºä¼è¯äº²åãéç¦»ä»¥åç®¡çè½åãå¨ä¸æ¬¡ä¼è¯çå½å¨æåï¼ç¸åä¼è¯çè¯·æ±åä¼è¢«äº²åè·¯ç±å°åä¸ä¸ªå®ä¾ä¸­ï¼å¹¶ç¬å è¯¥å®ä¾ï¼ä¿è¯äºä¼è¯äº¤äºçè¿ç»­æ§ãä¸ä¸æå®æ´æ§ä»¥åå¤ç§å®å¨æ§ï¼åæ¶æä¾å®æ´çç®¡çæ¥å£æ¥ä¸»å¨å¯¹ä¼è¯çå½å¨æè¿è¡æ§å¶ï¼éä½äºå¼åé¨æ§ã</li>
</ul>
<h3 id="agentrun-çæ ¸å¿è¿è¡æºå¶">AgentRun çæ ¸å¿è¿è¡æºå¶</h3>
<p>ä¼ ç»ç Serverless éå¸¸æ¯æ ç¶æçï¼é¾ä»¥æ»¡è¶³ Code Interpreter è¿ç±»éè¦ä¸ä¸æä¿æçåºæ¯ãAgentRun åå©å½æ°è®¡ç®çä¼è¯äº§åè½åï¼å¨æ ç¶æçè®¡ç®åºåº§ä¸æå»ºäºæç¶æãä¼è¯çº§çæ²ç®±ä½éªã</p>
<h4 id="1-æ²ç®±è¯·æ±äº²å">1. æ²ç®±è¯·æ±äº²å</h4>
<p>AgentRun åè®¸å¼åèæ¾å¼å°åå»ºä¸ä¸ªå·æçå½å¨æçæ§è¡ç¯å¢ï¼è§£å³äºä¼ ç» Serverlessâç¨å®å³èµ°âå¯¼è´çä¸ä¸æä¸¢å¤±é®é¢ã</p>
<ul>
<li>
<p><strong>ä¼è¯äº²å</strong>ï¼AgentRun ä¾èµå½æ°è®¡ç®ä¼è¯äº²åæºå¶ãå½å¼åèåå»ºæ²ç®±åï¼AgentRun ä¼ç»´æ¤ä¸ä¸ªå¯ä¸ç SessionIDãåç»­æææºå¸¦è¯¥ ID çè¯·æ±ï¼é½ä¼è¢«ç²¾åè·¯ç±å°åä¸ä¸ªåºå±çè®¡ç®å®ä¾ãè¿æå³çç¨æ·å¨ç¬¬ä¸æ­¥å®ä¹ç df = pd.read_csv(...) å¯¹è±¡ï¼å¨ç¬¬äºæ­¥ df.plot() æ¶ä¾ç¶å­å¨äºåå­ä¸­ï¼å®ç¾å¤å»æ¬å°å¼åä½éªã</p>
</li>
<li>
<p><strong>MCP åè®®åçæ¯æ</strong>ï¼éå¯¹æ¨¡åä¸ä¸æåè®®ï¼Model Context Protocol, MCPï¼ï¼AgentRun æä¾äº MCP SSE å MCP Streamable HTTP ä¼è¯äº²åæ¯æãAgentRun å¯ä»¥ç´æ¥ä½ä¸º MCP ç½å³ï¼è®© LLM ä¸å¤é¨å·¥å·çäº¤äºæ´å é¡ºæ»ã</p>
</li>
</ul>
<h4 id="2-å¤å±æ¬¡å®å¨éç¦»">2. å¤å±æ¬¡å®å¨éç¦»</h4>
<p>å¨å¤ç§æ· SaaS å¹³å°ä¸­ï¼å®å¨æ§æ¯ AgentRun çåºç³ã</p>
<ul>
<li><strong>è®¡ç®éç¦»</strong>ï¼AgentRun å©ç¨åºå±åºç¡è®¾æ½çç¥é¾è£¸éå±ä¸ RunD å®å¨å®¹å¨ææ¯ï¼ç¡®ä¿æ¯ä¸ªæ²ç®±å®ä¾å¨åæ ¸çº§å«è¿è¡éç¦»ãéè¿å¼ºå¶å°ä¼è¯å¹¶ååº¦è®¾ç½®ä¸º 1ï¼AgentRun ä¿è¯ç§æ· A çè¿ç¨ç©ºé´ãåå­æ°æ®ä¸ç§æ· B ç©çåç¦»ï¼é²æ­¢å®¹å¨éé¸ã</li>
<li><strong>ç½ç»éç¦»</strong>ï¼ç½ç»éç¦»å®å¨ç±ç¨æ·æ§å¶ãç¨æ·å¯ä»¥æ ¹æ®å®å¨éæ±çµæ´»éç½®ï¼éæ©å¼å¯æå³é­æ²ç®±çå¬ç½è®¿é®æéï¼æèå°æ²ç®±æ¥å¥æå®ç VPC ç½ç»ç¯å¢ï¼ä»èå¨æ»¡è¶³ä¸å¡è¿éæ§çåæ¶ï¼é²æ­¢æ¶æä»£ç å¯¹åç½åèµ·æ»å»ã</li>
</ul>
<h4 id="3-çµæ´»ççå½å¨ææ§å¶">3. çµæ´»ççå½å¨ææ§å¶</h4>
<p>AgentRun éè¿å½æ°è®¡ç®çä¼è¯è½åï¼æ¥ç®¡äºåºå±è®¡ç®èµæºççå½å¨æï¼ä¸ºä¸å±åºç¨æä¾ç²¾ç»åç®¡çï¼</p>
<ul>
<li><strong>èªå¨é²ç½®åæ¶ï¼Idle Timeoutï¼</strong>ï¼ä¸ºäºéè¿ Serverless æ¶æéä½ææ¬ï¼AgentRun æ¯æè®¾ç½®ç©ºé²è¶æ¶ï¼ä¾å¦ 5 åéï¼ãå¦æ Agent å¨è¿æ®µæ¶é´åæ²¡ææ°æä»¤ï¼åºå±å®ä¾ä¼èªå¨éæ¯å¹¶åæ­¢è®¡è´¹ï¼å®ç¾éé AI äº¤äºâçªåæ§å¼ºãç¨çåº¦é«âçç¹ç¹ã</li>
<li><strong>ç¶ææåä¸æ¢å¤ï¼å³å°ä¸çº¿ï¼</strong>ï¼éå¯¹é¿æ¶é´çä»»å¡é´æ­ï¼AgentRun è½å¤å°æ²ç®±çåå­ä¸ç£çç¶æå¿«ç§ä¿å­ï¼å¨ç¨æ·åå½æ¶éè¿å¿«ç§å¿«éæ¢å¤ç°åºï¼æ¢èçææ¬åä¿çäºä¸ä¸æã</li>
</ul>
<h4 id="4-ä¼è¯ç²åº¦å­å¨éç¦»å³å°ä¸çº¿">4. ä¼è¯ç²åº¦å­å¨éç¦»ï¼å³å°ä¸çº¿ï¼</h4>
<p>ä»£ç æ§è¡éè¦éç¦»ï¼æ°æ®å­å¨æ´éè¦éç¦»ãAgentRun åæ°æ§å°è§åäºä¼è¯ç²åº¦å­å¨ç²æ§ã</p>
<ul>
<li><strong>å¨æç»å®</strong>ï¼AgentRun åè®¸ç¨æ·ä¸ºæ¯ä¸ªæ²ç®±ç¯å¢ä¸­å¨æåéä¸ä¸ªå­å¨æè½½ç¹çä¸å±å­ç®å½ã</li>
<li><strong>é»è¾æ²ç®±</strong>ï¼éè¿åºå±çæè½½ææ¯ï¼æ²ç®±åé¨åªè½çå°å±äºèªå·±ç /workspaceï¼ç©çä¸æ æ³è®¿é®å¶ä»ç§æ·çæä»¶ï¼å¦ ../../tenant-b/secret.txtï¼ï¼ä»æä»¶ç³»ç»å±é¢æ ¹é¤äºæ°æ®äº¤åé£é©ã</li>
</ul>
<h2 id="agentrun-å¼ç®±å³ç¨çæ²ç®±è½å">AgentRun å¼ç®±å³ç¨çæ²ç®±è½å</h2>
<p>AgentRun ä¸ä»æä¾äºåºå±éç¦»ç¯å¢ï¼è¿é¢ç½®äºç»è¿å·¥ç¨åè°ä¼çæ ååæ¨¡çï¼è®©å¼åèå¼ç®±å³ç¨ï¼</p>
<ul>
<li><strong>Code Interpreterï¼ä»£ç è§£éå¨ï¼</strong>ï¼é¢è£ Python/Node.js/Java ç­ç¯å¢ï¼æ¯ææä»¶ä¸ä¼ ä¸è½½ãæ°æ®åæãå¾è¡¨ç»å¶åå½ä»¤è¡æä½ã</li>
<li><strong>Browser Userï¼æµè§å¨æ²ç®±ï¼</strong>ï¼æä¾åºäº CDP over WebSocket åè®®çæµè§å¨ç¯å¢ï¼å¼å®¹ Puppeteer / Playwrightï¼è®© Agent è½å¤å®å¨å°è®¿é®äºèç½è¿è¡ç½é¡µæä½ã</li>
<li><strong>All In One</strong>ï¼éæäºä»£ç è§£éå¨ä¸æµè§å¨ç¯å¢çå¨è½åæ²ç®±ï¼æ»¡è¶³å¤æ Agent ä»»å¡éæ±ã<br>
è¿äºæ¨¡çéåå·å¤é«åº¦ççµæ´»æ§ï¼AgentRun æªæ¥å°å¼æ¾éåå®ä¹ï¼åè®¸ç¨æ·åºäºæ åéåå®å¶ç§æä¾èµåºæå®å¨ç­ç¥ã</li>
</ul>
<p>AgentRun æ²ç®±æ¶æè¯¦è§£<br>
<img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260122172746350-1412614478.png" class="lazyload"></p>
<h3 id="agentrun-ç½å³">AgentRun ç½å³</h3>
<p>è¿æ¯ AgentRun çé¨æ·ï¼è´è´£æ¥æ¶æ¥èª AI Agentï¼å¦ LangChain åºç¨ãChatGPT Pluginï¼ç HTTP è¯·æ±ï¼é¤äºæ åçèº«ä»½éªè¯ãé´æä»¥ååè®®è½¬æ¢ï¼å¦å° HTTP è½¬ä¸º WebSocketï¼ä¹å¤ï¼å¶æ ¸å¿è½åä¾¿æ¯æ²ç®±ç®¡çä»¥åæ²ç®±è¯·æ±è·¯ç±çåè½ï¼å®å±è½äºåºå± Serverless åºç¡è®¾æ½çå¤ææ§ï¼å®ç°äºå¦ä¸è½åï¼</p>
<ul>
<li><strong>æ²ç®±ç®¡ç</strong>ï¼ç®¡çæ²ç®±èµæºï¼ç»´æ¤ä¸å¡å±æ²ç®± ID ä¸åºå±è®¡ç®èµæº SessionID çæ å°å³ç³»</li>
<li><strong>ç¶æç»´æ¤</strong>ï¼çæ§æ²ç®±çæ´»è·ç¶æï¼åºäºæ²ç®±è¶æ¶éç½®ä»¥ååºå±èµæºæåµåæ¶å¯¹ç¶æè¿è¡æ´æ°</li>
<li><strong>èµæºè°åº¦</strong>ï¼æ ¹æ®ç¨æ·æå®çè®¡ç®è§æ ¼ï¼CPUãMemoryï¼ï¼ååºå±ç³è¯·ç¸åºçèµæºã</li>
</ul>
<h3 id="å½æ°è®¡ç®æ²ç®±ç¯å¢">å½æ°è®¡ç®æ²ç®±ç¯å¢</h3>
<p>ä¸»è¦ç±å½æ°è®¡ç®ä½ä¸ºåºå±ç®åæ¥æ¿è½½æ²ç®±çè¿è¡ãAgentRun å©ç¨å½æ°è®¡ç®æä¾çæè´å¼¹æ§è½åï¼å®ç°å¨åéåå¯å¨æä¸ä¸ä¸ªç¬ç«çæ²ç®±ç¯å¢ï¼æ¯ä¸ªç¯å¢é½è¿è¡å¨ç¬ç«ç MicroVM ä¸­ï¼æ­éèªç å¼ç®±å³ç¨çæ²ç®±éåæ¨¡çï¼å¨åè½ä»¥åæ§è½ä¸ä¸ºç¨æ·æä¾äºåéä¿éã</p>
<h3 id="å¸åå·¥ä½æµä»æä»¤å°ç»æ">å¸åå·¥ä½æµï¼ä»æä»¤å°ç»æ</h3>
<p>ä»¥âç¨æ·è®© Agent æ ¹æ®ä¸ä¼ ç Excel æä»¶ç»å¶å¾è¡¨âä¸ºä¾ï¼AgentRun çå·¥ä½æµç¨å¦ä¸ã</p>
<h4 id="é¶æ®µä¸æ¨¡æ¿åå»º">é¶æ®µä¸ï¼æ¨¡æ¿åå»º</h4>
<ol>
<li>ç¨æ·è¯·æ±ï¼Agent æ¥æ¶å°ç¨æ·æä»¤åï¼ç± LLM å³ç­ä½¿ç¨ Python æ¥å®ç°è¯¥éæ±ã</li>
<li>Agent å·¥å·è°ç¨ï¼AI Agent ä¼å AgentRun ç½å³åé Code Interpreter æ²ç®±æ¨¡æ¿çåå»ºè¯·æ±ã</li>
<li>æ¨¡æ¿åå»ºï¼AgentRun ç½å³ä¼è°ç¨å½æ°è®¡ç®æ¥å£åå»ºä¸ä¸ª Code æ²ç®±æ¨¡æ¿å½æ°ï¼éåéç½®ä¸ºåææå°çèªç  Code Interpreter æ²ç®±æ¨¡æ¿ï¼è¯¥å½æ°éè¦åæ¶éç½®ä¼è¯äº²åä»¥åä¼è¯éç¦»ã</li>
</ol>
<h4 id="é¶æ®µäºæ²ç®±åå»º">é¶æ®µäºï¼æ²ç®±åå»º</h4>
<ol>
<li>Agent å·¥å·è°ç¨ï¼æ¨¡æ¿åå»ºå®æåï¼Agent ç»§ç»­è¿è¡æ²ç®±åå»ºï¼åå»ºæ¶ä¼ å¥å·²æçæ¨¡æ¿ IDï¼æ è¯æ²ç®±å®ä¾è¿è¡æ¶çéç½®åéå</li>
<li>æ²ç®±åå»ºï¼AgentRun æ¶å°æ²ç®±åå»ºè¯·æ±åï¼ä¼è°ç¨ FC ç CreateSession æ¥å£æ¥åå»ºä¸ä¸ªæ²ç®±å®ä¾ï¼è¯¥æ²ç®±ä¼æä¸ä¸ªåéçé²ç½®è¶æ¶æ¶é´ï¼æé¿å¯å­æ´» 24h</li>
<li>åå»ºå®æï¼AgentRun ä¼ä¿å­ FC è¿åçä¼è¯ IDï¼å¹¶çææ²ç®±ä¸å¡ ID ä¸ä¹å¯¹åºï¼æç»å°æ²ç®±ä¸å¡ ID è¿åç»ç¨æ·</li>
</ol>
<h4 id="é¶æ®µä¸ä»»å¡æ§è¡">é¶æ®µä¸ï¼ä»»å¡æ§è¡</h4>
<ol>
<li>ä¸ä¼ æä»¶ï¼Agent éè¿ Code Interpreter çæä»¶ä¸ä¼ æ¥å£ï¼å° Excel æä»¶ä¸ä¼ ãè¥æ³å°è¯¥æä»¶æä¹åï¼å¯ä»¥å¨åå»ºæ²ç®±æ¶éç½®æä¹åå­å¨ NASï¼å°å¶æå°æ²ç®±ä¸­ï¼å¹¶å°æä»¶ä¸ä¼ å° NAS æè½½çç®å½ä¸ã</li>
<li>ç»å¶å¾è¡¨ï¼Agent çæä»£ç  import pandas as pd; df = pd.read_excel('data.xlsx')ï¼å¹¶è°ç¨ Code Interpreter ç run_code æ¥å£æ§è¡ä»£ç ã</li>
<li>ä¼è¯äº²åï¼Agent ææåå¾ Code Interpreter çè¯·æ±ä¸­ï¼é½å¿é¡»å¸¦ä¸å¯¹åºçæ²ç®± ID æè½ä¿è¯è¯·æ±é½è·¯ç±å°åä¸ä¸ªæ²ç®±å®ä¾ã</li>
<li>åå­é©»çï¼ä»£ç æ§è¡å®æ¯ï¼åé df é©»çå¨åå­ä¸­.</li>
<li>äºæ¬¡ä»£ç æ§è¡ï¼Agent æ ¹æ®æ°æ®ååçæç»å¾ä»£ç  df.plot()ãåæ¬¡åéä»£ç è¿è¡è¯·æ±</li>
<li>ä¸ä¸æå¤ç¨ï¼è¯·æ±åæ¬¡å°è¾¾åä¸å®ä¾ï¼ç´æ¥ä½¿ç¨åå­ä¸­ç df å¯¹è±¡è¿è¡ç»å¾ï¼çæå¾çæä»¶ã</li>
<li>ç»æåä¼ ï¼å¾çè¢«åå¥ NASï¼ä¸è½½é¾æ¥è¿åç» Agentã</li>
</ol>
<h4 id="é¶æ®µåèµæºéæ¯">é¶æ®µåï¼èµæºéæ¯</h4>
<ol>
<li>ç©ºé²æ£æµï¼Agent å®æä»»å¡ï¼ä¸ååéè¯·æ±ã</li>
<li>èªå¨åæ¶ï¼è¾¾å° SessionIdleTimeoutï¼å¦ 5 åéï¼åï¼å½æ°è®¡ç®ä¼èªå¨éæ¯è¯¥æ²ç®±å®ä¾ï¼æ­¤æ¶é¤äºæä¹åå° NAS ä¸çæ°æ®ï¼å¶ä½ç¯å¢ç¸å³æ°æ®åè¢«éæ¯ã</li>
<li>æä»¶åæ¶ï¼å¦æ NAS ä¸çæä»¶æ¯ä¼è¯éç¦»çï¼å½ç¨æ·ä¼è¯ç»æåï¼NAS ä¸æä»¶éè¦è¿è¡ä¸»å¨æèå®æ¶èªå¨æ¸é¤ã</li>
</ol>
<h4 id="å·¥ä½æ¶åºå¾">å·¥ä½æ¶åºå¾</h4>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260122172746341-181572588.png" class="lazyload"></p>
<h2 id="agentrun-çæ ¸å¿è®¾è®¡åå">AgentRun çæ ¸å¿è®¾è®¡åå</h2>
<p>AgentRun çå·¥ç¨åå®è·µéµå¾ªä»¥ä¸äºå¤§æ ¸å¿ååï¼è¿ææäºå¶å®å¨ãé«æãå¯æ©å±çåºç³ï¼</p>
<h3 id="ååä¸éç½®å³ä»£ç ">ååä¸ï¼éç½®å³ä»£ç </h3>
<p>AgentRun å°æ²ç®±ç¯å¢å®ä¹ï¼ç¯å¢åéãèµæºè§æ ¼ãå¥åº·æ£æ¥ç­ï¼å°è£ä¸ºæ ååæ¨¡çãè¿ç§è®¾è®¡å®ç°äºæ²ç®±éç½®ççæ¬åç®¡çï¼ä½¿å¾ Agent ç¯å¢å¯ä»¥åä»£ç ä¸æ ·è¿è¡å¤å¶ååæ»ã</p>
<h3 id="ååäºä¼è¯å³æ²ç®±">ååäºï¼ä¼è¯å³æ²ç®±</h3>
<p>AgentRun å°âä¼è¯âä½ä¸ºæ²ç®±çå¯ä¸å®ä½ãéè¿ SessionID ç»å®åºå±çè®¡ç®å®ä¾ä¸ä¸ä¸æç¶æï¼å®ç°äºçæ­£çæéåéä¸ç¶æä¿æãæ²ç®±çåå»ºä¸éæ¯å®å¨ç¬ç«äºåºå±ç©çè®¾æ½ï¼å¯¹ç¨æ·éæã</p>
<h3 id="ååä¸çå½å¨æå¯ç¼ç¨">ååä¸ï¼çå½å¨æå¯ç¼ç¨</h3>
<p>AgentRun ä¸ä»æä¾åå»ºï¼Createï¼åå é¤ï¼Deleteï¼æ¥å£ï¼è¿å¼å¥äºâæåâãâæ¢å¤âåâèªå¨è¶æ¶âæºå¶ãè¿ç§å¯ç¼ç¨æ§è®©ä¸å±åºç¨è½æ ¹æ®ä¸å¡ä»·å¼æå¤§åèµæºå©ç¨çï¼å®ç°ææ¬ä¸æ§è½çæä¼å¹³è¡¡ã</p>
<h3 id="åååç½ç»æ¥å¥æ åå">åååï¼ç½ç»æ¥å¥æ åå</h3>
<p>AgentRun æ¹å¹³äºåºå±ç½ç»çå·®å¼ï¼æä¾æ ååç HTTP/WebSocket æ¥å£ï¼å¹¶æ¯æ Server-Sent Eventsï¼SSEï¼ãæ è®ºåºå±å¦ä½åçº§ï¼ä¸å± Agent æ²ç®±å§ç»éè¿æ åç Header æ Cookie æºå¸¦ SessionID è¿è¡äº¤äºï¼éä½äºéæå¤æåº¦ã</p>
<h3 id="ååäºå­å¨éç¦»ç»ç²åº¦åå³å°ä¸çº¿">ååäºï¼å­å¨éç¦»ç»ç²åº¦åï¼å³å°ä¸çº¿ï¼</h3>
<p>AgentRun ä¸ä»æ¯ææ¨¡çç²åº¦çæä»¶ç³»ç»å±äº«ï¼åæ¶ä¹è½å¤éç½®æ²ç®±ç²åº¦ç®å½çº§å¨ææè½½ãæ¯ä¸ªæ²ç®±åç¬æè½½ä¸ä¸ªç®å½ï¼ä»æ ¹æºä¸æç»äºå¤ç§æ·ç¯å¢ä¸çæ°æ®è¶æè®¿é®é£é©ã</p>
<h2 id="æ»ç»ä¸å±æ">æ»ç»ä¸å±æ</h2>
<p>AgentRun Sandbox æ¯ Serverless ææ¯å¨ AI Agent é¢åçæä½³å·¥ç¨åå®è·µã</p>
<p>éè¿å°é¿éäºå½æ°è®¡ç®ï¼FCï¼å¨ <strong>RunD å®å¨èæå</strong>ï¼è§£å³éç¦»ä¸å¯å¨éåº¦ï¼ã<strong>ä¼è¯äº²åæ§</strong>ï¼è§£å³ç¶æä¿æï¼ä»¥å <strong>å¨æ NAS æè½½</strong>ï¼è§£å³æ°æ®éç¦»ï¼ç­æ¹é¢çåºå±ææ¯åæ°ï¼å°è£ä¸ºé¢åä¸å¡ç AgentRun å¹³å°ï¼æä»¬æåéä½äºä¼ä¸æå»º AI Agent çé¨æ§ã</p>
<p>å¯¹äºæå»ºä¸ä¸ä»£æºè½ä½åºç¨çä¼ä¸èè¨ï¼éæ© AgentRun Sandbox ä¸ä»æ¯éæ©äºä¸ä¸ªæ²ç®±å·¥å·ï¼æ´æ¯éæ©äºä¸å¥å¼é¡¾å®å¨æ§ãç¨æ·ä½éªä¸åä¸æççå¼¹æ§åºç¡è®¾æ½ãæªæ¥ï¼AgentRun Sandbox å°ç»§ç»­å¨å¯å¨å»¶è¿ä¼åãç¶æç§çº§å¿«ç§æ¢å¤ä»¥åæ´å¤æ ·åçå­å¨æ¯æä¸æ·±èï¼è´åäºæä¸º AI Agent æ¶ä»£æä½³çæ²ç®±åºåº§ã</p>
<h2 id="ç«å³ä½éªå½æ°è®¡ç®-agentrun">ç«å³ä½éªå½æ°è®¡ç® AgentRun</h2>
<p>å½æ°è®¡ç® AgentRun çæ ä»£ç å°é«ä»£ç æ¼è¿è½åï¼ç°å·²å¼æ¾ä½éªï¼</p>
<p><strong>æ¥çæ´å¤äº§åè¯¦æ</strong>ï¼<a href="https://www.aliyun.com/product/fc/agentrun" target="_blank" rel="noopener nofollow">https://www.aliyun.com/product/fc/agentrun</a></p>
<p>1.<strong>å¿«éåå»º</strong>ï¼è®¿é®æ§å¶å°ï¼<a href="https://functionai.console.aliyun.com/cn-hangzhou/agent/explore" target="_blank" rel="noopener nofollow">https://functionai.console.aliyun.com/cn-hangzhou/agent/explore</a>)ï¼60ç§åå»ºä½ çç¬¬ä¸ä¸ª Agent</p>
<p>2.<strong>æ·±åº¦å®å¶</strong>ï¼å½éè¦æ´å¤æåè½æ¶ï¼ä¸é®è½¬æ¢ä¸ºé«ä»£ç <br>
3.<strong>æç»­æ¼è¿</strong>ï¼å©ç¨å½æ°è®¡ç® AgentRun çåºç¡è®¾æ½è½åï¼æç»­ä¼åä½ ç Agent</p>
<p>ä»æ³æ³å°ä¸çº¿ï¼ä»ååå°çäº§ï¼å½æ°è®¡ç® AgentRun å§ç»æ¯ä½ æå¥½çä¼ä¼´ãæ¬¢è¿å å¥âå½æ°è®¡ç® AgentRun å®¢æ·ç¾¤âï¼ééç¾¤å·ï¼134570017218ã</p>
<h3 id="å¿«éäºè§£å½æ°è®¡ç®-agentrun">å¿«éäºè§£å½æ°è®¡ç® AgentRun</h3>
<p>ä¸å¥è¯ä»ç»ï¼å½æ°è®¡ç® AgentRun æ¯ä¸ä¸ªä»¥é«ä»£ç ä¸ºæ ¸å¿çä¸ç«å¼ Agentic AI åºç¡è®¾æ½å¹³å°ãç§æçæå¼æ¾åçµæ´»ç»è£ççå¿µï¼ä¸ºä¼ä¸çº§ Agent åºç¨æä¾ä»å¼åãé¨ç½²å°è¿ç»´çå¨çå½å¨æç®¡çã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260122172746376-1495994792.png" class="lazyload"></p>
<p>å½æ°è®¡ç® AgentRun æ¶æå¾</p>
<p>AgentRun è¿è¡æ¶åºäºé¿éäºå½æ°è®¡ç® FC æå»ºï¼ç»§æ¿äº Serverless è®¡ç®æè´å¼¹æ§ãæéä»è´¹ãé¶è¿ç»´çæ ¸å¿ä¼å¿ãéè¿æ·±åº¦éæ AgentScopeãLangChainãRAGFlowãMem0 ç­ä¸»æµå¼æºçæãå½æ°è®¡ç® AgentRun å° Serverless çæè´å¼¹æ§ãé¶è¿ç»´åæéä»è´¹çç¹æ§ä¸ AI åçåºç¨åºæ¯æ·±åº¦èåï¼å©åä¼ä¸å®ç°ææ¬ä¸æççæè´ä¼åï¼<strong>å¹³å TCO éä½ 60%</strong>ã</p>
<p><strong>è®©å¼åèåªéä¸æ³¨äº Agent çä¸å¡é»è¾åæ°ï¼æ éå³å¿åºå±åºç¡è®¾æ½ï¼è®© Agentic AI çæ­£è¿å¥ä¼ä¸çäº§ç¯å¢ã</strong></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-22 17:28">2026-01-22 17:28</span>&nbsp;
<a href="https://www.cnblogs.com/Serverless">Serverlessç¤¾åº</a>&nbsp;
éè¯»(<span id="post_view_count">7</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19518412);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19518412', targetLink: 'https://www.cnblogs.com/Serverless/p/19518412', title: 'æ¢ç§ AgentRunï½åºäº Serverless ç AI Agent æ²ç®±å·¥ç¨åä¹è·¯' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ç©è½¬ ZooKeeper ]]></title>
    <link>https://www.cnblogs.com/Marktowin/p/19518265</link>
    <guid>f299e6a6760750710f6ce57bdde1dc1a</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Marktowin/p/19518265" title="åå¸äº 2026-01-22 17:22">
    <span role="heading" aria-level="2">ç©è½¬ ZooKeeper</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p dir="auto">Apache ZooKeeper æ¯ä¸ä¸ªå¼æºçåå¸å¼åè°æå¡ï¼ç¨äºåå¸å¼ç³»ç»ä¸­ç»´æ¤éç½®ä¿¡æ¯ãå½åãæä¾åå¸å¼åæ­¥åç»æå¡ãä¸é¢æ ¹æ®æ¨çè¦æ±ï¼è¯¦ç»è¯´æ ZooKeeper çäº§çåå ãæåä½¿ç¨ãææ°çä½¿ç¨ãä¸åçæ¬çæ´æ°ç¹ãå®ç°åçãé¨ç½²åä½¿ç¨ãåå®¹åºäºå®æ¹ææ¡£åå¯é æ¥æºæ´çï¼å¹¶åå« Java ä»£ç çæ®µç¤ºä¾ï¼ZooKeeper ä¸»è¦ä½¿ç¨ Java APIï¼ã</p>
<p dir="auto">&nbsp;</p>
<h3 dir="auto">1. äº§çåå </h3>
<p dir="auto">ZooKeeper çäº§çæ¯ä¸ºäºè§£å³åå¸å¼ç³»ç»ä¸­åè°çå¤æé®é¢ãå¨å¤§è§æ¨¡åå¸å¼ç³»ç»ä¸­ï¼å¤ä¸ªèç¹éè¦åè°éç½®ãç¶æåæ­¥ãé¢å¯¼èéä¸¾ç­ä»»å¡ï¼ä½èªè¡å®ç°è¿äºåè½å®¹æå¼å¥éè¯¯ï¼å¦ç«äºæ¡ä»¶ï¼race conditionsï¼åæ­»éï¼deadlockï¼ãZooKeeper å Google ç Chubby lock service å¯åï¼ç± Yahoo! Research å¢éå¼åï¼ç¨äºç®åè¿äºåè°ä»»å¡ãå®æä¾äºä¸ä¸ªå¯é çãé«æ§è½çåè°åæ ¸ï¼è®©åºç¨ç¨åºå¼åèä¸æ³¨äºä¸å¡é»è¾ï¼èééæ°åæåå¸å¼åè°æºå¶ãæåæ¯ä¸ºäºç®¡ç Yahoo! çå¤§æ°æ®éç¾¤èåå»ºï¼å°ç¶æå­å¨å¨æ¬å°æ¥å¿æä»¶ä¸­ï¼ç¡®ä¿é«å¯ç¨æ§åä¸è´æ§ã</p>
<p dir="auto">&nbsp;</p>
<h3 dir="auto">2. æ©æä½¿ç¨</h3>
<p dir="auto">ZooKeeper æåå¨ Yahoo! åé¨ç¨äºå·¥ä¸çº§åºç¨ï¼åæ¬ï¼</p>
<ul dir="auto">
<li><strong>Yahoo! Message Broker</strong>ï¼åè°åæéæ¢å¤æå¡ï¼ç¨äºç®¡çæ°åä¸ªä¸»é¢çå¯æ©å±åå¸-è®¢éç³»ç»ã</li>
<li><strong>Yahoo! Crawler ç Fetching Service</strong>ï¼ç¨äºæéæ¢å¤ï¼ç¡®ä¿ç¬è«ä»»å¡çå¯é æ§è¡ã</li>
<li><strong>Yahoo! å¹¿åç³»ç»</strong>ï¼æä¾å¯é çæå¡åè°ï¼å¦å½åæå¡ãéç½®ç®¡çåæ°æ®åæ­¥ã å¸åæ©æç¨ä¾åæ¬å½åæå¡ï¼ç±»ä¼¼ DNSï¼ãéç½®ç®¡çï¼éä¸­å­å¨éç½®ï¼ãæ°æ®åæ­¥ï¼éæºå¶ï¼ãé¢å¯¼èéä¸¾ï¼éä¸»ï¼åæ¶æ¯éåãZooKeeper è¢«è®¾è®¡ä¸ºè¯»ä¸»å¯¼åï¼è¯»åæ¯çº¦ 10:1ï¼ï¼éç¨äºè¿è¡å¨æ°åå°æºå¨ä¸çåå¸å¼ç¯å¢ã</li>
</ul>
<p>&nbsp;</p>
<h3 dir="auto">3. å½åä½¿ç¨</h3>
<p dir="auto">å¦ä»ï¼ZooKeeper å¹¿æ³ç¨äºå¤§æ°æ®ååå¸å¼ç³»ç»ä¸­ï¼ä½ä¸ºåè°åæ ¸ãå¸¸è§ç¨ä¾åæ¬ï¼</p>
<ul dir="auto">
<li><strong>éç½®ç®¡ç</strong>ï¼éä¸­å­å¨åæ´æ°åå¸å¼åºç¨çéç½®ï¼å¦ Apache Kafka ç¨äºå­å¨æ¶è´¹èåç§»éï¼ç´å° 4.0 çæ¬ï¼ã</li>
<li><strong>é¢å¯¼èéä¸¾</strong>ï¼å¨éç¾¤ä¸­éä¸¾ä¸»èç¹ï¼å¦ Apache HBase ç¨äºåºååéåä¸»æéè½¬ç§»ï¼ã</li>
<li><strong>åå¸å¼é</strong>ï¼å®ç°äºæ¥è®¿é®ï¼å¦ Apache Accumulo ç¨äºæ åç¹æéæ¶æï¼ã</li>
<li><strong>ç»æåç®¡ç</strong>ï¼è·è¸ªèç¹å å¥/ç¦»å¼ï¼å¦ Apache Druid ç¨äºéç¾¤ç¶æç®¡çï¼ã</li>
<li><strong>å¶ä»</strong>ï¼ç¨äº Apache HadoopãHDFSãSolrãKafkaï¼æ©æçæ¬ï¼ãPulsar ç­ãææ°è¶å¿åæ¬åå°å¯¹ ZooKeeper çä¾èµï¼å¦ Pulsar éè¿ PIP-45 å¼å¥å¯ææåæ°æ®æ¡æ¶ï¼åè®¸æ  ZooKeeper è¿è¡ï¼ï¼ä½å¨ä¼ ç»ç³»ç»ä¸­ä»ä¸å¯æç¼ºãç°ä»£åºç¨å¼ºè°å¶å¨äºç¯å¢ä¸­çé«å¯ç¨æ§ï¼å¦å¨ Kubernetes ä¸­åè°å¾®æå¡ã</li>
</ul>
<p>&nbsp;</p>
<h3 dir="auto">4. ä¸åçæ¬</h3>
<p dir="auto">ZooKeeper ççæ¬æ¼è¿èç¦äºæ§è½ãå®å¨ãå¼å®¹æ§åæ°åè½ãä»¥ä¸è¡¨æ ¼æ»ç»ä» 3.4.x å¼å§çä¸»è¦çæ¬æ´æ°ï¼åºäºå®æ¹åå¸ç¬è®°ï¼å½åç¨³å®ç 3.8.xï¼å½åç 3.9.xï¼ãEoLï¼End-of-Lifeï¼çæ¬ä¸åæ¥æ¶ç¤¾åºæ¯æã</p>
<table>
<thead>
<tr><th data-col-size="sm">çæ¬ç³»å</th><th data-col-size="md">é¦æ¬¡åå¸æ¥æ</th><th data-col-size="md">EoL æ¥æ</th><th data-col-size="xl">ä¸»è¦æ´æ°ç¹</th></tr>
</thead>
<tbody>
<tr>
<td data-col-size="sm"><strong>3.4.x</strong></td>
<td data-col-size="md">2011 å¹´</td>
<td data-col-size="md">2016 å¹´</td>
<td data-col-size="xl">åºç¡ç¨³å®çï¼æ¯æåºæ¬ APIãå¤å¶æ¨¡å¼ï¼æ§è½ä¼åï¼ç¨äº Hadoop å­é¡¹ç®ã</td>
</tr>
<tr>
<td data-col-size="sm"><strong>3.5.x</strong></td>
<td data-col-size="md">2019 å¹´ 5 æ (3.5.5 ä½ä¸ºç¨³å®ç)</td>
<td data-col-size="md">2022 å¹´ 6 æ</td>
<td data-col-size="xl">æ·»å å¨æééç½®ãæ¬å°ä¼è¯ãå®¹å¨/TTL èç¹ãSSL æ¯æåå­å¹¿æ­åè®®ãå¯ç§»é¤çè§å¨ãå¤çº¿ç¨æäº¤å¤çå¨ãåçº§ Netty 4.1ãMaven æå»ºï¼æå° JDK 1.8ï¼ä¿®å¤ CVE åå¼å®¹æ§é®é¢ã</td>
</tr>
<tr>
<td data-col-size="sm"><strong>3.6.x</strong></td>
<td data-col-size="md">2020 å¹´ 3 æ</td>
<td data-col-size="md">2022 å¹´ 12 æ</td>
<td data-col-size="xl">æ§è½åå®å¨æ¹è¿ï¼æ° APIï¼å¦æ°¸ä¹éå½çè§ï¼ï¼ç§»é¤ Log4j1ï¼ä½¿ç¨ reload4jï¼ä¿®å¤ CVEãå¿«ç§å SASL é®é¢ï¼å®¢æ·ç«¯å¼å®¹ 3.5.x æå¡å¨ã</td>
</tr>
<tr>
<td data-col-size="sm"><strong>3.7.x</strong></td>
<td data-col-size="md">2021 å¹´ 3 æ</td>
<td data-col-size="md">2024 å¹´ 2 æ</td>
<td data-col-size="xl">æ° APIï¼å¦å¯å¨æå¡å¨ãwhoamiï¼ï¼éé¢å¼ºå¶ï¼ä¸»æºåè§èåï¼BCKFS å¯é¥/ä¿¡ä»»å­å¨ï¼å¿éè®¤è¯æ¹æ¡ï¼å¤ SASL superUsersï¼å¿«éè·è¸ªèæµè¯·æ±ï¼å®å¨ææ ï¼C/Perl SASL æ¯æï¼zkSnapshotComparer å·¥å·ï¼YCSB åºåæµè¯è¯´æï¼ä¿®å¤ 64+ ä¸ªé®é¢ï¼åæ¬ CVEã</td>
</tr>
<tr>
<td data-col-size="sm"><strong>3.8.x</strong> (å½åç¨³å®)</td>
<td data-col-size="md">2022 å¹´ 3 æ</td>
<td data-col-size="md">-</td>
<td data-col-size="xl">æ¥å¿æ¡æ¶è¿ç§»å° LogBackï¼ä»æä»¶è¯»åå¯é¥/ä¿¡ä»»å­å¨å¯ç ï¼æ¢å¤ OSGI æ¯æï¼åå° Prometheus ææ æ§è½å½±åï¼JDK17 æ¯æï¼ç¬¬ä¸æ¹ä¾èµæ´æ°ä¿®å¤ææ CVEï¼ä¿®å¤åæ­¥ãC å®¢æ·ç«¯æµè¯ç­é®é¢ã</td>
</tr>
<tr>
<td data-col-size="sm"><strong>3.9.x</strong> (å½å)</td>
<td data-col-size="md">2023 å¹´ 8 æ</td>
<td data-col-size="md">-</td>
<td data-col-size="xl">ç®¡çåæå¡å¨ APIï¼å¿«ç§åæ°æ®æµåºï¼ï¼éä¿¡ Zxid è§¦å WatchEventï¼TLS å¨æå è½½å®¢æ·ç«¯ä¿¡ä»»/å¯é¥å­å¨ï¼Netty-TcNative OpenSSL æ¯æï¼SSL æ¯æ Zktreeutilï¼æ¹è¿ syncRequestProcessor æ§è½ï¼ç¬¬ä¸æ¹ä¾èµæ´æ°ä¿®å¤ CVEã</td>
</tr>
</tbody>
</table>
<p dir="auto">å¼å®¹æ§ï¼3.5.x+ å®¢æ·ç«¯å¼å®¹ 3.9.x æå¡å¨ï¼3.9.x å®¢æ·ç«¯å¼å®¹ 3.5-3.8.x æå¡å¨ï¼ä¸ä½¿ç¨æ° APIï¼ã</p>
<p dir="auto">&nbsp;</p>
<h3 dir="auto">5. å®ç°åç</h3>
<p dir="auto">ZooKeeper çæ ¸å¿æ¯æä¾ä¸ä¸ªç®åãé«å¯é çåå¸å¼åè°æå¡ãå¶æ¶æåºäºå®¢æ·ç«¯-æå¡å¨æ¨¡åï¼ä½¿ç¨ ZABï¼ZooKeeper Atomic Broadcastï¼åè®®ï¼ç±»ä¼¼äº Paxosï¼å®ç°ä¸è´æ§ã</p>
<ul dir="auto">
<li><strong>æ¶æç»ä»¶</strong>ï¼
<ul dir="auto">
<li><strong>Ensembleï¼éç¾¤ï¼</strong>ï¼ç±å¥æ°ä¸ªæå¡å¨ç»æï¼æå° 3 ä¸ªï¼ï¼ç¡®ä¿å¤æ°æ´¾ï¼quorumï¼å¯ç¨ãåæ¬ Leaderï¼é¢å¯¼èï¼å¤çåæä½ï¼ãFollowerï¼è¿½éèï¼å¤çè¯»æä½å¹¶è½¬ååå° Leaderï¼å Observerï¼è§å¯èï¼åªå¤çè¯»ï¼ä¸åä¸éä¸¾/æç¥¨ï¼æé«è¯»æ§è½ï¼ã</li>
<li><strong>æ°æ®æ¨¡å</strong>ï¼åå±å½åç©ºé´ï¼åæä»¶ç³»ç»ï¼znodesï¼èç¹ï¼å¯å­å¨æ°æ®åå­èç¹ï¼ãæ¯ææä¹èç¹ï¼persistentï¼åä¸´æ¶èç¹ï¼ephemeralï¼ä¼è¯ç»æå é¤ï¼ãæ°æ®å¨åå­ä¸­å­å¨ï¼é«æ§è½ï¼ï¼å¹¶æä¹åå°æ¥å¿åå¿«ç§ã</li>
<li><strong>ä¸è´æ§ä¿è¯</strong>ï¼é¡ºåºä¸è´æ§ï¼æ´æ°æåéé¡ºåºåºç¨ï¼ãåå­æ§ï¼æ´æ°å¨æåæå¨å¤±è´¥ï¼ãåä¸ç³»ç»æ åï¼å®¢æ·ç«¯æ è®ºè¿æ¥åªä¸ªæå¡å¨ï¼çå°ç¸åè§å¾ï¼ãå¯é æ§ï¼æ´æ°æä¹åï¼ãåæ¶æ§ï¼è§å¾å¨çéåæ´æ°ï¼ã</li>
<li><strong>å·¥ä½æµç¨</strong>ï¼å®¢æ·ç«¯è¿æ¥ä»»ææå¡å¨ãåè¯·æ±è½¬åå° Leaderï¼éè¿ ZAB å¹¿æ­å° Followerï¼éå¤æ°åæï¼ãè¯»è¯·æ±æ¬å°å¤çãä½¿ç¨çè§ï¼watchesï¼éç¥ååï¼ä¸æ¬¡æ§è§¦åï¼æ°çæ¯ææ°¸ä¹éå½çè§ï¼ãä¼è¯ï¼sessionsï¼éè¿å¿è·³ç»´æ¤ï¼æ­è¿èªå¨éè¿ã</li>
<li><strong>é¢å¯¼èéä¸¾</strong>ï¼ä½¿ç¨å¿«é Paxos åä½ï¼å´©æºæ¶å¿«ééä¸¾æ° Leaderï¼&lt;200msï¼ã</li>
<li><strong>æ§è½åç</strong>ï¼åå­éå + äºå¡æ¥å¿ï¼è¯»ä¸»å¯¼ä¼åï¼åå­æ¶æ¯åè®®é²æ­¢å¯æ¬åæ­§ã</li>
</ul>
</li>
</ul>
<p dir="auto">ZooKeeper éç¨äºè¯»å¤åå°åºæ¯ï¼æä¾ç®å APIï¼å¦ createãdeleteãgetãsetï¼ã</p>
<p dir="auto">&nbsp;</p>
<h3 dir="auto">6. æ¡ä¾ï¼éä¸¾leaderæ§è¡ä»»å¡ï¼</h3>
<p dir="auto">å¨åå¸å¼ç³»ç»ä¸­ï¼ZooKeeperï¼ZKï¼å¸¸ç¨äºåè°éç¾¤ä¸­çèç¹ï¼ç¡®ä¿é«å¯ç¨æ§åä¸è´æ§ãä¸é¢æç»åºä¸ä¸ªè¯¦ç»çä¾å­ï¼ä¸ä¸ªç®åç <strong>åå¸å¼ä»»å¡è°åº¦æå¡</strong>ï¼é¨ç½²å¨éç¾¤ä¸­ï¼ä½¿ç¨ ZooKeeper å®ç° <strong>é¢å¯¼èéä¸¾ï¼Leader Electionï¼</strong>ãè¿ä¸ªæå¡æ¨¡æä¸ä¸ªå®æ¶ä»»å¡ï¼å¦æ°æ®å¤ä»½ï¼ï¼ä½åªæä¸ä¸ªèç¹ï¼Leaderï¼æ§è¡ä»»å¡ï¼å¶ä»èç¹ï¼Followerï¼å¾å½ãå¦æ Leader å®æºï¼Follower ä¼èªå¨éä¸¾æ° Leaderã</p>
<p dir="auto"><strong>ä¸ä¸ª 3 èç¹éç¾¤çåå¸å¼ä»»å¡è°åº¦æå¡</strong></p>
<ul dir="auto">
<li>3 å°æå¡å¨ï¼ç©çæºæèææºï¼ï¼node1ãnode2ãnode3</li>
<li>æ¯ä¸ªèç¹è¿è¡ä¸ä¸ªç¸åç Java JAR å</li>
<li>ä½¿ç¨ ZooKeeper å®ç°<strong>é¢å¯¼èéä¸¾</strong>ï¼åªæä¸ä¸ªèç¹æä¸º Leader æ§è¡å®æ¶ä»»å¡ï¼å¶ä»èç¹ä½ä¸º Follower å¾å½</li>
<li>Leader å®æºåï¼èªå¨å¿«ééä¸¾æ° Leader</li>
</ul>
<p dir="auto"><strong>ç¯å¢åå¤ï¼3 å°æå¡å¨ï¼</strong></p>
<table>
<thead>
<tr><th data-col-size="md">ä¸»æºå</th><th data-col-size="md">IP</th><th data-col-size="xl">è§è²</th><th data-col-size="lg">è¯´æ</th></tr>
</thead>
<tbody>
<tr>
<td data-col-size="md">node1</td>
<td data-col-size="md">192.168.1.101</td>
<td data-col-size="xl">ZooKeeper + Java æå¡</td>
<td data-col-size="lg">ZooKeeper myid=1</td>
</tr>
<tr>
<td data-col-size="md">node2</td>
<td data-col-size="md">192.168.1.102</td>
<td data-col-size="xl">ZooKeeper + Java æå¡</td>
<td data-col-size="lg">ZooKeeper myid=2</td>
</tr>
<tr>
<td data-col-size="md">node3</td>
<td data-col-size="md">192.168.1.103</td>
<td data-col-size="xl">ZooKeeper + Java æå¡</td>
<td data-col-size="lg">ZooKeeper myid=3</td>
</tr>
</tbody>
</table>
<p dir="auto"><strong>ææèç¹å®è£ Java</strong></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">sudo apt update
sudo apt install openjdk</span>-11-jdk  # Ubuntu/<span style="color: rgba(0, 0, 0, 1)">Debian# æ CentOS
sudo yum install java</span>-11-openjdk-devel</pre>
</div>
<p dir="auto"><strong>ææèç¹å®è£ ZooKeeper éç¾¤</strong></p>
<div class="cnblogs_code">
<pre>wget https:<span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">downloads.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz</span>
tar -zxvf apache-zookeeper-3.8.4-<span style="color: rgba(0, 0, 0, 1)">bin.tar.gz
sudo mv apache</span>-zookeeper-3.8.4-bin /opt/<span style="color: rgba(0, 0, 0, 1)">zookeeper
cd </span>/opt/zookeeper</pre>
</div>
<p dir="auto"><strong>éç½® conf/zoo.cfgï¼ææèç¹é½ç¸åï¼</strong></p>
<div class="cnblogs_code">
<pre>cp conf/zoo_sample.cfg conf/<span style="color: rgba(0, 0, 0, 1)">zoo.cfg
vi conf</span>/zoo.cfg</pre>
</div>
<p><strong>åå®¹å¦ä¸</strong></p>
<div class="cnblogs_code">
<pre>tickTime=2000<span style="color: rgba(0, 0, 0, 1)">
initLimit</span>=10<span style="color: rgba(0, 0, 0, 1)">
syncLimit</span>=5<span style="color: rgba(0, 0, 0, 1)">
dataDir</span>=/var/lib/<span style="color: rgba(0, 0, 0, 1)">zookeeper
clientPort</span>=2181<span style="color: rgba(0, 0, 0, 1)">
# éç¾¤æå¡å¨åè¡¨
server.</span>1=192.168.1.101:2888:3888<span style="color: rgba(0, 0, 0, 1)">
server.</span>2=192.168.1.102:2888:3888<span style="color: rgba(0, 0, 0, 1)">
server.</span>3=192.168.1.103:2888:3888</pre>
</div>
<p dir="auto"><strong>åå»ºæ°æ®ç®å½å¹¶è®¾ç½® myidï¼æ¯ä¸ªèç¹ä¸åï¼ï¼</strong></p>
<div class="cnblogs_code">
<pre>sudo mkdir -p /var/lib/<span style="color: rgba(0, 0, 0, 1)">zookeeper
sudo chown </span>-R $USER:$USER /var/lib/zookeeper</pre>
</div>
<p>ããnode1:</p>
<div class="cnblogs_code">
<pre>echo "1" &gt; /var/lib/zookeeper/myid</pre>
</div>
<p>ããnode2:</p>
<div class="cnblogs_code">
<pre>echo "2" &gt; /var/lib/zookeeper/myid</pre>
</div>
<p>ããnode3:</p>
<div class="cnblogs_code">
<pre>echo "3" &gt; /var/lib/zookeeper/myid</pre>
</div>
<p dir="auto"><strong>å¯å¨ ZooKeeperï¼ææèç¹ï¼ï¼</strong></p>
<div class="cnblogs_code">
<pre>/opt/zookeeper/bin/zkServer.sh start</pre>
</div>
<p dir="auto"><strong>éªè¯éç¾¤ç¶æï¼</strong></p>
<div class="cnblogs_code">
<pre>/opt/zookeeper/bin/zkServer.sh status</pre>
</div>
<p dir="auto">åºè¯¥çå°ä¸ä¸ª Leader åä¸¤ä¸ª Followerã</p>
<p dir="auto">&nbsp;<strong>JAVAä»£ç </strong></p>
<p dir="auto">LeaderElection.javaï¼é¢å¯¼èéä¸¾æ ¸å¿ï¼ï¼å¤çè¿æ¥ ZooKeeperãåå»ºèç¹ãçè§åååéä¸¾é»è¾ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">package</span><span style="color: rgba(0, 0, 0, 1)"> com.example;

</span><span style="color: rgba(0, 0, 255, 1)">import</span> org.apache.zookeeper.*<span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> org.apache.zookeeper.data.Stat;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> org.slf4j.Logger;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> org.slf4j.LoggerFactory;

</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> java.io.IOException;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> java.util.Collections;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> java.util.List;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> java.util.concurrent.CountDownLatch;

</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span> LeaderElection <span style="color: rgba(0, 0, 255, 1)">implements</span><span style="color: rgba(0, 0, 0, 1)"> Watcher {
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">final</span> Logger logger = LoggerFactory.getLogger(LeaderElection.<span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)">);

    </span><span style="color: rgba(0, 0, 255, 1)">private</span><span style="color: rgba(0, 0, 0, 1)"> ZooKeeper zk;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span><span style="color: rgba(0, 0, 0, 1)"> String zkConnectString;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> sessionTimeout;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span><span style="color: rgba(0, 0, 0, 1)"> String electionPath;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span><span style="color: rgba(0, 0, 0, 1)"> String nodeId;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> String currentZnodePath;  <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å½åèç¹çè·¯å¾ï¼å¦ /election/node-0000000001</span>
    <span style="color: rgba(0, 0, 255, 1)">private</span> CountDownLatch connectedLatch = <span style="color: rgba(0, 0, 255, 1)">new</span> CountDownLatch(1<span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> TaskService taskService;  <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä»»å¡æå¡å¼ç¨</span>

    <span style="color: rgba(0, 0, 255, 1)">public</span> LeaderElection(String zkConnectString, <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> sessionTimeout, String electionPath, String nodeId, TaskService taskService) {
        </span><span style="color: rgba(0, 0, 255, 1)">this</span>.zkConnectString =<span style="color: rgba(0, 0, 0, 1)"> zkConnectString;
        </span><span style="color: rgba(0, 0, 255, 1)">this</span>.sessionTimeout =<span style="color: rgba(0, 0, 0, 1)"> sessionTimeout;
        </span><span style="color: rgba(0, 0, 255, 1)">this</span>.electionPath =<span style="color: rgba(0, 0, 0, 1)"> electionPath;
        </span><span style="color: rgba(0, 0, 255, 1)">this</span>.nodeId =<span style="color: rgba(0, 0, 0, 1)"> nodeId;
        </span><span style="color: rgba(0, 0, 255, 1)">this</span>.taskService =<span style="color: rgba(0, 0, 0, 1)"> taskService;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">void</span> connect() <span style="color: rgba(0, 0, 255, 1)">throws</span><span style="color: rgba(0, 0, 0, 1)"> IOException, InterruptedException {
        zk </span>= <span style="color: rgba(0, 0, 255, 1)">new</span> ZooKeeper(zkConnectString, sessionTimeout, <span style="color: rgba(0, 0, 255, 1)">this</span><span style="color: rgba(0, 0, 0, 1)">);
        connectedLatch.await();  </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ç­å¾è¿æ¥æå</span>
<span style="color: rgba(0, 0, 0, 1)">    }

    @Override
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> process(WatchedEvent event) {
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (event.getState() ==<span style="color: rgba(0, 0, 0, 1)"> Event.KeeperState.SyncConnected) {
            connectedLatch.countDown();
        } </span><span style="color: rgba(0, 0, 255, 1)">else</span> <span style="color: rgba(0, 0, 255, 1)">if</span> (event.getType() ==<span style="color: rgba(0, 0, 0, 1)"> Event.EventType.NodeDeleted) {
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åä¸ä¸ªèç¹å é¤ï¼éæ°æ£æ¥æ¯å¦æä¸º Leader</span>
            <span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)"> {
                checkIfLeader();
            } </span><span style="color: rgba(0, 0, 255, 1)">catch</span> (KeeperException |<span style="color: rgba(0, 0, 0, 1)"> InterruptedException e) {
                logger.error(</span>"Error checking leader"<span style="color: rgba(0, 0, 0, 1)">, e);
            }
        }
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">void</span> participateInElection() <span style="color: rgba(0, 0, 255, 1)">throws</span><span style="color: rgba(0, 0, 0, 1)"> KeeperException, InterruptedException {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ç¡®ä¿éä¸¾è·¯å¾å­å¨ï¼æä¹èç¹ï¼</span>
        Stat stat = zk.exists(electionPath, <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">);
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (stat == <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">) {
            zk.create(electionPath, </span><span style="color: rgba(0, 0, 255, 1)">new</span> <span style="color: rgba(0, 0, 255, 1)">byte</span>[0<span style="color: rgba(0, 0, 0, 1)">], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);
        }

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå»ºä¸´æ¶é¡ºåºèç¹</span>
        currentZnodePath = zk.create(electionPath + "/" + nodeId + "-", <span style="color: rgba(0, 0, 255, 1)">new</span> <span style="color: rgba(0, 0, 255, 1)">byte</span>[0<span style="color: rgba(0, 0, 0, 1)">], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);
        logger.info(</span>"Created znode: {}"<span style="color: rgba(0, 0, 0, 1)">, currentZnodePath);

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ£æ¥æ¯å¦æ¯ Leader</span>
<span style="color: rgba(0, 0, 0, 1)">        checkIfLeader();
    }

    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">void</span> checkIfLeader() <span style="color: rgba(0, 0, 255, 1)">throws</span><span style="color: rgba(0, 0, 0, 1)"> KeeperException, InterruptedException {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è·åææå­èç¹ï¼æåºå·æåº</span>
        List&lt;String&gt; children = zk.getChildren(electionPath, <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">);
        Collections.sort(children);

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å½åèç¹æ¯åºå·æå°çï¼å°±æ¯ Leader</span>
        String smallestChild = children.get(0<span style="color: rgba(0, 0, 0, 1)">);
        </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> (currentZnodePath.endsWith(smallestChild)) {
            logger.info(</span>"I am the Leader: {}"<span style="color: rgba(0, 0, 0, 1)">, currentZnodePath);
            taskService.startTask();  </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¼å§æ§è¡ä»»å¡</span>
        } <span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)"> {
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> çè§åä¸ä¸ªèç¹</span>
            <span style="color: rgba(0, 0, 255, 1)">int</span> myIndex = children.indexOf(currentZnodePath.substring(electionPath.length() + 1<span style="color: rgba(0, 0, 0, 1)">));
            String previousChild </span>= children.get(myIndex - 1<span style="color: rgba(0, 0, 0, 1)">);
            zk.exists(electionPath </span>+ "/" + previousChild, <span style="color: rgba(0, 0, 255, 1)">this</span>);  <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è®¾ç½®çè§</span>
            logger.info("I am Follower, watching: {}"<span style="color: rgba(0, 0, 0, 1)">, previousChild);
            taskService.stopTask();  </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ­¢ä»»å¡ï¼å¦æä¹åæ¯ Leaderï¼</span>
<span style="color: rgba(0, 0, 0, 1)">        }
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">void</span> close() <span style="color: rgba(0, 0, 255, 1)">throws</span><span style="color: rgba(0, 0, 0, 1)"> InterruptedException {
        zk.close();
    }
}</span></pre>
</div>
<p dir="auto">TaskService.javaï¼ä»»å¡æ§è¡æå¡ï¼ï¼æ¨¡æä¸ä¸ªå®æ¶ä»»å¡ãåªæ Leader æ§è¡ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">package</span><span style="color: rgba(0, 0, 0, 1)"> com.example;

</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> org.slf4j.Logger;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> org.slf4j.LoggerFactory;

</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> java.util.concurrent.Executors;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> java.util.concurrent.ScheduledExecutorService;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> java.util.concurrent.TimeUnit;

</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> TaskService {
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">final</span> Logger logger = LoggerFactory.getLogger(TaskService.<span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">private</span><span style="color: rgba(0, 0, 0, 1)"> ScheduledExecutorService executor;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">boolean</span> isRunning = <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">;

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> startTask() {
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (!<span style="color: rgba(0, 0, 0, 1)">isRunning) {
            executor </span>=<span style="color: rgba(0, 0, 0, 1)"> Executors.newSingleThreadScheduledExecutor();
            executor.scheduleAtFixedRate(() </span>-&gt;<span style="color: rgba(0, 0, 0, 1)"> {
                logger.info(</span>"Executing task: Backup database...");  <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¨¡æä»»å¡</span>
            }, 0, 60, TimeUnit.SECONDS);  <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¯åéæ§è¡</span>
            isRunning = <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">;
        }
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> stopTask() {
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (isRunning &amp;&amp; executor != <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">) {
            executor.shutdown();
            isRunning </span>= <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">;
            logger.info(</span>"Stopped task"<span style="color: rgba(0, 0, 0, 1)">);
        }
    }
}</span></pre>
</div>
<p dir="auto">App.javaï¼ä¸»å¥å£ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">package</span><span style="color: rgba(0, 0, 0, 1)"> com.example;

</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> java.io.IOException;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> java.util.Properties;

</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> App {
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">void</span> main(String[] args) <span style="color: rgba(0, 0, 255, 1)">throws</span><span style="color: rgba(0, 0, 0, 1)"> IOException, InterruptedException, Exception {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å è½½éç½®ï¼å®éå¯ä½¿ç¨ Spring æç¯å¢åéï¼</span>
        Properties props = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> Properties();
        props.load(App.</span><span style="color: rgba(0, 0, 255, 1)">class</span>.getClassLoader().getResourceAsStream("application.properties"<span style="color: rgba(0, 0, 0, 1)">));

        String zkConnect </span>= props.getProperty("zk.connectString"<span style="color: rgba(0, 0, 0, 1)">);
        </span><span style="color: rgba(0, 0, 255, 1)">int</span> sessionTimeout = Integer.parseInt(props.getProperty("zk.sessionTimeout"<span style="color: rgba(0, 0, 0, 1)">));
        String electionPath </span>= props.getProperty("election.path"<span style="color: rgba(0, 0, 0, 1)">);
        String nodeId </span>= props.getProperty("node.id");  <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¯ä¸ªå®ä¾ä¸å</span>
<span style="color: rgba(0, 0, 0, 1)">
        TaskService taskService </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> TaskService();
        LeaderElection election </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> LeaderElection(zkConnect, sessionTimeout, electionPath, nodeId, taskService);

        election.connect();
        election.participateInElection();

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä¿æè¿è¡ï¼çäº§ä¸­ç¨ Spring Boot æ while(true)ï¼</span>
<span style="color: rgba(0, 0, 0, 1)">        Thread.sleep(Long.MAX_VALUE);

        election.close();
    }
}</span></pre>
</div>
<p dir="auto">application.properties</p>
<div class="cnblogs_code">
<pre>zk.connectString=192.168.1.101:2181,192.168.1.102:2181,192.168.1.103:2181<span style="color: rgba(0, 0, 0, 1)">
zk.sessionTimeout</span>=5000<span style="color: rgba(0, 0, 0, 1)">
zk.connectionTimeout</span>=3000<span style="color: rgba(0, 0, 0, 1)">
election.path</span>=/<span style="color: rgba(0, 0, 0, 1)">election
# æ¯ä¸ªèç¹æå¨è®¾ç½®ä¸åç node.id
# node1: node</span>-1<span style="color: rgba(0, 0, 0, 1)">
# node2: node</span>-2<span style="color: rgba(0, 0, 0, 1)">
# node3: node</span>-3<span style="color: rgba(0, 0, 0, 1)">
node.id</span>=node-1   # å¯å¨æ¶æ ¹æ®èç¹ä¿®æ¹</pre>
</div>
<p>é¡¹ç®å¤§åé¨ç½²å°ä¸å°æå¡å¨æå®ç®å½ä¸ï¼/home/userï¼ã</p>
<p dir="auto">å¨æ¯å°æå¡å¨ä¸åå»ºå¯å¨èæ¬ï¼ nohup + èæ¬ï¼</p>
<div class="cnblogs_code">
<pre>cd /home/<span style="color: rgba(0, 0, 0, 1)">user

</span>#<span style="color: rgba(0, 0, 0, 1)"> åå»ºå¯å¨èæ¬ start.shï¼node1 ç¤ºä¾ï¼
cat </span>&gt; start.sh &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">EOF</span><span style="color: rgba(128, 0, 0, 1)">'</span>
#!/bin/<span style="color: rgba(0, 0, 0, 1)">bash

</span>#<span style="color: rgba(0, 0, 0, 1)"> èç¹ IDï¼æ¯ä¸ªæå¡å¨ä¸åï¼
NODE_ID</span>=<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">node-1</span><span style="color: rgba(128, 0, 0, 1)">"</span>   # node2 æ¹ä¸º node-<span style="color: rgba(128, 0, 128, 1)">2</span>ï¼node3 æ¹ä¸º node-<span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)">

nohup java </span>-<span style="color: rgba(0, 0, 0, 1)">jar \
  </span>-Dnode.id=<span style="color: rgba(0, 0, 0, 1)">${NODE_ID} \
  distributed</span>-task-service-<span style="color: rgba(128, 0, 128, 1)">1.0</span>-<span style="color: rgba(0, 0, 0, 1)">SNAPSHOT.jar \
  </span>&gt; service.log <span style="color: rgba(128, 0, 128, 1)">2</span>&gt;&amp;<span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> &amp;

echo </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Started with node.id=${NODE_ID}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
EOF

chmod </span>+x start.sh</pre>
</div>
<p dir="auto">æ¯å°æå¡å¨å¯å¨æå¡</p>
<div class="cnblogs_code">
<pre>./start.sh</pre>
</div>
<p>æ¥å¿æ¥ç</p>
<div class="cnblogs_code">
<pre>tail -f service.log</pre>
</div>
<p dir="auto">å¯ä»¥çå°ç±»ä¼¼è¾åºï¼</p>
<ul dir="auto">
<li>ä¸ä¸ªèç¹ä¼æå°ï¼I am the Leader: /election/node-1-0000000001</li>
<li>å¦å¤ä¸¤ä¸ªèç¹ï¼I am Follower, watching: node-?-0000000000</li>
</ul>
<p dir="auto">åªæ Leader ä¼æ¯åéæå°ï¼Executing task: Backup database...</p>
<h4 dir="auto">æµè¯æéè½¬ç§»</h4>
<p>æ¥çå½å Leaderï¼åè®¾æ¯ node1ï¼ï¼</p>
<div class="cnblogs_code">
<pre>tail -f /home/user/service.log | grep <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">I am the Leader</span><span style="color: rgba(128, 0, 0, 1)">"</span></pre>
</div>
<p dir="auto">ææ Leader è¿ç¨ï¼node1ï¼ï¼</p>
<div class="cnblogs_code">
<pre>ps -<span style="color: rgba(0, 0, 0, 1)">ef | grep java
kill </span>-<span style="color: rgba(128, 0, 128, 1)">9</span> &lt;pid&gt;</pre>
</div>
<p>è§å¯å¶ä»èç¹æ¥å¿ï¼</p>
<ul dir="auto">
<li>å ç¾æ¯«ç§åï¼å¶ä¸­ä¸ä¸ª Follower ä¼æä¸ºæ° Leaderï¼å¹¶å¼å§æ§è¡ä»»å¡ã</li>
<li>åæ¥ç Follower ç»§ç»­çè§æ° Leaderã</li>
</ul>
<h3 dir="auto">æ»ç»</h3>
<ul dir="auto">
<li><strong>æä½æµç¨</strong>ï¼3 å°æºå¨ â å®è£ ZK â å¤å¶ JAR â ä¿®æ¹ node.id â å¯å¨èæ¬</li>
<li><strong>é«å¯ç¨</strong>ï¼ZooKeeper ä¿è¯é¢å¯¼èéä¸¾å¿«éãå¯é </li>
<li><strong>å¯æ©å±</strong>ï¼æ³å æ´å¤èç¹ï¼åªéå¤å¶ JAR + ä¿®æ¹ node.id + å¯å¨å³å¯</li>
</ul>
<p dir="auto">&nbsp;</p>
<p>&nbsp;</p>
<p dir="auto">&nbsp;</p>
<p dir="auto">&nbsp;</p>
<p dir="auto">&nbsp;</p>
<p dir="auto">&nbsp;</p>
<p dir="auto">&nbsp;</p>
<p dir="auto">&nbsp;</p>
<p>&nbsp;</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.005555555555555556" data-date-updated="2026-01-22 17:30">2026-01-22 17:22</span>&nbsp;
<a href="https://www.cnblogs.com/Marktowin">Marktowin</a>&nbsp;
éè¯»(<span id="post_view_count">5</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19518265);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19518265', targetLink: 'https://www.cnblogs.com/Marktowin/p/19518265', title: 'ç©è½¬ ZooKeeper' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å¨ä»¥å¾å·¥ä½ä¸­éå°çä¸å kubernetes é®é¢æ»ç» ]]></title>
    <link>https://www.cnblogs.com/manuscript/p/19518188</link>
    <guid>8bca1c797ad1c219b760e4d1f6bb7c10</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/manuscript/p/19518188" title="åå¸äº 2026-01-22 16:53">
    <span role="heading" aria-level="2">å¨ä»¥å¾å·¥ä½ä¸­éå°çä¸å kubernetes é®é¢æ»ç»</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="åè¨">åè¨</h1>
<p>æ¬æåºäºå¯¹ <a href="https://hackernoon.com/hidden-kubernetes-bad-practices-learned-the-hard-way-during-incidents" target="_blank" rel="noopener nofollow">Hidden Kubernetes Bad Practices Learned the Hard Way During Incidents</a> çéè¯»åï¼å¨å°éåæåå®¹çåºç¡ä¸è¿è¡äºæ¬å°åç¿»è¯ä¸æ´çï¼å¨è¯­ä¹è¡¨è¾¾ä¸ç¸è¾äºæºç¿»ï¼æ´å è´´è¿ä¸­ææ¯è¯­èçéè¯»ä¹ æ¯ï¼æåæ´ä½çå¯è¯»æ§ä¸çè§£ææ¬ã</p>
<p>å¨æ¯ä¸ªäºä»¶çåæç¿»è¯ä¹åï¼é½ä¼è¡¥åæçä¸ªäººæ³¨è§£ï¼ä¹ç®æ¯å¯¹åä½èæ²¡ææå°çåå®¹è¿è¡è¡¥åã<strong>ææä¸ªäººæ³¨è§£åä¼æç¡®æ è¯ï¼å¹¶ç¬ç«äºåæç¿»è¯é¨ååç°ï¼ä¸ä¼ç©¿æå¨åæåå®¹ä¹ä¸­ï¼ä»¥é¿åå¯¹åæé æå¹²æ°ã</strong></p>
<p>åæä¸å± 7 ä¸ªæéï¼æ¬æå»æäºæéäºçç¿»è¯è§£æï¼å ä¸ºææ²¡ç¨è¿ ArgoCD...</p>
<h1 id="kube-proxy-é»è®¤è´è½½åè¡¡æºå¶å¯¼è´-http2-æµéç­ç¹é®é¢">Kube-proxy é»è®¤è´è½½åè¡¡æºå¶å¯¼è´ HTTP/2 æµéç­ç¹é®é¢</h1>
<h2 id="åæç¿»è¯">åæç¿»è¯</h2>
<p>æ¬æ¬¡äºæåçå¨é¦æ¬¡æ HTTP/2 æµéå¼å¥ Kubernetes æ¶ãæä»¬åç° HTTP/2 æµéå¨åç«¯ Pod ä¹é´çåå¸åºç°äºå¼å¸¸è´è½½ãå¶è¡¨ç°ä¸ºæä¸ª Pod æç»­åºç° CPU ä½¿ç¨çåå»¶è¿é½å¾é«ï¼ä½çæ§ææ ä¸­åä¸æå¡ä¸çå¶ä» Pod å¯æ¬å ä¹å®å¨å¤äºç©ºé²ç¶æã</p>
<p>æä»¬éè¯¯å°è®¤ä¸º HTTP/2 æµéå¨ kube-proxy ä¸­çè¡ä¸ºä¼å HTTP/1.x ä¸æ ·ï¼ä½äºå®å¹¶éå¦æ­¤ãkube-proxy å¯¹è¿ä¸¤ç§åè®®çå¤çæ¹å¼å¹¶ä¸ä¸æ ·ãé»è®¤æåµä¸ï¼kube-proxy å¨åå±ï¼TCP å±ï¼è¿è¡è´è½½åè¡¡ï¼å®æ¯éè¿ <strong>è¿æ¥çº§å«</strong> èä¸æ¯ <strong>è¯·æ±çº§å«</strong> ååæµéï¼</p>
<ul>
<li>å½å®¢æ·ç«¯å Kubernetes Service å»ºç«ä¸ä¸ª TCP è¿æ¥æ¶ï¼kube-proxy ä¼ä½¿ç¨è½®è¯¢ç®æ³éæ©ä¸ä¸ªåç«¯ Podãè¯¥ TCP è¿æ¥ä¸çææè¯·æ±é½ä¼è¢«è½¬åå°åä¸ä¸ª Pod ä¸ã</li>
</ul>
<p>å¯¹äº HTTP/1.x å®¢æ·ç«¯æ¥è¯´ï¼è¿ç§æ¹å¼éå¸¸æ²¡æé®é¢ï¼å ä¸ºå®¢æ·ç«¯ä¸è¬ä¼å»ºç«å¤ä¸ªç­è¿æ¥ï¼çå½å¨æè¾ç­ï¼ï¼æµéå æ­¤å¯ä»¥è¾ä¸ºååå°åå¸ãä½å¯¹äºåä¸ªè¿æ¥å¤è·¯å¤ç¨å¤çææè¯·æ±ç HTTP/2 å®¢æ·ç«¯æ¥è¯´ï¼è¿ç§æºå¶ä¼å¯¼è´ææè¯·æ±é½è¢«è½¬åå°åä¸ä¸ª Podï¼å¶ä½ Pod å¤§å¤å¤äºç©ºé²ç¶æãæç»è¯¥ Pod ä¸ç CPU ä½¿ç¨çåè¯·æ±å»¶è¿æ¾èä¸åæä¸ºæ§è½ç¶é¢ã</p>
<p>ç±äºå¯¹ kube-proxy è¿æ¥å¤çæºå¶çè§£æéï¼è¿ä¸ªé®é¢å¨æåé¶åªè½éè¿è°æ´åºç¨å±ç keep-alive éç½®ææ¶ç¼è§£ãä½ä»é¿ææ¥çï¼å¼å¥æ¯æ HTTP/2 çæå¡ç½æ ¼ï¼å¹¶éè¿ä¸å±è´è½½åè¡¡æ¥è§£å³ææ¯æç»æ¹æ¡ã</p>
<p><strong>å³é®ç»è®ºï¼</strong><br>
é»è®¤æåµä¸ï¼<strong>éè¿ Service çæµéï¼æ¯ç± kube-proxy å¨ TCP è¿æ¥çº§å«è¿è¡è´è½½åè¡¡ç</strong>ï¼å¨ä¸ HTTP/2 çå¤è·¯å¤ç¨æºå¶ç»åä½¿ç¨æ¶ï¼å®¹æå¯¼è´æµéåå¸ä¸åãå¦ææ²¡æä¸å±è·¯ç±è½åï¼åä¸ª Pod å¯è½ä¼æä¸ºç¶é¢ï¼èå¶ä» Pod å´å¤äºç©ºé²ç¶æï¼ä»èå¼åæ§è½ä¸éã</p>
<h2 id="ä¸ªäººæ³¨è§£">ä¸ªäººæ³¨è§£</h2>
<p>å¨æ³¨è§£åéè¦åæç¡®å ç¹ï¼</p>
<ol>
<li>k8s svc åªæ¯ä¸ä¸ª <strong>è½¬åè§å</strong>ï¼kube-proxy ææ¯å°è®¿é® svc çæµéè½¬åå° Pod çæ§è¡è</li>
<li>ä»¥ä¸é½åçå¨ TCP å±ï¼L4ï¼</li>
</ol>
<p>è¿ä¸ªé®é¢çæ ¸å¿åå å¨äºï¼</p>
<ul>
<li>kube-proxy é»è®¤æ¯åå±è´è½½åè¡¡ï¼åªå¨ TCP è¿æ¥å»ºç«ï¼SYNï¼æ¶éæ©ä¸ä¸ª Pod</li>
<li>HTTP/2 ä¸è¬ä½¿ç¨åä¸ªè¿æ¥å¤è·¯å¤ç¨å¤çææè¯·æ±</li>
</ul>
<div class="mermaid">flowchart TB
    Client["Client&lt;br/&gt;(HTTP/2 é¿è¿æ¥)"]

    Service["k8s svc&lt;br/&gt;(èæ IP)"]

    KubeProxy["kube-proxy&lt;br/&gt;(L4 / TCP&lt;br/&gt;è¿æ¥å»ºç«æ¶éæ© Pod)"]

    PodA["Pod A&lt;br/&gt;(å¯¼è´é« CPU / é«å»¶è¿)"]
    PodB["Pod B&lt;br/&gt;(å ä¹ç©ºé²)"]
    PodC["Pod C&lt;br/&gt;(å ä¹ç©ºé²)"]

    Client --&gt;|1 ä¸ª TCP è¿æ¥| Service
    Service --&gt; KubeProxy
    KubeProxy --&gt;|è¿æ¥ç»å®| PodA
    KubeProxy -.-&gt; PodB
    KubeProxy -.-&gt; PodC
</div><p>æä»¥ä»çæ­£ç¡®è§£æ³åºè¯¥æ¯å¼å¥æ¯æ HTTP/2 çä¸å±è´è½½åè¡¡ææå¡ç½æ ¼ï¼</p>
<ul>
<li>Ingress Controller</li>
<li>Istio</li>
</ul>
<div class="mermaid">flowchart TB
    Client["Client&lt;br/&gt;(HTTP/2)"]

    L7["Ingress / Service Mesh&lt;br/&gt;(L7 æè¯·æ±è´è½½åè¡¡)"]

    PodA["Pod A"]
    PodB["Pod B"]
    PodC["Pod C"]

    Client --&gt;|HTTP/2| L7
    L7 --&gt;|è¯·æ± 1| PodA
    L7 --&gt;|è¯·æ± 2| PodB
    L7 --&gt;|è¯·æ± 3| PodC
</div><h1 id="cpu-éå¶å¯¼è´ä¸å¿è¦çéçº§">CPU éå¶å¯¼è´ä¸å¿è¦çéçº§</h1>
<h2 id="åæç¿»è¯-1">åæç¿»è¯</h2>
<p>è¿æ¯æå¨èµæºç®¡çä¸­éå°è¿æå°æçäºä»¶ä¹ä¸ãä¹ä¸çï¼éç¾¤ç¶æå®å¨æ­£å¸¸ï¼èç¹çæ§é¢æ¿æ¾ç¤º CPU ä»ç¶åè¶³ï¼ä¹æ²¡æä»»ä½èµæºèå°½çåè­¦ãç¶èä»ç¨æ·ä½éªæ¥çï¼åºç¨å´é¢ç¹åºç°å»¶è¿é£ååè¯·æ±è¶æ¶ã</p>
<p>æç»å®ä½å°çæ ¹å æ¯ Pod çº§å«éç½®äº CPU limitï¼è¿å¯¼è´ CPU è¢«éæµï¼ä»èææ¢äºåºç¨çæ§è¡ã</p>
<p>åå å¨äºï¼ä¸åå­ä¸åï¼CPU å¹¶ä¸æ¯ä¸ç§å¯è¢«æ¶èæ®å°½çèµæºï¼å®æ¯å¯åç¼©çï¼å¹¶ä¸å¨æ¯ä¸ä¸ªè°åº¦å¨æé½ä¼éæ°åéãæ¯ä¸ªè°åº¦å¨æï¼CFS è°åº¦å¨æï¼ä¸­ï¼CPU æ¶é´é½ä¼è¢«åéãåæ¶å¹¶éæ°ååã</p>
<p>å¨éç½®äº CPU limit çæåµä¸ï¼å³ä½¿èç¹ä¸ä»ç¶æç©ºé² CPUï¼ä½å¦æ Pod è¾¾å°äºéç½®ç CPU limit ä¸éï¼ä¹æ æ³ç»§ç»­ä½¿ç¨è¿äºç©ºé²ç CPUã</p>
<p>å½å®¹å¨è§¦å CPU limit æ¶ï¼</p>
<ul>
<li>åæ ¸ä¼å¯¹å®¹å¨è¿è¡éæµï¼throttlingï¼</li>
<li>è¿ç¨ä¼è¢«æåï¼ç´å°ä¸ä¸ä¸ª CPU è°åº¦å¨æ</li>
<li>å³ä½¿èç¹ä¸å­å¨ç©ºé² CPUï¼å®¹å¨ä¹æ æ³çªç ´å¶éå¶è¿è¡çªåä½¿ç¨</li>
</ul>
<p>CPU éæµç¸å³çææ æ¯å®ä½è¯¥é®é¢æ ¹å çå³é®ä¿¡å·ï¼å°¤å¶æ¯ <code>container_cpu_cfs_throttled_seconds_total</code> å <code>container_cpu_cfs_throttled_periods_total</code>ãå°è¿äºææ ä¸å»¶è¿æ²çº¿è¿è¡å³èåæï¼å¯ä»¥æ¸æ°å°çå°å»¶è¿å³°å¼ä¸ CPU éæµä¹é´çé«åº¦ä¸è´æ§ã</p>
<p>ç§»é¤ CPU limitï¼ä»ä¿ç CPU requestï¼å°±è¶³ä»¥é¿åéæµé®é¢ãè¿æ ·æ¢å¯ä»¥ä¿è¯ Pod ææ¯ä¾è·å¾ CPU èµæºï¼åè½é²æ­¢æäº Pod è¿åº¦æ¢å  CPUã</p>
<p><strong>å³é®ç»è®ºï¼</strong><br>
éç½® CPU limit å¯è½ä¼åºç°èç¹ CPU ç©ºé²çæåµä¸ï¼è®© Pod éå°æ§è½ç¶é¢ï¼ä½¿å¾å»¶è¿é®é¢é¾ä»¥è¯æ­ãå¨å¤§å¤æ°åºæ¯ä¸ï¼åçéç½® CPU request å°±å·²ç»è¶³å¤ï¼æ¢åè®¸å·¥ä½è´è½½å¨éè¦æ¶è¿è¡çªåä½¿ç¨ï¼åè½é¿å CPU éå¶é®é¢ã</p>
<h2 id="ä¸ªäººæ³¨è§£-1">ä¸ªäººæ³¨è§£</h2>
<p>éè¦æ³¨æçæ¯ï¼å½ Pod è¾¾å°äºéç½®ç mem limit ä¸éæ¶ï¼ä¼è§¦å oomkill å¯¼è´ Pod éå¯ãä½ CPU limit çæ¬è´¨æ¯ï¼</p>
<ul>
<li>ä¸æ¦å®¹å¨å¨æä¸ª CFS å¨æåç¨å®äºåéç CPU æ¶é´çï¼<strong>å°±ä¼è¢«åæ ¸ç´æ¥æå</strong></li>
<li>è¿ä¸ªæåè¡ä¸º<strong>ä¸èç¹æ¯å¦è¿æç©ºé² CPU æ å³</strong></li>
</ul>
<p>æçè§ç¹ä¸ä½èç»è®ºä¸è´ï¼æè®¤ä¸º CPU limit ä»è½ä½ä¸º<strong>éç¦»å·¥å·</strong>ï¼èä¸æ¯æ§è½ä¼åå·¥å·ãé¤éä½ æç¡®å¸ææäºä¸å¡ä¸å¸æå ç¨è¿å¤ CPUã</p>
<h1 id="å³é®ä¸å¡æªè®¾ç½®-priorityclass">å³é®ä¸å¡æªè®¾ç½® PriorityClass</h1>
<h2 id="åæç¿»è¯-2">åæç¿»è¯</h2>
<p>è¯æ³ä¸ä¸ï¼æ ¸å¿ä¸å¡ Pod å¨éç¾¤ä¸­è¢«é©±éï¼ä¸å¨ç­æ¶é´åæ æ³éæ°è°åº¦ï¼èä¸äºä¸é£ä¹éè¦çå·¥ä½è´è½½å´ä»å¨æ­£å¸¸è¿è¡ã</p>
<p>å½ä½ æ²¡æä¸ºå³é®é¨ç½²è®¾ç½® PriorityClass æ¶ï¼å¨éç¾¤èµæºåè¶³çæåµä¸ï¼ä¸åçèµ·æ¥é½å¾æ­£å¸¸ãä½ä¸æ¦éç¾¤é­éèµæºåå(memãcpuãdiskï¼ï¼k8s å°±ä¼å¨èç¹ä¸­é©±éæäº Podã</p>
<p>Kubelet ä¼åºäºæå¡è´¨éï¼QoSï¼Quality Of Serviceï¼æ¥é©±é Podãå¦æå¤ä¸ª Pod å±äºåä¸ç§ QoS ç±»å«ï¼è¿ç§æåµéå¸¸å¸¸è§ï¼ï¼é£ä¹å¶ä¸­ä»»ä½ä¸ä¸ª Pod é½å¯è½è¢«é©±éã</p>
<p>æ´ç³ç³çé®é¢åºç°å¨åç»­çéæ°è°åº¦é¶æ®µãè¢«é©±éç Pod å¯è½ä¼å¡å¨ Pending ç¶æï¼å¹¶è¾åºå¦ä¸ä¿¡æ¯ï¼</p>
<pre><code class="language-bash">preemption: No victims found for incoming pod
</code></pre>
<p>ç±äºææ Pod æ¥æç¸åçä¼åçº§ï¼æ¢å ï¼preemptionï¼æºå¶æ æ³çæï¼èæ­¤æ¶ææèç¹åé½è¢«å æ»¡ã</p>
<p><strong>å³é®ç»è®ºï¼</strong><br>
ä»è®¾ç½® resource requests å limits å¹¶ä¸è¶³ä»¥å¨èµæºååä¸ä¿è¯å­æ´»ãå®ä»¬åªè½å»¶ç¼ Pod è¢«é©±éï¼ä½å¹¶ä¸è½ä¿è¯è°åº¦ä¼åçº§ãå¯¹äºå³é®å·¥ä½è´è½½ï¼å¿é¡»å§ç»å®ä¹ PriorityClassã</p>
<h2 id="ä¸ªäººæ³¨è§£-2">ä¸ªäººæ³¨è§£</h2>
<p>å¨éç¾¤èµæºç´§å¼ æ¶ï¼æ¶åä¸¤ç§ä¸åé¶æ®µçå³ç­ï¼</p>
<ul>
<li>é©±é
<ul>
<li>éè¿ kubelet æ ¹æ®ä¸åæå¡è´¨éï¼QoSï¼BestEffort/Burstable/Guaranteedï¼è¿è¡é©±é</li>
<li>ä¸åæå¡è´¨éçå®ä¹å¯åè<a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-qos/" target="_blank" rel="noopener nofollow">å®ç½ææ¡£</a></li>
</ul>
</li>
<li>è°åº¦
<ul>
<li>éè¿ scheduler æ ¹æ®ä¸å PriorityClass / priority èµæºå¼å³å®</li>
</ul>
</li>
</ul>
<p>ç®åæ¥è¯´ QoS è§£å³çæ¯ "è°è½æ´»ä¸æ¥"ï¼è PriorityClass åæ¯ "è°æ´éè¦"ã</p>
<h1 id="ç±äº-pod-å¡å¨-terminating-ç¶æå¯¼è´ç-eks-ip-èå°½é®é¢">ç±äº Pod å¡å¨ Terminating ç¶æå¯¼è´ç EKS IP èå°½é®é¢</h1>
<h2 id="åæç¿»è¯-3">åæç¿»è¯</h2>
<p>æ³è±¡ä¸ä¸ï¼æ 100 å¤ä¸ª Pod å¡å¨ Terminating ç¶æï¼èæ°ç Pod å ä¸º IP èå°½èæ æ³è¢«è°åº¦ã</p>
<p>å¨å é¤ä¸ä¸ªèªå®ä¹ Operator åï¼è¯¥ Operator ä¸ææå¸¦ finalizer ç Pod é½å¡å¨äº Terminating ç¶æãç±äº EKS ä¼ä¸º Pod åéçå®ç VPC IP å°åï¼è¿äºæ­£å¨ç»æ­¢ç Pod ä»ç¶æç»­å ç¨ IPï¼æç»èå°½äºå­ç½ä¸­ç IP èµæºï¼å¯¼è´æ°ç Pod æ æ³è¢«è°åº¦ã</p>
<p>éè¿å®ä½è¢« finalizer é»å¡ç Podï¼å¹¶è°¨æå°ç§»é¤è¿äº finalizerï¼ä½¿ Pod å¾ä»¥çæ­£å é¤å¹¶éæ¾ IPï¼ä»èç¼è§£äºè¿æ¬¡äºæãå½å­ç½ç IP å®¹éæ¢å¤åï¼è°åº¦éæ°å¼å§ï¼éç¾¤ä¹æ¢å¤äºç¨³å®ã</p>
<p>æ¹éç§»é¤ Pod ä¸­ finalizer çæ¹æ³å¦ä¸ï¼</p>
<pre><code class="language-bash">kubectl get pods -n $NAMESPACE -o json |
jq -r '
  .items[]
  | select(.metadata.deletionTimestamp != null)
  | select(.metadata.finalizers | index("$FINALIZER_NAME&gt;"))
  | "kubectl patch pod \(.metadata.name) -n $NAMESPACE -p '\''{\"metadata\":{\"finalizers\":[]}}'\'' --type=merge"
' | sh
</code></pre>
<p><strong>å³é®ç»è®ºï¼</strong></p>
<ul>
<li>Finalizer ä¸æ¦æ·»å ï¼å°±ä¼ä¸ç´å­å¨ï¼é¤éè¢« operator æ¾å¼ç§»é¤ï¼</li>
<li>operator å¨å¶ç®¡ççèµæºè¢«å®å¨æ¸çä¹åç»ä¸è½è¢«å é¤ï¼</li>
<li>å¨ EKS ä¸­ï¼å¤äº Terminating ç¶æç Pod ä»ç¶ä¼æ¶èçå®çéç¾¤èµæºã</li>
</ul>
<h2 id="ä¸ªäººæ³¨è§£-3">ä¸ªäººæ³¨è§£</h2>
<p>Finalizer å¯ä»¥çè§£ä¸º k8s ä¸­ç "æ¦æªå é¤å¨"ï¼å¨èµæºçæ­£è¢«å é¤ä¹åï¼éè¦å¼ºå¶å®ææäºæ¸çå¨ä½ï¼åªè¦ä»è¿å­å¨ï¼k8s å°±ä¸è½å°è¿ä¸ªèµæºçæ­£å é¤ã</p>
<p>å¨éç¾¤ä¸­å é¤èµæºæ¶ï¼k8s çå·¥ä½æµç¨æ¯è¿æ ·çï¼</p>
<ol>
<li>æ è®°å é¤ï¼æ·»å  <code>deletionTimestamp</code> ç­æ ç­¾ï¼èµæºç¶æåä¸º <code>Terminating</code></li>
<li>æ£æ¥ Finalizerï¼å¦ææåç­å¾å®æååå é¤ï¼å¦ææ²¡æåç´æ¥å é¤
<ol>
<li>æä¸ª Operator æ¸çåå° finalizer ä» metadata ä¸­å æ</li>
</ol>
</li>
<li>çæ­£å é¤ï¼èµæºä» etcd ä¸­ç§»é¤</li>
</ol>
<blockquote>
<p>ð¡ éè¦æ³¨æçæ¯ï¼k8s æ¬èº«ä¸ä¼å®æ finalizer æä½ï¼çæ­£æ§è¡çæ¯æä¸ª operator</p>
</blockquote>
<p>ç®åæ¥è®²ï¼æ¬æ¬¡æéçæ ¹å å¨äºèµæºæ¸çé¡ºåºä¸å½ãå¨å é¤ Operator åï¼å¶ç®¡çç Pod ä¸­ Finalizer æ äººå¤çï¼å¯¼è´è¿äº Pod é¿æå¡å¨ Terminating ç¶ææ æ³è¢«çæ­£å é¤ãå¤äºè¯¥ç¶æç Pod ä»ä¼å ç¨ IP èµæºï¼æç»é æå­ç½ IP èå°½ï¼å½±åæ° Pod è°åº¦ã</p>
<pre><code class="language-bash">## èæ¬è§£æ

## éè¿å½ä»¤æ¥ç Pod ä¸­æåªäº Finalizer
## kubectl get pod &lt;pod-name&gt; -n &lt;ns&gt; -o yaml
index("$FINALIZER_NAME&gt;")
</code></pre>
<h1 id="æ¬å°ä¸´æ¶æ¥å¿å¯¼è´çç£çåå">æ¬å°ä¸´æ¶æ¥å¿å¯¼è´çç£çåå</h1>
<h2 id="åæç¿»è¯-4">åæç¿»è¯</h2>
<p>æè®°å¾ææ¬¡äºæï¼æ¯å¨æä¸å¡é¨ç½²å¤±è´¥ååºç°çï¼è°åº¦è¿ç¨ä¸­åºç°éè¯¯ï¼åæ¶è§¦åäº Pod å¼å¸¸é©±éï¼å¹¶ä¸å¤ä¸ªèç¹ä¸åºç°ç£çååï¼Disk Pressureï¼åè­¦ã</p>
<p>éè¿ç£çç©ºé´ç¨éççªå¢ä¸å Pod èµæºæ¶èæåµè¿è¡å³èåæï¼æç»åç°ä¸ä¸ª Pod äº§çäºå¼å¸¸é«çæ¥å¿éï¼å¾å¿«èå°½äºèç¹çç£çï¼ä»èè§¦åäº DiskPressureãéå kubelet å¼å§é©±éæ å³ç Podï¼å¹¶å°èç¹ç¶æè®¾ç½®ä¸º NodeHasDiskPressure = Trueï¼æ°å·¥ä½è´è½½æ æ³åè¢«è°åº¦ï¼æ¥éå¦ä¸ï¼</p>
<pre><code class="language-bash">0/12 nodes are available: 12 node(s) had disk pressure.
</code></pre>
<p>æç»çè§£å³æ¹å¼æ¯ï¼ä¸çº¿è¿ä¸ª Podï¼å¨éç¾¤ä¸­æ°å¢ Node æ¥æ¿è½½å¤äº Pending ç Podï¼å¹¶éè¿æ¸çå®¹å¨æ¥å¿æ¥éæ¾åå½±åèç¹çç£çç©ºé´ãç±äºè¿äºæ¥å¿å¹¶éå³é®æ°æ®ï¼å æ­¤ 30 åéçåæºæ¶é´æ¯å¯ä»¥æ¥åçãæ°¸ä¹æ§ä¿®å¤æ¹æ¡æ¯å¨ Helm Chart ä¸­å°æ¬å°å­å¨åæ¢ä¸ºæä¹åå­å¨ï¼ç¡®ä¿æ¥å¿åå¥å¤é¨å­å¨ï¼èä¸æ¯èç¹æ¬å°ç£çã</p>
<p><strong>å³é®ç»è®ºï¼</strong><br>
æ°¸è¿ä¸è¦ä½¿ç¨ emptyDir å·å¨èç¹æ¬å°å­å¨ Pod æ°æ®ï¼å³ä¾¿åªæ¯ä¸´æ¶ç¨éãåºè¯¥ä½¿ç¨å¤é¨çæä¹åå­å¨æ¥é¿åèç¹ç£çååäºä»¶ï¼æèå¿é¡»è®¾ç½® ephemeral-storage éå¶ï¼é²æ­¢ Pod æ éå¶å°æ¶èç£çç©ºé´ã</p>
<h2 id="ä¸ªäººæ³¨è§£-4">ä¸ªäººæ³¨è§£</h2>
<p>è¿ä¸ªæ²¡å¥è¯´çï¼Pod æ°æ®é»è®¤ä¹é½æ¯å­å¨æ¬å° <code>/var/lib/</code> ç®å½ä¸ãä½¿ç¨ emptyDir æ stdout/stderr æ¬è´¨ä¸ç¨çé½æ¯æ¬å°ç£çï¼ä½¿ç¨æ¶éå¶ limit å°±å¥½äºã</p>
<h1 id="ç¼ºå¤±-configmap-éè½½å¨reloader">ç¼ºå¤± ConfigMap éè½½å¨ï¼Reloaderï¼</h1>
<h2 id="åæç¿»è¯-5">åæç¿»è¯</h2>
<p>è¯¥äºæå§äºä¸æ¬¡æ°æ®åºè¿æ¥éç½®åæ´ï¼è¿äºéç½®æ¯éè¿ ConfigMap ç®¡çãä½åºç¨ Pod å¹¶æ²¡ææç¥å°è¿äºæ°éç½®ï¼åå å¾ç®åï¼å¨è¯¥ Deployment ä¸­å¹¶æ²¡æéç½® ConfigMap Reloaderã</p>
<p>Reloader ä¼çå¬ ConfigMap å Secret ååãæ£æµå°åæ´æ¶ï¼ä¼è§¦ååå½±å Pod çæ»å¨éå¯ãå¦æç¼ºå°éè½½å¨ï¼å°±éè¦æå¨éå¯ Pod æè½è®©å¶å è½½ææ°éç½®ã</p>
<p>å½åºç¨å°è¯ä½¿ç¨è¿æçæ°æ®åºè¿æ¥éç½®è¿è¡æ¶ï¼æéåçäºï¼æç»å¯¼è´æ°æ®åºè¿æ¥å¤±è´¥ï¼</p>
<pre><code class="language-bash">ERROR Database connection failed: could not connect to server
ERROR Connection timeout while attempting to reach database endpoint
ERROR Failed to initialize database pool: invalid connection parameters
ERROR Database unavailable after retrying 5 times
</code></pre>
<p>å¨ææ Pod è¢«æå¨éå¯å¹¶å è½½äºææ°éç½®ä¹åï¼è¯¥é®é¢ä¸ç´æªè½å¾å°è§£å³ã</p>
<p><strong>å³é®ç»è®ºï¼</strong><br>
ConfigMap çæ´æ°ä¸ä¼èªå¨åºç¨å°æ­£å¨è¿è¡ç Podï¼ä¾èµæå¨éå¯ Pod å­å¨è¾å¤§çè¿ç»´é£é©ï¼ä¹æ æ³è§æ¨¡åãåºå§ç»å¨ Deployment ä¸­æ·»å  ConfigMap éè½½å¨å®¹å¨ï¼ä¾å¦ reloaderï¼ã</p>
<h2 id="ä¸ªäººæ³¨è§£-5">ä¸ªäººæ³¨è§£</h2>
<p>è¿ä¸ªé®é¢æ¬è´¨ä¸å¹¶ä¸æ¯ k8s èªèº«åå ãæä¸­æå°ç Reloader éè½½å¨æ¯ k8s çæä¸­çä¸ä¸ª<a href="https://github.com/stakater/Reloader" target="_blank" rel="noopener nofollow">å¼æºé¡¹ç®</a>ï¼å¶ä½ç¨æ¯çå¬ ConfigMap åæ´ï¼æ£æµå°æ´æ°åèªå¨è§¦åç¸å³ Pod éå¯ï¼è®© Pod éæ°å è½½ææ°çéç½®ã</p>
<p>å®éä¸ï¼k8s æ©å·²æ¯æ ConfigMap çç­æ´æ°æºå¶ãConfigMap æ´æ°åæ¯å¦è½å¤çæ­£çæï¼å³é®å¨äº Pod åé¨åºç¨æ¯å¦æ¯æç­å è½½ï¼</p>
<ul>
<li>å¦ææ¯æï¼å°±ç¨ä¸ä¸è¯¥é¡¹ç®</li>
<li>å¦æä¸æ¯æï¼åå¯ä»¥ä½¿ç¨è¯¥é¡¹ç®ï¼æèæå¨éå¯ä¸å¡ Pod ä¹ä¸æ ·</li>
</ul>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-22 16:53">2026-01-22 16:53</span>&nbsp;
<a href="https://www.cnblogs.com/manuscript">æä¹è¿å¨åä»£ç </a>&nbsp;
éè¯»(<span id="post_view_count">63</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19518188);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19518188', targetLink: 'https://www.cnblogs.com/manuscript/p/19518188', title: 'å¨ä»¥å¾å·¥ä½ä¸­éå°çä¸å kubernetes é®é¢æ»ç»' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>