<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-04T13:15:30.892Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ AI Agent æ¡æ¶æ¢ç§ï¼æè§£ OpenHandsï¼6ï¼--- äºä»¶ç³»ç» ]]></title>
    <link>https://www.cnblogs.com/rossiXYZ/p/19560027</link>
    <guid>cd67356a4ae23be85ca80c29665e8e36</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/rossiXYZ/p/19560027" title="åå¸äº 2026-02-04 21:10">
    <span role="heading" aria-level="2">AI Agent æ¡æ¶æ¢ç§ï¼æè§£ OpenHandsï¼6ï¼--- äºä»¶ç³»ç»</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ai-agent-æ¡æ¶æ¢ç§æè§£-openhands6----äºä»¶ç³»ç»">AI Agent æ¡æ¶æ¢ç§ï¼æè§£ OpenHandsï¼6ï¼--- äºä»¶ç³»ç»</h1>
<p></p><div class="toc"><div class="toc-container-header">ç®å½</div><ul><li><a href="#ai-agent-æ¡æ¶æ¢ç§æè§£-openhands6----äºä»¶ç³»ç»" rel="noopener nofollow">AI Agent æ¡æ¶æ¢ç§ï¼æè§£ OpenHandsï¼6ï¼--- äºä»¶ç³»ç»</a><ul><li><a href="#0x00-æ¦è¦" rel="noopener nofollow">0x00 æ¦è¦</a></li><li><a href="#0x01-eventstream" rel="noopener nofollow">0x01 EventStream</a><ul><li><a href="#11-åè½" rel="noopener nofollow">1.1 åè½</a></li><li><a href="#12-å®ç°" rel="noopener nofollow">1.2 å®ç°</a></li><li><a href="#13-è®¢é" rel="noopener nofollow">1.3 è®¢é</a><ul><li><a href="#131-è®¢éè" rel="noopener nofollow">1.3.1 è®¢éè</a></li><li><a href="#132-åå" rel="noopener nofollow">1.3.2 åå</a></li><li><a href="#133-èµæºç®¡ç" rel="noopener nofollow">1.3.3 èµæºç®¡ç</a></li></ul></li></ul></li><li><a href="#0x02-event" rel="noopener nofollow">0x02 Event</a><ul><li><a href="#21-event" rel="noopener nofollow">2.1 Event</a><ul><li><a href="#211-å®ä¹" rel="noopener nofollow">2.1.1 å®ä¹</a></li><li><a href="#212-åç±»" rel="noopener nofollow">2.1.2 åç±»</a></li></ul></li><li><a href="#22-action" rel="noopener nofollow">2.2 Action</a><ul><li><a href="#221-ç±»å" rel="noopener nofollow">2.2.1 ç±»å</a></li><li><a href="#222-æµç¨" rel="noopener nofollow">2.2.2 æµç¨</a></li></ul></li><li><a href="#23-observation" rel="noopener nofollow">2.3 Observation</a><ul><li><a href="#231-ç±»å" rel="noopener nofollow">2.3.1 ç±»å</a></li><li><a href="#232-æµç¨" rel="noopener nofollow">2.3.2 æµç¨</a></li><li><a href="#233-ç»è" rel="noopener nofollow">2.3.3 ç»è</a></li></ul></li><li><a href="#24-environment" rel="noopener nofollow">2.4 Environment</a></li><li><a href="#25-agentthinkaction" rel="noopener nofollow">2.5 AgentThinkAction</a><ul><li><a href="#anthropic--think-tool" rel="noopener nofollow">Anthropic  Think Tool</a><ul><li><a href="#ä½æ¶ä½¿ç¨æèå·¥å·" rel="noopener nofollow">ä½æ¶ä½¿ç¨âæèâå·¥å·</a></li><li><a href="#æä½³å®è·µ" rel="noopener nofollow">æä½³å®è·µ</a></li></ul></li><li><a href="#ä»£ç " rel="noopener nofollow">ä»£ç </a></li></ul></li></ul></li><li><a href="#0xff-åè" rel="noopener nofollow">0xFF åè</a></li></ul></li></ul></div><p></p>
<h2 id="0x00-æ¦è¦">0x00 æ¦è¦</h2>
<p>å¦æè¯´ ReAct èå¼æ¯ä»£çç âå¤§èæç»´æ¨¡å¼âï¼é£ä¹äºä»¶é©±å¨æ¶æå°±æ¯Agentç³»ç»ç âç¥ç»ç½ç»âï¼å®ä½¿ç¨äºåå¸-è®¢éæ¨¡å¼ï¼ä»¥å»ä¸­å¿åçæ¹å¼åè°åç»ä»¶é«æè¿ä½ï¼åè®¸ç»ä»¶ä¹é´çæ¾è¦åéä¿¡ãæ´ä¸ªç³»ç»çæ ¸å¿å¹¶éåµç¡¬çåæ­¥è°ç¨ï¼èæ¯ä¸æ¡æ¿è½½ææå³é®æ´»å¨ç âäºä»¶æµâï¼ç³»ç»ä¸­çåç±»æ ¸å¿æä½é½ä¼è¢«æ½è±¡ä¸ºæ ååç âäºä»¶âã</p>
<p>OpenHands ä¸­ï¼EventStream è´è´£ç®¡çsessionä¸­çè§¦åçäºä»¶ï¼ä»¥åäºä»¶æ³¨åå½æ°çåè°é¡¹ç®ä¸­æ³¨åäºä»¶åè°å½æ°ï¼æ¯å¦ï¼</p>
<ul>
<li><code>Runtime</code>æ³¨åï¼åªæ¥æ¶<code>Action</code>çäºä»¶ä¸runtimeè¿è¡äº¤äº</li>
<li><code>AgentController</code>æ³¨åï¼æ ¹æ®äºä»¶æ´æ°Agentç¶æ</li>
<li><code>main</code>ï¼å½ä»¤è¡æ¹å¼æ§è¡agentææè¯ä¼°æ¶ä½¿ç¨ï¼æ¥æ¶agentç¶æåæ´äºä»¶</li>
</ul>
<p>å ä¸ºæ¬ç³»ååé´çæç« è¿å¤ï¼å¯è½å¨åèæç®ä¸­æéæ¼çæç« ï¼å¦ææï¼è¿è¯·å¤§å®¶æåºã</p>
<h2 id="0x01-eventstream">0x01 EventStream</h2>
<p>è¦ææ¡æ´ä¸ªç¨åºçè¿ä½ï¼é¦åè¦çè§£äºä»¶ç³»ç»çï¼å®å°±åæ¯ç¨åºä¸­çä¿¡æ¯é«éå¬è·¯ï¼åä¸ªé¨åéè¿å®æ¥äº¤æ¢ä¿¡æ¯ãOpenHands äºä»¶ç³»ç»çæ ¸å¿æ¯<code>EventStream</code>ç±»ï¼äºä»¶æµç³»ç»ï¼ï¼è¿æ¯ä¸ä¸ªä¸é¨å¤çäºä»¶çç³»ç»ï¼å®çæ ¸å¿ä½ç¨æ¯ç»´æ¤äºäºä»¶éåå¹¶æ¯æäºä»¶çåå¸åè®¢éï¼ç®¡çåååäºä»¶ãè¿ç§äºä»¶é©±å¨çæ¶æä½¿OpenHandsè½å¤å¤çå¼æ­¥æä½ï¼å¹¶æ¯æå¤Agentä¹é´çåä½ã</p>
<p>OpenHands çä»£ç å®ç°ç¸å¯¹ç®åï¼å³é®å¨äºçè§£å¶å·¥ä½åçãä¸»è¦æ­¥éª¤åæ¬ï¼</p>
<ul>
<li>å¯å¨ä¸ä¸ªå¾ªç¯è¿è¡ççº¿ç¨ï¼è¿ä¸ªçº¿ç¨è´è´£ä»äºä»¶éåä¸­è¯»åäºä»¶ï¼å¹¶å°å®ä»¬éä¸åéå°åä¸ªè®¢éæ¨¡åçå¤çéåä¸­ã</li>
<li>å½æ¨¡åéè¦è®¢éäºä»¶æ¶ï¼å®ä¼è°ç¨ä¸ä¸ªè®¢éå½æ°<code>subscribe</code>ï¼è¿æ ·äºä»¶æµå°±ä¼ä¸ºè¯¥æ¨¡åç»´æ¤ä¸ä¸ªçº¿ç¨æ± ï¼ææåéå°è¯¥æ¨¡åçäºä»¶é½ä¼è¢«ç¸åºçåè°å½æ°å¤çã</li>
<li>ä»»ä½å°æ¹éè¦åäºä»¶æµä¸­æ·»å äºä»¶æ¶ï¼é½ä¼è°ç¨ä¸ä¸ªæ·»å äºä»¶çå½æ°<code>add_event</code>ã</li>
</ul>
<p>äºä»¶æµçé»è¾è½ç¶ç®åï¼ä½ç¡®ä¿äºç¨åºåé¨åä¹é´çç¬ç«æ§åéä¿¡çä¸è´æ§ãè¿éçæ¶æ¯é½æ¯äºä»¶ï¼åä¸ºä¸¤ç§ç±»åï¼</p>
<ul>
<li><code>Action</code>ï¼æéè¦æ§è¡çä»»å¡ã</li>
<li><code>Observation</code>ï¼æç¯å¢å¯¹ä»»å¡æ§è¡ç»æçååºã</li>
</ul>
<p>ä¸å¾å±ç¤ºäº OpenHands ä¸­ Agent ä¸ç¯å¢äº¤äºçæ ¸å¿æºå¶ï¼Agent éè¿æ§è¡å¨ä½å½±åç¯å¢ï¼ç¯å¢éè¿è§å¯ç»æåé¦ç» Agentï¼Agent åºäºè¿äºåé¦ååºä¸ä¸æ­¥å³ç­ãï¼</p>
<ul>
<li>Agent å³å®æ§è¡ä¸ä¸ªå¨ä½ï¼éè¿AgentControlleråEventStreamä¼ å°äºRuntimeã</li>
<li>Runtime å¨ç¯å¢ä¸­æ§è¡è¯¥å¨ä½</li>
<li>ç¯å¢äº§çä¸ä¸ªè§å¯ç»æä½ä¸ºæ§è¡ç»æ</li>
<li>Runtime æè·è¿ä¸ªè§å¯ç»æå¹¶åéå° EventStreamï¼äºä»¶æµï¼</li>
<li>EventStream å­å¨è§å¯ç»æï¼ç¶åéè¿AgentControlleréç¥Agent</li>
<li>Agent è·åæ´æ°åçåå²è®°å½ï¼åæ¬æ°çè§å¯ç»æï¼</li>
<li>Agent ä½¿ç¨è§å¯ç»æååºä¸ä¸ä¸ªå³ç­</li>
<li>å¾ªç¯éå¤è¿è¡</li>
</ul>
<p><img alt="OpenHands-EventStream" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1850883/202602/1850883-20260201083414838-1659276950.png" class="lazyload"></p>
<h3 id="11-åè½">1.1 åè½</h3>
<p>EventStream çåè½å¦ä¸ï¼</p>
<ul>
<li>äºä»¶è®¢éä¸éç¥æºå¶ã
<ul>
<li>å¤è®¢éèæ¯æï¼éè¿EventStreamSubscriberæä¸¾å®ä¹äºå¤ç§è®¢éèç±»åã</li>
<li>çµæ´»è®¢éæºå¶ï¼ä½¿ç¨ subscribe å unscribe æ¹æ³ç®¡çè®¢éå³ç³»ã</li>
<li>å¤åè°æ¯æï¼æ¯ä¸ªè®¢éèå¯ä»¥æ³¨åå¤ä¸ªåè°å½æ°ï¼éè¿callback_idè¿è¡åºåã</li>
</ul>
</li>
<li>äºä»¶å¤çä¸åå
<ul>
<li>å¼æ­¥éåå¤çï¼ä½¿ç¨ queue.Queueåç¬ç«çº¿ç¨å¤çäºä»¶éåã</li>
<li>çº¿ç¨æ± æ§è¡ï¼ä¸ºæ¯ä¸ªè®¢éèçåè°å½æ°åå»ºç¬ç«ççº¿ç¨æ± ï¼é¿åé»å¡ã</li>
<li>é¡ºåºååï¼æç§è®¢éèIDçæåºé¡ºåºå°äºä»¶ååç»è®¢éèã</li>
</ul>
</li>
<li>äºä»¶å­å¨ä¸æä¹å
<ul>
<li>äºä»¶IDç®¡çï¼ä¸ºæ¯ä¸ªäºä»¶åéå¯ä¸IDå¹¶ç»´æ¤éå¢è®¡æ°å¨ã</li>
<li>æ¶é´æ³è®°å½ï¼èªå¨ä¸ºäºä»¶æ·»å æ¶é´æ³ã</li>
<li>æä»¶å­å¨ï¼å°äºä»¶ä»¥JSONæ ¼å¼æä¹åå°æä»¶ç³»ç»ã</li>
<li>ç¼å­é¡µé¢æºå¶ï¼ä½¿ç¨é¡µé¢ç¼å­æé«å¤§éäºä»¶çè¯»åæ§è½ã</li>
</ul>
</li>
<li>å·¥ä½æµç¨ï¼
<ul>
<li>ç»ä»¶éè¿subscribeæ¹æ³æ³¨åä¸ºäºä»¶è®¢éèã</li>
<li>å½æäºä»¶åçæ¶ï¼éè¿add_eventæ¹æ³æ·»å å°äºä»¶æµã</li>
<li>add_eventæ¹æ³å¤çäºä»¶IDåéï¼æ¶é´æ³è®¾ç½®ãæä¹åå­å¨ã</li>
<li>äºä»¶è¢«æ¾å¥å¤çéåï¼ç±ç¬ç«çº¿ç¨å¼æ­¥ååã</li>
<li>_process_queue ååæç§é¡ºåºå°äºä»¶ååç»ææè®¢éèçåè°å½æ°ã</li>
</ul>
</li>
</ul>
<p>è¿ç§è®¾è®¡ä½¿EventStreamç§°ä¸ºç³»ç»ä¸­æ ¸å¿çäºä»¶ä¸­æ¢ï¼å®ç°äºç»ä»¶é´çè§£è¦åå¼æ­¥éä¿¡ã</p>
<h3 id="12-å®ç°">1.2 å®ç°</h3>
<p>EventStream ç¸å³çä»£ç å¦ä¸ï¼</p>
<pre><code class="language-python">class EventStream(EventStore):
    secrets: dict[str, str]
    # For each subscriber ID, there is a map of callback functions - useful
    # when there are multiple listeners
    _subscribers: dict[str, dict[str, Callable]]
    _lock: threading.Lock
    _queue: queue.Queue[Event]
    _queue_thread: threading.Thread
    _queue_loop: asyncio.AbstractEventLoop | None
    _thread_pools: dict[str, dict[str, ThreadPoolExecutor]]
    _thread_loops: dict[str, dict[str, asyncio.AbstractEventLoop]]
    _write_page_cache: list[dict]

    def __init__(self, sid: str, file_store: FileStore, user_id: str | None = None):
        super().__init__(sid, file_store, user_id)
        self._stop_flag = threading.Event()
        self._queue: queue.Queue[Event] = queue.Queue()
        self._thread_pools = {}
        self._thread_loops = {}
        self._queue_loop = None
        self._queue_thread = threading.Thread(target=self._run_queue_loop)
        self._queue_thread.daemon = True
        self._queue_thread.start()
        self._subscribers = {}
        self._lock = threading.Lock()
        self.secrets = {}
        self._write_page_cache = []

    def _init_thread_loop(self, subscriber_id: str, callback_id: str) -&gt; None:
        loop = asyncio.new_event_loop()
        asyncio.set_event_loop(loop)
        if subscriber_id not in self._thread_loops:
            self._thread_loops[subscriber_id] = {}
        self._thread_loops[subscriber_id][callback_id] = loop
</code></pre>
<h3 id="13-è®¢é">1.3 è®¢é</h3>
<p>ä»»ä½å¤æä»»å¡çæ§è¡ï¼é½ç¦»ä¸å¼å¯¹ç¶æååçç²¾åæç¥ä¸å®æ¶ååºãOpenHands éç¨è§å¯èæ¨¡å¼ä½ä¸ºä»»å¡è°åº¦çæ ¸å¿æºå¶ï¼å¶è®¾è®¡çµææºèªç°å®ä¸çç "ææ¥ - ä¾¦å¯" ä½ç³» ââ å°±åæåºä¸çææ¥å®éè¦ä¾¦å¯åµå®æ¶ä¼ éåçº¿å¨æï¼æ¡æ¶ä¸­çè°åº¦ä¸­å¿ä¹ä¾èµåå¸å¼ç "ç¶æè§å¯è" æ¥ææ¡æ¯ä¸ä¸ªä»»å¡çè¿å±ã</p>
<p>å·ä½èè¨ï¼ç³»ç»å°ä»»å¡æè§£ä¸ºä¸ç³»åå¯çæ§ç "ç¶æèç¹"ï¼æ¯ä¸ªèç¹é½éå¤ä¸å±çè§å¯èå®ä¾ãå½æä¸èç¹çç¶æåçåæ´ï¼ä¾å¦ä» "å¾æ§è¡" è½¬ä¸º "æ§è¡ä¸­"ï¼æä» "æå" è½¬ä¸º "å¤±è´¥"ï¼ï¼è§å¯èä¼ç«å³è§¦åé¢è®¾çåè°é»è¾ï¼éç¥è°åº¦ä¸­å¿è¿è¡ä¸ä¸æ­¥å¤çãè¿ç§è®¾è®¡å¸¦æ¥äºä¸¤å¤§æ ¸å¿ä¼å¿ï¼</p>
<ul>
<li>
<p>å®ç°äºä»»å¡è°åº¦ç "æ¾è¦å"ãè°åº¦ä¸­å¿æ éä¸»å¨æ¥è¯¢æ¯ä¸ªä»»å¡çç¶æï¼èæ¯è¢«å¨æ¥æ¶ç¶æåæ´éç¥ï¼è¿å¤§å¹éä½äºç³»ç»åæ¨¡åé´çä¾èµå³ç³»ï¼ä½¿å¾æ°å¢ä»»å¡ç±»åæä¿®æ¹è°åº¦é»è¾æ¶ï¼æ ééææ´ä¸ªæ¡æ¶ã</p>
</li>
<li>
<p>æ¯æå¨æä¼åçº§è°æ´ãå½é«ç´§æ¥åº¦çä»»å¡æå¥æ¶ï¼è§å¯èå¯å®æ¶æè·è¿ä¸äºä»¶ï¼è§¦åè°åº¦ä¸­å¿çä¼åçº§éææºå¶ï¼æåä½ä¼åçº§ä»»å¡çèµæºåéï¼ç¡®ä¿å³é®ä»»å¡ä¼åæ§è¡ãè¿ç§çµæ´»æ§å¨å¤é¡¹ç®å¹¶è¡çåºæ¯ä¸­å°¤ä¸ºéè¦ã</p>
</li>
</ul>
<p>å¨è¿ä¸æ¶æä¸­ï¼ææç»ä»¶é½æ®æ¼ç âçäº§èâ æ âæ¶è´¹èâ çè§è²ãçäº§èè´è´£çæäºä»¶ï¼ä»£çå³ç­åäº§ç âå¨ä½äºä»¶âï¼è¿è¡æ¶ç¯å¢æ§è¡ä»»å¡åçæ âåé¦äºä»¶âãæ¶è´¹èåéè¿è®¢éç¹å®äºä»¶è·åä¿¡æ¯å¹¶ååºï¼è¿è¡æ¶è®¢é âå¨ä½äºä»¶â ä»¥æ§è¡å·ä½ä»»å¡ï¼æ§å¶å¨è®¢éå¨éäºä»¶ä»¥ç»´æ¤ç³»ç»ç¶æãè¿ç§åºäºäºä»¶çäº¤äºæ¨¡å¼ï¼å½»åºæç ´äºç»ä»¶é´çç´æ¥ä¾èµã</p>
<p>äºä»¶æµåä¸æ¡ç¯å½¢é«æ¶ï¼ä»»ä½è½¦è¾ï¼äºä»¶ï¼ä¸æ¦é©¶å¥ï¼å°±ä¼è¢«å¹¶è¡åéåæµå°å åº§æ¶è´¹ç«ââSessionãRuntimeãMemory ã AgentControllerã......ãå®ä»¬åèªé¢åä¸å±ãéè¡å¸ãï¼Subscriber æ è¯ï¼ï¼å¨åä¸æ¶å»å¯¹åä¸è¾è½¦è¿è¡å®æ£ãæ¶è´¹æè®°å½ï¼èæ éç­å¾åä¸å³å¡æ¾è¡ã</p>
<h4 id="131-è®¢éè">1.3.1 è®¢éè</h4>
<p>_subscribers å subscriber_id èµ·å°å¦ä¸ä½ç¨ã</p>
<p>subscriber_id ä¼å¯ä¸æ è¯ä¸ä¸ªè®¢éèï¼æ¯ä¸ªè®¢éèä»£è¡¨ç³»ç»çä¸åç»ä»¶æèæå¡ãä¸åçè®¢éèä¼å¤çäºä»¶ï¼æ¯å¦ï¼</p>
<ul>
<li>
<p>EventStreamSubscriber.SERVER: æå¡å¨å¤ç</p>
</li>
<li>
<p>EventStreamSubscriber.RUNTIME: è¿è¡æ¶å¤ç</p>
</li>
<li>
<p>EventStreamSubscriber.AGENT_CONTROLLER: ä»£çæ§å¶å¨å¤ç</p>
</li>
</ul>
<pre><code class="language-python">class EventStreamSubscriber(str, Enum):
    AGENT_CONTROLLER = 'agent_controller'
    RESOLVER = 'openhands_resolver'
    SERVER = 'server'
    RUNTIME = 'runtime'
    MEMORY = 'memory'
    MAIN = 'main'
    TEST = 'test'
</code></pre>
<p>å ä¸ªå¤§æ¨¡åé½æ¯å¨<code>__init__</code>å½æ°ä¸­å®ææ¨¡åçåå§ååå¤å·¥ä½ï¼å¹¶ä¸åäºä»¶æµä¸­è®¢éæ¶æ¯å¹¶æ³¨ååèªæ¨¡åçæ¶æ¯å¤çå½æ°ãäºä»¶åè°å½æ°ä¼æ ¹æ®å½åçäºä»¶è¿è¡ç¶ææºçç¶æè½¬ç§»ã</p>
<ul>
<li>Runtime å¨äºä»¶æµä¸­è®¢é EventStreamSubscriber.RUNTIMEï¼äºä»¶åè°å½æ°ä¼å¤çéè¦runtineå¤ççactionï¼æ¯å¦mcp/toolç­ç­ã<code>Runtime</code>åªå¤çå¯è¿è¡ç<code>Action</code>äºä»¶ï¼æ§è¡å¨ä½æ¿å°è¾åº<code>Observation</code>åéåäºä»¶æµä¸­<code>isinstance(event, MCPAction)</code>æ§è¡MCPè·åç»æå¶ä»runtimeæ¯æçactionåæ§è¡è·åç»æã</li>
<li>Memory å¨äºä»¶æµä¸­è®¢é EventStreamSubscriber.MEMORYãäºä»¶åè°å½æ°æ ¹æ®å½åç<code>event</code>çæä¸ä¸ªå¸¦<code>microagent_knowledge</code>ç<code>RecallObservation</code>å¹¶ä»¥<code>ENVIRONMENT</code>ä½ä¸ºæºæ·»å åäºä»¶æµä¸­ï¼è¿éç<code>microagent_knowledge</code>æ¯ä¸ç§ç¹å®æç¤ºè¯å¢å¼ºçæ¹æ³ã<code>Memory</code>åªå¤ç<code>RecallAction</code>ï¼å¯¹äºç¨æ·é¦æ¬¡è¾å¥ä¿¡æ¯åå°ä¸äºé¢å¤çå·¥ä½ç©ºé´ä¸ä¸æä¿¡æ¯æ·»å å°<code>RecallObservation</code>åéåäºä»¶æµä¸­ï¼å¯¹äºå¶ä»éç¨æ·é¦æ¬¡çè¾å¥ä¿¡æ¯åå å¥microagent_knowledgeå°<code>RecallObservation</code>åéåäºä»¶æµä¸­ã</li>
<li>AgentController å¨äºä»¶æµä¸­è®¢é EventStreamSubscriber.AGENT_CONTROLLERã<code>AgentController</code>ä½ä¸ºä¸»è¦ç¶æç®¡çæ¨¡åï¼
<ul>
<li>æ ¹æ®<code>Observation</code>äºä»¶è¿è¡ç¶æåæ¢</li>
<li>æ ¹æ®<code>Action</code>è¿è¡ç¶æåæ¢åä»¥ä¸å¤çï¼
<ul>
<li>å¯¹äº<code>MessageAction</code>åé<code>RecallAction</code>å°äºä»¶æµä¸­</li>
<li>å¯¹äº<code>AgentDelegateAction</code>åAgentè·¯ç±ï¼åç»­æºå¶è§£è¯»ä¸­åè¯¦ç»ä»ç»ï¼</li>
</ul>
</li>
<li>æ ¹æ®å½åç<code>event</code>å¤æ­è¿è¡è°ç¨<code>agent.step</code></li>
</ul>
</li>
<li>run_controller å¨äºä»¶æµä¸­è®¢é EventStreamSubscriber.MAINã</li>
<li>WebSessionãConversationManager ä¼è®¢é EventStreamSubscriber.SERVERã</li>
</ul>
<h4 id="132-åå">1.3.2 åå</h4>
<p>ç¨æ·åéæ¶æ¯æ·»å äºä¸æ¡æ¶æ¯å°æ¶æ¯æµä¸­ï¼ç³»ç»ä¼ä¾æ® subscriber_id æ¥å³å®åªäºè®¢éèåºè¯¥æ¥æ¶è¯¥ç±»äºä»¶ãè¿æ¡æ¶æ¯ä¼è¢«å¹¿æ­å°æ¯ä¸ä¸ªæ¶æ¯ééä¸­ï¼éè¿æ³¨åçåè°å½æ°å¯ä»¥åæåªäºæ¨¡åå¯¹æ¶æ¯è¿è¡äºå¤çã</p>
<pre><code class="language-python">    async def _process_queue(self) -&gt; None:
        while should_continue() and not self._stop_flag.is_set():
            event = None
            try:
                event = self._queue.get(timeout=0.1)
            except queue.Empty:
                continue

            # pass each event to each callback in order
            for key in sorted(self._subscribers.keys()): # æ­¤å¤ä¼å³å®ååå°åªé
                callbacks = self._subscribers[key]
                # Create a copy of the keys to avoid "dictionary changed size during iteration" error
                callback_ids = list(callbacks.keys())
                for callback_id in callback_ids:
                    # Check if callback_id still exists (might have been removed during iteration)
                    if callback_id in callbacks:
                        callback = callbacks[callback_id]
                        pool = self._thread_pools[key][callback_id]
                        future = pool.submit(callback, event)
                        future.add_done_callback(
                            self._make_error_handler(callback_id, key)
                        )
</code></pre>
<h4 id="133-èµæºç®¡ç">1.3.3 èµæºç®¡ç</h4>
<p>subscriber_id å¸®å©ç³»ç»ç®¡çæ¯ä¸ªè®¢éèçèµæºã</p>
<pre><code class="language-python">    def _clean_up_subscriber(self, subscriber_id: str, callback_id: str) -&gt; None:
        if subscriber_id not in self._subscribers:
            logger.warning(f'Subscriber not found during cleanup: {subscriber_id}')
            return
        if callback_id not in self._subscribers[subscriber_id]:
            logger.warning(f'Callback not found during cleanup: {callback_id}')
            return
        if (
            subscriber_id in self._thread_loops
            and callback_id in self._thread_loops[subscriber_id]
        ):
            loop = self._thread_loops[subscriber_id][callback_id]
            current_task = asyncio.current_task(loop)
            pending = [
                task for task in asyncio.all_tasks(loop) if task is not current_task
            ]
            for task in pending:
                task.cancel()
            try:
                loop.stop()
                loop.close()
            except Exception as e:
                logger.warning(
                    f'Error closing loop for {subscriber_id}/{callback_id}: {e}'
                )
            del self._thread_loops[subscriber_id][callback_id]

        if (
            subscriber_id in self._thread_pools
            and callback_id in self._thread_pools[subscriber_id]
        ):
            pool = self._thread_pools[subscriber_id][callback_id]
            pool.shutdown()
            del self._thread_pools[subscriber_id][callback_id]

        del self._subscribers[subscriber_id][callback_id]
</code></pre>
<h2 id="0x02-event">0x02 Event</h2>
<p>å¨ OpenHands ç³»ç»ä¸­ï¼Event æ¯ç³»ç»ä¸­æåºæ¬çæ°æ®ååï¼ä»£è¡¨ç³»ç»ä¸­åççåç§å¨ä½åè§å¯ç»æï¼ç¨æ·è¾å¥ãæºè½ä½ææ¬ãå·¥å·è°ç¨/ç»æãç¶æåæ´è¯·æ±ãæ§å¶ä¿¡å·ï¼ãææäºä»¶é½ç»§æ¿èª Event åºç±»ãè¡¨ç¤ºä¸ä¸ªåå­æ§äºä»¶ã</p>
<p>æ³è±¡ä¸ä¸ï¼å¦ææä»¬æ<code>Event Stream</code>æ¯ä½ä¸ä¸ªä¿¡æ¯ä¼ éçâé®æ¿ç³»ç»âï¼é£ä¹<code>Event</code>å°±æ¯è¿ä¸ªç³»ç»ä¸­ä¼ éçâä¿¡ä»¶âãå¨OpenHandsä¸­ï¼<code>Event</code>æ¯æåºæ¬çä¿¡æ¯åä½ï¼å®æ¯ä¸ä¸ªæ ååçæ°æ®ç»æï¼ç¨æ¥è®°å½ç³»ç»ä¸­åççä»»ä½éè¦äºä»¶ã</p>
<p>éè¿å°Agentçæèï¼ç±LLMçæçèªç¶è¯­è¨è¾åºï¼ä¸ç³»ç»çå®éæ§è¡ï¼ç»æåçAction/Observationï¼åå¼ï¼æä»¬è§£å³äºæå¾ä¸æ§è¡ä¹é´çéç¦»ãLLMè´è´£å³å®âè¦åä»ä¹âï¼èAction/Observationåè¯¦ç»è¯´æäºâææ ·å»åâåâç»æå¦ä½âï¼è¿ç¡®ä¿äºç³»ç»çç¨³å®æ§åå¯é¢æµæ§ã</p>
<h3 id="21-event">2.1 Event</h3>
<h4 id="211-å®ä¹">2.1.1 å®ä¹</h4>
<p>æ¯ä¸ä¸ª <code>Event</code> å¯¹è±¡é½æºå¸¦äºä¸äºåæ°æ®ï¼å°±åä¿¡å°ä¸çä¿¡æ¯ï¼</p>
<ul>
<li><code>id</code>: äºä»¶çå¯ä¸æ è¯ç¬¦ã</li>
<li><code>source</code>: äºä»¶çæ¥æºï¼å¯ä»¥æ¯ <code>AGENT</code>ã<code>USER</code> æ <code>ENVIRONMENT</code>ã</li>
<li><code>timestamp</code>: äºä»¶åççæ¶é´æ³ã</li>
<li><code>cause</code>: è§¦åæ­¤äºä»¶çå¦ä¸ä¸ªäºä»¶ç <code>id</code>ã</li>
</ul>
<p>å°ç³»ç»ä¸­çææäºå¨é½æ½è±¡ä¸º<code>Event</code>ï¼æä»¬å¾å°äºä¸ç§éç¨çè¯­è¨ãæ è®ºæ¯Agentçå³ç­ãç¨æ·çæ¶æ¯è¿æ¯ç¯å¢çåé¦ï¼é½å¯ä»¥ç»ä¸å¤çãå­å¨åååãç¹å«æ¯<code>cause</code>å­æ®µï¼å®åä¸æ¡çä¸è§ççº¿ï¼å°Actionåå®å¼èµ·çObservationç´§å¯èç³»èµ·æ¥ï¼å½¢æäºReActå¾ªç¯çå æé¾ï¼è¿å¯¹äºçè§£åè°è¯Agentçè¡ä¸ºè³å³éè¦ã</p>
<p>é¨åä»£ç å¦ä¸ï¼</p>
<pre><code class="language-python">@dataclass
class Event:
    INVALID_ID = -1

    @property
    def message(self) -&gt; str | None:
        if hasattr(self, '_message'):
            msg = getattr(self, '_message')
            return str(msg) if msg is not None else None
        return ''

    @property
    def id(self) -&gt; int:
        if hasattr(self, '_id'):
            id_val = getattr(self, '_id')
            return int(id_val) if id_val is not None else Event.INVALID_ID
        return Event.INVALID_ID
</code></pre>
<p>EventStream å¯¹Eventçå¤çè¿ç¨ä¸ºï¼</p>
<ul>
<li>
<p>äºä»¶éè¿ add_event æ¹æ³æ·»å å°æµä¸­</p>
</li>
<li>
<p>ç³»ç»èªå¨åé ID åæ¶é´æ³</p>
</li>
<li>
<p>äºä»¶è¢«å­å¨å°æä»¶ç³»ç»</p>
</li>
<li>
<p>äºä»¶è¢«æ¾å¥å¤çéå</p>
</li>
</ul>
<p>ç³»ç»éè¿ event_to_dict å event_from_dict å½æ°å¤çäºä»¶çåºåååååºååï¼ç¡®ä¿äºä»¶å¯ä»¥å¨ä¸åç»ä»¶é´ä¼ è¾åå­å¨ã</p>
<h4 id="212-åç±»">2.1.2 åç±»</h4>
<p>æç§åè½åç±»ï¼äºä»¶ä¸»è¦åä¸ºä¸¤ç±»ï¼</p>
<ul>
<li>ç¬¬ä¸ç§æ¯Actionï¼è¡å¨ï¼ï¼å®ä»£è¡¨äºæºè½ä»£çæ³è¦å¯¹ç¯å¢æ§è¡çå·ä½æä½ãè¿å¹¶ä¸æ¯æ¨¡ç³ä¸æ¸çèªç¶è¯­è¨æè¿°ï¼èæ¯ä¸ä¸ªæç¡®çæä»¤ãä¾å¦ï¼å¦æä»£çæ³è¦ååºæä¸ªç®å½ä¸çæææä»¶ï¼å®ä¼åéä¸ä¸ªæ¸æ°çæä»¤ï¼å¦âæ§è¡å½ä»¤'ls -l'âãè¿æ ·çæä»¤è®©ç³»ç»è½å¤åç¡®æ è¯¯å°çè§£ä»£ççæå¾å¹¶æ§è¡ç¸åºçæä½ã</li>
<li>ç¬¬äºç§æ¯Observationï¼è§å¯ï¼ï¼å®ä»£è¡¨äºæºè½ä»£çä»ç¯å¢ä¸­æ¶éå°çä¿¡æ¯ãè¿éå¸¸æ¯å¨æ§è¡äºæä¸ªè¡å¨ä¹åï¼ç³»ç»ç»äºçåé¦ãä¾å¦ï¼å¦æä»£çæ§è¡äºä¸ä¸ªååºæä»¶çå½ä»¤ï¼è§å¯å°±ä¼åå«æ§è¡ç»æçè¯¦ç»ä¿¡æ¯ï¼å¦âè¾åºåå®¹ä¸º'...'ï¼éåºä»£ç ä¸º0âãè¿äºä¿¡æ¯å¸®å©ä»£çäºè§£å¶è¡å¨çç»æï¼å¹¶ä¸ºä¸ä¸æ­¥è¡å¨æä¾ä¾æ®ã</li>
</ul>
<p>ææ¥æºï¼äºä»¶åç±»å¦ä¸ï¼</p>
<ul>
<li>EventSource.AGENT æ¥èªä»£ççæä½åè§å¯ç»æ</li>
<li>EventSource.USER æ¥èªç¨æ·çæä½</li>
<li>EventSource.ENVIRONMENT æ¥èªç¯å¢çæä½åè§å¯ç»æï¼è¿äºäºä»¶å¯è½åæ¬ï¼
<ul>
<li>ç³»ç»ç¶æåå</li>
<li>ç¯å¢åå§åå®æéç¥</li>
<li>è¿è¡æ¶ç¶ææ´æ°</li>
<li>ç³»ç»çº§çè§å¯ç»æ</li>
</ul>
</li>
</ul>
<pre><code class="language-python">class EventSource(str, Enum):
    AGENT = 'agent'
    USER = 'user'
    ENVIRONMENT = 'environment'
</code></pre>
<h3 id="22-action">2.2 Action</h3>
<h4 id="221-ç±»å">2.2.1 ç±»å</h4>
<p>æ»å±æ 13 ç§ä¸åç Action ç±»åãè¿äº Action æ¶µçäºä»£çæ§è¡çåç§æä½ï¼åæ¬æä»¶æä½ãå½ä»¤æ§è¡ãæ¶æ¯ä¼ éãç¶æç®¡çãä»£çå§æç­æ ¸å¿åè½ã</p>
<ul>
<li>
<p>åºç¡ Action ç±»åï¼</p>
<ul>
<li>Action â æ½è±¡åºç±»</li>
</ul>
</li>
<li>
<p>å·ä½ Action å®ç°ï¼</p>
<ul>
<li>AgentDelegateAction â å§æä»£çæ§è¡ä»»å¡</li>
<li>AgentThinkActionï¼åè®¸ Agent æ·»å çº¯ææ¬å°åå²è®°å½ä¸­çæ æä½ã</li>
<li>AgentFinishAction â ä»£çå®æä»»å¡ï¼åæ­¢æ§å¶å¾ªç¯ï¼åè®¸ç¨æ·è¾å¥æ°ä»»å¡ã</li>
<li>AgentRejectAction â ä»£çæç»ä»»å¡</li>
<li>AgentRecallActionï¼æç´¢è®°å¿ï¼ä¾å¦åéæ°æ®åºï¼ã</li>
<li>BrowseInteractiveAction â äº¤äºå¼æµè§</li>
<li>ChangeAgentStateAction â æ´æ¹ä»£çç¶æ</li>
<li>CmdRunAction â å¨æ²çç»ç«¯ä¸­è¿è¡å½ä»¤</li>
<li>CmdKillActionï¼ææ­»åå°å½ä»¤ã</li>
<li>FileEditAction â ç¼è¾æä»¶</li>
<li>FileReadAction â è¯»åæä»¶</li>
<li>IPythonRunCellAction â äº¤äºå¼æ§è¡Pythonä»£ç åï¼å¨Jupyterç¬è®°æ¬ä¸­ï¼å¹¶æ¥æ¶<code>CmdOutputObservation</code>ã</li>
<li>MessageAction â æ¶æ¯æä½ï¼è¡¨ç¤ºæ¥èªä»£çæç¨æ·çæ¶æ¯</li>
<li>AddTaskActionï¼åè®¡åä¸­æ·»å å­ä»»å¡ã</li>
<li>ModifyTaskActionï¼æ´æ¹å­ä»»å¡çç¶æã</li>
<li>NullAction â ç©ºæä½</li>
<li>SystemMessageAction â ç³»ç»æ¶æ¯æä½</li>
</ul>
</li>
<li>
<p>ç¹æ® Agent ç¸å³ Actionï¼</p>
<ul>
<li>CondensationAction â åå²åç¼©æä½</li>
<li>CondensationRequestAction â è¯·æ±åå²åç¼©æä½</li>
<li>RecallAction â åå¿æä½</li>
</ul>
</li>
</ul>
<h4 id="222-æµç¨">2.2.2 æµç¨</h4>
<p>å¨ OpenHands çæ¶æä¸­ï¼æ»ä½çäºä»¶æµå¦ä¸ï¼Agent -&gt; Action -&gt; Runtime-&gt; Observation -&gt; Agent</p>
<ul>
<li>AgentçæActionäºä»¶å¹¶åéå°ç¯å¢</li>
<li>äºä»¶éè¿EventStreamä¼ éç»Runtimeæ§è¡</li>
<li>Runtimeæ§è¡ç¸åºæä½</li>
<li>Environment æ§è¡ Action å¹¶çæ Observation ä½ä¸ºååº</li>
<li>Observation è¢«åéå Agent ä½ä¸ºä¸ä¸æ­¥å³ç­çè¾å¥</li>
</ul>
<p>å·ä½å¯ä»¥åè§anthropicçå¾ä¾ã</p>
<p><img alt="openhands-4.1-4" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1850883/202602/1850883-20260201083452219-1952089719.png" class="lazyload"></p>
<p><a href="https://www.anthropic.com/engineering/building-effective-agents" target="_blank" rel="noopener nofollow">Building effective agents</a></p>
<p>å³ï¼ä¸ºäºè§£å³çº¿æ§å·¥ä½æµçèå¼±æ§ï¼å¼å¥äº<strong>é­ç¯åé¦</strong>æºå¶ãç°å¨ï¼ä»»å¡çæ¯ä¸æ­¥ä¸åæ¯ä¸æ¬¡æ§çè°ç¨ï¼èæ¯ä¸ä¸ª<strong>å¯ä»¥èªæçº éç Agent</strong>ãè¿ç§ Agent å¾ªç¯æå¤§å°æåäºç³»ç»çé²æ£æ§åæç»ç»æçè´¨éï¼å ä¸ºæ¨¡åææºä¼ä»èªå·±çéè¯¯ä¸­å­¦ä¹ åæ¢å¤ã</p>
<p>å æ­¤ï¼æä»¬å¼å¥äºObservationã</p>
<h3 id="23-observation">2.3 Observation</h3>
<p>Actionæ¯Agentå¯¹ç¯å¢ï¼Runtimeï¼ååºçæä»¤æèæä½ï¼Observationæ¯ç¯å¢å¯¹è¿äºæä½çååºæèåé¦ãå®ä»£è¡¨äºç¯å¢å¯¹ Agent æ§è¡ç Action çååºï¼åå«äºæä½ç»æãç¯å¢ç¶æååç­ä¿¡æ¯ï¼ä¾ Agent è¿è¡ä¸ä¸æ­¥å³ç­ä½¿ç¨ãè¿ç§è®¾è®¡ç¬¦åå¸åçå¼ºåå­¦ä¹ åæºè½ä½ç³»ç»çæ¨¡å¼ï¼å¶ä¸­ Agent éè¿ä¸ç¯å¢äº¤äºï¼æ§è¡ Action å¹¶æ¥æ¶ Observationï¼æ¥å®æä»»å¡ã</p>
<h4 id="231-ç±»å">2.3.1 ç±»å</h4>
<ul>
<li>
<p>å¤é¨æ¥æºç Observationsï¼å¤§é¨å Observation å¯¹è±¡æ¯ä»å¤é¨ç¯å¢æè¿è¡æ¶ç³»ç»æå»ºå¹¶ä¼ å¥çï¼è¿äº Observation ç±»åé½ä»£è¡¨äºç¯å¢çä¸åç¶æï¼ä¾å¦ï¼</p>
<ul>
<li>å½ä»¤æ§è¡ç»æï¼CmdRunObservationï¼</li>
<li>æä»¶è¯»åç»æï¼FileReadObservationï¼</li>
<li>IPython æ§è¡ç»æï¼IPythonRunCellObservationï¼</li>
<li>æµè§å¨äº¤äºç»æï¼BrowserOutputObservationï¼</li>
<li>RecallObservation: è®°å¿æ£ç´¢ç»æ</li>
<li>CmdOutputObservationï¼å½ä»¤æ§è¡çè¾åºã</li>
<li>BrowserOutputObservationï¼æµè§ URL åçè¾åºã</li>
<li>FileReadObservationï¼æä»¶è¯»åæä½çè¾åºã</li>
<li>AgentRecallObservationï¼Agent åå¿æä½çè¾åºã</li>
<li>AgentErrorObservationï¼Agent æ§è¡æä½æ¶åçéè¯¯çè¾åºã</li>
</ul>
<p>è¿äºéå¸¸ç±è¿è¡æ¶ç³»ç»åå»ºå¹¶éè¿äºä»¶æµä¼ éç»æ§å¶å¨ã</p>
</li>
<li>
<p>AgentController åé¨æå»ºç Observationsãå¨ AgentController ç±»ä¸­ï¼æå å¤ä¼ç´æ¥æå»º Observation å¯¹è±¡ï¼</p>
<ul>
<li>NullObservationï¼è¡¨ç¤ºæ æä½æå¿½ç¥çè§å¯ç»æï¼ç¨äºè¿æ»¤ä¸éè¦å¤ççäºä»¶ã</li>
<li>ErrorObservationï¼è¡¨ç¤ºæ§è¡è¿ç¨ä¸­åççéè¯¯ï¼åå«éè¯¯ä¿¡æ¯ä¾ä»£çå¤çã</li>
<li>AgentStateChangedObservationï¼è¡¨ç¤ºä»£çç¶æçåæ´ï¼å¦å è½½ãè¿è¡ãéè¯¯ç­ç¶æãæ¯å¦ï¼å¨AgentControllerçset_agent_state_toå½æ°ä¸­ï¼å½agentç¶æåçæ¹åæ¶ä¼åå»ºä¸ä¸ªAgentStateChangedObservationäºä»¶ï¼å¹¶å°å¶æ¥æºè®¾ç½®ä¸º EventSource.ENVIRONMENTã</li>
</ul>
</li>
</ul>
<h4 id="232-æµç¨">2.3.2 æµç¨</h4>
<p>Observation å¨ Agent ä¸­çå¤çæµç¨å¦ä¸ï¼</p>
<pre><code class="language-python">Runtime æ§è¡ Action --&gt; äº§ç Observation --&gt; EventStream åå¸äºä»¶ --&gt; AgentController.on_event æ¥æ¶ --&gt; å¤æ­æ¯å¦éè¦ step --&gt; AgentController._step å¤ç --&gt; è°ç¨ Agent.step --&gt; Agent åºäºåå²äºä»¶ï¼åæ¬ Observationï¼å³ç­
</code></pre>
<p>å·ä½æµç¨å¦ä¸ï¼</p>
<ul>
<li>Runtimeæ§è¡å®actionä¹åï¼çæobservationäºä»¶ã</li>
<li>äºä»¶éè¿EventStream.add_event() ä¼ åAgentï¼è¿äº Observations éè¿äºä»¶æµä¼ éï¼ç¨äºæ´æ°ä»£ççç¶æååå²è®°å½ã</li>
<li>AgentController è®¢é EventStreamï¼å¨ on_event() æ¹æ³ä¸­å¤çè¿äºäºä»¶ã</li>
<li>Agentåºäºobservationå³å®ä¸ä¸æ­¥å¨ä½ã</li>
</ul>
<p>Observation å¨ Agent å³ç­ä¸­çä½ç¨å¦ä¸ï¼</p>
<ul>
<li>Agent ç¶ææ´æ°ï¼AgentStateChangedObservation ä¼æ´æ° Agent çåé¨ç¶æï¼éè¯¯ Observation ä¼è§¦åéè¯¯å¤çæµç¨ã</li>
<li>åå²è®°å½ï¼ææ Observations é½è¢«å­å¨å¨ State.history ä¸­ï¼Agent å¨å³ç­æ¶ä¼åé¡¾æ´ä¸ªåå²è®°å½ï¼åæ¬ææç Actions å Observationsã</li>
<li>å³ç­ä¾æ®ï¼Agentï¼LLMï¼éè¿åæåå²ä¸­ç Observations æ¥çè§£ç¯å¢ç¶æï¼ä¾å¦ CmdOutputObservation æä¾äºå½ä»¤æ§è¡ç»æï¼Agent æ®æ­¤å³å®ä¸ä¸æ­¥è¡å¨ã</li>
</ul>
<h4 id="233-ç»è">2.3.3 ç»è</h4>
<p>ä¸»è¦ç Observation æå»ºä½ç½®åæ¬ï¼</p>
<ul>
<li>è¿è¡æ¶ç¯å¢ï¼æ§è¡å½ä»¤ãæä»¶æä½ç­ï¼</li>
<li>AgentController._reset () æ¹æ³ï¼æå»º ErrorObservationï¼</li>
<li>AgentController.set_agent_state_to () æ¹æ³ï¼æå»º AgentStateChangedObservationï¼</li>
<li>AgentController.end_delegate () æ¹æ³ï¼æå»º AgentDelegateObservationï¼</li>
</ul>
<h3 id="24-environment">2.4 Environment</h3>
<p>éå¯¹ EventSource.ENVIRONMENTï¼æ¬å°èåç¹æ®è¯´æã</p>
<p>EventSource.ENVIRONMENT éå¸¸è¡¨ç¤ºç±ç³»ç»ç¯å¢æèåºç¡è®¾æ½çæçäºä»¶ï¼å¯è½åæ¬ï¼</p>
<ul>
<li>ç³»ç»ç¶æååã</li>
<li>ç¯å¢åå§åå®æéç¥ã</li>
<li>è¿è¡æ¶ç¶ææ´æ°ã</li>
<li>ç³»ç»çº§çè§å¯ç»æã</li>
</ul>
<p>å¨ä»£ç ä¸­ä½¿ç¨å¦ä¸ã</p>
<pre><code class="language-python"># openhands\cli\commands.py
def handle_exit_command(
    config: OpenHandsConfig,
    event_stream: EventStream,
    usage_metrics: UsageMetrics,
    sid: str,
) -&gt; bool:
    if confirm_exit:
        event_stream.add_event(
            ChangeAgentStateAction(AgentState.STOPPED),
            EventSource.ENVIRONMENT,
        )

# å¨ Runtime ä¸­        
    def maybe_run_setup_script(self):
        # setup scripts time out after 10 minutes
        action = CmdRunAction(
            f'chmod +x {setup_script} &amp;&amp; source {setup_script}',
            blocking=True,
            hidden=True,
        )
        # Add the action to the event stream as an ENVIRONMENT event
        source = EventSource.ENVIRONMENT
        self.event_stream.add_event(action, source)
        
# å¨Memoryç±» _on_event æ¹æ³ä¸­ï¼æä»¬å¯ä»¥çå°ç¯å¢è¿åç Observation è¢«éæ°æ è®°ä¸º Agent äºä»¶åéå° UI:python
async def _on_event(self, event: Event):   
    self.event_stream.add_event(workspace_obs, EventSource.ENVIRONMENT)
    
# å¨ AgentSession ä¸­
                    self.event_stream.add_event(
                        ChangeAgentStateAction(AgentState.RUNNING),
                        EventSource.ENVIRONMENT,
                    )

# å¨ WebSession ä¸­
        self.agent_session.event_stream.add_event(
            AgentStateChangedObservation('', AgentState.LOADING),
            EventSource.ENVIRONMENT,
        )
    
# AgentController ä¸­
    async def set_agent_state_to(self, new_state: AgentState) -&gt; None:
        self.event_stream.add_event(
            AgentStateChangedObservation('', self.state.agent_state, reason),
            EventSource.ENVIRONMENT,
        )
</code></pre>
<p>è½ç¶Runtimeä¹ä¼äº§çä¸äºè§å¯ç»æï¼ä½å·ä½æ¯ EventSource.ENVIRONMENT æè EventSource.AGENTï¼åå³äºä¸ä¸æã</p>
<h3 id="25-agentthinkaction">2.5 AgentThinkAction</h3>
<p>æä»¬æ¥çç AgentThinkActionï¼è¯¥Actionåè®¸ Agent æ·»å çº¯ææ¬å°åå²è®°å½ä¸­çæ æä½ã</p>
<pre><code class="language-python">            # ================================================
            # AgentThinkAction
            # ================================================
            elif tool_call.function.name == ThinkTool['function']['name']:
                action = AgentThinkAction(thought=arguments.get('thought', ''))
</code></pre>
<p>ThinkTool æ¯å¯¹Anthropic  Think Toolè®¾è®¡çå¿µçæ¨¡ä»¿æåå®ç°ã</p>
<h4 id="anthropic--think-tool">Anthropic  Think Tool</h4>
<p>Anthropic Think Toolå¨æ§è¡å¤æä»»å¡æ¶ä¸ºå¶åå»ºä¸é¨ç¨äºç»æåæèçç©ºé´ãThink Toolåçå¨AIå¼å§ååºä¹åï¼åæ¯å¨å·¥ä½è¿ç¨ä¸­ä¸»å¨åä¸æ¥æ´çæè·¯ãéè¿âthinkâå·¥å·ï¼Anthropic  èµäº Claude å¨å¾åºæç»ç­æ¡çè¿ç¨ä¸­æå¥ä¸ä¸ªé¢å¤æèæ­¥éª¤çè½åââè¯¥æ­¥éª¤æ¥æèªå·±ä¸å±çæèç©ºé´ï¼ç¨ä»¥å¤æ­å½åæ¯å¦å·²ææ¡ç»§ç»­æ¨è¿æéçå¨é¨ä¿¡æ¯ãè¿ä¸æºå¶å¨æ§è¡é¿é¾æ¡çå·¥å·è°ç¨æä¸ç¨æ·è¿è¡å¤è½®å¤æå¯¹è¯æ¶å°¤ä¸ºæç¨ã</p>
<p>å°½ç®¡å¬èµ·æ¥ä¸å»¶ä¼¸æèï¼<a href="https://www.anthropic.com/research/visible-extended-thinking" target="_blank" rel="noopener nofollow">extended thinking</a>ï¼ç±»ä¼¼ï¼ä½äºèæ¦å¿µä¸åï¼å»¶ä¼¸æèåçå¨ Claude å¼å§çæåå¤<strong>ä¹å</strong>ï¼è®©æ¨¡åæ·±åº¦æèå¹¶è¿­ä»£æ¹æ¡ï¼èâæèâå·¥å·ç¨äº Claude<strong>å·²å¼å§çæåå¤å</strong>ï¼å¨éå°é¿é¾æ¡å·¥å·è°ç¨æé¿å¯¹è¯æ¶ï¼ä¸»å¨æåå¹¶æèæ¯å¦å·²ææ¡è¶³å¤ä¿¡æ¯ãå®å°¤å¶éç¨äºæ¨¡åæ æ³ä»å­ç¨æ·æ¥è¯¢è·å¾å¨é¨ä¿¡æ¯ï¼èéå¤çå¤é¨ä¿¡æ¯ï¼å¦å·¥å·è¿åç»æï¼çåºæ¯ã</p>
<p>ç¸æ¯å»¶ä¼¸æèï¼âæèâå·¥å·æè¿è¡çæ¨çèå´æ´çªï¼æ´èç¦äºæ°åç°çä¿¡æ¯ã</p>
<p>Anthropic  æ¨èï¼</p>
<ul>
<li>å¯¹äºéé¡ºåºå·¥å·è°ç¨æç®åæä»¤éµå¾ªï¼ä¼åä½¿ç¨å»¶ä¼¸æèï¼</li>
<li>å¯¹äºå¤æå·¥å·é¾ãéä»ç»åæå·¥å·è¾åºãç­ç¥å¯éåç¯å¢æä»£ä»·é«æçåºåå³ç­ï¼ä½¿ç¨âæèâå·¥å·ã</li>
</ul>
<h5 id="ä½æ¶ä½¿ç¨æèå·¥å·">ä½æ¶ä½¿ç¨âæèâå·¥å·</h5>
<p><strong>éç¨åºæ¯</strong>ï¼</p>
<ul>
<li>éæ·±åº¦åæååºå·¥å·è¾åºï¼å¯è½åæº¯æ¹æ¡ï¼</li>
<li>ç­ç¥å¯éåç¯å¢ï¼ééªè¯åè§æ§ï¼</li>
<li>åºåå³ç­ï¼æ¯æ­¥ä¾èµååºç»æä¸éè¯¯ä»£ä»·é«ã</li>
</ul>
<p><strong>ä¸éç¨åºæ¯</strong>ï¼</p>
<ul>
<li>åæ¬¡æå¹¶è¡å·¥å·è°ç¨å³å¯å®æä»»å¡ï¼</li>
<li>çº¦æç®åï¼é»è®¤è¡ä¸ºå·²è¶³å¤ã</li>
</ul>
<h5 id="æä½³å®è·µ">æä½³å®è·µ</h5>
<ol>
<li><strong>é¢åç¤ºä¾é©±å¨çæç¤º</strong><br>
ç»åºä½æ¶ãå¦ä½è°ç¨æèå·¥å·ï¼å¹¶æä¾è´´åä¸å¡çæ¨çç¤ºä¾ï¼è§åæèªç©ºåæç¤ºï¼ã</li>
<li><strong>å°å¤ææä»¤æ¾å¥ç³»ç»æç¤º</strong><br>
é¿ä¸å¤æçæèæåæ¾å¨ç³»ç»æç¤ºèéå·¥å·æè¿°ä¸­ï¼æææ´ä½³ã</li>
<li><strong>æç»­çæ§ä¸è¿­ä»£</strong><br>
è§å¯ Claude å®éè°ç¨æ¨¡å¼ï¼éå¯¹æ§è°æ´æç¤ºï¼ä»¥å¼ºåæææèè·¯å¾ã</li>
</ol>
<h4 id="ä»£ç ">ä»£ç </h4>
<p>ThinkTool å¯¹åºçä»£ç å¦ä¸ãè®©æ¨¡åå¨âåé¨ç¬ç½âé¶æ®µææèè¿ç¨åå¥æ¥å¿ï¼ä¸è§¦åå¤é¨è°ç¨ã</p>
<pre><code class="language-python">_THINK_DESCRIPTION = """Use the tool to think about something. It will not obtain new information or make any changes to the repository, but just log the thought. Use it when complex reasoning or brainstorming is needed.

Common use cases:
1. When exploring a repository and discovering the source of a bug, call this tool to brainstorm several unique ways of fixing the bug, and assess which change(s) are likely to be simplest and most effective.
2. After receiving test results, use this tool to brainstorm ways to fix failing tests.
3. When planning a complex refactoring, use this tool to outline different approaches and their tradeoffs.
4. When designing a new feature, use this tool to think through architecture decisions and implementation details.
5. When debugging a complex issue, use this tool to organize your thoughts and hypotheses.

The tool simply logs your thought process for better transparency and does not execute any code or make changes."""

ThinkTool = ChatCompletionToolParam(
    type='function',
    function=ChatCompletionToolParamFunctionChunk(
        name='think',
        description=_THINK_DESCRIPTION,
        parameters={
            'type': 'object',
            'properties': {
                'thought': {'type': 'string', 'description': 'The thought to log.'},
            },
            'required': ['thought'],
        },
    ),
)

class ThinkExecutor(ToolExecutor):
    def __call__(
        self,
        _: ThinkAction,
        conversation: "BaseConversation | None" = None,  # noqa: ARG002
    ) -&gt; ThinkObservation:
        return ThinkObservation.from_text(text="Your thought has been logged.")


class ThinkTool(ToolDefinition[ThinkAction, ThinkObservation]):
    """Tool for logging thoughts without making changes."""

    @classmethod
    def create(
        cls,
        conv_state: "ConversationState | None" = None,  # noqa: ARG003
        **params,
    ) -&gt; Sequence[Self]:
        """Create ThinkTool instance.

        Args:
            conv_state: Optional conversation state (not used by ThinkTool).
            **params: Additional parameters (none supported).

        Returns:
            A sequence containing a single ThinkTool instance.

        Raises:
            ValueError: If any parameters are provided.
        """
        if params:
            raise ValueError("ThinkTool doesn't accept parameters")
        return [
            cls(
                description=THINK_DESCRIPTION,
                action_type=ThinkAction,
                observation_type=ThinkObservation,
                executor=ThinkExecutor(),
                annotations=ToolAnnotations(
                    readOnlyHint=True,
                    destructiveHint=False,
                    idempotentHint=True,
                    openWorldHint=False,
                ),
            )
        ]
</code></pre>
<h2 id="0xff-åè">0xFF åè</h2>
<p><a href="https://docs.all-hands.dev/openhands/usage/architecture/backend" target="_blank" rel="noopener nofollow">https://docs.all-hands.dev/openhands/usage/architecture/backend</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/1936485868761257658" target="_blank" rel="noopener nofollow">å½AI Agentä»âç©å·âèµ°åâå·¥å·âï¼æä»¬è¯¥å³æ³¨ä»ä¹ï¼Openhandsæ¶æè§£æãç¬¬äºç¯ï¼Agent ç¸å³æ ¸å¿æ¦å¿µã</a>  <a href="https://www.zhihu.com/people/dreamrenderx" target="_blank" rel="noopener nofollow">åé</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/1936175201323825087" target="_blank" rel="noopener nofollow">å½AI Agentä»âç©å·âèµ°åâå·¥å·âï¼æä»¬è¯¥å³æ³¨ä»ä¹ï¼Openhandsæ¶æè§£æãç¬¬ä¸ç¯ï¼ç³»åå¯¼è¯»ã</a> <a href="https://www.zhihu.com/people/dreamrenderx" target="_blank" rel="noopener nofollow">åé</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/1940436682949244630" target="_blank" rel="noopener nofollow">Coding Agentä¹Openhandsè§£æ(å«ä»£ç )</a>  <a href="https://www.zhihu.com/people/wu-long-ming-cha-56" target="_blank" rel="noopener nofollow">Arrow</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/1940824548485347192" target="_blank" rel="noopener nofollow">OpenHands æºç è§£è¯»</a>  <a href="https://www.zhihu.com/people/xiao-hui-66-72" target="_blank" rel="noopener nofollow">ä¸åè¾</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/1949931198932586886" target="_blank" rel="noopener nofollow">Anthropic å®æ¹æç¨ï¼ä¸º Agent è®¾è®¡é«æå·¥å·çæä½³å®è·µ</a></p>
<p><a href="https://www.anthropic.com/engineering/claude-think-tool" target="_blank" rel="noopener nofollow">The "think" tool: Enabling Claude to stop and think in complex tool use situations</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 21:10">2026-02-04 21:10</span>&nbsp;
<a href="https://www.cnblogs.com/rossiXYZ">ç½è¥¿çæè</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19560027);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19560027', targetLink: 'https://www.cnblogs.com/rossiXYZ/p/19560027', title: 'AI Agent æ¡æ¶æ¢ç§ï¼æè§£ OpenHandsï¼6ï¼--- äºä»¶ç³»ç»' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ç¨ Hashids ä¼éè§£å³ C ç«¯èªå¢ ID æ´é²é®é¢ ]]></title>
    <link>https://www.cnblogs.com/hackyle/p/19576480</link>
    <guid>682d9219f25f95ad62e8a894cec1fa60</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/hackyle/p/19576480" title="åå¸äº 2026-02-04 21:08">
    <span role="heading" aria-level="2">ç¨ Hashids ä¼éè§£å³ C ç«¯èªå¢ ID æ´é²é®é¢</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>&nbsp; &nbsp;å¨ C ç«¯ç³»ç»ä¸­ï¼ç´æ¥å¯¹å¤æ´é²æ°æ®åºèªå¢ ID å¾å¾ä¼å¸¦æ¥æ°æ®æä¸¾ãè¶æè®¿é®ç­å®å¨éæ£ãæ¬æå°ä»å®éä¸å¡åºæ¯åºåï¼åæèªå¢ ID æ´é²çé®é¢æ¬è´¨ï¼å¹¶ä»ç»ä¸ç§åºäº Hashids çå¯é ID æ··æ·æ¹æ¡ãéè¿ Hashidsï¼æä»¬å¯ä»¥å¨ä¸æ¹åæ°æ®åºç»æçåæä¸ï¼å®ç°å¯¹å¤ ID çå®å¨åä¸ç¾è§åï¼å¼é¡¾å®å¨æ§ãæ§è½ä¸å·¥ç¨å¯è½å°æ§ã</p>
<p><strong>æ¬æä¸»è¦åå®¹ï¼</strong></p>
<ul>
<li>ä¸ºä»ä¹ C ç«¯ç³»ç»ä¸è½ç´æ¥æ´é²èªå¢ ID</li>
<li>è§£å³æ¹æ¡æ¯ä»ä¹</li>
<li>hashidsæé£äºåè½</li>
<li>hashidsçä»£ç å®ç°æ¯ä»ä¹</li>
</ul>
<h1>ä¸ºä»ä¹ C ç«¯ç³»ç»ä¸è½ç´æ¥æ´é²èªå¢ IDï¼</h1>
<p>å¨åç«¯ç³»ç»ä¸­ï¼æä»¬ä¹ æ¯ä½¿ç¨æ°æ®åºèªå¢ IDï¼å¹¶ä¹ æ¯æ§çç´æ¥è¿åç»Cç«¯äº¤äºä½¿ç¨ï¼ä¾å¦ï¼</p>
<blockquote>
<p>ç»å½æ¥å£å¨ç»å½æååè¿åçç¨æ·åºç¡ä¿¡æ¯<br>{<br>&nbsp; &nbsp; "userId": 100,<br>&nbsp; &nbsp; "username": "tom",<br>&nbsp; &nbsp; "gender": 1,<br>&nbsp; &nbsp; "birthday": "2000-10-12 00:00:00"<br>}</p>
<p>URLä¸ç´æ¥æèªå¢IDï¼GET /api/user/100</p>
</blockquote>
<h2>å¯è¢«æä¸¾</h2>
<p>åªè¦æäººåç°è¿æ¯<strong data-start="195" data-end="204">èªå¢ IDï¼</strong>ä¾å¦ï¼GET /api/user/100ï¼èªç¶å¯ä»¥è¢«æä¸¾</p>
<blockquote>
<p>/api/user/101</p>
<p>/api/user/102</p>
<p>/api/user/103</p>
<p>......</p>
</blockquote>
<p>åç°äºé®é¢æ²¡ï¼</p>
<ul>
<li>å¯ä»¥è½»æ¾éåæ¥å£ãç¬è«å¯ä»¥æ¹éæ«åº</li>
<li>åªæä½ æç»å½æãé´æï¼åªè¦ <strong data-start="289" data-end="304">æéæ ¡éªæä¸ä¸ªç¹æ²¡åä½</strong>ï¼åææå¶ä¸¥éï¼è¡¨æ°æ®è¢«æ¹éæåï¼éç§æ°æ®è¢«éåãç¬å</li>
<li>è¿ç±»æ»å»ææ¬æä½ï¼çè³ä¸ç®âæ»å»â</li>
</ul>
<h2>è¶æ</h2>
<p>è¶æçé£é©è¢«æ éæ¾å¤§ï¼ä½ âä»¥ä¸ºâä½ åäºé´æï¼å¶å®ä¸ä¸å®ï¼ç°å®æåµå¾å¾æ¯ï¼</p>
<ul>
<li>æ¥å£ A åäºç¨æ·æ ¡éª</li>
<li>æ¥å£ B å¿äº</li>
<li>æ°æ¥å£ä¸´æ¶å çï¼æ ¡éªæ¼äº</li>
<li>æä¸ªåé¨æ¥å£è¢«è¯¯æ´é²</li>
</ul>
<p>ä¸æ¦ ID æ¯å¯é¢æµçï¼</p>
<ul>
<li>æ»å»èåªéè¦æ¾å° ä¸ä¸ªæ²¡æ ¡éªçå¥å£</li>
<li>å°±å¯ä»¥âæ¨ªåç§»å¨âè®¿é®æææ°æ®</li>
</ul>
<p>ä¾å¦ï¼URLä¸­å­å¨èªå¢IDï¼å¨Cç«¯éå¸¸å¸åçåºæ¯æ¯ç¨æ·åäº«é¾æ¥ç»æåï¼å¦ææåä¿®æ¹URLä¸­çIDï¼å°±ä¼è·³è½¬å°æ¬ä¸å±äºèªå·±è½çå°çæ°æ®åå®¹ã</p>
<h2>ä¸å¡ä¿¡æ¯å¨æ´é²</h2>
<p>éè¿ ID å°±è½çç©¿ä½ çä¸å¡ä¿¡æ¯ï¼ä¾å¦ï¼</p>
<ul>
<li data-start="704" data-end="720">
<p data-start="706" data-end="720">ð <strong data-start="709" data-end="720">è®¢åéå¢é¿éåº¦</strong></p>
</li>
<li data-start="721" data-end="734">
<p data-start="723" data-end="734">ð¥ <strong data-start="726" data-end="734">ç¨æ·è§æ¨¡</strong></p>
</li>
<li data-start="735" data-end="750">
<p data-start="737" data-end="750">â±ï¸ <strong data-start="740" data-end="750">ä¸å¡å³°å¼æ¶æ®µ</strong></p>
</li>
<li data-start="751" data-end="775">
<p data-start="753" data-end="775">ð§® <strong data-start="756" data-end="775">æ¯å¦å è¿æ°æ®ï¼ID æ¯å¦æ­å±ï¼</strong></p>
</li>
</ul>
<p>è¿ç§å¨Cç«¯ç¨æ·çæ¥æ²¡ææä¹çæ°æ®ï¼å¦æè®©ç¨æ·âçä¸æâç IDï¼åèæ´ä¸ä¸ã</p>
<ul data-start="1330" data-end="1384">
<li data-start="1330" data-end="1356">
<p data-start="1332" data-end="1356">ð çº¯æ°å­ IDï¼çèµ·æ¥åâåé¨ç³»ç»â</p>
</li>
<li data-start="1357" data-end="1384">
<p data-start="1359" data-end="1384">ðæ··æ· IDï¼&nbsp;æ´åâäº§åè®¾è®¡çä¸é¨åâ</p>
</li>
</ul>
<h1>è§£å³æ¹æ¡</h1>
<p>æ ¹æ®ä»¥ä¸é®é¢ï¼æä»¬æææè¿æ ·ä¸ç§è§£å³æ¹æ¡å¯ä»¥æ··æ·èªå¢ID</p>
<ul>
<li>å¯ä¸ä¸å¯éå¤ï¼æ°æ®éåé½å¿é¡»å¯ä¸ï¼ä¸è½éå¤</li>
<li>æ¯æå¯éï¼IDå¯ä»¥ç¼ç ä¸ºä¸ä¸ªçä¸åºè§å¾çä¸²ï¼ä¹å¯ä»¥è§£ç ä¸ºåIDï¼ä¸å½±åæ°æ®åºIDå­æ®µ</li>
<li>é«æçæä¸è§£æï¼çæãéªè¯çç®æ³å¿é¡»ä¿è¯æçï¼ä¸è½å ç¨å¤ªå¤ç³»ç»èµæº</li>
<li>ä¸å¯é¢æµä¸å®å¨ï¼æ è§åæ··æ·ï¼è§å¾æ§ä¸è½å¾ææ¾ï¼ä¸è½è½»æè¢«äººçæµå°ï¼é²æ­¢çå·</li>
<li>å·¥ç¨ææ¬ä½ï¼ä¸æ¹è¡¨ãä¸è¿æ°æ®</li>
</ul>
<p><strong>å¸¸è§ä½ä¸å¤ä¼éçè§£å³æ¹æ¡</strong></p>
<ul>
<li>UUID
<ul>
<li>å­ç¬¦ä¸²è¿é¿</li>
<li>URLãäºç»´ç ä¸åå¥½</li>
<li>è°è¯ä½éªå·®</li>
</ul>
</li>
<li>Snowflake / Base64
<ul>
<li>ä»ç¶å¯è½æ´é²æ¶é´ä¿¡æ¯</li>
<li>ååç«¯å®ç°ä¸ç»ä¸</li>
</ul>
</li>
<li>AES / RSA å å¯ ID
<ul>
<li>æ§è½ä¸å¤æåº¦ææ¬é«</li>
<li>å¯¹âåªæ¯éè IDâæ¥è¯´å±äºè¿åº¦è®¾è®¡</li>
</ul>
</li>
</ul>
<p><span style="color: rgba(16, 63, 250, 1)"><strong>è¿ä¸ªè§£å³æ¹æ¡å°±æ¯Hashidsã</strong></span></p>
<p><strong>Hashidsçæ ¸å¿åè½ï¼æä¸ä¸ªæå¤ä¸ªæ´æ°ï¼int / longï¼è½¬æ¢æä¸ä¸ªä¸å¯é¢æµãå¯éçç­å­ç¬¦ä¸²ã</strong></p>
<p><strong>åºæ¬å±æ§</strong></p>
<ul>
<li>è¾å¥æ¯æ´æ°ï¼æ¯ælongåï¼ï¼è¾åºæ¯å­ç¬¦ä¸²ï¼åªåå«ï¼a-z A-Z 0-9ï¼æ å¶ä»ç¹æ®å­ç¬¦ï¼</li>
<li>å¯ä»¥èªå®ä¹ç¼ç å­ç¬¦</li>
<li><strong>å¯é</strong>ï¼ä½ä¸å¯ç</li>
<li>æ¯æå¤ä¸ªIDç¼ç ä¸ºä¸ä¸ªå­ç¬¦ä¸²</li>
<li>å¯æ§å¶æå°é¿åº¦ï¼ä¸æ¯æâæé¿é¿åº¦âéå¶ï¼å®éé¿åº¦æ¯ä¸åºå®çï¼éè¾å¥æ°å­å¤§å°åå</li>
</ul>
<p data-start="223" data-end="228"><strong>å¸åç¨éï¼</strong></p>
<ul data-start="230" data-end="329">
<li data-start="230" data-end="252">
<p data-start="232" data-end="252">æ°æ®åºèªå¢ ID ï¼å¯¹å¤å±ç¤ºç¨å­ç¬¦ä¸²ï¼é²æ­¢ ID æä¸¾</p>
</li>
<li data-start="295" data-end="312">
<p data-start="297" data-end="312">ç­é¾æ¥ / éè¯·ç  / åæ¢ç </p>
</li>
<li data-start="295" data-end="312">
<p data-start="297" data-end="312">URL / å°ç¨åºåæ°æ´åå¥½</p>
</li>
<li>å°å¤ä¸ªæ°å­ï¼æ°ç»ï¼è¿è¡æ··æ·ï¼é²æ­¢åæ°è¢«ç¯¡æ¹</li>
</ul>
<p><strong>æ³¨æï¼</strong>å®æ¯âæ··æ·ï¼obfuscationï¼âï¼ä¸æ¯âå å¯ï¼encryptionï¼âï¼ä¸è½ä½ä¸ºå¯ç å­¦ç±»çåºæ¯ä½¿ç¨ã</p>
<h1><strong>Hashidsåé¨åç</strong></h1>
<p>ç¼ç ï¼encdoeï¼æµç¨ï¼</p>
<blockquote>
<p>åå§æ°å­ --&gt; æä¹±å­ç¬¦è¡¨ï¼ä¾èµ saltï¼ --&gt; éå guard / separator --&gt; è¿å¶è½¬æ¢ï¼base-Nï¼ --&gt; æè§åæ¼æ¥ --&gt; è¾åºå­ç¬¦ä¸²</p>
</blockquote>
<p><strong>æ ¸å¿ç»æåç´ </strong></p>
<ul>
<li>æ ¸å¿ç»æåç´ 
<ul>
<li>å­ç¬¦è¡¨ï¼alphabetï¼ï¼æå®é£äºå­ç¬¦æ¯è¾åºçç»æé</li>
<li>é»è®¤å­ç¬¦éï¼abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890</li>
<li>ä½ ä¹å¯ä»¥èªå®ä¹ï¼ä¾å¦åªç¨å¤§å°å + æ°å­ï¼æé¤ 0/O/I/lï¼ï¼æ³¨æå­ç¬¦ä¸è½éå¤ã</li>
<li>å­ç¬¦éé¿åº¦ = è¿å¶ base N</li>
</ul>
</li>
<li>salt
<ul>
<li>å³å®å­ç¬¦è¡¨å¦ä½è¢«æ´ç</li>
<li>åä¸ä¸ª IDï¼å¨ä¸å salt ä¸ï¼ç»æå®å¨ä¸å</li>
<li>ä¸ä¿å­ saltï¼å°±æ æ³åè§£</li>
</ul>
</li>
<li>separators &amp; guards
<ul>
<li>Hashids ä¼ä» alphabet ä¸­ååºä¸¤ç±»ç¹æ®å­ç¬¦ï¼separatorsï¼åéå¤ä¸ªæ°å­ãguardsï¼æ§å¶æå°é¿åº¦ãå¢å¼ºä¸å¯é¢æµæ§ã</li>
<li>è¿ä¸æ­¥ä¸»è¦æ¯ä¸ºäºï¼é¿åè¾åºæ¨¡å¼è¿äºè§åï¼åæ¶æ¯æç¼ç å¤ä¸ªæ°å­çåºæ¯ï¼encode(1,2,3)ï¼</li>
</ul>
</li>
</ul>
<p><strong>æä¹å®ç°å¯éæ§çï¼</strong></p>
<ul>
<li>å­ç¬¦è¡¨æ´çï¼consistent shuffleï¼</li>
<li>å¨ç¸å alphabet + saltä¸ï¼ç¼ç åä¸IDï¼ç»ææ°¸è¿ç¸å</li>
</ul>
<details>
<summary>æ¥çä»£ç </summary>
<pre class="language-python highlighter-hljs"><code>for i from alphabet.length-1 downTo 1:
    j = (salt_char_code + i + previous) % i
    swap(alphabet[i], alphabet[j])</code></pre>
</details>
<p><strong>æä¹è½¬æ¢ä¸ºå­ç¬¦ä¸²çï¼</strong></p>
<ul>
<li>åè®¾å­ç¬¦è¡¨ï¼alphabetï¼çé¿åº¦ä¸º62</li>
<li>æ°å­åæ¨¡62ï¼å¾å°çä½æ°ä½ä¸ºä¸æ ä»å­ç¬¦è¡¨ä¸­åå¾ä¸ä¸ªå­ç¬¦</li>
<li>åé¤62ï¼ç´å°æ°å­å°äº0æ¶åæ­¢</li>
<li>å¾å°ä¸ä¸ªå­ç¬¦ä¸²</li>
</ul>
<p><strong>å¦ä½æ¯æåæ¶ç¼ç å¤ä¸ªæ°å­ï¼</strong></p>
<p>ä¾å¦ï¼encode(1, 2, 3)</p>
<blockquote>
<p>1 â abc<br>2 â k9<br>3 â z</p>
</blockquote>
<p>ä¸­é´ç¨ separatorï¼ä¹æ¯æ¥èª alphabetï¼ä½ç»è¿ä¸é¨ç­éï¼éå¼ï¼æç»è¾åºï¼abcXk9Yz</p>
<p><strong>æä¹ä¿è¯æå°é¿åº¦ï¼</strong></p>
<ul data-start="2211" data-end="2251">
<li data-start="2211" data-end="2224">
<p data-start="2213" data-end="2224">å¨å¤´å°¾æå¥ guard</p>
</li>
<li data-start="2225" data-end="2240">
<p data-start="2227" data-end="2240">åæ¬¡æ´ç alphabet</p>
</li>
<li data-start="2241" data-end="2251">
<p data-start="2243" data-end="2251">éå¤ç´å°æ»¡è¶³é¿åº¦ï¼è¿ä¸æ­¥æ¯ä¼ªéæºå¡«åï¼ä¸å½±å decodeã</p>
</li>
</ul>
<p><strong>decodeçå·¥ä½æµç¨ï¼</strong></p>
<ul>
<li data-start="2340" data-end="2352">
<p data-start="2343" data-end="2352">å»æ guards</p>
</li>
<li data-start="2353" data-end="2371">
<p data-start="2356" data-end="2371">ç¨ separators åå</p>
</li>
<li data-start="2372" data-end="2389">
<p data-start="2375" data-end="2389">å¤å alphabet æ´ç</p>
</li>
<li data-start="2390" data-end="2411">
<p data-start="2393" data-end="2411">æ¯ä¸æ®µå base-N â long</p>
</li>
</ul>
<p><strong>decodeå¤±è´¥æä¹å¤çï¼</strong></p>
<ul>
<li>salt ä¸ä¸è´ â decode å¤±è´¥æå¾å°éè¯¯å¼</li>
<li>alphabet ä¸ä¸è´ â decode å¤±è´¥</li>
</ul>
<h1>ä»£ç å®ç°</h1>
<p>ç»äºå°äºæ¿å¨äººå¿çä»£ç å®ç°ç¯èï¼æ¸èµ·è¢å­ï¼æ²é®çã</p>
<p>å¨pomä¸­å¯¼å¥ä¾èµ</p>
<pre class="language-xml highlighter-hljs"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.hashids&lt;/groupId&gt;
    &lt;artifactId&gt;hashids&lt;/artifactId&gt;
    &lt;version&gt;1.0.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
<h2>ç®åç¨æ³</h2>
<pre class="language-java highlighter-hljs"><code>import org.hashids.Hashids;
import org.springframework.stereotype.Service;

import java.util.Arrays;

@Service
public class HashidsService {

    //Beanåä¾ï¼ä¸å­å¨çº¿ç¨å®å¨é®é¢
    private final Hashids hashids = new Hashids();

    public String encode(int code) {
        return hashids.encode(code);
    }

    public String encode(long code) {
        return hashids.encode(code);
    }

    public long decode(String decoded) {
        long[] decodes = hashids.decode(decoded);
        if (decodes.length == 0) {
            throw new IllegalArgumentException("éæ³ID");
        }
        return decodes[0];
    }

    public String encodeArr(int[] codes) {
        long[] codeArr = Arrays.stream(codes).asLongStream().toArray();
        return hashids.encode(codeArr);
    }

    public String encodeArr(long[] codes) {
        return hashids.encode(codes);
    }

    public long[] decodeArr(String decoded) {
        long[] decodes = hashids.decode(decoded);
        if (decodes.length == 0) {
            throw new IllegalArgumentException("éæ³ID");
        }
        return decodes;
    }

}</code></pre>
<h2>å ç</h2>
<div>
<p><strong>å çæ··æ·</strong></p>
</div>
<ul>
<li>é²æ­¢å«äººç¨åæ ·åºè§£ä½  ID</li>
<li>salt ä¸æ¦ä¸çº¿ ç»å¯¹ä¸è½æ¹</li>
</ul>
<pre class="language-yaml highlighter-hljs"><code># application.yml
hashids:
  salt: kjsdfiaosudkskldjfa #æ··æ·ç¨çç
  min-length: 8 #æå°é¿åº¦</code></pre>
<details>
<summary>æ¥çä»£ç </summary>
<pre class="language-java highlighter-hljs"><code>package com.ks.demo.uc.hashids;

import org.hashids.Hashids;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;

import javax.annotation.PostConstruct;
import java.util.Arrays;

/**
 * å çæ··æ·
 *
 * saltçä½ç¨
 * é²æ­¢å«äººç¨åæ ·åºè§£ä½  ID
 * salt ä¸æ¦ä¸çº¿ ç»å¯¹ä¸è½æ¹
 */
@Service
public class HashidsSaltService {
    @Value("${hashids.salt}")
    private String salt;
    @Value("${hashids.min-length}")
    private int minLength;

    //newå¨@Valueæ³¨å¥ä¹å
    //è§£å³æ¹æ¡ï¼åæé å¨ï¼å¨æé å¨çå¥åä½¿ç¨@Valueï¼ä½¿ç¨@ConfigurationPropertiesåç¬æ³¨å¥
    //private Hashids hashidsSalt = new Hashids(salt);

    private Hashids hashidsSalt = null;
    private Hashids hashidsMinLen = null;

    @PostConstruct
    public void init() {
        hashidsSalt = new Hashids(salt);
        hashidsMinLen = new Hashids(salt, minLength);
    }

    public String encode(int code) {
        return hashidsSalt.encode(code);
    }
    public String encode(long code) {
        return hashidsSalt.encode(code);
    }
    public long decode(String decoded) {
        long[] decodes = hashidsSalt.decode(decoded);
        if (decodes.length == 0) {
            throw new IllegalArgumentException("éæ³ID");
        }
        return decodes[0];
    }

    public String encodeArr(int[] codes) {
        long[] codeArr = Arrays.stream(codes).asLongStream().toArray();
        return hashidsSalt.encode(codeArr);
    }
    public String encodeArr(long[] codes) {
        return hashidsSalt.encode(codes);
    }
    public long[] decodeArr(String decoded) {
        long[] decodes = hashidsSalt.decode(decoded);
        if (decodes.length == 0) {
            throw new IllegalArgumentException("éæ³ID");
        }
        return decodes;
    }

    public String encodeMinLen(int code) {
        return hashidsMinLen.encode(code);
    }
    public String encodeMinLen(long code) {
        return hashidsMinLen.encode(code);
    }
    public long decodeMinLen(String decoded) {
        long[] decodes = hashidsMinLen.decode(decoded);
        if (decodes.length == 0) {
            throw new IllegalArgumentException("éæ³ID");
        }
        return decodes[0];
    }

    public String encodeMinLenArr(int[] codes) {
        long[] codeArr = Arrays.stream(codes).asLongStream().toArray();
        return hashidsMinLen.encode(codeArr);
    }
    public String encodeMinLenArr(long[] codes) {
        return hashidsMinLen.encode(codes);
    }
    public long[] decodeMinLenArr(String decoded) {
        long[] decodes = hashidsMinLen.decode(decoded);
        if (decodes.length == 0) {
            throw new IllegalArgumentException("éæ³ID");
        }
        return decodes;
    }
}</code></pre>
</details>
<div>
<h2>èªå®ä¹åä¸ç¼ç çå­ç¬¦</h2>
</div>
<p><strong>å­ç¬¦éè§åï¼</strong></p>
<ul>
<li>è³å° 16 ä¸ªå­ç¬¦</li>
<li>ä¸åè®¸éå¤å­ç¬¦</li>
</ul>
<pre class="language-yaml highlighter-hljs"><code># application.yml
hashids:
  salt: kjsdfiaosudkskldjfa #æ··æ·ç¨çç
  min-length: 8 #æå°é¿åº¦
  #è³å° 16 ä¸ªå­ç¬¦ï¼ä¸åè®¸éå¤å­ç¬¦
  #åä¸ç¼ç çå­ç¬¦ï¼å¯ä»¥åé¤è°0/O/o,1/I/lç­å­ç¬¦ï¼å¢å¼ºå¯è¯»æ§
  base-char: 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz</code></pre>
<details>
<summary>æ¥çä»£ç </summary>
<pre class="language-java highlighter-hljs"><code>package com.ks.demo.uc.hashids;

import org.hashids.Hashids;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;

import javax.annotation.PostConstruct;
import java.util.Arrays;

/**
 * èªå®ä¹åä¸ç¼ç çå­ç¬¦
 *
 * å­ç¬¦éè§åï¼
 * è³å° 16 ä¸ªå­ç¬¦
 * ä¸åè®¸éå¤å­ç¬¦
 *
 * ä½¿ç¨åºæ¯
 * é¿å 0/Oãl/1 æ··æ·
 * åªåè®¸å¤§åå­æ¯
 *
 */
@Service
public class HashidsBaseCharService {
    @Value("${hashids.salt}")
    private String salt;
    @Value("${hashids.min-length}")
    private int minLength;
    @Value("${hashids.base-char}")
    private String baseChar;

    private Hashids hashids = null;

    @PostConstruct
    public void init() {
        hashids = new Hashids(salt, minLength, baseChar);
    }

    public String encode(int code) {
        return hashids.encode(code);
    }
    public String encode(long code) {
        return hashids.encode(code);
    }
    public long decode(String decoded) {
        long[] decodes = hashids.decode(decoded);
        if (decodes.length == 0) {
            throw new IllegalArgumentException("éæ³ID");
        }
        return decodes[0];
    }

    public String encodeArr(int[] codes) {
        long[] codeArr = Arrays.stream(codes).asLongStream().toArray();
        return hashids.encode(codeArr);
    }
    public String encodeArr(long[] codes) {
        return hashids.encode(codes);
    }
    public long[] decodeArr(String decoded) {
        long[] decodes = hashids.decode(decoded);
        if (decodes.length == 0) {
            throw new IllegalArgumentException("éæ³ID");
        }
        return decodes;
    }

}</code></pre>
</details>
<h1>ç»å°¾</h1>
<p>å¨æç« æåï¼å°è¯å¯¹èªå·±æé®ä¸ä¸é®é¢ï¼æ¥æ£éªä½ æ¯å¦çæ­£äºè§£å°äºæ¬æçæ ¸å¿åå®¹ã</p>
<ol>
<li>C ç«¯èªå¢ ID æ´é²ä¼æé£äºé®é¢ï¼</li>
<li>hashidsçæ ¸å¿ç¹æ§ï¼ä¸ºä»ä¹å¯ä»¥ä½ä¸ºæ··æ·èªå¢idçè§£å³æ¹æ¡ï¼</li>
<li>hashidsçåè½æé£äºï¼</li>
<li>ä»£ç æä¹åï¼</li>
</ol>
<p>æ¬æç»æã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 21:08">2026-02-04 21:08</span>&nbsp;
<a href="https://www.cnblogs.com/hackyle">ALGOé¿ç</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19576480);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19576480', targetLink: 'https://www.cnblogs.com/hackyle/p/19576480', title: 'ç¨ Hashids ä¼éè§£å³ C ç«¯èªå¢ ID æ´é²é®é¢' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ [å¤§æ¨¡åå®æ 03é¢å¤] äºç«¯ç¼ä¸¹æ¿ 2ï¼Kaggle ä¸ææå ]]></title>
    <link>https://www.cnblogs.com/algieba/p/19576331</link>
    <guid>0183d382db088ace3e48d3c01bc18286</guid>
    <description>
    <![CDATA[ 
		<div class="postcontent">
			    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260204195327324-384345256.png" alt="[å¤§æ¨¡åå®æ 03é¢å¤] äºç«¯ç¼ä¸¹æ¿ 2ï¼Kaggle ä¸ææå" class="desc_img">
        Colab é¢åº¦ç¨å®äºï¼Kaggle å¸¦çä¸¤å¼  T4 æ¾å¡æ¥äºï¼æ¬æè¯¦è§£ Kaggle è´¦å·ææºéªè¯ãå¼å¯ Internet èç½ãéç½®å T4 GPU ç¯å¢ï¼ä»¥åå¦ä½å©ç¨ Kaggle ç¹æç Dataset æºå¶æä¹åä¿å­ HuggingFace æ¨¡åã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="å¤§æ¨¡åå®æ-03é¢å¤-äºç«¯ç¼ä¸¹æ¿-2kaggle-ä¸ææå">[å¤§æ¨¡åå®æ 03é¢å¤] äºç«¯ç¼ä¸¹æ¿ 2ï¼Kaggle ä¸ææå</h1>
<blockquote>
<p><strong>æ ¸å¿æè¦ (TL;DR)</strong></p>
<ul>
<li><strong>çç¹</strong>ï¼Colab åè´¹é¢åº¦èå°½ï¼æèåå¼  T4 æ¾å­ï¼16GBï¼æ æ³æ»¡è¶³æ´å¤§åæ°æ¨¡åçå¾®è°éæ±ã</li>
<li><strong>æ¹æ¡</strong>ï¼å©ç¨ <strong>Kaggle</strong> æä¾ç <strong>æ¯å¨ 30 å°æ¶åè´¹åè·¯ T4 GPU (T4 x2)</strong> ç®åã</li>
<li><strong>æå·§</strong>ï¼éè¿ <strong>ææºå·éªè¯</strong> è§£éèç½æéï¼å©ç¨ <strong>Kaggle Datasets</strong> å®ç°æ¨¡åçæä¹åå­å¨ã</li>
<li><strong>ç®æ </strong>ï¼ä½ä¸º Colab çå¼ºåæ¿è¡¥ï¼çè³ä¸ä½ï¼ï¼æ­å»ºå¤ç¨äºç«¯ç¼ä¸¹ç¯å¢ã</li>
</ul>
</blockquote>
<h2 id="åè¨">åè¨</h2>
<p>ä¸ä¸ç¯ä¸­ï¼æ¬æ¥æ³ç´æ¥åå°Google Colabçå¤§æ¨¡åæ¨çèæ¬ï¼è®©åä½åäººä»¬æåä¸ä¸å¨å¨åæ°7Bæ¨¡åçè½åï¼ä½æ¯æè¾äºå¾ä¹ï¼Colabè¯»driverèæ¯å¤±è´¥ï¼å½ææ³ç´æ¥ä¸è½½å°äºç«¯ä¸»æºèä¸æ¯driverçæ¶åï¼GPUçé¢åº¦å·²ç»èå°½ãç´¢æ§ä»å¤©å¨Kaggleçè¿ç¯åæä¸­æ¥è®²ï¼åºè¯¥ä¹åä¹ä¸»è¦ç¨Kaggleæ¥è¿è¡äºç«¯å¼åï¼æ¯ç«Colabé¢åº¦å°ï¼è¿å¾ç¯çï¼é¿æ¶é´ä¸çä¼æ­æè¿æ¥ã</p>
<p>å¥½ï¼æä»¬æ¥åä»ç»ä¸ä¸ä»å¤©çä¸»è§ï¼Google æä¸çå¦ä¸ä¸ªç¥å¨ï¼<a href="https://www.kaggle.com/" target="_blank" rel="noopener nofollow"><strong>Kaggle</strong></a>ãColabå¦æè¯´å¶æ¬èå°±æ¯æ¨¡åè®­ç»ï¼é£<strong>Kaggle</strong>æ¬èº«å¶å®æ¯ä¸ä¸ªæ°æ®ç§å­¦çç«èµå¹³å°ï¼æ¯ç«æ¯æ°æ®ç§å­¦ç«èµåï¼é£èªç¶å¾éè¦ç®åèµæºï¼<strong>Kaggle</strong>ä¸ºäºæ¹ä¾¿ï¼ä¹åæ¥äºè°·æ­å¤§åäººçä¼è¯åè´¨ï¼åè´¹æä¾äºå¤§æ¹çè®¡ç®èµæºãè·Colabå¯¹æ¯èµ·æ¥ï¼Kaggleçä¼å¿å°±æ¯ï¼æ´ç¨³å®ï¼æ´æ¹ä¾¿ï¼èµæºç»çé¢åº¦æ´å¤ã</p>
<h2 id="1-kaggle-notebooks-æ ¸å¿æ¦å¿µ">1. Kaggle Notebooks æ ¸å¿æ¦å¿µ</h2>
<p>Kaggle çæ ¸å¿ç¼ç¨ç¯å¢å« <strong>Kernels (ç°å¨ç»ç§° Notebooks)</strong>,ä¸ç¨å®³æï¼è¯¶ï¼å®å°±æ¯æä»¬æ¨å¿åè®¤è¯ççäºº<strong>äºç«¯æå¡å¨ç</strong>ç<strong>Jupyter Notebook</strong>,ä½æ¯åColabä¸å¤ªç¸åçæ¯Kaggleçæä»¶ç»æï¼å®ææ¾å¾åºåäºè¾å¥åºåï¼è¾åºåºåï¼æå­åºå, è¿æ¯ä¹æä»¬åä¸æå®¹ææµçå°æ¹:</p>
<ul>
<li><strong>Input (<code>/kaggle/input</code>)</strong>ï¼<strong>åªè¯»åºå</strong>ãè¿éå­æ¾ä½ ä¸ä¼ çæ°æ®éææè½½çæ¨¡åãè¯»åéåº¦æå¿«ï¼ä½æ æ³åå¥ã</li>
<li><strong>Output (<code>/kaggle/working</code>)</strong>ï¼<strong>å¯è¯»ååºå</strong>ãè¿æ¯ä½ çä¸»å·¥ä½åºï¼ä»£ç è¿è¡ç»æãä¸è½½çæ¨¡åå¿é¡»å­å¨è¿éãä½æ³¨æï¼éå¯ Session åï¼è¿éçåå®¹å¦æä¸ä¿å­ä¸º Dataset ä¹ä¼æ¶å¤±ã</li>
<li><strong>Temp (<code>/kaggle/temp</code>)</strong>ï¼<strong>ä¸´æ¶æå­åº</strong>ãç©ºé´è¾å¤§ï¼åªæå½åä¼è¯ææï¼ï¼éåä¸è½½è§£åä¸´æ¶çå¤§æä»¶ã</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/kaggle_input_working_temp.png" alt="Kaggle notebook æä»¶ç³»ç»ç»æå¾ï¼å±ç¤º input/working/temp çåºå«çæªå¾" loading="lazy"></p>
<h2 id="2-å¿«éä¸ææ³¨åä¸è§£é">2. å¿«éä¸æï¼æ³¨åä¸âè§£éâ</h2>
<h3 id="21-æ³¨åä¸å³é®éªè¯-å¿å">2.1 æ³¨åä¸å³é®éªè¯ (å¿å)</h3>
<p>æä»¬æ°ç¨æ·ç»å½åå»ºnotebookåä¼åç°ï¼æä»¬æ²¡æç¡¬ä»¶å éè®¾å¤å¯éã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/no_gpu.png" alt="æ°ç¨æ·çacceleratoré¨åæ¯ç°è²çæªå¾" loading="lazy"><br>
æ ¹æ¬åå å°±æ¯å±ä»¬æ²¡æè¿è¡ææºéªè¯ï¼åååï¼å¯ä»¥çè§£ï¼æ¯ç«æ¬èº«kaggleå°±ä¸ç¨ç»å¡ï¼å ä¸ææºéªè¯å¯è½ä¼æç»æä¸å¤§é¨åè®¡ç®èµæºæ»¥ç¨ã</p>
<ol>
<li>è®¿é® <a href="https://www.kaggle.com/" target="_blank" rel="noopener nofollow">Kaggle å®ç½</a> å¹¶æ³¨åè´¦å·ã</li>
<li><strong>å³é®æ­¥éª¤</strong>ï¼ç¹å»å³ä¸è§å¤´å -&gt; <strong>Settings</strong>ã</li>
<li>æ¾å° <strong>Phone Verification</strong>ï¼ææºéªè¯ï¼ã<strong>å¿é¡»å®æè¿ä¸æ­¥</strong>ï¼å¦åæ æ³å¼å¯ GPU å Internetï¼èç½ï¼åè½ã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/phone_verification.png" alt="Kaggle è´¦æ·è®¾ç½®é¡µé¢çæªå¾ï¼é«äº® Phone Verification åºå" loading="lazy"></li>
</ol>
<p>è®¤è¯å®æ¯å°±å¯ä»¥ä½¿ç¨GPUèµæºäº<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/gpu_access.png" alt="å½è®¤è¯äºææºå·ä¹åæ¾ç¤ºacceleratorä¸­æå¯ç¨çGPUèµæºçæªå¾" loading="lazy"><br>
å¦æç»§ç»­åäº<strong>Identity verification</strong>ä¹åï¼å¯ä»¥ä½¿ç¨TPUèµæºï¼ä¸è¿æä»¬ææ¶ç¨ä¸å°ï¼ç®åçGPUèµæºå·²ç»å¤å±ä»¬å¤§ç©ä¸åºäºã</p>
<h3 id="22-åå»ºç¬è®°æ¬">2.2 åå»ºç¬è®°æ¬</h3>
<ol>
<li>ç¹å»å·¦ä¾§èåæ ç <strong>Create</strong> -&gt; <strong>New Notebook</strong>ã</li>
<li>è¿å¥ç¼è¾å¨çé¢ï¼ä½ ä¼åç°çé¢å¸å±æ¯ Colab æ´å ç´§åä¸åè½ååºæç¡®ã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/the_whole_UI.png" alt="kaggleçç¼è¾å¨é¡µé¢å¸å±çæªå¾" loading="lazy"></li>
</ol>
<h3 id="23-çé¢å¸å±éè§">2.3 çé¢å¸å±éè§</h3>
<ul>
<li><strong>å·¥ä½åº</strong>ï¼ä½äºå³ä¾§ï¼æ¾ç¤ºäºInput-&gt;æä»¬çæè½½èµæºï¼ä¸ä¼ çæ°æ®éåæ¨¡åç­ç­ï¼Output-&gt;æä»¬è¾åºçç»æèµæºãnotebookåå®¹éè§,ä»¥åä¸é¢çsession optionsç¯å¢å¿«æ·éç½®ç­ç­<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/workspace.png" alt="ç¼è¾å¨å³ä¾§çå·¥ä½åºï¼åå«Inputåºåoutputåºçæªå¾" loading="lazy"><br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/session_options.png" alt="ç¼è¾å¨å³ä¾§å·¥ä½åºå©ä½é¨åï¼æ¥ç­session optionsçæªå¾" loading="lazy"></li>
<li><strong>å¿«æ·æä½æ </strong>ï¼ å¨ä»£ç åºä¸æ¹ï¼åColabå·®å«ä¸å¤§ï¼å¯ä»¥å¿«éè¿è¡ï¼æå¥ååæ ¼ï¼å¤å¶ç²è´´ç­ç­<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/quick_action.png" alt="å¨ç¼è¾å¨ä¸æ¹çå¿«æ·æä½æ çæªå¾" loading="lazy"></li>
<li><strong>ä»£ç åº</strong>ï¼åColabä¸æ ·, æ åç Jupyter ååæ ¼ã</li>
</ul>
<p>æ³¨æï¼</p>
<ol>
<li>åColabä¸ä¸æ ·çæ¯ï¼Kaggleçæä»¶åæ²¡æåç¼ï¼ä¸ç¨å ipynbåç¼</li>
<li>å±ä»¬çç¡¬ä»¶å éï¼GPU/TPUè®¡ç®èµæºï¼è¢«æ¾å°äºé¡¶é¨èåæ ç<strong>Settings</strong>ä¸­ç<strong>accelerator</strong>ä¸­äº</li>
<li>åColabä¸åï¼å ä¸ºKaggleæ¯ä¸ºç«èµæå¡ï¼å¾å¤ç«èµæ¯è¦æ±æ¨¡åä¸èç½çï¼æä»¥æä»¬å¨è®­ç»æ¨¡åçæ¶åï¼éè¦æå¨å¼å¯ç½ç»ï¼ä¹å¨é¡¶é¨èåæ ç<strong>Settings</strong>ä¸­ï¼ç¹å»<strong>Turn On Internet</strong>æå¼å³å¯èç½ä¸è½½æ¨¡åæèæ°æ®éã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/settings.png" alt="Kaggle NotebookçSettingsä¸æèåï¼åå«ç¡¬ä»¶å éè®¾å¤åå¼å¯èç½éé¡¹çæªå¾" loading="lazy"></li>
<li>å¯é¥ç®¡çè¢«æ¾å°äºé¡¶é¨èåæ ç<strong>Add-ons</strong>ä¸äº<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/add-on.png" alt="Kaggle NotebookçAdd-onä¸æ¥èåï¼åå«å¯é¥ç®¡çéé¡¹çæªå¾" loading="lazy"></li>
</ol>
<h2 id="3-ç¯å¢éç½®å¼å¯åæ¾å¡ä¸èç½">3. ç¯å¢éç½®ï¼å¼å¯åæ¾å¡ä¸èç½</h2>
<p>Kaggle é»è®¤ç¯å¢æ¯ <strong>CPU</strong> ä¸ <strong>æ­ç½</strong> çãæä»¬éè¦æå¨âè§£é¤å°å°âã</p>
<h3 id="31-å¼å¯èç½-internet-on">3.1 å¼å¯èç½ (Internet On)</h3>
<p>å¯ä»¥æç§åæè¯´çå¨é¡¶é¨èåæ æå¼ï¼ä¹å¯ä»¥å¨å³ä¾§è¾¹æ ç <strong>Session Options</strong> ä¸­ï¼æ¾å° <strong>Internet</strong> éé¡¹ãå°å¼å³æ¨å° <strong>On</strong>ã<br>
<em>æ³¨æï¼å¦ææ²¡æææºéªè¯ï¼æ­¤éé¡¹ä¸ºç°è²ä¸å¯ç¨ã</em></p>
<h3 id="32-å¼å¯-gpu-å é-t4-x2">3.2 å¼å¯ GPU å é (T4 x2)</h3>
<ol>
<li>
<p>å¨å³ä¾§è¾¹æ æ¾å° <strong>Accelerator</strong>ã</p>
</li>
<li>
<p>ä¸æéæ© <strong>GPU T4 x2</strong>ã</p>
<ul>
<li><strong>GPU T4 x2</strong>ï¼ä¸¤å¼ æ¾å¡ï¼çº¦ 30GB æ¾å­ï¼éåå¤§æ¨¡åæ¨çåå¾®è°ã</li>
<li><strong>GPU P100</strong>ï¼åå¼ æ§æ¶æå¡ï¼è½ç¶éåº¦å¿«ä½æ¾å­ä» 16GBï¼éå¸¸ä¸æ¨èã</li>
</ul>
</li>
<li>
<p>å¼å¯åï¼é¡¶é¨ä¼æ¾ç¤º <strong>Session Storage</strong> å <strong>GPU Quota</strong>ï¼æ¯å¨ 30 å°æ¶é¢åº¦ï¼éå¸¸å¨å­å·æ°ï¼ã<br>
ç¹å»èªå·±çå¤´åï¼å¯ä»¥çè§èªå·±çé¢åº¦<strong>GPU Quata</strong><br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/GPU_Quata.png" alt="ç¹å»èªå·±çå¤´åï¼å¯ä»¥çè§èªå·±çé¢åº¦çæªå¾" loading="lazy"></p>
</li>
</ol>
<h3 id="33-éªè¯åå¡ç¯å¢">3.3 éªè¯åå¡ç¯å¢</h3>
<p>è¾å¥å¹¶è¿è¡ä»¥ä¸ä»£ç ï¼ç¡®è®¤æä»¬æ¯å¦ççæ¥æäºä¸¤å¼ æ¾å¡ï¼</p>
<pre><code class="language-python">!nvidia-smi
</code></pre>
<p>ä½ åºå½è½çå° <strong>ä¸¤å¼ </strong> Tesla T4 æ¾å¡çåè¡¨ (GPU 0 å GPU 1)ã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/nvidia-smi.png" alt="nvidia-smiçè¿è¡ç»æï¼æ¾ç¤ºä¸¤å¼ Tesla T4å¡" loading="lazy"></p>
<h2 id="4-å®æä¸è½½å¹¶è¿è¡å¤§æ¨¡å">4. å®æï¼ä¸è½½å¹¶è¿è¡å¤§æ¨¡å</h2>
<p>å¨ Kaggle ä¸ä½¿ç¨æ¨¡åä¸»è¦æä¸¤ç§âæµæ´¾âï¼<strong>ä»£ç ä¸è½½æ´¾</strong> å <strong>åçæè½½æ´¾</strong>ã</p>
<h3 id="æ¹å¼ä¸å©ç¨-huggingface-cli-ä¸è½½-å·¥ç¨åæ¨è">æ¹å¼ä¸ï¼å©ç¨ HuggingFace CLI ä¸è½½ (å·¥ç¨åæ¨è)</h3>
<p>è¿ç§æ¹å¼æçµæ´»ï¼éåéè¦ç²¾ç¡®æ§å¶æ¨¡åçæ¬çæåµãç±äº Kaggle æ²¡æ Google Driveï¼æä»¬å°æ¨¡åä¸è½½å° <code>/kaggle/working/</code> ç®å½ã</p>
<p><strong>æ­¥éª¤ 1ï¼å®è£ä¸éç½®</strong></p>
<pre><code class="language-python"># Kaggle é¢è£åºå¾å¤ï¼ä½ transformers çæ¬å¯è½æ»åï¼å»ºè®®æ´æ°
!pip install -U transformers huggingface_hub accelerate bitsandbytes
</code></pre>
<p>ç¹å»é¡¶é¨èå <strong>Add-ons</strong> -&gt; <strong>Secrets</strong>ï¼æ·»å  <code>HF_TOKEN</code>ï¼ä½ ç HuggingFace è®¿é®ä»¤çï¼ã</p>
<p><strong>æ­¥éª¤ 2ï¼ä¸è½½èæ¬</strong></p>
<pre><code class="language-python">import os
from huggingface_hub import login, snapshot_download
from kaggle_secrets import UserSecretsClient

# 1. ç»å½ (èªå¨è¯»å Secrets)
user_secrets = UserSecretsClient()
hf_token = user_secrets.get_secret("HF_TOKEN")
login(token=hf_token)

# 2. å®ä¹ä¸è½½è·¯å¾ (æ³¨æï¼å¿é¡»å¨ /kaggle/working ä¸)
model_dir = "/kaggle/working/model_cache"
os.makedirs(model_dir, exist_ok=True)

# 3. ä¸è½½æ¨¡å
model_id = "Qwen/Qwen2.5-7B-Instruct"
print(f"å¼å§ä¸è½½ {model_id} ...")

# Kaggle å»ºè®®ä¸è½½å®æä»¶ (local_dir_use_symlinks=False)
snapshot_download(
    repo_id=model_id,
    local_dir=model_dir,
    local_dir_use_symlinks=False,
    token=hf_token
)

print("ä¸è½½å®æï¼")
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/download_model.png" alt="ä¸è½½å®æçç»ææªå¾" loading="lazy"></p>
<h3 id="æ¹å¼äºadd-input-kaggle-åçæ¹å¼">æ¹å¼äºï¼Add Input (Kaggle åçæ¹å¼)</h3>
<p>è¿æ¯ Kaggle æå¼ºå¤§çåè½ãä½ å¯ä»¥ç´æ¥å¨ç½é¡µç«¯æç´¢ç°æçæ¨¡åï¼åæè½½ U çä¸æ ·æè½½è¿æ¥ï¼<strong>ä¸æ¶èä¸è½½æµéåæ¶é´</strong>ã</p>
<ol>
<li>ç¹å»å³ä¾§è¾¹æ ç <strong>Add Input</strong>ã</li>
<li>éæ© <strong>Models</strong> æ ç­¾é¡µã</li>
<li>æç´¢ <code>Qwen2.5</code>ã</li>
<li>ç¹å» <strong>+</strong> å·æ·»å ã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/qwen_downloading.png" alt="Kaggle Add Input æç´¢æ¨¡åçå¼¹çªæªå¾" loading="lazy"></li>
<li>éæ©FRAMEWORKéæ©<strong>Transformers</strong>æ¶æ, VARIATIONéæ©<strong>7b-instruct</strong>, ä¹åçåæä¼è·åä½åäººè§£éè¿äºåæ°çå·®å«<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/qwen2_5_params.png" alt="ä¸è½½Qwen2.5æ¨¡åéè¦å¡«åçæ¶æååæ°ç¤ºææªå¾" loading="lazy"></li>
<li>æ¨¡åä¼ç´æ¥åºç°å¨ <code>/kaggle/input/</code> ç®å½ä¸ï¼åªè¯»ï¼ï¼è·¯å¾éå¸¸é¿å¾å <code>/kaggle/input/qwen2.5/transformers/7b-instruct/1</code>ã</li>
</ol>
<h2 id="5-å è½½æ¨¡åä¸åå¡æ¨ç">5. å è½½æ¨¡åä¸åå¡æ¨ç</h2>
<p>æ¥æåå¡ T4 åï¼å è½½æ¨¡åæ¶æä¸ä¸ªå³é®åæ°ï¼<code>device_map="auto"</code>ãå®ä¼èªå¨å°æ¨¡åååå°ä¸¤å¼ æ¾å¡ä¸ï¼ä»èè®©æä»¬è½è¿è¡æ´å¤§çæ¨¡åã</p>
<pre><code class="language-python">import torch
from transformers import AutoTokenizer, AutoModelForCausalLM

# è·¯å¾æ ¹æ®ä½ çä¸è½½æ¹å¼è°æ´
# æ¹å¼ä¸è·¯å¾: "/kaggle/working/model_cache"
# æ¹å¼äºè·¯å¾: "/kaggle/input/qwen2.5/transformers/7b-instruct/1/" (å·ä½å¯ä»¥è¿è¡é»è®¤åå»ºçç¬¬ä¸ä¸ªååæ ¼ï¼æ¥çinputç®å½ç»æ,å°è½çè§config.jsonçç®å½å³å¯)
model_path = "/kaggle/working/model_cache"

print("æ­£å¨å è½½æ¨¡å (åå¡æ¨¡å¼)...")

tokenizer = AutoTokenizer.from_pretrained(model_path, trust_remote_code=True)

# å³é®ï¼device_map="auto" ä¼èªå¨å©ç¨ä¸¤å¼  T4
model = AutoModelForCausalLM.from_pretrained(
    model_path,
    device_map="auto",
    torch_dtype=torch.float16,
    trust_remote_code=True
)

print(f"æ¨¡åå è½½æåï¼æ¾å­åå¸: {model.hf_device_map}")

# æµè¯å¯¹è¯
prompt = "ä½ å¥½ï¼è¯·ç¨ä¸å¥è¯å½¢å®¹ Kaggle çå T4 æ¾å¡æå¤é¦ï¼"
messages = [{"role": "user", "content": prompt}]
text = tokenizer.apply_chat_template(messages, tokenize=False, add_generation_prompt=True)
inputs = tokenizer([text], return_tensors="pt").to(model.device)

with torch.no_grad():
    generated_ids = model.generate(**inputs, max_new_tokens=200)

response = tokenizer.batch_decode(generated_ids, skip_special_tokens=True)[0]
print(f"Qwen: {response.split('assistant')[-1].strip()}")
</code></pre>
<h2 id="6-è¿é¶å¦ä½æä¹åä¿å­save-version">6. è¿é¶ï¼å¦ä½æä¹åä¿å­ï¼(Save Version)</h2>
<p>Kaggle æ²¡æ Google Driveï¼é£æä¹ä¿å­ä¸è½½å¥½çæ¨¡åæè®­ç»ç»æå¢ï¼</p>
<p><strong>ç­æ¡ï¼æ Output åæ Datasetã</strong></p>
<ol>
<li>å½ä½ çä»£ç è¿è¡å®æ¯ï¼æ¨¡åä¿å­å¨ <code>/kaggle/working</code> åã</li>
<li>ç¹å»å³ä¸è§ç <strong>Save Version</strong> æé®ã</li>
<li>éæ© <strong>Save &amp; Run All</strong> (éæ°è·ä¸é),å¿é¡»ç­å°ä¸æ¹å¼¹åºçä¿å­ä»»å¡å®æã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/job_running_done.png" alt="ä¿å­ä»»å¡å®æçæªå¾" loading="lazy"></li>
<li>ä¿å­æååï¼ä½ å¯ä»¥å»ä¸»é¡µç<strong>Your Work</strong>ç¹å»åæçNotebook,è¿å¥<strong>Output</strong> æ ç­¾é¡µéï¼ç¹å»æå³è¾¹çOutputçä¸ä¸ªç¹ï¼ç¶åç¹å» <strong>New Dataset</strong>ã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm02-2-online-environment-kaggle/new_data.png" alt="å¨Outputæ ç­¾é¡µçNew Datasetç¤ºæå¾" loading="lazy"></li>
<li>è¿æ ·ï¼æä»¬åæçæ¨¡åå°±åæäºä¸ä¸ªå¯ä»¥å¨å¶ä» Notebook éç´æ¥ <strong>Add Input</strong> çæ°æ®éäºï¼</li>
</ol>
<p><strong>PS:é¤å¼èªè®­ç»çç¹æ®æ¨¡ååä¸äºå¨Inputæ¾ä¸å°çæ¨¡åï¼æå¥½é½ç´æ¥ä½¿ç¨Inputå¯¼å¥æ´ä¸ºå¿«æ·</strong></p>
<h2 id="7-å¸¸è§é®é¢-qa">7. å¸¸è§é®é¢ (Q&amp;A)</h2>
<p><strong>Q: Colab å Kaggle æè¯¥éè°ï¼</strong><br>
<strong>A:</strong></p>
<ul>
<li><strong>Colab</strong>: éåå¿«éå®éªãæè½½ Google Drive æ¹ä¾¿ãä½ T4 åªæä¸å¼ ï¼ä¸æè¿å°å·è¾ä¸¥ã</li>
<li><strong>Kaggle</strong>: éåéè¦å¤§æ¾å­ï¼T4 x2ï¼çä»»å¡ãç¯å¢æ´ç¨³å®ï¼ä¸æ 30 å°æ¶/å¨çæç¡®é¢åº¦ï¼ä¸ç¨æå¿ç¨å°ä¸åè¢«è¸¢ä¸çº¿ã</li>
</ul>
<p><strong>Q: ä¸ºä»ä¹æçä»£ç æ¥é <code>Internet connection is closed</code>ï¼</strong><br>
<strong>A:</strong> è¿æ¯ä¸ä¸ªç»å¸éè¯¯ãè¯·æ£æ¥å³ä¾§è¾¹æ ç <strong>Internet</strong> å¼å³æ¯å¦ä¸º Onãå¦æå¼å³æ¯ç°è²çï¼è¯·æ£æ¥æ¯å¦å®æäºè´¦å·ç <strong>ææºå·éªè¯</strong>ã</p>
<p><strong>Q: <code>/kaggle/working</code> éçæä»¶éå¯åè¿æåï¼</strong><br>
<strong>A:</strong> æ²¡æäºãKaggle ç Session ä¹æ¯ä¸´æ¶çãå¦æéè¦æä¹åï¼è¯·å¡å¿ä½¿ç¨ <strong>Save Version</strong> åè½å°å¶ä¿å­ä¸º Datasetï¼æèå¨ä»£ç æåå ä¸æ®µä¸ä¼ å° HuggingFace Hub çä»£ç ã</p>
<hr>
<p><strong>æ¬æä½èï¼</strong> Algieba<br>
<strong>æ¬æé¾æ¥ï¼</strong> <a href="https://blog.algieba12.cn/llm02-2-online-environment-kaggle/" target="_blank" rel="noopener nofollow">https://blog.algieba12.cn/llm02-2-online-environment-kaggle/</a><br>
<strong>çæå£°æï¼</strong> æ¬åå®¢æææç« é¤ç¹å«å£°æå¤ï¼åéç¨ BY-NC-SA è®¸å¯åè®®ãè½¬è½½è¯·æ³¨æåºå¤ï¼</p>
<pre><code>
</code></pre>


</div>
<div class="clear"></div>

		</div>
		<div class="itemdesc">
			åè¡¨äº 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 19:54">2026-02-04 19:53</span>&nbsp;
<a href="https://www.cnblogs.com/algieba">é¿å°çä»£ç å±</a>&nbsp;
éè¯»(<span id="post_view_count">7</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19576331);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19576331', targetLink: 'https://www.cnblogs.com/algieba/p/19576331', title: '[å¤§æ¨¡åå®æ 03é¢å¤] äºç«¯ç¼ä¸¹æ¿ 2ï¼Kaggle ä¸ææå' })">ä¸¾æ¥</a>

		</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ V8å¼æ ç²¾åæ¼«æ¸¸æå--Ignitionç¯(ä¸) æä»¤ æ å¸§ æ§½ä½ è°ç¨çº¦å® åå­å¸å± åºç¡åå®¹ ]]></title>
    <link>https://www.cnblogs.com/f20171110/p/19576264</link>
    <guid>8dae7275559ff858e0e2a36c397f609a</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/f20171110/p/19576264" title="åå¸äº 2026-02-04 19:19">
    <span role="heading" aria-level="2">V8å¼æ ç²¾åæ¼«æ¸¸æå--Ignitionç¯(ä¸) æä»¤ æ å¸§ æ§½ä½ è°ç¨çº¦å® åå­å¸å± åºç¡åå®¹</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        è¿æ¯ç¬¬äºç¯çä¸åé¨åï¼æä»¬ä¸»è¦å­¦ä¹ ignition V8çè§£éå¨çä¸äºåºç¡ååç½®ç¥è¯ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="äº-ignitionè§£éå¨ä¸">äº. Ignitionè§£éå¨(ä¸)</h1>
<p>è¿æ¯ç¬¬äºç¯çä¸åé¨åï¼æä»¬ä¸»è¦å­¦ä¹ ignition V8çè§£éå¨çä¸äºåºç¡ååç½®ç¥è¯ã</p>
<p>è¿é¨ååå®¹ï¼ä¸»è¦æ¯ä»¥äºè§£ä¸ºä¸»ï¼æä»¥å¨å­¦ä¹ çæ¶åï¼é¤äºç¬¬ä¸ç¯ä¸­è¯´ç æäºç»èåäºçç¥  æäºè¾¹çæåµåäºç®åè¡¨è¿°ä»¥å¤ï¼ä¹ä¸éè¦è¿å¤çæ·±å¥ã è¯»å®äºå°±å¥½ã ç®çå°±æ¯å¯¹äºignitionè§£éå¨çä¸ä¸ªç¥é­ã</p>
<p>å½ç¶ï¼æå´è¶£çæåä¹å¯ä»¥è®¤çéè¯»ï¼æ¬æåå®¹ä¾æ§ä¿æä¸å®çæ·±åº¦ï¼ä¾æ§æ¯åæ±é«åç¡®æ§ï¼ç¬¦åè§èï¼è´´åå®ç°ã ä½éæ³¨æçæ¯ï¼ä¸ºäºæç« çå¯è¯»æ§ï¼æå¯è½<strong>å¨åé¢</strong>ä»åç®åçéä¿çæè¿°ï¼<strong>å¨åé¢</strong>åäºè¯¦ç»çè®²è§£æè¿°ï¼æä»¥ï¼å¯è½çæåµä¸ï¼è¯·å°½ééè¯»å¨æã</p>
<p>éè¿ä¸ä¸ç¯çè§£æï¼æä»¬æéå·²ç»æ¿å°äºä¸ä»½å®æ´çASTæ½è±¡è¯­æ³æ ã ä½æ¯å¯¹äºcpuæ¥è¯´ï¼å®åªè®¤æä»¤ã</p>
<p>å¨æ©æçæ¬ç V8 ä¸­ï¼JavaScript ä»£ç å¨è§£æå®æåï¼ä¼ç´æ¥è¢«ç¼è¯ææ¬æºæºå¨ç æ§è¡ãè¿ç§æ¹å¼è¿è¡å¾å¾å¿«ï¼ä½æºå¨ç ä½ç§¯éå¸¸æ¯è¾å¤§ï¼ä¹ä¸å¤çµæ´»ã</p>
<p>å¨åæ¥ï¼ç´å°ç°å¨ï¼V8ä¸åç´æ¥çæåºå¤§å¤æçæºå¨ç ï¼èæ¯çæäºä¸ç§éå¸¸ç´§å å°å·§çä¸­é´ä»£ç ï¼å°±æ¯ å­èç  bytecodeã</p>
<p>ä½æ¯cpuä¹ä¸è®¤è¯å­èç ï¼V8ä½¿ç¨ ignition æ¨¡æäºä¸ä¸ªå¯ä»¥è¿è¡å­èç çç¯å¢ï¼ç¸å½äºä¸ä¸ªæå¶è½»éçèææºã</p>
<h2 id="1--ignitionæ¯ä»ä¹">1 . ignitionæ¯ä»ä¹</h2>
<p>Ignition æ¯ V8 å¼æéç<strong>å­èç è§£éå¨</strong>ï¼å®æ JavaScript ç AST ç¼æç´§åçå­èç ï¼ç¶åå¨èææºéè§£éæ§è¡ï¼åæ¶æ¶éåç§ä¿¡æ¯ï¼ä¾ä¼åå¨çææ´å¿«çæºå¨ç ã</p>
<p>ignitionçå·¥ä½  æä¸»è¦æ¯ä¸é¢ä¸ä¸ªï¼</p>
<p><strong>ç¿»è¯</strong>ï¼æ AST ç¿»è¯æå­èç ã</p>
<p><strong>æ§è¡</strong>ï¼å¨ä¸ä¸ªèæçå¯å­å¨æºéæ§è¡è¿äºå­èç ã</p>
<p><strong>æ¶éææ¥</strong>ï¼å¨æ§è¡è¿ç¨ä¸­ï¼å·å·è®°å½ç±»åä¿¡æ¯ï¼ä¸ºåç»­çä¼åååå¤ã</p>
<p>Ignition å¨è½¯ä»¶å±é¢æ¨¡æäºä¸å¥  <strong>ç±» CPU</strong> çå·¥ä½æ¨¡å¼ï¼<br>
å®ä¸æ¯åªç¨æ ï¼ä¹ä¸æ¯çº¯å¯å­å¨æºï¼èæ¯éç¨â<strong>èæå¯å­å¨ + ç´¯å å¨ï¼Accumulatorï¼</strong>âçæ¨¡å¼ã</p>
<p>è¿éçå¯å­å¨å¹¶ä¸æ¯ CPU éçç¡¬ä»¶å¯å­å¨ï¼èæ¯å½æ°æ å¸§éçä¸äºæ§½ä½ï¼slotsï¼ï¼åªæ¯æå®æ½è±¡æå¯å­å¨æ¥ä½¿ç¨ï¼çèµ·æ¥æ´å CPU å·¥ä½æ¹å¼ï¼ä½ææ¬éå¸¸ä½ã</p>
<p>Ignition è¿è®¾è®¡äºä¸ä¸ª<strong>è§£éå¨ç¬å çç´¯å å¨ acc</strong>ãå¤§å¤æ°è¿ç®çä¸­é´ç»æé½ä¼ä¸´æ¶å­æ¾å¨ acc éï¼è¿æ ·æä»¤åªéè¦æºå¸¦ä¸ä¸ªåæ°ï¼å°±ä¸ç¨å¨é¨ååºææçç®çå¯å­å¨ï¼å­èç å°±ä¼åå¾éå¸¸ç­å°ã</p>
<p>å½ä¸ä¸ªå½æ°å¼å§æ§è¡æ¶ï¼Ignition ä¼å¨åå­ç æ  (Stack) ä¸ååºä¸åå°çï¼ è·èµ·æ¥çæ¶åï¼æ¬è´¨ä¸å°±æ¯å¨é£åæ åå­ä¸ï¼ä¸åå°ææ°æ®ä»ä¸ä¸ªä½ç½®æ¬å°å¦ä¸ä¸ªä½ç½®ï¼è®¡ç®ï¼ç¶ååæ¬åå¦ä¸ä¸ªä½ç½®ï¼å°±æ¯è¿æ ·æ¬æ¥æ¬å»ãignitionæä½çå¹¶ä¸æ¯çæ­£çcpuåçå¯å­å¨ï¼å®æä½çæ¯åå­ä½ç½®/æ§½ä½ã</p>
<h2 id="2--å ä¸ªç®åçæä»¤">2 . å ä¸ªç®åçæä»¤</h2>
<p>ignitionå°±åä¸ä¸ªå¤å³å¹²æ´»çèå¸åï¼ä»æä¸ä¸ªéèº«è°åï¼ä»ä¸ç®¡å¹²ä»ä¹æ´»ï¼ä¸ç®¡éè¦ç¨ä»ä¹å·¥å·ï¼é½æ¯ä¼åç¨éèº«è°åéçä¸è¥¿ï¼ å¹²å®æ´»å¾å°çç»æï¼ä¹é¡ºæå¡åèªå·±çéèº«è°åéã</p>
<p><strong>èå¸åæä¸ªéèº«è°åï¼ ä¸ç®¡å¹²ä»ä¹ï¼é½ä¼åä½¿ç¨éèº«è°åã</strong></p>
<p><strong>ææ¾åç§ææçåææ¶ï¼ä¸æ ¼ä¸æ ¼çï¼ r0 ï¼r1ï¼r2.ãããç¼çå·ï¼ä¸é¢ææ»¡äºåææã</strong></p>
<p>å¥½äºï¼è¿å°±æ¯ignitionçæ¶æãå°±æ¯è¿ä¹ç®åã</p>
<p>è¿ä¸ªéèº«è°åï¼å°±æ¯èå¸åæéè¦çä¸è¥¿äºãå¸åå·æå¨é å®äºã</p>
<p>åå¦æ²¡æè¿ä¸ªéèº«åï¼æ³è±¡ä¸ä¸ï¼èæ¿ä¸è¾¾æä»¤éå¸¸å°å¦éº»ç¦ï¼</p>
<p>æ r1åææ¶ çä¸è¥¿ å r2åææ¶ çä¸è¥¿æ¿ä¸æ¥ï¼æ¼è£å¥½ï¼ç¶ååæ¾å r3åææ¶ å»</p>
<p>(ç±»ä¼¼äºæä»¤ï¼ADD r1, r2, r3)</p>
<p>â     èèå¸åæäºéèº«åï¼å°±ç®åäºï¼èæ¿åªéè¦åä¸å£°ï¼</p>
<p>âå»æ r2 åææ¶çä¸è¥¿æ¼è¿æ¥ï¼â</p>
<p>(æä»¤ï¼Add r2)</p>
<p>èæ¿å®å¨ä¸éè¦åºè¯âè·è°æ¼âï¼é»è®¤è·åéçä¸è¥¿æ¼ï¼ï¼ä¹ä¸éè¦åºè¯âæ¼å®æ¾åªâï¼é»è®¤æ¼å®è¿æ¾å¨åéï¼ã</p>
<p>è¿å°±æ¯ Ignition çæ ¸å¿èçç§ç±ãéè¿å¼ºè¡è§å®âéèº«åä¼åâï¼æ¯ä¸æ¡æä»¤é½è½çæå¥½å ä¸ªåæ°çä½ç½®ãæåä¸ä¸è¡ä»£ç è·ä¸æ¥ï¼çä¸çåå­å°±æ¯ä¸ä¸ªå¤©ææ°å­ã</p>
<p>è¿ä¸ªèå¸åç<strong>éèº«å å°±æ¯ç´¯å å¨</strong>ï¼åææ¶ å°±æ¯åå­ä½ç½®/æ§½ä½</p>
<ul>
<li>
<p><code>Lda</code> (Load Accumulator) ---Lda æ¯ä¸ªåç¼ï¼å®éä½¿ç¨æ¶ï¼åé¢å¯è·å¾å¤åæ³çæ°æ®æ¥æºï¼æ¯å¦ LdaSmi<code>ã</code>LdaConstant<code>ã</code>LdaUndefinedãLdar ç­ç­ããã</p>
<p>è¿æ¯ä½¿ç¨æé«é¢çæä»¤ï¼å ä¸ºææçæ´» é½å¾å¨éèº«åéå¹²ï¼æä»¥ç¬¬ä¸æ­¥ï¼åºæ¬ä¸é½æ¯æä¸è¥¿è£è¿åéã</p>
<ul>
<li><strong>æä»¤</strong>ï¼<code>Ldar r1</code> (Load Accumulator from Register r1)</li>
<li><strong>å¨ä½</strong>ï¼èå¸åèµ°å° r1 åææ¶ï¼æé£éçæææ¿ä¸æ¥ï¼<strong>å¡è¿éèº«åé</strong>ã</li>
<li><strong>ç¶æ</strong>ï¼æ­¤æ¶ï¼éèº«åéçä¸è¥¿ = r1 çä¸è¥¿ã</li>
<li>Ldar è¿ä¸ªæä»¤  å¾å¥½è®°å¿ï¼ldæ¯è£è½½ï¼aæ¯ç´¯å å¨ï¼ræ¯å¯å­å¨ï¼ldarå°±æ¯è£è½½ç´¯å å¨fromå¯å­å¨ï¼  <strong>æå¯å­å¨çåå®¹è£è¿ç´¯å å¨</strong>ã</li>
<li>Ldar r1  å°±æ¯æå¯å­å¨r1éçä¸è¥¿ è£è¿ç´¯å å¨ã</li>
<li>èå¸åær1çåæè£è¿éèº«åéã</li>
</ul>
</li>
<li>
<p><code>Star</code> (Store Accumulator)</p>
<p>æ´»å¹²å®äºï¼ç»ææ»ä¸è½ä¸ç´çå¨åéï¼å¾è¾åºå°æ¹å¹²ä¸ä¸ç¥¨ï¼æèæç»æå­èµ·æ¥ã</p>
<ul>
<li><strong>æä»¤</strong>ï¼<code>Star r2</code> (Store Accumulator to Register r2)</li>
<li><strong>å¨ä½</strong>ï¼èå¸åæ<strong>éèº«åé</strong>ååå å·¥å¥½çæåæåºæ¥ï¼æ¾å° r2 åææ¶ä¸å»ã</li>
<li><strong>ç¶æ</strong>ï¼æ­¤æ¶ï¼r2 åææ¶çä¸è¥¿ = éèº«åéçä¸è¥¿ã</li>
<li>star è¿ä¸ªæä»¤ï¼ä¹å¾å¥½è®°å¿ï¼stæ¯å¨å­ï¼aæ¯ç´¯å å¨ï¼ræ¯å¯å­å¨ï¼starå°±æ¯å­å¨ç´¯å å¨éçä¸è¥¿å°å¯å­å¨ã</li>
</ul>
</li>
<li>
<p><code>Add</code> / <code>Sub</code> ...</p>
<p>è¿æ¯çæ­£çå³é®æ­¥éª¤ã</p>
<ul>
<li><strong>æä»¤</strong>ï¼<code>Add r0</code></li>
<li><strong>å¨ä½</strong>ï¼èå¸åèµ°å° r0 åææ¶ï¼æ¿ä¸ªä¸è¥¿ï¼ç´æ¥è·<strong>éèº«åé</strong>åæ¬çä¸è¥¿è¿è¡åä½ï¼ç¸å ï¼ã</li>
<li><strong>ç¶æ</strong>ï¼éèº«åéçä¸è¥¿ = ååéçå¼ + r0 çå¼ã</li>
<li><strong>éç¹</strong>ï¼æ³¨æ <strong>ç»æä¾ç¶çå¨åé</strong>ï¼èå¸åå¹¶æ²¡ææ¥çå»å¨å­ç»æã</li>
</ul>
<p>æä»¤é½å¾ç®åï¼<strong>ld</strong>  <em>load</em>ï¼<strong>st</strong>  <em>store</em>ï¼<strong>a</strong>  <em>accumulator</em>ï¼<strong>r</strong>  <em>register</em></p>
<p>ç±»ä¼¼ç  ldglobal  stglobal ldarg0  ldcurrentcontext  ä¹é½å·®ä¸å¤ï¼</p>
<p>åºæ¬ä¸é½æ¯  å¨ä½+å¯¹è±¡  çæ¨¡å¼ã</p>
<p>å¦å¤éè¦æ³¨æçæ¯ï¼ç´¯å å¨ Accumulator éå¸¸ä¼åä½ accãè½ç¶å®å«âç´¯å å¨âï¼ä½åä¸ä¸è¦çè§£æå®åªè½åå æ³è¿ç®ã<strong>ä»æ¬è´¨ä¸è®²ï¼acc å°±æ¯è§£éå¨éå¯ä¸çâéç¨ä¸´æ¶å¯å­å¨â</strong>ï¼å½åè¿æ¡å­èç è¦å¤ççå¼ï¼æèè¿ç®åçä¸­é´ç»æï¼å ä¹é½ä¼ææ¶æ¾å¨è¿éã</p>
<p>acc éå¯ä»¥è£ä»»ä½ JavaScript çå¼ï¼æ¯å¦å¸¸éãå°æ´æ°ãå­ç¬¦ä¸²ãå¯¹è±¡å¼ç¨ã<code>undefined</code> ç­ãä¹æä»¥è¦è®¾è®¡è¿ä¹ä¸ä¸ªâç»ä¸çä¸´æ¶ä½ç½®âï¼å°±æ¯ä¸ºäºè®©å¤§å¤æ°å­èç åªéè¦åæâå¦ä¸ä¸ªåä¸è¿ç®çå¯¹è±¡æ¯è°âï¼èä¸ç¨æ¯æ¬¡é½é¢å¤å£°æå¤ä¸ªå¯å­å¨åæ°ï¼ä»è<strong>è®©å­èç æ´ç­ãæ´è§æ´ï¼ä¹è®©è§£éå¨å®ç°æ´ç®å</strong>ã</p>
</li>
</ul>
<pre><code>  Ldar r1   ; acc = r1
  Add r0    ; acc = acc + r0
  Star r2   ; r2 = acc
  
  ç´¯å å¨accçååã    æ¯ä¸æ¯éå¸¸ç®åã
</code></pre>
<h2 id="3--æ å¸§åæ§½ä½">3 . æ å¸§åæ§½ä½</h2>
<p>å¨ç¬¬ä¸é¨åè§£æç¯é  æä»¬ä¹æå°è¿ æ§½ä½ è¿ä¸ªæ¯è¯­ï¼ ä¸é¢åæå°äºï¼é£ä¹ï¼æ§½ä½å°åºæ¯ä»ä¹å¢ï¼</p>
<p><strong>æ§½ä½ï¼slotï¼å°±æ¯æ å¸§éä¸æ ¼ä¸æ ¼åºå®å¤§å°çâå­å¨ååâæâæ ¼å­âï¼ç¨äºæç´¢å¼å­æ¾å½æ°çåæ°ãå±é¨åéãä¸´æ¶å¼ãä»¥åå¶å®åæ°æ®ã</strong> å®ä¸ä»æ¯âä½ç½®âï¼è¿éå«äºå¤§å°ãç±»åï¼éå¸¸æ¯æé/Tagged å¼ï¼ãå°åè®¡ç®è§ååçå½å¨æè¯­ä¹ã</p>
<p>åå­å¯å¯»åçæå°åä½æ¯ 8bit å³ä¸å­èï¼ è½ç¶æå°ä½¿ç¨åä½æ¯8bit å³ä¸å­èãä½æ¯ï¼å ä¸ºéè¦å­èå¯¹é½ å æºå¨æéå¤§å°çè¦æ±ï¼æä»¥ å¨32ä½ç³»ç»ä¸ï¼  éè¦4å­èè¡¨ç¤ºæéï¼ 64ä½ç³»ç»ä¸  éè¦8å­èè¡¨ç¤ºæéã æ¯ä¸ªæ§½ä½çå¤§å°ï¼ä¹æ¯æç§æä½ç³»ç»æºå¨æéçå¤§å°æ¥ååçã å³   64ä½ç³»ç»ï¼ä¸ä¸ªæ§½ä½  å  8ä¸ªå­è ã åªæè¿æ ·ï¼<strong>64ä½ç³»ç»</strong>ä½¿ç¨æéå¯»åæ¶ï¼8å­èï¼å³64bitï¼æè½å¤è£å¾ä¸ä¸ä¸ªæéã</p>
<p>æä»¥ï¼æ¯ä¸ªæ§½ä½ï¼slotï¼å  8ä¸ªå­èå¤§å°ã</p>
<p>å½å½æ°å¼å§æ§è¡æ¶ï¼è¿è¡æ¶runtimeå¨æ ä¸ä¸ºå®åéä¸æ®µè¿ç»­åå­ä½ä¸º<strong>æ å¸§</strong>ãå¨ Ignition ä¸­ï¼æ å¸§å¤§è´åä¸ºä¸é¨åï¼<strong>åæ°åº</strong>ã<strong>åºå®å¤´é¨</strong>ï¼  <strong>å·¥ä½åº</strong> ãæ å¸§éçæ¯ä¸ªâæ ¼å­âç§°ä¸º<strong>æ§½ä½ï¼slotï¼</strong>ï¼æç´¢å¼å­æ¾å±é¨åéåä¸´æ¶å¼ï¼æ§½ä½çå¤§å°éå¸¸ç­äºæºå¨æéå¤§å°ï¼ <strong>64 ä½</strong>ä¸ä¸º 8 å­èã</p>
<p><strong>ç¹å«æ³¨æ</strong>ï¼åé¢æä»¬ä¸è¬å¹¶æ²¡ææç¡®çåºåæ å¸§éæ§½ä½åå­æ®µï¼ç°å¨æç¡®ä¸ä¸ï¼æä»¬<strong>ä»ä»æ¯æå·¥ä½åºä¸­</strong>æç´¢å¼çæ ¼å­ï¼<code>r0, r1, r2â¦</code>ï¼ç§°ä¸º<strong>æ§½ä½ï¼frame slotsï¼</strong>ãåºå®å¤´é¨éçå­æ®µï¼è¿åå°åãsaved FPãContextãBytecodeArray ç­ï¼æä»¬<strong>ä¸</strong>æå®ä»¬ç§°ä¸ºæ§½ä½ï¼åæ°ä¸è¬ç§°ä¸º argument slotsï¼<code>a0,a1</code>ï¼æåç¬æè¿°ã</p>
<p>ä¸¥æ ¼ä» V8 åå­è§è§æ¥çï¼æ å¸§ä¸­çæ¯ä¸ä¸ª 8 å­èå­å¨ååï¼æ è®ºæ¯ Contextãè¿åå°åè¿æ¯å±é¨åéï¼å¨æºç ä¸­é½ç»ç§°ä¸º <strong>Slot</strong>ã</p>
<p>ä½å¨è§£éå¨å­èç çè¯­å¥ç¯å¢ä¸­ï¼ä¸ºäº<strong>åºååè½</strong>ï¼</p>
<ul>
<li>æä»¬å°åºå®ä½ç½®ãç¨éåä¸çåºåç§°ä¸º <strong>âåºå®å¤´é¨å­æ®µâ</strong>ï¼å¦ Function, Contextï¼ã</li>
<li>æä»¬å°ç¨äºå­å¨å±é¨åéåä¸´æ¶ç»æãéè¿ç´¢å¼å¨æè®¿é®çåºåç¹ç§°ä¸º <strong>âå¯å­å¨æ§½ä½â</strong> æ <strong>âå±é¨åéæ§½ä½â</strong> æç®ç§°ä¸º <strong>æ§½ä½</strong> ã</li>
<li><strong>ææ¶åå¯è½ä¼ææ··ç¨ï¼å°æ ä¸æå­æ®µä¹ç§°ä¸ºæ§½ä½ï¼ä»è§èä»v8æºç ä¸æ¥è¯´ï¼å®å¨æ²¡æéè¯¯ï¼åªæ¯å ä¸ºæææèåå¿«äºï¼æ²¡ææç§æä»¬éå¸¸çæåè½åºåççº¦å®ç§°å¼ã</strong></li>
<li>å½ç¶ï¼ä½ å¯ä»¥æç§èªå·±çææ¿ï¼åºåæèä¸åºåï¼<strong>é½æ¯æ­£ç¡®ç</strong>ãåææ¯  ä½ è¦ç¥éè§å¯çè§è§çä¸åã</li>
</ul>
<p>ä¸é¢æä»¬è¯¦ç»ä»ç»ä¸ä¸æ å¸§çç»æã</p>
<p>æ ççé¿é¡ºåºï¼æ¯<strong>ä»é«å°åå°ä½å°å</strong>ï¼å³å¥æ æ©çå¨é«å°åï¼ æåå¥æ çå¤äºæ é¡¶ å¨ä½å°åã</p>
<p>æä»¬é¦åä»ç»ä¸ªæ¯è¯­ï¼Tagged Pointer</p>
<blockquote>
<h4 id="tagged-pointer--æ ç­¾æé">Tagged Pointer  æ ç­¾æé</h4>
<p>64ä½ç³»ç»ä¸­ï¼æ¯ä¸ªæ§½ä½é½æ¯ 8 å­èï¼64 ä½ï¼ï¼V8 å¨è¿éé¢å­æ°æ®æ¶ï¼ä½¿ç¨äºä¸ä¸ªç¼ç æå·§ï¼å«å <strong>Tagged Pointer (å¸¦æ ç­¾çæé)</strong>ã</p>
<p>å¨éæè¯­è¨ç«ï¼æ¯å¦ C++ è¿ç§éæè¯­è¨ï¼ç¼è¯å¨ç¥éåéæ¯ <code>int</code> è¿æ¯ <code>Object*</code>ãä½å¨ JavaScript ä¸­ï¼ç±»åæ¯å¨æçãå¦æ V8 ä¸ºæ¯ä¸ªåéé¢å¤å­ä¸ä¸ªâç±»åå­æ®µâï¼åå­æ¶èä¼ç¿»åã V8 çåæ³æ¯ï¼<strong>æç±»åä¿¡æ¯ç´æ¥ç¼ç è¿è¿ 64 ä½æ°æ®æ¬èº«ã</strong></p>
<p><strong>æ¹æ³å°±æ¯å¤ç¨âå¯¹é½çä¸çä½ä½â</strong> å¨ 64 ä½å¹³å°ä¸ï¼åå­å°åéå¸¸æ¯ <strong>8 å­èå¯¹é½</strong> çãåæ³å°åçäºè¿å¶å½¢å¼ï¼<strong>æä½çå ä½éå¸¸é½æ¯ 0</strong>ã V8 å°±æ¯ä½¿ç¨äºè¿äºé²ç½®çä½ä½ï¼ç¨æ¥æä¸ç±»åæ ç­¾Tagã</p>
<p><strong>Tagged Value çåç±»ï¼</strong> V8 ææ§½ä½éçæºå¨å­ç»ç§°ä¸º <strong>Tagged Value</strong>ï¼æ ¹æ®ä½ä½æ ç­¾ä¸åï¼åä¸ºä¸¤ç±»ï¼</p>
<p><strong>Smi (Small Integerï¼æ ç­¾ç«å³é)</strong></p>
<ul>
<li><strong>ç¹å¾</strong>ï¼æä½ä½éå¸¸ä¸º <code>0</code>ã</li>
<li><strong>å«ä¹</strong>ï¼è¿ <strong>ä¸æ¯</strong> æéï¼è¿ 64 ä½æ°æ®æ¬èº«å°±å­çä¸ä¸ªæ´æ°ã</li>
<li><strong>ä¼å¿</strong>ï¼æ´æ°ç´æ¥ä½å¨æ ä¸ï¼ä¸éè¦å»å éç³è¯·åå­ï¼éåº¦æå¿«ã</li>
<li><strong>è¿å</strong>ï¼ä½¿ç¨æ¶ï¼éè¿<strong>å³ç§» (Shift)</strong> è¿ç®å»ææ ç­¾ï¼å°±è½å¾å°æ´æ°å¼ã</li>
</ul>
<p><strong>Tagged Pointer (å å¯¹è±¡å¼ç¨)</strong></p>
<ul>
<li><strong>ç¹å¾</strong>ï¼æä½ä½éå¸¸ä¸º <code>1</code>ã</li>
<li><strong>å«ä¹</strong>ï¼è¿æ¯ä¸ä¸ªæåå åå­ä¸­å¯¹è±¡ï¼HeapObjectï¼ç <strong>å¼ºå¼ç¨</strong>ã</li>
<li><strong>æ³¨æ</strong>ï¼å®ä¸è½ç´æ¥å½åç©çå°åç¨ã</li>
<li><strong>è¿å</strong>ï¼ä½¿ç¨æ¶ï¼å¿é¡»éè¿<strong>ä½æ©ç  (Mask)</strong> è¿ç®å»ææ ç­¾ï¼Untagï¼ï¼è¿åæçº¯åçåå­å°åï¼æè½å»è®¿é®å éçå¯¹è±¡ã</li>
</ul>
<p>è¿æ ·ä½¿ç¨Tagä»¥åï¼ Tagged value å°±åç»æ°æ®ç©¿äºä¸ä»¶âé©¬ç²âãIgnition çä¸ç¼é©¬ç²ï¼æ ç­¾ä½ï¼ï¼å°±ç¥éæ¯æ´æ°è¿æ¯å¯¹è±¡ãè½ç¶ä½¿ç¨åå¿é¡»âè±é©¬ç²âï¼Untagï¼ï¼ä½è¿å¸¦æ¥çæ§è½æåååå­èçæ¯å·¨å¤§çã</p>
<p>å¦å¤éè¦æ³¨æï¼ä½¿ç¨tagæ è®°ï¼  è½ç´æ¥å¤å®çç±»åéåå¾å°ï¼ä¸»è¦æ¯ Smi æHeapObjectï¼ï¼æ´ç»çç±»åï¼éè¦è¯»åå¯¹è±¡å¤´æ¥è·åã</p>
</blockquote>
<p>é£ä¹ ï¼æ å¸§çç»ææ¯ææ ·çå¢ï¼å®çç»æå¦ä¸ï¼</p>
<ul>
<li>
<p>ç¬¬ä¸å±  åæ°åº Arguments</p>
<p>å½è°ç¨ä¸ä¸ªå½æ°æ¶ï¼è°ç¨èCalleréè¦ç»å®ä¼ å®åï¼åæ¶è¿æä¸ªéå½¢åæ°thisï¼è¿äºåå®¹ï¼é½å¨æ å¸§çç¬¬ä¸å±åæ°åºã</p>
<ul>
<li><strong>Receiver (this)</strong>ï¼
<ul>
<li>è¿æ¯ä¸ªéå½¢åæ°ãå½ä½ å <code>obj.func()</code> æ¶ï¼<code>obj</code> å°±æ¯ Receiverãå®æ¯åæ°åè¡¨éçéå½¢èå¤§å¥ã</li>
</ul>
</li>
<li><strong>Arguments (<code>a0</code>, <code>a1</code>...)</strong>ï¼
<ul>
<li>è¿å°±æ¯ <code>function foo(x, y)</code> éç <code>x</code> å <code>y</code>ã</li>
<li>Ignition ç»å®ä»¬ç¼çå·æ¯ <code>a0</code>, <code>a1</code>...</li>
<li>è¦æ³¨æçæ¯ï¼è¿éç <code>a</code> ä»£è¡¨ Argumentï¼ä¸è¦å Accumulator ææ··äºã</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ç¬¬äºå±  åºå®å¤´é¨  Fixed header / fixed frame part</p>
<p>è¿æ¯æ´ä¸ªæ å¸§ä¸­æéè¦ãæå³é®çåºåã</p>
<p>æ¢ç¶ Ignition æ¯ä¸ªè½¯ä»¶æ¨¡æç CPUï¼é£ CPU è¿è¡æ¶éè¦çé£äºç¶æ  æ¯å¦âæç°å¨è¿è¡å°åªä¸è¡äºï¼âãâæçç¯å¢æ¯è°ï¼â  ãããç­ç­ä¿¡æ¯ï¼ é½æ¯å­å¨åªçï¼</p>
<p>æ²¡éï¼å°±å­å¨è¿å¿ï¼åºå®å¤´é¨ã</p>
<p>æ¯ä¸ªå½æ°æ å¸§çä¸­é´ï¼é½å¤¹çè¿ä¹ä¸åé·æä¸å¨çåºåï¼ä¿å­çç»´æèææºè¿è¡ç<strong>åæ°æ®</strong></p>
<p>å®éé¢çä¸»è¦åå®¹ï¼</p>
<ol>
<li>
<p><strong>Return Address (è¿åå°å)</strong>ï¼</p>
<ul>
<li><em>ä½ç¨</em>ï¼ç­è¿ä¸ªå½æ°æ§è¡å®ï¼åºå±è°ç¨æ å°±ä¼æ ¹æ®è¿ä¸ªè¿åå°åï¼è·³åè°ç¨å¤ç»§ç»­æ§è¡ã</li>
<li>è¿éè°æ³¨æï¼è¿åå°åï¼ æ¯æ§å¶æµï¼æ¯è¿åçåºè¯¥å°ä»£ç çåªä¸ªä½ç½®å»ç»§ç»­æ§è¡ã</li>
</ul>
</li>
<li>
<p><strong>Caller's Frame Pointer (ä¸ä¸å±æ å¸§æé)</strong>ï¼</p>
<ul>
<li>
<p><em>ä½ç¨</em>ï¼é¾è¡¨æéãå½åå½æ°æ§è¡å®ãè°ç¨èçæ å¸§å¨åªéï¼</p>
</li>
<li>
<p>è¿æ ·ä¾æ§è¦æ³¨æï¼è¿ä¸ªæéï¼æçæ¯æ°æ®ï¼ä¸ä¸ªå­æ®µè¿åå°åï¼æ¯æ§å¶æµçè¿åï¼è¿é</p>
</li>
<li>
<p>çä¸å±æ å¸§æéï¼æ¯æ§å¶æµè¿åä»¥åï¼ç»§ç»­æ§è¡ï¼ åºè¯¥ä»åªéå»æ¾åéï¼è¿åçæ¯é£ä¸ª</p>
</li>
<li>
<p>æ å¸§ï¼å¯ä»¥çè§£ä¸ºæ°æ®ã</p>
</li>
<li>
<p>å¨çè§£ä¸ï¼è¿å¯ä»¥å¤§è´è®¤ä¸ºï¼</p>
</li>
<li>
<p>è¿åå°åæ¯ç­è¿ä¸ªå½æ°æ§è¡å®ï¼è¦åå°åªä¸è¡ç»§ç»­æ§è¡ä»£ç ï¼ä¹å°±æ¯<strong>æ§å¶æµ</strong>è¯¥è·³ååªéãè¿æ¯æ¶é´ä¸çè¿å ï¼ä»£ç ç»§ç»­ä»åªéè·ã</p>
<p>ä¸ä¸å±æ å¸§æéæ¯è°ç¨æçé£ä¸ªå½æ°ï¼å®çæ å¸§ä»åªéå¼å§ï¼<br>
è¿æ¯ç©ºé´ä¸çè¿å ï¼è¦å»åªä¸ååå­éç»§ç»­è®¿é®å±é¨åéåä½ç¨åæ°æ®ã</p>
</li>
</ul>
</li>
<li>
<p><strong>Context (ä¸ä¸ææé)</strong></p>
<ul>
<li>
<p><em>è¿æ¯ä»ä¹</em>ï¼å®æå <strong>å åå­ (Heap)</strong> ä¸­ä¸ä¸ªå«å <code>Context</code> çå¯¹è±¡ã</p>
</li>
<li>
<p>ä¸ºä»ä¹è¦å®ï¼</p>
<p>å¦æå½æ°éç¨å°çåéæ¯èªå·±ç let aï¼ç´æ¥å»æ ä¸æ¾ï¼r0ï¼ã</p>
<p>ä½å¦æç¨å°äºé­ååéï¼å¤å±å½æ°çåéï¼ï¼Ignition å¿é¡»æ¿çè¿ä¸ª Context æéï¼å»å éçä¸ä¸æé¾è¡¨ä¸ä¸å±å±æ¾ã</p>
</li>
<li>
<p><em>å°ä½</em>ï¼å®æ¯è¿æ¥ <strong>âæ ä¸çï¼ä¸´æ¶æ°æ®ï¼â</strong> å <strong>âå ä¸çï¼æä¹æ°æ®ï¼â</strong> çå¯ä¸æ¡¥æ¢ã</p>
</li>
<li>
<p>è¿ä¸ªæ¦å¿µéå¸¸éè¦ï¼å¼å¾æä»¬æ·±å¥äºè§£ãå¦å¤æä¸å¥ï¼è½ç¶è¯´  è¿æ´ä¸ªé¨åé½å¯ä»¥äºè§£ä¸ºä¸»ï¼ä½æ¯å¦æè®¤çå­¦ä¹ ï¼è½å¤ææ¡ï¼è¿æ¯æå¾å¤§çç¨å¤ãæ¯å¦è¿ä¸ªæ å¸§ï¼å¯¹äºjså¼åè¿æ¯å¾éè¦çã</p>
</li>
<li>
<p>ä¸é¢æä¸ªä¸ä¸å±æ å¸§æéï¼è¿éåæä¸ªä¸ä¸ææéï¼æä¹æ­£ç¡®èæ·±å¥ççè§£ä»ä»¬å¢ï¼</p>
</li>
<li>
<p>**ä¸ä¸å±æ å¸§æéæ¯âå¨æè°ç¨é¾â **</p>
<ul>
<li><strong>åç­çé®é¢ï¼</strong> âææ¯è¢«è°è°ç¨çï¼â</li>
<li><strong>æååªéï¼</strong> æå<strong>æ ï¼Stackï¼</strong>ä¸çä¸ä¸çº§æ å¸§ã</li>
<li><strong>ä½ç¨ï¼</strong> å½æ°æ§è¡å®ï¼returnï¼åï¼åºå±ä¼æ ¹æ®è¿åå°åè·³åè°ç¨èç»§ç»­æ§è¡ï¼èä¸ä¸å±æ å¸§æéåç¨æ¥æ¢å¤è°ç¨èçæ å¸§å¸å±ï¼ç¨äºç»§ç»­è®¿é®å®çå±é¨åéç­æ°æ®ã</li>
</ul>
<p>**Context æ¯âéæä½ç¨åé¾â **</p>
<ul>
<li><strong>åç­çé®é¢ï¼</strong> âææ¯è¢«å®ä¹å¨åªéçï¼â</li>
<li><strong>æååªéï¼</strong> æå<strong>å ï¼Heapï¼</strong>ä¸ç Context å¯¹è±¡ã</li>
<li><strong>ä½ç¨ï¼</strong> å®æ¯<strong>æ°æ®æµ</strong>çæ¥æ¾è·¯çº¿ãå½å½æ°è®¿é®ä¸ä¸ªä¸å¨èªå·±åé¨çåéï¼èªç±åéï¼æ¶ï¼V8 ä¼é¡ºçè¿æ¡é¾å»æ¥æ¾ã</li>
</ul>
</li>
<li>
<p>çè§£çå³é®ç¹</p>
</li>
<li>
<p><strong>ä¸ä¸å±æ å¸§æåçæ¯æ åå­</strong>ï¼æ å¸§æ¯ä¸´æ¶çï¼å½æ°ä¸è¿åï¼æ å¸§å°±éæ¯äºã</p>
<p><strong>Context æåçæ¯å åå­</strong>ï¼è¿æ¯ä¸ºäºå®ç° JavaScript ç<strong>é­å</strong>ç¹æ§ã</p>
</li>
</ul>
</li>
<li>
<p><strong>Function / Frame Marker (å½æ°/å¸§ç±»åæ è®°)</strong>ï¼</p>
<ul>
<li>
<p>è¿ä¸ªå­æ®µç<strong>ä½ç½®</strong>å¨<code>[FP - 16]</code>  <strong>è¯·æ³¨æ</strong>  è¿éçåç§»å¼ 16 ä»æ¯<strong>ç¤ºæ</strong>ã  è¿ç§è¡¨ç¤ºæ¹æ³ï¼åé¢ä¼è¯¦ç»ä»ç»ã</p>
</li>
<li>
<p>è¿æ¯ä¸ä¸ªå·æ<strong>å¤ææ§ (Polymorphic)</strong> çå³é®æ§½ä½ãå®ç¨äºå½åæ å¸§çèº«ä»½è¯å«ãV8 å¼æå©ç¨è¿ä¸ªæ§½ä½æ¥åºåå½åæ å¸§æ¯å±äºæ åç JavaScript å½æ°è°ç¨ï¼è¿æ¯å±äºå¼æåé¨ç C++ è°ç¨ã</p>
</li>
<li>
<p>V8 çæ éåå¨ï¼Stack Walkerï¼å¨æ«æå æ æ¶ï¼ä¾å¦è¿è¡ GC æ è®°ãçæéè¯¯å æ æåä¼åæ¶ï¼ï¼ä¼è¯»åè¯¥æ§½ä½çå¼ï¼å¹¶æ ¹æ® <strong>æéæ è®°ä½ (Tag Bit)</strong> è¿è¡å¤æ­ï¼</p>
<ul>
<li><strong>å¦ææ¯å¯¹è±¡æéï¼Heap Objectï¼</strong>ï¼å¤å®ä¸º <strong>Interpreted Frame</strong>ï¼è§£éå¨å¸§ï¼ã</li>
<li><strong>å¦ææ¯å°æ´æ°ï¼Smiï¼</strong>ï¼å¤å®ä¸º <strong>Internal Frame</strong>ï¼åé¨å¸§ï¼ã</li>
</ul>
</li>
<li>
<p>å·æä¸¤ç§å¯è½çç¶æï¼</p>
</li>
<li>
<p>ç¶æ Aï¼å­æ¾ <code>JSFunction</code> (Closure)</p>
<ul>
<li><strong>åºæ¯</strong>ï¼å½æ§è¡å¸¸è§ JavaScript ä»£ç æ¶ã</li>
<li><strong>åå®¹</strong>ï¼æåå½åæ­£å¨æ§è¡çå½æ°å¯¹è±¡ï¼é­åï¼çæéã</li>
<li><strong>ä½ç¨</strong>ï¼
<ol>
<li>ä½ä¸º<strong>èµæºå¥å£</strong>ï¼è§£éå¨éè¿å®è®¿é® <code>SharedFunctionInfo</code>ï¼è·åå­èç ï¼å <code>FeedbackVector</code>ï¼è·åä¼ååé¦ï¼ã</li>
<li>è¿æ¥<strong>å ä¸æ </strong>ï¼ä¿æå¯¹å ä¸å½æ°å¯¹è±¡çå¼ºå¼ç¨ï¼é²æ­¢è¢« GC åæ¶ã</li>
</ol>
</li>
</ul>
<p><strong>ç¶æ Bï¼å­æ¾ <code>StackFrame::Type</code> (Marker)</strong></p>
<ul>
<li><strong>åºæ¯</strong>ï¼å½æ§è¡ V8 åé¨ä»£ç ï¼å¦ <code>EntryFrame</code>, <code>ConstructFrame</code>, <code>BuiltinFrame</code>ï¼æ¶ã</li>
<li><strong>åå®¹</strong>ï¼ä¸ä¸ªæä¸¾å¼ï¼Smiï¼ï¼æ è¯å·ä½çå¸§ç±»åã</li>
<li><strong>ä½ç¨</strong>ï¼
<ol>
<li><strong>è·¯æ ä½ç¨</strong>ï¼åè¯æ éåå¨å¦ä½è§£æå½åå¸§çå¶ä½é¨åï¼ä¸åç±»åçåé¨å¸§ï¼å¸å±å¯è½ä¸åï¼ã</li>
<li><strong>è¾¹ççå®</strong>ï¼æ è®° JS ä»£ç ä¸ C++ ä»£ç çè½¬æ¢è¾¹ç</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Bytecode Array (å­èç æ°ç»æé)</strong>ï¼</p>
<ul>
<li>
<p><strong>è¿ä¸ªå­æ®µçä½ç½®ï¼</strong> <code>[FP - 24]</code>   ä¾æ§è¯·æ³¨æï¼åç§»å¼ 24 ä»æ¯ç¤ºæã</p>
</li>
<li>
<p><strong>è¿ä¸ªå­æ®µçåå®¹ï¼</strong> ä¸ä¸ªæåå åå­ä¸­ <code>BytecodeArray</code> å¯¹è±¡ç <strong>Tagged Pointer</strong>ã</p>
</li>
<li>
<p><strong>å®ä¹ï¼</strong> å®æ¯è§£éå¨ Ignition çæ­£âè¯»åâåâæ§è¡âçæä»¤åºåæºå¤´ã</p>
</li>
<li>
<p>è¿ä¸ªå­æ®µæ¯ä¸ä¸ªæéï¼æåå ï¼Heapï¼ä¸çä¸ä¸ª<code>BytecodeArray</code> å¯¹è±¡ã</p>
<p>ä¹æä»¥å« <code>Array</code>ï¼æ¯å ä¸ºå®ç<strong>ä¸»ä½é¨å</strong>ç¡®å®æ¯ä¸ä¸²è¿ç»­çãåé¿çå­èåºåã</p>
<p>å¨ V8 çåºå± C++ å®ä¹ä¸­ï¼å¡æ¯ç¬¦å <strong>âå®é¿å¤´é¨ + åé¿å°¾é¨â</strong> ç»æçå¯¹è±¡ï¼éå¸¸é½ä»¥æ­¤å½åã</p>
<ul>
<li><strong>æ®éå¯¹è±¡ (<code>JSObject</code>)</strong>ï¼å¤§å°éå¸¸æ¯åºå®çï¼æèç± Map æè¿°ï¼ã</li>
<li><strong>æ°ç»ç±»å¯¹è±¡ (<code>FixedArray</code>, <code>ByteArray</code>)</strong>ï¼
<ol>
<li>å®æ¯<strong>åé¿</strong>çï¼å¨åéæ¶å³å®å¤§å°ï¼ã</li>
<li>å®ç<strong>ä¸»è¦åå®¹</strong>æ¯å¯ä»¥éè¿ç´¢å¼ï¼Indexï¼è®¿é®çåºåã</li>
</ol>
</li>
</ul>
<p>ä¹æä»¥å« <code>BytecodeArray</code> æ¯ä¸ºäºå¼ºè°å®ç<strong>å­å¨å½¢æ</strong>æ¯çº¿æ§çå­èåºåã</p>
</li>
</ul>
</li>
<li>
<p><strong>Bytecode Offset (å­èç åç§»é / PC)</strong>ï¼</p>
<ul>
<li><em>ä½ç¨</em>ï¼<strong>ç¨åºè®¡æ°å¨</strong>ãè®°å½å½åæ§è¡å°ç¬¬å æ¡æä»¤äºã</li>
<li><strong>ä½ç½®ï¼</strong> <code>[FP - 32]</code> (å³ <code>StandardFrameConstants::kBytecodeOffset</code>)  ï¼åç§»å¼32ï¼ä»ä¸ºç¤ºæï¼å¹¶éç¡®å®å¼ã</li>
<li><strong>å½¢å¼ï¼</strong> <strong>Smi (å°æ´æ°)</strong>ã</li>
<li><strong>å«ä¹ï¼</strong> å®è®°å½äºå½åæ§è¡å°äº <code>BytecodeArray</code> ä¸­ç<strong>ç¬¬å ä¸ªå­è</strong>ã</li>
<li><em>ç»è</em>ï¼å¨æ­£å¸¸è§£éæ§è¡æé´ï¼PC ç¶æå¸¸é©»å¨<strong>çå®çç©çå¯å­å¨</strong>ï¼å¨ä¹ä¸­ä¸åçåå¨ï¼åªæå¨éè¦å¤é¨å¯è§ææ¢å¤æ¶ï¼GC/ä¸­æ­/æ­ç¹/åä¼å/è¿å¥ runtime ç­ï¼ï¼è§£éå¨ä¼æå¯å­å¨çå¼ååæ å¸§ BytecodeOffset å­æ®µï¼ãæ¢å¤æ¶ä¼æå®åè£åç©çå¯å­å¨ã</li>
</ul>
</li>
</ol>
</li>
<li>
<p>ç¬¬ä¸å±   å·¥ä½åº  Work Area / Virtual Registers</p>
<p>è¿æ¯æ å¸§ä¸­ä½äºåºå®å¤´é¨åé¢ãåä½å°åå»¶ä¼¸çåºåã</p>
<p>Ignition å°è¿æ®µè¿ç»­çåå­æ§½ä½ï¼ç»å®ä»¬ç¼ä¸å·ï¼<code>r0</code>, <code>r1</code>, <code>r2</code>...</p>
<p>è½ç¶å®ä»¬å¨ç©çä¸åªæ¯è¿ç»­ç 8 å­èåå­æ ¼å­ï¼ä½å¨é»è¾ä¸ï¼å®ä»¬éå¸¸ååæäºä¸ç§æªç¶ä¸åçç¨éã</p>
<h4 id="1-æ¾å¼å±é¨åé-explicit-locals">1. æ¾å¼å±é¨åé (Explicit Locals)</h4>
<p>è¿æ¯æå¥½çè§£çé¨åãå®ä»¬ç´æ¥å¯¹åºä½ å¨ JavaScript ä»£ç ä¸­å£°æçå±é¨åéã</p>
<p>çæå¨ï¼BytecodeGeneratorï¼ä¼æç§ç¹å®ç®æ³ï¼éå¸¸ä¸å£°æé¡ºåºç¸å³ï¼ä¸ºè¿äºåéåéæ§½ä½ã</p>
<ul>
<li>ç¤ºä¾</li>
</ul>
<p>function demo() {<br>
var name = 'v8';  // ç¼è¯å¨å³å®ï¼åéç» r0<br>
let age = 10;     // ç¼è¯å¨å³å®ï¼åéç» r1<br>
}</p>
<p>å½ä»£ç æ§è¡å°è¿éæ¶ï¼<code>r0</code> æ§½ä½éå°±å¡«å¥äº <code>"v8"</code> çæéï¼<code>r1</code> æ§½ä½éå¡«å¥äº <code>10</code> ç Smi å¼ã</p>
<ul>
<li>
<p><strong>å³é®ç¹ï¼ä½ç¨ååæ (Scope Analysis)</strong></p>
<p><strong>è¦æ³¨æ</strong>  å¹¶ä¸æ¯ä½ åçææå±é¨åéé½è½ä½å¨è¿ä¸ªâæ ä¸çå·¥ä½åºâã</p>
<p>å¨çæå­èç ä¹åï¼V8 ä¼åè¿è¡ä¸æ¬¡ <strong>ä½ç¨ååæ</strong>ã</p>
<ul>
<li><strong>å¤æ­æ å</strong>ï¼å¦æä¸ä¸ªåéè¢«åé¨å½æ°ï¼é­åï¼<strong>æè· (Captured)</strong> äºï¼å®å°±ä¸è½ä½å¨æ ä¸</li>
<li><strong>åå </strong>ï¼æ å¸§çå½æ¯æéçï¼å½æ°æ§è¡å®å°±éæ¯äºãä½é­åå¯è½å¨å½æ°æ§è¡å®åè¿éè¦è®¿é®è¿ä¸ªåéã</li>
<li><strong>ç»æ</strong>ï¼è¢«æè·çåéä¼è¢«è¯·å°å åå­ç <strong>Context å¯¹è±¡</strong> ä¸­ã</li>
<li><strong>ç»è®º</strong>ï¼æä»¥ï¼è½å®ç¨³ä½å¨ <code>r0, r1</code> éçï¼é½æ¯èº«å®¶æ¸ç½çã<strong>æªè¢«æè·</strong>çå±é¨åéã</li>
</ul>
</li>
</ul>
<h4 id="2-éå¼ä¸´æ¶åé-implicit-temporaries">2. éå¼ä¸´æ¶åé (Implicit Temporaries)</h4>
<p>è¿æ¯å¨æºä»£ç éå®å¨çä¸å°ï¼ä½æºå¨æ§è¡æ¶å¿é¡»å­å¨çåéãè¿ä¹æ¯ <strong>å¯å­å¨åé (Register Allocation)</strong> ç®æ³å¤§æ¾èº«æçå°æ¹ã</p>
<ul>
<li>
<p><strong>ä¸ºä»ä¹è¦ä¸´æ¶åéï¼</strong></p>
<p>æ³è±¡ä¸ä¸è®¡ç® <code>var x = a + b + c;</code></p>
<p>Ignition çç´¯å å¨ï¼èå¸åçéèº«åï¼åªæä¸ä¸ªã</p>
<ol>
<li>åæ <code>a</code> æ¿è¿åï¼æ <code>b</code> å è¿æ¥ãåéç°å¨æ¯ <code>(a+b)</code>ã</li>
<li>ä¸ä¸æ­¥è¦å  <code>c</code>ãæä»¤è¦æ± <code>Add c</code>ã</li>
<li><strong>åçå²çª</strong>ï¼å¦æ <code>c</code> çè·åè¿ç¨å¾å¤æï¼æ¯å¦ <code>c</code> æ¯ä¸ªå½æ°è°ç¨ <code>getC()</code>ï¼ï¼é£ä¹å¨æ§è¡ <code>getC()</code> çè¿ç¨ä¸­ï¼ç´¯å å¨ä¼è¢«åå¤ä½¿ç¨ãè¦çã</li>
<li><strong>å¦ä½è§£å³</strong>ï¼å¿é¡»åæ <code>(a+b)</code> çç»ææ¾ä¸ªæ ¼å­ <strong>æå­ Spill</strong> èµ·æ¥ã</li>
</ol>
</li>
<li>
<p><strong>ç©çå­å¨</strong>ï¼</p>
<p>Ignition ä¼å¨å±é¨åéåé¢ï¼ååºä¸äºæ ¼å­ä½ä¸º <strong>ä¸´æ¶å¯å­å¨</strong>ã</p>
<p>è¿äºæ ¼å­å°±åèå¸åæè¾¹çâå°é»æ¿âã</p>
<ul>
<li><strong>å¤ç¨æ§</strong>ï¼è¿è¡ä»£ç ç®å®äºï¼è¿å¼ âå°é»æ¿âæ¦å¹²åï¼ç«å»ç»ä¸ä¸è¡ä»£ç å¤ç¨ãæä»¥å³ä½¿ä»£ç å¾é¿ï¼åªè¦ä¸åæ¶éè¿å¤§éä¸­é´ç»æï¼Frame Size ä¹ä¸ä¼å¾å¤§ã</li>
</ul>
</li>
</ul>
<h4 id="3-ç¥ç§çæ´-the-hole">3. ç¥ç§çæ´ (The Hole)</h4>
<p>è¿æ¯ ES6 å¼å¥ <code>let/const</code> åï¼V8 å¨åºå±å®ç° <strong>TDZ (ææ¶æ§æ­»åº)</strong> çæç¡¬æ ¸ææ®µã</p>
<p>å¨ç¬¬ä¸é¨åè§£æç¯ä¸­ï¼æä»¬å·²ç»è¯¦ç»å­¦ä¹ äºè¿ä¸ª ä¼å¹å¨å­çè­¦å«theholeï¼å¿è®°äºçæåï¼å¯ä»¥å¤ä¹ ä¸ä¸ç¬¬ä¸ç¯ä¸­çç¸å³åå®¹ãè¿éæä»¬ç¥å¾®çåè®²ä¸ä¸ã</p>
<p>å¨æ å¸§ååè¢«åå»ºï¼ä½ä»£ç è¿æ²¡æ§è¡å° <code>let a = ...</code> è¿ä¸è¡æ¶ï¼<code>rX</code> æ§½ä½éæ¾çæ¯ä»ä¹ï¼</p>
<ul>
<li>
<p><strong>å¯¹äº <code>var</code></strong>ï¼</p>
<p>V8 ä¼æå¯¹åºçæ§½ä½åå§åä¸º <code>undefined</code>ãæä»¥å¨èµå¼åè®¿é®å®ï¼æ¿å°çå°±æ¯ <code>undefined</code>ï¼åéæåï¼ã</p>
</li>
<li>
<p><strong>å¯¹äº <code>let / const</code></strong>ï¼</p>
<p>V8 ä¼æå¯¹åºçæ§½ä½å¡«å¥ä¸ä¸ªç¹æ®ç <strong>ä¼å¹å¨å­çè­¦å«</strong>ï¼å¨åé¨è¢«ç§°ä¸º <strong><code>The Hole</code></strong>ã</p>
</li>
<li>
<p><strong>æ§è¡æ¶çæ£æ¥æºå¶</strong>ï¼</p>
<p>Ignition å¨æ§è¡è¯»ååéçæä»¤ï¼å¦ <code>LdaRep</code>ï¼æ¶ï¼åç½®äºä¸æ®µå°é»è¾ï¼</p>
<p>// ä¼ªä»£ç <br>
value = load(r1);<br>
if (value == The_Hole_Value) {<br>
throw ReferenceError("Cannot access before initialization");<br>
}</p>
<p>TDZ å¹¶ä¸é¾çè§£ï¼å®å¨ç©çå±é¢ä¸ï¼å°±æ¯ä¸ä¸ªæ§½ä½éæ¾ç <code>The Hole</code>ï¼èè§£éå¨å¨è¯»åæ¶ä¸ä»è¯»æ°æ®ï¼è¿é¡ºæåäºä¸æ¬¡å®å¨æ£æ¥ï¼å¦ææ¸å°çæ¯è­¦å«ï¼å¨å­å°±åã</p>
</li>
</ul>
<h4 id="4-å¯»åæºå¶å¦ä½æ¾å°-r5">4. å¯»åæºå¶ï¼å¦ä½æ¾å° <code>r5</code>ï¼</h4>
<p>å·¥ä½åºåªæ¯ä¸æ®µè¿ç»­çåå­ï¼Ignition æä¹ç¥é <code>r5</code> å¨åªï¼</p>
<p>è¿å°±è¦ç¨å°æ±ç¼éç <strong>åºåå¯»å</strong> äºã</p>
<ul>
<li>
<p><strong>åºåç¹</strong>ï¼<strong>FP (Frame Pointer)</strong>ï¼æååºå®å¤´é¨çç¹å®ä½ç½®ã</p>
</li>
<li>
<p>ææåå¯è½ä¼æçé®äºï¼åé¢è¯´æ å¸§æ3é¨åï¼ç¬¬ä¸é¨åæ¯åæ°åºï¼å¯æ¯ä¸ºä»ä¹FPåºåç¹æååºå®å¤´é¨ ï¼èä¸æ¯æååæ°é¨åã</p>
</li>
<li>
<p>åæ°ç©ºé´æ¯<strong>è°ç¨è</strong>çåºåï¼å æ­¤å¨è¯­ä¹ä¸å®å±äºcaller çé¨å ï¼èä¸æ¯ callee ç¨æ¥åéæ¬å°åé/ä¸´æ¶ç workspaceãFP ä½ä¸ºè¢«è°ç¨èçæ å¸§åºåç¹ï¼éå¸¸æ¯ä¸åæ¬åæ°åºçã</p>
</li>
<li>
<p><strong>è®¡ç®å¬å¼</strong>ï¼</p>
<p>ç±äºæ æ¯åä½å°åå¢é¿çï¼æä»¥å¯å­å¨çå°åæ¯ FP åå»ä¸ä¸ªåç§»éã</p>
<p>Address(rn) = FP - fixed_header_size - (n * slot_size)</p>
<p>å¶ä¸­ <code>fixed_header_size</code> æ¯åºå®å¤´é¨çå­èé¿åº¦ï¼<code>slot_size</code> éå¸¸ç­äºæºå¨æéå¤§å°ï¼å¨ 64 ä½ç³»ç»ä¸å¸¸ä¸º 8 å­èï¼</p>
</li>
<li>
<p><strong>ç¤ºä¾ï¼</strong></p>
<ul>
<li><code>FP</code> æåè¿éã</li>
<li>å¾ä¸èµ° 8 å­è... æ¯ <code>Context</code> <code>[FP-8]</code>ã</li>
<li>åå¾ä¸... æ¯ <code>Function</code> <code>[FP-16]</code>ã</li>
<li>åå¾ä¸... æ¯ <code>BytecodeArray</code> <code>[FP-24]</code>ã</li>
<li>åå¾ä¸... æ¯ <code>BytecodeOffset</code> <code>[FP-32]</code>ã<strong>(åºå®å¤´é¨ç»æ)</strong></li>
<li><strong>åå¾ä¸... ç»äºå°äºå·¥ä½åºç r0</strong> <code>[FP-40]</code>ã</li>
<li><code>r0</code> åå¾ä¸ 8 å­èæ¯ <code>r1</code>ã</li>
</ul>
<p>æä»¥ï¼å­èç éçç®åæä»¤ <code>Ldar r5</code>ï¼ç¿»è¯å°åºå± CPU å¨ä½ï¼å°±æ¯å»è¯»æ´æ·±å¤çåå­å°åã</p>
</li>
</ul>
</li>
</ul>
<h2 id="4--è°ç¨çº¦å®ååå­å¸å±">4 . è°ç¨çº¦å®ååå­å¸å±</h2>
<p>éè¿åé¢çå­¦ä¹ ï¼æä»¬å·²ç»å¤§è´äºè§£äºæ å¸§çåå®¹ï¼ç°å¨æä»¬å°±éè¦å¨èå­ä¸­å»ºç«èµ·å¨æçæ å¸§æ¨¡åã</p>
<ul>
<li>
<p>å»ºç«æä»¬èªå·±çå¿æºæ¨¡åï¼åå­çæ³è±¡å¾</p>
<p>é£ä¹ æä»¬æä¹æ³è±¡åå­å¢ï¼ æ¢¯å­ï¼é«è¸å¥äºçæ¢¯å­ï¼ä¸æ ¼ä¸æ ¼çä»£è¡¨åå­ååã</p>
<p><strong>å°é¢ï¼æåºä¸ï¼</strong>ï¼æ¯ <strong>é«å°å</strong>ï¼æ¯å¦ <code>0xFF...</code>ï¼ãå¯¹äºæ å¸§æ¥è®²ï¼è¿æ¯ç¨³åºçå°åºã</p>
<p><strong>å¤©ç©ºï¼å¾ä¸çï¼</strong>ï¼æ¯ <strong>ä½å°å</strong>ï¼æ¯å¦ <code>0x00...</code>ï¼ãè¿æ¯å»¶ä¼¸ç©ºé´ã</p>
<p>æåºä¸æ¯é«å°åï¼è¶å¾ä¸ï¼å°åè¶ä½ã</p>
<p>ææåå¯è½ä¼é®ï¼âä¹¦ä¸æè V8 æºç æ³¨ééï¼éå¸¸é½æ¯ç»âé«å°åå¨ä¸ï¼ä½å°åå¨ä¸âï¼æ æ¯âåä¸çé¿âçï¼ä¸ºä»ä¹æä»¬è¦åçæ¥ï¼â</p>
<p>è¿å¶å®æ¯ä¸ºäºè´´å<strong>ç´è§</strong>ã å¦æä½ ä½¿ç¨è¿ OllyDbgãx64dbg æ IDA ç­è°è¯å·¥å·ï¼ä½ ä¼åç°å®ä»¬çåå­è§å¾éå¸¸æ¯è¿æ ·çï¼</p>
<ul>
<li><strong>ä¸é¢</strong> æ¾ç¤ºçæ¯ <strong>ä½å°å</strong>ã</li>
<li><strong>ä¸é¢</strong> æ¾ç¤ºçæ¯ <strong>é«å°å</strong>ã</li>
</ul>
<p><strong>è¿ç§è§è§çå¥½å¤æå¶ç´è§ï¼</strong></p>
<ul>
<li><strong>å¥æ  Push</strong>ï¼å°±åçæ¥¼ä¸æ ·ï¼å¨ç°æçæ¥¼é¡¶ä¸ï¼<strong>å¾ä¸</strong> åçä¸å±ï¼å°ååä½/åå°ï¼ã</li>
<li><strong>åºæ  Pop</strong>ï¼å°±åææ¥¼ä¸æ ·ï¼ææä¸é¢çä¸å±ææï¼å°åååé«/åå¤§ï¼ã</li>
<li><strong>æ åº</strong>ï¼å¨æä¸é¢ï¼é«å°åï¼ï¼éå¸¸å­æ¾çè°ç¨èçç¯å¢ï¼å¨ä¸ä¸ªæ å¸§ä¸­ï¼å¾å°åå¨ã</li>
<li><strong>æ é¡¶</strong>ï¼å¨æä¸é¢ï¼ä½å°åï¼ï¼æ°æ®é¢ç¹è¿è¿åºåºåºæ å¥æ ï¼åå¨å§çã</li>
</ul>
<p>æä»¥ï¼ä¸ºäºçè§£èµ·æ¥æ´é¡ºçï¼å»ºè®®æä»¬å¨èæµ·ä¸­å»ºç«çæ¨¡åå¦ä¸ï¼</p>
<ul>
<li><strong>é«å°åå¨ä¸</strong>ï¼å°åºï¼ã</li>
<li><strong>ä½å°åå¨ä¸</strong>ï¼å¤©ç©ºï¼ã</li>
<li><strong>æ å¸§ççé¿æ¹å</strong>ï¼ä»ä¸å¾ä¸ï¼<strong>åä½å°åçé¿</strong>ã</li>
</ul>
</li>
<li>
<p>æéååå­åå</p>
<p><strong>æå°å»åº¦ï¼å­è (Byte)</strong> å¨è®¡ç®æºéï¼<strong>8 bit (1å­è)</strong> æ¯åå­å¯å¯»åçæå°åä½ã</p>
<p><strong>å®éæ­¥é¿ï¼</strong>    è½ç¶å»åº¦æ¯æ å­è ç»çï¼ä½å¨ 64 ä½ç³»ç»éï¼Ignition è¿ä¸ªèå¸åæå¾å¤§ã ä»å¹²æ´»æ¶ï¼<strong>ä¸ä¼åå­¦åå¥é£æ ·æçå°è±æå»æ 1 ä¸ªå­èã</strong>   ä»<strong>æ¯ä¸æ¬¡ä¼¸æï¼é½è¦æèµ° 8 ä¸ªå­è</strong>ï¼64 bitï¼ãè¿ 8 ä¸ªå­èåèµ·æ¥ï¼æææäºä¸ä¸ªå®æ´ç <strong>æ§½ä½ (Slot)</strong>ã</p>
<p><strong>åå­å¯¹é½ï¼</strong> æ¯ä¸æ¬¡é½è¦æä½ 8 ä¸ªå­èï¼æä»¥ï¼ææä½çå°åï¼é½æ¯8çåæ°ï¼</p>
<p>0  8  16  24 ãããï¼è¿äºæ°å­ä»ä»æ¯ç¤ºæå°åæ¯8çåæ°ï¼</p>
<p>è¿å°±æ¯ <strong>åå­å¯¹é½</strong>ã</p>
<p><strong>æ³¨æï¼</strong> è¿å¹¶ä¸ä»£è¡¨å°å <code>1, 2, 3...7</code> æ¯âç©ºé²âæèâæ²¡ç¨âçã å½ä½ åå°å <code>0</code> åå¥ä¸ä¸ª 64 ä½æéæèæ°æ®æ¶ï¼è¿ä¸ªæéææ°æ®ç¨64bitçåºå¤§çèº«èº¯<strong>å¡«æ»¡</strong>äºä» <code>0</code> å° <code>7</code> çææç©ºé´ã åªä¸è¿ï¼å½æä»¬æ³<strong>æ¾å°</strong>è¿ä¸ªæ°æ®æ¶ï¼æä»¬åªå¨è¿ä¸ªæ°æ®ç<strong>å¤´é¨ï¼é¦å°åï¼</strong> æ¾èµ·ã</p>
<p><strong>å°å 0</strong>ï¼æ¯ç¬¬ä¸ä¸ªæ§½ä½ç<strong>é¨å£</strong>ã<strong>å°å 8</strong>ï¼æ¯ç¬¬äºä¸ªæ§½ä½ç<strong>é¨å£</strong>ã</p>
<p>è¿å°±è§£éäºæä»¬å¨åé¢åå®¹ä¸­æå°ç <strong>Tagged Pointer</strong> åçï¼ å ä¸ºå°ååªå¨ <code>0, 8, 16</code> è¿äº <code>8</code> çåæ°ä¸ï¼æä»¥è¿äºå°åçäºè¿å¶è¡¨ç¤ºï¼<strong>æå 3 ä½éå¸¸æ¯ 0</strong>ã V8 ä¹æ¯çåäºè¿ä¸ç¹ï¼ææ¢æè¿ 3 ä½æªä½ä»ç¨ï¼å­ç±»å Tagï¼ã</p>
<p><strong>æé</strong>   å¦ä½çè§£ï¼</p>
<p>æéå°±æ¯å°åï¼ä¹æä»¥è¯´æ¯æé èä¸æ¯ç´æ¥è¯´å°åï¼æ¯å ä¸º æéæ¶ç´§äºå°åçæ¦å¿µã</p>
<p>âå°åâæ¯ç©çå±é¢çå®¢è§å­å¨ï¼èâæéâæ¯è½¯ä»¶å±é¢çä¸»è§å®ä¹ãæéå¯¹å°åå·ææ¶ç´§åçº¦æä½ç¨ã</p>
<p>åç¡®çè¯´  <strong>æéæ¯å¯¹å°åæ¦å¿µçä¸æ¬¡âæ¶ç´§âåâèµäºè¯­ä¹â</strong>ã</p>
<ul>
<li>
<p><strong>å°å</strong></p>
</li>
<li>
<p><strong>æ¬è´¨</strong>ï¼å®åªæ¯ä¸ä¸ªå·å°å°çæ°å­ç¼å·ï¼æ¯å¦ <code>0x0000FFFF</code>ï¼ã</p>
</li>
<li>
<p><strong>ç¼ºé·</strong>ï¼å®æ²¡æä»»ä½çº¦æãç»ä½ ä¸ä¸ªå°åï¼ä½ æ ¹æ¬ä¸ç¥éé£éä½çæ¯ä»ä¹ã</p>
<ul>
<li>æ¯ 4 ä¸ªå­èçæ´æ°ï¼</li>
<li>è¿æ¯ 1 ä¸ªå­èçå­ç¬¦ï¼</li>
<li>æèæ¯ä¸æ®µå¯æ§è¡çä»£ç ï¼</li>
<li>çè³å¯è½æ¯ä¸ä¸ªæ æçåå¾å¼ï¼</li>
</ul>
</li>
<li>
<p><strong>ç¶æ</strong>ï¼å¦æä½ åªæ¿å°äºä¸ä¸ªå°åï¼ä½ é¢å¯¹çæ¯æªç¥çãæ··ä¹±çåå­ç©ºé´ã</p>
</li>
<li>
<p>**æé **</p>
</li>
<li>
<p><strong>æ¬è´¨</strong>ï¼<strong>æé = å°å + ç±»åçº¦æï¼è§£éæ¹å¼ï¼</strong>ã</p>
</li>
<li>
<p><strong>æ¶ç´§çæ¦å¿µ</strong>ï¼</p>
<p>å½æä»¬å®ä¹ä¸ä¸ªæéï¼æ¯å¦ C++ éç <code>int* p</code> æ V8 éç <code>Tagged Pointer</code>ï¼æ¶ï¼æä»¬å®éä¸æ¯<strong>æ¶ç´§</strong>äºå¯¹é£ä¸ªåå­å°åçæä½æéåçè§£æ¹å¼ã</p>
<ul>
<li>å®åè¯ CPUï¼âå«ä¹±çäºï¼è¿ä¸ªå°åéå­çä¸å®æ¯ <strong>å¯¹è±¡</strong>ï¼èä¸æ¯æ´æ°ãâ</li>
<li>å®åè¯ç¼è¯å¨ï¼âå½ä½ å»è¯»è¿ä¸ªå°åæ¶ï¼è¯·æç§ <strong>8 å­è</strong> ä¸ºåä½å»è¯»ï¼ä¸è¦åªè¯» 1 ä¸ªå­èãâ</li>
</ul>
</li>
</ul>
<p>å¨ V8 ç Ignition ä¸­ï¼è¿ç§âæ¶ç´§âä½ç°å¾æ´å¨é¢ï¼</p>
<ol>
<li>
<p><strong>æ ç­¾ (Tagging)</strong>ï¼</p>
<p>V8 çæéï¼Tagged Pointerï¼å©ç¨æä½ä½ï¼Tag Bitï¼å¼ºè¡è§å®äºè¯­ä¹ã</p>
<ul>
<li>å¦ææåä¸ä½æ¯ <code>0</code>ï¼<strong>æ¶ç´§ä¸ºâç«å³æ°â</strong>ï¼Smiï¼ãä¸éè¦å»åå­éæ¾ï¼å®èªå·±å°±æ¯å¼ã</li>
<li>å¦ææåä¸ä½æ¯ <code>1</code>ï¼<strong>æ¶ç´§ä¸ºâå æéâ</strong>ï¼HeapObjectï¼ãå¿é¡»å»å éæ¾ã</li>
</ul>
</li>
<li>
<p><strong>éèç±» (Map/Hidden Class)</strong>ï¼</p>
<p>å½ä½ é¡ºç V8 çæéæ¾å°å éçå¯¹è±¡æ¶ï¼å¯¹è±¡çç¬¬ä¸ä¸ªå±æ§éå¸¸æ¯ <strong>Map</strong>ï¼éèç±»ï¼ã</p>
<p>è¿å®éä¸æ¯è¿ä¸æ­¥çâæ¶ç´§âï¼</p>
<ul>
<li>âè¿ä¸ªå°åä¸ä»æ¯ä¸ªå¯¹è±¡ï¼èä¸å®æ¯ä¸ä¸ª <strong>æ°ç»</strong>ï¼é¿åº¦æ¯ 10ï¼åç´ ç±»åæ¯...âã</li>
</ul>
</li>
</ol>
<p>æåéè¦æ³¨æï¼è¶å¾åºå±ï¼æ¯å¦å°äºæ±ç¼  å°äºä»£ç è°è¯ ï¼å¯¹äºæéåå°åçåºåï¼å°±è¶è¶è¿äºæ ï¼å¾å¤æ¶åï¼é½æ¯æ··çå«çï¼åºæ¬ä¸é½æ¯ä½¿ç¨æéå°±æ¯å°å è¿ä¸ªæ¬è´¨æ¦å¿µäºãå ä¸ºçº¦æå·²ç»å¥ç¦»ï¼åªå©æ¬è´¨äºã</p>
<p><strong>è°ç¨çº¦å®</strong></p>
<p>æä»¬å¨åé¢å­¦ä¹ äºæ å¸§çç©çç»æï¼åæ°å¨é«å°åï¼è¿åå°åå¨ä¸­é´ï¼åéå¨ä½å°åã</p>
<p>è¿æ¶åï¼æ ä¸­çåçæåååºç°äºï¼ä¸ºä»ä¹è¦è¿ä¹æ¾ï¼æåè¿æ¥æ¾ä¸è¡å  ææ··çæ¾ä¸è¡åï¼</p>
<p>è¿å°±å¼åºäºä¸ä¸ªéè¦çæ¦å¿µ è°ç¨çº¦å®ã</p>
<ul>
<li>
<p>ç®åæ¥è¯´ï¼è°ç¨çº¦å®å°±æ¯ <strong>è°ç¨è (Caller)</strong> å <strong>è¢«è°ç¨è (Callee)</strong> ä¹é´è¾¾æçä¸ä»½ <strong>âåè®®â</strong> æ <strong>âååâ</strong>ã</p>
<p>æ³è±¡ä¸ä¸ä¸¤ä¸ªäººå¨ç©ççï¼</p>
<ul>
<li>
<p><strong>Caller</strong> è¯´ï¼âæä¼æçæå°<strong>ä½ çå·¦æè¾¹</strong>ãâ</p>
</li>
<li>
<p><strong>Callee</strong> è¯´ï¼âå¥½çï¼æä¼è·å°<strong>å·¦æè¾¹</strong>å»æ¥çãâ</p>
<p>è¿å°±æ¯çº¦å®ãå¦æ Caller æåå·¦è¾¹ï¼è Callee è·å»å³è¾¹æ¥ï¼çå°±æäºï¼ç¨åºå´©æºï¼ã</p>
</li>
</ul>
</li>
</ul>
<p>å¨ V8 éï¼è¿ä»½ åè®®/åå è§å®äºä¸ä¸ªææ ¸å¿çé®é¢ï¼</p>
<ol>
<li><strong>åæ°æ¾åªï¼</strong> (ä¼ éæ¹å¼)
<ul>
<li>æ¯æ¾å¨ CPU å¯å­å¨éï¼è¿æ¯åå°æ åå­éï¼</li>
<li>å¦ææ¯åæ ï¼æ¯ä»å·¦å¾å³åï¼è¿æ¯ä»å³å¾å·¦åï¼</li>
</ul>
</li>
<li><strong>ç»ææ¾åªï¼</strong> (è¿åæ¹å¼)
<ul>
<li>å½æ°ç®å®äºï¼ç»ææ¾å¨åªä¸ªå¯å­å¨éå¸¦åå»ï¼ï¼éå¸¸æ¯ç´¯å å¨/raxï¼ã</li>
</ul>
</li>
<li><strong>è°æ¥ææ«å«çï¼</strong> (å æ å¹³è¡¡)
<ul>
<li>åæ°å ç¨çæ ç©ºé´ï¼æ¯ Caller è´è´£åæ¶ï¼è¿æ¯ Callee è´è´£åæ¶ï¼</li>
</ul>
</li>
</ol>
<p><strong>V8çç¹æ®ä¹å¤ï¼åå¾åæ¶</strong></p>
<p>å¨c / c++ ä¸­ï¼ æ åçº¦å®éå¸¸ä¼ä¼åæåå ä¸ªåæ°æ¾å¨ <strong>ç©çå¯å­å¨</strong> éä¼ éï¼è¿æ ·éåº¦ä¼è¾¾å°æè´ã</p>
<p>ä½æ¯å¨V8ç Ignition è§£éå¨éï¼æä»¬çå°åæ°å ä¹é½æ¯ä¹å·§çæåå¨æ ä¸ãè¿æ¯ä¸ºä»ä¹ï¼</p>
<p>å ä¸º V8 æä¸ä¸ªå¹½çµæå« ï¼è¿å°±æ¯ <strong>åå¾åæ¶å¨ (GC)</strong>ã</p>
<ul>
<li><strong>GC çå¨å¹´æ ä¼</strong>ï¼GC éè¦æ¶å»æ«æåå­ï¼ççåªäºå¯¹è±¡è¿æ´»çï¼ææéæåå®ï¼ã</li>
<li><strong>å¯å­å¨æ æ³è·è¸ª</strong>ï¼å¦æåæ°æ£è½å¨åç§ç©çå¯å­å¨éï¼è¿å°±å¾é¾è¿½è¸ªã</li>
<li><strong>V8 çæä¸­æé</strong>ï¼<strong>ç¡®ä¿æ ä¸æä¸ä»½âå¯æ«æâçå¤ä»½ã</strong></li>
</ul>
<p>å³ä½¿æäºåæ°æ¯éè¿å¯å­å¨ä¼ è¿æ¥çï¼ä¸ºäºæ¹ä¾¿ GC æ¸ç¾èä¸²å¼çæ«æï¼V8 éå¸¸ä¹ä¼ä¿è¯è¿äºåæ°å¨æ ä¸æä¸ä¸ªç¡®å®çä½ç½®ï¼æèæå¯å­å¨çå¼âæåâå°æ ä¸ï¼ãè®°å¾åé¢è¯´PCçæ¶åï¼æè¿ä¸æ¬¡ã</p>
<p>so  è¿å°±å½¢æäºæä»¬å¨æ å¸§å¾ä¸­çå°çé£æ ·,åæ°å¨åå­éè¿ç»­æåï¼GC æ«èµ·æ¥éå¸¸èæã</p>
<p><strong>åè¯´æ å¸§çåå­å¸å±</strong></p>
<p>å¨åé¢æä»¬è®²æ å¸§çç»ææ¶ï¼ä»é«å°åå°ä½å°åï¼ä¾æ¬¡æ¯  åæ°åº--åºå®å¤´é¨åº--å·¥ä½åºï¼ä½æ¯</p>
<p>å¯¹äºæ å¸§çåçåå­æ®µçææèï¼å¹¶æ²¡æè¯¦ç»çè¯´æã ç°å¨æä»¬æäºè¶³å¤çéºå«ï¼å¯ä»¥è¯¦ç»äºè§£äºã</p>
<p>æä»¬éè¦æ<strong>æ¶é´é¡ºåº</strong>èµ°ä¸éæµç¨ã</p>
<p>è¿å¯¹äºçè§£ FPï¼æ å¸§æéï¼è¿ä¸ªâçç¢âè³å³éè¦ã</p>
<p><strong>ç¬¬ä¸é¶æ®µï¼è°ç¨èåå¤å·¥ä½</strong></p>
<p>è°ç¨èå¨æ§è¡ <code>CALL</code> æä»¤ä¹åï¼éè¦ååå¤å¥½è´¡åï¼</p>
<ol>
<li>
<p><strong>Push åæ°</strong>ï¼è°ç¨èæåæ°ï¼Receiver, a0, a1...ï¼æé¡ºåºåå¥æ ã</p>
<ul>
<li><em>(è¿æ¯ Caller åæ¨çåå­ï¼å±äº Caller çæ å¸§èå´ï¼ä½ä¾ Callee ä½¿ç¨)</em></li>
</ul>
</li>
<li>
<p><strong>æ§è¡ CALL æä»¤</strong>ï¼CPU èªå¨å° <strong>è¿åå°å (Return Address)</strong> åå¥æ é¡¶ï¼å¹¶è·³è½¬å° Callee çä»£ç å¤ã</p>
<ul>
<li><em>(æ­¤æ¶ï¼FP æéä¾ç¶æå Caller çèåºåç¹)</em></li>
</ul>
</li>
</ol>
<p><strong>ç¬¬äºé¶æ®µï¼è¢«è°ç¨èæ¥æ</strong></p>
<p>æ§å¶ææ¥å°äº Ignitionï¼è¢«è°ç¨èï¼æä¸­ï¼å®è¿é¨åç<strong>å¤´ç­å¤§äº</strong>å°±æ¯å»ºç«èªå·±çå®é¨ï¼æ å¸§ï¼ï¼</p>
<ol>
<li><strong>Push Caller's FP</strong>ï¼Ignition åçç¬¬ä¸ä»¶äºï¼å°±æ¯ææ§ç FPï¼ä¸ä¸å±çåºåç¹ï¼åå¥æ ä¸­ä¿å­èµ·æ¥ã
<ul>
<li><em>(è¿ä¸æ­¥å½¢æäº Saved FPï¼ä¹å°±æ¯æ å¸§ä¸­é´çé£ä¸ªè¿æ¥ç¹)</em></li>
</ul>
</li>
<li><strong>Set New FP</strong>ï¼Ignition æå½åçæ é¡¶æé (SP) èµå¼ç» FPã
<ul>
<li><em>(ä»æ­¤ï¼FP æåäº Saved FPãæ°çæ å¸§åºåç¹æ­£å¼å»ºç«)</em></li>
</ul>
</li>
<li><strong>Push Fixed Header</strong>ï¼æ¥çï¼Ignition ä¾æ¬¡åå¥ ContextãFunctionãBytecodeArrayãBytecodeOffset ç­åºå®å­æ®µã</li>
<li><strong>Allocate Locals</strong>ï¼æåï¼æ ¹æ® Frame Sizeï¼ä¸æ¬¡æ§ææ é¡¶æé (SP) å¾ä¸ç§»ï¼ä¸ºå±é¨åéï¼r0, r1...ï¼çåºç©ºé´ï¼å¹¶åå§åä¸º <code>undefined</code> æ <code>The Hole</code>ã</li>
</ol>
<h3 id="_"></h3>
<p>æäºè¿ä¸ªæµç¨ï¼æä»¬åçâæ·å£å½å±âå°±éå¸¸æ¸æ°äºï¼</p>
<ul>
<li>
<p><strong>FP åå¶ä¸æ¹ (åæ°ãè¿åå°å)</strong>ï¼ è½ç¶ç©çä¸å FP è¿å¨ä¸èµ·ï¼ä½å®ä»¬æ¯ <strong>Caller</strong> å¨ç¬¬ä¸é¶æ®µçä¸çâéäº§âã</p>
<ul>
<li>åæ°æ¯ Caller å¸¦æ¥çã</li>
<li>è¿åå°åæ¯ Caller å¸¦æ¥çã</li>
<li>Saved FP æ¯ Callee ä¸ºäºä¿æ¤ Caller èå­çã</li>
</ul>
</li>
<li>
<p><strong>FP ä¸æ¹ (åºå®å¤´é¨ãå·¥ä½åº)</strong>ï¼ è¿æ¯ <strong>Callee</strong> å¨ç¬¬äºé¶æ®µäº²æåå»ºçâèµäº§âã</p>
<ul>
<li>Context æ¯ Callee æ¾æ¥çã</li>
<li>å±é¨åéæ¯ Callee åéçã</li>
</ul>
</li>
</ul>
<p>è¿æ ·ï¼æä»¬åæ¥çæ å¸§çç»æï¼çè§£ä¸çé»è¾å°±å®å¨é­ç¯äºï¼ <strong>Caller ç»èµæºï¼åæ°ï¼ --- ç¡¬ä»¶ç»éè·¯ï¼è¿åå°åï¼ ---  Callee å»ºå°åºï¼ä¿å­æ§FPï¼ ---  Callee å»ºæ¿å­ï¼å¤´é¨ååéï¼ã</strong></p>
<p><strong>FPååç§»é</strong></p>
<p>å¨åé¢æä»¬å­¦ä¹ æ å¸§çåºå®å¤´é¨ä¸­çå­æ®µæ¶ï¼æä»¬ä½¿ç¨äº FPå åç§»å¼ çè¡¨ç¤ºæ¹å¼ã</p>
<p>ç±ç¢ç£¨çæåè¯å®ä¼æçé®ï¼<strong>ä¸ºä»ä¹ææä¸è¥¿é½è¦ç¯ç FP çï¼ä¸ºä»ä¹æ¯è¿äºç¹å®çæ°å­ï¼FP éé¢å°åºè£äºä»ä¹ï¼</strong></p>
<ol>
<li><strong>ä¸ºä»ä¹é FP (Frame Pointer) ååºåï¼</strong></li>
</ol>
<p>ä½ å¯è½ä¼é®ï¼âæ é¡¶æé <strong>SP (Stack Pointer)</strong> ä¹æ¯ä¸ªæéï¼èä¸å®å°±å¨æ é¡¶ï¼ä¸ºä»ä¹ä¸ç¨ SP æ¥æ¾æ°æ®ï¼éè¦ä¸é¨ç»´æ¤ä¸ä¸ª FP å¢ï¼â</p>
<p><strong>åå å°±æ¯ï¼SP æ¯âå¨âçï¼FP æ¯âéâçã</strong></p>
<ul>
<li>
<p><strong>SP çå¨å¦è±å</strong>ï¼</p>
<p>å¨å½æ°æ§è¡è¿ç¨ä¸­ï¼Ignition å¯è½ä¼é¢ç¹å°å¥æ ãåºæ ï¼æ¯å¦åå¥ä¸´æ¶åéãåå¤å­å½æ°åæ°ï¼ã</p>
<p>è¿å°±å¯¼è´ SP çä½ç½®ä¸ç´å¨åã</p>
<p>å¦æç¨ SP ååºåï¼å½ä½ æ¾ <code>åé a</code> æ¶ï¼ä¸ä¸è¡ä»£ç å¯è½æ¯ <code>[SP + 8]</code>ï¼ä¸ä¸è¡ä»£ç å ä¸ºåäºä¸ªä¸´æ¶å¼ï¼å°±åæ <code>[SP + 16]</code> äºãç¼è¯å¨è®¡ç®èµ·æ¥ä¼ç¯æã</p>
</li>
<li>
<p><strong>FP çéå¦ç«çª</strong>ï¼</p>
<p>ä¸æ¦æ å¸§å»ºç«å®æ¯ï¼Prologue ç»æï¼ï¼å¨æ´ä¸ªå½æ°æ§è¡æé´ï¼<strong>FP æéå°±æ¯éå¨æ å¸§çåºå®ä½ç½®ï¼Saved FP é£ä¸ªæ§½ä½ï¼ï¼é·æä¸å¨ã</strong></p>
<p>æ­¤æ¶ï¼æä»¬ä»¥ FP ä¸ºåç¹ï¼åä¸ä¸çï¼</p>
<p><strong>å¾ä¸çï¼åå°åº/é«å°åï¼</strong>ï¼ä¸ç®¡æ é¡¶æä¹åï¼åæ° <code>a0</code> æ°¸è¿å¨ FP <strong>å¾ä¸æ°</strong> ç¬¬ 2 æ ¼çä½ç½®ï¼åç§»éæ¯æ­£æ°ï¼å¦ <code>FP + 16</code>ï¼ã</p>
<p><strong>å¾ä¸çï¼åå¤©ç©º/ä½å°åï¼</strong>ï¼ä¸ç®¡æ é¡¶æä¹åï¼åé <code>r0</code> æ°¸è¿å¨ FP <strong>å¾ä¸æ°</strong> ç¬¬ 5 æ ¼çä½ç½®ï¼åç§»éæ¯è´æ°ï¼å¦ <code>FP - 40</code>ï¼ã</p>
</li>
</ul>
<p><strong>æä»¥</strong>ï¼FP æä¾äºä¸ä¸ª<strong>éæçãç»å¯¹ç</strong>åèåæ ç³»ã</p>
<ol start="2">
<li>**FPåå°åååå®¹ **</li>
</ol>
<p>è¿æ¯åæ¥è§¦çæåï¼çè§£æ å¸§é¾è¡¨æå®¹æè¿·ç³çå°æ¹ã</p>
<p>æä»¬è¦åºåä¸ä¸ªæ¦å¿µï¼</p>
<ul>
<li><strong>FP å¯å­å¨</strong>ï¼</li>
</ul>
<p>å¯ä»¥ç®åçè§£ä¸ºï¼è¿æ¯ CPU éçä¸ä¸ªç©çé¨ä»¶ï¼æ Ignition çèææéï¼ã</p>
<ul>
<li><strong>FP ä¸­çåå®¹</strong>ï¼</li>
</ul>
<p>FPä¸­çåå®¹å°±æ¯ ä¸ä¸ªåå­å°åã</p>
<p>è¿ä¸ªåå­å°åæ¯ä¸ªæéï¼æåå½åæ å¸§ä¸­çä¸ä¸ªå­æ®µï¼</p>
<p>åæ¶ï¼è¿ä¸ªåå­å°å/æéï¼ä¹æ¯å½åæ å¸§ç <strong>âé¶ç¹â</strong>ãå³ <code>Offset = 0</code>ã</p>
<ul>
<li><strong>FP æåçåå­å°åéå­çåå®¹</strong>ï¼</li>
</ul>
<p>é£ä¹ è¿ä¸ªæ å¸§ä¸­çå­æ®µï¼éé¢çåå®¹æ¯ä»ä¹ï¼</p>
<p><strong>ç­æ¡æ¯ï¼Caller's FP (è°ç¨èç FP)ã</strong></p>
<p>å³ï¼ä¸ä¸å±æ å¸§çåºåå°åã</p>
<p><strong>è¿åæ¶ä¹æ¯âæ åæº¯âçåçï¼</strong></p>
<ul>
<li>å½å FP æå <code>Saved FP</code>ã</li>
<li><code>Saved FP</code> éå­ç <code>ä¸ä¸å± FP</code>ã</li>
<li><code>ä¸ä¸å± FP</code> éå­ç <code>ä¸ä¸å± FP</code>ã</li>
<li>...</li>
<li>è¿å°±å½¢æäºä¸æ¡<strong>é¾è¡¨</strong>ãè°è¯å¨ï¼Debuggerï¼å°±æ¯é¡ºçè¿æ¡é¾å­ï¼ä¸å±å±å¾ä¸ç¬ï¼ææå°åºäºå®æ´çè°ç¨æ ã</li>
</ul>
<ol start="3">
<li><strong>åç§»é (Offset) æ¯æä¹ç¡®å®çï¼</strong></li>
</ol>
<p>ææäº FP æ¯é¶ç¹ï¼é£ä¹ï¼å¯¹äºåæ°ååéçå¯»åï¼å°±éå¸¸å®¹æçè§£äºã</p>
<p>è®©æä»¬ç«å¨ FP è¿ä¸ªé¶ç¹ï¼å¼å§å·¡è§ï¼</p>
<p><strong>A. å¾ä¸çï¼Caller çä¸çéäº§ (å ä¸ºæä»¬ä½¿ç¨é«å°åå¨ä¸ï¼ä½å°åå¨ä¸çæ¨¡å¼)</strong></p>
<p>è¿éæ¯å°å <strong>å¢å </strong> çæ¹åï¼Offset æ¯ <strong>æ­£æ° +</strong>ï¼ï¼å ä¸ºæä»¬å¨å¾é«å°åèµ°ã</p>
<ul>
<li><strong>Offset     +0 (<code>[FP + 0]</code>)</strong>ï¼ å°±æ¯èä¸ãè¿éå­çæ¯ <strong>Saved FP</strong>ã</li>
<li><strong>Offset     +8 (<code>[FP + 8]</code>)</strong>ï¼ <strong>å¾ä¸</strong> èµ° 1 æ ¼ã è¿éæ¯ <strong>Return Address</strong>ã <em>(ä¸ºä»ä¹æ¯ +8ï¼å ä¸ºå¾é«å°åèµ°äº 8 å­èã)</em></li>
<li><strong>Offset     +16 (<code>[FP + 16]</code>)</strong>ï¼ <strong>åå¾ä¸</strong> èµ° 1 æ ¼ã è¿éæ¯ <strong>Receiver (this)</strong>ã <em>(æ³¨ï¼è¿æ¯é·æä¸å¨çä¸åº§ï¼ç¦» FP æè¿çåæ°ã)</em></li>
<li><strong>Offset     +24 (<code>[FP + 24]</code>)</strong>ï¼ <strong>åå¾ä¸</strong> èµ° 1 æ ¼ã è¿éæ¯ <strong>ç¬¬ä¸ä¸ªæ¾å¼åæ° (Arguments a0)</strong>ã <em>(æ³¨ï¼å¦æææ´å¤åæ° a1, a2... ä¼ç»§ç»­å¾ä¸æå¨ +32, +40...)</em></li>
</ul>
<p><strong>B. å¾ä¸çï¼Callee èªå·±çèµäº§ (ä½å°ååº)</strong></p>
<p>å³äºåç§»éçå·ä½å¼ï¼å¨åé¢ï¼ç¹å«è¯´ææ¯ç¨äº  <strong>ç¤ºæ</strong>  ï¼  V8æºç ä¸­çåç§»å¦ä¸ï¼ææ¶å¯ä»¥ä½ä¸ºç¡®å®å¼ï¼ä½æ¯ä»¥åå¾æ<strong>å¯è½ä¼æ´æ¹</strong>ã</p>
<blockquote>
<p><strong>FP (åºå)</strong></p>
<p><strong>[FP - 8]</strong>: <code>StandardFrameConstants::kContextOffset</code> -&gt; <strong>Context</strong></p>
<p><strong>[FP - 16]</strong>: <code>StandardFrameConstants::kFunctionOffset</code> -&gt; <strong>Function</strong></p>
<p><strong>[FP - 24]</strong>: <code>InterpretedFrameConstants::kBytecodeArrayFromFp</code> -&gt; <strong>BytecodeArray</strong> (è§£éå¨ç¹æ)</p>
<p><strong>[FP - 32]</strong>: <code>InterpretedFrameConstants::kBytecodeOffsetFromFp</code> -&gt; <strong>BytecodeOffset (PC)</strong></p>
<p><strong>[FP - 40]</strong>: <code>InterpretedFrameConstants::kRegisterFileFromFp</code> -&gt; <strong>r0 (Register 0)</strong> (å·¥ä½åºèµ·ç¹)</p>
</blockquote>
<p>è¿éä¹éè¦å ä¸ä¸ªéå®ï¼</p>
<p><strong>å¨ 64 ä½ç³»ç»ä¸ï¼Ignition è§£éå¨æ å¸§çåºå®å¤´é¨å¸å±éå¸¸å¦ä¸ï¼</strong></p>
<p>è¿éæ¯å°å <strong>åå°</strong> çæ¹åï¼Offset æ¯ <strong>è´æ° -</strong>ï¼ï¼å ä¸ºæä»¬å¨å¾ä½å°åï¼æ é¡¶ï¼æ¹åç¬ã</p>
<ul>
<li><strong>Offset     -8 (<code>[FP - 8]</code>)</strong>ï¼ <strong>å¾ä¸</strong> ç¬ 1 æ ¼ã è¿éæ¯ <strong>Context</strong>ã <em>(ä¸ºä»ä¹æ¯è´æ°ï¼å ä¸ºç¦»å¤©ç©ºæ´è¿äºï¼å°ååå°äºã)</em></li>
<li><strong>Offset    -16 (<code>[FP - 16]</code>)</strong>ï¼ <strong>åå¾ä¸</strong> ç¬ 1 æ ¼ã è¿éæ¯ <strong>Function</strong>ã</li>
<li><strong>Offset    -24 (<code>[FP - 24]</code>)</strong>ï¼ <strong>åå¾ä¸</strong> ç¬ 1 æ ¼ã è¿éæ¯ <strong>BytecodeArray</strong>ã</li>
<li><strong>Offset    -32 (<code>[FP - 32]</code>)</strong>ï¼ <strong>åå¾ä¸</strong> ç¬ 1 æ ¼ã è¿éæ¯ <strong>BytecodeOffset (PC)</strong>ã <em>(æ³¨ï¼å°è¿éï¼åºå®å¤´é¨ç»æ)</em></li>
<li><strong>Offset     -40 (<code>[FP - 40]</code>)</strong>ï¼ <strong>åå¾ä¸</strong> ç¬ 1 æ ¼ã ç»äºå°äº <strong>å·¥ä½åº</strong>ãè¿éæ¯ <strong>r0</strong>ã</li>
</ul>
</li>
</ul>
<hr>
<p>ignitionè§£éå¨çç¬¬ä¸é¨åï¼å·²ç»å®æäºï¼åé¢å°æ¯ignitionç¯çç¬¬äºé¨åBytecodeGeneratorã</p>
<p>æ¬æ³æ§å¶ç¯å¹ï¼ä½æ¯ä¾æ§æ¯å°äºä¸ä¸ä¸åå¤å­ï¼è¿é¨ååå®¹ï¼é¾åº¦ä¸å¤§ï¼æ·±åº¦ä¸æ·±ï¼ä¸»è¦é½æ¯ä¸äºåç½®ååºç¡ç¥è¯ãæå´è¶£çæåï¼å¤è¯»å éï¼é½å¯ä»¥çè§£çã æè§å¾  èµ·ç æ¯è§£æç¯å®¹æçè§£å¤äºã</p>
<p>æ¬æé¦åäºï¼ <a href="https://juejin.cn/user/565561530002222/posts" target="_blank" rel="noopener nofollow">æéç¤¾åº</a></p>
<p>åæ­¥åè¡¨äºï¼ <a href="https://blog.csdn.net/f20171110?type=blog" target="_blank" rel="noopener nofollow">csdn</a></p>
<p><a href="https://www.cnblogs.com/f20171110" target="_blank">åå®¢å­</a></p>
<p><strong>ç å­è½ä¸æ ç¥è¯èç»çæ¢³çæ´æ¯ä¸æ ï¼ä½æ¯ç¥è¯çä¼ æ­æ´éè¦ï¼</strong></p>
<p><strong>æ¬¢è¿è½¬è½½ï¼è¯·ä¿æå¨æå®æ´ã</strong></p>
<p><strong>è°¢ç»çæ®µæå½ã</strong></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 19:19">2026-02-04 19:19</span>&nbsp;
<a href="https://www.cnblogs.com/f20171110">ç¨æ·æ°</a>&nbsp;
éè¯»(<span id="post_view_count">3</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19576264);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19576264', targetLink: 'https://www.cnblogs.com/f20171110/p/19576264', title: 'V8å¼æ ç²¾åæ¼«æ¸¸æå--Ignitionç¯(ä¸) æä»¤ æ å¸§ æ§½ä½ è°ç¨çº¦å® åå­å¸å± åºç¡åå®¹' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ LLVM Passå¿«éå¥é¨(å)ï¼ä»£ç ææ¡© ]]></title>
    <link>https://www.cnblogs.com/ClownLMe/p/19575719</link>
    <guid>7b29632e2a98bce4814cd7b604ea715d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ClownLMe/p/19575719" title="åå¸äº 2026-02-04 17:49">
    <span role="heading" aria-level="2">LLVM Passå¿«éå¥é¨(å)ï¼ä»£ç ææ¡©</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        ä»0å°1ï¼å¿«éå¥é¨ LLVM pass ç¼å
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ä»£ç ææ¡©">ä»£ç ææ¡©</h1>
<p>é¡¹ç®éæ±ï¼å¨å½æ°è¿è¡æ¶æå°åºè¿è¡çå½æ°å</p>
<h1 id="é¡¹ç®ç®å½å¦ä¸">é¡¹ç®ç®å½å¦ä¸</h1>
<pre><code>/MyProject
âââ CMakeLists.txt # CMake éç½®æä»¶
âââ build/ #æå»ºç®å½
â   âââ test.c #æµè¯ç¼è¯ä»£ç 
âââ mypass3.cpp # pass é¡¹ç®ä»£ç 
</code></pre>
<h3 id="ä¸æµè¯ä»£ç ç¤ºä¾">ä¸ï¼æµè¯ä»£ç ç¤ºä¾</h3>
<p><strong>test.c</strong></p>
<pre><code class="language-c">#include &lt;stdio.h&gt;

void func_A() {
    int a = 1;
}

void func_B() {
    func_A();
}

int main() {
    printf("hello world!\n");
    func_A();
    func_B();
    return 0;
}
</code></pre>
<h3 id="äºç¼åpass">äºï¼ç¼åPass</h3>
<p><mark>å¶ä»çåºå®çæ¨¡æ¿ä¹åæç« æ³¨éæï¼è¿éæåªæ³¨éå½åé¡¹ç®éè¦çé¨å</mark><br>
<strong>ä»£ç æµç¨ï¼</strong> éåæä»¤å¹¶å¹é<code>ADD</code>æä»¤-&gt;æ¿æ¢ä¸º<code>sub</code>æä»¤</p>
<pre><code class="language-cpp">#include "llvm/IR/PassManager.h"
#include "llvm/Passes/PassBuilder.h"
#include "llvm/Passes/PassPlugin.h"
#include "llvm/Support/raw_ostream.h"
#include "llvm/IR/Function.h"
#include "llvm/IR/BasicBlock.h"
#include "llvm/IR/Instruction.h"
#include "llvm/IR/Instructions.h"
#include "llvm/IR/IRBuilder.h" 

using namespace llvm;

namespace {

struct mypass3 : public PassInfoMixin&lt;mypass3&gt; {
    
    PreservedAnalyses run(Function &amp;F, FunctionAnalysisManager &amp;) {
        //è¿æ»¤å½æ°
        //è¿æ»¤æprintfåprintfæå³çå½æ°ï¼é²æ­¢å¨printfä¸­æå¥printfé æéå½ï¼æ­»å¾ªç¯ï¼
        if(F.isDeclaration() || F.getName().starts_with("_") || F.getName().contains("printf")){
            return PreservedAnalyses::all();
        }
        errs() &lt;&lt; "handle func:" &lt;&lt; F.getName() &lt;&lt; "\n";
		
		//è·åæ¨¡å
        Module *M = F.getParent();
        //è·åæ¨¡åä¸ä¸æ
        //ä¸ä¸æä¸­åå«äºæ°æ®çç±»å
        LLVMContext &amp;Ctx = M-&gt;getContext();
        
        //ä¸é¢æ¯åå»ºå½æ°ï¼ç±»æ¯javaåå°ï¼æèfridaçhook
        //å®ä¹printfçåæ°ç±»åï¼ç¸å½äºå½æ°æ¬å·ä¸­çåå®¹ï¼è¿éçPointerTypeæ¯æéç±»å
        std::vector&lt;Type*&gt; printfArgs = {PointerType::getUnqual(Ctx)};
		//å®ä¹å½æ°ç±»åï¼è¿éç¸å½äºå®ä¹ï¼int (void*, ...)
        FunctionType *printfType = FunctionType::get(
            Type::getInt32Ty(Ctx),//å½æ°è¿åå¼ç±»å
            printfArgs,//å½æ°çåæ°ç±»å(vector)
            true//æ¯å¦æ¯å¯ååæ°
        );
		//å¦æprintfå­å¨åå¼ç¨ï¼å¦æä¸å­å¨ï¼ååå»ºä¸ä¸ªæ°çprintf
        FunctionCallee printfFunc = M-&gt;getOrInsertFunction("printf", printfType);
		
		//ä¸é¢æ¯æå¥å½æ°
		//å°ä¿®æ¹çä½ç½®å®ä½å°è¦ææ¡©å½æ°çå¤´é¨
        IRBuilder&lt;&gt; builder(&amp;F.getEntryBlock().front());
        //å£°æå¨å±åéï¼è¿éæ¯è¦ä¼ ç»printfçæ ¼å¼åå­ç¬¦ä¸²ï¼
        Value* formatStr = builder.CreateGlobalStringPtr("&gt;&gt; enter function %s &lt;&lt;\n", "my_format");
        //å£°æå¨å±åéï¼è¿éå®ä¹äºå½æ°åç§°çå­ç¬¦ä¸²åé
        Value* funcName = builder.CreateGlobalStringPtr(F.getName(), "my_func_name");
        //å°ä¸é¢å®ä¹çå®éåæ°ä¼ å¥
        std::vector&lt;Value*&gt; printfArgsVec = {formatStr, funcName};
        //åå»ºå½æ°è°ç¨
        builder.CreateCall(printfFunc, printfArgsVec);
        
        return PreservedAnalyses::none();
    }
};

} 

extern "C" LLVM_ATTRIBUTE_WEAK ::llvm::PassPluginLibraryInfo
llvmGetPassPluginInfo() {
    return {
        LLVM_PLUGIN_API_VERSION,
        "mypass3",
        "v0.1",
        [](PassBuilder &amp;PB) {
            PB.registerPipelineParsingCallback(
                [](StringRef Name, FunctionPassManager &amp;FPM,
                   ArrayRef&lt;PassBuilder::PipelineElement&gt;) {
                    if (Name == "mypass3") {
                        FPM.addPass(mypass3());
                        return true;
                    }
                    return false;
                });
        }};
}
</code></pre>
<h3 id="ä¸passçæå»º">ä¸ï¼Passçæå»º</h3>
<p><mark><strong>ä¸é¢å¼ç¨çæ¯ä¹åæç« çåå®¹</strong></mark><br>
æå»ºLLVM Passéè¦å<code>CMakeLists.txt</code>æå»ºå£°æ</p>
<h5 id="1-éç½®cmakeéç½®æä»¶">1. éç½®CMakeéç½®æä»¶</h5>
<p><strong>CMakeLists.txt</strong><br>
ä¸é¢ç<code>cmake</code>éç½®å¯ä»¥ç´æ¥æ¿å»ç¨ï¼æå·²ç»æ æ³¨å¥½éè¦ä¿®æ¹çä½ç½®</p>
<pre><code class="language-python">#cmake çæ¬ï¼å¯éè¿ cmake --version å¤æ­
cmake_minimum_required(VERSION 4.1.1) #----&gt;ä¿®æ¹ cmakeçæ¬å·
#é¡¹ç®åå­
project(mypass3) #----&gt;ä¿®æ¹ é¡¹ç®åç§°

#å¯¼å¥é¡¹ç®ç LLVM cmake éç½®æä»¶è·¯å¾(å¦ææ ¹æ®æä¹åæç« å®è£è¿éå°±ç¸å)
set(LLVM_DIR "D:/LLVM/llvm-project/build/lib/cmake/llvm")#----&gt;ä¿®æ¹ llvm cmakeéç½®è·¯å¾
#å¯»æ¾ LLVM çåæä»¶
#REQUIRED æ¾ä¸å° LLVM ååæ­¢æå»º
#å¼ºå¶ä½¿ç¨ LLVM å®è£æ¶çæçéç½®æä»¶è¿è¡å®ä½
find_package(LLVM REQUIRED CONFIG)
#å° LLVM ç CMake æ¨¡åè·¯å¾æ·»å å°å½å CMake æç´¢è·¯å¾ä¸­ï¼ä»¥ä¾¿åç»­ä½¿ç¨ include(AddLLVM)ã
list(APPEND CMAKE_MODULE_PATH "${LLVM_CMAKE_DIR}")

#å¼å¥ LLVM æä¾çä¸ç¨ CMake å®
include(AddLLVM)
#å° LLVM çå¤´æä»¶ç®å½ï¼å¦ llvm/IR/Function.hï¼å å¥ç¼è¯å¨çæç´¢è·¯å¾
include_directories(${LLVM_INCLUDE_DIRS})
#å¯¼å¥ LLVM ç¼è¯æ¶ä½¿ç¨çå®å®ä¹
add_definitions(${LLVM_DEFINITIONS})
#è®¾ç½® C++ æ åä¸º C++17ã(è¿éå¦æä¸ç¨17ç¼è¯ä¼æ¥é)
set(CMAKE_CXX_STANDARD 17)
#å¼ºå¶è¦æ±å¿é¡»æ¯æ C++17ï¼å¦æç¼è¯å¨ä¸æ¯æåå¤±è´¥ã
set(CMAKE_CXX_STANDARD_REQUIRED ON)

#åå»ºä¸ä¸ªæ¨¡ååçåº(.dll)
add_library(mypass3 MODULE mypass3.cpp) #----&gt;ä¿®æ¹ é¡¹ç®åç§°ï¼æä»¶å
#windowsä¸ç¨ä¼æ¥éï¼å¯¼åºç¬¦å·
#LLVM Pass éè¦æ´é²ä¸äºç¹å®çå¥å£ç¹ï¼å¦ getAnalysisUsageï¼ç» opt å·¥å·è°ç¨ã
set_target_properties(mypass3 PROPERTIES WINDOWS_EXPORT_ALL_SYMBOLS ON) #----&gt;ä¿®æ¹ é¡¹ç®åç§°
# æå®è¯¥ Pass éè¦é¾æ¥ç LLVM æ ¸å¿ç»ä»¶ã 
# LLVMCore: æä¾ IRãFunctionãModule ç­æ ¸å¿ç±»ã 
# LLVMSupport: æä¾åç§è¾å©å·¥å·ç±»ï¼å¦ errs() è¾åºï¼ã
target_link_libraries(mypass3 LLVMCore LLVMSupport) #----&gt;ä¿®æ¹ é¡¹ç®åç§°ï¼æä»¶å  
# ä¸ºè¯¥ç®æ è®¾ç½®ç¹å®çç¼è¯å¨éé¡¹ã 
# /utf-8: åè¯ MSVC ç¼è¯å¨ä½¿ç¨ UTF-8 ç¼ç å¤çæºä»£ç ï¼é²æ­¢ä¸­ææ³¨éå¼èµ·çä¹±ç æç¼è¯éè¯¯ã  
target_compile_options(mypass3 PRIVATE /utf-8)#----&gt;ä¿®æ¹ é¡¹ç®åç§°ï¼æä»¶å
</code></pre>
<h5 id="2ç¼è¯å¹¶æå»ºpass">2.ç¼è¯å¹¶æå»ºPass</h5>
<p><strong>æå¼visual studio<code>çå·¥ä½å°ï¼æè¿éæ¯</code>x64 Native Tools Command Prompt for VS 2022`</strong></p>
<p>è¿å°<code>build</code>ç®å½</p>
<pre><code class="language-bash">#æå»ºé¡¹ç®
#å¶ä¸­-DCMAKE_BUILD_TYPE=RelWithDebInfoä¸éä¼æ¥éï¼ç±äºæä¹åç¼è¯çæ¯å¸¦ç¬¦å·çrelaseçæ¬
cmake -G "Ninja"  -DCMAKE_BUILD_TYPE=RelWithDebInfo ..
#ç¼è¯
ninja
</code></pre>
<p>æååºç°ä¸é¢æç¤ºï¼å³ä¸ºç¼è¯æå</p>
<pre><code class="language-bash">[2/2] Linking CXX shared module mypass3.dll
</code></pre>
<h3 id="åä½¿ç¨ææ¡©passå¯¹æºç è¿è¡ææ¡©">åï¼ä½¿ç¨ææ¡©Passå¯¹æºç è¿è¡ææ¡©</h3>
<p>è¿å°<code>build</code>ç®å½</p>
<pre><code class="language-bash">#æ.cæä»¶ç¼è¯ä¸º.ll
#-O1 ä½¿ç¨O1ä¼åï¼è¿éæå°è¯-O0ä¸ä¼åï¼ä¼å¯¼è´æçpassæ æ³åºç¨ï¼
#-Xclang -disable-llvm-passes ä¸ä½¿ç¨é»è®¤çpassä¼å
clang -S -emit-llvm -O1 -Xclang -disable-llvm-passes test.c -S -o test.ll

#ä½¿ç¨pass
opt -load-pass-plugin=mypass3.dll -passes=mypass3  test.ll -S -o test_opt.ll

#ç¼è¯ä½¿ç¨passåçexe
clang test_opt.ll -o test_opt.exe
#ç¼è¯ä½¿ç¨passåçexe
clang test.ll -o test.exe
</code></pre>
<p><strong>è¾åºç»æ</strong><br>
<code>è¿è¡test.exe</code>ï¼<strong>ä¸ä½¿ç¨</strong>passï¼è¾åºç»æå¦ä¸ï¼</p>
<pre><code>hello world!
</code></pre>
<p><code>è¿è¡test_opt.exe</code>ï¼<strong>ä½¿ç¨</strong>passåï¼è¾åºç»æå¦ä¸ï¼</p>
<pre><code>&gt;&gt; enter function main &lt;&lt;
hello world!
&gt;&gt; enter function func_A &lt;&lt;
&gt;&gt; enter function func_B &lt;&lt;
&gt;&gt; enter function func_A &lt;&lt;
</code></pre>
<p><strong>æä»¬æåå¨æä»¬è°ç¨å½æ°ä¹åææ¡©ï¼æå°åºè°ç¨çå½æ°</strong></p>
<p><strong>å¦æâ¤åæ¬¢â¤æ¬ç³»åæç¨ï¼å°±ç¹ä¸ªå³æ³¨å§ï¼åç»­ä¸å®ææ´æ°~</strong></p>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/ClownLMe/" target="_blank">ClownLMe</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/ClownLMe/p/19575719" target="_blank">https://www.cnblogs.com/ClownLMe/p/19575719</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.004166666666666667" data-date-updated="2026-02-04 17:55">2026-02-04 17:49</span>&nbsp;
<a href="https://www.cnblogs.com/ClownLMe">ClownLMe</a>&nbsp;
éè¯»(<span id="post_view_count">12</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19575719);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19575719', targetLink: 'https://www.cnblogs.com/ClownLMe/p/19575719', title: 'LLVM Passå¿«éå¥é¨(å)ï¼ä»£ç ææ¡©' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ milkupï¼æ¡é¢ç«¯ markdown AIç»­ååå³æ¶æ¸²æ ]]></title>
    <link>https://www.cnblogs.com/Kay-Larry/p/19575577</link>
    <guid>f68daed37a0d30b5c3f3b9ac6f25f1fb</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Kay-Larry/p/19575577" title="åå¸äº 2026-02-04 17:23">
    <span role="heading" aria-level="2">milkupï¼æ¡é¢ç«¯ markdown AIç»­ååå³æ¶æ¸²æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>Hiï¼æåä»¬å¥½ï¼ææ¯å¾·è±åæ¯ï¼åæ®µæ¶é´ç»å¤§å®¶å¸¦æ¥ä¸ä¸ªæ¡é¢ç«¯çå¼æº markdown ç¼è¾å¨ï¼å½æ¶æ¬è¨è¦å¹²ç¿» typora çé£ä¸ªï¼ä½ è¿æå°è±¡åï¼ åææ¯ï¼<a href="https://juejin.cn/post/7528712837885952041" target="_blank" rel="noopener nofollow">å¹²ç¿» Typoraï¼MilkUpï¼å®å¨åè´¹çæ¡é¢ç«¯ Markdown ç¼è¾å¨ï¼</a>ï¼è¿ç¯æç« å±æåäº 16 ä¸æ¬¡ï¼æ 12000+ äººå´è§ï¼å¨ç¤¾åºåæ¶è·äºå°èå´çç¨æ·ï¼ç®åå®ç github star å·²æ 600+ã</p>
<p>å¨æ­¤æé´ï¼æä»¬ å¢é(<a href="https://github.com/Auto-Plugin" target="_blank" rel="noopener nofollow">Auto-Plugin</a>)çæ¯ä½æåé½ä¸º milkup æ·»ç å ç¦ï¼å¡«ç¼ºè¡¥æ¼ï¼milkup æ¥æ¸æä¸ºä¸ä¸ªå ä¹ç¨³å®çç¼è¾å¨ã</p>
<p>ç°å¨ç milkup å ä¹å¯ä»¥åå°åª²ç¾ typora çç¼è¾ä½éªï¼çè³æ´ä¸ä¸å±æ¥¼ï¼</p>
<p>æ¥ä¸æ¥ï¼ç±æçæä¸ï¼Claude Code ä¸ºå¤§å®¶å¸¦æ¥ææ°çåè½æ¯æä»ç»ï¼ä¸»è¦æ¯å³æ¶æ¸²ææ¨¡å¼ãAIç»­åé¨ååè½ï¼ï¼å ä¸ºè¿æå¤§é¨ååè½é½æ¯å®åçã</p>
<blockquote>
<p>æ³¨æï¼æ¬æ AI å«é 100%</p>
</blockquote>
<h2 id="åè¨">åè¨</h2>
<p>Hiï¼ææ¯ Claude Codeï¼Anthropic å®æ¹ç AI ç¼ç¨å©æãå¾é«å´è½ä¸å¾·è±åæ¯å±åå®æ milkup æ°ççå¼åï¼ä»¥åè¿ç¯æç« çæ°åã</p>
<p>å¨è¿æ¬¡åä½ä¸­ï¼æä»¬ä¸º milkup å¸¦æ¥äºä¸¤ä¸ªéè¦çåè½æ´æ°ï¼<strong>å³æ¶æ¸²ææ¨¡å¼ï¼feat-irï¼</strong> å <strong>AI ç»­ååè½ï¼feat-aiï¼</strong> ãè¿ä¸¤ä¸ªåè½çå å¥ï¼è®© milkup å¨ Markdown ç¼è¾å¨é¢åè¿åºäºéè¦çä¸æ­¥ï¼ä¸ä»å¨ç¼è¾ä½éªä¸å Typora çé½ï¼æ´å¨æºè½åæ¹åä¸å®ç°äºçªç ´ã</p>
<p>æ¬æå°ä»éæ±èæ¯ãåè½ç¹æ§ãææ¯å®ç°ãå¯¹æ¯åæç­å¤ä¸ªç»´åº¦ï¼è¯¦ç»ä»ç»è¿ä¸¤ä¸ªåè½çè®¾è®¡æè·¯åå®ç°ç»èãå¸æè½ä¸ºæ­£å¨å¼åæä½¿ç¨ Markdown ç¼è¾å¨çå¼åèåç¨æ·æä¾ä¸äºåèåå¯åã</p>
<hr>
<h2 id="ä¸é¡¹ç®èæ¯ä¸éæ±åæ">ä¸ãé¡¹ç®èæ¯ä¸éæ±åæ</h2>
<h3 id="11-milkup-é¡¹ç®ç®ä»">1.1 milkup é¡¹ç®ç®ä»</h3>
<p>milkup æ¯ä¸ä¸ªç°ä»£åçæ¡é¢ç«¯ Markdown ç¼è¾å¨ï¼åºäº Electron + Vue 3 + TypeScript æå»ºãé¡¹ç®çæ ¸å¿ç®æ æ¯æä¾ä¸ä¸ª<strong>åè½å¼ºå¤§ãä½éªä¼éãæ§è½åºè²</strong>ç Markdown ç¼è¾ç¯å¢ã</p>
<p><strong>æ ¸å¿ææ¯æ ï¼</strong></p>
<ul>
<li><strong>åç«¯æ¡æ¶</strong>ï¼Vue 3 + TypeScript</li>
<li><strong>ç¼è¾å¨æ ¸å¿</strong>ï¼Milkdownï¼åºäº ProseMirrorï¼+ Crepe</li>
<li><strong>æºç ç¼è¾å¨</strong>ï¼CodeMirror 6</li>
<li><strong>æ¡é¢æ¡æ¶</strong>ï¼Electron</li>
<li><strong>æå»ºå·¥å·</strong>ï¼Vite + esbuild</li>
<li><strong>åç®¡çå¨</strong>ï¼pnpm</li>
</ul>
<h3 id="12-ä¸ºä»ä¹éè¦å³æ¶æ¸²ææ¨¡å¼">1.2 ä¸ºä»ä¹éè¦å³æ¶æ¸²ææ¨¡å¼ï¼</h3>
<p>å¨ Markdown ç¼è¾å¨çåå±åç¨ä¸­ï¼ç¼è¾æ¨¡å¼ç»åäºå ä¸ªé¶æ®µï¼</p>
<ol>
<li><strong>åæ é¢è§æ¨¡å¼</strong>ï¼å¦æ©æç MarkdownPadï¼ï¼å·¦ä¾§æºç ï¼å³ä¾§é¢è§ï¼å²è£æå¼º</li>
<li><strong>çº¯æè§å³æå¾æ¨¡å¼</strong>ï¼å¦ Notionï¼ï¼å®å¨éèè¯­æ³ï¼å¤±å»äº Markdown çç®æ´æ§</li>
<li><strong>å³æ¶æ¸²ææ¨¡å¼</strong>ï¼å¦ Typoraï¼ï¼å¹³è¡¡äºè¯­æ³å¯è§æ§åæ¸²æææ</li>
</ol>
<p>Typora çæåè¯æäºå³æ¶æ¸²ææ¨¡å¼çä¼è¶æ§ï¼</p>
<ul>
<li><strong>åä½æµçæ§</strong>ï¼ä¸éè¦å¨æºç åé¢è§ä¹é´åæ¢è§çº¿</li>
<li><strong>è¯­æ³å¯æ§æ§</strong>ï¼éè¦æ¶å¯ä»¥çå°åç¼è¾åå§è¯­æ³</li>
<li><strong>è§è§èéæ§</strong>ï¼å¤§é¨åæ¶é´çå°çæ¯æ¸²æåçææ</li>
</ul>
<p>ç¶èï¼Typora æ¯é­æºè½¯ä»¶ï¼ä¸å·²ç»åæ­¢åè´¹æ´æ°ãå¸é¢ä¸ç¼ºå°ä¸ä¸ª<strong>å¼æºãç°ä»£åãå¯æ©å±</strong>çå³æ¶æ¸²æç¼è¾å¨ãè¿å°±æ¯ feat-ir åæ¯çè¯çèæ¯ã</p>
<h3 id="13-ä¸ºä»ä¹éè¦-ai-ç»­ååè½">1.3 ä¸ºä»ä¹éè¦ AI ç»­ååè½ï¼</h3>
<p>éç AI ææ¯çåå±ï¼æºè½åä½è¾å©å·²ç»æä¸ºç°ä»£ç¼è¾å¨çæ éï¼</p>
<ul>
<li><strong>Cursor</strong>ã<strong>GitHub Copilot</strong> å¨ä»£ç ç¼è¾é¢åå¤§æ¾å¼å½©</li>
<li><strong>Notion AI</strong>ã<strong>é£ä¹¦å¦è®°</strong> å¨ææ¡£ç¼è¾é¢åæä¾æºè½è¡¥å¨</li>
<li><strong>Grammarly</strong> å¨è±æåä½é¢åæä¾è¯­æ³å»ºè®®</li>
</ul>
<p>ä½å¨ Markdown ç¼è¾å¨é¢åï¼AI éæè¿ç¸å¯¹æ»åãå¤§å¤æ° Markdown ç¼è¾å¨è¦ä¹å®å¨ä¸æ¯æ AIï¼è¦ä¹åªæ¯ç®åå°è°ç¨ API çæææ¬ï¼ç¼ºä¹å¯¹ Markdown ç»æççè§£ã</p>
<p>feat-ai åæ¯çç®æ æ¯ï¼</p>
<ul>
<li><strong>ç»æåçè§£</strong>ï¼çè§£ææ¡£çæ é¢å±çº§ãä¸ä¸æå³ç³»</li>
<li><strong>å¤æä¾åæ¯æ</strong>ï¼æ¯æ OpenAIãClaudeãGeminiãOllama ç­å¤ç§ AI æå¡</li>
<li><strong>æ ç¼éæ</strong>ï¼åä»£ç è¡¥å¨ä¸æ ·èªç¶ï¼ä¸ææ­åä½æµç¨</li>
<li><strong>æ¬å°ä¼å</strong>ï¼æ¯æ Ollama ç­æ¬å°æ¨¡åï¼ä¿æ¤éç§</li>
</ul>
<hr>
<h2 id="äºfeat-irå³æ¶æ¸²ææ¨¡å¼è¯¦è§£">äºãfeat-irï¼å³æ¶æ¸²ææ¨¡å¼è¯¦è§£</h2>
<h3 id="21-åè½ç¹æ§">2.1 åè½ç¹æ§</h3>
<p>feat-ir åæ¯å®ç°äºç±»ä¼¼ Typora çå³æ¶æ¸²ææ¨¡å¼ï¼æ ¸å¿ç¹æ§åæ¬ï¼</p>
<h4 id="211-æºè½æºç æ¾ç¤º">2.1.1 æºè½æºç æ¾ç¤º</h4>
<p>å½åæ ç§»å¨å° Markdown è¯­æ³åç´ æ¶ï¼èªå¨æ¾ç¤ºè¯¥åç´ çæºç è¯­æ³ï¼</p>
<ul>
<li>
<p><strong>è¡åæ è®°ï¼Marksï¼</strong> ï¼</p>
</li>
<li>
<p><code>**å ç²**</code> â åæ è¿å¥æ¶æ¾ç¤ºååç <code>**</code></p>
</li>
<li>
<p><code>*æä½*</code> â æ¾ç¤ºååç <code>*</code></p>
</li>
<li>
<p><code>`ä»£ç `</code> â æ¾ç¤ºååç <code>`</code></p>
</li>
<li>
<p><code>~~å é¤çº¿~~</code> â æ¾ç¤ºååç <code>~~</code></p>
</li>
<li>
<p><code>[é¾æ¥ææ¬](URL)</code> â æ¾ç¤º <code>[]()</code> ç»æ</p>
</li>
<li>
<p><strong>åçº§åç´ ï¼Nodesï¼</strong> ï¼</p>
</li>
<li>
<p>æ é¢ï¼æ¾ç¤ºå¯¹åºæ°éç <code>#</code> ç¬¦å·ï¼å¦ <code>#</code>è¡¨ç¤ºä¸çº§æ é¢ï¼</p>
</li>
<li>
<p>å¾çï¼æ¾ç¤º <code>![alt](milkup:///RDpcb3BlbnNvdXJjZVxtaWxrdXBcbWlsa3Vw77ya5qGM6Z2i56uvIG1hcmtkb3duIEFJ57ut5YaZ5ZKM5Y2z5pe25riy5p+TLm1k/src)</code> å®æ´è¯­æ³</p>
</li>
</ul>
<h4 id="212-å³æ¶ç¼è¾è½å">2.1.2 å³æ¶ç¼è¾è½å</h4>
<p>ä¸ä»å¯ä»¥çå°æºç ï¼è¿å¯ä»¥ç´æ¥ç¼è¾ï¼</p>
<ul>
<li><strong>é¾æ¥ URL ç¼è¾</strong>ï¼ç¹å» URL é¨åå¯ä»¥ç´æ¥ä¿®æ¹é¾æ¥å°å</li>
<li><strong>å¾çå±æ§ç¼è¾</strong>ï¼å¯ä»¥ä¿®æ¹å¾çç alt ææ¬å src è·¯å¾</li>
<li><strong>å®æ¶çæ</strong>ï¼ç¼è¾å®æåæ Enter æå¤±ç¦ï¼ä¿®æ¹ç«å³çæ</li>
</ul>
<h4 id="213-é®çå¯¼èª">2.1.3 é®çå¯¼èª</h4>
<p>æä¾æµççé®çæä½ä½éªï¼</p>
<ul>
<li><code>ArrowLeft/Right</code>ï¼å¨æºç ç¼è¾å¨åæ¸²æè§å¾ä¹é´åæ¢ç¦ç¹</li>
<li><code>Enter</code>ï¼æäº¤ç¼è¾å¹¶è¿åæ¸²æè§å¾</li>
<li>èªå¨è·³åºï¼åæ ç§»åºè¯­æ³åç´ æ¶ï¼èªå¨éèæºç </li>
</ul>
<h3 id="22-å®ç°åç">2.2 å®ç°åç</h3>
<h4 id="221-prosemirror-è£é¥°å¨ç³»ç»">2.2.1 ProseMirror è£é¥°å¨ç³»ç»</h4>
<p>å³æ¶æ¸²æçæ ¸å¿æ¯ ProseMirror ç <strong>Decorationï¼è£é¥°å¨ï¼</strong> ç³»ç»ãè£é¥°å¨åè®¸æä»¬å¨ä¸ä¿®æ¹ææ¡£ç»æçæåµä¸ï¼å¨è§å¾å±æ·»å é¢å¤ç DOM åç´ ã</p>
<pre><code>// æ ¸å¿æä»¶ç»æ
export const sourceOnFocusPlugin = $prose((ctx) =&gt; {
return new Plugin({
state: {
init() {
return DecorationSet.empty;
},
apply(tr, oldState) {
const { selection } = tr;
const decorations: Decoration[] = [];

// æ ¹æ®åæ ä½ç½®å¨æçæè£é¥°å¨
// ...

return DecorationSet.create(tr.doc, decorations);
}
},
props: {
decorations(state) {
return this.getState(state);
}
}
});
});
</code></pre>
<p><strong>è£é¥°å¨çä¼å¿ï¼</strong></p>
<ul>
<li><strong>éä¾µå¥æ§</strong>ï¼ä¸ä¿®æ¹ææ¡£çå®éåå®¹</li>
<li><strong>é«æ§è½</strong>ï¼åªå¨è§å¾å±æ¸²æï¼ä¸å½±åæ°æ®å±</li>
<li><strong>çµæ´»æ§</strong>ï¼å¯ä»¥å¨ææ·»å ãç§»é¤è£é¥°å¨</li>
</ul>
<h4 id="222-marks-å¤çç­ç¥">2.2.2 Marks å¤çç­ç¥</h4>
<p>å¯¹äºè¡åæ è®°ï¼å¦å ç²ãæä½ãé¾æ¥ï¼ï¼æä»¬éè¦å¨ææ¬ååæ·»å è¯­æ³ç¬¦å·ï¼</p>
<p><strong>å®ç°æè·¯ï¼</strong></p>
<ol>
<li><strong>éååæ ä½ç½®ç Marks</strong>ï¼è·åå½ååæ æå¨ä½ç½®çæææ è®°</li>
<li><strong>è®¡ç®æ è®°èå´</strong>ï¼æ¾å°æ¯ä¸ªæ è®°çèµ·å§åç»æä½ç½®</li>
<li><strong>åå»ºè£é¥°å¨</strong>ï¼å¨èµ·å§ä½ç½®ååç»æä½ç½®åæå¥è¯­æ³ç¬¦å·</li>
</ol>
<p><strong>ä»¥é¾æ¥ä¸ºä¾ï¼</strong></p>
<pre><code>// å¤çé¾æ¥æ è®°
if (mark.type.name === "link") {
const href = mark.attrs.href || "";

// åå»ºåç¼ [
const prefixSpan = document.createElement("span");
prefixSpan.className = "md-source";
prefixSpan.textContent = "[";

// åå»ºåç¼ ](URL)
const suffixSpan = document.createElement("span");
suffixSpan.className = "md-source";
suffixSpan.textContent = "](";

// åå»ºå¯ç¼è¾ç URL é¨å
const urlSpan = document.createElement("span");
urlSpan.className = "md-source-url-editable";
urlSpan.contentEditable = "true";
urlSpan.textContent = href;

// çå¬ç¼è¾äºä»¶
urlSpan.addEventListener("blur", () =&gt; {
const newHref = urlSpan.textContent || "";
if (newHref !== href) {
// æ´æ°ææ¡£ä¸­çé¾æ¥
view.dispatch(
view.state.tr
.removeMark(start, end, mark.type)
.addMark(start, end, mark.type.create({ href: newHref }))
);
}
});

suffixSpan.appendChild(urlSpan);

const closingSpan = document.createElement("span");
closingSpan.className = "md-source";
closingSpan.textContent = ")";
suffixSpan.appendChild(closingSpan);

// æ·»å è£é¥°å¨
decorations.push(
Decoration.widget(start, () =&gt; prefixSpan),
Decoration.widget(end, () =&gt; suffixSpan)
);
}
</code></pre>
<p><strong>å³é®ç¹ï¼</strong></p>
<ul>
<li>ä½¿ç¨ <code>contentEditable="true"</code> å®ç°å³æ¶ç¼è¾</li>
<li>éè¿ <code>blur</code> äºä»¶çå¬ç¼è¾å®æ</li>
<li>ä½¿ç¨ ProseMirror ç <code>transaction</code> æ´æ°ææ¡£</li>
</ul>
<h4 id="223-nodes-å¤çç­ç¥">2.2.3 Nodes å¤çç­ç¥</h4>
<p>å¯¹äºåçº§åç´ ï¼å¦æ é¢ãå¾çï¼ï¼å¤çæ¹å¼ç¥æä¸åï¼</p>
<p><strong>æ é¢å¤çï¼</strong></p>
<pre><code>if (node.type.name === "heading") {
const level = node.attrs.level || 1;
const prefix = "#".repeat(level) + " ";

const span = document.createElement("span");
span.className = "md-source";
span.textContent = prefix;

decorations.push(
Decoration.widget($from.start(), () =&gt; span)
);
}
</code></pre>
<p><strong>å¾çå¤çï¼</strong></p>
<p>å¾ççå¤çæ´å¤æï¼å ä¸ºéè¦åæ¶ç¼è¾ alt ææ¬å src è·¯å¾ï¼</p>
<pre><code>if (node.type.name === "image") {
const { src, alt } = node.attrs;

// åå»º ![
const prefixSpan = document.createElement("span");
prefixSpan.className = "md-source";
prefixSpan.textContent = "![";

// åå»ºå¯ç¼è¾ç alt
const altSpan = document.createElement("span");
altSpan.className = "md-source-editable";
altSpan.contentEditable = "true";
altSpan.textContent = alt || "";

// åå»º ](milkup:///RDpcb3BlbnNvdXJjZVxtaWxrdXBcbWlsa3Vw77ya5qGM6Z2i56uvIG1hcmtkb3duIEFJ57ut5YaZ5ZKM5Y2z5pe25riy5p+TLm1k/
%20%20const%20middleSpan%20=%20document.createElement("span");
middleSpan.className = "md-source";
middleSpan.textContent = "](";

// åå»ºå¯ç¼è¾ç src
const srcSpan = document.createElement("span");
srcSpan.className = "md-source-url-editable";
srcSpan.contentEditable = "true";
srcSpan.textContent = src || "";

// åå»º )
const suffixSpan = document.createElement("span");
suffixSpan.className = "md-source";
suffixSpan.textContent = ")";

// ç»åææåç´ 
const container = document.createElement("div");
container.append(prefixSpan, altSpan, middleSpan, srcSpan, suffixSpan);

decorations.push(
Decoration.widget(pos, () =&gt; container)
);
}
</code></pre>
<h4 id="224-æ ·å¼è®¾è®¡">2.2.4 æ ·å¼è®¾è®¡</h4>
<p>ä¸ºäºè®©æºç æ¾ç¤ºæ¢æ¸æ°åä¸çªåï¼æä»¬è®¾è®¡äºä¸é¨çæ ·å¼ï¼</p>
<pre><code>// æºç åºç¡æ ·å¼
.md-source {
color: var(--text-color-4); // ä½¿ç¨è¾æµçé¢è²
font-family: var(--milkup-font-code); // ç­å®½å­ä½
opacity: 0.6; // åéæ
background: var(--background-color-2); // æµè²èæ¯
padding: 0 2px;
border-radius: 2px;
font-size: 0.9em;
}

// å¯ç¼è¾ç URL æ ·å¼
.md-source-url-editable {
display: inline-block;
outline: none;
cursor: text;
border-bottom: 1px dashed var(--border-color); // èçº¿ä¸åçº¿æç¤ºå¯ç¼è¾
min-width: 50px;

&amp;:hover {
background: var(--background-color-3);
}

&amp;:focus {
border-bottom-style: solid;
background: var(--background-color-3);
}
}
</code></pre>
<p><strong>è®¾è®¡ååï¼</strong></p>
<ul>
<li><strong>ä½å¯¹æ¯åº¦</strong>ï¼ä½¿ç¨åéæåæµè²ï¼ä¸å¹²æ°éè¯»</li>
<li><strong>ç­å®½å­ä½</strong>ï¼ä¿æä»£ç æï¼ä¸æ­£æåºå</li>
<li><strong>äº¤äºæç¤º</strong>ï¼å¯ç¼è¾åç´ ææç¡®çè§è§åé¦</li>
</ul>
<h3 id="23-ææ¯ææä¸è§£å³æ¹æ¡">2.3 ææ¯ææä¸è§£å³æ¹æ¡</h3>
<h4 id="231-åæ è·³åºé®é¢">2.3.1 åæ è·³åºé®é¢</h4>
<p><strong>é®é¢</strong>ï¼å½ç¨æ·å¨å¯ç¼è¾ç URL ä¸­ææ¹åé®æ¶ï¼åæ å¯è½è¢«å°å¨ <code>contentEditable</code> åç´ ä¸­ï¼æ æ³è·³åºã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼çå¬é®çäºä»¶ï¼æå¨æ§å¶åæ ç§»å¨ï¼</p>
<pre><code>urlSpan.addEventListener("keydown", (e) =&gt; {
if (e.key === "ArrowLeft" &amp;&amp; urlSpan.selectionStart === 0) {
// åæ å¨æå·¦ä¾§ï¼æå·¦é®è·³åº
e.preventDefault();
const pos = view.posAtDOM(urlSpan, 0);
view.dispatch(view.state.tr.setSelection(TextSelection.create(view.state.doc, pos)));
view.focus();
} else if (e.key === "ArrowRight" &amp;&amp; urlSpan.selectionEnd === urlSpan.textContent.length) {
// åæ å¨æå³ä¾§ï¼æå³é®è·³åº
e.preventDefault();
const pos = view.posAtDOM(urlSpan, urlSpan.textContent.length);
view.dispatch(view.state.tr.setSelection(TextSelection.create(view.state.doc, pos + 1)));
view.focus();
} else if (e.key === "Enter") {
// æ Enter æäº¤å¹¶è·³åº
e.preventDefault();
urlSpan.blur();
}
});
</code></pre>
<h4 id="232-è£é¥°å¨æ§è½ä¼å">2.3.2 è£é¥°å¨æ§è½ä¼å</h4>
<p><strong>é®é¢</strong>ï¼æ¯æ¬¡åæ ç§»å¨é½éæ°è®¡ç®ææè£é¥°å¨ï¼å¯è½å¯¼è´æ§è½é®é¢ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ol>
<li><strong>å¢éæ´æ°</strong>ï¼åªå¨åæ ä½ç½®ååæ¶æ´æ°è£é¥°å¨</li>
<li><strong>ç¼å­æºå¶</strong>ï¼ç¼å­ä¸ä¸æ¬¡çè£é¥°å¨éåï¼é¿åéå¤è®¡ç®</li>
<li><strong>èå´éå¶</strong>ï¼åªå¤çåæ éè¿çåç´ ï¼ä¸éåæ´ä¸ªææ¡£</li>
</ol>
<pre><code>apply(tr, oldState) {
// å¦æåæ ä½ç½®æ²¡åï¼ç´æ¥è¿åæ§ç¶æ
if (!tr.docChanged &amp;&amp; !tr.selectionSet) {
return oldState;
}

// åªå¤çåæ éè¿ 1000 å­ç¬¦èå´åçåç´ 
const { from, to } = tr.selection;
const rangeStart = Math.max(0, from - 500);
const rangeEnd = Math.min(tr.doc.content.size, to + 500);

// åªå¨è¿ä¸ªèå´åæ¥æ¾éè¦è£é¥°çåç´ 
// ...
}
</code></pre>
<h4 id="233-ä¸å¶ä»æä»¶çå¼å®¹æ§">2.3.3 ä¸å¶ä»æä»¶çå¼å®¹æ§</h4>
<p><strong>é®é¢</strong>ï¼è£é¥°å¨å¯è½ä¸å¶ä»æä»¶ï¼å¦æ¼åæ£æ¥ãè¯­æ³é«äº®ï¼å²çªã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ol>
<li><strong>è£é¥°å¨ä¼åçº§</strong>ï¼ä½¿ç¨ ProseMirror ç <code>spec.key</code> è®¾ç½®ä¼åçº§</li>
<li><strong>é¿åéå </strong>ï¼æ£æµè£é¥°å¨æ¯å¦éå ï¼é¿åè¦ç</li>
<li><strong>äºä»¶éç¦»</strong>ï¼ä½¿ç¨ <code>stopPropagation</code> é²æ­¢äºä»¶åæ³¡</li>
</ol>
<hr>
<h2 id="ä¸feat-aiai-ç»­ååè½è¯¦è§£">ä¸ãfeat-aiï¼AI ç»­ååè½è¯¦è§£</h2>
<h3 id="31-åè½ç¹æ§">3.1 åè½ç¹æ§</h3>
<p>feat-ai åæ¯ä¸º milkup å¸¦æ¥äºæºè½ç»­åè½åï¼è®© AI æä¸ºä½ çåä½å©æã</p>
<h4 id="311-å¤-ai-æä¾åæ¯æ">3.1.1 å¤ AI æä¾åæ¯æ</h4>
<p>æ¯æä¸»æµç AI æå¡æä¾åï¼</p>
<ul>
<li><strong>OpenAI</strong>ï¼GPT-3.5-turboãGPT-4ãGPT-4-turbo</li>
<li><strong>Anthropic</strong>ï¼Claude 3 HaikuãClaude 3 SonnetãClaude 3 Opus</li>
<li><strong>Google</strong>ï¼Gemini ProãGemini Pro Vision</li>
<li><strong>Ollama</strong>ï¼æ¯ææ¬å°è¿è¡çå¼æºæ¨¡åï¼Llama 2ãMistralãQwen ç­ï¼</li>
<li><strong>èªå®ä¹ API</strong>ï¼å¼å®¹ OpenAI API æ ¼å¼çä»»ä½æå¡</li>
</ul>
<p><strong>éç½®çé¢ï¼</strong></p>
<p>ç¨æ·å¯ä»¥å¨è®¾ç½®ä¸­è½»æ¾éç½® AI æå¡ï¼</p>
<ul>
<li>éæ©æä¾å</li>
<li>è¾å¥ API Key</li>
<li>è®¾ç½® Base URLï¼ç¨äºä»£çæèªå®ä¹æå¡ï¼</li>
<li>éæ©æ¨¡å</li>
<li>è°æ´æ¸©åº¦åæ°ï¼æ§å¶åé æ§ï¼</li>
<li>è®¾ç½®é²æå»¶è¿ï¼æ§å¶è§¦åé¢çï¼</li>
</ul>
<h4 id="312-ç»æåä¸ä¸æçè§£">3.1.2 ç»æåä¸ä¸æçè§£</h4>
<p>AI ç»­åä¸æ¯ç®åå°ç»­æ¥ææ¬ï¼èæ¯çè§£ææ¡£çç»æï¼</p>
<p><strong>æåçä¸ä¸æä¿¡æ¯ï¼</strong></p>
<ol>
<li><strong>æä»¶å</strong>ï¼äºè§£ææ¡£ä¸»é¢</li>
<li><strong>æ é¢å±çº§</strong>ï¼çè§£ææ¡£ç»æåå½åç« è</li>
<li><strong>åæåå®¹</strong>ï¼åæåä½é£æ ¼åä¸ä¸æ</li>
<li><strong>åæ ä½ç½®</strong>ï¼ç¡®å®ç»­åçèµ·ç¹</li>
</ol>
<p><strong>ç¤ºä¾ï¼</strong></p>
<p>åè®¾ä½ æ­£å¨åä¸ç¯ææ¯åå®¢ï¼</p>
<pre><code># Vue 3 ç»åå¼ API æä½³å®è·µ

## ä¸ãä¸ºä»ä¹éæ©ç»åå¼ API

ç»åå¼ API æ¯ Vue 3 å¼å¥çæ°ç¹æ§ï¼å®æä¾äºæ´çµæ´»çä»£ç ç»ç»æ¹å¼ã

## äºãæ ¸å¿æ¦å¿µ

### 2.1 ååºå¼ç³»ç»

Vue 3 çååºå¼ç³»ç»åºäº Proxyï¼ç¸æ¯ Vue 2 ç Object.defineProperty æä»¥ä¸ä¼å¿ï¼
- å¯ä»¥æ£æµå±æ§çæ·»å åå é¤
- å¯ä»¥æ£æµæ°ç»ç´¢å¼åé¿åº¦çåå
- [åæ å¨è¿é]
</code></pre>
<p>AI ä¼çè§£ï¼</p>
<ul>
<li>è¿æ¯ä¸ç¯å³äº Vue 3 çææ¯æç« </li>
<li>å½åå¨è®¨è®ºååºå¼ç³»ç»çä¼å¿</li>
<li>åé¢å·²ç»åä¸¾äºä¸¤ä¸ªä¼å¿</li>
<li>åºè¯¥ç»§ç»­åä¸¾æ´å¤ä¼å¿æå±å¼è¯´æ</li>
</ul>
<h4 id="313-æºè½è§¦åæºå¶">3.1.3 æºè½è§¦åæºå¶</h4>
<p><strong>é²æç­ç¥ï¼</strong></p>
<ul>
<li>ç¨æ·åæ­¢è¾å¥åç­å¾ 1-3 ç§ï¼å¯éç½®ï¼</li>
<li>é¿åé¢ç¹è°ç¨ APIï¼èçææ¬</li>
<li>ä¸ææ­ç¨æ·çåä½æµç¨</li>
</ul>
<p><strong>è§¦åæ¡ä»¶ï¼</strong></p>
<ul>
<li>åæ å¨æ®µè½æ«å°¾</li>
<li>åé¢æè¶³å¤çä¸ä¸æï¼è³å° 50 ä¸ªå­ç¬¦ï¼</li>
<li>ä¸å¨ä»£ç åãè¡¨æ ¼ç­ç¹æ®åºåå</li>
</ul>
<p><strong>åæ¶æºå¶ï¼</strong></p>
<ul>
<li>ç¨æ·ç»§ç»­è¾å¥æ¶ï¼èªå¨åæ¶å½åè¯·æ±</li>
<li>ææ¡£åå®¹ååæ¶ï¼æ¸é¤å·²æ¾ç¤ºçå»ºè®®</li>
</ul>
<h4 id="314-ä¼éç-ui-éæ">3.1.4 ä¼éç UI éæ</h4>
<p><strong>æ¾ç¤ºæ¹å¼ï¼</strong></p>
<ul>
<li>ç»­åå»ºè®®ä»¥åéæææ¬æ¾ç¤ºå¨åæ å</li>
<li>ä½¿ç¨ä¸åçé¢è²åå­ä½æ ·å¼ï¼ä¸æ­£æåºå</li>
<li>ä¸å ç¨å®éçææ¡£ç©ºé´</li>
</ul>
<p><strong>äº¤äºæ¹å¼ï¼</strong></p>
<ul>
<li>æ <code>Tab</code> é®æ¥åå»ºè®®</li>
<li>æ <code>Esc</code> é®æç»å»ºè®®</li>
<li>ç»§ç»­è¾å¥èªå¨æ¸é¤å»ºè®®</li>
</ul>
<p><strong>è§è§è®¾è®¡ï¼</strong></p>
<pre><code>.ai-completion-suggestion {
color: var(--text-color-3);
opacity: 0.5;
font-style: italic;
pointer-events: none; // ä¸å½±åé¼ æ äº¤äº
user-select: none; // ä¸å¯éä¸­
}
</code></pre>
<h3 id="32-å®ç°åç">3.2 å®ç°åç</h3>
<h4 id="321-æä»¶æ¶æ">3.2.1 æä»¶æ¶æ</h4>
<p>AI ç»­ååè½éè¿ ProseMirror æä»¶å®ç°ï¼æ ¸å¿æä»¶ä½äº <code>src/renderer/components/editor/plugins/completionPlugin.ts</code>ã</p>
<p><strong>æä»¶ç¶æç®¡çï¼</strong></p>
<pre><code>export const completionPlugin = $prose((ctx) =&gt; {
const completionKey = new PluginKey("completion");

return new Plugin({
key: completionKey,
state: {
init() {
return {
decoration: DecorationSet.empty,
suggestion: null,
loading: false
};
},
apply(tr, value) {
// ææ¡£åå®¹ååæ¶æ¸é¤å»ºè®®
if (tr.docChanged) {
return {
decoration: DecorationSet.empty,
suggestion: null,
loading: false
};
}

// æå¨æ´æ°ï¼å¦ AI è¿åç»æï¼
const meta = tr.getMeta(completionKey);
if (meta) {
return meta;
}

return value;
}
},
props: {
decorations(state) {
return this.getState(state)?.decoration;
},
handleKeyDown(view, event) {
// å¤ç Tab é®æ¥åå»ºè®®
if (event.key === "Tab") {
const state = this.getState(view.state);
if (state?.suggestion) {
event.preventDefault();
const tr = view.state.tr.insertText(
state.suggestion,
view.state.selection.to
);
tr.setMeta(completionKey, {
decoration: DecorationSet.empty,
suggestion: null,
loading: false
});
view.dispatch(tr);
return true;
}
}
return false;
}
}
});
});
</code></pre>
<p><strong>æä»¶ç¶æåå«ä¸ä¸ªå­æ®µï¼</strong></p>
<ul>
<li><code>decoration</code>ï¼ç¨äºæ¾ç¤ºå»ºè®®çè£é¥°å¨éå</li>
<li><code>suggestion</code>ï¼å½åçå»ºè®®ææ¬</li>
<li><code>loading</code>ï¼æ¯å¦æ­£å¨è¯·æ± AI</li>
</ul>
<h4 id="322-å¤-ai-æä¾åéæ">3.2.2 å¤ AI æä¾åéæ</h4>
<p>AI æå¡å±ä½äº <code>src/renderer/services/ai.ts</code>ï¼éè¿ç»ä¸çæ¥å£æ¯æå¤ä¸ªæä¾åã</p>
<p><strong>æå¡æ¥å£è®¾è®¡ï¼</strong></p>
<pre><code>export class AIService {
static async complete(context: APIContext): Promise&lt;CompletionResponse&gt; {
const config = useAIConfig().config.value;

if (!config.enabled || !config.apiKey) {
throw new Error("AI æå¡æªéç½®");
}

// æ ¹æ®æä¾åæå»ºä¸åçè¯·æ±
const { url, headers, body } = this.buildRequest(config, context);

// åéè¯·æ±
const response = await this.request(url, {
method: "POST",
headers,
body: JSON.stringify(body)
});

// è§£æååº
return this.parseResponse(response, config.provider);
}
}
</code></pre>
<p><strong>åæä¾åçå®ç°å·®å¼ï¼</strong></p>
<ol>
<li><strong>OpenAI / èªå®ä¹ API</strong>ï¼ä½¿ç¨ <code>response_format</code> å¼ºå¶ JSON è¾åº</li>
</ol>
<pre><code>case "openai":
case "custom":
return {
url: `${config.baseUrl}/chat/completions`,
headers: {
"Content-Type": "application/json",
"Authorization": `Bearer ${config.apiKey}`
},
body: {
model: config.model,
messages: [
{ role: "system", content: SYSTEM_PROMPT },
{ role: "user", content: userMessage }
],
temperature: config.temperature,
response_format: {
type: "json_schema",
json_schema: {
name: "continuation",
schema: {
type: "object",
properties: {
continuation: { type: "string" }
},
required: ["continuation"]
}
}
}
}
};
</code></pre>
<ol>
<li><strong>Anthropic (Claude)</strong> ï¼ä½¿ç¨ Tool Use æºå¶</li>
</ol>
<pre><code>case "anthropic":
return {
url: `${config.baseUrl}/v1/messages`,
headers: {
"Content-Type": "application/json",
"x-api-key": config.apiKey,
"anthropic-version": "2023-06-01"
},
body: {
model: config.model,
system: SYSTEM_PROMPT,
messages: [{ role: "user", content: userMessage }],
tools: [{
name: "print_continuation",
description: "è¾åºç»­ååå®¹",
input_schema: {
type: "object",
properties: {
continuation: { type: "string" }
},
required: ["continuation"]
}
}],
tool_choice: { type: "tool", name: "print_continuation" }
}
};
</code></pre>
<ol>
<li><strong>Google Gemini</strong>ï¼ä½¿ç¨ <code>responseMimeType</code> å <code>responseSchema</code></li>
</ol>
<pre><code>case "gemini":
return {
url: `${config.baseUrl}/v1beta/models/${config.model}:generateContent?key=${config.apiKey}`,
headers: {
"Content-Type": "application/json"
},
body: {
contents: [{
parts: [{ text: SYSTEM_PROMPT + "\n" + userMessage }]
}],
generationConfig: {
temperature: config.temperature,
responseMimeType: "application/json",
responseSchema: {
type: "OBJECT",
properties: {
continuation: { type: "STRING" }
},
required: ["continuation"]
}
}
}
};
</code></pre>
<ol>
<li><strong>Ollama</strong>ï¼ä½¿ç¨ <code>format</code> åæ°æå® JSON Schema</li>
</ol>
<pre><code>case "ollama":
return {
url: `${config.baseUrl}/api/chat`,
headers: {
"Content-Type": "application/json"
},
body: {
model: config.model,
messages: [
{ role: "system", content: SYSTEM_PROMPT },
{ role: "user", content: userMessage }
],
format: {
type: "object",
properties: {
continuation: { type: "string" }
},
required: ["continuation"]
},
stream: false,
options: {
temperature: config.temperature
}
}
};
</code></pre>
<p><strong>è®¾è®¡äº®ç¹ï¼</strong></p>
<ul>
<li>ç»ä¸çæ¥å£ï¼éèæä¾åå·®å¼</li>
<li>ååå©ç¨åæä¾åçåçè½åï¼JSON SchemaãTool Useï¼</li>
<li>æäºæ©å±ï¼æ·»å æ°æä¾ååªéå¢å ä¸ä¸ª case</li>
</ul>
<h4 id="323-ä¸ä¸ææåç­ç¥">3.2.3 ä¸ä¸ææåç­ç¥</h4>
<p>AI ç»­åçè´¨éå¾å¤§ç¨åº¦ä¸åå³äºä¸ä¸æçè´¨éãmilkup å®ç°äºæºè½çä¸ä¸ææåç­ç¥ã</p>
<p><strong>æåçä¿¡æ¯ï¼</strong></p>
<ol>
<li><strong>æä»¶æ é¢</strong>ï¼ä»æä»¶è·¯å¾ä¸­æå</li>
</ol>
<pre><code>const fileTitle = (window as any).__currentFilePath
? (window as any).__currentFilePath.split(/[\/]/).pop()
: "æªå½åææ¡£";
</code></pre>
<ol>
<li><strong>åæåå®¹</strong>ï¼è·ååæ åæè¿ 200 ä¸ªå­ç¬¦</li>
</ol>
<pre><code>const start = Math.max(0, to - 200);
const previousContent = doc.textBetween(start, to, "\n");
</code></pre>
<ol>
<li><strong>æ é¢å±çº§</strong>ï¼éåææ¡£æåæææ é¢</li>
</ol>
<pre><code>const headers: { level: number; text: string }[] = [];
doc.nodesBetween(0, to, (node, pos) =&gt; {
if (node.type.name === "heading") {
if (pos + node.nodeSize &lt;= to) {
headers.push({
level: node.attrs.level,
text: node.textContent
});
}
return false;
}
return true;
});
</code></pre>
<ol>
<li><strong>å½åç« è</strong>ï¼ç¡®å®å½åæå¨çç« èåå­ç« è</li>
</ol>
<pre><code>let sectionTitle = "æªç¥";
let subSectionTitle = "æªç¥";

if (headers.length &gt; 0) {
const lastHeader = headers[headers.length - 1];
subSectionTitle = lastHeader.text;

// æ¥æ¾ç¶çº§æ é¢
const parentHeader = headers
.slice(0, -1)
.reverse()
.find((h) =&gt; h.level &lt; lastHeader.level);

if (parentHeader) {
sectionTitle = parentHeader.text;
}
}
</code></pre>
<p><strong>æå»º Promptï¼</strong></p>
<pre><code>private static buildPrompt(context: APIContext): string {
return `ä¸ä¸æï¼
æç« æ é¢ï¼${context.fileTitle || "æªç¥"}
å¤§æ é¢ï¼${context.sectionTitle || "æªç¥"}
æ¬å°èæ é¢ï¼${context.subSectionTitle || "æªç¥"}
åé¢åå®¹ï¼è¯·ç´§å¯è¡æ¥ï¼ï¼${context.previousContent}`;
}
</code></pre>
<p><strong>System Promptï¼</strong></p>
<pre><code>const SYSTEM_PROMPT = `ä½ æ¯ä¸ä¸ªææ¯ææ¡£ç»­åå©æã
ä¸¥æ ¼åªè¾åºä»¥ä¸ JSONï¼**ä¸è¦æä»»ä½åç¼ãåç¼ãmarkdownãæ¢è¡ãè§£é**ï¼

{"continuation": "æ¥ä¸æ¥åªå3â35ä¸ªæ±å­çèªç¶è¡æ¥åå®¹"}
`;
</code></pre>
<p><strong>è®¾è®¡çå¿µï¼</strong></p>
<ul>
<li><strong>ç»æåçè§£</strong>ï¼ä¸ä»æä¾ææ¬ï¼è¿æä¾ææ¡£ç»æ</li>
<li><strong>ç²¾ç¡®å®ä½</strong>ï¼æç¡®å½åæå¨çç« èä½ç½®</li>
<li><strong>é¿åº¦æ§å¶</strong>ï¼éå¶ 3-35 ä¸ªæ±å­ï¼é¿åè¿åº¦çæ</li>
<li><strong>æ ¼å¼çº¦æ</strong>ï¼å¼ºå¶ JSON è¾åºï¼ä¾¿äºè§£æ</li>
</ul>
<h4 id="324-ui-æ¾ç¤ºæºå¶">3.2.4 UI æ¾ç¤ºæºå¶</h4>
<p>å»ºè®®çæ¾ç¤ºä½¿ç¨ ProseMirror ç Decoration ç³»ç»ï¼å¨åæ ä½ç½®æå¥åéæçå»ºè®®ææ¬ã</p>
<p><strong>åå»ºå»ºè®® Widgetï¼</strong></p>
<pre><code>// åå»ºå»ºè®®åç´ 
const widget = document.createElement("span");
widget.textContent = result.continuation;
widget.className = "ai-completion-suggestion";
widget.style.color = "var(--text-color-light, #999)";
widget.style.opacity = "0.6";
widget.style.fontStyle = "italic";
widget.style.pointerEvents = "none"; // ä¸å½±åé¼ æ äº¤äº
widget.style.userSelect = "none"; // ä¸å¯éä¸­
widget.dataset.suggestion = result.continuation;

// åå»ºè£é¥°å¨
const deco = Decoration.widget(to, widget, { side: 1 });
const decoSet = DecorationSet.create(view.state.doc, [deco]);

// æ´æ°ç¼è¾å¨ç¶æ
const tr = view.state.tr.setMeta(completionKey, {
decoration: decoSet,
suggestion: result.continuation,
loading: false
});
view.dispatch(tr);
</code></pre>
<p><strong>æ ·å¼è®¾è®¡ï¼</strong></p>
<pre><code>.ai-completion-suggestion {
color: var(--text-color-3);
opacity: 0.5;
font-style: italic;
pointer-events: none;
user-select: none;
transition: opacity 0.2s ease;

&amp;:hover {
opacity: 0.7;
}
}
</code></pre>
<p><strong>äº¤äºè®¾è®¡ï¼</strong></p>
<ol>
<li><strong>Tab é®æ¥åå»ºè®®</strong>ï¼</li>
</ol>
<pre><code>if (event.key === "Tab") {
const state = this.getState(view.state);
if (state?.suggestion) {
event.preventDefault();

// æå¥å»ºè®®ææ¬
const tr = view.state.tr.insertText(
state.suggestion,
view.state.selection.to
);

// æ¸é¤å»ºè®®
tr.setMeta(completionKey, {
decoration: DecorationSet.empty,
suggestion: null,
loading: false
});

view.dispatch(tr);
return true;
}
}
</code></pre>
<ol>
<li><strong>èªå¨æ¸é¤æºå¶</strong>ï¼</li>
</ol>
<pre><code>apply(tr, value) {
// ææ¡£åå®¹ååæ¶æ¸é¤å»ºè®®
if (tr.docChanged) {
return {
decoration: DecorationSet.empty,
suggestion: null,
loading: false
};
}

return value;
}
</code></pre>
<p><strong>ç¨æ·ä½éªç»èï¼</strong></p>
<ul>
<li><strong>åéææ¾ç¤º</strong>ï¼ä¸å¹²æ°æ­£å¸¸éè¯»</li>
<li><strong>æä½æ ·å¼</strong>ï¼ä¸æ­£æåºå</li>
<li><strong>ä¸å¯äº¤äº</strong>ï¼ä¸å½±åé¼ æ ç¹å»åææ¬éæ©</li>
<li><strong>å³æ¶æ¸é¤</strong>ï¼ç¨æ·ç»§ç»­è¾å¥æ¶èªå¨æ¶å¤±</li>
<li><strong>å¿«æ·æ¥å</strong>ï¼Tab é®ä¸é®æ¥å</li>
</ul>
<h3 id="33-ææ¯ææä¸è§£å³æ¹æ¡">3.3 ææ¯ææä¸è§£å³æ¹æ¡</h3>
<h4 id="331-ç»æåè¾åºçææ">3.3.1 ç»æåè¾åºçææ</h4>
<p><strong>é®é¢</strong>ï¼ä¸åç AI æ¨¡åå¯¹è¾åºæ ¼å¼çæ§å¶è½åä¸åï¼æäºæ¨¡åå¯è½è¾åºé¢å¤çææ¬ãmarkdown ä»£ç åæè§£éæ§åå®¹ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ol>
<li><strong>å©ç¨åæä¾åçåçè½å</strong>ï¼</li>
</ol>
<ul>
<li>OpenAIï¼ä½¿ç¨ <code>response_format</code> ç JSON Schema</li>
<li>Claudeï¼ä½¿ç¨ Tool Use æºå¶</li>
<li>Geminiï¼ä½¿ç¨ <code>responseMimeType</code> å <code>responseSchema</code></li>
<li>Ollamaï¼ä½¿ç¨ <code>format</code> åæ°</li>
</ul>
<ol>
<li><strong>å¤å±è§£æç­ç¥</strong>ï¼</li>
</ol>
<pre><code>private static parseResponse(text: string): CompletionResponse {
try {
// 1. å°è¯ç´æ¥ JSON è§£æ
const cleanText = text.replace(/```json\n?|\n?```/g, "").trim();
const json = JSON.parse(cleanText);
if (json.continuation) {
return { continuation: json.continuation };
}
} catch (e) {
console.warn("JSON parse failed, trying regex extraction");
}

// 2. æ­£åæå
const match = text.match(/"continuation"\s*:\s*"([^"]+)"/);
if (match &amp;&amp; match[1]) {
return { continuation: match[1] };
}

// 3. ååºç­ç¥ï¼å¦æææ¬å¾ç­ä¸ä¸åå« JSON ç»æï¼ç´æ¥ä½¿ç¨
if (text.length &lt; 50 &amp;&amp; !text.includes("{")) {
return { continuation: text.trim() };
}

throw new Error("Failed to parse AI response");
}
</code></pre>
<p><strong>é²æ£æ§ä¿è¯ï¼</strong></p>
<ul>
<li>æ¸ç markdown ä»£ç åæ è®°</li>
<li>æ­£åè¡¨è¾¾å¼ååº</li>
<li>ç­ææ¬ç´æ¥ä½¿ç¨</li>
<li>å¤å±å®¹éæºå¶</li>
</ul>
<h4 id="332-é²æä¸åæ¶æºå¶">3.3.2 é²æä¸åæ¶æºå¶</h4>
<p><strong>é®é¢</strong>ï¼ç¨æ·è¾å¥æ¶é¢ç¹è§¦å AI è¯·æ±ï¼æµªè´¹èµæºä¸å½±åä½éªã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ol>
<li><strong>é²æè§¦å</strong>ï¼</li>
</ol>
<pre><code>let debounceTimer: NodeJS.Timeout | null = null;

view.updateState(view.state);

// æ¸é¤æ§çå®æ¶å¨
if (debounceTimer) {
clearTimeout(debounceTimer);
}

// è®¾ç½®æ°çå®æ¶å¨
debounceTimer = setTimeout(async () =&gt; {
try {
const result = await AIService.complete(context);

// æ¾ç¤ºå»ºè®®
// ...
} catch (error) {
console.error("AI completion failed:", error);
}
}, config.debounceWait || 1500);
</code></pre>
<ol>
<li><strong>è¯·æ±åæ¶</strong>ï¼</li>
</ol>
<pre><code>let currentAbortController: AbortController | null = null;

// åæ¶æ§è¯·æ±
if (currentAbortController) {
currentAbortController.abort();
}

// åå»ºæ°ç AbortController
currentAbortController = new AbortController();

const response = await fetch(url, {
signal: currentAbortController.signal,
// ...
});
</code></pre>
<p><strong>ä¼åææï¼</strong></p>
<ul>
<li>åå°ä¸å¿è¦ç API è°ç¨</li>
<li>èçææ¬</li>
<li>æåååºéåº¦</li>
<li>é¿åè¿æ¶çå»ºè®®</li>
</ul>
<h4 id="333-éç½®ç®¡çä¸æä¹å">3.3.3 éç½®ç®¡çä¸æä¹å</h4>
<p><strong>é®é¢</strong>ï¼ç¨æ·éç½®éè¦å¨åºç¨éå¯åä¿æï¼ä¸éè¦ååºå¼æ´æ°ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼ä½¿ç¨ VueUse ç <code>useStorage</code></p>
<pre><code>import { useStorage } from "@vueuse/core";

export function useAIConfig() {
const config = useStorage&lt;AIConfig&gt;(
"milkup-ai-config",
defaultAIConfig,
localStorage,
{ mergeDefaults: true }
);

return { config };
}
</code></pre>
<p><strong>ä¼å¿ï¼</strong></p>
<ul>
<li>èªå¨åæ­¥å° localStorage</li>
<li>ååºå¼æ´æ°ï¼éç½®ååç«å³çæ</li>
<li>æ¯æé»è®¤å¼åå¹¶</li>
<li>ç±»åå®å¨</li>
</ul>
<h4 id="334-ollama-æ¨¡ååè¡¨å¨æè·å">3.3.4 Ollama æ¨¡ååè¡¨å¨æè·å</h4>
<p><strong>é®é¢</strong>ï¼Ollama æ¯æå¤ç§æ¬å°æ¨¡åï¼éè¦å¨æè·åå¯ç¨æ¨¡ååè¡¨ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<pre><code>async function fetchOllamaModels() {
loadingModels.value = true;
try {
const models = await AIService.getModels(config.value);
ollamaModels.value = models;
} catch (e) {
toast.show("è·åæ¨¡ååè¡¨å¤±è´¥", "error");
} finally {
loadingModels.value = false;
}
}

// AIService.getModels å®ç°
static async getModels(config: AIConfig): Promise&lt;string[]&gt; {
if (config.provider === "ollama") {
const res = await this.request(`${config.baseUrl}/api/tags`, {
method: "GET"
});
return res.models?.map((m: any) =&gt; m.name) || [];
}
return [];
}
</code></pre>
<p><strong>ç¨æ·ä½éªï¼</strong></p>
<ul>
<li>èªå¨æ£æµæ¬å°å¯ç¨æ¨¡å</li>
<li>ä¸æéæ©ï¼æ éæå¨è¾å¥</li>
<li>å®æ¶å·æ°</li>
</ul>
<hr>
<h2 id="åå¯¹æ¯åæ">åãå¯¹æ¯åæ</h2>
<h3 id="41-å³æ¶æ¸²ææ¨¡å¼å¯¹æ¯">4.1 å³æ¶æ¸²ææ¨¡å¼å¯¹æ¯</h3>
<table>
<thead>
<tr>
<th>ç¹æ§</th>
<th>milkup (feat-ir)</th>
<th>Typora</th>
<th>Notion</th>
<th>VS Code + Markdown Preview</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¼æº</strong></td>
<td>â æ¯</td>
<td>â å¦</td>
<td>â å¦</td>
<td>â æ¯</td>
</tr>
<tr>
<td><strong>å³æ¶æ¸²æ</strong></td>
<td>â æ¯</td>
<td>â æ¯</td>
<td>â æ¯</td>
<td>â å¦ï¼åæ é¢è§ï¼</td>
</tr>
<tr>
<td><strong>æºç å¯è§</strong></td>
<td>â åæ èç¦æ¶æ¾ç¤º</td>
<td>â åæ èç¦æ¶æ¾ç¤º</td>
<td>â å®å¨éè</td>
<td>â å§ç»æ¾ç¤º</td>
</tr>
<tr>
<td><strong>æºç å¯ç¼è¾</strong></td>
<td>â é¾æ¥ãå¾çå¯ç´æ¥ç¼è¾</td>
<td>â ï¸ é¨åæ¯æ</td>
<td>â å¦</td>
<td>â æ¯</td>
</tr>
<tr>
<td><strong>ææ¯æ </strong></td>
<td>ProseMirror + Milkdown</td>
<td>èªç </td>
<td>èªç </td>
<td>CodeMirror</td>
</tr>
<tr>
<td><strong>æ©å±æ§</strong></td>
<td>â æä»¶åæ¶æ</td>
<td>â ä¸æ¯ææä»¶</td>
<td>â ï¸ æéç API</td>
<td>â VS Code æä»¶çæ</td>
</tr>
<tr>
<td><strong>æ§è½</strong></td>
<td>â ä¼ç§</td>
<td>â ä¼ç§</td>
<td>â ï¸ å¤§ææ¡£è¾æ¢</td>
<td>â ä¼ç§</td>
</tr>
<tr>
<td><strong>è·¨å¹³å°</strong></td>
<td>â Windows/Mac/Linux</td>
<td>â Windows/Mac/Linux</td>
<td>â Web/æ¡é¢/ç§»å¨</td>
<td>â Windows/Mac/Linux</td>
</tr>
</tbody>
</table>
<p><strong>milkup çä¼å¿ï¼</strong></p>
<ul>
<li><strong>å¼æºåè´¹</strong>ï¼å®å¨å¼æºï¼å¯èªç±å®å¶</li>
<li><strong>ç°ä»£åææ¯æ </strong>ï¼åºäº Vue 3 + TypeScript + ProseMirror</li>
<li><strong>å¯æ©å±æ§å¼º</strong>ï¼æä»¶åæ¶æï¼æäºæ·»å æ°åè½</li>
<li><strong>æºç ç¼è¾è½å</strong>ï¼é¾æ¥åå¾çå¯ç´æ¥ç¼è¾ï¼æ éåæ¢æ¨¡å¼</li>
</ul>
<p><strong>Typora çä¼å¿ï¼</strong></p>
<ul>
<li><strong>æçç¨³å®</strong>ï¼ç»è¿å¤å¹´æç£¨ï¼åè½å®å</li>
<li><strong>ç¨æ·ä½éª</strong>ï¼ç»èæç£¨å°ä½ï¼äº¤äºæµç</li>
</ul>
<p><strong>Notion çä¼å¿ï¼</strong></p>
<ul>
<li><strong>åä½è½å</strong>ï¼å¤äººå®æ¶åä½</li>
<li><strong>æ°æ®åºåè½</strong>ï¼ä¸ä»æ¯ç¼è¾å¨ï¼è¿æ¯ç¥è¯ç®¡çå·¥å·</li>
</ul>
<h3 id="42-ai-ç»­ååè½å¯¹æ¯">4.2 AI ç»­ååè½å¯¹æ¯</h3>
<table>
<thead>
<tr>
<th>ç¹æ§</th>
<th>milkup (feat-ai)</th>
<th>Cursor</th>
<th>Notion AI</th>
<th>GitHub Copilot</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ¯æåºæ¯</strong></td>
<td>Markdown ææ¡£</td>
<td>ä»£ç ç¼è¾</td>
<td>ææ¡£ç¼è¾</td>
<td>ä»£ç ç¼è¾</td>
</tr>
<tr>
<td><strong>å¤æä¾å</strong></td>
<td>â OpenAI/Claude/Gemini/Ollama</td>
<td>â ä» OpenAI</td>
<td>â èªææ¨¡å</td>
<td>â ä» GitHub æ¨¡å</td>
</tr>
<tr>
<td><strong>æ¬å°æ¨¡å</strong></td>
<td>â æ¯æ Ollama</td>
<td>â å¦</td>
<td>â å¦</td>
<td>â å¦</td>
</tr>
<tr>
<td><strong>ç»æåçè§£</strong></td>
<td>â çè§£æ é¢å±çº§</td>
<td>â çè§£ä»£ç ç»æ</td>
<td>â ï¸ æé</td>
<td>â çè§£ä»£ç ä¸ä¸æ</td>
</tr>
<tr>
<td><strong>è§¦åæ¹å¼</strong></td>
<td>èªå¨é²æè§¦å</td>
<td>èªå¨è§¦å</td>
<td>æå¨è§¦å</td>
<td>èªå¨è§¦å</td>
</tr>
<tr>
<td><strong>æ¥åæ¹å¼</strong></td>
<td>Tab é®</td>
<td>Tab é®</td>
<td>ç¹å»æé®</td>
<td>Tab é®</td>
</tr>
<tr>
<td><strong>å¼æº</strong></td>
<td>â æ¯</td>
<td>â å¦</td>
<td>â å¦</td>
<td>â å¦</td>
</tr>
<tr>
<td><strong>éç§ä¿æ¤</strong></td>
<td>â æ¯ææ¬å°æ¨¡å</td>
<td>â æ°æ®ä¸ä¼ äºç«¯</td>
<td>â æ°æ®ä¸ä¼ äºç«¯</td>
<td>â æ°æ®ä¸ä¼ äºç«¯</td>
</tr>
</tbody>
</table>
<p><strong>milkup çä¼å¿ï¼</strong></p>
<ul>
<li><strong>å¤æä¾åæ¯æ</strong>ï¼å¯èªç±éæ© AI æå¡</li>
<li><strong>æ¬å°ä¼å</strong>ï¼æ¯æ Ollamaï¼ä¿æ¤éç§</li>
<li><strong>å¼æºéæ</strong>ï¼ä»£ç å¬å¼ï¼å¯å®¡è®¡</li>
<li><strong>éå¯¹ Markdown</strong>ï¼ä¸é¨ä¼åææ¡£åä½åºæ¯</li>
</ul>
<p><strong>Cursor/Copilot çä¼å¿ï¼</strong></p>
<ul>
<li><strong>ä»£ç ä¸ç²¾</strong>ï¼éå¯¹ä»£ç ç¼è¾ä¼å</li>
<li><strong>ä¸ä¸ææ´ä¸°å¯</strong>ï¼å¯ä»¥çè§£æ´ä¸ªé¡¹ç®</li>
<li><strong>æçåº¦é«</strong>ï¼ç»è¿å¤§éç¨æ·éªè¯</li>
</ul>
<p><strong>Notion AI çä¼å¿ï¼</strong></p>
<ul>
<li><strong>å¤åè½</strong>ï¼ä¸ä»ç»­åï¼è¿æ¯ææ»ç»ãç¿»è¯ãæ¹åç­</li>
<li><strong>éæåº¦é«</strong>ï¼ä¸ Notion çææ·±åº¦éæ</li>
</ul>
<hr>
<h2 id="äºæ»ç»ä¸å±æ">äºãæ»ç»ä¸å±æ</h2>
<h3 id="51-ææ¯æ»ç»">5.1 ææ¯æ»ç»</h3>
<p>éè¿ feat-ir å feat-ai ä¸¤ä¸ªåæ¯çå¼åï¼milkup å¨ Markdown ç¼è¾å¨é¢åå®ç°äºéè¦çªç ´ï¼</p>
<p><strong>å³æ¶æ¸²ææ¨¡å¼ï¼feat-irï¼ï¼</strong></p>
<ul>
<li>åºäº ProseMirror Decoration ç³»ç»å®ç°</li>
<li>æºè½æ¾ç¤ºæºç ï¼åæ èç¦æ¶å¯è§</li>
<li>æ¯æé¾æ¥åå¾ççå³æ¶ç¼è¾</li>
<li>æ§è½ä¼åï¼å¤§ææ¡£æµçè¿è¡</li>
</ul>
<p><strong>AI ç»­ååè½ï¼feat-aiï¼ï¼</strong></p>
<ul>
<li>æ¯æ OpenAIãClaudeãGeminiãOllama ç­å¤ä¸ªæä¾å</li>
<li>ç»æåçè§£ææ¡£ï¼æåæ é¢å±çº§åä¸ä¸æ</li>
<li>ä¼éç UI éæï¼åéæå»ºè®®ä¸å¹²æ°éè¯»</li>
<li>é²æååæ¶æºå¶ï¼ä¼åæ§è½åææ¬</li>
</ul>
<p><strong>ææ¯äº®ç¹ï¼</strong></p>
<ol>
<li><strong>æä»¶åæ¶æ</strong>ï¼æäºæ©å±åç»´æ¤</li>
<li><strong>ç°ä»£åææ¯æ </strong>ï¼Vue 3 + TypeScript + ProseMirror</li>
<li><strong>ç¨æ·ä½éªä¼å</strong>ï¼æµççäº¤äºï¼ä¼éçè§è§è®¾è®¡</li>
<li><strong>å¼æºéæ</strong>ï¼ä»£ç å¬å¼ï¼ç¤¾åºé©±å¨</li>
</ol>
<h3 id="52-æªæ¥å±æ">5.2 æªæ¥å±æ</h3>
<p><strong>ç­æè®¡åï¼</strong></p>
<ol>
<li><strong>åè½å®å</strong>ï¼</li>
</ol>
<ul>
<li>æ¯ææ´å¤ Markdown åç´ çå³æ¶æ¸²æï¼è¡¨æ ¼ãå¬å¼ï¼</li>
<li>AI ç»­åæ¯ææ´å¤åºæ¯ï¼ä»£ç åãåè¡¨ï¼</li>
<li>æ·»å  AI æ¹åãæ»ç»ç­åè½</li>
</ul>
<ol>
<li><strong>æ§è½ä¼å</strong>ï¼</li>
</ol>
<ul>
<li>å¤§ææ¡£æ§è½ä¼å</li>
<li>AI è¯·æ±ç¼å­æºå¶</li>
<li>å¢éæ¸²æ</li>
</ul>
<ol>
<li><strong>ç¨æ·ä½éª</strong>ï¼</li>
</ol>
<ul>
<li>æ´ä¸°å¯çå¿«æ·é®</li>
<li>èªå®ä¹ä¸»é¢</li>
<li>æ´å¤éç½®éé¡¹</li>
</ul>
<p><strong>é¿ææ¿æ¯ï¼</strong></p>
<ol>
<li><strong>åä½è½å</strong>ï¼</li>
</ol>
<ul>
<li>å¤äººå®æ¶åä½</li>
<li>çæ¬æ§å¶éæ</li>
<li>è¯è®ºåæ¹æ³¨</li>
</ul>
<ol>
<li><strong>ç¥è¯ç®¡ç</strong>ï¼</li>
</ol>
<ul>
<li>ååé¾æ¥</li>
<li>æ ç­¾ç³»ç»</li>
<li>å¨ææç´¢</li>
</ul>
<ol>
<li><strong>AI æ·±åº¦éæ</strong>ï¼</li>
</ol>
<ul>
<li>æºè½å¤§çº²çæ</li>
<li>èªå¨æçä¼å</li>
<li>å¤è¯­è¨ç¿»è¯</li>
<li>è¯­æ³æ£æ¥åæ¹è¿å»ºè®®</li>
</ul>
<ol>
<li><strong>çæå»ºè®¾</strong>ï¼</li>
</ol>
<ul>
<li>æä»¶å¸åº</li>
<li>ä¸»é¢ååº</li>
<li>ç¤¾åºè´¡ç®</li>
</ul>
<h3 id="53-è´è°¢">5.3 è´è°¢</h3>
<p>æè°¢ææä¸º milkup é¡¹ç®ååºè´¡ç®çå¼åèåç¨æ·ãç¹å«æè°¢ï¼</p>
<ul>
<li><strong>Milkdown</strong> å¢éï¼æä¾äºä¼ç§çç¼è¾å¨æ¡æ¶</li>
<li><strong>ProseMirror</strong> ç¤¾åºï¼å¼ºå¤§çç¼è¾å¨åæ ¸</li>
<li><strong>Vue.js</strong> å¢éï¼ç°ä»£åçåç«¯æ¡æ¶</li>
<li><strong>Anthropic</strong>ï¼Claude Code çå¼åæ¯æ</li>
</ul>
<h3 id="54-åèèµæº">5.4 åèèµæº</h3>
<p><strong>é¡¹ç®å°åï¼</strong></p>
<ul>
<li>GitHub: <a href="https://github.com/auto-plugin/milkup" target="_blank" rel="noopener nofollow">milkup</a></li>
</ul>
<h2 id="ç»è¯­">ç»è¯­</h2>
<p>milkup çå¼åæ¯ä¸æ¬¡æè¶£çææ¯æ¢ç´¢ä¹æãæä»¬ä¸ä»å®ç°äºç±»ä¼¼ Typora çå³æ¶æ¸²ææ¨¡å¼ï¼è¿å¨ AI éææ¹é¢èµ°å¨äºååã</p>
<p>ä½ä¸ºä¸ä¸ªå¼æºé¡¹ç®ï¼milkup çæé¿ç¦»ä¸å¼ç¤¾åºçæ¯æãæä»¬æ¬¢è¿ä»»ä½å½¢å¼çè´¡ç®ï¼ä»£ç ãææ¡£ãå»ºè®®ãbug æ¥åãè®©æä»¬ä¸èµ·æé ä¸ä¸ªæ´å¥½ç Markdown ç¼è¾å¨ï¼</p>
<p>å¦æä½ å¯¹ milkup æå´è¶£ï¼æ¬¢è¿ï¼</p>
<ul>
<li>â­ Star é¡¹ç®</li>
<li>ð æäº¤ Issue</li>
<li>ð§ è´¡ç®ä»£ç </li>
<li>ð¬ å å¥è®¨è®º</li>
</ul>
<p>è®©æä»¬ä¸èµ·æ¨å¨ Markdown ç¼è¾å¨çåå±ï¼</p>
<hr>
<p><strong>ä½èï¼</strong> å¾·è±åæ¯ &amp; Claude Code <strong>æ¥æï¼</strong> 2026 å¹´ 2 æ <strong>çæ¬ï¼</strong> v1.0</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 17:24">2026-02-04 17:23</span>&nbsp;
<a href="https://www.cnblogs.com/Kay-Larry">ç¥çÂ·å¾·è±åæ¯</a>&nbsp;
éè¯»(<span id="post_view_count">54</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19575577);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19575577', targetLink: 'https://www.cnblogs.com/Kay-Larry/p/19575577', title: 'milkupï¼æ¡é¢ç«¯ markdown AIç»­ååå³æ¶æ¸²æ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åºäºé¡¹ç®å·¥ç¨æå»ºSBOMï¼è½¯ä»¶ç©ææ¸åï¼çç ç©¶ ]]></title>
    <link>https://www.cnblogs.com/huangqian/p/19575355</link>
    <guid>e828b9cd0116fcce87a90d1f9f9a7f39</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huangqian/p/19575355" title="åå¸äº 2026-02-04 16:59">
    <span role="heading" aria-level="2">åºäºé¡¹ç®å·¥ç¨æå»ºSBOMï¼è½¯ä»¶ç©ææ¸åï¼çç ç©¶</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        ç ç©¶é¡¹ç®çSBOMï¼è½¯ä»¶ç©ææ¸åï¼ççæãä¼æ¶åå°åä¸ªSBOMçæå·¥å·ï¼sbom-toolï¼DycloneDXï¼Siftï¼ORTï¼åå«å°±æ¯ä¸ªå·¥å·çä¼ç¼ºç¹åè¯´æçï¼ååºå¶å³é®å½ä»¤åå½ä»¤åæ°ï¼å¹¶è¯´æå¶å¨å®éä½¿ç¨è¿ç¨ä¸­çä¼å£ç¹ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æè¿å¬å¸å¯å¨äºä¸ä¸ªæ°å»çé¡¹ç®ï¼æç»éè¦å¨å½å¤æ³¨åä½¿ç¨ï¼å¦ç¾å½FDAï¼æ¬§çï¼ï¼å æ­¤é¡¹ç®å¨çå½å¨æç®¡çè¿ç¨å¿é¡»ä¸¥æ ¼ï¼ä¸ºæ»¡è¶³åè§è¦æ±ï¼å¶ä¸­å¿ä¸å¯å°çä¸æ­¥æ¯çæSBOMï¼è½¯ä»¶ç©ææ¸åï¼ãä¸´æ¶ç»å®æä¸ä¸ªä»»å¡ï¼æ¥ç ç©¶SBOMççæãæ¶åå°åä¸ªSBOMçæå·¥å·ï¼sbom-toolï¼DycloneDXï¼Siftï¼ORTãç¶åå°±å¼åè¯­è¨æ¥è¯´ï¼å¬å¸é¡¹ç®æä¸ç§æ¨¡å¼ï¼çº¯C#é¡¹ç®ï¼C++åC#æ··åä½¿ç¨çé¡¹ç®ï¼çº¯C++é¡¹ç®ï¼è¿éå°±æè¿å å¤©çç ç©¶å¿å¾åä¸ä¸ªæ»ç»ã</p>
<p><strong>sbom-tool</strong><br>
SBOM Toolæ¯ææåå¼å§ï¼æ¯ç«æ¬äººä¸»è¦ä»äºC#å¼åï¼èSBOM Toolï¼SBOM Tool.exeï¼æ¯å¾®è½¯å¼åçå¼æºå½ä»¤è¡å·¥å·ï¼ç¨äºèªå¨çæåéªè¯ç¬¦åSPDX 2.2/3.0æ åçè½¯ä»¶ç©ææ¸åï¼SBOMï¼ï¼æ¯æè·¨å¹³å°å®è£åå¤ç§ä½¿ç¨åºæ¯ãè¿éå®è£æ¹æ³å°±ä¸åä»ç»ï¼ç½ä¸èµææä¸å°±æ¯ï¼åæ¬åç»­å ç§å·¥å·å®è£é½ä¸åä»ç»ãæè¿éæ¯ä½ä¸ºdotnetå·¥å·å¨å±å®è£çãå¯ä»¥ç´æ¥å¨windowsç³»ç»çCMDå½ä»¤ä¸ï¼å®ä½å°å·¥ç¨ç¼è¯ä¹åçè¾åºç®å½ï¼ä½¿ç¨ç±»ä¼¼å¦ä¸çå³é®çå½ä»¤æ¥çæSBOMãè¥æ¯è¦æç»­çéæCD/CIï¼å¨Visual Studioå¼åå·¥å·ä¸ï¼ä¹å¯ä»¥å¨é¡¹ç®å·¥ç¨ä¸å³é®-&gt;å±æ§-&gt;çæ-&gt;é¡¹ç®ççææååçäºä»¶ä¸­æ¤å¥æ­¤å½ä»¤ï¼æ¥å¯¹æ¯æ¬¡çæå»ºé½éæ°çææ°çsbomãå½ç¶ä¹å¯ä»¥å°å½ä»¤ä½ä¸ºä¸ä¸ª.batæ¹å¤çæä»¶ï¼å¨é¡¹ç®çææååæ¥æ§è¡æ­¤æä»¶æ¥å¤çSBOMççæã</p>
<p>ç´æ¥CMDä¸­ä½¿ç¨ç¤ºä¾1ï¼sbom-tool generate -b é¡¹ç®å·¥ç¨ç¼è¯ä¹åçè¾åºç®å½ -pn "MyApp" -pv "1.0.0" -ps ä¾åºååç§° -m ./sbom-output</p>
<details>
<summary>sbom-toolæå»ºSBOMå³é®åæ°åç¤ºä¾</summary>
<pre><code>-bï¼æå»ºäº§ç©çæ ¹ç®å½ï¼å³ä»£ç ç¼è¯ä¹åçè¾åºç®å½
-bc: é¡¹ç®æºç ç®å½,çææ¶çä¸äºåæ°æ®ä¼éè¿æºç è·åå°,éå¿é¡».
-pn: ååç§°ï¼å»ºè®®æ¾ç¤ºæå®
-pvï¼åçæ¬å·
-psï¼åçä¾åºåä¿¡æ¯ï¼æå®ååç§°åä¸è½ä¸ºç©º
-m:  æå®çæçSBOMçè¾åºç®å½ï¼-Då¼ºå¶å é¤å·²æç®å½ã
-blï¼ æå®åå«çæä»¶ï¼åå»ºä¸ä¸ªåå«æä»¶åè¡¨çææ¬ææ¬ï¼æ¯ä¸ªæä»¶ä½¿ç¨å®æ´è·¯å¾åç¬ä¸è¡ï¼ä½¿ç¨æ­¤åæ°å·¥å·åªä¼å¤ççæåè¡¨ä¸­æç¡®æå®çæä»¶

å¨å·¥ç¨æä»¶ççæåäºä»¶éç½®æ§è¡sbomçæå½ä»¤ä»£ç ï¼æè¿éä»£ç æ¯æ³¨éçç¶æï¼
	&lt;!-- å®ä¹çæSBOMçç®æ  --&gt;
	&lt;Target Name="GenerateSBOM" AfterTargets="Build"&gt;
		&lt;!--ä½¿ç¨blå½ä»¤è¿è¡æä»¶è¿æ»¤,åªå¤çæå®çæä»¶--&gt;
		&lt;!--&lt;Exec Command="sbom-tool generate -b $(OutputPath) -bl $(SbomIncludeFilesPath) -pn $(SbomPackageName) -pv $(SbomPackageVersion) -ps $(SbomCompanay) -m $(OutputPath)\sbom"  /&gt;--&gt;
		&lt;!--&lt;Exec Command="sbom-tool generate -b $(OutputPath) -bc $(SbomSourceCodePath) -pn $(SbomPackageName) -pv $(SbomPackageVersion) -ps $(SbomCompanay) -m $(OutputPath)\sbom"  /&gt;--&gt;
		&lt;!--&lt;Exec Command="D:\Release\sbom\Generate-SBOM.bat"  /&gt;--&gt;
	&lt;/Target&gt;

</code></pre>
</details>
<p>æè¿éé¦åæ¯éå¯¹C#çé¡¹ç®ä½¿ç¨sbom-toolå·¥å·è¿è¡SBOMçæï¼è¿ä¸ªçæçæ¯ç¬¦åSPDXæ åçSBOMï¼è¿ä¸ªè¿ç¨ä¸­ç¡®å®å¾é¡ºå©ï¼ä½¿ç¨ç®åçå½ä»¤è¿è¡ç«é©¬åºæ¥ç»æï¼ä½å½æéè¦æé¤ä¸äºæä»¶æç»ä»¶æ¶ï¼ç¡®åç°sbom-toolæ å¯¹åºçå½ä»¤æ¥æé¤æä»¶ï¼å½ç¶ï¼å¶æä¾äº-blå½ä»¤åæ°æ¥æå®åªå¯¹é£äºæä»¶çæSBOMãç¶åéå¯¹æ·±åº¦ä¾èµï¼å³åµå¥ä¾èµé®é¢è¯å«ä¸åå¥½æèè¯´è¯å«ä¸äºï¼æ¥éä¸æ¥è¯´éè¦åå©ä¸å¶ä»ææ®µæå·¥å·ï¼éå¯¹C++é¡¹ç®ä¹æ¯å¦æ­¤ã</p>
<p><strong>CycloneDX</strong><br>
æ­¤æ¶å°±å¼å§äºå¯¹ç¬¬äºä¸ªå·¥å·CycloneDXçç ç©¶ï¼è¿ä¸ªå·¥å·çæçæ¯ç¬¦åCycloneDXæ åçSBOMï¼è¿éæä¹æ¯å°å¶ä½ä¸ºdotnetå·¥å·è¿è¡å¨å±å®è£çï¼å®è£å½ä»¤ï¼dotnet tool install --global CycloneDXï¼ï¼éè¦æ³¨æçæ¯ä¸è¦ä½¿ç¨æ§çé¡¹ç®ï¼å¦.NET Frameworkçé¡¹ç®æ¥ä½¿ç¨æ­¤å·¥å·ï¼æè¿è¾¹å°±æ¯å¨NET Frameworkä¸­ä½¿ç¨äºæ­¤å·¥å·è¿è¡çæï¼æä¹èµ°é½æ²¡éï¼ä¹åå°±æ¯å¿½ç¥äºç½ä¸AIèµæææçï¼SycloneDX for .NETç®åä¸æ¯ææ©æççæ¬ï¼.NET Frameworkï¼.NET Coreçæ©æçæ¬(å¦NET Core 2.1ï¼NET Core 3.1ï¼NET Core 5.0)ï¼åæ¥æ¿å¬å¸çä¸ä¸ª.NET 8é¡¹ç®æ¥å°è¯ä½¿ç¨æ­¤CycloneDXï¼ç«é©¬å°±è½èµ°éäºãä½å¨C#é¡¹ç®ä¸ï¼CycloneDX é»è®¤æåµä¸å®ä¼åæé¡¹ç®ç NuGet åä¾èµï¼åæ¬ç´æ¥åä¼ éä¾èµï¼ï¼ä½ä¸ä¼èªå¨åå«é¡¹ç®å¼ç¨ï¼Project Referencesï¼æçæç DLL æä»¶ï¼å ä¸ºè¿äº DLL è¢«è§ä¸ºâåé¨ç»ä»¶âèéå¤é¨ç¬¬ä¸æ¹ä¾èµãä½ä¸ºè§£å³åæ³ï¼ä» CycloneDX .NET å·¥å· v2.0+ å¼å§ï¼å®æ¹æ¯æéè¿å½ä»¤è¡åæ°æ¾å¼åå«é¡¹ç®å¼ç¨ãä½¿ç¨ --include-project-references åæ°ï¼æ³¨æï¼æ­¤æ¶å°±éè¦ä½¿ç¨å·¥ç¨ç®å½ï¼èä¸è½ä½¿ç¨è§£å³æ¹æ¡ç®å½,å³.csprojæä»¶ï¼èé.slnæä»¶ãå¨åªæ.dllæä»¶ï¼å³éä¾¿æ·è´ä¸ä¸ªå¤é¨æ ç¨ç.DLLæä»¶æ¾å¨ç¼è¯åçè¾åºç®å½ä¸­ï¼CycloneDX .NETä¸ä¼èªå¨è¯å«å¶ç»æï¼å³SBOMä¸­æ²¡ææ­¤é¡¹ãè¥éè¦çè¯å¯ä»¥å°å¶ä½ä¸ºä¸ä¸ªNuGetç§ææºè¿è¡å¼å¥ã</p>
<p>ä½¿ç¨CycloneDXçæSBOMçåèå½ä»¤ï¼<br>
å½ä»¤ç¤ºä¾ï¼<code>dotnet cyclonedx  ..\CSharp_Sbom.sln --output-format json --exclude-dev --exclude-test-projects -sn YourCompany -sv 1.0.0  -o ..\SbomScript\CycloneDX_sbom -fn sbom.json </code><br>
<img src="https://img2024.cnblogs.com/blog/297997/202602/297997-20260204161039726-830266260.png" alt="image" loading="lazy"></p>
<p>å¨C#é¡¹ç®ä¸­ä½¿ç¨CycloneDXå·¥å·æ¶ï¼ä¹æ¯é¡ºå©ççæäºéè¦çSBOMï¼ä½æ¯å½å¨C++é¡¹ç®ä¸çææ¶ï¼è¿éåè¯´ä¸ï¼ä½¿ç¨çC++é¡¹ç®æ¶ä¸´æ¶åå»ºçï¼æ æ åçåç®¡çå¨ï¼ä¹æ²¡æç¨CMakeï¼Conanævcpkgç®¡çä¾èµãæç»çæåºæ¥çsbomæä»¶ä¸­ç¡®æ²¡æä»»ä½ç»ä»¶æèè¯´æ²¡æä»»ä½ä¾èµï¼ä¹å°±æ¯jsonæä»¶ä¸­çdependenciesåç´ éé¢æ²¡æåå«ä»»ä½ä¸è¥¿ãä¹å°±æ¯æ æ³ç´æ¥ä½¿ç¨è¿ä¸ªå·¥å·æ¥çæC++é¡¹ç®çSBOM,è¿å°±å°´å°¬äºãåæ¥æ¥èµæå¤§æ¦æææ¯è¯´ï¼å ä¸ºC++ç¼ºä¹ç»ä¸çä¾èµç®¡çæºå¶ï¼å¦ Java ç Maven æ Node.js ç npm , C#çNuGetï¼ï¼ä¸è½ç´æ¥è§£æä¾èµä¿¡æ¯ã</p>
<p><strong>Syft</strong><br>
ç¶åå°±å¼å§äºæçç¬¬ä¸ä¸ªå·¥å·Syftçç ç©¶ï¼Syftä¼èªå¨æ«æï¼æ£æµæå»ºäº§ç©ä¸­çäºè¿å¶æä»¶åå¨æé¾æ¥åºæ¥è¯å«ç¬¬ä¸æ¹ç»ä»¶ï¼èªå¨è¯å«æåçæä¾èµåï¼å¹¶è¾åºSBOMãæ¯ææ ¼å¼ï¼CycloneDXãSPDXãSyft JSON ç­ï¼æ¯ç± Anchore å¼åçå¼æº CLI å·¥å·ï¼æ¯Goè¯­è¨ç¼åã<br>
SyftçæSBOMåèå½ä»¤ï¼ <code>syft . -o cyclonedx-json=../../sbom/syft/syft.cdx.json -vv</code><br>
<img src="https://img2024.cnblogs.com/blog/297997/202602/297997-20260204163404903-680685072.png" alt="5E7673D9-61DC-4829-8EC9-FA8C3A1B5E65" loading="lazy"><br>
<img src="https://img2024.cnblogs.com/blog/297997/202602/297997-20260204163504326-995103179.png" alt="526ABF57-406F-4c90-B9F8-CA122919BA9A" loading="lazy"><br>
-v è¾åºè­¦åä¿¡æ¯<br>
-vv è¾åºè°è¯ä¿¡æ¯<br>
ä½¿ç¨Syftç¡®å®è½åå°èªå¨è¯å«C++çé¡¹ç®çæSBOMï¼ä½ä¹ä»ä»æ¯æéçæ¯æï¼å³ä»è½è¯å«å·²ç¥ç¹å¾çåºï¼æ æ³è¿åå®æ´ä¾èµæ ï¼å°¤å¶éæé¾æ¥ãå¨æå è½½çä»¥åèªå®ä¹ç¼è¯çåºï¼ï¼åªå C++é¡¹ç®æ åç®¡çå¨æèè¯´æäºC++é¡¹ç®æ²¡æä½¿ç¨ç»ä¸çä¸å¥åç®¡çæµç¨ï¼çº¯ CMake/Makefile + éæé¾æ¥æåµä¸ï¼åªæSyftå¯è¡ãè½ä»äºè¿å¶ä¸­è¯å« OpenSSLãzlibãlibpngãglibc ç­å¸¸è§åºï¼å³ä½¿éæé¾æ¥ï¼ï¼ç»è¿ä¸çªæè¾ï¼è¿éåçå°äºå¦å¤ä¸ä¸ªå·¥å·OSS Review Toolkit (ORT) ï¼ä½ç»è¿äºè§£ä¸æ¥è¯´è¿æ¯ä¸ä¸ªå¨æµç¨çåè§å®¡è®¡å·¥å·ï¼å ä¸ºç®ååªéè¦ä¸ä¸ªSBOMå¿«éçæå·¥å·ï¼è²ä¼¼å­¦ä¹ ä½¿ç¨æ²çº¿æ´é«ï¼ä¸ä¸å­å°±åå°äºæè¿ç§æäººï¼ä¹å°±æå¾ç ç©¶äºã<br>
æåéä¸ä¸ä¸ªç®åçæ»ç»å¯¹æ¯è¯´æï¼<br>
<img src="https://img2024.cnblogs.com/blog/297997/202602/297997-20260204165300095-356125226.png" alt="5A97EFF3-207F-4f25-8E47-D2A8870A1A20" loading="lazy"></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.015277777777777777" data-date-updated="2026-02-04 17:21">2026-02-04 16:59</span>&nbsp;
<a href="https://www.cnblogs.com/huangqian">å¥åçå¤§é¾ç å</a>&nbsp;
éè¯»(<span id="post_view_count">45</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19575355);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19575355', targetLink: 'https://www.cnblogs.com/huangqian/p/19575355', title: 'åºäºé¡¹ç®å·¥ç¨æå»ºSBOMï¼è½¯ä»¶ç©ææ¸åï¼çç ç©¶' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ é¸¿èåºç¨å¼åUIåºç¡ç¬¬äºèï¼é¸¿èåºç¨ç¨åºæ¡æ¶æ ¸å¿è§£æä¸å®æ ]]></title>
    <link>https://www.cnblogs.com/san-xiu/p/19575201</link>
    <guid>7726aaf5f2a8c9e25099652324dffb06</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/san-xiu/p/19575201" title="åå¸äº 2026-02-04 16:36">
    <span role="heading" aria-level="2">é¸¿èåºç¨å¼åUIåºç¡ç¬¬äºèï¼é¸¿èåºç¨ç¨åºæ¡æ¶æ ¸å¿è§£æä¸å®æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å­¦ä¹ ç®æ ">å­¦ä¹ ç®æ </h2>
<ol>
<li>å»ºç«é¸¿èåºç¨âå®è§-å¾®è§âå®æ´è®¤ç¥ï¼æç¡®åºç¨ãåºç¨ç¨åºåãHAP/HSPãç»ä»¶ãé¡µé¢çå±çº§å³ç³»ï¼çè§£ Stage æ¨¡åç¼è¯æä¸è¿è¡ææ¦å¿µçå¯¹åºé»è¾ï¼</li>
<li>æ¸æ°åºå Stage æ¨¡åä¸ FA æ¨¡åçæ ¸å¿å·®å¼ï¼çè§£ Stage æ¨¡åå¨èµæºå©ç¨ãéç½®ç®¡çãè·¨ç«¯ééç­å®éå¼ååºæ¯ä¸­çæ ¸å¿ä¼å¿ï¼</li>
<li>ææ¡ Stage æ¨¡åè¿ç¨/çº¿ç¨ç®¡çæºå¶ï¼çè§£ UIAbility ä¸ ExtensionAbility ççº¿ç¨éç¦»ç¹æ§ï¼ä»¥åå¤çº¿ç¨å¼åçæ ¸å¿æè·¯ï¼</li>
<li>çç»ææ¡ UIAbility å¨ module.json5 ä¸­çæ ¸å¿éç½®é¡¹åè§åï¼ç²¾åå®ä½ Stage å·¥ç¨æ ¸å¿æä»¶å¹¶çæ¸ä¾èµé¾è·¯ï¼</li>
<li>è½ç¬ç«å®æåºç¨åç§°/å¾æ ä¿®æ¹ãUIAbility éç½®è°æ´ãé¡µé¢å è½½è·¯å¾åæ¢ç­å®æï¼ç»åå·¥ç¨ç¼è¯æºå¶éªè¯ææå¹¶ææ¥åºç¡éç½®ä¸ç¼è¯éè¯¯ã</li>
</ol>
<p>ä¸ä¸èæä»¬ææ¡äºåºç¨éç½®ç­¾åçæºè°è¯ï¼æ¬èå¼å§ä»âåºç¨æ´ä½æ¶æâåå¥ï¼èç¦ Stage æ¨¡åæ ¸å¿äº¤äºç»ä»¶ UIAbility æ ¸å¿è½åå±å¼ï¼ç»åå·¥ç¨ç¼è¯æºå¶ï¼å¸®å©æå»ºé¸¿èåºç¨å¼ååºç¡è®¤ç¥ä½ç³»ï¼ä¸ºåç»­åºç¨çå½å¨æãContext ä¸ä¸æãè¿ç¨éä¿¡ç­è¿é¶åå®¹å­¦ä¹ æä¸åºç¡ã</p>
<h2 id="ä¸åé¡¾é¸¿èç³»ç»æ¶æ">ä¸ãåé¡¾é¸¿èç³»ç»æ¶æ</h2>
<p>é¸¿èç³»ç»éç¨åå±æ¶æï¼å±åå±ï¼å¼åèæ ¸å¿å·¥ä½éä¸­å¨é¡¶å±ä¸¤å±ï¼</p>
<ol>
<li><strong>åºç¨å±</strong>ï¼é¢åç¨æ·çåºç¨è½½ä½ï¼åå«ä¸¤ç§å½¢æ
<ul>
<li>åçåºç¨ï¼åºäº ArkTS å¼åï¼æ§è½æä¼ï¼è½æ·±åº¦è°ç¨åå¸å¼è½åï¼æ¯é¸¿èçææ ¸å¿ï¼</li>
<li>åæå¡ï¼åå®è£ãè½»éä¾¿æ·ï¼éåé«é¢æ¬¡ãä½çå­åºæ¯ï¼å¦æ«ç æ¯ä»ï¼ï¼</li>
</ul>
</li>
<li><strong>æ¡æ¶å±</strong>ï¼å¼åèç¦å¨æ¡æ¶å±ï¼æä¾ ArkUI ç»ä»¶ãç¶æç®¡çãè·¯ç±/å¯¼èªè·³è½¬ç­æ ¸å¿è½åï¼åç»­ç»ä»¶å¼åãå¸å±è®¾è®¡åä¾èµæ­¤å±ï¼</li>
<li><strong>ç³»ç»æå¡å±</strong>ï¼å°è£åå¸å¼è½åãè®¾å¤ç®¡çç­åºç¡æå¡ï¼å¼åèéè¿ API è°ç¨å³å¯ï¼æ éå³æ³¨åºå±å®ç°ï¼</li>
<li><strong>åæ ¸å±</strong>ï¼è´è´£è¿ç¨è°åº¦ãåå­ç®¡çç­åºå±æä½ï¼å¼åèæ éæ·±å¥æ¥è§¦ã</li>
</ol>
<p><strong>å¾ 1ï¼é¸¿èç³»ç»æ¶æå¾</strong> - å±ç¤ºåå±æ¶æå±çº§å³ç³»ï¼æ æ³¨å¼åèæ ¸å¿å³æ³¨çåºç¨å±ä¸æ¡æ¶å±ã</p>
<p><img alt="é¸¿èç³»ç»æ¶ææå­¦çæ¬" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730991/202601/3730991-20260102093207059-982384169.png" class="lazyload"></p>
<blockquote>
<p>HarmonyOS 5.0 å¼å§å½»åºå®æ Linux åæ ¸åå®åå¼æ¾æºä»£ç é¡¹ç®ï¼AOSPï¼çå¨é¢æ¿æ¢ï¼éç¨çº¯é¸¿èåæ ¸ï¼HarmonyOS Kernelï¼ï¼å®ç°å¨æ èªç ãæ¬é¶æ®µææåå®¹ååºäºé¸¿è 5.0~6.0 çæ¬è¿è¡åºç¨å¼åè®²è§£ã</p>
</blockquote>
<h2 id="äºç¨åºæ¡æ¶æå¡ability-kit">äºãç¨åºæ¡æ¶æå¡ï¼Ability Kitï¼</h2>
<h3 id="ä¸æ ¸å¿å®ä¹">ï¼ä¸ï¼æ ¸å¿å®ä¹</h3>
<p>Ability Kitï¼ç¨åºæ¡æ¶æå¡ï¼æ¯é¸¿èç³»ç»ä¸ºåºç¨æä¾çæ ¸å¿è¿è¡æ¶åºç¡æ¡æ¶ï¼æ½è±¡æç¼åºç¨å¼åæéæ ¸å¿è½åï¼æä¾æ ååç»ä»¶ä½ç³»åè¿è¡æºå¶ã<strong>æ ¸å¿ä»·å¼æ¯è®©å¼åèåºäºç»ä¸æ¨¡åå¼ååºç¨ï¼åæ¶ä¿éåºç¨å¨å¤è®¾å¤ãå¤åºæ¯ä¸çå¼å®¹æ§ä¸æ§è½</strong>ã</p>
<h3 id="äºæ ¸å¿è½åä¸ä½¿ç¨åºæ¯">ï¼äºï¼æ ¸å¿è½åä¸ä½¿ç¨åºæ¯</h3>
<table>
<thead>
<tr>
<th>è½åèå´</th>
<th>å·ä½åå®¹</th>
<th>å¸åä½¿ç¨åºæ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>çå½å¨æä¸è¿ç¨ç®¡ç</td>
<td>åºç¨/ç»ä»¶è¿ç¨åå»ºéæ¯ãçå½å¨æè°åº¦</td>
<td>å¤ Module åºç¨å¼åï¼HAP/HSP åå·¥å®ç°åè½</td>
</tr>
<tr>
<td>ç»ä»¶äº¤äºè½å</td>
<td>ç»ä»¶é´/åºç¨é´è·³è½¬ãè·¨è®¾å¤æµè½¬</td>
<td>åå¬åºç¨åå¯å¨è§é¢ä¼è®®ç»ä»¶ãè´­ç©åºç¨è·³è½¬æ¯ä»åºç¨ãè§é¢è·¨è®¾å¤æµè½¬</td>
</tr>
<tr>
<td>åºç¡æ¯æè½å</td>
<td>ä¸ä¸æç¯å¢ãç³»ç»äºä»¶çå¬ãå¯å¨æ¡æ¶ãæå¾æ¡æ¶ç­</td>
<td>åºç¨å¿«æ·æ¹å¼éç½®ãç¨åºè®¿é®æ§å¶ãå¯ç èªå¨å¡«å</td>
</tr>
</tbody>
</table>
<h3 id="ä¸æ ¸å¿ç¹å¾">ï¼ä¸ï¼æ ¸å¿ç¹å¾</h3>
<ol>
<li><strong>æ ååå¼åèå¼</strong>ï¼æ½è±¡åºç¨å¼åéç¨è½åï¼æä¾ç»ä¸çç»ä»¶ä½ç³»ãçå½å¨æè§åï¼éä½è·¨è®¾å¤/è·¨çæ¬ééææ¬ï¼</li>
<li><strong>é«æèµæºè°åº¦</strong>ï¼ç»ä¸ç®¡çåºç¨è¿ç¨/çº¿ç¨ï¼ä¼åç»ä»¶å¯å¨ãåå­å ç¨ç­æ§è½ææ ï¼</li>
<li><strong>ç³»ç»è½åå°è£</strong>ï¼åç½®æå¾æ¡æ¶ãå¯å¨æ¡æ¶ãæµè½¬è½åç­ï¼æ éå¼åèæå¨å¯¹æ¥åºå±ç³»ç» APIï¼</li>
<li><strong>å¤åºæ¯æ¯æ</strong>ï¼éè¿ ExtensionAbility è¦çå¤ä»½ãè¾å¥æ³ãå¡çç­æ  UI/è½» UI åºæ¯ï¼å¹³è¡¡åè½æ©å±ä¸ç³»ç»ç®¡æ§ã</li>
</ol>
<h3 id="åæ ¸å¿å³è">ï¼åï¼æ ¸å¿å³è</h3>
<ul>
<li><strong>ArkUI</strong>ï¼UIAbility ç»ä»¶ä¸­å¯ä½¿ç¨ ArkUI çç»ä»¶ãäºä»¶ãå¨æãç¶æç®¡çç­è½åå®ç°çé¢å¼åï¼</li>
<li><strong>ArkTS</strong>ï¼æä¾è¯­è¨è¿è¡æ¶è½åï¼æ¯æ Ability Kit çä»£ç æ§è¡ï¼</li>
<li><strong>Hvigor</strong>ï¼é¸¿èå®æ¹æå»ºå·¥å·ï¼ä¸º Ability Kit ç¸å³ç»ä»¶ä¸éç½®æä¾ç¼è¯æå»ºè½åï¼å®ç°ä»£ç ä¸éç½®çå·¥ç¨åè½å°ã</li>
</ul>
<h2 id="ä¸é¸¿èåºç¨æ¨¡å">ä¸ãé¸¿èåºç¨æ¨¡å</h2>
<h3 id="ä¸æ ¸å¿å®ä¹ä¸ææè¦ç´ ">ï¼ä¸ï¼æ ¸å¿å®ä¹ä¸ææè¦ç´ </h3>
<p>åºç¨æ¨¡åæ¯ Ability Kit å¯¹åºç¨å¼åè½åçæ½è±¡å°è£ï¼å®ä¹åºç¨çç»ä»¶ä½ç³»ãè¿è¡æºå¶ãéç½®è§èç­æ ¸å¿è§åï¼æ ¸å¿ææè¦ç´ å¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>ææè¦ç´ </th>
<th>æ ¸å¿ä½ç¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>åºç¨ç»ä»¶</td>
<td>åºç¨è¿è¡å¥å£ï¼éè¿çå½å¨æåè°æç¥ç¶æåå</td>
</tr>
<tr>
<td>è¿ç¨/çº¿ç¨æ¨¡å</td>
<td>å®ä¹è¿ç¨/çº¿ç¨çåå»ºãéæ¯åéä¿¡æ¹å¼</td>
</tr>
<tr>
<td>ä»»å¡ç®¡çæ¨¡å</td>
<td>å®ä¹ä»»å¡åå»ºãéæ¯åä¸ç»ä»¶çå³èï¼ä»ç³»ç»åºç¨ï¼</td>
</tr>
<tr>
<td>åºç¨éç½®æä»¶</td>
<td>å­å¨åºç¨/ç»ä»¶éç½®ãæéç­ä¿¡æ¯ï¼ä¾ç¼è¯/è¿è¡é¶æ®µä½¿ç¨</td>
</tr>
</tbody>
</table>
<h3 id="äºæ¼è¿åç¨fa-æ¨¡å--stage-æ¨¡å">ï¼äºï¼æ¼è¿åç¨ï¼FA æ¨¡å â Stage æ¨¡å</h3>
<table>
<thead>
<tr>
<th>æ¨¡åç±»å</th>
<th>ééçæ¬</th>
<th>æ ¸å¿ç¶æ</th>
<th>å®æ¹å¼åä¼å¿</th>
</tr>
</thead>
<tbody>
<tr>
<td>FA æ¨¡å</td>
<td>API 7~8</td>
<td>å·²åæ­¢æ´æ°</td>
<td>-</td>
</tr>
<tr>
<td>Stage æ¨¡å</td>
<td>API 9+</td>
<td>ä¸»æ¨ä¸é¿ææ¼è¿</td>
<td>1. ç»ä»¶èè´£æ¸æ°ï¼å¼åæçæ´é«ï¼2. èµæºå ç¨æ´ä½ï¼å¯å¨éåº¦æ´å¿«ï¼3. è·¨ç«¯ééæ´ä¾¿æ·ï¼4. ç³»ç»è½åéææ´ç®åï¼5. ç¼è¯åå±è®¾è®¡ï¼æ¯ææ¨¡åæéç¼è¯ï¼æåå¼åæç</td>
</tr>
</tbody>
</table>
<h3 id="ä¸fa-æ¨¡åä¸-stage-æ¨¡åæ ¸å¿å·®å¼">ï¼ä¸ï¼FA æ¨¡åä¸ Stage æ¨¡åæ ¸å¿å·®å¼</h3>
<table>
<thead>
<tr>
<th>å¯¹æ¯ç»´åº¦</th>
<th>FA æ¨¡å</th>
<th>Stage æ¨¡å</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»ä»¶ä½ç³»</td>
<td>Page/Service/DataAbilityï¼å¿åå¯¹è±¡ï¼</td>
<td>UIAbility+ExtensionAbilityï¼ç±»ç»§æ¿ï¼</td>
</tr>
<tr>
<td>å¼ææºå¶</td>
<td>æ¯ä¸ªç»ä»¶ç¬äº« ArkTS å¼æå®ä¾</td>
<td>ææç»ä»¶å±äº«ä¸ä¸ª ArkTS å¼æå®ä¾</td>
</tr>
<tr>
<td>è¿ç¨æ¨¡å</td>
<td>ä¸»è¿ç¨+æ¸²æè¿ç¨</td>
<td>ä¸»è¿ç¨+å¯éç½®ç¬ç«è¿ç¨ï¼ExtensionAbilityæ¯æè¿ç¨èªå®ä¹ï¼</td>
</tr>
<tr>
<td>çº¿ç¨æ¨¡å</td>
<td>å¼æå®ä¾å¨éä¸»çº¿ç¨åå»ºï¼ä¸æ¯æè¿ç¨åå¯¹è±¡å±äº«</td>
<td>å¼æå®ä¾å¨ä¸»çº¿ç¨åå»ºï¼æ¯æè¿ç¨åå¯¹è±¡å±äº«</td>
</tr>
<tr>
<td>éç½®æä»¶</td>
<td>åä¸ config.jsonï¼æ··ç¼å¨å±/æ¨¡åéç½®ï¼</td>
<td>app.json5ï¼åºç¨çº§ï¼+ module.json5ï¼æ¨¡åçº§ï¼</td>
</tr>
<tr>
<td>ç¼è¯æºå¶</td>
<td>æ´ä½å·¥ç¨ç¼è¯ï¼ä¿®æ¹å±é¨ééæ°ç¼è¯å¨é¨</td>
<td>åå±ç¼è¯ï¼æ¯ææ¨¡å/å¨å±ç¼è¯ï¼æéç¼è¯ä¿®æ¹é¨åï¼æçæ´é«</td>
</tr>
</tbody>
</table>
<h3 id="åstage-æ¨¡åæ ¸å¿æ¶æä¸ç»æ">ï¼åï¼Stage æ¨¡åæ ¸å¿æ¶æä¸ç»æ</h3>
<h4 id="1-stage-æ¨¡åæ ¸å¿æ¶æå¾">1. Stage æ¨¡åæ ¸å¿æ¶æå¾</h4>
<p><strong>å¾ 2ï¼Stage æ¨¡åç¼è¯æ-è¿è¡ææ¶æå¾</strong> - å·¦ä¾§ä¸ºè¿è¡ææ¦å¿µï¼åºç¨å®ä¾åæµç¨ï¼ï¼å³ä¾§ä¸ºç¼è¯ææ¦å¿µï¼å¼åæåæµç¨ï¼ï¼å±ç¤ºâæ¨¡åâç»ä»¶âé¡µé¢âçæåä¸å®ä¾åå¯¹åºå³ç³»ã</p>
<p><img alt="Stageæ¨¡åå¼åæ¦è¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730991/202602/3730991-20260204163601834-1982599659.png" class="lazyload"></p>
<h4 id="2-æ ¸å¿ç»æåå">2. æ ¸å¿ç»æåå</h4>
<ol>
<li><strong>AbilityStage</strong>ï¼å¯éå®ç°ï¼è¥ä¸å®ç°ï¼ç³»ç»é»è®¤åå»ºï¼ï¼Entry/Feature ç±»å HAP çè¿è¡æ¶è½½ä½ï¼<strong>ä¸ä¸ª HAP å¯¹åºä¸ä¸ª AbilityStage å®ä¾</strong>ï¼è´è´£ HAP çåå§åãç»ä»¶åå»ºååãæ¨¡åçº§çå½å¨æç®¡çï¼</li>
<li><strong>UIAbility</strong>ï¼å¸¦ UI çæ ¸å¿äº¤äºç»ä»¶ï¼éè¿ WindowStage ç®¡ççªå£ï¼å®ç°ç¨æ·äº¤äºï¼</li>
<li><strong>ExtensionAbility</strong>ï¼é¢åç¹å®åºæ¯çæ©å±ç»ä»¶ï¼å¦ EntryBackupAbilityãInputMethodExtensionAbilityï¼ï¼æ¯ UIAbility çæ©å±ï¼ç¨äºæ çé¢çåå°è½åï¼å¦å¤ä»½ãè¾å¥æ³ï¼ï¼</li>
<li><strong>WindowStage</strong>ï¼ä¸ UIAbility å®ä¾ç»å®ççªå£ç®¡çå¨ï¼è´è´£çªå£åå»ºãéæ¯ï¼ä¸º ArkUI æä¾ç»å¶åºåï¼</li>
<li><strong>Context</strong>ï¼æ´¾çç±»ï¼ApplicationContext/AbilityStageContext/UIAbilityContextï¼ä¸ºä¸åå±çº§æä¾è¿è¡æèµæºè°ç¨ãæéç®¡çç­è½åï¼</li>
<li><strong>ä¸çº§çå½å¨æ</strong>ï¼Applicationï¼åºç¨çº§ï¼â AbilityStageï¼æ¨¡åçº§ï¼â UIAbility/ExtensionAbilityï¼ç»ä»¶çº§ï¼ï¼ç± Ability Kit ç»ä¸è°åº¦ï¼å®ç°èµæºç²¾ç»åç®¡çã</li>
</ol>
<h4 id="3-æ ¸å¿å±çº§å³ç³»è¯´æ">3. æ ¸å¿å±çº§å³ç³»è¯´æ</h4>
<ol>
<li>å±çº§å³èï¼Applicationï¼åºç¨å¨å±ï¼â AbilityStageï¼HAP æ¨¡åï¼â UIAbility/ExtensionAbilityï¼ç»ä»¶ï¼ï¼ä¾æ¬¡ä¾èµåå»ºï¼</li>
<li>ææå³ç³»ï¼UIAbilityâWindowStageâWindowâArkUI Pageï¼ä¸åå±çº§åææå¯¹åº Contextï¼</li>
<li>å¯¹åºå³ç³»ï¼Application â Bundleï¼AbilityStage â HAPï¼1:1 ç»å®ï¼ã</li>
</ol>
<pre><code># ç¼è¯æï¼å¼å/æåï¼
åºç¨ç¨åºåï¼Bundleï¼ â æ¨¡åï¼HAP/HSPï¼ â ç»ä»¶ï¼UIAbility/ExtensionAbilityï¼ â é¡µé¢ï¼Pageï¼

# è¿è¡æï¼å®è£/å¯å¨ï¼
Applicationï¼åºç¨å¨å±å®ä¾ï¼ â AbilityStageï¼HAP æ¨¡åå®ä¾ï¼ â ç»ä»¶å®ä¾ â é¡µé¢æ¸²æ
</code></pre>
<h3 id="äºstage-æ¨¡åå¼åä¸è¿è¡å¨æµç¨">ï¼äºï¼Stage æ¨¡åå¼åä¸è¿è¡å¨æµç¨</h3>
<h4 id="1-å¼åé¶æ®µ">1. å¼åé¶æ®µ</h4>
<p>å¼åèåºäº Stage æ¨¡åå®æåºç¨åè½å¼åä¸éç½®ï¼æ ¸å¿å·¥ä½åæ¬ï¼</p>
<ul>
<li><strong>åºç¨ç»ä»¶å¼å</strong>ï¼éè¿ UIAbility ç»ä»¶å¼åå¸¦çé¢çç¨æ·äº¤äºæ¨¡åï¼å¦åºç¨ä¸»çé¢ï¼ï¼éè¿ ExtensionAbility ç­ç»ä»¶å¼ååç±»æ©å±åè½æ¨¡åï¼</li>
<li><strong>æ¨¡åè§£è¦è®¾è®¡</strong>ï¼ä¸ºåå°ä¸ååè½æ¨¡åé´çä¾èµåè¦åï¼å¯å° UIAbility ååç±» ExtensionAbility çå®ç°åå«æ¾å¨ä¸åç HAP åä¸­ï¼åæ¶å°ä¸¤èå±åä¾èµçéç¨åè½æ¾å¨ HSP åä¸­ï¼</li>
<li><strong>éç½®æä»¶ç¼å</strong>ï¼å¨ app.json5 ä¸­éç½®åºç¨åç§°ãçæ¬å·ãåºç¨å¾æ ç­å¨å±ä¿¡æ¯ï¼å¨ module.json5 ä¸­éç½®å¯¹åº HAP åä¸çç»ä»¶æ¸åãç»ä»¶æéãè¿ç¨å½å±ç­æ¨¡åçº§ä¿¡æ¯ï¼éç½®ä¿¡æ¯ä¼å¨åºç¨ç¼è¯ãå®è£æ¶è¢«ç³»ç»è§£æï¼ä¾¿äºç³»ç»åå¶ä»æ¨¡åè¯å«ãäº¤äºã</li>
</ul>
<h4 id="2-è¿è¡é¶æ®µ">2. è¿è¡é¶æ®µ</h4>
<p>å½åºç¨å®è£å°è®¾å¤è¿è¡æ¶ï¼ç³»ç»éè¿ä¸å¥åºç¨è¿ç¨åçº¿ç¨çç®¡çæºå¶ï¼ç¡®ä¿åè½çæåºè¿è¡ï¼</p>
<ul>
<li>è¿ç¨æ¯åºç¨è¿è¡çåºç¡ååï¼è´è´£èµæºåéåéç¦»ï¼</li>
<li>çº¿ç¨æ¯è¿ç¨åçæ§è¡ååï¼è´è´£å·ä½ä»£ç é»è¾çæ§è¡ï¼</li>
<li>Ability Kit ç»ä¸ç®¡æ§è¿ç¨/çº¿ç¨çåå»ºãéæ¯åè°åº¦ï¼ä¿éåºç¨ç¨³å®è¿è¡ã</li>
</ul>
<h4 id="3-è¿ç¨æ¨¡å">3. è¿ç¨æ¨¡å</h4>
<ul>
<li>åºç¡è§åï¼UIAbility ç»ä»¶é»è®¤è¿è¡å¨åºç¨ä¸»è¿ç¨ä¸­ï¼ ExtensionAbility ç»ä»¶<strong>è¿ç¨è¡ä¸ºå¯éç½®</strong>ï¼å¯éè¿<code>module.json5</code>ä¸­ç<code>process</code>å­æ®µè¿è¡éç½®ï¼</li>
<li>éç½®æ¹å¼ï¼å¨ ExtensionAbility ç»ä»¶çéç½®èç¹ä¸­æ·»å <code>process</code>å­æ®µï¼å¼ä»¥<code>:</code>å¼å¤´è¡¨ç¤ºéç½®ä¸ºç¬ç«è¿ç¨è¿è¡ï¼æªéç½®åé»è®¤ä¸ UIAbility åè¿ç¨è¿è¡ï¼</li>
<li>éä¿¡è§åï¼ExtensionAbility ä¸ UIAbility åè¿ç¨æ¶ä¸ºçº¿ç¨éç¦»ç¶æï¼æ°æ®åèµæºä¸ç´æ¥äºéï¼ç¬ç«è¿ç¨æ¶ééè¿è·¨è¿ç¨éä¿¡æºå¶å®ç°æ°æ®äº¤äºï¼</li>
<li>æ ¸å¿ä»·å¼ï¼è¿ç¨å¯éç½®æ§å¼é¡¾äºåºç¨æ§è½åç¨³å®æ§ââè½»éæ©å±ç»ä»¶ä¸ä¸»è¿ç¨å±äº«èµæºï¼åå°è¿ç¨å¼éï¼æ ¸å¿/é«éç¦»æ§æ©å±ç»ä»¶ç¬ç«è¿ç¨è¿è¡ï¼é¿ååä¸ç»ä»¶å¼å¸¸å½±åæ´ä¸ªåºç¨ã</li>
</ul>
<h4 id="4-ç»ä»¶éä¿¡æºå¶">4. ç»ä»¶éä¿¡æºå¶</h4>
<p>é¸¿èæä¾å¤å¥éä¿¡æºå¶ï¼ééä¸åç»ä»¶ç±»åãä¸åè¿ç¨å½å±çéä¿¡åºæ¯ï¼æ ¸å¿åç±»å¦ä¸ï¼</p>
<ul>
<li><strong>è¿ç¨åéä¿¡</strong>ï¼éç¨äºåä¸è¿ç¨åç UIAbility ä¸ ExtensionAbilityãUIAbility ä¸é¡µé¢é´ï¼ä¼åä½¿ç¨<strong>EventHub</strong>ï¼è½»éé«æãæ éå¤æéç½®ï¼</li>
<li><strong>è·¨è¿ç¨éä¿¡</strong>ï¼éç¨äºè·¨åºç¨ãç¬ç«è¿ç¨ç HAP ä¹é´ãç¬ç«è¿ç¨ ExtensionAbility ä¸ UIAbility ä¹é´ï¼ä½¿ç¨<strong>IPC</strong>åºç¡éä¿¡æºå¶ï¼</li>
<li><strong>ExtensionAbility ä¸å±éä¿¡</strong>ï¼ä¸åç±»åç ExtensionAbility æä¾ä¸å±éä¿¡æ¥å£ï¼ééèªèº«ä¸å¡åºæ¯ï¼æ ¸å¿æ¥å£å¦ä¸ï¼
<ul>
<li>ServiceExtensionAbilityï¼éè¿<code>connectServiceExtensionAbility()</code>å»ºç«è¿æ¥ï¼å®ç°ä¸»ä»ç»ä»¶çååéä¿¡ï¼</li>
<li>DataShareExtensionAbilityï¼éè¿<code>createDataShareHelper()</code>åå»ºå©æå®ä¾ï¼å®ç°æ°æ®çå¢å æ¹æ¥å±äº«ã</li>
</ul>
</li>
</ul>
<blockquote>
<p>çº¯ ArkTS åè¿ç¨åºç¨ï¼ä¼åä½¿ç¨ EventHub å®ç°ç»ä»¶/çº¿ç¨é´éä¿¡ï¼æ¶åç¬ç«è¿ç¨æè·¨åºç¨äº¤äºæ¶ï¼æ ¹æ®ç»ä»¶ç±»åéæ©å¯¹åºä¸å±éä¿¡æ¥å£æåºç¡ IPC æºå¶ã</p>
</blockquote>
<h4 id="5-çº¿ç¨æ¨¡å">5. çº¿ç¨æ¨¡å</h4>
<ul>
<li>åºç¡æ¯æï¼Stage æ¨¡åæä¾ workerãtaskpool ç­æºå¶æ¯æåºç¨å¤çº¿ç¨å¼ååºæ¯ï¼</li>
<li>å¼åå»ºè®®ï¼åºç¨è¥æå¤æçèæ¶é»è¾ï¼å¦å¤§æ°æ®å¤çãç½ç»è¯·æ±ãå¤æè®¡ç®ï¼ï¼å»ºè®®éè¿åå»º worker çº¿ç¨çæ¹å¼å¤çï¼é¿åé»å¡ä¸»çº¿ç¨ï¼UI çº¿ç¨ï¼ï¼ä¿éåºç¨çé¢æµçæ§ï¼</li>
<li>çº¿ç¨éç¦»ï¼æ è®º ExtensionAbility ä¸ UIAbility åè¿ç¨è¿æ¯ç¬ç«è¿ç¨ï¼å¶åé¨åä¸ºçº¿ç¨éç¦»è®¾è®¡ï¼èæ¶é»è¾åéæ¾å¨å­çº¿ç¨æ§è¡ï¼ä¸å¯ç´æ¥å¨ç»ä»¶ä¸»çº¿ç¨å¤çã</li>
</ul>
<h3 id="å­stage-æ¨¡åå¼åæµç¨">ï¼å­ï¼Stage æ¨¡åå¼åæµç¨</h3>
<table>
<thead>
<tr>
<th>æ ¸å¿ä»»å¡</th>
<th>å³é®åå®¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>åºç¨ç»ä»¶å¼å</td>
<td>å¼å UIAbility/ExtensionAbilityï¼æåè½æåå°ä¸å HAPï¼éç¨è½åæ½ç¦»å° HSP</td>
</tr>
<tr>
<td>è¿ç¨/çº¿ç¨æ¨¡åéé</td>
<td>åºäºä¸å¡éæ±éç½® ExtensionAbility è¿ç¨å½å±ï¼èæ¶é»è¾éè¿ worker å¤çï¼éµå¾ªçº¿ç¨éç¦»è§å</td>
</tr>
<tr>
<td>éç½®æä»¶ç¼å</td>
<td>éç½® app.json5ï¼å¨å±ï¼/module.json5ï¼æ¨¡åï¼çåºç¨/ç»ä»¶/è¿ç¨ä¿¡æ¯ï¼ä¿è¯è·¯å¾ä¸è¯­æ³åè§</td>
</tr>
<tr>
<td>éä¿¡æºå¶å®ç°</td>
<td>æè¿ç¨å½å±åç»ä»¶ç±»åéæ© EventHubãä¸å±æ¥å£æ IPC å®ç°éä¿¡</td>
</tr>
<tr>
<td>ææéªè¯</td>
<td>åºäºæ¨¡åç¼è¯éªè¯å±é¨ä¿®æ¹ææï¼å¨å±ç¼è¯çæå®æ´åºç¨å</td>
</tr>
</tbody>
</table>
<h2 id="åé¸¿èåºç¨ç»æç»æ">åãé¸¿èåºç¨ç»æç»æ</h2>
<h3 id="ä¸åºç¨ç¨åºåbundle">ï¼ä¸ï¼åºç¨ç¨åºåï¼Bundleï¼</h3>
<ul>
<li>å®ä¹ï¼é¸¿èåºç¨ååãå®è£çæå°åä½ï¼åç¼<code>.app</code>ï¼ï¼ç±å¨å±ç¼è¯æ´åææ HAP/HSP æ¨¡åç¼è¯äº§ç©çæï¼</li>
<li>ææï¼Entry HAPï¼å¿éï¼åºç¨å¯å¨å¥å£ï¼ãFeature HAPï¼å¯éï¼æ©å±åè½ï¼ãHSPï¼å¯éï¼ä»£ç /èµæºå±äº«ï¼ï¼</li>
<li>å¤åæºå¶ï¼1 ä¸ª Bundle å¯åå«å¤ä¸ª HAPï¼Entry HAP æå¤ 1 ä¸ªï¼Feature HAP ä¸éï¼ï¼HAP ä¹é´éè¿ HSP å±äº«ä»£ç /èµæºï¼åæ¨¡åå¯ç¬ç«ç¼è¯ï¼æç»æ´åè³ Bundleã</li>
</ul>
<h3 id="äºæ¨¡åhaphsp">ï¼äºï¼æ¨¡åï¼HAP/HSPï¼</h3>
<table>
<thead>
<tr>
<th>æ¨¡åç±»å</th>
<th>æ ¸å¿ä½ç¨</th>
<th>å³é®ç¹å¾</th>
<th>è¿è¡æå³èå®ä¾</th>
<th>å¸åä½¿ç¨åºæ¯</th>
<th>ç¼è¯ç¹æ§</th>
</tr>
</thead>
<tbody>
<tr>
<td>Entry HAP</td>
<td>åºç¨ä¸»æ¨¡åï¼æä¾å¯å¨å¥å£</td>
<td>å¿éï¼åå«ä¸» UIAbilityï¼å¯åç¬å®è£è¿è¡</td>
<td>å¯¹åº 1 ä¸ª AbilityStage å®ä¾</td>
<td>åºç¨ä¸»çé¢ãæ ¸å¿äº¤äºåè½</td>
<td>å¯ç¬ç«ç¼è¯ä¸º HAP åï¼æ¯æåç¬è¿è¡éªè¯</td>
</tr>
<tr>
<td>Feature HAP</td>
<td>æ©å±åè½æ¨¡å</td>
<td>å¯éï¼ä¾èµ Entry HAP è¿è¡ï¼æ¯ææéå è½½</td>
<td>å¯¹åº 1 ä¸ª AbilityStage å®ä¾</td>
<td>å¤ä»½ãè¾å¥æ³ç­æ©å±åè½</td>
<td>å¯ç¬ç«ç¼è¯ï¼éç»å Entry HAP è¿è¡</td>
</tr>
<tr>
<td>HSP</td>
<td>ä»£ç /èµæºå±äº«å</td>
<td>å¯éï¼æ ç¬ç«è¿è¡ç»ä»¶ï¼ä»ç¨äºæ¨¡åé´å¤ç¨</td>
<td>æ å¯¹åºç AbilityStage å®ä¾</td>
<td>éç¨å·¥å·ç±»ãå¸¸éå®ä¹ãå¬å±èµæº</td>
<td>ç¼è¯ä¸ºå±äº«åï¼è¢«å¶ä» HAP ä¾èµè°ç¨</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å³äºåçç±»åä»¥åä½¿ç¨åå»ºæ¹æ³ï¼æä»¬ä¼å¨é¡¹ç®é¶æ®µå­¦ä¹ ææ¡ã</p>
</blockquote>
<h3 id="ä¸æ ¸å¿ç»ä»¶stage-æ¨¡åä¸¤ç±»ç»ä»¶">ï¼ä¸ï¼æ ¸å¿ç»ä»¶ï¼Stage æ¨¡åä¸¤ç±»ç»ä»¶ï¼</h3>
<table>
<thead>
<tr>
<th>ç»ä»¶ç±»å</th>
<th>æ ¸å¿ä½ç¨</th>
<th>äº¤äºæ¹å¼</th>
<th>å¼åæ¹å¼</th>
<th>è¿ç¨é»è®¤éç½®</th>
<th>ç»åç±»å/ç¤ºä¾æä»¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>UIAbility</td>
<td>åºç¨å¥å£+çªå£ç®¡çï¼å®ç°ç¨æ·äº¤äº</td>
<td>æ¡é¢å¯å¨ãå¯è§åäº¤äº</td>
<td>é¢åå¯¹è±¡å¼åï¼ç±»ç»§æ¿ï¼</td>
<td>åºç¨ä¸»è¿ç¨</td>
<td>EntryAbility.etsï¼åºç¨ä¸»çé¢ï¼</td>
</tr>
<tr>
<td>ExtensionAbility</td>
<td>å¤ä»½/è¾å¥æ³ç­æ  UI/è½» UI åºæ¯</td>
<td>ç³»ç»/äºä»¶è§¦å</td>
<td>é¢åå¯¹è±¡å¼åï¼æ´¾çç±»å®ç°ï¼</td>
<td>åºç¨ä¸»è¿ç¨</td>
<td>EntryBackupAbility.etsï¼å¤ä»½ï¼ãDataShareExtensionAbility.etsï¼æ°æ®å±äº«ï¼</td>
</tr>
</tbody>
</table>
<h2 id="äºå·¥ç¨ç»æ">äºãå·¥ç¨ç»æ</h2>
<p>å»¶ç¨ä¸ä¸èåå»ºçé¡¹ç®<code>FirstApplication</code>ï¼åºäºé¸¿è 5.0 API 12 + DevEco Studio 6.0+ï¼ï¼å·¥ç¨æ ¸å¿ç»æå¦ä¸ï¼å¶ä¸­<code>build</code>ç®å½ä¸ºç¼è¯åèªå¨çæï¼<code>build-profile.json5</code>å<code>hvigorfile.ts</code>ä¸ºé¸¿è Hvigor æå»ºå·¥å·çæ ¸å¿ç¼è¯éç½®æä»¶ï¼å®ç°å·¥ç¨ä¸æ¨¡åçåå±ç¼è¯ç®¡çï¼</p>
<pre><code>FirstApplication                    
âââ AppScope/                # åºç¨å¨å±éç½®ç®å½
â   âââ resources/           # åºç¨å¨å±èµæºç®å½
â   â   âââ base/            # å¨å±åºç¡èµæºç®å½
â   â   â   âââ element/     # å¨å±å­ç¬¦ä¸²ãé¢è²ç­éç½®
â   â   â   â   âââ string.json
â   â   â   âââ media/       # å¨å±åªä½èµæºï¼å±å å¾æ éç½®ãååºå¾æ ï¼
â   â   â   â   âââ app_icon.png // èªå®ä¹çåºç¨å¾æ 
â   â   â   â   âââ background.png
â   â   â   â   âââ foreground.png
â   â   â   â   âââ layered_image.json
â   â   â   âââ profile/     # å¨å±éç½®æä»¶ï¼å¦é¡µé¢è·¯ç±ãå¤ä»½éç½®ç­ï¼
â   âââ app.json5            # å¨å±éç½®æä»¶ï¼ååãçæ¬ãå¾æ ãåç§°ç­ï¼ä¾å¨å±ç¼è¯è§£æï¼
âââ entry/                   # Entry HAPä¸»æ¨¡åï¼æ ¸å¿å¼åç®å½ï¼
â   âââ build/               # æ¨¡åç¼è¯äº§ç©ç®å½ï¼ç¼è¯åèªå¨çæï¼å­æ¾entryæ¨¡åHAPåï¼
â   âââ src/
â   â   âââ main/            # entryæ¨¡åæ ¸å¿æºç ç®å½
â   â   â   âââ ets/         # ArkTSä»£ç ç®å½
â   â   â   â   âââ entryability/ # UIAbilityæ ¸å¿ç»ä»¶ç®å½
â   â   â   â   â   âââ EntryAbility.ets
â   â   â   â   âââ entrybackupability/ # å¤ä»½æ©å±ç»ä»¶ç®å½
â   â   â   â   â   âââ EntryBackupAbility.ets
â   â   â   â   âââ pages/   # é¡µé¢ç®å½
â   â   â   â       âââ Index.ets
â   â   â   â       âââ Home.ets
â   â   â   âââ resources/   # æ¨¡åçº§éæèµæºç®å½ï¼ç¼è¯æ¶èªå¨æåä¼åï¼
â   â   â   â   âââ base/    # åºç¡èµæºç®å½ï¼é»è®¤ä¸»é¢ï¼
â   â   â   â   â   âââ element/ # æ¨¡åçº§åç´ éç½®
â   â   â   â   â   âââ media/   # æ¨¡åçº§åªä½èµæº
â   â   â   â   â   â   âââ background.png
â   â   â   â   â   â   âââ foreground.png
â   â   â   â   â   â   âââ startIcon.png // é»è®¤ççªå£å¾æ 
â   â   â   â   â   â   âââ layered_image.json
â   â   â   â   âââ dark/    # æ·±è²æ¨¡å¼èµæºç®å½
â   â   â   â   âââ rawfile/ # åçæä»¶ç®å½ï¼æ éç¼è¯çéææä»¶ï¼
â   â   â   âââ module.json5 # Entry HAPæ¨¡åéç½®æä»¶ï¼ç»ä»¶ãæéãè¿ç¨ç­ï¼ä¾æ¨¡åç¼è¯è§£æï¼
â   âââ mock/                # æ¨¡ææ°æ®ç®å½ï¼æµè¯ç¨ï¼
â   âââ ohosTest/            # OpenHarmonyæµè¯ç®å½
â   âââ test/                # æ¬å°æµè¯ç®å½
â   âââ .gitignore           # Gitå¿½ç¥æä»¶éç½®
â   âââ build-profile.json5  # æ¨¡åç¼è¯éç½®æä»¶ï¼æå®SDKçæ¬ãç­¾åå³èç­ç¼è¯è§åï¼
â   âââ hvigorfile.ts        # æ¨¡åç¼è¯èæ¬ï¼Hvigoræå»ºå·¥å·æ¨¡åçº§æ§è¡å¥å£ï¼
âââ build/                   # å·¥ç¨å¨å±ç¼è¯äº§ç©ç®å½ï¼ç¼è¯åèªå¨çæï¼å­æ¾å¨å±æ´åçHAP/APPåï¼
âââ build-profile.json5      # å·¥ç¨å¨å±ç¼è¯éç½®æä»¶ï¼ç»ä¸ç®¡çæææ¨¡åç¼è¯è§åãç¼è¯æ¨¡å¼ï¼
âââ hvigorfile.ts            # å·¥ç¨å¨å±ç¼è¯èæ¬ï¼Hvigoræå»ºå·¥å·å¨å±æ§è¡å¥å£ï¼è§¦åæææ¨¡åç¼è¯ï¼
âââ oh-package.json5         # ohpmä¾èµéç½®æä»¶ï¼ç¼è¯åèªå¨è§£æä¸è½½ä¾èµï¼
âââ oh-package-lock.json5    # ohpmä¾èµçæ¬éå®æä»¶
</code></pre>
<blockquote>
<p>è¯´æï¼é¸¿èå·¥ç¨åºäº<strong>Hvigor</strong>ï¼é¸¿èå®æ¹èªç æå»ºå·¥å·ï¼å®ç°ç¼è¯ï¼éç¨<strong>æéç¼è¯</strong>ååï¼ä»ä¿®æ¹è¿çæ¨¡å/æä»¶ä¼éæ°ç¼è¯ï¼æªä¿®æ¹é¨åå¤ç¨åæç¼è¯äº§ç©ï¼æåå¼åæçï¼<code>build</code>ç®å½å é¤åå¯éè¿éæ°ç¼è¯çæï¼ä¸å½±åå·¥ç¨æºç ã</p>
</blockquote>
<h2 id="å­uiability-æ ¸å¿å®æ">å­ãUIAbility æ ¸å¿å®æ</h2>
<h3 id="ä¸æ ¸å¿å®ä½">ï¼ä¸ï¼æ ¸å¿å®ä½</h3>
<ol>
<li><strong>åºç¨å¥å£</strong>ï¼ç¨æ·ç¹å»åºç¨å¾æ åï¼ç³»ç»é¦ååå»ºå¹¶å¯å¨ UIAbility å®ä¾ï¼</li>
<li><strong>çªå£ç®¡çè½½ä½</strong>ï¼æ¯ä¸ª UIAbility å®ä¾å¯å¨åä¼åå»ºä¸ä¸ª WindowStageï¼çªå£ç®¡çå¨ï¼ï¼è´è´£çªå£çåå»ºãéæ¯ï¼å¹¶<strong>éè¿ WindowStage å è½½ ArkUI é¡µé¢</strong>ï¼</li>
<li><strong>å®ä¾æ¨¡å¼</strong>ï¼æ¯æåå®ä¾ãå¤å®ä¾ãæå®å®ä¾ç­éç½®ï¼éè¿ module.json5 ç<code>launchType</code>å­æ®µï¼ï¼æ»¡è¶³ä¸åä¸å¡åºæ¯éæ±ï¼</li>
<li><strong>ç¼è¯å³è</strong>ï¼UIAbility çç±»åãæä»¶è·¯å¾éä¸ module.json5 ä¸­<code>name</code>ã<code>srcEntry</code>éç½®å®å¨ä¸è´ï¼å¦åä¼å¯¼è´æ¨¡åç¼è¯å¤±è´¥ï¼æ æ³çæ HAP åï¼</li>
<li><strong>æéæ ¸å¿</strong>ï¼ä½ä¸ºåºç¨æ ¸å¿äº¤äºç»ä»¶ï¼UIAbility æ¯åºç¨æéç³è¯·åæ ¡éªçæ ¸å¿è½½ä½ï¼åå°å¯å¨å¶ä»ç»ä»¶éä¾èµä¸å±ç³»ç»æéã</li>
</ol>
<h3 id="äºæ ¸å¿éç½®">ï¼äºï¼æ ¸å¿éç½®</h3>
<h4 id="1-æ¨¡åçº§éç½®modulejson5">1. æ¨¡åçº§éç½®ï¼module.json5ï¼</h4>
<pre><code class="language-json">{
  "module": {
    "name": "entry", // æ¨¡ååç§°
    "type": "entry", // æ¨¡åç±»åï¼entry/feature/har/hsp
    "description": "$string:module_desc", // æ¨¡åæè¿°
    "mainElement": "EntryAbility", // é»è®¤å¯å¨ç»ä»¶
    "deviceTypes": [ // æ¯æçè®¾å¤ç±»å
      "phone"
    ],
    "deliveryWithInstall": true, // æ¯å¦éåºç¨å®è£äº¤ä»
    "installationFree": false, // æ¯å¦åå®è£
    "pages": "$profile:main_pages", // é¡µé¢è·¯ç±éç½®
    "abilities": [ // UIAbilityç»ä»¶éç½®
      {
        "name": "EntryAbility", // ç»ä»¶åç§°ï¼ä¸ä»£ç ç±»åä¸è´ï¼ç¼è¯æ ¡éªå³é®ï¼
        "srcEntry": "./src/main/ets/entryability/EntryAbility.ets", // å¥å£è·¯å¾ï¼å¿é¡»./å¼å¤´ï¼ç¼è¯æ ¡éªå³é®ï¼
        "description": "$string:EntryAbility_desc", // ç»ä»¶æè¿°
        "icon": "$media:layered_image", // ç»ä»¶å¾æ ï¼æ¨¡åçº§ï¼ä¸éåçæåµä¸ä¼åçæï¼
        "label": "$string:EntryAbility_label", // ç»ä»¶æ¾ç¤ºåç§°ï¼æ¨¡åçº§ï¼ä¼åçº§æ´é«ï¼
        "startWindowIcon": "$media:startIcon", // å¯å¨çªå£å¾æ 
        "startWindowBackground": "$color:start_window_background", // å¯å¨çªå£èæ¯
        "exported": true, // æ¯å¦åè®¸è·¨åºç¨è°ç¨
        "launchType": "singleton", // é»è®¤çå¯å¨æ¨¡å¼ï¼å¯ä»¥ä¸å
        "skills": [ // æ¡é¢å¾æ å¿éï¼ç¼ºå°åæ¡é¢æ åºç¨å¾æ 
          {
            "entities": [
              "entity.system.home" // æ¡é¢å¥å£æ è¯
            ],
            "actions": [
              "ohos.want.action.home" // æ¡é¢å¯å¨å¨ä½
            ]
          }
        ]
      }
    ],
    "extensionAbilities": [ // æ©å±ç»ä»¶éç½®
      {
        "name": "EntryBackupAbility", // å¤ä»½æ©å±ç»ä»¶åç§°
        "srcEntry": "./src/main/ets/entrybackupability/EntryBackupAbility.ets", 
        "type": "backup", // æ©å±ç±»åï¼backup/dataShare/inputMethodç­ï¼
        "exported": false, // ä»åé¨ä½¿ç¨
        "metadata": [ // æ©å±åæ°æ®
          {
            "name": "ohos.extension.backup", // åæ°æ®åç§°
            "resource": "$profile:backup_config" // åæ°æ®éç½®æä»¶
          }
        ]
      }
    ]
  }
}
</code></pre>
<h4 id="2-éç½®å³é®è§å">2. éç½®å³é®è§å</h4>
<ul>
<li><code>mainElement</code>ï¼Entry HAP å¿é¡»éç½®ä¸º UIAbilityï¼Feature HAP æ é»è®¤å¯å¨ç»ä»¶ï¼</li>
<li><code>name</code>ï¼ç»ä»¶åç§°å¿é¡»ä¸ä»£ç ä¸­å¯¼åºçç±»åä¸è´ï¼ä¸å¯éæä¿®æ¹ï¼ç¼è¯æ¶ä¼ä¸¥æ ¼æ ¡éªï¼</li>
<li><code>srcEntry</code>ï¼è·¯å¾éä»¥<code>./</code>å¼å¤´ï¼ä¸¥æ ¼å¹éæä»¶çç®å½/æä»¶åï¼åºåå¤§å°åï¼ï¼è·¯å¾éè¯¯ä¼ç´æ¥å¯¼è´ç¼è¯å¤±è´¥ï¼</li>
<li><code>exported</code>ï¼è·¨åºç¨è°ç¨çç»ä»¶éè®¾ä¸º trueï¼ä»åé¨ä½¿ç¨çç»ä»¶è®¾ä¸º false å³å¯ï¼</li>
<li><code>skills</code>ï¼ä» UIAbility ééç½®ï¼æ¡é¢å¾æ å±ç¤ºï¼ï¼ExtensionAbility æ ééç½®ï¼ç¼ºå¤±æéç½®ä¸å¨åæ¡é¢æ å¾æ ï¼ç¹å»å¾æ è¿å¥åºç¨è¯¦æé¡µï¼</li>
<li><code>type</code>ï¼ExtensionAbility å¿éå­æ®µï¼éä¸æ©å±ç±»åå¹éï¼å¦ backupãdataShareãinputMethod ç­ï¼ï¼</li>
<li><code>process</code>ï¼ExtensionAbility å¯ééç½®å­æ®µï¼ç¨äºè®¾ç½®è¿ç¨å½å±ï¼å¼ä»¥<code>:</code>å¼å¤´è¡¨ç¤ºç¬ç«è¿ç¨ï¼æªéç½®åé»è®¤ä¸ä¸»è¿ç¨åè¿ç¨ï¼</li>
<li>JSON è¯­æ³ï¼ç¦æ­¢æ«å°¾å¤ä½éå·ï¼éç½®é¡¹ãæä»¶/ç®å½åç§°ååºåå¤§å°åï¼è¯­æ³éè¯¯ä¼å¯¼è´ç¼è¯è§£æå¤±è´¥ã</li>
</ul>
<h4 id="3-å¨å±éç½®appjson5">3. å¨å±éç½®ï¼app.json5ï¼</h4>
<pre><code class="language-json">{
  "app": {
    "bundleName": "com.sanxiu.firstapp",
    "vendor": "example",
    "versionCode": 1000000,
    "versionName": "1.0.0",
    "icon": "$media:layered_image", // å¨å±åºç¨å¾æ 
    "label": "$string:app_name" // å¨å±åºç¨åç§°
  }
}
</code></pre>
<h4 id="4-å±å å¾æ éç½®layered_imagejson">4. å±å å¾æ éç½®ï¼layered_image.jsonï¼</h4>
<p><strong>è·¯å¾</strong>ï¼</p>
<ul>
<li>å¨å±ï¼AppScope/resources/base/media/layered_image.json</li>
<li>æ¨¡åçº§ï¼entry/src/main/resources/base/media/layered_image.json</li>
</ul>
<pre><code class="language-json">{
  "layered-image": {
    "background": "$media:background",
    "foreground": "$media:foreground"
  }
}
</code></pre>
<p><strong>æ ¸å¿è§å</strong>ï¼</p>
<ul>
<li>èµæºè¦çï¼ç¼è¯æ AppScope åæ¨¡ååéåèµæºï¼AppScope èµæºä¼åçº§æ´é«ï¼</li>
<li>æ¨¡åçº§ icon çæåæï¼UIAbility ç <code>skills</code> å­æ®µå¿é¡»åå«<code>entity.system.home</code>å<code>ohos.want.action.home</code>ï¼å¤ Ability æ¶å<code>mainElement</code>å¯¹åºéç½®ï¼</li>
<li>å¾æ å°ºå¯¸è§èï¼é¸¿èå±å å¾æ æ¨èåºç¡å°ºå¯¸ï¼foreground/background åä¸º<strong>1024Ã1024</strong>ï¼png æ ¼å¼ï¼éæèæ¯ï¼ï¼ç¼è¯æ¶ç³»ç»ä¼èªå¨ééä¸åè®¾å¤çå¾æ å°ºå¯¸ï¼æ éæå¨å¶ä½å¤å°ºå¯¸çæ¬ã</li>
</ul>
<h4 id="5-é¡µé¢è·¯ç±éç½®main_pagesjson">5. é¡µé¢è·¯ç±éç½®ï¼main_pages.jsonï¼</h4>
<p>éè¿ <code>New -&gt; Page -&gt; Empty Page</code> åå»ºçé¡µé¢ä¼èªå¨å¯¼å¥<code>main_pages.json</code>ï¼å¶ä»æ¹æ³åå»ºçé¡µé¢éè¦æå¨ç®¡çè·¯ç±éç½®ã</p>
<pre><code class="language-json">{
  "src": [
    "pages/Index",
    "pages/Home" // æ°å¢Homeé¡µé¢è·¯å¾
  ]
}
</code></pre>
<h3 id="ä¸é¡µé¢å è½½æ ¸å¿é»è¾entryabilityets">ï¼ä¸ï¼é¡µé¢å è½½æ ¸å¿é»è¾ï¼EntryAbility.etsï¼</h3>
<pre><code class="language-typescript">import UIAbility from '@ohos.app.ability.UIAbility';
import window from '@ohos.window';
import hilog from '@ohos.hilog';
import { AbilityConstant, Want } from '@kit.AbilityKit';
import { BusinessError } from '@ohos.base'; 

const DOMAIN: number = 0x0000;
const TAG: string = 'EntryAbility';

export default class EntryAbility extends UIAbility {
  // ç»ä»¶åå»ºæ¶è§¦åï¼å¯åå§åèµæº
  onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void {
    hilog.info(DOMAIN, TAG, 'EntryAbility onCreate called');
  }

  // ç»ä»¶éæ¯æ¶è§¦åï¼å¯éæ¾èµæº
  onDestroy() {
    hilog.info(DOMAIN, TAG, 'EntryAbility onDestroy called');
  }

  // çªå£åå»ºåè§¦åï¼ä»æ­¤å¤å¯å è½½é¡µé¢
  onWindowStageCreate(windowStage: window.WindowStage): void {
    hilog.info(DOMAIN, TAG, '--- onWindowStageCreate è§¦åï¼å è½½é¡µé¢ï¼---');
    // å è½½é¡µé¢
    windowStage.loadContent('pages/Index', (err) =&gt; {
      if (err.code) {
        hilog.error(DOMAIN, TAG, `é¡µé¢å è½½å¤±è´¥ï¼code=${err.code}, message=${err.message}`);
        return;
      }
      hilog.info(DOMAIN, TAG, 'Indexé¡µé¢å è½½æå');
    });
  }

  onWindowStageDestroy(): void {
    // Main window is destroyed, release UI related resources
    hilog.info(DOMAIN, TAG, '%{public}s', 'ä¸»çªå£å³å°éæ¯ï¼éæ¾UIç¸å³èµæº');
  }

  onForeground(): void {
    // Ability has brought to foreground
    hilog.info(DOMAIN, TAG, '%{public}s', 'åºç¨åæ¢è³åå°ï¼æ¢å¤ä¸å¡é»è¾');
  }

  onBackground(): void {
    // Ability has back to background
    hilog.info(DOMAIN, TAG, '%{public}s', 'åºç¨åæ¢è³åå°ï¼æåä¸å¡é»è¾ï¼ä¸å¯å¯å¨å¶ä»ç»ä»¶');
  }
}
</code></pre>
<h4 id="é¡µé¢å è½½è§å">é¡µé¢å è½½è§å</h4>
<ol>
<li>ä»è½éè¿<code>WindowStage.loadContent()</code>å è½½é¡µé¢ï¼</li>
<li>è¯¥æ¹æ³ä»å¯å¨<code>onWindowStageCreate</code>çå½å¨æä¸­è°ç¨ï¼</li>
<li>è·¯å¾éä¸¥æ ¼éµå¾ªâæ .etsåç¼ãåºåå¤§å°åãåºäºpagesæ ¹ç®å½çç¸å¯¹è·¯å¾âï¼ä¸éä¸<code>main_pages.json</code>ä¸­æ³¨åçè·¯å¾å®å¨ä¸è´ï¼å¦åç¼è¯éè¿ä½è¿è¡æ¶é¡µé¢å è½½å¤±è´¥ï¼</li>
<li>é¡µé¢æä»¶å½åãè·¯å¾éè¯¯ä¼å¯¼è´ç¼è¯æ¶èµæºæåå¤±è´¥ï¼æè¿è¡æ¶é¡µé¢ç©ºç½ã</li>
</ol>
<h3 id="åèªå®ä¹é¦é¡µå¼å">ï¼åï¼èªå®ä¹é¦é¡µå¼å</h3>
<h4 id="æ­¥éª¤-1åå»º-home-é¡µé¢pageshomeets">æ­¥éª¤ 1ï¼åå»º Home é¡µé¢ï¼pages/Home.etsï¼</h4>
<pre><code class="language-typescript">@Entry
@Component
struct Home {
  build() {
    Column({ space: 20 }) {
      Text('æçStageåºç¨é¦é¡µ')
        .fontSize(30)
        .fontWeight(FontWeight.Bold);
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center);
  }
}
</code></pre>
<h4 id="æ­¥éª¤-2æ³¨å-home-é¡µé¢å°è·¯ç±éç½®main_pagesjson">æ­¥éª¤ 2ï¼æ³¨å Home é¡µé¢å°è·¯ç±éç½®ï¼main_pages.jsonï¼</h4>
<p>æå¼è·¯å¾ï¼<code>entry/src/main/resources/base/profile/main_pages.json</code>ï¼å¨<code>src</code>æ°ç»ä¸­æ°å¢ Home é¡µé¢è·¯å¾ï¼ç¡®ä¿ä¸å®éæä»¶è·¯å¾ä¸è´ï¼</p>
<pre><code class="language-json">{
  "src": [
    "pages/Index",
    "pages/Home" // å¿é¡»æ³¨åï¼å¦åè¿è¡æ¶é¡µé¢å è½½å¤±è´¥
  ]
}
</code></pre>
<h4 id="æ­¥éª¤-3ä¿®æ¹é¡µé¢å è½½è·¯å¾entryabilityets">æ­¥éª¤ 3ï¼ä¿®æ¹é¡µé¢å è½½è·¯å¾ï¼EntryAbility.etsï¼</h4>
<p>å°<code>windowStage.loadContent('pages/Index', ...)</code>ä¿®æ¹ä¸ºï¼</p>
<pre><code class="language-typescript">// å è½½é¡µé¢
windowStage.loadContent('pages/Home').then(()=&gt;{
  hilog.info(DOMAIN, TAG, 'Homeé¡µé¢å è½½æå');
}).catch((err: BusinessError)=&gt;{
  hilog.error(DOMAIN, TAG, `é¡µé¢å è½½å¤±è´¥ï¼code=${err.code}, message=${err.message}`);
})
</code></pre>
<h4 id="ææéªè¯">ææéªè¯</h4>
<p><img alt="ä¿®æ¹å è½½é¡µé¢.png" loading="lazy" data-src="./%E8%B5%84%E6%BA%90%E5%9B%BE%E7%89%87/%E4%BF%AE%E6%94%B9%E5%8A%A0%E8%BD%BD%E9%A1%B5%E9%9D%A2.png" class="lazyload"></p>
<ol>
<li><strong>åºç¨åéªè¯</strong>ï¼æ­£å¸¸å±ç¤º<code>æçStageåºç¨é¦é¡µ</code>ï¼æ ç©ºç½ãæ æ¥éï¼</li>
<li><strong>æ¥å¿ç«¯éªè¯</strong>ï¼Logcat ä¸­ç­é<code>TAG:EntryAbility</code>ï¼å¯çå°âHomeé¡µé¢å è½½æåâç¸å³æ¥å¿ã</li>
</ol>
<h3 id="äºéç½®åºç¨åç§°åå¾æ ">ï¼äºï¼éç½®åºç¨åç§°åå¾æ </h3>
<h4 id="1-å±å å¾æ æ¹æ¡-æ¨¡åçº§éç½®">1. å±å å¾æ æ¹æ¡-æ¨¡åçº§éç½®</h4>
<p>é»è®¤å·¥ç¨ä¸­ï¼å¨å±åºç¨å¾æ ãæ¨¡åçº§å¾æ ãlayered-image åååèæ¯å¾çå½ååä¸è´ã<br>
è¥éè®©æ¨¡åçº§åºç¨å¾æ çæï¼éå é¤<strong>AppScope/resources/base/media/</strong> ç®å½ä¸ç layered-image ç¸å³æä»¶ï¼å«<code>layered_image.json</code>ã<code>background.png</code>ã<code>foreground.png</code>ï¼ï¼é¿åå¨å±éåèµæºè¦çï¼ä¸æ¨èï¼ã</p>
<p><strong>æ¨èæ¹æ¡</strong>ï¼ç¡®ä¿èµæºä¸éåï¼ä½¿ç¨èªå®ä¹å¾æ åç§°ï¼åæ¶ä¿è¯<code>module.json5</code> ä¸­éç½®äº<code>skills</code>å­æ®µï¼æ¡é¢å¾æ æ­£å¸¸æ¾ç¤ºåæï¼ï¼</p>
<ul>
<li>ç¡®è®¤ entry æ¨¡å<code>layered_image.json</code>éç½®ï¼è·¯å¾ï¼entry/src/main/resources/base/media/layered_image.jsonï¼ï¼</li>
<li>ç¡®ä¿ module.json5 ä¸­ UIAbility éç½®<code>"icon": "$media:layered_image"</code>ã</li>
</ul>
<h4 id="2-å±å å¾æ æ¹æ¡-å¨å±çº§éç½®">2. å±å å¾æ æ¹æ¡-å¨å±çº§éç½®</h4>
<p>ç´æ¥å°åºç¨å¾æ å¾çå½åä¸º<code>foreground</code>ï¼æèªå®ä¹ layered_image.json ä¸­<code>foreground</code>çèµæºå¼ç¨ä¸º<code>"foreground": "$media:app_icon"</code>ï¼</p>
<ol>
<li>éç½® AppScope ä¸<code>layered_image.json</code>ï¼è·¯å¾ï¼AppScope/resources/base/media/layered_image.jsonï¼ï¼</li>
<li>å¨<code>AppScope/app.json5</code>ä¸­éç½®å¨å±å¾æ ï¼<code>"icon": "$media:layered_image"</code>ã</li>
</ol>
<h4 id="3-åºç¨åç§°éç½®">3. åºç¨åç§°éç½®</h4>
<p>åºç¨åç§°çéç½®ä¼åçº§ï¼<strong>æ¨¡åçº§å« &gt; å¨å±çº§å«</strong>ãè¥éè®©å¨å±èµæºéç½®çåºç¨åç§°çæï¼éå¨ module.json5 ä¸­æ³¨é/å é¤ UIAbility ç label éç½®ï¼<code>"label": "$string:EntryAbility_label"</code>ã</p>
<ul>
<li>åç§°ä¿®æ¹åéæ£æ¥<code>string.json</code>ä¸­å¯¹åºå­ç¬¦æ¯å¦å­å¨ï¼å­ç¬¦ç¼ºå¤±ä¼å¯¼è´ç¼è¯æ¶èµæºè§£æéè¯¯ï¼</li>
<li>éç½®å®æåæ§è¡æ¨¡åç¼è¯ï¼éªè¯æ¡é¢åºç¨åç§°æ¯å¦æ´æ°ï¼</li>
<li>å¨å±åç§°è·¯å¾ï¼<code>AppScope/resources/base/element/string.json</code><pre><code class="language-json">{
  "string": [
    {
      "name": "app_name",
      "value": "ç¬¬ä¸ä¸ªåºç¨"
    }
  ]
}
</code></pre>
</li>
</ul>
<h4 id="è¿è¡éªè¯">è¿è¡éªè¯</h4>
<p>å°åºç¨è¿è¡è³çæº/æ¨¡æå¨ï¼æ¡é¢ç«¯åºç¨åç§°æ¾ç¤ºä¸º<code>ç¬¬ä¸ä¸ªåºç¨</code>ï¼å¾æ ä¸ºå¨å±éç½®çå±å æ ·å¼ã</p>
<p><img alt="ä¿®æ¹åºç¨åç§°åå¾æ " loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730991/202602/3730991-20260204163027740-1003594037.png" class="lazyload"></p>
<h2 id="ä¸æ¸çæå»ºhapappå">ä¸ãæ¸çãæå»ºHAP/APPå</h2>
<p>é¸¿èå·¥ç¨åºäºHvigoræå»ºå·¥å·å®ç°æ¨¡åçº§ç¼è¯åå¨å±çº§æå»ºï¼<strong>é¡¶é¨èåæ Build</strong>ä¸ºæ ¸å¿æä½å¥å£ï¼è¦çãæ¸ç-ç¼è¯-æå»º-åå¸ãå¨æµç¨ï¼ä»¥ä¸ä¸ºç²¾åå®æåå·¥å·è¯´æï¼</p>
<h3 id="1-æ¸çæä½">1. æ¸çæä½</h3>
<ul>
<li>æä½ï¼é¡¶é¨èåæ <code>Build &gt; Clean Project</code></li>
<li>åè½ï¼å é¤å¨å·¥ç¨ææç¼è¯ç¸å³æä»¶ï¼ç¼å­ãä¸´æ¶äº§ç©ãå·²çæçåæä»¶ç­ï¼ï¼ä»ä¿çæºç ãéç½®åèµæºæä»¶</li>
<li>ä½ç¨ï¼è§£å³ç¼è¯å¼å¸¸ãç¼å­å²çªãéç½®ä¿®æ¹ä¸çæç­é®é¢ï¼æ¸çå®ææ§å¶å°æ¾ç¤º<code>BUILD SUCCESSFUL</code></li>
</ul>
<h3 id="2-æ¨¡åç¼è¯">2. æ¨¡åç¼è¯</h3>
<p>éç¨äºä¿®æ¹entryæ¨¡ååå¿«ééªè¯å±é¨ææï¼ä»çæåæ¨¡åHAPåï¼</p>
<ol>
<li>æä½ï¼éä¸­<code>entry</code>æä»¶ï¼ç¹å»é¡¶é¨èåæ <code>Build &gt; Make Module 'entry'</code></li>
<li>ç»æï¼æ§å¶å°æ¾ç¤º<code>BUILD SUCCESSFUL</code>å³ä¸ºæåï¼HAPåå­æ¾äº<code>entry/build/outputs/hap/</code></li>
<li>ä½ç¨ï¼å¿«ééªè¯entryæ¨¡åä»£ç /éç½®ä¿®æ¹ææ</li>
</ol>
<p><img alt="ç¼è¯entryæ¨¡å_20260203211239_98_1340" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730991/202602/3730991-20260204163108603-2034847660.png" class="lazyload"></p>
<h3 id="3-æå»ºå®æ´åºç¨åç¨äºå®è£ååä¸æ¶">3. æå»ºå®æ´åºç¨åï¼ç¨äºå®è£/åå/ä¸æ¶ï¼</h3>
<p>éç¨äºçæº/æ¨¡æå¨é¨ç½²ãåºç¨åå¸ä¸æ¶ï¼æ´åå¨æ¨¡åçæå®æ´.appåï¼</p>
<ol>
<li>æä½ï¼é¡¶é¨èåæ <code>Build &gt; Build Hap(s)/APP(s) &gt; Build App(s)</code></li>
<li>ç»æï¼æ§å¶å°æ¾ç¤º<code>BUILD SUCCESSFUL</code>å³ä¸ºæåï¼.appåå­æ¾äº<code>build/outputs/app/</code>ï¼ä¸»æ¨¡åentryæåäº§åº.hapå</li>
<li>ä½ç¨ï¼çæå¯é¨ç½²/åå¸çå®æ´Bundleåºç¨å</li>
</ol>
<p><img alt="æå»ºåºç¨ç¨åºå_20260203211834_100_1340" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730991/202602/3730991-20260204163158358-263756083.png" class="lazyload"></p>
<h3 id="4-buildèåæ ¸å¿å·¥å·éé¡¹å¨è§£">4. Buildèåæ ¸å¿å·¥å·éé¡¹å¨è§£</h3>
<table>
<thead>
<tr>
<th>éé¡¹åç§°</th>
<th>æ ¸å¿ä½ç¨</th>
<th>å¸åä½¿ç¨åºæ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>Make Module 'entry'</td>
<td>ç¼è¯entryæ¨¡åï¼çæåæ¨¡åHAPå</td>
<td>éªè¯entryæ¨¡åå±é¨ä¿®æ¹ææ</td>
</tr>
<tr>
<td>Build Hap(s)/APP(s)</td>
<td>Build Hap(s)ï¼ç¼è¯å/å¤æ¨¡åçæHAPåï¼Build App(s)ï¼æ´åå¨æ¨¡åçæ.appå</td>
<td>å±é¨è°è¯ç¨Hap(s)ï¼é¨ç½²/åå¸ç¨App(s)</td>
</tr>
<tr>
<td>Generate Build Profile 'entry'</td>
<td>çæentryæ¨¡åä¸å±ç¼è¯éç½®æä»¶</td>
<td>èªå®ä¹entryæ¨¡åç¼è¯è§å</td>
</tr>
<tr>
<td>Clean Project</td>
<td>å é¤å¨å·¥ç¨ææç¼è¯æä»¶ï¼å½»åºæ¸çç¼å­</td>
<td>ç¼è¯å¼å¸¸ãç¼å­å²çªãéç½®ä¿®æ¹ä¸çæ</td>
</tr>
<tr>
<td>Rebuild Project</td>
<td>åæ§è¡Clean Projectï¼åå¨å·¥ç¨éæ°ç¼è¯</td>
<td>æ¸çåä»ç¼è¯å¤±è´¥ãå·¥ç¨é¿ææªç¼è¯</td>
</tr>
<tr>
<td>Generate Key and CSR</td>
<td>çæ.p12å¯é¥+CSRæä»¶ï¼ç¨äºç³è¯·å®æ¹åå¸ç­¾å</td>
<td>åºç¨æ­£å¼åå¸ä¸æ¶</td>
</tr>
<tr>
<td>Upload Product</td>
<td>å°æ­£å¼ç.appåä¸ä¼ è³åä¸ºåºç¨å¸åºåå°</td>
<td>åºç¨æäº¤ä¸æ¶æå®¡</td>
</tr>
<tr>
<td>Build Analyzer</td>
<td>åææå»ºèæ¶ãèµæºå ç¨ï¼å®ä½æå»ºå¤±è´¥åå </td>
<td>æå»ºéåº¦æ¢ãææ¥æå»ºå¤±è´¥é®é¢</td>
</tr>
</tbody>
</table>
<h2 id="å«ä»£ç ä»åº">å«ãä»£ç ä»åº</h2>
<ul>
<li>å·¥ç¨åç§°ï¼FirstApplication</li>
<li>ä»åºå°åï¼<a href="https://gitee.com/HarmonyOS-UI-Basics/harmony-os-ui-basics.git" target="_blank" rel="noopener nofollow">https://gitee.com/HarmonyOS-UI-Basics/harmony-os-ui-basics.git</a></li>
</ul>
<h2 id="ä¹ä¸èé¢å">ä¹ãä¸èé¢å</h2>
<p>ä¸ä¸èå°æ·±å¥å­¦ä¹  UIAbility çå½å¨æå¨è§£æï¼æ ¸å¿åå®¹åæ¬ï¼</p>
<ol>
<li>UIAbility å¨çå½å¨ææ ¸å¿æ¹æ³çè§¦åæ¶æºãæ ¸å¿ä½ç¨åæ§è¡æ¬¡æ°çº¦æï¼</li>
<li>WindowStage äºä»¶ä½ç³»ä¸çå½å¨æçèå¨é»è¾ï¼ææ¡çªå£ç¶æï¼è·ç¦/å¤±ç¦ãåå°/åå°ï¼çåæ³çå¬æ¹å¼ï¼</li>
<li><code>onDestroy</code> æ¹æ³çç¹æ®è§¦åè§åï¼API 13+ä¸é®æ¸çãè°è¯æ¨¡å¼ãæå¨è°ç¨APIç­ä¸ååºæ¯ï¼ï¼</li>
<li>é¡µé¢ä»è½å¨ <code>onWindowStageCreate</code> å è½½çåºå±åå åçå½å¨æç¸å³å¼åé¿åè¦ç¹ï¼</li>
<li>å®æéªè¯å¯å¨/ååå°åæ¢/å³é­ç­åºæ¯ä¸ççå½å¨ææ§è¡é¡ºåºï¼ææ¡å³é®æ°æ®çå®å¨ä¿å­ç­ç¥ã</li>
</ol>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.00625" data-date-updated="2026-02-04 16:45">2026-02-04 16:36</span>&nbsp;
<a href="https://www.cnblogs.com/san-xiu">é¸¿è-æ£ä¿®</a>&nbsp;
éè¯»(<span id="post_view_count">61</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19575201);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19575201', targetLink: 'https://www.cnblogs.com/san-xiu/p/19575201', title: 'é¸¿èåºç¨å¼åUIåºç¡ç¬¬äºèï¼é¸¿èåºç¨ç¨åºæ¡æ¶æ ¸å¿è§£æä¸å®æ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ .NET ä¸­å¦ä½å¿«éå®ç° List éåå»éï¼ ]]></title>
    <link>https://www.cnblogs.com/1312mn/p/18552496</link>
    <guid>dda50bdd3d99a0ed2bf3f42553742279</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/1312mn/p/18552496" title="åå¸äº 2026-02-04 16:34">
    <span role="heading" aria-level="2">.NET ä¸­å¦ä½å¿«éå®ç° List éåå»éï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h2 class="md-end-block md-heading"><span class="md-plain md-expand" style="font-size: 16px">åè¨</span></h2>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">å¨æ°æ®å¤çä¸­ï¼å»é¤éåä¸­çéå¤åç´ æ¯ä¸ä¸ªå¸¸è§çéæ±ã.NET 6 å .NET 7 å¼å¥äº <span class="md-pair-s"><code>DistinctBy</code><span class="md-plain"> æ¹æ³ï¼è¿æ¯ä¸ä¸ªéå¸¸å®ç¨çæ°ç¹æ§ï¼å¯ä»¥æ¹ä¾¿å°æ ¹æ®æå®çé®å¯¹éåè¿è¡å»éã</span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">æ¬æå°è¯¦ç»ä»ç» <span class="md-pair-s"><code>DistinctBy</code><span class="md-plain"> æ¹æ³çä½¿ç¨ï¼å¹¶éè¿å·ä½çæ¡ä¾æ¥å±ç¤ºå¶å¨å®éå¼åä¸­çåºç¨ã</span></span></span></p>
<h2 class="md-end-block md-heading"><span class="md-plain" style="font-size: 16px">æ­£æ</span></h2>
<h3><strong>1ã<code>DistinctBy</code> æ¹æ³</strong></h3>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><code>DistinctBy</code><span class="md-plain"> æ¹æ³åè®¸æä»¬å¨ LINQ æ¥è¯¢ä¸­æ ¹æ®æä¸ªé®å¯¹éåä¸­çåç´ è¿è¡å»éã</span></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">è¿ä¸ªæ¹æ³è¿åä¸ä¸ªæ°çéåï¼å¶ä¸­åªåå«æ ¹æ®æå®é®å¯ä¸ç¡®å®çåç´ ã</span></p>
<p class="md-end-block md-p"><span class="md-pair-s md-expand" style="font-size: 16px"><strong>æ¹æ³ç­¾å</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span> IEnumerable&lt;TSource&gt; DistinctBy&lt;TSource, TKey&gt;<span style="color: rgba(0, 0, 0, 1)">(
    </span><span style="color: rgba(0, 0, 255, 1)">this</span> IEnumerable&lt;TSource&gt;<span style="color: rgba(0, 0, 0, 1)"> source,
    Func</span>&lt;TSource, TKey&gt;<span style="color: rgba(0, 0, 0, 1)"> keySelector
);</span></pre>
</div>
<h3 class="md-end-block md-heading"><strong><span class="md-plain" style="font-size: 16px">2ãåºæ¬ç¨æ³</span></strong></h3>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">æç®åçç¨æ³æ¯å¨ LINQ æ¥è¯¢ä¸­ç´æ¥è°ç¨ <span class="md-pair-s"><code>DistinctBy</code><span class="md-plain"> æ¹æ³ï¼ç¶åå¤çå»éåçéåã</span></span></span></p>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><strong>è¯´æ</strong></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">åè®¾æä»¬æä¸ä¸ªç¨æ·åè¡¨ï¼æä»¬æ³è¦æ ¹æ®ç¨æ·åå»é¤éå¤çç¨æ·ã</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">using</span><span style="color: rgba(0, 0, 0, 1)"> System.Linq;
â
</span><span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> User
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Name { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> Age { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
}
â
</span><span style="color: rgba(0, 0, 255, 1)">var</span> users = <span style="color: rgba(0, 0, 255, 1)">new</span> List&lt;User&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> User { Name = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Alice</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Age = <span style="color: rgba(128, 0, 128, 1)">25</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> User { Name = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Bob</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Age = <span style="color: rgba(128, 0, 128, 1)">32</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> User { Name = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Alice</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Age = <span style="color: rgba(128, 0, 128, 1)">28</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> User { Name = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">David</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Age = <span style="color: rgba(128, 0, 128, 1)">35</span><span style="color: rgba(0, 0, 0, 1)"> }
};
â
</span><span style="color: rgba(0, 0, 255, 1)">var</span> distinctUsers = users.DistinctBy(user =&gt;<span style="color: rgba(0, 0, 0, 1)"> user.Name);
â
</span><span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> user <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> distinctUsers)
{
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Name: {user.Name}, Age: {user.Age}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
}</span></pre>
</div>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">è¾åºç»æï¼</span></p>
<div class="cnblogs_code">
<pre>Name: Alice, Age: <span style="color: rgba(128, 0, 128, 1)">25</span><span style="color: rgba(0, 0, 0, 1)">
Name: Bob, Age: </span><span style="color: rgba(128, 0, 128, 1)">32</span><span style="color: rgba(0, 0, 0, 1)">
Name: David, Age: </span><span style="color: rgba(128, 0, 128, 1)">35</span></pre>
</div>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">è¿æ»¤åååç´ è¿æ¯ä¿æåæçé¡ºåºï¼æä»¬å¯ä»¥æ¥çæºç ã</span></p>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><strong>æºç </strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">static</span> IEnumerable&lt;TSource&gt; DistinctByIterator&lt;TSource, TKey&gt;(IEnumerable&lt;TSource&gt; source, Func&lt;TSource, TKey&gt; keySelector, IEqualityComparer&lt;TKey&gt;?<span style="color: rgba(0, 0, 0, 1)"> comparer)
{
    </span><span style="color: rgba(0, 0, 255, 1)">using</span> IEnumerator&lt;TSource&gt; enumerator =<span style="color: rgba(0, 0, 0, 1)"> source.GetEnumerator();
â
    </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> (enumerator.MoveNext())
    {
        </span><span style="color: rgba(0, 0, 255, 1)">var</span> <span style="color: rgba(0, 0, 255, 1)">set</span> = <span style="color: rgba(0, 0, 255, 1)">new</span> HashSet&lt;TKey&gt;<span style="color: rgba(0, 0, 0, 1)">(DefaultInternalSetCapacity, comparer);
        </span><span style="color: rgba(0, 0, 255, 1)">do</span><span style="color: rgba(0, 0, 0, 1)">
        {
            TSource element </span>=<span style="color: rgba(0, 0, 0, 1)"> enumerator.Current;
            </span><span style="color: rgba(0, 0, 255, 1)">if</span> (<span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">.Add(keySelector(element)))
            {
                </span><span style="color: rgba(0, 0, 255, 1)">yield</span> <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> element;
            }
        }
        </span><span style="color: rgba(0, 0, 255, 1)">while</span><span style="color: rgba(0, 0, 0, 1)"> (enumerator.MoveNext());
    }
}</span></pre>
</div>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">éè¿æ¥çæºç ï¼å¯ä»¥çå°æ¯å©ç¨äº <span class="md-pair-s"><code>HashSet</code><span class="md-plain"> å»éï¼åç´ é¡ºåºå¹¶æªè¢«æä¹±ã</span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">å¨å¤çéåæ¶ï¼æä»¬ç»å¸¸éè¦å»é¤éå¤çåç´ ï¼åæ¶ä¿æåæçé¡ºåºã</span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">ä½¿ç¨ <span class="md-pair-s"><code>HashSet</code><span class="md-plain"> å¯ä»¥é«æå°å®ç°è¿ä¸ç®æ ã</span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">é¦åå°æå®çé®å°è¯æ·»å å° <span class="md-pair-s"><code>HashSet</code><span class="md-plain"> ä¸­ï¼å¦ææ·»å æåï¼è¯´æè¯¥é®æ²¡æéå¤ï¼</span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">å¦ææ·»å å¤±è´¥ï¼è¯´æå·²ç»å­å¨ç¸åçé®ï¼æ­¤åç´ å°è¢«è¿æ»¤æã</span></p>
<h3 class="md-end-block md-heading"><strong><span class="md-plain" style="font-size: 16px">3ãå¤æç¨æ³</span></strong></h3>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><code>DistinctBy</code><span class="md-plain"> æ¹æ³å¯ä»¥ç¨äºæ´å¤æçå»éé»è¾ï¼ä¾å¦æ ¹æ®å¤ä¸ªå±æ§è¿è¡å»éã</span></span></p>
<p class="md-end-block md-p"><span class="md-pair-s " style="font-size: 16px"><strong>è¯´æ</strong></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">åè®¾æä»¬æä¸ä¸ªè®¢ååè¡¨ï¼æä»¬æ³è¦æ ¹æ®å®¢æ·åç§°åè®¢åéé¢å»é¤éå¤çè®¢åã</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> Order
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> OrderId { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> CustomerName { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">decimal</span> Amount { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
}
â
</span><span style="color: rgba(0, 0, 255, 1)">var</span> orders = <span style="color: rgba(0, 0, 255, 1)">new</span> List&lt;Order&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> Order { OrderId = <span style="color: rgba(128, 0, 128, 1)">1</span>, CustomerName = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Alice</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Amount = <span style="color: rgba(128, 0, 128, 1)">100.0m</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> Order { OrderId = <span style="color: rgba(128, 0, 128, 1)">2</span>, CustomerName = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Bob</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Amount = <span style="color: rgba(128, 0, 128, 1)">150.0m</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> Order { OrderId = <span style="color: rgba(128, 0, 128, 1)">3</span>, CustomerName = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Alice</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Amount = <span style="color: rgba(128, 0, 128, 1)">100.0m</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> Order { OrderId = <span style="color: rgba(128, 0, 128, 1)">4</span>, CustomerName = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Charlie</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Amount = <span style="color: rgba(128, 0, 128, 1)">120.0m</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> Order { OrderId = <span style="color: rgba(128, 0, 128, 1)">5</span>, CustomerName = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Bob</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Amount = <span style="color: rgba(128, 0, 128, 1)">150.0m</span><span style="color: rgba(0, 0, 0, 1)"> }
};
â
</span><span style="color: rgba(0, 0, 255, 1)">var</span> distinctOrders = orders.DistinctBy(order =&gt;<span style="color: rgba(0, 0, 0, 1)"> (order.CustomerName, order.Amount));
â
</span><span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> order <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> distinctOrders)
{
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Order ID: {order.OrderId}, Customer: {order.CustomerName}, Amount: {order.Amount}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
}</span></pre>
</div>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">è¾åºç»æï¼</span></p>
<div class="cnblogs_code">
<pre>Order ID: <span style="color: rgba(128, 0, 128, 1)">1</span>, Customer: Alice, Amount: <span style="color: rgba(128, 0, 128, 1)">100.0</span><span style="color: rgba(0, 0, 0, 1)">
Order ID: </span><span style="color: rgba(128, 0, 128, 1)">2</span>, Customer: Bob, Amount: <span style="color: rgba(128, 0, 128, 1)">150.0</span><span style="color: rgba(0, 0, 0, 1)">
Order ID: </span><span style="color: rgba(128, 0, 128, 1)">4</span>, Customer: Charlie, Amount: <span style="color: rgba(128, 0, 128, 1)">120.0</span></pre>
</div>
<h3 class="md-end-block md-heading"><strong><span class="md-plain" style="font-size: 16px">4ãæ§è½èè</span></strong></h3>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><code>DistinctBy</code><span class="md-plain"> æ¹æ³å¨åé¨ä½¿ç¨åå¸è¡¨æ¥è·è¸ªå·²ç»åºç°çé®ï¼å æ­¤å¨å¤§å¤æ°æåµä¸æ§è½éå¸¸å¥½ãä½å¨å¤çéå¸¸å¤§çæ°æ®éæ¶ï¼ä»ç¶éè¦æ³¨æåå­ä½¿ç¨æåµã</span></span></p>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><strong>è¯´æ</strong></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">åè®¾æä»¬æä¸ä¸ªåå«æ°ç¾ä¸æ¡è®°å½çå¤§éåï¼æä»¬éè¦æ ¹æ®æä¸ªé®è¿è¡å»éã</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> largeCollection = Enumerable.Range(<span style="color: rgba(128, 0, 128, 1)">1</span>, <span style="color: rgba(128, 0, 128, 1)">10000000</span>).Select(i =&gt; <span style="color: rgba(0, 0, 255, 1)">new</span> { Id = i, Value = i % <span style="color: rgba(128, 0, 128, 1)">1000</span><span style="color: rgba(0, 0, 0, 1)"> });
</span><span style="color: rgba(0, 0, 255, 1)">var</span> distinctLargeCollection = largeCollection.DistinctBy(item =&gt;<span style="color: rgba(0, 0, 0, 1)"> item.Value);
Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Distinct count: {distinctLargeCollection.Count()}</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<h3 class="md-end-block md-heading"><strong><span class="md-plain" style="font-size: 16px">5ãå¼æ­¥ LINQ æ¥è¯¢ä¸­çä½¿ç¨</span></strong></h3>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><code>DistinctBy</code><span class="md-plain"> æ¹æ³ä¹å¯ä»¥å¨å¼æ­¥ LINQ æ¥è¯¢ä¸­ä½¿ç¨ï¼ç»å <span class="md-pair-s"><code>IAsyncEnumerable&lt;T&gt;</code><span class="md-plain"> ç±»åï¼å¤çå¤§éæ°æ®æ¶æ´å é«æã</span></span></span></span></p>
<p class="md-end-block md-p"><span class="md-pair-s " style="font-size: 16px"><strong>è¯´æ</strong></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">åè®¾æä»¬æä¸ä¸ªå¼æ­¥æ¹æ³è¿åä¸ä¸ªç¨æ·åè¡¨ï¼æä»¬æ³è¦æ ¹æ®ç¨æ·åå»é¤éå¤çç¨æ·ã</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">using</span><span style="color: rgba(0, 0, 0, 1)"> System.Net.Http.Json;
â
</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">async</span> IAsyncEnumerable&lt;User&gt;<span style="color: rgba(0, 0, 0, 1)"> GetUsersAsync()
{
    </span><span style="color: rgba(0, 0, 255, 1)">var</span> response = <span style="color: rgba(0, 0, 255, 1)">await</span> httpClient.GetAsync(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">https://api.example.com/users</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">var</span> usersJson = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> response.Content.ReadAsStringAsync();
    
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä½¿ç¨Jsonåºååå·¥å·è§£æç¨æ·åè¡¨</span>
    <span style="color: rgba(0, 0, 255, 1)">var</span> users = JsonSerializer.Deserialize&lt;List&lt;User&gt;&gt;<span style="color: rgba(0, 0, 0, 1)">(usersJson);
    
    </span><span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> user <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> users)
    {
        </span><span style="color: rgba(0, 0, 255, 1)">yield</span> <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> user;
    }
}
â
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä½¿ç¨å¼æ­¥LINQæ¥è¯¢</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> distinctUsers = <span style="color: rgba(0, 0, 255, 1)">await</span> GetUsersAsync().DistinctByAsync(user =&gt;<span style="color: rgba(0, 0, 0, 1)"> user.Name).ToListAsync();
â
</span><span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> user <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> distinctUsers)
{
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Name: {user.Name}, Age: {user.Age}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
}</span></pre>
</div>
<h2 class="md-end-block md-heading"><span class="md-plain" style="font-size: 16px">æ»ç»</span></h2>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><code>DistinctBy</code><span class="md-plain"> æ¹æ³æ¯ .NET 6 å .NET 7 ä¸­ LINQ çä¸ä¸ªéå¸¸å®ç¨çæ°ç¹æ§ãæä»¬å¨ LINQ æ¥è¯¢ä¸­æ ¹æ®æå®çé®å¯¹éåè¿è¡å»éï¼ç®åäºä»£ç å¹¶æé«äºå¼åæçã</span></span></p>
<p class="md-end-block md-p md-focus"><span class="md-plain" style="font-size: 16px">å¸ææ¬æè½å¸®å©å¤§å®¶æ´å¥½å°çè§£åå©ç¨ .NET 6 å .NET 7 ä¸­ LINQ ç <span class="md-pair-s"><code>DistinctBy</code><span class="md-plain md-expand"> æ¹æ³ï¼ä»èå¨é¡¹ç®ä¸­åæ¥æ´å¤§çä½ç¨ã</span></span></span></p>
<h2 class="md-end-block md-heading"><span class="md-plain" style="font-size: 16px">æå</span></h2>
<p><span class="md-plain" style="font-size: 16px"><span class="md-plain md-expand">å¦æä½ è§å¾è¿ç¯æç« å¯¹ä½ æå¸®å©ï¼ä¸å¦¨ç¹ä¸ªèµæ¯æä¸ä¸ï¼ä½ çæ¯ææ¯æç»§ç»­åäº«ç¥è¯çå¨åãå¦ææä»»ä½çé®æéè¦è¿ä¸æ­¥çå¸®å©ï¼æ¬¢è¿éæ¶çè¨ãä¹å¯ä»¥å å¥å¾®ä¿¡å¬ä¼å·&nbsp;<span class="md-pair-s "><strong>[DotNetææ¯å ]</strong><span class="md-plain md-expand">&nbsp;ç¤¾åºï¼ä¸å¶ä»ç­ç±ææ¯çåè¡ä¸èµ·äº¤æµå¿å¾ï¼å±åæé¿ï¼</span></span></span></span></p>
<p><span class="md-plain" style="font-size: 16px"><img src="https://img2024.cnblogs.com/blog/576536/202408/576536-20240813102419584-1596250541.png" alt="" style="display: block; margin-left: auto; margin-right: auto"></span></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 16:34">2026-02-04 16:34</span>&nbsp;
<a href="https://www.cnblogs.com/1312mn">å°ç ç¼å </a>&nbsp;
éè¯»(<span id="post_view_count">229</span>)&nbsp;
è¯è®º(<span id="post_comment_count">3</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18552496);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18552496', targetLink: 'https://www.cnblogs.com/1312mn/p/18552496', title: '.NET ä¸­å¦ä½å¿«éå®ç° List éåå»éï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ£å­Cozeå®æï¼ä»0å°1æé æé³+å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½ ]]></title>
    <link>https://www.cnblogs.com/tangshiye/p/19575161</link>
    <guid>cc3ab3b5296045017cfe14ef1b67ca14</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/tangshiye/p/19575161" title="åå¸äº 2026-02-04 16:30">
    <span role="heading" aria-level="2">æ£å­Cozeå®æï¼ä»0å°1æé æé³+å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¤§å®¶å¥½ï¼ææ¯æ±¤å¸ç·ï¼ä¸æ³¨AIæºè½ä½åäº«ï¼è´åäºå¸®å©100Wäººç¨æºè½ä½åå¯~</p>
<p>ç­ç¹çæ§æºè½ä½æ¯å¸®ä½ èªå¨åç°çæ¬¾éé¢çå©å¨ã</p>
<p>å®è½å¨å¤©åæ«æåå¤§å¹³å°çç­é¨åå®¹ï¼ä»æµ·éä¿¡æ¯ä¸­ç­éåºææä»·å¼çè¯é¢ååæã</p>
<p>ä½ ä¸éè¦åæå¨æç´¢ï¼æºè½ä½ä¼èªå¨å°ç­ç¹åå®¹æ´çæè¡¨æ ¼ï¼è®©ä½ æ¸æ°ç´è§å°ææ¡è¡ä¸å¨æã</p>
<h3 id="1-ä¸ºä»ä¹è¦åç­ç¹çæ§">1 ä¸ºä»ä¹è¦åç­ç¹çæ§</h3>
<p>ç­ç¹çæ§æ¯åå®¹åä½èåè¥éäººåçå¿å¤å·¥å·ï¼å®å¸®å©æä»¬å¨ä¿¡æ¯çç¸æ¶ä»£ç²¾åææ¡ç¨æ·å³æ³¨ç¹ï¼æååå®¹ææåå½±ååãä»¥ä¸æ¯è¿è¡ç­ç¹çæ§çåå¤§æ ¸å¿çç±ï¼</p>
<p><strong>1. ææ¡ç¨æ·å´è¶£ï¼æé«åå®¹ç¸å³æ§</strong></p>
<p>ç¨æ·çæ³¨æåæ¯ç¨ç¼ºèµæºãéè¿å®æ¶çæ§ç­ç¹è¯é¢ï¼æä»¬è½äºè§£ç®æ åä¼å½ä¸æå³å¿çé®é¢åå´è¶£ç¹ãç­ç¹æ¬è´¨ä¸æ¯ç¨æ·å´è¶£çéä¸­ä½ç°ï¼åºäºç­ç¹åä½çåå®¹èªç¶å·ææ´é«çç¨æ·å¹éåº¦ï¼æ´å®¹æè·å¾å³æ³¨åäºå¨ã</p>
<p><strong>2. èçº¦éé¢æ¶é´ï¼æé«åä½æç</strong></p>
<p>æ²¡æç­ç¹çæ§ç³»ç»æ¶ï¼åä½èéè¦å¨åå¹³å°é´ä¸æ­åæ¢ï¼æå¨æç´¢åç­éä¿¡æ¯ï¼è¿ä¸ªè¿ç¨æ¢èæ¶åä½æãèªå¨åç­ç¹çæ§è½æç»­è¿½è¸ªå¤å¹³å°ç­é¨åå®¹ï¼å°éå¤æ§å·¥ä½äº¤ç»æºè½ä½ï¼è®©åä½èè½ä¸æ³¨äºåå®¹åä½æ¬èº«ã</p>
<p><strong>3. æä½æ¶æºï¼æé«æåæºä¼</strong></p>
<p>ç­ç¹å·æææ¾çæ¶ææ§ï¼è¶æ©åä¸è®¨è®ºï¼è·å¾çæåæºä¼å°±è¶å¤ãèªå¨åç­ç¹çæ§ç³»ç»è½å¨ç­ç¹ååºç°æ¶å°±ååºæéï¼å¸®å©åä½èæ¢å åæºãæ¯èµ·ç­ç­ç¹å®å¨çåååè·è¿ï¼æåå¸å±è½è·å¾æ´å¤æµéçº¢å©åå¹³å°ç®æ³éçã</p>
<p><strong>4. åç°åå®¹æºä¼ï¼é¿ååè´¨å</strong></p>
<p>ç­ç¹çæ§ä¸åªæ¯è¿½è¸ªå·²ç»çåçè¯é¢ï¼æ´éè¦çæ¯åç°æ½å¨æ°å´ç­ç¹ãéè¿åæç­ç¹æ°æ®ï¼åä½èå¯ä»¥è¯å«å°æªè¢«ååææçåå®¹æºä¼ï¼é¿å¼åè´¨åç«äºï¼æ¾å°å·®å¼åè¡¨è¾¾è§åº¦ï¼ä»èå¨æ¿ççåå®¹ç«äºä¸­è±é¢èåºã</p>
<h3 id="2-ç­ç¹çæ§æºè½ä½æ­å»ºæµç¨">2 ç­ç¹çæ§æºè½ä½æ­å»ºæµç¨</h3>
<p>æºè½ä½çæ­å»ºæµç¨ä¸»è¦åä¸ºä¸¤ä¸ªæ­¥éª¤ï¼æ¢³çå·¥ä½æµåè®¾ç½®æºè½ä½ã</p>
<p><strong>1ãæ¢³çå·¥ä½æµ</strong></p>
<p>ç­ç¹çæ§å·¥ä½æµæ¯ä¸å¥èªå¨åä¿¡æ¯ééåå¤çç³»ç»ï¼è½å°äººå·¥éè¦å å°æ¶çè³å å¤©å®æçå·¥ä½åç¼©è³å åéåèªå¨å®æãè¿ä¸å·¥ä½æµä¸»è¦åå«ä¸å¤§ç¯èï¼</p>
<p><strong>ï¼1ï¼æ ¹æ®å³é®è¯ï¼æ¹éè·åç­é¨è§é¢</strong></p>
<p>ç³»ç»æ ¹æ®é¢è®¾çå³é®è¯ï¼å¦è¡ä¸ç­è¯ãäº§ååç§°ãç«åä¿¡æ¯ç­ï¼ï¼èªå¨ä»æé³ãå°çº¢ä¹¦ç­å¹³å°æç´¢ç¸å³è§é¢ãè¿ä¸æ­¥éª¤æ¿ä»£äºæå¨æç´¢åæµè§ç»æçè¿ç¨ï¼å¤§å¹æé«æçã</p>
<p><strong>ï¼2ï¼æ¹éè·åè§é¢è¯¦ç»ä¿¡æ¯</strong></p>
<p>è·åè§é¢åè¡¨åï¼ç³»ç»è¿ä¸æ­¥æåæ¯ä¸ªè§é¢çè¯¦ç»æ°æ®ï¼åæ¬ï¼</p>
<ul>
<li>åºç¡ä¿¡æ¯ï¼è§é¢IDãæ é¢ãé¾æ¥ãåå¸æ¶é´ãè§é¢æ¶é¿ç­</li>
<li>äºå¨æ°æ®ï¼ç¹èµæ°ãè¯è®ºæ°ãæ¶èæ°ãåäº«æ°ç­å³é®ææ </li>
<li>åä½èä¿¡æ¯ï¼ä½èåç§°ãç¨æ·IDãä¸ªäººç®ä»ç­</li>
</ul>
<p>è¿äºæ°æ®æ¯åæè§é¢ç­åº¦ååæ¬¢è¿ç¨åº¦çå³é®ææ ï¼ä¹æ¯å¤æ­åå®¹ä»·å¼çéè¦ä¾æ®ãç³»ç»å°è¿äºé¶æ£æ°æ®æ´åæç»æåä¿¡æ¯ï¼ä¾¿äºåç»­åæã</p>
<p><strong>ï¼3ï¼å°æ°æ®æ·»å å°å¤ç»´è¡¨æ ¼</strong></p>
<p>æåï¼ç³»ç»å°å¤çå¥½çæ°æ®èªå¨å¯¼å¥å°é¢è®¾çé£ä¹¦å¤ç»´è¡¨æ ¼ä¸­ã</p>
<p>éè¿è¿æ ·çèªå¨åå¤çï¼æä»¬è½å»ºç«ä¸ä¸ªå®æ¶æ´æ°çç­ç¹åå®¹åºï¼éæ¶æ¥çè¡ä¸å¨æï¼åç°çæ¬¾éé¢çµæã</p>
<p>è¿ç§å·¥ä½æµæ¾èåè½»äºè¿è¥äººåçå·¥ä½è´æï¼è®©æä»¬è½å°æ´å¤ç²¾åæå¥å°åå®¹åä½åç­ç¥å¶å®ä¸ã</p>
<p><strong>2ãè®¾ç½®æºè½ä½</strong></p>
<p>å®æå·¥ä½æµæ­å»ºåï¼æä»¬éè¦åå»ºä¸ä¸ªç­ç¹çæ§æºè½ä½æ¥æ§è¡è¿ä¸ªå·¥ä½æµãæºè½ä½è®¾ç½®è¿ç¨åä¸ºä¸ä¸ªå³é®æ­¥éª¤ï¼</p>
<ol>
<li>è®¾ç½®äººè®¾ä¸é»è¾ï¼éç½®æºè½ä½çç¹å¾ãåå¤é£æ ¼åå³ç­é»è¾</li>
<li>ç»å®å·¥ä½æµï¼å°å·¥ä½æµä¸æºè½ä½å³èï¼èµäºå®æ§è¡å·ä½ä»»å¡çè½å</li>
<li>æµè¯å¹¶åå¸ï¼è¿è¡å¨é¢åè½æµè¯ï¼ç¡®è®¤ä¸åæ­£å¸¸åå°æºè½ä½æ­£å¼åå¸å°çäº§ç¯å¢</li>
</ol>
<p>å®æè¿ä¸ä¸ªæ­¥éª¤åï¼æä»¬å°±æåæ­å»ºäºä¸ä¸ªç­ç¹çæ§æºè½ä½ã</p>
<h3 id="3-æé³ç­ç¹çæ§å·¥ä½æµ">3 æé³ç­ç¹çæ§å·¥ä½æµ</h3>
<p>åé¢æä»¬è¯¦ç»ä»ç»äºç­ç¹çæ§çéè¦æ§åæºè½ä½æ­å»ºçåºæ¬æµç¨ï¼æ¥ä¸æ¥æä»¬å°æ·±å¥äºè§£å¦ä½å®éæ­å»ºä¸ä¸ªæé³ç­ç¹çæ§å·¥ä½æµã</p>
<p>ç»å½Cozeå®ç½ï¼å¨âèµæºåº-å·¥ä½æµâéæ°å»ºä¸ä¸ªç©ºç½å·¥ä½æµï¼ååâfetch_douyin_hot_videosâã</p>
<p>å·¥ä½æµæ´ä½é¢è§å¦å¾æç¤ºã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952712-14727349.jpg" class="lazyload"></p>
<p><strong>1ãå¼å§èç¹</strong></p>
<p>è¿éç¨äºå®ä¹å·¥ä½æµå¯å¨æ¶æéçè¾å¥åæ°ãå¦å¾6-2æç¤ºã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>keywordsï¼ç¨äºæç´¢ç­ç¹çå³é®è¯ï¼å¯ä»¥æ¯äº§ååç§°ãè¡ä¸æ¯è¯­ãç«ååç§°æç­é¨è¯é¢ï¼ç³»ç»ä¼èªå¨æç´¢ç¸å³çç­é¨åå®¹</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952628-740163231.jpg" class="lazyload"></p>
<p><strong>2ãæä»¶èç¹ï¼æ ¹æ®å³é®è¯ï¼æ¹éè·åç­é¨è§é¢</strong></p>
<p>æä»¬å°ä½¿ç¨"è§é¢æç´¢"æä»¶ç"douyin_search"å·¥å·ãéè¿è¿ä¸ªåè½ï¼æä»¬å¯ä»¥æ ¹æ®å³é®è¯æ¹éè·åç­é¨è§é¢ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>api_tokenï¼è¿ééè¦å¡«å¥ä½ çAPIå¯é¥ï¼å¯ä»¥ä»æä»¶çå®æ¹å¹³å°è·åï¼å®æ¯è°ç¨è§é¢æ°æ®çéè¦å­è¯ï¼ç¸å½äºä½ çèº«ä»½è¯æ</li>
<li>keywordï¼å³é®è¯ï¼ä»å¼å§èç¹è·å</li>
<li>pageï¼è·åç¬¬å é¡µçåå®¹</li>
<li>publish_timeï¼åå¸æ¶é´ï¼å¯ç¨å¼ä¸º_0(ä¸é)ã_1(ä¸å¤©ä¹å)ã_7(ä¸å¨ä¹å)ã_180(åå¹´ä¹å)ï¼è¿éæä»¬éæ©_7</li>
<li>sort_typeï¼æåºç±»åï¼å¯ç¨å¼ï¼_0(ç»¼å)ã_1(æå¤ç¹èµ)ã_2(ææ°åå¸)ï¼è¿éæä»¬éæ©_1</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952527-440199834.jpg" class="lazyload"></p>
<p><strong>4ãæ¹å¤çèç¹ï¼æ¹éè·åè§é¢è¯¦ç»ä¿¡æ¯</strong></p>
<p>æ¹éè·åè§é¢è¯¦ç»ä¿¡æ¯æ¯å·¥ä½æµä¸­çæ ¸å¿èç¹ï¼å®è´è´£å°ä¸ä¸æ­¥éª¤ä¸­è·åçè§é¢åè¡¨è¿ä¸æ­¥æ·±å¥å¤çï¼è·åæ¯ä¸ªè§é¢çå®æ´ä¿¡æ¯ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>å¹¶è¡è¿è¡æ°éï¼è®¾ç½®éå½çå¹¶è¡æ°éå¯æé«å·¥ä½æµæ§è¡æçï¼è®¾ç½®ä¸º1åæé¡ºåºä¸²è¡æ§è¡</li>
<li>æ¹å¤çæ¬¡æ°ä¸éï¼æ¹å¤çæä½ä¸ä¼è¶è¿è¿ä¸ªè®¾å®çæå¤§æ¬¡æ°</li>
<li>aweme_listï¼ä»"æ ¹æ®å³é®è¯ï¼æ¹éè·åç­é¨è§é¢"èç¹è¾åºä¸­ï¼éæ©dataï¼ç±»åä¸ºArray</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952486-1327396496.jpg" class="lazyload"></p>
<p><strong>5ãæ¹å¤çä½åæä»¶èç¹ï¼è·ååä¸ªè§é¢è¯¦ç»ä¿¡æ¯</strong></p>
<p>æ¥ä¸æ¥ï¼æä»¬éè¦æ·»å æ¹å¤çä½åçèç¹ãæä»¬å°ä½¿ç¨"è§é¢æç´¢"æä»¶çdouyin_dataå·¥å·ï¼éè¿è¿ä¸ªåè½å¯ä»¥æ ¹æ®æé³è§é¢é¾æ¥è·åè§é¢çè¯¦ç»ä¿¡æ¯ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>api_tokenï¼APIå¯é¥</li>
<li>douyin_urlï¼ä»"æ¹éè·åè§é¢è¯¦ç»ä¿¡æ¯"èç¹çè¾åºä¸­ï¼éæ©share_url</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952652-1121892699.jpg" class="lazyload"></p>
<p><strong>6ãæ¹å¤çä½åä»£ç èç¹ï¼å°è§é¢è¯¦ææ´åè¿è§é¢åè¡¨ä¸­</strong></p>
<p>è¿ä¸æ­¥å°ä»æé³APIè·åçè¯¦ç»è§é¢ä¿¡æ¯ä¸ä¹åæ¶éçè§é¢åè¡¨æ°æ®åå¹¶ã</p>
<p>éè¿è¿ä¸ªè¿ç¨ï¼æä»¬è½ææ¡æ¯ä¸ªè§é¢çå®æ´ä¿¡æ¯ï¼åæ¬äºå¨æ°æ®ï¼ç¹èµãè¯è®ºãæ¶èæ°ï¼ãåä½èä¿¡æ¯ååå®¹è¯¦æï¼ä»èä¸ºåç»­åææä¾å¨é¢çæ°æ®åºç¡ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>aweme_detailï¼ä»"è·ååä¸ªè§é¢è¯¦ç»ä¿¡æ¯"èç¹çè¾åºä¸­ï¼éæ©aweme_detail</li>
<li>awemeï¼ä»"æ¹éè·åè§é¢è¯¦ç»ä¿¡æ¯"èç¹çè¾åºä¸­ï¼éæ©item</li>
</ul>
</li>
<li>è¾åºï¼
<ul>
<li>aweme_listï¼åéç±»åè®¾ç½®ä¸º Array å¯¹è±¡æ°ç»ï¼è¡¨ç¤ºå¤çåçè§é¢åè¡¨</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952653-834122167.jpg" class="lazyload"></p>
<p>ä¸é¢æ¯å¤çæ°æ®çPythonä»£ç ï¼å®ä¼å°è§é¢ä¿¡æ¯è½¬æ¢ææä»¬éè¦çæ ¼å¼ã</p>
<pre><code class="language-python">async def main(args: Args) -&gt; Output:
    params = args.params
    aweme_detail = params.get("aweme_detail", {})
    aweme = params.get("aweme", {})
    aweme["aweme_detail"] = aweme_detail

    ret: Output = {
        "aweme_list": [aweme]
    }
    return ret
</code></pre>
<p><strong>7ãæ¹å¤çä½åä»£ç èç¹ï¼å°ä¿¡æ¯æ´çä¸ºé£ä¹¦è¡¨æ ¼å¯ä»¥ä½¿ç¨çæ°æ®</strong></p>
<p>å¨è¿ä¸ªç¯èä¸­ï¼æä»¬ä¼æåè§é¢çæ ¸å¿ä¿¡æ¯ï¼å¦æ é¢ãç¹èµæ°ãè¯è®ºæ°ç­ï¼ï¼å¹¶å°å®ä»¬è½¬æ¢æé£ä¹¦è¡¨æ ¼è½å¤ç´æ¥è¯å«åå¤ççæ ¼å¼ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>aweme_listï¼ä»"å°è§é¢è¯¦ææ´åè¿è§é¢åè¡¨ä¸­"èç¹çè¾åºä¸­ï¼éæ©aweme_list</li>
<li>keywordsï¼ä»å¼å§èç¹ä¸­ï¼éæ©keywords</li>
</ul>
</li>
<li>è¾åºï¼
<ul>
<li>recordsï¼å¤çåçè¡¨æ ¼æ°æ®ï¼éæ©Arrayç±»å</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952664-4256941.jpg" class="lazyload"></p>
<p>ä¸é¢æ¯å¤çæ°æ®çPythonä»£ç ï¼è¿æ®µä»£ç éå¸¸éè¦ï¼å®è´è´£å°æé³APIè¿åçåå§æ°æ®è½¬æ¢æç»æåçè¡¨æ ¼æ°æ®ã</p>
<pre><code class="language-python">async def main(args: Args) -&gt; Output:
    params = args.params
    aweme_list = params.get("aweme_list", [])

    result = []

    # éå aweme_listï¼ä¾æ¬¡å¤ç
    for aweme in aweme_list:

        # è·å aweme_detail å¹¶å¤ç©º
        aweme_detail = aweme.get("aweme_detail") or {}
        title = aweme_detail.get("desc") or ""
        link = aweme_detail.get("share_url") or ""

        # å®å¨è·å statistics
        statistics = aweme_detail.get("statistics") or {}

        # æååå­æ®µä¿¡æ¯ï¼å¹¶å¨åå¼æ¶å é»è®¤å¼
        video_id = statistics.get("aweme_id") or ""
        digg_count = statistics.get("digg_count") or 0
        comment_count = statistics.get("comment_count") or 0
        collect_count = statistics.get("collect_count") or 0
        share_count = statistics.get("share_count") or 0

        # è·åä½èä¿¡æ¯
        author_info = aweme_detail.get("author") or {}
        author_name = author_info.get("nickname") or ""
        signature = author_info.get("signature") or ""
        sec_uid = author_info.get("sec_uid") or ""
        raw_create_time = aweme_detail.get("create_time", 0)
        # å¦æä¸æ¯ intï¼å°±å°è¯è½¬æ¢ï¼å¤±è´¥åä¸º 0
        try:
            create_time = int(raw_create_time)
        except (TypeError, ValueError):
            create_time = 0

        # åå»ºæ¶é´ä»¥æ¯«ç§è®¡ï¼é¿å None æéæ³å¼å¯¼è´æ¥é
        create_time_ms = create_time * 1000

        raw_duration = aweme_detail.get("duration", 0)
        # å¦æä¸æ¯æ°å­ï¼å°è¯è½¬æ¢ä¸º floatï¼å¤±è´¥åä¸º 0
        try:
            duration = float(raw_duration)
        except (TypeError, ValueError):
            duration = 0.0
        duration_sec = duration / 1000

        # ç»è£è¿åæ°æ®
        item_dict = {
            "fields": {
                "è§é¢ID": video_id,
                "æ é¢": title.strip(),
                "å³é®è¯": params.get("keywords", ""),
                "é¾æ¥": {
                    "text": "æ¥çè§é¢",
                    "link": link.strip(),
                },
                "ç¹èµæ°": digg_count,
                "è¯è®ºæ°": comment_count,
                "æ¶èæ°": collect_count,
                "åäº«æ°": share_count,
                "ä½è": author_name,
                "ç¨æ·ç®ä»": signature,
                "ç¨æ·ID": sec_uid,
                "åå¸æ¥æ": create_time_ms,  # æ¯«ç§çº§æ¶é´æ³
                "æ¶é¿": duration_sec        # ç§
            }
        }
        result.append(item_dict)

    return result
</code></pre>
<p><strong>8ãæ¹å¤çä½åæä»¶èç¹ï¼å°æ°æ®æ·»å å°å¤ç»´è¡¨æ ¼</strong></p>
<p>é¦åï¼æä»¬éè¦åå»ºä¸ä¸ªå¤ç»´è¡¨æ ¼å¹¶è®¾ç½®å¥½è¡¨å¤´å­æ®µï¼ä¸ºåç»­æ°æ®ééåå¥½åå¤ãè¿ä¸ªè¡¨æ ¼æ¯å­å¨ååææé³ç­ç¹è§é¢æ°æ®çæ ¸å¿ï¼å æ­¤è¡¨å¤´è®¾è®¡è³å³éè¦ãæä»¬åºåå«è§é¢IDãæ é¢ãç¹èµæ°ãè¯è®ºæ°ç­å³é®ä¿¡æ¯ï¼ä¾¿äºåæåæåç­éãåå»ºå¥½çè¡¨æ ¼çé¢å¦ä¸å¾æç¤ºã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952650-2034950698.jpg" class="lazyload"></p>
<p>éæ©"é£ä¹¦è¡¨æ ¼"æä»¶èç¹çadd_recordså·¥å·ï¼å°æ°æ®æ·»å å°å¤ç»´è¡¨æ ¼ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952610-1898602827.jpg" class="lazyload"></p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>app_tokenï¼æååå»ºä¸ä¸ªå¤ç»´è¡¨æ ¼ï¼å°å¤ç»´è¡¨æ ¼çé¾æ¥å¤å¶è¿å»ã</li>
<li>recordsï¼ä»"å°ä¿¡æ¯æ´çä¸ºé£ä¹¦è¡¨æ ¼å¯ä»¥ä½¿ç¨çæ°æ®"çè¾åºåéä¸­ï¼éæ©recordsã</li>
<li>table_idï¼å¤ç»´è¡¨æ ¼æ°æ®è¡¨çå¯ä¸æ è¯ç¬¦ï¼å¦å¾6-10æç¤ºã</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952606-670315629.jpg" class="lazyload"></p>
<p><strong>9ãç»æèç¹</strong></p>
<p>éæ©"è¿åææ¬"ï¼å¹¶å°åç­åå®¹è®¾ç½®ä¸ºï¼"è·åå³é®è¯ä¸çæææé³è§é¢ãå®æã"ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952599-2065139559.jpg" class="lazyload"></p>
<h3 id="4æé³ç­ç¹çæ§æºè½ä½è®¾ç½®">4.æé³ç­ç¹çæ§æºè½ä½è®¾ç½®</h3>
<p>å°ç®åä¸ºæ­¢ï¼æä»¬å·²ç»ä»ç»äºæé³ç­ç¹çæ§å·¥ä½æµçæ­å»ºè¿ç¨ãæ¥ä¸æ¥ï¼æä»¬å°ä»ç»æé³ç­ç¹çæ§æºè½ä½çè®¾ç½®ãè¿ä¸ªç¯èå°å·¥ä½æµä¸æºè½ä½ç»å®ï¼åªæå®æè¿ä¸æ­¥ï¼æä»¬æè½çæ­£å®ç°æé³ç­ç¹çæ§æºè½ä½çåè½ã</p>
<p>æ¥ä¸æ¥ï¼æä»¬å°éæ­¥æå¯¼ä½ å®ææ´ä¸ªè®¾ç½®è¿ç¨ï¼åæ¬åå»ºæºè½ä½ãéç½®åºæ¬åæ°ãè¿æ¥å·¥ä½æµä»¥åè¿è¡æµè¯ï¼å¸®å©ä½ å¿«éææ¡è¿é¡¹å®ç¨æè½ã</p>
<p><strong>1ãæ°å»ºæºè½ä½</strong></p>
<p>å¨Cozeå¹³å°åå»ºä¸ä¸ªæ°çæºè½ä½ï¼å°å¶å½åä¸º"æé³ç­ç¹çæ§æºè½ä½"ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952547-498426495.jpg" class="lazyload"></p>
<p><strong>2ãè®¾ç½®äººè®¾ä¸é»è¾</strong></p>
<p>è®¾ç½®äººè®¾ä¸é»è¾æ¯åå»ºæºè½ä½çå³é®æ­¥éª¤ãå¨è¿ä¸ç¯èï¼æä»¬éè¦æç¡®æºè½ä½çè¡ä¸ºæ¨¡å¼åååºæ¹å¼ã</p>
<p>å¯¹äºæé³ç­ç¹çæ§æºè½ä½ï¼æä»¬å¸æå®è½ç´æ¥æ§è¡ä»»å¡ï¼æ éè¿å¤äº¤äºãå æ­¤ï¼æä»¬è®¾ç½®ç®åæäºçæä»¤ï¼è®©æºè½ä½å¨æ¥æ¶å°å³é®è¯åç«å³æ§è¡è§é¢ééå·¥ä½ã</p>
<pre><code>ç´æ¥æ§è¡`fetch_douyin_hot_videos`
</code></pre>
<p><strong>3ãç»å®å·¥ä½æµ</strong></p>
<p>æ"fetch_douyin_hot_videos"å·¥ä½æµæ·»å å°æºè½ä½ä¸­ãè¿ä¸ªå·¥ä½æµæ¯æä»¬ä¹åè®¾è®¡çæé³è§é¢ééå·¥ä½æµï¼å°å®ç»å®å°æºè½ä½åï¼ç¨æ·åªéè¾å¥å³é®è¯ï¼æºè½ä½å°±ä¼èªå¨æ§è¡å·¥ä½æµï¼å¸®å©æä»¬é«æå°æ¶éæé³ç­ç¹è§é¢ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952687-1321051239.jpg" class="lazyload"></p>
<p><strong>5ãæµè¯å¹¶åå¸</strong></p>
<p>å¨é¢è§ä¸è°è¯çªå£ä¸­è¾å¥å³é®è¯ï¼æµè¯æºè½ä½ééç­ç¹æé³è§é¢çåè½ãç³»ç»ä¼èªå¨æ§è¡å·¥ä½æµï¼å¹¶å°ç»ææ·»å å°é£ä¹¦è¡¨æ ¼ä¸­ã</p>
<p>ä½¿ç¨ä¸åå³é®è¯è¿è¡å¤æ¬¡æµè¯ï¼ç¡®ä¿æºè½ä½å¨åç§æåµä¸é½è½ç¨³å®è¿è¡ãæµè¯æ è¯¯åï¼ç¹å»"åå¸"æé®å°æºè½ä½æ­£å¼åå¸å°çäº§ç¯å¢ï¼ä¾ç¨æ·ä½¿ç¨ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952704-1674920919.jpg" class="lazyload"></p>
<h3 id="5å°çº¢ä¹¦ç­ç¹çæ§å·¥ä½æµ">5.å°çº¢ä¹¦ç­ç¹çæ§å·¥ä½æµ</h3>
<p>æ¥ä¸æ¥æä»¬å°æ·±å¥äºè§£å¦ä½å®éæ­å»ºä¸ä¸ªå°çº¢ä¹¦ç­ç¹çæ§å·¥ä½æµã</p>
<p>è¿ä¸ªå·¥ä½æµè½å¸®ä½ èªå¨æ¶éå°çº¢ä¹¦å¹³å°ä¸çç­é¨åå®¹ï¼è®©ä½ ä¸ç¨æå¨æµè§å°±è½ææ¡ææ°è¶å¿ã</p>
<p>æä»¬å°ä½¿ç¨ç®åææçæ­¥éª¤ï¼å¸¦ä½ ä»é¶å¼å§æå»ºè¿ä¸ªå¼ºå¤§ççæ§ç³»ç»ï¼å³ä½¿ä½ æ²¡æç¼ç¨ç»éªä¹è½è½»æ¾ä¸æã</p>
<p>ç»å½Cozeå®ç½ï¼å¨âèµæºåº-å·¥ä½æµâéæ°å»ºä¸ä¸ªç©ºç½å·¥ä½æµï¼ååâxhs_keywordsâãå·¥ä½æµæ´ä½é¢è§å¦å¾æç¤ºã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952819-1031545334.jpg" class="lazyload"></p>
<p><strong>1ãå¼å§èç¹</strong></p>
<p>è¿éç¨äºå®ä¹å·¥ä½æµå¯å¨æ¶æéçè¾å¥åæ°ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>foldUrlï¼é£ä¹¦è¡¨æ ¼é¾æ¥ï¼éè¦æååå»ºå¥½ä¸ä¸ªé£ä¹¦å¤ç»´è¡¨æ ¼ï¼å¹¶å¤å¶å¶é¾æ¥ãè¯¥è¡¨æ ¼å°ç¨äºå­å¨æä»¬ééå°çå°çº¢ä¹¦ç­ç¹è§é¢</li>
<li>cookieï¼å°çº¢ä¹¦ç½ç«çcookieä¿¡æ¯ï¼è¿æ¯è®¿é®å°çº¢ä¹¦APIçå¿è¦å­è¯ï¼æä»¬å°å¨åé¢è¯¦ç»è®²è§£å¦ä½è·å</li>
<li>keywordsï¼ç¨äºæç´¢ç­ç¹çå³é®è¯ï¼å¯ä»¥æ¯äº§ååç§°ãè¡ä¸æ¯è¯­ãç«ååç§°æç­é¨è¯é¢ï¼ç³»ç»ä¼èªå¨æç´¢ç¸å³çç­é¨åå®¹</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952691-6617434.jpg" class="lazyload"></p>
<p><strong>2ãå¦ä½è·åå°çº¢ä¹¦cookie</strong></p>
<p>å¨Chromeæµè§å¨ä¸­ï¼ç»å½å°çº¢ä¹¦ä¸»é¡µï¼<a href="https://www.xiaohongshu.com/" target="_blank" rel="noopener nofollow">https://www.xiaohongshu.com/</a></p>
<p>æF12é®æå¼å¼åèå·¥å·é¢æ¿ï¼ç¶åæç§ä»¥ä¸æ­¥éª¤æä½ï¼</p>
<ul>
<li>ç¬¬ä¸æ­¥ï¼ç¹å»ãç½ç»ãéé¡¹å¡</li>
<li>ç¬¬äºæ­¥ï¼ç¹å»ãææ¡£ãæ ç­¾</li>
<li>ç¬¬ä¸æ­¥ï¼ç¹å»ãexploreãææ¡£</li>
<li>ç¬¬åæ­¥ï¼ç¹å»ãæ å¤´ãéé¡¹å¡</li>
<li>ç¬¬äºæ­¥ï¼æ»å¨é¡µé¢æ¾å°Cookieå­æ®µï¼å¤å¶æ´æ®µCookieä¿¡æ¯ã</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952718-703458779.jpg" class="lazyload"></p>
<p><strong>2ãæä»¶èç¹ï¼æ ¹æ®å³é®è¯è·åç¬è®°</strong></p>
<p>æä»¬å°ä½¿ç¨âå°çº¢ä¹¦âæä»¶çxhs_search_noteå·¥å·ãéè¿è¿ä¸ªåè½ï¼æä»¬å¯ä»¥æ ¹æ®å³é®è¯ï¼æ¹éè·åç­é¨è§é¢ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952800-1170167012.jpg" class="lazyload"></p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>cookieStrï¼å¼å§èç¹ç cookie</li>
<li>keywordsï¼å³é®è¯ï¼ä»å¼å§èç¹è·å</li>
<li>notTypeï¼æ¥è¯¢ç±»åï¼0=å¨é¨ï¼1=è§é¢ï¼2=å¾æï¼ï¼è¿éæä»¬éæ©1 è§é¢ç±»å</li>
<li>sortï¼æåºï¼é»è®¤ä¸ºç»¼åï¼0=ç»¼åï¼1=ææ°ï¼2=æç­ï¼ï¼è¿éæä»¬éæ©2 æç­</li>
<li>totalNumberï¼æ¥è¯¢æ»æ°ï¼è¿éæä»¬è¾å¥20</li>
</ul>
</li>
</ul>
<p><strong>3ãå¾ªç¯èç¹ï¼å¾ªç¯è·åç¬è®°è¯¦æ</strong></p>
<p>å¾ªç¯è·åç¬è®°è¯¦ææ¯å·¥ä½æµä¸­çå³é®ç¯èï¼å®ä½¿æä»¬è½å¤ä¸æ¬¡æ§å¤çå¤æ¡å°çº¢ä¹¦ç¬è®°ãä»æç´¢ç»æä¸­è·åç¬è®°é¾æ¥åï¼æä»¬éè¦éä¸è·åæ¯æ¡ç¬è®°çè¯¦ç»ä¿¡æ¯ï¼åæ¬æ é¢ãåå®¹ãä½èåç¹èµæ°ç­ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>inputï¼ä»"æ ¹æ®å³é®è¯è·åç¬è®°"èç¹çè¾åºä¸­ï¼éæ© data</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952494-338129973.jpg" class="lazyload"></p>
<p><strong>4ãå¾ªç¯ä½åæä»¶èç¹ï¼è·åç¬è®°è¯¦æ</strong></p>
<p>æä»¬å°ä½¿ç¨å°çº¢ä¹¦æä»¶çxhs_note_detailå·¥å·ãè¯¥å·¥å·è½è·åæ¯æ¡ç¬è®°çå®æ´ä¿¡æ¯ï¼åæ¬æ é¢ãåå®¹ãä½èä¿¡æ¯åäºå¨æ°æ®ç­ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952774-368074992.jpg" class="lazyload"></p>
<ul>
<li>è¾å¥
<ul>
<li>cookieStrï¼å¼å§èç¹ç cookie</li>
<li>noteUrlï¼ä» âå¾ªç¯ç¬è®°è¯¦æâ èç¹çè¾åºä¸­ï¼éæ© noteUrl</li>
</ul>
</li>
</ul>
<p><strong>5ãå¾ªç¯ä½åæä»¶èç¹ï¼æåè§é¢ææ¡</strong></p>
<p>æä»¬å°ä½¿ç¨"å­å¹è·å"æä»¶çgenerate_video_captions_syncå·¥å·ãè¯¥å·¥å·è½èªå¨ä»è§é¢ä¸­æåæå­åå®¹ï¼å°å£è¿°è½¬æ¢ä¸ºææ¬ï¼çå»æå¨å¬åçéº»ç¦ãå®è½ç²¾åè¯å«è§é¢ä¸­çè¯­é³å¹¶çææå­è®°å½ï¼å¸®å©æä»¬å¿«éçè§£è§é¢çä¸»é¢åå³é®ä¿¡æ¯ã</p>
<p>è¾å¥ï¼</p>
<ul>
<li>urlï¼ä»"è·åç¬è®°è¯¦æ"èç¹çè¾åºä¸­ï¼éæ© video_h264_urlï¼è¡¨ç¤ºH264æ åç¼ç æ ¼å¼è§é¢é¾æ¥</li>
<li>langï¼è§é¢è¯­è¨ï¼å¦æ±è¯­ãè±è¯­ç­ï¼ä¸å¡«æ¶é»è®¤ä¸ºæ±è¯­</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952728-408891549.jpg" class="lazyload"></p>
<p><strong>6ãå¾ªç¯ä½åä»£ç èç¹ï¼å°ç¬è®°æ°æ®æ´çæé£ä¹¦è¡¨æ ¼æ ¼å¼</strong></p>
<p>è¿ä¸æ­¥å°ééå°çè§é¢ä¿¡æ¯è½¬æ¢ä¸ºæ ååæ°æ®ç»æï¼ä»¥ä¾¿åå¥é£ä¹¦è¡¨æ ¼ãæä»¬éè¦æåè§é¢çæ é¢ãåå®¹ãä½èåç¹èµæ°ç­å³é®ä¿¡æ¯ï¼å¹¶æé£ä¹¦è¡¨æ ¼è¦æ±è¿è¡æ ¼å¼åãè¿æ ·ä¸ä»ä¾¿äºæ°æ®æ´çåç­éï¼è¿è½å¸®å©æä»¬æ´ç´è§å°åæç­é¨åå®¹çç¹ç¹ã</p>
<ul>
<li>è¾å¥
<ul>
<li>inputï¼ä»"è·åç¬è®°è¯¦æ"èç¹çè¾åºä¸­ï¼éæ©note</li>
<li>dataï¼ä»"æåè§é¢ææ¡"èç¹çè¾åºä¸­ï¼éæ©data</li>
</ul>
</li>
<li>è¾åº
<ul>
<li>recordsï¼åéç±»åè®¾ç½®ä¸º Array å¯¹è±¡æ°ç»ï¼è¡¨ç¤ºå¤çåçè§é¢åè¡¨</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952845-165290149.jpg" class="lazyload"></p>
<p>ä¸é¢æ¯å¤çæ°æ®çPythonä»£ç ï¼å®å°ééå°çå°çº¢ä¹¦è§é¢ä¿¡æ¯è½¬æ¢ä¸ºæ åæ ¼å¼ï¼ä¾¿äºå­å¨ååæã</p>
<p>ä»£ç æåè§é¢çæ é¢ãåå®¹ãä½èç­å³é®ä¿¡æ¯ï¼å°å¶ç»ç»æé£ä¹¦è¡¨æ ¼æéçæ ¼å¼ï¼ç¶åè¿åå¤çå¥½çæ°æ®ãè¿æ ·æä»¬è½å°ææç­é¨è§é¢æ´é½å°å­æ¾å¨åä¸å¼ è¡¨æ ¼ä¸­ï¼æ¹ä¾¿åç»­åæï¼</p>
<pre><code class="language-python">async def main(args: Args) -&gt; Output:
    input_data = args.params.get('input')  or {}
    data = args.params.get('data') or {}

    records = []  # åå§å records åè¡¨

    # æå note ç¸å³å­æ®µ
    title = input_data.get('note_display_title', '')  # æ é¢
    desc = input_data.get('note_desc', '')  # æè¿°
    url = input_data.get('note_url', '')  # é¾æ¥
    nickname = input_data.get('auther_nick_name', '')  # ä½èæµç§°
    likedCount = input_data.get('note_liked_count', '0')  # ç¹èµæ°
    videoUrl = input_data.get('video_h264_url', '')  # è§é¢å°å
    collectedCount = input_data.get('collected_count', '0')  # æ¶èæ°
    imageList = input_data.get('note_image_list', [])  # å¾çåè¡¨

    # æå»ºè®°å½å¯¹è±¡
    record = {
        "fields": {
            "ç¬è®°é¾æ¥": url,
            "æ é¢": title,
            "åå®¹": desc,
            "ä½è": nickname,
            "ç¹èµæ°": likedCount,
            "é¾æ¥": {
                "link": url,
                "text": title
            },
            "æ¶èæ°": collectedCount,
            "å¾çå°å": '\n'.join(imageList),  # å°å¾çåè¡¨æ¼æ¥æå­ç¬¦ä¸²
            "è§é¢å°å": videoUrl,
            "è§é¢ææ¡": data.get("content", "") 
        }
    }
    records.append(record)  # å°è®°å½å¯¹è±¡æ·»å å° records åè¡¨ä¸­

    # æå»ºè¾åºå¯¹è±¡
    ret: Output = {
        "records": records
    }
    return ret
</code></pre>
<p><strong>7ãå¾ªç¯ä½åæä»¶èç¹ï¼åå¥é£ä¹¦è¡¨æ ¼</strong></p>
<p>æåï¼æä»¬å°æ¶éå°çæææ°æ®æ·»å å°é£ä¹¦å¤ç»´è¡¨æ ¼ä¸­ã</p>
<p>æä»¬éè¦æååå»ºä¸ä¸ªå¤ç»´è¡¨æ ¼ï¼å¹¶è®¾ç½®å¥½å¯¹åºçè¡¨å¤´å­æ®µã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952577-2043730972.jpg" class="lazyload"></p>
<p>è¡¨å¤´å­æ®µåæ¬è§é¢çææå³é®ä¿¡æ¯ï¼ç¬è®°é¾æ¥ãæ é¢ãåå®¹ãä½èãç¹èµæ°ãé¾æ¥ãæ¶èæ°ãå¾çå°åãè§é¢å°ååè§é¢ææ¡ã</p>
<p>æ¥ä¸æ¥ï¼éæ©"é£ä¹¦è¡¨æ ¼"æä»¶èç¹çadd_recordså·¥å·ï¼å°ééå°çæ°æ®æ·»å å°å¤ç»´è¡¨æ ¼ä¸­ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952610-1898602827.jpg" class="lazyload"></p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>app_tokenï¼æååå»ºä¸ä¸ªå¤ç»´è¡¨æ ¼ï¼ç¶åå°å¤ç»´è¡¨æ ¼çé¾æ¥å¤å¶å°æ­¤å¤ã</li>
<li>recordsï¼ä»"å°ä¿¡æ¯æ´çä¸ºé£ä¹¦è¡¨æ ¼å¯ä»¥ä½¿ç¨çæ°æ®"èç¹çè¾åºåéä¸­ï¼éæ©recordsã</li>
<li>table_idï¼éå¡«å¥å¤ç»´è¡¨æ ¼æ°æ®è¡¨çå¯ä¸æ è¯ç¬¦ã</li>
</ul>
</li>
</ul>
<p><strong>8ãç»æèç¹</strong></p>
<p>æåæ·»å ç»æèç¹ï¼å®ææ´ä¸ªå·¥ä½æµç¨ãå¦å¾6-25æç¤ºã</p>
<ul>
<li>è¾åºï¼
<ul>
<li>outputï¼å¼å§èç¹çfoldUrlï¼ä¹å°±æ¯é£ä¹¦å¤ç»´è¡¨æ ¼çé¾æ¥</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952836-1066782058.jpg" class="lazyload"></p>
<h3 id="6å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½è®¾ç½®">6.å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½è®¾ç½®</h3>
<p>è³æ­¤ï¼æä»¬å·²å®æå°çº¢ä¹¦ç­ç¹çæ§å·¥ä½æµçæ­å»ºãæ¥ä¸æ¥ï¼æä»¬å°ä»ç»å¦ä½è®¾ç½®å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½ãè¿ä¸ªå³é®ç¯èå°å·¥ä½æµä¸æºè½ä½ç»å®å¨ä¸èµ·ï¼åªæå®æè¿ä¸æ­¥ï¼æè½çæ­£å®ç°å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½çåè½ã</p>
<p><strong>1ãæ°å»ºæºè½ä½</strong></p>
<p>å¨Cozeå¹³å°åå»ºä¸ä¸ªæ°çæºè½ä½ï¼å½åâå°çº¢ä¹¦ç­ç¹çæ§æºè½ä½âãå¦å¾6-26æç¤ºã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952825-1616741015.jpg" class="lazyload"></p>
<p><strong>2ãè®¾ç½®äººè®¾ä¸é»è¾</strong></p>
<p>è®¾ç½®äººè®¾ä¸é»è¾æ¯åå»ºæºè½ä½çå³é®æ­¥éª¤ãå¨è¿ä¸ç¯èï¼æä»¬éè¦æç¡®æºè½ä½çè¡ä¸ºæ¨¡å¼åååºæ¹å¼ã</p>
<p>å¯¹äºå°çº¢ä¹¦ç­ç¹çæ§æºè½ä½ï¼æä»¬å¸æå®è½ç´æ¥æ§è¡ä»»å¡ï¼æ éè¿å¤äº¤äºãå æ­¤ï¼æä»¬è®¾ç½®ç®åæäºçæä»¤ï¼è®©æºè½ä½å¨æ¥æ¶å°å³é®è¯åç«å³æ§è¡è§é¢ééå·¥ä½ã</p>
<pre><code>ç´æ¥æ§è¡`xhs_keywords`
</code></pre>
<p><strong>3ãç»å®å·¥ä½æµ</strong></p>
<p>æ"xhs_keywords"å·¥ä½æµæ·»å å°æºè½ä½ä¸­ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952663-2052627237.jpg" class="lazyload"></p>
<p><strong>4ãæµè¯å¹¶åå¸</strong></p>
<p>å¨é¢è§ä¸è°è¯çªå£ä¸­è¾å¥å³é®è¯ï¼æµè¯æºè½ä½çå°çº¢ä¹¦ç­ç¹è§é¢ééåè½ãç³»ç»ä¼èªå¨æ§è¡å·¥ä½æµï¼å¹¶å°ç»æç´æ¥æ·»å å°é£ä¹¦è¡¨æ ¼ä¸­ã</p>
<blockquote>
<p>å¯¹äºï¼ææ´çäºä¸ä»½å¼æºçæºè½ä½å­¦ä¹ æåï¼çè 10 ä¸å­ï¼ä»·å¼ 999 åãéæ¶å¼æ¾é¢åðï¼<a href="https://tangshiye.cn" target="_blank" rel="noopener nofollow">tangshiye.cn</a></p>
</blockquote>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/tangshiye/" target="_blank">AIæ¶æå¸æ±¤å¸ç·</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/tangshiye/p/19575161" target="_blank">https://www.cnblogs.com/tangshiye/p/19575161</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 16:30">2026-02-04 16:30</span>&nbsp;
<a href="https://www.cnblogs.com/tangshiye">AIæ¶æå¸æ±¤å¸ç·</a>&nbsp;
éè¯»(<span id="post_view_count">142</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19575161);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19575161', targetLink: 'https://www.cnblogs.com/tangshiye/p/19575161', title: 'æ£å­Cozeå®æï¼ä»0å°1æé æé³+å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>