<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-04T08:35:40.410Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ .NET ä¸­å¦ä½å¿«éå®ç° List éåå»éï¼ ]]></title>
    <link>https://www.cnblogs.com/1312mn/p/18552496</link>
    <guid>dda50bdd3d99a0ed2bf3f42553742279</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/1312mn/p/18552496" title="åå¸äº 2026-02-04 16:34">
    <span role="heading" aria-level="2">.NET ä¸­å¦ä½å¿«éå®ç° List éåå»éï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h2 class="md-end-block md-heading"><span class="md-plain md-expand" style="font-size: 16px">åè¨</span></h2>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">å¨æ°æ®å¤çä¸­ï¼å»é¤éåä¸­çéå¤åç´ æ¯ä¸ä¸ªå¸¸è§çéæ±ã.NET 6 å .NET 7 å¼å¥äº <span class="md-pair-s"><code>DistinctBy</code><span class="md-plain"> æ¹æ³ï¼è¿æ¯ä¸ä¸ªéå¸¸å®ç¨çæ°ç¹æ§ï¼å¯ä»¥æ¹ä¾¿å°æ ¹æ®æå®çé®å¯¹éåè¿è¡å»éã</span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">æ¬æå°è¯¦ç»ä»ç» <span class="md-pair-s"><code>DistinctBy</code><span class="md-plain"> æ¹æ³çä½¿ç¨ï¼å¹¶éè¿å·ä½çæ¡ä¾æ¥å±ç¤ºå¶å¨å®éå¼åä¸­çåºç¨ã</span></span></span></p>
<h2 class="md-end-block md-heading"><span class="md-plain" style="font-size: 16px">æ­£æ</span></h2>
<h3><strong>1ã<code>DistinctBy</code> æ¹æ³</strong></h3>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><code>DistinctBy</code><span class="md-plain"> æ¹æ³åè®¸æä»¬å¨ LINQ æ¥è¯¢ä¸­æ ¹æ®æä¸ªé®å¯¹éåä¸­çåç´ è¿è¡å»éã</span></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">è¿ä¸ªæ¹æ³è¿åä¸ä¸ªæ°çéåï¼å¶ä¸­åªåå«æ ¹æ®æå®é®å¯ä¸ç¡®å®çåç´ ã</span></p>
<p class="md-end-block md-p"><span class="md-pair-s md-expand" style="font-size: 16px"><strong>æ¹æ³ç­¾å</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span> IEnumerable&lt;TSource&gt; DistinctBy&lt;TSource, TKey&gt;<span style="color: rgba(0, 0, 0, 1)">(
    </span><span style="color: rgba(0, 0, 255, 1)">this</span> IEnumerable&lt;TSource&gt;<span style="color: rgba(0, 0, 0, 1)"> source,
    Func</span>&lt;TSource, TKey&gt;<span style="color: rgba(0, 0, 0, 1)"> keySelector
);</span></pre>
</div>
<h3 class="md-end-block md-heading"><strong><span class="md-plain" style="font-size: 16px">2ãåºæ¬ç¨æ³</span></strong></h3>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">æç®åçç¨æ³æ¯å¨ LINQ æ¥è¯¢ä¸­ç´æ¥è°ç¨ <span class="md-pair-s"><code>DistinctBy</code><span class="md-plain"> æ¹æ³ï¼ç¶åå¤çå»éåçéåã</span></span></span></p>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><strong>è¯´æ</strong></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">åè®¾æä»¬æä¸ä¸ªç¨æ·åè¡¨ï¼æä»¬æ³è¦æ ¹æ®ç¨æ·åå»é¤éå¤çç¨æ·ã</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">using</span><span style="color: rgba(0, 0, 0, 1)"> System.Linq;
â
</span><span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> User
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Name { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> Age { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
}
â
</span><span style="color: rgba(0, 0, 255, 1)">var</span> users = <span style="color: rgba(0, 0, 255, 1)">new</span> List&lt;User&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> User { Name = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Alice</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Age = <span style="color: rgba(128, 0, 128, 1)">25</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> User { Name = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Bob</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Age = <span style="color: rgba(128, 0, 128, 1)">32</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> User { Name = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Alice</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Age = <span style="color: rgba(128, 0, 128, 1)">28</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> User { Name = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">David</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Age = <span style="color: rgba(128, 0, 128, 1)">35</span><span style="color: rgba(0, 0, 0, 1)"> }
};
â
</span><span style="color: rgba(0, 0, 255, 1)">var</span> distinctUsers = users.DistinctBy(user =&gt;<span style="color: rgba(0, 0, 0, 1)"> user.Name);
â
</span><span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> user <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> distinctUsers)
{
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Name: {user.Name}, Age: {user.Age}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
}</span></pre>
</div>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">è¾åºç»æï¼</span></p>
<div class="cnblogs_code">
<pre>Name: Alice, Age: <span style="color: rgba(128, 0, 128, 1)">25</span><span style="color: rgba(0, 0, 0, 1)">
Name: Bob, Age: </span><span style="color: rgba(128, 0, 128, 1)">32</span><span style="color: rgba(0, 0, 0, 1)">
Name: David, Age: </span><span style="color: rgba(128, 0, 128, 1)">35</span></pre>
</div>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">è¿æ»¤åååç´ è¿æ¯ä¿æåæçé¡ºåºï¼æä»¬å¯ä»¥æ¥çæºç ã</span></p>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><strong>æºç </strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">static</span> IEnumerable&lt;TSource&gt; DistinctByIterator&lt;TSource, TKey&gt;(IEnumerable&lt;TSource&gt; source, Func&lt;TSource, TKey&gt; keySelector, IEqualityComparer&lt;TKey&gt;?<span style="color: rgba(0, 0, 0, 1)"> comparer)
{
    </span><span style="color: rgba(0, 0, 255, 1)">using</span> IEnumerator&lt;TSource&gt; enumerator =<span style="color: rgba(0, 0, 0, 1)"> source.GetEnumerator();
â
    </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> (enumerator.MoveNext())
    {
        </span><span style="color: rgba(0, 0, 255, 1)">var</span> <span style="color: rgba(0, 0, 255, 1)">set</span> = <span style="color: rgba(0, 0, 255, 1)">new</span> HashSet&lt;TKey&gt;<span style="color: rgba(0, 0, 0, 1)">(DefaultInternalSetCapacity, comparer);
        </span><span style="color: rgba(0, 0, 255, 1)">do</span><span style="color: rgba(0, 0, 0, 1)">
        {
            TSource element </span>=<span style="color: rgba(0, 0, 0, 1)"> enumerator.Current;
            </span><span style="color: rgba(0, 0, 255, 1)">if</span> (<span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">.Add(keySelector(element)))
            {
                </span><span style="color: rgba(0, 0, 255, 1)">yield</span> <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> element;
            }
        }
        </span><span style="color: rgba(0, 0, 255, 1)">while</span><span style="color: rgba(0, 0, 0, 1)"> (enumerator.MoveNext());
    }
}</span></pre>
</div>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">éè¿æ¥çæºç ï¼å¯ä»¥çå°æ¯å©ç¨äº <span class="md-pair-s"><code>HashSet</code><span class="md-plain"> å»éï¼åç´ é¡ºåºå¹¶æªè¢«æä¹±ã</span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">å¨å¤çéåæ¶ï¼æä»¬ç»å¸¸éè¦å»é¤éå¤çåç´ ï¼åæ¶ä¿æåæçé¡ºåºã</span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">ä½¿ç¨ <span class="md-pair-s"><code>HashSet</code><span class="md-plain"> å¯ä»¥é«æå°å®ç°è¿ä¸ç®æ ã</span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">é¦åå°æå®çé®å°è¯æ·»å å° <span class="md-pair-s"><code>HashSet</code><span class="md-plain"> ä¸­ï¼å¦ææ·»å æåï¼è¯´æè¯¥é®æ²¡æéå¤ï¼</span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">å¦ææ·»å å¤±è´¥ï¼è¯´æå·²ç»å­å¨ç¸åçé®ï¼æ­¤åç´ å°è¢«è¿æ»¤æã</span></p>
<h3 class="md-end-block md-heading"><strong><span class="md-plain" style="font-size: 16px">3ãå¤æç¨æ³</span></strong></h3>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><code>DistinctBy</code><span class="md-plain"> æ¹æ³å¯ä»¥ç¨äºæ´å¤æçå»éé»è¾ï¼ä¾å¦æ ¹æ®å¤ä¸ªå±æ§è¿è¡å»éã</span></span></p>
<p class="md-end-block md-p"><span class="md-pair-s " style="font-size: 16px"><strong>è¯´æ</strong></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">åè®¾æä»¬æä¸ä¸ªè®¢ååè¡¨ï¼æä»¬æ³è¦æ ¹æ®å®¢æ·åç§°åè®¢åéé¢å»é¤éå¤çè®¢åã</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> Order
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> OrderId { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> CustomerName { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">decimal</span> Amount { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
}
â
</span><span style="color: rgba(0, 0, 255, 1)">var</span> orders = <span style="color: rgba(0, 0, 255, 1)">new</span> List&lt;Order&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> Order { OrderId = <span style="color: rgba(128, 0, 128, 1)">1</span>, CustomerName = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Alice</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Amount = <span style="color: rgba(128, 0, 128, 1)">100.0m</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> Order { OrderId = <span style="color: rgba(128, 0, 128, 1)">2</span>, CustomerName = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Bob</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Amount = <span style="color: rgba(128, 0, 128, 1)">150.0m</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> Order { OrderId = <span style="color: rgba(128, 0, 128, 1)">3</span>, CustomerName = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Alice</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Amount = <span style="color: rgba(128, 0, 128, 1)">100.0m</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> Order { OrderId = <span style="color: rgba(128, 0, 128, 1)">4</span>, CustomerName = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Charlie</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Amount = <span style="color: rgba(128, 0, 128, 1)">120.0m</span><span style="color: rgba(0, 0, 0, 1)"> },
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> Order { OrderId = <span style="color: rgba(128, 0, 128, 1)">5</span>, CustomerName = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Bob</span><span style="color: rgba(128, 0, 0, 1)">"</span>, Amount = <span style="color: rgba(128, 0, 128, 1)">150.0m</span><span style="color: rgba(0, 0, 0, 1)"> }
};
â
</span><span style="color: rgba(0, 0, 255, 1)">var</span> distinctOrders = orders.DistinctBy(order =&gt;<span style="color: rgba(0, 0, 0, 1)"> (order.CustomerName, order.Amount));
â
</span><span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> order <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> distinctOrders)
{
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Order ID: {order.OrderId}, Customer: {order.CustomerName}, Amount: {order.Amount}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
}</span></pre>
</div>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">è¾åºç»æï¼</span></p>
<div class="cnblogs_code">
<pre>Order ID: <span style="color: rgba(128, 0, 128, 1)">1</span>, Customer: Alice, Amount: <span style="color: rgba(128, 0, 128, 1)">100.0</span><span style="color: rgba(0, 0, 0, 1)">
Order ID: </span><span style="color: rgba(128, 0, 128, 1)">2</span>, Customer: Bob, Amount: <span style="color: rgba(128, 0, 128, 1)">150.0</span><span style="color: rgba(0, 0, 0, 1)">
Order ID: </span><span style="color: rgba(128, 0, 128, 1)">4</span>, Customer: Charlie, Amount: <span style="color: rgba(128, 0, 128, 1)">120.0</span></pre>
</div>
<h3 class="md-end-block md-heading"><strong><span class="md-plain" style="font-size: 16px">4ãæ§è½èè</span></strong></h3>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><code>DistinctBy</code><span class="md-plain"> æ¹æ³å¨åé¨ä½¿ç¨åå¸è¡¨æ¥è·è¸ªå·²ç»åºç°çé®ï¼å æ­¤å¨å¤§å¤æ°æåµä¸æ§è½éå¸¸å¥½ãä½å¨å¤çéå¸¸å¤§çæ°æ®éæ¶ï¼ä»ç¶éè¦æ³¨æåå­ä½¿ç¨æåµã</span></span></p>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><strong>è¯´æ</strong></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">åè®¾æä»¬æä¸ä¸ªåå«æ°ç¾ä¸æ¡è®°å½çå¤§éåï¼æä»¬éè¦æ ¹æ®æä¸ªé®è¿è¡å»éã</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> largeCollection = Enumerable.Range(<span style="color: rgba(128, 0, 128, 1)">1</span>, <span style="color: rgba(128, 0, 128, 1)">10000000</span>).Select(i =&gt; <span style="color: rgba(0, 0, 255, 1)">new</span> { Id = i, Value = i % <span style="color: rgba(128, 0, 128, 1)">1000</span><span style="color: rgba(0, 0, 0, 1)"> });
</span><span style="color: rgba(0, 0, 255, 1)">var</span> distinctLargeCollection = largeCollection.DistinctBy(item =&gt;<span style="color: rgba(0, 0, 0, 1)"> item.Value);
Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Distinct count: {distinctLargeCollection.Count()}</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<h3 class="md-end-block md-heading"><strong><span class="md-plain" style="font-size: 16px">5ãå¼æ­¥ LINQ æ¥è¯¢ä¸­çä½¿ç¨</span></strong></h3>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><code>DistinctBy</code><span class="md-plain"> æ¹æ³ä¹å¯ä»¥å¨å¼æ­¥ LINQ æ¥è¯¢ä¸­ä½¿ç¨ï¼ç»å <span class="md-pair-s"><code>IAsyncEnumerable&lt;T&gt;</code><span class="md-plain"> ç±»åï¼å¤çå¤§éæ°æ®æ¶æ´å é«æã</span></span></span></span></p>
<p class="md-end-block md-p"><span class="md-pair-s " style="font-size: 16px"><strong>è¯´æ</strong></span></p>
<p class="md-end-block md-p"><span class="md-plain" style="font-size: 16px">åè®¾æä»¬æä¸ä¸ªå¼æ­¥æ¹æ³è¿åä¸ä¸ªç¨æ·åè¡¨ï¼æä»¬æ³è¦æ ¹æ®ç¨æ·åå»é¤éå¤çç¨æ·ã</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">using</span><span style="color: rgba(0, 0, 0, 1)"> System.Net.Http.Json;
â
</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">async</span> IAsyncEnumerable&lt;User&gt;<span style="color: rgba(0, 0, 0, 1)"> GetUsersAsync()
{
    </span><span style="color: rgba(0, 0, 255, 1)">var</span> response = <span style="color: rgba(0, 0, 255, 1)">await</span> httpClient.GetAsync(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">https://api.example.com/users</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">var</span> usersJson = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> response.Content.ReadAsStringAsync();
    
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä½¿ç¨Jsonåºååå·¥å·è§£æç¨æ·åè¡¨</span>
    <span style="color: rgba(0, 0, 255, 1)">var</span> users = JsonSerializer.Deserialize&lt;List&lt;User&gt;&gt;<span style="color: rgba(0, 0, 0, 1)">(usersJson);
    
    </span><span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> user <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> users)
    {
        </span><span style="color: rgba(0, 0, 255, 1)">yield</span> <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> user;
    }
}
â
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä½¿ç¨å¼æ­¥LINQæ¥è¯¢</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> distinctUsers = <span style="color: rgba(0, 0, 255, 1)">await</span> GetUsersAsync().DistinctByAsync(user =&gt;<span style="color: rgba(0, 0, 0, 1)"> user.Name).ToListAsync();
â
</span><span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> user <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> distinctUsers)
{
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Name: {user.Name}, Age: {user.Age}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
}</span></pre>
</div>
<h2 class="md-end-block md-heading"><span class="md-plain" style="font-size: 16px">æ»ç»</span></h2>
<p class="md-end-block md-p"><span class="md-pair-s" style="font-size: 16px"><code>DistinctBy</code><span class="md-plain"> æ¹æ³æ¯ .NET 6 å .NET 7 ä¸­ LINQ çä¸ä¸ªéå¸¸å®ç¨çæ°ç¹æ§ãæä»¬å¨ LINQ æ¥è¯¢ä¸­æ ¹æ®æå®çé®å¯¹éåè¿è¡å»éï¼ç®åäºä»£ç å¹¶æé«äºå¼åæçã</span></span></p>
<p class="md-end-block md-p md-focus"><span class="md-plain" style="font-size: 16px">å¸ææ¬æè½å¸®å©å¤§å®¶æ´å¥½å°çè§£åå©ç¨ .NET 6 å .NET 7 ä¸­ LINQ ç <span class="md-pair-s"><code>DistinctBy</code><span class="md-plain md-expand"> æ¹æ³ï¼ä»èå¨é¡¹ç®ä¸­åæ¥æ´å¤§çä½ç¨ã</span></span></span></p>
<h2 class="md-end-block md-heading"><span class="md-plain" style="font-size: 16px">æå</span></h2>
<p><span class="md-plain" style="font-size: 16px"><span class="md-plain md-expand">å¦æä½ è§å¾è¿ç¯æç« å¯¹ä½ æå¸®å©ï¼ä¸å¦¨ç¹ä¸ªèµæ¯æä¸ä¸ï¼ä½ çæ¯ææ¯æç»§ç»­åäº«ç¥è¯çå¨åãå¦ææä»»ä½çé®æéè¦è¿ä¸æ­¥çå¸®å©ï¼æ¬¢è¿éæ¶çè¨ãä¹å¯ä»¥å å¥å¾®ä¿¡å¬ä¼å·&nbsp;<span class="md-pair-s "><strong>[DotNetææ¯å ]</strong><span class="md-plain md-expand">&nbsp;ç¤¾åºï¼ä¸å¶ä»ç­ç±ææ¯çåè¡ä¸èµ·äº¤æµå¿å¾ï¼å±åæé¿ï¼</span></span></span></span></p>
<p><span class="md-plain" style="font-size: 16px"><img src="https://img2024.cnblogs.com/blog/576536/202408/576536-20240813102419584-1596250541.png" alt="" style="display: block; margin-left: auto; margin-right: auto"></span></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 16:34">2026-02-04 16:34</span>&nbsp;
<a href="https://www.cnblogs.com/1312mn">å°ç ç¼å </a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(18552496);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '18552496', targetLink: 'https://www.cnblogs.com/1312mn/p/18552496', title: '.NET ä¸­å¦ä½å¿«éå®ç° List éåå»éï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ£å­Cozeå®æï¼ä»0å°1æé æé³+å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½ ]]></title>
    <link>https://www.cnblogs.com/tangshiye/p/19575161</link>
    <guid>cc3ab3b5296045017cfe14ef1b67ca14</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/tangshiye/p/19575161" title="åå¸äº 2026-02-04 16:30">
    <span role="heading" aria-level="2">æ£å­Cozeå®æï¼ä»0å°1æé æé³+å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¤§å®¶å¥½ï¼ææ¯æ±¤å¸ç·ï¼ä¸æ³¨AIæºè½ä½åäº«ï¼è´åäºå¸®å©100Wäººç¨æºè½ä½åå¯~</p>
<p>ç­ç¹çæ§æºè½ä½æ¯å¸®ä½ èªå¨åç°çæ¬¾éé¢çå©å¨ã</p>
<p>å®è½å¨å¤©åæ«æåå¤§å¹³å°çç­é¨åå®¹ï¼ä»æµ·éä¿¡æ¯ä¸­ç­éåºææä»·å¼çè¯é¢ååæã</p>
<p>ä½ ä¸éè¦åæå¨æç´¢ï¼æºè½ä½ä¼èªå¨å°ç­ç¹åå®¹æ´çæè¡¨æ ¼ï¼è®©ä½ æ¸æ°ç´è§å°ææ¡è¡ä¸å¨æã</p>
<h3 id="1-ä¸ºä»ä¹è¦åç­ç¹çæ§">1 ä¸ºä»ä¹è¦åç­ç¹çæ§</h3>
<p>ç­ç¹çæ§æ¯åå®¹åä½èåè¥éäººåçå¿å¤å·¥å·ï¼å®å¸®å©æä»¬å¨ä¿¡æ¯çç¸æ¶ä»£ç²¾åææ¡ç¨æ·å³æ³¨ç¹ï¼æååå®¹ææåå½±ååãä»¥ä¸æ¯è¿è¡ç­ç¹çæ§çåå¤§æ ¸å¿çç±ï¼</p>
<p><strong>1. ææ¡ç¨æ·å´è¶£ï¼æé«åå®¹ç¸å³æ§</strong></p>
<p>ç¨æ·çæ³¨æåæ¯ç¨ç¼ºèµæºãéè¿å®æ¶çæ§ç­ç¹è¯é¢ï¼æä»¬è½äºè§£ç®æ åä¼å½ä¸æå³å¿çé®é¢åå´è¶£ç¹ãç­ç¹æ¬è´¨ä¸æ¯ç¨æ·å´è¶£çéä¸­ä½ç°ï¼åºäºç­ç¹åä½çåå®¹èªç¶å·ææ´é«çç¨æ·å¹éåº¦ï¼æ´å®¹æè·å¾å³æ³¨åäºå¨ã</p>
<p><strong>2. èçº¦éé¢æ¶é´ï¼æé«åä½æç</strong></p>
<p>æ²¡æç­ç¹çæ§ç³»ç»æ¶ï¼åä½èéè¦å¨åå¹³å°é´ä¸æ­åæ¢ï¼æå¨æç´¢åç­éä¿¡æ¯ï¼è¿ä¸ªè¿ç¨æ¢èæ¶åä½æãèªå¨åç­ç¹çæ§è½æç»­è¿½è¸ªå¤å¹³å°ç­é¨åå®¹ï¼å°éå¤æ§å·¥ä½äº¤ç»æºè½ä½ï¼è®©åä½èè½ä¸æ³¨äºåå®¹åä½æ¬èº«ã</p>
<p><strong>3. æä½æ¶æºï¼æé«æåæºä¼</strong></p>
<p>ç­ç¹å·æææ¾çæ¶ææ§ï¼è¶æ©åä¸è®¨è®ºï¼è·å¾çæåæºä¼å°±è¶å¤ãèªå¨åç­ç¹çæ§ç³»ç»è½å¨ç­ç¹ååºç°æ¶å°±ååºæéï¼å¸®å©åä½èæ¢å åæºãæ¯èµ·ç­ç­ç¹å®å¨çåååè·è¿ï¼æåå¸å±è½è·å¾æ´å¤æµéçº¢å©åå¹³å°ç®æ³éçã</p>
<p><strong>4. åç°åå®¹æºä¼ï¼é¿ååè´¨å</strong></p>
<p>ç­ç¹çæ§ä¸åªæ¯è¿½è¸ªå·²ç»çåçè¯é¢ï¼æ´éè¦çæ¯åç°æ½å¨æ°å´ç­ç¹ãéè¿åæç­ç¹æ°æ®ï¼åä½èå¯ä»¥è¯å«å°æªè¢«ååææçåå®¹æºä¼ï¼é¿å¼åè´¨åç«äºï¼æ¾å°å·®å¼åè¡¨è¾¾è§åº¦ï¼ä»èå¨æ¿ççåå®¹ç«äºä¸­è±é¢èåºã</p>
<h3 id="2-ç­ç¹çæ§æºè½ä½æ­å»ºæµç¨">2 ç­ç¹çæ§æºè½ä½æ­å»ºæµç¨</h3>
<p>æºè½ä½çæ­å»ºæµç¨ä¸»è¦åä¸ºä¸¤ä¸ªæ­¥éª¤ï¼æ¢³çå·¥ä½æµåè®¾ç½®æºè½ä½ã</p>
<p><strong>1ãæ¢³çå·¥ä½æµ</strong></p>
<p>ç­ç¹çæ§å·¥ä½æµæ¯ä¸å¥èªå¨åä¿¡æ¯ééåå¤çç³»ç»ï¼è½å°äººå·¥éè¦å å°æ¶çè³å å¤©å®æçå·¥ä½åç¼©è³å åéåèªå¨å®æãè¿ä¸å·¥ä½æµä¸»è¦åå«ä¸å¤§ç¯èï¼</p>
<p><strong>ï¼1ï¼æ ¹æ®å³é®è¯ï¼æ¹éè·åç­é¨è§é¢</strong></p>
<p>ç³»ç»æ ¹æ®é¢è®¾çå³é®è¯ï¼å¦è¡ä¸ç­è¯ãäº§ååç§°ãç«åä¿¡æ¯ç­ï¼ï¼èªå¨ä»æé³ãå°çº¢ä¹¦ç­å¹³å°æç´¢ç¸å³è§é¢ãè¿ä¸æ­¥éª¤æ¿ä»£äºæå¨æç´¢åæµè§ç»æçè¿ç¨ï¼å¤§å¹æé«æçã</p>
<p><strong>ï¼2ï¼æ¹éè·åè§é¢è¯¦ç»ä¿¡æ¯</strong></p>
<p>è·åè§é¢åè¡¨åï¼ç³»ç»è¿ä¸æ­¥æåæ¯ä¸ªè§é¢çè¯¦ç»æ°æ®ï¼åæ¬ï¼</p>
<ul>
<li>åºç¡ä¿¡æ¯ï¼è§é¢IDãæ é¢ãé¾æ¥ãåå¸æ¶é´ãè§é¢æ¶é¿ç­</li>
<li>äºå¨æ°æ®ï¼ç¹èµæ°ãè¯è®ºæ°ãæ¶èæ°ãåäº«æ°ç­å³é®ææ </li>
<li>åä½èä¿¡æ¯ï¼ä½èåç§°ãç¨æ·IDãä¸ªäººç®ä»ç­</li>
</ul>
<p>è¿äºæ°æ®æ¯åæè§é¢ç­åº¦ååæ¬¢è¿ç¨åº¦çå³é®ææ ï¼ä¹æ¯å¤æ­åå®¹ä»·å¼çéè¦ä¾æ®ãç³»ç»å°è¿äºé¶æ£æ°æ®æ´åæç»æåä¿¡æ¯ï¼ä¾¿äºåç»­åæã</p>
<p><strong>ï¼3ï¼å°æ°æ®æ·»å å°å¤ç»´è¡¨æ ¼</strong></p>
<p>æåï¼ç³»ç»å°å¤çå¥½çæ°æ®èªå¨å¯¼å¥å°é¢è®¾çé£ä¹¦å¤ç»´è¡¨æ ¼ä¸­ã</p>
<p>éè¿è¿æ ·çèªå¨åå¤çï¼æä»¬è½å»ºç«ä¸ä¸ªå®æ¶æ´æ°çç­ç¹åå®¹åºï¼éæ¶æ¥çè¡ä¸å¨æï¼åç°çæ¬¾éé¢çµæã</p>
<p>è¿ç§å·¥ä½æµæ¾èåè½»äºè¿è¥äººåçå·¥ä½è´æï¼è®©æä»¬è½å°æ´å¤ç²¾åæå¥å°åå®¹åä½åç­ç¥å¶å®ä¸ã</p>
<p><strong>2ãè®¾ç½®æºè½ä½</strong></p>
<p>å®æå·¥ä½æµæ­å»ºåï¼æä»¬éè¦åå»ºä¸ä¸ªç­ç¹çæ§æºè½ä½æ¥æ§è¡è¿ä¸ªå·¥ä½æµãæºè½ä½è®¾ç½®è¿ç¨åä¸ºä¸ä¸ªå³é®æ­¥éª¤ï¼</p>
<ol>
<li>è®¾ç½®äººè®¾ä¸é»è¾ï¼éç½®æºè½ä½çç¹å¾ãåå¤é£æ ¼åå³ç­é»è¾</li>
<li>ç»å®å·¥ä½æµï¼å°å·¥ä½æµä¸æºè½ä½å³èï¼èµäºå®æ§è¡å·ä½ä»»å¡çè½å</li>
<li>æµè¯å¹¶åå¸ï¼è¿è¡å¨é¢åè½æµè¯ï¼ç¡®è®¤ä¸åæ­£å¸¸åå°æºè½ä½æ­£å¼åå¸å°çäº§ç¯å¢</li>
</ol>
<p>å®æè¿ä¸ä¸ªæ­¥éª¤åï¼æä»¬å°±æåæ­å»ºäºä¸ä¸ªç­ç¹çæ§æºè½ä½ã</p>
<h3 id="3-æé³ç­ç¹çæ§å·¥ä½æµ">3 æé³ç­ç¹çæ§å·¥ä½æµ</h3>
<p>åé¢æä»¬è¯¦ç»ä»ç»äºç­ç¹çæ§çéè¦æ§åæºè½ä½æ­å»ºçåºæ¬æµç¨ï¼æ¥ä¸æ¥æä»¬å°æ·±å¥äºè§£å¦ä½å®éæ­å»ºä¸ä¸ªæé³ç­ç¹çæ§å·¥ä½æµã</p>
<p>ç»å½Cozeå®ç½ï¼å¨âèµæºåº-å·¥ä½æµâéæ°å»ºä¸ä¸ªç©ºç½å·¥ä½æµï¼ååâfetch_douyin_hot_videosâã</p>
<p>å·¥ä½æµæ´ä½é¢è§å¦å¾æç¤ºã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952712-14727349.jpg" class="lazyload"></p>
<p><strong>1ãå¼å§èç¹</strong></p>
<p>è¿éç¨äºå®ä¹å·¥ä½æµå¯å¨æ¶æéçè¾å¥åæ°ãå¦å¾6-2æç¤ºã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>keywordsï¼ç¨äºæç´¢ç­ç¹çå³é®è¯ï¼å¯ä»¥æ¯äº§ååç§°ãè¡ä¸æ¯è¯­ãç«ååç§°æç­é¨è¯é¢ï¼ç³»ç»ä¼èªå¨æç´¢ç¸å³çç­é¨åå®¹</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952628-740163231.jpg" class="lazyload"></p>
<p><strong>2ãæä»¶èç¹ï¼æ ¹æ®å³é®è¯ï¼æ¹éè·åç­é¨è§é¢</strong></p>
<p>æä»¬å°ä½¿ç¨"è§é¢æç´¢"æä»¶ç"douyin_search"å·¥å·ãéè¿è¿ä¸ªåè½ï¼æä»¬å¯ä»¥æ ¹æ®å³é®è¯æ¹éè·åç­é¨è§é¢ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>api_tokenï¼è¿ééè¦å¡«å¥ä½ çAPIå¯é¥ï¼å¯ä»¥ä»æä»¶çå®æ¹å¹³å°è·åï¼å®æ¯è°ç¨è§é¢æ°æ®çéè¦å­è¯ï¼ç¸å½äºä½ çèº«ä»½è¯æ</li>
<li>keywordï¼å³é®è¯ï¼ä»å¼å§èç¹è·å</li>
<li>pageï¼è·åç¬¬å é¡µçåå®¹</li>
<li>publish_timeï¼åå¸æ¶é´ï¼å¯ç¨å¼ä¸º_0(ä¸é)ã_1(ä¸å¤©ä¹å)ã_7(ä¸å¨ä¹å)ã_180(åå¹´ä¹å)ï¼è¿éæä»¬éæ©_7</li>
<li>sort_typeï¼æåºç±»åï¼å¯ç¨å¼ï¼_0(ç»¼å)ã_1(æå¤ç¹èµ)ã_2(ææ°åå¸)ï¼è¿éæä»¬éæ©_1</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952527-440199834.jpg" class="lazyload"></p>
<p><strong>4ãæ¹å¤çèç¹ï¼æ¹éè·åè§é¢è¯¦ç»ä¿¡æ¯</strong></p>
<p>æ¹éè·åè§é¢è¯¦ç»ä¿¡æ¯æ¯å·¥ä½æµä¸­çæ ¸å¿èç¹ï¼å®è´è´£å°ä¸ä¸æ­¥éª¤ä¸­è·åçè§é¢åè¡¨è¿ä¸æ­¥æ·±å¥å¤çï¼è·åæ¯ä¸ªè§é¢çå®æ´ä¿¡æ¯ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>å¹¶è¡è¿è¡æ°éï¼è®¾ç½®éå½çå¹¶è¡æ°éå¯æé«å·¥ä½æµæ§è¡æçï¼è®¾ç½®ä¸º1åæé¡ºåºä¸²è¡æ§è¡</li>
<li>æ¹å¤çæ¬¡æ°ä¸éï¼æ¹å¤çæä½ä¸ä¼è¶è¿è¿ä¸ªè®¾å®çæå¤§æ¬¡æ°</li>
<li>aweme_listï¼ä»"æ ¹æ®å³é®è¯ï¼æ¹éè·åç­é¨è§é¢"èç¹è¾åºä¸­ï¼éæ©dataï¼ç±»åä¸ºArray</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952486-1327396496.jpg" class="lazyload"></p>
<p><strong>5ãæ¹å¤çä½åæä»¶èç¹ï¼è·ååä¸ªè§é¢è¯¦ç»ä¿¡æ¯</strong></p>
<p>æ¥ä¸æ¥ï¼æä»¬éè¦æ·»å æ¹å¤çä½åçèç¹ãæä»¬å°ä½¿ç¨"è§é¢æç´¢"æä»¶çdouyin_dataå·¥å·ï¼éè¿è¿ä¸ªåè½å¯ä»¥æ ¹æ®æé³è§é¢é¾æ¥è·åè§é¢çè¯¦ç»ä¿¡æ¯ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>api_tokenï¼APIå¯é¥</li>
<li>douyin_urlï¼ä»"æ¹éè·åè§é¢è¯¦ç»ä¿¡æ¯"èç¹çè¾åºä¸­ï¼éæ©share_url</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952652-1121892699.jpg" class="lazyload"></p>
<p><strong>6ãæ¹å¤çä½åä»£ç èç¹ï¼å°è§é¢è¯¦ææ´åè¿è§é¢åè¡¨ä¸­</strong></p>
<p>è¿ä¸æ­¥å°ä»æé³APIè·åçè¯¦ç»è§é¢ä¿¡æ¯ä¸ä¹åæ¶éçè§é¢åè¡¨æ°æ®åå¹¶ã</p>
<p>éè¿è¿ä¸ªè¿ç¨ï¼æä»¬è½ææ¡æ¯ä¸ªè§é¢çå®æ´ä¿¡æ¯ï¼åæ¬äºå¨æ°æ®ï¼ç¹èµãè¯è®ºãæ¶èæ°ï¼ãåä½èä¿¡æ¯ååå®¹è¯¦æï¼ä»èä¸ºåç»­åææä¾å¨é¢çæ°æ®åºç¡ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>aweme_detailï¼ä»"è·ååä¸ªè§é¢è¯¦ç»ä¿¡æ¯"èç¹çè¾åºä¸­ï¼éæ©aweme_detail</li>
<li>awemeï¼ä»"æ¹éè·åè§é¢è¯¦ç»ä¿¡æ¯"èç¹çè¾åºä¸­ï¼éæ©item</li>
</ul>
</li>
<li>è¾åºï¼
<ul>
<li>aweme_listï¼åéç±»åè®¾ç½®ä¸º Array å¯¹è±¡æ°ç»ï¼è¡¨ç¤ºå¤çåçè§é¢åè¡¨</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952653-834122167.jpg" class="lazyload"></p>
<p>ä¸é¢æ¯å¤çæ°æ®çPythonä»£ç ï¼å®ä¼å°è§é¢ä¿¡æ¯è½¬æ¢ææä»¬éè¦çæ ¼å¼ã</p>
<pre><code class="language-python">async def main(args: Args) -&gt; Output:
    params = args.params
    aweme_detail = params.get("aweme_detail", {})
    aweme = params.get("aweme", {})
    aweme["aweme_detail"] = aweme_detail

    ret: Output = {
        "aweme_list": [aweme]
    }
    return ret
</code></pre>
<p><strong>7ãæ¹å¤çä½åä»£ç èç¹ï¼å°ä¿¡æ¯æ´çä¸ºé£ä¹¦è¡¨æ ¼å¯ä»¥ä½¿ç¨çæ°æ®</strong></p>
<p>å¨è¿ä¸ªç¯èä¸­ï¼æä»¬ä¼æåè§é¢çæ ¸å¿ä¿¡æ¯ï¼å¦æ é¢ãç¹èµæ°ãè¯è®ºæ°ç­ï¼ï¼å¹¶å°å®ä»¬è½¬æ¢æé£ä¹¦è¡¨æ ¼è½å¤ç´æ¥è¯å«åå¤ççæ ¼å¼ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>aweme_listï¼ä»"å°è§é¢è¯¦ææ´åè¿è§é¢åè¡¨ä¸­"èç¹çè¾åºä¸­ï¼éæ©aweme_list</li>
<li>keywordsï¼ä»å¼å§èç¹ä¸­ï¼éæ©keywords</li>
</ul>
</li>
<li>è¾åºï¼
<ul>
<li>recordsï¼å¤çåçè¡¨æ ¼æ°æ®ï¼éæ©Arrayç±»å</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952664-4256941.jpg" class="lazyload"></p>
<p>ä¸é¢æ¯å¤çæ°æ®çPythonä»£ç ï¼è¿æ®µä»£ç éå¸¸éè¦ï¼å®è´è´£å°æé³APIè¿åçåå§æ°æ®è½¬æ¢æç»æåçè¡¨æ ¼æ°æ®ã</p>
<pre><code class="language-python">async def main(args: Args) -&gt; Output:
    params = args.params
    aweme_list = params.get("aweme_list", [])

    result = []

    # éå aweme_listï¼ä¾æ¬¡å¤ç
    for aweme in aweme_list:

        # è·å aweme_detail å¹¶å¤ç©º
        aweme_detail = aweme.get("aweme_detail") or {}
        title = aweme_detail.get("desc") or ""
        link = aweme_detail.get("share_url") or ""

        # å®å¨è·å statistics
        statistics = aweme_detail.get("statistics") or {}

        # æååå­æ®µä¿¡æ¯ï¼å¹¶å¨åå¼æ¶å é»è®¤å¼
        video_id = statistics.get("aweme_id") or ""
        digg_count = statistics.get("digg_count") or 0
        comment_count = statistics.get("comment_count") or 0
        collect_count = statistics.get("collect_count") or 0
        share_count = statistics.get("share_count") or 0

        # è·åä½èä¿¡æ¯
        author_info = aweme_detail.get("author") or {}
        author_name = author_info.get("nickname") or ""
        signature = author_info.get("signature") or ""
        sec_uid = author_info.get("sec_uid") or ""
        raw_create_time = aweme_detail.get("create_time", 0)
        # å¦æä¸æ¯ intï¼å°±å°è¯è½¬æ¢ï¼å¤±è´¥åä¸º 0
        try:
            create_time = int(raw_create_time)
        except (TypeError, ValueError):
            create_time = 0

        # åå»ºæ¶é´ä»¥æ¯«ç§è®¡ï¼é¿å None æéæ³å¼å¯¼è´æ¥é
        create_time_ms = create_time * 1000

        raw_duration = aweme_detail.get("duration", 0)
        # å¦æä¸æ¯æ°å­ï¼å°è¯è½¬æ¢ä¸º floatï¼å¤±è´¥åä¸º 0
        try:
            duration = float(raw_duration)
        except (TypeError, ValueError):
            duration = 0.0
        duration_sec = duration / 1000

        # ç»è£è¿åæ°æ®
        item_dict = {
            "fields": {
                "è§é¢ID": video_id,
                "æ é¢": title.strip(),
                "å³é®è¯": params.get("keywords", ""),
                "é¾æ¥": {
                    "text": "æ¥çè§é¢",
                    "link": link.strip(),
                },
                "ç¹èµæ°": digg_count,
                "è¯è®ºæ°": comment_count,
                "æ¶èæ°": collect_count,
                "åäº«æ°": share_count,
                "ä½è": author_name,
                "ç¨æ·ç®ä»": signature,
                "ç¨æ·ID": sec_uid,
                "åå¸æ¥æ": create_time_ms,  # æ¯«ç§çº§æ¶é´æ³
                "æ¶é¿": duration_sec        # ç§
            }
        }
        result.append(item_dict)

    return result
</code></pre>
<p><strong>8ãæ¹å¤çä½åæä»¶èç¹ï¼å°æ°æ®æ·»å å°å¤ç»´è¡¨æ ¼</strong></p>
<p>é¦åï¼æä»¬éè¦åå»ºä¸ä¸ªå¤ç»´è¡¨æ ¼å¹¶è®¾ç½®å¥½è¡¨å¤´å­æ®µï¼ä¸ºåç»­æ°æ®ééåå¥½åå¤ãè¿ä¸ªè¡¨æ ¼æ¯å­å¨ååææé³ç­ç¹è§é¢æ°æ®çæ ¸å¿ï¼å æ­¤è¡¨å¤´è®¾è®¡è³å³éè¦ãæä»¬åºåå«è§é¢IDãæ é¢ãç¹èµæ°ãè¯è®ºæ°ç­å³é®ä¿¡æ¯ï¼ä¾¿äºåæåæåç­éãåå»ºå¥½çè¡¨æ ¼çé¢å¦ä¸å¾æç¤ºã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952650-2034950698.jpg" class="lazyload"></p>
<p>éæ©"é£ä¹¦è¡¨æ ¼"æä»¶èç¹çadd_recordså·¥å·ï¼å°æ°æ®æ·»å å°å¤ç»´è¡¨æ ¼ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952610-1898602827.jpg" class="lazyload"></p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>app_tokenï¼æååå»ºä¸ä¸ªå¤ç»´è¡¨æ ¼ï¼å°å¤ç»´è¡¨æ ¼çé¾æ¥å¤å¶è¿å»ã</li>
<li>recordsï¼ä»"å°ä¿¡æ¯æ´çä¸ºé£ä¹¦è¡¨æ ¼å¯ä»¥ä½¿ç¨çæ°æ®"çè¾åºåéä¸­ï¼éæ©recordsã</li>
<li>table_idï¼å¤ç»´è¡¨æ ¼æ°æ®è¡¨çå¯ä¸æ è¯ç¬¦ï¼å¦å¾6-10æç¤ºã</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952606-670315629.jpg" class="lazyload"></p>
<p><strong>9ãç»æèç¹</strong></p>
<p>éæ©"è¿åææ¬"ï¼å¹¶å°åç­åå®¹è®¾ç½®ä¸ºï¼"è·åå³é®è¯ä¸çæææé³è§é¢ãå®æã"ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952599-2065139559.jpg" class="lazyload"></p>
<h3 id="4æé³ç­ç¹çæ§æºè½ä½è®¾ç½®">4.æé³ç­ç¹çæ§æºè½ä½è®¾ç½®</h3>
<p>å°ç®åä¸ºæ­¢ï¼æä»¬å·²ç»ä»ç»äºæé³ç­ç¹çæ§å·¥ä½æµçæ­å»ºè¿ç¨ãæ¥ä¸æ¥ï¼æä»¬å°ä»ç»æé³ç­ç¹çæ§æºè½ä½çè®¾ç½®ãè¿ä¸ªç¯èå°å·¥ä½æµä¸æºè½ä½ç»å®ï¼åªæå®æè¿ä¸æ­¥ï¼æä»¬æè½çæ­£å®ç°æé³ç­ç¹çæ§æºè½ä½çåè½ã</p>
<p>æ¥ä¸æ¥ï¼æä»¬å°éæ­¥æå¯¼ä½ å®ææ´ä¸ªè®¾ç½®è¿ç¨ï¼åæ¬åå»ºæºè½ä½ãéç½®åºæ¬åæ°ãè¿æ¥å·¥ä½æµä»¥åè¿è¡æµè¯ï¼å¸®å©ä½ å¿«éææ¡è¿é¡¹å®ç¨æè½ã</p>
<p><strong>1ãæ°å»ºæºè½ä½</strong></p>
<p>å¨Cozeå¹³å°åå»ºä¸ä¸ªæ°çæºè½ä½ï¼å°å¶å½åä¸º"æé³ç­ç¹çæ§æºè½ä½"ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952547-498426495.jpg" class="lazyload"></p>
<p><strong>2ãè®¾ç½®äººè®¾ä¸é»è¾</strong></p>
<p>è®¾ç½®äººè®¾ä¸é»è¾æ¯åå»ºæºè½ä½çå³é®æ­¥éª¤ãå¨è¿ä¸ç¯èï¼æä»¬éè¦æç¡®æºè½ä½çè¡ä¸ºæ¨¡å¼åååºæ¹å¼ã</p>
<p>å¯¹äºæé³ç­ç¹çæ§æºè½ä½ï¼æä»¬å¸æå®è½ç´æ¥æ§è¡ä»»å¡ï¼æ éè¿å¤äº¤äºãå æ­¤ï¼æä»¬è®¾ç½®ç®åæäºçæä»¤ï¼è®©æºè½ä½å¨æ¥æ¶å°å³é®è¯åç«å³æ§è¡è§é¢ééå·¥ä½ã</p>
<pre><code>ç´æ¥æ§è¡`fetch_douyin_hot_videos`
</code></pre>
<p><strong>3ãç»å®å·¥ä½æµ</strong></p>
<p>æ"fetch_douyin_hot_videos"å·¥ä½æµæ·»å å°æºè½ä½ä¸­ãè¿ä¸ªå·¥ä½æµæ¯æä»¬ä¹åè®¾è®¡çæé³è§é¢ééå·¥ä½æµï¼å°å®ç»å®å°æºè½ä½åï¼ç¨æ·åªéè¾å¥å³é®è¯ï¼æºè½ä½å°±ä¼èªå¨æ§è¡å·¥ä½æµï¼å¸®å©æä»¬é«æå°æ¶éæé³ç­ç¹è§é¢ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952687-1321051239.jpg" class="lazyload"></p>
<p><strong>5ãæµè¯å¹¶åå¸</strong></p>
<p>å¨é¢è§ä¸è°è¯çªå£ä¸­è¾å¥å³é®è¯ï¼æµè¯æºè½ä½ééç­ç¹æé³è§é¢çåè½ãç³»ç»ä¼èªå¨æ§è¡å·¥ä½æµï¼å¹¶å°ç»ææ·»å å°é£ä¹¦è¡¨æ ¼ä¸­ã</p>
<p>ä½¿ç¨ä¸åå³é®è¯è¿è¡å¤æ¬¡æµè¯ï¼ç¡®ä¿æºè½ä½å¨åç§æåµä¸é½è½ç¨³å®è¿è¡ãæµè¯æ è¯¯åï¼ç¹å»"åå¸"æé®å°æºè½ä½æ­£å¼åå¸å°çäº§ç¯å¢ï¼ä¾ç¨æ·ä½¿ç¨ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952704-1674920919.jpg" class="lazyload"></p>
<h3 id="5å°çº¢ä¹¦ç­ç¹çæ§å·¥ä½æµ">5.å°çº¢ä¹¦ç­ç¹çæ§å·¥ä½æµ</h3>
<p>æ¥ä¸æ¥æä»¬å°æ·±å¥äºè§£å¦ä½å®éæ­å»ºä¸ä¸ªå°çº¢ä¹¦ç­ç¹çæ§å·¥ä½æµã</p>
<p>è¿ä¸ªå·¥ä½æµè½å¸®ä½ èªå¨æ¶éå°çº¢ä¹¦å¹³å°ä¸çç­é¨åå®¹ï¼è®©ä½ ä¸ç¨æå¨æµè§å°±è½ææ¡ææ°è¶å¿ã</p>
<p>æä»¬å°ä½¿ç¨ç®åææçæ­¥éª¤ï¼å¸¦ä½ ä»é¶å¼å§æå»ºè¿ä¸ªå¼ºå¤§ççæ§ç³»ç»ï¼å³ä½¿ä½ æ²¡æç¼ç¨ç»éªä¹è½è½»æ¾ä¸æã</p>
<p>ç»å½Cozeå®ç½ï¼å¨âèµæºåº-å·¥ä½æµâéæ°å»ºä¸ä¸ªç©ºç½å·¥ä½æµï¼ååâxhs_keywordsâãå·¥ä½æµæ´ä½é¢è§å¦å¾æç¤ºã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952819-1031545334.jpg" class="lazyload"></p>
<p><strong>1ãå¼å§èç¹</strong></p>
<p>è¿éç¨äºå®ä¹å·¥ä½æµå¯å¨æ¶æéçè¾å¥åæ°ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>foldUrlï¼é£ä¹¦è¡¨æ ¼é¾æ¥ï¼éè¦æååå»ºå¥½ä¸ä¸ªé£ä¹¦å¤ç»´è¡¨æ ¼ï¼å¹¶å¤å¶å¶é¾æ¥ãè¯¥è¡¨æ ¼å°ç¨äºå­å¨æä»¬ééå°çå°çº¢ä¹¦ç­ç¹è§é¢</li>
<li>cookieï¼å°çº¢ä¹¦ç½ç«çcookieä¿¡æ¯ï¼è¿æ¯è®¿é®å°çº¢ä¹¦APIçå¿è¦å­è¯ï¼æä»¬å°å¨åé¢è¯¦ç»è®²è§£å¦ä½è·å</li>
<li>keywordsï¼ç¨äºæç´¢ç­ç¹çå³é®è¯ï¼å¯ä»¥æ¯äº§ååç§°ãè¡ä¸æ¯è¯­ãç«ååç§°æç­é¨è¯é¢ï¼ç³»ç»ä¼èªå¨æç´¢ç¸å³çç­é¨åå®¹</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952691-6617434.jpg" class="lazyload"></p>
<p><strong>2ãå¦ä½è·åå°çº¢ä¹¦cookie</strong></p>
<p>å¨Chromeæµè§å¨ä¸­ï¼ç»å½å°çº¢ä¹¦ä¸»é¡µï¼<a href="https://www.xiaohongshu.com/" target="_blank" rel="noopener nofollow">https://www.xiaohongshu.com/</a></p>
<p>æF12é®æå¼å¼åèå·¥å·é¢æ¿ï¼ç¶åæç§ä»¥ä¸æ­¥éª¤æä½ï¼</p>
<ul>
<li>ç¬¬ä¸æ­¥ï¼ç¹å»ãç½ç»ãéé¡¹å¡</li>
<li>ç¬¬äºæ­¥ï¼ç¹å»ãææ¡£ãæ ç­¾</li>
<li>ç¬¬ä¸æ­¥ï¼ç¹å»ãexploreãææ¡£</li>
<li>ç¬¬åæ­¥ï¼ç¹å»ãæ å¤´ãéé¡¹å¡</li>
<li>ç¬¬äºæ­¥ï¼æ»å¨é¡µé¢æ¾å°Cookieå­æ®µï¼å¤å¶æ´æ®µCookieä¿¡æ¯ã</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952718-703458779.jpg" class="lazyload"></p>
<p><strong>2ãæä»¶èç¹ï¼æ ¹æ®å³é®è¯è·åç¬è®°</strong></p>
<p>æä»¬å°ä½¿ç¨âå°çº¢ä¹¦âæä»¶çxhs_search_noteå·¥å·ãéè¿è¿ä¸ªåè½ï¼æä»¬å¯ä»¥æ ¹æ®å³é®è¯ï¼æ¹éè·åç­é¨è§é¢ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952800-1170167012.jpg" class="lazyload"></p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>cookieStrï¼å¼å§èç¹ç cookie</li>
<li>keywordsï¼å³é®è¯ï¼ä»å¼å§èç¹è·å</li>
<li>notTypeï¼æ¥è¯¢ç±»åï¼0=å¨é¨ï¼1=è§é¢ï¼2=å¾æï¼ï¼è¿éæä»¬éæ©1 è§é¢ç±»å</li>
<li>sortï¼æåºï¼é»è®¤ä¸ºç»¼åï¼0=ç»¼åï¼1=ææ°ï¼2=æç­ï¼ï¼è¿éæä»¬éæ©2 æç­</li>
<li>totalNumberï¼æ¥è¯¢æ»æ°ï¼è¿éæä»¬è¾å¥20</li>
</ul>
</li>
</ul>
<p><strong>3ãå¾ªç¯èç¹ï¼å¾ªç¯è·åç¬è®°è¯¦æ</strong></p>
<p>å¾ªç¯è·åç¬è®°è¯¦ææ¯å·¥ä½æµä¸­çå³é®ç¯èï¼å®ä½¿æä»¬è½å¤ä¸æ¬¡æ§å¤çå¤æ¡å°çº¢ä¹¦ç¬è®°ãä»æç´¢ç»æä¸­è·åç¬è®°é¾æ¥åï¼æä»¬éè¦éä¸è·åæ¯æ¡ç¬è®°çè¯¦ç»ä¿¡æ¯ï¼åæ¬æ é¢ãåå®¹ãä½èåç¹èµæ°ç­ã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>inputï¼ä»"æ ¹æ®å³é®è¯è·åç¬è®°"èç¹çè¾åºä¸­ï¼éæ© data</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952494-338129973.jpg" class="lazyload"></p>
<p><strong>4ãå¾ªç¯ä½åæä»¶èç¹ï¼è·åç¬è®°è¯¦æ</strong></p>
<p>æä»¬å°ä½¿ç¨å°çº¢ä¹¦æä»¶çxhs_note_detailå·¥å·ãè¯¥å·¥å·è½è·åæ¯æ¡ç¬è®°çå®æ´ä¿¡æ¯ï¼åæ¬æ é¢ãåå®¹ãä½èä¿¡æ¯åäºå¨æ°æ®ç­ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952774-368074992.jpg" class="lazyload"></p>
<ul>
<li>è¾å¥
<ul>
<li>cookieStrï¼å¼å§èç¹ç cookie</li>
<li>noteUrlï¼ä» âå¾ªç¯ç¬è®°è¯¦æâ èç¹çè¾åºä¸­ï¼éæ© noteUrl</li>
</ul>
</li>
</ul>
<p><strong>5ãå¾ªç¯ä½åæä»¶èç¹ï¼æåè§é¢ææ¡</strong></p>
<p>æä»¬å°ä½¿ç¨"å­å¹è·å"æä»¶çgenerate_video_captions_syncå·¥å·ãè¯¥å·¥å·è½èªå¨ä»è§é¢ä¸­æåæå­åå®¹ï¼å°å£è¿°è½¬æ¢ä¸ºææ¬ï¼çå»æå¨å¬åçéº»ç¦ãå®è½ç²¾åè¯å«è§é¢ä¸­çè¯­é³å¹¶çææå­è®°å½ï¼å¸®å©æä»¬å¿«éçè§£è§é¢çä¸»é¢åå³é®ä¿¡æ¯ã</p>
<p>è¾å¥ï¼</p>
<ul>
<li>urlï¼ä»"è·åç¬è®°è¯¦æ"èç¹çè¾åºä¸­ï¼éæ© video_h264_urlï¼è¡¨ç¤ºH264æ åç¼ç æ ¼å¼è§é¢é¾æ¥</li>
<li>langï¼è§é¢è¯­è¨ï¼å¦æ±è¯­ãè±è¯­ç­ï¼ä¸å¡«æ¶é»è®¤ä¸ºæ±è¯­</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952728-408891549.jpg" class="lazyload"></p>
<p><strong>6ãå¾ªç¯ä½åä»£ç èç¹ï¼å°ç¬è®°æ°æ®æ´çæé£ä¹¦è¡¨æ ¼æ ¼å¼</strong></p>
<p>è¿ä¸æ­¥å°ééå°çè§é¢ä¿¡æ¯è½¬æ¢ä¸ºæ ååæ°æ®ç»æï¼ä»¥ä¾¿åå¥é£ä¹¦è¡¨æ ¼ãæä»¬éè¦æåè§é¢çæ é¢ãåå®¹ãä½èåç¹èµæ°ç­å³é®ä¿¡æ¯ï¼å¹¶æé£ä¹¦è¡¨æ ¼è¦æ±è¿è¡æ ¼å¼åãè¿æ ·ä¸ä»ä¾¿äºæ°æ®æ´çåç­éï¼è¿è½å¸®å©æä»¬æ´ç´è§å°åæç­é¨åå®¹çç¹ç¹ã</p>
<ul>
<li>è¾å¥
<ul>
<li>inputï¼ä»"è·åç¬è®°è¯¦æ"èç¹çè¾åºä¸­ï¼éæ©note</li>
<li>dataï¼ä»"æåè§é¢ææ¡"èç¹çè¾åºä¸­ï¼éæ©data</li>
</ul>
</li>
<li>è¾åº
<ul>
<li>recordsï¼åéç±»åè®¾ç½®ä¸º Array å¯¹è±¡æ°ç»ï¼è¡¨ç¤ºå¤çåçè§é¢åè¡¨</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952845-165290149.jpg" class="lazyload"></p>
<p>ä¸é¢æ¯å¤çæ°æ®çPythonä»£ç ï¼å®å°ééå°çå°çº¢ä¹¦è§é¢ä¿¡æ¯è½¬æ¢ä¸ºæ åæ ¼å¼ï¼ä¾¿äºå­å¨ååæã</p>
<p>ä»£ç æåè§é¢çæ é¢ãåå®¹ãä½èç­å³é®ä¿¡æ¯ï¼å°å¶ç»ç»æé£ä¹¦è¡¨æ ¼æéçæ ¼å¼ï¼ç¶åè¿åå¤çå¥½çæ°æ®ãè¿æ ·æä»¬è½å°ææç­é¨è§é¢æ´é½å°å­æ¾å¨åä¸å¼ è¡¨æ ¼ä¸­ï¼æ¹ä¾¿åç»­åæï¼</p>
<pre><code class="language-python">async def main(args: Args) -&gt; Output:
    input_data = args.params.get('input')  or {}
    data = args.params.get('data') or {}

    records = []  # åå§å records åè¡¨

    # æå note ç¸å³å­æ®µ
    title = input_data.get('note_display_title', '')  # æ é¢
    desc = input_data.get('note_desc', '')  # æè¿°
    url = input_data.get('note_url', '')  # é¾æ¥
    nickname = input_data.get('auther_nick_name', '')  # ä½èæµç§°
    likedCount = input_data.get('note_liked_count', '0')  # ç¹èµæ°
    videoUrl = input_data.get('video_h264_url', '')  # è§é¢å°å
    collectedCount = input_data.get('collected_count', '0')  # æ¶èæ°
    imageList = input_data.get('note_image_list', [])  # å¾çåè¡¨

    # æå»ºè®°å½å¯¹è±¡
    record = {
        "fields": {
            "ç¬è®°é¾æ¥": url,
            "æ é¢": title,
            "åå®¹": desc,
            "ä½è": nickname,
            "ç¹èµæ°": likedCount,
            "é¾æ¥": {
                "link": url,
                "text": title
            },
            "æ¶èæ°": collectedCount,
            "å¾çå°å": '\n'.join(imageList),  # å°å¾çåè¡¨æ¼æ¥æå­ç¬¦ä¸²
            "è§é¢å°å": videoUrl,
            "è§é¢ææ¡": data.get("content", "") 
        }
    }
    records.append(record)  # å°è®°å½å¯¹è±¡æ·»å å° records åè¡¨ä¸­

    # æå»ºè¾åºå¯¹è±¡
    ret: Output = {
        "records": records
    }
    return ret
</code></pre>
<p><strong>7ãå¾ªç¯ä½åæä»¶èç¹ï¼åå¥é£ä¹¦è¡¨æ ¼</strong></p>
<p>æåï¼æä»¬å°æ¶éå°çæææ°æ®æ·»å å°é£ä¹¦å¤ç»´è¡¨æ ¼ä¸­ã</p>
<p>æä»¬éè¦æååå»ºä¸ä¸ªå¤ç»´è¡¨æ ¼ï¼å¹¶è®¾ç½®å¥½å¯¹åºçè¡¨å¤´å­æ®µã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952577-2043730972.jpg" class="lazyload"></p>
<p>è¡¨å¤´å­æ®µåæ¬è§é¢çææå³é®ä¿¡æ¯ï¼ç¬è®°é¾æ¥ãæ é¢ãåå®¹ãä½èãç¹èµæ°ãé¾æ¥ãæ¶èæ°ãå¾çå°åãè§é¢å°ååè§é¢ææ¡ã</p>
<p>æ¥ä¸æ¥ï¼éæ©"é£ä¹¦è¡¨æ ¼"æä»¶èç¹çadd_recordså·¥å·ï¼å°ééå°çæ°æ®æ·»å å°å¤ç»´è¡¨æ ¼ä¸­ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952610-1898602827.jpg" class="lazyload"></p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>app_tokenï¼æååå»ºä¸ä¸ªå¤ç»´è¡¨æ ¼ï¼ç¶åå°å¤ç»´è¡¨æ ¼çé¾æ¥å¤å¶å°æ­¤å¤ã</li>
<li>recordsï¼ä»"å°ä¿¡æ¯æ´çä¸ºé£ä¹¦è¡¨æ ¼å¯ä»¥ä½¿ç¨çæ°æ®"èç¹çè¾åºåéä¸­ï¼éæ©recordsã</li>
<li>table_idï¼éå¡«å¥å¤ç»´è¡¨æ ¼æ°æ®è¡¨çå¯ä¸æ è¯ç¬¦ã</li>
</ul>
</li>
</ul>
<p><strong>8ãç»æèç¹</strong></p>
<p>æåæ·»å ç»æèç¹ï¼å®ææ´ä¸ªå·¥ä½æµç¨ãå¦å¾6-25æç¤ºã</p>
<ul>
<li>è¾åºï¼
<ul>
<li>outputï¼å¼å§èç¹çfoldUrlï¼ä¹å°±æ¯é£ä¹¦å¤ç»´è¡¨æ ¼çé¾æ¥</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952836-1066782058.jpg" class="lazyload"></p>
<h3 id="6å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½è®¾ç½®">6.å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½è®¾ç½®</h3>
<p>è³æ­¤ï¼æä»¬å·²å®æå°çº¢ä¹¦ç­ç¹çæ§å·¥ä½æµçæ­å»ºãæ¥ä¸æ¥ï¼æä»¬å°ä»ç»å¦ä½è®¾ç½®å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½ãè¿ä¸ªå³é®ç¯èå°å·¥ä½æµä¸æºè½ä½ç»å®å¨ä¸èµ·ï¼åªæå®æè¿ä¸æ­¥ï¼æè½çæ­£å®ç°å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½çåè½ã</p>
<p><strong>1ãæ°å»ºæºè½ä½</strong></p>
<p>å¨Cozeå¹³å°åå»ºä¸ä¸ªæ°çæºè½ä½ï¼å½åâå°çº¢ä¹¦ç­ç¹çæ§æºè½ä½âãå¦å¾6-26æç¤ºã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952825-1616741015.jpg" class="lazyload"></p>
<p><strong>2ãè®¾ç½®äººè®¾ä¸é»è¾</strong></p>
<p>è®¾ç½®äººè®¾ä¸é»è¾æ¯åå»ºæºè½ä½çå³é®æ­¥éª¤ãå¨è¿ä¸ç¯èï¼æä»¬éè¦æç¡®æºè½ä½çè¡ä¸ºæ¨¡å¼åååºæ¹å¼ã</p>
<p>å¯¹äºå°çº¢ä¹¦ç­ç¹çæ§æºè½ä½ï¼æä»¬å¸æå®è½ç´æ¥æ§è¡ä»»å¡ï¼æ éè¿å¤äº¤äºãå æ­¤ï¼æä»¬è®¾ç½®ç®åæäºçæä»¤ï¼è®©æºè½ä½å¨æ¥æ¶å°å³é®è¯åç«å³æ§è¡è§é¢ééå·¥ä½ã</p>
<pre><code>ç´æ¥æ§è¡`xhs_keywords`
</code></pre>
<p><strong>3ãç»å®å·¥ä½æµ</strong></p>
<p>æ"xhs_keywords"å·¥ä½æµæ·»å å°æºè½ä½ä¸­ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260204162952663-2052627237.jpg" class="lazyload"></p>
<p><strong>4ãæµè¯å¹¶åå¸</strong></p>
<p>å¨é¢è§ä¸è°è¯çªå£ä¸­è¾å¥å³é®è¯ï¼æµè¯æºè½ä½çå°çº¢ä¹¦ç­ç¹è§é¢ééåè½ãç³»ç»ä¼èªå¨æ§è¡å·¥ä½æµï¼å¹¶å°ç»æç´æ¥æ·»å å°é£ä¹¦è¡¨æ ¼ä¸­ã</p>
<blockquote>
<p>å¯¹äºï¼ææ´çäºä¸ä»½å¼æºçæºè½ä½å­¦ä¹ æåï¼çè 10 ä¸å­ï¼ä»·å¼ 999 åãéæ¶å¼æ¾é¢åðï¼<a href="https://tangshiye.cn" target="_blank" rel="noopener nofollow">tangshiye.cn</a></p>
</blockquote>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/tangshiye/" target="_blank">AIæ¶æå¸æ±¤å¸ç·</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/tangshiye/p/19575161" target="_blank">https://www.cnblogs.com/tangshiye/p/19575161</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 16:30">2026-02-04 16:30</span>&nbsp;
<a href="https://www.cnblogs.com/tangshiye">AIæ¶æå¸æ±¤å¸ç·</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19575161);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19575161', targetLink: 'https://www.cnblogs.com/tangshiye/p/19575161', title: 'æ£å­Cozeå®æï¼ä»0å°1æé æé³+å°çº¢ä¹¦ç­ç¹çæ§æºè½ä½' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æµè°æ°æ®è®¿é®å± ]]></title>
    <link>https://www.cnblogs.com/legweifang/p/19575087</link>
    <guid>bd57607f3ebc8e7347f4faa808a134d9</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/legweifang/p/19575087" title="åå¸äº 2026-02-04 16:23">
    <span role="heading" aria-level="2">æµè°æ°æ®è®¿é®å±</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p style="text-align: center">æµè°æ°æ®è®¿é®å±</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; åä¸æ°æ®è®¿é®å±è¿å ä¸ªå­ï¼ææç°å¨çç¨åºåå¾å°ç¥éæ¯ä»ä¹ææçï¼ä»ä»¬å¯è½ç¥éæ°æ®å®ä½ï¼ç¥éEFåSqlSugarï¼ä¸ç¥éæ°æ®è®¿é®å±æ¯ååäºãçç¡®ç°å¨çORMæ¡æ¶å·²ç»æ·¡åäºæ°æ®è®¿é®å±çæ¦å¿µï¼ç°å¨åªè¦ä¼åå»ºå®ä½ç±»ï¼ä¼è°ç¨EFå°±å¯ä»¥äºï¼æ¡æ¶ä¸åé½æ¯åå¥½äºï¼ä¸ç¨ææ°æ®åºï¼ä¹ä¸ç¨å³å¿æ¯ä»ä¹æ°æ®åºï¼æ»ä¹ä¸å¥ä»£ç ä»ä¹æ°æ®åºé½æ¯æï¼è¿ä¸ºè¿ç§å¼åæ¨¡å¼èµ·äºåå­å«CodeFirstï¼ä»£ç åè¡ï¼ãä½ä¸ºä¸åèç¨åºåï¼æä¸ç¥éè½¯ä»¶å¼åæ¨¡å¼ä¸ºå¥ä¼æ¼åå°ä»å¤©è¿ä¸ªæ ·å­ï¼æçè¶æ¥è¶å¤æï¼è¶æ¥è¶è±ç¦»æ ¹æ¬ã</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;æä»¬é£æ¶åçç¨åºåï¼å¤§æ¦èå´æ¯å¨2000å¹´åå10å¹´å§ï¼è¦æ³å­¦ä¼è½¯ä»¶å¼åï¼é¦åè¦å­¦ä¼ä½¿ç¨æ°æ®åºï¼è¦å­¦ä¼åsqlï¼å ä¸ºsql æ¯æä½æ°æ®çæ ¹æ¬ï¼ç¶åè¦å­¦ä¼å­å¨è¿ç¨ï¼å ä¸ºå­å¨è¿ç¨æ¯æ§è½ä¼åçéè¦ææ®µï¼è¿è¦å­¦ä¼è§å¾ï¼å ä¸ºè§å¾æ¯æ°æ®å³èçæ¡¥æ¢ï¼è¿æè§¦åå¨ï¼æ¯å¼¥è¡¥åè½ç¼ºé·çå©å¨ãèç°å¨å¢ï¼è¿äºå¨ä¸è¢«æå¡äºï¼è¿äºä¼ ç»çææ¯å¨æä¸ºäºORM çç»èç³ãå¨ORMæ¡æ¶éï¼æ°æ®åºçç»ç»åå¤çè½åå¨é¨è¢«å®ä½ç±»ä»£æ¿äºï¼åªå©ä¸å­å¨è¿ä¸ä¸ªåè½äºã</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;ç°å¨çç¨åºåä¸äºè§£æ°æ®åºï¼è½¯ä»¶ç³»ç»åºäºé®é¢ä¹ä¸ç¥éæ¯ä»ä¹åå ï¼ä»£ç æ²¡é®é¢ï¼é®é¢å¯è½åºå¨æ°æ®ä¸ãå°±å¥½æ¯ç°å¨çç¨åºåä¹ä¸æç¡¬ä»¶ï¼çè³ä¸ä¼å®è£æä½ç³»ç»ãæä»¬é£æ¶åçç¨åºåå¨å¾å¤äººç¼éå°±æ¯ä¿®çµèçï¼å¶å®ä¸»ä¸æ¯åä»£ç ï¼ä½äººå®¶ä¸å³å¿ï¼ä¹ä¸äºè§£ï¼åªç¥éä¼ä¿®çµèãç°å¨å¢ï¼ä¸æ¯è¿æ ·äºï¼æäººè¯´è¿æ¯è¡ä¸çç»åï¼ä¸ä¸çäººå°±å¾åä¸ä¸çäºï¼ä½æè§å¾æäºç¸å³æè½è¿æ¯èªå·±ä¼æ¯è¾å¥½ã</p>
<p>&nbsp; &nbsp; &nbsp; ç¨åºåå¿é¡»è¦ææ°æ®åºï¼è¿æ¯æ ¹æ¬ã</p>
<p>&nbsp; &nbsp; &nbsp; æéå°è¿ä¸ä¸ªç¨åºåï¼ä»è¯´ä»ä»æ¥ä¸ä¼å»åsqlï¼ç¨ORMæ¡æ¶å¤ç®åï¼ä¸ç¨ORM å°±æ¯ä¸ç§è½åï¼ä»å¾æ§çï¼ææ¯æ²¡æ³åé©³ä»çï¼å ä¸ºè¿æ¯å½ä¸æµè¡çè¶å¿ï¼æåªç¥éï¼è¦è§£å³è½¯ä»¶ç³»ç»çé®é¢ï¼åªäºè§£ç¨åºä»£ç æ¯ä¸å¤çï¼å¾å¤æ·±å±æ¬¡çé®é¢è¦æ¥æ°æ®åºï¼åææ°æ®ï¼è¿æè½ä»æ¬è´¨ä¸è§£å³é®é¢ï¼å¦åå¾å¯è½æ¹äºè¿ä¸ªé®é¢åºæ¥é£ä¸ªé®é¢ï¼æä¸è«è¦èµ·æ¥ç¢ï¼æ°¸è¿æ¹ä¸å®çé®é¢ã</p>
<p>åæ¬¢ä½¿ç¨ORMæ¡æ¶çææ»ç»äºä¸¤ä¸ªåå ï¼ç¬¬ä¸ãä¸ºäºè·¨æ°æ®åºï¼ä¸å¥ä»£ç éååç§æ°æ®åºï¼ç¬¬äºãä¸ç¨å­¦ä¹ sqlè¯­æ³ãè§å¾ãå­å¨è¿ç¨ãè§¦åå¨ï¼çå»å­¦ä¹ æ°æ®åºçææ¬ï¼å¶ä»ææ³ä¸åºæ´åéççç±ã</p>
<p>æä¸åæ¬¢è¿ç§å¼åæ¨¡å¼ï¼ORM ææ¬è¯¥æ¾å¨æ°æ®åºä¸çç²¾åï¼æ¾å¨äºç¨åºä¸ï¼é£äºæå§è¾¾è¡¨è¾¾å¼æ¯sqlè¿é¾çè§£ï¼æè§å¾è¿æ¯æ¬æ«åç½®ï¼è®¤ç¥ä¸çåéï¼éå¨è¿©èæ±è¯¸è¿ï¼äºå¨æèæ±è¯¸é¾ãå¶å®æ¯ç§å¼åæ¹å¼é½æå®çä¼ç¼ºç¹ï¼æ²¡æå¯¹éï¼åªææ¯å¦åéï¼éåä½ çï¼å¯¹ä½ æ¥è¯´å°±æ¯å¯¹çï¼ä¸éåä½ çå¯¹ä½ æ¥è¯´å°±æ¯éçï¼ä¸è½ä¸æ¦èè®ºãè¦è§£å³é®é¢ï¼å°±ç¨èªå·±ææé¿çæ¹å¼ã</p>
<p>ææå¡çæ¹å¼æ¯ä¸ç¨å®ä½ç±»ï¼ç¨ä¼ ç»çsqlåDataTableï¼è¿æ¯æç®åæçµæ´»çæ¹å¼ï¼ä¹å°±æ¯æä¼ ç»çæ¹å¼ãè¿æ ·æ¢è½çæäºæ°æ®åºåè½çµæ´»çç¼åä»£ç ã</p>
<p>&nbsp; &nbsp; &nbsp; æç¥éæåè¿ç¯æç« å¾å¤äººä¼åå¯¹ï¼å ä¸ºç°å¨ä¼°è®¡80%çäººé½å¨ä½¿ç¨ORMæ¡æ¶å¼åï¼åæ¬ä»¥ååæ¬¢åsqlçé£æ¹èç¨åºåãè¿éå¢æä¹ä¸æ³äºè®ºï¼è½è§£å³é®é¢å°±è¡ãæ¿æç¨å¥å°±ç¨å¥ï¼ä½æ¯è¦åå°é®é¢å°æè¿éç»æï¼ä¸è¦è¯´æä¸ä¼è¿ä¸ªï¼è¿ä¸ªä¸ç®¡æçäºï¼æ°æ®åºæä¸ä¼æ¥ï¼æ¯ä¸ªäººè¦å¯¹èªå·±éæ©çæ¹å¼è´è´£å°åºã</p>
<p>&nbsp; &nbsp; &nbsp; å å¹´åï¼ææ¯è¾çä¸­ç¨åºä»£ç çç¼åè§èï¼æè§å¾ä»£ç åºè¯¥çä¸å»æ¯è¾èæï¼ç¼ç é£æ ¼è¦ä¸è´ï¼ä¸ä»ä»æ¯å®ç°åè½ãæä¸ä½èµæ·±çç¨åºåï¼ä¸å¤ªè®¤åï¼ä»è¯´ä¸ç®¡ä»£ç åçææ ·ï¼åªè¦æ°æ®å¯¹å°±è¡ï¼ä»¥æ°æ®åºä¸ºåï¼ç°å¨æè§å¾ä»è¯´çæä¸å®éçï¼æ¯ä¸ªç¨åºåçæ°´å¹³ä¸ä¸æ ·ï¼ç¨åºåçä¸å¥½å¯ä»¥éåï¼ä½æ°æ®è¦å¯¹ãäº§çæ°æ®çæ¹å¼æå¾å¤ï¼æ°æ®æ¥æºä¸æ­¢ä¸ä¸ªï¼æå¯è½æ¯æå·¥å½å¥çï¼æå¯è½æ¯æ¥å£æ¨éçï¼æå¯è½æ¯å¯¼å¥çï¼ä¸ç®¡æ¯é£ç§æ¹å¼é½è¦ç¡®ä¿æ°æ®çåç¡®æ§åå®æ´æ§ã</p>
<p>&nbsp; &nbsp; &nbsp; æä»¥ä»æ¬è´¨ä¸æ¥è¯´ï¼æ°æ®è®¿é®å±ä½¿ç¨ä»ä¹æ¹å¼å¹¶ä¸æ¯æéè¦çãæ°æ®åç¡®æ§åå®æ´æ§ææ¯æéè¦çã</p>
<p>å¦æä½ èµåä¸é¢çåæï¼é£ä¹ç»§ç»­åä¸çå¦ä½è®¾è®¡ç®åå®ç¨çæ°æ®è®¿é®å±ï¼å¦æä¸èµåé£å°±å°æ¬¡ä¸ºæ­¢ãå ä¸ºåé¢çè®¾è®¡ææ³å¯è½è®©ä½ æ´å ä¸å±ã</p>
<p>æ°æ®è®¿é®å±çè®¾è®¡è¦è§£å³ä¸ä¸å ä¸ªé®é¢ï¼</p>
<p>1ãè¿æ¥æ°æ®åºãè¦æ¯æè¿æ¥å¤ç§ç±»åçæ°æ®åºï¼æ¹å¼ä¸»è¦æ¯éè¿å®æ¹æä¾çæ°æ®åºè®¿é®ç±»ï¼ä¾å¦SqlDataClientã</p>
<p>2ãåºæ¬çæ°æ®è®¿é®æ¹æ³ãæ§è¡æ°å»ºinsertãæ´æ°updateãæ¥è¯¢selectï¼ä»¥åè°ç¨å­å¨è¿ç¨ï¼è¿äºåºæ¬å°±å¤äºãåè¿ä¸æ­¥å½çº³ä¸ä¸å°±æ¯ä¸¤ä¸ªæ¹æ³ï¼ExecuteNonQuery åExecuteQueryã</p>
<p>3ãæ§è¡æ°æ®æä½è¿åçæ°æ®å¯¹è±¡ãæ°å¢åæ´æ°è¿åçæ¯å½±åçæ°æ®è¡æ°ï¼å­å¨è¿ç¨è¿åçæ¯æ§è¡æ¯å¦æåï¼å°½éé¿åä½¿ç¨å­å¨è¿ç¨çè¿åå¼ï¼ï¼è¿äºæ²¡ä»ä¹å¥½è¯´çãéè¦è¯´çæ¯æ¥è¯¢æ°æ®æ¶è¿åæ°æ®å¯¹è±¡ãæä¸¤ç§å¯¹è±¡ï¼ä¸ç§æ¯DataTable ï¼ä¸ç§æ¯DataReaderï¼DataTable æ¯æ¯è¾ä¼ ç»çæ¹å¼ï¼ä¹æ¯ææ©è¢«å¹¿æ³ä½¿ç¨çãDataReader æ¯åæææçï¼å¯ä»¥çä½æ¯DataTable çåªè¯»å½¢å¼ï¼ç®çæ¯æé«è¯»åçæ§è½ï¼ORM æ¡æ¶å°±æ¯æDataReader æ å°æå®ä½ç±»ãè¿æ¯ç®åè¢«æå¡çå¼åæ¨¡å¼ï¼ä½æä»¬ä¸ç¨è¿ç§æ¹å¼ï¼èæ¯ç»§ç»­ç¨DataTableï¼å ä¸ºæä»¬ä¸ä½¿ç¨å®ä½ç±»ã</p>
<p>&nbsp; &nbsp; &nbsp; ä¸é¢æä»¬å¯¹è¿ä¸ä¸ªé®é¢å±å¼è¯´æï¼å·ä½å¦ä½å®ç°ã</p>
<p>&nbsp; &nbsp; &nbsp; ç¬¬ä¸ä¸ªé®é¢ï¼å¦ä½å®ç°è¿æ¥å¤ç§ç±»åçæ°æ®åºã</p>
<p>&nbsp; &nbsp; &nbsp; å¦å¨è®¿é®SqlServer æ°æ®åºçæ¶åä½¿ç¨SqlDataClient(Netçæ¬ä¸ååå­å¯è½ä¸ä¸æ ·)ï¼è®¿é®MySql æ°æ®åºçæ¶åä½¿ç¨MySql.DataClientã æç®åçåæ³å°±æ¯ä½¿ç¨æ¥å£ç±»ï¼å®ä¹ä¸ä¸ªæ¥å£ç±»ï¼ææææ°æ®è®¿é®æ¹æ³é½å®ä¹åºæ¥ï¼ä½¿ç¨æ¥å£æ¥è°ç¨æ¹æ³ï¼ååå»ºè®¿é®SqlServer çå®ç°ç±»åMySql çå®ç°ç±»ï¼é½è¦å®ç°è¯¥æ¥å£ãç¶åæå¤å±ååä¸ä¸ªä»£çç±»Agent ï¼ç¨æ¥ç¡®å®æ¥å£è¦è°ç¨åªä¸ªç±»ã</p>
<p>ç¨åºç»æå¦ä¸å¾ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/34454/202602/34454-20260204162050993-867994170.png"></p>
<p>æ¥å£çå®ä¹å¦ä¸å¾ï¼åªæ¾ç¤ºä¸»è¦çæ¹æ³ï¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/34454/202602/34454-20260204162052693-107139067.png"></p>
<p>ä»£çç±»çå®ä¹å¦ä¸å¾ï¼åªæ¾ç¤ºä¸»è¦æ¹æ³ï¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/34454/202602/34454-20260204162053367-1421368934.png"></p>
<p>&nbsp; &nbsp; &nbsp; ç¬¬äºä¸ªé®é¢ï¼æä½æ°æ®åºçåºæ¬æ¹æ³ï¼æäººè¯´åºæ¬æ¹æ³æ¯å¢å æ¹æ¥ï¼è¿ä¸ªæ²¡éï¼æè§å¾åè¿ä¸æ­¥ä¼å½çº³ä¸ä¸æ¯æ§è¡åè·åæ°æ®ãå°±æ¯ä¸¤ä¸ªæ¹æ³ExecuteNonQueryåExecuteQueryãå¶ä»ææçæä½é½æ¯å´ç»è¿ä¸¤ä¸ªæ¹æ³ï¼ä¹å¯ä»¥è¯´é½æ¯è°ç¨è¿ä¸¤ä¸ªæ¹æ³ãè¦å¨æ¯ç§ç±»åçæ°æ®åºè®¿é®ç±»ä¸­å®ç°è¿å ä¸ªåºæ¬æ¹æ³ã</p>
<p>ä»¥SqlServer ä¸ºä¾ååºåºæ¬æ¹æ³å¦ä¸å¾ï¼åªæ¾ç¤ºä¸»è¦çæ¹æ³ï¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/34454/202602/34454-20260204162052434-912150011.png"></p>
<p>&nbsp; &nbsp; &nbsp; ç¬¬ä¸ä¸ªé®é¢ï¼è¿åæ°æ®çå¯¹è±¡ã</p>
<p>&nbsp; &nbsp; &nbsp; åé¢è¯´äºæä»¬ç¨DataTableï¼èä¸ç¨æ°æ®å®ä½ï¼ä¸»è¦æ¯å ä¸ºå®çµæ´»ãè¿æ ·è®¾è®¡æ¯å¨é¡¹ç®ä¸­ææ¬æä½çæ¹æ¡ãææ¾ç»è®¾æ³è¿ä½¿ç¨æ°æ®å®ä½çåºæ¯ï¼é£å°±æ¯ä¸å¡éæ±éå¸¸æç¡®ï¼è°ç ååï¼æ°æ®ç»æåºæ¬å®åï¼å­æ®µæ°éç±»åé½å¾ç¡®åï¼è³å°ä¸å¡æ¨¡åé¢æ¼äºå éçï¼ä¹å°±ä¿è¯åè½ååºæ¥ä¸ä¼ç»å¸¸ä¿®æ¹ãè¿ç§æåµæè§è¿ï¼åè¿å¯¹æ¥å¤åé¡¹ç®çé½ç¥éï¼ç®ç´æ¯åæçè®¾è®¡è¦æ±ï¼ä¸ä¸ªå­æ®µï¼ä¸ä¸ªè¾å¥æ¡çå°ºå¯¸ï¼å­æ°éå¶ï¼éªè¯æç¤ºé½è¦å¨ææ¡£éåæ¸æ¥ï¼é¡¹ç®å¨æä¸ä¸ªæçè¯ææ¡£è¦åä¸¤ä¸ªåæãç°å®ä¸­è¿ç§æåµå¤ªå°äºï¼å¾å¤æåµæä»¬æ¿å°ä¸ªå¤§æ¦çéæ±å°±å¨æäºï¼ä¸è¾¹åä¸è¾¹å®åæ°æ®åºå­æ®µï¼å¤§æ¹åä¸ä¼éï¼å¢å ä¸ªå­æ®µæ¯å¸¸æçäºãä¸è¦è¯´è¿æ¯è¿åè½¯ä»¶å¼åè§èçï¼ä¸¥æ ¼éµå®è½¯ä»¶è§èæ¯å¾çæ³çäºæï¼ä¸ç¥éå¤§åä»¬æ¯å¦è½ä¸¥æ ¼éµå®è½¯ä»¶å¼åè§èï¼</p>
<p>&nbsp; &nbsp; &nbsp; ExecuteQueryåæ¬ä¸¤ä¸ªæ¹æ³ï¼ä¸ä¸ªæ¯è¿åDataTableï¼ä¸ä¸ªæ¯è¿åDataReaderï¼ä¸¥æ ¼æ¥è®²DataTableå¹¶ä¸å­å¨ï¼å¨NetçFrameworkæNetCoreæ¡æ¶ä¸­æä¸¤ç§æ¹å¼è¿åDataTableï¼ä¸ç§æ¯éè¿DataAdapterå¯¹è±¡çFillæ¹æ³å¡«åDataTableï¼ä¸ç§æ¯ä½¿ç¨DataReaderå¡«åDataTableï¼å¶å®è¿å·²ç»è¶³å¤ç¨äºã</p>
<p><img src="https://img2024.cnblogs.com/blog/34454/202602/34454-20260204162053187-175167613.png"></p>
<p><img src="https://img2024.cnblogs.com/blog/34454/202602/34454-20260204162053774-1873792402.png"></p>
<p>ä¸¤ç§æ¹æ³ç¨å¾®æç¹å·®å¼ï¼ä»¥ååæ¢æ¢è¯´ï¼çæ­£ä½¿ç¨çæ¶åå°±ç¥éäºï¼è¿éä¸è½è¯´å¤äºï¼è¯´å¤å®¹æè·é¢ã</p>
<p>&nbsp; &nbsp; &nbsp; æ°æ®åºè®¿é®ç±»çè®¾è®¡æ¯éç¹ï¼é¤äºæä¾åºæ¬æ¹æ³å¤ï¼è¿è¦å¤çå¥½æ°æ®åºè¿æ¥ãæ°æ®åºå³é­ï¼å¼å¯äºå¡ãå³é­äºå¡ï¼äºå¡åæ»ãè¿é½æ¯å¾éè¦çæ¦å¿µï¼å¦ææ°æ®åºåªå¼ä¸å³ï¼å¾å¿«è¿æ¥æ°éå°±ç¨å®äºãåå­¦èå¾å®¹æç¯çéè¯¯ï¼ä¸æ¦åºç°è¿å¾é¾ææ¥ãåæä¸ä¸ªéè¦çæ¦å¿µæ¯åä¸æ¹æ°æ®æä½å°½éå¨ä¸ä¸ªæ°æ®åºå¼é­ä¸­å®æï¼ä¸è¦åå¤çå¼é­æ°æ®åºï¼ä¾å¦ï¼ä¿®æ¹ä¸æ¡ååä¿¡æ¯ï¼åæ¥è¯¢ååç¼å·æ¯å¦å·²ç»å­å¨ï¼å¦æä¸å­å¨å¯ä»¥ä¿å­ï¼å·²ç»å­å¨æç¤ºéå¤ï¼ä¸è½ä¿å­ãè¿ä¸ªåè½åæ¬2ä¸ªæ°æ®æä½ï¼ä¸ä¸ªæ¯æç¼å·æ¥è¯¢ååè¡¨ï¼ä¸ä¸ªæ¯æ´æ°ååè¡¨ãè¿ä¸¤ä¸ªå¨ä½è¦å¨ä¸ä¸ªæ°æ®åºè¿æ¥ä¸­å®æãä¸è½æ¯ä¸ªå¨ä½é½è¦å¼é­æ°æ®åºãå¨æ©æçæ°æ®åºè®¿é®å±HFBPM3.5ä¸­ï¼å­å¨è¿ä¸ªé®é¢ãé£æ¶åçè®¾è®¡èèè¦æ¯ææ¬å°è°ç¨åè¿ç¨è°ç¨ï¼WCFçæ¹å¼ï¼ï¼æ¯ä¸ªæ°æ®æä½é½å¯ä»¥è°ç¨è¿ç¨çæ¹æ³ï¼ä¸è½å¨ä¸ä¸ªæ¬å°è¿æ¥éå®æãåæ¥ççæ¬å»æäºè¿ç¨è°ç¨ã</p>
<p>&nbsp; &nbsp; &nbsp; æå°WCFä¸å¾ä¸è·ä¸ªé¢ï¼å ä¸ºæ¶åå°å¾®è½¯çææ¯æ¡æ¶ï¼å¾æ©å¾®è½¯æ¨åºäºä¸å¤§æ¡æ¶WCFãWFFãWPFï¼è³ä»åªçä¸äºWPFï¼å¶ä»ä¸¤ä¸ªå¨å¾®è½¯Coreä¸­åºæ¬æ¶å¤±äºãå¾®è½¯çä¸è¥¿æ¯å¥½ï¼ç¨èµ·æ¥æ¹ä¾¿ï¼åè½ä¹å¼ºå¤§ï¼ä½æ·æ±°ä¹å¿«ï¼å¤ªçæ³åçä¸è¥¿å®¹æèµ°åï¼æäºä¸è¥¿åºçæï¼çæå°±ä¸å¥½ãæ¯å¦è¿ä¸ªMVCçæ¶æï¼æå°ç°å¨æ²¡æä¹ä½¿ç¨è¿ä¸ªæ¶æï¼ä½æ¯è¿ä¸ªææ³æä¸ç´å¨ç¨ï¼å¨å¾®è½¯asp.netçæ¶åï¼webçé¢è¦ä½¿ç¨æå¡ç«¯æ§ä»¶ï¼è¿ä¸ªä¸æ¹ä¾¿ï¼å¾å¿«å°±è¢«æ·æ±°äºï¼éçajaxåjqueryçå´èµ·æ¶ï¼æä»¬å¨ä¼ ç»çaspxä¸ä½¿ç¨ajaxåjqueryï¼å³ä½¿ç¨äºaspxçåå°åè½ï¼åä½¿ç¨äºjsåç«¯æ¡æ¶çä¼å¿ï¼å°±æ²¡æä½¿ç¨MVCï¼è¯´å®è¯å¾®è½¯çMVCæ¡æ¶åºæ¥çæç¹æï¼æä»¬å·²ç»å¨åäºï¼HFbpm4.0ä½¿ç¨çå°±æ¯è¿ç§æ¶æï¼è¿ç§æ¶æä¹ç±»ä¼¼äºNetCoreçWebAPIæ¶æï¼åå°æ¥å£ä½¿ç¨çMVCçè·¯ç±æºå¶ï¼å©ç¨åå°ææ¯å¨æè°ç¨æ¹æ³ï¼æ¯WebAPIè¿è¦çµæ´»ï¼WebAPIçä¾èµæ³¨å¥ä¹æå¾å¤ä¸çµæ´»çå°æ¹ï¼è¿éè¦ç»è®²ä¹éè¦å¾å¤§çç¯å¹ï¼åä¸èµè¿°äºï¼æå´è¶£çå¯ä»¥çä¸ä¸hfbpm4.0çç¨åºæ¶æï¼æ»ä¹ä¸å¥è¯ï¼ç¨æç®åçææ¯å®ç°æåºæ¬çåè½ï¼å¤§éè³ç®ã</p>
<p>&nbsp; &nbsp; &nbsp; è¿ä¸ªé¢è·çæç¹è¿ï¼èµ¶ç´§åå°æ­£é¢ä¸ï¼å¼é­æ°æ®åºåæ°æ®åºäºå¡ï¼è¿äºåè½è¦æå¨æ¥å®æï¼é»è®¤çæåµä¸ï¼æ¯æ¬¡æ°æ®æä½é½è¦å¼é­æ°æ®åºä¸æ¬¡ãæä»¬éè¿æ°å­¦æ§å¶æ°æ®æä½åä¸ä¸è¦å³é­æ°æ®åºè¿æ¥ï¼ç­æä½å®ååæå¨å³é­ãå¦ä¸é¢çä»£ç ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/34454/202602/34454-20260204162056417-2110537453.png"></p>
<p>&nbsp; &nbsp; &nbsp; æå¨å¼å¯äºå¡ï¼æå¨å³é­äºå¡ï¼å¦ä¸å¾ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/34454/202602/34454-20260204162056835-527302775.png"></p>
<p>&nbsp; &nbsp; &nbsp; è¿äºæµè¯å·¥ä½æ¯æ¯è¾å¤æçï¼ä¸ºäºæ¹ä¾¿æµè¯å¼åäºä¸ä¸ªæµè¯å·¥å·ï¼ä¸»è¦æµè¯å¤ä¸ªæä½æ¯å¦å¼é­äºä¸æ¬¡æ°æ®åºï¼æ°æ®åºäºå¡æ¯å¦è½æ­£å¸¸åæ»ç­ãå¨æ§è¡æ°æ®åºæä½æ¶ä¸ºæ¯æ¬¡æ°æ®åºè¿æ¥å®ä¹ä¸ä¸ªéæºæ°ï¼ä»æ°æ®åºè¿æ¥æå¼å°å³é­ï¼ææçæ°æ®åºæä½é½è¿åè¿ä¸ªéæºæ°ï¼å¦æéæºæ°ä¸ä¸æ ·ï¼è¯´æä¸æ¯å¨ä¸ä¸ªæ°æ®åºè¿æ¥ä¸­å®æçæä½ãå¦ä¸å¾ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/34454/202602/34454-20260204162055237-1397352915.png"></p>
<p><img src="https://img2024.cnblogs.com/blog/34454/202602/34454-20260204162052854-1127795205.png"></p>
<p>&nbsp; &nbsp; &nbsp; ä¸é¢ä»ç»çè¿äºåè½ï¼æ¯æ°æ®åºæä½çåºæ¬åè½ï¼æäºè¿äºå°±å¯ä»¥å®ææ°æ®åºçå¢å æ¹æ¥äºãä½æ¯å¦æå¯¹ä¸ä¸ªå¼åå¹³å°æ¥è¯´ï¼è¿äºè¿ä¸å¤ï¼ä¸ä¸ªå¼åå¹³å°ï¼è¿éè¦ææ°æ®åºç»´æ¤çåè½ï¼å³åæ°æ®æä½çåè½ï¼æ¯å¦åå»ºè¡¨ãåå»ºå­æ®µãä¿®æ¹å­æ®µï¼è·åè¡¨ç»æç­ãè¿äºåè½ä¹è¦å¨æ°æ®åºè®¿é®å±ä¸­å®ç°ãä¸ä¸ªå®æ´çæ°æ®åºè®¿é®å±åºè¯¥åæ¬ä¸ä¸åè½ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/34454/202602/34454-20260204162053674-1995650034.png"></p>
<p>&nbsp; &nbsp; &nbsp; ä»¥ä¸æ¯å¯¹æ°æ®è®¿é®å±çä¸ç¹æµæµçè®¤è¯ï¼ä¸æ­£ç¡®çå°æ¹æ¬¢è¿æ¹è¯ææ­£ï¼å¾æå¾ä¸åè¡ä»¬çäº¤æµãæ·è¿çæ°´ï¼èµ°è¿çè·¯ï¼è¸©è¿çååäº«åºæ¥ï¼å±åæé«è¿æ­¥ï¼</p>

</div>
<div id="MySignature" role="contentinfo">
    æçç¨åºäººç
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0006944444444444445" data-date-updated="2026-02-04 16:24">2026-02-04 16:23</span>&nbsp;
<a href="https://www.cnblogs.com/legweifang">äºé£æ¬</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19575087);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19575087', targetLink: 'https://www.cnblogs.com/legweifang/p/19575087', title: 'æµè°æ°æ®è®¿é®å±' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Apache SeaTunnel ZetaãFlinkãSpark æä¹éï¼åºå±åç + å®æå¯¹æ¯ä¸æ¬¡è®²é ]]></title>
    <link>https://www.cnblogs.com/seatunnel/p/19575007</link>
    <guid>9d1165f7352369d3464c98b4224558bf</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/seatunnel/p/19575007" title="åå¸äº 2026-02-04 16:05">
    <span role="heading" aria-level="2">Apache SeaTunnel ZetaãFlinkãSpark æä¹éï¼åºå±åç + å®æå¯¹æ¯ä¸æ¬¡è®²é</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬ææ¡£å°æ·±å¥è§£æ Apache SeaTunnel æ¯æçä¸å¤§æ§è¡å¼æï¼Zeta (SeaTunnel Engine)ãFlink å Sparkãæä»¬å°ä»æ¶æè®¾è®¡ãæ ¸å¿ç¹æ§ãä¼ç¼ºç¹å¯¹æ¯ä»¥åä½¿ç¨æ¹æ³ç­å¤ä¸ªç»´åº¦è¿è¡è¯¦ç»è®²è§£ï¼å¸®å©ä½ æ ¹æ®ä¸å¡éæ±éæ©æåéçå¼æã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p><img alt="å¯¹æ¯" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3195851/202602/3195851-20260204160419017-1851955102.png" class="lazyload"></p>
<p>æ¬ææ¡£å°æ·±å¥è§£æ Apache SeaTunnel æ¯æçä¸å¤§æ§è¡å¼æï¼<strong>Zeta (SeaTunnel Engine)</strong>ã<strong>Flink</strong> å <strong>Spark</strong>ãæä»¬å°ä»æ¶æè®¾è®¡ãæ ¸å¿ç¹æ§ãä¼ç¼ºç¹å¯¹æ¯ä»¥åä½¿ç¨æ¹æ³ç­å¤ä¸ªç»´åº¦è¿è¡è¯¦ç»è®²è§£ï¼å¸®å©ä½ æ ¹æ®ä¸å¡éæ±éæ©æåéçå¼æã</p>
<h2 id="1-å¼ææ¦è§">1. å¼ææ¦è§</h2>
<p>SeaTunnel çæ¶æè®¾è®¡éç¨äº <strong>API ä¸æ§è¡å¼æè§£è¦</strong> çç­ç¥ãè¿æå³çåä¸å¥æ°æ®åæ­¥é»è¾ï¼Configï¼å¯ä»¥æ ç¼è¿è¡å¨ä¸åçå¼æä¸ã</p>
<ul>
<li><strong>Zeta Engine</strong>: SeaTunnel ç¤¾åºä¸é¨ä¸ºæ°æ®éæåºæ¯èªç çæ°ä¸ä»£å¼æï¼ä¸æ³¨äºé«æ§è½ãä½å»¶è¿çæ°æ®åæ­¥ã</li>
<li><strong>Flink Engine</strong>: å©ç¨ Flink å¼ºå¤§çæµå¤çè½åï¼éåå·²æ¥æ Flink éç¾¤çç¨æ·ã</li>
<li><strong>Spark Engine</strong>: å©ç¨ Spark å¼ºå¤§çæ¹å¤çè½åï¼éåç¦»çº¿å¤§è§æ¨¡æ°æ®å¤çåºæ¯ã</li>
</ul>
<h2 id="2-zeta-å¼ææ ¸å¿æ¨è">2. Zeta å¼æââæ ¸å¿æ¨è</h2>
<p>Zeta æ¯ç®å SeaTunnel ç¤¾åºä¸»æ¨çé»è®¤å¼æãå®æ¨å¨è§£å³ Flink/Spark å¨ç®åæ°æ®åæ­¥åºæ¯ä¸âèµæºæ¶èå¤§ãé¨ç½²è¿ç»´éâçé®é¢ã</p>
<h3 id="21-æ ¸å¿æ¶æ">2.1 æ ¸å¿æ¶æ</h3>
<p>Zeta éç¨æ ä¸­å¿åï¼Decentralizedï¼æ Master-Slave æ¶æï¼åå³äºé¨ç½²æ¨¡å¼ï¼ï¼ä¸»è¦åå«ä»¥ä¸ç»ä»¶ï¼</p>
<ul>
<li><strong>Coordinator (Master)</strong>:
<ul>
<li><strong>ä½ä¸è§£æ</strong>: å°é»è¾ DAG (Logical DAG) è½¬æ¢ä¸ºç©ç DAG (Physical DAG)ã</li>
<li><strong>èµæºè°åº¦</strong>: ç®¡ç Slotï¼å Worker åéä»»å¡ã</li>
<li><strong>Checkpoint Coordinator</strong>: è´è´£è§¦åååè°åå¸å¼å¿«ç§ï¼åºäº Chandy-Lamport ç®æ³ï¼ï¼ä¿éæ°æ®ä¸è´æ§ã</li>
</ul>
</li>
<li><strong>Worker (Slave)</strong>:
<ul>
<li><strong>Task Execution</strong>: è¿è¡ Source, Transform, Sink ä»»å¡ã</li>
<li><strong>Data Transport</strong>: è´è´£èç¹é´çæ°æ®ä¼ è¾ã</li>
</ul>
</li>
<li><strong>ResourceManager</strong>: æ¯æ Standalone, YARN, Kubernetes ç­å¤ç§èµæºç®¡çæ¨¡å¼ã</li>
</ul>
<p><img alt="SeaTunnel Engine" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3195851/202602/3195851-20260204160419144-538520599.png" class="lazyload"></p>
<h3 id="22-å³é®ç¹æ§">2.2 å³é®ç¹æ§</h3>
<ol>
<li><strong>Pipeline çº§å®¹é (Pipeline-level Fault Tolerance)</strong>:
<ul>
<li>ä¸åäº Flink çâå¨å¾éå¯âï¼Zeta å¯ä»¥åªéå¯å¤±è´¥ç Pipelineï¼ä¾å¦å¤è¡¨åæ­¥ä¸­ï¼è¡¨ A å¤±è´¥ä¸å½±åè¡¨ Bï¼ã</li>
</ul>
</li>
<li><strong>å¢éå¿«ç§ (Incremental Checkpoint)</strong>:
<ul>
<li>æ¯æé«é¢ Checkpointï¼æå°åæ°æ®ä¸¢å¤±é£é©ï¼åæ¶å¯¹æ§è½å½±åæå°ã</li>
</ul>
</li>
<li><strong>å¨ææ©ç¼©å®¹ (Dynamic Scaling)</strong>:
<ul>
<li>æ¯æå¨ä½ä¸è¿è¡æ¶å¨æå¢å æåå° Worker èç¹ï¼æ ééå¯ä½ä¸ã</li>
</ul>
</li>
<li><strong>Schema Evolution (è¡¨ç»æåæ´)</strong>:
<ul>
<li>åçæ¯æ DDL åæ´åæ­¥ï¼å¦ Add Columnï¼ï¼è¿å¯¹ CDC åºæ¯è³å³éè¦ã</li>
</ul>
</li>
</ol>
<h3 id="23-ä½¿ç¨æå">2.3 ä½¿ç¨æå</h3>
<p>Zeta å¼æéå¸¸åå«å¨ SeaTunnel çäºè¿å¶åä¸­ï¼å¼ç®±å³ç¨ã</p>
<p><strong>å¯å¨å½ä»¤ (Local æ¨¡å¼ - å¼åæµè¯):</strong></p>
<pre><code class="language-bash">./bin/seatunnel.sh --config ./config/your_job.conf -e local
</code></pre>
<p><strong>å¯å¨å½ä»¤ (Cluster æ¨¡å¼ - çäº§ç¯å¢):</strong></p>
<ol>
<li>å¯å¨ Server (Master/Worker):<pre><code class="language-bash">./bin/seatunnel-cluster.sh -d
</code></pre>
</li>
<li>æäº¤ä»»å¡å°éç¾¤:<pre><code class="language-bash">./bin/seatunnel.sh --config ./config/your_job.conf -e cluster
</code></pre>
</li>
</ol>
<h2 id="3-flink-å¼æ">3. Flink å¼æ</h2>
<p><img alt="flink-1_highres" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3195851/202602/3195851-20260204160419170-1840939353.png" class="lazyload"></p>
<p>SeaTunnel éè¿ç¿»è¯å±ï¼Translation Layerï¼å°åé¨ç Source/Sink API ééä¸º Flink ç <code>SourceFunction</code> / <code>SinkFunction</code> (æ Flink æ°ç Source/Sink API)ã</p>
<h3 id="31-æ¶æåç">3.1 æ¶æåç</h3>
<ul>
<li><strong>Translation</strong>: SeaTunnel å¨ Client ç«¯å° Config è§£æå¹¶ç¿»è¯æ Flink JobGraphã</li>
<li><strong>Execution</strong>: æäº¤ç» Flink Cluster æ§è¡ãæ­¤æ¶ï¼SeaTunnel ä»»å¡å°±æ¯ä¸ä¸ªæ åç Flink ä»»å¡ã</li>
<li><strong>State Backend</strong>: ä¾èµ Flink ç Checkpoint æºå¶ï¼RocksDB/FsStateBackendï¼ç®¡çç¶æã</li>
</ul>
<h3 id="32-ä¼ç¼ºç¹">3.2 ä¼ç¼ºç¹</h3>
<ul>
<li><strong>ä¼ç¹</strong>: çææçï¼è¿ç»´å·¥å·ä¸°å¯ï¼éåå¤æçæµå¼è®¡ç®+åæ­¥åºæ¯ã</li>
<li><strong>ç¼ºç¹</strong>: çæ¬è¦åä¸¥éï¼ééé Flink 1.13-1.18 ç­ä¸åçæ¬ï¼ï¼å¯¹äºçº¯åæ­¥ä»»å¡æ¾å¾è¿éã</li>
</ul>
<h3 id="33-ä½¿ç¨æå">3.3 ä½¿ç¨æå</h3>
<p>éè¦ä¸è½½å¯¹åºç <code>seatunnel-flink-starter</code> jar åï¼å¹¶ç¡®ä¿ Flink ç¯å¢å·²åå¤å¥½ã</p>
<p><strong>å¯å¨å½ä»¤ (Flink 1.13+):</strong></p>
<pre><code class="language-bash">./bin/start-seatunnel-flink-13-connector-v2.sh \
    --config ./config/your_job.conf \
    --run-mode run # æ run-application
</code></pre>
<p><em>(æ³¨æï¼ä¸å Flink çæ¬èæ¬åç§°ç¥æä¸åï¼å¦ <code>flink-15</code>, <code>flink-18</code>)</em></p>
<h2 id="4-spark-å¼æ">4. Spark å¼æ</h2>
<p><img alt="spark" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3195851/202602/3195851-20260204160419002-731834434.png" class="lazyload"></p>
<p>ç±»ä¼¼äº Flinkï¼SeaTunnel å° Source/Sink ééä¸º Spark ç <code>DataSource V2</code> APIã</p>
<h3 id="41-æ¶æåç">4.1 æ¶æåç</h3>
<ul>
<li><strong>Batch</strong>: ä½¿ç¨ Spark RDD / DataFrame API æ§è¡ç¦»çº¿æ¹å¤çã</li>
<li><strong>Streaming</strong>: ä½¿ç¨ Spark Streaming (Micro-batch) æ§è¡æµå¼å¤çã</li>
</ul>
<h3 id="42-ä¼ç¼ºç¹">4.2 ä¼ç¼ºç¹</h3>
<ul>
<li><strong>ä¼ç¹</strong>: æ¹å¤çæ§è½å¼ºå¤§ï¼å¨å¤§è§æ¨¡ç¦»çº¿æ°æ®æ¸æ´/ETL åºæ¯è¡¨ç°ä¼å¼ã</li>
<li><strong>ç¼ºç¹</strong>: æµå¤çåºäºå¾®æ¹ï¼Micro-batchï¼ï¼å»¶è¿éå¸¸é«äº Flink/Zetaï¼èµæºè°åº¦è¾æ¢ã</li>
</ul>
<h3 id="43-ä½¿ç¨æå">4.3 ä½¿ç¨æå</h3>
<p>éè¦ä¸è½½å¯¹åºç <code>seatunnel-spark-starter</code> jar åã</p>
<p><strong>å¯å¨å½ä»¤ (Spark 3.x):</strong></p>
<pre><code class="language-bash">./bin/start-seatunnel-spark-3-connector-v2.sh \
    --config ./config/your_job.conf \
    --master local[4] # æ yarn, k8s
</code></pre>
<h2 id="5-ä¸å¤§å¼æå¨æ¹ä½å¯¹æ¯">5. ä¸å¤§å¼æå¨æ¹ä½å¯¹æ¯</h2>
<table>
<thead>
<tr>
<th style="text-align: left">ç¹æ§</th>
<th style="text-align: left">Zeta (SeaTunnel Engine)</th>
<th style="text-align: left">Flink Engine</th>
<th style="text-align: left">Spark Engine</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>å®ä½</strong></td>
<td style="text-align: left"><strong>æ°æ®åæ­¥ä¸ç¨</strong></td>
<td style="text-align: left">éç¨æµæ¹è®¡ç®</td>
<td style="text-align: left">éç¨æ¹æµè®¡ç®</td>
</tr>
<tr>
<td style="text-align: left"><strong>éç¨åºæ¯</strong></td>
<td style="text-align: left">æµ·éæ°æ®éæãCDC å®æ¶åæ­¥ãå¤è¡¨æ´åºåæ­¥</td>
<td style="text-align: left">å¤ææµå¼è®¡ç® + åæ­¥</td>
<td style="text-align: left">å¤§è§æ¨¡ç¦»çº¿æ¸æ´ãETL</td>
</tr>
<tr>
<td style="text-align: left"><strong>é¨ç½²å¤æåº¦</strong></td>
<td style="text-align: left"><strong>ä½</strong> (åç½®ï¼å¼ç®±å³ç¨)</td>
<td style="text-align: left">ä¸­ (éç»´æ¤ Flink éç¾¤)</td>
<td style="text-align: left">ä¸­ (éç»´æ¤ Spark éç¾¤)</td>
</tr>
<tr>
<td style="text-align: left"><strong>èµæºæ¶è</strong></td>
<td style="text-align: left"><strong>ä½</strong> (éå¯¹åæ­¥ä¼åï¼æ å¤ä½å¼é)</td>
<td style="text-align: left">ä¸­/é«</td>
<td style="text-align: left">ä¸­/é«</td>
</tr>
<tr>
<td style="text-align: left"><strong>å»¶è¿</strong></td>
<td style="text-align: left"><strong>ä½</strong> (å®æ¶æµ)</td>
<td style="text-align: left">ä½ (å®æ¶æµ)</td>
<td style="text-align: left">ä¸­ (å¾®æ¹)</td>
</tr>
<tr>
<td style="text-align: left"><strong>å®¹éç²åº¦</strong></td>
<td style="text-align: left"><strong>Pipeline çº§</strong> (å±é¨éå¯)</td>
<td style="text-align: left">Job çº§ (å¨å±éå¯)</td>
<td style="text-align: left">Stage/Task çº§</td>
</tr>
<tr>
<td style="text-align: left"><strong>CDC æ¯æ</strong></td>
<td style="text-align: left"><strong>å®ç¾</strong> (æ¯æ Schema Evolution)</td>
<td style="text-align: left">è¯å¥½</td>
<td style="text-align: left">ä¸è¬</td>
</tr>
<tr>
<td style="text-align: left"><strong>å¤çæ¬éé</strong></td>
<td style="text-align: left">æ ééé (èªå¸¦)</td>
<td style="text-align: left">éä¸¥æ ¼å¹é Flink çæ¬</td>
<td style="text-align: left">éä¸¥æ ¼å¹é Spark çæ¬</td>
</tr>
</tbody>
</table>
<h2 id="6-å¦ä½éæ©">6. å¦ä½éæ©ï¼</h2>
<ol>
<li>
<p><strong>å¦æä½ æ¯æ°é¡¹ç®ï¼æèä¸»è¦éæ±æ¯æ°æ®åæ­¥ (Data Integration)</strong>:</p>
<ul>
<li>ð <strong>é¦é Zeta å¼æ</strong>ãå®æè½»éãæ§è½æå¥½ï¼ä¸å¯¹ CDC åå¤è¡¨åæ­¥æç¹æ®ä¼åã</li>
</ul>
</li>
<li>
<p><strong>å¦æä½ å·²ç»æç°æç Flink/Spark éç¾¤ï¼ä¸è¿ç»´å¢éä¸æ³ç»´æ¤æ°å¼æ</strong>:</p>
<ul>
<li>ð éæ© <strong>Flink</strong> æ <strong>Spark</strong> å¼æï¼å¤ç¨ç°æåºç¡è®¾æ½ã</li>
</ul>
</li>
<li>
<p><strong>å¦æä½ çä»»å¡åå«æå¶å¤æçèªå®ä¹è®¡ç®é»è¾ (Complex Computation)</strong>:</p>
<ul>
<li>ð ä¼åèè <strong>Flink</strong> (æµ) æ <strong>Spark</strong> (æ¹)ï¼å©ç¨å¶ä¸°å¯çç®å­çæãä½ä¹å¯ä»¥èè <strong>Zeta + SQL Transform</strong> æ»¡è¶³å¤§é¨åéæ±ã</li>
</ul>
</li>
</ol>
<h2 id="7-æ°æå¥é¨æå">7. æ°æå¥é¨æå</h2>
<p>å¦æä½ æ¯ç¬¬ä¸æ¬¡æ¥è§¦ SeaTunnelï¼è¯·æç§ä»¥ä¸æ­¥éª¤å¿«éä½éª Zeta å¼æçå¼ºå¤§åè½ã</p>
<h3 id="71-ç¯å¢åå¤">7.1 ç¯å¢åå¤</h3>
<p>ç¡®ä¿ä½ çæºå¨ä¸å®è£äº Java 8 æ Java 11ã</p>
<pre><code class="language-bash">java -version
</code></pre>
<h3 id="72-ä¸è½½ä¸å®è£">7.2 ä¸è½½ä¸å®è£</h3>
<ol>
<li><strong>ä¸è½½</strong>: ä» <a href="https://seatunnel.apache.org/download" target="_blank" rel="noopener nofollow">Apache SeaTunnel å®ç½</a> ä¸è½½ææ°çæ¬çäºè¿å¶å (<code>apache-seatunnel-x.x.x-bin.tar.gz</code>)ã</li>
<li><strong>è§£å</strong>:<pre><code class="language-bash">tar -zxvf apache-seatunnel-*.tar.gz
cd apache-seatunnel-*
</code></pre>
</li>
</ol>
<h3 id="73-å®è£-connector-æä»¶-éè¦">7.3 å®è£ Connector æä»¶ (éè¦!)</h3>
<p><strong>è¿æ¯æ°ææå®¹æå¿½ç¥çä¸æ­¥</strong>ãé»è®¤åä¸åå«ææ Connectorï¼ä½ éè¦è¿è¡èæ¬èªå¨ä¸è½½ã</p>
<pre><code class="language-bash"># èªå¨å®è£ plugin_config éç½®æä»¶ä¸­å®ä¹çæææä»¶
sh bin/install-plugin.sh
</code></pre>
<h3 id="74-å¿«éè¿è¡ç¬¬ä¸ä¸ªä»»å¡">7.4 å¿«éè¿è¡ç¬¬ä¸ä¸ªä»»å¡</h3>
<p>åå»ºä¸ä¸ªç®åçéç½®æä»¶ <code>config/quick_start.conf</code>ï¼å°æ°æ®ä» Fake æºçæå¹¶æå°å°æ§å¶å°ï¼</p>
<pre><code class="language-hocon">env {
  execution.parallelism = 1
  job.mode = "BATCH"
}

source {
  FakeSource {
    result_table_name = "fake"
    row.num = 100
    schema = {
      fields {
        name = "string"
        age = "int"
      }
    }
  }
}

transform {
  # ç®åç SQL å¤ç
  Sql {
    source_table_name = "fake"
    result_table_name = "sql_result"
    query = "select name, age from fake where age &gt; 50"
  }
}

sink {
  Console {
    source_table_name = "sql_result"
  }
}
</code></pre>
<p><strong>è¿è¡ä»»å¡ (Local æ¨¡å¼)</strong>:</p>
<pre><code class="language-bash">./bin/seatunnel.sh --config ./config/quick_start.conf -e local
</code></pre>
<p>å¦æçå°æ§å¶å°è¾åºäºæ°æ®è¡¨æ ¼ï¼æ­åä½ ï¼ä½ å·²ç»æåææ¡äº SeaTunnel çåºæ¬ç¨æ³ï¼</p>
<h2 id="8-zeta-å¼æåçæ·±åº¦å­¦ä¹ è·¯å¾">8. Zeta å¼æåçæ·±åº¦å­¦ä¹ è·¯å¾</h2>
<p>å¦æä½ å¸ææ·±å¥äºè§£ Zeta å¼æçåé¨è¿ä½æºå¶ï¼æèæ³åä¸ç¤¾åºè´¡ç®ï¼å¯ä»¥æç§ä»¥ä¸è·¯å¾è¿è¡æºç éè¯»åè°è¯ã</p>
<h3 id="81-æ ¸å¿æ¨¡åæ¦è§">8.1 æ ¸å¿æ¨¡åæ¦è§</h3>
<p>Zeta å¼æçä»£ç ä¸»è¦éä¸­å¨ <code>seatunnel-engine</code> æ¨¡åä¸ï¼</p>
<ul>
<li><strong>seatunnel-engine-core</strong>: å®ä¹äºæ ¸å¿æ°æ®ç»æï¼å¦ <code>Job</code>, <code>Task</code>ï¼åéä¿¡åè®®ã</li>
<li><strong>seatunnel-engine-server</strong>: åå«äº Coordinator å Worker çå·ä½å®ç°é»è¾ã</li>
<li><strong>seatunnel-engine-client</strong>: å®¢æ·ç«¯æäº¤é»è¾ã</li>
</ul>
<h3 id="82-æºç éè¯»æ¨èè·¯å¾">8.2 æºç éè¯»æ¨èè·¯å¾</h3>
<h4 id="1-ä½ä¸æäº¤ä¸è§£æ-coordinator-ä¾§">1. ä½ä¸æäº¤ä¸è§£æ (Coordinator ä¾§)</h4>
<p>ä» <code>JobMaster</code> ç±»å¼å§ï¼äºè§£ä½ä¸æ¯å¦ä½è¢«æ¥æ¶ååå§åçã</p>
<ul>
<li><strong>å¥å£</strong>: <code>org.apache.seatunnel.engine.server.master.JobMaster</code></li>
<li><strong>é»è¾</strong>: å³æ³¨ <code>init</code> å <code>run</code> æ¹æ³ï¼äºè§£ <code>LogicalDag</code> å° <code>PhysicalPlan</code> çè½¬æ¢è¿ç¨ã</li>
</ul>
<h4 id="2-ä»»å¡æ§è¡-worker-ä¾§">2. ä»»å¡æ§è¡ (Worker ä¾§)</h4>
<p>äºè§£ Task æ¯å¦ä½è¢«è°åº¦åæ§è¡çã</p>
<ul>
<li><strong>æå¡å¥å£</strong>: <a href="seatunnel-engine/seatunnel-engine-server/src/main/java/org/apache/seatunnel/engine/server/TaskExecutionService.java" target="_blank" rel="noopener nofollow">TaskExecutionService.java</a>
<ul>
<li>è¯¥ç±»è´è´£ç®¡ç Worker èç¹ä¸çææ TaskGroupã</li>
</ul>
</li>
<li><strong>æ§è¡ä¸ä¸æ</strong>: <code>org.apache.seatunnel.engine.server.execution.TaskExecutionContext</code></li>
</ul>
<h4 id="3-checkpoint-æºå¶-æ ¸å¿é¾ç¹">3. Checkpoint æºå¶ (æ ¸å¿é¾ç¹)</h4>
<p>Zeta çå¿«ç§æºå¶æ¯ä¿è¯æ°æ®ä¸è´æ§çå³é®ã</p>
<ul>
<li><strong>åè°å¨</strong>: <a href="seatunnel-engine/seatunnel-engine-server/src/main/java/org/apache/seatunnel/engine/server/checkpoint/CheckpointCoordinator.java" target="_blank" rel="noopener nofollow">CheckpointCoordinator.java</a>
<ul>
<li>éç¹éè¯» <code>triggerCheckpoint</code> æ¹æ³ï¼äºè§£ Barrier æ¯å¦ä½ååçã</li>
</ul>
</li>
<li><strong>è®¡å</strong>: <a href="seatunnel-engine/seatunnel-engine-server/src/main/java/org/apache/seatunnel/engine/server/checkpoint/CheckpointPlan.java" target="_blank" rel="noopener nofollow">CheckpointPlan.java</a>
<ul>
<li>äºè§£ Checkpoint æ¶åçä»»å¡èå´æ¯å¦ä½è®¡ç®çã</li>
</ul>
</li>
</ul>
<h3 id="83-è°è¯æå·§">8.3 è°è¯æå·§</h3>
<ol>
<li><strong>ä¿®æ¹æ¥å¿çº§å«</strong>: å¨ <code>config/log4j2.properties</code> ä¸­ï¼å° <code>org.apache.seatunnel</code> ççº§å«è°æ´ä¸º <code>DEBUG</code>ï¼å¯ä»¥çå°è¯¦ç»ç RPC éä¿¡åç¶æåæ´æ¥å¿ã</li>
<li><strong>æ¬å°è°è¯</strong>: å¨ IDE ä¸­ç´æ¥è¿è¡ <code>org.apache.seatunnel.core.starter.seatunnel.SeaTunnelStarter</code> ç±»ï¼ä¼ å¥ <code>-c config/your_job.conf -e local</code> åæ°ï¼å³å¯æ­ç¹è°è¯æ´ä¸ªæµç¨ã</li>
</ol>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 16:05">2026-02-04 16:05</span>&nbsp;
<a href="https://www.cnblogs.com/seatunnel">ApacheSeaTunnel</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19575007);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19575007', targetLink: 'https://www.cnblogs.com/seatunnel/p/19575007', title: 'Apache SeaTunnel ZetaãFlinkãSpark æä¹éï¼åºå±åç + å®æå¯¹æ¯ä¸æ¬¡è®²é' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä»é¶å¼å§å­¦Flinkï¼ç¶æç®¡çä¸å®¹éæºå¶ ]]></title>
    <link>https://www.cnblogs.com/daimajiangxin/p/19574902</link>
    <guid>06a586ef75a282bf2888b91b1befe913</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/daimajiangxin/p/19574902" title="åå¸äº 2026-02-04 15:48">
    <span role="heading" aria-level="2">ä»é¶å¼å§å­¦Flinkï¼ç¶æç®¡çä¸å®¹éæºå¶</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3365149/202602/3365149-20260204154757186-1959035735.png" alt="ä»é¶å¼å§å­¦Flinkï¼ç¶æç®¡çä¸å®¹éæºå¶" class="desc_img">
        æ¬ææ·±å¥è§£æ Apache Flink çæ ¸å¿ç¹æ§ââç¶æç®¡çï¼State Managementï¼ä¸å®¹éæºå¶ï¼Fault Toleranceï¼ï¼æ¶µçç¶æç±»åãState Backend éæ©ãCheckpoint åçåéç½®ãä»¥å Savepoint ççäº§å®è·µã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æµå¼è®¡ç®ä»»å¡éå¸¸éè¦ 7x24 å°æ¶é¿æè¿è¡ï¼é¢å¯¹ç½ç»æå¨ãæºå¨æéæä»£ç  Bugï¼å¦ä½ä¿è¯ä»»å¡ä¸æï¼æèæäºä¹åè½èªå¨æ¢å¤ä¸æ°æ®ä¸ä¸¢ãä¸éï¼è¿æ­£æ¯ Flink å¼ä»¥ä¸ºå²çèµæ¬ï¼<strong>å¼ºå¤§çç¶æç®¡ç</strong>ä¸<strong>åºäº Checkpoint çå®¹éæºå¶</strong>ã</p>
<p>æ¬æå°å¸¦ä½ æ·±å¥çè§£ Flink æ¯å¦ä½âè®°å¿âæ°æ®çï¼ä»¥åå®æ¯å¦ä½å¨æéåçæ¶âæ¶ååæµâæ¢å¤ç°åºçã</p>
<h2 id="ä¸ä»ä¹æ¯ç¶æstate">ä¸ãä»ä¹æ¯ç¶æï¼Stateï¼</h2>
<p>å¨æµè®¡ç®ä¸­ï¼æ°æ®æ¯ä¸æ¡æ¡æµè¿çãå¦æå¤çä¸æ¡æ°æ®æ¶ï¼éè¦ä¾èµ<strong>ä¹å</strong>çæ°æ®ï¼ä¾å¦ï¼è®¡ç®è¿å»ä¸å°æ¶çæ»åãå»éãæ¨¡å¼å¹éï¼ï¼é£ä¹è¿äºâä¹åçæ°æ®âæâä¸­é´è®¡ç®ç»æâå°±æ¯<strong>ç¶æ</strong>ã</p>
<h3 id="1-ç¶æçåç±»">1. ç¶æçåç±»</h3>
<p>Flink çç¶æåä¸ºä¸¤å¤§ç±»ï¼<strong>Managed Stateï¼æç®¡ç¶æï¼</strong> å <strong>Raw Stateï¼åçç¶æï¼</strong>ãæä»¬æ¥å¸¸å¼å 99% ä½¿ç¨çæ¯æç®¡ç¶æï¼ç± Flink è¿è¡æ¶èªå¨ç®¡çåå­ãåºåååæéæ¢å¤ã</p>
<p>Managed State åç»åä¸ºï¼</p>
<ul>
<li><strong>Keyed Stateï¼é®æ§ç¶æï¼</strong>
<ul>
<li>åªè½å¨ <code>KeyedStream</code>ï¼å³ <code>keyBy</code> ä¹åï¼ä¸ä½¿ç¨ã</li>
<li>ç¶ææ¯è· Key ç»å®çãFlink ä¸ºæ¯ä¸ª Key ç»´æ¤ä¸ä»½ç¬ç«çç¶æå®ä¾ã</li>
<li>å¸¸ç¨ç±»åï¼<code>ValueState</code>ã<code>ListState</code>ã<code>MapState</code>ã<code>ReducingState</code>ã<code>AggregatingState</code>ã</li>
</ul>
</li>
<li><strong>Operator Stateï¼ç®å­ç¶æï¼</strong>
<ul>
<li>ç»å®å°ç®å­å¹¶è¡å®ä¾ï¼SubTaskï¼ï¼ä¸ Key æ å³ã</li>
<li>å¸¸ç¨äº Source Connectorï¼è®°å½è¯»åç Offsetï¼æ Sink Connectorï¼äºå¡æ§å¶ï¼ã</li>
<li>å¸¸ç¨æ¥å£ï¼<code>ListState</code>ã<code>UnionListState</code>ã<code>BroadcastState</code>ã</li>
</ul>
</li>
</ul>
<h2 id="äºç¶æåç«¯state-backends">äºãç¶æåç«¯ï¼State Backendsï¼</h2>
<p>ç¶æå­å¨åªéï¼æ¯åå­è¿æ¯ç£çï¼è¿ç± <strong>State Backend</strong> å³å®ãå¨ Flink 1.13 ä¹åï¼éç½®æ¹å¼ç®åä¸ºä»¥ä¸ä¸¤ç§ä¸»è¦æ¨¡å¼ï¼</p>
<h3 id="1-hashmapstatebackend-åºäºåå­">1. HashMapStateBackend (åºäºåå­)</h3>
<ul>
<li><strong>å­å¨ä½ç½®</strong>ï¼Java å åå­ï¼Heapï¼ã</li>
<li><strong>ç¹ç¹</strong>ï¼è¯»åéåº¦æå¿«ï¼å¯¹è±¡ç´æ¥è®¿é®ï¼æ åºååå¼éï¼ã</li>
<li><strong>éç¨åºæ¯</strong>ï¼ç¶æè¾å°ï¼ä¾å¦ä»ä»æ¯ç®åç Count æå»éï¼ï¼å¯¹å»¶è¿æå¶ææçåºæ¯ã</li>
<li><strong>ç¼ºç¹</strong>ï¼åéäº JVM å å¤§å°ï¼å®¹æ GCï¼ç¶æè¿å¤§æ¶å¯è½ OOMã</li>
</ul>
<h3 id="2-embeddedrocksdbstatebackend-åºäºç£ç">2. EmbeddedRocksDBStateBackend (åºäºç£ç)</h3>
<ul>
<li><strong>å­å¨ä½ç½®</strong>ï¼TaskManager æ¬å°ç£çï¼åºäº RocksDB æ°æ®åºï¼ï¼åå­ä¸­åªä½ä¸ºç¼å­ï¼Off-heapï¼ã</li>
<li><strong>ç¹ç¹</strong>ï¼æ¯æè¶å¤§ç¶æï¼TB çº§å«ï¼ï¼ä¸å JVM å éå¶ã</li>
<li><strong>éç¨åºæ¯</strong>ï¼è¶å¤§çªå£ãè¶é¿å¨æçèåãæµ·é Key çå»éã</li>
<li><strong>ç¼ºç¹</strong>ï¼éè¦åºåå/ååºååï¼è¯»åæ§è½ç¥ä½äºåå­çï¼éè¦è°ä¼ RocksDB åæ°ã</li>
</ul>
<h3 id="3-éç½®ç¤ºä¾">3. éç½®ç¤ºä¾</h3>
<pre><code class="language-java">StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();

// è®¾ç½®ç¶æåç«¯ä¸º RocksDB
env.setStateBackend(new EmbeddedRocksDBStateBackend());

// éå Checkpoint å­å¨è·¯å¾ï¼å­å¨å¨æ¬å°æä»¶ç³»ç»ï¼
env.getCheckpointConfig().setCheckpointStorage("file:///tmp/flink/checkpoints");
</code></pre>
<h2 id="ä¸å®¹éæ ¸å¿checkpoint">ä¸ãå®¹éæ ¸å¿ï¼Checkpoint</h2>
<p>Checkpointï¼æ£æ¥ç¹ï¼æ¯ Flink å®¹éæºå¶ççµé­ãå®æ¯ä¸ä¸ª<strong>å¨å±ä¸è´æ§å¿«ç§</strong>ï¼å®æå°ææç®å­çç¶ææä¹åå°è¿ç¨å­å¨ï¼å¦ HDFSï¼ã</p>
<h3 id="1-æ ¸å¿åçbarrier-å¯¹é½">1. æ ¸å¿åçï¼Barrier å¯¹é½</h3>
<p>Flink ä½¿ç¨ <strong>Chandy-Lamport ç®æ³</strong> çåä½ã</p>
<ol>
<li><strong>Barrier æ³¨å¥</strong>ï¼JobManager å Source åé Checkpoint Barrierã</li>
<li><strong>Barrier æµå¨</strong>ï¼Barrier åæ®éæ°æ®ä¸æ ·å¨æµä¸­ä¼ è¾ã</li>
<li><strong>å¯¹é½ï¼Alignmentï¼</strong>ï¼å½ç®å­æå¤ä¸ªè¾å¥æµæ¶ï¼å¿é¡»ç­å¾æææµç Barrier å°é½ï¼æè½è¿è¡ Snapshotãè¿ä¿è¯äºç¶æçä¸è´æ§ï¼å³ Exactly-Onceï¼ã</li>
<li><strong>å¼æ­¥å¿«ç§</strong>ï¼ç®å­å°ç¶æåå¥è¿ç¨å­å¨ï¼å¼æ­¥è¿ç¨ï¼ï¼ä¸é»å¡æ°æ®å¤çã</li>
<li><strong>ç¡®è®¤å®æ</strong>ï¼ææç®å­é½å®æå¿«ç§åï¼JobManager ç¡®è®¤ Checkpoint æåã</li>
</ol>
<h3 id="2-checkpoint-éç½®å®æ">2. Checkpoint éç½®å®æ</h3>
<p>é»è®¤æåµä¸ Checkpoint æ¯å³é­çï¼çäº§ç¯å¢<strong>å¿é¡»å¼å¯</strong>ã</p>
<pre><code class="language-java">// 1. å¼å¯ Checkpointï¼æ¯ 5000ms è§¦åä¸æ¬¡
env.enableCheckpointing(5000);

// 2. è®¾ç½® Checkpoint æ¨¡å¼ï¼é»è®¤ EXACTLY_ONCEï¼ä¹å¯ä»¥è®¾ä¸º AT_LEAST_ONCEï¼
env.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);

// 3. è®¾ç½®ä¸¤æ¬¡ Checkpoint ä¹é´çæå°é´éï¼é²æ­¢é¢ç¹ Checkpoint å¯¼è´æ§è½ä¸éï¼
env.getCheckpointConfig().setMinPauseBetweenCheckpoints(1000);

// 4. Checkpoint è¶æ¶æ¶é´ï¼é»è®¤ 10åéï¼
env.getCheckpointConfig().setCheckpointTimeout(60000);

// 5. åè®¸åæ¶è¿è¡ç Checkpoint æ°éï¼éå¸¸è®¾ä¸º 1ï¼
env.getCheckpointConfig().setMaxConcurrentCheckpoints(1);

// 6. å¼å¯ä½ä¸åæ¶æ¶ä¿ç Checkpointï¼éå¸¸éè¦ï¼å¦å Cancel ä»»å¡ä¼å é¤ Checkpointï¼
env.getCheckpointConfig().setExternalizedCheckpointCleanup(
    CheckpointConfig.ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION
);

// 7. å®¹å¿ Checkpoint å¤±è´¥æ¬¡æ°ï¼é»è®¤ 0ï¼å³ Checkpoint å¤±è´¥ä¼å¯¼è´ä»»å¡éå¯ï¼
env.getCheckpointConfig().setTolerableCheckpointFailureNumber(3);
</code></pre>
<h2 id="åsavepointæå¨çè¶çº§-checkpoint">åãSavepointï¼æå¨çè¶çº§ Checkpoint</h2>
<p>è½ç¶ Checkpoint å Savepoint çèµ·æ¥å¾åï¼é½æ¯å¿«ç§ï¼ï¼ä½å®ä»¬çå®ä½å®å¨ä¸åï¼</p>
<table>
<thead>
<tr>
<th style="text-align: left">ç¹æ§</th>
<th style="text-align: left">Checkpoint</th>
<th style="text-align: left">Savepoint</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>è§¦åæ¹å¼</strong></td>
<td style="text-align: left">Flink å®æ¶èªå¨è§¦å</td>
<td style="text-align: left">ç¨æ·æå¨å½ä»¤è§¦å</td>
</tr>
<tr>
<td style="text-align: left"><strong>ä¸»è¦ç®ç</strong></td>
<td style="text-align: left"><strong>æéæ¢å¤</strong>ï¼Failoverï¼</td>
<td style="text-align: left"><strong>è¿ç»´æä½</strong>ï¼åçº§ãæ©å®¹ãè¿ç§»ï¼</td>
</tr>
<tr>
<td style="text-align: left"><strong>å­å¨æ ¼å¼</strong></td>
<td style="text-align: left">å¢éå­å¨ï¼ä¾èµ StateBackend ä¼åï¼</td>
<td style="text-align: left">æ åæ ¼å¼ï¼å¨éå­å¨ï¼å¯è·¨çæ¬ï¼</td>
</tr>
<tr>
<td style="text-align: left"><strong>çå½å¨æ</strong></td>
<td style="text-align: left">éä½ä¸çå½å¨æç®¡çï¼é¤éè®¾ç½®ä¿çï¼</td>
<td style="text-align: left">ç¨æ·èªè¡ç®¡çï¼å é¤éæå¨ï¼</td>
</tr>
</tbody>
</table>
<h3 id="å¸¸ç¨å½ä»¤">å¸¸ç¨å½ä»¤</h3>
<pre><code class="language-bash"># è§¦å Savepoint
bin/flink savepoint &lt;jobId&gt; [targetDirectory]

# ä» Savepoint éå¯ä½ä¸ (æè Checkpoint)
bin/flink run -s &lt;savepointPath&gt; ...
</code></pre>
<h2 id="äºéå¯ç­ç¥restart-strategies">äºãéå¯ç­ç¥ï¼Restart Strategiesï¼</h2>
<p>å½ä»»å¡åçæéï¼Exceptionï¼æ¶ï¼Flink ä¼å°è¯æ ¹æ®éç½®çç­ç¥èªå¨éå¯ã</p>
<pre><code class="language-java">// 1. åºå®å»¶è¿éå¯ï¼å°è¯ 3 æ¬¡ï¼æ¯æ¬¡é´é 10ç§ï¼
env.setRestartStrategy(RestartStrategies.fixedDelayRestart(
    3, 
    Duration.ofSeconds(10)
));

// 2. å¤±è´¥çéå¯ï¼å¨ 5 åéåå¤±è´¥è¶è¿ 3 æ¬¡ååæ­¢ï¼å¦åæ¯æ¬¡é´é 10ç§éå¯ï¼
env.setRestartStrategy(RestartStrategies.failureRateRestart(
    3, 
    Duration.ofMinutes(5), 
    Duration.ofSeconds(10)
));

// 3. æ éå¯ï¼ç´æ¥å¤±è´¥ï¼
env.setRestartStrategy(RestartStrategies.noRestart());
</code></pre>
<h2 id="å­æ»ç»">å­ãæ»ç»</h2>
<ul>
<li><strong>State</strong> æ¯ Flink å®ç°å¤æé»è¾çè®°å¿ã</li>
<li><strong>State Backend</strong> å³å®äºè®°å¿å­åªéï¼åå­å¿«ä½å°ï¼RocksDB å¤§ä½éåºååï¼ã</li>
<li><strong>Checkpoint</strong> æ¯èªå¨åçå®æå¤ä»½ï¼ä¿è¯æéæ¢å¤åçæ°æ®ä¸è´æ§ã</li>
<li><strong>Savepoint</strong> æ¯æå¨çé«çº§å¤ä»½ï¼ç¨äºçæ¬åçº§ååºç¨è¿ç§»ã</li>
</ul>
<p>ææ¡äºç¶æä¸å®¹éï¼ä½ ç Flink ä»»å¡æç®çæ­£å·å¤äºâçäº§çº§âçå¥å£®æ§ãä¸ä¸ç¯ï¼æä»¬å°æ¢è®¨ Flink SQLï¼ççå¦ä½ç¨ SQL è§£å³ 80% çæµè®¡ç®éæ±ã</p>
<hr>
<p>åææ¥èªï¼<a href="http://blog.daimajiangxin.com.cn" target="_blank" rel="noopener nofollow">http://blog.daimajiangxin.com.cn</a></p>
<p>æºç å°åï¼<a href="https://gitee.com/daimajiangxin/flink-learning" target="_blank" rel="noopener nofollow">https://gitee.com/daimajiangxin/flink-learning</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 15:48">2026-02-04 15:48</span>&nbsp;
<a href="https://www.cnblogs.com/daimajiangxin">ä»£ç å å¿</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19574902);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19574902', targetLink: 'https://www.cnblogs.com/daimajiangxin/p/19574902', title: 'ä»é¶å¼å§å­¦Flinkï¼ç¶æç®¡çä¸å®¹éæºå¶' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ istioæµéååå®æï¼ä»éç½®å°è¸©åå¨è§£æ ]]></title>
    <link>https://www.cnblogs.com/MrVolleyball/p/19574573</link>
    <guid>451c8628331c5e774d19b296da6097bb</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/MrVolleyball/p/19574573" title="åå¸äº 2026-02-04 15:04">
    <span role="heading" aria-level="2">istioæµéååå®æï¼ä»éç½®å°è¸©åå¨è§£æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æéè¿ä¸ä¸ªçå®ç Istio æµéååæ¡ä¾ï¼ç³»ç»æ¢³çææ¯ä¾ãæ Headerãæ URL åç¼ç­å¸¸è§è·¯ç±æ¹å¼ï¼å¹¶éç¹åæ Host ä¸å¹éå¯¼è´æµéå¤±æçæ ¹å ãç»å Nginx ä¸ Sidecar å±å­åºæ¯ï¼è¯¦ç»è¯´æéä¸éãç°åº¦ãèç»¿å A/B æµè¯å¨ Istio ä¸­çè½å°æ¹å¼ï¼éåæ­£å¨æå³å°å¼å¥ Istio çå·¥ç¨å®è·µåè
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="åè¨">åè¨</h2>
<p>ä¸ä¸å°èï¼istioæåçå®è£ï¼å¹¶ä¸è¿è§£å³äºå¸¸è§ç426çé®é¢ï¼æ¬èåå®¹ä¸»è¦æ¢è®¨ä¸ä¸istioå³äºæµéè½¬åçé®é¢</p>
<h2 id="ææ¯ä¾åå">ææ¯ä¾åå</h2>
<h4 id="éç½®">éç½®</h4>
<p>éè¦åå»ºä¸ä¸ªbackend-v1ï¼å®ä¸backendçselectoré½æ¯<code>app: backend</code>ï¼backend-v1é¨ç½²å®æä¹åï¼å®ä¼ç«å³åèµ°50%çæµéï¼ä¸ºäºæµè¯istioæµæ§ï¼æä»¬éè¦å¨ä¸æ¹åä»»ä½éç½®çæåµä¸å®ç°9:1åæµï¼ä¹å°±æ¯90%è¿å¥åbackendï¼10%è¿å¥æ°çbackend-v1</p>
<p><img alt="watermarked-istio_functions_1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1416773/202602/1416773-20260204145415887-549258054.png" class="lazyload"></p>
<ul>
<li>
<p>æ è®°2ä¸ªdeploymentï¼è¿½å æ ç­¾ï¼backendä¸º<code>version: v0</code>ï¼backend-v1ä¸º<code>version: v1</code></p>
<pre><code>kubectl patch deployment backend -p '{"spec":{"template":{"metadata":{"labels":{"version":"v0"}}}}}'
kubectl patch deployment backend-v1 -p '{"spec":{"template":{"metadata":{"labels":{"version":"v1"}}}}}'
</code></pre>
</li>
<li>
<p>åå»ºistioèµæºï¼DestinationRuleï¼è¯¥èµæºä¸»è¦ç¨æ¥æ è®°istioè¦å¾åªä¸ªå°æ¹è½¬å</p>
<pre><code>apiVersion: networking.istio.io/v1
kind: DestinationRule
metadata:
  name: backend-dr
  namespace: default
spec:
  host: backend-service
  subsets:
  - labels:
      version: v0
    name: v0
  - labels:
      version: v1
    name: v1

</code></pre>
</li>
<li>
<p>åå»ºistioèµæºï¼VirtualServiceï¼è¯¥èµæºç¨æ¥ç¡®å®è½¬åçæé</p>
<pre><code>apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: backend-vs
  namespace: default
spec:
  hosts:
  - backend-service
  http:
  - route:
    - destination:
        host: backend-service
        subset: v0
      weight: 90
    - destination:
        host: backend-service
        subset: v1
      weight: 10
</code></pre>
</li>
</ul>
<h4 id="è°è¯">è°è¯</h4>
<ul>
<li>
<p>æµè¯å½ä»¤ï¼ <code>for i in {1..10}; do curl -s 10.22.12.178:30785/test &gt; /dev/null ; done</code></p>
</li>
<li>
<p>ç»å½å°k8sçistio-proxyæ§å¶å°æ¥çï¼ <code>kubectl logs -f -l app=backend -c istio-proxy</code></p>
<pre><code>[2026-01-28T08:24:55.670Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.55:10000 duration=0ms route=default
[2026-01-28T08:24:55.687Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.55:10000 duration=0ms route=default
[2026-01-28T08:24:55.706Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=0ms route=default
[2026-01-28T08:24:55.741Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=1ms route=default
[2026-01-28T08:24:55.751Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=0ms route=default
[2026-01-28T08:24:55.759Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=0ms route=default
[2026-01-28T08:24:55.696Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.55:10000 duration=0ms route=default
[2026-01-28T08:24:55.716Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.55:10000 duration=0ms route=default
[2026-01-28T08:24:55.725Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.55:10000 duration=0ms route=default
[2026-01-28T08:24:55.734Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.55:10000 duration=0ms route=default

</code></pre>
<pre><code>â¶ kubectl get pod -owide
NAME                          READY   STATUS    RESTARTS   AGE     IP            NODE     NOMINATED NODE   READINESS GATES
backend-86b958bdc-5zjgn       2/2     Running   0          21m     10.244.0.53   wilson   &lt;none&gt;           &lt;none&gt;
backend-v1-75ccff86dc-sl6bt   2/2     Running   0          119s    10.244.0.55   wilson   &lt;none&gt;           &lt;none&gt;
nginx-test-7d87875694-8vsrp   2/2     Running   0          30m     10.244.0.61   wilson   &lt;none&gt;           &lt;none&gt;
</code></pre>
</li>
<li>
<p>ææ¾ä¸å¯¹ï¼10.244.0.55ä¸10.244.0.53çæ¯ä¾å¹¶æ²¡æåç°9:1ï¼è½¬åå°backendè¦backend-v1è¿æ¯5:5</p>
</li>
</ul>
<h4 id="ä¿®å¤">ä¿®å¤</h4>
<p>å¯ä»¥ç´æ¥ä¿®æ¹nginxçéç½®</p>
<pre><code>server {
    listen       80;
    listen  [::]:80;
    server_name  localhost;

    location /test {
        proxy_http_version 1.1;
        # proxy_set_header Host $host; # åéç½®
        proxy_set_header Host backend-service.default.svc.cluster.local; # æ°éç½®
        proxy_pass http://backend-service:10000;
    }
}
</code></pre>
<p>éå¯ä¹ååæ¬¡æµè¯ï¼</p>
<pre><code>[2026-01-28T08:30:59.968Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=0ms route=default
[2026-01-28T08:30:59.988Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=1ms route=default
[2026-01-28T08:31:00.027Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=1ms route=default
[2026-01-28T08:31:00.037Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=0ms route=default
[2026-01-28T08:31:00.048Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=0ms route=default
[2026-01-28T08:31:00.056Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=0ms route=default
[2026-01-28T08:31:00.008Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.55:10000 duration=0ms route=default
[2026-01-28T08:31:00.066Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=0ms route=default
[2026-01-28T08:31:00.074Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=0ms route=default
[2026-01-28T08:31:00.083Z] "GET /test HTTP/1.1" 200 - upstream=10.244.0.53:10000 duration=0ms route=default
</code></pre>
<p>å·²ç»çæäºï¼è¿æ¬¡åªæ1æ¬¡10.244.0.55:10000</p>
<h4 id="çé®">çé®</h4>
<p>æä½å¤§å¥è¯´äºï¼å¦æè¿æ ·éç½®çï¼ææ¾å½±åäºä¸å¡ï¼</p>
<ul>
<li>nginxçéç½®è¢«ä¿®æ¹äº</li>
<li>ææçhostè¢«åæ­»äºï¼é½æäºï¼backend-service.default.svc.cluster.localï¼èåç«¯ä¸å¡æ¯éè¦æå®¢æ·ç«¯çhostå¸¦å¥è¿å»çï¼æ¹äºä¹ååç«¯ä¸å¡æ¶å°ä¸¥éå½±å</li>
</ul>
<p>ç¡®å®ï¼åºå®hostå±äºç²æ´ç®åçåæ³ï¼è¿ææ´å æåçè§£å³æ¹æ³ï¼è°æ´VirtualServiceï¼æ·»å hosts</p>
<pre><code>apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: backend-vs
  namespace: default
spec:
  hosts:
  - backend-service
  - api.wilsontest.com # æ°å¢
  http:
  - route:
    - destination:
        host: backend-service
        subset: v0
      weight: 90
    - destination:
        host: backend-service
        subset: v1
      weight: 10
</code></pre>
<p>å®¢æ·ç«¯è®¿é®çæ¶åå¿é¡»å¸¦ä¸è¯¥ååï¼ <code>for i in {1..10}; do curl -s -H 'host: api.wilsontest.com' 10.22.12.178:30785/test &gt; /dev/null ; done</code></p>
<p>è¿æ ·ä¹å¯ä»¥è§£å³é®é¢ï¼ä¸è¿åç¹ä¹æ¥äºï¼å¹´ä¹å¤±ä¿®ï¼ä»æ æ°åäººç»§æ¿çç¥ä¼ ä»£ç ï¼å°±éè¦å¥½å¥½çæ¢³çå°åºæåªäºhostæ¥è®¿é®ï¼å¦åæ¼æhostçè¯ï¼å°±ä¼åºç°éç½®é®é¢ã-_-!</p>
<p>åæ¬¡å¸æ¾äºistioä¹ä¸­ï¼hostæ¯éå¸¸éå¸¸éè¦çï¼Istio çè·¯ç±å³ç­ãService çå¹éå®å¨ä¾èµ Host å¤´</p>
<ul>
<li>Istio ç VirtualService æ¬è´¨ä¸æ¯ä¸ä¸ªâå¢å¼ºçâçè·¯ç±å¨ãå¦æåç°è¯·æ±ç Host æ¯ backend-serviceï¼å°±æ 90:10 åéã</li>
<li>ä¹åçéç½®æ¯$hostï¼ç±äºå®¢æ·ç«¯æ²¡æä¼ è¾hostï¼å½è¯·æ±ç»è¿ Nginx ç Sidecaræ¶ï¼å®ä¼æ£æ¥Hostï¼åç°ä¸ºç©ºãç±äºè·¯ç±è¡¨éæ²¡æå¯¹åºçè®°å½ ï¼sidecarå¹¶ä¸è®¤è¯ï¼ææ®é K8s æµéå¤ç</li>
</ul>
<h2 id="æheaderåå">æheaderåå</h2>
<pre><code>apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: backend-vs
  namespace: default
spec:
  hosts:
  - backend-service
  - api.wilsontest.com
  http:
  - match:
    - headers:
        hellotest:
          exact: "true"
    route:
    - destination:
        host: backend-service
        subset: v1
  - route:
    - destination:
        host: backend-service
        subset: v0
</code></pre>
<p><code>curl -s -H 'host: api.wilsontest.com' -H 'hellotest: true' 10.22.12.178:30785/test</code>ãåªæheaderéé¢å¹éäº<code>hellotest: true</code>æä¼å»v1ï¼å¦åå¨é¨å»v0</p>
<h2 id="æåç¼åå">æåç¼åå</h2>
<pre><code>apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: backend-vs
  namespace: default
spec:
  hosts:
  - backend-service
  - api.wilsontest.com
  http:
  - match:
    - uri:
        prefix: /test/v1
    route:
    - destination:
        host: backend-service
        subset: v1
  - route:
    - destination:
        host: backend-service
        subset: v0
</code></pre>
<p>å¸¦æ/test/v1åç¼çé½ä¼å»æ°çæ¬v1ï¼æ»¡è¶³ä¸äºæ¡ä»¶é½ä¼èµ°é»è®¤ççæ¬v0</p>
<h2 id="urlæ¹å">urlæ¹å</h2>
<pre><code>apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: backend-vs
  namespace: default
spec:
  hosts:
  - backend-service
  - api.wilsontest.com
  http:
  - match:
    - uri:
        prefix: /test/v1
    route:
    - destination:
        host: backend-service
        subset: v1
  - match:
    - uri:
        prefix: /test/v2
    rewrite:
      uri: /test
    route:
    - destination:
        host: backend-service
        subset: v0
  - route:
    - destination:
        host: backend-service
        subset: v0

</code></pre>
<p>å¦ææ¯/test/v1ï¼å°±è®¿é®v1çæ¬ï¼/test/v2éåæ/testå¹¶ä¸è®¿é®v0çæ¬ï¼å¶ä½çé»è®¤é½ä¼èµ°v0çæ¬</p>
<h2 id="èç»¿éä¸éç°åº¦abæµè¯">èç»¿ãéä¸éãç°åº¦ãA/Bæµè¯</h2>
<p>å³äºæµéåæµçåç§æä½ï¼å¤§é¨åé½éä¸­å¨ä»¥ä¸åºæ¯ï¼</p>
<ul>
<li>èç»¿ï¼å®ç°ç¬é´åæ¢ä¸é¶å®æºåæ»ï¼æ¶é¤åå¸æé´çä¸­é´ç¶æ</li>
<li>éä¸éï¼åç¿å·¥ç¨éä¸éæ¢æµæ¯æ°ä¸æ ·ï¼åè®©ä¸å°é¨åç¨æ·ï¼å¦1%~5%ï¼è®¿é®æ°çæ¬ï¼è§å¯ç³»ç»ææ ï¼å¦éè¯¯çãå»¶è¿ï¼ï¼è¥æ é®é¢åéæ­¥æ©å¤§èå´</li>
<li>ç°åº¦ï¼å°ç¨æ·ç¾¤ä½ææ¯ä¾æç¹å®è§åï¼å¦å°åãè®¾å¤ï¼éæ­¥åæ¢å°æ°çæ¬ï¼ä¾å¦10%â30%â100%ï¼ï¼æç»­è§å¯åé¦</li>
<li>A/Bï¼åæ¶åéæºåç»çç¨æ·å±ç¤ºä¸åçæ¬ï¼Aç»ç¨æ§çï¼Bç»ç¨æ°çï¼ï¼éè¿ç»è®¡ææ ï¼å¦ç¹å»çãè½¬åçï¼å¤æ­åªä¸ªçæ¬æ´ä¼</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>èç»¿åå¸</th>
<th>éä¸éåå¸</th>
<th>ç°åº¦åå¸</th>
<th>A/Bæµè¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸»è¦ç®æ </td>
<td>é¶åæºãç¬æ¶åæ»</td>
<td>ç¨çå®æµéå¿«éåç°ææ¯é£é©</td>
<td>å¹³ç¨³ãå¯æ§å°éæ­¥æ¿æ¢ææç¨æ·</td>
<td>éªè¯ä¸åçæ¬çä¸å¡ææ</td>
</tr>
<tr>
<td>æµéè·¯ç±</td>
<td>å¨éåæ¢ï¼100%â0%ï¼</td>
<td>æå°æ¯ä¾å¼æµï¼å¦1%-5%ï¼</td>
<td>ææ¯ä¾åé¶æ®µæ©å¤§ï¼10%â50%â100%ï¼</td>
<td>æè§å/éæºåéï¼å¦50%/50%ï¼</td>
</tr>
<tr>
<td>å³æ³¨éç¹</td>
<td>ç³»ç»å¯ç¨æ§ä¸åæ»éåº¦</td>
<td>ç³»ç»ç¨³å®æ§ææ ï¼éè¯¯çãå»¶è¿ï¼</td>
<td>åå¸è¿ç¨å¹³ç¨³æ§ä¸ç»¼ååé¦</td>
<td>ä¸å¡ææ ï¼è½¬åçãçå­çï¼</td>
</tr>
<tr>
<td>æéèµæº</td>
<td>ä¸¤å¥å®æ´ç¯å¢ï¼ææ¬é«</td>
<td>ä¸å¥ç¯å¢ï¼æ°çæ¬å®ä¾è¾å°</td>
<td>ä¸å¥ç¯å¢ï¼æ°æ§çæ¬å®ä¾å±å­</td>
<td>ä¸å¥æå¤å¥ç¯å¢ï¼å¹¶è¡è¿è¡å¤ä¸ªçæ¬</td>
</tr>
<tr>
<td>ç¨æ·éæ©</td>
<td>å¨ä½ç¨æ·åæ¶åæ¢</td>
<td>å°é¨åç¨æ·éæºææåºç¡è®¾æ½éæ©</td>
<td>ç¨æ·ææ¯ä¾æå±æ§éæ­¥è¿ç§»</td>
<td>ç¨æ·éæºåç»ææå±æ§å®ååé</td>
</tr>
<tr>
<td>æç»­æ¶é´</td>
<td>æç­ï¼åæ¢å¨å åéåï¼</td>
<td>ç­ï¼å å°æ¶å°ä¸å¤©ï¼</td>
<td>ä¸­é¿ï¼å å¤©å°æ°å¨ï¼</td>
<td>é¿ï¼æ°å¨å°æ°æï¼</td>
</tr>
<tr>
<td>å¸ååºæ¯</td>
<td>å³é®ä¸å¡å¤§çæ¬åçº§ãåºç¡è®¾æ½æ´æ¢</td>
<td>åç«¯æå¡ãä¸­é´ä»¶ãæ°æ®åºåæ´</td>
<td>åç«¯åè½ãç¨æ·çé¢æ´æ°</td>
<td>UIè®¾è®¡ãææ¡ãç®æ³ç­ç¥ãå®ä»·ä¼å</td>
</tr>
</tbody>
</table>
<h2 id="èç³»æ">èç³»æ</h2>
<ul>
<li>èç³»æï¼åæ·±å¥çäº¤æµ</li>
</ul>
<p><img alt="" width="500" height="200" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1416773/202411/1416773-20241121135740959-1907948957.png#" class="lazyload"></p>
<hr>
<p>è³æ­¤ï¼æ¬æç»æ<br>
å¨ä¸æçå­¦æµï¼æææ±¤æ¼æ°´çï¼è¯·åä½ä¸åèµæ...</p>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/MrVolleyball/" target="_blank">itæçå</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/MrVolleyball/p/19574573" target="_blank">https://www.cnblogs.com/MrVolleyball/p/19574573</a></p>
<div>æ¬æçæå½ä½èååå®¢å­å±æï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»å¨æç« é¡µé¢ç»åºåæè¿æ¥ï¼å¦åä¿çè¿½ç©¶æ³å¾è´£ä»»çæå©ã </div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 15:04">2026-02-04 15:04</span>&nbsp;
<a href="https://www.cnblogs.com/MrVolleyball">itæçå</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19574573);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19574573', targetLink: 'https://www.cnblogs.com/MrVolleyball/p/19574573', title: 'istioæµéååå®æï¼ä»éç½®å°è¸©åå¨è§£æ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Agentic Codingä¸äºå®è·µæ»ç» ]]></title>
    <link>https://www.cnblogs.com/tsingroo/p/19573451</link>
    <guid>2a98f0b82c30679f303ebc8db70f851f</guid>
    <description>
    <![CDATA[ 
        <h2 class="post-title">
            <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/tsingroo/p/19573451" title="åå¸äº 2026-02-04 11:55">
    <span role="heading" aria-level="2">Agentic Codingä¸äºå®è·µæ»ç»</span>
    

</a>

        </h2>
        <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>&nbsp; æè¿ä¸å¹´AIç¼ç é£éåå±ï¼ç°å¨æç90%ä»¥ä¸çä»£ç é½æ¯åºèªAIãæ³æ³å¨2024å¹´è°ç¨OpneAIå®æ¹æ¥å£ï¼3.5æ¨¡åï¼,è¶è¿10KçTokenå°±è®©LLMçä¸ä¸æå®å¨æ··ä¹±ï¼å¯¼è´LLMæ æ³è®°ä½å¤ªå¤ä¸è¥¿ï¼æ´ä¸ç¨è¯´è°ç¨å·¥å·ï¼çæä»£ç äºãå°ç®åä¸ºæ­¢ï¼ç¨äºåç§å·¥å·å·²ç»åå¹´ä»¥ä¸äºï¼è®°å½ä¸ä¸æ»ä½çå®è·µç»éªãåé¢å°cursorãClaude CodeãOpenCodeç­å·¥å·ç»ç§°ä¸ºAgenticCodingå·¥å·ï¼æçä¸»è¦å·¥ä½è¯­è¨æ¯go/Rustï¼åä¸ªå·¥å·åæ¨¡åå¨ä¸åè¯­è¨ä¸ä¼ææå·®å¼ï¼ä½ èªå·±çç»è®ºå¯è½åæä¸å¤ªä¸æ ·ã</p>
<p><strong><span style="font-size: 16px">&nbsp; 1.Agentic Codingæ¯å·¥å·çæ©å±ï¼èä¸æ¯æºè½çæ©å±ï¼å°±ç®åæ¥çï¼</span></strong></p>
<p>&nbsp; è½ç¶ç°å¨æ¥è¿90%ä»¥ä¸çä»£ç é½è½ç±AIçæï¼ä½æ¯è¿äºå·¥å·è¿æ¯ä¾èµäºä½ æèå¢éååçè§è¯ãç¥è¯ãæµç¨ç­ï¼æ¬è´¨è¿æ¯å·¥å·ã<strong><span style="color: rgba(255, 0, 0, 1)">å¦æä¹åä½ çå¢éæèä½ æ²¡ææ¥è§¦è¿è¯å¥½çè½¯ä»¶å·¥ç¨ç®¡çãè§èæå®è·µï¼é£ä½ å¨æäºAgentic Codingä¹ååªæ¯æè§ä¸è®©ä½ æ´ç½äºä¸ç¹èå·²ï¼å¯¹äºè½¯ä»¶å·¥ç¨çç®¡ççè³ä¼èµ·å°åä½ç¨ã</span></strong><span style="color: rgba(0, 0, 0, 1)">æ¯å¦æ´å¤çæªç»å®¡æ¥çä»£ç ä¼è¿å¥gitä»åºï¼æ´å¤çä¸æç¡®çéæ±å¯¼è´Agnetic Codingå·¥å·çèªç±åæ¥ç©ºé´è¿å¤§ï¼AIå¨ä¸æ°å½çå°æ¹è¿åº¦è®¾è®¡ï¼æªç»å®¡æ¥åå¹¶ä»£ç åå¯¼è´æµè¯äººåæ´é¾åç°BUGï¼ä»¥åæäº¤èªå·±çä¸æç½çä»£ç å¯¼è´çº¿ä¸åºé®é¢åæ æ³å¿«éææ¥ï¼ææ¯åºè¶æ¥è¶å¤ã</span></p>
<p><strong><span style="font-size: 16px">&nbsp; 2.ãå¥½çä¸ä¸æå·¥ç¨+ä¸è¬çæ¨¡åãææå¥½äºãä¸è¬çä¸ä¸æå·¥ç¨+å¥½çå¤§æ¨¡åã</span></strong></p>
<p>&nbsp; è¿éçä¸ä¸æå·¥ç¨å°±æ¯åç±»ç¼ç å·¥å·ãAgentic Codingå·¥å·å°±æ¯ä½¿ç¨è¯å¥½çä¸ä¸æç®¡çå ä¸ä½ æä¾çæç¤ºè¯æ¥è°ç¨å¤§æ¨¡åæ¥å£ï¼å¹¶ä½¿ç¨å¤§æ¨¡åçæ¥å£çè¿åæ¥å³å®ä¸ä¸æ­¥å¦ä½åã</p>
<p>&nbsp; ä»å°±goè¯­è¨èè¨ï¼ç»è¿å ä¸ªæçæµè¯ï¼Claude Codeä½¿ç¨GLM 4.7(æèKimi 2.5) è¦å¥½äº Kiroä½¿ç¨Claude Opus 4.5æèantigravityä½¿ç¨ Claude Opus 4.5ãè¿ä¸ªä¹å¯è½æ¯ä¸è¯­è¨ç¸å³ã ææ²¡ç¨è¿Claude Codeæ­éåççSonnetæèOpusæ¨¡åï¼ä½æ¯å¨cursor+Opusè·ä½¿ç¨cursor+kimiå·®å¼æ²¡ææ³çé£ä¹å¤§ã</p>
<p><span style="font-size: 16px"><strong>&nbsp; 3.å¦æä½ éæ±ç®¡çæ··ä¹±ï¼ä½ è¦åè§èéæ±ï¼å¦æä½ çå¢éæµç¨æ··ä¹±ï¼ä½ è¦åè§èæµç¨</strong></span></p>
<p>&nbsp; æäºå¬å¸ï¼åæ¬ä¸äºå¤§å¬å¸çä¸äºé¨é¨ï¼ç®¡çæ¯è¾æ··ä¹±ãéæ±è¯å®¡çæ¶åï¼äº§ååªè½æ¿åºä¸ä¸ªæ³æ³åç®åçå å¥è¯çææ¡£ï¼ä½æ¯åè¦å¼åé¢ä¼°æ¶é´ï¼ä¹åå¼åè¿ç¨ä¸­ä¼ä¸æ­åç°é®é¢ï¼å¯¼è´åé¢éæ±ååé¢çéæ±å¤§ç¸å¾åº­ï¼ææ¶åè¿å¥æµè¯ä¹åäº§åè¿å¨è°æ´éæ±ææ¡£ãé¨é¨é¢å¯¼å¯¹æ­¤è§èä¸è§ï¼å¦ææäººè¯´æµç¨æ··ä¹±ãéæ±æ··ä¹±ï¼é£å°±åææé®é¢çè¿ä¸ªäººè§£å³æï¼å°±ä¸ä¼æé®é¢äºãæäºå°å¬å¸æè¿ç§æåµï¼æäºå¤§å¬å¸çæäºé¨åä¹æè¿ç§æåµã<span style="color: rgba(255, 0, 0, 1)">å¦æææ²¡éå°ï¼ææ¢çè¯´ï¼ð</span></p>
<p>&nbsp; ä¸è§£å³éæ±åæµç¨æ··ä¹±çé®é¢ï¼å¨Agentic Codingçå æä¸ï¼æ¯ä¸ªäººåªä¼æ´ç´¯ï¼çæçä»£ç ä¹ä¼æ´ä¹±ã<span style="color: rgba(255, 0, 0, 1)">AIæ¶ä»£ï¼ä½ é¦åå¾ç¥éèªå·±æ³è¦ä»ä¹ï¼ä½ ä¸è½å¨ä½ èªå·±è¿ä¸æ¸æ¥çæåµä¸åæä»£ç åå®äº</span>ã</p>
<p><span style="font-size: 16px"><strong>&nbsp; 4.è¦æ³¨éç¥è¯å±äº«åè½å°è®²è§£ï¼è·éAIå·¥å·çåå±</strong></span></p>
<p>&nbsp; ä¸è¦å£å¤´è¯´ä¸ä¸ªä¸è¥¿å¤å¥½å¤æç¨ï¼è¦å¨å¢éä¸­ï¼æå¼é¡¹ç®ï¼ä»¥ä¸ä¸ªå®ééæ±ä¸ºä¾ï¼ç»å¤§å®¶å±ç¤ºä¸ä¸è¿ä¸ªææ¯æå¤å¥½ãæ¯å¦MCP/Skillsï¼ä¸è¦å¤¸ä»æå¤å¥½ï¼ä¸åè¦æ¨èç»å¤§å®¶ï¼è¿è¦ä»¥å®éæä¸ªä¼è®®æ¥è®²è§£å¦æè½å°ä½¿ç¨ï¼å¦åå°±è·ç©ºåï¼âåªååªåï¼å æ²¹å æ²¹âä¸æ ·ãå½ç¶è¿ä¹ä¸æ¯ä¸ä¸ªäººè´£ä»»ï¼å¢éä¸­å¯ä»¥å®æåäº«ãæ¯å¦Claude Codeä¸­çææ å½ä»¤ãSubAgentsãSkillç­ã</p>
<p>&nbsp; éå : æ¯å¦ç¦å¤§å­¦ç<a href="https://themodernsoftware.dev/" target="_blank" rel="noopener nofollow">ãCS 146S: ç°ä»£è½¯ä»¶å¼åèã</a>è¿é¨è¯¾ã</p>
<p><span style="font-size: 16px"><strong>&nbsp; 5.ä¸äºæå·§</strong></span></p>
<ul>
<li>&nbsp;ç¼åä»£ç çæ¶åä¸å®è¦åä½¿ç¨Planæ¨¡å¼å¶å®è§åï¼å¹¶åæ¬¡è®©AIå®¡æ¥è®¡åï¼ä¹åæè®©AIç¼åä»£ç ãç®åä¸»æµAgentic Codingå·¥å·åå·²æ¯æPlanæ¨¡å¼</li>
<li>è®©AIåä»£ç ä¹åï¼åå°å½åçä»£ç é½æäº¤ãè¿æ ·å¦æAIçæçä¸æ»¡æå¯ä»¥éæ¶æ¤éä»£ç ãåæ¶ãä¸ªäººå»ºè®®ãä¸è¦ç»å·¥å·git commitågit pushæé</li>
<li>å¦æAgentic Codingå·¥å·çæçä»£ç ï¼æ¶å¸¸åç¦»é¡¹ç®æèä½ çé¢æãä½ éè¦å°ä½ çé¢æä»¥åéå¶åå°ç±»ä¼¼CLAUDE.mdæèskillsä¸­ï¼æ¥è®©AIæ¥éµå®</li>
<li>ææAIçæçä»£ç ï¼ç®åé¶æ®µé½è¦äººå·¥å®¡æ ¸åæè½æäº¤å°ä»£ç ä»åº</li>
<li>å¨è¾¾å°LLMçä¸ä¸æéå¼ä¹åå¼å¯æ°ä¼è¯æ¥åä»»å¡ãç®åå ç¾KçTokenæ³¨æåï¼å¨æäºæ¶åæè§å·²ç»è¶è¿äºäººç±»çæ³¨æå(ææ²¡æå³æ³¨çç¹ï¼AIä¼æå¤çèèå°)ï¼ä½æ¯ä¸ä¸æä¸é¿ä¹åå°±å®¹æèå(Context Rot)ã</li>
</ul>
<p>&nbsp;</p>

</div>
<div class="clear"></div>

        <p class="postfoot">
            posted on 
<span id="post-date" data-last-update-days="0.001388888888888889" data-date-updated="2026-02-04 11:57">2026-02-04 11:55</span>&nbsp;
<a href="https://www.cnblogs.com/tsingroo">é¿æ©ç½è¯</a>&nbsp;
éè¯»(<span id="post_view_count">82</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19573451);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19573451', targetLink: 'https://www.cnblogs.com/tsingroo/p/19573451', title: 'Agentic Codingä¸äºå®è·µæ»ç»' })">ä¸¾æ¥</a>

        </p>
     ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ AIå¼å-python-langchainæ¡æ¶ï¼1-10 è¿åæ¥æ-æ ¼å¼è§£æå¨ï¼ ]]></title>
    <link>https://www.cnblogs.com/yclh/p/19573432</link>
    <guid>38796f11abc9eb50a6bbdabc52ed8575</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yclh/p/19573432" title="åå¸äº 2026-02-04 11:52">
    <span role="heading" aria-level="2">AIå¼å-python-langchainæ¡æ¶ï¼1-10 è¿åæ¥æ-æ ¼å¼è§£æå¨ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><span class="qwen-markdown-text">å¦ä½è®©å¤§æ¨¡åè¿åçç»ææ¯ä¸ä¸ªæ åçæ¥ææ ¼å¼ï¼</span></p>
<p><span class="qwen-markdown-text">å¦ä¸è¿æ®µä»£ç å±ç¤ºäºå¦ä½ä½¿ç¨ LangChain æå»ºä¸ä¸ªç»æåè¾åºé¾ï¼chainï¼ï¼å°èªç¶è¯­è¨é®é¢ï¼âä¸­åäººæ°å±åå½æ¯ä»ä¹æ¶ååç«çï¼âï¼éè¿å¤§è¯­è¨æ¨¡åï¼LLMï¼è½¬æ¢ä¸ºæ åç Python <code class="qwen-markdown-codespan" style="cursor: pointer">datetime</code><span class="qwen-markdown-text" data-spm-anchor-id="a2ty_o01.29997173.0.i0.58945171MAqdzo"> å¯¹è±¡</span></span></p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">from langchain.prompts import PromptTemplate
from langchain_openai import ChatOpenAI
from langchain.output_parsers import DatetimeOutputParser
import os

# æ¥ææ¶é´è¾åºè§£æå¨ èªå¨å°æ¨¡åè¿åçææ¬å­ç¬¦ä¸²è§£æä¸º Python ç datetime å¯¹è±¡
output_parser = DatetimeOutputParser()

print('###########åççæç¤ºè¯æ¯è±æç')
format_instructions=output_parser.get_format_instructions()
print(format_instructions)
print('###########')


template = """åç­ç¨æ·çé®é¢:
{question}
{format_instructions}"""

format_instructions='''ååºçæ ¼å¼ç¨æ¥ææ¶é´å­ç¬¦ä¸²:â%Y-%m-%dT%H:%M:%S.%fZâã
ç¤ºä¾: 1898-05-31T06:59:40.248940Z, 1808- 10-20T01:56:09.167633Zã0226-10-17T06:18:24.192024Z
ä»è¿åæ­¤å­ç¬¦ä¸²ï¼'''

prompt = PromptTemplate.from_template(
    template,
    partial_variables={"format_instructions":format_instructions},
)

#è¾åºæç¤ºè¯
print(prompt.invoke({"question": "ä¸­åäººæ°å±åå½æ¯ä»ä¹æ¶ååç«çï¼"}).text)

llm = ChatOpenAI(
    api_key=os.getenv("DEEPSEEK_API_KEY"),
    base_url=os.getenv("BASE_URL"),  # Deepseek ç API åºç¡å°å
    model="deepseek-v3:671b",  # Deepseek å¯¹è¯æ¨¡åï¼å¯éï¼deepseek-chat-pro ç­é«çº§æ¨¡åï¼
    temperature=0.7,  # æ¸©åº¦åæ°ï¼0-1ï¼è¶ä½è¶ç¨³å®ï¼
    max_tokens=1024  # æå¤§çæ tokens
)


chain = prompt | llm | output_parser

print('--------------')
result = chain.invoke({"question": "ä¸­åäººæ°å±åå½æ¯ä»ä¹æ¶ååç«çï¼"})
print(result)
</pre>
</div>
<p>&nbsp;è¿åç»æï¼</p>
<p>###########åççæç¤ºè¯æ¯è±æç<br>Write a datetime string that matches the following pattern: '%Y-%m-%dT%H:%M:%S.%fZ'.<br><br>Examples: 1466-10-12T18:56:24.473648Z, 0322-04-03T12:00:41.805552Z, 1762-08-02T08:58:50.100670Z<br><br>Return ONLY this string, no other words!<br>###########<br>åç­ç¨æ·çé®é¢:<br>ä¸­åäººæ°å±åå½æ¯ä»ä¹æ¶ååç«çï¼<br>ååºçæ ¼å¼ç¨æ¥ææ¶é´å­ç¬¦ä¸²:â%Y-%m-%dT%H:%M:%S.%fZâã<br>ç¤ºä¾: 1898-05-31T06:59:40.248940Z, 1808- 10-20T01:56:09.167633Zã0226-10-17T06:18:24.192024Z<br>ä»è¿åæ­¤å­ç¬¦ä¸²ï¼<br>--------------<br>1949-10-01 00:00:00</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 11:52">2026-02-04 11:52</span>&nbsp;
<a href="https://www.cnblogs.com/yclh">ä¸ç¬ä½</a>&nbsp;
éè¯»(<span id="post_view_count">21</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19573432);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19573432', targetLink: 'https://www.cnblogs.com/yclh/p/19573432', title: 'AIå¼å-python-langchainæ¡æ¶ï¼1-10 è¿åæ¥æ-æ ¼å¼è§£æå¨ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Redisson ä½¿ç¨æåï¼ä» API è¯¯åºå°çé¨çå¤±æï¼å¨æ­¤ç»ç»åå¸å¼éçå©æ¢¦ ]]></title>
    <link>https://www.cnblogs.com/xzqcsj/p/19573422</link>
    <guid>4a17a6bba28f3a2e6c2474be0d0d4222</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xzqcsj/p/19573422" title="åå¸äº 2026-02-04 11:49">
    <span role="heading" aria-level="2">Redisson ä½¿ç¨æåï¼ä» API è¯¯åºå°çé¨çå¤±æï¼å¨æ­¤ç»ç»åå¸å¼éçå©æ¢¦</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3703499/202602/3703499-20260204114906823-385277354.png" alt="Redisson ä½¿ç¨æåï¼ä» API è¯¯åºå°çé¨çå¤±æï¼å¨æ­¤ç»ç»åå¸å¼éçå©æ¢¦" class="desc_img">
        å¨ä¸ä¸ç¯ãåå¸å¼éçä»£ä»·ä¸éæ©ï¼ä¸ºä»ä¹æä»¬æç»æ¥æ±äºRedissonï¼ãä¸­ï¼æä»¬èå°äºæå SETNX ç"è¹æ¯é¥®è¡"æ¶ä»£ãæ¢ç¶éæ©äº Redissonï¼å°±æå³çæä»¬å·²ç»åå«äºé£äºè®©äººæå¿åèçæ­»éå©æ¢¦ã
å¾å¤æ¶åï¼æä»¬ä»¥ä¸ºåªæ¯è°ç¨äºä¸ä¸ªç®åç lock.lock()ï¼ä½èåå¶å®æ¯ä¸æ´å¥å¤æçèªå¨ç»­æãLua èæ¬åå­æ§è¡ååå¸è®¢éæºå¶å¨é»é»æ¯æã
è¿ç¯æç« ä¸è®²èçï¼æä»¬ä»å¸¸ç¨ç API èµ·æï¼ä¸è·¯éè¿çäº§ç¯å¢çé¿åå®æï¼æåé»è¿åºå±æ°æ®ç»æä¸ Lua æºç éï¼æ Redisson å½»åºæä¸ªå¹²å¹²ååã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p><strong>åå¨åé¢</strong></p>
<p>å¨ä¸ä¸ç¯<a href="https://mp.weixin.qq.com/s/IkRhzVdLvjr4V3ojdu_4gA" target="_blank" rel="noopener nofollow">ãåå¸å¼éçä»£ä»·ä¸éæ©ï¼ä¸ºä»ä¹æä»¬æç»æ¥æ±äºRedissonï¼ã</a>ä¸­ï¼æä»¬èå°äºæå <code>SETNX</code> ç"è¹æ¯é¥®è¡"æ¶ä»£ãæ¢ç¶éæ©äº <strong>Redisson</strong>ï¼å°±æå³çæä»¬å·²ç»åå«äºé£äºè®©äººæå¿åèçæ­»éå©æ¢¦ã</p>
<p>å¾å¤æ¶åï¼æä»¬ä»¥ä¸ºåªæ¯è°ç¨äºä¸ä¸ªç®åç <code>lock.lock()</code>ï¼ä½èåå¶å®æ¯ä¸æ´å¥å¤æç<strong>èªå¨ç»­æ</strong>ã<strong>Lua èæ¬åå­æ§è¡</strong>å<strong>åå¸è®¢éæºå¶</strong>å¨é»é»æ¯æã</p>
<p>è¿ç¯æç« ä¸è®²èçï¼æä»¬ä»<strong>å¸¸ç¨ç API</strong> èµ·æï¼ä¸è·¯éè¿<strong>çäº§ç¯å¢çé¿åå®æ</strong>ï¼æåé»è¿<strong>åºå±æ°æ®ç»æä¸ Lua æºç </strong>éï¼æ Redisson å½»åºæä¸ªå¹²å¹²ååã</p>
</blockquote>
<hr>
<h2 id="ä¸ä¸ä»æ¯-lock-è¿ä¹ç®åæ ¸å¿-api-å¨æ¯">ä¸ãä¸ä»æ¯ Lock è¿ä¹ç®åï¼æ ¸å¿ API å¨æ¯</h2>
<p>Redisson ä¹æä»¥åæ¬¢è¿ï¼æ¯å ä¸ºå®æåå¸å¼éå°è£æäºæä»¬æçæç <code>java.util.concurrent.locks.Lock</code> æ¥å£é£æ ¼ï¼<strong>æå¤§å°éä½äºå­¦ä¹ ææ¬</strong>ãä½é¤äºæåºç¡ç <code>lock()</code>ï¼è¿ææ ¸å¿åè½æ¯ä½ å¿é¡»ææ¡çã</p>
<h3 id="1-åºç¡é£æérlock">1. åºç¡é£æéï¼<code>RLock</code></h3>
<p>è¿æ¯ <strong>90% åºæ¯ä¸</strong>çé»è®¤éæ©ãå®å¯¹åº Redis åºå±ç <strong>Hash</strong> ç»æã</p>
<pre><code class="language-java">RLock lock = redisson.getLock("order:1001");
lock.lock(); // é»å¡å¼ç­å¾ï¼é»è®¤ 30ç§è¿æï¼èªå¸¦çé¨ç
try {
   // ä¸å¡é»è¾
} finally {
   lock.unlock();
}
</code></pre>
<h3 id="2-æ´èªæçétrylock-ï¸æ¨è">2. æ´èªæçéï¼<code>tryLock</code> (â¡ï¸æ¨è)</h3>
<p>å¨å®éä¸å¡ä¸­ï¼æä»¬å¾å¾ä¸å¸æçº¿ç¨æ éæ­»ç­ï¼æµªè´¹èµæºãè¿éæä¸¤ç§å¸¸è§å§¿å¿ï¼</p>
<h4 id="å§¿å¿-aè¦ç­å¾--å¯ç¨çé¨ç-æå¸¸ç¨">å§¿å¿ Aï¼è¦ç­å¾ + å¯ç¨çé¨ç (æå¸¸ç¨)</h4>
<p>åªæå® <code>waitTime</code>ï¼ä¸æå® <code>leaseTime</code>ãè¿æ¯<strong>æ¢æ³è¦éé»å¡ï¼ææéç­å¾ï¼ï¼åæ³è¦èªå¨ç»­æ</strong>çæä½³å®è·µã</p>
<pre><code class="language-java">// åæ°1ï¼wait timeï¼æåªæ¿ææé 3ç§ï¼æ¿ä¸å°å°±èµ°äºº
// åæ°2ï¼æ¶é´åä½
// éç¹ï¼æ²¡ä¼  leaseTimeï¼æä»¥çé¨çæºå¶ä¼èªå¨çæï¼
boolean res = lock.tryLock(3, TimeUnit.SECONDS);

if (res) {
   try {
     // å¤çä¸å¡ï¼åªæè· 5åé ä¹ä¸æéè¿æï¼
   } finally {
     lock.unlock();
   }
} else {
   log.warn("æ¢éå¤±è´¥ï¼å«æ¤äºï¼");
}
</code></pre>
<h4 id="å§¿å¿-bè¦ç­å¾--èªå¨è¿æ-æç¨">å§¿å¿ Bï¼è¦ç­å¾ + èªå¨è¿æ (æç¨)</h4>
<p>æå®äº <code>leaseTime</code>ï¼çé¨çä¼å¤±æã</p>
<pre><code class="language-java">// åæ°1ï¼wait timeï¼æé 3ç§
// åæ°2ï¼lease timeï¼ä¸éå 10ç§ èªå¨å¼ºå¶éæ¾ï¼æ³¨æï¼æå® leaseTime ä¼è®©çé¨çå¤±æï¼ï¼
// åæ°3ï¼æ¶é´åä½
boolean res = lock.tryLock(3, 10, TimeUnit.SECONDS);

if (res) {
   try {
     // å¤çä¸å¡ï¼å¿é¡»ä¿è¯å¨ 10ç§ åå®æï¼
   } finally {
     lock.unlock();
   }
}
</code></pre>
<h3 id="3-ææçæéå¬å¹³é-fairlock">3. ææçæéï¼å¬å¹³é <code>FairLock</code></h3>
<p>é»è®¤çéæ¯<strong>éå¬å¹³</strong>çï¼Non-Fairï¼ï¼çº¿ç¨æ¢éå¨é  CPU è°åº¦ï¼è°å¿«è°å¾ãä½å¦æä½ çä¸å¡è¦æ±"åæ¥åå°"ï¼æ¯å¦æ¢ç¥¨æéï¼ï¼è¯·å¡å¿ä½¿ç¨å¬å¹³éã</p>
<pre><code class="language-java">// åé¨å©ç¨ Redis ç Listï¼ä½ä¸ºçº¿ç¨ç­å¾éåï¼å Hashï¼ä½ä¸ºè¶æ¶è®°å½ï¼å®ç°
RLock fairLock = redisson.getFairLock("ticket:queue");
fairLock.lock();
</code></pre>
<h3 id="4-è¯»å¤åå°çç¥å¨è¯»åé-readwritelock">4. è¯»å¤åå°çç¥å¨ï¼è¯»åé <code>ReadWriteLock</code></h3>
<p>è¿ä¸ªåºæ¯å¤ªç»å¸äºï¼ååè¯¦æé¡µï¼è¯»çäººå¤ï¼10000æ¬¡/ç§ï¼ï¼æ¹åºå­çäººå°ï¼1æ¬¡/ç§ï¼ãå¦æå¨äºæ¥ï¼æ§è½ç´æ¥å´©çã</p>
<pre><code class="language-java">RReadWriteLock rwLock = redisson.getReadWriteLock("product:stock:101");

// è¯»éï¼å¤ä¸ªçº¿ç¨å¯ä»¥åæ¶å è¯»éï¼åªè¦æ²¡æåé
rwLock.readLock().lock();

// åéï¼å¿é¡»ç­ææè¯»éååéé½éæ¾äºæè½å ï¼å¨äºæ¥
rwLock.writeLock().lock();
</code></pre>
<h3 id="5-èé-multilock-åå­æ§å å¤æé">5. èé <code>MultiLock</code> (åå­æ§å å¤æé)</h3>
<p>ææ¶åæä»¬éè¦åæ¶éå®å¤ä¸ªèµæºï¼æ¯å¦"åºå­"å"ä½é¢"ï¼è¦ä¹é½éä½ï¼è¦ä¹é½ä¸éï¼<strong>é²æ­¢æ­»é</strong>ã</p>
<pre><code class="language-java">RLock lock1 = redisson.getLock("lock:order");
RLock lock2 = redisson.getLock("lock:stock");
// åæ¶å éï¼lock1 lock2
RedissonMultiLock lock = new RedissonMultiLock(lock1, lock2);
lock.lock();
</code></pre>
<hr>
<h2 id="äºæå¼åºå±hash-ç»æä¸-lua-èæ¬">äºãæå¼åºå±ï¼Hash ç»æä¸ Lua èæ¬</h2>
<blockquote>
<p>ä»¥ä¸æºç åºäº <strong>Redisson 3.16+</strong> çæ¬ï¼ç®åçäº§ç¯å¢ä¸»æµçæ¬ï¼åæã</p>
</blockquote>
<p>Redisson ä¸ºä»ä¹è½å®ç°<strong>å¯éå¥é</strong>ï¼ä¸ºä»ä¹å®æ¯æä»¬èªå·±åç SETNX å¼ºï¼<br>
ç­æ¡èå¨ Redis çæ°æ®ç»æéãRedisson å¹¶æ²¡æä½¿ç¨ç®åç <code>String</code> ç±»åï¼èæ¯ä½¿ç¨äº <strong><code>Hash</code></strong>ã</p>
<h3 id="1-redis-éçæ ·å­">1. Redis éçæ ·å­</h3>
<p>åè®¾æä»¬å¯¹ <code>order:1001</code> å éï¼Redis éå®éå­å¨çæ°æ®é¿è¿æ ·ï¼</p>
<pre><code class="language-bash">KEY: order:1001
TYPE: Hash

# hash å¯¹åº value åå®¹
{
    "UUID:ThreadID" : 1  # éçææè : éå¥æ¬¡æ°
}
</code></pre>
<ul>
<li><strong>KEY</strong>: éçåå­ã</li>
<li><strong>FIELD</strong> (Key): <code>UUID:ThreadId</code>ãè¿éç±å®¢æ·ç«¯çæçå¯ä¸ UUID å ä¸å½åçº¿ç¨ ID æ¼æ¥èæã<strong>ä¸ºä»ä¹è¦å  UUIDï¼</strong> å ä¸ºä¸åæå¡å¨ä¸ç JVM è¿ç¨ ID å¯è½ä¸æ ·ï¼å¿é¡»éè¿å®¢æ·ç«¯å¯å¨æ¶çæç UUIDï¼ConnectionManagerIdï¼æ¥å¯ä¸æ è¯ä¸ä¸ª Redisson å®ä¾ã</li>
<li><strong>VALUE</strong>: <code>1</code>ãè¿æ¯éå¥è®¡æ°å¨ãå¦æåä¸ä¸ªçº¿ç¨å lock ä¸æ¬¡ï¼è¿éåæ 2ã</li>
</ul>
<h3 id="2-å éç-lua-èæ¬">2. å éç Lua èæ¬</h3>
<p>Redisson ä¸ºäºä¿è¯ä¸ç³»åå¤æ­ååå¥æ¯åå­çï¼æå®å°è£å¨ Lua èæ¬éåç» Redisã</p>
<pre><code class="language-lua">-- KEYS[1] = éåç§°
-- ARGV[1] = è¿ææ¶é´ (é»è®¤ 30000ms)
-- ARGV[2] = éææèå¯ä¸ID (UUID:ThreadId)

-- æåµ 1ï¼éæ ¹æ¬ä¸å­å¨
if (redis.call('exists', KEYS[1]) == 0) then
    -- åå»º Hashï¼è®¾ç½®éå¥æ¬¡æ°ä¸º 1
    redis.call('hincrby', KEYS[1], ARGV[2], 1);
    -- è®¾ç½®è¿ææ¶é´
    redis.call('pexpire', KEYS[1], ARGV[1]);
    return nil; -- è¿å null è¡¨ç¤ºå éæå
end;

-- æåµ 2ï¼éå­å¨ï¼ä¸ææèå°±æ¯æï¼éå¥ï¼
if (redis.call('hexists', KEYS[1], ARGV[2]) == 1) then
    -- éå¥æ¬¡æ° +1
    redis.call('hincrby', KEYS[1], ARGV[2], 1);
    -- éæ°ç»­æ
    redis.call('pexpire', KEYS[1], ARGV[1]);
    return nil;
end;

-- æåµ 3ï¼éå­å¨ï¼ä½ä¸æ¯æ
-- è¿åå½åéè¿å©å¤å°æ¯«ç§è¿æï¼æ¹ä¾¿å®¢æ·ç«¯ç­å¾
return redis.call('pttl', KEYS[1]);
</code></pre>
<p>è¿æ®µèæ¬å®ç¾è§£éäºï¼</p>
<ol>
<li><strong>åå­æ§</strong>ï¼è¿ä¸å¤§å¨é»è¾å¨ Redis éæ¯åå­æ§è¡çï¼ä¸ä¼æéã</li>
<li><strong>å¯éå¥</strong>ï¼éè¿ <code>hexists</code> å¤æ­æ¯ä¸æ¯èªå·±ï¼æ¯çè¯å°± <code>hincrby</code>ã</li>
<li><strong>äºæ¥æ§</strong>ï¼å¦ææ¢ä¸æ¯æ°éï¼ä¹ä¸æ¯èªå·±çéï¼ç´æ¥è¿åå©ä½æ¶é´ï¼è®©ä½ å¯ä»¥å»ç¡ä¸ä¼å¿åæ¥ã</li>
</ol>
<hr>
<h2 id="ä¸æå¼çé¨ççé»çæºç æ¼«æ¸¸">ä¸ãæå¼çé¨ççé»çï¼æºç æ¼«æ¸¸</h2>
<p>ç»å¸¸å¬è¯´"çé¨ç"ï¼å®å°åºé¿ä»ä¹æ ·ï¼<br>
å¶å®ï¼å®æ¬è´¨ä¸æ¯ä¸ä¸ª <strong>HashedWheelTimerï¼æ¶é´è½®ï¼</strong> é©±å¨çå®æ¶ä»»å¡ã</p>
<h3 id="1-å¯å¨å¥å£">1. å¯å¨å¥å£</h3>
<p>å½æä»¬è°ç¨ <code>lock()</code> <strong>ä¸ä¼ æ¶é´</strong>æ¶ï¼æç»ä¼èµ°å°è¿éï¼</p>
<pre><code class="language-java">// RedissonLock.java
private void lock(long leaseTime, TimeUnit unit, boolean interruptibly) throws InterruptedException {
    long threadId = Thread.currentThread().getId();
    Long ttl = tryAcquire(leaseTime, unit, threadId);

    // å¦æ lock æåï¼ttl ä¼è¿å null
    if (ttl == null) {
        return;
    }
    
    // å¦æå¤±è´¥ï¼ä¼è®¢éä¸ä¸ª Redis Channelï¼ç­å¾ééæ¾çæ¶æ¯ï¼ä¸ç¨æ­»å¾ªç¯ç©ºè½¬ï¼
    // ... çç¥è®¢éé»è¾
}
</code></pre>
<p>å³é®å¨ <code>tryAcquireAsync</code> éï¼</p>
<pre><code class="language-java">private &lt;T&gt; RFuture&lt;Long&gt; tryAcquireAsync(long leaseTime, TimeUnit unit, long threadId) {
    if (leaseTime != -1) {
        // å¦æä½ ä¼ äºæ¶é´ï¼å°±æä½ çæ¶é´èµ°ï¼ä¸å¯å¨çé¨ç
        return tryLockInnerAsync(leaseTime, unit, threadId, RedisCommands.EVAL_LONG);
    }
    
    // æ²¡ä¼ æ¶é´ï¼leaseTime = -1ï¼
    // åè®¾ç½®é»è®¤ 30ç§ è¿æ
    RFuture&lt;Long&gt; ttlRemainingFuture = tryLockInnerAsync(commandExecutor.getConnectionManager().getCfg().getLockWatchdogTimeout(), TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);
    
    // å éæååï¼å¼å¯ç»­æä»»å¡
    ttlRemainingFuture.onComplete((ttlRemaining, e) -&gt; {
        if (e == null) {
           if (ttlRemaining == null) {
               // éç¹ï¼å¯å¨å®æ¶ç»­æ
               scheduleExpirationRenewal(threadId);
           }
        }
    });
    return ttlRemainingFuture;
}
</code></pre>
<h3 id="2-ç»­æçæ éå¥å¨">2. ç»­æçæ éå¥å¨</h3>
<p><code>scheduleExpirationRenewal</code> æç»ä¼è°ç¨ <code>renewExpiration</code>ï¼</p>
<pre><code class="language-java">private void renewExpiration() {
    // è¿éç 1/3 æ¯ç¡¬ç¼ç çè§å
    // é»è®¤ lockWatchdogTimeout æ¯ 30000ms
    // æä»¥æ¯ 10000ms æ§è¡ä¸æ¬¡
    Timeout task = commandExecutor.getConnectionManager().newTimeout(new TimerTask() {
        @Override
        public void run(Timeout timeout) throws Exception {
            
            // æ§è¡ Lua èæ¬ï¼æ ttl éæ°å·å 30ç§
            RFuture&lt;Boolean&gt; future = renewExpirationAsync(threadId);
            
            future.onComplete((res, e) -&gt; {
                if (res) {
                    // å¦æç»­ææåï¼è¿å°±å½¢æäºéå½è°ç¨ï¼èªå·±è°èªå·±
                    renewExpiration();
                }
            });
        }
    }, internalLockLeaseTime / 3, TimeUnit.MILLISECONDS);
}
</code></pre>
<p><strong>æ ¸å¿é»è¾æ»ç»</strong>ï¼</p>
<ol>
<li><strong>ä¸åä¹ä¸åå</strong>ï¼æ¯ééè¶æ¶æ¶é´ç 1/3ï¼é»è®¤10ç§ï¼ï¼æ£æ¥ä¸æ¬¡ã</li>
<li><strong>æ ééå½</strong>ï¼åªè¦æ£æ¥å°éè¿å¨ï¼å°±éç½®è¿ææ¶é´ï¼å¹¶æ³¨åä¸ä¸æ¬¡æ£æ¥ã</li>
<li><strong>çæ­»ç»å®</strong>ï¼è¿ä¸ªä»»å¡è·å¨å®¢æ·ç«¯è¿ç¨éï¼å¦æå®¢æ·ç«¯å®æºï¼ä»»å¡åæ­¢ï¼Redis éçéå¨ 30ç§ åèªå¨è¿æã</li>
</ol>
<hr>
<h2 id="åæå¨çäº§ç¯å¢è¸©è¿çåé¿åå®æ">åãæå¨çäº§ç¯å¢è¸©è¿çåï¼é¿åå®æ</h2>
<p>API è°é½ä¼è°ï¼ä½è½é¿å¼åçææ¯èå¸æºãè¿å­ä¸ªåï¼é½æ¯çéç½é¶æ¢æ¥çæè®­ã</p>
<h3 id="-é·é±ä¸å¥½å¿ååäº--å¼æ­»çé¨ç">ð£ é·é±ä¸ï¼å¥½å¿ååäº ââ å¼æ­»çé¨ç</h3>
<p>è¿æ¯æ°ææå®¹æç¯çéã</p>
<p><strong>â éè¯¯å§¿å¿</strong>ï¼</p>
<pre><code class="language-java">// æææ­»éï¼æä»¥å¼ºè¡æå® 10ç§ è¿æ
lock.lock(10, TimeUnit.SECONDS); 
// æè
lock.tryLock(1, 10, TimeUnit.SECONDS);
</code></pre>
<p><strong>â ï¸ åæ</strong>ï¼<br>
<strong>Redisson ççé¨çï¼WatchDogï¼æºå¶åªæå¨ä½ <code>æªæå®</code>éè¿ææ¶é´æ¶æä¼çæï¼</strong><br>
ä¸æ¦ä½ æå¨ä¼ äº <code>leaseTime</code>ï¼Redisson å°±ä¼è®¤ä¸ºä½ æèªå·±çæ³æ³ï¼ä¸åææãå¦æä½ çä¸å¡å ä¸ºæ°æ®åºå¡é¡¿è·äº 15ç§ï¼ç¬¬ 10ç§ æ¶éå°±ä¼å¼ºå¶è¿æï¼å¶ä»çº¿ç¨é¿é©±ç´å¥ï¼çåå¹¶åäºæã</p>
<p><strong>â æ­£ç¡®å§¿å¿</strong>ï¼<br>
é¤éä½ éå¸¸ç¡®å®ä¸å¡è½å¨æå®æ¶é´åè·å®ï¼å¦å<strong>å°½éä¸è¦ä¼  leaseTimeï¼è®©çé¨çå¸®ä½ èªå¨ç»­æ</strong>ã</p>
<h3 id="-é·é±äºéç²åº¦å¤ªç²--å¨ææåé®">ð£ é·é±äºï¼éç²åº¦å¤ªç² ââ å¨ææåé®</h3>
<p><strong>â éè¯¯å§¿å¿</strong>ï¼</p>
<pre><code class="language-java">// ææè®¢åå±ç¨ä¸æé
RLock lock = redisson.getLock("LOCK_ORDER");
</code></pre>
<p><strong>â ï¸ åæ</strong>ï¼<br>
è¿ç¸å½äºæé«éå¬è·¯å°æäºç¬æ¨æ¡¥ãä¸ç®¡æå¤å°ä¸ªç¨æ·ä¸åï¼åä¸æ¶é´åªè½å¤çä¸ä¸ªãæ§è½ç´æ¥å½é¶ã</p>
<p><strong>â æ­£ç¡®å§¿å¿</strong>ï¼<br>
<strong>éçç²åº¦è¶ç»è¶å¥½</strong>ãåªéé£ä¸ªå·ä½äº§çç«äºçèµæº IDã</p>
<pre><code class="language-java">// åªéè¿ä¸ªè®¢å
RLock lock = redisson.getLock("order:pay:" + orderId);
</code></pre>
<h3 id="-é·é±ä¸è§£éçèºæ¯--è°å çéè°æ¥è§£">ð£ é·é±ä¸ï¼è§£éçèºæ¯ ââ è°å çéè°æ¥è§£</h3>
<p><strong>â éè¯¯å§¿å¿</strong>ï¼</p>
<pre><code class="language-java">try {
    // ä¸å¡é»è¾
} finally {
    lock.unlock(); // ç´æ¥è§£é
}
</code></pre>
<p><strong>â ï¸ åæ</strong>ï¼</p>
<ol>
<li>å¦æä¸å¡æ§è¡è¶æ¶ï¼éå·²ç»è¢«èªå¨éæ¾äºï¼ä½ åå» <code>unlock</code> ä¼æåº <code>IllegalMonitorStateException</code>ã</li>
<li>å¦æä¸å°å¿è§£äºå«äººçéï¼è½ç¶ Redisson æ ID æ ¡éªé²æ­¢è¯¯å ï¼ä½å¼å¸¸å¤çä¾ç¶éè¦ï¼ã</li>
</ol>
<p><strong>â æ­£ç¡®å§¿å¿</strong>ï¼</p>
<pre><code class="language-java">if (lock.isLocked() &amp;&amp; lock.isHeldByCurrentThread()) {
    lock.unlock();
}
</code></pre>
<h3 id="-é·é±åéå¥éçéå½å©æ¢¦">ð£ é·é±åï¼éå¥éç"éå½å©æ¢¦"</h3>
<p>Redisson çéè½ç¶æ¯å¯éå¥çï¼Reentrantï¼ï¼ä½å¦æä½ å¨éå½æåµå¥è°ç¨ä¸­ä¸æ³¨æï¼å¾å®¹æé»è¾æ··ä¹±ã</p>
<p><strong>â é£é©ä»£ç </strong>ï¼</p>
<pre><code class="language-java">void methodA() {
    lock.lock();
    try {
        methodB(); // methodB éå lock äºä¸æ¬¡
    } finally {
        lock.unlock(); // åªè§£äºä¸å±
    }
}
</code></pre>
<p><strong>â ï¸ åæ</strong>ï¼<br>
Redis éçéè®¡æ°å¨ï¼Counterï¼å¦æä¸å½é¶ï¼éæ¯ä¸ä¼éæ¾çãç¡®ä¿ä½ çå éæ¬¡æ°åè§£éæ¬¡æ°<strong>ä¸¥æ ¼å¹é</strong>ã</p>
<h3 id="-é·é±äºä¸»ä»åæ¢çå¹½çµé">ð£ é·é±äºï¼ä¸»ä»åæ¢ç"å¹½çµé"</h3>
<p>è¿æ¯ Redis æ¶æå¤©ççç­æ¿ã</p>
<ol>
<li>Client A å¨ <strong>Master</strong> èç¹æ¿å°äºéã</li>
<li>Master è¿æ²¡æ¥å¾åæéåæ­¥ç» Slaveï¼å°±<strong>å®æº</strong>äºã</li>
<li>Slave åçº§ä¸ºæ°ç Masterã</li>
<li>Client B æ¥å éï¼åç°æ° Master ä¸æ²¡éï¼äºæ¯ä¹<strong>å éæå</strong>ã</li>
</ol>
<p><strong>â ï¸ åæ</strong>ï¼<br>
A å B åæ¶ææäºéã<br>
<strong>è§£æ³</strong>ï¼å¦æä½ ä¸è½å®¹å¿è¿ä¸ªæ¦çï¼æä½ï¼ï¼è¯·çä¸æç RedLockï¼æèè½¬æ Zookeeperãå¯¹äº 99% çä¸å¡ï¼æä»¬éæ©<strong>æ¥å</strong>è¿ä¸ªé£é©ã</p>
<hr>
<h2 id="äºredlock-çç±æ¨æä»">äºãRedLock çç±æ¨æä»</h2>
<p>æäºé¢è¯å®ç¹å«åæ¬¢é® RedLockï¼ä½å¨å®éå·¥ä½ä¸­ï¼å®æ¯ä¸ä¸ªè®©äººç±æ¨äº¤å çå­å¨ã</p>
<h3 id="1-å®æ¯ä¸ºäºè§£å³ä»ä¹">1. å®æ¯ä¸ºäºè§£å³ä»ä¹ï¼</h3>
<p>è§£å³ Redis ä¸»ä»éç¾¤å¨ Failoverï¼æéè½¬ç§»ï¼æ¶å¯è½ä¸¢éçé®é¢ã</p>
<h3 id="2-æä¹ç¨">2. æä¹ç¨ï¼</h3>
<p>ä½ éè¦åå¤ <strong>3ä¸ªæ5ä¸ª</strong> å®å¨ç¬ç«ç Redis å®ä¾ï¼ä¸æ¯ Clusterï¼ä¸æ¯ Sentinelï¼å°±æ¯å¹²å¹²ååçåå®ä¾ï¼ã</p>
<pre><code class="language-java">RLock lock1 = redissonInstance1.getLock("lock");
RLock lock2 = redissonInstance2.getLock("lock");
RLock lock3 = redissonInstance3.getLock("lock");

// åå»ºçº¢é
RedissonRedLock lock = new RedissonRedLock(lock1, lock2, lock3);

try {
    // åæ¶å 3ä¸ª Redis ç³è¯·é
    // åªè¦æ &gt; 1.5ä¸ª (å³2ä¸ª) ç³è¯·æåï¼å°±ç®èµ¢
    lock.lock();
    // ä¸å¡é»è¾
} finally {
    lock.unlock();
}
</code></pre>
<h3 id="3-çµé­æ·é®å¼å¾å">3. çµé­æ·é®ï¼å¼å¾åï¼</h3>
<p>æççæ³æ¯ï¼<strong>ä¸å¼å¾</strong>ã</p>
<ul>
<li><strong>è¿ç»´ææ¬é£å</strong>ï¼ä¸ºäºä¸ªéï¼æè¦å¤ç»´æ¤å¥½å ä¸ªç¬ç«ç Redisï¼</li>
<li><strong>æ§è½ææ</strong>ï¼ä¸²è¡æèå¹¶åå»å¤ä¸ªèç¹è¯·æ±ï¼ç½ç»å¼éå¤§ã</li>
<li><strong>å¹¶éç»å¯¹å®å¨</strong>ï¼Martin Kleppmann æåºï¼å¦æåç STWï¼Stop-The-Worldï¼GCï¼æèæ¶éåçè·³è·ï¼RedLock ä¾ç¶å¯è½å¤±æã</li>
</ul>
<p><strong>å»ºè®®</strong>ï¼<br>
å¦æä½ å¨åé¶è¡æ ¸å¿è´¦å¡ç³»ç»ï¼è¯·ç¨ <strong>Zookeeper</strong> æ <strong>Etcd</strong>ã<br>
é¤æ­¤ä¹å¤ç 99% çåºæ¯ï¼<strong>Redisson éåä¸»ä»éç¾¤</strong> å·²ç»è¶³å¤ä¼ç§äºã</p>
<hr>
<blockquote>
<p><strong>ç»è¯­</strong></p>
<p>å¾å¤æ¶åï¼æä»¬å¨ææ¯éåæ¶å®¹æé·å¥"æ¢è¦åè¦"çæªåãä½è½¯ä»¶å·¥ç¨çæ¬è´¨ï¼å°±æ¯<strong>æè¡¡</strong>ï¼Trade-offï¼ã</p>
<p><strong>Redisson</strong> ä¸æ¯ç¥ï¼å®åªæ¯ä¸æè¢«æç£¨å¾è¶³å¤éå©çåãå®ä¸è½è§£å³ææçä¸è´æ§é®é¢ï¼ä½å®å¨<strong>æç¨æ§</strong>ã<strong>æ§è½</strong>å<strong>å¯é æ§</strong>ä¹é´æ¾å°äºä¸ä¸ªæä½³çå¹³è¡¡ç¹ã</p>
<p>å¸æè¿ç¯æç« è½å¸®ä½ ä¸ä»"ä¼ç¨"éï¼æ´è½"æ"éãæ¿ä½ çç³»ç»å¨æ´ªå³°æµéä¸ï¼ä¾ç¶ç¨³å¦æ³°å±±ï¼æ¿ä½ çä»£ç ï¼æ¢æé»è¾çéª¨æ¶ï¼åææ¸©åº¦çè¡èãã</p>
</blockquote>
<hr>
<blockquote>
<p>æç« çæåï¼æ³åä½ å¤èä¸¤å¥ã</p>
<p>ææ¯ä¹è·¯ï¼å¸¸å¸¸æ¯ç­é¹ä¸å­¤ç¬å¹¶å­ãé£äºæ·±å¤çè°è¯ãçµåä¸éªçæ¹æ¡ãè¿æè¸©åç¬èµ·åçé¡¿æï¼å¦æè½æäººä¸èµ·èèï¼è¯¥å¤å¥½ã</p>
<p>ä¸ºæ­¤ï¼æå»ºäºä¸ä¸ªå°è±å­ââæçå¾®ä¿¡å¬ä¼å·ã<strong>[åªåçå°é]</strong>ãã</p>
<p>è¿éæ²¡æé«æ·±è«æµççè®ºå ç ï¼åªææå¯¹åç«¯å¼åãç³»ç»è®¾è®¡åå·¥ç¨å®è·µçæç»­æèä¸æ²æ·ãå®æ´åæç<strong>æ°å­ç¬è®°æ¬</strong>ï¼è®°å½çé£äºå¼å¾è¢«è®°ä½çè§£å³æ¹æ¡åæç»´ç«è±ã</p>
<p>å¦æä½ è§å¾ä»å¤©çæç« è¿æä¸ç¹å¯åï¼æèåçº¯æ³æ¾ä¸ä¸ªåè¡èå¶å°èèææ¯ãè°è°æèï¼é£ä¹ï¼æ¬¢è¿ä½ æ¥ååã<br>
<img alt="85f114bceb12e933bb817ec5fecdfef7" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3703499/202601/3703499-20260105210259813-964799315.jpg" class="lazyload"></p>
<p>æ¿ä½ åè¡è·¯ä¸ï¼æ»æä»£ç å¯åï¼ææ¢¦å¯è¿½ï¼ä¹æç¯ç«å¯äº²ã</p>
</blockquote>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 11:50">2026-02-04 11:49</span>&nbsp;
<a href="https://www.cnblogs.com/xzqcsj">ä¸æäºº</a>&nbsp;
éè¯»(<span id="post_view_count">22</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19573422);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19573422', targetLink: 'https://www.cnblogs.com/xzqcsj/p/19573422', title: 'Redisson ä½¿ç¨æåï¼ä» API è¯¯åºå°çé¨çå¤±æï¼å¨æ­¤ç»ç»åå¸å¼éçå©æ¢¦' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ kubectl top æ²¡æ°æ®ï¼ä¸æ¬¡ä» metrics-server è¿½å° kubelet feature gate çææ¥ï¼OrbStack 2.0.5ï¼ ]]></title>
    <link>https://www.cnblogs.com/suknna/p/19573394</link>
    <guid>0e715337ce2268cfc719960299ac7b8e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/suknna/p/19573394" title="åå¸äº 2026-02-04 11:44">
    <span role="heading" aria-level="2">kubectl top æ²¡æ°æ®ï¼ä¸æ¬¡ä» metrics-server è¿½å° kubelet feature gate çææ¥ï¼OrbStack 2.0.5ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ¥æï¼2026-02-04</p>
<p>ç¯å¢ä¿¡æ¯ï¼</p>
<ul>
<li>OrbStackï¼2.0.5 (19905)</li>
<li>kubectlï¼v1.32.7</li>
<li>kube-apiserver / kubeletï¼éç¾¤ï¼ï¼v1.33.5+orb1</li>
</ul>
<ol>
<li>é®é¢åºç°ï¼<code>kubectl top</code> å¤±çµ</li>
</ol>
<hr>
<p>ææ³å¨æ¬å°éç¾¤éçä¸ä¸ Pod çèµæºä½¿ç¨éï¼ææ¯ä¾è·ï¼</p>
<pre><code class="language-bash">kubectl top pod -A
</code></pre>
<p>è¿ä¸æ­¥å¦ææ­£å¸¸ï¼åºè¯¥è½çå°æ¯ä¸ª Pod ç CPU(cores)/MEMORY(bytes)ã</p>
<p>ä½ç°å®æ¯ï¼<code>top</code> æ²¡æææ å¯ç¨ï¼å¸åè¡¨ç°æ¯æ æ°æ®æ Metrics not available ä¹ç±»çæç¤ºï¼ãç´è§åè¯æï¼metrics-server å¯è½æ²¡è£å¥½ã</p>
<ol start="2">
<li>åä¸è¦å¨ metrics-serverï¼åæé¾è·¯çæ¸æ¥</li>
</ol>
<hr>
<p><code>kubectl top</code> çæ°æ®æ¥æºæ¯ <code>metrics.k8s.io</code> APIï¼è <code>metrics.k8s.io</code> æ¯ metrics-server èååºæ¥çãmetrics-server æ¬èº«ä¸ééï¼å®å»åèç¹ kubelet æææ ã</p>
<p>æä»¥é¾è·¯æ¯è¿æ ·çï¼</p>
<ul>
<li>kubelet æ´é² Summary APIï¼<code>/stats/summary</code></li>
<li>metrics-server æ Summary APIï¼æç¸å³ kubelet statsï¼</li>
<li>metrics-server çæ <code>metrics.k8s.io</code></li>
<li><code>kubectl top</code> è¯»å <code>metrics.k8s.io</code></li>
</ul>
<p>ç»è®ºï¼ææ¥æ¶å¿é¡»åç¡®è®¤ kubelet ææ²¡æâåææâã</p>
<ol start="3">
<li>metrics å±ææ¥ï¼API è¿å¨ï¼ä½å¯è½åªæ¯ç©ºè½¬</li>
</ol>
<hr>
<p>æåç´æ¥ç <code>metrics.k8s.io</code> æ¯å¦è¿ååå®¹ï¼</p>
<pre><code class="language-bash">kubectl get --raw "/apis/metrics.k8s.io/v1beta1/pods" | head
</code></pre>
<p>å½å®è¿å <code>PodMetricsList</code> æ¶ï¼è¯´æ metrics-server è³å°æ´»çãAPI è·¯ç±ä¹éã<br>
ä½è¿ä¸ä»£è¡¨æ°æ®å°±å®æ´ï¼å ä¸º metrics-server å¯è½åªæ¯æ¿å°äºä¸é¨åï¼æè kubelet æ ¹æ¬æ²¡å Pod/Container statsã</p>
<p>æ¥çç metrics-server æ¥å¿ï¼ç¨äºç¡®è®¤å®æ¯å¦å¨æ±æ¨ kubeletï¼ï¼</p>
<pre><code class="language-bash">kubectl -n kube-system logs deploy/metrics-server --tail=200
</code></pre>
<p>Kubernetes ç¤¾åºéæä¸ç±»éå¸¸å¸åçéè¯¯ï¼metrics-server æ kubelet ç <code>/stats/summary</code> æ¶å¾å° 500ï¼ç¶å <code>kubectl top</code> æ²¡æ°æ®ã[1]</p>
<ol start="4">
<li>kubelet å±ææ¥ï¼Summary API ææ¯çç¸</li>
</ol>
<hr>
<p>æ¢ç¶ metrics-server åªæ¯ä¸­é´åï¼é£å°±ç»è¿å®ï¼ç´æ¥æ¥ kubelet Summary APIã</p>
<p>ååä¸ä¸ª node åï¼</p>
<pre><code class="language-bash">NODE="$(kubectl get node -o name | head -n1 | cut -d/ -f2)"
</code></pre>
<p>ç¶åéè¿ apiserver proxy è¯·æ±ï¼</p>
<pre><code class="language-bash">kubectl get --raw "/api/v1/nodes/$NODE/proxy/stats/summary" | head
</code></pre>
<p>å³é®ç¹å¨ <code>pods</code> å­æ®µãæç¨ <code>rg</code> å¿«éå®ä½ï¼</p>
<pre><code class="language-bash">kubectl get --raw "/api/v1/nodes/$NODE/proxy/stats/summary" | rg '"pods"' -n
</code></pre>
<p>å½æ¶çæ ¸å¿ç°è±¡æ¯ï¼Summary é Pod/Container çº§å«ç»è®¡ä¸å¯¹å²ï¼å¸¸è§å°±æ¯ <code>pods</code> ä¸ºç©ºæç¼ºå¤±ï¼ã<br>
è¿å°±è§£éäºä¸ºä»ä¹ <code>kubectl top</code> æ²¡æ³å·¥ä½ï¼ä¸æ¸¸æ ¹æ¬æ¿ä¸å° Pod çèµæºä½¿ç¨éã</p>
<ol start="5">
<li>æ¥ GitHubï¼OrbStack issue ç»äºç­æ¡</li>
</ol>
<hr>
<p>å°è¿ä¸æ­¥ï¼é®é¢ä»âmetrics-server éç½®âåæäºâkubelet ç stats ä»åªéæ¥âã</p>
<p>ç»§ç»­æç´¢åï¼æ¾å°äº OrbStack çç¸å³ issueï¼</p>
<p><a href="https://github.com/orbstack/orbstack/issues/2143" target="_blank" rel="noopener nofollow">https://github.com/orbstack/orbstack/issues/2143</a></p>
<p>éé¢æå°ï¼éè¦å¨ kubelet éç½®ä¸­å¼å¯ä¸ä¸ª feature gateï¼</p>
<pre><code class="language-yaml">featureGates:
  PodAndContainerStatsFromCRI: true
</code></pre>
<ol start="6">
<li>ä¿®å¤ï¼å¨ kubelet éç½®éå¼å¯ <code>PodAndContainerStatsFromCRI</code></li>
</ol>
<hr>
<p>æå¨ OrbStack ç Kubernetes è®¾ç½®é¡µï¼Kubelet Configurationï¼éå ä¸ï¼</p>
<pre><code class="language-yaml">apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
featureGates:
  PodAndContainerStatsFromCRI: true
</code></pre>
<p>åºç¨å¹¶éå¯éç¾¤åï¼åéªè¯ï¼</p>
<pre><code class="language-bash">kubectl top pod -A
kubectl get --raw "/apis/metrics.k8s.io/v1beta1/pods" | head
kubectl get --raw "/api/v1/nodes/$NODE/proxy/stats/summary" | rg '"pods"' -n
</code></pre>
<p>è¿æ¬¡ <code>kubectl top</code> æ­£å¸¸è¾åºï¼<code>metrics.k8s.io</code> ä¹è½çå°å®¹å¨çº§ç <code>usage.cpu</code> / <code>usage.memory</code>ã</p>
<ol start="7">
<li>è¿ä¸ªéç½®çä½ç¨ï¼ä¸ºä»ä¹å äºå®å°±å¥½ï¼</li>
</ol>
<hr>
<p>Kubernetes å®æ¹ææ¡£å¯¹è¿ä¸ªå¼å³çè§£éå¾æç¡®ï¼</p>
<ul>
<li>é»è®¤æåµä¸ï¼kubelet ä½¿ç¨ååµ cAdvisor è·åèç¹æ¦è¦ææ æ°æ®</li>
<li>å¦æå¯ç¨ <code>PodAndContainerStatsFromCRI</code>ï¼å¹¶ä¸å®¹å¨è¿è¡æ¶æ¯æéè¿ CRI è®¿é®ç»è®¡ä¿¡æ¯ï¼é£ä¹ kubelet ä¼æ¹ä¸ºéè¿ CRI è·å Pod/å®¹å¨çº§å«ææ ï¼èä¸æ¯ä» cAdvisor è·åã[2]</li>
</ul>
<p>æå®ç¿»è¯æä¸å¥è¯å°±æ¯ï¼</p>
<p>è®© kubelet âå«èªå·±çâï¼èæ¯âç´æ¥é®å®¹å¨è¿è¡æ¶ï¼CRIï¼ä½ å°åºç¨äºå¤å° CPU/åå­âã</p>
<p>å¨ OrbStack è¿ç§âæ¬å°èæåå°è£å¾æ·±âçç¯å¢éï¼cAdvisor çè§æµè·¯å¾å¯è½ä¸å®æ´ï¼æ¹èµ° CRI stats ä¹åï¼kubelet è½æ¿å°æ´å¯é ç Pod/Container ç»è®¡ï¼äºæ¯ Summary API åå®æ´ï¼metrics-server ææä¸è¥¿å¯èåï¼<code>kubectl top</code> æè½æ¢å¤ã</p>
<ol start="8">
<li>æ¶è·ï¼ä»¥åéå° <code>kubectl top</code> é®é¢æä¹æå¿«å®ä½ï¼</li>
</ol>
<hr>
<p>ææææ¥é¡ºåºåºå®æä¸æ­¥ï¼åºæ¬å°±ä¸ä¼èµ°å¼¯è·¯ï¼</p>
<p>1ï¼çèåå±ï¼<code>metrics.k8s.io</code> æ¯å¦ææ°æ®</p>
<pre><code class="language-bash">kubectl get --raw "/apis/metrics.k8s.io/v1beta1/pods" | head
</code></pre>
<p>2ï¼çæºå¤´ï¼kubelet Summary API ç <code>pods</code> æ¯å¦æ­£å¸¸</p>
<pre><code class="language-bash">kubectl get --raw "/api/v1/nodes/$NODE/proxy/stats/summary" | rg '"pods"' -n
</code></pre>
<p>3ï¼å¦æ Summary ç pod stats ä¸æ­£å¸¸ï¼åå»æ¾âè¯¥åè¡ç/ç¯å¢âçå·²ç¥é®é¢<br>
è¿æ¬¡å°±æ¯ OrbStack issue ç´æ¥ç»äº feature gate çè§£æ³ã</p>
<ol start="9">
<li>å»¶ä¼¸éè¯»</li>
</ol>
<hr>
<ul>
<li>
<p>OrbStack issueï¼æ¬æ¬¡ç´æ¥çº¿ç´¢ï¼ï¼<code>orbstack/orbstack#2143</code><br>
<a href="https://github.com/orbstack/orbstack/issues/2143" target="_blank" rel="noopener nofollow">https://github.com/orbstack/orbstack/issues/2143</a></p>
</li>
<li>
<p>Kubernetes å®æ¹ææ¡£ï¼Node metricsãSummary APIãä»¥å <code>PodAndContainerStatsFromCRI</code> çè¯´æ<br>
<a href="https://kubernetes.io/zh-cn/docs/reference/instrumentation/node-metrics/" target="_blank" rel="noopener nofollow">https://kubernetes.io/zh-cn/docs/reference/instrumentation/node-metrics/</a>  [2]</p>
</li>
<li>
<p>Kubernetes issueï¼metrics-server æ <code>/stats/summary</code> è¿å 500ã<code>kubectl top</code> æ æ°æ®çå¸åæ¡ä¾ï¼ç¨äºå¯¹ç§çç¶ï¼<br>
<a href="https://github.com/kubernetes/kubernetes/issues/111276" target="_blank" rel="noopener nofollow">https://github.com/kubernetes/kubernetes/issues/111276</a>  [1]</p>
</li>
</ul>
<h2 id="åè">åè</h2>
<p>[1] <a href="https://github.com/kubernetes/kubernetes/issues/111276" target="_blank" rel="noopener nofollow">https://github.com/kubernetes/kubernetes/issues/111276</a><br>
[2] <a href="https://kubernetes.io/zh-cn/docs/reference/instrumentation/node-metrics/" target="_blank" rel="noopener nofollow">https://kubernetes.io/zh-cn/docs/reference/instrumentation/node-metrics/</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-04 11:44">2026-02-04 11:44</span>&nbsp;
<a href="https://www.cnblogs.com/suknna">suknna</a>&nbsp;
éè¯»(<span id="post_view_count">13</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19573394);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19573394', targetLink: 'https://www.cnblogs.com/suknna/p/19573394', title: 'kubectl top æ²¡æ°æ®ï¼ä¸æ¬¡ä» metrics-server è¿½å° kubelet feature gate çææ¥ï¼OrbStack 2.0.5ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>