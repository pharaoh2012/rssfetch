<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-04T12:31:07.721Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ ãAzure Web AppãGithub Actioné¨ç½²Jaråå°App Serviceæ¥400éè¯¯ ]]></title>
    <link>https://www.cnblogs.com/lulight/p/19439653</link>
    <guid>986b341ddc4b1536bd4322805a099abe</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lulight/p/19439653" title="åå¸äº 2026-01-04 20:07">
    <span role="heading" aria-level="2">ãAzure Web AppãGithub Actioné¨ç½²Jaråå°App Serviceæ¥400éè¯¯</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>é®é¢æè¿°</h1>
<p>éè¿github acitoné¨ç½²azure app serviceæå¡çæ¶åï¼éè§400æ¥éã</p>
<p>æ¥éä¿¡æ¯éå¸¸ç®åï¼</p>
<blockquote>
<p>Starting deployment for web app...<br>Package deployment using OneDeploy initiated.<br>Error: Failed to deploy web package to App Service.<br><span style="color: rgba(255, 0, 0, 1)"><strong>Error: Deployment Failed, Error: Failed to deploy web package using OneDeploy to App Service.</strong></span><br>Bad Request (CODE: 400)</p>
</blockquote>
<p> è¿ä¸ªé®é¢åºè¯¥å¦ä½è°æ¥å¢ï¼</p>
<p>&nbsp;</p>
<h1>é®é¢è§£ç­</h1>
<p>å¨Github Acitonä¸­ï¼ä½¿ç¨ Azure WebApp(azure/webapps-deploy@v3)æ¥é¨ç½²App Serviceçåºç¨, è¿æ¬¡é¨ç½²çæ¯ä¸ä¸ªjaråã</p>
<p>Github Action  èæ¬:</p>
<blockquote>
<p>- name: Azure WebApp<br>uses: azure/webapps-deploy@v3<br>with:<br>app-name: '&lt;app service name&gt;'<br>package: ${{ github.workspace }}/target/*.jar<br> </p>
</blockquote>
<p>æ¥çAzureææ¡£ï¼ä»ç»é¨ç½²javaåºç¨æ¶ï¼ä½¿ç¨az cliå½ä»¤ï¼github actionåmaven æä»¶é½æ¯ä½¿ç¨çKudu OneDeployæ¥å£( https://&lt;your web app&gt;.scm.chinacloudsites.cn/api/publish?type=jar )</p>
<p><img alt="image" width="666" height="235" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202601/2127802-20260104200136753-968729769.png" class="lazyload"></p>
<p>(ææ¡£é¾æ¥ï¼<a href="https://docs.azure.cn/zh-cn/app-service/configure-language-java-deploy-run?tabs=linux&amp;pivots=java-tomcat#deploying-your-app" target="_blank" rel="noopener nofollow">https://docs.azure.cn/zh-cn/app-service/configure-language-java-deploy-run?tabs=linux&amp;pivots=java-tomcat#deploying-your-app</a>)</p>
<p>&nbsp;</p>
<p>æ ¹æ®ä»¥ä¸ä¿¡æ¯ï¼å°±å°è¯ä½¿ç¨az webapp deployå½ä»¤ç´æ¥é¨ç½²jarååºç¨ï¼åç°å¤äºä¸å¥éè¯¯æç¤ºä¿¡æ¯ï¼</p>
<blockquote>
<p><span style="color: rgba(255, 0, 255, 1)">&gt; <strong>az webapp deploy --resource-group &lt;your resource group name&gt; --name &lt;your app service name&gt; --src-path myjava.jar --type jar</strong></span></p>
<p>Initiating deployment<br>Deploying from local path: myjava.jar<br>An error occurred during deployment. Status Code: 400, </p>
<p><strong><span style="color: rgba(255, 0, 0, 1)">Details: "Artifact type = 'Jar' cannot be deployed to stack = 'TOMCAT'. Site should be configured to run with stack = JAVA", </span></strong></p>
<p>Please visit https://XXXXXXXXX.scm.chinacloudsites.cn/api/deployments/latest to get more information about your deployment</p>
</blockquote>
<p>è¿å¥éè¯¯æ¶æ¯éå¸¸å³é®(Artifact type = 'Jar' cannot be deployed to stack = 'TOMCAT'. Site should be configured to run with stack = JAVA")ã</p>
<p>å¨æ¥çApp Serviceçéç½®ä¿¡æ¯åï¼Stackæç¶è®¾ç½®ä¸ºTomcatã</p>
<p><img alt="image" width="666" height="465" loading="lazy" style="border: 2px solid rgba(0, 0, 139, 1)" data-src="https://img2024.cnblogs.com/blog/2127802/202601/2127802-20260104200345561-1920215021.png" class="lazyload"></p>
<p>å ä¸ºè¿éåªæä¸¤ç§éé¡¹( Tomcat åJava SE )ãäºæ¯ï¼ä¿®æ¹ä¸ºJava SEåï¼åæ¬¡é¨ç½²jaråã</p>
<p><img alt="image" width="666" height="194" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202601/2127802-20260104200429417-812362535.png" class="lazyload"></p>
<p>æåã</p>
<p>&nbsp;</p>
<p>å½é®é¢è§£å³åï¼æ³è¿ä¸æ­¥éªè¯æ¯å¦æ¯one deployæ¥å£å¯¹jaråçå¼ºå¶éå¶ã</p>
<p>æ°å¥½kuduä¹æ¯å¼æºé¡¹ç®ï¼æä»¥ï¼è¿å¥github kudu ä»åº (æºç ï¼<a href="https://github.com/projectkudu/kudu/tree/master" target="_blank" rel="noopener nofollow">https://github.com/projectkudu/kudu/tree/master</a> )ï¼ä½¿ç¨éè¯¯æ¶æ¯å³é®å­æ´åºæç´¢âcannot be deployed to stackâï¼æç»ï¼å®ä½å° PushDeploymentController.cs ä¸­ï¼æå¦ä¸çéªè¯æ¡ä»¶ï¼</p>
<ul>
<li>å½é¨ç½²çæä»¶ä¸ºJaræ¶ï¼éè¦å¤æ­ç®æ App ServiceçStackåªè½æ¯JavaSEãå¦æä¸æ¯ï¼è¿å400çç¶æç </li>
</ul>
<p><img alt="image" width="666" height="110" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202601/2127802-20260104200518388-1579422340.png" class="lazyload"></p>
<p>&nbsp;</p>
<h2>éå½ä¸ï¼ä½¿ç¨ curl å½ä»¤ç´æ¥è°ç¨æ¥å£ä¹å¯ä»¥å¤ç°é®é¢ï¼ææåaz webapp deployå½ä»¤ç¸å</h2>
<div class="cnblogs_code">
<pre><span style="background-color: rgba(255, 255, 0, 1)">curl -<span style="color: rgba(0, 0, 0, 1)">X POST \

     </span>-<span style="color: rgba(0, 0, 0, 1)">u user:password \

     </span>-T <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">/Users/Downloads/xxxxx-0.0.1-SNAPSHOT.jar</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)"> \

     </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">https://xxxxx.scm.chinacloudsites.cn/api/publish?type=jar</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)"> \

     </span>-<span style="color: rgba(0, 0, 0, 1)">v



</span></span>* Host xxxxx.scm.chinacloudsites.cn:<span style="color: rgba(128, 0, 128, 1)">443</span><span style="color: rgba(0, 0, 0, 1)"> was resolved.

</span>*<span style="color: rgba(0, 0, 0, 1)"> IPv6: (none)

</span>* IPv4: <span style="color: rgba(128, 0, 128, 1)">159.27</span>.<span style="color: rgba(128, 0, 128, 1)">20.0</span>

*   Trying <span style="color: rgba(128, 0, 128, 1)">159.27</span>.<span style="color: rgba(128, 0, 128, 1)">20.0</span>:<span style="color: rgba(128, 0, 128, 1)">443</span><span style="color: rgba(0, 0, 0, 1)">...

</span>* Connected to xxxxx.scm.chinacloudsites.cn (<span style="color: rgba(128, 0, 128, 1)">159.27</span>.<span style="color: rgba(128, 0, 128, 1)">20.0</span>) port <span style="color: rgba(128, 0, 128, 1)">443</span>

* ALPN: curl offers h2,http/<span style="color: rgba(128, 0, 128, 1)">1.1</span>

* (<span style="color: rgba(128, 0, 128, 1)">304</span>) (OUT), TLS handshake, Client hello (<span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">):

</span>*  CAfile: /etc/ssl/<span style="color: rgba(0, 0, 0, 1)">cert.pem

</span>*<span style="color: rgba(0, 0, 0, 1)">  CApath: none

</span>* (<span style="color: rgba(128, 0, 128, 1)">304</span>) (IN), TLS handshake, Server hello (<span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">):

</span>* (<span style="color: rgba(128, 0, 128, 1)">304</span>) (OUT), TLS handshake, Client hello (<span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">):

</span>* (<span style="color: rgba(128, 0, 128, 1)">304</span>) (IN), TLS handshake, Server hello (<span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">):

</span>* (<span style="color: rgba(128, 0, 128, 1)">304</span>) (IN), TLS handshake, Unknown (<span style="color: rgba(128, 0, 128, 1)">8</span><span style="color: rgba(0, 0, 0, 1)">):

</span>* (<span style="color: rgba(128, 0, 128, 1)">304</span>) (IN), TLS handshake, Certificate (<span style="color: rgba(128, 0, 128, 1)">11</span><span style="color: rgba(0, 0, 0, 1)">):

</span>* (<span style="color: rgba(128, 0, 128, 1)">304</span>) (IN), TLS handshake, CERT verify (<span style="color: rgba(128, 0, 128, 1)">15</span><span style="color: rgba(0, 0, 0, 1)">):

</span>* (<span style="color: rgba(128, 0, 128, 1)">304</span>) (IN), TLS handshake, Finished (<span style="color: rgba(128, 0, 128, 1)">20</span><span style="color: rgba(0, 0, 0, 1)">):

</span>* (<span style="color: rgba(128, 0, 128, 1)">304</span>) (OUT), TLS handshake, Finished (<span style="color: rgba(128, 0, 128, 1)">20</span><span style="color: rgba(0, 0, 0, 1)">):

</span>* SSL connection <span style="color: rgba(0, 0, 255, 1)">using</span> TLSv1.<span style="color: rgba(128, 0, 128, 1)">3</span> / AEAD-AES256-GCM-SHA384 / [blank] /<span style="color: rgba(0, 0, 0, 1)"> UNDEF

</span>* ALPN: server accepted http/<span style="color: rgba(128, 0, 128, 1)">1.1</span>

*<span style="color: rgba(0, 0, 0, 1)"> Server certificate:

</span>*  subject: C=CN; ST=Shanghai; O=Shanghai Blue Cloud Technology Co., Ltd.; CN=*<span style="color: rgba(0, 0, 0, 1)">.chinacloudsites.cn

</span>*  start date: Dec <span style="color: rgba(128, 0, 128, 1)">19</span> <span style="color: rgba(128, 0, 128, 1)">00</span>:<span style="color: rgba(128, 0, 128, 1)">00</span>:<span style="color: rgba(128, 0, 128, 1)">00</span> <span style="color: rgba(128, 0, 128, 1)">2025</span><span style="color: rgba(0, 0, 0, 1)"> GMT

</span>*  expire date: Jun <span style="color: rgba(128, 0, 128, 1)">17</span> <span style="color: rgba(128, 0, 128, 1)">23</span>:<span style="color: rgba(128, 0, 128, 1)">59</span>:<span style="color: rgba(128, 0, 128, 1)">59</span> <span style="color: rgba(128, 0, 128, 1)">2026</span><span style="color: rgba(0, 0, 0, 1)"> GMT

</span>*  subjectAltName: host <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">xxxxx.scm.chinacloudsites.cn</span><span style="color: rgba(128, 0, 0, 1)">"</span> matched cert<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s "*.scm.chinacloudsites.cn"</span>

*  issuer: C=US; O=DigiCert Inc; CN=<span style="color: rgba(0, 0, 0, 1)">DigiCert Basic RSA CN CA G2

</span>*<span style="color: rgba(0, 0, 0, 1)">  SSL certificate verify ok.

</span>* <span style="color: rgba(0, 0, 255, 1)">using</span> HTTP/<span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">.x

</span>* Server auth <span style="color: rgba(0, 0, 255, 1)">using</span> Basic with user <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">deploypoc</span><span style="color: rgba(128, 0, 0, 1)">'</span>

&gt; POST /api/publish?type=jar HTTP/<span style="color: rgba(128, 0, 128, 1)">1.1</span>

&gt;<span style="color: rgba(0, 0, 0, 1)"> Host: xxxxx.scm.chinacloudsites.cn

</span>&gt;<span style="color: rgba(0, 0, 0, 1)"> Authorization: Basic xxxxxxxxxxxxxxxx

</span>&gt; User-Agent: curl/<span style="color: rgba(128, 0, 128, 1)">8.7</span>.<span style="color: rgba(128, 0, 128, 1)">1</span>

&gt; Accept: *<span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)">

&gt; Content-Length: 25578166

&gt; Expect: 100-continue

&gt; 

* Done waiting for 100-continue

&lt; HTTP/1.1 400 Bad Request

&lt; Content-Type: text/plain; charset=utf-8

&lt; Date: Wed, 31 Dec 2025 03:42:36 GMT

&lt; Server: Kestrel

&lt; Set-Cookie: ARRAffinity=xxxx;Path=/;HttpOnly;Secure;Domain=xxxxx.scm.chinacloudsites.cn

&lt; Set-Cookie: ARRAffinitySameSite=xxxxx;Path=/;HttpOnly;SameSite=None;Secure;Domain=xxxxx.scm.chinacloudsites.cn

&lt; Transfer-Encoding: chunked

&lt; 

* HTTP error before end of send, stop sending

* abort upload after having sent 589824 bytes

* Closing connection

<span style="background-color: rgba(255, 255, 0, 1)">Artifact type = 'Jar' cannot be deployed to stack = 'TOMCAT'. Site should be configured to run with stack = JAVA%   </span> </span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1>åèèµæ</h1>
<p>App Serviceé¨ç½²Javaåºç¨ï¼<a href="https://docs.azure.cn/zh-cn/app-service/configure-language-java-deploy-run?tabs=linux&amp;pivots=java-tomcat#deploying-your-app" target="_blank" rel="noopener nofollow">https://docs.azure.cn/zh-cn/app-service/configure-language-java-deploy-run?tabs=linux&amp;pivots=java-tomcat#deploying-your-app</a></p>
<p>Kudu One Deploy Source Code ï¼ <a href="https://github.com/projectkudu/kudu/blob/master/Kudu.Services/Deployment/PushDeploymentController.cs#L304" target="_blank" rel="noopener nofollow">https://github.com/projectkudu/kudu/blob/master/Kudu.Services/Deployment/PushDeploymentController.cs#L304</a></p>
<p>&nbsp;</p>
</div>
<div id="MySignature" role="contentinfo">
    <div style="background: #1c5f55;height: 36px;width: 618px;padding: 14px 5px 0px 3px;">
  <p style="
    font-weight: bold;
    color: white;
">å½å¨å¤æçç¯å¢ä¸­é¢ä¸´é®é¢ï¼æ ¼ç©ä¹ééï¼æµèéä¹å¾æ¸ï¼å®ä»¥å¨ä¹å¾çã äºä¸­ï¼æ°æ¯å¦æ­¤!</p>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-04 20:07">2026-01-04 20:07</span>&nbsp;
<a href="https://www.cnblogs.com/lulight">è·¯è¾¹ä¸¤çç¯</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19439653);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19439653', targetLink: 'https://www.cnblogs.com/lulight/p/19439653', title: 'ãAzure Web AppãGithub Actioné¨ç½²Jaråå°App Serviceæ¥400éè¯¯' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Serilog æ¥å¿åºç®åå®è·µï¼åï¼æ¶æ¯éå Sinksï¼.net8ï¼ ]]></title>
    <link>https://www.cnblogs.com/hnzhengfy/p/19191039/Serilog_MQSinks</link>
    <guid>054f35cdf1b4fb70b9ac9861d8282e0f</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/hnzhengfy/p/19191039/Serilog_MQSinks" title="åå¸äº 2026-01-04 19:54">
    <span role="heading" aria-level="2">Serilog æ¥å¿åºç®åå®è·µï¼åï¼æ¶æ¯éå Sinksï¼.net8ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        å°æ¥å¿äºä»¶éè¿æ¶æ¯éå Sinks åå¸åºå»æ¯ä¸ç§å®ç°ç³»ç»è§£è¦ãå¼æ­¥å¤çåæµéåå³°çé«ææ¹å¼ãæ¬æå°± KafkaãRabbitMQ ä¸¤ç§è¿è¡ç®åä»ç»åå®è·µï¼ä¾åèã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h2>ããåè¨</h2>
<p>åæå·²ç»ä»ç»è¿ä»ä¹æ¯ Serilogï¼ä»¥åå¶æ ¸å¿ç¹ç¹ï¼<span style="font-size: 12px"><em>è¯¦è§ï¼<a title="https://www.cnblogs.com/hnzhengfy/p/19167414/Serilog_basic" href="https://www.cnblogs.com/hnzhengfy/p/19167414/Serilog_basic" target="_blank" rel="noopener">https://www.cnblogs.com/hnzhengfy/p/19167414/Serilog_basic</a>ã</em></span></p>
<p>æ¬æç»§ç»­å¯¹åç§ç±»åç Sink è¿è¡ç®åçå®è·µï¼ä¸»é¢æ¯æ¶æ¯éå Sinksï¼ä¾åèã</p>
<p>å¨ç°ä»£åå¸å¼ç³»ç»ä¸­ï¼å°æ¥å¿äºä»¶éè¿æ¶æ¯éå Sinks åå¸åºå»æ¯ä¸ç§å®ç°ç³»ç»è§£è¦ãå¼æ­¥å¤çåæµéåå³°çé«ææ¹å¼ã</p>
<p>æ¶æ¯éå Sinks å¸¸è§çæä»¥ä¸ä¸ç§ï¼</p>
<table>
<thead>
<tr>
<th data-spm-anchor-id="5176.28103460.0.i6.96a07551D462Yj">æå</th>
<th>æ¶æ¯éå</th>
<th>ä¸»è¦ä¼å¿é¢å</th>
<th>éç¨äººç¾¤</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1</strong></td>
<td><strong>Kafka</strong></td>
<td><strong>é«ååãæ¥å¿ãæµå¤ç</strong></td>
<td><strong>å¤§æ°æ®ãäºèç½å¤§å</strong></td>
</tr>
<tr>
<td><strong>2</strong></td>
<td><strong>RabbitMQ</strong></td>
<td><strong>å¯é æéãçµæ´»è·¯ç±ãæè¿ç»´</strong></td>
<td><strong>ä¸­å°ä¼ä¸ãä¼ ç»è¡ä¸</strong></td>
</tr>
<tr>
<td>3</td>
<td>RocketMQ</td>
<td>äºå¡æ¶æ¯ãé¡ºåºæ¶è´¹ãé«å¯é </td>
<td>ä¸­å½äºèç½ãçµåéè</td>
</tr>
</tbody>
</table>
<p>æ¬æå°±åä¸¤ç§è¿è¡ç®åçä»ç»åç¤ºä¾ï¼å¯¹äº RocketMQ å¾åç»­ææºä¼è¿è¡è¡¥åã</p>
<h2>ä¸ãæ¶æ¯éå Sinks çç¨æ³</h2>
<h3>1.1 Serilog.Sinks.Kafkaï¼å°æ¥å¿ä¿¡æ¯åå¥ Kafka éå</h3>
<p>Serilog.Sinks.Kafka æ¯ Serilog æ¥å¿åºçä¸ä¸ª Sinkï¼æ¥æ¶å¨ï¼æä»¶ï¼ç¨äºå°ç»æåæ¥å¿æ°æ®åéå° Apache Kafka ä¸»é¢ãå®å©ç¨ Kafka é«ååéãåå¸å¼åå¸-è®¢éæ¶æ¯ç³»ç»çç¹ç¹ï¼æå»ºå®æ¶æ¥å¿ç®¡éï¼ä½¿æ¥å¿ç³»ç»è½å¤è½»æ¾å¤çæµ·éæ¥å¿æ°æ®ï¼å¹¶æ¯æå¤ç³»ç»éæåæã</p>
<h4>1.1.1 å¨ Windows ä¸å®è£ Kafka<em>ï¼ç¨äºå¼åæµè¯ï¼çäº§ç¯å¢å»ºè®® Linuxï¼</em></h4>
<p><span style="font-size: 12px"><em>æ³¨æï¼Kafka å®æ¹ä¸»è¦æ¯æ Linux ç¯å¢ï¼Windows å®è£ä¸æ¯å®æ¹æ¨èçæ¹å¼ãä½å¦ææ¯å¨ Windows ä¸è¿è¡å¼åæµè¯ï¼è¿æ¯å¯ä»¥çã</em></span></p>
<p><strong>æ¬æä½¿ç¨ç°ä»ææ°ççæ¬ 4.1.1ï¼Kafka 4.1.1 é»è®¤ä½¿ç¨ KRaftï¼Kafka Raftï¼æ¨¡å¼ï¼å³å» ZooKeeper æ¶æï¼å æ­¤åªéå®è£ java ç¯å¢ï¼æ éå¨å®è£ ZooKeeper ã</strong></p>
<p><strong>1ï¼å®è£ Java ç¯å¢</strong></p>
<p>ç±äº Kafka 4.1.1 æ¯ç¨ Java 17ï¼class version 61ï¼ç¼è¯çï¼å¯¹åºå³ç³»å¦ä¸ï¼</p>
<p>Java çæ¬ä¸ class file version å¯¹ç§å³ç³»ï¼<br>Java 8 â 52<br>Java 11 â 55<br>Java 17 â 61<br>Java 21 â 65</p>
<p>å æ­¤ï¼å¨å®è£ Kafka ä¹åå¯ä»¥åå®è£ä¸ JDK 17ãå®æ¹ä¸è½½å°åï¼<a title="https://www.oracle.com/java/technologies/javase/jdk17-archive-downloads.html" href="https://www.oracle.com/java/technologies/javase/jdk17-archive-downloads.html" target="_blank" rel="noopener nofollow">https://www.oracle.com/java/technologies/javase/jdk17-archive-downloads.html</a>ã</p>
<p>ç´æ¥é»è®¤éé¡¹å®è£å³å¯ã</p>
<p>ç¶åéç½®ç¯å¢åéï¼<code>JAVA_HOME</code>ï¼<code>C:\Program Files\Java\jdk-17</code>ãå®è£æ¶è¥æ¹äºè·¯å¾éè¦æ¹æå¯¹åºçè·¯å¾ã</p>
<p>Path ä¸­æ·»å ä¸è¡ï¼<code>%JAVA_HOME%\bin</code>ã</p>
<p>ç¶åæå¼ cmd çªå£éªè¯å®è£æåï¼</p>
<pre class="language-powershell highlighter-hljs"><code>C:\Users\Administrator&gt;java -version
java version "17.0.12" 2024-07-16 LTS
Java(TM) SE Runtime Environment (build 17.0.12+8-LTS-286)
Java HotSpot(TM) 64-Bit Server VM (build 17.0.12+8-LTS-286, mixed mode, sharing)</code></pre>
<p><strong>2ï¼å®è£ Kafka</strong></p>
<p>ä¸è½½å¦ä¸å¾ä¸­çäºè¿å¶çæ¬ï¼Binaryï¼ï¼å¯ä»¥ç´æ¥è¿è¡ï¼æ éèªå·±ç¼è¯ãæä»¶åä¸­ç 2.13 è¡¨ç¤ºè¯¥ Kafka çæ¬æ¯ç¨ Scala 2.13 ç¼è¯çï¼å¯ä»¥å¿½ç¥ã</p>
<p>å®æ¹ä¸è½½å°åï¼<a title="https://kafka.apache.org/downloads" href="https://kafka.apache.org/downloads" target="_blank" rel="noopener nofollow">https://kafka.apache.org/downloads</a>ã</p>
<p><img src="https://img2024.cnblogs.com/blog/1868241/202511/1868241-20251126225757439-1096942952.png" alt="image" height="162" width="287"></p>
<p>è§£åå°æä»¶å¤¹ï¼<code>D:\kafka_2.13-4.1.1</code>ã</p>
<p>ä¿®æ¹éç½®æä»¶å¤¹<code>D:\kafka_2.13-4.1.1\config\server.properties</code>ï¼</p>
<pre class="language-powershell highlighter-hljs"><code># ãå·²é»è®¤ãå¯ç¨ KRaft æ¨¡å¼ï¼åæ¶ä½ä¸º broker å controllerï¼
process.roles=broker,controller
node.id=1
broker.id=1

# ãå¿é¡»è®¾ç½®ï¼éæå¨æ°å¢ã
# å®ä¹ controller quorum çæç¥¨æå
# æ ¼å¼ï¼nodeId@host:port
controller.quorum.voters=1@localhost:9093
# controller.quorum.voters=1@localhost:9093 ä¸­ç 1 å¿é¡»å node.id=1 ä¸è´
# 9093 æ¯ CONTROLLER çå¬ç«¯å£ï¼å¿é¡»ä¸ listeners ä¸­ç CONTROLLER://:9093 å¹é

# å¿é¡»è®¾ç½®ï¼å®ä¹ controller quorum çæç¥¨æå
# æ ¼å¼ï¼nodeId@host:port
controller.quorum.voters=1@localhost:9093

# ãå·²é»è®¤ãçå¬å¨éç½®
listeners=PLAINTEXT://:9092,CONTROLLER://:9093
inter.broker.listener.name=PLAINTEXT
controller.listener.names=CONTROLLER

# æ¥å¿ç®å½ï¼å»ºè®®ä½¿ç¨ Windows è·¯å¾ï¼
log.dirs=/tmp/kraft-combined-logs</code></pre>
<p>ç¶åçæéç¾¤ ID å¹¶æ ¼å¼åæ¥å¿ç®å½ï¼ï¼å¿è¦æ­¥éª¤ï¼è¥ç´æ¥å¯å¨ï¼ä¼æ¥éï¼æ¾ä¸å° meta.properties æä»¶ï¼</p>
<pre class="language-powershell highlighter-hljs"><code># è½ç¶åºç°äº Log4j ç ERROR æ¥å¿ï¼ä½å®éä¸ UUID å·²æåçæ
PS D:\kafka_2.13-4.1.1&gt; bin\windows\kafka-storage.bat random-uuid
2025-12-04T11:26:06.769887100Z main ERROR Reconfiguration failed: No configuration found for '4dc63996' at 'null' in 'null'
wTL_esmQSuKMtvzx6eclsQ
# ä½¿ç¨çæç Cluster ID æ ¼å¼å Kafka å­å¨ç®å½
PS D:\kafka_2.13-4.1.1&gt; bin\windows\kafka-storage.bat format -t wTL_esmQSuKMtvzx6eclsQ -c config/server.properties
2025-12-04T11:29:22.735759Z main ERROR Reconfiguration failed: No configuration found for '4dc63996' at 'null' in 'null'
Formatting metadata directory /tmp/kraft-combined-logs with metadata.version 4.1-IV1.

# å³äº Log4j ERROR è­¦å
# main ERROR Reconfiguration failed: No configuration found for '4dc63996' at 'null' in 'null'
# æ¯å ä¸º Kafka å·¥å·èæ¬ï¼å¦ kafka-storage.batï¼æ²¡ææ¾å° Log4j 2 éç½®æä»¶
# å®ä¸å½±ååè½ï¼åªæ¯æ¥å¿ç³»ç»åå§åå¤±è´¥ï¼ä½ä»ä¼ä½¿ç¨é»è®¤éç½®ã</code></pre>
<p>æååå¯å¨ Kafkaï¼<code>bin\windows\kafka-server-start.bat config/server.properties</code>ã</p>
<p>çå°å¦ä¸è¾åºå°±æ¯å¯å¨æåäºï¼</p>
<p><span style="font-size: 12px"><em><img src="https://img2024.cnblogs.com/blog/1868241/202512/1868241-20251204194415558-408556665.png" alt="image"></em></span></p>
<p><span style="font-size: 12px"><em>æ³¨æï¼Windows å®è£ Kafka ä»éç¨äºå¼åæµè¯ç¯å¢ï¼çäº§ç¯å¢å»ºè®®ä½¿ç¨ Linux æ Docker é¨ç½²ã</em></span></p>
<details>
<summary>server.properties ç¤ºä¾</summary>
<pre class="language-nginx highlighter-hljs"><code>&nbsp;# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

############################# Server Basics #############################

# The role of this server. Setting this puts us in KRaft mode
process.roles=broker,controller

# The node id associated with this instance's roles
node.id=1

broker.id=1

# List of controller endpoints used connect to the controller cluster
controller.quorum.bootstrap.servers=localhost:9093

# å¿é¡»è®¾ç½®ï¼å®ä¹ controller quorum çæç¥¨æå
# æ ¼å¼ï¼nodeId@host:port
controller.quorum.voters=1@localhost:9093

############################# Socket Server Settings #############################

# The address the socket server listens on.
# Combined nodes (i.e. those with `process.roles=broker,controller`) must list the controller listener here at a minimum.
# If the broker listener is not defined, the default listener will use a host name that is equal to the value of java.net.InetAddress.getCanonicalHostName(),
# with PLAINTEXT listener name, and port 9092.
#   FORMAT:
#     listeners = listener_name://host_name:port
#   EXAMPLE:
#     listeners = PLAINTEXT://your.host.name:9092
listeners=PLAINTEXT://:9092,CONTROLLER://:9093

# Name of listener used for communication between brokers.
inter.broker.listener.name=PLAINTEXT

# Listener name, hostname and port the broker or the controller will advertise to clients.
# If not set, it uses the value for "listeners".
advertised.listeners=PLAINTEXT://localhost:9092,CONTROLLER://localhost:9093

# A comma-separated list of the names of the listeners used by the controller.
# If no explicit mapping set in `listener.security.protocol.map`, default will be using PLAINTEXT protocol
# This is required if running in KRaft mode.
controller.listener.names=CONTROLLER

# Maps listener names to security protocols, the default is for them to be the same. See the config documentation for more details
listener.security.protocol.map=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL

# The number of threads that the server uses for receiving requests from the network and sending responses to the network
num.network.threads=3

# The number of threads that the server uses for processing requests, which may include disk I/O
num.io.threads=8

# The send buffer (SO_SNDBUF) used by the socket server
socket.send.buffer.bytes=102400

# The receive buffer (SO_RCVBUF) used by the socket server
socket.receive.buffer.bytes=102400

# The maximum size of a request that the socket server will accept (protection against OOM)
socket.request.max.bytes=104857600


############################# Log Basics #############################

# A comma separated list of directories under which to store log files
# log.dirs=/tmp/kraft-combined-logs
# æ°æ®ç®å½ï¼ç¡®ä¿è·¯å¾å­å¨ä¸å¯åï¼
log.dirs=D:/kafka_2.13-4.1.1/data/kafka-logs

# The default number of log partitions per topic. More partitions allow greater
# parallelism for consumption, but this will also result in more files across
# the brokers.
num.partitions=1

# The number of threads per data directory to be used for log recovery at startup and flushing at shutdown.
# This value is recommended to be increased for installations with data dirs located in RAID array.
num.recovery.threads.per.data.dir=1

############################# Internal Topic Settings  #############################
# The replication factor for the group metadata internal topics "__consumer_offsets", "__share_group_state" and "__transaction_state"
# For anything other than development testing, a value greater than 1 is recommended to ensure availability such as 3.
offsets.topic.replication.factor=1
share.coordinator.state.topic.replication.factor=1
share.coordinator.state.topic.min.isr=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1

############################# Log Flush Policy #############################

# Messages are immediately written to the filesystem but by default we only fsync() to sync
# the OS cache lazily. The following configurations control the flush of data to disk.
# There are a few important trade-offs here:
#    1. Durability: Unflushed data may be lost if you are not using replication.
#    2. Latency: Very large flush intervals may lead to latency spikes when the flush does occur as there will be a lot of data to flush.
#    3. Throughput: The flush is generally the most expensive operation, and a small flush interval may lead to excessive seeks.
# The settings below allow one to configure the flush policy to flush data after a period of time or
# every N messages (or both). This can be done globally and overridden on a per-topic basis.

# The number of messages to accept before forcing a flush of data to disk
#log.flush.interval.messages=10000

# The maximum amount of time a message can sit in a log before we force a flush
#log.flush.interval.ms=1000

############################# Log Retention Policy #############################

# The following configurations control the disposal of log segments. The policy can
# be set to delete segments after a period of time, or after a given size has accumulated.
# A segment will be deleted whenever *either* of these criteria are met. Deletion always happens
# from the end of the log.

# The minimum age of a log file to be eligible for deletion due to age
log.retention.hours=168

# A size-based retention policy for logs. Segments are pruned from the log unless the remaining
# segments drop below log.retention.bytes. Functions independently of log.retention.hours.
#log.retention.bytes=1073741824

# The maximum size of a log segment file. When this size is reached a new log segment will be created.
log.segment.bytes=1073741824

# The interval at which log segments are checked to see if they can be deleted according
# to the retention policies
log.retention.check.interval.ms=300000

# åè®¸èªå¨åå»º Topic
auto.create.topics.enable=true</code></pre>
</details>
<p><strong>3ï¼åå»º topic</strong></p>
<p>åå»ºè¯­å¥ï¼ï¼æ³¨æï¼å¯ä»¥æ¿æ¢èªå®ä¹ç topic åï¼my-logs-topic1212ï¼</p>
<pre class="language-nginx highlighter-hljs"><code>.\bin\windows\kafka-topics.bat --create --topic my-logs-topic1212 --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1</code></pre>
<p>æ³¨æï¼æ­¤è¯­å¥æ­£å¸¸å ç§éå°±å¯ä»¥æ§è¡å®æï¼è¥æ¶é´æ¯è¾é¿ï¼éè¦ç­å¾å¶è¿åéè¯¯æç¤ºã</p>
<p>å¯è½ä¼éå°å¦ä¸éè¯¯ï¼</p>
<pre class="language-nginx highlighter-hljs"><code>Error while executing topic command : Call(...createTopics...) timed out...
Caused by: org.apache.kafka.common.errors.DisconnectException: Cancelled createTopics request... due to node 1 being disconnected</code></pre>
<p>åå ï¼è¯´æ Kafka å®¢æ·ç«¯ï¼kafka-topics.batï¼æ æ³è¿æ¥å° Kafka brokerï¼æè broker è½ç¶å¯å¨ä½æªå®å¨å°±ç»ªï¼ç¹å«æ¯ KRaft Controller æªéä¸¾å®æï¼ã</p>
<p>å¨ KRaft æ¨¡å¼ ä¸ï¼Kafka å¯å¨åä¸ºä¸¤ä¸ªè§è²ï¼Controllerï¼ç®¡çåæ°æ®ï¼topicsãpartitions ç­ï¼ï¼Brokerï¼å¤ççäº§/æ¶è´¹è¯·æ±ãå¦æ Controller å°æªå®æåå§åæéä¸¾ï¼å³ä½¿ kafka-server-start.bat çä¼¼âå·²å¯å¨âï¼åæ°æ®æä½ï¼å¦åå»º Topicï¼ä»ä¼å¤±è´¥ã</p>
<p>è§£å³æ¹æ¡ï¼</p>
<pre class="language-nginx highlighter-hljs"><code># ãæ­¥éª¤ 1ãç¡®è®¤ Kafka æ¯ä»¥ KRaft æ¨¡å¼ å¯å¨ç
# æ£æ¥æ¯å¦ä½¿ç¨äº æ­£ç¡®çéç½®æä»¶ï¼
# æ­£ç¡®å¯å¨å½ä»¤ï¼KRaft æ¨¡å¼ï¼
.\bin\windows\kafka-server-start.bat .\config\server.properties

# ãæ­¥éª¤ 2ãæ£æ¥ server.properties ä¸­çå³é®éç½®
# æå¼ config/server.propertiesï¼ç¡®ä¿åå«ï¼
# çå¬å°åï¼å¿é¡»ï¼ï¼
process.roles=broker,controller
node.id=1
broker.id=1
controller.quorum.voters=1@localhost:9093
listeners=PLAINTEXT://:9092,CONTROLLER://:9093
advertised.listeners=PLAINTEXT://localhost:9092
inter.broker.listener.name=PLAINTEXT
controller.listener.names=CONTROLLER
# æ°æ®ç®å½ï¼ç¡®ä¿è·¯å¾å­å¨ä¸å¯åï¼
log.dirs=D:/kafka_2.13-4.1.1/data/kafka-logs
# æ³¨æï¼
# controller.quorum.voters å¿é¡»ä¸ node.id å¹é
# log.dirs è·¯å¾ä¸è½åå«ç©ºæ ¼æä¸­æ
# ç¬¬ä¸æ¬¡å¯å¨åï¼æ¸ç©º log.dirs ç®å½

# ãæ­¥éª¤ 3ãé¦æ¬¡å¯å¨åæ ¼å¼åå­å¨ç®å½ï¼å³é®ï¼ï¼
# KRaft æ¨¡å¼è¦æ±ï¼åæ ¼å¼åå­å¨ç®å½ï¼å¦å broker æ æ³æ­£å¸¸å å¥éç¾¤
# 1. çæ Cluster IDï¼åªéä¸æ¬¡ï¼
.\bin\windows\kafka-storage.bat random-uuid
# 2. æ ¼å¼åæ¥å¿ç®å½
.\bin\windows\kafka-storage.bat format -t &lt;ä¸ä¸æ­¥çæçUUID&gt; -c .\config\kraft\server.properties

# ãæ­¥éª¤ 4ãå¯å¨ Kafka å¹¶ç­å¾å®å¨å°±ç»ª
.\bin\windows\kafka-server-start.bat .\config\server.properties
# Kafka å¯å¨æååï¼ç­å¾ 10~15 ç§ åæ§è¡ kafka-topics.bat
# KRaft å¯å¨æ¯ ZooKeeper æ¨¡å¼æ¢ï¼ç«å³åå»º Topic ä¼å¤±è´¥</code></pre>
<pre class="language-nginx highlighter-hljs"><code># å®éæä½è¿ç¨ç¤ºä¾ï¼
PS D:\kafka_2.13-4.1.1&gt; .\bin\windows\kafka-storage.bat random-uuid
nOhIgFFsQm2aiodLw8y7cQ

PS D:\kafka_2.13-4.1.1&gt; bin\windows\kafka-storage.bat format -t nOhIgFFsQm2aiodLw8y7cQ -c config/server.properties --ignore-formatted
Formatting metadata directory /tmp/kraft-combined-logs with metadata.version 4.1-IV1.

PS D:\kafka_2.13-4.1.1&gt; bin\windows\kafka-server-start.bat config/server.properties
DEPRECATED: A Log4j 1.x configuration file has been detected, which is no longer recommended.
ããã
[2025-12-12 17:31:28,080] INFO [BrokerServer id=1] Transition from STARTING to STARTED (kafka.server.BrokerServer)
[2025-12-12 17:31:28,082] INFO Kafka version: 4.1.1 (org.apache.kafka.common.utils.AppInfoParser)
[2025-12-12 17:31:28,082] INFO Kafka commitId: be816b82d25370ce (org.apache.kafka.common.utils.AppInfoParser)
[2025-12-12 17:31:28,084] INFO Kafka startTimeMs: 1765531888081 (org.apache.kafka.common.utils.AppInfoParser)
[2025-12-12 17:31:28,085] INFO [KafkaRaftServer nodeId=1] Kafka Server started (kafka.server.KafkaRaftServer)
# è³æ­¤éæ°å¯å¨æåï¼ç¶åå¦æå¼ä¸ä¸ªçªå£ï¼è¿è¡ä¸é¢æä½ï¼
# æ·»å  topic
PS D:\kafka_2.13-4.1.1&gt; .\bin\windows\kafka-topics.bat --create --topic my-logs-topic1212 --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1
Created topic my-logs-topic1212.
#æ¥çå·²æ·»å ç topic
PS D:\kafka_2.13-4.1.1&gt; .\bin\windows\kafka-topics.bat --list --bootstrap-server localhost:9092
my-logs-topic1212</code></pre>
<p><strong>4ï¼éªè¯ Kafka å·²ç»å¯å¨</strong></p>
<pre class="language-nginx highlighter-hljs"><code># å¯ä»¥ååº topic è¡¨æï¼Kafka Broker å·²æ¥åå®¢æ·ç«¯è¿æ¥ï¼å¹¶è½ååºåæ°æ®è¯·æ±
PS D:\kafka_2.13-4.1.1&gt; .\bin\windows\kafka-topics.bat --list --bootstrap-server localhost:9092
my-logs-topic1212
# Kafka æ¯ Java åºç¨ï¼å¿é¡»æ java.exe è¿ç¨
# åç»­ netstat æ¾ç¤ºè¯¥ PID çå¬ 9092 ç«¯å£ï¼ç¡®è®¤å°±æ¯ Kafka è¿ç¨
PS D:\kafka_2.13-4.1.1&gt; tasklist /fi "imagename eq java.exe"

æ ååç§°                       PID ä¼è¯å              ä¼è¯#       åå­ä½¿ç¨
========================= ======== ================ =========== ============
java.exe                     90224 Console                    2    432,272 K
# 9092 ç«¯å£å¤äº LISTENING ç¶æï¼ä¸ PID å¹é
# è¡¨ç¤º Kafka Broker æ­£å¨çå¬ææ IPv4/IPv6 æ¥å£ç 9092 ç«¯å£
# PID 90224 ä¸ tasklist ä¸­ç Java è¿ç¨ä¸è´ï¼ç¡®è®¤æ¯ Kafka å¨çå¬
PS D:\kafka_2.13-4.1.1&gt; netstat -ano | findstr :9092
  TCP    0.0.0.0:9092           0.0.0.0:0              LISTENING       90224
  TCP    127.0.0.1:52704        127.0.0.1:9092         TIME_WAIT       0
  TCP    127.0.0.1:52706        127.0.0.1:9092         TIME_WAIT       0
  TCP    127.0.0.1:52758        127.0.0.1:9092         TIME_WAIT       0
  TCP    127.0.0.1:52766        127.0.0.1:9092         TIME_WAIT       0
  TCP    [::]:9092              [::]:0                 LISTENING       90224
# å¤ä¸ª TIME_WAIT æ¯ä¹å kafka-topics.bat å»ºç«çç­è¿æ¥å³é­åçæ­£å¸¸ç¶æ</code></pre>
<h4>1.1.2 æµè¯å¾ Kafka éåä¸­åå¥æ¶æ¯</h4>
<p>1ï¼åå»º .NET 8.0 æ§å¶å°åºç¨ç¨åºï¼ç¶åå®è£å¿è¦çåï¼</p>
<pre class="language-nginx highlighter-hljs"><code>dotnet add package Serilog
dotnet add package Serilog.Sinks.Console
dotnet add package Serilog.Sinks.ConfluentKafka</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1868241/202601/1868241-20260104105638368-1594540197.png" alt="image"></p>
<p>2ï¼ä¿®æ¹ Program.cs</p>
<pre class="language-csharp highlighter-hljs"><code>using Confluent.Kafka;
using Serilog;
using Serilog.Formatting.Json;
using Serilog.Sinks.Kafka;

// éç½® Kafka Producer
var kafkaConfig = new ProducerConfig
{
    BootstrapServers = "localhost:9092",
    ClientId = "serilog-dotnet8-demo",
    Acks = Acks.All,
    EnableIdempotence = true,
    MessageTimeoutMs = 30000
};
// éç½® Serilog
Log.Logger = new LoggerConfiguration()
    .MinimumLevel.Information()
    .WriteTo.Console() // å¯éï¼åæ¶è¾åºå°æ§å¶å°
    .WriteTo.Kafka(
        topic: "my-logs-topic1212",
        null,
        producerConfig: kafkaConfig,
        formatter: new JsonFormatter() // æèªå®ä¹æ ¼å¼
    )
.CreateLogger();
// æµè¯æ¥å¿
Log.Information("åºç¨ç¨åºå¯å¨æå");
Log.Warning("ç¨æ· {UserId} å°è¯äºé«é£é©æä½", 123);
Log.Error(new Exception("æ°æ®åºè¿æ¥å¤±è´¥"), "æ°æ®åºéè¯¯");
// æ¨¡æä¸å¡
for (int i = 1; i &lt;= 3; i++)
{
    Log.Information("å¤çä»»å¡ {TaskId}ï¼è¿åº¦ {Progress:P}", i, i / 3.0);
    await Task.Delay(200);
}
// ç¡®ä¿æ¥å¿åéå®æ
Log.CloseAndFlush();
Console.WriteLine("\næ¥å¿å·²åéå° Kafka ä¸»é¢ 'app-logs'ãæä»»æé®éåº...");
Console.ReadKey();</code></pre>
<p>å¯å¨é¡¹ç®ï¼ç¶åæ¥ç Kafka éååå®¹ã</p>
<pre class="language-nginx highlighter-hljs"><code># ä½¿ç¨å½ä»¤æ¥ç
.\bin\windows\kafka-console-consumer.bat --bootstrap-server localhost:9092 --topic &lt;your-topic&gt; --from-beginning
# ãkafka-console-consumer.batã
# Kafka èªå¸¦ç å½ä»¤è¡æ¶è´¹èå·¥å·ï¼Console Consumerï¼
# ã--bootstrap-server localhost:9092ã
# æå® Kafka Broker çè¿æ¥å°åï¼KRaft æ¨¡å¼ä¸å¿éï¼
# æ ¼å¼ï¼host:portï¼å¤ä¸ª Broker ç¨éå·åéï¼å¦ host1:9092,host2:9092
# ä¸ºä»ä¹å« "bootstrap"ï¼å®¢æ·ç«¯åªéè¿æ¥å¶ä¸­ä¸ä¸ª Brokerï¼å³å¯è·åæ´ä¸ªéç¾¤çåæ°æ®ï¼åæ¬ææ TopicãPartition åå¸ç­ï¼ï¼åç»­ä¼ç´æ¥ä¸å¯¹åº Partition ç Leader éä¿¡
# ã--topic &lt;your-topic&gt;ã
# æå®è¦æ¶è´¹ç Topic åç§°ï¼è¿éä¸æ¬¡åªè½æå® ä¸ä¸ª Topic
# ã--from-beginningã
# ä»è¯¥ Topic çææ©æ¶æ¯ï¼offset = 0ï¼å¼å§æ¶è´¹ï¼èä¸æ¯ä»ææ°ä½ç½®å¼å§
# ã--property print.key=trueãåæ¶æå°æ¶æ¯ç Keyï¼é»è®¤åªæå° Valueï¼
# ã--property print.timestamp=trueãæå°æ¶æ¯çæ¶é´æ³ï¼CreateTime æ LogAppendTimeï¼</code></pre>
<p>ç´æ¥éè¿å½ä»¤æå°åºæ¶æ¯åè¡¨æ¶ï¼ä¼åºç°ä¸­æä¹±ç ï¼<strong>å¦ä½å¤çä¹±ç åä½¿ç¨å·¥å· Offset Explorer æ¥æ¥ç</strong>ï¼è¯¦è§æ¬æåä¸èã</p>
<h4>1.1.3 éå°çé®é¢ï¼æ¥çéåæ¶æ¯æ¶ä¸­æä¹±ç </h4>
<p>å¨ PowerShell ä¸­éè¿å½ä»¤æ¥çéåæ¶æ¯æ¶ï¼åºç°ä¹±ç ï¼å¦ä¸å¾ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1868241/202601/1868241-20260104092544043-1870984030.png" alt="image"></p>
<p>éåï¼Topicï¼ä¸­çä¸­ææ¶æ¯æ¾ç¤ºä¸ºä¹±ç ï¼è¿éå¸¸æ¯ç±äº å­ç¬¦ç¼ç ä¸ä¸è´ å¯¼è´çãKafka æ¬èº«ä»¥å­èï¼byteï¼å½¢å¼å­å¨æ¶æ¯ï¼ä¸å³å¿åå®¹ç¼ç ï¼é®é¢åºå¨ çäº§èåå¥ å æ¶è´¹èè¯»å æ¶ä½¿ç¨çå­ç¬¦ç¼ç ä¸å¹éï¼å°¤å¶æ¯ Windows æ§å¶å°ï¼CMD/PowerShellï¼é»è®¤ä½¿ç¨ GBKï¼ä¸­æç³»ç»ï¼èé UTF-8ã</p>
<pre class="language-nginx highlighter-hljs"><code># å³ä½¿ Kafka æ­£ç¡®è¾åº UTF-8ï¼Windows æ§å¶å°é»è®¤ç¨ GBK æ¾ç¤ºï¼ä»ä¼ä¹±ç 
# å¨ PowerShell æ CMD ä¸­æ§è¡ï¼
chcp 65001  # 65001 æ¯ UTF-8 çä»£ç é¡µ
# PowerShell ä¸­è®¾ç½®ç¯å¢åéåå¯å¨
$env:KAFKA_OPTS="-Dfile.encoding=UTF-8"
# ç¶ååéæ°è¿è¡ consumer å½ä»¤
.\bin\windows\kafka-console-consumer.bat --bootstrap-server localhost:9092 --topic &lt;your-topic&gt; --from-beginning</code></pre>
<p>ä¸è¾¹çéç½®ä»å½åçªå£ææã</p>
<p>è¿å¯ä»¥<strong>éè¿ Offset Explorer åºç¨æ¥æ¥çæ¶æ¯</strong>ã</p>
<p>ä¸è½½ Offset Explorerï¼<a title="https://offsetexplorer.com/download.html" href="https://offsetexplorer.com/download.html" target="_blank" rel="noopener nofollow">https://offsetexplorer.com/download.html</a>ã</p>
<p><img src="https://img2024.cnblogs.com/blog/1868241/202512/1868241-20251231184356405-1355679403.png" alt="image"></p>
<p><img src="https://img2024.cnblogs.com/blog/1868241/202512/1868241-20251231184433809-1109603218.png" alt="image"></p>
<h4>1.1.4 éå°çé®é¢ï¼éå¯ Kafka æ¶ä¸æå</h4>
<p>æ¥éåå®¹ä¾å¦ï¼</p>
<pre class="language-nginx highlighter-hljs"><code>WARN Stopping serving logs in dir D:\kafka_2.13-4.1.1\data\kafka-logs (kafka.log.LogManager)
ERROR Shutdown broker because all log dirs in D:\kafka_2.13-4.1.1\data\kafka-logs have failed (kafka.log.LogManager)</code></pre>
<p>è¯´æ Kafka Broker å¯å¨åå æ¥å¿ç®å½ï¼log.dirsï¼ä¸å¯ç¨èä¸»å¨å³é­ãè¿æ¯ Kafka çä¿æ¤æºå¶ââå½ææéç½®çæ¥å¿å­å¨ç®å½é½å¤±ææ¶ï¼å®ä¼æç»è¿è¡ä»¥é¿åæ°æ®ä¸¢å¤±ã</p>
<p>å¯è½çåå ï¼</p>
<p>1ï¼æ¥å¿æå¨çç®å½æéä¸è¶³ã</p>
<p>Kafka éè¦å¯¹ log.dirs æå®çç®å½æ è¯»ãåãå é¤ãåå»ºå­ç®å½ çæéãæ¬æç¤ºä¾çç®å½ä¸ºï¼D:\kafka_2.13-4.1.1\data\kafka-logsã</p>
<p>æä½ï¼å³é® kafka-logs æä»¶å¤¹ â å±æ§ â å®å¨ â ç¼è¾ï¼ç»å½åç¨æ·éç½® âå®å¨æ§å¶â æéï¼æåéå¯ Kafkaã</p>
<p>2ï¼ç®å½è¢«å¶ä» Kafka å®ä¾å ç¨ï¼æä»¶éï¼</p>
<p>å¦æä¹åå¯å¨è¿ Kafka ä½æªæ­£å¸¸å³é­ï¼.lock æä»¶å¯è½æ®çï¼å¯¼è´æ°å®ä¾è®¤ä¸ºç®å½å·²è¢«å ç¨ã</p>
<p>åç¡®è®¤ææ²¡æ Kafka ç¤ºä¾å¨è¿è¡ï¼<code>tasklist /fi "imagename eq java.exe"</code>ã</p>
<p>æå°±åç»æï¼ç¶ååæ .lock æä»¶å é¤ã</p>
<p>æµè¯é¶æ®µå¯ä»¥å°æ¥å¿æä»¶å¤¹ä¸çå¨é¨æä»¶é½å æï¼é¿åå æªç¥çå ç¨å¯¼è´ Kafka å¯å¨å¤±è´¥ï¼ä½è¦è°¨ææä½ï¼å¨é¨å é¤ä¼é æä¹åéåæ¶æ¯æ¸ç©ºã</p>
<p><span style="font-size: 12px"><em>æ³¨æï¼ä¸è¦å¼ºè¡å é¤æ­£å¨ä½¿ç¨çæ¥å¿ç®å½åå®¹ï¼ä»å¨ç¡®è®¤ Kafka å·²åæ­¢æ¶æä½ã</em></span></p>
<p>3ï¼ç£çç©ºé´ä¸è¶³ï¼å¯ä»¥èªè¡æ£æ¥ï¼ç¡®ä¿æè¶³å¤ç©ºé´ï¼è³å°å ç¾ MBï¼ã</p>
<h3>1.2 Serilog.Sinks.RabbitMQï¼å°æ¥å¿äºä»¶åéå° RabbitMQ æ¶æ¯éåç³»ç»ä¸­</h3>
<p>Serilog.Sinks.RabbitMQ æ¯ä¸ä¸ª Serilog çæ¥å¿æ¥æ¶å¨ï¼Sinkï¼ï¼ç¨äºå°åºç¨ç¨åºçæ¥å¿äºä»¶åéå° RabbitMQ æ¶æ¯éåç³»ç»ä¸­ã</p>
<p>éè¿è¯¥ Sinkï¼å¼åèå¯ä»¥å°ç»æåæ¥å¿ä»¥æ¶æ¯çå½¢å¼åå¸å° RabbitMQ ç äº¤æ¢æºï¼Exchangeï¼ æç´æ¥ç»å®å° éåï¼Queueï¼ï¼ä»èå®ç°æ¥å¿çéä¸­æ¶éãå¼æ­¥å¤çãè§£è¦æè¿ä¸æ­¥è½¬åå°æ¥å¿åæç³»ç»ï¼å¦ ELKãGraylog ç­ï¼ã</p>
<p>å¤§æ¦çæ­¥éª¤ï¼</p>
<p>ââåºç¨ç¨åºè°ç¨ Log.Information(...) ç­æ¹æ³è®°å½æ¥å¿ï¼<br>ââSerilog æè·æ¥å¿äºä»¶ï¼<br>ââRabbitMQ Sink å°æ¥å¿äºä»¶åºååï¼<br>ââéè¿ AMQP å®¢æ·ç«¯è¿æ¥ RabbitMQï¼<br>ââå°æ¶æ¯åå¸å°éç½®ç Exchangeï¼å¯éç»å® Routing Keyï¼ï¼<br>ââRabbitMQ æ ¹æ®ç»å®è§åå°æ¶æ¯è·¯ç±å°ä¸ä¸ªæå¤ä¸ªéåï¼<br>ââæ¶è´¹èï¼å¦æ¥å¿å¤çå¨ãELK è¾å¥æä»¶ï¼ä»éåä¸­æ¶è´¹æ¥å¿ã</p>
<p><em>æ³¨æï¼Sink é»è®¤ä¸å£°æéåï¼åªè´è´£åå¸æ¶æ¯å° Exchangeãå æ­¤ï¼å¨å¾ RabbitMQ åéæ¶æ¯åï¼éè¦æåéç½®å¥½ ExchangeãQueue åç»å®å³ç³»ï¼æèå¯ç¨èªå¨å£°æï¼é¨åçæ¬æ¯æï¼ã</em></p>
<h4>1.2.1 å¨ Windows ä¸å®è£ RabbitMQ</h4>
<p>æå¸¸è§çæ¯éè¿ <strong>Erlang + RabbitMQ</strong> å®è£å çç»åæ¹å¼ï¼å ä¸º<strong> RabbitMQ æ¯ç¨ Erlang ç¼åçï¼ä¾èµ Erlang/OTP è¿è¡æ¶</strong>ï¼ã</p>
<p><span style="font-size: 12px"><em>æ³¨æï¼Erlang å RabbitMQ ççæ¬å¿é¡»å¼å®¹ãè¯·åèå®æ¹å¼å®¹æ§ç©éµï¼<a title="https://www.rabbitmq.com/docs/which-erlang" href="https://www.rabbitmq.com/docs/which-erlang" target="_blank" rel="noopener nofollow">https://www.rabbitmq.com/docs/which-erlang</a>ã</em></span></p>
<p>1ï¼ä¸è½½åå®è£ Erlang/OTP</p>
<p>å®æ¹ä¸è½½é¡µï¼<a title="https://www.erlang.org/downloads" href="https://www.erlang.org/downloads" target="_blank" rel="noopener nofollow">https://www.erlang.org/downloads</a>ã</p>
<p>æ¨èä½¿ç¨ Windows 64-bit Binary File (.exe)ï¼ä¾å¦ï¼otp_win64_27.3.exeï¼å¯¹åº OTP 27.3ï¼ãæªè³ 2025 å¹´ 12 æï¼RabbitMQ 4.2+ éå¸¸è¦æ± Erlang 26.2 ~ 27.xã</p>
<p><img src="https://img2024.cnblogs.com/blog/1868241/202512/1868241-20251202110425987-1382745303.png" alt="image" height="175" width="494"></p>
<p>ç¶åç´æ¥åå»å®è£åï¼ç´æ¥ä¸ä¸æ­¥å®è£å®æã</p>
<p>åæ¹ä¸ç³»ç»ç¯å¢åéï¼</p>
<p><strong>æ°å¢</strong>ï¼ERLANG_HOMEï¼C:\Program Files\Erlang OTPã</p>
<p><strong>å¨ Path ä¸­æ·»å </strong>ï¼%ERLANG_HOME%\binã</p>
<p>æåï¼ç¨ erl å½ä»¤éªè¯ä¸æ¯å¦å®è£æåï¼</p>
<pre class="language-powershell highlighter-hljs"><code>C:\Windows\system32&gt;erl
Erlang/OTP 27 [erts-15.2.3] [source] [64-bit] [smp:20:20] [ds:20:20:10] [async-threads:1] [jit:ns]

Eshell V15.2.3 (press Ctrl+G to abort, type help(). for help)
1&gt;</code></pre>
<p>2ï¼ä¸è½½åå®è£ RabbitMQ</p>
<p>å®æ¹ä¸è½½å°åï¼<a title="https://www.rabbitmq.com/docs/install-windows#downloads" href="https://www.rabbitmq.com/docs/install-windows#downloads" target="_blank" rel="noopener nofollow">https://www.rabbitmq.com/docs/install-windows#downloads</a>ã</p>
<p>ä¸è½½ RabbitMQ Server Windows Installer (.exe)ãä¾å¦ï¼rabbitmq-server-4.2.1.exeãæ¨èä½¿ç¨ .exe å®è£åï¼å¸¦å¾å½¢çé¢å Windows æå¡ï¼ï¼èé .zip åç¼©åã</p>
<p><img src="https://img2024.cnblogs.com/blog/1868241/202512/1868241-20251202110133508-558096292.png" alt="image" height="119" width="478"></p>
<p>å®è£å®æåï¼åæ ·éè¦ä¿®æ¹ç¯å¢åéï¼</p>
<p>æ°å¢ä¸ä¸ªï¼RABBITMQ_SERVERï¼C:\Program Files\RabbitMQ Serverã</p>
<p>è¿½å  Pathï¼%RABBITMQ_SERVER%\binã</p>
<p>æåï¼éªè¯æ¯å¦å®è£æåã</p>
<pre class="language-powershell highlighter-hljs"><code>C:\Windows\system32&gt;sc query RabbitMQ

SERVICE_NAME: RabbitMQ
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 4  RUNNING
                                (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x0</code></pre>
<p>å¦å¤ï¼RabbitMQ èªå¸¦ä¸ä¸ª Web ç®¡ççé¢ï¼Management Pluginï¼ï¼é»è®¤æªå¯ç¨ã</p>
<pre class="language-powershell highlighter-hljs"><code># ä»¥ç®¡çåèº«ä»½æå¼ å½ä»¤æç¤ºç¬¦ æ PowerShellï¼æ§è¡ï¼å±ä¸¤æ­¥ï¼ï¼
# 1ï¼è¿å¥ RabbitMQ å®è£ç®å½ç sbin æä»¶å¤¹ï¼éå¸¸å¦ä¸ï¼çæ¬å·éè¦æ¹ææ¬å°çï¼
C:\Program Files\RabbitMQ Server&gt;cd C:\Program Files\RabbitMQ Server\rabbitmq_server-4.2.1\sbin
# 2ï¼å¯ç¨ç®¡çæä»¶
C:\Program Files\RabbitMQ Server\rabbitmq_server-4.2.1\sbin&gt;.\rabbitmq-plugins.bat enable rabbitmq_management
Enabling plugins on node rabbit@chengzijia:
rabbitmq_management
The following plugins have been configured:
  rabbitmq_management
  rabbitmq_management_agent
  rabbitmq_web_dispatch
Applying plugin configuration to rabbit@chengzijia...
The following plugins have been enabled:
  rabbitmq_management
  rabbitmq_management_agent
  rabbitmq_web_dispatch

set 3 plugins.
Offline change; changes will take effect at broker restart.</code></pre>
<p>å¯ç¨åéè¦æå¨éå¯ä¸ RabbitMQ æå¡ï¼ç¶åéè¿ <a title="http://localhost:15672/" href="http://localhost:15672/" target="_blank" rel="noopener nofollow">http://localhost:15672/</a> è®¿é®ãéè¦ç»å½è´¦å·åå¯ç ï¼åä¸º guestã</p>
<p><span style="font-size: 12px"><em>æ³¨æï¼guest ç¨æ·é»è®¤åªè½ä» localhost ç»å½ï¼è¥éè¿ç¨è®¿é®ï¼éåå»ºæ°ç¨æ·å¹¶ææã</em></span></p>
<p>å¨ sbin ç®å½ä¸å¯ä½¿ç¨ä»¥ä¸å½ä»¤ï¼</p>
<table>
<thead>
<tr>
<th data-spm-anchor-id="5176.28103460.0.i17.96a0755137ugjt">å½ä»¤</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.\rabbitmqctl.bat status</code></td>
<td data-spm-anchor-id="5176.28103460.0.i15.96a0755137ugjt">æ¥çèç¹ç¶æ</td>
</tr>
<tr>
<td><code>.\rabbitmqctl.bat list_users</code></td>
<td>ååºç¨æ·</td>
</tr>
<tr>
<td><code>.\rabbitmqctl.bat add_user myuser mypass</code></td>
<td>æ·»å ç¨æ·</td>
</tr>
<tr>
<td><code>.\rabbitmqctl.bat set_user_tags myuser administrator</code></td>
<td>è®¾ç½®ç¨æ·ä¸ºç®¡çå</td>
</tr>
<tr>
<td data-spm-anchor-id="5176.28103460.0.i16.96a0755137ugjt"><code>.\rabbitmqctl.bat set_permissions -p / myuser ".*" ".*" ".*"</code></td>
<td>æäº vhost&nbsp;<code>/</code>&nbsp;çå¨é¨æé</td>
</tr>
</tbody>
</table>
<p>éç½®åè®¸è¿ç¨è®¿é®ï¼</p>
<pre class="language-powershell highlighter-hljs"><code># åå»ºæ°ç¨æ·
.\rabbitmqctl.bat add_user admin yourpassword
.\rabbitmqctl.bat set_user_tags admin administrator
.\rabbitmqctl.bat set_permissions -p / admin ".*" ".*" ".*"
# ç¡®ä¿é²ç«å¢å¼æ¾ç«¯å£ï¼
# AMQP é»è®¤ç«¯å£ï¼5672
# Management Web UI ç«¯å£ï¼15672</code></pre>
<h4>1.2.2 éè¿ Serilog.Sinks.RabbitMQ 8.0.0 å®ç°è®²æ¶æ¯åå¥å°éå</h4>
<p>ç¤ºä¾ç¨åºçç®æ ï¼<strong>å°æ¥å¿ä¿¡æ¯éè¿ localhost guest è´¦å·ï¼æ¨éå° amq.fanout äº¤æ¢æºã</strong></p>
<p>1ï¼åå»ºé¡¹ç®å¹¶å¼å¥å¿è¦çå</p>
<p>åå»ºä¸ä¸ªåºäº .net8 çæ§å¶å°åºç¨ç¨åºï¼å¹¶å¼å¥ä»¥ä¸åï¼</p>
<pre class="language-powershell highlighter-hljs"><code>dotnet add package Serilog
dotnet add package Serilog.Sinks.Console
dotnet add package Serilog.Sinks.RabbitMQ</code></pre>
<p>2ï¼ä¿®æ¹ Program.cs</p>
<pre class="language-csharp highlighter-hljs"><code>using RabbitMQ.Client;
using Serilog;
using Serilog.Events;
using Serilog.Formatting.Json;
using Serilog.Sinks.RabbitMQ;

// å° Serilog Sink åé¨çå¼å¸¸ï¼å¦è¿æ¥å¤±è´¥ãæééè¯¯ãexchange ä¸å­å¨ç­ï¼è¾åºå°æ§å¶å°
Serilog.Debugging.SelfLog.Enable(Console.Error);

// éç½® Serilog
Log.Logger = new LoggerConfiguration()
    .MinimumLevel.Debug()
    .WriteTo.Console()
    .WriteTo.RabbitMQ((clientConfiguration, sinkConfiguration) =&gt;
    {
        clientConfiguration.Port = 5672;
        clientConfiguration.DeliveryMode = RabbitMQDeliveryMode.Durable;
        clientConfiguration.Exchange = "amq.fanout";
        clientConfiguration.Username = "guest";
        clientConfiguration.Password = "guest";
        clientConfiguration.ExchangeType = "fanout";
        clientConfiguration.Hostnames.Add("localhost");
        sinkConfiguration.TextFormatter = new JsonFormatter();
    }).CreateLogger();

try
{
    Log.Information("åºç¨ç¨åºå¯å¨");
    // ç¤ºä¾ç»æåæ¥å¿
    var userId = 12345;
    var userName = "alice";
    Log.Information("ç¨æ· {@User} ç»å½æåï¼ID: {UserId}", new { Name = userName, Role = "Admin" }, userId);
    Log.Warning("è¿æ¯ä¸ä¸ªè­¦åæ¥å¿ï¼åå«å±æ§ {RetryCount}", 3);
    Log.Error(new InvalidOperationException("æ¨¡æå¼å¸¸"), "å¤çè¯·æ±æ¶åçéè¯¯ï¼è¯·æ±ID: {RequestId}", Guid.NewGuid());
    Log.Information("åºç¨ç¨åºå³å°å³é­");
}
catch (Exception ex)
{
    Log.Fatal(ex, "åºç¨ç¨åºå´©æº");
}
finally
{
    Log.CloseAndFlush(); // ç¡®ä¿æ¥å¿è¢«åé
}</code></pre>
<p>å¨æµè¯åå¥æ¥å¿ä¹åï¼éè¦åæå¨æ°å¢éåï¼logs_firstï¼ç¶ååå°æ­¤éåå å¥å° amq.fanout äº¤æ¢æºä¸­ã</p>
<p><span style="background-color: rgba(251, 238, 184, 1)"><strong>æ°å¢éå</strong></span>ï¼å¡«å¥ Nameï¼ç¶åå¶ä»é»è®¤ï¼ç´æ¥ä¿å­ã</p>
<p><img src="https://img2024.cnblogs.com/blog/1868241/202512/1868241-20251202193859301-511521966.png" alt="image"></p>
<p><span style="background-color: rgba(251, 238, 184, 1)"><strong>å°æ°å¢çéåç»å®å°äº¤æ¢æº amq.fanout ä¸­</strong></span>ï¼ï¼ç´æ¥è¾å¥ä¸ä¸æ­¥æ°å¢çéåï¼ç¹å» Bindï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1868241/202512/1868241-20251202194106507-753137885.png" alt="image"></p>
<p>ç¶åè¿è¡ç¨åºï¼æ¥çéåä¸­çæ¶æ¯ï¼ç¡®è®¤æ¯å¦åå¥æåã</p>
<h4>1.2.3 æ¥çæ¶æ¯åå¥ç»æ</h4>
<p><span style="background-color: rgba(251, 238, 184, 1)">ç¹å»éååï¼è¿å¥éåçè¯¦ç»ä¿¡æ¯ã</span></p>
<p><img src="https://img2024.cnblogs.com/blog/1868241/202512/1868241-20251202194417662-2092330832.png" alt="image"></p>
<p><span style="background-color: rgba(251, 238, 184, 1)">ç¹å»ï¼Get Message(s)ï¼è·åæå®æ¡æ°éåä¸­çæ¶æ¯ã</span></p>
<p><img src="https://img2024.cnblogs.com/blog/1868241/202512/1868241-20251202194655663-127466200.png" alt="image"></p>
<p><span style="background-color: rgba(251, 238, 184, 1)">å¦ä¸æ¯æ¶æ¯çè¯¦ç»ä¿¡æ¯ï¼</span></p>
<pre class="language-csharp highlighter-hljs"><code>Message 1
The server reported 4 messages remaining.

Exchange	amq.fanout
Routing Key	
Redelivered	â
Properties	
delivery_mode:	2
Payload
112 bytes
Encoding: string
{"Timestamp":"2025-12-02T19:25:27.5782940+08:00","Level":"Information","MessageTemplate":"åºç¨ç¨åºå¯å¨"}

Message 2
The server reported 3 messages remaining.

Exchange	amq.fanout
Routing Key	
Redelivered	â
Properties	
delivery_mode:	2
Payload
205 bytes
Encoding: string
{"Timestamp":"2025-12-02T19:25:28.2261865+08:00","Level":"Information","MessageTemplate":"ç¨æ· {@User} ç»å½æåï¼ID: {UserId}","Properties":{"User":{"Name":"alice","Role":"Admin"},"UserId":12345}}

Message 3
The server reported 2 messages remaining.

Exchange	amq.fanout
Routing Key	
Redelivered	â
Properties	
delivery_mode:	2
Payload
172 bytes
Encoding: string
{"Timestamp":"2025-12-02T19:25:28.2352913+08:00","Level":"Warning","MessageTemplate":"è¿æ¯ä¸ä¸ªè­¦åæ¥å¿ï¼åå«å±æ§ {RetryCount}","Properties":{"RetryCount":3}}

Message 4
The server reported 1 messages remaining.

Exchange	amq.fanout
Routing Key	
Redelivered	â
Properties	
delivery_mode:	2
Payload
266 bytes
Encoding: string
{"Timestamp":"2025-12-02T19:25:28.2368545+08:00","Level":"Error","MessageTemplate":"å¤çè¯·æ±æ¶åçéè¯¯ï¼è¯·æ±ID: {RequestId}","Exception":"System.InvalidOperationException: æ¨¡æå¼å¸¸","Properties":{"RequestId":"0003f90d-4b1e-4cd9-87ef-a875e31b3acb"}}

Message 5
The server reported 0 messages remaining.

Exchange	amq.fanout
Routing Key	
Redelivered	â
Properties	
delivery_mode:	2
Payload
118 bytes
Encoding: string
{"Timestamp":"2025-12-02T19:25:28.2457995+08:00","Level":"Information","MessageTemplate":"åºç¨ç¨åºå³å°å³é­"}</code></pre>
</div>
<div id="MySignature" role="contentinfo">
    <img src="https://images.cnblogs.com/cnblogs_com/blogs/683398/galleries/2417207/o_221441c4.png">
<p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/hnzhengfy/" target="_blank">æ©å­å®¶</a>ï¼æ¬¢è¿å¾®ä¿¡æ«ç å³æ³¨åä¸»ãæ©å­å®¶czzjãï¼æä»»ä½çé®æ¬¢è¿æ²éï¼å±åæé¿ï¼</p>
<div><p style="float: left;">è½¬è½½æ¬æè¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/hnzhengfy/p/19191039/Serilog_MQSinks" target="_blank">https://www.cnblogs.com/hnzhengfy/p/19191039/Serilog_MQSinks</a></p></div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-04 19:55">2026-01-04 19:54</span>&nbsp;
<a href="https://www.cnblogs.com/hnzhengfy">æ©å­å®¶</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19191039);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19191039', targetLink: 'https://www.cnblogs.com/hnzhengfy/p/19191039/Serilog_MQSinks', title: 'Serilog æ¥å¿åºç®åå®è·µï¼åï¼æ¶æ¯éå Sinksï¼.net8ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ MAFå¿«éå¥é¨ï¼10ï¼å¾ªç¯å·¥ä½æµ ]]></title>
    <link>https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper10</link>
    <guid>4c2d2e908970ef857d4ec51813e2615f</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper10" title="åå¸äº 2026-01-04 18:30">
    <span role="heading" aria-level="2">MAFå¿«éå¥é¨ï¼10ï¼å¾ªç¯å·¥ä½æµ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/381412/202601/381412-20260103192858891-1281339805.png" alt="MAFå¿«éå¥é¨ï¼10ï¼å¾ªç¯å·¥ä½æµ" class="desc_img">
        å¨å®éä¸å¡åºæ¯ä¸­ï¼å¾å¾éè¦å¨å·¥ä½æµä¸­è®¾ç½®ä¸äºå¾ªç¯ä¸èªæä¿®æ­£çæºå¶ï¼æå»ºåºä¸ä¸ªâçæâå®¡æ ¸âä¿®å¤âçé­ç¯ï¼æ¥ç¡®ä¿AIäº§åºçåå®¹è½å¤æ»¡è¶³ä¼ä¸çº§è´¨éæ åã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><span><span>å¤§å®¶å¥½ï¼ææ¯Edisonã</span></span></p>
<p><span><span>æè¿æä¸ç´å¨è·çå£æ°çã<a class="normal_text_link mp_article_text_link" href="https://www.cnblogs.com/sheng-jie/p/19200934" target="_blank" data-itemshowtype="0" data-linktype="2"><span>.NET+AIæºè½ä½å¼åè¿é¶</span></a><span>ãè¯¾ç¨å­¦ä¹ MAFçå¼åæå·§ï¼æå¼ºçæ¨èä½ ä¹ä¸è½¦è·æä¸èµ·åºåï¼</span></span></span></p>
<p><span><a class="normal_text_link mp_article_text_link" href="https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper09" target="_blank" data-itemshowtype="0" data-linktype="2"><span>ä¸ä¸ç¯</span></a><span>ï¼æä»¬å­¦ä¹ äºMAFä¸­å¦ä½è¿è¡switch-caseç±»åçå¤æ¡ä»¶è·¯ç±<span>ãæ¬ç¯ï¼æä»¬æ¥äºè§£ä¸å¨MAFä¸­å¦ä½å®ç°å¾ªç¯ï¼èªæä¿®æ­£ï¼å·¥ä½æµã</span></span></span></p>
<h1><strong>1 å¾ªç¯ä¸èªæä¿®æ­£</strong></h1>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span>å¨å®éä¸å¡åºæ¯ä¸­ï¼å¾å¾éè¦å¨å·¥ä½æµä¸­è®¾ç½®ä¸äºå¾ªç¯ä¸èªæä¿®æ­£çæºå¶ï¼æå»ºåºä¸ä¸ªâ<span><strong>çæ</strong><span><span><strong>âå®¡æ ¸</strong><span data-pm-slice="0 0 []"><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;letter-spacing: 0.578px;text-align: left;margin: 8px;&quot;,&quot;data-pm-slice&quot;:&quot;6 3 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;min-height: 1em;text-align: left;visibility: visible;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;caret-color: var(--weui-BRAND);box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><strong>âä¿®å¤</strong><span><span>âçé­ç¯ï¼æ¥ç¡®ä¿AIäº§åºçåå®¹è½å¤æ»¡è¶³ä¼ä¸çº§è´¨éæ å<span>ã</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span>å¨MAFä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨ Loop Edge å³ å¾ªç¯è¾¹ æ¥å®ç°è¿ä¸ªç®ç<span>ï¼å¦ä¸ä»£ç çæ®µæç¤ºï¼</span></span></span></span></span></span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> workflow = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> WorkflowBuilder(draftExecutor)
    .AddEdge(draftExecutor, qcExecutor)
    .AddEdge(qcExecutor, draftExecutor)
    .WithOutputFrom(qcExecutor)
    .Build();</span></pre>
</div>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span>å¯ä»¥çå°ï¼æä»¬æ·»å äºä¸¤ä¸ªè¾¹å³èå³ç³»ï¼è¿æ ·å°±å½¢æäºä¸ä¸ªå¾ªç¯ã</span></span></span></span></span></span></span></p>
<h1><strong>2 å¾ªç¯å·¥ä½æµå®éªæ¡ä¾</strong></h1>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span>åè®¾æä»¬æ¯ä¸ä¸ªçµåå¹³å°çå®¢æä¸­å¿ï¼æ¯å¤©éè¦å¤çäº§ççå¤§éå®¢æå·¥åè¿è¡åå¤ãè¿éæä»¬å¸æAIå©æåå¸®æä»¬çæä¸ä¸ªåå¤èç¨¿ï¼ç¶åç»è¿å¤ç»´åº¦çè´¨æ£ï¼ç¤¼è²åº¦ãåç¡®æ§ãåè§æ§ï¼ï¼ä¸åæ ¼çåèªå¨è¿è¡æ¹è¿ï¼ç´å°æ»¡è¶³æ å æèæ¯ è½¬ç»äººå·¥å¤çã</span><span><span>å æ­¤ï¼æä»¬çç®æ æ¯ï¼éç½®ä¸ä¸ªèªå¨è¿­ä»£çå¾ªç¯â<span data-pm-slice="2 3 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;letter-spacing: 0.578px;text-align: left;margin: 8px;&quot;,&quot;data-pm-slice&quot;:&quot;6 3 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span>çæ<span><span>âå®¡æ ¸<span data-pm-slice="0 0 []"><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;letter-spacing: 0.578px;text-align: left;margin: 8px;&quot;,&quot;data-pm-slice&quot;:&quot;6 3 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;min-height: 1em;text-align: left;visibility: visible;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;caret-color: var(--weui-BRAND);box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>âä¿®å¤âï¼è¾¾æ å³å¯éåºå¾ªç¯ï¼å¦åè½¬äººå·¥å¤çã</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<h3><strong><span><span>2.1 å³é®ä¾èµåå¼å¥</span></span></strong></h3>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span>å¨ä»å¤©çè¿ä¸ªæ¡ä¾ä¸­ï¼æä»¬ä»ç¶åå»ºäºä¸ä¸ª.NETæ§å¶å°åºç¨ç¨åºï¼å®è£äºä»¥ä¸NuGetåï¼</span></span></span></span></span></span></span></span></p>
<ul class="list-paddingleft-1">
<li><span>Microsoft.Agents.AI.OpenAI</span></li>
<li><span>Microsoft.Agents.AI.Workflows</span></li>
<li><span>Microsoft.Extensions.AI.OpenAI</span></li>
</ul>
<h3><span><span>2.2 å®ä¹æ°æ®ä¼ è¾æ¨¡å</span></span></h3>
<p><span><span>é¦åï¼æä»¬å®ä¹ä¸ä¸å¨è¿ä¸ªå·¥ä½æµä¸­éè¦çæä¼ éçæ°æ®æ¨¡åï¼</span></span></p>
<p><span><span>ï¼1ï¼QualityReportDto ï¼è´¨æ£ç»æè¾åºæ¨¡åDTO</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è´¨æ£ç»æçç»æåè¾åºæ¨¡å</span>
<span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> QualityReportDto
{
    [JsonPropertyName(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">politenessScore</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> PolitenessScore { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    [JsonPropertyName(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">accuracyScore</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> AccuracyScore { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    [JsonPropertyName(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">compliancePassed</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">bool</span> CompliancePassed { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    [JsonPropertyName(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">issues</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> List&lt;QualityIssueDto&gt; Issues { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">();
}
</span><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> QualityIssueDto
{
    [JsonPropertyName(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">type</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Type { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.Empty;
    [JsonPropertyName(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">description</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Description { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.Empty;
    [JsonPropertyName(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">scoreImpact</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> ScoreImpact { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
}</span></pre>
</div>
<p><span><span>ï¼2ï¼ä¸äºå¼å¯¹è±¡ï¼ä¸èµè¿°äº</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span><span style="color: rgba(0, 0, 0, 1)"> record ReplyDraft(
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> TicketId, 
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> Content, 
    </span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> Attempt);
</span><span style="color: rgba(0, 0, 255, 1)">internal</span><span style="color: rgba(0, 0, 0, 1)"> record TicketRequest(
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> Id, 
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> Query, 
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> Category, 
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> Priority);
</span><span style="color: rgba(0, 0, 255, 1)">internal</span><span style="color: rgba(0, 0, 0, 1)"> record TicketOutcome(
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> TicketId, 
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> Status, 
    </span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> Attempts, 
    QualityReport FinalReport);
</span><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span><span style="color: rgba(0, 0, 0, 1)"> record QualityScoreTimelineItem(
    </span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> Attempt,
    </span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> PolitenessScore,
    </span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> AccuracyScore,
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> ComplianceStatus);
</span><span style="color: rgba(0, 0, 255, 1)">internal</span><span style="color: rgba(0, 0, 0, 1)"> record QualityIssue(
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> Type, 
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> Description, 
    </span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> ScoreImpact);
</span><span style="color: rgba(0, 0, 255, 1)">internal</span><span style="color: rgba(0, 0, 0, 1)"> record QualityReport(
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> TicketId, 
    </span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> PolitenessScore, 
    </span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> AccuracyScore, 
    </span><span style="color: rgba(0, 0, 255, 1)">bool</span><span style="color: rgba(0, 0, 0, 1)"> CompliancePassed, 
    IReadOnlyList</span>&lt;QualityIssue&gt; Issues);</pre>
</div>
<p><span><span>ï¼3ï¼ä¸äºå¸¸éï¼ç¨äºå®ä¹ä¸äºéå¼æ å</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> QualityCheckConstants
{
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è´¨æ£æ åï¼ç¤¼è²åº¦ â¥ 85ï¼åç¡®æ§ â¥ 90ï¼åè§æ§å¿é¡» 100%
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ³¨æï¼éå¼è®¾ç½®è¾é«ï¼éåç¬¬ä¸æ¬¡çæç®åçæ¬ï¼ç¡®ä¿è½ä½ç°å¾ªç¯æ¹è¿è¿ç¨</span>
    <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">const</span> <span style="color: rgba(0, 0, 255, 1)">int</span> PolitenessThreshold = <span style="color: rgba(128, 0, 128, 1)">85</span><span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">const</span> <span style="color: rgba(0, 0, 255, 1)">int</span> AccuracyThreshold = <span style="color: rgba(128, 0, 128, 1)">90</span><span style="color: rgba(0, 0, 0, 1)">;
}

</span><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">enum</span><span style="color: rgba(0, 0, 0, 1)"> QualityCheckSignal
{
    Init,
    Revise
}</span></pre>
</div>
<h3><span><span>2.3 å®ä¹èªå®ä¹å·¥ä½æµäºä»¶</span></span></h3>
<p><span><span>å¶æ¬¡ï¼æä»¬å®ä¹ä¸ä¸å¨è¿ä¸ªå·¥ä½æµä¸­éè¦äº§ççèªå®ä¹äºä»¶ï¼</span></span></p>
<p>ï¼1ï¼AdaptiveQualityScoreEvent ï¼è´¨æ£è¯åå·²å®æäºä»¶</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> AdaptiveQualityScoreEvent : WorkflowEvent
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> AdaptiveQualityScoreEvent(<span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> ticketId, 
        </span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> attempt, 
        </span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> politenessScore, 
        </span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> accuracyScore, 
        </span><span style="color: rgba(0, 0, 255, 1)">bool</span><span style="color: rgba(0, 0, 0, 1)"> compliancePassed)
        : </span><span style="color: rgba(0, 0, 255, 1)">base</span>(<span style="color: rgba(0, 0, 255, 1)">new</span> { TicketId = ticketId, Attempt = attempt, PolitenessScore = politenessScore, AccuracyScore = accuracyScore, CompliancePassed =<span style="color: rgba(0, 0, 0, 1)"> compliancePassed })
    {
    }
}</span></pre>
</div>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; text-transform: none; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-align: left; line-height: 1.75em; margin-top: 8px; margin-bottom: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ï¼2ï¼AdaptiveMaxAttemptsReachedEvent ï¼è´¨æ£è¶è¿æå¤§æ¬¡æ°äºä»¶</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> AdaptiveMaxAttemptsReachedEvent : WorkflowEvent
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> AdaptiveMaxAttemptsReachedEvent(<span style="color: rgba(0, 0, 255, 1)">string</span> ticketId, <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> maxAttempts)
        : </span><span style="color: rgba(0, 0, 255, 1)">base</span>(<span style="color: rgba(0, 0, 255, 1)">new</span> { TicketId = ticketId, MaxAttempts =<span style="color: rgba(0, 0, 0, 1)"> maxAttempts })
    {
    }
}</span></pre>
</div>
<h3><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;background-color: rgb(255, 255, 255);outline: 0px;visibility: visible;line-height: 1.75em;margin-top: 16px;margin-bottom: 16px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>2.4 å®ä¹Agents</span></span></h3>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;text-transform: none;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-align: left;line-height: 1.75em;margin-bottom: 8px;margin-top: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ï¼1ï¼<strong>åå¤çæ</strong>ï¼æ¨¡</span>è¿ééè¿æ§è¡å¨çæ¹å¼åè£¹ä¸ä¸ªåå¤çæçAgentï¼åè®¾å¶ç¨äºå®¢æå·¥åçèªå¨åå¤ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span> AdaptiveReplyDraftExecutor : Executor&lt;QualityCheckSignal&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> TicketRequest _ticket;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> IChatClient _chatClient;

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> AdaptiveReplyDraftExecutor(TicketRequest ticket, IChatClient chatClient) : <span style="color: rgba(0, 0, 255, 1)">base</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">AdaptiveReplyDraft</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        _ticket </span>=<span style="color: rgba(0, 0, 0, 1)"> ticket;
        _chatClient </span>=<span style="color: rgba(0, 0, 0, 1)"> chatClient;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span> ValueTask HandleAsync(QualityCheckSignal message, IWorkflowContext context, CancellationToken cancellationToken = <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 0, 255, 1)">int</span> attempt = <span style="color: rgba(0, 0, 255, 1)">await</span> context.ReadOrInitStateAsync(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">attempt</span><span style="color: rgba(128, 0, 0, 1)">"</span>, () =&gt; <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">, cancellationToken);
        attempt</span>++<span style="color: rgba(0, 0, 0, 1)">;
        </span><span style="color: rgba(0, 0, 255, 1)">await</span> context.QueueStateUpdateAsync(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">attempt</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, attempt, cancellationToken);

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä½¿ç¨ AI çæå®¢æåå¤ï¼æ¸è¿å¼çæç­ç¥ï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> prompt = attempt == <span style="color: rgba(128, 0, 128, 1)">1</span>
            ? $<span style="color: rgba(128, 0, 0, 1)">"""
</span><span style="color: rgba(0, 0, 0, 1)">            ä½ æ¯ä¸ä½çµåå®¢æãè¯·éå¯¹ä»¥ä¸å®¢æ·é®é¢çæä¸æ¡ç®ç­åå¤ï¼å»æä¿æç®ç­ãç¼ºå°ç¤¼è²ç¨è¯­ï¼ï¼

            å®¢æ·é®é¢ï¼{_ticket.Query}
            äº§åç±»å«ï¼{_ticket.Category}

            è¦æ±ï¼
            </span><span style="color: rgba(128, 0, 128, 1)">1</span>. åªç¨1-<span style="color: rgba(0, 0, 0, 1)">2å¥è¯åç­ï¼ä¸è¦ç§°å¼è¯­åæè°¢è¯­
            </span><span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">. åªè¯´ç»è®ºï¼ä¸æä¾å·ä½å¤çæ¶é´
            </span><span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)">. å­æ°æ§å¶å¨30å­ä»¥å

            ç´æ¥è¿ååå¤åå®¹ï¼ä¸è¦æ·»å ä»»ä½åç¼æè¯´æã
            </span><span style="color: rgba(128, 0, 0, 1)">"""
</span>            : $<span style="color: rgba(128, 0, 0, 1)">"""
</span><span style="color: rgba(0, 0, 0, 1)">            ä½ æ¯ä¸ä½ä¸ä¸ççµåå®¢æãè¯·éå¯¹ä»¥ä¸å®¢æ·é®é¢çæä¸æ¡æ¹è¿åçåå¤ï¼

            å®¢æ·é®é¢ï¼{_ticket.Query}
            äº§åç±»å«ï¼{_ticket.Category}
            ä¼åçº§ï¼{_ticket.Priority}

            è¦æ±ï¼
            </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">. è¯­æ°äº²åãä¸ä¸ï¼ä½¿ç¨æ°å½çç§°å¼åæè°¢è¯­
            </span><span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">. æä¾å·ä½çè§£å³æ¹æ¡æå¤çæ¶é´
            </span><span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)">. ç¬¦åå®¢æè§èï¼ä¸åå«ææè¯
            </span><span style="color: rgba(128, 0, 128, 1)">4</span>. å­æ°æ§å¶å¨80-<span style="color: rgba(0, 0, 0, 1)">100å­

            ç´æ¥è¿ååå¤åå®¹ï¼ä¸è¦æ·»å ä»»ä½åç¼æè¯´æã
            </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">;</span>

        <span style="color: rgba(0, 0, 255, 1)">var</span> response = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> _chatClient.GetResponseAsync(prompt, cancellationToken: cancellationToken);
        </span><span style="color: rgba(0, 0, 255, 1)">var</span> content = response.Text ?? <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ±æ­ï¼æä»¬ä¼å°½å¿«å¤çæ¨çé®é¢ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;

        Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">âï¸ ç¬¬ {attempt} æ¬¡çæåå¤èç¨¿ (ç­ç¥: {(attempt == 1 ? </span><span style="color: rgba(128, 0, 0, 1)">"</span>ç®åç<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)"> : </span><span style="color: rgba(128, 0, 0, 1)">"</span>å®æ´ç<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">)})</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð åå¤åå®¹ï¼{content}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

        </span><span style="color: rgba(0, 0, 255, 1)">var</span> draft = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ReplyDraft(_ticket.Id, content, attempt);
        </span><span style="color: rgba(0, 0, 255, 1)">await</span> context.SendMessageAsync(draft, targetId: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">AdaptiveQualityCheck</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, cancellationToken);
    }
}</span></pre>
</div>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;text-transform: none;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-align: left;line-height: 1.75em;margin-bottom: 8px;margin-top: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ï¼2ï¼</span><strong><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;text-transform: none;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-align: left;line-height: 1.75em;margin-bottom: 8px;margin-top: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span>åå®¹è´¨æ£</span></span></span></strong><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;text-transform: none;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-align: left;line-height: 1.75em;margin-bottom: 8px;margin-top: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ï¼æ¨¡æçæåå®¹çè´¨æ£è¿ç¨ï¼éè¿AIå¤§æ¨¡åå¯¹åå®¹è¿è¡å¤ç»´åº¦çè´¨æ£è¯åï¼åªæéè¿æ åæç®ç»æå¾ªç¯ï¼å¦åç»§ç»­åé¦ç»ä¸ä¸ä¸ªAgentè¿è¡æ¹è¿ã</span></p>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;text-transform: none;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-align: left;line-height: 1.75em;margin-bottom: 8px;margin-top: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">NOTEï¼åªæè´¨æ£Agentæè½å³å®æ¯å¦ç»æå·¥ä½æµï¼</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span> AdaptiveQualityCheckExecutor : Executor&lt;ReplyDraft&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span> <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> _politenessThreshold;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span> <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> _accuracyThreshold;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span> <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> _maxAttempts;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> IChatClient _chatClient;

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> é»è®¤æå¤§å°è¯æ¬¡æ°ä¸º5æ¬¡</span>
    <span style="color: rgba(0, 0, 255, 1)">public</span> AdaptiveQualityCheckExecutor(<span style="color: rgba(0, 0, 255, 1)">int</span> politenessThreshold, <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> accuracyThreshold, IChatClient chatClient)
        : </span><span style="color: rgba(0, 0, 255, 1)">this</span>(politenessThreshold, accuracyThreshold, <span style="color: rgba(128, 0, 128, 1)">5</span><span style="color: rgba(0, 0, 0, 1)">, chatClient)
    {
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> AdaptiveQualityCheckExecutor(<span style="color: rgba(0, 0, 255, 1)">int</span> politenessThreshold, <span style="color: rgba(0, 0, 255, 1)">int</span> accuracyThreshold, <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> maxAttempts, IChatClient chatClient)
        : </span><span style="color: rgba(0, 0, 255, 1)">base</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">AdaptiveQualityCheck</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        _politenessThreshold </span>=<span style="color: rgba(0, 0, 0, 1)"> politenessThreshold;
        _accuracyThreshold </span>=<span style="color: rgba(0, 0, 0, 1)"> accuracyThreshold;
        _maxAttempts </span>=<span style="color: rgba(0, 0, 0, 1)"> maxAttempts;
        _chatClient </span>=<span style="color: rgba(0, 0, 0, 1)"> chatClient;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span> ValueTask HandleAsync(ReplyDraft draft, IWorkflowContext context, CancellationToken cancellationToken = <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 0, 255, 1)">int</span> attempt = <span style="color: rgba(0, 0, 255, 1)">await</span> context.ReadOrInitStateAsync(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">attempt</span><span style="color: rgba(128, 0, 0, 1)">"</span>, () =&gt; <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">, cancellationToken);

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä½¿ç¨ AI è¿è¡å¤ç»´åº¦è´¨æ£è¯åï¼ç»æåè¾åºï¼ä¸¥æ ¼æ åï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> prompt = $<span style="color: rgba(128, 0, 0, 1)">"""
</span>        ä½ æ¯ä¸ä½ä¸¥æ ¼çå®¢æè´¨æ£ä¸å®¶ãè¯·å¯¹ä»¥ä¸å®¢æåå¤è¿è¡å¤ç»´åº¦è¯åï¼<span style="color: rgba(128, 0, 128, 1)">0</span>-<span style="color: rgba(0, 0, 0, 1)">100åï¼ï¼

        åå¤åå®¹ï¼{draft.Content}

        è¯åç»´åº¦åä¸¥æ ¼æ åï¼
        </span><span style="color: rgba(128, 0, 128, 1)">1</span>. ç¤¼è²åº¦ï¼<span style="color: rgba(128, 0, 128, 1)">0</span>-<span style="color: rgba(128, 0, 128, 1)">100</span><span style="color: rgba(0, 0, 0, 1)">ï¼ï¼å¿é¡»åå«ç§°å¼è¯­ï¼æ¨ãäº²ï¼ãæè°¢è¯­ï¼æè°¢ãè°¢è°¢ï¼ãç»æè¯­ï¼ç¥ãæå¾ï¼ç­ï¼è¯­æ°äº²åæ¸©æ
           </span>-<span style="color: rgba(0, 0, 0, 1)"> ç¼ºå°ä»»ä½ä¸é¡¹æ£20å
           </span>- è¯­æ°çç¡¬ãæºæ¢°æ£10-<span style="color: rgba(0, 0, 0, 1)">30å

        </span><span style="color: rgba(128, 0, 128, 1)">2</span>. åç¡®æ§ï¼<span style="color: rgba(128, 0, 128, 1)">0</span>-<span style="color: rgba(128, 0, 128, 1)">100</span><span style="color: rgba(0, 0, 0, 1)">ï¼ï¼å¿é¡»æä¾å·ä½çè§£å³æ¹æ¡ãæç¡®çå¤çæ¶é´æææçåç»­æ­¥éª¤
           </span>- åªè¯´<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä¼å¤ç</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">ä½æ å·ä½æ¹æ¡æ£30å
           </span>-<span style="color: rgba(0, 0, 0, 1)"> æ æç¡®æ¶é´æ¿è¯ºæ£20å
           </span>- ä¿¡æ¯è¿äºç¬¼ç»æ£10-<span style="color: rgba(0, 0, 0, 1)">20å

        </span><span style="color: rgba(128, 0, 128, 1)">3</span>. åè§æ§ï¼éè¿/<span style="color: rgba(0, 0, 0, 1)">ä¸éè¿ï¼ï¼ä¸å¾åå«ææè¯ãä¸å½è¡¨è¿°ãæ¨è¯¿è´£ä»»çè¯è¯­
           </span>- åç°ä»»ä½ææè¯æä¸å½è¡¨è¿°ç´æ¥å¤å®ä¸º<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä¸éè¿</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">

        è¯·å¯¹æ¯ä¸ªç»´åº¦è¿è¡ä¸¥æ ¼è¯åï¼å¹¶å¨issueså­æ®µä¸­ååºææåç°çé®é¢ã
        </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">;</span>

        <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> â­ ä½¿ç¨ç»æåè¾åºï¼GetResponseAsync&lt;T&gt; èªå¨çæ JSON Schema å¹¶ååºåå</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> response = <span style="color: rgba(0, 0, 255, 1)">await</span> _chatClient.GetResponseAsync&lt;QualityReportDto&gt;<span style="color: rgba(0, 0, 0, 1)">(prompt, cancellationToken: cancellationToken);
        </span><span style="color: rgba(0, 0, 255, 1)">var</span> reportDto =<span style="color: rgba(0, 0, 0, 1)"> response.Result;

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è½¬æ¢ä¸ºä¸å¡æ¨¡å</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> issues = reportDto.Issues.Select(i =&gt; <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> QualityIssue(i.Type, i.Description, i.ScoreImpact)).ToList();
        </span><span style="color: rgba(0, 0, 255, 1)">var</span> report = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> QualityReport(draft.TicketId, reportDto.PolitenessScore, reportDto.AccuracyScore, reportDto.CompliancePassed, issues);

        </span><span style="color: rgba(0, 0, 255, 1)">await</span> context.AddEventAsync(<span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> AdaptiveQualityScoreEvent(draft.TicketId, attempt, reportDto.PolitenessScore, reportDto.AccuracyScore, reportDto.CompliancePassed), cancellationToken);

        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (reportDto.PolitenessScore &gt;=<span style="color: rgba(0, 0, 0, 1)"> _politenessThreshold 
            </span>&amp;&amp; reportDto.AccuracyScore &gt;=<span style="color: rgba(0, 0, 0, 1)"> _accuracyThreshold 
            </span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)"> reportDto.CompliancePassed)
        {
            </span><span style="color: rgba(0, 0, 255, 1)">await</span> context.YieldOutputAsync(<span style="color: rgba(0, 0, 255, 1)">new</span> TicketOutcome(draft.TicketId, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Approved</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, attempt, report), cancellationToken);
        }
        </span><span style="color: rgba(0, 0, 255, 1)">else</span> <span style="color: rgba(0, 0, 255, 1)">if</span> (attempt &gt;=<span style="color: rgba(0, 0, 0, 1)"> _maxAttempts)
        {
            </span><span style="color: rgba(0, 0, 255, 1)">await</span> context.AddEventAsync(<span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> AdaptiveMaxAttemptsReachedEvent(draft.TicketId, _maxAttempts), cancellationToken);
            </span><span style="color: rgba(0, 0, 255, 1)">await</span> context.RequestHaltAsync();<span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">è´¨æ£å¤±è´¥ï¼å·²è¾¾å°æå¤§å°è¯æ¬¡æ°</span>
<span style="color: rgba(0, 0, 0, 1)">        }
        </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">
        {
            </span><span style="color: rgba(0, 0, 255, 1)">await</span> context.QueueStateUpdateAsync(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">attempt</span><span style="color: rgba(128, 0, 0, 1)">"</span>, attempt + <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">, cancellationToken);

            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åéè´¨æ£æ¥åå°æ¹è¿ç¯è</span>
            <span style="color: rgba(0, 0, 255, 1)">await</span> context.SendMessageAsync(report, targetId: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">IntelligentImprove</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, cancellationToken);
        }
    }
}</span></pre>
</div>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;text-transform: none;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-align: left;line-height: 1.75em;margin-bottom: 8px;margin-top: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ï¼3ï¼</span><strong><strong><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;text-transform: none;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-align: left;line-height: 1.75em;margin-bottom: 8px;margin-top: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span>åå®¹æ¹è¿</span></span></span></strong></strong><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;text-transform: none;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-align: left;line-height: 1.75em;margin-bottom: 8px;margin-top: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ï¼æ¨¡ææ¶å°è´¨æ£çè¯ååé¦åå¯¹åå®¹è¿è¡æ¹è¿ã</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span> IntelligentImproveExecutor : Executor&lt;QualityReport&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> TicketRequest _ticket;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> IChatClient _chatClient;

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> IntelligentImproveExecutor(TicketRequest ticket, IChatClient chatClient) : <span style="color: rgba(0, 0, 255, 1)">base</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">IntelligentImprove</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        _ticket </span>=<span style="color: rgba(0, 0, 0, 1)"> ticket;
        _chatClient </span>=<span style="color: rgba(0, 0, 0, 1)"> chatClient;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span> ValueTask HandleAsync(QualityReport report, IWorkflowContext context, CancellationToken cancellationToken = <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 0, 255, 1)">int</span> attempt = <span style="color: rgba(0, 0, 255, 1)">await</span> context.ReadOrInitStateAsync(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">attempt</span><span style="color: rgba(128, 0, 0, 1)">"</span>, () =&gt; <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">, cancellationToken);

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå»ºæ¹è¿æç¤ºè¯ï¼åºäºè´¨æ£åé¦</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> issuesSummary = <span style="color: rgba(0, 0, 255, 1)">string</span>.Join(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\n</span><span style="color: rgba(128, 0, 0, 1)">"</span>, report.Issues.Select(i =&gt; $<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">- {i.Type}: {i.Description}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">));

        </span><span style="color: rgba(0, 0, 255, 1)">var</span> prompt = $<span style="color: rgba(128, 0, 0, 1)">"""
</span><span style="color: rgba(0, 0, 0, 1)">        ä½ æ¯ä¸ä½å®¢æä¼åä¸å®¶ãè¯·æ ¹æ®ä»¥ä¸è´¨æ£åé¦ï¼æ¹è¿å®¢æåå¤åå®¹ï¼

        åå§é®é¢ï¼{_ticket.Query}
        äº§åç±»å«ï¼{_ticket.Category}
        ä¼åçº§ï¼{_ticket.Priority}

        å½åè¯åï¼
        </span>- ç¤¼è²åº¦ï¼{report.PolitenessScore}/<span style="color: rgba(128, 0, 128, 1)">100</span><span style="color: rgba(0, 0, 0, 1)"> (è¦æ±â¥{QualityCheckConstants.PolitenessThreshold})
        </span>- åç¡®æ§ï¼{report.AccuracyScore}/<span style="color: rgba(128, 0, 128, 1)">100</span><span style="color: rgba(0, 0, 0, 1)"> (è¦æ±â¥{QualityCheckConstants.AccuracyThreshold})
        </span>- åè§æ§ï¼{(report.CompliancePassed ? <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">éè¿</span><span style="color: rgba(128, 0, 0, 1)">"</span> : <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä¸éè¿</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)}

        åç°çé®é¢ï¼
        {issuesSummary}

        è¯·çæä¸æ¡æ¹è¿åçå®¢æåå¤ï¼éå¯¹æ§è§£å³ä¸è¿°é®é¢ï¼
        </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">. å¦æç¤¼è²åº¦ä¸è¶³ï¼å¢å ç§°å¼è¯­ãæè°¢è¯­ï¼ä½¿ç¨æ´äº²åçè¡¨è¿°
        </span><span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">. å¦æåç¡®æ§ä¸è¶³ï¼è¡¥åå·ä½çè§£å³æ¹æ¡ãå¤çæ¶é´ãåç»­æ­¥éª¤
        </span><span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)">. å¦æåè§æ§ä¸éè¿ï¼ç§»é¤ææè¯ï¼è§èè¡¨è¿°
        </span><span style="color: rgba(128, 0, 128, 1)">4</span>. å­æ°æ§å¶å¨80-<span style="color: rgba(0, 0, 0, 1)">100å­

        ç´æ¥è¿åæ¹è¿åçåå¤åå®¹ï¼ä¸è¦æ·»å ä»»ä½åç¼æè¯´æã
        </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">;</span>

        <span style="color: rgba(0, 0, 255, 1)">var</span> response = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> _chatClient.GetResponseAsync(prompt, cancellationToken: cancellationToken);
        </span><span style="color: rgba(0, 0, 255, 1)">var</span> improvedContent = response.Text ?? <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ±æ­ï¼æä»¬ä¼å°½å¿«å¤çæ¨çé®é¢ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;

        </span><span style="color: rgba(0, 0, 255, 1)">await</span> context.AddEventAsync(<span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> LoopProgressEvent(_ticket.Id, attempt, 
            report.PolitenessScore, report.AccuracyScore, 
            report.CompliancePassed, </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Improve</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">), cancellationToken);
        Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð§ ç¬¬ {attempt} æ¬¡æºè½æ¹è¿å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð æ¹è¿ååå®¹ï¼{improvedContent}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è§¦åä¸ä¸æ¬¡çæï¼ä½¿ç¨æ¹è¿åçåå®¹ä½ä¸ºä¸ä¸æï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">await</span> context.SendMessageAsync(QualityCheckSignal.Revise, targetId: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">AdaptiveReplyDraft</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, cancellationToken);
    }
}</span></pre>
</div>
<h3>2.5 æå»ºå·¥ä½æµ</h3>
<p>ç°å¨ä¸äºä¿±å¤ï¼åªæ¬ ä¸ä¸ªWorkflowï¼ç°å¨Let's do it!</p>
<p><strong>Step1: è·åChatClient</strong></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> chatClient = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> OpenAIClient(
        </span><span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ApiKeyCredential(openAIProvider.ApiKey),
        </span><span style="color: rgba(0, 0, 255, 1)">new</span> OpenAIClientOptions { Endpoint = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> Uri(openAIProvider.Endpoint) })
    .GetChatClient(openAIProvider.ModelId)
    .AsIChatClient();</span></pre>
</div>
<p><strong><span><span>Step2<span>: å®ä¾åèªå®ä¹Agent &amp; Executors</span></span></span></strong></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> ticket = <span style="color: rgba(0, 0, 255, 1)">new</span> TicketRequest(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">TKT-2025-003</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä¼åç§¯åä¸ºä»ä¹çªç¶æ¸é¶äºï¼</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">è´¦æ·é®é¢</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Low</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 0, 255, 1)">const</span> <span style="color: rgba(0, 0, 255, 1)">int</span> maxAttempts = <span style="color: rgba(128, 0, 128, 1)">5</span><span style="color: rgba(0, 0, 0, 1)">;

</span><span style="color: rgba(0, 0, 255, 1)">var</span> adaptiveDraft = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> AdaptiveReplyDraftExecutor(ticket, chatClient);
</span><span style="color: rgba(0, 0, 255, 1)">var</span> adaptiveQC = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> AdaptiveQualityCheckExecutor(QualityCheckConstants.PolitenessThreshold, QualityCheckConstants.AccuracyThreshold, chatClient);
</span><span style="color: rgba(0, 0, 255, 1)">var</span> intelligentImprove = <span style="color: rgba(0, 0, 255, 1)">new</span> IntelligentImproveExecutor(ticket, chatClient);</pre>
</div>
<p><strong><span><span>Step3<span>: åå»ºå¾ªç¯è·¯ç±å·¥ä½æµ</span></span></span></strong></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> workflow = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> WorkflowBuilder(adaptiveDraft)
    .AddEdge(adaptiveDraft, adaptiveQC)
    .AddEdge(adaptiveQC, intelligentImprove)
    .AddEdge(intelligentImprove, adaptiveDraft)
    .WithOutputFrom(adaptiveQC)
    .Build();
Console.OutputEncoding </span>=<span style="color: rgba(0, 0, 0, 1)"> Encoding.UTF8;
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â Loop Workflow æå»ºå®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<h3><span><span>2.6 æµè¯å·¥ä½æµ</span></span></h3>
<p><span><span>éè¿Streamingæµå¼æ§è¡ï¼</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">await</span> <span style="color: rgba(0, 0, 255, 1)">using</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> run = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> InProcessExecution.StreamAsync(workflow, QualityCheckSignal.Init))
{
    </span><span style="color: rgba(0, 0, 255, 1)">var</span> scoreTimeline = <span style="color: rgba(0, 0, 255, 1)">new</span> List&lt;<span style="color: rgba(0, 0, 255, 1)">object</span>&gt;<span style="color: rgba(0, 0, 0, 1)">();
    </span><span style="color: rgba(0, 0, 255, 1)">await</span> <span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> evt <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> run.WatchStreamAsync())
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¼ºå¶ä¸­æ­ï¼æå¤5æ¬¡å°è¯ï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> (scoreTimeline.Count ==<span style="color: rgba(0, 0, 0, 1)"> maxAttempts)
        {
            Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â å¼ºå¶ä¸­æ­å·¥ä½æµæ§è¡ï¼å·²å®æ{maxAttempts}æ¬¡è¯ä¼°ï¼</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
            </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
        }
        </span><span style="color: rgba(0, 0, 255, 1)">switch</span><span style="color: rgba(0, 0, 0, 1)"> (evt)
        {
            </span><span style="color: rgba(0, 0, 255, 1)">case</span><span style="color: rgba(0, 0, 0, 1)"> AdaptiveQualityScoreEvent scoreEvent:
                </span><span style="color: rgba(0, 0, 255, 1)">dynamic</span> payload = scoreEvent.Data!<span style="color: rgba(0, 0, 0, 1)">;
                scoreTimeline.Add(</span><span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> QualityScoreTimelineItem(
                    Attempt: (</span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)">)payload.Attempt,
                    PolitenessScore: (</span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)">)payload.PolitenessScore,
                    AccuracyScore: (</span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)">)payload.AccuracyScore,
                    ComplianceStatus: (</span><span style="color: rgba(0, 0, 255, 1)">bool</span>)payload.CompliancePassed ? <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â</span><span style="color: rgba(128, 0, 0, 1)">"</span> : <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
                ));
                </span><span style="color: rgba(0, 0, 255, 1)">var</span> statusMessage = payload.CompliancePassed ? <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">éè¿</span><span style="color: rgba(128, 0, 0, 1)">"</span> : <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä¸éè¿</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
                Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð AI è´¨æ£ç»æ =&gt; ç¤¼è²åº¦:{payload.PolitenessScore} åç¡®æ§:{payload.AccuracyScore} åè§æ§:{statusMessage}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
            </span><span style="color: rgba(0, 0, 255, 1)">case</span><span style="color: rgba(0, 0, 0, 1)"> WorkflowOutputEvent outputEvent:
                Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââââââââââââââââ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð å·¥ä½æµæ§è¡å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââââââââââââââââ\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{outputEvent.Data}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
            </span><span style="color: rgba(0, 0, 255, 1)">case</span><span style="color: rgba(0, 0, 0, 1)"> WorkflowErrorEvent errorEvent:
                Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â¨ æ¶å° Workflow Error Eventï¼</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{errorEvent.Data}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
        }
    }
}</span></pre>
</div>
<p><strong>æµè¯ç¨ä¾1</strong></p>
<p><span><span>å·¥ååå®¹ï¼<span style="text-decoration: underline">è®¢åå·²ç»3å¤©æ²¡åè´§ï¼è½éæ¬¾åï¼</span></span></span></p>
<p><span><span>æµè¯ç»æå¦ä¸å¾æç¤ºï¼</span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202601/381412-20260103192559594-1628756144.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><span><span>å¯ä»¥çè§ï¼ç»è¿åæ¬¡çæååå®¹æ¹è¿ï¼è¯¥åå®¹åå¤å·²ç»æ»¡è¶³äºæ åå¯ä»¥ç´æ¥åå¤ç¨æ·ã</span></span></p>
<p><strong>æµè¯ç¨ä¾2</strong></p>
<p><span><span>å·¥ååå®¹ï¼<span style="text-decoration: underline">ä¼åç§¯åä¸ºä»ä¹çªç¶æ¸é¶äºï¼</span></span></span></p>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;text-transform: none;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-align: left;line-height: 1.75em;margin-bottom: 16px;margin-top: 16px;&quot;,&quot;data-pm-slice&quot;:&quot;3 4 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin-top: 8px;margin-bottom: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>æµè¯ç»æå¦ä¸å¾æç¤ºï¼</span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202601/381412-20260103192630728-832060369.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;text-transform: none;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-align: left;line-height: 1.75em;margin-bottom: 16px;margin-top: 16px;&quot;,&quot;data-pm-slice&quot;:&quot;3 4 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin-top: 8px;margin-bottom: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin-top: 8px;margin-bottom: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>å¯ä»¥çå°ï¼éè¿å¾ªç¯åèªæä¿®æ­£æ¨¡å¼ï¼å·¥ä½æµè½å¤å®ç°â<span data-pm-slice="2 3 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span>çæ<span><span>âå®¡æ ¸<span data-pm-slice="0 0 []"><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;letter-spacing: 0.578px;text-align: left;margin: 8px;&quot;,&quot;data-pm-slice&quot;:&quot;6 3 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;min-height: 1em;text-align: left;visibility: visible;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;caret-color: var(--weui-BRAND);box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>âä¿®å¤<span>âçå·¥ä½æ¨¡å¼ï¼<strong>ç¹å«éç¨äºåå®¹çæåå®¡æ¹çåºæ¯ã</strong></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<h1>3 å°ç»</h1>
<p>æ¬æä»ç»äºMAFä¸­å¾ªç¯å·¥ä½æµä»¥åå¦ä½å®ç°â<span data-pm-slice="2 3 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">çæâå®¡æ ¸<span data-pm-slice="0 0 []"><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;letter-spacing: 0.578px;text-align: left;margin: 8px;&quot;,&quot;data-pm-slice&quot;:&quot;6 3 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;min-height: 1em;text-align: left;visibility: visible;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;caret-color: var(--weui-BRAND);box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">âä¿®å¤âçå·¥ä½æ¨¡å¼ï¼æåéè¿ä¸ä¸ªä¼ä¸å®¢æå·¥ååå®¹æºè½åå¤çæ¡ä¾ä»ç»äºè¿ç§æ¨¡å¼çä»£ç å®ç°ï¼ç¹å«éç¨äº<span data-pm-slice="2 3 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span data-pm-slice="0 0 []">åå®¹çæåå®¡æ¹çåºæ¯ã</span></span></span></span></span></p>
<p>ä¸ä¸ç¯ï¼æä»¬å°ç»§ç»­å­¦ä¹ MAFä¸­å·¥ä½æµçå¹¶è¡å·¥ä½æµã</p>
<h1>ç¤ºä¾æºç </h1>
<p>GitHub:&nbsp;<a href="https://github.com/EdisonTalk/MAFD" target="_blank" rel="noopener nofollow">https://github.com/EdisonTalk/MAFD</a></p>
<h1>åèèµæ</h1>
<p><span data-pm-slice="0 0 []"><span>å£æ°ï¼ã<a href="https://www.cnblogs.com/sheng-jie/p/19200934" target="_blank">.NET + AI æºè½ä½å¼åè¿é¶</a>ãï¼æ¨èææ°ï¼âââââï¼</span></span></p>
<p><span data-pm-slice="0 0 []"><span>Microsoft Learnï¼<span>ã<a href="https://learn.microsoft.com/en-us/agent-framework/overview/agent-framework-overview?wt.mc_id=MVP_397012" target="_blank" rel="noopener nofollow">Agent Framework Tutorials</a>ã</span></span></span></p>
<div><span data-pm-slice="0 0 []"><span>&nbsp;</span></span></div>
<p style="text-align: center"><img src="https://images.cnblogs.com/cnblogs_com/edisonchou/1647700/o_200902144330EdisonTalk-Footer.jpg" alt="" style="width: 65%; border: 1px solid rgba(221, 221, 221, 1); border-radius: 3px; box-shadow: 0 4px 8px rgba(3, 27, 78, 0.12)"></p>
<div id="Copyright">
<p>ä½èï¼<span style="text-decoration: underline">ç±è¿ªç</span></p>
<p>åºå¤ï¼<a title="from" href="https://edisontalk.cnblogs.com" target="_blank">https://edisontalk.cnblogs.com</a></p>
<p>æ¬æçæå½ä½èååå®¢å­å±æï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»ä¿çæ­¤æ®µå£°æï¼ä¸å¨æç« é¡µé¢ææ¾ä½ç½®ç»åºåæé¾æ¥ã</p>
</div>
</div>
<div id="MySignature" role="contentinfo">
    <div align="center"><a href="https://weibo.com/u/2068032061?s=6uyXnP" target="_blank"><img border="0" src="http://service.t.sina.com.cn/widget/qmd/2068032061/d643d182/10.png"></a></div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-04 18:30">2026-01-04 18:30</span>&nbsp;
<a href="https://www.cnblogs.com/edisontalk">EdisonZhou</a>&nbsp;
éè¯»(<span id="post_view_count">3</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19434764);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19434764', targetLink: 'https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper10', title: 'MAFå¿«éå¥é¨ï¼10ï¼å¾ªç¯å·¥ä½æµ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ è®©WinFormsåæ¬¡ä¼å¤§ ]]></title>
    <link>https://www.cnblogs.com/xdesigner/p/19438384/Make_WinForms_Great_Again</link>
    <guid>a0896da9d654c4cb0ac9e261aa377cc6</guid>
    <description>
    <![CDATA[ 
		<h2>
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xdesigner/p/19438384/Make_WinForms_Great_Again" title="åå¸äº 2026-01-04 15:49">
    <span role="heading" aria-level="2">è®©WinFormsåæ¬¡ä¼å¤§</span>
    

</a>

		</h2>
		<div class="postText">    <div id="cnblogs_post_description" style="display: none">
        
        æ¬é¡¹ç®å°±æ¯ä¸é¨å¸®å©å°WinForms åºç¨ç¨åºè¿ç§»å° Blazor WASMå¹³å°ä¸ï¼å³ä½¿è¿äºç¨åºä½¿ç¨GDI+åè½ï¼æä»¬ä¹é¢æå°å¯¹è¿äºç¨åºæºç çä¿®æ¹éä¸è¶è¿10%ãè¿æå¤§çéä½WinFormsè½¯ä»¶ç°ä»£åçææ¬åé£é©ã
æä»¬çé¿æç®æ æ¯è½å°å¨ç1000äº¿è¡ç»è¿å¸åºéªè¯çC#ä»£ç è½éè·æ°çï¼å¨ç°ä»£Webåç«¯å¹³å°ä¸ç»§ç»­åæ¥ä»·å¼ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="è®©-winforms-åæ¬¡ä¼å¤§-httpsgithubcomdcsoft-yyfmwga">è®© WinForms åæ¬¡ä¼å¤§ <a href="https://github.com/dcsoft-yyf/MWGA" target="_blank" rel="noopener nofollow">https://github.com/dcsoft-yyf/MWGA</a></h1>
<h2 id="æ´æ°æ¥å¿">æ´æ°æ¥å¿</h2>
<ul>
<li>2026-1-4 :ç¬¬ä¸æ»´è¡ <a href="https://dcsoft-yyf.github.io/MWGA/WinFormCalculator.html" target="_blank" rel="noopener nofollow">https://dcsoft-yyf.github.io/MWGA/WinFormCalculator.html</a></li>
</ul>
<h2 id="å¨ç-winforms-ç°ä»£åç°ç¶">å¨ç WinForms ç°ä»£åç°ç¶</h2>
<p>å¨çèå´åï¼ä¼°è®¡WinFormså¼åèçº¦æ300ä¸è³500ä¸äººï¼å .NETå¼åèæ»æ°ç40%è³50%ãçäº§ç¯å¢ä¸­è¿è¡ç1000ä¸è³1500ä¸ä¸ªWinFormsåºç¨ç¨åºãå¨è¿äºåºç¨ä¸­ï¼60%è³80%æç°ä»£åæ¹é éæ±ï¼å¶ä¸­40%è³60%ä¼åéæ©Webåè¿ç§»ï¼æ¶åçC#ä»£ç å¯è½æ<code>æ°åäº¿è¡</code>ãæ ¸å¿é©±å¨å ç´ åæ¬ç½é¡µç«¯è®¿é®ãçé¢ç°ä»£åãè·¨å¹³å°æ¯æãäºéæåå®å¨åè§ãç±äºå¯å¤ç¨C#ä»£ç ä¸å·å¤åºäºæµè§å¨çè·¨å¹³å°è½åï¼Blazor WebAssemblyæä¸ºç­é¨éæ©ã</p>
<p>ä½æ¯æå¤§éçWinFormsä½¿ç¨äº<code>System.Drawing</code>æ¨¡åè°ç¨<code>GDI+</code>è¿è¡å¤æçèªå®ä¹ç»å¾åäº¤äºï¼è¿äºé¨åé¾ä»¥éè¿ç®åçæ§ä»¶æ å°è¿ç§»ï¼éå¸¸éè¦éåæå¤§å¹ä¿®æ¹ãä¸ºæ­¤ï¼å¸åºä¸å¯¹ä½æ¹å¨ãå¯å¤ç¨ä¸å¡é»è¾åç»å¾ä»£ç çç°ä»£åè¿ç§»è§£å³æ¹æ¡éæ±å¼ºçãä½é¿æä»¥æ¥ä¸ç´ç¼ºä¹ææå·¥å·åæ¹æ³ï¼å¯¼è´è®¸å¤ä¼ä¸é¢ä¸´é«æçéåææ¬åé£é©ã</p>
<h2 id="é¡¹ç®ç®ä»">é¡¹ç®ç®ä»</h2>
<p>æ¬é¡¹ç®å°±æ¯ä¸é¨å¸®å©å°WinForms åºç¨ç¨åºè¿ç§»å° Blazor WASMå¹³å°ä¸ï¼å³ä½¿è¿äºç¨åºä½¿ç¨GDI+åè½ï¼æä»¬ä¹é¢æå°å¯¹è¿äºç¨åºæºç çä¿®æ¹éä¸è¶è¿<code>10%</code>ãè¿æå¤§çéä½WinFormsè½¯ä»¶ç°ä»£åçææ¬åé£é©ã</p>
<p>æä»¬çé¿æç®æ æ¯è½å°å¨ç<code>1000äº¿</code>è¡ç»è¿å¸åºéªè¯çC#ä»£ç è½éè·æ°çï¼å¨ç°ä»£Webåç«¯å¹³å°ä¸ç»§ç»­åæ¥ä»·å¼ã</p>
<h2 id="å¨çå¾è¿ç§»-winforms-åºç¨å¸åºè§æ¨¡ä¼°ç®ç¾å">å¨çå¾è¿ç§» WinForms åºç¨å¸åºè§æ¨¡ä¼°ç®ï¼ç¾åï¼</h2>
<p>åè®¾éè¦è¿ç§»ç WinForms åºç¨çº¦ 50 ä¸ â 200 ä¸ ä¸ªï¼åºç¨å¤æåº¦åå¸ï¼ç®å 60%ãä¸­ç­ 30%ãå¤æ 10%ã</p>
<ul>
<li>æç¤ºä¾ååºç¨è¿ç§»ææ¬ä¸­ä½æ°ä¼°ç®ï¼ç¾åï¼ï¼å æåä»·çº¦ 5.5 ä¸ç¾å/åºç¨ã</li>
<li>TAMï¼æ»å¯å¯»åå¸åºï¼ä¼°ç®ï¼çº¦ 275 äº¿ â 1,100 äº¿ ç¾åï¼50 ä¸ â 200 ä¸ åºç¨ Ã 5.5 ä¸ç¾åï¼ã</li>
<li>å·¥å·/è®¸å¯æ¨¡å¼å¯å¯»åå¸åºï¼5 å â 2 ä¸ ç¾å/åºç¨ï¼ï¼çº¦ 25 äº¿ â 400 äº¿ ç¾åã</li>
<li>å¤æåºç¨ï¼10%ï¼å¸åºï¼çº¦ 5 ä¸ â 20 ä¸ ä¸ªï¼ææ¯ä¾ 15 ä¸ç¾åè®¡çº¦ 75 äº¿ â 300 äº¿ ç¾åã</li>
</ul>

</div>
<div class="clear"></div>
</div>
		<p class="postfoot">
			posted on 
<span id="post-date" data-last-update-days="0.004166666666666667" data-date-updated="2026-01-04 15:55">2026-01-04 15:49</span>&nbsp;
<a href="https://www.cnblogs.com/xdesigner">è¢æ°¸ç¦ çµå­çåï¼å»çä¿¡æ¯å</a>&nbsp;
éè¯»(<span id="post_view_count">532</span>)&nbsp;
è¯è®º(<span id="post_comment_count">7</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19438384);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19438384', targetLink: 'https://www.cnblogs.com/xdesigner/p/19438384/Make_WinForms_Great_Again', title: 'è®©WinFormsåæ¬¡ä¼å¤§' })">ä¸¾æ¥</a>

		</p>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åºäº ContextCapture SDK ç Python èªå¨åä¸ç»´å»ºæ¨¡ ]]></title>
    <link>https://www.cnblogs.com/foury/p/19438102</link>
    <guid>0a81d9d20cc896789d84493da6198d75</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/foury/p/19438102" title="åå¸äº 2026-01-04 15:13">
    <span role="heading" aria-level="2">åºäº ContextCapture SDK ç Python èªå¨åä¸ç»´å»ºæ¨¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="åºäº-contextcapture-sdk-ç-python-èªå¨åä¸ç»´å»ºæ¨¡">åºäº ContextCapture SDK ç Python èªå¨åä¸ç»´å»ºæ¨¡</h1>
<p>ContextCapture æ¯ Bentley æä¾çä¸æ¬¾åä¸çº§ä¸ç»´éå»ºè½¯ä»¶ï¼å¹¿æ³åºç¨äºæ äººæºå¾ææå½±ãå®æ¯ä¸ç»´å»ºæ¨¡ç­åºæ¯ã</p>
<p>æ¬æåºäº ContextCapture å®æ¹æä¾ç MasterKernel SDKï¼ä»ç»å¦ä½éè¿ Python èæ¬å®ç°å¯¹ ContextCapture å»ºæ¨¡æµç¨çèªå¨åæ§å¶ï¼åæ¬é¡¹ç®åå»ºãç©ºä¸­ä¸è§æµéï¼ATï¼ãä¸ç»´éå»ºä»¥åå¤ç§æ ¼å¼ææçé¡ºåºçäº§ã</p>
<p><strong>ContextCapture MasterKernel SDKä»ç»</strong>:<a href="https://docs.bentley.com/LiveContent/web/ContextCapture%20Help-v18/zh-cn/GUID-8A35B878-C2BB-4F01-8D5A-18321EF04410.html" target="_blank" rel="noopener nofollow">https://docs.bentley.com/LiveContent/web/ContextCapture Help-v18/zh-cn/GUID-8A35B878-C2BB-4F01-8D5A-18321EF04410.html</a></p>
<h2 id="1å®è£contextcapture">1.å®è£ContextCapture</h2>
<p>åºäºContextCaptureçå®è£ç½ä¸æå¾å¤è¯¦ç»çæç¨ï¼æ¬æä¸åå¯¹å®è£æ­¥éª¤è¿è¡è¯¦ç»å±å¼ã<br>
æ¬ææµè¯ç¯å¢ä½¿ç¨çContextCaptureçæ¬ä¸º <strong>v10.18.0.232</strong>ï¼åç»­ç¤ºä¾ååºäºè¯¥çæ¬ï¼ä»ä¾åèã</p>
<h2 id="2éç½®éåcontextcaptureçpythonç¯å¢">2.éç½®éåContextCaptureçPythonç¯å¢</h2>
<p>å¨ ContextCapture å®è£ç®å½ç <code>sdk/dist</code> æä»¶å¤¹ä¸­ï¼å¯ä»¥æ¾å°å®æ¹æä¾ç Python SDK å®è£åï¼<code>.whl</code> æä»¶ï¼ã</p>
<p>ä¾å¦ï¼<br>
<code>ccmasterkernel-10.18.0.232-cp36-cp36m-win_amd64.whl</code></p>
<p>å¶ä¸­âcp36-cp36mâè¡¨ç¤ºåªæ¯æ Python3.6 ç¸å³çæ¬ï¼è¦å®è£æ­£ç¡®çPythonçæ¬ï¼ã</p>
<p>å®è£å®æPythonç¯å¢åï¼æå¼å½ä»¤è¡è¿å¥sdk/distæä»¶å¤¹ä¸ï¼æ§è¡<code>pip install ccmasterkernel-10.18.0.232-cp36-cp36m-win_amd64.whl</code>å®è£å¥½è¿ä¸ªåã</p>
<p><img alt="ä¼ä¸å¾®ä¿¡æªå¾_17675106628003" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3476680/202601/3476680-20260104151130785-749681989.png" class="lazyload"></p>
<h2 id="3ç¼åpythonèæ¬">3.ç¼åPythonèæ¬</h2>
<p>å³äºsdkä½¿ç¨çç¸å³ææ¡£è¯´æå¨sdk/doc/htmlæä»¶å¤¹ä¸ã</p>
<p>ä¸é¢ç»åºä¸ä¸ªå®æ´ç Python èæ¬ç¤ºä¾ï¼ç¨äºæ¼ç¤ºå¦ä½éè¿ ContextCapture SDK å®ç°æ äººæºå½±åçèªå¨åä¸ç»´å»ºæ¨¡æµç¨ã</p>
<p>è¯¥èæ¬åç»­å¯æ ¹æ®å®ééæ±è¿è¡è£åªææ©å±ã</p>
<p>æ­¤èæ¬æ¯ä¸ä¸ªç¨äºèªå¨å ContextCapture (CC) å»ºæ¨¡æµç¨ç Python èæ¬ãå®è½å¤èªå¨åå»ºé¡¹ç®ãæäº¤ç©ºä¸è¿ç® (AT)ï¼å¹¶æé¡ºåºçæå¤ç§æ ¼å¼çä¸ç»´æ¨¡åï¼OBJ, LAS, 3D Tilesï¼ã</p>
<p><strong>æ³¨æï¼</strong> <mark>æ­£å¼è¿è¡èæ¬åï¼éç¡®ä¿ContextCapture Engine å·²å¯å¨ï¼å¦åä»»å¡æ æ³æ­£å¸¸æäº¤ï¼</mark></p>
<h3 id="31å½ä»¤è¡åæ°">3.1å½ä»¤è¡åæ°</h3>
<p>èæ¬æ¯æéè¿å½ä»¤è¡åæ°è¿è¡çµæ´»éç½®ï¼</p>
<table>
<thead>
<tr>
<th style="text-align: left">åæ°</th>
<th style="text-align: left">å¿é/å¯é</th>
<th style="text-align: left">é»è®¤å¼</th>
<th style="text-align: left">è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><code>--photos</code></td>
<td style="text-align: left"><strong>å¿é</strong></td>
<td style="text-align: left">-</td>
<td style="text-align: left">ç§çæå¨çæºæä»¶å¤¹è·¯å¾ãæ¯æ jpg, tif, png ç­æ ¼å¼ã</td>
</tr>
<tr>
<td style="text-align: left"><code>--project</code></td>
<td style="text-align: left"><strong>å¿é</strong></td>
<td style="text-align: left">-</td>
<td style="text-align: left">é¡¹ç®è¾åºçæ ¹æä»¶å¤¹è·¯å¾ãèæ¬å°å¨æ­¤ç®å½ä¸åå»º <code>.ccm</code> é¡¹ç®æä»¶ååä¸ªäº§ç©æä»¶å¤¹ã</td>
</tr>
<tr>
<td style="text-align: left"><code>--memory</code></td>
<td style="text-align: left">å¯é</td>
<td style="text-align: left"><code>16.0</code></td>
<td style="text-align: left">ç®æ åå­ä½¿ç¨é (GB)ãç¨äºæ§å¶ååå¤§å°ï¼å»ºè®®è®¾ç½®ä¸ºæºå¨ç©çåå­ç 50%-70%ã</td>
</tr>
<tr>
<td style="text-align: left"><code>--formats</code></td>
<td style="text-align: left">å¯é</td>
<td style="text-align: left">å¨é¨</td>
<td style="text-align: left">æå®è¦çäº§çæ ¼å¼åè¡¨ãå¯éå¼: <code>OBJ</code>, <code>LAS</code>, <code>3DTiles</code>ãå¤ä¸ªå¼ä¹é´ç¨ç©ºæ ¼åéã</td>
</tr>
</tbody>
</table>
<h3 id="32-ä½¿ç¨ç¤ºä¾">3.2 ä½¿ç¨ç¤ºä¾</h3>
<p>å¨å½ä»¤è¡ (CMD æ PowerShell) ä¸­è¿è¡ä»¥ä¸å½ä»¤ã</p>
<h4 id="1-åºç¡ç¨æ³">1ï¼ åºç¡ç¨æ³</h4>
<p>çæææé»è®¤æ ¼å¼ (OBJ, LAS, 3D Tiles)ï¼é»è®¤ä½¿ç¨ 16GB åå­éå¶ã</p>
<pre><code class="language-powershell">python test_cc_sequential.py --photos "D:\MyData\Mission_01\Images" --project "D:\Projects\Mission_01"
</code></pre>
<h4 id="2æå®è¾åºæ ¼å¼">2ï¼æå®è¾åºæ ¼å¼</h4>
<p>å¦æä½ åªéè¦ç¹äº (LAS) å OBJ æ¨¡åï¼ä¸éè¦ 3D Tilesï¼</p>
<pre><code class="language-powershell">python test_cc_sequential.py --photos "D:\Images" --project "D:\Output" --formats LAS OBJ
</code></pre>
<h4 id="3èªå®ä¹åå­éå¶">3ï¼èªå®ä¹åå­éå¶</h4>
<p>éå¯¹å¤§åå­ (ä¾å¦ 64GB åå­)ï¼å¯ä»¥è°é«éå¶ä»¥å å¿«å¤çéåº¦ (ä¾å¦è®¾ä¸º 48GB)ï¼</p>
<pre><code class="language-powershell">python test_cc_sequential.py --photos "D:\Images" --project "D:\Output" --memory 48.0
</code></pre>
<p>éå¯¹å°åå­æºå¨ (ä¾å¦ 16GB åå­)ï¼å»ºè®®è°ä½éå¶ (ä¾å¦ 8GB)ï¼</p>
<pre><code class="language-powershell">python test_cc_sequential.py --photos "D:\Images" --project "D:\Output" --memory 8.0
</code></pre>
<h3 id="33-è¾åºç»æ">3.3 è¾åºç»æ</h3>
<p>è¿è¡å®æåï¼å¨æå®ç <code>--project</code> ç®å½ä¸ä¼èªå¨çæä»¥ä¸ç»æï¼</p>
<pre><code class="language-text">D:\Projects\Mission_01\         &lt;-- é¡¹ç®æ ¹ç®å½
â  Mission_01.ccm              &lt;-- CC å·¥ç¨æä»¶
â  cc_sequential.log           &lt;-- è¯¦ç»è¿è¡æ¥å¿
â
ââ Production_OBJ\             &lt;-- OBJ æ¨¡åè¾åºç®å½
â      metadata.xml
â      ...
â
ââ Production_LAS\             &lt;-- LAS ç¹äºè¾åºç®å½
â      cloud.las
â      ...
â
ââ Production_3DTiles\         &lt;-- Cesium 3D Tiles è¾åºç®å½
       tileset.json
       ...
</code></pre>
<h3 id="34-æ¥å¿">3.4 æ¥å¿</h3>
<p>èæ¬è¿è¡è¿ç¨ä¸­ï¼ç®è¦ä¿¡æ¯ä¼æ¾ç¤ºå¨å±å¹ä¸ã<br>
è¯¦ç»çå¸¦æ¶é´æ³çæ¥å¿ä¼ä¿å­å¨èæ¬åçº§ç®å½ä¸ç <code>cc_sequential.log</code> æä»¶ä¸­ã</p>
<h3 id="35-å·ä½ä»£ç å®ç°">3.5 å·ä½ä»£ç å®ç°</h3>
<pre><code class="language-python">"""
ContextCapture é¡ºåºå¤æ ¼å¼çäº§èæ¬
æ¯æ OBJãLAS ç¹äºãCesium 3D Tiles ä¸ç§æ ¼å¼
ä½¿ç¨ååå¤ç (Tiling) æ§å¶åå­
é¡ºåºæ§è¡é¿ååå­ä¸è¶³
"""
import sys
import time
import os
import logging
from logging.handlers import RotatingFileHandler
import traceback
import argparse

# --- æ¥å¿éç½® ---
# æ¥å¿æä»¶åä¸º cc_sequential.logï¼ä½äºèæ¬æå¨ç®å½
log_file_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), 'cc_sequential.log')

logger = logging.getLogger('CC_Production')
logger.setLevel(logging.INFO)

# 1. RotatingFileHandler: 10MB åå²ï¼ä¿ç 5 ä¸ªå¤ä»½
# maxBytes = 10 * 1024 * 1024 = 10485760 B
rf_handler = RotatingFileHandler(log_file_path, maxBytes=10 * 1024 * 1024, backupCount=5, encoding='utf-8')
file_formatter = logging.Formatter('%(asctime)s [%(levelname)s] %(message)s')
rf_handler.setFormatter(file_formatter)
logger.addHandler(rf_handler)

# 2. StreamHandler: è¾åºå°æ§å¶å°
console_handler = logging.StreamHandler(sys.stdout)
console_handler.setFormatter(logging.Formatter('%(message)s'))  # æ§å¶å°è¾åºä¿æåæ ·ï¼çº¯ææ¬æ¹ä¾¿éè¯»
logger.addHandler(console_handler)
# ----------------

try:
    import ccmasterkernel

    logger.info("æåå¯¼å¥ ccmasterkernel æ¨¡å")
except ImportError:
    logger.error("éè¯¯: æ æ³å¯¼å¥ ccmasterkernel æ¨¡åã")
    sys.exit(1)


def parse_args():
    parser = argparse.ArgumentParser(description="ContextCapture é¡ºåºå¤æ ¼å¼çäº§èæ¬")

    # è·¯å¾åæ° (å¿é¡»)
    parser.add_argument('--photos', required=True, help='ç§çæå¨ç®å½è·¯å¾')
    parser.add_argument('--project', required=True, help='é¡¹ç®è¾åºç®å½è·¯å¾')

    # å¯éåæ°
    parser.add_argument('--memory', type=float, default=16.0, help='ç®æ åå­ä½¿ç¨é (GB)ï¼é»è®¤ 16.0')
    parser.add_argument('--formats', nargs='+', default=['OBJ', 'LAS', '3DTiles'],
                        choices=['OBJ', 'LAS', '3DTiles'],
                        help='æå®è¦çäº§çæ ¼å¼ (é»è®¤å¨é¨): OBJ, LAS, 3DTiles')

    return parser.parse_args()


def main():
    args = parse_args()

    # å®ä¹è·¯å¾åé (ä» args è·å)
    project_dir = args.project
    # èªå¨æ ¹æ®ç®å½åçæé¡¹ç®æä»¶å
    project_name_base = os.path.basename(os.path.normpath(project_dir))
    project_file_path = os.path.join(project_dir, f"{project_name_base}.ccm")
    photos_dir = args.photos

    # å¤æ ¼å¼è¾åºç®å½
    production_obj_dir = os.path.join(project_dir, "Production_OBJ")
    production_las_dir = os.path.join(project_dir, "Production_LAS")
    production_3dtiles_dir = os.path.join(project_dir, "Production_3DTiles")

    logger.info("\n" + "=" * 60)
    logger.info("ContextCapture é¡ºåºå¤æ ¼å¼èªå¨åèæ¬ (CLI Mode)")
    logger.info("=" * 60)
    logger.info(f"é¡¹ç®æä»¶è·¯å¾: {project_file_path}")
    logger.info(f"ç§çç®å½:     {photos_dir}")
    logger.info(f"ç®æ åå­:     {args.memory} GB")

    # ç¡®å®è¦çäº§çæ ¼å¼
    formats_to_produce_list = []

    # æ ¼å¼å®ä¹æ å°: Name -&gt; (DriverName, OutputDir, Description)
    format_map = {
        'OBJ': ("OBJ", production_obj_dir, "OBJ ç½æ ¼æ¨¡å"),
        'LAS': ("LAS", production_las_dir, "LAS ç¹äº"),
        '3DTiles': ("Cesium 3D Tiles", production_3dtiles_dir, "Cesium 3D Tiles")
    }

    req_formats = args.formats

    logger.info(f"è®¡åçäº§æ ¼å¼: {', '.join(req_formats)}")

    # æå»º production list
    # ä¿æåæé¡ºåº: OBJ -&gt; LAS -&gt; 3DTiles (å¦æè¢«éä¸­)
    if 'OBJ' in req_formats:
        formats_to_produce_list.append(('OBJ', *format_map['OBJ']))
    if 'LAS' in req_formats:
        formats_to_produce_list.append(('LAS', *format_map['LAS']))
    if '3DTiles' in req_formats:
        formats_to_produce_list.append(('Cesium 3D Tiles', *format_map['3DTiles']))

    logger.info("\nè¾åºä½ç½®é¢è§:")
    for _, _, out_dir, desc in formats_to_produce_list:
        logger.info(f"  - {desc}: {out_dir}")

    logger.info("\næ³¨æ: éä¸­æ ¼å¼å°ä¾æ¬¡æ§è¡ï¼é¿ååå­ä¸è¶³")
    logger.info("=" * 60 + "\n")

    # ç¡®ä¿é¡¹ç®ç®å½å­å¨
    if not os.path.exists(project_dir):
        try:
            os.makedirs(project_dir)
        except OSError as e:
            logger.error(f"éè¯¯: æ æ³åå»ºé¡¹ç®ç®å½ {project_dir}: {e}")
            return

    # 1. åå»ºå¹¶éç½®é¡¹ç®
    logger.info("æ­£å¨åå»ºé¡¹ç®...")
    project = ccmasterkernel.Project()
    project.setName(project_name_base)  # ä½¿ç¨ç®å½åä½ä¸ºé¡¹ç®å
    project.setProjectFilePath(project_file_path)

    # 2. åå»ºåºåå¹¶æ·»å ç§ç
    logger.info("æ­£å¨åå»ºåå§åºå...")
    block = ccmasterkernel.Block(project)
    project.addBlock(block)
    block.setName("InitialBlock")

    logger.info("æ­£å¨æ·»å ç§ç...")
    photogroups = block.getPhotogroups()

    if os.path.exists(photos_dir):
        photo_files = [f for f in os.listdir(photos_dir)
                       if f.lower().endswith(('.jpg', '.jpeg', '.tif', '.tiff', '.png'))]
        if not photo_files:
            logger.warning(f"è­¦å: å¨ {photos_dir} ä¸­æªæ¾å°ç§çæä»¶ã")

        for f in photo_files:
            full_path = os.path.join(photos_dir, f)
            photogroups.addPhotoInAutoMode(full_path)
        logger.info(f"å·²å°è¯æ·»å  {len(photo_files)} å¼ ç§çã")
    else:
        logger.error(f"éè¯¯: ç§çç®å½ {photos_dir} ä¸å­å¨ã")
        return

    # éªè¯åºåæ¯å¦ææ
    if not block.isReadyForAT():
        logger.error("éè¯¯: åºåæªåå¤å¥½è¿è¡ ATã")
        return

    # ä¿å­é¡¹ç®
    logger.info("æ­£å¨ä¿å­é¡¹ç®...")
    save_error = project.writeToFile()
    if not save_error.isNone():
        logger.error(f"ä¿å­é¡¹ç®å¤±è´¥: {save_error.message}")
        return
    logger.info("é¡¹ç®ä¿å­æåã")

    # 3. ç©ºä¸­ä¸è§æµé (AT)
    logger.info("\nåå¤ç©ºä¸­ä¸è§æµé (AT) åºå...")
    block_at = ccmasterkernel.Block(project)
    project.addBlock(block_at)
    block_at.setName("AT_Block")
    block_at.setBlockTemplate(ccmasterkernel.BlockTemplate.Template_adjusted, block)

    # ä¿å­æ´æ°åçé¡¹ç®
    logger.info("æ­£å¨ä¿å­æ´æ°åçé¡¹ç®...")
    save_error = project.writeToFile()
    if not save_error.isNone():
        logger.error(f"ä¿å­é¡¹ç®å¤±è´¥: {save_error.message}")
        return

    logger.info("å¼å§æäº¤ AT å¤ç...")
    at = block_at.getAT()
    if at is None:
        logger.error("éè¯¯: æ æ³è·å AT å¯¹è±¡ã")
        return

    # æäº¤ AT å¤ç
    submit_error = at.submitProcessing()
    if not submit_error.isNone():
        logger.error(f"AT æäº¤å¤±è´¥: {submit_error.message}")
        return

    # çæ§ AT ä»»å¡
    if not monitor_job(at, "AT"):
        logger.error("AT å¤çæªæåå®æï¼èæ¬ç»æ­¢ã")
        return

    logger.info("AT å¤çå®æã\n")

    # 4. éå»º (Reconstruction) - éç½®ååå¤ç
    logger.info("=" * 60)
    logger.info("åå»ºéå»ºé¡¹ç®...")
    logger.info("=" * 60)

    reconstruction = ccmasterkernel.Reconstruction(block_at)
    block_at.addReconstruction(reconstruction)
    reconstruction.setName("Reconstruction_Sequential")

    # éç½®éå»ºè®¾ç½®
    logger.info("\néç½®éå»ºè®¾ç½®...")
    settings = reconstruction.getSettings()
    reconstruction.setSettings(settings)

    # éç½®ååå¤ç (Tiling)
    logger.info("éç½®ååå¤ç (Tiling)...")
    tiling = reconstruction.getTiling()
    tiling.tilingMode = ccmasterkernel.TilingMode.TilingMode_adaptive
    tiling.targetMemoryUse = args.memory  # ä½¿ç¨å½ä»¤è¡åæ°
    tiling.overlapRatio = 0.2
    tiling.discardEmptyTiles = True
    reconstruction.setTiling(tiling)

    logger.info(f"  - æ¨¡å¼: Adaptive (èªå¨åå)")
    logger.info(f"  - ç®æ åå­: {tiling.targetMemoryUse} GB")
    logger.info(f"  - ç¦çéå ç: {tiling.overlapRatio * 100}%")

    # ä¿å­éå»ºéç½®
    logger.info("\nä¿å­éå»ºéç½®...")
    save_error = project.writeToFile()
    if not save_error.isNone():
        logger.error(f"ä¿å­é¡¹ç®å¤±è´¥: {save_error.message}")
        return

    # è·åç¦çæ°é
    num_tiles = reconstruction.getNumInternalTiles()
    logger.info(f"\néå»ºåå« {num_tiles} ä¸ªç¦ç")

    # 5. é¡ºåºçäº§ - ä¾æ¬¡æ§è¡æ¯ç§æ ¼å¼
    logger.info("\n" + "=" * 60)
    logger.info("å¼å§é¡ºåºçäº§ï¼ä¾æ¬¡æ§è¡ï¼é¿ååå­ä¸è¶³ï¼")
    logger.info("=" * 60)

    results = []

    # éåæä»¬æå»ºçæ ¼å¼åè¡¨
    for idx, (prod_name, driver_name, output_dir, description) in enumerate(formats_to_produce_list, 1):
        logger.info("\n" + "=" * 60)
        logger.info(f"ç¬¬ {idx}/{len(formats_to_produce_list)} æ­¥: çäº§ {description}")
        logger.info("=" * 60)

        # åå»ºçäº§
        logger.info(f"\néç½® {description}...")
        production = ccmasterkernel.Production(reconstruction)
        reconstruction.addProduction(production)
        production.setName(f"Production_{prod_name}")
        production.setDriverName(driver_name)
        production.setDestination(output_dir)
        logger.info(f"  â {description} éç½®å®æ")

        # ä¿å­é¡¹ç®
        save_error = project.writeToFile()
        if not save_error.isNone():
            logger.error(f"  â ä¿å­é¡¹ç®å¤±è´¥: {save_error.message}")
            results.append((description, False))
            continue

        # æ·»å ææç¦çä»»å¡
        logger.info(f"\nä¸º {description} æ·»å  {num_tiles} ä¸ªç¦çä»»å¡...")
        production_jobs = []
        try:
            for i in range(num_tiles):
                tile = reconstruction.getInternalTile(i)
                job = ccmasterkernel.TileProductionJob(production, tile)
                production.addProductionJob(job)
                production_jobs.append(job)
            logger.info(f"  â å·²æ·»å  {num_tiles} ä¸ªç¦çä»»å¡")
        except Exception as e:
            logger.error(f"  â æ·»å ä»»å¡æ¶åºé: {e}")
            results.append((description, False))
            continue

        # æäº¤çäº§
        logger.info(f"\næäº¤ {description} çäº§...")
        submit_error = production.submitProcessing()
        if not submit_error.isNone():
            logger.error(f"  â æäº¤å¤±è´¥: {submit_error.message}")
            results.append((description, False))
            continue
        logger.info(f"  â æäº¤æå")

        # çæ§ææç¦çä»»å¡
        logger.info(f"\nçæ§ {description} ä»»å¡ï¼{num_tiles} ä¸ªç¦çï¼...")
        all_tiles_success = True
        for tile_idx, job in enumerate(production_jobs):
            job_desc = f"{description} - ç¦ç {tile_idx}"
            if not monitor_job(job, job_desc):
                logger.error(f"  â ç¦ç {tile_idx} å¤çå¤±è´¥")
                all_tiles_success = False
                break  # å¦æä¸ä¸ªç¦çå¤±è´¥ï¼åæ­¢çæ§åç»­ç¦ç
            else:
                logger.info(f"  â ç¦ç {tile_idx} å¤çæå")

        if all_tiles_success:
            logger.info(f"\nâ {description} ææç¦çå¤çæåï¼")
            logger.info(f"  è¾åºä½ç½®: {output_dir}")
            results.append((description, True))
        else:
            logger.error(f"\nâ {description} å¤çå¤±è´¥")
            results.append((description, False))

    # æç»ç»ææ±æ»
    logger.info("\n" + "=" * 60)
    logger.info("çäº§ç»ææ±æ»")
    logger.info("=" * 60)

    for description, success in results:
        status = "â æå" if success else "â å¤±è´¥"
        logger.info(f"  {status}: {description}")

    all_success = all(success for _, success in results)

    if all_success:
        logger.info("\n" + "=" * 60)
        logger.info("ææè¯·æ±çæ ¼å¼çäº§æåå®æï¼")
        logger.info("=" * 60)
    else:
        logger.error("\né¨åæ ¼å¼çäº§å¤±è´¥ï¼è¯·æ£æ¥æ¥å¿è·åè¯¦ç»ä¿¡æ¯ã")


def monitor_job(job_object, job_name):
    """
    éç¨ä»»å¡çæ§å½æ°
    """
    previous_status = ccmasterkernel.JobStatus.Job_unknown

    while True:
        # æ´æ°ç¶æ
        try:
            job_object.updateJobStatus()
        except AttributeError:
            pass

        status = job_object.getJobStatus()

        # æ¾ç¤ºç¶æåå
        if status != previous_status:
            status_str = ccmasterkernel.jobStatusAsString(status)
            logger.info(f"    [{job_name}] {status_str}")
            previous_status = status

        # æ£æ¥æ¯å¦ç»æ
        if status in [ccmasterkernel.JobStatus.Job_completed,
                      ccmasterkernel.JobStatus.Job_failed,
                      ccmasterkernel.JobStatus.Job_cancelled]:
            break

        time.sleep(2)

    # æç»ç»ææ£æ¥
    if status == ccmasterkernel.JobStatus.Job_completed:
        return True
    else:
        msg = job_object.getJobMessage()
        if msg:
            logger.error(f"    [{job_name}] éè¯¯: {msg}")
        return False


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        logger.info("\n\nç¨æ·ä¸­æ­èæ¬æ§è¡ã")
    except Exception as e:
        logger.error(f"\néè¯¯: {e}")
        logger.error("è¯¦ç»å æ :", exc_info=True)


</code></pre>
<p><strong>githubä»åºå°å</strong>ï¼<a href="https://github.com/Canon-create/contextcapture-python-example" target="_blank" rel="noopener nofollow">https://github.com/Canon-create/contextcapture-python-example</a></p>
<p><strong>åèæç« </strong>ï¼<a href="https://blog.csdn.net/qq_41475842/article/details/112959892" target="_blank" rel="noopener nofollow">https://blog.csdn.net/qq_41475842/article/details/112959892</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-04 15:13">2026-01-04 15:13</span>&nbsp;
<a href="https://www.cnblogs.com/foury">æ·±ç´«è²çä¸åå­å·</a>&nbsp;
éè¯»(<span id="post_view_count">36</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19438102);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19438102', targetLink: 'https://www.cnblogs.com/foury/p/19438102', title: 'åºäº ContextCapture SDK ç Python èªå¨åä¸ç»´å»ºæ¨¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ 10åªèé¼ è¯æ¯1000ç¶æ°´é®é¢æèç¬è®° ]]></title>
    <link>https://www.cnblogs.com/mysticbinary/p/19436756</link>
    <guid>6452a4d4f0220c8f8aac993dfa6e45df</guid>
    <description>
    <![CDATA[ 
        <div class="postTitle">
            <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/mysticbinary/p/19436756" title="åå¸äº 2026-01-04 13:22">
    <span role="heading" aria-level="2">10åªèé¼ è¯æ¯1000ç¶æ°´é®é¢æèç¬è®°</span>
    

</a>

        </div>
        <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p></p><div class="toc"><div class="toc-container-header">ç®å½</div><ul><li><a href="#é®é¢æè¿°" rel="noopener nofollow">é®é¢æè¿°</a></li><li><a href="#åçå¾" rel="noopener nofollow">åçå¾</a></li><li><a href="#ææ³" rel="noopener nofollow">ææ³</a></li><li><a href="#æ¯ç¹ä¸çåç©çä¸ççå·®å¼" rel="noopener nofollow">æ¯ç¹ä¸çåç©çä¸ççå·®å¼</a></li></ul></div><p></p>
<hr>
<h1 id="é®é¢æè¿°">é®é¢æè¿°</h1>
<p>1000ç¶æ°´éæä¸ç¶ææ¯ï¼å¯ä»¥ä½¿ç¨10åªèé¼ å»å°æ¯ï¼å½èé¼ åä¸æ¯æ°´1ä¸ªå°æ¶åæ­»å»ï¼è¯·è®¾è®¡ä¸ç§æ¹æ¡ï¼è½å¤å¨1å°æ¶æ¾å°è¿ç¶æ¯è¯ã</p>
<hr>
<h1 id="åçå¾">åçå¾</h1>
<p>å¦æä»äºè¿å¶ç¼ç ä½çè§è§æ¥è§£å³è¿ä¸ªé®é¢åå¾ç®åï¼<br>
<img src="https://img2024.cnblogs.com/blog/1552062/202601/1552062-20260104132050245-398290625.png" alt="image" loading="lazy"></p>
<ul>
<li>
<p>ç»ç¶å­åèé¼ ç¼å·ï¼å°1000ç¶æ°´ç¼å·ä¸º0å°999ãç»10åªèé¼ ä»å·¦å°å³ï¼æä»å³å°å·¦ï¼ç¼å·0å°9ã</p>
<ul>
<li>ç¨äºè¿å¶è¡¨ç¤ºï¼å°ç¶å­ç¼å·è½¬æ¢ä¸º10ä½äºè¿å¶æ°ï¼ä¾å¦ï¼ç¶å­1æ¯0000000001ï¼ç¶å­1000æ¯1111101000ï¼ã</li>
</ul>
</li>
<li>
<p>å¦æç¶å­ç¼å·çç¬¬1ä½æ¯1ï¼ä»å³å¾å·¦æ°ï¼ï¼åå°è¯¥ç¶æ°´æ··å¥ç»ç¬¬1åªèé¼ åçæ··åæ¶²ä¸­ã</p>
</li>
<li>
<p>å¦æ1ä¸ªå°æ¶ååï¼åªä¸ªä½çèé¼ æ­»å»ï¼è®°å½åªä¸ªèé¼ çä½ã<br>
å¾çåè®¾365ææ¯ï¼åèé¼ 0å·ãèé¼ 2å·ãèé¼ 3å·ãèé¼ 0å·ãèé¼ 5å·ãèé¼ 6å·ãèé¼ 8å·æ­»å»æ è®°ä¸º1ï¼å¶ä½ä½æ è®°0 ï¼è½¬10è¿å¶=365ã</p>
</li>
</ul>
<hr>
<h1 id="ææ³">ææ³</h1>
<p>è¿ä¸ªé®é¢çä¼¼æ¯ä¸ä¸ªé»è¾è°é¢ï¼ä½å®éä¸ä½ç°äºä¿¡æ¯ç¼ç çæ ¸å¿ææ³ï¼<strong>ç¨æå°çâæ£æµä½âåºåæå¤çå¯è½æ§ã</strong></p>
<p>è¿ç§æç»´å¨ç°ä»£è®¡ç®æºç§å­¦ãéä¿¡ææ¯åä¿¡æ¯è®ºä¸­æ å¤ä¸å¨ã<br>
ä»ç¡¬çççº éç¼ç å°ç½ç»ä¼ è¾çæ°æ®æ ¡éªï¼ä»æ¡å½¢ç å°äºç»´ç ï¼äºè¿å¶ç¼ç çææ³è´¯ç©¿äºæä»¬çæ°å­ä¸çã</p>
<hr>
<p>è§£å³è¿ä¸ªé®é¢çå³é®å¨äºäºè¿å¶ç¼å·ãæä»¬å° 1000 ç¶è¯æ°´ç¼å·ä¸º 0-999ã<br>
ç¨äºè¿å¶è¡¨ç¤ºè¿äºç¼å·æ¶ï¼1000 â¤ 1024 = 2Â¹â°ï¼è¿æå³çæä»¬éè¦ 10 ä½äºè¿å¶æ°å°±å¯ä»¥è¡¨ç¤ºææç¶å­ã<br>
æ¯åªèé¼ å¯¹åºäºè¿å¶ç¼ç ä¸­çä¸ä½ã10 ä½äºè¿å¶ï¼æ­£å¥½å¯¹åº 10 åªèé¼ ã<br>
<strong>è¿ç§æ¹æ³è½å¤ä¸æ¬¡æ§æµè¯ææç¶å­ï¼èä¸æ¯ä¼ ç»çéç¶æµè¯ã</strong> æçæåå¾å¤§ã</p>
<hr>
<h1 id="æ¯ç¹ä¸çåç©çä¸ççå·®å¼">æ¯ç¹ä¸çåç©çä¸ççå·®å¼</h1>
<p>è¿å¥äºè¿å¶ç¼ç æ¹æ¡å¨çè®ºç¼ç¨åé»è¾è°é¢ä¸­æ¯æç«çï¼ä½å¨å®éæ¯çå­¦æ£æµæç°å®åºæ¯ä¸­ï¼å¾å¾éè¦ç»ååéååºæ²çº¿ãåç»æµè¯æç°ä»£åæåå­¦æ¹æ³ï¼å¦è²è°±ãè´¨è°±ï¼æ´å¯é å°è¯å«æ¯ç©ã</p>
<p>æ¯ç«ä½ æä¸ç¶æ°´å10ä»½äºï¼ç¨éä¹åæææä¹æ ·ï¼é½æ¯æªç¥æ°äºãâ®(â¯â½â°)â­<br>
è¿æï¼æä¹å¯è½ä¸åªèé¼ è½åå ç¾ä»½æ°´å.....</p>

</div>
<div class="clear"></div>

        <div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0.1638888888888889" data-date-updated="2026-01-04 17:18">2026-01-04 13:22</span>&nbsp;
<a href="https://www.cnblogs.com/mysticbinary">Mysticbinary</a>&nbsp;
éè¯»(<span id="post_view_count">305</span>)&nbsp;
è¯è®º(<span id="post_comment_count">4</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19436756);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19436756', targetLink: 'https://www.cnblogs.com/mysticbinary/p/19436756', title: '10åªèé¼ è¯æ¯1000ç¶æ°´é®é¢æèç¬è®°' })">ä¸¾æ¥</a>
</div>
     ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ MQå¦ä½ä¿è¯æ¶æ¯ä¸ä¸¢å¤±ï¼ ]]></title>
    <link>https://www.cnblogs.com/12lisu/p/19437091</link>
    <guid>76e3dda8d7c9740445617f1659d92a6a</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/12lisu/p/19437091" title="åå¸äº 2026-01-04 12:21">
    <span role="heading" aria-level="2">MQå¦ä½ä¿è¯æ¶æ¯ä¸ä¸¢å¤±ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="åè¨">åè¨</h2>
<p>ä»å¤©æä»¬æ¥èèä¸ä¸ªè®©å¾å¤å¼åèå¤´ç¼çè¯é¢ââMQæ¶æ¯ä¸¢å¤±é®é¢ã</p>
<p>æäºå°ä¼ä¼´å¨å·¥ä½ä¸­ï¼ä¸æå°æ¶æ¯éåå°±è§å¾å¾ç®åï¼ä½çæ­£éå°çº¿ä¸æ¶æ¯ä¸¢å¤±æ¶ï¼ææ¥èµ·æ¥å´è®©äººæçã</p>
<p>å¶å®ï¼æå¨å®éå·¥ä½ä¸­ï¼ä¹éå°è¿MQæ¶æ¯ä¸¢å¤±çæåµã</p>
<p>ä»å¤©è¿ç¯æç« ï¼ä¸é¨è·å¤§å®¶ä¸èµ·èèè¿ä¸ªè¯é¢ï¼å¸æå¯¹ä½ ä¼ææå¸®å©ã</p>
<h2 id="ä¸æ¶æ¯ä¸¢å¤±çä¸å¤§ç¯è">ä¸ãæ¶æ¯ä¸¢å¤±çä¸å¤§ç¯è</h2>
<p>å¨æ·±å¥è§£å³æ¹æ¡ä¹åï¼æä»¬åææ¸æ¥æ¶æ¯å¨åªå ä¸ªç¯èå¯è½ä¸¢å¤±ï¼</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2238006/202601/2238006-20260104121945316-1480460555.png" class="lazyload"></p>
<h3 id="1-çäº§èåéé¶æ®µ">1. çäº§èåéé¶æ®µ</h3>
<ul>
<li>ç½ç»æå¨å¯¼è´åéå¤±è´¥</li>
<li>çäº§èå®æºæªåé</li>
<li>Brokerå¤çå¤±è´¥æªè¿åç¡®è®¤</li>
</ul>
<h3 id="2-brokerå­å¨é¶æ®µ">2. Brokerå­å¨é¶æ®µ</h3>
<ul>
<li>åå­æ¶æ¯æªæä¹åï¼éå¯ä¸¢å¤±</li>
<li>ç£çæéå¯¼è´æ°æ®ä¸¢å¤±</li>
<li>éç¾¤åæ¢æ¶æ¶æ¯ä¸¢å¤±</li>
</ul>
<h3 id="3-æ¶è´¹èå¤çé¶æ®µ">3. æ¶è´¹èå¤çé¶æ®µ</h3>
<ul>
<li>èªå¨ç¡®è®¤æ¨¡å¼ä¸å¤çå¼å¸¸</li>
<li>æ¶è´¹èå®æºå¤çä¸­æ­</li>
<li>æå¨ç¡®è®¤ä½å¿è®°ç¡®è®¤</li>
</ul>
<p>çè§£äºé®é¢æ ¹æºï¼æ¥ä¸æ¥æä»¬ç5ç§å®ç¨çè§£å³æ¹æ¡ã</p>
<h2 id="äºæ¹æ¡ä¸çäº§èç¡®è®¤æºå¶">äºãæ¹æ¡ä¸ï¼çäº§èç¡®è®¤æºå¶</h2>
<h3 id="æ ¸å¿åç">æ ¸å¿åç</h3>
<p>çäº§èåéæ¶æ¯åç­å¾Brokerç¡®è®¤ï¼ç¡®ä¿æ¶æ¯æåå°è¾¾ã</p>
<p>è¿æ¯é²æ­¢æ¶æ¯ä¸¢å¤±çç¬¬ä¸éé²çº¿ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2238006/202601/2238006-20260104122003502-1676571740.png" class="lazyload"></p>
<h3 id="å³é®å®ç°">å³é®å®ç°</h3>
<pre><code class="language-java">// RabbitMQçäº§èç¡®è®¤éç½®
@Bean
public RabbitTemplate rabbitTemplate() {
    RabbitTemplate template = new RabbitTemplate(connectionFactory);
    template.setConfirmCallback((correlationData, ack, cause) -&gt; {
        if (ack) {
            // æ¶æ¯æåå°è¾¾Broker
            messageStatusService.markConfirmed(correlationData.getId());
        } else {
            // åéå¤±è´¥ï¼è§¦åéè¯
            retryService.scheduleRetry(correlationData.getId());
        }
    });
    return template;
}

// å¯é åéæ¹æ³
public void sendReliable(String exchange, String routingKey, Object message) {
    String messageId = generateId();
    // åè½åºä¿å­åéç¶æ
    messageStatusService.saveSendingStatus(messageId, message);
    
    // åéæä¹åæ¶æ¯
    rabbitTemplate.convertAndSend(exchange, routingKey, message, msg -&gt; {
        msg.getMessageProperties().setDeliveryMode(MessageDeliveryMode.PERSISTENT);
        msg.getMessageProperties().setMessageId(messageId);
        return msg;
    }, new CorrelationData(messageId));
}
</code></pre>
<h3 id="éç¨åºæ¯">éç¨åºæ¯</h3>
<ul>
<li>å¯¹æ¶æ¯å¯é æ§è¦æ±é«çä¸å¡</li>
<li>éèäº¤æãè®¢åå¤çç­å³é®ä¸å¡</li>
<li>éè¦ç²¾ç¡®ç¥éæ¶æ¯åéç»æçåºæ¯</li>
</ul>
<h2 id="ä¸æ¹æ¡äºæ¶æ¯æä¹åæºå¶">ä¸ãæ¹æ¡äºï¼æ¶æ¯æä¹åæºå¶</h2>
<h3 id="æ ¸å¿åç-1">æ ¸å¿åç</h3>
<p>å°æ¶æ¯ä¿å­å°ç£çï¼ç¡®ä¿Brokeréå¯åæ¶æ¯ä¸ä¸¢å¤±ã</p>
<p>è¿æ¯é²æ­¢Brokerç«¯æ¶æ¯ä¸¢å¤±çå³é®ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2238006/202601/2238006-20260104122035149-1332407257.png" class="lazyload"></p>
<h3 id="å³é®å®ç°-1">å³é®å®ç°</h3>
<pre><code class="language-java">// æä¹åéåéç½®
@Bean
public Queue orderQueue() {
    return QueueBuilder.durable("order.queue")  // éåæä¹å
            .deadLetterExchange("order.dlx")    // æ­»ä¿¡äº¤æ¢æº
            .build();
}

// åéæä¹åæ¶æ¯
public void sendPersistentMessage(Object message) {
    rabbitTemplate.convertAndSend("order.exchange", "order.create", message, msg -&gt; {
        msg.getMessageProperties().setDeliveryMode(MessageDeliveryMode.PERSISTENT); // æ¶æ¯æä¹å
        return msg;
    });
}

// Kafkaæä¹åéç½®
@Bean
public ProducerFactory&lt;String, Object&gt; producerFactory() {
    Map&lt;String, Object&gt; props = new HashMap&lt;&gt;();
    props.put(ProducerConfig.ACKS_CONFIG, "all"); // ææå¯æ¬ç¡®è®¤
    props.put(ProducerConfig.RETRIES_CONFIG, 3);   // éè¯æ¬¡æ°
    props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true); // å¹ç­æ§
    return new DefaultKafkaProducerFactory&lt;&gt;(props);
}
</code></pre>
<h3 id="ä¼ç¼ºç¹">ä¼ç¼ºç¹</h3>
<p><strong>ä¼ç¹ï¼</strong></p>
<ul>
<li>ææé²æ­¢Brokeréå¯å¯¼è´çæ¶æ¯ä¸¢å¤±</li>
<li>éç½®ç®åï¼ææææ¾</li>
</ul>
<p><strong>ç¼ºç¹ï¼</strong></p>
<ul>
<li>ç£çIOå½±åæ§è½</li>
<li>éè¦è¶³å¤çç£çç©ºé´</li>
</ul>
<h2 id="åæ¹æ¡ä¸æ¶è´¹èç¡®è®¤æºå¶">åãæ¹æ¡ä¸ï¼æ¶è´¹èç¡®è®¤æºå¶</h2>
<h3 id="æ ¸å¿åç-2">æ ¸å¿åç</h3>
<p>æ¶è´¹èå¤çå®æ¶æ¯åæå¨åBrokeråéç¡®è®¤ï¼Brokeræ¶å°ç¡®è®¤åæå é¤æ¶æ¯ã</p>
<p>è¿æ¯ä¿è¯æ¶æ¯ä¸ä¸¢å¤±çæåä¸éé²çº¿ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2238006/202601/2238006-20260104122048500-1991151655.png" class="lazyload"></p>
<h3 id="å³é®å®ç°-2">å³é®å®ç°</h3>
<pre><code class="language-java">// æå¨ç¡®è®¤æ¶è´¹è
@RabbitListener(queues = "order.queue")
public void handleMessage(Order order, Message message, Channel channel) {
    long deliveryTag = message.getMessageProperties().getDeliveryTag();
    
    try {
        // ä¸å¡å¤ç
        orderService.processOrder(order);
        
        // æå¨ç¡®è®¤
        channel.basicAck(deliveryTag, false);
        log.info("æ¶æ¯å¤çå®æ: {}", order.getOrderId());
        
    } catch (Exception e) {
        log.error("æ¶æ¯å¤çå¤±è´¥: {}", order.getOrderId(), e);
        
        // å¤çå¤±è´¥ï¼éæ°å¥é
        channel.basicNack(deliveryTag, false, true);
    }
}

// æ¶è´¹èå®¹å¨éç½®
@Bean
public SimpleRabbitListenerContainerFactory containerFactory() {
    SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory();
    factory.setAcknowledgeMode(AcknowledgeMode.MANUAL); // æå¨ç¡®è®¤
    factory.setPrefetchCount(10); // é¢åæ°é
    factory.setConcurrentConsumers(3); // å¹¶åæ¶è´¹è
    return factory;
}
</code></pre>
<h3 id="æ³¨æäºé¡¹">æ³¨æäºé¡¹</h3>
<ul>
<li>ç¡®ä¿ä¸å¡å¤çå®æååç¡®è®¤</li>
<li>åçè®¾ç½®é¢åæ°éï¼é¿ååå­æº¢åº</li>
<li>å¤çå¼å¸¸æ¶è¦æ­£ç¡®ä½¿ç¨NACK</li>
</ul>
<h2 id="äºæ¹æ¡åäºå¡æ¶æ¯æºå¶">äºãæ¹æ¡åï¼äºå¡æ¶æ¯æºå¶</h2>
<h3 id="æ ¸å¿åç-3">æ ¸å¿åç</h3>
<p>éè¿äºå¡ä¿è¯æ¬å°ä¸å¡æä½åæ¶æ¯åéçåå­æ§ï¼è¦ä¹é½æåï¼è¦ä¹é½å¤±è´¥ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2238006/202601/2238006-20260104122103889-905249062.png" class="lazyload"></p>
<h3 id="å³é®å®ç°-3">å³é®å®ç°</h3>
<pre><code class="language-java">// æ¬å°äºå¡è¡¨æ¹æ¡
@Transactional
public void createOrder(Order order) {
    // 1. ä¿å­è®¢åå°æ°æ®åº
    orderRepository.save(order);
    
    // 2. ä¿å­æ¶æ¯å°æ¬å°æ¶æ¯è¡¨
    LocalMessage localMessage = new LocalMessage();
    localMessage.setBusinessId(order.getOrderId());
    localMessage.setContent(JSON.toJSONString(order));
    localMessage.setStatus(MessageStatus.PENDING);
    localMessageRepository.save(localMessage);
    
    // 3. äºå¡æäº¤ï¼æ¬å°ä¸å¡åæ¶æ¯å­å¨ä¿æä¸è´æ§
}

// å®æ¶ä»»å¡æ«æå¹¶åéæ¶æ¯
@Scheduled(fixedDelay = 5000)
public void sendPendingMessages() {
    List&lt;LocalMessage&gt; pendingMessages = localMessageRepository.findByStatus(MessageStatus.PENDING);
    
    for (LocalMessage message : pendingMessages) {
        try {
            // åéæ¶æ¯å°MQ
            rabbitTemplate.convertAndSend("order.exchange", "order.create", message.getContent());
            
            // æ´æ°æ¶æ¯ç¶æä¸ºå·²åé
            message.setStatus(MessageStatus.SENT);
            localMessageRepository.save(message);
            
        } catch (Exception e) {
            log.error("åéæ¶æ¯å¤±è´¥: {}", message.getId(), e);
        }
    }
}

// RocketMQäºå¡æ¶æ¯
public void sendTransactionMessage(Order order) {
    TransactionMQProducer producer = new TransactionMQProducer("order_producer");
    
    // åéäºå¡æ¶æ¯
    Message msg = new Message("order_topic", "create", 
                             JSON.toJSONBytes(order));
    
    TransactionSendResult result = producer.sendMessageInTransaction(msg, null);
    
    if (result.getLocalTransactionState() == LocalTransactionState.COMMIT_MESSAGE) {
        log.info("äºå¡æ¶æ¯æäº¤æå");
    }
}
</code></pre>
<h3 id="éç¨åºæ¯-1">éç¨åºæ¯</h3>
<ul>
<li>éè¦ä¸¥æ ¼ä¿è¯ä¸å¡åæ¶æ¯ä¸è´æ§çåºæ¯</li>
<li>åå¸å¼äºå¡åºæ¯</li>
<li>éèãçµåç­å¯¹æ°æ®ä¸è´æ§è¦æ±é«çä¸å¡</li>
</ul>
<h2 id="å­æ¹æ¡äºæ¶æ¯éè¯ä¸æ­»ä¿¡éå">å­ãæ¹æ¡äºï¼æ¶æ¯éè¯ä¸æ­»ä¿¡éå</h2>
<h3 id="æ ¸å¿åç-4">æ ¸å¿åç</h3>
<p>éè¿éè¯æºå¶å¤çä¸´æ¶æéï¼éè¿æ­»ä¿¡éåå¤çæç»æ æ³æ¶è´¹çæ¶æ¯ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2238006/202601/2238006-20260104122121519-777176098.png" class="lazyload"></p>
<h3 id="å³é®å®ç°-4">å³é®å®ç°</h3>
<pre><code class="language-java">// éè¯éåéç½®
@Bean
public Queue orderQueue() {
    return QueueBuilder.durable("order.queue")
            .withArgument("x-dead-letter-exchange", "order.dlx") // æ­»ä¿¡äº¤æ¢æº
            .withArgument("x-dead-letter-routing-key", "order.dead")
            .withArgument("x-message-ttl", 60000) // 60ç§åè¿å¥æ­»ä¿¡
            .build();
}

// æ­»ä¿¡éåéç½®
@Bean
public Queue orderDeadLetterQueue() {
    return QueueBuilder.durable("order.dead.queue").build();
}

// æ¶è´¹èéè¯é»è¾
@RabbitListener(queues = "order.queue")
public void handleMessageWithRetry(Order order, Message message, Channel channel) {
    long deliveryTag = message.getMessageProperties().getDeliveryTag();
    
    try {
        orderService.processOrder(order);
        channel.basicAck(deliveryTag, false);
        
    } catch (TemporaryException e) {
        // ä¸´æ¶å¼å¸¸ï¼éæ°å¥ééè¯
        channel.basicNack(deliveryTag, false, true);
        
    } catch (PermanentException e) {
        // æ°¸ä¹å¼å¸¸ï¼ç´æ¥ç¡®è®¤è¿å¥æ­»ä¿¡éå
        channel.basicAck(deliveryTag, false);
        log.error("æ¶æ¯è¿å¥æ­»ä¿¡éå: {}", order.getOrderId(), e);
    }
}

// æ­»ä¿¡éåæ¶è´¹è
@RabbitListener(queues = "order.dead.queue")
public void handleDeadLetterMessage(Order order) {
    log.warn("å¤çæ­»ä¿¡æ¶æ¯: {}", order.getOrderId());
    // åéåè­¦ãè®°å½æ¥å¿ãäººå·¥å¤çç­
    alertService.sendAlert("æ­»ä¿¡æ¶æ¯åè­¦", order.toString());
}
</code></pre>
<h3 id="éè¯ç­ç¥å»ºè®®">éè¯ç­ç¥å»ºè®®</h3>
<ol>
<li><strong>ææ°éé¿</strong>ï¼1s, 5s, 15s, 30s</li>
<li><strong>æå¤§éè¯æ¬¡æ°</strong>ï¼3-5æ¬¡</li>
<li><strong>æ­»ä¿¡å¤ç</strong>ï¼äººå·¥ä»å¥æç¹æ®å¤çæµç¨</li>
</ol>
<h2 id="ä¸æ¹æ¡å¯¹æ¯ä¸éåæå">ä¸ãæ¹æ¡å¯¹æ¯ä¸éåæå</h2>
<p>ä¸ºäºå¸®å©å¤§å®¶éæ©åéçæ¹æ¡ï¼ææ´çäºè¯¦ç»çå¯¹æ¯è¡¨ï¼</p>
<table>
<thead>
<tr>
<th>æ¹æ¡</th>
<th>å¯é æ§</th>
<th>æ§è½å½±å</th>
<th>å¤æåº¦</th>
<th>éç¨åºæ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>çäº§èç¡®è®¤</td>
<td>é«</td>
<td>ä¸­</td>
<td>ä½</td>
<td>ææéè¦å¯é åéçåºæ¯</td>
</tr>
<tr>
<td>æ¶æ¯æä¹å</td>
<td>ä¸­</td>
<td>ä¸­</td>
<td>ä½</td>
<td>Brokeréå¯ä¿æ¤</td>
</tr>
<tr>
<td>æ¶è´¹èç¡®è®¤</td>
<td>é«</td>
<td>ä½</td>
<td>ä¸­</td>
<td>ç¡®ä¿æ¶æ¯è¢«æåå¤ç</td>
</tr>
<tr>
<td>äºå¡æ¶æ¯</td>
<td>æé«</td>
<td>é«</td>
<td>é«</td>
<td>å¼ºä¸è´æ§è¦æ±çä¸å¡</td>
</tr>
<tr>
<td>éè¯+æ­»ä¿¡</td>
<td>é«</td>
<td>ä½</td>
<td>ä¸­</td>
<td>å¤çä¸´æ¶æéåæç»æ­»ä¿¡</td>
</tr>
</tbody>
</table>
<h3 id="éåå»ºè®®">éåå»ºè®®</h3>
<p><strong>ååé¡¹ç®/ç®åä¸å¡ï¼</strong></p>
<ul>
<li>çäº§èç¡®è®¤ + æ¶æ¯æä¹å + æ¶è´¹èç¡®è®¤</li>
<li>æ»¡è¶³å¤§é¨ååºæ¯ï¼å®ç°ç®å</li>
</ul>
<p><strong>çµå/äº¤æç³»ç»ï¼</strong></p>
<ul>
<li>çäº§èç¡®è®¤ + äºå¡æ¶æ¯ + éè¯æºå¶</li>
<li>ä¿è¯æ°æ®ä¸è´æ§ï¼å¤çå¤æä¸å¡</li>
</ul>
<p><strong>å¤§æ°æ®/æ¥å¿å¤çï¼</strong></p>
<ul>
<li>æ¶æ¯æä¹å + æ¶è´¹èç¡®è®¤</li>
<li>åè®¸å°éä¸¢å¤±ï¼è¿½æ±ååé</li>
</ul>
<p><strong>éè/æ¯ä»ç³»ç»ï¼</strong></p>
<ul>
<li>å¨æ¹æ¡ç»åä½¿ç¨</li>
<li>æé«å¯é æ§è¦æ±</li>
</ul>
<h2 id="æ»ç»">æ»ç»</h2>
<p>æ¶æ¯ä¸¢å¤±é®é¢æ¯æ¶æ¯éåä½¿ç¨ä¸­çå¸¸è§ææï¼éè¿ä»å¤©ä»ç»ç5ç§æ¹æ¡ï¼æä»¬å¯ä»¥æå»ºä¸ä¸ªå¯é çæ¶æ¯ç³»ç»ï¼</p>
<ol>
<li><strong>çäº§èç¡®è®¤æºå¶</strong> - ä¿è¯æ¶æ¯æååéå°Broker</li>
<li><strong>æ¶æ¯æä¹åæºå¶</strong> - é²æ­¢Brokeréå¯å¯¼è´æ¶æ¯ä¸¢å¤±</li>
<li><strong>æ¶è´¹èç¡®è®¤æºå¶</strong> - ç¡®ä¿æ¶æ¯è¢«æåå¤ç</li>
<li><strong>äºå¡æ¶æ¯æºå¶</strong> - ä¿è¯ä¸å¡åæ¶æ¯çä¸è´æ§</li>
<li><strong>éè¯ä¸æ­»ä¿¡éå</strong> - å¤çå¼å¸¸æåµåæç»æ­»ä¿¡</li>
</ol>
<p>æäºå°ä¼ä¼´å¯è½ä¼é®ï¼"æéè¦å¨é¨ä½¿ç¨è¿äºæ¹æ¡åï¼</p>
<p>"æçå»ºè®®æ¯ï¼<strong>æ ¹æ®ä¸å¡éæ±éæ©åéçç»å</strong>ã</p>
<p>å¯¹äºå³é®ä¸å¡ï¼å»ºè®®è³å°ä½¿ç¨åä¸ç§æ¹æ¡ï¼å¯¹äºæ®éä¸å¡ï¼å¯ä»¥æ ¹æ®å®éæåµéå½ç®åã</p>
<p>è®°ä½ï¼æ²¡æå®ç¾çæ¹æ¡ï¼åªææéåçæ¹æ¡ã</p>
<h2 id="æåè¯´ä¸å¥æ±å³æ³¨å«ç½å«æ">æåè¯´ä¸å¥(æ±å³æ³¨ï¼å«ç½å«æ)</h2>
<p>å¦æè¿ç¯æç« å¯¹æ¨ææå¸®å©ï¼æèææå¯åçè¯ï¼å¸®å¿å³æ³¨ä¸ä¸æçååå¬ä¼å·ï¼èä¸è¯´ææ¯ï¼æ¨çæ¯ææ¯æåæåä½æå¤§çå¨åã</p>
<p>æ±ä¸é®ä¸è¿ï¼ç¹èµãè½¬åãå¨çã</p>
<p>å³æ³¨å¬ä¼å·ï¼ãèä¸è¯´ææ¯ãï¼å¨å¬ä¼å·ä¸­åå¤ï¼è¿å¤§åï¼å¯ä»¥åè´¹è·åææè¿æ´çç10ä¸å­çé¢è¯å®å¸ï¼å¥½å¤å°ä¼ä¼´é è¿ä¸ªå®å¸æ¿å°äºå¤å®¶å¤§åçofferã</p>
<p>æ´å¤é¡¹ç®å®æå¨æçææ¯ç½ç«ï¼<a href="http://www.susan.net.cn/project" target="_blank" rel="noopener nofollow">http://www.susan.net.cn/project</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-04 12:22">2026-01-04 12:21</span>&nbsp;
<a href="https://www.cnblogs.com/12lisu">èä¸è¯´ææ¯</a>&nbsp;
éè¯»(<span id="post_view_count">225</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19437091);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19437091', targetLink: 'https://www.cnblogs.com/12lisu/p/19437091', title: 'MQå¦ä½ä¿è¯æ¶æ¯ä¸ä¸¢å¤±ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åºè®ºç¬è®°ï¼ä¸ï¼ç¢éåæåºç¡ ]]></title>
    <link>https://www.cnblogs.com/GeophysicsWorker/p/19436590</link>
    <guid>596ce9fad3773c85ad74a485b0786509</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/GeophysicsWorker/p/19436590" title="åå¸äº 2026-01-04 11:10">
    <span role="heading" aria-level="2">åºè®ºç¬è®°ï¼ä¸ï¼ç¢éåæåºç¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        ç¢éå½æ°åæåºç¡ï¼ç¢éåææ¯ç¢éä»£æ°çç»§ç»­ï¼æ¯åºè®ºçåºç¡ç¥è¯ï¼åæ¶ä¹æ¯å¼¹æ§æ³¢å¨åå­¦ç­å¶ä»å­¦ç§çæç¨å·¥å·ãå¶æ¬ç¬è®°ä¸»è¦åå®¹æ¯ä»ç»ç¢æ§å½æ°ï¼ç¢ç«¯æ²çº¿åå¶å¾®åï¼ç§¯åè®¡ç®åå¶æ§è´¨ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="åºè®ºç¬è®°ä¸ç¢éåæåºç¡">åºè®ºç¬è®°ï¼ä¸ï¼ç¢éåæåºç¡</h1>
<p>â       ç¢éåææ¯ç¢éä»£æ°çç»§ç»­ï¼æ¯åºè®ºçåºç¡ç¥è¯ï¼åæ¶ä¹æ¯å¼¹æ§æ³¢å¨åå­¦ç­å¶ä»å­¦ç§çæç¨å·¥å·ãå¶æ¬ç¬è®°ä¸»è¦åå®¹æ¯ä»ç»ç¢æ§å½æ°ï¼ç¢ç«¯æ²çº¿åå¶å¾®åï¼ç§¯åè®¡ç®åå¶æ§è´¨ã</p>
<h2 id="11ç¢æ§å½æ°">1.1ç¢æ§å½æ°</h2>
<p>â       å¨ç¢éä»£æ°ä¸­ï¼æ¾ç»å­¦è¿ç¢éçæ¨¡é¿åæ¹åé½ä¿æä¸åçç¢éï¼è¿ç§ç¢éç§°ä¸ºå¸¸ç¢(æ³¨æï¼é¶ç¢éçæ¹åä¸ºä»»æï¼å¯ä½ä¸ºä¸ç§ç¹æ®çå¸¸ç¢é)ï¼ç¶èï¼å¨è®¸å¤ç§å­¦ï¼ææ¯é®é¢ä¸­ï¼æä»¬å¸¸å¸¸éå°æ¨¡é¿åæ¹åæå¶ä¸­ä¹ä¸ä¼æ¹åçç¢éï¼è¿ç§ç¢éç§°ä¸ºåç¢ã</p>
<p>â     <strong>Definition 1.1</strong> è®¾ææ°æ§åé<span class="math inline">\(t\)</span>ååç¢é<span class="math inline">\(\mathbf{A}\)</span>ï¼å¦æå¯¹äº<span class="math inline">\(t\)</span>å¨æä¸ªèå´<span class="math inline">\(G\)</span>åçæ¯ä¸ä¸ªæ°å¼ï¼åç¢é<span class="math inline">\(\mathbf{A}\)</span>é½ä»¥ä¸ä¸ªç¡®å®çç¢éåå®å¯¹åºï¼åç§°<span class="math inline">\(\mathbf{A}\)</span> ä¸ºæ°æ§åé<span class="math inline">\(t\)</span>çç¢éå½æ°ï¼è®°ä½</p>
<p></p><div class="math display">\[\mathbf{A}=\mathbf{A}(t) \tag{1.1.1}
\]</div><p></p><p>å¹¶ç§°<span class="math inline">\(\mathbf{G}\)</span>ä¸ºå½æ°<span class="math inline">\(\mathbf{A}\)</span>çå®ä¹åã</p>
<p>â      ç¢éå½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>å¨<span class="math inline">\(Oxyz\)</span>ç´è§åæ ç³»çä¸ä¸ªåæ ï¼å³å®çä¸ä¸ªåæ ç³»çæå½±ï¼ï¼æ¾ç¶é½æ¯<span class="math inline">\(t\)</span>çå½æ°ï¼</p>
<p></p><div class="math display">\[\mathbf{A}(t)=[A_x(t),A_y(t),A_z(t)] \tag{1.1.2}
\]</div><p></p><p>æä»¥ï¼ç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>çåæ è¡¨è¾¾å¼ä¸ºï¼</p>
<p></p><div class="math display">\[\mathbf{A}=A_x(t)\mathbf{i}+A_y(t)\mathbf{j}+A_z(t)\mathbf{k} \tag{1.1.3}
\]</div><p></p><p>å¶ä¸­<span class="math inline">\(i,j,k\)</span>ä¸ºæ²¿<span class="math inline">\(x,y,z\)</span>ä¸ä¸ªåæ è½´æ­£åçåä½ç¢éãå¯è§ï¼ä¸ä¸ªç¢æ§å½æ°åä¸ä¸ªæåºçæ°æ§å½æ°ï¼åæ ï¼ææä¸ä¸å¯¹åºçå³ç³»ã</p>
<h2 id="12ç¢ç«¯æ²çº¿">1.2ç¢ç«¯æ²çº¿</h2>
<p>â       æ¬ç¬è®°æè®²çç¢éåæèªç±ç¢éï¼å°±æ¯å½ä¸¤ç¢éçæ¨¡é¿åæ¹åç¸åæ¶ï¼å°±è®¤ä¸ºæ­¤äºç¢éæ¯ç¸ç­çãæ®æ­¤ï¼ä¸ºäºè½ç¨å¾å½¢æ¥ç´è§å°è¡¨ç¤ºç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>çååç¶æï¼æä»¬å°±å¯ä»¥æ<span class="math inline">\(\mathbf{A}(t)\)</span>çèµ·ç¹åå¨åæ åç¹ãè¿æ ·ï¼å½<span class="math inline">\(t\)</span> ååæ¶ï¼ç¢é<span class="math inline">\(\mathbf{A}(t)\)</span> çç»ç¹<span class="math inline">\(\mathbf{M}\)</span>å°±æç»åºä¸æ¡æ²çº¿<span class="math inline">\(l\)</span>; è¿æ¡æ²çº¿å«åç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>çç¢ç«¯æ²çº¿ï¼äº¦å«åç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>çå¾å½¢ã</p>
<p>â      ç±ç¢éä»£æ°ç¥éï¼èµ·ç¹å¨åæ åç¹<span class="math inline">\(\mathbf{O}\)</span>ï¼ç»ç¹ä¸º<span class="math inline">\(\mathbf{M}(x,y,z)\)</span>çç¢é<span class="math inline">\(OM\)</span>å«åç¹<span class="math inline">\(M\)</span>(å¯¹äº<span class="math inline">\(O\)</span>ç¹)çç¢å¾ï¼å¸¸ç¨<span class="math inline">\(\mathbf{r}\)</span>è¡¨ç¤ºï¼</p>
<p></p><div class="math display">\[\mathbf{r}=OM=x\mathbf{i}+y\mathbf{j}+z\mathbf{k} \tag{1.2.1}
\]</div><p></p><p>å½æä»¬æç¢éå½æ°<span class="math inline">\(\mathbf{A}(t)\)</span> çèµ·ç¹åå¨åæ åç¹æ¶ï¼<span class="math inline">\(\mathbf{A}(t)\)</span>å®éä¸å°±æä¸ºå¶ç»ç¹<span class="math inline">\(M(x,y,z)\)</span>çç¢å¾ãå æ­¤ï¼<span class="math inline">\(\mathbf{A}(t)\)</span>çä¸ä¸ªåæ <span class="math inline">\(A_x(t),A_y(t),A_z(t)\)</span>å°±å¯¹åºå°ç­äºå¶ç»ç¹<span class="math inline">\(M\)</span>çä¸ä¸ªåæ <span class="math inline">\(x_{M},y_{M},z_{M}\)</span>ï¼å³æ</p>
<p></p><div class="math display">\[\begin{cases}
x_{M}&amp;=A_x(t)\\
y_{M}&amp;=A_y(t)\\
z_{M}&amp;=A_z(t)\\
\end{cases}
\tag{1.2.2}
\]</div><p></p><p>å¼(1.1.2)å°±æ¯ç¢ç«¯æ²çº¿<span class="math inline">\(l\)</span>çä»¥<span class="math inline">\(t\)</span>ä¸ºåæ°çåæ°æ¹ç¨ãå®¹æçåºï¼æ²çº¿<span class="math inline">\(l\)</span>çç¢éæ¹ç¨å¼(1.3)ååæ°æ¹ç¨å¼(1.5)ä¹é´ä¸ä¸å¯¹åºå³ç³»ï¼åªè¦ç¥éå¶ä¸­çä¸ä¸ªï¼å°±å¯ä»¥ç«å»ååºå¦ä¸ä¸ªã</p>
<h2 id="13ç¢æ§å½æ°çæéåè¿ç»­æ§">1.3ç¢æ§å½æ°çæéåè¿ç»­æ§</h2>
<p>â       åæ°æ§å½æ°ä¸æ ·ï¼ç¢æ§å½æ°çæéåè¿ç»­æ§ï¼æ¯ç¢æ§å½æ°çå¾®åä¸ç§¯åçåºç¡æ¦å¿µãå¹åè¿°å¦ä¸ï¼</p>
<p>â        <strong>Definition 1.2 ç¢æ§å½æ°æéçå®ä¹ï¼</strong> è®¾ç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>å¨ç¹<span class="math inline">\(t_0\)</span>çæä¸ªé¢ååæå®ä¹ï¼ä½å¨<span class="math inline">\(t_0\)</span>å¤å¯ä»¥æ²¡æå®ä¹ï¼ï¼<span class="math inline">\(\mathbf{A_{0}}\)</span>ä¸ºä¸å¸¸ç¢ãè¥å¯¹äºä»»æç»å®çæ­£æ°<span class="math inline">\(\varepsilon\)</span>, é½å­å¨ä¸ä¸ªæ­£æ°<span class="math inline">\(\delta\)</span>ï¼ä½¿å¾å½<span class="math inline">\(t\)</span>æ»¡è¶³<span class="math inline">\(0&lt;|t-t_0|&lt;\delta\)</span>æ¶ï¼å°±æ</p>
<p></p><div class="math display">\[|\mathbf{A}(t)-\mathbf{A_{0}}|&lt;\varepsilon \tag{1.3.1}
\]</div><p></p><p>æç«ï¼åç§°<span class="math inline">\(\mathbf{A}_{0}\)</span>ä¸ºç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>å½<span class="math inline">\(t\rightarrow{t_0}\)</span>æ¶çæéï¼è®°ä½</p>
<p></p><div class="math display">\[\lim_{t\rightarrow{t_0}}\mathbf{A}(t)=\mathbf{A_0} \tag{1.3.2}
\]</div><p></p><p>è¿ä¸ªå®ä¹ä¸æ°æ§å½æ°çæéçå®ä¹å®å¨ç±»ä¼¼ãå æ­¤ï¼ç¢æ§å½æ°ä¹å°±æç±»ä¼¼äºæ°æ§å½æ°ä¸­çä¸äºæéè¿ç®æ³åãä¾å¦ï¼</p>
<p></p><div class="math display">\[\lim_{t\rightarrow{t_0}}u(t)\mathbf{A}(t)=\lim_{t\rightarrow{t_0}}u(t)\lim_{t\rightarrow{t_0}}\mathbf{A}(t) \tag{1.3.3}
\]</div><p></p><p></p><div class="math display">\[\lim_{t\rightarrow{t_0}}[\mathbf{A}(t)\pm\mathbf{B}(t)]=\lim_{t\rightarrow{t_0}}{\mathbf{A}(t)}\pm\lim_{t\rightarrow{t_0}}{\mathbf{B}(t)} \tag{1.3.4}
\]</div><p></p><p></p><div class="math display">\[\lim_{t\rightarrow{t_0}}[\mathbf{A}(t)\cdot\mathbf{B}(t)]=\lim_{t\rightarrow{t_0}}\mathbf{A}(t)\lim_{t\rightarrow{t_0}}\mathbf{B}(t) \tag{1.3.5}
\]</div><p></p><p></p><div class="math display">\[\lim_{t\rightarrow{t_0}}[\mathbf{A}(t)\times\mathbf{B}(t)]=\lim_{t\rightarrow{t_0}}\mathbf{A}(t)\times\lim_{t\rightarrow{t_0}}{\mathbf{B}}(t) \tag{1.3.6}
\]</div><p></p><p>å¶ä¸­ï¼<span class="math inline">\(u(t)\)</span>ä¸ºæ°æ§å½æ°ï¼<span class="math inline">\(\mathbf{A}(t)\)</span>,<span class="math inline">\(\mathbf{B}(t)\)</span> ä¸ºç¢æ§å½æ°ï¼ä¸å½<span class="math inline">\(t\rightarrow{t_0}\)</span> æ¶ï¼<span class="math inline">\(u(t)\)</span>,<span class="math inline">\(\mathbf{A}(t)\)</span>,<span class="math inline">\(\mathbf{B}(t)\)</span> åææéå­å¨ã</p>
<p>â       ä¾æ­¤ï¼æ ¹æ®å¼(1.3)æä¸å¼</p>
<p></p><div class="math display">\[\lim_{t\rightarrow{t_0}}\mathbf{A}(t)=\lim_{t\rightarrow{t_0}}A_x(t)\mathcal{i}+\lim_{t\rightarrow{t_0}}A_y(t)\mathcal{j}+\lim_{t\rightarrow{t_0}}A_z(t)\mathcal{k} \tag{1.3.7}
\]</div><p></p><p>æ­¤å¼ææ±ç¢æ§å½æ°çæéï¼å½ç»ä¸ºæ±ä¸ä¸ªæ°æ§å½æ°çæéã</p>
<p>â       <strong>Definition 1.3 ç¢æ§å½æ°è¿ç»­æ§çå®ä¹ï¼</strong>è¥ç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>å¨ç¹<span class="math inline">\(t_0\)</span>çæä¸ªé¢ååæå®ä¹ï¼èä¸æ</p>
<p></p><div class="math display">\[\lim_{t\rightarrow{t_0}}\mathbf{A}(t)=\mathbf{A}(t_0) \tag{1.3.8}
\]</div><p></p><p>åç§°<span class="math inline">\(\mathbf{A}(t)\)</span>å¨<span class="math inline">\(t=t_0\)</span>å¤è¿ç»­ã</p>
<p>â      å®¹æçåº:ç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>å¨ç¹<span class="math inline">\(t_0\)</span>å¤è¿ç»­çåè¦æ¡ä»¶æ¯å®çä¸ä¸ªåæ å½æ°<span class="math inline">\(A_x(t)\)</span>, <span class="math inline">\(A_y(t)\)</span>, <span class="math inline">\(A_z(t)\)</span> é½å¨<span class="math inline">\(t_0\)</span> å¤è¿ç»­ã</p>
<p>â      è¥ç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>å¨æä¸ªåºé´åçæ¯ä¸ä¸ªç¹å¤é½èç³»ï¼åç§°å®å¨è¯¥åºé´åè¿ç»­ã</p>
<h2 id="14-ç¢æ§å½æ°çå¯¼æ°ä¸å¾®å">1.4 ç¢æ§å½æ°çå¯¼æ°ä¸å¾®å</h2>
<p>â         å¨ä¸è¿°å°ç»ä¸­ï¼æä»¬åæ­¥å®ä¹äºç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span> åå¶å ä½æä¹ç¢ç«¯æ²çº¿ï¼å¨æ­¤åºç¡ä¸ï¼ç±»ä¼¼æ°æ§å½æ°ï¼å¨æ¬èä¸­ä»ç¢æ§å½æ°çå¯¼æ°åºåï¼ç»åºç¢æ§å½æ°çå¾®ååå¶æ§è´¨ã</p>
<h3 id="141-ç¢æ§å½æ°çå¯¼æ°">1.4.1 ç¢æ§å½æ°çå¯¼æ°</h3>
<p>è®¾æèµ·ç¹å¨<span class="math inline">\(O\)</span>ç¹çç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>ï¼å½æ°æ§åé<span class="math inline">\(t\)</span>å¨å¶å®ä¹ååä»<span class="math inline">\(t\)</span>å°<span class="math inline">\(t+\Delta{t}(t\neq0)\)</span>æ¶ï¼å¯¹åºçç¢éåå«ä¸ºï¼</p>
<p></p><div class="math display">\[\mathbf{A}(t)=OM \tag{1.4.1}
\]</div><p></p><p></p><div class="math display">\[\mathbf{A}(t+\Delta{t})=ON \tag{1.4.2}
\]</div><p></p><p>ç±æ­¤å¯å®ä¹ç¢æ§å½æ°çå¢éï¼è®°ä½<span class="math inline">\(\Delta{\mathbf{A}}\)</span>ï¼å</p>
<p></p><div class="math display">\[\Delta{\mathbf{A}}=\mathbf{A}(t+\Delta{t})-\mathbf{A}(t)=MN \tag{1.4.3}
\]</div><p></p><p>æ®æ­¤ï¼å°±å¯ä»¥ç»åºç¢æ§å½æ°çå¯¼æ°çå®ä¹ã</p>
<p><strong>Definition 1.4 ç¢æ§å½æ°çå¯¼æ°ï¼</strong>è®¾ç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>å¨ç¹<span class="math inline">\(t\)</span>çæä¸é¢ååæå®ä¹ï¼å¹¶è®¾<span class="math inline">\(t+\Delta{t}\)</span>ä¹å¨è¿ä¸ªé¢ååãè¥<span class="math inline">\(\mathbf{A}(t)\)</span>å¯¹åºäº<span class="math inline">\(\Delta{t}\)</span>çå¢é<span class="math inline">\(\Delta{\mathbf{A}}\)</span> ä¸<span class="math inline">\(\Delta{t}\)</span>çä¹æ¯</p>
<p></p><div class="math display">\[\frac{d{\mathbf{A}}}{d{t}}=\frac{\mathbf{A}(t+\Delta{t})-\mathbf{A}(t)}{\Delta{t}} \tag{1.4.4}
\]</div><p></p><p>å¨<span class="math inline">\(\Delta{t}\rightarrow{0}\)</span>æ¶ï¼åå¶æéå­å¨ï¼åç§°æ­¤æéä¸ºç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>å¨ç¹<span class="math inline">\(t\)</span>å¤çå¯¼æ°ï¼ç®ç§°ä¸ºå¯¼ç¢ï¼ï¼è®°ä½ <span class="math inline">\(\frac{d{\mathbf{A}}}{d{t}}\)</span> æè <span class="math inline">\(\mathbf{A}^{'}(t)\)</span>ï¼å³</p>
<p></p><div class="math display">\[\frac{d\mathbf{A}(t)}{d{t}}=\lim_{t\rightarrow{t_0}}\frac{\Delta{\mathbf{A}}}{\Delta{t}}=\lim_{t\rightarrow{t_0}}\frac{\mathbf{A}(t+\Delta{t})-\mathbf{A}(t)}{\Delta{t}} \tag{1.4.5}
\]</div><p></p><p>è¥<span class="math inline">\(\mathbf{A}(t)\)</span> ç±åæ æ§è´¨ç»åºï¼</p>
<p></p><div class="math display">\[\mathbf{A}(t)=A_x(t)\mathbf{i}+A_y(t)\mathbf{j}+A_z(t)\mathbf{k} \tag{1.4.6}
\]</div><p></p><p>ä¸å½æ°<span class="math inline">\(A_x(t),A_y(t),A_z(t)\)</span> å¨ç¹<span class="math inline">\(t\)</span>å¯å¯¼ï¼åæ</p>
<p></p><div class="math display">\[\begin{aligned}
\frac{d{\mathbf{A}}}{d{t}}&amp;=\lim_{\Delta{t}\rightarrow{0}}\frac{\Delta\mathbf{A}}{\Delta{t}}\\
&amp;=\lim_{\Delta{t}\rightarrow{0}}\frac{\Delta{A_x}}{\Delta{t}}\mathbf{i}+\lim_{\Delta{t}\rightarrow{0}}\frac{\Delta{A_y}}{\Delta{t}}\mathbf{j}+\lim_{\Delta{t}\rightarrow{0}}\frac{\Delta{A_z}}{\Delta{t}}\mathbf{k}\\
&amp;=\frac{d{A_x}}{d{t}}\mathbf{i}+\frac{d{A_y}}{dt}\mathbf{j}+\frac{d{A_z}}{d{z}}\mathbf{k}
\end{aligned}
\tag{1.4.7}
\]</div><p></p><p>å³</p>
<p></p><div class="math display">\[\mathbf{A^{\prime}}(t)=A_x^{\prime}(t)\mathbf{i}+A_y^{\prime}(t)\mathbf{j}+A_z^{\prime}\mathbf{k} \tag{1.4.8}
\]</div><p></p><p>æ­¤å¼ææ±ç¢éå½æ°çå¯¼æ°å½ç»ä¸ºæ±ä¸ä¸ªåéçæ°æ§å½æ°çå¯¼æ°ã</p>
<h3 id="142-ç¢æ§å½æ°çå¯¼æ°å ä½æä¹">1.4.2 ç¢æ§å½æ°çå¯¼æ°å ä½æä¹</h3>
<p>â        å¦å¾ï¼<span class="math inline">\(l\)</span>ä¸º<span class="math inline">\(\mathbf{A}(t)\)</span>ç¢ç«¯æ²çº¿ï¼<span class="math inline">\(\frac{\Delta\mathbf{A}}{\Delta{t}}\)</span> æ¯å¨<span class="math inline">\(l\)</span>çå²çº¿<span class="math inline">\(MN\)</span>ä¸çä¸ä¸ªç¢éãå½<span class="math inline">\(\Delta{t}&gt;0\)</span>æ¶ï¼å¶æåä¸<span class="math inline">\(\Delta{A}\)</span>ä¸è´ï¼ç³»æåå¯¹åº<span class="math inline">\(t\)</span>å¼å¢å¤§çä¸æ¹ï¼å½<span class="math inline">\(\Delta{t}&lt;0\)</span>æ¶ï¼å¶æåä¸<span class="math inline">\(\Delta{\mathbf{A}}\)</span> ç¸åï¼ä½æ­¤æ¶<span class="math inline">\(\Delta{A}\)</span>æåå¯¹åº<span class="math inline">\(t\)</span>å¼å½æ°åå°çä¸æ¹ï¼ä»è<span class="math inline">\(\frac{\Delta\mathbf{A}}{\Delta{t}}\)</span> ä¾ç¶æåå¯¹åº<span class="math inline">\(t\)</span>å¼å¢å¤§çä¸æ¹ã</p>
<p>â       å¨<span class="math inline">\(\Delta{t}\rightarrow{0}\)</span> æ¶ï¼ç±äºå²çº¿<span class="math inline">\(MN\)</span>ç»ç¹<span class="math inline">\(M\)</span>è½¬å¨ï¼ä¸ä»¥ç¹<span class="math inline">\(M\)</span>å¤çåçº¿ä¸ºå¶æéä½ç½®ãæ­¤æ¶ï¼å¨å²çº¿ä¸çç¢é<span class="math inline">\(\Delta{\mathbf{A}}\over{\Delta{t}}\)</span>çæéä½ç½®ãæ­¤æ¶ï¼å¨å²çº¿ä¸çç¢é<span class="math inline">\(\Delta{\mathbf{A}}\over{\Delta{t}}\)</span> çæéä½ç½®ï¼èªç¶ä¹å°±å¨æ­¤åçº¿ä¸ï¼åä¹å°±æ¯è¯´ï¼å¯¼ç¢</p>
<p></p><div class="math display">\[\mathbf{A}^{\prime}(t)=\lim_{t\rightarrow{0}}\frac{\Delta{\mathbf{A}}}{\Delta{t}} \tag{1.4.9}
\]</div><p></p><p>å½å¶ä¸ä¸ºé¶æ¶ï¼æ¯å¨ç¹<span class="math inline">\(M\)</span>å¤çåçº¿ä¸ï¼ä¸ç±ä¸è¿°å¯ç¥ï¼å¶æ¹åææåå¯¹åº<span class="math inline">\(t\)</span>å¼å¢å¤§çæ¹åãæå¯¼ç¢å¨å ä½ä¸ä¸ºä¸ç¢ç«¯æ²çº¿çååç¢éï¼æåå¯¹åº<span class="math inline">\(t\)</span>å¼å¢å¤§çä¸æ¹ã</p>
<h3 id="143-ç¢æ§å½æ°çå¾®å">1.4.3 ç¢æ§å½æ°çå¾®å</h3>
<p>ï¼1ï¼å¾®åçæ¦å¿µä¸å ä½æä¹</p>
<p>â        æ ¹æ®æ°æ§å½æ°çå¾®åçå®ä¹ï¼è®¾ç¢æ§å½æ°<span class="math inline">\(\mathbf{A}=\mathbf{A^{\prime}}(t)\)</span>ï¼æä»¬æ</p>
<p></p><div class="math display">\[d\mathbf{A}=\mathbf{A^{\prime}}(t)dt \space  (dt=\Delta{t}) \tag{1.4.10}
\]</div><p></p><p>ç§°ä¸ºç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span> å¨<span class="math inline">\(t\)</span> å¤çå¾®åã</p>
<p>â       ç±äºå¾®å<span class="math inline">\(d{\mathbf{A}}\)</span> æ¯å¯¼ç¢<span class="math inline">\(\mathbf{A^{\prime}}(t)\)</span>ä¸å¢é<span class="math inline">\(\Delta{t}\)</span> çä¹ç§¯ï¼æä»¥å¶æ¯ä¸ä¸ªç¢éï¼èä¸åå¯¼ç¢<span class="math inline">\(\mathbf{A}^{\prime}(t)\)</span> ä¸æ ·ï¼ä¹å¨ç¹<span class="math inline">\(M\)</span>å¤ä¸<span class="math inline">\(\mathbf{A}(t)\)</span> çç¢ç«¯æ²çº¿<span class="math inline">\(l\)</span> ç¸åï¼ä½å¶æåï¼å½<span class="math inline">\(dt&gt;0\)</span>æ¶ï¼ä¸<span class="math inline">\(\mathbf{A}^{\prime}(t)\)</span> ç¸åæ¹åä¸è´ï¼èå½<span class="math inline">\(dt&lt;0\)</span>æ¶ï¼åä¸<span class="math inline">\(\mathbf{A}^{\prime}(t)\)</span> çæ¹åç¸åãå¾®å<span class="math inline">\(d{\mathbf{A}}\)</span> çåéè¡¨è¾¾å¼å¦ä¸ï¼</p>
<p></p><div class="math display">\[d{\mathbf{A}}=A_x^{\prime}(t)dt\mathbf{i}+A_{y}^{\prime}(t)dt\mathbf{j}+A_z^{\prime}(t)dt\mathbf{k} \tag{1.4.11}
\]</div><p></p><p>æ</p>
<p></p><div class="math display">\[d{\mathbf{A}}=d{A_x}\mathbf{i}+d{A_y}\mathbf{j}+d{A_z}\mathbf{k} \tag{1.4.12}
\]</div><p></p><p>(2)   <span class="math inline">\(\frac{d\mathbf{r}}{ds}\)</span> çå ä½æä¹</p>
<p>â       å¦ææç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)=A_x(t)\mathbf{i}+A_y(t)\mathbf{j}+A_z(t)\mathbf{k}\)</span> çä½å¶ç»ç¹<span class="math inline">\(M(x,y,z)\)</span> çç¢å¾å½æ°ï¼</p>
<p></p><div class="math display">\[\mathbf{r}=x\mathbf{i}+y\mathbf{j}+z\mathbf{k} \tag{1.4.13}
\]</div><p></p><p>è¿é<span class="math inline">\(x=A_x(t),y=A_y(t),z=A_z(t)\)</span>ï¼åä¸å¼å¯ä»¥åä¸ºå¦ä¸çå½¢å¼ï¼</p>
<p></p><div class="math display">\[|d{\mathbf{r}}|=\sqrt{dx^2+dy^2+dz^2} \tag{1.4.14}
\]</div><p></p><p>éå¸¸é½å°ç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span>çç¢ç«¯æ²çº¿<span class="math inline">\(l\)</span>è§ä¸ºæåæ²çº¿ï¼å¨æ ç¹å«å£°ææ¶ï¼é½æ¯å<span class="math inline">\(t\)</span> å¼å¢å çä¸æ¹ä¸º<span class="math inline">\(l\)</span>ä¹æ­£åãè¥å¨<span class="math inline">\(l\)</span>ä¸åå®ä¸ç¹<span class="math inline">\(M_0\)</span> ä½ä¸ºè®¡ç®å¼§é¿<span class="math inline">\(s\)</span>çèµ·ç¹ï¼å¹¶ä»¥<span class="math inline">\(l\)</span>ä¹æ­£åï¼å³<span class="math inline">\(t\)</span>å¼å¢å¤§çæ¹åï¼ä½ä¸º<span class="math inline">\(s\)</span>å¢å¤§çæ¹åï¼åå¨ä»»ä¸ç¹<span class="math inline">\(M\)</span>å¤ï¼å¼§é¿çå¾®åæ¯</p>
<p></p><div class="math display">\[ds=\pm\sqrt{dx^2+dy^2+dz^2} \tag{1.4.15}
\]</div><p></p><p>æç§ä¸è¿°åæ³åå³ç«¯ç¬¦å·ï¼ä»¥ç¹<span class="math inline">\(M\)</span>ä¸ºçï¼å½<span class="math inline">\(ds\)</span>ä½äº<span class="math inline">\(s\)</span>å¢å¤§ä¸æ¹æ¶åæ­£å·ï¼åä¹åè´å·ãç±æ­¤å¯è§æï¼</p>
<p></p><div class="math display">\[|d{\mathbf{r}}|=|d{s}| \tag{1.4.16}
\]</div><p></p><p>å°±æ¯è¯´ï¼ç¢æ§å½æ°çå¾®ååéçæ¨¡é¿ç­äºï¼å¶ç¢ç«¯æ²çº¿çï¼å¼§é¿å¾®åçç»å¯¹å¼ï¼ä»èç±</p>
<p></p><div class="math display">\[|d{\mathbf{r}}|=\left|\frac{d{\mathbf{r}}}{ds}ds\right|=\left|\frac{d{\mathbf{r}}}{ds}\right|\cdot|ds| \tag{1.4.17}
\]</div><p></p><p>æ</p>
<p></p><div class="math display">\[\left|\frac{d{\mathbf{r}}}{ds}\right|=\frac{|d{\mathbf{r}}|}{|ds|}=1 \tag{1.4.18}
\]</div><p></p><p>ç»åå¯¼ç¢çå ä½æä¹ï¼ä¾¿ç¥ï¼ç¢<strong>æ§å½æ°å¯¹ï¼å¶ç¢ç«¯æ²çº¿çï¼å¼§é¿<span class="math inline">\(s\)</span> çå¯¼æ°<span class="math inline">\(\frac{d{\mathbf{r}}}{ds}\)</span> å¨å ä½ä¸ä¸ºåååä½åéï¼ææå<span class="math inline">\(s\)</span>å¢å¤§çä¸æ¹</strong>ã</p>
<p><strong>Equation 1.5.1</strong>  è¯æ <span class="math inline">\(\frac{ds}{dt}=\left|\frac{d{\mathbf{r}}}{dt}\right|\)</span></p>
<p>è¯æï¼</p>
<p></p><div class="math display">\[\frac{d{\mathbf{r}}}{dt}=\frac{dx}{dt}\mathbf{i}+\frac{dy}{dt}\mathbf{j}+\frac{dz}{dt}\mathbf{k} \tag{1.4.19}
\]</div><p></p><p>ç±æ­¤å¯ç¥ï¼<span class="math inline">\(\mathbf{r}\)</span> çç¢æ§å¾®åçæ¨¡é¿ï¼</p>
<p></p><div class="math display">\[\left|\frac{d\mathbf{r}}{dt}\right|=\sqrt{\left(\frac{dx}{dt}\right)^2+\left(\frac{dy}{dt}\right)^2+\left(\frac{dz}{dt}\right)^2} \tag{1.4.20}
\]</div><p></p><p>ç±æ­¤å¯ç¥ï¼<span class="math inline">\(ds\)</span>ä¸<span class="math inline">\(dt\)</span> å·æç¸åçç¬¦å·ï¼åºæ</p>
<p></p><div class="math display">\[\begin{aligned}
\frac{ds}{dt}&amp;=\frac{\pm\sqrt{dx^2+dy^2+dz^2}}{\pm\sqrt{dt^2}}  \\
&amp;=\sqrt{\left(\frac{dx}{dt}\right)^2+\left(\frac{dy}{dt}\right)^2+\left(\frac{dz}{dt}\right)^2}\\
&amp;=\left|\frac{d\mathbf{r}}{dt}\right|
\end{aligned}
\tag{1.4.21}
\]</div><p></p><p>ç±æ­¤å¯ç¥ï¼<strong>ç¢ç«¯æ²çº¿çåååä½ç¢éï¼å³</strong></p>
<p></p><div class="math display">\[\frac{d{\mathbf{r}}}{d{s}}=\frac{\frac{d\mathbf{r}}{d{t}}}{\frac{ds}{dt}}=\frac{d\mathbf{r}}{dt}\bigg/\left|\frac{d{\mathbf{r}}}{dt}\right| \tag{1.4.19}
\]</div><p></p><h3 id="144-ç¢æ§å½æ°çå¯¼æ°æ§è´¨">1.4.4 ç¢æ§å½æ°çå¯¼æ°æ§è´¨</h3>
<p>è®¾ç¢æ§å½æ°<span class="math inline">\(\mathbf{A}=\mathbf{A}(t),\mathbf{B}=\mathbf{B}(t)\)</span> åæ°æ§å½æ° <span class="math inline">\(u=u(t)\)</span> å¨<span class="math inline">\(t\)</span> çæä¸ªèå´åå¯å¯¼ï¼åä¸åå¬å¼å¨è¯¥èå´åæç«</p>
<ol>
<li><span class="math inline">\(\frac{d}{dt}{\mathbf{C}}=\mathbf{0}\)</span> (<span class="math inline">\(\mathbf{C}\)</span>ä¸ºå¸¸ç¢)ï¼</li>
<li><span class="math inline">\(\frac{d}{dt}(\mathbf{A}\pm\mathbf{B})=\frac{d{\mathbf{A}}}{dt}\pm\frac{d\mathbf{B}}{dt}\)</span>;</li>
<li><span class="math inline">\(\frac{d}{dt}(k\mathbf{A})=k\frac{d\mathbf{A}}{dt}\)</span>(<span class="math inline">\(k\)</span>ä¸ºå¸¸æ°);</li>
<li><span class="math inline">\(\frac{d}{dt}(u\mathbf{A})=\frac{du}{dt}\mathbf{A}+u\frac{d{\mathbf{A}}}{dt};\)</span></li>
<li><span class="math inline">\(\frac{d}{dt}(\mathbf{A}\cdot\mathbf{B})=\mathbf{A}\cdot\frac{d\mathbf{B}}{dt}+\mathbf{B}\cdot\frac{d\mathbf{A}}{dt};\)</span></li>
<li><span class="math inline">\(\frac{d}{dt}(\mathbf{A}\times\mathbf{B})=\mathbf{A}\times\frac{d{\mathbf{B}}}{dt}+\mathbf{B}\times\frac{d{\mathbf{A}}}{dt}\)</span></li>
<li><span class="math inline">\(\frac{d}{dt}\mathbf{A^2}=2\mathbf{A}\cdot\frac{d{\mathbf{A}}}{dt}\)</span>(å¶ä¸­<span class="math inline">\(\mathbf{A}^2=\mathbf{A}\cdot\mathbf{A}\)</span>)</li>
<li>å¤åå½æ°æ±å¯¼å¬å¼ï¼è¥<span class="math inline">\(\mathbf{A}=\mathbf{A}(u),u=u(t)\)</span>ï¼å</li>
</ol>
<p></p><div class="math display">\[\frac{d{\mathbf{A}}}{dt}=\frac{d{\mathbf{A}}}{dt}\frac{du}{dt} \tag{1.4.20}
\]</div><p></p><p>è¿äºå¬å¼çè¯ææ¹æ³ï¼ä¸å¾®ç§¯åå­¦ä¸­æ°æ§å½æ°çç±»ä¼¼å¬å¼çè¯æ³ï¼å®å¨ç¸åï¼æ¯å¦å¬å¼ï¼5ï¼å¯ä»¥è¿æ ·è¯æï¼</p>
<p></p><div class="math display">\[\begin{aligned}
\Delta(\mathbf{A}\cdot\mathbf{B})&amp;=(\mathbf{A}+\Delta{\mathbf{A}})\cdot(\mathbf{B}+\Delta{\mathbf{B}})-\mathbf{A}\cdot\mathbf{B} \\
&amp;=\mathbf{A}\cdot\mathbf{B}+\mathbf{A}\cdot(\Delta\mathbf{B})+\mathbf{B}\cdot(\Delta{\mathbf{A}})+\Delta{\mathbf{A}}\cdot\Delta{\mathbf{B}}-\mathbf{A}\cdot\mathbf{B}\\
&amp;=\mathbf{A}\cdot{\Delta{\mathbf{B}}}+\mathbf{B}\cdot\Delta\mathbf{A}+\Delta{\mathbf{A}}\cdot\Delta{\mathbf{B}}
\end{aligned}
\tag{1.4.21}
\]</div><p></p><p>ä»¥<span class="math inline">\(\Delta{t}\)</span> é¤ä»¥ä¸¤ç«¯ï¼æ</p>
<p></p><div class="math display">\[\frac{\Delta{\mathbf{A}\cdot\mathbf{B}}}{\Delta{t}}=\mathbf{A}\cdot\frac{\Delta{\mathbf{B}}}{\Delta{t}}+\mathbf{B}\cdot\frac{\Delta{\mathbf{A}}}{\Delta{t}} \tag{1.4.22}
\]</div><p></p><p>åä»¤ <span class="math inline">\(\Delta{t}\rightarrow{0}\)</span> ä¸¤ç«¯åæéï¼å°±å¾å°ï¼</p>
<p></p><div class="math display">\[\begin{aligned}
\frac{d}{dt}(\mathbf{A}\cdot\mathbf{B})&amp;=\mathbf{A}\cdot\frac{d{\mathbf{B}}}{dt}+\mathbf{B}\frac{d{\mathbf{A}}}{dt}+\mathbf{0}\cdot\frac{d{\mathbf{B}}}{dt}\\
&amp;=\mathbf{A}\cdot\frac{d{\mathbf{B}}}{dt}+\mathbf{B}\frac{d{\mathbf{A}}}{dt}
\end{aligned}\tag{1.4.23}
\]</div><p></p><p><strong>å®ç</strong>  ç¢æ§å½æ°<span class="math inline">\(\mathbf{A}(t)\)</span> çæ¨¡ä¸åçåè¦æ¡ä»¶æ¯</p>
<p></p><div class="math display">\[\mathbf{A}\cdot\frac{d\mathbf{A}}{dt}=0 \tag{1.4.24}
\]</div><p></p><p><strong>è¯æï¼</strong> åå® <span class="math inline">\(|\mathbf{A}|=constant\)</span>, åæ</p>
<p></p><div class="math display">\[\mathbf{A}^2=|\mathbf{A}|^2=constant \tag{1.4.25}
\]</div><p></p><p>ä¸¤ç«¯å¯¹<span class="math inline">\(t\)</span> æ±å¯¼ï¼å°±å¾å°</p>
<p></p><div class="math display">\[\mathbf{A}\cdot\frac{d{\mathbf{A}}}{dt}=0 \tag{1.4.26}
\]</div><p></p><p>åä¹ï¼è¥æ <span class="math inline">\(\mathbf{A}\cdot\frac{d\mathbf{A}}{dt}=0\)</span>, ä»è</p>
<p></p><div class="math display">\[\frac{d}{dt}\mathbf{A}^2=0 \tag{1.4.27}
\]</div><p></p><p>åæï¼</p>
<p></p><div class="math display">\[\mathbf{A}^2=|\mathbf{A}|^2=constant \tag{1.4.28}
\]</div><p></p><p>æä»¥è¦æ</p>
<p></p><div class="math display">\[|\mathbf{A}|= constant \tag{1.4.29}
\]</div><p></p><p>è¿ä¸ªä¾å­ï¼å¯ä»¥ç®åå°è¯´æï¼å®é¿ç¢é<span class="math inline">\(\mathbf{A}(t)\)</span> ä¸å¶å¯¼ç¢éäºç¸åç´ãç¹å«ï¼å¯¹äºåä½ç¢é$$</p>
<p></p><div class="math display">\[\mathbf{A}^{o}\perp \frac{d{\mathbf{A}^{o}}}{dt} \tag{1.4.30}
\]</div><p></p><h3 id="145--å¯¼ç¢çç©çæä¹">1.4.5  å¯¼ç¢çç©çæä¹</h3>
<p>â        è®¾è´¨ç¹<span class="math inline">\(M\)</span>å¨ç©ºé´è¿å¨ï¼å¶ç¢å¾<span class="math inline">\(\mathbf{r}\)</span> ä¸æ¶é´<span class="math inline">\(t\)</span>çå½æ°å³ç³»ä¸º</p>
<p></p><div class="math display">\[\mathbf{r}=\mathbf{r}(t) \tag{1.4.31}
\]</div><p></p><p>è¿ä¸ªå½æ°çç¢ç«¯æ²çº¿<span class="math inline">\(l\)</span>å°±æ¯è´¨ç¹<span class="math inline">\(M\)</span>çè¿å¨è½¨è¿¹ã</p>
<p>â        ä¸ºäºè¯´æå¯¼ç¢<span class="math inline">\(\frac{d{\mathbf{r}}}{dt}\)</span> çç©çæä¹ï¼åå®è´¨ç¹å¨æ¶å» <span class="math inline">\(t=0\)</span>æ¶ä½äºç¹<span class="math inline">\(M_0\)</span>å¤ï¼ç»è¿ä¸æ®µæ¶é´<span class="math inline">\(t\)</span> ä»¥åå°è¾¾ç¹<span class="math inline">\(M\)</span>,å¶é´å¨<span class="math inline">\(l\)</span>ä¸æç»è¿çè·¯ç¨ä¸º<span class="math inline">\(s\)</span>ãè¿æ ·ï¼ç¹<span class="math inline">\(M\)</span>çç¢å¾<span class="math inline">\(\mathbf{r}\)</span> æ¾ç¶æ¯è·¯ç¨<span class="math inline">\(s\)</span> çå½æ°ï¼è<span class="math inline">\(s\)</span> åæ¯æ¶é´<span class="math inline">\(t\)</span> çå½æ°ï¼ä»èå¯ä»¥å°<span class="math inline">\(\mathbf{r}=\mathbf{r}(t)\)</span> çä½<span class="math inline">\(\mathbf{r}\)</span> æ¯éè¿ä¸­é´åé<span class="math inline">\(s\)</span>èæä¸ºæ¶é´<span class="math inline">\(t\)</span>çä¸ä¸ªå¤åå½æ°ï¼äºæ¯ç±å¤åå½æ°çæ±å¯¼å¬å¼æï¼</p>
<p></p><div class="math display">\[\frac{d{\mathbf{r}}}{dt}=\frac{d{\mathbf{r}}}{ds}\cdot\frac{ds}{dt} \tag{1.4.32}
\]</div><p></p><p>ç¢ä¸­<span class="math inline">\(\frac{d{\mathbf{r}}}{ds}\)</span>çå ä½æä¹ï¼å¦åæ®µæç¤ºï¼æ¯å¨ç¹<span class="math inline">\(M\)</span>å¤çä¸ä¸ªåååä½åéï¼æå<span class="math inline">\(s\)</span>å¢å¤§çæ¹åï¼å æ­¤ï¼å®è¡¨ç¤ºå¨ç¹<span class="math inline">\(M\)</span>å¤è´¨ç¹è¿å¨çæ¹åï¼ç°å¨ä»¥<span class="math inline">\(\boldsymbol{\tau}\)</span> è¡¨ç¤ºä¹ï¼èå¼ä¸­ç$$</p>
<p></p><div class="math display">\[\frac{d{\mathbf{r}}}{dt}=v\boldsymbol{\tau} \tag{1.4.33}
\]</div><p></p><p>ç±æ­¤å¯è§ï¼å¯¼ç¢<span class="math inline">\(\frac{d\mathbf{r}}{dt}\)</span> è¡¨ç¤ºåºäºè´¨ç¹<span class="math inline">\(M\)</span>è¿å¨çéåº¦å¤§å°åæ¹åï¼å èå®å°±æ¯è´¨ç¹<span class="math inline">\(M\)</span>è¿å¨çéåº¦ç¢é<span class="math inline">\(\boldsymbol{v}\)</span>  ,å³</p>
<p></p><div class="math display">\[\boldsymbol{v}=\frac{d\mathbf{r}}{dt} \tag{1.4.33}
\]</div><p></p><p>è¥å®ä¹äºé¶å¯¼ç¢<span class="math inline">\(\mathbf{w}\)</span></p>
<p></p><div class="math display">\[\mathbf{w}=\frac{d^2\mathbf{r}}{dt^2}=\frac{d}{dt}\left(\frac{d{\mathbf{r}}}{dt}\right) \tag{1.4.34}
\]</div><p></p><p>å<span class="math inline">\(\mathbf{w}\)</span>ä¸ºè´¨ç¹<span class="math inline">\(\mathbf{M}\)</span>è¿å¨çå éåº¦ç¢éã</p>
<p>â</p>
<h2 id="15-ç¢æ§å½æ°çç§¯å">1.5 ç¢æ§å½æ°çç§¯å</h2>
<p>â         ç¢æ§å½æ°çç§¯ååæ°æ§å½æ°çç§¯åç±»ä¼¼ï¼ä¹æä¸å®ç§¯ååå®ç§¯åä¸¤ç§ï¼ç°å¨åè¿°äºä¸ï¼</p>
<h3 id="151--ç¢æ§å½æ°çä¸å®ç§¯å">1.5.1  ç¢æ§å½æ°çä¸å®ç§¯å</h3>
<p>â         <strong>å®ä¹</strong> è¥å¨<span class="math inline">\(t\)</span>çæä¸ªåºé´<span class="math inline">\(I\)</span>ä¸ï¼æ <span class="math inline">\(\mathbf{B^{'}}(t)=\mathbf{A}(t)\)</span>ï¼åç§°<span class="math inline">\(\mathbf{B}(t)\)</span>ä¸º<span class="math inline">\(\mathbf{A}(t)\)</span>å¨åºé´ä¸çä¸ä¸ª<strong>åå½æ°</strong>ãå¨åºé´<span class="math inline">\(I\)</span>ä¸ï¼<span class="math inline">\(\mathbf{A}(t)\)</span>çåå½æ°å¨ä½ï¼å å<span class="math inline">\(\mathbf{A}(t)\)</span>çåå½æ°çå¨ä½ï¼å«å<span class="math inline">\(\mathbf{A}(t)\)</span>å¨<span class="math inline">\(I\)</span>ä¸çä¸å®ç§¯åï¼è®°ä½</p>
<p></p><div class="math display">\[\int{\mathbf{A}(t)}dt \tag{1.5.1}
\]</div><p></p><p>è¿ä¸ªå®ä¹åæ°æ§å½æ°çä¸å®ç§¯åå®ä¹å®å¨ç±»ä¼¼ãæåæ°æ§å½æ°ä¸æ ·ï¼è¥å·²ç¥<span class="math inline">\(\mathbf{B}(t)\)</span>åæ¯<span class="math inline">\(\mathbf{A}(t)\)</span> çä¸ä¸ªåå½æ°ï¼åæ</p>
<p></p><div class="math display">\[\int{\mathbf{A}(t)}dt=\mathbf{B}(t)+\mathbf{C} \tag{1.5.2}
\]</div><p></p><p>èä¸ï¼æ°æ§å½æ°ä¸å®ç§¯åçåºæ¬æ§è´¨å¯¹ç¢æ§å½æ°æ¥è¯´ä¹ä»ç¶æç«ãä¾å¦ï¼</p>
<p></p><div class="math display">\[\begin{equation}
\int k\mathbf{A}(t)dt=k\int\mathbf{A}(t)dt \tag{1.5.3}
\end{equation}
\]</div><p></p><p></p><div class="math display">\[\begin{equation}
\int [\mathbf{A}(t)+\mathbf{B}(t)]dt=\int\mathbf{A}(t)dt+\int\mathbf{B}(t)dt \tag{1.5.4}
\end{equation}
\]</div><p></p><p></p><div class="math display">\[\begin{equation}
\int u(t)\mathbf{a}dt=\mathbf{a}\int u(t)dt \tag{1.5.5}
\end{equation}
\]</div><p></p><p></p><div class="math display">\[\int\mathbf{a}\cdot\mathbf{A}(t)dt=\mathbf{a}\cdot\int \mathbf{A}(t)dt \tag{1.5.6}
\]</div><p></p><p></p><div class="math display">\[\int \mathbf{a}\times\mathbf{A}(t)dt=\mathbf{a}\times\int\mathbf{A}(t)dt \tag{1.5.7}
\]</div><p></p><p>å¶ä¸­ï¼<span class="math inline">\(k\)</span>ä¸ºéé¶å¸¸æ°ï¼<span class="math inline">\(\mathbf{a}\)</span> ä¸ºéé¶å¸¸ç¢éã</p>
<p>â       æ®æ­¤ï¼è¥å·²ç¥ç¢æ§å½æ°çåéè¡¨è¾¾å¼<span class="math inline">\(\mathbf{A}(t)=A_x(t)\boldsymbol{i}+A_y(t)\boldsymbol{j}+A_z(t)\boldsymbol{k}\)</span> ,æ ¹æ®å¼(1.6.3)åå¼(1.6.4)å¯ç¥ï¼</p>
<p></p><div class="math display">\[\int\mathbf{A}(t)dt=\boldsymbol{i}\int{A_x(t)}dt+\boldsymbol{j}\int{A_y(t)}dt+\boldsymbol{k}\int{A_z(t)}dt \tag{1.5.8}
\]</div><p></p><p>æ­¤å¼ææ±ä¸ä¸ªç¢æ§å½æ°çä¸å®ç§¯åï¼å½çº³ä¸ºæ±ä¸ä¸ªä¸ä¸ªæ°æ§å½æ°çä¸å®ç§¯åã</p>
<p>â      æ­¤å¤ï¼æ°æ§å½æ°çæ¢åç§¯åæ³ä¸åé¨ç§¯åæ³äº¦éç¨äºç¢æ§å½æ°ãä½ç±äºä¸¤ä¸ªç¢éçç¢éç§¯æä»äºè´äº¤æ¢å¾ï¼å³<span class="math inline">\(\mathbf{A}\times\mathbf{B}=-(\mathbf{B}\times\mathbf{A})\)</span>, æå¶åé¨ç§¯åå¬å¼çåºç¨ç«¯åºä¸ºä¸¤é¡¹ç¸å ï¼</p>
<p></p><div class="math display">\[\int\mathbf{A}\times\mathbf{B}^{\prime}dt=\mathbf{A}\times \mathbf{B}+\int \mathbf{B}\times\mathbf{A}^{\prime}dt \tag{1.5.9}
\]</div><p></p><h3 id="152--ç¢æ§å½æ°çå®ç§¯å">1.5.2  ç¢æ§å½æ°çå®ç§¯å</h3>
<p><strong>å®ä¹</strong>   è®¾ç¢æ§å½æ° <span class="math inline">\(\mathbf{A}(t)\)</span>å¨åºé´<span class="math inline">\([T_1,T_2]\)</span> ä¸è¿ç»­ï¼å <span class="math inline">\(\mathbf{A}(t)\)</span>å¨<span class="math inline">\([T_1,T_2]\)</span> ä¸çå®ç§¯åæ¯æä¸é¢å½¢å¼çæéï¼</p>
<p></p><div class="math display">\[\int_{T_1}^{T_2}\mathbf{A}(t)dt=\lim_{\lambda\rightarrow{0}}\sum_{i=1}^{n}\mathbf{A}(\xi_{i})\Delta{t_i} \tag{1.5.10}
\]</div><p></p><p>å¶ä¸­ <span class="math inline">\(T_1=t_0&lt;t_1&lt;t_2&lt;...&lt;t_n=T_2\)</span>ï¼<span class="math inline">\(\xi_i\)</span>ä¸ºåºé´<span class="math inline">\([t_{i-1},t_i]\)</span>ä¸çä¸ç¹ï¼<span class="math inline">\(\Delta{t_i}=t_i-t_{i-1}\)</span>; <span class="math inline">\(\lambda=max{\Delta{t_i}}\)</span>,<span class="math inline">\(i=1,2,3,...,n\)</span>ã</p>
<p>â       å¯ä»¥çåºï¼ç¢æ§å½æ°çå®ç§¯åæ¦å¿µä¹åæ°æ§å½æ°çå®ç§¯åå®å¨ç±»ä¼¼ãå æ­¤ï¼ä¹å·æåæ°æ§å½æ°çå®ç§¯åç¸åºçåºæ¬æ§è´¨ï¼ä¾å¦ï¼</p>
<p></p><div class="math display">\[\int_{T_1}^{T_2}\mathbf{A}(t)dt=\mathbf{B}(T_2)-\mathbf{B}(T_1) \tag{1.5.11}
\]</div><p></p><p>å¶ä»æ§è´¨å°±ä¸ä¸ä¸åä¸¾äºã</p>
<p>â       æ­¤å¤ï¼ç±»ä¼¼äºï¼1.6.11ï¼å¼ï¼æ±ç¢æ§å½æ°çå®ç§¯åä¹å¯ä»¥å½çº³äºæ±ä¸ä¸ªæ°æ§å½æ°çå®ç§¯åï¼æ¢æï¼</p>
<p></p><div class="math display">\[\int_{T_1}^{T_2}\mathbf{A}(t)dt=\boldsymbol{i}\int_{T_1}^{T_2}A_x(t)dt+\boldsymbol{j}\int_{T_1}^{T_2}A_y(t)dt+\boldsymbol{k}\int_{T_1}^{T_2}A_z(t)dt \tag{1.5.12}
\]</div><p></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-04 11:10">2026-01-04 11:10</span>&nbsp;
<a href="https://www.cnblogs.com/GeophysicsWorker">GeoFXR</a>&nbsp;
éè¯»(<span id="post_view_count">23</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19436590);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19436590', targetLink: 'https://www.cnblogs.com/GeophysicsWorker/p/19436590', title: 'åºè®ºç¬è®°ï¼ä¸ï¼ç¢éåæåºç¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ jsä¸­workerçè¯¦ç»è®²è§£ ]]></title>
    <link>https://www.cnblogs.com/IwishIcould/p/19377799</link>
    <guid>66c21522d788fa0f0b50741202cd8f7e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/IwishIcould/p/19377799" title="åå¸äº 2026-01-04 09:03">
    <span role="heading" aria-level="2">jsä¸­workerçè¯¦ç»è®²è§£</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h4 id="ä»ä¹æ¯-javascript-worker">ä»ä¹æ¯ JavaScript Workerï¼</h4>
<p>Worker æ¯å¨Webåºç¨ç¨åºä¸­å®ç°å¤çº¿ç¨çæºå¶ã<br>
å®å¯ä»¥å¨ä¸ä¸ªåç¬ççº¿ç¨ä¸­è¿è¡èæ¬ï¼ç¬ç«äºä¸»çº¿ç¨ã<br>
è¿æ ·ï¼æä»¬å¯ä»¥å°ä¸äºèæ¶çè®¡ç®ä»»å¡äº¤ç»Workerçº¿ç¨å¤çã<br>
ä»¥ä¿è¯ä¸»çº¿ç¨çä¸ä¼è¢«é»å¡ã</p>
<h4 id="ä¸ºä»ä¹éè¦worker">ä¸ºä»ä¹éè¦Workerï¼</h4>
<p>ç±äºJavaScriptæ¯åçº¿ç¨çï¼ææä»»å¡å¨ä¸ä¸ªçº¿ç¨ä¸æ§è¡ã<br>
å¦æéå°ä¸ä¸ªèæ¶çä»»å¡ï¼æ¯å¦å¤§è§æ¨¡æ°æ®è®¡ç®ãå¾åå¤çãå¤æç®æ³ï¼ã<br>
å®ä¼é»å¡ä¸»çº¿ç¨å¯¼è´é¡µé¢æ æ³ååºï¼ç¨æ·ä½éªåå·®ã<br>
Workerçåºç°å°±æ¯ä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼å°èæ¶çè®¡ç®ä»»å¡æ¾å°åå°çº¿ç¨å»æ§è¡ã</p>
<h3 id="vue2ä¸­å¦ä½ä½¿ç¨-worker">vue2ä¸­å¦ä½ä½¿ç¨ worker</h3>
<p>å¨vue/clièææ¶ä¸­ï¼æä»¬æ æ³ç´æ¥ä½¿ç¨workerã<br>
å ä¸ºï¼<br>
1ï¼æ æ³å° Worker èæ¬æåä¸ºç¬ç«çå¯å è½½æä»¶ã<br>
2ï¼æååä¼å¯¼è´ä¾èµä¸¢å¤±æè·¯å¾éè¯¯ã</p>
<pre><code>npm install worker-loader -D
æè
yarn add worker-loader -D
</code></pre>
<h4 id="vueconfigjs-éç½®å¦ä¸">vue.config.js éç½®å¦ä¸</h4>
<pre><code>module.exports = {
  chainWebpack:config=&gt;{
    // ä¸é¢æ¯workerçéç½®
    .rule('worker')
    .test(/\.worker\.js$/)
    .use('worker-loader')
    .loader('worker-loader')
    .end();

    // è§£å³ï¼worker ç­æ´æ°é®é¢
    config.module.rule('js').exclude.add(/\.worker\.js$/);
  },
  parallel: false,
  chainWebpack: config =&gt; {
    // è§£å³ï¼âwindow is undefinedâæ¥éï¼è¿ä¸ªæ¯å ä¸ºworkerçº¿ç¨ä¸­ä¸å­å¨windowå¯¹è±¡ï¼å æ­¤ä¸è½ç´æ¥ä½¿ç¨ï¼è¦ç¨thisä»£æ¿
    config.output.globalObject('this')
  }
}
</code></pre>
<h4 id="postmessage-å­çº¿ç¨ç»ä¸»çº¿åéæ¶æ¯">postMessage å­çº¿ç¨ç»ä¸»çº¿åéæ¶æ¯</h4>
<p>self.postMessageå­çº¿ç¨åä¸»çº¿ç¨åéæ¶æ¯ã<br>
å¨ Web Worker ä¸­ï¼self æåå½ååå»ºçè¿ä¸ª worker çº¿ç¨ï¼self æ¯ä¸ä¸ªå¨å±å¯¹è±¡ã<br>
self.postMessage()å°æ°æ®ä» worker çº¿ç¨åéå°åå»ºå®çä¸»çº¿ç¨ã</p>
<h4 id="ä¸»çº¿ç¨éç¥å­çº¿ç¨workerå¼å§å·¥ä½">ä¸»çº¿ç¨éç¥å­çº¿ç¨(worker)å¼å§å·¥ä½</h4>
<pre><code>// åå»º worker
this.webWorker = new Worker('./web.worker.js')
// éç¥ Worker å­çº¿ç¨å¯ä»¥è¿è¡ååºçå·¥ä½ã
// ä¸»çº¿ç¨è°ç¨worker.postMessage()æ¹æ³ï¼å Worker åæ¶æ¯
this.webWorker.postMessage({ action: 'startFetch' });
</code></pre>
<h4 id="worker-ä¸­æ¥åéç½ç»è¯·æ±å">worker ä¸­æ¥åéç½ç»è¯·æ±å</h4>
<p>src\views\element.vue æä»¶</p>
<pre><code>&lt;template&gt;
  &lt;div class="page"&gt;
    &lt;h1&gt;ä½¿ç¨workeræ¥ååéç½ç»è¯·æ±&lt;/h1&gt;
    &lt;el-button @click="sendFetchHandler"&gt;å¼å§åéç½ç»è¯·æ±&lt;/el-button&gt;

    &lt;ul&gt;
      &lt;li v-for="(item,index) in apiBackData" :key="index"&gt;{{ item.title }}&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
// å¯¼å¥ worker æä»¶, å¿é¡»ä½¿ç¨ è¿æ ·çæ¹å¼å¼å¥
import WorkerA from 'worker-loader!./web.worker.js'
export default {
  data() {
    return {
      apiBackData: []
    }
  },
  methods: {
    sendFetchHandler(){
      // ä¸»çº¿ç¨è°ç¨worker.postMessage()æ¹æ³ï¼å Workerçº¿ç¨ åæ¶æ¯,å¼å§è¿è¡ç½ç»è¯·æ±
      this.webWorker1.postMessage({ action: 'startFetch' });
    }
  },
  created() {
    // åå»º worker å®ä¾ï¼åç§°å¿é¡»åå¯¼å¥æ¶çä¿æä¸è´
    this.webWorker1 = new WorkerA('./web.worker.js')
    // åæ·»å äºä»¶çå¬å¨
    this.webWorker1.addEventListener('message', (e) =&gt; {
      // e.data æ¯æ¥æ¶å°çæ°æ®
      console.log('æ¶å°æ¥èª Worker çæ¶æ¯:', e.data)
      // å¤ç Worker è¿åçæ°æ®
      if (e.data.type === 'fetchSuccess') {
        this.apiBackData = e.data.data.data || []
        console.log('è·åçæ°æ®:',  this.apiBackData );
      } else if (e.data.type === 'fetchError') {
        console.log('è·åæ°æ®å¤±è´¥:', e.data.error);
      }
    })

    this.webWorker1.addEventListener('error', (error) =&gt; {
      console.error('Workeråçéè¯¯:', error)
    })
  }
}
&lt;/script&gt;
</code></pre>
<pre><code>// å¼å¥ç½ç»è¯·æ±ä¸­çæ¹æ³
import {getList} from '@/request/api.js'

self.onmessage = function(e) {
  console.log("worker:", e)
  if(e.data &amp;&amp; e.data.action==='startFetch'){
    //  e.dataæ¯ä¸»çº¿ç¨åéè¿æ¥çæ°æ®
    getList().then(res=&gt;{
      console.log(1111,res)
      // åè®¾ æ¯ä¸ä¸ªæ°ç»å°±æ¯è¯·æ±æå
      if(Array.isArray(res)){
        //å°æ°æ®ä» worker çº¿ç¨åéå°åå»ºå®çä¸»çº¿ç¨
        self.postMessage({ 
          type: 'fetchSuccess',
          data:{
            data:res,
            message: 'è·åæå'
          }
        });
      }else{
        // å°æ°æ®ä» worker çº¿ç¨åéå°åå»ºå®çä¸»çº¿ç¨
        self.postMessage({ type: 'fetchError', error: 'è¯·æ±å¤±è´¥' });
      }
    })
  }
};
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1425695/202512/1425695-20251221111952362-1403369349.png" alt="image" loading="lazy"></p>
<h4 id="workerå¯¼åºè¡¨æ ¼æ¡ä¾">workerå¯¼åºè¡¨æ ¼æ¡ä¾</h4>
<pre><code>&lt;template&gt;
  &lt;div class="page"&gt;
    &lt;input type="text"&gt;
    &lt;br/&gt;
    &lt;el-button @click="exportExcelHandler"&gt;å¯¼åºexcel&lt;/el-button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import {writeFile, utils} from 'xlsx'
export default {
  data() {
    return {
      
    }
  },
  methods: {
    exportExcelHandler(){
      let arr = []
      // 50wè¡çæ°æ®
      for(let i= 0; i&lt;500000;i++){
        arr.push({
          name: 'å¼ ' + i,
          age: 18,
          sex: 'ç·',
          id: '2025_12_12'+ i,
          address:'XXåºYYYå¤§é' + i + 'å·'
        })
      }
      // å°å¯¹è±¡æ°ç» arr è½¬æ¢ä¸º Excel å·¥ä½è¡¨(sheet)
      const sheet  = utils.json_to_sheet(arr)
      // åå»ºä¸ä¸ªæ°çç©ºå·¥ä½ç°¿å¯¹è±¡ã
      // å·¥ä½ç°¿æ¯ Excel æä»¶çå®¹å¨ï¼å¯ä»¥åå«å¤ä¸ªå·¥ä½è¡¨
      const workbook = utils.book_new()
      // å°ä¹ååå»ºçå·¥ä½è¡¨ sheet æ·»å å°å·¥ä½ç°¿ workbook ä¸­
      utils.book_append_sheet(workbook, sheet, 'sheet1')
      console.log('workbook', workbook)
      // å°æ´ä¸ªå·¥ä½ç°¿ workbook åå¥æä»¶å¹¶è§¦åæµè§å¨ä¸è½½
      writeFile(workbook, 'test.xlsx')
      // ä¸»çº¿ç¨è°ç¨worker.postMessage()æ¹æ³ï¼å Workerçº¿ç¨ åæ¶æ¯,å¼å§è¿è¡ç½ç»è¯·æ±
      // this.webWorker1.postMessage({ action: 'startFetch', data: this.vueData });
    }
  }
}
&lt;/script&gt;
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1425695/202512/1425695-20251221175954856-1704295092.png" alt="image" loading="lazy"></p>
<h4 id="ç°å¨æä»¬ä½¿ç¨workeræ¥è§£å³æ·»å æ°æ®èæ¶çé®é¢">ç°å¨æä»¬ä½¿ç¨workeræ¥è§£å³æ·»å æ°æ®èæ¶çé®é¢</h4>
<p>ä¸è½½xlsxæ¨¡åã</p>
<pre><code>npm install --save xlsx
</code></pre>
<p>ä½¿ç¨workerçæä»¶(ä¸è½½çä¸»é¡µé¢)</p>
<pre><code>&lt;template&gt;
  &lt;div class="page"&gt;
    &lt;input type="text"&gt;
    &lt;br/&gt;
    &lt;el-button @click="exportExcelHandler"&gt;å¯¼åºexcel&lt;/el-button&gt;

  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
// å¯¼å¥ worker æä»¶, å¿é¡»ä½¿ç¨ è¿æ ·çæ¹å¼å¼å¥
import WorkerA from 'worker-loader!./web.worker.js'
import {writeFile} from 'xlsx'
export default {
  data() {
    return {
      
    }
  },
  methods: {
    exportExcelHandler(){
      // ä¸»çº¿ç¨è°ç¨worker.postMessage()æ¹æ³ï¼å Workerçº¿ç¨ åæ¶æ¯,å¼å§è¿è¡æé æ°æ®
      this.webWorker1.postMessage({ action: 'startCreateExcelData'});
    }
  },
  created() {
    // åå»º worker å®ä¾ï¼åç§°å¿é¡»åå¯¼å¥æ¶çä¿æä¸è´
    this.webWorker1 = new WorkerA('./web.worker.js')
    // åæ·»å äºä»¶çå¬å¨
    this.webWorker1.addEventListener('message', (e) =&gt; {
      console.log('æ¶å°æ¥èª Worker çæ¶æ¯:', e.data)
      // å¤ç Worker è¿åçæ°æ®
      if (e.data.type === 'createExcelSuccess') {
        // è¿åè¡¨çæ°æ®
        const workbook = e.data.data.data
        // å°æ´ä¸ªå·¥ä½ç°¿ workbook åå¥æä»¶å¹¶è§¦åæµè§å¨ä¸è½½ã
        // æåå¼æ­¥ä»ç¶ä¼å¡é¡¿,å ä¸ºæ°æ®éå¤ªå¤§äº.ä½æ¯å¡é¡¿çæ¶é´ä¼æ¯ä¹åå¥½ä¸äº
        writeFile(workbook, 'éè¿workerå¯¼å¤excel.xlsx')
      } else  {
        console.log('è·åæ°æ®å¤±è´¥:', e.data.error);
      }
    })

    this.webWorker1.addEventListener('error', (error) =&gt; {
      console.error('Workeråçéè¯¯:', error)
    })
  }
}
&lt;/script&gt;
</code></pre>
<p>workeræä»¶(src\views\web.worker.js )</p>
<pre><code>// å¼å¥ xlsx
import {utils} from 'xlsx'
self.onmessage = function(e) {
  console.log("worker:", e)
  if(e.data &amp;&amp; e.data.action==='startCreateExcelData'){
    //  e.dataæ¯ä¸»çº¿ç¨åéè¿æ¥çæ°æ®
    let arr = []
    // 50wè¡çæ°æ®
    for(let i= 0; i&lt;500000;i++){
      arr.push({
        name: 'å¼ ' + i,
        age: 18,
        sex: 'ç·',
        id: '2025_12_12'+ i,
        address:'XXåºYYYå¤§é' + i + 'å·'
      })
    }
    // å°å¯¹è±¡æ°ç» arr è½¬æ¢ä¸º Excel å·¥ä½è¡¨(sheet)
    const sheet  = utils.json_to_sheet(arr)
    // åå»ºä¸ä¸ªæ°çç©ºå·¥ä½ç°¿(book)å¯¹è±¡ãå·¥ä½ç°¿æ¯ Excel æä»¶çå®¹å¨ï¼å¯ä»¥åå«å¤ä¸ªå·¥ä½è¡¨(sheet)
    const workbook = utils.book_new()
    // å°ä¹ååå»ºçå·¥ä½è¡¨ (sheet) æ·»å å°å·¥ä½ç°¿(workbook)ä¸­
    utils.book_append_sheet(workbook, sheet, 'sheet1')
    self.postMessage({ 
      type: 'createExcelSuccess',
      data:{
        data:workbook,
        message: 'è·åæå'
      }
    });
  }
};
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1425695/202512/1425695-20251223192441700-1399729196.png" alt="image" loading="lazy"></p>
<h4 id="å³é­-web-worker">å³é­ Web Worker</h4>
<p>å¨ä¸»çº¿ç¨åå¨Workerçº¿ç¨çå³é­æ¹å¼æ¯ä¸ä¸æ ·çã<br>
å¦æå¨ä¸»çº¿ç¨ï¼è°ç¨terminate()æ¹æ³å³é­</p>
<pre><code>this.webWorker1 = new WorkerA('./web.worker.js') 
this.webWorker1.terminate();
</code></pre>
<p>å¦ææ¯å¨Workçº¿ç¨ï¼å¯ä»¥è°ç¨close()æ¹æ³è¿è¡å³é­</p>
<pre><code>self.close();
</code></pre>
<h4 id="ä¸»çº¿ç¨å³é­-worker-çº¿ç¨çè¯´æ">ä¸»çº¿ç¨å³é­ worker çº¿ç¨çè¯´æ</h4>
<p>å½ä¸»çº¿ç¨è°ç¨worker.terminate()æ¶ï¼Workerçº¿ç¨ä¼è¢«ç«å³ç»æ­¢ã<br>
æ è®ºå½åäºä»¶å¾ªç¯ä¸­æ¯å¦æä»»å¡ï¼åæ¬å¾®ä»»å¡åå®ä»»å¡ï¼é½ä¸ä¼ç»§ç»­æ§è¡ã<br>
ä¹å°±æ¯è¯´ï¼å¦ææå¨ç¹å»[å¯¼å¥excel]æé®åï¼é©¬ä¸åå³é­ç¹å»[å³é­worker]ï¼é£ä¹ä¸è½å¤æ­£å¸¸å¯¼åºè¡¨æ ¼ã<br>
<img src="https://img2024.cnblogs.com/blog/1425695/202512/1425695-20251223192230075-108196709.png" alt="image" loading="lazy"></p>
<h4 id="workerçº¿ç¨åé¨å³é­-worker-çº¿ç¨çè¯´æ">Workerçº¿ç¨åé¨å³é­ worker çº¿ç¨çè¯´æ</h4>
<p>å½Workerçº¿ç¨åé¨è°ç¨self.close()æ¶ï¼Workerçº¿ç¨å¹¶ä¸ä¼ç«å³ç»æ­¢ã<br>
å®ä¼[ç»§ç»­æ§è¡å½å]äºä»¶å¾ªç¯ä¸­çä»»å¡ï¼ä½æ¯[ä¼é»æ­¢åç»­]äºä»¶å¾ªç¯çä»»å¡æ§è¡ã<br>
ä¹å°±æ¯è¯´ï¼å¦ææå¨ç¹å»[å¯¼å¥excel]æé®åï¼é©¬ä¸åå³é­ç¹å»[Workeråé¨å³é­Worker]ï¼ä»ç¶å¯ä»¥å¯¼åºè¡¨æ ¼ã<br>
<img src="https://img2024.cnblogs.com/blog/1425695/202512/1425695-20251223193947537-1923756412.png" alt="image" loading="lazy"></p>
<h4 id="å¤æ­ç¨æ·æµè§å¨æ¯å¦æ¯æ-worker">å¤æ­ç¨æ·æµè§å¨æ¯å¦æ¯æ worker</h4>
<pre><code>if (typeof Worker !== 'undefined') {
  console.log('æµè§å¨æ¯æ Web Workers');
} else {
  console.log('æµè§å¨ä¸æ¯æ Web Workers');
}
</code></pre>
<h4 id="worker-çº¿ç¨å¼ç¨å¶ä»jsæä»¶">Worker çº¿ç¨å¼ç¨å¶ä»jsæä»¶</h4>
<p>æäºæ¶åï¼æä»¬éè¦å¨workeræä»¶ä¸­ï¼å¼å¥å¶ä»æ¨¡åçæä»¶ã<br>
å¯ä»¥éè¿ importScripts() æ¹æ³æ¥å®ç°ï¼å¨ worker ä¸­å¯¼å¥å¶ä»çæ¨¡åãè¿ä¸ªå°åæ¯å¯ä»¥è·¨åçã</p>
<h4 id="worker-æå®æ¨¡åç±»å">Worker æå®æ¨¡åç±»å</h4>
<p>å¦ææä»¬åç°æä»¬éè¦å¯¼åºçæ¹æ³ä½¿ç¨çæ¯ESModule æ¨¡å¼å¯¼åºã<br>
æ­¤æ¶ä½¿ç¨ importScripts() æ¹æ³å¼å¥ä»æ¨¡åï¼ä¼æ¥éã<br>
æ­¤æ¶éè¦æå®æ¨¡åç±»åã</p>
<pre><code>// main.jsï¼ä¸»çº¿ç¨çä»£ç ï¼
const worker = new Worker('/worker.js', {
    type: 'module'  // æå® worker.js çç±»å
});
</code></pre>
<pre><code>// worker.jsï¼workerçº¿ç¨çä»£ç ï¼
import add from './utils.js'; // å¯¼å¥å¤é¨js

self.addEventListener('message', e =&gt; { 
    postMessage(e.data);
});

add(1, 2);
</code></pre>
<pre><code>// utils.js ä½¿ç¨äºESModule æ¨¡åå¯¼åºç add æ¹æ³
export default add = (a, b) =&gt; a + b;
</code></pre>
<h4 id="ä½¿ç¨workerçæ³¨æäºé¡¹">ä½¿ç¨workerçæ³¨æäºé¡¹</h4>
<p>1ï¼workerä¸è½ä½¿ç¨windowä¸çdomæä½ï¼ä¹ä¸è½è·ådomå¯¹è±¡,domç¸å³çä¸è¥¿åªæä¸»çº¿ç¨æãworkeråªè½åä¸äºè®¡ç®ç¸å³çæä½<br>
2ï¼æçä¸è¥¿æ¯æ æ³éè¿ä¸»çº¿ç¨ä¼ éä¸ªå­çº¿ç¨çã<br>
æ¯å¦ï¼æ¹æ³ï¼domèç¹ï¼ä¸äºå¯¹è±¡éçç¹æ®è®¾ç½®(freeze,getter,setterè¿äº)æä»¥vueçååºå¼å¯¹è±¡å¨ä¼ éä¹åå°±ä¼åææ®éå¯¹è±¡</p>
<h4 id="workerå®éåºç¨æ¡ä¾">workerå®éåºç¨æ¡ä¾</h4>
<p>1ï¼å°è¯­æ³æ£æ¥ãä»£ç åç¼©ç­ä»»å¡æ¾å¨ Worker ä¸­æ§è¡<br>
2ï¼å¾åå¤çï¼æ¯å¦ä½¿ç¨Canvaså¤çå¾çï¼è¿è¡æ»¤é</p>
<h4 id="workeræ§è½ä¼åå»ºè®®">workeræ§è½ä¼åå»ºè®®</h4>
<p>åå°éä¿¡å¼éï¼é¿åé¢ç¹ä¼ éå¤§éæ°æ®ï¼å¿è¦æ¶ä½¿ç¨ Transferable Objectsï¼å¦ ArrayBufferï¼<br>
æ¹éå¤çï¼å¯¹äºå¤§æ¹éä»»å¡ï¼å¯æ¹éåå»º Worker å¹¶è¡å¤ç<br>
å¸¸é©»çº¿ç¨ï¼å¯¹äºé¢ç¹ä½¿ç¨ç Workerï¼å¯ä¿æå¸¸é©»èééå¤åå»º<br>
éè¯¯å¤çï¼å§ç»çå¬ onerror äºä»¶ï¼æè· Worker åé¨çå¼å¸¸</p>

</div>
<div id="MySignature" role="contentinfo">
    <div style="width:818px;background:#f5f5f5; padding: 10px 10px 10px 10px; border: 1px dashed rgb(224, 224, 224); font-family: å¾®è½¯éé»; font-size: 13px;">
            <h1 style="font-size: 24px;"> éè§é®é¢ï¼è¿æ¯ä½ æé¿çæºä¼ï¼å¦æä½ è½å¤è§£å³ï¼è¿å°±æ¯æ¶è·ã </h1>
		    <div style="padding:10px">
		        ä½èï¼<a href="https://www.cnblogs.com/IwishIcould/" target="_blank">ææ¥åé£æç¸è¯</a> <br>
		        åºå¤ï¼<a href="https://www.cnblogs.com/IwishIcould/">https://www.cnblogs.com/IwishIcould/</a> <br>
                        <p> æ³é®é®é¢ï¼æèµäºåå¾®çåä¸»ï¼æ±æ±ä½ å¤æ³¨ä¸ä¸çæ£æ£æèå¾®ä¿¡ï¼è¿æ ·æå¥½èç³»ä½ ï¼(ã£â¢ÌÏâ¢Ì)ã£ââ¾â¾ï¼</p>
		        <p>å¦æè§å¾è¿ç¯æç« å¯¹ä½ æå°å°çå¸®å©çè¯ï¼è®°å¾å¨å³ä¸è§ç¹ä¸ªâæ¨èâå¦ï¼æèå³æ³¨åä¸»ï¼å¨æ­¤æè°¢ï¼</p>
		        <p> ä¸æ°´åå±±æ»æ¯æï¼æèµ5æ¯ä¹°è¾£æ¡è¡ä¸è¡ï¼æä»¥å¦æä½ å¿æè¿æ¯è¾é«å´ï¼ä¹æ¯å¯ä»¥æ«ç æèµåä¸»(ã£â¢ÌÏâ¢Ì)ã£ââ¾â¾ï¼</p>
                        <p> æ³é®é®é¢ï¼æèµäºåå¾®çåä¸»ï¼æ±æ±ä½ å¤æ³¨ä¸ä¸çæ£æ£æèå¾®ä¿¡ï¼è¿æ ·æå¥½èç³»ä½ ï¼(ã£â¢ÌÏâ¢Ì)ã£ââ¾â¾ï¼</p>
				<div style="display: flex;">
					<div style="margin-right: 100px;text-align: center;">
						<img src="//images.cnblogs.com/cnblogs_com/IwishIcould/1900124/t_201214043958æ¯ä»å®æ¶æ¬¾ç .jpg?a=1607924145179">
						<div>
							æ¯ä»å®
						</div>
					</div>
					<div style="text-align: center;">
						<img src="//images.cnblogs.com/cnblogs_com/IwishIcould/1900124/t_20121604194271E6E296CCB71A007F4E22073D5EB64A.jpg">
						<div>å¾®ä¿¡</div>
					</div>
				</div>
		        æ¬æçæå½ä½èææï¼æ¬¢è¿è½¬è½½ï¼æªç»ä½èåæé¡»ä¿çæ­¤æ®µå£°æï¼å¨æç« é¡µé¢ææ¾ä½ç½®ç»åºåæè¿æ¥ <br>
		        å¦ææä¸­æä»ä¹éè¯¯ï¼æ¬¢è¿æåºãä»¥åæ´å¤çäººè¢«è¯¯å¯¼ã <br>
               
		    </div>
           
            
		</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-04 09:04">2026-01-04 09:03</span>&nbsp;
<a href="https://www.cnblogs.com/IwishIcould">åé£ææ¥æç¸è¯</a>&nbsp;
éè¯»(<span id="post_view_count">73</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19377799);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19377799', targetLink: 'https://www.cnblogs.com/IwishIcould/p/19377799', title: 'jsä¸­workerçè¯¦ç»è®²è§£' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ 7 ä¸ªä»å¥é¨å°èµæ·± PHP å¼åèé½å¨ç¨çæ ¸å¿è°è¯æè½ ]]></title>
    <link>https://www.cnblogs.com/catchadmin/p/19435596</link>
    <guid>61b8bf924d4c81149650c46e9b4f0122</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/catchadmin/p/19435596" title="åå¸äº 2026-01-04 08:01">
    <span role="heading" aria-level="2">7 ä¸ªä»å¥é¨å°èµæ·± PHP å¼åèé½å¨ç¨çæ ¸å¿è°è¯æè½</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="7-ä¸ªä»å¥é¨å°èµæ·±-php-å¼åèé½å¨ç¨çæ ¸å¿è°è¯æè½">7 ä¸ªä»å¥é¨å°èµæ·± PHP å¼åèé½å¨ç¨çæ ¸å¿è°è¯æè½</h1>
<h2 id="è°è¯çæ®é·çç¸">è°è¯çæ®é·çç¸</h2>
<p>å¤§å¤æ° PHP bug é¾æï¼ä¸æ¯å ä¸ºå®ä»¬"å¤æ"ï¼èæ¯å ä¸ºå®ä»¬<strong>çä¸è§</strong>ã</p>
<p>åéå¨æ¯ä½ é¢ææ©ä¸¤å±çå°æ¹å°±åæäº nullãä¸ä¸ª"ä¸å¯è½åç"çæ¡ä»¶åååªå¨çäº§ç¯å¢åçãè¯·æ±å¨æ¬å°æ­£å¸¸ï¼æ¾å°ä»£çåé¢å°±æäºãéå worker çè¡ä¸ºå HTTP è¿è¡æ¶ä¸ä¸æ ·ãè¿æç»å¸åºæ¯ï¼ä½ ä¿®å¥½äºâ¦â¦ä¸å¨å®ååæ¥äºã</p>
<p>æ³å¿«éæé¿ä¸º PHP å¼åèï¼å«æ¥çå­¦æ´å¤æ¡æ¶ç¹æ§ãåå­¦ä¼<strong>è§å¯ç³»ç»å®éå¨åä»ä¹</strong>ã</p>
<p>ä¸é¢æ¯æè®¤ä¸ºæ¯ä¸ª PHP å¼åèä»ç¬¬ä¸å¤©å°±è¯¥ææ¡ç 7 ä¸ªè°è¯æè½ãå®ä»¬ä¸æ¯è±æï¼èæ¯ä¼æç»­äº§çå¤å©çä¹ æ¯ã</p>
<p><a href="https://catchadmin.com/post/2026-01/debugging-php-like-a-pro" target="_blank" rel="noopener nofollow">åæ 7 ä¸ªä»å¥é¨å°èµæ·± PHP å¼åèé½å¨ç¨çæ ¸å¿è°è¯æè½</a></p>
<h2 id="éè¯¯è¦çå¾è§ä½å«æ´é²ç»ç¨æ·">éè¯¯è¦çå¾è§ï¼ä½å«æ´é²ç»ç¨æ·</h2>
<p>çä¸å°éè¯¯ï¼ä½ å°±ä¸æ¯å¨è°è¯ââä½ æ¯å¨çã</p>
<p>PHP æä¾äºå¯é çéè¯¯å¯è§æ§åè¯­ï¼<code>error_reporting</code>ã<code>display_errors</code> åæ¥å¿è®¾ç½®ãå³é®æ¯æå¼åç¯å¢åçäº§ç¯å¢å½ä½ä¸åçå¯è§æµæ¨¡å¼æ¥å¯¹å¾ã</p>
<p>PHP å®æ¹æåå¼ºçå»ºè®®å¨çäº§ç½ç«ä¸è®°å½éè¯¯èéæ¾ç¤ºéè¯¯ã</p>
<h3 id="å¼åç¯å¢å¨å¼">å¼åç¯å¢ï¼å¨å¼</h3>
<p>å¨å¼åç¯å¢ï¼ä½ éè¦æå¤§åçä¿¡å·ï¼</p>
<pre><code class="language-ini">; php.ini (development)
error_reporting = -1
display_errors = On
display_startup_errors = On
log_errors = On
</code></pre>
<p>å¦æä½ ç¨ Docker æå¼åå®¹å¨ï¼ç¡®è®¤å®¹å¨åé¨çè®¾ç½®ï¼</p>
<pre><code class="language-bash">php -i | grep -E "error_reporting|display_errors|log_errors"
</code></pre>
<h3 id="çäº§ç¯å¢åªè®°å½ä¸æ¾ç¤º">çäº§ç¯å¢ï¼åªè®°å½ï¼ä¸æ¾ç¤º</h3>
<p>å¨çäº§ç¯å¢ï¼<code>display_errors=On</code> ä¸æ¯"æå¸®å©"ï¼èæ¯æ¼æ´ãä½ è¦çæ¯æ¥å¿ï¼ä¸æ¯æ³é²çå æ è·è¸ªã</p>
<pre><code class="language-ini">; php.ini (production)
error_reporting = -1
display_errors = Off
display_startup_errors = Off
log_errors = On
error_log = /var/log/php/app-error.log
</code></pre>
<p>ç¶åå¨æéæé´ tail æ¥å¿ï¼</p>
<pre><code class="language-bash">tail -f /var/log/php/app-error.log
</code></pre>
<h3 id="å¼å¸¸æ¥å¿è¦å¸¦ä¸ä¸æ">å¼å¸¸æ¥å¿è¦å¸¦ä¸ä¸æ</h3>
<p>å«å®å¨ä¾èµ PHP é»è®¤çéè¯¯æ¥å¿æ ¼å¼ãå¨åºç¨å¯å¨æ¶æ·»å ä¸ä¸ªé¡¶å±å¼å¸¸å¤çå¨ï¼æ¡æ¶æ å³ï¼ï¼</p>
<pre><code class="language-php">&lt;?php
declare(strict_types=1);

set_exception_handler(function (Throwable $e) {
    error_log(json_encode([
        'level' =&gt; 'error',
        'event' =&gt; 'uncaught_exception',
        'message' =&gt; $e-&gt;getMessage(),
        'type' =&gt; $e::class,
        'file' =&gt; $e-&gt;getFile(),
        'line' =&gt; $e-&gt;getLine(),
        'trace' =&gt; explode("\n", $e-&gt;getTraceAsString()),
    ], JSON_UNESCAPED_SLASHES));
});
</code></pre>
<p>è¿æ¯"ç©·äººçç»æåæ¥å¿"ï¼ä½å·²ç»æ¯ç»å¸ç"å´©äºï¼ä¸ç¥éä¸ºå¥"å¼ºå¤äºã</p>
<p><strong>æè½æ£éª</strong>ï¼å¦ææäººç»ä½ ä¸å¼ çäº§ç¯å¢çéè¯¯æªå¾ï¼ä½ åºè¯¥è½è¯´ï¼"å³æé£ä¸ªãæ¾å°æ¥å¿éãå ä¸å³è IDãç¶åå¤ç°ã"</p>
<h2 id="xdebug-æ­¥è¿è°è¯å«åççäº">Xdebug æ­¥è¿è°è¯ï¼å«åççäº</h2>
<p><code>var_dump()</code> å¨æ¢ç´¢æ¶è¿è¡ãæ­¥è¿è°è¯ææ¯ä½ è®¤çææ¥æ¶ç¨çå·¥å·ã</p>
<p>Xdebug çæ­¥è¿è°è¯å¨è®©ä½ å¯ä»¥éæ­¥æ§è¡ä»£ç å¹¶äº¤äºå¼å°æ£æ¥ç¶æã</p>
<h3 id="çè§£å®è½å¹²ä»ä¹">çè§£å®è½å¹²ä»ä¹</h3>
<p>æ­¥è¿è°è¯åç­çé®é¢ï¼</p>
<ul>
<li>ä»£ç å®éèµ°äºåªæ¡è·¯å¾ï¼</li>
<li>è¿éçå¼æ¯ä»ä¹ï¼ä¸æ¯ä½ èå­éæ³çé£ä¸ªï¼</li>
<li>ä¸ºä»ä¹è¿ä¸ªåæ¯è¢«æ§è¡äºï¼</li>
<li>æ¯ä»ä¹ä¿®æ¹äºè¿ä¸ªåéï¼</li>
</ul>
<h3 id="xdebug-3-æå°éç½®">Xdebug 3 æå°éç½®</h3>
<p>Xdebug æå¤ç§æ¨¡å¼åç°ä»£åçéç½®æ¹å¼ãå®æ¹ææ¡£è¦çäºæ­¥è¿è°è¯åææè®¾ç½®ã</p>
<p>å¨å¤§å¤æ°ç¯å¢ä¸­ï¼å¯ä»¥è¿æ ·éç½®ï¼</p>
<pre><code class="language-ini">; xdebug.ini
xdebug.mode = debug
xdebug.start_with_request = yes
xdebug.client_port = 9003
</code></pre>
<p>ä¸ºä»ä¹æ¯ 9003ï¼Xdebug 3 æ¹äºé»è®¤ç«¯å£ï¼è¿æ¯"è¿ä¸ä¸"é®é¢çå¸¸è§åå ï¼ãIDE ææ¡£åç¤¾åºç­æ¡éå¸¸æ 9003 ä½ä¸º Xdebug 3 çé»è®¤ç«¯å£ã</p>
<h3 id="å±äº«ç¯å¢å«å¸¸å¼è°è¯">å±äº«ç¯å¢å«å¸¸å¼è°è¯</h3>
<p>æ´å¥½çä¹ æ¯æ¯"éè¦æ¶æè°è¯"ãè¿æ ·è½ä¿ææ§è½ç¨³å®ï¼é¿åæå¤æ´é²è°è¯è¡ä¸ºã</p>
<p>å°½éç¨ç¯å¢åéï¼</p>
<pre><code class="language-bash">XDEBUG_MODE=debug php -S localhost:8000 -t public
</code></pre>
<p>æèå¯¹äº PHP-FPM/å®¹å¨ï¼åªå¨å¼åç¯å¢è®¾ç½® <code>XDEBUG_MODE=debug</code>ã</p>
<h3 id="é«æçè°è¯æµç¨">é«æçè°è¯æµç¨</h3>
<ol>
<li>å¨å¯çå½æ°çç¬¬ä¸è¡ææ­ç¹</li>
<li>è§¦åè¯·æ±</li>
<li>æ­¥è¿è¿å¥å½æ°</li>
<li>è§å¯ï¼
<ul>
<li>è¾å¥åæ°</li>
<li>åæ¯æ¡ä»¶</li>
<li>æå¤ç null / ç©ºå­ç¬¦ä¸²</li>
<li>"ç¥ç§"ååçå¼</li>
</ul>
</li>
<li>æ¾å°éè¯¯åè®¾åï¼åä¸æ¥ãç¨ä¸å¥è¯åä¸æ¥ã</li>
</ol>
<p>æåä¸æ­¥å¾éè¦ï¼ç®æ ä¸æ¯"æ éæ¢ç´¢"ï¼èæ¯å¿«éæ¾å°éè¯¯çåè®¾ã</p>
<h2 id="åå«-var_dumpç¨æ´å¥½çæ¹å¼-dump">åå« var_dump()ï¼ç¨æ´å¥½çæ¹å¼ dump</h2>
<p>dump ä»ç¶æç¨ãéè¯¯å¨äºç²ç® dumpã</p>
<p>Symfony ç VarDumper ç»ä»¶æä¾äºæ¯ <code>var_dump()</code> æ´æè¯»ç <code>dump()</code> å½æ°ãå¾å¤æµè¡çæï¼åæ¬ Laravelï¼ç <code>dd()</code> ä¾¿æ·å½æ°é½åºäº VarDumper é£æ ¼ç dump æå»ºã</p>
<h3 id="dump-å³é®å­æ®µå«-dump-æ´ä¸ªå¯¹è±¡">dump å³é®å­æ®µï¼å« dump æ´ä¸ªå¯¹è±¡</h3>
<p>ä¸å¶ dump æ´ä¸ªå¯¹è±¡å¾ç¶åæ»å¨ 5 åéï¼ä¸å¦ dump ä½ å³å¿çå½¢ç¶ã</p>
<p><strong>å·®</strong>ï¼</p>
<pre><code class="language-php">dump($request);
</code></pre>
<p><strong>å¥½</strong>ï¼</p>
<pre><code class="language-php">dump([
  'method' =&gt; $request-&gt;getMethod(),
  'path'   =&gt; $request-&gt;getPathInfo(),
  'userId' =&gt; $user?-&gt;id,
]);
</code></pre>
<h3 id="åä¸ªä¸´æ¶çè°è¯è¾å©å½æ°">åä¸ªä¸´æ¶çè°è¯è¾å©å½æ°</h3>
<p>å¨çº¯ PHP åºç¨ä¸­ï¼å®ä¹ä¸ä¸ªå°è¾å©å½æ°ï¼</p>
<pre><code class="language-php">&lt;?php
function dd(mixed $value): never {
    header('Content-Type: text/plain; charset=utf-8');
    var_dump($value);
    exit(1);
}
</code></pre>
<p>ç¶åè°¨æä½¿ç¨ãéç¹æ¯éåº¦ã</p>
<p><strong>è§å</strong>ï¼å¦æä¸ä¸ªæµç¨éæè¶è¿ 3 ä¸ª dumpï¼ä½ å¯è½éè¦æ­¥è¿è°è¯æå¸¦å³è ID çæ¥å¿ã</p>
<h2 id="æ¥å¿è¦åè¯æ®ä¸æ¯æµæ°´è´¦">æ¥å¿è¦åè¯æ®ï¼ä¸æ¯æµæ°´è´¦</h2>
<p>æ¥å¿ä¸åºè¯¥æ¯æ£è½å¨ä»£ç éçéæºå¥å­ãæ¥å¿åºè¯¥æ¯<strong>è¯æ®</strong>ã</p>
<p>å¦æä½ ç¨ Laravelï¼å®çæ¥å¿ç³»ç»æ¯åºäº channel çï¼é»è®¤ä½¿ç¨"stack" channelãLaravel è¿æ"context"è½åï¼å¯ä»¥å¨è¯·æ±/ä»»å¡/å½ä»¤ä¸­æè·å±äº«åæ°æ®å¹¶åå«å¨æ¥å¿éã</p>
<p>å³ä½¿ä½ ä¸ç¨ Laravelï¼è¿ä¸ªæ¨¡å¼å°å¤éç¨ï¼ä¸æ¬¡æ§éå ä¸ä¸æï¼æ¯è¡æ¥å¿é½åå¾æ´æç¨ã</p>
<h3 id="ç»æ¯ä¸ªè¯·æ±å å³è-id">ç»æ¯ä¸ªè¯·æ±å å³è ID</h3>
<p>è¿æ¯æå¥äº§åºæ¯æé«çè°è¯ææ®µä¹ä¸ã</p>
<p>æ¡æ¶æ å³çç¤ºä¾ï¼</p>
<pre><code class="language-php">&lt;?php
declare(strict_types=1);

function getCorrelationId(): string {
    $hdr = $_SERVER['HTTP_X_REQUEST_ID'] ?? '';
    if (is_string($hdr) &amp;&amp; $hdr !== '') return $hdr;
    // å¦ææ²¡æå°±çæä¸ä¸ª
    return bin2hex(random_bytes(16));
}
$reqId = getCorrelationId();
header('X-Request-Id: ' . $reqId);
</code></pre>
<p>ç¶åå å°æ¥å¿éï¼</p>
<pre><code class="language-php">error_log(json_encode([
  'level' =&gt; 'info',
  'event' =&gt; 'checkout.start',
  'request_id' =&gt; $reqId,
  'user_id' =&gt; $userId ?? null,
  'cart_items' =&gt; count($items),
]));
</code></pre>
<h3 id="è®°å½åæ¯å³ç­èéæµæ°´äºä»¶">è®°å½åæ¯å³ç­ï¼èéæµæ°´äºä»¶</h3>
<p>å³ç­ç¹æ¯è¡ä¸ºååçå°æ¹ï¼</p>
<ul>
<li>æææ£æ¥</li>
<li>éæ©æ¯ä»æä¾å</li>
<li>åéé»è¾</li>
<li>éè¯</li>
<li>åè½å¼å³</li>
</ul>
<p>ç¤ºä¾ï¼</p>
<pre><code class="language-php">&lt;?php
$logger-&gt;info('payment.route', [
  'request_id' =&gt; $reqId,
  'order_id' =&gt; $orderId,
  'provider' =&gt; $providerName,
  'reason' =&gt; 'currency_supported',
]);
</code></pre>
<h3 id="ææä¿¡æ¯ç»å¯¹ä¸è½è¿æ¥å¿">ææä¿¡æ¯ç»å¯¹ä¸è½è¿æ¥å¿</h3>
<p>è±æ tokenãå¯ç ãAuthorization headerãsession IDãè°è¯ä¸å¼å¾è®©å­è¯æ°¸è¿æ³é²å¨æ¥å¿éã</p>
<h2 id="ä¸è½å¤ç°ç-bug-ç­äºæ²¡ä¿®">ä¸è½å¤ç°ç bug ç­äºæ²¡ä¿®</h2>
<p>ä¸è½å¤ç°ç bug æ²¡æè¢«ä¿®å¤ï¼å®åªæ¯å¨ç¡è§ã</p>
<p>æä¸º"è°è¯é«æ"æå¿«çæ¹æ³æ¯å­¦ä¼åå»ºæå°å¤ç°ã</p>
<h3 id="æå°å¤ç°æ¸å">æå°å¤ç°æ¸å</h3>
<p>bug æ¥åæ¥äºï¼ç«å»æè·è¿äºï¼</p>
<ul>
<li>ç²¾ç¡®çè¾å¥ payloadï¼æè±æçæ¬ï¼</li>
<li>ç¯å¢å·®å¼ï¼PHP çæ¬ãæ©å±ãéç½®ï¼</li>
<li>æ¶é´ç¸å³æ¡ä»¶ï¼æ¶åºãå½åæ¥æãå¤ä»¤æ¶ï¼</li>
<li>å¹¶åæ¡ä»¶ï¼1 ä¸ªè¯·æ± vs 10 ä¸ªå¹¶åï¼</li>
<li>æ°æ®åç½®æ¡ä»¶ï¼ç¹å®çæ°æ®åºè¡ï¼</li>
</ul>
<p>ç¶åç²¾ç®ã</p>
<p>å¦æä½ çåºç¨éè¦ 20 æ­¥æè½å¤ç°ï¼ç®æ æ¯ 3 æ­¥ãå¦æéè¦ 3 æ­¥ï¼ç®æ æ¯ 1 æ­¥ã</p>
<h3 id="æ-bug-åææµè¯ç¨ä¾">æ bug åææµè¯ç¨ä¾</h3>
<p>è¿æ¯çæ­£çå¢éé»æ­¢åå½çæ¹å¼ã</p>
<p>ç¤ºä¾ï¼ä¸ä¸ªå¾®å¦çææ£èå¥ bugï¼åªå¨ç¹å®ä»·æ ¼æ¶åºç°ã</p>
<pre><code class="language-php">&lt;?php
declare(strict_types=1);

final class Discount
{
    public function apply(int $priceCents, int $percent): int
    {
        $cut = (int) round($priceCents * ($percent / 100));
        return max(0, $priceCents - $cut);
    }
}
</code></pre>
<p>ååå½æµè¯ï¼</p>
<pre><code class="language-php">&lt;?php
declare(strict_types=1);

use PHPUnit\Framework\TestCase;
final class DiscountTest extends TestCase
{
    public function testRoundingEdgeCase(): void
    {
        $d = new Discount();
        // Bug æ¥åï¼999 åé±æ 10% ææ£äº§çäº 900 èé 899
        $this-&gt;assertSame(899, $d-&gt;apply(999, 10));
    }
}
</code></pre>
<p>ç°å¨ä½ æäºï¼</p>
<ul>
<li>å ç§éå°±è½è·å®çå¤ç°</li>
<li>é²æ­¢ä»¥åéæ°å¼å¥ bug çå®å¨ç½</li>
</ul>
<h3 id="æ¶é´ç¸å³ç-bugå»ç»æ¶é´">æ¶é´ç¸å³ç bugï¼å»ç»æ¶é´</h3>
<p>å¦æä½ çä»£ç ä¾èµæ¶é´ï¼ä½ ä¼è¿½é¬¼ã</p>
<p>å¨åºç¨ä»£ç ä¸­ï¼åè£"ç°å¨"ï¼</p>
<pre><code class="language-php">&lt;?php
interface Clock {
    public function now(): DateTimeImmutable;
}

final class SystemClock implements Clock {
    public function now(): DateTimeImmutable {
        return new DateTimeImmutable('now');
    }
}
</code></pre>
<p>å¨æµè¯ä¸­ï¼æ³¨å¥åºå®ç clockãä½ çè°è¯å°±åå¾ç¡®å®æ§äºã</p>
<h2 id="è¾¹çè°è¯æ°æ®åºåå¤é¨-api">è¾¹çè°è¯ï¼æ°æ®åºåå¤é¨ API</h2>
<p>å¨ç°ä»£ PHP åºç¨ä¸­ï¼bug å¾å¾ä¸å¨ä½ çä¸å¡é»è¾éãå®å¨ï¼</p>
<ul>
<li>è¿åæå¤ç»æçæ¥è¯¢</li>
<li>N+1 æ¥è¯¢æ¨¡å¼</li>
<li>å¯¼è´è¶æ¶çæ¢äºå¡</li>
<li>è¿åå¾®å¦ä¸å payload çå¤é¨ API</li>
</ul>
<h3 id="æ°æ®åºåçæ¥è¯¢æ°é">æ°æ®åºï¼åçæ¥è¯¢æ°é</h3>
<p>å¦æä½ çæ¥å£çªç¶åæ¢ï¼ç¬¬ä¸ä¸ªé®é¢å¾å¾æ¯ï¼"è¿ä¸ªè¯·æ±æ§è¡äºå¤å°æ¥è¯¢ï¼"</p>
<p>æ¡æ¶æ å³çæ¹å¼ï¼PDO åè£å¨ï¼å¯ä»¥è®¡æ°æ¥è¯¢ãLaravel/Symfony å¯ä»¥æ¥å¥å®ä»¬çæ°æ®åº profiler åè½ãä¸ç®¡ä»ä¹ææ¯æ ï¼ä¹ æ¯æ¯ä¸æ ·çï¼</p>
<ul>
<li>æè·æ¥è¯¢æ°é</li>
<li>æè·æ¢æ¥è¯¢</li>
<li>å°å¿æè·åæ°ï¼é¿åæ³é²ææä¿¡æ¯ï¼</li>
</ul>
<p>ç¤ºä¾ï¼æ¦å¿µæ§ä¼ªåè£å¨ï¼ï¼</p>
<pre><code class="language-php">&lt;?php
final class Db
{
    private int $count = 0;
    public function __construct(private PDO $pdo) {}
    public function query(string $sql, array $params = []): array
    {
        $this-&gt;count++;
        $stmt = $this-&gt;pdo-&gt;prepare($sql);
        $stmt-&gt;execute($params);
        return $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
    }
    public function queryCount(): int { return $this-&gt;count; }
}
</code></pre>
<p>è¯·æ±ç»ææ¶ï¼</p>
<pre><code class="language-php">$logger-&gt;info('request.db', [
  'request_id' =&gt; $reqId,
  'query_count' =&gt; $db-&gt;queryCount(),
]);
</code></pre>
<h3 id="å¤é¨-httpè®°å½åæ°æ®å«è®°-body">å¤é¨ HTTPï¼è®°å½åæ°æ®ï¼å«è®° body</h3>
<p>ä½ éè¦çæ¯ï¼</p>
<ul>
<li>method</li>
<li>host/path</li>
<li>status</li>
<li>duration</li>
<li>retries</li>
<li>å³è ID</li>
</ul>
<p>ç¤ºä¾åè£å¨ï¼</p>
<pre><code class="language-php">&lt;?php
function callPartnerApi(string $url, array $headers): array
{
    $start = microtime(true);
    $ch = curl_init($url);
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER =&gt; true,
        CURLOPT_HTTPHEADER =&gt; array_map(
            fn($k, $v) =&gt; "$k: $v",
            array_keys($headers),
            $headers
        ),
        CURLOPT_TIMEOUT =&gt; 10,
        CURLOPT_CONNECTTIMEOUT =&gt; 3,
    ]);
    $body = curl_exec($ch);
    $status = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    $durationMs = (int) ((microtime(true) - $start) * 1000);
    curl_close($ch);
    error_log(json_encode([
        'event' =&gt; 'http.out',
        'url' =&gt; $url,
        'status' =&gt; $status,
        'duration_ms' =&gt; $durationMs,
    ]));
    return ['status' =&gt; $status, 'body' =&gt; $body];
}
</code></pre>
<p><strong>è°è¯æ¶ç</strong>ï¼ä¸æ¦ä½ æäºå¸¦è¯·æ± ID ç duration å status æ¥å¿ï¼ä½ å°±ä¸ç¨åç bug æ¯"æä»¬çé®é¢"è¿æ¯"åä½æ¹ API è´è½½è¿é«"äºã</p>
<h2 id="ç¡¬æ ¸ææ®µäºåæ³git-bisectæ­è¨å®å«">ç¡¬æ ¸ææ®µï¼äºåæ³ãgit bisectãæ­è¨å®å«</h2>
<p>å¡ä½çæ¶åï¼æ´åå¾å¾æ¯èªææ´ææã</p>
<h3 id="äºåæ³å®ä½ä»£ç è·¯å¾">äºåæ³å®ä½ä»£ç è·¯å¾</h3>
<p>å¦æä½ æä¸ä¸ªå¤ææµç¨ï¼ç»è´¦ãé¢è®¢ãå®¡æ¹æµæ°´çº¿ï¼ï¼å«è¯»æ´ä¸ªä»£ç åºãç¼©å°èå´ã</p>
<ol>
<li>å¨å¯çåºåçå¼å¤´å ä¸æ¡æ¥å¿</li>
<li>å¨ç»å°¾å ä¸æ¡æ¥å¿</li>
<li>å¦æå¼å¤´çæ¥å¿åºç°äºä½ç»å°¾çæ²¡åºç°ï¼bug å°±å¨éé¢</li>
<li>æåºåä¸åä¸ºäºï¼éå¤</li>
</ol>
<p>è¿å°±æ¯"ä»£ç çäºåæ¥æ¾"ãæææäººã</p>
<h3 id="åå½-bug-ç¨-git-bisect">åå½ bug ç¨ git bisect</h3>
<p>å¦æä¸ä¸ª bug"æè¿æå¼å§åºç°"ï¼å«äºè®ºäºï¼ç´æ¥ bisectã</p>
<pre><code class="language-bash">git bisect start
git bisect bad HEAD
git bisect good &lt;å·²ç¥æ­£å¸¸ç-commit-æ-tag&gt;
</code></pre>
<p>ç¶åè¿è¡ä¸ä¸ªè½å¤ç°é®é¢çèæ¬/æµè¯ï¼æ¯ä¸æ­¥æ è®° good/badï¼ç´å° Git æ¾å°å¼å¥ bug ç commitã</p>
<p>å¦æä½ æ²¡æå¤ç°èæ¬ï¼é£å°±æ¯ä½ çç¬¬ä¸ä¸ªä»»å¡ï¼è§æè½ 5ï¼ã</p>
<h3 id="å¨è¾¹çå æ­è¨å®å«">å¨è¾¹çå æ­è¨å®å«</h3>
<p>å¤§éè°è¯æ¶é´è±å¨å¤ç"ä¸å¯è½çç¶æåæäºå¯è½"ä¸ã</p>
<p>æ·»å å¿«éå¤±è´¥å¹¶å¸¦æ¸æ°æ¶æ¯çå®å«ï¼</p>
<pre><code class="language-php">&lt;?php
declare(strict_types=1);

function requireNonEmptyString(mixed $v, string $name): string {
    if (!is_string($v) || trim($v) === '') {
        throw new InvalidArgumentException("$name must be a non-empty string");
    }
    return $v;
}
</code></pre>
<p>å¨ bug èéçå°æ¹ä½¿ç¨å®ï¼è§£æè¾å¥ãè¯»åç¯å¢åéãå¤çå¤é¨ payloadã</p>
<p>ç¤ºä¾ï¼</p>
<pre><code class="language-php">$apiKey = requireNonEmptyString(getenv('PARTNER_API_KEY'), 'PARTNER_API_KEY');
</code></pre>
<p>è¿ä¸æ¯"é¢å¤ä»£ç "ãè¿æ¯è°è¯é¢é²ã</p>
<h2 id="å®æ´çè°è¯å·¥ä½æµ">å®æ´çè°è¯å·¥ä½æµ</h2>
<p>éå° bug æ¶ï¼è·è¿ä¸ªå¾ªç¯ï¼</p>
<h3 id="ç¬¬ä¸æ­¥è®©éè¯¯å¯è§">ç¬¬ä¸æ­¥ï¼è®©éè¯¯å¯è§</h3>
<p>ç¡®è®¤éè¯¯è®¾ç½®åæ¥å¿ï¼æè½ 1ï¼ãæ¿å°çæ­£çå æ è·è¸ªã</p>
<h3 id="ç¬¬äºæ­¥å¤ç°">ç¬¬äºæ­¥ï¼å¤ç°</h3>
<p>ç²¾ç®æ­¥éª¤ãæè·è¾å¥ãè®©å®ç¡®å®æ§ï¼æè½ 5ï¼ã</p>
<h3 id="ç¬¬ä¸æ­¥éå·¥å·">ç¬¬ä¸æ­¥ï¼éå·¥å·</h3>
<ul>
<li>ä¸ä¸ªåééäºï¼<code>dump()</code> ä¸ä¸ªå°å½¢ç¶ï¼æè½ 3ï¼</li>
<li>æ§å¶æµä¸æ¸æ¥ï¼Xdebug æ­¥è¿è°è¯ï¼æè½ 2ï¼</li>
<li>åå¸å¼/ç³»ç»é®é¢ï¼å³è ID + ç»æåæ¥å¿ï¼æè½ 4ï¼</li>
<li>åå½ï¼git bisectï¼æè½ 7ï¼</li>
</ul>
<h3 id="ç¬¬åæ­¥ä¿®å¤å¹¶éå®">ç¬¬åæ­¥ï¼ä¿®å¤å¹¶éå®</h3>
<p>æ·»å æµè¯æå®å«ï¼è®©å®ä¸ååæ¥ï¼æè½ 5 / æè½ 7ï¼ã</p>
<p>è¿å°±æ¯æ´ä¸ªæ¸¸æã</p>
<h2 id="ç»è¯­">ç»è¯­</h2>
<p>æå¥½ç PHP è°è¯èæ²¡æç¥å¥çç´è§ãä»ä»¬ææ´å¥½çåé¦å¾ªç¯ã</p>
<ul>
<li>éè¯¯å¯è§ä½ä¸æ³é²ï¼PHP å®æ¹ä¹å»ºè®®å¨çäº§ç¯å¢è®°å½èéæ¾ç¤ºï¼</li>
<li>çä¸åºæ¥æ¶ææ­¥è¿è°è¯å¯ç¨ï¼Xdebug å°±æ¯ä¸ºæ­¤èçï¼</li>
<li>dump å¯è¯»ä¸ææè¯ï¼VarDumper ç <code>dump()</code> å­å¨æ¯å ä¸º <code>var_dump()</code> å¤ªçè¦ï¼</li>
<li>æ¥å¿å¨æ§è¡è¿ç¨ä¸­æºå¸¦ä¸ä¸æï¼Laravel æç¡®æ¯æå¨æ¥å¿ä¸­åå« contextï¼</li>
<li>bug åæå¯å¤ç°çæµè¯ï¼èéåå¤åºç°çæäº</li>
</ul>
<p>å°½æ©ææ¡è¿ä¸ä¸ªæè½ï¼ä½ ç"è°è¯æ¶é´"ä¼å¤§å¹ç¼©ç­ââä¸æ¯å ä¸º bug æ¶å¤±äºï¼èæ¯å ä¸ºä½ çç³»ç»ä¸åå¯¹ä½ éèçç¸ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-04 08:02">2026-01-04 08:01</span>&nbsp;
<a href="https://www.cnblogs.com/catchadmin">JaguarJack</a>&nbsp;
éè¯»(<span id="post_view_count">111</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19435596);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19435596', targetLink: 'https://www.cnblogs.com/catchadmin/p/19435596', title: '7 ä¸ªä»å¥é¨å°èµæ·± PHP å¼åèé½å¨ç¨çæ ¸å¿è°è¯æè½' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>