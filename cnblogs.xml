<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-12T12:37:47.853Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ è¿ä¸¤ä¸ªç½ç«ï¼ä¸ä¸ªå¯ä»¥å½æ¶é´è¶åï¼ä¸ä¸ªåæ»¡äºèµåè©è¨ã ]]></title>
    <link>https://www.cnblogs.com/thisiswhy/p/19474147</link>
    <guid>96e2dcf1335aecc3bd4ca7ceb4d2ee34</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/thisiswhy/p/19474147" title="åå¸äº 2026-01-12 20:27">
    <span role="heading" aria-level="2">è¿ä¸¤ä¸ªç½ç«ï¼ä¸ä¸ªå¯ä»¥å½æ¶é´è¶åï¼ä¸ä¸ªåæ»¡äºèµåè©è¨ã</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<section id="nice" data-tool="mdniceç¼è¾å¨" data-website="https://www.mdnice.com" style="margin: 0; padding: 0 10px; background: none left top / auto no-repeat scroll padding-box border-box rgba(0, 0, 0, 0); width: auto; font-family: Optima, &quot;Microsoft YaHei&quot;, PingFangSC-regular, serif; font-size: 16px; color: rgba(0, 0, 0, 1); line-height: 1.5em; word-spacing: 0; letter-spacing: 0; overflow-wrap: break-word; text-align: left"><p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä½ å¥½åï¼ææ¯æ­ªæ­ªã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">åä¸¤å¤©ä¸æ¯åäºè¿ç¯<a href="https://mp.weixin.qq.com/s/YIRyn5iyT3yFDgHTjzvA8Q" style="color: rgba(239, 112, 96, 1); font-weight: bold; border-top: 1px none rgba(30, 107, 184, 1); border-bottom: 1px solid rgba(239, 112, 96, 1); border-left: 1px none rgba(30, 107, 184, 1); border-right: 1px none rgba(30, 107, 184, 1); border-radius: 0; margin: 0; padding: 0; text-decoration: none; text-decoration-thickness: initial; overflow-wrap: break-word" rel="noopener nofollow">ãå¯æï¼çå°ä¸ä¸ªå¦æ­¤å·è¡çç®æ³ãã</a>åã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æç« ä¸­æè¿æ ·çä¸ä¸ªé¾æ¥ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110151208.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æå½æ¶æ¾è¿ä¸ªé¾æ¥çç®çæ¯ä¸ºäºæ¹ä¾¿å¤§å®¶ç´è¾¾åçç°åºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä½æ¯ï¼ç±äºè¿ä¸ªå¸å­æç»è¢«è¯å®æ¯åçï¼æä»¥è¢«å®æ¹ç»âå¤¹âäºï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110151912.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¹¸å¥½ï¼åææ¬æ¥å°±ä¸é¿ï¼æä»¥æå¨æçæç« ä¸­æåæå¨é¨ç»æªä¸æ¥äºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä¹ç®æ¯ä»¥å¦å¤ä¸ç§å½¢å¼ä¿çäºåçç°åºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¦æè¿ä¸ªâçæâçå¸å­åé¿ä¸ç¹ï¼æç§æçä¹ æ¯ï¼æå¯è½å°±ä¸ä¼ææ´ä¸ªå¸å­æ¬è¿è¿æ¥äºï¼åªä¼çåæè®¤ä¸ºå³é®çé¨åã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä½æ¯è¿ç§âæè®¤ä¸ºå³é®çé¨åâæ¯éå¸¸ä¸»è§çï¼æçäººå°±æ¯æ³çåè´´é¿ä»ä¹æ ·ï¼ä½æ¯åè´´åè¢«å é¤äºï¼æä¹åï¼</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ææä½ ä¸æï¼èå¥½ç¨äºã</p>
<h2 data-tool="mdniceç¼è¾å¨" style="border-bottom: 2px solid rgba(239, 112, 96, 1); margin: 30px 0 15px; padding: 0; align-items: unset; background: none left top / auto no-repeat scroll padding-box border-box unset; border-top: 1px none rgba(0, 0, 0, 1); border-left: 1px none rgba(0, 0, 0, 1); border-right: 1px none rgba(0, 0, 0, 1); border-radius: 0; box-shadow: none; display: flex; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.1em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset"><span class="prefix" style="display: none"></span><span class="content" style="font-size: 22px; color: rgba(255, 255, 255, 1); background: none left top / auto no-repeat scroll padding-box border-box rgba(239, 112, 96, 1); line-height: 1.5em; letter-spacing: 0; align-items: unset; border: 1px none rgba(0, 0, 0, 1); border-radius: 3px 3px 0 0; box-shadow: none; display: inline-block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin: 0 5px 0 0; overflow-x: unset; overflow-y: unset; padding: 3px 10px 1px; position: relative; text-align: left; text-indent: 0; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset">æ¶é´è¶å</span><span class="suffix" style="display: none"></span><span style="border-bottom: 36px solid rgba(239, 235, 233, 1); align-items: unset; background: none left top / auto no-repeat scroll padding-box border-box unset; border-top: 1px none rgba(0, 0, 0, 1); border-left: 1px none rgba(0, 0, 0, 1); border-right: 20px solid rgba(0, 0, 0, 0); border-radius: 0; box-shadow: none; color: rgba(0, 0, 0, 1); display: inline-block; font-size: 16px; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; letter-spacing: 0; line-height: 1.1em; margin: 0; overflow-x: unset; overflow-y: unset; padding: 0; position: relative; text-align: left; text-indent: 0; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset"> </span></h2>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¨ä¸è½çäºèç½ä¸ï¼æè¿æ ·ä¸ä¸ªä»¿ä½æ¯æ¶é´è¶åä¸è¬å­å¨çç¥å¥çç½ç«ï¼</p>
<blockquote class="custom-blockquote multiquote-1" data-tool="mdniceç¼è¾å¨" style="margin: 20px 0; padding: 10px 10px 10px 20px; border-top: 3px none rgba(0, 0, 0, 0.4); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px solid rgba(239, 112, 96, 1); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(255, 249, 249, 1); width: auto; height: auto; box-shadow: 0 0 rgba(0, 0, 0, 0); display: block; overflow-x: auto; overflow-y: auto"><span style="display: none; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: normal"></span>
<p style="text-indent: 0; padding: 8px 0; color: rgba(0, 0, 0, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal; margin: 0">https://archive.org/</p>
</blockquote>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110152655.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿ä¸ªç½ç«æ¯å«å"äºèç½æ¡£æ¡é¦"ï¼Internet Archiveï¼ï¼äº 1996 å¹´æç«çéè¥å©ç»ç»ç»´æ¤çç½ç«ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">èª 1996 å¹´ä»¥æ¥ï¼äºèç½æ¡£æ¡åºä¸ä¸çåå°çå¾ä¹¦é¦ååä½ä¼ä¼´åä½ï¼å»ºç«äºä¸ä¸ªäººç±»å¨çº¿åå²çå±äº«æ°å­å¾ä¹¦é¦ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿ä¸ªç½ç«æä¸ä¸ªéå¸¸å®å¤§çæ¿æ¯ï¼</p>
<blockquote class="custom-blockquote multiquote-1" data-tool="mdniceç¼è¾å¨" style="margin: 20px 0; padding: 10px 10px 10px 20px; border-top: 3px none rgba(0, 0, 0, 0.4); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px solid rgba(239, 112, 96, 1); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(255, 249, 249, 1); width: auto; height: auto; box-shadow: 0 0 rgba(0, 0, 0, 0); display: block; overflow-x: auto; overflow-y: auto"><span style="display: none; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: normal"></span>
<p style="text-indent: 0; padding: 8px 0; color: rgba(0, 0, 0, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal; margin: 0">ææå¤§å°ä¸ä¸çç½ç«ï¼ä»çªåæ°é»å°è¢«éå¿çä¸ªäººé¡µé¢ï¼ä½¿å®ä»¬è½å¤ä¸ºå­å­åä»£ä¿æå¯è®¿é®æ§ã</p>
</blockquote>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æä»¥éé¢æ¶èäºçåå®¹æåè´¹ä¹¦ç±ãçµå½±ãè½¯ä»¶ãé³ä¹ãç½ç«ç­ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æªè³ç®åï¼è¯¥ç½ç«æ¶éäºè¿ä¹å¤çæ°æ®ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110153451.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¶ä¸­ç½ç«çæ°éæ¯æå¤çï¼æ 1Tï¼è¶è¿ 1T çæ¶åï¼å®æ¹è¿åæåºç¥äºä¸ä¸ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110154601.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿ä¸ª 1T ä¸­ç T æçæ¯ä»ä¹å¢ï¼</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">Trillionã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä¸ä¸ªéå¸¸å°ä¼çè¯æ±åï¼æ­ªå¸åä¹ä¸è®¤è¯ï¼æä»¥æå»æ¥äºä¸ä¸ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110153943.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿ä¸ªå¾çä¸ä¸ç¼æå»å¨æ¯ 0ã</p>
<blockquote class="custom-blockquote multiquote-1" data-tool="mdniceç¼è¾å¨" style="margin: 20px 0; padding: 10px 10px 10px 20px; border-top: 3px none rgba(0, 0, 0, 0.4); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px solid rgba(239, 112, 96, 1); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(255, 249, 249, 1); width: auto; height: auto; box-shadow: 0 0 rgba(0, 0, 0, 0); display: block; overflow-x: auto; overflow-y: auto"><span style="display: none; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: normal"></span>
<p style="text-indent: 0; padding: 8px 0; color: rgba(0, 0, 0, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal; margin: 0">1 Trillion å°±æ¯ 1,000,000,000,000</p>
</blockquote>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">åæ­£æ¯æ°ä¸è¿æ¥äºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æè§æé½é½æ²¡æè¿ä¹å¤ 0ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿ä¸ªç½ç«æä¹ç¨å¢ï¼</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¾ç®åã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¿åé¢ reddit ä¸­è¢«âå¤¹âäºçå¸å­ä¸¾ä¾ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æä¸æ¯ç»äºåçç°åºçé¾æ¥åã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä½ æé¾æ¥å¾âæ¶åæºâçè¿ä¸ªå°æ¹ä¸ç²ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110155525.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä½ å°±ä¼çå°è¿ä¸ªæä¸ä¸ªæ¶é´è½´çé¡µé¢ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110155608.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æé¼ æ æµ®å°æé¢è²çæ¥æä¸ï¼å°±è½çå°åä¸ªæ¶é´ç¹çé¡µé¢å¿«ç§äºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">é¢è²è¶æ·±ä»£è¡¨é£ä¸å¤©çå¿«ç§è¶å¤ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110160303.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¯å¦ï¼æä»¬çä¸ä¸è¿ä¸ªç½ç«æ¶éå°çç¬¬ä¸ä¸ªå¿«ç§ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110160532.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ç¹è¿å»ï¼å°±æ¯æä»¬è¦æ¾çåçç°åºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">åå¸åçä¸¤å°æ¶å°±è¢«æ¶éå°äºï¼éåº¦è¿æ¯æºå¿«çã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä»æ°æ®ä¸çï¼è¿ä¸ªæ¶åå·²ç»æ 3.7k ä¸ªç¹èµå 255 ä¸ªè¯è®ºï¼å·²ç»æè¦èµ·é£çé¢åäºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¢ä¸ªæ¶é´çå¿«ç§ï¼è¿å¯ä»¥çå°ç¹èµåè¯è®ºçæ°æ®ååï¼æ¯å¦åå¸ä¸å¤©åï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110161244.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ç¹èµéå·²ç»æ¯ 71kï¼è¯è®ºæ°æ¥å°äº 3.8Kï¼ç´æ¥å°±æ¯ä¸ä¸ªèµ·é£çå¤§å¨ä½ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿éåªæ¯ç¨è¿ä¸ªå¸å­ä¸¾ä¸ªä¾å­ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">åä¸¾ä¸ä¸ªä¾å­ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä¹æ¯æççå®ä½¿ç¨åºæ¯ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æä¸æ¬¡æå¨ç ç©¶å¹³æ»å æè½®è¯¢è´è½½åè¡¡ç­ç¥ç®æ³ä¸ºä»ä¹æ¯å¹³æ»çã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ååç±» AI è®¨è®ºäºåå¤©ï¼å®ä»¬ä¹ç»åºäºåç§åèæç®ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æå¨å¶ä¸­ä¸ä¸ªåèæç®ä¸­çå°äºè¿æ ·ä¸ä¸ªé¾æ¥ï¼</p>
<blockquote class="custom-blockquote multiquote-1" data-tool="mdniceç¼è¾å¨" style="margin: 20px 0; padding: 10px 10px 10px 20px; border-top: 3px none rgba(0, 0, 0, 0.4); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px solid rgba(239, 112, 96, 1); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(255, 249, 249, 1); width: auto; height: auto; box-shadow: 0 0 rgba(0, 0, 0, 0); display: block; overflow-x: auto; overflow-y: auto"><span style="display: none; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: normal"></span>
<p style="text-indent: 0; padding: 8px 0; color: rgba(0, 0, 0, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal; margin: 0">https://tenfy.cn/2018/11/12/smooth-weighted-round-robin/</p>
</blockquote>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æç¥éè¿ä¸ªé¾æ¥çåå®¹å°±æ¯æè¦æ¾çåå®¹ï¼ä½æ¯è¿ä¸ªé¾æ¥è·³è½¬è¿å»å·²ç»æ¯ 404 äºï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110162307.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">äºæ¯ï¼æ¶é´è¶åå°±æ´¾ä¸ç¨åºäºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æç´æ¥æè¿ä¸ªé¾æ¥æå®ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110162454.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¾å°äºè¿ä¸ªç½é¡µå¨ 2019 å¹´ 12 æ 10 æ¥çå¿«ç§ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110162549.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">éè¿è¿ç§æ¹å¼å°±æ¾å°äºåæ¬å·²ç»è¢« 404 çç½é¡µåå®¹ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¨çä¸äºæ¶é´æ¯è¾ä¹è¿çæç« çæ¶åï¼åèé¾æ¥æä¸å¼çæåµï¼è¿æ¯æ¯è¾å¸¸è§çã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æä»¥è¿ä¸ªæ¹å¼æ¯ææå¸¸ç¨çä¸ä¸ªåºæ¯ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ­¤å¤ï¼è¿æå¦å¤ä¸ä¸ªåºæ¯ï¼å°±æ¯å¶å°å»ææ§ä¸ä¸ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¯å¦ï¼ä¸­æäºèç½çä¸æ»´ç¼æ³ªï¼å¤©æ¶¯è®ºåã</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110163342.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿æ¯ 20 å¹´åï¼2006 å¹´ 1 æçå¤©æ¶¯è®ºåé¦é¡µï¼ä¸è¡æµççæ©æäºèç½é£æ ¼ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110164241.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¨å¾ççå³ä¸è§ä½ è¿è½çå°â2006 å¤©æ¶¯æ¥æâçå­æ ·ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¦å¤ï¼ä½ ä¸è¦è§å¾è¿åªæ¯ä¸ä¸ªéæé¡µé¢ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">éé¢çé¨åé¾æ¥è¿æ¯å¯ä»¥æ­£å¸¸è·³è½¬çã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¯å¦ï¼è¿ä¸ªé¾æ¥ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110164612.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ç¹è¿å»ï¼ä½ å¯ä»¥çå°ææå¤æ©çä¸ç§ç´æ­å½¢å¼ï¼æå­ç´æ­ã</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110164652.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">2006 å¹´ 1 æ 2 æ¥ï¼ãæ­¦æå¤ä¼ ãå¼æ­ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¤©æ¶¯è¿ä¸ªæå­ç´æ­çæ¶é´æ¯ 2006 å¹´ 1 æ 19 æ¥ï¼ãæ­¦æå¤ä¼ ãå½æ¶æ­£å¨å¨å½ç­æ­ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¤©æ¶¯ç½åå¨è¿ä¸ªé¡µé¢ä¸æåºèªå·±å³äºãæ­¦æå¤ä¼ ãçé®é¢ï¼ä½ä¸ºå¤©æ¶¯çç¥ååæï¼å®è´¢ç¥æ¬äººä¼éæ©é¨åé®é¢è¿è¡åå¤ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ææªåäºå ä¸ªæè§å¾æææçåå¤ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110165547.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿ç§è¡ä¸ºè¿ç®ä¸ç®æ¯å®æ¹å§éäºï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110164929.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å½å¹´ç¥æ åè¿ä¸ªè§è²æ¯ççä¸è®©äººè®¨ååãå¹¸å¥½å½æ¶çç½ç»è¿ä¸åè¾¾ï¼ä¸ç¶æè§å¾çæå¯è½âç½çç¥æ åâã</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110165709.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">DVDï¼ä¸ä¸ªå¤ä¹å·æå¹´ä»£æçè¯ã</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110170208.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110170248.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">åæç« çæ¶åï¼ææ¬æ¥æ¯æ³æªå å¼ å¾å°±èµ°çï¼æå¤äºåéæå®ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ç»ææç«ç¶ä¸é¡µé¡µçç¿»å®äºè¿ä¸ªå¸å­ï¼çå®ä¹åæåç°å¨è¿ä¸ªå¸å­éé¢å¾äºåä¸ªå¤å°æ¶ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¶é´è¿çè¿æ¯å¾å¿«çã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ç«å¨ 2026 å¹´ï¼ç 2006 çå¸å­ï¼ä¸­é´æ 20 å¹´çåé´ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä½æ¯å°±åæ¯ 2006 å¹´ä½ææå¯¹è¦ç»å¥¹å¹²äºåå¹´å·¥æè½è¿æ¸åºå¡çå°é­è¯´çé£æ ·ï¼ä¸è¦æï¼äºåå¹´å¿«å¾å¾ï¼å¼¹æä¸æ¥é´ã</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/d23d93c0bf069c1024223eee62e71e4c.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">åå å¤©å°é­å¨å¾®åä¸è¿ååºäºæ­£å¼èµèº«è¿ä¸ªæ¢ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å»äºå­éæ¡¥ãå»äºåç¦å¤¹éãå»äºå·¦å®¶åºç«ãè¿å»äºç¥¥è¨çï¼æåå¨äººæ¥äººå¾çåäº¬è¡å¤´ï¼ä¸ä¸ªçä¸åé²çåç¸ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/8457920991b850fa95be10dc56098679.jpg" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿æ¯æçç«¥å¹´åå¤´çäºæä¸ç¼ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">åå å²çä¸äºè§£ä½ææçè¿å¥è¯ï¼ä¸ååºå¤´äºï¼ä¸ä¸å°±çè§£äºï¼20 å¹´ï¼ççå¾å¿«åã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">çå° 2006 å¹´çå¤©æ¶¯çæ¶åï¼æä¾ç¨æ³èµ·äºä¸äºå½å¹´çå¾äºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">é£ä¸ªæ¶åææ 12 å²ï¼ççµè§å§æ¯ççå¨çµè§æºä¸çï¼æè¿è®°å¾å®¶éççµè§æºé½æ¯è¿æ ·çâå¤§å±è¡âçµè§æºï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260111113117.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿è®°å¾ãæ­¦æå¤ä¼ ãæ¯éå¼å§ï¼å±ä¸»é¢æ²çæ¶åï¼çµè§ä¸é¢ä¼æ¾ç¤ºä¸ä¸ªçµèçæ¡é¢ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260111122741.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æä»¥æ¯æ¬¡å¼å¤´çæ¶åï¼æå°±ä¼å«è¡¨å¦¹è¿æ¥ï¼å¯¹å¥¹è¯´ï¼ä½ çï¼æç­ä¸æçµè§åæçµèã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">é£ä¸ªæ¶åè¡¨å¦¹æ 7 å²ï¼æè¿ä¸ª 12 å²çå¥å¥å½ç¶æ¯æå¥¹å¬çä¸æ£ä¸æ£çã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">é£ä¸ªæ¶åçµèä¹è¿æ¯ä¸ä¸ªç¨å¥çç©åï¼è½ç¶æ¯ä¹¡ä¸çå­¦æ ¡ï¼ä½æ¯ä¹è¿æ¯æä¸ä¸ªå¾®æºå®¤ï¼å»å¾®æºå®¤ä¸è¯¾å¿é¡»è¦å¸¦éå¥çé£ç§ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æä»¥ 2006 å¹´çå¤©æ¶¯ï¼æè¯å®æ¯æ²¡æçè¿çï¼ä½æ¯å¨ 2026 å¹´çå° 2006 çå¤©æ¶¯ï¼æè¿æ¯æ³èµ·äºå¾å¤ç«¥å¹´å¾äºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¯¹äºï¼åå å¤©æç»è¡¨å¦¹è¿å® 27 å²ççæ¥ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/a1ecdf2dc6a3e232951d8820f6e88cb6.jpg" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ççè¿å¼ ç§çï¼åæ³èµ· 7 å²æ¶é£ä¸ªç¸ä¿¡å¥å¥å¯ä»¥æçµè§åæçµèç»å¥¹çãæ­¦æå¤ä¼ ãçå¦¹å¦¹ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">âäºåå¹´å¿«å¾å¾ï¼å¼¹æä¸æ¥é´âã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä½ è¯´è¿ä¸å«æ¶é´è¶åï¼å«ä»ä¹ï¼</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">åçä¸ä¸ 10 å¹´åï¼2016 å¹´ 1 æ 1 æ¥çå¤©æ¶¯ï¼å½¼æ¶çå¤©æ¶¯å¯ä»¥è¯´æ¯å¦æ¥ä¸­å¤©ï¼éå¸¸å¤çç½åå¤©å¤©æ³¡å¨è®ºåéé¢ï¼è°å¤è®ºä»ï¼æ¿æ¬æå­ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿æ¯é£å¤©çå¤©æ¶¯é¦é¡µæªå¾ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110212425.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ç­å¸æ¦ç¬¬ä¸çæ¯ä¸ä¸ªå³äºçº¯çµå¨æ±½è½¦çå¸å­ï¼æè¿å»çäºä¸ä¸ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110212718.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿ä¸ªå¸å­çç¹å»éæ¯ 10wï¼æ 816 ä¸ªåå¤ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¯è§è¿ç¡®å®æ¯å½æ¶çä¸ä¸ªéå¸¸ç­é¨çè¯é¢ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æç§ä½èçè§ç¹ï¼çº¯çµæ±½è½¦ä»£æ¿çæ²¹æ±½è½¦ï¼è¿å¾é¿çè·¯è¦èµ°ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ç«å¨ 10 å¹´åçä»å¤©ï¼å¶å®æä»¬å·²ç»ç¥éç­æ¡äºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä½æ¯ï¼å½æçå°è¿ä¸ªåå¤çæ¶åï¼æè¿æ¯ä½©æå¤©æ¶¯ç½åçç¼åï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110213134.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">é¤äºå¤©æ¶¯ï¼è¿å¯ä»¥èå¤å¾å¤å¶ä»çç½ç«ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¯å¦ï¼B ç«ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110221101.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä» 2011 å¹´å¼å§æäºç½é¡µå¿«ç§ï¼æéä¾¿ç¹å¼ä¸çï¼æ»¡æ»¡çåå²æï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110221037.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">èè¿æ¯ 2016 å¹´ï¼10 å¹´åç B ç«é¦é¡µï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110221728.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å½æ¶è¿æä¸ä¸ªä¸é¨çé¬¼çåºï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110221819.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">èè¿éçä¸äºè§é¢çè³è¿æ¯å¯ä»¥æ­æ¾çã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¯å¦è¿ä¸ªâå¯èä½åâï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110222457.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ç°å¨å¨ B ç«æ 160w çæ­æ¾ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110222627.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¨è¿ä¸ªè§é¢çè¯è®ºåºï¼ä½ è½æ¾å°å¤§éæ¥âèå¤âçäººï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110222829.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110222903.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110222940.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">äºåå¹´é½å¼¹æä¸æ¥é´äºï¼å«è¯´åºåºåå¹´äºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä» B ç«ææ§å®æåï¼éä¾¿ï¼æä¹å»ç£¨æ¿ãé©¬èçªãç©·æ¸¸ç½çäºä¸åï¼éä¾¿éäº 2012 å¹´å° 2016 å¹´é´çä¸äºé¡µé¢ï¼æè°¢å®ä»¬éªæåº¦è¿äºä¸æ´ä¸ªç¾å¥½çå¤§å­¦çæ´»ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¯æå½æ¶è®¤è¯ãæç¥ãä½éªè¿ä¸ªçå¹¿éä¸ççä¸ä¸ªéè¦çªå£ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æè°¢ç£¨æ¿ 4 å¹´çéªä¼´ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110223656.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æè°¢é©¬èçª 4 å¹´çéªä¼´ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110224704.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æè°¢ç©·æ¸¸ç½ 4 å¹´çéªä¼´ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110224951.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¦æä½ ä¹ææ³è¦å¯»æ¾çè®°å¿ï¼å¯ä»¥å°è¯å¨è¿ä¸ªç½ç«ä¸å»æ¾ä¸æ¾ã</p>
<h2 data-tool="mdniceç¼è¾å¨" style="border-bottom: 2px solid rgba(239, 112, 96, 1); margin: 30px 0 15px; padding: 0; align-items: unset; background: none left top / auto no-repeat scroll padding-box border-box unset; border-top: 1px none rgba(0, 0, 0, 1); border-left: 1px none rgba(0, 0, 0, 1); border-right: 1px none rgba(0, 0, 0, 1); border-radius: 0; box-shadow: none; display: flex; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.1em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset"><span class="prefix" style="display: none"></span><span class="content" style="font-size: 22px; color: rgba(255, 255, 255, 1); background: none left top / auto no-repeat scroll padding-box border-box rgba(239, 112, 96, 1); line-height: 1.5em; letter-spacing: 0; align-items: unset; border: 1px none rgba(0, 0, 0, 1); border-radius: 3px 3px 0 0; box-shadow: none; display: inline-block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin: 0 5px 0 0; overflow-x: unset; overflow-y: unset; padding: 3px 10px 1px; position: relative; text-align: left; text-indent: 0; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset">å­æ¡£</span><span class="suffix" style="display: none"></span><span style="border-bottom: 36px solid rgba(239, 235, 233, 1); align-items: unset; background: none left top / auto no-repeat scroll padding-box border-box unset; border-top: 1px none rgba(0, 0, 0, 1); border-left: 1px none rgba(0, 0, 0, 1); border-right: 20px solid rgba(0, 0, 0, 0); border-radius: 0; box-shadow: none; color: rgba(0, 0, 0, 1); display: inline-block; font-size: 16px; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; letter-spacing: 0; line-height: 1.1em; margin: 0; overflow-x: unset; overflow-y: unset; padding: 0; position: relative; text-align: left; text-indent: 0; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset"> </span></h2>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¢ç¶å·²ç»èå°âarchiveâäºï¼é£å°±é¡ºä¾¿ååäº«ä¸ä¸ªâarchive.todayâã</p>
<blockquote class="custom-blockquote multiquote-1" data-tool="mdniceç¼è¾å¨" style="margin: 20px 0; padding: 10px 10px 10px 20px; border-top: 3px none rgba(0, 0, 0, 0.4); border-bottom: 3px none rgba(0, 0, 0, 0.4); border-left: 3px solid rgba(239, 112, 96, 1); border-right: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; background: none left top / auto no-repeat scroll padding-box border-box rgba(255, 249, 249, 1); width: auto; height: auto; box-shadow: 0 0 rgba(0, 0, 0, 0); display: block; overflow-x: auto; overflow-y: auto"><span style="display: none; color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.5em; letter-spacing: 0; text-align: left; font-weight: normal"></span>
<p style="text-indent: 0; padding: 8px 0; color: rgba(0, 0, 0, 1); font-size: 15px; line-height: 1.8em; letter-spacing: 0; text-align: left; font-weight: normal; margin: 0">https://archive.ph/</p>
</blockquote>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110230731.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿ä¸ªç½ç«ååé¢çâäºèç½æ¡£æ¡é¦âæå¤§çä¸ä¸ªå·®å¼æ¯âäºèç½æ¡£æ¡é¦âæ¯å®ä¸»å¨å»åâç½é¡µå¿«ç§âï¼ä»ä¹æ¶ååï¼ä»ä¹é¡µé¢åï¼å¹¶ä¸ä¸å®ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">èâarchive.todayâæ¯ä¸ä¸ªä½ å¯ä»¥å»ä¸»å¨å­æ¡£çç½ç«ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¯å¦ï¼è¿æ¯è¯´å reddit ä¸çé£ä¸ªå¸å­ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¸å­ä¸é¢æè¿æ ·çä¸ä¸ªåå¤ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110230932.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">è¿ä¸ªåå¤ä¸­çè¶é¾æ¥å°±æ¯åå¤èæ¾å°çå³äºè¿ä¸ªâçæâæ¯ AI çæçè¯æ®ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ç¹è¿å»æ¯è¿æ ·çï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110231156.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä»æä¾çæ¯ä¸ä¸ªç½é¡µå­æ¡£ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä¸ºä»ä¹ä»è¦è¿ä¹åå¢ï¼</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä½ æ³æ³ï¼å¦æä»æä¾ä¸ä¸ªåå§é¾æ¥ï¼ä½æ¯è¿ä¸ªåå§é¾æ¥çªç¶æä¸å¤©æ¾ä¸å°äºï¼å²ä¸æ¯å¾å°´å°¬ï¼</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä½æ¯åå¨âarchive.todayâä¸å­æ¡£ä¸ä¸ï¼ç¶åæè¿ä¸ªå­æ¡£åçé¾æ¥è´´åºæ¥ï¼å°±ç¨³å½å¤äºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä»¥åä½ è¦ä¿å­è¯æ®çè¯ï¼ä½ å°±å¯ä»¥ä½¿ç¨è¿ä¸ªç½ç«ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¦å¤ï¼è¿ä¸ªç½ç«è¿æä¸ä¸ªéªæä½ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">åèæ¯éªæä½è®©è¿ä¸ªç½ç«çæå¼çæ´é«ä¸ç¹ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å½å¤çä¸äºç½ç«å¯è½æäºæç« æ¯è¦ä»è´¹æè½çå°çã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æ¯å¦çº½çº¦æ¶æ¥ï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110234836.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">ä½æ¯ï¼å¦æä½ ä¸ä¸å°å¿æä»è´¹æç« çé¾æ¥è´´å¨è¿ä¸ªç½ç«ä¸å»æç´¢ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">æä¸äºâå¥½äºä¹äººâå·²ç»å¸®ä½ ææç« å¨è¿ä¸ªç½ç«ä¸åäºå¿«ç§äºï¼è¿äºäººå¯ä»¥ç§°ä¹ä¸ºâèµåè©è¨âï¼å ä¸ºè¿äºâè©è¨âï¼ä½ å°±å¯è½çå°åè´¹çåæäºï¼</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260110234948.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¨è¿éå ä¸ªç²åï¼å¶å°çå°ä¸ä¸¤ç¯çè¯å¯ä»¥è¿æ ·æä½ä¸ä¸ï¼å°±å½æ¶æ¯è¯çäºã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¦æç»å¸¸è¦ççè¯ï¼è¿æ¯åç¹é±å§ã</p>
<p data-tool="mdniceç¼è¾å¨" style="color: rgba(0, 0, 0, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0; text-align: left; text-indent: 0; margin: 0; padding: 8px 0">å¯¹äºï¼å¤è¯´ä¸å¥ï¼ä¸é¢æå°çç¥å¥çç½ç«æ¢ç¶å«åæ¶åè¶åï¼è¿æä¸äºèµåè©è¨ï¼è¿äºé­æ³ä¸çä¸­ææçä¸è¥¿ï¼é£è¯å®éè¦ä½ ä¼å¯¹åºçé­æ³åè¯­æè½è®¿é®å°ãå¦æä½ ä¸ä¼é­æ³ï¼å¼ºè¡è®¿é®ï¼é£ä½ è¯å®è¦æå°å¢ä¸ã</p>
<figure data-tool="mdniceç¼è¾å¨" style="margin: 10px 0; padding: 0; display: flex; flex-direction: column; justify-content: center; align-items: center"><img src="https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/20220716/20260111150634.png" alt="" style="display: block; margin: 0 auto; max-width: 100%; border: 3px none rgba(0, 0, 0, 0.4); border-radius: 0; object-fit: fill; box-shadow: 0 0 rgba(0, 0, 0, 0)"></figure>
</section>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-12 20:28">2026-01-12 20:27</span>&nbsp;
<a href="https://www.cnblogs.com/thisiswhy">whyææ¯</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19474147);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19474147', targetLink: 'https://www.cnblogs.com/thisiswhy/p/19474147', title: 'è¿ä¸¤ä¸ªç½ç«ï¼ä¸ä¸ªå¯ä»¥å½æ¶é´è¶åï¼ä¸ä¸ªåæ»¡äºèµåè©è¨ã' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ºä»ä¹æçäººè¯´âè¶èæç»´è¶åºåâï¼æä¹æè½å·å¤æé¿åæç»´ï¼ ]]></title>
    <link>https://www.cnblogs.com/jiujuan/p/19473443</link>
    <guid>479822263c1bd1690f8774de1e4e49ff</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jiujuan/p/19473443" title="åå¸äº 2026-01-12 18:25">
    <span role="heading" aria-level="2">ä¸ºä»ä¹æçäººè¯´âè¶èæç»´è¶åºåâï¼æä¹æè½å·å¤æé¿åæç»´ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="ä¸åè¨ä¸ºä»ä¹æçäººè¯´è¶èæç»´è¶åºå">ä¸ï¼åè¨ï¼ä¸ºä»ä¹æçäººè¯´è¶èæç»´è¶åºå</h2>
<p>å¨æ¥å¸¸çæ´»ä¸­ï¼æä»¬å¸¸å¸¸å¬å°è¿æ ·çè¯´æ³ï¼"äººèäºå°±åå¾åºæ§äº"ã"å¹´è½»äººçæ³æ³å°±æ¯çµæ´»"ã"ä¸­å¹´ä¹åå­¦ä¹ è½åå°±ä¸éäº"ã</p>
<p>è¿äºè§å¿µæ ¹æ·±èåºï¼ä»¥è³äºè®¸å¤äººå°å¹´é¾å¢é¿ä¸æç»´åºåç»ä¸ç­å·ï¼è®¤ä¸ºéçå²æçæ¨ç§»ï¼æ¹ååæé¿åå¾è¶æ¥è¶ä¸å¯è½ã</p>
<p>ç¶èï¼æ¯å¦ç¦å¤§å­¦å¿çå­¦å®¶å¡ç½å°Â·å¾·é¦åçç ç©¶å½»åºé¢ è¦äºè¿ä¸ä¼ ç»è®¤ç¥ï¼å¥¹æåºç"æé¿åæç»´"æ¦å¿µæ­ç¤ºäºä¸ä¸ªä»¤äººæ¯å¥çäºå®ï¼<br>
<strong>å¤§èå·æç»èº«å¯å¡æ§ï¼æç»´æ¨¡å¼çéæ©åå³äºæä»¬å¯¹å¾è½ååææçæåº¦ï¼èéä¸å¯æ¹åçççå®¿å½</strong>ã</p>
<p>æé¿åæç»´çæ ¸å¿ä¿¡å¿µï¼è½åæ¯å¯å¡çã</p>
<blockquote>
<p>è®¤ä¸ºäººçææºåè½åä¸æ¯å¤©ççåºå®å¼ï¼ææºåè½åæ¯å¯ä»¥éè¿åå¤©åªåï¼éè¿å»æç»ä¹ åç­ç¥æ¹è¿ï¼å¹¶é¿æåæï¼æ¯è½å¤ä¸æ­åå±æé«çã</p>
</blockquote>
<p>ä¸ä¹ç¸å¯¹çæ¯"åºå®åæç»´"ââç¸ä¿¡äººçåºæ¬è½åæ¯å¤©çåºå®å¼ãé¾ä»¥æ¹åçã</p>
<p>è¿ä¸¤ç§æç»´æ¨¡å¼å¹¶éç®åçæ§æ ¼æ ç­¾ï¼èæ¯å½±åçæä»¬å¨äººçé¶æ®µååºéæ©ãä¸ä¸ªæ¥ææé¿åæç»´çäººï¼ä¼å°æ«æè§ä¸ºå­¦ä¹ æºä¼ï¼å°æ¹è¯å½ä½åé¦ï¼å°åªåè§ä¸ºéåä¸æ­æé¿çå¿ç»ä¹è·¯ãèåºå®åæç»´çäººï¼åé¿ææï¼å°å¤±è´¥è§ä¸ºèªèº«ä¸è¶³ï¼åå¨èªå·±çèéåºã</p>
<h2 id="äºä¸¤ç§æç»´çç§å­¦åæ">äºï¼ä¸¤ç§æç»´çç§å­¦åæ</h2>
<h3 id="ç¥ç»ç§å­¦çè§åº¦æ¥ç">ç¥ç»ç§å­¦çè§åº¦æ¥ç</h3>
<p>æé¿åæç»´çé©å½æ§å¨äºå®å¯¹"è½å"è¿ä¸æ¦å¿µçéæ°å®ä¹ãä¼ ç»è§å¿µå¾å¾å°è½åè§ä¸ºæç§åºå®çå®¹å¨ââä½ çæ¥æå¤å¤§å®¹éï¼è¿è¾å­åºæ¬å°±å±éå¨è¿ä¸ªèå´åãå¾·é¦åçç ç©¶è¡¨æï¼è¿ç§è§£éæ¯çé¢çãäºå®ä¸ï¼äººç±»çå¤§èåè®¤ç¥è½åæ´åæ¯ä¸ççææï¼èéä¸ä¸ªæéçå®¹å¨ãè¿ççææè½å¤ä¸æ­æ©å±ãæ·±ååéæ°ç»ç»ï¼å¶æ½åè¿è¶æä»¬éå¸¸ææ³è±¡çèå´ã</p>
<p>ä»ç¥ç»ç§å­¦çè§åº¦æ¥çï¼å¤§èçå¯å¡æ§æ¯ç»èº«çã</p>
<p>è½ç¶å¤§èå¨éå°å¹´æ¶æç¡®å®ç»åçå§ççéå¡è¿ç¨ï¼ç¥ç»åä¹é´ççªè§¦è¿æ¥ç»åçå¤§è§æ¨¡çä¿®åªãè¿æ¥åå¼ºåï¼ä½è¿å¹¶ä¸æå³çæå¹´åå¤§èå°±å¤±å»äºæ¹åçè½åã</p>
<p>æ°çç¥ç»è¿æ¥å¯ä»¥å¨ä»»ä½å¹´é¾å½¢æï¼æ°çæè½å¯ä»¥è¢«å­¦ä¹ ï¼æ°çä¹ æ¯å¯ä»¥è¢«å¹å»ãåæ¡¥å¤§å­¦çä¸é¡¹ç ç©¶è¿½è¸ªäºæå¹´äººå¨å­¦ä¹ æ°æè½æ¶çå¤§èååï¼åç°å³ä½¿æ¯äºåå²ä»¥ä¸çæå¹´äººï¼å¨å­¦ä¹ å¤ææè½ï¼å¦æèææ°çè¯­è¨ï¼æ¶ï¼å¤§èç®å±çç»æä¹ä¼åçå¯æµéçååãè¿æå³çå¤§èå®åè®ºæ¬èº«å°±æ¯ä¸ä¸ªéè¦è¢«æå¼çåºå®åæç»´ã</p>
<h3 id="åºå®åæç»´å¿çè§åº¦æ¥ç">åºå®åæç»´å¿çè§åº¦æ¥ç</h3>
<p>çè§£åºå®åæç»´çè¿ä½æºå¶ï¼å¯¹äºæç ´å®è³å³éè¦ã</p>
<p>åºå®åæç»´å¹¶éç®åçä¸æ¿ææ¹åï¼èæ¯ä¸å¥å¤æçå¿çé²å¾¡ç³»ç»ã</p>
<p>è¿ä¸ªç³»ç»å¨æä»¬é¢å¯¹ææãæ«æåä¸ç¡®å®æ§æ¶èªå¨å¯å¨ï¼å¶æ ¸å¿åè½æ¯ä¿æ¤æä»¬çèªææ¦å¿µåèªå°ãå½æä»¬æ¥æåºå®åæç»´æ¶ï¼æ¯ä¸æ¬¡å¤±è´¥é½ä¸ä»ä»æ¯ä¸æ¬¡æ«æï¼èæ¯å¯¹èªæä»·å¼çå¦å®ï¼æ¯ä¸æ¬¡ææé½ä¸ä»ä»æ¯å­¦ä¹ æºä¼ï¼èæ¯æ´é²èªèº«ä¸è¶³çé£é©ã</p>
<p>å æ­¤ï¼åºå®åæç»´çäººä¼å¾åäºéæ©å®å¨çãè½å¤è¯æèªå·±è½åçä»»å¡ï¼åé¿é£äºå¯è½å¯¼è´å¤±è´¥çææã</p>
<p>è¿ç§æç»´æ¨¡å¼çå½¢æå¾å¾å¯ä»¥è¿½æº¯å°ç«¥å¹´æ¶æçç»åã<br>
å½ç¶æ¯åèå¸è¿åº¦å¼ºè°ç»æèéè¿ç¨ï¼å½æåè¢«å®ä¹ä¸º"èµ¢"èå¤±è´¥è¢«å®ä¹ä¸º"ä¸¢è¸"ï¼å½åªåè¢«è§ä¸ºå¤©èµä¸è¶³çæ å¿æ¶ï¼å¿ç«¥å°±éæ¸å½¢æäºå³äºè½ååæåçåºå®åä¿¡å¿µã</p>
<p>è¿äºä¿¡å¿µä¸æ¦ååï¼å°±ä¼æä¸ºè¿æ»¤ä¸çä¿¡æ¯çééââåæ ·çç»åä¼è¢«ä¸åæç»´æ¨¡å¼çäººååºæªç¶ä¸åçè§£è¯»ã</p>
<h2 id="ä¸ä¸¤ç§ä¸åæç»´çè¡¨ç°">ä¸ï¼ä¸¤ç§ä¸åæç»´çè¡¨ç°</h2>
<p>ä¸ä¸ªæ¥ææé¿åæç»´çäººéå°ä¸ä¼çäºæï¼ä¼æ³ï¼"æè¿æ²¡ææ¡è¿ä¸ªï¼ä½æå¯ä»¥éè¿ç»ä¹ æ¥æé«"ï¼èä¸ä¸ªæ¥æåºå®åæç»´çåå¯è½æ³ï¼"æå°±æ¯ä¸æé¿è¿ä¸ªï¼è¿æ¯å¤©çç"ã</p>
<p>è¿ç§è®¤ç¥å·®å¼ä¼å¨å¤å¹´åäº§çå·¨å¤§çç´¯ç§¯æåºï¼å½±åå­¦ä¸ãèä¸ãäººéå³ç³»åä»¥åççæ´»æåº¦ã</p>
<p>å¨å­¦ä¹ ä¸æé¿ç»´åº¦ä¸ï¼æ¥ææé¿åæç»´çäººå°éè¯¯è§ä¸ºå®è´µçåé¦ï¼å°å°é¾è§ä¸ºæé¿çå¬ååãä»ä»¬ç¸ä¿¡"ä¸ä¼"åªæ¯"ææ¶è¿ä¸ä¼"ï¼å æ­¤æ´æ¿æèµ°åºèéåºï¼æ¥åææã</p>
<p>å¨äººéå³ç³»ä¸­ï¼æé¿åæç»´å¸®å©äººä»¬å°å²çªè§ä¸ºçè§£åæ·±åå³ç³»çæºä¼ï¼èéè¯æå¯¹æ¹æ¯éçè¯æ®ã</p>
<p><strong>éè¦å¼ºè°çæ¯ï¼æé¿åæç»´å¹¶ä¸æå³çç²ç®ä¹è§æå¿½è§ç°å®</strong>ã</p>
<p>æé¿åæç»´æ¯å³äºè¿ç¨çæç»´ââå®æ¿è®¤å½åçç¶æï¼è®¤å¯åªåçä»·å¼ï¼ç¸ä¿¡æ¹è¿çå¯è½æ§ï¼åæ¶èè¸å®å°éåè¡å¨ã</p>
<p>ä¸¤ç§æç»´å¯¹æ¯å¾ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/650581/202601/650581-20260112193839386-1115149159.png" alt="æé¿åæç»´ååºå®åæç»´å¯¹æ¯å¾" loading="lazy"><br>
ï¼å¾çæ¥èªï¼å¡ç½å°Â·å¾·é¦åãç»èº«æé¿ãï¼</p>
<h2 id="åæ¯ä»ä¹é»ç¢äºæé¿åæç»´å½¢æ">åï¼æ¯ä»ä¹é»ç¢äºæé¿åæç»´å½¢æï¼</h2>
<h3 id="æ©ææè²çå½±å">æ©ææè²çå½±å</h3>
<p>ç«¥å¹´ç»åå¯¹æç»´æ¨¡å¼çå¡é å·æéå¤§çå½±åï¼è¿ç§å½±åå¾å¾å¨æä»¬è¿æ æ³ç¨è¯­è¨è¡¨è¾¾çæ¶åå°±å·²ç»å¼å§ã</p>
<p>å¿çå­¦å®¶è¯å«åºå ç§å¸åçæè²è¡ä¸ºï¼å®ä»¬å¨æ æä¸­å¼ºåäºåºå®åæç»´ã</p>
<p>ç¬¬ä¸ç§æ¯è¿åº¦èµç¾å¤©èµèéåªåãå½å­©å­å®ææä»¶äºæ¶ï¼å¦ææäººçåé¦éä¸­å¨âä½ çèªæâãâä½ çæå¤©èµâä¸ï¼å­©å­å°±ä¼å°è¿äºå¤å¨çãä¸å¯æ§çç¹è´¨ä¸èªæä»·å¼èç³»èµ·æ¥ãè¿æå³çå½ä»ä»¬éå°å°é¾æ¶ï¼ä¼æå¿å¤±å»èªæçæ ç­¾ï¼ä»èåé¿ææã</p>
<p>ç¬¬äºç§æ¯å°å¤±è´¥ä¸èº«ä»½ç­åãå¦æå­©å­å¨å¤±è´¥æ¶å¬å°çæ¯âä½ æä¹è¿ä¹ç¬¨âãâä½ ä¸è¡âè¿æ ·çè¯ï¼ä»ä»¬å°±ä¼å°å¤±è´¥ååä¸ºèªæå®ä¹çä¸é¨åï¼èä¸æ¯ä¸ä¸ªå¯ä»¥æ¹åçç¶æã</p>
<p>æè²ç¯å¢ä¸­çè¯ä»·ä½ç³»ä¹èµ·çå³é®ä½ç¨ãå½å­¦æ ¡åç¤¾ä¼é«åº¦å¼ºè°æ ååèè¯æç»©ãå½å­¦çè¢«æååæ¯è¾ãå½æ­£ç¡®ç­æ¡è¢«è¿åº¦å¼ºè°æ¶ï¼å­¦çå°±å­¦ä¼äºå³æ³¨ç»æèéè¿ç¨ï¼å³æ³¨è¯æèªå·±èéæåèªå·±ã</p>
<p>è¿ç§ç¯å¢ä¸ï¼å³ä½¿å£å¤´ä¸å¼ºè°è¿ç¨æ¯ç»æéè¦ï¼å®éè¡å¨ä¼ éçä¿¡æ¯å´æªç¶ç¸åãå­©å­ä»¬æ¯éå¸¸æéçä¿¡æ¯æ¥æ¶èï¼ä»ä»¬è½å¤ä»æäººè¡ä¸ºçç»å¾®å·®å«ä¸­ï¼å¤æ­ä»ä¹ææ¯çæ­£è¢«éè§çã</p>
<p>ç ç©¶è¡¨æï¼å¨å¼ºè°åªååè¿æ­¥çç¯å¢ä¸­æé¿çå­©å­ï¼ä¸ä»å­¦ä¸è¡¨ç°æ´å¥½ï¼èä¸é¢å¯¹æ«ææ¶æ´å åé§ï¼æ´æ¿æè¿½æ±æææ§çç®æ ã</p>
<p>å®¶åº­æ°å´ä¸­çéæ§ä¿¡æ¯åæ ·éè¦ã</p>
<p>å¦æç¶æ¯æ¬èº«ææåºå®åæç»´ââä¾å¦ç»å¸¸è¡¨è¾¾"æå°±æ¯ä¸æé¿æ°å­¦"æ"äººèäºå­¦ä¸äºæ°ä¸è¥¿"ââå­©å­å°±ä¼å¨è³æ¿¡ç®æä¸­å¸æ¶è¿äºè§å¿µã</p>
<p>æ´å¾®å¦çæ¯ï¼ç¶æ¯å¦ä½å¯¹å¾èªå·±çéè¯¯åå¤±è´¥ï¼ä¼ç´æ¥å½±åå­©å­å¯¹å¾è¿äºé®é¢çæ¹å¼ãå¦æç¶æ¯å¨ç¯éæ¶è¡¨ç°åºèªè´£ãç¾è»æé²å¾¡ï¼å­©å­å°±ä¼å°è¿äºæç»ªååºæ¨¡å¼ååã</p>
<p>ç¸åï¼å¦æç¶æ¯è½å¤å¹³éå°æ¿è®¤éè¯¯å¹¶è®¨è®ºæ¹è¿æ¹æ³ï¼å­©å­å°±å­¦ä¼äºä»¥æé¿åçæ¹å¼å¯¹å¾å¤±è¯¯ã</p>
<h3 id="å¤§èåè²ä¸è®¤ç¥åå">å¤§èåè²ä¸è®¤ç¥åå</h3>
<p>å¤§èåè²çå¤ææ§ä¸ºçè§£æç»´æ¨¡å¼æä¾äºç¥ç»çç©å­¦çåºç¡ã</p>
<p>åé¢å¶ç®å±ââè´è´£æ§è¡åè½ãè®¡åãå²å¨æ§å¶åæ½è±¡æç»´çå¤§èåºåââæ¯äººç±»å¤§èä¸­æææççåºåä¹ä¸ãå®çåè²ä»éæ¥æå¼å§ï¼ä¸ç´å»¶ç»­å°äºåäºå²å·¦å³ã</p>
<p>è¿æå³çå¹´è½»äººå¨å¤æ­ãè§ååè°èæç»ªæ¹é¢çè½åç¡®å®ä¸æå¹´äººå­å¨å·®å¼ï¼è¿å¨ä¸å®ç¨åº¦ä¸è§£éäºä¸ºä»ä¹éå°å¹´ææ¶ä¼ååºå²å¨çå³å®ãç¶èï¼è¿å¹¶ä¸æå³çå¹´è½»äººçæç»´å°±æ¯åºåçï¼æ°æ°ç¸åï¼éå°å¹´å¤§èçé«åº¦å¯å¡æ§ä½¿å¾è¿ä¸ªé¶æ®µæ¯å¹å»æé¿åæç»´çç»ä½³æ¶æºã</p>
<p>éçå¹´é¾å¢é¿ï¼å¤§èç¡®å®ä¼ç»åä¸äºååï¼æå¹´åï¼å¤§èä»ç¶ä¿æçå¯å¡æ§ï¼å°½ç®¡å¶è¿ä½æ¹å¼ä¸å¹´è½»æ¶æææä¸åã</p>
<p>èå¹´å¤§èå¨æäºæ¹é¢çè³å·æä¼å¿ï¼ç ç©¶è¡¨æï¼èå¹´äººå¨æ´åå¤æä¿¡æ¯ãæç»ªè°èåå©ç¨å·²æç¥è¯æ¹é¢å¾å¾è¡¨ç°åºè²ã</p>
<p>æè°çè®¤ç¥è¡°éå¨å¾å¤§ç¨åº¦ä¸æ¯å¯ä»¥è¢«çæ´»æ¹å¼å ç´ æå½±åçââåæ¬è®¤ç¥æ´»å¨ãç¤¾ä¼åä¸ãä½è²é»ç¼åé¥®é£ç­ãæ´éè¦çæ¯ï¼å¤§èçå¯å¡æ§æ¯åºåç¹å¼æ§çï¼è¿æå³çç¹å®ç±»åçè®­ç»å¯ä»¥å¨ç¸åºåºåå¢å¼ºåè½ï¼å³ä½¿å¨å¶ä»åºåå¯è½åºç°å¹´é¾ç¸å³ååçæåµä¸ä¹æ¯å¦æ­¤ã</p>
<p>å¼å¾å¼ºè°çæ¯ï¼ç¥ç»å¯å¡æ§æ¯ååçãå¤§èä¸ä»ä¼å ä¸ºä¸ä½¿ç¨è"çé"ï¼ä¹ä¼å ä¸ºç§¯æä½¿ç¨èåå±ãè¿è¢«ç§°ä¸º"ç¨è¿åºé"ååï¼å¨è®¤ç¥å¿çå­¦åç¥ç»ç§å­¦ä¸­æçååçå®è¯æ¯æã</p>
<p>æé¿åæç»´æ¬è´¨ä¸æ¯ä¸ç§å¯¹å¤§èå¯å¡æ§çä¿¡å¿µçä¸ç§âå©ç¨âãå½æä»¬ç¸ä¿¡æ¹åæ¯å¯è½çï¼æä»¬å°±ä¼æå¥åªåå»å®ç°æ¹åï¼èè¿ç§æå¥æ¬èº«åä¼ä¿è¿å®éçç¥ç»ååï¼å½¢æè¯æ§å¾ªç¯ã</p>
<h3 id="å¿çé²å¾¡æºå¶ä¸èéåºä¾èµ">å¿çé²å¾¡æºå¶ä¸èéåºä¾èµ</h3>
<p>ä»å¿çå­¦è§åº¦æ¥çï¼åºå®åæç»´å¨å¾å¤§ç¨åº¦ä¸æ¯ä¸ç§é²å¾¡æºå¶ãå®ä¿æ¤æä»¬ååå¤±è´¥åæ«æå¸¦æ¥ççè¦æè§ï¼ç»´æ¤æä»¬çèªæå½¢è±¡åèªå°ã</p>
<p>å½æä»¬å®³æå¤±è´¥æ¶ï¼åºå®åæç»´åè¯æä»¬ï¼"è¿ä¸æ¯çæ­£çæï¼åªæ¯æè¿æ²¡å±ç°åºæçæ½å"ï¼æè"å¦ææå°è¯äºä½å¤±è´¥äºï¼é£æè¯´ææççä¸è¡"ãéè¿åé¿ææï¼æä»¬é¿åäºå¤±è´¥çé£é©ï¼ä½ä¹åæ¶æç»äºæé¿çæºä¼ã</p>
<p>è¿ç§é²å¾¡æºå¶å¨ç­æåç¡®å®è½å¤åå°ç¦èåä¸éï¼ä½å¨é¿æä¸­å´å¯¼è´äºè½åçåæ»åæ½åçæµªè´¹ã</p>
<p>èéåºæ¯å¦ä¸ä¸ªéè¦çæ¦å¿µãæä»¬é½æä¸ç§å¾åï¼å°±æ¯åçå¨è®©æä»¬æå°å®å¨åçæçèå´åã</p>
<p>è¿ç§å¾åæ¬èº«å¹¶éé®é¢ï¼å®æ¯äººç±»è¿åè¿ç¨ä¸­å½¢æçæ­£å¸¸æºå¶ââå¨è¿å¤æ¶ä»£ï¼åé©ç¦»å¼çæçç¯å¢å¾å¾æå³çå±é©ã</p>
<p>ç¶èï¼å¨ç°ä»£ç¤¾ä¼ä¸­ï¼è¿åº¦ä¾èµèéåºä¼å¯¼è´æé¿åæ»ã</p>
<p>èéåºçé®é¢ä¸å¨äºå®æ¬èº«ï¼èå¨äºæä»¬ç¨å®ä½ä¸ºåé¿æé¿ææçåå£ãæä»¬å¯è½æ»¡è¶³äºå¤ç¨çæè½ï¼åé¿ç²¾éæéçå¤§éç»ä¹ ï¼æ»¡è¶³äºè¿å¾å»çå³ç³»ï¼åé¿å»ºç«æ´æ·±è¿æ¥æéçèå¼±åå¦è¯ï¼æ»¡è¶³äºå¯è¡çè§£å³æ¹æ¡ï¼åé¿å¯»æ¾æ´ä¼æ¹æ¡æéçåæ°åé£é©æ¿æã</p>
<p>èº«ä»½è®¤åçåºåæ¯åºå®åæç»´çæ·±å±è¡¨ç°ã</p>
<p>å½æä»¬å°èªå·±å®ä¹ä¸º"ææ¯æç§äºº"æ¶ï¼è¿ç§å®ä¹å°±æä¸ºäºèªæéå¶çæ¡æ¶ã"ææ¯ä¸ä¸ªä¸æé¿æ°å­¦çäºº"ã"ææ¯ä¸ä¸ªååçäºº"ã"ææ¯ä¸ä¸ªæ²¡æåé åçäºº"ââè¿äºèªæå®ä¹ä¸æ¦å½¢æï¼å°±ä¼æå¯¼æä»¬éæ©æ§å°æ¥è§¦é£äº"ç¬¦å"æä»¬èº«ä»½çä¿¡æ¯åç»éªï¼åé¿é£äºå¯è½æææä»¬èº«ä»½çå¯è½æ§ã</p>
<p>æé¿åæç»´è¦æ±æä»¬æç ´è¿ç§èº«ä»½åºåï¼è®¤è¯å°èº«ä»½ä¸æ¯åºå®çæ ç­¾ï¼èæ¯å¯ä»¥ä¸æ­æ©å±åéæ°å®ä¹çã</p>
<h2 id="äºæä¹çªç ´éç¢æåªäºæ¹æ³">äºï¼æä¹çªç ´éç¢ï¼æåªäºæ¹æ³ï¼</h2>
<h3 id="è®¤ç¥éæä»åå¨å¯¹è¯å¼å§">è®¤ç¥éæï¼ä»åå¨å¯¹è¯å¼å§</h3>
<p>æé¿åæç»´çæ ¸å¿å¨äºæä»¬å¦ä½è§£è¯»èªå·±çç»åââç¹å«æ¯é£äºå°é¾åææçæ¶å»ã</p>
<p>è®¤ç¥éææ¯ä¸ç§ç³»ç»æ§çæ¹æ³ï¼å¸®å©æä»¬è¯å«åæ¹åé£äºå¼ºååºå®åæç»´çåå¨å¯¹è¯ã</p>
<p>è¿ä¸ªè¿ç¨å§äºå¯¹èªææç»´çè§å¯ãæä»¬éè¦å­¦ä¼æ³¨æå°èªå·±ä»ä¹æ¶åå¨ä½¿ç¨åºå®åæç»´çè¯­è¨ââ"æå°±æ¯ä¸æé¿è¿ä¸ª"ã"è¿è¯ææä¸è¡"ã"å¦ææå°è¯äºä½å¤±è´¥äºå¤ªä¸¢äººäº"ãä¸æ¦è¯å«åºè¿äºæç»´æ¨¡å¼ï¼æä»¬å°±å¯ä»¥ææè¯å°ææåéæå®ä»¬ã</p>
<p>è®¤ç¥éæçå·ä½ææ¯åæ¬å ä¸ªå±æ¬¡ã</p>
<ul>
<li>
<p>é¦åæ¯è¯æ®æ£éªââå½æä»¬äº§ç"æä¸æé¿è¿ä¸ª"çæç»´æ¶ï¼é®èªå·±ï¼è¿ä¸ªç»è®ºçè¯æ®æ¯ä»ä¹ï¼æä»ä¹è¯æ®ä¸è¿ä¸ªç»è®ºçç¾ï¼éå¸¸æä»¬ä¼åç°ï¼åºå®åæç»´çç»è®ºæ¯åºäºå°æ°è´é¢ç»åï¼èå¿½è§äºæ­£é¢ç»ååæ¹åçå¯è½æ§ã</p>
</li>
<li>
<p>å¶æ¬¡æ¯å½å éå¡ââå°å¤±è´¥å½å äºå¯æ§å ç´ ï¼å¦åªåç¨åº¦ãç­ç¥éæ©ï¼èéä¸å¯æ§å ç´ ï¼å¦å¤©èµãè¿æ°ï¼ï¼è¿æ ·å¤±è´¥å°±åæäºå¯ä»¥æ¹è¿çé®é¢ï¼èéåºå®çèº«ä»½ç¹å¾ã</p>
</li>
<li>
<p>ç¬¬ä¸æ¯æ¡æ¶è½¬æ¢ââå°"æåä¸å°"è½¬æ¢ä¸º"æææ¶è¿åä¸å°"ï¼å°"è¿å¤ªé¾äº"è½¬æ¢ä¸º"è¿éè¦æ´å¤æ¶é´åç»ä¹ "ï¼å°"å¤±è´¥æ¯åäº"è½¬æ¢ä¸º"å¤±è´¥æä¾äºå­¦ä¹ çæºä¼"ã</p>
</li>
</ul>
<p>å»ºç«æ¯ææ§çèªæå¯¹è¯æ¯è®¤ç¥éæçæç»­å®è·µã</p>
<p>å½æä»¬ç¯éæéå°å°é¾æ¶ï¼åå¨çæ¹è¯å£°é³å¾å¾ä¼å å§çè¦åé²å¾¡ï¼èé¼å±åæ¯æçå£°é³åè½ä¿è¿å­¦ä¹ åæé¿ãæé¿åæç»´è¦æ±æä»¬å°è¿ç§æ¯ææ§çå£°é³ååï¼æä¸ºé¢å¯¹æææ¶çé»è®¤ååºãè¿éè¦å»æç»ä¹ ï¼å°±åå¹å»ä»»ä½æ°ä¹ æ¯ä¸æ ·ã</p>
<h3 id="è¡ä¸ºæ¹åè¡å¨å¡é æç»´">è¡ä¸ºæ¹åï¼è¡å¨å¡é æç»´</h3>
<p>æç»´åè¡å¨æ¯ç¸äºå½±åçââæ¹åå¶ä¸­ä¸ä¸ªå¾å¾ä¼å¯¼è´å¦ä¸ä¸ªçæ¹åãä»ä»å¨è®¤ç¥ä¸çè§£æé¿åæç»´æ¯ä¸å¤çï¼æä»¬éè¦éè¿è¡ä¸ºæ¥å¼ºååæ·±åå®ã</p>
<p>éæ©æææ§ä»»å¡æ¯å¹å»æé¿åæç»´æç´æ¥çè¡ä¸ºæ¹å¼ãå½æä»¬ä¸»å¨éæ©é£äºéè¦åªåååææè½å®æçä»»å¡æ¶ï¼æä»¬å°±å¨ç¨è¡å¨åèªå·±è¯æï¼è½åæ¯å¯ä»¥åå±çï¼åªåæ¯ææçãè¿ç§è¡ä¸ºäº§ççæ°æ®æ¯ä»»ä½è¨è¯­é½æ´æè¯´æåã</p>
<p>å·ä½æ¥è¯´ï¼å¯ä»¥ä»å°å¤å¼å§ãéæ©ä¸ä¸ªä½ è®¤ä¸ºèªå·±"ä¸æé¿"çé¢åï¼æå¥æ¶é´åç²¾åå»å­¦ä¹ åç»ä¹ ãæ³¨æè§å¯è¿ä¸ªè¿ç¨ä¸­çååââæåçæè§ãéæ¸çè¿æ­¥ãéå°çå°é¾åçªç ´ã</p>
<p>è¿ç§äº²èº«ä½éªæ¯çè®ºæ´è½è¯´æä½ ï¼è½åç¡®å®æ¯å¯ä»¥åå±çãéè¦çæ¯éæ©éåº¦ææçä»»å¡ââå¤ªå®¹æçä»»å¡æ æ³ä¿è¿æé¿ï¼å¤ªé¾çä»»å¡å¯è½å¯¼è´æ«è´¥ãæä½³çéæ©æ¯é£äºéè¦åªåä½ä¸æ¯ä¸å¯è½å®æçä»»å¡ã</p>
<p>å»ºç«åé¦å¾ªç¯æ¯å¦ä¸ä¸ªéè¦çè¡ä¸ºç­ç¥ãæé¿åæç»´éè¦åæ¶ãåç¡®çåé¦æ¥è°æ´åªåçæ¹åãä»ä»åªåæ¯ä¸å¤çââæä»¬éè¦ç¥éåªåæ¯å¦ææï¼åªééè¦è°æ´ã</p>
<p>è¿æå³çä¸»å¨å¯»æ±åé¦ï¼æ è®ºæ¯æ¥èªèå¸ãåäºãæåè¿æ¯èªæåæãè®°å½è¿å±ãåé¡¾ç®æ è¾¾ææåµãè¯å®å°è¯ä¼°èªå·±çè¡¨ç°ââè¿äºé½æ¯å»ºç«ææåé¦å¾ªç¯çæ¹æ³ãæ²¡æåé¦ï¼æä»¬å¯è½åªæ¯å¨éå¤æ æçåªåï¼æèéè¿äºæ¹è¿çæºä¼ã</p>
<h3 id="ä¹ æ¯å»æå°æé¿ä¹ æ¯å">ä¹ æ¯å»æï¼å°æé¿ä¹ æ¯å</h3>
<p>æé¿åæç»´å¦æåªæ¯å¶å°çè§æï¼å¶æææ¯æéçã</p>
<p>çæ­£çæä¹æ¹åéè¦å°æé¿åæç»´è½¬åä¸ºèªå¨çä¹ æ¯ãè¿éè¦çè§£ä¹ æ¯çè¿ä½æºå¶ââä¹ æ¯ç±è§¦åãè¡ä¸ºåå¥å±ä¸é¨åç»æãè®¾è®¡æ¯ææé¿åæç»´çä¹ æ¯ï¼æå³çå°æé¿å¯¼åçè¡ä¸ºä¸ç§¯æçææä½éªèç³»èµ·æ¥ï¼ä½¿å¶éæ¸èªå¨åã</p>
<p>å·ä½çæ¹æ³åæ¬å»ºç«å®æåæçä¹ æ¯ã</p>
<p>æ¯å¨ææ¯æè±æ¶é´åé¡¾èªå·±çå­¦ä¹ åæé¿ï¼éå°äºä»ä¹ææï¼ä»ä¸­å­¦å°äºä»ä¹ï¼ä¸æ¬¡å¯ä»¥å¦ä½æ¹è¿ï¼è¿ç§åæä¸ä»æä¾åé¦ï¼è¿å¼ºåäºæé¿æ¯éè¦çãå¼å¾å³æ³¨çè¿ä¸ä¿¡å¿µã</p>
<p>è®°å½æé¿æ¥å¿ä¹æ¯ç±»ä¼¼çæ¹æ³ââè®°å½é£äºå°é¾æ¶å»ãå¦ä½åºå¯¹çãä»ä¸­è·å¾äºä»ä¹ãè¿äºè®°å½æä¸ºå¯è§çæé¿è¯æ®ï¼å¯ä»¥ç¨æ¥å¯¹æåºå®åæç»´çæ¶æç»è®ºã</p>
<p>å°æé¿è¯­è¨èå¥æ¥å¸¸äº¤æµä¹å¾éè¦ã</p>
<p>æ³¨æèªå·±ä½¿ç¨çè¯­è¨ï¼ç¹å«æ¯å¯¹ä»äººï¼ç¹å«æ¯å­©å­åå­¦çï¼çåé¦ãç¨"ä½ éè¿åªåæé«äº"ä»£æ¿"ä½ çèªæ"ï¼ç¨"ä½ è¿æ²¡ææ¡è¿ä¸ªæå·§ï¼ä½æä»¬ä¸èµ·æ¥æ¾æ¹æ³"ä»£æ¿"ä½ ä¸è¡"ã</p>
<p>è¿ç§è¯­è¨ä¸ä»å½±åä»äººï¼ä¹éæ¸æ¹åèªå·±çæç»´ä¹ æ¯ãå¨å­©å­æè²ä¸­ï¼è¿ä¸ç¹å°¤ä¸ºéè¦ââç¶æ¯åèå¸ä½¿ç¨çè¯­è¨ç±»åå¯ä»¥å¡é å­©å­çæç»´æ¨¡å¼ã</p>
<h3 id="ç¯å¢è®¾è®¡åé æ¯ææ§çæç³»ç»">ç¯å¢è®¾è®¡ï¼åé æ¯ææ§çæç³»ç»</h3>
<p>ç¯å¢å¯¹æç»´æ¨¡å¼çå½±åå¾å¾è¢«ä½ä¼°ã</p>
<p>æä»¬æå¤çç©çç¯å¢ãç¤¾äº¤ç¯å¢åæåç¯å¢æç»­ä¸æ­å°åæä»¬ä¼ éä¿¡æ¯ï¼å½±åæä»¬çæç»´åè¡ä¸ºã</p>
<p>è®¾è®¡ä¸ä¸ªæ¯ææé¿åæç»´çç¯å¢ï¼æå³çææè¯å°åé é£äºé¼å±å­¦ä¹ ãæ¥åææãéè§æé¿çæ¡ä»¶ãè¿ä¸ä»åæ¬ç©çç¯å¢çå®æï¼æ´éè¦çæ¯ç¤¾äº¤ç¯å¢çæå»ºã</p>
<p>ç©çç¯å¢çè®¾è®¡å¯ä»¥ä¿è¿æé¿åæç»´ãå±ç¤ºèªå·±æä»äººæé¿è¿ç¨çç©åï¼å¦æ©æçä½ååç°å¨çä½åçå¯¹æ¯ï¼ãæ¾ç½®æ¿å±æ§çä¹¦ç±åèµæãåé å¯ä»¥ä¸æ³¨å­¦ä¹ ååé çç©ºé´ââè¿äºé½å¨æ å½¢ä¸­ä¼ éçæé¿çä¿¡æ¯ãç¸åï¼è¿åå¼ºè°æå°±åæåçç¯å¢å¯è½å¼ºååºå®åæç»´ï¼å ä¸ºå®ä»¬å¼ºè°çæ¯ç»æèéè¿ç¨ã</p>
<p>ç¤¾äº¤ç¯å¢çè®¾è®¡åæ ·å³é®ãå¯»æ¾åå»ºç«é£äºéè§æé¿ãæ¯ææ¹åçç¤¾ç¾¤ââå­¦ä¹ å°ç»ãå´è¶£ç¤¾ç¾¤ãå¯¼å¸å³ç³»ç­ãå¨è¿äºç¤¾ç¾¤ä¸­ï¼åäº«å°é¾åå¤±è´¥æ¯è¢«é¼å±çï¼åªååè¿æ­¥æ¯è¢«è®¤å¯çï¼æ°å°è¯æ¯è¢«æ¯æçãç¸åï¼é£äºå¼ºåæ¯è¾ãç«äºåèªææ ç­¾çç¤¾äº¤ç¯å¢ä¼å¼ºååºå®åæç»´ã</p>
<h2 id="å­ç»èº«æé¿ä¸æä¹">å­ï¼ç»èº«æé¿ä¸æä¹</h2>
<h3 id="æ´å¤§è§è§ä¸çç»èº«æé¿">æ´å¤§è§è§ä¸çç»èº«æé¿</h3>
<p>æé¿åæç»´ä¸æ¯ä¸ä¸ªéè¦å¨æä¸ªå¹´é¾é¶æ®µå®æçä»»å¡ï¼èæ¯è´¯ç©¿æ´ä¸ªçå½å¨æçæç»­å®è·µã</p>
<p>çæ­£çè§£æé¿åæç»´æå³çè®¤è¯å°ï¼æ è®ºå¤äºä»ä¹å¹´é¾ï¼æ è®ºå·²ç»åå¾äºä»ä¹æå°±ï¼æ»ææ´å¤å¯ä»¥å­¦ä¹ ãåå±åè´¡ç®çç©ºé´ã</p>
<p>è¿ç§è®¤è¯æ¬èº«å°±å·æè§£æ¾æ§ââå®è§£é¤äº"å·²ç»å¤ªæäº"æ"å·²ç»è¶³å¤å¥½äº"çèªæéå¶ï¼è®©çå½ä¿æå¼æ¾åå¯è½ã</p>
<p>ä»æ´åçè§è§æ¥çï¼äººççåä¸ªé¶æ®µä¸æ¯å½¼æ­¤å²è£çï¼èæ¯ç¸äºèç³»ãç¸äºä¸°å¯çã</p>
<p>éå¹´æ¶æçç­æååé©ãä¸­å¹´æ¶æçæ·±åº¦åæºæ§ãèå¹´æ¶æçæ²æ·åè¶è¶ââè¿äºåè´¨å¯ä»¥ç¸äºæ¸éï¼åé åºç¬ç¹ççå½å½¢æã</p>
<p>ä¸ä¸ªæ¥ææé¿åæç»´çå¹´è½»äººå¯ä»¥å¹å»èå¹´äººçæ²ç¨³åè¿è§ï¼ä¸ä¸ªæ¥ææé¿åæç»´çä¸­å¹´äººå¯ä»¥ä¿æå¹´è½»äººçå¥½å¥åå¼æ¾ï¼ä¸ä¸ªæ¥ææé¿åæç»´çèå¹´äººå¯ä»¥è´¡ç®å¹´è½»äººçæ´»åååé åã</p>
<p>è¿ç§è·¨å¹´é¾çåè´¨æ´åï¼æ¯æé¿åæç»´å¨çå½å±é¢çæé«ä½ç°ã</p>
<h3 id="æé¿åæç»´ä¸æä¹å»ºæ">æé¿åæç»´ä¸æä¹å»ºæ</h3>
<p>æé¿åæç»´çæ·±å±ä»·å¼ä¸ä»å¨äºæé«è½ååæå°±ï¼æ´å¨äºå»ºæææä¹çäººçã</p>
<p>å½æä»¬ç¸ä¿¡æ¹åæ¯å¯è½çï¼æä»¬å°±ä¸ä¼è¢«å½åçå°å¢æå®ä¹ï¼å°±è½å¤çå°æªæ¥çå¯è½æ§ï¼å°±æè½åå¨å°é¾ä¸­æ¾å°æä¹ã</p>
<p>è¿ç§æä¹å»ºæçè½åæ¯å¿çå¥åº·åäººçæ»¡æåº¦çæ ¸å¿è¦ç´ ãç ç©¶è¡¨æï¼é£äºè½å¤å¨æ«æä¸­å¯»æ¾æä¹çäººï¼æ¯é£äºåªå³æ³¨ç»æçäººæ´æå¯è½ä»éå¢ä¸­æ¢å¤ï¼å¹¶å¨é¿æä¸­åå¾æ´å¥½çç»æã</p>
<p>æé¿åæç»´ä¹æå³çå¯¹çå½æ¬èº«çå¼æ¾æåº¦ã</p>
<p>æ¯ä¸ä¸ªäººçé¶æ®µé½æå¶ç¬ç¹çææåæºéï¼æ¯ä¸ä¸ªç»åââæ è®ºæ¯æåçè¿æ¯å¤±è´¥çââé½å¯ä»¥æä¸ºæé¿çç´ æãå½æä»¬ç¨è¿ç§ç¼åçå¾çæ´»æ¶ï¼çæ´»å°±ä¸åæ¯å¿é¡»ç¬è¿å»çé¶æ®µï¼èæ¯å¼å¾æ´»åºæ¥çæç¨ãè¿ç§æåº¦ä¸æ¯ç²ç®çä¹è§ï¼èæ¯åºäºå¯¹äººç±»æ½åçæ·±å»çè§£åä¿¡ä»»ã</p>
<h2 id="ä¸æåéæ°å®ä¹å¯è½æ§">ä¸ï¼æåï¼éæ°å®ä¹å¯è½æ§</h2>
<p>"è¶èè¶åºæ§"ä¸å¶è¯´æ¯ä¸ä¸ªä¸å¯é¿åçççå½è¿ï¼ä¸å¦è¯´æ¯ä¸ä¸ªèªæå®ç°çé¢è¨ã</p>
<p>å®ä¹æä»¥æµè¡ï¼æ¯å ä¸ºå®åæ äºè®¸å¤äººççå®ä½éªââä»ä»¬ç¡®å®æå°éçå¹´é¾å¢é¿ï¼æ¹ååå¾æ´å å°é¾ãç¶èï¼è¿ç§ä½éªçåå æ¯å¤æçï¼å¯è½åæ¬ä¹ æ¯çå¼ºåãèº«ä»½çåºåãç¤¾ä¼ææçååï¼ä»¥åå¤§èæäºå å·¥éåº¦çèªç¶ååãä½è¿äºåå å¹¶ä¸æå³çæé¿åæç»´æ¯ä¸å¯è½çï¼å®ä»¬åªæ¯æå³çæä»¬éè¦æ´å»æå°å¹å»åé»ç¼è¿ç§æç»´æ¨¡å¼ã</p>
<p>æé¿åæç»´æ¯ä¸ç§éæ©ââéæ©ç¸ä¿¡æ¹åæ¯å¯è½çï¼éæ©å°ææè§ä¸ºæºä¼ï¼éæ©ç¨è¿ç¨èéç»ææ¥å®ä¹èªå·±ãè¿ç§éæ©ä¸åå¹´é¾éå¶ãè½ç¶ä¸åå¹´é¾é¶æ®µé¢ä¸´çææä¸åï¼ä½æé¿çå¯è½æ§æ¯æ®éçãä¸ä¸ªäºåå²çäººå¯ä»¥éæ©ç»´æç°ç¶ï¼æç»å­¦ä¹ åæ¹åï¼ä¸ä¸ªä¸åå²çäººå¯ä»¥éæ©æ¥æ±æ°äºç©ï¼æç»­æé¿ååå±ãå³å®å ç´ ä¸æ¯å¹´é¾ï¼èæ¯å¯¹æé¿çæåº¦åæ¿è¯ºã</p>
<p>æç»ï¼æé¿åæç»´æ¯ä¸ç§å³äºäººçå¯è½æ§çä¿¡å¿µã</p>
<p>å®åè¯æä»¬ï¼äººä¸åºè¯¥è¢«ä»»ä½æ ç­¾æå®ä¹ââæ è®ºè¿ä¸ªæ ç­¾æ¯å¹´é¾ãè½åãèæ¯è¿æ¯è¿å»çç»åãè¿ç§ä¿¡å¿µä¸æ¯å¦è®¤éå¶ï¼èæ¯ç¸ä¿¡å¨éå¶ä¹ååä¹å¤ï¼é½å­å¨çæªè¢«åæçæ½åã</p>
<p>å¹å»åç»´ææé¿åæç»´ï¼å°±æ¯éæ©æ´»å¨è¿ç§å¯è½æ§çç©ºé´ä¸­ï¼ä¸æ­æ©å±èªå·±çè¾¹çï¼åæ¶æ¥çº³åçè§èªå·±ç¬ç¹ççå½æç¨ãå¨è¿ä¸ªæä¹ä¸ï¼æé¿åæç»´ä¸ä»æ¯ä¸ç§è®¤ç¥ç­ç¥ï¼æ´æ¯ä¸ç§çå½æåº¦ââä¸ç§å¯¹çå½çå¼æ¾ãå¥½å¥ååæ¢çæåº¦ã</p>
<h2 id="åè">åè</h2>
<ul>
<li>ãç»èº«æé¿ã<a href="https://book.douban.com/subject/27154533/" target="_blank" rel="noopener nofollow">https://book.douban.com/subject/27154533/</a></li>
<li>ãä¸å¼ºå¿çç¶æ¯ï¼æè²å­©å­è¦æå¿çå­¦ã<a href="https://book.douban.com/subject/37233750/" target="_blank" rel="noopener nofollow">https://book.douban.com/subject/37233750/</a></li>
<li>ãè®¤ç¥è§éã<a href="https://book.douban.com/subject/35193035/" target="_blank" rel="noopener nofollow">https://book.douban.com/subject/35193035/</a></li>
<li>å¦ä½ä»åºå®åæç»´è½¬åä¸ºæé¿åæç»´ï¼-ç¥ä¹é®ç­ï¼<a href="https://www.zhihu.com/question/21099982" target="_blank" rel="noopener nofollow">https://www.zhihu.com/question/21099982</a></li>
<li>ãå¯å¡çæï¼èªæåå±å¿çå­¦ç35å å¿ä¿®è¯¾ã<a href="https://book.douban.com/subject/35388653/" target="_blank" rel="noopener nofollow">https://book.douban.com/subject/35388653/</a></li>
</ul>

</div>
<div id="MySignature" role="contentinfo">
    == just do it ==
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.052083333333333336" data-date-updated="2026-01-12 19:40">2026-01-12 18:25</span>&nbsp;
<a href="https://www.cnblogs.com/jiujuan">ä¹å·</a>&nbsp;
éè¯»(<span id="post_view_count">49</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19473443);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19473443', targetLink: 'https://www.cnblogs.com/jiujuan/p/19473443', title: 'ä¸ºä»ä¹æçäººè¯´âè¶èæç»´è¶åºåâï¼æä¹æè½å·å¤æé¿åæç»´ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åºäº nano-vLLM å­¦ä¹ å¤§æ¨¡åæ¨çå³é®åè½ ]]></title>
    <link>https://www.cnblogs.com/cswuyg/p/19471225</link>
    <guid>bf8764e806e486971452e1672f4b5754</guid>
    <description>
    <![CDATA[ 
	<div class="postTitle">
		<h1><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/cswuyg/p/19471225" title="åå¸äº 2026-01-12 12:38">
    <span role="heading" aria-level="2">åºäº nano-vLLM å­¦ä¹ å¤§æ¨¡åæ¨çå³é®åè½</span>
    

</a>
</h1>
	</div>
	<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<blockquote>æ³¨ï¼æ¬æå·²äº2025.12.31 åè¡¨äºç¥ä¹åå¬ä¼å·</blockquote>
<h1 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="avn4e-0-0"><span data-offset-key="avn4e-0-0">1. èæ¯</span></h1>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="7ouoo-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="7ouoo-0-0"><span data-offset-key="7ouoo-0-0">å¦æè¦åä¸ä½å®å¨ä¸äºè§£å¤§æ¨¡åæ¨çææ¯çå¼åèä»ç»è¿ä¸ªé¢åï¼æåºè¯¥ä»åªéè®²èµ·ï¼</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="6ps33-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="6ps33-0-0"><span data-offset-key="6ps33-0-0">å¤§æ¨¡åæ¨ççæç®æµç¨å¯ä»¥æ¦æ¬ä¸ºï¼è¾å¥ä¸ä¸²ææ¬ â ææ¬éè¿è¯å¸æ å°è¡¨è½¬æ¢æä¸ä¸²æ°å­åºå· â åºå·åç»è¿ embedding å±çè®¡ç®ï¼åæä¸ç»è½ä»£è¡¨è¯­ä¹çæµ®ç¹æ°åé â è¿ç»åééå¥æ¨çç³»ç»ï¼ç»è¿å±å±çç©éµä¹æ³ãå æ³ååç±»ä¸ç¨å½æ°çè¿ç®ï¼å¾å°æ°çè¾åºåé â å¯¹è¾åºåéåæ¦çç­éï¼éåºæ¦çæé«çé£ä¸ªæ°å¼å¯¹åºçåºå· â æååéè¿è¯å¸æ å°è¡¨ âç¿»è¯â åæå­ï¼å¾å°æç»è¾åºçä¸ä¸ªè¯ã</span></div>
</div>
<div class="Image-captionContainer" data-size="normal">
<div class="Image-resizerContainer css-ym3v7r" data-size="normal">
<div class="css-79elbk">
<div class="ImageDelete-Container css-xi606m">
<div class="ImageDelete-Wrapper css-1gomreu"><img src="https://pic1.zhimg.com/80/v2-52738e1009b99b73843b74399250f825_1440w.png?source=ccfced1a" width="877" height="204" class="Image FocusPlugin--unfocused Image--isBlock css-1phd9a0" loading="lazy" style="display: block; margin-left: auto; margin-right: auto" data-size="normal" data-rawwidth="2052" data-rawheight="478" data-watermark="original" data-original-src="https://picx.zhimg.com/v2-52738e1009b99b73843b74399250f825.jpg?source=ccfced1a" data-watermark-src="https://pic1.zhimg.com/v2-9a8c84bc6a77d0b121efaf2adca21dc7_1440w.jpg?source=ccfced1a">
<div class="ImageEdit-button css-187js3w" style="text-align: center">å¾ 1&nbsp;</div>
<div class="ImageEdit-button css-187js3w"><span data-offset-key="5galm-0-0">è¿æ¯å¯¹å¤§æ¨¡åæ¨çææ´ç´ ççè§£ï¼ä¸è¿°æµç¨çä¼¼ç®åï¼ä½èåçæ¨çè®¡ç®ç¯èå¯¹æ®éå¼åèèè¨ä»æ¯ä¸ä¸ª âé»çâãå¦ææ³æ´è¿ä¸æ­¥æè§£æ¨çå¼æçåºå±å éåçï¼nano-vllm ä¼æ¯ä¸ä¸ªæä½³çå¥é¨åå¥ç¹ã</span></div>
</div>
</div>
</div>
</div>
</div>
<h1 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="5jkt4-0-0"><span data-offset-key="5jkt4-0-0">2. ç®ä»</span></h1>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="34rn0-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="34rn0-0-0"><a class="Link ztext-link" href="https://github.com/GeeeekExplorer/nano-vllm" target="_blank" data-offset-key="34rn0-0-0" data-editable="true" data-draft-title="nano-vLLM" rel="noopener nofollow">nano-vLLM</a><span data-offset-key="34rn0-1-0"> ä»£ç éä»çº¦ 1200 è¡ï¼å´å®ç°äºçäº§çº§æ¨çæ¡æ¶çæ ¸å¿ææ¯ååï¼å·ä½åæ¬ï¼</span></div>
</div>
<ul class="public-DraftStyleDefault-ul" data-offset-key="56lsc-0-0">
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="56lsc-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="56lsc-0-0"><span data-offset-key="56lsc-0-0">è¿ç»­æ¹å¤çï¼Continuous Batchingï¼</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="b1vo5-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="b1vo5-0-0"><span data-offset-key="b1vo5-0-0">KV ç¼å­ï¼Prefix KV Cache / Paged KV Cacheï¼</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="fckbm-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="fckbm-0-0"><span data-offset-key="fckbm-0-0">é«æ§è½ç¼è¯ä¸æ§è¡ä¼åï¼Torch CompilationãTritonãCUDA Graphï¼</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="96skh-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="96skh-0-0"><span data-offset-key="96skh-0-0">å¼ éå¹¶è¡ï¼Tensor Parallelismï¼</span></div>
</li>
</ul>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="etuu5-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="etuu5-0-0"><span data-offset-key="etuu5-0-0">è¯¥æ¡æ¶æå·å¥é¨å­¦ä¹ ä»·å¼ï¼æ¬æå°åä»ç» nano-vLLM çåºæ¬ç»ææ¶æï¼åå¯¹é¨åæ ¸å¿ææ¯è¦ç¹å±å¼æ·±å¥è§£æã</span></div>
</div>
<h1 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="dhpij-0-0"><span data-offset-key="dhpij-0-0">3. ç³»ç»æ¶æ</span></h1>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="9fnhn-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="9fnhn-0-0"><span data-offset-key="9fnhn-0-0">nano-vLLM çæ¶æéå¸¸æå±æ¬¡æã</span></div>
</div>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="6ai7a-0-0"><span data-offset-key="6ai7a-0-0">3.1. æ´ä½æ¶ææ¦è§</span></h2>
<div class="Image-captionContainer" data-size="normal">
<div class="Image-resizerContainer css-ym3v7r" data-size="normal">
<div class="css-79elbk">
<div class="ImageDelete-Container css-xi606m">
<div class="ImageDelete-Wrapper css-1gomreu"><img src="https://picx.zhimg.com/80/v2-41cd766bd06373d580df6302b2ba3203_1440w.png?source=ccfced1a" width="655" height="403" class="Image FocusPlugin--unfocused Image--isBlock css-1phd9a0" loading="lazy" style="display: block; margin-left: auto; margin-right: auto" data-size="normal" data-rawwidth="1846" data-rawheight="1136" data-watermark="original" data-original-src="https://picx.zhimg.com/v2-41cd766bd06373d580df6302b2ba3203.jpg?source=ccfced1a" data-watermark-src="https://pic1.zhimg.com/v2-30e994f5b2ec017f3337ad91f566eb88_1440w.jpg?source=ccfced1a">
<div class="ImageEdit-button css-187js3w" style="text-align: center">å¾ 2, æ¥èªï¼https://deepwiki.com/GeeeekExplorer/nano-vllm</div>
</div>
</div>
</div>
</div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="3rfae-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="3rfae-0-0"><span data-offset-key="3rfae-0-0">ä¸å±ç»æ</span></div>
</div>
<ul class="public-DraftStyleDefault-ul" data-offset-key="b0vi3-0-0">
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="b0vi3-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="b0vi3-0-0"><span data-offset-key="b0vi3-0-0">æ¥å£å±ï¼User Interface Layer</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="510uv-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="510uv-0-0"><span data-offset-key="510uv-0-0">æ¨çå¼æä¸­æ§å±ï¼Inference Engine Layer</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="2ao8p-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="2ao8p-0-0"><span data-offset-key="2ao8p-0-0">æ¾å­ç®¡çåæ¨¡åæ§è¡å±ï¼Memory Management &amp; Model Execution Layer</span></div>
</li>
</ul>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4o3ac-0-0"><span data-offset-key="4o3ac-0-0">3.2. ç±»å±é¢æ¶æ</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="7vkaq-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="7vkaq-0-0"><span data-offset-key="7vkaq-0-0">ä»ç±»è®¾è®¡å±é¢è§å¯ nano-vLLM çæ¶æã</span></div>
</div>
<div class="Image-captionContainer" data-size="normal">
<div>
<div class="Image-resizerContainer css-ym3v7r" data-size="normal">
<div class="css-79elbk">
<div>
<div class="ImageDelete-Container css-xi606m">
<div class="ImageDelete-Wrapper css-1gomreu"><img src="https://pic1.zhimg.com/80/v2-8612f2dcf6e20d6dd1fccb4ebb494bd2_1440w.png?source=ccfced1a" width="409" height="433" class="Image FocusPlugin--unfocused Image--isBlock css-1phd9a0" loading="lazy" style="display: block; margin-left: auto; margin-right: auto" data-size="normal" data-rawwidth="841" data-rawheight="891" data-watermark="original" data-original-src="https://pic1.zhimg.com/v2-8612f2dcf6e20d6dd1fccb4ebb494bd2.jpg?source=ccfced1a" data-watermark-src="https://picx.zhimg.com/v2-3a6dff4e142735a4f58fc285f1b2f992_1440w.jpg?source=ccfced1a">
<div class="ImageEdit-button css-187js3w" style="text-align: center">&nbsp;</div>
<div class="ImageDelete-button css-5sjb75" style="text-align: center">&nbsp;å¾ 3</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="ar0pl-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="ar0pl-0-0"><span data-offset-key="ar0pl-0-0">ä¸å¾ä¸­åç§é¢è²ä»£è¡¨ç³»ç»çåä¸ªç»æé¨å</span></div>
</div>
<ul class="public-DraftStyleDefault-ul" data-offset-key="en3rk-0-0">
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="en3rk-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="en3rk-0-0"><span data-offset-key="en3rk-0-0">æµèè²ï¼å¥å£åæ¨çå¼æä¸­æ§å±</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="13d2e-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="13d2e-0-0"><span data-offset-key="13d2e-0-0">æµç»¿è²ï¼æ¨¡åæ¨ç</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="5cb7v-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="5cb7v-0-0"><span data-offset-key="5cb7v-0-0">æµçº¢è²ï¼KV Cache ç®¡ç</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="56eii-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="56eii-0-0"><span data-offset-key="56eii-0-0">æµç´«è²ï¼æéå è½½åç©éµè®¡ç®çå°è£</span></div>
</li>
</ul>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="7a956-0-0"><span data-offset-key="7a956-0-0">3.3. æºç å±é¢åå</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="44m2c-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="44m2c-0-0"><span data-offset-key="44m2c-0-0">æºç è§åä¸ä¹è¾ä¸ºç®æ´ãç®å½ç»æå¦ä¸ï¼</span></div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="44m2c-0-0">
<div class="cnblogs_Highlighter">
<pre class="brush:bash;gutter:true;">nanovllm/
âââ engine
âââ layers
âââ models
âââ utils</pre>
</div>
</div>
</div>
<ul class="public-DraftStyleDefault-ul" data-offset-key="lkpt-0-0">
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="lkpt-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="lkpt-0-0"><span data-offset-key="lkpt-0-0">engineï¼å¼æçå¥å£ãä¸­æ§ï¼åæ¶ KV Cache æ¯è¾ç®åï¼ä»£ç ä¹æ¾å¨è¿ä¸ªç®å½ä¸ã</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="b95lg-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="b95lg-0-0"><span data-offset-key="b95lg-0-0">layersï¼æ¨¡åæ¨ççéç¨ç»ä»¶ï¼åé¨åæ¬ï¼linearãlayernormãrotary_embeddingãattentionãactivation ç­åºç¡åè½çå°è£ï¼å¯ä»¥è¢«ä¸åæ¨¡åä½¿ç¨ã</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="4eca5-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4eca5-0-0"><span data-offset-key="4eca5-0-0">modelsï¼æ¨¡åçå®ç°ï¼ä¾èµ layers çç»ä»¶å®ç°ä¸åæ¨¡åçæ¨çã</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="upvc-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="upvc-0-0"><span data-offset-key="upvc-0-0">utilsï¼ä¸åå±é½å¯è½ä¼ç¨å°çå·¥å·å½æ°ã</span></div>
</li>
</ul>
<h1 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4n7nk-0-0"><span data-offset-key="4n7nk-0-0">4. è¿ç»­æ¹å¤ç</span></h1>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="6772e-0-0"><span data-offset-key="6772e-0-0">4.1. æ¦å¿µçè§£</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="3533u-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="3533u-0-0"><span data-offset-key="3533u-0-0">ï¼1ï¼å®ä¹</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="5ps6c-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="5ps6c-0-0"><span data-offset-key="5ps6c-0-0">è¿ç»­æ¹å¤ç (Continuous Batching)ï¼æ¯ä¸ç§è¿­ä»£çº§ï¼Iteration-levelï¼çè°åº¦ç­ç¥ãå®ä»¥âToken çææ­¥éª¤âä¸ºè°åº¦ç²åº¦ãéè¿å¨æå°å¨æ¯ä¸è½®è¿­ä»£ä¸­æ¿æ¢å·²å®æçä»»å¡ï¼æ¶é¤äºç±äºçæé¿åº¦ä¸ä¸å¯¼è´ç GPU è®¡ç®æ°æ³¡ï¼æå¤§å°æåäºç³»ç»çååéã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="9hoep-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="9hoep-0-0"><span data-offset-key="9hoep-0-0">ï¼2ï¼æ´ç´ çè§£</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="btvpi-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="btvpi-0-0"><span data-offset-key="btvpi-0-0">ä¸ä¸ªè¯·æ±éè¦æ§è¡å¤è½®ï¼ä¸åè¯·æ±éè¦æ§è¡çè½®æ°ä¸åï¼ç³»ç»ä¸è½®æå¤åªè½åæ¶æ§è¡ä¸æ¹ N ä¸ªè¯·æ±ï¼å½ä¸ä¸ªæ¹æ¬¡éçè¯·æ±åå·®ä¸é½çå®ææ¶ï¼æ¯å®æä¸ä¸ªè¯·æ±å°±å°å¶ç¨æ°è¯·æ±æ¿ä»£æã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="f4ss9-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="f4ss9-0-0"><span data-offset-key="f4ss9-0-0">å¯¹æ¯ä¼ ç»æ¹å¤çåè¿ç»­æ¹å¤çï¼</span></div>
</div>
<ul class="public-DraftStyleDefault-ul" data-offset-key="e3hch-0-0">
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="e3hch-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="e3hch-0-0"><span data-offset-key="e3hch-0-0">ä¼ ç»æ¹å¤ç (Static Batching)ï¼å¿é¡»ç­å¾ Batch ä¸­çæåºåæé¿çé£ä¸ªè¯·æ±å®æï¼æ´ä¸ª Batch æä¼éæ¾ãå¨æ­¤æé´ï¼çæåºåç­è¯·æ±å®æåæ§½ä½ä¼ç©ºè½¬ã</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="5sueq-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="5sueq-0-0"><span data-offset-key="5sueq-0-0">è¿ç»­æ¹å¤ç (Continuous Batching)ï¼è¯·æ±å®æå³éåºï¼æ°è¯·æ±ç«å³è¡¥ä½ï¼æ§½ä½å§ç»æ»¡è½½ã</span></div>
</li>
</ul>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="fl0na-0-0"><span data-offset-key="fl0na-0-0">4.2. æåºç¡çè¿ç»­æ¹å¤ç</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="fuvou-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="fuvou-0-0"><span data-offset-key="fuvou-0-0">æç®åçè¿ç»­æ¹å¤çï¼ä¸èè prefill å decode çå·®å¼ï¼ç¤ºä¾ä»£ç ï¼</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="2i7d8-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> time
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> threading
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> queue
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> random

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 1. åå§åçº¿ç¨å®å¨çç­å¾éå</span>
waiting_queue =<span style="color: rgba(0, 0, 0, 1)"> queue.Queue()
MAX_BATCH_SIZE </span>= 3

<span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> --- æ¨¡æç¨æ·è¯·æ±çº¿ç¨ (çäº§è) ---</span>
<span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> user_request_producer():
    request_id </span>= 1
    <span style="color: rgba(0, 0, 255, 1)">while</span><span style="color: rgba(0, 0, 0, 1)"> True:
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ¨¡æç¨æ·éæºå°è¾¾ï¼æ¯ 1~2 ç§æ¥ä¸ä¸ªæ°è¯·æ±</span>
        time.sleep(random.uniform(1, 2<span style="color: rgba(0, 0, 0, 1)">))
        
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ¯ä¸ªè¯·æ±éè¦ç Token é¿åº¦éæºï¼3å°8ä¹é´ï¼</span>
        req = {<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">id</span><span style="color: rgba(128, 0, 0, 1)">"</span>: f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">REQ-{request_id}</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">remain</span><span style="color: rgba(128, 0, 0, 1)">"</span>: random.randint(3, 8<span style="color: rgba(0, 0, 0, 1)">)}
        waiting_queue.put(req)
        
        </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\n[ç¨æ·ç«¯] éå¥æ°è¯·æ±: {req['id']} (é¢è®¡é¿åº¦: {req['remain']})</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
        request_id </span>+= 1
        <span style="color: rgba(0, 0, 255, 1)">if</span> request_id &gt; 5<span style="color: rgba(0, 0, 0, 1)">:
          </span><span style="color: rgba(0, 0, 255, 1)">break</span>

<span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> --- æ ¸å¿æ¨çå¾ªç¯ (æ¶è´¹è/æ§è¡å¨) ---</span>
<span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> inference_loop():
    running_batch </span>=<span style="color: rgba(0, 0, 0, 1)"> []
    
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">--- æ¨çå¼æå·²å¯å¨ ---</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    iteration </span>=<span style="color: rgba(0, 0, 0, 1)"> 0
    </span><span style="color: rgba(0, 0, 255, 1)">while</span><span style="color: rgba(0, 0, 0, 1)"> True:
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> A. è¡¥ä½é»è¾ï¼åªè¦ Batch æ²¡æ»¡ä¸éåéæè´§ï¼å°±æè¿æ¥</span>
        <span style="color: rgba(0, 0, 255, 1)">while</span> len(running_batch) &lt;<span style="color: rgba(0, 0, 0, 1)"> MAX_BATCH_SIZE:
            </span><span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)">:
                </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ä½¿ç¨ block=Falseï¼å¦æéåç©ºäºç´æ¥æ¥éè¿ exceptï¼ä¸é»å¡æ¨çé»è¾</span>
                new_req = waiting_queue.get(block=<span style="color: rgba(0, 0, 0, 1)">False)
                running_batch.append(new_req)
                </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">  &gt;&gt;&gt; [è°åº¦] {new_req['id']} è¿å¥ Batch</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
            </span><span style="color: rgba(0, 0, 255, 1)">except</span><span style="color: rgba(0, 0, 0, 1)"> queue.Empty:
                </span><span style="color: rgba(0, 0, 255, 1)">break</span>

        <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> B. æ¨çé»è¾ï¼å¦æå½å Batch æä»»å¡ï¼å°±æ§è¡ä¸æ¬¡ Step</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> running_batch:
            iteration </span>+= 1
            <span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">=</span><span style="color: rgba(128, 0, 0, 1)">"</span>*20 + f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{iteration=}</span><span style="color: rgba(128, 0, 0, 1)">"</span> + <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">=</span><span style="color: rgba(128, 0, 0, 1)">"</span>*20<span style="color: rgba(0, 0, 0, 1)">)
            </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ¨¡æ GPU æ¨çèæ¶ (Step èæ¶)</span>
            time.sleep(1.2<span style="color: rgba(0, 0, 0, 1)">) 
            
            </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å½å Batch ç¶æå±ç¤º</span>
            active_ids = [f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{r['id']}(å©{r['remain']-1})</span><span style="color: rgba(128, 0, 0, 1)">"</span> <span style="color: rgba(0, 0, 255, 1)">for</span> r <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> running_batch]
            </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">[GPUæ¨ç] å¤çä¸­: {active_ids}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
            
            </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ¯ä¸ä¸ªè¯·æ±çå©ä½é¿åº¦å 1</span>
            finished_this_step =<span style="color: rgba(0, 0, 0, 1)"> []
            </span><span style="color: rgba(0, 0, 255, 1)">for</span> req <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> running_batch:
                req[</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">remain</span><span style="color: rgba(128, 0, 0, 1)">"</span>] -= 1
                <span style="color: rgba(0, 0, 255, 1)">if</span> req[<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">remain</span><span style="color: rgba(128, 0, 0, 1)">"</span>] &lt;=<span style="color: rgba(0, 0, 0, 1)"> 0:
                    finished_this_step.append(req)
            
            </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> C. åé¤é»è¾ï¼åå®çç«å»è¸¢åºï¼ä¸ä¸è½®å¾ªç¯å¼å¤´å°±ä¼ææ°è¯·æ±è¡¥è¿æ¥</span>
            <span style="color: rgba(0, 0, 255, 1)">for</span> req <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> finished_this_step:
                </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">  &lt;&lt;&lt; [å®æ] {req['id']} çæå®æ¯ï¼éæ¾ä½ç½®</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
                running_batch.remove(req)
        </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">:
            </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¦æ Batch å éåé½ç©ºäºï¼ç¨å¾®æ­ä¼ï¼é¿å CPU ç©ºè½¬</span>
            time.sleep(0.5<span style="color: rgba(0, 0, 0, 1)">)

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> --- å¯å¨ç¨åº ---</span>
<span style="color: rgba(0, 0, 255, 1)">if</span> <span style="color: rgba(128, 0, 128, 1)">__name__</span> == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">__main__</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¯å¨ç¨æ·è¯·æ±çº¿ç¨</span>
    t = threading.Thread(target=user_request_producer, daemon=<span style="color: rgba(0, 0, 0, 1)">True)
    t.start()

    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ä¸»çº¿ç¨æ§è¡æ¨çå¾ªç¯</span>
    <span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)">:
        inference_loop()
    </span><span style="color: rgba(0, 0, 255, 1)">except</span><span style="color: rgba(0, 0, 0, 1)"> KeyboardInterrupt:
        </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\næå¡å·²åæ­¢</span><span style="color: rgba(128, 0, 0, 1)">"</span>)</pre>
</div>
<p><span data-offset-key="2a0tv-0-0">æ ¸å¿é»è¾ï¼</span></p>
</div>
<ul class="public-DraftStyleDefault-ul" data-offset-key="4phrk-0-0">
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="4phrk-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4phrk-0-0"><span data-offset-key="4phrk-0-0">å­å¨ç»æï¼ä»£ç çæ ¸å¿æä¸¤ä¸ªéåï¼waiting_queue è´è´£å­å¨è¯·æ±çº¿ç¨ä¸æ­æ¥æ¶å°çæ°è¯·æ±ï¼running_queue è´è´£å­å¨å·²ç»è¿è¡ä½è¿æ²¡æç»æçè¯·æ±ã</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="ahrhj-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="ahrhj-0-0"><span data-offset-key="ahrhj-0-0">è¿­ä»£å¾ªç¯ï¼çäº§èæç»­å¾ waiting_queue åå¥æ°è¯·æ±ï¼è¿­ä»£å¾ªç¯æç»­ä» waiting_queue è·åæ°è¯·æ±å å¥å° running_queueï¼åæ¶æ¸ç running_queue éå·²ç»å®æçè¯·æ±ã</span></div>
</li>
</ul>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="7obml-0-0"><span data-offset-key="7obml-0-0">4.3. prefill ä¼åçè¿ç»­æ¹å¤ç</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="4uau9-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4uau9-0-0"><span data-offset-key="4uau9-0-0">prefill ä¼åçæ¹å¤çï¼éè¦åºå prefll å decodeï¼ä¼åå¤çæ°è¯·æ±ï¼ç¤ºä¾ä»£ç ï¼</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="45mns-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> time
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> queue
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> random
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> threading

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ ¸å¿éå</span>
waiting_queue =<span style="color: rgba(0, 0, 0, 1)"> queue.Queue()  
running_queue </span>=<span style="color: rgba(0, 0, 0, 1)"> []             

MAX_BATCH_SIZE </span>= 4

<span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> user_request_producer():
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">
    ä¿®æ¹ç¹ï¼æ¨¡æçåå¼è¯·æ±å°è¾¾ï¼ä»¥è§¦åå¤è¯·æ± Prefill
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span>
    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ç¬¬ä¸æ³¢ï¼çåå¼å°è¾¾ (3ä¸ªè¯·æ±åæ¶è¿å¥éå)</span>
    <span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\n[ç¨æ·] --- çåå¼è¯·æ±å°è¾¾ (3ä¸ªè¯·æ±) ---</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">for</span> i <span style="color: rgba(0, 0, 255, 1)">in</span> range(1, 4<span style="color: rgba(0, 0, 0, 1)">):
        req </span>= {<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">id</span><span style="color: rgba(128, 0, 0, 1)">"</span>: f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">REQ-{i}</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">remain</span><span style="color: rgba(128, 0, 0, 1)">"</span>: random.randint(2, 5<span style="color: rgba(0, 0, 0, 1)">)}
        waiting_queue.put(req)
        </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">[ç¨æ·] è¯·æ± {req['id']} è¿å¥ç­å¾éå</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å»¶è¿ä¸ä¼å¿ï¼åæ¥ç¬¬äºæ³¢åç¹è¯·æ±</span>
    time.sleep(5<span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\n[ç¨æ·] --- å»¶è¿è¯·æ±å°è¾¾ (1ä¸ªè¯·æ±) ---</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    req </span>= {<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">id</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">REQ-4</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">remain</span><span style="color: rgba(128, 0, 0, 1)">"</span>: 3<span style="color: rgba(0, 0, 0, 1)">}
    waiting_queue.put(req)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">[ç¨æ·] è¯·æ± {req['id']} è¿å¥ç­å¾éå</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

</span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> inference_loop():
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">--- è¿ç»­æ¹å¤çå¼æï¼å¤è¯·æ± Prefill æ¨¡å¼ ---</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    iteration </span>=<span style="color: rgba(0, 0, 0, 1)"> 0
    
    </span><span style="color: rgba(0, 0, 255, 1)">while</span><span style="color: rgba(0, 0, 0, 1)"> True:
        current_batch </span>=<span style="color: rgba(0, 0, 0, 1)"> []
        is_prefill_stage </span>=<span style="color: rgba(0, 0, 0, 1)"> False
        
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 1. è°åº¦ï¼æå»ºå½åæ¹æ¬¡</span>
        <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> åªè¦ waiting_queue éç©ºï¼å°±å°½å¯è½å¡«æ»¡ MAX_BATCH_SIZE</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> <span style="color: rgba(0, 0, 255, 1)">not</span><span style="color: rgba(0, 0, 0, 1)"> waiting_queue.empty():
            is_prefill_stage </span>=<span style="color: rgba(0, 0, 0, 1)"> True
            </span><span style="color: rgba(0, 0, 255, 1)">while</span> <span style="color: rgba(0, 0, 255, 1)">not</span> waiting_queue.empty() <span style="color: rgba(0, 0, 255, 1)">and</span> len(current_batch) &lt;<span style="color: rgba(0, 0, 0, 1)"> MAX_BATCH_SIZE:
                req </span>=<span style="color: rgba(0, 0, 0, 1)"> waiting_queue.get()
                current_batch.append(req)
        </span><span style="color: rgba(0, 0, 255, 1)">elif</span><span style="color: rgba(0, 0, 0, 1)"> running_queue:
            is_prefill_stage </span>=<span style="color: rgba(0, 0, 0, 1)"> False
            current_batch </span>=<span style="color: rgba(0, 0, 0, 1)"> list(running_queue)
        
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> <span style="color: rgba(0, 0, 255, 1)">not</span><span style="color: rgba(0, 0, 0, 1)"> current_batch:
            time.sleep(</span>0.5<span style="color: rgba(0, 0, 0, 1)">)
            </span><span style="color: rgba(0, 0, 255, 1)">continue</span>

        <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 2. æ§è¡ï¼æ¨¡ææ¨ç</span>
        iteration += 1
        <span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\n{'='*15} Iteration {iteration} {'='*15}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
        
        </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> is_prefill_stage:
            </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">[PREFILL] æ¹éçæä¸­: {[r['id'] for r in current_batch]}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
            time.sleep(</span>1.5<span style="color: rgba(0, 0, 0, 1)">) 
        </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">:
            </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">[DECODE ] æ¹éçæä¸­: {[f'{r['id']}(å©{r['remain']})' for r in current_batch]}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
            time.sleep(</span>0.4<span style="color: rgba(0, 0, 0, 1)">) 

        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 3. ç»ä¸ç¶ææ´æ°</span>
        <span style="color: rgba(0, 0, 255, 1)">for</span> req <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> current_batch:
            req[</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">remain</span><span style="color: rgba(128, 0, 0, 1)">'</span>] -= 1

        <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 4. ç»ä¸å¤æ­çå½å¨æ</span>
        <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ³¨æï¼ä¸ºäºé¿åå¨éååè¡¨æ¶å é¤åç´ ï¼æä»¬åæ¶éè¦å é¤çå¯¹è±¡</span>
        to_remove_from_running =<span style="color: rgba(0, 0, 0, 1)"> []
        
        </span><span style="color: rgba(0, 0, 255, 1)">for</span> req <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> current_batch:
            </span><span style="color: rgba(0, 0, 255, 1)">if</span> req[<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">remain</span><span style="color: rgba(128, 0, 0, 1)">'</span>] &lt;=<span style="color: rgba(0, 0, 0, 1)"> 0:
                </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">  &lt;&lt;&lt; [å®æ] {req['id']} éåºç³»ç»</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
                </span><span style="color: rgba(0, 0, 255, 1)">if</span> req <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> running_queue:
                    to_remove_from_running.append(req)
            </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">:
                </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> is_prefill_stage:
                    running_queue.append(req)
                    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">  -&gt; {req['id']} Prefill å®æï¼è½¬å¥ running_queue</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
                </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">:
                    </span><span style="color: rgba(0, 0, 255, 1)">pass</span>
        
        <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çæ­£çä» running_queue ç§»é¤</span>
        <span style="color: rgba(0, 0, 255, 1)">for</span> req <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> to_remove_from_running:
            running_queue.remove(req)

</span><span style="color: rgba(0, 0, 255, 1)">if</span> <span style="color: rgba(128, 0, 128, 1)">__name__</span> == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">__main__</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
    t </span>= threading.Thread(target=user_request_producer, daemon=<span style="color: rgba(0, 0, 0, 1)">True)
    t.start()
    </span><span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)">:
        inference_loop()
    </span><span style="color: rgba(0, 0, 255, 1)">except</span><span style="color: rgba(0, 0, 0, 1)"> KeyboardInterrupt:
        </span><span style="color: rgba(0, 0, 255, 1)">pass</span></pre>
</div>
<p><span data-offset-key="95l8v-0-0">å å ä¸ prefill ä¼åä¹åçè¿ç»­æ¹å¤çä»£ç ä¹è¾ä¸ºç®åï¼ä¸»è¦æ¯ç»´æ¤ä¸ä¸ªåéï¼waiting_queueãrunning_queueãcurrent_batchã</span></p>
</div>
<h1 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="bfmk2-0-0"><span data-offset-key="bfmk2-0-0">5. KV Cache</span></h1>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4fpfc-0-0"><span data-offset-key="4fpfc-0-0">5.1. æ¦å¿µçè§£</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="egp60-0-0">
<h3 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="egp60-0-0"><span data-offset-key="egp60-0-0">5.1.1. KV Cache çç¨é</span></h3>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="dj0l-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="dj0l-0-0"><span data-offset-key="dj0l-0-0">KV Cache æä¸¤å±ç¨éãä¸æ¯ç¨å¨åä¸ä¸ªè¯·æ±ç Decode é¶æ®µï¼å¤ç¨ä¹åå·²ç»è®¡ç®è¿ç KV ç»æä»¥é¿åéå¤è®¡ç®ï¼äºæ¯ç¨å¨ä¸åè¯·æ±ä¹é´ï¼ä½¿å·æç¸ååç¼çè¯·æ±å¯ä»¥å±äº«ä¸é¨å KV æ°æ®ï¼è¿å°±æ¯ Prefix KV Cacheã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="6qu2l-0-0">
<h3 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="6qu2l-0-0"><span data-offset-key="6qu2l-0-0">5.1.2. PagedAttention ææ¯</span></h3>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="cp1e3-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="cp1e3-0-0"><span data-offset-key="cp1e3-0-0">å¨ Cache çå­å¨å±é¢ï¼PagedAttention å®ç°äºæ¾å­çæéç³è¯·ãç±äº KV Cache ç©ºé´ä¸åä¸æ¬¡æ§é¢åéï¼è¯·æ±åºåå¯¹åºçç©çå°åæ¯ç¦»æ£çãPagedAttention çæ ¸å¿å¨äºï¼å®è½å¤ç´æ¥è¯»åè¿äºç©çç¦»æ£çåæ¥å®ææ³¨æåè®¡ç®ï¼è¿èåå®ç°äºä¸å±ä»âé»è¾è¿ç»­å°åâå°âç©çç¦»æ£å°åâçæ å°ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="a494u-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="a494u-0-0"><span data-offset-key="a494u-0-0">å¯¹äºæ²¡ææ¥è§¦è¿é PagedAttention å®ç°çè¯»èæ¥è¯´ï¼è¿ç§è®¾è®¡ä¼¼ä¹çæå½ç¶ï¼æéç³è¯·ãåé¡µç®¡çãå°åæ å°ãå±é¨æ§åçââè¿äºé½æ¯è®¡ç®æºç§å­¦ä¸­éå¸¸å¸¸è§çæç»´ï¼çè³å¾é¾æ³å°ä¸è¿ä¹åççç±ãé£ä¹ï¼ä¸ºä»ä¹ PagedAttention ä¼è¢«è®¤ä¸ºæ¯ä¸é¡¹éç¨ç¢å¼çåè¿ææ¯å¢ï¼</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="8elsr-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="8elsr-0-0"><span data-offset-key="8elsr-0-0">é¦åï¼å¨ PagedAttention åºç°ä¹åï¼ä¸çæ®éè®¤ä¸º KV Cache å¨æ¾å­ä¸­å¿é¡»ç©çè¿ç»­ï¼å¦åä¼å è®¿å­ä¸è¿ç»­å¯¼è´æ§è½å¤§å¹ä¸éãå¶æ¬¡ï¼å½æ¶çæ³¨æåç®å­ï¼å¦æ åç FlashAttentionï¼å¹¶ä¸æ¯æäºæ¬¡å¯»åæ å°ãPagedAttention è¯æäºå³ä¾¿ç©çå­å¨ä¸è¿ç»­ï¼æ§è½ä¾ç¶å¯ä»¥ä¿ææé«ãå¶ä»£ç å®ç°æå³é®çç¹å¨äºéæäº CUDA åæ ¸ï¼ä½¿å¶åçæ¯æ KV Cache äºæ¬¡å¯»åãä¸ä¸ªåºåç KV Cache ä¸éè¦ç©çè¿ç»­ï¼ä¹æ­£æ¯ä¸ååºåé´è½å¤çµæ´»å¤ç¨ Prefix KV Cache çææ¯åæã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="tdgu-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="tdgu-0-0"><span data-offset-key="tdgu-0-0">æ»çæ¥è¯´ï¼è½ç¶åé¡µèæåå­å¨ CPU é¢åæ¯å¸¸è¯ï¼ä½å¨ GPU ç®å­é¢åå¶åå±ç¸å¯¹ç¼æ¢ãå®ç°ä¸å¥æ¢è½åé¡µç®¡çãåä¸æå¤±ç®åå©ç¨çç Attention Kernel æ¯ PagedAttention çæ ¸å¿æå¨ã</span></div>
</div>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4t417-0-0"><span data-offset-key="4t417-0-0">5.2. Prefix KV Cache çå®ç°</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="1qbm4-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="1qbm4-0-0"><span data-offset-key="1qbm4-0-0">Cache çç®¡çè¾ä¸ºç®åï¼åªæ BlockManager ç±»ï¼è´è´£ç»´æ¤æ¾å­æ± åä¸ª block ççç¶æã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="3hqqi-0-0">
<h3 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="3hqqi-0-0"><span data-offset-key="3hqqi-0-0">5.2.1. åè½ç»è</span></h3>
</div>
<ul class="public-DraftStyleDefault-ul" data-offset-key="eo7ib-0-0">
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="eo7ib-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="eo7ib-0-0"><span data-offset-key="eo7ib-0-0">ä½¿ç¨ hash æ¥è¯å«æ¯å¦æå¯å¤ç¨åç¼ï¼ä»¥ block ä¸ºåºæ¬åå</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="eu2dc-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="eu2dc-0-0"><span data-offset-key="eu2dc-0-0">é¾å¼ hashï¼æ¯ä¸ª block ç hash è®¡ç®è¾å¥ä¸ºååº block ç hash å¼å ä¸æ¬ block ç token id</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="53r4m-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="53r4m-0-0"><span data-offset-key="53r4m-0-0">æ¯ä¸ä¸ª block æå¯¹åºç meta ä¿¡æ¯å¯¹è±¡ï¼è®°å½ block è¢«å¤ç¨çå¼ç¨è®¡æ°ï¼ç¡®ä¿å¤ç¨æ¶ä¸ä¼è¢«éæ¾</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="5ep1l-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="5ep1l-0-0"><span data-offset-key="5ep1l-0-0">ä¸ºé¿å hash ç¢°æåºç°éè¯¯ï¼block meta ä¿¡æ¯è¿éè¦è®°å½åå§ç token id</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="ep2of-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="ep2of-0-0"><span data-offset-key="ep2of-0-0">å¨è·å KV Cache ç©ºé´æ¶éè¦èèæ¯å¦è·¨ block</span></div>
</li>
</ul>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="1n8ab-0-0">
<h3 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="1n8ab-0-0"><span data-offset-key="1n8ab-0-0">5.2.2. åå­æ± </span></h3>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="92dgk-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="92dgk-0-0"><span data-offset-key="92dgk-0-0">å¨è¿ç¨å¯å¨æ¶ï¼ä¸æ¬¡æ§ç³è¯·åå­æ± çç©ºé´ï¼</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="7mlt7-0-0">
<div class="cnblogs_code">
<pre>kv_cache =<span style="color: rgba(0, 0, 0, 1)"> torch.empty(
    </span>2,                          <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> K å V</span>
    num_layers,                 <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å±æ°</span>
    num_blocks,                 <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ»åæ°</span>
    block_size,                 <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ¯å token æ°</span>
    num_kv_heads // tp_size,    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> KV head æ°ï¼èèå¼ éå¹¶è¡ï¼</span>
    head_dim                    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> head ç»´åº¦</span>
)</pre>
</div>
<p><span data-offset-key="c1fh4-0-0">ä¸è¿°ç³è¯·æ¾å­ä»£ç ä¸­ç num_blocks æ¯æ ¹æ®å¯ç¨äº KV Cache çæ¾å­ç®åºæ¥çï¼</span></p>
<div class="cnblogs_code">
<pre>block_bytes = 2 * hf_config.num_hidden_layers * self.block_size * num_kv_heads * head_dim *<span style="color: rgba(0, 0, 0, 1)"> hf_config.torch_dtype.itemsize
config.num_kvcache_blocks </span>= int(total * config.gpu_memory_utilization - used - peak + current) // block_bytes</pre>
</div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="2itrb-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="2itrb-0-0"><span data-offset-key="2itrb-0-0">ä¸è¿°ä»£ç ä¸­ç block_bytes å¹¶ä¸æ¯æ block çå¤§å°ï¼èæ¯æè®¡ç® blocks æ°çææé¤æ°ä¹å°äºä¸èµ·ï¼é¤æ°åæ¬ï¼block å¤§å°ãk å vãæ¨¡åå±æ°ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="9u53j-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="9u53j-0-0"><span data-offset-key="9u53j-0-0"><span data-text="true">total * config.gpu_memory_utilization - used - peak + current<span data-offset-key="9u53j-0-1"> è¿é¨ååæ¯æ ¹æ®æé«çæ¾å­å©ç¨çç®åºæ¥å¯ç¨æ¾å­ï¼åå»å½åæ¨¡åå è½½å®åä½¿ç¨äºçé¨åï¼ååå»æ¨¡åé¢ç­æ¶ä½¿ç¨çæ¿æ´»æ¾å­ï¼<span data-offset-key="9u53j-0-2"><span data-text="true">peak - current<span data-offset-key="9u53j-0-3">ã</span></span></span></span></span></span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="an724-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="an724-0-0"><span data-offset-key="an724-0-0">ç³è¯·å°åå­æ± åï¼æå±å±äº«è§å¾ç»åä¸ªå±ç Attention å¯¹è±¡ï¼ä»£ç çèµ·æ¥æ¯è¾ trickyï¼ä½å¨ python éåæ¯è¾å¸¸è§ï¼</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="aectp-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">for</span> module <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> self.model.modules():
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> hasattr(module, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">k_cache</span><span style="color: rgba(128, 0, 0, 1)">"</span>) <span style="color: rgba(0, 0, 255, 1)">and</span> hasattr(module, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">v_cache</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">):
        module.k_cache </span>=<span style="color: rgba(0, 0, 0, 1)"> self.kv_cache[0, layer_id]
        module.v_cache </span>= self.kv_cache[1<span style="color: rgba(0, 0, 0, 1)">, layer_id]
        layer_id </span>+= 1</pre>
</div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="8plc7-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="8plc7-0-0"><span data-offset-key="8plc7-0-0">éåæ¨¡åä¸­çææ nn.Module å­æ¨¡åï¼éè¿æ£æ¥æ¯å¦å­å¨ k_cache å v_cache å±æ§æ¥è¯å« Attention å±ãå¯¹äºæ¯ä¸ª Attention å±ï¼å°å¶ k_cache å v_cache å±æ§æ¿æ¢ä¸ºæåå¨å± KV Cache æ¾å­æ± çå¼ éè§å¾ï¼è¿æ ·ææå±å±äº«åä¸åè¿ç»­çæ¾å­ç©ºé´ï¼ä½æ¯å±åªè½è®¿é®èªå·±å¯¹åºçåçã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="5gjke-0-0">
<h3 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="5gjke-0-0"><span data-offset-key="5gjke-0-0">5.2.3. KV Cache åå¥</span></h3>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="dqio4-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="dqio4-0-0"><span data-offset-key="dqio4-0-0">å¨ attention å­å±ç forward åå KV Cache çåå¥ï¼ä½¿ç¨ç store_kvcache_kernel å½æ°æ¯ triton.jit å®ç°çï¼ä»£ç ä¹æ¯è¾ç®æ´ï¼</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="97mjq-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">@triton.jit
</span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> store_kvcache_kernel(
    key_ptr,
    key_stride,
    value_ptr,
    value_stride,
    k_cache_ptr,
    v_cache_ptr,
    slot_mapping_ptr,
    D: tl.constexpr,
):
    idx </span>=<span style="color: rgba(0, 0, 0, 1)"> tl.program_id(0)
    slot </span>= tl.load(slot_mapping_ptr +<span style="color: rgba(0, 0, 0, 1)"> idx)
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> slot == -1: <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)">
    key_offsets </span>= idx * key_stride +<span style="color: rgba(0, 0, 0, 1)"> tl.arange(0, D)
    value_offsets </span>= idx * value_stride +<span style="color: rgba(0, 0, 0, 1)"> tl.arange(0, D)
    key </span>= tl.load(key_ptr +<span style="color: rgba(0, 0, 0, 1)"> key_offsets)
    value </span>= tl.load(value_ptr +<span style="color: rgba(0, 0, 0, 1)"> value_offsets)
    cache_offsets </span>= slot * D +<span style="color: rgba(0, 0, 0, 1)"> tl.arange(0, D)
    tl.store(k_cache_ptr </span>+<span style="color: rgba(0, 0, 0, 1)"> cache_offsets, key)
    tl.store(v_cache_ptr </span>+<span style="color: rgba(0, 0, 0, 1)"> cache_offsets, value)

</span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> store_kvcache(key: torch.Tensor, value: torch.Tensor, k_cache: torch.Tensor, v_cache: torch.Tensor, slot_mapping: torch.Tensor):
    N, num_heads, head_dim </span>=<span style="color: rgba(0, 0, 0, 1)"> key.shape
    D </span>= num_heads *<span style="color: rgba(0, 0, 0, 1)"> head_dim
    </span><span style="color: rgba(0, 0, 255, 1)">assert</span> key.stride(-1) == 1 <span style="color: rgba(0, 0, 255, 1)">and</span> value.stride(-1) == 1
    <span style="color: rgba(0, 0, 255, 1)">assert</span> key.stride(1) == head_dim <span style="color: rgba(0, 0, 255, 1)">and</span> value.stride(1) ==<span style="color: rgba(0, 0, 0, 1)"> head_dim
    </span><span style="color: rgba(0, 0, 255, 1)">assert</span> k_cache.stride(1) == D <span style="color: rgba(0, 0, 255, 1)">and</span> v_cache.stride(1) ==<span style="color: rgba(0, 0, 0, 1)"> D
    </span><span style="color: rgba(0, 0, 255, 1)">assert</span> slot_mapping.numel() ==<span style="color: rgba(0, 0, 0, 1)"> N
    store_kvcache_kernel[(N,)](key, key.stride(0), value, value.stride(0), k_cache, v_cache, slot_mapping, D)</span></pre>
</div>
<p><span data-offset-key="eot2n-0-0">ä½¿ç¨ stride å½æ°æ¥ç¡®è®¤æ¾å­æ¯å¦è¿ç»­ï¼å ä¸ºå¨ store_kvcache_kernel çå®ç°éä¼æç§æ¾å­è¿ç»­æ¥è¯»åæå®ä½ç½®çå¼ã</span></p>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="fgn05-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="fgn05-0-0"><span data-offset-key="fgn05-0-0">æ¾å­è¿ç»­åä¸è¿ç»­çä¾å­ï¼</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="bgucp-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> torch

key </span>= torch.randn(2, 3, 4<span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 0, 255, 1)">print</span><span style="color: rgba(0, 0, 0, 1)">(key.stride())  
key_t </span>= key.transpose(1, 2<span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">è½¬ç½®åï¼éè¿ç»­ï¼:</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, key_t.stride())  
key_t </span>= key_t.contiguous()  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> éæ°åéï¼ä½¿å¶è¿ç»­</span>
<span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">contiguous å:</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, key_t.stride())

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è¾åºï¼</span><span style="color: rgba(0, 128, 0, 1)">
#</span><span style="color: rgba(0, 128, 0, 1)"> (12, 4, 1)</span><span style="color: rgba(0, 128, 0, 1)">
#</span><span style="color: rgba(0, 128, 0, 1)"> è½¬ç½®åï¼éè¿ç»­ï¼: (12, 1, 4)</span><span style="color: rgba(0, 128, 0, 1)">
#</span><span style="color: rgba(0, 128, 0, 1)"> contiguouså: (12, 3, 1)</span></pre>
</div>
</div>
<h1 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="ci2i3-0-0"><span data-offset-key="ci2i3-0-0">6. cuda graph</span></h1>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="2jdp4-0-0"><span data-offset-key="2jdp4-0-0">6.1. æ¦å¿µçè§£</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="35eln-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="35eln-0-0"><span data-offset-key="35eln-0-0">CUDA Graph æ¯ä¸ç§å°ä¸ç³»å CUDA æä½å½å¶æå¾çææ¯ï¼å¨éå¤æ§è¡çåºå®æä½åºååºæ¯ä¸å¯ä»¥æ¾èæåæ¨çæ§è½ï¼ä¸»è¦åºäºè¿å æ¹é¢ï¼</span></div>
</div>
<ul class="public-DraftStyleDefault-ul" data-offset-key="c79s9-0-0">
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="c79s9-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="c79s9-0-0"><span data-offset-key="c79s9-0-0">åå° CPU ä¸ GPU ä¹é´çé¢ç¹åæ­¥åæä»¤ä¸åå¼éï¼éä½ä¼ ç»ç¬ç«æä½å¸¦æ¥çæ§å¶æµäº¤äºæèï¼</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="e6vfa-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="e6vfa-0-0"><span data-offset-key="e6vfa-0-0">åå°æ§è¡è¿ç¨ä¸­ç CPU å¹²é¢ï¼GPU èªä¸»æ¹éæ§è¡å¾åæä½ï¼æå¤§å GPU å©ç¨çï¼éä½å»¶è¿ãæåååã</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="boou5-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="boou5-0-0"><span data-offset-key="boou5-0-0">è§é¿å¤æ¬¡ç¬ç« CUDA Kernel çå¯å¨åºå®å¼éï¼å¤ä¸ª Kernel æååä»éä¸æ¬¡è°åº¦è§¦åï¼å¤§å¹æåå° Kernel å¯éåºæ¯çæ§è¡æçï¼</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="dopod-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="dopod-0-0"><span data-offset-key="dopod-0-0">å¯éåæ¾å­æ± å®ç°æ¾å­èµæºå¤ç¨ï¼åå° âå°éå¤æ¬¡â æ¾å­ç³è¯· / éæ¾çå¼éï¼åæ¶é©±å¨ä¼åºäºå¾åæ¾å­è®¿é®æ¨¡å¼ä¼åå¸¦å®½å©ç¨çï¼</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="4h8t0-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4h8t0-0-0"><span data-offset-key="4h8t0-0-0">CUDA é©±å¨å¯è·åæä½åºåçå¨å±è§å¾ï¼åºäºå®æ´çä¾èµå³ç³»è¿è¡å¨å±ä¼åï¼å¦ Kernel é¡ºåºè°æ´ãèµæºåå¹¶ç­ï¼ï¼</span></div>
</li>
</ul>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="t84f-0-0"><span data-offset-key="t84f-0-0">6.2. åè½ç»è</span></h2>
<ul class="public-DraftStyleDefault-ul" data-offset-key="5flpk-0-0">
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="5flpk-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="5flpk-0-0"><span data-offset-key="5flpk-0-0">å½å¶æ¶ä½¿ç¨çå¼ éåå­å°åï¼å¨éæ¾æ¶å¿é¡»ä¿æä¸åï¼ä¹å°±æ¯åé¢å¤æ¬¡ replay é½ä¼ä½¿ç¨æè·æ¶ç³è¯·çåéç©ºé´</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="4p4jf-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4p4jf-0-0"><span data-offset-key="4p4jf-0-0">æè·åç graph å¯¹è±¡è®°å½å¨æååééï¼ä¾ä¸æ¬¡æ¨çæ¶éæ©</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="7n2p4-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="7n2p4-0-0"><span data-offset-key="7n2p4-0-0">éæ¾æ¶éæ©æ¯è¯·æ± batch size å¤§çæå° graph batch size</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="4k7ao-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4k7ao-0-0"><span data-offset-key="4k7ao-0-0">æè·æ¶ä¸åç batch size å±äº«ç¸åçéææ¾å­ç©ºé´ï¼å¹¶è®©å¤ä¸ªæ¹æ¬¡å±äº«æ¾å­æ± ï¼ä½¿å¾è½ç¶æå¤ä¸ª batch sizeï¼ä½åªä¼ä½¿ç¨ Max Batch Size çæ¾å­ç©ºé´</span></div>
</li>
</ul>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="ej75t-0-0"><span data-offset-key="ej75t-0-0">6.3. ç¤ºä¾ä»£ç </span></h2>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="atcuu-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> torch
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> torch.nn as nn

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 1. åºç¡éç½®</span>
device = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">cuda</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
D </span>= 512                 <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ç»´åº¦</span>
graph_bs = [1, 8, 32]   <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> é¢å®ä¹çæ¡¶ï¼åæ¡¶å°ºå¯¸ï¼</span>
NUM_LAYERS = 100        <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ææ·±æ¨¡åï¼å¢å  Kernel æ°éä»¥æ¾å¤§ Graph ä¼å¿</span>
iters = 50              <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ§è½æµè¯è¿­ä»£æ¬¡æ°</span>
max_bs =<span style="color: rgba(0, 0, 0, 1)"> max(graph_bs)

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 2. å®ä¹æ·±å±æ¨¡å (äº§ççº¦ 400 ä¸ª Kernel)</span>
<span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> UltraDeepModel(nn.Module):
    </span><span style="color: rgba(0, 0, 255, 1)">def</span> <span style="color: rgba(128, 0, 128, 1)">__init__</span><span style="color: rgba(0, 0, 0, 1)">(self):
        super().</span><span style="color: rgba(128, 0, 128, 1)">__init__</span><span style="color: rgba(0, 0, 0, 1)">()
        self.blocks </span>=<span style="color: rgba(0, 0, 0, 1)"> nn.ModuleList()
        </span><span style="color: rgba(0, 0, 255, 1)">for</span> _ <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(NUM_LAYERS):
            block </span>=<span style="color: rgba(0, 0, 0, 1)"> nn.ModuleDict({
                </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">ln</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">: nn.LayerNorm(D).to(device),
                </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">linear</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">: nn.Linear(D, D).to(device),
                </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">act</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">: nn.ReLU()
            })
            self.blocks.append(block)

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> forward(self, x):
        </span><span style="color: rgba(0, 0, 255, 1)">for</span> block <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> self.blocks:
            identity </span>=<span style="color: rgba(0, 0, 0, 1)"> x
            x </span>= block[<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">ln</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">](x)
            x </span>= block[<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">linear</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">](x)
            x </span>= block[<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">act</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">](x)
            x </span>= x +<span style="color: rgba(0, 0, 0, 1)"> identity 
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> x

model </span>=<span style="color: rgba(0, 0, 0, 1)"> UltraDeepModel().eval()

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 3. éæç¼å²åºåå¤</span>
static_input = torch.empty(max_bs, D, device=<span style="color: rgba(0, 0, 0, 1)">device)
static_output </span>= torch.empty(max_bs, D, device=<span style="color: rgba(0, 0, 0, 1)">device)

graphs </span>=<span style="color: rgba(0, 0, 0, 1)"> {}
graph_pool </span>=<span style="color: rgba(0, 0, 0, 1)"> None

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 4. å½å¶é¶æ®µ (ä»å¤§å°å°ï¼å±äº«åå­æ± )</span>
<span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">--- å¼å§å½å¶åæ¡¶ CUDA Graphs ---</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 0, 255, 1)">for</span> bs <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> reversed(sorted(graph_bs)):
    current_input </span>=<span style="color: rgba(0, 0, 0, 1)"> static_input[:bs]
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> Warmup</span>
    <span style="color: rgba(0, 0, 255, 1)">for</span> _ <span style="color: rgba(0, 0, 255, 1)">in</span> range(5<span style="color: rgba(0, 0, 0, 1)">):
        _ </span>=<span style="color: rgba(0, 0, 0, 1)"> model(current_input)
    
    g </span>=<span style="color: rgba(0, 0, 0, 1)"> torch.cuda.CUDAGraph()
    with torch.cuda.graph(g, pool</span>=<span style="color: rgba(0, 0, 0, 1)">graph_pool):
        static_output[:bs] </span>=<span style="color: rgba(0, 0, 0, 1)"> model(current_input)
    
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> graph_pool <span style="color: rgba(0, 0, 255, 1)">is</span><span style="color: rgba(0, 0, 0, 1)"> None:
        graph_pool </span>=<span style="color: rgba(0, 0, 0, 1)"> g.pool()
    graphs[bs] </span>=<span style="color: rgba(0, 0, 0, 1)"> g
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â å·²å½å¶æ¡¶ BS={bs}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 5. è¾å©å½æ°ï¼æ ¹æ®å®é BS å¹éæè¿çæ¡¶</span>
<span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> get_bucket_bs(actual_bs):
    </span><span style="color: rgba(0, 0, 255, 1)">for</span> b <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> sorted(graph_bs):
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> actual_bs &lt;=<span style="color: rgba(0, 0, 0, 1)"> b:
            </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> b
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> None

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 6. æ§è½å¯¹æ¯æµè¯ (åå« Padding é»è¾)</span>
<span style="color: rgba(0, 0, 255, 1)">def</span> benchmark(actual_test_bs=7<span style="color: rgba(0, 0, 0, 1)">):
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\n--- æ§è½æµè¯å¼å§: å®éè¯·æ± BS={actual_test_bs} ---</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çææµè¯æ°æ®</span>
    test_data = torch.randn(actual_test_bs, D, device=<span style="color: rgba(0, 0, 0, 1)">device)
    
    start_event </span>= torch.cuda.Event(enable_timing=<span style="color: rgba(0, 0, 0, 1)">True)
    end_event </span>= torch.cuda.Event(enable_timing=<span style="color: rgba(0, 0, 0, 1)">True)

    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> --- æ®µè½ A: Standard Eager Mode (ç´æ¥è· 7 ä¸ª) ---</span>
    torch.cuda.nvtx.range_push(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Eager_Mode</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    start_event.record()
    </span><span style="color: rgba(0, 0, 255, 1)">for</span> _ <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(iters):
        _ </span>=<span style="color: rgba(0, 0, 0, 1)"> model(test_data)
    end_event.record()
    torch.cuda.synchronize()
    eager_time </span>=<span style="color: rgba(0, 0, 0, 1)"> start_event.elapsed_time(end_event)
    torch.cuda.nvtx.range_pop()

    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> --- æ®µè½ B: CUDA Graph Mode (Padding å¯¹é½å° 8) ---</span>
    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 1. è·¯ç±é»è¾</span>
    bucket_bs =<span style="color: rgba(0, 0, 0, 1)"> get_bucket_bs(actual_test_bs)
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> bucket_bs <span style="color: rgba(0, 0, 255, 1)">is</span><span style="color: rgba(0, 0, 0, 1)"> None:
        </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â éè¯¯: å®é BS={actual_test_bs} è¶è¿äºæå¤§åæ¡¶ {max_bs}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)">

    torch.cuda.nvtx.range_push(f</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Graph_Mode_Bucket_{bucket_bs}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 2. æ°æ®å¯¹é½ (Padding): å° 7 æ¡æ°æ®æ·å¥ 8 çéæåºå</span>
    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> static_input çå 7 è¡è¢«è¦çï¼ç¬¬ 8 è¡ä¿æä¸åï¼å³ Padding ä½ï¼</span>
<span style="color: rgba(0, 0, 0, 1)">    static_input[:actual_test_bs].copy_(test_data)
    
    start_event.record()
    </span><span style="color: rgba(0, 0, 255, 1)">for</span> _ <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(iters):
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 3. éæ¾åæ¡¶ 8 çå¾</span>
<span style="color: rgba(0, 0, 0, 1)">        graphs[bucket_bs].replay()
    end_event.record()
    torch.cuda.synchronize()
    graph_time </span>=<span style="color: rgba(0, 0, 0, 1)"> start_event.elapsed_time(end_event)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 4. ç»ææªæ­ (Slicing): ä»éæåºæ¿åå 7 æ¡</span>
    final_res =<span style="color: rgba(0, 0, 0, 1)"> static_output[:actual_test_bs]
    torch.cuda.nvtx.range_pop()

    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æå°ç»æ</span>
    <span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å¹éå°çæ¡¶: {bucket_bs} (Padding æµªè´¹ç: {(bucket_bs-actual_test_bs)/bucket_bs*100:.1f}%)</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{'Mode':&lt;20} | {'Avg Time (ms)':&lt;15}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">-</span><span style="color: rgba(128, 0, 0, 1)">"</span> * 40<span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{'Eager Mode':&lt;20} | {eager_time/iters:&gt;15.4f}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{'Graph Mode':&lt;20} | {graph_time/iters:&gt;15.4f}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">-</span><span style="color: rgba(128, 0, 0, 1)">"</span> * 40<span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð å éæ¯: {eager_time/graph_time:.2f}x</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æç»è¾åºå½¢ç¶: {final_res.shape}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

</span><span style="color: rgba(0, 0, 255, 1)">if</span> <span style="color: rgba(128, 0, 128, 1)">__name__</span> == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">__main__</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æµè¯ä¸åçè¾å¥ BS</span>
    benchmark(actual_test_bs=7)  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è§¦åå¯¹é½å° 8</span>
    benchmark(actual_test_bs=1)  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ç²¾ç¡®å¹éå° 1</span></pre>
</div>
<p><span data-offset-key="b3jsd-0-0">æ§è¡ï¼nsys profile --trace=cuda,osrt,nvtx python3 cu2.py</span></p>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="e9suj-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="e9suj-0-0"><span data-offset-key="e9suj-0-0">è¾åºï¼</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="bm2d3-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">Collecting data...
</span>--- å¼å§å½å¶åæ¡¶ CUDA Graphs ---<span style="color: rgba(0, 0, 0, 1)">
â å·²å½å¶æ¡¶ BS</span>=32<span style="color: rgba(0, 0, 0, 1)">
â å·²å½å¶æ¡¶ BS</span>=8<span style="color: rgba(0, 0, 0, 1)">
â å·²å½å¶æ¡¶ BS</span>=1

--- æ§è½æµè¯å¼å§: å®éè¯·æ± BS=7 ---<span style="color: rgba(0, 0, 0, 1)">
å¹éå°çæ¡¶: </span>8 (Padding æµªè´¹ç: 12.5%<span style="color: rgba(0, 0, 0, 1)">)
Mode                 </span>|<span style="color: rgba(0, 0, 0, 1)"> Avg Time (ms)  
</span>----------------------------------------<span style="color: rgba(0, 0, 0, 1)">
Eager Mode           </span>|          7.9331<span style="color: rgba(0, 0, 0, 1)">
Graph Mode           </span>|          1.0136
----------------------------------------<span style="color: rgba(0, 0, 0, 1)">
ð å éæ¯: </span>7<span style="color: rgba(0, 0, 0, 1)">.83x
æç»è¾åºå½¢ç¶: torch.Size([</span>7, 512<span style="color: rgba(0, 0, 0, 1)">])

</span>--- æ§è½æµè¯å¼å§: å®éè¯·æ± BS=1 ---<span style="color: rgba(0, 0, 0, 1)">
å¹éå°çæ¡¶: </span>1 (Padding æµªè´¹ç: 0.0%<span style="color: rgba(0, 0, 0, 1)">)
Mode                 </span>|<span style="color: rgba(0, 0, 0, 1)"> Avg Time (ms)  
</span>----------------------------------------<span style="color: rgba(0, 0, 0, 1)">
Eager Mode           </span>|          8.1803<span style="color: rgba(0, 0, 0, 1)">
Graph Mode           </span>|          0.8011
----------------------------------------<span style="color: rgba(0, 0, 0, 1)">
ð å éæ¯: </span>10<span style="color: rgba(0, 0, 0, 1)">.21x
æç»è¾åºå½¢ç¶: torch.Size([</span>1, 512])</pre>
</div>
<p><span data-offset-key="f9vmd-0-0">æ¥ç nsysï¼</span></p>
</div>
<div class="Image-captionContainer" data-size="normal">
<div>
<div class="Image-resizerContainer css-ym3v7r" data-size="normal">
<div class="css-79elbk">
<div>
<div class="ImageDelete-Container css-xi606m">
<div class="ImageDelete-Wrapper css-1gomreu" style="text-align: center"><img src="https://picx.zhimg.com/80/v2-fa4eefbebda0472fa1f21d8bd01e4c17_1440w.png?source=ccfced1a" width="753" height="394" class="Image FocusPlugin--unfocused Image--isBlock css-1phd9a0" loading="lazy" data-size="normal" data-rawwidth="1787" data-rawheight="934" data-watermark="original" data-original-src="https://picx.zhimg.com/v2-fa4eefbebda0472fa1f21d8bd01e4c17.jpg?source=ccfced1a" data-watermark-src="https://pica.zhimg.com/v2-e7ab1f5e1056fe2adbf8d61f3be2c7b2_1440w.jpg?source=ccfced1a"></div>
</div>
</div>
</div>
</div>
</div>
<div style="text-align: center">å¾ 4</div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="dmkhc-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="dmkhc-0-0"><span data-offset-key="dmkhc-0-0">å¯ä»¥çå°ï¼å¨ cuda graph çæ¶åï¼SM ä½¿ç¨æ´ååã</span></div>
</div>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="dchee-0-0"><span data-offset-key="dchee-0-0">6.4. Q&amp;A</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="e35ln-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="e35ln-0-0"><span data-offset-key="e35ln-0-0">ï¼1ï¼ä¸ºä»ä¹æ¨çæ¶ cuda graph çéæ©è¦éç¨åä¸å¯¹é½çåæ¡¶ç­ç¥ï¼å³ï¼æ¹æ¬¡ç¸ç­æç¨å¤§çï¼èä¸æ¯éæ©æ¹æ¬¡æå¤§çï¼</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="2vaba-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="2vaba-0-0"><span data-offset-key="2vaba-0-0">è½ç¶å¨å»ºå¾ï¼Captureï¼é¶æ®µï¼ç³»ç»ä¼æç§æå¤§æ¹æ¬¡ï¼Max Batch Sizeï¼é¢åç³è¯·å¹¶éå®éææ¾å­ç©ºé´ï¼æ­¤æ¶å³ä¾¿éæ©æå¤§æ¹æ¬¡æ§è¡ä¹ä¸ä¼äº§çé¢å¤çæ¾å­å®¹éæµªè´¹ï¼ä½ä¼å¼å¥ä»¥ä¸ä¸¤ä¸ªç»´åº¦çæ§è½æèï¼</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="6v9hj-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="6v9hj-0-0"><span data-offset-key="6v9hj-0-0">æ¾å­å¸¦å®½çæ æå ç¨ï¼å¤§æ¨¡åæ¨çï¼å°¤å¶æ¯ Decoding é¶æ®µï¼å±äºå¸åçè®¿å­å¯éåä»»å¡ï¼å¶ç¶é¢å¨äºæ¨¡åæéä»æ¾å­å°è®¡ç®ååçæ¬è¿éåº¦ãå³ä¾¿å¤§é¨åæ¹æ¬¡ä½ç½®æ¯ Paddingï¼ç©ºæ°æ®ï¼ï¼CUDA Graph ä¾ç¶ä¼ä¸¥æ ¼æ§è¡å½å¶æ¶çåå­å¯»åå®ä¹ï¼æ¬è¿å®æ´æ¹æ¬¡çæ°æ®ãä½¿ç¨è¿å¤§çæ¹æ¬¡ä¼å¯¼è´ GPU æµªè´¹æå¶å®è´µçå¸¦å®½å»æ¬è¿âæ ææ°æ®âï¼ä»èå¢å åæ¬¡æ¨ççèæ¶ï¼æ¨é«æ¨çå»¶è¿ï¼Latencyï¼ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="bn155-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="bn155-0-0"><span data-offset-key="bn155-0-0">è®¡ç®èµæºçæ æå ç¨ï¼GPU è°åº¦å¨ä¼æ ¹æ®å¾å®ä¹çè§æ¨¡é¢åéç¡¬ä»¶èµæºï¼å¦ SM æ ¸å¿ãå¯å­å¨ãå±äº«æ¾å­ç­ï¼ãè½ç¶ Padding é¨åçè®¡ç®é»è¾æå¿«ï¼ä½è¿äºèµæºå¨æ´ä¸ª CUDA Graph æ§è¡å®æåæ æ³è¢«éæ¾ãè¿ä¼å¯¼è´ GPU ç¡¬ä»¶å¤äºâèåç¹å¿âç¶æï¼é»å¡äºå¶ä»æ½å¨ä»»å¡ï¼å¦å¤æµå¹¶è¡ç­ï¼è·åç¡¬ä»¶èµæºï¼åå¼±äºç³»ç»æ´ä½çå¹¶åååè½åï¼Throughputï¼ã</span></div>
</div>
<h1 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="2lj8v-0-0"><span data-offset-key="2lj8v-0-0">7. Torch Compilation</span></h1>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="5nq47-0-0"><span data-offset-key="5nq47-0-0">7.1. æ¦å¿µçè§£</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="cm5ot-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="cm5ot-0-0"><span data-offset-key="cm5ot-0-0">torch.compile è½å¤å° PyTorch å¼ éè®¡ç®ç¸å³ç Python é»è¾ï¼è½¬åä¸ºæ´é«æçä¸­é´è¡¨ç¤ºï¼å¨ CUDA è®¾å¤ä¸ï¼éå¸¸æ¯ Triton åæ ¸ä»£ç ï¼ä¹æ¯æåç CUDA åæ ¸ï¼ãç¸è¾äºä¼ ç»çå³æ¶æ§è¡ï¼Eager Modeï¼ï¼è¿ç§æ¹å¼éè¿ä¼åè®¡ç®åæ ¸æ¬èº«å¸¦æ¥æ¾èçè¿è¡æçæåï¼æ­¤å¤ï¼å½è¾å¥å¼ éå½¢ç¶ãæ°æ®ç±»ååºå®æ¶ï¼torch.compile è¿ä¼èªå¨å¯ç¨ CUDA Graph ä¼åï¼è¿ä¸æ­¥æ¾å¤§æ§è½æ¶çã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="c8lai-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="c8lai-0-0"><span data-offset-key="c8lai-0-0">å¨ torch.compile é®ä¸ä¹åï¼PyTorch å¼åèè¥æ³è¿½æ±é«æ§è½ï¼ä»æä¸¤ç§æ ¸å¿éæ©ï¼ä¸æ¯ä½¿ç¨ Eager Mode æ¥åå¶åçæ§è½ä¸éï¼äºæ¯æå¨ç¼å Triton æ CUDA åºå±åæ ¸ä»£ç ï¼è¯¥æ¹å¼å¼åé¨æ§é«ãå¨æé¿ãç»´æ¤ææ¬é«ï¼ãèæäº torch.compile åï¼å¼åèåªéç¼åç®æ´ææç PyTorch Python ä¸å¡é»è¾ï¼æ éå³æ³¨åºå±ç¡¬ä»¶ééä¸åæ ¸å®ç°ï¼å³å¯è·å¾æ¥è¿æå Triton/CUDA çä¼å¼æ§è½ï¼å¤§å¹å¹³è¡¡äºå¼åæçä¸è¿è¡æ§è½ã</span></div>
</div>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="6rc4c-0-0"><span data-offset-key="6rc4c-0-0">7.2. ä½¿ç¨æ¹æ³</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="c5lru-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="c5lru-0-0"><span data-offset-key="c5lru-0-0">åºç¨ torch.compile éå¸¸ç®åï¼æ ¸å¿æä¸¤ç±»ä½¿ç¨æ¹å¼ï¼</span></div>
</div>
<ul class="public-DraftStyleDefault-ul" data-offset-key="fmk6u-0-0">
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-reset public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="fmk6u-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="fmk6u-0-0"><span data-offset-key="fmk6u-0-0">è£é¥°å¨æ¹å¼ï¼å¨ PyTorch å½æ°ä¸ç´æ¥æ·»å  @torch.compile è£é¥°å¨ï¼å®ä¹æ¶å³å®æç¼è¯å£°æï¼</span></div>
</li>
<li class="Editable-styled public-DraftStyleDefault-unorderedListItem public-DraftStyleDefault-depth0 public-DraftStyleDefault-listLTR" data-block="true" data-editor="2doff" data-offset-key="4elg8-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4elg8-0-0"><span data-offset-key="4elg8-0-0">æ¾å¼è°ç¨æ¹å¼ï¼éè¿ compiled_obj = torch.compile(target) æ¾å¼ç¼è¯ç®æ å¯¹è±¡ï¼åç»­è°ç¨ compiled_obj å³å¯ä½¿ç¨ä¼ååçé»è¾ï¼</span></div>
</li>
</ul>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="5ho4n-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="5ho4n-0-0"><span data-offset-key="5ho4n-0-0">å¦å¤ï¼å¯ä»¥å¯¹æ¨¡åå®ä¾çç´æ¥ç¼è¯ï¼å¯¹äº PyTorch æ¨¡åï¼nn.Module å­ç±»å®ä¾ï¼ï¼å¯ç´æ¥ä¼ å¥ torch.compile å®ææ´ä½ç¼è¯ï¼æ éåç¬ä¿®é¥° forward æ¹æ³ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="c8n8n-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="c8n8n-0-0"><span data-offset-key="c8n8n-0-0">ç¤ºä¾ä»£ç ï¼</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="b4tlg-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="b4tlg-0-0"><span data-offset-key="b4tlg-0-0">æ¹å¼ 1ï¼è£é¥°å¨æ¹å¼ï¼éç¨äºå½æ° / æ¨¡åæ¹æ³ï¼</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="fipu7-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> torch
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> torch.nn as nn

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¯¹æ®éPyTorchå½æ°ä½¿ç¨è£é¥°å¨</span>
<span style="color: rgba(0, 0, 0, 1)">@torch.compile
</span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> my_tensor_func(x, y):
    </span><span style="color: rgba(0, 0, 255, 1)">return</span> torch.matmul(x, y) +<span style="color: rgba(0, 0, 0, 1)"> torch.relu(y)

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¯¹æ¨¡åçforwardæ¹æ³ä½¿ç¨è£é¥°å¨</span>
<span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> MyModel(nn.Module):
    @torch.compile  </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ä¿®é¥°forwardæ¹æ³ï¼èªå¨ç¼è¯æ¨¡åæ¨çé»è¾</span>
    <span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> forward(self, x):
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> nn.Linear(10, 20)(x)</pre>
</div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="3u91i-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="3u91i-0-0"><span data-offset-key="3u91i-0-0">æ¹å¼ 2ï¼æ¾å¼è°ç¨æ¹å¼ï¼éç¨äºå½æ° / æ¨¡åï¼çµæ´»æ§æ´é«ï¼</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="75c4t-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> torch
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> torch.nn as nn

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ¾å¼ç¼è¯æ®éå½æ°</span>
<span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> my_tensor_func(x, y):
    </span><span style="color: rgba(0, 0, 255, 1)">return</span> torch.matmul(x, y) +<span style="color: rgba(0, 0, 0, 1)"> torch.relu(y)
compiled_func </span>= torch.compile(my_tensor_func)  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çæç¼è¯åçå½æ°</span>
output = compiled_func(torch.randn(32, 10), torch.randn(10, 20))  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è°ç¨ç¼è¯åçå½æ°</span>

<span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ¾å¼ç¼è¯æ¨¡åï¼ä¸æ¹å¼3æ¬è´¨ä¸è´ï¼æ´å¼ºè°âåç¼è¯åä½¿ç¨âçæ¾å¼æµç¨ï¼</span>
<span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> MyModel(nn.Module):
    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> forward(self, x):
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> nn.Linear(10, 20<span style="color: rgba(0, 0, 0, 1)">)(x)
model </span>=<span style="color: rgba(0, 0, 0, 1)"> MyModel()
compiled_model </span>= torch.compile(model)  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ç´æ¥ç¼è¯æ´ä¸ªæ¨¡åå®ä¾</span>
output = compiled_model(torch.randn(32, 10))  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è°ç¨ç¼è¯åçæ¨¡å</span></pre>
</div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="ksl4-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="ksl4-0-0"><span data-offset-key="ksl4-0-0">æ¹å¼ 3ï¼ç´æ¥ç¼è¯æ¨¡åå®ä¾ï¼æ·±åº¦å­¦ä¹ ä¸­æå¸¸ç¨ï¼ç®ååæ³ï¼</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="71fom-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> torch
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> torch.nn as nn

</span><span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> MyModel(nn.Module):
    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> forward(self, x):
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> nn.Linear(10, 20<span style="color: rgba(0, 0, 0, 1)">)(x)

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ç´æ¥ç¼è¯æ¨¡åå®ä¾ï¼ä¸æ­¥å°ä½ï¼æ éè£é¥°å¨ï¼æç®æ´å¸¸ç¨ï¼</span>
model =<span style="color: rgba(0, 0, 0, 1)"> torch.compile(MyModel())
output </span>= model(torch.randn(32, 10))</pre>
</div>
</div>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="785ra-0-0"><span data-offset-key="785ra-0-0">7.3. æ§è½å¯¹æ¯</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="3uufk-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="3uufk-0-0"><span data-offset-key="3uufk-0-0">ä¸é¢ä»¥ä¸ä¸ªç®åçä¾å­å¯¹æ¯ Eager Mode å Compiled Modeï¼</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="54acu-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> torch
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> time

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ç¡®ä¿ä½¿ç¨çæ¯ GPU</span>
device = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">cuda</span><span style="color: rgba(128, 0, 0, 1)">"</span> <span style="color: rgba(0, 0, 255, 1)">if</span> torch.cuda.is_available() <span style="color: rgba(0, 0, 255, 1)">else</span> <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">cpu</span><span style="color: rgba(128, 0, 0, 1)">"</span>
<span style="color: rgba(0, 0, 255, 1)">if</span> device == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">cpu</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">è­¦åï¼CUDA ä¸å¯ç¨ï¼å°ä½¿ç¨ CPU è¿è¡ï¼torch.compile çä¼å¿å¨ GPU ä¸æææ¾ï¼ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

</span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> complex_operation_eager(x, y):
    z </span>= x *<span style="color: rgba(0, 0, 0, 1)"> y
    z </span>= z +<span style="color: rgba(0, 0, 0, 1)"> x
    z </span>=<span style="color: rgba(0, 0, 0, 1)"> torch.relu(z)
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> z.sum()

@torch.compile
</span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> complex_operation_graph(x, y):
    z </span>= x *<span style="color: rgba(0, 0, 0, 1)"> y
    z </span>= z +<span style="color: rgba(0, 0, 0, 1)"> x
    z </span>=<span style="color: rgba(0, 0, 0, 1)"> torch.relu(z)
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> z.sum()

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 1. åå¤æ°æ®</span>
x = torch.randn(10000, 10000, device=<span style="color: rgba(0, 0, 0, 1)">device)
y </span>= torch.randn(10000, 10000, device=<span style="color: rgba(0, 0, 0, 1)">device)

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 2. ç­èº« (Warm up)</span>
<span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ­£å¨ç¼è¯å¹¶è¿è¡å¤æ¬¡ç­èº«ä»¥ç¨³å® GPU ç¶æ...</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¢å ç­èº«å¾ªç¯</span>
<span style="color: rgba(0, 0, 255, 1)">for</span> i <span style="color: rgba(0, 0, 255, 1)">in</span> range(3<span style="color: rgba(0, 0, 0, 1)">): 
    complex_operation_graph(x, y)
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> i ==<span style="color: rgba(0, 0, 0, 1)"> 0:
        </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">-&gt; é¦æ¬¡ç¼è¯å®æï¼æ­£å¨è¿è¡åç»­é¢ç­...</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

torch.cuda.synchronize()
</span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">é¢ç­å®æ¯ï¼å¼å§æ­£å¼æµè¯ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

</span><span style="color: rgba(0, 0, 255, 1)">def</span> benchmark(func, x, y, label, iterations=100<span style="color: rgba(0, 0, 0, 1)">):
    start_event </span>= torch.cuda.Event(enable_timing=<span style="color: rgba(0, 0, 0, 1)">True)
    end_event </span>= torch.cuda.Event(enable_timing=<span style="color: rgba(0, 0, 0, 1)">True)
    
    start_event.record()
    </span><span style="color: rgba(0, 0, 255, 1)">for</span> _ <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(iterations):
        func(x, y)
    end_event.record()
    
    torch.cuda.synchronize()
    
    elapsed_time_ms </span>=<span style="color: rgba(0, 0, 0, 1)"> start_event.elapsed_time(end_event)
    avg_time_s </span>= (elapsed_time_ms / 1000) /<span style="color: rgba(0, 0, 0, 1)"> iterations
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{label} å¹³åèæ¶: {avg_time_s:.6f} ç§</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> avg_time_s

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 3. æ§è¡æµè¯å¹¶è®¡ç®å éæ¯</span>
<span style="color: rgba(0, 0, 0, 1)">with torch.no_grad():
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">-</span><span style="color: rgba(128, 0, 0, 1)">"</span> * 30<span style="color: rgba(0, 0, 0, 1)">)
    eager_time </span>= benchmark(complex_operation_eager, x, y, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Eager Mode   </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    compile_time </span>= benchmark(complex_operation_graph, x, y, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Compiled Mode</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">-</span><span style="color: rgba(128, 0, 0, 1)">"</span> * 30<span style="color: rgba(0, 0, 0, 1)">)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¡ç®å éæ¯é»è¾</span>
    speedup = eager_time /<span style="color: rgba(0, 0, 0, 1)"> compile_time
    improvement </span>= (speedup - 1) * 100
    
    <span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ§è½æåç»æ:</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å éæ¯ (Speedup): {speedup:.2f}x</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">è¿è¡éåº¦æåäº: {improvement:.1f}%</span><span style="color: rgba(128, 0, 0, 1)">"</span>)</pre>
</div>
<p><span data-offset-key="2kshu-0-0">è¿è¡è¾åºï¼</span></p>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="6b49q-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">æ­£å¨ç¼è¯å¹¶è¿è¡å¤æ¬¡ç­èº«ä»¥ç¨³å® GPU ç¶æ...
</span>-&gt;<span style="color: rgba(0, 0, 0, 1)"> é¦æ¬¡ç¼è¯å®æï¼æ­£å¨è¿è¡åç»­é¢ç­...
é¢ç­å®æ¯ï¼å¼å§æ­£å¼æµè¯ã
</span>------------------------------<span style="color: rgba(0, 0, 0, 1)">
Eager Mode    å¹³åèæ¶: </span>0.005690<span style="color: rgba(0, 0, 0, 1)"> ç§
Compiled Mode å¹³åèæ¶: </span>0.001528<span style="color: rgba(0, 0, 0, 1)"> ç§
</span>------------------------------<span style="color: rgba(0, 0, 0, 1)">
æ§è½æåç»æ:
å éæ¯ (Speedup): </span>3<span style="color: rgba(0, 0, 0, 1)">.72x
è¿è¡éåº¦æåäº: </span>272.3%</pre>
</div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="8r98n-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="8r98n-0-0"><span data-offset-key="8r98n-0-0">æ§è½ææ°åçæåã</span></div>
</div>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="a8508-0-0"><span data-offset-key="a8508-0-0">7.4. Q&amp;A</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="1pjmk-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="1pjmk-0-0"><span data-offset-key="1pjmk-0-0">ï¼1ï¼æ¢ç¶ torch.compile æè¿ä¹å¤§çå¥½å¤ï¼ä¸ºä»ä¹ä¸è½ç»ææçå¼ éæä½å½æ°é½å ä¸ @torch.compileï¼</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="eem3i-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="eem3i-0-0"><span data-offset-key="eem3i-0-0">æå æ¹é¢çåå ï¼é¦åï¼å­å¨ç¼è¯å¼éï¼ä¼å¯¼è´é¦æ¬¡è¿è¡æ¾èåæ¢ï¼ç¶åï¼ç¼è¯å¨çæç Triton åæ ¸ï¼æå¶ä»åç«¯ä»£ç ï¼éå¸¸æ¯éå¯¹ç¹å®å¼ éå½¢ç¶ãæ°æ®ç±»ååè®¾å¤éç½®ä¼åçï¼å¦æè¾å¥å¼ éçè¿äºå±æ§é¢ç¹ååï¼ä¼åå¤è§¦åéæ°ç¼è¯ï¼å³ âç¼è¯ç¼å­å¤±æâï¼ï¼åèæµæ¶æ§è½æ¶çï¼ç¬¬ä¸ï¼torch.compile èªèº«ä¼å¸¦æ¥é¢å¤çæ¾å­å¼éï¼ç¨äºå­å¨ç¼è¯åçä¸­é´è¡¨ç¤ºãåæ ¸ç¼å­ç­ï¼ï¼è¿å¤æ å·®å«ä½¿ç¨å¯è½å¯¼è´æ¾å­ä¸è¶³ï¼OOMï¼ï¼æåï¼å¹¶éææä»£ç é½è½è¢«æåå¾åä¼åï¼å¦æå¼ éæä½ä¸­è°ç¨äºé PyTorch åççç¬¬ä¸æ¹åºï¼æçº¯ Python åçé»è¾ï¼ï¼ä¼å¯¼è´è®¡ç®å¾ä¸­æ­ï¼æ­¤æ¶ç¼è¯å¨æ æ³ç»§ç»­ä¼ååç»­é»è¾ï¼è¿éè¦å°æ§å¶æäº¤åç» Python è§£éå¨ï¼äº§çä¸å¿è¦çä¸ä¸æåæ¢å¼éï¼å¯è½å¯¼è´è´ä¼åã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="7ngdh-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="7ngdh-0-0"><span data-offset-key="7ngdh-0-0">ï¼2ï¼torch.compile æ¯æçæåç CUDA åæ ¸ä»£ç ï¼ä½éå¸¸æ¥è¯´ï¼ç¼è¯å¨èªå¨çæçéç¨åç CUDA ä»£ç ä¼åç²åº¦ä¸å¤ç²¾ç»ï¼è Triton åç½®äºæå¼ºç Autotuningï¼èªå¨è°ä¼ï¼è½åï¼éå¯¹æ·±åº¦å­¦ä¹ å¼ éè®¡ç®åºæ¯åäºæ·±åº¦ééï¼å æ­¤å¨ç»å¤§å¤æ°æ·±åº¦å­¦ä¹ ä»»å¡ä¸­ï¼Triton åæ ¸çæ§è½éå¸¸ä¼äºèªå¨çæçåç CUDA åæ ¸ã</span></div>
</div>
<h1 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="cjuuo-0-0"><span data-offset-key="cjuuo-0-0">8. Torch CompilationãTritionãCUDA Graph ä¸èçåºå«åèç³»</span></h1>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="6nkil-0-0"><span data-offset-key="6nkil-0-0">8.1. æ ¸å¿åºå«</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="2n3n3-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="2n3n3-0-0"><span data-offset-key="2n3n3-0-0">ï¼1ï¼Torch Compilationï¼PyTorch é«å±ä¸ç«å¼æ§è½ä¼åå¥å£ï¼ç¨æ·ææ½è±¡æ¥å£ï¼</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="apt7h-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="apt7h-0-0"><span data-offset-key="apt7h-0-0">ä½ä¸ºé¢åå¼åèçé¡¶çº§ä¼åå°è£ï¼torch.compile æ éå¼åèå³æ³¨åºå±ç¡¬ä»¶ç»èä¸ä¼åå®ç°ï¼å¶æ ¸å¿å®ä½æ¯å¯¹ PyTorch å¼ éè®¡ç®é»è¾ï¼å½æ° /nn.Module æ¨¡åï¼è¿è¡ç«¯å°ç«¯èªå¨ä¼åï¼å±è½äºåºå±åæ ¸çæä¸æ§è¡ä¼åçå¤ææ§ï¼æ¯ç»å¤§å¤æ° PyTorch å¼åèçé¦éæ§è½ä¼åå·¥å·ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="9i7c0-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="9i7c0-0-0"><span data-offset-key="9i7c0-0-0">ï¼2ï¼Tritonï¼é«æ§è½ GPU åæ ¸ä¸ç¨ DSL </span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="5ts50-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="5ts50-0-0"><span data-offset-key="5ts50-0-0">Triton æ¢æ¯å¼åèæå¨ç¼åé«æ§è½åæ ¸çé¢åä¸ç¨è¯­è¨ï¼DSLï¼ï¼ä¹æ¯ torch.compile èªå¨åçæä»£ç çæ ¸å¿ç®æ åç«¯ãå¶ä¸­ï¼triton.jit æ¯ Triton æ¡æ¶æä¾çå³æ¶ç¼è¯è£é¥°å¨ï¼å®ä½ä¸ºé«æ§è½è·¨å¹³å° GPU åæ ¸çæå¨å¼åå¥å£ï¼æ½è±¡å±çº§ä½äº torch.compileãé«äºåç CUDA C++ãå®åè®¸å¼åèä»¥ Python é£æ ¼è¯­æ³ç¼å GPU åæ ¸é»è¾ï¼æ éæå¨å¤ççº¿ç¨è°åº¦ãå¯å­å¨åéç­åºå±ç»èï¼æç»ç¼è¯ä¸ºé«æ GPU æºå¨ç ï¼ç¨äºæ»¡è¶³å®å¶åç®å­çé«æ§è½éæ±ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="7706f-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="7706f-0-0"><span data-offset-key="7706f-0-0">ï¼3ï¼CUDA Graphï¼GPU åºå±éæä»»å¡æµæ§è¡ä¼åææ¯</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="d2kt1-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="d2kt1-0-0"><span data-offset-key="d2kt1-0-0">CUDA Graph æ¯ä¸ç§éæä»»å¡æµè°åº¦ææ¯ï¼æ¨å¨æ¶é¤ä¸»æºç«¯ï¼Hostï¼ä¸è®¾å¤ç«¯ï¼Deviceï¼ä¹é´çäº¤äºå»¶è¿ãå®å¹¶é âåæ ¸çæå·¥å·âï¼ä¹é âç¨æ·æç¼ç¨æ¥å£âï¼èæ¯éå¯¹ CPU-GPU äº¤äºç¶é¢çåºå±æ§è¡ä¼åææ¯ï¼æ½è±¡å±çº§æä½ãå¶æ ¸å¿ä½ç¨æ¯åºåè¿ç»­ç CUDA åæ ¸è°ç¨åºåä¸åå­éç½®ï¼éè¿ âå½å¶ - éæ¾â æ¨¡å¼æ¶é¤éå¤åæ ¸å¯å¨ãCPU-GPU é¢ç¹éä¿¡çå¼éï¼ä»ä¼åæ§è¡æµç¨ï¼ä¸æ¹ååæ ¸æ¬èº«çè®¡ç®æ§è½ã</span></div>
</div>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="b3b7c-0-0"><span data-offset-key="b3b7c-0-0">8.2. æ ¸å¿èç³»</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="4qtm8-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4qtm8-0-0"><span data-offset-key="4qtm8-0-0">ï¼1ï¼torch.compile ä¾èµ triton.jit å®ç°é«æ§è½åæ ¸çæ</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="1bgf5-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="1bgf5-0-0"><span data-offset-key="1bgf5-0-0">torch.compile çé»è®¤åºå±ç¼è¯å¨ï¼Inductorï¼å¨ CUDA è®¾å¤ä¸ï¼ä¼èªå¨å° PyTorch è®¡ç®é»è¾è½¬åä¸º Triton åæ ¸ä»£ç ï¼å¹¶éå¼è°ç¨ triton.jit å®æç¼è¯ï¼çæé«æ§è½ GPU åæ ¸ï¼å¼åèæ éæå¨ç¼å Triton ä»£ç ï¼ä¹æ éæç¥ triton.jit çå­å¨ï¼ãæ­¤å¤ï¼torch.compile ä¹æ¯æçæåç CUDA åæ ¸ï¼ä½ä¸º Triton åæ ¸çå¯éè¡¥åæ¹æ¡ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="3toqg-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="3toqg-0-0"><span data-offset-key="3toqg-0-0">ï¼2ï¼torch.compile éæ CUDA Graph å®ç°æ§è¡å±äºæ¬¡ä¼å</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="ch8uv-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="ch8uv-0-0"><span data-offset-key="ch8uv-0-0">å½è¾å¥å¼ éçå½¢ç¶ãæ°æ®ç±»åç­å±æ§åºå®æ¶ï¼torch.compile ä¼èªå¨å¯ç¨ CUDA Graph ä¼åï¼å°ç¼è¯çæç Triton/CUDA åæ ¸è°ç¨åºåå½å¶ä¸º CUDA å¾ãåç»­éå¤æ§è¡è¯¥é»è¾æ¶ï¼ç´æ¥å¨ GPU ä¸éæ¾è¯¥å¾ï¼è¿ä¸æ­¥æ¾å¤§æ§è½æ¶çï¼å®ç° âåæ ¸è®¡ç®ä¼åâ ä¸ âæ§è¡æµç¨ä¼åâ çååå¢æã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="8idqa-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="8idqa-0-0"><span data-offset-key="8idqa-0-0">ï¼3ï¼triton.jit èªå®ä¹åæ ¸å¯ä¸ CUDA Graph æå¨åå</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="4r30e-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4r30e-0-0"><span data-offset-key="4r30e-0-0">å¼åèæå¨éè¿ triton.jit ç¼åå¹¶ç¼è¯çèªå®ä¹åæ ¸ï¼å¨æ¹ééå¤æ§è¡ï¼è¾å¥å½¢ç¶åºå®ï¼çåºæ¯ä¸ï¼å¯æå¨éæ CUDA Graph å®æ âå½å¶ - éæ¾â æµç¨ï¼æ¶é¤ CPU å¯¹ GPU çè°åº¦å¼éï¼å®ç°åæ ¸è®¡ç®æ§è½ä¸æ§è¡æççåéæè´ä¼åã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="bju28-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="bju28-0-0"><span data-offset-key="bju28-0-0">ï¼4ï¼ä¸èååæå»ºæè´æ§è½è®¡ç®é¾è·¯</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="1aest-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="1aest-0-0"><span data-offset-key="1aest-0-0">å¸åæè´æ§è½é¾è·¯ï¼æå¨ç¼å triton.jit å®å¶åæ ¸ â åµå¥ PyTorch æ¨¡å / å½æ° â éè¿ torch.compile è¿è¡ä¸å±è®¡ç®å¾ä¼åï¼ç®å­èåãåå­å¤ç¨ç­ï¼ â torch.compile èªå¨å¯ç¨ CUDA Graph ä¼åæ§è¡æµç¨ â å®ç° GPU è®¡ç®æ§è½æå¤§åã</span></div>
</div>
<h1 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="fu2v8-0-0"><span data-offset-key="fu2v8-0-0">9. TP æ¨¡å¼</span></h1>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="7u897-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="7u897-0-0"><span data-offset-key="7u897-0-0">TP æ¨¡å¼å°ç©éµè®¡ç®æè¡ãåæåå°å¤é¢ GPU ä¸æ§è¡ï¼æ¶åä¸¤ä¸ªå³é®ç¹ï¼æéåæ°æä¹å è½½ãå¤æ ¸è®¡ç®ä¹é´å¦ä½ååï¼ä¸é¢åä»ç»ã</span></div>
</div>
<h2 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="9ug66-0-0"><span data-offset-key="9ug66-0-0">9.1. å è½½æéåæ°</span></h2>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="1ed97-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="1ed97-0-0"><span data-offset-key="1ed97-0-0">æéåæ°ä¸ç©éµè®¡ç®å¼ºç¸å³ï¼å æ­¤æéåæ°çå è½½é»è¾éå¸¸ä¸ç©éµè®¡ç®é»è¾ä¸åå°è£å¨åä¸ä¸ªç±»ä¸­ï¼å®ç°åè½çåèæ§ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="a4too-0-0">
<h3 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="a4too-0-0"><span data-offset-key="a4too-0-0">9.1.1. å³é®ææ¯ç¹</span></h3>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="9sa3o-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="9sa3o-0-0"><span data-offset-key="9sa3o-0-0">ï¼1ï¼åæ°æä»¶ä¸­ï¼æéç©éµä»¥ Key-Value é®å¼å¯¹å½¢å¼å­å¨ï¼è¯»åæ¶åæ ·éç¨ Key-Value æ¹å¼è§£æãå¶ä¸­ key å¯¹åºæéç©éµå¨æ¨¡åä¸­çå½å±ä½ç½®ï¼ä¾å¦ï¼æ¨¡åç¬¬ 0 å± MLP å­å±ç down proj æéå¯¹åºç key ä¸º model.layers.0.mlp.down_proj.weightã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="7ppg-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="7ppg-0-0"><span data-offset-key="7ppg-0-0">ï¼2ï¼åæ°æä»¶ç±è®­ç»æµç¨åå¥ãæ¨çæµç¨è¯»åï¼è®­ç»ä¸æ¨çä¸¤ä¾§å¿é¡»ä¸¥æ ¼å¯¹é½ key çå½åè§åãæ¨¡ååæ°å è½½æ¶ï¼ä¼æ ¹æ®åæ°æä»¶ä¸­ç key åç§°ï¼å¨ nn.Module å¯¹è±¡ä¸­å¹éå¹¶è°ç¨å¯¹åºç weight_loader æ¹æ³å®æå è½½ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="755gf-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="755gf-0-0"><span data-offset-key="755gf-0-0">ï¼3ï¼æ¨¡åç»æåå«å¤ä¸ªå±çº§ï¼æ¯ä¸å±åé¨ååå«å¤ä¸ªå­æ¨¡åï¼ä¸åå­æ¨¡åå¯¹åºåèªä¸å±çåæ°å è½½æ¹æ³ãPyTorch ç nn.Module éè¿ç¹æ®æ¹æ³ __setattr__ï¼å°æ¨¡åç»æä¸­çåä¸ªå­æ¨¡åæå»ºä¸ºæ å½¢ç»æï¼æ å½¢ç»æä¸­æ¯ä¸ªå¶å­èç¹çè·¯å¾ï¼ä¸åæ°æä»¶ä¸­ç key ä¸ä¸æ å°ï¼éè¿è¯¥è·¯å¾æ¾å°å¶å­èç¹åï¼å³å¯è·åå¯¹åºçåæ°å¯¹è±¡ nn.Parameterï¼èè¯¥åæ°å¯¹è±¡ç»å®äºå¶æå±å­æ¨¡åç weight_loader æ¹æ³ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="6bnm0-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="6bnm0-0-0"><span data-offset-key="6bnm0-0-0">ï¼4ï¼ç©éµä¹æ³ A * B éµå¾ªãA çè¡ Ã B çåãè®¡ç®è§åï¼å¨æ¨¡åæ¨çä¸­ï¼B ä¸ºæéç©éµï¼å®éè®¿é®æ¶ä»¥åç»´åº¦ä¸ºä¸»ãä¸ºæåè¯»åæçãé¿åç¼å­ï¼Cacheï¼é¢ç¹å¤±æï¼æéç©éµ B éå¸¸ä»¥è½¬ç½®å½¢å¼å­å¨ãTPï¼Tensor Parallelï¼worker å è½½æéæ¶ï¼éééè¯¥è½¬ç½®å­å¨ç¹æ§ ââ å³æéç©éµç¬¬ 0 ç»´å¯¹åºåå§ç©éµçåæ°æ®ï¼ç¬¬ 1 ç»´å¯¹åºåå§ç©éµçè¡æ°æ®ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="5ju20-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="5ju20-0-0"><span data-offset-key="5ju20-0-0">ä»ä¸è¿°ææ¯ç¹å¯å¾åºæ ¸å¿å¯¹åºå³ç³»ï¼åæ°æä»¶ä¸­çæ¨¡åç»æä»¥ä¸ä¸ªä¸ª key è¡¨ç¤ºï¼è¿äº key æå±çº§å³ç³»å¯æå»ºä¸ºä¸æ£µè·¯å¾æ ï¼ä»£ç ä¸­çæ¨¡åç»æä»¥æåå«å³ç³»çç±»å¯¹è±¡è¡¨ç¤ºï¼è¿äºç±»å¯¹è±¡åæ ·ææä¸æ£µä¸åæ°æä»¶è·¯å¾æ å®å¨å¯¹åºçæ ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="b27tp-0-0">
<h3 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="b27tp-0-0"><span data-offset-key="b27tp-0-0">9.1.2. å®æä¸¾ä¾ï¼FFN å± up proj æéå è½½ï¼</span></h3>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="3icrf-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="3icrf-0-0"><span data-offset-key="3icrf-0-0">ï¼1ï¼åè®¾ TP size=2ï¼up proj æéç©éµçåå§å½¢ç¶ä¸º [1024, 3072]ï¼ä¸é¢ä»ç»ä¸ä¸ª TP worker å¦ä½å è½½æéã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="f26gi-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="f26gi-0-0"><span data-offset-key="f26gi-0-0">ï¼2ï¼é¦åï¼æé æ¨¡åå¯¹è±¡æ¶ï¼ä¼åå§å ColumnParallelLinear å¯¹è±¡ï¼å¹¶è®¾å®æ ¸å¿åæ°ï¼input_size=1024ï¼output_size=3072/2=1536ï¼æ TP å°ºå¯¸åååï¼ãè¿ä¸¤ä¸ªåæ°æç»ç¨äºåå§å nn.Parameter å¯¹è±¡ï¼å¯¹åºä»£ç ä¸º <span data-offset-key="f26gi-0-1"><span data-text="true">self.weight = nn.Parameter(torch.empty(output_size, input_size))<span data-offset-key="f26gi-0-2">ï¼éæ³¨ææ­¤å¤åå§åçå¼ éä»¥ output_size ä¸ºè¡ç»´åº¦ãinput_size ä¸ºåç»´åº¦ã</span></span></span></span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="6s4r7-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="6s4r7-0-0"><span data-offset-key="6s4r7-0-0">ï¼3ï¼éåï¼å¯å¨æ¨¡åæéå è½½æµç¨ï¼åä»åæ°æä»¶ä¸­è¯»åææ key-value é®å¼å¯¹ï¼åéè¿ key å¨ nn.Module æ å½¢ç»æä¸­æ¥æ¾å¯¹åºç nn.Parameter å¯¹è±¡ï¼å¹éå°åè°ç¨å¶ç»å®ç weight_loader å½æ°ï¼æ§è¡å·ä½çåæ°å è½½æä½ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="egb30-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="egb30-0-0"><span data-offset-key="egb30-0-0">ï¼4ï¼åæ°å è½½é¶æ®µï¼éå¯¹åå¹¶è¡æ¨¡å¼ï¼éè¦å¯¹æéå¼ éçç¬¬ 0 ç»´åº¦è¿è¡æåï¼åæ ¹æ®å½åè¿ç¨ç tp_rankï¼TP è¿ç¨ç¼å·ï¼ï¼ç¡®å®æ¬è¿ç¨éè¦å è½½çæéåºé´ï¼å®æåçæéçå è½½ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="49qid-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="49qid-0-0"><span data-offset-key="49qid-0-0">æ³¨ï¼ä»£ç å®ç°ä¸­ï¼ä¼å° gate ç©éµä¸ up ç©éµè¿è¡åå¹¶å è½½å°æ¾å­ä¸­ï¼å æ­¤å®éå è½½æµç¨ä¼å¨æ­¤åºç¡ä¸å¢å å æ­¥é¢å¤æ­¥éª¤ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="248v7-0-0">
<h3 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="248v7-0-0"><span data-offset-key="248v7-0-0">9.1.3. æé æ å½¢ç»æç¤ºä¾ä»£ç </span></h3>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="elaid-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="elaid-0-0"><span data-offset-key="elaid-0-0">ä¸é¢ demo ä»£ç å±ç¤ºå¤ä¸ªæå±çº§çå¯¹è±¡å¦ä½éè¿ç¹æ®æ¹æ³ __setattr__ æé æ å½¢ç»æ.</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="3hpeh-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> MiniModule:
    </span><span style="color: rgba(0, 0, 255, 1)">def</span> <span style="color: rgba(128, 0, 128, 1)">__init__</span>(self, name=<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">root</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">):
        self._name </span>=<span style="color: rgba(0, 0, 0, 1)"> name
        self._modules </span>=<span style="color: rgba(0, 0, 0, 1)"> {}
        self._parameters </span>=<span style="color: rgba(0, 0, 0, 1)"> {}

    </span><span style="color: rgba(0, 0, 255, 1)">def</span> <span style="color: rgba(128, 0, 128, 1)">__setattr__</span><span style="color: rgba(0, 0, 0, 1)">(self, name, value):
        </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> isinstance(value, MiniModule):
            self._modules[name] </span>=<span style="color: rgba(0, 0, 0, 1)"> value
        </span><span style="color: rgba(0, 0, 255, 1)">elif</span> name.endswith(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">_weight_loader</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">):
            self._parameters[name] </span>=<span style="color: rgba(0, 0, 0, 1)"> value

        super().</span><span style="color: rgba(128, 0, 128, 1)">__setattr__</span><span style="color: rgba(0, 0, 0, 1)">(name, value)

    </span><span style="color: rgba(0, 0, 255, 1)">def</span> get_all_paths(self, prefix=<span style="color: rgba(128, 0, 0, 1)">""</span><span style="color: rgba(0, 0, 0, 1)">):
        </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">éå½éåå¹¶æ¶éææåæ°çå®æ´è·¯å¾</span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(0, 0, 0, 1)">
        paths </span>=<span style="color: rgba(0, 0, 0, 1)"> []

        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 1. åæ¶éå½åå±çº§çåæ°è·¯å¾</span>
        <span style="color: rgba(0, 0, 255, 1)">for</span> p_name <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> self._parameters:
            full_path </span>= f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{prefix}.{p_name}</span><span style="color: rgba(128, 0, 0, 1)">"</span> <span style="color: rgba(0, 0, 255, 1)">if</span> prefix <span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)"> p_name
            paths.append(full_path)

        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 2. éå½è¿å¥å­æ¨¡åï¼ä¼ éæ´æ°åçåç¼</span>
        <span style="color: rgba(0, 0, 255, 1)">for</span> m_name, m_obj <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> self._modules.items():
            new_prefix </span>= f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{prefix}.{m_name}</span><span style="color: rgba(128, 0, 0, 1)">"</span> <span style="color: rgba(0, 0, 255, 1)">if</span> prefix <span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)"> m_name
            paths.extend(m_obj.get_all_paths(new_prefix))

        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> paths

</span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> q_weight_loader():
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">this is q_weight_loader</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

</span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> down_weight_loader():
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">this is down_weight_loader</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> --- æé æ å½¢ç»æ ---</span>
model = MiniModule(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Qwen3</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
model.layers </span>= MiniModule(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Layers</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
model.layers.attention </span>= MiniModule(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Attention</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
model.layers.attention.q_weight_loader </span>=<span style="color: rgba(0, 0, 0, 1)"> q_weight_loader
model.layers.mlp </span>= MiniModule(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">MLP</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
model.layers.mlp.down_weight_loader </span>=<span style="color: rgba(0, 0, 0, 1)"> down_weight_loader

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> --- æå°ææè·¯å¾ ---</span>
<span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">éåæ¨¡åçææåæ°è·¯å¾ï¼</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
all_paths </span>=<span style="color: rgba(0, 0, 0, 1)"> model.get_all_paths()
</span><span style="color: rgba(0, 0, 255, 1)">for</span> path <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> all_paths:
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">è·¯å¾: {path}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> --- æ¨¡æ nano-vllm çè®¿é®é»è¾ ---</span>
<span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> mock_get_parameter(root, path):
    parts </span>= path.split(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">.</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    curr </span>=<span style="color: rgba(0, 0, 0, 1)"> root
    </span><span style="color: rgba(0, 0, 255, 1)">for</span> part <span style="color: rgba(0, 0, 255, 1)">in</span> parts[:-1<span style="color: rgba(0, 0, 0, 1)">]:
        curr </span>=<span style="color: rgba(0, 0, 0, 1)"> curr._modules[part]
    </span><span style="color: rgba(0, 0, 255, 1)">return</span> curr._parameters[parts[-1<span style="color: rgba(0, 0, 0, 1)">]]

target </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">layers.attention.q_weight_loader</span><span style="color: rgba(128, 0, 0, 1)">"</span>
<span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\næ¨¡ææ¥æ¾è·¯å¾ '{target}':</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
loader </span>=<span style="color: rgba(0, 0, 0, 1)"> mock_get_parameter(model, target)
loader()</span></pre>
</div>
<p><span data-offset-key="a947g-0-0">è¾åºç»æï¼</span></p>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="9169c-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">éåæ¨¡åçææåæ°è·¯å¾ï¼
è·¯å¾: layers.attention.q_weight_loader
è·¯å¾: layers.mlp.down_weight_loader

æ¨¡ææ¥æ¾è·¯å¾ </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">layers.attention.q_weight_loader</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">:
this is q_weight_loader</span></pre>
</div>
<h2><span data-offset-key="1c5sg-0-0">9.2. å¤ GPU ä¹é´çè®¡ç®åå</span></h2>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="2akov-0-0">
<h3 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="2akov-0-0"><span data-offset-key="2akov-0-0">9.2.1. åè½ç»è</span></h3>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="e8sf9-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="e8sf9-0-0"><span data-offset-key="e8sf9-0-0">nano-vllm åªèèåæºåçå¤ GPU ååï¼ååè¿ç¨å¦ä¸ï¼</span></div>
</div>
<div class="Image-captionContainer" data-size="normal">
<div>
<div class="Image-resizerContainer css-ym3v7r" data-size="normal">
<div class="css-79elbk">
<div>
<div class="ImageDelete-Container css-xi606m">
<div class="ImageDelete-Wrapper css-1gomreu" style="text-align: center"><img src="https://pic1.zhimg.com/80/v2-7f054d91f4badab37cab087059b847da_1440w.png?source=ccfced1a" width="500" height="351" class="Image FocusPlugin--unfocused Image--isBlock css-1phd9a0" loading="lazy" data-size="normal" data-rawwidth="888" data-rawheight="624" data-watermark="original" data-original-src="https://picx.zhimg.com/v2-7f054d91f4badab37cab087059b847da.jpg?source=ccfced1a" data-watermark-src="https://pic1.zhimg.com/v2-2ef0dde703c5cd92d206eb126dd9addc_1440w.jpg?source=ccfced1a"></div>
</div>
</div>
</div>
</div>
</div>
<div style="text-align: center">å¾ 5</div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="8ko79-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="8ko79-0-0"><span data-offset-key="8ko79-0-0">ï¼1ï¼è¿ç¨éç¦»ä¸ç¬ç«å è½½ï¼ éç¨å¤è¿ç¨æ¨¡å¼ï¼ä¸ä¸ª GPU å¯¹åºä¸ä¸ªç¬ç«è¿ç¨ãåè¿ç¨å¹¶åè¯»åæéæä»¶ï¼å¹¶æ ¹æ®èªå·±ç tp_rank æç§é¢è®¾çååç­ç¥ï¼å¦ ColumnParallel çè¡ååæ RowParallel çåååï¼ï¼å°å±äºèªå·±çé£é¨åæ°æ®ä» safetensors å è½½å°æ¾å­ä¸­ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="30dnu-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="30dnu-0-0"><span data-offset-key="30dnu-0-0">ï¼2ï¼æ§å¶é¢ååï¼Control Planeï¼ï¼ Rank 0 è´è´£å¨å±è°åº¦ï¼éè¿å±äº«åå­å°æ¨çè¯·æ±ï¼TokensãSampling Params ç­ï¼åæ­¥ç»å¶ä» Rankã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="e56gm-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="e56gm-0-0"><span data-offset-key="e56gm-0-0">ï¼3ï¼æ°æ®é¢éä¿¡ï¼Data Planeï¼ï¼ å¨ç©éµè®¡ç®çå³é®èç¹ï¼å©ç¨éä¿¡åè¯­ï¼å¦ all-reduce å¤çååæ±åãall-gather å¤çåºåæ¼æ¥ï¼å®æå¼ éå¹¶è¡çç»ææ±æ»ï¼ä½¿åå¸å¨ä¸åæ¾å¡ä¸çè®¡ç®ç»æå¨æ°å­¦ä¸ç­ä»·äºåå¡è®¡ç®ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="1a163-0-0">
<h3 class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="1a163-0-0"><span data-offset-key="1a163-0-0">9.2.2. ç¤ºä¾ä»£ç </span></h3>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="4et0l-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="4et0l-0-0"><span data-offset-key="4et0l-0-0">ä¸é¢åä¸ä¸ªç®åçæ°æ®éä¿¡ä¾å­ï¼</span></div>
</div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="bue3l-0-0">
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">import torch
import torch.distributed as dist
import torch.multiprocessing as mp
import </span><span style="color: rgba(0, 0, 255, 1)">time</span><span style="color: rgba(0, 0, 0, 1)">

def setup(rank, world_size):
    dist.init_process_group(
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">nccl</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">tcp://127.0.0.1:2333</span><span style="color: rgba(128, 0, 0, 1)">"</span>, world_size=world_size, rank=<span style="color: rgba(0, 0, 0, 1)">rank
    )
    torch.cuda.set_device(rank)

def cleanup():
    dist.destroy_process_group()

def test_all_reduce(rank, world_size):
    </span><span style="color: rgba(128, 0, 0, 1)">"""
</span>    All-<span style="color: rgba(0, 0, 0, 1)">Reduce å­å½æ°ï¼å°ææ GPU çæ°æ®è¿è¡å½çº¦æä½ï¼æ±åï¼ï¼ç»æåæ­¥å°ææ GPU

    ä½¿ç¨åºæ¯ï¼
    </span>-<span style="color: rgba(0, 0, 0, 1)"> RowParallelLinear çè¾åºèå
    </span>-<span style="color: rgba(0, 0, 0, 1)"> éè¦ææ GPU é½å¾å°ç¸åçèåç»æ
    </span><span style="color: rgba(128, 0, 0, 1)">"""
</span>    print(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">[Rank {rank}] ===== All-Reduce ç¤ºä¾ =====</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

    </span><span style="color: rgba(0, 0, 255, 1)">if</span> rank == <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">:
        data </span>= torch.tensor([<span style="color: rgba(128, 0, 128, 1)">1.0</span>, <span style="color: rgba(128, 0, 128, 1)">2.0</span>], device=f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">cuda:{rank}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">:
        data </span>= torch.tensor([<span style="color: rgba(128, 0, 128, 1)">3.0</span>, <span style="color: rgba(128, 0, 128, 1)">4.0</span>], device=f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">cuda:{rank}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

    print(f</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">[Rank {rank}] All-Reduce before: {data}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    dist.all_reduce(data, op</span>=<span style="color: rgba(0, 0, 0, 1)">dist.ReduceOp.SUM)
    print(f</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">[Rank {rank}] All-Reduce after:  {data}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

def test_all_gather(rank, world_size):
    </span><span style="color: rgba(128, 0, 0, 1)">"""
</span>    All-<span style="color: rgba(0, 0, 0, 1)">Gather å­å½æ°ï¼æ¶éææ GPU çæ°æ®å°æ¯ä¸ª GPU ä¸

    ä½¿ç¨åºæ¯ï¼
    </span>-<span style="color: rgba(0, 0, 0, 1)"> VocabParallelEmbedding çè¾åºæ¶é
    </span>-<span style="color: rgba(0, 0, 0, 1)"> ParallelLMHead ç logits æ¶é
    </span>-<span style="color: rgba(0, 0, 0, 1)"> éè¦æ¯ä¸ª GPU é½è·å¾ææ GPU çå®æ´æ°æ®
    </span><span style="color: rgba(128, 0, 0, 1)">"""
</span>    print(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">[Rank {rank}] ===== All-Gather ç¤ºä¾ =====</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

    # Rank </span><span style="color: rgba(128, 0, 128, 1)">0</span> äº§ç [<span style="color: rgba(128, 0, 128, 1)">10</span>, <span style="color: rgba(128, 0, 128, 1)">20</span>], Rank <span style="color: rgba(128, 0, 128, 1)">1</span> äº§ç [<span style="color: rgba(128, 0, 128, 1)">30</span>, <span style="color: rgba(128, 0, 128, 1)">40</span><span style="color: rgba(0, 0, 0, 1)">]
    local_data </span>=<span style="color: rgba(0, 0, 0, 1)"> torch.tensor(
        [</span><span style="color: rgba(128, 0, 128, 1)">10.0</span> + rank * <span style="color: rgba(128, 0, 128, 1)">20</span>, <span style="color: rgba(128, 0, 128, 1)">20.0</span> + rank * <span style="color: rgba(128, 0, 128, 1)">20</span>], device=f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">cuda:{rank}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
    )
    print(f</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">[Rank {rank}] All-Gather local data: {local_data}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

    gathered_list </span>= [torch.zeros_like(local_data) <span style="color: rgba(0, 0, 255, 1)">for</span> _ <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(world_size)]
    dist.all_gather(gathered_list, local_data)

    print(f</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">[Rank {rank}] All-Gather result: {gathered_list}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

    gathered_tensor </span>= torch.<span style="color: rgba(0, 0, 255, 1)">cat</span>(gathered_list, dim=<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">)
    print(f</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">[Rank {rank}] All-Gather concatenated: {gathered_tensor}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)

def tp_demo(rank, world_size):
    setup(rank, world_size)

    test_all_reduce(rank, world_size)
    </span><span style="color: rgba(0, 0, 255, 1)">time</span>.<span style="color: rgba(0, 0, 255, 1)">sleep</span>(<span style="color: rgba(128, 0, 128, 1)">5</span><span style="color: rgba(0, 0, 0, 1)">)
    test_all_gather(rank, world_size)

    cleanup()

def run_demo():
    world_size </span>= <span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">
    mp.spawn(tp_demo, args</span>=(world_size,), nprocs=world_size, <span style="color: rgba(0, 0, 255, 1)">join</span>=<span style="color: rgba(0, 0, 0, 1)">True)

</span><span style="color: rgba(0, 0, 255, 1)">if</span> __name__ == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">__main__</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> torch.cuda.device_count() &gt;= <span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">:
        run_demo()
    </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">:
        print(f</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">éè¦è³å° 2 å¼  GPU æ¥è¿è¡æ­¤ TP ç¤ºä¾</span><span style="color: rgba(128, 0, 0, 1)">"</span>)</pre>
</div>
<h1><span data-offset-key="6gvaf-0-0">10. å¶ä»</span></h1>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="mg9h-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="mg9h-0-0"><span data-offset-key="mg9h-0-0">æ¬æåºäº nano-vllm é¡¹ç®ï¼èç¦è®²è§£å¤§æ¨¡åæ¨çå éé¢åä¸­æåºç¡çè¥å¹²æ ¸å¿ææ¯ç¹ãéè¦è¯´æçæ¯ï¼å¤§æ¨¡åæ¨çå éçææ¯ä½ç³»ååä¸°å¯ï¼æ¬é¡¹ç®å¹¶æªè¦çå¨é¨åå®¹ï¼ä¾å¦ï¼è®¡ç®éä¿¡éå ï¼Overlapï¼ãå¤ token é¢æµï¼MTPï¼MultiâToken Predictionï¼ãå¤æµãå¤è¿ç¨æå¡ï¼MPSï¼Multi-Process Serviceï¼ãæ°æ®å¹¶è¡ï¼DPï¼ãæµæ°´çº¿å¹¶è¡ï¼PPï¼ãä¸ä¸æå¹¶è¡ï¼CPï¼ãä¸å®¶å¹¶è¡ï¼EPï¼ä»¥å PD åç¦»ç­è¿é¶ææ¯æ¹åï¼å¯ä½ä¸ºåç»­æ·±å¥å­¦ä¹ çæå±åå®¹ã</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="dq4gr-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="dq4gr-0-0"><span data-offset-key="dq4gr-0-0">&nbsp;</span></div>
</div>
<div class="Editable-unstyled" data-block="true" data-editor="2doff" data-offset-key="9n200-0-0">
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="9n200-0-0"><span data-offset-key="9n200-0-0">æ³¨1ï¼å¨æ¬æçæ»ç»è¿ç¨ä¸­ï¼é¤äºæ¥çæºä»£ç ï¼ä¹åå© deepwiki ä»¥åå¶ä» AI å·¥å·è¾å©ã&nbsp;<br><br></span></div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="9n200-0-0"><span data-offset-key="9n200-0-0">æ¬æ:&nbsp;<a href="https://www.cnblogs.com/cswuyg/p/19471225" target="_blank">https://www.cnblogs.com/cswuyg/p/19471225</a></span></div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="9n200-0-0"><span data-offset-key="9n200-0-0">ç¥ä¹:&nbsp;<a href="https://zhuanlan.zhihu.com/p/1989806890381746916" target="_blank" rel="noopener nofollow">https://zhuanlan.zhihu.com/p/1989806890381746916</a></span></div>
<div class="public-DraftStyleDefault-block public-DraftStyleDefault-ltr" data-offset-key="9n200-0-0"><span data-offset-key="9n200-0-0">å¬ä¼å·:&nbsp;<a href="https://mp.weixin.qq.com/s/6mAZ49iP1SCKt5ZdWf6ErQ" target="_blank" rel="noopener nofollow">https://mp.weixin.qq.com/s/6mAZ49iP1SCKt5ZdWf6ErQ</a></span></div>



</div>
</div>
<div class="clear"></div>

	<div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0.07847222222222222" data-date-updated="2026-01-12 14:31">2026-01-12 12:38</span>&nbsp;
<a href="https://www.cnblogs.com/cswuyg">-é¶å-</a>&nbsp;
éè¯»(<span id="post_view_count">94</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19471225);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19471225', targetLink: 'https://www.cnblogs.com/cswuyg/p/19471225', title: 'åºäº nano-vLLM å­¦ä¹ å¤§æ¨¡åæ¨çå³é®åè½' })">ä¸¾æ¥</a>
</div>
 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸å¨ç­ç¹åé¡¾ï¼1.5-1.11ï¼ ]]></title>
    <link>https://www.cnblogs.com/cmt/p/19469697</link>
    <guid>2dbc8c0d0e7a0f8c99ff013e22978be3</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/cmt/p/19469697" title="åå¸äº 2026-01-12 08:38">
    <span role="heading" aria-level="2">ä¸å¨ç­ç¹åé¡¾ï¼1.5-1.11ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>ç­ç¹éç¬ï¼</p>
<p> Â· <a href="https://www.cnblogs.com/knqiufan/archive/2026/01/07/19449849.html" target="_blank">Claude Code å®å¨æåï¼ä½¿ç¨æ¹å¼ãæå·§ä¸æä½³å®è·µ</a> (<a href="https://www.cnblogs.com/knqiufan/" target="_blank">knqiufan</a>) <br>
 Â· <a href="https://www.cnblogs.com/shanyou/archive/2026/01/05/19441004.html" target="_blank">ä» TIOBE 2025 å¹´åº¦è¯­è¨å° 2026 å¹´ C# æºè½ä½çæçå¨é¢å´èµ·</a>
(<a href="https://www.cnblogs.com/shanyou/" target="_blank">å¼ åå</a>)                    <br>
 Â· <a href="https://www.cnblogs.com/thisiswhy/archive/2026/01/08/19458678.html" target="_blank">å¯æï¼çå°ä¸ä¸ªå·è¡çç®æ³ã</a>
(<a href="https://www.cnblogs.com/thisiswhy/" target="_blank">whyææ¯</a>)                    <br>
 Â· <a href="https://www.cnblogs.com/xueweihan/archive/2026/01/06/19445015.html" target="_blank">å« AI åççé¢å¤ªä¸ï¼è£ä¸è¿ä¸ªå¼æºæä»¶ï¼ç§åèµæ·±è®¾è®¡å¸</a>
(<a href="https://www.cnblogs.com/xueweihan/" target="_blank">åå¾®å¯</a>)                    <br>
 Â· <a href="https://www.cnblogs.com/shanyou/archive/2026/01/07/19452660.html" target="_blank">XAML Studio å·²æ­£å¼å¼æº</a>
(<a href="https://www.cnblogs.com/shanyou/" target="_blank">å¼ åå</a>)                    <br>
 Â· <a href="https://www.cnblogs.com/yupi/archive/2026/01/09/19460549.html" target="_blank">å¹²æ Claude Codeï¼è¿ä¸ªå¼æº AI ç¼ç¨å·¥å·æç¯äºï¼</a>
(<a href="https://www.cnblogs.com/yupi/" target="_blank">ç¨åºåé±¼ç®</a>)                    <br>
 Â· <a href="https://www.cnblogs.com/jinjiangongzuoshi/archive/2026/01/05/19440715.html" target="_blank">æè¿å¾ç«ççClaude Skillså°åºæ¯ä¸ªå¥ï¼è§£å³ä»ä¹é®é¢ï¼æä¹ç¨ï¼</a>
(<a href="https://www.cnblogs.com/jinjiangongzuoshi/" target="_blank">çå¸</a>)                    <br>
 Â· <a href="https://www.cnblogs.com/kklldog/archive/2026/01/07/19449864.html" target="_blank">ä¸ºä»ä¹è¯´ IO æä½å¼æ­¥æææä¹</a>
(<a href="https://www.cnblogs.com/kklldog/" target="_blank">Agile.Zhou</a>)                    <br>
 Â· <a href="https://www.cnblogs.com/12lisu/archive/2026/01/08/19456855.html" target="_blank">å¼ºçæ¨è | é¿éå¼æºçè¿10ä¸ªç¥çº§é¡¹ç®</a>
(<a href="https://www.cnblogs.com/12lisu/" target="_blank">èä¸è¯´ææ¯</a>)                    <br>
 Â· <a href="https://www.cnblogs.com/12lisu/archive/2026/01/06/19447172.html" target="_blank">ç¨éªè±ç®æ³å°±ä¸ä¼äº§çéå¤çID?</a>
(<a href="https://www.cnblogs.com/12lisu/" target="_blank">èä¸è¯´ææ¯</a>)                    <br>
 Â· <a href="https://www.cnblogs.com/ymtianyu/archive/2026/01/05/19442584.html" target="_blank">ä»å®è£å°ä¸çº¿ï¼ä¸ä»½ Nginx å®ææåï¼è®©ä½ ç Web åºç¨ç¨³å»ºå®å¨</a>
(<a href="https://www.cnblogs.com/ymtianyu/" target="_blank">ä¸åç¨åºåªå</a>)                    <br>
 Â· <a href="https://www.cnblogs.com/tianqing/archive/2026/01/05/19439916.html" target="_blank">.NET 10 New feature æ°å¢åè½ä»ç»-WebSocketåè½å¢å¼º</a>
(<a href="https://www.cnblogs.com/tianqing/" target="_blank">Eric zhou</a>)                    <br>
            </p>
<p>ç­ç¹æ°é»ï¼</p>
<p>
 Â· <a href="https://news.cnblogs.com/n/812350/" target="_blank">Stack Overflow å½»åºåäºï¼æ¯18å¹´åä¸çº¿é¦æé®é¢æ°éè¿å°</a><br>
 Â· <a href="https://news.cnblogs.com/n/812432/" target="_blank">ç»äºæå®é¤äºï¼ç¼ºå°å®ä½æé®çè½¦å°±æ¯æ´å±é©</a><br>
 Â· <a href="https://news.cnblogs.com/n/812455/" target="_blank">âææäººè¯·æ³¨æç¨èå«çâï¼æå·¥äººæåºè¯¥ææç6ä»¶äº</a><br>
 Â· <a href="https://news.cnblogs.com/n/812551/" target="_blank">æ¯«æ å¾åï¼DeepSeek R1çæ´86é¡µè®ºæï¼è¿ææ¯çæ­£çOpen</a><br>
 Â· <a href="https://news.cnblogs.com/n/812321/" target="_blank">Rediså®£å¸é­æºåï¼ä¸­å½ææ¯äººçâä¸æ¸¸æ¶å»â</a><br>
 Â· <a href="https://news.cnblogs.com/n/812667/" target="_blank">Stack Overflowå·²æ­»ï¼CEOå¸¦éçèµ1.15äº¿åï¼6ä¸ªæåå°åæ</a><br>
 Â· <a href="https://news.cnblogs.com/n/812425/" target="_blank">8å¤©æ´æ¶¨400ä¸ç²ä¸åå¡æ¿ï¼èç¥æ¯ä¿è´¨ææç­çç½çº¢åï¼</a><br>
 Â· <a href="https://news.cnblogs.com/n/812328/" target="_blank">2025ï¼è¿äºäºèç½å·¨å¤´èµ¢éº»äº</a><br>
 Â· <a href="https://news.cnblogs.com/n/812333/" target="_blank">Claude CodeãCursor é½è¿æ¶äºï¼ï¼ç¡è°·é¡¶æµå¤§çç¸åºæ´è®ºï¼AI ç¼ç¨è¦ç»æ»¡ 2000 å°æ¶æç®âä¼ç¨âï¼ä¸å¹´ä¸ç¨ä¸ççº§å¤§ç¥ä¹ä¼æ²¦ä¸ºå®ä¹ çæ°´å¹³</a><br>
 Â· <a href="https://news.cnblogs.com/n/812428/" target="_blank">ä¸­äº§ãèªå¾ä¸ä»¶å¥ãï¼å®ç¬¬ä¸ä¸ªå¡æ¿ï¼</a><br>
 Â· <a href="https://news.cnblogs.com/n/812541/" target="_blank">é©¬æ¯åææ°æ­å®¢é¿å¹ï¼ä¸­å½å¬æäºæçè¯ï¼2026å¹´å°å¨ç®åä¸ç¢¾åä¸ç</a><br>
 Â· <a href="https://news.cnblogs.com/n/812677/" target="_blank">å ä¸ºAIç¼ç¨ï¼Tailwind CSSå·®ç¹æ­»äº</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-12 08:38">2026-01-12 08:38</span>&nbsp;
<a href="https://www.cnblogs.com/cmt">åå®¢å­å¢é</a>&nbsp;
éè¯»(<span id="post_view_count">394</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19469697);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19469697', targetLink: 'https://www.cnblogs.com/cmt/p/19469697', title: 'ä¸å¨ç­ç¹åé¡¾ï¼1.5-1.11ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸å­é¿æè®²è§£ï¼å¢éè½å° AI è¾å©ç¼ç¨å AI Specs å®æ ]]></title>
    <link>https://www.cnblogs.com/whuanle/p/19469026</link>
    <guid>b2beb3563fc0d2a462c23736619c4d1c</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/whuanle/p/19469026" title="åå¸äº 2026-01-12 08:34">
    <span role="heading" aria-level="2">ä¸å­é¿æè®²è§£ï¼å¢éè½å° AI è¾å©ç¼ç¨å AI Specs å®æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        å»ºè®¾ä½¿ç¨ AI è¾å©ç¼ç¨çå¢éï¼ä½¿ç¨ AI Specs è§èåå¢éåä½æµç¨åç¼ç è§èï¼è®© AI è½å°ãå®ç°ä¸å¡ä»·å¼ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="ai-ç¼ç¨å¢éåä½">AI ç¼ç¨å¢éåä½</h2>
<h3 id="åå²èæ¯">åå²èæ¯</h3>
<p>AI åå±çéåº¦å®å¨å¤ªå¿«äºï¼å¨ GPT-3 æ¨ªç©ºåºä¸çé¶æ®µï¼é£ä¸ªæ¶ååªè½ä½¿ç¨å¯¹è¯æ¡ä¸é®ä¸ç­ï¼å°ç°å¨åç§ RAGãAI WorkflowãAI Agent ç­åç±»ææ¯ï¼ä½¿å¾ AI å¯ä»¥åæ´å¤çäºæï¼å®ç°æ´å å¼ºå¤§çåè½ãå¨ cursorãtrae ç­ AI IDE åºç°åï¼å¾å¤äººä¾¿å½»åºè¿·ä¸äºè¿é¡¹è¶³ä»¥é¢ è¦ä¼ ç»å·¥ä½æ¨¡å¼çææ¯ï¼å°¤å¶å¨ç¼ç¨é¢åï¼è¿åºåé©çæµªæ½®æ¥å¾å°¤ä¸ºè¿ç ââ æåï¼å½æä»¬é¢å¯¹å¤æçä¸å¡åè½ãæ¦æ¶©çè¯­æ³å®ç°ææ¯éççæ¡æ¶è°ç¨æ¶ï¼æ éåèè´¹å¤§éæ¶é´ç¿»éææ¡£ãè°è¯ä»£ç ï¼åªééè¿èªç¶è¯­è¨å AI æè¿°éæ±ï¼å°±è½åå©å®çé®ç­å¼åå¤è·åå¯ç¨çä»£ç çæ®µï¼è¿ä¸ä»å¤§å¤§éä½äºç¼ç¨çé¨æ§ï¼æ´è®©å¼åèä»éå¤çåºç¡ç¼ç å·¥ä½ä¸­å¾å°äºåæ­¥è§£æ¾ï¼ä¹ä¸ºåç»­å¯¹è¯å¼ä»£ç çæãVibe Code ä¹è³ Spec Code ç­æ´åè¿çç¼ç¨èå¼ï¼åä¸äºåæ»¡æ éå¯è½çç§å­ã</p>
<br>
<p>ç®åï¼ä¸»æµç AI è¾å©ç¼ç¨ä¸»è¦æ¯ AI Agentï¼å¨ AI IDE ä¸­è¾å¥è¦åçåè½ï¼AI ä¼èªå¨è¯»åé¡¹ç®æä»¶ï¼ç»è¿æèåç¼åå¯¹åºçä»£ç ï¼å¹¶ä¸ä¼èªå¨ä¿®æ­£ä»£ç éè¯¯ï¼ç¡®ä¿ä»£ç å¯ä»¥ç¼è¯éè¿ãè¿ä¾¿æ¯å¤§è¯­è¨æ¨¡åå¬ççå¯¹è¯å¼ AI ä»£ç çæï¼å¼å¯äºèªç¶è¯­è¨äº¤äºçæä»£ç çæ¶ä»£ï¼å¼åèéè¿å¤è½®å¯¹è¯è®© AI äº§åºä»£ç çæ®µå¹¶æå¨æ´åï¼AI ä»ä½ä¸ºè¾å©å·¥å·ï¼éåæ¼è¿ç Vibe Codeï¼æ°å´ç¼ç¨ï¼èå¼ï¼è®©å¼åèåªéæè¿°é«é¶æå¾å³å¯é©±å¨ AI å®æå¨éä»£ç çç¼åä¸è¿­ä»£ï¼äººç±»è§è²ä»ç¼ç èè½¬åéæ±å¼å¯¼èä¸æµè¯èï¼èç¦å¿«éååä¸åæéªè¯ã</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce1adf62.png" alt="image-20260109185650106" loading="lazy"></p>
<br>
<p>ä½æ¯ï¼AI Agent æ¨¡å¼ä¸ç AI è¾å©ç¼ç¨ï¼ä¹å­å¨ä¸äºå¸¸è§çé®é¢ï¼æä»¥å¨ IT åæµè¡çè¿å¾ï¼</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce1d759f." alt="896b42e496e1d780c1b2ba5685065dc5" loading="lazy"></p>
<blockquote>
<p>æè°¢ç­å¿ç½åãè¿ªè¿¦ãæä¾çå¾çã</p>
</blockquote>
<br>
<p>è½ç¶ä¸å¾ææç¬æåï¼è¿éæä»¬å°é®é¢åä¸ºå¤§è¯­è¨æ¨¡åå AI IDE ä¸¤é¨åï¼ä¸é¢ä»ç»å¸¸è§ç AI è¾å©ç¼ç¨é®é¢ã</p>
<p>å¤§è¯­è¨æ¨¡åï¼</p>
<ul>
<li><strong>ç®æ æ¼ç§»</strong>ï¼å¨å¤æ­¥éª¤ãé¿æµç¨çç¼ç¨ä»»å¡ä¸­ï¼å¦å¤æåè½å¼åãé¡¹ç®éæï¼ï¼AI æ§è¡å°ä¸­åé¶æ®µæåç¦»åå§ç®æ ï¼ä¾å¦åæ¬éæ±æ¯ä¼åæ°æ®åºæ¥è¯¢æ§è½ï¼åç»­å´æ ç«¯éå UI ç»ä»¶ï¼æ¬è´¨æ¯ç¼ºä¹ææçç®æ éå®æºå¶ã</li>
<li><strong>éå¤ç¯é</strong>ï¼å¯¹å·²åºç°è¿çéè¯¯ç¼ºä¹é¿æè®°å¿ï¼ç¸åé®é¢ä¼åå¤åºç°ï¼å¦æªæ­£ç¡®å¤çå¼æ­¥å½æ°ç <code>await</code> å³é®å­ãæä»¶è·¯å¾å¼ç¨éè¯¯ï¼ï¼æ æ³èªå¨æ²æ·åå²è§£å³æ¹æ¡ã</li>
<li><strong>ä¸ä¸æçç¸</strong>ï¼ä¸ºè®© AI ææ¡å®æ´é¡¹ç®ä¿¡æ¯ï¼éå°å¤§éä»£ç ãéæ±ææ¡£ãåå²å¯¹è¯å¡è¿ä¸ä¸æçªå£ï¼å¯¼è´æ¨¡åå¤çæçä¸éãååºå»¶è¿ï¼ä¸æå¿½ç¥å³é®ä¿¡æ¯ã</li>
<li><strong>è¿åº¦ä¸¢å¤±</strong>ï¼ä¾èµå¯¹è¯çªå£å­å¨ä»»å¡ç¶æï¼ä¸æ¦å¯¹è¯éç½®ãå·æ°æä¸­æ­ï¼ä¹åçå¼åè¿åº¦ãä¸­é´å³ç­ãå·²ç§¯ç´¯çé¡¹ç®è®¤ç¥ä¼å¨é¨æ¶å¤±ï¼æ æ³æ ç¼ç»­å·¥ã</li>
<li><strong>å¹»è§çæ</strong>ï¼å¨ç¼ºä¹æç¡®åèä¾æ®æ¶ï¼å¯è½ç¼é ä¸å­å¨ç API æ¹æ³ãè¯­æ³è§åæé¡¹ç®éç½®ï¼çæçä¼¼åçä½å®éæ æ³è¿è¡çä»£ç ï¼å¢å è°è¯ææ¬ã</li>
</ul>
<p><br>AI IDEï¼</p>
<ul>
<li><strong>ä¸ä¸æç®¡çè½åä¸è¶³</strong>ï¼å¤æ° AI IDE æªå»ºç«ç¬ç«çå¤é¨è®°å¿æºå¶ï¼ä»ä¾èµæ¨¡åèªå¸¦çä¸ä¸æçªå£ï¼æ æ³é«æå³èé¡¹ç®æä»¶ãåå²æä½è®°å½ï¼é¾ä»¥æ¯æå¤æä»»å¡çè¿è´¯å¼åã</li>
<li><strong>ä»»å¡è¿½è¸ªä¸å¯è§åç¼ºå¤±</strong>ï¼ç¼ºä¹å¯¹ç¼ç¨ä»»å¡çç»æåæè§£ä¸è¿åº¦å¯è§ååè½ï¼æ æ³å <code>task_plan.md</code> é£æ ·æ¸æ°åç°é¶æ®µååãå®æç¶æãå³ç­ä¾æ®ï¼å¼åèé¾ä»¥ææ§ AI çå·¥ä½è½¨è¿¹ã</li>
<li><strong>éè¯¯è®°å½ä¸å¤ç¨èå¼±</strong>ï¼æªéæéè¯¯è¿½è¸ªä½ç³»ï¼AI éå°çæ¥éãä¿®å¤æ¹æ¡æ æ³èªå¨å½æ¡£ï¼æ¢ä¸ä¾¿äºå¼åèåæº¯é®é¢æ ¹æºï¼ä¹æ æ³è®© AI åç»­å¿«éå¤ç¨å·²éªè¯çè§£å³æ¹æ¡ã</li>
<li><strong>æä»¶ååä¸æä¹åä¸è¶³</strong>ï¼å¯¹ AI çæçä¸­é´äº§ç©ï¼å¦è°ç ç¬è®°ãææ¯éåææ¡£ï¼ç¼ºä¹ç»ä¸çå­å¨ä¸ç®¡çæºå¶ï¼æä»¶åæ£ä¸æä¸¢å¤±ï¼æ æ³å½¢æå¯è¿½æº¯ãå¯å¤ç¨çé¡¹ç®ç¥è¯åºã</li>
<li><strong>äººæºåä½è¡æ¥ä¸ç</strong>ï¼å¼åèé¾ä»¥ç´æ¥å¹²é¢ AI çä»»å¡æ§è¡æµç¨ï¼ä¾å¦æ æ³éè¿ç¼è¾ç»æåè®¡åæä»¶è°æ´å¼åæ¹åï¼ä¹ç¼ºä¹ä¾¿æ·çæ¹å¼å®¡æ¥ AI çå³ç­é»è¾ï¼å¯¼è´äººæºååæçä½ä¸ã</li>
<li><strong>æ§è½ä¸ææ¬å¤±è¡¡</strong>ï¼å¤çå¤§è§æ¨¡é¡¹ç®æ¶ï¼é¢ç¹å è½½å¨éä¸ä¸æä¼å¯¼è´ IDE è¿è¡å¡é¡¿ï¼ä¸éå¤å¤çç¸åéæåå®¹ï¼å¦é¡¹ç®æ¡æ¶å®ä¹ãå·¥å·éç½®ï¼ä¼å¢å  Token æ¶èï¼æåä½¿ç¨ææ¬ã</li>
</ul>
<br>
<p>æä»¥ï¼å¨ç®åçææ¯å±éä¸ï¼è¦ç© AI ç¼ç¨ï¼å¶å®è¿ä¸è½ä¸ºææ¬²ä¸ºï¼åæ¶ä½¿ç¨ AI ç¼ç¨æ¶ä¹ä¼ç¢°å°å¾å¤é»ç¢é®é¢ï¼éä½äºç¼ç¨çä½éªåé¡¹ç®ä»£ç è´¨éã</p>
<h3 id="ai-ç¼ç¨ä¸çå¢éåä½çç¹ä¸æ ¸å¿è¯æ±">AI ç¼ç¨ä¸çå¢éåä½çç¹ä¸æ ¸å¿è¯æ±</h3>
<p>åé¢ä»ç»äº AI ç¼ç¨æ¬èº«å®¹æåºç°çé®é¢åææ¯å±éï¼åå°ä»¥å¢éä¸ºåä½è¿è¡ AI ç¼ç¨åä½æ¶ï¼å½å¢éç¼ºä¹æ åååä½æºå¶æ¶ï¼AI ç¼ç¨æé·å¥ âååµä½æâ çå°å¢ï¼ä¼åºç°æ´å å¤çå¤´ç¼çé®é¢ã</p>
<p>å ä¸ºç¬èå¨å¬å¸å¸¦ä¸ä¸ªé¡¹ç®ç»ï¼å·²ç»æå¾å¤æåä½¿ç¨ AI åä»£ç ï¼å¨ç»è¿ä¸æ®µæ¶é´çè§å¯åæèåï¼åç°äºä¸äºé®é¢ï¼æä»¥ææ³å°åè¿ç¯æç« çï¼ç¸ä¿¡è¿äºé®é¢å¨å¤§å®¶çå¬å¸éé¢ä¹ä¼å­å¨ã</p>
<br>
<p><strong>ä»£ç ç¢çå</strong></p>
<blockquote>
<p>å¾å¤åäºåç°ç¨ AI åä»£ç ï¼å¯ä»¥æ©ç¹ä¸ç­ï¼äºæ¯å¤§å®¶é½ç¨ AI åä»£ç ï¼ä½ åä½ çæåæçï¼å¯¼è´æååèªä½¿ç¨ AI çæä»£ç ï¼é£æ ¼ãé»è¾å·®å¼æ¾èï¼æ¨¡åè¡æ¥å°é¾ï¼åæç»´æ¤ææ¬æ¿å¢ãåæ­£åäºç¨ AI åçä»£ç ï¼ææ¯åæ ¹ä¸æ³ç»´æ¤ã</p>
</blockquote>
<br>
<p><strong>è§èå¤±æ§</strong></p>
<blockquote>
<p>å¤§å®¶åºè¯¥é½ææåï¼å¨ä¸åæç¤ºè¯ãç¼åä¸ååè½æ¶ï¼AI ç¼åçä»£ç é£æ ¼åå¼ï¼æ²¡æç»ä¸çè§èåé£æ ¼ï¼AI çæä»£ç å¯è½åç¦»å¢éä»£ç è§èãå®å¨æ åï¼åä¸è´¨ééæ£ã</p>
</blockquote>
<br>
<p><strong>ç¥è¯å­¤å²</strong></p>
<blockquote>
<p>ä¸ªäººä½¿ç¨ AI ç§¯ç´¯çç»éªæ æ³å±äº«ï¼å¢éæ´ä½æçé¾ä»¥æåãä½ ç¨ cursorï¼æç¨ kiroï¼åååçä»£ç ï¼æ²¡æ³ä¸ºå¢éæ²æ·ç¥è¯ç»éªï¼æç¤ºè¯ãåè½åå²è®°å½ãèæ¯ä¸ä¸æç­å®å¨æ²¡æ³å¨å¢éåå±äº«ï¼æ¯ä¸ªäººé½å¾å¨æ¬å°ä½¿ç¨ AI éè¯»ä»£ç çæä¸ä¸æè®°å¿ã</p>
</blockquote>
<br>
<p><strong>åä½ä½æ</strong></p>
<blockquote>
<p>AI åçä»£ç å®éä¸ä¼åºç°ä¸ä¸ªç®åçåè½åä¸å ä»£ç çæåµï¼ä¹æå¯è½ A åäºå A åè½æ¶çæäº Cï¼B åäºå B åè½æ¶åçæäºä¸ä¸ªç±»ä¼¼ç Cï¼é¡¹ç®åç§ä»£ç éç»¼å¤æãå¯¼è´é¾ä»¥ç»ä¸ä»»å¡åéãè¿è¡ä»£ç è¯å®¡æµç¨ï¼å¯¼è´ä¿¡æ¯ä¼ éæ»åï¼å²çªé¢åã</p>
</blockquote>
<br>
<p>é¤äºä»¥ä¸é®é¢å¨å¢éç¼ç¨ä¸­éè¦è§£å³ï¼å¾å¤å¬å¸é½æä»£ç è´¨éè§èè¦æ±ãå®å¨è¦æ±ãååæµè¯è¦ççè¦æ±ï¼æä»¥åºäºè¿äºé®é¢åå¸¸è§å¬å¸ç¼ç¨è¦æ±ï¼ç¬èè®¤ä¸ºå¢é AI ç¼ç¨çæ ¸å¿è¯æ±åºèç¦ï¼</p>
<ul>
<li>ç»´æä¸è´ä»£ç è´¨é</li>
<li>é²æ­¢å®å¨æ¼æ´</li>
<li>åå°éå¤å·¥ä½é</li>
<li>æ åååä½æµç¨</li>
<li>å å¿«å¼åå¨æ</li>
<li>å®ç°ä» âå¿«éååâ å° âå·¥ç¨åè½å°â çè·¨è¶ã</li>
</ul>
<br>
<p>å¾å¤é¢å¯¼å¯¹ AI ç¼ç¨çæ³æ³å¾é¾è¯ï¼è§å¾å¯ä»¥ âéæ¬å¢æâ ï¼ä¸ä¸ªé¡¹ç®å¹³æ¶éè¦ä¸ä¸ªæåå®ï¼ç¨ AI ä¸å¤©å°±è¡ï¼ä»£ç è¿è½åå¾æ¯å¼åè¿å¥½ï¼è¿æ ·å¯ä»¥å¼é¤å¾å¤å¼åäººåï¼æä»¥å·å¬å¤§å®¶å¨å¬å¸ä½¿ç¨ AI ç¼ç¨ã</p>
<blockquote>
<p>åé¢ä¼æå° AI è¾å©ç¼ç¨å¤§çº¦å¯ä»¥æé«å¤å°éåº¦ï¼ä½ä¸å¯è½æ¯ä¸å¤©åå®ä¸ä¸ªæçä»£ç ã</p>
</blockquote>
<p><br>èå®éä¸ï¼é¤éåå å¼ç²çï¼äº§ååå¾æä¹æ ·åå³äº AI æä¹åï¼åæéåº¦ç¡®å®å¾å¿«ãä½æ¯å°äºä¸­åæï¼AI åçä»£ç é¾ä»¥ç»´æ¤ï¼åèä¼å ä¸ºè¦ AI åä»£ç ï¼è±è´¹å¤§éæ¶é´ç¼åæç¤ºè¯ï¼ä¸ºäºå®ç°ä¸ä¸ªå°éæ±ï¼å¯è½è¦è· AI ä¸ç´å¯¹éªï¼æç»é·å¥æ··ä¹±ã</p>
<p>å¶å®ï¼æ­£å¦ç¬èåé¢æè¯´çï¼å¤§è¯­è¨æ¨¡åå AI IDE å¨ç®åæä¸äºææ¯å±éï¼èä¸å¨å¢éä½¿ç¨ AI ç¼ç¨æ¶ä¼å¸¦æ¥å¾å¤åä½é®é¢ï¼å¦ææ²¡æåºå¯¹è¿äºé®é¢çè§£å³æ¹æ³ï¼é£ä¹ä½¿ç¨ AI ç¼åçä»£ç æç»å¯è½æ¯ä¸çæ··ä¹±ï¼èä¸çæä»£ç äººç±»å¯è½æ æ³éè¯»ï¼é¬¼æç¥é AI åçæ¯å¥ã</p>
<p>å¬å¸è½å° AI ç¼ç¨ï¼ç¡®å®å¯ä»¥æé«å¼åéåº¦ï¼ç¼©ç­å¼åå¨æï¼ä½æ¯ä¸åºè¯¥èè°¬å°è®¤ä¸º âä¸ä¸ªæå·¥ä½éä½¿ç¨ AI ä¸å¤©å°±è¡â ãç¬èè®¤ä¸ºï¼é¤äºæéï¼åºå½æ´å¤èç¦å®ç°åé¢æå°ç AI ç¼ç¨çæ ¸å¿è¯æ±ã</p>
<br>
<p>å¾å¤å¬å¸å¤©å¤©é¼å¹ååæµè¯ãä»£ç è§èãé«æ§è½é«è´¨éä»£ç ï¼ç»å¼åæå®ååæµè¯è¦ççåä»£ç å®¡æ¥ç­ææ ï¼åå¤æè¾å¼åäººåï¼ä½æ¯å¬å¸å­å¨åç§åæ ·çå¼åç®¡çåææ¯é®é¢ï¼ç²ç®å®å¶é«è¦æ±çå¼åææ ï¼å®å¨è§£å³ä¸äºå½åçé®é¢ï¼åä¼ä½¿å¾å¼åèº«å¿ç²å¦ã</p>
<p>ç¬èä¹æä»¥è¦è¯´è¿äºï¼æ¯å ä¸ºä»£ç å®¡æ¥ãä»£ç è§èãååæµè¯ç­ï¼åèµ·æ¥æ²¡æé£ä¹ç®åï¼æå¤å°å¬å¸æè¾è¿äºï¼åè½æç»çæ­£åå°ï¼</p>
<blockquote>
<p>è½ä¸è½åå¥½è¿äºï¼å¶å®è·å¬å¸åºå æå³ç³»ï¼è·è½å°é¾åº¦ä¹æå³ç³»ã</p>
</blockquote>
<p><br>å¶å®ï¼åªæè¶³å¤ç®åï¼è§èæè½çæ­£è½å°ã</p>
<p>æä»¥ï¼ç¬èä¸ç´å¨æèï¼å¦ä½è§£å³ AI ç¼ç¨ä¸çå¢éåä½çç¹ä¸æ»¡è¶³æ ¸å¿è¯æ±ï¼å¹¶ä¸çæ­£è½å°ååæµè¯ãä»£ç å®¡æ¥ç­ææ¯è¦æ±ã</p>
<p>è¿å°±æ¯æ¬æçéç¹ï¼AI Specï¼å°åºè¦æä¹åï¼æ¥ä¸æ¥æ¬æå°ä»¥æ¶æå¸çè§åº¦ï¼å»æèï¼å»ç ç©¶ï¼æä»¬æ¯æ¶æå¸ï¼é£ä¹åºè¯¥æä¹æ AI ç¼ç¨è½å°å°å¢éåä½ä¸­ã</p>
<h2 id="è§èå¼åspec-development">è§èå¼å(Spec development)</h2>
<p>åé¢æå°ï¼AI è¾å©ç¼ç¨éæ¸æä¸ºä¸»æµï¼å¤§é¨åå¼åäººåå·²ç»å¨æ¥å¸¸å·¥ä½ä¸­ä½¿ç¨ AI ç¼åä»£ç ï¼ä½æ¯ä¹ä¼å¼å¥å¾å¤é®é¢ï¼å¯¼è´çæå¾å¤ä¸å¯é¢æµçãè´¨éåå·®ä¸é½çä»£ç ãé£ä¹ä¸ºäºè§£å³è¿äºé®é¢ï¼åºç°äº SDD(Spec-Driven Development) è¿ç§æ¦å¿µï¼å¼ºè°å¨ä½¿ç¨ AI ç¼åä»£ç ä¹åï¼åæ Specificationï¼ä»¥ä¾¿çº¦æ AI çæé«è´¨éçãç¬¦åä¸å¡éæ±åææ¯è¦æ±çä»£ç ã</p>
<p>ç®åç¤¾åºä¸­ä¸»è¦å­å¨ä¸ç±» SDD å·¥å·ï¼OpenSpecãKiroãSpec-Kitã</p>
<p><br>ä¸ºäºå®ç° Spec developmentï¼éæ© SDD å·¥å·æ¶ï¼éè¦èèï¼</p>
<ul>
<li>
<p><strong>å·¥å·ä¸æµç¨éé</strong>ï¼éæ© Kiro è¿ç±»æ¯æè§èå®å¶ãå¤åºæ¯åä½ç AI å·¥å·ï¼é¿åå·¥å·åè½ä¸å¢éæµç¨è±èï¼</p>
</li>
<li>
<p><strong>éè§è§èè½å°</strong>ï¼å°å¢éè§åè½¬åä¸ºå¯æ§è¡çé©å­ãSpec æ¨¡æ¿ï¼åå© AI å¼ºå¶è½å°ï¼èéä»åçå¨ææ¡£å±é¢ï¼</p>
</li>
<li>
<p><strong>æå»ºåä½æå</strong>ï¼é¼å±æåä¸»å¨å±äº« AI ä½¿ç¨ç»éªãåä¸æµç¨ä¼åï¼é¿å âååµä½æâ æç»´ï¼</p>
</li>
<li>
<p><strong>å¹³è¡¡èªå¨åä¸äººå·¥</strong>ï¼AI è´è´£æ ååãéå¤æ§å·¥ä½ï¼å¦æµè¯ãè§èæ£æ¥ï¼ï¼äººç±»èç¦æ ¸å¿æ¶æä¸åæå³ç­ï¼å®ç°äººæºååå¢æã</p>
</li>
</ul>
<br>
<p>å¨æ¬æï¼ç¬èè¦è®²è§£çæ¯ Kiro è½å°çåå®¹ã</p>
<p><br>å¨æç´¢èµæçè¿ç¨ä¸­ï¼ç¬èåç°å ç¯åå¾ä¸éçæç« ï¼è¿éä¾è¯»èåèï¼æ¬æå°±ä¸åç¬è®²è§£è¿äº SDD å·¥å·äºã</p>
<blockquote>
<p>AI è§èé©±å¨å¼åâä¸åå®¢âæ·±åº¦å¯¹æ¯ï¼Spec-KitãKiro ä¸ OpenSpec å®ææå - ææ¯æ ï¼</p>
<p><a href="https://jishuzhan.net/article/1988226029513670657" target="_blank" rel="noopener nofollow">https://jishuzhan.net/article/1988226029513670657</a></p>
<p>Transforming Dev Practices with Kiroâs Spec-Driven Tools | AI Native Dev</p>
<p><a href="https://ainativedev.io/transforming-dev-practices-with-kiros-spec-driven-tools" target="_blank" rel="noopener nofollow">https://ainativedev.io/transforming-dev-practices-with-kiros-spec-driven-tools</a></p>
</blockquote>
<br>
<p>è¿éç®åä»ç»ä¸ä¸ Kiroã</p>
<p>Kiro æ¯äºé©¬éäºç§ææ¨åºç AI IDEï¼ä»¥ âè§èé©±å¨å¼åâ ä¸ºæ ¸å¿ï¼å®ç¾ééå¢éåä½éæ±ã</p>
<blockquote>
<p>å¯¹å½åç¨æ·åå¥½ï¼æ éç¹æ®ç½ç»éç½®ã</p>
</blockquote>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce20c847.png" alt="img" loading="lazy"></p>
<h3 id="å¢éå¯¹é½ai-ç¼ç¨æ ¸å¿æ¦å¿µè§£æ">å¢éå¯¹é½ï¼AI ç¼ç¨æ ¸å¿æ¦å¿µè§£æ</h3>
<p>å¨æ·±å¥å¢éåä½å®è·µåï¼éåæç¡®æ¯æ AI ç¼ç¨çå³é®ææ¯æ¦å¿µï¼æ è®ºæ¯äº§åè¿æ¯æµè¯ï¼ä¹å¿é¡»äºè§£ LLMãMCPãAgent ç­æ¦å¿µï¼éè¦å¢éå¯¹ä¸äºç¥è¯é½è¿å³ï¼ç¡®ä¿æ´ä¸ªå¢éäº¤æµåä½ä¸å­å¨ç¥è¯éç¢ã</p>
<blockquote>
<p>è¿äºæ¦å¿µçç¥è¯ï¼ç¬èå°±ä¸èµè¿°äºã</p>
</blockquote>
<br>
<p>ä¸»æµå¤§è¯­è¨æ¨¡åç¨äºç¼ç¨çè¯åï¼ä½ä¸ºæ¶æå¸éè¦æ¸æ°äºè§£ä¸åæ¨¡åçç¹é¿åä¼ç¼ºç¹ï¼å¨ç¼ç¨é¢ååªä¸ªæ¨¡åæä¼ç§æéåç¨äºç¼ç¨ã</p>
<blockquote>
<p>ç¬èåç°å ä¸ªç½ç«å¾ä¸éï¼æåç±»æ¨¡åçä»ç»åè¯åï¼å°åï¼</p>
<p><a href="https://apxml.com/zh/leaderboards/coding-llms" target="_blank" rel="noopener nofollow">Best LLMs for Coding | LLM Leaderboards</a></p>
<p><a href="https://llm-stats.com/" target="_blank" rel="noopener nofollow">https://llm-stats.com/</a></p>
<p><a href="https://www.aibase.com/zh" target="_blank" rel="noopener nofollow">https://www.aibase.com/zh</a></p>
</blockquote>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce239a78.png" alt="image-20260109204244573" loading="lazy"></p>
<br>
<p>ä¸»æµä¼ä¸ä½¿ç¨ AI è¾å©ç¼ç¨æåçæçã</p>
<p>è¦æ¯é¢å¯¼è§å¾ä½ ä¸ä¸ªæåçä»£ç ä¸å¦ AI ä¸å¤©åçï¼é£å°±å°´å°¬äºãä½ä¸ºææ¯äººåï¼å¿é¡»åçè¯ä¼°ä½¿ç¨ AI ç¼ç¨åï¼æ´ä¸ªå¢éå°åºæåäºå¤å°æçï¼ç¼ç éåº¦æé«äºå¤å°ã</p>
<p>æ¯å¦ï¼æ ¹æ®è¿ç¯ç ç©¶æ¥åï¼å®æä»»å¡çç¼ç éåº¦å¤§æ¦æåäº <code>21%</code>ï¼æ¥åå°å <a href="https://metr.org/blog/2025-07-10-early-2025-ai-experienced-os-dev-study/" target="_blank" rel="noopener nofollow">https://metr.org/blog/2025-07-10-early-2025-ai-experienced-os-dev-study/</a></p>
<p>èæ ¹æ®è±åèç½æç´¢æ»ç»çåå®¹æ¥çï¼æåçå¼åéåº¦å¹¶æ²¡æé£ä¹å¤¸å¼ ã</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce35ec28.png" alt="image-20260109205849267" loading="lazy"></p>
<br>
<p>æ»èè¨ä¹ï¼æé  AI è¾å©ç¼ç¨å¢éï¼è¦æ±å¢éäººåå¯¹ AI æè¶³å¤çè®¤è¯ï¼äºè§£åºç¡ç¥è¯ï¼å¹¶ä¸äºåå¨ AI ç¼ç¨ä¸çè®¤ç¥ä¸è´ï¼å¦åå¯è½ä¼é¹åºåç§ç¬è¯ï¼è¢«äººå¼ä¸ºç¬è°ã<strong>ç¥è¯åè®¤ç¥é½å¾éè¦</strong>ï¼å¦åå¢éååéæ£æ¶ã</p>
<h3 id="é¡¹ç®æ¨¡æ¿">é¡¹ç®æ¨¡æ¿</h3>
<p>ä¸ºä»ä¹è¦ä½¿ç¨å¼åæ¡æ¶ï¼è¿ä¸ªäºæä¸ç¨å¤è¯´ï¼C# å¼ååºè¯¥ç¥é ABP æ¡æ¶ï¼Go å¼ååºè¯¥ç¥é ginãbeegoï¼ä½¿ç¨æ¡æ¶åå¤§å¤§ç®åäºå¼åè´æãå¨ä½¿ç¨å¼åæ¡æ¶çæåµä¸ï¼å¶å®å¢éè¿éè¦å®å¶é¡¹ç®æ¨¡æ¿ï¼ä»¥ä¾¿ééå¬å¸ææ¯æ ï¼ä»¥åçº¦æå¬å¸åçä¸äºææ¯è¦æ±ï¼ä¾å¦å®¡è®¡å±æ§ãå¾®æå¡éè®¯æ¹å¼åé´æç­ï¼å¥½çé¡¹ç®æ¨¡æ¿å¯ä»¥ç»ä¸å¼åæ¨¡å¼åä¹ æ¯ã</p>
<br>
<p>ç¬èå¨åä¸ªäººå¼æºé¡¹ç®è¿ç¨ä¸­ï¼ç»å DDD ãæ¸æ´æ¶æãCQRS çä¸äºæ¦å¿µï¼è¾ä»¥ AI ç¼ç¨ï¼å½¢æäºä¸ªäººå¼åä¹ æ¯ï¼æä»¥ä¸ºäºåè¿ç¯æç« æ´çäºä¸ä¸ªæ¨¡æ¿é¡¹ç®ï¼</p>
<p><a href="https://github.com/whuanle/aispec" target="_blank" rel="noopener nofollow">https://github.com/whuanle/aispec</a></p>
<br>
<p>å¦æä»¥æçå¼åä¹ æ¯æ¥å®ï¼æä¼ä½¿ç¨æ¨¡åå + CQRSï¼æ¯ä¸ªä¸å¡é¢åéµå¾ªä¸å±æ¨¡ååæ¶æï¼æ è®ºå¼åè¿æ¯åååæµè¯ï¼é½æ¯è¾ç®åã</p>
<pre><code>src/{domain}/
âââ MoAI.{Domain}.Shared/     # å±äº«å± - DTOãCommandãQuery å®ä¹
âââ MoAI.{Domain}.Core/       # æ ¸å¿å± - Handler å®ç°ãä¸å¡é»è¾
âââ MoAI.{Domain}.Api/        # API å± - Controller/Endpoint æ´é²
</code></pre>
<p>ä¾èµå³ç³»ï¼<code>Api â Core â Shared</code>ï¼å·ä½åèï¼</p>
<p>ä»£ç ç¼åçº¦æåèï¼<a href="https://github.com/whuanle/aispec/blob/master/.kiro/steering/cqrs-conventions.md" target="_blank" rel="noopener nofollow">https://github.com/whuanle/aispec/blob/master/.kiro/steering/cqrs-conventions.md</a></p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce3883d6.png" alt="image-20260109211559319" loading="lazy"></p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce3ac8c4.png" alt="image-20260109211703315" loading="lazy"></p>
<br>
<p>å·ä½è®¾è®¡æè·¯ååç±»ç»èå°±ä¸è®²è§£ï¼æ¬èå¶å®ç®çæ¯è¯´ï¼æ è®ºä½ ä½¿ç¨ä½ç§å¼åæ¡æ¶ï¼æ¯å¦ä½¿ç¨ DDDï¼è¿æ¯ä¼ ç»ä¸å±ç»æï¼å¢éåºè¯¥è¦æä¸ä¸ªç»ä¸çé¡¹ç®æ¨¡æ¿ä»¥åå¼åä¹ æ¯çº¦æï¼AI ä¼åèé¡¹ç®å·²æä»£ç åçº¦ææä»¶ï¼ç¼åç¬¦åè¦æ±çä»£ç ï¼é¿åä»£ç å¤©é©¬è¡ç©ºã</p>
<p>å³äºæ¨¡æ¿é¡¹ç®å°±ä¸å±å¼è¯´äºï¼è¯»èå¯ä»¥å¨è¿éæ¾å°è¿ä¸ªæ¬èº«ç¨äºå®ææ¼ç¤ºçæ¨¡æ¿é¡¹ç®ï¼<a href="https://github.com/whuanle/aispec" target="_blank" rel="noopener nofollow">https://github.com/whuanle/aispec</a></p>
<h3 id="åå¤å®å¶å¢éè§åä¸é¡¹ç®ç´¢å¼">åå¤å®å¶å¢éè§åä¸é¡¹ç®ç´¢å¼</h3>
<p>å¨ä½¿ç¨ AI ç¼ç¨æ¶ï¼ä¼æä¸äºå¸¸è§é®é¢ï¼</p>
<p>1ï¼å¼åè· AI å®¹æé·å¥ç²ç®å¯¹è¯ï¼AI å§ç»æ²¡æç»åºæ³è¦çä»£ç ï¼å¯¼è´ä»£ç å¯ç¨çåç¡®å®æ§ä½ä¸ã</p>
<p>2ï¼å¼åé¾ä»¥æ¸æ°åç¡®å AI IDEè¡¨è¾¾ç®æ æ¹æ¡åä»£ç </p>
<p>3ï¼åç½®éè¦å¤§éç²¾åå¯¹é¡¹ç®ç RulesãDocs è¿è¡ç¼ååç§¯ç´¯</p>
<p>4ï¼å¥é½è®© AI åï¼ä½æ¯ AI ååºæ¥çæ¹æ¡æ»æ¯ä¸æ»¡æ</p>
<br>
<p>è§£å³è¿äºé®é¢æ¬èº«ä¸é¾ï¼ä½æ¯è¦è½å°å¢éåä½ä¸­ï¼ä½ä¸ºæ¶æå¸å°±è¦æèæ´å¤äºï¼éè¦ä¿è¯ä»£ç è´¨éåå¼åæçï¼é¿ååå¤å¤çè¿äºé®é¢ã</p>
<br>
<h4 id="ä»ä¹æ¯-steering">ä»ä¹æ¯ Steering</h4>
<p>è¿éç steering å¶å®æ¯ Kiro éé¢çæ¦å¿µï¼ç®çæ¯è®© AI ç¼ç¨è¿ç¨ä¸­ï¼å§ç»éµå¾ªå¢éå·²å»ºç«ç patternsãlibrariesãstandardsã</p>
<blockquote>
<p><a href="https://kiro.dev/docs/steering/" target="_blank" rel="noopener nofollow">https://kiro.dev/docs/steering/</a></p>
</blockquote>
<br>
<p>ä¹å°±æ¯è¯´ï¼åºäºå¢éçé¡¹ç®æ¨¡æ¿ï¼æä»¬è¦æå®ä¸äºè·ä¸å¡æ å³çææ¯çº¦æï¼ä¾å¦å®¡è®¡å±æ§æä¹å®ï¼è¿ä¸ªå¼åæ¡æ¶/é¡¹ç®æ¨¡æ¿æä¹ä½¿ç¨ï¼ä¸ååè½çä»£ç æä»¶æä¹å½åç­ï¼é½å¯ä»¥åå° Kiro steering éé¢ãAI å¨åä»£ç æ¶ï¼ä¼ä¸ç´å´ç»è¿äº steering å»åï¼å¦æååºçä»£ç ä¸ç¬¦å steering è¦æ±ï¼å AI ä¼éæ­¥ä¿®æ­£ä»£ç ã</p>
<br>
<p>é£ä¹ï¼å¢éè¦è½å°ä»£ç è§èï¼æ¯ä¸æ¯åç®åäºï¼åé¢æå°ç AI ç¼ç¨çé®é¢åæ ¸å¿è¯æ±ï¼æ¯ä¸æ¯å¯ä»¥è§£å³äºï¼</p>
<p>æ¯çï¼æä»¥ï¼è¦éè§é¡¹ç®æ¨¡æ¿å steeringï¼å¨å¢éå¼åå®ç°éæ±ä¹åï¼å°±åºè¯¥å®å¶å¢éä¹è³å¬å¸ç åé¨é¨ç steeringã</p>
<h4 id="å¸¸è§-steering-æä»¶ç­ç¥">å¸¸è§ Steering æä»¶ç­ç¥</h4>
<p>åé¢ä¼æå° Kiro é»è®¤ä¼æç steering è§åæ¨¡æ¿ï¼ä½æ¯ä»å¢éçè§åº¦èèï¼å¯è½è¿éè¦è¿äº steering ï¼</p>
<p><strong>API æ å</strong> (<code>api-standards.md</code>) - å®ä¹ REST çº¦å®ãéè¯¯ååºæ ¼å¼ãè®¤è¯æµç¨åçæ¬ç­ç¥ãåæ¬ç«¯ç¹å½åæ¨¡å¼ãHTTP ç¶æç ä½¿ç¨åè¯·æ±/ååºç¤ºä¾ã</p>
<p><strong>æµè¯æ¹æ³</strong> (<code>testing-standards.md</code>) - å»ºç«ååæµè¯æ¨¡å¼ãéææµè¯ç­ç¥ãæ¨¡ææ¹æ³åè¦ççææãè®°å½é¦éæµè¯åºãæ­è¨æ ·å¼åæµè¯æä»¶ç»ç»ã</p>
<p><strong>ä»£ç é£æ ¼</strong> (<code>code-conventions.md</code>) - æå®å½åæ¨¡å¼ãæä»¶ç»ç»ãå¯¼å¥æåºåæ¶æå³ç­ãåæ¬é¦éä»£ç ç»æãç»ä»¶æ¨¡å¼åè¦é¿åçåæ¨¡å¼ç¤ºä¾ã</p>
<p><strong>å®å¨æå</strong> (<code>security-policies.md</code>) - è®°å½è®¤è¯è¦æ±ãæ°æ®éªè¯è§åãè¾å¥æ¸çæ ååæ¼æ´é¢é²æªæ½ãåæ¬ç¹å®äºæ¨åºç¨ç¨åºçå®å¨ç¼ç å®è·µã</p>
<p><strong>é¨ç½²æµç¨</strong> (<code>deployment-workflow.md</code>) - æ¦è¿°æå»ºç¨åºãç¯å¢éç½®ãé¨ç½²æ­¥éª¤ååæ»ç­ç¥ãåæ¬ CI/CD ç®¡éè¯¦ç»ä¿¡æ¯åç¯å¢ç¹å®è¦æ±ã</p>
<br>
<p>å½ç¶ï¼è¿äº steering ä¸éè¦é½é¦éï¼å¯ä»¥ååä¸ä¸ªé¡¹ç®æ¨¡æ¿ï¼ç¶åè®© Kiro éè¯»ä»£ç å¹¶çæå³å¯ã</p>
<p>ä¸åå¬å¸å¢éå¯è½æä¸åè¦æ±ï¼åªè¦ççåå°±è¡ï¼å¯ä»¥å¨æ¸ç´¢çè¿ç¨ä¸­ï¼éæ¸ç§¯ç´¯å¢éç»éªï¼éæ¸å®å steeringã</p>
<h3 id="æ ¸å¿æ§è¡ai-é©±å¨çåä½æµç¨è®¾è®¡">æ ¸å¿æ§è¡ï¼AI é©±å¨çåä½æµç¨è®¾è®¡</h3>
<p>å¢éåä½ AI ç¼ç¨ï¼æè¦åçåè½ä¸¢å¨å¯¹è¯æ¡ï¼è®© AI åä»£ç å°±è¡ï¼</p>
<p>Noï¼å¤§éç¹éï¼</p>
<br>
<p>è®©æä»¬åå° Kiro çä»ç»ï¼<code>Agentic AI development from prototype to production</code>ï¼ç¿»è¯è¿æ¥æ¯ä»ååå°äº§åç Agentic AI å¼åã</p>
<p>æ³¨æï¼è¦ç© AI ç¼ç¨ï¼æä»¬æ¯è¦åä»ååå°äº§åæ´ä¸ªå¨æçä¸è¥¿ï¼èä¸ååæ¯ç¨ AI åå®ä»£ç æ©ç¹ä¸ç­ã</p>
<p>æä»¥è¦èèï¼å¢éçè§è²æåªäºï¼å¤§å®¶åºè¯¥æä¹åä¸åä½ï¼<strong>æ´éè¦çæ¯æä¹è®¾è®¡æ°çå¢éç åæµç¨</strong>ã</p>
<br>
<p>ä¸åå¬å¸çå¢éç»æä¸ä¸æ ·ï¼æä»¥ç¬èæç§å¸¸è§å¢éï¼äº§åãUIè®¾è®¡å¸ãååç«¯å¼åãæµè¯ï¼ç»ææ¥è®²è§£åé¢çåå®¹ã</p>
<blockquote>
<p>æè°¢è¿ä½ä½èçæç« ï¼ç»äºæå¾å¤æ³æ³ï¼<a href="https://aicodingtools.blog/zh/kiro/kiro-spec-guide" target="_blank" rel="noopener nofollow">https://aicodingtools.blog/zh/kiro/kiro-spec-guide</a></p>
</blockquote>
<br>
<p>ä½¿ç¨ AI ç¼ç¨åï¼å¢éä¸­åä¸ªè§è²è¦è´è´£çåå®¹ä¼åçååï¼è¦æ±å·¥ä½è¾åºçåå®¹è½å¤è¢« AI è¯å«å¹¶å¼ç¨ï¼å¹¶ä¸å¨å¢éåæµéã</p>
<blockquote>
<p>å¦æäº§åè¾åºçéæ±ææ¡£ï¼AI é½ä¸ä¼åææ»ç»ï¼ä½ ç»å¼åçï¼é»è¾çå±ä¸éï¼AI æä¹åä»£ç ï¼</p>
<p>äº§åçéæ±ææ¡£ï¼å¯ä»¥ç»è¿å¼åæ´çåï¼ä½ä¸ºè®© AI ç¼åä»£ç çæç¤ºè¯åéæ±çº¦æï¼å¤§å¤§åè½»å¼åçè´æã</p>
</blockquote>
<br>
<p>å¼ååæµè¯å°ä¼å¤§å¤§ä¾èµéæ±ææ¡£ï¼æå¶å®å½¢å¼çææ¡£ï¼ï¼å ä¸ºéæ±ææ¡£ä¼ä½ä¸ºå¼åãæµè¯åéªæ¶ä¾æ®ï¼å¨ AI ç¼ç¨é¶æ®µå°±è¦è®© AI ç¥éåä»£ç è¿è¦èèæä¹æµè¯åéªæ¶ï¼ä¸è½ç­è®© AI åå®ä»£ç ï¼åå« AI åååæµè¯ãæ£æ¥éªæ¶è½ä¸è½è¿ã</p>
<p><br>å¦å¤ï¼åæåå¤é¶æ®µï¼ä¹ä¾èµæ¶æå¸æ leader çæ¶æè®¾è®¡ååè½å®ç°è®¾è®¡ï¼èä¸æ¯è¯´ âå®ç°ä¸ä¸ªç­é¾æ¥æå¡ï¼å°é¿é¾æ¥ç¼©ç­ä¸ºç­é¾æ¥âï¼ææ¯è´è´£äººéè¦æèåè®¾è®¡ï¼ä½¿ç¨ä½ç§ç®æ³ç¼©ç­å°åãè¿åå°åï¼æä¹å­å¨å°æ°æ®åºï¼é«å¹¶åç¯å¢ä¸æä¹æé«å¹¶åéååå°å¯¹æ°æ®åºçååã</p>
<br>
<p>æä»¥ï¼è¦æèï¼ä½¿ç¨ AI ç¼ç¨è½å°åï¼</p>
<ul>
<li>
<p>å¢ééè¦åªäºè§è²ï¼</p>
</li>
<li>
<p>æ¯ä¸ªè§è²è¦è´è´£åªäºåå®¹ï¼</p>
</li>
<li>
<p>æ´ä¸ªç åæµç¨åºè¯¥ååªäºé¶æ®µï¼</p>
</li>
</ul>
<br>
<p>æ¯ä¸ªå¬å¸æåµé½æ¯ä¸ä¸æ ·çï¼æä»¥éå¯¹è¿äºé®é¢ï¼ç¬èæ²¡æä»ä¹è¯´æ³åè§ç¹ï¼ä¸è¿åé¢å®æé¨åä¼æå° Kiro Specs æ¯æä¹ååç åæµç¨é¶æ®µã</p>
<br>
<p>ç¬èè®¾æ³ï¼æªæ¥å´ç» AI è¾å©ç¼ç¨å¼åï¼å¢éçè§è²ååä¸åå®¹å¯è½åçéå¤§æ¹åã</p>
<p>ä¸æ¯å¢éå¼åæµç¨åçæ¹åï¼ä¸ååä»¥å¾ä»äº§åååè®¾è®¡ãéæ±ä¼ãå¼åãææµçæ¨¡å¼ï¼èæ¯å´ç» AI ç¼ç¨æ´å é ææ·å¼åæ¨¡å¼æ¥è¿ã</p>
<p>äºæ¯å¢éè§è²è´è´£çåå®¹åçæ¹åï¼æ´å¤å´ç»äº§ççèµæè½å¤è¢« AI å¸æ¶ï¼ç¥è¯å¯ä»¥æ²æ·ï¼åå°ä¿¡æ¯æµéçé¾åº¦ï¼ä»¥åéä½äº§åãè®¾è®¡å¸ãå¼åãæµè¯ä¹é´çç¥è¯åèè´£è¾¹çã</p>
<p>ä¸æ¯å¯è½ä¼åºç°ä»¥ AI ç¼ç¨ä¸ºä¸­å¿çäº§åç åä¸ä½åå¹³å°ï¼æ è®ºæ¯äº§åãè®¾è®¡å¸ãå¼åãæµè¯ï¼é½å¯ä»¥å´ç»è¿ä¸ªå¹³å°è¿è¡ç¬¦åèªå·±è§è²çåä¸ï¼ä¾å¦äº§åç¼åéæ±ææ¡£åéªæ¶ææ¡£æ¶ï¼å¯ä»¥åå© AI å¹³å°æ£æµéæ±æ¯å¦åçãè°æ´è®¾è®¡ãç»åéæ±ï¼è½¬åä¸ºå¼åäººåä¾¿äºéè¯»çææ¡£ãäº§åãè®¾è®¡å¸éè¿éæ±ææ¡£åå© AI å¹³å°å¿«éå®ç°äº§åååè®¾è®¡ãå¼åäººååå¯ä»¥å°éæ±å¯¼å¥ AIï¼åå»ºå¼åä»»å¡ï¼éæ­¥ä¸ AI åä½ç¼åä»£ç ï¼è¿å¯ä»¥åå© AI å¿«éçæååæµè¯ãéææµè¯ç­ï¼æåæ ¹æ®éªæ¶ææ¡£éªè¯æ£æµæç»è¾åºã</p>
<br>
<p>èå³äºå¢éçç åæµç¨ï¼åä¼å¨ <a href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B" rel="noopener nofollow">å·¥ä½æµç¨</a> ä¸èè¯¦ç»è®²è§£ã</p>
<h3 id="æ»ç»">æ»ç»</h3>
<p>ä½ä¸ºæç« çç¬¬äºé¨åï¼ä¸»è¦æ¯æèæä¹å»ºè®¾ä½¿ç¨ AI è¾å©ç¼ç¨çå¢éï¼ä»¥åè¿è¡å¢éåä½ã</p>
<p>ç¬¬ä¸é¨åå°ä¼è®²è§£å®æï¼ä»ååå°äº§åçæ´ä¸ªç¯èï¼æ¯ä¸ªæ­¥éª¤åºè¯¥åä»ä¹ã</p>
<h2 id="å®æ">å®æ</h2>
<p>ä½ä¸ºæç« çç¬¬ä¸é¨ååå®¹ï¼å°ä¼ä»¥ç­é¾æ¥æå¡ä¸ºæ¡ä¾ï¼å»è®²è§£å¦ä½è½å°å®æå¢éåä½å AI ç¼ç¨ï¼å»è®¾è®¡ä¸ä¸ªä»¥ AI è¾å©å¼åä¸ºæ ¸å¿çé¡¹ç®ç åæµç¨ã</p>
<h3 id="æèæ´ä½æ¶æ">æèæ´ä½æ¶æ</h3>
<p>AI æ¶ä»£ï¼è¿éè¦æå»è®¾è®¡é¡¹ç®ï¼</p>
<p>æ¯çï¼å¼åäººåè¦èªè¡å¯¹ææ¯æ¹æ¡è¿è¡è°ç ãä¸æå°è¯ï¼ç¶åè®© AI æ ¹æ®ä½ çæ¹æ¡åè®¾è®¡ååºæ¥ï¼ä¸è¦é½è®© AI å¸®ä½ åè§£å³æ¹æ¡ã</p>
<br>
<p>åªéè¦ä¸ä¸ª ideaï¼AI å°±å¯ä»¥åä»£ç ï¼å¯æ¯ AI ååºæ¥çä¸è¥¿å¯è½è·ä¸ä¸äººåéè¦çä¸è¥¿ç¸å»çè¿ï¼å¹¶ä¸è¿æå¤§éç»èæ»¡è¶³ä¸äºéæ±ï¼å¼åäººåå¯è½ä¼é·å¥è· AI çå¯¹éªä¸­ï¼ä¸æ­è°æ´æç¤ºè¯ï¼ä¸æ­ç­å¾ AI çæï¼æç»çæäº 90% çåå®¹ï¼å©ä¸ç 10%ï¼å¼åäººååªè½å¯¹çé®çä¸ç¹ç¹æ²å®ã</p>
<p><br>è½ç¶æ¯ AI ç¼ç¨ï¼ä½æ¯ç¼ç¨çéç¹æ¯äººçæ³æ³åéæ±ï¼èä¸æ¯ AI çå¤©é©¬è¡ç©ºï¼è½ç¶ AI å®ç°çé¡¹ç®å¯è½æå¾å¤å¾å¥½çåæåæ³æ³ï¼è´¨éå¯è½å¾å¥½ï¼ä½æ¯å¯¹äºä¸ä¸é¢ååå¬å¸ä¸å¡é¡¹ç®æ¥è¯´ï¼éæ±çä¸­å¿æ¯å¬å¸å¯¹åºçä¸å¡ï¼èä¸æ¯ä¸ä¸ª ideaã</p>
<p>èä¸ AI æä¸ä¸æéå¶ï¼æå¹»è§ç­ï¼ä½ åªéè¦ä¸ä¸ªç®åçä¸ä¸ªç»å½åè½ï¼å¯è½ AI æåç¹ç»å½ãOAuth2 ç­ä¸å ä¸è¥¿ç»ä½ å ä¸å»äºï¼ç®æ åç§»ï¼ã</p>
<br>
<p>æä»¥å³ä½¿å¨ AI æ¶ä»£ï¼æä»¬ä¹è¦ææé¡¹ç®è®¾è®¡ååè½å®ç°çç®æ³åé»è¾ï¼è®© AI å¨è¿ä¸ªè¾¹çåå®ç°ä»£ç åæµè¯ã</p>
<blockquote>
<p>å½ç¶ï¼æä»¬å¯ä»¥å©ç¨ AI å»å¸®å©æä»¬éªè¯æ³æ³åææè®¾è®¡ï¼ç¶åå°è¿äºåå®¹çæä¸ºæ¶æè®¾è®¡åææ¯æ¹æ¡ã</p>
</blockquote>
<h4 id="ç­é¾æ¥æå¡çæ¶æ">ç­é¾æ¥æå¡çæ¶æ</h4>
<p>ç±äºæ¬æçéç¹ä¸æ¯æä¹å®ç°ä¸ä¸ªç­é¾æ¥æå¡ï¼æä»¥ç¬èè¿éåªç®åè®²è§£è¿ä¸ªæå¡çä¸äºç®æ³åå®ç°æè·¯ï¼ä»¥ä¾¿åç»­ä½¿ç¨ AI ååºç¬¦åéæ±çä»£ç ã</p>
<br>
<p>æ ¸å¿é®é¢1ï¼ç­é¾æ¥çæåè¿å</p>
<p>æ ¸å¿é®é¢2ï¼ç­é¾æ¥å­å¨åæ¥æ¾</p>
<br>
<p>ç¬èçè®¾è®¡æ¯ï¼ç­é¾æ¥è·é¿é¾æ¥æ ç´æ¥æ å°å³ç³»ï¼ä¹å°±æ¯ä¸è½éè¿ç®æ³è½¬æ¢ç´æ¥å°é¿é¾æ¥çæç­é¾æ¥ã</p>
<p>å¯¹äºæ¯ä¸ªé¿é¾æ¥ï¼åå»ºè®°å½å­å°æ°æ®åºæ¶ä¼ä½¿ç¨ int64 éªè±åä¸»é®ï¼å­å°æ°æ®åºã</p>
<p>ä¾å¦æ°å¢ä¸ä¸ªé¿é¾æ¥ <code>https://whuanle.cn</code>ï¼å½åéªè±id æ¯ 2009194627277520896ï¼ç»è¿æ£æ¥æ°æ®åºæ²¡æéå¤æ°æ®åå­å¨å°æ°æ®åºã</p>
<p>æ¥çï¼å°éªè± id ä½¿ç¨ base62 çæç­é¾æ¥ç¼ç ãä¹æä»¥ä½¿ç¨ base62 åç¼©ç­ç¼ç ï¼æ¯å ä¸º<code>[0-9]</code>ã<code>[a-z]</code>ã<code>[A-Z]</code> ååå¥½æ¯ 62 ä¸ªå­ç¬¦ï¼è½å¤å¨ä¸ä½¿ç¨ç¹æ®ç¬¦å·çæåµä¸ï¼ä½¿ç¨æ°å­åå¤§å°åå­æ¯è¡¨è¾¾å¼ï¼ä¹å°±æ¯ç¸å½äº 62 è¿å¶ãå° 2009194627277520896 ä½¿ç¨ base62 ç¼ç æ¯å¾åºå­ç¬¦ä¸²æ¯ <code>00E3uWKkzx</code>ï¼èå­æ°æ®åªéè¦ä¸ä¸ª int64 å°±è¡ã</p>
<p>æ»¡è¶³è½å¤å°é¿é¾æ¥çæç­é¾æ¥ï¼å­å¨ç©ºé´å°ï¼ä¸å®¹æè¢«äººç¢°æè§åçéæ±ã</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce3d2b7d.png" alt="image-20260108174726106" loading="lazy"></p>
<br>
<p>æäºç­é¾æ¥çæåè¿åç®æ³åï¼æä»¬ç»§ç»­èä¸ä¸æ°æ®æ¥æ¾ã</p>
<p>ç¨æ·è®¿é® <code>/00E3uWKkzx</code> æ¶ï¼è¿åå¾å° 2009194627277520896ï¼ç¶åéè¿è¿ä¸ª id ä»æ°æ®åºæ¥æ¾æ°æ®å¾å°  <code>https://whuanle.cn</code>ï¼ç¶åè®©ç¨æ·è·³è½¬å°è¿ä¸ªå°åå³å¯ã</p>
<p>æ¯æ¬¡é½è¦æ¥æ°æ®åºï¼æ°æ®åºååå¤§ï¼èä¸ä¸ä¸è¢«äººæ»å»ï¼æºå¨äººéæºæ¼æ¥çå­ç¬¦ä¸²ï¼ä¹è¦å°æ°æ®åºæ£æ¥æ°æ®å¨ä¸å¨ï¼æ°æ®åºè¿æ©è¢«æå´©ã</p>
<br>
<p>æä»¥ç¬¬ä¸å±æ¯ä½¿ç¨ redis çå¸éè¿æ»¤å¨ï¼åå¤æ­æ°æ®æ¯å¦å­å¨ã</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce4030ea.png" alt="image-20260108180240039" loading="lazy"></p>
<br>
<p>ç¬¬äºå±ï¼æ°æ®åçï¼å°æ°æ®å­å¨å° redisï¼é¿åé¢ç¹ä»æ°æ®åºæ¥æ¾ãè¿å¯ä»¥åæ¬å°ç¦»çº¿ç¼å­ï¼é¿åé«é¢åº¦ä» redis æ¥æ¾æ°æ®ã</p>
<p>ä¹å°±æ¯æç»æ¯ä¸å±ç¼å­ã</p>
<br>
<p>å¶å®å°±ä¸å¤è¯´äºï¼åé¢æå°çç®æ³å¤çé»è¾ï¼å°ä¼ä½ä¸ºåç»­ AI ç¼ååè½çä¾æ®ã</p>
<h3 id="æ¨¡æ¿é¡¹ç®">æ¨¡æ¿é¡¹ç®</h3>
<p>é¦éæ¯å®è£ç¬èæä¾çé¡¹ç®æ¨¡æ¿ã</p>
<pre><code class="language-bash">dotnet new install Maomi.AiSpec.Templates
</code></pre>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce430090.png" alt="image-20260109092342372" loading="lazy"></p>
<br>
<p>æ§è¡å½ä»¤ä»æ¨¡æ¿åå»ºæ°çé¡¹ç®ï¼å° <code>MyShortUri</code> æ¿æ¢ä¸ºä½ éè¦çé¡¹ç®åç§°å³å¯ã</p>
<pre><code class="language-bash">dotnet new aispec -n MyShortUri
</code></pre>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce458366.png" alt="image-20260109092658516" loading="lazy"></p>
<h3 id="åç«¯å¼ååååè§è">åç«¯å¼ååååè§è</h3>
<p>ä½¿ç¨ Kiro æå¼ <code>MyShortUri</code> é¡¹ç®ï¼ å¨ AGENT STEERING èåå¯ä»¥çå°å·²ç»æ¨¡æ¿èªå¸¦åä¸ª steering æä»¶ã</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce47b764.png" alt="image-20260109224727421" loading="lazy"></p>
<br>
<p>Kiro éè¿ <code>.kiro/steering/</code> ç®å½ä¸­ç markdown æä»¶è®¾ç½®é¡¹ç®çº¦æè§å®ï¼Kiro åªè§å®äº product.mdãtech.mdãstructure.md ä¸ä¸ªæä»¶ï¼è¿äºåºç¡æä»¶é»è®¤åå«å¨æ¯æ¬¡äº¤äºä¸­ï¼å½¢æ Kiro é¡¹ç®çè§£çåºçº¿ã</p>
<p>cqrs-conventions.md åæ¯ç¬èçæ¨¡æ¿é¡¹ç®çå¼åè§åï¼çº¦å® AI çæçä»£ç æä»¶å¦ä½å­æ¾ä»¥åä»£ç æ ¼å¼çº¦æï¼AI ä¼çæç¬¦åé¡¹ç®è¦æ±çä»£ç ã</p>
<p>è¯»èä¹å¯ä»¥åå»ºä¸äºå¶å®æä»¶ï¼ä¾å¦ <code>rest-api.md</code> è¦æ±çæç api æ¥å£éè¦ç¬¦å restapi æ ¼å¼ï¼å°å¬å¸ç åè§èç­åå¥å°  <code>.kiro/steering/</code> ç®å½ã</p>
<h4 id="åç«¯ä»£ç è§èçº¦æ">åç«¯ä»£ç è§èçº¦æ</h4>
<p><code>cqrs-conventions.md</code> æ¯ç¬èèªå®ä¹ç steering æä»¶ï¼ç¨æ¥çº¦æ AI çæçä»£ç å¿é¡»åä¸º <code>Command/Query</code>ã<code>Api</code>ã<code>Handler</code> ä¸å±ç CQRS ç»æã</p>
<p>å®ä¹äºå¾å¤çº¦æè§èï¼è¿éå°±ä¸è®²è§£äºï¼èªå·±ç ç©¶ä¸ä¸ã</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce4a8557.png" alt="image-20260109094451145" loading="lazy"></p>
<h4 id="æè¦åä»ä¹æ ·çäº§å">æè¦åä»ä¹æ ·çäº§å</h4>
<p>æåé¡¹ç®æ¨¡æ¿åï¼ç¬¬ä¸æ­¥æ¯ä¿®æ¹ <code>product.md</code>ï¼åè¯ AI è¿æ¯ä¸ä¸ªç­é¾æ¥é¡¹ç®ã</p>
<blockquote>
<p><strong>äº§åæ¦è¿°</strong> (<code>product.md</code>) - å®ä¹äº§åçç®çãç®æ ç¨æ·ãå³é®åè½åä¸å¡ç®æ ã</p>
</blockquote>
<br>
<p>ä¸è¬æ¥è¯´ï¼<strong>äº§åæ¦è¿°</strong> (<code>product.md</code>)  æ¯äº§åç»ççå·¥ä½ä»»å¡ï¼å¼ååªéè¦å°äº§åç»çåçææ¡£æ·è´å°ä»£ç é¡¹ç®å³å¯ï¼ä¸è¿æ¢ç¶ç°å¨æ²¡æäº§åç»çï¼æä»¬å¯ä»¥ä¸å¥è¯æè¿°æ ¸å¿éæ±ï¼è®© Kiro å¸®å©æä»¬çæå·ä½çäº§åè¯´æï¼ç­ AI çæåï¼æ ¹æ®å®éæåµï¼è°æ´å¥½ <code>product.md</code> æä»¶ã</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce63e3a9.png" alt="image-20260109094959587" loading="lazy"></p>
<br>
<p>çæææï¼</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce66b451.png" alt="image-20260109094351449" loading="lazy"></p>
<h4 id="é¡¹ç®ç»æ">é¡¹ç®ç»æ</h4>
<p><strong>é¡¹ç®ç»æ</strong> (<code>structure.md</code>) - æ¦è¿°æä»¶ç»ç»ãå½åçº¦å®ãå¯¼å¥æ¨¡å¼åæ¶æå³ç­ï¼è¿ç¡®ä¿çæçä»£ç æ ç¼èå¥ç°æçä»£ç ç»æéé¢ï¼è¿æ · AI ä¸ä¼ä¹±åå»ºæä»¶ä»¥åéä¾¿æ¾ä¸ªå°æ¹å¡ä»£ç ã</p>
<p><code>structure.md</code> è¦å¸¸å¸¸éçé¡¹ç®çè¿å±èæ´æ°ï¼ä¸è¦ä¸ç´ä¸åï¼æ¯æ¬¡æ°å¢æ¨¡ååï¼é½è¦éæ°çæ <code>structure.md</code> ã</p>
<p>ç°å¨æä»¬ç¹å» Kiro ç <code>Refine</code> ï¼éæ°çæ <code>structure.md</code> ã</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce6eb390.png" alt="image-20260109095652954" loading="lazy"></p>
<h4 id="ææ¯çº¦å®">ææ¯çº¦å®</h4>
<p><strong>ææ¯æ </strong> (<code>tech.md</code>) - è®°å½è¿ä¸ªé¡¹ç®éæ©çæ¡æ¶ãåºãå¼åå·¥å·åææ¯çº¦æï¼å½ Kiro å»ºè®®å®ç°æ¹æ¡æ¶ï¼å®ä¼ä¼åéæ©å·²å»ºç«çææ¯æ èéæ¿ä»£æ¹æ¡ã</p>
<p>çªç¶æ³èµ·æ¥ä¸ä¸ªäºæï¼æåäºå Go è¯­è¨ç¨åºéè¦è§£å³ä¸ä¸ªæå°åè½ï¼ç»æç¨ AI åçä»£ç å¼å¥äº pythonï¼åé¢è¢«æåç°äºï¼æè¦æ±ç¨ Go éåï¼ç¶åæåäºåç¨ AI åéåªå¦åäºä¸å¤©ï¼æ»ç®ç¨ Go ååºæ¥äºã</p>
<p>æä»¥ <code>tech.md</code> å¯ä»¥é¿åè¿ç§æåµï¼ä¸ç¶ AI ä¸ºäºå®ç°ä¸ä¸ªåè½ï¼å°å¤æ¥èµæï¼ç¶åå¼å¥ä¸å ä¾èµï¼ç¨ä¸ç§ææ³ä¸å°çæ¹å¼å»å®ç°åè½ã</p>
<br>
<p>ç°å¨æä»¬ç¹å» Kiro ç <code>Refine</code> ï¼éæ°çæ <code>tech.md</code> ï¼ä¾å¦è¿ä¸ªé¡¹ç®ä½¿ç¨çææ¯æ å¦ä¸ï¼</p>
<pre><code>| Category | Technology |
|----------|------------|
| Framework | ASP.NET Core 9 |
| Language | C# 12 (nullable reference types enabled) |
| ORM | Entity Framework Core 9 (MySQL) |
| CQRS | MediatR |
| Validation | FluentValidation |
| Authentication | JWT Bearer tokens |
| Logging | Serilog |
| API Docs | OpenAPI/Swagger with Scalar UI |
| Caching | Redis (StackExchange.Redis) |
| Module System | Maomi.Core |
| Code Analysis | StyleCop.Analyzers |
</code></pre>
<br>
<p>ä½èè¿å¯ä»¥å ä¸æ¥å£è®¾è®¡çº¦å®ç­æä»¶ï¼è¿éä¸åèµè¿°ã</p>
<h3 id="æ°æ®åºè®¾è®¡">æ°æ®åºè®¾è®¡</h3>
<p>ç°å¨åºç°äºä¸ä¸ªä½¿ç¨ AI åæ°æ®åºè®¾è®¡æ¹æ¡çæ¹åï¼Text2SQLã</p>
<p>Text2SQL æå°èªç¶è¯­è¨è½¬æ¢ä¸º SQL çææ¯ï¼å½ä¸ä¸ªé¡¹ç®ä»é¶å¼å§æ¶ï¼æä»¬å¯ä»¥åå© AI ææãè®¾è®¡é¡¹ç®æ¶æï¼æåæ»ç»è¾åº SQLï¼è¿ä¸æ­¥å¶å®æ¯è¾ç®åã</p>
<p>ä½æ¯åç»­é¡¹ç®è¿­ä»£åï¼éè¦ AI å»äºè§£æ´ä¸ªæ°æ®åºè¡¨ç»æï¼éè¦ AI æ ¹æ®ä¸å¡æåµè®¾è®¡æ°çç´¢å¼ãå­æ®µçº¦æç­ï¼è¿å°±è¦æ± AI éè¦æææ°æ®ä»·å¼ï¼åºå¯¹å¤æçåæä»»å¡ï¼æè½ç»åºåççæ°æ®åºåæ´å»ºè®®ã</p>
<p>å¯ä»¥åå©ä¸ä¸ç AI DB å®¢æ·ç«¯å»åï¼ä¾å¦ Chat2DBãä¹å¯ä»¥å¨ Kiro è£ä¸ MCP å·¥å·è¯»åæ°æ®åºï¼ç±äºä¸æ¯æ¬æéç¹ï¼è¿éåªè®²è§£æè·¯ï¼å°±ä¸åè¯¦ç»è®²è¿°ã</p>
<br>
<p>æ°æ®åºåå»ºè¡¨ï¼ä»¥ä¾¿åç»­å®æè®© AI åä»£ç ã</p>
<pre><code class="language-csharp">CREATE TABLE `short_url` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'å¯ä¸IDï¼å¯¹åºç­é¾æ¥ç¼ç ï¼',
  `long_url` varchar(2048) NOT NULL COMMENT 'åå§é¿é¾æ¥',
  `hash` varbinary(32) NOT NULL COMMENT 'ç½ååå¸å¼ï¼æ¹ä¾¿å¯¹æ¯',
  `create_user_id` int(11) NOT NULL DEFAULT 0 COMMENT 'åå»ºäºº',
  `create_time` datetime NOT NULL DEFAULT current_timestamp() COMMENT 'åå»ºæ¶é´',
  `update_user_id` int(11) NOT NULL DEFAULT 0 COMMENT 'æ´æ°äºº',
  `update_time` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT 'æ´æ°æ¶é´',
  `is_deleted` bigint(20) NOT NULL DEFAULT 0 COMMENT 'è½¯å é¤',
  PRIMARY KEY (`id`),
  KEY `short_url_hash_index` (`hash`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç­é¾æ¥'

CREATE TABLE `user` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ç¨æ·ID',
  `user_name` varchar(50) NOT NULL COMMENT 'ç¨æ·å',
  `email` longtext NOT NULL COMMENT 'é®ç®±',
  `password` varchar(255) NOT NULL COMMENT 'å¯ç ',
  `nick_name` varchar(50) NOT NULL COMMENT 'æµç§°',
  `password_salt` varchar(255) NOT NULL COMMENT 'è®¡ç®å¯ç å¼çsalt',
  `is_deleted` bigint(20) NOT NULL COMMENT 'è½¯å é¤',
  `create_user_id` int(11) NOT NULL COMMENT 'åå»ºäºº',
  `create_time` datetime NOT NULL DEFAULT utc_timestamp() COMMENT 'åå»ºæ¶é´',
  `update_user_id` int(11) NOT NULL COMMENT 'æåä¿®æ¹äºº',
  `update_time` datetime NOT NULL DEFAULT utc_timestamp() COMMENT 'æåæ´æ°æ¶é´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `users_user_name_is_deleted_uindex` (`user_name`,`is_deleted`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT='ç¨æ·'

</code></pre>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce719e9b.png" alt="image-20260109110209561" loading="lazy"></p>
<br>
<p>ä¿®æ¹æ°æ®åºé¾æ¥ï¼å¯å¨ MysqlScaffold è¿åæ°æ®åºçæä»£ç ï¼å° <code>Database</code> ï¼ç®å½çæä»¶æ¾å°å¯¹åºä½ç½®æ¥å£ã</p>
<blockquote>
<p>æ¨çï¼æä¸ªé¡¹ç®æ¨¡æ¿å¤éè¦ï¼å¾å¤æ¶åçä¸å¤§éçæ¶é´ï¼ä¾å¦ç¬èè¿ä¸ªæ¨¡æ¿ï¼åè®¾è®¡æ°æ®åºï¼ç¶åå®å¶æ°æ®åºçæä»£ç çæ­¥éª¤ï¼ä½¿å¾çæçå®ä½ç»æå æ°æ®åºä¸ä¸æç±»è½å¤ç¬¦åä¸å¡éæ±ï¼å¤§å¤§æé«å¼åæçã</p>
</blockquote>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce862a66.png" alt="6f39e423-8590-4a90-bee3-cd0f34a55caa" loading="lazy"></p>
<h3 id="ui-ååè®¾è®¡">UI ååè®¾è®¡</h3>
<p>UI ååè®¾è®¡å°±æ¯ UI è®¾è®¡å¸æ ¹æ®äº§åååè®¾è®¡é¡µé¢çè¿ç¨ï¼éçä¸ä¸çååè®¾è®¡å·¥å·æ¯æ AI åï¼äº§åç»çè· UI è®¾è®¡å¸æ´å¥½å°åä½ï¼ææ¶åä¸å¥è¯å°±å¯ä»¥çæä¸ä¸ªä¸éççé¢ãäº§åç»çå¯ä»¥åå©è¿äº AI å·¥å·å¿«éå®ç°ååé¡µé¢ã</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ce998d33.png" alt="image-20260109103159002" loading="lazy"></p>
<br>
<p>ç±äºå¢¨åç AI éè¦ä»è´¹ä½¿ç¨ï¼å¤ªè´µäºï¼æ¬æ¥æ³æ¼ç¤º AI æ ¹æ®è®¾è®¡ç¨¿çæé¡µé¢ä»£ç çï¼æåæ¾å¼äºï¼ç¨è¿é±ä¹°äºå çå¤çªã</p>
<p>æ¬èææè¯»èçè§£å°±è¡ï¼å°±æ¯è¯´ç®åå¸é¢ä¸æå¾å¤ AI çæè®¾è®¡ç¨¿çäº§åï¼äº§åå¯ä»¥ä¸ç¨åé£ä¹å¤æ¶é´ç»ååäºï¼å¯ä»¥ä¸å¿æèäº§åè®¾è®¡åæµç¨é»è¾ï¼æå¤§ç¨åº¦è¾åºææ¡£ï¼æç»ååè¿äºäºæçç» AIï¼ç¶åè¿å¯ä»¥è¿ä¸æ­¥è½¬æ¢ä¸º UIï¼è®¾è®¡å¸ä¹å¯ä»¥åå© AI å¿«éå®ç°åççé¢ã</p>
<h3 id="åç«¯å¼åå®æ">åç«¯å¼åå®æ</h3>
<p>åºäºé¡¹ç®æ¨¡æ¿å steeringï¼å¶å®ä¸å¥è¯éæ±ï¼å°±å¯ä»¥è®© Kiro ç»æä»¬ç¼åä¸ä¸ªæ¨¡åçåç«¯ä»£ç ã</p>
<p>ä½æ¯ Kiro æåºäº Specsï¼è®©å¢éåä½åå¼åäººåæ©ç¹ä¸ç­çç¥å¨ã</p>
<br>
<p>Specs å¼¥åäºæ¦å¿µäº§åéæ±åææ¯å®æ½ç»èä¹é´çå·®è·ï¼ç¡®ä¿äºä¸è´æ§å¹¶åå°äºå¼åè¿­ä»£ãSpecs æä¾äºä¸ç§ç³»ç»åçæ¹æ³ï¼å°éæ±åæ³æ³è½¬åä¸ºè¯¦ç»çå®æ½è®¡åï¼çæéªæ¶æ åãææ¯å®ç°åä»£ç çæåæµè¯éªæ¶è®¡åã</p>
<br>
<p>æ¥ä¸æ¥ï¼æä»¬å°ä¼ä½¿ç¨ Kiro Specs çææä¸ªåè½çå·¥ä½æµç¨ï¼æåæ ¹æ®æ¹æ¡çæä»£ç å¹¶éè¿æµè¯éªæ¶ä»£ç ã</p>
<h4 id="å®ç°åå»ºç­é¾æ¥çæ¥å£">å®ç°åå»ºç­é¾æ¥çæ¥å£</h4>
<p>è¦åç­é¾æ¥æå¡ï¼ç¬¬ä¸æ­¥æ¯å®ç°ä¸ä¸ªé¿é¾æ¥è½¬ç­é¾æ¥çåè½ï¼Kiro Specs è¦æ±ç¼ç ä¹åéè¦æç§ä¸é¶æ®µå·¥ä½æµç¨è¿è¡ï¼éæ± â è®¾è®¡ â å®æ½ã</p>
<p>å¨ Kiro é¢æ¿ä¸­ï¼ç¹å» <strong>Specs</strong> ä¸ç <code>+</code> æé®ï¼æèä»èå¤©é¢æ¿ä¸­éæ© <strong>Spec</strong>ï¼å¨å¯¹è¯æ¡åè¾å¥è¦åçåè½ã</p>
<pre><code>Create Spec: å®ç°åå»ºç­é¾æ¥çæ¥å£ï¼åå»ºçæ°æ®å­å¨å° ShortUrlEntityï¼ä½¿ç¨éªè±idèµå¼idï¼å°é¿å°åä½¿ç¨ SHA-256 çæ 32 å­èå­å¨å° hash å­æ®µãæå¥æ°æ®æ¶è¦å¤æ­æ°æ®åºæ¯å¦å­å¨å¯¹åºçæ°æ®ã
</code></pre>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ceaa6b59.png" alt="a91e33a4-6ae2-48cc-af68-25cffb5a7898" loading="lazy"></p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639cebdc604.png" alt="382cf906-3618-4d01-abc1-5b3f6bb39e51" loading="lazy"></p>
<br>
<p>æç§å¼å¯¼æä½åï¼æåä¸æ­¥ä¼æ¾ç¤º âä¿çå¯éä»»å¡ï¼æ´å¿«å®æ MVPï¼âãâå¨é¨è®¾ä¸ºå¿éï¼å®æ´æµè¯è¦çï¼âã</p>
<p>å¦æéæ©äº âå¨é¨è®¾ä¸ºå¿éï¼å®æ´æµè¯è¦çï¼âï¼AI å¨ä»»å¡åè¡¨å ä¸åºäºå±æ§çæµè¯è¦æ±åæ§è¡æ­¥éª¤ï¼Kiro ä»æåºçéæ±ä¸­æå <code>å±æ§</code> å¹¶çææµè¯ç¨ä¾ï¼ä»¥ä¾¿ç¡®ä¿ AI çæçä»£ç ç¬¦åå¼åèçæå¾ã</p>
<blockquote>
<p>Kiro ææ¡£éé¢è§£é <code>å±æ§</code>ï¼å¯¹äºä»»ä½ä¸ç»å·æç¹å®åææ¡ä»¶çè¾å¥ï¼æäºé¢æè¡ä¸ºæ¯æç«çãKiro ä»æ ¼å¼åçéæ±ä¸­æåå±æ§ (ä¾å¦ï¼âTHE System SHALL åè®¸ç»è¿è®¤è¯çç¨æ·æ¥çæ´»å¨è½¦è¾åè¡¨â)ï¼ç¡®å®åªäºå±æ§å¯ä»¥è¿è¡é»è¾æµè¯ï¼ç¶åå¨ä½ éæ©è¿è¡å®ä»¬æ¶çææ°ç¾ææ°åä¸ªéæºæµè¯ç¨ä¾ã</p>
</blockquote>
<br>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639cec13d1c.png" alt="image-20260109115335208" loading="lazy"></p>
<p><br>ç»æä¸é¡¿æä½åï¼éæ±å·²ç»ä¸åå° <code>.kiro/specs/create-short-url</code>ï¼Kiro ä¼çæä¸ä¸ªå³é®æä»¶ï¼è¿ä¸ä¸ªæä»¶ææä¸ä¸ª specã</p>
<ul>
<li><strong>requirements.md</strong>ï¼ä½¿ç¨ç»æåç EARS è®°å·æ³æè·ç¨æ·æäºåéªæ¶æ å</li>
<li><strong>design.md</strong>ï¼è®°å½ææ¯æ¶æãåºåå¾åå®æ½èèå ç´ </li>
<li><strong>tasks.md</strong>ï¼æä¾è¯¦ç»çå®æ½è®¡åï¼åå«ç¦»æ£çãå¯è·è¸ªçä»»å¡</li>
</ul>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ced335de.png" alt="image-20260109115648904" loading="lazy"></p>
<br>
<p>æä»¬å¯ä»¥åç¼è¾ requirements.mdãdesign.mdï¼ç¡®ä¿ AI çæçå·ä½ä¸å¡è¦æ±åæµè¯è¯´æãææ¯æ åå®ç°æè·¯ç¬¦åæä»¬çè¦æ±ï¼æåæå¼ tasks.md æä»¶ï¼ç¹å»ä»»å¡æè¾¹ç <code>Start task</code> æé®å¼å§å®ç°ä»£ç ã</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ced5de13.png" alt="0dce46d5-0884-4a84-ac8d-792c18df1988" loading="lazy"></p>
<br>
<p>ç±äºåå»ºç­é¾æ¥å­å¨ä»£ç æ¶ï¼ä½¿ç¨çç®æ³è·æçè®¾æ³ç¸å·®çè¿ï¼æä»¥è¿éä¹å¯ä»¥éæ°çæä»£ç ï¼ä¸è¿å»ºè®®å¥½å¥½å  requirements.mdãdesign.mdï¼ä¸è¦å¨å¯¹è¯æ¡è°æ´ä»£ç é»è¾ï¼åªææ²æ·çææ¡£ææ¯æéè¦çã</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ceeab3a2.png" alt="image-20260109130137218" loading="lazy"></p>
<h3 id="å·¥ä½æµç¨">å·¥ä½æµç¨</h3>
<p>åé¢å©ç¨å âå®ç°åå»ºç­é¾æ¥çæ¥å£â è¿ä¸ªéæ±ï¼ä¸æäº Kiro specsï¼åä½åºè¯¥å¤§æ¦äºè§£æä¹ç©äºï¼ä½æ¯åå°å¢éåä½ä¸ï¼æä»¬è¦å¥½å¥½ææï¼ç åå¢éåºè¯¥æä¹å specsã</p>
<p>æä»¥ï¼å¨è¿ä¸èä¸­ï¼è®²è§£ Kiro specs çä¸äºæ¦å¿µï¼ä»¥ä¾¿åç­ [æ ¸å¿æ§è¡ï¼AI é©±å¨çåä½æµç¨è®¾è®¡](#æ ¸å¿æ§è¡ï¼AI é©±å¨çåä½æµç¨è®¾è®¡) ä¸­æå°çé®é¢ï¼æä¹æå®æ°çå¢éç åæµç¨ã</p>
<h4 id="éæ±é¶æ®µ">éæ±é¶æ®µ</h4>
<p>Kiro specs æåºå¨éæ±é¶æ®µç¨ç»æå EARS è¡¨ç¤ºæ³å®ä¹ç¨æ·æäºåéªæ¶æ åï¼ä¹å°±æ¯ requirements.md åºè¯¥æ°åçåå®¹ãrequirements.md æä»¶ä»¥ç¨æ·æäºçå½¢å¼åæï¼å¶ä¸­åå« EARS è¡¨ç¤ºæ³ä¸­çéªæ¶æ åã</p>
<p>æ ¸å¿å·¥ä½å¦ä¸ï¼</p>
<ul>
<li>å®ä¹ç¨æ·æäº</li>
<li>ç¼åéªæ¶æ å</li>
<li>éç¨ EARS ç¬¦å·è¿è¡éæ±è§è</li>
</ul>
 <br>
<p>ä¸ä¼ ç»éæ±ç¼åæ¹æ³çæ¯è¾ï¼EARS ç¬¦å·è¡¨ç¤ºéæ±æå¾å¤§ä¼å¿ï¼å°¤å¶å¨ä½¿ç¨ AI ç¼ç¨æ¶ã</p>
<table>
<thead>
<tr>
<th><strong>æ¹é¢</strong></th>
<th><strong>ä¼ ç»è¦æ±</strong></th>
<th><strong>EARS ç¬¦å·</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ææ°</strong></td>
<td>éå¸¸å«ç³ä¸æ¸æåé¿</td>
<td>ç®æ´æäº</td>
</tr>
<tr>
<td><strong>æ åå</strong></td>
<td>ä¸åå¢éä¹é´å­å¨å¾å¤§å·®å¼</td>
<td>ææéæ±çç»ä¸è¯­æ³</td>
</tr>
<tr>
<td><strong>æäºçè§£</strong></td>
<td>å¯¹äºéææ¯å©çç¸å³èæ¥è¯´å¾å°é¾</td>
<td>ææå©çç¸å³èé½è½è½»æ¾çè§£</td>
</tr>
<tr>
<td><strong>å¯è¿½æº¯åæä»ª</strong></td>
<td>ç»´æèµ·æ¥å¾å°é¾</td>
<td>éè¿ç»æåè¯­æ³å¢å¼ºå¯è¿½æº¯æ§</td>
</tr>
</tbody>
</table>
 <br>
<p>åæ³æä»¬å¬å¸ï¼äº§åç»çä½¿ç¨é£ä¹¦ææ¡£åäº§åææ¡£ï¼é»è¾æ··ä¹±ï¼éè¯»èµ·æ¥éå¸¸å¤´ç¼ï¼å¸¸å¸¸å¨ç¼ç å¼åè¿ç¨ä¸­åå¤è°æ´ï¼å¨ææµåéªæ¶ç¯èå­å¨åç§åæ ·çé®é¢ï¼ä¸çº¿åä¸å  bugãç åæµç¨åä¸çº¿åçè½¯ä»¶ï¼å­å¨åç§åæ ·å¤§å¤§å°å°çé®é¢ï¼ç åæªäº§åç»çææ¡£åå¾çï¼äº§åç»çæªç åæ²¡æçè§£éæ±ï¼æµè¯äººåå·ç åä»£ç åå¾çã</p>
<p>èé¢å¯¼ä»¬å¿çå®å¶åç§ âè§èâï¼è¦æ±äº§åç»çåäº§åææ¡£è¦æç§æäºæçæ ¼å¼å»åï¼åäºåç§ç åæµç¨è¦æ±ï¼è¯å¾éè¿æå®ä¸ç³»åæè°çè§èå»å½»åºè§£å³ç åå¢éåçé®é¢ã</p>
 <br>
<p>EARS è¡¨ç¤ºæ³ï¼åäºæ·±å¥äºè§£åï¼åç°è¿ä¸ªççå¾éåå¢éè½å°ï¼æ¢å¯ä»¥è§£å³äº§åç»çå°ç¼ç ãææµåçä¸äºå¸¸è§é®é¢ï¼åè½ä¾¿äº AI çè§£éæ±ãAI å¯ä»¥å¾å®¹æåºäº EARS éæ±è¡¨ç¤ºæ³ï¼çæå¯¹åºçç¼ç éæ±åæµè¯ç¨ä¾ï¼ç¡®ä¿ä»£ç çé»è¾è·éæ±ä¸è´ï¼å¹¶ä¸çæå¯¹åºçéªæ¶ææ¡£ï¼ä½ä¸ºæç»ä»£ç éªæ¶ä¾æ®ã</p>
<p>requirements.md ææ¡£åä¸ºå¤ä¸ªé¨åï¼å¶ä¸­ <strong>Requirements</strong> é¨ååºå½ä½¿ç¨ EARS è¡¨ç¤ºæ³ç¼åï¼æ¯ä¸ª requirement é½éµå¾ªä»¥ä¸æ¨¡å¼ã</p>
<pre><code>å½[æ¡ä»¶/äºä»¶]åçæ¶
ç³»ç»åº[é¢æè¡ä¸º]
</code></pre>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639ceed27e6.png" alt="image-20260110103653398" loading="lazy"></p>
 <br>
<h4 id="è®¾è®¡é¶æ®µ">è®¾è®¡é¶æ®µ</h4>
<p>design.md æä»¶æ¯è®°å½ææ¯æ¶æãé¡ºåºå¾åå®ç°æ³¨æäºé¡¹çå°æ¹ï¼éè¿ design.md å¯ä»¥å¨é¢äºè§£ç³»ç»çå·¥ä½æ¹å¼ï¼åæ¬ç»ä»¶åå¶äº¤äºãKiri çè§èä¸ºè®¾è®¡ææ¡£æä¾äºä¸ç§ç»æåçæ¹æ³ï¼ä½¿å¾çè§£ååä½å¤æç³»ç»åå¾æ´å å®¹æã</p>
<p>è®¾è®¡é¶æ®µå¯ä»¥åèåé¢ AI çæç <code>design.md</code>ï¼åæ¬äºä¸å¾ä¸­çåå®¹ã</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639cef01f19.png" alt="image-20260110104444972" loading="lazy"></p>
<h4 id="å®æ½é¶æ®µ">å®æ½é¶æ®µ</h4>
<p>tasks.md æä»¶æä¾äºä¸ä¸ªè¯¦ç»çå®æ½è®¡åï¼å¶ä¸­åå«ç¦»æ£çãå¯è·è¸ªçä»»å¡åå­ä»»å¡ãæ¯ä¸ªä»»å¡é½ææç¡®çå®ä¹ï¼åæ¬æ¸æ°çæè¿°ãé¢æç»æä»¥åä»»ä½å¿è¦çèµæºæä¾èµå³ç³»ãæ¯ä¸ªæ­¥éª¤é½å¯ä»¥ç¹å»ï¼AI æ§è¡ä»»å¡åä¼å®æ¶å·æ°å° task.md éé¢ã</p>
<p>AI çæç task.md å¦ä¸ï¼åºæ¬ä¹æ¯åä¸æ­¥ï¼åè§£ä»»å¡ãå®ä¹ä»»å¡è¾åºç»æãè®¾ç½®ä»»å¡ä¸ä¸ä¾èµå³ç³»ï¼å½ç¶æåå¯è½è¿æéªæ¶å®æ½çè¯´æ</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639cef30fb1.png" alt="image-20260109131506945" loading="lazy"></p>
<h4 id="æ§è¡é¶æ®µ">æ§è¡é¶æ®µ</h4>
<p>å¶å®å°±æ¯æä»¬å¨ task.md æå¨ç¹å»åä¸ª task çè¿ç¨ï¼æä»¬åºè¯¥ä¸ç´è·è¸ªä»»å¡è¿åº¦ï¼éæ¶è°æ´æ´æ°è¡¥å specs ä¸ä¸ªææ¡£ï¼å®ååå®¹ï¼è®© AI è¾åºçæææ´å å¥½ã</p>
<h3 id="ä½¿ç¨-hook-èªå¨æå»ºååæµè¯">ä½¿ç¨ Hook èªå¨æå»ºååæµè¯</h3>
<p>å½å¨å·¥ä½ç©ºé´ä¸­åå»ºãä¿å­æå é¤ä¸ç¹å®å¨å±æ¨¡å¼å¹éçæä»¶æ¶ï¼ä¼è§¦åæä»¶é©å­ãè¿äºé©å­éè¦ä¸ä¸ªæ¨¡å¼æ°ç»æ¥æå®è¦çè§çæä»¶ã</p>
 <br>
<p>è¿éç¬èä½¿ç¨ååæµè¯æ¥å Hookï¼è®©è¯»èäºè§£ Kiro ç Hook æä¹ç©ã</p>
<p>ååæµè¯æ¯é¡¹ç®æéè¦çä¸é¨åï¼ç±äºç¬èè¿ä¸ªæ¨¡æ¿é¡¹ç®éç¨æ´æ´æ¶æï¼æä»¥åæµè¯ä¹æ¯ç¸å½ç®åã</p>
<p>ä¸»è¦åä¸ºä¸é¨åèèï¼</p>
<p>å¯¹äºæ ä¸å¡ç¸å³çæ¡æ¶ãå·¥å·ãç®æ³ä»£ç ï¼åç¬è®¾è®¡éªè¯çååæµè¯å³å¯ã</p>
<p>å¯¹äºæ¨¡åç±»ï¼è¦éªè¯ api è¯·æ±æ¶åæ°éå¶ï¼è¦è¯å«å­æ®µé¿åº¦èå´ç­è§åã</p>
<p>å¯¹äº ApiãHandler å¯ä»¥ä¸èµ·æµï¼ç¼åéææµè¯ï¼ç´æ¥ä½¿ç¨ TestWebHost æ¨¡æè¯·æ±ã</p>
 <br>
<p>ç°å¨æä»¬ç¼åå¯¹åºçæç¤ºè¯ï¼è®© Kiro çæ Hookã</p>
<pre><code>ç» Api ç¼åååæµè¯ï¼ä½¿ç¨ EFCoreåå­æ°æ®åºæ¨¡æï¼redis ä½¿ç¨mockæ¿ä»£å¯¹äºæ ä¸å¡ç¸å³çæ¡æ¶ãå·¥å·ãç®æ³ä»£ç ï¼åç¬è®¾è®¡éªè¯çååæµè¯å³å¯ãå¯¹äºæ¨¡åç±»ï¼è¦éªè¯ api è¯·æ±æ¶åæ°éå¶ï¼è¦è¯å«å­æ®µé¿åº¦èå´ç­è§åãå¯¹äº ApiãHandler å¯ä»¥ä¸èµ·æµï¼ç¼åéææµè¯ï¼ç´æ¥ä½¿ç¨ TestWebHost æ¨¡æè¯·æ±ã
</code></pre>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639cf060a20.png" alt="image-20260109125656799" loading="lazy"></p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639cf08c52b.png" alt="image-20260109130251045" loading="lazy"></p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639cf0b69fe.png" alt="image-20260109125731788" loading="lazy"></p>
 <br>
<p>ç°å¨ä½¿ç¨ spec å å¥æ°çåè½ï¼</p>
<pre><code>Create Spec: ç¨æ·è®¿é®ç­é¾æ¥åï¼åå°ç­é¾æ¥ä½¿ç¨ base62 è¿åä¸ºéªè±idï¼åä»rediså¸éè¿æ»¤å¨éé¢è¿æ»¤ï¼å¦ææ¥æ¾ä¸å°åç´æ¥404ãç¶åä» key `short_url:{éªè±id}` éé¢æ¾ï¼æ¾ä¸å°å°±æ¥æ°æ®åºç¶åéæ°å¡å° redisï¼è¶æ¶æ¶é´30åéï¼ã
</code></pre>
 <br>
<p>åå»ºå®æåï¼æ§è¡ Task listã</p>
 <br>
<p>å¯ä»¥ç­å¾ Hook èªå¨è§¦åï¼æå¨å¯¹è¯çé¢åè¯ AI æå¨æ§è¡ <code>api-unit-test-gen.kiro.hook</code>ã</p>
<p>æç»çæååæµè¯å¦ä¸ï¼</p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639cf234a04.png" alt="image-20260109134821100" loading="lazy"></p>
<p><img src="https://www.whuanle.cn/wp-content/uploads/2026/01/post-22312-69639cf25f739.png" alt="image-20260109135655490" loading="lazy"></p>
<h3 id="æå">æå</h3>
<p>å¸æå¯ä»¥éè¿æ¬æå¸®å©æ¨å¨å¬å¸åå»ºè®¾ä¸ä¸ª AI è¾å©ç¼ç¨å¢éã</p>

</div>
<div id="MySignature" role="contentinfo">
    ç´èå·¥è¯(https://whuanle.cn)
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.021527777777777778" data-date-updated="2026-01-12 09:05">2026-01-12 08:34</span>&nbsp;
<a href="https://www.cnblogs.com/whuanle">ç´èå·¥è¯</a>&nbsp;
éè¯»(<span id="post_view_count">599</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19469026);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19469026', targetLink: 'https://www.cnblogs.com/whuanle/p/19469026', title: 'ä¸å­é¿æè®²è§£ï¼å¢éè½å° AI è¾å©ç¼ç¨å AI Specs å®æ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Javaä¸­çº¿ç¨å®å¨é®é¢çåå åè§£å³æ¹æ¡ ]]></title>
    <link>https://www.cnblogs.com/xi-yongqi/p/19468853</link>
    <guid>230b6b30fd8832efa55db7fe074252b8</guid>
    <description>
    <![CDATA[ 
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xi-yongqi/p/19468853" title="åå¸äº 2026-01-11 23:41">
    <span role="heading" aria-level="2">Javaä¸­çº¿ç¨å®å¨é®é¢çåå åè§£å³æ¹æ¡</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h3 id="çº¿ç¨å®å¨é®é¢çæ ¸å¿åå ">çº¿ç¨å®å¨é®é¢çæ ¸å¿åå </h3>
<ul>
<li>çº¿ç¨å®å¨é®é¢æ¬è´¨æ¯å¤ä¸ªçº¿ç¨å¹¶åè®¿é®å±äº«ä¸å¯åçèµæºæ¶ï¼æä½çåå­æ§ãå¯è§æ§ææåºæ§è¢«ç ´åï¼å¯¼è´ç¨åºæ§è¡ç»æä¸ç¬¦åé¢æã</li>
</ul>
<ol>
<li>æ ¹æ¬åå ï¼å±äº«å¯åèµæº</li>
</ol>
<ul>
<li>å±äº«èµæºï¼å¤ä¸ªçº¿ç¨é½è½è®¿é®å°çèµæºï¼å¦æååéãéæåéãå±äº«åå­åºåï¼ï¼</li>
<li>å¯åèµæºï¼èµæºçç¶æï¼å¼ï¼å¯ä»¥è¢«ä¿®æ¹ï¼å¦intè®¡æ°å¨ãHashMapçåç´ ï¼ï¼</li>
<li>ç»å¸çi++ æä½ãå®å¨åºå±åä¸ºâè¯»å-ä¿®æ¹-åå¥âä¸ä¸ªæ­¥éª¤ãå¦æä¸¤ä¸ªçº¿ç¨åæ¶è¯»å i=1ï¼åèªå 1åååï¼ç»ææ¯2èä¸æ¯3ã</li>
</ul>
<ol start="2">
<li>ç´æ¥åå ï¼ä¸å¤§ç¹æ§è¢«ç ´å</li>
</ol>
<ul>
<li>Javaåå­æ¨¡åï¼JMMï¼å®ä¹çå¤çº¿ç¨å¹¶åä¸å¤§æ ¸å¿ç¹æ§ï¼ä»»ä½ä¸ä¸ªè¢«ç ´åé½ä¼å¼åçº¿ç¨å®å¨é®é¢ï¼
<ul>
<li>åå­æ§ï¼ä¸ä¸ªæä½ï¼å¦count++ï¼åå«âè¯» - æ¹ - åâä¸æ­¥ï¼éåå­æä½ä¼è¢«å¤çº¿ç¨äº¤éæ§è¡ï¼</li>
<li>å¯è§æ§ï¼çº¿ç¨ä¿®æ¹å±äº«åéåï¼ä¸ä¼ç«å³åæ­¥å°ä¸»åå­ï¼å¶ä»çº¿ç¨è¯»åçä»æ¯æ§å¼ï¼</li>
<li>æåºæ§ï¼JVMçæä»¤éæåºä¼åï¼ä¼å¯¼è´å¤çº¿ç¨ä¸æ§è¡é¡ºåºæ··ä¹±ï¼å¦æªå volatileçåéæ£æ¥éåä¾ï¼ã</li>
</ul>
</li>
</ul>
<h3 id="çº¿ç¨å®å¨é®é¢çè§£å³æ¹æ¡">çº¿ç¨å®å¨é®é¢çè§£å³æ¹æ¡</h3>
<ul>
<li>æ ¸å¿æè·¯ï¼è¦ä¹é¿åå±äº«å¯åèµæºï¼ä»æ ¹æºæ¶é¤é®é¢ï¼ï¼è¦ä¹æ§å¶å¹¶åè®¿é®è§åï¼ä¿è¯ä¸å¤§ç¹æ§ï¼ã</li>
</ul>
<h5 id="æ¹æ¡1é¿åå±äº«å¯åèµæºä¼åæ¨è">æ¹æ¡1ï¼é¿åå±äº«å¯åèµæºï¼ä¼åæ¨èï¼</h5>
<ul>
<li>æ å°é­ï¼å±é¨åéï¼ï¼å±é¨åéå­å¨å¨çº¿ç¨ç§ææ ä¸­ï¼æ¯ä¸ªçº¿ç¨æç¬ç«å¯æ¬ï¼å¤©ç¶çº¿ç¨å®å¨ã</li>
</ul>
<pre><code class="language-java">public class StackClosedDemo {
    // æ¯ä¸ªçº¿ç¨è°ç¨è¯¥æ¹æ³æ¶ï¼é½ä¼åå»ºç¬ç«çcountå¯æ¬
    public void calculate() {
        int count = 0;
        count++; // æ çº¿ç¨å®å¨é®é¢
        System.out.println(Thread.currentThread().getName() + ": " + count);
    }

    public static void main(String[] args) {
        StackClosedDemo demo = new StackClosedDemo();
        // 10ä¸ªçº¿ç¨åèªæä½èªå·±çå±é¨åé
        for (int i = 0; i &lt; 10; i++) {
            new Thread(demo::calculate, "Thread-" + i).start();
        }
    }
}
</code></pre>
<ul>
<li>ä¸å¯åå¯¹è±¡:å¯¹è±¡åå»ºåç¶æä¸å¯ä¿®æ¹ï¼å¦StringãIntegerï¼ï¼å³ä½¿å±äº«ä¹æ æ³ä¿®æ¹å¼ã</li>
</ul>
<pre><code class="language-java">// èªå®ä¹ä¸å¯åç±»ï¼finalç±»+finalæååé+æ setterï¼
public final class ImmutableUser {
    private final String name;
    private final int age;

    public ImmutableUser(String name, int age) {
        this.name = name;
        this.age = age;
    }

    // ä»æä¾getterï¼æ setter
    public String getName() { return name; }
    public int getAge() { return age; }
}
</code></pre>
<ul>
<li>ThreadLocalï¼çº¿ç¨æ¬å°å­å¨ï¼:ä¸ºæ¯ä¸ªçº¿ç¨æä¾ç¬ç«çåéå¯æ¬ï¼çº¿ç¨æä½èªèº«å¯æ¬ï¼äºä¸å¹²æ°ã</li>
</ul>
<pre><code class="language-java">public class ThreadLocalDemo {
    // æ¯ä¸ªçº¿ç¨æç¬ç«çIntegerå¯æ¬ï¼åå§å¼ä¸º0
    private static ThreadLocal&lt;Integer&gt; threadLocal = ThreadLocal.withInitial(() -&gt; 0);

    public void increment() {
        threadLocal.set(threadLocal.get() + 1);
        System.out.println(Thread.currentThread().getName() + ": " + threadLocal.get());
    }

    public static void main(String[] args) {
        ThreadLocalDemo demo = new ThreadLocalDemo();
        // 3ä¸ªçº¿ç¨åèªæä½èªå·±çå¯æ¬
        for (int i = 0; i &lt; 3; i++) {
            new Thread(() -&gt; {
                for (int j = 0; j &lt; 2; j++) {
                    demo.increment();
                }
            }, "Thread-" + i).start();
        }
    }
}
// è¾åºï¼é¡ºåºå¯è½ä¸åï¼ï¼
// Thread-0: 1ãThread-0: 2
// Thread-1: 1ãThread-1: 2
// Thread-2: 1ãThread-2: 2
</code></pre>
<h4 id="æ¹æ¡2åæ­¥å éæ§å¶å¹¶åè®¿é®">æ¹æ¡2ï¼åæ­¥/å éï¼æ§å¶å¹¶åè®¿é®ï¼</h4>
<h5 id="äºæ¥åæ­¥é»å¡åæ­¥è¿æ¯æå¸¸è§çæ¹æ¡éè¿å éæ¥ä¿è¯åä¸æ¶å»åªæä¸ä¸ªçº¿ç¨æä½èµæº">äºæ¥åæ­¥ï¼é»å¡åæ­¥ï¼:è¿æ¯æå¸¸è§çæ¹æ¡ï¼éè¿å éæ¥ä¿è¯åä¸æ¶å»åªæä¸ä¸ªçº¿ç¨æä½èµæºã</h5>
<ul>
<li>synchronized å³é®å­ï¼Java åçæ¯æï¼ä½¿ç¨ç®åãå¯ä¿®é¥°æ¹æ³æä»£ç åãå±äºä¸å¯ä¸­æ­çéã</li>
</ul>
<pre><code class="language-java">public class SynchronizedDemo {
    private int count = 0;

    // åæ­¥å®ä¾æ¹æ³ï¼éæ¯thiså¯¹è±¡
    public synchronized void increment() {
        count++;
    }

    public static void main(String[] args) throws InterruptedException {
        SynchronizedDemo demo = new SynchronizedDemo();
        // 1000ä¸ªçº¿ç¨æ§è¡increment
        for (int i = 0; i &lt; 1000; i++) {
            new Thread(demo::increment).start();
        }
        Thread.sleep(1000);
        System.out.println("æç»countï¼" + demo.count); // è¾åº1000
    }
}
</code></pre>
<h5 id="reentrantlockæ¾å¼éæ¯synchronizedçµæ´»å¯ä¸­æ­å¯è¶æ¶å¬å¹³ééæå¨éæ¾éå¿é¡»å¨finallyä¸­">ReentrantLockï¼æ¾å¼éï¼:æ¯synchronizedçµæ´»ï¼å¯ä¸­æ­ãå¯è¶æ¶ãå¬å¹³éï¼ï¼éæå¨éæ¾éï¼å¿é¡»å¨finallyä¸­ï¼ã</h5>
<pre><code class="language-java">import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

public class ReentrantLockDemo {
    private int count = 0;
    private Lock lock = new ReentrantLock(); // é»è®¤éå¬å¹³é

    public void increment() {
        lock.lock(); // å é
        try {
            count++;
        } finally {
            lock.unlock(); // éæ¾éï¼é¿åæ­»é
        }
    }

    public static void main(String[] args) throws InterruptedException {
        ReentrantLockDemo demo = new ReentrantLockDemo();
        for (int i = 0; i &lt; 1000; i++) {
            new Thread(demo::increment).start();
        }
        Thread.sleep(1000);
        System.out.println("æç»countï¼" + demo.count); // è¾åº1000
    }
}
</code></pre>
<h4 id="æ¹æ¡3volatileå³é®å­ä¿è¯å¯è§æ§æåºæ§">æ¹æ¡3ï¼volatileå³é®å­ï¼ä¿è¯å¯è§æ§/æåºæ§ï¼</h4>
<ul>
<li>ä¿è¯å¯è§æ§ï¼å¼ºå¶å¤±æå·¥ä½åå­ï¼ç´æ¥è¯»åä¸»åå­ã</li>
<li>ä¿è¯æåºæ§ï¼ç¦æ­¢æä»¤éæåºã</li>
<li>æ³¨æï¼å®ä¸ä¿è¯åå­æ§ï¼ä¸è½è§£å³i++é®é¢ï¼ã</li>
</ul>
<pre><code class="language-java">public class VolatileDemo {
    private volatile boolean stop = false; // ä¿è¯å¯è§æ§åæåºæ§

    public void runThread() {
        new Thread(() -&gt; {
            int i = 0;
            while (!stop) { // è½ç«å³æç¥stopçä¿®æ¹
                i++;
            }
            System.out.println("çº¿ç¨åæ­¢ï¼i=" + i);
        }).start();
    }

    public static void main(String[] args) throws InterruptedException {
        VolatileDemo demo = new VolatileDemo();
        demo.runThread();
        Thread.sleep(3000);
        demo.stop = true; // ä¿®æ¹åï¼çº¿ç¨ç«å³åæ­¢
    }
}
</code></pre>

</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-11 23:41">2026-01-11 23:41</span>&nbsp;
<a href="https://www.cnblogs.com/xi-yongqi">æä¼æ¿é£å»</a>&nbsp;
éè¯»(<span id="post_view_count">157</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19468853);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19468853', targetLink: 'https://www.cnblogs.com/xi-yongqi/p/19468853', title: 'Javaä¸­çº¿ç¨å®å¨é®é¢çåå åè§£å³æ¹æ¡' })">ä¸¾æ¥</a>
</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ é£ä¹¦ .NET SDK äºä»¶å¤ççå¹ç­æ§ä¸å»éæºå¶ ]]></title>
    <link>https://www.cnblogs.com/mudtools/p/19469184</link>
    <guid>bd0ebe6ed3f817550068845b03bbc87d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/mudtools/p/19469184" title="åå¸äº 2026-01-11 23:00">
    <span role="heading" aria-level="2">é£ä¹¦ .NET SDK äºä»¶å¤ççå¹ç­æ§ä¸å»éæºå¶</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>é£ä¹¦äºä»¶å¤çè¿ç¨ä¸­å¦ä½è®©ä½ çåºç¨ä¸å"éå¤å³å¨"ï¼å¦ä½ç¨ä¸å±é²æ¤ç­èµ·å®å¨å¢ï¼ç»ååå­ä¸ Redis åéä¿éï¼è®©ä½ çé£ä¹¦åºç¨ç¨³å¦ç£ç³ââä¸åéå¤å¤çï¼åå«æ··ä¹±ç¶æã</p>
</blockquote>
<hr>
<h2 id="ä¸ºä»ä¹éè¦å»é">ä¸ºä»ä¹éè¦"å»é"ï¼</h2>
<p>æ³è±¡ä¸ä¸è¿æ ·çåºæ¯ï¼</p>
<p>ä½ å¨é£ä¹¦éæ¶å°ä¸æ¡æ¶æ¯ï¼åºç¨æ¶å°éç¥ååå»ºäºå¾åäºé¡¹ãä½å ä¸ºç½ç»ä¸ç¨³å®ï¼é£ä¹¦ä»¥ä¸ºä½ æ²¡æ¶å°ï¼ååäºä¸éåæ ·çéç¥ââç»æå¢ï¼ä½ çåºç¨ååå»ºäºä¸æ¬¡å¾åï¼åä¸ä¸ªä»»å¡åºç°äºä¸¤æ¬¡ã</p>
<p>è¿å°±æ¯æä»¬æè¯´ç"éå¤å¤ç"é®é¢ã</p>
<hr>
<h3 id="ä»ä¹æ¶åä¼åºç°è¿ç§æåµ">ä»ä¹æ¶åä¼åºç°è¿ç§æåµï¼</h3>
<p>å¨é£ä¹¦äºä»¶é©±å¨çä¸çéï¼ä»¥ä¸æåµé½å¯è½å¯¼è´<strong>åä¸äºä»¶è¢«å¤æ¬¡éè¾¾</strong>ï¼</p>
<ul>
<li>ð¡ <strong>ç½ç»æ³¢å¨</strong>ï¼é£ä¹¦æå¡å¨æ²¡æ¶å°ä½ çç¡®è®¤ï¼äºæ¯éå</li>
<li>ð <strong>æå¡éå¯</strong>ï¼åå­æ¸ç©ºï¼ä¹åçäºä»¶åæ¥äº</li>
<li>ð¥ <strong>å¤å®ä¾è¿è¡</strong>ï¼å¤ä¸ªå®ä¾åæ¶æ¶å°åä¸äºä»¶</li>
<li>ð <strong>æ­çº¿éè¿</strong>ï¼WebSocket éè¿åå¯è½éå¤æ¶æ¯</li>
</ul>
<h3 id="çå®æ¡ä¾ä¸åéåçæ··ä¹±">çå®æ¡ä¾ï¼ä¸åéåçæ··ä¹±</h3>
<pre><code>æ¶é´çº¿ï¼
âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ
09:00:00  é£ä¹¦æ¨éï¼æ¶å°ä¸æ¡æ°æ¶æ¯
09:00:01  å®ä¾A æ¥æ¶å¹¶å¤ç â åå»ºå¾å â
09:00:05  é£ä¹¦æ²¡æ¶å°ç¡®è®¤ï¼åæ¬¡æ¨é
09:00:06  å®ä¾B æ¥æ¶å¹¶å¤ç â ååå»ºå¾å â
âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ
</code></pre>
<p><strong>åææå¤ä¸¥éï¼</strong></p>
<table>
<thead>
<tr>
<th>é®é¢</th>
<th>å®éå½±å</th>
</tr>
</thead>
<tbody>
<tr>
<td>ð æ°æ®éå¤</td>
<td>ç¨æ·æ¶å°ä¸¤æ¡ç¸åçå¾å</td>
</tr>
<tr>
<td>ð° èµéæå¤±</td>
<td>è®¢åéå¤æ£æ¬¾ï¼éé±é½éä¸å®</td>
</tr>
<tr>
<td>ð§ éªæ°ç¨æ·</td>
<td>åä¸æ¡éç¥ååæ¬¡</td>
</tr>
<tr>
<td>ð ç¶ææ··ä¹±</td>
<td>æ°æ®åºéè¯´"å·²å¤ç"ï¼å®éåªåäºä¸å</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="ä¸å±é²æ¤åä¿å®ä¸æ ·å±å±æå³">ä¸å±é²æ¤ï¼åä¿å®ä¸æ ·å±å±æå³</h2>
<p>Mud.Feishu SDK è®¾è®¡äºä¸å¥<strong>ä¸å±éè¿å¼é²æ¤æºå¶</strong>ï¼å°±åå°åºçä¸éå²å¨ï¼ä»å¤å°åå±å±æå³ï¼ç¡®ä¿ä¸ä¼æ"åäºº"ï¼éå¤äºä»¶ï¼æ··è¿æ¥ã</p>
<div class="mermaid">graph TB
    subgraph AppLayer["åºç¨å±å»éï¼ä¸å¡é®ï¼"]
        AppHandler["IdempotentFeishuEventHandler&lt;T&gt;"]
        AppDesc["åºäºä¸å¡ä¸»é®ï¼æ¶æ¯IDãè®¢åIDç­ï¼å»é"]
    end

    subgraph DispatchLayer["ååå±å»éï¼EventIdï¼"]
        EventDedup["IFeishuEventDeduplicator / IFeishuEventDistributedDeduplicator"]
        EventDesc["åºäºé£ä¹¦äºä»¶IDå»éï¼24å°æ¶çªå£æ"]
    end

    subgraph ProtocolLayer["åè®®å±å»éï¼SeqID/Nonceï¼"]
        WS_Dedup["WebSocket: IFeishuSeqIDDeduplicator"]
        Webhook_Dedup["Webhook: IFeishuNonceDistributedDeduplicator"]
        ProtoDesc["åºäºæ¶æ¯åºåå·å»éï¼è¿æ»¤éå¤æ¶æ¯"]
    end

    AppHandler --&gt;|å¤çå¨åé¨ä¸å¡é»è¾| EventDedup
    EventDedup --&gt;|äºä»¶è·¯ç±ä¸åå| WS_Dedup
    EventDedup --&gt;|äºä»¶è·¯ç±ä¸åå| Webhook_Dedup

    style AppLayer fill:#e1f5ff
    style DispatchLayer fill:#fff4e1
    style ProtocolLayer fill:#ffe1e1
</div><h3 id="è¿ä¸å±åå«è´è´£ä»ä¹">è¿ä¸å±åå«è´è´£ä»ä¹ï¼</h3>
<p>å¯ä»¥æè¿ä¸å±æ³è±¡æå·¥åæµæ°´çº¿ä¸çä¸ä¸ªè´¨æ£åï¼</p>
<table>
<thead>
<tr>
<th>è´¨æ£å</th>
<th>æ£æ¥ä»ä¹ï¼</th>
<th>å¨åªæ£æ¥ï¼</th>
<th>è¿æ»¤èå´</th>
<th>éåä»ä¹æ¶åç¨ï¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åè®®å±</strong></td>
<td>æ¶æ¯ç¼å·ï¼SeqIDï¼</td>
<td>æ¶æ¯åå°è¾¾æ¶</td>
<td>æ¯æ¡æ¶æ¯</td>
<td>è¿æ»¤ç½ç»éå¤ï¼æå¤å±é²æ¤</td>
</tr>
<tr>
<td><strong>ååå±</strong></td>
<td>äºä»¶IDï¼EventIdï¼</td>
<td>äºä»¶ååå</td>
<td>æ¯ä¸ªäºä»¶</td>
<td>è¿æ»¤é£ä¹¦éåï¼ä¸­é´å±é²æ¤</td>
</tr>
<tr>
<td><strong>åºç¨å±</strong></td>
<td>ä¸å¡é®ï¼TaskIdï¼</td>
<td>ä¸å¡å¤çæ¶</td>
<td>æ¯æ¬¡ä¸å¡æä½</td>
<td>é²æ­¢é»è¾éå¤ï¼æåä¸éé²çº¿</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="ååå±äºä»¶çèº«ä»½è¯æ£æ¥">ååå±ï¼äºä»¶ç"èº«ä»½è¯æ£æ¥"</h2>
<p>è¿æ¯ææ ¸å¿çä¸å±ï¼å°±åé¨å£çä¿å®ï¼æ¯ä¸ªè¿æ¥çäºä»¶é½è¦ååºç¤ºèº«ä»½è¯ï¼EventIdï¼ï¼ä¿å®æ¥è¿è®°å½åæè½æ¾è¡ã</p>
<pre><code class="language-csharp">public interface IFeishuEventDeduplicator
{
    /// &lt;summary&gt;
    /// å°è¯æ è®°äºä»¶ä¸ºå¤çä¸­
    /// &lt;/summary&gt;
    /// &lt;returns&gt;
    /// true: å·²å¤çææ­£å¨å¤çä¸­ï¼è·³è¿ï¼
    /// false: æ°äºä»¶ï¼ç»§ç»­å¤çï¼
    /// &lt;/returns&gt;
    bool TryMarkAsProcessing(string eventId);

    /// &lt;summary&gt;
    /// æ è®°äºä»¶ä¸ºå·²å®æ
    /// &lt;/summary&gt;
    void MarkAsCompleted(string eventId);

    /// &lt;summary&gt;
    /// åæ»å¤çä¸­ç¶æï¼å¼å¸¸æ¶è°ç¨ï¼
    /// &lt;/summary&gt;
    void RollbackProcessing(string eventId);

    /// &lt;summary&gt;
    /// æ£æ¥äºä»¶æ¯å¦å·²å¤ç
    /// &lt;/summary&gt;
    bool IsProcessed(string eventId);
}
</code></pre>
<h3 id="äºä»¶çä¸çä¸ç§ç¶ææµè½¬">äºä»¶çä¸çï¼ä¸ç§ç¶ææµè½¬</h3>
<p>æ¯ä¸ªäºä»¶å¨å»éç³»ç»éé½åè¿å®æ£ä¸æ ·ï¼ç»åä¸ç§ç¶æçååï¼</p>
<div class="mermaid">stateDiagram-v2
    [*] --&gt; Pending: æ¶å°æ°äºä»¶
    Pending --&gt; Processing: TryMarkAsProcessing()
    Processing --&gt; Completed: å¤çæå
    Processing --&gt; Pending: è¶æ¶/å¼å¸¸ï¼Rollbackï¼
    Completed --&gt; Pending: ç¼å­è¿æï¼24å°æ¶åï¼

    note right of Processing
        å¤çä¸­è¶æ¶ï¼é»è®¤5åéï¼
        åè®¸éæ°å¤ç
    end note

    note right of Completed
        24å°æ¶åèªå¨æ¸ç
        æ¯æTTLéç½®
    end note
</div><h3 id="çå®åºæ¯websocket-æ¯æä¹å»éç">çå®åºæ¯ï¼WebSocket æ¯æä¹å»éçï¼</h3>
<p>æ¥çç WebSocket æ¶å°äºä»¶ååäºä»ä¹ï¼<code>FeishuEventMessageHandler.cs#104-147</code>ï¼ï¼</p>
<pre><code class="language-csharp">// 1. å»éæ£æ¥
bool isProcessing = false;

if (_options.EnableDistributedDeduplication &amp;&amp; _distributedDeduplicator != null)
{
    // ä¼åä½¿ç¨åå¸å¼å»éï¼Redisï¼
    isProcessing = await _distributedDeduplicator.TryMarkAsProcessedAsync(
        eventData.EventId, 
        cancellationToken: cancellationToken);
}
else if (_options.EnableEventDeduplication &amp;&amp; _deduplicator != null)
{
    // ä½¿ç¨åå­å»é
    isProcessing = _deduplicator.TryMarkAsProcessing(eventData.EventId);
}

// 2. è·³è¿å·²å¤çäºä»¶
if (isProcessing)
{
    _logger.LogDebug("äºä»¶ {EventId} å·²å¨å¤çä¸­æå·²å¤çï¼è·³è¿", eventData.EventId);
    return;
}

// 3. å¤çäºä»¶
try
{
    await _eventHandlerFactory.HandleEventParallelAsync(
        eventData.EventType, 
        eventData, 
        cancellationToken);

    // 4. å¤çæåï¼æ è®°ä¸ºå·²å®æ
    if (_options.EnableEventDeduplication &amp;&amp; _deduplicator != null)
    {
        _deduplicator.MarkAsCompleted(eventData.EventId);
    }
}
catch (Exception ex)
{
    // 5. å¤çå¤±è´¥ï¼åæ»ç¶æ
    if (_options.EnableEventDeduplication &amp;&amp; _deduplicator != null)
    {
        _deduplicator.RollbackProcessing(eventData.EventId);
    }
    throw;
}
</code></pre>
<h3 id="æ¹æ¡ä¸åå­å»ééåå¼ååå°è§æ¨¡åºç¨">æ¹æ¡ä¸ï¼åå­å»éï¼éåå¼ååå°è§æ¨¡åºç¨ï¼</h3>
<p><strong>å°±åå¨å¤§èéè®°ç¬è®°</strong>ï¼ææ¯ä¸ªäºä»¶IDè®°å¨åå­éï¼æ¶å°æ°äºä»¶æ¶åæ¥æ¥ç¬è®°ï¼å¦ææå°±è·³è¿ã</p>
<p><strong>ç¹ç¹</strong>ï¼</p>
<ul>
<li>ð§  <strong>å¨é èå­è®°</strong>ï¼æææ°æ®å­å¨åå­é</li>
<li>â° <strong>è®°24å°æ¶</strong>ï¼è¶è¿æ¶é´å°±èªå¨å¿æ</li>
<li>ð§¹ <strong>å®æææ«</strong>ï¼æ¯5åéæ¸çä¸æ¬¡è¿æçè®°å½</li>
<li>â±ï¸ <strong>è¶æ¶ä¿æ¤</strong>ï¼å¤çè¶è¿5åéè¿æ²¡å®æï¼å°±åè®¸éè¯</li>
</ul>
<p><strong>æ ¸å¿ä»£ç </strong>ï¼<code>FeishuEventDeduplicator.cs#86-135</code>ï¼ï¼</p>
<pre><code class="language-csharp">public bool TryMarkAsProcessing(string eventId)
{
    lock (_lock)
    {
        // æ£æ¥æ¯å¦å·²å­å¨
        if (_eventCache.TryGetValue(eventId, out var entry))
        {
            // å¦æå·²å¤çï¼è¿å trueï¼è·³è¿ï¼
            if (entry.Status == DeduplicationStatus.Completed)
                return true;

            // å¦æå·²å¨å¤çä¸­ï¼æ£æ¥æ¯å¦è¶æ¶
            if (entry.Status == DeduplicationStatus.Processing)
            {
                if (DateTimeOffset.UtcNow - entry.ProcessedAt &gt; _processingTimeout)
                {
                    // å¤çä¸­è¶æ¶ï¼åè®¸éæ°å¤ç
                    _logger?.LogWarning("äºä»¶ {EventId} å¤çä¸­è¶æ¶ï¼åè®¸éæ°å¤ç", eventId);
                    _eventCache.Remove(eventId);
                    // ç»§ç»­å¤ç
                }
                else
                {
                    // ä»å¨å¤çä¸­ï¼è·³è¿
                    return true;
                }
            }
        }

        // æ è®°ä¸ºå¤çä¸­
        _eventCache[eventId] = new EventCacheEntry
        {
            ProcessedAt = DateTimeOffset.UtcNow,
            EventId = eventId,
            Status = DeduplicationStatus.Processing
        };

        return false; // æªå¤çï¼æ°äºä»¶
    }
}
</code></pre>
<h3 id="æ¹æ¡äºredis-åå¸å¼å»éçäº§ç¯å¢é¦é">æ¹æ¡äºï¼Redis åå¸å¼å»éï¼çäº§ç¯å¢é¦éï¼</h3>
<p><strong>å°±åå±äº«ç¬è®°æ¬</strong>ï¼ç¨ Redis æå»éè®°å½è®°å¨å¤é¨ï¼ææå®ä¾é½è½æ¥å°ãå°±ç®éå¯æå¡ï¼ç¬è®°æ¬è¿å¨ï¼ä¸ä¼å¿è®°ã</p>
<p><strong>ç¹ç¹</strong>ï¼</p>
<ul>
<li>ð <strong>åå¨å±äº«ç¬è®°æ¬ä¸</strong>ï¼ææå®ä¾ä¸èµ·ç</li>
<li>ð <strong>èªå¨ç¿»é¡µ</strong>ï¼å°æèªå¨æ¸çï¼ä¸ç¨ç®¡</li>
<li>ð¤ <strong>å¤§å®¶ä¸èµ·ç¨</strong>ï¼å¤å®ä¾é¨ç½²æ²¡é®é¢</li>
<li>â¡ <strong>åå­æä½</strong>ï¼SETNX + EXPIRE ç¡®ä¿ä¸ä¼åé</li>
</ul>
<p><strong>æ ¸å¿ä»£ç </strong>ï¼<code>RedisFeishuEventDistributedDeduplicator.cs#53-89</code>ï¼ï¼</p>
<pre><code class="language-csharp">public async Task&lt;bool&gt; TryMarkAsProcessedAsync(
    string eventId, 
    TimeSpan? ttl = null, 
    CancellationToken cancellationToken = default)
{
    var actualTtl = ttl ?? _defaultCacheExpiration;
    var redisKey = $"{_keyPrefix}{eventId}";

    // ä½¿ç¨ SETNX + EXPIRE å®ç°åå­æ§å»é
    // ä»å½é®ä¸å­å¨æ¶è®¾ç½®ï¼å¹¶è®¾ç½®è¿ææ¶é´
    var setResult = await _database.StringSetAsync(
        redisKey,
        "1",
        actualTtl,
        When.NotExists);

    if (!setResult)
    {
        _logger?.LogDebug("äºä»¶ {EventId} å·²å¤çè¿ï¼è·³è¿", eventId);
        return true; // å·²å¤ç
    }

    _logger?.LogDebug("äºä»¶ {EventId} æ è®°ä¸ºå·²å¤çï¼TTL: {Ttl}", eventId, actualTtl);
    return false; // æªå¤çï¼æ°äºä»¶
}
</code></pre>
<h3 id="ä¸¤ç§æ¹æ¡æä¹é">ä¸¤ç§æ¹æ¡æä¹éï¼</h3>
<table>
<thead>
<tr>
<th>å¯¹æ¯é¡¹</th>
<th>åå­å»éï¼èªå·±è®°ï¼</th>
<th>Redis å»éï¼å±äº«ç¬è®°æ¬ï¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>éåº¦</strong></td>
<td>â¡ åéªçµä¸æ ·å¿«ï¼ç´æ¥è¯»åå­ï¼</td>
<td>ð å¾å¿«ï¼ä½éè¦ç½ç»ï¼</td>
</tr>
<tr>
<td><strong>å¯é æ§</strong></td>
<td>â ï¸ éå¯å°±å¿å</td>
<td>â æ°¸è¿è®°çï¼éå¯ä¹è¿å¨</td>
</tr>
<tr>
<td><strong>å¤å®ä¾</strong></td>
<td>â æ¯ä¸ªäººåè®°åç</td>
<td>â å¤§å®¶ä¸èµ·çåä¸æ¬ç¬è®°</td>
</tr>
<tr>
<td><strong>éº»ç¦ç¨åº¦</strong></td>
<td>ð¢ é¶ä¾èµï¼å¼ç®±å³ç¨</td>
<td>ð¡ éè¦é¨ç½² Redis</td>
</tr>
<tr>
<td><strong>éåè°</strong></td>
<td>ð  å¼åç¯å¢ãåæºè¿è¡</td>
<td>ð¢ çäº§ç¯å¢ãå¤å®ä¾é¨ç½²</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="åè®®å±æ¶æ¯çæéå·æ£æ¥">åè®®å±ï¼æ¶æ¯ç"æéå·æ£æ¥"</h2>
<h3 id="websocket-ç-seqid-æ¯ä»ä¹">WebSocket ç SeqID æ¯ä»ä¹ï¼</h3>
<p>é£ä¹¦ WebSocket ç¨çæ¯ ProtoBuf äºè¿å¶åè®®ï¼æ¯æ¡æ¶æ¯é½å¸¦çä¸ä¸ª<strong>éå¢çåºå·</strong>ï¼å°±åå»é¶è¡åäºæ¿çæéå·ãéè¿è®°ä½å·²ç»å¤çè¿çæéå·ï¼å°±è½å¨æ¶æ¯å±é¢å°±æéå¤çæ¡å¨å¤é¢ã</p>
<h4 id="seqid-å»éæä¹å·¥ä½">SeqID å»éæä¹å·¥ä½ï¼</h4>
<pre><code class="language-csharp">public interface IFeishuSeqIDDeduplicator
{
    /// &lt;summary&gt;
    /// å°è¯æ è®° SeqID ä¸ºå·²å¤ç
    /// &lt;/summary&gt;
    /// &lt;returns&gt;
    /// true: å·²å¤çè¿ï¼è·³è¿ï¼
    /// false: æ°æ¶æ¯ï¼ç»§ç»­å¤çï¼
    /// &lt;/returns&gt;
    bool TryMarkAsProcessed(ulong seqId);

    /// &lt;summary&gt;
    /// æ£æ¥ SeqID æ¯å¦å·²å¤ç
    /// &lt;/summary&gt;
    bool IsProcessed(ulong seqId);

    /// &lt;summary&gt;
    /// å¼æ­¥æ£æ¥ SeqID æ¯å¦å·²å¤ç
    /// &lt;/summary&gt;
    Task&lt;bool&gt; IsProcessedAsync(ulong seqId);

    /// &lt;summary&gt;
    /// æ¸ç©ºç¼å­
    /// &lt;/summary&gt;
    void ClearCache();

    /// &lt;summary&gt;
    /// è·åç¼å­ä¸­ç SeqID æ°é
    /// &lt;/summary&gt;
    int GetCacheCount();

    /// &lt;summary&gt;
    /// è·åå·²å¤ççæå¤§ SeqID
    /// &lt;/summary&gt;
    ulong GetMaxProcessedSeqId();
}
</code></pre>
<h4 id="å®ç°æºå¶">å®ç°æºå¶</h4>
<div class="mermaid">graph LR
    A[æ¶å°ProtoBufæ¶æ¯] --&gt; B{SeqIDæ£æ¥}
    B --&gt;|å·²å¤ç| C[è·³è¿æ¶æ¯]
    B --&gt;|æªå¤ç| D[è®°å½SeqID]
    D --&gt; E[å¤çæ¶æ¯]
    E --&gt; F[åéACKç¡®è®¤]
    D --&gt; G[æ´æ°æå¤§SeqID]
    G --&gt; H[å®æ¶æ¸çè¿æSeqID]
</div><h4 id="æ ¸å¿å®ç°">æ ¸å¿å®ç°</h4>
<p><strong>åå­å®ç°</strong>ï¼<code>FeishuSeqIDDeduplicator.cs</code>ï¼ï¼</p>
<pre><code class="language-csharp">public bool TryMarkAsProcessed(ulong seqId)
{
    lock (_lock)
    {
        // æ£æ¥æ¯å¦å·²å­å¨
        if (_processedSeqIds.Contains(seqId))
        {
            _logger?.LogDebug("SeqID {SeqId} å·²å¤çè¿ï¼è·³è¿", seqId);
            return true; // å·²å¤ç
        }

        // è®°å½æ° SeqID
        _processedSeqIds.Add(seqId);
        _seqIdTimestamps[seqId] = DateTimeOffset.UtcNow;

        // æ´æ°æå¤§ SeqID
        if (seqId &gt; _maxProcessedSeqId)
        {
            _maxProcessedSeqId = seqId;
        }

        return false; // æªå¤çï¼æ°æ¶æ¯
    }
}
</code></pre>
<p><strong>ä½¿ç¨ä½ç½®</strong>ï¼<code>BinaryMessageProcessor.cs#186-194</code>ï¼ï¼</p>
<pre><code class="language-csharp">// SeqID å»éæ£æ¥
if (_seqIdDeduplicator != null &amp;&amp; _seqIdDeduplicator.TryMarkAsProcessed(frame.SeqID))
{
    _logger.LogDebug("SeqID {SeqID} å·²å¤çè¿ï¼è·³è¿", frame.SeqID);
    eventArgs.SkipReason = $"SeqID {frame.SeqID} å·²å¤çè¿";
    BinaryMessageReceived?.Invoke(this, eventArgs);
    
    // ä»ç¶åéACKç¡®è®¤
    await SendAckMessageAsync(frame, true, cancellationToken);
    return;
}
</code></pre>
<h4 id="ç¹æ§æ»ç»">ç¹æ§æ»ç»</h4>
<ul>
<li>â <strong>åºäº HashSet é«ææ¥æ¾</strong>ï¼O(1) æ¥è¯¢å¤æåº¦</li>
<li>â <strong>èªå¨è·è¸ªæå¤§ SeqID</strong>ï¼æ¯æé¡ºåºæ§éªè¯</li>
<li>â <strong>24å°æ¶è¿ææºå¶</strong>ï¼å®ææ¸çåå²æ°æ®</li>
<li>â <strong>åå­åå¥½</strong>ï¼ä»å­å¨ SeqIDï¼ä¸å­å¨å®æ´æ¶æ¯</li>
</ul>
<h3 id="webhook-ç-nonceé²éæ¾æ»å»çç§å¯æ­¦å¨">Webhook ç Nonceï¼é²éæ¾æ»å»çç§å¯æ­¦å¨</h3>
<p>é£ä¹¦ Webhook çè¯·æ±éå¸¦æä¸ä¸ª <code>nonce</code>ï¼éæºæ°ï¼ï¼è¿å°±åä¸æ¬¡æ§å¯ç ââç¨è¿çå¯ç å°±ä¸è½åç¨äºï¼è¿æ ·å°±è½é²æ­¢"éæ¾æ»å»"ï¼åäººæ¿åä¸ä¸ªè¯·æ±éå¤åéï¼ã</p>
<h4 id="é²éæ¾æ»å»æµç¨">é²éæ¾æ»å»æµç¨</h4>
<pre><code>æ»å»èå°è¯éæ¾è¯·æ±ï¼
âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ
åå§è¯·æ±ï¼Nonce="abc123", Timestamp="1234567890"
â æ­£å¸¸å¤çï¼é¦æ¬¡æ¥æ¶ï¼

éæ¾è¯·æ±ï¼Nonce="abc123", Timestamp="1234567890"
â æç»å¤çï¼Nonce å·²è®°å½ï¼
âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ
</code></pre>
<h4 id="redis-å®ç°">Redis å®ç°</h4>
<pre><code class="language-csharp">public class RedisFeishuNonceDistributedDeduplicator : IFeishuNonceDistributedDeduplicator
{
    private readonly IDatabase _database;
    private readonly TimeSpan _defaultTtl = TimeSpan.FromMinutes(5); // 5åéè¿æ

    public async Task&lt;bool&gt; TryMarkAsProcessedAsync(string nonce, CancellationToken cancellationToken = default)
    {
        var redisKey = $"{_keyPrefix}{nonce}";

        // SETNX + EXPIREï¼5åéåéå¤ nonce ä¼è¢«æç»
        var setResult = await _database.StringSetAsync(
            redisKey,
            "1",
            _defaultTtl,
            When.NotExists);

        if (!setResult)
        {
            _logger?.LogWarning("æ£æµå°éå¤ç Nonce: {Nonce}ï¼å¯è½ä¸ºéæ¾æ»å»", nonce);
            return true; // å·²å¤çï¼æç»
        }

        return false; // é¦æ¬¡å¤ç
    }
}
</code></pre>
<hr>
<h2 id="åºç¨å±ç»æ¯ä¸ªä¸å¡æä½åèº«ä»½è¯">åºç¨å±ï¼ç»æ¯ä¸ªä¸å¡æä½å"èº«ä»½è¯"</h2>
<h3 id="ä¸ºä»ä¹è¿éè¦è¿ä¸å±">ä¸ºä»ä¹è¿éè¦è¿ä¸å±ï¼</h3>
<p>å°±ç®åé¢ä¸¤å±é½æ¡ä½äºï¼ä¸å¡é»è¾è¿æ¯æå¯è½éå¤æ§è¡ï¼æ¯å¦ï¼</p>
<ul>
<li>ð åä¸äºä»¶è§¦åäºå¤ä¸ªå¤çå¨ï¼å¹¶è¡å¤çï¼</li>
<li>ð å¤çå¨åé¨å¤æ¬¡è®¿é®åä¸ä¸ªèµæº</li>
<li>ð¡ ç¬¬ä¸æ¹æ¥å£éè¯å¯¼è´éå¤è°ç¨</li>
</ul>
<h3 id="å®éçå¹ç­æ§å®ç°æ¹å¼">å®éçå¹ç­æ§å®ç°æ¹å¼</h3>
<p>å¨å®éç Mud.Feishu SDK ä¸­ï¼ä¸å¡å±å¹ç­æ§ä¸»è¦éè¿ä»¥ä¸ä¸¤ç§æ¹å¼å®ç°ï¼</p>
<p><strong>æ¹å¼1ï¼ä½¿ç¨ <code>DefaultFeishuObjectEventHandler&lt;T&gt;</code>ï¼æ¨èï¼</strong><br>
SDK æä¾äº <code>DefaultFeishuObjectEventHandler&lt;T&gt;</code> åºç±»ï¼ä¸é¨ç¨äºå¤çå¯¹è±¡ç±»åçäºä»¶ãä½ åªéè¦ç»§æ¿è¿ä¸ªåºç±»ï¼å¹¶å¨ä¸å¡é»è¾ä¸­æ£æ¥æ°æ®æ¯å¦å·²å­å¨å³å¯ã</p>
<p><strong>æ¹å¼2ï¼ä½¿ç¨ <code>IdempotentFeishuEventHandler&lt;T&gt;</code></strong><br>
SDK è¿æä¾äºä¸ä¸ª <code>IdempotentFeishuEventHandler&lt;T&gt;</code> åºç±»ï¼æä¾äºåºäºä¸å¡é®çèªå¨å»éè½åãä½ éè¦éå <code>GetBusinessKey()</code> æ¹æ³å <code>HandleEventInternalAsync()</code> æ¹æ³ï¼åºç±»ä¼èªå¨å¤çä¸å¡å»éã</p>
<hr>
<h3 id="ææææä½ ç¨ä¸ä¸ªå®éæ¡ä¾">ææææä½ ç¨ï¼ä¸ä¸ªå®éæ¡ä¾</h3>
<h4 id="æ¡ä¾-1æ¶æ¯å¤çé²æ­¢éå¤åå»ºå¾å">æ¡ä¾ 1ï¼æ¶æ¯å¤çââé²æ­¢éå¤åå»ºå¾å</h4>
<pre><code class="language-csharp">public class MessageEventHandler : DefaultFeishuObjectEventHandler&lt;MessageReceiveResult&gt;
{
    private readonly IMessageService _messageService;

    public MessageEventHandler(
        ILogger&lt;MessageEventHandler&gt; logger,
        IMessageService messageService)
        : base(logger)
    {
        _messageService = messageService;
    }

    protected override async Task ProcessBusinessLogicAsync(
        EventData eventData,
        ObjectEventResult&lt;MessageReceiveResult&gt;? messageData,
        CancellationToken cancellationToken = default)
    {
        if (eventData == null)
            throw new ArgumentNullException(nameof(eventData));

        // æ£æ¥æ¶æ¯æ¯å¦å·²å¤çï¼ä¸å¡å±å¹ç­æ§ï¼
        var messageId = messageData?.Object.MessageId;
        if (string.IsNullOrEmpty(messageId))
        {
            _logger.LogWarning("æ¶æ¯IDä¸ºç©ºï¼è·³è¿å¤ç");
            return;
        }

        var alreadyProcessed = await _messageService.IsMessageProcessedAsync(messageId, cancellationToken);
        if (alreadyProcessed)
        {
            _logger.LogInformation("æ¶æ¯ {MessageId} å·²å¤çï¼è·³è¿", messageId);
            return;
        }

        // å¤çæ¶æ¯
        await _messageService.ProcessMessageAsync(messageData!.Object, cancellationToken);
    }
}
</code></pre>
<h4 id="æ¡ä¾-2é¨é¨å¤çé¿åéå¤åå»º">æ¡ä¾ 2ï¼é¨é¨å¤çââé¿åéå¤åå»º</h4>
<pre><code class="language-csharp">public class DepartmentCreatedEventHandler : DefaultFeishuObjectEventHandler&lt;DepartmentCreatedResult&gt;
{
    private readonly IDepartmentService _departmentService;

    public DepartmentCreatedEventHandler(
        ILogger&lt;DepartmentCreatedEventHandler&gt; logger,
        IDepartmentService departmentService)
        : base(logger)
    {
        _departmentService = departmentService;
    }

    protected override async Task ProcessBusinessLogicAsync(
        EventData eventData,
        ObjectEventResult&lt;DepartmentCreatedResult&gt;? departmentData,
        CancellationToken cancellationToken = default)
    {
        if (eventData == null)
            throw new ArgumentNullException(nameof(eventData));

        if (departmentData?.Object == null)
        {
            _logger.LogWarning("é¨é¨æ°æ®ä¸ºç©ºï¼è·³è¿å¤ç");
            return;
        }

        // æ£æ¥é¨é¨æ¯å¦å·²å­å¨ï¼ä¸å¡å±å¹ç­æ§ï¼
        var departmentId = departmentData.Object.DepartmentId;
        var exists = await _departmentService.ExistsAsync(departmentId, cancellationToken);

        if (exists)
        {
            _logger.LogInformation("é¨é¨ {DepartmentId} å·²å­å¨ï¼è·³è¿åå»º", departmentId);
            return;
        }

        // åå»ºé¨é¨
        await _departmentService.CreateAsync(departmentData.Object, cancellationToken);
    }
}
</code></pre>
<h4 id="æ¡ä¾-3ç¨æ·åå»ºé¿åéå¤æ³¨å">æ¡ä¾ 3ï¼ç¨æ·åå»ºââé¿åéå¤æ³¨å</h4>
<pre><code class="language-csharp">public class UserCreatedEventHandler : DefaultFeishuObjectEventHandler&lt;UserCreatedResult&gt;
{
    private readonly IUserService _userService;

    public UserCreatedEventHandler(
        ILogger&lt;UserCreatedEventHandler&gt; logger,
        IUserService userService)
        : base(logger)
    {
        _userService = userService;
    }

    protected override async Task ProcessBusinessLogicAsync(
        EventData eventData,
        ObjectEventResult&lt;UserCreatedResult&gt;? userData,
        CancellationToken cancellationToken = default)
    {
        if (eventData == null)
            throw new ArgumentNullException(nameof(eventData));

        if (userData?.Object == null)
        {
            _logger.LogWarning("ç¨æ·æ°æ®ä¸ºç©ºï¼è·³è¿å¤ç");
            return;
        }

        // æ£æ¥ç¨æ·æ¯å¦å·²å­å¨ï¼ä¸å¡å±å¹ç­æ§ï¼
        var userId = userData.Object.UserId;
        var exists = await _userService.ExistsAsync(userId, cancellationToken);

        if (exists)
        {
            _logger.LogInformation("ç¨æ· {UserId} å·²å­å¨ï¼è·³è¿åå»º", userId);
            return;
        }

        // åå»ºç¨æ·
        await _userService.CreateAsync(userData.Object, cancellationToken);
    }
}
</code></pre>
<h3 id="æä¹è®¾è®¡ä¸å¡é®æå¥è·¯å">æä¹è®¾è®¡ä¸å¡é®ï¼æå¥è·¯åï¼</h3>
<table>
<thead>
<tr>
<th>ä¸å¡åºæ¯</th>
<th>ä¸å¡é®é¿ä»ä¹æ ·ï¼</th>
<th>ä¸ºä»ä¹è¿ä¹è®¾è®¡ï¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¶å°æ¶æ¯</td>
<td><code>im.message.receive_v1:om_xxxxxxxxxx</code></td>
<td>äºä»¶ç±»å + æ¶æ¯IDï¼ä¸ç¼çåºæ¯åªæ¡æ¶æ¯</td>
</tr>
<tr>
<td>åå»ºé¨é¨</td>
<td><code>contact.department.created_v3:od_xxxxxxxxxx</code></td>
<td>äºä»¶ç±»å + é¨é¨IDï¼é¿ååå¶ä»IDå²çª</td>
</tr>
<tr>
<td>åå»ºç¨æ·</td>
<td><code>contact.user.created_v3:ou_xxxxxxxxxx</code></td>
<td>äºä»¶ç±»å + ç¨æ·IDï¼å¯ä¸æ è¯ç¨æ·</td>
</tr>
<tr>
<td>å é¤é¨é¨</td>
<td><code>contact.department.deleted_v3:od_xxxxxxxxxx</code></td>
<td>äºä»¶ç±»å + é¨é¨IDï¼å¤çå é¤äºä»¶</td>
</tr>
<tr>
<td>æ¶æ¯å·²è¯»</td>
<td><code>im.message.message_read_v1:ou_xxxxxxxxxx:om_xxxxxxxxxx</code></td>
<td>äºä»¶ç±»å + ç¨æ·ID + æ¶æ¯ID</td>
</tr>
</tbody>
</table>
<p><strong>åæ¡é»éæ³å</strong>ï¼</p>
<ol>
<li>ð <strong>å¯ä¸æ§</strong>ï¼ä¸ä¸ªæä½å¯¹åºä¸ä¸ªé®ï¼ä¸è½æä¸¤ä¸ªæä½æè½¦</li>
<li>ð <strong>å¯è¯»æ§</strong>ï¼çæ¥å¿æ¶è½å¿«éç¥éè¿æ¯ä»ä¹</li>
<li>ð§± <strong>ç¨³å®æ§</strong>ï¼å«ç¨æ¶é´æ³è¿ç§ä¼åçå­æ®µåé®</li>
<li>âï¸ <strong>ç®æ´æ§</strong>ï¼å«åå¤ªé¿ï¼çåå­ãå¥½æ¥è¯¢</li>
</ol>
<hr>
<h2 id="éç½®å®æå¼å-vs-çäº§ç¯å¢">éç½®å®æï¼å¼å vs çäº§ç¯å¢</h2>
<h3 id="websocket-æä¹éç½®">WebSocket æä¹éç½®ï¼</h3>
<pre><code class="language-csharp">// ä½¿ç¨å»ºé èæ¨¡å¼éç½® WebSocket
builder.Services.AddFeishuWebSocketServiceBuilder(configuration)
    .ConfigureOptions(options =&gt;
    {
        // äºä»¶å»ééç½®
        options.EnableEventDeduplication = true;           // å¯ç¨äºä»¶å»é
        options.EnableDistributedDeduplication = false;    // åæºåºæ¯ä½¿ç¨åå­å»é
        options.EventDeduplicationCacheExpirationMs = 86400000;  // 24å°æ¶è¿æ
        options.EventDeduplicationCleanupIntervalMs = 300000;    // 5åéæ¸çé´é
    });
</code></pre>
<h4 id="çäº§ç¯å¢å¿å¤éç½®ä¸å®è¦ç">çäº§ç¯å¢å¿å¤éç½®ï¼ä¸å®è¦çï¼ï¼</h4>
<pre><code class="language-csharp">// 1. éç½® Redisï¼å¨ appsettings.json ä¸­ï¼
// {
//   "Feishu": {
//     "Redis": {
//       "ConnectionString": "your-redis-server"
//     }
//   }
// }

// 2. æ³¨å Redis æå¡åå»éæå¡
builder.Services
    .AddFeishuRedis()
    .AddFeishuRedisDeduplicators();

// 3. å¯ç¨åå¸å¼å»é
builder.Services.AddFeishuWebSocketServiceBuilder(configuration)
    .ConfigureOptions(options =&gt;
    {
        options.EnableDistributedDeduplication = true;   // å¯ç¨åå¸å¼å»é
        options.EventDeduplicationCacheExpirationMs = 86400000;  // 24å°æ¶
    });
</code></pre>
<h3 id="webhook-éç½®">Webhook éç½®</h3>
<pre><code class="language-csharp">// æ³¨å Webhook æå¡
builder.Services.AddFeishuWebhookServiceBuilder(configuration)
    .ConfigureOptions(options =&gt;
    {
        options.VerificationToken = "your_verification_token";
        options.EncryptKey = "your_encrypt_key";
        options.EventHandlingTimeoutMs = 30000;          // 30ç§è¶æ¶
        options.MaxConcurrentEvents = 10;                // æå¤§å¹¶åæ°
    });

// æ³¨å Redis å»é
builder.Services
    .AddFeishuRedis()
    .AddFeishuRedisEventDeduplicator();
</code></pre>
<h3 id="ä¸å¼ è¡¨çæå¼åä¸çäº§çåºå«">ä¸å¼ è¡¨çæå¼åä¸çäº§çåºå«</h3>
<table>
<thead>
<tr>
<th>éç½®é¡¹</th>
<th>å¼åç¯å¢</th>
<th>çäº§ç¯å¢</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>EnableEventDeduplication</code></td>
<td><code>true</code></td>
<td><code>true</code></td>
<td>å§ç»å¯ç¨åå­å»é</td>
</tr>
<tr>
<td><code>EnableDistributedDeduplication</code></td>
<td><code>false</code></td>
<td><code>true</code></td>
<td>çäº§ç¯å¢å¯ç¨Rediså»é</td>
</tr>
<tr>
<td><code>EventDeduplicationCacheExpirationMs</code></td>
<td><code>3600000</code> (1å°æ¶)</td>
<td><code>86400000</code> (24å°æ¶)</td>
<td>çäº§ç¯å¢å»¶é¿çªå£æ</td>
</tr>
<tr>
<td><code>EventDeduplicationCleanupIntervalMs</code></td>
<td><code>60000</code> (1åé)</td>
<td><code>300000</code> (5åé)</td>
<td>çäº§ç¯å¢éä½æ¸çé¢ç</td>
</tr>
</tbody>
</table>
<h3 id="å®æ´éç½®ä»é¶å°ä¸çº¿ä¸æ¬¡æå®">å®æ´éç½®ï¼ä»é¶å°ä¸çº¿ä¸æ¬¡æå®</h3>
<pre><code class="language-csharp">public void ConfigureServices(IServiceCollection services)
{
    // éç½® Redisï¼appsettings.json ä¸­éç½®ï¼
    services
        .AddFeishuRedis()
        .AddFeishuRedisDeduplicators();

    // æ³¨å WebSocket æå¡
    services.AddFeishuWebSocketServiceBuilder(configuration)
        .ConfigureOptions(wsOptions =&gt;
        {
            wsOptions.EnableEventDeduplication = true;
            wsOptions.EnableDistributedDeduplication = true;
            wsOptions.EventDeduplicationCacheExpirationMs = 86400000;
            wsOptions.AutoReconnect = true;
            wsOptions.MaxReconnectAttempts = 5;
            wsOptions.HeartbeatIntervalMs = 30000;
        })
        .AddHandler&lt;MessageEventHandler&gt;()
        .AddHandler&lt;DepartmentCreatedEventHandler&gt;()
        .Build();

    // æ³¨å Webhook æå¡
    services.AddFeishuWebhookServiceBuilder(configuration)
        .ConfigureOptions(webhookOptions =&gt;
        {
            webhookOptions.VerificationToken = "your_token";
            webhookOptions.EncryptKey = "your_key";
            webhookOptions.EventHandlingTimeoutMs = 30000;
            webhookOptions.MaxConcurrentEvents = 20;
        })
        .AddHandler&lt;UserCreatedEventHandler&gt;()
        .Build();
}
</code></pre>
<h3 id="è¿æä¸ªè´´å¿åè½éç½®éè¯¯èªå¨æé">è¿æä¸ªè´´å¿åè½ï¼éç½®éè¯¯èªå¨æé</h3>
<p>SDK ä¼èªå¨æ£æ¥éç½®ï¼å¦æä½ æå»éåè½å¨å³äºï¼å®ä¼ç´æ¥æ¥éæéä½ ï¼</p>
<pre><code class="language-csharp">// FeishuWebSocketOptions.Validate() èªå¨æ§è¡
// SDK ä¼å¨æå¡å¯å¨æ¶æ£æ¥éç½®ï¼å¦æå»éåè½å¨å³é­ä¼æåºè­¦å
</code></pre>
<hr>
<h2 id="è¸©åæåäºä¸ªå¸¸è§é®é¢åè§£å³æ¹æ¡">è¸©åæåï¼äºä¸ªå¸¸è§é®é¢åè§£å³æ¹æ¡</h2>
<h3 id="é®é¢-1æå¡éå¯éå¤äºä»¶åæ¥äº">é®é¢ 1ï¼æå¡éå¯ï¼éå¤äºä»¶åæ¥äº</h3>
<p><strong>ç°åºæ¯è¿æ ·ç</strong>ï¼</p>
<p><strong>ç°è±¡</strong>ï¼</p>
<pre><code>09:00 æå¡æ¥æ¶ EventId="evt_123" â å¤çæå
09:05 æå¡éå¯ï¼åå­ç¼å­æ¸ç©ºï¼
09:06 é£ä¹¦éå EventId="evt_123" â éå¤å¤ç
</code></pre>
<p><strong>ä¸ºä»ä¹ï¼</strong></p>
<ul>
<li>ð§  åå­å»éå°±åç­æè®°å¿ï¼éå¯å°±å¿åäº</li>
<li>ð¡ é£ä¹¦æ²¡æ¶å°ä½ çç¡®è®¤ï¼ä»¥ä¸ºä½ æ²¡æ¶å°ï¼ç»§ç»­å</li>
</ul>
<p><strong>æä¹è§£å³ï¼</strong></p>
<p>â <strong>æ¹æ¡1ï¼å¯ç¨ Redis åå¸å¼å»éï¼æ¨èï¼</strong></p>
<pre><code class="language-csharp">// éç½® Redisï¼appsettings.json ä¸­éç½®è¿æ¥ä¿¡æ¯ï¼
services
    .AddFeishuRedis()
    .AddFeishuRedisDeduplicators();

services.AddFeishuWebSocketServiceBuilder(configuration)
    .ConfigureOptions(options =&gt;
    {
        options.EnableDistributedDeduplication = true; // ä½¿ç¨Redis
        options.EnableEventDeduplication = false;    // ç¦ç¨åå­å»é
    });
</code></pre>
<p>â <strong>æ¹æ¡2ï¼å®ç°å»éç¶ææä¹å</strong></p>
<pre><code class="language-csharp">public class PersistentEventDeduplicator : IFeishuEventDeduplicator
{
    private readonly IDatabase _database;

    public bool TryMarkAsProcessing(string eventId)
    {
        // å°è¯åå¥æ°æ®åº
        var exists = _database.EventExists(eventId);
        if (!exists)
        {
            _database.MarkProcessing(eventId);
            return false;
        }
        return true;
    }
}
</code></pre>
<hr>
<h3 id="é®é¢-2å¤å®ä¾ä¸èµ·è·éå¤å¤çæ¡ä¸ä½">é®é¢ 2ï¼å¤å®ä¾ä¸èµ·è·ï¼éå¤å¤çæ¡ä¸ä½</h3>
<p><strong>ç°åºæ¯è¿æ ·ç</strong>ï¼</p>
<pre><code>å®ä¾A å å®ä¾B åæ¶å¯å¨
é£ä¹¦æ¨é EventId="evt_123"
å®ä¾A æ¶å° â å¤ç â
å®ä¾B æ¶å° â å¤ç â (éå¤ï¼)
</code></pre>
<p><strong>ä¸ºä»ä¹ï¼</strong></p>
<ul>
<li>ð§  æ¯ä¸ªå®ä¾é½æèªå·±ç¬ç«ç"å°æ¬æ¬"</li>
<li>ð« å®ä¾ä¹é´äºç¸çä¸å°å¯¹æ¹çè®°å½</li>
</ul>
<p><strong>æä¹è§£å³ï¼</strong></p>
<p>â <strong>å¿é¡»ä½¿ç¨ Redis åå¸å¼å»é</strong></p>
<pre><code class="language-csharp">// ææå®ä¾è¿æ¥å°åä¸ä¸ª Redisï¼å¨éç½®æä»¶ä¸­éç½®ï¼
services
    .AddFeishuRedis()
    .AddFeishuRedisDeduplicators();

services.AddFeishuWebSocketServiceBuilder(configuration)
    .ConfigureOptions(options =&gt;
    {
        options.EnableDistributedDeduplication = true;
    });
</code></pre>
<p><strong>ä¸å¼ å¾çæåºå«</strong>ï¼</p>
<div class="mermaid">graph TB
    subgraph Wrong["â éè¯¯æ¶æï¼åå­å»éï¼"]
        A1["å®ä¾A&lt;br/&gt;åå­ç¼å­A&lt;br/&gt;evt_123 â"]
        A2["å®ä¾B&lt;br/&gt;åå­ç¼å­B&lt;br/&gt;evt_123 â"]
    end

    subgraph Right["â æ­£ç¡®æ¶æï¼Rediså»éï¼"]
        B1["å®ä¾A"]
        B2["å®ä¾B"]
        Redis["Redis å»é&lt;br/&gt;evt_123 â"]
    end

    B1 --&gt; Redis
    B2 --&gt; Redis

    style Wrong fill:#ffebee
    style Right fill:#e8f5e9
    style Redis fill:#e3f2fd
</div><hr>
<h3 id="é®é¢-3å¤çè¶æ¶éå¤äºä»¶è¶èèå¥">é®é¢ 3ï¼å¤çè¶æ¶ï¼éå¤äºä»¶è¶èèå¥</h3>
<p><strong>ç°åºæ¯è¿æ ·ç</strong>ï¼</p>
<pre><code>09:00 å¼å§å¤ç EventId="evt_123"
09:01 å¤çè¶æ¶ï¼è¶æ¶30ç§ï¼
09:01 åæ» Processing ç¶æ
09:02 é£ä¹¦éå EventId="evt_123"
09:02 éå¤å¤ç â (å®éå·²æåï¼)
</code></pre>
<p><strong>ä¸ºä»ä¹ï¼</strong></p>
<ul>
<li>â±ï¸ è¶æ¶åç³»ç»ä»¥ä¸ºæ²¡å®æï¼æ"å¤çä¸­"æ è®°æ¤åäº</li>
<li>â ä½ä¸å¡å¯è½å·²ç»åå®äºï¼åªæ¯ååºæ¢äºä¸ç¹ç¹</li>
</ul>
<p><strong>æä¹è§£å³ï¼</strong></p>
<p>â <strong>æ¹æ¡1ï¼å¢å æç»ä¸è´æ§æ£æ¥</strong></p>
<pre><code class="language-csharp">public class DepartmentCreatedEventHandler : DefaultFeishuObjectEventHandler&lt;DepartmentCreatedResult&gt;
{
    private readonly IDepartmentService _departmentService;

    protected override async Task ProcessBusinessLogicAsync(
        EventData eventData,
        ObjectEventResult&lt;DepartmentCreatedResult&gt;? departmentData,
        CancellationToken ct)
    {
        if (departmentData?.Object == null)
            return;

        var departmentId = departmentData.Object.DepartmentId;

        // åæ£æ¥é¨é¨æ¯å¦å·²å­å¨ï¼å¹ç­æ§ï¼
        var existingDepartment = await _departmentService.GetAsync(departmentId, ct);
        if (existingDepartment != null)
        {
            _logger.LogInformation("é¨é¨ {DepartmentId} å·²å­å¨ï¼è·³è¿åå»º", departmentId);
            return;
        }

        // åå»ºé¨é¨
        await _departmentService.CreateAsync(departmentData.Object, ct);
    }
}
</code></pre>
<p>â <strong>æ¹æ¡2ï¼å®ç°å¤çç»­ææºå¶</strong></p>
<pre><code class="language-csharp">public class LongRunningTaskHandler : DefaultFeishuEventHandler
{
    private readonly IFeishuEventDeduplicator _deduplicator;

    protected override async Task ProcessBusinessLogicAsync(EventData eventData, CancellationToken ct)
    {
        var eventId = eventData.EventId;

        // å®æç»­æå¤çæ¶é´ï¼æ¯30ç§ï¼
        var renewalTask = Task.Run(async () =&gt;
        {
            while (!ct.IsCancellationRequested)
            {
                await Task.Delay(30000, ct);
                _deduplicator.RenewProcessing(eventId);
            }
        }, ct);

        try
        {
            await ProcessLongRunningTask(eventData, ct);
        }
        finally
        {
            await renewalTask;
        }
    }
}
</code></pre>
<hr>
<h3 id="é®é¢-4redis-å®æºå»éé²æ¤å¨å¤±æ">é®é¢ 4ï¼Redis å®æºï¼å»éé²æ¤å¨å¤±æ</h3>
<p><strong>ç°åºæ¯è¿æ ·ç</strong>ï¼</p>
<pre><code>Redis å®æº
æå¡æ æ³è°ç¨ TryMarkAsProcessedAsync()
è¿å falseï¼åè®¸å¤çï¼
å¤ä¸ªå®ä¾éå¤å¤çåä¸äºä»¶ â
</code></pre>
<p><strong>ä¸ºä»ä¹ï¼</strong></p>
<ul>
<li>ð« Redis æäºï¼ä»£ç ä¸ºäºä¸é»å¡éæ©"åè®¸å¤ç"</li>
<li>â ç»æéå¤äºä»¶å¨æ¶è¿æ¥</li>
</ul>
<p><strong>æä¹è§£å³ï¼</strong></p>
<p>â <strong>æ¹æ¡1ï¼å®ç°éçº§å°åå­å»é</strong></p>
<pre><code class="language-csharp">public class HybridEventDeduplicator : IFeishuEventDeduplicator
{
    private readonly IFeishuEventDistributedDeduplicator _redis;
    private readonly IFeishuEventDeduplicator _memory;

    public bool TryMarkAsProcessing(string eventId)
    {
        try
        {
            // ä¼åä½¿ç¨ Redis
            return _redis.TryMarkAsProcessedAsync(eventId).GetAwaiter().GetResult();
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Rediså»éå¤±è´¥ï¼éçº§å°åå­å»é");
            // éçº§å°åå­å»é
            return _memory.TryMarkAsProcessing(eventId);
        }
    }
}
</code></pre>
<p>â <strong>æ¹æ¡2ï¼éç½®çæ­æºå¶</strong></p>
<pre><code class="language-csharp">public class CircuitBreakerEventDeduplicator : IFeishuEventDeduplicator
{
    private readonly CircuitBreaker _circuitBreaker;
    private int _failureCount;
    private DateTime _lastFailureTime;

    public bool TryMarkAsProcessing(string eventId)
    {
        if (_circuitBreaker.IsOpen())
        {
            _logger.LogWarning("Rediså»éçæ­ï¼æç»å¤ç");
            return true; // æç»å¤çï¼ä¿æ¤ä¸æ¸¸
        }

        try
        {
            var result = _redis.TryMarkAsProcessedAsync(eventId).GetAwaiter().GetResult();
            _circuitBreaker.RecordSuccess();
            return result;
        }
        catch (Exception ex)
        {
            _circuitBreaker.RecordFailure();
            throw;
        }
    }
}
</code></pre>
<hr>
<h3 id="é®é¢-5ç¼å­è¶ç§¯è¶å¤åå­å¿«çäº">é®é¢ 5ï¼ç¼å­è¶ç§¯è¶å¤ï¼åå­å¿«çäº</h3>
<p><strong>ç°åºæ¯è¿æ ·ç</strong>ï¼</p>
<pre><code>æå¡è¿è¡24å°æ¶
å»éç¼å­æ¡ç®ï¼100ä¸+
åå­å ç¨ï¼è¶è¿500MB
GCååå¢å¤§ï¼æ§è½ä¸é
</code></pre>
<p><strong>ä¸ºä»ä¹ï¼</strong></p>
<ul>
<li>ð é«é¢äºä»¶ï¼æ¯å¦æ¥æ¶æ¶æ¯ï¼ä¸å¤©è½äº§çå åä¸æ¡è®°å½</li>
<li>ð æ¸çé´éå¤ªé¿ï¼æ§è®°å½å ç§¯å¦å±±</li>
</ul>
<p><strong>æä¹è§£å³ï¼</strong></p>
<p>â <strong>æ¹æ¡1ï¼ç¼©ç­ç¼å­è¿ææ¶é´</strong></p>
<pre><code class="language-csharp">services.AddFeishuWebSocketServiceBuilder(configuration)
    .ConfigureOptions(options =&gt;
    {
        // æ ¹æ®å®éä¸å¡è°æ´
        options.EventDeduplicationCacheExpirationMs = 3600000;  // ç¼©ç­ä¸º1å°æ¶
        options.EventDeduplicationCleanupIntervalMs = 60000;    // æé«æ¸çé¢çä¸º1åé
    });
</code></pre>
<p>â <strong>æ¹æ¡2ï¼ä½¿ç¨ LRU ç¼å­</strong></p>
<pre><code class="language-csharp">public class LRUEventDeduplicator : IFeishuEventDeduplicator
{
    private readonly LRUCache&lt;string, EventCacheEntry&gt; _cache;
    private const int MaxCacheSize = 10000; // æå¤ä¿ç1ä¸æ¡

    public LRUEventDeduplicator()
    {
        _cache = new LRUCache&lt;string, EventCacheEntry&gt;(MaxCacheSize);
    }

    public bool TryMarkAsProcessing(string eventId)
    {
        if (_cache.TryGetValue(eventId, out var entry))
            return true;

        _cache.Add(eventId, new EventCacheEntry { /* ... */ });
        return false;
    }
}
</code></pre>
<p>â <strong>æ¹æ¡3ï¼ä¸å¡å±ä¼å</strong></p>
<pre><code class="language-csharp">// æäºé«é¢äºä»¶ä¸éè¦å»é
public class SystemEventHandler : DefaultFeishuEventHandler
{
    // ä¸ç»§æ¿ IdempotentFeishuEventHandler
    // ç´æ¥å¤çï¼åå°ä¸å¡å±å»éåå

    protected override Task ProcessBusinessLogicAsync(EventData eventData, CancellationToken ct)
    {
        // ä»è®°å½æ¥å¿ï¼ä¸è¿è¡ä¸å¡æä½
        _logger.LogInformation("ç³»ç»äºä»¶ï¼{EventType}", eventData.EventType);
        return Task.CompletedTask;
    }
}
</code></pre>
<hr>
<h2 id="ç»ç³»ç»åä½æ£çæ§ä¸è°è¯">ç»ç³»ç»åä½æ£ï¼çæ§ä¸è°è¯</h2>
<h3 id="ééä»ä¹æ°æ®æææ">ééä»ä¹æ°æ®æææï¼</h3>
<pre><code class="language-csharp">public class DeduplicatorMetrics
{
    public long TotalProcessed { get; set; }
    public long DuplicateSkipped { get; set; }
    public long ProcessingTimeout { get; set; }
    public long CacheHitCount { get; set; }
    public long CacheMissCount { get; set; }

    public double DuplicateRate =&gt; 
        TotalProcessed &gt; 0 ? (double)DuplicateSkipped / TotalProcessed : 0;

    public double CacheHitRate =&gt;
        (CacheHitCount + CacheMissCount) &gt; 0 
            ? (double)CacheHitCount / (CacheHitCount + CacheMissCount) 
            : 0;
}
</code></pre>
<h3 id="æ´é²ä¸ä¸ªæ¥å£éæ¶æ¥çå¥åº·ç¶æ">æ´é²ä¸ä¸ªæ¥å£ï¼éæ¶æ¥çå¥åº·ç¶æ</h3>
<pre><code class="language-csharp">[ApiController]
[Route("api/[controller]")]
public class DeduplicatorController : ControllerBase
{
    private readonly IFeishuEventDeduplicator _deduplicator;

    [HttpGet("stats")]
    public ActionResult&lt;DeduplicatorStats&gt; GetStats()
    {
        return Ok(new DeduplicatorStats
        {
            CacheCount = _deduplicator.GetCacheCount(),
            MaxProcessedSeqId = _seqIdDeduplicator?.GetMaxProcessedSeqId(),
            DuplicateRate = _metrics.DuplicateRate,
            CacheHitRate = _metrics.CacheHitRate
        });
    }

    [HttpGet("check/{eventId}")]
    public ActionResult&lt;bool&gt; CheckEventId(string eventId)
    {
        var isProcessed = _deduplicator.IsProcessed(eventId);
        return Ok(new { eventId, isProcessed });
    }
}
</code></pre>
<h3 id="æ¥å¿æä¹åæå®¹æææ¥é®é¢">æ¥å¿æä¹åæå®¹æææ¥é®é¢ï¼</h3>
<pre><code class="language-csharp">public class EnhancedEventDeduplicator : IFeishuEventDeduplicator
{
    private readonly ILogger&lt;EnhancedEventDeduplicator&gt; _logger;

    public bool TryMarkAsProcessing(string eventId)
    {
        lock (_lock)
        {
            if (_eventCache.TryGetValue(eventId, out var entry))
            {
                // è¯¦ç»è®°å½å»éå½ä¸­åå 
                _logger.LogInformation(
                    "[Deduplication] EventId={EventId} å·²å¤çï¼" +
                    "Status={Status}, ProcessedAt={ProcessedAt}",
                    eventId,
                    entry.Status,
                    entry.ProcessedAt);

                return true;
            }

            _logger.LogDebug("[Deduplication] EventId={EventId} æ°äºä»¶", eventId);
            // ...
            return false;
        }
    }
}
</code></pre>
<hr>
<h2 id="å¿«éåé¡¾ä¸è¡å¨æ¸å">å¿«éåé¡¾ä¸è¡å¨æ¸å</h2>
<h3 id="ä¸å±é²æ¤ä¸è¡¨è§">ä¸å±é²æ¤ä¸è¡¨è§</h3>
<table>
<thead>
<tr>
<th>å»éå±çº§</th>
<th>å»éä¾æ®</th>
<th>å®ç°æ¹å¼</th>
<th>æ¨èéç½®</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åè®®å±</strong></td>
<td>SeqID / Nonce</td>
<td><code>IFeishuSeqIDDeduplicator</code> / <code>IFeishuNonceDistributedDeduplicator</code></td>
<td>å§ç»å¯ç¨</td>
</tr>
<tr>
<td><strong>ååå±</strong></td>
<td>EventId</td>
<td><code>IFeishuEventDeduplicator</code> / <code>IFeishuEventDistributedDeduplicator</code></td>
<td>çäº§ç¯å¢å¯ç¨ Redis</td>
</tr>
<tr>
<td><strong>åºç¨å±</strong></td>
<td>æ°æ®å­å¨æ§æ£æ¥</td>
<td><code>DefaultFeishuObjectEventHandler&lt;T&gt;</code> ä¸­çä¸å¡é»è¾</td>
<td>æéå®ç°</td>
</tr>
</tbody>
</table>
<h3 id="è¿æ³äºè§£æ´å¤">è¿æ³äºè§£æ´å¤ï¼</h3>
<ul>
<li>ð <a href="https://open.feishu.cn/document/server-docs/event-subscription-guide/overview" target="_blank" rel="noopener nofollow">é£ä¹¦å®æ¹ææ¡£ï¼äºä»¶è®¢é</a></li>
<li>ð» <a href="https://github.com/mudtools/MudFeishu" target="_blank" rel="noopener nofollow">MudFeishu GitHub ä»åº</a></li>
<li>ð» <a href="https://gitee.com/mudtools/MudFeishu" target="_blank" rel="noopener nofollow">MudFeishu Gitee ä»åº</a></li>
<li>ð <a href="https://redis.io/topics/distlock" target="_blank" rel="noopener nofollow">Redis åå¸å¼éæä½³å®è·µ</a></li>
</ul>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-11 23:01">2026-01-11 23:00</span>&nbsp;
<a href="https://www.cnblogs.com/mudtools">ç©æ³¥å·´ç|mudtools.cn</a>&nbsp;
éè¯»(<span id="post_view_count">263</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19469184);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19469184', targetLink: 'https://www.cnblogs.com/mudtools/p/19469184', title: 'é£ä¹¦ .NET SDK äºä»¶å¤ççå¹ç­æ§ä¸å»éæºå¶' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ è¿­ä»£å¨ iterationãiter ä¸ å¤çº¿ç¨ concurrent äº¤åå®è·µï¼è¯¦ç»ï¼ ]]></title>
    <link>https://www.cnblogs.com/io-T-T/p/19469168</link>
    <guid>08d1454274b5d027d19b58b804bc2aeb</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/io-T-T/p/19469168" title="åå¸äº 2026-01-11 22:52">
    <span role="heading" aria-level="2">è¿­ä»£å¨ iterationãiter ä¸ å¤çº¿ç¨ concurrent äº¤åå®è·µï¼è¯¦ç»ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        è¿­ä»£å¨ å¤çº¿ç¨ concurrent iter python
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="è¿­ä»£å¨iterationiter-ä¸-å¤çº¿ç¨-concurrent-äº¤åå®è·µè¯¦ç»">è¿­ä»£å¨<code>iteration</code>ã<code>iter</code> ä¸ å¤çº¿ç¨ <code>concurrent</code> äº¤åå®è·µï¼è¯¦ç»ï¼</h2>
<h3 id="å®è·µåç®ä»è¯´æ">å®è·µåç®ä»è¯´æ</h3>
<p>â	ç±äºå¨å®éè¿ç¨éï¼è¿­ä»£å¨ï¼æçæå¨ï¼ç»å¸¸ä¸å¤çº¿ç¨ä¸å¹¶ä½¿ç¨ãæ¬å®è·µæ¨å¨å¯¹è¿­ä»£å¨ï¼åçæå¨ï¼ãå¤çº¿ç¨åºï¼ä¸»è¦ä¸º<code>concurrent</code>ï¼è¿è¡äº¤åå®è·µè¯´æï¼ç¨æ¥ä½¿è¯»èæ´å çè§£è¿­ä»£å¨åå¤çº¿ç¨å¨å®éçåºç¨ãå æ­¤æ¬ç¯è½»æç¨ï¼éå®è·µï¼å½ç¶ä¹ä¼ç®è¦è¯´æç¸å³ç¥è¯ã</p>
<h3 id="åºç¡ç¥è¯ç¸å³ä»ç»ç®è¦">åºç¡ç¥è¯ç¸å³ä»ç»ï¼ç®è¦ï¼</h3>
<blockquote>
<p>è¯¦ç»ä»ç»å»ºè®®è§ç<a href="https://space.bilibili.com/1318868/?spm_id_from=333.788.upinfo.detail.click" target="_blank" rel="noopener nofollow">Hucciåä»£ç </a>åä¸»æçåºç¡ç¥è¯ï¼è¯¦ç»ææ</p>
<p><a href="https://www.bilibili.com/video/BV1jt421c7yN" target="_blank" rel="noopener nofollow">ãPythonãä»è¿­ä»£å¨å°çæå¨ï¼å°åå­ä¹è½å¤çå¤§æ°æ®</a></p>
<p><a href="https://www.bilibili.com/video/BV1tVsyzUEtX/?" target="_blank" rel="noopener nofollow">å¨Pythonä¸­ç¨å¤çº¿ç¨ä¹åï¼éè¦åææè¿äº</a></p>
</blockquote>
<h3 id="ä½ ä¸ºä»ä¹éè¦å­¦ä¹ è¿­ä»£å¨å¤çº¿ç¨">ä½ ä¸ºä»ä¹éè¦å­¦ä¹ è¿­ä»£å¨ãå¤çº¿ç¨</h3>
<p>å­¦è¿ä¸ªæç¨/å®è·µä¹åï¼ä½ éè¦åççèªå·±ææ²¡æè¿ä¸ªéæ±ï¼å½ç¶ä½ æå´è¶£ä¹å¯ä»¥å­¦ã</p>
<h4 id="è¿­ä»£å¨çæå¨çä¼å£">è¿­ä»£å¨ï¼çæå¨ï¼çä¼å£</h4>
<p><strong>ä¼å¿ï¼</strong></p>
<ul>
<li>ä½¿ç¨æ¶çææ°æ®ï¼ç¼è§£çç¼å­é®é¢ï¼RAMãGRAMï¼ãä¸»è¦ã</li>
<li>ç»ä¸æ åæ¥å£ï¼æ éå³ç³»æ°æ®çæ°æ®ç»æè°ç¨é®é¢ï¼ä½¿ç¨ <code>for _iter in iteration</code> å³å¯è°ç¨</li>
</ul>
<p><strong>å£å¿ï¼</strong></p>
<ul>
<li>åæ¬¡ä½¿ç¨</li>
<li>ä¸æ¯æç´¢å¼</li>
<li>ååéåï¼ååï¼</li>
</ul>
<h4 id="å¤çº¿ç¨çä¼å£pythonéå®">å¤çº¿ç¨çä¼å£ï¼Pythonéå®ï¼</h4>
<p><strong>ä¼å¿</strong>ï¼</p>
<ul>
<li>å¹¶è¡æ§è¡ï¼æé«CPUçä½¿ç¨ç</li>
<li>ååå©ç¨I/Oçä¸­æ­æ¶é´ï¼ä»èæé«ä»£ç çæ§è¡éåº¦</li>
</ul>
<p><strong>å£å¿ï¼</strong></p>
<ul>
<li>è°è¯é¾åº¦å¤§</li>
<li>èçæ¬ï¼å¥½åæ¯3.12ä¹åï¼ï¼åªæä¸ä¸ªGILéï¼å¯¼è´è¿ç¨ä¼åºç°æ¢å ç°è±¡ã</li>
<li>å°æ°æ®éå¸¦æ¥çæåå¯è½è¾å°</li>
</ul>
<h3 id="01-ç¯å¢æ¥æºæ°æ®">01-ç¯å¢æ¥æºæ°æ®</h3>
<p>æç¨çæ¯<code>kaggle</code>çå¼æºæ°æ®ï¼ç±äºå¾å¤é½æ¯<code>csv</code>ç±»åï¼å æ­¤æä¹ä»¥ç®åç<code>csv</code>æ°æ®éå¤çº¿ç¨è¯»åè¿è¡è¯´æï¼ä½ ä»¬ä¹å¯ä»¥ç¨å¶ä»æ°æ®éï¼æå¥½ææ¬è¡é¿åº¦&gt;5k, æè½å±ç°å¤çº¿ç¨ãè¿­ä»£å¨çä¼å¿ï¼æ°éçº§ä½è¿æ¯ç¨åçº¿ç¨ãä¸²è¡å§ï¼å®¹æçè§£å¥½ç»´æ¤ã</p>
<blockquote>
<p><a href="https://www.kaggle.com/datasets/dansbecker/powerlifting-database/data" target="_blank" rel="noopener nofollow">powerlifting-database</a></p>
</blockquote>
<h3 id="02-ä»»å¡ä»ç»åç¼ç æè·¯">02-ä»»å¡ä»ç»åç¼ç æè·¯</h3>
<p>ç©ºæç¼ç è½åï¼ä½æ¯æ²¡æç¼ç æè·¯æ¯å¤§å¿å§ãå æ­¤åæ¦è¿°ä»»å¡åç¼ç æè·¯ã</p>
<h4 id="21-ä»»å¡">2.1 ä»»å¡</h4>
<p>æ¬æ¬¡å®è·µï¼ä»»å¡æä»¥ä¸å ç¹ï¼</p>
<ol>
<li>äºè§£å¹¶æé è¿­ä»£å¨ç±»</li>
<li>ä½¿ç¨è¿­ä»£å¨ç±»å¯¹æ°æ®éï¼<strong>csvæ°æ®</strong>ï¼è¿è¡æ°æ®åå</li>
<li>ä½¿ç¨å¤çº¿ç¨åºï¼<code>concurrent</code>ï¼æ¥æ¨¡æå¤çº¿ç¨å¤çæ°æ®ã</li>
</ol>
<h4 id="22-ç¼ç æè·¯">2.2 ç¼ç æè·¯</h4>
<p>æ³è¦è¾¾æå¤çº¿ç¨ä¸è¿­ä»£å¨çç»åï¼é¦åéè¦æé åéçæ°æ®ï¼å æ­¤éè¦ï¼</p>
<ol>
<li>æå»ºè¿­ä»£å¨ç±»ï¼æ¡æ¶ï¼</li>
</ol>
<p>ç¶åéè¦å°æ°æ®éå¯¼å¥è¿æ¥ï¼å®åè¿­ä»£å¨ç±»ï¼è¿éè¦å¯¹è¾å¥çæ°æ®åä¸ä¸ååï¼æ¹ä¾¿åç»­ä½¿ç¨ï¼</p>
<ol start="2">
<li>æ°æ®å¯¼å¥+åå+å®åè¿­ä»£å¨ç±»</li>
</ol>
<p>æ°æ®æ¥æºè§£å³äºï¼ä¹ååäºï¼æ¥ä¸æ¥æ¯å°æ°æ®ä¸å¤çº¿ç¨èå¨äº</p>
<ol start="3">
<li>å¼å¥å¤çº¿ç¨åºï¼å¤çååçæ°æ®ã</li>
</ol>
<h3 id="03-æå»ºè¿­ä»£å¨ç±»">03 æå»ºè¿­ä»£å¨ç±»</h3>
<h4 id="31è¿­ä»£å¨çæå°æ¡æ¶">3.1è¿­ä»£å¨çæå°æ¡æ¶</h4>
<blockquote>
<p>å¯åè <a href="https://www.cnblogs.com/Ravenna/p/15676404.html" target="_blank">pythonè¿­ä»£å¨ç®åçè§£ __iter__å__next__æ¹æ³</a></p>
</blockquote>
<p>â	æä¸ºä¸ä¸ªæå°è¿­ä»£å¨ç±»éå¸¸éè¦åå«ä»¥ä¸å ä¸ªç±»æ¥å£ï¼</p>
<img alt="image-20260111171210573" style="zoom: 80%" data-src="https://img2024.cnblogs.com/blog/3244923/202601/3244923-20260111225210796-336730096.png" class="lazyload">
<ol>
<li><code>__init__</code>ï¼ç±»åå§åæ¥å£</li>
<li><code>__iter__</code>: è·åè¿­ä»£å¯¹è±¡çæ¥å£</li>
<li><code>__next__</code>ï¼æ°æ®è¿­ä»£æ¥å£ã</li>
</ol>
<h4 id="32--æå»ºè¿­ä»£å¨ç±»">3.2  æå»ºè¿­ä»£å¨ç±»</h4>
<p>ä¸ºäºç§é¡¾æ´å¤çè¯»èï¼æè¿éä½¿ç¨ä¼ ç»æ¥å£å¯¹<code>csv</code>è¿è¡è¯»åï¼æ<code>panda</code>è½åçè¯»èå¯ä»¥ä½¿ç¨<code>pd</code>å¿«æ·è¯»åå¹¶æé ã</p>
<pre><code class="language-python">class read_file_batch:
    def __init__(self,file_path:str, batch_size:int):
        self.file_fp = open(file_path, encoding='utf-8', mode='r+')
        self.batch_size = batch_size
    def __iter__(self):
        return self					#è¿åè¿ä¸ªè¿­ä»£å¨æ¬èº«ï¼æä»¬æ¯ä»¥ç±»ä½ä¸ºè¿­ä»£å¯¹è±¡ï¼å æ­¤è¿åä»èªå·±å§
    def __next__(self):				#æ°æ®åå
        batch_res = []
        for i in range(self.batch_size):	
            line = self.file_fp.readline()	#æåºå±è·åè¡æ°æ®çäº¤äºæ¥å£
            if line:                        #å¦æè¡éç©º
                batch_res.append(line)
            else:                           #è¯»å°æåå°±ç®ç©ºçäº
                self.file_fp.close()
                raise StopIteration

        return batch_res
</code></pre>
<ul>
<li>
<p>è°ç¨å°è¯ï¼</p>
<p>å¯ä»¥è°è¯ä¸ä¸ï¼æåä¸ä¸åæ¹çè¿­ä»£åæ°æ®çè¾å¥è¾åºã</p>
<pre><code class="language-python">if __name__ == '__main__':
    your_file_path:str = r"E:\powerlifting-database\openpowerlifting.csv"
    iteration = read_file_batch(your_file_path, batch_size=1000)
    count = 0
    for lines in iteration:
        print('-'*50+f"count:{count}"+'-'*50)
        count += 1
        print(lines)
</code></pre>
</li>
</ul>
<h3 id="04-å¼å¥å¤çº¿ç¨å¤çæ¹éæ°æ®">04 å¼å¥å¤çº¿ç¨å¤çæ¹éæ°æ®</h3>
<h4 id="41-å¤çº¿ç¨åæ³">4.1 å¤çº¿ç¨åæ³</h4>
<p>å¶å®è®ç®åçï¼åªè¦ææ¥å£å½æ°åå¥½ãæ°æ®å¤çä¸ä¸ï¼å°±è¡äºã</p>
<ol>
<li>
<p>å¯¼å¥åºï¼</p>
<pre><code class="language-python">from concurrent.futures import ThreadPoolExecutor as Excecutor
</code></pre>
</li>
<li>
<p>ä½¿ç¨ä¸ä¸æç®¡çå·¥å·ç®¡ççº¿ç¨ï¼ç¡®ä¿å®å¨åéæ¾ï¼ï¼</p>
<pre><code class="language-python">with Excecutor(max_workers=8) as executor:
</code></pre>
</li>
<li>
<p>ä½¿ç¨mapæ¥å£è¿è¡å¤çº¿ç¨æä»¤æ§è¡ï¼</p>
<pre><code class="language-python">executor.map(
    fn= function, iter_element1, iter_element2, iter_element3
)#functionæ¯ä½ å¯¹åºçå½æ°åï¼ iter_element1-3æ¯å½æ°ä¾èµçè¾å¥æ°æ®
</code></pre>
</li>
<li>
<p>æ±æ»ï¼</p>
<pre><code class="language-python">from concurrent.futures import ThreadPoolExecutor as Excecutor
with Excecutor(max_workers=8) as executor:
	executor.map(
    fn= function, iter_element1, iter_element2, iter_element3
)#functionæ¯ä½ å¯¹åºçå½æ°åï¼ iter_element1-3æ¯å½æ°ä¾èµçè¾å¥æ°æ®
</code></pre>
</li>
</ol>
<h4 id="42-å¼å¥å¤çº¿ç¨å¤çæ°æ®">4.2 å¼å¥å¤çº¿ç¨å¤çæ°æ®</h4>
<ol>
<li>
<p>é¦åï¼æ¨¡æä¸ä¸ªå¤çè¡æ°æ®çå½æ°ç¨æ·å¤çè¡ä¿¡æ¯ï¼</p>
<pre><code class="language-python">def process_dealing(line:str):
    '''
    æ¨¡æå¤çæä¸è¡çæ°æ®
    :param line:å¤çæ¯ä¸è¡
    '''
    print(f'line top 20 info is :{line[:20]}')
    pass
</code></pre>
</li>
<li>
<p>å¨è¿­ä»£å¨çè¿­ä»£è¿ç¨ä¸­å¯¹æ°æ®è¿è¡å¤çã</p>
<pre><code class="language-python">if __name__ == '__main__':
    your_file_path:str = r"E:\powerlifting-database\openpowerlifting.csv"
    iteration = read_file_batch(your_file_path, batch_size=1000)
    count = 0
    with Excecutor(max_workers=8) as executor:

        for lines in iteration:
            print('-'*50+f"count:{count}"+'-'*50)
            count += 1
            print(lines)
            executor.map(process_dealing, lines)
            #ç¬¬ä¸ä¸ªåæ°æ¯å¤ççå½æ°ï¼åé¢æ¯*iteration å°±æ¯ä½ å½æ°ä¾èµçåæ°çå¯è¿­ä»£å¯¹è±¡ï¼è¿éå°±æ¯æ¾å¥list[str]
</code></pre>
</li>
<li>
<p>ç»æäºï¼æ ¹æ®ä½ çéè¦å¯ä»¥å¯¹æ°æ®è¿è¡å¤çäºï¼å¶å®æé¾çæ­¥éª¤å¨äºå¦ä½æé è¿­ä»£å¨ï¼çæå¨ï¼ï¼å¤çº¿ç¨å¶å®ä¿©æ­¥å°±èµ°å®äºã</p>
</li>
</ol>
<h3 id="05-éå¿é¡»ä½¿ç¨è¿­ä»£å¨å¤çº¿ç¨ååå¯¹æ¯">05 ï¼éå¿é¡»ï¼ä½¿ç¨è¿­ä»£å¨ãå¤çº¿ç¨ååå¯¹æ¯</h3>
<pre><code class="language-python">from concurrent.futures import ThreadPoolExecutor as Excecutor
import time
import tracemalloc  #è·è¸ªåå­æ¥å£ï¼åç½®

def process_dealing(line:str):
    '''
    æ¨¡æå¤çæä¸è¡çæ°æ®
    :param line:å¤çæ¯ä¸è¡
    '''
    # print(f'line top 20 info is :{line[:20]}')
    pass

class read_file_batch:
    def __init__(self,file_path:str, batch_size:int):
        self.file_fp = open(file_path, encoding='utf-8', mode='r+')
        self.batch_size = batch_size
    def __iter__(self):
        return self
    def __next__(self):                     #æ°æ®åå,å¯¹è¿­ä»£å¨è¿è¡è¿­ä»£ï¼å®éä¸æ¯è·åä»çnextï¼å æ­¤å¨è¿éååæ°æ®
        batch_res = []
        for i in range(self.batch_size):    #åbatchä¸ª
            line = self.file_fp.readline()
            if line:                        #å¦æè¡éç©º
                batch_res.append(line)
            else:                           #è¯»å°æåå°±ç®ç©ºçäº
                self.file_fp.close()
                raise StopIteration

        return batch_res                    #è¿åè¿­ä»£æ°æ®

def main_concurrent(file_path,batch_size:int):
    start_malloc = tracemalloc.start()
    start_time = time.time()
    your_file_path:str = file_path
    iteration = read_file_batch(your_file_path, batch_size=batch_size)
    count = 0
    with Excecutor(max_workers=8) as executor:

        for lines in iteration:                         #è¿åæ¯batchè¡,æ¯ä¸è¡æ¯ä¸ä¸ªå¤§çstr
            print('-'*50+f"count:{count}"+'-'*50+f"RAM cost:{round(tracemalloc.get_tracemalloc_memory() / 1024**2,4)} M")
            count += 1
            print(lines[:50])                           #èçº¦æ¶é´ï¼åªåå50å­ç¬¦
            executor.map(process_dealing, lines)
            #ç¬¬ä¸ä¸ªåæ°æ¯å¤ççå½æ°ï¼åé¢æ¯*iteration å°±æ¯ä½ å½æ°ä¾èµçåæ°çå¯è¿­ä»£å¯¹è±¡ï¼è¿éå°±æ¯æ¾å¥list[str]
    print(f'spend time:{round(time.time()-start_time,4)}')

def main_not_concurrent(file_path,batch_size:int=1000):

    start_time = time.time()
    start_trace = tracemalloc.start()

    with open(file=file_path,encoding='utf-8',mode='r+') as fp:
        data = fp.readlines()
        for idx,line in enumerate(data):
            if idx % batch_size == 0:
                print('-'*50 +str(idx)+'-'*50+f"RAM cost:{round(tracemalloc.get_tracemalloc_memory() / 1024**2,4)} M")
                print(line[:50])
                process_dealing(line)
    print(f'spend time:{round(time.time()-start_time,4)}')


if __name__ == '__main__':
    file_path = r'E:\openpowerlifting.csv'
    batch_size = 1000
    main_concurrent(file_path,batch_size)
    # main_not_concurrent(file_path,batch_size)
    # å¶å®è½çåºæ¥è¿ç§æ°æ®éè¿æ¯ç´æ¥ç¼å­å¨åå­æ¯è¾å¥½ï¼ä½ä½¿ç¨å¤çº¿ç¨+è¿­ä»£å¨ç¡®å®åå°äºå¾å¤åå­
</code></pre>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-11 22:53">2026-01-11 22:52</span>&nbsp;
<a href="https://www.cnblogs.com/io-T-T">io_T_T</a>&nbsp;
éè¯»(<span id="post_view_count">101</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19469168);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19469168', targetLink: 'https://www.cnblogs.com/io-T-T/p/19469168', title: 'è¿­ä»£å¨ iterationãiter ä¸ å¤çº¿ç¨ concurrent äº¤åå®è·µï¼è¯¦ç»ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ä¸ªé«æ§è½ç .NET MQTT å®¢æ·ç«¯ä¸æå¡å¨åº ]]></title>
    <link>https://www.cnblogs.com/dotnet-org-cn/p/19473369</link>
    <guid>e9a6986562805d8ffd903be9417ec8a4</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/dotnet-org-cn/p/19473369" title="åå¸äº 2026-01-12 18:10">
    <span role="heading" aria-level="2">ä¸ä¸ªé«æ§è½ç .NET MQTT å®¢æ·ç«¯ä¸æå¡å¨åº</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="åè¨">åè¨</h2>
<p>å¨ç©èç½ï¼IoTï¼è¬ååå±çä»å¤©ï¼MQTT åè®®å·²ç»æä¸ºè®¾å¤éä¿¡çäºå®æ åãæ è®ºæ¯æºè½å®¶å±ãå·¥ä¸èªå¨åè¿æ¯è½¦èç½ï¼MQTT é½æ®æ¼çè³å³éè¦çè§è²ãä»å¤©ï¼æè¦ä¸ºå¤§å®¶ä»ç»ä¸ä¸ªå®å¨ä½¿ç¨ C# å®ç°çé«æ§è½ MQTT åº</p>
<p>è¿ä¸ªåºä¸ä»æä¾äºå®æ´ç MQTT å®¢æ·ç«¯å®ç°ï¼è¿åå«äºä¸ä¸ªåè½é½å¨ç Broker æå¡å¨ï¼æ¯ææ¡¥æ¥ãéç¾¤ç­ä¼ä¸çº§ç¹æ§ã</p>
<h2 id="æ ¸å¿ç¹æ§">æ ¸å¿ç¹æ§</h2>
<h3 id="åè®®æ¯æ">åè®®æ¯æ</h3>
<ul>
<li><strong>MQTT 3.1.1</strong> - å®æ´æ¯æ</li>
<li><strong>MQTT 5.0</strong> - å®æ´æ¯æï¼åæ¬ç¨æ·å±æ§ãæ¶æ¯è¿æãä¸»é¢å«åç­æ°ç¹æ§ï¼</li>
<li><strong>MQTT-SN</strong> - åºäº UDP çè½»éçº§ MQTT åä½ï¼éååéè®¾å¤</li>
<li><strong>CoAP</strong> - çº¦æåºç¨åè®®ç½å³æ¯æ</li>
</ul>
<h3 id="æ§è½ç¹æ§">æ§è½ç¹æ§</h3>
<ul>
<li>é«æ§è½å¼æ­¥å®ç°</li>
<li>é¶ä¸å¿è¦çåå­åé</li>
<li>ç¼å²åºæ± ææ¯</li>
<li>æ¯æ 10000+ å¹¶åè¿æ¥</li>
</ul>
<h3 id="ä¼ä¸çº§åè½">ä¼ä¸çº§åè½</h3>
<ul>
<li>Broker æ¡¥æ¥ï¼å¤ Broker æ¶æ¯åæ­¥ï¼</li>
<li>éç¾¤æ¯æï¼å»ä¸­å¿å P2P æ¶æï¼</li>
<li>çµæ´»çè®¤è¯ä¸æææºå¶</li>
<li>TLS/SSL å å¯ä¼ è¾</li>
<li>æä¹ä¼è¯ä¸ç¦»çº¿æ¶æ¯å­å¨</li>
</ul>
<h3 id="æ¡æ¶æ¯æ">æ¡æ¶æ¯æ</h3>
<ul>
<li>.NET 6.0</li>
<li>.NET 8.0</li>
<li>.NET 10.0</li>
</ul>
<hr>
<h2 id="ææ¯å®ç°">ææ¯å®ç°</h2>
<p>æ¬é¡¹ç®éç¨äºå¤§éç°ä»£ .NET é«æ§è½ææ¯ï¼ä¸é¢è¯¦ç»ä»ç»æ ¸å¿ææ¯ç¹ã</p>
<h3 id="åå­ç®¡çææ¯">åå­ç®¡çææ¯</h3>
<h4 id="spant-å-memoryt---é¶æ·è´å¤ç">Span&lt;T&gt; å Memory&lt;T&gt; - é¶æ·è´å¤ç</h4>
<p>é¡¹ç®ä½¿ç¨ <code>ref struct</code> å®ç°çäºè¿å¶è¯»åå¨ï¼å®å¨å¨æ ä¸åéï¼é¿åå åå­ååï¼</p>
<pre><code class="language-csharp">// é¶æ·è´çäºè¿å¶è¯»åå¨
public ref struct MqttBinaryReader
{
    private readonly ReadOnlySpan&lt;byte&gt; _buffer;
    private int _position;

    // é¶æ·è´åçæä½
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public ReadOnlySpan&lt;byte&gt; ReadBytes(int count)
    {
        var span = _buffer.Slice(_position, count);
        _position += count;
        return span;
    }
}
</code></pre>
<p><strong>ææ¯ä¼å¿</strong>ï¼</p>
<ul>
<li><code>ref struct</code> åªè½å¨æ ä¸åéï¼æ  GC åå</li>
<li><code>ReadOnlySpan&lt;byte&gt;</code> æ¯æé¶æ·è´åç</li>
<li>é¿åå¤§éå­èæ°ç»å¤å¶æä½</li>
</ul>
<h4 id="arraypoolt---ç¼å²åºå¤ç¨">ArrayPool&lt;T&gt; - ç¼å²åºå¤ç¨</h4>
<p>ä½¿ç¨å±äº«åå­æ± åå°é¢ç¹çåå­åéï¼</p>
<pre><code class="language-csharp">// ä»å±äº«æ± ç§åç¼å²åº
var buffer = ArrayPool&lt;byte&gt;.Shared.Rent(1024);
try
{
    await stream.ReadAsync(buffer.AsMemory(0, length), cancellationToken);
    // å¤çæ°æ®...
}
finally
{
    ArrayPool&lt;byte&gt;.Shared.Return(buffer);  // å½è¿ç¼å²åº
}
</code></pre>
<h4 id="stackalloc---å°ç¼å²åºæ åé">stackalloc - å°ç¼å²åºæ åé</h4>
<p>å¯¹äºå°åä¸´æ¶ç¼å²åºï¼ç´æ¥å¨æ ä¸åéï¼</p>
<pre><code class="language-csharp">// 4 å­èçå¯åé¿åº¦ç¼ç ç¼å²åºï¼æ åé
Span&lt;byte&gt; remainingLengthBytes = stackalloc byte[4];
var size = EncodeRemainingLength(length, remainingLengthBytes);
</code></pre>
<h3 id="å¼æ­¥ç¼ç¨æ¨¡å">å¼æ­¥ç¼ç¨æ¨¡å</h3>
<h4 id="asyncawait--configureawait">async/await + ConfigureAwait</h4>
<p>ææ IO æä½åéç¨å¼æ­¥æ¨¡å¼ï¼å¹¶ä½¿ç¨ <code>ConfigureAwait(false)</code> ä¼åï¼</p>
<pre><code class="language-csharp">public async Task&lt;MqttConnectResult&gt; ConnectAsync(CancellationToken cancellationToken = default)
{
    // å»ºç« TCP è¿æ¥
    await _tcpClient.ConnectAsync(host, port, cancellationToken).ConfigureAwait(false);

    // TLS æ¡æ
    if (Options.UseTls)
    {
        await sslStream.AuthenticateAsClientAsync(sslOptions, cancellationToken).ConfigureAwait(false);
    }

    // åé CONNECT æ¥æ
    await SendPacketAsync(connectPacket, cancellationToken).ConfigureAwait(false);
}
</code></pre>
<h4 id="channelt---é«æ§è½äºä»¶éå">Channel&lt;T&gt; - é«æ§è½äºä»¶éå</h4>
<p>Broker ä½¿ç¨æçééå®ç°éé»å¡çäºä»¶ååï¼</p>
<pre><code class="language-csharp">public sealed class MqttBrokerEventDispatcher
{
    private readonly Channel&lt;BrokerEvent&gt; _eventChannel;

    public MqttBrokerEventDispatcher(int capacity = 10000)
    {
        // æçééï¼éåæ»¡æ¶ä¸¢å¼ææ§äºä»¶
        _eventChannel = Channel.CreateBounded&lt;BrokerEvent&gt;(new BoundedChannelOptions(capacity)
        {
            FullMode = BoundedChannelFullMode.DropOldest,
            SingleReader = true,
            SingleWriter = false
        });
    }

    // éé»å¡äºä»¶åé
    public void Dispatch&lt;TEventArgs&gt;(BrokerEventType type, TEventArgs args, EventHandler&lt;TEventArgs&gt;? handler)
    {
        _eventChannel.Writer.TryWrite(new BrokerEvent(type, args, handler));
    }
}
</code></pre>
<h4 id="taskcompletionsource---è¯·æ±ååºæ¨¡å¼">TaskCompletionSource - è¯·æ±/ååºæ¨¡å¼</h4>
<p>å®ç° QoS 1/2 çç¡®è®¤ç­å¾æºå¶ï¼</p>
<pre><code class="language-csharp">private readonly Dictionary&lt;ushort, TaskCompletionSource&lt;object?&gt;&gt; _pendingPackets = new();

private async Task&lt;object?&gt; WaitForPacketAsync(ushort packetId, CancellationToken cancellationToken)
{
    var tcs = new TaskCompletionSource&lt;object?&gt;(TaskCreationOptions.RunContinuationsAsynchronously);
    _pendingPackets[packetId] = tcs;

    using var cts = CancellationTokenSource.CreateLinkedTokenSource(cancellationToken);
    cts.CancelAfter(TimeSpan.FromSeconds(30));  // 30 ç§è¶æ¶

    using var registration = cts.Token.Register(() =&gt; tcs.TrySetCanceled());
    return await tcs.Task.ConfigureAwait(false);
}
</code></pre>
<h4 id="semaphoreslim---åéåæ­¥">SemaphoreSlim - åéåæ­¥</h4>
<p>ç¡®ä¿æ¥æåéçä¸²è¡åï¼</p>
<pre><code class="language-csharp">private readonly SemaphoreSlim _sendLock = new(1, 1);

private async Task SendPacketBytesAsync(byte[] packet, CancellationToken cancellationToken)
{
    await _sendLock.WaitAsync(cancellationToken).ConfigureAwait(false);
    try
    {
        await _stream.WriteAsync(packet.AsMemory(), cancellationToken).ConfigureAwait(false);
        await _stream.FlushAsync(cancellationToken).ConfigureAwait(false);
    }
    finally
    {
        _sendLock.Release();
    }
}
</code></pre>
<h3 id="ç¼è¯å¨ä¼å">ç¼è¯å¨ä¼å</h3>
<h4 id="methodimpl-ç¹æ§">MethodImpl ç¹æ§</h4>
<p>éå¯¹ä¸ååºæ¯ä½¿ç¨åéçç¼è¯å¨ä¼åæä»¤ï¼</p>
<pre><code class="language-csharp">// å¼ºå¶åè - ç¨äºé¢ç¹è°ç¨çç­æ¹æ³
[MethodImpl(MethodImplOptions.AggressiveInlining)]
public ushort ReadUInt16()
{
    var value = (ushort)((_buffer[_position] &lt;&lt; 8) | _buffer[_position + 1]);
    _position += 2;
    return value;
}

// æç§¯æçä¼å - ç¨äºç­è·¯å¾
[MethodImpl(MethodImplOptions.AggressiveOptimization)]
private static async Task&lt;int&gt; DecodeRemainingLengthAsync(Stream stream, CancellationToken ct)
{
    // å¯åé¿åº¦è§£ç å®ç°...
}

// ç¦æ­¢åè - é¿åå¼å¸¸å¤çä»£ç è¨èç­è·¯å¾
[MethodImpl(MethodImplOptions.NoInlining)]
private void ThrowIfDisposed()
{
    if (_disposed) throw new ObjectDisposedException(nameof(MqttClient));
}
</code></pre>
<h3 id="ç½ç»ç¼ç¨">ç½ç»ç¼ç¨</h3>
<h4 id="å¤å±ä¼ è¾æ½è±¡">å¤å±ä¼ è¾æ½è±¡</h4>
<p>æ¯æ TCPãUDP ç­å¤ç§ä¼ è¾æ¹å¼ï¼</p>
<pre><code class="language-csharp">public interface ITransportConnection : IAsyncDisposable
{
    string ConnectionId { get; }
    TransportType TransportType { get; }
    EndPoint? RemoteEndPoint { get; }
    bool IsConnected { get; }

    ValueTask&lt;int&gt; ReadAsync(Memory&lt;byte&gt; buffer, CancellationToken cancellationToken = default);
    ValueTask WriteAsync(ReadOnlyMemory&lt;byte&gt; buffer, CancellationToken cancellationToken = default);
    ValueTask FlushAsync(CancellationToken cancellationToken = default);
}
</code></pre>
<h4 id="tlsssl-æ¯æ">TLS/SSL æ¯æ</h4>
<p>ä½¿ç¨ SslStream å®ç°å å¯ä¼ è¾ï¼æ¯æ TLS 1.2 å TLS 1.3ï¼</p>
<pre><code class="language-csharp">var sslOptions = new SslClientAuthenticationOptions
{
    TargetHost = Options.Host,
    EnabledSslProtocols = SslProtocols.Tls12 | SslProtocols.Tls13,
    ClientCertificates = Options.ClientCertificate != null
        ? new X509CertificateCollection { Options.ClientCertificate }
        : null
};

await sslStream.AuthenticateAsClientAsync(sslOptions, cancellationToken);
</code></pre>
<h3 id="åè®®åºåå">åè®®åºåå</h3>
<h4 id="å·¥åæ¨¡å¼--å»¶è¿åå§å">å·¥åæ¨¡å¼ + å»¶è¿åå§å</h4>
<p>åè®®å¤çå¨éç¨åä¾ + å»¶è¿åå§åæ¨¡å¼ï¼</p>
<pre><code class="language-csharp">public static class MqttProtocolHandlerFactory
{
    private static readonly Lazy&lt;IMqttProtocolHandler&gt; _v311Handler =
        new(() =&gt; new V311ProtocolHandler());
    private static readonly Lazy&lt;IMqttProtocolHandler&gt; _v500Handler =
        new(() =&gt; new V500ProtocolHandler());

    public static IMqttProtocolHandler GetHandler(MqttProtocolVersion version)
    {
        return version switch
        {
            MqttProtocolVersion.V311 =&gt; _v311Handler.Value,
            MqttProtocolVersion.V500 =&gt; _v500Handler.Value,
            _ =&gt; throw new NotSupportedException()
        };
    }
}
</code></pre>
<h4 id="å¯åé¿åº¦æ´æ°ç¼ç ">å¯åé¿åº¦æ´æ°ç¼ç </h4>
<p>MQTT åè®®ç¹æçå¯åé¿åº¦ç¼ç ï¼1-4 å­èå¯è¡¨ç¤º 0 å° 268,435,455ï¼</p>
<pre><code class="language-csharp">public uint ReadVariableByteInteger()
{
    uint value = 0;
    int multiplier = 1;
    byte encodedByte;

    do
    {
        encodedByte = _buffer[_position++];
        value += (uint)((encodedByte &amp; 0x7F) * multiplier);
        multiplier *= 128;
    } while ((encodedByte &amp; 0x80) != 0);

    return value;
}
</code></pre>
<h3 id="å¹¶åæ°æ®ç»æ">å¹¶åæ°æ®ç»æ</h3>
<h4 id="concurrentdictionary---çº¿ç¨å®å¨éå">ConcurrentDictionary - çº¿ç¨å®å¨éå</h4>
<p>ç¨äºç®¡çå®¢æ·ç«¯ä¼è¯åè®¢éï¼</p>
<pre><code class="language-csharp">private readonly ConcurrentDictionary&lt;string, MqttClientSession&gt; _sessions = new();
private readonly ConcurrentDictionary&lt;string, MqttApplicationMessage&gt; _retainedMessages = new();

public int ConnectedClients =&gt; _sessions.Count;
public IEnumerable&lt;MqttClientSession&gt; Sessions =&gt; _sessions.Values;
</code></pre>
<h3 id="è®¾è®¡æ¨¡å¼åºç¨">è®¾è®¡æ¨¡å¼åºç¨</h3>
<table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>åºç¨åºæ¯</th>
<th>ç¤ºä¾</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å·¥åæ¨¡å¼</strong></td>
<td>åè®®å¤çå¨åå»º</td>
<td><code>MqttProtocolHandlerFactory</code></td>
</tr>
<tr>
<td><strong>ç­ç¥æ¨¡å¼</strong></td>
<td>ä¸ååè®®çæ¬å®ç°</td>
<td><code>V311ProtocolHandler</code> / <code>V500ProtocolHandler</code></td>
</tr>
<tr>
<td><strong>å»ºé èæ¨¡å¼</strong></td>
<td>æ¥ææå»º</td>
<td><code>IPublishPacketBuilder</code> / <code>IConnectPacketBuilder</code></td>
</tr>
<tr>
<td><strong>è§å¯èæ¨¡å¼</strong></td>
<td>äºä»¶ç³»ç»</td>
<td><code>MessageReceived</code> / <code>ClientConnected</code></td>
</tr>
<tr>
<td><strong>è£é¥°å¨æ¨¡å¼</strong></td>
<td>ä¼ è¾å± TLS</td>
<td><code>SslStream</code> è£é¥° <code>NetworkStream</code></td>
</tr>
<tr>
<td><strong>åä¾æ¨¡å¼</strong></td>
<td>åè®®å¤çå¨ç¼å­</td>
<td>å¨å±å±äº«çå¤çå¨å®ä¾</td>
</tr>
</tbody>
</table>
<h3 id="ææ¯æ æ»ç»">ææ¯æ æ»ç»</h3>
<table>
<thead>
<tr>
<th>ç±»å«</th>
<th>ææ¯</th>
<th>ä½ç¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åå­ç®¡ç</strong></td>
<td><code>Span&lt;T&gt;</code>, <code>Memory&lt;T&gt;</code>, <code>ref struct</code>, <code>ArrayPool&lt;T&gt;</code>, <code>stackalloc</code></td>
<td>é¶æ·è´ãæ åéãç¼å²åºå¤ç¨</td>
</tr>
<tr>
<td><strong>å¼æ­¥ç¼ç¨</strong></td>
<td><code>async/await</code>, <code>Channel&lt;T&gt;</code>, <code>TaskCompletionSource</code>, <code>SemaphoreSlim</code></td>
<td>é«æå¹¶åãéé»å¡äºä»¶å¤ç</td>
</tr>
<tr>
<td><strong>ç¼è¯ä¼å</strong></td>
<td><code>AggressiveInlining</code>, <code>AggressiveOptimization</code>, <code>NoInlining</code></td>
<td>JIT ç¼è¯å¨ä¼åæç¤º</td>
</tr>
<tr>
<td><strong>ç½ç»å±</strong></td>
<td><code>TcpClient</code>, <code>TcpListener</code>, <code>SslStream</code>, ä¼ è¾æ½è±¡</td>
<td>å¤åè®®æ¯æãå®å¨ä¼ è¾</td>
</tr>
<tr>
<td><strong>å¹¶åéå</strong></td>
<td><code>ConcurrentDictionary</code>, <code>ConcurrentQueue</code></td>
<td>çº¿ç¨å®å¨çæ°æ®ç»æ</td>
</tr>
<tr>
<td><strong>åºåå</strong></td>
<td>èªå®ä¹äºè¿å¶è¯»åå¨ãå¯åé¿åº¦ç¼ç </td>
<td>é«æçåè®®è§£æ</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="æ§è½ä¼åå»ºè®®">æ§è½ä¼åå»ºè®®</h2>
<h3 id="å®¢æ·ç«¯ä¼å">å®¢æ·ç«¯ä¼å</h3>
<ol>
<li><strong>éæ©åéç QoS</strong>ï¼å¤§å¤æ°åºæ¯ QoS 1 å°±è¶³å¤äºï¼QoS 2 å¼éè¾å¤§</li>
<li><strong>æ¹éåé</strong>ï¼å¦ææå¤§éæ¶æ¯ï¼èèåå¹¶ååé</li>
<li><strong>åçè®¾ç½® KeepAlive</strong>ï¼æ ¹æ®ç½ç»ç¯å¢è°æ´ï¼ä¸è¬ 60 ç§å³å¯</li>
<li><strong>ä½¿ç¨æä¹ä¼è¯</strong>ï¼å¦æéè¦æ¥æ¶ç¦»çº¿æ¶æ¯ï¼è®¾ç½® <code>CleanSession = false</code></li>
</ol>
<h3 id="broker-ä¼å">Broker ä¼å</h3>
<ol>
<li><strong>è°æ´æå¤§è¿æ¥æ°</strong>ï¼æ ¹æ®æå¡å¨æ§è½è®¾ç½® <code>MaxConnections</code></li>
<li><strong>éå¶æ¶æ¯å¤§å°</strong>ï¼è®¾ç½® <code>MaxMessageSize</code> é²æ­¢æ¶æå¤§æ¶æ¯</li>
<li><strong>ç¦»çº¿æ¶æ¯éå¶</strong>ï¼è®¾ç½® <code>MaxOfflineMessagesPerClient</code> é²æ­¢åå­æº¢åº</li>
<li><strong>ä½¿ç¨éç¾¤</strong>ï¼é«å¯ç¨åºæ¯ä½¿ç¨éç¾¤é¨ç½²</li>
</ol>
<hr>
<h2 id="å®¢æ·ç«¯ä½¿ç¨æå">å®¢æ·ç«¯ä½¿ç¨æå</h2>
<h3 id="åºç¡è¿æ¥">åºç¡è¿æ¥</h3>
<pre><code class="language-csharp">using System.Net.MQTT;

// éç½®å®¢æ·ç«¯éé¡¹
var options = new MqttClientOptions
{
    Host = "localhost",
    Port = 1883,
    ClientId = "my-iot-device",
    CleanSession = true
};

// åå»ºå®¢æ·ç«¯
using var client = new MqttClient(options);

// è¿æ¥å° Broker
var result = await client.ConnectAsync();

if (result.IsSuccess)
{
    Console.WriteLine("è¿æ¥æåï¼");
}
</code></pre>
<h3 id="è®¢éä¸»é¢">è®¢éä¸»é¢</h3>
<pre><code class="language-csharp">// è®¢éåä¸ªä¸»é¢
await client.SubscribeAsync("sensors/temperature", MqttQualityOfService.AtLeastOnce);

// ä½¿ç¨ééç¬¦è®¢éå¤ä¸ªä¸»é¢
await client.SubscribeAsync("sensors/#", MqttQualityOfService.AtLeastOnce);  // å¤çº§ééç¬¦
await client.SubscribeAsync("sensors/+/status", MqttQualityOfService.AtMostOnce);  // åçº§ééç¬¦
</code></pre>
<h3 id="æ¥æ¶æ¶æ¯">æ¥æ¶æ¶æ¯</h3>
<pre><code class="language-csharp">client.MessageReceived += (sender, e) =&gt;
{
    Console.WriteLine($"æ¶å°æ¶æ¯:");
    Console.WriteLine($"  ä¸»é¢: {e.Message.Topic}");
    Console.WriteLine($"  åå®¹: {e.Message.PayloadAsString}");
    Console.WriteLine($"  QoS: {e.Message.QualityOfService}");
};
</code></pre>
<h3 id="åå¸æ¶æ¯">åå¸æ¶æ¯</h3>
<pre><code class="language-csharp">// ç®ååå¸
await client.PublishAsync("sensors/temperature", "25.5");

// æå® QoS åå¸
await client.PublishAsync("sensors/humidity", "60%", MqttQualityOfService.AtLeastOnce);

// åå¸ä¿çæ¶æ¯
await client.PublishAsync("device/status", "online", MqttQualityOfService.AtLeastOnce, retain: true);

// ä½¿ç¨å®æ´çæ¶æ¯å¯¹è±¡
var message = MqttApplicationMessage.Create(
    topic: "sensors/data",
    payload: "{\"temp\": 25.5, \"humidity\": 60}",
    qos: MqttQualityOfService.ExactlyOnce,
    retain: false
);
await client.PublishAsync(message);
</code></pre>
<h3 id="éå±æ¶æ¯last-will">éå±æ¶æ¯ï¼Last Willï¼</h3>
<p>éå±æ¶æ¯ä¼å¨å®¢æ·ç«¯å¼å¸¸æ­å¼æ¶èªå¨åå¸ï¼</p>
<pre><code class="language-csharp">var options = new MqttClientOptions
{
    Host = "localhost",
    ClientId = "my-device",
    WillMessage = MqttApplicationMessage.Create(
        topic: "devices/my-device/status",
        payload: "offline",
        qos: MqttQualityOfService.AtLeastOnce,
        retain: true
    )
};
</code></pre>
<h3 id="tls-å å¯è¿æ¥">TLS å å¯è¿æ¥</h3>
<pre><code class="language-csharp">var options = new MqttClientOptions
{
    Host = "secure-broker.example.com",
    Port = 8883,
    UseTls = true,
    // å¯éï¼å®¢æ·ç«¯è¯ä¹¦
    ClientCertificate = new X509Certificate2("client.pfx", "password")
};
</code></pre>
<h3 id="èªå¨éè¿">èªå¨éè¿</h3>
<pre><code class="language-csharp">var options = new MqttClientOptions
{
    Host = "localhost",
    AutoReconnect = true,
    ReconnectDelayMs = 5000  // 5ç§åéè¿
};

client.Connected += (s, e) =&gt; Console.WriteLine("å·²è¿æ¥");
client.Disconnected += (s, e) =&gt; Console.WriteLine("è¿æ¥æ­å¼ï¼æ­£å¨éè¿...");
</code></pre>
<h3 id="å®æ´å®¢æ·ç«¯ç¤ºä¾">å®æ´å®¢æ·ç«¯ç¤ºä¾</h3>
<pre><code class="language-csharp">using System.Net.MQTT;

var options = new MqttClientOptions
{
    Host = "localhost",
    Port = 1883,
    ClientId = $"client-{Guid.NewGuid():N}",
    Username = "user",
    Password = "password",
    CleanSession = true,
    KeepAliveSeconds = 60,
    AutoReconnect = true
};

using var client = new MqttClient(options);

// è®¾ç½®äºä»¶å¤ç
client.Connected += (s, e) =&gt; Console.WriteLine("[äºä»¶] å·²è¿æ¥å° Broker");
client.Disconnected += (s, e) =&gt; Console.WriteLine("[äºä»¶] è¿æ¥å·²æ­å¼");
client.MessageReceived += (s, e) =&gt;
{
    Console.WriteLine($"[æ¶æ¯] {e.Message.Topic}: {e.Message.PayloadAsString}");
};

// è¿æ¥
var result = await client.ConnectAsync();
if (!result.IsSuccess)
{
    Console.WriteLine($"è¿æ¥å¤±è´¥: {result.ReasonCode}");
    return;
}

// è®¢é
await client.SubscribeAsync("test/#", MqttQualityOfService.AtLeastOnce);

// åå¸æµè¯æ¶æ¯
for (int i = 0; i &lt; 10; i++)
{
    await client.PublishAsync("test/counter", i.ToString());
    await Task.Delay(1000);
}

// æ­å¼è¿æ¥
await client.DisconnectAsync();
</code></pre>
<hr>
<h2 id="æå¡å¨brokerä½¿ç¨æå">æå¡å¨ï¼Brokerï¼ä½¿ç¨æå</h2>
<h3 id="å¯å¨åºç¡-broker">å¯å¨åºç¡ Broker</h3>
<pre><code class="language-csharp">using System.Net.MQTT.Broker;

var options = new MqttBrokerOptions
{
    Port = 1883,
    AllowAnonymous = true,
    EnableRetainedMessages = true,
    MaxConnections = 10000
};

using var broker = new MqttBroker(options);

// å¯å¨æå¡å¨
await broker.StartAsync();
Console.WriteLine("MQTT Broker å·²å¯å¨ï¼çå¬ç«¯å£ 1883");

// ä¿æè¿è¡
await Task.Delay(Timeout.Infinite);

// åæ­¢æå¡å¨
await broker.StopAsync();
</code></pre>
<h3 id="éç½®è®¤è¯">éç½®è®¤è¯</h3>
<pre><code class="language-csharp">// ä½¿ç¨ç®åè®¤è¯å¨
broker.Authenticator = new SimpleAuthenticator()
    .AddUser("admin", "admin123")
    .AddUser("device1", "device1pass")
    .AddUser("device2", "device2pass");

var options = new MqttBrokerOptions
{
    Port = 1883,
    AllowAnonymous = false  // ç¦ç¨å¿åè®¿é®
};
</code></pre>
<h3 id="èªå®ä¹è®¤è¯å¨">èªå®ä¹è®¤è¯å¨</h3>
<pre><code class="language-csharp">public class MyAuthenticator : IMqttAuthenticator
{
    public Task&lt;MqttAuthenticationResult&gt; AuthenticateAsync(
        MqttAuthenticationContext context,
        CancellationToken cancellationToken)
    {
        // ä»æ°æ®åºéªè¯ç¨æ·
        if (ValidateFromDatabase(context.Username, context.Password))
        {
            return Task.FromResult(MqttAuthenticationResult.Success());
        }

        return Task.FromResult(MqttAuthenticationResult.Failure(
            MqttConnectReasonCode.BadUserNameOrPassword));
    }
}

broker.Authenticator = new MyAuthenticator();
</code></pre>
<h3 id="broker-äºä»¶å¤ç">Broker äºä»¶å¤ç</h3>
<pre><code class="language-csharp">// å®¢æ·ç«¯è¿æ¥äºä»¶
broker.ClientConnected += (s, e) =&gt;
{
    Console.WriteLine($"[è¿æ¥] å®¢æ·ç«¯ {e.Session.ClientId} å·²è¿æ¥");
    Console.WriteLine($"  å°å: {e.Session.RemoteEndpoint}");
    Console.WriteLine($"  å½åè¿æ¥æ°: {broker.ConnectedClients}");
};

// å®¢æ·ç«¯æ­å¼äºä»¶
broker.ClientDisconnected += (s, e) =&gt;
{
    Console.WriteLine($"[æ­å¼] å®¢æ·ç«¯ {e.Session.ClientId} å·²æ­å¼");
};

// å®¢æ·ç«¯è®¢éäºä»¶
broker.ClientSubscribed += (s, e) =&gt;
{
    Console.WriteLine($"[è®¢é] {e.Session.ClientId} è®¢éäº {e.TopicFilter}");
};

// æ¶æ¯åå¸äºä»¶
broker.MessagePublished += (s, e) =&gt;
{
    Console.WriteLine($"[æ¶æ¯] {e.Message.Topic}: {e.Message.PayloadAsString}");
    Console.WriteLine($"  æ¥èª: {e.SourceClientId}");
};

// æ¶æ¯åå¸åæ¦æªï¼å¯ä»¥é»æ­¢æ¶æ¯åå¸ï¼
broker.MessagePublishing += (s, e) =&gt;
{
    // æ£æ¥ææä¸»é¢
    if (e.Message.Topic.StartsWith("admin/") &amp;&amp; e.SourceClientId != "admin")
    {
        e.Cancel = true;  // é»æ­¢éç®¡çååå¸å° admin ä¸»é¢
    }
};
</code></pre>
<h3 id="tls-éç½®">TLS éç½®</h3>
<pre><code class="language-csharp">var options = new MqttBrokerOptions
{
    // æ®éç«¯å£
    Port = 1883,

    // TLS ç«¯å£
    UseTls = true,
    TlsPort = 8883,
    ServerCertificate = new X509Certificate2("server.pfx", "password"),
    RequireClientCertificate = false
};
</code></pre>
<hr>
<h2 id="é«çº§åè½">é«çº§åè½</h2>
<h3 id="broker-æ¡¥æ¥">Broker æ¡¥æ¥</h3>
<p>æ¡¥æ¥åè½åè®¸å°å¤ä¸ª Broker è¿æ¥èµ·æ¥ï¼å®ç°æ¶æ¯çè·¨ Broker åæ­¥ã</p>
<pre><code class="language-csharp">var broker = new MqttBroker(new MqttBrokerOptions { Port = 2883 });

// æ·»å æ¡¥æ¥å°ç¶ Broker
var bridge = broker.AddBridge(new MqttBridgeOptions
{
    Name = "parent-bridge",
    RemoteHost = "parent-broker.example.com",
    RemotePort = 1883,
    ClientId = "bridge-client-1",

    // ä¸è¡è§åï¼æ¬å°æ¶æ¯ -&gt; è¿ç¨ Broker
    UpstreamRules =
    {
        new MqttBridgeRule { LocalTopicFilter = "sensor/#", Enabled = true },
        new MqttBridgeRule { LocalTopicFilter = "device/+/data", Enabled = true }
    },

    // ä¸è¡è§åï¼è¿ç¨æ¶æ¯ -&gt; æ¬å°
    DownstreamRules =
    {
        new MqttBridgeRule { LocalTopicFilter = "commands/#", Enabled = true },
        new MqttBridgeRule { LocalTopicFilter = "config/#", Enabled = true }
    }
});

// æ¡¥æ¥äºä»¶
bridge.Connected += (s, e) =&gt; Console.WriteLine("æ¡¥æ¥å·²è¿æ¥");
bridge.MessageForwarded += (s, e) =&gt;
{
    var direction = e.Direction == BridgeDirection.Upstream ? "ä¸è¡" : "ä¸è¡";
    Console.WriteLine($"[æ¡¥æ¥-{direction}] {e.OriginalTopic}");
};

// è·åç»è®¡ä¿¡æ¯
var stats = bridge.GetStatistics();
Console.WriteLine($"ä¸è¡æ¶æ¯: {stats.UpstreamMessageCount}");
Console.WriteLine($"ä¸è¡æ¶æ¯: {stats.DownstreamMessageCount}");
</code></pre>
<h3 id="éç¾¤é¨ç½²">éç¾¤é¨ç½²</h3>
<p>éç¾¤åè½å®ç°äºå»ä¸­å¿åç P2P æ¶æï¼ä»»ä½èç¹é½å¯ä»¥ç¬ç«è¿è¡ï¼æ¯æèªå¨æéæ£æµåæ¢å¤ã</p>
<pre><code class="language-csharp">var broker = new MqttBroker(new MqttBrokerOptions { Port = 1883 });

// å¯ç¨éç¾¤
broker.EnableCluster(new MqttClusterOptions
{
    NodeId = "node-1",
    ClusterName = "my-cluster",
    ClusterPort = 11883,
    SeedNodes = new List&lt;string&gt;
    {
        "node2.example.com:11883",
        "node3.example.com:11883"
    },
    HeartbeatIntervalMs = 5000,
    NodeTimeoutMs = 15000,
    EnableDeduplication = true  // é²æ­¢æ¶æ¯éå¤
});

// éç¾¤äºä»¶
broker.Cluster!.PeerJoined += (s, e) =&gt;
    Console.WriteLine($"èç¹å å¥: {e.Peer.NodeId}");

broker.Cluster!.PeerLeft += (s, e) =&gt;
    Console.WriteLine($"èç¹ç¦»å¼: {e.Peer.NodeId}");

broker.Cluster!.MessageForwarded += (s, e) =&gt;
    Console.WriteLine($"æ¶æ¯è½¬å: {e.Topic}");

await broker.StartAsync();
</code></pre>
<h3 id="mqtt-sn-ç½å³">MQTT-SN ç½å³</h3>
<p>MQTT-SN æ¯åºäº UDP çè½»éçº§åè®®ï¼éåèµæºåéçåµå¥å¼è®¾å¤ï¼</p>
<pre><code class="language-csharp">var options = new MqttBrokerOptions
{
    Port = 1883,
    EnableMqttSn = true,
    MqttSnPort = 1885
};
</code></pre>
<h3 id="coap-ç½å³">CoAP ç½å³</h3>
<p>CoAP ç½å³åè®¸ CoAP è®¾å¤ä¸ MQTT çæç³»ç»äºéï¼</p>
<pre><code class="language-csharp">var options = new MqttBrokerOptions
{
    Port = 1883,
    EnableCoAP = true,
    CoapPort = 5683,
    CoapMqttPrefix = "mqtt"
};

// CoAP å®¢æ·ç«¯å¯ä»¥éè¿ä»¥ä¸æ¹å¼è®¿é® MQTT ä¸»é¢ï¼
// GET coap://broker:5683/mqtt/sensors/temperature
// PUT coap://broker:5683/mqtt/sensors/temperature (åå¸æ¶æ¯)
</code></pre>
<hr>
<h2 id="qos-æå¡è´¨é">QoS æå¡è´¨é</h2>
<p>MQTT å®ä¹äºä¸ç§æå¡è´¨éçº§å«ï¼</p>
<table>
<thead>
<tr>
<th>QoS</th>
<th>åç§°</th>
<th>è¯´æ</th>
<th>éç¨åºæ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>At Most Once</td>
<td>æå¤ä¸æ¬¡ï¼ä¸ä¿è¯éè¾¾</td>
<td>ä¼ æå¨æ°æ®ï¼ä¸¢å¤±å¯æ¥å</td>
</tr>
<tr>
<td>1</td>
<td>At Least Once</td>
<td>è³å°ä¸æ¬¡ï¼å¯è½éå¤</td>
<td>éè¦æ°æ®ï¼å¯å¤çéå¤</td>
</tr>
<tr>
<td>2</td>
<td>Exactly Once</td>
<td>æ°å¥½ä¸æ¬¡ï¼ä¿è¯éè¾¾ä¸ä¸éå¤</td>
<td>è®¡è´¹ãè®¢åç­å³é®æ°æ®</td>
</tr>
</tbody>
</table>
<pre><code class="language-csharp">// QoS 0 - æå¤ä¸æ¬¡
await client.PublishAsync("sensor/temp", "25", MqttQualityOfService.AtMostOnce);

// QoS 1 - è³å°ä¸æ¬¡
await client.PublishAsync("alert/fire", "detected", MqttQualityOfService.AtLeastOnce);

// QoS 2 - æ°å¥½ä¸æ¬¡
await client.PublishAsync("order/create", orderJson, MqttQualityOfService.ExactlyOnce);
</code></pre>
<hr>
<h2 id="ä¸»é¢ééç¬¦">ä¸»é¢ééç¬¦</h2>
<table>
<thead>
<tr>
<th>ééç¬¦</th>
<th>è¯´æ</th>
<th>ç¤ºä¾</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>+</code></td>
<td>å¹éåä¸ªå±çº§</td>
<td><code>sensor/+/temp</code> å¹é <code>sensor/room1/temp</code></td>
</tr>
<tr>
<td><code>#</code></td>
<td>å¹éå¤ä¸ªå±çº§</td>
<td><code>sensor/#</code> å¹é <code>sensor/room1/temp</code> å <code>sensor/room1/humidity</code></td>
</tr>
</tbody>
</table>
<pre><code class="language-csharp">// è®¢éæææ¿é´çæ¸©åº¦
await client.SubscribeAsync("sensor/+/temperature", MqttQualityOfService.AtLeastOnce);

// è®¢éææä¼ æå¨æ°æ®
await client.SubscribeAsync("sensor/#", MqttQualityOfService.AtLeastOnce);
</code></pre>
<hr>
<h2 id="mqtt-50-æ°ç¹æ§">MQTT 5.0 æ°ç¹æ§</h2>
<p>å¦æä½ ä½¿ç¨ MQTT 5.0 åè®®ï¼å¯ä»¥å©ç¨ä»¥ä¸æ°ç¹æ§ï¼</p>
<pre><code class="language-csharp">var options = new MqttClientOptions
{
    Host = "localhost",
    ProtocolVersion = MqttProtocolVersion.V500  // ä½¿ç¨ MQTT 5.0
};

// åå»ºå¸¦æ MQTT 5.0 å±æ§çæ¶æ¯
var message = MqttApplicationMessage.CreateWithProperties(
    topic: "request/data",
    payload: "{\"query\": \"temperature\"}",
    qos: MqttQualityOfService.AtLeastOnce,
    retain: false,

    // MQTT 5.0 ç¹æå±æ§
    responseTopic: "response/client1",           // ååºä¸»é¢
    correlationData: Encoding.UTF8.GetBytes("req-123"),  // å³èæ°æ®
    messageExpiryInterval: 60,                   // æ¶æ¯60ç§åè¿æ
    contentType: "application/json",             // åå®¹ç±»å
    userProperties: new List&lt;MqttUserProperty&gt;   // ç¨æ·èªå®ä¹å±æ§
    {
        new MqttUserProperty("version", "1.0"),
        new MqttUserProperty("source", "sensor-hub")
    }
);

await client.PublishAsync(message);
</code></pre>
<hr>
<h2 id="æ»ç»">æ»ç»</h2>
<p>æ¯ä¸ä¸ªåè½å®æ´ãæ§è½ä¼ç§ç .NET MQTT åºï¼å·æä»¥ä¸ä¼å¿ï¼</p>
<ul>
<li><strong>å®æ´çåè®®æ¯æ</strong>ï¼MQTT 3.1.1ãMQTT 5.0ãMQTT-SNãCoAP å¨è¦ç</li>
<li><strong>é«æ§è½è®¾è®¡</strong>ï¼å¼æ­¥ IOãé¶åéãç¼å²åºæ± </li>
<li><strong>ä¼ä¸çº§ç¹æ§</strong>ï¼æ¡¥æ¥ãéç¾¤ãè®¤è¯ææ</li>
<li><strong>æäºä½¿ç¨</strong>ï¼ç®æ´ç API è®¾è®¡ï¼ä¸°å¯çç¤ºä¾ä»£ç </li>
<li><strong>ç°ä»£å</strong>ï¼æ¯æææ°ç .NET çæ¬</li>
</ul>
<p>æ è®ºä½ æ¯æå»º IoT å¹³å°ãå®ç°è®¾å¤éä¿¡ï¼è¿æ¯æ­å»ºæ¶æ¯ä¸­é´ä»¶ï¼è¿ä¸ªåºé½è½æ»¡è¶³ä½ çéæ±ã</p>
<h2 id="ç¸å³é¾æ¥">ç¸å³é¾æ¥</h2>
<p>æºç å°åï¼<a href="https://github.com/hnlyf1688/mqtt" target="_blank" rel="noopener nofollow">https://github.com/hnlyf1688/mqtt</a></p>

</div>
<div id="MySignature" role="contentinfo">
    ä¸­å½.NETåä¼ï¼<a href="http://www.dotnet.org.cn" target="_blank">http://www.dotnet.org.cn</a>ï¼<br>
è¾è®¯ä¼é¹ç¾¤ï¼45132984<a target="_blank" href="http://wp.qq.com/wpa/qunwpa?idkey=70cd6c09355ad0beae9424fc818c26b5cdc2c57bd6ceac797a3fce483cddb069"><img border="0" src="http://pub.idqqimg.com/wpa/images/group.png" alt="ä¸­å½.NETåä¼" title="ä¸­å½.NETåä¼"></a><br>
åå®¢å­å°åï¼<a href="http://http://www.cnblogs.com/dotnet-org-cn">http://http://www.cnblogs.com/dotnet-org-cn</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å½åå¯ä¸ä¸ä¸ªä»¥éçå©ç.NETåä¼ï¼è´åæé å½åå·ææå¨æ§ãä»·å¼æ§ç.NETåä¼ã
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.002777777777777778" data-date-updated="2026-01-12 18:14">2026-01-12 18:10</span>&nbsp;
<a href="https://www.cnblogs.com/dotnet-org-cn">ä¸­å½.NETç ç©¶åä¼</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19473369);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19473369', targetLink: 'https://www.cnblogs.com/dotnet-org-cn/p/19473369', title: 'ä¸ä¸ªé«æ§è½ç .NET MQTT å®¢æ·ç«¯ä¸æå¡å¨åº' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ææ¯é¢ï¼MySQLç¯ï¼InnoDBäºå¡æ§è¡è¿ç¨ãäºå¡éç¦»çº§å«ãäºå¡å¹¶åå¼å¸¸ï¼ ]]></title>
    <link>https://www.cnblogs.com/jimoer/p/19472951</link>
    <guid>a93d8e61b7106353e168b62957bf261e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jimoer/p/19472951" title="åå¸äº 2026-01-12 17:12">
    <span role="heading" aria-level="2">ææ¯é¢ï¼MySQLç¯ï¼InnoDBäºå¡æ§è¡è¿ç¨ãäºå¡éç¦»çº§å«ãäºå¡å¹¶åå¼å¸¸ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260112171227414-206366530.png" alt="ææ¯é¢ï¼MySQLç¯ï¼InnoDBäºå¡æ§è¡è¿ç¨ãäºå¡éç¦»çº§å«ãäºå¡å¹¶åå¼å¸¸ï¼" class="desc_img">
        MySQLçInnoDBå¼æä¸æ´æ°æä½æ¶äºå¡çæ§è¡è¿ç¨ï¼ä»ä¹æ¯èè¯»ãå¹»è¯»ãä¸å¯éå¤è¯»ï¼MySQLä¸­çäºå¡éç¦»çº§å«ï¼MySQLçInnoDBå¼ææ¯å¦ä½è§£å³èè¯»ãå¹»è¯»ãä¸å¯éå¤è¯»ï¼
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="mysqlçinnodbå¼æä¸æ´æ°æä½æ¶äºå¡çæ§è¡è¿ç¨">MySQLçInnoDBå¼æä¸æ´æ°æä½æ¶äºå¡çæ§è¡è¿ç¨</h2>
<p>MySQLæ°æ®åºå¨InnoDBä¸­ä¸æ¬¡updateçæä½è¿ç¨åºæ¬å¦ä¸ï¼<br>
<img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260112170353829-586528926.png" alt="image" loading="lazy"></p>
<ol>
<li><strong>é¦åå°æ°æ®å è½½å°Buffer Poolé</strong>ï¼å½InnoDBéè¦æ´æ°ä¸æ¡è®°å½æ¶ï¼é¦åä¼å¨Buffer Poolä¸­æ¥æ¾è¯¥è®°å½æ¯å¦å¨åå­ä¸­ãè¥æ²¡å¨åå­ä¸­ï¼åä»ç£çè¯»åè¯¥é¡µå°Buffer Poolä¸­ã</li>
<li><strong>è®°å½UndoLog</strong>:å¨ä¿®æ¹æä½åï¼InnoDBä¼å¨Undo Logä¸­è®°å½ä¿®æ¹åçæ°æ®ãUndo Logæ¯ç¨æ¥ä¿è¯äºå¡åå­æ§åä¸è´æ§çä¸ç§æºå¶ï¼ç¨äºå¨åçäºå¡åæ»ç­æåµæ¶ï¼å°ä¿®æ¹æä½åæ»å°ä¿®æ¹åçç¶æï¼ä»¥è¾¾å°äºå¡çåå­æ§åä¸è´æ§ã<code>Undo Log é¦ååå¥åå­ä¸­ç Undo ç¼å²åºï¼éåç±åå°çº¿ç¨å®æå·çï¼æ éç­å¾äºå¡æäº¤ã</code>ã</li>
<li><strong>å¨Buffer Poolä¸­æ´æ°æ°æ®</strong>:å½æ§è¡updateè¯­å¥æ¶ï¼InnoDBä¼åæ´æ°å·²ç»è¯»åå°Buffer Poolä¸­çæ°æ®ï¼èä¸æ¯ç´æ¥åå¥ç£çãåæ¶ï¼InnoDBä¼å°ä¿®æ¹åçæ°æ®é¡µç¶æè®¾ç½®ä¸º"èé¡µ"ï¼<code>DirtyPage</code>ï¼ç¶æï¼è¡¨ç¤ºè¯¥é¡µå·²ç»è¢«ä¿®æ¹ä½å°æªåå¥ç£çã</li>
<li><strong>è®°å½RedoLog Buffer</strong>:InnoDBå¨Buffer Poolä¸­è®°å½ä¿®æ¹æä½çåæ¶ï¼InnoDBä¼åå°ä¿®æ¹æä½åå¥å°Redo Log Buffer ä¸­ã</li>
<li><strong>æäº¤äºå¡</strong>:å¨æ§è¡å®ææä¿®æ¹æä½åï¼äºå¡è¢«æäº¤ãå¨æäº¤äºå¡æ¶ï¼InnoDBä¼å°Redo Logåå¥ç£çï¼ä»¥ä¿è¯äºå¡æä¹æ§ï¼commit æ¶ä¼ä¿è¯ write+fsyncï¼ä½ log buffer ä¸­çåå®¹å¯è½å¨ prepare é¶æ®µå°±å·²è¢«åå°çº¿ç¨æåå·çï¼ã</li>
<li><strong>åå¥ç£ç</strong>:å¨æäº¤åï¼InnoDBä¼å°Buffer Poolä¸­çèé¡µåå¥ç£çï¼ä»¥ä¿è¯æ°æ®çæä¹æ§ãä½æ¯è¿ä¸ªåå¥è¿ç¨å¹¶ä¸æ¯ç«å³æ§è¡çï¼æ¯æä¸ä¸ªåå°çº¿ç¨å¼æ­¥æ§è¡çï¼æä»¥å¯è½ä¼å»¶è¿åå¥ï¼æ»ä¹MySQLä¼éæ©åéçæ¶æºææ°æ®åå¥ç£çåæä¹åã</li>
<li><strong>è®°å½Binlog</strong>:å¨æäº¤è¿ç¨ä¸­ï¼MySQL Serverå±å°äºå¡æäº¤çä¿¡æ¯è®°å½å°Binlogä¸­ãBinlogæ¯MySQLç¨æ¥å®ç°ä¸»ä»å¤å¶çä¸ç§æºå¶ï¼ç¨äºå°ä¸»åºä¸çäºå¡åæ­¥å°ä»åºä¸ãå¨Binlogä¸­è®°å½çä¿¡æ¯åæ¬:äºå¡å¼å§çæ¶é´ãæ°æ®åºåãè¡¨åãäºå¡IDãSQLè¯­å¥ç­ã</li>
</ol>
<h2 id="ä»ä¹æ¯èè¯»å¹»è¯»ä¸å¯éå¤è¯»">ä»ä¹æ¯èè¯»ãå¹»è¯»ãä¸å¯éå¤è¯»</h2>
<p>å¨æ´ä¸ªäºå¡çæ§è¡è¿ç¨ä¸­ï¼å½åºç°å¹¶åãä»¥åå¼é¡¾æ§è½ç­æåµï¼ä¼åºç°ä¸ç³»åçé®é¢ï¼ä½æ¯éå¯¹ä¸åçæåµï¼MySQL ä¹ç»åºäºéå¯¹æ§æ¹æ¡ãä¸é¢å°±éå¯¹<strong>èè¯»</strong>ã<strong>å¹»è¯»</strong>ã<strong>ä¸å¯éå¤è¯»</strong>ä¸ç§å¼å¸¸æåµæ¥è¯´æä¸ä¸ã</p>
<h3 id="èè¯»">èè¯»</h3>
<p><strong>èè¯»æ¯æè¯»å°äºå¶ä»äºå¡è¿æ²¡æäº¤çæ°æ®ã</strong><br>
<img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260112170446694-1151197701.png" alt="image" loading="lazy"><br>
èè¯»äº§ççè¿ç¨æ¯å½ä¸ä¸ªäºå¡æ­£å¨è®¿é®æ°æ®ï¼å¹¶ä¸å¯¹æ°æ®è¿è¡äºä¿®æ¹ï¼èè¿ç§ä¿®æ¹è¿æ²¡ææäº¤(<code>commit</code>)å°æ°æ®åºä¸­ï¼è¿æ¶ï¼å¦å¤ä¸ä¸ªäºå¡ä¹è®¿é®è¿ä¸ªæ°æ®ï¼ç¶åä½¿ç¨äºè¿ä¸ªæ°æ®ãå ä¸ºè¿ä¸ªæ°æ®æ¯è¿æ²¡ææäº¤çæ°æ®ï¼é£ä¹å¦å¤ä¸ä¸ªäºå¡è¯»å°çè¿ä¸ªæ°æ®æ¯èæ°æ®ï¼ä¾æ®èæ°æ®æåçæä½å¯è½æ¯ä¸æ­£ç¡®çã</p>
<h3 id="ä¸å¯éå¤è¯»">ä¸å¯éå¤è¯»</h3>
<p>ä¸å¯éå¤è¯»æ¯æå¨å¯¹ææ°æ®è¿è¡è¯»åè¿ç¨ä¸­ï¼æå¶ä»äºå¡å¯¹æ°æ®è¿è¡äºä¿®æ¹(<code>UPDATE</code>ã<code>DELETE</code>)ï¼å¯¼è´ç¬¬äºæ¬¡è¯»åçç»æä¸åã<br>
<img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260112170511717-1573903593.png" alt="image" loading="lazy"><br>
ä¸å¯éå¤è¯»çåçè¿ç¨ï¼å¨æ°æ®åºè®¿é®ä¸­ï¼ä¸ä¸ªäºå¡èå´åä¸¤ä¸ªç¸åçæ¥è¯¢å´è¿åäºä¸åæ°æ®ãè¿æ¯ç±äºæ¥è¯¢æ¶ç³»ç»ä¸­å¶ä»äºå¡ä¿®æ¹çæäº¤èå¼èµ·çãæ¯å¦äºå¡T1è¯»åæä¸æ°æ®ï¼äºå¡T2è¯»åå¹¶ä¿®æ¹äºè¯¥æ°æ®ï¼T1ä¸ºäºå¯¹è¯»åå¼è¿è¡æ£éªèåæ¬¡è¯»åè¯¥æ°æ®ï¼ä¾¿å¾å°äºä¸åçç»æã</p>
<h3 id="å¹»è¯»">å¹»è¯»</h3>
<p>å¹»è¯»æ¯æäºå¡å¨åèå´æ¥è¯¢è¿ç¨ä¸­ï¼æå¦å¤ä¸ä¸ªäºå¡å¯¹èå´åæ°å¢äºè®°å½(<code>INSERT</code>)ï¼å¯¼è´èå´æ¥è¯¢çç»ææ¡æ°ä¸ä¸è´ã<br>
<img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260112170540845-429365170.png" alt="image" loading="lazy"></p>
<p><strong>å¹»è¯»ä¹å¸¸è¢«çä½ä¸å¯éå¤è¯»å¨âèå´æ¥è¯¢âåºæ¯ä¸çç¹æ®è¡¨ç°</strong></p>
<p>ä¾å¦ç¬¬ä¸ä¸ªäºå¡å¯¹ä¸ä¸ªè¡¨ä¸­çæ°æ®è¿è¡äºä¿®æ¹ï¼æ¯å¦è¿ç§ä¿®æ¹æ¶åå°è¡¨ä¸­ç¬¦åæ¡ä»¶ççâå¨é¨æ°æ®è¡âã<br>
åæ¶ï¼ç¬¬äºä¸ªäºå¡ä¹ä¿®æ¹è¿ä¸ªè¡¨ä¸­çæ°æ®ï¼è¿ç§ä¿®æ¹æ¯åè¡¨ä¸­æå¥"ä¸è¡æ°æ°æ®"ãé£ä¹ï¼ä»¥åå°±ä¼åçæä½ç¬¬ä¸ä¸ªäºå¡çç¨æ·åç°è¡¨ä¸­è¿ææ²¡æä¿®æ¹çæ°æ®è¡ï¼å°±å¥½è±¡åçäºå¹»è§ä¸æ ·ã</p>
<h2 id="mysqlä¸­çäºå¡éç¦»çº§å«">MySQLä¸­çäºå¡éç¦»çº§å«</h2>
<p><strong>èè¯»</strong>ã<strong>å¹»è¯»</strong>ã<strong>ä¸å¯éå¤è¯»</strong>è¿ä¸ç§å¼å¸¸æåµï¼äº§ççä¸»è¦åå è¿æ¯ç±äºæ°æ®åºæ¯æå¤ä¸ªäºå¡åæ¶æ§è¡æ¶ï¼äºç¸æä½ç¸åçæ°æ®ãé£ä¹äºå¡ä¹é´è½çå°åªäºæ°æ®å¢ï¼<br>
è¿å°±æ¯ç±æ°æ®åºçäºå¡éç¦»çº§å«æ¥å³å®çã</p>
<p><strong>äºå¡éç¦»çº§å«ï¼ä¸»è¦ç¨äºå®ä¹äºå¡å¤çè¿ç¨ä¸­ï¼ä¸åäºå¡ä¹é´å¯è§æ§åç¸äºå½±åç¨åº¦çä¸å¥æ åã</strong></p>
<blockquote>
<p>ä¸åæ åSQL-92ï¼ä¹å« SQL2ï¼æ¯ ANSI/ISO å¨ 1992 å¹´åå¸çç¬¬äºç SQL æ åï¼å®å¯¹ 1986 å¹´ç SQL-86 åäºå¤§å¹æ©åï¼å¥ å®äºä»å¤©ä¸»æµå³ç³»æ°æ®åºï¼OracleãDB2ãSQL ServerãPostgreSQLãMySQL ç­ï¼ææ¯æçæ ¸å¿åè½ã</p>
</blockquote>
<p>SQL-92å®ä¹äº<strong>4</strong>ç§éç¦»çº§å«æ¥è§£å³<code>èè¯»</code>ã<code>å¹»è¯»</code>ã<code>ä¸å¯éå¤è¯»</code>ç­è¿äºå¼å¸¸æåµï¼ä»é«å°åºä¾æ¬¡ä¸º:<strong><code>å¯ä¸²è¡å(Serializable)</code></strong>ã<strong><code>å¯éå¤è¯»(Repeatable reads)</code></strong>ã<strong><code>è¯»å·²æäº¤(Read committed)</code></strong>ã<strong><code>è¯»æªæäº¤(Read uncommitted)</code></strong>ã</p>
<p><strong>è¯»æªæäº¤(Read uncommitted)</strong> ï¼æä½çº§çéç¦»çº§å«ï¼å°±æ¯è¯´è¿ç§éç¦»çº§å«ä¸ï¼ä¸ä¸ªäºå¡å¯ä»¥è¯»åå°å¦ä¸ä¸ªäºå¡æªæäº¤çæ°æ®ãè¿ç§äºå¡éç¦»çº§å«ä¸ï¼ä¼äº§çï¼<strong>èè¯»ãå¹»è¯»ãä¸å¯éå¤è¯»</strong>ã</p>
<p><strong>è¯»å·²æäº¤(Read committed)</strong>ï¼è¿ç§çäºå¡éç¦»çº§å«ä¸ï¼ä¸ä¸ªäºå¡å¦æå¨ä¿®æ¹æ°æ®ï¼è¿æªæäº¤äºå¡ï¼å¶ä»äºå¡æ¯ä¸è½å¤è¯»åè¯¥æ°æ®çãå æ­¤è¿ç§äºå¡éç¦»çº§å«å¯ä»¥é²æ­¢<strong>èè¯»</strong>ã</p>
<p><strong>å¯éå¤è¯»(Repeatable reads)</strong>ï¼è¿ç§äºå¡éç¦»çº§å«ä¸ï¼æ¯è¯»å·²æäº¤æ´ä¸¥è°¨ï¼ä¸ä½å¯ä»¥é²æ­¢<strong>èè¯»</strong>ï¼è¿è½å¤é²æ­¢<strong>ä¸å¯éå¤è¯»</strong>ï¼<code>ä½æ¯æ²¡åæ³å½»åºè§£å³å¹»è¯»é®é¢</code>ã</p>
<p><strong>å¯ä¸²è¡å(Serializable)</strong>ï¼è¿ç§äºå¡éç¦»çº§å«ä¸ï¼ææçäºå¡é½æ¯æç§é¡ºåºä¸²è¡æ§è¡ï¼ä½æ¯äºå¡å¹¶åæ§è¡éåº¦ä¹æ¯ææ¢çãæ­¤éç¦»çº§å«å¯ä»¥é²æ­¢<strong>èè¯»ãå¹»è¯»ãä¸å¯éå¤è¯»</strong>ã<br>
<img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260112170645904-710641449.png" alt="image" loading="lazy"><br>
ä»¥ä¸æ¯SQL-92æ åä¸­å¯¹äºå¡éç¦»çº§å«çå®ä¹ï¼ä½æ¯ä¸åçæ°æ®åºå¨å®éå®ç°çè¿ç¨ä¸­ï¼æ¯æä¸äºç»å¾®å·®å¼çã</p>
<h2 id="mysqlçinnodbå¼ææ¯å¦ä½è§£å³èè¯»å¹»è¯»ä¸å¯éå¤è¯»">MySQLçInnoDBå¼ææ¯å¦ä½è§£å³èè¯»ãå¹»è¯»ãä¸å¯éå¤è¯»</h2>
<h3 id="è§£å³èè¯»">è§£å³èè¯»</h3>
<p>èè¯»æ¯å¨ä¸ä¸ªäºå¡ä¸­è¯»åå°äºå¦ä¸ä¸ªäºå¡ä¸­æªæäº¤çæ°æ®ï¼å¨ã<strong>è¯»å·²æäº¤</strong>ãéç¦»çº§å«ä¸ï¼äºå¡åªè½è¯»åå°å¶ä»äºå¡å·²ç»æäº¤çæ°æ®çæ¬ãè¿å°±æ¯é <code>MVCCï¼å¤çæ¬å¹¶åæ§å¶ï¼</code>æ¥å®ç°çã</p>
<p><strong>InnoDBä¸ï¼ç³»ç»ä¼æ£æ¥æ¯ä¸ªæ°æ®è¡ççæ¬ï¼åªæå½è¯¥çæ¬æ¯ç±å·²æäº¤äºå¡ä¿®æ¹çï¼æå¯¹å½åäºå¡å¯è§ã</strong></p>
<p>å½äºå¡å¨ã<strong>è¯»å·²æäº¤</strong>ãéç¦»çº§å«ä¸æ§è¡è¯»åæä½æ¶ï¼InnoDBè·åå½åææ°ç<strong>å¨å±äºå¡ID</strong>ï¼è¿ä¸ªIDè¡¨ç¤ºå¨å½åæ¶å»ææå·²æäº¤äºå¡çææ°ç¶æãInnoDBä¼æ£æ¥æ¯ä¸ªæ°æ®è¡ççæ¬ï¼å¦æè¯¥çæ¬æ¯ç±ä¸ä¸ªå°äºæç­äºå½åäºå¡IDçäºå¡ä¿®æ¹çï¼å¹¶ä¸è¯¥äºå¡å·²æäº¤ï¼åè¿ä¸ªçæ¬æ¯å¯è§çãè¿ä¿è¯äºäºå¡åªè½çå°å¨å®å¼å§ä¹åå·²ç»æäº¤çæ°æ®çæ¬ã</p>
<h4 id="å®ç°åç">å®ç°åç</h4>
<p>éè¿è¡çéèå­æ®µå¦ï¼<strong>DB_TRX_ID</strong>ï¼äºå¡IDï¼å<strong>ReadView</strong>æ¥å¤æ­æ°æ®çæ¬çå¯è§æ§ã<br>
<code>DB_TRX_ID</code> 6å­èï¼æ¯å¨å±äºå¡IDï¼è®°å½æåä¿®æ¹è¯¥è¡çäºå¡IDã<br>
<code>DB_ROLL_PTR</code>ï¼7å­èï¼åæ»æéï¼æåundo logä¸­çåå²çæ¬<br>
<code>DB_ROW_ID</code>ï¼6å­èï¼è¡IDï¼å½è¡¨æ²¡æä¸»é®æ¶ä½¿ç¨ï¼</p>
<h5 id="readview">ReadView</h5>
<p><code>ReadView</code> æ¯ InnoDB ç¨æ¥å®ç° <strong>MVCCï¼å¤çæ¬å¹¶åæ§å¶ï¼</strong> çæ ¸å¿æ°æ®ç»æï¼å®ç¸å½äºäºå¡å¨æ§è¡ å¿«ç§è¯»ï¼æ®é SELECTï¼ æ¶çæçä¸å¼ âç¬æ¶ç§çâï¼è®°å½äºå½åç³»ç»ä¸­æææ´»è·äºå¡ï¼å·²å¼å¯ä½æªæäº¤ï¼ç ID åè¡¨ï¼ä»èå³å®å½åäºå¡è½çå°åªäºçæ¬çæ°æ®ã</p>
<p><strong>ReadViewçç»æ</strong></p>
<pre><code class="language-bash">struct read_view_t{
	trx_id_t	low_limit_id; /*!&lt; å¤§äºç­äºæ­¤IDçäºå¡ä¸å¯è§ */
	trx_id_t	up_limit_id; /*!&lt; å°äºæ­¤IDçäºå¡å¯è§ */
	trx_id_t*	trx_ids; /*!&lt; åå»ºæ¶çæ´»è·äºå¡IDåè¡¨ */
	trx_id_t	creator_trx_id; /*!&lt; åå»ºè¯¥ReadViewçäºå¡ID */
};
</code></pre>
<p>ä¾å¦ï¼</p>
<pre><code class="language-bash">trx_ids = [20,28,34,40);
low_limit_id =40;
up_limit_id = 20;
creator_trx_id = 38
</code></pre>
<p>ä¸é¢è¿ç§æåµä¸ï¼<br>
<code>trx_id &lt; 20</code>ï¼è¯´ææ¹trx_idçäºå¡å¨è¿ä¸ªReadViewçæåå·²æäº¤ï¼é£ä¹è¯¥äºå¡çç»ææ¯<strong>å¯è§</strong>ç<br>
<code>trx_id &gt; 20 &amp; trx_id &lt; 40</code>ï¼è¯´æè¯¥trx_idçäºå¡å¨è¿ä¸ªReadViewçææ¶ï¼æ¯æ´»è·ç¶æï¼é£ä¹è¿ä¸ªè®°å½å¯¹äºå½åäºå¡ï¼åå»º<code>ReadView</code>çäºå¡ï¼æ¥è¯´ä¸å¯è§ã<br>
<code>trx_id â¥ 41</code>ï¼æªæ¥äºå¡ï¼å¯¹äºåå»º<code>ReadView</code>çäºå¡æ¥è¯´ï¼ä¸å¯è§ã</p>
<p><strong>ä¸åéç¦»çº§å«ä¸ReadView çè¡ä¸º</strong></p>
<table>
<thead>
<tr>
<th>éç¦»çº§å«</th>
<th>ReadView åå»ºæ¶æº</th>
<th>æ¯å¦å¤ç¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>READ UNCOMMITTEDï¼è¯»æªæäº¤ï¼</strong></td>
<td>ä¸åå»º ReadViewï¼ç´æ¥è¯»ææ°çæ¬</td>
<td>-</td>
</tr>
<tr>
<td><strong>READ COMMITTEDï¼è¯»å·²æäº¤ï¼</strong></td>
<td>æ¯æ¬¡æ§è¡ SELECT æ¶é½åå»ºä¸ä¸ªæ°ç ReadView</td>
<td>ä¸å¤ç¨</td>
</tr>
<tr>
<td><strong>REPEATABLE READï¼å¯éå¤è¯»ï¼</strong></td>
<td>äºå¡ä¸­<strong>ç¬¬ä¸æ¬¡ SELECT</strong> æ¶åå»º ReadViewï¼ä¹åæ´ä¸ªäºå¡å¤ç¨</td>
<td>å¤ç¨</td>
</tr>
<tr>
<td><strong>SERIALIZABLEï¼ä¸²è¡åï¼</strong></td>
<td>éåä¸ºå éæºå¶ï¼ä¸ä¾èµ MVCC</td>
<td>-</td>
</tr>
</tbody>
</table>
<h3 id="è§£å³ä¸å¯éå¤è¯»">è§£å³ä¸å¯éå¤è¯»</h3>
<p>ä¸å¯éå¤è¯»å¨åä¸äºå¡ä¸­ï¼å¤æ¬¡è¯»ååä¸æ°æ®è¿åçç»æä¸åã<br>
è§£å³æ¹æ¡ï¼<code>InnoDB</code>ä¸»è¦æ¯éè¿<code>MVCC</code>å<code>ReadView</code>æºå¶è§£å³ä¸å¯éå¤è¯»é®é¢ã</p>
<p>æ ¸å¿å®ç°ï¼<br>
<strong>å¨ãå¯éå¤è¯»ãREPEATABLE READï¼è¿ç§äºå¡éç¦»çº§å«ä¸ï¼å½ä½¿ç¨å¿«ç§è¯»ï¼è¯»åæ°æ®æ¶ï¼åªä¼å¨ç¬¬ä¸æ¬¡è¯»åçæ¶åçæä¸ä¸ªReadViewï¼åç»­äºå¡ä¸­ææå¿«ç§è¯»é½ç¨åä¸ä¸ªå¿«ç§ï¼è¿æ ·å°±ä¸ä¼åçä¸å¯éå¤è¯»çé®é¢äºã</strong></p>
<p>å³ä½¿å¶ä»äºå¡ä¿®æ¹äºæ°æ®å¹¶æäº¤ï¼å½åäºå¡ä»ç¶çå°åæ¥ççæ¬ã</p>
<h3 id="è§£å³å¹»è¯»">è§£å³å¹»è¯»</h3>
<p>å¹»è¯»å¨äºå¡çèå´æ¥è¯¢ä¸­ï¼å¤æ¬¡æ¥è¯¢åºæ¥çæ°éä¸ä¸è´ã<br>
è§£å³æ¹æ¡ï¼<br>
<strong><code>InnoDB</code>çRRéç¦»çº§å«ï¼å¯éå¤è¯»ï¼éè¿<code>MVCC</code> + é´ééï¼<code>Next-Key Lock</code>ï¼çç»åæºå¶è§£å³å¹»è¯»é®é¢ã</strong></p>
<blockquote>
<p><strong>è¿ç§æ¹å¼åªæ¯å¨ä¸å®ç¨åº¦ä¸è§£å³äºå¹»è¯»ï¼ä½æ¯å¹¶æ²¡æå®å¨é¿åï¼å½ä¸ä¸ªäºå¡ä¸­ï¼å¯¹åä¸æ®µèå´æ¥è¯¢ï¼æ¢æå¿«ç§è¯»åæå½åè¯»æ¶ï¼å¯è½åºç°âåå¿«ç§ãåå½åâå¯¼è´çå¹»è¯»ï¼éè¦ä¸å¡å±æ³¨æã</strong></p>
</blockquote>
<h4 id="ååºæ¯æ¥è¯´ææ¯å¦ä½è§£å³å¹»è¯»ç">ååºæ¯æ¥è¯´ææ¯å¦ä½è§£å³å¹»è¯»ç</h4>
<h5 id="å¿«ç§è¯»åºæ¯">å¿«ç§è¯»åºæ¯ï¼</h5>
<p><strong>MVCCæºå¶</strong>ï¼æ®é<code>SELECT</code>è¯­å¥ä½¿ç¨å¿«ç§è¯»ï¼åºäº<code>ReadView</code>æºå¶å¯ä»¥é¿åå¹»è¯»<br>
<strong>å®ç°åç</strong>ï¼äºå¡åªè½çå°<code>ReadView</code>åå»ºä¹åå­å¨çæ°æ®ï¼æ°æå¥çæ°æ®å¯¹å½åäºå¡ä¸å¯è§ã</p>
<h5 id="å½åè¯»åºæ¯">å½åè¯»åºæ¯ï¼</h5>
<p><strong><code>Next-Key Lock</code>æºå¶</strong>ï¼å¯¹äº<code>SELECT ... FOR UPDATEãUPDATEãDELETE</code>ç­å½åè¯»æä½</p>
<p><strong>ææ¯ç»è</strong>ï¼</p>
<ul>
<li>ä¸ä»éå®è¯»åå°çè®°å½ï¼è¿ä¼éå®è®°å½ä¹é´çé´éï¼<code>Gap Lock</code>ï¼</li>
<li>é²æ­¢å¶ä»äºå¡å¨æ¥è¯¢èå´åæå¥æ°æ°æ®ã</li>
<li>éè¿éå®ç´¢å¼è®°å½åè®°å½ä¹é´çé´éæ¥é¿åå¹»è¯»ã</li>
</ul>
<h2 id="æ»ç»">æ»ç»</h2>
<p>MySQL InnoDB ç UPDATE è¯­å¥çä¼¼ä¸æ¡ç®åå½ä»¤ï¼èåå´è¦èµ°å®â<code>å è½½âå Undoâæ¹åå­âå Redoâä¸¤é¶æ®µæäº¤âBinlogâå¼æ­¥å·è</code>âæ´æ¡é¾è·¯ï¼<br>
<strong>å¶ä¸­ Redo ä¿è¯å´©æºæ¢å¤ï¼Binlog ä¿è¯ä¸»ä»å¤å¶ï¼Undo æä¾åæ»ä¸ MVCC å¤çæ¬ã</strong></p>
<p>SQL-92 ç 4 ç§éç¦»çº§å«ï¼å¨ InnoDB éè¢«ç»åä¸º MVCC + éçæ··åæ¹æ¡ï¼</p>
<ul>
<li><strong>READ UNCOMMITTED ç´æ¥è¯»ææ°çï¼å¯è½èè¯»ï¼</strong></li>
<li><strong>READ COMMITTED æ¯æ¬¡æ°å»º ReadViewï¼è§£å³èè¯»ï¼</strong></li>
<li><strong>REPEATABLE READ å¤ç¨é¦æ¬¡ ReadViewï¼è§£å³ä¸å¯éå¤è¯»ï¼å¹¶ç¨ Next-Key Lock å¨å½åè¯»åºæ¯ä¸å µä½å¹»è¯»ï¼</strong></li>
<li><strong>SERIALIZABLE éåä¸ºçº¯å éï¼å½»åºä¸²è¡ã</strong></li>
</ul>
<p>çè§£è¿å¥â<strong>æ¥å¿åè¡ãMVCC å¤çæ¬ãéè¡¥è¾¹ç</strong>âçè®¾è®¡ï¼æè½å¨ä¸å¡å¼åä¸­æ­£ç¡®éæ©éç¦»çº§å«ãåçä½¿ç¨å½åè¯»ä¸ç´¢å¼ï¼é¿åâ<strong>éç­å¾</strong>âæâ<strong>å¹»è¯»</strong>âå¸¦æ¥çæå¤ç»æã</p>

</div>
<div id="MySignature" role="contentinfo">
    <div style="float:left;letter-spacing: 1px;font-size: 13px;"><p><strong>ä½èï¼</strong><a href="http://www.cnblogs.com/jimoer/">çºªè«</a>
<br>æ¬¢è¿ä»»ä½å½¢å¼çè½¬è½½ï¼ä½è¯·å¡å¿æ³¨æåºå¤ã<br>
éäºæ¬äººæ°´å¹³ï¼å¦ææç« åä»£ç æè¡¨è¿°ä¸å½ä¹å¤ï¼è¿è¯·ä¸åèµæã</p>
<!-- åäº«å¾æ å¼å§ -->
<p>æ¬¢è¿æ«æäºç»´ç å³æ³¨å¬ä¼å·ï¼<strong>Jimoer</strong></p>
<p>æç« ä¼åæ­¥å°å¬ä¼å·ä¸é¢ï¼å¤§å®¶ä¸èµ·æé¿ï¼å±åæåææ¯è½åã</p>
<p><strong>å£°æ´åä¸»ï¼</strong>å¦ææ¨è§å¾æç« å¯¹æ¨æå¸®å©ï¼å¯ä»¥ç¹å»æç« å³ä¸è§ã<a onclick="pepleFavourite();" href="javascript:void(0);" style="font-size: 14pt;">æ¨è</a>ãä¸ä¸ã</p>
<p>æ¨çé¼å±æ¯åä¸»çæå¤§å¨åï¼</p>
</div>
<div style="float:right;">
<img src="https://img2018.cnblogs.com/blog/772743/201909/772743-20190904004009398-659676330.png" alt="å¾®ä¿¡å¬ä¼å·"></div>
<!-- åäº«å¾æ ç»æ -->
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-12 17:13">2026-01-12 17:12</span>&nbsp;
<a href="https://www.cnblogs.com/jimoer">çºªè«</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19472951);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19472951', targetLink: 'https://www.cnblogs.com/jimoer/p/19472951', title: 'ææ¯é¢ï¼MySQLç¯ï¼InnoDBäºå¡æ§è¡è¿ç¨ãäºå¡éç¦»çº§å«ãäºå¡å¹¶åå¼å¸¸ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>