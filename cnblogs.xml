<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-21T12:39:37.553Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ SpringBooté¡¹ç®çå½éåæµç¨ ]]></title>
    <link>https://www.cnblogs.com/Marktowin/p/19511993</link>
    <guid>057b38702fd2ec4bc3033ef0adb23573</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Marktowin/p/19511993" title="åå¸äº 2026-01-21 15:15">
    <span role="heading" aria-level="2">SpringBooté¡¹ç®çå½éåæµç¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p dir="auto">å¨ Spring Boot é¡¹ç®å·²ç»å¼åå®æåï¼æ³è¦å®ç°å½éåï¼i18nï¼ï¼è®©æææç¤ºä¿¡æ¯ï¼åç«¯è¿åçéè¯¯æ¶æ¯ãæåæ¶æ¯ãå¼å¸¸ä¿¡æ¯ãæä¸¾æè¿°ç­ï¼æ¯æå¤è¯­è¨ï¼å¤çæµç¨å¦ä¸ï¼</p>
<h3 dir="auto">1. åå»ºå½éåèµæºæä»¶ï¼messages.propertiesï¼</h3>
<p dir="auto">å¨ src/main/resources ç®å½ä¸ï¼æ°å»º i18n å­ç®å½ï¼ï¼åå»ºä»¥ä¸æä»¶ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> src/main/resources/
<span style="color: rgba(0, 128, 128, 1)">2</span> âââ i18n/
<span style="color: rgba(0, 128, 128, 1)">3</span> <span style="color: rgba(0, 0, 0, 1)">    âââ messages.properties           # é»è®¤è¯­è¨ï¼éå¸¸æ¯ä¸­ææè±æï¼
</span><span style="color: rgba(0, 128, 128, 1)">4</span> <span style="color: rgba(0, 0, 0, 1)">    âââ messages_zh_CN.properties     # ç®ä½ä¸­æ
</span><span style="color: rgba(0, 128, 128, 1)">5</span> <span style="color: rgba(0, 0, 0, 1)">    âââ messages_en_US.properties     # ç¾å¼è±æ
</span><span style="color: rgba(0, 128, 128, 1)">6</span> <span style="color: rgba(0, 0, 0, 1)">    âââ messages_zh_TW.properties     # ç¹ä½ä¸­æï¼å¯éï¼
</span><span style="color: rgba(0, 128, 128, 1)">7</span>     âââ messages_ja.properties        # æ¥è¯­ï¼å¯éï¼</pre>
</div>
<p dir="auto">messages.propertiesï¼ä¸­æç¤ºä¾ï¼ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> <span style="color: rgba(0, 0, 0, 1)"># éç¨æç¤º
</span><span style="color: rgba(0, 128, 128, 1)">2</span> success=<span style="color: rgba(0, 0, 0, 1)">æä½æå
</span><span style="color: rgba(0, 128, 128, 1)">3</span> error.system=<span style="color: rgba(0, 0, 0, 1)">ç³»ç»å¼å¸¸ï¼è¯·ç¨åéè¯
</span><span style="color: rgba(0, 128, 128, 1)">4</span> error.notfound=<span style="color: rgba(0, 0, 0, 1)">èµæºä¸å­å¨
</span><span style="color: rgba(0, 128, 128, 1)">5</span> 
<span style="color: rgba(0, 128, 128, 1)">6</span> <span style="color: rgba(0, 0, 0, 1)"># ä¸å¡æç¤º
</span><span style="color: rgba(0, 128, 128, 1)">7</span> user.login.success=<span style="color: rgba(0, 0, 0, 1)">ç»å½æå
</span><span style="color: rgba(0, 128, 128, 1)">8</span> user.login.fail=<span style="color: rgba(0, 0, 0, 1)">ç¨æ·åæå¯ç éè¯¯
</span><span style="color: rgba(0, 128, 128, 1)">9</span> user.notfound=ç¨æ·ä¸å­å¨</pre>
</div>
<p dir="auto">messages_en_US.propertiesï¼è±æç¤ºä¾ï¼ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> success=<span style="color: rgba(0, 0, 0, 1)">Operation successful
</span><span style="color: rgba(0, 128, 128, 1)">2</span> error.system=System error, please <span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)"> again later
</span><span style="color: rgba(0, 128, 128, 1)">3</span> error.notfound=<span style="color: rgba(0, 0, 0, 1)">Resource not found
</span><span style="color: rgba(0, 128, 128, 1)">4</span> 
<span style="color: rgba(0, 128, 128, 1)">5</span> user.login.success=<span style="color: rgba(0, 0, 0, 1)">Login successful
</span><span style="color: rgba(0, 128, 128, 1)">6</span> user.login.fail=<span style="color: rgba(0, 0, 0, 1)">Username or password is incorrect
</span><span style="color: rgba(0, 128, 128, 1)">7</span> user.notfound=User not found</pre>
</div>
<p dir="auto"><strong>æ³¨æ</strong>ï¼</p>
<ul dir="auto">
<li>æä»¶åå¿é¡»ä»¥ messages å¼å¤´ï¼Spring Boot é»è®¤æ¥æ¾è§åï¼ã</li>
<li>æææç¤ºç»ä¸æ¾å¨ i18n ç®å½ä¸ï¼æ¹ä¾¿ç®¡çã</li>
</ul>
<h3 dir="auto">2. éç½® application.ymlï¼æ application.propertiesï¼</h3>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> <span style="color: rgba(0, 0, 0, 1)"># application.yml
</span><span style="color: rgba(0, 128, 128, 1)">2</span> <span style="color: rgba(0, 0, 0, 1)">spring:
</span><span style="color: rgba(0, 128, 128, 1)">3</span> <span style="color: rgba(0, 0, 0, 1)">  messages:
</span><span style="color: rgba(0, 128, 128, 1)">4</span>     basename: i18n/<span style="color: rgba(0, 0, 0, 1)">messages          # èµæºæä»¶åºç¡åï¼æ¯æééç¬¦ï¼
</span><span style="color: rgba(0, 128, 128, 1)">5</span>     encoding: UTF-8                 # å¿é¡»æ¯ UTF-8
<span style="color: rgba(0, 128, 128, 1)">6</span>     fallback-to-system-locale: <span style="color: rgba(0, 0, 255, 1)">false</span> # æ¨èè®¾ç½®ä¸º <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">ï¼æ¾ä¸å°å¯¹åºè¯­è¨æ¶ä¸åéå°ç³»ç»é»è®¤Localeï¼
</span><span style="color: rgba(0, 128, 128, 1)">7</span>     use-code-as-<span style="color: rgba(0, 0, 255, 1)">default</span>-message: <span style="color: rgba(0, 0, 255, 1)">true</span> # æ¾ä¸å°keyæ¶ç´æ¥è¿åcodeï¼è°è¯æ¹ä¾¿ï¼ä¸çº¿å¯æ¹ä¸ºfalseï¼</pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> <span style="color: rgba(0, 0, 0, 1)">#  properties
</span><span style="color: rgba(0, 128, 128, 1)">2</span> spring.messages.basename=i18n/<span style="color: rgba(0, 0, 0, 1)">messages
</span><span style="color: rgba(0, 128, 128, 1)">3</span> spring.messages.encoding=UTF-8
<span style="color: rgba(0, 128, 128, 1)">4</span> spring.messages.fallback-to-system-locale=<span style="color: rgba(0, 0, 255, 1)">false</span>
<span style="color: rgba(0, 128, 128, 1)">5</span> spring.messages.use-code-as-<span style="color: rgba(0, 0, 255, 1)">default</span>-message=<span style="color: rgba(0, 0, 255, 1)">true</span></pre>
</div>
<h3 dir="auto">3. èªå®ä¹ LocaleResolver å LocaleChangeInterceptorï¼æ¯æåç«¯ä¼ ååæ¢è¯­è¨ï¼</h3>
<p dir="auto">Spring Boot é»è®¤ä½¿ç¨ <strong>AcceptHeaderLocaleResolver</strong>ï¼æ ¹æ®è¯·æ±å¤´ Accept-Language èªå¨è¯å«ï¼ï¼çäº§ç¯å¢éå¸¸è¿éè¦æ¯æéè¿åæ°æ cookie åæ¢è¯­è¨ã</p>
<p dir="auto">ä½¿ç¨ SessionLocaleResolver + LocaleChangeInterceptorï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)"> 1</span> <span style="color: rgba(0, 0, 0, 1)">@Configuration
</span><span style="color: rgba(0, 128, 128, 1)"> 2</span> <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span> LocaleConfig <span style="color: rgba(0, 0, 255, 1)">implements</span><span style="color: rgba(0, 0, 0, 1)"> WebMvcConfigurer {
</span><span style="color: rgba(0, 128, 128, 1)"> 3</span> 
<span style="color: rgba(0, 128, 128, 1)"> 4</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> é»è®¤è¯­è¨</span>
<span style="color: rgba(0, 128, 128, 1)"> 5</span> <span style="color: rgba(0, 0, 0, 1)">    @Bean
</span><span style="color: rgba(0, 128, 128, 1)"> 6</span>     <span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> LocaleResolver localeResolver() {
</span><span style="color: rgba(0, 128, 128, 1)"> 7</span>         SessionLocaleResolver localeResolver = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> SessionLocaleResolver();
</span><span style="color: rgba(0, 128, 128, 1)"> 8</span>         localeResolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE); <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> é»è®¤ç®ä½ä¸­æ</span>
<span style="color: rgba(0, 128, 128, 1)"> 9</span>         <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> localeResolver;
</span><span style="color: rgba(0, 128, 128, 1)">10</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">11</span> 
<span style="color: rgba(0, 128, 128, 1)">12</span>     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¦æªå¨ï¼æ¯æ ?lang=zh_CN æ ?lang=en_US åæ¢è¯­è¨</span>
<span style="color: rgba(0, 128, 128, 1)">13</span> <span style="color: rgba(0, 0, 0, 1)">    @Bean
</span><span style="color: rgba(0, 128, 128, 1)">14</span>     <span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> LocaleChangeInterceptor localeChangeInterceptor() {
</span><span style="color: rgba(0, 128, 128, 1)">15</span>         LocaleChangeInterceptor lci = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> LocaleChangeInterceptor();
</span><span style="color: rgba(0, 128, 128, 1)">16</span>         lci.setParamName("lang"); <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åç«¯ä¼ åå</span>
<span style="color: rgba(0, 128, 128, 1)">17</span>         <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> lci;
</span><span style="color: rgba(0, 128, 128, 1)">18</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">19</span> 
<span style="color: rgba(0, 128, 128, 1)">20</span> <span style="color: rgba(0, 0, 0, 1)">    @Override
</span><span style="color: rgba(0, 128, 128, 1)">21</span>     <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> addInterceptors(InterceptorRegistry registry) {
</span><span style="color: rgba(0, 128, 128, 1)">22</span> <span style="color: rgba(0, 0, 0, 1)">        registry.addInterceptor(localeChangeInterceptor());
</span><span style="color: rgba(0, 128, 128, 1)">23</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">24</span> }</pre>
</div>
<p dir="auto">è¥ä¼åä»è¯·æ±å¤´è¯å«ï¼åæ¯æåæ°åæ¢ï¼å¯ä»¥èªå®ä¹ LocaleResolverï¼æ´çµæ´»ï¼ã</p>
<h3 dir="auto">4. å¨ä»£ç ä¸­ä½¿ç¨ MessageSource è·åå½éåæ¶æ¯</h3>
<h4 dir="auto">æ¹å¼ä¸ï¼æ³¨å¥ MessageSource</h4>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)"> 1</span> <span style="color: rgba(0, 0, 0, 1)">@RestController
</span><span style="color: rgba(0, 128, 128, 1)"> 2</span> @RequestMapping("/api"<span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 3</span> <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> UserController {
</span><span style="color: rgba(0, 128, 128, 1)"> 4</span> 
<span style="color: rgba(0, 128, 128, 1)"> 5</span> <span style="color: rgba(0, 0, 0, 1)">    @Autowired
</span><span style="color: rgba(0, 128, 128, 1)"> 6</span>     <span style="color: rgba(0, 0, 255, 1)">private</span><span style="color: rgba(0, 0, 0, 1)"> MessageSource messageSource;
</span><span style="color: rgba(0, 128, 128, 1)"> 7</span> 
<span style="color: rgba(0, 128, 128, 1)"> 8</span>     @GetMapping("/test"<span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 9</span>     <span style="color: rgba(0, 0, 255, 1)">public</span> ResponseEntity&lt;String&gt; test(Locale locale) { <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Locale å¯éä»åæ°æ³¨å¥
</span><span style="color: rgba(0, 128, 128, 1)">10</span>         <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¹å¼1ï¼ç´æ¥ä½¿ç¨ locale åæ°</span>
<span style="color: rgba(0, 128, 128, 1)">11</span>         String msg = messageSource.getMessage("user.login.success", <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">, locale);
</span><span style="color: rgba(0, 128, 128, 1)">12</span> 
<span style="color: rgba(0, 128, 128, 1)">13</span>         <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¹å¼2ï¼ä» LocaleContextHolder è·åå½åè¯­è¨ï¼æ¨èï¼ï¼</span>
<span style="color: rgba(0, 128, 128, 1)">14</span>         String msg2 = messageSource.getMessage("user.login.success", <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">, LocaleContextHolder.getLocale());
</span><span style="color: rgba(0, 128, 128, 1)">15</span> 
<span style="color: rgba(0, 128, 128, 1)">16</span>         <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> ResponseEntity.ok(msg2);
</span><span style="color: rgba(0, 128, 128, 1)">17</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">18</span> }</pre>
</div>
<h4 dir="auto">æ¹å¼äºï¼ç»ä¸å°è£å·¥å·ç±»</h4>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)"> 1</span> <span style="color: rgba(0, 0, 0, 1)">@Component
</span><span style="color: rgba(0, 128, 128, 1)"> 2</span> <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> MessageUtils {
</span><span style="color: rgba(0, 128, 128, 1)"> 3</span> 
<span style="color: rgba(0, 128, 128, 1)"> 4</span>     <span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">static</span><span style="color: rgba(0, 0, 0, 1)"> MessageSource messageSource;
</span><span style="color: rgba(0, 128, 128, 1)"> 5</span> 
<span style="color: rgba(0, 128, 128, 1)"> 6</span> <span style="color: rgba(0, 0, 0, 1)">    @Autowired
</span><span style="color: rgba(0, 128, 128, 1)"> 7</span>     <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> setMessageSource(MessageSource messageSource) {
</span><span style="color: rgba(0, 128, 128, 1)"> 8</span>         MessageUtils.messageSource =<span style="color: rgba(0, 0, 0, 1)"> messageSource;
</span><span style="color: rgba(0, 128, 128, 1)"> 9</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">10</span> 
<span style="color: rgba(0, 128, 128, 1)">11</span>     <span style="color: rgba(0, 128, 0, 1)">/**</span>
<span style="color: rgba(0, 128, 128, 1)">12</span> <span style="color: rgba(0, 128, 0, 1)">     * è·åå½éåæ¶æ¯
</span><span style="color: rgba(0, 128, 128, 1)">13</span>      <span style="color: rgba(0, 128, 0, 1)">*/</span>
<span style="color: rgba(0, 128, 128, 1)">14</span>     <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span><span style="color: rgba(0, 0, 0, 1)"> String getMessage(String code, Object... args) {
</span><span style="color: rgba(0, 128, 128, 1)">15</span>         <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> messageSource.getMessage(code, args, LocaleContextHolder.getLocale());
</span><span style="color: rgba(0, 128, 128, 1)">16</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">17</span> 
<span style="color: rgba(0, 128, 128, 1)">18</span>     <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span><span style="color: rgba(0, 0, 0, 1)"> String getMessage(String code) {
</span><span style="color: rgba(0, 128, 128, 1)">19</span>         <span style="color: rgba(0, 0, 255, 1)">return</span> getMessage(code, (Object) <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">20</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">21</span> }</pre>
</div>
<p dir="auto">ä½¿ç¨æ¹å¼ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> <span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> BusinessException(MessageUtils.getMessage("user.notfound"<span style="color: rgba(0, 0, 0, 1)">));
</span><span style="color: rgba(0, 128, 128, 1)">2</span> <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ</span>
<span style="color: rgba(0, 128, 128, 1)">3</span> <span style="color: rgba(0, 0, 255, 1)">return</span> Result.error(MessageUtils.getMessage("error.system"));</pre>
</div>
<h3 dir="auto">5. å¨å±å¼å¸¸å¤çä¸­ä½¿ç¨å½éå</h3>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)"> 1</span> <span style="color: rgba(0, 0, 0, 1)">@RestControllerAdvice
</span><span style="color: rgba(0, 128, 128, 1)"> 2</span> <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> GlobalExceptionHandler {
</span><span style="color: rgba(0, 128, 128, 1)"> 3</span> 
<span style="color: rgba(0, 128, 128, 1)"> 4</span>     @ExceptionHandler(BusinessException.<span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 5</span>     <span style="color: rgba(0, 0, 255, 1)">public</span> Result&lt;?&gt;<span style="color: rgba(0, 0, 0, 1)"> handleBusinessException(BusinessException e) {
</span><span style="color: rgba(0, 128, 128, 1)"> 6</span>         <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åè®¾ BusinessException éé¢å­äº messageCode</span>
<span style="color: rgba(0, 128, 128, 1)"> 7</span>         String message =<span style="color: rgba(0, 0, 0, 1)"> MessageUtils.getMessage(e.getCode(), e.getArgs());
</span><span style="color: rgba(0, 128, 128, 1)"> 8</span>         <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> Result.error(message);
</span><span style="color: rgba(0, 128, 128, 1)"> 9</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">10</span> 
<span style="color: rgba(0, 128, 128, 1)">11</span>     @ExceptionHandler(Exception.<span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)">12</span>     <span style="color: rgba(0, 0, 255, 1)">public</span> Result&lt;?&gt;<span style="color: rgba(0, 0, 0, 1)"> handleException(Exception e) {
</span><span style="color: rgba(0, 128, 128, 1)">13</span>         <span style="color: rgba(0, 0, 255, 1)">return</span> Result.error(MessageUtils.getMessage("error.system"<span style="color: rgba(0, 0, 0, 1)">));
</span><span style="color: rgba(0, 128, 128, 1)">14</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">15</span> }</pre>
</div>
<h3 dir="auto">6. æ¯æåæ°å ä½ç¬¦</h3>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> <span style="color: rgba(0, 0, 0, 1)"># messages.properties
</span><span style="color: rgba(0, 128, 128, 1)">2</span> user.age.limit=å¹´é¾å¿é¡»å¨ {0} å° {1} å²ä¹é´</pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> String msg = MessageUtils.getMessage("user.age.limit", 18, 60<span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">2</span> <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è¾åºï¼å¹´é¾å¿é¡»å¨ 18 å° 60 å²ä¹é´</span></pre>
</div>
<h3 dir="auto">7. å¸¸è§æä½³å®è·µæ»ç»</h3>
<table style="height: 317px; width: 579px">
<thead>
<tr><th data-col-size="sm">å¤çç¹</th><th data-col-size="lg">å¤çæ¹å¼</th></tr>
</thead>
<tbody>
<tr>
<td data-col-size="sm">èµæºæä»¶ä½ç½®</td>
<td data-col-size="lg"><code>src/main/resources/i18n/messages_*.properties</code></td>
</tr>
<tr>
<td data-col-size="sm">é»è®¤è¯­è¨</td>
<td data-col-size="lg">ç®ä½ä¸­æï¼<code>Locale.SIMPLIFIED_CHINESE</code>ï¼</td>
</tr>
<tr>
<td data-col-size="sm">è¯­è¨åæ¢æ¹å¼</td>
<td data-col-size="lg">è¯·æ±å¤´ <code>Accept-Language</code> + <code>?lang=zh_CN</code></td>
</tr>
<tr>
<td data-col-size="sm">æ¶æ¯è·åæ¹å¼</td>
<td data-col-size="lg">ä¼åä½¿ç¨ <code>LocaleContextHolder.getLocale()</code></td>
</tr>
<tr>
<td data-col-size="sm">å·¥å·ç±»</td>
<td data-col-size="lg">å°è£ <code>MessageUtils</code> ç»ä¸è·å</td>
</tr>
<tr>
<td data-col-size="sm">å¼å¸¸æ¶æ¯</td>
<td data-col-size="lg">å¨é¨ä½¿ç¨ code + MessageUtils è·å</td>
</tr>
<tr>
<td data-col-size="sm">æ¾ä¸å°key</td>
<td data-col-size="lg">å»ºè®® <code>use-code-as-default-message=false</code></td>
</tr>
<tr>
<td data-col-size="sm">ç¼ç </td>
<td data-col-size="lg">å¿é¡» <code>UTF-8</code></td>
</tr>
</tbody>
</table>
<p dir="auto">&nbsp;</p>
<h3 dir="auto">8. æµè¯æ¹æ³</h3>
<ul dir="auto">
<li>æµè§å¨å¼åèå·¥å· â Network â ä¿®æ¹è¯·æ±å¤´ Accept-Language: en-US,en;q=0.9</li>
<li>æç´æ¥å¨ URL åå  ?lang=en_US</li>
</ul>
<p dir="auto">å®æä»¥ä¸æ­¥éª¤ï¼ä½ ç Spring Boot é¡¹ç®å°±å®ç°äºæ åçå½éåæ¯æï¼æææç¤ºä¿¡æ¯é½å¯ä»¥æ ¹æ®ç¨æ·è¯­è¨èªå¨åæ¢ã</p>
<p dir="auto">&nbsp;</p>
<p dir="auto">&nbsp;</p>
<p dir="auto">&nbsp;</p>
<p dir="auto">&nbsp;</p>
<p dir="auto">&nbsp;</p>
<p dir="auto">&nbsp;</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.04791666666666667" data-date-updated="2026-01-21 16:24">2026-01-21 15:15</span>&nbsp;
<a href="https://www.cnblogs.com/Marktowin">Marktowin</a>&nbsp;
éè¯»(<span id="post_view_count">120</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19511993);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19511993', targetLink: 'https://www.cnblogs.com/Marktowin/p/19511993', title: 'SpringBooté¡¹ç®çå½éåæµç¨' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ DynamicâSQL2 æ¥è¯¢ç¯ï¼MyBatis å¢å¼ºå©å¨ï¼è®© SQL åå Java ä¸æ ·ä¸æ» ]]></title>
    <link>https://www.cnblogs.com/pengweizhong/p/19511865</link>
    <guid>8cd3a692a22bfbf537046c71e8aca950</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/pengweizhong/p/19511865" title="åå¸äº 2026-01-21 14:43">
    <span role="heading" aria-level="2">DynamicâSQL2 æ¥è¯¢ç¯ï¼MyBatis å¢å¼ºå©å¨ï¼è®© SQL åå Java ä¸æ ·ä¸æ»</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="dynamicsql2-æ¥è¯¢ç¯mybatis-å¢å¼ºå©å¨è®©-sql-åå-java-ä¸æ ·ä¸æ»">DynamicâSQL2 æ¥è¯¢ç¯ï¼MyBatis å¢å¼ºå©å¨ï¼è®© SQL åå Java ä¸æ ·ä¸æ»</h1>
<blockquote>
<p><strong>dynamicâsql2 çæ¥è¯¢è½åè®¾è®¡ç®æ ï¼</strong>   å SQL è¦åå Java ä¸æ ·èªç¶ï¼å¤ææ¥è¯¢è¦åæ­ç§¯æ¨ä¸æ ·ç»åï¼ç»ææ å°è¦åæä½éåä¸æ ·é¡ºæ»ã</p>
</blockquote>
<p>æ¬ç¯ç®è¿°äºï¼</p>
<ul>
<li>åºç¡æ¥è¯¢</li>
<li>ç»ææ å°</li>
<li>åç» / Map / åé¡µ</li>
<li>Join / å­æ¥è¯¢ / JSON è¡¨</li>
<li>å¨æåå¼ç¨</li>
<li>æåºä¸ SQL æ³¨å¥é²å¾¡</li>
<li>å¿½ç¥å</li>
<li>å½æ°æ¥è¯¢</li>
<li>æ­£åå¹éæ¡ä»¶</li>
<li><strong>å¨æåºè¡¨åç§°ï¼schema/tableï¼æºå¶</strong></li>
<li><strong>åé¡µä½ç³»ï¼dynamicâsql2 / MyBatis / é»è¾åé¡µï¼</strong></li>
</ul>
<h1 id="å¼å¥ä¾èµ">å¼å¥ä¾èµ</h1>
<blockquote>
<p>æªæ­¢è³<code>2026-01-21</code>ï¼ææ°çæ¯<code>0.1.8</code>ï¼é¡¹ç®å°åï¼<a href="https://github.com/pengweizhong/dynamic-sql2" target="_blank" rel="noopener nofollow">https://github.com/pengweizhong/dynamic-sql2</a></p>
</blockquote>
<pre><code class="language-xml">        &lt;!-- Spring2.x --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.dynamic-sql&lt;/groupId&gt;
            &lt;artifactId&gt;dynamic-sql2-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;0.1.8&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring3.x --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.dynamic-sql&lt;/groupId&gt;
            &lt;artifactId&gt;dynamic-sql2-spring-boot3-starter&lt;/artifactId&gt;
            &lt;version&gt;0.1.8&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<p>å¨<code>repository</code>å±æ³¨å¥<code>SqlContext</code>  å¢å æ¹æ¥é½åæ­¤å¯¹è±¡äº¤äºï¼</p>
<pre><code class="language-java">    @Resource
    private SqlContext sqlContext;
</code></pre>
<h1 id="1-åºç¡æ¥è¯¢ä¸ç»ææ å°">1. åºç¡æ¥è¯¢ä¸ç»ææ å°</h1>
<h2 id="11-æ¥è¯¢åè¡¨">1.1 æ¥è¯¢åè¡¨</h2>
<pre><code class="language-java">List&lt;Product&gt; list = sqlContext.select()
        .allColumn()
        .from(Product.class)
        .fetch()
        .toList();
</code></pre>
<h2 id="12-æ¥è¯¢ååæ é">1.2 æ¥è¯¢ååï¼æ éï¼</h2>
<pre><code class="language-java">LocalDate one = sqlContext.select()
        .column(Product::getCreatedAt)
        .from(Product.class)
        .limit(1)
        .fetch(LocalDate.class)
        .toOne();
</code></pre>
<h2 id="13-æ¥è¯¢åæ¡è®°å½">1.3 æ¥è¯¢åæ¡è®°å½</h2>
<pre><code class="language-java">Product product = sqlContext.select()
        .allColumn()
        .from(Product.class)
        .where(c -&gt; c.andEqualTo(Product::getProductId, 7))
        .fetch()
        .toOne();
</code></pre>
<p>æä½¿ç¨ä¸»é®å¿«æ·æ¹å¼ï¼</p>
<pre><code class="language-java">Product product2 = sqlContext.selectByPrimaryKey(Product.class, 7);
</code></pre>
<h1 id="2-tolist--toone--tomap--togroupingby">2. toList / toOne / toMap / toGroupingBy</h1>
<h2 id="21-åç»-togroupingby">2.1 åç» toGroupingBy</h2>
<pre><code class="language-java">Map&lt;Integer, HashSet&lt;String&gt;&gt; groupingBy = sqlContext.select()
        .distinct()
        .allColumn()
        .from(User.class)
        .fetch()
        .toGroupingBy(
                User::getUserId,
                user -&gt; user.getName() + "_hello",
                HashSet::new,
                ConcurrentHashMap::new
        );
</code></pre>
<h2 id="22-åç»å¸¦-dto">2.2 åç»ï¼å¸¦ DTOï¼</h2>
<pre><code class="language-java">LinkedHashMap&lt;String, HashSet&lt;Integer&gt;&gt; groupingBy = sqlContext.select()
        .allColumn()
        .from(User.class)
        .limit(10)
        .fetch(User.class)
        .toGroupingBy(
                User::getName,
                User::getUserId,
                HashSet::new,
                LinkedHashMap::new
        );
</code></pre>
<h2 id="23-tomapå«éå¤-key-å¤ç">2.3 toMapï¼å«éå¤ key å¤çï¼</h2>
<pre><code class="language-java">Map&lt;Integer, String&gt; map = sqlContext.select()
        .distinct()
        .allColumn()
        .from(User.class)
        .fetch()
        .toMap(
                user -&gt; 123,
                user -&gt; user.getName() + "_hello"
        );
</code></pre>
<p>éå¤ key ä¼æå¼å¸¸ï¼å¯èªå®ä¹åå¹¶ç­ç¥ï¼</p>
<pre><code class="language-java">.toMap(
    ProductView::getProductName,
    v -&gt; v,
    (v1, v2) -&gt; v1
);
</code></pre>
<h1 id="3-join--å­æ¥è¯¢--json-è¡¨">3. Join / å­æ¥è¯¢ / JSON è¡¨</h1>
<h2 id="31-å¤çº§-join--å«å-èªå³è">3.1 å¤çº§ join + å«å ï¼èªå³èï¼</h2>
<pre><code class="language-java">List&lt;Map&lt;String, Object&gt;&gt; list = sqlContext.select()
        .column("d1", DepartmentEntity::getId, "l5Id")
        .column("d2", DepartmentEntity::getId, "l4Id")
        .column("d3", DepartmentEntity::getId, "l3Id")
        .column("d4", DepartmentEntity::getId, "l2Id")
        .column("d5", DepartmentEntity::getId, "l1Id")
        .from(DepartmentEntity.class, "d1")
        .leftJoin(DepartmentEntity.class, "d2", c -&gt; c.andEqualTo(new Column("d1","id"), new Column("d2","parent_id")))
        .leftJoin(DepartmentEntity.class, "d3", c -&gt; c.andEqualTo(new Column("d2","id"), new Column("d3","parent_id")))
        .leftJoin(DepartmentEntity.class, "d4", c -&gt; c.andEqualTo(new Column("d3","id"), new Column("d4","parent_id")))
        .leftJoin(DepartmentEntity.class, "d5", c -&gt; c.andEqualTo(new Column("d4","id"), new Column("d5","parent_id")))
        .where(c -&gt; c.andIn(DepartmentEntity::getId, Arrays.asList(1,2,3)))
        .fetchOriginalMap()
        .toList();
</code></pre>
<h2 id="32-å­æ¥è¯¢-join">3.2 å­æ¥è¯¢ join</h2>
<pre><code class="language-java">List&lt;Map&lt;String, Object&gt;&gt; list = sqlContext.select()
        .allColumn(Product.class)
        .from(Product.class)
        .innerJoin(
                select -&gt; select.allColumn(Product.class)
                        .from(Category.class)
                        .join(Product.class, on -&gt; on.andEqualTo(Category::getCategoryId, Product::getCategoryId))
                        .where(c -&gt; c.andLessThanOrEqualTo(Category::getCategoryId, 10)),
                "t",
                on -&gt; on.andEqualTo(Product::getProductId, bindAlias("t", Product::getProductId))
        )
        .fetchOriginalMap()
        .toList();
</code></pre>
<h2 id="33-json-è¡¨å±å¼jsontable">3.3 JSON è¡¨å±å¼ï¼JsonTableï¼</h2>
<pre><code class="language-java">List&lt;Object&gt; list = sqlContext.select()
        .column("o", Order::getOrderId)
        .column("jt", Product::getProductName)
        .from(Order.class, "o")
        .join(() -&gt; new JsonTable(
                        "o",
                        Order::getOrderDetails,
                        "$.items[*]",
                        JsonColumn.builder()
                                .column("product_name")
                                .dataType("VARCHAR(150)")
                                .jsonPath("$.product")
                                .build()
                ),
                "jt",
                null
        )
        .fetch()
        .toList();
</code></pre>
<h1 id="4-å¨æåå¼ç¨-columnreference">4. å¨æåå¼ç¨ ColumnReference</h1>
<pre><code class="language-java">List&lt;Product&gt; list = sqlContext.select()
        .column(Product::getProductId)
        .columnReference(columnReference())
        .from(Product.class)
        .fetch()
        .toList();
</code></pre>
<pre><code class="language-java">AbstractColumnReference columnReference() {
    return ColumnReference.withColumns()
            .column(Product::getProductId)
            .columnReference(columnReference2())
            .column(Product::getProductName);
}
</code></pre>
<h1 id="5-æåºä¸-sql-æ³¨å¥é²å¾¡">5. æåºä¸ SQL æ³¨å¥é²å¾¡</h1>
<h2 id="51-é¾å¼æåº">5.1 é¾å¼æåº</h2>
<pre><code class="language-java">List&lt;User&gt; list = sqlContext.select()
        .allColumn()
        .from(User.class, "u")
        .orderBy(true, sortField, SortOrder.DESC)
        .thenOrderBy(false, User::getUserId)
        .thenOrderBy(true, User::getName)
        .fetch()
        .toList();
</code></pre>
<h2 id="52-order-by-æ³¨å¥æµè¯">5.2 ORDER BY æ³¨å¥æµè¯</h2>
<pre><code class="language-java">sqlContext.select()
        .allColumn()
        .from(User.class)
        .orderBy("user_id; drop table users; --", SortOrder.DESC)
        .fetch()
        .toList();
</code></pre>
<p>æ¡æ¶ä¼æç»éæ³å­æ®µåï¼æåºå¼å¸¸ï¼é¿åæ³¨å¥ã</p>
<h1 id="6-å¿½ç¥å-ignorecolumn">6. å¿½ç¥å ignoreColumn</h1>
<pre><code class="language-java">List&lt;?&gt; list = sqlContext.select()
        .allColumn()
        .ignoreColumn(TempUserEntity::getName)
        .ignoreColumn(TempDeptEntity::getName)
        .from(TempUserEntity.class)
        .join(TempDeptEntity.class, on -&gt; on.andEqualTo(TempUserEntity::getId, TempDeptEntity::getId))
        .fetch()
        .toList();
</code></pre>
<h1 id="7-æ¥æå½æ°-dateformat--now">7. æ¥æå½æ° DateFormat / Now</h1>
<pre><code class="language-java">YearMonth yearMonth = sqlContext.select()
        .column(new DateFormat(new Now(), "%Y-%m"))
        .from(Dual.class)
        .fetch(YearMonth.class)
        .toOne();
</code></pre>
<h1 id="8-æ­£åå¹é-andmatchesæ©å±ç¹">8. æ­£åå¹é andMatchesï¼æ©å±ç¹ï¼</h1>
<pre><code class="language-java">List&lt;User&gt; list = sqlContext.select()
        .allColumn()
        .from(User.class)
        .where(c -&gt; c.andMatches(User::getEmail, ".*@gmail\\.com"))
        .fetch()
        .toList();
</code></pre>
<h1 id="9-å¨æåºè¡¨åç§°schematable">9. å¨æåºè¡¨åç§°ï¼schema/tableï¼</h1>
<p><code>dynamicâsql2</code> ç <code>@Table</code> æ¯æå ä½ç¬¦è§£æï¼å¯å¨æï¼</p>
<ul>
<li>schema</li>
<li>table</li>
<li>alias</li>
<li>dataSourceName</li>
</ul>
<h2 id="91-å¨æ-schema">9.1 å¨æ schema</h2>
<p>ä»0.1.8èµ·ï¼èªå®ä¹å¼åºè¡¨è§£æå¨ï¼è¿å¨åä¸å®ä¾ç¸ä¼¼ä¸å¡ä¸è·¨åºæ¶ä¸åçå½ä»¤åºè¡¨å½åè§åæ¶éå¸¸æç¨ï¼ä¸ä¼å½±åæ¥è¯¢éåº¦ã</p>
<pre><code class="language-java">@Table(schema = "${tenant.schema:user_center}", name = "t_user")
</code></pre>
<p>éç½®ï¼</p>
<pre><code class="language-properties">tenant.schema = tenant_001
</code></pre>
<p>SQLææçæ®µï¼</p>
<pre><code class="language-sql">FROM tenant_001.t_user
</code></pre>
<h2 id="92-å¨æè¡¨åå«é»è®¤å¼">9.2 å¨æè¡¨åï¼å«é»è®¤å¼ï¼</h2>
<pre><code class="language-java">@Table(name = "${tenant.table.user:t_user}")
</code></pre>
<h2 id="93-å¨ææ°æ®æºæé«ä¼åçº§">9.3 å¨ææ°æ®æºï¼æé«ä¼åçº§ï¼</h2>
<pre><code class="language-java">@Table(dataSourceName = "ds_user")
</code></pre>
<h2 id="94-å¨å±alias">9.4 å¨å±alias</h2>
<pre><code class="language-java">@Table(name = "t_user", alias = "u")
</code></pre>
<h1 id="10-åé¡µä½ç³»pagehelper">10. åé¡µä½ç³»ï¼PageHelperï¼</h1>
<p><code>dynamic-sql2</code>åç½®äºåé¡µæ¯æçæ¥è¯¢</p>
<h2 id="101-dynamicsql2-åé¡µ">10.1 dynamicâsql2 åé¡µ</h2>
<pre><code class="language-java">PageInfo&lt;List&lt;User&gt;&gt; pageInfo = PageHelper.of(1, 10)
        .selectPage(() -&gt; sqlContext.select()
                .allColumn()
                .from(User.class)
                .fetch()
                .toList());
</code></pre>
<h2 id="102-mybatis-åé¡µ">10.2 MyBatis åé¡µ</h2>
<pre><code class="language-java">PageInfo&lt;List&lt;User&gt;&gt; pageInfo = PageHelper.ofMybatis(1, 10)
        .selectPage(() -&gt; sqlContext.select()
                .allColumn()
                .from(User.class)
                .fetch()
                .toList());
</code></pre>
<p>Dynamic-SQL2æ¯æmybatisçåé¡µï¼ä½æ¯éè¦å¼å¥æå±åï¼</p>
<pre><code class="language-xml">&lt;!-- Source: https://mvnrepository.com/artifact/com.dynamic-sql/dynamic-sql2-extension --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.dynamic-sql&lt;/groupId&gt;
    &lt;artifactId&gt;dynamic-sql2-extension&lt;/artifactId&gt;
    &lt;version&gt;0.1.6&lt;/version&gt;
    &lt;scope&gt;compile&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<p>è¯¥æå±åé¤äºæ¯æMybatisåé¡µå¤ï¼åå¶æ å°è§åä¹æ¯å®å¨å¼å®¹ã</p>
<h2 id="103-applywhereå®éªæ§">10.3 applyWhereï¼å®éªæ§ï¼</h2>
<p>è¯¥åºæ¯ææ¶ä¼éå°ç±»ä¼¼æåµï¼æçä¾èµjaræèªå·±ç¬ç«çé»è¾ä½ç³»ï¼ä½æ¯åæ³ä¿®æ¹å¶åé¨SQLï¼å¨ä¸æ¹ååé¨é»è¾çæåµä¸ï¼å¨å¤é¨å°è¯ä¿®æ¹SQLè¯­å¥ãç®ååªæ¯å®éªé¶æ®µï¼æè¶³å¤çåºæ¯åºæ¯æ¯æåæ´å¤çæµè¯åï¼æä¼Releaseè¯¥ç¹æ§ã</p>
<pre><code class="language-java">PageInfo&lt;List&lt;User&gt;&gt; pageInfo = PageHelper.of(1, 3)
        .applyWhere(c -&gt; c.andGreaterThanOrEqualTo(User::getAge, 18))
        .selectPage(
    			//åè®¾è¿æ¯æ æ³ä¿®æ¹/ä¸åè®¸æ´æ¹çåé¨SQLï¼éå¸¸æ¯jarçå½¢å¼æä¾
    			() -&gt; sqlContext.select()
                .allColumn()
                .from(User.class)
                .fetch()
                .toList());
</code></pre>
<h2 id="104-é»è¾åé¡µéååå­åé¡µ">10.4 é»è¾åé¡µï¼éååå­åé¡µï¼</h2>
<pre><code class="language-java">PageInfo&lt;List&lt;Integer&gt;&gt; pageInfo = PageHelper.ofLogic(2, 3)
        .selectPage(Arrays.asList(1,2,3,4,5,6,7));
</code></pre>
<h1 id="11-åé¡µ--å¨æåºè¡¨åç§°ç¤ºä¾">11. åé¡µ + å¨æåºè¡¨åç§°ç¤ºä¾</h1>
<pre><code class="language-java">@Table(
    schema = "${tenant.schema:user_center}",
    name = "${tenant.table.user:t_user}",
    alias = "u"
)
public class User {}
</code></pre>
<p>åé¡µæ¥è¯¢ï¼</p>
<pre><code class="language-java">PageInfo&lt;List&lt;User&gt;&gt; pageInfo = PageHelper.of(1, 10)
        .selectPage(() -&gt; sqlContext.select()
                .allColumn()
                .from(User.class)
                .fetch()
                .toList());
</code></pre>
<p>æç» SQLï¼</p>
<pre><code class="language-java">SELECT u.* 
FROM tenant_001.user_2025 u 
LIMIT 10 OFFSET 0
</code></pre>
<h1 id="æå±">æå±</h1>
<h2 id="èªå®ä¹å½æ°">èªå®ä¹å½æ°</h2>
<p>å¯¹äº<code>Dynamic-SQL2</code>æ²¡ææä¾çå½æ°ï¼å¦ä½èªå®ä¹å¢ï¼éå¸¸ç®åï¼ç»§æ¿<code>ColumnFunctionDecorator</code>æ½è±¡ç±»éå<code>getFunctionToString</code>æ¹æ³å³å¯ï¼ç¶åä»£ç ä¸­å°±å¯ä»¥å¼ç¨äºã</p>
<p>æ¯å¦å·²å­å¨ç<code>max</code>å½æ°ä¸ºä¾ï¼</p>
<pre><code class="language-java">/*
 * Copyright (c) 2024 PengWeizhong. All Rights Reserved.
 *
 * This source code is licensed under the MIT License.
 * You may obtain a copy of the License at:
 * https://opensource.org/licenses/MIT
 *
 * See the LICENSE file in the project root for more information.
 */
package com.dynamic.sql.core.column.function.windows.aggregate;


import com.dynamic.sql.core.FieldFn;
import com.dynamic.sql.core.Version;
import com.dynamic.sql.core.column.function.AbstractColumFunction;
import com.dynamic.sql.core.column.function.ColumnFunctionDecorator;
import com.dynamic.sql.core.column.function.windows.WindowsFunction;
import com.dynamic.sql.enums.SqlDialect;
import com.dynamic.sql.utils.ExceptionUtils;
import com.dynamic.sql.model.TableAliasMapping;

import java.util.Map;


public class Max extends ColumnFunctionDecorator implements AggregateFunction, WindowsFunction {

    public Max(AbstractColumFunction delegateFunction) {
        super(delegateFunction);
    }

    public &lt;T, F&gt; Max(FieldFn&lt;T, F&gt; fn) {
        super(fn);
    }

    public &lt;T, F&gt; Max(String tableAlias, FieldFn&lt;T, F&gt; fn) {
        super(tableAlias, fn);
    }

    @Override
    public String getFunctionToString(SqlDialect sqlDialect, Version version, Map&lt;String, TableAliasMapping&gt; aliasTableMap) throws UnsupportedOperationException {
        if (sqlDialect == SqlDialect.ORACLE) {
            return "MAX(" + delegateFunction.getFunctionToString(sqlDialect, version, aliasTableMap) + ")".concat(appendArithmeticSql(sqlDialect, version));
        }
        if (sqlDialect == SqlDialect.MYSQL) {
            return "max(" + delegateFunction.getFunctionToString(sqlDialect, version, aliasTableMap) + ")".concat(appendArithmeticSql(sqlDialect, version));
        }
        throw ExceptionUtils.unsupportedFunctionException("max", sqlDialect);
    }
}

</code></pre>
<p>ä¹åå¨ä»£ç ä¸­ç´æ¥å¼ç¨è¯¥ç±»ï¼</p>
<pre><code class="language-java">    @Test
    void testMax() {
        Integer max = sqlContext.select()
                .column(new Max(Product::getProductId))
                .from(Product.class)
                .fetch(Integer.class)
                .toOne();
        System.out.println(max);
    }
</code></pre>
<p>æå°çSQL</p>
<pre><code class="language-log">2026-01-21 13:27:03 [main] DEBUG com.dynamic.sql.core.database.SqlDebugger - dataSource --&gt;     Preparing: select max(`p`.`product_id`) as productId from `dynamic_sql2`.`products` as `p`
2026-01-21 13:27:03 [main] DEBUG com.dynamic.sql.core.database.SqlDebugger - dataSource --&gt;    Parameters: 
2026-01-21 13:27:03 [main] DEBUG com.dynamic.sql.core.database.SqlDebugger - dataSource &lt;--         Total: 1
</code></pre>
<p><code>AggregateFunction</code>å<code>WindowsFunction</code>æ è¯å½æ°çåç±»ï¼å ä¸ºæäºåºæ¯ä¸å½æ°åµå¥ä½¿ç¨æ¶ï¼ä¼è¦æ±æ¯çªå£å½æ°æå¿é¡»æ¯å­ç¬¦ä¸²å½æ°ï¼å æ­¤å£°æç±»åæ´å ç¬¦åå¼åè§èï¼å¦æèªå®ä¹çè¯ï¼å¯ä»¥ä¸ç¨å³å¿å·ä½çå½æ°åç±»ï¼ç´æ¥ç»§æ¿<code>ColumnFunctionDecorator</code>å³å¯ã</p>
<p>ç®åå®ä¹çå½æ°åç±»æ¥å£ï¼</p>
<ul>
<li>AggregateFunction ï¼ èåå½æ°</li>
<li>ScalarFunction ï¼ æ éå½æ°</li>
</ul>
<p><code>Max</code>å½æ°ä¾èµçå¨é¨ä½ç³»å¦å¾æç¤ºï¼</p>
<p><img alt="image-20260121140818596" loading="lazy" data-src="./%E5%8A%A8%E6%80%81SQL2%E4%B9%8B%E6%9F%A5%E8%AF%A2%E7%AF%87.assets/image-20260121140818596.png" class="lazyload"></p>
<h2 id="å½äº§æ°æ®åº">å½äº§æ°æ®åº</h2>
<p>å¯¹äºå½äº§æ°æ®åºï¼éå¸¸é½ä¼æ¯æåå¼å®¹mysqlè¯­æ³ï¼å æ­¤éå¸¸ä¸ç¨å¤ªæå¿ä¸å¼å®¹çé®é¢ãä½æ¯<code>dynamic-sql2</code>å¯å¨æ¶ä¼æ£æµåæ¯æçæ°æ®åºï¼å¯¹äºä¸æ¯æçæ°æ®åºä¼æ¯ææ¥éï¼åªè¦ä½ ç¡®è®¤å½åæä½¿ç¨çæ°æ®åºæä¾åå¼å®¹<code>Mysql</code>ï¼é£ä¹å°±å¯ä»¥å®å¨ä½¿ç¨<code>dynamic-sql2</code>ï¼</p>
<h2 id="æ¨èä¸æ¬¾å¥½ç¨ç-idea-mybatis-æä»¶">æ¨èä¸æ¬¾å¥½ç¨ç IDEA Mybatis æä»¶</h2>
<p>æåæ¬¢çç¹æ§ä¹ä¸æ¯å¨æ§å¶å°å¯ä»¥å°æå°çSQLç´æ¥åå¹¶ä¸ºå¯æ§è¡çSQLè¯­å¥ï¼å¨å¼åç¯å¢ä¸­ç¹å«æç¨ï¼</p>
<p>æä»¶ä¸»é¡µï¼<a href="https://plugins.jetbrains.com/plugin/9837-mybatiscodehelperpro" target="_blank" rel="noopener nofollow">https://plugins.jetbrains.com/plugin/9837-mybatiscodehelperpro</a></p>
<p><img alt="image-20260121141250521" loading="lazy" data-src="./%E5%8A%A8%E6%80%81SQL2%E4%B9%8B%E6%9F%A5%E8%AF%A2%E7%AF%87.assets/image-20260121141250521.png" class="lazyload"></p>
<h1 id="-å®ç»æè±æ¬¢è¿åæ§½">ð å®ç»æè±ï¼æ¬¢è¿åæ§½ð</h1>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-21 14:43">2026-01-21 14:43</span>&nbsp;
<a href="https://www.cnblogs.com/pengweizhong">pengweizhong</a>&nbsp;
éè¯»(<span id="post_view_count">76</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19511865);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19511865', targetLink: 'https://www.cnblogs.com/pengweizhong/p/19511865', title: 'DynamicâSQL2 æ¥è¯¢ç¯ï¼MyBatis å¢å¼ºå©å¨ï¼è®© SQL åå Java ä¸æ ·ä¸æ»' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸¤å¤©ç§æ200ç¾åï¼æAIå¤§æ¨¡åç½å³ç»äºæ¯æäºClaudeæ¨¡å ]]></title>
    <link>https://www.cnblogs.com/sdcb/p/19508169/20260120-chats-190</link>
    <guid>707eb8e520c6aa5ddcb1d2f7ae796218</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sdcb/p/19508169/20260120-chats-190" title="åå¸äº 2026-01-21 08:45">
    <span role="heading" aria-level="2">ä¸¤å¤©ç§æ200ç¾åï¼æAIå¤§æ¨¡åç½å³ç»äºæ¯æäºClaudeæ¨¡å</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>è¿æ¯ä¸ä¸ªå³äºâçéç½é¶âçå¼åæäºã</p>
<p>Chats 1.9.0 åå¸äº 2025 å¹´ 11 æ 27 æ¥ï¼è·ç¦»ä¸ä¸ä¸ªçæ¬åå¸ä»è¿å»äºä¸å°ä¸ä¸ªæãä½å¯¹ Chats æ¥è¯´ï¼è¿å´æ¯ä¸ä¸ªéç¨ç¢å¼ççæ¬ï¼<strong>æä»¬ä¸ä»å¨é¢æ¯æäº Anthropicï¼Claudeï¼æ¨¡åï¼è¿é¡ºå¸¦æ .NET 10 ç»åäºï¼çè³è¿æåºäºä¸å¥è½å¨ Chats éâåå£³âè· Claude Code ç API å¼å®¹å±ã</strong></p>
<p>èå¨è¿ä¸åçèåï¼æ¯ä¸å¼ è®©æâèçâç Azure è´¦åã</p>
<hr>
<h2 id="ä¸åæºäºå¾®è½¯ä¸-anthropic-èæ">ä¸åæºäºâå¾®è½¯ä¸ Anthropic èæâ</h2>
<p>äºæè¦ä» 2025 å¹´ 11 æ 19 æ¥è¯´èµ·ãé£å¤©ï¼å¾®è½¯ä¸ Anthropic è¾¾æåä½ï¼å®£å¸å°å¨ Azure å¹³å°ä¸æä¾ Anthropic ç Claude å¤§æ¨¡åæå¡ãè¿æå³çå¼åèåä¼ä¸ç¨æ·å¯ä»¥éè¿ Azure äºæå¡è®¿é® Claude æ¨¡åã</p>
<p>ä½ä¸ºä¸åå¾®è½¯ MVPï¼ææ¬ä»¥ä¸º Claude æ¨¡åå¯¹ MVP é¢åº¦æ¥è¯´æ¯å¯ä»¥ä½¿ç¨çï¼å ä¸ºæ ¹æ®ä»¥å¾çç»éªï¼å¦ææ²¡æèµæ ¼ä½¿ç¨æé¡¹æå¡ï¼éå¸¸ä¼ç´æ¥å¨æ§å¶å°éæç¤ºâæ æéâæâæ æ³å¯ç¨âï¼èä¸æ¯ç´æ¥åè®¸ä½¿ç¨ç¶åäº§çé«é¢è´¹ç¨ï¼ä½æå¤§æäºã</p>
<p>å æ­¤æç¬¬ä¸æ¶é´å°±æ³å°äºå° Claude æ¨¡åéæå°æèªå·±çé¡¹ç®ä¸­ââ<strong>Sdcb Chats</strong>ã</p>
<p>å½æ¶ä¸ºäºç¡®ä¿ Anthropic Messages API å·¥ä½æ­£å¸¸ä¸ç¨³å®ï¼æåäºå¤§éçæµè¯ãä¸ºäºéªè¯å¼å®¹æ§ï¼æçè³è¿âç«èµ·æ¥è¹¬âï¼ç´æ¥æ¥å¥äº Anthropic å®æ¹çå½ä»¤è¡å·¥å· <code>Claude Code</code> æ¥è· Opus æ¨¡åã</p>
<p>ç»æâ¦â¦ç­ç­ 2 å¤©æ¶é´ï¼æå¨ Azure ä¸è· Claude æ¨¡åç API è°ç¨è´¹ç¨å°±é«è¾¾ <strong>192.95 ç¾å</strong>ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120172700464-1622754976.png" alt="" loading="lazy"></p>
<p>å½æ¶çå°è´¦åæ´ä¸ªäººé½æ¯èçãä¸è¿å¥½å¨âæ°ªéâæ²¡æç½è´¹ï¼æç»ææåå° Claude æ¨¡åå®ç¾éæå°äº Sdcb Chats ä¸­ãç°å¨ï¼å¤§å®¶å¯ä»¥å¨ Chats ä¸­æå¿«å°ä½¿ç¨ Claude æ¨¡åäºï¼</p>
<hr>
<h2 id="190-çæ ¸å¿anthropic-å¨é¢è½å°">1.9.0 çæ ¸å¿ï¼Anthropic å¨é¢è½å°</h2>
<p>å¨ 1.9.0 ä¹åï¼Chats å¯¹ Claude çæ¯æåªè½è¯´æ¯âè½ç¨âï¼å ä¸ºå¹¶æ²¡æåçæ¯æ Anthropic Messages APIï¼éè¦éè¿ OpenAI å¼å®¹æ¥å£è½¬è¯ââè OpenAI Chat Completions å¼å®¹æ¥å£å¹¶ä¸æ¯æ Extended Thinkingãä½è¿ä¸æ¬¡ï¼ææ¯<strong>åçæ¯æ</strong>ã</p>
<h3 id="åç-httpclient-å®ç°ä¸-thinking-æ¯æ">åç HttpClient å®ç°ä¸ Thinking æ¯æ</h3>
<p>ä¸ºäºè¿½æ±æè´çæ§è½åå¯æ§æ§ï¼æéåäº Chats çåºå±è°ç¨é»è¾ã</p>
<p>åæ¬ Anthropic æä¾äº<a href="https://github.com/anthropics/anthropic-sdk-csharp" target="_blank" rel="noopener nofollow">Anthropic C# API Library</a>ï¼æä¸å¼å§ä½¿ç¨äºè¿ä¸ª SDKï¼ä½åç°éé¢çéªè¯é»è¾æç¹å¤ªè¿åäºï¼è¿æ¨¡ååç§°é½è¦éªè¯ï¼æ¥éè¯´ï¼<code>AnthropicInvalidDataException: Data did not match any variant of RawMessageStreamEvent</code>ï¼ãå¨æå¼åçæ¶åï¼Opus æ¨¡åè¿æ²¡åå¸ 4.5 çæ¬ï¼æä½¿ç¨è¿ä¸ª SDK è¿èªå®¶ç Claude 4.5 Opus é½æ¥éï¼ç¬æ­»ï¼æ´ä¸è¦æç¨è¿ä¸ª SDK è¿æ¥å½äº§ç MiniMax/GLM/DeepSeek v3.2 äºï¼è¿ç§æä½éå¸¸âAnthropicâï¼è¿ä¸ªé®é¢ç´å° <strong>2026-01-14</strong> åå¸ç <code>12.2.0</code> çæ¬ä¸­æè§£å³ï¼ï¼ã</p>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120214334386-1499186789.png" alt="image" loading="lazy"></p>
<p>å æ­¤æç <code>Git</code> æäº¤è®°å½éå¯ä»¥çå°ï¼æä¸å¼å§æ¯åå¤èµ° SDK å Anthropic æ¯æçï¼ä½æç»åæ¾å¼äºï¼è½¬èå¨ä»£ç ä¸­ç¨åç <code>HttpClient</code> ææ¸äºä¸ä¸ªè¿ 1000 è¡ç <code>AnthropicChatService</code>ã</p>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120172700992-1302091122.png" alt="" loading="lazy"></p>
<p>è¿æå³çä»ä¹ï¼</p>
<ol>
<li>
<p><strong>å®æ´æ¯æ Thinkingï¼æç»´é¾ï¼</strong>ï¼Claude æ¨¡åç Thinking å¯ä»¥åå¨å®æ¹ç½é¡µçé£æ ·å±ç¤ºï¼æ¯ææµå¼è¾åºï¼âæèâä¸âåç­âåç¦»ãä¸ºæ­¤æå¨æ°æ®åºä¸­ä¸é¨æ°å¢äº <code>StepContentThink</code> è¡¨ï¼ç¨äºç¬ç«å­å¨æç»´åå®¹ã</p>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120172701332-89257932.png" alt="" loading="lazy"></p>
</li>
<li>
<p><strong>Signatureï¼ç­¾åï¼éªè¯</strong>ï¼Chats ç°å¨è½æ­£ç¡®å¤çåå­å¨ Claude çæç»´ç­¾åï¼Signatureï¼ï¼ç¡®ä¿è¯æ®é¾å®æ´ã</p>
</li>
<li>
<p><strong>Vision Link ä¼å</strong>ï¼é»è®¤ä½¿ç¨ URL èé Base64 ä¼ å¾ï¼å¤§å¹èçå¸¦å®½å Tokenã</p>
</li>
</ol>
<p>åæ¶ï¼æè¿å¼å¥äº <code>MaxThinkingBudget</code>ï¼æ¨¡åçº§ï¼å <code>ThinkingBudget</code>ï¼ä¼è¯çº§ï¼éç½®ï¼é²æ­¢ä½ ç Token ååæä¸æ ·âä¸ç¥ä¸è§âå°ç§å®ã</p>
<hr>
<h2 id="åå£³ä¸ä½anthropic-messages-api-å¼å®¹">âåå£³ä¸ä½âï¼Anthropic Messages API å¼å®¹</h2>
<p>è¿ä¸æ¡å¯è½æ¯åçæ¯ææ´ç¡¬æ ¸ã</p>
<p>Chats 1.9.0 <strong>ååå®ç°</strong>äº Anthropic çå®æ¹ API åè®®ï¼<code>/v1/messages</code>ï¼ãæå¨ <code>src/BE/web/Controllers/Api/AnthropicCompatible/AnthropicMessagesController.cs</code> ä¸­å®æ´å¤å»äº Anthropic çæ¥å£è§èãè¿æå³ç Chats ä¸ä»æ¯ä¸ä¸ªå®¢æ·ç«¯ï¼å®æ¬èº«ä¹åæäºä¸ä¸ª<strong>æ åç Anthropic API æå¡ç«¯</strong>ã</p>
<p><strong>ä¸ºä»ä¹è¦è¿ä¹åï¼</strong></p>
<p>å ä¸ºç°å¨æå¾å¤ä¼ç§çå·¥å·ï¼æ¯å¦ CursorãClaude Codeãåç§ AI æä»¶ï¼åªæ¯æ Anthropic åçåè®®ãä¸ºäºæ¯æå®æ¹ç <code>claude-code</code> å½ä»¤è¡å·¥å·ï¼å¦å¨å¾ï¼åå°å¯ä»¥å®æ¶è¿½è¸ª Claude Code çä½¿ç¨ä¿¡æ¯ï¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120172701746-1289382319.avif" alt="" loading="lazy"></p>
<p>æçè³ä¸é¨ä¿®å¤äº System Prompt çè§£æé»è¾ï¼åæ¶ï¼æè¿å¼å¥äº <code>MaxThinkingBudget</code>ï¼æ¨¡åçº§ï¼å <code>ThinkingBudget</code>ï¼ä¼è¯çº§ï¼éç½®ï¼ä»¥å <strong>Prompt Cache Token</strong> çè®¡è´¹æ¯æï¼Commit <code>85a1c2a6</code>ï¼ï¼é²æ­¢ä½ ç Token ååæä¸æ ·âä¸ç¥ä¸è§âå°ç§å®ã</p>
<p>æ¢ç¶ Chats å·²ç»åæäºä¸ä¸ªå¼ºå¤§ç API ç½å³ï¼é£ä¹éå¥çå¼åèä½éªå¿é¡»è·ä¸ã</p>
<p>1.9.0 æ°å¢äº <strong>Build</strong> æ¨¡åï¼åå«ä¸ä¸ªæ ¸å¿é¡µé¢ï¼</p>
<ul>
<li><strong>API Keys</strong>ï¼æ´å®å¨çå¯é¥ç®¡çï¼æ¯æè¿ææ¶é´ãå¤æ³¨ï¼è¿è½çå°å¯é¥æ©ç ã</li>
<li><strong>Docs</strong>ï¼ä¸ç«å¼ææ¡£ï¼ååºäºææå¼å®¹ OpenAI å Anthropic ç API ç«¯ç¹ï¼æ¯æä¸é®å¤å¶ï¼ã</li>
<li><strong>Usage</strong>ï¼æ API Key ç»´åº¦çç¨éç»è®¡ï¼è°ç¨äºå¤å° Tokenï¼ä¸ç®äºç¶ã</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120172702273-280531674.png" alt="" loading="lazy"></p>
<hr>
<h2 id="è§è§çäº§åopenai-å¾å-api-ä¸-net-10">è§è§çäº§åï¼OpenAI å¾å API ä¸ .NET 10</h2>
<p>é¤äºå¤§è¯­è¨æ¨¡åï¼1.9.0 è¿è¡¥é½äºè§è§è½åï¼</p>
<ul>
<li>å®ç°äºæ åç OpenAI å¾åçæï¼<code>/v1/images/generations</code>ï¼åç¼è¾ï¼<code>/v1/images/edits</code>ï¼APIã</li>
<li>éååç«¯ç <strong>ChatInput å¨ç»ä¼å</strong>ï¼ç°å¨çå¾ççæä½éªæ´å æµçã</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120172702911-1941831639.png" alt="" loading="lazy"></p>
<p>æåï¼ä½ä¸ºä¸ä¸ª .NET ä¿¡ä»°ç²ï¼Chats 1.9.0 å·²ç»<strong>å¨çº¿åçº§å°äº .NET 10</strong>ãè½ç¶ç¨æ·æç¥ä¸å¼ºï¼ä½è¿å¸¦æ¥äºæ´å¥½çæ§è½åæ´ç°ä»£çåºå±è®¾æ½ï¼ä¸ºæªæ¥çé¿è¿åå±æä¸äºåºç¡ã</p>
<hr>
<h2 id="ç»è¯­ä¸ºäºæ´èªç±ç-ai-ç½å³">ç»è¯­ï¼ä¸ºäºæ´èªç±ç AI ç½å³</h2>
<p>ä» 1.7 ç MCP è½å°ï¼å° 1.9 ç Anthropic åçæ¯æä¸ API å¼å®¹ï¼Chats æ­£å¨ä¸æ­¥æ­¥ä»ä¸ä¸ªâèå¤©ç½é¡µâè¿åæä¸ä¸ª<strong>çæ­£éç¨ç AI åºç¡è®¾æ½</strong>ã</p>
<p>é£ä¸ª 200 ç¾åçè´¦åè½ç¶è®©äººå¿çï¼ä½å®æ¢æ¥äº Chats å¯¹ Claude çå®ç¾æ¯æï¼ä»¥åé£æ®µâä¸ºäºæµè¯èç¯çè°ç¨âçæ¿ææ¶åï¼æè§å¾ââå¼äºï¼</p>
<p>å¦å¤ç¸ä¿¡æï¼æåäºä¸ååªåå°è¯èç³»å¾®è½¯å Anthropicï¼äºåæé£ 200 ç¾åçè´¹ç¨ç»è¦åæ¥ï¼ä½ä»ä»¬äºç¸æ¨è¯¿ï¼ä¹æ²¡è¯´æ¯ç¨æ·èªå·±çè¡ä¸ºæèå¹³å°è´£ä»»ï¼åªæ¯äºç¸è¯´è¿æ¯å¯¹æ¹ï¼å¾®è½¯/Anthropicï¼çè´£ä»»ï¼æä»¥æåä¹å°±ä¸äºäºä¹äºã</p>
<p>æè°¢éè¯»ï¼åæ¬¢çæåè¯·ç»æç GitHub é¡¹ç®ä¸ä¸ª starï¼<a href="https://github.com/sdcb/chats" target="_blank" rel="noopener nofollow">https://github.com/sdcb/chats</a></p>
<p>è¿æ¯å®æ´çæ´æ°æ¥å¿ï¼<a href="https://github.com/sdcb/chats/blob/main/doc/zh-CN/release-notes/README.md" target="_blank" rel="noopener nofollow">https://github.com/sdcb/chats/blob/main/doc/zh-CN/release-notes/README.md</a></p>
<p>æä»ä¹æ³æ³ä¹æ¬¢è¿å¨è¯è®ºåºçè¨äº¤æµï¼ä¹æ¬¢è¿å å¥æçæ°åå»ºçå¾®ä¿¡ç¾¤ï¼</p>
<p><img src="https://io.starworks.cc:88/cv-public/2026/chats-wxg-qr.png" alt="" loading="lazy"></p>
<p>å¦æä½ æ´ä¹ æ¯ç¨ QQ çè¯ï¼ä¹å¯ä»¥å å¥ Chats QQ ç¾¤ï¼498452653ï¼æä»¬ä¸èµ·æ¢ç´¢æ´å¤ AI ææ¯ç¡¬æ ¸ç©æ³ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-21 08:45">2026-01-21 08:45</span>&nbsp;
<a href="https://www.cnblogs.com/sdcb">.NETéªæä½</a>&nbsp;
éè¯»(<span id="post_view_count">629</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508169);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508169', targetLink: 'https://www.cnblogs.com/sdcb/p/19508169/20260120-chats-190', title: 'ä¸¤å¤©ç§æ200ç¾åï¼æAIå¤§æ¨¡åç½å³ç»äºæ¯æäºClaudeæ¨¡å' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ºä»ä¹ IO æµéå¸¸åªè½è¢«è¯»åä¸æ¬¡ ]]></title>
    <link>https://www.cnblogs.com/yanshajiuzhou/p/19508716</link>
    <guid>8d3025a7d271c46f648b13878349879c</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yanshajiuzhou/p/19508716" title="åå¸äº 2026-01-20 20:22">
    <span role="heading" aria-level="2">ä¸ºä»ä¹ IO æµéå¸¸åªè½è¢«è¯»åä¸æ¬¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        IO æµåªè½è¯»åä¸æ¬¡ï¼æ¯ ç²¾å¿è®¾è®¡çï¼è´´åæä½ç³»ç»æä»¶ / ç½ç» IO ç "é¡ºåºæ¶è´¹"&nbsp;ç¹æ§ï¼ä¿æååºå±ç³»ç»çä¸è´æ§ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>ä»å¤©æä»¬æ¥ä¸èµ·æ¢è®¨ä¸&nbsp;ä¸ºä»ä¹<strong> IO æµ</strong>éå¸¸åªè½è¢«è¯»åä¸æ¬¡ï¼</p>
<p>æä¸ºä»ä¹ä¼ååºè¿ä¸ªçé®å¢ï¼æ¯å ä¸ºæç ç©¶Webå¼åä¸­çä¸ä¸ªé®é¢æ¶ï¼HTTPè¯·æ±ä½å¨ <strong>Filterï¼è¿æ»¤å¨ï¼</strong>å¤è¢«è¯»åäºä¹åï¼å¨ Controllerï¼æ§å¶å±ï¼å°±è¯»ä¸å°å¼äºï¼ä½¿ç¨ @RequestBody çæ¶åã</p>
<p>æ è®ºæ¯å­èæµï¼InputStream / OutputStreamï¼è¿æ¯å­ç¬¦æµï¼Reader / Writerï¼ï¼ææåºäºæµçè¯»åæä½é½ä¼ç»´æ¤ä¸ä¸ª <strong>"ä½ç½®æé"</strong>ã</p>
<ul>
<li>åå§ç¶æä¸ï¼æéæåæµçèµ·å§ä½ç½®<strong>ï¼position = 0ï¼</strong>ï¼</li>
<li>æ¯æ¬¡è°ç¨ <strong>read() / read(byte[]) / read(char[])</strong> ç­è¯»åæ¹æ³æ¶ï¼æéä¼ååç§»å¨å¯¹åºå­èæ°ï¼</li>
<li>å½æéç§»å¨å°æµçæ«å°¾ï¼æ²¡ææ´å¤æ°æ®ï¼ï¼read() æ¹æ³ä¼è¿å <strong>-1</strong>ï¼è¡¨ç¤ºæµè¯»åå®æ¯ï¼</li>
<li>æéç§»å¨åä¸ä¼èªå¨åéï¼ä¹æ æ³ååç§»å¨ï¼é¤éæµæ¾å¼æ¯æéç½®ï¼ï¼å æ­¤åæ¬¡è¯»ååªè½å¾å° <strong>-1</strong>ã</li>
</ul>
<p><strong>ç±»æ¯</strong>ï¼<strong>IO æµ</strong>çè¯»åè¿ç¨ï¼å°±åç¨ <strong>ç£å¸¦æ­æ¾å¨å¬ç£å¸¦</strong> ââ ç£å¤´ï¼å¯¹åºæµçä½ç½®æéï¼ä»ç£å¸¦å¼å¤´ï¼æé 0ï¼å¼å§ç§»å¨ï¼æ¯è¯»ä¸ä¸ªå­è / å­ç¬¦ï¼ç£å¤´å°±å¾åèµ°ä¸æ­¥ï¼å½ç£å¤´èµ°å°ç£å¸¦æ«å°¾ï¼åç»§ç»­æ­æ¾ï¼è¯»åï¼å°±åªè½å¬å° "æ²æ²å£°"ï¼æµè¿å <strong>-1</strong>ï¼ï¼å¹¶ä¸ç£å¤´ä¸ä¼èªå¨åå°å¼å¤´ã</p>
<p>å½ç¶ï¼<strong>ä¸æ¯æææµé½åªè½è¯»ä¸æ¬¡</strong>ï¼<strong>åºäºåå­çæµ</strong>ï¼å¦ <strong>ByteArrayInputStream / CharArrayReader</strong>ï¼æ¯æéç½®æéï¼å ä¸ºå®ä»¬çæ°æ®æºæ¯åå­ä¸­çæ°ç»ï¼<strong>æ°æ®ä¸ä¼æ¶å¤±</strong>ï¼ï¼å¯ä»¥éè¿ <strong>mark()</strong> å <strong>reset()&nbsp;</strong>æ¹æ³å°æé <strong>æ¢å¤</strong> å°æ è®°ä½ç½®ã</p>
<p>éè¦æ³¨æï¼</p>
<ul>
<li>è°ç¨ <strong>reset()&nbsp;</strong>åå¿é¡»åè°ç¨ <strong>mark(int readlimit)</strong>ï¼</li>
<li>ä¸æ¯æææµé½æ¯æ <strong>mark() / reset()</strong>ï¼å¯ä»¥éè¿ <strong>inputStream.markSupported()</strong> æ¥è¿è¡å¤æ­ã</li>
</ul>
<p><strong>ä½¿ç¨ mark() å reset() æ¹æ³ï¼</strong></p>
<pre class="language-java highlighter-hljs"><code>// ä»éç¨äºæ¯æmarkçæµ
public void processWithMark(InputStream input) throws IOException {
    if (!input.markSupported()) {
        throw new IOException("Mark not supported");
    }
    
    // æ è®°å½åä½ç½®ï¼åæ°100è¡¨ç¤ºæå¤å¯åé100å­è
    input.mark(100);
    
    // ç¬¬ä¸æ¬¡è¯»å
    byte[] firstRead = new byte[50];
    input.read(firstRead);
    System.out.println("First read: " + new String(firstRead));
    
    // éç½®å°æ è®°ä½ç½®
    input.reset();
    
    // ç¬¬äºæ¬¡è¯»åï¼ç¸ååå®¹ï¼
    byte[] secondRead = new byte[50];
    input.read(secondRead);
    System.out.println("Second read: " + new String(secondRead));
}</code></pre>
<p>ä½¿ç¨ <strong>åè£ç±»</strong> è§£å³ä¸ææä»¬æå°ç&nbsp;<strong>HTTPè¯·æ±ä½å¤æ¬¡è¯»å </strong>çé®é¢ï¼</p>
<pre class="language-java highlighter-hljs"><code>public class MyRequestWrapper extends HttpServletRequestWrapper {
    private final byte[] body; // ç¼å­è¯·æ±ä½çå­èæ°ç»

    public MyRequestWrapper(HttpServletRequest request) throws IOException {
        super(request);
        // å³é®æ­¥éª¤ï¼å¨æé æ¶ä¸æ¬¡æ§è¯»åå¹¶å­å¨åå§è¯·æ±æµ
        body = StreamUtils.copyToByteArray(request.getInputStream());
    }

    // æä¾ä¸ä¸ªä¾¿æ·æ¹æ³ï¼ç¨äºå¨è¿æ»¤å¨ä¸­è·åè¯·æ±ä½åå®¹ï¼ä¾å¦è®°å½æ¥å¿ï¼
    // ä½¿ç¨æ¶ï¼ç´æ¥è°ç¨ getBodyString() å³å¯
    public String getBodyString() throws UnsupportedEncodingException {
        return new String(body, this.getCharacterEncoding());
    }

    @Override
    public ServletInputStream getInputStream() throws IOException {
        // æ¯æ¬¡è°ç¨é½è¿åä¸ä¸ªåºäºç¼å­æ°æ®çæ°æµ
        ByteArrayInputStream bais = new ByteArrayInputStream(body);
        return new ServletInputStream() {
            @Override
            public int read() {
                return bais.read();
            }

            @Override
            public boolean isFinished() {
                return bais.available() == 0;
            }

            @Override
            public boolean isReady() {
                return true;
            }

            @Override
            public void setReadListener(ReadListener readListener) {
                // æ éå®ç°
            }
        };
    }

    @Override
    public BufferedReader getReader() throws IOException {
        return new BufferedReader(new InputStreamReader(this.getInputStream(), this.getCharacterEncoding()));
    }
}</code></pre>
<p>ç¶åå¨ <strong>è¿æ»¤å¨</strong> å¤åè£è¯·æ±ï¼</p>
<pre class="language-java highlighter-hljs"><code>@Slf4j
@Configuration
public class RequestCachingFilterConfig {

    @Bean
    public FilterRegistrationBean requestCachingFilter() {
        FilterRegistrationBean registrationBean = new FilterRegistrationBean();

        // æ ¸å¿ï¼åå»ºè¿æ»¤å¨ï¼åè£è¯·æ±ä¸º ContentCachingRequestWrapper
        registrationBean.setFilter(new OncePerRequestFilter() {
            @Override
            protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
                    throws ServletException, IOException {
                // 1. ä»åè£ HTTP è¯·æ±ï¼æé¤ WebSocket ç­ï¼
                if (request instanceof HttpServletRequest &amp;&amp; !(request instanceof ContentCachingRequestWrapper)) {
                    log.info("==========è¿å¥requestCachingFilter========");
                    // 2. åè£è¯·æ±ï¼èªå¨ç¼å­è¯·æ±ä½ï¼
                    MyRequestWrapper wrappedRequest = new MyRequestWrapper(request);
                    filterChain.doFilter(wrappedRequest, response); // ä¼ éåè£åçè¯·æ±
                } else {
                    filterChain.doFilter(request, response); // æ éåè£ï¼ç´æ¥æ¾è¡
                }
            }
        });

        // 3. éç½®æ¦æªææè¯·æ±ï¼å¯æ ¹æ®éæ±è°æ´ URL æ¨¡å¼ï¼
        registrationBean.addUrlPatterns("/*");
        registrationBean.setOrder(1); // ä¼åçº§æé«ï¼ç¡®ä¿åäºå¶ä»è¿æ»¤å¨æ§è¡
        registrationBean.setName("requestCachingFilter");
        return registrationBean;
    }
}</code></pre>
<p><strong>IO æµ</strong>åªè½è¯»åä¸æ¬¡ï¼æ¯ <strong>ç²¾å¿è®¾è®¡ç</strong>ï¼è´´åæä½ç³»ç»æä»¶ / ç½ç» IO ç <strong>"é¡ºåºæ¶è´¹"</strong>&nbsp;ç¹æ§ï¼ä¿æååºå±ç³»ç»çä¸è´æ§ã</p>
<p style="text-align: right"><span style="color: rgba(53, 152, 219, 1)">å¤å¨å½¢å¼è¶ç®åçä¸è¥¿ï¼æºæ§å«éè¶é«ï¼å ä¸ºå®å·²ç»ä¸åä¾èµå½¢å¼ï¼å¿é¡»ä¾é æºæ§ã-- çæ²ä¹æ´²</span></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 20:23">2026-01-20 20:22</span>&nbsp;
<a href="https://www.cnblogs.com/yanshajiuzhou">çæ²ä¹æ´²</a>&nbsp;
éè¯»(<span id="post_view_count">368</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508716);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508716', targetLink: 'https://www.cnblogs.com/yanshajiuzhou/p/19508716', title: 'ä¸ºä»ä¹ IO æµéå¸¸åªè½è¢«è¯»åä¸æ¬¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åå« throw exceptionï¼ä¸ºä»ä¹ Result<T> ææ¯ä¸å¡é»è¾çæ­£ç¡®éæ© ]]></title>
    <link>https://www.cnblogs.com/diamondhusky/p/19508626</link>
    <guid>5b146f83f56da1052f4440a052407726</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/diamondhusky/p/19508626" title="åå¸äº 2026-01-20 19:40">
    <span role="heading" aria-level="2">åå« throw exceptionï¼ä¸ºä»ä¹ Result&lt;T&gt; ææ¯ä¸å¡é»è¾çæ­£ç¡®éæ©</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="å¼è¨ä¸ä¸ªæ®éå­å¨çåå³é">å¼è¨ï¼ä¸ä¸ªæ®éå­å¨çâåå³éâ</h1>
<p>å¦æä½ å¨C#é¡¹ç®ä¸­çå°è¿æ ·çä»£ç ï¼ä¸å®ä¸ä¼æå°éçï¼</p>
<pre><code class="language-csharp">public User Login(string username, string password)
{
    var user = FindUser(username);
    if (user == null)
        throw new Exception("ç¨æ·ä¸å­å¨");  // â çæçæ¨¡å¼
    
    if (!VerifyPassword(user, password))
        throw new Exception("å¯ç éè¯¯");    // â å¦ä¸ä¸ªçæçæ¨¡å¼
    
    return user;
}
</code></pre>
<p>è¿ç§ä½¿ç¨å¼å¸¸æ¥å¤çä¸å¡é»è¾çåæ³ï¼å ä¹æäºC#å¼åçâæ åèå¼âã<br>
å¯æ¯ï¼<strong>ä»æ¥å¦æ­¤ï¼ä¾¿æ¯å¯¹çä¹ï¼</strong></p>
<h1 id="ä¸å¼å¸¸çåç½ª--æä»¬ä¸ç´å¨æ»¥ç¨å®">ä¸ãå¼å¸¸çâåç½ªâ ââ æä»¬ä¸ç´å¨æ»¥ç¨å®</h1>
<h2 id="11-å¼å¸¸çæ¬è´¨æ¯ä»ä¹">1.1 å¼å¸¸çæ¬è´¨æ¯ä»ä¹ï¼</h2>
<p>é¦åï¼æä»¬è¦æç½C#è¯­è¨éçå¼å¸¸ï¼Exceptionï¼çè®¾è®¡åè¡·ï¼</p>
<pre><code class="language-csharp">// è¿äºææ¯å¼å¸¸çæ­£çä½¿ç¨åºæ¯ï¼
public void ReadFile(string path)
{
    if (string.IsNullOrEmpty(path))
        throw new ArgumentNullException(nameof(path));  // â åæ°æ£æ¥
    
    if (!File.Exists(path))
        throw new FileNotFoundException($"æä»¶ä¸å­å¨: {path}");  // â ç³»ç»éè¯¯
    
    // å°è¯è¯»åæä»¶ï¼å¯è½æåºIOExceptionç­
    var content = File.ReadAllText(path);
}
</code></pre>
<p>å¼å¸¸æ¯ä¸ºçæ­£ç"å¼å¸¸æåµ"è®¾è®¡çï¼æ¯å¦ï¼</p>
<ul>
<li>ç³»ç»èµæºä¸å¯ç¨ï¼æä»¶ä¸å­å¨ãæ°æ®åºè¿æ¥å¤±è´¥ï¼</li>
<li>ç¨åºç¶æå¼å¸¸ï¼ç©ºæéãæ°ç»è¶çï¼</li>
<li>åæ°éªè¯å¤±è´¥ï¼åç½®æ¡ä»¶ä¸æ»¡è¶³ï¼</li>
</ul>
<h2 id="12-ä¸å¡é»è¾--å¼å¸¸æåµ">1.2 ä¸å¡é»è¾ â  å¼å¸¸æåµ</h2>
<p>ä¸å¡éè¯¯ï¼ç¨æ·ä¸å­å¨ãå¯ç éè¯¯ãä½é¢ä¸è¶³ï¼æ¯<strong>å¯é¢è§çæ­£å¸¸ä¸å¡æµç¨</strong>ï¼èä¸æ¯å¼å¸¸æåµã<br>
æä¸å¡éè¯¯ç¨å¼å¸¸å¤çï¼å°±åï¼</p>
<ul>
<li>ç¨"å°éè­¦æ¥"æ¥å¤ç"å®¶éæ²¡ç±³äº"</li>
<li>ç¨"æ¶é²è½¦"æ¥è¿é"å¿«éåè£¹"</li>
<li>ç¨"ææ¯å®¤"æ¥å¤ç"æååç§"</li>
</ul>
<p>è¿æ¯å¯¹å¼å¸¸æºå¶çä¸¥éæ»¥ç¨ï¼</p>
<h1 id="äºresultä¸å¡é»è¾çä¼ééçº§">äºãResult<t>ââä¸å¡é»è¾ç"ä¼ééçº§"</t></h1>
<h2 id="21-ä»ä¹æ¯result">2.1 ä»ä¹æ¯Result<t>ï¼</t></h2>
<p>ä¸ä¸ªç®åï¼å·å¤åºæ¬åè½çResultç±»å¦ä¸ï¼</p>
<pre><code class="language-csharp">public class Result&lt;T&gt;
{
    public bool Success { get; }
    public T? Value { get; }
    public string? Error { get; }
    
    private Result(T value) { Success = true; Value = value; Error = null; }
    private Result(string error) { Success = false; Value = default; Error = error; }
    
    public static Result&lt;T&gt; Ok(T value) =&gt; new(value);
    public static Result&lt;T&gt; Fail(string error) =&gt; new(error);
}
</code></pre>
<h2 id="22-å¦ä½æ­£ç¡®ä½¿ç¨result">2.2 å¦ä½æ­£ç¡®ä½¿ç¨Result<t>ï¼</t></h2>
<pre><code class="language-csharp">public Result&lt;User&gt; Login(string username, string password)
{
    if (string.IsNullOrEmpty(username))
        return Result&lt;User&gt;.Fail("ç¨æ·åä¸è½ä¸ºç©º");  // â æç¡®è¿åä¸å¡éè¯¯
    
    if (string.IsNullOrEmpty(password))
        return Result&lt;User&gt;.Fail("å¯ç ä¸è½ä¸ºç©º");    // â æç¡®è¿åä¸å¡éè¯¯
    
    var user = FindUser(username);
    if (user == null)
        return Result&lt;User&gt;.Fail("ç¨æ·ä¸å­å¨");      // â æç¡®è¿åä¸å¡éè¯¯
    
    if (!VerifyPassword(user, password))
        return Result&lt;User&gt;.Fail("å¯ç éè¯¯");        // â æç¡®è¿åä¸å¡éè¯¯
    
    return Result&lt;User&gt;.Ok(user);                   // â æç¡®è¿åæå
}
</code></pre>
<h1 id="ä¸æ§è½å¯¹å³--å è¿ç¢¾åçæ§è½å·®è·">ä¸ãæ§è½å¯¹å³ ââ å è¿ç¢¾åçæ§è½å·®è·</h1>
<h2 id="31-é¨åæµè¯ä»£ç ">3.1 é¨åæµè¯ä»£ç </h2>
<p>é¡¹ç®ç¯å¢ï¼</p>
<pre><code>&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
	&lt;PropertyGroup&gt;
		&lt;OutputType&gt;Exe&lt;/OutputType&gt;
		&lt;TargetFramework&gt;net8.0&lt;/TargetFramework&gt;
		&lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
		&lt;Nullable&gt;enable&lt;/Nullable&gt;
		&lt;LangVersion&gt;latest&lt;/LangVersion&gt;
	&lt;/PropertyGroup&gt;
&lt;/Project&gt;
</code></pre>
<p>é¨åæµè¯ä»£ç ï¼</p>
<pre><code class="language-csharp"> public class LoginService
 {
     private readonly Dictionary&lt;string, User&gt; _users = new()
     {
         ["valid_user"] = new User { Id = 1, Username = "valid_user" }
     };

    
     public User LoginWithException(string username, string password)
     {
         if (!_users.TryGetValue(username, out var user))
             throw new BusinessException("ç¨æ·ä¸å­å¨");

         if (password != "correct_password")
             throw new BusinessException("å¯ç éè¯¯");

         return user;
     }

    
     public Result&lt;User&gt; LoginWithResult(string username, string password)
     {
         if (!_users.TryGetValue(username, out var user))
             return Result&lt;User&gt;.Fail("ç¨æ·ä¸å­å¨");

         if (password != "correct_password")
             return Result&lt;User&gt;.Fail("å¯ç éè¯¯");

         return Result&lt;User&gt;.Ok(user);
     }
 }
</code></pre>
<pre><code class="language-csharp">public class PerformanceTester
{
    private readonly LoginService _service = new();
    private readonly Random _random = new(42);

    public void RunAllTests(int iterations = 1000000)
    {
        Console.WriteLine($"æ§è½å¯¹æ¯æµè¯ - è¿­ä»£æ¬¡æ°: {iterations:N0}");
        Console.WriteLine("=".PadRight(60, '='));

        // æµè¯1ï¼æåè·¯å¾ï¼æ­£å¸¸æåµï¼
        TestSuccessPath(iterations);

        // æµè¯2ï¼å¤±è´¥è·¯å¾ï¼éè¯¯æåµï¼
        TestErrorPath(iterations);

        // æµè¯3ï¼æ··åè·¯å¾ï¼30%æåçï¼
        TestMixedPath(iterations, 0.3);
    }

    private void TestSuccessPath(int iterations)
    {
        Console.WriteLine("\næµè¯1ï¼æåè·¯å¾ï¼100%æåï¼");

        // å¼å¸¸æ¹å¼
        var exceptionTime = Measure(() =&gt;
        {
            try
            {
                _service.LoginWithException("valid_user", "correct_password");
            }
            catch
            {
                // ä¸åºè¯¥åç
            }
        }, iterations, "å¼å¸¸æ¹å¼");

        // Resultæ¹å¼
        var resultTime = Measure(() =&gt;
        {
            var result = _service.LoginWithResult("valid_user", "correct_password");
            if (!result.Success)
            {
                // ä¸åºè¯¥åç
            }
        }, iterations, "Resultæ¹å¼");

        PrintComparison(exceptionTime, resultTime);
    }

    private void TestErrorPath(int iterations)
    {
        Console.WriteLine("\næµè¯2ï¼å¤±è´¥è·¯å¾ï¼100%å¤±è´¥ï¼");

        // å¼å¸¸æ¹å¼
        var exceptionTime = Measure(() =&gt;
        {
            try
            {
                _service.LoginWithException("invalid_user", "wrong_password");
            }
            catch (BusinessException)
            {
                // é¢æå¼å¸¸
            }
        }, iterations, "å¼å¸¸æ¹å¼");

        // Resultæ¹å¼
        var resultTime = Measure(() =&gt;
        {
            var result = _service.LoginWithResult("invalid_user", "wrong_password");
            if (result.Success)
            {
                // ä¸åºè¯¥åç
            }
        }, iterations, "Resultæ¹å¼");

        PrintComparison(exceptionTime, resultTime);
    }

    private void TestMixedPath(int iterations, double successRate)
    {
        Console.WriteLine($"\næµè¯3ï¼æ··åè·¯å¾ï¼{successRate:P0}æåçï¼");

        // åå¤æµè¯æ°æ®
        var testData = new (string user, string pwd, bool shouldSucceed)[iterations];
        for (int i = 0; i &lt; iterations; i++)
        {
            testData[i] = _random.NextDouble() &lt; successRate
                ? ("valid_user", "correct_password", true)   // æå
                : ("invalid_user", "wrong_password", false); // å¤±è´¥
        }

        // å¼å¸¸æ¹å¼
        var exceptionTime = MeasureMixed(testData, true, "å¼å¸¸æ¹å¼");

        // Resultæ¹å¼
        var resultTime = MeasureMixed(testData, false, "Resultæ¹å¼");

        PrintComparison(exceptionTime, resultTime);
    }

    private static long Measure(Action action, int iterations, string testName)
    {
        // é¢ç­
        for (int i = 0; i &lt; 1000; i++) action();

        GC.Collect();
        GC.WaitForPendingFinalizers();
        GC.Collect();

        var sw = Stopwatch.StartNew();
        for (int i = 0; i &lt; iterations; i++)
        {
            action();
        }
        sw.Stop();

        var opsPerSecond = iterations / (sw.ElapsedMilliseconds / 1000.0);
        Console.WriteLine($"  {testName}: {sw.ElapsedMilliseconds,8}ms ({opsPerSecond,12:N0} ops/s)");

        return sw.ElapsedMilliseconds;
    }

    private long MeasureMixed(
        (string user, string pwd, bool shouldSucceed)[] testData,
        bool useException,
        string testName)
    {
        // é¢ç­
        for (int i = 0; i &lt; Math.Min(1000, testData.Length); i++)
        {
            var (user, pwd, _) = testData[i];
            if (useException)
            {
                try
                {
                    _service.LoginWithException(user, pwd);
                }
                catch { }
            }
            else
            {
                _service.LoginWithResult(user, pwd);
            }
        }

        GC.Collect();
        GC.WaitForPendingFinalizers();
        GC.Collect();

        var sw = Stopwatch.StartNew();

        if (useException)
        {
            for (int i = 0; i &lt; testData.Length; i++)
            {
                var (user, pwd, _) = testData[i];
                try
                {
                    _service.LoginWithException(user, pwd);
                }
                catch { }
            }
        }
        else
        {
            for (int i = 0; i &lt; testData.Length; i++)
            {
                var (user, pwd, _) = testData[i];
                _service.LoginWithResult(user, pwd);
            }
        }

        sw.Stop();

        var opsPerSecond = testData.Length / (sw.ElapsedMilliseconds / 1000.0);
        Console.WriteLine($"  {testName}: {sw.ElapsedMilliseconds,8}ms ({opsPerSecond,12:N0} ops/s)");

        return sw.ElapsedMilliseconds;
    }

    private static void PrintComparison(long exceptionTime, long resultTime)
    {
        var speedup = exceptionTime / (double)resultTime;
        var improvement = (exceptionTime - resultTime) * 100.0 / exceptionTime;

        if (speedup &gt; 1)
        {
            Console.WriteLine($"Resultæ¯Exceptionå¿« {speedup:F1}xï¼æ§è½æå {improvement:F1}%");
        }
        else
        {
            Console.WriteLine($"å·®å¼ä¸å¤§: {speedup:F2}x");
        }
    }
}
</code></pre>
<h2 id="32-æµè¯ç»æè§¦ç®æå¿">3.2 æµè¯ç»æï¼è§¦ç®æå¿</h2>
<p>åä¸å¾ï¼çæµè¯ç»æ(<strong>åºäºRELEASEæ¨¡å¼ç¼è¯</strong>)ï¼</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1553709/202601/1553709-20260120175226554-1542544296.png" class="lazyload"></p>
<h2 id="33-å¹¶ååºæ¯ä¸æ§è½å·®è·ä¾æ§ä¸å¿ç´è§">3.3 å¹¶ååºæ¯ä¸ï¼æ§è½å·®è·ä¾æ§ä¸å¿ç´è§</h2>
<p>å¹¶åæµè¯æ ¸å¿ä»£ç ï¼</p>
<pre><code class="language-csharp">/// &lt;summary&gt;
/// // å¹¶åæµè¯ç»æç±»
/// &lt;/summary&gt;
public class ConcurrentTestResult
{
    public int Concurrency { get; set; }
    public long ExceptionTime { get; set; }
    public long ResultTime { get; set; }
    public double ExceptionOpsPerSecond { get; set; }
    public double ResultOpsPerSecond { get; set; }
}


/// &lt;summary&gt;
/// å¹¶åæµè¯å¨
/// &lt;/summary&gt;
public class ConcurrentPerformanceTester
{
    private readonly LoginService _service = new();
    private readonly Random _random = new(42);

    private readonly double _errorRate = 0.3;


    public async Task RunConcurrentTests(int totalIterations = 1000000)
    {
        Console.WriteLine("\nå¹¶åæ§è½æµè¯ - æ»è¿­ä»£æ¬¡æ°: {0:N0} - éè¯¯çï¼{1:P0}", totalIterations, _errorRate);
        Console.WriteLine("=".PadRight(60, '='));

        var concurrencyLevels = new[] { 4, 8, 16, 32, 64, 128, 256 };

        foreach (var concurrency in concurrencyLevels)
        {
            Console.WriteLine($"\nå¹¶åæ°: {concurrency}");

            // é¢ç­
            await Warmup(concurrency);

            // å¼å¸¸æ¹å¼å¹¶åæµè¯ï¼30%éè¯¯çæ¨¡æçå®åºæ¯ï¼
            var exceptionTime = await RunConcurrentExceptionTest(
                concurrency,
                totalIterations,
                errorRate: _errorRate
            );

            // Resultæ¹å¼å¹¶åæµè¯
            var resultTime = await RunConcurrentResultTest(
                concurrency,
                totalIterations,
                errorRate: _errorRate
            );

            var exceptionOps = totalIterations / (exceptionTime / 1000.0);
            var resultOps = totalIterations / (resultTime / 1000.0);
            var speedup = exceptionTime / (double)resultTime;

            Console.WriteLine($"  å¼å¸¸: {exceptionTime,5}ms ({exceptionOps,8:N0} ops/s)");
            Console.WriteLine($"  Result: {resultTime,5}ms ({resultOps,8:N0} ops/s)");
            Console.WriteLine($"  Resultå¿« {speedup:F1}x");
        }
    }

    /// &lt;summary&gt;
    /// å¹¶åå¼å¸¸æµè¯
    /// &lt;/summary&gt;
    /// &lt;param name="concurrency"&gt;&lt;/param&gt;
    /// &lt;param name="totalIterations"&gt;&lt;/param&gt;
    /// &lt;param name="errorRate"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private async Task&lt;long&gt; RunConcurrentExceptionTest(
        int concurrency,
        int totalIterations,
        double errorRate)
    {
        var iterationsPerTask = totalIterations / concurrency;
        var tasks = new Task[concurrency];

        var sw = Stopwatch.StartNew();

        for (int i = 0; i &lt; concurrency; i++)
        {
            // æ¯ä¸ªä»»å¡ä½¿ç¨èªå·±çéæºå®ä¾ï¼é¿åç«äº
            var taskRandom = new Random(_random.Next());
            tasks[i] = Task.Run(() =&gt;
            {
                for (int j = 0; j &lt; iterationsPerTask; j++)
                {
                    // ä¸ºæ¯æ¬¡è¿­ä»£çææµè¯æ°æ®ï¼é¿åç´¢å¼é®é¢
                    var (user, pwd) = GenerateTestDataForIteration(taskRandom, errorRate);
                    try
                    {
                        _service.LoginWithException(user, pwd);
                    }
                    catch (BusinessException)
                    {
                        // é¢æå¼å¸¸
                    }
                }
            });
        }

        await Task.WhenAll(tasks);
        sw.Stop();

        return sw.ElapsedMilliseconds;
    }

    /// &lt;summary&gt;
    /// å¹¶åResultæµè¯
    /// &lt;/summary&gt;
    /// &lt;param name="concurrency"&gt;&lt;/param&gt;
    /// &lt;param name="totalIterations"&gt;&lt;/param&gt;
    /// &lt;param name="errorRate"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private async Task&lt;long&gt; RunConcurrentResultTest(
        int concurrency,
        int totalIterations,
        double errorRate)
    {
        var iterationsPerTask = totalIterations / concurrency;
        var tasks = new Task[concurrency];

        var sw = Stopwatch.StartNew();

        for (int i = 0; i &lt; concurrency; i++)
        {
            var taskRandom = new Random(_random.Next());
            tasks[i] = Task.Run(() =&gt;
            {
                for (int j = 0; j &lt; iterationsPerTask; j++)
                {
                    var (user, pwd) = GenerateTestDataForIteration(taskRandom, errorRate);
                    var result = _service.LoginWithResult(user, pwd);
                    // ä¸éè¦é¢å¤å¤çï¼Resultå·²ç»åå«äºæå/å¤±è´¥ç¶æ
                }
            });
        }

        await Task.WhenAll(tasks);
        sw.Stop();

        return sw.ElapsedMilliseconds;
    }

    /// &lt;summary&gt;
    /// ä¸ºåæ¬¡è¿­ä»£çææµè¯æ°æ®
    /// &lt;/summary&gt;
    /// &lt;param name="random"&gt;&lt;/param&gt;
    /// &lt;param name="errorRate"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private static (string user, string pwd) GenerateTestDataForIteration(Random random, double errorRate)
    {
        if (random.NextDouble() &gt; errorRate)
        {
            // æåæ¡ä¾
            return ("valid_user", "correct_password");
        }
        else
        {
            // å¤±è´¥æ¡ä¾ - éæºéæ©å¤±è´¥ç±»å
            if (random.Next(2) == 0)
                return ("invalid_user", "any_password");  // ç¨æ·ä¸å­å¨
            else
                return ("valid_user", "wrong_password");   // å¯ç éè¯¯
        }
    }

    /// &lt;summary&gt;
    /// é¢ç­
    /// &lt;/summary&gt;
    /// &lt;param name="concurrency"&gt;&lt;/param&gt;
    /// &lt;param name="errorRate"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private async Task Warmup(int concurrency, double errorRate = 0.3)
    {
        var warmupTasks = new Task[Math.Min(concurrency, 4)];

        for (int i = 0; i &lt; warmupTasks.Length; i++)
        {
            warmupTasks[i] = Task.Run(() =&gt;
            {
                var taskRandom = new Random(_random.Next());
                for (int j = 0; j &lt; 100; j++)
                {
                    var (user, pwd) = GenerateTestDataForIteration(taskRandom, errorRate);
                    try
                    {
                        _service.LoginWithException(user, pwd);
                    }
                    catch { }

                    _service.LoginWithResult(user, pwd);
                }
            });
        }

        await Task.WhenAll(warmupTasks);
        GC.Collect();
        GC.WaitForPendingFinalizers();
        GC.Collect();
    }
}
</code></pre>
<p>å¹¶åæµè¯ç»æï¼<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1553709/202601/1553709-20260120180104863-50492398.png" class="lazyload"></p>
<p>ä¸è¿°æµè¯å¯è½å¹¶ä¸ä¸¥è°¨åæå¨ï¼ä½æ¯æ´é²åºæ¥çé®é¢è¿æ¯éå¸¸ææ¾çï¼</p>
<ul>
<li>å¨100%å¤±è´¥åºæ¯ä¸ï¼Resultæ¯Exceptionå¿«äºå·®ä¸å¤200å</li>
<li>æ¥è¿å®éä¸å¡åºæ¯ç30%éè¯¯çæåµä¸ï¼Resultæ¯Exceptionä¹å¿«äº160å¤å</li>
<li>å¹¶ååºæ¯ä¸ï¼æ§è½å·®è·ä¹ææ¥è¿ç¾å</li>
</ul>
<h1 id="åä¸ºä»ä¹å¼å¸¸å¨ä¸å¡åºæ¯ä¸å¦æ­¤æè´µ">åãä¸ºä»ä¹å¼å¸¸å¨ä¸å¡åºæ¯ä¸å¦æ­¤"æè´µ"ï¼</h1>
<h2 id="41-clrå¼å¸¸æºå¶çåºå±åç">4.1 CLRå¼å¸¸æºå¶çåºå±åç</h2>
<h3 id="411-å¼å¸¸å¯¹è±¡çæé è¿ç¨">4.1.1 å¼å¸¸å¯¹è±¡çæé è¿ç¨</h3>
<p>å½æä»¬å¨C#ä¸­æåºå¼å¸¸æ¶ï¼çä¼¼ç®åçä¸è¡ä»£ç ï¼èåå´åçäºå¤§éå¤æçæä½ï¼</p>
<pre><code class="language-csharp">throw new BusinessException("ç¨æ·ä¸å­å¨");
</code></pre>
<p>è¿ä¸ªæä½çå®éæ§è¡æµç¨å¦ä¸ï¼</p>
<pre><code class="language-csharp">// ä¼ªä»£ç å±ç¤ºå¼å¸¸æé çå®éå¼é
public static Exception CreateException(string message)
{
    // 1. å åéï¼å¼å¸¸å¯¹è±¡æ¬èº«ï¼è³å°40-64å­èï¼
    var exception = RuntimeHelpers.AllocateException(typeof(BusinessException));
    
    // 2. å­æ®µåå§åï¼è°ç¨æé å½æ°é¾ï¼
    exception._message = message;  // å­ç¬¦ä¸²åé
    exception._stackTrace = null;
    exception._innerException = null;
    exception._helpURL = null;
    exception._source = null;
    
    // 3. æè·è°ç¨å æ ï¼ææè´µçé¨åï¼ï¼
    exception.CaptureStackTrace();
    
    return exception;
}

private void CaptureStackTrace()
{
    // 4. è·åå½åçº¿ç¨çè°ç¨å æ 
    var frames = new StackFrame[64];  // åéæ°ç»
    var frameCount = StackTraceHelper.CaptureStackTrace(
        frames, 0,  // èµ·å§ä½ç½®
        false,      // æ¯å¦éè¦æä»¶ä¿¡æ¯
        null);      // å¼å¸¸å¯¹è±¡æ¬èº«
    
    // 5. æ ¼å¼åæå­ç¬¦ä¸²ï¼å¯è½æ¶åå¤§éå­ç¬¦ä¸²æä½ï¼
    this._stackTrace = FormatStackTrace(frames, frameCount);
}
</code></pre>
<h3 id="412-å æ è·è¸ªççå®ä»£ä»·">4.1.2 å æ è·è¸ªççå®ä»£ä»·</h3>
<p>è®©æä»¬æ·±å¥çç<code>CaptureStackTrace</code>å°åºåäºä»ä¹ï¼</p>
<pre><code class="language-csharp">// Windowsä¸çå®éå®ç°ï¼ç®åï¼
internal static unsafe int CaptureStackTrace(
    StackFrame[] frames, 
    int startIndex,
    bool needFileInfo,
    Exception exception)
{
    // 1. è°ç¨ç³»ç»APIè·åå½åçº¿ç¨çä¸ä¸æ
    CONTEXT context;
    RtlCaptureContext(&amp;context);
    
    // 2. éåè°ç¨å æ ï¼æ§è½ææï¼ï¼
    STACKFRAME64 stackFrame = new STACKFRAME64();
    while (StackWalk64(
        IMAGE_FILE_MACHINE_AMD64,
        GetCurrentProcess(),
        GetCurrentThread(),
        &amp;stackFrame,
        &amp;context,
        null,
        SymFunctionTableAccess64,
        SymGetModuleBase64,
        null))
    {
        // 3. è§£ææ¯ä¸ªæ å¸§çä¿¡æ¯
        frames[frameCount++] = new StackFrame(
            stackFrame.AddrPC.Offset,
            needFileInfo ? GetSourceInfo(stackFrame) : null);
        
        if (frameCount &gt;= frames.Length) break;
    }
    
    return frameCount;
}
</code></pre>
<p>å³é®ç¹ï¼</p>
<ul>
<li>æ¯ä¸ªthrowæä½é½è¦éåæ´ä¸ªè°ç¨å æ </li>
<li>å æ éåæ¶åå¤ä¸ªç³»ç»è°ç¨ååå­è®¿é®</li>
<li>éè¦å°åå­å°åè§£æä¸ºæ¹æ³åãæä»¶åãè¡å·ç­</li>
<li>å¨Releaseæ¨¡å¼ä¸ï¼JITä¼åå¯è½ä¼å½±åå æ ä¿¡æ¯</li>
</ul>
<h3 id="413-jitåaotç¼è¯å¯¹å¼å¸¸çå½±å">4.1.3 JITåAOTç¼è¯å¯¹å¼å¸¸çå½±å</h3>
<pre><code class="language-csharp">// èèä»¥ä¸ä»£ç 
public int Process(int value)
{
    try
    {
        return ProcessValue(value);  // å¯è½æåºå¼å¸¸
    }
    catch (Exception)
    {
        return -1;
    }
}

// JITç¼è¯å¨éè¦çæï¼
// 1. æ­£å¸¸æ§è¡è·¯å¾çä»£ç 
// 2. å¼å¸¸å¤çè¡¨ï¼EHè¡¨ï¼
// 3. å æ å±å¼ä»£ç 
// 4. finallyåæ§è¡é»è¾ï¼å¦ææï¼
</code></pre>
<p>EHè¡¨çç»æï¼</p>
<pre><code>Method Exception Handling Table:
Start   Length  Handler Type    Class           Filter
0x0000  0x0020  0x0030  CLAUSE  Exception       null
</code></pre>
<p>æ¯ä¸ªtry-catchåé½ä¼å¨æ¹æ³çåæ°æ®ä¸­æ·»å EHè¡¨æ¡ç®ï¼å¢å æ¹æ³å¤§å°åå è½½æ¶é´ã</p>
<h2 id="42-å¼å¸¸å¤ççåå­åéç»è">4.2 å¼å¸¸å¤ççåå­åéç»è</h2>
<h3 id="421-å¼å¸¸å¯¹è±¡çåå­å¸å±">4.2.1 å¼å¸¸å¯¹è±¡çåå­å¸å±</h3>
<pre><code class="language-csharp">// Exceptionç±»çç®ååå­å¸å±
class Exception
{
    // å¯¹è±¡å¤´ï¼8-16å­èï¼
    MethodTable* _methodTable;  // 8å­è
    // åæ­¥åç´¢å¼ï¼å¯éï¼
    
    // å®ä¾å­æ®µ
    string _message;           // 8å­èï¼å¼ç¨ï¼
    IDictionary _data;         // 8å­èï¼éå¸¸ä¸ºnullï¼
    Exception _innerException; // 8å­è
    string _helpURL;          // 8å­è
    string _source;           // 8å­è
    string _stackTrace;       // 8å­èï¼å­ç¬¦ä¸²ï¼å®éåéæ´å¤§ï¼
    object _stackTraceString; // 8å­èï¼å¯è½ä¸åæ ¼å¼ï¼
    object _remoteStackTrace; // 8å­è
    int _remoteStackIndex;    // 4å­è
    int _HResult;             // 4å­è
    
    // æ»å±ï¼è³å°80å­èï¼64ä½ç³»ç»ï¼
    // å ä¸å­ç¬¦ä¸²åå®¹ï¼å¯è½æ°ç¾å°æ°åå­è
}
</code></pre>
<h3 id="422-gcçå½±å">4.2.2 GCçå½±å</h3>
<pre><code class="language-csharp">// é«é¢æåºå¼å¸¸ä¼æ¾èå½±åGC
public void TestExceptionGC()
{
    var list = new List&lt;Exception&gt;();
    
    for (int i = 0; i &lt; 10000; i++)
    {
        try
        {
            throw new Exception($"Error {i}");
        }
        catch (Exception ex)
        {
            list.Add(ex);  // å¤§éå¯¹è±¡è¿å¥ç¬¬0ä»£å 
        }
    }
}

</code></pre>
<p>ä¸è¿°ä»£ç ä¼å¯¼è´:</p>
<ul>
<li>è§¦åé¢ç¹çGen0 GC</li>
<li>å¦æexè¢«é¿æ¶é´å¼ç¨ï¼å¯è½è¿å¥Gen1/Gen2</li>
<li>å¢å GCæåæ¶é´</li>
<li>éä½ç¼å­å±é¨æ§</li>
</ul>
<h2 id="43-cpuçº§å«çæ§è½å½±å">4.3 CPUçº§å«çæ§è½å½±å</h2>
<h3 id="431-ç°ä»£cpuçå¼å¸¸å¤çå¼é">4.3.1 ç°ä»£CPUçå¼å¸¸å¤çå¼é</h3>
<pre><code class="language-assembly">; x64æ±ç¼å±é¢çå¼å¸¸å¤ç
; æ­£å¸¸è·¯å¾ï¼
process_value:
    mov eax, [rcx]      ; å è½½å¼
    add eax, 100        ; è®¡ç®
    ret                 ; è¿å
    
; å¼å¸¸è·¯å¾ï¼
throw_exception:
    ; 1. ä¿å­ææå¯å­å¨å°å æ 
    push rbx
    push rbp
    push r12
    push r13
    push r14
    push r15
    sub rsp, 28h        ; åéå æ ç©ºé´
    
    ; 2. è°ç¨å¼å¸¸æé å½æ°
    call Exception..ctor
    
    ; 3. è®¾ç½®SEHï¼ç»æåå¼å¸¸å¤çï¼
    mov [rsp+20h], rcx  ; ä¿å­å¼å¸¸å¯¹è±¡
    call __CxxThrowException@8
    
    ; 4. æ¸çå æ 
    add rsp, 28h
    pop r15
    pop r14
    pop r13
    pop r12
    pop rbp
    pop rbx
</code></pre>
<p>CPUå±é¢çé®é¢:</p>
<ul>
<li><strong>åæ¯é¢æµå¤±è´¥</strong>ï¼å¼å¸¸è·¯å¾å¾å°æ§è¡ï¼CPUåæ¯é¢æµå¨é¾ä»¥ä¼å</li>
<li><strong>ç¼å­å¤±æ</strong>ï¼å¼å¸¸å¤çä»£ç éå¸¸ä¸å¨æä»¤ç¼å­ä¸­</li>
<li><strong>æµæ°´çº¿åé¡¿</strong>ï¼å¼å¸¸å¤çéè¦ä¿å­/æ¢å¤å¤§éå¯å­å¨ç¶æ</li>
<li><strong>åå­è®¿é®æ¨¡å¼å·®</strong>ï¼EHè¡¨æ¥æ¾å¯¼è´éæºåå­è®¿é®</li>
</ul>
<h3 id="432-å¯¹æ¯æ­£å¸¸è¿ååå¼å¸¸è¿å">4.3.2 å¯¹æ¯æ­£å¸¸è¿ååå¼å¸¸è¿å</h3>
<pre><code class="language-csharp">// Result&lt;T&gt;çæ­£å¸¸è¿åè·¯å¾
return Result&lt;User&gt;.Fail("ç¨æ·ä¸å­å¨");
// æ±ç¼ï¼
; 1. æé Resultå¯¹è±¡ï¼å¯è½å¨æ ä¸ï¼
; 2. è®¾ç½®Success=false
; 3. è®¾ç½®Errorå­æ®µ
; 4. è¿åï¼æ®éretæä»¤ï¼

// å¼å¸¸è¿åè·¯å¾
throw new BusinessException("ç¨æ·ä¸å­å¨");
// æ±ç¼ï¼
; 1. å åéå¼å¸¸å¯¹è±¡
; 2. æè·å æ è·è¸ª
; 3. è®¾ç½®SEHå¸§
; 4. è°ç¨kernel32!RaiseException
; 5. å æ å±å¼
; 6. æ¥æ¾catchå
; 7. æ§è¡catchåä»£ç 
</code></pre>
<h2 id="44-å¯¹æ¯å¶ä»ç¼ç¨è¯­è¨">4.4 å¯¹æ¯å¶ä»ç¼ç¨è¯­è¨</h2>
<h3 id="441-javaçå¼å¸¸æºå¶">4.4.1 Javaçå¼å¸¸æºå¶</h3>
<pre><code class="language-java">// Javaçå¼å¸¸ä½¿ç¨çèµ·æ¥åC#ç¸ä¼¼
public User login(String username, String password) 
    throws UserNotFoundException, InvalidPasswordException
{
    User user = findUser(username);
    if (user == null) {
        throw new UserNotFoundException("ç¨æ·ä¸å­å¨");
    }
    if (!verifyPassword(user, password)) {
        throw new InvalidPasswordException("å¯ç éè¯¯");
    }
    return user;
}
</code></pre>
<p>Javaå¼å¸¸çç¹ç¹ï¼<br>
1.æ£æ¥åå¼å¸¸ï¼Checked Exceptionï¼ï¼å¼ºå¶å¤çæå£°æ<br>
2.æ§è½å¼éä¸C#ç±»ä¼¼ï¼åæ ·éè¦æè·å æ è·è¸ª<br>
3.JVMçä¼åï¼HotSpot JVMææ´æççå¼å¸¸ä¼å:</p>
<ul>
<li>åèç¼å­ï¼Inline Cacheï¼</li>
<li>æ ä¸æ¿æ¢ï¼On-Stack Replacementï¼</li>
<li>ä½ä¸å¡å¼å¸¸ä»ç¶æè´µ</li>
</ul>
<p><strong>éè¦åºå«ï¼</strong></p>
<pre><code class="language-java">// Java 14+å¼å¥äºRecordsï¼ä½å¼å¸¸å¼éä¾æ§
public record Result&lt;T&gt;(T value, String error) {
    public boolean isSuccess() { return error == null; }
}

// Javaç¤¾åºä¹å¨è½¬åResultæ¨¡å¼ï¼ç¹å«æ¯ååºå¼ç¼ç¨
public Mono&lt;User&gt; login(String username, String password) {
    return Mono.fromCallable(() -&gt; findUser(username))
        .switchIfEmpty(Mono.error(new UserNotFoundException()))
        .filter(user -&gt; verifyPassword(user, password))
        .switchIfEmpty(Mono.error(new InvalidPasswordException()));
}
</code></pre>
<h3 id="442-goçéè¯¯å¤çå²å­¦">4.4.2 Goçéè¯¯å¤çå²å­¦</h3>
<pre><code class="language-go">// Goçéè¯¯å¤çï¼æ¾å¼è¿åéè¯¯
func Login(username, password string) (*User, error) {
    user, err := findUser(username)
    if err != nil {
        return nil, fmt.Errorf("æ¥æ¾ç¨æ·å¤±è´¥: %w", err)
    }
    
    if !verifyPassword(user, password) {
        return nil, errors.New("å¯ç éè¯¯")
    }
    
    return user, nil
}

// è°ç¨æ¹å¿é¡»æ¾å¼å¤çéè¯¯
user, err := Login("test", "123")
if err != nil {
    // å¤çéè¯¯
    switch {
    case strings.Contains(err.Error(), "å¯ç éè¯¯"):
        // ç¹å®å¤ç
    default:
        // éç¨å¤ç
    }
}
</code></pre>
<p>Goçè®¾è®¡éæ©ï¼</p>
<ul>
<li><strong>æ²¡æå¼å¸¸æºå¶</strong>ï¼åªæéè¯¯è¿åå¼</li>
<li><strong>éè¯¯æ¯å¼ï¼errors are valuesï¼</strong>ï¼å¯ä»¥åæ®éå¼ä¸æ ·ä¼ é</li>
<li><strong>å¼ºå¶æ¾å¼å¤ç</strong>ï¼æ æ³å¿½ç¥éè¯¯ï¼é¤éä½¿ç¨_ï¼</li>
<li><strong>é¶ææ¬æ½è±¡</strong>ï¼éè¯¯å¤çå ä¹æ²¡æè¿è¡æ¶å¼é</li>
</ul>
<p>Goçéè¯¯æ§è½ä¼å¿:</p>
<pre><code class="language-go">// Goçerrors.Newå®éä¸å¾ç®å
func New(text string) error {
    return &amp;errorString{text}
}

type errorString struct {
    s string
}

func (e *errorString) Error() string {
    return e.s
}

// æ²¡æå æ è·è¸ªï¼æ²¡æå¤ææé 
// åªæ¯ä¸ä¸ªåå«å­ç¬¦ä¸²çç»æä½
</code></pre>
<h3 id="443-rustçresultç±»å">4.4.3 RustçResultç±»å</h3>
<pre><code class="language-rust">// Rustçéè¯¯å¤çï¼åºäºæä¸¾çResult
fn login(username: &amp;str, password: &amp;str) -&gt; Result&lt;User, LoginError&gt; {
    let user = find_user(username)?;  // ?æä½ç¬¦èªå¨ä¼ æ­éè¯¯
    
    if !verify_password(&amp;user, password) {
        return Err(LoginError::InvalidPassword);
    }
    
    Ok(user)
}

// éè¯¯ç±»åå®ä¹
#[derive(Debug)]
enum LoginError {
    UserNotFound,
    InvalidPassword,
    DatabaseError(DbError),
}

// ä½¿ç¨matchå¤ç
match login("test", "123") {
    Ok(user) =&gt; println!("æ¬¢è¿ {}", user.name),
    Err(LoginError::UserNotFound) =&gt; println!("ç¨æ·ä¸å­å¨"),
    Err(LoginError::InvalidPassword) =&gt; println!("å¯ç éè¯¯"),
    Err(e) =&gt; println!("å¶ä»éè¯¯: {:?}", e),
}
</code></pre>
<p>Rustçè®¾è®¡ç¹ç¹:</p>
<ul>
<li>é¶ææ¬æ½è±¡ï¼Resultå¨è¿è¡æ¶éå¸¸æ¯æ®éæä¸¾</li>
<li>æ¨¡å¼å¹éï¼ç¼è¯å¨ç¡®ä¿æææåµé½è¢«å¤ç</li>
<li>éè¯¯ä¼ æ­è¿ç®ç¬¦ï¼?ï¼ï¼ç®åéè¯¯ä¼ æ­</li>
<li>ä¸°å¯çéè¯¯åºï¼anyhowãthiserrorç­</li>
</ul>
<p>Rustçæ§è½ä¼å¿ï¼</p>
<pre><code>ç¼è¯åçResultéå¸¸ä¼åä¸ºï¼
1.æåï¼å­å¨User
2.å¤±è´¥ï¼å­å¨éè¯¯ç ï¼éå¸¸æ¯æ´æ°ï¼
3.æ²¡æå åéï¼æ²¡æèå½æ°è°ç¨
</code></pre>
<h3 id="444-cçéè¯¯å¤ç">4.4.4 C++çéè¯¯å¤ç</h3>
<pre><code class="language-cpp">// C++çå¤ç§éè¯¯å¤çæ¹å¼

// 1. å¼å¸¸ï¼ç±»ä¼¼C#/Javaï¼
User login(const std::string&amp; username, const std::string&amp; password) {
    auto user = find_user(username);
    if (!user) {
        throw UserNotFoundException("ç¨æ·ä¸å­å¨");
    }
    if (!verify_password(*user, password)) {
        throw InvalidPasswordException("å¯ç éè¯¯");
    }
    return *user;
}

// 2. éè¯¯ç ï¼ä¼ ç»æ¹å¼ï¼
int login(const std::string&amp; username, 
          const std::string&amp; password,
          User&amp; out_user) {
    User user;
    int err = find_user(username, user);
    if (err != 0) return err;
    
    if (!verify_password(user, password)) {
        return ERROR_INVALID_PASSWORD;
    }
    
    out_user = user;
    return 0;  // æå
}

// 3. std::expectedï¼C++23ï¼
std::expected&lt;User, Error&gt; login(const std::string&amp; username,
                                 const std::string&amp; password) {
    auto user = find_user(username);
    if (!user) {
        return std::unexpected(Error::UserNotFound);
    }
    if (!verify_password(*user, password)) {
        return std::unexpected(Error::InvalidPassword);
    }
    return *user;
}
</code></pre>
<p>C++çéæ©ï¼</p>
<ul>
<li>æ¸¸æååµå¥å¼ï¼éå¸¸ç¦ç¨å¼å¸¸ï¼ä½¿ç¨éè¯¯ç </li>
<li>æ§è½ææåºç¨ï¼é¿åå¼å¸¸ï¼å ä¸ºé¶å¼éåå</li>
<li>ç°ä»£C++ï¼å¾åäºstd::expectedç­ç±»åå®å¨æ¹æ¡</li>
</ul>
<h2 id="45-net-coreçæ¹è¿åå±é">4.5 .NET Coreçæ¹è¿åå±é</h2>
<p>.Net 8.0çæ¬ï¼å®æ¹å¢ééå¯¹å¼å¸¸å¤çè¿åè¿è¡äºå¤§å¹çä¼åï¼åæ¬é¢åéå¼å¸¸å¯¹è±¡ï¼PREallocated Exceptionï¼ãå»¶è¿å æ è·è¸ªçæï¼Lazy Stack Traceï¼ãå æ è·è¸ªç¼å­åå¤ç¨ãæ°çå æ è·è¸ªç®æ³ç­å¤ç§ææ®µï¼åæ¶ä¹å¯¹JITåRunTimeè¿è¡äºéå¯¹æ§ä¼åãä½æ¯ç®åæ¥çï¼ä¾æ§è¿æå¾å¤§çæåç©ºé´ã<br>
è¯¦æè¯·è§å®æ¹å¢éçåå®¢ï¼<a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/#exception-handling" target="_blank" rel="noopener nofollow">https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/#exception-handling</a></p>
<pre><code class="language-csharp">// .NET 8.0 å¯¹åæ°å¼å¸¸çç¹æ®ä¼å
public void ValidateUser(string username, int age)
{
    // è¿äºè°ç¨å¨ .NET 8.0 ä¸­éå¸¸é«æ
    ArgumentNullException.ThrowIfNull(username);
    ArgumentOutOfRangeException.ThrowIfNegative(age);
    ArgumentException.ThrowIfNullOrEmpty(username);
    
    // ä½æ³¨æï¼ä¸å¡å¼å¸¸ä¸å¨æ­¤ä¼åèå´åï¼
    if (!IsValidUsername(username))
        throw new BusinessException("æ æç¨æ·å"); // ä»£ä»·ä»ç¶æè´µ
}
</code></pre>
<h1 id="äºresultçè¿é¶ä¼å¿">äºãResult<t>çè¿é¶ä¼å¿</t></h1>
<h2 id="51-ä¸°å¯çéè¯¯ä¿¡æ¯">5.1 ä¸°å¯çéè¯¯ä¿¡æ¯</h2>
<pre><code class="language-csharp">public class Result&lt;T&gt;
{
    public bool Success { get; }
    public T? Value { get; }
    public string ErrorCode { get; }    // éè¯¯ä»£ç 
    public string ErrorMessage { get; } // éè¯¯æ¶æ¯
    public Dictionary&lt;string, object&gt; Metadata { get; } // éå ä¿¡æ¯
}

// ä½¿ç¨ï¼
var result = Login("test", "wrong");
if (!result.Success)
{
    switch (result.ErrorCode)
    {
        case "USER_NOT_FOUND":
            // ç¨æ·ä¸å­å¨ï¼è·³è½¬æ³¨åé¡µé¢
            break;
        case "INVALID_PASSWORD":
            // å¯ç éè¯¯ï¼æ¾ç¤ºæç¤º
            break;
        case "ACCOUNT_LOCKED":
            // è´¦æ·éå®ï¼æ¾ç¤ºéå®æ¶é´
            var lockTime = result.Metadata["LockUntil"];
            break;
    }
}
</code></pre>
<h2 id="52-å½æ°å¼ç¼ç¨æ¯æ">5.2 å½æ°å¼ç¼ç¨æ¯æ</h2>
<pre><code class="language-csharp">// Map - è½¬æ¢æåçå¼
var userResult = GetUser(123);
var userName = userResult.Map(user =&gt; user.Name.ToUpper());

// Bind - é¾å¼æä½
var orderResult = GetUser(123)
    .Bind(user =&gt; GetOrder(user.CurrentOrderId))
    .Bind(order =&gt; ValidateOrder(order));

// Match - æ¨¡å¼å¹é
var message = loginResult.Match(
    success: user =&gt; $"æ¬¢è¿åæ¥ï¼{user.Name}!",
    failure: error =&gt; $"ç»å½å¤±è´¥: {error.Message}"
);
</code></pre>
<h2 id="53-æ´å¥½çapiè®¾è®¡">5.3 æ´å¥½çAPIè®¾è®¡</h2>
<pre><code class="language-csharp">// Web APIä¸­çä½¿ç¨
[HttpPost("login")]
public IActionResult Login([FromBody] LoginRequest request)
{
    var result = _authService.Login(request);
    
    return result.Match&lt;IActionResult&gt;(
        success: user =&gt; Ok(new { success = true, user }),
        failure: error =&gt; BadRequest(new { 
            success = false, 
            errorCode = error.Code,
            message = error.Message 
        })
    );
}

// å®¢æ·ç«¯è·å¾æ¸æ°çååºï¼
// æå: { success: true, user: { ... } }
// å¤±è´¥: { success: false, errorCode: "INVALID_PASSWORD", message: "å¯ç éè¯¯" }
</code></pre>
<h1 id="å­-resultæ¨¡å¼çä¸äºå¼ç«¯">å­ã Result<t>æ¨¡å¼çä¸äºå¼ç«¯</t></h1>
<h2 id="61-ifå°ç±é®é¢æ¡ä»¶å¤æ­æ³æ»¥">6.1 "ifå°ç±"é®é¢ï¼æ¡ä»¶å¤æ­æ³æ»¥ï¼</h2>
<p>æå¸¸è¢«è¯ççé®é¢ï¼å°±æ¯ä»£ç ä¸­åæ¥å¤§éç if (!result.Success) æ£æ¥ã</p>
<pre><code class="language-csharp">// "ifå°ç±"çå¸åä¾å­
public Result&lt;Order&gt; ProcessOrder(int userId, OrderRequest request)
{
    var userResult = GetUser(userId);
    if (!userResult.Success)
        return Result&lt;Order&gt;.Fail(userResult.Error);
    
    var validationResult = ValidateOrder(request);
    if (!validationResult.Success)
        return Result&lt;Order&gt;.Fail(validationResult.Error);
    
    var inventoryResult = CheckInventory(request.Items);
    if (!inventoryResult.Success)  
        return Result&lt;Order&gt;.Fail(inventoryResult.Error);
    
    var paymentResult = ProcessPayment(userResult.Value, request);
    if (!paymentResult.Success)
        return Result&lt;Order&gt;.Fail(paymentResult.Error);
    
    // ... æ´å¤æ£æ¥
}
</code></pre>
<p>è¿ä¸ªé®é¢ï¼ä½¿ç¨å½æ°å¼ç¼ç¨ææ³å¯ä»¥å·§å¦è§£å³ï¼è¿ä¸åJAVAåççå¿æºä¸éçã</p>
<pre><code class="language-csharp">// ä½¿ç¨ Railway-Oriented Programming
public Result&lt;Order&gt; ProcessOrder(int userId, OrderRequest request)
{
    return GetUser(userId)
        .Bind(user =&gt; ValidateOrder(request)
            .Bind(validated =&gt; CheckInventory(request.Items)
                .Bind(inventory =&gt; ProcessPayment(user, request)
                    .Map(payment =&gt; CreateOrder(user, validated, payment)))));
}

// æèä½¿ç¨æ©å±æ¹æ³
public Result&lt;Order&gt; ProcessOrder(int userId, OrderRequest request)
{
    return GetUser(userId)
        .Then(user =&gt; ValidateOrder(request))
        .Then(validated =&gt; CheckInventory(request.Items))
        .Then(inventory =&gt; ProcessPayment(user, request))
        .Map(payment =&gt; CreateOrder(user, validated, payment));
}
</code></pre>
<h2 id="62-å¼ç±»åstructvs-å¼ç¨ç±»åclassçä¸¤é¾éæ©">6.2 å¼ç±»åï¼structï¼vs å¼ç¨ç±»åï¼classï¼çä¸¤é¾éæ©</h2>
<pre><code class="language-csharp">public readonly struct Result&lt;T&gt;  // å¼ç±»å
{
    private readonly T? _value;
    private readonly string? _error;
    
    // é®é¢1ï¼Tæ¯å¼ç¨ç±»åæ¶ï¼structå­å¨çæ¯å¼ç¨
    // é®é¢2ï¼structå¤å¶å¼éï¼å¦æTæ¯å¤§å¯¹è±¡ï¼
    // é®é¢3ï¼è£ç®±/æç®±å¼é
    // é®é¢4ï¼ä¸è½ä¸ºnullï¼éè¦é¢å¤ç¶ææ è®°
}

public class Result&lt;T&gt;  // å¼ç¨ç±»å
{
    // é®é¢ï¼æ¯ä¸ªResulté½æ¯å åéï¼å¢å GCåå
    // å³ä½¿æåæåµä¹è¦åéå¯¹è±¡
}

</code></pre>
<p>æä¸­æ¹æ¡ï¼éå¯¹å¼ç±»ååå¼ç¨ç±»ååå«ä¼åï¼éå¯¹éç¨çResultå¯¹è±¡è¿è¡ç¼å­åå¤ç¨ã</p>
<pre><code class="language-csharp">/// &lt;summary&gt;
/// ç»æåºç±»
/// &lt;/summary&gt;
/// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;
public abstract class Result&lt;T&gt;
{
    /// &lt;summary&gt;
    /// æ¯å¦æå
    /// &lt;/summary&gt;
    public abstract bool IsSuccess { get; }
    /// &lt;summary&gt;
    /// å·ä½è¿åå¼ï¼æåæ¶ææï¼
    /// &lt;/summary&gt;
    public abstract T? Value { get; }
    /// &lt;summary&gt;
    /// éè¯¯ç 
    /// &lt;/summary&gt;
    public abstract string? ErrorCode { get; }
    /// &lt;summary&gt;
    /// éè¯¯ä¿¡æ¯
    /// &lt;/summary&gt;
    public abstract string? ErrorMessage { get; }
  
    // ç¼å­åä¾æåï¼ä»éå¯¹ default(T)ï¼
    private static readonly ConcurrentDictionary&lt;Type, Result&lt;T&gt;&gt; _successCache = new();
    //åªæ errorCode ç¼å­ï¼é¿åæ message æ éå¢é¿ï¼
    private static readonly ConcurrentDictionary&lt;string, Result&lt;T&gt;&gt; _errorCache = new();  
} 

/// &lt;summary&gt;
/// ä»ç¨äºæ§è½å³é®è·¯å¾ï¼ä¸å­å¨å¤§å¯¹è±¡
/// &lt;/summary&gt;
/// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;
public readonly ref struct ValueResult&lt;T&gt; where T : struct
{
  //çç¥
}

 /// &lt;summary&gt;
 /// å¼ç¨ç±»åç»æï¼ä»ç¨äºæ§è½å³é®è·¯å¾
 /// &lt;/summary&gt;
 /// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;
 public readonly ref struct RefResult&lt;T&gt; where T : class
{
 //çç¥
}
</code></pre>
<h2 id="63-å¼æ­¥ç¼ç¨çå¤ææ§">6.3 å¼æ­¥ç¼ç¨çå¤ææ§</h2>
<p>å¨å¼æ­¥ç¼ç¨ä¸­ï¼å¯è½æ¯ä¸ªå¼æ­¥æä½é½éè¦å¤çResultï¼è¿ä¹å¤§å¤§å¢å äºä»£ç å¤æåº¦ï¼å¶å®ä¹å±äºä¸é¢è¯´çâif å°ç±âèç´ã</p>
<pre><code class="language-csharp">public async Task&lt;Result&lt;User&gt;&gt; LoginAsync(string username, string password)
{
    // æ¯ä¸ªå¼æ­¥æä½é½éè¦å¤çResult
    var userResult = await FindUserAsync(username);
    if (!userResult.Success)
        return Result&lt;User&gt;.Fail(userResult.Error);
    
    var validationResult = await ValidatePasswordAsync(userResult.Value, password);
    if (!validationResult.Success)
        return Result&lt;User&gt;.Fail(validationResult.Error);
    
    return Result&lt;User&gt;.Ok(userResult.Value);
}

// å¯¹æ¯å¼å¸¸çæ¬ï¼
public async Task&lt;User&gt; LoginAsync(string username, string password)
{
    var user = await FindUserAsync(username);  // æå¼å¸¸åç´æ¥ä¸­æ­åç»­é»è¾
    await ValidatePasswordAsync(user, password); // æå¼å¸¸åç´æ¥ä¸­æ­åç»­é»è¾
    return user;
}
</code></pre>
<h2 id="64-ç±»åç³»ç»åé¿">6.4 ç±»åç³»ç»åé¿</h2>
<p>æ¯ä¸ä¸ªæ¥å£æ¹æ³é½è¦åè£¹Result,åå ä¸å¼æ­¥çTask,åé¡µè¯·æ±ç»ææ¨¡åPagedResultï¼åå ä¸ç¹å¶ä»ä¸è¥¿ï¼å°±ä¼åºç°ä»¤äººå¤´ç®åéº»çæ³ååæ°çç¸&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;ã<br>
ä¸é¢çä»£ç ï¼æ¯é¡¹ç®éé¢ççå®ä»£ç </p>
<pre><code class="language-csharp">     /// &lt;summary&gt;
    /// åå·¥ä¸å¡æå¡æ¥å£
    /// &lt;/summary&gt;
    public interface IEmployeeService
    {
        Task&lt;Result&lt;long&gt;&gt; CreateAsync(CreateEmployeeDto dto);
        Task&lt;Result&lt;EmployeeDto&gt;&gt; GetByIdAsync(long id);
        Task&lt;Result&gt; UpdateAsync(UpdateEmployeeDto dto);
        Task&lt;Result&gt; DeleteAsync(long id);
        Task&lt;Result&lt;PagedResult&lt;EmployeeDto&gt;&gt;&gt; GetPageListAsync(EmployeePageListDto dto);
        Task&lt;Result&lt;List&lt;EmployeeDto&gt;&gt;&gt; GetListAsync(string? keyword = null);
        Task&lt;Result&lt;Dictionary&lt;string,long&gt;&gt;&gt; GetEmployeeAliases(List&lt;long&gt;? employeeIds = null, bool includeShowName = true);
    }
</code></pre>
<h2 id="65-å¶ä»é®é¢">6.5 å¶ä»é®é¢</h2>
<p>å½ç¶ï¼è¿ç§æ¨¡å¼è¿æä¸äºå¶ä»çé®é¢ï¼æ¯å¦å¢éæåçæ¥ååº¦ï¼å¢éå­¦ä¹ ææ¬ï¼ä¸ç°æä»£ç /çæçå¼å®¹æ§ï¼ä¸ç¬¬ä¸æ¹åçå¼å®¹æ§ç­ï¼è¿éå°±ä¸ä¸ä¸è¯´æäºã</p>
<h1 id="ä¸å¸¸è§é®é¢ä¸ç­ç">ä¸ãå¸¸è§é®é¢ä¸ç­ç</h1>
<p><strong>Qï¼å¼å¸¸ä¸æ¯æ´æ¹ä¾¿åï¼ä¸è¡ä»£ç å°±è½ä¸­æ­æµç¨</strong><br>
Aï¼æ¹ä¾¿ä¸ç­äºæ­£ç¡®ãgotoè¯­å¥ä¹å¾"æ¹ä¾¿"ï¼ä½ç°ä»£ç¼ç¨ä¸­æä»¬é¿åä½¿ç¨å®ãå¼å¸¸å¨ä¸å¡é»è¾ä¸­å°±æ¯"è¿ç¨goto"ï¼ç ´åäºä»£ç çå¯è¯»æ§åå¯ç»´æ¤æ§ã</p>
<p><strong>Qï¼Result<t>éè¦æ´å¤çifå¤æ­ï¼ä»£ç æ´åé¿</t></strong></p>
<pre><code class="language-csharp">// ç®æ´çå¤çæ¹å¼
var result = Login("test", "123");
if (!result.Success) return result;

// æèä½¿ç¨æ¨¡å¼å¹é
var message = result switch
{
    { Success: true, Value: var user } =&gt; $"æ¬¢è¿ {user.Name}",
    { Error: var error } =&gt; $"éè¯¯: {error}",
    _ =&gt; "æªç¥ç¶æ"
};
</code></pre>
<p><strong>Qï¼æä»¬çé¡¹ç®å¾å°ï¼æ§è½å½±åä¸å¤§</strong><br>
A:å³ä½¿ä¸èèæ§è½ï¼ä»ä»£ç è´¨éåç»´æ¤æ§è§åº¦ï¼Result<t>ä¹æ¯æ´å¥½çéæ©ãå¥½çä¹ æ¯åºè¯¥ä»é¡¹ç®åæå°±å¼å§å¹å»ã</t></p>
<h1 id="å«æ»ç»">å«ãæ»ç»</h1>
<p>Result<t> ä¸æ¯é¶å¼¹ï¼å®æå®éç¨çåºæ¯ï¼ä¹æç¸åºçä¸äºå¼ç«¯ãéæ©çå³é®ä¸å¨äºåªä¸ª"æ´å¥½"ï¼èå¨äºåªä¸ª"æ´éå"å½åçåºæ¯åçº¦æãææºçå·¥ç¨å¸ä¼æ ¹æ®å·ä½æåµååºå¹³è¡¡çéæ©ã<br>
éåä½¿ç¨ Result<t> çåºæ¯ï¼</t></t></p>
<ul>
<li>é«é¢å¤±è´¥çæ ¡éªé»è¾ï¼è¡¨åéªè¯ãä¸å¡è§åæ£æ¥ï¼</li>
<li>éè¦æç¡®éè¯¯åç±»çä¸å¡æµç¨</li>
<li>APIè¾¹çï¼éè¦ç»æåéè¯¯ååºï¼</li>
<li>ä¸å¤é¨ç³»ç»äº¤äºï¼éè¦å¤çåç§å¤±è´¥æ¨¡å¼ï¼</li>
<li>éè¦ç»åçå¤æä¸å¡é»è¾</li>
</ul>
<p>ä»ç¶éåä½¿ç¨å¼å¸¸çåºæ¯ï¼</p>
<ul>
<li>çæ­£çç³»ç»æéï¼åå­ä¸è¶³ãæ°æ®åºå´©æºï¼</li>
<li>ç¨åºç¶æå¼å¸¸ï¼ç©ºå¼ç¨ãç´¢å¼è¶çï¼</li>
<li>ä¸æ»¡è¶³åç½®æ¡ä»¶ï¼æ æåæ°ï¼</li>
<li>å¼åé¶æ®µçæ­è¨æ£æ¥</li>
<li>æä½å¤±è´¥ççæä½</li>
</ul>
<p>å³é®å»ºè®®ï¼</p>
<ul>
<li>ä¸è¦å¨çæ¿æ¢ï¼Resultåå¼å¸¸åæéç¨åºæ¯</li>
<li>åå±è®¾è®¡ï¼ä¸åæ¶æå±ä½¿ç¨ä¸åç­ç¥</li>
<li>å¢éå±è¯ï¼å»ºç«æç¡®çè§èåè¾¹ç</li>
<li>æ¸è¿éç¨ï¼ä»æ ¸å¿ä¸å¡å¼å§ï¼éæ­¥æ©å±</li>
<li>çæ§åé¦ï¼éè¿æ¥å¿åçæ§éªè¯éæ©</li>
</ul>
<p>æç»ååï¼</p>
<ul>
<li>å¼å¸¸ï¼ç¨äº"ä¸åºè¯¥åç"çäºæ</li>
<li>Resultï¼ç¨äº"å¯è½åçä½éè¦å¤ç"çäºæ</li>
</ul>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.9291666666666667" data-date-updated="2026-01-21 17:58">2026-01-20 19:40</span>&nbsp;
<a href="https://www.cnblogs.com/diamondhusky">åèåå£«å¥</a>&nbsp;
éè¯»(<span id="post_view_count">489</span>)&nbsp;
è¯è®º(<span id="post_comment_count">9</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508626);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508626', targetLink: 'https://www.cnblogs.com/diamondhusky/p/19508626', title: 'åå« throw exceptionï¼ä¸ºä»ä¹ Result&amp;lt;T&amp;gt; ææ¯ä¸å¡é»è¾çæ­£ç¡®éæ©' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å¹²è´§æ»¡æ»¡ï¼Redis åå¸å¼éå¿é¿ç 8 å¤§é®é¢åè§£å³æ¹æ¡ ]]></title>
    <link>https://www.cnblogs.com/sun-10387834/p/19493006</link>
    <guid>436793609d4e4f231f04487dd8708f85</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sun-10387834/p/19493006" title="åå¸äº 2026-01-20 19:23">
    <span role="heading" aria-level="2">å¹²è´§æ»¡æ»¡ï¼Redis åå¸å¼éå¿é¿ç 8 å¤§é®é¢åè§£å³æ¹æ¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨åå¸å¼ç³»ç»ä¸­ï¼Redis åå¸å¼éè½è½é«æè§£å³è·¨æå¡å¹¶åå²çªï¼ä½å®éè½å°æ¶ç¨ä¸æ³¨æå°±ä¼è¸©åââå°å°æ°æ®ä¸ä¸è´ï¼å¤§å°æå¡éªå´©ï¼è¿äºé®é¢å¤æºäºå¯¹ Redis ç¹æ§ãåå¸å¼åºæ¯å¤ææ§çèèä¸å¨ãä¹åå¼åçµååºå­åè®¢åç³»ç»æ¶ï¼å°±å å¿½è§äºéè¿æãèè£ç­é®é¢ï¼åååºç°è¿è¶åãéå¤±æç­æéãä»å¤©ç»åçäº§å®æç»éªï¼æ¢³ç Redis å®ç°åå¸å¼éæ¶ææéå°ç 8 å¤§é®é¢ï¼éä¸æè§£æå ãè¡¨ç°åæ ¹æ²»æ¹æ¡ï¼å¸®å¤§å®¶é¿å¼è¿äºâéå½¢ç¸å¼¹âã</p>
<p>åæç¡®åæï¼åå¸å¼éçæ ¸å¿æ¯âäºæ¥æ§âï¼ä½å¨åå¸å¼ç¯å¢ä¸ï¼ç½ç»å»¶è¿ãæå¡å®æºãRedis éç¾¤åæ­¥å»¶è¿ç­å ç´ ï¼é½ä¼ç ´åéçç¨³å®æ§ãææé®é¢çæ¬è´¨ï¼è¦ä¹æ¯âåå­æ§ç¼ºå¤±âï¼è¦ä¹æ¯âé«å¯ç¨èèä¸è¶³âï¼è¦ä¹æ¯âä¸å¡ä¸éæºå¶ä¸å¹éâã</p>
<h2 id="ä¸æ ¸å¿é®é¢åè§£å³æ¹æ¡æè¸©åé¢çæåº">ä¸ãæ ¸å¿é®é¢åè§£å³æ¹æ¡ï¼æè¸©åé¢çæåºï¼</h2>
<h3 id="é®é¢-1è¯¯å ä»äººææéæåºç¡ä¹ææç¯çæ¼æ´">é®é¢ 1ï¼è¯¯å ä»äººææéââæåºç¡ä¹ææç¯çæ¼æ´</h3>
<p><strong>æå </strong>ï¼éæ¾éæ¶æªåèº«ä»½æ ¡éªï¼ç´æ¥æ§è¡ DEL å½ä»¤å é¤é®ãå¸ååºæ¯ï¼æå¡ A ææéåï¼ä¸å¡é»è¾èæ¶è¶è¿éè¿ææ¶é´ï¼éè¢«èªå¨éæ¾ï¼æå¡ B è¶æºå éæåï¼æ­¤æ¶æå¡ A æ§è¡å®ä¸å¡ï¼ç´æ¥ DEL éå°±ä¼è¯¯å æå¡ B ææçéï¼å¯¼è´äºæ¥æ§å¤±æã</p>
<p><strong>è¡¨ç°</strong>ï¼å¤ä¸ªæå¡å®ä¾åæ¶ææåä¸æéï¼æä½åä¸èµæºï¼åºç°æ°æ®ä¸ä¸è´ï¼å¦è¶åãéå¤è®¢åï¼ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼å éæ¶å­å¥å¨å±å¯ä¸çéæºå¼ï¼å¦ UUID+çº¿ç¨ IDï¼ä½ä¸º valueï¼éæ¾éååéªè¯ value æ¯å¦ä¸èªèº«ææä¸è´ï¼ä¸è´æéæ¾ãå³é®æ¯ç¨ Lua èæ¬ä¿è¯âéªè¯+å é¤âçåå­æ§ï¼é¿åéªè¯åéè¿æè¢«ä»äººææã</p>
<pre><code class="language-lua">-- å®å¨éæ¾éç Lua èæ¬
if redis.call('get', KEYS[1]) == ARGV[1] then
    return redis.call('del', KEYS[1])
else
    return 0
end
</code></pre>
<p>æ³¨æï¼ä¸¥ç¦æåâéªè¯âåâå é¤âä¸ºä¸¤æ­¥æä½ï¼å¦åä»å­å¨å¹¶åæ¼æ´ã</p>
<h3 id="é®é¢-2éè¿ææåéæ¾ä¸å¡æªåå®éå·²å¤±æ">é®é¢ 2ï¼éè¿ææåéæ¾ââä¸å¡æªåå®éå·²å¤±æ</h3>
<p><strong>æå </strong>ï¼éçè¿ææ¶é´è®¾ç½®è¿ç­ï¼èä¸å¡é»è¾æ§è¡èæ¶è¿é¿ï¼å¯¼è´éå¨ä¸å¡å®æåå°±èªå¨è¿æéæ¾ï¼å¶ä»æå¡å¯è¶æºå éï¼å¼åå¹¶åå²çªãæ¯å¦éè®¾ä¸º 30 ç§è¿æï¼ä½æ°æ®åºå¤ææ¥è¯¢ãç¬¬ä¸æ¹æ¥å£è°ç¨èæ¶ 40 ç§ï¼å°±ä¼åºç°éæåå¤±æã</p>
<p><strong>è¡¨ç°</strong>ï¼ä¸å¡æ§è¡ä¸­éè¢«éæ¾ï¼å¤ä¸ªæå¡åæ¶æä½èµæºï¼åºç°æ°æ®éè¯¯ï¼ä¸é®é¢å·æéæºæ§ï¼åå³äºä¸å¡èæ¶æ¯å¦è¶è¿è¿ææ¶é´ï¼ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼å¼å¥âéç»­çº¦ï¼Watch Dogï¼âæºå¶ãæå¡æåå éåï¼å¯å¨åå°å®æ¤çº¿ç¨ï¼æ¯ééè¿ææ¶é´ç 1/3 ï¼å¦ 10 ç§ï¼æ£æ¥éæ¯å¦ä»è¢«èªèº«ææï¼è¥ææåå»¶é¿éçè¿ææ¶é´ï¼éç½®ä¸º 30 ç§ï¼ï¼ç´å°ä¸å¡å®æä¸»å¨éæ¾éã</p>
<p>å®éå¼åä¸­æ éæå¨å®ç°ï¼Redisson æ¡æ¶åç½® Watch Dog æºå¶ï¼å éåèªå¨ç»­çº¦ï¼å½»åºè§£å³éæåéæ¾é®é¢ã</p>
<h3 id="é®é¢-3redis-åç¹æééæå¡æ´ä½ä¸å¯ç¨">é®é¢ 3ï¼Redis åç¹æéââéæå¡æ´ä½ä¸å¯ç¨</h3>
<p><strong>æå </strong>ï¼Redis éç¨åç¹é¨ç½²ï¼å½ Redis æå¡å®æºï¼å¦è¿ç¨å´©æºãæå¡å¨æ­çµï¼ï¼ææåå¸å¼éçå éãéæ¾æä½é½ä¼å¤±è´¥ï¼å¯¼è´åå¸å¼ç³»ç»çå¹¶åæ§å¶æºå¶å´©æºï¼æ æ³æ­£å¸¸å¤çèµæºç«äºã</p>
<p><strong>è¡¨ç°</strong>ï¼ææä¾èµåå¸å¼éçä¸å¡æ¥å£æ¥éï¼æ æ³æ§è¡ï¼å¦åºå­æ£åãè®¢ååå»ºæ¥å£ï¼ï¼çè³å¼åæå¡éªå´©ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼éç¨ Redis é«å¯ç¨éç¾¤é¨ç½²ï¼ä¸¤ç§ä¸»æµæ¹æ¡æééæ©ï¼</p>
<ol>
<li>
<p><strong>ä¸»ä»å¤å¶ + å¨åµæ¨¡å¼</strong>ï¼é¨ç½² 1 ä¸»å¤ä» Redis éç¾¤ï¼å¨åµå®æ¶çæ§ä¸»èç¹ç¶æï¼ä¸»èç¹å®æºæ¶èªå¨å°ä»èç¹åæ¢ä¸ºä¸»èç¹ï¼ä¿è¯ Redis æå¡è¿ç»­æ§ãç¼ºç¹æ¯å­å¨âèè£âé£é©ï¼ä¸»ä»æ°æ®åæ­¥å»¶è¿å¯¼è´éä¸¢å¤±ï¼ï¼éåå¯¹ä¸è´æ§è¦æ±ä¸è¬çåºæ¯ã</p>
</li>
<li>
<p><strong>Redlock ç®æ³</strong>ï¼åè³å° 3 ä¸ªç¬ç«ç Redis ä¸»èç¹åèµ·å éè¯·æ±ï¼ä»å½è¶è¿åæ°èç¹å éæåï¼ä¸æ»èæ¶ä¸è¶è¿è¶æ¶æ¶é´ï¼æç®å éæåãå³ä½¿é¨åèç¹å®æºï¼åªè¦å¤æ°èç¹æ­£å¸¸ï¼éæå¡å°±å¯ç¨ï¼å½»åºé¿ååç¹æéåèè£é®é¢ï¼éåé«ä¸è´æ§åºæ¯ãRedisson å·²åç½® Redlock å®ç°ï¼å¼ç®±å³ç¨ï¼ä»¥ä¸æ¯å®æ´å®æéç½®ä¸ä»£ç ï¼</p>
</li>
</ol>
<h4 id="1-å¤ç»ç¬ç«-redis-èç¹éç½®yml">1. å¤ç»ç¬ç« Redis èç¹éç½®ï¼YMLï¼</h4>
<p>Redlock è¦æ±èç¹ç©çç¬ç«ï¼é¿ååä¸æºæ¿æéçµè¿å¤ç»èç¹ï¼ï¼æ¯ç»èç¹å¯åç¬é¨ç½²ä¸»ä»+å¨åµæåå¯ç¨æ§ï¼3 ç»èç¹å®æ´éç½®å¦ä¸ï¼</p>
<pre><code class="language-yaml">spring:
  redis:
    # Redlock ä¸ç¨å¤ç»ç¬ç«èç¹éç½®
    redlock:
      # ç¬¬ä¸ç»èç¹ï¼å¯é¨ç½²ä¸»ä»+å¨åµï¼
      node1:
        host: 192.168.1.101
        port: 6379
        password: 123456
        database: 0
        timeout: 5000  # è¿æ¥è¶æ¶æ¶é´ï¼æ¯«ç§ï¼
      # ç¬¬äºç»èç¹ï¼ç¬ç«æå¡å¨ï¼ä¸ç¬¬ä¸ç»æ å³èï¼
      node2:
        host: 192.168.1.102
        port: 6379
        password: 123456
        database: 0
        timeout: 5000
      # ç¬¬ä¸ç»èç¹ï¼ç¬ç«æå¡å¨ï¼å»ºè®®è·¨æºæ¿ï¼
      node3:
        host: 192.168.1.103
        port: 6379
        password: 123456
        database: 0
        timeout: 5000
</code></pre>
<h4 id="2-redisson-å®¢æ·ç«¯éç½®å¤èç¹å®ä¾å">2. Redisson å®¢æ·ç«¯éç½®ï¼å¤èç¹å®ä¾åï¼</h4>
<p>éè¿éç½®ç±»è¯»å YML ä¿¡æ¯ï¼åå»ºå¯¹åº RedissonClient å®ä¾ï¼ä¿è¯æ¯ç»èç¹ç¬ç«è¿æ¥ï¼</p>
<pre><code class="language-java">@Configuration
public class RedissonRedlockConfig {

    // ç¬¬ä¸ç» Redlock èç¹å®¢æ·ç«¯
    @Bean(name = "redlockClient1")
    public RedissonClient redlockClient1(
            @Value("${spring.redis.redlock.node1.host}") String host,
            @Value("${spring.redis.redlock.node1.port}") int port,
            @Value("${spring.redis.redlock.node1.password}") String password,
            @Value("${spring.redis.redlock.node1.database}") int database,
            @Value("${spring.redis.redlock.node1.timeout}") int timeout) {
        Config config = new Config();
        // åèç¹æ¨¡å¼ï¼è¥ä¸ºéç¾¤ï¼å¯æ¹ç¨ useSentinelServers éç½®å¨åµï¼
        config.useSingleServer()
                .setAddress("redis://" + host + ":" + port)
                .setPassword(password)
                .setDatabase(database)
                .setTimeout(timeout);
        return Redisson.create(config);
    }

    // ç¬¬äºç» Redlock èç¹å®¢æ·ç«¯
    @Bean(name = "redlockClient2")
    public RedissonClient redlockClient2(
            @Value("${spring.redis.redlock.node2.host}") String host,
            @Value("${spring.redis.redlock.node2.port}") int port,
            @Value("${spring.redis.redlock.node2.password}") String password,
            @Value("${spring.redis.redlock.node2.database}") int database,
            @Value("${spring.redis.redlock.node2.timeout}") int timeout) {
        Config config = new Config();
        config.useSingleServer()
                .setAddress("redis://" + host + ":" + port)
                .setPassword(password)
                .setDatabase(database)
                .setTimeout(timeout);
        return Redisson.create(config);
    }

    // ç¬¬ä¸ç» Redlock èç¹å®¢æ·ç«¯
    @Bean(name = "redlockClient3")
    public RedissonClient redlockClient3(
            @Value("${spring.redis.redlock.node3.host}") String host,
            @Value("${spring.redis.redlock.node3.port}") int port,
            @Value("${spring.redis.redlock.node3.password}") String password,
            @Value("${spring.redis.redlock.node3.database}") int database,
            @Value("${spring.redis.redlock.node3.timeout}") int timeout) {
        Config config = new Config();
        config.useSingleServer()
                .setAddress("redis://" + host + ":" + port)
                .setPassword(password)
                .setDatabase(database)
                .setTimeout(timeout);
        return Redisson.create(config);
    }
}
</code></pre>
<h4 id="3-redlock-å ééæ¾éä¸å¡ä»£ç ">3. Redlock å é/éæ¾éä¸å¡ä»£ç </h4>
<p>éè¿ RedissonRedLock ç»åå¤èç¹éï¼èªå¨è§¦åæç¥¨é»è¾ï¼å¼å®¹æ®ééç¨æ³ï¼åç½® Watch Dog ç»­çº¦ï¼</p>
<pre><code class="language-java">@Service
public class StockService {

    @Autowired
    @Qualifier("redlockClient1")
    private RedissonClient redlockClient1;

    @Autowired
    @Qualifier("redlockClient2")
    private RedissonClient redlockClient2;

    @Autowired
    @Qualifier("redlockClient3")
    private RedissonClient redlockClient3;

    @Autowired
    private StockMapper stockMapper;

    public void deductStock(Long productId) {
        // 1. çæç»ä¸éKeyï¼è·åå¤èç¹éå¯¹è±¡
        String lockKey = "lock:stock:" + productId;
        RLock lock1 = redlockClient1.getLock(lockKey);
        RLock lock2 = redlockClient2.getLock(lockKey);
        RLock lock3 = redlockClient3.getLock(lockKey);

        // 2. ç»åä¸ºRedlockéï¼è§¦åå¤èç¹æç¥¨
        RedissonRedLock redLock = new RedissonRedLock(lock1, lock2, lock3);

        try {
            // 3. å éï¼1ç§åç­å¾èç¹ååºï¼éè¿ææ¶é´30ç§ï¼åç½®ç»­çº¦ï¼
            boolean locked = redLock.tryLock(1000, 30000, TimeUnit.MILLISECONDS);
            if (locked) {
                // 4. æ ¸å¿ä¸å¡ï¼åºå­æ£åï¼ä»ä¿çéåå¿è¦æä½ï¼
                Stock stock = stockMapper.selectById(productId);
                if (stock != null &amp;&amp; stock.getCount() &gt; 0) {
                    stock.setCount(stock.getCount() - 1);
                    stockMapper.updateById(stock);
                }
            } else {
                // å éå¤±è´¥ååº
                throw new RuntimeException("ç³»ç»ç¹å¿ï¼è¯·ç¨ååè¯");
            }
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            throw new RuntimeException("æä½è¢«ä¸­æ­ï¼è¯·éè¯");
        } finally {
            // 5. å®å¨éæ¾éï¼ä»å½åçº¿ç¨ææéæ¶æ§è¡
            if (redLock.isHeldByCurrentThread()) {
                redLock.unlock();
            }
        }
    }
}
</code></pre>
<p>å³é®è¯´æï¼â  å¤ç»èç¹éç©çéç¦»ï¼è·¨æºæ¿é¨ç½²å¯æåå®¹éï¼â¡ 3 ç»èç¹æå¤åè®¸ 1 ç»æéï¼è¶è¿åæ°èç¹å éæåå³çæï¼â¢ éæ¾éæ¶èªå¨åæ­¥æ¸çææèç¹éæ°æ®ï¼æ éæå¨åè°ã</p>
<h3 id="é®é¢-4éæ æ³éå¥åµå¥ä¸å¡æ­»é">é®é¢ 4ï¼éæ æ³éå¥ââåµå¥ä¸å¡æ­»é</h3>
<p><strong>æå </strong>ï¼åºç¡å®ç°çéä¸æ¯æéå¥ï¼å³åä¸æå¡çåä¸çº¿ç¨å¨ææéçæåµä¸ï¼åæ¬¡è¯·æ±å åä¸æéä¼å¤±è´¥ãå¸ååºæ¯ï¼æå¡ A å éåï¼æ§è¡çæ¹æ³ä¸­åè°ç¨äºå¦ä¸ä¸ªéè¦å åä¸æéçæ¹æ³ï¼ç¬¬äºæ¬¡å éå¤±è´¥ï¼å¯¼è´çº¿ç¨é»å¡ï¼å¼åæ­»éã</p>
<p><strong>è¡¨ç°</strong>ï¼ä¸å¡çº¿ç¨é»å¡ï¼æ¥å£è¶æ¶æ ååºï¼ææ¥ååç°æ¯åä¸çº¿ç¨éå¤å éè¢«æã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼å®ç°å¯éå¥éæºå¶ãéç value å­å¨âå¯ä¸æ è¯ + éå¥æ¬¡æ°âï¼ç¬¬ä¸æ¬¡å éæ¶å­å¥æ è¯åæ¬¡æ° 1ï¼åä¸çº¿ç¨åæ¬¡å éæ¶ï¼éªè¯æ è¯ä¸è´ï¼å°æ¬¡æ°å  1ï¼éæ¾éæ¶ï¼æ¬¡æ°å 1ï¼ç´å°æ¬¡æ°ä¸º 0 æå é¤é®å½»åºéæ¾éã</p>
<p>æå¨å®ç°é»è¾å¤æï¼æ¨èä½¿ç¨ Redisson ç RLock æ¥å£ï¼å¤©ç¶æ¯æå¯éå¥ï¼ç¨æ³ä¸æ¬å° synchronized éä¸è´ï¼æ éé¢å¤å¼åã</p>
<h3 id="é®é¢-5ä¸»ä»åæ¢éä¸¢å¤±èè£éç¾¤ç¯å¢ä¸çéå½¢å">é®é¢ 5ï¼ä¸»ä»åæ¢éä¸¢å¤±ï¼èè£ï¼ââéç¾¤ç¯å¢ä¸çéå½¢å</h3>
<p><strong>æå </strong>ï¼Redis ä¸»ä»éç¾¤ä¸­ï¼ä¸»èç¹å­å¨éæ°æ®åï¼å°æªåæ­¥å°ä»èç¹å°±å®æºï¼å¨åµå°ä»èç¹åæ¢ä¸ºä¸»èç¹ï¼æ°ä¸»èç¹æ è¯¥éæ°æ®ï¼å¶ä»æå¡å¯éæ°å éï¼å¯¼è´åéå¤±æï¼åºç°å¤ä¸ªæå¡ææéçæåµãè¿æ¯ä¸»ä» + å¨åµæ¨¡å¼çåºæé£é©ã</p>
<p><strong>è¡¨ç°</strong>ï¼ä¸»ä»åæ¢åï¼åææéçæå¡ä»å¨æ§è¡ä¸å¡ï¼æ°æå¡å´è½å éæåï¼å¼åæ°æ®å²çªï¼ä¸é®é¢é¾ä»¥å¤ç°ï¼ä»åçå¨ä¸»ä»åæ¢ç¬é´ï¼ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ul>
<li>
<p>ä½ä¸è´æ§åºæ¯ï¼å¼å¯ Redis ä¸»ä»åæ­¥çâæä¹å + ç­å¾åæ­¥ç¡®è®¤âï¼ä¸»èç¹åå¥éæ°æ®åï¼ç­å¾è³å° 1 ä¸ªä»èç¹åæ­¥å®æåè¿åå éæåï¼éä½éä¸¢å¤±æ¦çï¼ä»æ æ³å®å¨é¿åï¼ã</p>
</li>
<li>
<p>é«ä¸è´æ§åºæ¯ï¼æ¾å¼ä¸»ä» + å¨åµæ¨¡å¼ï¼æ¹ç¨ Redlock ç®æ³ï¼éè¿å¤ä¸»èç¹æç¥¨æºå¶ï¼ä»æ ¹æºä¸è§£å³èè£å¯¼è´çéä¸¢å¤±é®é¢ã</p>
</li>
</ul>
<h3 id="é®é¢-6å éå¤±è´¥æ éè¯ç­ç¥ä¸å¡å¶åå¤±è´¥">é®é¢ 6ï¼å éå¤±è´¥æ éè¯ç­ç¥ââä¸å¡å¶åå¤±è´¥</h3>
<p><strong>æå </strong>ï¼å éæ¶ä»å°è¯ä¸æ¬¡ï¼è¥å ç½ç»æ³¢å¨ãRedis ä¸´æ¶ç¹å¿å¯¼è´å éå¤±è´¥ï¼ç´æ¥æåºå¼å¸¸ï¼å¯¼è´ä¸å¡æ§è¡å¤±è´¥ãåå¸å¼ç¯å¢ä¸­ï¼ç½ç»æå¨ãRedis ç¬æ¶ååå¤§æ¯å¸¸è§æåµï¼æ éè¯ç­ç¥ä¼æ¾å¤§è¿ç±»é®é¢çå½±åã</p>
<p><strong>è¡¨ç°</strong>ï¼é¨åç¨æ·æä½å¤±è´¥ï¼å¦æäº¤è®¢åæç¤ºâç³»ç»ç¹å¿âï¼ï¼éè¯åå¯æåï¼é®é¢å·æéæºæ§ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼å®ç°å¸¦éå¶çéè¯æºå¶ï¼å éå¤±è´¥åï¼é´éä¸å®æ¶é´ï¼å¦ 100msï¼éè¯ï¼åæ¶è®¾ç½®æå¤§éè¯æ¬¡æ°ï¼å¦ 3 æ¬¡ï¼åæ»è¶æ¶æ¶é´ï¼å¦ 1 ç§ï¼ï¼é¿åæ ééè¯å¯¼è´ Redis ååè¿å¤§ï¼ä¹è½æåå éæåçã</p>
<pre><code class="language-java">// å¸¦éè¯çå éé»è¾ï¼Spring Data Redis ç¤ºä¾ï¼
public boolean lockWithRetry(String key, String value, long expireMs, int maxRetry, long retryIntervalMs) {
    for (int i = 0; i &lt; maxRetry; i++) {
        Boolean result = redisTemplate.opsForValue().setIfAbsent(key, value, expireMs, TimeUnit.MILLISECONDS);
        if (Boolean.TRUE.equals(result)) {
            return true;
        }
        try {
            Thread.sleep(retryIntervalMs);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            return false;
        }
    }
    return false;
}
</code></pre>
<h3 id="é®é¢-7é¿æ¶é´ææéç³»ç»å¹¶åééª¤é">é®é¢ 7ï¼é¿æ¶é´ææéââç³»ç»å¹¶åééª¤é</h3>
<p><strong>æå </strong>ï¼å¨éçèå´åæ§è¡èæ¶æä½ï¼å¦å¤ææ°æ®åºæ¥è¯¢ãç¬¬ä¸æ¹æ¥å£è°ç¨ãå¤§éæ°æ®å¤çï¼ï¼å¯¼è´éæææ¶é´è¿é¿ï¼å¶ä»æå¡è¯·æ±è¯¥éæ¶è¢«é¿æ¶é´é»å¡ï¼ç³»ç»ååéå¤§å¹ä¸éã</p>
<p><strong>è¡¨ç°</strong>ï¼ä¾èµè¯¥éçæ¥å£ååºæ¶é´åé¿ï¼å¹¶åéä¸ä¸å»ï¼çæ§æ¾ç¤ºå¤§éçº¿ç¨é»å¡å¨å éç¯èã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ul>
<li>
<p>ç²¾ç®éåä¸å¡ï¼ä»å°âèµæºç«äºæ ¸å¿é»è¾âï¼å¦åºå­æ£åãè®¢åç¶æä¿®æ¹ï¼æ¾å¥éåï¼éæ ¸å¿é»è¾ï¼å¦æ¥å¿è®°å½ãæ¶æ¯æ¨éï¼ç§»è³éå¤æ§è¡ã</p>
</li>
<li>
<p>å¼æ­¥åå¤çï¼è¥éåå¿é¡»æ§è¡èæ¶æä½ï¼å°å¶å¼æ­¥åï¼å¦ç¨çº¿ç¨æ± ãæ¶æ¯éåï¼ï¼ç¼©ç­éæææ¶é´ã</p>
</li>
<li>
<p>è®¾ç½®éææè¶æ¶é¢è­¦ï¼éè¿çæ§å·¥å·ç»è®¡éæææ¶é´ï¼è¶è¿éå¼ï¼å¦ 20 ç§ï¼æ¶åè­¦ï¼åæ¶ææ¥èæ¶ä¸å¡ã</p>
</li>
</ul>
<h3 id="é®é¢-8é-key-è®¾è®¡ä¸å½éç²åº¦é®é¢å¼åå¹¶åç¶é¢">é®é¢ 8ï¼é key è®¾è®¡ä¸å½ââéç²åº¦é®é¢å¼åå¹¶åç¶é¢</h3>
<p><strong>æå </strong>ï¼é key ç²åº¦å¤ªç²ï¼å¦ç¨âlock:stockâä½ä¸ºææååçåºå­éï¼ï¼å¯¼è´ææååçåºå­æä½é½äºæ¥ï¼å³ä½¿æä½ä¸åååï¼ä¹éæéç­å¾ééæ¾ï¼å½»åºä¸§å¤±åå¸å¼ç³»ç»çå¹¶åä¼å¿ã</p>
<p><strong>è¡¨ç°</strong>ï¼ç³»ç»å¹¶åéæä½ï¼ä¸åååçåºå­æ£åè¯·æ±ä¸²è¡æ§è¡ï¼æ¥å£ååéè¿ä½äºé¢æã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼ç²¾ç»åè®¾è®¡é keyï¼æå·ä½èµæºæ è¯æåéãæ¯å¦åºå­éï¼ç¨âlock:stock:1001âï¼1001 ä¸ºåå IDï¼ä½ä¸ºé keyï¼ä»å¯¹åä¸ååçåºå­æä½äºæ¥ï¼ä¸åååå¯å¹¶è¡å¤çï¼å¤§å¹æåå¹¶åéã</p>
<p>å»¶ä¼¸ï¼é«å¹¶ååºæ¯ä¸ï¼å¯è¿ä¸æ­¥ç¨âåæ®µéâæåèµæºï¼å¦å°åå ID åå¸å° 10 ä¸ªåæ®µï¼é key ä¸ºâlock:stock:segment:1âï¼ï¼åä¸åæ®µäºæ¥ï¼ä¸ååæ®µå¹¶è¡ï¼è¿ä¸æ­¥æåå¹¶åè½åã</p>
<h3 id="é®é¢-9ç½ç»ååºå¯¼è´éç¶æä¸ä¸è´æç«¯åºæ¯ä¸çéæ£">é®é¢ 9ï¼ç½ç»ååºå¯¼è´éç¶æä¸ä¸è´ââæç«¯åºæ¯ä¸çéæ£</h3>
<p><strong>æå </strong>ï¼åå¸å¼ç¯å¢ä¸­åºç°ç½ç»ååºï¼ææéçæå¡ä¸ Redis éç¾¤éç¦»ï¼æ æ³ä¸»å¨éæ¾éï¼ä¹æ æ³æ¥æ¶éç»­çº¦ä¿¡å·ï¼éè¿æåï¼å¶ä»æå¡å éæåï¼ç½ç»æ¢å¤åï¼åææéçæå¡è¯¯ä»¥ä¸ºéä»ææï¼ç»§ç»­æä½èµæºï¼å¯¼è´æ°æ®å²çªã</p>
<p><strong>è¡¨ç°</strong>ï¼æç«¯ç½ç»å¼å¸¸åï¼åºç°æ°æ®ä¸ä¸è´ï¼ä¸é®é¢é¾ä»¥ææ¥ï¼ä¸ç½ç»ååºæ¶é´ãéè¿ææ¶é´å¼ºç¸å³ï¼ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ul>
<li>
<p>å¼å¥ä¸å¡æ ¡éªæºå¶ï¼æä½èµæºåï¼åæ¬¡æ ¡éªèµæºç¶æï¼å¦æ£ååºå­åï¼æ£æ¥åºå­æ¯å¦ä¸é¢æä¸è´ï¼ï¼é¿ååºäºè¿æéçæ ææä½ã</p>
</li>
<li>
<p>ç¼©ç­éè¿ææ¶é´ï¼ç»å Watch Dog æºå¶ï¼å°åºç¡è¿ææ¶é´è®¾ç­ï¼å¦ 10 ç§ï¼ï¼åå°ç½ç»ååºå¯¼è´çéç¶æä¸ä¸è´çªå£ã</p>
</li>
<li>
<p>ä½¿ç¨ Redlock ç®æ³ï¼å¤ä¸»èç¹æç¥¨æºå¶ï¼å¯éä½ç½ç»ååºå¯¹éç¶æçå½±åï¼æåä¸è´æ§ã</p>
</li>
</ul>
<h2 id="äºçäº§é¿åæ»ç»">äºãçäº§é¿åæ»ç»</h2>
<p>Redis åå¸å¼éçé®é¢ï¼å¤§å¤ä¸æ¯ Redis æ¬èº«çç¼ºé·ï¼èæ¯å¯¹åå¸å¼åºæ¯çå¤ææ§èèä¸è¶³ãç»åå®æç»éªï¼æ»ç» 3 ä¸ªæ ¸å¿é¿åååï¼</p>
<ol>
<li>
<p>ä¼åä½¿ç¨æçæ¡æ¶ï¼æ¾å¼æå¨å®ç°åå¸å¼éï¼Redisson å·²å°è£è§£å³ä¸è¿°ææé®é¢ï¼å¼ç®±å³ç¨ï¼ç¨³å®æ§è¿é«äºèªå®ä¹å®ç°ã</p>
</li>
<li>
<p>å¹éä¸å¡åºæ¯éåï¼é«ä¸è´æ§ãé«å¯ç¨åºæ¯ç¨ Redlock ç®æ³ï¼ä¸è¬åºæ¯ç¨ä¸»ä» + å¨åµæ¨¡å¼ï¼æ ¹æ®å¹¶åéè®¾è®¡éç²åº¦ï¼ç²¾ç»å/åæ®µéï¼ã</p>
</li>
<li>
<p>å®åçæ§ä¸ååºï¼çæ§éæææ¶é´ãå éæåçãRedis éç¾¤ç¶æï¼è®¾ç½®åè­¦éå¼ï¼å éå¤±è´¥ãéè¿æç­åºæ¯ï¼éæä¸å¡ååºç­ç¥ï¼éè¯ãè¿ååå¥½æç¤ºãéåç¼å­ï¼ã</p>
</li>
</ol>
<p>æ»ä¹ï¼Redis åå¸å¼éçæ ¸å¿æ¯âå¼é¡¾äºæ¥æ§ä¸é«å¯ç¨âï¼é¿å¼ä¸è¿°é®é¢åï¼æè½çæ­£æä¸ºåå¸å¼ç³»ç»è§£å³å¹¶åå²çªçå©å¨ï¼èéç³»ç»çæ°ç¶é¢ã</p>

</div>
<div id="MySignature" role="contentinfo">
    
<p>â¤ï¸ å¦æä½ åæ¬¢è¿ç¯æç« ï¼è¯·ç¹èµæ¯æï¼ ð åæ¶æ¬¢è¿å³æ³¨æçåå®¢ï¼è·åæ´å¤ç²¾å½©åå®¹ï¼</p>

<p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/sun-10387834/" target="_blank">ä½ç¥è®©ææ¥å·¡å±±</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/sun-10387834/p/19493006" target="_blank">https://www.cnblogs.com/sun-10387834/p/19493006</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 19:24">2026-01-20 19:23</span>&nbsp;
<a href="https://www.cnblogs.com/sun-10387834">ä½ç¥è®©ææ¥å·¡å±±</a>&nbsp;
éè¯»(<span id="post_view_count">162</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19493006);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19493006', targetLink: 'https://www.cnblogs.com/sun-10387834/p/19493006', title: 'å¹²è´§æ»¡æ»¡ï¼Redis åå¸å¼éå¿é¿ç 8 å¤§é®é¢åè§£å³æ¹æ¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åä¸ºäºåå¸CodeArts Doerä»£ç æºè½ä½ä¸ªäººçï¼ä¸é®å¼å¯ä½ çç¼ç èªå¨é©¾é©¶æ¨¡å¼ ]]></title>
    <link>https://www.cnblogs.com/huaweiyun/p/19508288</link>
    <guid>6f2339ae6a62e712ab5ac97d24c28bf9</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huaweiyun/p/19508288" title="åå¸äº 2026-01-20 18:34">
    <span role="heading" aria-level="2">åä¸ºäºåå¸CodeArts Doerä»£ç æºè½ä½ä¸ªäººçï¼ä¸é®å¼å¯ä½ çç¼ç èªå¨é©¾é©¶æ¨¡å¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div style="text-align: left" align="center">2026å¹´1æ16æ¥ï¼åä¸ºäºæ­£å¼åå¸CodeArts Doerä»£ç æºè½ä½ãè¿æ¬¾æ·±åº¦èåAIåçè½åçæºè½ç¼ç äº§åï¼éæäºAI IDEãCode AgentãCodebaseä»£ç ä»æ·±åº¦çè§£ç­æ ¸å¿è½åï¼æ´æç åéæ±ãç²¾éç¼ç ãåç¨ç¾å¨ï¼ä¸ºå¼åèå¸¦æ¥çæ°ç åä½éªã</div>
<div style="text-align: left">&nbsp;<img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260120183417566-1436339979.png" class="lazyload"></div>
<p>æ¬æ¬¡åå¸çä¸å¤§æ°åç¹æ§ï¼ AI IDEãCode AgentãCodebase</p>
<p><strong>AI IDE</strong><strong>ï¼åçæºè½ï¼çæ°å¼åä½éª</strong></p>
<p>AI IDEä»¥AIåçä¸ºèµ·ç¹ï¼å°ç¼ç è½åä¸æºè½ä½æ·±åº¦èåï¼ä¸ºå¼åèå¸¦æ¥æ´èªç¶çå¼åå·¥ä½æµï¼ä»éæ±æè¿°å°ä»»å¡æè§£ï¼ä»æ¥å£è®¾è®¡å°ä»£ç è½å°ï¼å¨IDEåå³å¯å®æé­ç¯ãåæ¶ï¼AI IDEåç½®ä¸å®¶æè½ä¸ç²¾éå·¥å·ï¼å½¢æâäºº+AI+å·¥å·âçååå¼åå¹³å°ï¼å¼åèä¸æ³¨ä¸å¡å¤æ­ä¸å³é®å³ç­ï¼AI IDEè´è´£é«é¢ãéå¤ãæéæ¼çå·¥ç¨åå·¥ä½ï¼è®©ä½éªä»âå¤å¼çªå£æ¾å·¥å·âåçº§ä¸ºâå¨ä¸ä¸ªå·¥ä½å°éå®æäº¤ä»âã</p>
<p>&nbsp;<img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260120183416252-348731928.png" class="lazyload"></p>
<p><strong>Code Agent</strong><strong>ï¼å·¦æç¼ç èªç±ï¼å³æè§èé«æ</strong></p>
<p>CodeArts Doerä»£ç æºè½ä½æä¾ä¸¤ç§é¢åä¸åé¶æ®µä¸è¯æ±çå¼åæ¨¡å¼ï¼</p>
<p>æ¢ç´¢æ¨¡å¼ï¼æ´å¼ºè°äººæºååä¸åé åãä½ å¯ä»¥ç¨èªç¶è¯­è¨æè¿°éæ±ç®æ ï¼è®©CodeArts Doerä»£ç æºè½ä½ä¸ºä½ è§åå¹¶åè§£é¡¹ç®ä»»å¡ï¼çæé¡¹ç®çº§ä»£ç ãè¿è¡Agentç¥è¯å¢å¼ºãä»£ç ç»­åï¼å¹¶å¨å¤è½®å¯¹è¯ä¸­æç»­è¿­ä»£ï¼æâæ³æ³âå¿«éæ¨è¿å°âå¯è¿è¡âã</p>
<p>è§èæ¨¡å¼ï¼æ´å¼ºè°è´¨éãå®å¨ä¸ä¸è´æ§ãè§èé©±å¨å¼åï¼è®©ä»£ç éµä»æ åæµç¨çæãå¨çæä¸ä¿®æ¹ä»£ç è¿ç¨ä¸­å¯¹é½è§èï¼æåä»£ç çå¯è¯»æ§ãå¯ç»´æ¤æ§ï¼åæ¶å¨å³é®ç¹è¿è¡å®å¨ä¸è´¨éæ ¡éªï¼å¸®å©å¢éæâå¿«âå»ºç«å¨âç¨³âçåºç¡ä¸ã</p>
<p><img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260120183416252-348731928.png" class="lazyload"></p>
<p><strong>Codebase</strong><strong>ï¼ä»£ç ä»æ·±åº¦çè§£ï¼ææä½ çAIç¼ç ä¸å®¶</strong></p>
<p>çæ­£éç¨äºçäº§ç¯å¢çAIç¼ç ï¼å³é®å¨äºâçè§£ä½ çé¡¹ç®âãCodebaseæ¯æç¾ä¸è¡çº§ä»£ç ç´¢å¼ãç¥è¯å¾è°±æå»ºãææ¡£çæä¸æ¼ååå²ç¥è¯æ²æ·ï¼åç¡®çè§£ä»£ç ä»ç»æãä¾èµå³ç³»ä¸ä¸å¡è¾¹çï¼åèº«æä¸ä½ä¸å±çä»£ç ç¥è¯ä¸å®¶ï¼å¸®å©æ°æåå¿«éä¸æãèæåå¿«éå®ä½ãåæ¶ï¼åç¡®æ£ç´¢è½åè®©AIæ´å¿«æ¾å°ä½ çæ­£éè¦çå½æ°ãæ¥å£ä¸å®ç°ç»èï¼åå°âçä¼¼æ­£ç¡®ãå®åä¸ééâççæåå®¹ï¼è®©æ¯ä¸æ¬¡å»ºè®®é½æ´è´´è¿é¡¹ç®ç°å®ã</p>
<p>&nbsp;<img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260120183417231-1140323952.png" class="lazyload"></p>
<p><strong>å¤ç§ç¨æ·åºæ¯ï¼è®©ç åä»âäººåä¸»å¯¼âèµ°åâäººæºå±åâ</strong></p>
<p>CodeArts Doerä»£ç æºè½ä½å·²å¨é¡¹ç®çº§ä»£ç çæãAgentç¥è¯å¢å¼ºãä»£ç ç»­åãç åç¥è¯é®ç­ãååæµè¯çæç­åºæ¯å®ç°å¼åèæçæåï¼åæ¶ä¹æ¯æä¸°å¯å·¥å·çæï¼å©åé«æå¼åä¸ä¸ªæ§åå®å¶ã</p>
<p>ç®åï¼CodeArts Doerä»£ç æºè½ä½ä¸ªäººçå·²ç»æ­£å¼åå¸ï¼é¢åå¹¿å¤§å¼åèå¼æ¾åè´¹ä½éªãè®©AIçæ­£èµ°è¿å·¥ç¨ãèµ°è¿æµç¨ãèµ°è¿äº¤ä»ââä»ä»å¤©èµ·ï¼å¼å¯ä½ çç¼ç èªå¨é©¾é©¶æ¨¡å¼ã</p>
<p>ä½éªCodeArts Doerä»£ç æºè½ä½ï¼<a href="https://developer.huaweicloud.com/signup/78745481cafb4d79bf62096f6770c72e?channelCode=hcdg" target="_blank" rel="noopener nofollow">https://developer.huaweicloud.com/signup/78745481cafb4d79bf62096f6770c72e?channelCode=hcdg</a></p>
<p>&nbsp;</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 18:34">2026-01-20 18:34</span>&nbsp;
<a href="https://www.cnblogs.com/huaweiyun">åä¸ºäºå¼åèèç</a>&nbsp;
éè¯»(<span id="post_view_count">150</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508288);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508288', targetLink: 'https://www.cnblogs.com/huaweiyun/p/19508288', title: 'åä¸ºäºåå¸CodeArts Doerä»£ç æºè½ä½ä¸ªäººçï¼ä¸é®å¼å¯ä½ çç¼ç èªå¨é©¾é©¶æ¨¡å¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ä¸ªå°æå·§è½»æ¾æåDashåºç¨debugæç ]]></title>
    <link>https://www.cnblogs.com/feffery/p/19513359</link>
    <guid>aa07d9423259730de983c7bc586a2fc4</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/feffery/p/19513359" title="åå¸äº 2026-01-21 17:53">
    <span role="heading" aria-level="2">ä¸ä¸ªå°æå·§è½»æ¾æåDashåºç¨debugæç</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<center style="font-size: 18px; font-weight: bold; padding-top: 40px">æ´å¤Dashåºç¨å¼åå¹²è´§ç¥è¯ãæ¡ä¾ï¼æ¬¢è¿å³æ³¨âç©è½¬Dashâå¾®ä¿¡å¬ä¼å·ð</center>
<p><img src="https://img2024.cnblogs.com/blog/1344061/202507/1344061-20250703190053776-1837084116.png" alt="image" loading="lazy"></p>
<h1 id="1-ç®ä»">1 ç®ä»</h1>
<p>å¤§å®¶å¥½ææ¯è´¹èå¸ã<code>Dash</code>ä½ä¸ºåºäº<code>Python</code>è¿è¡<em>å¨æ åºç¨å¼å</em>çæµè¡æ¡æ¶ï¼å·æå¼ºå¤§ç<em>å¯ä¼¸ç¼©æ§</em>ââè¿æå³çå¨åä¸å¥åºäº<strong>ç»ä»¶+åè°å½æ°</strong>çä»£ç ç»ç»æ¹å¼ä¸ï¼ä½¿ç¨<code>Dash</code>å¯ä»¥è½»æ¾è¦çä»å°åç®ååºç¨ï¼å°å¤§åå¤æåºç¨ï¼åç§å¤æç¨åº¦çåºç¨å¼åä»»å¡ãè¿ä¹æ¯<code>Dash</code>å¨ä¸çèå´åï¼è¢«ä¼å¤çå¤§å¬å¸ç¨äºæç»­å¼å<em>ä¼ä¸çº§</em>æ°æ®åºç¨çåå ä¹ä¸ã</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202509/1344061-20250910154430584-1965899431.png" width="50%"></center>
<p>èéçæå¼åç<code>Dash</code>åºç¨åè½æ¥çå¢é¿ï¼æä»¬åéè¦å­¦ä¹ å¦ä½å¨åºç¨å¼åè¿ç¨ä¸­ï¼æ´<strong>é«æåç¡®</strong>ç<em>è°è¯åºç¨åè½é»è¾</em>ï¼<em>å®ä½å¼å¸¸é®é¢æå¨</em>ã</p>
<p>ä»å¤©çæç« ä¸­ï¼æä»¬å°±æ¥ä¸èµ·å­¦ä¹ æ°çæ¬<code>Dash</code>ï¼&gt;=3.4.0çæ¬ï¼ä¸­å¢å çä¸äºåè½ç¹æ§ï¼å¸®å©æä»¬æ´ç²¾åå¿«éçå®ä½å¸¸è§åè°å½æ°å¼åé®é¢ã</p>
<h1 id="2-å¨åè°å¾ä¸­ç¨hiddenåhide_all_callbacksåæ°èç¦åè°å½æ°">2 å¨åè°å¾ä¸­ç¨hiddenåhide_all_callbacksåæ°èç¦åè°å½æ°</h1>
<p>è½ç¶æä¹åå¨<em>å¬ä¼å·</em>ã<em>ç©è½¬Dashç¥è¯æç</em>ç­å¹³å°åå¸çæç« åè¯¾ç¨ä¸­ï¼å¹¶æ²¡æä¸é¨åè¿ä»ç»ï¼ä½å¾å¤åå­¦åºè¯¥å¯¹ç±»ä¼¼ä¸é¢ççé¢æå°è±¡ï¼æä»¬å¨<code>Dash</code>åºç¨å¼åé¶æ®µï¼ä¸º<code>app.run()</code>è®¾ç½®<code>debug=True</code>å¼å¯<em>å¼åè°è¯æ¨¡å¼</em>åï¼éè¿ç¹å»å³ä¸è§å¼åæ¨¡å¼å·¥å·æ¡ä¸­ç<strong>Callbacks</strong>æé®ï¼å¯ä»¥å±å¼ä¸å¥å¯äº¤äºç<strong>æåå¾</strong>ï¼æä»¬å¯ä»¥å°å¶ç§°ä½<strong>åè°å¾</strong>ã</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260121175038215-1907019957.png"></center>
<p>é»è®¤æåµä¸ï¼å®è®°å½å¹¶åç°å½å<code>Dash</code>åºç¨ä¸­å¨é¨çåè°å½æ°ç¼æå³ç³»ï¼è¿å¯¹äº<strong>å°å</strong>ç<code>Dash</code>åºç¨å¾ç´è§æäºï¼å ä¸ºå¾ä¸­ç<em>èç¹</em>å<em>è¾¹</em>æ¯è¾å°ãä½æ¯å¯¹äºé¡µé¢ä¼å¤ãåè½é»è¾ä¼å¤çä¸­å¤§å<code>Dash</code>åºç¨æ¥è¯´ï¼å½ä½ æå¼åè°å¾æ¶ï¼çå°çå¯è½æ¯ä¸é¢è¿æ ·åºå¤§å¤æçæ¯è±¡ï¼</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260121175040979-568062826.png"></center>
<p>ðè¿ç§æåµä¸æä»¬å¤§æ¦çä¼å½åä»ä¹é½æ²¡çè§ï¼é»é»çå³é­åè°å¾é¢æ¿ããã</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260121175055369-1439370721.jpg"></center>
<p>é£ä¹ææ²¡æåæ³å¨è¿ä¸ª<em>åè°å¾</em>ä¸­é»è®¤<em>ä¸å±ç¤ºå¨é¨</em>ç<em>åè°å³ç³»</em>ï¼åªéå¯¹ç®åå³æ³¨çé¨ååè°å½æ°è¿è¡å±ç¤ºå¢ï¼</p>
<p>æçåå¼ï¼æçï¼é¦åæä»¬ç´æ¥å°<code>Dash</code>åçº§å°<code>&gt;=3.4.0</code>çæ¬ï¼</p>
<pre><code class="language-bash">pip install dash -U
</code></pre>
<p>ä»¥å®ç°âæ¼æ¥ä¸¤ä¸ªè¾å¥æ¡åå®¹âçç®ååºç¨åè½ä¸ºä¾ï¼</p>
<pre><code class="language-python">import dash
from dash import html
import feffery_antd_components as fac
from dash.dependencies import Input, Output
from feffery_dash_utils.style_utils import style

app = dash.Dash(__name__, suppress_callback_exceptions=True)

app.layout = html.Div(
    [
        fac.AntdSpace(
            [
                fac.AntdInput(id="input1", placeholder="è¯·è¾å¥åå®¹"),
                fac.AntdInput(id="input2", placeholder="è¯·è¾å¥åå®¹"),
                fac.AntdText(id="output-texxt"),
            ]
        )
    ],
    style=style(padding=50),
)

@app.callback(
    Output("output-text", "children"),
    Input("input1", "value"),
    Input("input2", "value"),
)
def combine_inputs(input1, input2):
    """æ¼æ¥è¾å¥çåå®¹"""
    return "æ¼æ¥ç»æï¼" + (input1 or "") + (input2 or "")

if __name__ == "__main__":
    app.run(debug=True)
</code></pre>
<p>å¨ä¸é¢çç¤ºä¾ä»£ç ä¸­ï¼æä»¬<strong>âä¸å°å¿â</strong>å°æç¨äº<em>æ¾ç¤ºæ¼æ¥åå®¹ç»æ</em>çç»ä»¶<code>id</code>åæ°åæäº<code>output-texxt</code>ð¤¯ï¼è¿ä¹æ¯æ¯è¾å¸¸è§çå¯¼è´åè°å½æ°ä¸çæçåå ä¹ä¸ï¼</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260121175057590-225038268.png"></center>
<p>è¿ç§æåµä¸ï¼å½æä»¬å¨æµè§å¨ä¸­åç°ç¸å³åè½æ²¡æå¦æè¿ä½æ¶ï¼</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260121175059670-668077126.gif"></center>
<p>å°±å¯ä»¥<strong>ä¼åèè</strong>éè¿<em>åè°å¾</em>æ¥çå¯¹åºåè°å½æ°çæ§è¡æåµï¼å¯ä»¥çå°è½ç¶æä»¬å¨ç¸å³è¾å¥æ¡éè¾å¥äºä¸äºåå®¹ï¼ä½å¯¹åºçåè°å½æ°ä¸æ¬¡é½æ²¡æ§è¡ï¼<code>count 0</code>ï¼ï¼</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260121175104165-1673715625.gif"></center>
<p>è¿ç§æåµä¸ï¼æä»¬<strong>é¦å</strong>å°±å¯ä»¥æ³å°æ¯ä¸æ¯å¯¹åºåè°å½æ°ä¸­æ<code>Output</code>è§è²ç<code>id</code>ï¼ä¸å¯¹åºç»ä»¶å®ä¹ç<code>id</code>åæ°ä¸ä¸æ ·ï¼ç»è¿ä¿®æ­£ï¼åè½æ­£ç¡®è¿ä½çæåµä¸ï¼å¨åè°å¾ç»æä¸­å°±å¯ä»¥çå°è¯¥åè°å½æ°<em>æ§è¡äºå¤å°æ¬¡</em>ã<em>æ§è¡èæ¶</em>ç­æç¨çä¿¡æ¯ï¼</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260121175106405-386111932.gif"></center>
<p>æ­¤æ¶ï¼æä»¬åèæ³å°ä¸æä¸­å±ç¤ºè¿çï¼å¯¹åºä¸­å¤§å<code>Dash</code>åºç¨ç<strong>éå¸¸åºæ</strong>çåè°å¾ï¼åå¦ä¸é¢è¿ä¸ªåè°å½æ°<code>debug</code>çåºæ¯åºç°å¨ç±»ä¼¼è§æ¨¡çåºç¨ä¸­ï¼æä»¬å°±å¯ä»¥åºäº<code>Dash&gt;=3.4.0</code>çæ¬ï¼é¦åå¨<code>app.run()</code>ä¸­è®¾ç½®<code>hide_all_callbacks=True</code>ï¼è¿å°å¨åè°å¾ä¸­å¼ºå¶éèææçåè°å½æ°ï¼</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260121175111240-318613727.png"></center>
<p>ç¶ååä¸ºå¯¹åºçåè°å½æ°<code>callback()</code>ä¸­è®¾ç½®<code>hidden=False</code>ï¼</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260121175113131-149325016.png"></center>
<p>è¿å°ä»¥<em>æ´é«çä¼åçº§</em>ï¼å¨åè°å¾ä¸­<strong>å¼ºå¶å±ç¤º</strong>å½ååè°å½æ°å³ç³»ï¼è¿æ ·æ è®ºæ¯åå¤æç<code>Dash</code>åºç¨ï¼æä»¬é½å¯ä»¥å¨<em>åè°å¾</em>ä¸­åª<strong>èç¦</strong>äºæä»¬å³æ³¨çé£äºåè°å½æ°ï¼å¤§å¹åº¦æååºç¨åè½è°è¯æçðï¼</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260121175114783-1832623334.png"></center>
<p>å¤§å®¶å¯ä»¥å¨æ¥å¸¸å¼å<code>Dash</code>åºç¨çè¿ç¨ä¸­ï¼å¤å¤å©ç¨ä»å¤©ä»ç»çæå·§ï¼å¼ååºæ´ç¨³å¥çåºç¨ðª~</p>
<hr>
<p>æ´å¤æå³<code>Dash</code>åºç¨å¼åçå¹²è´§åå®¹ï¼æ¬¢è¿æç»­å³æ³¨æä»¬â¤ï¸</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.001388888888888889" data-date-updated="2026-01-21 17:55">2026-01-21 17:53</span>&nbsp;
<a href="https://www.cnblogs.com/feffery">è´¹å¼é</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19513359);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19513359', targetLink: 'https://www.cnblogs.com/feffery/p/19513359', title: 'ä¸ä¸ªå°æå·§è½»æ¾æåDashåºç¨debugæç' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ PCI9x5xé©±å¨ç§»æ¤æ¯æPCI9054å¨win7ä¸ä½¿ç¨2 ]]></title>
    <link>https://www.cnblogs.com/haohaoganhuo/p/19513098</link>
    <guid>688a384c0f0b099e62f84d6aa15aa88b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/haohaoganhuo/p/19513098" title="åå¸äº 2026-01-21 17:17">
    <span role="heading" aria-level="2">PCI9x5xé©±å¨ç§»æ¤æ¯æPCI9054å¨win7ä¸ä½¿ç¨2</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ¥ä¸æï¼æ¬æç« ç»§ç»­è®°å½ä¸­æ³°èåçæ°æ®ééå¡é©±å¨ç¿»æ°è¿ç¨ã</p>
<h2 id="ä¸­æ­åå§åé¨åä»£ç ç§»æ¤">ä¸­æ­åå§åé¨åä»£ç ç§»æ¤</h2>
<p>åæPLX9x5xæºç å¯ç¥ï¼ä¸­æ­åå§åè°ç¨æµç¨å¦ä¸ï¼<br>
PLxEvtDeviceAdd-PLxInitializeDeviceExtension-PLxInterruptCreate<br>
å¶ä¸­å·ä½åå§åä»£ç å¨PLxInterruptCreateå½æ°ä¸­ï¼è¿é¨åæ¯çº¯æ¡æ¶æµç¨æ éä¿®æ¹ï¼ç´æ¥å°±å¯ä»¥ä½¿ç¨ï¼</p>
<pre><code class="language-c++">NTSTATUS
PLxInterruptCreate(
    IN PDEVICE_EXTENSION DevExt
    )
{
    ......
}
</code></pre>
<p>WdfInterruptCreateå½æ°å°åå»ºè®¾å¤ä¸­æ­å¯¹è±¡ï¼åç»­åä¸­æ­ç¸å³æä½é½è¦ç¨å°DevExt-&gt;Interruptã<br>
WdfInterruptCreateå½æ°æåè¿åä¹åï¼WDFæ¡æ¶ä¼å¨ç³»ç»å è½½è®¾å¤æ¶è¿æ¥ä¸­æ­ï¼è¿æ¥ä¸­æ­åè°ç¨PLxEvtInterruptEnableå½æ°ï¼ç³»ç»å¸è½½è®¾å¤æ¶è°ç¨PLxEvtInterruptDisableå½æ°åæ­å¼ä¸­æ­ã</p>
<p>ç¤ºä¾ç¨åºå·²ç»å¨PLxEvtInterruptEnableå½æ°ä¸­å¯¹ä¸­æ­å¯å­å¨è¿è¡äºä½¿è½æä½ï¼è¿ä¸ç¹PCI9054åPCI9656å¼å®¹ï¼æä»¥å»¶ç¨æ­¤ä»£ç å³å¯ï¼åæ¶éè¦å ä¸æ¬å°æ»çº¿çä¸­æ­ä½¿è½ã</p>
<pre><code class="language-c++">	intCSR.bits.LocalIntInputEnable = TRUE;
</code></pre>
<p>ç¤ºä¾ç¨åºå·²ç»å¨PLxEvtInterruptDisableå½æ°ä¸­å¯¹ä¸­æ­å¯å­å¨è¿è¡äºç¦æ­¢æä½ï¼è¿ä¸ç¹PCI9054åPCI9656å¼å®¹ï¼æä»¥å»¶ç¨æ­¤ä»£ç å³å¯ã</p>
<pre><code class="language-c++">	intCSR.bits.LocalIntInputEnable = FALSE;
</code></pre>
<p>å¯¹äºä¸­æ³°èåçèäº§åä¸ä½¿è½åç¦æ­¢ä¸­æ­æä½ï¼åæç®è½¬ç§»å°åºç¨å±è¿è¡ï¼è¿æ ·å¯ä»¥å¢å é©±å¨çééæ§ã</p>
<h2 id="ä¸­æ­äºä»¶ä»£ç é¨åç§»æ¤">ä¸­æ­äºä»¶ä»£ç é¨åç§»æ¤</h2>
<p>èé©±å¨å¨åºç¨å±åå»ºäºä»¶å¥æï¼ä¼ è¾ç»åæ ¸ï¼å¨å¯¹åºä¸­æ­åçæ¶è§¦åäºä»¶å¥æï¼ä»èç®ååºç¨å±ç¼ç¨ï¼æ°é©±å¨éè¦å®ç°è¿ä¸ªåè½ï¼</p>
<h3 id="1-å¬å±å®ä¹-publich">1. å¬å±å®ä¹ (Public.h)</h3>
<p>å¨ <code>Public.h</code> ä¸­å®ä¹ç¸å³ç IOCTL åå¸¸éï¼</p>
<pre><code class="language-c++">#define EVENT_COUNT                3L
#define EVENT_SFifo                0L
#define EVENT_ALARM                1L
#define EVENT_TRIP                 2L

#define PCI8KPLX_IOCTL_OPEN_IRQ CTL_CODE(FILE_DEVICE_UNKNOWN, 0x805, METHOD_BUFFERED, FILE_ANY_ACCESS)
#define PCI8KPLX_IOCTL_CLOSE_IRQ CTL_CODE(FILE_DEVICE_UNKNOWN, 0x806, METHOD_BUFFERED, FILE_ANY_ACCESS)
</code></pre>
<h3 id="2-è®¾å¤ä¸ä¸ææ©å±-privateh">2. è®¾å¤ä¸ä¸ææ©å± (Private.h)</h3>
<p>å¨ <code>DEVICE_EXTENSION</code> ç»æä½ä¸­æ·»å ç¨äºå­å¨åæ ¸äºä»¶å¯¹è±¡çæéæ°ç»ï¼</p>
<pre><code class="language-c++">typedef struct _DEVICE_EXTENSION {
    // ... ç°ææå ...
    
    //ç¨äºå­å¨åæ ¸äºä»¶å¯¹è±¡æé
    PKEVENT m_Events[EVENT_COUNT];
    
} DEVICE_EXTENSION, *PDEVICE_EXTENSION;
</code></pre>
<h3 id="3-ioctl-å¤çé»è¾-controlc">3. IOCTL å¤çé»è¾ (Control.c)</h3>
<p>å¨ <code>PLxEvtIoDeviceControl</code> ä¸­æ·»å å¯¹ <code>PCI8KPLX_IOCTL_OPEN_IRQ</code>å<code>PCI8KPLX_IOCTL_CLOSE_IRQ</code> çåå:</p>
<pre><code class="language-c++">/**
 * ä¸»è®¾å¤æ§å¶å¥å£ç¹
 */
VOID
PLxEvtIoDeviceControl(â¦â¦)
{
    â¦â¦

    switch (IoControlCode) {
        case PCI8KPLX_IOCTL_OPEN_IRQ:
            status = PCI8KPLX_IOCTL_OPEN_IRQ_Handler(Request, devExt);
            break;
        case PCI8KPLX_IOCTL_CLOSE_IRQ:
            status = PCI8KPLX_IOCTL_CLOSE_IRQ_Handler(Request, devExt);
            break;

        // ... å¶ä» case ...
        
        default:
            status = STATUS_INVALID_DEVICE_REQUEST;
            break;
    }

    WdfRequestComplete(Request, status);
}
</code></pre>
<p>å¹¶å®ç°å¤çå½æ°ï¼</p>
<pre><code class="language-c++">/**
 * åè½ï¼å°åºç¨å±ä¼ å¥ç ULONG å¥ææ°ç»è½¬æ¢ä¸ºåæ ¸ PKEVENT å¯¹è±¡æ°ç»
 * æ³¨æï¼æ­¤æ¹æ³ä½¿ç¨åºå®å¤§å°çæ°ç»ï¼éç¨äºäºä»¶ç±»ååæ°éåºå®çåºæ¯ã
 *      å¯¹ç¡¬ä»¶å¯å­å¨çæä½æ¾å¨åºç¨å±dllä¸­ã
 * å¼å®¹æ§ï¼ä½¿ç¨ (HANDLE)(ULONG_PTR)ulH ç¡®ä¿ 32 ä½åºç¨å¨ 64 ä½ç³»ç»ä¸çå¼å®¹æ§ã
 */
NTSTATUS
PCI8KPLX_IOCTL_OPEN_IRQ_Handler(
    _In_ WDFREQUEST Request,
    _In_ PDEVICE_EXTENSION DevExt
)
{
    NTSTATUS status = STATUS_SUCCESS;
    PULONG pBuff = NULL; // æåè¾å¥ç¼å²åºï¼å¶ä¸­åå« EVENT_COUNT ä¸ª ULONG å¥æ
    size_t bufferSize = 0;
    ULONG i;

    // 1. è·åè¾å¥ç¼å²åº (é¢æåå« EVENT_COUNT ä¸ª ULONG å¥æ)
    status = WdfRequestRetrieveInputBuffer(Request, sizeof(ULONG) * EVENT_COUNT, (PVOID*)&amp;pBuff, &amp;bufferSize);
    if (!NT_SUCCESS(status)) {
        return status;
    }

    // 2. éåå¹¶å¤çå¥æ
    for (i = 0; i &lt; EVENT_COUNT; i++) {
        ULONG ulH = pBuff[i];
        HANDLE h = (HANDLE)(ULONG_PTR)ulH; // å³é®è½¬æ¢ï¼ç¡®ä¿64ä½å¼å®¹æ§

        if (h != NULL) {
            // å¦æè¯¥ä½ç½®å·²å­å¨å¼ç¨çäºä»¶å¯¹è±¡ï¼åéæ¾æ§å¼ç¨
            if (DevExt-&gt;m_Events[i] != NULL) {
                ObDereferenceObject(DevExt-&gt;m_Events[i]);
                DevExt-&gt;m_Events[i] = NULL;
            }

            // å°ç¨æ·æå¥æè½¬æ¢ä¸ºåæ ¸äºä»¶å¯¹è±¡æé
            status = ObReferenceObjectByHandle(
                h,
                EVENT_MODIFY_STATE,
                *ExEventObjectType,
                UserMode,
                (PVOID*)&amp;DevExt-&gt;m_Events[i],
                NULL
            );

            if (!NT_SUCCESS(status)) {
                DevExt-&gt;m_Events[i] = NULL;
                break; // å¦ææä¸ªå¥æè½¬æ¢å¤±è´¥ï¼åæ­¢å¤çå¹¶è¿åéè¯¯
            }
        }
    }

    return status;
}

/**
 * äºä»¶å¥ææ¸çå½æ° (åºå®æ°ç»ç)
 * åè½ï¼éæ¾ m_Events æ°ç»ä¸­ææå­å¨çäºä»¶å¯¹è±¡å¼ç¨ï¼å¹¶å°æéç½®ä¸º NULLã
 * æ³¨æï¼æ­¤æä½ä¼æ¸é¤ææå·²æ³¨åçäºä»¶å¥æã
 */
NTSTATUS
PCI8KPLX_IOCTL_CLOSE_IRQ_Handler(
    _In_ WDFREQUEST Request,
    _In_ PDEVICE_EXTENSION DevExt
)
{
    NTSTATUS status = STATUS_SUCCESS;
    ULONG i;
    //æ¬å½æ°ä¸éè¦ååºç¨å±äº¤äºï¼æä»¥ç¨ä¸å°è¿ä¸ªåæ°
	UNREFERENCED_PARAMETER(Request);
    // ä¸ºäºä¿è¯æä½çåå­æ§ï¼å¯è½éè¦å¨æ­¤å¤æ·»å è®¾å¤çº§çéï¼å¦æ m_Events è®¿é®éè¦åæ­¥çè¯
    // WdfWaitLockAcquire(DevExt-&gt;SomeLock, NULL);

    // éå m_Events æ°ç»
    for (i = 0; i &lt; EVENT_COUNT; i++) {
        if (DevExt-&gt;m_Events[i] != NULL) {
            // éæ¾å¯¹è¯¥äºä»¶å¯¹è±¡çå¼ç¨ï¼é²æ­¢åå­æ³æ¼
            ObDereferenceObject(DevExt-&gt;m_Events[i]);
            // æ¸ç©ºæé
            DevExt-&gt;m_Events[i] = NULL;
        }
    }

    // WdfWaitLockRelease(DevExt-&gt;SomeLock);

    // æ­¤ IOCTL éå¸¸æ²¡æè¾åºæ°æ®ï¼ä¸éè¦è°ç¨ WdfRequestSetInformation
    // ç´æ¥è¿åæåç¶æ
    return status;
}
</code></pre>
<h3 id="4-æ¸çäºä»¶é²æ­¢åå­æ³æ¼">4. æ¸çäºä»¶é²æ­¢åå­æ³æ¼</h3>
<p>å¨ PlxCleanupDeviceExtension ä¸­è¿è¡æ¸ç</p>
<pre><code class="language-c++">VOID
PlxCleanupDeviceExtension(
    _In_ PDEVICE_EXTENSION DevExt
)
{
    ULONG i;

    // éåå¹¶éæ¾äºä»¶å¯¹è±¡
    for (i = 0; i &lt; EVENT_COUNT; i++) {
        if (DevExt-&gt;m_Events[i] != NULL) {
            ObDereferenceObject(DevExt-&gt;m_Events[i]);
            DevExt-&gt;m_Events[i] = NULL; // æ¸ç©ºæéæ¯ä¸ªå¥½ä¹ æ¯
        }
    }

    // ... å¶ä»æ¸çä»£ç  ...
}
</code></pre>
<h3 id="5-ä¸­æ­è§¦åé»è¾-isrdpcc-åè">5. ä¸­æ­è§¦åé»è¾ (IsrDpc.c åè)</h3>
<p>å¨ DPC (å¦ <code>PLxEvtInterruptDpc</code>) ä¸­ï¼æ ¹æ®ç¡¬ä»¶ç¶æè§¦åç¸åºçäºä»¶ï¼</p>
<pre><code class="language-c++">// ç¤ºä¾ï¼è§¦å SFIFO è§¦åå¼äºä»¶
if (DevExt-&gt;m_Events[EVENT_SFifo] != NULL) {
    KeSetEvent(DevExt-&gt;m_Events[EVENT_SFifo], IO_NO_INCREMENT, FALSE);
}
</code></pre>
<h2 id="5-æ³¨æäºé¡¹">5. æ³¨æäºé¡¹</h2>
<ol>
<li><strong>64ä½å¼å®¹æ§</strong>ï¼ä»£ç ä¸­ä½¿ç¨äº <code>(HANDLE)(ULONG_PTR)ulH</code>ï¼ç¡®ä¿äº 32 ä½åºç¨ç¨åºå¨ 64 ä½ç³»ç»ä¸è¿è¡æ¶çå¥æå¯¹é½ã</li>
<li><strong>èµæºéæ¾</strong>ï¼å¨é©±å¨å¸è½½æè®¾å¤æ¸çåè°ï¼å¦ <code>PlxEvtDeviceCleanup</code>ï¼ä¸­ï¼åºéå <code>m_Events</code> å¹¶å¯¹éç©ºåç´ è°ç¨ <code>ObDereferenceObject</code>ï¼ä»¥é²æ­¢åæ ¸åå­æ³æ¼ã</li>
<li><strong>åºå®å¤§å°éå¶</strong>ï¼æ­¤æ¹æ¡ä½¿ç¨åºå®å¤§å°çæ°ç» <code>m_Events[EVENT_COUNT]</code>ï¼å¦æåºç¨å±éè¦ç®¡ççäºä»¶æ°éè¶è¿ <code>EVENT_COUNT</code>ï¼åéè¦å¢å¤§è¯¥å¸¸éå¹¶éæ°ç¼è¯é©±å¨ååºç¨å±ã</li>
<li><strong>åºç¨å±å¼å®¹æ§</strong>ï¼æ­¤æ¹æ¡åå®åºç¨å±åéçæ¯ <code>ULONG</code> ç±»åçå¥ææ°ç»ãå®ä¸»è¦å¼å®¹åéæ­¤ç±»æ°ç»ç32ä½åºç¨ãå¦æ64ä½åºç¨ä¹åéç¸åç <code>ULONG</code> æ°ç»ï¼ä¾å¦ï¼åºç¨å±æªåºåä½æ°ï¼ï¼åå¶å¥æå¿é¡»æ¯ææç32ä½å¼å®¹å¼ï¼å¦WoW64å­ç³»ç»æä¾çå¥æï¼ã</li>
</ol>
<h2 id="åºç¨å±è¦åçåä¸­æ­ç¸å³çäºæ">åºç¨å±è¦åçåä¸­æ­ç¸å³çäºæ</h2>
<p>èé©±å¨ä¸­ä½¿ç¨åæ ¸åéæ¥ä¿å­ä¸äºæ°æ®ï¼ä¼å¢å é©±å¨å¤æåº¦ï¼æä»¥é½è½¬ç§»å°åºç¨å±ï¼åä¸­æ­æå³çææ§å¶å­ï¼åéï¼å æ­¤å¨dllä¸­å£°æå¨å±åé</p>
<pre><code class="language-c++">//æ¬æ¥æ¯åæ ¸ä¸­éè¦ä¿å­çåå®¹ï¼æ¹æåºç¨å±ä¿å­
ULONG g_ulCtrlWord[MAX_CARD_COUNT];
//ä¸ºäºåé¢æ¹ä¾¿éè¯»ä»£ç ï¼å°èµå¼åè¯»åé½å°è£æå½æ°
void SetCtrlWord(ULONG cardNo, ULONG ulCtrlWord) {
	if (cardNo &gt; MAX_CARD_COUNT)
		return;
	g_ulCtrlWord[cardNo] = ulCtrlWord;
}

ULONG GetCtrlWord(ULONG cardNo) {
	if (cardNo &gt; MAX_CARD_COUNT)
		return 0;
	return g_ulCtrlWord[cardNo];
}
</code></pre>
<p>èé©±å¨ä¸­æä¸ä¸ªInitIRQå½æ°ï¼åªæ¯æä½äºæ§å¶å­åéï¼æ°é©±å¨å°åæ ¸æä½ä¿®æ¹æåºç¨å±çåéæä½</p>
<pre><code class="language-c++">//æ¹åæ§å¶å­ä¸­çä¸­æ­ç¸å³ä½	
    unsigned long ulCtrlWord = GetCtrlWord(cardNO);
	ulCtrlWord = SET_ULONG_BITS( ulCtrlWord, IRQ_MASK, IRQ, irqSource );
    SetCtrlWord(cardNO, ulCtrlWord);
</code></pre>
<p>èé©±å¨ä¸­ä½¿ç¨OpenIRQå°ä¸­æ­ç¸å³äºä»¶ä¼ éå°åæ ¸ï¼åæ¶å¨åæ ¸ä¸­è®¾ç½®PCI9054çæ¬å°æ§å¶å­ä½¿è½FPGAä¸­æ­ãæ°é©±å¨ä¸­åæ ¸åªæ¯æ¥æ¶ä¸­æ­ç¸å³äºä»¶ï¼ç¶åå¨åºç¨å±ä½¿è½FPGAä¸­æ­ã</p>
<pre><code class="language-c++">//å¨DeviceIoControlä¹åå°æ§å¶å­åå¥ç¡¬ä»¶	
//ä½¿è½ä¹åè®¾ç½®å¥½çä¸­æ­
WRITED(cardNO, OFF_CTRLWORD, GetCtrlWord(cardNO));
</code></pre>
<p>æ¥ä¸æ¥è¦ç§»æ¤åºç¨å±è®¿é®ç¡¬ä»¶å¯å­å¨çä»£ç </p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-21 17:17">2026-01-21 17:17</span>&nbsp;
<a href="https://www.cnblogs.com/haohaoganhuo">èªç±çå¥½å¥½å¹²æ´»</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19513098);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19513098', targetLink: 'https://www.cnblogs.com/haohaoganhuo/p/19513098', title: 'PCI9x5xé©±å¨ç§»æ¤æ¯æPCI9054å¨win7ä¸ä½¿ç¨2' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ JavaScriptæµç¨æ§å¶ï¼ä»æ··ä¹±æ¡ä»¶å°ä¼ééåï¼ä¸æ¬¡è®²æ¸å¦ä½è®©ä»£ç å¬è¯ ]]></title>
    <link>https://www.cnblogs.com/ymtianyu/p/19511690</link>
    <guid>69eb17aa783c76327fa51c547ead1923</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ymtianyu/p/19511690" title="åå¸äº 2026-01-21 14:15">
    <span role="heading" aria-level="2">JavaScriptæµç¨æ§å¶ï¼ä»æ··ä¹±æ¡ä»¶å°ä¼ééåï¼ä¸æ¬¡è®²æ¸å¦ä½è®©ä»£ç å¬è¯</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        JavaScriptæµç¨æ§å¶æ¯ç¼ç¨çåºç³ï¼ä½é¢å¯¹æ¡ä»¶åæ¯ãå¤éå¾ªç¯åDOMæä½æ¶ï¼ä»£ç ææåå¾åé¿æ··ä¹±ãæ¬æå°ä»å®éå¼åçç¹åºåï¼ç¨çæ´»åæ¯å»åæ¸if/elseãforãwhileç­æ ¸å¿æ¦å¿µï¼å¹¶éè¿âè·åå¹¶éåææDOMåç´ ä¿®æ¹æ ·å¼âçç»å¸åºæ¯ï¼ææææ¼ç¤ºå¦ä½å°æ½è±¡è¯­æ³è½¬åä¸ºæ´æ´ãé«æçå®æä»£ç ï¼å¸®å©ä½ å»ºç«æ¸æ°å¯é çé»è¾æ§å¶æç»´ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>ä½ ææ²¡æåè¿é£ç§âæä¸æé®åï¼ä¸å <code style="color: rgba(186, 55, 42, 1)">if else</code>å¥ç<code style="color: rgba(186, 55, 42, 1)">for</code>å¾ªç¯ï¼æåèªå·±é½ç»æäºâçä»£ç ï¼ð¯</p>
<p>ä¸ä¸ªçå®çæ°æ®ï¼å¨reviewæ°æå¼åèçä»£ç æ¶ï¼è¶è¿70%çé»è¾éè¯¯åæ§è½é®é¢ï¼é½æºäº<span style="color: rgba(186, 55, 42, 1)"><strong>ä¸æ¸æ°æéè¯¯çæµç¨æ§å¶</strong></span>ãæ¯å¦ï¼æ¬æ³ç»é¡µé¢æææé®æ¢ä¸ªé¢è²ï¼å´å ä¸ºå¾ªç¯æ²¡åå¥½ï¼è¦ä¹æ¼äºå ä¸ªï¼è¦ä¹æµè§å¨å¡æ­»äºã</p>
<p>ä»å¤©ï¼å±ä»¬ä¸èæ·±å¥¥ççè®ºï¼å°±åèæåèå¤©ä¸æ ·ï¼ææè¿äºå¹´æ¸ç¬æ»ææ»ç»ç<span style="color: rgba(186, 55, 42, 1)"><strong>JSæµç¨æ§å¶å¿æ³</strong></span>å<span style="color: rgba(186, 55, 42, 1)"><strong>DOMéåçå®æå¥è·¯</strong></span>äº¤ç»ä½ ãå­¦å®ä½ å°±è½ååºæ´æ¸æ°ãæ´å¥å£®çä»£ç ã</p>
<h2>ð æ ¸å¿æè¦ï¼è¿ç¯æç« è½å¸®ä½ </h2>
<div>
<p>ð 1. å½»åºæææ¡ä»¶åæ¯ä¸å¾ªç¯çéç¨åºæ¯ï¼åå«éæ©å°é¾ã</p>
<p>ð 2. ææ¡éåDOMéåä¿®æ¹å±æ§çæ åå§¿å¿ä¸æ§è½çªé¨ã</p>
<p>ð 3. è¯å«æµç¨æ§å¶ä¸­çå¸¸è§âåâï¼å¹¶å­¦ä¼å¦ä½ä¼éå°ç»è¿å»ã</p>
</div>
<h2>ð ä¸»è¦åå®¹èç»</h2>
<div>
<p>ð¯ ä¸ãçç¹ï¼ä¸ºä»ä¹ä½ çä»£ç æ»æ¯âå¤±æ§âï¼</p>
<p>ð¯ äºãæ ¸å¿ï¼è®©é»è¾åæ¸æ°çâå¯¼èªä»ªâââæµç¨æ§å¶å¨è§£</p>
<p>ð¯ ä¸ãå®æï¼ç¨å¾ªç¯å¾æDOMï¼æ¹éä¿®æ¹åç´ å±æ§</p>
<p>ð¯ åãé¿åä¸ååï¼ååºæ´ä¸ä¸çä»£ç </p>
</div>
<h2>ä¸ãçç¹ï¼ä¸ºä»ä¹ä½ çä»£ç æ»æ¯âå¤±æ§âï¼</h2>
<p>æ³è±¡ä¸ä¸ªåºæ¯ï¼äº§åç»çè¦æ±ï¼âç¨æ·æ»å¨å°é¡µé¢åºé¨æ¶ï¼å¦æå·²ç»ç»å½ï¼å°±å è½½Aæ¨¡åæ°æ®ï¼å¦ææªç»å½ï¼å¼¹åºç»å½æ¡ï¼ä½å¦ææ¯VIPç¨æ·ï¼ä¸è®ºæ¯å¦ç»å½é½ç´æ¥å è½½AåBæ¨¡åâ¦â¦â</p>
<p>å¦æä½ ä¸æè¯å°å¼å§åä¸è¿ä¸²ç<code style="color: rgba(186, 55, 42, 1)">if...else if...else</code>ï¼é£ä¹æ­åï¼ä½ æ­£å¨å¶é ä¸é¢åä¸ºâ<strong style="color: rgba(186, 55, 42, 1)">é¢æ¡ä»£ç </strong>âçå®æ¶ç¸å¼¹ãè¿ç§ä»£ç ä¸ä»é¾è¯»ãé¾æ¹ï¼å ä¸ªæåä½ èªå·±é½çä¸æã</p>
<p><strong>é®é¢çæ ¸å¿</strong>å¨äºï¼æä»¬æ²¡æææµç¨æ§å¶è¯­å¥å½ä½â<strong>å¯¼èªä»ª</strong>âæ¥è§åé»è¾è·¯å¾ï¼èæ¯å½æäºâ<strong>è¡¥ä¸</strong>âåªééè¦è´´åªéã</p>
<h2>äºãæ ¸å¿ï¼è®©é»è¾åæ¸æ°çâå¯¼èªä»ªâââæµç¨æ§å¶å¨è§£</h2>
<p>æµç¨æ§å¶æ éä¸¤ä»¶äºï¼<strong style="color: rgba(186, 55, 42, 1)">æ ¹æ®ä¸åæåµèµ°ä¸åçè·¯ï¼åæ¯ï¼</strong>ï¼å<strong style="color: rgba(186, 55, 42, 1)">éå¤åä¸äºäºæç´å°æ»¡è¶³æ¡ä»¶ï¼å¾ªç¯ï¼</strong>ã</p>
<h3>ð æ¡ä»¶åæ¯ï¼ä½ çä»£ç å³ç­å±</h3>
<div>
<p>- <code style="color: rgba(186, 55, 42, 1)">if</code>ï¼ âå¦æ...å°±...âï¼åè½¦éï¼</p>
<pre class="language-javascript highlighter-hljs"><code>if (isRaining) {
    takeUmbrella();
}</code></pre>
<p>- <code style="color: rgba(186, 55, 42, 1)">if...else</code>ï¼âå¦æ...å°±...å¦å...âï¼å²è·¯å£äºéä¸ï¼</p>
<pre class="language-javascript highlighter-hljs"><code>if (score &gt;= 60) {
    console.log("åæ ¼");
} else {
    console.log("ä¸åæ ¼");
}</code></pre>
<p>- <code style="color: rgba(186, 55, 42, 1)">else if</code>ï¼âå¦æ...å°±...æèå¦æ...å°±...å¦å...âï¼å¤å²è·¯å£ï¼</p>
<pre class="language-javascript highlighter-hljs"><code>if (hour &lt; 12) {
    console.log("ä¸åå¥½");
} else if (hour &lt; 18) {
    console.log("ä¸åå¥½");
} else {
    console.log("æä¸å¥½");
}</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">å³é®è­¦å</strong>ï¼å½åæ¯è¶è¿3å±ï¼å°±è¯¥èèç¨<code style="color: rgba(186, 55, 42, 1)">switch</code>è¯­å¥æâç­ç¥æ¨¡å¼âéæäºï¼ä¿æä»£ç æå¹³ã</p>
</div>
<h3>ð å¾ªç¯ï¼ä¸ç¥ç²å¦çéå¤å³å¨è</h3>
<p>å¾ªç¯çå³é®æ¯<strong>ç¥éèµ·ç¹ãç»ç¹åæ­¥é¿</strong>ã</p>
<div>
<p>1. <code style="color: rgba(186, 55, 42, 1)">for</code>å¾ªç¯ï¼<strong>å½ä½ ç¥éè¦å¾ªç¯å¤å°æ¬¡æ¶</strong>ï¼æ¯å¦éåæ°ç»ã</p>
<pre class="language-javascript highlighter-hljs"><code>for (let i = 0; i &lt; 5; i++) {
    console.log('è¿æ¯ç¬¬ ${i} æ¬¡å¾ªç¯');
}
// ç»æï¼åå§åï¼æ¡ä»¶ï¼å¢é</code></pre>
<p>2. <code style="color: rgba(186, 55, 42, 1)">while</code>å¾ªç¯ï¼<strong>å½ä½ ä¸ç¡®å®æ¬¡æ°ï¼ä½ç¥éæ»¡è¶³æä¸ªæ¡ä»¶å°±è¦ç»§ç»­æ¶</strong>ã</p>
<pre class="language-javascript highlighter-hljs"><code>let stack = [1, 2, 3];
while (stack.length &gt; 0) { // åªè¦æ ä¸ä¸ºç©ºå°±ç»§ç»­
    console.log(stack.pop());
}</code></pre>
<p>3. <code style="color: rgba(186, 55, 42, 1)">for...of</code> (ç¨äºæ°ç»ç­å¯è¿­ä»£å¯¹è±¡) å <code style="color: rgba(186, 55, 42, 1)">for...in</code> (ç¨äºå¯¹è±¡å±æ§)ï¼<strong>è®©ä½ æè±ç´¢å¼ï¼ç´æ¥æ¿å°å¼</strong>ã</p>
<pre class="language-javascript highlighter-hljs"><code>// for...of éåæ°ç»å¼
let colors = ['red', 'green', 'blue'];
for (let color of colors) {
    console.log(color); // ç´æ¥è¾åº 'red', 'green', 'blue'
}

// for...in éåå¯¹è±¡é®å
let obj = {a: 1, b: 2};
for (let key in obj) {
    console.log(key, obj[key]); // è¾åº 'a' 1, 'b' 2
}</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">éè¦åºå«</strong>ï¼éåæ°ç»ï¼99%çæåµç¨<code style="color: rgba(186, 55, 42, 1)">for...of</code>æ<code style="color: rgba(186, 55, 42, 1)">forEach</code>æ¹æ³æ´å¥½ã<code style="color: rgba(186, 55, 42, 1)">for...in</code>æ¯ä¸ºå¯¹è±¡è®¾è®¡çï¼éåæ°ç»å¯è½ä¼å¸¦æ¥æå¤ç»æã</p>
</div>
<h3>â¸ï¸ å¾ªç¯æ§å¶ï¼breakãcontinue ä¸ return</h3>
<div>
<p>- <code style="color: rgba(186, 55, 42, 1)">break</code>ï¼åâç´§æ¥åæ­¢âæé®ï¼<strong>ç«å³è·³åºæ´ä¸ªå¾ªç¯</strong>ã</p>
<p>- <code style="color: rgba(186, 55, 42, 1)">continue</code>ï¼åâè·³è¿è¿ä¸æ²âï¼<strong>è·³è¿å½åè½®æ¬¡ï¼ç´æ¥è¿å¥ä¸ä¸è½®å¾ªç¯</strong>ã</p>
<p>- <code style="color: rgba(186, 55, 42, 1)">return</code>ï¼å¨å½æ°éç¨ï¼<strong>ç´æ¥ç»æå½æ°ï¼å¾ªç¯èªç¶ä¹åäº</strong>ã</p>
<pre class="highlighter-hljs" style="background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px; overflow-x: auto"><code>for (let i = 0; i &lt; 10; i++) {
    if (i === 3) continue; // è·³è¿i=3è¿æ¬¡
    if (i === 7) break;    // i=7æ¶å½»åºç»æ­¢å¾ªç¯
    console.log(i); // è¾åº: 0, 1, 2, 4, 5, 6
}</code></pre>
</div>
<h2>ä¸ãå®æï¼ç¨å¾ªç¯å¾æDOMï¼æ¹éä¿®æ¹åç´ å±æ§</h2>
<p>çè®ºè¯´ä¸åéä¸ä¸ï¼ä¸å¦ä¸è¡ä»£ç ãåç«¯æå¸¸è§çå¾ªç¯åºæ¯ä¹ä¸ï¼<strong>è·åä¸å DOMåç´ ï¼ç¶åå¯¹å®ä»¬åç¹ä»ä¹äº</strong>ã</p>
<p><strong>åºæ¯</strong>ï¼æé¡µé¢ä¸ææç±»åä¸º<span style="color: rgba(186, 55, 42, 1)"><code>.old-style</code></span>çæ®µè½æå­æ¹æç°è²ï¼å¹¶å ä¸å é¤çº¿ã</p>
<pre class="highlighter-hljs" style="background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px; overflow-x: auto"><code>// 1. è·ååç´ éåï¼è¿æ¯ä¸ä¸ªHTMLCollectionï¼ç±»ä¼¼æ°ç»ï¼
const oldParagraphs = document.getElementsByClassName('old-style');

// 2. éåå¹¶ä¿®æ¹ï¼ç»å¸forå¾ªç¯ï¼
for (let i = 0; i &lt; oldParagraphs.length; i++) {
    oldParagraphs[i].style.color = '#999';
    oldParagraphs[i].style.textDecoration = 'line-through';
}

// 3. æ´ç°ä»£çåæ³ï¼å°éåè½¬ä¸ºçæ°ç»åä½¿ç¨forEachï¼
// Array.from(oldParagraphs).forEach(p =&gt; {
//   p.style.color = '#999';
//   p.style.textDecoration = 'line-through';
// });

// 4. æèç´æ¥ç¨for...ofï¼æ¨èï¼ï¼
// for (let p of oldParagraphs) {
//   p.style.color = '#999';
//   p.style.textDecoration = 'line-through';
// }</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">ä¸ºä»ä¹æ¨èfor...ofï¼</strong> ç®æ´ï¼ä¸æåºéï¼æ²¡æç´¢å¼<span style="color: rgba(186, 55, 42, 1)"><code>i</code></span>è¶çé®é¢ï¼ï¼ä¸è½å¾å¥½å°å¤çåç§éåï¼HTMLCollection, NodeListç­ï¼ã</p>
<h2>åãé¿åä¸ååï¼ååºæ´ä¸ä¸çä»£ç </h2>
<div>
<p><strong>ð³ï¸ å¸¸è§åç¹ï¼</strong></p>
<div>
<p>1. <strong>å¾ªç¯ä¸­ä¿®æ¹æ°ç»é¿åº¦</strong>ï¼å¨<code style="color: rgba(186, 55, 42, 1)">for</code>å¾ªç¯éå¢å æ°ç»åç´ ï¼ä¼å¯¼è´ç´¢å¼éä¹±ãè§£å³æ¹æ¡ï¼å¯ä»¥<strong>ä»åå¾åå¾ªç¯</strong>ï¼æåæ¶éè¦æä½çåç´ ã</p>
<p>2. <strong>è¯¯ç¨<code style="color: rgba(186, 55, 42, 1)">for...in</code>éåæ°ç»</strong>ï¼å®å¯è½ä¼éåå°æ°ç»çèªå®ä¹å±æ§æååé¾ä¸çæ¹æ³ãç¢è®°ï¼<strong>éåæ°ç»ï¼ç¨<code style="color: rgba(186, 55, 42, 1)">for...of</code>æ<code style="color: rgba(186, 55, 42, 1)">forEach</code></strong>ã</p>
<p>3. <strong>æ éå¾ªç¯</strong>ï¼<code style="color: rgba(186, 55, 42, 1)">while</code>å¾ªç¯æ¡ä»¶æ°¸è¿ä¸ºçï¼æè<code style="color: rgba(186, 55, 42, 1)">for</code>å¾ªç¯å¿äºåå¢éï¼æµè§å¨ä¼å¡æ­»ãå¡å¿æ£æ¥å¾ªç¯ç»æ­¢æ¡ä»¶ï¼</p>
</div>
<p><strong>ð è¿é¶æèï¼</strong></p>
<div>
<p>1. <strong>æ¡ä»¶åæ¯ä¼å</strong>ï¼å¤ç¨ä¸åè¡¨è¾¾å¼<span style="color: rgba(186, 55, 42, 1)"><code>? :</code></span>å¤çç®åé»è¾ï¼ç¨<code style="color: rgba(186, 55, 42, 1)">switch</code>æå¯¹è±¡æ å°(<span style="color: rgba(186, 55, 42, 1)"><code>{key: function}</code></span>)æ¿ä»£å¤æç<code style="color: rgba(186, 55, 42, 1)">if-else</code>é¾ã</p>
<p>2. <strong>å¾ªç¯çæ§è½</strong>ï¼å¨è¶å¤§è§æ¨¡æ°æ®éåæ¶ï¼ç»å¸ç<code style="color: rgba(186, 55, 42, 1)">for</code>å¾ªç¯ï¼æ­£åºæååºï¼éå¸¸æ§è½æä¼ãä½å¯¹äºæ¥å¸¸çDOMæä½ï¼æ§è½å·®å¼å¾®ä¹å¶å¾®ï¼<strong>ä»£ç å¯è¯»æ§ä¼å</strong>ã</p>
<p>3. <strong>å½æ°å¼ç¼ç¨æç»´</strong>ï¼æ°ç»ç<code style="color: rgba(186, 55, 42, 1)">forEach</code>ã<code style="color: rgba(186, 55, 42, 1)">map</code>ã<code style="color: rgba(186, 55, 42, 1)">filter</code>ç­æ¹æ³ï¼è½è®©éååè½¬æ¢æ°æ®çæå¾æ´æç¡®ï¼åå°å¯ä½ç¨ã</p>
</div>
</div>
<h2>ð æåæ»ç»</h2>
<p>æµç¨æ§å¶ä¸æ¯æ­»è®°ç¡¬èçè¯­æ³ï¼èæ¯ä¸ç§<strong style="color: rgba(186, 55, 42, 1)">è§åä»£ç æ§è¡è·¯å¾çæç»´</strong>ãé¢å¯¹å¤æé»è¾æ¶ï¼å<strong>çæ¸èç»</strong>ï¼åéæ©åéçâå¯¼èªä»ªâï¼åæ¯æå¾ªç¯ï¼ãå¨DOMæä½ç­æ¥å¸¸ä»»å¡ä¸­ï¼<code style="color: rgba(186, 55, 42, 1)">for...of</code>å<code style="color: rgba(186, 55, 42, 1)">forEach</code>æ¯ä½ çå¥½å¸®æã</p>
<p>è®°ä½ï¼æå¥½çä»£ç ä¸æ¯æèªæçï¼èæ¯<strong style="color: rgba(186, 55, 42, 1)">æå®¹æè¢«ä¸ä¸ä¸ªå¼åèï¼åæ¬å­ä¸ªæåçä½ ï¼çè§£çä»£ç </strong>ã</p>
<hr style="border: none; height: 1px; background: linear-gradient(90deg, rgba(0, 0, 0, 0), rgba(52, 152, 219, 1), rgba(0, 0, 0, 0)); margin: 40px 0">
<p style="text-align: center">---<strong>åå¨æå</strong>---<br>å¸æè¿ä»½æ»ç»è½å¸®ä½ é¿å¼ä¸äºåãå¦æè§å¾æç¨ï¼ä¸å¦¨ç¹ä¸ª èµð æ æ¶èâ­ æ è®°ä¸ä¸ï¼æ¹ä¾¿éæ¶åé¡¾ãä¹æ¬¢è¿å³æ³¨æï¼åç»­ä¸ºä½ å¸¦æ¥æ´å¤ç±»ä¼¼çå®æè§£æãæä»»ä½çé®ææ³æ³ï¼æä»¬è¯è®ºåºè§ï¼ä¸èµ·äº¤æµå¼åä¸­çåç§å¿å¾ä¸é®é¢ã</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-21 14:16">2026-01-21 14:15</span>&nbsp;
<a href="https://www.cnblogs.com/ymtianyu">ä¸åç¨åºåªå</a>&nbsp;
éè¯»(<span id="post_view_count">127</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19511690);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19511690', targetLink: 'https://www.cnblogs.com/ymtianyu/p/19511690', title: 'JavaScriptæµç¨æ§å¶ï¼ä»æ··ä¹±æ¡ä»¶å°ä¼ééåï¼ä¸æ¬¡è®²æ¸å¦ä½è®©ä»£ç å¬è¯' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>