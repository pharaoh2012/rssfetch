<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-03T16:46:10.353Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ ä½¿ç¨ NanUI å¿«éåå»ºå·æç°ä»£ç¨æ·çé¢ç WinForm åºç¨ç¨åº ]]></title>
    <link>https://www.cnblogs.com/Can-daydayup/p/19571766</link>
    <guid>0c07c58b12a7a66aa218bbbd4979686d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Can-daydayup/p/19571766" title="åå¸äº 2026-02-03 22:52">
    <span role="heading" aria-level="2">ä½¿ç¨ NanUI å¿«éåå»ºå·æç°ä»£ç¨æ·çé¢ç WinForm åºç¨ç¨åº</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h2 data-tool="mdniceç¼è¾å¨"><span class="content">åè¨</span></h2>
<p data-tool="mdniceç¼è¾å¨">ä»å¤©å¤§å§ç»å¤§å®¶åäº«ä¸ä¸ªå¼ºå¤§ç .NET å¼æºæ¡æ¶ï¼å®å©ç¨ Web ææ¯ï¼HTML5ãCSS3ãJavaScriptï¼ä¸º WinForm åºç¨ç¨åºæå»ºç°ä»£åçç¨æ·çé¢ï¼NanUIã</p>
<p data-tool="mdniceç¼è¾å¨">å¦æä½ æ­£å¨å¯»æ¾ä¸ä¸ªç¨äºåå»ºå·æç°ä»£ç¨æ·çé¢ç WinForm åºç¨ç¨åºçæ¡æ¶ï¼NanUI æ¯ä¸ä¸ªä¸éçéæ©ã</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="content">é¡¹ç®ä»ç»</span></h2>
<p data-tool="mdniceç¼è¾å¨">NanUI æ¯ä¸ä¸ªåºäº .NET å¹³å°çå¼æºï¼MIT Licenseï¼æ¡æ¶ï¼æ¨å¨å¸®å©å¼åèä½¿ç¨ HTML5ãCSS3 å JavaScript æå»ºå·æç°ä»£æç WinForm åºç¨ç¨åºç¨æ·çé¢ãå®åºå±ä¾æäº Xilium.CefGlue è¿æ¯ Chromium Embedded Frameworkï¼CEFï¼å¨ .NET ç¯å¢ä¸çå®æ¹ç»å®å®ç°ï¼éè¿åµå¥å®æ´ç Chromium æ¸²æå¼æï¼ä½¿ WinForm åºç¨è½å¤åç° Web ææ¯é©±å¨çå¯äº¤äºçé¢ã</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="content">åºæ¬åç</span></h2>
<p data-tool="mdniceç¼è¾å¨"><strong>å®æ¹ä»ç»ï¼</strong></p>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202602/1336199-20260203224945896-1709690796.png" alt="image" loading="lazy"></p>
<p data-tool="mdniceç¼è¾å¨"><strong>åºæ¬åçæ¦æ¬ï¼</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>Chromium Embedded Framework (CEF)</strong>&nbsp;æ¯ä¸ä¸ªå¼æºé¡¹ç®ï¼ä¸ä¸ªç¨äºå°åºäº Chromium çæµè§å¨åµå¥å¶ä»åºç¨ç¨åºçç®åæ¡æ¶ã</li>
<li>å®æä¾ç¨³å®ç C/C++ APIï¼æ¯æå¤è¿ç¨æ¶æï¼Browser è¿ç¨ + Renderer/GPU ç­å­è¿ç¨ï¼ï¼å·å¤å®æ´ç HTML5 æ¸²æãJavaScript æ§è¡ãç½ç»è¯·æ±ãå®å¨æ²ç®±ç­è½åã</li>
<li>NanUI å¹¶æªç´æ¥è°ç¨ CEF ç C æ¥å£ï¼èæ¯åºäº&nbsp;<strong>Xilium.CefGlue</strong>&nbsp;è¿æ¯ä¸ä¸ªé«è´¨éç .NET å°è£åºï¼å° CEF ç C++ API è½¬æ¢ä¸º C# å¯è°ç¨çæç®¡æ¥å£ã</li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span class="content">ç¯å¢è¦æ±</span></h2>
<h3 data-tool="mdniceç¼è¾å¨"><span class="content">å¼åç¯å¢</span></h3>
<ul data-tool="mdniceç¼è¾å¨">
<li>Visual Studio 2019 ææ´é«çæ¬ã</li>
<li>NET Framework 4.6.2 ææ´é«çæ¬ / .NET 6.0 ææ´é«çæ¬ã</li>
</ul>
<h3 data-tool="mdniceç¼è¾å¨"><span class="content">é¨ç½²ç¯å¢</span></h3>
<ul data-tool="mdniceç¼è¾å¨">
<li>.NET Framework 4.6.2 ææ´é«çæ¬ã</li>
<li>.NET 6.0 éè¦ Windows 7 Service Pack 1 ææ´é«çæ¬ã</li>
<li>.NET 7.0/8.0/9.0 éè¦ Windows 10 æ Windows 11ã</li>
<li>Microsoft Windows 7 Service Pack 1 ææ´é«çæ¬ã</li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span class="content">é¡¹ç®æºä»£ç </span></h2>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202602/1336199-20260203225000339-222340467.png" alt="image" loading="lazy"></p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="content">å¿«éä½¿ç¨</span></h2>
<h3 data-tool="mdniceç¼è¾å¨"><span class="content">åå»ºä¸ä¸ª WinForm åºç¨ç¨åº</span></h3>
<p data-tool="mdniceç¼è¾å¨">é¦åæä»¬å¿«éåå»ºä¸ä¸ªåä¸º<code>NanUIExercise</code>&nbsp;Windows çªä½åºç¨ç¨åºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202602/1336199-20260203225039530-1668443758.png" alt="image" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202602/1336199-20260203225044905-2091682107.png" alt="image" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202602/1336199-20260203225051053-201638939.png" alt="image" width="1075" height="458" loading="lazy"></p>
<h3 data-tool="mdniceç¼è¾å¨"><span class="content">å®è£ NanUI NuGet å</span></h3>
<p data-tool="mdniceç¼è¾å¨">å®è£&nbsp;<code>NanUI</code>&nbsp;å&nbsp;<code>NetDimension.NanUI</code>&nbsp;ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202602/1336199-20260203225112224-661517538.png" alt="image" width="1100" height="607" loading="lazy"></p>
<p>&nbsp;å®è£&nbsp;<code>NanUI</code>&nbsp;æä¾èµç&nbsp;<code>Chromium Embedded Framework</code>&nbsp;ä¾èµå&nbsp;<code>NetDimension.NanUI.Runtime</code>ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202602/1336199-20260203225122223-56769435.png" alt="image" width="1103" height="607" loading="lazy"></p>
<p>&nbsp;</p>
<h3 data-tool="mdniceç¼è¾å¨"><span class="content">åå»ºä¸ä¸ªåºæ¬ç NanUI åºç¨ç¨åº</span></h3>
<p data-tool="mdniceç¼è¾å¨"><strong>Program.csï¼</strong></p>
<pre class="custom" data-tool="mdniceç¼è¾å¨"><code class="hljs"><span class="hljs-keyword">using&nbsp;NetDimension.NanUI;<br><br><span class="hljs-keyword">namespace&nbsp;<span class="hljs-title">NanUIExercise<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">internal&nbsp;<span class="hljs-keyword">static&nbsp;<span class="hljs-keyword">class&nbsp;<span class="hljs-title">Program<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"><span class="hljs-doctag">///&nbsp;<span class="hljs-doctag">&lt;summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"><span class="hljs-doctag">///&nbsp;&nbsp;The&nbsp;main&nbsp;entry&nbsp;point&nbsp;for&nbsp;the&nbsp;application.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"><span class="hljs-doctag">///&nbsp;<span class="hljs-doctag">&lt;/summary&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="hljs-meta">STAThread]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">static&nbsp;<span class="hljs-keyword">void&nbsp;<span class="hljs-title">Main(<span class="hljs-params">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">var&nbsp;builder&nbsp;=&nbsp;NanUIApp.CreateBuilder();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;builder.UseNanUIApp&lt;MyFirstAPP&gt;();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">var&nbsp;app&nbsp;=&nbsp;builder.Build();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.Run();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre>
<p data-tool="mdniceç¼è¾å¨"><strong>åå»ºä¸ä¸ªç±»ç»§æ¿ AppStartup æ¥éç½®åºç¨ç¨åºï¼</strong></p>
<pre class="custom" data-tool="mdniceç¼è¾å¨"><code class="hljs">using&nbsp;Microsoft.Extensions.DependencyInjection;<br>using&nbsp;NetDimension.NanUI;<br><br>namespace&nbsp;NanUIExercise<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;MyFirstAPP&nbsp;:&nbsp;AppStartup<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;override&nbsp;MainWindowCreationAction?&nbsp;UseMainWindow(MainWindowOptions&nbsp;opts)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;è®¾ç½®åºç¨ç¨åºçä¸»çªä½<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">return&nbsp;opts.UseMainFormium&lt;MyWindow&gt;();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;override&nbsp;void&nbsp;ProgramMain(string[]&nbsp;args)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Mainå½æ°ä¸­çä»£ç åºè¯¥å¨è¿éï¼è¯¥å½æ°åªå¨ä¸»è¿ç¨ä¸­è¿è¡ãè¿æ ·å¯ä»¥é²æ­¢å­è¿ç¨è¿è¡ä¸äºä¸æ­£ç¡®çåå§åä»£ç ã<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ApplicationConfiguration.Initialize();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;override&nbsp;void&nbsp;ConfigurationChromiumEmbedded(ChromiumEnvironmentBuiler&nbsp;cef)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;å¨æ­¤å¤éç½®&nbsp;Chromium&nbsp;Embedded&nbsp;Framwork<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;override&nbsp;void&nbsp;ConfigureServices(IServiceCollection&nbsp;services)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;å¨è¿ééç½®è¯¥åºç¨ç¨åºçæå¡<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br></span></code></pre>
<p data-tool="mdniceç¼è¾å¨"><strong>åå»ºä¸ä¸ªç±»å®ç° Formiumï¼ç¨äºéç½®åºç¨ç¨åºçä¸»çªå£ï¼</strong></p>
<pre class="custom" data-tool="mdniceç¼è¾å¨"><code class="hljs">using&nbsp;NetDimension.NanUI;<br>using&nbsp;NetDimension.NanUI.Forms;<br><br>namespace&nbsp;NanUIExercise<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;MyWindow&nbsp;:&nbsp;Formium<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;<span class="hljs-function"><span class="hljs-title">MyWindow()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Url&nbsp;=&nbsp;<span class="hljs-string">"https://juejin.cn/";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;override&nbsp;FormStyle&nbsp;ConfigureWindowStyle(WindowStyleBuilder&nbsp;builder)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æ­¤å¤éç½®çªå£çæ ·å¼åå±æ§ï¼æçç©ºä»¥ä½¿ç¨é»è®¤æ ·å¼<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;style&nbsp;=&nbsp;builder.UseSystemForm();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;style.TitleBar&nbsp;=&nbsp;<span class="hljs-literal">false;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;style.DefaultAppTitle&nbsp;=&nbsp;<span class="hljs-string">"My&nbsp;First&nbsp;NanUI&nbsp;App";<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">return&nbsp;style;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></span></span></span></span></span></span></code></pre>
<p data-tool="mdniceç¼è¾å¨"><strong>è¿è¡æææ¥çï¼</strong></p>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202602/1336199-20260203225205762-1526989538.png" alt="image" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202602/1336199-20260203225210743-1010420250.png" alt="image" loading="lazy"></p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="content">é¡¹ç®æºç å°å</span></h2>
<p data-tool="mdniceç¼è¾å¨">æ´å¤é¡¹ç®å®ç¨åè½åç¹æ§æ¬¢è¿åå¾é¡¹ç®å¼æºå°åæ¥çðï¼å«å¿äºç»é¡¹ç®ä¸ä¸ªStaræ¯æðã</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>Giteeå¼æºå°åï¼</strong>&nbsp;<a href="https://gitee.com/dotnetchina/NanUI" rel="noopener nofollow">https://gitee.com/dotnetchina/NanUI</a></li>
<li><strong>é¡¹ç®ææ¡£å°åï¼</strong>&nbsp;<a href="https://gitee.com/dotnetchina/NanUI/blob/master/docs/README.md" rel="noopener nofollow">https://gitee.com/dotnetchina/NanUI/blob/master/docs/README.md</a></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span class="content">ä¼ç§é¡¹ç®åæ¡æ¶ç²¾é</span></h2>
<p data-tool="mdniceç¼è¾å¨">è¯¥é¡¹ç®å·²æ¶å½å°C#/.NET/.NET Coreä¼ç§é¡¹ç®åæ¡æ¶ç²¾éä¸­ï¼å³æ³¨ä¼ç§é¡¹ç®åæ¡æ¶ç²¾éè½è®©ä½ åæ¶äºè§£C#ã.NETå.NET Coreé¢åçææ°å¨æåæä½³å®è·µï¼æé«å¼åå·¥ä½æçåè´¨éãåå·²æï¼æ¬¢è¿å¤§å®¶è¸è·æäº¤PRæ¨èæèªèï¼<strong>è®©ä¼ç§çé¡¹ç®åæ¡æ¶ä¸è¢«åæ²¡ð¤</strong>ï¼ã</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>GitHubå¼æºå°åï¼</strong>&nbsp;<a href="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" rel="noopener nofollow">https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md</a></li>
<li><strong>Giteeå¼æºå°åï¼</strong>&nbsp;<a href="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" rel="noopener nofollow">https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md</a></li>
</ul>

</div>
<div id="MySignature" role="contentinfo">
    <blockquote>
<p style="font-family:YouYuan;font-size: 16px;margin: 0 auto 0.01em auto;"><span style="font-size: 17px; ">ä½èåç§°ï¼</span><a href="https://www.cnblogs.com/Can-daydayup/" target="_blank">è¿½éæ¶åè</a></p>
<p style="font-family:YouYuan;font-size: 16px;margin: 0 auto 0.01em auto;"><span style="font-size: 17px; ">ä½èç®ä»ï¼</span>ä¸ä¸ªç­ç±ç¼ç¨ãåäºåäº«ãåæ¬¢å­¦ä¹ ãæ¢ç´¢ãå°è¯æ°äºç©åæ°ææ¯çå¨æ è½¯ä»¶å·¥ç¨å¸ã</p>
<p style="font-family:YouYuan;font-size: 16px;margin: 0 auto 0.01em auto;">
æ¬æçæå½ä½èååå®¢å­å±æï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»ä¿çæ­¤æ®µå£°æï¼ä¸å¨æç« é¡µé¢ææ¾ä½ç½®ç»åºåæé¾æ¥ï¼å¦åä¿çè¿½ç©¶æ³å¾è´£ä»»çæå©ãå¦æè¯¥ç¯æç« å¯¹æ¨æå¸®å©çè¯ï¼å¯ä»¥ç¹ä¸ä¸å³ä¸è§ç<a onclick="votePost(cb_entryId,'Digg')" href="javascript:void(0)" style="color:red;">ãâ¥æ¨èâ¥ã</a>ï¼å¸æè½å¤æç»­çä¸ºå¤§å®¶å¸¦æ¥å¥½çææ¯æç« ï¼æä¸­å¯è½å­å¨æè¿°ä¸æ­£ç¡®çå°æ¹ï¼æ¬¢è¿ææ­£æè¡¥åï¼ä¸èææ¿ã
</p>
</blockquote>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-03 22:53">2026-02-03 22:52</span>&nbsp;
<a href="https://www.cnblogs.com/Can-daydayup">è¿½éæ¶åè</a>&nbsp;
éè¯»(<span id="post_view_count">5</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19571766);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19571766', targetLink: 'https://www.cnblogs.com/Can-daydayup/p/19571766', title: 'ä½¿ç¨ NanUI å¿«éåå»ºå·æç°ä»£ç¨æ·çé¢ç WinForm åºç¨ç¨åº' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ [å¤§æ¨¡åå®æ 03é¢å¤] äºç«¯ç¼ä¸¹æ¿ 1ï¼Google Colab ä¸ææå ]]></title>
    <link>https://www.cnblogs.com/algieba/p/19571424</link>
    <guid>155e7dcce8eda36779259bc4ade68e9f</guid>
    <description>
    <![CDATA[ 
		<div class="postcontent">
			    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203202001276-892195093.png" alt="[å¤§æ¨¡åå®æ 03é¢å¤] äºç«¯ç¼ä¸¹æ¿ 1ï¼Google Colab ä¸ææå" class="desc_img">
        æ¬å°æ¾å¡è·ä¸å¨å¤§æ¨¡åï¼æ¬æææææå­¦è Google ç¾æ¯ï¼ä» Colab åºç¡æä½ãåè´¹ T4 GPU å¼å¯ï¼å°æè½½ Google Drive æä¹åå­å¨ HuggingFace æ¨¡åï¼ä¸ºäºç«¯ç¼ä¸¹åå¥½å¨å¥åå¤ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="å¤§æ¨¡åå®æ-03é¢å¤-äºç«¯ç¼ä¸¹æ¿-1google-colab-ä¸ææå">[å¤§æ¨¡åå®æ 03é¢å¤] äºç«¯ç¼ä¸¹æ¿ 1ï¼Google Colab ä¸ææå</h1>
<blockquote>
<p><strong>æ ¸å¿æè¦ (TL;DR)</strong></p>
<ul>
<li><strong>çç¹</strong>ï¼æ¬å°çµèæ¾å­ä¸è¶³ï¼è·ä¸å¨ 7B ä»¥ä¸çå¤§æ¨¡åï¼æèè¿è¡éåº¦å¦èçã</li>
<li><strong>æ¹æ¡</strong>ï¼å©ç¨ <strong>Google Colab</strong> æä¾çåè´¹ Tesla T4 GPU ç®åã</li>
<li><strong>æå·§</strong>ï¼éè¿æè½½ <strong>Google Drive</strong>ï¼è§£å³ Colab è¿è¡æ¶éç½®å¯¼è´æ¨¡åæä»¶ä¸¢å¤±çé®é¢ã</li>
<li><strong>ç®æ </strong>ï¼éç½®å¥½äºç«¯ç¯å¢ï¼ä¸ºä¸ä¸ç¯âäºç«¯è¿è¡ RAGâæå¥½å°åºã</li>
</ul>
</blockquote>
<h2 id="åè¨">åè¨</h2>
<p>Ollamaå ä¸ºællama.cppåºåéåææ¯çå æï¼æ¯å¯ä»¥å¨cpuåæ´æ¥å¸¸ççµèä¸è¿è¡çï¼ä½æ¯æ§è½æ¯è¿æ¯ä¸ä¸å¨ä¸ä¸çæ¾å­è®¾å¤ä¸çã<br>
æé«ç«¯æ¾å¡ï¼NVIDIA 4090/5090/A100/H100ï¼ï¼å¯ä»¥å¨èªå·±çæå¡å¨ä¸è±ç¼°è¿è¡å°è§æ¨¡çå¤§æ¨¡åãä½æ¯å¯¹äºæ²¡æé«ç«¯æ¾å¡è®¾å¤çåäººä»¬ä¹ä¸ç¨æå¿, æä»¬å¯ä»¥ä½¿ç¨è°·æ­å¤§åäººå¸¦ç»æä»¬çåè´¹GPUç®åï¼ç±æ¥èªGoogle Colabã æ¬ç¯åæçä¸»è¦ç®çå°±æ¯æåå¸¦åä½åäººä»¬ä»é¶ä¸æColabçæ ¸å¿æä½ï¼ç¡®ä¿å¨æä»¬åç»­çå®æè¿ç¨ä¸­çæµçæä½ã</p>
<h2 id="1-google-colab">1. Google Colab</h2>
<p>ä¸è¨æ¦ä¹ï¼<a href="https://colab.research.google.com/" target="_blank" rel="noopener nofollow">Google Colab</a> = <strong>Jupyter Notebook</strong> + <strong>äºç«¯æå¡å¨</strong></p>
<ul>
<li><strong>Jupyter Notebook</strong>ï¼æä»¬ç¥épythonæ¯ä¸é¨å¨æèæ¬è¯­è¨ï¼æå³çæä»¬å¯ä»¥ä¸è¾¹ç¼åï¼ä¸è¾¹ä»¥äº¤äºå¼çæ¹å¼çå°å½åç»æï¼ç¶åè¿è½ç»§ç»­å¾ä¸åãJupyter Notebookå°±æ¯ä¸ç§å¯ä»¥ä¸è¾¹åä»£ç ï¼ä¸è¾¹åææ¡£ï¼è¿è½å®æ¶çå°ä»£ç è¿è¡ç»æçäº¤äºå¼ç¬è®°ã</li>
<li><strong>äºç«¯æå¡å¨</strong>ï¼åºå«äºå¨æä»¬æ¬å°ç¯å¢åä»£ç æ¶ï¼ä»£ç å¨æä»¬çæ¬å°çµèï¼æ¢ä¸å°çµèå°±éè¦éæ°æåä»£ç è¿è¡ï¼å¨äºç«¯æå¡å¨ç¼ç æ¯å¨è¿ç¨çæå¡å¨ç¼ç ï¼æä»¬éè¿èªå·±ççµèï¼çè³ææºæèä»»ä½è½èç½æå¼æµè§å¨çè®¾å¤ï¼è¿æ¥ä¸è¿ç¨çé£å°æå¡å¨è¿è¡ä»£ç ç¼ååæ¨¡åè®­ç»ãä¼æ´ä¸ºçµæ´»ï¼ä¸åè®¾å¤éå¶ã</li>
</ul>
<h2 id="2-å¿«éä»ç»">2. å¿«éä»ç»</h2>
<h3 id="21-è®¿é®ä¸åå»º">2.1 è®¿é®ä¸åå»º</h3>
<ol>
<li>å±ä»¬ç¡®ä¿æä¸ä¸ªGoogleè´¦æ·ï¼å¹¶ä¸ç»å½</li>
<li>è®¿é®<a href="https://colab.research.google.com/" target="_blank" rel="noopener nofollow">Google Colab å®ç½</a>,å°±ä¼è¿å¥å°ä¸ä¸ªæ¬¢è¿çé¢<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834576-1761513178.png" alt="è¿å¥Colabçæ¬¢è¿é¡µé¢æªå¾" loading="lazy"></li>
<li>ç¹å»èåæ ä¸<strong>File</strong>-&gt;<strong>new notebook in drive</strong>åå»ºæ°çç¬è®°æ¬<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834093-1639885746.png" alt="Colabèåæ æå¼Fileé¼ æ æåå¶ä¸æèånew notebook in driveçæªå¾" loading="lazy"><br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201835540-570983137.png" alt="åå»ºæ°çnotebookåçæ°notebookçé¢æªå¾" loading="lazy"></li>
</ol>
<h3 id="22-çé¢ä»ç»">2.2 çé¢ä»ç»</h3>
<p>å¨æ°çnotebookçé¢ï¼æä»¬å¯ä»¥çå°</p>
<ul>
<li><strong>æä»¶å</strong>ï¼å·¦ä¸è§âUntitled0.ipynbâçæä»¶å,å¯ä»¥åå»éå½å,ipynbå°±æ¯jupyter notebookçåç¼å<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201835718-558218591.png" alt="notebookçé¢éæ°éå½ååçæä»¶åæªå¾" loading="lazy"></li>
<li><strong>ååæ ¼</strong>ï¼é¡µé¢ä¸­å¿ä¸é¿æ¡å¸¦ä¸ä¸ªâ¶æé®çå°±è¯´ååæ ¼ï¼ä¹å«Cellï¼æ¯æä»¬çæ ¸å¿ç¼ç åºå, Jupyter notebookçé»è¾æ¯âä¸æ®µä¸æ®µâæ§è¡ä»£ç ï¼èéæä»¬å¹³å¸¸åä»£ç æ¶ååå®ä¸æ´ä¸ªæä»¶åæ§è¡ã<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201835730-1829068104.png" alt="notebookçé¢ä¸­å¿ååæ ¼çæªå¾" loading="lazy"></li>
<li><strong>å¿«æ·æä½æ </strong>ï¼å¨ååæ ¼ä¸æ¹çä½ç½®æä¸æ¡å¿«æ·èåæ ï¼æ¯ææä»¬æ·»å æ°çä»£ç åï¼Code Cellï¼åææ¬åï¼Text Cellï¼ï¼è¿è¡å¨é¨ååæ ¼ï¼Run Allï¼ã<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834893-14728608.png" alt="å¨ååæ ¼ä¸æ¹çå¿«æ·æä½æ çæªå¾" loading="lazy"></li>
<li><strong>å·¦ä¾§å·¥å·æ </strong>ï¼ åå«ç®å½éè§ï¼æ¥æ¾æ¿æ¢ï¼å¯é¥ç®¡çï¼æ°æ®æ¥çç­ç­å·¥å·ã<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834216-1225871717.png" alt="å·¦ä¾§å·¥å·æ çæªå¾" loading="lazy"></li>
<li><strong>åéåç»ç«¯</strong>ï¼è¿éçåéæé®å¯ä»¥æ¥çæ§è¡å°å½åçåéä¿¡æ¯ï¼å°±ä¸ç¨å»printåéäºï¼å¾æ¹ä¾¿ãç»ç«¯æé®å°±åLinuxç»ç«¯ä¸æ ·ï¼å¯ä»¥ç¨æ¥æ§è¡ä¸äºå½ä»¤ã<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201835497-2041960710.png" alt="æä¸æ¹çåéæé®åç»ç«¯æé®" loading="lazy"></li>
</ul>
<h3 id="3-æ ¸å¿æä½">3. æ ¸å¿æä½</h3>
<p>å¨çé¢ä»ç»æ¶ï¼å±ä»¬å¿«éä»ç»äºä¸ä¸ä¸¤ç§ååæ ¼ï¼<strong>ä»£ç å</strong>å<strong>ææ¬å</strong>ï¼æ¥ä¸æ¥å¯ä»¥ç¨å¾®å¤äºè§£ä¸ç¹ç¹è¿ä¸¤ç§ååæ ¼</p>
<h3 id="31-ä»£ç å">3.1 ä»£ç å</h3>
<p>å°±æ¯æä»¬çä¸»åæåºï¼ç¼åPythonä»£ç çå°æ¹ï¼å¯ä»¥å¿«éä½éªä¸ä¸ä½¿ç¨æµç¨</p>
<ul>
<li>ç´æ¥è¾å¥pythonä»£ç ï¼ç¶åç¹å»è¿è¡ï¼é£ä¸ªâ¶æé®æèä½¿ç¨å¿«æ·é® <strong><code>Shift + Enter</code></strong>ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834009-1869315854.png" alt="å¨ä»£ç åä¸­åå¥ä»£ç åè¿è¡ä¹åççé¢æªå¾" loading="lazy"></li>
<li>å¯ä»¥çå°ä»£ç åå·¦ä¾§æä¸ä¸ª[1],ä¸ä¸ªç»¿è²çâï¼ä»£ç åä¸æ¹æè¾åºçæå°ç»æ<br>
åé¢çåºå·æ æä»£ç åçæ§è¡é¡ºåºï¼å ä¸ºæä»¬å¯ä»¥ä¹±åºæ§è¡ï¼æ§è¡å®ä¸æ¹ä»£ç åååæ¥æ§è¡åé¢çä»£ç å</li>
</ul>
<h3 id="32-ææ¬å">3.2 ææ¬å</h3>
<p>jupyter notebookæ¯æ¯æç´æ¥æ¸²æmarkdownæ ¼å¼çææ¡£çï¼æä»¥ä¹æäººç´æ¥ç¨å®å½ææ¡£ãç¸æ¯äºæä»¬ç¨æ³¨éå»è®°å½ï¼markdownæ ¼å¼çææ¬åä¼æ´ç´è§ã</p>
<ul>
<li>ç¹å»ä¸é¢ç<strong>âText</strong>æé®ï¼æèå¨å½åååæ ¼ä¸æ¹/ä¸æ¹ä¸­é´æµ®ç°æ¾ç¤ºçå¿«æ·æé®ï¼å»æ°å¢ä¸ä¸ªææ¬å</li>
<li><strong>Shift+Enter</strong>å¿«æ·é®âè¿è¡/æ¸²æâå®ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834557-224158255.png" alt="è¾å¥äº# This is Title!!çææ¬åæªå¾" loading="lazy"><br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834523-54180414.png" alt="æ¸²æä¹åçææ¬åæªå¾" loading="lazy"></li>
</ul>
<h2 id="4-å¼å¯åè´¹gpuç®å">4. <strong>å¼å¯åè´¹GPUç®å</strong></h2>
<p>é»è®¤ç¶æä¸Colabæ¯ä½¿ç¨çCPUï¼æä»¬æ¥ä¸æ¥å»å¼å¯GPU</p>
<ul>
<li>ç¹å»é¡¶é¨èåæ ç<strong>Runtimeï¼è¿è¡æ¶ï¼</strong>ä¸æèåä¸­ç<strong>Change runtime typeï¼æ´æ¹è¿è¡æ¶ç±»åï¼</strong><br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834973-1363298837.png" alt="ç¹å»Runtimeä¸æ¥èåï¼é¼ æ æåChange runtime typeçæªå¾" loading="lazy"></li>
<li>éæ©<strong>Hardware accelerator(ç¡¬ä»¶å éå¨)</strong>ç<strong>T4 GPU</strong>.<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834344-277085401.png" alt="è¿å¥change runtime typeåé¼ æ éæ©T4GPUçæªå¾" loading="lazy"></li>
<li>å¼¹åºççªå£è­¦åæä»¬ä¼æ­èå½åè¿è¡æ¶ï¼åæ¢å°T4GPUçç¡¬ä»¶ï¼éæ©OK<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834739-555876133.png" alt="ç¹å»T4GPUåï¼å¼¹åºç»æè¿è¡æ¶çæªå¾" loading="lazy"></li>
<li>ä¿å­ï¼ç¶åä¼åç°ä¹åè¿è¡è¿çä»£ç åå¤±æ´»äºï¼åé¢æ¡æ¡éçæ°å­æ¶å¤±äºï¼ææè¿è¡è¿çä»£ç åéè¦éæ°è¿è¡ï¼</li>
<li>æä»¬æ¥è¾å¥ä»¥ä¸ä»£ç éªè¯</li>
</ul>
<pre><code class="language-python">!nvidia-smi
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834176-1231975840.png" alt="nvidia-smiçè¿è¡ç»ææªå¾" loading="lazy"><br>
ä»è¿åçè¡¨æ ¼ç»æä¸­ï¼è½çå°å±ä»¬çè®¾å¤æ¯TeslaT4ã</p>
<p>å¨notebookä»£ç åä¸­ä»¥<code>!</code>å¼å¤´å³å¯è¿è¡å½ä»¤ï¼è¿éç­æä¸ºå¨terminalä¸­è¿è¡<code>nvidia-smi</code><br>
<strong>PS:é¤äºåæ¢æä»¶å¤¹å¾ç¨<code>%cd</code>èä¸æ¯<code>!cd</code></strong></p>
<h2 id="5-ä¸è½½å¤§æ¨¡å">5. <strong>ä¸è½½å¤§æ¨¡å</strong></h2>
<p>æä»¬ä½¿ç¨Colabä¸»è¦æ¯ä¸ºäºä½¿ç¨å¤§æ¨¡åä»¥åè®­ç»å¤§æ¨¡åï¼å¯¹äºColabèè¨ï¼æ¨¡åçä¸è½½æä¸ªçç¹ï¼<strong>Colabæ¯ä¸´æ¶ç</strong>ï¼åªææä»¬éè¿å½ä»¤ä¸è½½äºå¥½å ä¸ªGçæ¨¡åï¼çè³å¥½å åGçæ¨¡åï¼ä½æ¯æ¯æ¬¡éç½®è¿è¡æ¶çæ¶åï¼è¿ä¸åé½ä¼ç°é£çç­ï¼æ¶æ£å¦çãä¸ºäºé¿åæ¯æ¬¡é½éæ°ä¸è½½ï¼æµªè´¹æ¶é´ï¼æä»¬å¯ä»¥éè¿æå¨Google Driveæ¥ä¿å­æ¨¡åã</p>
<h3 id="51-æè½½google-drive">5.1 æè½½Google Drive</h3>
<ol>
<li>æä»¬è¿è¡ä»¥ä¸ä»£ç </li>
</ol>
<pre><code class="language-python">from google.colab import drive
drive.mount('/content/drive')
</code></pre>
<ol start="2">
<li>ç¶åå¨å¼¹åºææçªå£ä¸­ææ<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834509-1760419411.png" alt="è¿è¡å®æè½½ä»£ç åï¼å¼¹åºçæææç¤ºæªå¾" loading="lazy"></li>
<li>å°±è½å¨ä»£ç åä¸æ¹çè§å·²ç»æåæè½½çæå°ä¿¡æ¯<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834445-1089132265.png" alt="æåæè½½google driveåçæå°ä¿¡æ¯æªå¾" loading="lazy"></li>
</ol>
<h3 id="52-éç½®huggingfaceç¯å¢åéåtoken">5.2 éç½®HuggingFaceç¯å¢åéåToken</h3>
<p>å¨ä¸è½½åéæ¨¡åï¼å¦ Llama 3ï¼æ¶ï¼ä½ éè¦ Hugging Face Tokenã</p>
<ol>
<li>å» <a href="https://huggingface.co/settings/tokens" target="_blank" rel="noopener nofollow">Hugging Face Settings</a> è·å Tokenã</li>
<li>å¨ Colab å·¦ä¾§é¥åå¾æ ï¼Secretsï¼éæ·»å  <code>HF_TOKEN</code>ã</li>
</ol>
<p><img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834471-1969164958.png" alt="Colab å·¦ä¾§ Secrets é¢æ¿éç½® HF_TOKEN çæªå¾" loading="lazy"></p>
<h3 id="53-æå®ç¼å­è·¯å¾ä¸è½½">5.3 æå®ç¼å­è·¯å¾ä¸è½½</h3>
<p>å ä¸ºå±ä»¬å¨Colabç¯å¢ï¼æ¯å½å¤çé­æ³ç¯å¢ï¼æä»¬å¯ä»¥ç´æ¥ä½¿ç¨hugging faceæ¥ä¸è½½æ¨¡åï¼æä»¬æ¥ä¸æ¥æå®ä¸ä¸æ¨¡åä¸è½½çç¼å­è·¯å¾å°æè½½çGoogle Driveã</p>
<ol>
<li>å±ä»¬åååCPUç¯å¢ï¼å ä¸ºä¸è½½æ¨¡åå¹¶ä¸éè¦GPU,ååå»å¯ä»¥èçº¦ä¸ç¹å±ä»¬çé¢åº¦ã</li>
<li>è¾å¥ä»¥ä¸ä»£ç ç¶åè¿è¡</li>
</ol>
<pre><code class="language-python">from google.colab import drive
import os

# 1. æè½½äºç
if not os.path.exists('/content/drive'):
    drive.mount('/content/drive')

# 2. åå¤ç®å½
cache_dir = "/content/drive/MyDrive/huggingface_cache"
os.makedirs(cache_dir, exist_ok=True)

# 3. è®¾ç½® Token (å¦æä½ å¨å·¦ä¾§ Secrets è®¾ç½®äº HF_TOKENï¼è¿éèªå¨è¯»å)
# å¦ææ²¡è®¾ç½®ï¼è¯·æå¨æä¸è¡ä»£ç å¼å·éæ¢æä½ ç tokenï¼æèçç©ºè¯ä¸ï¼Qwen ææ¶ä¸éè¦ï¼
my_token = os.getenv('HF_TOKEN') or ""

print("å±å¹å¯è½ä¼éæ­¢ 5-10 åéï¼è¯·ç¯çå·¦è¾¹çå°ååè½¬å¨å³å¯ã")

cmd = f"huggingface-cli download Qwen/Qwen2.5-7B-Instruct --cache-dir {cache_dir} --quiet"
if my_token:
    cmd += f" --token {my_token}"

# æ§è¡å½ä»¤
result = os.system(cmd)

if result == 0:
    print("\n ä¸è½½æåï¼")
else:
    print("\n ä¸è½½å¤±è´¥ï¼è¯·æ£æ¥ç½ç»æ Tokenã")
</code></pre>
<ol start="3">
<li>ç¶åè¿è¡ä¸é¢çå½ä»¤æ£éªæ¨¡åæ¯å¦ä¸è½½å®æ¯</li>
</ol>
<pre><code class="language-python"># check disk usage (æ¥çç£çå ç¨)
# -s: æ±æ»å¤§å°, -h: äººç±»å¯è¯»æ ¼å¼ (GB/MB)
!du -sh /content/drive/MyDrive/huggingface_cache/models--Qwen--Qwen2.5-7B-Instruct
</code></pre>
<p>çå°çç»æåºè¯¥æ¯15Gå¤§å°çæä»¶<br>
<img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834031-689746531.png" alt="è¿è¡du -sh /content/drive/MyDrive/huggingface_cache/models--Qwen--Qwen2.5-7B-Instructåçç»ææªå¾" loading="lazy"></p>
<p><strong>ä¸è¬æåµä¸ï¼å»ºè®®æ¨¡åä¸è½½åæ°æ®å¤çé½å¨CPUæ¨¡å¼ä¸è¿è¡ï¼ç¶åå¤çå®æ¯å­å¥äºç.</strong> 4. ç¶åæ°å»ºä»£ç åï¼è¿è¡å¦ä¸ä»£ç ï¼æ¥ç¡®è®¤æ¨¡åæ¯å¦è½å¤è¢«è¯å«</p>
<pre><code class="language-python">import os
import glob
from transformers import AutoConfig, AutoTokenizer

# 1. è®¾ç½®ä½ çç¼å­æ ¹ç®å½
base_cache_path = '/content/drive/MyDrive/huggingface_cache'

# 2. æé å¿«ç§ç®å½çééç¬¦è·¯å¾
# ç»æéå¸¸æ¯: base / models--ID / snapshots / &lt;åå¸å¼&gt;
snapshot_pattern = os.path.join(
    base_cache_path,
    "models--Qwen--Qwen2.5-7B-Instruct",
    "snapshots",
    "*"  # è¿éç¨ * å¹éé£ä¸ªéæºçæçåå¸æä»¶å¤¹
)

# 3. å¯»æ¾çå®çæä»¶å¤¹è·¯å¾
found_folders = glob.glob(snapshot_pattern)

if not found_folders:
    print(" éè¯¯ï¼æ¾ä¸å° snapshots æä»¶å¤¹ï¼è¯·æ£æ¥ä¸è½½æ¯å¦æåæè·¯å¾æ¯å¦æ­£ç¡®ã")
else:
    local_model_path = found_folders[0]

    print(f"éå®æ¬å°æ¨¡åè·¯å¾: {local_model_path}")
    print("æ­£å¨å°è¯ç´æ¥å è½½...")

    try:
        config = AutoConfig.from_pretrained(local_model_path)
        tokenizer = AutoTokenizer.from_pretrained(local_model_path)

        print("\næåï¼æ¨¡åå¯ä»¥è¢«æ­£ç¡®å è½½ã")
        print(f"æ¨¡åéèå±ç»´åº¦: {config.hidden_size}")
        print(f"è¯è¡¨å¤§å°: {tokenizer.vocab_size}")

    except Exception as e:
        print(f"\nå è½½ä¾ç¶å¤±è´¥ãå¯è½æ¯ Google Drive çè½¯é¾æ¥å¤±æäºã")
        print(f"éè¯¯ä¿¡æ¯: {e}")
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260203201834785-1187356910.png" alt="éè¿è¿è¡æ¨¡åå è½½å½ä»¤ï¼æ¾ç¤ºæ¨¡åæåå è½½çæªå¾" loading="lazy"></p>
<h2 id="05-å¸¸è§é®é¢-qa">05. å¸¸è§é®é¢ (Q&amp;A)</h2>
<p><strong>Q: CPU å GPU è·å¤§æ¨¡åï¼æ§è½å·®å¼å°åºæå¤å¤§ï¼</strong><br>
<strong>A:</strong> å·®å¼å·¨å¤§ï¼å°±å<strong>æ³æå©</strong>å<strong>æææº</strong>çåºå«ã</p>
<ul>
<li><strong>CPU (ä¸­å¤®å¤çå¨)</strong>ï¼åä¸ä¸ªç¥è¯æ¸åçææï¼è®¡ç®è½åå¼ºä½åªè½ä¸ä¸ªä¸ä¸ªä»»å¡ä¸²è¡å¤çãæ¨çå¤§æ¨¡åæ¶ï¼å®éè¦éä¸ªè®¡ç®ç©éµä¹æ³ï¼çæä¸ä¸ªå­å¯è½éè¦å¥½å ç§ã</li>
<li><strong>GPU (å¾å½¢å¤çå¨)</strong>ï¼åä¸ä¸ªç±å ååå°å­¦çç»æçæ¹éµï¼è½ç¶åäººè½åä¸å¦ææï¼ä½è½åæ¶è¿è¡å¤§è§æ¨¡å¹¶è¡è®¡ç®ãå¤§æ¨¡åçæ¬è´¨æ¯æµ·éçç©éµè¿ç®ï¼GPU å¯ä»¥ç¬é´å®æï¼çæéåº¦éå¸¸æ¯ CPU çå ååçè³ä¸ç¾åã</li>
</ul>
<p><strong>Q: é£ä¸å° RTX 4090 è½è¿è¡å¤å¤§çæ¨¡åï¼è½å¾®è°å¤å¤§ï¼</strong><br>
<strong>A:</strong> RTX 4090 æ¥æ <strong>24GB æ¾å­</strong>ï¼è¿æ¯æ ¸å¿ç¶é¢ã</p>
<ul>
<li><strong>æ¨ç (è¿è¡)</strong>ï¼
<ul>
<li><strong>4-bit éå</strong>ï¼æ¾å­å ç¨ â åæ°é Ã 0.7ã4090 æéå¯ä»¥è· <strong>30B - 34B</strong> åæ°çæ¨¡åï¼å¦ Yi-34B-Chat-Int4ï¼ã</li>
<li><strong>å¨ç²¾åº¦ (FP16)</strong>ï¼æ¾å­å ç¨ â åæ°é Ã 2ã4090 æå¤è· <strong>10B - 12B</strong> åæ°çæ¨¡åã</li>
</ul>
</li>
<li><strong>å¾®è° (è®­ç»)</strong>ï¼
<ul>
<li><strong>å¨éå¾®è°</strong>ï¼æ³é½ä¸è¦æ³ï¼éè¦å ç¾ GB æ¾å­ã</li>
<li><strong>LoRA / QLoRA (è½»éå¾®è°)</strong>ï¼è¿æ¯å±ä»¬ä¸ªäººç©å®¶çä¸»æµã4090 å¯ä»¥è½»æ¾å¾®è° <strong>7B - 10B</strong> çæ¨¡åã</li>
</ul>
</li>
</ul>
<p><strong>Q: å¨æèæ¬è¯­è¨ (Python) åå¸¸è§é¢ç¼è¯è¯­è¨ (C++/Java) æä»ä¹åºå«ï¼</strong><br>
<strong>A:</strong></p>
<ul>
<li><strong>é¢ç¼è¯è¯­è¨ (C++/Java)</strong>ï¼ååä¹¦ãåå®ä¸æ´æ¬ä¹¦ï¼ä»£ç ï¼ï¼éå»å°å·åï¼ç¼è¯ï¼ï¼æååºæ¥æåä¹¦ï¼å¯æ§è¡æä»¶ï¼ãæ§è¡éåº¦å¿«ï¼ä½ä¿®æ¹éº»ç¦ï¼æ¹ä¸ä¸ªå­è¦éæ°å°å·ã</li>
<li><strong>å¨æèæ¬è¯­è¨ (Python)</strong>ï¼åèå¤©ãä½ è¯´ä¸å¥ï¼åä¸è¡ä»£ç ï¼ï¼è§£éå¨å°±æ§è¡ä¸å¥ãè½ç¶æ§è¡éåº¦ç¨æ¢ï¼ä½èå¨<strong>äº¤äºæ§æå¼º</strong>ãå¨æ°æ®ç§å­¦å AI é¢åï¼æä»¬éè¦é¢ç¹æ¥çæ°æ®çä¸­é´ç»æï¼æ¯å¦æ¥çæ¨¡åè¾åºçå¼ éå½¢ç¶ï¼ï¼Python çè¿ç§ç¹æ§è®©å®æä¸ºäº AI é¢åçé¸ä¸»ã</li>
</ul>
<p><strong>Q: Colab éç T4, A100, TPU é½æä»ä¹å·®å«ï¼</strong><br>
<strong>A:</strong></p>
<ul>
<li><strong>T4 (åè´¹çæ é)</strong>ï¼å¥é¨çº§æ¨çå¡ï¼16GB æ¾å­ãè· 7B æ¨¡åæ¨çæ²¡é®é¢ï¼å¾®è° QLoRA åå¼ºå¤ç¨ãå±ä»¬èç¾æ¯ä¸»è¦å°±èå®ã</li>
<li><strong>A100 (ä»è´¹ç)</strong>ï¼é¡¶çº§è®¡ç®å¡ï¼40GB/80GB æ¾å­ãéåº¦æå¿«ï¼æ¾å­æå¤§ï¼éåè·å¤§åæ°æ¨¡åæè¿è¡ä¸¥èçè®­ç»ä»»å¡ãColab Pro/Pro+ æè½å·å°ã</li>
<li><strong>TPU (Tensor Processing Unit)</strong>ï¼Google ä¸é¨ä¸ºæºå¨å­¦ä¹ å®å¶çè¯çï¼å¤çç©éµè¿ç®æ¯ GPU æ´å¿«ï¼ä½çæåå¼å®¹æ§ï¼PyTorch æ¯æï¼ä¸å¦ Nvidia GPU éç¨ï¼ä¸æé¨æ§ç¨é«ã</li>
</ul>
<hr>
<p><strong>æ¬æä½èï¼</strong> Algieba<br>
<strong>æ¬æé¾æ¥ï¼</strong> <a href="https://blog.algieba12.cn/llm02-1-online-environment-colab/" target="_blank" rel="noopener nofollow">https://blog.algieba12.cn/llm02-1-online-environment-colab/</a><br>
<strong>çæå£°æï¼</strong> æ¬åå®¢æææç« é¤ç¹å«å£°æå¤ï¼åéç¨ BY-NC-SA è®¸å¯åè®®ãè½¬è½½è¯·æ³¨æåºå¤ï¼</p>
<pre><code>
</code></pre>


</div>
<div class="clear"></div>

		</div>
		<div class="itemdesc">
			åè¡¨äº 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-03 20:20">2026-02-03 20:20</span>&nbsp;
<a href="https://www.cnblogs.com/algieba">é¿å°çä»£ç å±</a>&nbsp;
éè¯»(<span id="post_view_count">2</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19571424);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19571424', targetLink: 'https://www.cnblogs.com/algieba/p/19571424', title: '[å¤§æ¨¡åå®æ 03é¢å¤] äºç«¯ç¼ä¸¹æ¿ 1ï¼Google Colab ä¸ææå' })">ä¸¾æ¥</a>

		</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æä½æç¨ | ä½¿ç¨å¼æºä¸ä»¶å¥ï¼OpenClaw+Ollama+1Panelï¼é¨ç½²7Ã24è¿è¡çä¸ªäººAIå©ç ]]></title>
    <link>https://www.cnblogs.com/xiaobaiysf/p/19571167</link>
    <guid>1223d4efcb42b7d19924682a8031c949</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaobaiysf/p/19571167" title="åå¸äº 2026-02-03 19:01">
    <span role="heading" aria-level="2">æä½æç¨ | ä½¿ç¨å¼æºä¸ä»¶å¥ï¼OpenClaw+Ollama+1Panelï¼é¨ç½²7Ã24è¿è¡çä¸ªäººAIå©ç</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p><strong>ä¸ãåå¨åé¢</strong><br>
æ¬æ¬¡æä½æç¨å°ä»¥å¼æº Linux æå¡å¨è¿ç»´é¢æ¿ 1Panel ä¸ºåºç¡ï¼æ­é Ollama æ¬å°å¤§æ¨¡åï¼æ éæå¿ Token æ¶èè´¹ç¨ï¼ï¼ææææä½ é¨ç½² OpenClaw ä¸ªäºº AI å©çï¼å®ç° 7Ã24 å°æ¶ç¨³å®è¿è¡ï¼è½»æ¾æ¥æä¸å±æºè½å©æï¼</p>
<p><strong>äºãèµæºåå¤</strong><br>
æ¬æ¬¡ OpenCalw æ¬å°ä¸ªäºº AI å©çåºäºä¸å°è¾è®¯ GPU äºæå¡å¨æå»ºï¼äºæå¡å¨è·åè¿ç¨ä¸åèµè¿°ï¼åè§è¾è®¯äºå®ç½ãå¶ä¸­æå¡å¨çéç½®åè§å¦ä¸ï¼</p>
<ul>
<li>æä½ç³»ç»ï¼Ubuntu Server 24.04 LTS 64 ä½</li>
<li>è®¡ç®èµæºï¼20 æ ¸ 80 G</li>
<li>ç£çå®¹éï¼100G</li>
<li>GPUï¼ è®¡ç®å GN7 | GN7.5XLARGE80</li>
<li>ç½ç»ï¼ç»å®å¼¹æ§å¬ç½IP</li>
</ul>
<p><img alt="image-2026-2-3_16-29-44" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203182302825-4978420.png" class="lazyload"></p>
<p><strong>ä¸ãæä½è¿ç¨</strong><br>
æ¬æ¬¡åºäº 1Panel æå¡å¨è¿ç»´ç®¡çé¢æ¿æå»ºæ¬å°å AI å©çå¤§è´éè¦ä»¥ä¸å ä¸ªæ­¥éª¤ï¼</p>
<ul>
<li>ç¬¬ä¸æ­¥ï¼1Panel å®è£é¨ç½²ï¼</li>
<li>ç¬¬äºæ­¥ï¼GPU èµæºè°åº¦éç½®ï¼</li>
<li>ç¬¬ä¸æ­¥ï¼Ollama çå®è£é¨ç½²ï¼</li>
<li>ç¬¬åæ­¥ï¼Qwen3 æ¨¡åå è½½ï¼</li>
<li>ç¬¬äºæ­¥ï¼OpenClaw å®è£é¨ç½²åéç½®ã</li>
</ul>
<p><strong>åãè¯¦ç»æä½æ­¥éª¤è¯´æ</strong><br>
4.1.&nbsp;<strong>1Panel å®è£é¨ç½²</strong><br>
1Panel çå®è£é¨ç½²æ¯è¾ç®åï¼å¯ä»¥åç§å®ç½å¨çº¿å®è£ï¼<a href="https://1panel.cn/docs/v2/installation/online_installation/" target="_blank" rel="noopener nofollow">https://1panel.cn/docs/v2/installation/online_installation/</a></p>
<p>æ­¥éª¤ä¸ï¼<strong>è·å root æé</strong>ï¼ç»å½æå¡å¨åé¦ååæ¢å° root æé</p>
<p><code>sudo su -</code><br>
æ­¥éª¤äºï¼<strong>è¾å¥å½ä»¤å®è£</strong>ï¼è¾å¥å¨çº¿å®è£å½ä»¤æ§è¡å®è£ï¼</p>
<p><code>bash&nbsp;-c&nbsp;"$(curl&nbsp;-sSL&nbsp;https://resource.fit2cloud.com/1panel/package/v2/quick_start.sh)"</code><br>
æ­¥éª¤ä¸ï¼<strong>Docker å®è£</strong>ï¼æå®å®è£ç®å½å¹¶å®è£ Docker</p>
<p><img alt="2" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203182957878-30017089.png" class="lazyload"></p>
<p>æ­¥éª¤åï¼<strong>éåå éå¨éç½®</strong>ï¼éæ©éç½®éåå éå¨å¹¶è®¾ç½® 1Panel é¢æ¿è®¿é®åæ°ã</p>
<p><img alt="3" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183017374-611998472.png" class="lazyload"></p>
<p>æ­¥éª¤äºï¼<strong>è·å 1Panel é¢æ¿ç»å½ä¿¡æ¯</strong></p>
<p><img alt="4" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183034141-1655101506.png" class="lazyload"></p>
<p>æ­¥éª¤å­ï¼<strong>éªè¯ 1Panel é¨ç½²æåï¼</strong>å°å¤é¨å°åè¾å¥æµè§å¨è¿å¥ç»å½é¡µé¢ï¼è¾å¥å¯¹åºçé¢æ¿ç¨æ·ä»¥åé¢æ¿å¯ç ï¼ç¡®è®¤å®è£å®æã</p>
<p><img alt="5" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183048487-1085907675.png" class="lazyload"></p>
<p>æ­¥éª¤ä¸ï¼<strong>1Panel è®¿é®å°åè®¾ç½®ï¼</strong>è¿å¥é¢æ¿åï¼åæ¢å°ãé¢æ¿è®¾ç½®ãä¸­ï¼å°é»è®¤è®¿é®å°åè®¾ç½®ä¸º1Panelè®¿é®çå¬ç½IPï¼æ¹ä¾¿åç»­é¨ç½²çåºç¨å¯ä»¥éè¿è·³è½¬å¿«éè·³è½¬ã</p>
<p><img alt="6" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183101616-1520186339.png" class="lazyload"></p>
<p><strong>4.2ã&nbsp;GPU èµæºè°åº¦éç½®</strong><br>
è¿å¥1Panelçãç»ç«¯ãç®¡çå®æ NVIDIA å®¹å¨éåéç½®ï¼æç»è®©åºäºå®¹å¨å®è£çæ¨¡åè½å¤è°åº¦ GPU èµæºã</p>
<p>æ­¥éª¤ä¸ï¼<strong>NVIDIA æ¾å¡é©±å¨ç¡®è®¤ï¼</strong>éè¦ç¡®ä¿ NVIDIA æ¾å¡é©±å¨å·²æ­£ç¡®å®è£ï¼è¾å¥ä»¥ä¸å½ä»¤ï¼</p>
<p><code>nvidia-smi</code><br>
å¦ä¸å¾å±ç¤ºï¼åä»£è¡¨æåãå¦ææ²¡æå®è£åèªè¡åå¾è±ä¼è¾¾å®ç½ä¸è½½å®è£ï¼</p>
<p><a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#installing-with-apt" target="_blank" rel="noopener nofollow">https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#installing-with-apt</a></p>
<p><img alt="7" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183137742-1314487835.png" class="lazyload"></p>
<p>æ­¥éª¤äºï¼<strong>å®è£ NVIDIA å®¹å¨éåï¼</strong>ä¸ºäºå¨ docker å®¹å¨ä¸­ä½¿ç¨ GPU å éï¼æä»¬éè¦å®è£ NVIDIA çå®¹å¨éåï¼åç§å¦ä¸éä¸ªå½ä»¤è¡æ§è¡æä½ï¼</p>
<p>å½ä»¤è¡ä¸ï¼æ·»å  NVIDIA å®¹å¨å·¥å·ä»åºä¸ç­¾å</p>
<pre><code>curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \
&nbsp;&nbsp;&amp;&amp; curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \
&nbsp;&nbsp;&nbsp;&nbsp;sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
&nbsp;&nbsp;&nbsp;&nbsp;sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list
</code></pre>
<p>å½ä»¤è¡äºï¼å¯ç¨ä»åºä¸­ç experimental ç»ä»¶ï¼å¯éï¼</p>
<p><code>sed -i -e '/experimental/ s/^#//g' /etc/apt/sources.list.d/nvidia-container-toolkit.list</code></p>
<p>å½ä»¤è¡ä¸ï¼æ´æ°è½¯ä»¶æº</p>
<p><code>sudo apt-get update</code></p>
<p>å½ä»¤è¡åï¼å®è£ nvidia-container-toolkit</p>
<p><code>sudo apt-get install -y nvidia-container-toolkit</code></p>
<p>æ­¥éª¤ä¸ï¼<strong>éç½® Docker éåä½¿ç¨ NVIDIAï¼</strong>å®è£å®å®¹å¨éååï¼éè¦éç½® Docker ä»¥ä½¿ç¨ NVIDIAï¼å¹¶éå¯ Docker æå¡ã</p>
<p>å½ä»¤è¡ä¸ï¼éç½® Docker ä»¥ä½¿ç¨ NVIDIA</p>
<p><code>sudo nvidia-ctk runtime configure --runtime=docker</code></p>
<p>å½ä»¤è¡äºï¼éå¯ docker</p>
<p><code>sudo systemctl restart docker</code></p>
<p><strong>4.3ãOllama å®è£é¨ç½²</strong><br>
1Panel å®è£ä»¥åæå¡å¨ç GPU èµæºéç½®å®æä»¥åï¼æä»¬å°±å¯ä»¥åºäº1Panelçè¿ç»´ç®¡çé¢æ¿è¿è¡ä¸ªäººå©ççæ¬å°åå®è£é¨ç½²äºï¼ä¸åå°±ä¼åå¾éå¸¸ç®åï¼å°ç½é½è½è½»æ¾ä¸æãé¦åæä»¬æ¥å®è£Ollamaï¼Ollama æ¯ä¸ä¸ªå¼æºçå¤§åè¯­è¨æ¨¡åæå¡ï¼æä¾äºç±»ä¼¼ OpenAI ç API æ¥å£åèå¤©çé¢ï¼å¯ä»¥éå¸¸æ¹ä¾¿å°é¨ç½²ææ°çæ¬ç Qwen æ¨¡åå¹¶éè¿æ¥å£ä½¿ç¨ã</p>
<p>æ­¥éª¤ä¸ï¼ <strong>å¼å§å®è£ Ollama åºç¨ï¼</strong>é¦åæä»¬è¿å¥1Panel çåºç¨ååºï¼ç¹å»ãAIãï¼ç¶åéæ© Ollamaï¼ç´æ¥ç¹å»å®è£ã</p>
<p><img alt="8" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183244850-622075411.png" class="lazyload"></p>
<p>æ­¥éª¤äºï¼<strong>è®¾ç½® Ollama å®è£åæ°ï¼</strong>å®è£åæ°éç½®æ¶éè¦ç¡®è®¤çæ¬å·ä»¥åç«¯å£å·ï¼å¦å¤è®°å¾å¾éãç«¯å£å¤é¨è®¿é®ãï¼åæ¶å¾éãå¼å¯ GPU æ¯æãï¼ç¡®ä¿åç»­æä»¬å¯ä»¥æ­£å¸¸è®¿é® Ollama ä¸æ¨¡åä½¿ç¨ GPU èµæºï¼å¶ä»åæ°ä¿æé»è®¤ç¹å»ç¡®è®¤å³å¯ã</p>
<p><img alt="9" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183256435-1948463988.png" class="lazyload"></p>
<p>æ­¥éª¤ä¸ï¼<strong>ä¸è½½éåå¹¶å®è£ Ollamaï¼</strong>ç¹å»ç¡®è®¤åï¼ç³»ç»å¼å§èªå¨æåéåå¹¶å®è£åºç¨ï¼ç´å°æéå®è£åºç¨ãollamaãæåï¼åä»£è¡¨å®æå®è£ã</p>
<p><img alt="10" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183308186-987223317.png" class="lazyload"></p>
<p>æ­¥éª¤åï¼<strong>éªè¯Ollamaæ¯å¦æåï¼</strong>è¿å¥å·²å®è£åºç¨ï¼æ¾å° Ollama åºç¨ï¼ç¹å»è·³è½¬ï¼ç¡®è®¤è¾åºåå®¹ä¸ºâOllama is runningâï¼åä»£è¡¨é¨ç½²æåã</p>
<p><img alt="11" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183320040-1515484528.png" class="lazyload"><br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183404571-1492140415.png" class="lazyload"></p>
<p><strong>4.4ãQwen3 æ¬å°æ¨¡åé¨ç½²</strong><br>
é¨ç½²å®æ Ollama ä»¥åï¼æä»¬ç»§ç»­åºäº 1Panel æ¥å®æåºäº Ollama æ¬å° qwen3:14b æ¨¡åå è½½é¨ç½²ï¼åç§å¦ä¸æä½æ­¥éª¤éæ­¥å®æå³å¯ã</p>
<p>æ­¥éª¤ä¸ï¼<strong>åå»º Qwen3 æ¨¡åï¼</strong>è¿å¥ ãAIã çæ¨¡åç®¡çé¡µé¢ï¼ç¹å»æ·»å æ¨¡åã</p>
<p><img alt="12" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183425917-1585926150.png" class="lazyload"></p>
<p>æ­¥éª¤äºï¼<strong>å è½½æ¨¡åï¼</strong>æ ¹æ®å¼å¯¼å° Ollama å®ç½æ¾å°æ¨¡å IDï¼å¨åç§°ä¸­è¾å¥æ¨¡ååç§°ï¼ç¹å»æ·»å å¼å§å è½½æ¨¡åæä»¶ãæ¬æ¬¡æä»¬éæ©çæ¯ qwen3:14b çæ¨¡åï¼è¿éæ¨¡åå è½½å¤§æ¦éè¦ 20-30 åé</p>
<p><img alt="13" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183501664-2099642155.png" class="lazyload"><br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183510320-687012262.png" class="lazyload"></p>
<p>æ­¥éª¤ä¸ï¼<strong>æ¨¡åè¿è¡ç¡®è®¤ï¼</strong>å½æ¨¡ååè¡¨ä¸­çãç¶æãæ´æ°ä¸ºæååï¼å¯ä»¥ç¹å»è¿è¡éªè¯æ¨¡åé¨ç½²ææï¼å¦æè½å¤æ­£å¸¸å¯¹è¯åä»£è¡¨æ¨¡åå è½½æåï¼å¦ä¸å¾æç¤ºï¼</p>
<p><img alt="14" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183527172-160122313.png" class="lazyload"></p>
<p><strong>4.5ãOpenClaw å®è£é¨ç½²</strong><br>
åºäºä»¥ä¸æ­¥éª¤æä»¬å®æäºæ¬å°æ¨¡åçåå¤ï¼ç¶åæä»¬ååºäº 1Panel å¿«éæ­å»ºä¸ªäºº AI å©ç OpenClaw ã</p>
<p>æ­¥éª¤ä¸ï¼<strong>å¼å§å®è£ OpenClaw åºç¨</strong>ï¼è¿å¥åºç¨ååºç¹å»å®è£ OpenClaw åºç¨ï¼å¦ä¸å¾æç¤ºè¿å¥åºç¨ååºï¼ç¹å»ãå®è£ãï¼è¿å¥å®è£åæ°è®¾ç½®é¡µé¢ã</p>
<p><img alt="15" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183541819-1317933335.png" class="lazyload"></p>
<p>æ­¥éª¤äºï¼<strong>è®¾ç½®åºç¨å®è£åæ°</strong>ï¼å¦ä¸å¾è®¾ç½® OpenClaw ççæ¬å·åç«¯å£ãOllama æ¬å°æ¨¡åä»¥åæ¯å¦å¤é¨è®¿é®ç­éç½®é¡¹ï¼è®¾ç½®å®æåç¹å»ç¡®è®¤å¼å§å®è£ï¼å¶ä¸­åæ°å·ä½è¯´æå¦ä¸ï¼</p>
<ul>
<li>çæ¬ï¼OpenClaw çæ¬é»è®¤ä¸ºææ°çæ¬ï¼</li>
<li>ç«¯å£ï¼OpenClaw åºç¨è®¿é®ç«¯å£é»è®¤ä¸º 18789ã18790ï¼å¦æå ç¨èªè¡è°æ´åæ´ï¼æç»éè¦ç¡®ä¿ç«¯å£å·²å¼éï¼å¯å¤é¨è®¿é®ï¼</li>
<li>æ¨¡åä¾åºåï¼ä¸æéæ© Ollamaï¼</li>
<li>æ¨¡åï¼æç§ Ollama/æ¨¡å ID è¾å¥ï¼å³æ¨¡åç®¡çä¸­æ·»å çæ¨¡å IDï¼ï¼å¦ï¼Ollama/qwen3:14bï¼</li>
<li>æ¨¡åAPI Keyï¼æ¬å°æ¨¡åè¾å¥ä»»æå­ç¬¦å³å¯ï¼</li>
<li>Base URLï¼è¾å¥ä¸è¿°æ­¥éª¤é¨ç½²ç Ollama åºç¨çå°åï¼å³ <a href="http://IP:11434/v1" target="_blank" rel="noopener nofollow">http://IP:11434/v1</a> å³å¯;</li>
<li>ç«¯å£å¤é¨è®¿é®ï¼å¾éç«¯å£å¤é¨è®¿é®ï¼æ¹ä¾¿åç»­ OpenClaw åºç¨è®¿é®ã</li>
</ul>
<p><img alt="16" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183614387-1678215063.png" class="lazyload"></p>
<p>æ­¥éª¤ä¸ï¼<strong>OpenClaw åºç¨å®è£</strong>ï¼ç¹å»ç¡®è®¤åç³»ç»èªå¨å¼å§æåéåï¼å¹¶å®è£åºç¨ï¼å¦ä¸å¾æç¤ºåä»£è¡¨ OpenClaw åºç¨å®è£æåã</p>
<p><img alt="17" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183626803-1897196381.png" class="lazyload"></p>
<p>æ­¥éª¤åï¼<strong>åºç¨ token è·å</strong>ï¼éè¿ãå·²å®è£ãåºç¨å¦å¾ç¹å»è¿å¥ç®å½ï¼ä¸è·¯ç¹å»å¦å¾æç¤ºï¼è¿å¥ data/conf æä»¶ï¼æ¾å° openclaw.json æä»¶ç¹å»æå¼ï¼æ¾å° âgatewayâ ä¸­ç âtokenâ å¤å¶å¶ä¸­ç token å¼ï¼å¦ï¼9bfd07dd800a8c304b62bfac09f698cb7ad9f939d812021aï¼</p>
<p><img alt="18" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183642400-1364221682.png" class="lazyload"><br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183714552-1926603420.png" class="lazyload"></p>
<p><img alt="18" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183724468-977446092.png" class="lazyload"></p>
<p>æ­¥éª¤äºï¼<strong>Web åºç¨è®¿é®è®¾ç½®</strong>ï¼å°è·åå°ç token ä¸ IP å°åä»¥åç«¯å£å·æç§ <strong>IP:ç«¯å£ï¼token={token}</strong>å·ä½å¼ï¼å¦ï¼</p>
<p>139.186.147.190:18789?token=9bfd07dd800a8c304b62bfac09f698cb7ad9f939d812021a</p>
<p>ï¼ æ¼æ¥èµ·æ¥ ï¼å®ä¹å¨åæ°ä¸­ç ãWeb è®¿é®å°åãä¸­ï¼å¦ä¸å¾æç¤ºï¼</p>
<p><img alt="18" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183743139-1217954063.png" class="lazyload"></p>
<p><img alt="18" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183753224-871873768.png" class="lazyload"></p>
<p><strong>äºãä¸ªäºº AI å©çææ</strong><br>
å®æä»¥ä¸æä½æä»¬å°±åºäº 1Panel å®æäº OpenClaw ä¸ªäºº AI å©ççæ­å»ºãç´æ¥è¿å¥åºç¨ååºå·²å®è£ï¼ç¹å»è·³è½¬ï¼éæ©å¸¦ token çé¾æ¥å°åç¹å»å³å¯è¿å¥OpenClaw ä½éªäºï¼å·ä½åè§å¦ä¸å¾ï¼</p>
<p><img alt="19" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183807643-1158980675.png" class="lazyload"></p>
<p>æä»¬è¾å¥å¯ä»¥è¾å¥ä¸äºç®åçäºæäº¤ç» AI å©çå¸®ä½ å®æï¼å¦ä¸å¾æç¤ºï¼</p>
<p><img alt="20" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260203183819333-836643661.png" class="lazyload"></p>
<p><strong>å­ãæ»ç»</strong><br>
éè¿ä¸è¿°å®æ´æ­¥éª¤ï¼æä»¬è½ä¾æ 1Panel è¿ç»´ç®¡çé¢æ¿å¿«éæ­å»º 7X24 å°æ¶ä¸é´æ­è¿è¡çæ¬å° AI å©çãæç»åªééè¿æµè§å¨è®¿é® OpenClawï¼å³å¯çäº«æ¬å°æ¨¡åé©±å¨ç AI æºè½å©çæå¡ï¼æ è®ºæ¯æ¥å¸¸å¨è¯¢è¿æ¯è½»éåå¬è¾å©é½è½è½»æ¾åºå¯¹ã</p>
<p>å¨ç¨æä½ä»¥ 1Panel ä¸ºæ ¸å¿è½½ä½ï¼æ éå¤æçå½ä»¤è¡ååºï¼ææéç½®æµç¨å¯è§åãæ­¥éª¤åï¼å³ä¾¿æ¯å°ç½æ°æä¹è½ææå¼å¿«éå®æé¨ç½²ãä¸è¿ç»å®æµåç°ï¼å½åæ¬å°æ¨¡åå¨å·¥å·è°ç¨ççµæ´»æ§ä¸ä»å­å¨äºè®¸å±éï¼ä½éç OpenClawãOllama ç­å¼æºé¡¹ç®çæç»­è¿­ä»£ä¼åï¼è¿äºé®é¢æä»¬ç¸ä¿¡ä¼å¾å¿«å¾å°ä¼åæ¹åï¼æªæ¥è¯¥ AI å©ççåè½ä¼æåå¼ºå¤§ï¼ä¸ºæä»¬ççæ´»åå·¥ä½æçå¸¦æ¥æ¾èæåã</p>
<p>æåå¨æ¨¡åéæ©æ¹é¢ï¼ç»è¿å¤æ¬¡å®æµéªè¯ï¼åºäºå½åçç¡¬ä»¶èµæºéç½®ï¼Qwen3:14bãQwen coder:30b æ¯å¼é¡¾æ§è½ä¸èµæºæ¶èçä¼éæ¹æ¡ï¼è¥æå¡å¨éç½®åè¶³ï¼å¦æ´é«æ¾å­ãæ´å¼ºç®åï¼ï¼ä¹å¯å°è¯é¨ç½²åæ°æ´å¤§çæ¨¡åä»¥è·å¾æ´ä¼ææã</p>
<p>è¿å¥æ¬å°å AI å©çæ¹æ¡æ éä¾èµå¤é¨ Tokenï¼æ°æ®éç§æ´æä¿éï¼è¯éå¤§å®¶å¨æå®æä½éªï¼æåå¼æºä¸ä»¶å¥å·¥å·å¸¦æ¥çé«ææºè½æå¡ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-03 19:02">2026-02-03 19:01</span>&nbsp;
<a href="https://www.cnblogs.com/xiaobaiysf">å°ç½è·åå</a>&nbsp;
éè¯»(<span id="post_view_count">76</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19571167);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19571167', targetLink: 'https://www.cnblogs.com/xiaobaiysf/p/19571167', title: 'æä½æç¨ | ä½¿ç¨å¼æºä¸ä»¶å¥ï¼OpenClaw+Ollama+1Panelï¼é¨ç½²7&amp;#215;24è¿è¡çä¸ªäººAIå©ç' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å­ç¬¦ç¼ç ç¥å¤å°(äº) ]]></title>
    <link>https://www.cnblogs.com/lmy5215006/p/19567495</link>
    <guid>4d1c297cb6761fbfabb8d31eff2fa99c</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lmy5215006/p/19567495" title="åå¸äº 2026-02-03 16:14">
    <span role="heading" aria-level="2">å­ç¬¦ç¼ç ç¥å¤å°(äº)</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="bomå¤´">BOMå¤´</h1>
<p>BOMå¤´å¨ç¨Byte Order Mark (å­èé¡ºåºæ è®°), æ¯Unicodeç¼ç æ åä¸­ï¼ææ©æ¯ç¨äºUTF32/16ä¸­æ è¯å­èé¡ºåºçç¹æ®å­ç¬¦ï¼åæ¥éçUTF-8çåºç°ï¼ä¸ºäºå¼å®¹ï¼åæäºæ è¯ææ¬ç¼ç æ ¼å¼çä½ç¨ã</p>
<blockquote>
<p>æåä¸»è¦æ¯ä¸ºäºè§£å³UTF32/16ç¼ç æ¹æ¡ä¸­å¤§å°ç«¯çé®é¢ï¼(å¤§ç«¯BEï¼é«å­èå¨åï¼å°ç«¯LEï¼ä½å­èå¨å)ãæä»¥éè¦å¨å­ç¬¦ä¸²åå¢å ä¸ä¸ªç¹æ®æ è®°ï¼ä»¥æ¹ä¾¿è¯å«è§£æã<br>
éçUTF-8çåºç°ï¼ä¸åéè¦BOMå¤´ãä½å¾®è½¯ä¸ºäºæ¹ä¾¿èªå®¶è½¯ä»¶è½å¿«éåºåUTF-8ä¸ANSIç¼ç ï¼èé¢å¤å¼å¥äº<code>éæ åæå±</code>ãå æ­¤æäºç¬ç¹çUTF-8 BOM ç¼ç æ¹å¼</p>
</blockquote>
<hr>
<h2 id="ä¸åunicodeç¼ç ä¸­çbomå¤´è¡¨ç°">ä¸åUnicodeç¼ç ä¸­çBOMå¤´è¡¨ç°</h2>
<table>
<thead>
<tr>
<th>ç¼ç æ ¼å¼</th>
<th>BOMå¤´å­èåºå</th>
<th>é¿åº¦</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>UTF-8 BOM (å¾®è½¯ç¹è²)</td>
<td><strong>EF BB BF</strong></td>
<td>3å­è</td>
<td>ä»ä½ç¼ç æ è¯ï¼æ å­èé¡ºåºé®é¢</td>
</tr>
<tr>
<td>UTF-8</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>UTF-16 BEï¼å¤§ç«¯ï¼</td>
<td><strong>FE FF</strong></td>
<td>2å­è</td>
<td>è¡¨ç¤ºé«ä½å­èå¨å</td>
</tr>
<tr>
<td>UTF-16 LEï¼å°ç«¯ï¼</td>
<td><strong>FF FE</strong></td>
<td>2å­è</td>
<td>è¡¨ç¤ºä½ä½å­èå¨å</td>
</tr>
<tr>
<td>UTF-32 BE</td>
<td><strong>00 00 FE FF</strong></td>
<td>4å­è</td>
<td>è¡¨ç¤ºé«ä½å­èå¨å</td>
</tr>
<tr>
<td>UTF-32 LE</td>
<td><strong>FF FE 00 00</strong></td>
<td>4å­è</td>
<td>è¡¨ç¤ºä½ä½å­èå¨å</td>
</tr>
</tbody>
</table>
<h2 id="ç¼è§ä¸ºå®">ç¼è§ä¸ºå®</h2>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1084317/202602/1084317-20260203113106855-1867975735.png" class="lazyload"></p>
<blockquote>
<p>ä½¿ç¨ææ¬ç¼è¾å¨ï¼éæ©å¦å­ä¸ºï¼ä¿å­ä¸ºä¸åçç¼ç æ¹æ¡</p>
</blockquote>
<pre><code>        public static void Run()
        {
            var utf8_path = @"C:\Users\liu\Documents\utf-8.txt";
            var utf8_bom_path = @"C:\Users\liu\Documents\utf-8 bom.txt";
            var utf16_le_path = @"C:\Users\liu\Documents\utf-16 be.txt";
            var utf16_be_path = @"C:\Users\liu\Documents\utf-16 le.txt";

            var utf8= BitConverter.ToString(File.ReadAllBytes(utf8_path));
            Console.WriteLine("utf8 æ bom: "+utf8 +"\n");

            var utf8_bom= BitConverter.ToString(File.ReadAllBytes(utf8_bom_path));
            Console.WriteLine("utf8 æbom: "+utf8_bom + "\n");

            var utf16_le= BitConverter.ToString(File.ReadAllBytes(utf16_le_path));
            Console.WriteLine("utf-16 beå¤§ç«¯: "+utf16_le + "\n");

            var utf16_be = BitConverter.ToString(File.ReadAllBytes(utf16_be_path));
            Console.WriteLine("utf-16 leå°ç«¯: "+utf16_be + "\n");
        }
</code></pre>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1084317/202602/1084317-20260203112958119-1126471966.png" class="lazyload"></p>
<h1 id="ä¸ºä»ä¹utf-8ä¸éè¦bom">ä¸ºä»ä¹UTF-8ä¸éè¦BOM</h1>
<p>BOMçæ¬è´¨æ¯ä¸ºäºè§£å³UTF-16/32å¤§å°ç«¯æ­§ä¹çé®é¢ï¼èUTF8çç¼ç ç¹æ§<code>ä»æ ¹æ¬ä¸è§£å³äºBOMè¦å¤çé®é¢</code>ï¼æä»¥BOMå¯¹UTF-8èè¨æ¢æ å¿è¦ï¼èä¸è¿å±äº"é¢å¤éå "çåå®¹ã</p>
<h2 id="utf-1632ä¸ºä»ä¹éè¦">UTF-16/32ä¸ºä»ä¹éè¦</h2>
<p>åå¦æè¦ä¼ è¾ä¸ä¸ªå­ç¬¦ä¸²âä¸­âï¼Unicodeç¼ç ï¼U+4E2Dï¼å¨æä¼ è¾ç»ä½ çè¿ç¨ä¸­ï¼å®å¯ä»¥æ¯FE-FF-4E-2Dï¼å¤§ç«¯ï¼ï¼ä¹å¯ä»¥æ¯FF-FE-2D-4E(å°ç«¯)ï¼å¦æææ²¡ææ è¯å­èé¡ºåºï¼ä½ å¦ä½è§£æï¼</p>
<h2 id="utf-8-æ ¸å¿ç¼ç è§å">UTF-8 æ ¸å¿ç¼ç è§å</h2>
<p>è¦æ³ç¥éä¸ºä»ä¹UTF-8ä¸éè¦BOMï¼åä»å®çåçå¼å§è¯´èµ·ã</p>
<ol>
<li>å¯åé¿ç¼ç <br>
ç¨1-4ä¸ªå­èè¡¨ç¤ºä¸ä¸ªUnicodeå­ç¬¦ï¼ç ç¹è¶å°ï¼å ç¨çå­èæ°è¶å°ã</li>
<li>æ åçå­èæ ¼å¼<br>
æ¯ä¸ªå­ç¬¦çèµ·å§å­èï¼ä¼æä¸ä¸ª<code>ç¹æ®æ è¯</code>æ¥è¡¨ç¤ºè¯¥å­ç¬¦å ç¨çæ»å­èæ°ï¼åç»­çå­èç¨<code>åºå®æ ¼å¼</code>æ¥è¡¨ç¤ºï¼ç¸å½äºæä¸ä¸ªæ åæ¨¡æ¿æ¥å®ä¹UTF-8å­ç¬¦ã</li>
</ol>
<table>
<thead>
<tr>
<th>å­ç¬¦å ç¨å­èæ°</th>
<th>èµ·å§å­èäºè¿å¶æ ¼å¼</th>
<th>ç»­å­èäºè¿å¶æ ¼å¼</th>
<th>å¯è¡¨ç¤ºçUnicodeç ç¹èå´</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>1å­è</td>
<td><code>0xxxxxxx</code></td>
<td>æ ç»­å­è</td>
<td><code>U+0000</code> ~ <code>U+007F</code></td>
<td>å¯¹åºASCIIå­ç¬¦</td>
</tr>
<tr>
<td>2å­è</td>
<td><code>110xxxxx</code></td>
<td><code>10xxxxxx</code></td>
<td><code>U+0080</code> ~ <code>U+07FF</code></td>
<td>æ¬§æ´²ãä¸­ä¸ç­å­ç¬¦</td>
</tr>
<tr>
<td>3å­è</td>
<td><code>1110xxxx</code></td>
<td><code>10xxxxxx</code></td>
<td><code>U+0800</code> ~ <code>U+FFFF</code></td>
<td>ä¸­æãæ¥æãé©æç­å¸¸ç¨å­ç¬¦</td>
</tr>
<tr>
<td>4å­è</td>
<td><code>11110xxx</code></td>
<td><code>10xxxxxx</code></td>
<td><code>U+10000</code> ~ <code>U+10FFFF</code></td>
<td>ç½è§å­ç¬¦ãemojiç­</td>
</tr>
</tbody>
</table>
<h3 id="ç¼è§ä¸ºå®ä»¥ä¸­ä¸¾ä¾">ç¼è§ä¸ºå®ï¼ä»¥"ä¸­"ä¸¾ä¾</h3>
<ol>
<li>ç¡®å®å­èæ°<br>
"ä¸­"è¿ä¸ªå­ç¬¦çç ç¹ä¸º<code>U+4E2D</code>ï¼å¨<code>U+0800~U+FFFF</code>èå´åï¼å ç¨ 3 å­èã</li>
<li>åå­è¿å¶è½¬æ¢æäºè¿å¶<br>
<code>4E2D</code>è½¬æäºè¿å¶ï¼å¾å°<code>0100 1110 0010 1101</code><br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1084317/202602/1084317-20260203142921064-2043769251.png" class="lazyload"></li>
<li>æç§UTF-8æ¨¡æ¿æ ¼å¼å¡«å<br>
å·²ç¥å ç¨3å­èï¼æ¨¡æ¿æ ¼å¼ä¸ºï¼<code>1110xxxx</code> <code>10xxxxxx</code> <code>10xxxxxx</code> (èµ·å§å­è+2ä¸ªç»­å­è)<br>
-----------å¾å°UTF-8ç¼ç <code>11100100</code> <code>10111000</code> <code>10101101</code></li>
<li>äºè¿å¶è½¬æ¢æåå­è¿å¶<br>
<code>11100100</code> =&gt; <code>0xE4</code><br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1084317/202602/1084317-20260203143842350-599928471.png" class="lazyload"><br>
<code>10111000</code> =&gt; <code>0xB8</code><br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1084317/202602/1084317-20260203144011185-866978422.png" class="lazyload"><br>
<code>10101101</code> =&gt; <code>0xAD</code><br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1084317/202602/1084317-20260203144040609-836692606.png" class="lazyload"></li>
</ol>
<p>æç»"ä¸­"è¿ä¸ªå­ç¬¦çUTF-8ç¼ç åºåæ¯<code>E4 B8 AD</code> ï¼ä¹å°±æ¯æä»¬æ¥å¸¸ä¸­ç»å¸¸çå°çUTF-8 åå­è¿å¶è¡¨ç¤º<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1084317/202602/1084317-20260203145918058-1028615964.png" class="lazyload"></p>
<h3 id="ç¼è§ä¸ºå®ä»¥aä¸¾ä¾">ç¼è§ä¸ºå®ï¼ä»¥"A"ä¸¾ä¾</h3>
<ol>
<li>ç¡®å®å­èæ°<br>
"A"çç ç¹ä¸º<code>U+0041</code>ï¼å¨<code>U+0000~U+007F</code>è®¿é®åï¼å ç¨1å­èã</li>
<li>åå­è¿å¶è½¬æ¢æäºè¿å¶<br>
<code>0041</code>è½¬æäºè¿å¶ï¼å¾å°<code>0100 0001</code><br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1084317/202602/1084317-20260203145351848-1171291894.png" class="lazyload"></li>
<li>æç§UTF-8æ¨¡æ¿æ ¼å¼å¡«å<br>
1å­èçæ¨¡æ¿æ ¼å¼ä¸º:<code>0xxxxxxx</code> (èµ·å§å­è)<br>
----å¾å°UTF-8ç¼ç :<code>01000001</code></li>
<li>äºè¿å¶è½¬æ¢æåå­è¿å¶<br>
å®éä¸åè½¬æ¢åæ¥ï¼åååäº<code>0041</code>ã</li>
</ol>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1084317/202602/1084317-20260203145839566-1987880418.png" class="lazyload"></p>
<blockquote>
<p>UTF-8 ä»¥ä¸ç§å¾<code>å·é¸¡åå·§å¦</code>çåæ³ ï¼å®ç°äºä¸ASCIIçå¼å®¹ã<br>
å ä¸ºASCIIåªå ç¨7bitï¼æé«ä½é»è®¤ä¸º0ï¼èUTF-8ï¼1å­èçæ¨¡æ¿ä¹æ¯0xxxxxxx ï¼ä»èå®ç°äºä¸ASCIIçå¼å®¹</p>
</blockquote>
<h2 id="åå°ä¸»é¢">åå°ä¸»é¢</h2>
<ol>
<li>
<p>UTF-8 ä¸å­å¨å¤§å°ç«¯é®é¢<br>
ç±äºUTF-8çå¯åé¿ç¼ç ä¸æ åçå­èæ ¼å¼ï¼æä»¥æ¯ä¸ªå­ç¬¦çæ ¼å¼æ¯åºå®çï¼ææç¡®çååé¡ºåºã<br>
æ¯å¦"ä¸­"çU+4E2Dï¼UTF-8ç¼ç æ¯<code>E4-B8-AD</code>ï¼ è¿ä¸ä¸ªå­èçé¡ºåºæ¯å¯ä¸ä¸åºå®çï¼è§£ææ¶å¦æé¡ºåºé¢ åï¼å°±ä¼è§£æå¤±è´¥ï¼æä»¥ä¸ç¨ç®¡å¤§ç«¯è¿æ¯å°ç«¯ï¼ä¸¥æ ¼æç§é¡ºåºè§£æå³å¯ã</p>
</li>
<li>
<p>UTF-8è½å¤èªæè§£æ/è¯å«ï¼æ éBOMä½ä¸ºç­¾å<br>
BOM è¿æä¸ä¸ªéå ä½ç¨ï¼ä½ä¸ºæä»¶ç¼ç ç âç­¾åâï¼å¸®å©è½¯ä»¶å¿«éè¯å« Unicode ç¼ç æ ¼å¼ãä½å¯¹äº UTF-8 èè¨ï¼è¿ç§ âç­¾åâ ä¹æ¯å¤ä½çã<br>
å ä¸ºè§£æè½¯ä»¶å¯ä»¥éè¿æ«æææ¬çäºè¿å¶åå®¹ï¼æ ¹æ®UTF-8çæ ¼å¼è§åï¼ï¼ä¸é¢æå°ç<code>0xxxxxxx</code>ã<code>110xxxxx</code>ç­ï¼ï¼ç´æ¥å¤æ­æä»¶æ¯å¦ä¸º UTF-8 ç¼ç ï¼æ éä¾èµæä»¶å¼å¤´ç BOM æ è®°</p>
</li>
</ol>
<h1 id="ä¸ºä»ä¹æutf-8-bomçå­å¨">ä¸ºä»ä¹æUTF-8 BOMçå­å¨ï¼</h1>
<p>UTF-8 BOMå¹¶éUnicodeå®æ¹æ åï¼èæ¯å¾®è½¯ä¸º<code>è§£å³å¼å®¹é®é¢èçä¸çåå²åè¢±</code>ã<br>
æ©æçWindowsé»è®¤ç¼ç æ¯ <strong>æ¬å°åANSI</strong>ï¼å®æ¯Windowsæ©æä¸ºééæ¬å°è¯­è¨è®¾è®¡çåå²ç¼ç æ¹æ¡ï¼å®åå¥½ä¸å¥½ï¼ä¸ºwindowså¨çåç«ä¸äºæ±é©¬åå³ï¼ä½æä¸ä¸ªè´å½çç¼ºç¹ï¼<code>æä»¶å¼å¤´æ²¡æä»»ä½ç¹æ®æ è¯</code>ã</p>
<blockquote>
<p>æ¯å¦ä¸­æç³»ç»é»è®¤ GBK/GB2312ï¼è±æç³»ç»é»è®¤ ISO-8859-1ï¼æ¥æç³»ç»é»è®¤ Shift_JISââ è¿äº ANSI ç¼ç é½æ¯æ æ è®°çå¤å­èç¼ç ï¼å UTF-8 ä¸æ ·ï¼æä»¶å¼å¤´æ²¡æä»»ä½ç¹æ®æ è¯ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1084317/202602/1084317-20260203155156921-956533767.png" class="lazyload"></p>
</blockquote>
<h2 id="ç¼è§ä¸ºå®-1">ç¼è§ä¸ºå®</h2>
<p>æ¯å¦ç¨æ·å¨è®°äºæ¬ä¸­åäºå­ç¬¦"ä¸­"ï¼ä¿å­ä¸º UTF-8ï¼æ  BOMï¼ï¼ä¸æ¬¡æå¼æ¶ï¼è®°äºæ¬æ²¡æä»»ä½æ è®°å¯ä»¥å¤æ­è¿æ¯ UTF-8ï¼å¯è½ä¼æç§<strong>ç³»ç»ANSI</strong> ï¼æ¯å¦GBKæ¥è§£æï¼å¯¼è´åºç°ä¹±ç ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1084317/202602/1084317-20260203154645356-2008774263.png" class="lazyload"></p>
<h1 id="ä¸ºä»ä¹ä¸­æå¨utf-16ä¸å ç¨2å­èåèå¨utf-8ä¸­å ç¨3å­èäº">ä¸ºä»ä¹ä¸­æå¨UTF-16ä¸å ç¨2å­èï¼åèå¨UTF-8ä¸­å ç¨3å­èäºï¼</h1>
<p><strong>ç®åæ¥è¯´ï¼å°±æ¯è¿æ°é®é¢ï¼UTF-8 çå­èæ°æ¯æç ç¹å®¹éåå±è®¾è®¡çï¼ä¸­æçç ç¹å¤§å°å³å®äºå®åªè½è½å¨ 3 å­èåºé´ã</strong><br>
æä»¬æ¥å¸¸ä½¿ç¨ç 99% ä»¥ä¸çä¸­æï¼ç ç¹é½å¨BMP å¹³é¢ç<code>U+4E00ï¼ä¸ï¼~U+9FA5ï¼é¾¥ï¼</code> åºé´ï¼<br>
èUTF-16çç¼ç è§åæ¯ï¼å¯¹BMPå¹³é¢å­ç¬¦ç´æ¥<code>ç¨2å­èç¼ç </code>,å¯¹SMPå¹³é¢<code>ç¨4å­èç¼ç </code>ãè<code>åå¥½è½å¨BMPçä¸­æç ç¹</code>èªç¶èç¶çå°±ä½¿ç¨2å­èç¼ç <br>
ä½UTF-8çç¼ç è§åæ¯æ ¹æ®Unicode ç ç¹çå¤§å°æ¥å³å®å­èæ°ï¼èä¸­æç<code>U+4E00~U+9FA5</code> åå¥½è½å¨äº<code>U+0800 ~ U+FFFF</code>è¿ä¸ª3å­èç ç¹çåºé´åï¼å æ­¤è¦éµå®3å­èç¼ç çè§åã</p>
<h2 id="ä¸ºä»ä¹utf-8ä¸æä¸­æè®¾è®¡ä¸º2å­è">ä¸ºä»ä¹UTF-8ä¸æä¸­æè®¾è®¡ä¸º2å­èï¼</h2>
<p>ä¸»è¦æ¯2å­èçUTF-8åºé´<code>U+0080 ~ U+07FF</code>å®¹éæéï¼è£ä¸ä¸è¿ä¹å¤ä¸­æã<br>
2å­èçUTF-8 å»æåé¢ç110ï¼10 æ è¯ä½ï¼åªå©ä¸5+6=11ä½çææå®¹éï¼åªè½è¡¨ç¤º2^11=2048ä¸ªç ç¹ï¼å®¹çº³ä¸ä¸ä¸­æãåªæ3å­èçææå®¹éæ¯4+6+6=16 ï¼å¯ä»¥è¡¨ç¤º2^16=65536ä¸ªç ç¹ï¼åå¥½è¦çæ´ä¸ª BMP å¹³é¢ï¼è¶³ä»¥å®¹çº³ææä¸­æå¸¸ç¨å­ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-03 16:14">2026-02-03 16:14</span>&nbsp;
<a href="https://www.cnblogs.com/lmy5215006">å«æå®ä¸ç</a>&nbsp;
éè¯»(<span id="post_view_count">82</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19567495);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19567495', targetLink: 'https://www.cnblogs.com/lmy5215006/p/19567495', title: 'å­ç¬¦ç¼ç ç¥å¤å°(äº)' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Qt æå·§ç¬è®° (äº) Qtæ¶æ¯æ¡ï¼QMessageBoxï¼çå¨é¢ä½¿ç¨æå ]]></title>
    <link>https://www.cnblogs.com/GeophysicsWorker/p/19569909</link>
    <guid>15e8d4fc2c36ea25f46575222b1b2b1a</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/GeophysicsWorker/p/19569909" title="åå¸äº 2026-02-03 15:55">
    <span role="heading" aria-level="2">Qt æå·§ç¬è®° (äº) Qtæ¶æ¯æ¡ï¼QMessageBoxï¼çå¨é¢ä½¿ç¨æå</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="qt-æå·§ç¬è®°-äº---qtæ¶æ¯æ¡qmessageboxçå¨é¢ä½¿ç¨æå">Qt æå·§ç¬è®° (äº)   Qtæ¶æ¯æ¡ï¼QMessageBoxï¼çå¨é¢ä½¿ç¨æå</h1>
<p>â       å¨Qtæ¡æ¶å¼åä¸­ï¼æ¶æ¯æ¡ç»ä»¶(QMessageBox) æ¯å¤çç¨æ·äº¤äºçæ ¸å¿å·¥å·ãæ¬ç¬è®°ç³»ç»æ¢³çäºQMessageBoxç6ç§é¢å®ä¹ç±»åï¼éæè°ç¨ä¸å®ä¾åè°ç¨çå¯¹æ¯ï¼èªå®ä¹å®ç°æ¹æ³åå¸¸è§é®é¢è§£å³æ¹æ¡ï¼å¸®å©å¼åèå®ç°ç¨æ·æç¤ºåè½ã</p>
<p>â       <code>QMessageBox</code>æ¯Qtä¸­ç¨äº<strong>å¼¹åºå¯¹è¯æ¡æ¶æ¯</strong>çç±»ï¼ç»§æ¿äº<span class="math inline">\(QDialog\)</span>ï¼å¸¸ç¨äºæç¤ºæ¶æ¯ãè­¦åãéè¯¯ãç¡®è®¤ç­åºæ¯ï¼æ¯Qt GUIåºç¨å¼åä¸­éå¸¸å¸¸ç¨çç»ä»¶ä¹ä¸ãç¨äºå¼¹åºä¸ä¸ªæ¨¡å¼å¯¹è¯æ¡ï¼æ¨¡æçªå£ï¼ï¼æ¾ç¤ºæ¶æ¯ç»ç¨æ·ï¼å¹¶ç­å¾ç¨æ·ç¹å»æé®ï¼å¦âç¡®å®âã"åæ¶"ãâæ¯âãâå¦âç­ï¼ååç»§ç»­ç¨åºæ§è¡ãå¶æ ¸å¿ç¹å¾æ¯<strong>é»å¡äº¤äºå¼</strong>ï¼ç¨æ·å¿é¡»ååºå¯¹è¯æ¡ï¼ç¹å»æé®ï¼åï¼ç¨åºæä¼ç»§ç»­æ§è¡åç»­ä»£ç ã</p>
<p>â</p>
<h2 id="11-é¢å®ä¹æ¶æ¯æ¡ç±»å">1.1 é¢å®ä¹æ¶æ¯æ¡ç±»å</h2>
<p>Qtæä¾6ç§æ åæ¶æ¯ç±»åï¼éè¿éææ¹æ³å¿«éè°ç¨ï¼</p>
<table>
<thead>
<tr>
<th>ç±»å</th>
<th>è°ç¨æ¹æ³</th>
<th>éç¨åºæ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¶æ¯æç¤ºæ¡</td>
<td><code>QMessageBox::information()</code></td>
<td>æ®éä¿¡æ¯å±ç¤º</td>
</tr>
<tr>
<td>è­¦åæç¤ºæ¡</td>
<td><code>QMessageBox::warning()</code></td>
<td>æä½é£é©è­¦ç¤º</td>
</tr>
<tr>
<td>éè¯¯æç¤ºæ¡</td>
<td><code>QMessageBox::critical()</code></td>
<td>ä¸¥ééè¯¯è­¦ç¤º</td>
</tr>
<tr>
<td>ç¡®è®¤éæ©æ¡</td>
<td><code>QMessageBox::question()</code></td>
<td>äºéä¸å³ç­</td>
</tr>
<tr>
<td>å³äºå¯¹è¯æ¡</td>
<td>QMessageBox::about()</td>
<td>åºç¨ä¿¡æ¯æ©å±</td>
</tr>
<tr>
<td>çæ¬ä¿¡æ¯æ¡</td>
<td>QMessageBox::aboutQt()</td>
<td>Qtçæ¬è¯´æ</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>å¶å¸åè°ç¨æ¡ä¾ï¼</p>
<p>1.æ¾ç¤ºä¿¡æ¯æç¤ºæ¡ï¼informationï¼</p>
<pre><code class="language-C++">QMessageBox::information(this, "æ é¢", "è¿æ¯ä¸ä¸ªä¿¡æ¯æç¤ºæ¡");
</code></pre>
<p>2.è­¦åçªï¼warningï¼</p>
<pre><code class="language-C++">QMessageBox::warning(this,"è­¦å","è¿æ¯ä¸ä¸ªè­¦åæ¡");
</code></pre>
<p>3.éè¯¯æ¡ï¼critialï¼</p>
<pre><code class="language-C++">QMessageBox::critical(this,"éè¯¯","åºç°äºä¸¥éçéè¯¯");
</code></pre>
<p>4.æé®æ¡ï¼questionï¼</p>
<pre><code class="language-C++">    int ret = QMessageBox::question(nullptr, ("MyNoteBook Notice:"),
                                    ("The document has been modified.\n"
                                     "Do you want to save your changes?"),
                                    QMessageBox::Save | QMessageBox::Discard
                                    | QMessageBox::Cancel, /*æé®çå±æ§*/
                                    QMessageBox::Save); /*é»è®¤æé®æä¸*/
    switch (ret)
    {
    case QMessageBox::Save:
        qDebug()&lt;&lt;"QMessageBox::Save";
        break;
    case QMessageBox::Discard:
        qDebug()&lt;&lt;"QMessageBox::Discard";
        break;
    case QMessageBox::Cancel:
        qDebug()&lt;&lt;"QMessageBox::Cancel";
        break;
     default:
        break;
    }
</code></pre>
<p>å¶ä¸­æé®ç±»åï¼QMessage::StandardButtonï¼</p>
<table>
<thead>
<tr>
<th>æé®æä¸¾å¼</th>
<th>æ¾ç¤ºåå®¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>QMessageBox::Ok</code></td>
<td>ç¡®å®</td>
</tr>
<tr>
<td><code>QMessageBox::Cancel</code></td>
<td>åæ¶</td>
</tr>
<tr>
<td><code>QMessageBox::Yes</code></td>
<td>æ¯</td>
</tr>
<tr>
<td><code>QMessageBox::No</code></td>
<td>å¦</td>
</tr>
<tr>
<td><code>QMessageBox::Abort</code></td>
<td>ç»æ­¢</td>
</tr>
<tr>
<td><code>QMessageBox::Retry</code></td>
<td>éè¯</td>
</tr>
<tr>
<td><code>QMessageBox::Ignore</code></td>
<td>å¿½ç¥</td>
</tr>
</tbody>
</table>
<h2 id="12-éæè°ç¨ä¸å®ä¾åè°ç¨å¯¹æ¯">1.2 éæè°ç¨ä¸å®ä¾åè°ç¨å¯¹æ¯</h2>
<table>
<thead>
<tr>
<th>ç¹æ§</th>
<th>éæè°ç¨</th>
<th>å®ä¾åè°ç¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>è¯­æ³å½¢å¼</td>
<td><code>QMessageBox::type(parent, ...)</code></td>
<td><code>QMessageBox box; box.setXXX(...)</code></td>
</tr>
<tr>
<td>å®å¶è½å</td>
<td>ä»æ¯æé¢è®¾æé®/å¾æ </td>
<td>æ¯æå®æ´UIå®å¶</td>
</tr>
<tr>
<td>çº¿ç¨é»å¡</td>
<td>èªå¨æ¨¡ææ¾ç¤º</td>
<td>éæå¨è°ç¨exec()</td>
</tr>
<tr>
<td>å¸ååºæ¯</td>
<td>å¿«éå®ç°ç®åæç¤º</td>
<td>å¤æäº¤äºéæ±</td>
</tr>
</tbody>
</table>
<p>å¶ä¸­å¾æ å®å¶ç±»åå¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>å¾æ ç±»å</th>
<th>å«   ä¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>QMessageBox::NoIcon</code></td>
<td>æ å¾æ </td>
</tr>
<tr>
<td><code>QMessageBox::Information</code></td>
<td>ä¿¡æ¯å¾æ ï¼â¹ï¸ï¼</td>
</tr>
<tr>
<td><code>QMessageBox::Warning</code></td>
<td>è­¦åå¾æ ï¼â ï¼</td>
</tr>
<tr>
<td><code>QMessageBox::Critical</code></td>
<td>éè¯¯å¾æ ï¼âï¼</td>
</tr>
<tr>
<td><code>QMessageBox::Question</code></td>
<td>é®å·å¾æ ï¼âï¼</td>
</tr>
</tbody>
</table>
<h2 id="13-æ·±åº¦å®å¶å®ç°æ¹æ¡">1.3 æ·±åº¦å®å¶å®ç°æ¹æ¡</h2>
<p>å¯¹è¯æ¡çå³é®å®å¶æ¹æ³ï¼</p>
<table>
<thead>
<tr>
<th>æ¹æ³</th>
<th>åè½è¯´æ</th>
<th>åæ°è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>setWindowTitle()</code></td>
<td>è®¾ç½®å¯¹è¯æ¡æ é¢</td>
<td><code>QString</code></td>
</tr>
<tr>
<td><code>setText()</code></td>
<td>è®¾ç½®ä¸»æç¤ºææ¬</td>
<td><code>QString</code></td>
</tr>
<tr>
<td>setIconPixmap()</td>
<td>è®¾ç½®èªå®ä¹å¾æ </td>
<td>QPixmap</td>
</tr>
<tr>
<td>addButton()</td>
<td>æ·»å èªå®ä¹æé®</td>
<td>(QString, ButtonRole)</td>
</tr>
<tr>
<td>setStyleSheet()</td>
<td>åºç¨CSSæ ·å¼</td>
<td>QString</td>
</tr>
</tbody>
</table>
<p>å®æ´èªå®ä¹ç¤ºä¾ï¼</p>
<pre><code class="language-C++">#include &lt;QMessageBox&gt;
#include &lt;QPushButton&gt;
#include &lt;QDebug&gt;

void showCustomMessageBox() {
    QMessageBox box;
    box.setWindowTitle("èªå®ä¹å¯¹è¯æ¡");
    box.setText("è¯·ç¡®è®¤æä½ï¼");
    
    // æ·»å èªå®ä¹æé®
    QPushButton *confirmBtn = box.addButton("ç¡®è®¤", QMessageBox::AcceptRole);
    QPushButton *cancelBtn = box.addButton("åæ¶", QMessageBox::RejectRole);
    
    // è®¾ç½®å¾æ ï¼æ¯æç¼©æ¾ï¼
    box.setIconPixmap(QPixmap(":/icons/warning.png").scaled(64, 64));
    
    // æ ·å¼å®å¶
    box.setStyleSheet(
        "QMessageBox { background-color: #f0f0f0; font-size: 14px; }"
        "QPushButton { min-width: 80px; min-height: 30px; }"
    );
    
    box.exec();
    
    if (box.clickedButton() == confirmBtn) {
        qDebug() &lt;&lt; "ç¨æ·ç¹å»äºç¡®è®¤";
    } else {
        qDebug() &lt;&lt; "ç¨æ·ç¹å»äºåæ¶";
    }
}
</code></pre>
<h2 id="14-é«çº§åºç¨åºæ¯">1.4 é«çº§åºç¨åºæ¯</h2>
<p><strong>å¨æåå®¹åæ¢</strong></p>
<pre><code class="language-C++">void showDynamicMessage(bool isSuccess) {
    QMessageBox box;
    box.setWindowTitle(isSuccess ? "æä½ç»æ" : "éè¯¯æç¤º");
    box.setText(isSuccess ? "æä½æåå®æ" : "æä½å¤±è´¥ï¼è¯·éè¯");
    box.setIcon(isSuccess ? QMessageBox::Information : QMessageBox::Critical);
    box.exec();
}
</code></pre>
<p><strong>å¤è¯­è¨æ¯æ</strong></p>
<pre><code class="language-C++">void showLocalizedMessage(QLocale locale) {
    QMessageBox box;
    if (locale == QLocale::Chinese) {
        box.setWindowTitle("æç¤º");
        box.setText("ç¡®å®è¦æ§è¡æ­¤æä½åï¼");
    } else {
        box.setWindowTitle("Warning");
        box.setText("Are you sure to proceed?");
    }
    box.exec();
}
</code></pre>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-03 15:56">2026-02-03 15:55</span>&nbsp;
<a href="https://www.cnblogs.com/GeophysicsWorker">GeoFXR</a>&nbsp;
éè¯»(<span id="post_view_count">76</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19569909);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19569909', targetLink: 'https://www.cnblogs.com/GeophysicsWorker/p/19569909', title: 'Qt æå·§ç¬è®° (äº) Qtæ¶æ¯æ¡ï¼QMessageBoxï¼çå¨é¢ä½¿ç¨æå' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ asp.net coreå¦ä½å®ç°Controllerç­æ´æ° ]]></title>
    <link>https://www.cnblogs.com/kevin-Y/p/19569791</link>
    <guid>599a17dab63c0d755c629295cf7e4d0f</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/kevin-Y/p/19569791" title="åå¸äº 2026-02-03 15:41">
    <span role="heading" aria-level="2">asp.net coreå¦ä½å®ç°Controllerç­æ´æ°</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>å¯è½æ¯ä»¥å¾çä¹ æ¯ï¼æå¸æçäº§ç¯å¢çæå¡å¯ä»¥ç­æ´æ°ãæäººä¼è¯´Dockerï¼å¯æå¸æè½æ´ç®åä¸äºãæä»¥ä¸ç´å³æ³¨asp.net coreå¦ä½ç­æ´æ°</p>
<p>æ©åè¯»è¿è¿æç« ï¼å·¥ä½å³ç³»æ²¡æç»§ç»­å­¦ä¹ ãä»å¤©éå°ä¸ä¸ªå³é®é®é¢ï¼è¿æ¯è¿æç« å¯åäºæã</p>
<p><a href="https://www.cnblogs.com/artech/p/dynamic-controllers.html" target="_blank">https://www.cnblogs.com/artech/p/dynamic-controllers.html</a></p>
<p>ç¬¬ä¸æ­¥ï¼dlléè¦å¨ä½¿ç¨åï¼ä¾ç¶å¯ä»¥è¢«ä¿®æ¹åæ¿æ¢ãæä»¬éè¦ä¸ä¸ªç»§æ¿èªAssemblyLoadContextçç±»</p>
<div class="cnblogs_code"><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" id="code_img_closed_358157ef-9bd8-48a3-99bd-62e649904895" class="code_img_closed"><img src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" id="code_img_opened_358157ef-9bd8-48a3-99bd-62e649904895" class="code_img_opened" style="display: none">
<div id="cnblogs_code_open_358157ef-9bd8-48a3-99bd-62e649904895" class="cnblogs_code_hide">
<pre><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;summary&gt;</span>
<span style="color: rgba(128, 128, 128, 1)">///</span><span style="color: rgba(0, 128, 0, 1)"> æ¯æçæ­£å¸è½½çæä»¶å è½½ä¸ä¸æ
</span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;/summary&gt;</span>
<span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> CollectiblePluginLoadContext : AssemblyLoadContext
{
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span> <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> _pluginPath;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span> <span style="color: rgba(0, 0, 255, 1)">string</span>?<span style="color: rgba(0, 0, 0, 1)"> _pluginDirectory;

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> CollectiblePluginLoadContext(<span style="color: rgba(0, 0, 255, 1)">string</span> pluginPath) : <span style="color: rgba(0, 0, 255, 1)">base</span>(isCollectible: <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        _pluginPath </span>=<span style="color: rgba(0, 0, 0, 1)"> pluginPath;
        _pluginDirectory </span>=<span style="color: rgba(0, 0, 0, 1)"> Path.GetDirectoryName(pluginPath);
    }

    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">override</span> Assembly?<span style="color: rgba(0, 0, 0, 1)"> Load(AssemblyName assemblyName)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å°è¯ä»æä»¶ç®å½å è½½ä¾èµé¡¹</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> (!<span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.IsNullOrEmpty(_pluginDirectory))
        {
            </span><span style="color: rgba(0, 0, 255, 1)">var</span> assemblyPath = Path.Combine(_pluginDirectory, assemblyName.Name + <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">.dll</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
            
            </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> (File.Exists(assemblyPath))
            {
                </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä½¿ç¨æµå è½½é¿åéå®ä¾èµDLLæä»¶</span>
                <span style="color: rgba(0, 0, 255, 1)">using</span> <span style="color: rgba(0, 0, 255, 1)">var</span> fileStream = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> FileStream(assemblyPath, FileMode.Open, FileAccess.Read, FileShare.Read);
                </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> LoadFromStream(fileStream);
            }
        }
        
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¦æå¨æä»¶ç®å½ä¸­æ¾ä¸å°ï¼åè¿ånullï¼è®©é»è®¤ä¸ä¸æå¤ç</span>
        <span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">override</span> IntPtr LoadUnmanagedDll(<span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> unmanagedDllName)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å°è¯ä»æä»¶ç®å½å è½½éæç®¡DLL</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> (!<span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.IsNullOrEmpty(_pluginDirectory))
        {
            </span><span style="color: rgba(0, 0, 255, 1)">var</span> unmanagedDllPath = Path.Combine(_pluginDirectory, unmanagedDllName + <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">.dll</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
            
            </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> (File.Exists(unmanagedDllPath))
            {
                </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¯¹äºéæç®¡DLLï¼ä»ç¶éè¦ä½¿ç¨è·¯å¾å è½½
                </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä½å¯ä»¥å¨å è½½åç«å³å³é­å¥æä»¥åå°éå®</span>
                <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> LoadUnmanagedDllFromPath(unmanagedDllPath);
            }
        }
        
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¦æå¨æä»¶ç®å½ä¸­æ¾ä¸å°ï¼åè¿åé¶ï¼è®©é»è®¤ä¸ä¸æå¤ç</span>
        <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> IntPtr.Zero;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> Assembly LoadPluginAssembly()
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä½¿ç¨æµå è½½é¿åéå®DLLæä»¶</span>
        <span style="color: rgba(0, 0, 255, 1)">using</span> <span style="color: rgba(0, 0, 255, 1)">var</span> fileStream = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> FileStream(_pluginPath, FileMode.Open, FileAccess.Read, FileShare.Read);
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> LoadFromStream(fileStream);
    }
}</span></pre>
</div>
<span class="cnblogs_code_collapse">CollectiblePluginLoadContext </span></div>
<p>ç¬¬äºæ­¥ï¼ApplicationPartManageræ·»å å¨æå è½½çAssemblyã</p>
<p>ä¸å¼å§æä»¥ä¸ºå å¥åç§»é¤å°±è½å®æ´ç­å è½½</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä»åºç¨é¨ä»¶ç®¡çå¨ä¸­ç§»é¤ç¨åºé</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> partToRemove =<span style="color: rgba(0, 0, 0, 1)"> _partManager.ApplicationParts
    .OfType</span>&lt;AssemblyPart&gt;<span style="color: rgba(0, 0, 0, 1)">()
    .FirstOrDefault(p </span>=&gt; p.Assembly ==<span style="color: rgba(0, 0, 0, 1)"> assembly);

</span><span style="color: rgba(0, 0, 255, 1)">if</span> (partToRemove != <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">)
{
    _partManager.ApplicationParts.Remove(partToRemove);
}<br></span></pre>
<pre>// å°ç¨åºéæ·»å å°åºç¨é¨ä»¶ç®¡çå¨
var assemblyPart = new<span> AssemblyPart(assembly);
_partManager.ApplicationParts.Add(assemblyPart);</span></pre>
</div>
<p>å®éä¸ä¸è½ï¼å¦ä¸å¼å¤´çæç« è¯´å°ç</p>
<div class="cnblogs_code">
<pre>...ä½æ¯MVCé»è®¤æåµä¸å¯¹æä¾çActionDescriptorå¯¹è±¡è¿è¡äºç¼å­ã<br>å¦ææ¡æ¶è½å¤ä½¿ç¨æ°çActionDescriptorå¯¹è±¡ï¼éè¦åè¯å®å½ååºç¨æä¾çActionDescriptoråè¡¨åçäºæ¹åï¼èè¿å¯ä»¥å©ç¨èªå®ä¹çIActionDescriptorChangeProvideræ¥å®ç°ã<br>ä¸ºæ­¤æä»¬å®ä¹äºå¦ä¸è¿ä¸ªDynamicChangeTokenProviderç±»åï¼è¯¥ç±»åå®ç°äºIActionDescriptorChangeProvideræ¥å£ï¼å¹¶å©ç¨GetChangeTokenæ¹æ³è¿åIChangeTokenå¯¹è±¡éç¥<br>MVCæ¡æ¶å½åçActionDescriptorå·²ç»åçæ¹åãä»å®ç°å®ç°ä»£ç å¯ä»¥çåºï¼å½æä»¬è°ç¨NotifyChangesæ¹æ³çæ¶åï¼ç¶ææ¹åéç¥ä¼è¢«ååºå»ã</pre>
</div>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> DynamicChangeTokenProvider : IActionDescriptorChangeProvider
{
    </span><span style="color: rgba(0, 0, 255, 1)">private</span><span style="color: rgba(0, 0, 0, 1)"> CancellationTokenSource _source;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span><span style="color: rgba(0, 0, 0, 1)"> CancellationChangeToken _token;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> DynamicChangeTokenProvider()
    {
        _source </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> CancellationTokenSource();
        _token </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> CancellationChangeToken(_source.Token);
    }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> IChangeToken GetChangeToken() =&gt;<span style="color: rgba(0, 0, 0, 1)"> _token;

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> NotifyChanges()
    {
        </span><span style="color: rgba(0, 0, 255, 1)">var</span> old = Interlocked.Exchange(<span style="color: rgba(0, 0, 255, 1)">ref</span> _source, <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> CancellationTokenSource());
        _token </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> CancellationChangeToken(_source.Token);
        old.Cancel();
    }
}</span></pre>
</div>
<p>æäºèéæ¥ ï¼å¤§åèAï¼çä¸é¢çä»£ç ï¼äºæå°±å¥½åäºãä»¥ä¸æ¯æçProgram.csçä¸»è¦ä»£ç </p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ·»å MVCæå¡ä»¥æ¯æå¨ææ§å¶å¨</span>
<span style="color: rgba(0, 0, 0, 1)">builder.Services.AddControllers();

builder.Services.AddSingleton</span>&lt;DynamicChangeTokenProvider&gt;<span style="color: rgba(0, 0, 0, 1)">();
builder.Services.AddSingleton</span>&lt;IActionDescriptorChangeProvider&gt;(provider =&gt; provider.GetRequiredService&lt;DynamicChangeTokenProvider&gt;<span style="color: rgba(0, 0, 0, 1)">());

</span><span style="color: rgba(0, 0, 255, 1)">var</span> app =<span style="color: rgba(0, 0, 0, 1)"> builder.Build();</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå§åæ¹è¿çæä»¶ç®¡çå¨ï¼æ¯æçæ­£å¸è½½ï¼</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> partManager = app.Services.GetRequiredService&lt;ApplicationPartManager&gt;<span style="color: rgba(0, 0, 0, 1)">();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> tokenProvider = app.Services.GetRequiredService&lt;DynamicChangeTokenProvider&gt;<span style="color: rgba(0, 0, 0, 1)">();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> improvedPluginManager = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ImprovedPluginManager(partManager, tokenProvider);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> é¢å è½½å·²å­å¨çæä»¶</span>
<span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> improvedPluginManager.LoadAllPluginsAsync();
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ å°æ§å¶å¨è·¯ç±</span>
<span style="color: rgba(0, 0, 0, 1)">app.MapControllers();
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> é»è®¤æ ¹è·¯å¾</span>
app.MapGet(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">/</span><span style="color: rgba(128, 0, 0, 1)">"</span>, () =&gt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Dynamic Controller Demo Running!</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éæ°å è½½æææä»¶ç«¯ç¹</span>
app.MapPost(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">/reload-plugins</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(0, 0, 255, 1)">async</span> () =&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> improvedPluginManager.LoadAllPluginsAsync();
    </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Plugins reloaded with true unloading</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
});
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è·åå·²å è½½æä»¶åè¡¨</span>
app.MapGet(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">/loaded-plugins</span><span style="color: rgba(128, 0, 0, 1)">"</span>, () =&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> improvedPluginManager.GetLoadedPlugins();
});</span></pre>
</div>
<p>å¥½äºãç¨åºè·èµ·æ¥ãä¸»ç¨åºæ²¡æControllerçå®ç°ãç¨åºæä¾çWebApiï¼ç±pluginç®å½ä¸­çdllæåå«Controllerå³å®ãè³æ­¤æå¾çurlæ­£å¸¸ååºäºãå°æ°çdllæ·è´å°pluginç®å½ï¼æ¿æ¢æ§çï¼postä¸ä¸</p>
<pre>/reload-plugins</pre>
<p>WebApiä¹è¢«æ°çç¨åºååºäºãå½ç¶æä»¬ä¹å¯ä»¥çè§ä¸ä¸pluginç®å½ï¼ææä»¶ä¿®æ¹æ¶èªå¨å è½½ã</p>
<p>éä¸ImprovedPluginManager.csçæºä»£ç </p>
<div class="cnblogs_code"><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" id="code_img_closed_c74a20f6-a571-4d10-be21-2a34e693262f" class="code_img_closed"><img src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" id="code_img_opened_c74a20f6-a571-4d10-be21-2a34e693262f" class="code_img_opened" style="display: none">
<div id="cnblogs_code_open_c74a20f6-a571-4d10-be21-2a34e693262f" class="cnblogs_code_hide">
<pre><span style="color: rgba(0, 128, 128, 1)">  1</span> <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> ImprovedPluginManager
</span><span style="color: rgba(0, 128, 128, 1)">  2</span> <span style="color: rgba(0, 0, 0, 1)">{
</span><span style="color: rgba(0, 128, 128, 1)">  3</span>     <span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> ApplicationPartManager _partManager;
</span><span style="color: rgba(0, 128, 128, 1)">  4</span>     <span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span> Dictionary&lt;<span style="color: rgba(0, 0, 255, 1)">string</span>, (CollectiblePluginLoadContext context, Assembly assembly)&gt;<span style="color: rgba(0, 0, 0, 1)"> _loadedPlugins;
</span><span style="color: rgba(0, 128, 128, 1)">  5</span>     <span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span> List&lt;PluginInfo&gt;<span style="color: rgba(0, 0, 0, 1)"> _pluginInfos;
</span><span style="color: rgba(0, 128, 128, 1)">  6</span>     <span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span> <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> _pluginsDirectory;
</span><span style="color: rgba(0, 128, 128, 1)">  7</span>     <span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> DynamicChangeTokenProvider _tokenProvider;
</span><span style="color: rgba(0, 128, 128, 1)">  8</span> 
<span style="color: rgba(0, 128, 128, 1)">  9</span>     <span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> ImprovedPluginManager(ApplicationPartManager partManager, DynamicChangeTokenProvider tokenProvider)
</span><span style="color: rgba(0, 128, 128, 1)"> 10</span> <span style="color: rgba(0, 0, 0, 1)">    {
</span><span style="color: rgba(0, 128, 128, 1)"> 11</span>         _tokenProvider =<span style="color: rgba(0, 0, 0, 1)"> tokenProvider;
</span><span style="color: rgba(0, 128, 128, 1)"> 12</span>         _partManager =<span style="color: rgba(0, 0, 0, 1)"> partManager;
</span><span style="color: rgba(0, 128, 128, 1)"> 13</span>         _loadedPlugins = <span style="color: rgba(0, 0, 255, 1)">new</span> Dictionary&lt;<span style="color: rgba(0, 0, 255, 1)">string</span>, (CollectiblePluginLoadContext, Assembly)&gt;<span style="color: rgba(0, 0, 0, 1)">();
</span><span style="color: rgba(0, 128, 128, 1)"> 14</span>         _pluginInfos = <span style="color: rgba(0, 0, 255, 1)">new</span> List&lt;PluginInfo&gt;<span style="color: rgba(0, 0, 0, 1)">();
</span><span style="color: rgba(0, 128, 128, 1)"> 15</span>         
<span style="color: rgba(0, 128, 128, 1)"> 16</span>         <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è®¾ç½®æä»¶ç®å½</span>
<span style="color: rgba(0, 128, 128, 1)"> 17</span>         _pluginsDirectory = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Plugins</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)"> 18</span>         <span style="color: rgba(0, 0, 255, 1)">if</span> (!<span style="color: rgba(0, 0, 0, 1)">Directory.Exists(_pluginsDirectory))
</span><span style="color: rgba(0, 128, 128, 1)"> 19</span> <span style="color: rgba(0, 0, 0, 1)">        {
</span><span style="color: rgba(0, 128, 128, 1)"> 20</span> <span style="color: rgba(0, 0, 0, 1)">            Directory.CreateDirectory(_pluginsDirectory);
</span><span style="color: rgba(0, 128, 128, 1)"> 21</span> <span style="color: rgba(0, 0, 0, 1)">        }
</span><span style="color: rgba(0, 128, 128, 1)"> 22</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)"> 23</span> 
<span style="color: rgba(0, 128, 128, 1)"> 24</span>     <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">async</span> Task&lt;<span style="color: rgba(0, 0, 255, 1)">bool</span>&gt; LoadPluginAsync(<span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> pluginPath)
</span><span style="color: rgba(0, 128, 128, 1)"> 25</span> <span style="color: rgba(0, 0, 0, 1)">    {
</span><span style="color: rgba(0, 128, 128, 1)"> 26</span>         <span style="color: rgba(0, 0, 255, 1)">try</span>
<span style="color: rgba(0, 128, 128, 1)"> 27</span> <span style="color: rgba(0, 0, 0, 1)">        {
</span><span style="color: rgba(0, 128, 128, 1)"> 28</span>             <span style="color: rgba(0, 0, 255, 1)">if</span> (!<span style="color: rgba(0, 0, 0, 1)">File.Exists(pluginPath))
</span><span style="color: rgba(0, 128, 128, 1)"> 29</span> <span style="color: rgba(0, 0, 0, 1)">            {
</span><span style="color: rgba(0, 128, 128, 1)"> 30</span>                 <span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> FileNotFoundException($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Plugin file not found: {pluginPath}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)"> 31</span> <span style="color: rgba(0, 0, 0, 1)">            }
</span><span style="color: rgba(0, 128, 128, 1)"> 32</span> 
<span style="color: rgba(0, 128, 128, 1)"> 33</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ£æ¥æä»¶æ©å±å</span>
<span style="color: rgba(0, 128, 128, 1)"> 34</span>             <span style="color: rgba(0, 0, 255, 1)">if</span> (!pluginPath.EndsWith(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">.dll</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, StringComparison.OrdinalIgnoreCase))
</span><span style="color: rgba(0, 128, 128, 1)"> 35</span> <span style="color: rgba(0, 0, 0, 1)">            {
</span><span style="color: rgba(0, 128, 128, 1)"> 36</span>                 <span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> ArgumentException(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Plugin must be a .dll file</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)"> 37</span> <span style="color: rgba(0, 0, 0, 1)">            }
</span><span style="color: rgba(0, 128, 128, 1)"> 38</span> 
<span style="color: rgba(0, 128, 128, 1)"> 39</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå»ºå¯æ¶éçå è½½ä¸ä¸æ</span>
<span style="color: rgba(0, 128, 128, 1)"> 40</span>             <span style="color: rgba(0, 0, 255, 1)">var</span> loadContext = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> CollectiblePluginLoadContext(pluginPath);
</span><span style="color: rgba(0, 128, 128, 1)"> 41</span>             
<span style="color: rgba(0, 128, 128, 1)"> 42</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å è½½ç¨åºé</span>
<span style="color: rgba(0, 128, 128, 1)"> 43</span>             <span style="color: rgba(0, 0, 255, 1)">var</span> assembly =<span style="color: rgba(0, 0, 0, 1)"> loadContext.LoadPluginAssembly();
</span><span style="color: rgba(0, 128, 128, 1)"> 44</span>             
<span style="color: rgba(0, 128, 128, 1)"> 45</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è·åæææ§å¶å¨ç±»å</span>
<span style="color: rgba(0, 128, 128, 1)"> 46</span>             <span style="color: rgba(0, 0, 255, 1)">var</span> controllerTypes =<span style="color: rgba(0, 0, 0, 1)"> assembly.GetTypes()
</span><span style="color: rgba(0, 128, 128, 1)"> 47</span>                 .Where(t =&gt; t.IsSubclassOf(<span style="color: rgba(0, 0, 255, 1)">typeof</span>(ControllerBase)) &amp;&amp; !<span style="color: rgba(0, 0, 0, 1)">t.IsAbstract)
</span><span style="color: rgba(0, 128, 128, 1)"> 48</span> <span style="color: rgba(0, 0, 0, 1)">                .ToList();
</span><span style="color: rgba(0, 128, 128, 1)"> 49</span> 
<span style="color: rgba(0, 128, 128, 1)"> 50</span>             <span style="color: rgba(0, 0, 255, 1)">if</span> (!<span style="color: rgba(0, 0, 0, 1)">controllerTypes.Any())
</span><span style="color: rgba(0, 128, 128, 1)"> 51</span> <span style="color: rgba(0, 0, 0, 1)">            {
</span><span style="color: rgba(0, 128, 128, 1)"> 52</span>                 <span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> InvalidOperationException($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">No controllers found in plugin: {pluginPath}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)"> 53</span> <span style="color: rgba(0, 0, 0, 1)">            }
</span><span style="color: rgba(0, 128, 128, 1)"> 54</span> 
<span style="color: rgba(0, 128, 128, 1)"> 55</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ£æ¥æ¯å¦å·²ç»å è½½äºç¸åçç¨åºé</span>
<span style="color: rgba(0, 128, 128, 1)"> 56</span>             <span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> (_loadedPlugins.ContainsKey(assembly.FullName))
</span><span style="color: rgba(0, 128, 128, 1)"> 57</span> <span style="color: rgba(0, 0, 0, 1)">            {
</span><span style="color: rgba(0, 128, 128, 1)"> 58</span>                 <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> UnloadPluginAsync(assembly.FullName);
</span><span style="color: rgba(0, 128, 128, 1)"> 59</span> <span style="color: rgba(0, 0, 0, 1)">            }
</span><span style="color: rgba(0, 128, 128, 1)"> 60</span> 
<span style="color: rgba(0, 128, 128, 1)"> 61</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å°ç¨åºéæ·»å å°åºç¨é¨ä»¶ç®¡çå¨</span>
<span style="color: rgba(0, 128, 128, 1)"> 62</span>             <span style="color: rgba(0, 0, 255, 1)">var</span> assemblyPart = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> AssemblyPart(assembly);
</span><span style="color: rgba(0, 128, 128, 1)"> 63</span> <span style="color: rgba(0, 0, 0, 1)">            _partManager.ApplicationParts.Add(assemblyPart);
</span><span style="color: rgba(0, 128, 128, 1)"> 64</span>             
<span style="color: rgba(0, 128, 128, 1)"> 65</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è®°å½å·²å è½½çæä»¶åä¸ä¸æ</span>
<span style="color: rgba(0, 128, 128, 1)"> 66</span>             _loadedPlugins[assembly.FullName] =<span style="color: rgba(0, 0, 0, 1)"> (loadContext, assembly);
</span><span style="color: rgba(0, 128, 128, 1)"> 67</span> 
<span style="color: rgba(0, 128, 128, 1)"> 68</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå»ºæä»¶ä¿¡æ¯</span>
<span style="color: rgba(0, 128, 128, 1)"> 69</span>             <span style="color: rgba(0, 0, 255, 1)">var</span> pluginInfo = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> PluginInfo
</span><span style="color: rgba(0, 128, 128, 1)"> 70</span> <span style="color: rgba(0, 0, 0, 1)">            {
</span><span style="color: rgba(0, 128, 128, 1)"> 71</span>                 Name =<span style="color: rgba(0, 0, 0, 1)"> Path.GetFileNameWithoutExtension(pluginPath),
</span><span style="color: rgba(0, 128, 128, 1)"> 72</span>                 Version = assembly.GetName().Version?.ToString() ?? <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Unknown</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
</span><span style="color: rgba(0, 128, 128, 1)"> 73</span>                 Description = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Dynamic controller plugin</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
</span><span style="color: rgba(0, 128, 128, 1)"> 74</span>                 FilePath =<span style="color: rgba(0, 0, 0, 1)"> pluginPath,
</span><span style="color: rgba(0, 128, 128, 1)"> 75</span>                 LoadedAt =<span style="color: rgba(0, 0, 0, 1)"> DateTime.Now,
</span><span style="color: rgba(0, 128, 128, 1)"> 76</span>                 ControllerTypes = controllerTypes.Select(t =&gt;<span style="color: rgba(0, 0, 0, 1)"> t.Name).ToList()
</span><span style="color: rgba(0, 128, 128, 1)"> 77</span> <span style="color: rgba(0, 0, 0, 1)">            };
</span><span style="color: rgba(0, 128, 128, 1)"> 78</span> 
<span style="color: rgba(0, 128, 128, 1)"> 79</span> <span style="color: rgba(0, 0, 0, 1)">            _pluginInfos.Add(pluginInfo);
</span><span style="color: rgba(0, 128, 128, 1)"> 80</span> 
<span style="color: rgba(0, 128, 128, 1)"> 81</span>             Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Successfully loaded plugin: {pluginPath}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)"> 82</span>             <span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> controller <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> controllerTypes)
</span><span style="color: rgba(0, 128, 128, 1)"> 83</span> <span style="color: rgba(0, 0, 0, 1)">            {
</span><span style="color: rgba(0, 128, 128, 1)"> 84</span>                 Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">  - Controller: {controller.Name}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)"> 85</span> <span style="color: rgba(0, 0, 0, 1)">            }
</span><span style="color: rgba(0, 128, 128, 1)"> 86</span> 
<span style="color: rgba(0, 128, 128, 1)"> 87</span>             <span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)"> 88</span> <span style="color: rgba(0, 0, 0, 1)">        }
</span><span style="color: rgba(0, 128, 128, 1)"> 89</span>         <span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (Exception ex)
</span><span style="color: rgba(0, 128, 128, 1)"> 90</span> <span style="color: rgba(0, 0, 0, 1)">        {
</span><span style="color: rgba(0, 128, 128, 1)"> 91</span>             Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Failed to load plugin: {ex.Message}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)"> 92</span>             <span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)"> 93</span> <span style="color: rgba(0, 0, 0, 1)">        }
</span><span style="color: rgba(0, 128, 128, 1)"> 94</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)"> 95</span> 
<span style="color: rgba(0, 128, 128, 1)"> 96</span>     <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">async</span> Task&lt;<span style="color: rgba(0, 0, 255, 1)">bool</span>&gt; UnloadPluginAsync(<span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> assemblyFullName)
</span><span style="color: rgba(0, 128, 128, 1)"> 97</span> <span style="color: rgba(0, 0, 0, 1)">    {
</span><span style="color: rgba(0, 128, 128, 1)"> 98</span>         <span style="color: rgba(0, 0, 255, 1)">try</span>
<span style="color: rgba(0, 128, 128, 1)"> 99</span> <span style="color: rgba(0, 0, 0, 1)">        {
</span><span style="color: rgba(0, 128, 128, 1)">100</span>             <span style="color: rgba(0, 0, 255, 1)">if</span> (!<span style="color: rgba(0, 0, 0, 1)">_loadedPlugins.ContainsKey(assemblyFullName))
</span><span style="color: rgba(0, 128, 128, 1)">101</span> <span style="color: rgba(0, 0, 0, 1)">            {
</span><span style="color: rgba(0, 128, 128, 1)">102</span>                 <span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">103</span> <span style="color: rgba(0, 0, 0, 1)">            }
</span><span style="color: rgba(0, 128, 128, 1)">104</span> 
<span style="color: rgba(0, 128, 128, 1)">105</span>             <span style="color: rgba(0, 0, 255, 1)">var</span> (loadContext, assembly) =<span style="color: rgba(0, 0, 0, 1)"> _loadedPlugins[assemblyFullName];
</span><span style="color: rgba(0, 128, 128, 1)">106</span> 
<span style="color: rgba(0, 128, 128, 1)">107</span>             
<span style="color: rgba(0, 128, 128, 1)">108</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä»åºç¨é¨ä»¶ç®¡çå¨ä¸­ç§»é¤ç¨åºé</span>
<span style="color: rgba(0, 128, 128, 1)">109</span>             <span style="color: rgba(0, 0, 255, 1)">var</span> partToRemove =<span style="color: rgba(0, 0, 0, 1)"> _partManager.ApplicationParts
</span><span style="color: rgba(0, 128, 128, 1)">110</span>                 .OfType&lt;AssemblyPart&gt;<span style="color: rgba(0, 0, 0, 1)">()
</span><span style="color: rgba(0, 128, 128, 1)">111</span>                 .FirstOrDefault(p =&gt; p.Assembly ==<span style="color: rgba(0, 0, 0, 1)"> assembly);
</span><span style="color: rgba(0, 128, 128, 1)">112</span> 
<span style="color: rgba(0, 128, 128, 1)">113</span>             <span style="color: rgba(0, 0, 255, 1)">if</span> (partToRemove != <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)">114</span> <span style="color: rgba(0, 0, 0, 1)">            {
</span><span style="color: rgba(0, 128, 128, 1)">115</span> <span style="color: rgba(0, 0, 0, 1)">                _partManager.ApplicationParts.Remove(partToRemove);
</span><span style="color: rgba(0, 128, 128, 1)">116</span> <span style="color: rgba(0, 0, 0, 1)">            }
</span><span style="color: rgba(0, 128, 128, 1)">117</span> 
<span style="color: rgba(0, 128, 128, 1)">118</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä»å·²å è½½æä»¶åè¡¨ä¸­ç§»é¤</span>
<span style="color: rgba(0, 128, 128, 1)">119</span> <span style="color: rgba(0, 0, 0, 1)">            _loadedPlugins.Remove(assemblyFullName);
</span><span style="color: rgba(0, 128, 128, 1)">120</span> 
<span style="color: rgba(0, 128, 128, 1)">121</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä»æä»¶ä¿¡æ¯åè¡¨ä¸­ç§»é¤</span>
<span style="color: rgba(0, 128, 128, 1)">122</span>             <span style="color: rgba(0, 0, 255, 1)">var</span> pluginInfo = _pluginInfos.FirstOrDefault(p =&gt; p.FilePath ==<span style="color: rgba(0, 0, 0, 1)"> assembly.Location);
</span><span style="color: rgba(0, 128, 128, 1)">123</span>             <span style="color: rgba(0, 0, 255, 1)">if</span> (pluginInfo != <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)">124</span> <span style="color: rgba(0, 0, 0, 1)">            {
</span><span style="color: rgba(0, 128, 128, 1)">125</span> <span style="color: rgba(0, 0, 0, 1)">                _pluginInfos.Remove(pluginInfo);
</span><span style="color: rgba(0, 128, 128, 1)">126</span> <span style="color: rgba(0, 0, 0, 1)">            }
</span><span style="color: rgba(0, 128, 128, 1)">127</span> 
<span style="color: rgba(0, 128, 128, 1)">128</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¸è½½å è½½ä¸ä¸æ</span>
<span style="color: rgba(0, 128, 128, 1)">129</span> <span style="color: rgba(0, 0, 0, 1)">            loadContext.Unload();
</span><span style="color: rgba(0, 128, 128, 1)">130</span>             
<span style="color: rgba(0, 128, 128, 1)">131</span>             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¼ºå¶åå¾åæ¶ä»¥éæ¾ç¨åºé</span>
<span style="color: rgba(0, 128, 128, 1)">132</span> <span style="color: rgba(0, 0, 0, 1)">            GC.Collect();
</span><span style="color: rgba(0, 128, 128, 1)">133</span> <span style="color: rgba(0, 0, 0, 1)">            GC.WaitForPendingFinalizers();
</span><span style="color: rgba(0, 128, 128, 1)">134</span> 
<span style="color: rgba(0, 128, 128, 1)">135</span>             Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">=== UNLOAD DIAGNOSTICS ===</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">136</span>             Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Successfully unloaded plugin: {assemblyFullName}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">137</span>             Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Assembly location: {assembly.Location}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">138</span>             Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Loaded plugins count after unload: {_loadedPlugins.Count}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">139</span>             Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Plugin infos count after unload: {_pluginInfos.Count}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">140</span>             Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Application parts count after unload: {_partManager.ApplicationParts.Count}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">141</span>             Console.WriteLine(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">========================</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">142</span>             <span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">143</span> <span style="color: rgba(0, 0, 0, 1)">        }
</span><span style="color: rgba(0, 128, 128, 1)">144</span>         <span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (Exception ex)
</span><span style="color: rgba(0, 128, 128, 1)">145</span> <span style="color: rgba(0, 0, 0, 1)">        {
</span><span style="color: rgba(0, 128, 128, 1)">146</span>             Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Failed to unload plugin: {ex.Message}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">147</span>             <span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">148</span> <span style="color: rgba(0, 0, 0, 1)">        }
</span><span style="color: rgba(0, 128, 128, 1)">149</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">150</span> 
<span style="color: rgba(0, 128, 128, 1)">151</span>     <span style="color: rgba(0, 0, 255, 1)">public</span> List&lt;PluginInfo&gt;<span style="color: rgba(0, 0, 0, 1)"> GetLoadedPlugins()
</span><span style="color: rgba(0, 128, 128, 1)">152</span> <span style="color: rgba(0, 0, 0, 1)">    {
</span><span style="color: rgba(0, 128, 128, 1)">153</span>         <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> _pluginInfos.ToList();
</span><span style="color: rgba(0, 128, 128, 1)">154</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">155</span> 
<span style="color: rgba(0, 128, 128, 1)">156</span>     <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">async</span> Task&lt;List&lt;FileInfo&gt;&gt;<span style="color: rgba(0, 0, 0, 1)"> ScanPluginFilesAsync()
</span><span style="color: rgba(0, 128, 128, 1)">157</span> <span style="color: rgba(0, 0, 0, 1)">    {
</span><span style="color: rgba(0, 128, 128, 1)">158</span>         <span style="color: rgba(0, 0, 255, 1)">var</span> pluginDirInfo = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> DirectoryInfo(_pluginsDirectory);
</span><span style="color: rgba(0, 128, 128, 1)">159</span>         <span style="color: rgba(0, 0, 255, 1)">if</span> (!<span style="color: rgba(0, 0, 0, 1)">pluginDirInfo.Exists)
</span><span style="color: rgba(0, 128, 128, 1)">160</span> <span style="color: rgba(0, 0, 0, 1)">        {
</span><span style="color: rgba(0, 128, 128, 1)">161</span>             <span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(0, 0, 255, 1)">new</span> List&lt;FileInfo&gt;<span style="color: rgba(0, 0, 0, 1)">();
</span><span style="color: rgba(0, 128, 128, 1)">162</span> <span style="color: rgba(0, 0, 0, 1)">        }
</span><span style="color: rgba(0, 128, 128, 1)">163</span> 
<span style="color: rgba(0, 128, 128, 1)">164</span>         <span style="color: rgba(0, 0, 255, 1)">var</span> dllFiles = pluginDirInfo.GetFiles(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">*.dll</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, SearchOption.AllDirectories);
</span><span style="color: rgba(0, 128, 128, 1)">165</span>         <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> dllFiles.ToList();
</span><span style="color: rgba(0, 128, 128, 1)">166</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">167</span> 
<span style="color: rgba(0, 128, 128, 1)">168</span>     <span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">async</span> Task&lt;<span style="color: rgba(0, 0, 255, 1)">bool</span>&gt;<span style="color: rgba(0, 0, 0, 1)"> LoadAllPluginsAsync()
</span><span style="color: rgba(0, 128, 128, 1)">169</span> <span style="color: rgba(0, 0, 0, 1)">    {
</span><span style="color: rgba(0, 128, 128, 1)">170</span>         <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå¸è½½ææå·²å è½½çæä»¶</span>
<span style="color: rgba(0, 128, 128, 1)">171</span>         <span style="color: rgba(0, 0, 255, 1)">var</span> assembliesToUnload =<span style="color: rgba(0, 0, 0, 1)"> _loadedPlugins.Keys.ToList();
</span><span style="color: rgba(0, 128, 128, 1)">172</span>         <span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> assemblyName <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> assembliesToUnload)
</span><span style="color: rgba(0, 128, 128, 1)">173</span> <span style="color: rgba(0, 0, 0, 1)">        {
</span><span style="color: rgba(0, 128, 128, 1)">174</span>             <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> UnloadPluginAsync(assemblyName);
</span><span style="color: rgba(0, 128, 128, 1)">175</span> <span style="color: rgba(0, 0, 0, 1)">        }
</span><span style="color: rgba(0, 128, 128, 1)">176</span>         
<span style="color: rgba(0, 128, 128, 1)">177</span>         <span style="color: rgba(0, 0, 255, 1)">var</span> pluginFiles = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> ScanPluginFilesAsync();
</span><span style="color: rgba(0, 128, 128, 1)">178</span>         <span style="color: rgba(0, 0, 255, 1)">var</span> successCount = <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">179</span> 
<span style="color: rgba(0, 128, 128, 1)">180</span>         <span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> pluginFile <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> pluginFiles)
</span><span style="color: rgba(0, 128, 128, 1)">181</span> <span style="color: rgba(0, 0, 0, 1)">        {
</span><span style="color: rgba(0, 128, 128, 1)">182</span>             <span style="color: rgba(0, 0, 255, 1)">if</span> (<span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> LoadPluginAsync(pluginFile.FullName))
</span><span style="color: rgba(0, 128, 128, 1)">183</span> <span style="color: rgba(0, 0, 0, 1)">            {
</span><span style="color: rgba(0, 128, 128, 1)">184</span>                 successCount++<span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">185</span> <span style="color: rgba(0, 0, 0, 1)">            }
</span><span style="color: rgba(0, 128, 128, 1)">186</span> <span style="color: rgba(0, 0, 0, 1)">        }
</span><span style="color: rgba(0, 128, 128, 1)">187</span> <span style="color: rgba(0, 0, 0, 1)">        _tokenProvider.NotifyChanges();
</span><span style="color: rgba(0, 128, 128, 1)">188</span>         Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Loaded {successCount} out of {pluginFiles.Count} plugins</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">189</span>         <span style="color: rgba(0, 0, 255, 1)">return</span> successCount &gt; <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">190</span> <span style="color: rgba(0, 0, 0, 1)">    }
</span><span style="color: rgba(0, 128, 128, 1)">191</span> }</pre>
</div>
<span class="cnblogs_code_collapse">ImprovedPluginManager</span></div>
<p>å¦æéè¯¯è¯·ææ­£ã</p>
<p>&nbsp;</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-03 15:41">2026-02-03 15:41</span>&nbsp;
<a href="https://www.cnblogs.com/kevin-Y">çå½ä½éªä¹kevin-Y</a>&nbsp;
éè¯»(<span id="post_view_count">198</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19569791);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19569791', targetLink: 'https://www.cnblogs.com/kevin-Y/p/19569791', title: 'asp.net coreå¦ä½å®ç°Controllerç­æ´æ°' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ææ°ï¼é¶æ²³éºéºv11 kubeadmé¨ç½²k8s v1.35.0é«å¯ç¨éç¾¤ ]]></title>
    <link>https://www.cnblogs.com/v-fan/p/19569414</link>
    <guid>be367c922cd014e92395f83b29b7f8f8</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/v-fan/p/19569414" title="åå¸äº 2026-02-03 14:57">
    <span role="heading" aria-level="2">ææ°ï¼é¶æ²³éºéºv11 kubeadmé¨ç½²k8s v1.35.0é«å¯ç¨éç¾¤</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="é¶æ²³éºéºv11-kubeadmé¨ç½²k8s-v1350é«å¯ç¨éç¾¤">é¶æ²³éºéºv11 kubeadmé¨ç½²k8s v1.35.0é«å¯ç¨éç¾¤</h1>
<h2 id="ç³»ç»ç¯å¢">ç³»ç»ç¯å¢</h2>
<pre><code class="language-bash"># nkvers 
############## Kylin Linux Version #################
Release:
Kylin Linux Advanced Server release V11 (Swan25)

Kernel:
6.6.0-32.7.v2505.ky11.x86_64

Build:
Kylin Linux Advanced Server
release V11 2503/(Swan25)-x86_64-Build20/20250715
#################################################
</code></pre>
<table>
<thead>
<tr>
<th style="text-align: center">ä¸»æºå</th>
<th style="text-align: center">ipå°å</th>
<th style="text-align: center">éç½®</th>
<th style="text-align: center">æå¡</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">demo-master-01</td>
<td style="text-align: center">192.168.122.171</td>
<td style="text-align: center">2c4g</td>
<td style="text-align: center">k8s masterãetcdãkeepalivedãhaproxyãcontainerd</td>
</tr>
<tr>
<td style="text-align: center">demo-master-02</td>
<td style="text-align: center">192.168.122.172</td>
<td style="text-align: center">2c4g</td>
<td style="text-align: center">k8s masterãetcdãkeepalivedãhaproxyãcontainerd</td>
</tr>
<tr>
<td style="text-align: center">demo-worker-01</td>
<td style="text-align: center">192.168.122.173</td>
<td style="text-align: center">2c4g</td>
<td style="text-align: center">k8s workerãetcd</td>
</tr>
</tbody>
</table>
<h2 id="æå¡çæ¬ä»ç»">æå¡çæ¬ä»ç»</h2>
<table>
<thead>
<tr>
<th style="text-align: center">æå¡åç§°</th>
<th style="text-align: center">çæ¬</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">kubernetes</td>
<td style="text-align: center">1.35.0</td>
</tr>
<tr>
<td style="text-align: center">containerd</td>
<td style="text-align: center">2.2.1</td>
</tr>
<tr>
<td style="text-align: center">etcd</td>
<td style="text-align: center">3.6.7</td>
</tr>
<tr>
<td style="text-align: center">cni-plugins</td>
<td style="text-align: center">1.3.0</td>
</tr>
<tr>
<td style="text-align: center">runc</td>
<td style="text-align: center">1.4.0</td>
</tr>
<tr>
<td style="text-align: center">keepalived</td>
<td style="text-align: center">2.3.4</td>
</tr>
<tr>
<td style="text-align: center">haproxy</td>
<td style="text-align: center">3.2.10</td>
</tr>
<tr>
<td style="text-align: center">cilium</td>
<td style="text-align: center">1.18.6</td>
</tr>
</tbody>
</table>
<h2 id="åè¨">åè¨</h2>
<p>æ­¤ææ¡£ä¸»è¦ç¨äºæ¼ç¤ºä½¿ç¨äºè¿å¶kubeadmé¨ç½²Kubernetesé«å¯ç¨éç¾¤ã</p>
<p>æ­¤ææ¡£ä»è¿è¡æµç¨æ¼ç¤ºï¼åç»­ç¨æ·å¯ä»¥ä½¿ç¨ansibleæç¼åShellãGoèæ¬è¿è¡èªå¨åéç½®ï¼æé«é¨ç½²æçã</p>
<p>v1.35.0çæ¬è¾ä¹åçæ¬è¿æ¯æäºå·®å¼åç¹æ§çï¼åå ä¸æ°åå¸çå½äº§æå¡å¨æä½ç³»ç»é¶æ²³éºéºv11ï¼ç¸ä¿¡çå®ä¼ææ°çæ¶è·ï¼</p>
<h2 id="ç¯å¢åå¤">ç¯å¢åå¤</h2>
<p>æ­¤æ­¥éª¤ä¸»è¦å°ä¸äºé¨ç½²k8såçåç½®æ¡ä»¶éç½®å¥½ï¼æ¯ä¸ªä¸»æºé½è¦è¿è¡æä½ã</p>
<h3 id="éç½®ä¸»æºåéç½®hostsè§£æ">éç½®ä¸»æºåï¼éç½®hostsè§£æ</h3>
<pre><code class="language-bash"># ä¸»æºå
hostnamectl set-hostname demo-master-01
hostnamectl set-hostname demo-master-02
hostnamectl set-hostname demo-worker-01

# /etc/hosts
192.168.122.171 demo-master-01
192.168.122.172 demo-master-02
192.168.122.173 demo-worker-01
</code></pre>
<h3 id="å³é­é²ç«å¢selinuxswapååº">å³é­é²ç«å¢ï¼SElinuxï¼swapååº</h3>
<pre><code class="language-bash"># é²ç«å¢
systemctl stop firewalld.service
systemctl disable firewalld.service

# SElinuxï¼é»è®¤å°±æ¯å³é­ç¶æï¼è¥æ¯å¼å¯ç¶æå¯æ§è¡ä»¥ä¸å½ä»¤
setenforce 0
sed -i 's/^SELINUX=.*/SELINUX=disabled/' /etc/selinux/config

# swapååº
swapoff -a
sed -ri 's/.*swap.*/#&amp;/' /etc/fstab
</code></pre>
<h3 id="éç½®æ¶éåæ­¥">éç½®æ¶éåæ­¥</h3>
<pre><code class="language-bash"># éç½®æ¶åº
timedatectl set-timezone Asia/Shanghai

# éç½®ntpæå¡å¨
vim /etc/chrony.conf
...
server ntp1.aliyun.com iburst
...

# å¯å¨æå¡ï¼å¹¶å¼å¯èªå¯
systemctl enable --now chronyd.service

# æ£æ¥åæ­¥æå¡ãåæ­¥ç¶æ
systemctl status chronyd.service
timedatectl 
chronyc sources -v 
</code></pre>
<h3 id="åæ ¸éç½®">åæ ¸éç½®</h3>
<p>ç±äºé¶æ²³éºéºV11èªå¸¦åæ ¸å·²ä¸º6.6çæ¬ï¼æä¸éåè¿è¡å¤§çæ¬çåçº§ï¼ä»éè¿è¡æäºåæ ¸åæ°éç½®å³å¯ã</p>
<p>å ä¸ºCNIæä»¶åå¤éç¨ciliumï¼ç´æ¥æ¿ä»£kube-proxyï¼æä¸éå è½½ipvsæ¨¡åï¼ä½ç±äºk8sèç¹ä¸keepalivedæå¡å¨åä¸èç¹ï¼æéå è½½ipvsæ¨¡åã</p>
<p>å¦å¤é¶æ²³éºéºçsysctlåæ ¸åæ°å è½½é¡ºåºï¼å¯åèåæï¼<a href="https://www.cnblogs.com/v-fan/p/18849732" target="_blank">é¶æ²³éºéºv10 sysctlåæ ¸åæ°å è½½é¡ºåºæè</a>ã</p>
<ol>
<li><strong>éç½®CGroupçæ¬ä¸ºv2</strong></li>
</ol>
<p>ç±äºk8s 1.35çæ¬é»è®¤çcgroupçæ¬å°±æ¯v2ï¼åæ¶k8så®æ¹ä¹å¼ºçå»ºè®®ä½¿ç¨cgroup v2ï¼ä½¿ç¨cgroup v2æä»¥ä¸å ç¹è¦æ±ï¼</p>
<ul>
<li>æä½ç³»ç»åè¡çå¯ç¨ CGroup v2</li>
<li>Linux åæ ¸ä¸º 5.8 ææ´é«çæ¬</li>
<li>å®¹å¨è¿è¡æ¶æ¯æ CGroup v2ãä¾å¦ï¼<a href="https://containerd.io/" target="_blank" rel="noopener nofollow">containerd</a> v1.4 åæ´é«çæ¬ã<a href="https://cri-o.io/" target="_blank" rel="noopener nofollow">cri-o</a> v1.20 åæ´é«çæ¬</li>
<li>kubelet åå®¹å¨è¿è¡æ¶è¢«éç½®ä¸ºä½¿ç¨ <a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes#systemd-cgroup-driver" target="_blank" rel="noopener nofollow">systemd CGroup é©±å¨</a></li>
</ul>
<p>æ¥çå½åé»è®¤cgroupçæ¬ï¼</p>
<pre><code class="language-bash">stat -fc %T /sys/fs/cgroup/
tmpfs
</code></pre>
<blockquote>
<p>tmpfsè¡¨ç¤ºCGroup v1ãcgroup2fsè¡¨ç¤ºCGroup v2</p>
</blockquote>
<p>ä¿®æ¹åæ ¸cmdlineåæ°ï¼éå¯ï¼ä½¿å¶é»è®¤æ¯æCGroup v2ï¼</p>
<p>vim /etc/default/grub</p>
<pre><code class="language-bash"># æåæ·»å systemd.unified_cgroup_hierarchy=1åæ°
GRUB_CMDLINE_LINUX="... systemd.unified_cgroup_hierarchy=1"
</code></pre>
<p>éæ°çæGRUBéç½®æä»¶ï¼å¹¶éå¯æå¡å¨ï¼</p>
<pre><code class="language-bash">grub2-mkconfig -o /boot/grub2/grub.cfg
reboot
</code></pre>
<p>åæ¬¡éªè¯cgroupçæ¬ï¼</p>
<pre><code class="language-bash">stat -fc %T /sys/fs/cgroup/
cgroup2fs
</code></pre>
<ol start="2">
<li><strong>å è½½åæ ¸æ¨¡å</strong></li>
</ol>
<pre><code class="language-bash"># éç½®æ¨¡å
cat &gt;/etc/modules-load.d/k8s.conf &lt;&lt; EOF
overlay
br_netfilter
ip_vs
ip_vs_rr
ip_vs_wrr
ip_vs_sh
nf_conntrack
ip_tables
ip_set
xt_set
ipt_set
ipt_rpfilter
ipt_REJECT
ipip
EOF

# å°ç®¡çæå¡å¼æºèªå¯ï¼å¹¶éæ°å è½½çæ
systemctl enable --now systemd-modules-load
systemctl restart systemd-modules-load

# ä¸´æ¶å è½½ææ¨¡å
modprobe overlay 
modprobe br_netfilter
</code></pre>
<ol start="3">
<li><strong>ä¼ååæ ¸åæ°</strong></li>
</ol>
<p>å°ç°æç<code>/etc/sysctl.conf</code>å<code>/etc/sysctl.d/99-sysctl.conf</code>æä»¶ä¸­ç<code>net.ipv4.ip_forward</code>éç½®é½å é¤æï¼ç»ä¸éç½®å°kubernetesçæä»¶ä¸­ï¼</p>
<pre><code class="language-bash"># å é¤åéç½®
sed -i '/net.ipv4.ip_forward/d' /etc/sysctl.conf /etc/sysctl.d/99-sysctl.conf

# æ·»å æ°éç½®
cat &gt; /etc/sysctl.d/99-kubernetes-cri.conf &lt;&lt; EOF
# ========== ç½ç»ç¸å³ï¼K8S ç½ç»æä»¶/å®¹å¨éä¿¡æ ¸å¿ï¼ ==========
# è®©æ¡¥æ¥æµéç»è¿ iptables è§åï¼Calico/Flannel/CNI æä»¶å¿éï¼
net.bridge.bridge-nf-call-iptables = 1
net.bridge.bridge-nf-call-ip6tables = 1
# å¼å¯ IP è½¬åï¼Pod è·¨èç¹éä¿¡ãService è½¬åå¿éï¼
net.ipv4.ip_forward = 1
# å¤ç¨ TIME_WAIT å¥æ¥å­ï¼æåé«å¹¶åç½ç»æ§è½
net.ipv4.tcp_tw_reuse = 1
# å¢å¤§å¥æ¥å­çå¬éåä¸éï¼é¿åé«å¹¶åä¸è¿æ¥è¢«æç»ï¼
net.core.somaxconn = 65535
# å¢å¤§ç½ç»è®¾å¤æ¥æ¶éåï¼æåç½ç»ååï¼
net.core.netdev_max_backlog = 65535
# å¢å¤§ TCP SYN éåï¼æµå¾¡ SYN æ´ªæ°´ï¼æåè¿æ¥å»ºç«æçï¼
net.ipv4.tcp_max_syn_backlog = 65535
# ç¼©ç­ FIN_WAIT2 è¶æ¶æ¶é´ï¼å¿«ééæ¾èµæºï¼
net.ipv4.tcp_fin_timeout = 30
# ä¼å ARP ç¼å­ï¼å¤§è§æ¨¡éç¾¤åå°ç¼å­åæ¶é¢çï¼
net.ipv4.neigh.default.gc_thresh1 = 8192
net.ipv4.neigh.default.gc_thresh2 = 32768
net.ipv4.neigh.default.gc_thresh3 = 65536

# ========== Containerd/å®¹å¨è¿è¡æ¶ç¸å³ ==========
# å¢å¤§ inotify å®ä¾æ°/çæ§æä»¶æ°ï¼é¿å containerd çæ§å®¹å¨æä»¶æ¶è¾¾å°ä¸éï¼
fs.inotify.max_user_instances = 1048576
fs.inotify.max_user_watches = 1048576
# å¢å¤§ç³»ç»æå¤§æä»¶å¥ææ°ï¼æ¯æå¤§è§æ¨¡å®¹å¨ï¼æ¯ä¸ªå®¹å¨å ç¨å¤ä¸ªæä»¶å¥æï¼
fs.file-max = 52706963
# å¢å¤§åä¸ªè¿ç¨æå¤§æå¼æä»¶æ°ï¼éå file-maxï¼
fs.nr_open = 52706963
# å¢å¤§èæåå­æ å°åºæ°éï¼æ»¡è¶³ containerd/å®¹å¨ååºç¨å¦ ES çéæ±ï¼
vm.max_map_count = 262144
# ç¦ç¨äº¤æ¢ååºï¼K8S è¦æ±ï¼é¿åå®¹å¨åå­ä½¿ç¨ swap å¯¼è´æ§è½ä¸éï¼
vm.swappiness = 0
# å¢å¤§æå¤§ PID æ°ï¼æ¯æå¤§è§æ¨¡ Podï¼æ¯ä¸ª Pod åå«å¤ä¸ªè¿ç¨ï¼
kernel.pid_max = 4194304

# ========== K8S æ ¸å¿ç¨³å®æ§ç¸å³ ==========
# åæ ¸ panic å 10 ç§éå¯ï¼æåéç¾¤èªæè½åï¼
kernel.panic = 10
# åæ ¸åºéæ¶è§¦å panicï¼é¿åèç¹åµæ­»ï¼
kernel.panic_on_oops = 1
# æ£æµå°è½¯éæ­»æ¶è§¦å panicï¼é¿åèç¹æ ååºï¼
kernel.softlockup_panic = 1
EOF

# å è½½æ°éç½®
sysctl --system

# æ£æ¥éç½®æ¯å¦çæ
sysctl -a | grep -E 'ip_forward|nr_open'
</code></pre>
<ol start="4">
<li><strong>å¶ä»ï¼åæ ¸åçº§ï¼v11è·³è¿ï¼</strong></li>
</ol>
<p>å¦å¤ï¼è¥æ¯KylinOS V10 SP3ççæ¬ï¼å¯åè¿è¡åæ ¸åçº§ï¼åè¿è¡ä¸è¿°åæ°çä¿®æ¹ï¼è·³è¿è®¾ç½®cgroup v2çæ­¥éª¤ï¼ã</p>
<p>KylinOS V10 SP3 2403é»è®¤çåæ ¸çæ¬æ¯4.19.90-89.15ï¼ç®åæ­¤ç³»ç»çæ¬ééçåæ ¸æé«çæ¬æ¯4.19.90-89.18ï¼å¦æéæ±ï¼å¯ä»¥è¿è¡åçº§ï¼æ­¥éª¤å¦ä¸ã</p>
<p>æ³¨ï¼ç±äºKylinOSçåæ ¸å·æé«åº¦å®å¶æ§ï¼æä¸å»ºè®®ä½¿ç¨Linux Kernelå®æ¹æä¾é«çæ¬åæ ¸çrpmåææºç ç¼è¯åç´æ¥å®è£å°KylinOSä¸­ï¼ä»¥åå¯¼è´ä¸äºéå¿è¦çé®é¢ã</p>
<p><strong>ä¸è½½åæ ¸å</strong></p>
<pre><code># mkdir kernel_rpm &amp;&amp; cd kernel_rpm
# for i in kernel kernel-core kernel-devel kernel-headers kernel-modules kernel-modules-extra kernel-modules-internal; do wget https://update.cs2c.com.cn/NS/V10/V10SP3-2403/os/adv/lic/updates/x86_64/Packages/${i}-4.19.90-89.18.v2401.ky10.x86_64.rpm ;done
</code></pre>
<p><strong>å®è£åæ ¸</strong></p>
<pre><code># rpm -ivh kernel-4.19.90-89.18.v2401.ky10.x86_64.rpm kernel-core-4.19.90-89.18.v2401.ky10.x86_64.rpm  kernel-modules-4.19.90-89.18.v2401.ky10.x86_64.rpm kernel-modules-extra-4.19.90-89.18.v2401.ky10.x86_64.rpm kernel-modules-internal-4.19.90-89.18.v2401.ky10.x86_64.rpm
# rpm -Uvh kernel-devel-4.19.90-89.18.v2401.ky10.x86_64.rpm
# rpm -Uvh kernel-headers-4.19.90-89.18.v2401.ky10.x86_64.rpm
</code></pre>
<p><strong>è®¾å®é»è®¤å¯å¨</strong></p>
<pre><code># grub2-set-default kernel-4.19.90-89.18.v2401.ky10.x86_64.rpm
</code></pre>
<p><strong>éªè¯åçº§</strong></p>
<pre><code># grub2-editenv list
# reboot
# nkvers
</code></pre>
<h2 id="å¼å§é¨ç½²k8séç¾¤">å¼å§é¨ç½²k8séç¾¤</h2>
<h3 id="containerdå®è£">containerdå®è£</h3>
<p>ææèç¹åéè¦æä½å®è£ã</p>
<h4 id="cniæä»¶å®è£">cniæä»¶å®è£</h4>
<p>è¥æå¡å¨å¯ä»£çä¸ç½ï¼å¯ç´æ¥æ§è¡ä»¥ä¸èæ¬ï¼</p>
<pre><code class="language-bash">CNI_PLUGINS_VERSION="v1.3.0"
ARCH="amd64"
DEST="/opt/cni/bin"
sudo mkdir -p "$DEST"
curl -L "https://github.com/containernetworking/plugins/releases/download/${CNI_PLUGINS_VERSION}/cni-plugins-linux-${ARCH}-${CNI_PLUGINS_VERSION}.tgz" | sudo tar -C "$DEST" -xz
</code></pre>
<p>è¥ä¸å¯ä»£çä¸ç½ï¼æ¬æ<strong>æéææååéååå·²ä¸ä¼ è³ç½ç</strong>ï¼å¯å°ææ«è·åã</p>
<p>å°å¯¹åºåä¸ä¼ è³æå¡å¨ä¸­ï¼<code>cni-plugins-linux-amd64-v1.3.0.tgz</code>ï¼æ§è¡ï¼</p>
<pre><code class="language-bash">mkdir -p /opt/cni/bin
tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.3.0.tgz
</code></pre>
<h4 id="runcå®è£">runcå®è£</h4>
<pre><code class="language-bash">wget https://github.com/opencontainers/runc/releases/download/v1.4.0/runc.amd64
install -m 755 runc.amd64 /usr/local/sbin/runc
</code></pre>
<h4 id="containerdè¿è¡æ¶å®è£">containerdè¿è¡æ¶å®è£</h4>
<pre><code class="language-bash">wget https://github.com/containerd/containerd/releases/download/v2.2.1/containerd-2.2.1-linux-amd64.tar.gz
tar Cxzvf /usr/local containerd-2.2.1-linux-amd64.tar.gz
</code></pre>
<p>éç½®systemdç®¡çï¼<code>vim /usr/lib/systemd/system/containerd.service</code></p>
<pre><code class="language-bash"># Copyright The containerd Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

[Unit]
Description=containerd container runtime
Documentation=https://containerd.io
After=network.target dbus.service

[Service]
ExecStartPre=-/sbin/modprobe overlay
ExecStart=/usr/local/bin/containerd

Type=notify
Delegate=yes
KillMode=process
Restart=always
RestartSec=5

# Having non-zero Limit*s causes performance problems due to accounting overhead
# in the kernel. We recommend using cgroups to do container-local accounting.
LimitNPROC=infinity
LimitCORE=infinity

# Comment TasksMax if your systemd version does not supports it.
# Only systemd 226 and above support this version.
TasksMax=infinity
OOMScoreAdjust=-999

[Install]
WantedBy=multi-user.target
</code></pre>
<p>å è½½systemdï¼å¹¶å¯å¨containerd</p>
<pre><code class="language-bash">systemctl daemon-reload
systemctl enable --now containerd
systemctl status containerd.service
</code></pre>
<p>å®è£crictlå®¢æ·ç«¯å·¥å·ï¼éåç®¡çcontainerdãk8séç¾¤ï¼å¯ä»£çä¸ç½æ¶ï¼ç´æ¥æ§è¡ä»¥ä¸èæ¬ï¼</p>
<pre><code class="language-bash">DOWNLOAD_DIR="/usr/local/bin"
CRICTL_VERSION="v1.31.0"
ARCH="amd64"
curl -L "https://github.com/kubernetes-sigs/cri-tools/releases/download/${CRICTL_VERSION}/crictl-${CRICTL_VERSION}-linux-${ARCH}.tar.gz" | sudo tar -C $DOWNLOAD_DIR -xz
</code></pre>
<p>å¦åï¼ä¸ä¼ <code>crictl-v1.31.0-linux-amd64.tar.gz</code>ï¼æ§è¡ï¼</p>
<pre><code class="language-bash">tar Cxzvf /usr/local/bin crictl-v1.31.0-linux-amd64.tar.gz
</code></pre>
<p>éç½®crictlï¼</p>
<pre><code class="language-bash">cat &gt; /etc/crictl.yaml &lt;&lt;EOF
runtime-endpoint: unix:///run/containerd/containerd.sock
image-endpoint: unix:///run/containerd/containerd.sock
timeout: 10
debug: true
pull-image-on-create: false
EOF
</code></pre>
<p>å®è£nerdctlå·¥å·ï¼ç¨äºcontainerdæ¬èº«çå®¹å¨ç®¡çæ´æ¹ä¾¿ï¼</p>
<pre><code class="language-bash"># ä¸è½½
wget https://github.com/containerd/nerdctl/releases/download/v2.2.1/nerdctl-2.2.1-linux-amd64.tar.gz
# è§£å
tar xf nerdctl-2.2.1-linux-amd64.tar.gz -C /usr/local/bin/
# è¿è¡æ¥ç
nerdctl images
</code></pre>
<p>éç½®<code>/etc/containerd/config.toml</code>ï¼</p>
<pre><code class="language-bash">containerd config default &gt; /etc/containerd/config.toml

vim /etc/containerd/config.toml
# éç½® systemd cgroup é©±å¨
[plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.runc]
  ...
  [plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.runc.options]
    SystemdCgroup = true

# ä¿®æ¹ sandbox å®¹å¨éåä»åº
    [plugins.'io.containerd.cri.v1.images'.pinned_images]
      sandbox = 'registry.aliyuncs.com/google_containers/pause:3.10.1'
</code></pre>
<p>éç½®å®æï¼éå¯containerdæå¡ï¼<code>systemctl restart containerd.service</code></p>
<h3 id="kubeadmkubeletkubectlå®è£">kubeadm/kubelet/kubectlå®è£</h3>
<p>ææèç¹åéè¦æä½å®è£ã</p>
<h4 id="kubeadmkubelet-install">kubeadm/kubelet install</h4>
<p>å¯ä»£çä¸ç½ï¼ç´æ¥æ§è¡ä»¥ä¸èæ¬ï¼</p>
<pre><code class="language-bash">DOWNLOAD_DIR="/usr/local/bin"
RELEASE="v1.35.0"
ARCH="amd64"
cd $DOWNLOAD_DIR
sudo curl -L --remote-name-all https://dl.k8s.io/release/${RELEASE}/bin/linux/${ARCH}/{kubeadm,kubelet}
sudo chmod +x {kubeadm,kubelet}

RELEASE_VERSION="v0.16.2"
curl -sSL "https://raw.githubusercontent.com/kubernetes/release/${RELEASE_VERSION}/cmd/krel/templates/latest/kubelet/kubelet.service" | sed "s:/usr/bin:${DOWNLOAD_DIR}:g" | sudo tee /usr/lib/systemd/system/kubelet.service
sudo mkdir -p /usr/lib/systemd/system/kubelet.service.d
curl -sSL "https://raw.githubusercontent.com/kubernetes/release/${RELEASE_VERSION}/cmd/krel/templates/latest/kubeadm/10-kubeadm.conf" | sed "s:/usr/bin:${DOWNLOAD_DIR}:g" | sudo tee /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf
</code></pre>
<p>ä¸å¯ä»£çä¸ç½ï¼ä¸ä¼ <code>kubeadm</code>ã<code>kubelet</code>æä»¶è³æå¡å¨ï¼éåæ§è¡ï¼</p>
<pre><code class="language-bash">chmod +x kubeadm kubelet 
mv kubeadm kubelet /usr/local/bin/
</code></pre>
<p>éç½®systemdï¼<code>vim /usr/lib/systemd/system/kubelet.service</code></p>
<pre><code class="language-bash">[Unit]
Description=kubelet: The Kubernetes Node Agent
Documentation=https://kubernetes.io/docs/
Wants=network-online.target
After=network-online.target

[Service]
ExecStart=/usr/local/bin/kubelet
Restart=always
StartLimitInterval=0
RestartSec=10

[Install]
WantedBy=multi-user.target
</code></pre>
<p>ç¼è¾kubeletç®¡çéç½®æä»¶ï¼</p>
<p><code>mkdir -p /usr/lib/systemd/system/kubelet.service.d</code></p>
<p><code>vim /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf</code></p>
<pre><code class="language-bash"># Note: This dropin only works with kubeadm and kubelet v1.11+
[Service]
Environment="KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf"
Environment="KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml"
# This is a file that "kubeadm init" and "kubeadm join" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically
EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env
# This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use
# the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.
EnvironmentFile=-/etc/sysconfig/kubelet
ExecStart=
ExecStart=/usr/local/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS
</code></pre>
<p>å¯å¨kubeletï¼æ¥çç¶æï¼</p>
<pre><code class="language-bash">systemctl enable --now kubelet
systemctl status kubelet
</code></pre>
<h4 id="kubectl-install">kubectl install</h4>
<p>ä¸ä¼ <code>kubectl</code>è³æå¡å¨ï¼å¹¶æ§è¡ï¼</p>
<pre><code class="language-bash">install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
kubectl version --client
</code></pre>
<h4 id="éç½®å½ä»¤è¡¥å¨">éç½®å½ä»¤è¡¥å¨</h4>
<pre><code class="language-bash">yum install bash-completion
source /usr/share/bash-completion/bash_completion

# kubectlè¡¥å¨
source &lt;(kubectl completion bash)
kubectl completion bash &gt;/etc/bash_completion.d/kubectl

# crictlè¡¥å¨
source &lt;(crictl completion bash)
crictl completion bash &gt;/etc/bash_completion.d/crictl

# nerctlè¡¥å¨
source &lt;(nerdctl completion bash)
nerdctl completion bash &gt;/etc/bash_completion.d/nerdctl
</code></pre>
<h3 id="é«å¯ç¨etcdå®è£">é«å¯ç¨etcdå®è£</h3>
<blockquote>
<p>æ¬èå®è£3èç¹é«å¯ç¨éç¾¤</p>
</blockquote>
<ol>
<li>è¿è¡ä»¥ä¸èæ¬ï¼ä¸ºæ¯ä¸ªetcdä¸»æºåå»ºkubeadméç½®æä»¶</li>
</ol>
<pre><code class="language-bash"># ä½¿ç¨ä½ çä¸»æº IP æ´æ° HOST0ãHOST1 å HOST2 ç IP å°å
export HOST0=192.168.122.171
export HOST1=192.168.122.172
export HOST2=192.168.122.173

# ä½¿ç¨ä½ çä¸»æºåæ´æ° NAME0ãNAME1 å NAME2
export NAME0="demo-master-01"
export NAME1="demo-master-02"
export NAME2="demo-worker-01"

# åå»ºä¸´æ¶ç®å½æ¥å­å¨å°è¢«ååå°å¶å®ä¸»æºä¸çæä»¶
mkdir -p /tmp/${HOST0}/ /tmp/${HOST1}/ /tmp/${HOST2}/

HOSTS=(${HOST0} ${HOST1} ${HOST2})
NAMES=(${NAME0} ${NAME1} ${NAME2})

for i in "${!HOSTS[@]}"; do
HOST=${HOSTS[$i]}
NAME=${NAMES[$i]}
cat &lt;&lt; EOF &gt; /tmp/${HOST}/kubeadmcfg.yaml
---
apiVersion: "kubeadm.k8s.io/v1beta4"
kind: InitConfiguration
nodeRegistration:
    name: ${NAME}
localAPIEndpoint:
    advertiseAddress: ${HOST}
---
apiVersion: "kubeadm.k8s.io/v1beta4"
kind: ClusterConfiguration
etcd:
    local:
        serverCertSANs:
        - "${HOST}"
        peerCertSANs:
        - "${HOST}"
        extraArgs:
        - name: initial-cluster
          value: ${NAMES[0]}=https://${HOSTS[0]}:2380,${NAMES[1]}=https://${HOSTS[1]}:2380,${NAMES[2]}=https://${HOSTS[2]}:2380
        - name: initial-cluster-state
          value: new
        - name: name
          value: ${NAME}
        - name: listen-peer-urls
          value: https://${HOST}:2380
        - name: listen-client-urls
          value: https://${HOST}:2379
        - name: advertise-client-urls
          value: https://${HOST}:2379
        - name: initial-advertise-peer-urls
          value: https://${HOST}:2380
EOF
done
</code></pre>
<ol start="2">
<li>çæCAè¯ä¹¦</li>
</ol>
<pre><code class="language-bash">kubeadm init phase certs etcd-ca

# ä¼çæè¿ä¸¤ä¸ªæä»¶
ls /etc/kubernetes/pki/etcd
ca.crt  ca.key
</code></pre>
<ol start="3">
<li>ä¸ºæ¯ä¸ªetcdä¸»æºåå»ºè¯ä¹¦</li>
</ol>
<pre><code class="language-bash"># ä½¿ç¨ä½ çä¸»æº IP æ´æ° HOST0ãHOST1 å HOST2 ç IP å°å
export HOST0=192.168.122.171
export HOST1=192.168.122.172
export HOST2=192.168.122.173

kubeadm init phase certs etcd-server --config=/tmp/${HOST2}/kubeadmcfg.yaml
kubeadm init phase certs etcd-peer --config=/tmp/${HOST2}/kubeadmcfg.yaml
kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST2}/kubeadmcfg.yaml
kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST2}/kubeadmcfg.yaml
cp -R /etc/kubernetes/pki /tmp/${HOST2}/
# æ¸çä¸å¯éå¤ä½¿ç¨çè¯ä¹¦
find /etc/kubernetes/pki -not -name ca.crt -not -name ca.key -type f -delete

kubeadm init phase certs etcd-server --config=/tmp/${HOST1}/kubeadmcfg.yaml
kubeadm init phase certs etcd-peer --config=/tmp/${HOST1}/kubeadmcfg.yaml
kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST1}/kubeadmcfg.yaml
kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST1}/kubeadmcfg.yaml
cp -R /etc/kubernetes/pki /tmp/${HOST1}/
find /etc/kubernetes/pki -not -name ca.crt -not -name ca.key -type f -delete

kubeadm init phase certs etcd-server --config=/tmp/${HOST0}/kubeadmcfg.yaml
kubeadm init phase certs etcd-peer --config=/tmp/${HOST0}/kubeadmcfg.yaml
kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST0}/kubeadmcfg.yaml
kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST0}/kubeadmcfg.yaml
# ä¸éè¦ç§»å¨ certs å ä¸ºå®ä»¬æ¯ç» HOST0 ä½¿ç¨ç

# æ¸çä¸åºä»æ­¤ä¸»æºå¤å¶çè¯ä¹¦
find /tmp/${HOST2} -name ca.key -type f -delete
find /tmp/${HOST1} -name ca.key -type f -delete
</code></pre>
<ol start="4">
<li>å¤å¶è¯ä¹¦å kubeadm éç½®å°ç®æ ä¸»æº</li>
</ol>
<pre><code class="language-bash">USER=root

# demo-master-02
scp -r /tmp/${HOST1}/* ${USER}@${HOST1}:
ssh ${USER}@${HOST1}
root@HOST $ chown -R root:root pki
root@HOST $ mkdir /etc/kubernetes
root@HOST $ mv pki /etc/kubernetes/

# demo-worker-01
scp -r /tmp/${HOST2}/* ${USER}@${HOST2}:
ssh ${USER}@${HOST2}
root@HOST $ chown -R root:root pki
root@HOST $ mkdir /etc/kubernetes
root@HOST $ mv pki /etc/kubernetes/
</code></pre>
<ol start="5">
<li>æ£æ¥ç®æ ä¸»æºè¯ä¹¦</li>
</ol>
<pre><code class="language-bash"># demo-master-01
tree /tmp/192.168.122.171/ /etc/kubernetes/pki
/tmp/192.168.122.171/
âââ kubeadmcfg.yaml
/etc/kubernetes/pki
âââ apiserver-etcd-client.crt
âââ apiserver-etcd-client.key
âââ etcd
    âââ ca.crt
    âââ ca.key
    âââ healthcheck-client.crt
    âââ healthcheck-client.key
    âââ peer.crt
    âââ peer.key
    âââ server.crt
    âââ server.key

# demo-master-02
tree /root/ /etc/kubernetes/pki
/root/
âââ kubeadmcfg.yaml
/etc/kubernetes/pki
âââ apiserver-etcd-client.crt
âââ apiserver-etcd-client.key
âââ etcd
    âââ ca.crt
    âââ healthcheck-client.crt
    âââ healthcheck-client.key
    âââ peer.crt
    âââ peer.key
    âââ server.crt
    âââ server.key

# demo-worker-01
tree /root/ /etc/kubernetes/pki
/root/
âââ kubeadmcfg.yaml
/etc/kubernetes/pki
âââ apiserver-etcd-client.crt
âââ apiserver-etcd-client.key
âââ etcd
    âââ ca.crt
    âââ healthcheck-client.crt
    âââ healthcheck-client.key
    âââ peer.crt
    âââ peer.key
    âââ server.crt
    âââ server.key
</code></pre>
<ol start="6">
<li>å®è£åéç½®etcdæå¡</li>
</ol>
<blockquote>
<p>æ³¨ï¼ææetcdä¸»æºåéæä½ï¼yumæºèªå¸¦etcdæå¡çæ¬ä¸º3.4.14ï¼èk8s1.35è¦æ±etcdä¸ä½äº3.5.24-0ã</p>
</blockquote>
<pre><code class="language-bash"># ä¸è½½
wget https://github.com/etcd-io/etcd/releases/download/v3.6.7/etcd-v3.6.7-linux-amd64.tar.gz
# è§£åç¼©
tar xf etcd-v3.6.7-linux-amd64.tar.gz &amp;&amp; cd etcd-v3.6.7-linux-amd64
# ç¼è¾è¿è¡ç¯å¢
cp etcdctl etcdutl etcd /usr/bin/
mkdir /var/lib/etcd /etc/etcd &amp;&amp; chown -R etcd:etcd /var/lib/etcd &amp;&amp; chmod 700 /var/lib/etcd/ &amp;&amp; chown -R etcd /etc/kubernetes/pki/etcd
</code></pre>
<p>vim /etc/etcd/etcd.conf</p>
<pre><code class="language-bash"># etcdèç¹åç§°ï¼è¦åETCD_INITIAL_CLUSTERä¸­çåç§°ä¸è´
ETCD_NAME=demo-master-01

#æ°æ®å­å¨ç®å½
ETCD_DATA_DIR="/var/lib/etcd"

# æå¡ççå¬åéä¿¡å°åä¸ç«¯å£
ETCD_LISTEN_PEER_URLS="https://192.168.122.171:2380"
ETCD_LISTEN_CLIENT_URLS="https://192.168.122.171:2379"
ETCD_INITIAL_ADVERTISE_PEER_URLS="https://192.168.122.171:2380"
ETCD_ADVERTISE_CLIENT_URLS="https://192.168.122.171:2379"

# éç¾¤ææçæå
ETCD_INITIAL_CLUSTER="demo-master-01=https://192.168.122.171:2380,demo-master-02=https://192.168.122.172:2380,demo-worker-01=https://192.168.122.173:2380"
ETCD_INITIAL_CLUSTER_STATE="new"
ETCD_INITIAL_CLUSTER_TOKEN="etcd-cluster"

# è¯ä¹¦éç½®
ETCD_CERT_FILE="/etc/kubernetes/pki/etcd/server.crt"
ETCD_KEY_FILE="/etc/kubernetes/pki/etcd/server.key"
ETCD_CLIENT_CERT_AUTH="true"
ETCD_TRUSTED_CA_FILE="/etc/kubernetes/pki/etcd/ca.crt"
ETCD_AUTO_TLS="true"
ETCD_PEER_CERT_FILE="/etc/kubernetes/pki/etcd/peer.crt"
ETCD_PEER_KEY_FILE="/etc/kubernetes/pki/etcd/peer.key"
ETCD_PEER_CLIENT_CERT_AUTH="true"
ETCD_PEER_TRUSTED_CA_FILE="/etc/kubernetes/pki/etcd/ca.crt"
ETCD_PEER_AUTO_TLS="true"
</code></pre>
<blockquote>
<p>3å°etcdçéç½®æä»¶ä¸»ä½åå®¹ç¸åï¼ä»<code>ETCD_NAME</code>åçå¬çå°åéè¦æ ¹æ®å®éæåµä¿®æ¹ï¼ä¾å¦demo-master-02ä¸»æºéæ´æ¹ä¸º<code>ETCD_NAME=demo-master-02</code>ï¼å¹¶å°ææipå°åæ´æ¹ä¸º<code>192.168.122.172</code>ã</p>
</blockquote>
<p>vim /usr/lib/systemd/system/etcd.service</p>
<pre><code class="language-bash">[Unit]
Description=Etcd Server
After=network.target
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
WorkingDirectory=/var/lib/etcd/
EnvironmentFile=-/etc/etcd/etcd.conf
User=etcd
# set GOMAXPROCS to number of processors
ExecStart=/bin/bash -c "GOMAXPROCS=$(nproc) /usr/bin/etcd"
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
</code></pre>
<ol start="7">
<li>å¯å¨æå¡ï¼å¹¶æ£æ¥etcdéç¾¤ç¶æ</li>
</ol>
<pre><code class="language-bash">systemctl daemon-reload
# ææèç¹ï¼å°½éåæ¶é´å¯å¨
systemctl enable --now etcd
</code></pre>
<p>æ£æ¥éç¾¤ç¶æï¼</p>
<pre><code class="language-bash">export HOST0=192.168.122.171

ETCDCTL_API=3 etcdctl \
--cert /etc/kubernetes/pki/etcd/peer.crt \
--key /etc/kubernetes/pki/etcd/peer.key \
--cacert /etc/kubernetes/pki/etcd/ca.crt \
--endpoints https://${HOST0}:2379 endpoint health
</code></pre>
<h3 id="éç½®é«å¯ç¨">éç½®é«å¯ç¨</h3>
<h4 id="éç½®keepalived-and-haproxy">éç½®keepalived and haproxy</h4>
<p>ç¬¬1-4æ­¥å¨ä¸¤å°æºå¨çæä½æ¯ç¸åçï¼ç¬¬5æ­¥éå·®å¼éç½®ã</p>
<ol>
<li>ä¸è½½æºç å°æ¬å°</li>
</ol>
<pre><code class="language-bash">wget https://www.keepalived.org/software/keepalived-2.3.4.tar.gz
wget https://www.haproxy.org/download/3.2/src/haproxy-3.2.10.tar.gz
</code></pre>
<ol start="2">
<li>ç¼è¯å®è£keepalived</li>
</ol>
<pre><code class="language-bash">tar xf keepalived-2.3.4.tar.gz &amp;&amp; cd keepalived-2.3.4
yum -y install openssl-devel gcc 
./configure --prefix=/usr/local/keepalived-2.3.4
make &amp;&amp; make install

# éç½®è½¯è¿æ¥
ln -sv /usr/local/keepalived-2.3.4/sbin/keepalived /usr/sbin/
ln -sv /usr/local/keepalived-2.3.4/etc/keepalived /etc/keepalived
</code></pre>
<ol start="2">
<li>ç¼è¯å®è£haproxy</li>
</ol>
<pre><code class="language-bash">tar xf haproxy-3.2.10.tar.gz &amp;&amp; cd haproxy-3.2.10
yum -y install zlib-devel
make -j 2 TARGET=generic USE_ZLIB=1 USE_OPENSSL=1
make install PREFIX=/usr/local/haproxy-3.2.10

# éç½®è½¯è¿æ¥
ln -sv /usr/local/haproxy-3.2.10/sbin/haproxy /usr/sbin/
mkdir /usr/local/haproxy-3.2.10/conf &amp;&amp; ln -sv /usr/local/haproxy-3.2.10/conf /etc/haproxy &amp;&amp; mkdir /etc/haproxy/conf.d
</code></pre>
<ol start="3">
<li>éç½®systemdç®¡çåå</li>
</ol>
<p>vim /usr/lib/systemd/system/haproxy.service</p>
<pre><code class="language-bash">[Unit]
Description=HAProxy Load Balancer
After=network-online.target            
Wants=network-online.target

[Service]
EnvironmentFile=-/etc/sysconfig/haproxy
Environment="HAPROXY_CONF=/etc/haproxy/haproxy.cfg" "PIDFILE=/run/haproxy.pid" "CFGDIR=/etc/haproxy/conf.d"
ExecStartPre=/usr/sbin/haproxy -f $HAPROXY_CONF -f $CFGDIR -c
ExecStart=/usr/sbin/haproxy -Ws -f $HAPROXY_CONF -f $CFGDIR -p $PIDFILE
ExecReload=/usr/sbin/haproxy -f $HAPROXY_CONF -f $CFGDIR -c
ExecReload=/bin/kill -USR2 $MAINPID
KillMode=mixed
SuccessExitStatus=143
Type=notify

[Install]
WantedBy=multi-user.target
</code></pre>
<p>vim /usr/lib/systemd/system/keepalived.service</p>
<pre><code class="language-bash">[Unit]
Description=LVS and VRRP High Availability Monitor
After=network-online.target syslog.target
Wants=network-online.target

[Service]
Type=forking
PIDFile=/run/keepalived.pid
KillMode=process
EnvironmentFile=-/usr/local/keepalived-2.3.4/etc/sysconfig/keepalived
ExecStart=/usr/local/keepalived-2.3.4/sbin/keepalived $KEEPALIVED_OPTIONS
ExecReload=/bin/kill -HUP $MAINPID
StartLimitBurst=1
StartLimitInterval=1s

[Install]
WantedBy=multi-user.target
</code></pre>
<p>å è½½ç®¡çååéç½®æä»¶ï¼</p>
<pre><code class="language-bash">systemctl daemon-reload
</code></pre>
<ol start="4">
<li>éç½®haproxyçkube-apiserverè´è½½åè¡¡</li>
</ol>
<p>vim /etc/haproxy/haproxy.cfg</p>
<pre><code class="language-bash">#---------------------------------------------------------------------
# Global settings
#---------------------------------------------------------------------
global
    log stdout format raw local0
    daemon

#---------------------------------------------------------------------
# common defaults that all the 'listen' and 'backend' sections will
# use if not designated in their block
#---------------------------------------------------------------------
defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    option http-server-close
    option forwardfor       except 127.0.0.0/8
    option                  redispatch
    retries                 1
    timeout http-request    10s
    timeout queue           20s
    timeout connect         5s
    timeout client          35s
    timeout server          35s
    timeout http-keep-alive 10s
    timeout check           10s

#---------------------------------------------------------------------
# apiserver frontend which proxys to the control plane nodes
#---------------------------------------------------------------------
frontend apiserver
    bind *:16443
    mode tcp
    option tcplog
    default_backend apiserverbackend

#---------------------------------------------------------------------
# round robin balancing for apiserver
#---------------------------------------------------------------------
backend apiserverbackend
    option httpchk

    http-check connect ssl
    http-check send meth GET uri /healthz
    http-check expect status 200

    mode tcp
    balance     roundrobin
    
    server apiserver1 192.168.122.171:6443 check verify none
    server apiserver2 192.168.122.172:6443 check verify none
    # [...]
</code></pre>
<ol start="5">
<li>éç½®keepalivedçkube-apiserveré«å¯ç¨</li>
</ol>
<p>åå¨ä¸¤å°keepalivedæå¡å¨å°å¥åº·æ£æµèæ¬åå¤å¥½ï¼<code>vim /etc/keepalived/check_apiserver.sh</code></p>
<pre><code class="language-bash">#!/bin/sh

errorExit() {
    echo "*** $*" 1&gt;&amp;2
    exit 1
}

curl -sfk --max-time 2 https://localhost:16443/healthz -o /dev/null || errorExit "Error GET https://localhost:16443/healthz"
</code></pre>
<blockquote>
<p><a href="https://localhost:16443/healthz%E5%9C%B0%E5%9D%80%E7%AB%AF%E5%8F%A3%E6%94%B9%E4%B8%BAhaproxy" target="_blank" rel="noopener nofollow">https://localhost:16443/healthzå°åç«¯å£æ¹ä¸ºhaproxy</a> ipåçå¬çapiserverç«¯å£</p>
</blockquote>
<p>ç±äºæ­¤æ¶kube-apiserverè¿æªè¿è¡é¨ç½²ï¼6443ç«¯å£è¿æªè¢«çå¬ï¼æä»¥ç°å¨ä»ç¨<code>pgrep haproxy</code>æ£æ¥è¿ç¨å­æ´»ï¼ä¸æ£æµ HAProxy åç«¯ç¶æï¼</p>
<p>demo-master-01ä¸ï¼<code>vim /etc/keepalived/keepalived.conf</code></p>
<pre><code class="language-bash">global_defs {
    router_id LVS_DEVEL
}
vrrp_script check_apiserver {
  script "/etc/keepalived/check_apiserver.sh"
  interval 3
  weight -2
  fall 10
  rise 2
}
vrrp_script check_haproxy {
    script "/usr/bin/pgrep haproxy"  # ä»æ£æ¥ haproxy è¿ç¨æ¯å¦å­å¨
    interval 2                       # æ¯ 2 ç§æ£æ¥ä¸æ¬¡
    weight 2                         # æ£æ¥æåæ¶æé+2ï¼éå¿éï¼ä»ç¨äºä¼åçº§è°æ´ï¼
    fall 1                           # 1 æ¬¡æ£æ¥å¤±è´¥å³å¤å®è¿ç¨å¼å¸¸
    rise 1                           # 1 æ¬¡æ£æ¥æåå³æ¢å¤
}

vrrp_instance VI_1 {
    state MASTER
    interface enp1s0
    virtual_router_id 51
    priority 101
    authentication {
        auth_type PASS
        auth_pass 42
    }
    virtual_ipaddress {
        192.168.122.170
    }
    track_script {
        check_haproxy
    }
}
</code></pre>
<p>demo-master-02ä¸ï¼<code>vim /etc/keepalived/keepalived.conf</code></p>
<pre><code class="language-bash">global_defs {
    router_id LVS_DEVEL
}
vrrp_script check_apiserver {
  script "/etc/keepalived/check_apiserver.sh"
  interval 3
  weight -2
  fall 10
  rise 2
}
vrrp_script check_haproxy {
    script "/usr/bin/pgrep haproxy"  # ä»æ£æ¥ haproxy è¿ç¨æ¯å¦å­å¨
    interval 2                       # æ¯ 2 ç§æ£æ¥ä¸æ¬¡
    weight 2                         # æ£æ¥æåæ¶æé+2ï¼éå¿éï¼ä»ç¨äºä¼åçº§è°æ´ï¼
    fall 1                           # 1 æ¬¡æ£æ¥å¤±è´¥å³å¤å®è¿ç¨å¼å¸¸
    rise 1                           # 1 æ¬¡æ£æ¥æåå³æ¢å¤
}

vrrp_instance VI_1 {
    state BACKUP
    interface enp1s0
    virtual_router_id 51
    priority 100
    authentication {
        auth_type PASS
        auth_pass 42
    }
    virtual_ipaddress {
        192.168.122.170
    }
    track_script {
        check_haproxy
    }
}
</code></pre>
<ol start="6">
<li>è³æ­¤haproxy+keepalivedçé¨ç½²åéç½®å®æ¯ï¼å¯ä»¥ææ¶åä¸å¯å¨æå¡ï¼å¾K8Sæ§å¶èç¹é¨ç½²å®æååè¿è¡å¯å¨ã</li>
<li>å¯å¨haproxyåkeepalivedï¼éªè¯vipæ¯å¦çå¬</li>
</ol>
<pre><code class="language-bash">systemctl enable --now haproxy.service
systemctl enable --now keepalived.service

ip a
2: enp1s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:20:d9:60 brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.171/24 brd 192.168.122.255 scope global noprefixroute enp1s0
       valid_lft forever preferred_lft forever
    inet 192.168.122.170/32 scope global proto keepalived enp1s0
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:ff:fe20:d960/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
</code></pre>
<blockquote>
<p>æ­¤æ¶å¯å¨ä¸»èç¹çå°VIP</p>
</blockquote>
<h3 id="é¨ç½²éç¾¤">é¨ç½²éç¾¤</h3>
<h4 id="æåéå">æåéå</h4>
<pre><code class="language-bash">kubeadm config images pull --image-repository registry.aliyuncs.com/google_containers
</code></pre>
<pre><code class="language-bash"># crictl images 
IMAGE                                                             TAG                 IMAGE ID            SIZE
registry.aliyuncs.com/google_containers/coredns                   v1.13.1             aa5e3ebc0dfed       23.6MB
registry.aliyuncs.com/google_containers/etcd                      3.6.6-0             0a108f7189562       23.6MB
registry.aliyuncs.com/google_containers/kube-apiserver            v1.35.0             5c6acd67e9cd1       27.7MB
registry.aliyuncs.com/google_containers/kube-controller-manager   v1.35.0             2c9a4b058bd7e       23.1MB
registry.aliyuncs.com/google_containers/kube-proxy                v1.35.0             32652ff1bbe6b       25.8MB
registry.aliyuncs.com/google_containers/kube-scheduler            v1.35.0             550794e3b12ac       17.2MB
registry.aliyuncs.com/google_containers/pause                     3.10.1              cd073f4c5f6a8       320kB
</code></pre>
<h4 id="åå§åkubeadméç½®">åå§åkubeadméç½®</h4>
<pre><code class="language-bash">kubeadm config print init-defaults &gt; kubeadm-init.yaml
</code></pre>
<p>æäºéè¦èªå®ä¹æ´æ¹çåæ°ä¸å¼ï¼</p>
<pre><code class="language-bash">apiVersion: kubeadm.k8s.io/v1beta4
kind: InitConfiguration
# apiserverçå°åä¸ç«¯å£
localAPIEndpoint:
  advertiseAddress: 192.168.122.171
  bindPort: 6443
# èç¹åç§°
  name: demo-master-01
  taints: null
---
apiVersion: kubeadm.k8s.io/v1beta4
# è¯ä¹¦æææï¼æéæ±å¯ä»¥æ¹ä¸º10å¹´
caCertificateValidityPeriod: 87600h0m0s
certificateValidityPeriod: 8760h0m0s
# å¤é¨etcdå°åéç½®ï¼è¥æ­¤å¤ä¸æå®ï¼åk8sä¼èªå·±åå»ºåèç¹etcd
etcd:
  external:
    endpoints:
    - https://192.168.122.171:2379
    - https://192.168.122.172:2379
    - https://192.168.122.173:2379
    caFile: "/etc/kubernetes/pki/etcd/ca.crt"
    certFile: "/etc/kubernetes/pki/apiserver-etcd-client.crt"
    keyFile: "/etc/kubernetes/pki/apiserver-etcd-client.key"
# éåä»åºå°åæ´æ¹
imageRepository: registry.aliyuncs.com/google_containers
kind: ClusterConfiguration
kubernetesVersion: 1.35.0
# svcçç½æ®µä¸podçç½æ®µæå®ï¼ä¸CNIç½ç»æä»¶æé©
networking:
  dnsDomain: cluster.local
  serviceSubnet: 10.96.0.0/16
  podSubnet: 10.98.0.0/16
# è¿æ¥æ§å¶å¹³é¢çå°åï¼æå®ä¸ºvipå°ååhaproxyççå¬ç«¯å£
controlPlaneEndpoint: "192.168.122.170:16443"
</code></pre>
<blockquote>
<p>ä»ä¿çäºéè¦æ³¨æä¸æ´æ¹çå­æ®µã</p>
</blockquote>
<h4 id="kubeadmåå»ºéç¾¤">kubeadmåå»ºéç¾¤</h4>
<ol>
<li>åå§åéç¾¤</li>
</ol>
<pre><code class="language-bash">kubeadm init --config=./kubeadm-init.yaml --upload-certs
</code></pre>
<blockquote>
<p>kubeadm init --skip-phases=addon/kube-proxyï¼è·³è¿kube-proxyç»ä»¶çå®è£</p>
</blockquote>
<ol start="2">
<li>æ ¹æ®æç¤ºï¼æ§è¡kubeconfigéç½®</li>
</ol>
<pre><code class="language-bash">To start administering your cluster from this node, you need to run the following as a regular user:

        mkdir -p $HOME/.kube
        sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
        sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<ol start="3">
<li>æ ¹æ®æç¤ºï¼å å¥æ°çæ§å¶èç¹ï¼å¨demo-master-02æ§è¡</li>
</ol>
<pre><code class="language-bash">kubeadm join 192.168.122.170:16443 --token abcdef.0123456789abcdef \
        --discovery-token-ca-cert-hash sha256:6d07b2c99b32777a816247f22bd36c52a9bba7a2547c9025f7be24073fdb6023 \
        --control-plane --certificate-key 0bbadf90b312676417c686ac4437800ca251a2e216f2aa9da02810bc66cf8325
</code></pre>
<ol start="4">
<li>æ ¹æ®æç¤ºï¼å å¥æ°çworkerèç¹ï¼å¨demo-worker-01æ§è¡</li>
</ol>
<pre><code class="language-bash">kubeadm join 192.168.122.170:16443 --token abcdef.0123456789abcdef \
        --discovery-token-ca-cert-hash sha256:6d07b2c99b32777a816247f22bd36c52a9bba7a2547c9025f7be24073fdb6023
</code></pre>
<ol start="5">
<li>æ¥çéç¾¤ç¶æ</li>
</ol>
<pre><code class="language-bash"># kubectl get nodes 
NAME             STATUS     ROLES           AGE     VERSION
demo-master-01   NotReady   control-plane   4m30s   v1.35.0
demo-master-02   NotReady   control-plane   103s    v1.35.0
demo-worker-01   NotReady   &lt;none&gt;          30s     v1.35.0

# kubectl get pod -n kube-system 
NAME                                     READY   STATUS    RESTARTS   AGE
coredns-bbdc5fdf6-8qmkt                  0/1     Pending   0          21m
coredns-bbdc5fdf6-k8qhn                  0/1     Pending   0          21m
kube-apiserver-demo-master-01            1/1     Running   0          21m
kube-apiserver-demo-master-02            1/1     Running   0          19m
kube-controller-manager-demo-master-01   1/1     Running   0          21m
kube-controller-manager-demo-master-02   1/1     Running   0          19m
kube-proxy-f78gj                         1/1     Running   0          21m
kube-proxy-hwf9q                         1/1     Running   0          19m
kube-proxy-wxn5r                         1/1     Running   0          18m
kube-scheduler-demo-master-01            1/1     Running   0          21m
kube-scheduler-demo-master-02            1/1     Running   0          19m
</code></pre>
<blockquote>
<p>æªå®è£CNIæä»¶ï¼éç¾¤ç¶æä¸ºNotReady</p>
</blockquote>
<h3 id="é¨ç½²cniæä»¶cilium">é¨ç½²CNIæä»¶cilium</h3>
<p>ciliumæ¯ç®åææµè¡çCNIæä»¶ä¹ä¸ï¼å¶åºäºeBPFï¼æ§è½é«ï¼ä¸æ¯æç½ç»è´è½½ãç­ç¥éç½®ãå¯è§æµä¸ä½åï¼ä½èé«æï¼å¯æ¿ä»£kube-proxyç»ä»¶ã</p>
<h4 id="é¨ç½²helmå·¥å·">é¨ç½²helmå·¥å·</h4>
<pre><code class="language-bash">wget https://get.helm.sh/helm-v4.1.0-linux-amd64.tar.gz
mv linux-amd64/helm /usr/bin/
</code></pre>
<pre><code class="language-bash"># helmå½ä»¤è¡¥å¨
source &lt;(helm completion bash)
helm completion bash &gt;/etc/bash_completion.d/helm
</code></pre>
<h4 id="é¨ç½²cilium-chart">é¨ç½²cilium chart</h4>
<ol>
<li>æ·»å ciliumä»åº</li>
</ol>
<pre><code class="language-bash"># æ·»å repo
helm repo add cilium https://helm.cilium.io/

# æ¥ççæ¬
helm search repo cilium/cilium --versions | head
</code></pre>
<ol start="2">
<li>è·åå¹¶ç¼è¾chart</li>
</ol>
<pre><code class="language-bash">helm pull cilium/cilium --untar --version 1.18.6
</code></pre>
<p>ä¿®æ¹å ä¸ªå³é®åéå¼ï¼</p>
<p>vim cilium/values.yaml</p>
<pre><code class="language-bash"># æ¿æ¢kube-Proxyç»ä»¶
kubeProxyReplacement: "true"
# æå®apiserverå°åï¼æ­¤å¤åVIP
k8sServiceHost: "192.168.122.170"
# æå®apiserverç«¯å£ï¼æ­¤å¤åhaproxyçè´è½½ç«¯å£
k8sServicePort: "16443"
# podçipamèå´
clusterPoolIPv4PodCIDRList: ["10.98.0.0/16"]
# æ¯ä¸ªnodeèç¹ä¸podç½æ®µçæ©ç ä½
clusterPoolIPv4MaskSize: 24
</code></pre>
<ol start="3">
<li>æåæåæåå¤æå¿é¡»éå</li>
</ol>
<pre><code class="language-bash">quay.io/cilium/cilium:v1.18.6
quay.io/cilium/cilium-envoy:v1.35.9-1767794330-db497dd19e346b39d81d7b5c0dedf6c812bcc5c9
quay.io/cilium/operator-generic:v1.18.6
</code></pre>
<ol start="4">
<li>å é¤kube-proxyç»ä»¶</li>
</ol>
<pre><code class="language-bash">kubectl -n kube-system delete ds kube-proxy
kubectl -n kube-system delete cm kube-proxy
# Run on each node with root permissions:
iptables-save | grep -v KUBE | iptables-restore
</code></pre>
<blockquote>
<p>kubeadm init --skip-phases=addon/kube-proxyå¯ä»¥å¨inité¶æ®µç´æ¥è·³è¿å®è£kube-proxyã</p>
</blockquote>
<ol start="5">
<li>é¨ç½²cilium chart</li>
</ol>
<pre><code class="language-bash">helm install cilium cilium -f cilium/values.yaml --namespace kube-system
</code></pre>
<ol start="6">
<li>æ¥çpodç¶æ</li>
</ol>
<pre><code class="language-bash"># kubectl get pod -n kube-system 
NAME                                     READY   STATUS    RESTARTS       AGE
cilium-8lqwz                             2/2     Running   0              52s
cilium-envoy-78rx5                       1/1     Running   0              52s
cilium-envoy-8ssc8                       1/1     Running   0              52s
cilium-envoy-sc92g                       1/1     Running   0              52s
cilium-nnl6k                             2/2     Running   0              52s
cilium-operator-698cfb64f9-d2p2n         1/1     Running   0              52s
cilium-operator-698cfb64f9-smdvt         1/1     Running   0              52s
cilium-vlx9m                             2/2     Running   0              52s
</code></pre>
<h4 id="å®è£cilium-cliå·¥å·">å®è£cilium cliå·¥å·</h4>
<pre><code class="language-bash">wget https://github.com/cilium/cilium-cli/releases/download/v0.19.0/cilium-linux-amd64.tar.gz
tar xzvfC cilium-linux-amd64.tar.gz /usr/local/bin
</code></pre>
<p>æ¥çciliuméç¾¤ç¶æï¼</p>
<pre><code class="language-bash"># cilium status --wait
    /Â¯Â¯\
 /Â¯Â¯\__/Â¯Â¯\    Cilium:             OK
 \__/Â¯Â¯\__/    Operator:           OK
 /Â¯Â¯\__/Â¯Â¯\    Envoy DaemonSet:    OK
 \__/Â¯Â¯\__/    Hubble Relay:       disabled
    \__/       ClusterMesh:        disabled

DaemonSet              cilium                   Desired: 3, Ready: 3/3, Available: 3/3
DaemonSet              cilium-envoy             Desired: 3, Ready: 3/3, Available: 3/3
Deployment             cilium-operator          Desired: 2, Ready: 2/2, Available: 2/2
Containers:            cilium                   Running: 3
                       cilium-envoy             Running: 3
                       cilium-operator          Running: 2
                       clustermesh-apiserver    
                       hubble-relay             
Cluster Pods:          2/2 managed by Cilium
</code></pre>
<h4 id="å¼å¯åç®¡çhubble">å¼å¯åç®¡çhubble</h4>
<ol>
<li>å¼å¯hubbleè¿è¡ç½ç»è§æµï¼</li>
</ol>
<pre><code class="language-bash"># å¼å¯hubble
cilium hubble enable
# å¼å¯hubble ui
cilium hubble enable --ui
</code></pre>
<blockquote>
<p>ä¹å¯ä»¥å¨chart value.yamlä¸­ä¿®æ¹ï¼hubble.relay.enabled=trueãhubble.ui.enabled=true</p>
</blockquote>
<ol start="2">
<li>podå¯å¨å®æ¯ï¼ä¿®æ¹svcæ´é²ç«¯å£ç»å¤é¨è®¿é®</li>
</ol>
<pre><code class="language-bash"># kubectl get pod -n kube-system | grep hubble
hubble-relay-66495f87cb-78gpg            1/1     Running   0   16h
hubble-ui-7bcb645fcd-g99rm               2/2     Running   0   16h

# kubectl get svc -n kube-system | grep ui
hubble-ui      NodePort    10.96.75.161   &lt;none&gt;        80:32000/TCP             16h
</code></pre>
<ol start="3">
<li>æµè§å¨è®¿é®<code>http://192.168.122.171:32000/</code>å°±å¯ä»¥æ¥çæµéè½¬åè¯¦æäºï¼</li>
</ol>
<h3 id="æ£æ¥k8séç¾¤ç¶æ">æ£æ¥k8séç¾¤ç¶æ</h3>
<pre><code class="language-bash"># kubectl get nodes 
NAME             STATUS   ROLES           AGE     VERSION
demo-master-01   Ready    control-plane   4d18h   v1.35.0
demo-master-02   Ready    control-plane   4d18h   v1.35.0
demo-worker-01   Ready    &lt;none&gt;          4d18h   v1.35.0
</code></pre>
<p>å°æ­¤ï¼k8sé«å¯ç¨éç¾¤å·²æ­å»ºå®æ¯ï¼å®éçäº§ç¯å¢ä¸­ï¼etcdãkeepalivedãhaproxyåºå°½å¯è½çéæ©åç¬çæå¡å¨è¿è¡é¨ç½²ï¼ä¸å¨éç¾¤è§æ¨¡è¾å¤§æ¶ï¼æ ¹æ®å®éæåµè¿è¡ä¼åã</p>
<h2 id="ç»è¯­">ç»è¯­</h2>
<p>æ¬æä»¥k8så®æ¹çkubeadmå·¥å·æå»ºé«å¯ç¨éç¾¤ï¼ä¸åºæ¬æææå¡é½æ¯äºè¿å¶å®è£çæ¹å¼ï¼æ­¤ç§æ¹å¼éç¨æ§è¾å¼ºï¼è¥æ¨æ¯armæ¶ææºå¨åéä¸è½½å¯¹åºæå¡çarmçæ¬çäºè¿å¶æä»¶å³å¯ï¼æ­¥éª¤å ä¹ç¸åãç®åå¸é¢ä¸å¤§å¤k8séç¾¤èªå¨åé¨ç½²å·¥å·é½æ¯éç¨æ­¤ç§æ¹å¼å®è£çã</p>
<p>æ¬æçç®çå°±æ¯å¸¦é¢å¤§å®¶äºè§£å¨å½äº§çé¶æ²³éºéºv11ä¸é¨ç½²é«å¯ç¨k8sçå¨è¿ç¨ï¼é¡ºä¾¿çè§£èªå¨åé¨ç½²k8så·¥å·çåºå±é»è¾ï¼å½ç¶ï¼çæ­£ççäº§ç¯å¢å¤§å®¶è¯å®æ¯ä¼åéæ©èªå¨åé¨ç½²ï¼é¶æ²³éºéºv11å®æ¹ä¹æ¨åºäºèªå¨åé¨ç½²å·¥å·ï¼å¤§å®¶å¯ä»¥å°è¯çä½¿ç¨ä¸ä¸~</p>
<p>åç»­ä¼éå¯¹ç½ç»æä»¶ciliumè¿è¡ä¸æ³¢ç½ç»èµ°åæååæï¼æ¥æ·±å¥äºè§£ä¸ä¸å¶åçï¼æ¬¢è¿æå´è¶£çæåå³æ³¨ã</p>
<p><strong>æåæ¾ä¸ä¸æ¬æ¬¡é¨ç½²æä½¿ç¨å°çææå®è£ååéåï¼<a href="https://pan.baidu.com/s/1P-drNSFvcdXMtbEW-G_r5g?pwd=6ui8" target="_blank" rel="noopener nofollow">ç¹å»è¿é</a>è·åã</strong></p>
<p><strong>åèé¾æ¥ï¼</strong></p>
<p><a href="https://kubernetes.io/zh-cn/docs/concepts/architecture/cgroups/" target="_blank" rel="noopener nofollow">å³äºcgroup v2ä½¿ç¨ä¸ä»ç»</a></p>
<p><a href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md" target="_blank" rel="noopener nofollow">containerdå®æ¹é¨ç½²æå</a></p>
<p><a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/" target="_blank" rel="noopener nofollow">kubeadmãkubeletãkubectlå®æ¹é¨ç½²æå</a></p>
<p><a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/" target="_blank" rel="noopener nofollow">kubeadméç¾¤å®è£å®æ¹å¼å¯¼æå</a></p>
<p><a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/" target="_blank" rel="noopener nofollow">å®¹å¨è¿è¡æ¶cgroupé©±å¨å®æ¹æå¯¼æå</a></p>
<p><a href="https://docs.cilium.io/en/stable/#getting-started" target="_blank" rel="noopener nofollow">ciliumå®æ¹æå¯¼æå</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-03 14:58">2026-02-03 14:57</span>&nbsp;
<a href="https://www.cnblogs.com/v-fan">å¡åæçæ»åç®</a>&nbsp;
éè¯»(<span id="post_view_count">69</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19569414);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19569414', targetLink: 'https://www.cnblogs.com/v-fan/p/19569414', title: 'ææ°ï¼é¶æ²³éºéºv11 kubeadmé¨ç½²k8s v1.35.0é«å¯ç¨éç¾¤' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ·±å¥çè§£åéå¶åæ¢ ]]></title>
    <link>https://www.cnblogs.com/zhaoweiwei/p/19522497/FFT</link>
    <guid>84e3bba35045e45349cbb4bd9d5250b0</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/zhaoweiwei/p/19522497/FFT" title="åå¸äº 2026-02-03 14:45">
    <span role="heading" aria-level="2">æ·±å¥çè§£åéå¶åæ¢</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æè¯¦ç»ä»ç»åéå¶åæ¢çç¸å³æ¦å¿µï¼å¹¶ç»åºå¿«éåéå¶åæ¢çéå½åè¿­ä»£ä¸¤ç§ç®æ³æºç ï¼æåç»åºäºå¿«éåéå¶åæ¢å¨é³é¢åå¾åé¢ç¨çåºç¨å®ä¾ï¼
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>1 åºç¡æ¦å¿µ</h1>
<h2>1.1 åéå¶çº§æ°</h2>
<h3>1 å¨æå½æ°</h3>
<p>è¥å½æ°f(x)æ»¡è¶³ï¼å­å¨éé¶å¸¸æ°Tï¼å¯¹ä»»æxæ<em>f(x+T) = f(x)</em>ï¼åç§°<em>f(x)</em>ä¸ºå¨æå½æ°ï¼Tä¸ºå¶å¨æï¼æå°æ­£å¨æç§°ä¸º<strong>åºæ¬å¨æ</strong>ï¼è®°ä¸ºT<sub>0</sub>ï¼ãåéå¶çº§æ°ä¸­ï¼æå¸¸ç¨ä»¥2Ïä¸ºå¨æçå½æ°ï¼T=2Ïï¼ï¼å¶ä»å¨æçå½æ°å¯éè¿åéæ¿æ¢è½¬åä¸º2Ïå¨æï¼å æ­¤æ ¸å¿ç ç©¶2Ïå¨æå½æ°ã</p>
<h3>2 ä¸è§å½æ°ç³»çæ­£äº¤æ§</h3>
<p>åéå¶çº§æ°çæ¬è´¨æ¯<span>å¨ä¸è§å½æ°ç³»ä¸­å¯¹å¨æå½æ°åæ­£äº¤åè§£ï¼ç±»ä¼¼å¹³é¢åéå¨x<span>ãyè½´ä¸çåè§£ï¼ä¸è§å½æ°ç³»å°±æ¯å¨æå½æ°ç©ºé´çä¸ç»<span>æ­£äº¤åºã</span></span></span></p>
<p><span><span><span>ï¼1ï¼æ åæ­£äº¤ä¸è§å½æ°ç³»ï¼2Ïå¨æï¼<br></span></span></span></p>
<p><span><span><span><span><span><span>{1,cos<em>x</em>,sin<em>x,</em>cos<em>2x</em>,sin<em>2x</em>,â¦,cos<em>nx</em>,sin<em>nx</em>,â¦}</span></span></span></span></span></span></p>
<div>å¶ä¸­nä¸ºæ­£æ´æ°ï¼1å¯ä»¥çä½cos0xã</div>
<div>ï¼2ï¼æ­£äº¤æ§çå®ä¹&nbsp;</div>
<p><span><span><span>å¯¹ä¸è¿°ä¸è§å½æ°ç³»ä¸­<span>ä»»æä¸¤ä¸ªä¸åçå½æ°<span><span>Ï<sub>m</sub>â(x)å<span><span>Ï<sub>nâ</sub>(x)ï¼æ»¡è¶³ï¼</span></span></span></span></span></span></span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260123161629850-520864769.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¯¹åä¸ä¸ªå½æ°ï¼ç§¯åç»æéé¶ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260123161705334-1222793239.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ï¼3ï¼æ ¸å¿æ­£äº¤ç§¯åå¬å¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260123161754523-450618120.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><strong>æ­£äº¤æ§çæä¹</strong>ï¼ä¸è§å½æ°ç³»ä¸­çåä¸ªåºå½æ°âäºä¸å¹²æ°âï¼åè§£åçæ¯ä¸ªæ­£ä½å¼¦é¡¹çç³»æ°å¯ç¬ç«è®¡ç®ï¼è¿æ¯åéå¶çº§æ°è½æ±è§£çå³é®ã</p>
<h3>3 åéå¶çº§æ°</h3>
<p>æ³å½æ°å­¦å®¶åéå¶è®¤ä¸ºï¼ä»»ä½å¨æå½æ°é½å¯ä»¥ç¨æ­£å¼¦å½æ°åä½å¼¦å½æ°ææçæ ç©·çº§æ°æ¥è¡¨ç¤ºï¼éæ©æ­£å¼¦å½æ°ä¸ä½å¼¦å½æ°ä½ä¸ºåºå½æ°æ¯å ä¸ºå®ä»¬æ¯æ­£äº¤çï¼ï¼åä¸ç§°åéå¶çº§æ°ä¸ºä¸ç§ç¹æ®çä¸è§çº§æ°ï¼æ ¹æ®æ¬§æå¬å¼ï¼ä¸è§å½æ°åè½åæææ°å½¢å¼ï¼ä¹ç§°åç«å¶çº§æ°ä¸ºä¸ç§ææ°çº§æ°ãå¨æ°å­¦ä¸­ï¼ä¸è§çº§æ°æ¯ä»»ä½å·æä¸è¿°å½¢å¼ççº§æ°ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260123160454187-1477445403.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å½A<sub>n</sub>åB<sub>n</sub>å·æä»¥ä¸å½¢å¼æ¶ï¼è¯¥çº§æ°ç§°ä¸ºåç«å¶çº§æ°ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260123160641857-1444839643.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¶ä¸­f(x)æ¯å¯ç§¯å½æ°ãä¸é¢ç»åº2Ïå¨æå½æ°çåéå¶çº§æ°å®ä¹ï¼</p>
<p>è®¾f(x)æ¯ä»¥2Ïä¸ºå¨æçå½æ°ï¼ä¸å¨[-Ï,&nbsp;Ï]ä¸å¯ç§¯ï¼åå¶åéå¶çº§æ°ä¸ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260123162203699-209431809.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ç¬¦å·è¯´æï¼</p>
<p>~ï¼è¡¨ç¤ºâå±å¼ä¸ºåéå¶çº§æ°âï¼èéä¸¥æ ¼ç¸ç­ï¼éæ»¡è¶³æ¶ææ¡ä»¶æç¸ç­ï¼ï¼</p>
<p>a<sub>0</sub>/2ï¼ç´æµåé/é¶é¢é¡¹ï¼æ¯å½æ°f(x)å¨ä¸ä¸ªå¨æåçå¹³åå¼ï¼</p>
<p>a<sub>n</sub>cos<em>&nbsp;nx</em>ï¼ä½å¼¦é¡¹/å¶æ¬¡è°æ³¢ï¼å¯¹åºå¨æå½æ°çå¶å½æ°åéï¼</p>
<p>b<sub>n</sub>sin<em> nx</em>ï¼æ­£å¼¦é¡¹/å¥æ¬¡è°æ³¢ï¼å¯¹åºå¨æå½æ°çå¥å½æ°åéï¼</p>
<p>a<sub>0</sub>, a<sub>n</sub>, b<sub>n</sub>ï¼åéå¶ç³»æ°ï¼æ¯å¯ä¸ç¡®å®çå¸¸æ°ï¼æf(x)å³å®ã</p>
<h2>1.2 åéå¶åæ¢</h2>
<h3>1 æ¬§æå¬å¼ï¼Eulerâs formulaï¼</h3>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260123163235634-1712793922.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¶ä¸­ï¼eæ¯èªç¶å¸¸æ°ï¼çº¦ç­äº2.71828ï¼iæ¯èæ°åä½æ»¡è¶³i<sup>2</sup>=-1ï¼Î¸æ¯å¤ææ°çè¾è§âRï¼å¯¹åºå¤å¹³é¢ä¸çæè½¬è§åº¦ãå¯¹äºè¯¥å¬å¼å½Î¸=Ïæ¶ï¼æe<sup>iÏ</sup> + 1 = 0ï¼è¿ä¸ªå¬å¼å¨åéå¶åæ¢ä¸­èµ·å°å³é®ä½ç¨ã</p>
<h3>2 åéå¶åæ¢ï¼Fourier Transform, FTï¼</h3>
<p>åéå¶åæ¢æ¯å°æ¶åçè¿ç»­å½æ°æ å°å°é¢åè¿ç»­å½æ°çæ°å­¦åæ¢ï¼æ¯è°ååæçæ ¸å¿å·¥å·ï¼æ­ç¤ºäºâä»»æè¿ç»­å¨æ/éå¨æå½æ°åå¯åè§£ä¸ºä¸åé¢ççæ­£å¼¦/ä½å¼¦å½æ°å å âçæ¬è´¨ãç°ç»åºè¿ç»­åéå¶åæ¢ï¼Continuous Fourier Transform, CFTï¼ç¸å³å®ä¹ï¼éç¨äºå®ä¹åä¸ºå¨ä½å®æ°Rãæ»¡è¶³çå©åé·æ¡ä»¶ï¼Dirichletï¼çè¿ç»­å½æ°f(t)ï¼å¶ä¸­tä¸ºæ¶åèªåéï¼éå¸¸è¡¨ç¤ºæ¶é´ï¼ï¼åæ¢åå¾å°é¢åå½æ°F(Ï)ï¼Ïä¸ºè§é¢çï¼rad/sï¼ã</p>
<p>ï¼1ï¼æ­£åæ¢ï¼æ¶åâé¢åï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260123170719778-789709355.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ç§¯ååºé´(ââ,+â)å¯¹åºéå¨æå½æ°çæ¶åæ¯æ éçï¼éå¯¹å¨ä½å®æ°åç§¯åï¼åæ¢æ¬è´¨æ¯ï¼ç¨ææé¢ççå¤ææ°å½æ°ä½ä¸ºâåºå½æ°âï¼å¯¹<span class="katex"><span class="katex-mathml">f(t)<span class="katex-html"><span class="base"><span class="strut"><span class="mord mathnormal"><span class="mopen"><span class="mord mathnormal"><span class="mclose">åæå½±ã</span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><span class="katex-html"><span class="base"><span class="strut"><span class="mord mathnormal"><span class="mopen"><span class="mord mathnormal"><span class="mclose">ï¼2ï¼éåæ¢ï¼é¢åâæ¶åï¼</span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><span class="katex-html"><span class="base"><span class="strut"><span class="mord mathnormal"><span class="mopen"><span class="mord mathnormal"><span class="mclose">åéå¶åæ¢æ¯å¯éåæ¢ï¼ä»é¢åå½æ°F(Ï)è¿åæ¶åf(t)çå¬å¼ä¸ºï¼</span></span></span></span></span></span></span></span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260123171313838-843336180.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å³é®ç³»æ°1/2Ïï¼è¯¥ç³»æ°æ¯ä¸ºäºæ»¡è¶³âæ­£éåæ¢çå½ä¸æ§âï¼ä¹æææå°ç³»æ°æåä¸º1/sqrt(<span><span>2Ïâ)åå«æ¾å¨æ­£ãéåæ¢ä¸­ï¼æ°å­¦ä¸æ´å¯¹ç§°ï¼ï¼ä¸¤ç§å½¢å¼ç­ä»·ã<br></span></span></p>
<h3><span><span>3 ç¦»æ£åéå¶åæ¢ï¼Discrete Fourier Transformï¼DFTï¼</span></span></h3>
<p>DFTæ¯ä¸ç§çº¿æ§åæ¢ï¼æä¸ä¸ªæéé¿çç¦»æ£åºåï¼ä»âæ¶é´/ç³»æ°åâåæ¢å°âé¢ç/ç¹å¼åâãå¶æ°å­¦å®ä¹ä¸ºç»å®é¿åº¦ä¸ºnçå¤æ°åºåï¼<em>x=(x<sub>0</sub>, x<sub>1</sub>, ..., x<sub>n-1</sub>)</em>ï¼ä»¤ï¼<em>Ï = e<sup>-2Ïi/n</sup></em>ï¼å®ä¹å¶ç¦»æ£åéå¶åæ¢ï¼DFTï¼ä¸ºåºåï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260128155659439-1976105299.png" alt="image" width="321" height="70" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><em>x<sub>j</sub></em>æ¯è¾å¥åºåï¼æ¶åä¿¡å·ï¼ï¼<em>X<sub>k</sub></em>æ¯è¾åºåºåï¼é¢åä¿¡å·ï¼ï¼éè¿å°æ¶åä¿¡å·ä¸ä¸ç³»åä¸åé¢ççå¤ææ°å½æ°è¿è¡åç§¯ï¼å¾å°æ¯ä¸ªé¢çåéå¨åå§ä¿¡å·ä¸­çâå«éâãDFTæ¯ä¸ä¸ªçº¿æ§åæ¢ï¼æ¬è´¨æ¯<em>X = F*x</em>ï¼å¶ä¸­Fæ¯ä¸ä¸ªèå¾·èå¾·ï¼Vandermondeï¼ç©éµï¼å³ä»çº¿æ§ä»£æ°è§åº¦çï¼DFT = Vandermondeåæ¢ãä»ç©éµè¿ç®å¯ä»¥çåºï¼è¦å¾å°æ¯ä¸ªé¢çåéï¼éè¦è¿è¡næ¬¡ä¹æ³ån-1æ¬¡å æ³è¿ç®ï¼å®ææ´ä¸ªåæ¢éè¦n<sup>2</sup>æ¬¡ä¹æ³ån(n-1)æ¬¡å æ³è¿ç®ï¼æä»¥å®æ´åæ¢çå¤æåº¦æ¯O(n<sup>2</sup>)ï¼å½åºåé¿åº¦nè¾å¤§æ¶ï¼è®¡ç®éä¼åå¾æå¶åºå¤§ï¼éå¶äºDFTå¨å®éåºç¨ä¸­çæçã</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260128155733599-751298943.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ä»¥å¤é¡¹å¼<em>A(x)=a<sub>0</sub>+a<sub>1</sub>x+a<sub>2</sub>x<sup>2</sup>+...+a<sub>n-1</sub>x<sup>n-1</sup></em>ä¸ºä¾ï¼åä¸è¿°ç¦»æ£åºåå¯ä»¥çä½æ¯å¤é¡¹å¼ç³»æ°è¡¨ç¤ºæ³ï¼coefficient formï¼ä¸­çç³»æ°ï¼å³<em>x = a = (a<sub>0</sub>, a<sub>1</sub>, ..., a<sub>n-1</sub>ï¼</em>ï¼éæ©ç¹æ®çâç¹ââânæ¬¡åä½æ ¹ï¼<em>Ï = e<sup>2Ïi/n</sup></em>ï¼å®æ»¡è¶³ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260128124328491-889419062.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ä»¥n=11ä¸ºä¾ï¼å¾ä¸­ææ<em>Ï<sup>i</sup></em>é½æ¯11æ¬¡åä½æ ¹ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129102811489-1505291339.png" alt="image" width="322" height="314" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>èènä¸ªäºä¸ç¸åçç¹ï¼<em>1,&nbsp;Ï,&nbsp;Ï<sup>2</sup>, ...,&nbsp;Ï<sup>n-1</sup></em>ï¼å°å¶ä»£å¥<em>A(x)</em>å¤é¡¹å¼ï¼åæï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260128125054218-1282377609.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¯è§<em>X<sub>k</sub> = A(Ï<sup>-k</sup>)</em>ï¼å³DFTçè®¡ç®ç»æï¼æ°å¥½ç­ä»·äºå¨åä½æ ¹ä¸çå¤é¡¹å¼æ±å¼ï¼å¯¹åºå¤é¡¹å¼çç¹å¼è¡¨ç¤ºæ³ï¼ã</p>
<p>éç¦»æ£åéå¶åæ¢ï¼IDFTï¼ç±ä»¥ä¸å¬å¼ç»åºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260128181138702-2110135213.png" alt="image" width="162" height="77" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>åéå¶çº§æ°ãåéå¶åæ¢åDFTåºå«ç±ä¸è¡¨ç»åºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260128171836655-1924902784.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<h3>4 å¿«éåéå¶åæ¢ï¼Fast Fourier Transformï¼FFTï¼</h3>
<p>1965å¹´ï¼J.W.åºå©åT.W.å¾åºæåºäºèåçCooley-Tukeyç®æ³ï¼å³å¿«éåéå¶åæ¢ï¼FFTï¼ãFFTç®æ³çæ ¸å¿æ¯å©ç¨æè½¬å å­çå¨ææ§ãå¯¹ç§°æ§åå¯çº¦æ§ï¼å°é¿åºåçDFTåè§£ä¸ºç­åºåçDFTï¼ä»èå¤§å¹åå°è®¡ç®éãé¦åç»åºåä½æ ¹çä¸ä¸ªå¼çï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129104718146-1091039001.png" alt="image" width="272" height="93" loading="lazy"></p>
<p>ä¸å¥è¯æ¦æ¬FFTï¼å©ç¨næ¬¡åä½æ ¹çå¨ææ§ä¸å¯¹ç§°æ§ï¼æä¸ä¸ªè§æ¨¡ä¸ºnçDFTï¼ææä¸¤ä¸ªè§æ¨¡ä¸ºN/2çDFTãå¨ç»å¸FFTç®æ³ï¼Cooley-Tukeyç®æ³ï¼ä¸­åè®¾n=2<sup>m</sup>ï¼æåºåææâå¶æ°é¡¹+å¥æ°é¡¹âï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129115917584-129576767.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>åå¯ä»¥å°DFTæå¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129120821297-7172978.png" alt="image" width="532" height="81" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å©ç¨æåå¼çå¯å°ä¸å¼ç®åä¸ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129122101594-403839310.png" alt="image" width="196" height="34" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¶ä¸­ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129122526097-623129615.png" alt="image" width="213" height="172" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ä»¥ä¸å°1ä¸ªåå«næ¬¡ä¹æ³çDFTåæä¸¤ä¸ªn/2æ¬¡ä¹æ³çDFTï¼å¦å¤ç±Ï<sub>n</sub><sup>n/2+k</sup> = -Ï<sub>n</sub><sup>k</sup>å¯ä»¥è¿ä¸æ­¥å¾å°è¿­ä»£å¬å¼ï¼1ï¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260130174113532-1641485917.png" alt="image" width="376" height="78" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ä»¥ä¸å°±æ¯æè°çè¶å½¢è¿ç®ï¼butterflyï¼ï¼ä¸æ¬¡ç®åºä¸¤ä¸ªè¾åºãå¯è§ä¸ä¸ªé¿åº¦ä¸ºnçDFTè¢«ææä¸¤ä¸ªé¿åº¦æ¯n/2çDFTån/2æ¬¡è¶å½¢åå¹¶ï¼æä»¥æ¶é´å¤æåº¦ä¸ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129143456252-107829582.png" alt="image" width="237" height="29" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>è¿é<em>2T(n/2)</em>è¡¨ç¤ºï¼è¦è§£å³ä¸ä¸ªè§æ¨¡ä¸º<em>n</em>çé®é¢ï¼éè¦âè°ç¨ä¸¤æ¬¡âè§æ¨¡ä¸º<em>n/2</em>çåç±»é®é¢ï¼æ¯ä¸æ¬¡çä»£ä»·æ¯<em>T(n/2)</em>ï¼<em>cn</em>è¡¨ç¤ºï¼å½åè¿ä¸å±ï¼ä¸ºäºæä¸¤ä¸ªå­FFTçç»æâåå¹¶âæåçè®¡ç®éãä¸ä¸ªæ åçradix-2è¶å½¢ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129142325972-1041311975.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>éè¦ï¼1æ¬¡å¤æ°ä¹æ³<em>Ïb</em>å2æ¬¡å¤æ°å åæ³ï¼é½æ¯å¸¸æ°çº§æä½å¯è®°ä¸ºO(1)ï¼å¯¹äºé¿åº¦ä¸ºnçFFTæ¯ä¸å±æn/2ä¸ªè¶å½¢ï¼æä»¥æ¯å±è¶å½¢è®¡ç®éæ¯n/2xO(1)=O(n)ï¼å¯ä»¥è®°ä¸ºcnï¼è¿éçcå°±æ¯ä¸ä¸ªè¶å½¢éè¦å¤å°ä¸ªâåºç¡è¿ç®âçå¸¸æ°å å­ãæä»¥éçå±æ°éå¢æä»¥ä¸æ¶é´å¤æåº¦æ¨å¯¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129144210035-167113917.png" alt="image" width="489" height="153" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>éå½ç»æ­¢æ¡ä»¶æ¯å½ï¼<em>n/2<sup>k</sup>=1</em>ï¼è¿æ¶<em>k=log<sub>2</sub>n</em>ï¼ä¸è¿°æ¨å¯¼æç»ç»æä¸ºï¼<em>T(n)=n*T(1)+cnlog<sub>2</sub>n</em>ï¼å¿½ç¥å¸¸æ°å¾æç»å¤æåº¦å¬å¼<em>T(n)=O(nlog<sub>2</sub>n)</em>ã</p>
<p>ä»¥ä¸ç»åºäºå¿«éåéå¶åæ¢ï¼å¿«éåéå¶éåæ¢ï¼IFFTï¼Inverse FFTï¼å®ä¹ååæè¿ç¨ä¸æ­£åæ¢ç±»ä¼¼ï¼ä¸ºäºå¬å¼ç®æ´æ­£åæ¢åæè¿ç¨å<em>Ï = e<sup>-2Ïi/n</sup></em>ï¼å®éä¸å¨ä¸¥æ ¼çæ°å­¦å®ä¹ä¸­ä¸è¬å<em>Ï = e<sup>2Ïi/n</sup></em>ï¼æ­£ååä½æ ¹ï¼ï¼æ­¤æ¶æ­£åæ¢åéåæ¢å®ä¹å¦ä¸ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129155724698-1691263367.png" alt="image" width="412" height="190" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>æ­£åæ¢ç¨äºæè§£ä¿¡å·ï¼è·åå¨æ­£äº¤åºä¸çæå½±ï¼éåæ¢ç¨äºåæä¿¡å·ï¼å®ææ­£äº¤åºæå½±çå å ã</p>
<h2>1.3 NTTï¼Number Theoretic Transformï¼</h2>
<p>NTT = å¨æéå/æ¨¡æ´æ°ç¯ä¸­è¿è¡çFFTï¼å³NTTæ¯æFFTä¸­çâå¤æ°åä½æ ¹âæ¢æäºâæ¨¡æä¹ä¸çåä½æ ¹âï¼ç»æå®å¨ä¸è´ï¼åªæ¯âæ°åâä¸åãFFTä¸»è¦å­å¨3æ¹é¢é®é¢ï¼ç¨çæ¯å¤æ°ãææµ®ç¹è¯¯å·®ãå¨å¯ç å­¦/å¤§æ´æ°/ç²¾ç¡®å¤é¡¹å¼è¿ç®ä¸­ä¸å¯æ¥åï¼èNTTæ­£å¥½å¯ä»¥è§£å³è¿äºé®é¢ãNTTå·¥ä½ç©ºé´æ¯æéåï¼éå¸¸éF<em><sub>p</sub></em>ï¼<em>p</em>æ¯ç´ æ°ï¼ææè¿ç®é½åºäºmod <em>p</em>ï¼å¨NTTä¸­ï¼éè¦æ¾Ïï¼æ¨¡pä¸çnæ¬¡åå§åä½æ ¹ï¼ï¼å®æ»¡è¶³ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129161753182-2114601709.png" alt="image" width="527" height="34" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>è®¾æ¨¡æ°pï¼n|(p-1)ï¼Ïæ¯næ¬¡åå§åä½æ ¹ï¼NTTç¸å³å®ä¹å¦ä¸ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129162400466-958332138.png" alt="image" width="473" height="201" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>åFFTç¸å³å¯¹æ¯å¦ä¸ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129162541142-569885544.png" alt="image" width="668" height="229" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<h1>2 ç®æ³å®ç°</h1>
<p>çè§£äºFFTçæ°å­¦åçåï¼æä»¬éè¦å°å¶è½¬åä¸ºå¯æ§è¡çä»£ç ãFFTç®æ³æå¤ç§å®ç°æ¹å¼ï¼åæ¬éå½å®ç°ãè¿­ä»£å®ç°ååºäºç¹å®å¹³å°çä¼åå®ç°ã</p>
<h2>2.1 éå½å®ç°FFT</h2>
<p>éå½å®ç°æ¯æç´è§çFFTå®ç°æ¹å¼ï¼å®ç´æ¥å¯¹åºCooley-Tukeyç®æ³çåæ²»ææ³ãéå½ç®æ³ä¸æ­å°é®é¢åè§£ä¸ºæ´å°çå­é®é¢ï¼ç´å°è¾¾å°åºæ¬æåµï¼2ç¹æ1ç¹DFTï¼ã</p>
<div class="cnblogs_code"><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" id="code_img_closed_ffe0d173-e88c-4224-89a8-11075c1c927d" class="code_img_closed"><img src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" id="code_img_opened_ffe0d173-e88c-4224-89a8-11075c1c927d" class="code_img_opened" style="display: none">
<div id="cnblogs_code_open_ffe0d173-e88c-4224-89a8-11075c1c927d" class="cnblogs_code_hide">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> numpy as np
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> matplotlib.pyplot as plt

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¾ç½®å­ä½ï¼ç¡®ä¿ä¸­ææ¾ç¤º</span>
plt.rcParams[<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">font.sans-serif</span><span style="color: rgba(128, 0, 0, 1)">'</span>] = [<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">SimHei</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">]
plt.rcParams[</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">axes.unicode_minus</span><span style="color: rgba(128, 0, 0, 1)">'</span>] =<span style="color: rgba(0, 0, 0, 1)"> False

</span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> fft_recursive(x):
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">
    éå½å®ç°å¿«éåéå¶åæ¢
    æ³¨æï¼è¾å¥åéxçé¿åº¦å¿é¡»æ¯2çå¹æ¬¡
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(0, 0, 0, 1)">
    n </span>=<span style="color: rgba(0, 0, 0, 1)"> len(x)
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> n == 1<span style="color: rgba(0, 0, 0, 1)">:
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> x
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> åå«è®¡ç®å¶æ°ç´¢å¼åå¥æ°ç´¢å¼åç´ çFFT</span>
    even_fft = fft_recursive(x[0::2])  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¶æ°ç´¢å¼</span>
    odd_fft = fft_recursive(x[1::2])   <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¥æ°ç´¢å¼</span>
    
    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¡ç®æè½¬å å­</span>
    w = [np.exp(-2j * np.pi * k / n) <span style="color: rgba(0, 0, 255, 1)">for</span> k <span style="color: rgba(0, 0, 255, 1)">in</span> range(n//2<span style="color: rgba(0, 0, 0, 1)">)]
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ç»åç»æ</span>
    result = np.zeros(n, dtype=<span style="color: rgba(0, 0, 0, 1)">complex)
    </span><span style="color: rgba(0, 0, 255, 1)">for</span> k <span style="color: rgba(0, 0, 255, 1)">in</span> range(n//2<span style="color: rgba(0, 0, 0, 1)">):
        term </span>= w[k] *<span style="color: rgba(0, 0, 0, 1)"> odd_fft[k]
        result[k] </span>= even_fft[k] +<span style="color: rgba(0, 0, 0, 1)"> term
        result[k </span>+ n//2] = even_fft[k] -<span style="color: rgba(0, 0, 0, 1)"> term
        
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> result

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æµè¯éå½FFT</span>
<span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> test_fft_recursive():
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çææµè¯ä¿¡å·ï¼50Hzå120Hzæ­£å¼¦æ³¢çå å </span>
    fs = 1000  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> éæ ·é¢ç1000Hz</span>
    t = np.linspace(0, 1, 1024)  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 1ç§æ¶é´ï¼1024ä¸ªç¹</span>
    signal = np.sin(2 * np.pi * 50 * t) + 0.5 * np.sin(2 * np.pi * 120 *<span style="color: rgba(0, 0, 0, 1)"> t)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¡ç®FFT</span>
    fft_result =<span style="color: rgba(0, 0, 0, 1)"> fft_recursive(signal)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¡ç®é¢çè½´</span>
    freqs = np.fft.fftfreq(len(signal), 1/<span style="color: rgba(0, 0, 0, 1)">fs)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span><span style="color: rgba(0, 0, 0, 1)">(len(freqs))
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ç»å¶ç»æ</span>
    plt.figure(figsize=(12, 4<span style="color: rgba(0, 0, 0, 1)">))
    
    plt.subplot(</span>1, 2, 1<span style="color: rgba(0, 0, 0, 1)">)
    plt.plot(t, signal)
    plt.title(</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åå§ä¿¡å·</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    plt.xlabel(</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">æ¶é´ (s)</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    plt.ylabel(</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">å¹åº¦</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    
    plt.subplot(</span>1, 2, 2<span style="color: rgba(0, 0, 0, 1)">)
    plt.plot(freqs[:len(freqs)</span>//2], np.abs(fft_result[:len(fft_result)//2<span style="color: rgba(0, 0, 0, 1)">]))
    plt.title(</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">é¢è°±å¾</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    plt.xlabel(</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">é¢ç (Hz)</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    plt.ylabel(</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">å¹åº¦</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    plt.xlim(0, </span>200<span style="color: rgba(0, 0, 0, 1)">)
    
    plt.tight_layout()
    plt.show()

</span><span style="color: rgba(0, 0, 255, 1)">if</span> <span style="color: rgba(128, 0, 128, 1)">__name__</span> == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">__main__</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
    test_fft_recursive()</span></pre>
</div>
<span class="cnblogs_code_collapse">éå½FFT</span></div>
<p>ç¨åºä¸­ä»¥50Hzå120Hzæ­£å¼¦æ³¢å å äº§çæµè¯ä¿¡å·ï¼éè¿FFTåæ¢å¯ä»¥è¿ä¸¤ä¸ªä¿¡å·å¿«éçè¿æ»¤åºæ¥ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260129174352141-1064981846.png" alt="image" width="939" height="364" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>éå½å®ç°è½ç¶ç´è§ï¼ä½å­å¨ä¸äºç¼ºç¹ï¼</p>
<p>1. éå½è°ç¨ä¼äº§çé¢å¤çå½æ°è°ç¨å¼é</p>
<p>2. éè¦ä¸æ­åå»ºæ°çå­æ°ç»ï¼åå­ä½¿ç¨ä¸å¤é«æ</p>
<p>3. å¯¹äºå¤§æ°ç»ï¼å¯è½å¯¼è´éå½æ·±åº¦è¿å¤§</p>
<p>å æ­¤ï¼å¨å®éåºç¨ä¸­ï¼è¿­ä»£å®ç°éå¸¸æ´åéçã</p>
<h2>2.2 è¿­ä»£å®ç°FFT</h2>
<p>è¿­ä»£FFTç®æ³éè¿å¾ªç¯èééå½å®ç°è®¡ç®ï¼æçæ´é«ãè¿­ä»£ç®æ³çæ ¸å¿æ¯é¦åå¯¹è¾å¥æ°ç»è¿è¡ä½ååºæåï¼ç¶åéè¿å¤å±å¾ªç¯å®ç°è¶å½¢è¿ç®ãé¦åä»¥n=8ä¸ºä¾ï¼çä¸<em>X<sub>0</sub></em>çéæåºï¼ç±äºÏ<sup>0</sup>=1åæ ¹æ®DFTå¬å¼å¯ç¥ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260130173927906-1454035592.png" alt="image" width="532" height="93" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>è§å¯ä»¥ä¸äºè¿å¶ä¸æ ï¼å¯ç¥éæåºåçäºè¿å¶ä¸æ æ­£æ¯æ­£åºä¸æ äºè¿å¶çéåºï¼æè¿ç§åºåå«åéäºè¿å¶åºï¼</p>
<div class="cnblogs_code">
<pre> 0   4   2   6   1   5   3   7
000 100 010 110 001 101 011 111

000 001 010 011 100 101 110 111<span style="color: rgba(0, 0, 0, 1)">
 0   </span>1   2   3   4   5   6   7</pre>
</div>
<p>åçå¯ä»¥ç»åº<em>X<sub>1</sub></em>å<em>X<sub>4</sub></em>=<em>X<sub>0+8/2</sub></em>çè¿­ä»£è®¡ç®è¿ç¨ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260130173556716-1214216164.png" alt="image" width="638" height="288" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><em>X<sub>0</sub></em>å<em>X<sub>4</sub></em>å®å¨å¯¹åºè¿­ä»£å¬å¼ï¼1ï¼ï¼å®éä¸ææ<em>X<sub>k</sub></em>è®¡ç®è¿ç¨å¯ä»¥ç±ä»¥ä¸äºåæ ç»åºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202601/465567-20260130171140920-240111198.png" alt="binary_tree" width="616" height="214" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<div class="cnblogs_code"><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" id="code_img_closed_1cf16b4b-2e15-4529-ab65-a62ba19cd246" class="code_img_closed"><img src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" id="code_img_opened_1cf16b4b-2e15-4529-ab65-a62ba19cd246" class="code_img_opened" style="display: none">
<div id="cnblogs_code_open_1cf16b4b-2e15-4529-ab65-a62ba19cd246" class="cnblogs_code_hide">
<pre><span style="color: rgba(0, 128, 128, 1)">  1</span> <span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> numpy as np
</span><span style="color: rgba(0, 128, 128, 1)">  2</span> <span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> matplotlib.pyplot as plt
</span><span style="color: rgba(0, 128, 128, 1)">  3</span> 
<span style="color: rgba(0, 128, 128, 1)">  4</span> <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¾ç½®å­ä½ï¼ç¡®ä¿ä¸­ææ¾ç¤º</span>
<span style="color: rgba(0, 128, 128, 1)">  5</span> plt.rcParams[<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">font.sans-serif</span><span style="color: rgba(128, 0, 0, 1)">'</span>] = [<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">SimHei</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">]
</span><span style="color: rgba(0, 128, 128, 1)">  6</span> plt.rcParams[<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">axes.unicode_minus</span><span style="color: rgba(128, 0, 0, 1)">'</span>] =<span style="color: rgba(0, 0, 0, 1)"> False
</span><span style="color: rgba(0, 128, 128, 1)">  7</span> 
<span style="color: rgba(0, 128, 128, 1)">  8</span> <span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> bit_reverse(n, num_bits):
</span><span style="color: rgba(0, 128, 128, 1)">  9</span>     <span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">å°nçäºè¿å¶è¡¨ç¤ºè¿è¡ä½ååº</span><span style="color: rgba(128, 0, 0, 1)">"""</span>
<span style="color: rgba(0, 128, 128, 1)"> 10</span>     reversed_n =<span style="color: rgba(0, 0, 0, 1)"> 0
</span><span style="color: rgba(0, 128, 128, 1)"> 11</span>     <span style="color: rgba(0, 0, 255, 1)">for</span> i <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(num_bits):
</span><span style="color: rgba(0, 128, 128, 1)"> 12</span>         <span style="color: rgba(0, 0, 255, 1)">if</span> n &amp; (1 &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> i):
</span><span style="color: rgba(0, 128, 128, 1)"> 13</span>             reversed_n |= (1 &lt;&lt; (num_bits - 1 -<span style="color: rgba(0, 0, 0, 1)"> i))
</span><span style="color: rgba(0, 128, 128, 1)"> 14</span>     <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> reversed_n
</span><span style="color: rgba(0, 128, 128, 1)"> 15</span> 
<span style="color: rgba(0, 128, 128, 1)"> 16</span> <span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> fft_iterative(x):
</span><span style="color: rgba(0, 128, 128, 1)"> 17</span>     <span style="color: rgba(128, 0, 0, 1)">"""</span>
<span style="color: rgba(0, 128, 128, 1)"> 18</span> <span style="color: rgba(128, 0, 0, 1)">    è¿­ä»£å®ç°å¿«éåéå¶åæ¢
</span><span style="color: rgba(0, 128, 128, 1)"> 19</span> <span style="color: rgba(128, 0, 0, 1)">    è¾å¥xçé¿åº¦å¿é¡»æ¯2çå¹æ¬¡
</span><span style="color: rgba(0, 128, 128, 1)"> 20</span>     <span style="color: rgba(128, 0, 0, 1)">"""</span>
<span style="color: rgba(0, 128, 128, 1)"> 21</span>     n =<span style="color: rgba(0, 0, 0, 1)"> len(x)
</span><span style="color: rgba(0, 128, 128, 1)"> 22</span>     num_bits =<span style="color: rgba(0, 0, 0, 1)"> int(np.log2(n))
</span><span style="color: rgba(0, 128, 128, 1)"> 23</span>     
<span style="color: rgba(0, 128, 128, 1)"> 24</span>     <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ä½ååºæå</span>
<span style="color: rgba(0, 128, 128, 1)"> 25</span>     reversed_index = [bit_reverse(i, num_bits) <span style="color: rgba(0, 0, 255, 1)">for</span> i <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(n)]
</span><span style="color: rgba(0, 128, 128, 1)"> 26</span>     data =<span style="color: rgba(0, 0, 0, 1)"> x[reversed_index].astype(complex)
</span><span style="color: rgba(0, 128, 128, 1)"> 27</span>     
<span style="color: rgba(0, 128, 128, 1)"> 28</span>     <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è¿­ä»£è®¡ç®FFT</span>
<span style="color: rgba(0, 128, 128, 1)"> 29</span>     size = 2
<span style="color: rgba(0, 128, 128, 1)"> 30</span>     <span style="color: rgba(0, 0, 255, 1)">while</span> size &lt;=<span style="color: rgba(0, 0, 0, 1)"> n:
</span><span style="color: rgba(0, 128, 128, 1)"> 31</span>         half_size = size // 2
<span style="color: rgba(0, 128, 128, 1)"> 32</span>         <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¡ç®æè½¬å å­</span>
<span style="color: rgba(0, 128, 128, 1)"> 33</span>         w_m = np.exp(-2j * np.pi /<span style="color: rgba(0, 0, 0, 1)"> size)
</span><span style="color: rgba(0, 128, 128, 1)"> 34</span>         
<span style="color: rgba(0, 128, 128, 1)"> 35</span>         <span style="color: rgba(0, 0, 255, 1)">for</span> k <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(0, n, size):
</span><span style="color: rgba(0, 128, 128, 1)"> 36</span>             w = 1
<span style="color: rgba(0, 128, 128, 1)"> 37</span>             <span style="color: rgba(0, 0, 255, 1)">for</span> j <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(half_size):
</span><span style="color: rgba(0, 128, 128, 1)"> 38</span>                 t = w * data[k + j +<span style="color: rgba(0, 0, 0, 1)"> half_size]
</span><span style="color: rgba(0, 128, 128, 1)"> 39</span>                 u = data[k +<span style="color: rgba(0, 0, 0, 1)"> j]
</span><span style="color: rgba(0, 128, 128, 1)"> 40</span>                 data[k + j] = u +<span style="color: rgba(0, 0, 0, 1)"> t
</span><span style="color: rgba(0, 128, 128, 1)"> 41</span>                 data[k + j + half_size] = u -<span style="color: rgba(0, 0, 0, 1)"> t
</span><span style="color: rgba(0, 128, 128, 1)"> 42</span>                 w *=<span style="color: rgba(0, 0, 0, 1)"> w_m
</span><span style="color: rgba(0, 128, 128, 1)"> 43</span>         size *= 2
<span style="color: rgba(0, 128, 128, 1)"> 44</span>     
<span style="color: rgba(0, 128, 128, 1)"> 45</span>     <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> data
</span><span style="color: rgba(0, 128, 128, 1)"> 46</span> 
<span style="color: rgba(0, 128, 128, 1)"> 47</span> <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æµè¯è¿­ä»£FFT</span>
<span style="color: rgba(0, 128, 128, 1)"> 48</span> <span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> test_fft_iterative():
</span><span style="color: rgba(0, 128, 128, 1)"> 49</span>     <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çææµè¯ä¿¡å·</span>
<span style="color: rgba(0, 128, 128, 1)"> 50</span>     n = 256  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ°æ®ç¹ä¸ªæ°ï¼å¿é¡»æ¯2çå¹æ¬¡</span>
<span style="color: rgba(0, 128, 128, 1)"> 51</span>     fs = 1000  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> éæ ·é¢ç</span>
<span style="color: rgba(0, 128, 128, 1)"> 52</span>     
<span style="color: rgba(0, 128, 128, 1)"> 53</span>     t = np.linspace(0, 1<span style="color: rgba(0, 0, 0, 1)">, n)
</span><span style="color: rgba(0, 128, 128, 1)"> 54</span>     <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çæåå«å¤ä¸ªé¢çæåçä¿¡å·</span>
<span style="color: rgba(0, 128, 128, 1)"> 55</span>     signal = (np.sin(2 * np.pi * 50 * t) + 
<span style="color: rgba(0, 128, 128, 1)"> 56</span>               0.5 * np.sin(2 * np.pi * 120 * t) + 
<span style="color: rgba(0, 128, 128, 1)"> 57</span>               0.3 * np.sin(2 * np.pi * 200 *<span style="color: rgba(0, 0, 0, 1)"> t))
</span><span style="color: rgba(0, 128, 128, 1)"> 58</span>     
<span style="color: rgba(0, 128, 128, 1)"> 59</span>     <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ·»å åªå£°</span>
<span style="color: rgba(0, 128, 128, 1)"> 60</span>     noise = 0.2 * np.random.normal(size=<span style="color: rgba(0, 0, 0, 1)">n)
</span><span style="color: rgba(0, 128, 128, 1)"> 61</span>     signal +=<span style="color: rgba(0, 0, 0, 1)"> noise
</span><span style="color: rgba(0, 128, 128, 1)"> 62</span>     
<span style="color: rgba(0, 128, 128, 1)"> 63</span>     <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¡ç®FFT</span>
<span style="color: rgba(0, 128, 128, 1)"> 64</span>     fft_result =<span style="color: rgba(0, 0, 0, 1)"> fft_iterative(signal)
</span><span style="color: rgba(0, 128, 128, 1)"> 65</span>     freqs = np.fft.fftfreq(n, 1/<span style="color: rgba(0, 0, 0, 1)">fs)
</span><span style="color: rgba(0, 128, 128, 1)"> 66</span>     
<span style="color: rgba(0, 128, 128, 1)"> 67</span>     <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ä¸NumPyåç½®FFTå¯¹æ¯</span>
<span style="color: rgba(0, 128, 128, 1)"> 68</span>     np_fft =<span style="color: rgba(0, 0, 0, 1)"> np.fft.fft(signal)
</span><span style="color: rgba(0, 128, 128, 1)"> 69</span>     
<span style="color: rgba(0, 128, 128, 1)"> 70</span>     <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ç»å¶ç»æ</span>
<span style="color: rgba(0, 128, 128, 1)"> 71</span>     plt.figure(figsize=(15, 5<span style="color: rgba(0, 0, 0, 1)">))
</span><span style="color: rgba(0, 128, 128, 1)"> 72</span>     
<span style="color: rgba(0, 128, 128, 1)"> 73</span>     plt.subplot(1, 3, 1<span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 74</span> <span style="color: rgba(0, 0, 0, 1)">    plt.plot(t, signal)
</span><span style="color: rgba(0, 128, 128, 1)"> 75</span>     plt.title(<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åå§ä¿¡å· (å«åªå£°)</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 76</span>     plt.xlabel(<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">æ¶é´ (s)</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 77</span>     plt.ylabel(<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">å¹åº¦</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 78</span>     
<span style="color: rgba(0, 128, 128, 1)"> 79</span>     plt.subplot(1, 3, 2<span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 80</span>     plt.plot(freqs[:n//2], np.abs(fft_result[:n//2]), label=<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èªå®ä¹FFT</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 81</span>     plt.title(<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èªå®ä¹FFTé¢è°±</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 82</span>     plt.xlabel(<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">é¢ç (Hz)</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 83</span>     plt.ylabel(<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">å¹åº¦</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 84</span>     plt.xlim(0, 300<span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 85</span>     
<span style="color: rgba(0, 128, 128, 1)"> 86</span>     plt.subplot(1, 3, 3<span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 87</span>     plt.plot(freqs[:n//2], np.abs(np_fft[:n//2]), label=<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">NumPy FFT</span><span style="color: rgba(128, 0, 0, 1)">'</span>, color=<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">orange</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 88</span>     plt.title(<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">NumPy FFTé¢è°±</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 89</span>     plt.xlabel(<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">é¢ç (Hz)</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 90</span>     plt.ylabel(<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">å¹åº¦</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 91</span>     plt.xlim(0, 300<span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 92</span>     
<span style="color: rgba(0, 128, 128, 1)"> 93</span> <span style="color: rgba(0, 0, 0, 1)">    plt.tight_layout()
</span><span style="color: rgba(0, 128, 128, 1)"> 94</span> <span style="color: rgba(0, 0, 0, 1)">    plt.show()
</span><span style="color: rgba(0, 128, 128, 1)"> 95</span>     
<span style="color: rgba(0, 128, 128, 1)"> 96</span>     <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¡ç®è¯¯å·®</span>
<span style="color: rgba(0, 128, 128, 1)"> 97</span>     error = np.max(np.abs(fft_result -<span style="color: rgba(0, 0, 0, 1)"> np_fft))
</span><span style="color: rgba(0, 128, 128, 1)"> 98</span>     <span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä¸NumPy FTçæå¤§è¯¯å·®: {error}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
</span><span style="color: rgba(0, 128, 128, 1)"> 99</span> 
<span style="color: rgba(0, 128, 128, 1)">100</span> <span style="color: rgba(0, 0, 255, 1)">if</span> <span style="color: rgba(128, 0, 128, 1)">__name__</span> == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">__main__</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
</span><span style="color: rgba(0, 128, 128, 1)">101</span>     test_fft_iterative()</pre>
</div>
<span class="cnblogs_code_collapse">è¿­ä»£FFT</span></div>
<p>ä»ä»¥n=8ä¸ºä¾ï¼è¿­ä»£ç®æ³ä¸­é¦åå¯¹è¾å¥è¿è¡äºè¿å¶çéåºï¼ç¶åè¿è¡3ä¸ªé¶æ®µçè¶å½¢è®¡ç®ï¼ç¬¬1ä¸ªé¶æ®µç±ç¸é»ç¹äº§çä¸ä¸çº§çè¾åºï¼ç¬¬2ä¸ªé¶æ®µç±é´éä¸ä¸ªç¹çè¾å¥äº§çè¾åºï¼ç¬¬3ä¸ªé¶æ®µç±é´éä¸¤ä¸ªç¹çè¾åºäº§çè¾åºï¼è´è¶ç±ç¦åèï¼å¦ä¸å¾æç¤ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260203124707004-1989410463.png" alt="image" width="970" height="539" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<h1>3 åºç¨å®ä¾</h1>
<h2>3.1 é³é¢å¤çä¸­çåºç¨</h2>
<p>FFTï¼å¿«éåéå¶åæ¢ï¼æ¯é³é¢é¢åçæ ¸å¿æ°å­ä¿¡å·å¤çå·¥å·ï¼æ¬è´¨æ¯å°é³é¢çæ¶åä¿¡å·ï¼éæ¶é´ååçå£°æ³¢æ¯å¹ï¼è½¬æ¢ä¸ºé¢åä¿¡å·ï¼ä¸åé¢ççå£°é³åéå æ¯ï¼ï¼èäººè³å¯¹å£°é³çæç¥æ¬èº«å°±æ¯åºäºé¢ççï¼å¦é³è°ãé³è²ï¼ï¼è¿ä½¿å¾ FFT æä¸ºé³é¢ééãåæãå¤çãåæå¨é¾è·¯çåºç¡ã</p>
<h3>1 é³é¢åºç¡åæ</h3>
<p>ææé³é¢æºè½åæçåæï¼æ ¸å¿æ¯å°ä¸å¯ç´æ¥è§£è¯»çæ¶åæ³¢å½¢ï¼è½¬æ¢ä¸ºå¯éåçé¢çç¹å¾ã</p>
<p><strong>æ ¸å¿é»è¾</strong></p>
<p>ï¼1ï¼é³é¢å¨è®¡ç®æºä¸­æ¯éæ ·çåºå®çæ¶åç¦»æ£æ°æ®ï¼å¦44.1kHzéæ ·ç = 1ç§éé44100ä¸ªæ¯å¹å¼ï¼ï¼æ³¢å½¢ä»è½åæ å£°é³çå¼ºå¼±ååï¼æ æ³ç´æ¥å¾å°é³è°ãé³è²ç­å³é®ä¿¡æ¯ï¼</p>
<p>ï¼2ï¼å¯¹æ¶åé³é¢æ®µæ§è¡ä¸ç»´ FFTï¼å¾å°é¢è°±ï¼æ¨ªåæ ä¸ºé¢çï¼çºµåæ ä¸ºå¯¹åºé¢ççæ¯å¹/è½éï¼ï¼é¢è°±ç´æ¥åæ  âåªäºé¢ççå£°é³ææäºå½åé³é¢âï¼</p>
<p>ï¼3ï¼éå¯¹éå¹³ç¨³é³é¢ï¼å£°é³é¢çéæ¶é´ååï¼å¦è¯´è¯ãå±æ­ãä¹å¨æ¼å¥ï¼ï¼éç¨STFTï¼ç­æ¶åéå¶åæ¢ï¼ï¼å°é³é¢ååä¸ºè¿ç»­çç­å¸§ï¼å¦20ms/å¸§ï¼ï¼å¯¹æ¯å¸§ç¬ç«åFFTï¼æç»å¾å°æ¶é¢å¾ï¼æ¨ªè½´æ¶é´ï¼çºµè½´é¢çï¼é¢è² / äº®åº¦è¡¨ç¤ºè½éï¼ï¼å®ç° âæ¶é´-é¢çâ çäºç»´åæã</p>
<p><strong>å¸ååºç¨</strong></p>
<p>é³é¢è½¯ä»¶çé¢è°±åæä»ªï¼å¦ AuditionãCool Editï¼ï¼å®æ¶æ¾ç¤ºé³é¢çé¢çåå¸ï¼å¸®å©è°é³å¸å¤æ­å£°é³çé¢çç¼ºé·ï¼</p>
<p>åºç¡é³é¢ç¹å¾æåï¼éè¿ FFT è®¡ç®åºé¢ï¼Fundamental Frequencyï¼F0ï¼ï¼å£°é³çåºç¡é³è°ï¼å¦ç·å£°åºé¢ 80-200Hzï¼å¥³å£° 200-500Hzï¼ãè°æ³¢ï¼åºé¢çæ´æ°åé¢çï¼å³å®é³è²ï¼ãé¢è°±è½éï¼å³å®å£°é³ååº¦ï¼ã</p>
<h3>2 é³è°æ£æµä¸é³é«è¯å«ï¼Pitch Detectionï¼</h3>
<p>é³è°æ¯é³é¢ææ ¸å¿çæç¥ç¹å¾ä¹ä¸ï¼FFTæ¯å®ç°é³é«è¯å«çç»å¸ç®æ³åºç¡ï¼å¹¿æ³ç¨äºKæ­è¯åãä¹å¨æ ¡é³ãè¯­é³è¯å«ã</p>
<p><strong>æ ¸å¿é»è¾</strong></p>
<p>ï¼1ï¼çº¯é³ï¼å¦é¢ç´åé®ï¼çæ¶åæ³¢å½¢æ¯å¨ææ§çï¼å¶é¢åé¢è°±ä¸­è½éæé«çé¢çå³ä¸ºåºé¢ï¼F0ï¼ï¼å¯¹åºå¬è§ä¸çé³è°ï¼</p>
<p>ï¼2ï¼å¯¹ä¹å¨/äººå£°çæ··åé³é¢ï¼éè¿FFTå¾å°é¢è°±åï¼ç­éåºåºé¢å³°ï¼ä¸»å³°å¼ï¼åå¶è°æ³¢å³°ï¼éè¿å³°å¼æ£æµç®æ³ç¡®å®å®éé³é«ï¼</p>
<p>ï¼3ï¼å·¥ç¨ä¸­ä¼ç»åèªç¸å³æ³ä¼åFFTçåºé¢æ£æµï¼è§£å³ä½ä¿¡åªæ¯ãè°æ³¢å¹²æ°ä¸çæ£æµè¯¯å·®é®é¢ã</p>
<p><strong>å¸ååºç¨</strong></p>
<p>ï¼1ï¼ä¹å¨æ ¡é³è½¯ä»¶ï¼å¦åä»æ ¡é³å¨ãé¢ç´æ ¡é³å¨ï¼ï¼å®æ¶ééä¹å¨å£°é³ï¼éè¿FFTæ£æµåºé¢ï¼å¯¹æ¯æ åé³é«ï¼å¦ A4=440Hzï¼ç»åºæ ¡é³æç¤ºï¼</p>
<p>ï¼2ï¼Kæ­APPçé³é«è¯åï¼å¦å±å§ãå¨æ°Kæ­ï¼ï¼å®æ¶åææ¼å±å£°é³çåºé¢ï¼ä¸åå±åºé¢å¯¹æ¯ï¼å¤æ­é³åå¹¶æåï¼</p>
<p>ï¼3ï¼é³ä¹ä¹è°±èªå¨è½¬åï¼å°æ¼å¥é³é¢è½¬æ¢ä¸ºäºçº¿è°±ï¼æ ¸å¿æ¯éè¿ FFT éå¸§æ£æµé³é«å¹¶å¹éå¯¹åºé³ç¬¦ã</p>
<h3>3&nbsp;é³é¢æ»¤æ³¢ï¼ç²¾åå»é¤åªå£°/ä¿çç®æ é¢ç</h3>
<p>é³é¢æ»¤æ³¢æ¯FFTæå¸¸ç¨çå¤çç±»åºç¨ï¼ç¸æ¯ä¼ ç»çæ¨¡ææ»¤æ³¢ï¼åºäºFFTçé¢åæ»¤æ³¢æ´çµæ´»ãç²¾åï¼å¯å®ç°ä»»æèªå®ä¹çé¢çç­éï¼æ ¸å¿æ¯ âé¢åä¿®æ¹ï¼æ¶åéæâã</p>
<p><strong>æ ¸å¿é»è¾ï¼ä¸å¾å FFT åç¼©åçåæºï¼</strong></p>
<p>ï¼1ï¼æ¶åâé¢åï¼å¯¹é³é¢å¸§æ§è¡ FFTï¼å¾å°é¢åç³»æ°ï¼</p>
<p>ï¼2ï¼é¢åæ»¤æ³¢ï¼æ ¹æ®éæ±çæé¢çæ©ç ï¼å¯¹é¢åç³»æ°åä¿®æ¹ï¼&nbsp; &nbsp;</p>
<p>&nbsp; &nbsp; ä½éæ»¤æ³¢ï¼ä¿çä½é¢ç³»æ°ï¼ç½®é¶é«é¢ç³»æ°ï¼å¦å»é¤é³é¢ä¸­çé«é¢å¶å¶åªå£°ï¼ï¼</p>
<p>&nbsp; &nbsp; é«éæ»¤æ³¢ï¼ä¿çé«é¢ç³»æ°ï¼ç½®é¶ä½é¢ç³»æ°ï¼å¦å»é¤é³é¢ä¸­çä½é¢åºåªãçµæµå£°ï¼ï¼</p>
<p><em>&nbsp; &nbsp;&nbsp;</em>å¸¦éæ»¤æ³¢ï¼ä»ä¿çæå®é¢çåºé´çç³»æ°ï¼å¦æåäººå£°é³é¢ï¼ä¿ç 300-3400Hz çäººå£°æ ¸å¿é¢çï¼ï¼</p>
<p>&nbsp; &nbsp; å¸¦é»æ»¤æ³¢ / é·æ³¢æ»¤æ³¢ï¼ç½®é¶æå®é¢çåºé´çç³»æ°ï¼å¦å»é¤ 50Hz/60Hz çå¸çµå·¥é¢åªå£°ï¼ï¼</p>
<p>ï¼3ï¼é¢åâæ¶åï¼å¯¹æ»¤æ³¢åçé¢åç³»æ°æ§è¡é FFTï¼IFFTï¼ï¼è½¬æ¢åæ¶åé³é¢ï¼å¾å°æ»¤æ³¢åçå£°é³ã</p>
<p><strong>å¸ååºç¨</strong></p>
<p>ï¼1ï¼è¯­é³éåªï¼å¦ä¼è®®å½é³ãéº¦åé£éåªï¼ï¼éè¿FFTå»é¤èæ¯ä¸­çä½é¢åºåªãé«é¢ç¯å¢åªå£°ï¼ä¿çäººå£°ï¼</p>
<p>ï¼2ï¼é³ä¹å¶ä½ä¸­çåè¡¡å¨ï¼EQï¼ï¼å¯¹é³ä¹çä½é¢ãä¸­é¢ãé«é¢åå«åå¢ç / è¡°åï¼æ¬è´¨æ¯ä¿®æ¹FFTåçé¢åç³»æ°æ¯å¹ï¼ï¼è°æ´é³ä¹çé³è²å±æ¬¡ï¼</p>
<p>ï¼3ï¼å¹¿æ­/ç´æ­çé³é¢å¤çï¼è¿æ»¤æäººå£°å¤çæ æé¢çï¼æåå£°é³çæ¸æ°åº¦ã</p>
<h3>4&nbsp;å£°é³åæä¸é³è²æ¨¡æï¼å æ³åæ / è°é¢åæï¼</h3>
<p>å£°é³çé³è²ç±âåºé¢+è°æ³¢çé¢çåå¸æ¯ä¾âå³å®ï¼FFTä¸ºé³è²çéåååææä¾äºåºç¡ï¼æ¯çµå­é³ä¹ãè¯­é³åæçæ ¸å¿ææ¯ä¹ä¸ã</p>
<p><strong>æ ¸å¿é»è¾</strong></p>
<p>ï¼1ï¼é³è²çé¢åæ¬è´¨ï¼ä¸åä¹å¨çåä¸é³è°ï¼åºé¢ç¸åï¼ï¼é³è²ä¸åçåå æ¯è°æ³¢çæ°éãæ¯å¹å æ¯ä¸åï¼å¦é¢ç´çè°æ³¢ä¸°å¯ä¸é«é¢è¡°åå¿«ï¼å°æç´çé«é¢è°æ³¢æ´çªåºï¼ï¼</p>
<p>ï¼2ï¼å æ³åæï¼éè¿ FFT åæç®æ ä¹å¨çé¢è°±ï¼åºé¢ + åè°æ³¢çè½éæ¯ä¾ï¼ï¼ç¶åç¨å¤ä¸ªæ­£å¼¦æ³¢ï¼å¯¹åºåºé¢ååè°æ³¢ï¼æè¯¥æ¯ä¾å å ï¼åæåºä¸ç®æ ä¹å¨ç¸ä¼¼çé³è²ï¼</p>
<p>ï¼3ï¼è¯­é³åæï¼TTSï¼ï¼å¯¹çäººè¯­é³å FFT åæï¼å¾å°ä¸åé³èçé¢è°±ç¹å¾ï¼åææ¶éè¿è°æ´åºé¢åé¢è°±åå¸ï¼çæèªç¶çäººå·¥è¯­é³ã</p>
<p><strong>å¸ååºç¨</strong></p>
<p>ï¼1ï¼çµå­é³ä¹åæå¨ï¼å¦FL StudioãAbleton Liveï¼ï¼åºäº FFT çé¢è°±åæï¼æ¨¡æé¢ç´ãåä»ãå¼¦ä¹ç­ä¼ ç»ä¹å¨çé³è²ï¼æå¶ä½èªå®ä¹ççµå­é³è²ï¼</p>
<p>ï¼2ï¼è¯­é³åæå¼æï¼å¦è®¯é£TTSãç¾åº¦TTSï¼ï¼éè¿ FFT æåè¯­é³çé¢è°±ç¹å¾ï¼æååæè¯­é³çèªç¶åº¦ï¼</p>
<p>ï¼3ï¼å£°é³ç¹æå¶ä½ï¼å¦å°äººå£°è½¬æ¢ä¸ºæºå¨äººå£°ï¼éè¿FFTä¿®æ¹é¢è°±ï¼åå¶è°æ³¢ï¼ä¿çåºé¢ï¼ã</p>
<h3>5&nbsp;é³é¢ç¹å¾æåä¸æºè½åæï¼AI / æºå¨å­¦ä¹ åºç¡ï¼</h3>
<p>å½ä¸çé³é¢æºè½åºç¨ï¼å¦è¯­é³è¯å«ãå£°çº¹è¯å«ãé³é¢åç±»ï¼ï¼å¶æ ¸å¿ç¹å¾ååºäº FFT çé¢ååæï¼FFT æ¯è¿æ¥åå§é³é¢æ°æ®å AI æ¨¡åçæ¡¥æ¢ã</p>
<p><strong>æ ¸å¿é»è¾</strong></p>
<p>ï¼1ï¼åå§æ¶åé³é¢æ°æ®ç»´åº¦é«ãåä½å¤§ï¼æ æ³ç´æ¥è¾å¥AIæ¨¡åï¼</p>
<p>ï¼2ï¼éè¿ FFT/STFT å°é³é¢è½¬æ¢ä¸ºé¢åç¹å¾ï¼åè¿ä¸æ­¥æåæ¢å°é¢è°±ï¼Mel Spectrogramï¼ãæ¢å°é¢çåè°±ç³»æ°ï¼MFCCï¼ ç­å·¥ç¨åç¹å¾ï¼</p>
<p>&nbsp; &nbsp; æ¢å°é¢è°±ï¼å° FFT å¾å°ççº¿æ§é¢è°±è½¬æ¢ä¸ºç¬¦åäººè³å¬è§ç¹æ§çæ¢å°å»åº¦é¢è°±ï¼äººè³å¯¹ä½é¢æ´ææï¼å¯¹é«é¢æ´è¿éï¼ï¼</p>
<p>&nbsp; &nbsp; MFCCï¼å¯¹æ¢å°é¢è°±åç¦»æ£ä½å¼¦åæ¢ï¼DCTï¼ï¼æåçä½ç»´ç³»æ°ï¼æ¯è¯­é³è¯å«ãå£°çº¹è¯å«çç»å¸æ ¸å¿ç¹å¾ï¼</p>
<p>ï¼3ï¼è¿äºé¢åç¹å¾ç»´åº¦ä½ãè¾¨è¯åº¦é«ï¼æ¯è¯­é³è¯å«ãé³é¢åç±»æ¨¡åçæ åè¾å¥ã</p>
<p><strong>å¸ååºç¨</strong></p>
<p>ï¼1ï¼è¯­é³è¯å«ï¼ASRï¼ï¼å¦å¾®ä¿¡è¯­é³è½¬æå­ãè®¯é£å¬è§ï¼æ ¸å¿ç¹å¾æ¯MFCCï¼å¶æååºç¡æ¯FFT/STFTï¼</p>
<p>ï¼2ï¼å£°çº¹è¯å«ï¼å¦ææºå£°çº¹è§£éãé¶è¡è¯­é³éªè¯ï¼éè¿ FFT åæä¸åäººçè¯­é³é¢è°±ç¹å¾ï¼å£°çº¹ï¼ï¼å®ç°èº«ä»½è¯å«ï¼</p>
<p>ï¼3ï¼é³é¢åç±»ï¼å¦ç­è§é¢çèæ¯é³ä¹è¯å«ãç¯å¢å£°æ£æµï¼å¦å­å£°ãç»çç ´ç¢å£°ãæ±½è½¦é¸£ç¬å£°ï¼ï¼åºäºæ¢å°é¢è°±åæ¨¡åè®­ç»ï¼èæ¢å°é¢è°±çåºç¡æ¯FFTï¼</p>
<p>ï¼4ï¼é³ä¹æ¨èï¼éè¿FFTåææ­æ²çé¢è°±ç¹å¾ï¼å¦ä½é¢è½éå æ¯ãèå¥å¯¹åºçé¢çååï¼ï¼å¯¹æ­æ²ååç±»ï¼å®ç°ä¸ªæ§åæ¨èã</p>
<h3>6&nbsp;é³é¢åæ­¥ä¸å¹éï¼å¦é³é¢æçº¹ãé³è§é¢åæ­¥ï¼</h3>
<p>ï¼1ï¼é³é¢æçº¹ï¼Audio Fingerprintï¼</p>
<p>æ ¸å¿æ¯éè¿FFTå¯¹é³é¢çæ¶é¢ç¹å¾åæåï¼çæå¯ä¸ç âé³é¢æçº¹âï¼å®ç°é³ä¹è¯å«ãé³é¢æ¥éãå¦æä¸æè¯æ²ï¼QQé³ä¹ãç½æäºé³ä¹ï¼ï¼éè¿FFTæåå¾è¯å«é³é¢çæ¶é¢ç¹å¾ï¼ä¸æå¡å¨ä¸­çé³é¢æçº¹åºå¹éï¼å¿«éè¯å«æ­æ²åç§°ã</p>
<p>ï¼2ï¼é³è§é¢åæ­¥</p>
<p>è§é¢çç»é¢å¸§ä¸é³é¢çæ¶é´è½´æåºç°éä½ï¼éè¿FFTåæé³é¢çé¢è°±ç¹å¾ååï¼ä¸è§é¢çç»é¢ç¹å¾åååæ¶é´å¯¹é½ï¼å®ç°é³è§é¢åæ­¥æ ¡æ­£ã</p>
<h2>3.2&nbsp;å¾åå¤çä¸­çåºç¨</h2>
<p>FFTå¨å¾åå¤çä¸­ä¸»è¦ç¨äºé¢åæ»¤æ³¢ãå¾ååç¼©ãçº¹çåæç­ãæ¥ä¸æ¥ä»¥å¾ååç¼©ä¸ºä¾è¿è¡è¯´æã</p>
<p>å¾åå¨è®¡ç®æºä¸­ä»¥åç´ ç©éµå­å¨ï¼è¿æ¯ç©ºé´åè¡¨ç¤ºï¼æ¯ä¸ªæ°å¼ä»£è¡¨å¯¹åºä½ç½®çäº®åº¦/é¢è²ï¼ç´è§æè¿°å¾åçç©ºé´åå¸ï¼ä½æ°æ®åä½åº¦é«ãé¢åæ¯éè¿åéå¶åæ¢å¾å°çå¦ä¸ç§è¡¨ç¤ºå½¢å¼ï¼å°å¾ååè§£ä¸ºä¸åé¢ççæ­£å¼¦/ä½å¼¦æ³¢å å ï¼é¢çæè¿°çæ¯åç´ å¼çååå¿«æ¢ï¼</p>
<p><strong>ä½é¢åéï¼</strong>åç´ å¼ååç¼æ¢ï¼å¯¹åºå¾åçæ´ä½è½®å»ãå¤§é¢ç§¯å¹³æ»åºåãä¸»ä½ç»æï¼å¦äººè¸è½®å»ãå¤©ç©ºèæ¯ï¼ï¼</p>
<p><strong>é«é¢åéï¼</strong>åç´ å¼ååå§çï¼å¯¹åºå¾åçç»èçº¹çãè¾¹ç¼ãåªå£°ãå¾®å°ççµï¼å¦åä¸ãæå­è¾¹ç¼ãåªç¹ï¼ã</p>
<p>äººç¼çè§è§ç¹æ§ä¸å¾åé¢åç¹æ§é«åº¦å¹éï¼</p>
<p>äººç¼å¯¹æ´ä½è½®å»ãå¤§é¢ç§¯åºåï¼ä½é¢ä¿¡æ¯ï¼é«åº¦ææï¼æ¯è¯å«å¾åçæ ¸å¿ä¾æ®ï¼</p>
<p>äººç¼å¯¹ç²¾ç»çº¹çãå¾®å°åªå£°ï¼é«é¢ä¿¡æ¯ï¼ææåº¦è¾ä½ï¼éåº¦èå¼åï¼èç¼é¾ä»¥å¯è§ææ¾å¤±çï¼</p>
<p>ç»åè¿ä¸ç¹æ§ï¼FFT åç¼©å¯ä»¥å¨ä¿è¯ä¸»è§è§è§è´¨éçåæä¸ï¼å®ç°å¯è§çæ°æ®åç¼©ãä¸¾ä¸ªä¾å­ï¼ä¸å¼ é£æ¯ç§ï¼èå¤©ãå±±èè½®å»æ¯ä½é¢æ ¸å¿ä¿¡æ¯ï¼æ å¶çº¹çãæ°´é¢æ³¢çº¹æ¯é«é¢ä¿¡æ¯ï¼èå¼ 80% é«é¢ç³»æ°åï¼å¾åä¾ç¶å¯æ¸æ°è¯å«ï¼ä»ä¼è½»å¾®æ¨¡ç³ã</p>
<p>å¾åæ¯äºç»´ä¿¡å·ï¼éè¦ä½¿ç¨äºç»´ç¦»æ£åéå¶åæ¢ï¼2D-DFTï¼å®æç©ºé´åå°é¢åçè½¬æ¢ï¼FFTå¾ååç¼©çæ¬è´¨æ¯å©ç¨é¢åè½éåå¸çä¸å¯¹ç§°æ§ï¼å®ç°æææ°æ®åç¼©ï¼å®æ´é»è¾åä¸º4ä¸ªæ ¸å¿æ­¥éª¤ï¼</p>
<p><strong>æ­¥éª¤ 1ï¼ç©ºé´å â é¢åè½¬æ¢ï¼FFTï¼</strong></p>
<p>å¯¹å¾åï¼æå¾åååï¼æ§è¡äºç»´FFTï¼å°åç´ å¼è½¬æ¢ä¸ºé¢åç³»æ°ï¼å¤æ°å½¢å¼ï¼åå«å¹åº¦åç¸ä½ä¿¡æ¯ï¼ãåæ¢åï¼é»è®¤ä½é¢ç³»æ°åå¸å¨é¢åç©éµçåè§ï¼é«é¢å¨ä¸­å¿ï¼éè¿fftshiftä¸­å¿ååï¼ä½é¢éä¸­å¨ç©éµä¸­å¿ï¼é«é¢åå¸å¨åå¨ï¼æ¹ä¾¿ç­éå¤çã</p>
<p><strong>æ­¥éª¤ 2ï¼é¢åç³»æ°éåä¸æªæ­ï¼æ ¸å¿åç¼©æä½ï¼</strong></p>
<p>åºäºè½ééä¸­ç¹æ§æ§è¡åç¼©æä½ï¼</p>
<p>ï¼1ï¼ä¿çæºå¸¦ç»å¤§é¨åå¾åè½éçä½é¢ç³»æ°ï¼</p>
<p>ï¼2ï¼ç´æ¥èå¼/ç½®é¶ä»æºå¸¦å°éç»èãåªå£°çé«é¢ç³»æ°ï¼</p>
<p>ï¼3ï¼èå¼çé«é¢ä¿¡æ¯è¶å¤ï¼åç¼©çè¶é«ï¼å¾åå¤±çè¶ææ¾ã</p>
<p>ä¸è¬éè¿è®¡ç®é¢åç¹å°ä¸­å¿çæ¬§å¼è·ç¦»ç­éä½é¢ç³»æ°ï¼è·ç¦»ä¸­å¿è¶è¿ï¼é¢çè¶ä½ï¼è¿æ¯æå¸¸ç¨çä½é¢ç­éæ¹å¼ã</p>
<p><strong>æ­¥éª¤ 3ï¼éåæ¢éæå¾åï¼é FFTï¼</strong></p>
<p>å¯¹å¤çåçé¢åç³»æ°æ§è¡éç§»ä½ï¼ifftshiftï¼+ éFFTï¼ifft2ï¼ï¼å°é¢åä¿¡å·è½¬æ¢åç©ºé´åï¼å¾å°åç¼©éæåçå¾åãç±äºé FFT ç»æä¼å­å¨å¾®å°èé¨ï¼æµ®ç¹è®¡ç®è¯¯å·®ï¼ï¼åªéæåå®é¨å³å¯å¾å°ææåç´ å¼ã</p>
<p><strong>æ­¥éª¤ 4ï¼æ°æ®å­å¨ä¼å</strong></p>
<p>åå§å¾åå­å¨æ¯ä¸ªåç´ çç©ºé´åæ°æ®ï¼èåç¼©åä»éå­å¨å°éä¿ççä½é¢ç³»æ°ï¼å¤§å¹åå°æ°æ®éï¼å®ç°å­å¨/ä¼ è¾çåç¼©ææã</p>
<p>ä»¥ä¸æ¯æºç ï¼</p>
<div class="cnblogs_code"><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" id="code_img_closed_564b0e2b-3c0a-40e5-9f1d-bc59a1cd04b7" class="code_img_closed"><img src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" id="code_img_opened_564b0e2b-3c0a-40e5-9f1d-bc59a1cd04b7" class="code_img_opened" style="display: none">
<div id="cnblogs_code_open_564b0e2b-3c0a-40e5-9f1d-bc59a1cd04b7" class="cnblogs_code_hide">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> numpy as np
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> matplotlib.pyplot as plt
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> matplotlib.image as mpimg
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> os
</span><span style="color: rgba(0, 0, 255, 1)">from</span> math <span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> log10, sqrt
</span><span style="color: rgba(0, 0, 255, 1)">from</span> PIL <span style="color: rgba(0, 0, 255, 1)">import</span> Image  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ°å¢ï¼ç¨PILä¿å­å¾åï¼å¼å®¹ææçæ¬</span>

<span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¾ç½®ä¸­ææ¾ç¤º</span>
plt.rcParams[<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">font.sans-serif</span><span style="color: rgba(128, 0, 0, 1)">'</span>] = [<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">SimHei</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">]
plt.rcParams[</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">axes.unicode_minus</span><span style="color: rgba(128, 0, 0, 1)">'</span>] =<span style="color: rgba(0, 0, 0, 1)"> False

</span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> psnr(original, compressed):
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">è®¡ç®å³°å¼ä¿¡åªæ¯ï¼PSNRï¼ï¼å¼å®¹å½©è²/ç°åº¦å¾</span><span style="color: rgba(128, 0, 0, 1)">"""</span>
    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è¥åå§å¾åæ¯å½©è²å¾ï¼åè½¬ä¸ºç°åº¦å¾åè®¡ç®PSNR</span>
    <span style="color: rgba(0, 0, 255, 1)">if</span> len(original.shape) == 3<span style="color: rgba(0, 0, 0, 1)">:
        original_gray </span>= np.mean(original, axis=2<span style="color: rgba(0, 0, 0, 1)">).astype(np.uint8)
    </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">:
        original_gray </span>=<span style="color: rgba(0, 0, 0, 1)"> original.astype(np.uint8)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ç¡®ä¿åç¼©åå¾åæ¯uint8ç±»å</span>
    compressed =<span style="color: rgba(0, 0, 0, 1)"> compressed.astype(np.uint8)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¡ç®MSEï¼åæ¹è¯¯å·®ï¼</span>
    mse = np.mean((original_gray - compressed) ** 2<span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> mse == 0:  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ è¯¯å·®</span>
        <span style="color: rgba(0, 0, 255, 1)">return</span> float(<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">inf</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    max_pixel </span>= 255.0<span style="color: rgba(0, 0, 0, 1)">
    psnr_value </span>= 20 * log10(max_pixel /<span style="color: rgba(0, 0, 0, 1)"> sqrt(mse))
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> psnr_value

</span><span style="color: rgba(0, 0, 255, 1)">def</span> fft_image_compress(image, block_size=8, keep_ratio=0.1<span style="color: rgba(0, 0, 0, 1)">):
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">åºäºFFTçå¾ååç¼©ï¼èªå¨å¤çå½©è²/ç°åº¦å¾ï¼</span><span style="color: rgba(128, 0, 0, 1)">"""</span>
    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 1. å½©è²å¾è½¬ç°åº¦å¾ï¼åç¼©åªå¤çç°åº¦ï¼ä¿çæ ¸å¿é»è¾ï¼</span>
    <span style="color: rgba(0, 0, 255, 1)">if</span> len(image.shape) == 3<span style="color: rgba(0, 0, 0, 1)">:
        image_gray </span>= np.mean(image, axis=2<span style="color: rgba(0, 0, 0, 1)">).astype(np.uint8)
    </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">:
        image_gray </span>=<span style="color: rgba(0, 0, 0, 1)"> image.astype(np.uint8)
    
    h, w </span>=<span style="color: rgba(0, 0, 0, 1)"> image_gray.shape
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 2. è¡¥é¶ä½¿å¾åå°ºå¯¸ä¸ºblock_sizeçæ´æ°å</span>
    pad_h = (block_size - h % block_size) %<span style="color: rgba(0, 0, 0, 1)"> block_size
    pad_w </span>= (block_size - w % block_size) %<span style="color: rgba(0, 0, 0, 1)"> block_size
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">h {} w {} pad_h {} pad_w {}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">.format(h, w, pad_h, pad_w))
    image_padded </span>= np.pad(image_gray, ((0, pad_h), (0, pad_w)), mode=<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">constant</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    h_pad, w_pad </span>=<span style="color: rgba(0, 0, 0, 1)"> image_padded.shape
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 3. åå§ååç¼©åçé¢åæ°ç»</span>
    fft_compressed = np.zeros_like(image_padded, dtype=<span style="color: rgba(0, 0, 0, 1)">np.complex128)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 4. ååFFT+é«é¢æªæ­</span>
    <span style="color: rgba(0, 0, 255, 1)">for</span> i <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(0, h_pad, block_size):
        </span><span style="color: rgba(0, 0, 255, 1)">for</span> j <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> range(0, w_pad, block_size):
            block </span>= image_padded[i:i+block_size, j:j+<span style="color: rgba(0, 0, 0, 1)">block_size]
            </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 2D-FFTï¼ç©ºé´åâé¢åï¼ä¸­å¿åï¼ä½é¢ç§»å°ä¸­å¿ï¼</span>
            fft_block = np.fft.fft2(block)                  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¯¹å¾åååäºç»´ FFTï¼å°ç©ºé´åçåç´ å¼è½¬æ¢ä¸ºé¢åçå¤æ°ç³»æ°ï¼ä½é¢é»è®¤å¨åè§ï¼é«é¢å¨ä¸­å¿</span>
            fft_block_shifted = np.fft.fftshift(fft_block)  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å°é¢åç³»æ° âä¸­å¿åâï¼æä½é¢ç³»æ°ç§»å°é¢åç©éµçä¸­å¿ï¼é«é¢ç³»æ°åå¸å¨åå¨ï¼æ¹ä¾¿åç»­ç­éä½é¢</span>
            
            <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¡ç®éè¦ä¿ççä½é¢ç³»æ°æ°é</span>
            total_coeffs = block_size * block_size          <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> åä¸ªå¾ååçæ»ç³»æ°æ°ï¼ç­äºåç´ æ°ï¼</span>
            keep_coeffs = int(total_coeffs * keep_ratio)    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> é¢è®¾çä¿çæ¯ä¾ï¼å¦0.1è¡¨ç¤ºä¿ç10%çç³»æ°ï¼</span>
            keep_coeffs = max(keep_coeffs, 1)               <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> é²æ­¢ä¿çç³»æ°ä¸º0ï¼ä¿è¯è³å°ä¿ç1ä¸ªä½é¢ç³»æ°ï¼é¿åéæå¤±è´¥</span>
            
            <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çææ©ç ï¼åªä¿çä½é¢ç³»æ°ï¼é«é¢ç½®0</span>
            center = block_size // 2                        <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> é¢åç©éµçä¸­å¿åæ ï¼å¦ block_size=8 æ¶ï¼center=4ï¼</span>
            y, x = np.ogrid[:block_size, :block_size]       <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çæç½æ ¼åæ ç©éµï¼å¯¹åºæ¯ä¸ªç³»æ°å¨é¢åä¸­çä½ç½®</span>
            distance = np.sqrt((y - center)**2 + (x - center)**2)   <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> è®¡ç®æ¯ä¸ªç³»æ°å°ä¸­å¿çæ¬§å¼è·ç¦»ï¼è·ç¦»è¶å°ï¼é¢çè¶ä½ï¼</span>
            flat_distance = distance.flatten()              <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å°è·ç¦»ç©éµå±å¹³ä¸ºä¸ç»´æ°ç»ï¼æ¹ä¾¿æåº</span>
            idx = np.argsort(flat_distance)[:keep_coeffs]   <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¯¹è·ç¦»ä»å°å°å¤§æåºï¼ååkeep_coeffsä¸ªç´¢å¼ï¼å¯¹åºè·ç¦»ä¸­å¿æè¿çä½é¢ç³»æ°ï¼</span>
            mask_flat = np.zeros(total_coeffs, dtype=bool)  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çæå¸å°æ©ç maskï¼ç»´åº¦ä¸å¾ååä¸è´</span>
            mask_flat[idx] = True                           <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> maskä¸­Trueçä½ç½®å¯¹åºä¿ççä½é¢ç³»æ°ï¼Falseå¯¹åºèå¼çé«é¢ç³»æ°</span>
            mask =<span style="color: rgba(0, 0, 0, 1)"> mask_flat.reshape((block_size, block_size))
            
            </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> åºç¨æ©ç ï¼é«é¢ç³»æ°ç½®é¶</span>
            fft_block_shifted[~mask] = 0    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ~maskï¼åæ©ç çåï¼FalseåTrueï¼TrueåFalseï¼ï¼å³é«é¢ç³»æ°çä½ç½®ã</span>
                                            <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å°é¢åç©éµä¸­é«é¢ç³»æ°çä½ç½®ç½®ä¸º 0ï¼åªä¿çä½é¢ç³»æ°ï¼å®ç° âåç¼©âï¼ä¸¢å¼é«é¢ä¿¡æ¯ï¼</span>
            
            <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> éç§»ä½+éFFTï¼é¢åâç©ºé´å</span>
            fft_block = np.fft.ifftshift(fft_block_shifted) <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> éä¸­å¿åï¼å°é¢åç³»æ°æ¢å¤å° FFT åçåå§ä½ç½®ï¼ä½é¢åå°åè§ï¼</span>
            ifft_block = np.fft.ifft2(fft_block)            <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¯¹å¤çåçé¢åç³»æ°åé FFTï¼è½¬æ¢åç©ºé´åï¼ç»æä¸ºå¤æ°ï¼</span>
            block_recon = np.real(ifft_block)               <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> åå¤æ°çå®é¨ï¼å èå¥è¯¯å·®å¯è½æå¾®å°èé¨ï¼éåé¤ï¼ï¼å¾å°éæåçå¾åååç´ å¼</span>
            
            <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å­å¥åç¼©åæ°ç»</span>
            fft_compressed[i:i+block_size, j:j+block_size] = block_recon <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å°éæåçå¾ååæ¾åfft_compressedæ°ç»çå¯¹åºä½ç½®ï¼æç»æ¼æ¥æå®æ´çåç¼©åå¾å</span>
    
    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 5. å»é¤è¡¥é¶ï¼æ¢å¤åå§å°ºå¯¸</span>
    compressed_image =<span style="color: rgba(0, 0, 0, 1)"> fft_compressed[:h, :w]
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> éå¶åç´ å¼èå´ï¼0~255ï¼ï¼é¿åæº¢åº</span>
    compressed_image = np.clip(compressed_image, 0, 255<span style="color: rgba(0, 0, 0, 1)">).astype(np.uint8)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 6. è®¡ç®åç¼©æ¯ï¼é¢åç³»æ°å±é¢ï¼</span>
    total_original_coeffs = h_pad *<span style="color: rgba(0, 0, 0, 1)"> w_pad
    total_keep_coeffs </span>= (h_pad * w_pad) *<span style="color: rgba(0, 0, 0, 1)"> keep_ratio
    compression_ratio </span>= total_original_coeffs /<span style="color: rgba(0, 0, 0, 1)"> total_keep_coeffs
    
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> compressed_image, compression_ratio

</span><span style="color: rgba(0, 0, 255, 1)">def</span> save_image_with_quality(image, path, quality=95<span style="color: rgba(0, 0, 0, 1)">):
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span><span style="color: rgba(128, 0, 0, 1)">
    å¼å®¹ææçæ¬çå¾åä¿å­å½æ°ï¼æ¯æè®¾ç½®JPGè´¨é
    :param image: ç°åº¦å¾åæ°ç»ï¼uint8ï¼0~255ï¼
    :param path: ä¿å­è·¯å¾ï¼å¦"test.jpg"ï¼
    :param quality: JPGè´¨éï¼0~100ï¼å¼è¶å°åç¼©è¶ç ï¼
    </span><span style="color: rgba(128, 0, 0, 1)">"""</span>
    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å°numpyæ°ç»è½¬ä¸ºPIL Imageå¯¹è±¡</span>
    pil_img =<span style="color: rgba(0, 0, 0, 1)"> Image.fromarray(image)
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ä¿å­ä¸ºJPGï¼è®¾ç½®è´¨éåæ°</span>
    pil_img.save(path, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">JPEG</span><span style="color: rgba(128, 0, 0, 1)">"</span>, quality=<span style="color: rgba(0, 0, 0, 1)">quality)

</span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ä¸»å½æ°ï¼æµè¯FFTå¾ååç¼©</span>
<span style="color: rgba(0, 0, 255, 1)">if</span> <span style="color: rgba(128, 0, 128, 1)">__name__</span> == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">__main__</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 1. è¯»åå¾åï¼æ¿æ¢ä¸ºä½ çå¾åè·¯å¾ï¼</span>
    image_path = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">1.jpg</span><span style="color: rgba(128, 0, 0, 1)">"</span>  <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ¯æå½©è²/ç°åº¦å¾</span>
    <span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)">:
        original_image </span>=<span style="color: rgba(0, 0, 0, 1)"> mpimg.imread(image_path)
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æ³¨æï¼matplotlibè¯»åçå¾ååç´ å¼æ¯0~1çæµ®ç¹æ°ï¼éè½¬å0~255</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> original_image.dtype ==<span style="color: rgba(0, 0, 0, 1)"> np.float32:
            original_image </span>= (original_image * 255<span style="color: rgba(0, 0, 0, 1)">).astype(np.uint8)
    </span><span style="color: rgba(0, 0, 255, 1)">except</span><span style="color: rgba(0, 0, 0, 1)"> FileNotFoundError:
        </span><span style="color: rgba(0, 0, 255, 1)">print</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">éè¯¯ï¼æªæ¾å°å¾åæä»¶ï¼èªå¨çææµè¯ç°åº¦å¾...</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
        </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çæ512Ã512æ¸åç°åº¦å¾ä½ä¸ºæµè¯</span>
        original_image = np.linspace(0, 255, 512*512).reshape(512, 512<span style="color: rgba(0, 0, 0, 1)">).astype(np.uint8)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 2. æ§è¡FFTåç¼©ï¼è°æ´keep_ratioæ§å¶åç¼©æ¯ï¼</span>
    compressed_image, compress_ratio =<span style="color: rgba(0, 0, 0, 1)"> fft_image_compress(
        original_image, block_size</span>=8, keep_ratio=0.1<span style="color: rgba(0, 0, 0, 1)">
    )
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 3. è®¡ç®PSNRï¼ä¿®å¤ç»´åº¦ä¸å¹éé®é¢ï¼</span>
    psnr_value =<span style="color: rgba(0, 0, 0, 1)"> psnr(original_image, compressed_image)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 4. ä¿å­å¾åï¼æ¹ç¨PILï¼æ¯æqualityåæ°ï¼å¼å®¹ææçæ¬ï¼</span>
    <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ä¿å­åå¾ï¼è½¬ç°åº¦åä¿å­ï¼ç»ä¸å¯¹æ¯åºåï¼</span>
    <span style="color: rgba(0, 0, 255, 1)">if</span> len(original_image.shape) == 3<span style="color: rgba(0, 0, 0, 1)">:
        original_gray </span>= np.mean(original_image, axis=2<span style="color: rgba(0, 0, 0, 1)">).astype(np.uint8)
    </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">:
        original_gray </span>=<span style="color: rgba(0, 0, 0, 1)"> original_image
    save_image_with_quality(original_gray, </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">original_gray.jpg</span><span style="color: rgba(128, 0, 0, 1)">"</span>, quality=95<span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> ä¿å­åç¼©åå¾åï¼è®¾ç½®JPGè´¨éï¼å¼è¶å°æä»¶è¶å°ï¼</span>
    save_image_with_quality(compressed_image, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">compressed_final.jpg</span><span style="color: rgba(128, 0, 0, 1)">"</span>, quality=50<span style="color: rgba(0, 0, 0, 1)">)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 5. è®¡ç®å®éæä»¶å¤§å°ï¼KBï¼</span>
    original_size = os.path.getsize(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">original_gray.jpg</span><span style="color: rgba(128, 0, 0, 1)">"</span>) / 1024 <span style="color: rgba(0, 0, 255, 1)">if</span> os.path.exists(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">original_gray.jpg</span><span style="color: rgba(128, 0, 0, 1)">"</span>) <span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)"> 0
    compressed_size </span>= os.path.getsize(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">compressed_final.jpg</span><span style="color: rgba(128, 0, 0, 1)">"</span>) / 1024 <span style="color: rgba(0, 0, 255, 1)">if</span> os.path.exists(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">compressed_final.jpg</span><span style="color: rgba(128, 0, 0, 1)">"</span>) <span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)"> 0
    actual_compression_ratio </span>= original_size / compressed_size <span style="color: rgba(0, 0, 255, 1)">if</span> (compressed_size &gt; 0 <span style="color: rgba(0, 0, 255, 1)">and</span> original_size &gt; 0) <span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)"> 0
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> 6. æ¾ç¤ºç»æ</span>
    plt.figure(figsize=(12, 6<span style="color: rgba(0, 0, 0, 1)">))
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> åå¾ï¼å½©è²/ç°åº¦èªéåºæ¾ç¤ºï¼</span>
    plt.subplot(1, 2, 1<span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> len(original_image.shape) == 3<span style="color: rgba(0, 0, 0, 1)">:
        plt.imshow(original_image)
    </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">:
        plt.imshow(original_image, cmap</span>=<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">gray</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    plt.title(f</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åå§å¾å\nå°ºå¯¸ï¼{original_image.shape[1]}Ã{original_image.shape[0]}\nå¤§å°ï¼{original_size:.2f} KB</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    plt.axis(</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">off</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> åç¼©åå¾åï¼ç°åº¦ï¼</span>
    plt.subplot(1, 2, 2<span style="color: rgba(0, 0, 0, 1)">)
    plt.imshow(compressed_image, cmap</span>=<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">gray</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    plt.title(f</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">FFTåç¼©åå¾å\nçè®ºåç¼©æ¯ï¼{compress_ratio:.1f}:1\nå®éæä»¶åç¼©æ¯ï¼{actual_compression_ratio:.1f}:1\nPSNRï¼{psnr_value:.2f} dB</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    plt.axis(</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">off</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
    
    plt.tight_layout()
    plt.show()
    
    </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> æå°è¯¦ç»ä¿¡æ¯</span>
    <span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">=== åç¼©ç»æ ===</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">çè®ºé¢ååç¼©æ¯ï¼{compress_ratio:.1f}:1</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å®éæä»¶åç¼©æ¯ï¼{actual_compression_ratio:.1f}:1</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åå§æä»¶å¤§å°ï¼{original_size:.2f} KB</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åç¼©åæä»¶å¤§å°ï¼{compressed_size:.2f} KB</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">print</span>(f<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">PSNRï¼å¾åè´¨éï¼ï¼{psnr_value:.2f} dB</span><span style="color: rgba(128, 0, 0, 1)">"</span>)</pre>
</div>
<span class="cnblogs_code_collapse">å¾ååç¼©</span></div>
<p>ç¨åºè¿è¡ææå¦ä¸ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260203102142852-1233020511.png" alt="image" width="762" height="510" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å ä¸ºè¿è¡ç»ææ¾ç¤ºåè¾¨çä¸é«ï¼çèµ·æ¥åç¼©åçå¾çååå¾å¹¶æ²¡æå¤ªå¤§çä¸åï¼ä½æ¯å°å¾çæ¾å¤§ä»¥åè¿æ¯å¯ä»¥ææ¾çåºåç¼©åå¾ççå¤±çï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260203102615726-1795473578.png" alt="image" width="503" height="354" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<h1>åèï¼</h1>
<p>1&nbsp;<a href="https://zhuanlan.zhihu.com/p/19763358" target="_blank" rel="noopener nofollow">https://zhuanlan.zhihu.com/p/19763358</a></p>
<p>2&nbsp;<a href="https://www.cnblogs.com/xxeray/p/fast-fourier-transform.html" target="_blank">https://www.cnblogs.com/xxeray/p/fast-fourier-transform.html</a></p>
<p>3&nbsp;<a href="https://blog.csdn.net/qq_42212808/article/details/156030009" target="_blank" rel="noopener nofollow">https://blog.csdn.net/qq_42212808/article/details/156030009</a></p>
<p>4&nbsp;<a href="https://zhuanlan.zhihu.com/p/350616936" target="_blank" rel="noopener nofollow">https://zhuanlan.zhihu.com/p/350616936</a></p>
<p>5&nbsp;<a href="https://www.cnblogs.com/zwfymqz/p/8244902.html" target="_blank">https://www.cnblogs.com/zwfymqz/p/8244902.html</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.16527777777777777" data-date-updated="2026-02-03 18:43">2026-02-03 14:45</span>&nbsp;
<a href="https://www.cnblogs.com/zhaoweiwei">weiwei22844</a>&nbsp;
éè¯»(<span id="post_view_count">162</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19522497);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19522497', targetLink: 'https://www.cnblogs.com/zhaoweiwei/p/19522497/FFT', title: 'æ·±å¥çè§£åéå¶åæ¢' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åç¹æ¯æ AI æ»çï¼AI ç¼ç¨æå¤§çè°è¨ï¼æ¯ âææâ ]]></title>
    <link>https://www.cnblogs.com/yupi/p/19568098</link>
    <guid>57477ea3b2ae5447f9737b87c3c9174b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yupi/p/19568098" title="åå¸äº 2026-02-03 11:08">
    <span role="heading" aria-level="2">åç¹æ¯æ AI æ»çï¼AI ç¼ç¨æå¤§çè°è¨ï¼æ¯ âææâ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/2225420/202602/2225420-20260203102512118-1547421356.png" alt="åç¹æ¯æ AI æ»çï¼AI ç¼ç¨æå¤§çè°è¨ï¼æ¯ âææâ" class="desc_img">
        åä¸¤å¤©ï¼åç¹æ¯æ AI æ»ç Andrej Karpathy å¨ X ä¸åäºä¸æ¡é¿å¸å­ï¼åå®¹æ¯ä»æè¿å å¨å¤§éä½¿ç¨ Claude ç¼ç¨çææã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p class="md-end-block md-heading"><span class="md-plain">å¤§å®¶å¥½ï¼ææ¯ç¨åºåé±¼ç®ã</span></p>
<p class="md-end-block md-p"><span class="md-plain">åä¸¤å¤©ï¼åç¹æ¯æ AI æ»ç Andrej Karpathy å¨ X ä¸åäºä¸æ¡é¿å¸å­ï¼åå®¹æ¯ä»æè¿å å¨å¤§éä½¿ç¨ Claude ç¼ç¨çææã</span></p>
<p class="md-end-block md-p"><span class="md-plain">ç»æè¿æ¡å¸å­ç´æ¥çäºï¼éè¯»éè¶è¿ 600 ä¸ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/image-20260129105316297.png"><img data-src="https://pic.yupi.icu/1/image-20260129105316297.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">åç®åä»ç»ä¸ä¸ãå¡å¸è¥¿ãè¿ä½å¤§ä½¬ï¼æ¯å¦ç¦ AI åå£«ï¼å¸ä»æé£é£ï¼OpenAI åå§æåä¹ä¸ï¼åæ¥å»ç¹æ¯æå½äº AI æ»çï¼è´è´£èªå¨é©¾é©¶çè§è§ç³»ç»ã2024 å¹´ç¦»å¼ç¹æ¯æåï¼ä»ååäº Eureka Labsï¼ä¸æ³¨ç¨ AI åæè²ã</span></p>
<p class="md-end-block md-p"><span class="md-plain">ä¸å¤¸å¼ å°è¯´ï¼ä»å¯è½æ¯å¨çææ AIãåæè½åä»£ç çäººä¹ä¸ã</span></p>
<p class="md-end-block md-p"><span class="md-plain">å¨ 2023 å¹´ 1 æçæ¶åï¼ä»å°±æåºè¿ï¼æªæ¥æç­é¨çæ°ç¼ç¨è¯­è¨æ¯èªç¶è¯­è¨ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/image-20260129110428465.png"><img data-src="https://pic.yupi.icu/1/image-20260129110428465.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">ä½ ç°å¨åè¿å¤´æ¥çè¿å¥è¯ï¼å°±ç¥éè¿å¥ä»¬æå¤çç®äºã</span></p>
<p class="md-end-block md-p"><span class="md-plain">æä»¥ææ¯æ¬¡çä»åäº«çåå®¹æ¶ï¼é½ä¼åæ²æµ´æ´è¡£ï¼è®©èªå·±è½å¤è¿å¥æ·±åº¦æèç¶æã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/image-20260129110706081.png"><img data-src="https://pic.yupi.icu/1/image-20260129110706081.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">è¿å¥æ­£é¢ï¼è¿æ¡å¸å­éæå¾å¤å¹²è´§ï¼ä½è®©æå°è±¡ææ·±çæ¯è¿å¥è¯ï¼</span></p>
<blockquote>
<p class="md-end-block md-p"><span class="md-plain">æä¸å¤ªæ¸æ¥å¦ä½è¡¡é AI å¸¦æ¥çå éãææè§åäºç¡®å®å¿«äºï¼<span class="md-pair-s "><strong>ä½ä¸»è¦çæææ¯æåçæ¯åè®¡åå¤å¾å¤</strong><span class="md-plain">ã</span></span></span></p>
</blockquote>
<p class="md-end-block md-p">&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain">å¡å¸è¥¿è¯´ï¼ç°å¨ä»å¯ä»¥éæåä¸äºä»¥å âä¸å¼å¾åâ çå°å·¥å·ï¼ä¹æ¢å»ç¢°ä»¥åå ä¸ºææ¯æ ä¸çèä¸æ¢ç¢°çä»£ç äºã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/image-20260129111053502.png"><img data-src="https://pic.yupi.icu/1/image-20260129111053502.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-pair-s "><strong>æä»¥ AI ç¼ç¨å¸¦æ¥çæ ¸å¿ååä¸æ¯å éï¼èæ¯æ©å±ã</strong></span></p>
<p class="md-end-block md-p"><span class="md-plain">æè§å¾è¿ä¸ªè§å¯å¤ªåäºï¼</span></p>
<p class="md-end-block md-p"><span class="md-plain">ä¹åå¾å¤äººé®æï¼AI ç¼ç¨è½ææå¤å°åï¼</span></p>
<p class="md-end-block md-p"><span class="md-plain">å¶å®è¿ä¸ªé®é¢æ¬èº«å°±é®éäºãAI å¸¦æ¥ççæ­£ååä¸æ¯ âåä¸ä»¶äºåå¾æ´å¿«âï¼èæ¯ âä½ å¼å§åä»¥åæ ¹æ¬ä¸ä¼åçäºâã</span></p>
<p class="md-end-block md-p"><span class="md-plain">è¿å°±åä½ ä»¥åéªèªè¡è½¦ï¼ç°å¨æ¢äºè¾è½¦ãä½ ä¸ä¼è¯´èªå·±éªè½¦å¿«äº 10 åï¼èæ¯ä¼è¯´èªå·±è½å»æ´è¿çå°æ¹äºã</span></p>
<p class="md-end-block md-p">&nbsp;</p>
<h2 class="md-end-block md-heading"><span class="md-plain">äººæ¯ä¸è¿ AI çä¸ç¹</span></h2>
<p class="md-end-block md-p"><span class="md-plain">å¸å­éè¿æå ä¸ªç¹æºæææçï¼è·å¤§å®¶åäº«ä¸ä¸ã</span></p>
<p class="md-end-block md-p"><span class="md-plain">å¡å¸è¥¿è¯´ï¼ç AI å¨ä¸ä¸ª Bug ä¸æ­»ç£ 30 åéï¼ä¸æ¾å¼ãä¸æ°é¦ï¼æåççæå®äº ââ è¿æ¯ä»æå AGI çæ¶å»ã</span></p>
<p class="md-end-block md-p"><span class="md-plain">æçå°è¿æ®µå°±æ³èµ·èªå·±å¤§å­¦åå­¦ç¼ç¨æ¶æ¹ Bug çç»åãå·²ç»æ¯åæ¨ä¸ä¸¤ç¹ï¼è¯äºå¥½å ç§æ¹æ³é½æ²¡ç¨ï¼æçå¿æå·²ç»å´©äºï¼çè³æç¹å¿å¿ç»çï¼äºæ¯æ³çæå¤©åè¯´å§ï¼çå½è¦ç´§â¦â¦</span></p>
<p class="md-end-block md-p"><span class="md-plain">ä½ AI ä¸ä¼è¿æ ·ï¼åªè¦ä½ ç Tokens è¶³å¤ï¼å®ä¼ä¸ç´è· Bug æ­»ç£ã</span></p>
<p class="md-end-block md-p"><span class="md-pair-s "><strong>èåè¿ä»¶äºï¼æ­£å¨ä»äººç±»çç¶é¢åæ AI çä¼å¿ã</strong></span></p>
<p class="md-end-block md-p"><span class="md-plain">å½ç¶ï¼ä»£ä»·å°±æ¯ç§ Tokenãæä»¥ç¨åºåçåºæ¬åè¿æ¯å¾éè¦çï¼è³å°ä½ å¾è½å¤æ­è¿ä¸ª Bug å¼ä¸å¼å¾è®© AI è±åå°æ¶å»ç£ï¼æä¹éè¿æå¼ AI è®©å®æ´å¿«æ´çå°è§£å³é®é¢ã</span></p>
<p class="md-end-block md-p">&nbsp;</p>
<h2 class="md-end-block md-heading"><span class="md-plain">ç¼ç¨åå¾æ´æè¶£äºï¼</span></h2>
<p class="md-end-block md-p"><span class="md-plain">å¡å¸è¥¿è¯´ï¼ç¨ AI ç¼ç¨ä¹åï¼é£äºå¡«ç©ºå¼çè¦å·®äºæ²¡äºï¼å©ä¸çé½æ¯åé æ§çé¨åãæä»¥åèè§å¾æ´å¥½ç©äºã</span></p>
<p class="md-end-block md-p"><span class="md-plain">ä½ä»ä¹æå°ï¼æäºç¨åºåä¼è§å¾å¤±å»äºä¹è¶£ãå ä¸ºå¯¹ä»ä»¬æ¥è¯´ï¼åä»£ç æ¬èº«å°±æ¯å¿«ææ¥æºã</span></p>
<p class="md-end-block md-p"><span class="md-plain">è¿å¯è½æ¯ä¸ä¸ªåæ°´å²­ï¼<span class="md-pair-s "><strong>ä¸»è¦äº«å âåä»£ç â çäººï¼åä¸»è¦äº«å âé ä¸è¥¿â çäººï¼ä½éªä¼å¾ä¸ä¸æ ·ã</strong></span></span></p>
<p class="md-end-block md-p"><span class="md-plain">æçå°ä¸ä½ AI åçå¤§ V æè¿ç¹ç§°ä¸º âç¨åºåæ­£å¨åè£æä¸¤ä¸ªç©ç§âãä¸è¿æåè§å¾ï¼è¿ä¸¤ç±»äººå¶å®ä¸ç´é½å­å¨ãæçäººäº«åä»£ç æ¬èº«çä¼éï¼è¿½æ±ææ¯çæ·±åº¦åç»èï¼ååºæ¼äº®çä»£ç ä¼ææå°±æï¼æçäººæ´å¨ä¹ä¸è¥¿è½ä¸è½è·èµ·æ¥ãè½ä¸è½è§£å³é®é¢ï¼ä»£ç åªæ¯å®ç°æ³æ³çå·¥å·ãAI åªæ¯æè¿ä¸ªå·®å¼æ¾å¤§äºèå·² ââ åèå¯è½ä¼æç¹å¤±è½ï¼åèåè¿æ¥äºé»éæ¶ä»£ã</span></p>
<p class="md-end-block md-p">&nbsp;</p>
<h2 class="md-end-block md-heading"><span class="md-plain">ææ­£å¨å¤±å»åä»£ç çè½åï¼ä½æ¯â¦</span></h2>
<p class="md-end-block md-p"><span class="md-plain">å¡å¸è¥¿è¯´ï¼èªå·±æå¨åä»£ç çè½åæ­£å¨æ¢æ¢éåã</span></p>
<p class="md-end-block md-p"><span class="md-plain">ä½æ¯ä»ä»çè¯ä¸­è½æåå°ï¼ä»å¯¹æ­¤çæåº¦æ¯ âå·²ç»ä¸å¤ªå¨ä¹äºâã</span></p>
<p class="md-end-block md-p"><span class="md-plain">ä»ç»äºä¸ä¸ªæææçè§è§ï¼åä»£ç ï¼çæï¼åè¯»ä»£ç ï¼å¤å«ï¼æ¯å¤§èéä¸åçè½åãå°±åä½ å¯è½åä¸åºä¸é¦å¥½è¯ï¼ä½è½çåºä¸é¦è¯åå¾å¥½ä¸å¥½ã</span></p>
<p class="md-end-block md-p"><span class="md-plain">ç¼ç¨ä¹æ¯ä¸æ ·ãå¶å®æ³æ³çï¼ä»¥åæ²¡æ AI çæ¶åï¼é£äºè¯­æ³ç»èãAPI ç¨æ³ï¼æä»¬ä¸ä¹æ¯é æ¥ææ¡£ãå©ç¨ç¼è¾å¨çæç¤ºåï¼çæ­£éè¦è®°å¨èå­éçä»æ¥å°±ä¸å¤ãç°å¨ AI æè¿é¨åæ¥ç®¡äºï¼ä½ä»£ç çè®¾è®¡æè·¯å¯¹ä¸å¯¹ãæ¶æåä¸åçï¼è¿æ¯å¾é ä½ èªå·±å¤æ­ã</span></p>
<p class="md-end-block md-p"><span class="md-plain">æä»¥æªæ¥ç¨åºåçè§è²ï¼å¯è½æ´åæ¯ âææ¯å¯¼æ¼â èä¸æ¯ âç åâãä½ è´è´£ææ§æ¹åãååºå³ç­ï¼AI è´è´£æ§è¡ç»èãå¡«è¡¥ç©ºç½ã</span></p>
<p class="md-end-block md-p">&nbsp;</p>
<h2 class="md-end-block md-heading"><span class="md-plain">2026 å¹´åå¾åå®¹ä¼çåï¼ä½æ¯â¦</span></h2>
<p class="md-end-block md-p"><span class="md-plain">å¡å¸è¥¿è¿æå°äºä¸ä¸ªè¯ï¼<span class="md-pair-s"><code>Slopacolypse</code></span></span></p>
<p class="md-end-block md-p md-focus"><span class="md-plain md-expand">ææäºä¸ä¸ï¼åç°è¿å¶å®æ¯æè¿ AI åæµè¡èµ·æ¥çä¸ä¸ª âslop ç³»åâ é è¯ãSlop æçæ¯é£äºç¨ AI æ¹éçæçä½è´¨éåå®¹ï¼Slopacolypse å°±æ¯ Slop + Apocalypseï¼æçè§£æ¯ âåå¾åå®¹æ«æ¥â çææã</span></p>
<p class="md-end-block md-p"><span class="md-plain">ä»é¢æµ 2026 å¹´ï¼GitHubãåç§ç¤¾äº¤åªä½é½ä¼è¢« AI çæçä½è´¨éåå®¹æ·¹æ²¡ãå½çäº§åå®¹çé¨æ§å¤§å¹éä½ï¼æ³¨æååèä¼åå¾æ´ç¨ç¼ºã</span></p>
<p class="md-end-block md-p"><span class="md-plain">ä½ä»ä¹è¯´ï¼çæ­£çæ¹è¿ä¹å¨åæ­¥åçãAI çæºè½é¨åå·²ç»è·å¨åé¢äºï¼ç°å¨åèæ¯å·¥å·ãæµç¨ãç»ç»è¿äºä¸è¥¿è¿æ²¡è·ä¸ã<span class="md-pair-s "><strong>2026 å¹´ï¼æ´ä¸ªè¡ä¸ä¼è±å¤§éç²¾åå»æ¶åè¿æ³¢æ°è½åã</strong></span></span></p>
<p class="md-end-block md-p"><span class="md-plain">è¯´å°è¿éï¼ææ³èµ·èªå·±èº«è¾¹çæåµãAI é¢åå ä¹æ¯å¤©é½ææ°å·¥å·ãæ°æ¨¡åãæ°ç©æ³ååºæ¥ï¼ä½çæ­£æè¯å°è¿äºååãçæ­£å»ç¨è¿äºæ°ä¸è¥¿çäººï¼åæå¤å°å¢ï¼</span></p>
<p class="md-end-block md-p"><span class="md-plain">æç»å¸¸å¬å°æäººè¯´ âåç­å ä¸ªæï¼ç­åºäºæ´å¥½çåå­¦âãâç°å¨çè¿ä¸å¤æçâãä½é®é¢æ¯ï¼å¨ä½ ç­å¾çè¿å ä¸ªæéï¼å·²ç»æäººç¨ AI ååºäºä»¥ååä¸å°çä¸è¥¿ï¼æå¼äºå·®è·ã</span></p>
<p class="md-end-block md-p"><span class="md-plain">æä»¥å¯¹äºæä»¬ç¨åºåæ¥è¯´ï¼ä¸æ¹é¢å¿é¡»è¦å©ç¨ AI æåå¼åæçåä¼åå·¥ä½æµç¨ã</span></p>
<p class="md-end-block md-p"><span class="md-plain">å¦å¤ä¸æ¹é¢ï¼ä¸å¦¨æå¼æè·¯ï¼å¤æ³ä¸æ³ï¼<span class="md-pair-s "><strong>æäº AIï¼ä½ è½åå°åªäºä»¥ååä¸å°çäºï¼</strong></span></span></p>
<p class="md-end-block md-p"><span class="md-plain">ä»¥åä¸æ¢ç¢°çææ¯æ ï¼ç°å¨æ¢è¯äºï¼ä»¥åè§å¾ä¸å¼å¾åçå°å·¥å·ï¼ç°å¨éæå°±è½æå®ï¼ä»¥åå¡ä½å°±æ¾å¼ç bugï¼ç°å¨æä¸ªä¸ç¥ç²å¦çå©æå¸®ä½ æ­»ç£ã</span></p>
<p class="md-end-block md-p"><span class="md-plain">è¿ææ¯ AI ç¼ç¨çæ­£ççº¢å© ââ <span class="md-pair-s "><strong>ä¸æ¯è®©ä½ æ´å¿«ï¼æ¯è®©ä½ æ´å¤§ã</strong></span></span></p>
<p class="md-end-block md-p"><span class="md-plain">å¦æä½ è¿æ²¡å¼å§ç¨ AI ç¼ç¨ï¼æèæ³ç³»ç»å­¦ä¹ æä¹ç¨çæ´å¥½ï¼å¯ä»¥ççæææ°åè´¹å¼æºç <span class="md-meta-i-c  md-link"><a href="https://github.com/liyupi/ai-guide" rel="noopener nofollow"><span class="md-plain">ãAI ç¼ç¨é¶åºç¡å¥é¨æç¨ã</span></a><span class="md-plain">ï¼ä» 0 å¼å§å¸¦ä½ ç¨ AI ç¼ç¨ååºé¡¹ç®ï¼åå«åç§å·¥å·ç¨æ³ãå®ææå·§ãç¼ç¨èµæºãçè³æ¯äº§ååç°ç»éªå¨é½æãå¸æè½å¸®ä½ æ´å¿«å°æ¥æ±è¿ä¸ªæ°æ¶ä»£ï¼ä¸èµ·åå¾æ´å¤§ãæ´å¼ºï¼</span></span></span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1769602550375-03684a1f-3581-43bb-91d4-7a8acbb90b16-20260129112513596.png"><img data-src="https://pic.yupi.icu/1/1769602550375-03684a1f-3581-43bb-91d4-7a8acbb90b16-20260129112513596.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/vibecoding%E9%9B%B6%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%E5%A4%A7%E7%BA%B2.jpeg"><img data-src="https://pic.yupi.icu/1/vibecoding%E9%9B%B6%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%E5%A4%A7%E7%BA%B2.jpeg" class="lazyload"></span></p>
<p class="md-end-block md-p">&nbsp;</p>
<h2 class="md-end-block md-heading"><span class="md-plain">æ´å¤ç¼ç¨å­¦ä¹ èµæº</span></h2>
<ul class="ul-list" data-mark="-">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/course" rel="noopener nofollow"><span class="md-plain">Javaåç«¯ç¨åºåå¿åé¡¹ç®å®ææç¨+æ¯è®¾ç½ç«</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/" rel="noopener nofollow"><span class="md-plain">ç¨åºååè´¹ç¼ç¨å­¦ä¹ äº¤æµç¤¾åºï¼èªå­¦å¿å¤ï¼</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/course/cv" rel="noopener nofollow"><span class="md-plain">ç¨åºåä¿å§çº§æ±èåç®åæåï¼æ¾å·¥ä½å¿å¤ï¼</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.mianshiya.com/" rel="noopener nofollow"><span class="md-plain">ç¨åºååè´¹é¢è¯å·é¢ç½ç«å·¥å·ï¼æ¾å·¥ä½å¿å¤ï¼</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640584449888772098" rel="noopener nofollow"><span class="md-plain">ææ°Javaé¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + Javaæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640586673306091521" rel="noopener nofollow"><span class="md-plain">ææ°Pythoné¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + Pythonæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640586014108303362" rel="noopener nofollow"><span class="md-plain">ææ°åç«¯é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + åç«¯æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640586867363954689" rel="noopener nofollow"><span class="md-plain">ææ°æ°æ®ç»æåç®æ³é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + ç®æ³æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1644279832026075138" rel="noopener nofollow"><span class="md-plain">ææ°C++é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ãC++æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1641797333479903234" rel="noopener nofollow"><span class="md-plain">ææ°æ°æ®åºé¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + æ°æ®åºæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640589994284695553" rel="noopener nofollow"><span class="md-plain">ææ°Redisé¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + Redisæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1641035880439271426" rel="noopener nofollow"><span class="md-plain">ææ°è®¡ç®æºåºç¡å¥é¨å­¦ä¹ è·¯çº¿ + è®¡ç®æºåºç¡æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1641366118197153793" rel="noopener nofollow"><span class="md-plain">ææ°å°ç¨åºå¥é¨å­¦ä¹ è·¯çº¿ + å°ç¨åºå¼åæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="http://sqlmother.yupi.icu/" rel="noopener nofollow"><span class="md-plain">ææ°SQLé¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + SQLæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640586295529324545" rel="noopener nofollow"><span class="md-plain">ææ°Linuxé¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + Linuxæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640588753362108417" rel="noopener nofollow"><span class="md-plain">ææ°Git/GitHubé¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + Gitæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640587909942099969" rel="noopener nofollow"><span class="md-plain">ææ°æä½ç³»ç»é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + æä½ç³»ç»æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640588119619551233" rel="noopener nofollow"><span class="md-plain">ææ°è®¡ç®æºç½ç»é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + è®¡ç®æºç½ç»æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640588392073150465" rel="noopener nofollow"><span class="md-plain">ææ°è®¾è®¡æ¨¡å¼é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + è®¾è®¡æ¨¡å¼æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c md-link"><a href="https://www.code-nav.cn/post/1640648711119892481" rel="noopener nofollow"><span class="md-plain">ææ°è½¯ä»¶å·¥ç¨é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + è½¯ä»¶å·¥ç¨æç¨</span></a></span></p>
</li>
</ul>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-03 11:09">2026-02-03 11:08</span>&nbsp;
<a href="https://www.cnblogs.com/yupi">ç¨åºåé±¼ç®</a>&nbsp;
éè¯»(<span id="post_view_count">552</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19568098);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19568098', targetLink: 'https://www.cnblogs.com/yupi/p/19568098', title: 'åç¹æ¯æ AI æ»çï¼AI ç¼ç¨æå¤§çè°è¨ï¼æ¯ âææâ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ DTSæä¸å¡åºæ¯æ¹éè¿ç§»é¿éäºMySQLè¡¨å®æï¼ä¸ï¼ï¼è¿ç§»ç®¡çå¹³å°è®¾è®¡ä¸å®ç° ]]></title>
    <link>https://www.cnblogs.com/wuyuegb2312/p/19571685</link>
    <guid>37dca18d15977148a0baed5b6874a714</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/wuyuegb2312/p/19571685" title="åå¸äº 2026-02-03 22:34">
    <span role="heading" aria-level="2">DTSæä¸å¡åºæ¯æ¹éè¿ç§»é¿éäºMySQLè¡¨å®æï¼ä¸ï¼ï¼è¿ç§»ç®¡çå¹³å°è®¾è®¡ä¸å®ç°</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ¬ææ¯ <a href="https://www.cnblogs.com/wuyuegb2312/p/19566555" target="_blank">DTSæä¸å¡åºæ¯æ¹éè¿ç§»é¿éäºMySQLè¡¨å®æï¼ä¸ï¼ï¼ææ¯éååAPIå¯¹æ¥</a>  çåç»­ï¼åºç¨ç¶ææ¨¡å¼ï¼å®æä¸å¡ç³»ç»ä¸­çè¿ç§»æ¨¡åãDTSçå¯¹æ¥æ¹å¼å¯åèåæã</p>
<h1 id="è¿ç§»ç®¡çå¹³å°è®¾è®¡ä¸å®ç°">è¿ç§»ç®¡çå¹³å°è®¾è®¡ä¸å®ç°</h1>
<p>å®æDTS APIå¯¹æ¥åï¼å°±éè¦èèå¦ä½å°DTSåä¸å¡ç³»ç»ææºç»åå®ç°æ´å¥çè¿ç§»æµç¨ã</p>
<p>åºäºä¿¡æ¯å®å¨è§åº¦çèèï¼æ¬æå é¤äºå¤§éæ¶åå®éä¸å¡çå®ç°ä»£ç ã</p>
<h2 id="ä¸å¡çº¦æ">ä¸å¡çº¦æ</h2>
<p>ä»ä¸å¡åºåï¼æå¥½çä½éªè¯å®æ¯ç¨æ·æ æçï¼å³è¿ç§»å®æåï¼ç¡®è®¤æ°æ§è¡¨æ°æ®ä¸è´ï¼ç´æ¥åæ¢å°æ°è¡¨æ¥è¯¢ã</p>
<p>æ¾ç¶è¿äºçæ³åäºï¼å¦æè¿ç§»æé´ï¼ç¨æ·å¯¹æ§è¡¨è¿è¡äºåå¥ï¼æ°è¡¨å¯è½ä¼å°æ°æ®ï¼ä¸è½è´¸ç¶åæ¢ï¼è¦åæ°æ®çå¯¹æ¯ãå¦æç¨æ·ä¸ç´å¨åå¥ï¼å°±è¦ä¸ç´åå¤çå¯¹æ¯ãç¡®è®¤ï¼æå¢éæ°æ®å°±è¦å é¤æ°è¡¨éæ°è¿ç§»ï¼æµç¨å¤æã</p>
<p>åä¸å¡æ¹æ²éï¼å¾ç¥å¯¹æ¹å¯ä»¥ç¦æ­¢åå¥æ­£å¨è¿ç§»çå¬å¸çè¡¨ï¼ç­è¿ç§»å®æååæ¢å¤ä½¿ç¨ãè¿æ ·æµç¨å°±ç®åå¤äºï¼å¼å§è¿ç§»æ¶ï¼å°æ§è¡¨éå½åå¢å ç¹æ®çåç¼ï¼å°±è½é²æ­¢ç¨æ·æä½ï¼å¹¶ç¡®ä¿æ§è¡¨æ°æ®ä¸åçåæ´ã</p>
<h2 id="ææ¯æ ¡éª">ææ¯æ ¡éª</h2>
<p>å¦ä½å¤æ­ä¸ä¸ªå¬å¸æ¯å¦è¿ç§»æåï¼æä¸¥è°¨çæ¹å¼æ¯éè¡¨éè¡æ°æ®å¯¹æ¯ï¼ä½æ¯å¨ä½¿ç¨DTSçæåµä¸å¹¶æ å¿è¦ãæéåçæ¯è¾ç­ç¥æ¯ï¼å¨è¿ç§»ååï¼</p>
<ol>
<li>
<p>æºè¡¨ç®æ è¡¨æ°éç¸å</p>
</li>
<li>
<p>å¯¹åºè¡¨æ°æ®éç¸åãæ°æ®æåæ´æ°æ¶é´ï¼å¦ææ­¤åï¼ç¸å</p>
</li>
</ol>
<p>åªè¦æ»¡è¶³ä»¥ä¸è¦æ±ï¼å°±è®¤ä¸ºæ°æ®æ¯ä¸è´çãå¯ä»¥éè¿SELECT COUNT(*), MAX(updateTime) FROM table_nameä¸æ¬¡æ§è·åã</p>
<h2 id="è¿ç§»ç¶ææº">è¿ç§»ç¶ææº</h2>
<p>ç»è¿åæåç®åï¼è¿ç§»ç¶ææºå¦ä¸ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/228024/202602/228024-20260203223055533-1166349172.png" alt="image" loading="lazy"></p>
<p>å¯ä»¥åç°ï¼æ¯ä¸ªç¶æé½å¯ä»¥è¿è¡âæ¨è¿âåâåæ»âä¸¤ä¸ªå¨ä½ï¼å¾éåä½¿ç¨ç¶ææ¨¡å¼æ¥å®ç°ãç¶ææ¨¡å¼çå®ç°åæ¾ä¸æ¾ï¼ççå ä¸ªåºæ¬æ°æ®ç»æï¼</p>
<h2 id="è¿ç§»ä»»å¡">è¿ç§»ä»»å¡</h2>
<pre><code class="language-Java">@Data
public class TableMigrateTask {
  // ä¸»é®
  private Long id;
  // å¬å¸id
  private Long companyId;
  // åå§ååºä½
  private Long oldSchemaId;
  // æ°ååºä½
  private Long newSchemaId;
  // ä»»å¡ç¶æ
  private Integer state;
  // DTSä»»å¡ç¶æï¼åé¿éäºå®ä¹ä¸è´
  private String dtsStatus;
  // DTSä»»å¡å·²å é¤ï¼éæ¾ï¼
  private Boolean dtsDeleted;
  // DTSå®ä¾id
  private String dtsInstanceId;
  // DTSä»»å¡id
  private String dtsJobId;
  // å¤±è´¥åå 
  private String failedReason;
  // ç¶æè·³è½¬æ¶çä¿¡æ¯ï¼è¾å©ææ¥é®é¢
  private String transitInfo;
  // è¿ç§»åè¡¨æ°æ®ç»è®¡ï¼jsonæ ¼å¼ï¼è¡¨åãæ°æ®éãæåæ´æ°æ¶é´
  private String tableStatisticsSrc;
  // è¿ç§»è¡¨ç»æç»è®¡ï¼jsonæ ¼å¼kvç»æï¼è¡¨å-æ°æ®é
  private String tableStatisticsDest;
}
</code></pre>
<h2 id="è¿ç§»ä¸ä¸æ">è¿ç§»ä¸ä¸æ</h2>
<p>è¿ç§»ç¶ææºå®éå¤ççå¯¹è±¡ï¼å°è£äºä¸äºæå¡ï¼å¯ä»¥è§ä¸ºé¢åå¯¹è±¡ï¼åè¡æ¨¡åï¼ã</p>
<pre><code class="language-Java">@Setter
public class TableMigrateExecuteContext {

  // ææçä»»å¡å¯¹è±¡
  @Getter
  private TableMigrateTask tableMigrateTask;

  // å½åçç¶æ
  @Getter
  private TableMigrateState currentState;

  private TableMigrateTaskRepository tableMigrateTaskRepository;

  private TableMigrateQueryService tableMigrateQueryService;

  private TableMigrateService tableMigrateService;

  private TableArchiveService tableArchiveService;

  private DataSourceHolder dataSourceHolder;

  public void createInstanceAndConfigureDtsJob() {
      // è°ç¨DTS APIåå»ºä»»å¡
  }

  public DescribeDtsJobDetailResponse queryDtsMigJob() {
      // è°ç¨DTS APIæ¥è¯¢
  }

  public void switchRoute(long oldSchemaId, long newSchemaId) {
      // å°åè¡¨ä»¥å¤çåè¡¨updateä¸ºnewSchemaId
  }

  public void stopDtsMigJob() {
      // è°ç¨DTS APIåæ­¢
  }

  public void updateTableMigrateTask(TableMigrateTask modifiedTask) {
       // æ´æ°ææçä»»å¡(æä¹å)
  }

  /**
   * ç¶ææ¨è¿
   *
   * @return è¿åä¿¡æ¯ï¼ä¸æåæ¶éç©º
   */
  public String forward() {
    return currentState.forward(this);
  }

  /** ç¶æåæ» */
  public String rollback() {
    return currentState.rollback(this);
  }

  /**
   * éå½åæ§è¡¨
   *
   * @param forward true-è¿ç§»åºæ¯ï¼å ââmigoldï¼åä¹åä¸å 
   * @param ignoreExited æ¯å¦å¿½ç¥å·²å­å¨çè¡¨ï¼ä»å¨åå§æçåæ»åºæ¯å¯ç¨
   */
  public void renameOldTableNames(boolean forward, boolean ignoreExited) {
      // æ³¨æè¦èèæºåºä¸­æ¯å¦å­å¨åæ§è¡¨ç¸åçååè¡¨
  }


  public void updateDestTableInfo() {
     // æ´æ°ç®æ è¡¨çç»è®¡ä¿¡æ¯
  }

  public void archiveNewTables(List&lt;String&gt; needArchiveTables) {
      // å½æ¡£æ°è¡¨  
  }

  /**
   * å é¤è¡¨
   *
   * @param newTable true-æ°è¡¨ï¼false-æ§è¡¨
   */
  public void deleteTables(boolean newTable) {
      // æ¹éæ§è¡DROP TABLE
  }

  public void deleteDtsInstanceAndJob() {
      // è°ç¨DTS APIéæ¾å®ä¾
  }
}
</code></pre>
<h3 id="å·¥åç±»">å·¥åç±»</h3>
<pre><code class="language-Java">@Component
public class TableMigrateContextFactory {

  @Resource private TableMigrateTaskRepository tableMigrateTaskRepository;
  @Resource private TableMigrateQueryService tableMigrateQueryService;
  @Resource private TableMigrateService tableMigrateService;
  @Resource private TableArchiveService tableArchiveService;
  @Resource private DataSourceHolder dataSourceHolder;

  public TableMigrateExecuteContext buildContext(long taskId) {
    TableMigrateTask task = tableMigrateTaskRepository.getById(taskId);
    if (task == null || task.getStatus() == 0) {
      throw new BizException("è¡¨è¿ç§»ä»»å¡ä¸å­å¨æå·²è¢«å é¤");
    }
    TableMigrateExecuteContext context = new TableMigrateExecuteContext();
    context.setTableMigrateTask(task);
    context.setCurrentState(buildState(TableMigrateStateEnum.getByValue(task.getState())));

    // æå¡æ³¨å¥
    context.setTableMigrateTaskRepository(tableMigrateTaskRepository);
    context.setTableMigrateQueryService(tableMigrateQueryService);
    context.setTableMigrateService(tableMigrateService);
    context.setTableArchiveService(tableArchiveService);
    context.setDataSourceHolder(dataSourceHolder);
    return context;
  }

  private TableMigrateState buildState(TableMigrateStateEnum stateEnum) {
    switch (stateEnum) {
      case INIT:
        return new MigrateInitState();
      case FAILED:
        return new MigrateFailedState();
      case PROCESSING:
        return new MigrateProcessingState();
      case NEED_SWITCH:
        return new MigrateNeedSwitchState();
      case SWITCHED:
        return new MigrateSwitchedState();
      case FINISH:
        return new MigrateFinishState();
      default:
        throw new BizException("è¿ç§»ç¶æéæ³");
    }
  }
}
</code></pre>
<h2 id="è¿ç§»ç¶æ">è¿ç§»ç¶æ</h2>
<p>æå¨åæ¬æ¬¡çç³»ç»è®¾è®¡æ¶ï¼å¯¹ç¶ææ¨¡å¼åäºä¸äºåé¡¾ååèãè¿ç§»ç¶ææ¯ç¶ææ¨¡å¼çæ ¸å¿ï¼ä»è®¾è®¡æ¨¡å¼çè§åº¦æ¥çï¼ç¶ææ¨¡å¼âåè®¸å¯¹è±¡å¨å¶åé¨ç¶ææ¹åæ¶å¨æè°æ´èªèº«è¡ä¸ºï¼ä½¿å¾å¯¹è±¡çè¡¨ç°å½¢æå¦åä¿®æ¹äºå¶æå±ç±»ãâ</p>
<p>ä»¥ä¸æ¯åä¸ªç±»çç»§æ¿å³ç³»ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/228024/202602/228024-20260203223122974-1126879955.png" alt="image" loading="lazy"></p>
<p>å¯¹åºçç¶æå¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ç±»å</td>
<td>å«ä¹</td>
<td>è¯´æ</td>
</tr>
<tr>
<td>TableMigrateState</td>
<td>æ¥å£å®ä¹</td>
<td></td>
</tr>
<tr>
<td>AbstractMigrateState</td>
<td>ç¶ææ½è±¡ç±»</td>
<td></td>
</tr>
<tr>
<td>AbstractFinalState</td>
<td>ç»ææ½è±¡ç±»</td>
<td>ç»æå¾å¤æä½é½æ¯ä¸æ¯æçï¼åAbstractMigrateStateåå¼æ´ç®æ´</td>
</tr>
<tr>
<td>MigrateInitState</td>
<td>åå§</td>
<td>è®°å½è¦è¿ç§»çç»è®¡æ°æ®åéç½®</td>
</tr>
<tr>
<td>MigrateProcessingState</td>
<td>è¿ç§»ä¸­</td>
<td>DTSè¿è¡è¿ç§»å¨ä½çç¶æ</td>
</tr>
<tr>
<td>MigrateNeedSwitchState</td>
<td>è¿ç§»å®æå¾åæ¢ååºä½</td>
<td>æ°æ®å·²åæ­¥å¨æ°è¡¨ï¼ä½è¿ä¸å¯ä»¥éè¿ä¸å¡åè½ç´æ¥è®¿é®</td>
</tr>
<tr>
<td>MigrateSwitchedState</td>
<td>ååºä½å·²åæ¢å¾å é¤æ§è¡¨</td>
<td>æ°æ®å·²åæ­¥å¨æ°è¡¨ï¼ä¸è½éè¿ä¸å¡åè½ç´æ¥è®¿é®</td>
</tr>
<tr>
<td>MigrateFinishState</td>
<td>è¿ç§»å®æ</td>
<td>æ°æ®å·²åæ­¥å¨æ°è¡¨ä¸è½è®¿é®ï¼æ§è¡¨å·²å é¤</td>
</tr>
<tr>
<td>MigrateFailedState</td>
<td>è¿ç§»å¤±è´¥</td>
<td>åæ»ï¼æ§è¡¨æ¢å¤è®¿é®ï¼æ°è¡¨å¦ææåå é¤</td>
</tr>
</tbody>
</table>
<h3 id="ç¶ææ¥å£">ç¶ææ¥å£</h3>
<pre><code class="language-Java">public interface TableMigrateState {

  /**
   * åè¿å°ä¸ä¸ç¶æ
   *
   * @param context
   * @return å¤±è´¥çæç¤ºä¿¡æ¯
   */
  String forward(TableMigrateExecuteContext context);

  /**
   * åæ»æä½
   *
   * @param context
   * @return å¤±è´¥çæç¤ºä¿¡æ¯
   */
  String rollback(TableMigrateExecuteContext context);

  /**
   * è·åå½åçç¶æå¯¹åºæä¸¾
   */
  TableMigrateStateEnum getState();

  /**
   * è·åä¸ä¸ä¸ªç¶æ
   */
  TableMigrateState getNextState();

  /**
   * è·ååæ»çç¶æ
   */
  TableMigrateState getRollbackState();
}
</code></pre>
<h3 id="ç¶ææ½è±¡ç±»">ç¶ææ½è±¡ç±»</h3>
<pre><code class="language-TypeScript">public abstract class AbstractMigrateState implements TableMigrateState {

  @Override
  public String forward(TableMigrateExecuteContext context) {
    TableMigrateTask task = context.getTableMigrateTask();

    // 1. åç½®æ ¡éª
    // æ ¹æ®æ ¡éªç»æï¼å¤æ­æ¯çå¨å½åç¶æï¼è¿æ¯ç´æ¥åæ»å°è¿ç§»å¤±è´¥ç¶æ

    // 2. å®éå¨ä½ï¼ç±å®ç°ç±»å®æ
   // ç®åèµ·è§ï¼å¨å®éå¨ä½éçå¼å¸¸é½èªå¨åæ»

    // 3. ç¶æè·³è½¬
    transit(context, getNextState());
    return null;
  }

  @Override
  public String rollback(TableMigrateExecuteContext context) {
    TableMigrateTask task = context.getTableMigrateTask();
    // 1. å½åç¶ææ ¡éª
    checkCurrentState(context);

    // 2. åæ»æä½ï¼å¦æåçå¼å¸¸ï¼ä¿æå¨å½åç¶æ

    // 3. ç¶æè·³è½¬
    transit(context, getRollbackState());
    return null;
  }

  /**
   * åç½®æ ¡éª
   *
   * @param context
   */
  protected PreCheckResult preCheck(TableMigrateExecuteContext context) {
    return checkCurrentState(context);
  }

  protected PreCheckResult checkCurrentState(TableMigrateExecuteContext context) {
      // æ£æ¥å½åç¶ææ¯å¦ç¬¦åé¢æï¼æé æ£æ¥ç»æ
  }

  /**
   * æ¹åå½åæ§è¡ä¸ä¸æç¶æ, ä¸åå¶ä»çä¸å¡æä½
   *
   * @param context
   * @param nextState
   */
  private void transit(TableMigrateExecuteContext context, TableMigrateState nextState) {
    TableMigrateTask task = context.getTableMigrateTask();
    task.setState(nextState.getState().getValue());
    context.updateTableMigrateTask(task);
    context.setCurrentState(nextState);
  }
  
  protected abstract void doForward(TableMigrateExecuteContext context);

  /**
   * åæ»æä½
   *
   * &lt;p&gt;éè¦ä¿è¯å¹ç­ï¼å¦æåä¸ªåæ»æä½å¤±è´¥ï¼å¯ä»¥éå¤æ§è¡
   *
   * @param context
   */
  protected abstract void doRollback(TableMigrateExecuteContext context);

  /**
   * æ§è¡¨æ´å
   *
   * @param context
   * @param forward true-è¿ç§»åºæ¯ï¼æ§è¡¨å åç¼; false-åæ»åºæ¯ï¼æ§è¡¨å é¤åç¼
   */
  protected void renameOldTableNames(
      TableMigrateExecuteContext context, boolean forward, boolean ignoreExited) {
    context.renameOldTableNames(forward, ignoreExited);
  }

  /**
   * å é¤æ°è¡¨
   *
   * &lt;p&gt;æ°è¡¨çå é¤ï¼æå¥½ä¸è¦å±ç¨è¿ä¸ªæ¹æ³
   *
   * @param context
   */
  protected void deleteNewTables(TableMigrateExecuteContext context) {
    context.deleteTables(true);
  }

  /** åç½®æ ¡éªç»æ */
  @Data
  @AllArgsConstructor
  public static class PreCheckResult {
    /** ä¸­æ­ï¼éè¦åæ» */
    public static final int ABORT = -1;

    /** æ ¡éªéè¿ */
    public static final int PASS = 0;

    /** æ ¡éªä¸éè¿ï¼ä¿æåæç¶æ */
    public static final int NOT_PASS = 1;

    private int code;

    private String msg;

    public static PreCheckResult buildPass() {
      return new PreCheckResult(PASS, null);
    }

    public boolean isPass() {
      return this.code == PASS;
    }
  }
}
</code></pre>
<h3 id="ç»ææ½è±¡ç±»">ç»ææ½è±¡ç±»</h3>
<pre><code class="language-TypeScript">public abstract class AbstractFinalState implements TableMigrateState {
  @Override
  public String forward(TableMigrateExecuteContext context) {
    return "å½åç¶æã" + getState().getValue() + " " + getState().getDes() + "ãå·²æ¯ç»æï¼ä¸è½è¿è¡ä¸ä¸æ­¥æä½";
  }

  @Override
  public String rollback(TableMigrateExecuteContext context) {
    return "å½åç¶æã" + getState().getValue() + " " + getState().getDes() + "ãå·²æ¯ç»æï¼ä¸è½è¿è¡æ¤éæä½";
  }

  @Override
  public TableMigrateState getNextState() {
    throw new BizException("å½åç¶æ" + getState().getValue() + "å·²æ¯ç»æï¼æ²¡æåç»­ç¶æå¯è·³è½¬");
  }

  @Override
  public TableMigrateState getRollbackState() {
    throw new BizException("å½åç¶æ" + getState().getValue() + "å·²æ¯ç»æï¼æ²¡æåç»­æ¤éæå¯è·³è½¬");
  }
}
</code></pre>
<h3 id="åå§">åå§</h3>
<pre><code class="language-TypeScript">public class MigrateInitState extends AbstractMigrateState {
  @Override
  protected void doForward(TableMigrateExecuteContext context) {
    TableMigrateTask task = context.getTableMigrateTask();
    if (task.getOldSchemaId().equals(task.getNewSchemaId())) {
      throw new BizException("è¿ç§»ååçååºä½idç¸å");
    }

    // 1. æ§è¡¨æ´å, ç´æ¥é»æ­¢åç»­çåæ´
    // å½æ¡£ä¸å½±åRENAME
    renameOldTableNames(context, true, false);

    // 2. åå»ºDTSä»»å¡å¹¶ååå°taskå­æ®µ
    // åå»ºå¤±è´¥åç´æ¥æå¼å¸¸ï¼åæ»
    // æ­¤å¤DTSä»»å¡æ¯ç´æ¥æäº¤æ§è¡çï¼å¹¶ä¸è½ç¡®å®å½åå®éæ¯åªä¸ªç¶æï¼å æ­¤ç¶æçç©º
    context.createInstanceAndConfigureDtsJob();
  }
  
  @Override
  protected void doRollback(TableMigrateExecuteContext context) {
    // åå§æåæ»æ¶ï¼æ§è¡¨å¯è½è¿æ²¡ææ´å
    renameOldTableNames(context, false, true);
  }

  @Override
  public TableMigrateStateEnum getState() {
    return TableMigrateStateEnum.INIT;
  }

  @Override
  public TableMigrateState getNextState() {
    return new MigrateProcessingState();
  }

  @Override
  public TableMigrateState getRollbackState() {
    return new MigrateFailedState();
  }
}
</code></pre>
<h3 id="è¿ç§»ä¸­">è¿ç§»ä¸­</h3>
<pre><code class="language-TypeScript">public class MigrateProcessingState extends AbstractMigrateState {

  /** DTS-æªåå§åçç¶æ */
  private static final Set&lt;String&gt; DTS_NOT_INIT =
      Sets.newHashSet(
          DtsJobStatusEnum.NOT_STARTED.getCode(), DtsJobStatusEnum.NOT_CONFIGURED.getCode());

  /** DTS-å¤çä¸­çç¶æ */
  private static final Set&lt;String&gt; DTS_PROCESSING =
      Sets.newHashSet(
          DtsJobStatusEnum.PRECHECKING.getCode(),
          DtsJobStatusEnum.PRECHECK_PASS.getCode(),
          DtsJobStatusEnum.INITIALIZING.getCode(),
          DtsJobStatusEnum.SYNCHRONIZING.getCode(),
          DtsJobStatusEnum.MIGRATING.getCode(),
          DtsJobStatusEnum.SUSPENDING.getCode(),
          DtsJobStatusEnum.MODIFYING.getCode(),
          DtsJobStatusEnum.RETRYING.getCode(),
          DtsJobStatusEnum.UPGRADING.getCode(),
          DtsJobStatusEnum.DOWNGRADING.getCode(),
          DtsJobStatusEnum.LOCKED.getCode());

  /** DTS-å¤±è´¥çç¶æ */
  private static final Set&lt;String&gt; DTS_FAILED =
      Sets.newHashSet(
          DtsJobStatusEnum.PRECHECK_FAILED.getCode(),
          DtsJobStatusEnum.INITIALIZE_FAILED.getCode(),
          DtsJobStatusEnum.FAILED.getCode(),
          DtsJobStatusEnum.MIGRATION_FAILED.getCode());

  @Override
  public PreCheckResult preCheck(TableMigrateExecuteContext context) {
    checkCurrentState(context);
    // æ ¡éªDTSä»»å¡å·²å®æ
    TableMigrateTask task = context.getTableMigrateTask();
    DescribeDtsJobDetailResponse dtsJobDetailResponse = context.queryDtsMigJob();
    if (dtsJobDetailResponse == null || dtsJobDetailResponse.getBody() == null) {
      return new PreCheckResult(
          PreCheckResult.NOT_PASS,
          String.format(
              "DTSä»»å¡ç»ææ¥è¯¢å¤±è´¥, è¿åç»æä¸ºç©ºãinstanceId=%s, jobId=%s",
              task.getDtsInstanceId(), task.getDtsJobId()));
    }
    DescribeDtsJobDetailResponseBody responseBody = dtsJobDetailResponse.getBody();
    if (BooleanUtils.isNotTrue(responseBody.getSuccess())) {
      return new PreCheckResult(
          PreCheckResult.NOT_PASS,
          String.format(
              "DTSä»»å¡ç»ææ¥è¯¢å¤±è´¥, æ¥å£è°ç¨ç»æä¸ºå¤±è´¥ãinstanceId=%s, jobId=%s",
              task.getDtsInstanceId(), task.getDtsJobId()));
    }
    DtsJobStatusEnum dtsJobStatusEnum = DtsJobStatusEnum.getByCode(responseBody.getStatus());
    if (dtsJobStatusEnum == null) {
      return new PreCheckResult(
          PreCheckResult.NOT_PASS,
          String.format(
              "DTSä»»å¡ç¶æéæ³ï¼è¯·ç¨åéè¯ãinstanceId=%s, jobId=%s, é¿éäºç¶æ=%s",
              task.getDtsInstanceId(), task.getDtsJobId(), responseBody.getStatus()));
    }
    task.setDtsStatus(dtsJobStatusEnum.getCode());
    if (DTS_NOT_INIT.contains(dtsJobStatusEnum.getCode())) {
      return new PreCheckResult(
          PreCheckResult.NOT_PASS,
          String.format(
              "DTSä»»å¡ç¶æå¼å¸¸ï¼å°æªåå§åãinstanceId=%s, jobId=%s, é¿éäºç¶æ=%s",
              task.getDtsInstanceId(), task.getDtsJobId(), responseBody.getStatus()));
    }
    if (DTS_PROCESSING.contains(dtsJobStatusEnum.getCode())) {
      return new PreCheckResult(
          PreCheckResult.NOT_PASS,
          String.format(
              "DTSä»»å¡ä»å¨å¤çä¸­ãinstanceId=%s, jobId=%s, é¿éäºç¶æ=%s",
              task.getDtsInstanceId(), task.getDtsJobId(), responseBody.getStatus()));
    }
    if (DTS_FAILED.contains(dtsJobStatusEnum.getCode())) {
      return new PreCheckResult(
          PreCheckResult.ABORT,
          String.format(
              "DTSä»»å¡æ§è¡å¤±è´¥ãinstanceId=%s, jobId=%s, é¿éäºç¶æ=%s",
              task.getDtsInstanceId(), task.getDtsJobId(), responseBody.getStatus()));
    }
    if (StringUtils.equals(DtsJobStatusEnum.FINISHED.getCode(), dtsJobStatusEnum.getCode())) {
      return PreCheckResult.buildPass();
    }
    return new PreCheckResult(
        PreCheckResult.NOT_PASS,
        String.format(
            "DTSä»»å¡ç¶æéæ³ãinstanceId=%s, jobId=%s, é¿éäºç¶æ=%s",
            task.getDtsInstanceId(), task.getDtsJobId(), responseBody.getStatus()));
  }

  @Override
  protected void doForward(TableMigrateExecuteContext context) {
    // å·²å¨æ ¡éªæ¶æ´æ°ä»»å¡ç¶æï¼å¹¶æ ¹æ®DTSæ§è¡ç¶æå¤æ­è¦ä¸è¦åæ»

    // 1. å°è¿ç§»åçè¡¨ï¼æç§åè¡¨çç¶æè¿è¡å½æ¡£

    // 2. åå¥è¿ç§»åçè¡¨ç»è®¡ä¿¡æ¯
    context.updateDestTableInfo();
  }

  @Override
  protected void doRollback(TableMigrateExecuteContext context) {
    // 1. å°è¯ä¸­æ­¢DTSä»»å¡ï¼å¯¹å·²å®æçDTSä»»å¡è°ç¨ä¸ä¼æå¼å¸¸

    // 2. æ°è¡¨å é¤
    deleteNewTables(context);

    // 3. æ§è¡¨åç§°è¿å
    renameOldTableNames(context, false, false);
  }

  @Override
  public TableMigrateStateEnum getState() {
    return TableMigrateStateEnum.PROCESSING;
  }

  @Override
  public TableMigrateState getNextState() {
    return new MigrateNeedSwitchState();
  }

  @Override
  public TableMigrateState getRollbackState() {
    return new MigrateFailedState();
  }
}
</code></pre>
<h3 id="è¿ç§»å®æå¾åæ¢ååºä½">è¿ç§»å®æå¾åæ¢ååºä½</h3>
<pre><code class="language-TypeScript">public class MigrateNeedSwitchState extends AbstractMigrateState {

  @Override
  protected void doForward(TableMigrateExecuteContext context) {
    // åè¡¨è·¯ç±åæ¢
    context.switchRoute(
        context.getTableMigrateTask().getOldSchemaId(),
        context.getTableMigrateTask().getNewSchemaId());
  }

  @Override
  protected void doRollback(TableMigrateExecuteContext context) {
    // 1. æ°è¡¨å é¤
    deleteNewTables(context);

    // 2. æ§è¡¨åç§°è¿å
    renameOldTableNames(context, false, false);

    // 3. åè¡¨åè·¯ç±æ¢å¤
    // å¯è½å·²ç»å¨forwardæ¶åè¿ï¼å æ­¤ä¹åå¤å
    context.switchRoute(
        context.getTableMigrateTask().getNewSchemaId(),
        context.getTableMigrateTask().getOldSchemaId());
  }

  @Override
  public TableMigrateStateEnum getState() {
    return TableMigrateStateEnum.NEED_SWITCH;
  }

  @Override
  public TableMigrateState getNextState() {
    return new MigrateSwitchedState();
  }

  @Override
  public TableMigrateState getRollbackState() {
    return new MigrateFailedState();
  }
}
</code></pre>
<h3 id="ååºä½å·²åæ¢å¾å é¤æ§è¡¨">ååºä½å·²åæ¢å¾å é¤æ§è¡¨</h3>
<pre><code class="language-TypeScript">public class MigrateSwitchedState extends AbstractMigrateState {

  @Override
  protected void doForward(TableMigrateExecuteContext context) {
    // å é¤æ§è¡¨
    context.deleteTables(false);
  }

  @Override
  protected void doRollback(TableMigrateExecuteContext context) {
    // 1. æ°è¡¨å é¤
    deleteNewTables(context);

    // 2. æ§è¡¨åç§°è¿å
    renameOldTableNames(context, false, false);

    // 3. åè¡¨åè·¯ç±æ¢å¤
    context.switchRoute(
        context.getTableMigrateTask().getNewSchemaId(),
        context.getTableMigrateTask().getOldSchemaId());
  }

  @Override
  public TableMigrateStateEnum getState() {
    return TableMigrateStateEnum.SWITCHED;
  }

  @Override
  public TableMigrateState getNextState() {
    return new MigrateFinishState();
  }

  @Override
  public TableMigrateState getRollbackState() {
    return new MigrateFailedState();
  }
}
</code></pre>
<h3 id="è¿ç§»å®æ">è¿ç§»å®æ</h3>
<pre><code class="language-Java">public class MigrateFinishState extends AbstractFinalState {
  @Override
  public TableMigrateStateEnum getState() {
    return TableMigrateStateEnum.FINISH;
  }
}
</code></pre>
<h3 id="è¿ç§»å¤±è´¥">è¿ç§»å¤±è´¥</h3>
<pre><code class="language-Java">public class MigrateFailedState extends AbstractFinalState {
  @Override
  public TableMigrateStateEnum getState() {
    return TableMigrateStateEnum.FAILED;
  }
}
</code></pre>
<h2 id="æä½æµç¨">æä½æµç¨</h2>
<ol>
<li>
<p>åå»ºè¿ç§»ä»»å¡TableMigrateTask</p>
</li>
<li>
<p>éè¿å·¥åç±»ï¼ä½¿ç¨ä»»å¡idåå»ºåå«è¿ç§»ä»»å¡TableMigrateTaskçè¿ç§»ä¸ä¸æTableMigrateExecuteContext</p>
</li>
<li>
<p>è°ç¨TableMigrateExecuteContextçforward()æ¨è¿ç¶æãrollback()åæ»ç¶æ</p>
</li>
</ol>
<h2 id="æ¥è¯¢ç¸å³åè½å®ç°">æ¥è¯¢ç¸å³åè½å®ç°</h2>
<h3 id="dtsä»»å¡åè¡¨æ¥è¯¢">DTSä»»å¡åè¡¨æ¥è¯¢</h3>
<p>å ä¸ºå·²ç»æDTSçç¸å³å­æ®µæä¹åäºï¼å¯ä»¥éè¿ä¸å¡ç³»ç»ç¸å³çè¿ç§»ä»»å¡è¡¨å®ç°åé¡µæ¥è¯¢ã</p>
<p>ä¸è¿å¨âè¿ç§»ä¸­âè·³è½¬å°âè¿ç§»å®æå¾åæ¢ååºä½âçè¿ç¨ä¸­ï¼DTSä¹ä¼ç»åå¤ä¸ªç¶æï¼å¸åçæPrecheckingãMigratingãFinishedç­ï¼è§<a href="https://next.api.aliyun.com/document/Dts/2020-01-01/DescribeDtsJobDetail" target="_blank" rel="noopener nofollow">DescribeDtsJobDetail_æ°æ®ä¼ è¾_APIææ¡£</a>çStatuså­æ®µè¯´æï¼ï¼å¯ä»¥éè¿æ¥å£è·åææ°çç¶æå¹¶åå¥è¿ç§»ä»»å¡è¡¨ã</p>
<h3 id="å¦ä½æ¥è¯¢å¾è¿ç§»çè¡¨">å¦ä½æ¥è¯¢å¾è¿ç§»çè¡¨ï¼</h3>
<p>åé¡¾ä¸ä¸ï¼è¦è¿ç§»çè¡¨åä»¥ä¸ä¸ç§å½¢å¼ï¼</p>
<ul>
<li>
<p>åç¼æ¯å¬å¸idï¼å¦table_companyId</p>
</li>
<li>
<p>åç¼æ¯ å¬å¸_å¹´ä»½ï¼å¦table_company_year</p>
</li>
<li>
<p>åç¼æ¯ä¸å¡idï¼å¦table_bizId</p>
</li>
</ul>
<p>å¯¹äºåä¸ä¸ªåç¼ï¼ä»¥companyId=123ä¸ºä¾ï¼ç¬¬ä¸ãä¸ç§è¡¨é½å¯ä»¥ç²¾ç¡®å¹éï¼</p>
<ul>
<li>
<p>ç¬¬ä¸ç§è¡¨æ¯ä¸ªå¬å¸åªæä¸å¼ ï¼æ¯å¦table_a_123ãtable_b_123ï¼</p>
</li>
<li>
<p>ç¬¬ä¸ç§è¡¨æ¯ä¸ªbizIdåä¸ä¸ªå¬å¸åªæä¸å¼ ï¼æ¯å¦bizIdå¯ä»¥å1ã2ï¼é£ä¹ä¼å­å¨table_c_1ãtable_c_2ãtable_d_1ãtable_d_2ï¼å¹¶ä¸ï¼bizIdæ¯æéçï¼å¯ä»¥ä»ä¸å¼ bizId_tableè¡¨è·åææå¯éå¼ã</p>
</li>
<li>
<p>å¯¹äºç¬¬äºç§è¡¨yearçåå¼èå´ï¼è½ç¶å¯ä»¥ç±»ä¼¼bizIdä¸æ ·å»æ¾ï¼ä½æ¯å¹¶æ²¡æç´æ¥çå³ç³»è¡¨ã</p>
</li>
</ul>
<p>ææ³å°äºä¸¤ç§æ¹æ¡ï¼æåéæ©äºç¬¬äºç§ã</p>
<h4 id="show-tables-likeæ¥è¯¢æå®åç¼">SHOW TABLES LIKEæ¥è¯¢æå®åç¼</h4>
<p>è¿æ¯æåèèå°çæ¹æ¡ï¼æ¯è¾ç´æ¥ï¼èä¸å¨å¼åãæµè¯ç¯å¢ä¸­è¿è¡è¯å¥½ãä½æ¯å¨çº¿ä¸å°±ä¸è¡äºï¼å°ææè¡¨æ¥è¯¢ä¸æ¬¡è¦æ°åéï¼è°ç¨æ©å·²è¶æ¶ãææ³è¿åºè¯¥åçº¿ä¸ç¯å¢è¡¨æ°éè¿å¤å¯¼è´åæ°æ®è·ååæ¢æå³ï¼æ¯æ¬¡æ¥è¯¢éè¦ä¸ç¾msï¼ç´¯è®¡èæ¶é¿è¾¾æ°åéã</p>
<h4 id="databasemetadataä¸æ¬¡æ§è·åææè¡¨åè¿æ»¤">DatabaseMetaDataä¸æ¬¡æ§è·åææè¡¨åè¿æ»¤</h4>
<p>å¯ä»¥éè¿DataSourceçåæ°æ®ï¼ä¸æ¬¡æ§è·åæ°æ®æºå¯¹åºåºçææçè¡¨ï¼åå°è¡¨åè¿è¡è¿æ»¤ãç»è¿æµè¯ï¼10Wçº§æ°æ®è·åå¨é¨è¡¨çæ¶é´å¨3~7Sä¹é´ï¼åæ¹æ¡ä¸ç¸æ¯å¿«å¾å¤ã</p>
<p>ä»¥ä¸ä»£ç çæ®µå±ç¤ºäºå¦ä½è·åææè¡¨åï¼å¿½ç¥å¼å¸¸å¤çã</p>
<pre><code class="language-Java">String physicalSchemaName = dataSourceHolder.getPhysicalSchemaName(logicalSchemaName);
HikariDataSource dataSource = dataSourceHolder.getDataSourceByPhysicalSchemaName(physicalSchemaName);
try (Connection connection = dataSource.getConnection()) {
    DatabaseMetaData metaData = connection.getMetaData();
    ResultSet catalogs = metaData.getCatalogs();
    while (catalogs.next()) {
        String tableCat = catalogs.getString("TABLE_CAT");
        if (!StringUtils.equals(tableCat, physicalSchemaName)) {
            // å¤æ­åºåæ¯å¦ä¸è´ãå¦æå¤ä¸ªåºå®éä¸å¨åä¸ä¸ªRDSå®ä¾ï¼åæ°æ®å®éä¸æ¯è¿äºåºçï¼èéåä¸ªåºç
            continue;
        }

        // è·åæå®æ°æ®åºä¸­çææè¡¨å
        ResultSet tableResultSet =
            metaData.getTables(physicalSchemaName, null, "%", new String[] {"TABLE"});
        int count = 0;
        while (tableResultSet.next()) {
          count++;
          String physicalTableName = tableResultSet.getString("TABLE_NAME");
          // ç¡®å®æ¯å¦æ¯è¦æ¥çè¡¨ï¼å¤æ­é»è¾æ­¤å¤çç¥ãæ³¨1ã
         }
        LoggerUtils.info("æ¬æ¬¡å±æ¥è¯¢äº" + count + "ä¸ªè¡¨çåæ°æ®");
      }
      LoggerUtils.info(
          "è·å" + physicalSchemaName + "åºçææè¡¨åæ°æ®æ»èæ¶ï¼" + (System.currentTimeMillis() - t1) + "ms");
    } catch (SQLException e) {
      LoggerUtils.error("è·åååºåæ°æ®å¤±è´¥, åçSQLå¼å¸¸", e);
      throw new BizException("è·åååºåæ°æ®å¤±è´¥, åçSQLå¼å¸¸", e);
    }
}
</code></pre>
<p>å¯¹æ°æ®åºä¸­æ¯ä¸ªè¡¨å¤å®å®æ¯å¦æ¯å½åå¬å¸çè¡¨ï¼å¯¹äºç¬¬ä¸ãä¸ç§è¡¨ï¼å¯ä»¥å°åèæ¾å°ä¸ä¸ªHashSetä¸­ï¼æ¯æ¬¡å¾ªç¯æ¶å¯¹æ¯ï¼å¯¹äºç¬¬äºç§è¡¨ï¼å­ç¬¦ä¸²åç¼å¹éæ çè¦è±å¤§éçæ¶é´ã</p>
<p>ä¸ºäºå éåç¼å¹éï¼å¯ä»¥ä½¿ç¨ç»å¸çæ°æ®ç»æââåç¼å¹éæ ãåç¼å¹éæ çä»£ç å¦ä¸ï¼</p>
<pre><code class="language-Java">public class StringPrefixTrie {
  private final Node root = new Node();

  static class Node {
    boolean isEnd;
    Map&lt;Character, Node&gt; children = new HashMap&lt;&gt;();
  }

  /**
   * å¢å ä¸ä¸ªå¾å¹éçæ¨¡å¼
   *
   * @param pattern
   */
  public void addPattern(String pattern) {
    Node current = root;
    for (char c : pattern.toCharArray()) {
      current = current.children.computeIfAbsent(c, k -&gt; new Node());
    }
    current.isEnd = true;
  }

  /**
   * æ¯å¦æ»¡è¶³åç¼å¹é
   *
   * @param str
   * @return
   */
  public String match(String str) {
    Node current = root;
    for (int i = 0; i &lt; str.length(); i++) {
      current = current.children.get(str.charAt(i));
      if (current == null) {
        // æ²¡æå¹éå°ä»»ä½åç¼
        return null;
      }
      if (current.isEnd) {
        // è¿åå¹éå°çä»»æä¸ä¸ªåç¼
        return str.substring(0, i + 1);
      }
    }
    return null;
  }
}
</code></pre>
<p>å¯¹ææéè¦åç¼å¹éçè¡¨çåç¼è°ç¨addPattern()ï¼å¨å¾ªç¯ä¸­åå¤æ­æ¯å¦æ»¡è¶³åç¼å¹éï¼åå¤æ­ç²¾åå¹éå³å¯ã</p>
<h2 id="åç»­è§å">åç»­è§å</h2>
<ol>
<li>
<p>æ¹éè¿ç§»åè½ï¼å°è¿ç§»æ¹éåãèªå¨åï¼</p>
<ol>
<li>
<p>æ¹éæåå¬å¸ï¼å¤æ­æ¯å¦éè¦è¿ç§»ãè¿ç§»ææ¬ãçæ³æåµä¸ï¼æ°æ®éå°ä½è¡¨å¤çå¬å¸ï¼æ¯è¿ç§»å°å¶ä»åºçæä½³åéï¼å¤§å¤§éä½æºåºçè¡¨éåèçº¦äºå¤å¶æ°æ®çæ¶é´</p>
</li>
<li>
<p>å¤ä¸ªå¬å¸idæäº¤ãåå»ºä»»å¡ãç¶ææµè½¬</p>
</li>
</ol>
</li>
<li>
<p>èªå¨æ ¡éªè¿ç§»æ¯å¦æå</p>
</li>
</ol>


</div>
<div id="MySignature" role="contentinfo">
    <div id="AllanboltSignature">
        <p id="PSignature" style="border-top: #e0e0e0 1px dashed; border-right: #e0e0e0 1px dashed; border-bottom: #e0e0e0 1px dashed; border-left: #e0e0e0 1px dashed;
            padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 60px;
            font-family: å¾®è½¯éé»; font-size:11px;">
            <br>
            ä½èï¼<a href="http://www.cnblogs.com/wuyuegb2312" target="_blank">äºå²³</a>
            <br>
            åºå¤ï¼<a href="http://www.cnblogs.com/wuyuegb2312" target="_blank">http://www.cnblogs.com/wuyuegb2312</a>
            <br>
            å¯¹äºæ é¢æªæ æ³¨ä¸ºâè½¬è½½âçæç« åä¸ºååï¼å¶çæå½ä½èææï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»ä¿çæ­¤æ®µå£°æï¼ä¸å¨æç« é¡µé¢ææ¾ä½ç½®ç»åºåæè¿æ¥ï¼å¦åä¿çè¿½ç©¶æ³å¾è´£ä»»çæå©ã
        </p>
    ã</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0020833333333333333" data-date-updated="2026-02-03 22:37">2026-02-03 22:34</span>&nbsp;
<a href="https://www.cnblogs.com/wuyuegb2312">äºå²³</a>&nbsp;
éè¯»(<span id="post_view_count">1</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19571685);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19571685', targetLink: 'https://www.cnblogs.com/wuyuegb2312/p/19571685', title: 'DTSæä¸å¡åºæ¯æ¹éè¿ç§»é¿éäºMySQLè¡¨å®æï¼ä¸ï¼ï¼è¿ç§»ç®¡çå¹³å°è®¾è®¡ä¸å®ç°' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>