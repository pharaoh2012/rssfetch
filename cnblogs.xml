<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-29T01:28:34.872Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ Electronåºç¨éååææè·¯ ]]></title>
    <link>https://www.cnblogs.com/xlcm/p/19539008</link>
    <guid>35637e4c60c4722ad9d15bfa6efc43b7</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xlcm/p/19539008" title="åå¸äº 2026-01-29 09:24">
    <span role="heading" aria-level="2">Electronåºç¨éååææè·¯</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="ä¸éåç®æ ä¸æ ¸å¿æè·¯">ä¸ãéåç®æ ä¸æ ¸å¿æè·¯</h2>
<h3 id="1-ç®æ ">1. ç®æ </h3>
<p>ä¸æ¯ä¸ºäºâç ´è§£è½¯ä»¶âï¼èæ¯å­¦ä¹  <strong>Electron åºç¨çéåéç¨æè·¯</strong>ï¼</p>
<ul>
<li>ç»è¿åè°è¯æºå¶</li>
<li>çªç ´æä»¶å®æ´æ§æ ¡éª</li>
<li>å«ææ ¸å¿ API åæé»è¾</li>
<li>å®ç°ç¦»çº¿æ¿æ´»æµç¨å«æ</li>
</ul>
<h3 id="2-æ ¸å¿æ¦å¿µ">2. æ ¸å¿æ¦å¿µ</h3>
<p>Electron åºç¨åºäº Node.js + æµè§å¨åæ ¸ï¼æææ ¸å¿è¡ä¸ºé½ä¾èµ JavaScript/Node.js APIãæä»¬ä¸éè¦æäºè¿å¶/C++ï¼åªé<strong>æ¦æªï¼Hookï¼è¿äº API</strong>ï¼å°±è½ä¿®æ¹ç¨åºè¡ä¸ºï¼æ¯å¦è®©ç¨åºè¯»âåæä»¶âãè¿åâåç»æâï¼ã<br>
Electronåºäº<strong>ä¸»è¿ç¨ï¼Main Processï¼</strong> å<strong>æ¸²æè¿ç¨ï¼Renderer Processï¼</strong> çåè¿ç¨æ¨¡åã</p>
<ul>
<li><strong>ä¸»è¿ç¨</strong>ï¼æ´ä¸ªåºç¨çå¥å£ï¼è´è´£çªå£ç®¡çãç³»ç»äº¤äºãçå½å¨ææ§å¶ï¼è¿è¡å¨Node.jsç¯å¢ä¸­ï¼æå®æ´çNode APIæéï¼ã</li>
<li><strong>æ¸²æè¿ç¨</strong>ï¼æ¯ä¸ªçªå£å¯¹åºä¸ä¸ªæ¸²æè¿ç¨ï¼è´è´£é¡µé¢æ¸²æãç¨æ·äº¤äºï¼è¿è¡å¨Chromiumç¯å¢ä¸­ï¼é»è®¤æ Nodeæéï¼ééè¿<code>webPreferences</code>éç½®ï¼ã</li>
</ul>
<h4 id="ä¸ç¼è¯åelectronåºç¨çæ ¸å¿ç»æ">ä¸ãç¼è¯åElectronåºç¨çæ ¸å¿ç»æ</h4>
<p>ç¼è¯åçåºç¨ä¼å°æºç ãä¾èµãElectronè¿è¡æ¶æåæç¬ç«æä»¶ï¼å¸åç»æå¦ä¸ï¼ä»¥Windowsä¸ºä¾ï¼ï¼</p>
<pre><code>xxx-win32-x64/
âââ xxx.exe                # åºç¨å¥å£å¯æ§è¡æä»¶
âââ resources/             # èµæºç®å½
â   âââ app.asar           # æååçæºç ï¼main.jsãpreload.jsãé¡µé¢ç­ï¼
â   âââ app.asar.unpacked/ # æªæåçäºè¿å¶ä¾èµï¼å¯éï¼
âââ electron*.dll          # Electronè¿è¡æ¶ä¾èµ
</code></pre>
<p>æ ¸å¿ï¼æºç è¢«æåè¿<code>app.asar</code>ï¼ä¸ç§Electronä¸å±çå½æ¡£æ ¼å¼ï¼ï¼ä½<strong>æ§è¡é¡ºåºé»è¾åå¼åç¯å¢ä¸è´</strong>ï¼ä»èµæºå è½½è·¯å¾åçååã</p>
<h4 id="äºç¼è¯åä»£ç çå®æ´æ§è¡é¡ºåº">äºãç¼è¯åä»£ç çå®æ´æ§è¡é¡ºåº</h4>
<p>ä»¥ä¸æ¯ç¼è¯åå¯æ§è¡æä»¶è¿è¡æ¶çä»£ç æ§è¡æµç¨ï¼å¯¹æ¯å¼åç¯å¢æ æ³¨å·®å¼ç¹ï¼</p>
<h5 id="1-å¯å¨é¶æ®µelectronè¿è¡æ¶åå§å">1. å¯å¨é¶æ®µï¼Electronè¿è¡æ¶åå§å</h5>
<pre><code>1. åå»xxx.exe â ç³»ç»å¯å¨Electronè¿è¡æ¶ï¼åç½®Node.js + Chromiumï¼
2. è¿è¡æ¶è¯»åresourcesç®å½ â å®ä½app.asaråï¼æåå¹¶æ§è¡**ç¼è¯åçä¸»è¿ç¨å¥å£æä»¶**ï¼å¦main.jsï¼
   â¨ å·®å¼ç¹ï¼å¼åç¯å¢ç´æ¥è¯»åæ¬å°main.jsï¼ç¼è¯åè¯»åasaråçmain.js
</code></pre>
<h2 id="äºåç½®åå¤å¿è£å·¥å·">äºãåç½®åå¤ï¼å¿è£å·¥å·ï¼</h2>
<table>
<thead>
<tr>
<th>å·¥å·/ç¯å¢</th>
<th>ä½ç¨</th>
<th>å®è£æ¹æ³</th>
</tr>
</thead>
<tbody>
<tr>
<td>Node.js + npm</td>
<td>æä¾ JavaScript è¿è¡ç¯å¢ï¼å®è£ <code>asar</code> å·¥å·</td>
<td>å®ç½ <a href="https://nodejs.org/" target="_blank" rel="noopener nofollow">https://nodejs.org/</a> ä¸è½½ LTS çï¼é»è®¤å®è£ï¼å¾éâAdd to PATHâï¼</td>
</tr>
<tr>
<td>Typora v1.12.4</td>
<td>ç®æ åæè½¯ä»¶</td>
<td>å®ç½ä¸è½½ææ°çï¼é»è®¤å®è£å° <code>C:\Program Files\Typora</code>ï¼å¿é¡»é»è®¤è·¯å¾ï¼å¦åéæ¹ä»£ç ï¼</td>
</tr>
<tr>
<td>ææ¬ç¼è¾å¨</td>
<td>åä»£ç ãæ¹éç½®ï¼å¦ VS Codeãè®°äºæ¬++ï¼</td>
<td>ä»»æç¼è¾å¨åå¯ï¼æ¨è VS Codeï¼å®ç½ <a href="https://code.visualstudio.com/%EF%BC%89" target="_blank" rel="noopener nofollow">https://code.visualstudio.com/ï¼</a></td>
</tr>
</tbody>
</table>
<h3 id="éªè¯å®è£">éªè¯å®è£</h3>
<p>æå¼ãå½ä»¤æç¤ºç¬¦ï¼CMDï¼ãï¼è¾å¥ä»¥ä¸å½ä»¤ï¼è½æ¾ç¤ºçæ¬å·å°±æ¯å®è£æåï¼</p>
<pre><code class="language-cmd">node -v  # æ¾ç¤º v18+ å³å¯
npm -v   # æ¾ç¤º 8+ å³å¯
</code></pre>
<h2 id="ä¸è¯¦ç»éåæ­¥éª¤æé¡ºåºæ¥ä¸æ­¥é½ä¸è½æ¼">ä¸ãè¯¦ç»éåæ­¥éª¤ï¼æé¡ºåºæ¥ï¼ä¸æ­¥é½ä¸è½æ¼ï¼</h2>
<h3 id="æ­¥éª¤1å®è£-typora-å¹¶åæ­¥æµè¯åè°è¯">æ­¥éª¤1ï¼å®è£ Typora å¹¶åæ­¥æµè¯åè°è¯</h3>
<ol>
<li><strong>å®è£ Typora</strong>ï¼é»è®¤è·¯å¾ <code>C:\Program Files\Typora</code>ï¼å®è£ååæ­£å¸¸å¯å¨ä¸æ¬¡ï¼ç¡®è®¤è½æå¼ï¼ç¶åå³é­ï¼ã</li>
<li><strong>æµè¯åè°è¯</strong>ï¼
<ul>
<li>æå¼ CMDï¼è¾å¥å½ä»¤ï¼å¯å¨ Typora å¹¶å°è¯è°è¯ï¼ï¼<pre><code class="language-cmd">cd C:\Program Files\Typora
Typora.exe --inspect
</code></pre>
</li>
<li>ç°è±¡ï¼ç¨åºå¯å¨å¤±è´¥ï¼å¼¹åºéè¯¯æç¤ºã</li>
<li>åå ï¼Typora æ<strong>åè°è¯æºå¶</strong>ï¼æ£æµå° <code>--debug</code>/<code>--inspect</code> åæ°å°±æç»å¯å¨ã<br>
3.Typoraæ¯åºäºElectronå¼åçåºç¨ï¼èElectronæ¬èº«åç½®äºChromiumçè°è¯åè®®ï¼æ¯æéè¿ <code>--debug</code>ï¼æ§çåæ°ï¼æ <code>--inspect</code>ï¼æ°çåæ°ï¼å¼å¯è°è¯ç«¯å£ã</li>
</ul>
</li>
</ol>
<ul>
<li>å¯å¨åï¼ä½ å¯ä»¥ç¨Chrome DevToolsç­å·¥å·ç´æ¥è¿æ¥è°è¯ç«¯å£ï¼å¨ææ¥çä¸»è¿ç¨åæ¸²æè¿ç¨çJSä»£ç ãè°ç¨æ ä¸åå­æ°æ®ã</li>
<li>è¿æ¯æç´æ¥ãæ ä¾µå¥çè°è¯æ¹å¼ï¼ä¸éè¦æåè§£åasaråæä¿®æ¹ä»£ç ã<br>
å¨Electronåºç¨çéåæµç¨ä¸­ï¼è¿æ¯æä¼åçå°è¯æ¹åï¼</li>
<li>å¦æè°è¯æåï¼å°±è½ç´æ¥å®ä½æ¿æ´»é»è¾ãéªè¯æºå¶ç­æ ¸å¿ä»£ç ï¼æçè¿é«äºåç»­çéæåæã</li>
<li>å³ä½¿å¤±è´¥ï¼ä¹è½å¿«éç¡®è®¤åºç¨æ¯å¦å­å¨<strong>åè°è¯æºå¶</strong>ï¼ä»èè°æ´åç»­çéåç­ç¥ï¼æ¯å¦éè¦åç»è¿åè°è¯ï¼åè¿è¡éæåæasaråï¼ã</li>
</ul>
<h3 id="æ­¥éª¤2å®ä½å¥å£æä»¶">æ­¥éª¤2ï¼å®ä½å¥å£æä»¶</h3>
<ol>
<li><strong>ä¼åæ£æ¥ resources ç®å½ä¸ç package.json</strong><br>
æäºåºç¨ä¼æ <code>package.json</code> ç´æ¥æ¾å¨ <code>resources</code> ç®å½ä¸ï¼èéæåè¿ asarï¼ï¼å¯ä»¥ç´æ¥æ¥çå¶ä¸­ç <code>main</code> å­æ®µã<br>
æ¯å¦ Typora å¨ <code>resources</code> ç®å½ä¸ç <code>package.json</code> ä¸­ï¼<code>"main": "launch.dist.js"</code>ï¼ä½è¿ä¸ªæä»¶å®éå¨ <code>app.asar</code> åã</li>
<li><strong>æ¿æ¢å è½½ä¼åçº§</strong><br>
æç§ Electron çè§åï¼<code>resources/app</code> ç®å½çä¼åçº§é«äº <code>app.asar</code>ã<br>
ä½ å¯ä»¥è§£å <code>app.asar</code> å¹¶éå½åä¸º <code>app</code> ç®å½ï¼è¿æ · Electron å¯å¨æ¶ä¼ä¼åå è½½ <code>app</code> ç®å½ä¸­çæºç ï¼ä½ å°±è½ç´æ¥ä¿®æ¹å¥å£æä»¶ï¼æ¯å¦ç»è¿åè°è¯ï¼ã</li>
</ol>
<h3 id="æ­¥éª¤3è§£å-electron-å½æ¡£æä»¶appasar">æ­¥éª¤3ï¼è§£å Electron å½æ¡£æä»¶ï¼app.asarï¼</h3>
<p>Electron ä¼ææ ¸å¿ä»£ç æåæ <code>app.asar</code>ï¼ç±»ä¼¼åç¼©åï¼ï¼æä»¬éè¦è§£åå®æè½çå°æºç ã</p>
<ol>
<li><strong>å®è£ <code>asar</code> è§£åå·¥å·</strong>ï¼<br>
æå¼ CMDï¼è¾å¥å½ä»¤ï¼å¨å±å®è£è§£åå·¥å·ï¼ï¼<pre><code class="language-cmd">npm i -g asar
</code></pre>
</li>
<li><strong>å¤ä»½å¹¶è§£å <code>app.asar</code></strong>ï¼<br>
ä¾æ¬¡å¨ CMD è¾å¥ä»¥ä¸å½ä»¤ï¼æ¯è¾ä¸è¡æåè½¦ï¼æ³¨æè·¯å¾ä¸è¦éï¼ï¼<pre><code class="language-cmd"># è¿å¥ Typora çèµæºç®å½
cd C:\Program Files\Typora\resources

# è§£å app.asar å° app æä»¶å¤¹ï¼æ ¸å¿ä»£ç å¨å¨éé¢ï¼
asar extract app.asar app

# å¤ä»½åå§ app.asarï¼éè¦ï¼åç»­è¦ç¨å°ï¼
rename app.asar app.asar.bak

# å¤ä»½è§£ååç app æä»¶å¤¹ï¼é²æ­¢ä¿®æ¹åºéï¼
robocopy app app.bak /E
</code></pre>
</li>
<li><strong>éªè¯ç»æ</strong>ï¼<br>
æå¼ <code>C:\Program Files\Typora\resources</code>ï¼ä¼çå°æ°å¢ <code>app</code>ï¼è§£ååçæºç ï¼ã<code>app.bak</code>ï¼å¤ä»½çæºç ï¼ã<code>app.asar.bak</code>ï¼å¤ä»½çåå§å½æ¡£ï¼ä¸ä¸ªæä»¶/æä»¶å¤¹ã</li>
</ol>
<h3 id="æ­¥éª¤4ä¿®æ¹-electron-éç½®fusesåè®¸å è½½è§£ååçæºç ">æ­¥éª¤4ï¼ä¿®æ¹ Electron éç½®ï¼Fusesï¼ï¼åè®¸å è½½è§£ååçæºç </h3>
<ol>
<li><strong>é®é¢ç°è±¡</strong>ï¼<br>
ç´æ¥åå» <code>C:\Program Files\Typora\Typora.exe</code>ï¼åç°ç¨åºæä¸å¼ã<br>
åå ï¼Typora éç½®äº <code>OnlyLoadAppFromAsar: true</code>ï¼åªåè®¸ä» <code>app.asar</code> å¯å¨ï¼ä¸åè®¸å è½½è§£ååç <code>app</code> æä»¶å¤¹ã<br>
å¨ Electron çæéï¼Fusesï¼çæ­æºå¶ï¼æ¯ Electron å®æ¹å¨ v12 åä»¥ä¸çæ¬å¼å¥çç¼è¯æ¶å®å¨éç½®æºå¶ï¼å®çæ ¸å¿ä½ç¨æ¯å¨åºç¨æåé¶æ®µå°± âç§å½â ä¸ç³»åå¼å³å° Electron äºè¿å¶æä»¶ä¸­ï¼æ°¸ä¹éå®åºç¨çè¿è¡æ¶è¡ä¸ºï¼é²æ­¢è¢«ç¯¡æ¹ãéåææ¶æå©ç¨ã<br>
æ¥è¯¢Fuseséç½®<code>electron-fuses read --app "D:\Program Files\Typora\Typora.exe"</code><pre><code>Analyzing app: Typora.exe
Fuse Version: v1
 RunAsNode is Disabled
 EnableCookieEncryption is Disabled
 EnableNodeOptionsEnvironmentVariable is Enabled
 EnableNodeCliInspectArguments is Disabled
 EnableEmbeddedAsarIntegrityValidation is Disabled
 OnlyLoadAppFromAsar is Enabled
 LoadBrowserProcessSpecificV8Snapshot is Disabled
 GrantFileProtocolExtraPrivileges is Enabled
</code></pre>
</li>
</ol>
<p><code>enableNodeOptions</code> å¼å³ä¹æå¼äºï¼æä»¥æ æ³ç¨<code>--debug</code>/<code>--inspect</code> å¯å¨ï¼å ä¸ºFuseså·²ç»å¨æåæ¶ç¦ç¨äºè°è¯ç«¯å£ã<br>
è¿éå¯ä»¥çå°OnlyLoadAppFromAsar is Enabledï¼è¿å°±æ¯å¯¼è´âè§£å <code>app.asar</code> å¹¶éå½åä¸º <code>app</code> ç®å½âçæ¹æ³ä¼å¤±æï¼å¿é¡»åç ´è§£ Fuses æè½ä¿®æ¹å è½½ä¼åçº§ã</p>
<ol start="2">
<li><strong>ä¿®æ¹éç½®çæ¹æ³</strong>ï¼
<ul>
<li>æ°å»ºä¸ä¸ªææ¬æä»¶ï¼éå½åä¸º <code>fix-fuses.cjs</code>ï¼æ³¨æåç¼æ¯ <code>.cjs</code>ï¼ä¸æ¯ <code>.txt</code>ï¼ã</li>
<li>ç¨ VS Code æå¼è¿ä¸ªæä»¶ï¼ç²è´´ä»¥ä¸ä»£ç ï¼å¤å¶å®æ´ï¼ä¸è¦æ¼è¡ï¼ï¼<pre><code class="language-javascript">// å¼å¥ä¿®æ¹ Fuses çå·¥å·åæä»¶æä½æ¨¡å
const { flipFuses, FuseV1Options, FuseVersion } = require('@electron/fuses');
const fs = require('fs');

// Typora ç¨åºçå®æ´è·¯å¾ï¼é»è®¤å®è£è·¯å¾ï¼ä¸è¦æ¹ï¼
const fullPath = 'C:\\Program Files\\Typora\\Typora.exe';

// ç¬¬ä¸æ­¥ï¼å¤ä»½åå§ Typora.exeï¼é²æ­¢ä¿®æ¹åºéï¼å¯æ¢å¤ï¼
fs.copyFileSync(fullPath, `${fullPath}.bak`);
console.log('å·²å¤ä»½ Typora.exe ä¸º Typora.exe.bak');

// ç¬¬äºæ­¥ï¼ä¿®æ¹ Fuses éç½®ï¼å³é­ OnlyLoadAppFromAsar
flipFuses(fullPath, {
  version: FuseVersion.V1,
  [FuseV1Options.OnlyLoadAppFromAsar]: false, // åè®¸å è½½ app æä»¶å¤¹
}).then(() =&gt; {
  console.log('Fuses éç½®ä¿®æ¹æåï¼ç°å¨å¯ä»¥å è½½è§£ååç app æä»¶å¤¹äº');
}).catch((err) =&gt; {
  console.error('ä¿®æ¹å¤±è´¥ï¼', err);
});
</code></pre>
</li>
<li>ä¿å­æä»¶åï¼æå¼ CMDï¼è¾å¥ä»¥ä¸å½ä»¤è¿è¡è¿ä¸ªèæ¬ï¼<pre><code class="language-cmd"># åå®è£ä¾èµå·¥å· @electron/fuses
npm i @electron/fuses

# è¿è¡ä¿®æ¹éç½®çèæ¬ï¼æ³¨æèæ¬è·¯å¾ï¼æ¯å¦ä¿å­å¨æ¡é¢å°±å cd å°æ¡é¢ï¼
cd C:\Users\ä½ çç¨æ·å\Desktop  # æ¿æ¢æä½ çèæ¬ä¿å­è·¯å¾
node fix-fuses.cjs
</code></pre>
</li>
<li>çå°âä¿®æ¹æåâæç¤ºåï¼ååå» <code>Typora.exe</code>ï¼ç¨åºè½æ­£å¸¸æå¼äºï¼ä½ä¿®æ¹æºç åä¼éªéï¼å ä¸ºæå®æ´æ§æ ¡éªï¼ã</li>
</ul>
</li>
</ol>
<h4 id="å¸¸è§ç-fuse-å¼å³å¯¹éååæå½±åè¾å¤§">å¸¸è§ç Fuse å¼å³ï¼å¯¹éååæå½±åè¾å¤§ï¼</h4>
<p>Electron æä¾äºå¤ä¸ªé¢è®¾ç Fuse å¼å³ï¼å¶ä¸­å ä¸ªåä½ ä¹åå³æ³¨çéååºæ¯é«åº¦ç¸å³ï¼</p>
<table>
<thead>
<tr>
<th>Fuse å¼å³</th>
<th>ä½ç¨</th>
<th>å¯¹éåçå½±å</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>runAsNode</code></td>
<td>ç¦æ­¢å° Electron äºè¿å¶æä»¶å½ä½ Node.js èæ¬ç´æ¥è¿è¡</td>
<td>é²æ­¢æ»å»èéè¿ <code>electron.exe --eval</code> æ§è¡æ¶æä»£ç ï¼ä¹ä¼é»ç¢éåæ¶çå¿«éè°è¯</td>
</tr>
<tr>
<td><code>enableNodeOptions</code></td>
<td>ç¦æ­¢éè¿å½ä»¤è¡ä¼ é <code>--node-integration</code> ç­ Node.js éé¡¹</td>
<td>æ æ³éè¿å½ä»¤è¡å¼ºå¶å¼å¯ Node éææè°è¯ç«¯å£ï¼å¦ <code>--inspect</code>ï¼ï¼è¿ä¹æ¯ Typora æç» <code>--debug</code>/<code>--inspect</code> çåå ä¹ä¸</td>
</tr>
<tr>
<td><code>onlyLoadAppFromAsar</code></td>
<td>å¼ºå¶ Electron ä»å è½½ <code>app.asar</code> åï¼å¿½ç¥ <code>resources/app</code> ç®å½</td>
<td>å½»åºæç ´äº Electron åæçâ<code>app</code> ç®å½ä¼åçº§é«äº <code>app.asar</code>âè§åï¼æ æ³éè¿æ¿æ¢ <code>app</code> ç®å½æ¥ä¿®æ¹ä»£ç ï¼éåæ¶å¿é¡»åç»è¿è¿ä¸ªéå¶ï¼</td>
</tr>
<tr>
<td><code>enableEmbeddedAsarIntegrityValidation</code></td>
<td>éªè¯ <code>app.asar</code> åçå®æ´æ§ï¼åºäºåç½®çåå¸å¼ï¼</td>
<td>ç¯¡æ¹ <code>app.asar</code> åä¼å¯¼è´åºç¨å¯å¨å¤±è´¥ï¼æ æ³ç´æ¥ä¿®æ¹ååä»£ç </td>
</tr>
</tbody>
</table>
<hr>
<h3 id="æ­¥éª¤4ç»è¿æä»¶å®æ´æ§æ ¡éªæ ¸å¿æ­¥éª¤">æ­¥éª¤4ï¼ç»è¿æä»¶å®æ´æ§æ ¡éªï¼æ ¸å¿æ­¥éª¤ï¼</h3>
<ol>
<li>
<p><strong>é®é¢ç°è±¡</strong>ï¼<br>
åªè¦ä¿®æ¹ <code>app</code> æä»¶å¤¹éç <code>launch.dist.js</code>ï¼å¯å¨ Typora åå ç§å°±éªéã<br>
åå ï¼ç¨åºä¼æ ¡éª 4 ä¸ªæ ¸å¿æä»¶çå®æ´æ§ï¼Hash å¼ï¼ï¼ä¸å¹éå°±è°ç¨ <code>app.quit()</code> éåºã</p>
</li>
<li>
<p><strong>ç»è¿åç</strong>ï¼<br>
å«æ Node.js ç <code>fs</code> æ¨¡åï¼æä»¶æä½æ¨¡åï¼ï¼å½ç¨åºè¯å¾è¯»åè¿ 4 ä¸ªæä»¶æ¶ï¼è®©å®å»è¯»æä»¬å¤ä»½çåå§æä»¶ï¼<code>app.bak</code> æä»¶å¤¹ï¼ï¼è¿æ · Hash å°±å¹éäºã</p>
</li>
<li>
<p><strong>å®ç°æ¹æ³</strong>ï¼</p>
<ul>
<li>æå¼ <code>D:\Program Files\Typora\resources\app\launch.dist.js</code>ï¼è§£ååçæºç å¥å£æä»¶ï¼ã</li>
<li>å¨æä»¶æé¡¶é¨ï¼ç²è´´ä»¥ä¸ä»£ç ï¼æ¦æªæä»¶è¯»åï¼éå®åå°å¤ä»½ç®å½ï¼ï¼<pre><code class="language-javascript">// 1. å¼å¥éè¦çæ¨¡åï¼Node.js åç½®ï¼ä¸ç¨é¢å¤å®è£ï¼
const fs = require('fs');
const path = require('path');

// 2. éç½®ï¼æ "resources/app/" è·¯å¾éå®åå° "resources/app.bak/"ï¼å¤ä»½çåå§æä»¶ï¼
const fsPathFrom = /resources[\\/]app[\\/]/i; // å¹éç¨åºè¦è¯»çè·¯å¾
const fsPathTo = 'resources\\app.bak\\'; // éå®åå°å¤ä»½ç®å½

// 3. å«æ fs æ¨¡åçæ ¸å¿å½æ°ï¼readFileãstat ç­ï¼é½æ¯æ ¡éªæä»¶ç¨çï¼
const fsHook = {};
// è¦å«æçæä»¶æä½å½æ°åè¡¨
const needHook = ['readFileSync', 'readFile', 'statSync', 'stat', 'open', 'openSync'];
needHook.forEach((funcName) =&gt; {
  // ä¿å­åå§å½æ°ï¼åç»­è¿è½è°ç¨ï¼
  fsHook[funcName] = fs[funcName];
  // æ¿æ¢ææä»¬çèªå®ä¹å½æ°
  fs[funcName] = function (filePath, ...args) {
    // å¦æç¨åºè¦è¯» app æä»¶å¤¹éçæä»¶ï¼å°±éå®åå° app.bak
    if (typeof filePath === 'string' &amp;&amp; fsPathFrom.test(filePath)) {
      const redirectPath = filePath.replace(fsPathFrom, fsPathTo);
      console.log(`[å«ææä»¶è¯»å] ${filePath} -&gt; ${redirectPath}`);
      return fsHook[funcName].call(this, redirectPath, ...args);
    }
    // å¶ä»æä»¶æ­£å¸¸è¯»å
    return fsHook[funcName].call(this, filePath, ...args);
  };
});

// 4. å«æ fs.promisesï¼å¼æ­¥æä»¶æä½ï¼ç¨åºä¹ä¼ç¨ï¼
const fsPromisesHook = {};
const needHookPromises = ['readFile', 'open', 'stat'];
needHookPromises.forEach((funcName) =&gt; {
  fsPromisesHook[funcName] = fs.promises[funcName];
  fs.promises[funcName] = async function (filePath, ...args) {
    if (typeof filePath === 'string' &amp;&amp; fsPathFrom.test(filePath)) {
      const redirectPath = filePath.replace(fsPathFrom, fsPathTo);
      console.log(`[å¼æ­¥å«ææä»¶è¯»å] ${filePath} -&gt; ${redirectPath}`);
      return fsPromisesHook[funcName].call(this, redirectPath, ...args);
    }
    return fsPromisesHook[funcName].call(this, filePath, ...args);
  };
});

// 5. æ¦æª app.quit()ï¼é²æ­¢ç¨åºéåºï¼è°è¯ç¨ï¼åç»­å¯å é¤ï¼
const electron = require('electron');
const originalQuit = electron.app.quit;
electron.app.quit = function () {
  console.log('[æ¦æªéåº] ç¨åºè¯å¾è°ç¨ app.quit()ï¼å·²é»æ­¢ï¼');
};

// 6. å¼å¯è°è¯å·¥å·ï¼DevToolsï¼ï¼æ¹ä¾¿åç»­åæ
electron.app.on('browser-window-created', (_event, win) =&gt; {
  win.webContents.once('dom-ready', () =&gt; {
    console.log('å·²æå¼è°è¯å·¥å·ï¼');
    win.webContents.openDevTools({ mode: 'detach' }); // ç¬ç«çªå£æ¾ç¤ºè°è¯å·¥å·
  });
});
</code></pre>
</li>
<li>ä¿å­æä»¶åï¼å¯å¨ Typoraï¼ä¸ä¼éªéï¼ä¸ä¼å¼¹åº DevTools è°è¯çªå£ï¼è¯´æç»è¿æåï¼ã</li>
</ul>
</li>
</ol>
<h3 id="æ­¥éª¤5åæç¦»çº¿æ¿æ´»é»è¾é»çæ¨å¯¼">æ­¥éª¤5ï¼åæç¦»çº¿æ¿æ´»é»è¾ï¼é»çæ¨å¯¼ï¼</h3>
<ol>
<li><strong>åç«¯æ ¼å¼æ ¡éª</strong>ï¼<br>
æå¼ Typora â å¸®å© â ç¦»çº¿æ¿æ´»ï¼è¾å¥ä»»æå­ç¬¦ç¹å»âæ¿æ´»âï¼æ²¡ååºã<br>
ç¨ DevTools å¨å³é®ä»£ç å¤ä¸æ­ç¹è°è¯åç°ï¼æ¿æ´»ç å¿é¡»æ»¡è¶³ãä»¥ <code>+</code> å¼å¤´ãæãä»¥ <code>#</code> ç»å°¾ãï¼å¦ååç«¯ä¸æäº¤ã<br>
<img src="https://img2024.cnblogs.com/blog/1487752/202601/1487752-20260127163648103-1433270992.png" alt="image" loading="lazy"></li>
</ol>
<p>è¿æ®µä»£ç æ¯Typora<strong>æ¸²æè¿ç¨</strong>ä¸­<strong>ç¦»çº¿æ¿æ´»</strong>çæ ¸å¿å¤çé»è¾ï¼ä»£ç ç»è¿ES6 Generatorå½æ°+æ··æ·åç¼©ï¼ï¼å¨ç¨å´ç»<strong>æ¸²æè¿ç¨å¤çæ¿æ´»ä»¤ç â ä¸ä¸»è¿ç¨IPCéä¿¡å®æéªè¯ â æ ¹æ®ä¸»è¿ç¨è¿åç»ææ´æ°æ¬å°æ¿æ´»ç¶æ</strong>å±å¼ï¼æ²¡æå¤æçç½ç»è¯·æ±ï¼ç¦»çº¿æ¿æ´»ç¹æ§ï¼ï¼æé®ç¹å»è§¦ååèµ°çº¯æ¬å°+ä¸»è¿ç¨éªè¯çé­ç¯ã</p>
<p>åæç¡®æ ¸å¿å³èï¼æªæ¿æ´»ç¶æä¸ï¼é¡µé¢çãActivateãæé®ç¹å»åä¼è§¦å<strong>oeå½æ°</strong>ï¼ä»£ç é<code>onClick: oe</code>ï¼ï¼è<code>oe</code>å°±æ¯è¿æ®µä»£ç å¼å¤´å®ä¹ç<strong>å¿åç¦»çº¿æ¿æ´»å¤çå½æ°</strong>ï¼ä»£ç éç¬¬ä¸ä¸ªå¤§çgeneratorå½æ°ï¼æç»è¿åçfunction(t)ï¼ï¼è¿æ¯æ¿æ´»çå¯ä¸å¥å£ã</p>
<p>ä¸é¢æ<strong>æ§è¡é¡ºåº</strong>æè§£å®æ´çæ¿æ´»æµç¨ï¼åæ¶è§£ææ··æ·ä»£ç éçå³é®é»è¾åå½æ°ä½ç¨ï¼</p>
<h4 id="ä¸æ ¸å¿ç¦»çº¿æ¿æ´»ä¸»æµç¨oeå½æ°æé®ç¹å»è§¦å">ä¸ãæ ¸å¿ï¼ç¦»çº¿æ¿æ´»ä¸»æµç¨ï¼oeå½æ°ï¼æé®ç¹å»è§¦åï¼</h4>
<p>è¿ä¸ªå½æ°æ¯æ¿æ´»çæ ¸å¿ï¼æ¥æ¶ä¸ä¸ª<strong>æ¿æ´»ä»¤çt</strong>ï¼æé®ç¹å»æ¶ä¼ å¥çç¨æ·è¾å¥/ç²è´´çæ¿æ´»ç ï¼ï¼å¨ç¨æ¯Generatorå½æ°ï¼<code>u.a.mark</code>/<code>u.a.wrap</code>æ¯coåº/regeneratorçæ··æ·å°è£ï¼å¤çå¼æ­¥æµç¨ï¼ï¼æ<code>switch (e.prev = e.next)</code>çcaseåæ­¥æ§è¡ï¼æ ¸å¿æ­¥éª¤å¦ä¸ï¼</p>
<h5 id="step-1æ¿æ´»ä»¤çæ ¼å¼æ ¡éªå¿è¿åç½®æ¡ä»¶">Step 1ï¼æ¿æ´»ä»¤ç<strong>æ ¼å¼æ ¡éª</strong>ï¼å¿è¿åç½®æ¡ä»¶ï¼</h5>
<pre><code class="language-javascript">if ("+" == t[0] || "#" == t[t.length - 1]) {
    e.next = 2; break
}
return e.abrupt("return"); // æ ¼å¼ä¸æ»¡è¶³ç´æ¥ç»æ­¢æ§è¡
</code></pre>
<ul>
<li>è¦æ±æ¿æ´»ä»¤ç<strong>å¼å¤´æ¯+</strong> æè<strong>ç»å°¾æ¯#</strong>ï¼ä¸æ»¡è¶³åç´æ¥éåºæ¿æ´»æµç¨ï¼æ ä»»ä½æç¤ºï¼</li>
<li>è¿æ¯Typoraç¦»çº¿æ¿æ´»ä»¤ççä¸å±æ ¼å¼æ è¯ï¼è¿æ»¤æ æçä¹±è¾å¥ã</li>
</ul>
<h5 id="step-2ä»¤çæ ¼å¼æ¸æ´æªåææé¨å">Step 2ï¼ä»¤çæ ¼å¼æ¸æ´ï¼æªåææé¨å</h5>
<pre><code class="language-javascript">t = t.substr(1, t.length - 2)
</code></pre>
<ul>
<li>å»æä»¤çå¼å¤´1ä½åç»å°¾2ä½çæ ¼å¼æ è¯ï¼å¾å°<strong>çæ­£çææä»¤çåå®¹</strong>ï¼</li>
<li>ç¤ºä¾ï¼å¦æåä»¤çæ¯<code>+abcdef#</code>ï¼æ¸æ´åå¾å°<code>bcde</code>ï¼æªæå¼å¤´+åç»å°¾#ï¼é¿åº¦-2ï¼ã</li>
</ul>
<h5 id="step-3webkitç¯å¢ä¸çä»¤çè§£æä¸éç»typora-electronåºäºwebkitå¿èµ°æ­¤åæ¯">Step 3ï¼WebKitç¯å¢ä¸ç<strong>ä»¤çè§£æä¸éç»</strong>ï¼Typora ElectronåºäºWebKitï¼å¿èµ°æ­¤åæ¯ï¼</h5>
<p>è¿æ¯ç¦»çº¿æ¿æ´»ç<strong>æ ¸å¿è§£ææ­¥éª¤</strong>ï¼åè£¹å¨try-catchï¼<code>e.prev=3</code>/<code>e.catch(3)</code>ï¼ä¸­ï¼è§£æå¤±è´¥ç´æ¥å¼¹éï¼</p>
<pre><code class="language-javascript">window.webkit &amp;&amp; (
    n = t.split("|") || ["", ""], // æ|åå²ä»¤çä¸ºæ°ç»ï¼ååºç©ºæ°ç»
    r = Object(f.a)(n, 2), // æªåæ°ç»å2ä¸ªåç´ ï¼f.aæ¯æ°ç»sliceçæ··æ·å°è£ï¼
    a = r[0], o = r[1], // åå²ä¸ºaï¼ä¸»ä½é¨åï¼åoï¼ç­¾åsigï¼
    // æ ¸å¿ï¼aè¿è¡base64è§£ç  â è½¬JSONå¯¹è±¡ â è¿½å sigç­¾åå­æ®µ â éæ°è½¬JSONå­ç¬¦ä¸²
    (i = JSON.parse(window.atob(a))).sig = o,
    t = JSON.stringify(i)
)
</code></pre>
<ul>
<li>è§£æåæï¼TyporaçElectronåæ ¸åºäºWebKitï¼<code>window.webkit</code>æä¸ºtrueï¼æ­¤åæ¯å¿æ§è¡ï¼</li>
<li>ä»¤çæ ¼å¼è¦æ±ï¼æ¸æ´åçææä»¤çå¿é¡»æ¯<strong>ãbase64å­ç¬¦ä¸²|ç­¾åå­ç¬¦ä¸²ã</strong> çæ ¼å¼ï¼æ<code>|</code>åå²ä¸ºä¸¤é¨åï¼</li>
<li>å³é®æä½ï¼å¯¹ç¬¬ä¸é¨å<code>a</code>å<strong>window.atob</strong>ï¼base64è§£ç ï¼ï¼è§£æä¸ºJSONå¯¹è±¡åï¼æç¬¬äºé¨å<code>o</code>ä½ä¸º<strong>ç­¾åsig</strong>è¿½å å°å¯¹è±¡ä¸­ï¼æåéæ°è½¬æJSONå­ç¬¦ä¸²ï¼ä½ä¸º<strong>æç»ä¼ ç»ä¸»è¿ç¨çæ¿æ´»åæ°</strong>ã</li>
</ul>
<h5 id="step-4è§£æå¤±è´¥çå¼å¸¸å¤ç">Step 4ï¼è§£æå¤±è´¥çå¼å¸¸å¤ç</h5>
<pre><code class="language-javascript">e.t0 = e.catch(3),
window.alert("Invalid Activation Token"), // å¼¹æ¡æç¤ºãæ æçæ¿æ´»ä»¤çã
e.abrupt("return"); // ç»æ­¢æ¿æ´»æµç¨
</code></pre>
<ul>
<li>ä»»ä½è§£æéè¯¯ï¼base64æ æãJSONæ ¼å¼éè¯¯ãåå²åæ æ°æ®ï¼é½ä¼èµ°å°è¿éï¼å¼¹æ¡åç´æ¥éåºï¼</li>
<li>è¿æ¯ç¨æ·æå¸¸éå°çãæ¿æ´»å¤±è´¥ãæç¤ºçåå ä¹ä¸ã</li>
</ul>
<h5 id="step-5æ¾ç¤ºå è½½ç¶æåä¸»è¿ç¨åèµ·ç¦»çº¿æ¿æ´»ipcè¯·æ±">Step 5ï¼æ¾ç¤ºå è½½ç¶æï¼<strong>åä¸»è¿ç¨åèµ·ç¦»çº¿æ¿æ´»IPCè¯·æ±</strong></h5>
<pre><code class="language-javascript">J(!0), // æ¾ç¤ºå è½½ä¸­ï¼æ¯å¦æé®ç½®ç°ãloadingå¨ç»ï¼
e.next = 14,
// æ ¸å¿IPCéä¿¡ï¼æ¸²æè¿ç¨ â ä¸»è¿ç¨ï¼è°ç¨offlineActivationæ¹æ³ï¼ä¼ å¤çåçä»¤çt
window.Setting.invokeWithCallback("offlineActivation", t);
</code></pre>
<ul>
<li><code>J(!0)</code>ï¼æ¸²æè¿ç¨ç<strong>å è½½ç¶ææ§å¶</strong>ï¼trueè¡¨ç¤ºå¼å¯å è½½ï¼é²æ­¢ç¨æ·éå¤ç¹å»ï¼</li>
<li><code>window.Setting.invokeWithCallback</code>ï¼Typoraå°è£ç<strong>Electron IPCéä¿¡æ¹æ³</strong>ï¼æ¸²æè¿ç¨è°ç¨ä¸»è¿ç¨å¹¶æ¥æ¶è¿åç»æï¼ï¼æ¯æ¸²æè¿ç¨åä¸»è¿ç¨çæ ¸å¿éä¿¡æ¡¥æ¢ï¼</li>
<li>è°ç¨ä¸»è¿ç¨ç<code>offlineActivation</code>æ¹æ³ï¼ä¼ å¥å¤çåçä»¤çtï¼<strong>ä¸»è¿ç¨å¨æ­¤å®æçæ­£çæ¿æ´»éªè¯</strong>ï¼æ¯å¦ä»¤çç­¾åæ ¡éªãè®¸å¯è¯æææ§å¤æ­ï¼è¿é¨åé»è¾ä¸å¨è¿æ®µæ¸²æè¿ç¨ä»£ç ä¸­ï¼æ¯éåçæ ¸å¿å³é®ç¹ï¼ã</li>
</ul>
<h4 id="step-6æ¥æ¶ä¸»è¿ç¨è¿åç»æå¤çæ¿æ´»æåå¤±è´¥">Step 6ï¼æ¥æ¶ä¸»è¿ç¨è¿åç»æï¼<strong>å¤çæ¿æ´»æå/å¤±è´¥</strong></h4>
<p>è¿æ¯æ¿æ´»çæç»ç¯èï¼ä¸»è¿ç¨æ§è¡<code>offlineActivation</code>åè¿åç»æ<code>l</code>ï¼æ¸²æè¿ç¨æç»æåæ¯å¤çï¼</p>
<pre><code class="language-javascript">l = e.sent, // æ¥æ¶ä¸»è¿ç¨è¿åçç»æl
c = Object(f.a)(l, 4), // æè¿åç»æåå²ä¸ºå4ä¸ªåç´ ï¼s/d/p/hï¼
s = c[0], d = c[1], p = c[2], h = c[3],
J(!1), // éèå è½½ç¶æ
// åæ¯1ï¼æ¿æ´»æåï¼sä¸ºtrueï¼
s ? (
    Y(d), // æ¸ç©º/éç½®éè¯¯æç¤º
    _(!0), // å¨å±æ è®°ãå·²æ¿æ´»ãç¶æï¼æ ¸å¿ï¼è®¾ç½®Pä¸ºtrueï¼é¡µé¢ä¼éæ°æ¸²æï¼
    S(0), // éç½®æ¿æ´»é¡µé¢ç¶æï¼æ¯å¦æ¸ç©ºè¾å¥æ¡ãéèæ¿æ´»è¡¨åï¼
    L(p), // å­å¨è®¸å¯è¯ç¸å³ä¿¡æ¯pï¼æ¯å¦è®¸å¯è¯åç§°ãæææï¼
    U(h), // å­å¨è®¸å¯è¯é¢å¤ä¿¡æ¯hï¼æ¯å¦è®¾å¤IDãæ¿æ´»æ¶é´ï¼
    Q("off") // å³é­è¯ç¨åè®¡æ¶/è¯ç¨ç¶æ
) : 
// åæ¯2ï¼æ¿æ´»å¤±è´¥ï¼sä¸ºfalseï¼
(
    window.alert("Invalid Activation Token"), // å¼¹æ¡æç¤ºæ æä»¤ç
    Y(d || "Unknown Error") // æ¾ç¤ºä¸»è¿ç¨è¿åçéè¯¯ä¿¡æ¯dï¼ååºæªç¥éè¯¯
);
</code></pre>
<ul>
<li>ä¸»è¿ç¨è¿åç»æ<code>l</code>æ¯ä¸ä¸ªå¯åå²çéåï¼æé¡ºåºè§£æä¸º4ä¸ªæ ¸å¿åæ°ï¼
<ul>
<li><code>s</code>ï¼<strong>æ¿æ´»ç»ææ è¯</strong>ï¼å¸å°å¼ï¼true=æåï¼false=å¤±è´¥ï¼ï¼æ¯ææ ¸å¿çå¤æ­ä¾æ®ï¼</li>
<li><code>d</code>ï¼éè¯¯ä¿¡æ¯/é¢çå­æ®µï¼æåæ¶ä¸ºç©ºï¼å¤±è´¥æ¶ä¸ºå·ä½éè¯¯åå ï¼ï¼</li>
<li><code>p</code>/<code>h</code>ï¼è®¸å¯è¯ç¸å³ä¿¡æ¯ï¼æåæ¶è¿åï¼ç¨äºæ¬å°å­å¨åé¡µé¢å±ç¤ºï¼ï¼</li>
</ul>
</li>
<li>æ¿æ´»æåç<strong>æ ¸å¿æ è®°</strong>ï¼æ§è¡<code>_(!0)</code>åï¼å¨å±åé<code>P</code>ä¼è¢«è®¾ç½®ä¸º<code>true</code>ï¼ä»£ç éè½çå°<code>ue = Object(y.a)(P ? "Typora Activated" : "Activate Typora")</code>ï¼ï¼é¡µé¢ä¼æ ¹æ®<code>P</code>çç¶æ<strong>éæ°æ¸²æ</strong>ï¼éèæ¿æ´»æé®ãæ¾ç¤ºãView LicenseãåãDeactivateãæé®ï¼ï¼</li>
<li>æ¿æ´»å¤±è´¥åå¼¹æ¡æç¤ºï¼åè§£æå¤±è´¥çæç¤ºä¸è´ï¼æ æ³ä»åç«¯åºåæ¯ãä»¤çæ ¼å¼éãè¿æ¯ãä»¤çæ¬èº«æ æãã</li>
</ul>
<h5 id="äºæ¬æ¬¡æ¿æ´»é»è¾çæ ¸å¿éåå³é®ç¹">äºãæ¬æ¬¡æ¿æ´»é»è¾ç<strong>æ ¸å¿éåå³é®ç¹</strong></h5>
<p>è¿æ®µä»£ç åªæ¯<strong>æ¸²æè¿ç¨çåç«¯å¤çé»è¾</strong>ï¼<strong>çæ­£çæ¿æ´»éªè¯æ ¸å¿å¨ä¸»è¿ç¨</strong>ï¼ä¹æ¯åç»­éåçéç¹ï¼éè¦å³æ³¨è¿2ä¸ªå³é®ç¹ï¼</p>
<ol>
<li><strong>ä¸»è¿ç¨ç<code>offlineActivation</code>æ¹æ³</strong>ï¼æ¸²æè¿ç¨åªæ¯æå¤çåçä»¤çtä¼ ç»ä¸»è¿ç¨ï¼<strong>ä¸»è¿ç¨ææ¯çæ­£åä»¤çæ ¡éªãç­¾åéªè¯ãè®¸å¯è¯æææ§å¤æ­çå°æ¹</strong>ï¼è¿æ®µä»£ç éæ²¡æä»»ä½éªè¯é»è¾ï¼åªæ¯ä¼ ååæ¥æ¶ç»æï¼</li>
<li><strong>æ¿æ´»ç¶æçæä¹å</strong>ï¼<code>_(!0)</code>åªæ¯è®¾ç½®äºåå­ä¸­çå¨å±ç¶æ<code>P</code>ï¼Typoraå¿ç¶ä¼æ<strong>æ¿æ´»ç¶æ/è®¸å¯è¯ä¿¡æ¯æä¹åå°æ¬å°æä»¶/æ³¨åè¡¨</strong>ï¼æ¯å¦Windowsçæ³¨åè¡¨ãmacOSçplistæä»¶ï¼ï¼éå¯åè¯»åè¯¥æä»¶å¤æ­æ¯å¦æ¿æ´»ï¼è¿æ¯ç ´è§£çæ ¸å¿ï¼æ¯å¦ç´æ¥ä¿®æ¹æ¬å°æä¹åçæ¿æ´»ç¶æï¼ã</li>
</ol>
<h5 id="ä¸æ»ç»typoraç¦»çº¿æ¿æ´»çå®æ´é­ç¯">ä¸ãæ»ç»ï¼Typoraç¦»çº¿æ¿æ´»çå®æ´é­ç¯</h5>
<pre><code>ç¨æ·ç¹å»æ¿æ´»æé® â ä¼ å¥æ¿æ´»ä»¤çt â æ¸²æè¿ç¨åæ ¼å¼æ ¡éª/è§£æ â å¤çä¸ºæ åJSONåæ° â IPCè°ç¨ä¸»è¿ç¨offlineActivationæ¹æ³ â ä¸»è¿ç¨æ§è¡æ ¸å¿éªè¯ â è¿åæ¿æ´»ç»æs â æ¸²æè¿ç¨æ ¹æ®sæ´æ°æ¬å°ç¶æ/é¡µé¢ â æ¿æ´»æåï¼P=trueï¼/å¤±è´¥ï¼å¼¹æ¡ï¼
</code></pre>
<p>ç®åæ¥è¯´ï¼<strong>æ¸²æè¿ç¨åªåãä»¤ççæ ¼å¼å¤çãé¡µé¢äº¤äºãç¶ææ´æ°ãï¼ä¸»è¿ç¨åãçæ­£çæ¿æ´»éªè¯ãï¼æ¿æ´»çæ ¸å¿æ¯ä¸»è¿ç¨<code>offlineActivation</code>æ¹æ³çè¿åç»æ<code>s</code>æ¯å¦ä¸ºtrue</strong>ã</p>
<p>åç»­éåçæ ¸å¿æ¹åå°±æ¯ï¼<strong>æ¾å°ä¸»è¿ç¨ä¸­<code>offlineActivation</code>æ¹æ³çå®ç°ä»£ç ï¼ç ´è§£å¶ä»¤çæ ¡éªé»è¾ï¼æèå¼ºå¶è®©å¶è¿å<code>s=true</code>çç»æ</strong>ã</p>
<ol start="2">
<li>
<p><strong>çæ§ IPC éä¿¡</strong>ï¼<br>
åç«¯ï¼çé¢ï¼ä¼æå¤çåçæ¿æ´»ç ï¼éè¿ IPCï¼è¿ç¨é´éä¿¡ï¼åéç»ä¸»è¿ç¨ï¼æ ¸å¿é»è¾ï¼ãæä»¬éè¦çæ§è¿ä¸ªéä¿¡ï¼çåæ°åè¿åå¼ã</p>
<ul>
<li>å¨ <code>launch.dist.js</code> ä¸­ç»§ç»­æ·»å ä»¥ä¸ä»£ç ï¼çæ§ IPCï¼ï¼<pre><code class="language-javascript">// çæ§ IPC éä¿¡ï¼ä¸»è¿ç¨æ¥æ¶åç«¯çæ¿æ´»è¯·æ±ï¼
const originalIpcHandle = electron.ipcMain.handle;
electron.ipcMain.handle = function (channel, listener) {
  return originalIpcHandle.call(this, channel, async (event, ...args) =&gt; {
    // åªå³æ³¨ç¦»çº¿æ¿æ´»ç¸å³çé¢éï¼offlineActivationï¼
    if (channel === 'offlineActivation') {
      console.log(`[æ¶å°æ¿æ´»è¯·æ±] åæ°ï¼${JSON.stringify(args)}`);
      try {
        const result = await listener(event, ...args);
        console.log(`[æ¿æ´»ååº] ç»æï¼${JSON.stringify(result)}`);
        return result;
      } catch (err) {
        console.error(`[æ¿æ´»éè¯¯]ï¼${err}`);
        throw err;
      }
    }
    // å¶ä» IPC éä¿¡æ­£å¸¸å¤ç
    return listener(event, ...args);
  });
};
</code></pre>
</li>
<li>ä¿å­åå¯å¨ Typoraï¼è¾å¥ç¬¦åæ ¼å¼çæ¿æ´»ç ï¼æ¯å¦ <code>+test#</code>ï¼ï¼ç¹å»æ¿æ´»ï¼å¨ <code>C:\Users\ç¨æ·å\AppData\Roaming\Typora\typora.log</code>è½çå°è¯·æ±åæ°åååºï¼æ­¤æ¶ååºæ¯ <code>[false, "Please input a valid license code"]</code>ï¼æ¿æ´»å¤±è´¥ï¼ã</li>
</ul>
</li>
<li>
<p><strong>æ¨å¯¼æ¿æ´»æ°æ®ç»æ</strong>ï¼<br>
ç¨åºä¼ç¨ RSA å¬é¥è§£å¯æ¿æ´»ç ï¼è§£å¯åéè¦æ¯ä¸ä¸ª JSON å¯¹è±¡ï¼åå«ç¹å®å­æ®µãæä»¬éè¿âä¼ªé è§£å¯ç»æâæ¨å¯¼éè¦çå­æ®µã</p>
<p>éè¿å«æcrypto.publicDecryptï¼æ§å¶è§£å¯åçè¿åç»æï¼åæ¶æå°è§£å¯æ¥å¿ï¼<br>
çæ§åè®¾ä¸ / äºçå³é®æ¹æ³ï¼Buffer.compare/Buffer.equalsãcrypto.verify/crypto.createHashï¼è°ç¨å³æå°æ¥å¿ï¼<br>
çæ§åè®¾ä¸çå³é®æ¹æ³ï¼Buffer.prototype.toStringï¼éç¹æå°utf-8/utf8æ ¼å¼çè°ç¨ï¼<br>
ä¿çåæ IPC çæ§ï¼èå¨æ¥çæ¿æ´»è¯·æ± / ååºç»æï¼è¾å©éªè¯ã</p>
<pre><code class="language-javascript">// ä¸»è¿ç¨å¥å£æé¡¶é¨æ§è¡ï¼ï¼ï¼é»çæµè¯å¨çæ§ä»£ç 

// éç¨æ¶é´æ³å½æ°ï¼æææ¥å¿ç»ä¸æ ¼å¼
const getTime = () =&gt; new Date().toLocaleString('zh-CN', { hour12: false });

// ==============================================
// çæ§ãåè®¾ä¸ãï¼ç´æ¥æ¯å¯¹Buffer â çæ§Buffer.compare/Buffer.equals
// ==============================================
const originalBufferCompare = Buffer.compare;
Buffer.compare = function (a, b) {
  console.log(`[${getTime()}] [æ£æµå°Buffer.compareè°ç¨] æ¯å¯¹çä¸¤ä¸ªBufferï¼a=${a.toString('base64')}, b=${b.toString('base64')}`);
  return originalBufferCompare.call(this, a, b);
};
const originalBufferEquals = Buffer.prototype.equals;
Buffer.prototype.equals = function (other) {
  console.log(`[${getTime()}] [æ£æµå°Buffer.equalsè°ç¨] æ¯å¯¹çBufferï¼å½å=${this.toString('base64')}, ç®æ =${other.toString('base64')}`);
  return originalBufferEquals.call(this, other);
};

// ==============================================
// çæ§ãåè®¾äºãï¼äºæ¬¡åå¸éªè¯ â çæ§crypto.verify/crypto.createHash
// ==============================================
const originalCryptoVerify = crypto.verify;
crypto.verify = function (alg, data, pubKey, sig) {
  console.log(`[${getTime()}] [æ£æµå°crypto.verifyè°ç¨] ç®æ³ï¼${alg} | å¬é¥ï¼${pubKey.toString().slice(0, 50)}...`);
  return originalCryptoVerify.call(this, alg, data, pubKey, sig);
};
const originalCryptoCreateHash = crypto.createHash;
crypto.createHash = function (alg) {
  console.log(`[${getTime()}] [æ£æµå°crypto.createHashè°ç¨] åå¸ç®æ³ï¼${alg}ï¼MD5/SHA1/SHA256ç­ï¼`);
  return originalCryptoCreateHash.call(this, alg);
};

// ==============================================
// çæ§ãåè®¾ä¸ãï¼è½¬å­ç¬¦ä¸²å¤ç â çæ§Buffer.toStringï¼éç¹å½ä¸­utf-8/utf8
// ==============================================
const originalBufferToString = Buffer.prototype.toString;
Buffer.prototype.toString = function (encoding = 'utf-8', start, end) {
  // éç¹æå°utf-8/utf8æ ¼å¼çè°ç¨ï¼å¶ä»æ ¼å¼ï¼å¦base64/hexï¼ä»è½»éæå°
  if (['utf-8', 'utf8'].includes(encoding)) {
    console.log(`[${getTime()}] [æ£æµå°Buffer.toString(utf-8)è°ç¨] è½¬æ¢åå­ç¬¦ä¸²ï¼${originalBufferToString.call(this, encoding, start, end)}`);
  } else {
    // éutf-8æ ¼å¼ï¼ä»æ è®°è°ç¨ï¼é¿åæ¥å¿å·å±
    // console.log(`[${getTime()}] [æ£æµå°Buffer.toStringè°ç¨] ç¼ç ï¼${encoding}`);
  }
  return originalBufferToString.call(this, encoding, start, end);
};

// ==============================================
// å«æcrypto.publicDecryptï¼æ§å¶è§£å¯è¿åç»æï¼åºç¡çæ§
// ==============================================
const originalPublicDecrypt = crypto.publicDecrypt;
crypto.publicDecrypt = function (...args) {
  try {
    let pubKey, encryptedData;
    if (args.length === 2) [pubKey, encryptedData] = args;
    else if (args.length === 1 &amp;&amp; typeof args[0] === 'object') [pubKey, encryptedData] = [args[0].key, args[1]];
    // æå°è§£å¯å¥å
    console.log(`[${getTime()}] [crypto.publicDecryptæ§è¡] å¾è§£å¯å¯æ(base64)ï¼${encryptedData.toString('base64')}`);
    // æ§è¡åçè§£å¯ï¼ä¿çåæç»æï¼é»çæµè¯é¶æ®µä¸ç¯¡æ¹ï¼ä»çæ§ï¼
    const decryptBuffer = originalPublicDecrypt.apply(this, args);
    console.log(`[${getTime()}] [crypto.publicDecryptæå] è§£å¯ååå§Bufferï¼${decryptBuffer.toString('base64')}`);
    return decryptBuffer;
  } catch (err) {
    console.error(`[${getTime()}] [crypto.publicDecryptå¤±è´¥] ${err.message}`);
    throw err;
  }
};

// ==============================================
// çæ§IPCï¼èå¨æ¥çæ¿æ´»è¯·æ±/ååºï¼è¾å©éªè¯ç»æ
// ==============================================
const originalIpcHandle = electron.ipcMain.handle;
electron.ipcMain.handle = function (channel, listener) {
  return originalIpcHandle.call(this, channel, async (event, ...args) =&gt; {
    if (channel === 'offlineActivation') {
      console.log(`[${getTime()}] [IPCæ¶å°æ¿æ´»è¯·æ±] åæ°ï¼${JSON.stringify(args)}`);
      try {
        const result = await Promise.resolve(listener(event, ...args));
        console.log(`[${getTime()}] [IPCæ¿æ´»ååº] ç»æï¼${JSON.stringify(result)}`);
        return result;
      } catch (err) {
        console.error(`[${getTime()}] [IPCæ¿æ´»å¤±è´¥] ${err.message}`);
        throw err;
      }
    }
    return Promise.resolve(listener(event, ...args));
  });
};
</code></pre>
</li>
</ol>
<p>Typora v1.12.4 å¯¹è§£å¯å Buffer çå¤çé»è¾ä¸ºï¼<strong>RSA å¯æé¿åº¦åç½®æ ¡éª â è§£å¯å Buffer è½¬ UTF-8 å­ç¬¦ä¸² â å­ç¬¦ä¸²ç»æåæ ¡éªï¼å¦ JSON è§£æãå³é®å­å¹éç­ï¼â æ ¡éªéè¿åæ¿æ´»æåï¼å¦åè¿åæ æ</strong>ã</p>
<h4 id="æ­¥éª¤1ä»éè¯¯æ¥å¿æ¨æ­å¯æé¿åº¦åç½®æ ¡éª">æ­¥éª¤1ï¼ä»éè¯¯æ¥å¿æ¨æ­ãå¯æé¿åº¦åç½®æ ¡éªã</h4>
<p>æ¥å¿ä¸­åå¤åºç° RSA è§£å¯éè¯¯ï¼<code>error:04000070:RSA routines:OPENSSL_internal:DATA_LEN_NOT_EQUAL_TO_MOD_LEN</code></p>
<ul>
<li>è¯¥éè¯¯çæ ¸å¿åå ï¼RSA ç®æ³è¦æ±ãå¾è§£å¯å¯æé¿åº¦å¿é¡»ç­äºå¬é¥æ¨¡æ°é¿åº¦ãï¼ä¾å¦ 2048 ä½ RSA å¬é¥å¯¹åº 256 å­èå¯æï¼ã</li>
<li>ç¨æ·è¾å¥çæ¿æ´»ä»¤çï¼å¦ <code>3.33333333333333</code>ï¼å¯¹åºçå¯æé¿åº¦ä¸æ»¡è¶³è¦æ±ï¼ç´æ¥è¢« RSA è§£å¯åºå±æç»ï¼æªè¿å¥åç»­ Buffer å¤çæµç¨ã</li>
<li>æ¨æ­ï¼Typora å¨è°ç¨ <code>crypto.publicDecrypt</code> å/åï¼ä¼éå«ãå¯æé¿åº¦æ ¡éªãï¼åªæå¯æé¿åº¦ä¸å¬é¥æ¨¡æ°ä¸è´ï¼æä¼ç»§ç»­å¤çè§£å¯åç Bufferï¼å¦åç´æ¥è¿åæ æã</li>
</ul>
<h4 id="æ­¥éª¤2ä»-buffertostringutf-8-è°ç¨æ¥å¿æ¨æ­å¼ºå¶è½¬å­ç¬¦ä¸²">æ­¥éª¤2ï¼ä» Buffer.toString(utf-8) è°ç¨æ¥å¿æ¨æ­ãå¼ºå¶è½¬å­ç¬¦ä¸²ã</h4>
<p>æ¥å¿ä¸­å¤æ¬¡è§¦å <code>[æ£æµå°Buffer.toString(utf-8)è°ç¨]</code>ï¼ä¸è½¬æ¢åå­ç¬¦ä¸²åä¸ºåæ³ UTF-8 æ ¼å¼ï¼å¦ <code>fsPlus</code> æ¨¡åä»£ç ã<code>underscore</code> å·¥å·åºä»£ç ãJSON ç»æå­ç¬¦ä¸²ï¼ï¼</p>
<ul>
<li>æ ä¹±ç æ¥å¿ï¼è¯´æç¨åºé¢æè§£å¯åç Buffer æ¯ãUTF-8 ç¼ç çå­ç¬¦ä¸²å¯¹åºç Bufferãï¼å¼ºå¶è½¬æ¢æ¯åºå®æ­¥éª¤ï¼æ å¶ä»ç¼ç åæ¯ï¼å¦ base64ãhexï¼ã</li>
<li>ç»åå·²ææµè¯ç»è®ºï¼æ  Buffer.compare/equals è°ç¨ï¼ï¼è¿ä¸æ­¥ç¡®è®¤ï¼è§£å¯åä¸ä¼ç´æ¥æä½ Bufferï¼ææåç»­å¤çååºäº UTF-8 å­ç¬¦ä¸²ã</li>
</ul>
<h4 id="æ­¥éª¤3ä»æ¿æ´»ååºæ¥å¿æ¨æ­å­ç¬¦ä¸²ç»æåæ ¡éª">æ­¥éª¤3ï¼ä»æ¿æ´»ååºæ¥å¿æ¨æ­ãå­ç¬¦ä¸²ç»æåæ ¡éªã</h4>
<p>ç¨æ·å¤æ¬¡è¾å¥æ æä»¤çåï¼IPC ååºåä¸º <code>[false,"Please input a valid license code"]</code>ï¼ä¸æ¥å¿ä¸­æ å¶ä»å å¯/åå¸è°ç¨ï¼æé¤äºæ¬¡åå¸ï¼ï¼</p>
<ul>
<li>æ¨æ­ï¼è½¬ UTF-8 å­ç¬¦ä¸²åï¼ç¨åºä¼è¿è¡ãç»æåæ ¡éªãï¼å¯è½åå«ï¼
<ol>
<li>å­ç¬¦ä¸²æ¯å¦ä¸ºåæ³ JSON æ ¼å¼ï¼æ¿æ´»ç¸å³ä¿¡æ¯éå¸¸ä»¥ JSON å­å¨ï¼å¦ <code>{"valid":true,"deviceId":"xxx","license":"lifetime"}</code>ï¼ï¼</li>
<li>JSON ä¸­æ¯å¦åå«å³é®å­æ®µï¼å¦ <code>valid: true</code>ãå¹éç <code>deviceId</code>ãåæ³ç <code>license</code> ç±»åï¼ï¼</li>
<li>å­ç¬¦ä¸²æ¯å¦åå«ç¹å®å³é®å­ï¼å¦ <code>typora-activation-valid</code> è¿ç±»æ ¡éªæ è¯ï¼ã</li>
</ol>
</li>
<li>ç¨æ·è¾å¥çç®åæ°å­ä»¤çï¼è¦ä¹å å¯æé¿åº¦éè¯¯æªè§£å¯æåï¼è¦ä¹è§£å¯åå­ç¬¦ä¸²ä¸æ¯é¢æç JSON/ç»æåæ ¼å¼ï¼å¯¼è´æ ¡éªå¤±è´¥ã</li>
</ul>
<h4 id="æ­¥éª¤4æ´åå®æ´å¤çæµç¨">æ­¥éª¤4ï¼æ´åå®æ´å¤çæµç¨</h4>
<p>ç»åæ¥å¿ç»èåæµè¯ç»è®ºï¼ä¸²èåºå®æ´é»è¾ï¼</p>
<ol>
<li>æ¥æ¶æ¿æ´»è¯·æ±ï¼æ¸²æè¿ç¨ä¼ å¥æ¿æ´»ä»¤çï¼å«å¯æé¨åï¼ï¼è§¦å <code>offlineActivation</code> IPC è°ç¨ï¼</li>
<li>å¯æé¿åº¦æ ¡éªï¼æ£æ¥ä»¤çä¸­çå¯æé¿åº¦æ¯å¦ä¸åç½® RSA å¬é¥æ¨¡æ°é¿åº¦ä¸è´ï¼ä¸ä¸è´åæåº <code>DATA_LEN_NOT_EQUAL_TO_MOD_LEN</code> éè¯¯ï¼</li>
<li>RSA è§£å¯ï¼é¿åº¦æ ¡éªéè¿åï¼è°ç¨ <code>crypto.publicDecrypt</code> è§£å¯å¾å° Bufferï¼</li>
<li>Buffer è½¬ UTF-8 å­ç¬¦ä¸²ï¼å¼ºå¶è°ç¨ <code>Buffer.toString('utf-8')</code>ï¼è½¬æ¢å¤±è´¥ï¼å¦ä¹±ç ï¼åè§ä¸ºæ æï¼</li>
<li>å­ç¬¦ä¸²ç»æåæ ¡éªï¼è§£æå­ç¬¦ä¸²ï¼å¦ JSON .parseï¼ï¼æ ¡éªå³é®å­æ®µ/å³é®å­æ¯å¦ç¬¦åè¦æ±ï¼</li>
<li>è¿åæ¿æ´»ç»æï¼æ ¡éªéè¿å IPC è¿å <code>[true, "", "æ¿æ´»æåä¿¡æ¯"]</code>ï¼å¦åè¿å <code>[false, "æ ææç¤º"]</code>ã</li>
</ol>
<p>Typora å¯¹è§£å¯å Buffer çå¤çé»è¾æ ¸å¿æ¯ã<strong>ä»¥ UTF-8 å­ç¬¦ä¸²ä¸ºæ ¸å¿çç»æåæ ¡éª</strong>ãï¼æ²¡æå¤æçäºæ¬¡å å¯æ Buffer ç´æ¥æ¯å¯¹ï¼çªç ´æ¿æ´»çå³é®å¨äºï¼æé å¯æé¿åº¦ç¬¦åè¦æ±çæ¿æ´»ä»¤çï¼ä½¿ RSA è§£å¯åå¾å°ãåå«åæ³æ ¡éªå­æ®µç UTF-8 å­ç¬¦ä¸²ãï¼å¦ <code>{"valid":true,"deviceId":"ä»»æå¼","license":"ç»èº«"}</code>ï¼ã</p>
<ul>
<li>
<p>å¨ <code>launch.dist.js</code> ä¸­æ·»å ä»¥ä¸ä»£ç ï¼å«æ RSA è§£å¯å½æ°ï¼ï¼</p>
<pre><code class="language-javascript"> // ä¸»è¿ç¨å¥å£æé¡¶é¨æ§è¡ï¼ï¼ï¼
 const crypto = require('crypto');
 //const { ipcMain } = require('electron');

 // éç¨æ¥å¿å½æ°ï¼æ¿æ¢writeLogï¼ç´æ¥æå°æ§å¶å°ï¼æ ä¾èµä¸æ¥éï¼
 const log = (type, msg) =&gt; {
   const time = new Date().toLocaleString('zh-CN', { hour12: false });
   console.log(`[${time}] [${type}] ${msg}`);
 };

 // ä¿å­crypto.publicDecryptåçæ¹æ³
 const originalPublicDecrypt = crypto.publicDecrypt;

 // éåcrypto.publicDecryptï¼è¿åå¸¦Proxyçæ§çèªå®ä¹Buffer
 crypto.publicDecrypt = function (...args) {
   log('crypto.publicDecrypt', 'è§¦åè§£å¯ï¼è¿åå¸¦çæ§çèªå®ä¹Buffer');
   // 1. æé èªå®ä¹Bufferï¼åç»­å¯æ¿æ¢ä¸ºæ¿æ´»ç¸å³JSONï¼ç°å¨åæµtestï¼
   const originalBuffer = Buffer.from('test'); // åºç¡æµè¯ç¨ï¼åç»­æ¹ Buffer.from(JSON.stringify({valid:true}), 'utf-8')
 // æ¿æ¢åæ¥ç Buffer.from('test')
 //const activationJson = JSON.stringify({
 //  valid: true, // æ ¸å¿ï¼æ¯å¦åæ³
  // deviceId: "any-device-id", // è®¾å¤IDï¼å¡«ä»»æå¼
  // license: "lifetime" // è®¸å¯è¯ç±»åï¼ç»èº«ææ
 //});
 //const originalBuffer = Buffer.from(activationJson, 'utf-8'); // è½¬UTF-8 Bufferï¼ç¬¦åç¨åºè¦æ±
   
   // 2. ç»åå§Bufferå Proxyçæ§ï¼æ ¸å¿ä¿®å¤çï¼
   const proxyBuffer = new Proxy(originalBuffer, {
     get(target, prop, receiver) {
       // è¿æ»¤Node.jsåé¨Symbolå­æ®µï¼é¿åçæ§åé¨æä½å¯¼è´å¼å¸¸
       if (typeof prop === 'symbol') {
         return Reflect.get(target, prop, receiver);
       }
       // çæ§Bufferçå±æ§è¯»åï¼å¦lengthãtoStringç­ï¼
       log('ð Bufferå±æ§è¯»å', `è¯»åå±æ§ï¼${String(prop)}`);
       const result = Reflect.get(target, prop, receiver);

       // è¥è¯»åçæ¯æ¹æ³ï¼å¦toStringãsliceï¼ï¼çæ§æ¹æ³çè°ç¨åå¥å
       if (typeof result === 'function') {
         return function (...args) {
           log('ð Bufferæ¹æ³è°ç¨', `è°ç¨æ¹æ³ï¼${String(prop)} | å¥åï¼${JSON.stringify(args)}`);
           // æ ¸å¿ä¿®å¤ï¼æ¹æ³æ§è¡æ¶ï¼thisä¸¥æ ¼æåãåå§Bufferå®ä¾targetãï¼ä¸æåProxy
           return result.apply(target, args);
         };
       }
       // æ®éå±æ§ç´æ¥è¿åç»æ
       return result;
     }
   });

   // 3. è¿åå¸¦çæ§çProxy Bufferï¼æ¿ä»£åçè§£å¯ç»æ
   return proxyBuffer;
 };

 // ð éç¨æ¥å¿å½æ°ï¼æ¿æ¢writeLogï¼æ ä¾èµä¸æ¥éï¼å¸¦æ¶é´æ³ï¼
 const writeLog = (title, content) =&gt; {
   const time = new Date().toLocaleString('zh-CN', { hour12: false });
   console.log(`[${time}] [${title}] ${content}`);
 };

 // ð 1. å«æcrypto.publicDecryptï¼è¿åæé çJSON Bufferï¼æ¿ä»£åçè§£å¯ç»æ
 // const originalPublicDecrypt = crypto.publicDecrypt;
 crypto.publicDecrypt = function (...args) {
   writeLog('crypto.publicDecrypt', 'è§¦åè§£å¯ï¼è¿åèªå®ä¹JSON Bufferï¼è·³è¿åçè§£å¯ï¼');

   // ð 2. æé èªå®ä¹JSONï¼åç»­ç´æ¥æ¿æ¢è¿éçå­æ®µï¼å°±è½æ¨å¯¼ç¨åºéè¦çæ¿æ´»å­æ®µ
   const customJson = JSON.stringify({ 
     test: '123'.repeat(50)  // ä½ åæ¥çæµè¯å­æ®µï¼åç»­æ¿æ¢ä¸ºvalid/deviceIdç­
     // è¿é¶æµè¯ï¼åè¯ç®åæ¿æ´»å­æ®µ â { valid: true, deviceId: "ä»»æå¼", license: "lifetime" }
   });

   // ð 3. æé Bufferï¼æå®UTF-8ç¼ç ï¼åç¨åºé¢æä¸è´ï¼é¿åç¼ç ä¹±ç ï¼
   const result = Buffer.from(customJson, 'utf-8');

   // ð 4. éåJSON.parseï¼ä»åå§åä¸æ¬¡ï¼Proxyçæ§è§£æåçJSONå¯¹è±¡å±æ§è®¿é®
   if (!JSON.originalParse) {
     JSON.originalParse = JSON.parse; // ä¿å­åçparseæ¹æ³
     JSON.parse = function (text, ...args) {
       // æ§è¡åçè§£æï¼ä¿è¯JSONè§£æé»è¾ä¸å
       const obj = JSON.originalParse.call(this, text, ...args);
       // ç»è§£æåçJSONå¯¹è±¡å Proxyï¼çæ§ææå±æ§è®¿é®
       return new Proxy(obj, {
         get(target, prop, receiver) {
           // ð ä¿®å¤åæåçé®é¢ï¼é¿åtexté¿åº¦ä¸è¶³12æ¥éï¼æ¥å¿æ´ç¾è§
           const logText = text.length &gt; 12 ? text.slice(0, 12) + "..." : text;
           // ç²¾åçæ§ï¼åªä¸ªJSONå­ç¬¦ä¸²è¢«è®¿é®äºåªä¸ªå±æ§
           writeLog(`ãð JSONçæ§ã ${logText} è¢«è®¿é®å±æ§`, String(prop));
           // æ­£å¸¸è¿åå±æ§å¼ï¼ä¸å¹²æ°ç¨åºé»è¾
           return Reflect.get(target, prop, receiver);
         },
       });
     };
   }
   // ð 5. è¿åæé çBufferï¼è®©ç¨åºèµ°åç»­çJSONè§£ææµç¨
   return result;
 };
 // é¡ºå¸¦ä¿çIPCçæ§ï¼å¯éï¼æ¹ä¾¿çæ¿æ´»è¯·æ±ååºï¼
 const originalIpcHandle = electron.ipcMain.handle;
 electron.ipcMain.handle = function (channel, listener) {
   return originalIpcHandle.call(this, channel, async (event, ...args) =&gt; {
     if (channel === 'offlineActivation') {
       log('IPCæ¿æ´»è¯·æ±', `åæ°ï¼${JSON.stringify(args, null, 2)}`);
       try {
         const res = await Promise.resolve(listener(event, ...args));
         log('IPCæ¿æ´»ååº', `ç»æï¼${JSON.stringify(res, null, 2)}`);
         return res;
       } catch (e) {
         log('IPCæ¿æ´»éè¯¯', e.message);
         throw e;
       }
     }
     return Promise.resolve(listener(event, ...args));
   });
 };
</code></pre>
</li>
<li>
<p>ä¿å­åå¯å¨ï¼åæ¬¡è¾å¥æ¿æ´»ç  <code>+test#</code> ç¹å»æ¿æ´»ï¼å¨æ¥å¿æä»¶ä¸­å°±è½çå°ç¨åºè®¿é®ç JSON å­æ®µï¼<code>deviceId</code>ã<code>fingerprint</code>ã<code>email</code>ã<code>license</code>ã<code>version</code>ã<code>date</code>ã<code>type</code>ï¼è¿äºå°±æ¯æ¿æ´»å¿éçå­æ®µï¼ã</p>
</li>
</ul>
<h3 id="æ­¥éª¤6å®ç°ç¦»çº¿æ¿æ´»å«ææ ¸å¿ç®æ ">æ­¥éª¤6ï¼å®ç°ç¦»çº¿æ¿æ´»å«æï¼æ ¸å¿ç®æ ï¼</h3>
<ol>
<li>
<p><strong>æé åæ³æ¿æ´»æ°æ®</strong>ï¼<br>
æ ¹æ®ä¸ä¸æ­¥æ¨å¯¼çå­æ®µï¼æé çå®çæ¿æ´»æ°æ®ï¼<code>deviceId</code> å <code>fingerprint</code> ä» Machine Code æåï¼ï¼</p>
<ul>
<li>æå¼ Typora ç¦»çº¿æ¿æ´»é¡µé¢ï¼å¤å¶âMachine Codeâï¼æ¯å¦ <code>Y2Fxxxxxxxxxxxxxx==</code>ï¼ã</li>
<li>æ Machine Code è§£ç ï¼Base64 è§£ç ï¼ï¼ç¨å¨çº¿ Base64 è§£ç å·¥å·ï¼æ¯å¦ <a href="https://base64.us/" target="_blank" rel="noopener nofollow">https://base64.us/</a> ï¼ï¼è§£ç åå¾å°ç±»ä¼¼ï¼<pre><code class="language-json">{"v":"win|1.12.4","i":"CaXXXXXXXJ","l":"XXXXXXX | XXXXXXX | Windows"}
</code></pre>
</li>
<li>å¶ä¸­ï¼<code>l</code> å¯¹åº <code>deviceId</code>ï¼<code>i</code> å¯¹åº <code>fingerprint</code>ï¼<code>v</code> å¯¹åº <code>version</code>ã</li>
</ul>
</li>
<li>
<p><strong>ä¿®æ¹ RSA è§£å¯å«æä»£ç </strong>ï¼<br>
æä¹åä¼ªé ç <code>fakeData</code> æ¢æçå®çæ¿æ´»æ°æ®ï¼è®© RSA è§£å¯ç´æ¥è¿åè¿ä¸ªæ°æ®ï¼</p>
<pre><code class="language-javascript">// æ¿æ¢ä¹åç crypto.publicDecrypt å«æä»£ç 
crypto.publicDecrypt = function (key, buffer) {
  console.log('[RSA è§£å¯è¢«è°ç¨] å·²è¿åä¼ªé æ¿æ´»æ°æ®');
  // æé åæ³çæ¿æ´» JSONï¼æ¿æ¢æä½ ç Machine Code è§£ç åçæ°æ®ï¼
  const activationData = JSON.stringify({
    deviceId: 'XXXXXXX | XXXXXXX | Windows', // ä» Machine Code è§£ç ç l å­æ®µ
    fingerprint: 'CaXXXXXXXJ', // ä» Machine Code è§£ç ç i å­æ®µ
    email: 'test@example.com', // éä¾¿å¡«
    license: 'Cracked_By_Learn', // éä¾¿å¡«
    version: 'win|1.12.4', // ä» Machine Code è§£ç ç v å­æ®µ
    date: '01/04/2030', // è¿ææ¥æï¼å¡«æªæ¥æ¶é´ï¼
    type: 'Learn' // éä¾¿å¡«
  });
  return Buffer.from(activationData); // è¿åä¼ªé çè§£å¯ç»æ
};```

</code></pre>
</li>
<li>
<p><strong>æ¦æªèç½éªè¯</strong>ï¼<br>
æ¿æ´»åéå¯ Typoraï¼æ¿æ´»ç¶æä¼æ¶å¤±ââå ä¸ºç¨åºä¼å <code>https://store.typora.io/api/client/renew</code> åéè¯·æ±éªè¯ï¼è¿å <code>success:false</code>å°±æ¸é¤æ¿æ´»ã<br>
ç»§ç»­å¨ <code>launch.dist.js</code> ä¸­æ·»å ä»£ç ï¼æ¦æªç½ç»è¯·æ±ï¼ï¼</p>
<pre><code>// æ¦æªèç½éªè¯è¯·æ±ï¼ç´æ¥è¿åæå
electron.app.whenReady().then(() =&gt; {
 electron.protocol.handle('https', async (request) =&gt; {
   // å¹éç®æ éªè¯å°å
   if (request.url === 'https://store.typora.io/api/client/renew') {
     console.log('[æ¦æªèç½éªè¯] å·²è¿åæåååº');
     // ä¼ªé æåååº
     return new Response(JSON.stringify({ success: true }), {
       status: 200,
       headers: { 'content-type': 'application/json' }
     });
   }
   // å¶ä»ç½ç»è¯·æ±æ­£å¸¸è½¬å
   return electron.net.fetch(request, { bypassCustomProtocolHandlers: true });
 });
});
</code></pre>
</li>
<li>
<p><strong>æç»æµè¯</strong>ï¼</p>
<ul>
<li>å¯å¨ Typora â å¸®å© â ç¦»çº¿æ¿æ´» â è¾å¥ <code>+ä»»æå­ç¬¦#</code>ï¼æ¯å¦ <code>+abc123#</code>ï¼â ç¹å»æ¿æ´»ã</li>
<li>çå°âæ¿æ´»æåâæç¤ºï¼ä¸»çé¢å·¦ä¸è§âæªæ¿æ´»âå¾æ æ¶å¤±ï¼éå¯åæ¿æ´»ç¶æä»å¨ï¼æåï¼ã</li>
</ul>
</li>
</ol>
<h2 id="åå³é®æ³¨æäºé¡¹">åãå³é®æ³¨æäºé¡¹</h2>
<ol>
<li><strong>å¨ç¨å¤ä»½</strong>ï¼ææåå§æä»¶ï¼<code>app.asar</code>ã<code>Typora.exe</code>ï¼é½è¦å¤ä»½ï¼ä¿®æ¹åºéå¯æ¢å¤ã</li>
<li><strong>å³é­èªå¨æ´æ°</strong>ï¼æå¼ Typora â è®¾ç½® â éç¨ â å³é­âèªå¨æ´æ°âï¼å¦åæ´æ°åéåå¤±æã</li>
<li><strong>ä»ç¨äºå­¦ä¹ </strong>ï¼æ¬ææ¯Electronéåææ¯ç ç©¶ï¼è¯·å¿ç¨äºåä¸ç¨éï¼éµå®è½¯ä»¶è®¸å¯åè®®ã</li>
<li><strong>å½ä»¤è·¯å¾ä¸è¦é</strong>ï¼CMD ä¸­æ§è¡å½ä»¤æ¶ï¼åéè¿ <code>cd è·¯å¾</code> è¿å¥ç®æ ç®å½ï¼æ¯å¦è§£å <code>app.asar</code> æ¶è¦å¨ <code>resources</code> ç®å½ä¸ï¼ã</li>
<li><strong>æ¥éææ¥</strong>ï¼
<ul>
<li>å¯å¨éªéï¼å¤§æ¦çæ¯ <code>launch.dist.js</code> ä»£ç åéï¼æ¯å¦å°æ¬å·ãè¯­æ³éè¯¯ï¼ï¼æ£æ¥ä»£ç æ ¼å¼ã</li>
<li>æ¿æ´»å¤±è´¥ï¼æ£æ¥æ¿æ´»æ°æ®ä¸­ç <code>deviceId</code>ã<code>fingerprint</code> æ¯å¦å Machine Code ä¸è´ã</li>
</ul>
</li>
</ol>
<h2 id="äºæ ¸å¿ææ¯æ»ç»0åºç¡ä¹è½è®°ä½">äºãæ ¸å¿ææ¯æ»ç»ï¼0åºç¡ä¹è½è®°ä½ï¼</h2>
<ol>
<li><strong>asar è§£å</strong>ï¼Electron åºç¨çæ ¸å¿ä»£ç å¨ <code>app.asar</code> ä¸­ï¼éç¨ <code>asar</code> å·¥å·è§£åã</li>
<li><strong>Fuses éç½®</strong>ï¼æ§å¶ Electron åºç¨çå¯å¨è§åï¼æ¯å¦æ¯å¦åè®¸å è½½è§£ååçæºç ï¼ã</li>
<li><strong>API Hook</strong>ï¼æ¦æª Node.js/Electron çæ ¸å¿å½æ°ï¼<code>fs</code>ã<code>crypto</code>ã<code>ipcMain</code>ï¼ï¼ä¿®æ¹å¶è¡ä¸ºã</li>
<li><strong>é»çè°è¯</strong>ï¼ä¸ç¥éåé¨é»è¾æ¶ï¼éè¿âä¼ªé è¾å¥âçæ§è¾åºâæ¨å¯¼æ°æ®ç»æã</li>
<li><strong>ç½ç»å«æ</strong>ï¼æ¦æªè¿ç¨éªè¯è¯·æ±ï¼è¿åä¼ªé çæåååºã</li>
</ol>
<h2 id="å­åè">å­ãåè</h2>
<p><a href="https://www.52pojie.cn/thread-2084047-1-1.html" target="_blank" rel="noopener nofollow">https://www.52pojie.cn/thread-2084047-1-1.html</a><br>
<a href="https://www.52pojie.cn/thread-2040749-1-1.html" target="_blank" rel="noopener nofollow">https://www.52pojie.cn/thread-2040749-1-1.html</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.001388888888888889" data-date-updated="2026-01-29 09:26">2026-01-29 09:24</span>&nbsp;
<a href="https://www.cnblogs.com/xlcm">å¤äºè¶ç³</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19539008);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19539008', targetLink: 'https://www.cnblogs.com/xlcm/p/19539008', title: 'Electronåºç¨éååææè·¯' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ StreamJsonRpc å¨ HagiCode ä¸­çæ·±åº¦éæä¸å®è·µ ]]></title>
    <link>https://www.cnblogs.com/newbe36524/p/19546448</link>
    <guid>5fd5fc260b4ce6533de475241fa9d568</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/newbe36524/p/19546448" title="åå¸äº 2026-01-29 08:46">
    <span role="heading" aria-level="2">StreamJsonRpc å¨ HagiCode ä¸­çæ·±åº¦éæä¸å®è·µ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="streamjsonrpc-å¨-hagicode-ä¸­çæ·±åº¦éæä¸å®è·µ">StreamJsonRpc å¨ HagiCode ä¸­çæ·±åº¦éæä¸å®è·µ</h1>
<blockquote>
<p>æ¬æè¯¦ç»ä»ç»äº HagiCodeï¼å PCodeï¼é¡¹ç®å¦ä½æåéæ Microsoft ç StreamJsonRpc éä¿¡åºï¼ä»¥æ¿æ¢åæçèªå®ä¹ JSON-RPC å®ç°ï¼å¹¶è§£å³äºéæè¿ç¨ä¸­çææ¯çç¹ä¸æ¶æææã</p>
</blockquote>

<h2 id="èæ¯">èæ¯</h2>
<p>StreamJsonRpc æ¯å¾®è½¯å®æ¹ç»´æ¤çç¨äº .NET å TypeScript ç JSON-RPC éä¿¡åºï¼ä»¥å¶å¼ºå¤§çç±»åå®å¨ãèªå¨ä»£ççæåæççå¼å¸¸å¤çæºå¶èç§°ãå¨ HagiCode é¡¹ç®ä¸­ï¼ä¸ºäºéè¿ ACP (Agent Communication Protocol) ä¸å¤é¨ AI å·¥å·ï¼å¦ iflow CLIãOpenCode CLIï¼è¿è¡éä¿¡ï¼å¹¶æ¶é¤æ©æèªå®ä¹ JSON-RPC å®ç°å¸¦æ¥çç»´æ¤ææ¬åæ½å¨ Bugï¼é¡¹ç®å³å®éæ StreamJsonRpcãç¶èï¼å¨éæè¿ç¨ä¸­éå°äºæµå¼ JSON-RPC ç¹æçææï¼ç¹å«æ¯å¨å¤çä»£çç®æ ç»å®åæ³ååæ°è¯å«æ¶ã</p>
<p>ä¸ºäºè§£å³è¿äºçç¹ï¼æä»¬åäºä¸ä¸ªå¤§èçå³å®ï¼æ´ä¸ªæå»ºç³»ç»æ¨åéæ¥ãè¿ä¸ªå³å®å¸¦æ¥çååï¼å¯è½æ¯ä½ æ³è±¡çè¿è¦å¤§ââç¨åæä¼å·ä½è¯´ã</p>
<h2 id="å³äº-hagicode">å³äº HagiCode</h2>
<blockquote>
<p>åä»ç»ä¸ä¸æ¬æç"ä¸»è§é¡¹ç®"</p>
</blockquote>
<p>å¦æä½ å¨å¼åä¸­éå°è¿è¿äºç¦æ¼ï¼</p>
<ul>
<li>å¤é¡¹ç®ãå¤ææ¯æ ï¼æå»ºèæ¬ç»´æ¤ææ¬é«</li>
<li>CI/CD æµæ°´çº¿éç½®ç¹çï¼æ¯æ¬¡æ¹é½è¦æ¥ææ¡£</li>
<li>è·¨å¹³å°å¼å®¹æ§é®é¢å±åºä¸ç©·</li>
<li>æ³è®© AI å¸®å¿åä»£ç ï¼ä½ç°æå·¥å·ä¸å¤æºè½</li>
</ul>
<p>é£ä¹æä»¬æ­£å¨åç HagiCode å¯è½ä½ ä¼æå´è¶£ã</p>
<p><strong>HagiCode æ¯ä»ä¹ï¼</strong></p>
<ul>
<li>ä¸æ¬¾ AI é©±å¨çä»£ç æºè½å©æ</li>
<li>æ¯æå¤è¯­è¨ãè·¨å¹³å°çä»£ç çæä¸ä¼å</li>
<li>åç½®æ¸¸æåæºå¶ï¼è®©ç¼ç ä¸åæ¯ç¥</li>
</ul>
<p><strong>ä¸ºä»ä¹å¨è¿éæå®ï¼</strong><br>
æ¬æåäº«ç StreamJsonRpc éææ¹æ¡ï¼æ­£æ¯æä»¬å¨å¼å HagiCode è¿ç¨ä¸­å®è·µæ»ç»åºæ¥çãå¦æä½ è§å¾è¿å¥å·¥ç¨åæ¹æ¡æä»·å¼ï¼è¯´ææä»¬çææ¯åå³è¿ä¸éââé£ä¹ HagiCode æ¬èº«ä¹å¼å¾å³æ³¨ä¸ä¸ã</p>
<p><strong>æ³äºè§£æ´å¤ï¼</strong></p>
<ul>
<li>GitHub: <a href="https://github.com/HagiCode-org/site" target="_blank" rel="noopener nofollow">github.com/HagiCode-org/site</a>ï¼æ± Starï¼</li>
<li>å®ç½: <a href="https://hagicode-org.github.io/site" target="_blank" rel="noopener nofollow">hagicode-org.github.io/site</a></li>
<li>è§é¢æ¼ç¤º: <a href="https://www.bilibili.com/video/BV1pirZBuEzq/" target="_blank" rel="noopener nofollow">www.bilibili.com/video/BV1pirZBuEzq/</a>ï¼30 åéå®ææ¼ç¤ºï¼</li>
<li>å®è£æå: <a href="https://hagicode-org.github.io/site/docs/installation/docker-compose" target="_blank" rel="noopener nofollow">hagicode-org.github.io/site/docs/installation/docker-compose</a></li>
<li>å¬æµå·²å¼å§ï¼ç°å¨å®è£å³å¯åä¸å¬æµ</li>
</ul>
<h2 id="åæ">åæ</h2>
<p>å½åé¡¹ç®å¤äº ACP åè®®éæçå³é®é¶æ®µï¼é¢ä¸´çä»¥ä¸å ä¸ªææ¯çç¹åæ¶æææï¼</p>
<h3 id="1-èªå®ä¹å®ç°çå±é">1. èªå®ä¹å®ç°çå±é</h3>
<p>åæç JSON-RPC å®ç°ä½äº <code>src/HagiCode.ClaudeHelper/AcpImp/</code>ï¼åå« <code>JsonRpcEndpoint</code> å <code>ClientSideConnection</code> ç­ç»ä»¶ãç»´æ¤è¿å¥èªå®ä¹ä»£ç ææ¬é«ï¼ä¸ç¼ºä¹æçåºçé«çº§åè½ï¼å¦è¿åº¦æ¥åãåæ¶æ¯æï¼ã</p>
<h3 id="2-streamjsonrpc-éæéç¢">2. StreamJsonRpc éæéç¢</h3>
<p>å¨å°è¯å°ç°æç <code>CallbackProxyTarget</code> æ¨¡å¼è¿ç§»å° StreamJsonRpc æ¶ï¼åç° <code>_rpc.AddLocalRpcTarget(target)</code> æ¹æ³æ æ³è¯å«éè¿ä»£çæ¨¡å¼åå»ºçç®æ ãå·ä½è¡¨ç°ä¸ºï¼StreamJsonRpc æ æ³èªå¨å°æ³åç±»å <code>T</code> çå±æ§æåä¸º RPC æ¹æ³åæ°ï¼å¯¼è´æå¡å¨ç«¯æ æ³æ­£ç¡®å¤çå®¢æ·ç«¯åèµ·çæ¹æ³è°ç¨ã</p>
<h3 id="3-æ¶æåå±æ··ä¹±">3. æ¶æåå±æ··ä¹±</h3>
<p>ç°æç <code>ClientSideConnection</code> æ··åäºä¼ è¾å±ï¼WebSocket/Stdioï¼ãåè®®å±ï¼JSON-RPCï¼åä¸å¡å±ï¼ACP Agent æ¥å£ï¼ï¼å¯¼è´èè´£ä¸æ¸ï¼ä¸å­å¨ <code>AcpAgentCallbackRpcAdapter</code> æ¹æ³ç»å®ç¼ºå¤±çé®é¢ã</p>
<h3 id="4-æ¥å¿ç¼ºå¤±">4. æ¥å¿ç¼ºå¤±</h3>
<p>WebSocket ä¼ è¾å±ç¼ºå°å¯¹åå§ JSON åå®¹çæ¥å¿è¾åºï¼å¯¼è´å¨è°è¯ RPC éä¿¡é®é¢æ¶é¾ä»¥å®ä½æ¯åºååé®é¢è¿æ¯ç½ç»é®é¢ã</p>
<h2 id="è§£å³">è§£å³</h2>
<p>éå¯¹ä¸è¿°é®é¢ï¼æä»¬éç¨äºä»¥ä¸ç³»ç»åçè§£å³æ¹æ¡ï¼ä»æ¶æéæãåºéæåè°è¯å¢å¼ºä¸ä¸ªç»´åº¦è¿è¡ä¼åï¼</p>
<h3 id="1-å¨é¢è¿ç§»è³-streamjsonrpc">1. å¨é¢è¿ç§»è³ StreamJsonRpc</h3>
<h4 id="ç§»é¤æ§ä»£ç ">ç§»é¤æ§ä»£ç </h4>
<p>å é¤ <code>JsonRpcEndpoint.cs</code>ã<code>AgentSideConnection.cs</code> åç¸å³çèªå®ä¹åºååè½¬æ¢å¨ï¼<code>JsonRpcMessageJsonConverter</code> ç­ï¼ã</p>
<h4 id="éæå®æ¹åº">éæå®æ¹åº</h4>
<p>å¼å¥ <code>StreamJsonRpc</code> NuGet åï¼å©ç¨å¶ <code>JsonRpc</code> ç±»å¤çæ ¸å¿éä¿¡é»è¾ã</p>
<h4 id="æ½è±¡ä¼ è¾å±">æ½è±¡ä¼ è¾å±</h4>
<p>å®ä¹ <code>IAcpTransport</code> æ¥å£ï¼ç»ä¸å¤ç <code>WebSocket</code> å <code>Stdio</code> ä¸¤ç§ä¼ è¾æ¨¡å¼ï¼ç¡®ä¿åè®®å±ä¸ä¼ è¾å±è§£è¦ã</p>
<pre><code class="language-csharp">// IAcpTransport æ¥å£å®ä¹
public interface IAcpTransport
{
    Task SendAsync(string message, CancellationToken cancellationToken = default);
    Task&lt;string&gt; ReceiveAsync(CancellationToken cancellationToken = default);
    Task CloseAsync(CancellationToken cancellationToken = default);
}

// WebSocket ä¼ è¾å®ç°
public class WebSocketTransport : IAcpTransport
{
    private readonly WebSocket _webSocket;

    public WebSocketTransport(WebSocket webSocket)
    {
        _webSocket = webSocket;
    }

    // å®ç°åéåæ¥æ¶æ¹æ³
    // ...
}

// Stdio ä¼ è¾å®ç°
public class StdioTransport : IAcpTransport
{
    private readonly StreamReader _reader;
    private readonly StreamWriter _writer;

    public StdioTransport(StreamReader reader, StreamWriter writer)
    {
        _reader = reader;
        _writer = writer;
    }

    // å®ç°åéåæ¥æ¶æ¹æ³
    // ...
}
</code></pre>
<h3 id="2-ä¿®å¤ä»£çç®æ è¯å«é®é¢">2. ä¿®å¤ä»£çç®æ è¯å«é®é¢</h3>
<h4 id="åæ-callbackproxytarget">åæ <code>CallbackProxyTarget</code></h4>
<p>æ£æ¥ç°æçå¨æä»£ççæé»è¾ï¼ç¡®å® StreamJsonRpc æ æ³è¯å«çæ ¹æ¬åå ï¼éå¸¸æ¯å ä¸ºä»£çå¯¹è±¡æ²¡æå¬å¼å®éçæ¹æ³ç­¾åï¼æèä½¿ç¨äº StreamJsonRpc ä¸æ¯æçåæ°ç±»åï¼ã</p>
<h4 id="éæåæ°ä¼ é">éæåæ°ä¼ é</h4>
<p>å°æ³åå±æ§æåä¸ºæç¡®ç RPC æ¹æ³åæ°ãä¸åä¾èµå¨æå±æ§ï¼èæ¯å®ä¹å·ä½ç Request/Response DTOï¼æ°æ®ä¼ è¾å¯¹è±¡ï¼ï¼ç¡®ä¿ StreamJsonRpc è½éè¿åå°æ­£ç¡®è¯å«æ¹æ³ç­¾åã</p>
<pre><code class="language-csharp">// åæçæ³åå±æ§æ¹å¼
public class CallbackProxyTarget&lt;T&gt;
{
    public Func&lt;T, Task&gt; Callback { get; set; }
}

// éæåçå·ä½æ¹æ³æ¹å¼
public class ReadTextFileRequest
{
    public string FilePath { get; set; }
}

public class ReadTextFileResponse
{
    public string Content { get; set; }
}

public interface IAcpAgentCallback
{
    Task&lt;ReadTextFileResponse&gt; ReadTextFileAsync(ReadTextFileRequest request);
    // å¶ä»æ¹æ³...
}
</code></pre>
<h4 id="ä½¿ç¨-attach-æ¿ä»£-addlocalrpctarget">ä½¿ç¨ <code>Attach</code> æ¿ä»£ <code>AddLocalRpcTarget</code></h4>
<p>å¨æäºå¤æåºæ¯ä¸ï¼æå¨ä»£ç <code>JsonRpc</code> å¯¹è±¡å¹¶å¤ç <code>RpcConnection</code> å¯è½æ¯ç´æ¥æ·»å ç®æ æ´çµæ´»ã</p>
<h3 id="3-å®ç°æ¹æ³ç»å®ä¸æ¥å¿å¢å¼º">3. å®ç°æ¹æ³ç»å®ä¸æ¥å¿å¢å¼º</h3>
<h4 id="å®ç°-acpagentcallbackrpcadapter">å®ç° <code>AcpAgentCallbackRpcAdapter</code></h4>
<p>ç¡®ä¿è¯¥ç»ä»¶æ¾å¼å®ç° StreamJsonRpc çä»£çæ¥å£ï¼å° ACP åè®®å®ä¹çæ¹æ³ï¼å¦ <code>ReadTextFileAsync</code>ï¼æ å°å° StreamJsonRpc çåè°å¤çå¨ä¸ã</p>
<h4 id="éææ¥å¿è®°å½">éææ¥å¿è®°å½</h4>
<p>å¨ WebSocket æ Stdio çæ¶æ¯å¤çç®¡éä¸­ï¼æ¦æªå¹¶è®°å½ JSON-RPC è¯·æ±åååºçåå§ææ¬ãå©ç¨ <code>ILogger</code> å¨è§£æåååºåååè¾åºåå§ payloadï¼ä»¥ä¾¿ææ¥æ ¼å¼éè¯¯ã</p>
<pre><code class="language-csharp">// æ¥å¿å¢å¼ºçä¼ è¾åè£å¨
public class LoggingAcpTransport : IAcpTransport
{
    private readonly IAcpTransport _innerTransport;
    private readonly ILogger&lt;LoggingAcpTransport&gt; _logger;

    public LoggingAcpTransport(IAcpTransport innerTransport, ILogger&lt;LoggingAcpTransport&gt; logger)
    {
        _innerTransport = innerTransport;
        _logger = logger;
    }

    public async Task SendAsync(string message, CancellationToken cancellationToken = default)
    {
        _logger.LogTrace("Sending message: {Message}", message);
        await _innerTransport.SendAsync(message, cancellationToken);
    }

    public async Task&lt;string&gt; ReceiveAsync(CancellationToken cancellationToken = default)
    {
        var message = await _innerTransport.ReceiveAsync(cancellationToken);
        _logger.LogTrace("Received message: {Message}", message);
        return message;
    }

    public async Task CloseAsync(CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Closing connection");
        await _innerTransport.CloseAsync(cancellationToken);
    }
}
</code></pre>
<h3 id="4-æ¶æåå±éæ">4. æ¶æåå±éæ</h3>
<h4 id="ä¼ è¾å±-acprpcclient">ä¼ è¾å± (<code>AcpRpcClient</code>)</h4>
<p>å°è£ StreamJsonRpc è¿æ¥ï¼è´è´£ <code>InvokeAsync</code> åè¿æ¥çå½å¨æç®¡çã</p>
<pre><code class="language-csharp">public class AcpRpcClient : IDisposable
{
    private readonly JsonRpc _rpc;
    private readonly IAcpTransport _transport;

    public AcpRpcClient(IAcpTransport transport)
    {
        _transport = transport;
        _rpc = new JsonRpc(new StreamRpcTransport(transport));
        _rpc.StartListening();
    }

    public async Task&lt;TResponse&gt; InvokeAsync&lt;TResponse&gt;(string methodName, object parameters)
    {
        return await _rpc.InvokeAsync&lt;TResponse&gt;(methodName, parameters);
    }

    public void Dispose()
    {
        _rpc.Dispose();
        _transport.Dispose();
    }

    // StreamRpcTransport æ¯å¯¹ IAcpTransport ç StreamJsonRpc ééå¨
    private class StreamRpcTransport : IDuplexPipe
    {
        // å®ç° IDuplexPipe æ¥å£
        // ...
    }
}
</code></pre>
<h4 id="åè®®å±-iacpagentclient--iacpagentcallback">åè®®å± (<code>IAcpAgentClient</code> / <code>IAcpAgentCallback</code>)</h4>
<p>å®ä¹æ¸æ°ç client-to-agent å agent-to-client æ¥å£ï¼ç§»é¤ <code>Func&lt;IAcpAgent, IAcpClient&gt;</code> è¿ç§å¾ªç¯ä¾èµçå·¥åæ¨¡å¼ï¼æ¹ç¨ä¾èµæ³¨å¥æç´æ¥æ³¨ååè°ã</p>
<h2 id="å®è·µ">å®è·µ</h2>
<p>åºäº StreamJsonRpc çæä½³å®è·µåé¡¹ç®ç»éªï¼ä»¥ä¸æ¯å®æ½è¿ç¨ä¸­çå³é®å»ºè®®ï¼</p>
<h3 id="1-å¼ºç±»å-dto-ä¼äºå¨æå¯¹è±¡">1. å¼ºç±»å DTO ä¼äºå¨æå¯¹è±¡</h3>
<p>StreamJsonRpc çæ ¸å¿ä¼å¿å¨äºå¼ºç±»åãä¸è¦ä½¿ç¨ <code>dynamic</code> æ <code>JObject</code> ä¼ éåæ°ãåºä¸ºæ¯ä¸ª RPC æ¹æ³å®ä¹æç¡®ç C# POCO ç±»ä½ä¸ºåæ°ãè¿ä¸ä»è§£å³äºä»£çç®æ è¯å«é®é¢ï¼è¿è½å¨ç¼è¯æ¶åç°ç±»åéè¯¯ã</p>
<p>ç¤ºä¾ï¼å° <code>CallbackProxyTarget</code> ä¸­çæ³åå±æ§æ¿æ¢ä¸º <code>ReadTextFileRequest</code> å <code>WriteTextFileRequest</code> ç­å·ä½ç±»ã</p>
<h3 id="2-æ¾å¼å£°æ-method-name">2. æ¾å¼å£°æ Method Name</h3>
<p>ä½¿ç¨ <code>[JsonRpcMethod]</code> ç¹æ§æ¾å¼æå® RPC æ¹æ³åç§°ï¼ä¸è¦ä¾èµé»è®¤çæ¹æ³åæ å°ãè¿å¯ä»¥é²æ­¢å å½åé£æ ¼å·®å¼ï¼å¦ PascalCase vs camelCaseï¼å¯¼è´çè°ç¨å¤±è´¥ã</p>
<pre><code class="language-csharp">public interface IAcpAgentCallback
{
    [JsonRpcMethod("readTextFile")]
    Task&lt;ReadTextFileResponse&gt; ReadTextFileAsync(ReadTextFileRequest request);
    
    [JsonRpcMethod("writeTextFile")]
    Task WriteTextFileAsync(WriteTextFileRequest request);
}
</code></pre>
<h3 id="3-å©ç¨è¿æ¥ç¶æåè°">3. å©ç¨è¿æ¥ç¶æåè°</h3>
<p>StreamJsonRpc æä¾äº <code>JsonRpc.ConnectionLost</code> äºä»¶ãå¡å¿çå¬æ­¤äºä»¶ä»¥å¤çè¿ç¨æå¤éåºæç½ç»æ­å¼çæåµï¼è¿æ¯åçº¯ä¾èµ Orleans ç Grain å¤±ææ£æµæ´åæ¶ã</p>
<pre><code class="language-csharp">_rpc.ConnectionLost += (sender, e) =&gt;
{
    _logger.LogError("RPC connection lost: {Reason}", e.ToString());
    // å¤çéè¿é»è¾æéç¥ç¨æ·
};
</code></pre>
<h3 id="4-æ¥å¿åå±è®°å½">4. æ¥å¿åå±è®°å½</h3>
<ul>
<li><strong>Trace çº§å«</strong>ï¼è®°å½å®æ´ç JSON Request/Response åæã</li>
<li><strong>Debug çº§å«</strong>ï¼è®°å½æ¹æ³è°ç¨æ ååæ°æè¦ã</li>
<li><strong>æ³¨æ</strong>ï¼ç¡®ä¿æ¥å¿ä¸­ä¸åå«ææç Authorization Token æå¤§æä»¶åå®¹ç Base64 ç¼ç ã</li>
</ul>
<h3 id="5-å¤çæµå¼ä¼ è¾çç¹æ®æ§">5. å¤çæµå¼ä¼ è¾çç¹æ®æ§</h3>
<p>StreamJsonRpc åçæ¯æ <code>IAsyncEnumerable</code>ãå¨å®ç° ACP çæµå¼ Prompt ååºæ¶ï¼åºç´æ¥ä½¿ç¨ <code>IAsyncEnumerable</code> èä¸æ¯èªå®ä¹çåé¡µé»è¾ãè¿è½æå¤§ç®åæµå¼å¤ççä»£ç éã</p>
<pre><code class="language-csharp">public interface IAcpAgentCallback
{
    [JsonRpcMethod("streamText")]
    IAsyncEnumerable&lt;string&gt; StreamTextAsync(StreamTextRequest request);
}
</code></pre>
<h3 id="6-ééå¨æ¨¡å¼-adapter-pattern">6. ééå¨æ¨¡å¼ (Adapter Pattern)</h3>
<p>ä¿æ <code>ACPSession</code> å <code>ClientSideConnection</code> çåç¦»ã<code>ACPSession</code> åºä¸æ³¨äº Orleans çç¶æç®¡çåä¸å¡é»è¾ï¼å¦æ¶æ¯å¥éï¼ï¼éè¿ç»åèéç»§æ¿çæ¹å¼ä½¿ç¨ StreamJsonRpc è¿æ¥å¯¹è±¡ã</p>
<h2 id="æ»ç»">æ»ç»</h2>
<p>éè¿å¨é¢éæ StreamJsonRpcï¼HagiCode é¡¹ç®æåè§£å³äºåèªå®ä¹å®ç°çç»´æ¤ææ¬é«ãåè½å±éæ§åæ¶æåå±æ··ä¹±ç­é®é¢ãå³é®æ¹è¿åæ¬ï¼</p>
<ol>
<li>éç¨å¼ºç±»å DTO æ¿ä»£å¨æå±æ§ï¼æé«äºä»£ç çå¯ç»´æ¤æ§åå¯é æ§</li>
<li>å®ç°äºä¼ è¾å±æ½è±¡ååè®®å±åç¦»ï¼æåäºæ¶æçæ¸æ°æ§</li>
<li>å¢å¼ºäºæ¥å¿è®°å½åè½ï¼ä¾¿äºææ¥éä¿¡é®é¢</li>
<li>å¼å¥äºæµå¼ä¼ è¾æ¯æï¼ç®åäºæµå¼å¤ççå®ç°</li>
</ol>
<p>è¿äºæ¹è¿ä¸º HagiCode æä¾äºæ´ç¨³å®ãæ´é«æçéä¿¡åºç¡ï¼ä½¿å¶è½å¤æ´å¥½å°ä¸å¤é¨ AI å·¥å·è¿è¡äº¤äºï¼å¹¶ä¸ºæªæ¥çåè½æ©å±å¥ å®äºåå®çåºç¡ã</p>
<h2 id="åèèµæ">åèèµæ</h2>
<ul>
<li>StreamJsonRpc å®æ¹ææ¡£ï¼<a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.visualstudio.threading.streamjsonrpc" target="_blank" rel="noopener nofollow">https://learn.microsoft.com/en-us/dotnet/api/microsoft.visualstudio.threading.streamjsonrpc</a></li>
<li>ACP (Agent Communication Protocol) è§èï¼<a href="https://github.com/microsoft/agentcommunicationprotocol" target="_blank" rel="noopener nofollow">https://github.com/microsoft/agentcommunicationprotocol</a></li>
<li>HagiCode é¡¹ç®ï¼<a href="https://github.com/HagiCode-org/site" target="_blank" rel="noopener nofollow">https://github.com/HagiCode-org/site</a></li>
<li>Orleans å®æ¹ææ¡£ï¼<a href="https://learn.microsoft.com/en-us/dotnet/orleans" target="_blank" rel="noopener nofollow">https://learn.microsoft.com/en-us/dotnet/orleans</a></li>
</ul>
<hr>
<p>å¦ææ¬æå¯¹ä½ æå¸®å©ï¼</p>
<ul>
<li>ç¹ä¸ªèµè®©æ´å¤äººçå°</li>
<li>æ¥ GitHub ç»ä¸ª Starï¼<a href="https://github.com/HagiCode-org/site" target="_blank" rel="noopener nofollow">github.com/HagiCode-org/site</a></li>
<li>è®¿é®å®ç½äºè§£æ´å¤ï¼<a href="https://hagicode-org.github.io/site" target="_blank" rel="noopener nofollow">hagicode-org.github.io/site</a></li>
<li>è§ç 30 åéå®ææ¼ç¤ºï¼<a href="https://www.bilibili.com/video/BV1pirZBuEzq/" target="_blank" rel="noopener nofollow">www.bilibili.com/video/BV1pirZBuEzq/</a></li>
<li>ä¸é®å®è£ä½éªï¼<a href="https://hagicode-org.github.io/site/docs/installation/docker-compose" target="_blank" rel="noopener nofollow">hagicode-org.github.io/site/docs/installation/docker-compose</a></li>
<li>å¬æµå·²å¼å§ï¼æ¬¢è¿å®è£ä½éª</li>
</ul>
<hr>
<p>æè°¢æ¨çéè¯»,å¦ææ¨è§å¾æ¬ææç¨,å¿«ç¹å»ä¸æ¹ç¹èµæé®ð,è®©æ´å¤çäººçå°æ¬æã</p>
<p>æ¬åå®¹éç¨äººå·¥æºè½è¾å©åä½,ç»æ¬äººå®¡æ ¸,ç¬¦åæ¬äººè§ç¹ä¸ç«åºã</p>
<ul>
<li><strong>æ¬æä½è:</strong> <a href="https://www.newbe.pro" target="_blank" rel="noopener nofollow">newbe36524</a></li>
<li><strong>æ¬æé¾æ¥:</strong> <a href="https://hagicode-org.github.io/site/blog/2026/01/28/-streamjsonrpc-integration-in-hagicode-" target="_blank" rel="noopener nofollow">https://hagicode-org.github.io/site/blog/2026/01/28/-streamjsonrpc-integration-in-hagicode-</a></li>
<li><strong>çæå£°æ:</strong> æ¬åå®¢æææç« é¤ç¹å«å£°æå¤,åéç¨ BY-NC-SA è®¸å¯åè®®ãè½¬è½½è¯·æ³¨æåºå¤!</li>
</ul>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-29 08:46">2026-01-29 08:46</span>&nbsp;
<a href="https://www.cnblogs.com/newbe36524">Newbe36524</a>&nbsp;
éè¯»(<span id="post_view_count">22</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19546448);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19546448', targetLink: 'https://www.cnblogs.com/newbe36524/p/19546448', title: 'StreamJsonRpc å¨ HagiCode ä¸­çæ·±åº¦éæä¸å®è·µ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ FastAPIæ¥å¿å®æï¼ä»è¸©åå°ä¼ééç½®ï¼è®©ä½ çåºç¨ä¼âè¯´è¯â ]]></title>
    <link>https://www.cnblogs.com/ymtianyu/p/19546427</link>
    <guid>3fd8c35754b330973641ec41c0acd2ba</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ymtianyu/p/19546427" title="åå¸äº 2026-01-29 08:36">
    <span role="heading" aria-level="2">FastAPIæ¥å¿å®æï¼ä»è¸©åå°ä¼ééç½®ï¼è®©ä½ çåºç¨ä¼âè¯´è¯â</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æåäº«FastAPIæ¥å¿çå®æéç½®ç»éªãä»åºç¡æ¦å¿µè®²èµ·ï¼æä¾å¯å¤ç¨çæ¥å¿éç½®ä»£ç ï¼è¯¦è§£å¦ä½è®¾ç½®å¤çº§å«ãåæä»¶ãé²è¦ççæ¥å¿ç³»ç»ãéç¹åæå¼æ­¥æ¥å¿é»å¡ãææä¿¡æ¯æ³é²ãæ¥å¿æä»¶è¨èç­å¸¸è§åç¹ï¼å¹¶ç»åºç»æåæ¥å¿ãè¯·æ±IDè¿½è¸ªç­è¿é¶ä¼åå»ºè®®ï¼å¸®å©å¼åèæå»ºæ¸æ°ãå¯é ãä¾¿äºææ¥é®é¢çåºç¨æ¥å¿ä½ç³»ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>ä½ çFastAPIæå¡è·å¾å¥½å¥½çï¼ç´å°æå¤©åæ¨ä¸¤ç¹ï¼å®çªç¶âèªé­âäºââæ²¡æå´©æºæ¥å¿ï¼æ²¡æéè¯¯è¿½è¸ªï¼åªæç¨æ·çæè¯åä½ çæ»¡å±é®å·ãð¯</p>
<p>å«é®ææä¹ç¥éçï¼è¿åæè¸©è¿ï¼èä¸<strong style="color: rgba(186, 55, 42, 1)">å¢ééè¶è¿60%çFastAPIåçº§é¨ç½²é½æ¾å ä¸ºæ¥å¿éç½®ä¸å½ï¼å¨æéææ¥æ¶æç</strong>ãä»å¤©ï¼å±å°±å¥½å¥½èèæ¥å¿è¿åäºï¼å®ä¸æ¯ä½ ä»£ç éå¯æå¯æ ç<code style="color: rgba(186, 55, 42, 1)">print</code>ï¼èæ¯ä½ å¨æ°å­ä¸çå®æçâè³ç®âã</p>
<div style="background-color: rgba(248, 249, 250, 1); padding: 15px; border-left: 4px solid rgba(52, 152, 219, 1); margin: 20px 0">
<p><strong>ð æ¬æè½å¸®ä½ ï¼</strong></p>
<div>
<p>ð¹ çè§£Pythonæ å<code style="color: rgba(186, 55, 42, 1)">logging</code>ä¸FastAPIçåä½åç</p>
<p>ð¹ å®æä¸ä»½å¼ç®±å³ç¨ãç»ææ¸æ°çæ¥å¿éç½®</p>
<p>ð¹ é¿å¼è¾åºæ··ä¹±ãæ§è½æç´¯ãæ¥å¿ä¸¢å¤±ç­ç»å¸å¤§å</p>
<p>ð¹ è·å¾è®©æ¥å¿çæ­£ä¸ºè¿ç»´åè°è¯æå¡çè¿é¶æè·¯</p>
</div>
</div>
<h2>ð¯ ç¬¬ä¸é¨åï¼å«ææ¥å¿å½âäºåçâââå®è¯¥æ¯ä½ çé»å£å­</h2>
<p>ååFastAPIé£ä¼å¿ï¼æä¹è§å¾æ¥å¿åï¼ä¸å°±æ¯<code style="color: rgba(186, 55, 42, 1)">print(âHere!")</code>çé«çº§çï¼ç´å°çº¿ä¸åºäºä¸ªè¯¡å¼çå¶åæ§400éè¯¯ï¼ç¿»éä»£ç ä¸æ æè·ï¼æå½»åºéæã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">æ¥å¿ç³»ç»çæ ¸å¿ä»·å¼ï¼æ¯å¨ä½ æ æ³âç°åºè°è¯âççäº§ç¯å¢éï¼è¿åäºæç°åºã</strong>å®å¾åè¯ä½ ï¼è°ï¼IP/ç¨æ·ï¼ãå¨ä»ä¹æ¶åãè¯·æ±äºä»ä¹ãåé¨ç»è¿äºåªäºæ­¥éª¤ãæç»ä¸ºä»ä¹å¤±è´¥ã</p>
<p>FastAPIæ¬èº«ä¸é è½®å­ï¼å®å®ç¾éæPythonæ åç<code style="color: rgba(186, 55, 42, 1)">logging</code>æ¨¡åãä½ çä»»å¡ï¼å°±æ¯ç¨å¥½è¿ä¸ªå¼ºå¤§çåçå·¥å·ï¼èä¸æ¯ä¸ä¸æ¦å¤´è¥¿ä¸æ£å­å°ä¹±æ<code style="color: rgba(186, 55, 42, 1)">print</code>ã</p>
<h2>ð§ ç¬¬äºé¨åï¼æ ¸å¿åæ­¥èµ°ï¼éç½®ä¸ä¸ªâä¼æèâçæ¥å¿ç³»ç»</h2>
<p>å¥½ï¼å±ä»¬åæ¥ææ¸æè·¯ãä¸ä¸ªå¥å£®çæ¥å¿éç½®ï¼éå¸¸å´ç»è¿åä¸ªé®é¢å±å¼ï¼</p>
<div>
<h3><strong>1. æ¥å¿è®°å°åªéï¼</strong> (Handlers)</h3>
<p><strong>- æ§å¶å°ï¼</strong>å¼åè°è¯çä¸ç¼ã</p>
<p><strong>- æä»¶ï¼</strong>é¿æä¿å­ï¼ä¾¿äºè¿½æº¯ãè¿é<strong style="color: rgba(186, 55, 42, 1)">åä¸å«å­¦æå½åå·æåªç¨åä¸ªæä»¶</strong>ï¼å¦åæä»¶ä½ç§¯çç¸ï¼æå¼é½è´¹å²ã</p>
<p><strong>- ç½ç»/ç¬¬ä¸æ¹æå¡ï¼</strong>å¦Logstash, Sentryï¼ç¨äºéä¸­å¼æ¥å¿ç®¡çã</p>
<h3><strong>2. è®°å½ä»ä¹çº§å«ï¼</strong> (Levels)</h3>
<p><span style="color: rgba(186, 55, 42, 1)"><strong>DEBUG &lt; INFO &lt; WARNING &lt; ERROR &lt; CRITICAL</strong></span>ãç®åè¯´ï¼<code style="color: rgba(186, 55, 42, 1)">INFO</code>è®°å½å¸¸è§æµç¨ï¼<code style="color: rgba(186, 55, 42, 1)">ERROR</code>è®°å½éè¯¯å¼å¸¸ãçäº§ç¯å¢éå¸¸ä»<code style="color: rgba(186, 55, 42, 1)">INFO</code>èµ·è®°ã</p>
<h3><strong>3. è®°å½æä»ä¹æ ¼å¼ï¼</strong> (Formatters)</h3>
<p>æ¶é´ãçº§å«ãæ¨¡åãè¡å·ãæ¶æ¯â¦â¦ä¸ä¸ªé½ä¸è½å°ãæ ¼å¼æ¸æ°ï¼æ¥èµ·æ¥æå¿«ã</p>
<h3><strong>4. åä¸ªæ¨¡åæä¹æ§å¶ï¼</strong> (Loggers)</h3>
<p>ä½ å¯ä»¥ç»FastAPIæ ¸å¿ãSQLAlchemyãä½ èªå·±çä¸å¡æ¨¡åè®¾ç½®ä¸åçè®°å½çº§å«åè¾åºç®çå°ï¼éå¸¸çµæ´»ã</p>
</div>
<h2>ð ç¬¬ä¸é¨åï¼å®æï¼ç»ä½ ä¸ä»½è½ç´æ¥âæä½ä¸âçéç½®</h2>
<p>æ¥ä¸æ¥éç¹æ¥äºï¼ä¸ä»£ç ãæå°ä¸ä¸ªé¡¹ç®ä¸­çç²¾åéç½®æè§£ç»ä½ çãæå®æ¾å¨ä½ çéç½®æä»¶ï¼å¦<code style="color: rgba(186, 55, 42, 1)">log_config.py</code>ï¼éã</p>
<pre class="language-python highlighter-hljs"><code>import logging
import logging.handlers
from pathlib import Path

# 1. åå»ºlogsç®å½
LOG_DIR = Path(__file__).parent.parent / "logs"
LOG_DIR.mkdir(exist_ok=True)

# 2. å®ä¹æ ¼å¼
DETAIL_FORMAT = '%(asctime)s - %(name)s - %(levelname)s - %(filename)s:%(lineno)d - %(message)s'
SIMPLE_FORMAT = '%(asctime)s - %(levelname)s - %(message)s'

# 3. éç½®Logger
def setup_logging():
    # æ ¹æ¥å¿è®°å½å¨
    logger = logging.getLogger()
    logger.setLevel(logging.INFO)  # å¨å±æä½çº§å«

    # æ¸é¤å¯è½å·²æçå¤çå¨ï¼é²æ­¢éå¤ï¼Jupyterç­ç¯å¢éè¦ï¼
    if logger.handlers:
        logger.handlers.clear()

    # ---- æ§å¶å°å¤çå¨ (å¼åæ¶ç) ----
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.DEBUG)  # æ§å¶å°å¯ä»¥çæ´ç»
    console_formatter = logging.Formatter(SIMPLE_FORMAT)
    console_handler.setFormatter(console_formatter)
    logger.addHandler(console_handler)

    # ---- æä»¶å¤çå¨ (æå¤©è½®è½¬ï¼é¿ååä¸ªæä»¶è¿å¤§) ----
    # è¿æ¯å³é®ï¼ç¨RotatingFileHandleræTimedRotatingFileHandler
    file_handler = logging.handlers.TimedRotatingFileHandler(
        filename=LOG_DIR / "app.log",
        when="midnight",  # æ¯å¤©åå¤è½®è½¬
        interval=1,
        backupCount=30,   # ä¿çæè¿30å¤©
        encoding="utf-8"
    )
    file_handler.setLevel(logging.INFO)
    file_formatter = logging.Formatter(DETAIL_FORMAT)  # æä»¶éè®°è¯¦ç»ç¹
    file_handler.setFormatter(file_formatter)
    logger.addHandler(file_handler)

    # ---- éè¯¯æ¥å¿åç¬æä»¶ ----
    error_file_handler = logging.handlers.RotatingFileHandler(
        filename=LOG_DIR / "error.log",
        maxBytes=10 * 1024 * 1024,  # 10MB
        backupCount=5,
        encoding="utf-8"
    )
    error_file_handler.setLevel(logging.ERROR)  # åªè®°å½ERRORåä»¥ä¸
    error_file_handler.setFormatter(logging.Formatter(DETAIL_FORMAT))
    logger.addHandler(error_file_handler)

    # 4. æ§å¶ç¬¬ä¸æ¹åºçæ¥å¿åªé³ï¼æ¯å¦uvicornè®¿é®æ¥å¿å¤ªåµï¼
    # å®æ¹ææ¡£è½ç¶æ²¡å¼ºè°ï¼ä½æ ¹æ®çº¿ä¸ç»éªï¼éå½è°æ´æ´æ¸å
    logging.getLogger("uvicorn.access").setLevel(logging.WARNING)
    # å¦æä½ ç¨äºSQLAlchemyï¼ä¹å¯ä»¥è¿æ ·æ§å¶SQLæ¥å¿
    # logging.getLogger("sqlalchemy.engine").setLevel(logging.WARNING)

    # æåï¼è®°å½ä¸æ¡æ¥å¿è¡¨ç¤ºéç½®å®æ
    logger.info("æ¥å¿ç³»ç»åå§åå®æï¼")

if __name__ == "__main__":
    setup_logging()    </code></pre>
<p>ç¶åï¼å¨ä½ çFastAPIåºç¨ä¸»æä»¶ï¼å¦<code style="color: rgba(186, 55, 42, 1)">main.py</code>ï¼å¼å¤´å¯¼å¥å¹¶è°ç¨ï¼</p>
<pre class="language-python highlighter-hljs"><code>from fastapi import FastAPI
import log_config
import logging

log_config.setup_logging()  # æååå§åï¼
app = FastAPI()

@app.get("/")
async def root():
    # å¨è§å¾éæå¿«å°è®°å½æ¥å¿å§
    log = logging.getLogger(__name__)  # æ¨èç¨`__name__`è·ålogger
    log.info("æäººè®¿é®äºæ ¹è·¯å¾ï¼")
    return {"message": "Hello World"}

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app=app)</code></pre>
<h2>â ï¸ ç¬¬åé¨åï¼å®¹æç¿»è½¦çç¹ &amp; è¿é¶æè</h2>
<h3><strong style="color: rgba(186, 55, 42, 1)">å1ï¼å¼æ­¥ä»£ç ä¸­çæ¥å¿é»å¡ã</strong></h3>
<p>æ å<code style="color: rgba(186, 55, 42, 1)">logging</code>æ¯åæ­¥çï¼å¦æå¨å¤§éå¼æ­¥ä»»å¡ä¸­ç¯çåæ¥å¿ï¼å¯è½ä¼ææ¢æ´ä½æ§è½ãå¯¹äºè¶é«å¹¶ååºæ¯ï¼èèä½¿ç¨å<code style="color: rgba(186, 55, 42, 1)">structlog</code>+å¼æ­¥å¤çå¨ï¼æèå°æ¥å¿åæ¾å¥åå­éåå¼æ­¥åå¥ã</p>
<h3><strong style="color: rgba(186, 55, 42, 1)">å2ï¼æ¥å¿æ ¼å¼åå«ææä¿¡æ¯ã</strong></h3>
<p>åä¸æ³¨æï¼ä¸è¦å¨æ¥å¿éè®°å½å¯ç ãå®æ´Tokenãèº«ä»½è¯å·ãå¯ä»¥å¨Formatteréåè¿æ»¤ï¼æèè¦å<code style="color: rgba(186, 55, 42, 1)">LogRecord</code>æ¥æ¸æ´æ°æ®ã</p>
<h3><strong style="color: rgba(186, 55, 42, 1)">å3ï¼è¿åº¦æ¥å¿å¯¼è´ç£ççç¸ã</strong></h3>
<p>ä¸å®è¦ç¨<code style="color: rgba(186, 55, 42, 1)">RotatingFileHandler</code>æ<code style="color: rgba(186, 55, 42, 1)">TimedRotatingFileHandler</code>ï¼å¹¶è®¾ç½®åçç<code style="color: rgba(186, 55, 42, 1)">maxBytes</code>å<code style="color: rgba(186, 55, 42, 1)">backupCount</code>ã</p>
<h3><strong>ð¯ è¿é¶ä¸ä¸ï¼</strong></h3>
<div>
<p>ð¹ <strong>ç»æåæ¥å¿ï¼</strong> å«ååªè¾åºçº¯ææ¬äºãè¾åºJSONæ ¼å¼ï¼æ¹ä¾¿åç»­ç¨ELKï¼Elasticsearch, Logstash, Kibanaï¼æLokiç­å·¥å·è¿è¡æ£ç´¢ååæãä¸æ¡å¥½çæ¥å¿åºè¯¥æ¯ä¸ä¸ªç»æåçæ°æ®å¯¹è±¡ã</p>
<p>ð¹ <strong>è¯·æ±IDè´¯ç©¿ï¼</strong> ä¸ºæ¯ä¸ª incoming request çæä¸ä¸ªå¯ä¸IDï¼å¹¶è®©å®åºç°å¨è¿ä¸ªè¯·æ±é¾è·¯çææç¸å³æ¥å¿éãè¿æ¯åå¸å¼ç³»ç»ææ¥é®é¢çâé»éçº¿ç´¢âãå¯ä»¥éè¿ä¸­é´ä»¶å®ç°ã</p>
<p>ð¹ <strong>ä¸çæ§åè­¦èå¨ï¼</strong> å½åºç°<code style="color: rgba(186, 55, 42, 1)">ERROR</code>ææ´é«çº§å«æ¥å¿æ¶ï¼èªå¨è§¦ååè­¦éç¥ï¼åç­ä¿¡ãåéé/ä¼å¾®ï¼ãè®©æ¥å¿ç³»ç»ä»âè®°å½ä»ªâåæâé¢è­¦æºâã</p>
</div>
<hr style="border: none; height: 1px; background: linear-gradient(90deg, rgba(0, 0, 0, 0), rgba(52, 152, 219, 1), rgba(0, 0, 0, 0)); margin: 40px 0">
<p>å¥½äºï¼å³äºFastAPIæ¥å¿çå®æå¿å¾ï¼å°±åèè¿ä¹å¤ãå·¥å·çéæ©ï¼å¥½æ¯éèºä¸åï¼ä¸æ¯æè´µçå°±å¥½ï¼èæ¯<strong style="color: rgba(186, 55, 42, 1)">æéåä½ å½åé¡¹ç®é¶æ®µåå¢éä¹ æ¯ç</strong>ãåä»ä¸ä»½æ¸æ°çéç½®å¼å§ï¼è®©ä½ ä»¬çåºç¨âä¼è¯´è¯âã</p>
<p>å¦æä½ å¨éç½®è¿ç¨ä¸­åéå°äºæ°çå¦å­½é®é¢ï¼æèææ´å¦çæ¥å¿å®è·µï¼æ¬¢è¿éæ¶æ¥èèãææ¯äººçæé¿ï¼ä¸å°±æ¯å¡«å®èªå·±çåï¼åççå«äººçåï¼æåä¸èµ·æè·¯éºå¹³åã</p>
<p>ä½ çæåä¸åç¨åºåªï¼ä¸æ¬¡è§â¦â¦</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-29 08:36">2026-01-29 08:36</span>&nbsp;
<a href="https://www.cnblogs.com/ymtianyu">ä¸åç¨åºåªå</a>&nbsp;
éè¯»(<span id="post_view_count">58</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19546427);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19546427', targetLink: 'https://www.cnblogs.com/ymtianyu/p/19546427', title: 'FastAPIæ¥å¿å®æï¼ä»è¸©åå°ä¼ééç½®ï¼è®©ä½ çåºç¨ä¼âè¯´è¯â' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä½¿ç¨ JYPPX.DeploySharp é«æé¨ç½² PaddleOCRï¼è§£éå¤ç§é«æ§è½ OCR æå­è¯å«æ¹æ¡ ]]></title>
    <link>https://www.cnblogs.com/guojin-blogs/p/19545866</link>
    <guid>92fe032adb971bc952ef8cb322ea01b1</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/guojin-blogs/p/19545866" title="åå¸äº 2026-01-28 22:40">
    <span role="heading" aria-level="2">ä½¿ç¨ JYPPX.DeploySharp é«æé¨ç½² PaddleOCRï¼è§£éå¤ç§é«æ§è½ OCR æå­è¯å«æ¹æ¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223946237-441095120.png" alt="ä½¿ç¨ JYPPX.DeploySharp é«æé¨ç½² PaddleOCRï¼è§£éå¤ç§é«æ§è½ OCR æå­è¯å«æ¹æ¡" class="desc_img">
        æ¬æä»ç»äºåºäºDeploySharpæ¡æ¶å¨.NETç¯å¢ä¸é¨ç½²PaddleOCRæ¨¡åçè§£å³æ¹æ¡ãè¯¥æ¡æ¶éè¿ç»ä¸æ¥å£å°è£äºOpenVINOãTensorRTãONNX Runtimeç­å¤ç§æ¨çå¼æï¼æ¯æç¾æ¯«ç§çº§æå­è¯å«ãæç« è¯¦ç»è§£æäºPaddleOCRä¸é¶æ®µå·¥ä½æµç¨ï¼æ£æµ-åç±»-è¯å«ï¼åæ§è½ä¼åç­ç¥ï¼éè¿°äºDeploySharp"ç»ä¸æ¥å£ãçµæ´»é¨ç½²"çæ¶æä¼å¿ãæ¼ç¤ºç¨åºæ¯æå¤ç§æ¨çåç«¯ï¼æ¶µçCPU/GPUä¸åç¡¬ä»¶åºæ¯ï¼æä¾æ¨¡åå è½½ãå¾çæ¨çãæ§è½æµè¯ç­åè½ãéè¿è¯¥æ¹æ¡ï¼å¼åèå¯æ ¹æ®å®éç¡¬ä»¶ç¯
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ä½¿ç¨-jyppxdeploysharp-é«æé¨ç½²-paddleocrè§£éå¤ç§é«æ§è½-ocr-æå­è¯å«æ¹æ¡">ä½¿ç¨ JYPPX.DeploySharp é«æé¨ç½² PaddleOCRï¼è§£éå¤ç§é«æ§è½ OCR æå­è¯å«æ¹æ¡</h1>
<blockquote>
<p>æ¬æä»ç»å¦ä½éè¿ DeploySharp æ¡æ¶å¨ .NET ç¯å¢ä¸é¨ç½² PaddleOCR æ¨¡åï¼æ¯æ OpenVINOãTensorRTãONNX Runtime ç­å¤ç§æ¨çå¼æï¼å®ç°ç¾æ¯«ç§çº§æå­è¯å«ã</p>
</blockquote>
<hr>
<h2 id="ç®å½">ç®å½</h2>
<ul>
<li><a href="#%E4%B8%80%E5%89%8D%E8%A8%80" rel="noopener nofollow">ä¸ãåè¨</a></li>
<li><a href="#%E4%BA%8C%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90" rel="noopener nofollow">äºãæ ¸å¿ææ¯åçè§£æ</a></li>
<li><a href="#%E4%B8%89deploysharp-%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8A%BF" rel="noopener nofollow">ä¸ãDeploySharp æ¶æä¼å¿</a></li>
<li><a href="#%E5%9B%9B%E6%94%AF%E6%8C%81%E7%9A%84%E6%8E%A8%E7%90%86%E8%AE%BE%E5%A4%87" rel="noopener nofollow">åãæ¯æçæ¨çè®¾å¤</a></li>
<li><a href="#%E4%BA%94%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B%E6%8C%87%E5%8D%97" rel="noopener nofollow">äºãå¿«éå¼å§æå</a></li>
<li><a href="#%E5%85%AD%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%B8%8E%E5%88%86%E6%9E%90" rel="noopener nofollow">å­ãæ§è½æµè¯ä¸åæ</a></li>
<li><a href="#%E4%B8%83%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94" rel="noopener nofollow">ä¸ãå¸¸è§é®é¢è§£ç­</a></li>
<li><a href="#%E5%85%AB%E8%BD%AF%E4%BB%B6%E8%8E%B7%E5%8F%96" rel="noopener nofollow">å«ãè½¯ä»¶è·å</a></li>
<li><a href="#%E4%B9%9D%E6%8A%80%E6%9C%AF%E6%94%AF%E6%8C%81" rel="noopener nofollow">ä¹ãææ¯æ¯æ</a></li>
</ul>
<hr>
<h2 id="ä¸åè¨">ä¸ãåè¨</h2>
<p>OCRï¼åå­¦å­ç¬¦è¯å«ï¼ææ¯å¨æ°å­ååå¬ãææ¡£ç®¡çãç¥¨æ®è¯å«ç­åºæ¯ä¸­åæ¥çéè¦ä½ç¨ãç¾åº¦é£æ¡¨å¼æºç <strong>PaddleOCR</strong> ä½ä¸ºä¸çé¢åç OCR æ¡æ¶ï¼ä»¥å¶ä¼å¼çè¯å«ç²¾åº¦åä¸°å¯çåè½ç¹æ§æ·±åå¼åèåç±ã</p>
<p>ä¸å¹´åï¼æåºäºèªå·±å¼åç OpenVINO C# API é¡¹ç®ï¼å¨ .NET æ¡æ¶ä¸ä½¿ç¨ OpenVINO é¨ç½²å·¥å·é¨ç½² PaddleOCR ç³»åæ¨¡åï¼æ¨åºäº <strong>PaddleOCR-OpenVINO-CSharp</strong> é¡¹ç®ãåå© OpenVINO å¨ CPU ä¸çå¼ºå¤§æ¨çä¼åè½åï¼è¯¥é¡¹ç®æåå®ç°äºå¨çº¯ CPU ç¯å¢ä¸å®æå¾çæå­è¯å«ãçé¢åæåè¡¨æ ¼è¯å«ç­åè½ï¼æ¨çéåº¦å¯æ§å¶å¨ 300 æ¯«ç§ä»¥åã</p>
<p>éçé¡¹ç®çåå±ååºç¨åºæ¯çå¤æ ·åï¼åä¸æ¨çå¼æå·²æ æ³æ»¡è¶³ææéæ±ãè¿æï¼æå° OpenVINOãTensorRTãONNX Runtime ç­ä¸»æµæ¨çå·¥å·è¿è¡äºç»ä¸å°è£ï¼æ¨åºäº <strong>DeploySharp</strong> å¼æºé¡¹ç®ãè¯¥é¡¹ç®çæ ¸å¿ä¼å¿å¨äºï¼</p>
<ul>
<li><strong>ç»ä¸æ¥å£</strong>ï¼éè¿åºå±æ¥å£æ½è±¡ï¼å®ç°ä¸å¥ä»£ç ééå¤ç§æ¨çå¼æ</li>
<li><strong>çµæ´»é¨ç½²</strong>ï¼å¼åèå¯æ ¹æ®å®éç¡¬ä»¶ç¯å¢éæ©æä¼æ¨çæ¹æ¡</li>
<li><strong>æ§è½ä¼å</strong>ï¼åååæ¥åæ¨çå¼æçç¡¬ä»¶å éè½å</li>
</ul>
<p>å¾çäº DeploySharp åºå±æ¥å£ç»ä¸çä¼å¿ï¼å¼åèç°å¨å¯ä»¥ç¨åä¸æ®µä»£ç å¨ OpenVINOãTensorRTãONNX Runtime ç­å¤ç§æ¨çå¼æé´èªç±åæ¢ãè¿æï¼æä»¬å®æäº PaddleOCR æ¨¡åçæ¯ææ´æ°ï¼ä¸º .NET å¼åèæä¾äºä¸å¥å®æ´ç OCR è§£å³æ¹æ¡ã</p>
<p>ç®åï¼PaddleOCR åè½å·²éæè³ DeploySharp å¼æºé¡¹ç®ä¸­ï¼ä»£ç å·²ä¸ä¼ è³ä»åºï¼NuGet åæ­£å¨ç­¹å¤ä¸­ï¼ãä¸ºäºè®©å¤§å®¶å¿«éä½éªæ°ç PaddleOCR çæè´æ§è½ï¼æä»¬ç¹å«åå¤äº <strong>JYPPX.DeploySharp.OpenCvSharp.PaddleOcr.TestDemo</strong> æ¼ç¤ºç¨åºï¼æ¯æå³å¼å³ç¨ï¼æ éå¤æéç½®ã</p>
<hr>
<h2 id="äºæ ¸å¿ææ¯åçè§£æ">äºãæ ¸å¿ææ¯åçè§£æ</h2>
<h3 id="21-paddleocr-å·¥ä½æµç¨">2.1 PaddleOCR å·¥ä½æµç¨</h3>
<p>PaddleOCR éç¨ç»å¸çãæ£æµ-åç±»-è¯å«ãä¸é¶æ®µæµæ°´çº¿æ¶æï¼</p>
<pre><code>è¾å¥å¾ç
    â
    â¼
âââââââââââââââ
â ææ¬æ£æµ     â â æ£æµå¾çä¸­çææ¬åºåä½ç½®
â (Detection) â
âââââââââââââââ
    â
    â¼
âââââââââââââââ
â ææ¬æ¹ååç±» â â å¤æ­ææ¬æ¹åï¼180åº¦ç¿»è½¬ç­ï¼
â (Classifier)â
âââââââââââââââ
    â
    â¼
âââââââââââââââ
â ææ¬è¯å«     â â è¯å«ææ¬åºåçå·ä½åå®¹
â (Recognition)â
âââââââââââââââ
    â
    â¼
è¾åºè¯å«ç»æ
</code></pre>
<h3 id="22-ä¸é¶æ®µæ¨¡åè¯¦è§£">2.2 ä¸é¶æ®µæ¨¡åè¯¦è§£</h3>
<table>
<thead>
<tr>
<th>é¶æ®µ</th>
<th>æ¨¡ååç§°</th>
<th>è¾å¥</th>
<th>è¾åº</th>
<th>ä½ç¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ£æµ</td>
<td>PP-OCRv5_det</td>
<td>åå§å¾ç (3xHxW)</td>
<td>ææ¬æ¡åæ </td>
<td>å®ä½ææ¬åºå</td>
</tr>
<tr>
<td>åç±»</td>
<td>PP-OCRv5_cls</td>
<td>è£åªææ¬æ¡ (3x80x160)</td>
<td>æ¹åæ ç­¾</td>
<td>çº æ­£ææ¬æ¹å</td>
</tr>
<tr>
<td>è¯å«</td>
<td>PP-OCRv5_rec</td>
<td>è£åªææ¬æ¡ (3x48xL)</td>
<td>ææ¬åå®¹</td>
<td>è¯å«å­ç¬¦åºå</td>
</tr>
</tbody>
</table>
<h3 id="23-æ§è½ä¼åç­ç¥">2.3 æ§è½ä¼åç­ç¥</h3>
<ol>
<li><strong>æ¨¡åéå</strong>ï¼ä½¿ç¨ int8 éååå°æ¨¡åä½ç§¯ï¼æåæ¨çéåº¦</li>
<li><strong>å¨ææ¹å¤ç</strong>ï¼æ¯æ Batch Size &gt; 1ï¼æé« GPU å©ç¨ç</li>
<li><strong>å¹¶åæ¨ç</strong>ï¼æ¯æå¤çº¿ç¨å¹¶åå¤çï¼ååå©ç¨å¤æ ¸æ§è½</li>
<li><strong>ç¡¬ä»¶å é</strong>ï¼éå¯¹ä¸åç¡¬ä»¶éæ©æä¼è®¡ç®åç«¯</li>
</ol>
<hr>
<h2 id="ä¸deploysharp-æ¶æä¼å¿">ä¸ãDeploySharp æ¶æä¼å¿</h2>
<p>DeploySharp çæ ¸å¿è®¾è®¡çå¿µæ¯ã<strong>ç»ä¸æ¥å£ï¼çµæ´»é¨ç½²</strong>ãï¼å¶æ¶æå¦ä¸å¾æç¤ºï¼</p>
<pre><code>âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ
â                    åºç¨å± (Application)                  â
â            PaddleOCR æå­è¯å« / å¶ä»æ¨¡ååºç¨              â
âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ
                            â
                            â¼
âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ
â                 DeploySharp æ½è±¡æ¥å£å±                    â
â  ç»ä¸çæ¨¡åå è½½ / æ¨çæ§è¡ / èµæºç®¡çæ¥å£                 â
âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ
                            â
            âââââââââââââââââ¼ââââââââââââââââ
            â¼               â¼               â¼
âââââââââââââââââ âââââââââââââââââ âââââââââââââââââ
â   OpenVINO    â â   TensorRT    â â ONNX Runtime  â
â   Engine      â â   Engine      â â    Engine     â
â  (CPU ä¼å)   â â (GPU å é)    â â (è·¨å¹³å°æ¯æ)   â
âââââââââââââââââ âââââââââââââââââ âââââââââââââââââ
            â               â               â
            â¼               â¼               â¼
âââââââââââââââââ âââââââââââââââââ âââââââââââââââââ
â  Intel CPU    â â  NVIDIA GPU   â â å¤ç§ç¡¬ä»¶è®¾å¤   â
â               â â               â â (CPU/GPU/DML) â
âââââââââââââââââ âââââââââââââââââ âââââââââââââââââ
</code></pre>
<p><strong>ä¸»è¦ä¼å¿ï¼</strong></p>
<ul>
<li><strong>é¶ä»£ç åæ¢</strong>ï¼æ´æ¢æ¨çå¼ææ éä¿®æ¹ä¸å¡ä»£ç </li>
<li><strong>èµæºé«æå©ç¨</strong>ï¼èªå¨ç®¡çæ¨¡åçå½å¨æåè®¡ç®èµæº</li>
<li><strong>æ©å±æ§å¼º</strong>ï¼æäºæ·»å æ°çæ¨çå¼ææ¯æ</li>
<li><strong>çäº§å°±ç»ª</strong>ï¼ç»è¿ååæµè¯ï¼å¯ç´æ¥ç¨äºçäº§ç¯å¢</li>
</ul>
<hr>
<h2 id="åæ¯æçæ¨çè®¾å¤">åãæ¯æçæ¨çè®¾å¤</h2>
<p>æ¬æ¼ç¤ºç¨åºæ¯æå¤ç§ä¸»æµæ¨çåç«¯ï¼è¦çä»å¥é¨çº§è®¾å¤å°é«æ§è½æå¡å¨çåç§åºæ¯ï¼</p>
<table>
<thead>
<tr>
<th>æ¨çå¼æ</th>
<th>æ¯æè®¾å¤</th>
<th>éç¨åºæ¯</th>
<th>æ§è½ç¹ç¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>OpenVINO</strong></td>
<td>CPU</td>
<td>æ  GPU ç¯å¢ãIntel å¤çå¨</td>
<td>CPU ä¼åï¼å¯å¨å¿«ï¼ç¨³å®</td>
</tr>
<tr>
<td><strong>TensorRT</strong></td>
<td>CUDA 11/12</td>
<td>NVIDIA GPU é«æ§è½åºæ¯</td>
<td>GPU å éï¼æè´æ§è½ï¼éæ¨¡åè½¬æ¢</td>
</tr>
<tr>
<td><strong>ONNX Runtime CPU</strong></td>
<td>CPU</td>
<td>è·¨å¹³å°é¨ç½²</td>
<td>éç¨æ§å¼ºï¼æ§è½ä¸­ç­</td>
</tr>
<tr>
<td><strong>ONNX Runtime CUDA</strong></td>
<td>CUDA 12</td>
<td>NVIDIA GPU ç¯å¢é¨ç½²</td>
<td>GPU å éï¼å¼ç®±å³ç¨</td>
</tr>
<tr>
<td><strong>ONNX Runtime TensorRT</strong></td>
<td>CUDA 12</td>
<td>NVIDIA GPU é«æ§è½åºæ¯</td>
<td>GPU å é + TensorRT ä¼å</td>
</tr>
<tr>
<td><strong>ONNX Runtime DML</strong></td>
<td>DML GPU</td>
<td>Windows å¹³å°å¤åå GPU</td>
<td>æ¯æ AMD/NVIDIA/Intel GPU</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>æ§è½æç¤º</strong>ï¼é¦æ¬¡å è½½æ¨¡ååæ¨çæ¶ä¼è¾æ¢ï¼è¿æ¯æ­£å¸¸ç°è±¡ï¼æ¨¡ååå§åå JIT ç¼è¯ï¼ãé¦æ¬¡è¿è¡æ¶è¯·é¿åé¢ç¹æä½ï¼å¾æ¨¡åé¢ç­å®æåæ§è½å°æ¾èæåã</p>
</blockquote>
<hr>
<h2 id="äºå¿«éå¼å§æå">äºãå¿«éå¼å§æå</h2>
<h3 id="51-ç¨åºçé¢æ¦è§">5.1 ç¨åºçé¢æ¦è§</h3>
<p>è¿è¡ç¨åºåï¼ä¸»çé¢å¦ä¸å¾æç¤ºï¼</p>
<img alt="image-20260128211529014" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813653-1755028179.png" class="lazyload">
<p><strong>æ ¸å¿æä½è¯´æï¼</strong></p>
<table>
<thead>
<tr>
<th>æä½é¡¹</th>
<th>è¯´æ</th>
<th>æ³¨æäºé¡¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¨çåç«¯</td>
<td>éæ©ä½¿ç¨çæ¨çå¼æ</td>
<td>åæ¢åééæ°å è½½æ¨¡å</td>
</tr>
<tr>
<td>æ¨¡åè·¯å¾</td>
<td>é¢ç½®æ¨¡åè·¯å¾ï¼ä¸è¬æ éä¿®æ¹</td>
<td>æ¯æèªå®ä¹æ¨¡åè·¯å¾</td>
</tr>
<tr>
<td>å¾åè·¯å¾</td>
<td>éæ©å¾è¯å«çå¾ç</td>
<td>æ¯æ JPG/PNG/BMP ç­æ ¼å¼</td>
</tr>
<tr>
<td>å è½½æ¨¡å</td>
<td>å è½½æå®æ¨¡åå°åå­</td>
<td>é¦æ¬¡ä½¿ç¨å¿é¡»æ§è¡</td>
</tr>
<tr>
<td>æ¨çå¾ç</td>
<td>æ§è¡åæ¬¡å¾çè¯å«</td>
<td>é¦æ¬¡éé¢ç­</td>
</tr>
<tr>
<td>æ¶é´æµè¯</td>
<td>è¿ç»­æ¨çåæ¬¡å¹¶ç»è®¡å¹³åèæ¶</td>
<td>ç¨äºæ§è½è¯ä¼°</td>
</tr>
<tr>
<td>å¹¶åæ°é</td>
<td>è°æ´æ¨çå¹¶åçº¿ç¨æ°</td>
<td>ä¿®æ¹åééæ°å è½½æ¨¡å</td>
</tr>
<tr>
<td>BatchSize</td>
<td>æ¹éå¤çå¤§å°</td>
<td>å¯å¨æè°æ´</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="52-openvino-æ¨ç">5.2 OpenVINO æ¨ç</h3>
<p>OpenVINO æ¯ Intel æ¨åºçå¼æºå·¥å·å¥ä»¶ï¼éå¯¹ CPU åIntel IGPUè¿è¡äºæ·±åº¦ä¼åï¼ç¹å«éåæ  GPU ç¯å¢ä¸çé«æ§è½æ¨çã</p>
<p><strong>CPUä½¿ç¨æ­¥éª¤ï¼</strong></p>
<p>1.è¿è¡ç¨åº</p>
<p><img alt="ç¨åºä¸»çé¢" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813669-2069610707.png" class="lazyload"></p>
<p>2.å¨ãæ¨çåç«¯ãä¸ææ¡ä¸­éæ© <strong>OpenVINO</strong></p>
<p>3.ç¹å»ãå è½½æ¨¡åã</p>
<p>4.ç¹å»ãæ¨çå¾çãå¼å§è¯å«</p>
<img alt="image-20260128221119962" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813694-1191031576.png" class="lazyload">
<p><strong>IGPUä½¿ç¨æ­¥éª¤ï¼</strong></p>
<p>è±ç¹å°éæ¾ä½¿ç¨æµç¨ä¸ä¸è¿°ä¸è´ï¼ä¸»è¦æ¯è®¾å¤è¦éæ©<strong>GPU0</strong>ï¼</p>
<img alt="image-20260128221345165" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813653-923590906.png" class="lazyload">
<p><strong>æ··åè®¾å¤ä½¿ç¨æ­¥éª¤ï¼</strong></p>
<p>è±ç¹å°OpenVINOæ¯æCPU+IGPUæ··åè®¾å¤æ¨çï¼å³<strong>AUTO</strong>æ¨¡å¼ï¼OpenVINOä¼æ ¹æ®è®¾å¤æåµèªä¸»éæ©ï¼ä½¿ç¨æ¹å¼ä¸ä¸è¿°ä¸è´ï¼ä¸»è¦æ¯è®¾å¤è¦éæ©<strong>AUTO</strong>ï¼</p>
<img alt="image-20260128221535531" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813665-1585718457.png" class="lazyload">
<p><strong>éç¨åºæ¯ï¼</strong></p>
<ul>
<li>æå¡å¨ç¯å¢é¨ç½²</li>
<li>ä½åèè®¾å¤</li>
<li>Intel CPU ç¨æ·</li>
<li>å¯¹å¯å¨éåº¦è¦æ±é«çåºæ¯</li>
</ul>
<hr>
<h3 id="53-onnx-runtime-cpu-æ¨ç">5.3 ONNX Runtime CPU æ¨ç</h3>
<p>ONNX Runtime æ¯å¾®è½¯æ¨åºçè·¨å¹³å°æ¨çå¼æï¼æ¯æå¤ç§ç¡¬ä»¶å éåç«¯ï¼CPU æ¨¡å¼æ éä»»ä½ä¾èµå³å¯ä½¿ç¨ã</p>
<p><strong>ä½¿ç¨æ­¥éª¤ï¼</strong></p>
<ol>
<li>è¿è¡ç¨åº</li>
<li>å¨ãæ¨çåç«¯ãä¸ææ¡ä¸­éæ© <strong>ONNX Runtime CPU</strong></li>
<li>ç¹å»ãå è½½æ¨¡åã</li>
<li>ç¹å»ãæ¨çå¾çãå¼å§è¯å«</li>
</ol>
<p><img alt="ONNX Runtime CPU éæ©çé¢" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813644-1843775817.png" class="lazyload"></p>
<p><strong>éç¨åºæ¯ï¼</strong></p>
<ul>
<li>è·¨å¹³å°é¨ç½²éæ±</li>
<li>æ  GPU å éç¯å¢</li>
<li>éè¦å¿«éååéªè¯</li>
</ul>
<hr>
<h3 id="54-onnx-runtime-cuda-æ¨ç">5.4 ONNX Runtime CUDA æ¨ç</h3>
<p>CUDA æ¯ NVIDIA æä¾çå¹¶è¡è®¡ç®å¹³å°ï¼å¯ååå©ç¨ GPU çå¹¶è¡è®¡ç®è½åå®ç°æ¾èå éã</p>
<h4 id="éç½®æ­¥éª¤">éç½®æ­¥éª¤</h4>
<ol>
<li>
<p><strong>å®è£ CUDA é©±å¨</strong></p>
<ul>
<li>è®¿é® <a href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="noopener nofollow">NVIDIA CUDA å®ç½</a></li>
<li>ä¸è½½å¹¶å®è£ CUDA 12.x çæ¬ï¼æµè¯ç¯å¢ï¼CUDA 12.3ï¼</li>
</ul>
</li>
<li>
<p><strong>å¤å¶ä¾èµæä»¶</strong></p>
<p>å°ä»¥ä¸ CUDA ç¸å³ DLL æä»¶å¤å¶å°ç¨åºè¿è¡ç®å½ï¼</p>
<p><img alt="CUDA ä¾èµæä»¶" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813683-448077110.png" class="lazyload"></p>
</li>
<li>
<p><strong>å¯å¨æ¨ç</strong></p>
<p>è¿è¡ç¨åºï¼å¨ãæ¨çåç«¯ãä¸ææ¡ä¸­éæ© <strong>ONNX Runtime CUDA</strong></p>
<p><img alt="ONNX Runtime CUDA éæ©çé¢" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813700-1885280932.png" class="lazyload"></p>
</li>
</ol>
<p><strong>ä¾èµè¯´æï¼</strong></p>
<table>
<thead>
<tr>
<th>NuGet åå</th>
<th>çæ¬</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microsoft.ML.OnnxRuntime.Gpu.Windows</td>
<td>1.23.0</td>
</tr>
<tr>
<td>Microsoft.ML.OnnxRuntime.Managed</td>
<td>1.23.0</td>
</tr>
</tbody>
</table>
<p><strong>éç¨åºæ¯ï¼</strong></p>
<ul>
<li>æ¥æ NVIDIA æ¾å¡çè®¾å¤</li>
<li>å¯¹æ¨çéåº¦æè¾é«è¦æ±</li>
<li>éè¦å¿«éé¨ç½²æ éæ¨¡åè½¬æ¢</li>
</ul>
<hr>
<h3 id="55-onnx-runtime-tensorrt-æ¨ç">5.5 ONNX Runtime TensorRT æ¨ç</h3>
<p>TensorRT æ¯ NVIDIA æ¨åºçé«æ§è½æ·±åº¦å­¦ä¹ æ¨çä¼åå¨ï¼ç»å CUDA å éå¯è¾¾å°æè´æ§è½ã</p>
<h4 id="éç½®æ­¥éª¤-1">éç½®æ­¥éª¤</h4>
<p>ä¾èµæä»¶å¤å¶æ¹å¼ä¸ CUDA æ¨¡å¼ä¸è´ã</p>
<h4 id="ä½¿ç¨æ­¥éª¤">ä½¿ç¨æ­¥éª¤</h4>
<ol>
<li>è¿è¡ç¨åº</li>
<li>å¨ãæ¨çåç«¯ãä¸ææ¡ä¸­éæ© <strong>ONNX Runtime TensorRT</strong></li>
<li>ç¹å»ãå è½½æ¨¡åã</li>
<li>ç¹å»ãæ¨çå¾çãå¼å§è¯å«</li>
</ol>
<p><img alt="ONNX Runtime TensorRT éæ©çé¢" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813627-173016715.png" class="lazyload"></p>
<blockquote>
<p><strong>éè¦æç¤º</strong>ï¼é¦æ¬¡è¿è¡æ¨çæ¶ï¼TensorRT ä¼èªå¨å¯¹ ONNX æ¨¡åè¿è¡ä¼åç¼è¯ï¼æ­¤è¿ç¨å¯è½éè¦æ°åéï¼è¯·èå¿ç­å¾ãç¼è¯åçå¼ææä»¶ä¼è¢«ç¼å­ï¼åç»­æ¨çéåº¦å°å¤§å¹æåã</p>
</blockquote>
<p><strong>ä¾èµè¯´æï¼</strong></p>
<table>
<thead>
<tr>
<th>NuGet åå</th>
<th>çæ¬</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microsoft.ML.OnnxRuntime.Gpu.Windows</td>
<td>1.23.2</td>
</tr>
<tr>
<td>Microsoft.ML.OnnxRuntime.Managed</td>
<td>1.23.2</td>
</tr>
</tbody>
</table>
<p><strong>éç¨åºæ¯ï¼</strong></p>
<ul>
<li>å¯¹æ¨çéåº¦è¦æ±æé«ççäº§ç¯å¢</li>
<li>NVIDIA GPU è®¾å¤</li>
<li>å¯æ¥åé¦æ¬¡è¿è¡è¾é¿çç¼è¯æ¶é´</li>
</ul>
<hr>
<h3 id="56-onnx-runtime-dml-æ¨ç">5.6 ONNX Runtime DML æ¨ç</h3>
<p>DirectMLï¼DMLï¼æ¯ Windows å¹³å°çé«æ§è½ç¡¬ä»¶å éæ¥å£ï¼æ¯æ AMDãNVIDIA å Intel å¤ååæ¾å¡ã</p>
<h4 id="éç½®æ­¥éª¤-2">éç½®æ­¥éª¤</h4>
<p>å° DML ç¸å³ DLL æä»¶å¤å¶å°ç¨åºè¿è¡ç®å½ï¼</p>
<p><img alt="DML ä¾èµæä»¶" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813611-139393382.png" class="lazyload"></p>
<h4 id="ä½¿ç¨æ­¥éª¤-1">ä½¿ç¨æ­¥éª¤</h4>
<ol>
<li>è¿è¡ç¨åº</li>
<li>å¨ãæ¨çåç«¯ãä¸ææ¡ä¸­éæ© <strong>ONNX Runtime DML</strong></li>
<li>ç¹å»ãå è½½æ¨¡åã</li>
<li>ç¹å»ãæ¨çå¾çãå¼å§è¯å«</li>
</ol>
<p><img alt="ONNX Runtime DML éæ©çé¢" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813659-1655618200.png" class="lazyload"></p>
<p><strong>éç¨åºæ¯ï¼</strong></p>
<ul>
<li>Windows å¹³å°ç¨æ·</li>
<li>AMD æ¾å¡ç¨æ·</li>
<li>éè¦ç»ä¸æ¥å£æ¯æå¤åçæ¾å¡</li>
</ul>
<hr>
<h3 id="57-tensorrtsharp-æ¨ç">5.7 TensorRTSharp æ¨ç</h3>
<p>TensorRTSharp æ¯å¯¹ NVIDIA TensorRT ç C# å°è£ï¼æä¾åçç TensorRT å¼æå è½½åæ¨çè½åï¼æ¯æ FP16 ç²¾åº¦è¿ä¸æ­¥æåæ§è½ã</p>
<h4 id="ç¯å¢åå¤">ç¯å¢åå¤</h4>
<p>è¯¦ç»çå®è£åéç½®æåè¯·åèï¼</p>
<pre><code>https://mp.weixin.qq.com/s/D0c6j5MmraJO4Eza7tWm1A
</code></pre>
<p>TensorRTSharp æ¯æ CUDA 11 å CUDA 12 ä¸¤ä¸ªç³»åï¼è¯·æ ¹æ®ç³»ç»å®è£ç CUDA çæ¬éæ©å¯¹åºç DLL æä»¶ã</p>
<h4 id="éç½®æ­¥éª¤-3">éç½®æ­¥éª¤</h4>
<ol>
<li>
<p><strong>æ¿æ¢ DLL æä»¶</strong></p>
<p>æ ¹æ®å®è£ç CUDA çæ¬ï¼å°å¯¹åºç TensorRT DLL æä»¶å¤å¶å°ç¨åºç®å½ï¼</p>
<p><img alt="TensorRT DLL æä»¶" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813615-1275332341.jpg" class="lazyload"></p>
</li>
<li>
<p><strong>æ¨¡åè½¬æ¢</strong></p>
<p>ä½¿ç¨ <code>trtexec</code> å·¥å·å° ONNX æ¨¡åè½¬æ¢ä¸º TensorRT å¼ææä»¶ï¼</p>
<p><img alt="trtexec è½¬æ¢å·¥å·" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813694-718172996.jpg" class="lazyload"></p>
</li>
</ol>
<h4 id="æ¨¡åè½¬æ¢æä»¤">æ¨¡åè½¬æ¢æä»¤</h4>
<p><strong>ææ¬æ£æµæ¨¡åï¼Detï¼ï¼</strong></p>
<pre><code class="language-bash">trtexec.exe --onnx=PP-OCRv5_mobile_det_onnx.onnx \
  --minShapes=x:1x3x32x32 \
  --optShapes=x:4x3x640x640 \
  --maxShapes=x:8x3x960x960 \
  --fp16 \
  --memPoolSize=workspace:1024 \
  --sparsity=disable \
  --saveEngine=PP-OCRv5_mobile_det_f16_onnx.engine
</code></pre>
<p><strong>ææ¬åç±»æ¨¡åï¼Clsï¼ï¼</strong></p>
<pre><code class="language-bash">trtexec.exe --onnx=PP-OCRv5_mobile_cls_onnx.onnx \
  --minShapes=x:1x3x80x160 \
  --optShapes=x:8x3x80x160 \
  --maxShapes=x:64x3x80x160 \
  --fp16 \
  --memPoolSize=workspace:1024 \
  --sparsity=disable \
  --saveEngine=PP-OCRv5_mobile_cls_f16_onnx.engine
</code></pre>
<p><strong>ææ¬è¯å«æ¨¡åï¼Recï¼ï¼</strong></p>
<pre><code class="language-bash">trtexec.exe --onnx=PP-OCRv5_mobile_rec_onnx.onnx \
  --minShapes=x:1x3x48x48 \
  --optShapes=x:8x3x48x1024 \
  --maxShapes=x:64x3x48x1024 \
  --fp16 \
  --memPoolSize=workspace:1024 \
  --sparsity=disable \
  --saveEngine=PP-OCRv5_mobile_rec_f16_onnx.engine
</code></pre>
<h4 id="å¼å§æ¨ç">å¼å§æ¨ç</h4>
<p>æ¨¡åè½¬æ¢å®æåï¼å¨ç¨åºä¸­éæ©å¯¹åºç <code>.engine</code> æä»¶å³å¯å¼å§æ¨çï¼</p>
<p><img alt="TensorRT å¼ææä»¶éæ©" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813690-867069194.jpg" class="lazyload"></p>
<p><strong>éç¨åºæ¯ï¼</strong></p>
<ul>
<li>è¿½æ±æè´æ¨çæ§è½</li>
<li>NVIDIA GPU ç¯å¢</li>
<li>åè®¸ç¦»çº¿æ¨¡åè½¬æ¢</li>
</ul>
<hr>
<h2 id="å­æ§è½æµè¯ä¸åæ">å­ãæ§è½æµè¯ä¸åæ</h2>
<h3 id="61-æ§è½æµè¯å·¥å·">6.1 æ§è½æµè¯å·¥å·</h3>
<p>æ¼ç¤ºç¨åºåç½®äºå®æ´çæ§è½æµè¯å·¥å·ï¼æ¯æä¸¤ç§æµè¯æ¨¡å¼ï¼</p>
<ol>
<li><strong>æ´ä½èæ¶ç»è®¡</strong>ï¼è®¡ç®ä»å¾çè¾å¥å°ç»æè¾åºçå®æ´ç«¯å°ç«¯èæ¶</li>
<li><strong>è¯¦ç»é¶æ®µåæ</strong>ï¼è®°å½é¢å¤çãæ¨çãåå¤çåé¶æ®µçå·ä½èæ¶</li>
</ol>
<p><img alt="æ´ä½èæ¶ç»è®¡" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813646-333754545.jpg" class="lazyload"></p>
<p><img alt="è¯¦ç»æ§è½è®°å½" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813643-1070139529.jpg" class="lazyload"></p>
<h3 id="62-tensorrtsharp-æ§è½ç¤ºä¾">6.2 TensorRTSharp æ§è½ç¤ºä¾</h3>
<p>ä»¥ä¸ä¸ºä½¿ç¨ TensorRTSharp å¨ 4 å¹¶åéç½®ä¸çæ§è½æµè¯æ°æ®ï¼</p>
<pre><code>Inference time: 53 ms

---- Detection ----

Inference Time Records:
Index    Preprocess(ms)    Inference(ms)    Postprocess(ms)    Total(ms)
1         2.01              6.37              0.57              8.96
2         2.23              5.51              0.68              8.43

---- Classification ----

Device/Worker 0:
Inference Time Records:
Index    Preprocess(ms)    Inference(ms)    Postprocess(ms)    Total(ms)
1         1.84              6.89              0.00              8.73
2         1.99              6.97              0.01              8.96

Device/Worker 1:
Inference Time Records:
Index    Preprocess(ms)    Inference(ms)    Postprocess(ms)    Total(ms)
1         1.79              6.66              0.00              8.46
2         1.66              7.60              0.00              9.26

Device/Worker 2:
Inference Time Records:
Index    Preprocess(ms)    Inference(ms)    Postprocess(ms)    Total(ms)
1         1.61              5.31              0.00              6.92
2         1.51              8.01              0.00              9.53

Device/Worker 3:
Inference Time Records:
Index    Preprocess(ms)    Inference(ms)    Postprocess(ms)    Total(ms)
1         1.24              7.73              0.00              8.98
2         1.82              8.35              0.00              10.17

---- Recognition ----

Device/Worker 0:
Inference Time Records:
Index    Preprocess(ms)    Inference(ms)    Postprocess(ms)    Total(ms)
1         0.00              41.97             1.42              43.39
2         0.00              14.50             2.30              16.81

Device/Worker 1:
Inference Time Records:
Index    Preprocess(ms)    Inference(ms)    Postprocess(ms)    Total(ms)
1         0.00              47.40             6.81              54.21
2         0.00              19.42             2.76              22.18

Device/Worker 2:
Inference Time Records:
Index    Preprocess(ms)    Inference(ms)    Postprocess(ms)    Total(ms)
1         0.00              38.10             3.42              41.52
2         0.00              22.36             3.37              25.73

Device/Worker 3:
Inference Time Records:
Index    Preprocess(ms)    Inference(ms)    Postprocess(ms)    Total(ms)
1         0.00              109.94            4.58              114.52
2         0.00              26.59             4.55              31.14
</code></pre>
<h3 id="63-æ§è½å¯¹æ¯æ»ç»">6.3 æ§è½å¯¹æ¯æ»ç»</h3>
<p>ä¸è¡¨ä¸ºä½¿ç¨æ´åæ°´å¾çï¼è·10æ¬¡çå¹³åæ¶é´æµè¯ï¼</p>
<table>
<thead>
<tr>
<th>æ¨çå¼æ</th>
<th>è®¾å¤</th>
<th>å¹³åèæ¶</th>
<th>è®¾å¤ç±»å</th>
</tr>
</thead>
<tbody>
<tr>
<td>OpenVINO</td>
<td>CPU</td>
<td>288ms</td>
<td>Intel(R) Core(TM) Ultra 9 288V  8æ ¸</td>
</tr>
<tr>
<td>OpenVINO</td>
<td>IGPU</td>
<td>99ms</td>
<td>Intel(R) Arc(TM) 140V GPU (16GB)</td>
</tr>
<tr>
<td>OpenVINO</td>
<td>æ··å AUTOï¼IGPU+CPU</td>
<td>100ms</td>
<td>Intel(R) Core(TM) Ultra 9 288V  8æ ¸  <br>Intel(R) Arc(TM) 140V GPU (16GB)</td>
</tr>
<tr>
<td>ONNX Runtime</td>
<td>CPU</td>
<td>656ms</td>
<td>AMD Ryzen 7 5800H with Radeon Graphics 8æ ¸</td>
</tr>
<tr>
<td>ONNX Runtime DML</td>
<td>GPU</td>
<td>114ms</td>
<td>NVIDIA GeForce RTX 3060 Laptop GPU</td>
</tr>
<tr>
<td>ONNX Runtime DML</td>
<td>IGPU</td>
<td>331ms</td>
<td>Intel(R) Arc(TM) 140V GPU (16GB)</td>
</tr>
<tr>
<td>ONNX Runtime CUDA</td>
<td>GPU</td>
<td>93ms</td>
<td>NVIDIA GeForce RTX 3060 Laptop GPU</td>
</tr>
<tr>
<td>ONNX Runtime TensorRT</td>
<td>GPU</td>
<td>52ms</td>
<td>NVIDIA GeForce RTX 3060 Laptop GPU</td>
</tr>
<tr>
<td>TensorRTSharp</td>
<td>GPU</td>
<td>51ms</td>
<td>NVIDIA GeForce RTX 3060 Laptop GPU</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>æ§è½æµè¯å¾é</strong>ï¼æä»¬æ¬¢è¿å¹¿å¤§å¼åèåäº«åèªçæµè¯æ°æ®ãè¯·å¨è¯è®ºåºæä¾æ¨çæµè¯éç½®ï¼ç¡¬ä»¶åå·ãå¹¶åæ°ãBatch Sizeï¼åå®æµèæ¶ï¼åç»­æä»¬å°æ´çææ§è½åºåå¯¹æ¯è¡¨ã</p>
</blockquote>
<hr>
<h2 id="ä¸å¸¸è§é®é¢è§£ç­">ä¸ãå¸¸è§é®é¢è§£ç­</h2>
<h3 id="q1-é¦æ¬¡æ¨çä¸ºä»ä¹ç¹å«æ¢">Q1: é¦æ¬¡æ¨çä¸ºä»ä¹ç¹å«æ¢ï¼</h3>
<p><strong>A:</strong> é¦æ¬¡æ¨çæ¶éè¦è¿è¡ä»¥ä¸æä½ï¼</p>
<ul>
<li>æ¨¡åå è½½å°åå­</li>
<li>æ¨çå¼æåå§å</li>
<li>JIT ç¼è¯ï¼é¨åå¼æï¼</li>
</ul>
<p>è¿æ¯æ­£å¸¸ç°è±¡ï¼åç»­æ¨çéåº¦ä¼æ¾èæåã</p>
<hr>
<h3 id="q2-å¦ä½éæ©åéçæ¨çå¼æ">Q2: å¦ä½éæ©åéçæ¨çå¼æï¼</h3>
<p><strong>A:</strong> æ ¹æ®ç¡¬ä»¶ç¯å¢åéæ±éæ©ï¼</p>
<table>
<thead>
<tr>
<th>åºæ¯</th>
<th>æ¨èå¼æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ  GPUï¼æIntel CPU,è¿½æ±ç¨³å®æ§</td>
<td>OpenVINO</td>
</tr>
<tr>
<td>æIntel GPUï¼éè¦è·¨å¹³å°</td>
<td>OpenVINO</td>
</tr>
<tr>
<td>æ  GPUï¼éè¦è·¨å¹³å°</td>
<td>ONNX Runtime CPU</td>
</tr>
<tr>
<td>æ NVIDIA æ¾å¡ï¼å¿«éé¨ç½²</td>
<td>ONNX Runtime CUDA</td>
</tr>
<tr>
<td>æ NVIDIA æ¾å¡ï¼è¿½æ±æ§è½</td>
<td>ONNX Runtime TensorRT / TensorRTSharp</td>
</tr>
<tr>
<td>Windows å¹³å°ï¼AMD æ¾å¡</td>
<td>ONNX Runtime DML</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="q3-åæ¢æ¨çå¼ææ¶ä¸ºä»ä¹éè¦éæ°å è½½æ¨¡å">Q3: åæ¢æ¨çå¼ææ¶ä¸ºä»ä¹éè¦éæ°å è½½æ¨¡åï¼</h3>
<p><strong>A:</strong> ä¸åæ¨çå¼æå¯¹æ¨¡åæ ¼å¼çåé¨è¡¨ç¤ºåä¼åç­ç¥ä¸åï¼å æ­¤éè¦éæ°è§£æåå è½½æ¨¡åãç¹å»ãå è½½æ¨¡åãå³å¯å®æåæ¢ã</p>
<hr>
<h3 id="q4-batchsize-åå¹¶åæ°éæä»ä¹åºå«">Q4: BatchSize åå¹¶åæ°éæä»ä¹åºå«ï¼</h3>
<p><strong>A:</strong> ä¸¤ä¸ªåæ°çä½ç¨ä¸åï¼</p>
<ul>
<li><strong>BatchSize</strong>ï¼åæ¬¡æ¨çå¤ççå¾çæ°éï¼æå GPU å©ç¨ç</li>
<li><strong>å¹¶åæ°é</strong>ï¼åæ¶è¿è¡çæ¨çå¼ææ°éï¼è®¾ç½®å ä¸ªå°±ä¼çæå ä¸ªæ¨çå¼æè¿è¡åæ¶æ¨çï¼æåå¤æ ¸/CPU å©ç¨ç</li>
</ul>
<p>è°æ´ BatchSize ä¸éè¦éæ°å è½½æ¨¡åï¼ä½è°æ´å¹¶åæ°éåéè¦éæ°å è½½ã</p>
<hr>
<h3 id="q5-tensorrt-æ¨¡åè½¬æ¢å¤±è´¥æä¹å">Q5: TensorRT æ¨¡åè½¬æ¢å¤±è´¥æä¹åï¼</h3>
<p><strong>A:</strong> æ£æ¥ä»¥ä¸å ç¹ï¼</p>
<ol>
<li>ç¡®ä¿ CUDA çæ¬ä¸ TensorRT çæ¬å¹é</li>
<li>æ£æ¥ ONNX æ¨¡åæä»¶æ¯å¦å®æ´</li>
<li>ç¡®è®¤ <code>trtexec</code> åæ°ä¸­è¾å¥å°ºå¯¸èå´åç</li>
<li>å¦æ¾å­ä¸è¶³ï¼åå° <code>--memPoolSize</code> åæ°</li>
</ol>
<hr>
<h3 id="q6-æ¨çç»æä¸ºç©ºæè¯å«ä¸åç¡®æä¹å">Q6: æ¨çç»æä¸ºç©ºæè¯å«ä¸åç¡®æä¹åï¼</h3>
<p><strong>A:</strong> å¸¸è§åå åè§£å³æ¹æ³ï¼</p>
<ol>
<li><strong>å¾çè´¨é</strong>ï¼æ£æ¥å¾çæ¯å¦æ¨¡ç³ãå¾ææåç§ä¸è¶³</li>
<li><strong>è¾å¥å°ºå¯¸</strong>ï¼ç¡®ä¿å¾çå°ºå¯¸ç¬¦åæ¨¡åè¾å¥è¦æ±</li>
<li><strong>è¯­è¨æ¯æ</strong>ï¼ç¡®è®¤æ¨¡åæ¯å¦æ¯æç®æ è¯­è¨</li>
<li><strong>æ¨¡åçæ¬</strong>ï¼å°è¯ä½¿ç¨ä¸åçæ¬ç PaddleOCR æ¨¡å</li>
</ol>
<hr>
<h2 id="å«è½¯ä»¶è·å">å«ãè½¯ä»¶è·å</h2>
<h3 id="81-æºç ä¸è½½">8.1 æºç ä¸è½½</h3>
<p>DeploySharp é¡¹ç®å·²å®å¨å¼æºï¼å¯éè¿ä»¥ä¸æ¹å¼è·åï¼</p>
<p><strong>ä¸»ä»åºï¼</strong></p>
<pre><code>https://github.com/guojin-yan/DeploySharp.git
</code></pre>
<p><strong>PaddleOCR æ¼ç¤ºç¨åºï¼</strong></p>
<pre><code>https://github.com/guojin-yan/DeploySharp/tree/DeploySharpV1.0/applications/JYPPX.DeploySharp.OpenCvSharp.PaddleOcr
</code></pre>
<h3 id="82-å¯æ§è¡ç¨åº">8.2 å¯æ§è¡ç¨åº</h3>
<p>å¦éç´æ¥è·åç¼è¯å¥½çå¯æ§è¡ç¨åºï¼è¯·å å¥ææ¯äº¤æµç¾¤ï¼ä»ç¾¤æä»¶ä¸è½½ææ°çæ¬ã</p>
<hr>
<h2 id="ä¹ææ¯æ¯æ">ä¹ãææ¯æ¯æ</h2>
<h3 id="91-åé¦ä¸äº¤æµ">9.1 åé¦ä¸äº¤æµ</h3>
<ul>
<li><strong>GitHub Issues</strong>ï¼å¨é¡¹ç®ä»åºæäº¤ Issue æ Pull Request</li>
<li><strong>QQ äº¤æµç¾¤</strong>ï¼å å¥ <strong>945057948</strong>ï¼è·åå®æ¶ææ¯æ¯æ</li>
</ul>
<p><img alt="QQç¾¤äºç»´ç " loading="lazy" data-src="https://img2024.cnblogs.com/blog/2933426/202601/2933426-20260128223813606-1067743997.png" class="lazyload"></p>
<h3 id="92-ç¸å³èµæº">9.2 ç¸å³èµæº</h3>
<ul>
<li><strong>PaddleOCR å®æ¹é¡¹ç®</strong>ï¼<a href="https://github.com/PaddlePaddle/PaddleOCR" target="_blank" rel="noopener nofollow">https://github.com/PaddlePaddle/PaddleOCR</a></li>
<li><strong>OpenVINO å®æ¹ææ¡£</strong>ï¼<a href="https://docs.openvino.ai/" target="_blank" rel="noopener nofollow">https://docs.openvino.ai/</a></li>
<li><strong>TensorRT å®æ¹ææ¡£</strong>ï¼<a href="https://docs.nvidia.com/deeplearning/tensorrt/" target="_blank" rel="noopener nofollow">https://docs.nvidia.com/deeplearning/tensorrt/</a></li>
<li><strong>ONNX Runtime å®æ¹ææ¡£</strong>ï¼<a href="https://onnxruntime.ai/docs/" target="_blank" rel="noopener nofollow">https://onnxruntime.ai/docs/</a></li>
</ul>
<hr>
<h2 id="ç»è¯­">ç»è¯­</h2>
<p>éè¿ DeploySharp æ¡æ¶ï¼æä»¬æåå®ç°äº PaddleOCR å¨ .NET ç¯å¢ä¸çé«æé¨ç½²ãæ è®ºæ¯çº¯ CPU ç¯å¢ä¸çç¨³å®è¿è¡ï¼è¿æ¯ GPU å éä¸çæè´æ§è½ï¼å¼åèé½å¯ä»¥æ ¹æ®å®ééæ±çµæ´»éæ©ã</p>
<p>æªæ¥ï¼æä»¬å°æç»­ä¼åæ¡æ¶æ§è½ï¼æ¯ææ´å¤æ¨¡åç±»ååæ¨çå¼æï¼ä¸º .NET å¼åèæä¾æ´å®åç AI æ¨¡åé¨ç½²è§£å³æ¹æ¡ã</p>
<hr>
<p><em>ä½èï¼Guojin Yan</em><br>
<em>æåæ´æ°ï¼2026å¹´1æ</em></p>
<hr>
<p><strong>ãæç« å£°æã</strong></p>
<p>æ¬æä¸»è¦åå®¹åºäºä½èçç ç©¶ä¸å®è·µï¼é¨åè¡¨è¿°åå© AI å·¥å·è¿è¡äºè¾å©ä¼åãç±äºææ¯å±éæ§ï¼æä¸­å¯è½å­å¨éè¯¯æçæ¼ä¹å¤ï¼æ³è¯·åä½è¯»èæ¹è¯ææ­£ãå¦æåå®¹æ æä¸­ä¾µç¯äºæ¨çæçï¼è¯·åæ¶éè¿å¬ä¼å·åå°ä¸æä»¬èç³»ï¼æä»¬å°ç¬¬ä¸æ¶é´æ ¸å®å¹¶å¦¥åå¤çãæè°¢æ¨ççè§£ä¸æ¯æï¼</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-28 22:40">2026-01-28 22:40</span>&nbsp;
<a href="https://www.cnblogs.com/guojin-blogs">æ¤é¢ç®ç®è¾</a>&nbsp;
éè¯»(<span id="post_view_count">57</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19545866);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19545866', targetLink: 'https://www.cnblogs.com/guojin-blogs/p/19545866', title: 'ä½¿ç¨ JYPPX.DeploySharp é«æé¨ç½² PaddleOCRï¼è§£éå¤ç§é«æ§è½ OCR æå­è¯å«æ¹æ¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ºä»ä¹ Kubernetes æå¡ä¸­æ­éå¸¸æ¯äººä¸ºå¤±è¯¯ï¼èä¸æ¯å¹³å°èªèº«åå ï¼ ]]></title>
    <link>https://www.cnblogs.com/manuscript/p/19544375</link>
    <guid>1d526bed3938fa9fa30e65f588a7f559</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/manuscript/p/19544375" title="åå¸äº 2026-01-28 16:07">
    <span role="heading" aria-level="2">ä¸ºä»ä¹ Kubernetes æå¡ä¸­æ­éå¸¸æ¯äººä¸ºå¤±è¯¯ï¼èä¸æ¯å¹³å°èªèº«åå ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ¬æåºäºå¯¹ <a href="https://hackernoon.com/why-kubernetes-outages-are-usually-human-failures-not-platform-bugs" title="Why Kubernetes Outages Are Usually Human Failures, Not Platform Bugsï¼" target="_blank" rel="noopener nofollow">Why Kubernetes Outages Are Usually Human Failures, Not Platform Bugs</a> è¿ç¯æç« çç¿»è¯ãä¸æºç¿»ä¸åï¼æ¬æå¨ç¿»è¯çåºç¡ä¸è¿è¡äºå¤§éæ¬ååçæ¶¦è²ï¼ä½¿åå®¹æ´ç¬¦åä¸­ææ¯è¯­è¯»èçéè¯»ä¹ æ¯ï¼å¤§å¤§æåäºéè¯»ä½éªãæ­¤å¤ï¼å¯¹äºä¸äºè¾ä¸ºä¸ä¸æé¾ä»¥çè§£çæ¯è¯­ï¼æ¬æä¹éä¸äºç¸å³çç»´åºç¾ç§é¾æ¥ï¼å¸®å©è¯»èæ´å¥½å°çè§£ç¸å³æ¦å¿µãéè¦è¯´æçæ¯ï¼æ¬æä»ä¸ºåæçæ¶¦è²ç¿»è¯ï¼å¹¶æªæ¹ååæçè¡¨è¾¾åå®¹ã</p>
<h1 id="åè¨">åè¨</h1>
<p>Kubernetes æ¬èº«å¹¶ä¸å¤æï¼æ¯æä»¬æå®æå¤æçãæ è®ºæ¯å»æä¸ºä¹è¿æ¯é£ç§è½ç¶åºäºå¥½æå´å°ä¼éçåè¯­å ç æ <a href="https://en.wikipedia.org/wiki/Rube_Goldberg_machine" target="_blank" rel="noopener nofollow">é²å¸Â·æå¾·å ¡æºæ¢°</a> ççç­ãå¹³å°æåæä¾ç ReplicaSetsãServicesãConfigMapsï¼è¿äºåºç¡ç»ä»¶ç®åç´æ¥ï¼çè³æ¾å¾æäºæ¯ç¥ãä½åæ¥æä»¬å¼å¥äº OperatorsãService Meshesï¼ä»¥åé£äºä»ä»ä¸ºäºæ´æ°ä¸ä¸ª Deployment å°±éè¦ä¸ä¸ªç¬ç«æ§å¶å¨åä¸ç GitOps Pipelinesãå¦ä»æä»¬æ·±é·å¨å ç§¯å¦å±±ç YAML éç½®æä»¶ä¸­ï¼æ¢çä¸æï¼ä¹æ¹ä¸å¨ï¼èåä¸è¿äºéç½®çå¤åæ©å¨åå¹´åå°±å·²ç»ç¦»èäºã</p>
<p>ææ¾å¨åæ¨ä¸¤ç¹ææ¥è¿è¿ç±»éç¾¤æéãææåªæ¯ä¸ä¸ª Pod éå¯ï¼å´å ä¸ºæäººç»ä¸ä¸ªå¨é«å³°æéè¦ 4 ç§æè½å»ºç«æ°æ®åºè¿æ¥çæå¡éç½®äº 2 ç§è¶æ¶ç Liveness Probeï¼æç»å¯¼è´éªå´©ï¼å¼åäºé¿è¾¾ 30 åéçæå¡ä¸­æ­ãè¿é Kubernetes ä¸èï¼æ¯æä»¬å¯¹åå¸å¼ç³»ç»æ¶åºççè§£åºäºé®é¢ãUptime Institute æ¥åæåºï¼40% çéå¤§æéæºäºäººä¸ºéè¯¯ï¼éç½®å¤±è¯¯ãææ»æ²é kubectl å½ä»¤ãåå¸åæµè¯ä¸ååãè¿ä¸æ¯å±è¨è¸å¬ãå¯¼è´å®æºçå¾å¾ä¸æ¯ Kernel Panicï¼ä¹ä¸æ¯ etcd æ°æ®æåï¼èæ¯æä»¬èªå·±ï¼</p>
<p>å®å¨é¢åçæåµæ´ä¸å®¹ä¹è§ã93% çä¼ä¸æ¿è®¤å¶ Kubernetes å®å¨äºæä¸æä½å¤±è¯¯æå³ï¼è¿è¯´ææä»¬é¢å¯¹çæ¯æµç¨ç®¡ççç¾é¾ï¼èéè½¯ä»¶æ¬èº«çç¼ºé·ãè¢«éå¿ç RBAC è§åãç´æ¥æäº¤å° Git ç Secretsãå¨æµè¯ç¯å¢éç½®äºå´ä»æªåæ­¥å°çäº§ç Network Policies ...ï¼æçè³è§è¿æçå¢éç´æ¥ä½¿ç¨ç¹æå®¹å¨ï¼Privileged Containersï¼è¿è¡çäº§è´è½½ï¼çç±ä»ä»æ¯ "å¼åæ¶è¿æ ·æ¯è¾æ¹ä¾¿ï¼ä¸çº¿åå¿äºå³"ãè¿ä¸è½æª Kubernetes ä¸å®å¨ï¼è¿å°±æ¯æ«çå¹³å°å¤ææ§å¤è¡£çå¶åº¦æ§çå¿½ã</p>
<h1 id="è±éå·¥ç¨å¸çé·é±">"è±éå·¥ç¨å¸"çé·é±</h1>
<p>å§æéå¸¸æ¯è¿æ ·åå±çï¼å¢ééæä¸ä½æåæ¨ªæº¢çå·¥ç¨å¸ï¼æä»¬å§ä¸å«å¥¹ Mayaï¼å¥¹å³å®è¦æé ä¸ä¸ª"ä¸çæå¼ºå¹³å°"ãå¥¹éè¯»äº CNCF Landscape çåç±»ææ¯æç« ï¼ç¶åå¤§æ¾èº«æï¼å¼å¥ Istio å Service Meshï¼ç¨ Argo ååå¸ï¼å¨ Vault ç®¡ç Secretsï¼é¨ç½² Prometheus + Thanos åå¯è§æµæ§ï¼è¿æ cert-manager å¤ç TLSï¼external-dns ç®¡çååï¼Velero æå®å¤ä»½ãå¹³å¿èè®ºï¼æ¯ä¸ªç»ä»¶é½è§£å³äºä¸ä¸ªå®éé®é¢ï¼ä½åæ¶ä¹å¼å¥äºä¸ä¸ªå¨æ°çæéç±»åã</p>
<p>å­ä¸ªæåï¼Maya è¢«ä¸å®¶ååå¬å¸ç¨ææåæ´é«ç Title æèµ°äºãçä¸äºä¸å¥ç²¾å¯å¤æçç³»ç»ï¼å´æ²¡äººç¥éåä¸ªç»ä»¶æ¯å¦ä½å¬åçï¼</p>
<ul>
<li>
<p>observability stackï¼æ¯ Maya ç¨èªå®ä¹ Recording Rules å Federation Endpoints éç½®çï¼é»è¾åªæå¥¹èªå·±æã</p>
</li>
<li>
<p>GitOps pipelineï¼ä¾èµçå¥¹æä¸ªå¨æ«ææç Custom Operator å®ç°ç Slack Webhook éç¥ç³»ç»ï¼é¤æ­¤ä¹å¤æ²¡äººç¢°è¿ä»£ç ã</p>
</li>
</ul>
<p>å½ç³»ç»æéæ¶æ´ä¸ªå¢éä¸¤ç¼ä¸æ¹é»ãå¤§å®¶åªç¥é <code>kubectl get pods</code> æ¾ç¤ºç¶ææ¯ <code>CrashLoopBackOff</code>ï¼å´æ ¹æ¬æä¸æ¸ä¸ºä»ä¹æ¹äºä¸ä¸ªæä¸å±åµå¥çéç½®ï¼Liveness Probe å°±çªç¶æäºã</p>
<p>Portainer ç CEO å®ç¾å°ææå°äºè¿ä¸ç¹ï¼é£äºç±ä¸ªäººä¸ºäºè¿½æ±ææ¯æè´èæ­å»ºç Kubernetes ç¯å¢ï¼å¾å¾åèçå·¨å¤§çé£é©ï¼å ä¸ºå¶å¤æåº¦ä¼è®©åç»­çç»´æ¤å·¥ä½åæä¸åºå©æ¢¦ãææ³è¿ä¸æ­¥è¡¥åçæ¯ï¼çæ­£è´å½çé®é¢ä¸å¨å¤ææ§æ¬èº«ï¼èå¨äºé£äº<strong>æªè¢«ææ¡£å</strong>çå¤ææ§ï¼ä¹å°±æ¯åªå­å¨äº Maya èå­éç<strong>éç§ç»éª</strong>ãé¢å¯¹ä¸ä¸ªå¤æçç³»ç»ï¼æä»¬å°è½æ½ä¸å¥è§æ¾å°åºè·¯ï¼ä½é¢å¯¹ä¸ä¸ª<strong>å®å¨ä¸éæçé»ç</strong>ï¼ä¸æ¦åºäºï¼å¾å¾æ¯æ è§£çæ­»å±ã</p>
<p>åç§ä¸é®å®è£å·¥å·æ´æ¯éªä¸å éãä¸ä¸ª Helm Chart è½ç¬é´æèµ· 50 ä¸ªèµæºï¼é»è®¤éç½®çèµ·æ¥ä¹åæ¨¡åæ ·ï¼Terraform Module æåºå±ç½ç»éç½®å°è£å¾ä¸¥ä¸¥å®å®ãè¿å¯¹æåäº¤ä»éåº¦ç¡®å®ææï¼ä½å¯¹çè§£ç³»ç»æ¶æå´æ¯æ¯ç­æ§çãå½ Ingress Controller çªç¶æ æ³è½¬åæµéæ¶ï¼ä½ è½å¤æ­åºæ¯ LoadBalancer Service ç Annotation åéäºï¼è¿æ¯åç«¯ Health Check æäºï¼äº¦ææ¯ cert-manager ç ClusterIssuer ä¸¢äº ACME å­è¯å¯¼è´è¯ä¹¦è¿æï¼å¦æä½ å½ååªæ¯æ²äºä¸è¡ <code>helm install nginx-ingress stable/nginx-ingress</code> å´ä»æªå®¡è§è¿çæç Manifestsï¼é£ä½ å¤§æ¦çæ¯æµåçã</p>
<h1 id="è®¤ç¥è¿è½½ä¸å¾®æå¡ç¨">è®¤ç¥è¿è½½ä¸å¾®æå¡ç¨</h1>
<p>çæ­£çå¹åé»æå¶å®ä¸æ¯ Kubernetesï¼èæ¯ Kubernetes æå¬ççäº§ç©ï¼è§æ¨¡è¶åºäººç±»è®¤ç¥æéçå¾®æå¡æ¶æãç°å¨çå¼åèï¼åæä¸å¡é»è¾å·²ç»ä¸å¤äºï¼è¿å¾ç²¾éï¼Service DiscoveryãCircuit BreakingãRetry Policiesãåå¸å¼ Tracing ç Context PropagationãMetrics æ°æ®æ ¼å¼ãHealth Check çåç§è¯­ä¹ï¼Readiness vs Liveness vs Startupï¼ãResource Requests ä¸ Limits çåºå«ãPod è°åº¦çº¦æãNetwork PoliciesãSecret è½®è½¬ï¼ä»¥å Graceful Shutdown æµç¨ç­ç­ã</p>
<p>è¿åªéè¿æ¯åä»£ç ï¼åææ¯æ«çåºç¨å¼åå¤è¡£çåå¸å¼ç³»ç»å·¥ç¨ã</p>
<p>Komodor å³äºè®¤ç¥è´è·çç ç©¶ä¸éè§è¡ï¼å¼åèæ­£è¢«è¿äºåå¸å¼ç³»ç»åå¾åä¸è¿æ°ãææ¾äº²ç¼ç®ç¹åçº§å·¥ç¨å¸è±äºä¸¤å¤©ææ¥æå¡è¿ä¸ä¸ Postgres çé®é¢ï¼æååç°ç«ç¶æ¯ Network Policy é»æ­äºéå¾æ°æ®åº Namespace ç Egress æµéãä»ä»¬æ SQLï¼ä¹çè§£ ORMï¼ä½èå­éå®å¨æ²¡æ Kubernetes ç½ç»éç¦»çæ¦å¿µï¼å ä¸ºæ²¡äººæè¿ä»ä»¬ï¼èæ¥éä¿¡æ¯åªæ¯ä¸ä¸ªæ¯«æ ä¿¡æ¯éçâè¿æ¥è¶æ¶âã</p>
<p>è¿ç§é®é¢ä¼ä¸æ­ç´¯ç§¯ãå½å¢ééçæ¯ä¸ªäººé½å¨å¶è½åè¾¹ç¼æä½æ¶ï¼å°å¤±è¯¯å°±ä¼è¢«æ éæ¾å¤§ï¼æäººæåå­ Limit è®¾å¾å¤ªä½ -&gt; é«è´è½½ä¸ JVM OOM -&gt; Pod éå¯ -&gt; æ°é¢èç¹ååå¤§ï¼Startup Probe è¶æ¶ -&gt; Kubernetes kill Pod -&gt; Metrics-server æå»¶è¿ï¼HPA è¿æ²¡æ¥å¾åæ©å®¹ -&gt; æµéå¨é¨æå°å©ä½ç Pod ä¸ -&gt; å©ä½ Pod éä½ OOM -&gt; éªå´©ãè¿ä¸è¿ä¸²äºä»¶ä¸­ï¼æ¯ä¸ä¸ªåç¬çç¯èçèµ·æ¥é½æºåçï¼ä½å®ä»¬ç»åå¨ä¸èµ·çäº¤äºå¤æåº¦å´æ¯ææ°çº§çã</p>
<p>åæ³èææºæ¶ä»£ãå¦ææå¡å¨æ½é£å°± SSH ä¸å»ï¼æ¥æ¥æ¥å¿ï¼éå¯è¿ç¨ï¼æèå¹²èéå¯æºå¨ãåéå°ï¼æ½è±¡å±ä¹å°ãå½å¹´æç»´æ¤è·çåä½ Rails åºç¨çèææºéç¾¤æ¶ï¼æå¯¹æ¯ä¸ä¸ªä¾èµãæ¯ä¸ä¸ª Cron Jobãæ¯ä¸ä¸ªæ¥å¿æä»¶çè·¯å¾é½äºå¦ææãææ¥é®é¢å°±åå¨èµ°ä¸ä¸ªåªæ 20 ä¸ªåæ¯çå³ç­æ ãè Kubernetes çæéææ¥åæ¯ä¸å¼ åæ»¡äºå¾ªç¯ãæ­»è¡ååè¯¯å¯¼ä¿¡æ¯çåºå¤§å³ç­å¾ã</p>
<p>æäºäººæ´æå¿µèææºæ¨¡å¼ãè½ç¶å¼¹æ§å·®äºç¹ï¼ä½ä½ æ¥æå¯¹åä¸ªå®ä¾çç»å¯¹æ§å¶æãæéå¸¸çè§£è¿ç§æ³æ³ãå½ä½ çå®¹å¨ååºç¨åå«åå ä¸ªç¸äºä¾èµçç»ä»¶ï¼èä½ æä¸æ¸å°åºæ¯åªä¸ª Sidecar å¯¼è´äºè®¤è¯å¤±è´¥æ¶ï¼ä¸å°æºå¨è·ä¸ä¸ªè¿ç¨çç®åæ¨¡å¼ç®ç´å¤ªè¯±äººäºãç¼æç³»ç»åæ»¡äºä¸ç¡®å®æ§ï¼æ¯å¦ Pod ä¼å ä¸ºä½ æ²¡å¯è§å°çèµæºååèè¢«éæ°è°åº¦ãè¿è®©äººæè§å¤±å»äºå¯¹ç³»ç»çææ§æã</p>
<h1 id="ç ´å±ä¹é">ç ´å±ä¹é</h1>
<p>è§£å³æ¹æ¡å¹¶ä¸æ¯æ¾å¼ Kubernetesãå¯¹äºè®¸å¤ä¸å¡åºæ¯èè¨ï¼å®ä¾ç¶æ¯æä½³éæ©ãä½åææ¯éè¦å»ºç«èµ·å·¥ç¨çºªå¾ï¼</p>
<ul>
<li>å¶ä¸ï¼å°½å¯è½ä½¿ç¨æç®¡æå¡ãPortainer çå»ºè®®éå¸¸ä¸­è¯ï¼å¦æä½ æ²¡ææ·±åç Kubernetes ååºï¼è¯·ç´æ¥ä½¿ç¨ EKSãAKS æ GKEãæ Control Plane åçº§ãetcd å¤ä»½ãNode çå½å¨æç®¡çè¿äºå·¥ä½äº¤ç»äºååãè½ç¶ä½ ä»éé¢å¯¹ä¸å¡å±é¢çå¤ææ§ï¼ä½è³å°åºç¡è®¾æ½å±çéæäººèäºãæè§è¿ä¸äºå°å¢éä¸ºäºæè°çå®å¨ææ§éè¦å¨è£¸æºä¸èªå»ºéç¾¤ï¼ç»æéå°åæ ¸ Bug æåäº etcd æ°æ®ï¼åæ²¡æç¾å¤æ¹æ¡ï¼ç¡¬ççåæºäºä¸å¨ã</li>
<li>å¶äºï¼æ¿è¿å°ç®åæ¶æãå¯¹å¼å¥çæ¯ä¸ª OperatorãCRDãåºç¡è®¾æ½ä»£ç  é½è¦ä¿æè´¨çãä½ ççéè¦ Service Mesh åï¼è¿æ¯ä»å ä¸º Netflix ç¨äºï¼æä»¥å°±ç²ç®è·é£ï¼è½å¦ç¨æ´ç®åçæ¹å¼ï¼æ¯å¦æ åç Ingress åè®¾è®¡åçç Service æ¥æ»¡è¶³éæ±ï¼ææ¾ç»ææ´å¥å¤æççæ§ææ¯æ ææï¼æ¢æäºæåºç¡ç Prometheus + Grafanaï¼ä»¥ 20% çè¿ç»´ææ¬å®ç°äºåç³»ç» 80% çåè½ãç¸ä¿¡æï¼ä¸ºäºé£å©ä¸ 20% çåè½èè¢«åæ¨ 3 ç¹çåè­¦çµè¯åµéï¼ç»å¯¹ä¸å¼ã</li>
<li>å¶ä¸ï¼å°ææ¡£è§ä¸ºåºç¡è®¾æ½çä¸é¨åãææçä¸æ¯é£äº API ææ¡£ï¼èæ¯æ¶æå³ç­è®°å½ãè§£éæ¸æ¥ä¸ºä»ä¹é Istio èä¸æ¯ Linkerdãæè¡¡äºä»ä¹ãå¸¸è§æéå¦ä½ææ¥ãè¦æéå¯¹é«é¢æéç Runbooksï¼è¦ææ¸æ°å±ç¤ºæµéä» Ingress å° Service åå° Pod çæ¶æå¾ãæåææ¡£ä½ä¸ºå¼ºå¶æ§è¦æ±ï¼å¹¶æå­£åº¦å®¡æ¥ãç®æ æ¯è®©æ°å¥èçåäºå¨å å¨åå°±è½ä¸æï¼èä¸æ¯èè´¹å ä¸ªææ¸ç´¢ã</li>
<li>å¶åï¼ç°åº¦åå¸ä¸æéæµè¯ãéç¨ Blue-green Deploymentsï¼ä½¿ç¨å¸¦æèªå¨åæ»æºå¶ç Canary Releasesãå¼å¥æ··æ²å·¥ç¨ï¼å¨å·¥ä½æ¶é´éæº kill Podï¼ççç¯å¢æå¤èå¼±ãå¦æè¿ Pod æäºé½æä¸ä½ï¼é£ä½ æå»ºçæ ¹æ¬ä¸æ¯ Kubernetes åºç¨ï¼èæ¯ä¸ä¸ªåå¸å¼åä½åºç¨ãKubernetes éæ¶å¯è½éæ°è°åº¦ Podï¼ä½ çåºç¨å¿é¡»è½å¤ä¼éå°å¤çè¿ç§æåµã</li>
<li>å¶äºï¼å¨å¹è®­ä¸æå¥çéç½é¶ãæ¯çæ­£çå®æå¹è®­ï¼èä¸æ¯ä¸¢ä¸ä¸å¥çææ¡£ãè¯·é£äºçæ­£ç»´æ¤è¿çäº§ç¯å¢ Kubernetes å¤å¹´çäººæ¥è®²ç»éªï¼è¿è¡å³äºæéææ¥ãç½ç»åçãå®¹éè§åçç è®¨ä¼ãéè¿ on-call è½®æ¢å¢éæåï¼è®©æ¯ä¸ªäººé½åèº«ä½ä¼ä¸ä¸ç³ç³çè®¾è®¡å¸¦æ¥ççè¦ãé£äºçæ­£æ Kubernetes å½ä½ä¸é¨ä¸¥èå·¥ç¨å­¦ç§æ¥å¯¹å¾ãå¹¶æç»­æåæè½çå¢éï¼å¾å°æ±æ¨ K8s å¤æãå ä¸ºä»ä»¬çè½åå·²ç»æé¿å°è¶³ä»¥é©¾é©­è¿ä¸ªå·¥å·äºã</li>
</ul>
<h1 id="è­¦ææ°å¥é·é±">è­¦ææ°å¥é·é±</h1>
<p>Kubernetes çæåå±æå¿«ï¼æ»ææ°é¡¹ç®å¨è¯´å¯ä»¥è§£å³ä½ ççç¹ãProgressive Delivery æ¡æ¶ãPolicy Enginesãä½ä¸º Admission Controllers è¿è¡çå®å¨æ«æå¨...ï¼åçæ¯ä¸ªé½å¾è¯±äººãCNCF Landscape ä¸å·²ç»æå ç¾ä¸ªé¡¹ç®äºï¼èä¸è¿å¨ä¸æ­å¢å ã</p>
<p>å¿ä½å«ä¹±å¨ãå¯¹é£äºä»ä»å ä¸º"æ°"èå­å¨çä¸è¥¿ä¿æè­¦æãå¼å¥æ¯ä¸ä¸ªæ°å·¥å·é½æ¯ä¸åºè±ªèµï¼ä½ èµçæ¯å¢éè½å­¦ä¼å®ãè½ç»´æ¤å®ï¼å¹¶ä¸å¨ååä¸è½æå®å®çæéãææ¶åä½ èµèµ¢äºï¼ä½æ´å¤æ¶åï¼å®åªæ¯å¢å äºç³»ç»çæ»å»é¢åæéç¹ãæè§è¿æçå¢éä¸¤å¹´æ¢äº 5 ä¸ª GitOps å·¥å·ï¼æ¯æ¬¡é½ä¿¡èªæ¦æ¦å°è¯´è¿ä¸ªææ¯ç»ææ¹æ¡ãç»æè¿ç§æè¾æ¬èº«å¸¦æ¥çé®é¢æ¯å·¥å·è§£å³çé®é¢è¿è¦å¤ã</p>
<p>å»ç¨é£äº"æ è"çææ¯å§ãç¨é£äºä¹ç»æ²åºç Kubernetes çæ¬ï¼ç¨é£äºç¤¾åºæ´»è·çä¸»æµå·¥å·ï¼ç¨é£äºè¢«æåä¸ä¸ä¸ªå¢ééªè¯è¿çé»è®¤éç½®ãè½ç¶è¿äºä¸è¥¿åä¸æè½å¨ææ¯å¤§ä¼ä¸å¹åç PPTï¼ä½è½è®©ä½ ç¡ä¸ªå¥½è§ã</p>
<h1 id="å°åºæ¯è°çé">å°åºæ¯è°çéï¼</h1>
<p>å½ä½ çéç¾¤å¤±æ§æ¶ï¼Pod æ ééå¯ãè¯¡å¼çç½ç»æéãéæºå¤±è´¥çé¨ç½²å¨ä½ ...ï¼å¨æéç©ç»å¼æºé¡¹ç®åï¼åå®¡è§ä¸ä¸ä½ æ¯æä¹æ­å»ºçå®ãKubernetes ç»äºä½ ä¸æè¶æçå·¥å·ï¼ä½ä½ å´é åºäºä¸å°ç²¾å¯å´èå¼±çä»ªå¨ãä¹è®¸å®ç¡®å®éè¦è¿ä¹å¤æï¼ä½å¤æ°æåµä¸å¹¶ä¸éè¦ã</p>
<p>æè°ç"Kubernetes å¤ææ§é®é¢"ï¼å½æ ¹ç»åºæ¯äººçé®é¢ãå¹è®­ä¸è¶³ãä¸ªäººè±éä¸»ä¹ãç¼ºä¹è¿ç»´çºªå¾ãç²ç®è¿½æ°ãè¯¯è¯»çå®éæ±...ï¼è¿äºæ¯å¯ä»¥çº æ­£çãä½å¹¶ä¸ä»æ¯æ¢ä¸ªå·¥å·å°±è½è§£å³çï¼éè¦å¯¹æäº Feature è¯´ä¸ï¼å¯¹é£äºçä¼¼èªæçè§£å³æ¹æ¡è¯´ä¸ï¼å¯¹èªå¨åè¶å¤è¶å¥½è¿ç§è¯±äººçé¬¼è¯ä¿ææ¸éã</p>
<p>æä»¬çç®æ æ¯æå»ºä¸ä¸ªå¢ééå¤§å¤æ°äººé½è½ç»´æ¤çå¹³å°ï¼èä¸æ¯åªæé£ä¸ªè¯»éäºææ SIG ä¼è®®çºªè¦ç Staff Engineer æè½æå®çç³»ç»ãç³»ç»çæç¨æ§ä¸<a href="https://en.wikipedia.org/wiki/Bus_factor" target="_blank" rel="noopener nofollow">å¬äº¤å ç´ </a>å¾éè¦ãå¦æä½ ç Kubernetes æ¶æå¤æå°åªæ Maya ä¸ä¸ªäººè½çæï¼é£ä½ æ¥æçæ ¹æ¬ä¸æ¯åºç¡è®¾æ½ï¼èæ¯ä¸ä¸ªç©¿çè¿å¸½è¡«çåç¹æéã</p>
<p>ä¿®å¤å·¥ä½ä»å¨ä¸æ©ä¸å¼å§ï¼å¥½å¥½å®¡è§ä¸ä¸ä½ çéç¾¤ãä»ç»ççå°åºéè¦å¤å°ä¸ªç»ä»¶ï¼åªäºæ¯å¿é¡»çï¼åªäºæ¯é¦ä¸æ·»è±çï¼å¦æç æä¸åç»ä»¶ä¼åçä»ä¹ï¼ä½ ç°å¨çææ¡£è½è®©ä¸å¨å¥èçæ°äººå¤ççº¿ä¸æéåï¼</p>
<p>Kubernetes çå·¥ä½è´è½½æ©å±è½åéå¸¸åºè²ï¼ä½å®æ æ³æ©å±æä»¬å¯¹å®ççè§£è½åï¼è¿æ¯æä»¬èªå·±çé®é¢ãæä»¬æ·±é·å¶ä¸­çæ¯ä¸åå¤ææ§ï¼é½æ¯æä»¬éè¿ä¸ä¸ªä¸ªçä¼¼åççå³ç­äº²æåä¸çãå¹³å°æ¬èº«æ²¡æå¤±è´¥ï¼æ¯æä»¬è¾è´äºå®ï¼æä»¬ç¼ºä¹æ¸æ°çè§åãä¸¥è°¨ççºªå¾ï¼ä»¥ååªæå»ºæä»¬è½å¤ç»´æ¤çç³»ç»è¿ç§è°¦éçæåº¦ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-28 16:08">2026-01-28 16:07</span>&nbsp;
<a href="https://www.cnblogs.com/manuscript">æä¹è¿å¨åä»£ç </a>&nbsp;
éè¯»(<span id="post_view_count">119</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19544375);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19544375', targetLink: 'https://www.cnblogs.com/manuscript/p/19544375', title: 'ä¸ºä»ä¹ Kubernetes æå¡ä¸­æ­éå¸¸æ¯äººä¸ºå¤±è¯¯ï¼èä¸æ¯å¹³å°èªèº«åå ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åä¸çº§å¤§è¡¨å¦ä½å é¤æ°æ®ï¼ ]]></title>
    <link>https://www.cnblogs.com/12lisu/p/19544371</link>
    <guid>971f31fe1b254957e31455cceae16b8d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/12lisu/p/19544371" title="åå¸äº 2026-01-28 16:07">
    <span role="heading" aria-level="2">åä¸çº§å¤§è¡¨å¦ä½å é¤æ°æ®ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="åè¨">åè¨</h2>
<p>ä»å¤©æä»¬æ¥èèä¸ä¸ªè®©å¾å¤DBAåå¼åèå¤´ç¼çè¯é¢ââåä¸çº§å¤§è¡¨çæ°æ®å é¤ã</p>
<p>æäºå°ä¼ä¼´å¨å·¥ä½ä¸­ï¼ä¸éå°å¤§è¡¨æ°æ®å é¤å°±æè¶³æ æªï¼è¦ä¹ç´æ¥<code>DELETE</code>å¯¼è´æ°æ®åºå¡æ­»ï¼è¦ä¹çæçèä¸æ¢æä½ã</p>
<p>æè§è¿å¤ªå¤å ä¸ºå¤§è¡¨å é¤æä½ä¸å½å¯¼è´ç"è¡æ¡"ï¼æ°æ®åºé¿æ¶é´éè¡¨ãä¸å¡ç³»ç»ç«çªãçè³ä¸»ä»åæ­¥å»¶è¿ã</p>
<p>ä»å¤©è·å¤§å®¶ä¸èµ·ä¸é¨èèåä¸çº§å¤§è¡¨æ°æ®å é¤çè¯é¢ï¼å¸æå¯¹ä½ ä¼ææå¸®å©ã</p>
<h2 id="ä¸ä¸ºä»ä¹å¤§è¡¨å é¤è¿ä¹é¾">ä¸ãä¸ºä»ä¹å¤§è¡¨å é¤è¿ä¹é¾ï¼</h2>
<p>å¨æ·±å¥ææ¯æ¹æ¡ä¹åï¼æä»¬åææ¸æ¥ä¸ºä»ä¹åä¸çº§å¤§è¡¨çæ°æ®å é¤ä¼å¦æ­¤å°é¾ã</p>
<p>æäºå°ä¼ä¼´å¯è½ä¼æ³ï¼"ä¸å°±æ¯ä¸ªDELETEè¯­å¥åï¼æä»ä¹é¾çï¼"</p>
<p>å¶å®è¿éé¢å¤§æå­¦é®ã</p>
<h3 id="æ°æ®åºå é¤æä½çåºå±åç">æ°æ®åºå é¤æä½çåºå±åç</h3>
<p>ä¸ºäºæ´ç´è§å°çè§£æ°æ®åºå é¤æä½çå·¥ä½åçï¼æç»äºä¸ä¸ªå é¤æä½çåºå±æµç¨å¾ï¼</p>
<p><img alt="" loading="lazy" data-src="https://files.mdnice.com/user/5303/0ebac9b1-c099-4199-8ed8-fdb0d20a0f27.png" class="lazyload"></p>
<p>ä»è¿å¼ å¾å¯ä»¥çåºï¼ä¸ä¸ªç®åçDELETEè¯­å¥èåéèçè¿ä¹å¤å¤æçæä½ã</p>
<p>è®©æä»¬è¯¦ç»åææ¯ä¸ªç¯èçææï¼</p>
<h3 id="1-äºå¡åéçææ">1. äºå¡åéçææ</h3>
<pre><code class="language-sql">-- ä¸ä¸ªçä¼¼ç®åçå é¤æä½
DELETE FROM user_operation_log 
WHERE create_time &lt; '2023-01-01';

-- å®éä¸MySQLä¼è¿æ ·å¤çï¼
-- 1. è·åè¡¨çåé
-- 2. éè¡æ«æ10,000,000æ¡è®°å½
-- 3. å¯¹æ¯æ¡å¹éçè®°å½ï¼
--    - åå¥undo logï¼ç¨äºåæ»ï¼
--    - åå¥redo logï¼ç¨äºæ¢å¤ï¼
--    - æ´æ°ææç¸å³ç´¢å¼
--    - æ è®°è®°å½ä¸ºå é¤ç¶æ
-- 4. äºå¡æäº¤åæçæ­£éæ¾ç©ºé´
</code></pre>
<h3 id="2-èµæºæ¶èé®é¢">2. èµæºæ¶èé®é¢</h3>
<ul>
<li><strong>ç£çI/O</strong>ï¼undo logãredo logãæ°æ®æä»¶ãç´¢å¼æä»¶çå¤§éåå¥</li>
<li><strong>CPU</strong>ï¼ç´¢å¼ç»´æ¤ãæ¡ä»¶å¤æ­ãäºå¡ç®¡ç</li>
<li><strong>åå­</strong>ï¼Buffer Poolç®¡çãéä¿¡æ¯ç»´æ¤</li>
<li><strong>ç½ç»</strong>ï¼ä¸»ä»åæ­¥æ°æ®éå·¨å¤§</li>
</ul>
<h3 id="3-ä¸å¡å½±åé£é©">3. ä¸å¡å½±åé£é©</h3>
<ul>
<li><strong>éç­å¾è¶æ¶</strong>ï¼å¶ä»æ¥è¯¢è¢«é»å¡</li>
<li><strong>ä¸»ä»å»¶è¿</strong>ï¼ä»åºåæ­¥è·ä¸ä¸</li>
<li><strong>ç£çç©ºé´</strong>ï¼undo logæ´å¢å¯¼è´ç£çåæ»¡</li>
<li><strong>æ§è½ä¸é</strong>ï¼æ°æ®åºæ´ä½æ§è½åå½±å</li>
</ul>
<p>æäºå°ä¼ä¼´å¯è½ä¼é®ï¼"æä»¬ç¨çæ¯äºæ°æ®åºï¼è¿äºé®é¢è¿å­å¨åï¼"</p>
<p>æçç»éªæ¯ï¼<strong>äºæ°æ®åºåªæ¯éä½äºè¿ç»´å¤æåº¦ï¼ä½åºå±åçåéå¶ä¾ç¶å­å¨</strong>ã</p>
<h2 id="äºæ¹æ¡ä¸åæ¹å é¤æå¸¸ç¨">äºãæ¹æ¡ä¸ï¼åæ¹å é¤ï¼æå¸¸ç¨ï¼</h2>
<p>åæ¹å é¤æ¯æåºç¡ä¹æ¯æå¸¸ç¨çæ¹æ¡ï¼æ ¸å¿ææ³æ¯"åæ´ä¸ºé¶"ï¼å°å¤§æä½æåæå¤ä¸ªå°æä½ã</p>
<h3 id="å®ç°åç">å®ç°åç</h3>
<p><img alt="" loading="lazy" data-src="https://files.mdnice.com/user/5303/3263a520-85c8-49a0-ad53-ea24951e80d8.png" class="lazyload"></p>
<h3 id="å·ä½å®ç°">å·ä½å®ç°</h3>
<h4 id="æ¹æ³1åºäºä¸»é®åæ¹">æ¹æ³1ï¼åºäºä¸»é®åæ¹</h4>
<pre><code class="language-sql">-- å­å¨è¿ç¨å®ç°åæ¹å é¤
DELIMITER $$
CREATE PROCEDURE batch_delete_by_id()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE batch_size INT DEFAULT 1000;
    DECLARE max_id BIGINT;
    DECLARE min_id BIGINT;
    DECLARE current_id BIGINT DEFAULT 0;
    
    -- è·åéè¦å é¤çæ°æ®èå´
    SELECT MIN(id), MAX(id) INTO min_id, max_id 
    FROM user_operation_log 
    WHERE create_time &lt; '2023-01-01';
    
    WHILE current_id &lt; max_id DO
        -- æ¯æ¬¡å é¤ä¸ä¸ªæ¹æ¬¡
        DELETE FROM user_operation_log 
        WHERE id BETWEEN current_id AND current_id + batch_size - 1
        AND create_time &lt; '2023-01-01';
        
        -- æäº¤äºå¡ï¼éæ¾é
        COMMIT;
        
        -- ä¼ç ä¸ä¸ï¼è®©æ°æ®åºåå£æ°
        DO SLEEP(0.1);
        
        -- æ´æ°è¿åº¦
        SET current_id = current_id + batch_size;
        
        -- è®°å½æ¥å¿ï¼å¯éï¼
        INSERT INTO delete_progress_log 
        VALUES (NOW(), current_id, batch_size);
    END WHILE;
END$$
DELIMITER ;
</code></pre>
<h4 id="æ¹æ³2åºäºæ¶é´åæ¹">æ¹æ³2ï¼åºäºæ¶é´åæ¹</h4>
<pre><code class="language-java">// Javaä»£ç å®ç°åºäºæ¶é´çåæ¹å é¤
@Service
@Slf4j
public class BatchDeleteService {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    /**
     * åºäºæ¶é´èå´çåæ¹å é¤
     */
    public void batchDeleteByTime(String tableName, String timeColumn, 
                                  Date startTime, Date endTime, 
                                  int batchDays) {
        
        Calendar calendar = Calendar.getInstance();
        calendar.setTime(startTime);
        
        int totalDeleted = 0;
        long startMs = System.currentTimeMillis();
        
        while (calendar.getTime().before(endTime)) {
            Date batchStart = calendar.getTime();
            calendar.add(Calendar.DAY_OF_YEAR, batchDays);
            Date batchEnd = calendar.getTime();
            
            // ç¡®ä¿ä¸è¶è¿ç»ææ¶é´
            if (batchEnd.after(endTime)) {
                batchEnd = endTime;
            }
            
            String sql = String.format(
                "DELETE FROM %s WHERE %s BETWEEN ? AND ? LIMIT 1000",
                tableName, timeColumn
            );
            
            int deleted = jdbcTemplate.update(sql, batchStart, batchEnd);
            totalDeleted += deleted;
            
            log.info("æ¹æ¬¡å é¤å®æ: {}-{}, å é¤{}æ¡, æ»è®¡{}æ¡",
                    batchStart, batchEnd, deleted, totalDeleted);
            
            // æ§å¶å é¤é¢çï¼é¿åå¯¹æ°æ®åºé æè¿å¤§åå
            if (deleted &gt; 0) {
                try {
                    Thread.sleep(500); // ä¼ç 500ms
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                    break;
                }
            } else {
                // æ²¡ææ°æ®å¯å ï¼è·³å°ä¸ä¸ä¸ªæ¶é´æ®µ
                continue;
            }
            
            // æ¯å é¤10000æ¡è®°å½ä¸æ¬¡è¿åº¦
            if (totalDeleted % 10000 == 0) {
                logProgress(totalDeleted, startMs);
            }
        }
        
        log.info("å é¤ä»»å¡å®æ! æ»è®¡å é¤{}æ¡è®°å½, èæ¶{}ç§",
                totalDeleted, (System.currentTimeMillis() - startMs) / 1000);
    }
    
    private void logProgress(int totalDeleted, long startMs) {
        long costMs = System.currentTimeMillis() - startMs;
        double recordsPerSecond = totalDeleted * 1000.0 / costMs;
        
        log.info("å é¤è¿åº¦: {}æ¡, éç: {}/ç§, èæ¶: {}ç§",
                totalDeleted, String.format("%.2f", recordsPerSecond), costMs / 1000);
    }
}
</code></pre>
<h4 id="æ¹æ³3ä½¿ç¨limitåæ¹å é¤">æ¹æ³3ï¼ä½¿ç¨LIMITåæ¹å é¤</h4>
<pre><code class="language-sql">-- ç®åçLIMITåæ¹å é¤
DELIMITER $$
CREATE PROCEDURE batch_delete_with_limit()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE batch_size INT DEFAULT 1000;
    DECLARE total_deleted INT DEFAULT 0;
    
    WHILE done = 0 DO
        -- æ¯æ¬¡å é¤1000æ¡
        DELETE FROM user_operation_log 
        WHERE create_time &lt; '2023-01-01' 
        LIMIT batch_size;
        
        -- æ£æ¥æ¯å¦è¿ææ°æ®
        SET done = ROW_COUNT() = 0;
        SET total_deleted = total_deleted + ROW_COUNT();
        
        -- æäº¤éæ¾é
        COMMIT;
        
        -- ä¼ç æ§å¶é¢ç
        DO SLEEP(0.1);
        
        -- æ¯å é¤10000æ¡è¾åºæ¥å¿
        IF total_deleted % 10000 = 0 THEN
            SELECT CONCAT('å·²å é¤: ', total_deleted, ' æ¡è®°å½') AS progress;
        END IF;
    END WHILE;
    
    SELECT CONCAT('å é¤å®æ! æ»è®¡: ', total_deleted, ' æ¡è®°å½') AS result;
END$$
DELIMITER ;
</code></pre>
<h3 id="åæ¹å é¤çæä½³å®è·µ">åæ¹å é¤çæä½³å®è·µ</h3>
<ol>
<li>
<p><strong>æ¹æ¬¡å¤§å°éæ©</strong></p>
<ul>
<li>å°è¡¨ï¼1000-5000æ¡/æ¹æ¬¡</li>
<li>å¤§è¡¨ï¼100-1000æ¡/æ¹æ¬¡</li>
<li>éè¦æ ¹æ®å®éæåµè°æ´</li>
</ul>
</li>
<li>
<p><strong>ä¼ç æ¶é´æ§å¶</strong></p>
<ul>
<li>ä¸å¡é«å³°æï¼ä¼ç 1-2ç§</li>
<li>ä¸å¡ä½å³°æï¼ä¼ç 100-500æ¯«ç§</li>
<li>å¤é´ç»´æ¤ï¼å¯ä¸ä¼ç æç­æä¼ç </li>
</ul>
</li>
<li>
<p><strong>çæ§åè°æ´</strong></p>
<ul>
<li>çæ§æ°æ®åºè´è½½</li>
<li>è§å¯ä¸»ä»åæ­¥å»¶è¿</li>
<li>æ ¹æ®å®éæåµå¨æè°æ´åæ°</li>
</ul>
</li>
</ol>
<h2 id="ä¸æ¹æ¡äºåå»ºæ°è¡¨éå½å">ä¸ãæ¹æ¡äºï¼åå»ºæ°è¡¨+éå½å</h2>
<p>å½éè¦å é¤è¡¨ä¸­å¤§é¨åæ°æ®æ¶ï¼åå»ºæ°è¡¨ç¶åéå½åçæ¹å¼å¾å¾æ´é«æã</p>
<h3 id="å®ç°åç-1">å®ç°åç</h3>
<p><img alt="" loading="lazy" data-src="https://files.mdnice.com/user/5303/b0ad181f-5784-4353-a0fd-0f3666006e1d.png" class="lazyload"></p>
<h3 id="å·ä½å®ç°-1">å·ä½å®ç°</h3>
<pre><code class="language-sql">-- æ­¥éª¤1: åå»ºæ°è¡¨ï¼ç»æååè¡¨ï¼
CREATE TABLE user_operation_log_new LIKE user_operation_log;

-- æ­¥éª¤2: å¯¼å¥éè¦ä¿ççæ°æ®
INSERT INTO user_operation_log_new 
SELECT * FROM user_operation_log 
WHERE create_time &gt;= '2023-01-01';

-- æ­¥éª¤3: åå»ºç´¢å¼ï¼å¨æ°æ®å¯¼å¥ååå»ºï¼æçæ´é«ï¼
ALTER TABLE user_operation_log_new ADD INDEX idx_create_time(create_time);
ALTER TABLE user_operation_log_new ADD INDEX idx_user_id(user_id);

-- æ­¥éª¤4: æ°æ®éªè¯
SELECT 
    (SELECT COUNT(*) FROM user_operation_log_new) as new_count,
    (SELECT COUNT(*) FROM user_operation_log WHERE create_time &gt;= '2023-01-01') as expected_count;

-- æ­¥éª¤5: åå­åæ¢ï¼éè¦å¾ç­çè¡¨éï¼
RENAME TABLE 
    user_operation_log TO user_operation_log_old,
    user_operation_log_new TO user_operation_log;

-- æ­¥éª¤6: å é¤æ§è¡¨ï¼å¯éç«å³å é¤æå»¶åå é¤ï¼
DROP TABLE user_operation_log_old;
</code></pre>
<h3 id="javaä»£ç è¾å©å®ç°">Javaä»£ç è¾å©å®ç°</h3>
<pre><code class="language-java">@Service  
@Slf4j
public class TableRebuildService {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    /**
     * éå»ºè¡¨æ¹å¼å é¤æ°æ®
     */
    public void rebuildTableForDeletion(String sourceTable, String condition) {
        String newTable = sourceTable + "_new";
        String oldTable = sourceTable + "_old";
        
        try {
            // 1. åå»ºæ°è¡¨
            log.info("å¼å§åå»ºæ°è¡¨: {}", newTable);
            jdbcTemplate.execute("CREATE TABLE " + newTable + " LIKE " + sourceTable);
            
            // 2. å¯¼å¥éè¦ä¿ççæ°æ®
            log.info("å¼å§å¯¼å¥ä¿çæ°æ®");
            String insertSql = String.format(
                "INSERT INTO %s SELECT * FROM %s WHERE %s", 
                newTable, sourceTable, condition
            );
            int keptCount = jdbcTemplate.update(insertSql);
            log.info("æåå¯¼å¥{}æ¡ä¿çæ°æ®", keptCount);
            
            // 3. åå»ºç´¢å¼ï¼å¯éï¼å¨å¯¼å¥ååå»ºç´¢å¼æçæ´é«ï¼
            log.info("å¼å§åå»ºç´¢å¼");
            createIndexes(newTable);
            
            // 4. æ°æ®éªè¯
            log.info("å¼å§æ°æ®éªè¯");
            if (!validateData(sourceTable, newTable, condition)) {
                throw new RuntimeException("æ°æ®éªè¯å¤±è´¥");
            }
            
            // 5. åå­åæ¢
            log.info("å¼å§è¡¨åæ¢");
            switchTables(sourceTable, newTable, oldTable);
            
            // 6. å é¤æ§è¡¨ï¼å¯éç«å³æå»¶åï¼
            log.info("å¼å§å é¤æ§è¡¨");
            dropTableSafely(oldTable);
            
            log.info("è¡¨éå»ºå é¤å®æ!");
            
        } catch (Exception e) {
            log.error("è¡¨éå»ºè¿ç¨åçå¼å¸¸", e);
            // æ¸çä¸´æ¶è¡¨
            cleanupTempTable(newTable);
            throw e;
        }
    }
    
    private void createIndexes(String tableName) {
        // æ ¹æ®ä¸å¡éè¦åå»ºç´¢å¼
        String[] indexes = {
            "CREATE INDEX idx_create_time ON " + tableName + "(create_time)",
            "CREATE INDEX idx_user_id ON " + tableName + "(user_id)"
        };
        
        for (String sql : indexes) {
            jdbcTemplate.execute(sql);
        }
    }
    
    private boolean validateData(String sourceTable, String newTable, String condition) {
        // éªè¯æ°è¡¨æ°æ®éæ¯å¦æ­£ç¡®
        Integer newCount = jdbcTemplate.queryForObject(
            "SELECT COUNT(*) FROM " + newTable, Integer.class);
        
        Integer expectedCount = jdbcTemplate.queryForObject(
            "SELECT COUNT(*) FROM " + sourceTable + " WHERE " + condition, Integer.class);
        
        return newCount.equals(expectedCount);
    }
    
    private void switchTables(String sourceTable, String newTable, String oldTable) {
        // åå­æ§çè¡¨éå½åæä½
        String sql = String.format(
            "RENAME TABLE %s TO %s, %s TO %s", 
            sourceTable, oldTable, newTable, sourceTable
        );
        jdbcTemplate.execute(sql);
    }
    
    private void dropTableSafely(String tableName) {
        try {
            jdbcTemplate.execute("DROP TABLE " + tableName);
        } catch (Exception e) {
            log.warn("å é¤è¡¨å¤±è´¥: {}, éè¦æå¨æ¸ç", tableName, e);
        }
    }
    
    private void cleanupTempTable(String tableName) {
        try {
            jdbcTemplate.execute("DROP TABLE IF EXISTS " + tableName);
        } catch (Exception e) {
            log.warn("æ¸çä¸´æ¶è¡¨å¤±è´¥: {}", tableName, e);
        }
    }
}
</code></pre>
<h3 id="éç¨åºæ¯">éç¨åºæ¯</h3>
<ul>
<li>éè¦å é¤è¡¨ä¸­è¶è¿50%çæ°æ®</li>
<li>ä¸å¡åè®¸ç­æçååé¡¿ï¼éå½åæ¶éè¦ï¼</li>
<li>æè¶³å¤çç£çç©ºé´å­å¨æ°æ§ä¸¤ä¸ªè¡¨</li>
</ul>
<h2 id="åæ¹æ¡ä¸ååºè¡¨å é¤">åãæ¹æ¡ä¸ï¼ååºè¡¨å é¤</h2>
<p>å¦æè¡¨å·²ç»åäºååºï¼æèå¯ä»¥æ¹é ä¸ºååºè¡¨ï¼é£ä¹å é¤æ°æ®å°±ä¼åå¾éå¸¸ç®åã</p>
<h3 id="å®ç°åç-2">å®ç°åç</h3>
<p><img alt="" loading="lazy" data-src="https://files.mdnice.com/user/5303/27cb2e0b-fab9-4db6-83ae-9348f0ccdbe1.png" class="lazyload"></p>
<h3 id="å·ä½å®ç°-2">å·ä½å®ç°</h3>
<h4 id="æ¹æ³1ä½¿ç¨ç°æååºè¡¨">æ¹æ³1ï¼ä½¿ç¨ç°æååºè¡¨</h4>
<pre><code class="language-sql">-- æ¥çè¡¨çååºæåµ
SELECT table_name, partition_name, table_rows
FROM information_schema.partitions 
WHERE table_name = 'user_operation_log';

-- ç´æ¥å é¤æ´ä¸ªååºï¼ç§çº§å®æï¼
ALTER TABLE user_operation_log DROP PARTITION p202201, p202202;

-- å®æå é¤è¿æååºçå­å¨è¿ç¨
DELIMITER $$
CREATE PROCEDURE auto_drop_expired_partitions()
BEGIN
    DECLARE expired_partition VARCHAR(64);
    DECLARE done INT DEFAULT FALSE;
    
    -- æ¥æ¾éè¦å é¤çååºï¼ä¿çæè¿12ä¸ªæï¼
    DECLARE cur CURSOR FOR 
    SELECT partition_name 
    FROM information_schema.partitions 
    WHERE table_name = 'user_operation_log' 
    AND partition_name LIKE 'p%'
    AND STR_TO_DATE(REPLACE(partition_name, 'p', ''), '%Y%m') &lt; DATE_SUB(NOW(), INTERVAL 12 MONTH);
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    
    OPEN cur;
    
    read_loop: LOOP
        FETCH cur INTO expired_partition;
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        -- å é¤è¿æååº
        SET @sql = CONCAT('ALTER TABLE user_operation_log DROP PARTITION ', expired_partition);
        PREPARE stmt FROM @sql;
        EXECUTE stmt;
        DEALLOCATE PREPARE stmt;
        
        -- è®°å½æ¥å¿
        INSERT INTO partition_clean_log 
        VALUES (NOW(), expired_partition, 'DROPPED');
    END LOOP;
    
    CLOSE cur;
END$$
DELIMITER ;
</code></pre>
<h4 id="æ¹æ³2æ¹é æ®éè¡¨ä¸ºååºè¡¨">æ¹æ³2ï¼æ¹é æ®éè¡¨ä¸ºååºè¡¨</h4>
<pre><code class="language-sql">-- å°æ®éè¡¨æ¹é æååºè¡¨
-- æ­¥éª¤1: åå»ºååºè¡¨
CREATE TABLE user_operation_log_partitioned (
    id BIGINT AUTO_INCREMENT,
    user_id BIGINT,
    operation VARCHAR(100),
    create_time DATETIME,
    PRIMARY KEY (id, create_time)  -- ååºé®å¿é¡»åå«å¨ä¸»é®ä¸­
) PARTITION BY RANGE (YEAR(create_time)*100 + MONTH(create_time)) (
    PARTITION p202201 VALUES LESS THAN (202202),
    PARTITION p202202 VALUES LESS THAN (202203),
    PARTITION p202203 VALUES LESS THAN (202204),
    PARTITION p202204 VALUES LESS THAN (202205),
    PARTITION pfuture VALUES LESS THAN MAXVALUE
);

-- æ­¥éª¤2: å¯¼å¥æ°æ®
INSERT INTO user_operation_log_partitioned 
SELECT * FROM user_operation_log;

-- æ­¥éª¤3: åæ¢è¡¨
RENAME TABLE 
    user_operation_log TO user_operation_log_old,
    user_operation_log_partitioned TO user_operation_log;

-- æ­¥éª¤4: å®æç»´æ¤ï¼æ·»å æ°ååº
ALTER TABLE user_operation_log REORGANIZE PARTITION pfuture INTO (
    PARTITION p202205 VALUES LESS THAN (202206),
    PARTITION p202206 VALUES LESS THAN (202207),
    PARTITION pfuture VALUES LESS THAN MAXVALUE
);
</code></pre>
<h3 id="javaä»£ç å®ç°ååºç®¡ç">Javaä»£ç å®ç°ååºç®¡ç</h3>
<pre><code class="language-java">@Service
@Slf4j
public class PartitionManagerService {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    /**
     * èªå¨ç®¡çååº
     */
    @Scheduled(cron = "0 0 2 * * ?")  // æ¯å¤©åæ¨2ç¹æ§è¡
    public void autoManagePartitions() {
        log.info("å¼å§ååºç»´æ¤ä»»å¡");
        
        try {
            // 1. å é¤è¿æååºï¼ä¿çæè¿12ä¸ªæï¼
            dropExpiredPartitions();
            
            // 2. åå»ºæªæ¥ååº
            createFuturePartitions();
            
            log.info("ååºç»´æ¤ä»»å¡å®æ");
            
        } catch (Exception e) {
            log.error("ååºç»´æ¤ä»»å¡å¤±è´¥", e);
        }
    }
    
    private void dropExpiredPartitions() {
        String sql = "SELECT partition_name " +
                    "FROM information_schema.partitions " +
                    "WHERE table_name = 'user_operation_log' " +
                    "AND partition_name LIKE 'p%' " +
                    "AND STR_TO_DATE(REPLACE(partition_name, 'p', ''), '%Y%m') &lt; DATE_SUB(NOW(), INTERVAL 12 MONTH)";
        
        List&lt;String&gt; expiredPartitions = jdbcTemplate.queryForList(sql, String.class);
        
        for (String partition : expiredPartitions) {
            try {
                jdbcTemplate.execute("ALTER TABLE user_operation_log DROP PARTITION " + partition);
                log.info("æåå é¤ååº: {}", partition);
                
                // è®°å½æä½æ¥å¿
                logPartitionOperation("DROP", partition, "SUCCESS");
                
            } catch (Exception e) {
                log.error("å é¤ååºå¤±è´¥: {}", partition, e);
                logPartitionOperation("DROP", partition, "FAILED: " + e.getMessage());
            }
        }
    }
    
    private void createFuturePartitions() {
        // åå»ºæªæ¥3ä¸ªæçååº
        for (int i = 1; i &lt;= 3; i++) {
            LocalDate futureDate = LocalDate.now().plusMonths(i);
            String partitionName = "p" + futureDate.format(DateTimeFormatter.ofPattern("yyyyMM"));
            int partitionValue = futureDate.getYear() * 100 + futureDate.getMonthValue();
            int nextPartitionValue = partitionValue + 1;
            
            try {
                String sql = String.format(
                    "ALTER TABLE user_operation_log REORGANIZE PARTITION pfuture INTO (" +
                    "PARTITION %s VALUES LESS THAN (%d), " +
                    "PARTITION pfuture VALUES LESS THAN MAXVALUE)",
                    partitionName, nextPartitionValue
                );
                
                jdbcTemplate.execute(sql);
                log.info("æååå»ºååº: {}", partitionName);
                logPartitionOperation("CREATE", partitionName, "SUCCESS");
                
            } catch (Exception e) {
                log.warn("åå»ºååºå¤±è´¥ï¼å¯è½å·²å­å¨ï¼: {}", partitionName, e);
            }
        }
    }
    
    private void logPartitionOperation(String operation, String partition, String status) {
        jdbcTemplate.update(
            "INSERT INTO partition_operation_log(operation, partition_name, status, create_time) VALUES (?, ?, ?, NOW())",
            operation, partition, status
        );
    }
}
</code></pre>
<h3 id="ååºè¡¨çä¼å¿">ååºè¡¨çä¼å¿</h3>
<ol>
<li><strong>å é¤æçæé«</strong>ï¼ç´æ¥å é¤ååºæä»¶</li>
<li><strong>ä¸å½±åä¸å¡</strong>ï¼æ éè¡¨é£é©</li>
<li><strong>ç®¡çæ¹ä¾¿</strong>ï¼å¯ä»¥èªå¨åç®¡ç</li>
<li><strong>æ¥è¯¢ä¼å</strong>ï¼ååºè£åªæåæ¥è¯¢æ§è½</li>
</ol>
<h2 id="äºæ¹æ¡åä½¿ç¨ä¸´æ¶è¡¨åæ­¥">äºãæ¹æ¡åï¼ä½¿ç¨ä¸´æ¶è¡¨åæ­¥</h2>
<p>å¯¹äºéè¦å¨çº¿å é¤ä¸ä¸è½åæ­¢æå¡çåºæ¯ï¼å¯ä»¥ä½¿ç¨ä¸´æ¶è¡¨åæ­¥çæ¹å¼ã</p>
<h3 id="å®ç°åç-3">å®ç°åç</h3>
<p><img alt="" loading="lazy" data-src="https://files.mdnice.com/user/5303/5fad6bd5-e427-48f6-8e0e-6c3b71b8f7f2.png" class="lazyload"></p>
<h3 id="å·ä½å®ç°-3">å·ä½å®ç°</h3>
<pre><code class="language-java">@Service
@Slf4j
public class OnlineTableMigrationService {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    /**
     * å¨çº¿è¡¨è¿ç§»å é¤
     */
    public void onlineMigrationDelete(String sourceTable, String condition) {
        String newTable = sourceTable + "_new";
        String tempTable = sourceTable + "_temp";
        
        try {
            // é¶æ®µ1: åå¤é¶æ®µ
            log.info("=== é¶æ®µ1: åå¤é¶æ®µ ===");
            prepareMigration(sourceTable, newTable, tempTable);
            
            // é¶æ®µ2: ååé¶æ®µ
            log.info("=== é¶æ®µ2: ååé¶æ®µ ===");
            enableDoubleWrite(sourceTable, newTable);
            
            // é¶æ®µ3: æ°æ®åæ­¥é¶æ®µ
            log.info("=== é¶æ®µ3: æ°æ®åæ­¥é¶æ®µ ===");
            syncExistingData(sourceTable, newTable, condition);
            
            // é¶æ®µ4: éªè¯é¶æ®µ
            log.info("=== é¶æ®µ4: éªè¯é¶æ®µ ===");
            if (!validateDataSync(sourceTable, newTable)) {
                throw new RuntimeException("æ°æ®åæ­¥éªè¯å¤±è´¥");
            }
            
            // é¶æ®µ5: åæ¢é¶æ®µ
            log.info("=== é¶æ®µ5: åæ¢é¶æ®µ ===");
            switchToNewTable(sourceTable, newTable, tempTable);
            
            // é¶æ®µ6: æ¸çé¶æ®µ
            log.info("=== é¶æ®µ6: æ¸çé¶æ®µ ===");
            cleanupAfterSwitch(sourceTable, tempTable);
            
            log.info("å¨çº¿è¿ç§»å é¤å®æ!");
            
        } catch (Exception e) {
            log.error("å¨çº¿è¿ç§»è¿ç¨åçå¼å¸¸", e);
            // åæ»åå
            disableDoubleWrite();
            throw e;
        }
    }
    
    private void prepareMigration(String sourceTable, String newTable, String tempTable) {
        // å¤ä»½åè¡¨
        jdbcTemplate.execute("CREATE TABLE " + tempTable + " LIKE " + sourceTable);
        jdbcTemplate.execute("INSERT INTO " + tempTable + " SELECT * FROM " + sourceTable);
        
        // åå»ºæ°è¡¨
        jdbcTemplate.execute("CREATE TABLE " + newTable + " LIKE " + sourceTable);
    }
    
    private void enableDoubleWrite(String sourceTable, String newTable) {
        // è¿ééè¦ä¿®æ¹åºç¨å±ä»£ç ï¼å®ç°åå
        // æèå¨æ°æ®åºå±ä½¿ç¨è§¦åå¨ï¼ä¸æ¨èï¼å½±åæ§è½ï¼
        log.info("è¯·éç½®åºç¨å±åå: åæ¶åå¥ {} å {}", sourceTable, newTable);
        
        // ç­å¾ååéç½®çæ
        sleep(5000);
    }
    
    private void syncExistingData(String sourceTable, String newTable, String condition) {
        log.info("å¼å§åæ­¥å­éæ°æ®");
        
        // åæ­¥ç¬¦åæ¡ä»¶çæ°æ®å°æ°è¡¨
        String syncSql = String.format(
            "INSERT IGNORE INTO %s SELECT * FROM %s WHERE %s", 
            newTable, sourceTable, condition
        );
        
        int syncedCount = jdbcTemplate.update(syncSql);
        log.info("å­éæ°æ®åæ­¥å®æ: {} æ¡è®°å½", syncedCount);
        
        // ç­å¾ååè¿½å¹³å¢éæ°æ®
        log.info("ç­å¾å¢éæ°æ®è¿½å¹³...");
        sleep(30000); // ç­å¾30ç§ï¼æ ¹æ®ä¸å¡è°æ´
        
        // æ£æ¥æ°æ®ä¸è´æ§
        checkDataConsistency(sourceTable, newTable);
    }
    
    private void checkDataConsistency(String sourceTable, String newTable) {
        // æ£æ¥å³é®ä¸å¡æ°æ®çä¸è´æ§
        Integer sourceCount = jdbcTemplate.queryForObject(
            "SELECT COUNT(*) FROM " + sourceTable, Integer.class);
        
        Integer newCount = jdbcTemplate.queryForObject(
            "SELECT COUNT(*) FROM " + newTable, Integer.class);
        
        log.info("æ°æ®ä¸è´æ§æ£æ¥: åè¡¨{}æ¡, æ°è¡¨{}æ¡", sourceCount, newCount);
        
        // è¿éå¯ä»¥æ·»å æ´è¯¦ç»çä¸è´æ§æ£æ¥
    }
    
    private boolean validateDataSync(String sourceTable, String newTable) {
        // éªè¯æ°æ®åæ­¥çæ­£ç¡®æ§
        // è¿éå¯ä»¥å®ç°æ´å¤æçéªè¯é»è¾
        
        log.info("æ°æ®åæ­¥éªè¯éè¿");
        return true;
    }
    
    private void switchToNewTable(String sourceTable, String newTable, String tempTable) {
        // ç­æååï¼æ ¹æ®ä¸å¡æåµï¼å¯è½ä¸éè¦ï¼
        log.info("å¼å§åååæ¢...");
        sleep(5000); // åå5ç§
        
        // åå­åæ¢
        jdbcTemplate.execute("RENAME TABLE " + 
            sourceTable + " TO " + sourceTable + "_backup, " +
            newTable + " TO " + sourceTable);
        
        log.info("è¡¨åæ¢å®æ");
    }
    
    private void cleanupAfterSwitch(String sourceTable, String tempTable) {
        // å³é­åå
        disableDoubleWrite();
        
        // å»¶è¿å é¤å¤ä»½è¡¨ï¼ä¿çä¸æ®µæ¶é´ï¼
        log.info("å¤ä»½è¡¨ä¿ç: {}_backup", sourceTable);
        log.info("ä¸´æ¶è¡¨å·²å é¤: {}", tempTable);
        
        jdbcTemplate.execute("DROP TABLE " + tempTable);
    }
    
    private void disableDoubleWrite() {
        log.info("è¯·å³é­åºç¨å±ååéç½®");
    }
    
    private void sleep(long millis) {
        try {
            Thread.sleep(millis);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre>
<h2 id="å­æ¹æ¡äºä½¿ç¨ä¸ä¸å·¥å·">å­ãæ¹æ¡äºï¼ä½¿ç¨ä¸ä¸å·¥å·</h2>
<p>å¯¹äºç¹å«å¤§çè¡¨æèå¤æçå é¤éæ±ï¼å¯ä»¥ä½¿ç¨ä¸ä¸çæ°æ®åºå·¥å·ã</p>
<h3 id="1-pt-archiverpercona-toolkit">1. pt-archiverï¼Percona Toolkitï¼</h3>
<pre><code class="language-bash"># å®è£Percona Toolkit
# Ubuntu/Debian: 
sudo apt-get install percona-toolkit

# ä½¿ç¨pt-archiverå½æ¡£å é¤æ°æ®
pt-archiver \
    --source h=localhost,D=test,t=user_operation_log \
    --where "create_time &lt; '2023-01-01'" \
    --limit 1000 \
    --commit-each \
    --sleep 0.1 \
    --statistics \
    --progress 10000 \
    --why-not \
    --dry-run  # åè¯è¿è¡ï¼ç¡®è®¤æ è¯¯åç§»é¤æ­¤åæ°

# å®éæ§è¡å é¤
pt-archiver \
    --source h=localhost,D=test,t=user_operation_log \
    --where "create_time &lt; '2023-01-01'" \
    --limit 1000 \
    --commit-each \
    --sleep 0.1 \
    --purge
</code></pre>
<h3 id="2-èªå®ä¹å·¥å·ç±»">2. èªå®ä¹å·¥å·ç±»</h3>
<pre><code class="language-java">@Component
@Slf4j
public class SmartDeleteTool {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    /**
     * æºè½å é¤å³ç­
     */
    public void smartDelete(String tableName, String condition) {
        try {
            // 1. åæè¡¨ç¶æ
            TableAnalysisResult analysis = analyzeTable(tableName, condition);
            
            // 2. æ ¹æ®åæç»æéæ©æä½³æ¹æ¡
            DeleteStrategy strategy = chooseBestStrategy(analysis);
            
            // 3. æ§è¡å é¤
            executeDelete(strategy, tableName, condition);
            
        } catch (Exception e) {
            log.error("æºè½å é¤å¤±è´¥", e);
            throw e;
        }
    }
    
    private TableAnalysisResult analyzeTable(String tableName, String condition) {
        TableAnalysisResult result = new TableAnalysisResult();
        
        // åæè¡¨å¤§å°
        result.setTotalRows(getTableRowCount(tableName));
        result.setDeleteRows(getDeleteRowCount(tableName, condition));
        result.setDeleteRatio(result.getDeleteRows() * 1.0 / result.getTotalRows());
        
        // åæè¡¨ç»æ
        result.setHasPartition(isTablePartitioned(tableName));
        result.setHasPrimaryKey(hasPrimaryKey(tableName));
        result.setIndexCount(getIndexCount(tableName));
        
        // åæç³»ç»è´è½½
        result.setSystemLoad(getSystemLoad());
        
        return result;
    }
    
    private DeleteStrategy chooseBestStrategy(TableAnalysisResult analysis) {
        if (analysis.isHasPartition() &amp;&amp; analysis.getDeleteRatio() &gt; 0.3) {
            return DeleteStrategy.PARTITION_DROP;
        }
        
        if (analysis.getDeleteRatio() &gt; 0.5) {
            return DeleteStrategy.TABLE_REBUILD;
        }
        
        if (analysis.getTotalRows() &gt; 10_000_000) {
            return DeleteStrategy.BATCH_DELETE_WITH_PAUSE;
        }
        
        return DeleteStrategy.BATCH_DELETE;
    }
    
    private void executeDelete(DeleteStrategy strategy, String tableName, String condition) {
        switch (strategy) {
            case PARTITION_DROP:
                executePartitionDrop(tableName, condition);
                break;
            case TABLE_REBUILD:
                executeTableRebuild(tableName, condition);
                break;
            case BATCH_DELETE_WITH_PAUSE:
                executeBatchDeleteWithPause(tableName, condition);
                break;
            default:
                executeBatchDelete(tableName, condition);
        }
    }
    
    // åç§ç­ç¥çå·ä½å®ç°...
    
    private long getTableRowCount(String tableName) {
        String sql = "SELECT COUNT(*) FROM " + tableName;
        return jdbcTemplate.queryForObject(sql, Long.class);
    }
    
    private long getDeleteRowCount(String tableName, String condition) {
        String sql = "SELECT COUNT(*) FROM " + tableName + " WHERE " + condition;
        return jdbcTemplate.queryForObject(sql, Long.class);
    }
    
    private boolean isTablePartitioned(String tableName) {
        String sql = "SELECT COUNT(*) FROM information_schema.partitions " +
                    "WHERE table_name = ? AND partition_name IS NOT NULL";
        Integer count = jdbcTemplate.queryForObject(sql, Integer.class, tableName);
        return count != null &amp;&amp; count &gt; 0;
    }
    
    // å¶ä»åææ¹æ³...
}

enum DeleteStrategy {
    BATCH_DELETE,           // æ®éåæ¹å é¤
    BATCH_DELETE_WITH_PAUSE, // å¸¦ä¼ç çåæ¹å é¤
    TABLE_REBUILD,          // éå»ºè¡¨
    PARTITION_DROP,         // å é¤ååº
    ONLINE_MIGRATION        // å¨çº¿è¿ç§»
}

@Data
class TableAnalysisResult {
    private long totalRows;
    private long deleteRows;
    private double deleteRatio;
    private boolean hasPartition;
    private boolean hasPrimaryKey;
    private int indexCount;
    private double systemLoad;
}
</code></pre>
<h2 id="ä¸æ¹æ¡å¯¹æ¯ä¸éæ©æå">ä¸ãæ¹æ¡å¯¹æ¯ä¸éæ©æå</h2>
<p>ä¸ºäºå¸®å©å¤§å®¶éæ©åéçæ¹æ¡ï¼ææ´çäºè¯¦ç»çå¯¹æ¯è¡¨ï¼</p>
<h3 id="æ¹æ¡å¯¹æ¯ç©éµ">æ¹æ¡å¯¹æ¯ç©éµ</h3>
<table>
<thead>
<tr>
<th>æ¹æ¡</th>
<th>éç¨åºæ¯</th>
<th>ä¼ç¹</th>
<th>ç¼ºç¹</th>
<th>é£é©ç­çº§</th>
</tr>
</thead>
<tbody>
<tr>
<td>åæ¹å é¤</td>
<td>å°æ¹éå é¤ï¼<br>å é¤æ¯ä¾&lt;30%</td>
<td>å®ç°ç®åï¼<br>æ éåæ</td>
<td>æ§è¡æ¶é´é¿ï¼<br>å¯è½éè¡¨</td>
<td>ä¸­</td>
</tr>
<tr>
<td>éå»ºè¡¨</td>
<td>å é¤æ¯ä¾&gt;50%ï¼<br>å¯æ¥åç­æåå</td>
<td>æ§è¡éåº¦å¿«ï¼<br>æ´çè¡¨ç¢ç</td>
<td>éè¦ååï¼<br>éè¦é¢å¤ç©ºé´</td>
<td>é«</td>
</tr>
<tr>
<td>ååºå é¤</td>
<td>è¡¨å·²ååºæå¯ååº</td>
<td>ç§çº§å®æï¼<br>æ æ§è½å½±å</td>
<td>éè¦åæè§åï¼<br>æ¹é ææ¬</td>
<td>ä½</td>
</tr>
<tr>
<td>å¨çº¿åæ­¥</td>
<td>è¦æ±é¶åæºï¼<br>éè¦ä¸å¡è¡¨</td>
<td>ä¸å¡æ æç¥ï¼<br>å®å¨å¯é </td>
<td>å®ç°å¤æï¼<br>å¨æè¾é¿</td>
<td>ä¸­</td>
</tr>
<tr>
<td>ä¸ä¸å·¥å·</td>
<td>å¤æåºæ¯ï¼<br>è¶å¤§è¡¨æä½</td>
<td>åè½å¼ºå¤§ï¼<br>èªå¨ä¼å</td>
<td>å­¦ä¹ ææ¬ï¼<br>ä¾èµå¤é¨å·¥å·</td>
<td>ä¸­</td>
</tr>
</tbody>
</table>
<h3 id="éæ©å³ç­æµç¨å¾">éæ©å³ç­æµç¨å¾</h3>
<p><img alt="" loading="lazy" data-src="https://files.mdnice.com/user/5303/b4626fb0-6cea-4c35-87b4-f87db2fd293c.png" class="lazyload"></p>
<h3 id="å®æå»ºè®®">å®æå»ºè®®</h3>
<ol>
<li><strong>æµè¯ç¯å¢éªè¯</strong>ï¼ä»»ä½å é¤æ¹æ¡é½è¦åå¨æµè¯ç¯å¢éªè¯</li>
<li><strong>å¤ä»½ä¼å</strong>ï¼å é¤åä¸å®è¦å¤ä»½æ°æ®</li>
<li><strong>ä¸å¡ä½å³°æ</strong>ï¼éæ©ä¸å¡ä½å³°ææ§è¡å é¤æä½</li>
<li><strong>çæ§åè­¦</strong>ï¼å®æ¶çæ§æ°æ®åºç¶æï¼è®¾ç½®åè­¦éå¼</li>
<li><strong>åæ»é¢æ¡</strong>ï¼åå¤å®åçåæ»æ¹æ¡</li>
</ol>
<p>æ´å¤é¡¹ç®å®æï¼susan.net.cn/project</p>
<h2 id="æ»ç»">æ»ç»</h2>
<p>ç»è¿ä¸é¢çè¯¦ç»åæï¼æä»¬æ¥æ»ç»ä¸ä¸åä¸çº§å¤§è¡¨æ°æ®å é¤çæ ¸å¿è¦ç¹ã</p>
<h3 id="æ ¸å¿åå">æ ¸å¿åå</h3>
<ol>
<li><strong>å®å¨ç¬¬ä¸</strong>ï¼ä»»ä½å é¤æä½é½è¦ç¡®ä¿æ°æ®å®å¨</li>
<li><strong>å½±åæå°</strong>ï¼å°½éåå°å¯¹ä¸å¡çå½±å</li>
<li><strong>æçä¼å</strong>ï¼éæ©æéåçé«ææ¹æ¡</li>
<li><strong>å¯çæ§</strong>ï¼æ´ä¸ªè¿ç¨è¦å¯çæ§ãå¯æ§å¶</li>
</ol>
<h3 id="ææ¯éåå£è¯">ææ¯éåå£è¯</h3>
<p>æ ¹æ®å¤å¹´çå®æç»éªï¼ææ»ç»äºä¸ä¸ªç®åçéåå£è¯ï¼</p>
<blockquote>
<p><strong>çååºï¼å¤æ¯ä¾ï¼å®æ¹æ¡</strong></p>
<ul>
<li><strong>æååº</strong>ï¼ç´æ¥å é¤ååºæå¿«</li>
<li><strong>å çå°</strong>ï¼åæ¹å é¤æç¨³å¦¥</li>
<li><strong>å çå¤</strong>ï¼éå»ºè¡¨æé«æ</li>
<li><strong>ä¸è½å</strong>ï¼å¨çº¿åæ­¥æå®å¨</li>
</ul>
</blockquote>
<h3 id="æåçå»ºè®®">æåçå»ºè®®</h3>
<p>å¤§è¡¨æ°æ®å é¤æ¯ä¸ä¸ªéè¦è°¨æå¯¹å¾çæä½ï¼æå»ºè®®å¤§å®¶ï¼</p>
<ol>
<li><strong>é¢é²ä¼äºæ²»ç</strong>ï¼éè¿æ°æ®çå½å¨æç®¡çï¼å®ææ¸çæ°æ®</li>
<li><strong>æ¶æè¦åç</strong>ï¼å¨è®¾è®¡é¶æ®µå°±èèæ°æ®æ¸çç­ç¥</li>
<li><strong>å·¥å·è¦çç»</strong>ï¼ææ¡åç§å é¤å·¥å·çä½¿ç¨æ¹æ³</li>
<li><strong>ç»éªè¦ç§¯ç´¯</strong>ï¼æ¯æ¬¡æä½åé½è¦æ»ç»ç»éªæè®­</li>
</ol>
<p>è®°ä½ï¼<strong>æ²¡ææå¥½çæ¹æ¡ï¼åªææéåçæ¹æ¡</strong>ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-28 16:07">2026-01-28 16:07</span>&nbsp;
<a href="https://www.cnblogs.com/12lisu">èä¸è¯´ææ¯</a>&nbsp;
éè¯»(<span id="post_view_count">313</span>)&nbsp;
è¯è®º(<span id="post_comment_count">3</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19544371);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19544371', targetLink: 'https://www.cnblogs.com/12lisu/p/19544371', title: 'åä¸çº§å¤§è¡¨å¦ä½å é¤æ°æ®ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ éåä¸åå®¢ï¼keystoneï¼capstoneï¼unicorn ]]></title>
    <link>https://www.cnblogs.com/ClownLMe/p/19544039</link>
    <guid>3ccba9f9bf69ac8d9b41e4488ebc0deb</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ClownLMe/p/19544039" title="åå¸äº 2026-01-28 15:44">
    <span role="heading" aria-level="2">éåä¸åå®¢ï¼keystoneï¼capstoneï¼unicorn</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ç®ä»">ç®ä»</h1>
<p><strong>keystone</strong> æ¯ä¸ä¸ª<strong>æ±ç¼å¨</strong>ï¼è½å¤å°æ±ç¼ä»£ç è½¬æ¢æç¡¬ç¼ç ã<br>
<strong>capstone</strong> æ¯ä¸ä¸ª<strong>åæ±ç¼å¨</strong>ï¼è½å¤å°ç¡¬ç¼ç è½¬æ¢ä¸ºæ±ç¼ä»£ç ã<br>
<strong>unicorn</strong> æ¯ä¸ä¸ª<strong>æ¨¡æå¨</strong>ï¼è½å¤æ¨¡æcpuæ§è¡æ±ç¼æä»¤ã</p>
<p>éè¿è¿3ä¸ªå·¥å·ï¼è½å¤å¸®å©æä»¬éåæ¨¡æåæä»£ç ï¼ç»è¿å¨æçåè°è¯ï¼ç®åéæçvmåæ··æ·çå°æ°ã</p>
<h1 id="ç¯å¢å®è£">ç¯å¢å®è£</h1>
<pre><code class="language-bash">pip install keystone-engine capstone unicorn
</code></pre>
<p>è¿3ä¸ªå·¥å·ç¨æ³<strong>æå¶ç®å</strong>ï¼ä¸é¢éè¿ç¤ºä¾æ¥æ¼ç¤ºå¶ç¨æ³ã</p>
<h1 id="keystone">Keystone</h1>
<h3 id="ç¤ºä¾">ç¤ºä¾</h3>
<pre><code class="language-python">from keystone import *

CODE = b"INC ECX; ADD EDX, ECX"

try:
    ks = Ks(KS_ARCH_X86, KS_MODE_64)
    
    encoding, count = ks.asm(CODE)
    
    print(f"æ±ç¼æä»¤æ°é: {count}")
    print(f"æºå¨ç  (åè¿å¶): {encoding}")
    print(f"æºå¨ç  (Hex): {''.join(f'{x:02x}' for x in encoding)}")

except KsError as e:
    print(f"ERROR: {e}")
</code></pre>
<h3 id="ä»£ç è§£é">ä»£ç è§£é</h3>
<p>ä»£ç æµç¨ååç®åï¼<br>
<strong>åå§åkeystone-&gt;ç¼è¯ä»£ç -&gt;è¾åºç»æ</strong></p>
<h5 id="åå§åkeystone">åå§åkeystone</h5>
<pre><code class="language-python">ks = Ks(KS_ARCH_X86, KS_MODE_64)
</code></pre>
<p>åå§å<code>keystone</code>å¼æï¼</p>
<ul>
<li>ç¬¬ä¸ä¸ªåæ°ï¼éæ©æä»¤æ¶æä¾å¦ï¼x86ï¼arm......</li>
<li>ç¬¬äºä¸ªåæ°ï¼éæ©æ¨¡å¼ï¼ä¾å¦ï¼64ä½ï¼32ä½ï¼å°ç«¯åº......</li>
</ul>
<h5 id="ç¼è¯ä»£ç ">ç¼è¯ä»£ç </h5>
<p>å°æ±ç¼è½¬æ¢ä¸º16è¿å¶çshellcode</p>
<pre><code class="language-python">encoding, count = ks.asm(CODE)
</code></pre>
<ul>
<li>ç¬¬ä¸ä¸ªè¿åå¼ï¼æºå¨ç æä»¤çæ°ç»</li>
<li>ç¬¬äºä¸ªè¿åå¼ï¼æ±ç¼æä»¤æ°é</li>
</ul>
<h1 id="capstone">Capstone</h1>
<p><code>capstone</code>çç¨æ³å<code>keystone</code>å·®ä¸å¤ã</p>
<h3 id="ç¤ºä¾-1">ç¤ºä¾</h3>
<pre><code class="language-python">from capstone import *

CODE = b"\xff\xc1\x01\xca"

md = Cs(CS_ARCH_X86, CS_MODE_64)

print("å°å\t\tæä»¤\t\tæä½æ°")
print("-" * 30)

for i in md.disasm(CODE, 0x1000):
    print(f"0x{i.address:x}:\t{i.mnemonic}\t{i.op_str}")
</code></pre>
<h3 id="ä»£ç è§£é-1">ä»£ç è§£é</h3>
<p>ä»£ç æµç¨è·<code>keystone</code>å·®ä¸å¤ï¼<br>
<strong>åå§åcapstone-&gt;åç¼è¯ä»£ç -&gt;è¾åºç»æ</strong></p>
<h5 id="åå§åcapstone">åå§åcapstone</h5>
<pre><code class="language-python">md = Cs(CS_ARCH_X86, CS_MODE_64)
</code></pre>
<p>åå§å<code>capstone</code>å¼æï¼</p>
<ul>
<li>ç¬¬ä¸ä¸ªåæ°ï¼éæ©æä»¤æ¶æä¾å¦ï¼x86ï¼arm......</li>
<li>ç¬¬äºä¸ªåæ°ï¼éæ©æ¨¡å¼ï¼ä¾å¦ï¼64ä½ï¼32ä½ï¼å°ç«¯åº......</li>
</ul>
<h5 id="åç¼è¯ä»£ç ">åç¼è¯ä»£ç </h5>
<pre><code class="language-python">for i in md.disasm(CODE, 0x1000):
    print(f"0x{i.address:x}:\t{i.mnemonic}\t{i.op_str}")
</code></pre>
<p>ä½¿ç¨æ¹æ³<code>disasm</code>åæ±ç¼ï¼</p>
<ul>
<li>ç¬¬ä¸ä¸ªåæ°ï¼æºå¨ç </li>
<li>ç¬¬äºä¸ªåæ°ï¼ç¬¬ä¸æ¡æä»¤çåºå°å</li>
<li>è¿åï¼ä¸ä¸ªåå«æä»¤å¯¹è±¡çæ°ç»</li>
</ul>
<h1 id="unicorn">unicorn</h1>
<p>unicornæä¾çæ¹æ³ä½¿ç¨ä¹ä¸å¤æï¼ä½éè¦ä¸å®çåå­åºç¡ç¥è¯ã<br>
ä¸é¢ç¨ä¸ä¸ªæ¡ä¾è§£éã</p>
<h3 id="ç¤ºä¾-2">ç¤ºä¾</h3>
<p><strong>ææ¯æ¨¡æï¼</strong> æéåè¿ç¨ä¸­åç°ä¸ä¸ªxorå å¯ä»£ç ï¼æéè¦éè¿æ¨¡ææ§è¡ï¼å¯¹å¯æè¿è¡è§£å¯ã<br>
æ ¹æ®æ±ç¼ä»£ç å¯ä»¥å¾ç¥ï¼<br>
<code>0x20000</code>å­æ¾å¯æ<br>
<code>0x30000</code>å­æ¾ç»æ<br>
<code>0x10000</code>ä¸­è¯»åå¯é¥key</p>
<pre><code class="language-python">from unicorn import *
from unicorn.x86_const import *
import struct
from keystone import *

ASM_CODE = """
&nbsp; &nbsp; MOV ECX, 5
&nbsp; &nbsp; MOV ESI, 0x20000
&nbsp; &nbsp; MOV EDI, 0x30000
&nbsp; &nbsp; MOV BL, byte ptr [0x10000]
loop_start:
&nbsp; &nbsp; LODSB
&nbsp; &nbsp; XOR AL, BL
&nbsp; &nbsp; STOSB
&nbsp; &nbsp; LOOP loop_start
"""

def get_code():
&nbsp; &nbsp; ks = Ks(KS_ARCH_X86, KS_MODE_32)
&nbsp; &nbsp; encoding, count = ks.asm(ASM_CODE)
&nbsp; &nbsp; return bytes(encoding)

CODE = get_code()

ADDRESS_CODE = 0x400000 &nbsp; &nbsp;
ADDRESS_KEY &nbsp;= 0x10000 &nbsp; &nbsp; &nbsp;
ADDRESS_IN &nbsp; = 0x20000 &nbsp; &nbsp; &nbsp;
ADDRESS_OUT &nbsp;= 0x30000 &nbsp; &nbsp; &nbsp;
REAL_KEY = 0x77 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;

CIPHER_TEXT = b"\x3F\x12\x1B\x1B\x18"

def hook_code(uc, access, address, size, value, user_data):
&nbsp; &nbsp; if address == ADDRESS_KEY:
&nbsp; &nbsp; &nbsp; &nbsp; key_value = uc.mem_read(address, size)
&nbsp; &nbsp; &nbsp; &nbsp; print(f"key: {hex(key_value[0])}")

def start_emulation():
&nbsp; &nbsp; try:
&nbsp; &nbsp; &nbsp; &nbsp; print("åå§åç¯å¢...")
&nbsp; &nbsp; &nbsp; &nbsp; mu = Uc(UC_ARCH_X86, UC_MODE_32)

&nbsp; &nbsp; &nbsp; &nbsp; mu.mem_map(0x0, 1 * 1024 * 1024)
&nbsp; &nbsp; &nbsp; &nbsp; mu.mem_map(ADDRESS_CODE, 2 * 1024 * 1024)

&nbsp; &nbsp; &nbsp; &nbsp; mu.mem_write(ADDRESS_CODE, CODE)
&nbsp; &nbsp; &nbsp; &nbsp; mu.mem_write(ADDRESS_IN, CIPHER_TEXT)
&nbsp; &nbsp; &nbsp; &nbsp; mu.mem_write(ADDRESS_KEY, struct.pack("B", REAL_KEY))

&nbsp; &nbsp; &nbsp; &nbsp; mu.hook_add(UC_HOOK_MEM_READ, hook_code)
&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; mu.emu_start(ADDRESS_CODE, ADDRESS_CODE + len(CODE))

&nbsp; &nbsp; &nbsp; &nbsp; decrypted_text = mu.mem_read(ADDRESS_OUT, 5)
&nbsp; &nbsp; &nbsp; &nbsp; print(f"è§£å¯åçææ¬: {decrypted_text.decode()}")

&nbsp; &nbsp; except UcError as e:
&nbsp; &nbsp; &nbsp; &nbsp; print(f"æ¨¡æéè¯¯: {e}")

if __name__ == "__main__":
&nbsp; &nbsp; start_emulation()
</code></pre>
<h3 id="ä»£ç è§£é-2">ä»£ç è§£é</h3>
<p>ä»£ç æµç¨ï¼<br>
<strong>åå§åç¯å¢-&gt;åéèæåå­-&gt;åå¥æ°æ®-&gt;æ·»å æè·æä½-&gt;æ¨¡ææ§è¡æä»¤-&gt;è¯»ååå­ç»æ</strong></p>
<h5 id="åå§åç¯å¢">åå§åç¯å¢</h5>
<p>è¿ä¸ªè·ä¸é¢ç<code>keystone</code>å<code>capstone</code>ä¸æ ·ï¼å°±ä¸è§£éäº</p>
<pre><code class="language-python">mu = Uc(UC_ARCH_X86, UC_MODE_32)
</code></pre>
<h5 id="åéèæåå­">åéèæåå­</h5>
<p>ç¬¬ä¸è¡æ¯ç¨äºå­æ¾<strong>å åå­æ°æ®</strong>ï¼ç¬¬äºè¡æ¯ç¨äºå­æ¾æ§è¡ç<strong>ä»£ç </strong></p>
<pre><code class="language-python">mu.mem_map(0x0, 1 * 1024 * 1024)
mu.mem_map(ADDRESS_CODE, 2 * 1024 * 1024)
</code></pre>
<p><code>mem_map</code>ç¨äºåå§åèæåå­</p>
<ul>
<li>ç¬¬ä¸ä¸ªåæ°ï¼åå­çèæå°ååºå</li>
<li>ç¬¬äºä¸ªåæ°ï¼åå­çå¤§å°</li>
</ul>
<h5 id="ååå¥æ°æ®">ååå¥æ°æ®</h5>
<p>ç¬¬ä¸è¡åå¥ä»£ç ï¼ç¬¬äºè¡åå¥å¯æï¼ç¬¬ä¸è¡åå¥è§£å¯key</p>
<pre><code class="language-python">mu.mem_write(ADDRESS_CODE, CODE)
mu.mem_write(ADDRESS_IN, CIPHER_TEXT)
mu.mem_write(ADDRESS_KEY, struct.pack("B", REAL_KEY))
</code></pre>
<p><code>mem_write</code>ç¨äºåå¥èæåå­</p>
<ul>
<li>ç¬¬ä¸ä¸ªåæ°ï¼åå¥åå­çå°å</li>
<li>ç¬¬äºä¸ªåæ°ï¼åå¥åå­çæ°æ®</li>
</ul>
<h5 id="æ·»å æè·æä½">æ·»å æè·æä½</h5>
<p>hookç¨äºæè·æ°æ®ï¼è¿éç¨äºæè·key</p>
<pre><code class="language-python">def hook_code(uc, access, address, size, value, user_data):
&nbsp; &nbsp; if address == ADDRESS_KEY:
&nbsp; &nbsp; &nbsp; &nbsp; key_value = uc.mem_read(address, size)
&nbsp; &nbsp; &nbsp; &nbsp; print(f"key: {hex(key_value[0])}")
mu.hook_add(UC_HOOK_MEM_READ, hook_code)
</code></pre>
<p><code>hook_add</code>æ·»å hook</p>
<ul>
<li>ç¬¬ä¸ä¸ªåæ°ï¼æè·æ¨¡å¼ï¼è§å®ä»ä¹æ¶åè§¦åhookï¼ä¾å¦ï¼è¯»ååå­ï¼ä¸­æ­æè·......</li>
<li>ç¬¬äºä¸ªåæ°ï¼è§¦åçåè°å½æ°ï¼åè°å½æ°åä¸ªåæ°å¦ä¸ï¼</li>
</ul>
<pre><code class="language-python">def hook_code(uc, access, address, size, value, user_data):
</code></pre>
<ul>
<li><code>uc</code>ï¼æ¨¡æå¨å¯¹è±¡</li>
<li><code>access</code>ï¼å½åè®¿é®ç±»åï¼<code>UC_MEM_READ</code>ï¼<code>UC_MEM_WRITE</code>......</li>
<li><code>address</code>ï¼å½åè®¿é®çèæå°å</li>
<li><code>size</code>ï¼å½åè®¿é®æ°æ®å¤§å°</li>
<li><code>value</code>ï¼accessä¸º<code>UC_MEM_WRITE</code>ï¼åè¿éä¸ºè¦åå¥çå¼</li>
<li><code>user_data</code>ï¼ç¨æ·å¨<code>add_hook</code>æ¶ä¼ è¿å»çèªå®ä¹æ°æ®</li>
</ul>
<h5 id="æ¨¡ææ§è¡æä»¤">æ¨¡ææ§è¡æä»¤</h5>
<pre><code class="language-python">mu.emu_start(ADDRESS_CODE, ADDRESS_CODE + len(CODE))
</code></pre>
<ul>
<li>ç¬¬ä¸ä¸ªåæ°ï¼æ¨¡ææ§è¡çèµ·å§å°å</li>
<li>ç¬¬äºä¸ªåæ°ï¼æ¨¡ææ§è¡çä»£ç å¤§å°</li>
</ul>
<h5 id="è¯»ååå­ç»æ">è¯»ååå­ç»æ</h5>
<pre><code class="language-python">decrypted_text = mu.mem_read(ADDRESS_OUT, 5)
</code></pre>
<ul>
<li>ç¬¬ä¸ä¸ªåæ°ï¼è¯»ååå­çå°å</li>
<li>ç¬¬äºä¸ªåæ°ï¼è¯»ååå­çå¤§å°</li>
</ul>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-28 15:45">2026-01-28 15:44</span>&nbsp;
<a href="https://www.cnblogs.com/ClownLMe">ClownLMe</a>&nbsp;
éè¯»(<span id="post_view_count">79</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19544039);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19544039', targetLink: 'https://www.cnblogs.com/ClownLMe/p/19544039', title: 'éåä¸åå®¢ï¼keystoneï¼capstoneï¼unicorn' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ é¶é¨æ§é¨ç½²æ¬å° AI å©æï¼Clawdbot/Meltbot é¨ç½²æ·±åº¦ä¿å§çº§æç¨ ]]></title>
    <link>https://www.cnblogs.com/ChenAI-TGF/p/19545952</link>
    <guid>c45692a61389c329e779d0a9822268d1</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ChenAI-TGF/p/19545952" title="åå¸äº 2026-01-29 00:14">
    <span role="heading" aria-level="2">é¶é¨æ§é¨ç½²æ¬å° AI å©æï¼Clawdbot/Meltbot é¨ç½²æ·±åº¦ä¿å§çº§æç¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        Clawdbotæ¯ä¸ä¸ªå¤åè½æºè½ä½ï¼Agentï¼ï¼å·å¤æä»¶æä½ãä»£ç æ§è¡ãèç½æç´¢ç­è½åãæ¬æè¯¦ç»ä»ç»äºå¶å®è£éç½®æµç¨ï¼ ç¯å¢åå¤ï¼å¨æ°å®è£Node.jsï¼v22+/v24+ï¼æå½»åºå¸è½½æ§çåå®è£æ°çï¼éç¡®ä¿ç¯å¢åééç½®æ­£ç¡®ï¼ æéè®¾ç½®ï¼å¨PowerShellä¸­è§£éèæ¬æ§è¡æéï¼ ä¸é®å®è£ï¼éè¿å®æ¹èæ¬èªå¨é¨ç½²ä¸»ç¨åºï¼ åå§ååå¯¼ï¼éæ©QuickStartæ¨¡å¼ï¼éç½®åºç¡æè½ï¼Skillsï¼åAPIï¼å¦QwenæOpenAIï¼ï¼æè·³è¿é«çº§éé¡¹ã å®æä¸è¿°æ­¥éª¤åå³å¯å¯å¨Clawdbotï¼åç»­å¯æ©å±è¿ç¨æ§å¶ç­åè½
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<hr>
<p><img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419477-397668364.png" class="lazyload"></p>
<h1 id="åè¨ä¸ºä»ä¹éæ©-clawdbot-moltbot">åè¨ï¼ä¸ºä»ä¹éæ© Clawdbot (Moltbot)ï¼</h1>
<p>Clawdbot ä¸ä»ä»æ¯ä¸ä¸ªèå¤©æ¡ãå®æ¯ä¸ä¸ª <strong>æºè½ä½ï¼Agentï¼</strong>ï¼æå³çå®æâæâåâèâï¼</p>
<ul>
<li><strong>æ</strong>ï¼å®å¯ä»¥è¯»åä½ çµèä¸çæä»¶ãæ§è¡ä»£ç ãææ§å½ä»¤è¡ã</li>
<li><strong>è</strong>ï¼å®å¯ä»¥èç½æç´¢ãè®¿é® Googleãåæç½é¡µã</li>
<li><strong>å¤§è</strong>ï¼ä½ å¯ä»¥æ¥å¥äºç«¯ç <strong>API</strong>ï¼ä¹å¯ä»¥å©ç¨èªå·±ç <strong>GPU</strong> è¿è¡æ¬å°æ¨¡åã</li>
</ul>
<hr>
<h1 id="ç¬¬ä¸é¶æ®µåºå»ºå·¥ç¨ç¯å¢åå¤">ç¬¬ä¸é¶æ®µï¼åºå»ºå·¥ç¨ï¼ç¯å¢åå¤ï¼</h1>
<h2 id="11-è§£å³-nodejs-å®è£ä¸çæ¬é®é¢">1.1 è§£å³ Node.js å®è£ä¸çæ¬é®é¢</h2>
<h3 id="111å¨æ°å®è£nodejsçµèæªå®è£è¿nodejsæ¶">1.1.1å¨æ°å®è£Node.jsï¼çµèæªå®è£è¿Node.jsæ¶ï¼</h3>
<p>å¦æä½ ççµèä¸ä»æ¥æ²¡è£è¿Node.jsï¼æ éæ§è¡å¸è½½ãå æ®ççæ­¥éª¤ï¼ç´æ¥æä»¥ä¸æµç¨å¨æ°å®è£å³å¯ï¼æ­¥éª¤ééWindowsç³»ç»ï¼æ°æåå¥½ãå¨ç¨é»è®¤ä¸ä¸æ­¥å³å¯ã</p>
<p><strong>1. ä¸è½½ééçNode.jså®è£å</strong></p>
<ol>
<li>
<p>æå¼<a href="https://nodejs.org/" target="_blank" rel="noopener nofollow">Node.js å®æ¹å®ç½</a>ï¼å®ç½é¡µé¢ä¼èªå¨è¯å«ä½ çç³»ç»ï¼Windowsï¼ï¼<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419452-791668750.png" class="lazyload"><br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419555-1244162644.png" class="lazyload"><br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419489-87884460.png" class="lazyload"></p>
</li>
<li>
<p>ç¹å»ä¸è½½<strong>Windows Installer (64-bit)</strong> æ ¼å¼çå®è£åï¼.msiåç¼ï¼64ä½æ¯ç®åWindowsçµèçä¸»æµï¼æ éé32ä½ï¼ï¼</p>
<blockquote>
<p>å°è´´å£«ï¼ä¸è½½æ¶å»ºè®®ä¿å­å°æ¡é¢/ä¸è½½æä»¶å¤¹ï¼æ¹ä¾¿æ¾å°å®è£åã</p>
</blockquote>
</li>
</ol>
<p><strong>2. å®è£Node.jsï¼å¨ç¨æ°æåå¥½ï¼é»è®¤ä¸ä¸æ­¥å³å¯ï¼</strong></p>
<ol>
<li>åå»åä¸è½½ç.msiå®è£åï¼å¼¹åºå®è£åå¯¼ï¼ç¹å»<strong>Next</strong>ï¼</li>
<li>å¾éåæåè®®ï¼I accept the terms in the License Agreementï¼ï¼ç¹å»<strong>Next</strong>ï¼</li>
<li><strong>å³é®ç¹1</strong>ï¼ç¡®è®¤å®è£è·¯å¾ï¼é»è®¤æ¯<code>C:\Program Files\nodejs\</code>ï¼æ°æ<strong>ä¸è¦ä¿®æ¹</strong>ï¼é¿ååç»­ç¯å¢åéåºé®é¢ï¼ï¼ç´æ¥<strong>Next</strong>ï¼</li>
<li><strong>å³é®ç¹2</strong>ï¼è¿å¥ãCustom Setupãèªå®ä¹å®è£é¡µï¼<strong>ææéé¡¹é»è®¤å¾éå³å¯</strong>ï¼éç¹ç¡®è®¤<code>Add Node.js to PATH</code>å·²å¾éï¼è¿ä¸æ­¥ä¼èªå¨æNode.jså å¥ç³»ç»ç¯å¢åéï¼ä¸ç¨æå¨éç½®ï¼æ¯æå³é®çä¸æ­¥ï¼ï¼ç´æ¥<strong>Next</strong>ï¼</li>
<li>åç»­é¡µé¢æ éä¿®æ¹ä»»ä½é«çº§éé¡¹ï¼ä¸ç´ç¹å»<strong>Next</strong>ï¼æåç¹å»<strong>Install</strong>å¼å§å®è£ï¼ç­å¾10-30ç§ï¼å®è£éåº¦ççµèéç½®ï¼ï¼</li>
<li>å®è£å®æåï¼ç¹å»<strong>Finish</strong>å³é­åå¯¼å³å¯ã</li>
</ol>
<p><strong>3. çæ¬éªè¯</strong><br>
<strong>å¿é¡»éå¯ç»ç«¯</strong>ï¼å³é­ææå·²æå¼çPowerShell/CMDï¼éæ°æå¼ï¼ï¼å¦åç³»ç»è¯å«ä¸å°æ°å®è£çNode.jsï¼</p>
<ol>
<li>æä¸<code>Win+R</code>ï¼è¾å¥<code>PowerShell</code>ï¼æå¼æ®éæéçPowerShellå³å¯ï¼</li>
<li>è¾å¥éªè¯å½ä»¤ï¼<pre><code class="language-powershell">node -v
</code></pre>
</li>
<li>åè½¦åï¼è¥æ¾ç¤º<code>v22.x.x</code>æ<code>v24.x.x</code>ï¼æ¯å¦v22.10.0ãv24.4.0ï¼ï¼è¯´æå®è£æåä¸çæ¬ç¬¦åè¦æ±ï¼
<blockquote>
<p>å¯ééªè¯ï¼è¾å¥<code>npm -v</code>ï¼ä¼æ¾ç¤ºéå¥çnpmçæ¬ï¼Node.jså®è£åä¼èªå¨éå¸¦npmï¼æ éåç¬å®è£ï¼ï¼è½æ­£å¸¸è¾åºçæ¬å³ä»£è¡¨ç¯å¢åééç½®æ è¯¯ã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419462-1362998438.png" class="lazyload"></p>
</blockquote>
</li>
</ol>
<hr>
<h3 id="112å¸è½½æ§çnodejs-å®è£æ°ççµèå®è£è¿nodejsä½æ¯çæ¬ä¸å¤æ°æ¶">1.1.2å¸è½½æ§çNode.js å®è£æ°çï¼çµèå®è£è¿Node.jsä½æ¯çæ¬ä¸å¤æ°æ¶ï¼</h3>
<p>å¦æçæ¬ä¸å¤æ°ï¼æ§è¡å®è£å½ä»¤çæ¶åç¨åºä¼å°è¯å®è£æ°ççNode.jsï¼ä½æ¯å¤§æ¦çä¼å¤±è´¥ï¼è¿æ¯æå¨æ¯è¾å¥½ï¼å¤±è´¥çè¯ä¼æ¾ç¤ºä»¥ä¸çé¢ï¼<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419454-1520357815.png" class="lazyload"><br>
<strong>æä½ï¼</strong><br>
1.å¯ä»¥ç´æ¥éè¿æ°çå®è£åå¯¹ä¸ä¸ä¸ªçæ¬çNode.jsè¿è¡remove<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419373-1019584794.png" class="lazyload"></p>
<ol start="2">
<li>å»âæ§å¶é¢æ¿âå¸è½½æ§ç Node.jsã</li>
<li><strong>å³é®ç¹ï¼</strong> æå¨è¿å¥ <code>C:\Program Files\nodejs</code> æä»¶å¤¹ï¼ææ®ççæä»¶å¨é¨å å¹²åï¼</li>
<li>åå¾ <a href="https://nodejs.org/" target="_blank" rel="noopener nofollow">Node.js å®ç½</a> ä¸è½½ææ°ç <strong>v22 æ v24</strong> ç¨³å®çå¹¶å®è£ã</li>
<li><strong>æ¸æ¥ä¹åçæ§çç¯å¢åé</strong>ï¼è¿ä¸æ­¥éå¸¸éè¦ï¼ï¼</li>
</ol>
<ul>
<li><strong>éªè¯ï¼</strong> éæ°æå¼ PowerShellï¼è¾å¥ <code>node -v</code>ãçå°æ¾ç¤º <code>v22.x</code> æ <code>v24.x</code> æç®è¿å³ã</li>
</ul>
<ol start="6">
<li>çæ¬éªè¯ï¼åå¸è½½æ§çåçéªè¯æ­¥éª¤ä¸è´ï¼<br>
<strong>å¿é¡»éå¯ç»ç«¯</strong>ï¼å³é­ææå·²æå¼çPowerShell/CMDï¼éæ°æå¼ï¼ï¼å¦åç³»ç»è¯å«ä¸å°æ°å®è£çNode.jsï¼</li>
<li>æä¸<code>Win+R</code>ï¼è¾å¥<code>PowerShell</code>ï¼æå¼æ®éæéçPowerShellå³å¯ï¼</li>
<li>è¾å¥éªè¯å½ä»¤ï¼<pre><code class="language-powershell">node -v
</code></pre>
</li>
<li>åè½¦åï¼è¥æ¾ç¤º<code>v22.x.x</code>æ<code>v24.x.x</code>ï¼æ¯å¦v22.10.0ãv24.4.0ï¼ï¼è¯´æå®è£æåä¸çæ¬ç¬¦åè¦æ±ï¼
<blockquote>
<p>å¯ééªè¯ï¼è¾å¥<code>npm -v</code>ï¼ä¼æ¾ç¤ºéå¥çnpmçæ¬ï¼Node.jså®è£åä¼èªå¨éå¸¦npmï¼æ éåç¬å®è£ï¼ï¼è½æ­£å¸¸è¾åºçæ¬å³ä»£è¡¨ç¯å¢åééç½®æ è¯¯ã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419462-1362998438.png" class="lazyload"></p>
</blockquote>
</li>
</ol>
<h2 id="12-è§£éèæ¬æ§è¡æé">1.2 è§£éèæ¬æ§è¡æé</h2>
<ul>
<li><strong>é®é¢ï¼</strong> Windows é»è®¤ç¦æ­¢è¿è¡èæ¬ï¼ä¼å¯¼è´å®è£æä»¤å¤±æã</li>
<li><strong>æä½ï¼</strong> ä»¥ç®¡çåèº«ä»½è¿è¡ PowerShellï¼æ§è¡ï¼<pre><code class="language-powershell">Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
</code></pre>
</li>
</ul>
<p><img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419447-1027145300.png" class="lazyload"></p>
<p><strong>å®æä»¥ä¸æ­¥éª¤åï¼ä½ çNode.jsç¯å¢å°±å®å¨æ»¡è¶³Clawdbotçè¦æ±äºï¼å¯ä»¥ç´æ¥è¿å¥åç»­çé¡¹ç®å®è£ç¯èã</strong></p>
<hr>
<h1 id="ç¬¬äºé¶æ®µæ­£å¼å®è£ä¸åå§å">ç¬¬äºé¶æ®µï¼æ­£å¼å®è£ä¸åå§å</h1>
<h2 id="21-æ§è¡ä¸é®å®è£">2.1 æ§è¡ä¸é®å®è£</h2>
<ul>
<li><strong>æä½ï¼</strong> å¨ PowerShell è¾å¥ï¼<pre><code class="language-powershell">iwr -useb https://clawd.bot/install.ps1 | iex
</code></pre>
</li>
<li><strong>ä½ç¨ï¼</strong> è¿è¡ä»£ç ä¼èªå¨ä¸è½½ä¸»ç¨åºå¹¶éç½®ç¯å¢åéã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419433-1931333515.png" class="lazyload"><br>
è¿ä¸ªä¼æç»­ä¸ä¼ææè¿å±ï¼ä¸è¦æå¿ï¼å¦æå¤ªä¹å¯ä»¥ææåè½¦ççæ¯ä¸æ¯powershellå·æ°çé®é¢<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419497-1664194683.png" class="lazyload"><br>
è¿ä¸ªä¼æç»­ä¸æ®µæ¶é´ææè¿å±ï¼ä¸è¦æå¿ï¼</li>
</ul>
<h2 id="22-è¿è¡åå¯¼-onboarding">2.2 è¿è¡åå¯¼ (Onboarding)</h2>
<ul>
<li><strong>æä½ï¼</strong> è¾å¥ <code>moltbot onboard</code>ã</li>
<li><strong>è¯¦ç»éé¡¹è¯´æï¼</strong>
<ol>
<li>
<p><strong>Mode</strong>ï¼é <code>QuickStart</code>ã</p>
</li>
<li>
<p><strong>Provider (å¤§è)</strong>ï¼å»ºè®®é <code>Qwen</code>ã</p>
<ul>
<li><strong>æ³¨æï¼</strong> æ­¤æ¶ä¼è·³åºç½é¡µè®©ä½ ææï¼ç»å½æèæ³¨åQwençè´¦å·æ¢å¯ãè¿æ­¥æ¯ä¸ºäºåè®©æºå¨äººæä¸ªâä¸´æ¶å¤§èâè·èµ·æ¥ã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419406-421558571.png" class="lazyload"><br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001420170-1991609657.png" class="lazyload"><br>
éæ©OpenAI Chatï¼æ¿å°Keyä¹åè¾å¥å°çé¢ä¸­ç»Clawdbotã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419455-545352371.png" class="lazyload"><br>
éæ©è¿ä¸ªç´æ¥æåè½¦å³å¯ã</li>
</ul>
</li>
<li>
<p><strong>Channels (è¿ç¨æ§å¶)</strong>ï¼é <code>Skip for now</code>ãæä»¬åå¨æ¬å°è·éï¼ä»¥ååè¿ Telegramã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419431-1308051978.png" class="lazyload"></p>
</li>
<li>
<p><strong>Skills (æè½)</strong>ï¼é <code>Yes</code>ã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://i-blog.csdnimg.cn/direct/5bba89a316904adb80c3706d49313071.png" class="lazyload">è¿äºæ¯æåºæ¬çSkilléæ©ï¼éæ©Yeså°±å¥½</p>
</li>
<li>
<p><strong>Skill install</strong>ï¼é <code>npm</code>ã</p>
</li>
</ol>
</li>
</ul>
<p><img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419412-404111285.png" class="lazyload"></p>
<ol start="5">
<li><strong>Skill Dependencies</strong>ï¼é <code>Skip for now</code>ã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419481-1953485231.png" class="lazyload"><br>
è¿äºæ¯æ©å±çï¼ç®åéç½®æ¯è¾éº»ç¦ï¼å¯ä»¥åç»­åéç½®<br>
6. ä¸äºå¶ä»éç½®<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419465-500088419.png" class="lazyload"><br>
éæ©Noï¼å°½éé½çå°åé¢åéç½®<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419469-1672342514.png" class="lazyload"></li>
</ol>
<h2 id="23-æåçé¢">2.3 æåçé¢</h2>
<p><img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419485-439516460.png" class="lazyload">ã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419489-1795781488.png" class="lazyload"></p>
<hr>
<h1 id="ç¬¬ä¸é¶æ®µç ´è§£å½ä»¤æ¾ä¸å°ä¸ç½å³æªææ">ç¬¬ä¸é¶æ®µï¼ç ´è§£âå½ä»¤æ¾ä¸å°âä¸âç½å³æªææâ</h1>
<h2 id="31-è§£å³-moltbot-å½ä»¤å¤±æ">3.1 è§£å³ moltbot å½ä»¤å¤±æ</h2>
<ul>
<li>
<p><strong>ç°è±¡ï¼</strong> å®è£å®è¾å¥ <code>moltbot open</code> æç¤ºâæ æ³è¯å«âã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419457-933466376.png" class="lazyload"></p>
</li>
<li>
<p><strong>åå ï¼</strong> ç¯å¢åéæªå·æ°ã</p>
</li>
<li>
<p><strong>å¯¹ç­ï¼</strong> éå¯ PowerShell çªå£ãå¦æè¿ä¸è¡ï¼æ§è¡npx moltbot openã</p>
</li>
</ul>
<h2 id="32-æåèº«ä»½ä»¤ç-token-ç»å½ç½é¡µ">3.2 æåèº«ä»½ä»¤ç (Token) ç»å½ç½é¡µ</h2>
<ul>
<li>
<p><strong>ç°è±¡ï¼</strong> è®¿é® <code>http://localhost:18789</code> æ¾ç¤ºâæªææï¼ç½å³ä»¤çç¼ºå¤±âã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419504-496191578.png" class="lazyload"></p>
</li>
<li>
<p><strong>æä½ï¼</strong></p>
<ol>
<li>
<p>æå¼æä»¶å¤¹ <code>C:\Users\ä½ çç¨æ·å\.clawdbot</code>ã</p>
</li>
<li>
<p>å³é®ç¹å» <code>clawdbot.json</code>ï¼ç¨è®°äºæ¬æå¼ã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419386-1591656402.png" class="lazyload"></p>
</li>
<li>
<p>æ¾å° <code>"token": "xxxxxxx"</code> è¿ä¸è¡ï¼å¤å¶é£ä¸²é¿ä»£ç ã<br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419421-1785887465.png" class="lazyload"></p>
</li>
<li>
<p>åå°æµè§å¨ï¼ç¹å»å³ä¸è§çº¢è²ç¶æï¼æ Token è´´è¿å»ã<strong>ä¸æ¦åç»¿ï¼æ­åä½ ï¼ä½ çå©çæ­£å¼ä¸çº¿äºï¼</strong><br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419545-1939459351.png" class="lazyload"></p>
</li>
</ol>
</li>
</ul>
<hr>
<h1 id="ç¬¬åé¶æ®µéç½®åç§api">ç¬¬åé¶æ®µï¼éç½®åç§API</h1>
<ul>
<li><strong>æä½æ­¥éª¤ï¼</strong>
<ol>
<li>å¨ç½é¡µåå°ç¹å»å·¦ä¾§ <strong>Skill(æè½)</strong><br>
<img alt="å¨è¿éæå¥å¾çæè¿°" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3724025/202601/3724025-20260129001419485-2019635504.png" class="lazyload"><br>
å¯ä»¥çå°æéå¸¸å¤çAPIå¯ä»¥éç½®ï¼è¿ç¨ç¸å¯¹æ¥è¯´è¿æ¯æ¯è¾ç¹ççï¼ææºä¼çè¯ä¸æ¬¡ä¸é¨ååºä¸æåå®¢æ¥è®²ï¼ç®åçè¯ä»å¯ä»¥å®ç°éè¿å¯¹è¯æ¥è¿è¡ä¸äºæ¬å°çæä»¶æä½ï¼å½ä»¤æä½ç­ç­ãæ´ä½æ¥è¯´è¿æ¯ä¸éç</li>
</ol>
</li>
</ul>
<hr>
<hr>
<h2 id="æ»ç»ä½ ç-ai-ç°å¨è½å¹²ä»ä¹">æ»ç»ï¼ä½ ç AI ç°å¨è½å¹²ä»ä¹ï¼</h2>
<ol>
<li><strong>å¯¹è¯</strong>ï¼ä½ å¯ä»¥é®å®ä»»ä½é®é¢ã</li>
<li><strong>è¯»æä»¶</strong>ï¼æä»£ç åç»å®ï¼æèè®©å®è¯»ä½  F ççææ¡£ã</li>
<li><strong>æ¬å°ä»£ç æ§è¡</strong>ï¼è®©å®ç¨ Python ç»ä¸ä¸ªè¡ä»·èµ°å¿å¾ã</li>
</ol>
<p><strong>é¨ç½²è´´å£«æ»ç»ï¼</strong></p>
<ul>
<li><strong>Node çæ¬å¿é¡» v22+</strong></li>
<li><strong>Token å¨éç½®æä»¶éæ¾</strong></li>
<li><strong>æ¬å° GPU æ¨¡åç¨ Ollama æ¡¥æ¥</strong></li>
<li><strong>Google æç´¢ä¸å®è¦å¼âæç´¢å¨ç½âå¼å³</strong></li>
</ul>
<hr>
<p><em>æ­åä½ å®æäºé¨ç½²ï¼ç°å¨ï¼ä½ ç Windows å·²ç»ä¸ä»ä»æ¯ä¸å°çµèï¼èæ¯ä¸ä¸ªæ¥ææå¼ºå½äº§æ¨¡åå¤§èåæ¬å°ç¡¬ä»¶å éçè¶çº§å©æäºã</em></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-29 00:15">2026-01-29 00:14</span>&nbsp;
<a href="https://www.cnblogs.com/ChenAI-TGF">TTGF</a>&nbsp;
éè¯»(<span id="post_view_count">25</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19545952);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19545952', targetLink: 'https://www.cnblogs.com/ChenAI-TGF/p/19545952', title: 'é¶é¨æ§é¨ç½²æ¬å° AI å©æï¼Clawdbot/Meltbot é¨ç½²æ·±åº¦ä¿å§çº§æç¨' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ­ç§ Codex Agent çæ ¸å¿è¿è¡æºå¶ï¼ä»å¾ªç¯å°æºè½å³ç­ ]]></title>
    <link>https://www.cnblogs.com/smartloli/p/19530777</link>
    <guid>d48a029c21b18cf9c338cbba8c95efec</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/smartloli/p/19530777" title="åå¸äº 2026-01-28 23:32">
    <span role="heading" aria-level="2">æ­ç§ Codex Agent çæ ¸å¿è¿è¡æºå¶ï¼ä»å¾ªç¯å°æºè½å³ç­</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>1.æ¦è¿°</h1>
<p>&nbsp;å¨äººå·¥æºè½å¿«éåå±çä»å¤©ï¼AIä¸åä»ä»æ¯åç­é®é¢çèå¤©æºå¨äººï¼èæ¯æ­£å¨æ¼åä¸ºè½å¤ä¸»å¨å®æå¤æä»»å¡çæºè½ä»£çãOpenAIçCodex CLIå°±æ¯è¿ä¸è¶å¿çå¸åä»£è¡¨ââä¸ä¸ªè·¨å¹³å°çæ¬å°è½¯ä»¶ä»£çï¼è½å¤å¨ç¨æ·çæºå¨ä¸å®å¨é«æå°çæé«è´¨éçè½¯ä»¶åæ´ã</p>
<h1>2.åå®¹</h1>
<p>å¦æä½ åªæ Codex å½æâæ´ä¼åä»£ç ç ChatGPTâï¼é£ä½ åªçè§£äºå® 10% çä»·å¼ãçæ­£è®© Codex ä¸åçï¼æ¯å®èåé£å¥å®æ´ãå¯è¿è¡ãå¯åå¤æèç Agent Loopï¼æºè½ä½å¾ªç¯ï¼ç³»ç»ã</p>
<h2>2.1&nbsp;Codex å°åºåæ®éå¤§æ¨¡åæä»ä¹åºå«ï¼</h2>
<p>æä»¬åçä¸ä¸ªææ®éçå¤§æ¨¡åäº¤äºæµç¨ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">ä½ ï¼å¸®æåä¸ä¸ª Python èæ¬
æ¨¡åï¼ç»ä½ ä¸æ®µä»£ç 
ç»æ</span></pre>
</div>
<p>è¿æ¯ä¸æ¬¡æ§çæï¼æ¨¡åï¼</p>
<ul>
<li>ä¸ç¥éä»£ç è½ä¸è½è¿è¡</li>
<li>ä¸ç¥éææ²¡ææ¥é</li>
<li>æ´ä¸ç¥éâä¸ä¸æ­¥è¯¥å¹²ä»ä¹â</li>
</ul>
<p><strong>1. Codex ççå®å·¥ä½æ¹å¼å®å¨ä¸å</strong></p>
<p>Codex çæè·¯æ´åä¸ä¸ªæ°æå·¥ç¨å¸åå¨ä½ çµèåï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> <span style="color: rgba(0, 0, 0, 1)">çéæ±
</span><span style="color: rgba(0, 128, 128, 1)">2</span> <span style="color: rgba(0, 0, 0, 1)">åç¹ä»£ç 
</span><span style="color: rgba(0, 128, 128, 1)">3</span> <span style="color: rgba(0, 0, 0, 1)">è¿è¡ä¸ä¸
</span><span style="color: rgba(0, 128, 128, 1)">4</span> <span style="color: rgba(0, 0, 0, 1)">æ¥éäºï¼ççéè¯¯
</span><span style="color: rgba(0, 128, 128, 1)">5</span> <span style="color: rgba(0, 0, 0, 1)">æ¹ä»£ç 
</span><span style="color: rgba(0, 128, 128, 1)">6</span> <span style="color: rgba(0, 0, 0, 1)">åè¿è¡
</span><span style="color: rgba(0, 128, 128, 1)">7</span> ç´å°æå</pre>
</div>
<p>è¿ä¸ªãåå¤å°è¯ãçè¿ç¨ï¼å°±æ¯ Codex Agent Loopã</p>
<h2>2.2&nbsp;ä»ä¹æ¯ Agent Loopï¼</h2>
<p><strong>Agent Loop = è®©æ¨¡åå¨ä¸ä¸ªå¾ªç¯éï¼ä¸æ­æè â è¡å¨ â çç»æ â åæè</strong>ãCodex CLI çæ ¸å¿ä¸æ¯âä¸æ¬¡æ¨çâï¼èæ¯åå¤å±å¼è¿ä¸ªå¾ªç¯ï¼æ¨¡åä¸æ¯ç´æ¥ç»ç­æ¡ï¼èæ¯æ¯ä¸è½®åªå³å®ï¼æä¸ä¸æ­¥è¯¥å¹²ä»ä¹ï¼</p>
<p><strong>1.&nbsp;åå¿æãå¤§æ¨¡åãï¼æ Codex å½æä¸ä¸ªâæ°äººç¨åºåâ</strong></p>
<p data-start="321" data-end="347">æ³è±¡ä¸ä¸ª<strong data-start="325" data-end="338">åå¥èçåçº§å·¥ç¨å¸</strong>ï¼ä½ ç»ä»ä¸ä¸ªä»»å¡ï¼</p>
<div class="cnblogs_code">
<pre>âå¸®ææè¿ä¸ªé¡¹ç®è·èµ·æ¥ï¼å¹¶åä¸ä¸ª READMEãâ</pre>
</div>
<p>ä»ä¼æä¹åï¼ä¸å®ä¸æ¯ï¼</p>
<div class="cnblogs_code">
<pre>âæé­ä¸ç¼çï¼ä¸æ¬¡æ§æææäºæåå¯¹ãâ</pre>
</div>
<p>èæ¯æ´æ¥è¿ä¸é¢è¿ä¸ªè¿ç¨ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> <span style="color: rgba(0, 0, 0, 1)">åççé¡¹ç®ç®å½ç»æ
</span><span style="color: rgba(0, 128, 128, 1)">2</span> <span style="color: rgba(0, 0, 0, 1)">çä¸çæä¹è¿è¡
</span><span style="color: rgba(0, 128, 128, 1)">3</span> <span style="color: rgba(0, 0, 0, 1)">ççè¿è¡ä¸ä¸
</span><span style="color: rgba(0, 128, 128, 1)">4</span> <span style="color: rgba(0, 0, 0, 1)">åç°æ¥é
</span><span style="color: rgba(0, 128, 128, 1)">5</span> <span style="color: rgba(0, 0, 0, 1)">æ ¹æ®æ¥éæ¹ä»£ç 
</span><span style="color: rgba(0, 128, 128, 1)">6</span> <span style="color: rgba(0, 0, 0, 1)">åè¿è¡
</span><span style="color: rgba(0, 128, 128, 1)">7</span> <span style="color: rgba(0, 0, 0, 1)">ç´å°è·é
</span><span style="color: rgba(0, 128, 128, 1)">8</span> æååæ»ç»ï¼å README</pre>
</div>
<p><strong>æ³¨æï¼</strong><br>è¿ä¸ªè¿ç¨ä¸­ï¼æ¯ä¸æ­¥é½ä¾èµä¸ä¸æ­¥çç»æãè¿ï¼å°±æ¯ Agent Loop çç´è§æ¥æºã</p>
<p><strong>2.æ®é ChatBot VS Agentï¼æ ¹æ¬åºå«å¨åªï¼</strong></p>
<p>æ®é ChatBot çå·¥ä½æ¹å¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">è¾å¥é®é¢
â
æ¨¡åâæ³ä¸æ³â
â
ä¸æ¬¡æ§è¾åºç­æ¡
â
ç»æ</span></pre>
</div>
<p>å®çç¹ç¹æ¯ï¼</p>
<ul>
<li>åªè½âæ³âï¼ä¸è½âåâ</li>
<li>æ²¡æçå®ä¸ççåé¦</li>
<li>æ´åæ¯å¨èè¯ç­é¢</li>
</ul>
<p>Codex Agent çå·¥ä½æ¹å¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">ç®æ 
â
æ³ä¸å°æ­¥
â
åä¸å°æ­¥
â
çç»æ
â
åæ³ä¸å°æ­¥
â
â¦â¦
â
å®æ</span></pre>
</div>
<p>å®çç¹ç¹æ¯ï¼</p>
<ul>
<li>æ¯ä¸è½®åªè§£å³ä¸ä¸ªéå¸¸å°çé®é¢</li>
<li>æ¯ä¸æ­¥é½åºäºçå®æ§è¡ç»æ</li>
<li>æ´åæ¯å¨çå®å·¥ä½</li>
</ul>
<p>Agent Loopï¼æ¬è´¨ä¸å°±æ¯æâä¸æ¬¡æ§åç­é®é¢âï¼ææäºâå¤è½®å°å³ç­âã</p>
<p><strong>3.&nbsp;ãLoopãè¿ä¸ªè¯ï¼ä¸ºä»ä¹è¿ä¹éè¦ï¼</strong></p>
<p>æä»¬åçä¸ä¸ªä¸å±å¼çæåµï¼</p>
<div class="cnblogs_code">
<pre>æ¨¡åå¨èå­éæ³ <span style="color: rgba(128, 0, 128, 1)">10</span><span style="color: rgba(0, 0, 0, 1)"> æ­¥
â
ä¸æ¬¡æ§è¾åºæç»ç­æ¡</span></pre>
</div>
<p>è¿ç§æ¹å¼çé®é¢æ¯ï¼</p>
<ul>
<li>ä¸­é´åªä¸æ­¥æ³éäºï¼ä½ å®å¨ä¸ç¥é</li>
<li>æ²¡ææºä¼ä¿®æ­£</li>
<li>å¯¹å¤æä»»å¡éå¸¸ä¸ç¨³å®</li>
</ul>
<p>è Agent Loop æ¯æè¿ 10 æ­¥âæå¼âï¼</p>
<div class="cnblogs_code">
<pre>ç¬¬ <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> æ­¥ï¼æè¯¥ä¸è¯¥çç®å½ï¼
â
ç¬¬ </span><span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)"> æ­¥ï¼æè¯¥ä¸è¯¥è¿è¡æµè¯ï¼
â
ç¬¬ </span><span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)"> æ­¥ï¼è¿ä¸ªæ¥éæ¯ä»ä¹ææï¼
â
ç¬¬ </span><span style="color: rgba(128, 0, 128, 1)">4</span> æ­¥ï¼æè¯¥æ¹åªä¸ªæä»¶ï¼</pre>
</div>
<p>è¿å°±æ¯ unrolling the loop çå«ä¹ï¼ææ¨¡ååæ¬âå¨èå­éä¸æ¬¡æ§å®æçæèâï¼ææä¸è½®ä¸è½®ãå¯æ§è¡ãå¯è§å¯çæ­¥éª¤ã</p>
<p><strong>4.ä¸ºä»ä¹è¯´ãæ¨¡åä¸æ¯ç´æ¥ç»ç­æ¡ãï¼</strong></p>
<p>å¤æé®é¢ï¼æ²¡æäººè½å¨âçé½æ²¡çç°åºâçæåµä¸ï¼ä¸æ¬¡å°±ç»åºå®ç¾ç­æ¡ãAgent Loop çè®¾è®¡ï¼æ­£æ¯æ¿è®¤äºè¿ä¸ç¹ãæä»¥ Codex çç­ç¥æ¯ï¼</p>
<ul>
<li>ä¸è¿½æ±âä¸æ¬¡ç­å¯¹â</li>
<li>èæ¯è¿½æ±ï¼
<ul>
<li>æ¯ä¸æ­¥é½æä¾æ®</li>
<li>æ¯ä¸æ­¥é½è½è¢«éªè¯</li>
<li>æ¯ä¸æ­¥éäºé½è½ä¿®</li>
</ul>
</li>
</ul>
<p>åè®¾ä½ çé¡¹ç®ç°å¨æ¯è¿æ ·ï¼</p>
<div class="cnblogs_code">
<pre>âä¸ä¸ª Node é¡¹ç®ï¼è¿è¡ npm start ä¼æ¥éâ</pre>
</div>
<p>Codex çåå¿ç¬ç½ï¼å¹¶ä¸æ¯ä¸å¥è¯ï¼èæ¯ç±»ä¼¼è¿æ ·ä¸è½®ä¸è½®å±å¼ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> æä¸ç¥éé¡¹ç®ç»æï¼æéè¦åçç â è°ç¨å·¥å·ï¼<span style="color: rgba(0, 0, 255, 1)">ls</span>
<span style="color: rgba(0, 128, 128, 1)">2</span> <span style="color: rgba(0, 0, 0, 1)">çèµ·æ¥æ¯ Node é¡¹ç®ï¼æåºè¯¥è¯çè¿è¡ â è°ç¨å·¥å·ï¼npm start
</span><span style="color: rgba(0, 128, 128, 1)">3</span> æ¥éè¯´ç¼ºä¾èµ â è°ç¨å·¥å·ï¼npm <span style="color: rgba(0, 0, 255, 1)">install</span>
<span style="color: rgba(0, 128, 128, 1)">4</span> <span style="color: rgba(0, 0, 0, 1)">åè¿è¡ä¸æ¬¡ â npm start
</span><span style="color: rgba(0, 128, 128, 1)">5</span> ç°å¨è·éäºï¼æå¯ä»¥æ»ç»äº â è¾åºæç»åç­</pre>
</div>
<h2>2.3&nbsp;æ Agent Loop ææ 5 ä¸ªæ­¥éª¤</h2>
<h3>2.3.1 æ¥æ¶ç¨æ·ç®æ ï¼ä¸æ¯é©¬ä¸å¹²æ´»ï¼</h3>
<p><strong>1 ç¨æ·è¾å¥ â  æ¨¡åç´æ¥æèçåå®¹</strong></p>
<p>å½ä½ å¨ Codex CLIï¼æä»»ä½ Agent ç³»ç»ï¼éè¾å¥ä¸å¥è¯ï¼æ¯å¦ï¼</p>
<div class="cnblogs_code">
<pre>âå¸®æç»è¿ä¸ªé¡¹ç®è¡¥ä¸ä¸ª READMEãâ</pre>
</div>
<p>å¾å¤äººä¼è¯¯ä»¥ä¸ºï¼</p>
<div class="cnblogs_code">
<pre>è¿å¥è¯ç´æ¥è¢«éè¿æ¨¡åï¼ç¶åæ¨¡åå¼å§æèã</pre>
</div>
<p>ä½å®éä¸ï¼å¨ Agent ç³»ç»éï¼è¿å¥è¯çè§è²æ´æ¥è¿äºï¼</p>
<div class="cnblogs_code">
<pre>âä»»å¡ç®æ ï¼Goalï¼â</pre>
</div>
<p>ä¹å°±æ¯è¯´ï¼å®åªæ¯åè¯ç³»ç»ï¼</p>
<div class="cnblogs_code">
<pre>æç»ä½ è¦æäºæåå°ä»ä¹ç¶æ</pre>
</div>
<p><strong>2 ä¸ºä»ä¹è¦æâç®æ âåâè¿ç¨âåå¼ï¼</strong></p>
<p>å ä¸º Agent Loop çè®¾è®¡çå¿µæ¯ï¼</p>
<ul>
<li>ç®æ æ¯ç¨³å®ç</li>
<li>è¿ç¨æ¯å¨æååç</li>
</ul>
<p>ä¸¾ä¸ªçæ´»åçä¾å­ï¼</p>
<div class="cnblogs_code">
<pre>ä½ çç®æ æ¯âææ¿é´æ¶æ¾å¹²åâ</pre>
</div>
<p>ä½ å¹¶ä¸ä¼ä¸å¼å§å°±å³å®ï¼</p>
<ul>
<li>åæ«å°è¿æ¯åæ´çæ¡å­</li>
<li>åå¾æå¤å°</li>
<li>è¦ä¸è¦æ¢åå¾è¢</li>
</ul>
<p>ä½ åªæ¯ç¥éï¼æåè¦å¹²å</p>
<p>Codex ä¹æ¯ä¸æ ·ã</p>
<div class="cnblogs_code">
<pre>ç¨æ·è¾å¥åªè´è´£å®ä¹âç»ç¹âï¼ä¸è´è´£å®ä¹âè·¯å¾âã</pre>
</div>
<h3>2.3.2&nbsp;æé å½åä¸ä¸æï¼Promptï¼</h3>
<p><strong>1.Prompt æ¯âæ¨¡åçä¸ççå¨é¨ä¿¡æ¯â</strong></p>
<p>è¿æ¯ Agent Loop éæå³é®ãä¹æå®¹æè¢«ä½ä¼°çä¸æ­¥ã</p>
<p>æä»¬åè¯´ä¸å¥éå¸¸éè¦çè¯ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">å¯¹æ¨¡åæ¥è¯´ï¼å®å¹¶ä¸ç¥éâåååçäºä»ä¹âï¼
é¤éä½ æè¿äºä¿¡æ¯æ¾è¿ Promptã</span></pre>
</div>
<p>æä»¥ï¼æ¯ä¸è½® Agent Loopï¼é½ä¼éæ°æé ä¸ä¸ª Promptã</p>
<p><strong>2.Prompt ééå¸¸åå«åªäºä¸è¥¿ï¼</strong></p>
<p>ä¸ä¸ªå®æ´ç Promptï¼éå¸¸åå«ï¼</p>
<ol>
<li>ä½ æ¯è°ï¼ç³»ç»è®¾å®ï¼<ol>
<li>ä½ æ¯ä¸ä¸ª coding agent</li>
<li>ä½ å¯ä»¥ä¿®æ¹æä»¶ãè¿è¡å½ä»¤</li>
</ol></li>
<li>ä½ è½ç¨ä»ä¹å·¥å·<ol>
<li>shell</li>
<li>æä»¶è¯»å</li>
<li>æµè¯è¿è¡</li>
</ol></li>
<li>ç¨æ·ç®æ <ol>
<li>æ¯å¦ï¼è¡¥ README</li>
</ol></li>
<li>å°ç®åä¸ºæ­¢åçäºä»ä¹<ol>
<li>æåæè¿è¡äºä»ä¹å½ä»¤</li>
<li>è¾åºç»ææ¯ä»ä¹</li>
<li>ææ²¡ææ¥é</li>
</ol></li>
</ol>
<p>å¯¹æ¨¡åæ¥è¯´ï¼è¿äºåå®¹å°±æ¯å®çâè®°å¿âã</p>
<p><strong>3.ä¸ºä»ä¹æ¯ä¸è½®é½è¦âéæ°æé â Promptï¼</strong></p>
<p>ä¸¾ä¸ªä¾å­ï¼</p>
<ul>
<li>ç¬¬ä¸è½®ï¼ä½ è¿æ²¡çè¿é¡¹ç®ç»æ</li>
<li>ç¬¬äºè½®ï¼ä½ å·²ç»ç¥éæåªäºæä»¶</li>
<li>ç¬¬ä¸è½®ï¼ä½ å·²ç»çå°æµè¯æ¥é</li>
</ul>
<p>å¦æ Prompt ä¸æ´æ°ï¼æ¨¡åå°±ä¼ï¼</p>
<ul>
<li>æ°¸è¿ä»¥ä¸ºèªå·±ä»ä¹é½ä¸ç¥é</li>
</ul>
<p>æä»¥ Agent Loop çä¸ä¸ªæ ¸å¿å¨ä½å°±æ¯ï¼</p>
<ul>
<li>æâåååççç°å®ç»æâï¼ç¿»è¯ææ¨¡åè½çè§£çæå­ï¼åå¡å Promptã</li>
</ul>
<h3>2.3.3&nbsp;è®©æ¨¡ååâä¸ä¸æ­¥å³ç­â</h3>
<p><strong>1.æ¨¡åå¨è¿ä¸è½®ï¼åªåç­ä¸ä¸ªé®é¢</strong></p>
<p>è¿æ¯ Agent Loop ççµé­æå¨ã</p>
<ul>
<li>æ¨¡åä¸ä¼å¨è¿ä¸è½®éæææäºææ³å®ã</li>
</ul>
<p>å®åªåä¸ä¸ªéå¸¸å·ä½ãéå¸¸æéçå¤æ­ï¼</p>
<ul>
<li>âå¨å½åä¿¡æ¯æ¡ä»¶ä¸ï¼æä¸ä¸æ­¥è¯¥åä»ä¹ï¼â</li>
</ul>
<p><strong>2.è¿ä¸ªâä¸ä¸æ­¥âï¼éå¸¸åªæä¸¤ç§å¯è½</strong></p>
<p><strong>æåµä¸ï¼æè¿éè¦æ´å¤ä¿¡æ¯ / è¡å¨</strong></p>
<p>æ¨¡åä¼è¯´ç±»ä¼¼ï¼</p>
<ul>
<li>âæéè¦ççç®å½ç»æâ</li>
<li>âæéè¦è·ä¸ä¸æµè¯â</li>
<li>âæéè¦æå¼æä¸ªæä»¶ççåå®¹â</li>
</ul>
<p>å¨ç³»ç»å±é¢ï¼è¿ä¼è¢«è¡¨è¾¾ä¸ºï¼</p>
<ul>
<li>Tool Callï¼å·¥å·è°ç¨ï¼</li>
</ul>
<p><strong>æåµäºï¼ä¿¡æ¯å·²ç»å¤äºï¼å¯ä»¥ç»æ</strong></p>
<p>æ¨¡åä¼è¯´ç±»ä¼¼ï¼</p>
<ul>
<li>âç°å¨æå¯ä»¥å README äºâ</li>
<li>âé®é¢å·²ç»ä¿®å¤å®æâ</li>
</ul>
<p>è¿æ¶ï¼å®ä¼ç´æ¥è¾åºæç»åç­ï¼Agent Loop ç»æã</p>
<p><strong>3.ä¸ºä»ä¹è¦éå¶æâåªæ³ä¸æ­¥âï¼</strong></p>
<p>å ä¸ºè¿æ¯æ§å¶å¤æåº¦çå³é®ã</p>
<p>å¦ææ¨¡åä¸æ¬¡æ§æ³ 10 æ­¥ï¼</p>
<ul>
<li>ä¸­é´åªä¸æ­¥éäºï¼ä½ ä¸ç¥é</li>
<li>æ æ³æå¥çå®åé¦</li>
<li>å¾é¾çº æ­£</li>
</ul>
<p>èâä¸æ­¥ä¸æ³âçå¥½å¤æ¯ï¼</p>
<ul>
<li>æ¯ä¸æ­¥é½å¯ä»¥è¢«éªè¯</li>
<li>éäºå°±é©¬ä¸ä¿®</li>
<li>å¯¹å¤æä»»å¡æ´ç¨³</li>
</ul>
<h3>2.3.4&nbsp;å¦æè¦å¹²æ´» â è°å·¥å·</h3>
<p><strong>1.æ¨¡åèªå·±âä¸ä¼å¹²æ´»â</strong></p>
<p>æ¨¡å â  è½æ§è¡å½ä»¤çç¨åºï¼æ¨¡ååªè½è¾åºæå­ï¼æç»æåæä»¤ï¼ï¼ä½ï¼</p>
<ul>
<li>å®ä¸è½ççè¿è¡ ls</li>
<li>ä¸è½ççæ§è¡ npm install</li>
<li>ä¸è½ççåæä»¶</li>
</ul>
<p><strong>2.Tool çä½ç¨ï¼æâå»ºè®®âåæâç°å®å¨ä½â</strong></p>
<p>å½æ¨¡åè¯´ï¼âæéè¦è¿è¡ ls ççç®å½âï¼Agent ç³»ç»ä¼ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> <span style="color: rgba(0, 0, 0, 1)">è§£ææ¨¡åè¾åº
</span><span style="color: rgba(0, 128, 128, 1)">2</span> <span style="color: rgba(0, 0, 0, 1)">åç°è¿æ¯ä¸ä¸ª tool call
</span><span style="color: rgba(0, 128, 128, 1)">3</span> <span style="color: rgba(0, 0, 0, 1)">å¨çå®ç¯å¢éæ§è¡å½ä»¤
</span><span style="color: rgba(0, 128, 128, 1)">4</span> æ¶éçå®è¾åº</pre>
</div>
<h3>2.3.5&nbsp;æç»æå¡åä¸ä¸æï¼ç»§ç»­å¾ªç¯</h3>
<p><strong>1.è¿æ¯ Agent Loop æâåç´è§âçä¸æ­¥</strong></p>
<p>å¾å¤äººä¼ä»¥ä¸ºï¼å·¥å·æ§è¡å®ï¼æ¨¡åâå°±ç¥éç»æäºâï¼å¶å®ä¸ç¶ãæ¨¡åå¹¶ä¸ç¥éå·¥å·æ§è¡ç»æï¼é¤éä½ æç»æåè¿ Promptã</p>
<p><strong>2.ç°å® â ææ¬ â Prompt</strong></p>
<p>Agent ä¼æåæçæ§è¡ç»æï¼è½¬æç±»ä¼¼è¿æ ·çåå®¹ï¼</p>
<div class="cnblogs_code">
<pre>ä½ ååè¿è¡äº <span style="color: rgba(0, 0, 255, 1)">ls</span><span style="color: rgba(0, 0, 0, 1)">
è¾åºæ¯ï¼
src</span>/<span style="color: rgba(0, 0, 0, 1)">
package.json</span></pre>
</div>
<p>ç¶åï¼</p>
<ul>
<li>æè¿æ®µæå­å å¥ Prompt</li>
<li>ååèµ·ä¸ä¸è½®æ¨¡åæ¨ç</li>
</ul>
<p>è¿ä¸æ­¥å®æåï¼æ°çä¸è½® Loop å¼å§ã</p>
<p>æä»¬ç°å¨å¯ä»¥æè¿ 5 æ­¥ï¼ç¨ä¸å¥éå¸¸çæ´»åçè¯è¯´æ¸æ¥ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 128, 1)">1</span> <span style="color: rgba(0, 0, 0, 1)">æå½åæåµåè¯æ¨¡å
</span><span style="color: rgba(0, 128, 128, 1)">2</span> <span style="color: rgba(0, 0, 0, 1)">è®©æ¨¡åå³å®ä¸ä¸å°æ­¥
</span><span style="color: rgba(0, 128, 128, 1)">3</span> <span style="color: rgba(0, 0, 0, 1)">æçå®ç»æåé¦åå»
</span><span style="color: rgba(0, 128, 128, 1)">4</span> ç´å°æ¨¡åè§å¾âå¯ä»¥æ¶å·¥äºâ</pre>
</div>
<h1>3.Agent Loopä»£ç ç¤ºä¾</h1>
<p>åé¢æä»¬è®²äºå¾å¤æ¦å¿µï¼<br>Agent Loopãç®æ ãPromptãå·¥å·ãåé¦â¦â¦<br>ç°å¨æä»¬ç¨ä¸æ®µæå°ä½å®æ´çä»£ç ï¼æè¿äºæ¦å¿µå¨é¨è½å°å®å¤ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> SimpleAgent:
    </span><span style="color: rgba(0, 0, 255, 1)">def</span> <span style="color: rgba(128, 0, 128, 1)">__init__</span><span style="color: rgba(0, 0, 0, 1)">(self, llm):
        self.llm </span>=<span style="color: rgba(0, 0, 0, 1)"> llm
        self.history </span>=<span style="color: rgba(0, 0, 0, 1)"> []

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> run(self, goal):
        </span><span style="color: rgba(0, 0, 255, 1)">while</span><span style="color: rgba(0, 0, 0, 1)"> True:
            prompt </span>=<span style="color: rgba(0, 0, 0, 1)"> self.build_prompt(goal)
            response </span>=<span style="color: rgba(0, 0, 0, 1)"> self.llm(prompt)

            </span><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¦ææ¨¡åè¯´âå®æäºâ</span>
            <span style="color: rgba(0, 0, 255, 1)">if</span> response[<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">type</span><span style="color: rgba(128, 0, 0, 1)">"</span>] == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">final</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
                </span><span style="color: rgba(0, 0, 255, 1)">print</span>(response[<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">text</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">])
                </span><span style="color: rgba(0, 0, 255, 1)">break</span>

            <span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> å¦ææ¨¡åè¦ç¨å·¥å·</span>
            <span style="color: rgba(0, 0, 255, 1)">if</span> response[<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">type</span><span style="color: rgba(128, 0, 0, 1)">"</span>] == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">tool_call</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
                result </span>=<span style="color: rgba(0, 0, 0, 1)"> self.execute_tool(response)
                self.history.append(result)

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> build_prompt(self, goal):
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> {
            </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">goal</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">: goal,
            </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">history</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">: self.history
        }

    </span><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> execute_tool(self, call):
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> call[<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">name</span><span style="color: rgba(128, 0, 0, 1)">"</span>] == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">shell</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">:
            </span><span style="color: rgba(0, 0, 255, 1)">return</span> os.popen(call[<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">command</span><span style="color: rgba(128, 0, 0, 1)">"</span>]).read()</pre>
</div>
<p>è¿æ®µä»£ç ä¸æ¯çäº§çº§ï¼ä½å®100%ä½ç°äº Agent Loop çæ¬è´¨ç»æãä¸é¢æä»¬ä»æ´ä½ â å±é¨ â æ¯ä¸è¡çâä¸ºä»ä¹âæ¥æã</p>
<h3>1.åæ´ä½çè§£ï¼è¿æ®µä»£ç å¨å¹²ä»ä¹ï¼</h3>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">å®å¨åä¸ä»¶äºï¼
ä¸æ­æâå½åç¶æâäº¤ç»æ¨¡åï¼è®©æ¨¡åå³å®ä¸ä¸æ­¥ï¼
ç¶åæ ¹æ®ç»ææ´æ°ç¶æï¼ç´å°æ¨¡åè¯´âå¯ä»¥ç»æäºâã</span></pre>
</div>
<p>å¯ä»¥çè§£ä¸ºï¼âä½ åæ³ä¸æ­¥ â æå¸®ä½ å¹² â æç»æåè¯ä½  â ä½ åæ³ä¸æ­¥â</p>
<h3>2.class SimpleAgentï¼Agent ä¸æ¯æ¨¡åï¼èæ¯âè°åº¦èâ</h3>
<p>Agent â  æ¨¡åï¼LLMï¼</p>
<ul>
<li>llmï¼è´è´£âæè / å³ç­â</li>
<li>Agentï¼è´è´£âå¾ªç¯ / æ§è¡ / ç¶æç®¡çâ</li>
</ul>
<p>Agent çè§è²æ´åæ¯ä¸ä¸ªé¡¹ç®ç»ç + æ§è¡å©çã</p>
<h3>3.__init__ï¼Agent çâé¿æè®°å¿âå¨åªéï¼</h3>
<p>self.llm æ¯ä»ä¹ï¼</p>
<ul>
<li>å®æ¯ä¸ä¸ªå½æ°æå¯¹è±¡</li>
<li>è¾å¥ï¼Prompt</li>
<li>è¾åºï¼æ¨¡åçâä¸ä¸æ­¥å³ç­â</li>
</ul>
<p>ä½ å¯ä»¥æå®çè§£æï¼</p>
<div class="cnblogs_code">
<pre>response = å¤§æ¨¡å(prompt)</pre>
</div>
<h3>4.self.history ä¸ºä»ä¹è¿ä¹éè¦ï¼</h3>
<p>è¿æ¯æ´ä¸ª Agent Loop çæ ¸å¿ç¶æã</p>
<p>history éå­çä¸æ¯èå¤©è®°å½ï¼èæ¯ï¼</p>
<ul>
<li>ä½ ååæ§è¡äºä»ä¹å½ä»¤</li>
<li>å½ä»¤è¾åºäºä»ä¹</li>
<li>ææ²¡ææ¥é</li>
</ul>
<p>å®æ¯âç°å®ä¸çåçè¿çäºæâçææ¬åè®°å½</p>
<p>å¦ææ²¡æ historyï¼</p>
<ul>
<li>æ¨¡åæ¯ä¸è½®é½ä¼âå¤±å¿â</li>
<li>æ°¸è¿ä¸ç¥éèªå·±åæå¹²è¿ä»ä¹</li>
</ul>
<h3>5.run æ¹æ³ï¼Agent Loop ççæ­£å¥å£</h3>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">def</span> run(self, goal):</pre>
</div>
<p>è¿éç goalï¼å°±æ¯ä½ è¾å¥çé£å¥ï¼</p>
<div class="cnblogs_code">
<pre>âå¸®æç»è¿ä¸ªé¡¹ç®å ä¸ä¸ª READMEâ</pre>
</div>
<p>å®åªåä¸ä»¶äºï¼å®ä¹ç»ç¹ï¼ä¸å®ä¹è·¯å¾ã</p>
<h3>6.while Trueï¼ä¸ºä»ä¹ Agent å¿é¡»æ¯âæ­»å¾ªç¯âï¼</h3>
<p>è¿è¡ä»£ç éå¸¸å³é®ã</p>
<p>å¾å¤äººä¸çå°âæ­»å¾ªç¯âä¼ä¸æè¯è§å¾ä¸ä¼éï¼ä½å¨ Agent éï¼</p>
<ul>
<li>æ²¡æå¾ªç¯ï¼å°±æ²¡æ Agent</li>
</ul>
<p>ä¸ºä»ä¹ï¼</p>
<p>å ä¸º Agent çå·¥ä½æ¨¡å¼æ¯ï¼</p>
<ul>
<li>ä¸ç¥éè¦å¾ªç¯å¤å°è½®</li>
<li>ä¸ç¥éä»ä¹æ¶åä¿¡æ¯æâè¶³å¤â</li>
<li>åªè½ä¸è½®ä¸è½®è¯</li>
</ul>
<p>ç»ææ¡ä»¶ä¸æ¯åæ­»çï¼èæ¯ç±æ¨¡åå³å®çã</p>
<h3>7.build_promptï¼æ¨¡åâçå°çä¸çâæ¯æä¹æ¥çï¼</h3>
<div class="cnblogs_code">
<pre>prompt = self.build_prompt(goal)</pre>
</div>
<p>è¿æ¯ Agent Loop ä¸­æå®¹æè¢«å¿½ç¥ï¼ä½æéè¦çä¸æ­¥ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">def</span><span style="color: rgba(0, 0, 0, 1)"> build_prompt(self, goal):
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> {
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">goal</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">: goal,
        </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">history</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">: self.history
    }</span></pre>
</div>
<p>å®åçäºæéå¸¸ç®åï¼ä½æä¹éå¸¸å¤§ï¼æâç®æ  + å·²åççäºå®âæåï¼äº¤ç»æ¨¡åã</p>
<h3>8.response = self.llm(prompt)ï¼æ¨¡ååªåä¸ä»¶äº</h3>
<div class="cnblogs_code">
<pre>response = self.llm(prompt)</pre>
</div>
<p>è¿ä¸è¡ï¼çä¼¼ç®åï¼å¶å®å³å®äºæ´ä¸ª Agent çé£æ ¼ã</p>
<p>æ¨¡åå¨è¿éä¸ä¼ï¼</p>
<ul>
<li>åå®æ´ä»£ç </li>
<li>ä¸æ¬¡æ§è§£å³ææé®é¢</li>
</ul>
<p>å®åªåç­ä¸ä¸ªé®é¢ï¼</p>
<ul>
<li>âå¨å½å prompt æ¡ä»¶ä¸ï¼æä¸ä¸æ­¥è¯¥åä»ä¹ï¼â</li>
</ul>
<p>æä»¬ç¨ä¸å¥å®æ´çæµç¨å¤è¿°ï¼</p>
<ul>
<li>Agent æç®æ  + åå²äº¤ç»æ¨¡å</li>
<li>æ¨¡åè¯´ï¼âä¸ä¸æ­¥å¹²è¿ä¸ªâ</li>
<li>Agent å»çå®æ§è¡</li>
<li>Agent æç»æè®°å½ä¸æ¥</li>
<li>åå°ç¬¬ 1 æ­¥</li>
<li>ç´å°æ¨¡åè¯´ï¼</li>
<li>âå¯ä»¥ç»æäºãâ</li>
</ul>
<h1>4.æ»ç»</h1>
<p>Codex Agent ççæ­£ä»·å¼ï¼å¹¶ä¸å¨äºå®âåä»£ç æå¤å¿«âï¼èå¨äºå®è¢«è®¾è®¡æä¸ä¸ªå¯ä»¥åå¤æèåè¡å¨çç³»ç»ãéè¿ Agent Loopï¼æ¨¡åä¸åè¯å¾ä¸æ¬¡æ§ç»åºå®ç¾ç­æ¡ï¼èæ¯åçå®å·¥ç¨å¸ä¸æ ·ï¼åå°è¯ãåè§å¯ãåä¿®æ­£ï¼éæ­¥æ¨è¿ç®æ å®æãè¿ç§âæè â æ§è¡ â åé¦ â åæèâçå¾ªç¯æºå¶ï¼è®©å¤æé®é¢è¢«èªç¶æè§£æä¸è¿ä¸²å¯éªè¯çå°æ­¥éª¤ï¼ä¹è®©éè¯¯åæç³»ç»çä¸é¨åï¼èä¸æ¯å¤±è´¥çç»ç¹ã</p>
<h1>5.ç»æè¯­</h1>
<p>è¿ç¯åå®¢å°±åå¤§å®¶åäº«å°è¿éï¼å¦æå¤§å®¶å¨ç ç©¶å­¦ä¹ çè¿ç¨å½ä¸­æä»ä¹é®é¢ï¼å¯ä»¥å ç¾¤è¿è¡è®¨è®ºæåéé®ä»¶ç»æï¼æä¼å°½ææè½ä¸ºæ¨è§£ç­ï¼ä¸åå±åï¼</p>
<p>å¦å¤ï¼åä¸»åºæ°ä¹¦äºã<span style="color: rgba(255, 0, 0, 1)"><strong><a href="https://item.jd.com/14421833.html" rel="noopener nofollow" target="_blank"><span style="color: rgba(255, 0, 0, 1)">Hadoopä¸Sparkå¤§æ°æ®å¨æ¯è§£æ</span></a></strong></span>ããåæ¶å·²åºççã<span style="color: rgba(0, 0, 255, 1)"><strong><a href="https://item.jd.com/14699434.html" rel="noopener nofollow" target="_blank"><span style="color: rgba(0, 0, 255, 1)">æ·±å¥çè§£Hive</span></a></strong></span>ããã<span style="color: rgba(0, 0, 255, 1)"><strong><a href="https://item.jd.com/12455361.html" rel="noopener nofollow" target="_blank"><span style="color: rgba(0, 0, 255, 1)">Kafkaå¹¶ä¸é¾å­¦</span></a></strong></span>ãåã<span style="color: rgba(0, 0, 255, 1)"><strong><a href="https://item.jd.com/12371763.html" rel="noopener nofollow" target="_blank"><span style="color: rgba(0, 0, 255, 1)">Hadoopå¤§æ°æ®ææä»å¥é¨å°è¿é¶å®æ</span></a></strong></span>ãä¹å¯ä»¥åæ°ä¹¦éå¥ä½¿ç¨ï¼åæ¬¢çæåæåå­¦ï¼ å¯ä»¥<span style="color: rgba(255, 0, 0, 1)"><strong>å¨å¬åæ é£éç¹å»è´­ä¹°é¾æ¥è´­ä¹°åä¸»çä¹¦</strong></span>è¿è¡å­¦ä¹ ï¼å¨æ­¤æè°¢å¤§å®¶çæ¯æãå³æ³¨ä¸é¢å¬ä¼å·ï¼æ ¹æ®æç¤ºï¼å¯åè´¹è·åä¹¦ç±çæå­¦è§é¢ã</p>
<p>&nbsp;</p>

</div>
<div id="MySignature" role="contentinfo">
    <div>
<b class="b1"></b><b class="b2 d1"></b><b class="b3 d1"></b><b class="b4 d1"></b>
<div class="b d1 k">  
èç³»æ¹å¼ï¼
<br>
é®ç®±ï¼smartloli.org@gmail.com
<br>
<strong style="color: green">QQç¾¤ï¼Hiveä¸AIå®æãæ°ç¾¤ãï¼ï¼935396818</strong>
<br>
QQç¾¤ï¼Hadoop - äº¤æµç¤¾åº1ï¼ï¼424769183
<br>
QQç¾¤ï¼Kafkaå¹¶ä¸é¾å­¦ï¼ï¼825943084
<br>
æ¸©é¦¨æç¤ºï¼è¯·å¤§å®¶å ç¾¤çæ¶ååä¸å ç¾¤çç±ï¼å§åï¼å¬å¸/å­¦æ ¡ï¼ï¼æ¹ä¾¿ç®¡çåå®¡æ ¸ï¼è°¢è°¢ï¼
<br>
<h3>ç­ç±çæ´»ï¼äº«åç¼ç¨ï¼ä¸åå±åï¼</h3>  
</div>
<b class="b4b d1"></b><b class="b3b d1"></b><b class="b2b d1"></b><b class="b1b"></b>
</div>
<br>
<div>
<b class="b1"></b><b class="b2 d1"></b><b class="b3 d1"></b><b class="b4 d1"></b>
<div class="b d1 k">
<h3>å¬ä¼å·ï¼</h3>
<h3><img style="width: 8%; margin-left: 10px" src="https://www.cnblogs.com/images/cnblogs_com/smartloli/1324636/t_qr.png"></h3>
</div>
<b class="b4b d1"></b><b class="b3b d1"></b><b class="b2b d1"></b><b class="b1b"></b>
</div>
<br>
<div>
<b class="b1"></b><b class="b2 d1"></b><b class="b3 d1"></b><b class="b4 d1"></b>
<div class="b d1 k">
<h3>ä½èï¼å¥ä¸æ¯å°èè ï¼»<a style="color: green" href="http://www.kafka-eagle.org/" target="_blank">å³äºæ</a>ï¼½ï¼»<a style="color: green" href="http://www.cnblogs.com/smartloli/p/4241701.html" target="_blank">çèµ</a>ï¼½</h3>
<h3>åºå¤ï¼<a style="color: green" href="http://www.cnblogs.com/smartloli/" target="_blank">http://www.cnblogs.com/smartloli/</a></h3>
<h3>è½¬è½½è¯·æ³¨æåºå¤ï¼è°¢è°¢åä½ï¼</h3>
</div>
<b class="b4b d1"></b><b class="b3b d1"></b><b class="b2b d1"></b><b class="b1b"></b>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-28 23:33">2026-01-28 23:32</span>&nbsp;
<a href="https://www.cnblogs.com/smartloli">å¥ä¸æ¯å°èè</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19530777);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19530777', targetLink: 'https://www.cnblogs.com/smartloli/p/19530777', title: 'æ­ç§ Codex Agent çæ ¸å¿è¿è¡æºå¶ï¼ä»å¾ªç¯å°æºè½å³ç­' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ è·¨å¹³å° UI å·¥ç¨ç Agentic è½¬åï¼MCP å¨ Avalonia çæä¸­çæ·±åº¦åºç¨ä¸æ¶ææ¼è¿ ]]></title>
    <link>https://www.cnblogs.com/shanyou/p/19545779</link>
    <guid>cf57467180282c9c17adf84f6cf725d6</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/shanyou/p/19545779" title="åå¸äº 2026-01-28 21:59">
    <span role="heading" aria-level="2">è·¨å¹³å° UI å·¥ç¨ç Agentic è½¬åï¼MCP å¨ Avalonia çæä¸­çæ·±åº¦åºç¨ä¸æ¶ææ¼è¿</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨äººå·¥æºè½è¾å©è½¯ä»¶å¼åçæ¼è¿åç¨ä¸­ï¼å¤§åè¯­è¨æ¨¡åï¼LLMï¼é¿æä»¥æ¥ä¸ç´é¢ä¸´çä¸ä¸ªæ ¸å¿ç¶é¢ï¼ç±äºç¼ºä¹å¯¹è¿è¡ä¸­åºç¨ç¨åºç¶æçå®æ¶è®¿é®æï¼è¿äºæ¨¡åå¾å¾å¤äºä¸ç§âææ¬çç©ºâç¶æ ãå°½ç®¡è¯¸å¦ Claude 3.5 Sonnet æ GPT-4o ç­åæ²¿æ¨¡åå¨çæ XAML ä»£ç æ C# åç«¯é»è¾æ¹é¢è¡¨ç°åºè²ï¼ä½å®ä»¬å¨é¢å¯¹å¤æçè·¨å¹³å° UI æ¡æ¶ï¼å¦ Avalonia UIï¼æ¶ï¼ä¾ç¶é¾ä»¥å¨æ²¡æäººå·¥å¹²é¢çæåµä¸å®ç°é­ç¯è°è¯ ãéç Anthropic å¨ 2024 å¹´ 11 æåå¸æ¨¡åä¸ä¸æåè®®ï¼Model Context Protocol, MCPï¼ï¼è¿ä¸ç°ç¶åçäºæ ¹æ¬æ§çè½¬åãAvalonia å¢ééè¿å¼å¥ Avalonia DevTools MCP Serverï¼ä»¥ä¸ç®ç§° avalonia_devtoolsï¼ï¼æåå°å¨ AI ä»£çä¸è¿è¡ä¸­ç Avalonia åºç¨ä¹é´å»ºç«äºä¸åº§ç¨åºåæ¡¥æ¢ï¼æ å¿ç AI å¯¹ Avalonia ççè§£ä»éæçä»£ç çè§£è·¨è¶å°äºå¨æçè¿è¡æ¶æ´å¯ ã</p>
<h2 id="ä¸æ¨¡åä¸ä¸æåè®®-mcp-çæ¶æé»è¾ä¸æ ååé©å½"><strong>ä¸ï¼æ¨¡åä¸ä¸æåè®® (MCP) çæ¶æé»è¾ä¸æ ååé©å½</strong></h2>
<p>å¨æ·±å¥æ¢è®¨ Avalonia çå·ä½å®ç°ä¹åï¼å¿é¡»çè§£ MCP å¦ä½è§£å³äºé¿ä¹ä»¥æ¥çâNÃMâéæé¾é¢ãå¨ MCP åºç°ä¹åï¼å¼åèå¦æå¸æ AI å©æè¿æ¥å°ä¸ä¸ªç¹å®çæ°æ®æºæå·¥å·ï¼éå¸¸éè¦ä¸ºæ¯ä¸ä¸ªæ¨¡ååæ¯ä¸ä¸ªå·¥å·æå»ºå®å¶åçè¿æ¥å¨ ãè¿ç§ç¢çåççæç³»ç»ä¸ä»é¾ä»¥è§æ¨¡åï¼æ´éå¶äº AI ä»£çå¨å¤çè·¨ç³»ç»ä»»å¡æ¶ççµæ´»æ§ã</p>
<h3 id="mcp-çæ ¸å¿ç»ä»¶ä¸éä¿¡æºå¶"><strong>MCP çæ ¸å¿ç»ä»¶ä¸éä¿¡æºå¶</strong></h3>
<p>MCP è¢«è®¾è®¡ä¸ºä¸ç§å¼æ¾æ åï¼å¶çµææºèªæåç®åäº IDE è¯­è¨æ¯æçè¯­è¨æå¡å¨åè®®ï¼Language Server Protocol, LSPï¼ãè¯¥åè®®éç¨ JSON-RPC 2.0 æ¶æ¯æµï¼å¨å®¢æ·ç«¯ãä¸»æºåæå¡å¨ä¹é´å»ºç«äºæ ååçäº¤äºè¯­è¨ãå¶æ¶æç±ä¸ä¸ªå³é®é¨åç»æï¼</p>
<ol>
<li><strong>MCP å®¿ä¸» (Host)ï¼</strong> å®æ¯ç¨æ·ä¸ AI äº¤äºçèµ·ç¹ï¼ä¾å¦ AI åç IDEï¼å¦ CursorãZedãVS Codeï¼æå¯¹è¯å¼å®¢æ·ç«¯ï¼å¦ Claude Desktopï¼ãå®¿ä¸»è´è´£ç®¡ç LLM çè¯·æ±ï¼å¹¶å³å®ä½æ¶è°ç¨å¤é¨å·¥å· ã</li>
<li><strong>MCP å®¢æ·ç«¯ (Client)ï¼</strong> ä½äºå®¿ä¸»åé¨ï¼åå½ LLM ä¸æå¡å¨ä¹é´çç¿»è¯å®ï¼è´è´£åç°å¯ç¨çæå¡å¨å¹¶å°å¶è½åï¼Tools, Resources, Promptsï¼æ´é²ç»æ¨¡åã</li>
<li><strong>MCP æå¡å¨ (Server)ï¼</strong> è¿æ¯åè®®çæ ¸å¿æ©å±ç¹ï¼å®ç´æ¥è¿æ¥å°å·ä½çæ°æ®æºï¼å¦æ°æ®åºãAPI ææ­£å¨è¿è¡çåºç¨ç¨åºï¼ï¼å¹¶å°è¿äºç³»ç»çè½åè½¬åä¸º LLM å¯çè§£çç»æåå·¥å·è°ç¨ã</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align: left">ç»ä»¶</th>
<th style="text-align: left">åè½æè¿°</th>
<th style="text-align: left">ä¼ è¾å±å®ç°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">MCP Server</td>
<td style="text-align: left">æä¾æ°æ®ãå·¥å·åä¸ä¸æçå¤é¨æå¡</td>
<td style="text-align: left">stdio (æ¬å°) / SSE (è¿ç¨)</td>
</tr>
<tr>
<td style="text-align: left">MCP Client</td>
<td style="text-align: left">è´è´£åç°æå¡å¨å¹¶åè° LLM è¯·æ±</td>
<td style="text-align: left">JSON-RPC 2.0 æ¶æ¯</td>
</tr>
<tr>
<td style="text-align: left">MCP Host</td>
<td style="text-align: left">ç¨æ·äº¤äºçé¢ (å¦ IDE æ Chat çªå£)</td>
<td style="text-align: left">éæäºåºç¨ç¯å¢</td>
</tr>
<tr>
<td style="text-align: left">Transport Layer</td>
<td style="text-align: left">ç¡®ä¿æ¶æ¯å¨ä¸åè¿ç¨æç½ç»é´å®å¨ä¼ é</td>
<td style="text-align: left">æ åè¾å¥è¾åºææå¡å¨åéäºä»¶</td>
</tr>
</tbody>
</table>
<p>è¿ç§æ¶æä¸ä»å®ç°äºâè§£è¦âï¼æ´èµäºäº AI ä»£çç±»ä¼¼äºäººç±»å¼åèçâæåç¼â ãéè¿ stdioï¼éç¨äºæ¬å°èµæºï¼å SSEï¼éç¨äºè¿ç¨èµæºï¼ä¸¤ç§ä¼ è¾æ¹å¼ï¼MCP ç¡®ä¿äºéä¿¡çä½å»¶è¿ä¸å®æ¶æ§ï¼è¿å¯¹äº UI è°è¯è¿ç§éè¦å³æ¶åé¦çåºæ¯è³å³éè¦ ã</p>
<h2 id="äºavalonia-devtools-mcp-server-çæ ¸å¿åè½ä¸å·¥å·é"><strong>äºï¼Avalonia DevTools MCP Server çæ ¸å¿åè½ä¸å·¥å·é</strong></h2>
<p>Avalonia å¢éæ¨åºç avalonia_devtools å¹¶ä¸æ¯ä¸ä¸ªç®åçææ¡£æç´¢å·¥å·ï¼èæ¯ä¸ä¸ªè½å¤è®© AI ç´æ¥æ§å¶ç¨åºå DevTools çå¼ºåæä»¶ãå®è§£å³äºå¤§è§æ¨¡åºç¨è¿ç§»å UI è°æ´ä¸­æä¸ºæ¯ç¥ãéå¤ä¸èæ¶çä»»å¡ã</p>
<h3 id="è¿è¡æ¶è¿æ¥ä¸å¤å®ä¾ç®¡ç"><strong>è¿è¡æ¶è¿æ¥ä¸å¤å®ä¾ç®¡ç</strong></h3>
<p>å¨å¤æçä¼ä¸å¼åç¯å¢ä¸­ï¼å¼åèå¾å¾ä¼åæ¶è¿è¡å¤ä¸ªåºç¨å®ä¾æä¸åçæ¬çåä¸ä¸ªåºç¨ãavalonia_devtools æä¾äºä¸å¥å®æ´çè¿æ¥ä¸åç°å·¥å·ï¼åè®¸ AI ä»£çï¼</p>
<ul>
<li>æä¸¾å½åæºå¨ä¸ææå¯ç¨çãä¸å·²å¯ç¨è°è¯æ¯æçè¿è¡ä¸­ Avalonia åºç¨ç¨åº ã</li>
<li>å¨å¤ä¸ªè¿è¡å®ä¾ä¹é´è¿è¡ä¸ä¸æåæ¢ï¼ç¡®ä¿ AI è½å¤éå¯¹æ­£ç¡®ççªå£è¿è¡æä½ ã</li>
<li>è¿ç§è¿æ¥è½åæ¯å»ºç«å¨ Avalonia æ¢æç Avalonia.Diagnostics åºç¡ä¹ä¸çï¼å©ç¨äºå·²æç AttachDevTools() åºç¡è®¾æ½ ã</li>
</ul>
<h3 id="æ ç¶ç»ææ£ç´¢ä¸æ·±åº¦éå"><strong>æ ç¶ç»ææ£ç´¢ä¸æ·±åº¦éå</strong></h3>
<p>Avalonia ç UI æ¶æç±å¤æçè§è§æ ï¼Visual Treeï¼åé»è¾æ ï¼Logical Treeï¼ææãäººç±»å¼åèå¨ä½¿ç¨ä¼ ç» DevTools æ¶éè¦æå¨éå±å±å¼è¿äºæ æ¥å¯»æ¾ç®æ åç´ ï¼è MCP æå¡å¨èµäºäº AI ç§çº§æ£ç´¢çè½åãAI å¯ä»¥éè¿ä»¥ä¸æ¹å¼è¿è¡æ·±å¥åæï¼</p>
<ul>
<li><strong>å¨æ éåï¼</strong> æ£ç´¢è§è§æ ãé»è¾æ æåå¹¶åçæ ï¼çè§£ç¶å­å³ç³»åå¸å±çº¦æã</li>
<li><strong>å®åæç´¢ï¼</strong> å©ç¨ x:Name æåç´ ç±»åï¼å¦ Button, TextBlockï¼å¿«éå®ä½ç¹å® UI èç¹ã</li>
<li><strong>åæº¯åæï¼</strong> ä»ä»»ä½éå®çèç¹å¼å§ï¼åä¸éåç´å°æ ¹èç¹ï¼ä»èè¯å«æ ·å¼çç»§æ¿è·¯å¾æå¤æçå¸å±æº¢åºé®é¢ ã</li>
</ul>
<h3 id="å±æ§ææ§ä¸å¨ææ ·å¼è°è¯"><strong>å±æ§ææ§ä¸å¨ææ ·å¼è°è¯</strong></h3>
<p>ä¼ ç»ç AI è¾å©å¼åä»éäºâçæä»£ç å¹¶ç±äººç±»è¿è¡æ¥çç»æâï¼è avalonia_devtools å®ç°äºâAI è¿è¡ãAI è§å¯ãAI ä¿®å¤âçé­ç¯ãéè¿å±æ§åæ ·å¼ææ§å·¥å·ï¼AI ä»£çå¯ä»¥ï¼</p>
<ul>
<li><strong>å®æ¶è¯»åå±æ§ï¼</strong> è·åä»»ä½ UI åç´ çå®æ¶å±æ§å¼ï¼åæ¬ä¾èµé¡¹å±æ§ãç»å®ç»æä»¥åå½åè®¡ç®åºçå¸å±å¤§å°ã</li>
<li><strong>è¿è¡æ¶å¨æè®¾ç½®ï¼</strong> å¨ä¸éæ°ç¼è¯ä»£ç çæåµä¸ï¼éè¿ XAML è¯­æ³ç´æ¥ä¿®æ¹å±æ§ï¼å¦ Margin, Padding, Backgroundï¼ï¼å¹¶å³æ¶è§å¯è§è§ååã</li>
<li><strong>æ ·å¼è¿½è¸ªï¼</strong> æ¥çå½åçæçæ ·å¼ï¼Stylesï¼åå¶è®¾ç½®å¨ï¼Settersï¼ï¼ç¡®å®æ¯å¦å­å¨æ ·å¼å²çªæä¼åçº§è¦çé®é¢ã</li>
<li><strong>ä¼ªç±»è§¦åï¼</strong> æ¨¡æåæ¥è¯¢ä¼ªç±»ç¶æï¼å¦ :pointerover, :pressed, :focusï¼ï¼è¿å¯¹äºè°è¯äº¤äºå¼åé¦åè§è§è½¬æ¢è³å³éè¦ã</li>
</ul>
<h3 id="è§è§éªè¯æªå¾ä¸èµæºè®¿é®"><strong>è§è§éªè¯ï¼æªå¾ä¸èµæºè®¿é®</strong></h3>
<p>ä¸ºäºå®ç°çæ­£çâåç´ çº§å®ç¾âå¤å¶ï¼AI éè¦å·å¤è§è§æç¥è½åãavalonia_devtools æ¯ææè·ä»»ä½ UI åç´ ç PNG æªå¾ãè¿ä¸åè½ä¸ç°ä»£ LLM çå¤æ¨¡æè½åç¸ç»åï¼ä½¿ AI è½å¤å°å®æ¶çæç UI æªå¾ä¸åå§è®¾è®¡ç¨¿è¿è¡éåç´ å¯¹æ¯ï¼èªå¨åç°å¯¹é½ãé¢è²æé´è·ä¸çç»å¾®å·®å«ãæ­¤å¤ï¼æå¡å¨è¿åè®¸ AI ååºåµå¥å¼èµæºãè®¿é®ç¹å®èç¹çèµæºå­å¸ï¼å¹¶ç´æ¥éè¿ avares:// URL ä¸è½½èµæº ã</p>
<table>
<thead>
<tr>
<th style="text-align: left">ç±»å«</th>
<th style="text-align: left">å·¥å·åç§° (è½å)</th>
<th style="text-align: left">å¸ååºç¨åºæ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">è¿æ¥åç°</td>
<td style="text-align: left">Connect / List Instances</td>
<td style="text-align: left">å¨å¤ä¸ªè¿è¡ä¸­çåºç¨è¿ç¨é´åæ¢ AI ä¸ä¸æ</td>
</tr>
<tr>
<td style="text-align: left">æ æ£æ¥</td>
<td style="text-align: left">Traverse / Search Tree</td>
<td style="text-align: left">å®ä½æ·±å±åµå¥çæ§ä»¶æåæå¸å±æº¢åº</td>
</tr>
<tr>
<td style="text-align: left">å±æ§æä½</td>
<td style="text-align: left">Read / Set Property</td>
<td style="text-align: left">å¨æè°æ´é´è·ãé¢è²æä¿®å¤æ°æ®ç»å®å¤±æ</td>
</tr>
<tr>
<td style="text-align: left">æ ·å¼åæ</td>
<td style="text-align: left">Inspect Styles / Toggle Pseudo-classes</td>
<td style="text-align: left">è°è¯æ¬åç¶æä¸çè§è§æææåææ ·å¼ä¼åçº§</td>
</tr>
<tr>
<td style="text-align: left">è§è§åé¦</td>
<td style="text-align: left">Capture Screenshot</td>
<td style="text-align: left">èªå¨å¯¹æ¯è®¾è®¡ç¨¿ä¸å®æ¶ UIï¼å®ç°åç´ çº§åå½æµè¯</td>
</tr>
</tbody>
</table>
<h2 id="ä¸ä»è®¾è®¡ç¨¿å°å®ç°çåç´ çº§ai-å·¥ä½æµ"><strong>ä¸ï¼ä»è®¾è®¡ç¨¿å°å®ç°çâåç´ çº§âAI å·¥ä½æµ</strong></h2>
<p>Avalonia å¼å¥ MCP Server çæ ¸å¿å¨åå¨äºæ¹åå¤§è§æ¨¡åºç¨ portingï¼ç§»æ¤ï¼å·¥ä½çç»æµæ¨¡åãä¼ ç»ç UI è¿ç§»å·¥ä½ââä¾å¦ä» WPF è¿ç§»å° Avaloniaââè½ç¶ææ¯é¾åº¦å¹¶éæé«ï¼ä½æ¶åæåä¸ä¸ä¸ªè§å¾çå¾®è°ï¼è¿ç§æé«çéå¤å³å¨ææå¯¼è´èµæ·±å·¥ç¨å¸çèä¸å¦æ ã</p>
<h3 id="æ¡ä¾åædevolutions-çå¤§è§æ¨¡è¿ç§»å®è·µ"><strong>æ¡ä¾åæï¼Devolutions çå¤§è§æ¨¡è¿ç§»å®è·µ</strong></h3>
<p>å¨èç¹å©å°çå®éæ¼ç¤ºä¸­ï¼Devolutions å¬å¸å±ç¤ºäºå¶ Remote Desktop Manager è¿ç§»é¡¹ç®çè¿å± 2ãè¯¥åºç¨æ¥æçº¦ 5,000 ä¸ªè§å¾ï¼å¦æä¾èµäººå·¥æå¨è°æ´é´è·ãå¯¹é½åæ ·å¼ï¼å°æ¯ä¸ä¸ªä»¥å¹´ä¸ºåä½çå·¥ç¨ 2ã</p>
<p>éè¿æ¥å¥ MCP ç AI å·¥ä½æµï¼è¿ä¸è¿ç¨è¢«æå¤§å°åç¼©ï¼</p>
<ol>
<li><strong>è¾å¥ï¼</strong> å¼åèå AI ä»£çï¼å¦ä½¿ç¨ MCP ç Claudeï¼æä¾ç°ææ§åºç¨çæªå¾ã</li>
<li><strong>çæï¼</strong> AI ä»£çæ ¹æ®å¶å¯¹ Avalonia XAML ççè§£çæåå§ä»£ç ã</li>
<li><strong>å®æ¶è¿æ¥ï¼</strong> AI éè¿ avalonia_devtools æå¡å¨è¿æ¥å°æ­£å¨è¿è¡çé¢è§çªå£ã</li>
<li><strong>èªä¸»æ£æ¥ï¼</strong> AI æç´¢å¶åååå»ºçåç´ ï¼è¯»åå®æ¶å±æ§ã</li>
<li><strong>è§è§æ¯å¯¹ï¼</strong> AI å¯¹è¯¥ç¹å®åç´ è¿è¡æªå¾ï¼å¹¶å°å¶ä¸åå§æªå¾è¿è¡å¤æ¨¡ææ¯å¯¹ã</li>
<li><strong>è¿­ä»£ä¿®å¤ï¼</strong> AI èªå¨è¯å«åºâä¾§è¾¹è·å¤åºäº 2 åç´ âï¼éåååº set-property å½ä»¤è¿è¡å®æ¶ä¿®æ­£ï¼å¹¶æ´æ°æ¬å°æºç  ã</li>
</ol>
<p>è¿ç§å·¥ä½æµçä»·å¼ä¸å¨äºç®åçéåº¦æåï¼èå¨äºâè¿­ä»£é­ç¯çè´¨éâ 2ãAI ä¸åæ¯ç²ç®å°çæµä»£ç æ¯å¦æ­£ç¡®ï¼èæ¯å¨å®æ¶è§å¯ãæµéåæ¯è¾ 2ãæ­£å¦ Avalonia å¢éææåºçï¼ä»¥å¾éè¦å·¥ç¨å¸è±è´¹ 30 å° 60 åéè¿è¡çç¹çè°æ´ï¼ç°å¨åªéå åéå³å¯å®æ 2ã</p>
<h2 id="åavalonia-ui-parcel-ä¸èªå¨åäº¤ä»çç»å"><strong>åï¼Avalonia UI Parcel ä¸èªå¨åäº¤ä»çç»å</strong></h2>
<p>é¤äºéå¯¹ UI ç»èç avalonia_devtoolsï¼Avalonia è¿å¨å¶ Accelerate å¥ä»¶ä¸­æä¾äºéå¯¹æåååå¸ç MCP Serverï¼Avalonia Parcel ãParcel æ¯ä¸ä¸ºç®åè·¨å¹³å°åºç¨æåèè®¾è®¡çå·¥å·ï¼éè¿ MCP æ¥å£ï¼å®å°å¤æçæåé»è¾è½¬åä¸ºäºèªç¶è¯­è¨æä»¤ã</p>
<h3 id="æåçå½å¨æç-ai-ææ¥ä¸­å¿"><strong>æåçå½å¨æç AI ææ¥ä¸­å¿</strong></h3>
<p>Parcel MCP Server ä½¿ AI å©çï¼å¦ GitHub Copilot æ Cursorï¼å·å¤äºç®¡çæå»ºç®æ ãè¯ä¹¦ç­¾ååååéç½®çè½å ã</p>
<ul>
<li><strong>é¡¹ç®éç½®èªå¨åï¼</strong> AI å¯ä»¥éè¿ create-project å·¥å·ä»ç°æç.NET é¡¹ç®ä¸­æåä¸ä¸æï¼èªå¨åå»º .parcel éç½®æä»¶ï¼å¹¶éç½®ååãå¾æ åæ¾ç¤ºåç§° ã</li>
<li><strong>è·¨å¹³å°ç­¾åæ¯æï¼</strong> å¼åèå¯ä»¥ç®åå°å¯¹ AI è¯´ï¼âä¸ºæç macOS åºç¨éç½®ç­¾åå¹¶çæ DMG å®è£åâãAI ä¼è°ç¨ setup-apple-sign å¡«å P12 è¯ä¹¦ä¿¡æ¯ï¼è°ç¨ setup-apple-notary éç½®å¬è¯å­æ®ï¼å¹¶æç»æ§è¡ pack å½ä»¤ ã</li>
<li><strong>æå»ºç®æ ç®¡çï¼</strong> éå¯¹ Windows (NSIS/ZIP)ãmacOS (DMG/PKG) å Linux (DEB/AppImage) çä¸åè¦æ±ï¼AI è½å¤èªå¨å¤çè¿è¡æ¶æ è¯ç¬¦ï¼RIDï¼å¹¶çæç¬¦ååå¹³å°æ åçäº§ç© ã</li>
</ul>
<h3 id="è®¸å¯ä¸åå¥é¨æ§"><strong>è®¸å¯ä¸åå¥é¨æ§</strong></h3>
<p>å¼å¾æ³¨æçæ¯ï¼Parcel MCP åå¶ç¸å³çèªå¨ååè½å±äº Avalonia Accelerate åä¸å¥ä»¶çä¸é¨å ãç¨æ·éè¦å·å¤ææçåä¸è®¸å¯è¯ï¼Business æ Enterprise è®¸å¯ï¼ææ­£å¨è¿è¡ 30 å¤©åè´¹è¯ç¨ï¼å¹¶éè¿ç¯å¢åé PARCEL_LICENSE_KEY æ¿æ´»æå¡ ã</p>
<h2 id="äºéææåä¸éç½®æ·±åº¦è§£æ"><strong>äºï¼éææåä¸éç½®æ·±åº¦è§£æ</strong></h2>
<p>è¦ä½¿ AI çæ­£âçè§£âAvaloniaï¼å¼åèå¿é¡»å¨å¼åç¯å¢ä¸­æ­£ç¡®å®è£åéç½®è¿äº MCP æå¡å¨ã</p>
<h3 id="è·¨å®¢æ·ç«¯çéç½®ç­ç¥"><strong>è·¨å®¢æ·ç«¯çéç½®ç­ç¥</strong></h3>
<p>æ è®ºæ¯ä½¿ç¨æ¬å°é¨ç½²ç Claude Desktopï¼è¿æ¯æ·±åº¦éæå¨ IDE ä¸­ç AI æä»¶ï¼å¶éç½®é»è¾éå¸¸éµå¾ªä¸ä¸ªæ ååç JSON å®ä¹æä»¶7ã</p>
<h4 id="1-å¨-vs-code-ä¸­éç½®-github-copilot-agent-mode"><strong>1. å¨ VS Code ä¸­éç½® (GitHub Copilot Agent Mode)</strong></h4>
<p>VS Code ç°å¨æ¯æéè¿ .vscode/mcp.json åç°é¡¹ç®ç¹å®çæå¡å¨ 10ãå¯¹äº Parcelï¼éç½®ç¤ºä¾å¦ä¸</p>
<p>{<br>
"servers": {<br>
"parcel": {<br>
"type": "stdio",<br>
"command": "parcel",<br>
"args": ["mcp"]<br>
}<br>
}<br>
}</p>
<p>å¨å¯ç¨âAgent Modeâåï¼Copilot ä¼èªå¨æ£æµå°è¿äºå·¥å·ï¼å¹¶å¨å¤çæåææå»ºè¯·æ±æ¶ä½¿ç¨å®ä»¬ ã</p>
<h4 id="2-å¨-claude-desktop-ä¸­éç½®"><strong>2. å¨ Claude Desktop ä¸­éç½®</strong></h4>
<p>Claude Desktop æ¯ç®å MCP çä¸»è¦å®¿ä¸»ç¯å¢ä¹ä¸ ãå¼åèéè¦ç¼è¾ claude_desktop_config.json ã</p>
<ul>
<li><strong>macOS è·¯å¾ï¼</strong> ~/Library/Application Support/Claude/claude_desktop_config.json</li>
<li><strong>Windows è·¯å¾ï¼</strong> %APPDATA%\Claude\claude_desktop_config.json</li>
</ul>
<p>ä¸ä¸ªéæäºå¤ä¸ª Avalonia ç¸å³è½åçå¸åéç½®å¦ä¸ï¼</p>
<p>{<br>
"mcpServers": {<br>
"parcel": {<br>
"command": "parcel",<br>
"args": ["mcp"],<br>
"env": {<br>
"PARCEL_LICENSE_KEY": "YOUR_KEY_HERE"<br>
}<br>
},<br>
"avalonia_devtools": {<br>
"command": "dotnet",<br>
"args": ["run", "--project", "path/to/avalonia_devtools_server"]<br>
}<br>
}<br>
}<br>
ç¹å«éè¦æ³¨æçæ¯ï¼å¨ Claude Desktop ä¸­ï¼ç¯å¢åéå¿é¡»å¨ env å¯¹è±¡ä¸­æ¾å¼å£°æï¼å ä¸ºå®éå¸¸ä¸ä¼ç»§æ¿ç³»ç»çå¨å±ç¯å¢åé ã</p>
<h3 id="è¿è¡æ¶æ¿æ´»ä¸éªè¯"><strong>è¿è¡æ¶æ¿æ´»ä¸éªè¯</strong></h3>
<p>ä¸æ¦éç½®æä»¶ä¿å­ï¼å¿é¡»å®å¨éåºå¹¶éæ°å¯å¨ Claude Desktop æ IDE ä»¥éæ°å è½½æå¡å¨è¿ç¨ 12ãç¨æ·å¯ä»¥å¨èå¤©çé¢çâå·¥å·âæâè¿æ¥å¨âå¾æ ä¸éªè¯æå¡å¨æ¯å¦å¨çº¿ 12ãå¯¹äº avalonia_devtoolsï¼éå¸¸è¿éè¦å¨åè°è¯çåºç¨ä¸­è°ç¨ AttachDevTools() å¹¶ç¡®ä¿å¶å¨ DEBUG æ¨¡å¼ä¸ç¼è¯ 9ã</p>
<h2 id="å­ä¼ä¸çº§-avaloniauimcp-ä¸çæç³»ç»çæ·±åº¦æ©å±"><strong>å­ï¼ä¼ä¸çº§ AvaloniaUI.MCP ä¸çæç³»ç»çæ·±åº¦æ©å±</strong></h2>
<p>é¤äºå®æ¹æä¾ç DevTools æå¡å¨ï¼ç¤¾åºåç¬¬ä¸æ¹åºï¼å¦ AvaloniaUI.MCPï¼ä¹ä¸º AI æä¾äºæ´å¹¿æ³çç¥è¯æ·±åº¦ ãè¿äºæå¡å¨ä¸ä»ä»æ¯å·¥å·ï¼æ´æ¯å®æ´çç¥è¯åºéæ ã</p>
<h3 id="æ·±åº¦ç¥è¯åºä¸çæå·¥å·"><strong>æ·±åº¦ç¥è¯åºä¸çæå·¥å·</strong></h3>
<p>ä¸ä¸ªæçç Avalonia MCP æå¡å¨ï¼å¦ç± decriptor ç»´æ¤ççæ¬ï¼éå¸¸åå«ä»¥ä¸è¿é¶åè½ï¼</p>
<ul>
<li><strong>500+ æ§ä»¶åèï¼</strong> ä¸º LLM æä¾çæ¬åçãåç¡®çæ§ä»¶ API ææ¡£ï¼é²æ­¢å¶çæå·²ç»åºå¼çä»£ç  ã</li>
<li><strong>æ¶ææ¨¡æ¿çæï¼</strong> è½å¤ç´æ¥çæéµå¾ªä¼ä¸çº§ MVVM æ¨¡å¼ãReactiveUI æ CommunityToolkit.Mvvm çä»£ç ç»æ ã</li>
<li><strong>é«æ§è½ä¿éï¼</strong> ä¸ºäºé²æ­¢ AI ç­å¾è¶æ¶ï¼ä¼ç§ç MCP å®ç°éç¨äºå¼æ­¥æä½åç¼å­ç³»ç»ï¼å°ååºæ¶é´æ§å¶å¨ 100ms ä»¥å ã</li>
<li><strong>å®å¨æ§å¢å¼ºï¼</strong> å¨å¤çæä»¶æä½æ API å¯é¥æ¶ï¼æä¾åæ°æ ¡éªåæ²ç®±åå¤çï¼é²æ­¢ AI å ä¸ºæ¶æç Prompt æ³¨å¥èæ§è¡ä¸å®å¨çæä½ ã</li>
</ul>
<h3 id="æ§è½ä¸åè§æ§ææ "><strong>æ§è½ä¸åè§æ§ææ </strong></h3>
<p>å¯¹äºå¤§åä¼ä¸ï¼MCP æå¡å¨çè¿è¡æçååè§æ§æ¯å³é®èéææ ï¼</p>
<table>
<thead>
<tr>
<th style="text-align: left">ææ é¡¹ç®</th>
<th style="text-align: left">è§æ ¼è¦æ±</th>
<th style="text-align: left">ææ¯å®ç°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">å¹¶åæ¯æ</td>
<td style="text-align: left">50+ æ¨¡æç¨æ·</td>
<td style="text-align: left">åºäº.NET 9.0 çæ ç¶æè¯·æ±å¤ç</td>
</tr>
<tr>
<td style="text-align: left">ç¼å­å½ä¸­ç</td>
<td style="text-align: left">&gt; 80%</td>
<td style="text-align: left">å¯¹å¸¸ç¨ XAML æ¨¡å¼åææ¡£çæ®µçåå­ç¼å­</td>
</tr>
<tr>
<td style="text-align: left">å®å¨åè§</td>
<td style="text-align: left">å®¡è®¡æ¥å¿è®°å½</td>
<td style="text-align: left">å¯¹ææ Tool Call è¿è¡å¨æµéè·è¸ªä¸æ¥å¿å</td>
</tr>
<tr>
<td style="text-align: left">éè¯¯å¤ç</td>
<td style="text-align: left">æ ææä¿¡æ¯æ³é²</td>
<td style="text-align: left">èªå®ä¹å¼å¸¸æ¦æªå¨ï¼è¿æ»¤å æ è¿½è¸ªä¸­çè·¯å¾ä¿¡æ¯</td>
</tr>
</tbody>
</table>
<h2 id="ä¸ç¬¬äºä¸ç¬¬ä¸é¶æ´å¯ai-åä½æ¨¡å¼çæ ¹æ¬è½¬å"><strong>ä¸ï¼ç¬¬äºä¸ç¬¬ä¸é¶æ´å¯ï¼AI åä½æ¨¡å¼çæ ¹æ¬è½¬å</strong></h2>
<p>å½ AI éè¿ MCP åè®®âçæâäº Avalonia è¿è¡æ¶çç¶æï¼è¿ä¸ä»ä»æ¯å·¥å·çæ¹è¿ï¼èæ¯çäº§å³ç³»çéæ ã</p>
<h3 id="ä»ä»£ç ç¼åå°æå¾åè°"><strong>ä»âä»£ç ç¼åâå°âæå¾åè°â</strong></h3>
<p>å¨ä¼ ç»ç AI è¾å©ç¼ç¨ä¸­ï¼ç¨åºåæ¿æäºå¤§é¨åçä¸ä¸æè¡¥å¨å·¥ä½ââå¤å¶éè¯¯æ¥å¿ãæå¨åæ­¥ UI å±æ§å¼ãæå¨æè¿°è§è§å·®å¼ 1ãè MCP å°è¿äºä»»å¡èªå¨åï¼ä½¿ç¨åºåçèè´£ä»âæ§è¡èâè½¬åä¸ºâæå¾åè°èâ ã</p>
<p>è¿æå³çï¼</p>
<ol>
<li><strong>å·¥ç¨ææ¬çç»ææ§ä¸éï¼</strong> ä»¥åéè¦ä¸­çº§å¼åèè±è´¹æ°å¨è¿è¡ç UI æ¶¦è²ï¼ç°å¨å¯ä»¥ç±é«çº§æ¶æå¸ææ¥ AI ä»£çå¨å å¤©åå®æ ã</li>
<li><strong>è´¨éçä¸è´æ§ï¼</strong> AI å¨æ§è¡ XAML éªè¯åæ ·å¼å¯¹é½æ¶ä¸ä¼æå°ç²å³ï¼ä»èæ¶é¤äºå ä¸ºäººä¸ºçå¿½å¯¼è´çâåç´ åç§»âæä¸ä¸è´çå½åè§èã</li>
<li><strong>å®æ¶åé¦åè·¯ï¼</strong> AI çâè§å¯-çº æ­£âå¾ªç¯æ¯æ¯«ç§çº§çãå½ AI ä¿®æ¹äºä¸ä¸ªå±æ§å¹¶åç°æªå¾ä»æªå¯¹é½æ¶ï¼å®ä¼ç«å³è¿è¡ç¬¬äºæ¬¡å°è¯ï¼è¿ç§æéåé¦æ¯äººç±»æå¨è°æ´æ æ³ä¼åçã</li>
</ol>
<h3 id="è·¨é¢åçå æå½±å"><strong>è·¨é¢åçå æå½±å</strong></h3>
<p>Avalonia å¨ MCP ä¸çé¢åå°ä½å¾å¯è½å¼å UI æ¡æ¶é¢åçâä¸ä¸æåå¤ç«èµâãå¦æä¸ä¸ªæ¡æ¶è½å¤è®© AI æ´å¥½å°çè§£å¶è¿è¡æ¶ç¶æï¼é£ä¹è¯¥æ¡æ¶çå¼åæçå°è·å¾ææ°çº§çæåï¼ä»èå¸å¼æ´å¤çå¼åèãè¿ä¹æç¤ºäºæªæ¥è½¯ä»¶æ¶æçä¸ä¸ªè¶å¿ï¼è½¯ä»¶å°ä¸åä»ä»ä¸ºäººç±»ç¨æ·è®¾è®¡ï¼ä¹å°ä¸º AI ä»£ççå¯è§æµæ§åå¯æä½æ§è¿è¡ä¼åï¼AI-Ready Architectureï¼ã</p>
<h2 id="å«å®å¨ææå±éæ§ä¸é²å¾¡ç­ç¥"><strong>å«ï¼å®å¨ææãå±éæ§ä¸é²å¾¡ç­ç¥</strong></h2>
<p>å°½ç®¡åæ¯åæï¼ä½ MCP çå¼å¥ä¹ä¼´éçæ¾èçé£é© ã</p>
<h3 id="ä¸ä¸æè¨èä¸ä»¤çæ¶è-context-bloat"><strong>ä¸ä¸æè¨èä¸ä»¤çæ¶è (Context Bloat)</strong></h3>
<p>MCP çä¸ä¸ªä¸»è¦ææ¯æææ¯å¶å¯¹ä¸ä¸æçªå£çæ¶èãæ¯ä¸ªå¯ç¨ç MCP æå¡å¨é½ä¼å°å¶ææå·¥å·çæè¿°ï¼Definitionï¼æ³¨å¥å° LLM çç³»ç»æç¤ºè¯ä¸­ã</p>
<ul>
<li><strong>é®é¢ï¼</strong> å¦æä¸ä¸ªæå¡å¨æ´é²äº 100 ä¸ªå¤æçå·¥å·ï¼ä»å·¥å·æè¿°å°±å¯è½å ç¨ 80k å° 100k çä»¤çï¼Tokensï¼ãè¿ä¸ä»å¢å äºæ¯æ¬¡è¯·æ±çææ¬ï¼è¿å¯è½å¯¼è´æ¨¡åå ä¸ºä¸ä¸æè¿é¿èåå¾âè¿éâæå¿½ç¥æ ¸å¿æä»¤ã</li>
<li><strong>è§£å³æ¹æ¡ï¼</strong> ç¤¾åºæ­£å¨å¼åâå­ä»£çï¼Sub-agentsï¼âæ¶ææâå»¶è¿å è½½ï¼Lazy Loadingï¼âæºå¶ï¼ä»å¨éè¦æ¶åæ¨¡åæ´é²ç¸å³çå·¥å·å­éã</li>
</ul>
<h3 id="å®å¨æ¼æ´ä¸æ»å»åé"><strong>å®å¨æ¼æ´ä¸æ»å»åé</strong></h3>
<p>å®å¨ç ç©¶äººåå·²ç»æåºï¼MCP åè®®æ¬èº«ç¼ºä¹åç½®çå®å¨å¢å¼ºæºå¶ï¼å¶å®å¨æ§é«åº¦ä¾èµäºå·ä½çæå¡å¨å®ç° ã</p>
<ul>
<li><strong>Prompt æ³¨å¥ï¼</strong> æ¶ææ°æ®æå·¥å·æè¿°å¯è½è¯±å¯¼ LLM æ§è¡è¶ææä½ï¼ä¾å¦å°ç§æ UI ä»£ç åéå°å¤é¨ API ã</li>
<li><strong>å·¥å·å°æ¯¯å¼æå (Rug Pulls)ï¼</strong> æå¡å¨å¯ä»¥å¨ç¨æ·ææåå¨ææ´æ¹å·¥å·çè¡ä¸ºæè¿°ï¼ä»èå¨åå°æ§è¡éæ³å¨ä½ã</li>
<li><strong>å»ºè®®ï¼</strong> ä¼ä¸åºåæâæå°æéååâï¼ä»ä¸º AI ä»£çæä¾å¶ä»»å¡æéçç¹å®å·¥å·éï¼å¹¶å¯¹æææ¶åæä»¶ç³»ç»æç½ç»è®¿é®çæä½è®¾ç½®äººå·¥ç¡®è®¤ç¯èï¼Human-in-the-Loopï¼ã</li>
</ul>
<h2 id="ä¹é¢åæªæ¥çå±æai-åç-ui-å·¥ç¨çç»æå½¢æ"><strong>ä¹ï¼é¢åæªæ¥çå±æï¼AI åç UI å·¥ç¨çç»æå½¢æ</strong></h2>
<p>Avalonia å¯¹ MCP çéçº³åªæ¯ä¸ä¸ªå¼å§ãéçåè®®çè¿ä¸æ­¥æçï¼æä»¬å¯ä»¥é¢è§ä»¥ä¸å ä¸ªåå±é¶æ®µï¼</p>
<h3 id="é¶æ®µä¸èªä¸»-qa-ä¸åå½æµè¯"><strong>é¶æ®µä¸ï¼èªä¸» QA ä¸åå½æµè¯</strong></h3>
<p>æªæ¥ç avalonia_devtools å°ä¸ä»ä»ç¨äºå¼åï¼æ´å°æä¸ºèªä¸» QA çåºç³ãAI ä»£çå¯ä»¥æ ¹æ®èªç¶è¯­è¨ç¼åçæµè¯è®¡åï¼èªä¸»å¨åºç¨ä¸­ç¹å»ãæ£æ¥æ ·å¼ãæè·æªå¾å¹¶åææ§å¶å°è¾åºï¼å¨åç° Bug åçè³è½ç´æ¥æåºä¿®å¤ PR ãè¿ç§ä»æµè¯å°ä¿®å¤çå¨èªå¨åé­ç¯å°æå¤§å°æé«è½¯ä»¶çåå¸è´¨éã</p>
<h3 id="é¶æ®µäºå¨æ-ui-çæä¸èªéåº"><strong>é¶æ®µäºï¼å¨æ UI çæä¸èªéåº</strong></h3>
<p>ç»å Avalonia ççµæ´»å¸å±è½åå MCP çå®æ¶åé¦ï¼åºç¨çè³å¯ä»¥å®ç°âè¿è¡æ¶çèªéåºçæâãAI ä»£çå¯ä»¥æ ¹æ®ç¨æ·çå®æ¶æä½ä¹ æ¯åè§è§åé¦ï¼å¨æè°æ´ UI å¸å±åèµæºåéï¼ä»èå®ç°çæ­£çä¸ªæ§åç¨æ·ä½éªã</p>
<h3 id="é¶æ®µä¸è·¨æ¡æ¶çåä½æºè½"><strong>é¶æ®µä¸ï¼è·¨æ¡æ¶çåä½æºè½</strong></h3>
<p>éçæ´å¤æ¡æ¶ï¼å¦ Chrome DevTools MCP, Playwright MCPï¼çå å¥ï¼AI å°è½å¤æ§è¡å¤æçè·¨ç«¯ä»»å¡ãä¾å¦ï¼ä¸ä¸ª AI ä»£çå¯ä»¥åæ¶æ§å¶ä¸ä¸ªè¿è¡å¨ Web ä¸çç®¡çåå°åä¸ä¸ªè¿è¡å¨æ¡é¢ä¸ç Avalonia å®¢æ·ç«¯ï¼ç¡®ä¿ä¸¤ç«¯çä¸å¡é»è¾åè§è§é£æ ¼å¨å®æ¶åæ­¥ä¸­ä¿æä¸è´ã</p>
<h2 id="ç»è®º"><strong>ç»è®º</strong></h2>
<p>âä»¥å AI ä¸ä¼ä¸æ Avalonia äºâè¿ä¸æ­è¨çèåï¼æ¯æ´ä¸ªè½¯ä»¶å·¥ç¨èå¼çæ·±å»åé©ãéè¿ Model Context Protocolï¼Avalonia æåå°å° AI ä»ä»£ç çæçæè§èè½¬åä¸ºäºè¿è¡æ¶è°è¯çåä¼äºº ãavalonia_devtools å avalonia_parcel æå¡å¨éè¿æ ååçæ¥å£ï¼è§£å³äºé¿ä¹ä»¥æ¥å°æ°å¼åèçè·¨å¹³å° UI è°è¯ä¸ååé¾é¢ï¼ä¸ºå¤§è§æ¨¡åºç¨ç°ä»£åæ«æ¸äºéç¢ã</p>
<p>å°½ç®¡å¨å®å¨æ§ãææ¬æ§å¶åç¶æç®¡çæ¹é¢ä»æææï¼ä½è¿ç§éè¿ç¨åºåæ¡¥æ¢å®ç°âæ·±åº¦ä¸ä¸ææç¥âçè·¯å¾å·²ç»è¯æäºå¶æ ä¸ä¼¦æ¯ççäº§åä»·å¼ ãå¯¹äºä¸ä¸ç.NET å¼åèèè¨ï¼ç§¯ææ¥æ± MCP ä¸ä»ä»æ¯ä¸ºäºæé«ç¼å XAML çéåº¦ï¼æ´æ¯ä¸ºäºå¨ Agentic AI æ¶ä»£éå¡èªå·±çå·¥ç¨è§è²ï¼å°ç²¾åä»ç¹ççâåç´ å¾®è°âä¸­è§£æ¾åºæ¥ï¼æå¥å°æ´å·åé æ§çæ¶æè®¾è®¡ä¹ä¸­ãAvalonia çè¿ä¸æ­¥è·¨è¶ï¼ä¸ºè·¨å¹³å°æ¡é¢å¼åçæªæ¥è®¾å®äºå¨æ°çæ å ã</p>
<h4 id="å¼ç¨çèä½"><strong>å¼ç¨çèä½</strong></h4>
<ol>
<li>MCP Deep Dive (Part 1): Building the Hands and Eyes of an AI Agent in C# | by Alon Fliess <a href="https://medium.com/@alonfliess/mcp-deep-dive-part-1-building-the-hands-and-eyes-of-an-ai-agent-in-c-b26e71ebe102" target="_blank" rel="noopener nofollow">https://medium.com/@alonfliess/mcp-deep-dive-part-1-building-the-hands-and-eyes-of-an-ai-agent-in-c-b26e71ebe102</a></li>
<li>Avalonia DevTools MCP Server - Avalonia UI <a href="https://avaloniaui.net/blog/avalonia-devtools-mcp-server" target="_blank" rel="noopener nofollow">https://avaloniaui.net/blog/avalonia-devtools-mcp-server</a></li>
<li>Legacy Developer Tools  <a href="https://docs.avaloniaui.net/docs/guides/implementation-guides/developer-tools" target="_blank" rel="noopener nofollow">https://docs.avaloniaui.net/docs/guides/implementation-guides/developer-tools</a></li>
<li>Model Context Protocol | Avalonia Docs, <a href="https://docs.avaloniaui.net/accelerate/tools/parcel/mcp" target="_blank" rel="noopener nofollow">https://docs.avaloniaui.net/accelerate/tools/parcel/mcp</a></li>
<li>Community Edition | Avalonia Docs <a href="https://docs.avaloniaui.net/accelerate/community" target="_blank" rel="noopener nofollow">https://docs.avaloniaui.net/accelerate/community</a></li>
<li>MCP server for AvaloniaUI ï¼ <a href="https://github.com/decriptor/AvaloniaUI.MCP" target="_blank" rel="noopener nofollow">https://github.com/decriptor/AvaloniaUI.MCP</a></li>
<li>Your AI-Powered AvaloniaUI Development Assistant - AvaloniaUI.MCP <a href="https://decriptor.github.io/AvaloniaUI.MCP/" target="_blank" rel="noopener nofollow">https://decriptor.github.io/AvaloniaUI.MCP/</a></li>
<li>AvaloniaUI.MCP | MCP Servers - LobeHub <a href="https://lobehub.com/mcp/decriptor-avaloniaui_mcp" target="_blank" rel="noopener nofollow">https://lobehub.com/mcp/decriptor-avaloniaui_mcp</a></li>
<li>Avalonia UI Expert | Claude Code Skill for C# Apps - MCP Marketï¼ <a href="https://mcpmarket.com/tools/skills/avalonia-ui-development" target="_blank" rel="noopener nofollow">https://mcpmarket.com/tools/skills/avalonia-ui-development</a></li>
</ol>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬¢è¿å¤§å®¶æ«æä¸é¢äºç»´ç æä¸ºæçå®¢æ·ï¼æ¶ä½ ä¸äº</p>
<img src="https://images.cnblogs.com/cnblogs_com/shanyou/57459/o_220125090408_%E9%82%80%E8%AF%B7%E4%BA%8C%E7%BB%B4%E7%A0%81-258px.jpeg" width="170">
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-28 21:59">2026-01-28 21:59</span>&nbsp;
<a href="https://www.cnblogs.com/shanyou">å¼ åå</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19545779);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19545779', targetLink: 'https://www.cnblogs.com/shanyou/p/19545779', title: 'è·¨å¹³å° UI å·¥ç¨ç Agentic è½¬åï¼MCP å¨ Avalonia çæä¸­çæ·±åº¦åºç¨ä¸æ¶ææ¼è¿' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>