<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-11T04:28:23.263Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ ç¥ç§åºåââæ ¼é·ç åºå ]]></title>
    <link>https://www.cnblogs.com/reasa/p/19603721</link>
    <guid>d36798b27656b551a63565871b1a8f68</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/reasa/p/19603721" title="åå¸äº 2026-02-11 12:17">
    <span role="heading" aria-level="2">ç¥ç§åºåââæ ¼é·ç åºå</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="èæ¯">èæ¯</h1>
<p>æ¨æ¥åé¢çæ¶åï¼å¶éä¸éç¥å¥çæé é¢ï¼é¢ç®æ¯è¿æ ·çï¼</p>
<p>æé ä¸ä¸ªé¿åº¦ä¸º<span class="math inline">\(2^n\)</span>çåºå<span class="math inline">\(p_0,p_1,â¦,p_{2^nâ1}\)</span>ï¼ä½¿å¾ç¸é»ä¸¤é¡¹å¼æå¼ä¹åæå°ã</p>
<p>è¿éé¢å¾å®¹æå°±å¯ä»¥çåºï¼å¦æè¦æé ä¸ä¸ªä½¿å¾ç¸é»ä¸¤é¡¹å¼æå¼ä¹åæå°çåºåï¼å°±è¦ä¿è¯æ¯ä¸ªåç´ ä¸ç¸é»åç´ é´å¨äºè¿å¶ä¸ä»æä¸ä½çå·®è·ï¼èè¿æ ·çåºåæ¾ç¶ä¼æç§ææäºè¿å¶ä½æ°ååºæåï¼å æ­¤æå¾å¿«å°±æ³å°äºè¿æ ·ä¸ä¸ªè´ªå¿ç­ç¥ï¼é¦åå°0æ¾è¿æåå°¾é¨ï¼ç¶åæ¯æ¬¡ä»å°å°å¤§å°è¯æ¹åå°¾é¨çäºè¿å¶ä½ï¼å¦æå¾å°çæ¯æ°æ°å°±æ´æ°æåï¼è¿éçä»å°å°å¤§å°è¯æ¹åå°¾é¨çäºè¿å¶ä½æçæ¯ï¼å½æ°å·²ç»å­å¨äºçæçç­æ¡åºåä¸­æ¶ï¼å°è¯æ¹åæ´é«ä¸ä½çäºè¿å¶ä½ãä¸¾ä¸ªä¾å­ï¼</p>
<pre><code class="language-txt">0
0 1
(å°è¯æ¹å0çåæ°1ä½,å¾å°1,æå)
0 1 3
(å°è¯æ¹å1çåæ°1ä½,å¾å°0,ä½0å¨æåä¸­,å¤±è´¥,å°è¯æ¹å1çåæ°ç¬¬2ä½,å¾å°3,æå)
0 1 3 2
(å°è¯æ¹å3çåæ°1ä½ï¼å¾å°2ï¼æå)
0 1 3 2 6
(å°è¯æ¹å2çåæ°1ä½,å¾å°3,å¤±è´¥,å°è¯æ¹å2çåæ°ç¬¬2ä½,å¾å°0,å¤±è´¥,å°è¯æ¹å2çåæ°ç¬¬3ä½,å¾å°6,æå)
0 1 3 2 6 7 5 4 
</code></pre>
<p>è¿å°±æ¯æææ³å°çè´ªå¿æè·¯ï¼å®æ¯æ­£ç¡®çï¼ä»£ç å¦ä¸ï¼</p>
<pre><code class="language-cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int n;
    cin &gt;&gt; n;
    int m = 1 &lt;&lt; n;
    vector&lt;int&gt; ans;
    vector&lt;bool&gt; vis(m, false);
    int cur = 0;
    ans.push_back(cur);
    vis[cur] = true;
    while ((int)ans.size() &lt; m) {
        for (int i = 0; i &lt; n; i++) {
            int nxt = cur ^ (1 &lt;&lt; i);
            if (!vis[nxt]) {
                cur = nxt;
                ans.push_back(cur);
                vis[cur] = true;
                break;
            }
        }
    }
    for (int i = 0; i &lt; m; i++) {
        cout &lt;&lt; ans[i] &lt;&lt; " \n"[i == m - 1];
    }
    return 0;
}
</code></pre>
<h1 id="è½¬æ">è½¬æ</h1>
<p>å½æå®æè¿éé¢åï¼è¿æ²¡æ¥å¾åæ¬£åï¼å°±å¨çé¢è§£æ¶åç°äºè¿éé¢åæ¥å¦æè¯´æ³ï¼è¿éé¢ç®æè¦æ±æé çåºåå¶å®æ¯ä¸ä¸ªéå¸¸ç»å¸çåºåï¼è¯¥åºåæé çè§åæ¯ä¸ä¸ªå«åæ ¼é·ç çäºè¿å¶æ°å­ç³»ç»ï¼æ¯ç±è´å°å®éªå®¤çFrank Grayäº20ä¸çºª40å¹´ä»£æåºãå®å·æè®¸å¤ä¼ç¹ã</p>
<h1 id="æ ¼é·ç ">æ ¼é·ç </h1>
<h2 id="åºæ¬å®ä¹">åºæ¬å®ä¹</h2>
<p>å¨ä¸ç»æ°çç¼ç ä¸­ï¼è¥ä»»æä¸¤ä¸ªç¸é»çä»£ç åªæä¸ä½äºè¿å¶æ°ä¸åï¼åç§°è¿ç§ç¼ç ä¸ºæ ¼é·ç ï¼Gray Codeï¼</p>
<h2 id="æ§è´¨">æ§è´¨</h2>
<h3 id="åä½è·ç¦»æ§">åä½è·ç¦»æ§</h3>
<p>ç¸é»æ ¼é·ç ä¹é´çäºè¿å¶ä»æä¸ä½ä¸å</p>
<h3 id="å¾ªç¯æ§">å¾ªç¯æ§</h3>
<p>ä»»æè¿ç»­<span class="math inline">\(2^k\)</span>ä¸ªæ ¼é·ç å¶é¦å°¾ä»ç¬¦ååä½è·ç¦»æ§ï¼å³é¦ä½é´äºè¿å¶ä»æä¸ä½ä¸å</p>
<h3 id="å­ç«æ¹ä½å°é­æ§">å­ç«æ¹ä½å°é­æ§</h3>
<p>å¨ n ç»´æ ¼é·ç åºåä¸­ï¼ä»»æè¿ç»­ <span class="math inline">\(2^k\)</span> é¡¹ï¼ä» <span class="math inline">\(2^k\)</span> çæ´æ°åä½ç½®å¼å§ï¼æ°å¥½ææä¸ä¸ª k ç»´å­ç«æ¹ä½çæ ¼é·ç ã</p>
<h2 id="æé ">æé </h2>
<h3 id="æå¨æé ">æå¨æé </h3>
<p><span class="math inline">\(k\)</span> ä½çæ ¼é·ç å¯ä»¥éè¿ä»¥ä¸æ¹æ³æé ï¼æä»¬ä»å¨ <span class="math inline">\(0\)</span> æ ¼é·ç å¼å§ï¼æç§ä¸é¢ç­ç¥ï¼</p>
<ol>
<li>ç¿»è½¬æä½ä½å¾å°ä¸ä¸ä¸ªæ ¼é·ç ï¼ï¼ä¾å¦ <span class="math inline">\(000\to 001\)</span>ï¼ï¼</li>
<li>ææå³è¾¹ç <span class="math inline">\(1\)</span> çå·¦è¾¹çä½ç¿»è½¬å¾å°ä¸ä¸ä¸ªæ ¼é·ç ï¼ï¼ä¾å¦ <span class="math inline">\(001\to 011\)</span>ï¼ï¼</li>
</ol>
<p>äº¤æ¿æç§ä¸è¿°ç­ç¥çæ <span class="math inline">\(2^{k-1}\)</span> æ¬¡ï¼å¯å¾å° <span class="math inline">\(k\)</span> ä½çæ ¼é·ç åºåï¼</p>
<h3 id="éåæé ">éåæé </h3>
<p><span class="math inline">\(k\)</span> ä½çæ ¼é·ç å¯ä»¥ä» <span class="math inline">\(k-1\)</span> ä½çæ ¼é·ç ä»¥ä¸ä¸éå°åå ä¸æ°ä½çæ¹å¼å¿«éå¾å°ï¼å¦ä¸å¾ï¼</p>
<p></p><div class="math display">\[\begin{matrix}
k=1\\
0\\ 1\\\\\\\\\\\\\\
\end{matrix}
\to \begin{matrix}\\
\color{Red}0\\\color{Red}1\\\color{Blue}1\\\color{Blue}0\\\\\\\\\\
\end{matrix}
\to \begin{matrix}
k=2\\
{\color{Red}0}0\\{\color{Red}0}1\\{\color{Blue}1}1\\{\color{Blue}1}0\\\\\\\\\\
\end{matrix}
\to \begin{matrix}\\
\color{Red}00\\\color{Red}01\\\color{Red}11\\\color{Red}10\\\color{Blue}10\\\color{Blue}11\\\color{Blue}01\\\color{Blue}00
\end{matrix}
\to \begin{matrix}
k=3\\
{\color{Red}0}00\\{\color{Red}0}01\\{\color{Red}0}11\\{\color{Red}0}10\\{\color{Blue}1}10\\{\color{Blue}1}11\\{\color{Blue}1}01\\{\color{Blue}1}00
\end{matrix}
\]</div><p></p><h3 id="è´ªå¿æé ">è´ªå¿æé </h3>
<p>å°±æ¯åæéç¨çç­ç¥ä¸è´ï¼é¦åå°0æ¾è¿æåå°¾é¨ï¼ç¶åæ¯æ¬¡ä»å°å°å¤§å°è¯æ¹åå°¾é¨çäºè¿å¶ä½ï¼å¦æå¾å°çæ¯æ°æ°å°±æ´æ°æå</p>
<h3 id="å¬å¼æ³">å¬å¼æ³</h3>
<p>åä½¿ç¨ææçæ¹å¼ï¼æé ä¸äºå°çæ ¼é·ç ï¼ç¶åè§å¯ç¬¬ <span class="math inline">\(i\)</span> ä¸ªæ ¼é·ç ä¸ <span class="math inline">\(i\)</span> ä¹é´çå³ç³»ï¼æä»¬å¯ä»¥åç°ï¼ç¬¬ <span class="math inline">\(n\)</span> ä¸ªæ ¼é·ç çäºè¿å¶ç¬¬ <span class="math inline">\(i\)</span> ä½ä¸º <span class="math inline">\(1\)</span>ï¼ä»å½ <span class="math inline">\(n\)</span> çäºè¿å¶ç¬¬ <span class="math inline">\(i\)</span> ä½ä¸º <span class="math inline">\(1\)</span>ï¼ç¬¬ <span class="math inline">\(i+1\)</span> ä½ä¸º <span class="math inline">\(0\)</span> æèç¬¬ <span class="math inline">\(i\)</span> ä½ä¸º <span class="math inline">\(0\)</span>ï¼ç¬¬ <span class="math inline">\(i+1\)</span> ä½ä¸º <span class="math inline">\(1\)</span>ï¼äºæ¯ï¼æä»¬è½æ³å°ä½¿ç¨å¼æè¿ç®æ¥æé è¿ä¸ä¸ªæ ¼é·ç ï¼å¶å¬å¼å¦ä¸ï¼</p>
<p></p><div class="math display">\[Gray_i = i \bigoplus (i&gt;&gt;1)
\]</div><p></p><h2 id="ä¼ç¹">ä¼ç¹</h2>
<p>æäºäººå¯è½ä¼è¯´ï¼èªç¶äºè¿å¶ç¼ç å°±è½ç´æ¥ä½¿ç¨ï¼ä¸ºä»ä¹è¦æå¼¯æ¹è§å°ä½¿ç¨å¦å¤ä¸ç§äºè¿å¶ç¼ç ç³»ç»å¢ï¼è¿æ¯å ä¸ºæ ¼é·ç æ¯ä¸ç§å·æåå°ç¹æ§åå¾ªç¯ç¹æ§çåæ­¥èªè¡¥ç ï¼å¶å¾ªç¯ååæ­¥ç¹æ§æ¶é¤äºéæºåæ°æ¶åºç°éå¤§éè¯¯çå¯è½ï¼å¶åå°åèªè¡¥ç¹æ§ä½¿å¾å¯¹å¶è¿è¡æ±åæä½ä¹éå¸¸æ¹ä¾¿ï¼æä»¥ï¼æ ¼é·ç ç¸è¾äºèªç¶äºè¿å¶ç¼ç æ´å å¯é ï¼åæ¶ï¼å®æ¯ä¸ç§éè¯¯æå°åçç¼ç æ¹å¼ï¼æ ¼é·ç æ¯ä¸æ¬¡åå¨æ¶ï¼ä»æ¹åä¸ä½äºè¿å¶ä½ï¼èèªç¶äºè¿å¶ç¼ç æ¯ä¸æ¬¡åå¨ï¼æå¯è½å ä¸ºè¿ä½ä½¿å¾å¤ä½äºè¿å¶ä½åçæ¹åï¼æ´ä¸å®¹æåºéã</p>
<h2 id="åºç¨">åºç¨</h2>
<p>æ ¼é·ç å¨å¤ä¸ªé¢åæçå·§å¦ä¸å®ç¨çåºç¨ï¼</p>
<ul>
<li>
<p>å¨ä¸ç»´æ²é¢éæµä¸­ï¼å¯éç¨æ ¼é·ç æå°çéæ¥è§¦å¼åå­¦æå½±æ¹æ³ï¼å®ç°å¯¹å¾®åæ²é¢çç²¾åæµé</p>
</li>
<li>
<p>å¨é»è¾å½æ°åç®è¿ç¨ä¸­ï¼åå©ææ ¼é·ç è§åæåçå¡è¯ºå¾ï¼ä¾¿è½é«æå®æåç®æä½</p>
</li>
<li>
<p>å¨æ±½è½¦å¶å¨ç³»ç»çè§åº¦ä¼ æå¨ä¸­ï¼è¯¥ä¼ æå¨ééè¿æ°å­å¼æç¤ºæºæ¢°ä½ç½®ï¼å¶ç¼ç çä¸è§¦ç¹çè®¾è®¡éµå¾ªæ ¼é·ç é»è¾ââç¼ç çä¸­çæåºä¸é»è¾1çä¿¡å·æºç¸è¿ï¼äº®åºåæ è¿æ¥ï¼è§¦ç¹ä¼å°å¶è¯å«ä¸ºé»è¾0ï¼ä¸º3ä½äºè¿å¶ç¼ç çç¼ç çéç¨æ ¼é·ç ç¼ç åï¼è½è®©è¿ç»­ç å­ä¹é´ä»æä¸ä¸ªæ°ä½åçååï¼ææé¿åå å¨ä»¶å¶é ç²¾åº¦éå¶ï¼è§¦ç¹è½¬å°è¾¹çä½ç½®æ¶åºç°çç¼ç éè¯¯é®é¢</p>
</li>
<li>
<p>æ ¼é·ç å¯ä»¥ç¨äºè§£å³æ±è¯ºå¡é®é¢ï¼</p>
<p>è®¾ççæ°éä¸º <span class="math inline">\(n\)</span>ï¼æä»¬ä» <span class="math inline">\(n\)</span> ä½å¨ <span class="math inline">\(0\)</span> çæ ¼é·ç  <span class="math inline">\(G(0)\)</span> å¼å§ï¼ä¾æ¬¡ç§»åä¸ä¸ä¸ªæ ¼é·ç ï¼<span class="math inline">\(G(i)\)</span> ç§»å <span class="math inline">\(G(i+1)\)</span>ï¼ï¼å½åæ ¼é·ç çäºè¿å¶ç¬¬ <span class="math inline">\(i\)</span> ä½è¡¨ç¤ºä»å°å°å¤§ç¬¬ <span class="math inline">\(i\)</span> ä¸ªçå­ï¼</p>
<p>ç±äºæ¯ä¸æ¬¡åªæä¸ä¸ªäºè¿å¶ä½ä¼æ¹åï¼å æ­¤å½ç¬¬ <span class="math inline">\(i\)</span> ä½æ¹åæ¶ï¼æä»¬ç§»å¨ç¬¬ <span class="math inline">\(i\)</span> ä¸ªçå­ï¼å¨ç§»å¨çå­çè¿ç¨ä¸­ï¼é¤äºæå°ççå­ï¼å¶ä»ä»»æä¸ä¸ªçå­å¨ç§»å¨çæ¶ä¾¯ï¼åªè½æä¸ä¸ªæ¾ç½®éæ©ï¼å¨ç§»å¨ç¬¬ä¸ä¸ªçå­çæ¶ä¾¯ï¼æä»¬æ»æ¯æä¸¤ä¸ªæ¾ç½®éæ©ï¼äºæ¯æä»¬çç­ç¥å¦ä¸ï¼</p>
<p>å¦æ <span class="math inline">\(n\)</span>  æ¯ä¸ä¸ªå¥æ°ï¼é£ä¹çå­çç§»å¨è·¯å¾ä¸º $$f\to t\to r\to f\to t\to r\to\cdots$$ ï¼å¶ä¸­ <span class="math inline">\(f\)</span> æ¯æå¼å§çæ±å­ï¼<span class="math inline">\(t\)</span> æ¯æç»æä»¬æææçå­æ¾å°çæ±å­ï¼<span class="math inline">\(r\)</span> æ¯ä¸­é´çæ±å­ï¼</p>
<p>å¦æ <span class="math inline">\(n\)</span> æ¯å¶æ°ï¼<span class="math inline">\(f \to r \to t \to f \to r \to t \to \cdots\)</span></p>
</li>
<li>
<p>æ ¼é·ç ä¹å¨éä¼ ç®æ³çè®ºä¸­å¾å°åºç¨ï¼æ ¼é·ç çåä½è·ç¦»æ§ä½¿å¶æ¯æ¬¡æ¹åä»æ¹åä¸ä½äºè¿å¶ä½ï¼å æ­¤å¦æå¨åå¼æ¶ä½¿ç¨å¯ä»¥é¿ååå¼åä¸åå¼åçå·®å¼è¿å¤§å¯¼è´æ¶æä¸ç¨³å®ï¼åæ¶ç¶ä»£äº¤åæ¶åç¹äº¤åä¼ç ´åè¿ç»­æ§ï¼ä½¿å­ä»£ä¸ç¶ä»£å·®å¼è¿å¤§ï¼èä½¿ç¨æ ¼é·ç åå¯ä»¥é¿åå­ä»£ç¶ä»£ä¸åäº²ççã</p>
</li>
</ul>
<h2 id="æ»ç»">æ»ç»</h2>
<p>ä»ä¸éçä¼¼ç®åçâæå°å¼æåâæé é¢ï¼å°æ·±å¥æ¢ç´¢æ ¼é·ç çæ°å­¦ä¸çï¼æä»¬ä¸é¾åç°ç®æ³ä¹ç¾å¾å¾éèå¨åºç¡çæ°å­¦æ§è´¨ä¹ä¸­ã</p>
<p>æ ¼é·ç ä½ä¸ºä¸ä¸ªç»å¸çäºè¿å¶ç³»ç»ï¼å¶æ ¸å¿ä»·å¼å¨äº <strong>âç¸é»å³æå°å·®å¼â</strong> ãè¿ä¸ç¹æ§ä¸ä»å¨ç®æ³ç«èµä¸­å¸®å©æä»¬è§£å³æé ç±»é®é¢ï¼å¦æ±è¯ºå¡ãåå¯é¡¿è·¯å¾æé ï¼ï¼æ´å¨å·¥ç¨é¢åï¼å¦ä¼ æå¨é²æãæ°æ®ä¼ è¾çº éï¼åæ¥çä¸å¯æ¿ä»£çä½ç¨ã</p>
<p>ææ¡æ ¼é·ç ï¼ä¸ä»ä»æ¯è®°ä½äº <code>i ^ (i &gt;&gt; 1)</code> è¿ä¸ªå¬å¼ï¼æ´éè¦çæ¯çè§£äºå®<strong>éè¿æ¹åç¼ç é¡ºåºæ¥éä½ç³»ç»ä¸ç¡®å®æ§</strong>çæç»´æ¹å¼ãå¸æè¿ç¯åå®¢è½è®©ä½ å¨ä¸æ¬¡éå°ç±»ä¼¼æé é¢æå·¥ç¨é®é¢æ¶ï¼è½æéå°èæ³å°è¿ä¸ªç¥å¥çåºåã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-11 12:17">2026-02-11 12:17</span>&nbsp;
<a href="https://www.cnblogs.com/reasa">reasa</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19603721);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19603721', targetLink: 'https://www.cnblogs.com/reasa/p/19603721', title: 'ç¥ç§åºåââæ ¼é·ç åºå' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å«åå»ç­äºï¼ç» Claude Code è£ä¸ªéç¥éé ]]></title>
    <link>https://www.cnblogs.com/crossoverJie/p/19603468</link>
    <guid>f209556362d8a802fadc900412a1eeae</guid>
    <description>
    <![CDATA[ 
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/crossoverJie/p/19603468" title="åå¸äº 2026-02-11 11:32">
    <span role="heading" aria-level="2">å«åå»ç­äºï¼ç» Claude Code è£ä¸ªéç¥éé</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="èæ¯">èæ¯</h1>
<p>æè¿ç¨ Claude CodeãCopilot CLI è¿ç±» AI Agent å·¥å·çæ¶åï¼æä¸ä¸ªæºç¦äººçé®é¢ï¼è®© AI å¨åå°è·ä»»å¡ï¼ææ»æ¯ä¼å¿ä¸ä½å»æ¥çä»çæ§è¡ç¶æï¼ææ¶åæ¯è¾å¤æçä»»å¡å¯è½ä¼èæ¶åæ¥åéï¼æ¯æ¬¡æ¥ååæ¢éå¸¸æµªè´¹æ¶é´ã</p>
<p>æ´æ¨çæ¯ææ¶å AI éè¦ææææä¸ªæä½ï¼æ¯å¦æ§è¡ shell å½ä»¤ï¼ï¼ææ²¡æ³¨æå°ï¼å®å°±ä¸ç´å¡å¨é£éç­ã</p>
<p>æä»¥æä¸ç´æ³æ¾ä¸ä¸ªé è°±çéç¥æ¹æ¡ã</p>
<p>çµææ¥æºäºæ­å®¢ã<a href="https://justinyan.me/post/6623" target="_blank" rel="noopener nofollow">æ«è¨æ«è¯­</a>ãï¼ä¸»æ­èªåæå°å¯ä»¥ç¨ Hook æ¥å®ç° Agent éç¥ã</p>
<p>ä¸è¿ä¸å¼å§æå·äºä¸ªæï¼è®© AI èªå·±ç»æ¹æ¡ãAI ç»åºçæ¹æ¡å¾"AI"ï¼å¨ <code>~/.claude/CLAUDE.md</code> éå ä¸æ®µç³»ç»æç¤ºè¯ï¼æç¤º LLM ä»»å¡å®æåç¨ <code>afplay</code> æ­æ¾ä¸ä¸ªæç¤ºé³ã</p>
<pre><code class="language-markdown">## Task Completion Sound
When you complete a task, play a sound:
afplay /System/Library/Sounds/Glass.aiff
</code></pre>
<p>æµè¯äºå æ¬¡åç°è¿ç©æä¸é è°±ââææ¶ååï¼ææ¶åä¸åï¼å®å¨ç LLM å¿æã</p>
<p>æç»æè¿æ¯åå°äº Hook æ¹æ¡ï¼ç¨åå¹³å°ç Hooks ç³»ç»å®ç°ç¡®å®æ§è§¦åï¼å¹¶å°è£æäºä¸ä¸ªå¯å¤ç¨ç <a href="https://github.com/crossoverJie/skills" target="_blank" rel="noopener nofollow">SKILL</a>ã</p>
<p>æç»çææå¦ä¸ï¼</p>
<p><img alt="SCR-20260210-iwpt" width="342" height="363" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1431471/202602/1431471-20260211113232457-1124830088.png" class="lazyload"></p>

<h1 id="é®é¢åæ">é®é¢åæ</h1>
<p>ä¸ºä»ä¹ LLM æç¤ºè¯æ¹æ¡ä¸é è°±ï¼ä¸»è¦ä¸ä¸ªåå ï¼</p>
<ol>
<li><strong>LLM ä¸ä¼ 100% éµå¾ªéå¸¦æä½ç±»æä»¤</strong>ï¼LLM å¯¹"çæææ¬"ä»¥å¤çæä½æä»¤ï¼æ¯å¦"è¿è¡ bash å½ä»¤"ï¼æ¬æ¥å°±ä¸å¤ªå¯é ï¼å®å¯è½è§å¾å½ååºæ¯"ä¸éè¦"æ­æ¾å£°é³å°±è·³è¿äº</li>
<li><strong>ä¸ä¸æåç¼©ä¼ä¸¢å¤±æä»¤</strong>ï¼é¿å¯¹è¯ä¸­ï¼ç³»ç»ä¼èªå¨åç¼©ä¸ä¸æï¼æç¤ºè¯çä¼åçº§ä¼è¢«éä½çè³ç´æ¥ä¸¢æ</li>
<li><strong>LLM å¯¹è§¦åæ¶æºçå¤å®ä¸ä¸è´</strong>ï¼ä»ä¹ç®"ä»»å¡å®æ"ï¼LLM æ¯æ¬¡ççè§£å¯è½é½ä¸ä¸æ ·ï¼å¯¼è´è§¦åè¡ä¸ºä¸ç¨³å®</li>
</ol>
<p>æ¬è´¨ä¸ï¼è¿æ¯ä¸ä¸ª"è½¯æç¤º" vs "ç¡¬è§¦å"çé®é¢ãç¨æç¤ºè¯å»æ§å¶ LLM è¡ä¸ºï¼å°±åæ¯"ææä½ å¸®æåä¸ä»¶äº"ï¼èç¨ Hooks å°±æ¯"å½è¿ä¸ªäºä»¶åçæ¶ï¼èªå¨æ§è¡è¿æ®µä»£ç "ââç¡®å®æ§å®å¨ä¸åã</p>
<table>
<thead>
<tr>
<th>å¯¹æ¯é¡¹</th>
<th>æç¤ºè¯æ¹æ¡</th>
<th>Hooks æ¹æ¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>è§¦åå¯é æ§</td>
<td>ä¸ç¡®å®ï¼åå³äº LLM å¤æ­</td>
<td>ç¡®å®æ§ 100% è§¦å</td>
</tr>
<tr>
<td>ä¸ä¸æå½±å</td>
<td>é¿å¯¹è¯ä¼è¢«åç¼©ä¸¢å¤±</td>
<td>ä¸åä¸ä¸æå½±å</td>
</tr>
<tr>
<td>éç½®æ¹å¼</td>
<td>Markdown ææ¬</td>
<td>JSON éç½® + èæ¬</td>
</tr>
<tr>
<td>å¯æ©å±æ§</td>
<td>åºæ¬ä¸å¯æ©å±</td>
<td>æ¯æå¤å¹³å°ãå¤æ¸ é</td>
</tr>
<tr>
<td>ç»´æ¤ææ¬</td>
<td>æ¯æ¬¡æ¢æ¨¡åå¯è½è¦è°æç¤ºè¯</td>
<td>ä¸æ¬¡éç½®ï¼æç»­çæ</td>
</tr>
</tbody>
</table>
<p>æç¹ç±»ä¼¼äºç°å¨ç LLM å Agent çåºå«ï¼Agent æ¯å¹²æ´»çï¼å¤§æ¨¡åæ¯è´è´£æèçã</p>
<p>ç¡®å®çäºæè¿æ¯è¦äº¤ç»ç¡®å®ç Agent å»åã</p>
<h1 id="agent-notifier-ä»ç»">agent-notifier ä»ç»</h1>
<p>åºäºä»¥ä¸åæï¼æå¼åäº <a href="https://github.com/crossoverJie/skills/tree/main/skills/agent-notifier" target="_blank" rel="noopener nofollow">agent-notifier</a> è¿ä¸ª SKILLï¼ç¨ Hooks å®ç°ç¡®å®æ§éç¥ã</p>
<h2 id="åè½æ¦è§">åè½æ¦è§</h2>
<p>æ¯æç AI Agent å¹³å°ï¼</p>
<table>
<thead>
<tr>
<th>å¹³å°</th>
<th>Hook æºå¶</th>
<th>è§¦åäºä»¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>Claude Code</td>
<td>settings.json hooks</td>
<td><code>Notification</code>ï¼idle_prompt, permission_promptï¼</td>
</tr>
<tr>
<td>GitHub Copilot CLI</td>
<td>hooks.json</td>
<td><code>sessionEnd</code>, <code>postToolUse</code></td>
</tr>
<tr>
<td>Cursor</td>
<td>hooks.json</td>
<td><code>stop</code>, <code>afterFileEdit</code></td>
</tr>
<tr>
<td>Codexï¼OpenAIï¼</td>
<td>notify setting</td>
<td><code>agent-turn-complete</code></td>
</tr>
<tr>
<td>Aider</td>
<td>CLI flag</td>
<td><code>--notifications-command</code></td>
</tr>
</tbody>
</table>
<p>æ¯æçéç¥æ¸ éï¼</p>
<table>
<thead>
<tr>
<th>æ¸ é</th>
<th>é»è®¤ç¶æ</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sound</td>
<td>å¯ç¨</td>
<td>macOS ç¨ <code>afplay</code>ï¼Linux ç¨ <code>paplay</code>/<code>aplay</code></td>
</tr>
<tr>
<td>macOS éç¥ä¸­å¿</td>
<td>å¯ç¨</td>
<td>éè¿ <code>osascript</code> å¼¹åºç³»ç»éç¥</td>
</tr>
<tr>
<td>Telegram</td>
<td>ç¦ç¨</td>
<td>éè¦ Bot Token + Chat ID</td>
</tr>
<tr>
<td>Email</td>
<td>ç¦ç¨</td>
<td>SMTP åé</td>
</tr>
<tr>
<td>Slack</td>
<td>ç¦ç¨</td>
<td>Incoming Webhook</td>
</tr>
<tr>
<td>Discord</td>
<td>ç¦ç¨</td>
<td>Webhook URL</td>
</tr>
</tbody>
</table>
<h2 id="æ¶æè®¾è®¡">æ¶æè®¾è®¡</h2>
<p>æ ¸å¿æè·¯æ¯<strong>ç»ä¸äºä»¶æ¨¡å + å¹¶åå¤æ¸ éåå</strong>ï¼</p>
<pre><code>åå¹³å° Hook è§¦å
       â
  stdin JSON è¾å¥ï¼åå¹³å°æ ¼å¼ä¸åï¼
       â
  notify.py è§£æä¸ºç»ä¸äºä»¶ï¼{platform, event, message}
       â
  è¯»å notify-config.json éç½®
       â
  ThreadPoolExecutor å¹¶åååå°ææå¯ç¨çæ¸ é
</code></pre>
<p>æ¯ä¸ªå¹³å°ä¼ è¿æ¥ç JSON æ ¼å¼ä¸ä¸æ ·ï¼æ¯å¦ Claude Code æ¯ <code>{"notification_type": "idle_prompt", ...}</code>ï¼Copilot CLI æ¯ <code>{"hook_event_name": "sessionEnd", ...}</code>ã<code>notify.py</code> ä¼æè¿äºä¸åçæ ¼å¼ç»ä¸è§£ææ <code>{platform, event, message}</code> ä¸åç»ï¼ç¶åæ ¹æ®éç½®ååå°åä¸ªéç¥æ¸ éã</p>
<blockquote>
<p>ä¸ä¸ªå³é®è®¾è®¡ï¼åä¸ªæ¸ éåéå¤±è´¥ä¸å½±åå¶ä»æ¸ éãæ¯å¦ Telegram ç½ç»è¶æ¶äºï¼Sound å macOS éç¥è¯¥åè¿æ¯åãéè¯¯ä¿¡æ¯åªè¾åºå° stderrï¼ä¸ä¼ä¸­æ­æµç¨ã</p>
</blockquote>
<h2 id="æ ¸å¿è®¾è®¡å³ç­çº¯æ ååºé¶ä¾èµ">æ ¸å¿è®¾è®¡å³ç­ï¼çº¯æ ååºãé¶ä¾èµ</h2>
<p>æ´ä¸ª <code>notify.py</code> åªç¨äº Python æ ååºï¼æ²¡æä»»ä½ <code>pip</code> ä¾èµï¼</p>
<ul>
<li>HTTP è¯·æ±ç¨ <code>urllib.request</code>ï¼å TelegramãSlackãDiscordï¼</li>
<li>é®ä»¶ç¨ <code>smtplib</code></li>
<li>æ­æ¾å£°é³ç¨ <code>subprocess</code> è°ç³»ç»å½ä»¤</li>
<li>å¹¶åç¨ <code>concurrent.futures</code></li>
</ul>
<p>è¿æå³çåªè¦æºå¨ä¸æ Pythonï¼æ¿æ¥å°±è½ç¨ï¼ä¸éè¦ <code>pip install</code> ä»»ä½ä¸è¥¿ã</p>
<h1 id="å¼åè¿ç¨">å¼åè¿ç¨</h1>
<p>æ´ä¸ª SKILL çå¼åä¹æ¯å AI å¯¹è¯å®æçï¼ä¸é¢åé¶æ®µåé¡¾ã</p>
<h2 id="é¶æ®µä¸æ ¸å¿éç¥èæ¬-notifypy">é¶æ®µä¸ï¼æ ¸å¿éç¥èæ¬ notify.py</h2>
<p>è¿æ¯ææ ¸å¿çé¨åï¼è´è´£ä¸ä»¶äºï¼</p>
<ol>
<li><strong>è§£æè¾å¥</strong>ï¼ä» stdin è¯»ååå¹³å°ä¼ è¿æ¥ç JSONï¼è¯å«å¹³å°ç±»ååäºä»¶</li>
<li><strong>ç»ä¸äºä»¶æ¨¡å</strong>ï¼ä¸ç®¡åªä¸ªå¹³å°ï¼ç»ä¸è§£æä¸º <code>{platform, event, message}</code></li>
<li><strong>å¤æ¸ éåé</strong>ï¼å¹¶åè°ç¨ææå¯ç¨çéç¥æ¸ é</li>
</ol>
<p>æ¯å¦ Claude Code ç Hook ä¼éè¿ stdin ä¼ å¥ï¼</p>
<pre><code class="language-json">{"notification_type": "idle_prompt", "message": "Claude is waiting for your input"}
</code></pre>
<p>èæ¬è§£æåçæéç¥ï¼<strong>"â Task completed â waiting for your input"</strong>ï¼ç¶ååæ¶åå° SoundãmacOS éç¥ä¸­å¿ãTelegram ç­ææå¯ç¨çæ¸ éã</p>
<h2 id="é¶æ®µäºéç½®ä¸å®è£">é¶æ®µäºï¼éç½®ä¸å®è£</h2>
<p>åææ ¸å¿èæ¬è¿ä¸å¤ï¼è¿éè¦è®©ç¨æ·è½æ¹ä¾¿å°éç½®åå®è£ãæä»¥åæäºä¸¤ä¸ªæä»¶ï¼</p>
<p><strong>notify-config.json</strong>ï¼éç½®æ¨¡æ¿ï¼å®ä¹äºæææ¸ éçå¼å³ååæ°ãé»è®¤åªå¯ç¨ Sound å macOS éç¥ï¼TelegramãEmail è¿äºéè¦æå¨å¯ç¨å¹¶å¡«å¥å­æ®ã</p>
<p><strong>setup.py</strong>ï¼äº¤äºå¼å®è£èæ¬ï¼è¿è¡åä¼ï¼</p>
<ol>
<li>èªå¨æ£æµä½ è£äºåªäº AI Agent å¹³å°</li>
<li>å¼å¯¼ä½ éç½®éç¥æ¸ éï¼è¦ä¸è¦ Telegramï¼Bot Token æ¯ä»ä¹ï¼ï¼</li>
<li>èªå¨å¨å¯¹åºå¹³å°åå¥ Hook éç½®</li>
<li>åä¸æ¡æµè¯éç¥éªè¯éç½®</li>
</ol>
<h2 id="é¶æ®µä¸éææµè¯">é¶æ®µä¸ï¼éææµè¯</h2>
<p>ä»£ç åå®äºï¼å³é®æ¯è·èµ·æ¥éªè¯ã</p>
<p>é¦åå¨ Claude Code ç <code>~/.claude/settings.json</code> ééç½® Hookï¼</p>
<pre><code class="language-json">{
  "hooks": {
    "Notification": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "python3 ~/.claude/skills/agent-notifier/notify.py"
          }
        ]
      }
    ]
  }
}
</code></pre>
<p>ç¶åæå¨æµè¯ï¼</p>
<pre><code class="language-bash"># æ¨¡æä»»å¡å®æéç¥
echo '{"notification_type":"idle_prompt","message":"test"}' | python3 notify.py

# æ¨¡ææéè¯·æ±éç¥
echo '{"notification_type":"permission_prompt","message":"needs permission"}' | python3 notify.py
</code></pre>
<p>Sound å macOS éç¥é½æ­£å¸¸ãæ¥çå¯ç¨ Telegramï¼éå¥½ Bot Token å Chat IDï¼åè·ä¸æ¬¡ââTelegram ä¹æ¶å°äºæ¶æ¯ã</p>
<p>æåè®© Claude Code æ§è¡ä¸ä¸ªçå®ä»»å¡ï¼ç¶åç­å®è·å®ãæç¶ï¼ä»»å¡ç»æå Telegram å¼¹åºéç¥ï¼Sound ä¹åäºï¼æå®ã</p>
<h2 id="é¶æ®µåä¿®-bug-æ¹ææ¡">é¶æ®µåï¼ä¿® bug æ¹ææ¡</h2>
<p>å®éä½¿ç¨ä¸­åç°ä¸ä¸ªé®é¢ï¼<code>idle_prompt</code> çéç¥æ¶æ¯æ¯ "Claude is waiting for your input"ï¼ä½è¿ä¸ªæ¶æ¯ä¸å¤ç´è§ââææ´æ³ç¥éçæ¯"ä»»å¡å®æäº"ï¼èä¸æ¯"å¨ç­ä½ è¾å¥"ã</p>
<p>è½ç¶æ¬è´¨ä¸ <code>idle_prompt</code> å°±æ¯ä»»å¡å®æåç­å¾è¾å¥çä¿¡å·ï¼ä½æ¶æ¯ææ¡ä¼å½±åç¨æ·æç¥ãäºæ¯æ¹æäºï¼</p>
<ul>
<li><code>idle_prompt</code> â <strong>"â Task completed â waiting for your input"</strong></li>
<li><code>permission_prompt</code> â <strong>"ð Permission required"</strong></li>
</ul>
<p>æ¹å®ä¹ååæµï¼Telegram æ¶æ¯ä¸ç®äºç¶ï¼ä¸ç¨åçå®å°åºæ¯ä»ä¹ç¶æäºã</p>
<h1 id="æ»ç»">æ»ç»</h1>
<p>è¿æ¬¡å¼åææ ¸å¿çè§ç¹å°±ä¸å¥è¯ï¼<strong>Hooks &gt; æç¤ºè¯</strong>ã</p>
<p>å¡æ¯éè¦ç¡®å®æ§æ§è¡çæä½ï¼é½ä¸åºè¯¥ç¨æç¤ºè¯å»"è¯·æ±"LLM æ¥åï¼èæ¯åºè¯¥ç¨å¹³å°æä¾ç Hook æºå¶æ¥ä¿è¯ãæç¤ºè¯éåæ§å¶çæåå®¹çé£æ ¼åæ¹åï¼ä½ä¸éåæ§å¶"æ¯å¦æ§è¡æä¸ªæä½"è¿ç±»äºåå³ç­ã</p>
<p>å¦å¤ï¼å¯¹è¯å¼å¼åçä½éªä¾ç¶å¾å¥½ãä»æåçæ³æ³å°æç»å¯ç¨ç SKILLï¼æ´ä¸ªè¿ç¨å°±æ¯ä¸æ­å¯¹è¯ãæµè¯ãä¿®å¤çå¾ªç¯ãå Telegram æ¶æ¯ææ¡ä¸å¤ç´è§è¿ç§é®é¢ï¼ä¹æ¯å¨å®æµä¸­æåç°çã</p>
<p>æå´è¶£çå¯ä»¥å» <a href="https://github.com/crossoverJie/skills" target="_blank" rel="noopener nofollow">GitHub ä»åº</a> ççæºç ï¼<code>agent-notifier</code> å¨ <code>skills/agent-notifier/</code> ç®å½ä¸ã</p>
<h1 id="blog">Blog</h1>


</div>
<div id="MySignature" role="contentinfo">
    <div style="font-size: small">

<p>
        ä½èï¼ 
        <a href="https://crossoverjie.top/about/">crossoverJie</a>
</p>
<p>
        åºå¤ï¼
        <a href="https://crossoverjie.top/">https://crossoverjie.top</a>
</p>
<img src="https://i.loli.net/2019/05/19/5ce16dbc99cfa13989.jpg">
<p>
æ¬¢è¿å³æ³¨åä¸»å¬ä¼å·ä¸æäº¤æµã
</p>
<p>
         æ¬æçæå½ä½èææï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»ä¿çæ­¤æ®µå£°æï¼ä¸å¨æç« é¡µé¢ææ¾ä½ç½®ç»åº,
            å¦æé®é¢ï¼ å¯é®ä»¶ï¼crossoverJie#gmail.comï¼å¨è¯¢ã
</p>
</div>
</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-11 11:33">2026-02-11 11:32</span>&nbsp;
<a href="https://www.cnblogs.com/crossoverJie">crossoverJie</a>&nbsp;
éè¯»(<span id="post_view_count">25</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19603468);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19603468', targetLink: 'https://www.cnblogs.com/crossoverJie/p/19603468', title: 'å«åå»ç­äºï¼ç» Claude Code è£ä¸ªéç¥éé' })">ä¸¾æ¥</a>
</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Sa-Token(ä¸)ä¹ç®ä»åå¥é¨ï¼åå«é´æåèï¼è®©æ¯ä¸ä½Javaå¼åèé½è½è½»æ¾ä¸æ ]]></title>
    <link>https://www.cnblogs.com/philry/p/19602802</link>
    <guid>11c612fa091cbae8142711fd1d8d98ca</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/philry/p/19602802" title="åå¸äº 2026-02-11 09:58">
    <span role="heading" aria-level="2">Sa-Token(ä¸)ä¹ç®ä»åå¥é¨ï¼åå«é´æåèï¼è®©æ¯ä¸ä½Javaå¼åèé½è½è½»æ¾ä¸æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1 data-pm-slice="3 1 []"><span><span><span>Sa-Token(ä¸)ä¹ç®ä»åå¥é¨ï¼åå«é´æåèï¼è®©æ¯ä¸ä½Javaå¼åèé½è½è½»æ¾ä¸æ</span></span></span></h1>
<p><span style="background-color: rgba(0, 204, 255, 1); font-size: 18px">å¯ä»¥ç¹å»ææ«çé¾æ¥ã<a title="Sa-Token(ä¸)ä¹ç®ä»åå¥é¨ï¼åå«é´æåèï¼è®©æ¯ä¸ä½Javaå¼åèé½è½è½»æ¾ä¸æ" href="https://mp.weixin.qq.com/s/JLQSMAgqK1U0vtrdtRsKlA" target="_blank" rel="noopener nofollow"><span style="background-color: rgba(0, 204, 255, 1)">éè¯»åæ</span></a>ã</span></p>
<p><span style="font-size: 18px">åä½ä¸æï¼<span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">è¿è¯·å®¶äººä»¬å³æ³¨ä¸å¬ä¼ä¸æ¯æï¼å°ç¼ä¸èææ¿ã</span></span></p>
<p>&nbsp;</p>
<p data-pm-slice="3 3 []"><span><span>åJavaçè¿äºå¹´ï¼æ è®ºæ¯åå¥èåºçæ°æï¼è¿æ¯æ·±èå¤å¹´çèåµï¼è°æ²¡å¨ãé´æãä¸æ ½è¿è·å¤´ï¼</span></span></p>
<p><span><span>ç¬å¤åSpring Securityçå¤æéç½®ï¼å¯¹çä¸å è¿æ»¤å¨é¾æè³æ è®ï¼ç¨Shiroåååç«¯åç¦»é¡¹ç®ï¼ä¸ºäºééTokenæ¨¡å¼æ¹éå¨å±æ¦æªå¨ï¼çè³ä¸ºäºä¸ä¸ªç®åçâè¸¢äººä¸çº¿âåè½ï¼èªå·±æåRedisç¼å­ãå¤çä¼è¯è¿æï¼æåè¿èçä¸å å¹¶åéæ£ã</span></span></p>
<p><span><span>æèµ°è¿10å¹´çå¼åä¹è·¯ï¼è§è¿å¤ªå¤å¼åèææ¬è¯¥è±å¨ä¸å¡é»è¾ä¸çç²¾åï¼å¨é¨æ¶èå¨ç¹çãåä½çé´æä»£ç éââæææ¯ä¸ä¸ªç®åçåå°ç®¡çç³»ç»ï¼å´è¦ä¸ºäºæéæ§å¶åå ç¾è¡éç½®ï¼æææ¯ä¸ä¸ªå°ç¨åºæ¥å£ï¼å´è¦ä¸ºäºTokenæ ¡éªåå¤è°è¯è·¨åãè¿æç»­æçé®é¢ã</span></span></p>
<p><span><span>ç´å°Sa-Tokençåºç°ï¼æå½»åºæç ´äºâé´æå¿å¤æâçé­åãå®å°±åä¸ä½æä½ çå¼åä¼ä¼´ï¼ä¸ç¨ä½ å¼¯è°è¿å°±å¤æçæ¦å¿µï¼ä¸ç¨ä½ ç¬å¤æ¼åç¹ççä»£ç ï¼åªç¨æç®åãæç´æ¥çæ¹å¼ï¼å¸®ä½ æå®ææé´æé¾é¢ãä»å¤©ï¼æå°±ä»¥è¿æ¥äººçèº«ä»½ï¼å¸¦çå¤§å®¶èµ°è¿Sa-Tokençä¸çï¼ä»å¯¹æ¯å°ç®ä»ï¼åå°æææå¥é¨ï¼æ¯ä¸æ­¥é½è´´åå¤§å®¶ççå®å¼åçç¹ï¼è®©ä½ çå®å°±è½ä¸æï¼ä»æ­¤åé´æåèè¯´åè§ã</span></span></p>
<h2><span><span>ä¸ãSa-Tokenåå¶ä»é´ææ¡æ¶çå¯¹æ¯ï¼ä¸å¹ä¸é»ï¼æä½ ççç¹ææ¯å¥½æ¡æ¶</span></span></h2>
<p><span><span>æå°Javaé´ææ¡æ¶ï¼å¤§å®¶æåæ³å°çï¼å¤§æ¦çæ¯Spring SecurityåApache Shiroãè¿ä¸¤æ¬¾æ¡æ¶é½æ¯è¡ä¸åçâèå¤§å¥âï¼æçç¨³å®ãçæå®åï¼å¨å¾å¤ä¼ ç»é¡¹ç®ä¸­é½æå¹¿æ³åºç¨ãä½ä¸å¯å¦è®¤çæ¯ï¼å®ä»¬è¯çäºJSPä¸»å¯¼çæ¶ä»£ï¼å¾å¤è®¾è®¡çå¿µå·²ç»è·ä¸ä¸å¦ä»ååç«¯åç¦»ãå¾®æå¡çè¡çå¼åèå¥ï¼è¿ä¹æäºå¾å¤å¼åèçâçç¹æ¥æºâã</span></span></p>
<p><span><span>åè¯´è¯´Spring Securityï¼å®çå¼ºå¤§æ¯åº¸ç½®çââç»ç²åº¦çæéæ§å¶ãå®åçOAuth2.0æ¯æãä¸Springçæçæ ç¼éæï¼å ä¹è½æ»¡è¶³ææä¼ä¸çº§é¡¹ç®çé´æéæ±ãä½å®çâå¼ºå¤§âï¼ä¹ä¼´éçæé«çå­¦ä¹ ææ¬ãå¯¹äºæ°ææ¥è¯´ï¼åæ¯ææè¿æ»¤å¨é¾ãè®¤è¯ç®¡çå¨ãæéå³ç­å¨è¿äºæ¦å¿µï¼å°±è¦è±ä¸å å¤©çè³å å¨çæ¶é´ï¼åªææ¯æç»éªçå¼åèï¼è¦éç½®ä¸å¥å®æ´çãééååç«¯åç¦»çé´æé»è¾ï¼ä¹è¦åå¤§éçèªå®ä¹éç½®ãéåå¤ä¸ªæ¥å£ï¼ç¹çä¸å®¹æåºéã</span></span></p>
<p><span><span>åè¯´è¯´Apache Shiroï¼å®æ¯Spring Securityç®æ´å¾å¤ï¼æ ¸å¿åè½ï¼è®¤è¯ãææãä¼è¯ç®¡çï¼æ¸æ°ææï¼å­¦ä¹ ææ¬ç¸å¯¹è¾ä½ï¼ä¹è½æ»¡è¶³å¤§å¤æ°ä¸­å°åé¡¹ç®çéæ±ãä½å®çç­æ¿ä¹å¾ææ¾ï¼å¨ååç«¯åç¦»ãå¾®æå¡åºæ¯ä¸ï¼ééæ§å¾å·®ââæ²¡æåççTokenæ¯æï¼éè¦æå¨éæJWTï¼æ²¡æå¼ç®±å³ç¨çåå¸å¼ä¼è¯æ¹æ¡ï¼éè¦èªå·±éæRedisï¼æ³è¦å®ç°âè¸¢äººä¸çº¿ââåç«¯äºæ¥ç»å½âè¿äºå¸¸è§åè½ï¼é½éè¦æå¨æ©å±ï¼ä»£ç éä¸å°ï¼èä¸å®¹æåºç°å¼å®¹æ§é®é¢ã</span></span></p>
<p><span><span>èSa-Tokenï¼æ°å¥½å¼¥è¡¥äºè¿ä¸¤æ¬¾æ¡æ¶çç­æ¿ï¼åæ¶ä¿çäºå®ä»¬çä¼å¿ï¼æ´è´´åå¦ä»çå¼ååºæ¯ãå®ä¸è¿½æ±âå¤§èå¨âï¼åªè¿½æ±âå°èç²¾âï¼ææè®¾è®¡é½å´ç»âå¼åèçç¹âå±å¼ï¼ä¸å¼å¥å¤æçæ¦å¿µï¼ä¸æ·»å åä½çåè½ï¼è®©é´æåå½æ¬è´¨ââç®åãé«æãæç¨ã</span></span></p>
<p><span><span>ä¸ºäºè®©å¤§å®¶çå¾æ´ç´è§ï¼ææ´çäºä¸ä»½ä¸å¹ä¸é»çå¯¹æ¯ï¼æ²¡æåä¸½çè¾è»ï¼åªæçå®çå¼åä½éªï¼</span></span></p>
<p><span><strong><span><span>1. å­¦ä¹ ææ¬</span></span></strong><span><span>ï¼Spring Securityï¼æé«ï¼&gt; Apache Shiroï¼ä¸­ç­ï¼&gt; Sa-Tokenï¼æä½ï¼ãSa-Tokenå¯ä»¥é¶éç½®å¯å¨ï¼ä¸ç¨æå¤æçæ¶æè®¾è®¡ï¼ä¸ç¨è®°ç¹ççéç½®é¡¹ï¼åªææ¯æ°æï¼çä¸éææ¡£ãåå è¡ä»£ç ï¼å°±è½å¿«éä¸æã</span></span></span></p>
<p><span><strong><span><span>2. ååç«¯åç¦»éé</span></span></strong><span><span>ï¼Sa-Tokenï¼åçæ¯æï¼&gt; Spring Securityï¼éå¤§éèªå®ä¹éç½®ï¼&gt; Apache Shiroï¼éæå¨éæJWTï¼ãSa-Tokenåç½®å¤ç§Tokenè¯»åç­ç¥ï¼ééAPPãå°ç¨åºãSPAåé¡µåºç¨ç­ææååç«¯åç¦»åºæ¯ï¼ä¸ç¨ä½ æå¨å¤çè·¨åãTokenä¼ éçé®é¢ã</span></span></span></p>
<p><span><strong><span><span>3. å¾®æå¡éé</span></span></strong><span><span>ï¼Sa-Tokenï¼å¼ç®±å³ç¨ï¼&gt; Spring Securityï¼ééæSpring Cloud Securityï¼&gt; Apache Shiroï¼éå¤§éèªå®ä¹æ©å±ï¼ãSa-Tokenæä¾åå¸å¼ä¼è¯ãç½å³ç»ä¸é´æãRPCè°ç¨é´æç­æ¹æ¡ï¼å¤ç³»ç»æ°æ®äºéåªéç®åéç½®ï¼éå¯æ°æ®ä¸ä¸¢å¤±ã</span></span></span></p>
<p><span><strong><span><span>4. å¸¸ç¨åè½æ¯æ</span></span></strong><span><span>ï¼Sa-Tokenï¼å¼ç®±å³ç¨ï¼&gt; Spring Securityï¼ééç½®/æ©å±ï¼&gt; Apache Shiroï¼éæ©å±ï¼ãç»å½è®¤è¯ãæéæ ¡éªãè¸¢äººä¸çº¿ãè´¦å·å°ç¦ãTokenç»­æãåç«¯äºæ¥ç»å½ãåç¹ç»å½ç­å¸¸è§åè½ï¼Sa-Tokenå¨é¨åç½®ï¼ä¸è¡ä»£ç å°±è½è°ç¨ï¼ä¸ç¨ä½ æå¨æ¼åã</span></span></span></p>
<p><span><strong><span><span>5. æ©å±æ§</span></span></strong><span><span>ï¼Spring Securityï¼æé«ï¼&gt; Sa-Tokenï¼é«ï¼&gt; Apache Shiroï¼ä¸­ç­ï¼ãSa-Tokenå ä¹ææç»ä»¶é½æä¾äºæ©å±æ¥å£ï¼90%ä»¥ä¸çé»è¾é½å¯ä»¥æééåï¼æ¢è½æ»¡è¶³ä¸­å°åé¡¹ç®çå¿«éå¼åéæ±ï¼ä¹è½ééå¤§åé¡¹ç®çå®å¶åéæ±ã</span></span></span></p>
<p><span><span>å¨è¿éï¼æä¸æ¯è¦å¦å®Spring SecurityåShiroââå®ä»¬ä¾ç¶æ¯ä¼ç§çæ¡æ¶ï¼å¨éåçåºæ¯ä¸ä¾ç¶æ¯é¦éãä½å¯¹äºå¤§å¤æ°å¼åèæ¥è¯´ï¼æä»¬ä¸éè¦é£ä¹âéâçæ¡æ¶ï¼ä¸éè¦ä¸ºäºä¸ä¸ªç®åçé´æåè½ï¼å»æ¿æé«é¢çå­¦ä¹ ææ¬åå¼åææ¬ãæä»¬æ³è¦çï¼æ¯ä¸ä¸ªè½å¿«éä¸æãè½è§£å³çç¹ãè½èçæ¶é´çå·¥å·ï¼èSa-Tokenï¼æ­£æ¯è¿æ ·çå·¥å·ã</span></span></p>
<p><span><span>å°±åå¾å¤å¼åèè¯´çï¼âç¨è¿Sa-Tokenä¹åï¼æç¥éé´æåæ¥å¯ä»¥è¿ä¹ç®åââä»¥åè±ä¸å¤©éç½®çåè½ï¼ç°å¨ä¸è¡ä»£ç å°±è½æå®ï¼ä»¥åç¬å¤è°è¯çbugï¼ç°å¨æ ¹æ¬ä¸ä¼åºç°ãâ è¿ä¸æ¯å¤¸å¼ ï¼èæ¯æ æ°å¼åèççå®ä½éªï¼ä¹æ¯æç¨äºè¿ä¹å¤å¹´Sa-Tokenï¼ä¸ç´æ¨èå®çåå ã</span></span></p>
<h2><span><span>äºãSa-Tokenç®ä»ï¼ä¸å¹´ç£¨ä¸åï¼è®©é´æåå¾ç®åãä¼é</span></span></h2>
<p><span><span>è¯´äºè¿ä¹å¤å¯¹æ¯ï¼å¯è½å¾å¤æåä¼é®ï¼Sa-Tokenå°åºæ¯ä»ä¹ï¼å®ä¸ºä»ä¹è½åå°âç®ååå¼ºå¤§âï¼</span></span></p>
<p><span><span>å®æ¹å¯¹Sa-Tokençå®ä¹æ¯ï¼ä¸æ¬¾å¼æºãåè´¹ãè½»éçº§çJavaæéè®¤è¯æ¡æ¶ï¼ä¸æ³¨äºè§£å³ç»å½è®¤è¯ãæéæ§å¶ãä¼è¯ç®¡çç­ä¸ç³»åé´æç¸å³é®é¢ï¼è®©é´æåå¾ç®åãä¼éãä½å¨æçæ¥ï¼Sa-Tokençæ ¸å¿ï¼ä¸æ¯âæ¡æ¶âï¼èæ¯âæå¼åèâââå®ç¥éæä»¬ä¸æ³åç¹ççéç½®ï¼æä»¥åå°äºé¶éç½®å¯å¨ï¼å®ç¥éæä»¬ä¸æ³è®°å¤æçAPIï¼æä»¥è®¾è®¡äºæç®çè°ç¨æ¹å¼ï¼å®ç¥éæä»¬å¼åä¸­ä¼éå°åªäºçç¹ï¼æä»¥æååç½®äºææå¸¸ç¨åè½ï¼è®©æä»¬âæ¿æ¥å°±ç¨âã</span></span></p>
<p><span><span>Sa-Tokençä½èè¯´è¿ä¸å¥è¯ï¼âç§æ¿çâä¸å¡ä¸éè¦ä»ä¹ï¼Sa-Tokenå°±åä»ä¹âççå¿µï¼æç»å¼å¥å¤æçæ¦å¿µï¼ä»¥å®éä¸å¡éæ±ä¸ºç¬¬ä¸ç®æ ãâ è¿å¥è¯ï¼æ­£æ¯Sa-Tokenççµé­æå¨ãå®ä¸è¿½æ±âé«å¤§ä¸âçæ¶æï¼ä¸ç«èâå¤å¼ºå¤§âçåè½ï¼åªä¸æ³¨äºè§£å³æä»¬å¼åä¸­æå®éçé®é¢ââ</span></span></p>
<p><span><span>ä½ éè¦ç»å½è®¤è¯ï¼ä¸è¡ä»£ç StpUtil.setLoginId(10001)å°±è½æ è®°ç»å½ï¼ä¸è¡ä»£ç StpUtil.checkLogin()å°±è½æ ¡éªç»å½ï¼ä¸ç¨èªå®ä¹Realmï¼ä¸ç¨éç½®å¨å±è¿æ»¤å¨ï¼</span></span></p>
<p><span><span>ä½ éè¦æéæ§å¶ï¼ä¸ä¸ªæ³¨è§£@SaCheckPermission("user:add")å°±è½å®ç°æ¥å£æéæ ¡éªï¼ä¸è¡ä»£ç StpUtil.hasRole("super-admin")å°±è½å¤æ­è§è²ï¼ä¸ç¨æå¨æ¥è¯¢æéè¡¨ãæ¼æ¥æéé»è¾ï¼</span></span></p>
<p><span><span>ä½ éè¦è¸¢äººä¸çº¿ï¼ä¸è¡ä»£ç StpUtil.logoutByLoginId(10001)å°±è½å®ç°ï¼ä¸ç®¡å¯¹æ¹å¨åªä¸ªç«¯ç»å½ï¼ä¸æ¬¡è®¿é®é½ä¼èªå¨éåºï¼ä¸ç¨æå¨æä½Redisãæ¸çä¼è¯ï¼</span></span></p>
<p><span><span>ä½ éè¦åå¸å¼ä¼è¯ï¼éæRedisåªéç®åéç½®ï¼é¡¹ç®éå¯æ°æ®ä¸ä¸¢å¤±ï¼å¤ç³»ç»æ°æ®äºéï¼ä¸ç¨èªå·±æååå¸å¼ç¼å­é»è¾ï¼</span></span></p>
<p><span><span>ä½ éè¦åç«¯äºæ¥ç»å½ï¼ä¸è¡ä»£ç StpUtil.setLoginId(10001, "PC")å°±è½æå®è®¾å¤ç»å½ï¼è¸¢æåè®¾å¤çå¶ä»ç»å½ä¼è¯ï¼åQQä¸æ ·çµæ´»ï¼ä¸ç¨èªå·±å¤çè®¾å¤æ è¯ãä¼è¯å²çªã</span></span></p>
<p><span><span>é¤æ­¤ä¹å¤ï¼Sa-Tokenè¿æ¯æOAuth2.0ãåç¹ç»å½ãå¯ç å å¯ãä¸´æ¶èº«ä»½åæ¢ãä¼è¯èªå¨ç»­æç­å åé¡¹åè½ï¼æ¶µçäºå¤§é¨åä¸å¡åºæ¯çè§£å³æ¹æ¡ï¼çæ­£åå°äºâä¸ç«å¼é´æâãèä¸å®çä½ç§¯æå°ï¼ä¾èµæå°ï¼å¼å¥é¡¹ç®åä¸ä¼å¢å é¢å¤çè´æï¼æ è®ºæ¯ä¸­å°åé¡¹ç®ï¼è¿æ¯å¤§åå¾®æå¡é¡¹ç®ï¼é½è½å®ç¾ééã</span></span></p>
<p><span><span>æ´é¾å¾çæ¯ï¼Sa-Tokençææ¡£éå¸¸å®åï¼æ¯ä¸ä¸ªåè½é½æè¯¦ç»çè¯´æãä»£ç ç¤ºä¾ï¼çè³è¿æå¸¸è§é®é¢çè§£å³æ¹æ¡ï¼ç¤¾åºä¹éå¸¸æ´»è·ï¼éå°é®é¢è½å¿«éå¾å°ååºï¼ä½èä¹ä¼æç»­æ´æ°ï¼ä¿®å¤æ¼æ´ãæ°å¢åè½ââä¸å¹´ç£¨ä¸åï¼Sa-Tokenä»æåçä¸ä¸ªå°å·¥å·ï¼æé¿ä¸ºå¦ä»å½åæåæ¬¢è¿çè½»éçº§é´ææ¡æ¶ä¹ä¸ï¼é çä¸æ¯å®£ä¼ ï¼èæ¯æ æ°å¼åèçå£ç¢ç§¯ç´¯ã</span></span></p>
<p><span><span>æä»äºJavaå¼å10å¹´ï¼ç¨è¿æ æ°æ¬¾æ¡æ¶ï¼æçæ¡æ¶è¿½æ±æè´çå¼ºå¤§ï¼æçæ¡æ¶è¿½æ±æè´ççµæ´»ï¼ä½åªæSa-Tokenï¼è¿½æ±æè´çâæä½ âãå®ä¸ç¨ä½ æ¹åèªå·±çå¼åä¹ æ¯ï¼ä¸ç¨ä½ è±è´¹å¤§éæ¶é´å­¦ä¹ ï¼åªç¨æç®åçæ¹å¼ï¼å¸®ä½ æå®æå¤æçé´æé¾é¢ï¼è®©ä½ è½ææ´å¤çç²¾åæ¾å¨ä¸å¡é»è¾ä¸ï¼æ¾å¨èªå·±çæ­£æ³åçäºæä¸ââè¿ï¼å°±æ¯Sa-Tokenæå¨äººçå°æ¹ã</span></span></p>
<h2><span><span>ä¸ãSa-Tokenå¥é¨ï¼ææææå­¦ï¼æ°æä¹è½ä¸æ¬¡ä¸æ</span></span></h2>
<p><span><span>è¯´äºè¿ä¹å¤ï¼ç¸ä¿¡å¤§å®¶å·²ç»å¯¹Sa-Tokenåæ»¡äºæå¾ãæ¥ä¸æ¥ï¼æå°±å¸¦çå¤§å®¶æææå¥é¨Sa-Tokenï¼å¨ç¨è´´åçå®å¼ååºæ¯ï¼ä¸æè±éè¡å¨çæä½ï¼ä¸è®²æ¦æ¶©é¾æçæ¦å¿µï¼æ¯ä¸æ­¥é½ç®åææï¼æ°æä¹è½ä¸æ¬¡ä¸æãï¼æ¬æ¬¡å¥é¨åºäºSpringBoot 2.x/3.xï¼è¿ä¹æ¯ç®åæä¸»æµçå¼åç¯å¢ï¼ééç»å¤§å¤æ°é¡¹ç®ï¼</span></span></p>
<h3><span><span>ç¬¬ä¸æ­¥ï¼ç¯å¢åå¤ï¼30ç§æå®ä¾èµ</span></span></h3>
<p><span><span>Sa-Tokençéæéå¸¸ç®åï¼ä¸ç¨éç½®å¤æçç¯å¢ï¼åªè¦ä½ çé¡¹ç®æ¯SpringBooté¡¹ç®ï¼åªéå¨pom.xmlä¸­æ·»å ä¸è¡ä¾èµï¼å°±è½å®æéæââè¿ä¹æ¯Sa-Tokenâå¼ç®±å³ç¨âçä½ç°ã</span></span></p>
<p><span><span>é¦åï¼ç¡®ä¿ä½ çé¡¹ç®æ¯SpringBooté¡¹ç®ï¼å¦æä¸æ¯ï¼åå»ºä¸ä¸ªåºç¡çSpringBooté¡¹ç®å³å¯ï¼å¾éWebä¾èµï¼ï¼ç¶åå¨pom.xmlä¸­æ·»å ä»¥ä¸ä¾èµï¼</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">dependency</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
    <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">groupId</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>cn.dev33<span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">groupId</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
    <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">artifactId</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>sa-token-spring-boot-starter<span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">artifactId</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>
    <span style="color: rgba(0, 0, 255, 1)">&lt;</span><span style="color: rgba(128, 0, 0, 1)">version</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span>1.44.0<span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">version</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span> <span style="color: rgba(0, 128, 0, 1)">&lt;!--</span><span style="color: rgba(0, 128, 0, 1)"> çæ¬å·å¯èªè¡æ´æ°å°ææ° </span><span style="color: rgba(0, 128, 0, 1)">--&gt;</span>
<span style="color: rgba(0, 0, 255, 1)">&lt;/</span><span style="color: rgba(128, 0, 0, 1)">dependency</span><span style="color: rgba(0, 0, 255, 1)">&gt;</span></pre>
</div>
<p><span><span>æ·»å å®ä¾èµåï¼å·æ°Mavenï¼ä¾èµå°±ä¼èªå¨ä¸è½½å®æãè¿éä¸éè¦ä»»ä½é¢å¤çéç½®ï¼Sa-Tokenä¼èªå¨è¿è¡é¶éç½®åå§åï¼åªæä½ ä»ä¹é½ä¸åï¼ä¹è½æ­£å¸¸ä½¿ç¨æ ¸å¿åè½ââè¿ä¸ç¹ï¼æ¯Spring SecurityåShiroç®åå¤ªå¤ã</span></span></p>
<p><span><span>è¡¥åè¯´æï¼å¦æä½ çé¡¹ç®éè¦åå¸å¼ä¼è¯ï¼æ¯å¦å¾®æå¡é¡¹ç®ï¼ï¼å¯ä»¥é¢å¤éæRedisä¾èµï¼Sa-Tokenä¼èªå¨ééï¼ä¸ç¨æå¨éç½®ï¼å¦ææ¯åä½é¡¹ç®ï¼ä¸ç¨éæRedisï¼Sa-Tokenä¼ä½¿ç¨åå­å­å¨ä¼è¯ï¼è¶³å¤æ»¡è¶³æ¥å¸¸å¼åéæ±ã</span></span></p>
<h3><span><span>ç¬¬äºæ­¥ï¼æ ¸å¿APIä¸æï¼5åéæå®ç»å½ãææ</span></span></h3>
<p><span><span>Sa-Tokençæ ¸å¿APIéå¸¸ç®æ´ï¼ææå¸¸ç¨æä½é½å°è£å¨StpUtilå·¥å·ç±»ä¸­ï¼ä¸ç¨ä½ è®°å¤æçç±»åãæ¹æ³åï¼åªè¦è®°ä½å ä¸ªæ ¸å¿æ¹æ³ï¼å°±è½æå®80%çé´æéæ±ãä¸é¢ï¼æä»¬å°±ç»åæå¸¸è§çâç»å½è®¤è¯âåâæéæ§å¶âï¼ææææå¤§å®¶ä½¿ç¨ã</span></span></p>
<h4><span><span>1. ç»å½è®¤è¯ï¼ä¸è¡ä»£ç æå®ï¼ä¸ç¨ä»»ä½éç½®</span></span></h4>
<p><span><span>ç»å½è®¤è¯æ¯é´æçåºç¡ï¼æ è®ºæ¯åå°ç®¡çç³»ç»ï¼è¿æ¯å°ç¨åºãAPPæ¥å£ï¼é½ç¦»ä¸å¼ç»å½è®¤è¯ãå¨Sa-Tokenä¸­ï¼ç»å½è®¤è¯åªéä¸¤è¡ä»£ç ï¼ä¸è¡æ è®°ç»å½ï¼ä¸è¡æ ¡éªç»å½ã</span></span></p>
<p><span><span>é¦åï¼åå»ºä¸ä¸ªæµè¯Controllerï¼ç¼åç»å½æ¥å£ï¼</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> cn.dev33.satoken.stp.StpUtil;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> org.springframework.web.bind.annotation.GetMapping;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> org.springframework.web.bind.annotation.RestController;

@RestController
</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> LoginController {

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ç»å½æ¥å£ï¼æ¨¡æç¨æ·ç»å½ï¼å®éå¼åä¸­éæ¿æ¢ä¸ºæ°æ®åºæ¥è¯¢é»è¾</span>
    @GetMapping("/login"<span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> String login(String username, String password) {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 1. æ¨¡ææ°æ®åºæ ¡éªï¼å®éå¼åä¸­ï¼è¿ééè¦æ¥è¯¢æ°æ®åºï¼æ¯å¯¹ç¨æ·åå¯ç ï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> ("admin".equals(username) &amp;&amp; "123456"<span style="color: rgba(0, 0, 0, 1)">.equals(password)) {
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 2. ä¸è¡ä»£ç æ è®°å½åä¼è¯ç»å½ï¼åæ°ä¸ºç¨æ·IDï¼å¯ä»¥æ¯æ°å­ãå­ç¬¦ä¸²ç­ä»»æç±»åï¼</span>
            StpUtil.setLoginId(10001); <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è¿éç10001ï¼å°±æ¯å½åç»å½ç¨æ·çå¯ä¸æ è¯</span>
            <span style="color: rgba(0, 0, 255, 1)">return</span> "ç»å½æåï¼æ¬¢è¿åæ¥ï¼admin"<span style="color: rgba(0, 0, 0, 1)">;
        }
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> "ç¨æ·åæå¯ç éè¯¯ï¼"<span style="color: rgba(0, 0, 0, 1)">;
    }

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ ¡éªç»å½æ¥å£ï¼åªæç»å½åæè½è®¿é®</span>
    @GetMapping("/info"<span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> String getInfo() {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 1. ä¸è¡ä»£ç æ ¡éªå½åä¼è¯æ¯å¦ç»å½ï¼æªç»å½ä¼æåºNotLoginExceptionå¼å¸¸</span>
<span style="color: rgba(0, 0, 0, 1)">        StpUtil.checkLogin();
        
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 2. è·åå½åç»å½ç¨æ·IDï¼ä¸ç»å½æ¶ä¼ å¥çIDä¸è´ï¼</span>
        Object loginId =<span style="color: rgba(0, 0, 0, 1)"> StpUtil.getLoginId();
        
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 3. è¿åç¨æ·ä¿¡æ¯ï¼å®éå¼åä¸­ï¼è¿ééè¦æ ¹æ®loginIdæ¥è¯¢æ°æ®åºï¼è¿åçå®ç¨æ·ä¿¡æ¯ï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">return</span> "ç»å½æåï¼å½åç»å½ç¨æ·IDï¼" + loginId + "ï¼ç¨æ·è§è²ï¼è¶çº§ç®¡çå"<span style="color: rgba(0, 0, 0, 1)">;
    }

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éåºç»å½æ¥å£</span>
    @GetMapping("/logout"<span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> String logout() {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 1. ä¸è¡ä»£ç æ è®°å½åä¼è¯éåºç»å½</span>
<span style="color: rgba(0, 0, 0, 1)">        StpUtil.logout();
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> "éåºç»å½æåï¼æ¬¢è¿ä¸æ¬¡åæ¥"<span style="color: rgba(0, 0, 0, 1)">;
    }
}</span></pre>
</div>
<p><span><span>åå°è¿éï¼å¾å¤æåå¯è½ä¼æçé®ï¼ä¸ç¨éç½®è¿æ»¤å¨åï¼ä¸ç¨èªå®ä¹Realmåï¼ä¸ç¨å¤çTokenä¼ éåï¼</span></span></p>
<p><span><span>ç­æ¡æ¯ï¼ä¸ç¨ï¼Sa-Tokenå·²ç»å¸®ä½ å¨é¨å¤çå¥½äºãå½ä½ è°ç¨StpUtil.setLoginId(10001)æ¶ï¼Sa-Tokenä¼èªå¨çæä¸ä¸ªTokenï¼å¹¶å­å¥ä¼è¯ï¼å½ä½ è®¿é®éè¦æ ¡éªç»å½çæ¥å£æ¶ï¼Sa-Tokenä¼èªå¨ä»è¯·æ±å¤´ãCookieä¸­è¯»åTokenï¼æ ¡éªä¼è¯ç¶æââä½ ä¸ç¨åä¸è¡é¢å¤çéç½®ï¼ä¸ç¨å¤çä»»ä½ç»èï¼åªç¨å³æ³¨èªå·±çä¸å¡é»è¾å³å¯ã</span></span></p>
<p><span><span>æµè¯æ¹æ³ä¹å¾ç®åï¼å¯å¨é¡¹ç®åï¼ç¨Postmanææµè§å¨è®¿é®æ¥å£ï¼</span></span></p>
<ol class="list-paddingleft-1">
<li>
<p><span><span>è®¿é®&nbsp;<span><span>http://localhost:8080/login?username=admin&amp;password=123456<span><span>&nbsp;ï¼è¿åâç»å½æåâï¼</span></span></span></span></span></span></p>
</li>
<li>
<p><span><span>è®¿é®&nbsp;<span><span>http://localhost:8080/info<span><span>&nbsp;ï¼è¿åç»å½ç¨æ·ä¿¡æ¯ï¼è¯´ææ ¡éªæåï¼ï¼</span></span></span></span></span></span></p>
</li>
<li>
<p><span><span>è®¿é®&nbsp;<span><span>http://localhost:8080/logout<span><span>&nbsp;ï¼è¿åâéåºç»å½æåâï¼</span></span></span></span></span></span></p>
</li>
<li>
<p><span><span>éåºååè®¿é®&nbsp;<span><span>http://localhost:8080/info<span><span>&nbsp;ï¼ä¼æåºæªç»å½å¼å¸¸ï¼è¯´ææ ¡éªçæï¼ã</span></span></span></span></span></span></p>
</li>
</ol>
<h4><span><span>2. æéæ§å¶ï¼ä¸ä¸ªæ³¨è§£æå®ï¼ä¼éåé«æ</span></span></h4>
<p><span><span>ç»å½è®¤è¯æå®åï¼æ¥ä¸æ¥å°±æ¯æéæ§å¶ââæ¯å¦ï¼æ®éç¨æ·ä¸è½è®¿é®åå°ç®¡çæ¥å£ï¼åªæè¶çº§ç®¡çåæè½æ§è¡å é¤æä½ãå¨Sa-Tokenä¸­ï¼æéæ§å¶ä¸ç¨åå¤æçé»è¾å¤æ­ï¼ä¸ä¸ªæ³¨è§£å°±è½æå®ã</span></span></p>
<p><span><span>é¦åï¼æä»¬éè¦åè¯Sa-Tokenï¼å½åç»å½ç¨æ·æ¥æåªäºè§è²ãåªäºæéãè¿ééè¦å®ç°Sa-Tokenæä¾çStpInterfaceæ¥å£ï¼éåä¸¤ä¸ªæ¹æ³ï¼è·åè§è²ãè·åæéï¼ï¼</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> cn.dev33.satoken.stp.StpInterface;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> org.springframework.stereotype.Component;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> java.util.ArrayList;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> java.util.List;

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¿é¡»å ä¸@Componentæ³¨è§£ï¼è®©Springæ«æå°ï¼Sa-Tokenä¼èªå¨è°ç¨</span>
<span style="color: rgba(0, 0, 0, 1)">@Component
</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span> StpInterfaceImpl <span style="color: rgba(0, 0, 255, 1)">implements</span><span style="color: rgba(0, 0, 0, 1)"> StpInterface {

    </span><span style="color: rgba(0, 128, 0, 1)">/**</span><span style="color: rgba(0, 128, 0, 1)">
     * è¿åå½åç»å½ç¨æ·æ¥æçè§è²ï¼æéä¸è§è²å¯åç¬ä½¿ç¨ï¼ä¹å¯ç»åä½¿ç¨ï¼
     * </span><span style="color: rgba(128, 128, 128, 1)">@param</span><span style="color: rgba(0, 128, 0, 1)"> loginId å½åç»å½ç¨æ·ID
     * </span><span style="color: rgba(128, 128, 128, 1)">@param</span><span style="color: rgba(0, 128, 0, 1)"> loginType ç»å½ç±»åï¼é»è®¤å¼ï¼loginï¼å¤è´¦å·ä½ç³»æ¶ä¼ç¨å°ï¼
     * </span><span style="color: rgba(128, 128, 128, 1)">@return</span><span style="color: rgba(0, 128, 0, 1)"> è§è²åè¡¨ï¼æ¯å¦ï¼["super-admin", "admin"]ï¼
     </span><span style="color: rgba(0, 128, 0, 1)">*/</span><span style="color: rgba(0, 0, 0, 1)">
    @Override
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> List&lt;String&gt;<span style="color: rgba(0, 0, 0, 1)"> getRoleList(Object loginId, String loginType) {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å®éå¼åä¸­ï¼è¿ééè¦æ ¹æ®loginIdæ¥è¯¢æ°æ®åºï¼è·åè¯¥ç¨æ·çè§è²åè¡¨
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è¿éæ¨¡æï¼ç¨æ·ID=10001æ¥æè¶çº§ç®¡çåè§è²ï¼super-adminï¼</span>
        List&amp;lt;String&amp;gt; roleList = <span style="color: rgba(0, 0, 255, 1)">new</span> ArrayList&lt;&gt;<span style="color: rgba(0, 0, 0, 1)">();
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (loginId.equals(10001<span style="color: rgba(0, 0, 0, 1)">)) {
            roleList.add(</span>"super-admin"<span style="color: rgba(0, 0, 0, 1)">);
        }
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> roleList;
    }

    </span><span style="color: rgba(0, 128, 0, 1)">/**</span><span style="color: rgba(0, 128, 0, 1)">
     * è¿åå½åç»å½ç¨æ·æ¥æçæé
     * </span><span style="color: rgba(128, 128, 128, 1)">@param</span><span style="color: rgba(0, 128, 0, 1)"> loginId å½åç»å½ç¨æ·ID
     * </span><span style="color: rgba(128, 128, 128, 1)">@param</span><span style="color: rgba(0, 128, 0, 1)"> loginType ç»å½ç±»å
     * </span><span style="color: rgba(128, 128, 128, 1)">@return</span><span style="color: rgba(0, 128, 0, 1)"> æéåè¡¨ï¼æ¯å¦ï¼["user:add", "user:delete"]ï¼
     </span><span style="color: rgba(0, 128, 0, 1)">*/</span><span style="color: rgba(0, 0, 0, 1)">
    @Override
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> List&lt;String&gt;<span style="color: rgba(0, 0, 0, 1)"> getPermissionList(Object loginId, String loginType) {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å®éå¼åä¸­ï¼è¿ééè¦æ ¹æ®loginIdæ¥è¯¢æ°æ®åºï¼è·åè¯¥ç¨æ·çæéåè¡¨
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è¿éæ¨¡æï¼ç¨æ·ID=10001æ¥æç¨æ·æ·»å ãå é¤ãæ¥è¯¢çæé</span>
        List&amp;lt;String&amp;gt; permissionList = <span style="color: rgba(0, 0, 255, 1)">new</span> ArrayList&lt;&gt;<span style="color: rgba(0, 0, 0, 1)">();
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (loginId.equals(10001<span style="color: rgba(0, 0, 0, 1)">)) {
            permissionList.add(</span>"user:add"<span style="color: rgba(0, 0, 0, 1)">);
            permissionList.add(</span>"user:delete"<span style="color: rgba(0, 0, 0, 1)">);
            permissionList.add(</span>"user:select"<span style="color: rgba(0, 0, 0, 1)">);
        }
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> permissionList;
    }
}</span></pre>
</div>
<p><span><span>å®ç°å®æ¥å£åï¼æä»¬å°±å¯ä»¥å¨Controllerä¸­ä½¿ç¨æ³¨è§£è¿è¡æéæ§å¶äºï¼å¸¸ç¨çæ³¨è§£æä¸ä¸ªï¼</span></span></p>
<ul class="list-paddingleft-1">
<li>
<p><span><span>@SaCheckLoginï¼æ ¡éªå½åä¼è¯æ¯å¦ç»å½ï¼åStpUtil.checkLogin()åè½ä¸è´ï¼ï¼</span></span></p>
</li>
<li>
<p><span><span>@SaCheckRole("è§è²æ è¯")ï¼æ ¡éªå½åç¨æ·æ¯å¦æ¥ææå®è§è²ï¼</span></span></p>
</li>
<li>
<p><span><span>@SaCheckPermission("æéæ è¯")ï¼æ ¡éªå½åç¨æ·æ¯å¦æ¥ææå®æéã</span></span></p>
</li>
</ul>
<p><span><span>ä¸é¢ï¼æä»¬ç¼åä¸ä¸ªæéæ§å¶çæµè¯æ¥å£ï¼</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> cn.dev33.satoken.annotation.SaCheckPermission;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> cn.dev33.satoken.annotation.SaCheckRole;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> org.springframework.web.bind.annotation.GetMapping;
</span><span style="color: rgba(0, 0, 255, 1)">import</span><span style="color: rgba(0, 0, 0, 1)"> org.springframework.web.bind.annotation.RestController;

@RestController
</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> PermissionController {

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 1. æ ¡éªè§è²ï¼åªææ¥æsuper-adminè§è²çç¨æ·æè½è®¿é®</span>
    @SaCheckRole("super-admin"<span style="color: rgba(0, 0, 0, 1)">)
    @GetMapping(</span>"/admin/manager"<span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> String adminManager() {
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> "è¶çº§ç®¡çåä¸å±æ¥å£ï¼å¯ä»¥ç®¡çææç¨æ·"<span style="color: rgba(0, 0, 0, 1)">;
    }

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 2. æ ¡éªæéï¼åªææ¥æuser:deleteæéçç¨æ·æè½è®¿é®</span>
    @SaCheckPermission("user:delete"<span style="color: rgba(0, 0, 0, 1)">)
    @GetMapping(</span>"/user/delete"<span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> String deleteUser() {
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> "æéæ ¡éªéè¿ï¼å¯ä»¥æ§è¡ç¨æ·å é¤æä½"<span style="color: rgba(0, 0, 0, 1)">;
    }

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 3. å¤éæ ¡éªï¼æ¥æsuper-adminè§è² æ user:addæéçç¨æ·æè½è®¿é®</span>
    @SaCheckRole(value = "super-admin", mode =<span style="color: rgba(0, 0, 0, 1)"> SaMode.OR)
    @SaCheckPermission(value </span>= "user:add", mode =<span style="color: rgba(0, 0, 0, 1)"> SaMode.OR)
    @GetMapping(</span>"/user/add"<span style="color: rgba(0, 0, 0, 1)">)
    </span><span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> String addUser() {
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> "æ ¡éªéè¿ï¼å¯ä»¥æ§è¡ç¨æ·æ·»å æä½"<span style="color: rgba(0, 0, 0, 1)">;
    }
}</span></pre>
</div>
<p><span><span>æµè¯æ¹æ³ï¼ç»å½æååï¼ç¨æ·ID=10001ï¼æ¥æsuper-adminè§è²åå¯¹åºçæéï¼ï¼è®¿é®ä»¥ä¸ä¸ä¸ªæ¥å£ï¼é½ä¼è¿åæåä¿¡æ¯ï¼å¦ææä»¬æ¨¡æä¸ä¸ªæ®éç¨æ·ï¼æ²¡æsuper-adminè§è²ãæ²¡æuser:deleteæéï¼ç»å½ï¼è®¿é®è¿äºæ¥å£ï¼å°±ä¼æåºæéä¸è¶³çå¼å¸¸ââè¿å°±æ¯Sa-Tokenæ³¨è§£å¼é´æçé­åï¼ä¼éãç®æ´ï¼ä¸æäºç»´æ¤ã</span></span></p>
<h3><span><span>ç¬¬ä¸æ­¥ï¼å¸¸ç¨åè½è¡¥åï¼æå®å¼åä¸­é«é¢åºæ¯</span></span></h3>
<p><span><span>é¤äºç»å½è®¤è¯åæéæ§å¶ï¼å¼åä¸­è¿æå¾å¤é«é¢çé´æåºæ¯ï¼æ¯å¦è¸¢äººä¸çº¿ãTokenç»­æãåç«¯äºæ¥ç»å½ç­ãè¿äºåè½å¨Sa-Tokenä¸­ï¼ä¹é½æ¯ä¸è¡ä»£ç å°±è½æå®ï¼ä¸é¢ç»å¤§å®¶è¡¥åå ä¸ªæå¸¸ç¨çï¼</span></span></p>
<h4><span><span>1. è¸¢äººä¸çº¿ï¼å¼ºå¶æ³¨éï¼</span></span></h4>
<p><span><span>åºæ¯ï¼åå°ç®¡çç³»ç»ä¸­ï¼ç®¡çååç°æä¸ªç¨æ·å¼å¸¸ç»å½ï¼éè¦å¼ºå¶è®©è¯¥ç¨æ·éåºç»å½ã</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä¸è¡ä»£ç ï¼å¼ºå¶è®©ç¨æ·ID=10002çææä¼è¯éåºç»å½ï¼è¸¢äººä¸çº¿ï¼
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è¯¥ç¨æ·ä¸æ¬¡è®¿é®ä»»ä½éè¦ç»å½çæ¥å£æ¶ï¼é½ä¼æåºæªç»å½å¼å¸¸</span>
StpUtil.logoutByLoginId(10002);</pre>
</div>
<h4><span><span>2. åç«¯äºæ¥ç»å½</span></span></h4>
<p><span><span>åºæ¯ï¼å°ç¨åºä¸­ï¼ä¸ä¸ªè´¦å·åªè½å¨ä¸ä¸ªææºä¸ç»å½ï¼ç»å½æ°ææºåï¼æ§ææºä¼èªå¨éåºç»å½ï¼ç±»ä¼¼QQçåç«¯äºæ¥ï¼ã</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä¸è¡ä»£ç ï¼æå®è®¾å¤æ è¯ç»å½ï¼åæ°2ä¸ºè®¾å¤æ è¯ï¼æ¯å¦PCãAPPãWECHATï¼</span>
StpUtil.setLoginId(10001, "WECHAT"); <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¾®ä¿¡å°ç¨åºç«¯ç»å½

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä¸è¡ä»£ç ï¼å¼ºå¶è®©ç¨æ·ID=10001å¨WECHATç«¯çæ§ä¼è¯éåºç»å½</span>
StpUtil.logoutByLoginId(10001, "WECHAT");</pre>
</div>
<h4><span><span>3. Tokenèªå¨ç»­æ</span></span></h4>
<p><span><span>åºæ¯ï¼ç¨æ·é¿æ¶é´æä½ç³»ç»ï¼Tokenè¿æåä¸éè¦éæ°ç»å½ï¼èªå¨ç»­æã</span></span></p>
<p><span><span>Sa-Tokené»è®¤æ¯æTokenèªå¨ç»­æï¼åªéå¨application.ymlä¸­æ·»å ç®åéç½®å³å¯ï¼</span></span></p>
<div class="cnblogs_code">
<pre>sa-<span style="color: rgba(0, 0, 0, 1)">token:
  timeout: </span><span style="color: rgba(128, 0, 128, 1)">86400</span><span style="color: rgba(0, 0, 0, 1)"> # Tokenæææï¼ç§ï¼ï¼é»è®¤24å°æ¶
  active</span>-timeout: <span style="color: rgba(128, 0, 128, 1)">3600</span><span style="color: rgba(0, 0, 0, 1)"> #  Tokenæ´»è·æææï¼ç§ï¼ï¼é»è®¤1å°æ¶
  # è¯´æï¼å¦æç¨æ·å¨1å°æ¶åææä½ï¼Tokenèªå¨ç»­æ24å°æ¶ï¼å¦æ1å°æ¶åæ æä½ï¼Tokenè¿æ</span></pre>
</div>
<p><span><span>ä»¥ä¸å°±æ¯Sa-Tokençæ ¸å¿å¥é¨åå®¹ï¼å¶å®è¿æå¾å¤å¼ºå¤§çåè½ï¼æ¯å¦åç¹ç»å½ãOAuth2.0ãå¯ç å å¯ç­ï¼ï¼ä½å¯¹äºå¤§å¤æ°å¼åèæ¥è¯´ï¼ææ¡ä¸é¢çåå®¹ï¼å·²ç»è½æå®æ¥å¸¸å¼åä¸­90%ä»¥ä¸çé´æéæ±äºãèä¸è¿äºåè½çä½¿ç¨æ¹å¼é½éå¸¸ç®åï¼åªè¦è®°ä½StpUtilå·¥å·ç±»ï¼å°±è½çµæ´»è¿ç¨ã</span></span></p>
<h2><span><span>æåï¼è´æ¯ä¸ä½æ­£å¨åé´æåèçJavaå¼åè</span></span></h2>
<p><span><span>10å¹´çå¼åä¹è·¯ï¼æè§è¿å¤ªå¤å¼åèå ä¸ºå¤æçé´ææ¡æ¶ï¼æ¶èäºå¤§éçæ¶é´åç²¾åï¼çè³ç£¨ç­äºå¯¹å¼åçç­æãæä»¬åå¼åï¼æ¬è¯¥æ¯ä¸æ³¨äºä¸å¡é»è¾ãæé æä»·å¼çäº§åï¼èä¸æ¯è¢«ç¹ççé´æä»£ç æç¼æèã</span></span></p>
<p><span><span>Sa-Tokençåºç°ï¼ä¸æ¯ä¸ºäºåä»£ä»»ä½ä¸æ¬¾æ¡æ¶ï¼èæ¯ä¸ºäºç»å¤§å®¶å¤ä¸ä¸ªéæ©ââä¸ä¸ªç®åãé«æãæç¨çéæ©ãå®ä¸è¦æ±ä½ ç²¾éå¤æçæ¶æè®¾è®¡ï¼ä¸è¦æ±ä½ æ¥æå¤å¹´çå¼åç»éªï¼åªè¦ä½ ä¼åç®åçJavaä»£ç ï¼å°±è½ç¨å®æå®ææé´æé¾é¢ã</span></span></p>
<p><span><span>æè¿è®°å¾ï¼ç¬¬ä¸æ¬¡ç¨Sa-Tokençæ¶åï¼é£ç§âè±ç¶å¼æâçæè§ââä»¥åè±ä¸å¤©æè½æå®çç»å½ãæéé»è¾ï¼ç¨Sa-Tokenåªç¨äºåå åéï¼ä»¥ååå¤è°è¯çè·¨åãTokenè¿æé®é¢ï¼ç¨Sa-Tokenååä¹æ²¡æåºç°è¿ãä»é£ä»¥åï¼æææçé¡¹ç®ï¼æ è®ºæ¯ä¸­å°ååä½é¡¹ç®ï¼è¿æ¯å¤§åå¾®æå¡é¡¹ç®ï¼é½ä¼ä¼åéæ©Sa-Tokenã</span></span></p>
<p><span><span>ä»å¤©ï¼ææSa-Tokenæ¨èç»å¤§å®¶ï¼ä¸æ¯å ä¸ºå®æå¤âå®ç¾âï¼èæ¯å ä¸ºå®æä½ ççç¹ï¼è½å¸®ä½ èçæ¶é´ï¼è½è®©ä½ ä»é´æåèä¸­è§£è±åºæ¥ï¼ææ´å¤çç²¾åæ¾å¨èªå·±çæ­£æ³åçäºæä¸ã</span></span></p>
<p><span><span>å¦æä½ è¿å¨ä¸ºSpring Securityçå¤æéç½®å¤´ç¼ï¼è¿å¨ä¸ºShiroçééé®é¢ç¬å¤ï¼ä¸å¦¨è¯è¯Sa-Tokenãç¸ä¿¡æï¼å®ä¼ç»ä½ å¸¦æ¥æåââåæ¥é´æå¯ä»¥è¿ä¹ç®åï¼åæ¥å¼åå¯ä»¥è¿ä¹è½»æ¾ã</span></span></p>
<p><span><span>åç»­ï¼æè¿ä¼åäº«Sa-Tokençé«çº§ç¨æ³ï¼åç¹ç»å½ãOAuth2.0ãå¾®æå¡é´æç­ï¼ï¼å¦æå¤§å®¶æä»»ä½çé®ï¼ä¹å¯ä»¥å¨è¯è®ºåºçè¨ï¼æä¼ä¸ä¸ä¸ºå¤§å®¶è§£ç­ã</span></span></p>
<p><span><span>æ¿æ¯ä¸ä½Javaå¼åèï¼é½è½æè±é´æåèï¼ä¸æ³¨ä¸å¡ï¼ä¸è´ç­ç±ï¼å¨å¼åçéè·¯ä¸è¶èµ°è¶è¿ã</span></span></p>
<hr>
<p><span style="background-color: rgba(0, 204, 255, 1); font-size: 18px">å¯ä»¥ç¹å»ä¸é¢é¾æ¥ã<a title="Sa-Token(ä¸)ä¹ç®ä»åå¥é¨ï¼åå«é´æåèï¼è®©æ¯ä¸ä½Javaå¼åèé½è½è½»æ¾ä¸æ" href="https://mp.weixin.qq.com/s/JLQSMAgqK1U0vtrdtRsKlA" target="_blank" rel="noopener nofollow"><span style="background-color: rgba(0, 204, 255, 1)">éè¯»åæ</span></a>ã</span></p>
<p><span style="font-size: 18px"><a href="https://mp.weixin.qq.com/s/JLQSMAgqK1U0vtrdtRsKlA" rel="noopener nofollow">Sa-Token(ä¸)ä¹ç®ä»åå¥é¨ï¼åå«é´æåèï¼è®©æ¯ä¸ä½Javaå¼åèé½è½è½»æ¾ä¸æ</a><a class="ng-star-inserted" href="https://www.cnblogs.com/philry/p/19534679" rel="noopener" target="_blank"><br></a></span></p>
<p>&nbsp;</p>
<p><em><strong><span style="font-size: 18px">åä½ä¸æï¼<span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">è¿è¯·å®¶äººä»¬å³æ³¨ä¸å¬ä¼ä¸æ¯æï¼å°ç¼ä¸èææ¿ã</span></span></strong></em></p>
<p><span style="background-color: rgba(0, 204, 255, 1); font-size: 18px"><strong>æ´å¤ç²¾å½©å³æ³¨å¾®ä¿¡å¬ä¼å·ï¼</strong></span></p>
<p><span style="background-color: rgba(0, 204, 255, 1); font-size: 18px"><strong>AIå¤§èæ2.0</strong></span></p>
<p><span style="font-size: 18px"><strong><strong>10å¹´ææ¯äººï¼3å¹´AI+7å¹´javaå¼åèçææ¯æ²æ·åäººçææã</strong></strong></span></p>
<p><img alt="å¾®ä¿¡å¬ä¼å·äºç»´ç " width="374" height="374" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2337379/202602/2337379-20260207153517915-1692678270.jpg" class="lazyload"><img alt="ç¾¤äºç»´ç " width="374" height="523" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2337379/202602/2337379-20260211082236832-1162447884.jpg" class="lazyload"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-11 09:59">2026-02-11 09:58</span>&nbsp;
<a href="https://www.cnblogs.com/philry">AIå¤§èæ2ç¹0</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19602802);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19602802', targetLink: 'https://www.cnblogs.com/philry/p/19602802', title: 'Sa-Token(ä¸)ä¹ç®ä»åå¥é¨ï¼åå«é´æåèï¼è®©æ¯ä¸ä½Javaå¼åèé½è½è½»æ¾ä¸æ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãè¯ãVisual Studio ä¸ææ´æ° ââ å¢å¼ºçç¼è¾å¨ä½éª ]]></title>
    <link>https://www.cnblogs.com/MeteorSeed/p/19600128</link>
    <guid>7426dda5fb2813778b1c3c653032f51f</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/MeteorSeed/p/19600128" title="åå¸äº 2026-02-11 09:56">
    <span role="heading" aria-level="2">ãè¯ãVisual Studio ä¸ææ´æ° ââ å¢å¼ºçç¼è¾å¨ä½éª</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1 data-pm-slice="2 2 []"><span><span>çäº§åæå</span></span></h1>
<p><span>ããæ¬æï¼æä»¬ä¸ºæ¨å¸¦æ¥äºä¸ç³»åè½å°ä½é¿æä»¥æ¥å¤åæå¾ä¸å¹¿åæ¬¢è¿çåè½ï¼è®©æ¨è½æ´å¥½å°æ§å¶åèªå®ä¹æ¨çç¼è¾å¨ãè¿äºåè½ç®åä»å¨ Insiders å¯ç¨ï¼å¾å¿«å°å¨æ­£å¼çä¸­æ¨åºã</span></p>
<p><span><span>ãã<strong>- å¿«éæ»å¨</strong>ï¼å¨æ¥çä»£ç æéè¯»ææ¡£æ¶ï¼æä½ Alt é®åæ¶æ»å¨é¼ æ æ»è½®å¯å¿«éç§»å¨ãæ¨å¯ä»¥å¨ Tools &gt; Options &gt; Text Editor &gt; Advanced &gt; Touchpad and mouse wheel scrolling sensitivity ä¸­è°æ´å¿«éæ»å¨éåº¦ã</span></span></p>
<p><span><span>ãã<strong>- ä¸­é®æ»å¨</strong>ï¼æä¸æ»è½®å¹¶ç§»å¨é¼ æ ï¼å¯å¿«éæ»å¨æµè§ææ¡£ï¼ä¾¿äºæ¥çå¤§åæä»¶ãæ­¤åè½é»è®¤å¤äºå³é­ç¶æï¼éè¦éè¿ Tools &gt; Options &gt; Text Editor &gt; Advanced &gt; Middle click to scroll æ¥å¯ç¨ã</span></span></p>
<p><span><span>ãã<strong>- å¯ HTML æ ¼å¼çå¤å¶ç²è´´</strong>ï¼Visual Studio ç°å¨æ¯æå¨ä»ç¼è¾å¨ä¸­åªåæå¤å¶ä»£ç æ¶ä½¿ç¨ HTML åªè´´æ¿æ ¼å¼ãæ¨å¯ä»¥å°å¸¦æé¢è²çä»£ç ç²è´´å° Office çç½é¡µçãAzure DevOps å·¥ä½é¡¹æå¶ä»åºäº HTML çæ§ä»¶ä¸­ãæ­¤åè½å¨ææ°ç Insiders çæ¬ä¸­å¯ç¨ï¼ä¸ä¹åå°å¨ Release åå¸ã</span></span></p>
<p><span><span>ãã<strong>- è¯­æ³è¡åç¼©</strong>ï¼ä¸åå«å­æ¯ææ°å­çè¡å°è¢«åç¼© 25%ï¼è®©æ¨å¯ä»¥ä¸æ¬¡æ¥çæ´å¤ä»£ç ãå¸¸è§è¡ä¿æåé«åº¦ä¸åãæ¨å¯ä»¥éè¿ä¾æ¬¡ç¹å» Tools &gt; Options &gt; Text Editor &gt; Advancedï¼å¾é Compress blank lines å Compress lines that do not have any alphanumeric characters æ¥å¯ç¨æ­¤åè½ã</span></span></p>
<p><span><span>ãã<strong>- æ´çªçå·¦ä¾§è¾¹è·</strong>ï¼æä»¬å¬è¯´æ¨å¸æå·¦ä¾§è¾¹è·æ´çªä¸äºï¼ä»¥ä¾¿ä¸ºä»£ç çåºæ´å¤æ°´å¹³ç©ºé´ï¼ä¸ºäºèçé¢å¤çåå®½ï¼æä»¬å·²å°å¿«éæä½å¾æ ï¼ç¯æ³¡æèºä¸åå¾æ ï¼ä»è¾¹è·å¤ç§»å°äºç¼è¾å¨åï¼å½æä¿®å¤æéæå»ºè®®æ¶ï¼è¯¥å¾æ ä¼ä¸æ¨çä»£ç åèæ¾ç¤ºãè¦ç«å³ä½éªæ­¤åè½ï¼è¯·åå¾ Tools &gt; Options &gt; Text Editor &gt; Advancedï¼ç¶åå¾é Show Quick Actions icon inside the editorã</span></span></p>
<p><span>ããæä»¬è¿å°æ¨åºæ´å¤èªå®ä¹çè¾¹è·æ§å¶åè½ï¼æ¬è¯·æå¾ï¼</span></p>
<h1><span><span>å½©è²ä»£ç è¡¥å¨</span></span></h1>
<p><span>ããä»£ç è¡¥å¨ç°å¨éç¨è¯­æ³é«äº®è¿è¡çè²ï¼å¸®å©æ¨å¿«éåºåå»ºè®®ä»£ç ä¸­çåéãå½æ°åå¶ä»åç´ ï¼è¦ä½éªæ­¤åè½ï¼è¯·åå¾ Tools &gt; Options &gt; Text Editor &gt; Code Completionsï¼å¹¶å¾é Use colorized text for code completionsãè¯¥åè½ç®åä»å¨ Insiders ä¸­å¯ç¨ã</span></p>
<p><span>ããä¸ºäºåºåå»ºè®®åå®¹åå®éä»£ç ï¼å½©è²è¡¥å¨åè½éç¨äºè¾ä½çä¸éæåº¦åæä½æ ·å¼ãå¦ææ¨æ³è¿ä¸æ­¥èªå®ä¹å¤è§ï¼è¯·åå¾ Tools &gt; Options &gt; Environment &gt; Fonts and Colorsï¼ç¶åå¨ Display ä¸­éæ© Code Completionsãå¨é£éï¼æ¨å¯ä»¥èªå®ä¹å­ä½ãå¤§å°ãåæ¯è²/èæ¯è²ä»¥åæ ·å¼ï¼ç²ä½ãæä½ç­ï¼ã</span></p>
<h1><span><span>ç¹å»é¨åæ¥åä»£ç è¡¥å¨</span></span></h1>
<p><span>ããæ¨æ¯å¦æ¾ç»å¸æåªéä¸æ¬¡ç¹å»å°±è½é¨åæ¥åä»£ç è¡¥å¨ï¼æäºè¿é¡¹æ°åè½ï¼æ¨å¯ä»¥ç´æ¥ç¹å»å»ºè®®ä¸­çæå¤ï¼æ¥ååæ ä½ç½®ä¹åçåå®¹ãå½æ¨å°é¼ æ æ¬åå¨å»ºè®®ä¸æ¶ï¼æ¯ä¸ªçæ®µé½ä¼é«äº®æ¾ç¤ºï¼ç¡®åå°å±ç¤ºå°è¦æ¥åçåå®¹ãç®åï¼è¿é¡¹åè½ä»å¨ Insiders ä¸­å¯ç¨ã</span></p>
<p><span><img src="https://img2024.cnblogs.com/blog/270073/202602/270073-20260210153029546-909619206.gif" alt="1" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></span></p>
<p><span>ããæ­¤åè½è®©æ¨è½æ´å¥½å°æ§å¶æ³è¦æ¥åçè¡¥å¨åå®¹éãå¦ææ¨æ´åæ¬¢ä½¿ç¨é®çï¼ä»ç¶å¯ä»¥æ&nbsp;<span>Ctrl+å³ç®­å¤´&nbsp;ä¸æ¬¡æ¥åä¸ä¸ªåè¯ï¼ææ&nbsp;<span>Ctrl+ä¸ç®­å¤´&nbsp;ä¸æ¬¡æ¥åä¸è¡ã</span></span></span></p>
<h1><span><span>ç²¾ç®ç Markdown é¢è§æ§å¶</span></span></h1>
<p><span>ããVisual Studio Markdown ç¼è¾å¨ç°å¨ä¸ºæ¨æä¾æ´å¿«æ·ãæ´æ¸æ°çé¢è§éé¡¹è®¿é®æ¹å¼ï¼</span></p>
<p><span><span>ãã- å¨é¢è§æ¨¡å¼é´åæ¢ï¼Split Preview æ¨¡å¼ä¼å°ç¼è¾å¨åé¢è§çªå£å¹¶ææ¾ç¤ºï¼Open Preview æ¨¡å¼ä»æ¾ç¤ºé¢è§çªå£ï¼è Edit Markdown æ¨¡å¼ååªæ¾ç¤ºç¼è¾å¨ãPreview-only æ¨¡å¼è½å¸®å©æ¨ä¸æ³¨äºå·²æ¸²æçåå®¹ï¼å°¤å¶æ¯å¨æ¥çå¤§åå¾çæå¤æç Mermaid å¾è¡¨æ¶ã</span></span></p>
<p><span>ãã- é¢è§ Mermaid å¾è¡¨æ¶ï¼è¯·ä½¿ç¨å·¦ä¸è§çç¼©æ¾æ§ä»¶è¿è¡æ¾å¤§æç¼©å°ï¼ä»¥è·å¾æ´å¥½çå¯è¯»æ§ã</span></p>
<p><span>ãã- å½Copilot Chat çæ markdown åå®¹æ¶ï¼ç¹å»èå¤©çªå£å³ä¸è§ç Preview æé®å³å¯æ¥çæ¸²æåçè§å¾ãä¹åï¼æ¨å¯ä»¥ç´æ¥ç¼è¾å¹¶ä¿å­åå®¹ï¼æ éæå¨å¤å¶ç²è´´ã</span></p>
<p><span>ããæ³è¦ä½éªææè¿äºææ°çå¥½åè½ï¼è¯·å®ææ´æ°æ¨ç Visual Studioï¼å¦æè¿æ²¡æå å¥æä»¬ç Insiders é¢éï¼é£å°±èµ¶ç´§å å¥å§ï¼ï¼æ³¨æï¼æ¬åå®¢æç« ä¸­åäº«çææåè½ä»å¨ Visual Studio 2026 ä¸­å¯ç¨ãï¼è¯·è¯ç¨è¿äºåè½ï¼å¹¶åè¯æä»¬æ¨çä»»ä½åé¦ï¼ä»¥åæ¨æ¥ä¸æ¥å¸æçå°çåè½ï¼</span></p>
<p>&nbsp;</p>
<p><span>åæé¾æ¥ï¼https://devblogs.microsoft.com/visualstudio/visual-studio-january-update-enhanced-editor-experience/</span></p>
<p><span><img src="https://img2024.cnblogs.com/blog/270073/202509/270073-20250926105511928-738986494.webp" alt="me" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></span></p>
<p>&nbsp;</p>

</div>
<div id="MySignature" role="contentinfo">
    <blockquote>
<p><strong>ä½èï¼</strong><a href="http://www.cnblogs.com/MeteorSeed">MeteorSeed</a></p>
<p><strong>æå¸ææ¨åæ¬¢è¿ç¯åæï¼å¹¶ä¸å¦æ¢å¾å°æè°¢æ¨éè¯»å¹¶ä¸æåååäºåäº«æçåæã</strong></p>
<p><strong>è½¬è½½è¯·æ³¨æåºå¤ã</strong></p>
</blockquote>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-11 09:57">2026-02-11 09:56</span>&nbsp;
<a href="https://www.cnblogs.com/MeteorSeed">MeteorSeed</a>&nbsp;
éè¯»(<span id="post_view_count">17</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19600128);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19600128', targetLink: 'https://www.cnblogs.com/MeteorSeed/p/19600128', title: 'ãè¯ãVisual Studio ä¸ææ´æ° ââ å¢å¼ºçç¼è¾å¨ä½éª' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å¤§æ¨¡åRAGå®æï¼ä»è¢«éªä¸é è°±å°æä¸ºé¨é¨MVPï¼è¿æ¯æçè¸©åå¨è®°å½ ]]></title>
    <link>https://www.cnblogs.com/bu-huo/p/19601644</link>
    <guid>c6a244cb958faf2cb534de16af527b07</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/bu-huo/p/19601644" title="åå¸äº 2026-02-10 22:10">
    <span role="heading" aria-level="2">å¤§æ¨¡åRAGå®æï¼ä»è¢«éªä¸é è°±å°æä¸ºé¨é¨MVPï¼è¿æ¯æçè¸©åå¨è®°å½</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="ä¸åçèµ·ç¹æ¯ä¸é¡¿è­éª">ä¸åçèµ·ç¹æ¯ä¸é¡¿è­éª</h2>
<p>ä¸ä¸ªæï¼æè¢«é¢å¯¼å«è¿åå¬å®¤éªäºæ´æ´äºååéã</p>
<p>èµ·å æ¯è¿æ ·çââæä»¬é¨é¨è´è´£ç»´æ¤ä¸å¥åé¨ç¥è¯åºç³»ç»ï¼éé¢æ²æ·äºå¬å¸è¿äºå¹´çææ¯ææ¡£ãæéå¤çæåãè¿æåç§è§èæµç¨ãé®é¢æ¯ï¼è¿ç©æå¿é¤äºå½æè®¾ï¼å ä¹æ²¡äººç¨ãä¸ºå¥ï¼å ä¸ºæç´¢å¤ªçäºï¼å³é®è¯å¹éçé£ç§ï¼ä½ ææå¡å¨å®æºæä¹åï¼å®ç»ä½ è¿åä¸å åå«æå¡å¨çææ¡£ï¼çæ­£æç¨çé£ç¯åèæå¨ç¬¬ä¸é¡µã</p>
<p>æ°åäºå¥èé®é®é¢ï¼èåå·¥ç¿»ææ¡£æ¾ç­æ¡ï¼å¤§å®¶å®å¯å¨ç¾¤é@äººé®ï¼ä¹ä¸æ¿æå»ç¥è¯åºéæ¥ã</p>
<p>ç¶åé¢å¯¼åè¯äºï¼ä½ ä¸æ¯å¤©å¤©ç ç©¶ä»ä¹å¤§æ¨¡ååï¼è½ä¸è½æ´ä¸ªæºè½é®ç­ï¼è®©å¤§å®¶ç´æ¥é®é®é¢å°±è½å¾å°ç­æ¡ï¼</p>
<p>æå½æ¶èå­ä¸ç­ï¼æè¸è¯è¯´æ²¡é®é¢ãç»æç¬¬ä¸çä¸çº¿ä¸å¤©å°±è¢«éªä¸æ¥äºââç¨æ·é®æä»¬çMySQLä¸»ä»åæ¢æµç¨æ¯ä»ä¹ï¼å¤§æ¨¡ååç­å¾å¤´å¤´æ¯éï¼ä½åå®¹å®å¨æ¯å®èªå·±ç¼çï¼è·æä»¬å¬å¸çå®éæµç¨å«ç«¿å­æä¸çã</p>
<p>è¿å°±æ¯æè°çå¤§æ¨¡åå¹»è§é®é¢ï¼æå½æ¶å¯¹RAGççè§£è¿åçå¨æææ¡£ä¸¢è¿å»å°±è¡çæ°´å¹³ï¼å¤ªå¤©çäºã</p>
<p>ä¸è¿ï¼åæ¥çæäºè¿ç®åæ»¡ãæè±äºå°è¿ä¸å¨æ¶é´éæäºæ´ä¸ªæ¹æ¡ï¼ç°å¨è¿å¥ç³»ç»å·²ç»æäºé¨é¨çæ éå·¥å·ï¼ææ´»è·ç¨æ·ä»0æ¶¨å°äº200å¤ï¼é¢å¯¼å¨å­£åº¦ä¼ä¸è¿ä¸é¨è¡¨æ¬äºä¸åãä»å¤©è¿ç¯æç« ï¼æå°±ææ´ä¸ªè¸©åè¿ç¨ååæ¬æ¬å°è®°å½ä¸æ¥ï¼åæ¬ä»£ç ãæ¶æè®¾è®¡ãä»¥åé£äºæç§ä¹¦ä¸ä¸ä¼åè¯ä½ çå®æç»èã</p>
<h2 id="ä¸ragå°åºå¨è§£å³ä»ä¹é®é¢">ä¸ãRAGå°åºå¨è§£å³ä»ä¹é®é¢</h2>
<p>å¨å¨æä¹åï¼ææ³åèèRAGè¿ä¸ªæ¦å¿µï¼å ä¸ºå¾å¤åæ¥è§¦çæåå®¹æææ··ã<br>
<img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3459816/202602/3459816-20260210220941390-682123327.png" class="lazyload"></p>
<p>å¤§æ¨¡åå¾å¼ºï¼ä½å®æä¸¤ä¸ªè´å½å¼±ç¹ï¼</p>
<p><strong>ç¬¬ä¸ï¼ç¥è¯ææªæ­¢æ¥æã</strong> GPT-4çè®­ç»æ°æ®æªæ­¢å°æä¸ªæ¶é´ç¹ï¼å®ä¸ç¥éä½ ä»¬å¬å¸ä¸å¨åå¸çæ°è§èï¼ä¹ä¸ç¥éä½ ä»¬æ¨å¤©åä¿®å¤çé£ä¸ªbugæ¯æä¹è§£å³çã</p>
<p><strong>ç¬¬äºï¼ä¼ä¸æ¬æ­£ç»å°è¡è¯´å«éã</strong> å½å¤§æ¨¡åéå°å®ä¸ç¥éçé®é¢æ¶ï¼å®ä¸ä¼èèå®å®è¯´æä¸ç¥éï¼èæ¯ä¼åºäºå®å­¦è¿çéç¨ç¥è¯ï¼ç»ä½ ç¼ä¸ä¸ªçèµ·æ¥å¾åçä½å¶å®æ¯éçç­æ¡ãè¿å°±æ¯æè°çå¹»è§ï¼Hallucinationï¼ã</p>
<p>RAGï¼Retrieval-Augmented Generationï¼æ£ç´¢å¢å¼ºçæï¼çæ ¸å¿æè·¯å¶å®å¾ç®åï¼<strong>å«è®©å¤§æ¨¡åé æ³è±¡åç­é¢ï¼åå¸®å®æåèèµææ¾åºæ¥ï¼è®©å®ç§çèµæåç­ã</strong><br>
<img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3459816/202602/3459816-20260210220941050-1408320852.png" class="lazyload"><br>
å·ä½æ¥è¯´åä¸æ­¥ï¼</p>
<ol>
<li>æä½ çç§æææ¡£åæå°åï¼è½¬æåéå­èµ·æ¥</li>
<li>ç¨æ·æé®æ¶ï¼åæ ¹æ®é®é¢æ£ç´¢åºæç¸å³çææ¡£çæ®µ</li>
<li>æé®é¢åæ£ç´¢å°çåå®¹ä¸èµ·åç»å¤§æ¨¡åï¼è®©å®åºäºè¿äºææçæç­æ¡</li>
</ol>
<p>å¬èµ·æ¥ä¸å¤æå¯¹å§ï¼æå½æ¶ä¹æ¯è¿ä¹æ³çï¼ç¶åå°±è¸©äºä¸å åã</p>
<h2 id="äºç¬¬ä¸ä¸ªå¤§åææ¡£ååæ²¡é£ä¹ç®å">äºãç¬¬ä¸ä¸ªå¤§åï¼ææ¡£ååæ²¡é£ä¹ç®å</h2>
<p>ææåçæ¹æ¡ç¹å«ç²æ´ââç¨LangChainçRecursiveCharacterTextSplitterï¼è®¾ç½®chunk_size=500ï¼overlap=50ï¼ç´æ¥æææææ¡£åæå°åã<br>
<img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3459816/202602/3459816-20260210220941617-840309759.png" class="lazyload"><br>
ä»£ç åèµ·æ¥ç¡®å®å¾ç®åï¼</p>
<pre><code class="language-python">from langchain.text_splitter import RecursiveCharacterTextSplitter

def naive_split(text):
    æåçç®åååæ¹æ¡ââåæ¥è¯æè¿æ¯ä¸ªå
    splitter = RecursiveCharacterTextSplitter(
        chunk_size=500,
        chunk_overlap=50,
        separators=[\n\n, \n, ã, ï¼, ï¼,  , ]
    )
    chunks = splitter.split_text(text)
    return chunks

# æµè¯ä¸ä¸
sample_text = 
# MySQLä¸»ä»åæ¢æä½æå

## 1. åç½®æ£æ¥
å¨æ§è¡ä¸»ä»åæ¢ä¹åï¼å¿é¡»å®æä»¥ä¸æ£æ¥ï¼
- ç¡®è®¤ä»åºåæ­¥ç¶ææ­£å¸¸ï¼Seconds_Behind_Master = 0ï¼
- ç¡®è®¤æ²¡ææ­£å¨æ§è¡çå¤§äºå¡
- éç¥ç¸å³ä¸å¡æ¹ï¼ç¡®è®¤åæ¢æ¶é´çªå£

## 2. åæ¢æ­¥éª¤
2.1 å¨ä¸»åºæ§è¡åªè¯»è®¾ç½®
SET GLOBAL read_only = 1;

2.2 ç­å¾ä»åºå®å¨åæ­¥
å¨ä»åºæ§è¡ SHOW SLAVE STATUSï¼ç¡®è®¤ Seconds_Behind_Master = 0

2.3 åæ­¢ä»åºå¤å¶
STOP SLAVE;
RESET SLAVE ALL;

## 3. åæ»æ¹æ¡
å¦æåæ¢å¤±è´¥ï¼æä»¥ä¸æ­¥éª¤åæ»...


chunks = naive_split(sample_text)
for i, chunk in enumerate(chunks):
    print(f Chunk {i+1} )
    print(chunk[:100] + ... if len(chunk) &gt; 100 else chunk)
</code></pre>
<p>çèµ·æ¥æ²¡æ¯çæ¯å§ï¼ä½å®éç¨èµ·æ¥é®é¢å¤§äºã</p>
<p>æä¸æ¬¡ç¨æ·é®ï¼MySQLåæ¢åéè¦ååªäºæ£æ¥ï¼ç³»ç»è¿åçææ¡£çæ®µæ¯è¿æ ·çï¼</p>
<pre><code>ç¡®è®¤æ²¡ææ­£å¨æ§è¡çå¤§äºå¡
- éç¥ç¸å³ä¸å¡æ¹ï¼ç¡®è®¤åæ¢æ¶é´çªå£

## 2. åæ¢æ­¥éª¤
2.1 å¨ä¸»åºæ§è¡åªè¯»è®¾ç½®
SET GLOBAL read_only = 1;
</code></pre>
<p>åç°é®é¢äºåï¼è¿ä¸ªçæ®µæ°å¥½ä»æ£æ¥æ­¥éª¤çä¸­é´åå¼äºï¼ç¬¬ä¸æ¡æ£æ¥é¡¹ç¡®è®¤ä»åºåæ­¥ç¶ææ­£å¸¸è¢«åå°äºä¸ä¸ä¸ªchunkéãç¨æ·é®çæ¯éè¦ååªäºæ£æ¥ï¼ç»ææä»¬ç»å¤§æ¨¡åçåèèµæéï¼ç¬¬ä¸æ¡æ£æ¥é¡¹å°±æ²¡åå«è¿å»ã</p>
<p><strong>æ ¸å¿æè®­ï¼æºæ¢°å°æå­æ°ååï¼ä¼ææ­ææ¡£çè¯­ä¹å®æ´æ§ã</strong></p>
<p>åæ¥ææ¹æäºåºäºè¯­ä¹ç»æçååç­ç¥ï¼</p>
<pre><code class="language-python">import re
from typing import List, Dict

class SmartDocumentSplitter:
    
    è¯­ä¹æç¥çææ¡£ååå¨
    æ ¸å¿æè·¯ï¼å°éææ¡£çåæç»æï¼ææ é¢ãæ®µè½ç­è¯­ä¹è¾¹çåå
    
    
    def __init__(self, max_chunk_size=800, min_chunk_size=100):
        self.max_chunk_size = max_chunk_size
        self.min_chunk_size = min_chunk_size
    
    def split_markdown(self, text: str) -&gt; List[Dict]:
        
        éå¯¹Markdownææ¡£çåå
        ä¿ææ é¢å±çº§ç»æï¼æ¯ä¸ªchunké½å¸¦ä¸å®æ´çä¸ä¸æè·¯å¾
        
        chunks = []
        current_headers = {1: , 2: , 3: }  # è®°å½å½åçæ é¢å±çº§
        
        # æè¡å¤çï¼è¯å«æ é¢ååå®¹
        lines = text.split('\n')
        current_content = []
        
        for line in lines:
            # æ£æµMarkdownæ é¢
            header_match = re.match(r'^(#{1,3})\s+(.+)$', line)
            
            if header_match:
                # éå°æ°æ é¢ï¼åä¿å­ä¹åçåå®¹
                if current_content:
                    chunk_text = '\n'.join(current_content).strip()
                    if len(chunk_text) &gt;= self.min_chunk_size:
                        chunks.append({
                            'content': chunk_text,
                            'headers': dict(current_headers),
                            'context_path': self._build_context_path(current_headers)
                        })
                    current_content = []
                
                # æ´æ°æ é¢å±çº§
                level = len(header_match.group(1))
                title = header_match.group(2)
                current_headers[level] = title
                
                # æ¸é¤ä¸çº§æ é¢
                for l in range(level + 1, 4):
                    current_headers[l] = 
                
                current_content.append(line)
            else:
                current_content.append(line)
                
                # å¦æå½ååå®¹è¶è¿æå¤§é¿åº¦ï¼å¼ºå¶ååï¼ä½å°½éå¨æ®µè½è¾¹çï¼
                content_so_far = '\n'.join(current_content)
                if len(content_so_far) &gt; self.max_chunk_size:
                    chunk_text = content_so_far.strip()
                    chunks.append({
                        'content': chunk_text,
                        'headers': dict(current_headers),
                        'context_path': self._build_context_path(current_headers)
                    })
                    current_content = []
        
        # å«å¿äºæåä¸æ®µ
        if current_content:
            chunk_text = '\n'.join(current_content).strip()
            if len(chunk_text) &gt;= self.min_chunk_size:
                chunks.append({
                    'content': chunk_text,
                    'headers': dict(current_headers),
                    'context_path': self._build_context_path(current_headers)
                })
        
        return chunks
    
    def _build_context_path(self, headers: Dict) -&gt; str:
        æå»ºå±çº§è·¯å¾ï¼æ¯å¦ï¼MySQLä¸»ä»åæ¢ &gt; åç½®æ£æ¥
        path_parts = [h for h in [headers[1], headers[2], headers[3]] if h]
        return ' &gt; '.join(path_parts) if path_parts else 'æªåç±»'
    
    def enrich_chunk_with_context(self, chunk: Dict) -&gt; str:
        
        å³é®æå·§ï¼ç»æ¯ä¸ªchunkå ä¸ä¸ä¸æåç¼
        è¿æ ·å³ä½¿åç¬çè¿ä¸ªçæ®µï¼ä¹è½ç¥éå®å±äºåªä¸ªç« è
        
        context = f[ææ¡£è·¯å¾ï¼{chunk['context_path']}]\n\n
        return context + chunk['content']


# å®éä½¿ç¨ç¤ºä¾
splitter = SmartDocumentSplitter(max_chunk_size=800)
chunks = splitter.split_markdown(sample_text)

print(fåååå± {len(chunks)} ä¸ªçæ®µ\n)
for i, chunk in enumerate(chunks):
    print(f=== Chunk {i+1} ===)
    print(fè·¯å¾ï¼{chunk['context_path']})
    print(fåå®¹é¢è§ï¼{chunk['content'][:150]}...)
    print()
</code></pre>
<p>è¿æ ·ååºæ¥çææå°±å¥½å¤äºãæ¯ä¸ªchunkå¼å¤´é½ä¼å¸¦ä¸å®çä½ç½®ä¿¡æ¯ï¼å¤§æ¨¡åå¨åç­æ¶è½æ´åç¡®å°çè§£è¿æ®µåå®¹çä¸ä¸æã</p>
<p>ä¸è¿è¯´å®è¯ï¼è¿ä¸ªæ¹æ¡ä¹ä¸æ¯ä¸è½çãå¯¹äºé£äºæ ¼å¼ä¸è§èçèææ¡£ï¼æ²¡ææ¸æ°çæ é¢ç»æï¼ï¼ååææä¾ç¶ä¸è¬ãåæ¥æåéå¯¹ä¸åç±»åçææ¡£åäºå·®å¼åå¤çï¼è¿ä¸ªæä»¬åé¢åè¯´ã</p>
<h2 id="ä¸ç¬¬äºä¸ªå¤§ååéæ£ç´¢çè¯­ä¹é¸¿æ²">ä¸ãç¬¬äºä¸ªå¤§åï¼åéæ£ç´¢çè¯­ä¹é¸¿æ²</h2>
<p>è§£å³äºååé®é¢ï¼ä¸ä¸æ­¥å°±æ¯åéååæ£ç´¢äºãæç¨çæ¯å¼æºçBGEæ¨¡ååEmbeddingï¼ç¨Milvusååéæ°æ®åºã</p>
<p>ç¬¬ä¸ççæ£ç´¢ä»£ç å¾ç´ç½ï¼</p>
<pre><code class="language-python">from sentence_transformers import SentenceTransformer
from pymilvus import connections, Collection, FieldSchema, CollectionSchema, DataType, utility
import numpy as np

class VectorStore:
    åéå­å¨åæ£ç´¢
    
    def __init__(self, model_name='BAAI/bge-base-zh-v1.5'):
        # å è½½Embeddingæ¨¡å
        self.model = SentenceTransformer(model_name)
        self.dim = 768  # BGE baseæ¨¡åçåéç»´åº¦
        
        # è¿æ¥Milvus
        connections.connect(default, host=localhost, port=19530)
        
    def create_collection(self, collection_name: str):
        åå»ºéå
        if utility.has_collection(collection_name):
            utility.drop_collection(collection_name)
        
        fields = [
            FieldSchema(name=id, dtype=DataType.INT64, is_primary=True, auto_id=True),
            FieldSchema(name=content, dtype=DataType.VARCHAR, max_length=4096),
            FieldSchema(name=context_path, dtype=DataType.VARCHAR, max_length=512),
            FieldSchema(name=embedding, dtype=DataType.FLOAT_VECTOR, dim=self.dim)
        ]
        schema = CollectionSchema(fields, description=ç¥è¯åºææ¡£)
        collection = Collection(collection_name, schema)
        
        # åå»ºç´¢å¼
        index_params = {
            metric_type: COSINE,
            index_type: IVF_FLAT,
            params: {nlist: 128}
        }
        collection.create_index(embedding, index_params)
        return collection
    
    def insert_documents(self, collection_name: str, chunks: list):
        æå¥ææ¡£
        collection = Collection(collection_name)
        
        contents = [chunk['content'] for chunk in chunks]
        context_paths = [chunk['context_path'] for chunk in chunks]
        
        # æ¹éçæEmbedding
        embeddings = self.model.encode(contents, normalize_embeddings=True)
        
        collection.insert([contents, context_paths, embeddings.tolist()])
        collection.flush()
        print(fæåæå¥ {len(chunks)} æ¡ææ¡£)
    
    def search(self, collection_name: str, query: str, top_k: int = 5):
        åºç¡æ£ç´¢
        collection = Collection(collection_name)
        collection.load()
        
        # çææ¥è¯¢åé
        query_embedding = self.model.encode([query], normalize_embeddings=True)
        
        results = collection.search(
            data=query_embedding.tolist(),
            anns_field=embedding,
            param={metric_type: COSINE, params: {nprobe: 16}},
            limit=top_k,
            output_fields=[content, context_path]
        )
        
        return results[0]
</code></pre>
<p>åºæ¬åè½æ¯æ²¡é®é¢çãä½å®éè·èµ·æ¥ï¼æåç°äºä¸ä¸ªè®©äººæççç°è±¡ââ<strong>ç¨æ·çå£è¯­åæé®åææ¡£çæ­£å¼è¡¨è¿°ä¹é´å­å¨å·¨å¤§çè¯­ä¹é¸¿æ²</strong>ã</p>
<p>ä¸¾ä¸ªä¾å­ï¼</p>
<ul>
<li>ç¨æ·é®ï¼æ°æ®åºæäºæä¹å</li>
<li>ææ¡£æ é¢æ¯ï¼MySQLæå¡å¼å¸¸æ¢å¤æä½æå</li>
</ul>
<p>è¿ä¸¤ä¸ªå¨è¯­ä¹ä¸æ¯ç¸å³çï¼ä½åéç¸ä¼¼åº¦å¯è½å¹¶ä¸é«ãå ä¸ºç¨æ·è¯´çæäºåææ¡£éçå¼å¸¸ï¼ç¨è¯å·®å¼å¾å¤§ã</p>
<p>æ´åçæ¯ï¼ææ¶åæ£ç´¢åºçTop 5ç»æéï¼çæ­£ç¸å³çé£ç¯å¯è½åªæå¨ç¬¬3æç¬¬4ä½ï¼ä½åä¸¤åæ¯ä¸äºçèµ·æ¥ç¸å³ä½å®éä¸æä¸å¯¹é¢çåå®¹ãå¦ææåªåTop 3åç»å¤§æ¨¡åï¼å¯è½å°±æ¼æäºæå³é®çä¿¡æ¯ã</p>
<p>åæ¥æéç¨äºä¸ä¸ªä¸¤é¶æ®µæ£ç´¢çç­ç¥ï¼<strong>åç¨åéæ£ç´¢åç²ç­ï¼åç¨éæåºæ¨¡ååç²¾æã</strong></p>
<pre><code class="language-python">from transformers import AutoModelForSequenceClassification, AutoTokenizer
import torch

class EnhancedRetriever:
    å¢å¼ºçæ£ç´¢å¨ï¼åéæ£ç´¢ + éæåº
    
    def __init__(self, vector_store: VectorStore):
        self.vector_store = vector_store
        
        # å è½½éæåºæ¨¡åï¼BGE Rerankerææä¸éï¼
        self.reranker_tokenizer = AutoTokenizer.from_pretrained('BAAI/bge-reranker-base')
        self.reranker_model = AutoModelForSequenceClassification.from_pretrained('BAAI/bge-reranker-base')
        self.reranker_model.eval()
    
    def retrieve_with_rerank(self, collection_name: str, query: str, 
                             initial_top_k: int = 20, final_top_k: int = 5):
        
        ä¸¤é¶æ®µæ£ç´¢ï¼
        1. åéæ£ç´¢å¬å initial_top_k ä¸ªåé
        2. ç¨éæåºæ¨¡åç²¾æï¼è¿å final_top_k ä¸ªç»æ
        
        # ç¬¬ä¸é¶æ®µï¼åéæ£ç´¢ï¼å¬åæ´å¤åéï¼
        initial_results = self.vector_store.search(collection_name, query, top_k=initial_top_k)
        
        if not initial_results:
            return []
        
        # åå¤éæåº
        candidates = []
        for hit in initial_results:
            candidates.append({
                'content': hit.entity.get('content'),
                'context_path': hit.entity.get('context_path'),
                'vector_score': hit.score  # ä¿çåéæ£ç´¢å¾åï¼ç¨äºè°è¯
            })
        
        # ç¬¬äºé¶æ®µï¼éæåº
        rerank_scores = self._compute_rerank_scores(query, [c['content'] for c in candidates])
        
        for i, score in enumerate(rerank_scores):
            candidates[i]['rerank_score'] = score
        
        # æéæåºåæ°æåº
        candidates.sort(key=lambda x: x['rerank_score'], reverse=True)
        
        return candidates[:final_top_k]
    
    def _compute_rerank_scores(self, query: str, documents: list) -&gt; list:
        è®¡ç®queryåæ¯ä¸ªææ¡£çç¸å³æ§åæ°
        scores = []
        
        with torch.no_grad():
            for doc in documents:
                # Rerankerçè¾å¥æ ¼å¼æ¯ [query, document]
                inputs = self.reranker_tokenizer(
                    [[query, doc]], 
                    padding=True, 
                    truncation=True, 
                    max_length=512, 
                    return_tensors='pt'
                )
                outputs = self.reranker_model(**inputs)
                score = outputs.logits.squeeze().item()
                scores.append(score)
        
        return scores
    
    def retrieve_with_query_expansion(self, collection_name: str, query: str, 
                                       llm_client, top_k: int = 5):
        
        è¿é¶æå·§ï¼æ¥è¯¢æ©å±
        ç¨å¤§æ¨¡åæ¹åç¨æ·é®é¢ï¼çæå¤ä¸ªåä½ï¼ååå¹¶æ£ç´¢ç»æ
        
        # è®©å¤§æ¨¡åå¸®æä»¬æ©å±æ¥è¯¢
        expansion_prompt = fè¯·å°ä¸é¢è¿ä¸ªé®é¢æ¹åæ3ä¸ªä¸åçè¡¨è¾¾æ¹å¼ï¼ä¿æææç¸åä½ç¨è¯ä¸åã
æ¯è¡è¾åºä¸ä¸ªæ¹åç»æï¼ä¸è¦åºå·ï¼ä¸è¦å¶ä»è§£éã

åé®é¢ï¼{query}
        
        expanded_queries = llm_client.generate(expansion_prompt).strip().split('\n')
        expanded_queries = [q.strip() for q in expanded_queries if q.strip()]
        
        # å ä¸åå§æ¥è¯¢
        all_queries = [query] + expanded_queries[:3]  # æå¤å3ä¸ªæ©å±æ¥è¯¢
        
        print(fæ©å±åçæ¥è¯¢ï¼{all_queries})  # è°è¯ç¨
        
        # å¯¹æ¯ä¸ªæ¥è¯¢åå«æ£ç´¢
        all_candidates = {}
        for q in all_queries:
            results = self.vector_store.search(collection_name, q, top_k=10)
            for hit in results:
                content = hit.entity.get('content')
                if content not in all_candidates:
                    all_candidates[content] = {
                        'content': content,
                        'context_path': hit.entity.get('context_path'),
                        'best_score': hit.score,
                        'hit_count': 1
                    }
                else:
                    # è¢«å¤ä¸ªæ¥è¯¢å½ä¸­çææ¡£ï¼å¢å æé
                    all_candidates[content]['hit_count'] += 1
                    all_candidates[content]['best_score'] = max(
                        all_candidates[content]['best_score'], 
                        hit.score
                    )
        
        # ç»¼åè¯åï¼å½ä¸­æ¬¡æ° * æé«å¾å
        candidates = list(all_candidates.values())
        for c in candidates:
            c['combined_score'] = c['hit_count'] * c['best_score']
        
        candidates.sort(key=lambda x: x['combined_score'], reverse=True)
        return candidates[:top_k]
</code></pre>
<p>æ¥è¯¢æ©å±è¿æç¹å«å¥½ç¨ãæ¯å¦ç¨æ·é®æ°æ®åºæäºæä¹åï¼å¤§æ¨¡åå¯è½ä¼æ©å±æï¼</p>
<ul>
<li>MySQLæå¡æéå¦ä½å¤ç</li>
<li>æ°æ®åºæ æ³è¿æ¥çè§£å³æ¹æ¡</li>
<li>æ°æ®åºå®æºæ¢å¤æ­¥éª¤</li>
</ul>
<p>è¿å ä¸ªæ¥è¯¢ä¸èµ·æ£ç´¢ï¼è½è¦çæ´å¤çç¸å³ææ¡£ã</p>
<h2 id="åç¬¬ä¸ä¸ªå¤§åpromptå·¥ç¨çé¨éæ¯æ³è±¡ä¸­æ·±">åãç¬¬ä¸ä¸ªå¤§åï¼Promptå·¥ç¨çé¨éæ¯æ³è±¡ä¸­æ·±</h2>
<p>æ£ç´¢çé®é¢è§£å³äºï¼æ¥ä¸æ¥å°±æ¯ææ£ç´¢å°çåå®¹åç¨æ·é®é¢ä¸èµ·åç»å¤§æ¨¡åäºãè¿ä¸æ­¥ææ¬ä»¥ä¸ºæç®åï¼æ²¡æ³å°ä¹è¸©äºä¸å°åã</p>
<p>æåçPromptç¹å«æ´ç´ ï¼</p>
<pre><code class="language-python">def build_naive_prompt(query: str, context_docs: list) -&gt; str:
    æåçç®åPromptââåæ¥è¯æå¤ªå¤©çäº
    context = \n\n.join([doc['content'] for doc in context_docs])
    
    prompt = fæ ¹æ®ä»¥ä¸åèèµæåç­ç¨æ·é®é¢ã

åèèµæï¼
{context}

ç¨æ·é®é¢ï¼{query}

è¯·åç­ï¼
    
    return prompt
</code></pre>
<p>è¿ä¸ªPromptæå ä¸ªä¸¥éé®é¢ï¼</p>
<p><strong>é®é¢ä¸ï¼å¤§æ¨¡åä¸ç¥éä»ä¹æ¶åè¯¥è¯´ä¸ç¥éã</strong> å½åèèµæéç¡®å®æ²¡æç­æ¡æ¶ï¼å®è¿æ¯ä¼ç¼ä¸ä¸ªåºæ¥ã</p>
<p><strong>é®é¢äºï¼æ²¡æå¼å¯¼å¤§æ¨¡åè¯´æä¿¡æ¯æ¥æºã</strong> ç¨æ·çå°ç­æ¡ï¼ä¸ç¥éæ¯ä»åªç¯ææ¡£éæ¥çï¼æ æ³è¿½æº¯åéªè¯ã</p>
<p><strong>é®é¢ä¸ï¼å¯¹äºå¤æé®é¢ï¼åç­çç»æä¸å¤æ¸æ°ã</strong></p>
<p>åæ¥è¿­ä»£äºå¾å¤çï¼æç»ç¨³å®ä¸æ¥çPromptæ¯è¿æ ·çï¼</p>
<pre><code class="language-python">def build_rag_prompt(query: str, context_docs: list, 
                     include_sources: bool = True) -&gt; str:
    
    çäº§ç¯å¢ä½¿ç¨çPromptæ¨¡æ¿
    å³é®è®¾è®¡ï¼æç¡®è§è²å®ä½ãéå¶åç­èå´ãè¦æ±æ æ³¨æ¥æº
    
    
    # æ ¼å¼åä¸ä¸æï¼æ¯æ®µé½æ æ³¨æ¥æº
    context_parts = []
    for i, doc in enumerate(context_docs, 1):
        source = doc.get('context_path', 'æªç¥æ¥æº')
        context_parts.append(fãèµæ{i}ï¼æ¥æºï¼{source}ã\n{doc['content']})
    
    context = \n\n\n\n.join(context_parts)
    
    prompt = fä½ æ¯ä¸ä¸ªä¼ä¸åé¨ç¥è¯åºå©æï¼ä¸é¨å¸®å©åå·¥æ¥æ¾åçè§£å¬å¸åé¨ææ¡£ã

## ä½ çå·¥ä½åå

1. **åªæ ¹æ®æä¾çåèèµæåç­é®é¢**ï¼ä¸è¦ä½¿ç¨ä½ èªå·±çç¥è¯ã
2. å¦æåèèµæä¸­æ²¡æç¸å³ä¿¡æ¯ï¼è¯·æç¡®è¯´æ ¹æ®ç°æèµæï¼ææ æ³æ¾å°å³äºè¿ä¸ªé®é¢çä¿¡æ¯ï¼å¹¶å»ºè®®ç¨æ·èç³»ç¸å³é¨é¨ææ¢ä¸ªå³é®è¯æç´¢ã
3. åç­æ¶è¯·æ æ³¨ä¿¡æ¯æ¥æºï¼æ ¼å¼å¦ãèµæ1ãï¼æ¹ä¾¿ç¨æ·è¿½æº¯åæã
4. å¯¹äºæä½ç±»é®é¢ï¼è¯·ææ­¥éª¤æ¸æ°å°ååºï¼å¯¹äºæ¦å¿µç±»é®é¢ï¼åç»åºç®æå®ä¹åå±å¼è§£éã
5. å¦æä¸åèµæä¸­çä¿¡æ¯æå²çªï¼è¯·æåºå·®å¼å¹¶è¯´æåèªçéç¨åºæ¯ã

## åèèµæ

{context}

## ç¨æ·é®é¢

{query}

## åç­è¦æ±

è¯·æ ¹æ®ä¸è¿°åèèµæåç­ç¨æ·é®é¢ãè®°ä½ï¼
- åªä½¿ç¨åèèµæä¸­çä¿¡æ¯
- æ æ³¨ä¿¡æ¯æ¥æº
- æ²¡æææ¡çåå®¹ä¸è¦ç¼é 

    
    return prompt


def build_conversational_prompt(query: str, context_docs: list, 
                                 chat_history: list = None) -&gt; str:
    
    æ¯æå¤è½®å¯¹è¯çPrompt
    éè¦å¸¦ä¸åå²å¯¹è¯è®°å½ï¼è®©å¤§æ¨¡åçè§£ä¸ä¸æ
    
    
    context_parts = []
    for i, doc in enumerate(context_docs, 1):
        source = doc.get('context_path', 'æªç¥æ¥æº')
        context_parts.append(fãèµæ{i}ï¼æ¥æºï¼{source}ã\n{doc['content']})
    context = \n\n\n\n.join(context_parts)
    
    # æ ¼å¼ååå²å¯¹è¯
    history_text = 
    if chat_history:
        history_parts = []
        for turn in chat_history[-5:]:  # åªä¿çæè¿5è½®ï¼é¿åå¤ªé¿
            history_parts.append(fç¨æ·ï¼{turn['user']})
            history_parts.append(få©æï¼{turn['assistant']})
        history_text = \n.join(history_parts)
    
    prompt = fä½ æ¯ä¸ä¸ªä¼ä¸åé¨ç¥è¯åºå©æã

## åèèµæ

{context}

## å¯¹è¯åå²

{history_text if history_text else ï¼è¿æ¯å¯¹è¯çå¼å§ï¼}

## å½åé®é¢

ç¨æ·ï¼{query}

## åç­åå

1. ä¼åæ ¹æ®åèèµæåç­ï¼å¦æ ç¸å³ä¿¡æ¯è¯·æç¡®è¯´æ
2. èèå¯¹è¯åå²çä¸ä¸æï¼å¦ç¨æ·è¯´å®å¯è½æä»£ä¹åæå°çæ¦å¿µï¼
3. æ æ³¨ä¿¡æ¯æ¥æº

å©æï¼
    
    return prompt
</code></pre>
<p>å³äºPromptï¼æè¿æ³åäº«ä¸ä¸ªå¾éè¦çç»éªï¼<strong>ä¸è¦è¯å¾å¨ä¸ä¸ªPromptéå¡å¤ªå¤æä»¤</strong>ã</p>
<p>ä¸å¼å§ææåç§è¦æ±é½åè¿å»ï¼åç­è¦åç¡®ãè¦ç®æ´ãè¦åå¥½ãè¦ä¸ä¸ãè¦æ æ³¨æ¥æºãè¦åæ­¥éª¤ãéå°ä¸ç¡®å®è¦è¯´ä¸ç¥éâ¦â¦ç»æåç°æ¨¡ååèè¢«ç»æäºï¼ææ¶åé¡¾äºè¿ä¸ªå¿äºé£ä¸ªã</p>
<p>åæ¥æçåæ³æ¯ï¼<strong>åºåæ ¸å¿æä»¤åä¼åæä»¤ï¼æ ¸å¿æä»¤å¿é¡»ä¿çï¼ä¼åæä»¤å¯ä»¥æ ¹æ®é®é¢ç±»åå¨æè°æ´ã</strong></p>
<pre><code class="language-python">class PromptBuilder:
    Promptæå»ºå¨ï¼æ ¹æ®é®é¢ç±»åå¨æè°æ´
    
    # æ ¸å¿æä»¤ââä»»ä½æåµé½å¿é¡»åå«
    CORE_INSTRUCTIONS = 
1. åªä½¿ç¨åèèµæä¸­çä¿¡æ¯åç­ï¼ä¸è¦ç¼é 
2. èµæä¸­æ²¡æçä¿¡æ¯ï¼æç¡®è¯´æ æ³æ¾å°ç¸å³ä¿¡æ¯
3. æ æ³¨ä¿¡æ¯æ¥æºãèµæXã

    
    # æä½ç±»é®é¢çé¢å¤æä»¤
    PROCEDURE_INSTRUCTIONS = 
åç­æ ¼å¼è¦æ±ï¼
- ææ­¥éª¤ç¼å·ååºï¼ç¬¬ä¸æ­¥ãç¬¬äºæ­¥...ï¼
- æ¯ä¸ªæ­¥éª¤è¦æç¡®æä½å¯¹è±¡åæä½å¨ä½
- éè¦çè­¦åææ³¨æäºé¡¹ç¨â ï¸æ åº

    
    # æ¦å¿µè§£éç±»é®é¢çé¢å¤æä»¤
    CONCEPT_INSTRUCTIONS = 
åç­æ ¼å¼è¦æ±ï¼
- åç¨ä¸å¥è¯ç»åºæ ¸å¿å®ä¹
- åè¯¦ç»è§£éå³é®ç¹
- å¦æå¿è¦ï¼ä¸¾ä¾è¯´æ

    # æéææ¥ç±»é®é¢çé¢å¤æä»¤
    TROUBLESHOOT_INSTRUCTIONS = 
åç­æ ¼å¼è¦æ±ï¼
- åååºå¯è½çåå 
- éå¯¹æ¯ä¸ªåå ç»åºææ¥æ¹æ³
- ç»åºè§£å³æ¹æ¡æè§é¿å»ºè®®

    
    @classmethod
    def build(cls, query: str, context_docs: list, question_type: str = general) -&gt; str:
        æ ¹æ®é®é¢ç±»åæå»ºPrompt
        
        # ç®åçé®é¢åç±»é»è¾ï¼å®éé¡¹ç®ä¸­å¯ä»¥ç¨åç±»æ¨¡åï¼
        if question_type == auto:
            question_type = cls._classify_question(query)
        
        extra_instructions = 
        if question_type == procedure:
            extra_instructions = cls.PROCEDURE_INSTRUCTIONS
        elif question_type == concept:
            extra_instructions = cls.CONCEPT_INSTRUCTIONS
        elif question_type == troubleshoot:
            extra_instructions = cls.TROUBLESHOOT_INSTRUCTIONS
        
        context = cls._format_context(context_docs)
        
        prompt = fä½ æ¯ä¼ä¸åé¨ç¥è¯åºå©æã

## å¿é¡»éµå®çè§å
{cls.CORE_INSTRUCTIONS}

{f## åç­æ ¼å¼{extra_instructions} if extra_instructions else }

## åèèµæ
{context}

## ç¨æ·é®é¢
{query}

è¯·åç­ï¼
        
        return prompt
    
    @classmethod
    def _classify_question(cls, query: str) -&gt; str:
        ç®åçé®é¢åç±»ï¼åºäºå³é®è¯ï¼
        procedure_keywords = [æä¹å, å¦ä½æä½, æ­¥éª¤, æµç¨, ææ ·]
        concept_keywords = [æ¯ä»ä¹, ä»ä¹æ¯, å®ä¹, è§£é, åºå«]
        troubleshoot_keywords = [ä¸ºä»ä¹, æ¥é, å¤±è´¥, å¼å¸¸, é®é¢, æé]
        
        query_lower = query.lower()
        
        if any(kw in query_lower for kw in procedure_keywords):
            return procedure
        elif any(kw in query_lower for kw in concept_keywords):
            return concept
        elif any(kw in query_lower for kw in troubleshoot_keywords):
            return troubleshoot
        else:
            return general
    
    @classmethod
    def _format_context(cls, context_docs: list) -&gt; str:
        parts = []
        for i, doc in enumerate(context_docs, 1):
            source = doc.get('context_path', 'æªç¥æ¥æº')
            parts.append(fãèµæ{i}ï¼æ¥æºï¼{source}ã\n{doc['content']})
        return \n\n\n\n.join(parts)
</code></pre>
<h2 id="äºä¸²èµ·æ¥å®æ´çrag-pipeline">äºãä¸²èµ·æ¥ï¼å®æ´çRAG Pipeline</h2>
<p>åé¢è¯´äºä¸å ç»èï¼ç°å¨æå®ä»¬ä¸²æä¸ä¸ªå®æ´çPipelineï¼<br>
<img alt="Mermaid Chart - Create complex, visual diagrams with text.-2026-01-13-113354.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3459816/202602/3459816-20260210220941180-132831547.png" class="lazyload"></p>
<pre><code class="language-python">from openai import OpenAI
from typing import List, Dict, Optional
import json

class RAGPipeline:
    
    å®æ´çRAGå¤çæµç¨
    ææ¡£åå -&gt; åéåå­å¨ -&gt; æ£ç´¢ -&gt; éæåº -&gt; çæåç­
    
    
    def __init__(self, 
                 llm_base_url: str = https://api.deepseek.com,
                 llm_api_key: str = your-api-key,
                 llm_model: str = deepseek-chat):
        
        # åå§ååä¸ªç»ä»¶
        self.splitter = SmartDocumentSplitter(max_chunk_size=800)
        self.vector_store = VectorStore()
        self.retriever = EnhancedRetriever(self.vector_store)
        
        # åå§åLLMå®¢æ·ç«¯ï¼è¿éç¨DeepSeekï¼ä¹å¯ä»¥æ¢æå¶ä»çï¼
        self.llm_client = OpenAI(base_url=llm_base_url, api_key=llm_api_key)
        self.llm_model = llm_model
        
        self.collection_name = knowledge_base
    
    def ingest_documents(self, documents: List[Dict]):
        
        ææ¡£å¥åº
        documentsæ ¼å¼ï¼[{title: ææ¡£æ é¢, content: ææ¡£åå®¹, source: æ¥æº}]
        
        print(få¼å§å¤ç {len(documents)} ç¯ææ¡£...)
        
        all_chunks = []
        for doc in documents:
            # å¨åå®¹åå ä¸æ é¢ï¼å¸®å©ååå¨è¯å«ç»æ
            full_content = f# {doc['title']}\n\n{doc['content']}
            
            chunks = self.splitter.split_markdown(full_content)
            
            # ç»æ¯ä¸ªchunkå ä¸ææ¡£æ¥æºä¿¡æ¯
            for chunk in chunks:
                chunk['source_doc'] = doc.get('source', doc['title'])
            
            all_chunks.extend(chunks)
        
        print(fåååå± {len(all_chunks)} ä¸ªçæ®µ)
        
        # åå»ºéåå¹¶æå¥
        self.vector_store.create_collection(self.collection_name)
        self.vector_store.insert_documents(self.collection_name, all_chunks)
        
        print(ææ¡£å¥åºå®æï¼)
    
    def query(self, 
              question: str, 
              chat_history: Optional[List[Dict]] = None,
              top_k: int = 5,
              use_rerank: bool = True) -&gt; Dict:
        
        å¤çç¨æ·æ¥è¯¢
        è¿åï¼{answer: åç­åå®¹, sources: [å¼ç¨çæ¥æº], retrieved_docs: [æ£ç´¢å°çææ¡£]}
        
        
        # 1. æ£ç´¢ç¸å³ææ¡£
        if use_rerank:
            retrieved_docs = self.retriever.retrieve_with_rerank(
                self.collection_name, question, 
                initial_top_k=20, final_top_k=top_k
            )
        else:
            results = self.vector_store.search(self.collection_name, question, top_k=top_k)
            retrieved_docs = [{
                'content': hit.entity.get('content'),
                'context_path': hit.entity.get('context_path'),
                'score': hit.score
            } for hit in results]
        
        if not retrieved_docs:
            return {
                answer: æ±æ­ï¼ææ²¡ææ¾å°ä¸æ¨é®é¢ç¸å³çèµæãæ¨å¯ä»¥å°è¯æ¢ä¸ªå³é®è¯ï¼æèç³»ç¸å³é¨é¨è·åå¸®å©ã,
                sources: [],
                retrieved_docs: []
            }
        
        # 2. æå»ºPrompt
        if chat_history:
            prompt = build_conversational_prompt(question, retrieved_docs, chat_history)
        else:
            prompt = PromptBuilder.build(question, retrieved_docs, question_type=auto)
        
        # 3. è°ç¨LLMçæåç­
        response = self.llm_client.chat.completions.create(
            model=self.llm_model,
            messages=[{role: user, content: prompt}],
            temperature=0.3,  # ç¥è¯åºé®ç­ç¨è¾ä½çtemperature
            max_tokens=2000
        )
        
        answer = response.choices[0].message.content
        
        # 4. æåå¼ç¨çæ¥æº
        sources = list(set([doc.get('context_path', 'æªç¥æ¥æº') for doc in retrieved_docs]))
        
        return {
            answer: answer,
            sources: sources,
            retrieved_docs: retrieved_docs
        }
    
    def evaluate_response(self, question: str, answer: str, 
                          ground_truth: str = None) -&gt; Dict:
        
        åç­è´¨éè¯ä¼°ï¼å¯éï¼
        ç¨LLMè¯ä¼°åç­çè´¨éï¼æ¹ä¾¿æç»­ä¼å
        
        eval_prompt = fè¯·è¯ä¼°ä»¥ä¸é®ç­çè´¨éã

é®é¢ï¼{question}

åç­ï¼{answer}

{fåèç­æ¡ï¼{ground_truth} if ground_truth else }

è¯·ä»ä»¥ä¸ç»´åº¦è¯åï¼1-5åï¼å¹¶è¯´æçç±ï¼
1. ç¸å³æ§ï¼åç­æ¯å¦åé¢
2. åç¡®æ§ï¼ä¿¡æ¯æ¯å¦æ­£ç¡®
3. å®æ´æ§ï¼æ¯å¦å®æ´è§£ç­äºé®é¢
4. å¯è¯»æ§ï¼è¡¨è¿°æ¯å¦æ¸æ°ææ

è¯·ç¨JSONæ ¼å¼è¾åºï¼{{relevance: åæ°, accuracy: åæ°, completeness: åæ°, readability: åæ°, comments: è¯ä»·è¯´æ}}
        
        response = self.llm_client.chat.completions.create(
            model=self.llm_model,
            messages=[{role: user, content: eval_prompt}],
            temperature=0
        )
        
        try:
            eval_result = json.loads(response.choices[0].message.content)
            return eval_result
        except:
            return {error: è¯ä¼°ç»æè§£æå¤±è´¥}


# ä½¿ç¨ç¤ºä¾
if __name__ == __main__:
    # åå§åPipeline
    rag = RAGPipeline(
        llm_base_url=https://api.deepseek.com,
        llm_api_key=your-api-key,
        llm_model=deepseek-chat
    )
    
    # åå¤æµè¯ææ¡£
    test_documents = [
        {
            title: MySQLä¸»ä»åæ¢æä½æå,
            content: """
				## 1. åç½®æ£æ¥
				å¨æ§è¡ä¸»ä»åæ¢ä¹åï¼å¿é¡»å®æä»¥ä¸æ£æ¥ï¼
				- ç¡®è®¤ä»åºåæ­¥ç¶ææ­£å¸¸ï¼Seconds_Behind_Master = 0ï¼
				- ç¡®è®¤æ²¡ææ­£å¨æ§è¡çå¤§äºå¡
				- éç¥ç¸å³ä¸å¡æ¹ï¼ç¡®è®¤åæ¢æ¶é´çªå£

				## 2. åæ¢æ­¥éª¤
				### 2.1 å¨ä¸»åºæ§è¡åªè¯»è®¾ç½®
				SET GLOBAL read_only = 1;
				### 2.2 ç­å¾ä»åºå®å¨åæ­¥
				å¨ä»åºæ§è¡ SHOW SLAVE STATUSï¼ç¡®è®¤ Seconds_Behind_Master = 0

				### 2.3 åæ­¢ä»åºå¤å¶å¹¶æåä¸ºä¸»åº
				STOP SLAVE;
				RESET SLAVE ALL;
				SET GLOBAL read_only = 0;

				## 3. åæ¢åéªè¯
				- ç¡®è®¤æ°ä¸»åºå¯ä»¥æ­£å¸¸åå¥
				- ç¡®è®¤åºç¨è¿æ¥å·²åæ¢å°æ°ä¸»åº
				- çæ§æ°ä¸»åºçæ§è½ææ 
				""",
            source: DBAå¢éææ¡£
        }
    ]
    
    # å¥åº
    rag.ingest_documents(test_documents)
    
    # æµè¯æ¥è¯¢
    result = rag.query(MySQLåæ¢åéè¦ååªäºæ£æ¥ï¼)
    
    print(= * 50)
    print(é®é¢ï¼MySQLåæ¢åéè¦ååªäºæ£æ¥ï¼)
    print(= * 50)
    print(f\nåç­ï¼\n{result['answer']})
    print(f\nåèæ¥æºï¼{result['sources']})

</code></pre>
<h2 id="å­ä¸çº¿åçä¸äºç»éªæè®­">å­ãä¸çº¿åçä¸äºç»éªæè®­</h2>
<p>ç³»ç»ä¸çº¿å°ç°å¨å·®ä¸å¤ä¸¤ä¸ªæäºï¼æé´åè¸©äºä¸å°åï¼è¿éæå ä¸ªå°è±¡ææ·±çè¯´è¯´ã</p>
<h3 id="æè®­ä¸ç¨æ·çé®é¢åå¥ç¾æª">æè®­ä¸ï¼ç¨æ·çé®é¢åå¥ç¾æª</h3>
<p>æä»¬å¨è®¾è®¡æ¶åè®¾ç¨æ·ä¼é®MySQLæä¹åä¸»ä»åæ¢è¿ç§æ­£å¸¸é®é¢ãä½å®éä¸å¢ï¼</p>
<p>æäººé®ï¼ä¸æ¬¡é£ä¸ªäºææä¹å¤ççæ¥çï¼ââæ²¡æä»»ä½ä¸ä¸æï¼ç³»ç»æ ¹æ¬ä¸ç¥éé£ä¸ªäºææ¯åªä¸ªã</p>
<p>æäººé®ï¼å¸®æåä¸ªSQLãââè¿æ ¹æ¬ä¸æ¯ç¥è¯åºé®ç­ï¼è¿æ¯è®©å¤§æ¨¡åå¸®åä»£ç ã</p>
<p>è¿æäººé®ï¼å¨åï¼ââæä¹ä¸ç¥éä»æ³å¹²å¥ã</p>
<p>åæ¥æå äºä¸ä¸ªæå¾è¯å«å±ï¼åå¤æ­ç¨æ·çé®é¢æ¯å¦å±äºç¥è¯åºé®ç­çèç´ï¼</p>
<pre><code class="language-python">def classify_intent(self, query: str) -&gt; str:
    """è¯å«ç¨æ·æå¾"""
    intent_prompt = f"""å¤æ­ç¨æ·è¾å¥çæå¾ç±»å«ï¼åªè¾åºç±»å«åç§°ï¼
- knowledge_queryï¼æ¥è¯¢ç¥è¯åºä¿¡æ¯ï¼å¦è¯¢é®æµç¨ãè§èãæä½æ¹æ³ï¼
- code_requestï¼è¯·æ±çæä»£ç 
- chitchatï¼é²èææ æç¡®æå¾
- otherï¼å¶ä»

ç¨æ·è¾å¥ï¼{query}

æå¾ç±»å«ï¼"""
    
    response = self.llm_client.chat.completions.create(
        model=self.llm_model,
        messages=[{"role": "user", "content": intent_prompt}],
        temperature=0,
        max_tokens=20
    )
    
    return response.choices[0].message.content.strip()
</code></pre>
<p>å¯¹äºéç¥è¯åºé®ç­çæå¾ï¼ç»ç¨æ·ä¸ä¸ªåå¥½çæç¤ºèä¸æ¯ç¡¬çå¤´ç®æ£ç´¢ã</p>
<h3 id="æè®­äºå·å¯å¨æ¶çå°´å°¬">æè®­äºï¼å·å¯å¨æ¶çå°´å°¬</h3>
<p>ç³»ç»åä¸çº¿æ¶ï¼ç¥è¯åºéçææ¡£ä¸å¤ï¼è¦ççåºæ¯æéãç¨æ·é®äºå ä¸ªé®é¢é½ç­ä¸ä¸æ¥ï¼ä½éªç¹å«å·®ï¼äºæ¯å°±ä¸æ¥ç¨äºã</p>
<p>åæ¥çè§£å³åæ³ï¼</p>
<ol>
<li>ä¸çº¿ååæ¢³çé«é¢é®é¢ï¼ç¡®ä¿è³å°è¿äºé®é¢è½åç­å¥½</li>
<li>æäºä¸ä¸ªé®é¢æ¶éåè½ï¼å¯¹äºç­ä¸ä¸æ¥çé®é¢ï¼è®°å½ä¸æ¥åé¦ç»åå®¹å¢éï¼è®©ä»ä»¬è¡¥åç¸å³ææ¡£</li>
<li>åäºä¸ä¸ªååºç­ç¥ââå¦ææ£ç´¢ä¸å°é«ç¸å³åº¦çåå®¹ï¼å°±å±ç¤ºç¸å³æ¨èï¼æä¸äºç¸ä¼¼åº¦å°å¯çææ¡£æ é¢ååºæ¥ï¼å¼å¯¼ç¨æ·èªå·±å»ç</li>
</ol>
<h3 id="æè®­ä¸ææ¡£æ´æ°çåæ­¥é®é¢">æè®­ä¸ï¼ææ¡£æ´æ°çåæ­¥é®é¢</h3>
<p>ç¥è¯åºçææ¡£æ¯ä¼æ´æ°çãèçæ¬çæä½æååºå¼äºï¼æ°çæ¬åå¸äºãä½å¦æåéæ°æ®åºéè¿å­çèçæ¬çåå®¹ï¼ç¨æ·æ£ç´¢å°çå¯è½æ¯è¿æ¶ä¿¡æ¯ã</p>
<p>è¿ä¸ªé®é¢è¯´èµ·æ¥ç®åï¼åèµ·æ¥æºéº»ç¦çãæä»¬æåçæ¹æ¡æ¯ï¼</p>
<ol>
<li>æ¯ä¸ªææ¡£å¥åºæ¶è®°å½çæ¬å·åæ´æ°æ¶é´</li>
<li>å®æå¨ééæ°å¥åºï¼æä»¬æ¯æ¯å¨ä¸æ¬¡ï¼</li>
<li>å¯¹äºç´§æ¥æ´æ°çéè¦ææ¡£ï¼æ¯ææå¨è§¦ååç¯éå¥åº</li>
</ol>
<h2 id="ä¸æ§è½ä¼åè®©ç³»ç»ä¸é£ä¹æ¢">ä¸ãæ§è½ä¼åï¼è®©ç³»ç»ä¸é£ä¹æ¢</h2>
<p>RAGç³»ç»æä¸ªè®©äººå¤´ç¼çé®é¢ââæ¢ã</p>
<p>æ´ä¸ªæµç¨è·ä¸éï¼Embeddingç¼ç ãåéæ£ç´¢ãéæåºãLLMçæï¼å¨é¨å èµ·æ¥å¯è½è¦å¥½å ç§ãç¨æ·ä½éªå°±å¾å·®ï¼é®ä¸ä¸ªé®é¢è¦ç­åå¤©ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3459816/202602/3459816-20260210220941381-1747360926.png" class="lazyload"></p>
<p>å ä¸ªä¼åæªæ½ï¼</p>
<pre><code class="language-python">import asyncio
from functools import lru_cache
import hashlib

class OptimizedRAG:
    æ§è½ä¼åçRAG
    
    def __init__(self):
        # ç¼å­ç­é¨æ¥è¯¢çç»æ
        self.query_cache = {}
        self.cache_ttl = 3600  # 1å°æ¶è¿æ
    
    @lru_cache(maxsize=1000)
    def _compute_query_embedding(self, query: str):
        
        Embeddingç»æç¼å­
        åæ ·çé®é¢ä¸ç¨éå¤è®¡ç®åé
        
        return self.model.encode([query], normalize_embeddings=True)[0]
    
    def _get_cache_key(self, query: str) -&gt; str:
        çæç¼å­key
        return hashlib.md5(query.lower().strip().encode()).hexdigest()
    
    async def stream_query(self, question: str):
        
        æµå¼è¾åº
        ä¸ç¨ç­æ´ä¸ªåç­çæå®ï¼è¾¹çæè¾¹è¾åº
        
        retrieved_docs = await asyncio.to_thread(
            self.retriever.retrieve_with_rerank,
            self.collection_name, question, 20, 5
        )
        
        prompt = PromptBuilder.build(question, retrieved_docs, question_type=auto)
        
        # ä½¿ç¨æµå¼API
        stream = self.llm_client.chat.completions.create(
            model=self.llm_model,
            messages=[{role: user, content: prompt}],
            temperature=0.3,
            stream=True  # å¼å¯æµå¼
        )
        
        for chunk in stream:
            if chunk.choices[0].delta.content:
                yield chunk.choices[0].delta.content
</code></pre>
<p>æµå¼è¾åºè¿ä¸ç¹ç¹å«éè¦ãç¨æ·é®å®é®é¢åï¼é©¬ä¸å°±è½çå°åç­å¨æå­ï¼å¿çä¸å°±ä¸ä¼è§å¾é£ä¹æ¢äºã</p>
<h2 id="å«åé¡¾ä¸æè">å«ãåé¡¾ä¸æè</h2>
<p>æè¿å¥ç³»ç»ä»è¢«éªä¸çº¿å°æä¸ºé¨é¨æ éï¼ååæè¾äºå°è¿ä¸ä¸ªæãè¶è¿çåæºå¤ï¼ä½æ¶è·ä¹å¾å¤§ã</p>
<p>å ç¹æ ¸å¿æ»ç»ï¼</p>
<p><strong>1. RAGä¸æ¯ä¸è½çï¼éå¥½éç¨åºæ¯</strong></p>
<p>RAGéåææç¡®ç¥è¯åºãç­æ¡å¯è¿½æº¯çåºæ¯ãå¦æä½ çéæ±æ¯è®©å¤§æ¨¡ååæ¥åé åï¼æ¯å¦åææ¡ãååæï¼ï¼é£RAGåèæ¯ä¸ªçº¦æã</p>
<p><strong>2. åååæ£ç´¢æ¯æ ¹åº</strong></p>
<p>å¤§å®¶å¾å¾ææ³¨æåæ¾å¨å¤§æ¨¡åæ¬èº«ï¼è§å¾ç¨æ´å¼ºçæ¨¡åå°±è½è§£å³é®é¢ãä½å®éä¸ï¼å¦æåé¢çåååæ£ç´¢åå¾ä¸å¥½ï¼åå¼ºçæ¨¡åä¹æ¯å·§å¦é¾ä¸ºæ ç±³ä¹çã</p>
<p><strong>3. Promptå·¥ç¨ççæ¯é¨æèº</strong></p>
<p>åæ ·çæ£ç´¢ç»æï¼ä¸åçPromptå¯è½å¸¦æ¥å¤©å£¤ä¹å«çåç­ææãè¿ä¸ªæ²¡ä»ä¹æ·å¾ï¼å°±æ¯å¤è¯ãå¤çãå¤è¿­ä»£ã</p>
<p><strong>4. ä¸çº¿åªæ¯å¼å§</strong></p>
<p>çæ­£çææå¨ä¸çº¿ä¹åãç¨æ·çåç§å¥è©è¾å¥ãææ¡£çæç»­æ´æ°ãæ§è½çä¼åãææççæ§â¦â¦æ¯ä¸é¡¹é½æ¯æç»­çå·¥ä½ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3459816/202602/3459816-20260210220941408-1845897027.png" class="lazyload"></p>
<p>æåï¼éä¸è¿å¥ç³»ç»ç®åçä¸äºæ ¸å¿ææ ï¼</p>
<ul>
<li>æ¥åæ¥è¯¢éï¼200+æ¬¡</li>
<li>å¹³åååºæ¶é´ï¼2.3ç§ï¼å¼å¯æµå¼åé¦å­ç¬¦å»¶è¿çº¦0.8ç§ï¼</li>
<li>ç¨æ·æ»¡æåº¦ï¼éè¿åç­åçç¹èµ/ç¹è¸©æ¶éï¼ï¼çº¦72%</li>
<li>æ æ³åç­çæ¯ä¾ï¼çº¦22%ï¼è¿é¨åä¼å®æåæï¼æ¨å¨è¡¥åææ¡£ï¼</li>
</ul>
<p>æ°å­ä¸ç®ç¹å«äº®ç¼ï¼ä½æ¯èµ·ä¹åé£ä¸ªæ²¡äººç¨çå³é®è¯æç´¢ï¼å·²ç»æ¯è´¨çé£è·äºãå¦æä½ ä¹å¨åç±»ä¼¼çé¡¹ç®ï¼å¸æè¿ç¯æç« è½å¸®ä½ å°è¸©ä¸äºåãæé®é¢æ¬¢è¿è¯è®ºåºäº¤æµï¼</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-10 22:10">2026-02-10 22:10</span>&nbsp;
<a href="https://www.cnblogs.com/bu-huo">å¼ ä¸æ</a>&nbsp;
éè¯»(<span id="post_view_count">409</span>)&nbsp;
è¯è®º(<span id="post_comment_count">3</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19601644);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19601644', targetLink: 'https://www.cnblogs.com/bu-huo/p/19601644', title: 'å¤§æ¨¡åRAGå®æï¼ä»è¢«éªä¸é è°±å°æä¸ºé¨é¨MVPï¼è¿æ¯æçè¸©åå¨è®°å½' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ºä»ä¹ AI æå¡å¨é¦é Ubuntuï¼é¾é OEL å RHEL ä¸é¦åï¼ ]]></title>
    <link>https://www.cnblogs.com/jyzhao/p/19601634/wei-shen-me-ai-fu-wu-qi-shou-xuan-ubuntu-nan-dao-o</link>
    <guid>18a64d4843eac8cb7c0dd84c03b541d2</guid>
    <description>
    <![CDATA[ 
    <a name="top"></a>
    <h2><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jyzhao/p/19601634/wei-shen-me-ai-fu-wu-qi-shou-xuan-ubuntu-nan-dao-o" title="åå¸äº 2026-02-10 22:06">
    <span role="heading" aria-level="2">ä¸ºä»ä¹ AI æå¡å¨é¦é Ubuntuï¼é¾é OEL å RHEL ä¸é¦åï¼</span>
    

</a>
</h2>
    <small>
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-10 22:06">2026-02-10 22:06</span>&nbsp;
<a href="https://www.cnblogs.com/jyzhao">AlfredZhao</a>&nbsp;
éè¯»(<span id="post_view_count">196</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19601634);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19601634', targetLink: 'https://www.cnblogs.com/jyzhao/p/19601634/wei-shen-me-ai-fu-wu-qi-shou-xuan-ubuntu-nan-dao-o', title: 'ä¸ºä»ä¹ AI æå¡å¨é¦é Ubuntuï¼é¾é OEL å RHEL ä¸é¦åï¼' })">ä¸¾æ¥</a>
</small>
    <div class="entry">
        <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨ AI åå­éï¼å¦æä½ å»ç§ä¸å° GPU ç®åæå¡å¨ï¼æèçå¤§æ¨¡åçé¨ç½²æç¨ï¼ä½ ä¼åç°ä¸ä¸ªæè¶£çç°è±¡ï¼<strong>Ubuntu å ä¹æ¯é»è®¤éé¡¹</strong>ã</p>
<p>å¾å¤ä¹ æ¯äºä¼ä¸çº§ç³»ç»ï¼å¦ RHELãCentOS æ OELï¼çæåå¯è½ä¼çº³é·ï¼æ¢ç¶ NVIDIA é©±å¨ä¹æ¯æçº¢å¸½ç³»ç³»ç»ï¼ä¸ºä»ä¹å¤§å®¶ååå¯¹ Ubuntu è¿ç§âç¤¾åºæâåè¶³çç³»ç»ææç¬éï¼</p>
<p>ä»å¤©ï¼ç¬èå°±å¸¦å¤§å®¶æè§£è¿èåçé»è¾ã</p>
<h2 id="01--å¼å®¹æ§éè§é©±å¨ä¸æ¯é¨æ§çæææ¯">01 | å¼å®¹æ§éè§ï¼é©±å¨ä¸æ¯é¨æ§ï¼çæææ¯</h2>
<p>é¦åè¦çº æ­£ä¸ä¸ªè¯¯åºï¼å¹¶ä¸æ¯ NVIDIA é©±å¨ä¸æ¯æçº¢å¸½ç³»ç³»ç»ãäºå®ä¸ï¼NVIDIA å®æ¹ä¸º RHEL å OELï¼Oracle Enterprise Linuxï¼æä¾äºè¯¦å°½çå®è£åã</p>
<h3 id="-ä»£ç è½è·åç¯å¢å¥½éæ¯ä¸¤åäº">â  âä»£ç è½è·âåâç¯å¢å¥½éâæ¯ä¸¤åäº</h3>
<p>å¨ AI é¢åï¼å¾å¤å¼æºé¡¹ç®ï¼å¦ PyTorchãTensorFlowï¼å¨å¼åæ¶ï¼ç¨åºåæ¡é¢ä¸è·çåºæ¬é½æ¯ Ubuntuãè¿æå³çï¼å ä¹ææç GitHub é¡¹ç® README é½ä¼æ æ³¨ä¸è¡ï¼<em>âTested on Ubuntu 22.04â</em>ã</p>
<h3 id="-é¿åææ¬çåå¼">â¡ é¿åææ¬çåå¼</h3>
<p>å¦æä½¿ç¨ RHEL/OEL å®è£å¤§æ¨¡åï¼å¯è½ä¼éå° GLIBC çæ¬è¿ä½ãå¨æé¾æ¥åºä¸å¹éç­é®é¢ãèå¨ Ubuntu ä¸ï¼è¿äºåæ©å°±è¢«å¨çå¼åèå¡«å¹³äºã</p>
<h2 id="02--éåº¦ä¸æ¿æçç¢°æåç®¡çå¨çä¼å¿">02 | éåº¦ä¸æ¿æçç¢°æï¼åç®¡çå¨çä¼å¿</h2>
<p>AI ææ¯çåå±æ¥æ°æå¼ï¼è¿å°±è¦æ±æä½ç³»ç»å¿é¡»è·ä¸èå¥ã</p>
<h3 id="-æ´æ°ç­ç¥çå·®å¼">â  æ´æ°ç­ç¥çå·®å¼</h3>
<ul>
<li><strong>RHEL/OEL</strong>ï¼æ ¸å¿è¯æ±æ¯âæè´ç¨³å®âï¼è½¯ä»¶åºæ´æ°ä¿å®ãå¯¹äºéè¦ææ° GCC ç¼è¯å¨æ¯æç AI æ¡æ¶æ¥è¯´ï¼æå¨ç¼è¯ä¾èµåçè¿ç¨æå¶çè¦ã</li>
<li><strong>Ubuntu</strong>ï¼å¨ç¨³å®ä¸æ°é²æä¹é´æ¿æå¾æå¥½ãææ°ç PythonãCUDA Toolkit å¾å¾è½éè¿å®æ¹ä»åºæ PPA å¿«éè·åã</li>
</ul>
<h3 id="-dkms-çèªå¨åé­æ³">â¡ DKMS çèªå¨åé­æ³</h3>
<p>Ubuntu é©±å¨å®è£éå¸¸éå DKMS ææ¯ãå½ä½ åçº§ç³»ç»åæ ¸æ¶ï¼é©±å¨ä¼èªå¨éæ°ç¼è¯ééãèå¨çº¢å¸½ç³»ç³»ç»ä¸ï¼åæ ¸åçº§åé©±å¨å¤±ææ¯æ°æçâå¸¸å®¢âé®é¢ã</p>
<h2 id="03--å®¹å¨åæ¶ä»£çå¿ç¶åºåº§çéèº«">03 | å®¹å¨åæ¶ä»£çå¿ç¶ï¼åºåº§çâéèº«â</h2>
<p>ç°å¨ç GPU ä»»å¡ï¼ç»å¤§å¤æ°é½æ¯è·å¨ Docker éçã</p>
<h3 id="-å®¿ä¸»æºåªéå½å¥½æå¡å">â  å®¿ä¸»æºåªéå½å¥½âæå¡åâ</h3>
<p>å¨å®¹å¨åæ¶æä¸ï¼å®¿ä¸»æºæä½ç³»ç»åªéè¦åä¸¤ä»¶äºï¼æä¾ç¨³å®çåæ ¸åæè½½å¥½æ¾å¡é©±å¨ã</p>
<h3 id="-éåçæçç»ä¸">â¡ éåçæçç»ä¸</h3>
<p>æ¢ç¶å¤§å¤æ° AI éåçåºå±ï¼Base Imageï¼é½æ¯åºäº Ubuntu çï¼ä¸ºäºåå°å®¿ä¸»æºåæ ¸ä¸å®¹å¨ä¹é´çå¾®å°æ©æ¦ï¼éæ© Ubuntu ä½ä¸ºâå¤§åºåº§âèªç¶æäºæ§ä»·æ¯æé«çæ¹æ¡ã</p>
<h2 id="04--ä»ä¹æ¶åè¯¥é-rhel-æ-oel">04 | ä»ä¹æ¶åè¯¥é RHEL æ OELï¼</h2>
<p>å¨ä»¥ä¸ç¹å®åºæ¯ä¸­ï¼ç¬èä¾ç¶å»ºè®®éæ©ä¼ä¸çº§ç³»ç»ï¼</p>
<ul>
<li><strong>æè´çå®å¨åè§</strong>ï¼éèãæ¿å¡ç­é¢åæä¸¥æ ¼çå®¡è®¡è¦æ±ã</li>
<li><strong>é¿æææ¯æ¯æ</strong>ï¼å¦æä½ éè¦æä¾ååå·¥ç¨å¸çº§å«çåä¸ä¿éã</li>
</ul>
<h2 id="05--ç¬èçæ»ç»">05 | ç¬èçæ»ç»</h2>
<p><strong>é©±å¨ä¸æ¯é®é¢ï¼çæææ¯å³é®ã</strong> å°±åç©æ¸¸æé¦é Windows ä¸æ ·ï¼å¨ AI é¢åï¼Ubuntu å·²ç»æäºäºå®ä¸çâæ åç­æ¡âãé¡ºççæèµ°ï¼è½è®©ä½ çä¸ 80% è°ç¯å¢çæ¶é´å»è·æ¨¡åã</p>


</div>
<div id="MySignature" role="contentinfo">
    <a href="https://www.cnblogs.com/jyzhao/" target="_blank">AlfredZhao</a>Â©çæææãä»Oracleèµ·èªï¼é¢ç¥ç²¾å½©çITææ¯ãã<br>
è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/jyzhao/p/19601634/wei-shen-me-ai-fu-wu-qi-shou-xuan-ubuntu-nan-dao-o" target="_blank">https://www.cnblogs.com/jyzhao/p/19601634/wei-shen-me-ai-fu-wu-qi-shou-xuan-ubuntu-nan-dao-o</a>
<hr>
<div style="text-align:center; margin-top:30px;">
  <p style="font-size:14px;color:#555;">
    ð æè°¢éè¯»ï¼æ¬¢è¿å³æ³¨æçå¬ä¼å· <b>ãèµµéå®ã</b>
  </p>
  <img src="https://images.cnblogs.com/cnblogs_com/jyzhao/824234/o_250208075013_qrcode-zjy.jpg" width="160" style="border:1px solid #ddd;border-radius:8px;">
</div>
</div>
<div class="clear"></div>

        <div class="clear"></div>
        
</div>
    <ul class="postmetadata">
        <vc:categories-tags blog-app="jyzhao" blog-id="186567" post-id="19601634"></vc:categories-tags>
    </ul>
 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ SEALå¨åæå å¯CKKSæ¹æ¡å¥é¨è¯¦è§£ ]]></title>
    <link>https://www.cnblogs.com/zhaoweiwei/p/19577832/CKKS</link>
    <guid>03015066f59c9f000f9b729b9827f881</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/zhaoweiwei/p/19577832/CKKS" title="åå¸äº 2026-02-10 18:22">
    <span role="heading" aria-level="2">SEALå¨åæå å¯CKKSæ¹æ¡å¥é¨è¯¦è§£</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æä»¥å¾®è½¯çå¼æºå¨åæåºSEALä¸­CKKSæ¹æ¡ä¸ºåç§ï¼ä¾æ¬¡ä»ç»äºCKKSæ¹æ¡ç¸å³çæ ¸å¿åçï¼ä»¥åæ¹æ¡å®æ½æ åæµç¨ï¼æåç»åºäºä¸ä¸ªä¸ä¸ªç®åçSEALåºCKKSæ¹æ¡ç¤ºä¾ç¨åºï¼å¹¶ç»åºç¸åºçè¿è¡ç»æã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p align="left">CKKSï¼CheonâKimâKimâSongï¼æ¯2017å¹´è®ºæãHomomorphic Encryption for Arithmetic of Approximate Numbersãä¸­æåºçè¿ä¼¼è®¡ç®åæå å¯ç®æ³ï¼è®ºæçä½èæ¯Cheonç­åä½é©å½ç ç©¶èï¼å¦ä»è¯¥æ¹æ¡å·²ç»æ¯é¢åæµ®ç¹/å¤æ°è¿ä¼¼åæè®¡ç®çä¸»æµæ¹æ¡ï¼å¹¿æ³åºç¨äºå¯ææºå¨å­¦ä¹ ãæ°å¼è®¡ç®åºæ¯ãä¸åäºä»¥å¾åæå å¯ç®æ³ä¸­æè¿½æ±çè§£å¯ç»æåææå®å¨ä¸è´ï¼CKKSç®æ³çç®æ æ¯åè¿ä¼¼è®¡ç®ãè¿å¹¶ä¸åç¦»éæ±ï¼å ä¸ºç°å®çæ´»ä¸­å¤§é¨åè¿ç®ï¼é¢å¯¹çæ¯å®æ°ï¼å¤æ°ï¼ï¼èå®æ°ï¼å¤æ°ï¼çè¿ç®ï¼å¾å¾åªéè¦ä¿çä¸é¨åæææ°å­å³å¯ãæ­¤å¤ï¼åè®¸è¯¯å·®ï¼æ¾å®½åç¡®æ§çéå¶ï¼ä½¿å¾CKKSå¯¹æ¯äºå¶ä»åºäºLWE/RLWEé¾é¢çåææ¹æ¡ï¼ç»èæäºè¾å¤§çç®åï¼è®¡ç®æçä¹æäºå¾å¤§æåã</p>
<h1>1 æ ¸å¿åç</h1>
<h2>1.1 ç¼ç ä¸åµå¥åç</h2>
<p align="left">CKKSçæ ¸å¿åæ°æ¯è§èåµå¥ï¼Canonical Embeddingï¼ï¼å°ç¯Rä¸çå¤é¡¹å¼ä¸å¤æ°ç©ºé´C<sup>N/2</sup>ååæ å°ï¼</p>
<p align="left">ï¼1ï¼å¤é¡¹å¼<em>f(x)âR</em>å¯éè¿ååå¤é¡¹å¼çæ ¹æ å°ä¸ºN/2ç»´å¤æ°åé</p>
<p align="left">ï¼2ï¼å¤æ°åéå¯ååæ å°ä¸ºç¯ä¸å¤é¡¹å¼ï¼å®ç°åéæ°æ®ä¸å¤é¡¹å¼çæ æè½¬æ¢</p>
<p align="left">ï¼3ï¼ç»åç¼©æ¾å å­Î=2<sup>k</sup>ï¼å°æµ®ç¹æ°æ¾å¤§ä¸ºæ´æ°ï¼ééæéåè¿ç®</p>
<p align="left">æ§½ä½æ°é=N/2ï¼ä¾å¦N=8192æ¶ï¼åå¯æå¯æå4096ä¸ªæµ®ç¹æ°å¹¶è¡è¿ç®ãRæ¯ååå¤é¡¹å¼ç¯ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209110608893-1701884716.png" alt="image" width="353" height="34" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ç¯ä¸­çåç´ æ¯ç³»æ°æ¯æ´æ°ï¼ä¸¥æ ¼æ¥è¯´æ¯å®æ°ï¼çNæ¬¡å¤é¡¹å¼ã</p>
<p align="left">C<sup>N/2</sup>æ¯N/2ç»´å¤æ°åéææçç¯ï¼å®éé¢çåç´ æ¯N/2ç»´å¤æ°åéãè§èåµå¥æ¯ç¯åæï¼ä¿æç¯å æ³ä¸ä¹æ³çååä¸ä¸æ å°ï¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209120035570-1372830017.png" alt="image" width="150" height="32" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>è®¾Î¶<sub>j</sub> = e<sup>i(2j+1)Ï/N</sup>ï¼j = 0,1,...,N-1æ¯x<sup>N</sup> + 1 = 0ï¼å³x<sup>N</sup> = -1 = e<sup>iÏ</sup>çNä¸ªåæ ¹ï¼åÏä»å·¦å°å³è¡¨ç¤ºä¸ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209120224137-710695710.png" alt="image" width="474" height="40" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>Ïæä»¥ä¸å³é®æ§è´¨ï¼</p>
<p>ï¼1ï¼å æ³æ å°ä¸ºåéå æ³ï¼å³Ï(f+g) =&nbsp;Ï(f) +&nbsp;Ï(g)</p>
<p>ï¼2ï¼ä¹æ³æ å°ä¸ºåééåç´ ä¹æ³ï¼Hadamardç§¯ï¼Ï(fâ¢g) =&nbsp;Ï(f)&nbsp;â¢&nbsp;Ï(g)</p>
<p>ï¼3ï¼åå°ï¼å¯éï¼</p>
<p>å¯ä»¥ä»åéè¿åå¤é¡¹å¼ï¼éæ å°ï¼ï¼æ¥ä¸æ¥ä»¥N=8ä¸ºä¾ï¼ä»æ­£åä¸¤ä¸ªæ¹é¢è¿è¡åæã</p>
<h3>1 æ­£åæ å°ï¼canomical embedding R-&gt;C<sup>4</sup>ï¼</h3>
<p>å½N=8æ¶ï¼ç¯è¡¨ç¤ºä¸ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209120812481-583938144.png" alt="image" width="193" height="27" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ç¯ä¸­çåç´ ä¸ºå¤é¡¹å¼ï¼f(x)=a<sub>0</sub>+a<sub>1</sub>x+a<sub>2</sub>x<sup>2</sup>+...+a<sub>7</sub>x<sup>7</sup>ï¼x<sup>8</sup>+1=0çåæ ¹ä¸ºï¼x=e<sup>i(2k+1)Ï/8</sup>ï¼k=0,1,...,7ï¼ç±åæ ¹çå±è½­å¯ç¥ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210101831409-1941165188.png" alt="image" width="270" height="262" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p align="left">åæ­£åæ å°å°å¤é¡¹å¼æ å°ä¸ºå¤æ°åéï¼è¡¨ç¤ºä¸ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209121233176-213381444.png" alt="image" width="445" height="35" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ä»¥ä¸åªåå4ä¸ªæ ¹ï¼å ä¸ºç±äºå±è½­æï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209121546561-1996158330.png" alt="image" width="333" height="32" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ä»¥å¤é¡¹å¼f(x) = 1 + 2x + 3x2ä¸ºä¾ï¼è®¡ç®ç¬¬ä¸ä¸ªæ§½ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209121709917-1592425942.png" alt="image" width="571" height="99" loading="lazy" style="display: block; margin-left: auto; margin-right: auto">åçå¯å¾4ç»´åéçå¶ä»åéï¼ä»èå®æå¤é¡¹å¼åå¤åéçæ å°ï¼Ï(f) = (z<sub>0</sub>,z<sub>1</sub>,z<sub>2</sub>,z<sub>3</sub>)âC<sup>4</sup>ãè¿ä¸æ­¥æ¬è´¨ä¸å°±æ¯FFTçååé¨åï¼ð(ð¥)æ8ä¸ªå®èªç±åº¦ï¼èå¤åéçèµ·æ¥åªæ4ä¸ªèªç±åº¦ï¼ä½æ¯å ä¸ºð§<sub>i</sub>æ¯å¤æ°ï¼å®æ¬èº«æ2ä¸ªå®èªç±åº¦ï¼æä»¥æ»ä½ä¸æ¥è¯´å¤åéæ4x2=8ä¸ªå®èªç±åº¦ã</p>
<h3>2 éåæ å°ï¼C<sup>4</sup>-&gt;Rï¼</h3>
<p>éåæ å°å°å¤æ°åéæ å°ä¸ºå¤é¡¹å¼ï¼ç±(z<sub>0</sub>,z<sub>1</sub>,z<sub>2</sub>,z<sub>3</sub>)âC<sup>4</sup>æ¢å¤ä¸ä¸ªå¤é¡¹å¼ï¼æé é¿åº¦ä¸º8çâé¢ååéâï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209150228446-1761094550.png" alt="image" width="298" height="29" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¯ä¸å¤é¡¹å¼f(x)æ»¡è¶³ï¼f(Î¶<sub>k</sub>) = z<sub>k</sub>ï¼k = 0,1,2,...,7ï¼å©ç¨Lagrangeæå¼ï¼å·¥ç¨ä¸å¯¹åºinverse FFTï¼å³å¯å¾å°ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209150615101-1539219155.png" alt="image" width="351" height="28" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¶ä¸­ææa<sub>i</sub>âRãè¿éçååæ å°æ­£æ¯CKKS Encode/Decodeå¨åçäºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209150904927-1228266632.png" alt="" width="637" height="234" style="display: block; margin-left: auto; margin-right: auto"></p>
<h2>1.2 ç¼©æ¾å å­ï¼Scaleï¼åè¿ä¼¼è®¡ç®</h2>
<p>CKKSä¸è¿½æ±ç»å¯¹ç²¾ç¡®ï¼è§£å¯ç»æä¸åå§ææå­å¨æå°ç²¾åº¦è¯¯å·®ï¼è¯¯å·®å¯æ§ä¸è¿ä½äºæºå¨å­¦ä¹ /æ°å¼åæçå®¹å¿éå¼ï¼è¿æ¯æçä¸å®ç¨æ§çå¹³è¡¡è®¾è®¡ï¼ä¸ºäºå®ç°è¯¥ç®æ å¼å¥äºç¼©æ¾å å­ï¼ç¼©æ¾å å­å¨âæå®/å¤æ°åµå¥æ´æ°å¤é¡¹å¼ç¯âæ¶ï¼ç±âç¼©æ¾+èå¥âä¸å¯é¿åå¼å¥äºç²¾åº¦è¯¯å·®ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209151018659-2008326500.png" alt="image" width="300" height="29" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ä»ä»¥N=8ä¸ºä¾è¯´æç¸åºæµç¨ï¼åæ¬æ å°</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209151905200-426056642.png" alt="image" width="485" height="33" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>æ¯ä¸å¯¹é¶è¯¯å·®çä¸¥æ ¼åå°ï¼ä½æ¯CKKSè¦åä¸ä»¶âéæ³çäºâï¼éåæ å°ç±å®/å¤æ°è½¬æ¢ææ´ç³»æ°å¤é¡¹å¼ï¼å°±æ¯ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209152020759-2070476129.png" alt="image" width="488" height="34" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>æä½æ¬èº«å°±ä¸å¯è½ç²¾ç¡®å®æï¼åå å¾ç®åï¼å·¦è¾¹æ¯è¿ç»­åï¼å³è¾¹æ¯ç¦»æ£æ ¼ï¼CKKSçè§£å³æ¹æ¡æ¯è¿è¡âç¼©æ¾+èå¥ï¼è¯¯å·®æºå¤´ï¼âï¼é¦åå¼å¥ä¸ä¸ªscale Îï¼å¨æ å°åå¯¹å¤åéè¿è¡ç¼©æ¾ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209153919946-1630554091.png" alt="" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>è¿ä¸æ­¥åªæ¯æ¾å¤§å¹¶æ²¡æå¼å¥è¯¯å·®ï¼æ¥ä¸æ¥è¿è¡éembeddingï¼IFFTï¼å¾å°å®ç³»æ°å¤é¡¹å¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209153919937-1690109536.png" alt="" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>çè®ºä¸è¿ä¸æ­¥ä»ç¶æ¯ç²¾ç¡®çï¼ä½æ¯å¨è¿è¡éåä¸æ­¥èå¥å°æ´ç³»æ°æ¶ä¼äº§çè¯¯å·®ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209153919914-412330373.png" alt="" style="display: block; margin-left: auto; margin-right: auto"></p>
<p align="left">ä»¤ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209152958825-135711869.png" alt="image" width="225" height="33" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¶ä¸­e(x)çæ¯ä¸ªç³»æ°é½æ»¡è¶³|e<sub>i</sub>|â¤1/2ï¼å½æ å°åslotç©ºé´æ¶ï¼ä¼å¯¹m(x)ååcanonical embeddingï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209153222424-1033559120.png" alt="image" width="186" height="29" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>èï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209153258782-1352680454.png" alt="image" width="276" height="33" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>æä»¥ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209153349080-2016492421.png" alt="image" width="502" height="32" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¶ä¸­Îµ<sub>k</sub> = e(Î¶<sub>k</sub>)ï¼æåä¼é¤äºscale Îï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260209153623063-989735394.png" alt="image" width="440" height="59" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>è¿å°±æ¯CKKSçâè¿ä¼¼âï¼å¯¹æ¯BFVä¸­çâèå¥âï¼ä»ä»¬çå«ä¹å®å¨ä¸åï¼</p>
<p>BFVçèå¥æ¯ï¼</p>
<p align="left">å¨æ¨¡tæä¹ä¸ï¼åæ´æ°æ·»å åªå£°ï¼åæâæ´æ°+å°åªå£°âæ å°ååä¸ä¸ªæ´æ°ï¼åªè¦åªå£°åæ§è¯¥è¿ç¨å°±æ¯ä¹åæä½çç²¾ç¡®éæä½ã</p>
<p align="left">CKKSçèå¥æ¯ï¼</p>
<p align="left">æâè¿ç»­å®æ°âæ å°å°æè¿çæ´æ°ï¼åææ´æ°æ å°åå®æ°ï¼è¯¥è¿ç¨å¹¶ä¸æ¯ä¹åæä½çç²¾ç¡®éæä½ï¼æä»¥äº§çâè¿ä¼¼âã</p>
<p>ä¸å¥è¯ï¼BFVéroundç¨äºâçº éâï¼CKKSéroundç¨äºâè¿ä¼¼âãå¨SEALä¸­å¸¸ç¨2^40ï¼ç²¾åº¦ä¸åªå£°è¾¾å°å¹³è¡¡ã</p>
<h2>1.3 åªå£°ç®¡ç</h2>
<p>å¨CKKSä¸­ï¼åªå£°ç®¡çä¸»è¦ä¾é Rescalingï¼éç¼©æ¾ï¼æºå¶ï¼å®éåRNSé¾ï¼å®ç°äºå¯¹åªå£°çâé¶æ¢¯å¼âç²¾åæ§å¶ã</p>
<h3>1 CKKSåªå£°çç»æé¨å</h3>
<p>CKKSçåªå£°eå¹¶ä¸æ¯åä¸æ¥æºï¼å®æ¯ç±ä¸é¨åå å èæçï¼</p>
<p><strong>åå§åªå£°ï¼e<sub>rlwe</sub>ï¼ï¼</strong>å å¯æ¶å¼å¥çç¦»æ£é«æ¯åªå£°ï¼ç¨äºä¿éå®å¨æ§ã</p>
<p><strong>ç¼ç è¯¯å·®ï¼e<sub>enc</sub>ï¼ï¼</strong>å°æµ®ç¹æ°ç¼©æ¾å¹¶èå¥å°æ´æ°å¤é¡¹å¼æ¶åæ°çæå¤±ã</p>
<p><strong>è®¡ç®è¯¯å·®ï¼e<sub>comp</sub>ï¼ï¼</strong>åæä¹æ³åéçº¿æ§åå¼å¥çåªå£°ã</p>
<p>å¨CKKSä¸­ï¼æä»¬ä¸åºåâåªå£°âåâè¯¯å·®âãç¼©æ¾å å­Î<span class="math-inline" data-math="\Delta" data-index-in-node="34">å³å®äºææçç²¾åº¦ï¼èåªå£°åªè¦ä¸ä¾µèå°Îå®ä¹çææä½ï¼è®¡ç®å°±æ¯å¯é çã</span></p>
<h3><span class="math-inline" data-math="\Delta" data-index-in-node="34">2 æ ¸å¿æºå¶ï¼Rescalingï¼éç¼©æ¾ï¼</span></h3>
<p><span class="math-inline" data-math="\Delta" data-index-in-node="34">å½æä»¬åä¸æ¬¡åæä¹æ³ï¼</span></p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260211112226209-655796869.png" alt="image" width="261" height="23" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><span class="math-inline" data-math="\Delta" data-index-in-node="34">å¦æä¸å¤çï¼è¿ç»­ä¹æ³ä¼å¯¼è´æ°å¼è¿éçç¸ï¼è¶åºæ¨¡æ°qçèå´ãæ­¤æ¶å°å¯æé¤äºä¸ä¸ªRNSç´ æ°q<sub>l</sub>ï¼éå¸¸è®¾q<sub>l</sub>âÎï¼ï¼å¹¶è¿è¡èå¥ï¼</span></p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210175745316-581058742.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ç»æï¼</p>
<p>ï¼1ï¼ç¼©æ¾å å­åå½ï¼Î<sup>2</sup>/q<sub>l</sub>&nbsp;â Îï¼ææä½åå°äºæ­£ç¡®çä½ç½®ã</p>
<p>ï¼2ï¼åªå£°åæ­¥ç¼©åï¼åæ¬çåªå£°eä¹è¢«é¤äºäºq<sub>l</sub>ï¼æ°åªå£°ä¸ºï¼e/q<sub>l</sub>+èå¥è¯¯å·®</p>
<p>å¯è§Rescalingä¸ä»æè¨èçæ°å¼æåæ¥ï¼åæ¶é¡ºææå¢é¿çåªå£°ä¹ææ¯ä¾ç¼©å°äºã</p>
<h3><span class="math-inline" data-math="\Delta" data-index-in-node="34">3 RNSé¾ä¸å±ï¼Levelsï¼çåªå£°æ§å¶</span></h3>
<p><span class="math-inline" data-math="\Delta" data-index-in-node="34">å¨å®éå®ç°ä¸­ï¼æ¨¡æ°Qæ¯Lä¸ªå°æ¨¡æ°ä¹ç§¯Q=q<sub>0</sub>Â·q<sub>1</sub>Â·...Â·q<sub>L-1</sub></span><span class="math-inline" data-math="\Delta" data-index-in-node="34">ï¼æ¯ä¸å±è®¡ç®é½å¯¹åºé¾ä¸­çä¸ä¸ªç´ æ°ï¼ä»¥L=4ä¸ºä¾ç»åºæµç¨ï¼</span></p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210181153276-276909400.png" alt="image" width="469" height="186" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>&nbsp;ä»¥ä¸æ¯ä¸å±Rescalingé½ä¼åææ»æ¨¡æ°Qççº¦pæ¯ç¹ï¼åè®¾Î=2<sup>p</sup>ï¼ï¼å½RNSé¾åªå©ä¸æåä¸ä¸ªç´ æ°q<sub>0</sub>æ¶ï¼æ æ³åè¿è¡Rescalingï¼æ­¤æ¶ååä¹æ³ï¼åªå£°å°æ æ³è¢«ç¼©å°ï¼ä¼è¿éè¦çæææææä½ãåè®¾Qä¸º600bitï¼Îä¸º40bitï¼Qè½æ¯æçº¦600/40=15å±ä¹æ³ï¼ç®å°ç¬¬15å±æ¶ï¼æ¨¡æ°åªå©40bitå·¦å³ï¼æ­¤æ¶åªå£°åæææ··å¨ä¸èµ·ï¼æ æ³ååãä¸BFVçåºå«ï¼BFVçåªå£°ç®¡çæ¯ä¸ºäºä¿ä½âæ´æ°çç»å¯¹åç¡®âï¼CKKSçåªå£°ç®¡çæ¯ä¸ºäºä¿ä½âæµ®ç¹æ°çææç²¾åº¦âã</p>
<h1>2 CKKSæ åæµç¨åå</h1>
<p>ä»¥SEALåºä¸ºä¾ï¼å®æ´æµç¨åä¸º5ä¸ªé¶æ®µã</p>
<h2>2.1 ç³»ç»åå§åä¸åæ°çæ</h2>
<p><strong>è¾å¥åæ°ï¼</strong></p>
<p>å¤é¡¹å¼æ¨¡æ¬¡æ°Nï¼2çæ´æ°å¹ï¼</p>
<p>æ¨¡æ°é¾ç³»æ°{q<sub>1</sub>,q<sub>2</sub>,...,q<sub>L</sub>}ï¼éååºåï¼å³å®è¿ç®æ·±åº¦ï¼</p>
<p>ç¼©æ¾å å­Î=2<sup>k</sup>ï¼æ§å¶è®¡ç®ç²¾åº¦ï¼</p>
<p>é«æ¯åªå£°åå¸Ïï¼RLWEåºç¡åªå£°ï¼</p>
<p><strong>è¾åºåæ°ï¼</strong></p>
<p>åæ³çSEALä¸ä¸æ</p>
<h2>2.2 å¯é¥çæ</h2>
<p>åºäºRLWEé®é¢çæå¯é¥ç»ï¼ç§é¥ç»å¯¹ä¿å¯ï¼å¬é¥/è¾å©å¯é¥å¯å¬å¼ååã</p>
<p>ï¼1ï¼ç§é¥sk</p>
<p>éæºéæ ·å°èæ°å¤é¡¹å¼ï¼skâRï¼ç³»æ°ä»ä¸º-1/0/1ï¼</p>
<p>ï¼2ï¼å¬é¥<em>pk=(b,a)</em></p>
<p>aï¼ç¯ä¸éæºå¤é¡¹å¼</p>
<p>bï¼b=-(aÂ·sk + e<sub>pk</sub>)ï¼å¶ä¸­e<sub>pk</sub>æ¯é«æ¯åªå£°å¤é¡¹å¼</p>
<p>ï¼3ï¼éçº¿æ§åå¯é¥rlk</p>
<p>&nbsp;ç¨äºå¯æä¹æ³åçç»´åº¦åç¼©ï¼ç±ç§é¥å å¯æ´¾çï¼æå¡å¨æ§è¡éçº¿æ§åæ¶ä½¿ç¨ã</p>
<p>ï¼4ï¼æè½¬å¯é¥rot_kï¼å¯éï¼</p>
<p>ç¨äºå¯ææ§½ä½æè½¬ï¼å®ç°åéæ°æ®éæãæ±åç­é«é¶è¿ç®ã</p>
<h2>2.3 ç¼ç ä¸å å¯</h2>
<h3><strong>æ­¥éª¤1 ææç¼ç ï¼æµ®ç¹æ°/å¤æ°-&gt;å¤é¡¹å¼ï¼</strong></h3>
<p>è¯¥æ­¥ä¼å°å®æ°/å¤æ°åézâC<sup>N/2</sup>è½¬æ¢ä¸ºææå¤é¡¹å¼ã</p>
<p>ï¼1ï¼æé å¯¹ç§°åéï¼Symmetry Constructionï¼</p>
<p>å¨è¿è¡åæ¢åï¼é¦åæé ä¸ä¸ªé¿åº¦ä¸ºNçåéZï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210103120361-1359664060.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>åéçåé¨é¨åæ¯ååé¨åçå±è½­ï¼è¿ç§å¯¹ç§°æ§ä¿è¯äºä¸ä¸æ­¥IFFTåºæ¥çå¤é¡¹å¼ç³»æ°å¨é¨æ¯å®æµ®ç¹æ°ã</p>
<p>ï¼2ï¼æ­£ååµå¥éåæ¢ï¼IFFTï¼</p>
<p>å°é¿åº¦ä¸ºNçå¯¹ç§°åéZè¿è¡éåæ¢ï¼å¾å°ä¸ä¸ªå¤é¡¹å¼p(x)ï¼å¶ç³»æ°a<sub>i</sub>çè®ºä¸åºè¯¥æ¯å®æ°ï¼ç±äºæµ®ç¹æ°è®¡ç®ç²¾åº¦é®é¢ï¼å¯è½ä¼ææå°çèé¨ï¼éå¸¸ç´æ¥èå¼ï¼ã</p>
<p>ï¼3ï¼ç¼©æ¾ä¸èå¥ï¼Scaling &amp; Roundingï¼</p>
<p>å¯¹å®æµ®ç¹æ°ç³»æ°è¿è¡æä½ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210103703414-337958342.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ç±æ­¤å¾å°äºç³»æ°ä¸ºå®æ´æ°çå¤é¡¹å¼ptã</p>
<p>ä»¥N=4ä¸ºä¾ï¼åè®¾z=(3,4)ï¼åé¦åå¯¹zè¿è¡æ©å±Z=(3,4,4,3)ï¼å ä¸º3å4å¯ä»¥çä½æ¯èé¨ä¸ºé¶çå¤æ°ï¼æä»¥Zåéååé¨åçå±è½­åååé¨åå®å¨ç¸åãæ¥ä¸æ¥ç®æ æ¯å°Zæ å°ä¸ºå¤é¡¹å¼p(x)=a<sub>0</sub>+a<sub>1</sub>x+a<sub>2</sub>x<sup>2</sup>+a<sub>3</sub>x<sup>3</sup>ï¼å³éè¦æ¾å°å¤é¡¹å¼çå®ç³»æ°a<sub>0</sub>ï¼a<sub>1</sub>ï¼a<sub>2</sub>ï¼a<sub>3</sub>ãå¨CKKSä¸­ï¼ä½¿ç¨x<sup>4</sup>+1=0çåä½æ ¹ï¼å®ä»¬æ¯ï¼Î¶<sub>0</sub> = e<sup>iÏ/4</sup>ï¼Î¶<sub>1</sub>&nbsp;= e<sup>i3Ï/4</sup>ï¼Î¶<sub>2</sub>&nbsp;= e<sup>i5Ï/4</sup>ï¼Î¶<sub>3</sub>&nbsp;= e<sup>i7Ï/4</sup>ï¼Î¶<sub>2</sub>åÎ¶<sub>3</sub>æ¯Î¶<sub>1</sub>åÎ¶<sub>0</sub>çå±è½­ï¼åå¯¹äºå¤é¡¹å¼p(x)æ»¡è¶³ï¼p(Î¶<sub>0</sub>) = y<sub>0</sub> = 3ï¼p(Î¶<sub>1</sub>) = y<sub>1</sub> = 4ï¼p(Î¶<sub>2</sub>) = y<sub>2</sub> = 4ï¼p(Î¶<sub>3</sub>) = y<sub>3</sub> = 3ï¼å¯ä»¥å©ç¨IFFTéåæ¢ç³»æ°å¬å¼è¿è¡æ±è§£ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210120409880-138792570.png" alt="image" width="178" height="76" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ä¾æ¬¡è®¡ç®åä¸ªç³»æ°ï¼</p>
<p><strong>è®¡ç®a<sub>0</sub>ï¼</strong></p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210120540550-839957814.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><strong>è®¡ç®a<sub>1</sub>ï¼</strong></p>
<p>ç±ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210124216470-303321074.png" alt="image" width="627" height="52" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¯ç¥ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210125922014-1456750365.png" alt="image" width="766" height="68" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><strong>è®¡ç®a<sub>2</sub>ï¼</strong></p>
<p>ç±äºÎ¶<sub>0</sub><sup>-2</sup>&nbsp;= -iï¼Î¶<sub>1</sub><sup>-2</sup>&nbsp;= iï¼Î¶<sub>2</sub><sup>-2</sup>&nbsp;= -iï¼Î¶<sub>3</sub><sup>-2</sup>&nbsp;= iï¼å¯ç¥ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210123340956-1412279352.png" alt="image" width="371" height="44" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><strong>è®¡ç®a<sub>3</sub>ï¼</strong></p>
<p>ç±ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210140541152-203458374.png" alt="image" width="628" height="50" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¯ç¥ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210140632043-718239368.png" alt="image" width="760" height="70" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>ä»¥ä¸å¤é¡¹å¼ç³»æ°çè®¡ç®è¿ç¨å¯ä»¥çå°ï¼ç³»æ°ä¸­çèé¨ä¼å ä¸ºå±è½­å¯¹ç§°å®å¨æµæ¶ï¼åªå©å®é¨ï¼å¾å°å¤é¡¹å¼æ¯p(x)=3.5-0.3535x+0.3535x<sup>3</sup>ï¼åç»­å°å¨æ­¤å¤é¡¹å¼çåºç¡ä¸å¯¹é½ç³»æ°è¿è¡æ¾å¤§åèå¥å®æç¼ç æµç¨ã</p>
<h3>æ­¥éª¤2 ææå å¯ï¼ææ-&gt;å¯æï¼</h3>
<p>ç¼ç åçææå¤é¡¹å¼ptè¢«è½¬æ¢ä¸ºä¸ä¸ªåå«ä¸¤ä¸ªå¤é¡¹å¼çå¯æå¯¹(c<sub>0</sub>,c<sub>1</sub>)ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210104930702-266110462.png" alt="image" width="325" height="116" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¾ä¸­aï¼bæ¯å¬é¥å¯¹å¿çä¸¤é¨åï¼uæ¯å°èæ°éæºå¤é¡¹å¼ï¼e<sub>0</sub>ï¼e<sub>1</sub>æ¯é«æ¯åªå£°å¤é¡¹å¼ï¼Qæ¯å¯æå¤§æ¨¡æ°ã</p>
<h2>2.4 å¯æåæè¿ç®</h2>
<p>æ¯æå æ³ãæ éä¹ãå¯æä¹ãæè½¬ãæ±åç­è¿ç®ï¼æ¯CKKSçæ ¸å¿è½åã</p>
<h3>1 å¯æå æ³ï¼åæå ï¼</h3>
<p>è¾å¥ï¼ä¸¤ä¸ªåç»´åº¦å¯æct=(ct<sub>0</sub>,ct<sub>1</sub>)ï¼ct'=(ct<sub>0</sub>',ct<sub>1</sub>')</p>
<p>è¾åºï¼ct<sub>add</sub>=(ct<sub>0</sub>+ct<sub>0</sub>',ct<sub>1</sub>+ct<sub>1</sub>')</p>
<p>ç¹æ§ï¼æ ç»´åº¦è¨èï¼æ ééçº¿æ§åï¼åªå£°çº¿æ§å å ï¼è¿ç®åç¼©æ¾å å­ä¿æä¸åã</p>
<h3>2 å¯æä¹æ³ï¼åæä¹ï¼</h3>
<p>åå§ä¹æ³ï¼ä¸¤ä¸ªäºåç»å¯æç¸ä¹ï¼è¾åºä¸åç»å¯æct<sub>mult</sub>=(c<sub>0</sub>,c<sub>1</sub>,c<sub>2</sub>)ï¼å¶ä¸­c<sub>0</sub>=ct<sub>0</sub>â¢ct<sub>0</sub>'ï¼c<sub>1</sub>=ct<sub>0</sub>â¢ct<sub>1</sub>'+ct<sub>1</sub>â¢ct<sub>0</sub>'ï¼c<sub>2</sub>=ct<sub>1</sub>â¢ct<sub>1</sub>'ã</p>
<p>éçº¿æ§åï¼ä½¿ç¨éçº¿æ§åå¯é¥rlkï¼å°ä¸åç»åç¼©åæ åäºåç»ï¼æ¢å¤å¯æç»æ</p>
<p>éç¼©æ¾ï¼ä¹æ³åï¼ç¼©æ¾å å­åæÎ<sup>2</sup>ï¼ä¸ºäºé²æ­¢æ°å¼çç¸ï¼ä¼å°å¯æé¤äºÎå¹¶èå¥</p>
<p>æ¨¡åæ¢ï¼éä½æ¨¡æ°ï¼åæ­¥ç¼©æ¾æ°æ®ï¼åç¼©åªå£°ï¼ä¿è¯åç»­è¿ç®å¯è¡æ§</p>
<p>ç¹æ§ï¼åªå£°ææ°çº§å¢é¿ï¼å¿é¡»éåéçº¿æ§å+æ¨¡åæ¢ä½¿ç¨ã</p>
<h3>3 é«é¶è¿ç®</h3>
<p align="left">æ éä¹æ³ï¼å¯æä¸å¬å¼å¸¸æ°ç¸ä¹ï¼æ éå¯é¥</p>
<p align="left">æ§½ä½æè½¬ï¼ç§»å¨åä¸ªæ§½ä½æ°æ®ï¼éåæè½¬å¯é¥ä½¿ç¨</p>
<p align="left">æ§½ä½æ±åï¼æ¹éæ°æ®èåï¼éç¨äºç»è®¡è®¡ç®</p>
<h2>2.5 è§£å¯ä¸è§£ç </h2>
<h3>1 å¯æè§£å¯</h3>
<p>è¾å¥ï¼å¯æct=(ct<sub>0</sub>,ct<sub>1</sub>)ãç§é¥sk</p>
<p>è¾åºï¼è§£ç åææå¤é¡¹å¼</p>
<p>è§£å¯å¬å¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260211111217754-1008528333.png" alt="image" width="589" height="137" loading="lazy"></p>
<p>æåé¨åå¯ä»¥çä½æ¯æ»åªå£°ï¼åæï¼<em>pt<sub>dec</sub> = pt + e<sub>total</sub></em>ã</p>
<h3>2 ææè§£ç </h3>
<p align="left">ï¼1ï¼å»é¤æ¨¡æ°æ å°ï¼å°å¤é¡¹å¼è½¬æ¢ä¸ºå¤æ°åé</p>
<p align="left">ï¼2ï¼é¤äºç¼©æ¾å å­Îï¼è¿åä¸ºåå§å°ºåº¦çæµ®ç¹æ°</p>
<p align="left">ï¼3ï¼èå¼èé¨ï¼å®æ°åºæ¯ï¼ï¼å¾å°æç»è®¡ç®ç»æ</p>
<h1>3 ä»£ç ç¤ºä¾</h1>
<p>ä»¥ä¸æ¯SEALåºCKKSåæå å¯æ¹æ¡ç¤ºä¾ä»£ç ï¼</p>
<div class="cnblogs_code"><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" id="code_img_closed_9af04663-7ada-4354-b3f4-bb029e2f6e7d" class="code_img_closed"><img src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" id="code_img_opened_9af04663-7ada-4354-b3f4-bb029e2f6e7d" class="code_img_opened" style="display: none">
<div id="cnblogs_code_open_9af04663-7ada-4354-b3f4-bb029e2f6e7d" class="cnblogs_code_hide">
<pre>#include <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">seal/seal.h</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;iostream&gt;<span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;vector&gt;<span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;iomanip&gt;

<span style="color: rgba(0, 0, 255, 1)">using</span> <span style="color: rgba(0, 0, 255, 1)">namespace</span><span style="color: rgba(0, 0, 0, 1)"> seal;
</span><span style="color: rgba(0, 0, 255, 1)">using</span> <span style="color: rgba(0, 0, 255, 1)">namespace</span><span style="color: rgba(0, 0, 0, 1)"> std;

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å·¥å·å½æ°ï¼æå°æµ®ç¹åéï¼æ ¼å¼åè¾åºç»æ</span>
<span style="color: rgba(0, 0, 255, 1)">void</span> print_vector(<span style="color: rgba(0, 0, 255, 1)">const</span> vector&lt;<span style="color: rgba(0, 0, 255, 1)">double</span>&gt;&amp; vec, <span style="color: rgba(0, 0, 255, 1)">const</span> <span style="color: rgba(0, 0, 255, 1)">string</span>&amp; title, size_t print_size = <span style="color: rgba(128, 0, 128, 1)">5</span><span style="color: rgba(0, 0, 0, 1)">) {
    cout </span>&lt;&lt; title &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">: </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
    size_t limit </span>=<span style="color: rgba(0, 0, 0, 1)"> min(print_size, vec.size());
    </span><span style="color: rgba(0, 0, 255, 1)">for</span> (size_t i = <span style="color: rgba(128, 0, 128, 1)">0</span>; i &lt; limit; ++<span style="color: rgba(0, 0, 0, 1)">i) {
        cout </span>&lt;&lt; <span style="color: rgba(0, 0, 255, 1)">fixed</span> &lt;&lt; setprecision(<span style="color: rgba(128, 0, 128, 1)">3</span>) &lt;&lt; vec[i] &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span> <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
    }
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (vec.size() &gt; limit) cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">...</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
    cout </span>&lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
}

</span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> main() {
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ===================== 1. CKKS æ¹æ¡åæ°éç½® =====================
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¤é¡¹å¼æ¨¡æ¬¡æ°ï¼å³å®å®å¨ç­çº§ãæ§½ä½æ°éãè®¡ç®æ§è½ï¼å¿é¡»æ¯2çå¹</span>
    size_t poly_modulus_degree = <span style="color: rgba(128, 0, 128, 1)">8192</span><span style="color: rgba(0, 0, 0, 1)">;
    EncryptionParameters </span><span style="color: rgba(0, 0, 255, 1)">params</span><span style="color: rgba(0, 0, 0, 1)">(scheme_type::ckks);
    </span><span style="color: rgba(0, 0, 255, 1)">params</span><span style="color: rgba(0, 0, 0, 1)">.set_poly_modulus_degree(poly_modulus_degree);

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éç½®ç³»æ°æ¨¡æ°é¾ï¼CKKSæ ¸å¿ï¼éè¿æ¨¡åæ¢æ§å¶åªå£°åè®¡ç®æ·±åº¦
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 60, 40, 40, 60 è¡¨ç¤ºæ¨¡æ°é¾åæ®µï¼æ¯æ2å±ä¹æ³è¿ç®</span>
    <span style="color: rgba(0, 0, 255, 1)">params</span><span style="color: rgba(0, 0, 0, 1)">.set_coeff_modulus(CoeffModulus::Create(
        poly_modulus_degree, { </span><span style="color: rgba(128, 0, 128, 1)">60</span>, <span style="color: rgba(128, 0, 128, 1)">40</span>, <span style="color: rgba(128, 0, 128, 1)">40</span>, <span style="color: rgba(128, 0, 128, 1)">60</span><span style="color: rgba(0, 0, 0, 1)"> }
    ));

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå§åSEALä¸ä¸æï¼éªè¯åæ°åæ³æ§</span>
    SEALContext context(<span style="color: rgba(0, 0, 255, 1)">params</span><span style="color: rgba(0, 0, 0, 1)">);
    cout </span>&lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">SEAL CKKS åæ°åå§åå®æï¼å¤é¡¹å¼æ¨¡æ¬¡æ°: </span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; poly_modulus_degree &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
    cout </span>&lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å¯ç¨æ§½ä½æ°éï¼åå¯æå¯æåæ°æ®éï¼: </span><span style="color: rgba(128, 0, 0, 1)">"</span>
        &lt;&lt; context.get_context_data(context.first_parms_id())-&gt;parms().poly_modulus_degree() / <span style="color: rgba(128, 0, 128, 1)">2</span> &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ===================== 2. å¯é¥çæ =====================
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¯é¥çæå¨ï¼åºäºä¸ä¸æçæå¬ç§é¥ãéçº¿æ§åå¯é¥</span>
<span style="color: rgba(0, 0, 0, 1)">    KeyGenerator keygen(context);

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ç§é¥ï¼æ ¸å¿æºå¯ï¼ä»å®¢æ·ç«¯ææï¼</span>
    SecretKey secret_key =<span style="color: rgba(0, 0, 0, 1)"> keygen.secret_key();
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¬é¥ï¼å¬å¼ååï¼ç¨äºå å¯ï¼</span>
<span style="color: rgba(0, 0, 0, 1)">    PublicKey public_key;
    keygen.create_public_key(public_key);
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éçº¿æ§åå¯é¥ï¼å¯æä¹æ³ååç¼©å¯æç»´åº¦ï¼å¿éï¼</span>
<span style="color: rgba(0, 0, 0, 1)">    RelinKeys relin_keys;
    keygen.create_relin_keys(relin_keys);

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ===================== 3. æ ¸å¿ç»ä»¶åå§å =====================
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å å¯å¨ï¼ä½¿ç¨å¬é¥å å¯ææ</span>
<span style="color: rgba(0, 0, 0, 1)">    Encryptor encryptor(context, public_key, secret_key);
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è§£å¯å¨ï¼ä½¿ç¨ç§é¥è§£å¯å¯æ</span>
<span style="color: rgba(0, 0, 0, 1)">    Decryptor decryptor(context, secret_key);
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> CKKSç¼ç å¨ï¼å®ç°æµ®ç¹æ° â ææå¤é¡¹å¼ è½¬æ¢</span>
<span style="color: rgba(0, 0, 0, 1)">    CKKSEncoder encoder(context);
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæè¿ç®å¨ï¼æ§è¡å¯æå åä¹ãéçº¿æ§åç­æä½</span>
<span style="color: rgba(0, 0, 0, 1)">    Evaluator evaluator(context);

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ç¼©æ¾å å­ï¼CKKSç¨äºæ§å¶æµ®ç¹è®¡ç®ç²¾åº¦çæ ¸å¿åæ°</span>
    <span style="color: rgba(0, 0, 255, 1)">double</span> scale = pow(<span style="color: rgba(128, 0, 128, 1)">2.0</span>, <span style="color: rgba(128, 0, 128, 1)">40</span><span style="color: rgba(0, 0, 0, 1)">);
    cout </span>&lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">CKKS ç¼©æ¾å å­: 2^40</span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; endl &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ===================== 4. æé æææµ®ç¹åé =====================</span>
    vector&lt;<span style="color: rgba(0, 0, 255, 1)">double</span>&gt; x = { <span style="color: rgba(128, 0, 128, 1)">1.1</span>, <span style="color: rgba(128, 0, 128, 1)">2.2</span>, <span style="color: rgba(128, 0, 128, 1)">3.3</span>, <span style="color: rgba(128, 0, 128, 1)">4.4</span><span style="color: rgba(0, 0, 0, 1)"> };
    vector</span>&lt;<span style="color: rgba(0, 0, 255, 1)">double</span>&gt; y = { <span style="color: rgba(128, 0, 128, 1)">5.5</span>, <span style="color: rgba(128, 0, 128, 1)">6.6</span>, <span style="color: rgba(128, 0, 128, 1)">7.7</span>, <span style="color: rgba(128, 0, 128, 1)">8.8</span><span style="color: rgba(0, 0, 0, 1)"> };
    print_vector(x, </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åå§åé x</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    print_vector(y, </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åå§åé y</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ===================== 5. ææç¼ç  + å å¯ =====================</span>
<span style="color: rgba(0, 0, 0, 1)">    Plaintext plain_x, plain_y;
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å°æµ®ç¹åéç¼ç ä¸ºCKKSæææ ¼å¼ï¼æå®ç¼©æ¾å å­</span>
<span style="color: rgba(0, 0, 0, 1)">    encoder.encode(x, scale, plain_x);
    encoder.encode(y, scale, plain_y);

    Ciphertext cipher_x, cipher_y;
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å å¯ææä¸ºå¯æ</span>
<span style="color: rgba(0, 0, 0, 1)">    encryptor.encrypt(plain_x, cipher_x);
    encryptor.encrypt(plain_y, cipher_y);
    cout </span>&lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\nææç¼ç ãå å¯å®æï¼å¯æxæ°æ®å¤§å°: </span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt; cipher_x.size() &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ===================== 6. å¯æåæè¿ç® =====================
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 6.1 å¯æå æ³ï¼cipher_add = x + y</span>
<span style="color: rgba(0, 0, 0, 1)">    Ciphertext cipher_add;
    evaluator.add(cipher_x, cipher_y, cipher_add);
    cout </span>&lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å¯æå æ³è¿ç®å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 6.2 å¯æä¹æ³ï¼cipher_mult = x * y</span>
<span style="color: rgba(0, 0, 0, 1)">    Ciphertext cipher_mult;
    evaluator.multiply(cipher_x, cipher_y, cipher_mult);
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä¹æ³åå¯æç»´åº¦è¨èï¼æ§è¡éçº¿æ§ååç¼©åæ åæ ¼å¼</span>
<span style="color: rgba(0, 0, 0, 1)">    evaluator.relinearize_inplace(cipher_mult, relin_keys);
    cout </span>&lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å¯æä¹æ³ + éçº¿æ§åå®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ===================== 7. å¯æè§£å¯ + è§£ç  =====================</span>
<span style="color: rgba(0, 0, 0, 1)">    Plaintext plain_add_result, plain_mult_result;
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è§£å¯è¿ç®ç»æå¯æ</span>
<span style="color: rgba(0, 0, 0, 1)">    decryptor.decrypt(cipher_add, plain_add_result);
    decryptor.decrypt(cipher_mult, plain_mult_result);

    vector</span>&lt;<span style="color: rgba(0, 0, 255, 1)">double</span>&gt;<span style="color: rgba(0, 0, 0, 1)"> result_add, result_mult;
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è§£ç ä¸ºæµ®ç¹åé</span>
<span style="color: rgba(0, 0, 0, 1)">    encoder.decode(plain_add_result, result_add);
    encoder.decode(plain_mult_result, result_mult);

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ===================== 8. ç»æè¾åº =====================</span>
    cout &lt;&lt; <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\n==================== è¿ç®ç»æå¯¹æ¯ ====================</span><span style="color: rgba(128, 0, 0, 1)">"</span> &lt;&lt;<span style="color: rgba(0, 0, 0, 1)"> endl;
    print_vector(result_add, </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å¯æå æ³è§£å¯ç»æ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    print_vector(result_mult, </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">å¯æä¹æ³è§£å¯ç»æ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è®¡ç®ææåºåå¼ç¨äºå¯¹æ¯</span>
    vector&lt;<span style="color: rgba(0, 0, 255, 1)">double</span>&gt;<span style="color: rgba(0, 0, 0, 1)"> true_add, true_mult;
    </span><span style="color: rgba(0, 0, 255, 1)">for</span> (size_t i = <span style="color: rgba(128, 0, 128, 1)">0</span>; i &lt; x.size(); ++<span style="color: rgba(0, 0, 0, 1)">i) {
        true_add.push_back(x[i] </span>+<span style="color: rgba(0, 0, 0, 1)"> y[i]);
        true_mult.push_back(x[i] </span>*<span style="color: rgba(0, 0, 0, 1)"> y[i]);
    }
    print_vector(true_add, </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ææå æ³åºåå¼</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    print_vector(true_mult, </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ææä¹æ³åºåå¼</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

    </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
}</span></pre>
</div>
<span class="cnblogs_code_collapse">CKKS</span></div>
<p>ä»£ç è¿è¡ææå¦ä¸ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/465567/202602/465567-20260210171421384-92773903.png" alt="image" width="483" height="272" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>&nbsp;</p>
<h1>4 åè</h1>
<p>1&nbsp;<a href="https://zhuanlan.zhihu.com/p/366965077" target="_blank" rel="noopener nofollow">https://zhuanlan.zhihu.com/p/366965077</a></p>
<p>2&nbsp;<a href="https://blog.csdn.net/WaitMrAnt/article/details/140950613" target="_blank" rel="noopener nofollow">https://blog.csdn.net/WaitMrAnt/article/details/140950613</a></p>
<p>3&nbsp;<a href="https://zhuanlan.zhihu.com/p/619856459" target="_blank" rel="noopener nofollow">https://zhuanlan.zhihu.com/p/619856459</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.7159722222222222" data-date-updated="2026-02-11 11:33">2026-02-10 18:22</span>&nbsp;
<a href="https://www.cnblogs.com/zhaoweiwei">weiwei22844</a>&nbsp;
éè¯»(<span id="post_view_count">48</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19577832);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19577832', targetLink: 'https://www.cnblogs.com/zhaoweiwei/p/19577832/CKKS', title: 'SEALå¨åæå å¯CKKSæ¹æ¡å¥é¨è¯¦è§£' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Avalonia.Controls.DataGridèªå¨åå¹¶å ]]></title>
    <link>https://www.cnblogs.com/kevin-Y/p/19600957</link>
    <guid>814cd0c2f9161f7dcb38a3e0d370da0d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/kevin-Y/p/19600957" title="åå¸äº 2026-02-10 17:59">
    <span role="heading" aria-level="2">Avalonia.Controls.DataGridèªå¨åå¹¶å</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>Winformå¨ç¨çDataGridViewä¿®æ¹ä¸ºéè¿çº¿æ¡åéæçæ¹å¼å®ç°äºåå¹¶åçææãä¸æ®µæ¶é´ä¹å¨çæAvalonia.Controls.DataGridæ¯å¦ä¹æç±»ä¼¼çåæ³ãä¸ç´æ²¡æå¿æå»çé£äºä»£ç ï¼æ°´å¹³æéï¼å®å¨æä¸æXML/Contentä¸ç±»å¦ä½å®ç°ç»å¶åå®¹çãåçAIçå¸®å©ç»äºè½è¯çå»ä¿®æ¹äºã</p>
<p>è®©AIä»DataGridçä»¥ä¸æ¹æ³å¥æ</p>
<div class="cnblogs_code">
<pre>        <span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> AddNewCellPrivate(DataGridRow row, DataGridColumn column)
        {
            DataGridCell newCell </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> DataGridCell();
            PopulateCellContent(
                isCellEdited: </span><span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">,
                dataGridColumn: column,
                dataGridRow: row,
                dataGridCell: newCell);
            </span><span style="color: rgba(0, 0, 255, 1)">if</span> (row.OwningGrid != <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">)
            {
                newCell.OwningColumn </span>=<span style="color: rgba(0, 0, 0, 1)"> column;
                newCell.IsVisible </span>=<span style="color: rgba(0, 0, 0, 1)"> column.IsVisible;
                </span><span style="color: rgba(0, 0, 255, 1)">if</span> (row.OwningGrid.CellTheme <span style="color: rgba(0, 0, 255, 1)">is</span><span style="color: rgba(0, 0, 0, 1)"> {} cellTheme)
                {
                    newCell.SetValue(ThemeProperty, cellTheme, BindingPriority.Template);
                }
            }
            row.Cells.Insert(column.Index, newCell);
            
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æºè½AutoMergeé»è¾ï¼æ¯è¾å½åè¡åä¸ä¸è¡çæ°æ®
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">ApplySmartAutoMerge(row, column, newCell);</span>
        }</pre>
</div>
<p>æååç°ï¼DataGridå¹¶æ²¡æä¸ºæ¯è¡æ°æ®åå»ºDataGridRow/DataGridCellï¼ä¸è¿ä¼å¤ç¨è¿äºåå»ºåºæ¥çDataGridCellæ¾å¶ä»è¡çæ°æ®ãå°±æ¯è¯´ä¸é¢çæ¹æ³åªæ¯å¼å§çæ¾ç¤ºåå®¹æ¯å¯é¢æµçã</p>
<p>å¤æ¬¡å°è¯åï¼åç°ç»å¶åé½ä¼è°ç¨DataGridCellçEnsureGridLineæ¹æ³ï¼äºæ¯å°åå¹¶çä»£ç ä¸»è¦æ¾å¨å¶ä¸­</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> EnsureGridLine(DataGridColumn lastVisibleColumn)
{
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (OwningGrid != <span style="color: rgba(0, 0, 255, 1)">null</span> &amp;&amp; _rightGridLine != <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (OwningGrid.VerticalGridLinesBrush != <span style="color: rgba(0, 0, 255, 1)">null</span> &amp;&amp; OwningGrid.VerticalGridLinesBrush !=<span style="color: rgba(0, 0, 0, 1)"> _rightGridLine.Fill)
        {
            _rightGridLine.Fill </span>=<span style="color: rgba(0, 0, 0, 1)"> OwningGrid.VerticalGridLinesBrush;
        }
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">å¿½ç¥å¶ä»ä»£ç <br>    
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è°ç¨DataGridçCheckCellToMergeæ¹æ³</span>
    <span style="color: rgba(0, 0, 255, 1)">var</span> (isSameAsPrevious, isSameAsNext) = OwningGrid?.CheckCellToMerge(<span style="color: rgba(0, 0, 255, 1)">this</span>) ?? (<span style="color: rgba(0, 0, 255, 1)">false</span>, <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">);    
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ ¹æ®ä¸åçç»åæåµå¤çåºè¾¹æ¡åéæåº¦</span>
<span style="color: rgba(0, 0, 0, 1)">    HandleMergeResult(isSameAsPrevious, isSameAsNext);
}</span></pre>
</div>
<p>è³æ­¤ï¼DataGridå³å®å¦ä½åå¹¶ï¼è¿åå½åè¡ä¸ä¸ä¸è¡åä¸ä¸è¡çæ°æ®æ¯å¦å¯ä»¥åå¹¶ï¼ç°å¨åªæ¯ç®åçæ¯è¾å½ååçåå®¹æ¯å¦ä¸è´ï¼ã</p>
<p><img src="https://img2024.cnblogs.com/blog/12683/202602/12683-20260210174136165-1383757098.png" alt="simplemerge" width="704" height="551" loading="lazy"></p>
<p>æä¸ä¸ªå°å°çé®é¢ï¼å¨æ»å¨æ¶åå¹¶åå¯è½ä¼æ¾ç¤ºç©ºç½ãè½è¯´å¨ç¨çwinformççdatagridviewä¹æè¿ä¸ªå°é®é¢ãä½æ°çä¸è¥¿å¤å°æç¹æ¹è¿ï¼å¯¹å§ãäºæ¯æåAIååºè¦æ±ãæå¤§çå¸®å©å°±æ¯å¤æ­æ¯å¦æ¯å½åæ¾ç¤ºçç¬¬ä¸åçæ¹æ³äºã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;summary&gt;</span>
<span style="color: rgba(128, 128, 128, 1)">///</span><span style="color: rgba(0, 128, 0, 1)"> å¤æ­æå®è¡æ¯å¦ä¸ºå¯è§åºåçç¬¬ä¸è¡
</span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;/summary&gt;</span>
<span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;param name="row"&gt;</span><span style="color: rgba(0, 128, 0, 1)">è¦æ£æ¥çè¡</span><span style="color: rgba(128, 128, 128, 1)">&lt;/param&gt;</span>
<span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;returns&gt;</span><span style="color: rgba(0, 128, 0, 1)">trueè¡¨ç¤ºæ¯å¯è§åºåçç¬¬ä¸è¡ï¼falseè¡¨ç¤ºä¸æ¯</span><span style="color: rgba(128, 128, 128, 1)">&lt;/returns&gt;</span>
<span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">bool</span><span style="color: rgba(0, 0, 0, 1)"> IsFirstVisibleRow(DataGridRow row)
{
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (_rowsPresenter == <span style="color: rgba(0, 0, 255, 1)">null</span> || row == <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">)
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">;
        
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éåå¯è§åºåçææè¡ï¼æ¾å°ç´¢å¼æå°çè¡</span>
    <span style="color: rgba(0, 0, 255, 1)">int</span> firstVisibleRowIndex = <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)">.MaxValue;
    </span><span style="color: rgba(0, 0, 255, 1)">foreach</span> (Control element <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> _rowsPresenter.Children)
    {
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (element <span style="color: rgba(0, 0, 255, 1)">is</span> DataGridRow visibleRow &amp;&amp;<span style="color: rgba(0, 0, 0, 1)"> visibleRow.IsVisible)
        {
            firstVisibleRowIndex </span>=<span style="color: rgba(0, 0, 0, 1)"> Math.Min(firstVisibleRowIndex, visibleRow.Index);
        }
    }
    
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¦ææå®è¡ç´¢å¼ç­äºå¯è§åºåæå°ç´¢å¼ï¼åä¸ºç¬¬ä¸è¡</span>
    <span style="color: rgba(0, 0, 255, 1)">return</span> row.Index ==<span style="color: rgba(0, 0, 0, 1)"> firstVisibleRowIndex;
}</span></pre>
</div>
<p>äººå·¥åæååç°ï¼DataGridCellçEnsureGridLineä¸ç¥ä¸ºä½åªæ¯lastVisibleColumnæè°ç¨ï¼å¹¶ä¸æ¯è¡ä¸­çå¨é¨åãæ»å¨çå·æ°ç±DataGridCellsPresenteråèµ·ï¼çä»¥ä¸æ¹æ³</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> EnsureFillerVisibility()
{
    DataGridFillerColumn fillerColumn </span>=<span style="color: rgba(0, 0, 0, 1)"> OwningGrid.ColumnsInternal.FillerColumn;
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">å¿½ç¥å¶ä»ä»£ç 

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> This must be done after the Filler visibility is determined.  This also must be done
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> regardless of whether or not the filler visibility actually changed values because
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> we could scroll in a cell that didn't have EnsureGridLine called yet</span>
    DataGridColumn lastVisibleColumn =<span style="color: rgba(0, 0, 0, 1)"> OwningGrid.ColumnsInternal.LastVisibleColumn;
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (lastVisibleColumn != <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        DataGridCell cell </span>=<span style="color: rgba(0, 0, 0, 1)"> OwningRow.Cells[lastVisibleColumn.Index];
        cell.EnsureGridLine(lastVisibleColumn);</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">ä¸ç¥éä¸ºä»ä¹åªæ¯æåä¸åéè¦æ§è¡ã</span>
<span style="color: rgba(0, 0, 0, 1)">    }

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ£æ¥æ¯å¦ä¸ºé¦è¡æ¾ç¤ºï¼å¦ææ¯åæ¸é¤åå¹¶ååæ ¼çéæåº¦</span>
    <span style="color: rgba(0, 0, 255, 1)">bool</span> isFirstVisualRow = (OwningGrid?.IsFirstVisibleRow(OwningRow) == <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">foreach</span> (DataGridCell cell <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> OwningRow.Cells)
    {
        cell</span>?.ClearMergeOpacity(isFirstVisualRow);<span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">å¦çæ¶åï¼å¯è½éè¦æ¢å¤éæåº¦</span>
<span style="color: rgba(0, 0, 0, 1)">    }
}</span></pre>
</div>
<p>å¥½äºï¼è¿å°±æ¯å¨é¨ä¿®æ¹ãä»£ç å¨gitee</p>
<p><a href="https://gitee.com/kevin2y/Avalonia.Controls.DataGrid/tree/feature/auto-merge-enhancement" target="_blank" rel="noopener nofollow">https://gitee.com/kevin2y/Avalonia.Controls.DataGrid/tree/feature/auto-merge-enhancement</a></p>
<p>&nbsp;</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-10 17:59">2026-02-10 17:59</span>&nbsp;
<a href="https://www.cnblogs.com/kevin-Y">çå½ä½éªä¹kevin-Y</a>&nbsp;
éè¯»(<span id="post_view_count">100</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19600957);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19600957', targetLink: 'https://www.cnblogs.com/kevin-Y/p/19600957', title: 'Avalonia.Controls.DataGridèªå¨åå¹¶å' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ è®°å½ä¸æ¬¡bugï¼ä¸å¯è§å­ç¬¦/é¶å®½å­ç¬¦ ]]></title>
    <link>https://www.cnblogs.com/Az1r/p/19600679</link>
    <guid>2e12c4185c2e464147238c438eac14fc</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Az1r/p/19600679" title="åå¸äº 2026-02-10 16:59">
    <span role="heading" aria-level="2">è®°å½ä¸æ¬¡bugï¼ä¸å¯è§å­ç¬¦/é¶å®½å­ç¬¦</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h3 id="1-ç°è±¡">1. ç°è±¡</h3>
<p>å¨å¤ç CSV æä»¶å¯¼å¥æ¶ï¼ä½ å¯è½éå°è¿è¿ç§âçµå¼äºä»¶âï¼</p>
<ul>
<li>CSV æä»¶ç¬¬ä¸åå« <code>tag_id</code>ã</li>
<li>ç¨åºç¨ <code>encoding/csv</code> è¯»è¿ Map åï¼å°è¯ç¨ <code>mp["tag_id"]</code> åå¼ã</li>
<li>ç»æï¼ æ°¸è¿è¿åç©ºå¼ï¼ä½æå°æ´ä¸ª Map æ¶ï¼èç¼ç Key ç¡®å®æ¯ <code>tag_id</code>ã</li>
<li>èè¿å¶å®æ¯ä½ éå°äº<strong>é¶å®½å­ç¬¦</strong>ï¼ ãZWNBSPãã</li>
</ul>
<details>
<summary>ç¹å»æ¥çä»£ç </summary>
<pre><code>package main

import (
	"bytes"
	"encoding/csv"
	"fmt"
	"strings"
	"unicode"
)

/*
  [æ¨¡æ CSV è¡¨æ ¼ç»æ]
  æä»¶ç¼ç : UTF-8 with BOM (å­èæµå¼å¤´åå« \xef\xbb\xbf)

  |  åå (Header)   |  æ°æ® (Row 1)  |
  |-----------------|---------------|
  | [ZWNBSP]tag_id  |      1        |
  |      name       |    Popular    |

  æ³¨ï¼[ZWNBSP] å¨ç¼è¾å¨å Excel ä¸­å®å¨ä¸å¯è§ï¼ä½å¨åå­ä¸­å  3 ä¸ªå­èã
*/

func main() {
	// 1. æ¨¡æ CSV åå®¹ï¼æå¨å¨å¼å¤´å å¥ UTF-8 BOM (\xef\xbb\xbf)
	content := "\xef\xbb\xbf" + "tag_id,name\n1,Gemini"

	// 2. è§£æ CSV
	reader := csv.NewReader(bytes.NewBufferString(content))
	records, _ := reader.ReadAll()

	// 3. æå»º Map
	header := records[0]
	row := records[1]
	mp := make(map[string]string)
	for i, colName := range header {
		mp[colName] = row[i]
	}

	// 4. å°è¯éè¿æ åå­ç¬¦ä¸² Key è¯»å
	targetKey := "tag_id"
	val, exists := mp[targetKey]

	/*
	   [é¢è®¡æå°ç»æ]

	   --- ç»ææ¼ç¤º ---
	   ç´æ¥æå° Map: map[tag_id:1 name:Gemini]  &lt;-- èç¼çå®å¨æ­£å¸¸
	   å°è¯è¯»å Key [tag_id]: æå? false, å¼:     &lt;-- å®éä¸æ¾ä¸å°ï¼å ä¸ºå¤åºæ¥ç 3 å­èå¨ä½ç¥

	   --- çç¸æ­ç§ (åå­è¿å¶å¯¹æ¯) ---
	   Map éç Key (Hex): efbbbf7461675f6964  &lt;-- åé¢å¤åºäº efbbbf (ZWNBSP)
	   ä»£ç éç Key (Hex): 7461675f6964        &lt;-- çº¯åç tag_id
	*/

	fmt.Println("--- ç»ææ¼ç¤º ---")
	fmt.Printf("ç´æ¥æå° Map: %v\n", mp)
	fmt.Printf("å°è¯è¯»å Key [%s]: æå? %v, å¼: %s\n", targetKey, exists, val)

	fmt.Println("\n--- çç¸æ­ç§ (åå­è¿å¶å¯¹æ¯) ---")
	for k := range mp {
		if strings.Contains(k, "tag_id") {
			fmt.Printf("Map éç Key (Hex): %x\n", k)
			fmt.Printf("ä»£ç éç Key (Hex): %x\n", targetKey)
		}
	}

	// 5. ä½¿ç¨æ¸æ´å½æ°ä¿®å¤
	fmt.Println("\n--- ä¿®å¤åå°è¯ ---")
	cleanMp := make(map[string]string)
	for i, colName := range header {
		cleanMp[CleanString(colName)] = row[i]
	}
	_, existsNow := cleanMp[targetKey]
	fmt.Printf("æ¸æ´åè¯»å Key [%s]: æå? %v\n", targetKey, existsNow)
}

// CleanString æ¯å¤ç CSV ååçâå¼ºåå»æ±¡åâ
func CleanString(s string) string {
	// ç§»é¤ BOM åç¼å¹¶åé¤ææä¸å¯è§å­ç¬¦
	return strings.Map(func(r rune) rune {
		if unicode.IsGraphic(r) {
			return r
		}
		return -1
	}, strings.TrimPrefix(s, "\xef\xbb\xbf"))
}
</code></pre>
</details>
<p>é¶å®½å­ç¬¦ = çä¸è§çå­ç¬¦,ä½å®ççå¨ææ¬éã</p>
<h3 id="2-åæ">2. åæ</h3>
<h4 id="ä¸ºä»ä¹ä¼æè¿ç§å­ç¬¦"><strong>ä¸ºä»ä¹ä¼æè¿ç§å­ç¬¦ï¼</strong></h4>
<p>è¿ç±»é®é¢éå¸¸ç± <strong>BOM (Byte Order Mark)</strong> å¼èµ·ã</p>
<ul>
<li>
<p><strong>æ¥æºï¼</strong> å½ä½ ä½¿ç¨ Windows Excel å¦å­ä¸º UTF-8 æ ¼å¼æ¶ï¼æé£ä¹¦è¡¨æ ¼ä¿å­ä¸ºcsvæä»¶æ¶ï¼Excel ä¼å¨æä»¶æå¼å¤´èªå¨æ·»å  <code>0xEF 0xBB 0xBF</code> ä¸ä¸ªå­èã</p>
</li>
<li>
<p><strong>æ¬è´¨ï¼</strong> å¨ Unicode ä¸­ï¼è¿è¢«ç§°ä¸º <strong>ZWNBSP</strong>ï¼Zero Width No-Break Spaceï¼é¶å®½ä¸æ¢è¡ç©ºæ ¼ï¼<code>U+FEFF</code>ï¼ãå®çè®¾è®¡åè¡·æ¯æ è®°å­èåºï¼ä½å¨ç°ä»£ UTF-8 ç¯å¢ä¸ï¼å®å¾å¾åæäºâæ°æ®æè´¨âã</p>
</li>
</ul>
<h4 id="ä¸ºä»ä¹-go-æ æ³å¹é"><strong>ä¸ºä»ä¹ Go æ æ³å¹éï¼</strong></h4>
<p>Go ç <code>map[string]string</code> æ¥æ¾æ¯åºäº<strong>å­èæµ</strong>çç²¾ç¡®å¹éã</p>
<ul>
<li>
<p><strong>é¢æ Keyï¼</strong> <code>[116 97 103 95 105 100]</code> (å³ <code>tag_id</code>)</p>
</li>
<li>
<p><strong>å®éç Keyï¼</strong> <code>[239 187 191 116 97 103 95 105 100]</code> (å³ <code>\ufefftag_id</code>)</p>
</li>
</ul>
<p>å¸¸è§çé¶å®½å­ç¬¦ï¼</p>
<table>
<thead>
<tr>
<th><strong>åç§°</strong></th>
<th><strong>Unicode</strong></th>
<th><strong>ä½ç¨è¯´æ</strong></th>
<th><strong>å¯¹ç¨åºçå¹²æ°</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>é¶å®½æ æ­è¡ç©ºæ ¼ (ZWNBSP/BOM)</strong></td>
<td><code>\uFEFF</code></td>
<td>é²æ­¢èªå¨æ¢è¡ï¼å¨æä»¶å¤´ä½ä¸º BOM æ è®°ç¼ç </td>
<td><strong>æå¸¸è§</strong>ãå¯¼è´ CSV é¦å Key æ æ³è¯»åã</td>
</tr>
<tr>
<td><strong>é¶å®½ç©ºæ ¼ (ZWSP)</strong></td>
<td><code>\u200B</code></td>
<td>ç¨äºåéé¿åè¯ä»¥ä¾¿å¨å¿è¦æ¶æ¢è¡</td>
<td>æå¥å¨å­ç¬¦ä¸²ä¸­é´ï¼å¯¼è´ <code>len()</code> é¿åº¦å¢å ã</td>
</tr>
<tr>
<td><strong>é¶å®½è¿æ¥ç¬¦ (ZWJ)</strong></td>
<td><code>\u200D</code></td>
<td>ç¨äºç»åå¤ä¸ª Emojiï¼å¦ ð¨âð©âð§ï¼æå¤ææå­</td>
<td>å¼ºè¡è¿æ»¤ä¼å¯¼è´ç»å Emoji è¢«æè§£ã</td>
</tr>
<tr>
<td><strong>é¶å®½éè¿æ¥ç¬¦ (ZWNJ)</strong></td>
<td><code>\u200C</code></td>
<td>ææ­å­ç¬¦è¿åï¼å¸¸è§äºé¿æä¼¯è¯­ãå°åº¦æï¼</td>
<td>æ¹åææ¬çäºè¿å¶è¡¨ç¤ºã</td>
</tr>
<tr>
<td><strong>å·¦å³æå­æ¹åç¬¦ (LRM/RLM)</strong></td>
<td><code>\u200E</code> / <code>\u200F</code></td>
<td>æ··åæçæ¶æ§å¶æå­ä»å·¦å¾å³æä»å³å¾å·¦</td>
<td>å¯¼è´å­ç¬¦ä¸²æ¯è¾é»è¾å¤±æã</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="3-è§£å³">3. è§£å³</h3>
<pre><code>package main

import (
	"regexp"
)

// ç¨æ­£åå¹éå¸¸è§çé¶å®½å­ç¬¦åºé´
var reZeroWidth = regexp.MustCompile(`[\u200B-\u200D\uFEFF\u200E\u200F]`)

func SafeClean(s string) string {
	return reZeroWidth.ReplaceAllString(strings.TrimSpace(s), "")
}
</code></pre>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/Az1r/" target="_blank">æ±æ°´ä¸ºç«­</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/Az1r/p/19600679" target="_blank">https://www.cnblogs.com/Az1r/p/19600679</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-10 17:00">2026-02-10 16:59</span>&nbsp;
<a href="https://www.cnblogs.com/Az1r">æ±æ°´ä¸ºç«­</a>&nbsp;
éè¯»(<span id="post_view_count">222</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19600679);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19600679', targetLink: 'https://www.cnblogs.com/Az1r/p/19600679', title: 'è®°å½ä¸æ¬¡bugï¼ä¸å¯è§å­ç¬¦/é¶å®½å­ç¬¦' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ KMPæ¨¡å¼å¹éç®æ³ââè¯¦ç»è®²è§£ãæ¸æ°ææ ]]></title>
    <link>https://www.cnblogs.com/CodingCat-jiumi/p/19555666</link>
    <guid>d876a5fa62007cd3c0f2c0860171271b</guid>
    <description>
    <![CDATA[ 
		<h2>
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/CodingCat-jiumi/p/19555666" title="åå¸äº 2026-02-10 16:30">
    <span role="heading" aria-level="2">KMPæ¨¡å¼å¹éç®æ³ââè¯¦ç»è®²è§£ãæ¸æ°ææ</span>
    

</a>

		</h2>
		    <div id="cnblogs_post_description" style="display: none">
        
        KMPç®æ³æ¯ç±D.E. KnuthãJ.H. MorrisåV.R. Pratt(å¶ä¸­KnuthåPrattå±åç ç©¶, Mor-risç¬ç«ç ç©¶)åè¡¨ä¸ä¸ªæ¨¡å¼å¹éç®æ³ï¼KMPç®æ³çæå¤§ç¹ç¹ä½¿å¾å®å¨å¤çå¤§éææ¬å¹éçé®é¢æ¶ï¼æ¯æ´åæä¸¾ç®æ³ææ´å¥½çæ§è½ã
å³äºå­ç¬¦ä¸²å¹éï¼æ¯å­ç¬¦ä¸²å¾éè¦çç¥è¯ç¹ï¼ä¹æ¯é¢è¯ç¬è¯çé«é¢èç¹ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="kmpç®æ³ä»ç»">KMPç®æ³ä»ç»</h2>
<p>KMPç®æ³æ¯ç±D.E. KnuthãJ.H. MorrisåV.R. Pratt(å¶ä¸­KnuthåPrattå±åç ç©¶,  Mor-risç¬ç«ç ç©¶)åè¡¨ä¸ä¸ªæ¨¡å¼å¹éç®æ³ï¼KMPç®æ³çæå¤§ç¹ç¹ä½¿å¾å®å¨å¤çå¤§éææ¬å¹éçé®é¢æ¶ï¼æ¯æ´åæä¸¾ç®æ³ææ´å¥½çæ§è½ã</p>
<p>å³äºå­ç¬¦ä¸²å¹éï¼æ¯å­ç¬¦ä¸²å¾éè¦çç¥è¯ç¹ï¼ä¹æ¯é¢è¯ç¬è¯çé«é¢èç¹ãLeetcodeçç¬¬28é¢å°±æ¯èæ¥å­ç¬¦ä¸²å¹éç®æ³ãå¦å¤æ¬ææ¯æ¥çäºãå¤§è¯æ°æ®ç»æãè¿æ¬ä¹¦åçæ»ç»ï¼åæ¶nextæ°ç»é¨åä¹åèäºè¿ç¯åå®¢<a href="https://blog.csdn.net/gmynebula/article/details/125239503" target="_blank" rel="noopener nofollow">KMPç®æ³ä¸­nextæ°ç»çè®¡ç®</a>ã</p>
<p>KMPæ¯ç±åºç¡çå­ç¬¦ä¸²å¹éBFç®æ³æ¹è¿èæ¥ç</p>
<h2 id="kmpæ¨¡å¼å¹éç®æ³åç">KMPæ¨¡å¼å¹éç®æ³åç</h2>
<p>ç®æ ä¸²ï¼ä¸»ä¸²ï¼ S = "heloohello", æ¨¡å¼ä¸²ï¼å­ä¸²ï¼ T = "hello"ãæä»¬è¦ä»ä¸»ä¸² S ä¸­æ¾å°å­ä¸² T çä½ç½®ãå¦æä½¿ç¨BFç®æ³ï¼æ­¥éª¤å¦ä¸å¾æç¤ºã</p>
<div align="center">
<img width="60%" data-src="https://img2024.cnblogs.com/blog/2488203/202601/2488203-20260130194755726-596048542.png" class="lazyload">
</div>
<p>å¨ â  ä¸­å½ S å T ä¸å¹éæ¶ï¼BFç®æ³çæä½æ¯ä¸»ä¸² S åéå° i-j+1ï¼ä»æ¬æ¬¡å¹éçåå§ä½ç½®åç§»ä¸ä½ï¼å¾ä¸­æ­¥éª¤â¡çä½ç½®ï¼ï¼å¹éä¸² T åéå° j = 0 (åå§ä½ç½®ï¼, ç¶åæ§è¡ â¡â¢â£â¤â¥ æ­¥ä¾æ¬¡è¿è¡å¹éï¼ä½ææè¿äºæ­¥éª¤ä¸å®é½æ¯å¿éçåï¼</p>
<p>å¨æ­¥éª¤ â  ä¸­ï¼åçæ¨¡å¼ä¸² Tï¼åä¸ä¸ªå­ç¬¦åä¸ç¸ç­ï¼'h' != 'e' != 'l'ï¼ï¼åæ¶S å T ä¸²åä¸ä¸ªå­ç¬¦åç¸å¹éï¼é£ä¹æ¨¡å¼ä¸² T çé¦å­ç¬¦'h' èªç¶ä¸å¯è½åä¸»ä¸² S çç¬¬äºãä¸ä½å­ç¬¦ç¸ç­ãæä»¥æ­¥éª¤â¡â¢é½æ¯å¤ä½çãè¿æ¯KMPç®æ³çå³é®æå¨ï¼å¦ææä»¬ç¥é T ä¸²ä¸­åªäºå­ç¬¦ç¸ç­ï¼ä¹æ¯å³é®ç¹ï¼åç»­ä¼è®²ï¼ï¼é£ä¹æäºæ­¥éª¤å°±å¯ä»¥çç¥ã</p>
<div align="center">
<img width="50%" data-src="https://img2024.cnblogs.com/blog/2488203/202601/2488203-20260130194814708-2146798970.png" class="lazyload">
</div>
<p>å æ­¤åªéè¦ä¿çâ â£â¤â¥çæ­¥éª¤å³å¯ãä»ä¸å¾å¯ä»¥çåºï¼æé i æ¯ä¸æ¯ä¸ç´æ²¡æåæº¯ï¼è¿å°±æ¯KMPçå¦å¤æå¨ãå¨KMPä¸­ï¼æé i æ°¸è¿ä¸ä¼åæº¯ï¼åªææåæ¨¡å¼ä¸²çæé j ä¼åçåæº¯ãå¨æ¬ä¾ä¸­ j æ¯æ¬¡é½åéå°é¦åç´ ï¼æä»¬åä¸¾ä¸ä¸ªä¾å­ï¼çç j ä¼æä¹ååã</p>
<div align="center">
<img width="60%" data-src="https://img2024.cnblogs.com/blog/2488203/202601/2488203-20260130195618623-1249784837.png" class="lazyload">
</div>
<p>ç¬¬äºä¸ªä¾å­ï¼</p>
<p>ç®æ ä¸²ï¼ä¸»ä¸²ï¼ S = "abcababca", æ¨¡å¼ä¸²ï¼å­ä¸²ï¼ T = "abcabx"ãBFç®æ³æ§è¡è¿ç¨å¦ä¸å¾æç¤ºï¼å¨æ­¥éª¤ â  ä¸­å5ä¸ªå­ç¬¦å®å¨ç¸ç­ï¼æ ¹æ®ä¸ä¸ä¸ªä¾å­çç»éªï¼å·²ç¥æ¨¡å¼ä¸²Tä¸­ç¬¬ä¸ä½å­ç¬¦ä¸ç¬¬äºä½ãç¬¬ä¸ä½ä¸ç­ï¼åç»­ä¼æ ¹æ®next[]æ°ç»è®¡ç®å¾åºï¼ï¼æ­¥éª¤ â¡â¢ é½æ¯å¤ä½çï¼ç´æ¥çç¥ã</p>
<div align="center">
<img width="60%" data-src="https://img2024.cnblogs.com/blog/2488203/202601/2488203-20260130195738650-30570371.png" class="lazyload">
</div>
<p>ä¸ä¸ä¸ªä¾å­ä¸åçæ¯ï¼è¿éçæ¨¡å¼ä¸² T çé¦ä½å­ç¬¦ 'a' ä¸ T ç¬¬åä½ç 'a' ç¸ç­ï¼ç¬¬äºä½ç 'b' ä¸ç¬¬äºä½ç 'b' ç¸ç­ï¼èå¨ â  ä¸­,ç¬¬åä½ç 'a' ç¬¬äºä½ç 'b' å·²ç»ä¸ä¸»ä¸² S ä¸­çç¸åºä½ç½®æ¯è¾è¿äºï¼æ¯ç¸ç­çãå æ­¤å¯ä»¥æ­å®,T çé¦å­ç¬¦ 'a'ãç¬¬äºä½çå­ç¬¦ 'b' ä¸ S çç¬¬åä½å­ç¬¦åç¬¬äºä½å­ç¬¦è¯å®ä¹æ¯ç¸ç­çï¼æä»¥ â£â¤ è¿ä¸¤ä¸ªæ¯è¾å¾åºå­ç¬¦ç¸ç­çæ­¥éª¤ä¹å¯ä»¥çç¥ã</p>
<div align="center">
<img width="60%" data-src="https://img2024.cnblogs.com/blog/2488203/202601/2488203-20260130195818970-1710847471.png" class="lazyload">
</div>
<p>æ»ç»ä¸é¢ä¸¤ä¸ªä¾å­ï¼å¨KMPç®æ³ä¸­ï¼<strong>ä¸»ä¸²ç i å¼</strong>æ¯<strong>ä¸éè¦åæº¯</strong>çãæä»¥æä»¬åªéè¦èèååç j å¼ï¼æ¨¡å¼ä¸² j å¼çååéè¿è§å¯å¯ä»¥åç°ï¼å½ä¸»ä¸²åæ¨¡å¼ä¸²ä¸å¹éæ¶ï¼ä¸ä¸æ­¥ j è¯¥æååªä¸ªåç´ <strong>åªä¸æ¨¡å¼ä¸² T æ¬èº«æå³ç³»</strong>ãå½åç°æç¸åçå­ç¬¦ï¼j çååä¹å°±ä¼ä¸åã</p>
<p>å¨KMPä¸­ï¼å½ä¸»ä¸²åæ¨¡å¼ä¸²ä¸å¹éæ¶, ä¸ä¸æ­¥ j å¼çå¤å°åå³äºå½åå­ç¬¦ä¹åçä¸²çååç¼çç¸ä¼¼åº¦ã</p>
<h2 id="nextæ°ç»">nextæ°ç»</h2>
<h3 id="åºç¡ç¥è¯">åºç¡ç¥è¯</h3>
<p>å¨æä»¬è®¡ç®nextæ°ç»ä¹åï¼æä»¬åè®²è§£ä¸äºåºç¡ç¥è¯ã</p>
<ul>
<li>åç¼ï¼å­ç¬¦ä¸²çå¼å¤´ï¼ä¾å¦å­ç¬¦ä¸²abcdçåç¼ä¸ºa, ab, abc, abcdãå¨KMPç®æ³ä¸­ä½¿ç¨çåç¼ä¸ºçåç¼ï¼æ¢ä¸åæ¬åå­ç¬¦ä¸²abcdçåç¼ãï¼çåç¼ï¼a, ab, abcï¼</li>
<li>åç¼ï¼å­ç¬¦ä¸²çç»å°¾ï¼å¨KMPç®æ³ä¸­åæ ·ä½¿ç¨çæ¯çåç¼(bcd,cd,d)ã</li>
<li>æé¿å¬å±ååç¼ï¼æé¿çç¸ç­çåç¼ä¸åç¼ï¼ä¾å¦å­ç¬¦ä¸²ABCxyzABCçæé¿å¬å±ååç¼ä¸ºABC
<ul>
<li>ABCXYABCççåç¼ï¼Aï¼AB, <strong>ABC</strong>, ABCx, ABCxy, ABCxyz, ABCxyzA, ABCxyzAB</li>
<li>ABCXYABCççåç¼ï¼BCxyzABC, CxyzABC, xyzABC, yzABC, zABC, <strong>ABC</strong>, BC, C</li>
</ul>
</li>
<li>åç¼è¡¨ï¼å­å¨æ¯ä¸ä¸ªåç¼çæé¿å¬å±ååç¼çé¿åº¦ã<br>
ä¸¾ä¾ï¼è¥æ¨¡å¼ä¸² T="abaaabaaca"ã</li>
</ul>
<div align="center">
<img width="50%" data-src="https://img2024.cnblogs.com/blog/2488203/202601/2488203-20260130195927819-1913854677.png" class="lazyload">
</div>
<ul>
<li>nextæ°ç»ï¼æ T ä¸²åä¸ªä½ç½®ç j çååå®ä¹ä¸ºæ°ç» nextï¼next çé¿åº¦å°±æ¯ T ä¸²çé¿åº¦ãä¸»ä¸²åæ¨¡å¼ä¸²ä¸å¹éæ¶ï¼ä¸ä¸æ­¥ j çå¼ç± next[j] å³å®ãä¾å¦ç®æ ä¸² S="abcaba", T="aba", æ ¹æ®åç¼è¡¨æ±åº next=[-1,0 0], å½ j=2 æ¶åçä¸å¹é, next[2]=0, ä¸ä¸æ­¥ j å°ç­äº 0 è¿è¡å­ç¬¦å¹éã</li>
</ul>
<div align="center">
<img alt="ç»å¾13.png" width="50%" data-src="https://img2024.cnblogs.com/blog/2488203/202601/2488203-20260130194937697-1022022891.png" class="lazyload">
</div>
<h3 id="åç¼è¡¨ånextæ°ç»çå³ç³»">åç¼è¡¨ånextæ°ç»çå³ç³»</h3>
<p>åç¼è¡¨å­å¨æ¯ä¸ä¸ªåç¼çæé¿å¬å±ååç¼çé¿åº¦ï¼nextæ°ç»å­å¨çæ¯æ¨¡å¼ä¸²åå³ç§»å¨å°nextå¼çä½ç½®ï¼è¿ä¸ªå¼ä¸åç¼çæé¿å¬å±ååç¼çé¿åº¦æå³ï¼æä»¥nextæ°ç»æ¯å¯ä»¥ç±åç¼è¡¨çæçã<br>
ç¨åç¼è¡¨çæä¸ä¸ªnextæ°ç»å¾å®¹æï¼å°åç¼è¡¨æ¯ä¸ä½é½ååç§»å¨1ä½ï¼æåä¸ä½èå»ï¼å¹¶å¨ç¬¬ä¸ä½è¡¥ä¸ä¸ª-1å°±å¾å°äºnextæ°ç»ã</p>
<div align="center">
<img alt="ç»å¾14.png" width="50%" data-src="https://img2024.cnblogs.com/blog/2488203/202601/2488203-20260130194959450-1960892099.png" class="lazyload">
</div>
<p>å¦ææåå­¦ä¸çè§£è¿ä¸ªå³ç³»è¿å¯ä»¥çä¸ä¸æå¨æ¨çè¿ç¨ï¼<br>
T="abaaabaaca"</p>
<ol>
<li>ä½ç½®0ä¸çåç´ aåé¢æ²¡æå­ä¸²ï¼ä»¤next[0]=-1</li>
<li>ä½ç½®1ä¸çåç´ båé¢çå­ç¬¦ä¸²ä¸º"a"ï¼å­ç¬¦ä¸²"a"æ²¡ææé¿å¬å±ååç¼ï¼next[1]=0</li>
<li>ä½ç½®2ä¸çåç´ aåé¢çå­ç¬¦ä¸²ä¸º"ab","ab"æ²¡ææé¿å¬å±ååç¼ï¼next[2]=0</li>
<li>ä½ç½®3ä¸çåç´ aåé¢çå­ç¬¦ä¸²ä¸º"aba"ï¼æé¿å¬å±ååç¼ä¸º"a"ï¼next[3]=1</li>
<li>ä½ç½®4ä¸çåç´ aåé¢çå­ç¬¦ä¸²ä¸º"abaa"ï¼æé¿å¬å±ååç¼ä¸º"a"ï¼next[4]=1</li>
<li>ä½ç½®5ä¸çåç´ båé¢çå­ç¬¦ä¸²ä¸º"abaaa"ï¼æé¿å¬å±ååç¼ä¸º"a"ï¼next[5]=1</li>
<li>ä½ç½®6ä¸çåç´ aåé¢çå­ç¬¦ä¸²ä¸º"abaaab"ï¼æé¿å¬å±ååç¼ä¸º"ab"ï¼next[6]=2</li>
<li>ä½ç½®7ä¸çåç´ aåé¢çå­ç¬¦ä¸²ä¸º"abaaaba"ï¼æé¿å¬å±ååç¼ä¸º"aba"ï¼next[7]=3</li>
<li>ä½ç½®8ä¸çåç´ aåé¢çå­ç¬¦ä¸²ä¸º"abaaabaa"ï¼æé¿å¬å±ååç¼ä¸º"abaa"ï¼next8]=4</li>
<li>ä½ç½®9ä¸çåç´ aåé¢çå­ç¬¦ä¸²ä¸º"abaaabac"ï¼æ²¡ææé¿å¬å±ååç¼ï¼next[9]=0</li>
</ol>
<p>åæ¶å¨<a href="https://blog.csdn.net/gmynebula/article/details/125239503" target="_blank" rel="noopener nofollow">KMPç®æ³ä¸­nextæ°ç»çè®¡ç®</a>è¿ç¯åå®¢ä¸­æå°äºä¸ä¸ªå°æ¹ï¼ä¸ºä»ä¹æäºnextæ°ç»æ¯0,1å¼å¤´ï¼èæäºnextæ°ç»æ¯-1,0å¼å¤´ï¼</p>
<blockquote>
<p>-1,0å¼å¤´ä¸0, 1å¼å¤´çnextæ°ç»æ¬è´¨æ¯ä¸æ ·çãå®éä¸ï¼ä»¥0, 1å¼å¤´çnextæ°ç»å°±æ¯ä»¥-1,0å¼å¤´çnextæ°ç»æ¯ä¸é¡¹å 1å¾å°çãåºç°è¿ç§æåµçåå å¨äºæ¨¡å¼ä¸²èµ·å§çç´¢å¼å¼ï¼å¨ç¨åºä¸­ï¼ä¸ä¸ªæ°ç»çç´¢å¼çèµ·å§å¼ä¸º0ï¼ç¶èå¨èè¯åä¹¦ä¸­ç»çæ¨¡å¼ä¸²èµ·å§å¼æ¯å¤ä»1å¼å§ãæä»¥å¨èè¯ä¸­éå°çnextæ°ç»éå¸¸æ¯ä»¥0, 1å¼å¤´ï¼èä¸äºç¨åºææç¨ä¸­çnextæ°ç»æ¯ä»¥-1, 0å¼å¤´ã<br><br>
æ³¨ï¼å¨èè¯ä¸­éå¸¸ä¼ç»æ¨¡å¼ä¸²çç´¢å¼ï¼æèä¼ç»nextå¼çåä¸¤é¡¹ï¼å¨ç­é¢æ¶è¦æç§é¢ç®ä¸­çè¦æ±ånextæ°ç»ã</p>
</blockquote>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<p>nextæ°ç»çä»£ç å®ç°, å¯ä»¥è®¡ç®åºå½åå¹éä¸² T ç next æ°ç»</p>
<pre><code class="language-cpp">void get_next(string T, int *next) {
	next[0] = -1;
	int i = 0;
	int j = -1;
	
	while(i &lt; T.size() - 1) {
		//T[i]è¡¨ç¤ºåç¼çåä¸ªå­ç¬¦
		//T[j]è¡¨ç¤ºåç¼çåä¸ªå­ç¬¦
		if(j == -1 || T[i] == T[j]){//
			++i;
			++j;
			next[i] = j;
		} else {
			//å¦æå­ç¬¦ä¸ç¸åï¼åjå¼åæº¯
			j = next[j];
		}
	}
}
</code></pre>
<p>KMPä»£ç å®ç°</p>
<pre><code class="language-cpp">int KMP(string S, string T) {
    int ans = -1;
    // iç¨äºéåä¸»ä¸²S
    int i = 0;
    // jç¨äºéåå¹éä¸²T
    int j = 0;
    int next[255]; // è¿éåå§é¿åº¦ä¸º255,éèªè¡è°æ´
    // å¯¹Tååæï¼å¾å°nextæ°ç»
    get_next(T, next);
    while (i &lt; S.size()) {
        // å¹éæååç»§ç»­åä¸ä¸ä¸ªå­ç¬¦è¿è¡å¹é
        if (j == -1 || S[i] == T[j]) {
            ++i;
            ++j;
        }
        // å¹éå¤±è´¥è¿è¡åæº¯
        else {
            // jåæº¯å°åéçä½ç½®
            j = next[j];
        }
        if (j == T.size()) {
            ans = i - T.size();
            break;
        }
    }
    return ans;
}
</code></pre>
<h2 id="æ¶é´å¤æåº¦">æ¶é´å¤æåº¦</h2>
<p>ä»¤ n ä¸ºä¸»ä¸²é¿åº¦ï¼m ä¸ºè¦å¹éçå­ä¸²é¿åº¦ã</p>
<p>å¯¹äºGet_nextå½æ°æ¥è¯´ï¼æ¶é´å¤æåº¦ä¸ºO(m)ï¼å ä¸ºiå¼ä¸åæº¯ï¼æä»¥ä½¿å¾KMPç®æ³æçå¾å°æé«ï¼å¨KMPå½æ°ä¸­whileå¾ªç¯çæ¶é´å¤æåº¦ä¸ºO(n)ï¼å æ­¤æ´ä¸ªç®æ³çæ¶é´å¤æåº¦ä¸ºO(n + m)ã</p>
<p>KMPç®æ³ä»å½æ¨¡å¼ä¸ä¸»ä¸²ä¹é´å­å¨è®¸å¤âé¨åå¹éâæ¶ï¼æä¼ä½ç°åºå®çä¼å¿ï¼å¦åä¸¤èå·®å¼ä¸ææ¾ã</p>


</div>
<div class="clear"></div>

		<p class="postfoot">
			posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-10 16:31">2026-02-10 16:30</span>&nbsp;
<a href="https://www.cnblogs.com/CodingCat-jiumi">ctxIQä¸º0</a>&nbsp;
éè¯»(<span id="post_view_count">63</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19555666);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19555666', targetLink: 'https://www.cnblogs.com/CodingCat-jiumi/p/19555666', title: 'KMPæ¨¡å¼å¹éç®æ³ââè¯¦ç»è®²è§£ãæ¸æ°ææ' })">ä¸¾æ¥</a>

		</p>
	 ]]>
    </description>
    </item>
        </channel>
        </rss>