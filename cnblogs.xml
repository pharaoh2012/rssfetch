<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-31T10:20:09.930Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ linuxæå¡å¨éé»å®è£Oracle26ai ]]></title>
    <link>https://www.cnblogs.com/liuziyi1/p/19558714</link>
    <guid>8b9dc574a78661f5af078e1c84c19f4b</guid>
    <description>
    <![CDATA[ 
		<h2>
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/liuziyi1/p/19558714" title="åå¸äº 2026-01-31 17:45">
    <span role="heading" aria-level="2">linuxæå¡å¨éé»å®è£Oracle26ai</span>
    

</a>

		</h2>
		<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>ä¸è½½å°åï¼<a href="https://www.oracle.com/database/technologies/oracle26ai-linux-downloads.html" target="_blank" rel="noopener nofollow">https://www.oracle.com/database/technologies/oracle26ai-linux-downloads.html</a><br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3323825/202601/3323825-20260131174508549-1515658553.png" class="lazyload"></p>
<p>1.å®è£ç¯å¢åå¤<br>
1.1.æ¥çç©çåå­<br>
<code>[root@aiserver ~]# free -m</code><br>
1.2.æä½ç³»ç»çæ¬</p>
<pre><code>[root@aiserver ~]#  cat /etc/redhat-release
</code></pre>
<p>1.3.æä½ç³»ç»åå­</p>
<pre><code>[root@aiserver ~]# df -h /dev/shm/
</code></pre>
<p>1.4.ç£çç©ºé´</p>
<pre><code>[root@aiserver ~]# df -TH
[root@aiserver ~]# df -h /tmp/
[root@aiserver ~]# df -h /u01
</code></pre>
<p>1.5.æ¥çç³»ç»æ¶æ</p>
<pre><code>[root@aiserver ~]# uname -m
x86_64
</code></pre>
<p><code>[root@aiserver ~]# cat /proc/version</code></p>
<p>1.6.è§£æ/etc/hosts</p>
<pre><code>[root@aiserver ~]# hostname
aiserver

cat &gt;&gt; /etc/hosts &lt;&lt; EOF
192.168.1.1 aiserver
EOF
</code></pre>
<p>1.7.å³é­é²ç«å¢è¿æselinux</p>
<pre><code>systemctl status firewalld.service
systemctl stop firewalld.service
systemctl disable firewalld.service
</code></pre>
<p><code>sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config</code></p>
<p>2.åå»ºç¨æ·åç»</p>
<h1 id="æ¥çæ¯å¦å®è£æoracleè½¯ä»¶">æ¥çæ¯å¦å®è£æOracleè½¯ä»¶</h1>
<p><code>[root@aiserver ~]# more /etc/oraInst.loc</code></p>
<h1 id="æ¥çæ¯å¦å·²å­å¨ç¸å³ç¨æ·ç»">æ¥çæ¯å¦å·²å­å¨ç¸å³ç¨æ·ç»</h1>
<pre><code>[root@aiserver ~]# grep oinstall /etc/group
[root@aiserver ~]# grep dba /etc/group
[root@aiserver ~]# grep oper /etc/group
</code></pre>
<pre><code>[root@aiserver ~]# /usr/sbin/groupadd -g 54321 oinstall
[root@aiserver ~]# /usr/sbin/groupadd -g 54322 dba
[root@aiserver ~]# /usr/sbin/groupadd -g 54323 oper
[root@aiserver ~]# /usr/sbin/useradd -u 54321 -g oinstall -G dba,oper oracle
</code></pre>
<p>--ä¿®æ¹å¯ç ä¸ºoracle<br>
<code>[root@aiserver ~]# passwd oracle</code></p>
<p>3.åå»ºå·¥ä½çç®å½</p>
<pre><code>[root@aiserver ~]# mkdir -p /u01/app/oracle
[root@aiserver ~]# chown -R oracle:oinstall /u01/
[root@aiserver ~]# chmod -R 775 /u01/app/oracle
</code></pre>
<p>4.éç½®Oracleçç¯å¢åé</p>
<pre><code>[oracle@aiserver ~]$ vi .bash_profile

export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/23.26.1/dbhome_1
export ORACLE_SID=prod
export PATH=$ORACLE_HOME/bin:$PATH:$HOME/bin
</code></pre>
<pre><code>[oracle@aiserver ~]$ source .bash_profile
[oracle@aiserver ~]$ env | grep ORACLE
</code></pre>
<p>5.ä¿®æ¹åæ ¸åæ°<br>
ä»¥ä¸å¨rootç¨æ·ä¸æä½</p>
<pre><code>cp /etc/sysctl.conf /etc/sysctl.conf.bak

cat &gt;&gt; /etc/sysctl.conf &lt;&lt; "EOF"
fs.file-max = 6815744
kernel.sem = 250 32000 100 128
kernel.shmmni = 4096
kernel.shmall = 751619276
kernel.shmmax = 3006477107
kernel.panic_on_oops = 1
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048576
fs.aio-max-nr = 1048576
net.ipv4.ip_local_port_range = 9000 65500
EOF

kernel.shmall :ç©çåå­ç70%
kernel.shmmni=kernel.shmall/4

ç¯å¢åéçæ
sysctl --system
</code></pre>
<p>6./etc/profileéç½®<br>
ä»¥ä¸rootç¨æ·æä½</p>
<pre><code>cp /etc/profile /etc/profile.bak

cat &gt;&gt; /etc/profile &lt;&lt; "EOF"
if [ $USER = "oracle" ]; then
        if [ $SHELL = "/bin/ksh" ]; then
                ulimit -p 16384
                ulimit -n 65536
        else
                ulimit -u 16384 -n 65536
        fi
fi
EOF


vi /etc/pam.d/login
session    required     pam_limits.so
</code></pre>
<p>7.ä¿®æ¹èµæºéå¶<br>
ä»¥ä¸rootç¨æ·æä½</p>
<pre><code>cp /etc/security/limits.conf /etc/security/limits.conf.bak

cat &gt;&gt; /etc/security/limits.conf &lt;&lt; "EOF"
oracle soft nproc 2047
oracle hard nproc 16384
oracle soft nofile 1024
oracle hard nofile 65536
EOF
</code></pre>
<p>8.yumå®è£ä¾èµ</p>
<pre><code>[root@aiserver ~]# mount | grep sr0
mount /dev/cdrom /mnt

echo "[localREPO]" &gt;&gt; /etc/yum.repos.d/my.repo
echo "name=localhost8" &gt;&gt; /etc/yum.repos.d/my.repo
echo "baseurl=file:///mnt/BaseOS" &gt;&gt; /etc/yum.repos.d/my.repo
echo "gpgcheck=0" &gt;&gt; /etc/yum.repos.d/my.repo
echo "enabled=1" &gt;&gt; /etc/yum.repos.d/my.repo

echo "[localREPO_APP]" &gt;&gt; /etc/yum.repos.d/my.repo
echo "name=localhost8_app" &gt;&gt; /etc/yum.repos.d/my.repo
echo "baseurl=file:///mnt/AppStream" &gt;&gt; /etc/yum.repos.d/my.repo
echo "gpgcheck=0" &gt;&gt; /etc/yum.repos.d/my.repo
echo "enabled=1" &gt;&gt; /etc/yum.repos.d/my.repo

[root@aiserver yum.repos.d]# yum repolist
</code></pre>
<p>ä»¥ä¸å½ä»¤å®è£ä¾èµå</p>
<pre><code>yum install bc \
binutils \
compat-openssl10 \
elfutils-libelf \
fontconfig \
glibc \
glibc-devel \
ksh \
libaio \
libXrender \
libX11 \
libXau \
libXi \
libXtst \
libgcc \
libstdc++ \
libxcb \
libibverbs \
libasan \
liblsan \
librdmacm \
make \
policycoreutils \
policycoreutils-python-utils \
smartmontools \
sysstat -y
</code></pre>
<p>9.è§£åè½¯ä»¶ææã<br>
oracleç¨æ·ä¸æä½<br>
<code>[oracle@aiserver ~]$ mkdir -p /u01/app/oracle/product/23.26.1/dbhome_1</code></p>
<p>oracleç¨æ·ä¸æä½<br>
<code>[oracle@aiserver ~]$ unzip /opt/LINUX.X64_2326100_db_home.zip -d $ORACLE_HOME</code></p>
<p>10.éé»å®è£Oracleæ°æ®åº<br>
10.1.ç¼è¾rspæä»¶</p>
<pre><code>[oracle@aiserver ~]$ cd $ORACLE_HOME/install/response
[oracle@aiserver response]$ cp db_install.rsp /tmp
</code></pre>
<pre><code>vi /tmp/db_install.rsp

ä¿®æ¹db_install.rspæä»¶ä¸­ä»¥ä¸åå®¹

oracle.install.option=INSTALL_DB_SWONLY
UNIX_GROUP_NAME=oinstall
INVENTORY_LOCATION=/u01/app/oraInventory
ORACLE_BASE=/u01/app/oracle
ORACLE_HOME=/u01/app/oracle/product/23.26.1/dbhome_1
InstallEdition=EE
OSDBA_GROUP=dba
OSOPER_GROUP=oper
OSBACKUPDBA_GROUP=dba
OSDGDBA_GROUP=dba
OSKMDBA_GROUP=dba
OSRACDBA_GROUP=dba
</code></pre>
<p>dbType=GENERAL_PURPOSE</p>
<p>10.2.éé»å®è£Oracleè½¯ä»¶<br>
[oracle@aiserver ~]$ cd $ORACLE_HOME<br>
./runInstaller -silent -responseFile /tmp/db_install.rsp -ignorePrereq</p>
<h1 id="å®è£ç»æåéè¦ä»¥rootç¨æ·æ§è¡ä»¥ä¸ä¸¤ä¸ªèæ¬">å®è£ç»æåéè¦ä»¥rootç¨æ·æ§è¡ä»¥ä¸ä¸¤ä¸ªèæ¬</h1>
<p>/u01/app/oracle/oraInventory/orainstRoot.sh<br>
/u01/app/oracle/product/23.26.1/dbhome_1/root.sh</p>
<p>11.çå¬åå»º<br>
éé»éç½®çå¬<br>
<code>[oracle@aiserver ~]$ netca -silent -responseFile $ORACLE_HOME/assistants/netca/netca.rsp</code></p>
<p>12.dbcaå»ºåº<br>
12.1.ç¼è¾dbca.rspå®è£æä»¶</p>
<pre><code>[oracle@aiserver ~]$ cd $ORACLE_HOME/assistants/dbca
[oracle@aiserver dbca]$ cp dbca.rsp /tmp
[oracle@aiserver ~]$ vi /tmp/dbca.rsp

responseFileVersion=/oracle/assistants/rspfmt_dbca_response_schema_v23.0.0
gdbName=prod
sid=prod
databaseConfigType=SI
createAsContainerDatabase=true
numberOfPDBs=2
pdbName=prod
templateName=General_Purpose.dbc
oracleHomeUserPassword=oracle
totalMemory=1500
sysPassword=oracle
systemPassword=oracle
datafileDestination=/u01/app/oracle/oradata
characterSet=AL32UTF8
nationalCharacterSet=UTF8
databaseType=OLTP

æ³¨æï¼templateNameãcreateAsContainerDatabaseå¿é æå®
</code></pre>
<p>12.2.éé»å®è£æ°æ®åº<br>
<code>[oracle@aiserver ~]$ dbca -silent -createDatabase -responseFile /tmp/dbca.rsp</code></p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3323825/202601/3323825-20260131174543584-1746664079.png" class="lazyload"></p>


</div>
<div class="clear"></div>

		<p class="postfoot">
			posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-31 17:46">2026-01-31 17:45</span>&nbsp;
<a href="https://www.cnblogs.com/liuziyi1">åå­æ¯</a>&nbsp;
éè¯»(<span id="post_view_count">5</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19558714);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19558714', targetLink: 'https://www.cnblogs.com/liuziyi1/p/19558714', title: 'linuxæå¡å¨éé»å®è£Oracle26ai' })">ä¸¾æ¥</a>

		</p>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ¶æå¸å¿å¤ï¼ç°åº¦æ¹æ¡æ±æ» ]]></title>
    <link>https://www.cnblogs.com/toplist/p/19527704</link>
    <guid>7e92593f124e573b1bb1fb05309e071f</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/toplist/p/19527704" title="åå¸äº 2026-01-31 17:35">
    <span role="heading" aria-level="2">æ¶æå¸å¿å¤ï¼ç°åº¦æ¹æ¡æ±æ»</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¤§å®¶å¥½ï¼ææ¯Javaççå¸ãæ¬æç»åç¬èçç»éªåæèï¼å¯¹ç°åº¦æ¹æ¡åä¸ªæ»ç»ï¼éç¹ä»ç»ABå®éªã</p>
<p>ç°åº¦å¨å¼åæµç¨ä¸­éå¸¸æ®éãååå°æµééªè¯ï¼ç¡®è®¤æ è¯¯ååæ¨å¨ï¼ç°åº¦è¿ç¨ä¸­ä¸æ¦åç°ç³»ç»å¼å¸¸ãæä¸å¡ææ å¼å¸¸ï¼åºç«å»åæ»ã</p>
<h1 id="ç°åº¦åºæ¯">ç°åº¦åºæ¯</h1>
<ul>
<li>ä»£ç ç°åº¦ï¼æ¯æå¸åçç°åº¦ï¼ç°åº¦ååæ°é»è¾ï¼ç°åº¦å¤åæ§é»è¾
<ul>
<li>æ¢å¯ä»¥æä¾v2çæ¬æ°æ¥å£ç»è°ç¨æ¹æå¡ï¼ç±è°ç¨æ¹æ¥åç°åº¦åæ¢</li>
<li>ä¹å¯ä»¥åé¨åç°åº¦ï¼åå°è°ç¨æ¹æ æ</li>
</ul>
</li>
<li>åçç°åº¦ï¼ä¸çº¿è¿ç¨ä¸­ï¼æ°çæ¬æå¡å®ä¾ä¸æ­å¢å ï¼éèèå¼å®¹æ°æ§åè®®</li>
<li>éç½®ç°åº¦ï¼ä¿®æ¹éç½®æ¶ï¼ææå¡å®ä¾ç°åº¦æ¨ééç½®åæ´</li>
</ul>
<h1 id="ç°åº¦æ¨¡å¼">ç°åº¦æ¨¡å¼</h1>
<ul>
<li>æ°å­idå°¾å·ç°åº¦ï¼åidæå2ä½ï¼ç¾åæ¯ï¼ãæå3ä½ï¼ååæ¯ï¼ãæå4ä½ï¼ä¸åæ¯ï¼ç­
<ul>
<li>å®ç°æ¹å¼ï¼idåæ¨¡ï¼ä¾å¦ <code>id % 100 &lt; ç°åº¦ç¾åæ¯</code>ï¼åå½ä¸­ç°åº¦</li>
<li>ç¹ç¹ï¼ç®åï¼éç¨äºç»å¤§é¨åææ¯ä¼ååºæ¯</li>
</ul>
</li>
<li>éæºç°åº¦ï¼åä¸é¨åéæºæµéåç°åº¦
<ul>
<li>å®ç°æ¹å¼ï¼<code>ThreadLocalRandom.current().nextInt(100) &lt; ç°åº¦ç¾åæ¯</code></li>
<li>ä¹æä»¥ä½¿ç¨ThreadLocalRandomãèä¸æ¯Randomï¼æ¯ä¸ºäºé¿åå¤çº¿ç¨ç«äºç¨äºçæéæºæ°çseed</li>
</ul>
</li>
<li>A/Bå®éª
<ul>
<li>å®ç°æ¹å¼ï¼åå±å®éªãå®éªæ°æ®æ¶éãç¦»çº¿ç»è®¡</li>
<li>ç¹ç¹ï¼éç¨äºå°æµééªè¯æ°ä¸å¡åè½çææï¼æ´ä½æ¹æ¡ç¸å¯¹å¤æï¼éè¦ææ¯åºå»º</li>
</ul>
</li>
</ul>
<h1 id="idéå">idéå</h1>
<ul>
<li>ä¸å¡idï¼å¦ç¨æ·idãååidç­</li>
<li>è®¾å¤idï¼æªæ³¨å/æªç»å½ç¨æ·ï¼æ­¤æ¶æ²¡æç¨æ·idï¼åªè½åè®¾å¤çå¯ä¸æ è¯</li>
</ul>
<p>ä¸é¢éç¹ä»ç»ä¸ä¸A/Bå®éªã</p>
<h1 id="abå®éª">A/Bå®éª</h1>
<h2 id="ç®ç">ç®ç</h2>
<ul>
<li>å°æµééªè¯æ°ä¸å¡åè½ï¼æ­£åæ¾èåæ¨è³å¨éï¼å¦åç»§ç»­è¿­ä»£ä¼åãæä¸çº¿ï¼é¿ååè½è¿äºèè¿</li>
<li>ç¨æ°æ®ä½ä¸ºä¾æ®ï¼é¿åæ³å½ç¶ãæèè¢å³ç­</li>
</ul>
<h2 id="åå±å®éª">åå±å®éª</h2>
<p>ä¸»è¦ç®çæ¯ä¸ºäºåæ¶åå¤ä¸ªå®éªï¼èä¸æ¯ç»æ¯ä¸ªå®éªååä¸é¨åæµéãå ä¸ºå½åæ¶è¿è¡çå®éªåå¤æ¶ï¼ç»åæ°éæåå¢å ï¼æ¯ä¸ªå®éªåå°çæµéå°±å¾å°äºã<br>
æè¿å å±ç»æï¼å®éªå±ãå®éªãåç»</p>
<ul>
<li>å®éªå±ä¹é´æ­£äº¤ï¼å¯åæ¶è¿è¡å¤ä¸ªå®éªå±çå®éª</li>
<li>åä¸å®éªå±çå®éªä¹é´äºæ¥ï¼æ¯å¦å½ä¸­äºå®éª1-1ï¼å°±ä¸ä¼å½ä¸­å®éª1-2ãå®éªææ0å°å¤ä¸ªåæ¡¶ï¼æ ¹æ®ä¸å¡idå¯è®¡ç®åºæ¡¶å·ï¼è¿èç¥éå½ä¸­åªä¸ªå®éª</li>
<li>åä¸å®éªåæå¤ä¸ªåç»ï¼åæ¬1ä¸ªå¯¹ç§ç»ï¼å1å°å¤ä¸ªå®éªç»ï¼åªä¼å½ä¸­å¶ä¸­ä¸ä¸ªåç»ãåç»ææ0å°å¤ä¸ªåæ¡¶ï¼æ ¹æ®ä¸å¡idå¯è®¡ç®åºæ¡¶å·ï¼è¿èç¥éå½ä¸­åªä¸ªåç»</li>
</ul>
<p>å®éªå±ãå®éªä¸¾ä¾ï¼</p>
<ul>
<li>å±ç¤ºå®éªå±ï¼æ ¹æ®é¡µé¢è¿è¡ååï¼å¦é¦é¡µãæç´¢é¡µãæ¨èé¡µãè¯¦æé¡µç­ãæ¯ä¸ªé¡µé¢ä½ä¸ºä¸ä¸ªå®éªå±ï¼æ¯ä¸ªå®éªå±éå¯åæ¶åå¤ä¸ªå±ç¤ºå®éª</li>
<li>ç®æ³å®éªå±ï¼æ ¹æ®åºæ¯è¿è¡ååï¼å¦ç¸ä¼¼æ¨èãæ­éè´­æ¨èãä¸ªæ§åæ¨èãæç´¢æåºãå¹¿åæåºç­ãæ¯ä¸ªåºæ¯ä½ä¸ºä¸ä¸ªå®éªå±ï¼æ¯ä¸ªå®éªå±éå¯åæ¶åå¤ä¸ªç®æ³å®éª</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/1247698/202601/1247698-20260127012326894-198795136.png" alt="image" loading="lazy"></p>
<h2 id="åå¸ç®æ³ææ£">åå¸ç®æ³ææ£</h2>
<p>è¦åæ¶æ¯æå¤ä¸ªåå±å®éªï¼æ ¸å¿å¨äºéè¿åå¸ç®æ³å°æ¯ä¸å±çæµéææ£ï¼ç¨äºå®ç°âåååæµâåâå±é´æ­£äº¤âï¼ä½¿å¾æµéå¨åä¸ªå®éªçæææ­£è´æµæ¶ï¼æè½å¾å°çå®çå¯¹æ¯ç»æã<br>
ä»¥ä¸æ¯è®¡ç®å®éªå±æ¡¶å·çä»£ç ç¤ºä¾ï¼å®éªæ¡¶å·åçï¼</p>
<pre><code class="language-java">import com.google.common.hash.Hashing;
import java.nio.charset.StandardCharsets;

public class ABTestRouter {

    /**
     * æ ¹æ®ç¨æ·IDåå®éªå±IDï¼å®éªå±IDåå½ççè§è²ï¼ï¼è®¡ç®æ¡¶å· (0-99)
     */
    public static int getBucket(String userId, String layerId) {
        // 1. æ¼æ¥ Key: "layerId:userId"
        String key = layerId + ":" + userId;

        // 2. ä½¿ç¨ MurmurHash3 (32-bit)
        // Guava ç murmur3_32_fixed æ¯çº¿ç¨å®å¨ç
        int hash = Hashing.murmur3_32_fixed()
                .hashString(key, StandardCharsets.UTF_8)
                .asInt();

        // 3. åæ¨¡å¹¶ç¡®ä¿ç»æä¸ºæ­£æ°
        // Math.abs(Integer.MIN_VALUE) ä¼è¿åè´æ°ï¼æä»¥æ¨èä½¿ç¨ä½è¿ç®å»é¤ç¬¦å·ä½
        return (hash &amp; Integer.MAX_VALUE) % 100;
    }

    public static void main(String[] args) {
        String uid = "user_123456";
        
        // ä¸åå±çæµéæ¯æ­£äº¤çï¼ææ£éæ°åéï¼
        System.out.println("å±ç¤ºå±æ¡¶å·: " + getBucket(uid, "layer_ui"));
        System.out.println("ç®æ³å±æ¡¶å·: " + getBucket(uid, "layer_algo"));
    }
}
</code></pre>
<p>ä¹æä»¥ç¨murmurhashï¼èémd5ï¼æ¯å ä¸ºmd5æ¯å å¯ç®æ³ï¼è®¡ç®å¼éæ´å¤§ï¼å¨ABå®éªä¸­ä»éååææ£å³å¯ï¼æ éæå¿æ ¹æ®åå¸ç»æåæ¨åæã<br>
ä¹æä»¥æå®éªå±idä½ä¸ºçï¼æ¯å ä¸ºå¾®å°çè¾å¥å·®å¼é½ä¼å¯¼è´åå¸ç»æç¸å·®å·¨å¤§ï¼å®ç°ææ£çææã</p>
<h2 id="å®éªæ°æ®æ¶é">å®éªæ°æ®æ¶é</h2>
<p>å®éªæ°æ®æ¶éæµç¨å¦ä¸ï¼</p>
<ul>
<li>å¨ABå®éªç®¡çç³»ç»ä¸­éç½®å®éªä¿¡æ¯ï¼å¦å®éªçå¼ãæ¡¶å·ä¸å®éªç»çæ å°å³ç³»ç­ï¼å¯å¨æä¿®æ¹</li>
<li>ä»£ç é»è¾å¼åï¼
<ul>
<li>å¼å¥å®éªsdkï¼sdkå¨å¯å¨ãæéç½®åæ´æ¶æåå®éªä¿¡æ¯ï¼æ¬å°è®¡ç®ä¸å¡idçæ¡¶å·ï¼è¿èå¾å°å½ä¸­çåç»</li>
<li>å¯¹ç§ç»åå½åé»è¾ï¼å®éªç»1åé»è¾1ï¼å®éªç»2åé»è¾2</li>
</ul>
</li>
<li>å¨æ­£å¼å¼å§ABå®éªä¹åï¼ååAAåæ¡¶å®éªï¼æ¨¡æå®éªç»ãå¯¹ç§ç»çç»æï¼å¤æ­æ¯å¦ååï¼é¿ååæ¡¶ä¸ååå¸¦æ¥éè¯¯çå®éªç»æ</li>
<li>å®éªå¼å§ï¼åç«¯åç¹ï¼sdkååºåç«¯åç¹æ¶æ¯
<ul>
<li>æ¶æ¯æ ¼å¼ä¸¾ä¾ï¼<code>ä¸å¡id, å®éªå±id, å®éªid, åç»id, æ¡¶å·, è§¦åæ¶é´</code></li>
</ul>
</li>
<li>å®éªè¿ç¨ï¼å®éªæç»­æ¶é´è³å°ä¸å¨ï¼è¦çå·¥ä½æ¥ãå¨æ«/åæï¼é¿ååæ¶é´å¨æå¸¦æ¥çæ³¢å¨å½±å</li>
<li>ç¦»çº¿ç»è®¡å®éªææï¼
<ul>
<li>åç«¯åç¹æ°æ®å¯¼å¥æåäºä»¶hiveè¡¨</li>
<li>ä¸å¡DBæ°æ®å¯¼å¥è¡ä¸ºäºä»¶hiveè¡¨ï¼å¦æ³¨åãç»å½ãæµè§ãç¹å»ãæ¶èãå è´­ãä¸åãæ¯ä»ç­ï¼åå³äºå®éªå³æ³¨çä¸å¡ææ </li>
<li>ææåäºä»¶ãè¡ä¸ºäºä»¶joinèµ·æ¥ï¼å¯¹æ¯å®éªç»ãå¯¹ç§ç»çä¸å¡ææ å·®å¼</li>
</ul>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/1247698/202601/1247698-20260131014010302-1779078827.png" alt="image" loading="lazy"></p>
<p>ä»¥ä¸æ¯sqlç¤ºä¾ï¼ä»£è¡¨ä»å®éªæåå24å°æ¶ååä¸ªåç»çè½¬åçå¯¹æ¯ã</p>
<pre><code class="language-sql">SELECT 
    e.group_id,
    COUNT(DISTINCT e.user_id) as exposed_users,
    COUNT(DISTINCT a.user_id) as converted_users,
    COUNT(DISTINCT a.user_id) / COUNT(DISTINCT e.user_id) as conversion_rate
FROM exposure_events e
LEFT JOIN action_events a ON e.user_id = a.user_id 
    AND a.event_time BETWEEN e.event_time AND (e.event_time + INTERVAL 24 HOUR)
WHERE e.experiment_id = 'ui_test_001'
GROUP BY e.group_id;
</code></pre>
<h2 id="å®éªæ¥è¡¨åæ">å®éªæ¥è¡¨åæ</h2>
<p>è¯ä¼°å®éªç»ææ¯å¦æ­£åãæ¯å¦æ¾èãäºè§£ç»è®¡å­¦éçæ ¸å¿æ¦å¿µï¼è½çæå®éªæ¥è¡¨å³å¯ã</p>
<h3 id="på¼">på¼</h3>
<p>ç¨æ¥è¡¡éå®éªç»ææ¯å¦æ¾èï¼på¼çå«ä¹æ¯ï¼åè®¾å®éªç»ä¸å¯¹ç§ç»æ²¡æåºå«ï¼æ­¤æ¶è§å¯å°å®éªæå·®å¼çæ¦çãä¸è¬è¦æ± <code>p &lt; 0.05</code>ï¼ä¹å°±æ¯è¯´å®éªç»ææ¾èçæ¦çå¤§äº95%ï¼<code>1 - 0.05 = 95%</code>ï¼</p>
<h3 id="ç½®ä¿¡åºé´">ç½®ä¿¡åºé´</h3>
<p>å¨æ¾èçåæä¸ï¼ç¨æ¥è¡¡éå®éªç»ææ¯å¦æ­£åï¼ä»£è¡¨ä¸å¡ææ çå¯è½èå´åå¸ã<br>
æ¯å¦ï¼å®éªç»æéä¸å¡ææ æåäº1%ï¼95%ç½®ä¿¡åºé´å¨[0.8%, 1.2%]ï¼åä»£è¡¨æ95%çææ¡å¯ä»¥æä¸å¡ææ æåè³å°0.8%ãè³å¤1.2%ï¼æææ­£åãå¦æç½®ä¿¡åºé´çä¸çæ¯è´æ°ï¼å°±æå¯è½æ¯è´åææäºï¼éè¦è­¦æã</p>
<p>ä»¥ä¸å°±æ¯ç°åº¦æ¹æ¡çæ»ç»äºï¼æ¬¢è¿è®¨è®ºäº¤æµã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-31 17:35">2026-01-31 17:35</span>&nbsp;
<a href="https://www.cnblogs.com/toplist">Javaççå¸</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19527704);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19527704', targetLink: 'https://www.cnblogs.com/toplist/p/19527704', title: 'æ¶æå¸å¿å¤ï¼ç°åº¦æ¹æ¡æ±æ»' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ°æ®âæ¾å¾®éâï¼èç¾¤å¾è®©æ¯ä¸ªæ°æ®ç¹é½åå£° ]]></title>
    <link>https://www.cnblogs.com/wang_yb/p/19557785</link>
    <guid>4254e035ab252d6c7896e93e09119a14</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/wang_yb/p/19557785" title="åå¸äº 2026-01-31 14:22">
    <span role="heading" aria-level="2">æ°æ®âæ¾å¾®éâï¼èç¾¤å¾è®©æ¯ä¸ªæ°æ®ç¹é½åå£°</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ³è±¡ä¸ä¸å¤æ¥çè±ä¸ä¸­ï¼æç¾¤çèèå´ç»çè±æµå¿ç¢å°é£èãæ¯åªèèé½æ¯ä¸ä¸ªç¬ç«çæ°æ®ç¹ï¼å®ä»¬æ¢ä¿æç¾¤ä½èéçå½¢æï¼åä¸ä¼å®å¨éå å¨ä¸èµ·ã</p>
<p>è¿å°±æ¯<strong>èç¾¤å¾</strong>ï¼<code>Swarm Plot</code>ï¼ç<strong>æ ¸å¿çå¿µ</strong>ââå¨æéçç©ºé´åå±ç¤ºæææ°æ®ç¹ï¼è®©æ¯ä¸ªç¹é½è½è¢«æ¸æ°çè§ã</p>
<p><strong>èç¾¤å¾</strong>æ¯ä¸ç§ç¹æ®çæ°æ®å¯è§åå¾è¡¨ï¼å®å°åç±»æ°æ®ä¸æ°å¼æ°æ®ç»åèµ·æ¥ï¼å±ç¤ºæ°æ®çåå¸æåµã</p>
<p>ä¸ä¼ ç»çæ¡å½¢å¾æç®±çº¿å¾ä¸åï¼èç¾¤å¾ä¸è¿è¡ä»»ä½æ°æ®èåï¼èæ¯å±ç¤ºæ¯ä¸ä¸ªåå§æ°æ®ç¹ï¼é¿åäºä¿¡æ¯ä¸¢å¤±ã</p>
<h1 id="1-èç¾¤å¾æ ¸å¿ç¹ç¹">1. èç¾¤å¾æ ¸å¿ç¹ç¹</h1>
<p><strong>èç¾¤å¾</strong>æå·§å¦çå°æ¹å¨äºå®çå¸å±ç®æ³ã</p>
<p>å½å¤ä¸ªæ°æ®ç¹å·æç¸ä¼¼æ°å¼æ¶ï¼å®ä»¬ä¸ä¼ç®åå°éå å¨ä¸èµ·ï¼èæ¯åæâææ¥åâä¸æ ·ï¼å¨åç´æ¹åï¼ææ°´å¹³æ¹åï¼ä¸è½»å¾®åç§»ï¼å½¢æä¸ä¸ªç±»ä¼¼èç¾¤çåå¸ã</p>
<p>æ¯å¦ï¼ä¸é¢æ¯<strong>åä¸ç»æ°æ®</strong>å¨<strong>æ£ç¹å¾</strong>å<strong>èç¾¤å¾</strong>ä¸­å±ç¤ºçææã</p>

<p><img src="https://img2024.cnblogs.com/blog/83005/202601/83005-20260131142128895-781019092.png" alt="" loading="lazy"></p>
<p>ä»ä¸­å¯ä»¥çåºèç¾¤å¾çæ ¸å¿ç¹ç¹æï¼</p>
<ol>
<li><strong>ç»ä¸éå </strong>ï¼ å®éè¿ç®æ³æ£æµæ°æ®ç¹çéå æåµï¼ä¸æ¦åç°ä¸¤ä¸ªç¹æ°å¼ç¸è¿ï¼å°±ä¼èªå¨æå®ä»¬åæ°´å¹³æ¹åæ¨å¼ã</li>
<li><strong>ä¿çåå¸å½¢æ</strong>ï¼ æ£å¼åçå½¢ç¶ï¼å¤©ç¶å½¢æäºä¸ç§ç±»ä¼¼âå°æç´âæâå±±å³°âçè½®å»ï¼ç´è§å°å±ç¤ºäºæ°æ®çå¯åº¦ã</li>
<li><strong>åæ°è°æ´</strong>ï¼ æä»¬å¯ä»¥è°æ´ç¹çå¤§å°ï¼marker sizeï¼åæåçç´§å¯ç¨åº¦ãç¹è¶å¤§ï¼è§è§å²å»åè¶å¼ºï¼ä½éè¦çæ°´å¹³ç©ºé´ä¹è¶å¤ã</li>
</ol>
<h1 id="2-èç¾¤å¾-vs-æ¡å½¢å¾ä»æè¦å°ç»è">2. èç¾¤å¾ vs. æ¡å½¢å¾ï¼ä»æè¦å°ç»è</h1>
<p><strong>æ¡å½¢å¾</strong>å°±åæ¯ä¸ä»½æ°æ®æè¦æ¥åï¼å®åè¯æä»¬æ¯ä¸ªç±»å«çå¹³åå¼ææ»è®¡å¼ï¼ä½éèäºæ°æ®åé¨çåå¸ç»èã</p>
<p>è<strong>èç¾¤å¾</strong>ååæ¯ä¸æ¬¡æ°æ®ç¹çå¨åå¤§ä¼ï¼æ¯ä¸ªæ°æ®ç¹é½æåè¨çæºä¼ã</p>
<p>ä¸é¢éå¯¹åä¸ç»æ°æ®ï¼æä»¬åå«ç»å¶äº<strong>æ¡å½¢å¾</strong>ã<strong>ç®±çº¿å¾</strong>å<strong>èç¾¤å¾</strong>ï¼ä¸èµ·æ¥æåä¸ä¸å®ä»¬ä¹é´ä¸åçå±ç¤ºææã</p>
<pre><code class="language-python"># çæç¤ºä¾æ°æ®
np.random.seed(123)
categories = ["äº§åA", "äº§åB", "äº§åC", "äº§åD"]
data_comparison = []
for category in categories:
    n_points = 40
    if category == "äº§åA":
        values = np.random.normal(75, 8, n_points)
    elif category == "äº§åB":
        values = np.random.normal(82, 12, n_points)
    elif category == "äº§åC":
        values = np.random.normal(65, 5, n_points)
    else:  # äº§åD
        # åå»ºä¸ä¸ªåå³°åå¸
        values1 = np.random.normal(55, 6, n_points // 2)
        values2 = np.random.normal(85, 7, n_points // 2)
        values = np.concatenate([values1, values2])

    for value in values:
        data_comparison.append({"äº§å": category, "ç¨æ·è¯å": value})

# 1. æ¡å½¢å¾ï¼å¹³åå¼ï¼
means = []
for category in categories:
    cat_data = [d["ç¨æ·è¯å"] for d in data_comparison if d["äº§å"] == category]
    means.append(np.mean(cat_data))

bars = axes[0].bar(
    categories, means, color=["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728"]
)


# å¨æ¡å½¢ä¸æ æ³¨å¹³åå¼
# çç¥...

# 2. ç®±çº¿å¾
box_data = []
for category in categories:
    cat_data = [d["ç¨æ·è¯å"] for d in data_comparison if d["äº§å"] == category]
    box_data.append(cat_data)

boxplot = axes[1].boxplot(
    box_data, tick_labels=categories, patch_artist=True, boxprops=dict(facecolor="lightblue")
)
# çç¥...

# 3. èç¾¤å¾
data_df = pd.DataFrame(data_comparison)
sns.swarmplot(
    x="äº§å",
    y="ç¨æ·è¯å",
    hue="äº§å",
    data=data_df,
    ax=axes[2],
    size=5,
    palette="Set2",
    edgecolor="black",
    linewidth=0.5,
)
# çç¥...

plt.tight_layout()
plt.show()

</code></pre>

<p><img src="https://img2024.cnblogs.com/blog/83005/202601/83005-20260131142128894-2129735776.png" alt="" loading="lazy"></p>
<p>ç»å¶èç¾¤å¾å¯ä»¥ç¨<code>seaborn</code>è¿ä¸ªåºä¸­ç<code>swarmplot</code>å½æ°ã</p>
<p>ä»ä¸é¢çå¯¹æ¯å¯ä»¥çåºï¼</p>
<ul>
<li><strong>æ¡å½¢å¾</strong>åè¯æä»¬äº§åDçå¹³ååçº¦ä¸º70å</li>
<li><strong>ç®±çº¿å¾</strong>æç¤ºäº§åDçæ°æ®åå¸èå´å¾å¹¿</li>
<li>ä½åªæ<strong>èç¾¤å¾</strong>æ¸æ°å°æ­ç¤ºäºäº§åDå®éä¸æä¸¤ä¸ªææ¾çç¨æ·ç¾¤ä½ï¼ä¸ä¸ªä½è¯åç¾¤ä½åä¸ä¸ªé«è¯åç¾¤ä½</li>
</ul>
<h1 id="3-èç¾¤å¾-vs-æ£ç¹å¾ä»æ··ä¹±å°æåº">3. èç¾¤å¾ vs. æ£ç¹å¾ï¼ä»æ··ä¹±å°æåº</h1>
<p>ä¼ ç»<strong>æ£ç¹å¾</strong>å¨å¤çåç±»æ°æ®æ¶ï¼å¸¸å¸¸å¯¼è´æ°æ®ç¹å¤§ééå ï¼å½¢æ"é»å¢"ï¼æä»¬æ æ³çæ¸æ°æ®ç¹ççå®åå¸ã</p>
<p><strong>èç¾¤å¾</strong>éè¿æºè½å¸å±ç®æ³è§£å³äºè¿ä¸ªé®é¢ã</p>
<p>ä¸é¢æé ä¸ä¸ªä¸åå¯åº¦çæ°æ®ï¼ççèç¾¤å¾åæ£ç¹å¾çå±ç¤ºææã</p>
<pre><code class="language-python"># æ¯è¾æ£ç¹å¾ä¸èç¾¤å¾çè§è§ææ
fig, axes = plt.subplots(1, 2, figsize=(14, 6))

# çæå·æä¸åå¯åº¦çæ°æ®
np.random.seed(42)
density_data = []
categories = ["ä½å¯åº¦", "ä¸­ç­å¯åº¦", "é«å¯åº¦"]
for i, category in enumerate(categories):
    n_points = 20 + i * 30  # ä¸åå¯åº¦
    if category == "ä½å¯åº¦":
        values = np.random.normal(50, 15, n_points)
    elif category == "ä¸­ç­å¯åº¦":
        values = np.random.normal(50, 8, n_points)
    else:  # é«å¯åº¦
        values = np.random.normal(50, 4, n_points)

    for value in values:
        density_data.append({"ç±»å«": category, "æ°å¼": value})

# å·¦ä¾§ï¼ä¼ ç»æ£ç¹å¾
for i, category in enumerate(categories):
    cat_data = [d["æ°å¼"] for d in density_data if d["ç±»å«"] == category]
    x_positions = np.full(len(cat_data), i)
    axes[0].scatter(x_positions, cat_data, alpha=0.6, s=60, label=category)

#çç¥...

# å³ä¾§ï¼èç¾¤å¾
density_data_df = pd.DataFrame(density_data)
sns.swarmplot(
    x="ç±»å«",
    y="æ°å¼",
    hue="ç±»å«",
    data=density_data_df,
    ax=axes[1],
    size=6,
    palette="coolwarm",
    edgecolor="black",
    linewidth=0.5,
)
#çç¥...

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://img2024.cnblogs.com/blog/83005/202601/83005-20260131142128896-1164818687.png" alt="" loading="lazy"></p>
<p><strong>èç¾¤å¾</strong>è§£å³äº <strong>âéå ï¼Overplottingï¼â</strong> çé®é¢ãå¨æ°æ®ééä¸­ï¼å ç¾å°å åä¸ªç¹ï¼æ¶ï¼å®æ¯å±ç¤ºåå¸å¯åº¦çæä½³éæ©ã</p>
<h1 id="4-èç¾¤å¾çéç¨åºæ¯">4. èç¾¤å¾çéç¨åºæ¯</h1>
<p><strong>èç¾¤å¾</strong>å¹¶ä¸æ¯ä¸ºäºåä»£<strong>æ¡å½¢å¾</strong>æ<strong>æ£ç¹å¾</strong>ï¼å®æèªå·±çéç¨åºæ¯åå±éæ§ã</p>
<p>éåä½¿ç¨<strong>èç¾¤å¾</strong>çåºæ¯ï¼</p>
<ul>
<li>æ ·æ¬ééä¸­ï¼éå¸¸å°äºå ç¾ä¸ªç¹ï¼æ¶ï¼å±ç¤ºå®æ´æ°æ®åå¸</li>
<li>éè¦åæ¶çå°æ´ä½è¶å¿åä¸ªä½æ°æ®ç¹</li>
<li>æ°æ®æå¤ä¸ªåç±»åéï¼éè¦æ¯è¾ä¸åç±»å«åå¸</li>
<li>å¸æåç°å¼å¸¸å¼æç¹æ®æ¨¡å¼ï¼å¦åå³°åå¸ï¼</li>
</ul>
<p><font style="color: rgba(15, 17, 21, 1)"></font></p>
<p><strong>èç¾¤å¾</strong>ç<strong>å±éæ§</strong>ä¸»è¦æï¼</p>
<ol>
<li>å¤§æ°æ®éå¯è½å¯¼è´å¾è¡¨è¿äºæ¥æ¤</li>
<li>å¯¹äºéå¸¸å¤§è§æ¨¡æ°æ®ï¼ç®±çº¿å¾æå°æç´å¾å¯è½æ´åé</li>
<li>ç²¾ç¡®çæ°å¼æ¯è¾ä¸å¦æ¡å½¢å¾ç´è§</li>
</ol>
<h1 id="5-æ»ç»">5. æ»ç»</h1>
<p><strong>èç¾¤å¾</strong>å°±åæ°æ®å¯è§åé¢åç"æ¾å¾®é"ï¼å®è®©æä»¬æ¢è½è§å¯å°æ°æ®çæ´ä½åå¸å½¢æï¼åè½çå°æ¯ä¸ä¸ªæ°æ®ç¹çå·ä½ä½ç½®ã</p>
<p>ä¸åªè½æ¾ç¤ºæè¦ä¿¡æ¯ç<strong>æ¡å½¢å¾</strong>åå®¹æäº§çéå ç<strong>æ£ç¹å¾</strong>ç¸æ¯ï¼<strong>èç¾¤å¾</strong>å¨æ¾ç¤ºä¸­å°åæ°æ®éçå®æ´åå¸ä¿¡æ¯æ¹é¢å·æç¬ç¹ä¼å¿ã</p>
<p>å¨æ°æ®å¯è§åå®è·µä¸­ï¼éæ©æ­£ç¡®çå¾è¡¨ç±»åå°±åéæ©æ­£ç¡®çå·¥å·ä¸æ ·éè¦ã</p>
<p>å½ä¸ä¸æ¬¡ä½ éè¦å±ç¤ºåç±»æ°æ®çåå¸æ¶ï¼ä¸å¦¨å°è¯ä¸ä¸èç¾¤å¾ï¼å®å¯è½ä¼æ­ç¤ºåºä½ ä»æªæ³¨æå°çæ°æ®ç§å¯ã</p>
<p>æä¸­çå®æ´ä»£ç å±äº«å¨ï¼<a href="https://url11.ctfile.com/f/45455611-8639900394-9a109f?p=6872" target="_blank" rel="noopener nofollow">èç¾¤å¾.ipynb</a> (è®¿é®å¯ç : 6872)</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-31 14:22">2026-01-31 14:22</span>&nbsp;
<a href="https://www.cnblogs.com/wang_yb">wang_yb</a>&nbsp;
éè¯»(<span id="post_view_count">43</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19557785);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19557785', targetLink: 'https://www.cnblogs.com/wang_yb/p/19557785', title: 'æ°æ®âæ¾å¾®éâï¼èç¾¤å¾è®©æ¯ä¸ªæ°æ®ç¹é½åå£°' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ C++ å°è£ C FFI æ¥å£æä½³å®è·µï¼ä»¥ Hugging Face Tokenizer ä¸ºä¾ ]]></title>
    <link>https://www.cnblogs.com/charlee44/p/19557586</link>
    <guid>e4fd64102f9d44c52c02fa3a99c6b27d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/charlee44/p/19557586" title="åå¸äº 2026-01-31 13:36">
    <span role="heading" aria-level="2">C++ å°è£ C FFI æ¥å£æä½³å®è·µï¼ä»¥ Hugging Face Tokenizer ä¸ºä¾</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        è¯¦ç»ä»ç»äºå¦ä½éè¿ Rust ç C FFI å°è£ Hugging Face tokenizersï¼å¹¶å¨ C++ ä¸­å©ç¨ RAII åæºè½æéå®ç°å®å¨ãç®æ´ãé«æçèµæºç®¡çï¼æç»éµå¾ªç°ä»£ C++ çâé¶æ³åâå®æå·¥ä¸çº§å°è£ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="1-å¼å¥">1. å¼å¥</h1>
<p>å¨ç°ä»£ AI å·¥ç¨ä¸­ï¼Hugging Face ç tokenizers åºå·²æä¸ºåè¯å¨çäºå®æ åãä¸è¿ Hugging Face ç tokenizers æ¯ç¨ Rust æ¥å®ç°çï¼å®æ¹åªæä¾äº python å node çç»å®å®ç°ãè¦å®ç°ä¸ Hugging Face tokenizers ç¸åçè¡ä¸ºï¼æå¥½çåæ³å°±æ¯èªå·±å°è£ Hugging Face tokenizers ç C ç»å®ï¼ä»èå¯ä»¥è¢« C++ / C# / Java è¿äºé«çº§ç¼ç¨è¯­è¨è°ç¨ã</p>
<h1 id="2-å°è£-c-æ¥å£">2. å°è£ C æ¥å£</h1>
<p>é¦åè¦è¯´æçæ¯ï¼è¦åçä¸æ¯å®æ´çå°è£ Hugging Face tokenizers ç C ç FFIï¼Foreign Function Interfaceï¼æ¥å£ï¼èæ¯å°è£èªå·±éè¦çæ¥å£å°±å¯ä»¥äºãæ¯å¦æ§è¡åè¯æ¥å£åè®¡ç®Tokençæ¥å£ï¼</p>
<pre><code class="language-rust">use std::ffi::CStr;
use std::os::raw::c_char;
use tokenizers::{PaddingParams, Tokenizer, TruncationParams};

// === 1. å®ä¹ C å¼å®¹çè¿åç»æä½ ===
#[repr(C)]
pub struct TokenizerResult {
    pub input_ids: *mut i64,
    pub attention_mask: *mut i64,
    pub token_type_ids: *mut i64,
    pub length: u64,
}

// === 2. åé¨ç¶æï¼åè£ Tokenizer ===
struct TokenizerHandle {
    tokenizer: Tokenizer,     // ç¨äº encodeï¼å¸¦ paddingï¼
    raw_tokenizer: Tokenizer, // ç¨äº countï¼æ  paddingï¼
}

// === 3. è¾å©å½æ°ï¼å° Rust Vec è½¬ä¸º C å¯æ¥æçæé ===
fn vec_to_c_ptr(vec: Vec&lt;i64&gt;) -&gt; *mut i64 {
    let mut boxed = vec.into_boxed_slice();
    let ptr = boxed.as_mut_ptr();
    std::mem::forget(boxed); // é²æ­¢ Rust èªå¨éæ¾
    ptr
}

// === 4. åå»º tokenizer ===
#[unsafe(no_mangle)] // ç¦ç¨ name manglingï¼è®© C è½æ¾å°ç¬¦å·
pub extern "C" fn tokenizer_create(tokenizer_json_path: *const c_char) -&gt; *mut std::ffi::c_void {
    if tokenizer_json_path.is_null() {
        return std::ptr::null_mut();
    }

    let path_cstr = unsafe { CStr::from_ptr(tokenizer_json_path) };
    let path_str = match path_cstr.to_str() {
        Ok(s) =&gt; s,
        Err(_) =&gt; return std::ptr::null_mut(),
    };

    let mut tokenizer = match Tokenizer::from_file(path_str) {
        Ok(t) =&gt; t,
        Err(_) =&gt; return std::ptr::null_mut(),
    };

    // è®¾ç½® padding/truncation å° 512ï¼BGE é»è®¤ï¼
    tokenizer.with_padding(Some(PaddingParams {
        strategy: tokenizers::PaddingStrategy::Fixed(512),
        ..Default::default()
    }));

    if tokenizer
        .with_truncation(Some(TruncationParams {
            max_length: 512,
            ..Default::default()
        }))
        .is_err()
    {
        return std::ptr::null_mut();
    }

    let mut raw_tokenizer = tokenizer.clone();
    raw_tokenizer.with_padding(None);
    raw_tokenizer.with_truncation(None).ok();

    let handle = TokenizerHandle {
        tokenizer,
        raw_tokenizer,
    };
    Box::into_raw(Box::new(handle)) as *mut std::ffi::c_void
}

//è®¡ç®å¥å­token
#[unsafe(no_mangle)] // ç¦ç¨ name manglingï¼è®© C è½æ¾å°ç¬¦å·
pub extern "C" fn tokenizer_count(handle: *mut std::ffi::c_void, text: *const c_char) -&gt; u64 {
    if handle.is_null() || text.is_null() {
        return 0;
    }

    let handle_ref = unsafe { &amp;*(handle as *mut TokenizerHandle) };

    let text_cstr = unsafe { CStr::from_ptr(text) };
    let text_str = match text_cstr.to_str() {
        Ok(s) =&gt; s,
        Err(_) =&gt; return 0,
    };

    match handle_ref.raw_tokenizer.encode(text_str, true) {
        Ok(encoding) =&gt; encoding.len() as u64,
        Err(_) =&gt; 0,
    }
}

// === 5. éæ¯ tokenizer ===
#[unsafe(no_mangle)]
pub extern "C" fn tokenizer_destroy(handle: *mut std::ffi::c_void) {
    if !handle.is_null() {
        unsafe {
            let _ = Box::from_raw(handle as *mut TokenizerHandle);
            // Drop èªå¨è°ç¨
        }
    }
}

// === 6. æ§è¡åè¯ ===
#[unsafe(no_mangle)]
pub extern "C" fn tokenizer_encode(
    handle: *mut std::ffi::c_void,
    text: *const c_char,
) -&gt; TokenizerResult {
    let default_result = TokenizerResult {
        input_ids: std::ptr::null_mut(),
        attention_mask: std::ptr::null_mut(),
        token_type_ids: std::ptr::null_mut(),
        length: 0,
    };

    if handle.is_null() || text.is_null() {
        return default_result;
    }

    let handle_ref = unsafe { &amp;*(handle as *mut TokenizerHandle) };

    let text_cstr = unsafe { CStr::from_ptr(text) };
    let text_str = match text_cstr.to_str() {
        Ok(s) =&gt; s,
        Err(_) =&gt; return default_result,
    };

    let encoding = match handle_ref.tokenizer.encode(text_str, true) {
        Ok(e) =&gt; e,
        Err(_) =&gt; return default_result,
    };

    let input_ids: Vec&lt;i64&gt; = encoding.get_ids().iter().map(|&amp;x| x as i64).collect();
    let attention_mask: Vec&lt;i64&gt; = encoding
        .get_attention_mask()
        .iter()
        .map(|&amp;x| x as i64)
        .collect();
    let token_type_ids: Vec&lt;i64&gt; = encoding.get_type_ids().iter().map(|&amp;x| x as i64).collect();
    // BGE ä¸éè¦ï¼ä½ C++ ä»£ç ä¼ äº
    // let token_type_ids: Vec&lt;u32&gt; = vec![0u32; input_ids.len()];

    let len = input_ids.len(); // åºè¯¥æ¯ 512ï¼ä½æ´éç¨

    TokenizerResult {
        input_ids: vec_to_c_ptr(input_ids),
        attention_mask: vec_to_c_ptr(attention_mask),
        token_type_ids: vec_to_c_ptr(token_type_ids),
        length: len as u64,
    }
}

// === 7. éæ¾ç»æåå­ ===
#[unsafe(no_mangle)]
pub extern "C" fn tokenizer_result_free(result: TokenizerResult) {
    if !result.input_ids.is_null() {
        unsafe {
            let _ = Vec::from_raw_parts(
                result.input_ids,
                result.length as usize,
                result.length as usize,
            );
        }
    }

    if !result.attention_mask.is_null() {
        unsafe {
            let _ = Vec::from_raw_parts(
                result.attention_mask,
                result.length as usize,
                result.length as usize,
            );
        }
    }

    if !result.token_type_ids.is_null() {
        unsafe {
            let _ = Vec::from_raw_parts(
                result.token_type_ids,
                result.length as usize,
                result.length as usize,
            );
        }
    }
}
</code></pre>
<p>å¯¹åºç C æ¥å£å¦ä¸ï¼</p>
<pre><code class="language-c">// tokenizer_result.h
#pragma once

struct TokenizerResult {
  int64_t* input_ids;
  int64_t* attention_mask;
  int64_t* token_type_ids;
  uint64_t length;
};

#ifdef __cplusplus
static_assert(std::is_standard_layout_v&lt;TokenizerResult&gt; &amp;&amp;
                  std::is_trivially_copyable_v&lt;TokenizerResult&gt;,
              "TokenizerResult must be C ABI compatible");
#endif
</code></pre>
<pre><code class="language-c">// hf_tokenizer_ffi.h
#pragma once

#include &lt;stdint.h&gt;

#include "tokenizer_result.h"

#ifdef __cplusplus
extern "C" {
#endif

void* tokenizer_create(const char* tokenizer_json_path);
void tokenizer_destroy(void* handle);
TokenizerResult tokenizer_encode(void* handle, const char* text);
uint64_t tokenizer_count(void* handle, const char* text);
void tokenizer_result_free(TokenizerResult result);

#ifdef __cplusplus
}
#endif
</code></pre>
<p>å·ä½çå°è£ç»èç¬èå°±ä¸å¤è¯´äºï¼å ä¸ºä¸æ¬æçä¸»é¢æ å³ãä¸è¿å¯ä»¥ç¨ç¨äºè§£ä¸ä¸å¶ä¸­çåçï¼ä¹å°±æ¯è¯´ï¼æä½ç³»ç»å¤§å¤æ°æ¯ç± C å®ç°çï¼æèæä¾äº C çæ¥å£ãå æ­¤ï¼ç»å¤§å¤æ°æ¯ C é«çº§çç¼ç¨è¯­è¨é½æä¾äºä¸ C äº¤äºçè½åï¼å½ç¶åææ¯å¿é¡»å¾æç§ C å¾è§èç»ç»æ°æ®åå°è£æ¥å£ãæ¯å¦è¿éç<code>struct TokenizerResult</code>å°±æ¯ä¸ä¸ªå¼å®¹ C çç»æä½ï¼<code>#[unsafe(no_mangle)]</code>åè¡¨æè¿æ¯ä¸ä¸ª C è¯­è¨å½¢å¼çå½æ°æ¥å£ã</p>
<h1 id="3-ç»å¸-c-å°è£">3. ç»å¸ C++ å°è£</h1>
<p>å¦ä¸æ¥å£æ¯ä¸ä¸ªæ åç C é£æ ¼å¼çæ¥å£ï¼å°åè¯å¨å°è£æä¸ä¸ª Handle ï¼ä¹å°±æ¯ä¿ç§°çå¥æãèåç»­å·ä½çåè¯æä½å°±éè¿è¿ä¸ªå¥ææ¥è¿è¡ï¼åæ¬æåå¯¹èµæºçéæ¾ãå¨ C++ ä¸­ï¼å½ç¶ä¹å¯ä»¥ç´æ¥ä½¿ç¨è¿ç§å½¢å¼çæ¥å£ï¼ä¸è¿è¿æ ·å°±éè¦éµå¾ª C çèµæºæ§å¶è§åï¼èµæºç³è¯·åéæ¾å¿é¡»æå¯¹åºç°ââæ¯å¦è¿éç <code>tokenizer_create</code> å <code>tokenizer_destroy</code>ã</p>
<h2 id="31-raii-æºå¶">3.1 RAII æºå¶</h2>
<p>ä¸è¿è¿æ ·å°±ä¼æä¸ä¸ªé®é¢ï¼è¿ç¨å¼çæµç¨ä¸­å¾é¾ä¿è¯ <code>tokenizer_create</code> å <code>tokenizer_destroy</code> è½å¤æå¯¹è°ç¨ï¼ä¾å¦ï¼</p>
<pre><code class="language-c">tokenizer_create()

if(...){
    return;
}

tokenizer_destroy()
</code></pre>
<p>åªè¦å¨ <code>tokenizer_create</code> å <code>tokenizer_destroy</code> ä¹é´åºç°åæ¯ï¼ç¨åºæåè¿åï¼å°±ä¼å¯¼è´èµæºæ²¡æéæ¾èåå­æ³æ¼ãä¸ºäºé¿åè¿ä¸ªé®é¢ï¼å°±éè¦å¨æ¯æ¬¡ <code>return</code> ä¹åï¼é½è°ç¨ <code>tokenizer_destroy()</code>ââè¿å½ç¶æ¯éå¸¸ä¸ä¼éçï¼æ¢å®¹æå¿æåæ¯åä½ä»£ç ã</p>
<p>ä¸ºäºè§£å³è¿ç§èµæºç®¡çé¾é¢ï¼C++ æä¾äºä¸ç§å¼ºå¤§èä¼éçæºå¶ï¼RAIIï¼Resource Acquisition Is Initializationï¼èµæºè·åå³åå§åï¼ãå®çæ ¸å¿ææ³æ¯ï¼å°èµæºççå½å¨æç»å®å°å¯¹è±¡ççå½å¨æä¸ãå·ä½æ¥è¯´ï¼å°±æ¯å©ç¨é¢åå¯¹è±¡çææ³ï¼å°èµæºæ§å¶çè¡ä¸ºå°è£æä¸ä¸ªç±»å¯¹è±¡ï¼å¹¶ä¸ä¿è¯èµæºå¨å¯¹è±¡æé å½æ°ä¸­è·åï¼å¨ææå½æ°ä¸­èªå¨éæ¾ãç±äº C++ ä¸­æ å¯¹è±¡å¨ç¦»å¼ä½ç¨åæ¶ä¼èªå¨è°ç¨ææå½æ°ï¼å¨ç¦»å¼ä½ç¨åæ¶ä¼èªå¨è°ç¨ææå½æ°ãå æ­¤è¿äºèµæºæ»æ¯å¯ä»¥è¢«æ­£ç¡®éæ¾ï¼ä»æ ¹æ¬ä¸æç»åå­æ³æ¼æèµæºæ³é²ãä¾å¦ï¼</p>
<pre><code class="language-cpp">Tokenizer tokenizer;

//...æä½

if(...){
    return;
}

//...æ´å¤æä½
</code></pre>
<h2 id="32-æ·è´è¯­ä¹">3.2 æ·è´è¯­ä¹</h2>
<p>å¤ä¹ ä¸ä¸ C++ é¢åå¯¹è±¡è®¾è®¡çç»å¸äºæ³åï¼Rule of Fiveï¼ï¼å¦æä¸ä¸ªç±»èªå®ä¹äºä»¥ä¸ä»»æä¸ä¸ªå½æ°ï¼</p>
<ol>
<li>ææå½æ°ï¼Destructorï¼</li>
<li>æ·è´æé å½æ°ï¼Copy Constructorï¼</li>
<li>æ·è´èµå¼è¿ç®ç¬¦ï¼Copy Assignment Operatorï¼</li>
<li>ç§»å¨æé å½æ°ï¼Move Constructorï¼</li>
<li>ç§»å¨èµå¼è¿ç®ç¬¦ï¼Move Assignment Operatorï¼</li>
</ol>
<p>é£ä¹å¤§æ¦çä¹éè¦èªå®ä¹å¦å¤åä¸ªå½æ°ï¼æèæ¾å¼ = default / = delete æ¥æ§å¶è¡ä¸ºãå¾å¤ C++ ç¨åºåå¹¶ä¸çè§£ç§»å¨è¯­ä¹ï¼ä½è¿å¹¶æ²¡æå³ç³»ï¼æä»¬å¯ä»¥ååå®ä¸å®ä¹ç§»å¨æé å½æ°åç§»å¨èµå¼è¿ç®ç¬¦ï¼æèæ¾å¼ = defaultï¼ï¼æ­¤æ¶ç§»å¨æä½å°±ä¼éåä¸ºæ·è´è¯­ä¹çè¡ä¸ºã</p>
<p>èå³äºæ·è´è¯­ä¹ï¼ç»å¤§å¤æ° C++ ç¨åºååºè¯¥é½ç¥éè¿ä¸ªé®é¢ï¼å½å¨ç±»å¯¹è±¡ä¸­ç®¡çèµæºæ¶ï¼ç¼è¯å¨çæçé»è®¤æ·è´è¡ä¸ºæ¯âæµæ·è´âï¼å¯è½å¯¼è´åééæ¾ãåå­æ³æ¼ç­é®é¢ï¼å æ­¤éè¦èªå®ä¹æ·è´æé å½æ°åæ·è´èµå¼è¿ç®ç¬¦æ¥å®ç°âæ·±æ·è´âçè¡ä¸ºãå æ­¤ï¼è¿ä¸ªé¾æ¡å°±å¾æç¡®äºï¼å ä¸ºç±»ä¸­éè¦å®ä¹ææå½æ°ï¼æä»¥éè¦åæ¶å®ä¹æ·è´æé å½æ°åæ·è´èµå¼è¿ç®ç¬¦ã</p>
<h2 id="33-ç§»å¨è¯­ä¹">3.3 ç§»å¨è¯­ä¹</h2>
<p>è¿ä¸æ­¥è®¨è®ºï¼åæ­£ç§»å¨è¯­ä¹å¯ä»¥é»è®¤ï¼é£ä¹æ¯ä¸æ¯åªç¨å®ä¹æ·è´è¯­ä¹å°±è¡äºå¢ï¼è¿ä¸ªè¦çèµæºçå®ä¹ï¼å¦æåªæ¯ç®¡çåå­èµæºï¼é£ä¹è¿æ ·åæ¯æ²¡æé®é¢çï¼è³å°æ¯å®å¨çãä½æ¯èµæºç®¡çä¸ä»ä»æçæ¯åå­èµæºï¼è¿å¯ä»¥æ¯ä¸äºæä»¶å¥æãç½ç»è¿æ¥ç­ç­ãè¿äºèµæºå¾å¾æ¯ç¬å æ§çï¼è¿è¡æ·±æ·è´å¾å¾ä¼åºç°é®é¢ãå æ­¤å°±åºç°äº C++ 11 å¼å§è§å®çç§»å¨è¯­ä¹ï¼å¯ä»¥å®å¨å¾å®ç°âæµæ·è´âçè¡ä¸ºãåæ¶è¿å¯ä»¥è§£å³âæ·±æ·è´âçæ§è½é®é¢ã</p>
<p>åºäºä»¥ä¸çææ³ï¼ç¬èå°è£çåè¯å¨å¯¹è±¡å¦ä¸ï¼</p>
<pre><code class="language-cpp">// HfTokenizer.h
#pragma once

#include &lt;string&gt;

#include "hf_tokenizer_ffi.h"

namespace hf {
class Tokenizer {
 public:
  explicit Tokenizer(const std::string&amp; path);

  // ææå½æ°
  ~Tokenizer() noexcept;

  // ç¦æ­¢æ·è´
  Tokenizer(const Tokenizer&amp;) = delete;
  Tokenizer&amp; operator=(const Tokenizer&amp;) = delete;

  // ç§»å¨è¯­ä¹
  Tokenizer(Tokenizer&amp;&amp; rhs) noexcept;
  Tokenizer&amp; operator=(Tokenizer&amp;&amp; rhs) noexcept;

  // å¶ä»æ¥å£æ¹æ³
  // TokenizerResult Encode(const char* text) const;
  // uint64_t Count(const char* text) const;

 private:
  void* handle;  // æ¥èª tokenizer_create çæé
};

}  // namespace hf
</code></pre>
<pre><code class="language-cpp">// HfTokenizer.cpp
#include "HfTokenizer.h"

#include &lt;iostream&gt;

namespace hf {
Tokenizer::Tokenizer(const std::string&amp; path)
    : handle(tokenizer_create(path.c_str())) {
  if (!handle) {
    throw std::runtime_error("Failed to create tokenizer from " + path);
  }
}

Tokenizer::~Tokenizer() noexcept {
  if (handle) {
    tokenizer_destroy(handle);
  }
}

// ç§»å¨è¯­ä¹
Tokenizer::Tokenizer(Tokenizer&amp;&amp; rhs) noexcept : handle(rhs.handle) {
  rhs.handle = nullptr;
}

Tokenizer&amp; Tokenizer::operator=(Tokenizer&amp;&amp; rhs) noexcept {
  if (this != &amp;rhs) {
    if (handle) {
      tokenizer_destroy(handle);
    }
    handle = rhs.handle;
    rhs.handle = nullptr;
  }
  return *this;
}

}  // namespace hf
</code></pre>
<p>å¦åæè¿°ï¼å ä¸ºå°è£çæ¯ä¸ä¸ªå¥æï¼ä¸ºäºé¿åèµæºæ§å¶çéº»ç¦ï¼å°±ç¦æ­¢ææ·è´è¯­ä¹ï¼</p>
<pre><code class="language-cpp">// ç¦æ­¢æ·è´
Tokenizer(const Tokenizer&amp;) = delete;
Tokenizer&amp; operator=(const Tokenizer&amp;) = delete;
</code></pre>
<p>è¿è¡<code>()</code>æ·è´æé æè<code>=</code>èµå¼æé çèµ·æ¥ä¼¼ä¹å¾ç®åï¼å¶å®å¨ä»£ç å±å±åµå¥ä¹åï¼å°±å¯è½å¾é¾åæåºæ¯ä¸æ¯è°ç¨äºé»è®¤çæ·è´çè¡ä¸ºï¼æ¯å¦å½æ°ä¼ åãå®¹å¨æä½ç­ç­ãå½ç¶æ·±æ·è´çå®ç°ä¹ä¸æ¯æ§è½æä¼ï¼å æ­¤å¹²èå°±ç´æ¥å é¤ææ·è´æé å½æ°åæ·è´èµå¼è¿ç®ç¬¦ã</p>
<p>æ²¡ææ·è´è¯­ä¹ï¼é£ä¹å°±éè¦ç§»å¨è¯­ä¹æ¥è¿è¡ä¼ éå¯¹è±¡äºãå¶å®ç§»å¨è¯­ä¹æ²¡é£ä¹é¾ï¼æä»¬åªè¦ææ¡ä½ä¸ç¹ï¼ç§»å¨è¯­ä¹çç®çæ¯å®å¨å°å®ç°âæµæ·è´âãä»¥ç§»å¨èµå¼è¿ç®ç¬¦çå®ç°æ¥è¯´ï¼å¦æè¦å®ç°å¦ä¸ç§»å¨èµå¼ï¼</p>
<pre><code class="language-cpp">Tokenizer A();
Tokenizer B();
B = std::move(A);
</code></pre>
<p>å°±éè¦ä»¥ä¸çè¡ä¸ºï¼</p>
<ol>
<li>éæ¾æBç®¡ççèµæºã</li>
<li>å°Aä¸­çæåâæµæ·è´âå°Bä¸­ï¼è®©Bæ¥ç®¡Açèµæºã</li>
<li>å°Aä¸­æååå§åã</li>
</ol>
<p>å·ä½å®ç°å°±æ¯å¦ä¸æç¤ºï¼</p>
<pre><code class="language-cpp">Tokenizer&amp; Tokenizer::operator=(Tokenizer&amp;&amp; rhs) noexcept {
  if (this != &amp;rhs) {
    if (handle) {
      tokenizer_destroy(handle);
    }
    handle = rhs.handle;
    rhs.handle = nullptr;
  }
  return *this;
}
</code></pre>
<p>ç§»å¨æé å½æ°å°±æ´å ç®åäºï¼å ä¸ºBå¯¹è±¡å¨ç§»å¨æé ä¹åæåå¹¶æ²¡æåå§åï¼</p>
<pre><code class="language-cpp">Tokenizer A();
Tokenizer B(std::move(A));
</code></pre>
<p>å æ­¤å¯ä»¥çç¥æéæ¾èªèº«èµæºçæ­¥éª¤ï¼å·ä½å®ç°ä¹å°±æ¯å¦ä¸æç¤ºï¼</p>
<pre><code class="language-cpp">Tokenizer::Tokenizer(Tokenizer&amp;&amp; rhs) noexcept : handle(rhs.handle) {
  rhs.handle = nullptr;
}
</code></pre>
<p>æåè¿æä¸ä¸ªé®é¢ï¼Aéè¿ç§»å¨è¯­ä¹è½¬ç§»å°Bäºï¼Aè¿è½ä½¿ç¨åï¼ä¸è½ä¹æ²¡å¿è¦ä½¿ç¨Aäºï¼æ è®ºæ¯Aå¯¹è±¡åBå¯¹è±¡å¶å®æ¯ä¸ä¸ªæ å¯¹è±¡ï¼å½ç¶åé¨ç®¡ççæ°æ®æåå¯è½æ¾å¨å ä¸ï¼ï¼æèè¯´æ¯ä¸ä¸ªå¼å¯¹è±¡ï¼è¿è·å¼ç¨å¯¹è±¡æèå°åå¯¹è±¡å®å¨ä¸åãç§»å¨è¯­ä¹çæ¬è´¨æ¯å¯¹è±¡æææçè½¬ç§»ï¼è½¬ç§»ä¹ååå¯¹è±¡ä¸­èµæºæææå°±ä¸å­å¨äºï¼å³ä½¿å¼ºè¡è®¿é®ï¼è¦ä¹è®¿é®ä¸å°ï¼è¦ä¹ä¼ç¨åºå´©æºã</p>
<h1 id="4-é«çº§-c-å°è£">4. é«çº§ C++ å°è£</h1>
<h2 id="41-é¶æ³å">4.1 é¶æ³å</h2>
<p>ä½¿ç¨ RAII æºå¶ + ç»å¸äºæ³åæ¥è®¾è®¡ä¸ä¸ªç±»å¯¹è±¡ï¼è¿æä¸ä¸ªä¼ç¹ï¼å°±æ¯ä½¿ç¨è¿ä¸ªç±»å¯¹è±¡ä½ä¸ºæ°æ®æåçç±»ï¼å°±ä¸ç¨åæ¾å¼å®ç°ææå½æ°ãä¸ç¨æ¾å¼å®ç°ææå½æ°ï¼ä¹å°±æå³çä¸ç¨å®ç°æ·è´è¯­ä¹åç§»å¨è¯­ä¹ï¼å®å¨å¯ä»¥ä¾èµç±»å¯¹è±¡æ·è´åç§»å¨çé»è®¤è¡ä¸ºãä¸¾ä¾æ¥è¯´ï¼ä¸ä¸ª<code>MyResource</code>å¯¹è±¡ï¼ç®¡ççä¸æ®µåå­ buffer ï¼å®çç±»å®ä¹ä¸ºï¼</p>
<pre><code class="language-cpp">class MyResource {
public:
    // æé ï¼ç³è¯·èµæº
    MyResource() {
        data = new int[100];
    }

    // ææï¼éæ¾èµæº
    ~MyResource() {
        delete[] data;
    }

    // æ·è´æé ï¼æ·±æ·è´
    MyResource(const MyResource&amp; other) {
        data = new int[100];
        copy(other.data, other.data + 100, data);
    }

    // æ·è´èµå¼
    MyResource&amp; operator=(const MyResource&amp; other) {
        if (this != &amp;other) {
            delete[] data;
            data = new int[100];
            copy(other.data, other.data + 100, data);
        }
        return *this;
    }

    // ç§»å¨æé ï¼æ¥ç®¡èµæº
    MyResource(MyResource&amp;&amp; other) noexcept {
        data = other.data;
        other.data = nullptr;
    }

    // ç§»å¨èµå¼
    MyResource&amp; operator=(MyResource&amp;&amp; other) noexcept {
        if (this != &amp;other) {
            delete[] data;
            data = other.data;
            other.data = nullptr;
        }
        return *this;
    }

private:
    int* data = nullptr;
};
</code></pre>
<p>ä½æ¯å¦ææä½¿ç¨ std å®¹å¨<code>vector</code> ï¼ç¸åºçä»£ç å°±å¯ä»¥ç®åä¸ºï¼</p>
<pre><code class="language-cpp">#include &lt;vector&gt;

class MyResource {
public:
    // æé ï¼èªå¨åéåå­
    MyResource() : data(100) {}  // vector&lt;int&gt; èªå¨åå§åä¸º 100 ä¸ªåç´ 

    // â æ éæ¾å¼å®ä¹ææå½æ°
    // â æ éèªå®ä¹æ·è´æé  / æ·è´èµå¼
    // â æ éèªå®ä¹ç§»å¨æé  / ç§»å¨èµå¼

    // ç¼è¯å¨èªå¨çæççæ¬å·²æ­£ç¡®ãé«æãå¼å¸¸å®å¨

private:
    std::vector&lt;int&gt; data;  // RAII èªå¨ç®¡çåå­
};
</code></pre>
<p>è¿ä¸æ¯å ä¸º <code>vector</code> ä½¿ç¨äºä»ä¹é­æ³ï¼èæ¯ <code>vector</code> æ¬èº«å°±æ¯ä½¿ç¨äº RAII æºå¶ + ç»å¸äºæ³åæ¥è®¾è®¡çä¸ä¸ªæ¨¡æ¿ç±»å¯¹è±¡ï¼å¨ <code>MyResource</code> å¯¹è±¡è¿è¡æ·è´æèç§»å¨çæ¶åï¼ä½ä¸ºæ°æ®æåï¼<code>std::vector&lt;int&gt; data</code>ä¹ä¼éååæ ·çæ·è´æèç§»å¨çè¡ä¸ºï¼å¹¶ä¸é»è®¤çãç±ç¼è¯å¨èªå¨çæççæ¬å°±å¯ä»¥æ­£ç¡®å¤çã</p>
<p>ä»¥ä¸è¿ä¸ªææ³ï¼å°±æ¯ç°ä»£ C++ æ´æ¨èç<strong>é¶æ³åï¼Rule of Zeroï¼</strong>ï¼å°½éä¸è¦æå¨ç®¡çèµæºï¼èæ¯ä½¿ç¨ RAII ç±»åè®©ç¼è¯å¨èªå¨çæææç¹æ®æåå½æ°ãèè¿ä¸ª RAII ç±»åï¼å¯ä»¥æ¯ std çä»»ä½å®¹å¨å¯¹è±¡ãæºè½æéï¼ä¹å¯ä»¥æ¯èªå·±æç§äºæ³åå®ç°çç±»å¯¹è±¡ã</p>
<h2 id="42-æºè½æé">4.2 æºè½æé</h2>
<p>åå°æ¬æå¼å¥çé®é¢ï¼å¦ææçåè¯å¨å®ç°ä¸ååæ·è´è¯­ä¹åç§»å¨è¯­ä¹æä¹åå¢ï¼æ¯ç«é½æ¯æ ·æ¿ä»£ç ï¼åä¸å¥½è¿å®¹æåºé®é¢ãæ­¤æ¶æä»¬å°±å¯ä»¥ä½¿ç¨æºè½æé <code>unique_ptr</code> ãå¸¸è§æä¹ä¸ï¼æä»¬é½ç¥éæºè½æéå¯ä»¥å¨æ²¡æä»»ä½å¶ä»å¯¹è±¡å¼ç¨çæåµä¸èªå¨ <code>delete</code> ï¼å¶å®æºè½æéè¿å¯ä»¥èªå®ä¹èµæºçéæ¾è¡ä¸ºï¼</p>
<pre><code class="language-cpp">#pragma once

#include &lt;memory&gt;
#include &lt;string&gt;

namespace hf {
class Tokenizer {
 public:
  explicit Tokenizer(const std::string&amp; path);

  // ç¼è¯å¨èªå¨çæï¼
  // - ææå½æ°
  // - ç§»å¨æé  / ç§»å¨èµå¼
  // - ç¦æ­¢æ·è´ï¼å ä¸º unique_ptr ä¸å¯æ·è´ï¼

 private:
  std::unique_ptr&lt;void, void (*)(void*)&gt; handle;
};

}  // namespace hf
</code></pre>
<pre><code class="language-cpp">#include "HfTokenizer.h"

#include &lt;stdexcept&gt;

#include "hf_tokenizer_ffi.h"

namespace hf {

static void HandleDeleter(void* handle) noexcept {
  if (handle) {
    tokenizer_destroy(handle);
  }
}

Tokenizer::Tokenizer(const std::string&amp; path)
    : handle(tokenizer_create(path.c_str()), HandleDeleter) {
  if (!handle) {
    throw std::runtime_error("Failed to create tokenizer from " + path);
  }
}

}  // namespace hf
</code></pre>
<p>å¦ä¸å®ç°æç¤ºï¼å½æ° <code>HandleDeleter</code> å°±æ¯ <code>std::unique_ptr&lt;void, void (*)(void*)&gt; handle</code> çèªå®ä¹ææè¡ä¸ºï¼å¨ç±»å¯¹è±¡ææçæ¶åå°±ä¼èªå¨è°ç¨è¿ä¸ªå½æ°éæ¾èµæºãæ¢ç¶èµæºè¢«æºè½æç®¡äºï¼é£ä¹èªç¶å°±ä¸ç¨åææå½æ°ï¼ææå½æ°ä¸ç¨åï¼é£ä¹æ·è´æé å½æ°ãæ·è´èµå¼è¿ç®ç¬¦ãç§»å¨æé å½æ°ä»¥åç§»å¨èµå¼è¿ç®ç¬¦é½å¯ä»¥ä¸ç¨å®ç°ï¼å¨é¨å¯ä»¥ä¾èµç¼è¯å¨èªå¨çæãå½ç¶ï¼ç±äº <code>unique_ptr</code> åªè½ç§»å¨ä¸è½æ·è´ï¼<code>Tokenizer</code>ä¹å°±åªè½ç§»å¨ä¸è½æ·è´ã</p>
<h1 id="5-æ»ç»">5. æ»ç»</h1>
<p>æåï¼ç¬èå°±ç»åº C++ å°è£ C FFI æ¥å£çå®æ´å®ç°ï¼å¦ä¸æç¤ºï¼</p>
<pre><code class="language-cpp">// HfTokenizer.h
#pragma once

#include &lt;memory&gt;
#include &lt;string&gt;

#include "tokenizer_result.h"

namespace hf {
class Tokenizer {
 public:
  explicit Tokenizer(const std::string&amp; path);

  // ç¼è¯å¨èªå¨çæï¼
  // - ææå½æ°ï¼è°ç¨ Deleterï¼
  // - ç§»å¨æé  / ç§»å¨èµå¼
  // - ç¦æ­¢æ·è´ï¼å ä¸º unique_ptr ä¸å¯æ·è´ï¼

  // å¶ä»æ¥å£æ¹æ³
  uint64_t Count(const std::string&amp; text) const;

  // åéå
  using ResultPtr =
      std::unique_ptr&lt;TokenizerResult, void (*)(TokenizerResult*)&gt;;
  ResultPtr Encode(const std::string&amp; text) const;

 private:
  std::unique_ptr&lt;void, void (*)(void*)&gt; handle;
};

}  // namespace hf
</code></pre>
<pre><code class="language-cpp">// HfTokenizer.cpp
#include "HfTokenizer.h"

#include &lt;stdexcept&gt;

#include "hf_tokenizer_ffi.h"

namespace hf {

static void HandleDeleter(void* handle) noexcept {
  if (handle) {
    tokenizer_destroy(handle);
  }
}

static void ResultDeleter(TokenizerResult* p) noexcept {
  if (p) {
    tokenizer_result_free(*p);
    delete p;
  }
}

Tokenizer::Tokenizer(const std::string&amp; path)
    : handle(tokenizer_create(path.c_str()), HandleDeleter) {
  if (!handle) {
    throw std::runtime_error("Failed to create tokenizer from " + path);
  }
}

uint64_t Tokenizer::Count(const std::string&amp; text) const {
  return tokenizer_count(handle.get(), text.c_str());
}

Tokenizer::ResultPtr Tokenizer::Encode(const std::string&amp; text) const {
  auto result = std::make_unique&lt;TokenizerResult&gt;(
      tokenizer_encode(handle.get(), text.c_str()));
  return {result.release(), ResultDeleter};
};

}  // namespace hf
</code></pre>
<p>ä¸ä»æ¯å¥æï¼è¿ä¼ éçæ°æ®å¯¹è±¡ç¬èé½æç®¡ç»æºè½æéï¼ä»èé¿åå¤§éåç¹æ®æåå½æ°è¿äºæ ·æ¿ä»£ç ãä¸å¾ä¸è¯´ï¼RAII çè®¾è®¡æè·¯éå¸¸ç²¾å¦ï¼åæ¶ä¿è¯äºå®å¨æ§ä¸ç®æ´æ§ï¼ç»äººä¸ç§åå½ç¼ç¨åå§ç¶æçæè§ãæè°âå¤§éè³ç®âï¼ä¸æ¯ä»£ç è¶ç¹å¤å°±è¶å®å¨ï¼ä¹ä¸æ¯ä»£ç è¶æ½è±¡å°±è¶åå®³ï¼çæ­£å¥½çä»£ç ï¼æ¯å¨æ­£ç¡®æ§ãå¯ç»´æ¤æ§ä¸ç®æ´æ§ä¹é´åå¾å¹³è¡¡ï¼è®©èµæºç®¡çå¦å¼å¸è¬èªç¶ï¼èéè´æã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-31 13:37">2026-01-31 13:36</span>&nbsp;
<a href="https://www.cnblogs.com/charlee44">charlee44</a>&nbsp;
éè¯»(<span id="post_view_count">31</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19557586);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19557586', targetLink: 'https://www.cnblogs.com/charlee44/p/19557586', title: 'C++ å°è£ C FFI æ¥å£æä½³å®è·µï¼ä»¥ Hugging Face Tokenizer ä¸ºä¾' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸å¤©ä¸ä¸ªPythonåºï¼markupsafe - è®©ä½ çå­ç¬¦ä¸²å®å¨åä¼é ]]></title>
    <link>https://www.cnblogs.com/min2k/p/19557576</link>
    <guid>b5d8d6dffd7117a832883be25718ef4f</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/min2k/p/19557576" title="åå¸äº 2026-01-31 13:31">
    <span role="heading" aria-level="2">ä¸å¤©ä¸ä¸ªPythonåºï¼markupsafe - è®©ä½ çå­ç¬¦ä¸²å®å¨åä¼é</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="markupsafe---è®©ä½ çå­ç¬¦ä¸²å®å¨åä¼é">markupsafe - è®©ä½ çå­ç¬¦ä¸²å®å¨åä¼é</h1>
<h2 id="ä¸ä»ä¹æ¯markupsafe">ä¸ãä»ä¹æ¯markupsafeï¼</h2>
<p><strong>markupsafe</strong> æ¯ä¸ä¸ªç¨äºå¤çæ è®°è¯­è¨ï¼å¦HTMLãXMLï¼å­ç¬¦ä¸²ç Python åºã<br>
å®å¯ä»¥å¸®å©ä½ ï¼</p>
<ul>
<li><strong>å®å¨å°è½¬ä¹å­ç¬¦ä¸²</strong>ï¼é²æ­¢è·¨ç«èæ¬ï¼XSSï¼æ»å»ï¼ç¹å«æ¯å½ä½ éè¦å°ç¨æ·è¾å¥æ¾ç¤ºå¨ç½é¡µä¸æ¶ã</li>
<li><strong>æ è®°å®å¨å­ç¬¦ä¸²</strong>ï¼å°ç»è¿è½¬ä¹æä¿¡ä»»çå­ç¬¦ä¸²æ è®°ä¸ºâå®å¨âï¼é¿åéå¤è½¬ä¹ï¼æé«æçã</li>
<li><strong>æ¨¡æ¿å¼æéæ</strong>ï¼å¨åJinja2è¿æ ·çæ¨¡æ¿å¼æä¸­ï¼markupsafeæ®æ¼äºæ ¸å¿è§è²ï¼ç¡®ä¿æ¸²æçHTMLåå®¹æ¯å®å¨çã</li>
</ul>
<h2 id="äºåºç¨åºæ¯">äºãåºç¨åºæ¯</h2>
<p><strong>markupsafe</strong> å¹¿æ³åºç¨äºä»¥ä¸å®éåºæ¯ï¼</p>
<ul>
<li><strong>Webå¼åæ¡æ¶</strong>: å¨FlaskãJinja2ç­Webæ¡æ¶ä¸­ï¼ç¨äºèªå¨è½¬ä¹æ¨¡æ¿æ¸²æçè¾åºï¼é²æ­¢æ³¨å¥æ»å»ã</li>
<li><strong>ç¨æ·çæåå®¹</strong>: å½ä½ çç½ç«åè®¸ç¨æ·è¾å¥å¹¶æ¾ç¤ºåå®¹æ¶ï¼å¦è¯è®ºãè®ºåå¸å­ï¼ï¼markupsafeè½ç¡®ä¿è¿äºåå®¹å¨æ¾ç¤ºæ¶æ¯å®å¨çã</li>
<li><strong>æå»ºå¨æHTML/XML</strong>: å¨ç¨åºä¸­å¨æçæHTMLæXMLçæ®µæ¶ï¼éè¦ç¡®ä¿æææå¥çæ°æ®é½ç»è¿äºæ­£ç¡®çè½¬ä¹ã</li>
</ul>
<h2 id="ä¸å¦ä½å®è£">ä¸ãå¦ä½å®è£</h2>
<ol>
<li>ä½¿ç¨ pip å®è£</li>
</ol>
<pre><code class="language-bash">pip install markupsafe

# å¦æå®è£æ¢çè¯ï¼æ¨èä½¿ç¨å½åéåæº
pip install markupsafe -i https://www.python64.cn/pypi/simple/
</code></pre>
<ol start="2">
<li>ä½¿ç¨ <a href="https://www.min2k.com/tools/python-run/" target="_blank" rel="noopener nofollow">PythonRun</a> å¨çº¿è¿è¡ä»£ç ï¼æ éæ¬å°å®è£ï¼</li>
</ol>
<h2 id="åç¤ºä¾ä»£ç ">åãç¤ºä¾ä»£ç </h2>
<p>è½¬ä¹ç¨æ·è¾å¥ä»¥é²æ­¢XSSæ»å»</p>
<pre><code class="language-python">from markupsafe import escape, Markup

# ç¨æ·è¾å¥ï¼å¯è½åå«æ¶æèæ¬
user_input_raw = "&lt;script&gt;alert('æ¨è¢«æ»å»äºï¼')&lt;/script&gt;"
is_admin = True # åè®¾æä¸ä¸ªæ¡ä»¶å¤æ­ç¨æ·æ¯å¦æ¯ç®¡çå

# ä½¿ç¨escapeè½¬ä¹ç¨æ·è¾å¥
safe_output = escape(user_input_raw)

# æå°è½¬ä¹åçç»æ
print(f"è½¬ä¹åçåå®¹: {safe_output}")

# åè®¾æä¸äºä¿¡ä»»çHTMLåå®¹ï¼æä»¬ä¸å¸æå®è¢«è½¬ä¹
trusted_html = Markup("&lt;b&gt;è¿æ¯å ç²çææ¬&lt;/b&gt;")

# å¦ææ¯ç®¡çåï¼åç´æ¥æ¾ç¤ºåå§è¾å¥ï¼è¿éä»ä¸ºæ¼ç¤ºï¼å®éåºç¨éæå¶è°¨æï¼
if is_admin:
    print(f"ç®¡çåæ¾ç¤ºï¼å±é©ï¼ï¼ï¼{user_input_raw}")
else:
    # å¦åæ¾ç¤ºå®å¨çåå®¹
    print(f"æ®éç¨æ·æ¾ç¤ºï¼å®å¨ï¼ï¼ï¼{safe_output}")

# ç»åä½¿ç¨ï¼Markupæ è®°çåå®¹ä¸ä¼è¢«äºæ¬¡è½¬ä¹
formatted_output = Markup(f"&lt;p&gt;Hello, {safe_output}!&lt;/p&gt;")
print(f"ç»ååçå®å¨HTML: {formatted_output}")

# æ£æ¥æ¯å¦æ¯Markupå®ä¾
if isinstance(formatted_output, Markup):
    print("formatted_output æ¯ä¸ä¸ª Markup å®ä¾ï¼å·²è¢«æ è®°ä¸ºå®å¨ã")
else:
    print("formatted_output ä¸æ¯ Markup å®ä¾ã")
</code></pre>
<p>ä½¿ç¨ <a href="https://www.min2k.com/tools/python-run/?code=from%20markupsafe%20import%20escape%2C%20Markup%0A%0A%23%20%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%EF%BC%8C%E5%8F%AF%E8%83%BD%E5%8C%85%E5%90%AB%E6%81%B6%E6%84%8F%E8%84%9A%E6%9C%AC%0Auser_input_raw%20%3D%20%22%3Cscript%3Ealert%28'%E6%82%A8%E8%A2%AB%E6%94%BB%E5%87%BB%E4%BA%86%EF%BC%81'%29%3C%2Fscript%3E%22%0Ais_admin%20%3D%20True%20%23%20%E5%81%87%E8%AE%BE%E6%9C%89%E4%B8%80%E4%B8%AA%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E6%98%AF%E5%90%A6%E6%98%AF%E7%AE%A1%E7%90%86%E5%91%98%0A%0A%23%20%E4%BD%BF%E7%94%A8escape%E8%BD%AC%E4%B9%89%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%0Asafe_output%20%3D%20escape%28user_input_raw%29%0A%0A%23%20%E6%89%93%E5%8D%B0%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E7%BB%93%E6%9E%9C%0Aprint%28f%22%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9%3A%20%7Bsafe_output%7D%22%29%0A%0A%23%20%E5%81%87%E8%AE%BE%E6%9C%89%E4%B8%80%E4%BA%9B%E4%BF%A1%E4%BB%BB%E7%9A%84HTML%E5%86%85%E5%AE%B9%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%8D%E5%B8%8C%E6%9C%9B%E5%AE%83%E8%A2%AB%E8%BD%AC%E4%B9%89%0Atrusted_html%20%3D%20Markup%28%22%3Cb%3E%E8%BF%99%E6%98%AF%E5%8A%A0%E7%B2%97%E7%9A%84%E6%96%87%E6%9C%AC%3C%2Fb%3E%22%29%0A%0A%23%20%E5%A6%82%E6%9E%9C%E6%98%AF%E7%AE%A1%E7%90%86%E5%91%98%EF%BC%8C%E5%88%99%E7%9B%B4%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%8E%9F%E5%A7%8B%E8%BE%93%E5%85%A5%EF%BC%88%E8%BF%99%E9%87%8C%E4%BB%85%E4%B8%BA%E6%BC%94%E7%A4%BA%EF%BC%8C%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E9%9C%80%E6%9E%81%E5%85%B6%E8%B0%A8%E6%85%8E%EF%BC%89%0Aif%20is_admin%3A%0A%20%20%20%20print%28f%22%E7%AE%A1%E7%90%86%E5%91%98%E6%98%BE%E7%A4%BA%EF%BC%88%E5%8D%B1%E9%99%A9%EF%BC%81%EF%BC%89%EF%BC%9A%7Buser_input_raw%7D%22%29%0Aelse%3A%0A%20%20%20%20%23%20%E5%90%A6%E5%88%99%E6%98%BE%E7%A4%BA%E5%AE%89%E5%85%A8%E7%9A%84%E5%86%85%E5%AE%B9%0A%20%20%20%20print%28f%22%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E6%98%BE%E7%A4%BA%EF%BC%88%E5%AE%89%E5%85%A8%EF%BC%81%EF%BC%89%EF%BC%9A%7Bsafe_output%7D%22%29%0A%0A%23%20%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8%EF%BC%8CMarkup%E6%A0%87%E8%AE%B0%E7%9A%84%E5%86%85%E5%AE%B9%E4%B8%8D%E4%BC%9A%E8%A2%AB%E4%BA%8C%E6%AC%A1%E8%BD%AC%E4%B9%89%0Aformatted_output%20%3D%20Markup%28f%22%3Cp%3EHello%2C%20%7Bsafe_output%7D!%3C%2Fp%3E%22%29%0Aprint%28f%22%E7%BB%84%E5%90%88%E5%90%8E%E7%9A%84%E5%AE%89%E5%85%A8HTML%3A%20%7Bformatted_output%7D%22%29%0A%0A%23%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E6%98%AFMarkup%E5%AE%9E%E4%BE%8B%0Aif%20isinstance%28formatted_output%2C%20Markup%29%3A%0A%20%20%20%20print%28%22formatted_output%20%E6%98%AF%E4%B8%80%E4%B8%AA%20Markup%20%E5%AE%9E%E4%BE%8B%EF%BC%8C%E5%B7%B2%E8%A2%AB%E6%A0%87%E8%AE%B0%E4%B8%BA%E5%AE%89%E5%85%A8%E3%80%82%22%29%0Aelse%3A%0A%20%20%20%20print%28%22formatted_output%20%E4%B8%8D%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%E3%80%82%22%29" target="_blank" rel="noopener nofollow">PythonRun</a> å¨çº¿è¿è¡è¿æ®µä»£ç ï¼ç»æå¦ä¸ï¼</p>
<pre><code class="language-text">è½¬ä¹åçåå®¹: &amp;lt;script&amp;gt;alert(&amp;#39;æ¨è¢«æ»å»äºï¼&amp;#39;)&amp;lt;/script&amp;gt;
ç®¡çåæ¾ç¤ºï¼å±é©ï¼ï¼ï¼&lt;script&gt;alert('æ¨è¢«æ»å»äºï¼')&lt;/script&gt;
ç»ååçå®å¨HTML: &lt;p&gt;Hello, &amp;lt;script&amp;gt;alert(&amp;#39;æ¨è¢«æ»å»äºï¼&amp;#39;)&amp;lt;/script&amp;gt;!&lt;/p&gt;
formatted_output æ¯ä¸ä¸ª Markup å®ä¾ï¼å·²è¢«æ è®°ä¸ºå®å¨ã
</code></pre>
<p>ä½¿ç¨ <a href="https://www.min2k.com/tools/mermaid/?code=flowchart%20TB%0A%20%20A%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20B%7B%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E5%92%8C%E7%AE%A1%E7%90%86%E5%91%98%E7%8A%B6%E6%80%81%7D%3B%0A%20%20B%20--%3E%20C%5B%E4%BD%BF%E7%94%A8escape%E8%BD%AC%E4%B9%89%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%5D%3B%0A%20%20C%20--%3E%20D%5B%E6%89%93%E5%8D%B0%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9%5D%3B%0A%20%20D%20--%3E%20E%7B%E5%A6%82%E6%9E%9C%20isAdmin%20%E4%B8%BA%20True%3F%7D%3B%0A%20%20E%20--%20%E6%98%AF%20--%3E%20F%5B%E6%89%93%E5%8D%B0%E5%8E%9F%E5%A7%8B%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%20%28%E5%8D%B1%E9%99%A9%29%5D%3B%0A%20%20E%20--%20%E5%90%A6%20--%3E%20G%5B%E6%89%93%E5%8D%B0%E5%AE%89%E5%85%A8%E7%9A%84%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%5D%3B%0A%20%20F%20--%3E%20H%5B%E5%88%9B%E5%BB%BA%E5%AE%89%E5%85%A8%E7%9A%84%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20G%20--%3E%20H%3B%0A%20%20H%20--%3E%20I%5B%E6%89%93%E5%8D%B0%E7%BB%84%E5%90%88%E5%90%8E%E7%9A%84%E5%AE%89%E5%85%A8HTML%5D%3B%0A%20%20I%20--%3E%20J%7B%E6%A3%80%E6%9F%A5%20formatted_output%20%E6%98%AF%E5%90%A6%E4%B8%BA%20Markup%20%E5%AE%9E%E4%BE%8B%3F%7D%3B%0A%20%20J%20--%20%E6%98%AF%20--%3E%20K%5B%E6%89%93%E5%8D%B0%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20J%20--%20%E5%90%A6%20--%3E%20L%5B%E6%89%93%E5%8D%B0%E4%B8%8D%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20K%20--%3E%20M%5B%E7%BB%93%E6%9D%9F%5D%3B%0A%20%20L%20--%3E%20M%3B" target="_blank" rel="noopener nofollow">MermaidGo</a> ç»å¶ç¤ºä¾ä»£ç çæµç¨å¾ï¼ç»æå¦ä¸ï¼</p>
<p><img alt="MermerGoçmarkupsafeæµç¨å¾" loading="lazy" data-src="https://img2024.cnblogs.com/blog/70894/202601/70894-20260131132929581-1245770167.jpg" class="lazyload"></p>
<h2 id="äºå­¦ä¹ èµæº">äºãå­¦ä¹ èµæº</h2>
<ol>
<li>å¼æºé¡¹ç®ï¼<a href="https://github.com/pallets/markupsafe" target="_blank" rel="noopener nofollow">markupsafe</a></li>
<li>ä¸­æèªè¿°ï¼<a href="https://www.python64.cn/readme/markupsafe/" target="_blank" rel="noopener nofollow">REMDME</a></li>
<li>å¨çº¿è¿è¡ï¼<a href="https://www.min2k.com/tools/python-run/" target="_blank" rel="noopener nofollow">PythonRun</a></li>
</ol>
<blockquote>
<p>å¦æè¿ç¯æç« å¯¹ä½ æå¸®å©ï¼æ¬¢è¿ç¹èµãæ¶èãè½¬åï¼<br>
å­¦ä¹ è¿ç¨ä¸­æä»»ä½é®é¢ï¼æ¬¢è¿å¨è¯è®ºåºçè¨äº¤æµï½</p>
</blockquote>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-31 13:32">2026-01-31 13:31</span>&nbsp;
<a href="https://www.cnblogs.com/min2k">æç¼ç¨</a>&nbsp;
éè¯»(<span id="post_view_count">45</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19557576);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19557576', targetLink: 'https://www.cnblogs.com/min2k/p/19557576', title: 'ä¸å¤©ä¸ä¸ªPythonåºï¼markupsafe - è®©ä½ çå­ç¬¦ä¸²å®å¨åä¼é' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å¤§æ¨¡åæ¦åå¨æ¥ï¼2026/01/31ï¼ ]]></title>
    <link>https://www.cnblogs.com/xjk15082/p/19557561</link>
    <guid>56a79b999c964b4fcd7f2f4ef434ffbd</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xjk15082/p/19557561" title="åå¸äº 2026-01-31 13:26">
    <span role="heading" aria-level="2">å¤§æ¨¡åæ¦åå¨æ¥ï¼2026/01/31ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h3 id="1-æ¬å¨æ¦è§">1. æ¬å¨æ¦è§</h3>
<p>æ¬å¨å¤§æ¨¡åè¡ä¸è¿æ¥å¤é¡¹éè¦è¿å±ï¼ç¾åº¦æå¿5.0æ­£å¼åå¸ï¼éä¹åé®å¼æºQwen3-TTSè¯­é³æ¨¡åï¼Kimiåå¸å¹¶å¼æºK2.5æ¨¡åãæ¦åæ¹é¢ååå§çï¼MiMo V2 Flash (free)é­éæ­å´å¼ä¸è·ï¼DeepSeek V3.2å¼ºå¿è·åï¼ç¼ç¨é¢åç«äºæ ¼å±åçéå¤§ååï¼Grok Code Fast 1é¢åä¼å¿èç¼©ï¼æ°æ¨¡åKimi K2.5å¼ºå¿é¯å¥åäºã</p>
<h3 id="2-éç¹å³æ³¨äºä»¶">2. éç¹å³æ³¨äºä»¶</h3>
<ul>
<li>ç¾åº¦äº1.24æ¥æ­£å¼åå¸æå¿5.0ï¼æ­è½½2.4ä¸äº¿åæ°åçå¨æ¨¡ææ¶æï¼å¨40ä½é¡¹åºåæµè¯ä¸­é¢è·å½éç¬¬ä¸æ¢¯éï¼è¢«ç§°ä¸º"æå¼ºæç§ç"</li>
<li>éä¹åé®äº1.26å¼æºQwen3-TTSå¨ç³»åè¯­é³æ¨¡åï¼æ¯æ3ç§åéä¸é³è²åé ï¼å»¶è¿ä½è³97msï¼å¼æº1.7Bï¼æè´æ§è½ï¼å0.6Bï¼è½»éé«æï¼ä¸¤ä¸ªçæ¬ï¼æ»¡è¶³ä»äºç«¯å°è¾¹ç¼çå¤æ ·åé¨ç½²éæ±ï¼åæ¶Qwen3-Max-Thinkingä¸çº¿ï¼å¼å¥èªéåºå·¥å·è°ç¨ä¸æµè¯æ¶æ©å±ææ¯ä¸¤å¤§æ ¸å¿åæ°</li>
<li>DeepSeekäº1.27æ´æ°OCRæ¨¡åï¼DeepSeek-OCR 2éè¿å¼å¥DeepEncoder V2æ¶æï¼å®ç°è§è§ç¼ç ä»ãåºå®æ«æãåãè¯­ä¹æ¨çãçèå¼è½¬åï¼å°åæ¬åºäºCLIPçç¼ç å¨æ¿æ¢ä¸ºè½»éçº§è¯­è¨æ¨¡åï¼Qwen2-500Mï¼ï¼å¹¶å¼å¥å·æå ææ³¨æåæºå¶çãå ææµæ¥è¯¢ã</li>
<li>Kimiäº1.27åå¸å¹¶å¼æºK2.5æ¨¡åï¼è¯¥æ¨¡åä¸ºåçå¤æ¨¡ææ¶æè®¾è®¡ï¼æ¯ææé«256,000 tokensçæ åä¸ä¸æé¿åº¦ï¼æ¯æè§è§ä¸ææ¬è¾å¥ãæèä¸éæèæ¨¡å¼ãå¯¹è¯ä¸Agentä»»å¡ï¼å¹¶è¿ä¸æ­¥æåå¼æºæ¨¡åçä»£ç æ°´å¹³ï¼å°¤å¶å¨åç«¯å¼åé¢åè¡¨ç°çªåº</li>
<li>MiniMaxäº1.29åå¸MiniMax Music 2.5ï¼å¨ãæ®µè½çº§å¼ºæ§å¶ãä¸ãç©ççº§é«ä¿çãä¸¤å¤§ææ¯é¾é¢ä¸å®ç°çªç ´ï¼è¾ä»¥åè¯­ä¼ååä¸ä¸æ··é³ï¼è®©æ ¼è±ç¾çº§é³ä¹åä½æ éå½é³æ£å³å¯å®ç°</li>
</ul>
<h3 id="3-æ¦ååå">3. æ¦ååå</h3>
<ul>
<li>OpenRouteræ´ä½æ¨¡åè°ç¨éæ¹é¢ï¼MiMo V2 Flash (free)é­éæ­å´å¼ä¸è·ï¼è°ç¨éä»582B tokenséª¤éè³280Bï¼æåç±ç¬¬2æ»è½è³ç¬¬9ï¼å¨å¢é¿çä»+18%è½¬ä¸º-52%ï¼DeepSeek V3.2å®ç°å¼ºå¿è·åï¼è°ç¨éä»364Bå¢è³464Bï¼æåä»ç¬¬7åè³ç¬¬4ï¼å¨å¢é¿çç±4%å¤§å¹æåè³27%ï¼Claude Opus 4.5ç±é«éå¢é¿è½¬ä¸ºææ¾åè°ï¼è°ç¨éä»395Béè³339Bï¼å¨å¢é¿çä»+35%è½¬ä¸º-14%ï¼Gemini 2.5 Proè·åºååæ¦åï¼å¶ä¸å¨413Bçè°ç¨éæ¬å¨è¢«gpt-oss-120bä»¥272Bè¿å¥åååä»£ï¼Gemini 2.5 Flashç¨³æ­¥å¤èï¼æåä»ç¬¬8ä¸åè³ç¬¬5ï¼è°ç¨éä»364Bå¢è³394Bï¼å¨å¢é¿çç±-3%è½¬æ­£ä¸º+8%</li>
<li>OpenRouteræ¨¡åå¸å çæ¹é¢ï¼DeepSeekè°ç¨éä»ä¸å¨457Bå¢è³æ¬å¨553Bï¼å¸åºå æ¯ç±8.0%æåè³9.4%ï¼Googleä¸»å¯¼å°ä½ç¥æåå¼±ï¼è°ç¨éä»1.48Téè³1.4Tï¼å æ¯ç±26.0%ä¸æ»è³24.0%ï¼Xiaomié­éæ­å´å¼ä¸è·ï¼ä»ç¬¬6åï¼441Bï¼7.8%ï¼ç´æ¥è·åºååæ¦åï¼MoonshotAIå¼ºå¿å¥å±ï¼æ°è¿ååå¹¶ç´æ¥å æ®ç¬¬7ä½ï¼è·å¾203Bè°ç¨éï¼3.5%ä»½é¢ï¼ï¼é¿å°¾å¸åºçåå¼å¢é¿ï¼Othersç±»å«è°ç¨éä»349Bæ¿å¢è³598Bï¼å æ¯ç±6.1%é£åè³10.2%</li>
<li>OpenRouteræ¨¡åååéæ¹é¢ï¼GPT-OSS-120Bï¼Groqæä¾ï¼å·æè¶å¼ºç»æ²»åï¼ä½ç°å¨éåº¦å¤å¿«+ææ¬å¯æ§+è§æ¨¡åéªè¯ï¼éåº¦ç¬¬2ï¼936 tok/sï¼ï¼ææ¬éä¸­ï¼$0.35/Mï¼ï¼è¯·æ±éæé«ï¼å¯è½æ¯å½åæä¸»æµççäº§ç¯å¢éæ©ï¼Qwen3 32Bï¼Cerebrasæä¾ï¼å´èµ·ï¼éåº¦ç¬¬3ï¼736 tok/sï¼ï¼åç¹ç¬¬äºå¤§ï¼æ¾ç¤ºå½äº§æ¨¡åå¯è½å¨å½éå¼åèå·¥å·é¾ä¸­å·²å æ ¸å¿ä½ç½®</li>
<li>OpenRouterç¼ç¨è°ç¨éæ¹é¢ï¼Grok Code Fast 1é¢åä¼å¿æ¥å§èç¼©ï¼è°ç¨éå æ¯ç±22.8%å¤§å¹ä¸æ»è³16.4%ï¼MiniMax M2.1å®ç°è·¨è¶å¼å¢é¿ï¼è°ç¨éä»56.8Bç¿»åè³115Bï¼å æ¯ç±4.0%å¤§å¹æåè³7.4%ï¼Kimi K2.5å¼ºå¿é¯å¥åäºï¼ä»¥139B tokenså8.9%å æ¯æ°ææ¦åç¬¬4ä½ï¼GPT-5ç³»ååæ¨¡åéåååï¼GPT-5.2ä¸GPT-5.2-Codexåå«ä»¥61.4Bå54.5B tokensè°ç¨éå æ®ç¬¬8ãç¬¬9ä½ï¼ä¸å¨ä¸å¤§ç­é¨æ¨¡åéä½è·åºååï¼MiMo V2 Flash (free)ãDevstral 2 2512 (free)ä¸DeepSeek V3.2åå«ä»ä¸å¨ç¬¬5ãç¬¬7ãç¬¬9ä½æ»è½è³ååä¹å¤</li>
<li>å¾åç¼è¾è½åæ¦åï¼Text to Image Arenaï¼ï¼hunyuan-image-3.0-instructæ°ä¸æ¦åï¼è¯ååºäºé¢åå¸æµè¯ï¼å¯è½ä¼éçå¬å¼åå¸åç¤¾åºåé¦åæç¥¨çååèè°æ´</li>
<li>å¾åç¼è¾è½åæ¦åï¼Artificial Analysis Image Editing Leaderboardï¼ï¼Reve V1åæ°è¶è¿FLUX.2 [pro]ï¼äºèæåæä½ï¼åå«æå8ã9</li>
<li>æçå¾è½åæ¦åï¼Artificial Analysis Text to Image Leaderboardï¼ï¼FLUX.2 [dev] Turboåæ°è¶è¿ImagineArt 1.5 Previewï¼äºèæåæä½ï¼åå«æå10ã11</li>
<li>GAIAæ¦åï¼Shawn Agentæ´æ°v3.1ï¼æåç¬¬7ï¼å¾åè¾¾89.37%</li>
</ul>
<h3 id="4-æè¡æ¦">4. æè¡æ¦</h3>
<table>
<thead>
<tr>
<th>æµè¯ç±»å</th>
<th>ç¬¬ä¸å</th>
<th>ç¬¬äºå</th>
<th>ç¬¬ä¸å</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¨¡åè°ç¨é</td>
<td>Claude Sonnet 4.5</td>
<td>Gemini 3 Flash Preview</td>
<td>Grok Code Fast 1</td>
</tr>
<tr>
<td>å¬å¸å¸å ç</td>
<td>Google</td>
<td>Anthropic</td>
<td>OpenAI</td>
</tr>
<tr>
<td>æ¨¡åéåº¦</td>
<td>gpt-oss-safeguard-20b</td>
<td>gpt-oss-120b</td>
<td>Qwen3 32B</td>
</tr>
<tr>
<td>ç¼ç¨æ¨¡åè°ç¨é</td>
<td>Grok Code Fast 1</td>
<td>Claude Sonnet 4.5</td>
<td>Claude Opus 4.5</td>
</tr>
</tbody>
</table>
<h4 id="åå¬å¸æä¸åè½åé¢åæåæ±æ»">åå¬å¸æä¸åè½åé¢åæåæ±æ»</h4>
<table>
<thead>
<tr>
<th>æµè¯ç±»å</th>
<th>é¢åå¬å¸</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¤§è¯­è¨æ¨¡å Text Arena</td>
<td>GoogleãxAIãAnthropicãç¾åº¦ãOpenAIãæºè°±ãé¿éå·´å·´ãæä¹æé¢</td>
</tr>
<tr>
<td>ç¼ç¨è½å Code Arena</td>
<td>AnthropicãOpenAIãGoogleãæºè°±ãMiniMax</td>
</tr>
<tr>
<td>ç¼ç¨è½å LiveCodeBench</td>
<td>OpenAIãAnthropicãGoogle</td>
</tr>
<tr>
<td>ä»£ç å·¥ç¨ä»»å¡è½å SWE-benchLite</td>
<td>åºäºClaudeãGeminiãGPTãQwenãDeepSeekå¼åçå¼æºç³»ç»</td>
</tr>
<tr>
<td>å¾åç¼è¾åçæè½å Image Edit Arena</td>
<td>OpenAIãGoogleãå­èãè¾è®¯ãBlack Forest LabsãReve</td>
</tr>
<tr>
<td>æçå¾è½å Text-to-Image Arena</td>
<td>OpenAIãGoogleãBlack Forest Labsãè¾è®¯</td>
</tr>
<tr>
<td>å¾åç¼è¾åçæè½å Image Editing Leaderboard</td>
<td>OpenAIãGoogleãå­èãBlack Forest Labsãé¿éå·´å·´ãReve</td>
</tr>
<tr>
<td>æçå¾è½å Text to Image Leaderboard</td>
<td>OpenAIãGoogleãBlack Forest Labsãå­èãFal</td>
</tr>
<tr>
<td>GPQA</td>
<td>OpenAIãGoogleãxAIãAnthropicãé¿éå·´å·´</td>
</tr>
<tr>
<td>FrontierMath</td>
<td>OpenAIãGoogleãDeepSeekãæä¹æé¢ãAnthropicãxAI</td>
</tr>
<tr>
<td>Humanity's Last Exam</td>
<td>GoogleãOpenAIãAnthropic</td>
</tr>
<tr>
<td>GAIA</td>
<td>JoinAIãNvidiaãSuzhou AI Lab&amp;Shuqian TechãMicrosoft AI Asia -AdsãLR AILab of Lenovo CTO OrgãShawnAgentãZTE-AICloudãLR AILabç­</td>
</tr>
</tbody>
</table>
<hr>
<p>å³æ³¨æï¼ç¬¬ä¸æ¶é´ææ¡æ´å¤AIåæ²¿èµè®¯ï¼</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-31 13:26">2026-01-31 13:26</span>&nbsp;
<a href="https://www.cnblogs.com/xjk15082">KAIæºä¹ </a>&nbsp;
éè¯»(<span id="post_view_count">64</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19557561);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19557561', targetLink: 'https://www.cnblogs.com/xjk15082/p/19557561', title: 'å¤§æ¨¡åæ¦åå¨æ¥ï¼2026/01/31ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Ubuntu20.04 å®è£å£°å¡é©±å¨ ]]></title>
    <link>https://www.cnblogs.com/zylyehuo/p/19556794</link>
    <guid>6f58ca01f4969a4559e0c59fb75fb6bd</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/zylyehuo/p/19556794" title="åå¸äº 2026-01-31 13:11">
    <span role="heading" aria-level="2">Ubuntu20.04 å®è£å£°å¡é©±å¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>åå®¢å°åï¼<a href="https://www.cnblogs.com/zylyehuo/" target="_blank">https://www.cnblogs.com/zylyehuo/</a></p>
</blockquote>
<h1 id="éè£æ´æ°-alsa-å-pulseaudio">éè£/æ´æ° ALSA å PulseAudio</h1>
<blockquote>
<p>å¤§å¤æ°âé©±å¨é®é¢âå®éä¸æ¯é³é¢æå¡ï¼PulseAudioï¼éç½®æåã</p>
</blockquote>
<pre><code>sudo apt install --reinstall alsa-base alsa-utils pulseaudio libasound2
</code></pre>
<h1 id="å¼å¯-multiverse-è½¯ä»¶æº">å¼å¯ Multiverse è½¯ä»¶æº</h1>
<pre><code>sudo add-apt-repository multiverse
</code></pre>
<pre><code>sudo apt update
</code></pre>
<h1 id="å®è£-intel-sof-åºä»¶">å®è£ Intel SOF åºä»¶</h1>
<blockquote>
<p>è¾æ°ç Intel å£°å¡ï¼å¦ Device 43c8ï¼ä¸åä½¿ç¨ä¼ ç»ç snd_hda_intel é©±å¨ï¼èæ¯ä¾èµ SOF (Sound Open Firmware)ã</p>
</blockquote>
<pre><code>sudo apt install firmware-sof-signed
</code></pre>
<h1 id="æå¨é¨ç½²-sof-äºè¿å¶åºä»¶ä¸ä¸æ­¥å¤±è´¥åæ§è¡è¿æ­¥">æå¨é¨ç½² SOF äºè¿å¶åºä»¶ãä¸ä¸æ­¥å¤±è´¥åæ§è¡è¿æ­¥ã</h1>
<pre><code>wget https://github.com/thesofproject/sof-bin/releases/download/v2.2.6/sof-bin-v2.2.6.tar.gz
tar -xvf sof-bin-v2.2.6.tar.gz
cd sof-bin-v2.2.6
sudo mv /lib/firmware/intel/sof /lib/firmware/intel/sof.bak
sudo mv /lib/firmware/intel/sof-tplg /lib/firmware/intel/sof-tplg.bak
</code></pre>
<h2 id="æ§è¡é¨ç½²èæ¬">æ§è¡é¨ç½²èæ¬</h2>
<pre><code>sudo ./install.sh v2.2.6
</code></pre>
<pre><code>ls -l /lib/firmware/intel/sof*
</code></pre>
<h2 id="ä¿å­å¹¶æ´æ°åæ ¸éå">ä¿å­å¹¶æ´æ°åæ ¸éå</h2>
<pre><code>sudo update-initramfs -u
</code></pre>
<h1 id="ä¿®æ¹éç½®æä»¶ä»¥é²å²çª">ä¿®æ¹éç½®æä»¶ä»¥é²å²çª</h1>
<pre><code>sudo gedit /etc/modprobe.d/alsa-base.conf
</code></pre>
<blockquote>
<p>å¨æä»¶æ«å°¾æ·»å ä»¥ä¸åå®¹ï¼å¼ºå¶å° Intel å£°å¡è®¾ä¸º index 0</p>
</blockquote>
<pre><code># --- ä¿®å¤ Intel Device 43c8 å£°å¡ ---
# å¼ºå¶ä½¿ç¨ SOF é©±å¨é»è¾ï¼1=èªå¨, 3=å¼ºå¶SOFï¼
options snd-intel-dspcfg dsp_driver=3

# è§£å³é¨åæºåä¸ Intel PCH çé©±å¨å²çª
options snd-hda-intel model=generic
</code></pre>
<h2 id="ä¿å­å¹¶æ´æ°åæ ¸éå-1">ä¿å­å¹¶æ´æ°åæ ¸éå</h2>
<pre><code>sudo update-initramfs -u
</code></pre>
<h1 id="æ£æ¥ç©çéé³">æ£æ¥ç©çéé³</h1>
<blockquote>
<p>å¾å¤æ¶åé©±å¨æ­£å¸¸ï¼ä½åæ ¸é»è®¤å³é­äºæ¬å£°å¨æ¾å¤§å¨ï¼Amplifierï¼ã</p>
</blockquote>
<blockquote>
<p>å¨ Intel SOF é©±å¨æ¶æä¸­ï¼è¿äº PGA (Programmable Gain Amplifier) éééå¸¸è¿æ¥çå®éçåçæ¾å¤§å¨ã</p>
</blockquote>
<blockquote>
<p>è§£å³æ¹æ³ï¼è¯·å¨ AlsaMixer çé¢ä¸­ï¼ä½¿ç¨æ¹åé®åå³ç§»å¨å° PGA1.0 å° PGA31.0 çæ¯ä¸ä¸ªééä¸ï¼ç¶åæåä¸æ¹åé®å°å®ä»¬çé³éå¨é¨ææ»¡ï¼åçº¢ï¼ã</p>
</blockquote>
<pre><code>alsamixer
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3071480/202601/3071480-20260131125639306-1134406504.png" alt="image" loading="lazy"></p>
<h2 id="éªè¯é©±å¨å è½½ç¶æ">éªè¯é©±å¨å è½½ç¶æ</h2>
<pre><code>dmesg | grep -i sof
</code></pre>
<blockquote>
<p>æ­£å¸¸è¾åºï¼ åºåå« SOF: firmware boot complete / Firmware info: version 2:2:0-57864 / ...</p>
</blockquote>
<p><img src="https://img2024.cnblogs.com/blog/3071480/202601/3071480-20260131131031867-489736722.png" alt="image" loading="lazy"></p>
<h1 id="éå¯">éå¯</h1>
<pre><code>sudo reboot
</code></pre>
<h1 id="æ¥æ¾çå®çå£°å¡è®¾å¤åè¡¨">æ¥æ¾çå®çå£°å¡è®¾å¤åè¡¨</h1>
<pre><code>aplay -l
</code></pre>
<blockquote>
<p>å¦æçå° sof-hda-dsp æ Intel PCHï¼è®°ä½å®çå¡å· (card X) åè®¾å¤å· (device Y)ã</p>
</blockquote>
<blockquote>
<p>éå¸¸ Intel å£°å¡æ¯ card 0, device 0ã</p>
</blockquote>
<p><img src="https://img2024.cnblogs.com/blog/3071480/202601/3071480-20260131125756745-1202709689.png" alt="image" loading="lazy"></p>
<h2 id="æµè¯æä»¤">æµè¯æä»¤</h2>
<pre><code># å¼ºå¶æå®è®¾å¤æ­æ¾ï¼åè®¾æ¯ card 1, device 0ï¼
speaker-test -D hw:1,0 -t sine -f 440 -c 2
</code></pre>
<ul>
<li>
<p>speaker-test: è¿æ¯ ALSA (é«çº§ Linux å£°é³æ¶æ) æ åå¥ä»¶ä¸­çæµè¯ç¨åºã</p>
</li>
<li>
<p>-D hw:1,0: æå®æ­æ¾è®¾å¤ã</p>
</li>
<li>
<p>hw è¡¨ç¤ºç´æ¥ä½¿ç¨ç¡¬ä»¶é©±å¨ï¼Hardwareï¼ã</p>
</li>
<li>
<p>1 æ¯å£°å¡ç¼å·ï¼Card IDï¼ãå¨ä½ çç³»ç»ä¸­ï¼card 1 æ¯ sof-hda-dspï¼Intel å£°å¡ï¼ã</p>
</li>
<li>
<p>0 æ¯è®¾å¤ç¼å·ï¼Device IDï¼ãå¯¹äºä¸»æ¿è¾åºï¼éå¸¸æ¯ 0ã</p>
</li>
<li>
<p>-t sine: æå®æµè¯é³çæ³¢å½¢ç±»åãè¿éæ¯ sineï¼æ­£å¼¦æ³¢ï¼ï¼å®ä¼ååºç±»ä¼¼âæ»´âââçé¿é¸£é³ãæ­¤å¤è¿å¯ä»¥é pinkï¼ç²çº¢åªé³ï¼æ whiteï¼ç½åªé³ï¼ã</p>
</li>
<li>
<p>-f 440: æå®å£°é³çé¢çã440 Hz æ¯æ åé³é«ï¼A4ï¼ï¼å¬èµ·æ¥æ¯è¾æ¸èã</p>
</li>
<li>
<p>-c 2: æå®å£°éæ°ï¼Channelsï¼ã2 è¡¨ç¤ºåå£°éï¼å·¦å³é³ç®±ï¼ã</p>
</li>
</ul>
<pre><code>ffplay -nodisp -autoexit /home/yehuo/unitree_G1_ws/src/assets/1.mp3
</code></pre>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-31 13:11">2026-01-31 13:11</span>&nbsp;
<a href="https://www.cnblogs.com/zylyehuo">zylyehuo</a>&nbsp;
éè¯»(<span id="post_view_count">9</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19556794);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19556794', targetLink: 'https://www.cnblogs.com/zylyehuo/p/19556794', title: 'Ubuntu20.04 å®è£å£°å¡é©±å¨' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ [python] python-docx-templateå®ç¨æ¡ä¾è§£æ ]]></title>
    <link>https://www.cnblogs.com/luohenyueji/p/19556736</link>
    <guid>19918132cf2f20b3f282b870aca18799</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/luohenyueji/p/19556736" title="åå¸äº 2026-01-31 09:17">
    <span role="heading" aria-level="2">[python] python-docx-templateå®ç¨æ¡ä¾è§£æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>Python-docx-templateæ¯ä¸ä¸ªåè½å¼ºå¤§çWordææ¡£èªå¨åçæåºï¼å®åºäºæ¨¡æ¿å¼æçè®¾è®¡ææ³ï¼åè®¸ç¨æ·éè¿ç¼åæ¨¡æ¿ä¸Pythonä»£ç é»è¾åç¦»çæ¹å¼ï¼é«æçæç»æå¤æãæ ·å¼å¤æ ·çWordææ¡£ãå¨æç« <a href="https://www.cnblogs.com/luohenyueji/p/19503461" target="_blank">python-docx-templateæ¨¡æ¿åWordææ¡£çææå</a>ä»ç»è¯¥åºçåºç¡ç¨æ³ä¹ä¸ï¼æ¬æå°è¿ä¸æ­¥ç»åå®æ¹ç¤ºä¾ï¼æä¾å¤ä¸ªå®ç¨åºæ¯çä»£ç è§£æä¸æå±ï¼æ¶µçå¤ææ ·å¼ãèªå®ä¹è¿æ»¤å¨ãåµå¥å¾ªç¯åå¯ææ¬æ¸²æç­é«çº§åè½ï¼ä»¥æåææ¡£çæçæçä¸çµæ´»æ§ãä¸æå°åæ¨¡åå±å¼å·ä½ç¤ºä¾ä¸å®ç°ã</p>
<p>python-docx-templateçå®æ¹ä»£ç ä»åºå°åä¸ºï¼<a href="https://github.com/elapouya/python-docx-template" target="_blank" rel="noopener nofollow">python-docx-template</a>ï¼è¯¦ç»ææ¡£å¯åéï¼<a href="https://docxtpl.readthedocs.io/" target="_blank" rel="noopener nofollow">python-docx-template doc</a>ã</p>
<p><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E5%AE%9E%E7%94%A8%E6%A1%88%E4%BE%8B%E8%A7%A3%E6%9E%90/imgs/img1.png" alt="" loading="lazy"></p>
<p>æ¬æä½¿ç¨çpython-docx-templateçæ¬ä¸º0.20.2ï¼å®è£å½ä»¤å¦ä¸ï¼</p>
<blockquote>
<p>pip install docxtpl</p>
</blockquote>
<p></p><div class="toc"><div class="toc-container-header">ç®å½</div><ul><li><a href="#1-å®ç¨æ¡ä¾" rel="noopener nofollow">1 å®ç¨æ¡ä¾</a><ul><li><a href="#11-è¡¨æ ¼æ ·å¼çæ" rel="noopener nofollow">1.1 è¡¨æ ¼æ ·å¼çæ</a></li><li><a href="#12-èªå®ä¹jinja2è¿æ»¤å¨" rel="noopener nofollow">1.2 èªå®ä¹Jinja2è¿æ»¤å¨</a></li><li><a href="#13-ææ¡£åµå¥" rel="noopener nofollow">1.3 ææ¡£åµå¥</a></li><li><a href="#14-èªå¨è½¬ä¹" rel="noopener nofollow">1.4 èªå¨è½¬ä¹</a></li><li><a href="#15-å¾çæ¿æ¢" rel="noopener nofollow">1.5 å¾çæ¿æ¢</a></li><li><a href="#16-å½ä»¤è¡æ§è¡" rel="noopener nofollow">1.6 å½ä»¤è¡æ§è¡</a></li><li><a href="#17-å¤å±åµå¥" rel="noopener nofollow">1.7 å¤å±åµå¥</a></li><li><a href="#18-å°åºå­ä½å¤ç" rel="noopener nofollow">1.8 å°åºå­ä½å¤ç</a></li><li><a href="#19-å¯ææ¬ä½¿ç¨" rel="noopener nofollow">1.9 å¯ææ¬ä½¿ç¨</a></li><li><a href="#110-éè¯¯ç®¡ç" rel="noopener nofollow">1.10 éè¯¯ç®¡ç</a></li></ul></li><li><a href="#2-åè" rel="noopener nofollow">2 åè</a></li></ul></div><p></p>
<h1 id="1-å®ç¨æ¡ä¾">1 å®ç¨æ¡ä¾</h1>
<h2 id="11-è¡¨æ ¼æ ·å¼çæ">1.1 è¡¨æ ¼æ ·å¼çæ</h2>
<p>æ¬ç¤ºä¾ç¨äºçæåå«å¯ææ¬æ ·å¼ä¸ååæ ¼èæ¯è²çWordè¡¨æ ¼ææ¡£ã</p>
<p>æ¨¡æ¿åå®¹ï¼</p>
<p><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E5%AE%9E%E7%94%A8%E6%A1%88%E4%BE%8B%E8%A7%A3%E6%9E%90/imgs/image.png" alt="" loading="lazy"></p>
<p>æ¸²æä»£ç ï¼</p>
<pre><code class="language-python"># python-docx-template/blob/master/tests/comments.py
from docxtpl import DocxTemplate, RichText
# data: python-docx-template/blob/master/tests/templates/cellbg_tpl.docx
tpl = DocxTemplate("templates/cellbg_tpl.docx")

context = {
    "alerts": [
        {
            "date": "2015-03-10",
            "desc": RichText("Very critical alert", color="FF0000", bold=True),
            "type": "CRITICAL",
            "bg": "FF0000",
        },
        {
            "date": "2015-03-11",
            "desc": RichText("Just a warning"),
            "type": "WARNING",
            "bg": "FFDD00",
        }
    ],
}

tpl.render(context)
tpl.save("output/cellbg.docx")
</code></pre>
<h2 id="12-èªå®ä¹jinja2è¿æ»¤å¨">1.2 èªå®ä¹Jinja2è¿æ»¤å¨</h2>
<p>æ¬ç¤ºä¾ä¸»è¦ä»ç»éè¿èªå®ä¹Jinja2è¿æ»¤å¨å®ç°å¨ææ°æ®æ¸²æï¼Jinja2æ¨¡æ¿ä¸­è¿æ»¤å¨çæ ¸å¿æ ¼å¼ä¸ºï¼<code>{{ åéå|è¿æ»¤å¨å(åæ°1, åæ°2, ...) }}</code>ï¼å¶ä¸­ï¼</p>
<ul>
<li><code>|</code>ï¼ç«çº¿ï¼æ¯è¿æ»¤å¨çåéç¬¦ï¼å·¦ä¾§æ¯è¦å¤ççåéï¼å³ä¾§æ¯è¿æ»¤å¨åç§°ï¼</li>
<li>æ¬å·<code>()</code>åæ¯ä¼ ç»è¿æ»¤å¨å½æ°çåæ°ï¼æ åæ°æ¶å¯çç¥æ¬å·ï¼ï¼</li>
<li>ç¤ºä¾ï¼<code>{{ base_value_float|my_filterB(2) }}</code> ä¸­ï¼<code>base_value_float</code>æ¯åéï¼<code>my_filterB</code>æ¯è¿æ»¤å¨åï¼<code>2</code>æ¯ä¼ éçåæ°ã</li>
</ul>
<p>æ¨¡æ¿åå®¹ï¼</p>
<p><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E5%AE%9E%E7%94%A8%E6%A1%88%E4%BE%8B%E8%A7%A3%E6%9E%90/imgs/image-1.png" alt="" loading="lazy"></p>
<p>æ¸²æä»£ç ï¼</p>
<pre><code class="language-python"># python-docx-template/blob/master/tests/custom_jinja_filters.py
from docxtpl import DocxTemplate
import jinja2

# åå»ºjinja2ç¯å¢å¯¹è±¡ï¼ç¨äºç®¡çæ¨¡æ¿æ¸²æçéç½®
jinja_env = jinja2.Environment()

# èªå®ä¹è¿æ»¤å¨å½æ°
def my_filterA(value, my_string_arg):
    # å°åå§å¼ååæ°å­ç¬¦ä¸²æ¼æ¥ï¼ä¸­é´å ç©ºæ ¼
    return_value = value + " " + my_string_arg
    return return_value
def my_filterB(value, my_float_arg):
    # å°åå§å¼ååæ°æ°å¼ç¸å 
    return_value = value + my_float_arg
    return return_value

# å°èªå®ä¹è¿æ»¤å¨æ³¨åå°jinja2ç¯å¢ä¸­ï¼ä½¿å¶è½å¨æ¨¡æ¿ä¸­è¢«è°ç¨
# æ³¨ååå¨Wordæ¨¡æ¿ä¸­å¯éè¿{{ åéå| my_filterA('åæ°') }}å½¢å¼ä½¿ç¨
jinja_env.filters["my_filterA"] = my_filterA
jinja_env.filters["my_filterB"] = my_filterB

context = {
    "base_value_string": " Hello",  
    "base_value_float": 1.5         
}
# data: python-docx-template/blob/master/tests/templates/custom_jinja_filters_tpl.docx
tpl = DocxTemplate("templates/custom_jinja_filters_tpl.docx")
tpl.render(context, jinja_env)
tpl.save("output/custom_jinja_filters.docx")
</code></pre>
<h2 id="13-ææ¡£åµå¥">1.3 ææ¡£åµå¥</h2>
<p>ä»¥ä¸ä»£ç å±ç¤ºäºå¦ä½æ¸²æå­Wordææ¡£ï¼æ¿æ¢ä¸»Wordææ¡£ä¸­åµå¥çåç±»æä»¶ï¼å¡«åæ°æ®åä¿å­ææ¡£ï¼</p>
<pre><code class="language-python"># python-docx-template/blob/master/tests/embedded.py
from docxtpl import DocxTemplate

# å è½½ååµå­æ¨¡æ¿æä»¶
# data: python-docx-template/blob/master/tests/templates/embedded_embedded_docx_tpl.docx
embedded_docx_tpl = DocxTemplate("templates/embedded_embedded_docx_tpl.docx")

# å®ä¹æ¨¡æ¿æ¸²æçä¸ä¸ææ°æ®
context = {
    "name": "John Doe",  # è¦å¡«åå°æ¨¡æ¿ä¸­çå§åå¼
}
embedded_docx_tpl.render(context)

# ä¿å­æ¸²æåçå­æ¨¡æ¿å°æå®è·¯å¾ï¼ä¾åç»­ä¸»æ¨¡æ¿è°ç¨
embedded_docx_tpl.save("output/embedded_embedded_docx.docx")

# å è½½ä¸»æ¨¡æ¿æä»¶
tpl = DocxTemplate("templates/embedded_main_tpl.docx")

# å®ä¹ä¸»æ¨¡æ¿çä¸ä¸ææ°æ®
context = {
    "name": "John Doe",
}

# æ¿æ¢ä¸»æ¨¡æ¿ä¸­åµå¥çWordææ¡£
# åæ°1ï¼æ¨¡åæ¬åµå¥çå ä½æä»¶è·¯å¾
# åæ°2ï¼è¦æ¿æ¢æçç®æ æä»¶è·¯å¾
tpl.replace_embedded(
    "templates/embedded_dummy.docx", "templates/embedded_static_docx.docx"
)

tpl.replace_embedded(
    "templates/embedded_dummy2.docx", "output/embedded_embedded_docx.docx"
)

# è¯´æï¼docx æ¬è´¨æ¯ zip åç¼©åï¼åµå¥çæä»¶ä¼å­å¨å¨word/embeddings/ç®å½ä¸
tpl.replace_zipname(
    "word/embeddings/Feuille_Microsoft_Office_Excel3.xlsx", 
    "templates/real_Excel.xlsx"  # è¦æ¿æ¢æçå®éæä»¶è·¯å¾
)
tpl.replace_zipname(
    "word/embeddings/Pr_sentation_Microsoft_Office_PowerPoint4.pptx",
    "templates/real_PowerPoint.pptx" 
)

tpl.render(context)
tpl.save("output/embedded.docx")
</code></pre>
<h2 id="14-èªå¨è½¬ä¹">1.4 èªå¨è½¬ä¹</h2>
<p>æ¬ç¤ºä¾å±ç¤ºäºå¨èªå¨è½¬ä¹æ¨¡å¼ä¸ï¼å°åå«XMLç¹æ®å­ç¬¦ãUnicodeææ¬åå¨æé®å¼å¯¹çä¸ä¸ææ°æ®æ¸²æå°æ¨¡æ¿ä¸­ã</p>
<p>æ¨¡æ¿åå®¹ï¼<br>
<img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E5%AE%9E%E7%94%A8%E6%A1%88%E4%BE%8B%E8%A7%A3%E6%9E%90/imgs/image-2.png" alt="" loading="lazy"></p>
<p>æ¸²æä»£ç ï¼</p>
<pre><code class="language-python"># python-docx-template/blob/master/tests/escape_auto.py
import os
from unicodedata import name
from docxtpl import DocxTemplate
XML_RESERVED = """&lt;"&amp;'&gt;"""
# data: python-docx-template/blob/master/tests/templates/escape_tpl_auto.docx
tpl = DocxTemplate("templates/escape_tpl_auto.docx")

context = {
    "nested_dict": {name(str(c)): c for c in XML_RESERVED},
    "autoescape": 'Escaped "str &amp; ing"!',
    "autoescape_unicode": "This is an escaped &lt;unicode&gt; example \u4f60 &amp; \u6211",
    "iteritems": lambda x: x.items(),
}
# autoescape=Trueè¡¨ç¤ºèªå¨è½¬ä¹
tpl.render(context, autoescape=True)

OUTPUT = "output"
if not os.path.exists(OUTPUT):
    os.makedirs(OUTPUT)
tpl.save(OUTPUT + "/escape_auto.docx")
</code></pre>
<p>å®éä¸<code>iteritems(nested_dict)</code>å°±æ¯è°ç¨æ¸²æå®ä¹çlambdaå½æ°ï¼ænested_dictä¼ è¿å»ï¼æ¿å°å®çææé®å¼å¯¹ï¼</p>
<pre><code>{% for k, v in iteritems(nested_dict) %}
{{ k.capitalize() }}: {{ v }}{% endfor %}
</code></pre>
<p>ä¹å¯ä»¥å¨Jinja2æ¨¡æ¿ä¸­ä½¿ç¨Pythonè¡¨è¾¾å¼ï¼ç´æ¥è°ç¨å­å¸çitemæ¹æ³ï¼</p>
<pre><code>{% for k, v in nested_dict.items() %}
{{ k.capitalize() }}: {{ v }}{% endfor %}
</code></pre>
<h2 id="15-å¾çæ¿æ¢">1.5 å¾çæ¿æ¢</h2>
<p>ä»¥ä¸ç¤ºä¾è¯´æå¦ä½æ¿æ¢Wordæ¨¡æ¿ææ¡£ï¼åå«é¡µçé¡µèï¼ä¸­çå¾çï¼å¹¶æ¼ç¤ºå¦ä½å°å¤çåçææ¡£åå«éè¿å¸¸è§æ¹å¼ååå­æä»¶å¯¹è±¡ä¿å­ä¸ºæ¬å°æä»¶ï¼</p>
<pre><code class="language-python"># python-docx-template/blob/master/tests/header_footer_image_file_obj.py
from docxtpl import DocxTemplate
import io

# å®ä¹ä¸¤ä¸ªè¾åºææ¡£çè·¯å¾åæä»¶å
DEST_FILE = "output/header_footer_image_file_obj.docx"
DEST_FILE2 = "output/header_footer_image_file_obj2.docx"
# data: python-docx-template/blob/master/tests/templates/header_footer_image_tpl.docx
tpl = DocxTemplate("templates/header_footer_image_tpl.docx")

context = {
    "mycompany": "The World Wide company",  
}

# è¯»åæ¨¡æ¿ä¸­éè¦è¢«æ¿æ¢çå¾çæä»¶ï¼å¹¶è½¬æ¢ä¸ºåå­å­èæµå¯¹è±¡
dummy_pic = io.BytesIO(open("templates/dummy_pic_for_header.png", "rb").read())
# è¯»åæ°çæ¿æ¢å¾çæä»¶ï¼python.pngï¼ï¼å¹¶è½¬æ¢ä¸ºåå­å­èæµå¯¹è±¡
new_image = io.BytesIO(open("templates/python.png", "rb").read())

# å°dummy_picå¯¹åºçå¾çæ¿æ¢ä¸ºnew_imageå¯¹åºçå¾ç
tpl.replace_media(dummy_pic, new_image)
tpl.render(context)
tpl.save(DEST_FILE)

tpl = DocxTemplate("templates/header_footer_image_tpl.docx")

# å°åå­ä¸­çå¾çå­èæµæééç½®å°èµ·å§ä½ç½®
dummy_pic.seek(0)
new_image.seek(0)

# åæ¬¡æ§è¡å¾çæ¿æ¢æä½
tpl.replace_media(dummy_pic, new_image)
# åæ¬¡æ¸²ææ¨¡æ¿åé
tpl.render(context)

# åå»ºä¸ä¸ªç©ºçåå­å­èæµå¯¹è±¡ï¼ç¨äºä¸´æ¶å­å¨ææ¡£åå®¹
file_obj = io.BytesIO()
# å°å¤çåçææ¡£ä¿å­å°åå­å­èæµå¯¹è±¡ä¸­
tpl.save(file_obj)
# å°åå­å­èæµæééç½®å°èµ·å§ä½ç½®ï¼åå¤è¯»ååå®¹
file_obj.seek(0)

# ä»¥äºè¿å¶åå¥æ¨¡å¼æå¼ç¬¬äºä¸ªè¾åºæä»¶ï¼å°åå­ä¸­çææ¡£åå®¹åå¥æä»¶
with open(DEST_FILE2, "wb") as f:
    f.write(file_obj.read())
dummy_pic.close()
new_image.close()
</code></pre>
<p>ä¸è¿°ä»£ç å®ç°å¾çæ¿æ¢å¹¶éåºäºæä»¶åï¼èæ¯åºäºäºè¿å¶åå®¹çå¹éãè¿æ¯å ä¸º<code>replace_media</code>æ¹æ³æ ¹æ®å¾ççäºè¿å¶åå®¹æ¥è¯å«å¾åï¼èéä¾èµæä»¶åæå¨Wordä¸­æ¾ç¤ºçåç§°ã<br>
ç±äºWordææ¡£ (.docx) æ¬è´¨ä¸æ¯ä¸ä¸ªåç¼©åï¼å¶ä¸­çå¾çä»¥äºè¿å¶å½¢å¼å­å¨å¨<code>word/media/</code>ç®å½ä¸ï¼ä¸å¨æäºWordçæ¬ä¸­ï¼å¾çæä»¶åå¯è½è¢«èªå¨éå½åï¼ä¾å¦æ¹ä¸º <code>image1.png</code>ï¼ï¼ä¸åå§æä»¶åæ å³ã</p>
<p><strong>æ³¨æð</strong>ï¼å¾æ¿æ¢å¾çå°ºå¯¸ä¸å®è¿å¤§ï¼ä¸éå³é­Wordæ¨¡æ¿çå¾çåç¼©åè½ï¼å¦åWordä¼èªå¨åç¼©æ¨¡æ¿ä¸­çå¾çï¼æ¹åå¶äºè¿å¶æ°æ®ï¼æç»å¯¼è´å¾çæ¿æ¢æä½å¤±è´¥ã</p>
<h2 id="16-å½ä»¤è¡æ§è¡">1.6 å½ä»¤è¡æ§è¡</h2>
<p>ä»¥ä¸ç¤ºä¾å±ç¤ºäºç´æ¥å¨å½ä»¤è¡ä¸­ä½¿ç¨docxtplæ¨¡åï¼åºäºæ¨¡æ¿æä»¶åä½ä¸ºä¸ä¸ææ°æ®çJSONæä»¶çædocxææ¡£ï¼</p>
<pre><code class="language-python"># python-docx-template/blob/master/tests/module_execute.py
import os
# data: python-docx-template/blob/master/tests/templates/module_execute_tpl.docx
TEMPLATE_PATH = "templates/module_execute_tpl.docx"
# å­å¨éè¦å¡«åå°æ¨¡æ¿ä¸­çæ°æ®
JSON_PATH = "templates/module_execute.json"
OUTPUT_FILENAME = "output/module_execute.docx"
# docxtplå½ä»¤åæ°ï¼å¼ºå¶è¦çå·²å­å¨çè¾åºæä»¶
OVERWRITE = "-o"
# docxtplå½ä»¤åæ°ï¼éé»æ¨¡å¼æ§è¡ï¼ä¸è¾åºé¢å¤æ¥å¿ä¿¡æ¯
QUIET = "-q"
 # å é¤å·²å­å¨çè¾åºæä»¶
if os.path.exists(OUTPUT_FILENAME):
    os.unlink(OUTPUT_FILENAME) 

# åæ¢å·¥ä½ç®å½å°å½åèæ¬æå¨çç®å½
os.chdir(os.path.dirname(__file__))

# éè¿Pythonæ¨¡åæ¹å¼è°ç¨docxtplï¼ä¼ å¥æ¨¡æ¿ãæ°æ®ãè¾åºè·¯å¾ååæ°
# å¯éè¿python -m docxtpl -helpæ¥çè°ç¨å¸®å©
cmd = "python -m docxtpl %s %s %s %s %s" % (
    TEMPLATE_PATH,       # æ¨¡æ¿æä»¶è·¯å¾
    JSON_PATH,           # æ°æ®æä»¶è·¯å¾
    OUTPUT_FILENAME,    # è¾åºæä»¶è·¯å¾
    OVERWRITE,           # è¦çåæ°
    QUIET                # éé»åæ°
)

print('Executing "%s" ...' % cmd)
os.system(cmd)
if os.path.exists(OUTPUT_FILENAME):
    print("    --&gt; File %s has been generated." % OUTPUT_FILENAME)
</code></pre>
<h2 id="17-å¤å±åµå¥">1.7 å¤å±åµå¥</h2>
<p>ä»¥ä¸ç¤ºä¾å±ç¤ºäºå¦ä½éè¿æ¨¡æ¿è¯­æ³å®ç°éå±å¾ªç¯æ¸²æï¼æç»çæåå«è¿äºåµå¥æ°æ®çWordææ¡£ï¼</p>
<pre><code class="language-python"># python-docx-template/blob/master/tests/nested_for.py
from docxtpl import DocxTemplate
# data: python-docx-template/blob/master/tests/templates/nested_for_tpl.docx
tpl = DocxTemplate("templates/nested_for_tpl.docx")

context = {
    "dishes": [
        {"name": "Pizza", "ingredients": ["bread", "tomato", "ham"]},
        {
            "name": "Hamburger",
            "ingredients": ["bread", "chopped steak", "cheese"],
        },
    ],
    "authors": [
        {
            "name": "Saint-Exupery",
            "books": [
                {"title": "Le petit prince"},
                {"title": "L'aviateur"},
            ],
        },
        {
            "name": "Barjavel",
            "books": [
                {"title": "Ravage"},
                {"title": "La nuit des temps"},
            ],
        },
    ],
}

tpl.render(context)
tpl.save("output/nested_for.docx")
</code></pre>
<h2 id="18-å°åºå­ä½å¤ç">1.8 å°åºå­ä½å¤ç</h2>
<p>è¥å­ä½æ¾ç¤ºå¼å¸¸ï¼éå¸¸æ¯ç±äºå­ä½ä»ééäºç¹å®æå­åºåãè§£å³æ¹æ³æ¯å¨å­ä½ååå ä¸åºåæ è¯ååå·ï¼å¦ eastAsia:å¾®è½¯éé»ï¼ï¼ä»èæå®æå­çåºåæ¸²ææ¹å¼ãå¦æä¸æ¸æ¥åºåæ è¯ï¼ä¹å¯è§£åæ¨¡æ¿æä»¶ååæ<code>document.xml</code>ç¡®è®¤å­ä½å¯¹åºçåºåãå¸¸è§åºåæ è¯åæ¬ï¼</p>
<ul>
<li>eastAsiaï¼ç¨äºä¸äºå­ç¬¦å¦ä¸­æ</li>
<li>hAnsiï¼ç¨äºæä¸å­ç¬¦å¦è±æ</li>
<li>asciiï¼ç¨äºå¼å®¹æ§çè±æ</li>
</ul>
<p>ä»¥ä¸ä»£ç å±ç¤ºäºå¦ä½è®¾ç½®ä¸åçä¸äºå­ä½ï¼</p>
<pre><code class="language-python"># python-docx-template/blob/master/tests/richtext_eastAsia.py
from docxtpl import DocxTemplate, RichText
# data: python-docx-template/blob/master/tests/templates/richtext_eastAsia_tpl.docx
tpl = DocxTemplate("templates/richtext_eastAsia_tpl.docx")
# 2. åå»ºå¯ææ¬å¯¹è±¡ï¼åå«è®¾ç½®ä¸åçä¸äºå­ä½
# eastAsia: åç¼è¡¨ç¤ºè¯¥å­ä½è®¾ç½®ä»ä½ç¨äºä¸äºå­ç¬¦ï¼ä¸­æãæ¥æãé©æç­ï¼
rt = RichText("æµè¯TEST", font="eastAsia:Microsoft YaHei")
ch = RichText("æµè¯TEST", font="eastAsia:å¾®è½¯éé»")
sun = RichText("æµè¯TEST", font="eastAsia:SimSun")
context = {
    "example": rt,
    "Chinese": ch,
    "simsun": sun,
}

tpl.render(context)
tpl.save("output/richtext_eastAsia.docx")
</code></pre>
<h2 id="19-å¯ææ¬ä½¿ç¨">1.9 å¯ææ¬ä½¿ç¨</h2>
<p>Python-docx-templateçæ ¸å¿åè½æ¯åºäºJinja2è¯­æ³å¨æçæWordææ¡£ãå¶RichTextç±»è¿ä¸æ­¥å¢å¼ºäºçµæ´»æ§ï¼åè®¸ç´æ¥ä»¥ç¼ç¨æ¹å¼æå¥æ ¼å¼ä¸°å¯çææ¬ï¼èæ éä¸ºæ¯ç§æ ·å¼ç»ååç¬è®¾ç½®æ¨¡æ¿åéãRichTextå¯¹è±¡å¯å¨åå§åæ¶ç´æ¥ä¼ å¥ææ¬ï¼éè¿å¤æ¬¡è°ç¨addæ¹æ³å¯åå¶è¿½å ä¸åæ ¼å¼çææ¬çæ®µãæåï¼å°è¯¥å¯¹è±¡æ´ä½èµç»æ¨¡æ¿ä¸ä¸æä¸­çåéãå¨Wordæ¨¡æ¿ä¸­ï¼åªéä½¿ç¨<code>{{ rich_text_var }}</code>å¼ç¨è¯¥åéï¼å³å¯æ¸²ææåå«å¤ç§æ ¼å¼çè¿ç»­æ®µè½ã</p>
<p><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E5%AE%9E%E7%94%A8%E6%A1%88%E4%BE%8B%E8%A7%A3%E6%9E%90/imgs/img2.png" alt="" loading="lazy"></p>
<p>addæ¹æ³æ¯æå»ºRichTextå¯¹è±¡çæ ¸å¿ï¼å¶ææåæ°åç¨äºæ§å¶å½åæä½ææ·»å ææ¬çæ ¼å¼ï¼</p>
<table>
<thead>
<tr>
<th style="text-align: left">åæ°</th>
<th style="text-align: left">ç±»å</th>
<th style="text-align: left">é»è®¤å¼</th>
<th style="text-align: left">è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">text</td>
<td style="text-align: left">str</td>
<td style="text-align: left">æ </td>
<td style="text-align: left">å¯ä¸å¿éåæ°ï¼è¦è¿½å çææ¬åå®¹</td>
</tr>
<tr>
<td style="text-align: left">style</td>
<td style="text-align: left">str</td>
<td style="text-align: left">None</td>
<td style="text-align: left">åºç¨æ®µè½æ ·å¼ï¼è¿ä¼å½±åæ´ä¸ªç±RichTextå¯¹è±¡çæçæ®µè½çæ ·å¼</td>
</tr>
<tr>
<td style="text-align: left">color</td>
<td style="text-align: left">str</td>
<td style="text-align: left">None</td>
<td style="text-align: left">å­ä½é¢è²æ¯æåå­è¿å¶ï¼å¦#FF0000ï¼æWordé¢è®¾é¢è²åï¼å¦redï¼</td>
</tr>
<tr>
<td style="text-align: left">highlight</td>
<td style="text-align: left">str</td>
<td style="text-align: left">None</td>
<td style="text-align: left">ææ¬èæ¯é«äº®è²ï¼åå¼åcoloråæ°</td>
</tr>
<tr>
<td style="text-align: left">size</td>
<td style="text-align: left">int</td>
<td style="text-align: left">None</td>
<td style="text-align: left">å­ä½å¤§å°</td>
</tr>
<tr>
<td style="text-align: left">subscript</td>
<td style="text-align: left">bool</td>
<td style="text-align: left">None</td>
<td style="text-align: left">è®¾ä¸ºTrueæ¶ææ¬æ¾ç¤ºä¸ºä¸æ ï¼ä¸superscriptäºæ¥</td>
</tr>
<tr>
<td style="text-align: left">superscript</td>
<td style="text-align: left">bool</td>
<td style="text-align: left">None</td>
<td style="text-align: left">è®¾ä¸ºTrueæ¶ææ¬æ¾ç¤ºä¸ºä¸æ ï¼ä¸subscriptäºæ¥</td>
</tr>
<tr>
<td style="text-align: left">bold</td>
<td style="text-align: left">bool</td>
<td style="text-align: left">False</td>
<td style="text-align: left">è®¾ä¸ºTrueæ¶ï¼ææ¬å ç²</td>
</tr>
<tr>
<td style="text-align: left">italic</td>
<td style="text-align: left">bool</td>
<td style="text-align: left">False</td>
<td style="text-align: left">è®¾ä¸ºTrueæ¶ï¼ææ¬å¾æ</td>
</tr>
<tr>
<td style="text-align: left">underline</td>
<td style="text-align: left">bool</td>
<td style="text-align: left">False</td>
<td style="text-align: left">è®¾ä¸ºTrueæ¶ï¼ææ¬æ·»å ä¸åçº¿</td>
</tr>
<tr>
<td style="text-align: left">strike</td>
<td style="text-align: left">bool</td>
<td style="text-align: left">False</td>
<td style="text-align: left">è®¾ä¸ºTrueæ¶ï¼ææ¬æ·»å å é¤çº¿</td>
</tr>
<tr>
<td style="text-align: left">font</td>
<td style="text-align: left">str</td>
<td style="text-align: left">None</td>
<td style="text-align: left">å­ä½åç§°</td>
</tr>
<tr>
<td style="text-align: left">url_id</td>
<td style="text-align: left">str</td>
<td style="text-align: left">None</td>
<td style="text-align: left">æ·»å è¶é¾æ¥ï¼éè¦ä¼ å¥ä¸ä¸ªé¾æ¥IDï¼è¯¥IDä¸è¬éè¿ææ¡£å¯¹è±¡çbuild_url_id()æ¹æ³çæ</td>
</tr>
<tr>
<td style="text-align: left">rtl</td>
<td style="text-align: left">bool</td>
<td style="text-align: left">False</td>
<td style="text-align: left">è®¾ä¸ºTrueæ¶ï¼ææ¬ä»å³åå·¦æåï¼ä»å¯¹é¿æä¼¯è¯­ãå¸ä¼¯æ¥è¯­ç­ææ</td>
</tr>
<tr>
<td style="text-align: left">lang</td>
<td style="text-align: left">str</td>
<td style="text-align: left">None</td>
<td style="text-align: left">è®¾ç½®ææ¬çè¯­è¨ï¼ç¨äºæ¼åæ£æ¥åæ­å­</td>
</tr>
</tbody>
</table>
<blockquote>
<p>éè¦æç¤ºð©ï¼styleï¼æ®µè½æ ·å¼ï¼åæ°æ¯è¾ç¹æ®ãå®éå¸¸åªå¨ç¬¬ä¸æ¬¡è°ç¨addæ¹æ³æ¶ææï¼åç»­è°ç¨ä¸­åè®¾ç½®styleéå¸¸ä¼è¢«å¿½ç¥ã</p>
</blockquote>
<p>ä»¥ä¸æ¯ä¸æ®µä½¿ç¨ç¤ºä¾ä»£ç ï¼æé¡ºåºä»ç»<code>RichText.add()</code>æ¹æ³çåä¸ªåæ°ï¼</p>
<pre><code class="language-python">from docxtpl import DocxTemplate, RichText
import os
# 1. åå»ºæ¨¡æ¿å¯¹è±¡å¹¶åå§åRichText
doc = DocxTemplate("template.docx")
rt = RichText()

# 2. æ·»å åºç¡ææ¬ï¼å¿éåæ°ï¼
rt.add("è¿æ¯æ®éææ¬")

# 3. è®¾ç½®æ®µè½æ ·å¼ï¼å½±åæ´ä¸ªæ®µè½ï¼
rt.add("\næ é¢ææ¬", style="Heading1")

# 4. è®¾ç½®å­ä½é¢è²
rt.add(" çº¢è²æå­", color="#FF0000")
rt.add(" èè²æå­", color="blue")

# 5. è®¾ç½®èæ¯é«äº®
rt.add(" é»åºæå­", highlight="yellow")

# 6. è®¾ç½®å­ä½å¤§å°ï¼åä½ï¼ç£ï¼
rt.add(" å°å·å­", size=8)
rt.add(" å¤§å·å­", size=20)

# 7. ä¸ä¸æ è®¾ç½®
rt.add(" æ­£å¸¸æå­")
rt.add(" ä¸æ ", superscript=True)
rt.add(" ä¸æ ", subscript=True)

# 8. å­ä½æ ·å¼
rt.add(" å ç²", bold=True)
rt.add(" å¾æ", italic=True)
rt.add(" ä¸åçº¿", underline=True)
rt.add(" å é¤çº¿", strike=True)

# 9. å­ä½è®¾ç½®
rt.add(" å®ä½", font="eastAsia:SimSun")
rt.add(" å¾®è½¯éé»", font="eastAsia:Microsoft YaHei")

# 10. è¶é¾æ¥ï¼éè¦åçæé¾æ¥IDï¼
url_id = doc.build_url_id("https://www.example.com")
rt.add(" è¶é¾æ¥ææ¬", url_id=url_id)

# 11. æå­æ¹å
rt.add(" æ­£å¸¸æ¹å")
rt.add(" ä»å³åå·¦æå­", rtl=True) # ä¸­æè®¾ç½®æ ææ

# 12. è¯­è¨è®¾ç½®
rt.add(" English text", lang="en-US")
rt.add(" ä¸­æææ¬", lang="zh-CN")

context = {
    'rich_text_var': rt
}
doc.render(context)
os.makedirs('output',exist_ok=True)
doc.save("output/generated_document.docx")
</code></pre>
<p>å¨æ¨¡æ¿ä¸­åªéç®åå¼ç¨ï¼</p>
<pre><code>{{ rich_text_var }}
</code></pre>
<h2 id="110-éè¯¯ç®¡ç">1.10 éè¯¯ç®¡ç</h2>
<p>TemplateErrorç±»æ¯Jinja2æ¨¡æ¿å¼æä¸­æææ¨¡æ¿ç¸å³å¼å¸¸çåºç±»ï¼å¨python-docx-templateä¸­ä¸é¨ç¨äºæè·æ¨¡æ¿æ¸²æè¿ç¨ä¸­åºç°çåç±»éè¯¯ãå½ä½¿ç¨<code>tpl.render()</code>æ¸²æ Word æ¨¡æ¿æ¶ï¼ä»¥ä¸æåµä¼æåº<code>TemplateError</code>å¼å¸¸ï¼</p>
<ul>
<li>æ¨¡æ¿ä¸­å¼ç¨äºæªä¼ å¥çåéï¼å¦æ¨¡æ¿åäº<code>{{ name }}</code>ï¼ä½<code>render</code>åªä¼ äº<code>test_variable</code>ï¼ï¼</li>
<li>æ¨¡æ¿ä¸­çJinja2è¯­æ³éè¯¯ï¼å¦ç¼ºå°é­åç<code>{% endif %}</code>ãåéå¼ç¨æ ¼å¼éè¯¯ï¼ï¼</li>
<li>æ¨¡æ¿ä¸­ä½¿ç¨äºä¸å­å¨çè¿æ»¤å¨/å½æ°ï¼å¦<code>{{ test_variable | xxx }}</code>ï¼<code>xxx</code>ä¸æ¯ Jinja2 åç½®è¿æ»¤å¨ï¼ã</li>
</ul>
<p>ä»¥ä¸ä»£ç å±ç¤ºäºå¦ä½æµæè·Wordæ¨¡æ¿æ¸²ææ¶çTemplateErrorå¼å¸¸ï¼å¹¶æå°è¯¦ç»çéè¯¯ä¿¡æ¯ï¼</p>
<pre><code class="language-python">from docxtpl import DocxTemplate
from jinja2.exceptions import TemplateError

print("=" * 50)
print("æ­£å¨çææµè¯ç¨çæ¨¡æ¿éè¯¯")
print("." * 50)

try:
    tpl = DocxTemplate("templates/template_error_tpl.docx")
    # å¦ææ¨¡æ¿ä¸­å­å¨è¯­æ³éè¯¯æåéç¼ºå¤±ï¼ä¼è§¦åTemplateErrorå¼å¸¸
    tpl.render({"test_variable": "æµè¯åéå¼"})
# æè·æ¨¡æ¿æ¸²æè¿ç¨ä¸­åºç°çææTemplateErrorå¼å¸¸
except TemplateError as the_error:
    # æå°éè¯¯çåºæ¬æè¿°ä¿¡æ¯
    print(f"æ¨¡æ¿æ¸²æéè¯¯ï¼{str(the_error)}")
    # æ£æ¥å¼å¸¸å¯¹è±¡æ¯å¦åå«docx_contextå±æ§
    if hasattr(the_error, "docx_context"):
        # æå°ä¸ä¸æä¿¡æ¯çæ é¢
        print("éè¯¯ä¸ä¸æè¯¦æï¼")
        # éåå¹¶æå°éè¯¯ä¸ä¸æçæ¯ä¸è¡åå®¹
        for line in the_error.docx_context:
            print(line)
# ç¡®ä¿tplåéå­å¨æ¶åæ§è¡ä¿å­æä½
if 'tpl' in locals():
    # å°æ¸²æåçææ¡£ä¿å­å°æå®è·¯å¾
    tpl.save("output/template_error.docx")
    print(f"ææ¡£å·²ä¿å­è³ï¼output/template_error.docx")
print("." * 50)
print(" æ¨¡æ¿éè¯¯æµè¯å®æ ")
print("=" * 50)
</code></pre>
<h1 id="2-åè">2 åè</h1>
<ul>
<li><a href="https://www.cnblogs.com/luohenyueji/p/19503461" target="_blank">python-docx-templateæ¨¡æ¿åWordææ¡£çææå</a></li>
<li><a href="https://github.com/elapouya/python-docx-template" target="_blank" rel="noopener nofollow">python-docx-template</a></li>
<li><a href="https://docxtpl.readthedocs.io/" target="_blank" rel="noopener nofollow">python-docx-template doc</a></li>
</ul>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/luohenyueji/" target="_blank">è½ççå¯å</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/luohenyueji/p/19556736" target="_blank">https://www.cnblogs.com/luohenyueji/p/19556736</a></p>

<div style="text-align:center">
    <img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/wechat/content/%E5%8A%A0%E6%B2%B9%E9%B8%AD.gif">
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-31 09:17">2026-01-31 09:17</span>&nbsp;
<a href="https://www.cnblogs.com/luohenyueji">è½ççå¯å</a>&nbsp;
éè¯»(<span id="post_view_count">7</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19556736);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19556736', targetLink: 'https://www.cnblogs.com/luohenyueji/p/19556736', title: '[python] python-docx-templateå®ç¨æ¡ä¾è§£æ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ç¨ PHP ç©è½¬å¾çï¼ç¼©æ¾ãè£åªãæ°´å°ãæ»¤éä¸ç½æå°½ ]]></title>
    <link>https://www.cnblogs.com/catchadmin/p/19556570</link>
    <guid>42b32b5fee7f1303931c32d4be12da5e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/catchadmin/p/19556570" title="åå¸äº 2026-01-31 08:40">
    <span role="heading" aria-level="2">ç¨ PHP ç©è½¬å¾çï¼ç¼©æ¾ãè£åªãæ°´å°ãæ»¤éä¸ç½æå°½</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ç¨-php-ç©è½¬å¾çç¼©æ¾è£åªæ°´å°æ»¤éä¸ç½æå°½">ç¨ PHP ç©è½¬å¾çï¼ç¼©æ¾ãè£åªãæ°´å°ãæ»¤éä¸ç½æå°½</h1>
<p>æå° PHP åå¾åï¼ä½ ä¼æ³å°ä»ä¹ï¼å¤§æ¦æ¯ä¸ä¼ ä¸å¼ å¾çå°ç½ç«ï¼ç¶åæ¶å·¥ãä½ PHP å¯ä¸åªæ¯ä¸ªä¸ä¼ å·¥å·ââå®å¨å¾åå¤çæ¹é¢èçä¸å°æ¬äºã</p>
<p>å¾çå¤ªå¤§æ¾ä¸ä¸ç½é¡µï¼éè¦è£æèæ¯éé£ä¸ªä¹±å¥çè·¯äººï¼PHP é½è½æå®ãæ è®ºæ¯ç¼©æ¾ãè£åªãå æ°´å°ï¼è¿æ¯å Instagram é£æ ·å æ»¤éï¼PHP é½è½èä»»ã</p>
<p>è¿ç¯æç« ä¼å¸¦ä½ äºè§£ PHP å¾åå¤ççæ´å¤ç©æ³ãæä»¬ä¼æ·±å¥ GD åºï¼é¡ºä¾¿èè Imagickã</p>
<h2 id="gd-å-imagickä¸¤å¤§å¾åå¤çåº">GD å Imagickï¼ä¸¤å¤§å¾åå¤çåº</h2>
<p>å¨å¨æä¹åï¼åä»ç»ä¸¤ä¸ªæ ¸å¿å·¥å·ï¼GD åºå Imagickã</p>
<h3 id="gd-åºç¨³å®å¯é çèä¼è®¡">GD åºï¼ç¨³å®å¯é çèä¼è®¡</h3>
<p>PHP åç½®ç GD åºæ¯ä¸ªç»å¸éæ©ï¼éåå¤çåºç¡çå¾åæä½ï¼ç¼©æ¾ãè£åªãæ·»å æå­ãå®é»è®¤å°±å¨ PHP éï¼ä¸ç¨é¢å¤å®è£ãè½ç¶ä¸æ¯æç«çï¼ä½å¤ç¨ãç¨³å®ã</p>
<h3 id="imagickåè½æ´å¼ºçæ°éæ©">Imagickï¼åè½æ´å¼ºçæ°éæ©</h3>
<p>Imagick æ¯å¦ä¸ä¸ªå¾åå¤çåºï¼åè½æ´å¼ºå¤§ãå®æé¿å¤çç¢éå¾ãåºç¨ç¹æãæ¯ææ´å¤æ ¼å¼ãå¦æä½ éè¦åå¤æçå¾åå¤çï¼Imagick æ¯æ´å¥½çéæ©ãä¸è¿æ¬æä¸»è¦ç¨ GD åºæ¥æ¼ç¤ºã</p>
<h2 id="åºç¡å¾åä¸ä¼ ">åºç¡ï¼å¾åä¸ä¼ </h2>
<p>å¨å¤çå¾åä¹åï¼å¾åæå®ä¸ä¼ å°æå¡å¨ãä¸é¢æ¯ä¸ä¸ªåºç¡çä¸ä¼ èæ¬ï¼</p>
<pre><code class="language-php">if ($_SERVER['REQUEST_METHOD'] == 'POST' &amp;&amp; isset($_FILES['image'])) {
    $image = $_FILES['image'];
    $uploadDir = 'uploads/';
    $uploadFile = $uploadDir . basename($image['name']);
    
    if (move_uploaded_file($image['tmp_name'], $uploadFile)) {
        echo 'Image uploaded successfully!';
    } else {
        echo 'Failed to upload image.';
    }
}
</code></pre>
<p>è¿æ®µä»£ç æä¸ä¼ çå¾çç§»å¨å°æå®ç®å½ï¼æ¥ä¸æ¥å°±å¯ä»¥å¼å§å¤çäºã</p>
<h2 id="ä½¿ç¨-gd-åºå¤çå¾å">ä½¿ç¨ GD åºå¤çå¾å</h2>
<p>ä¸ä¼ æå®äºï¼ç°å¨è¿å¥æ­£é¢ââå¾åå¤çã</p>
<h3 id="ç¼©æ¾å¾å">ç¼©æ¾å¾å</h3>
<p>å¾çå¤ªå¤§ä¼ææ¢é¡µé¢å è½½éåº¦ãç¨ GD åºå¯ä»¥è½»æ¾ç¼©æ¾ï¼</p>
<pre><code class="language-php">function resizeImage($source, $target, $width, $height) {
    list($originalWidth, $originalHeight) = getimagesize($source);
    $image = imagecreatefromjpeg($source);
    
    $newImage = imagecreatetruecolor($width, $height);
    imagecopyresized($newImage, $image, 0, 0, 0, 0, $width, $height, $originalWidth, $originalHeight);
    
    imagejpeg($newImage, $target);
    imagedestroy($image);
    imagedestroy($newImage);
}
</code></pre>
<p>è¿ä¸ªå½æ°æå¾åç¼©æ¾å°æå®çå®½é«ï¼éåå¨å±ç¤ºåè°æ´å¾çå°ºå¯¸ã</p>
<h3 id="è£åªå¾å">è£åªå¾å</h3>
<p>éè¦è£æå¾ççæä¸ªåºåï¼ç¨ <code>imagecrop()</code> å½æ°ï¼</p>
<pre><code class="language-php">function cropImage($source, $target, $x, $y, $width, $height) {
    list($originalWidth, $originalHeight) = getimagesize($source);
    $image = imagecreatefromjpeg($source);
    
    $croppedImage = imagecrop($image, ['x' =&gt; $x, 'y' =&gt; $y, 'width' =&gt; $width, 'height' =&gt; $height]);
    
    if ($croppedImage !== FALSE) {
        imagejpeg($croppedImage, $target);
        imagedestroy($croppedImage);
    }
    imagedestroy($image);
}
</code></pre>
<p>æå®è£åªåºåçåæ åå°ºå¯¸ï¼PHP ä¼å¸®ä½ å®æå©ä¸çå·¥ä½ã</p>
<h3 id="æ·»å æ°´å°">æ·»å æ°´å°</h3>
<p>å¦æä½ è¿è¥ä¸ä¸ªåè®¸ç¨æ·ä¸ä¼ å¾ççç½ç«ï¼ç»å¾çå æ°´å°å¯ä»¥é²æ­¢çç¨ãä¸é¢æ¯æ·»å æ°´å°çæ¹æ³ï¼</p>
<pre><code class="language-php">function addWatermark($imagePath, $watermarkPath, $targetPath) {
    $image = imagecreatefromjpeg($imagePath);
    $watermark = imagecreatefrompng($watermarkPath);
    
    $imageWidth = imagesx($image);
    $imageHeight = imagesy($image);
    $watermarkWidth = imagesx($watermark);
    $watermarkHeight = imagesy($watermark);
    
    // æ°´å°æ¾å¨å³ä¸è§
    $destX = $imageWidth - $watermarkWidth - 10;
    $destY = $imageHeight - $watermarkHeight - 10;
    
    imagecopy($image, $watermark, $destX, $destY, 0, 0, $watermarkWidth, $watermarkHeight);
    
    imagejpeg($image, $targetPath);
    imagedestroy($image);
    imagedestroy($watermark);
}
</code></pre>
<p>è¿ä¸ªå½æ°æ PNG æ ¼å¼çæ°´å°å å å°å¾çå³ä¸è§ã</p>
<h2 id="è¿é¶æ»¤éåç¼©ç¥å¾">è¿é¶ï¼æ»¤éåç¼©ç¥å¾</h2>
<p>ææ¡äºåºç¡æä½ï¼æ¥ççæ´é«çº§çç©æ³ã</p>
<h3 id="åºç¨æ»¤é">åºç¨æ»¤é</h3>
<p>GD åºæ¯æç»å¾åæ·»å æ»¤éãæ¯å¦æå¾çè½¬æç°åº¦ï¼</p>
<pre><code class="language-php">function applyGrayscale($imagePath, $targetPath) {
    $image = imagecreatefromjpeg($imagePath);
    
    imagefilter($image, IMG_FILTER_GRAYSCALE);
    
    imagejpeg($image, $targetPath);
    imagedestroy($image);
}
</code></pre>
<p>é¤äºç°åº¦ï¼è¿å¯ä»¥è°æ´äº®åº¦ãå¯¹æ¯åº¦ï¼çè³ååç´ åææã</p>
<h3 id="çæç¼©ç¥å¾">çæç¼©ç¥å¾</h3>
<p>å¨å¾çåºæåååè¡¨ä¸­ï¼ç¼©ç¥å¾æ¯å¿ä¸å¯å°çãä¸é¢æ¯çæç¼©ç¥å¾çå½æ°ï¼</p>
<pre><code class="language-php">function createThumbnail($source, $target, $thumbWidth) {
    list($originalWidth, $originalHeight) = getimagesize($source);
    $thumbHeight = ($thumbWidth / $originalWidth) * $originalHeight;
    
    $image = imagecreatefromjpeg($source);
    $thumb = imagecreatetruecolor($thumbWidth, $thumbHeight);
    
    imagecopyresized($thumb, $image, 0, 0, 0, 0, $thumbWidth, $thumbHeight, $originalWidth, $originalHeight);
    
    imagejpeg($thumb, $target);
    imagedestroy($image);
    imagedestroy($thumb);
}
</code></pre>
<p>è¿ä¸ªå½æ°ææå®å®½åº¦çæç¼©ç¥å¾ï¼åæ¶ä¿æåå¾çå®½é«æ¯ã</p>
<h2 id="å¸¸è§é®é¢ææ¥">å¸¸è§é®é¢ææ¥</h2>
<p>å¾åå¤çææ¶ä¼éå°ä¸äºé®é¢ï¼è¿éååºå ä¸ªå¸¸è§çã</p>
<h3 id="å¾åæå">å¾åæå</h3>
<p>å¦æ PHP æ æ³æ­£ç¡®å¤çå¾åæä»¶ï¼å¯è½ä¼å¯¼è´æåãå¤çååç¨ <code>getimagesize()</code> éªè¯æä»¶æ¯å¦ä¸ºææå¾åï¼åæ¶ç¡®è®¤æä»¶æ ¼å¼ï¼JPEGãPNGãGIFï¼ã</p>
<h3 id="åå­ä¸è¶³">åå­ä¸è¶³</h3>
<p>å¤çå¤§å¾çæ¶å¯è½ä¼éå°åå­éå¶ãå¯ä»¥å¨ <code>php.ini</code> ä¸­è°æ´ <code>memory_limit</code>ãå¦ææ¯å±äº«ä¸»æºï¼å¯è½éè¦èç³»æå¡åæåéé¢ã</p>
<h2 id="æ»ç»">æ»ç»</h2>
<p>PHP çå¾åå¤çè½åè¿ä¸æ­¢ä¸ä¼ é£ä¹ç®åãåå© GD å Imagickï¼ä½ å¯ä»¥å®æç¼©æ¾ãè£åªãå æ°´å°ãåºç¨æ»¤éç­æä½ãæ è®ºæ¯æ­å»ºå¾çåºãå¤çç¨æ·ä¸ä¼ çåå®¹ï¼è¿æ¯ä¼åç½ç«å¾çï¼è¿äºæè½é½è½æ´¾ä¸ç¨åºã<br>
<a href="https://catchadmin.com/post/2026-01/openclaw-installed" target="_blank" rel="noopener nofollow">ç¨ PHP ç©è½¬å¾çï¼ç¼©æ¾ãè£åªãæ°´å°ãæ»¤éä¸ç½æå°½</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-31 08:41">2026-01-31 08:40</span>&nbsp;
<a href="https://www.cnblogs.com/catchadmin">JaguarJack</a>&nbsp;
éè¯»(<span id="post_view_count">21</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19556570);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19556570', targetLink: 'https://www.cnblogs.com/catchadmin/p/19556570', title: 'ç¨ PHP ç©è½¬å¾çï¼ç¼©æ¾ãè£åªãæ°´å°ãæ»¤éä¸ç½æå°½' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ CUDAæ¯å¦ä½è°åº¦Thread Blockçï¼ ]]></title>
    <link>https://www.cnblogs.com/DemoFX/p/19556140</link>
    <guid>3ee394b0098d093b40f864db148b2b59</guid>
    <description>
    <![CDATA[ 
	<div class="postTitle">
		<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/DemoFX/p/19556140" title="åå¸äº 2026-01-31 00:25">
    <span role="heading" aria-level="2">CUDAæ¯å¦ä½è°åº¦Thread Blockçï¼</span>
    

</a>

	</div>
	    <div id="cnblogs_post_description" style="display: none">
        
        cuda
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æè¿å¨çCUDA,è®²å°C++æ¯æä¹è°ç¨CUDAå½æ°è¿èå è½½è¿GPUåæ ¸è¿è¡è¿è¡çï¼ç½ä¸åºæ¬ä¸å¨é¨é½æ¯ä¸æ ·çèµæï¼åªè®²Gridåå«å¾å¤Thread block,æ¯ä¸ªThread blockåªè½å è½½å°ä¸ä¸ªSMä¸­è¿è¡å¹¶è¡è¿ç®ï¼ç¶åå°±æ¯çº¿ç¨åç±»å°warpä¸­è¿è¡åç»è®¡ç®ï¼ç½ä¸å¤§å¤è®²çæ¯è¿äºï¼å·ä½thread blockæä¹åéå°SMå°±æ²¡è®²æ¸æ¥ï¼ä»å¤©æ¥ç¹èªå·±çåæã</p>
<p><img alt="block1" width="298" height="153" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730441/202601/3730441-20260131002139596-1843603281.jpg" class="lazyload"></p>
<p>æ¾å¡çç¡¬ä»¶éç½®ï¼åªæ3ä¸ªSMååï¼æ»å±åªæ12ä¸ªç¡¬ä»¶warpï¼ä½æ¯è¿è¡è½¯ä»¶è°è¯åç°ï¼è³å°æä¸ç¾å¤ä¸ªè½¯ä»¶warpåæ¶è¿è¡ï¼å¦ææç§æ¯ä¸ªThread Blockåªéç½®å°ä¸ä¸ªSMæ¥è®¡ç®ï¼æ»å±åºè¯¥åªæ12ä¸ªè½¯ä»¶warpæå¯¹ï¼å¤åºæ¥çwarpåªæ¥çï¼å¶å®è¿åªæ¯ä¸ç§è½¯ä»¶æ¨¡æå®ç°çâå¹¶è¡"è®¡ç®ï¼ç¨æ¯ç¡¬ä»¶æ°ç®å¤çè½¯ä»¶warpæé«ç¡¬ä»¶çè®¡ç®ååéï¼å¦ä¸æ¹é¢ï¼ä¸ä¸ªSMå¯ä»¥åæ¶æ¯æå¤ä¸ªThread blockçè¿è¡ï¼è¿æ¯å¾å¤ææ¡£é½æ²¡æä»ç»çåå®¹ï¼ä¹æ¯æ¬æçéç¹ã</p>
<p><img alt="code" width="419" height="291" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730441/202601/3730441-20260131002215050-59211704.jpg" class="lazyload"></p>
<p>é¦åçä»£ç ï¼ä»£ç å¾ç®åï¼åªæ¯ä¸ªæ®éçkernelå½æ°ãä¸é¢çåæç¨å°Cuda Toolkitéé¢èªå¸¦çprofileå·¥å·nvvp.<br>
é¦åå¨hostç«¯è°ç¨ä¸è¿°ä»£ç ï¼<br>
mykernelfunc &lt;&lt;&lt; 2, 1&gt;&gt;&gt; ();ç¨nvvpæ¥çå¦ä¸å¾æç¤ºï¼</p>
<p><img alt="1" width="401" height="201" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730441/202601/3730441-20260131002236466-73501573.jpg" class="lazyload"></p>
<p>ä¸å±å°±3ä¸ªSM,ä¸¤ä¸ªThread blockç¨äºä¸¤ä¸ªï¼è¯´æThread blockå¨åéSMçæ¶åæ¯é¦åæéç©ºä½çSMæ¥è¿è¡ï¼å¹¶æ²¡æä¸¤ä¸ªThread blockè¿è¡å°ä¸ä¸ªSMçæåµã<br>
mykernelfunc &lt;&lt;&lt; 4, 1&gt;&gt;&gt; ();è¿ä¸ªæ4ä¸ªThread blockï¼æ¾ç¶3ä¸ªSMä¸å¤åï¼è¯å®å¤åºæ¥ä¸ä¸ªã</p>
<p><img alt="2" width="418" height="200" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730441/202601/3730441-20260131002300722-875833623.jpg" class="lazyload"><br>
<img alt="3" width="424" height="94" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730441/202601/3730441-20260131002321092-1920457245.jpg" class="lazyload"></p>
<p>ä»ä¸å¾è½çåºæ¥ï¼ä¸ä¸ªSMå·²ç»å¨é¨è¢«å ç¨äºï¼å¹³åä¸æ¥æ¯ä¸ªSMæ1.33ä¸ªwarp,è¯´æå¤åºæ¥çé£ä¸ªwarp,å·²ç»è¢«åéè¿æä¸ªSMéé¢ã<br>
è¿ä¸ªå4ä¸ªthread blockåå°3ä¸ªSMï¼ä¸å¥½åï¼æä»¬æ¢ä¸ªï¼<br>
mykernelfunc &lt;&lt;&lt; 96, 64&gt;&gt;&gt; ();</p>
<p><img alt="6" width="420" height="99" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730441/202601/3730441-20260131002403012-1270887631.jpg" class="lazyload"></p>
<p>è¿éåäº96ä¸ªthread block,åå°3ä¸ªSMéï¼æ¯ä¸ä¸ªå¯ä»¥åå°32ä¸ªï¼64è¡¨ç¤º64ä¸ªçº¿ç¨ï¼è¿æ ·ä¸å±æ¯64ä¸ªwarp,å·²ç»è¾¾å°ç¡¬ä»¶æéäºï¼çè®ºä¸è¾¾å°100%çç¡¬ä»¶å ç¨çï¼å®éæµè¯è¾¾å°99.5%çOccupancy.<br>
ä½æ¯å¦æä½¿ç¨äºshared memory,æåµå°±ä¼æå¾å¤§çä¸åã</p>
<p><img alt="7" width="425" height="171" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730441/202601/3730441-20260131002432159-1807947204.jpg" class="lazyload"></p>
<p>è¿éåéäº24kçå±äº«åå­ï¼ä½å®éçwarpå°±éå°äº24ä¸ªã</p>
<p><img alt="10" width="800" height="430" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730441/202601/3730441-20260131002502807-1258483125.jpg" class="lazyload"></p>
<p>ä»ç»çä¸é¢å³äºGPU utilityçè¯´æï¼è¿éå¶å®æ¯å³é®æå¨ï¼kernelä»£ç ä½¿ç¨äº24kçshared memory,èæ¯ä¸ªSMçæå¤§shared memoryæ¯96k,æ­£å¥½æ¯4åï¼èè¿è¡çThread blockæ°ç®ä¹æ¯4ä¸ªï¼è¿è¯´æä»ä¹ï¼è¿è¯´æï¼Thread blockå¨åéSMçæ¶åï¼é¦ååèkernelä¸­ä½¿ç¨çshared memoryçå¤§å°ï¼æ´ä¸ªSMçshared memoryè½è£ä¸å ä¸ªkernelçshared memoryå°±ä½¿ç¨å ä¸ªThread block,è¿å¶å®æ¯make senseçï¼å ä¸ºkernelå ç¨çshared memoryå±äºç¡¬ä»¶è¦æ±ï¼ä¸æ»¡è¶³èªç¶æ æ³è¿è¡ã</p>


</div>
<div class="clear"></div>

	<div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-31 00:26">2026-01-31 00:25</span>&nbsp;
<a href="https://www.cnblogs.com/DemoFX">demofx</a>&nbsp;
éè¯»(<span id="post_view_count">77</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19556140);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19556140', targetLink: 'https://www.cnblogs.com/DemoFX/p/19556140', title: 'CUDAæ¯å¦ä½è°åº¦Thread Blockçï¼' })">ä¸¾æ¥</a>
</div>
 ]]>
    </description>
    </item>
        </channel>
        </rss>