<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-13T08:37:43.872Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ Volcano v1.14 éç£åå¸ï¼è¿å AI ç»ä¸è°åº¦æ°çºªå ]]></title>
    <link>https://www.cnblogs.com/huaweiyun/p/19612682</link>
    <guid>9fd7af0fb39f5bbf00537e5d0adb6977</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huaweiyun/p/19612682" title="åå¸äº 2026-02-13 16:35">
    <span role="heading" aria-level="2">Volcano v1.14 éç£åå¸ï¼è¿å AI ç»ä¸è°åº¦æ°çºªå</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>æ¬æåäº«èªåä¸ºäºç¤¾åºã<a href="https://bbs.huaweicloud.com/blogs/474065?utm_source=zhihu&amp;utm_medium=bbs-ex&amp;utm_campaign=other&amp;utm_content=content" target="_blank" rel="noopener nofollow">Volcano v1.14 éç£åå¸ï¼è¿å AI ç»ä¸è°åº¦æ°çºªå</a>ã</p>
<p>åäº¬æ¶é´2026å¹´1æï¼<strong>Volcano</strong>[1] v1.14 æ­£å¼åå¸ãéç AI ä¸å¡å½¢æä»åä¸çç¦»çº¿è®­ç»åå¨çº¿æ¨çãAgent æºè½ä½ç­å¤åååºæ¯å»¶ä¼¸ï¼è°åº¦ç³»ç»é¢ä¸´çåææªæçææã<strong>v1.14</strong>[2] éè¿æ¶æçº§çåæ°ï¼å¨ä¿æå¤§è§æ¨¡æ¹éè®¡ç®ä¼å¿çåæ¶ï¼è¡¥é½äºå¯¹å»¶è¿ææåä¸å¡çè°åº¦ç­æ¿ï¼åç <strong>âAIè®­æ¨ãRLãAgentå¨åºæ¯ç»ä¸è°åº¦å¹³å°â</strong> çç®æ è¿åºäºåå®ä¸æ­¥ã</p>
<p data-tool="mdniceç¼è¾å¨"><img alt="download" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2030258/202602/2030258-20260213163013597-24056382.png" class="lazyload"></p>
<h1 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>çæ¬äº®ç¹</strong></span></span></h1>
<p data-tool="mdniceç¼è¾å¨">v1.14.0 çæ¬å¸¦æ¥ä»¥ä¸éç£æ´æ°ï¼</p>
<p data-tool="mdniceç¼è¾å¨"><strong>ç»ä¸è°åº¦å¹³å°æ¶æ</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>å¤è°åº¦å¨æ¶æåçº§ï¼å¨æèç¹åçæºå¶ (Alpha)</li>
<li>AI Agent å·¥ä½è´è½½æéè°åº¦è½å (Alpha)</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>ç½ç»æææç¥è°åº¦å¢å¼º</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>HyperNode çº§ Binpack ç­ç¥</li>
<li>SubGroup çº§ç²¾ç»åæææç¥</li>
<li>PodGroup ä¸ SubGroup å¤å±çº§ Gang Scheduling</li>
<li>Volcano Job ååºæ¯æ</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>æ··é¨è½åå¢å¼º</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>å¨é¢æ¯æéç¨æä½ç³»ç»ï¼UbuntuãCentOS ç­ï¼</li>
<li>Cgroup V2 å¨é¢éé</li>
<li>CPU å¨æåå¶</li>
<li>åºäº Cgroup V2 çåå­ QoS</li>
<li>æ¯æ CPU Burst</li>
<li>æ¯æ systemd driver èªå¨æ£æµ</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>å¼æç¡¬ä»¶æ¯æ</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>æè¾ vNPU è°åº¦ï¼æ¯æ MindCluster å HAMi æ¨¡å¼ï¼</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>Volcano Global å¢å¼º</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>HyperJob å¤éç¾¤ä½ä¸èªå¨æå</li>
<li>æ°æ®æç¥å¤éç¾¤è°åº¦</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>Volcano Dashboard å¢å¼º</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>PodGroup å¨æ¯å¯è§å</li>
<li>Job / Queue å¨çå½å¨æç®¡ç</li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>å¤è°åº¦å¨æ¶æåçº§ï¼å¨æèç¹åçæºå¶ (Alpha)</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">éç Volcano æ¿è½½çå·¥ä½è´è½½ç±»åæ¥çä¸°å¯ãè§æ¨¡æç»­æ©å¤§ï¼åä¸è°åº¦å¨æ¶æéæ¸æ¾é²ç¶é¢ãæ¹éè®­ç»ãAI Agentãå¾®æå¡ç­ä¸åç±»åçå·¥ä½è´è½½ï¼å¯¹è°åº¦æ¶å»¶ãèµæºå©ç¨æ¨¡å¼çè¯æ±åä¸ç¸åãåè°åº¦å¨é¾ä»¥å¼é¡¾ï¼èéæèµæºåååä¼é æå©ç¨çä½ä¸ã<br>
æ°å¼å¥ç Sharding Controller æå»ºäºä¸å¥å¯æ©å±çå¤è°åº¦å¨æ¶æï¼è½å¤æ ¹æ®éç¾¤å®æ¶ç¶æï¼ä¸ºæ¯ä¸ªè°åº¦å¨å¨æè®¡ç®åéèç¹æ± ãä¸ä¼ ç»çéæååºä¸åï¼Sharding Controller éç¨å¨æè®¡ç®çæ¹å¼ååèµæºï¼èéå¼ºå¶ç¡¬éç¦»ãè¿ç§çµæ´»æºå¶è®© Volcano çæ­£æä¸º"ä¸ä¸ªå¹³å°è°åº¦ææè´è½½"çç»ä¸è°åº¦å¹³å°ï¼åæ¶ä¿æé«ååãä½æ¶å»¶ã<br>
</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ ¸å¿è½å</strong>ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>å¨æåçç­ç¥</strong>ï¼æ¯æå¤ç§ç­ç¥æ¥è®¡ç®å¨æåéèç¹æ± ãå½åçæ¬çåæ¯æåºäº CPU å©ç¨ççåçç­ç¥ï¼å¹¶éç¨äºå¯æ©å±çæ¶æè®¾è®¡ï¼ä»¥ä¾¿æªæ¥è½»æ¾éææ´å¤åçç®æ³ã</li>
<li><strong>èç¹æ± åç®¡ç</strong>ï¼å¼å¥ NodeShard CRDï¼ä¸ºç¹å®è°åº¦å¨ç®¡çä¸å±çå¨æåéèç¹æ± ã</li>
<li><strong>æ¯æå¤§è§æ¨¡éç¾¤</strong>ï¼éè¿å¨å¤ä¸ªè°åº¦å¨ä¹é´çµæ´»åéè´è½½ï¼å¤©ç¶ééå¤§è§æ¨¡éç¾¤åºæ¯ã</li>
<li><strong>å¤è°åº¦å¨åå</strong>ï¼æ¯æå¤ç§è°åº¦å¨ç»åçæ ç¼åä½ãæ è®ºæ¯é¨ç½²å¤ä¸ª Batch Scheduler è¿è¡è´è½½åæï¼è¿æ¯æ··åé¨ç½² Agent Scheduler ä¸ Batch Scheduler ä»¥åºå¯¹ä¸åä¸å¡éæ±ï¼é½è½çµæ´»ééã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">éç½®ç¤ºä¾ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;"># Sharding Controller å¯å¨åæ°
--scheduler-configs="volcano:volcano:0.0:0.6:false:2:100,agent-scheduler:agent:0.7:1.0:true:2:100"
--shard-sync-period=60s
--enable-node-event-trigger=true

# åæ°æ ¼å¼: name:type:min_util:max_util:prefer_warmup:min_nodes:max_nodes</pre>
</div>
<p data-tool="mdniceç¼è¾å¨">ç¸å³ PRï¼https://github.com/volcano-sh/volcano/pull/4777<br>
è®¾è®¡ææ¡£ï¼<strong>Sharding Controller Design</strong>[3]<br>
æè°¢ç¤¾åºå¼åèï¼@ssfffss, @Haoran, @qi-min</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>AI Agent å·¥ä½è´è½½æéè°åº¦ (Alpha)</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">AI Agent ç±»ä¸å¡å¯¹æ¶å»¶æåº¦ææï¼ä»»å¡åå»ºé¢ç¹ä¸çå½å¨æç­ï¼å¯¹è°åº¦å¨çååºéåº¦åååéæåºäºä¸¥èè¦æ±ãåç Volcano Batch Scheduler ä¸ä¸ºæ¹éè®¡ç®è®¾è®¡ï¼æåºå®å¨æå¤ç Podï¼é¾ä»¥æ»¡è¶³ Agent åºæ¯çæ¯«ç§çº§ååºéæ±ã<br>
ä¸ºæé å¼å®¹æ¹éè®¡ç®ä¸å»¶è¿ææåä¸å¡çç»ä¸è°åº¦å¹³å°ï¼v1.14 å¼å¥äºä¸ç¨ç <strong>Agent Scheduler</strong>ãå®éè¿ Sharding Controller ä¸æ¹éè°åº¦å¨ååå·¥ä½ï¼åå¸å¶èåæ ç¼éåï¼çæ­£å®ç°"ä¸ä¸ªå¹³å°ãå¤ç§è´è½½"ã<br>
</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ ¸å¿è½å</strong>ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>æéè°åº¦éé</strong>ï¼ä¸ä¸ºå»¶è¿ææåè´è½½ï¼å¦ AI Agentï¼æé çç¬ç«è°åº¦å¨ï¼æä¾æè´ååºéåº¦ã</li>
<li><strong>å¤ Worker å¹¶è¡å¤ç</strong>ï¼éç¨å¤ Worker å¹¶åæ¶è´¹è°åº¦éåçæ¶æï¼å¤§å¹æåè°åº¦ååéã</li>
<li><strong>ä¹è§å¹¶åæ§å¶</strong>ï¼å¼å¥ Conflict-Aware Binder æºå¶ï¼å¨å®éç»å®åé¢åè§£å³å²çªï¼åå°æ ææä½ã</li>
<li><strong>å¢å¼ºåè°åº¦éå</strong>ï¼ä¼åéåæºå¶ï¼æ¯æç´§æ¥ä»»å¡éè¯ï¼ç¡®ä¿å³é®ä»»å¡ä¸é»å¡ã</li>
<li><strong>ç»ä¸å¹³å°èå</strong>ï¼éè¿ Sharding Controller ä¸æ¹éè°åº¦å¨æ ç¼åä½ï¼å±äº«éç¾¤èµæºã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">ç¸å³ PRï¼</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4804,<br>
https://github.com/volcano-sh/volcano/pull/4801,<br>
https://github.com/volcano-sh/volcano/pull/4805<br>
è®¾è®¡ææ¡£ï¼<strong>Agent Scheduler Design</strong>[4]<br>
æè°¢ç¤¾åºå¼åèï¼@qi-min, @JesseStutler, @handan-yxh</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>ç½ç»æææç¥è°åº¦å¢å¼º</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">Volcano v1.14.0 å¯¹ç½ç»æææç¥è°åº¦è¿è¡äºè¿ä¸æ­¥å¢å¼ºï¼æ»¡è¶³åå¸å¼å·¥ä½è´è½½ï¼åæ¬ LLM è®­ç»ãæ¨çãHPC åå¶ä»ç½ç»å¯éååºç¨ï¼æ¥çå¢é¿çéæ±ã<br>
</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ ¸å¿å¢å¼º</strong>ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>SubGroup çº§ç²¾ç»åæææç¥</strong>ï¼æ¯æå¨ SubGroup / Partition ç²åº¦è®¾ç½®ç½ç»ææçº¦æï¼è°åº¦é¢ç²åº¦æ´ç²¾ç»ã</li>
<li><strong>çµæ´»çç½ç»å±çº§çº¦æ</strong>ï¼æ°å¢ highestTierNameï¼æ¯ææåç§°æå®åè®¸è·¨è¶çæé«ç½ç»å±çº§ã</li>
<li><strong>å¤å±çº§ Gang Scheduling</strong>ï¼åæ¶æ¯æ PodGroup çº§å«å SubGroup çº§å«ç Gang Schedulingï¼ç¡®ä¿åå¸å¼ä»»å¡çæ´ä½æ§ã</li>
<li><strong>Volcano Job ååº</strong>ï¼æ¯æå° Job æåä¸ºå¤ä¸ªååºï¼Partitionï¼ï¼ä¾¿äºç®¡ç TP/PP/DP ç­å¹¶è¡ç­ç¥ï¼å¹¶ä¼åç½ç»äº²åæ§ã</li>
<li><strong>HyperNode çº§ Binpacking</strong>ï¼å¨ HyperNodeï¼å¦äº¤æ¢æºãæºæ¶ï¼å±çº§è¿è¡èµæºè£ç®±ï¼åå°ç½ç»ç¢çï¼æåéä¿¡æçã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">éç½®ç¤ºä¾ - Volcano Jobï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">apiVersion: batch.volcano.sh/v1alpha1
kind: Job
metadata:
name: llm-training-job
spec:
networkTopology:
mode: hard
highestTierAllowed: 2 # æ´ä¸ª Job æå¤è·¨è¶ Tier 2 HyperNode
tasks:
- name: trainer
replicas: 8
partitionPolicy:
totalPartitions: 2 # æåä¸º 2 ä¸ªååº
partitionSize: 4 # æ¯ä¸ªååº 4 ä¸ª Pod
minPartitions: 2 # è³å°éè¦ 2 ä¸ªååº
networkTopology:
mode: hard
highestTierAllowed: 1 # åä¸ªååºå¿é¡»å¨ Tier 1 å
template:
spec:
containers:
- name: trainer
image: training-image:v1
resources:
requests:
nvidia.com/gpu: 8</pre>
</div>
<p data-tool="mdniceç¼è¾å¨">ç¸å³ PRï¼</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4721,<br>
https://github.com/volcano-sh/volcano/pull/4810,<br>
https://github.com/volcano-sh/volcano/pull/4795,<br>
https://github.com/volcano-sh/volcano/pull/4785,<br>
https://github.com/volcano-sh/volcano/pull/4889</p>
<p data-tool="mdniceç¼è¾å¨">è®¾è®¡ææ¡£ï¼<strong>Network Topology Aware Scheduling</strong>[5]<br>
æè°¢ç¤¾åºå¼åèï¼@ouyangshengjia, @3sunny, @zhaoqi, @wangyang0616, @MondayCha, @Tau721</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>æ··é¨è½åå¨é¢åçº§ï¼æ¯æéç¨æä½ç³»ç»</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">æ¬æ¬¡åå¸å¯¹ Volcano çæ··é¨è½åè¿è¡äºå¨é¢æ¹è¿ï¼å¶ä¸­ä¸ä¸ªéè¦éç¨ç¢æ¯ï¼Volcano æ··é¨è½å<strong>æ­£å¼æ¯æéç¨æä½ç³»ç»</strong>ï¼UbuntuãCentOS ç­ï¼ï¼ä¸åå±éäº OpenEulerãè¿æå³çæ´å¤ç¨æ·å¯ä»¥ä½¿ç¨ Volcano Agent å®ç°å¨ç¦»çº¿æ··é¨ï¼æåéç¾¤æ´ä½èµæºå©ç¨çã</p>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>CPU å¨æåå¶ (CPU Suppression)</strong></span></span></h3>
<p data-tool="mdniceç¼è¾å¨">å¨çº¿ä¸å¡æµééå¸¸å·ææ½®æ±ç¹æ§ãä¸ºäºå¨ä¿éå¨çº¿ä¸å¡ SLA çåæ¶æå¤§åèµæºå©ç¨ï¼ç¦»çº¿ Pod ç CPU éé¢éè¦éå¨çº¿ç¨éå¨æè°æ´ï¼å¨çº¿ç¨éé«æ¶åå¶ç¦»çº¿éé¢ï¼ç¨éåè½æ¶éæ­¥æ¢å¤ï¼å®ç°èªéåºçèµæºåéã</p>
<p data-tool="mdniceç¼è¾å¨">æ ¸å¿è®¾è®¡ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li>æ ¹æ®èç¹å¯åé CPU åå®æ¶ç¨éï¼å¨æè°æ´ BestEffort root cgroup ç CPU éé¢ã</li>
<li>éç¨"çæ§-äºä»¶-å¤ç"æ¶æï¼å¹¶å®æ½ä¿å®æ´æ°ç­ç¥ï¼æææå¶æå¨ã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">éç½®ç¤ºä¾ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">cpuThrottlingConfig:

enable: true

cpuThrottlingThreshold: 80 # BE éé¢ä¸éä¸ºå¯åé CPU ç 80%

cpuJitterLimitPercent: 1 # éé¢ååè¶è¿ 1% æè§¦åæ´æ°
cpuRecoverLimitPercent: 10 # åæ¬¡æ¢å¤ä¸é 10%</pre>
</div>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>åå­ QoS (Cgroup V2)</strong></span></span></h3>
<p data-tool="mdniceç¼è¾å¨">åºäº Cgroup V2 å®ç°æ··é¨åºæ¯çåå­éç¦»ãæ°å¢ ColocationConfiguration CRDï¼æ¯æä¸ºæå®å·¥ä½è´è½½éç½®åå­ QoS ç­ç¥ã</p>
<p data-tool="mdniceç¼è¾å¨">æ ¸å¿è½åï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>New API</strong>ï¼éè¿æ ç­¾éæ©å¨å®ä¹åå­éç¦»ç­ç¥ç ColocationConfiguration CRD</li>
<li><strong>å¨æè®¡ç®</strong>ï¼
<ul>
<li>memory.high = pod.limits.memory * highRatio %</li>
<li>memory.low = pod.requests.memory * lowRatio %</li>
<li>memory.min = pod.requests.memory * minRatio %</li>
</ul>
</li>
<li><strong>ç»ä¸æ¥å£</strong>ï¼å¯é æ£æµåæ¯æ Cgroup V2 ç¯å¢</li>
</ul>
<p data-tool="mdniceç¼è¾å¨">ä½¿ç¨ç¤ºä¾ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">apiVersion: config.volcano.sh/v1alpha1

kind: ColocationConfiguration

metadata:

name: colo-config1

spec:

selector:

*matchLabels:*

  *app: offline-test*
memoryQos:

*highRatio: 100  \# memory.high \= memory.limits \* 100%*

*lowRatio: 50    \# memory.low \= memory.requests \* 50%*  
*minRatio: 0     \# memory.min \= memory.requests \* 0%*</pre>
</div>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>CPU Burst ä¸ Cgroup V2 å¨é¢æ¯æ</strong></span></span></h3>
<p data-tool="mdniceç¼è¾å¨">CPU Burst è½åå·²æ©å±è³éç¨æä½ç³»ç»ãåæ¶ï¼Volcano Agent ç°å·²å¨é¢éé Cgroup V2 ç¯å¢ï¼æ¯æèªå¨æ£æµ Cgroup çæ¬åé©±å¨ç±»åï¼å¦ systemd driverï¼ï¼æ éäººå·¥å¹²é¢å³å¯å¨ç°ä»£ Linux åè¡çä¸æ ç¼è¿è¡ã</p>
<p data-tool="mdniceç¼è¾å¨">ç¸å³ PRï¼</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4632,</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4945,</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4913,</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4984</p>
<p data-tool="mdniceç¼è¾å¨">è®¾è®¡ææ¡£ï¼<strong>CPU Throttle Design</strong>[6], <strong>Agent Cgroup V2 Adaptation</strong>[7]</p>
<p data-tool="mdniceç¼è¾å¨">æè°¢ç¤¾åºå¼åèï¼@Haibara-Ai97, @JesseStutler, @ouyangshengjia</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>æè¾ vNPU è°åº¦</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">v1.14 åçéæäºæè¾ vNPUï¼èæ NPUï¼è°åº¦è½åï¼å®ç°æè¾ AI å¤çå¨å¨å¤ä¸ªå·¥ä½è´è½½ä¹é´çé«æç®åå¤ç¨ãæä¾ä¸¤ç§æ¨¡å¼ï¼çµæ´»ééä¸åé¨ç½²åºæ¯ã</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ¯ææ¨¡å¼</strong>ï¼</p>
<p data-tool="mdniceç¼è¾å¨"><strong>1. MindCluster æ¨¡å¼</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>éæèª Ascend MindCluster è°åº¦æä»¶ï¼https://gitcode.com/Ascend/mind-cluster
<ul>
<li>æ¯ææè¾ 310P ç³»åçå¨æèæå</li>
</ul>
</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>2. HAMi æ¨¡å¼</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>ç± HAMi ç¤¾åºå¼å
<ul>
<li>åæ¶æ¯ææè¾ 310 å 910 ç³»å</li>
<li>æ¯æå¼ææè¾éç¾¤ï¼910Aã910B2ã910B3ã310Pï¼</li>
</ul>
</li>
</ul>
<p data-tool="mdniceç¼è¾å¨">è°åº¦å¨éç½®ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;"># MindCluster æ¨¡å¼

- name: deviceshare

arguments:

*deviceshare.AscendMindClusterVNPUEnable: true*
# HAMi æ¨¡å¼

- name: deviceshare

arguments:

*deviceshare.AscendHAMiVNPUEnable: true*  
*deviceshare.SchedulePolicy: binpack  \# æ spread*</pre>
</div>
<p data-tool="mdniceç¼è¾å¨">ç¸å³ PRï¼</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4656,<br>
https://github.com/volcano-sh/volcano/pull/4717<br>
ä½¿ç¨ææ¡£ï¼<strong>How to Use vNPU</strong>[8]<br>
æè°¢ç¤¾åºå¼åèï¼@JackyTYang, @DSFans2014</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>Volcano Global å¢å¼º</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">Volcano Global v0.3.0 å¼å¥äºä¸¤ä¸ªéè¦åè½ï¼éè¿åºäºè®¡ç®èµæºåæ°æ®å±é¨æ§çæºè½è°åº¦ï¼æ¾èæ©å±äº Volcano Global å¯¹ AI/ML åå¤§æ°æ®å·¥ä½è´è½½çè½åã</p>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>HyperJobï¼å¤éç¾¤ä½ä¸èªå¨æå</strong></span></span></h3>
<p data-tool="mdniceç¼è¾å¨">éç AI è®­ç»å·¥ä½è´è½½è§æ¨¡åå¤ææ§çå¢é¿ï¼ä¼ä¸è¶æ¥è¶é¢ä¸´è·¨å¤ä¸ªå¼æéç¾¤ç®¡çå¤§è§æ¨¡è®­ç»ä½ä¸çææãHyperJob æ¯æå»ºå¨ Volcano Job ä¹ä¸çæ´é«çº§æ½è±¡ãå®ç»åå¤ä¸ª Volcano Job æ¨¡æ¿ï¼å°è®­ç»è½åæ©å±å°åéç¾¤è¾¹çä¹å¤ï¼åæ¶ä¿çæ¯ä¸ªéç¾¤åç°æ Volcano Job çå¨é¨è½åã</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ ¸å¿è½å</strong>ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>Karmada æ·±åº¦éæ</strong>ï¼èªå¨çæ PropagationPolicyï¼ç²¾åéç½®éç¾¤äº²åæ§ä¸å¯æ¬è°åº¦ã</li>
<li><strong>ç¶æç»ä¸èå</strong>ï¼å°åéç¾¤å­ä»»å¡ç¶ææ±æ»ä¸ºç»ä¸ç HyperJob ç¶æï¼å¨å±å¯è§æµã</li>
<li><strong>èªå¨èµæºçæ</strong>ï¼æ ¹æ® ReplicatedJob å®ä¹èªå¨åå»º VCJob å PropagationPolicyã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">HyperJob èµæºç¤ºä¾ï¼è·¨ 2 ä¸ªéç¾¤æåå¤§è§æ¨¡è®­ç»ä½ä¸ï¼å± 256 ä¸ª GPUï¼ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">apiVersion: training.volcano.sh/v1alpha1

kind: HyperJob

metadata:

name: llm-training

spec:

replicatedJobs:

- name: trainer

replicas: 2

templateSpec:

  tasks:

  \- name: worker

    replicas: 128

    template:

      spec:

        containers:

        \- name: trainer

          image: training-image:v1

          resources:

            requests:  
              nvidia.com/gpu: 1</pre>
</div>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>æ°æ®æç¥è°åº¦</strong></span></span></h3>
<p data-tool="mdniceç¼è¾å¨">å¨ AI è®­ç»åå¤§æ°æ®åæç­é«æ§è½è®¡ç®åºæ¯ä¸­ï¼ä»»å¡æ§è¡ä¸ä»ä¾èµè®¡ç®èµæºï¼è¿ä¸¥éä¾èµæ°æ®èµæºãå¨å¤éç¾¤ç¯å¢ä¸­ï¼è°åº¦å¨å¯è½ä¼å°ä»»å¡åæ´¾å°ä¸æ°æ®æºç©çè·ç¦»è¾è¿çéç¾¤ï¼å¯¼è´è·¨å°åå¸¦å®½ææ¬è¿é«å I/O å»¶è¿è¿é«ã</p>
<p data-tool="mdniceç¼è¾å¨">æ°æ®æç¥è°åº¦æ¡æ¶å¼å¥ <strong>DataDependencyController</strong>ï¼æéäºé»è¾æ°æ®éæ±ä¸ç©çéç¾¤åå¸çå£åãéè¿å¤é¨æä»¶ï¼å¦ Amoroï¼å®æ¶è·åæ°æ®åå¸ä¿¡æ¯ï¼èªå¨å°è°åº¦çº¦ææ³¨å¥ Karmadaï¼å®ç°"è®¡ç®éæ°æ®èå¨"çå¨èªå¨å·¥ä½æµã</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ ¸å¿è½å</strong>ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>æä»¶åæ¶æ</strong>ï¼å¯æ©å±æ¯æ AmoroãHiveãS3 ç­å¤ç§æ°æ®ç³»ç»ã</li>
<li><strong>å£°æå¼ API</strong>ï¼DataSourceClaim / DataSource CRDï¼éç¨"å£°æ-ç¼å­"æ¨¡å¼ã</li>
<li><strong>èªå¨äº²åæ³¨å¥</strong>ï¼å°æ°æ®å±é¨æ§è½¬åä¸º ClusterAffinity çº¦æï¼æ³¨å¥ ResourceBindingã</li>
</ul>
<p data-tool="mdniceç¼è¾å¨">è¯¦è§ï¼ <strong>Volcano Global v0.3.0 Release Notes</strong>[9]<br>
æè°¢ç¤¾åºå¼åèï¼@JesseStutler, @fx147, @Monokaix, @zhoujinyu, @anryko, @tanberBro</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>Volcano Dashboard v0.2.0</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">Volcano Dashboard v0.2.0 å¯¹èµæºç®¡çè½åè¿è¡äºéå¤§å¢å¼ºï¼ä½¿å¾éè¿ Web çé¢ç®¡ç Volcano èµæºæ´å ä¾¿æ·ã<br>
<strong>æ ¸å¿å¢å¼º</strong>ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>PodGroup å¨æ¯å¯è§å</strong>ï¼è·¨å½åç©ºé´æ¥çãæç´¢ãè¿æ»¤ PodGroupï¼æ¯æ YAML è¯­æ³é«äº®ã</li>
<li><strong>Job çå½å¨æç®¡ç</strong>ï¼ç´æ¥å¨çé¢åå»ºãå é¤ Volcano Jobï¼æä½æ´ä¾¿æ·ã</li>
<li><strong>Queue ç®¡çå¢å¼º</strong>ï¼å¨çº¿ç¼è¾ Queue éé¢ãæéï¼æ¯æ YAML ç´æ¥ä¿®æ¹ã</li>
<li><strong>å®å¨å åº</strong>ï¼é»è®¤éç½® SELinuxãSeccompãé root è¿è¡åç¦æ­¢ææï¼ä¿éçäº§å®å¨ã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">è¯¦è§ï¼ <strong>Volcano Dashboard v0.2.0 Release Notes</strong>[10]<br>
æè°¢ç¤¾åºå¼åèï¼@vzhou-p, @Shrutim1505, @JesseStutler, @karanBRAVO, @Sayan4444, @jayesh9747, @Alivestars24, @kuldeep, @Monokaix</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>è°åº¦å¨ç¨³å®æ§ä¸æ§è½æå</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨"><strong>Reclaim éæä¸å¢å¼º</strong><br>
å¯¹ Reclaim Action è¿è¡äºå¨é¢éæï¼å¹¶ä¿®å¤äº Capacity Plugin ä¸­çå³é®é»è¾é®é¢ï¼å¤§å¹æåå¤ç§æ·éç¾¤èµæºåæ¶çåç¡®æ§ãç¨³å®æ§åæ§è½ã<br>
ä¸»è¦æ¹è¿ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>Reclaim Action éæ</strong>ï¼éæäº reclaim å·¥ä½æµï¼æé«ä»£ç å¯è¯»æ§ãå¯ç»´æ¤æ§åæµè¯è¦ççã</li>
<li><strong>å¢å¼ºç Capacity Plugin é»è¾</strong>ï¼ä¿®å¤äº reclaimableFn å preemptiveFnï¼æ­£ç¡®å¤çæ éèµæºå¹¶é²æ­¢éè¯¯çæ¢å å³ç­ã</li>
<li><strong>ç¨³å®æ§æå</strong>ï¼è§£å³äºèµæºè®¡ç®ä¸­çè¾¹ç¼æåµï¼é²æ­¢è°åº¦æ­»å¾ªç¯åè¯¯é©±éã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">ç¸å³ PRï¼</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4794,<br>
https://github.com/volcano-sh/volcano/pull/4659,<br>
https://github.com/volcano-sh/volcano/pull/4919<br>
æè°¢ç¤¾åºå¼åèï¼@guoqinwill, @hajnalmt</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>æ¯æ Kubernetes 1.34</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">Volcano çæ¬ç´§è· Kubernetes ç¤¾åºãv1.14 å·²å¨é¢æ¯æææ°ç Kubernetes v1.34ï¼å¹¶éè¿å®æ´çååæµè¯å E2E æµè¯ä¿éåè½ä¸ç¨³å®æ§ã<br>
ç¸å³ PRï¼https://github.com/volcano-sh/volcano/pull/4704<br>
æè°¢ç¤¾åºå¼åèï¼@suyiiyii, @tunedev</p>
<h1 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>æ»ç»ï¼Volcano v1.14.0 â AI æ¶ä»£çç»ä¸è°åº¦å¹³å°</strong></span></span></h1>
<p data-tool="mdniceç¼è¾å¨">Volcano v1.14 æ¯ä¸ä¸ªéç¨ç¢å¼ççæ¬ãéè¿å¼å¥å¤è°åº¦å¨æ¶æå Agent Schedulerï¼Volcano æ­£å¼è¿å¥ç»ä¸è°åº¦å¹³å°æ°é¶æ®µï¼æ¢è½é«æå¤çæ¹é AI è®­ç»ï¼åè½æ»¡è¶³ AI Agent çæè´æ¶å»¶è¦æ±ãç½ç»æææç¥å¢å¼ºãéç¨æä½ç³»ç»æ··é¨æ¯æãæè¾ vNPU éæï¼è¿ä¸æ­¥å¤¯å®äº Volcano å¨ AI åºç¡è®¾æ½é¢åçé¢åå°ä½ã<br>
åæ¶ï¼Volcano Global v0.3.0 éè¿ HyperJob å®ç°å¤§è§æ¨¡åå¸å¼è®­ç»åæ°æ®æç¥è°åº¦ï¼æ©å±äºå¤éç¾¤è½åãVolcano Dashboard v0.2.0 éè¿å¨é¢çèµæºç®¡çåè½æ¾èæ¹åäºç¨æ·ä½éªã</p>
<p data-tool="mdniceç¼è¾å¨"><strong>ç«å³ä½éª Volcano v1.14ï¼å±å¯ AI æ¶ä»£ç»ä¸è°åº¦æ°ç¯ç« ï¼</strong></p>
<p data-tool="mdniceç¼è¾å¨"><strong>v1.14.0 åå¸å°åï¼</strong>https://github.com/volcano-sh/volcano/releases/tag/v1.14.0<br>
<strong>Volcano Global v0.3.0 åå¸å°åï¼</strong>https://github.com/volcano-sh/volcano-global/releases/tag/v0.3.0<br>
<strong>Volcano Dashboard v0.2.0 åå¸å°åï¼</strong>https://github.com/volcano-sh/dashboard/releases/tag/v0.2.0</p>
<h1 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>è´   è°¢</strong></span></span></h1>
<p data-tool="mdniceç¼è¾å¨">Volcano v1.14 çæçæ¬ï¼å« Volcano Global v0.3.0ãDashboard v0.2.0ï¼å±æ 55 ä½ç¤¾åºè´¡ç®èåä¸ãè¡·å¿æè°¢æ¯ä¸ä½è´¡ç®èï¼</p>
<table data-draft-node="block" data-draft-type="table" data-size="normal">
<tbody>
<tr><th>@3sunny</th><th>@3th4novo</th><th>@acsoto</th>
</tr>
<tr>
<td>@Alivestars24</td>
<td>@Aman-Cool</td>
<td>@anryko</td>


</tr>
<tr>
<td>@archlitchi</td>
<td>@dafu-wu</td>
<td>@DSFans2014</td>


</tr>
<tr>
<td>@FAUST-BENCHOU</td>
<td>@fengruotj</td>
<td>@Freshwlnd</td>


</tr>
<tr>
<td>@fx147</td>
<td>@goyalpalak18</td>
<td>@guoqinwill</td>


</tr>
<tr>
<td>@Haibara-Ai97</td>
<td>@hajnalmt</td>
<td>@halcyon-r</td>


</tr>
<tr>
<td>@handan-yxh</td>
<td>@JackyTYang</td>
<td>@jayesh9747</td>


</tr>
<tr>
<td>@JesseStutler</td>
<td>@jiahuat</td>
<td>@karanBRAVO</td>


</tr>
<tr>
<td>@kingeasternsun</td>
<td>@kiritoxkiriko</td>
<td>@kube-gopher</td>


</tr>
<tr>
<td>@kuldeep</td>
<td>@LiZhenCheng9527</td>
<td>@medyagh</td>


</tr>
<tr>
<td>@MondayCha</td>
<td>@Monokaix</td>
<td>@mvinchoo</td>


</tr>
<tr>
<td>@neeraj542</td>
<td>@nitindhiman314e</td>
<td>@ouyangshengjia</td>


</tr>
<tr>
<td>@PersistentJZH</td>
<td>@qi-min</td>
<td>@rhh777</td>


</tr>
<tr>
<td>@ruanwenjun</td>
<td>@RushabhMehta2005</td>
<td>@sailorvii</td>


</tr>
<tr>
<td>@Sayan4444</td>
<td>@Shrutim1505</td>
<td>@ssfffss</td>


</tr>
<tr>
<td>@suyiiyii</td>
<td>@tanberBro</td>
<td>@Tau721</td>


</tr>
<tr>
<td>@vzhou-p</td>
<td>@wangyang0616</td>
<td>@weapons97</td>


</tr>
<tr>
<td>@Wonki4</td>
<td>@zhaoqi612</td>
<td>@zhengchenyu</td>


</tr>
<tr>
<td>@zhoujinyu</td>
<td>@zjj2wry</td>
<td>&nbsp;</td>


</tr>


</tbody>


</table>
<p data-tool="mdniceç¼è¾å¨"><strong>ç¸å³é¾æ¥</strong></p>
<p data-tool="mdniceç¼è¾å¨">[1] Volcano: <em>https://volcano.sh/en/</em><br>
[2] Volcano v1.14.0: <em>https://github.com/volcano-sh/volcano/releases/tag/v1.14.0</em><br>
[3] Sharding Controller Design: <em>https://github.com/volcano-sh/volcano/blob/v1.14.0/docs/design/sharding_controller.md</em><br>
[4] Agent Scheduler Design: <em>https://github.com/volcano-sh/volcano/blob/v1.14.0/docs/design/agent-scheduler.md</em><br>
[5] Network Topology Aware Scheduling: <em>https://github.com/volcano-sh/volcano/blob/v1.14.0/docs/design/Network%20Topology%20Aware%20Scheduling.md</em><br>
[6] CPU Throttle Design: <em>https://github.com/volcano-sh/volcano/blob/v1.14.0/docs/design/cpu-throttle-design.md</em><br>
[7] Agent Cgroup V2 Adaptation: <em>https://github.com/volcano-sh/volcano/blob/v1.14.0/docs/design/agent-cgroup-v2-adaptation.md</em><br>
[8] How to Use vNPU: <em>https://github.com/volcano-sh/volcano/blob/v1.14.0/docs/user-guide/how_to_use_vnpu.md</em><br>
[9] Volcano Global v0.3.0 Release Notes: <em>https://github.com/volcano-sh/volcano-global/releases/tag/v0.3.0</em><br>
[10] Volcano Dashboard v0.2.0 Release Notes: <em>https://github.com/volcano-sh/dashboard/releases/tag/v0.2.0</em></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 16:36">2026-02-13 16:35</span>&nbsp;
<a href="https://www.cnblogs.com/huaweiyun">åä¸ºäºå¼åèèç</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19612682);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19612682', targetLink: 'https://www.cnblogs.com/huaweiyun/p/19612682', title: 'Volcano v1.14 éç£åå¸ï¼è¿å AI ç»ä¸è°åº¦æ°çºªå' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ LLVMçæ··æ·ä¹æ(å­)-å­ç¬¦ä¸²å å¯ ]]></title>
    <link>https://www.cnblogs.com/ClownLMe/p/19612575</link>
    <guid>bf84290cda53660299f960c2091a7091</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ClownLMe/p/19612575" title="åå¸äº 2026-02-13 16:11">
    <span role="heading" aria-level="2">LLVMçæ··æ·ä¹æ(å­)-å­ç¬¦ä¸²å å¯</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ç®ä»">ç®ä»</h1>
<p>å¨ä¸ä¸ä¸ªæå­¦ä¸­ï¼å­¦ä¹ äºå¦ä½åä¸ä¸ªLLVM Passç¤ºä¾æ¥è¿è¡æ§å¶æµå¹³å¦åï¼è¿ç¯æç« ï¼æ¥å­¦ä¹ å¦ä½äºå©ç¨LLVMå®ç°å­ç¬¦ä¸²çå å¯ã</p>
<h1 id="æ¡ä¾">æ¡ä¾</h1>
<h3 id="éè¦å å¯çå¯¹è±¡">éè¦å å¯çå¯¹è±¡</h3>
<p>è¿æ¯ä¸ä¸ªç»å¸çcè¯­è¨æ ·ä¾ï¼ç®çæ¯è¾åºå­ç¬¦ä¸²ï¼hello world</p>
<pre><code class="language-c">#include &lt;stdio.h&gt;

int main(){
&nbsp; &nbsp; printf("hello world\n");
&nbsp; &nbsp; return 0;
}
</code></pre>
<h3 id="å å¯passç¼å">å å¯passç¼å</h3>
<p>ä¸é¢æ¯å®æ´çpassä»£ç ï¼<br>
<mark><strong>ä»£ç çç®çæ¯ï¼è®©å­ç¬¦ä¸²å¨ç¼è¯çè¿ç¨ä¸­è¿è¡å¼æå å¯ï¼å¹¶ä¸å¨è¿è¡çè¿ç¨ä¸­å¨æè§£å¯ã</strong></mark></p>
<pre><code class="language-cpp">#include "llvm/Passes/PassBuilder.h"
#include "llvm/Passes/PassPlugin.h"
#include "llvm/Support/raw_ostream.h"
#include "llvm/IR/Function.h"
#include "llvm/IR/Instructions.h"
#include "llvm/IR/IRBuilder.h"
#include "llvm/IR/PassManager.h"
#include "llvm/IR/GlobalVariable.h"
#include "llvm/IR/Constants.h"

using namespace llvm;

namespace{
    struct mypass : public PassInfoMixin&lt;mypass&gt;{
        const uint8_t KEY = 0x42;

        Function *createDecryptFunc(Module *M){
            LLVMContext &amp;Ctx = M-&gt;getContext();
            std::vector&lt;Type*&gt; paramTypes = { PointerType::getUnqual(Ctx), Type::getInt32Ty(Ctx) };
            FunctionType *funcType = FunctionType::get(Type::getVoidTy(Ctx),paramTypes,false);

            Function *Func = Function::Create(funcType, GlobalValue::InternalLinkage, "my_decrypt_func", M);

            Argument *ArgData = Func-&gt;getArg(0);
            Argument *ArgLen  = Func-&gt;getArg(1);

            BasicBlock *EntryBB = BasicBlock::Create(Ctx, "entry", Func);
            BasicBlock *LoopCheckBB = BasicBlock::Create(Ctx, "loop_check", Func);
            BasicBlock *LoopBodyBB  = BasicBlock::Create(Ctx, "loop_body", Func);
            BasicBlock *ExitBB      = BasicBlock::Create(Ctx, "exit", Func);

            IRBuilder&lt;&gt; builder(EntryBB);
            builder.CreateBr(LoopCheckBB);
            builder.SetInsertPoint(LoopCheckBB);

            PHINode *LoopVar = builder.CreatePHI(Type::getInt32Ty(Ctx), 2, "i");
            LoopVar-&gt;addIncoming(builder.getInt32(0), EntryBB); 

            Value *Cond = builder.CreateICmpSLT(LoopVar, ArgLen, "cond");
            builder.CreateCondBr(Cond, LoopBodyBB, ExitBB);

            builder.SetInsertPoint(LoopBodyBB);

            Value *Ptr = builder.CreateInBoundsGEP(builder.getInt8Ty(), ArgData, LoopVar);
            Value *ByteVal = builder.CreateLoad(builder.getInt8Ty(), Ptr);
            Value *XorVal = builder.CreateXor(ByteVal, builder.getInt8(KEY));
            builder.CreateStore(XorVal, Ptr);

            Value *NextVar = builder.CreateAdd(LoopVar, builder.getInt32(1));
            LoopVar-&gt;addIncoming(NextVar, LoopBodyBB);

            builder.CreateBr(LoopCheckBB);
            builder.SetInsertPoint(ExitBB);
            builder.CreateRetVoid();

            return Func;
        }
        PreservedAnalyses run(Module &amp;M, ModuleAnalysisManager &amp;AM){
            errs() &lt;&lt; "Running On-Demand String Encryption Pass...\n";
            std::vector&lt;GlobalVariable*&gt; EncryptedGlobals;
            for(GlobalVariable &amp;GV : M.globals()){
                if (!GV.hasInitializer() || !GV.isConstant() || GV.getName().contains("llvm.")) continue;

                Constant *Init = GV.getInitializer();
                ConstantDataArray* DataArray = dyn_cast&lt;ConstantDataArray&gt;(Init);

                if(DataArray &amp;&amp; DataArray-&gt;isString()){
                    StringRef OriginalString = DataArray-&gt;getAsString();

                    if(OriginalString.size() &lt; 2) continue;

                    errs() &lt;&lt; "Encrypting string: " &lt;&lt; OriginalString &lt;&lt; "\n";
                    std::string EncryptedStr = OriginalString.str();
                    for(int i = 0; i &lt; EncryptedStr.size(); i++){
                        EncryptedStr[i] ^= KEY;
                    }

                    Constant *NewInit = ConstantDataArray::getString(M.getContext(), EncryptedStr, false);
                    GV.setInitializer(NewInit);
                    GV.setConstant(false);
                    
                    EncryptedGlobals.push_back(&amp;GV);
                }
            }

            if(EncryptedGlobals.empty()) return PreservedAnalyses::all();

            Function *DecryptFunc = createDecryptFunc(&amp;M);

            for(GlobalVariable *GV : EncryptedGlobals){
                std::vector&lt;Instruction*&gt; user;
                for(User *U: GV-&gt;users()){
                    Instruction* ins = dyn_cast&lt;Instruction&gt;(U);
                    if(ins-&gt;getFunction() == DecryptFunc) continue;
                    user.push_back(ins);
                }
                
                for(Instruction *ins : user){
                    IRBuilder&lt;&gt; builder(ins);
                    ConstantDataArray* DataArray = dyn_cast&lt;ConstantDataArray&gt;(GV-&gt;getInitializer());
                    int len = DataArray-&gt;getNumElements();
                    builder.CreateCall(DecryptFunc, {GV, builder.getInt32(len)});
                }
            }
            return PreservedAnalyses::none();
        }
    };
}

extern "C" LLVM_ATTRIBUTE_WEAK ::llvm::PassPluginLibraryInfo
llvmGetPassPluginInfo(){
    return{
        LLVM_PLUGIN_API_VERSION,
        "mypass",
        "v0.1",
        [](PassBuilder &amp;PB){
            PB.registerPipelineParsingCallback(
                [](StringRef Name, ModulePassManager &amp;MPM, ArrayRef&lt;PassBuilder::PipelineElement&gt;){
                    if(Name == "mypass"){
                        MPM.addPass(mypass());
                        return true;
                    }
                    return false;
                }
            );
        }
    };
}
</code></pre>
<h3 id="ä»£ç è§£é">ä»£ç è§£é</h3>
<p>çå°ä¸é¢çpassä»£ç ï¼æä»¬ä¼æå°å¤´æç®ç©ï¼æ²¡å³ç³»ï¼ä¸é¢æä»¬ä¸æ­¥æ­¥æè§£ã<br>
ä¸é¢çä»£ç åä¸»è¦åä¸ºä¸¤é¨åï¼</p>
<ol>
<li>æå»ºå¼æçè§£å¯å½æ°ï¼<code>createDecryptFunc</code>ï¼</li>
<li>å å¯å­ç¬¦ä¸²ï¼å¹¶ä¸å°ä¸é¢æå»ºçè§£å¯å½æ°æå¥ä»£ç ã</li>
</ol>
<h3 id="cmakeliststxt">CMakeLists.txt</h3>
<p>ç¼è¯å¯ä»¥ç´æ¥ç¨ä¸é¢çcmakeéç½®æä»¶ï¼ç¼è¯è¿ç¨å¨ä¹åæç« è¯¦ç»è®²è§£</p>
<pre><code class="language-python">cmake_minimum_required(VERSION 4.1.1)
project(mypass) 

set(LLVM_DIR "D:/LLVM/llvm-project/build/lib/cmake/llvm")
find_package(LLVM REQUIRED CONFIG)
list(APPEND CMAKE_MODULE_PATH "${LLVM_CMAKE_DIR}")
include(AddLLVM)
include_directories(${LLVM_INCLUDE_DIRS})
add_definitions(${LLVM_DEFINITIONS})
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

add_library(mypass MODULE mypass.cpp)
set_target_properties(mypass PROPERTIES WINDOWS_EXPORT_ALL_SYMBOLS ON) 
target_link_libraries(mypass LLVMCore LLVMSupport)     
target_compile_options(mypass PRIVATE /utf-8)#ç¨ä¸­æ
</code></pre>
<h1 id="ä½¿ç¨ææå±ç¤º">ä½¿ç¨ææå±ç¤º</h1>
<h3 id="ç¼è¯å¹¶æ§è¡">ç¼è¯å¹¶æ§è¡</h3>
<p>å¾çä¸­å¯ä»¥çåºï¼å¯ä»¥æ­£å¸¸è¿è¡<br>
<img alt="å½ä»¤è¿è¡" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260213160118505-594712651.png" class="lazyload"></p>
<h3 id="åç¼è¯æ¥çåºå«">åç¼è¯æ¥çåºå«</h3>
<h4 id="åå§testexe">åå§test.exe</h4>
<p><img alt="å­ç¬¦ä¸²å å¯" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260213160124354-268770369.png" class="lazyload"></p>
<h4 id="å å¯test_optexe">å å¯test_opt.exe</h4>
<p><img alt="åå§" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260213160103496-2047084346.png" class="lazyload"></p>
<p>æ ¹æ®ä¸é¢çå¾çï¼å¯ä»¥çå°ï¼ä¸é¢ä½¿ç¨çpassï¼æåå°HelloWorldå å¯äºã</p>
<p><mark><strong>å¦æâ¤åæ¬¢â¤æ¬ç³»åæç¨ï¼å°±ç¹ä¸ªå³æ³¨å§ï¼åç»­ä¸å®ææ´æ°~</strong></mark></p>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/ClownLMe/" target="_blank">ClownLMe</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/ClownLMe/p/19612575" target="_blank">https://www.cnblogs.com/ClownLMe/p/19612575</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 16:11">2026-02-13 16:11</span>&nbsp;
<a href="https://www.cnblogs.com/ClownLMe">ClownLMe</a>&nbsp;
éè¯»(<span id="post_view_count">3</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19612575);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19612575', targetLink: 'https://www.cnblogs.com/ClownLMe/p/19612575', title: 'LLVMçæ··æ·ä¹æ(å­)-å­ç¬¦ä¸²å å¯' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Admin.NETå¼æºçå¾®æå¡æ¹é è®°å½ ]]></title>
    <link>https://www.cnblogs.com/shiningrise/p/19612443</link>
    <guid>996ff91c48ef758799e000eb0d8c119c</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/shiningrise/p/19612443" title="åå¸äº 2026-02-13 15:44">
    <span role="heading" aria-level="2">Admin.NETå¼æºçå¾®æå¡æ¹é è®°å½</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="adminnetå¼æºçå¾®æå¡æ¹é è®°å½">Admin.NETå¼æºçå¾®æå¡æ¹é è®°å½</h1>
<h2 id="å°adminnetcoreé¡¹ç®æåæä¸¤ä¸ªé¡¹ç®adminnetcommonadminnetcore">å°Admin.NET.Coreé¡¹ç®æåæä¸¤ä¸ªé¡¹ç®ï¼Admin.NET.Commonï¼Admin.NET.Core</h2>
<p>Admin.NET.Commonæ¾åºç¡å·¥å·ç±»</p>
<p>Admin.NET.Coreæ¾æ¡æ¶æ ¸å¿ç±»åº</p>
<h2 id="aspireappapphostä¸­çapphostcséç½®">AspireApp.AppHostä¸­çAppHost.cséç½®ï¼</h2>
<pre><code>using Aspire.Hosting;
using Aspire.Hosting.Dapr;
using AspireApp.AppHost;

var builder = DistributedApplication.CreateBuilder(args);

var postgresQL = builder.AddPostgres("postgresQL")
                        .WithImage("ankane/pgvector")
                        .WithImageTag("latest")
                        .WithLifetime(ContainerLifetime.Persistent)
                        .WithHealthCheck()
                        .WithPgWeb();
var postgres = postgresQL.AddDatabase("postgres");
var postgres2 = postgresQL.AddDatabase("postgres2");

//var redis = builder.AddRedis("redis").WithLifetime(ContainerLifetime.Persistent)
//                    .WithHealthCheck()
//                    .WithRedisCommander();

// ä½¿ç¨ RabbitMQ ä½ä¸º Pub/Sub ç»ä»¶
//var rabbitmq = builder.AddRabbitMQ("rabbitmq")
//                        .WithLifetime(ContainerLifetime.Persistent)
//                        .WithHealthCheck()
//                        .WithManagementPlugin();

// 1. å®ä¹å±äº«ç®å½çç»å¯¹è·¯å¾ï¼å»ºè®®æå admin-net-core çå®éç®å½æç¬ç«ç shared ç®å½ï¼
var uploadPath = Path.GetFullPath("../Admin.NET/Admin.NET.Core/wwwroot/upload");

// ç¡®ä¿ç®å½å­å¨
if (!Directory.Exists(uploadPath))
{
    Directory.CreateDirectory(uploadPath);
}

// Admin.NET.Core ä½¿ç¨ Furion ç Knife4j UIï¼ä¸ä½¿ç¨ Aspire ç Swagger UI
var core = builder.AddProject&lt;Projects.Admin_NET_Core&gt;("admin-net-core")
    .WithReference(postgres)
    .WaitFor(postgres)
    .WithSwaggerUI();

var baseApi = builder.AddProject&lt;Projects.Base&gt;("base")
    .WithReference(postgres2)
    .WithSwaggerUI()
    .WithReference(core)
    .WaitFor(postgres2)
    .WaitFor(core);

var yarp = builder.AddProject&lt;Projects.AspireApp_Yarp&gt;("aspireapp-yarp")
    .WithEndpoint( port: 5008, scheme: "http", name: "yarp-http")    // æå®å¯ä¸åç§°
    .WithEndpoint( port: 7008, scheme: "https", name: "yarp-https") // æå®å¯ä¸åç§°
    .WithReference(core)
    .WithReference(baseApi)
    .WaitFor(core)
    .WaitFor(baseApi);

//var frontend = builder.AddNodeApp(
//       "frontend",
//       scriptPath: "scripts/run-pnpm.cjs",
//       workingDirectory: "../Web",
//       args: new[] { "dev" }
//   )
//   .WithReference(yarp)
//   .WaitFor(yarp);

builder.Build().Run();


</code></pre>
<h2 id="aipç½å³aspireappyarp">AIPç½å³ï¼AspireApp.Yarp</h2>
<p>Program.cs</p>
<pre><code>var builder = WebApplication.CreateBuilder(args);

builder.AddServiceDefaults();
builder.Services.AddReverseProxy()
                .LoadFromConfig(builder.Configuration.GetSection("ReverseProxy"))
                .AddServiceDiscoveryDestinationResolver();

var app = builder.Build();

app.MapDefaultEndpoints();
app.MapReverseProxy();

app.MapGet("/", () =&gt; "Hello World!");

app.Run();

</code></pre>
<p>appsettings.json</p>
<pre><code>{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "ReverseProxy": {
    "Routes": {
      "core": {
        "ClusterId": "core",
        "Match": {
          "Path": "/core/{**remainder}"
        },
        "Transforms": [
          { "PathRemovePrefix": "/core" },
          { "PathPrefix": "/" },
          { "RequestHeaderOriginalHost": "true" }
        ]
      },
      "base": {
        "ClusterId": "base",
        "Match": {
          "Path": "/base/{**remainder}"
        },
        "Transforms": [
          { "PathRemovePrefix": "/base" },
          { "PathPrefix": "/" },
          { "RequestHeaderOriginalHost": "true" }
        ]
      }
    },
    "Clusters": {
      "core": {
        "Destinations": {
          "base_destination": {
            "Address": "http+https://admin-net-core"
          }
        }
      },
      "base": {
        "Destinations": {
          "base_destination": {
            "Address": "http+https://base"
          }
        }
      }
    }
  }
}
</code></pre>
<h2 id="ä¸å¡é¡¹ç®baseé¡¹ç®è°ç¨æ ¸å¿é¡¹ç®coreé¡¹ç®çæ¹æ³">ä¸å¡é¡¹ç®(baseé¡¹ç®)è°ç¨æ ¸å¿é¡¹ç®(coreé¡¹ç®ï¼çæ¹æ³</h2>
<p>æä»¬ä½¿ç¨Refitæ¥æå¡è°ç¨</p>
<p>å¨baseé¡¹ç®ä¸­çStartup.csä¸­</p>
<pre><code>        // æ³¨å JwtTokenHandler - ç¨äºèªå¨æ·»å  JWT Token å° Refit è¯·æ±
        services.AddTransient&lt;JwtTokenHandler&gt;();
        
        // éç½® Refit å®¢æ·ç«¯å¹¶æ·»å  JWT Token å¤çå¨
        //ç³»ç»éç½®
        services.AddRefitClient&lt;IConfigService&gt;(refitSettings)
               .ConfigureHttpClient(c =&gt; c.BaseAddress = new("https+http://admin-net-core"))
               .AddHttpMessageHandler&lt;JwtTokenHandler&gt;();
        //ç³»ç»èå     
        services.AddRefitClient&lt;IMenuService&gt;(refitSettings)
               .ConfigureHttpClient(c =&gt; c.BaseAddress = new("https+http://admin-net-core"))
               .AddHttpMessageHandler&lt;JwtTokenHandler&gt;();
        //ç»ç»æºæ
        services.AddRefitClient&lt;IOrgService&gt;(refitSettings)
               .ConfigureHttpClient(c =&gt; c.BaseAddress = new("https+http://admin-net-core"))
               .AddHttpMessageHandler&lt;JwtTokenHandler&gt;();
        //æä»¶
        services.AddRefitClient&lt;IFileService&gt;(refitSettings)
               .ConfigureHttpClient(c =&gt; c.BaseAddress = new("https+http://admin-net-core"))
               .AddHttpMessageHandler&lt;JwtTokenHandler&gt;();

        services.AddRefitClient&lt;ITest&gt;(refitSettings)
            .ConfigureHttpClient(c =&gt; c.BaseAddress = new("https+http://apiservice"))
            .AddHttpMessageHandler&lt;JwtTokenHandler&gt;();
</code></pre>
<p>å¶ä¸­æéè¦çæéæ¥å£è°ç¨</p>
<pre><code>using Refit;
using GetAttribute = Refit.GetAttribute;
namespace Base.Rest;

public interface IMenuService
{
    [Get("/api/sysMenu/getOwnBtnPermList")]
    Task&lt;List&lt;string&gt;&gt; GetOwnBtnPermList();

    [Get("/api/sysMenu/getAllBtnPermList")]
    Task&lt;List&lt;string&gt;&gt; GetAllBtnPermList();
}
</code></pre>
<p>ä¿®æ¹baseé¡¹ç®çæééªè¯æ¹æ³JwtHandler.cs</p>
<p>IConfigService  IMenuService å°±æ¯æä»¬å®ä¹çRefitæ¥å£ï¼è¿æ ·ï¼æ¯æ¬¡æééªè¯å°±ä¼è°ç¨coreé¡¹ç®çAPIæ¥å£</p>
<pre><code>using Admin.NET.Core;
using Admin.NET.Core.Service;
using Base.Rest;
using Furion;
using Furion.Authorization;
using Furion.DataEncryption;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Http;
using System;
using System.Threading.Tasks;

namespace Admin.NET.Application;

public class JwtHandler : AppAuthorizeHandler
{
    private readonly SysCacheService _sysCacheService = App.GetRequiredService&lt;SysCacheService&gt;();
    private readonly IConfigService _sysConfigService = App.GetRequiredService&lt;IConfigService&gt;();
    private static readonly IMenuService SysMenuService = App.GetRequiredService&lt;IMenuService&gt;();

    /// &lt;summary&gt;
    /// èªå¨å·æ°Token
    /// &lt;/summary&gt;
    /// &lt;param name="context"&gt;&lt;/param&gt;
    /// &lt;param name="httpContext"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public override async Task HandleAsync(AuthorizationHandlerContext context, DefaultHttpContext httpContext)
    {
        // è¥å½åè´¦å·å­å¨é»ååä¸­åææå¤±è´¥
        if (_sysCacheService.ExistKey($"{CacheConst.KeyBlacklist}{context.User.FindFirst(ClaimConst.UserId)?.Value}"))
        {
            context.Fail();
            context.GetCurrentHttpContext().SignoutToSwagger();
            return;
        }

        var tokenExpire = await _sysConfigService.GetTokenExpire();
        var refreshTokenExpire = await _sysConfigService.GetRefreshTokenExpire();
        if (JWTEncryption.AutoRefreshToken(context, context.GetCurrentHttpContext(), tokenExpire.Result, refreshTokenExpire.Result))
        {
            await AuthorizeHandleAsync(context);
        }
        else
        {
            context.Fail(); // ææå¤±è´¥
            var currentHttpContext = context.GetCurrentHttpContext();
            if (currentHttpContext == null) return;

            // è·³è¿ç±äº SignatureAuthentication å¼åçå¤±è´¥
            if (currentHttpContext.Items.ContainsKey(SignatureAuthenticationDefaults.AuthenticateFailMsgKey)) return;
            currentHttpContext.SignoutToSwagger();
        }
    }

    public override async Task&lt;bool&gt; PipelineAsync(AuthorizationHandlerContext context, DefaultHttpContext httpContext)
    {
        // å·²èªå¨éªè¯ Jwt Token æææ§
        return await CheckAuthorizeAsync(httpContext);
    }

    /// &lt;summary&gt;
    /// æéæ ¡éªæ ¸å¿é»è¾
    /// &lt;/summary&gt;
    /// &lt;param name="httpContext"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private static async Task&lt;bool&gt; CheckAuthorizeAsync(DefaultHttpContext httpContext)
    {
        // ç»å½æ¨¡å¼å¤æ­PCãAPP
        if (App.User.FindFirst(ClaimConst.LoginMode)?.Value == ((int)LoginModeEnum.APP).ToString())
            return true;

        // æé¤è¶ç®¡
        if (App.User.FindFirst(ClaimConst.AccountType)?.Value == ((int)AccountTypeEnum.SuperAdmin).ToString())
            return true;

        // è·¯ç±åç§°
        var routeName = httpContext.Request.Path.StartsWithSegments("/api")
            ? httpContext.Request.Path.Value![5..].Replace("/", ":")
            : httpContext.Request.Path.Value![1..].Replace("/", ":");

        // è·åç¨æ·æ¥ææé®æééå
        var ownBtnPermList = await SysMenuService.GetOwnBtnPermList();
        if (ownBtnPermList.Exists(u =&gt; routeName.Equals(u, StringComparison.CurrentCultureIgnoreCase)))
            return true;

        // è·åç³»ç»æææé®æééå
        var allBtnPermList = await SysMenuService.GetAllBtnPermList();
        return allBtnPermList.TrueForAll(u =&gt; !routeName.Equals(u, StringComparison.CurrentCultureIgnoreCase));
    }
}
</code></pre>
<h2 id="é¡¹ç®å°å">é¡¹ç®å°å</h2>
<p><a href="https://gitee.com/shiningrise/aspire-app" target="_blank" rel="noopener nofollow">AspireApp: Admin.NETå¾®æå¡ç</a></p>
<p><a href="https://gitee.com/zuohuaijun/Admin.NET" target="_blank" rel="noopener nofollow">Admin.NET: ð¥ð¥ð¥ Admin.NET åºäº .NET8/10 (Furion/SqlSugar) å®ç°çéç¨æéå¼åæ¡æ¶ï¼åç«¯éç¨ Vue3/Element-plusï¼ä»£ç ç®æ´ãææ©å±ãæ´åææ°ææ¯ï¼æ¨¡åæä»¶å¼å¼åï¼ååç«¯åç¦»ï¼å¼ç®±å³ç¨ãéæå¤ç§æ·ãç¼å­ãæ°æ®æ ¡éªãé´æãäºä»¶æ»çº¿ãå¨æAPIãéè®¯ãè¿ç¨è¯·æ±ãä»»å¡è°åº¦ãæå°ç­ä¼å¤é»ç§æãè®©å¼åæ´ç®åãæ´éç¨ãæ´æµè¡ï¼</a></p>


</div>
<div id="MySignature" role="contentinfo">
    æ¬¢è¿åä¸´:<font size="3"><font size="3"><a href="http://shiningrise.cnblogs.com/" target="_blank"><font size="3"><font size="3">http://shiningrise.cnblogs.com</font></font></a><br><br></font></font>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 15:44">2026-02-13 15:44</span>&nbsp;
<a href="https://www.cnblogs.com/shiningrise">shiningrise</a>&nbsp;
éè¯»(<span id="post_view_count">44</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19612443);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19612443', targetLink: 'https://www.cnblogs.com/shiningrise/p/19612443', title: 'Admin.NETå¼æºçå¾®æå¡æ¹é è®°å½' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Nano-vLLM-Ascend(æç»­æ´æ°ä¸­) ]]></title>
    <link>https://www.cnblogs.com/linzm14/p/19611415</link>
    <guid>77ceb1205f83ea4bef6298d3e832fb96</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/linzm14/p/19611415" title="åå¸äº 2026-02-13 11:38">
    <span role="heading" aria-level="2">Nano-vLLM-Ascend(æç»­æ´æ°ä¸­)</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="nano-vllm-ascend"><a href="https://github.com/linzm1007/nano-vllm-ascend" target="_blank" rel="noopener nofollow">Nano-vLLM-Ascend</a></h2>
<p>é¡¹ç®é¾æ¥ï¼<a href="https://github.com/linzm1007/nano-vllm-ascend" target="_blank" rel="noopener nofollow">https://github.com/linzm1007/nano-vllm-ascend</a><br>
nano-vllmæ¯githubå¼æºçä¸ä¸ªgpuæ¨çé¡¹ç®ï¼åºäºå¼æºçæ¬å¼çä¸ä¸ªascend npuçæ¬æ¨çå°demoï¼æ¨å¨å¸®å©åå­¦èäºè§£æ¨ççæ´ä½æµç¨ï¼åºå«äºvllmï¼nano-vllmä½éæ´å°ï¼éº»éè½å°äºèä¿±å¨ï¼æ´æå©äºåå­¦èå­¦ä¹ ï¼éå¸¸éåç¨äºç¸å³æ¦å¿µççè§£ã</p>
<h2 id="æ¡æ¶å±æµç¨å¾">æ¡æ¶å±æµç¨å¾</h2>
<p><img alt="nona-vllmæ¡æ¶" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2257481/202512/2257481-20251207210704152-770371883.png" class="lazyload"></p>
<h2 id="æ¨¡åå±æµç¨å¾">æ¨¡åå±æµç¨å¾</h2>
<p><img alt="Qwen3-0.6B" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2257481/202602/2257481-20260213113258305-186035462.png" class="lazyload"></p>
<h2 id="ç¹æ§">ç¹æ§</h2>
<ul>
<li>ð <strong>å¯è¯»ä»£ç åº</strong> - æ ¸å¿çº¦2428è¡Pythonä»£ç çæ¸æ°å®ç°</li>
<li>â¡ <strong>ä¼åå¥ä»¶</strong> - å¼ éå¹¶è¡ãtorchair Ascend IRå¾ç¼è¯åå¾ç¼å­ãèåç®å­ãåç¼ç¼å­ç­</li>
</ul>
<ul>
<li>[â] å¾å®æï¼ç®ååªæ¯æåç®å­, npuå¾æ¨¡å¼å®ç°</li>
<li>[â] æ¯æCPUç¯å¢è¿è¡ï¼<a href="https://github.com/linzm1007/nano-vllm-cpu" target="_blank" rel="noopener nofollow">nano-vllm-cpu ä»£ç ä»åº</a></li>
<li>[â] æ§è½ä¼å</li>
<li>[â³] æ¯ææ¨¡å: Qwen3-0.6BãQwen3-32BãQwen2-0.5BãQwen2.5-0.5BãQwen2.5-0.5B-InstructãLlama-3.2-1B-InstructãQwen3-30B-A3BãQwen3-VL-2B-InstructãMiniCPM4-0.5B</li>
<li>[â] æ¯æä¸ä¸ªmoeæ¨¡å:Qwen3-30B-A3B(ææ¶ä¸æ¯æå¥å¾)</li>
<li>[ð] æ¯æä¸ä¸ªomniæ¨¡å</li>
<li>[â] æ¯æä¸ä¸ªvlæ¨¡å:Qwen3-VL-2B-Instruct(ææ¶ä¸æ¯æå¥å¾)</li>
<li>[â] å®ç°page attention</li>
<li>[ð] å®ç°ä¸ä¸ªèªå®ä¹ç®å­</li>
<li>[ð] æ¯æå¨çº¿æ¨ç</li>
</ul>
<p>torchairæ¥å£åè <a href="https://www.hiascend.com/document/detail/zh/Pytorch/710/modthirdparty/torchairuseguide/torchair_00008.html" target="_blank" rel="noopener nofollow">https://www.hiascend.com/document/detail/zh/Pytorch/710/modthirdparty/torchairuseguide/torchair_00008.html</a><br>
èåç®å­æ¥å£åè <a href="https://www.hiascend.com/document/detail/zh/Pytorch/720/apiref/torchnpuCustomsapi/context/torch_npu-npu_fused_infer_attention_score_v2.md" target="_blank" rel="noopener nofollow">https://www.hiascend.com/document/detail/zh/Pytorch/720/apiref/torchnpuCustomsapi/context/torch_npu-npu_fused_infer_attention_score_v2.md</a><br>
attentionå®ç°åè <a href="https://gitee.com/omniai/omniinfer/blob/master/omni/layers/attention/backend/attention.py" target="_blank" rel="noopener nofollow">https://gitee.com/omniai/omniinfer/blob/master/omni/layers/attention/backend/attention.py</a>  forward_vanillaå½æ°</p>
<h2 id="æ¯æçæ¨¡å">æ¯æçæ¨¡å</h2>
<table>
<thead>
<tr>
<th>æ¶æ</th>
<th>æ¨¡å</th>
<th>ç¤ºä¾ HF æ¨¡å</th>
</tr>
</thead>
<tbody>
<tr>
<td>Qwen3ForCausalLM</td>
<td>Qwen3-0.6B,Qwen3-32B</td>
<td></td>
</tr>
<tr>
<td>Qwen2ForCausalLM</td>
<td>Qwen2-0.5B</td>
<td></td>
</tr>
<tr>
<td>LlamaForCausalLM</td>
<td>Llama-3.2-1B-Instruct</td>
<td></td>
</tr>
<tr>
<td>Qwen3MoeForCausalLM</td>
<td>Qwen3-30B-A3B</td>
<td></td>
</tr>
<tr>
<td>Qwen3VLForConditionalGeneration</td>
<td>Qwen2.5-VL-3B-Instruct</td>
<td></td>
</tr>
<tr>
<td>MiniCPMForCausalLM</td>
<td>MiniCPM4-0.5B</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="ä»£ç è¡æ°">ä»£ç è¡æ°</h2>
<p>ð æ»ä½æ°æ®</p>
<table>
<thead>
<tr>
<th>èå´</th>
<th>æä»¶æ°</th>
<th>æ»è¡æ°</th>
<th>å æ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>nanovllm å¨é¨</td>
<td>20 ä¸ª</td>
<td>4,652 è¡</td>
<td>100%</td>
</tr>
<tr>
<td>models ç®å½</td>
<td>5 ä¸ª</td>
<td>2,224 è¡</td>
<td>47.8%</td>
</tr>
<tr>
<td>é¤ models å¤</td>
<td>15 ä¸ª</td>
<td>2,428 è¡</td>
<td>52.2%</td>
</tr>
</tbody>
</table>
<h2 id="æ¨çä¼åææ¯å¤§çº²">æ¨çä¼åææ¯å¤§çº²</h2>
<p>ð <strong>å®æ´ææ¯ææ¡£</strong>ï¼<a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/inference_optimization_guide.md" target="_blank" rel="noopener nofollow">LLM æ¨çä¼åææ¯å¤§çº²</a></p>
<p>æ¬ææ¡£æ´çäº LLM æ¨çé¢åç <strong>20 å¤§ç±»å³é®ææ¯</strong>ï¼åä¸º 7 ä¸ªå±æ¬¡ï¼</p>
<h3 id="-æ ¸å¿ææ¯åºç¡å¿å¤">ð¥ æ ¸å¿ææ¯ï¼åºç¡å¿å¤ï¼</h3>
<ul>
<li><strong>KV Cache ç®¡ç</strong>ï¼PageAttentionãPrefix CachingãKV Cache åç¼©</li>
<li><strong>Attention ä¼å</strong>ï¼FlashAttentionãGQA/MQAãç¨çæ³¨æå</li>
<li><strong>æ¹å¤çç­ç¥</strong>ï¼Continuous BatchingãDynamic Batching</li>
</ul>
<h3 id="-æ§è½ä¼åè¿é¶">ð æ§è½ä¼åï¼è¿é¶ï¼</h3>
<ul>
<li><strong>éåææ¯</strong>ï¼INT8/INT4/FP8ãAWQãGPTQãGGUF</li>
<li><strong>ææºéæ ·</strong>ï¼Speculative DecodingãMedusaãLookahead</li>
<li><strong>è§£ç ä¼å</strong>ï¼Parallel DecodingãToken Tree Verification</li>
</ul>
<h3 id="ï¸-ç³»ç»æ¶æ">ðï¸ ç³»ç»æ¶æ</h3>
<ul>
<li><strong>è°åº¦ç­ç¥</strong>ï¼FCFSãSJFãPriority-basedãPreemption</li>
<li><strong>åå­ä¼å</strong>ï¼Memory PoolãSwappingãOffloading</li>
<li><strong>å¹¶è¡ç­ç¥</strong>ï¼Tensor/Pipeline/Expert/Sequence Parallelism</li>
</ul>
<h3 id="-ç¹æ®åºæ¯">ð§  ç¹æ®åºæ¯</h3>
<ul>
<li><strong>é¿ä¸ä¸æ</strong>ï¼RoPE ScalingãStreamingLLMãRing Attention</li>
<li><strong>å¤æ¨¡æ</strong>ï¼Vision-LanguageãAudio-LanguageãUnified Architecture</li>
<li><strong>MoE ä¼å</strong>ï¼Expert RoutingãLoad BalancingãAll-to-All éä¿¡</li>
</ul>
<h3 id="-åºå±ä¼å">â¡ åºå±ä¼å</h3>
<ul>
<li><strong>å¾ç¼è¯</strong>ï¼TorchAirãTensorRT-LLMãTorch.compile</li>
<li><strong>ç®å­èå</strong>ï¼QKV FusionãCustom CUDA/Triton Kernels</li>
<li><strong>éä¿¡ä¼å</strong>ï¼NCCL/HCCLãRDMAãGPUDirect</li>
</ul>
<h3 id="-è¯ä¼°è§æµ">ð è¯ä¼°è§æµ</h3>
<ul>
<li><strong>æ§è½åæ</strong>ï¼Memory/Compute ProfilingãRoofline Analysis</li>
<li><strong>å³é®ææ </strong>ï¼TTFTãTPOTãThroughputãGPU Utilization</li>
</ul>
<h3 id="-åæ²¿è¶å¿">ð® åæ²¿è¶å¿</h3>
<ul>
<li><strong>æ¨¡åæ¶æ</strong>ï¼Mamba/RWKVãMixture of DepthsãRetNet</li>
<li><strong>æå¡å</strong>ï¼Disaggregated ServingãElastic Scaling</li>
<li><strong>æ°å´æ¹å</strong>ï¼æ¨çè¸é¦ãEarly ExitãHardware-Aware NAS</li>
</ul>
<hr>
<h2 id="attention">Attention</h2>
<h3 id="pageattention">PageAttention</h3>
<p><strong>PageAttention</strong> æ¯ vLLM çæ ¸å¿åæ°ææ¯ï¼çµææ¥èªæä½ç³»ç»ç<strong>èæåå­åé¡µæºå¶</strong>ï¼ç¨äºé«æç®¡ç LLM æ¨çä¸­ç KV Cacheã</p>
<h4 id="æ ¸å¿æ¦å¿µ">æ ¸å¿æ¦å¿µ</h4>
<p>ä¼ ç» KV Cache åéæ¹å¼ä¼ä¸ºæ¯ä¸ªåºåé¢åéæå¤§å¯è½é¿åº¦çè¿ç»­åå­ï¼å¯¼è´ä¸¥éçåå­æµªè´¹åç¢çãPageAttention åé´æä½ç³»ç»åé¡µææ³ï¼å° KV Cache ååä¸ºåºå®å¤§å°ç blockï¼æéå¨æåéã</p>
<h4 id="å³é®ææ¯ç¹">å³é®ææ¯ç¹</h4>
<table>
<thead>
<tr>
<th>ææ¯</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Block ç®¡ç</strong></td>
<td>å° KV Cache ååä¸ºåºå®å¤§å°ç blockï¼å¦ 16/32 tokensï¼ï¼æ¯ä¸ª block ç¬ç«åé</td>
</tr>
<tr>
<td><strong>Block Table</strong></td>
<td>ç±»ä¼¼é¡µè¡¨çæ°æ®ç»æï¼è®°å½é»è¾ token ä½ç½®å°ç©ç block çæ å°å³ç³»</td>
</tr>
<tr>
<td><strong>éè¿ç»­å­å¨</strong></td>
<td>åä¸åºåç KV Cache å¯ä»¥åæ£å¨å¤ä¸ªä¸è¿ç»­ç block ä¸­</td>
</tr>
<tr>
<td><strong>åå­å±äº«</strong></td>
<td>å¹¶è¡è§£ç ï¼å¦ beam searchï¼æ¶å¯å±äº« prompt ç KV cache</td>
</tr>
<tr>
<td><strong>Copy-on-Write</strong></td>
<td>åæ¶å¤å¶æºå¶ï¼ä»å¨éè¦ä¿®æ¹æ¶æå¤å¶ block</td>
</tr>
</tbody>
</table>
<h4 id="åå­ä½¿ç¨å¯¹æ¯">åå­ä½¿ç¨å¯¹æ¯</h4>
<pre><code>ä¼ ç»æ¹å¼ï¼
- åºåé¿åº¦ 1000ï¼æå¤§æ¯æ 4096
- åå­å ç¨ï¼4096 * hidden_size
- æµªè´¹çï¼çº¦ 75%

PageAttentionï¼
- åºåé¿åº¦ 1000ï¼block_size=16
- éè¦ blockï¼1000/16 = 63 ä¸ª
- å®éåéï¼63 * 16 = 1008 tokens
- æµªè´¹çï¼ä» 0.8%
</code></pre>
<h4 id="ä»£ç å®ç°">ä»£ç å®ç°</h4>
<pre><code class="language-python"># nanovllm/layers/attention.py
# Block Table æ å°
block_table = context.block_tables  # æ å°è¡¨

# Slot Mapping - å° token æ å°å° block ä¸­çå·ä½ä½ç½®
# slot_mapping æ ¼å¼ï¼[block_idx, offset_in_block]
context.slot_mapping

# åé¡µå­å¨ KV Cache
torch_npu._npu_reshape_and_cache(
    k, v,
    k_cache.view(num_blocks, block_size, num_kv_heads, head_dim),
    v_cache.view(num_blocks, block_size, num_kv_heads, head_dim),
    slot_mapping.int()
)
</code></pre>
<h4 id="ä¼å¿">ä¼å¿</h4>
<ol>
<li><strong>åå­æç</strong>ï¼æéåéï¼æ åé¨ç¢ç</li>
<li><strong>å¨ææ©å±</strong>ï¼åºåå¢é¿æ¶åªéåéæ° block</li>
<li><strong>åå­å±äº«</strong>ï¼å¤ä¸ªåºåå¯å±äº«ç¸åç prompt KV Cache</li>
<li><strong>é«ååé</strong>ï¼æ¯ææ´å¤§ç batch size</li>
</ol>
<h4 id="è¯¦ç»å¯¹æ¯">è¯¦ç»å¯¹æ¯</h4>
<p>ð <strong>è¯¦ç»ææ¯ææ¡£</strong>ï¼<a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/pageattention_comparison.md" target="_blank" rel="noopener nofollow">HuggingFace Transformers æ©æå®ç°ä¸ PageAttention å¯¹æ¯</a></p>
<p>åå«ï¼</p>
<ul>
<li>æ©æ Transformers ä»£ç å®ç°åæ</li>
<li>åå­æµªè´¹çéåå¯¹æ¯ï¼75% vs 6.25%ï¼</li>
<li>ä¸å batch size ååºåé¿åº¦çè¯¦ç»å¯¹æ¯è¡¨</li>
<li>vLLM è®ºææ°æ®æ¥æºè¯´æ</li>
<li>å®éä»£ç ç¤ºä¾ååºæ¯åæ</li>
</ul>
<hr>
<h3 id="flashattention">FlashAttention</h3>
<p><strong>FlashAttention</strong> æ¯æ¯å¦ç¦å¤§å­¦æåºç <strong>IO æç¥</strong> æ³¨æåä¼åç®æ³ï¼éè¿ååè®¡ç®ååå° HBMï¼é«å¸¦å®½åå­ï¼è®¿é®æ¥æåæ§è½ã</p>
<h4 id="æ ¸å¿é®é¢">æ ¸å¿é®é¢</h4>
<p>æ å Attention å®ç°éè¦å­å¨ä¸­é´ç»æï¼æ³¨æåç©éµï¼å° HBMï¼å¯¼è´ï¼</p>
<ul>
<li><strong>åå­ç¶é¢</strong>ï¼HBM å¸¦å®½è¿ä½äºè®¡ç®éåº¦</li>
<li><strong>O(NÂ²) åå­</strong>ï¼åºåé¿åº¦çå¹³æ¹çº§åå­å¢é¿</li>
<li><strong>å¤æ¬¡æ°æ®æ¬è¿</strong>ï¼QãKãV éè¦å¤æ¬¡è¯»å HBM</li>
</ul>
<h4 id="æ ¸å¿åæ°">æ ¸å¿åæ°</h4>
<table>
<thead>
<tr>
<th>ææ¯</th>
<th>åç</th>
<th>ææ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Tilingï¼ååï¼</strong></td>
<td>å° QãKãV ååå è½½å°é«é SRAM</td>
<td>åå° HBM è®¿é®æ¬¡æ°</td>
</tr>
<tr>
<td><strong>Online Softmax</strong></td>
<td>æµå¼è®¡ç® softmaxï¼æ éå®æ´æ³¨æåç©éµ</td>
<td>åå­éè³ O(N)</td>
</tr>
<tr>
<td><strong>Recomputation</strong></td>
<td>ååä¼ æ­æ¶éæ°è®¡ç®ä¸­é´å¼</td>
<td>çºç²è®¡ç®æ¢åå­</td>
</tr>
<tr>
<td><strong>Kernel Fusion</strong></td>
<td>å¤ä¸ªæä½èåä¸ºåä¸ª CUDA kernel</td>
<td>åå° kernel å¯å¨å¼é</td>
</tr>
</tbody>
</table>
<h4 id="åå­å±æ¬¡ç»æå¯¹æ¯">åå­å±æ¬¡ç»æå¯¹æ¯</h4>
<pre><code>GPU åå­å±æ¬¡ï¼
âââââââââââââââââââââââââââââââââââââââ
â  HBM (High Bandwidth Memory)        â  â 1.5 TB/sï¼å®¹éå¤§ä½éåº¦æ¢
â  - å®¹éï¼40-80 GB                   â  â æ å Attention å¨æ­¤é¢ç¹è¯»å
â  - å»¶è¿ï¼é«                         â
âââââââââââââââââââââââââââââââââââââââ¤
â  SRAM (Static RAM / Shared Memory)  â  â 19 TB/sï¼å®¹éå°ä½éåº¦å¿«
â  - å®¹éï¼~100 KB per SM             â  â FlashAttention ä¸»è¦å¨æ­¤è®¡ç®
â  - å»¶è¿ï¼æä½                       â
âââââââââââââââââââââââââââââââââââââââ
</code></pre>
<h4 id="è®¡ç®æµç¨å¯¹æ¯">è®¡ç®æµç¨å¯¹æ¯</h4>
<p><strong>æ å Attentionï¼</strong></p>
<pre><code>1. ä» HBM å è½½ Q, K, V
2. è®¡ç® S = QK^T â åå¥ HBM
3. è®¡ç® P = softmax(S) â åå¥ HBM  
4. è®¡ç® O = PV â åå¥ HBM
â å¤æ¬¡ HBM è¯»åï¼åå­å ç¨ O(NÂ²)
</code></pre>
<p><strong>FlashAttentionï¼</strong></p>
<pre><code>1. ååå è½½ Qáµ¢, Kâ±¼, Vâ±¼ å° SRAM
2. å¨ SRAM ä¸­è®¡ç® softmax
3. ç´¯å ç»æå°è¾åº
4. ä¸¢å¼ä¸­é´ç»æï¼éå¤ç´å°å®æ
â ä»é O(N) åå­ï¼å¤§å¹åå° HBM è®¿é®
</code></pre>
<h4 id="ä»£ç å®ç°-1">ä»£ç å®ç°</h4>
<pre><code class="language-python"># nanovllm/layers/attention_ori.py
from flash_attn import (
    flash_attn_varlen_func,      # Prefill é¶æ®µ
    flash_attn_with_kvcache      # Decode é¶æ®µ
)

# Prefill - å¤çåé¿åºåï¼æ¯æ PageAttention
flash_attn_varlen_func(
    q, k, v,
    max_seqlen_q=max_seqlen_q,
    cu_seqlens_q=cu_seqlens_q,    # ç´¯è®¡é¿åº¦æ¯æåé¿
    causal=True,                  # å ææ©ç 
    block_table=block_table       # PageAttention block table
)

# Decode - å token æ¨çï¼å¤ç¨åé¡µ KV Cache
flash_attn_with_kvcache(
    q.unsqueeze(1),               # [batch, 1, num_heads, head_dim]
    k_cache, v_cache,             # åé¡µ KV ç¼å­
    cache_seqlens=context_lens,   # å®éåºåé¿åº¦
    block_table=block_table       # block table æ å°
)
</code></pre>
<h4 id="æ§è½æ¶ç">æ§è½æ¶ç</h4>
<ul>
<li><strong>åå­æç</strong>ï¼ä» O(NÂ²) éè³ O(N)</li>
<li><strong>è®¡ç®éåº¦</strong>ï¼A100 ä¸å¯è¾¾ <strong>2-4 å</strong>å é</li>
<li><strong>åºåé¿åº¦</strong>ï¼æ¯ææ´é¿çä¸ä¸æï¼å¦ 100K+ tokensï¼</li>
</ul>
<hr>
<h3 id="ä¸ç§-attention-å®ç°å¯¹æ¯">ä¸ç§ Attention å®ç°å¯¹æ¯</h3>
<p>æ¬é¡¹ç®åå«ä¸ç§ Attention å®ç°ï¼éç¨äºä¸ååºæ¯ï¼</p>
<table>
<thead>
<tr>
<th>ç¹æ§</th>
<th>attention_ori.py</th>
<th>attention.py</th>
<th>attention_torch_native.py</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åºå±å®ç°</strong></td>
<td>Flash Attention åº</td>
<td>NPU åçç®å­</td>
<td>PyTorch åç</td>
</tr>
<tr>
<td><strong>éç¨å¹³å°</strong></td>
<td>CUDA GPU</td>
<td>åä¸ºæè¾ NPU</td>
<td>éç¨ï¼CPU/GPUï¼</td>
</tr>
<tr>
<td><strong>æ§è½</strong></td>
<td>â­â­â­â­â­</td>
<td>â­â­â­â­â­</td>
<td>â­â­</td>
</tr>
<tr>
<td><strong>å¯è¯»æ§</strong></td>
<td>â­â­</td>
<td>â­â­</td>
<td>â­â­â­â­â­</td>
</tr>
<tr>
<td><strong>ç¨é</strong></td>
<td>çäº§ç¯å¢ï¼GPUï¼</td>
<td>çäº§ç¯å¢ï¼NPUï¼</td>
<td>å­¦ä¹ è°è¯</td>
</tr>
</tbody>
</table>
<p><strong>éæ©å»ºè®®ï¼</strong></p>
<ul>
<li><strong>çäº§ç¯å¢ï¼GPUï¼</strong>ï¼ä½¿ç¨ <code>attention_ori.py</code>ï¼Flash Attentionï¼</li>
<li><strong>çäº§ç¯å¢ï¼æè¾ NPUï¼</strong>ï¼ä½¿ç¨ <code>attention.py</code>ï¼NPU ç®å­ï¼</li>
<li><strong>å­¦ä¹ /è°è¯</strong>ï¼ä½¿ç¨ <code>attention_torch_native.py</code>ï¼æäºçè§£ï¼</li>
</ul>
<h2 id="ææ¡£ç´¢å¼">ææ¡£ç´¢å¼</h2>
<p>æ¬ç®å½åå«é¡¹ç®åæ¨¡åçè¯¦ç»æµç¨å¾ææ¡£ï¼ä½¿ç¨ Mermaid è¯­æ³ç»å¶ã</p>
<h3 id="engine-æ¨¡åæµç¨å¾">Engine æ¨¡åæµç¨å¾</h3>
<table>
<thead>
<tr>
<th>ææ¡£</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/engine/sequence_flowchart.md" target="_blank" rel="noopener nofollow">docs/engine/sequence_flowchart.md</a></td>
<td>Sequence åºåç¶æç®¡çæµç¨</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/engine/block_manager_flowchart.md" target="_blank" rel="noopener nofollow">docs/engine/block_manager_flowchart.md</a></td>
<td>BlockManager KVç¼å­åç®¡çæµç¨</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/engine/scheduler_flowchart.md" target="_blank" rel="noopener nofollow">docs/engine/scheduler_flowchart.md</a></td>
<td>Scheduler è°åº¦å¨æµç¨</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/engine/model_runner_flowchart.md" target="_blank" rel="noopener nofollow">docs/engine/model_runner_flowchart.md</a></td>
<td>ModelRunner æ¨¡åè¿è¡å¨æµç¨</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/engine/llm_engine_flowchart.md" target="_blank" rel="noopener nofollow">docs/engine/llm_engine_flowchart.md</a></td>
<td>LLMEngine ä¸»å¼ææµç¨</td>
</tr>
</tbody>
</table>
<h3 id="layers-æ¨¡åæµç¨å¾">Layers æ¨¡åæµç¨å¾</h3>
<table>
<thead>
<tr>
<th>ææ¡£</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/linear_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/linear_flowchart.md</a></td>
<td>çº¿æ§å±ä¸å¼ éå¹¶è¡ç­ç¥</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/attention_torch_native_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/attention_torch_native_flowchart.md</a></td>
<td>PyTorchåçAttentionå®ç°</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/attention_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/attention_flowchart.md</a></td>
<td>NPUä¸ç¨Attentionå®ç°</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/attention_ori_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/attention_ori_flowchart.md</a></td>
<td>Flash Attentionä¼åå®ç°</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/sampler_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/sampler_flowchart.md</a></td>
<td>éæ ·å¨ï¼æ¸©åº¦éæ ·ï¼</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/rotary_embedding_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/rotary_embedding_flowchart.md</a></td>
<td>RoPEä½ç½®ç¼ç </td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/layernorm_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/layernorm_flowchart.md</a></td>
<td>RMSNormå½ä¸åå±</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/embed_head_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/embed_head_flowchart.md</a></td>
<td>è¯åµå¥ä¸LM Head</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/activation_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/activation_flowchart.md</a></td>
<td>SwiGLUæ¿æ´»å½æ°</td>
</tr>
</tbody>
</table>
<h3 id="models-æ¨¡åæµç¨å¾">Models æ¨¡åæµç¨å¾</h3>
<table>
<thead>
<tr>
<th>ææ¡£</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/models/llama_flowchart.md" target="_blank" rel="noopener nofollow">docs/models/llama_flowchart.md</a></td>
<td>Llamaæ¨¡åæ¶æ</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/models/qwen3_flowchart.md" target="_blank" rel="noopener nofollow">docs/models/qwen3_flowchart.md</a></td>
<td>Qwen3æ¨¡åæ¶æ</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/models/qwen3_vl_flowchart.md" target="_blank" rel="noopener nofollow">docs/models/qwen3_vl_flowchart.md</a></td>
<td>Qwen3-VLå¤æ¨¡ææ¨¡åæ¶æ</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/models/qwen3_moe_flowchart.md" target="_blank" rel="noopener nofollow">docs/models/qwen3_moe_flowchart.md</a></td>
<td>Qwen3-MoEç¨çä¸å®¶æ¨¡åæ¶æ</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/models/mini_cpm4_flowchart.md" target="_blank" rel="noopener nofollow">docs/models/mini_cpm4_flowchart.md</a></td>
<td>MiniCPM4æ¨¡åæ¶æ</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/models/models_map_flowchart.md" target="_blank" rel="noopener nofollow">docs/models/models_map_flowchart.md</a></td>
<td>æ¨¡åæ³¨åæ å°å³ç³»</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="benchæ°æ®">benchæ°æ®</h2>
<p>ä»ä¾åèï¼ç¡¬è½¯æ¡ä»¶ä¸åï¼è·åºçæ°æ®ä¹ä¼æå·®å¼</p>
<h4 id="ä¸åæ¨¡åå¯¹æ¯">ä¸åæ¨¡åå¯¹æ¯</h4>
<table>
<thead>
<tr>
<th>model</th>
<th>Output Tokens</th>
<th>Time (s)</th>
<th>Throughput (tokens/s)</th>
<th>TP</th>
</tr>
</thead>
<tbody>
<tr>
<td>Qwen3-0.6B</td>
<td>143,770</td>
<td>36.82</td>
<td>3904.20</td>
<td>1</td>
</tr>
<tr>
<td>Qwen2-0.5B</td>
<td>143,770</td>
<td>20.71</td>
<td>6940.84</td>
<td>1</td>
</tr>
<tr>
<td>Qwen2.5-0.5B-Instruct</td>
<td>143,770</td>
<td>19.82</td>
<td>7252.67</td>
<td>1</td>
</tr>
<tr>
<td>Llama-3.2-1B-Instruct</td>
<td>143,770</td>
<td>25.45</td>
<td>5648.50</td>
<td>1</td>
</tr>
<tr>
<td>Qwen3-32B</td>
<td>143,770</td>
<td>206.69</td>
<td>695.59</td>
<td>2</td>
</tr>
<tr>
<td>Qwen3-32B</td>
<td>143,770</td>
<td>119.86</td>
<td>1199.50</td>
<td>4</td>
</tr>
</tbody>
</table>
<h4 id="å¶ä»æ¡æ¶å¯¹æ¯2025-12-30">å¶ä»æ¡æ¶å¯¹æ¯(2025-12-30)</h4>
<p>vLLM Nano-vLLM æ°æ®æ¥æº <a href="https://github.com/GeeeekExplorer/nano-vllm" target="_blank" rel="noopener nofollow">https://github.com/GeeeekExplorer/nano-vllm</a></p>
<table>
<thead>
<tr>
<th>Inference Engine</th>
<th>Output Tokens</th>
<th>Time (s)</th>
<th>Throughput (tokens/s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>vLLM</td>
<td>133,966</td>
<td>98.37</td>
<td>1361.84</td>
</tr>
<tr>
<td>Nano-vLLM</td>
<td>133,966</td>
<td>93.41</td>
<td>1434.13</td>
</tr>
<tr>
<td>Nano-vLLM-Ascend python torchåçå®ç°</td>
<td>4805</td>
<td>257.49</td>
<td>18.66</td>
</tr>
<tr>
<td>Nano-vLLM-Ascend èåç®å­+å¾ç¼è¯bs=256</td>
<td>133,966</td>
<td>33.88</td>
<td>3954.20</td>
</tr>
</tbody>
</table>
<h4 id="å¾æ¨¡å¼ä¸åbså¯¹æ¯2025-12-30">å¾æ¨¡å¼ä¸åbså¯¹æ¯(2025-12-30)</h4>
<table>
<thead>
<tr>
<th>Batch Size</th>
<th>Output Tokens</th>
<th>Time (s)</th>
<th>Throughput (tokens/s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>bs=16</td>
<td>133,966</td>
<td>107.23</td>
<td>1249.37</td>
</tr>
<tr>
<td>bs=32</td>
<td>133,966</td>
<td>75.89</td>
<td>1765.35</td>
</tr>
<tr>
<td>bs=48</td>
<td>133,966</td>
<td>64.84</td>
<td>2066.22</td>
</tr>
<tr>
<td>bs=64</td>
<td>133,966</td>
<td>54.06</td>
<td>2478.31</td>
</tr>
<tr>
<td>bs=128</td>
<td>133,966</td>
<td>43.08</td>
<td>3109.56</td>
</tr>
<tr>
<td>bs=256</td>
<td>133,966</td>
<td>33.88</td>
<td>3954.20</td>
</tr>
</tbody>
</table>
<h4 id="åç®å­paddingånon-paddingå¯¹æ¯2025-12-30">åç®å­PaddingåNon-paddingå¯¹æ¯(2025-12-30)</h4>
<p>bs=256</p>
<table>
<thead>
<tr>
<th>Prepare Strategy</th>
<th>Output Tokens</th>
<th>Time (s)</th>
<th>Throughput (tokens/s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Padding</td>
<td>133,966</td>
<td>158.46</td>
<td>845.41</td>
</tr>
<tr>
<td>Non-padding</td>
<td>133,966</td>
<td>152.14</td>
<td>880.55</td>
</tr>
</tbody>
</table>
<h2 id="ç¯å¢æ­å»ºåèvllm-ascend">ç¯å¢æ­å»ºï¼åèvllm-ascendï¼</h2>
<p><a href="https://docs.vllm.ai/projects/vllm-ascend-cn/zh-cn/latest/quick_start.html" target="_blank" rel="noopener nofollow">https://docs.vllm.ai/projects/vllm-ascend-cn/zh-cn/latest/quick_start.html</a></p>
<p>ubuntu</p>
<pre><code># Update DEVICE according to your device (/dev/davinci[0-7])
export DEVICE=/dev/davinci0
# Update the vllm-ascend image
# Atlas A2:
# export IMAGE=quay.io/ascend/vllm-ascend:v0.14.0rc1
# Atlas A3:
# export IMAGE=quay.io/ascend/vllm-ascend:v0.14.0rc1-a3
export IMAGE=quay.io/ascend/vllm-ascend:v0.14.0rc1
docker run --rm \
--name vllm-ascend \
--shm-size=1g \
--device $DEVICE \
--device /dev/davinci_manager \
--device /dev/devmm_svm \
--device /dev/hisi_hdc \
-v /usr/local/dcmi:/usr/local/dcmi \
-v /usr/local/bin/npu-smi:/usr/local/bin/npu-smi \
-v /usr/local/Ascend/driver/lib64/:/usr/local/Ascend/driver/lib64/ \
-v /usr/local/Ascend/driver/version.info:/usr/local/Ascend/driver/version.info \
-v /etc/ascend_install.info:/etc/ascend_install.info \
-v /root/.cache:/root/.cache \
-p 8000:8000 \
-it $IMAGE bash
# Install curl
apt-get update -y &amp;&amp; apt-get install -y curl
</code></pre>
<h2 id="å®è£ä¾èµ">å®è£ä¾èµ</h2>
<pre><code class="language-bash">pip install .
</code></pre>
<h2 id="æ¨¡åä¸è½½">æ¨¡åä¸è½½</h2>
<pre><code class="language-bash">huggingface-cli download --resume-download Qwen/Qwen3-0.6B \
  --local-dir ~/huggingface/Qwen3-0.6B/ \
  --local-dir-use-symlinks False
</code></pre>
<h2 id="å¿«éå¼å§">å¿«éå¼å§</h2>
<p>è¯·åè§ example.py äºè§£ç¨æ³ãè¯¥ API ä¸ vLLM çæ¥å£åºæ¬ä¸è´ï¼ä»å¨ LLM.generate æ¹æ³ä¸å­å¨ä¸äºç»å¾®å·®å¼ï¼</p>
<pre><code class="language-python">from nanovllm import LLM, SamplingParams
llm = LLM("/YOUR/MODEL/PATH", enforce_eager=True, tensor_parallel_size=1)
sampling_params = SamplingParams(temperature=0.6, max_tokens=256)
prompts = ["Hello, Nano-vLLM."]
outputs = llm.generate(prompts, sampling_params)
outputs[0]["text"]
</code></pre>
<h2 id="exampleè¿è¡ç»æ">exampleè¿è¡ç»æ</h2>
<p><img alt="result-image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2257481/202512/2257481-20251207210731923-1974827089.png" class="lazyload"></p>
<h2 id="benchç¯å¢">benchç¯å¢</h2>
<p>ä»ä¾åè<br>
ascend-dmi -c #æ¥ç</p>
<ul>
<li>ç¡¬ä»¶ç¯å¢âï¼
<ul>
<li>1.æ¾å¡:A3 910C</li>
<li>2.é©±å¨çæ¬:24.1.rc3.10</li>
<li>3.åºä»¶çæ¬:7.5.0.109.220</li>
</ul>
</li>
<li>âè½¯ä»¶ç¯å¢âï¼
<ul>
<li>1.CANNå 8.3.RC1</li>
<li>2.PTAçæ¬ï¼torch-npu 2.5.1.post2+gitd7a85f8ï¼torch 2.5.1</li>
</ul>
</li>
</ul>
<h2 id="benchmark">Benchmark</h2>
<p>See <code>bench.py</code> for benchmark.</p>
<p><strong>Test Configuration:</strong></p>
<ul>
<li>Model: Qwen3-0.6B</li>
<li>Total Requests: 256 sequences</li>
<li>Input Length: Randomly sampled between 100â1024 tokens</li>
<li>Output Length: Randomly sampled between 100â1024 tokens</li>
</ul>
<p><strong>Performance Results:</strong><br>
Nano-vLLM-Ascend å®å¨å¤ªæ¢äºåªè·äº10æ¡seq</p>
<table>
<thead>
<tr>
<th>Inference Engine</th>
<th>Output Tokens</th>
<th>Time (s)</th>
<th>Throughput (tokens/s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>vLLM</td>
<td>133,966</td>
<td>98.37</td>
<td>1361.84</td>
</tr>
<tr>
<td>Nano-vLLM</td>
<td>133,966</td>
<td>93.41</td>
<td>1434.13</td>
</tr>
<tr>
<td>Nano-vLLM-Ascend</td>
<td>4805</td>
<td>257.49</td>
<td>18.66</td>
</tr>
</tbody>
</table>
<h2 id="qwen3-06b-layers">qwen3-0.6B layers</h2>
<pre><code class="language-angular2html">ModuleList(
  (0-27): 28 x Qwen3DecoderLayer(
    (self_attn): Qwen3Attention(
      (qkv_proj): QKVParallelLinear()
      (o_proj): RowParallelLinear()
      (rotary_emb): RotaryEmbedding()
      (attn): Attention()
      (q_norm): RMSNorm()
      (k_norm): RMSNorm()
    )
    (mlp): Qwen3MLP(
      (gate_up_proj): MergedColumnParallelLinear()
      (down_proj): RowParallelLinear()
      (act_fn): SiluAndMul()
    )
    (input_layernorm): RMSNorm()
    (post_attention_layernorm): RMSNorm()
  )
)

</code></pre>


</div>
<div id="MySignature" role="contentinfo">
    èå¤©åç½äºæ¯æ éã
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.03680555555555556" data-date-updated="2026-02-13 12:31">2026-02-13 11:38</span>&nbsp;
<a href="https://www.cnblogs.com/linzm14">linzm14</a>&nbsp;
éè¯»(<span id="post_view_count">15</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19611415);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19611415', targetLink: 'https://www.cnblogs.com/linzm14/p/19611415', title: 'Nano-vLLM-Ascend(æç»­æ´æ°ä¸­)' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ çº¿ä¸æå¡éå¯åï¼ä»nacosåä¸å°éç½®äºï¼æä¹åäº ]]></title>
    <link>https://www.cnblogs.com/grey-wolf/p/19611093</link>
    <guid>905e53fe322123f994c4bf32f6340e78</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/grey-wolf/p/19611093" title="åå¸äº 2026-02-13 10:19">
    <span role="heading" aria-level="2">çº¿ä¸æå¡éå¯åï¼ä»nacosåä¸å°éç½®äºï¼æä¹åäº</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="èæ¯">èæ¯</h1>
<p>åä¸éµï¼çº¿ä¸æä¸ªæå¡åçº§ï¼å¸åçspring bootåºç¨ï¼å¼å¥äºspring cloudï¼ä¸»è¦æ¯ä¸ºäºä½¿ç¨nacosæ¥ç»ä¸ç®¡çéç½®ã</p>
<p>å¸åçbootstrap.ymléç½®å¦ä¸ï¼åå«äºç¨æ·åå¯ç ï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213093118522.png" alt="image-20260213093118522" loading="lazy"></p>
<p>æå¡å¯å¨æ¶ï¼å°±ä¼å»nacosè¯»åéç½®ï¼è¯»åéç½®å½ç¶è¦åç»å½ï¼è¿ééç½®çç¨æ·åå¯ç å°±æ¯ç»å½ç¨çã</p>
<p>æä»¬éå°çé®é¢æ¯ï¼çº¿ä¸é£ä¸ªæå¡ï¼ä¸æ¯ç¬¬ä¸æ¬¡ä¸çº¿ï¼ä¸ç´è·å¾å¥½å¥½çï¼æ¬æ¬¡æ´æ°ä¸»è¦æ¯æ´æ°äºfat jarï¼æ¹äºç¹ä¸å¡é»è¾ï¼åbootstrap.ymlè¿äºæ²¡ä»»ä½æ¹å¨ãç»æè¿ç»´åäºæ¿æ¢äºjarååä¸éå¯ï¼è¯´å¯å¨ä¸äºï¼è¯´ä½ è¿ä¸ªåæ¯ä¸æ¯æé®é¢åã</p>
<h1 id="å®ä½è¿ç¨">å®ä½è¿ç¨</h1>
<h2 id="æå">æå</h2>
<p>è¿å»è¿ç»´é£è¾¹çäºä¸ï¼åç°æ¥éæ¯è¯´ä»ä¹æ°æ®åºè¿ä¸ä¸ï¼ipä¸çï¼æ¯å¼åç¯å¢çæ°æ®åºipï¼æå°±æè§æ¯ä¸æ¯æ²¡åå°nacoséçéç½®ï¼æä»¥ç¨äºé»è®¤çå¼åç¯å¢éç½®äºï¼fat jarä¸­æé»è®¤çå¼åç¯å¢éç½®æä»¶ï¼ã</p>
<p>æå°±è¯´è¿å¾æä¸ªåççï¼nacosççå¬ç«¯å£æ¯8848ï¼ä¸»è¦ç¨äºç»å½ï¼è·åtokenï¼è¿æ9849ï¼ç¨äºæå¡æ³¨åãéç½®æåç­ã</p>
<pre><code class="language-shell">tcpdump -i any tcp port 8848 or tcp port 9848 -w nacos.pcap
</code></pre>
<p>æåæä¸æ¥ä¸çï¼åç°ç¡®å®æ²¡æåå°éç½®ï¼ä½æ¯ï¼åå æ¯ç»å½å°±å¤±è´¥äºã</p>
<p>æ¥æå¦ä¸ï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213093813785.png" alt="image-20260213093813785" loading="lazy"></p>
<h2 id="ç½é¡µç«¯ç»å½">ç½é¡µç«¯ç»å½</h2>
<p>é¾éæ¯å¯ç éäºåï¼ç¶ååæ ·çç¨æ·å¯ç ï¼å¨nacosç®¡çç³»ç»é£éç»å½ï¼åç°æ¯æ­£å¸¸çãè¿ä¸ªç¡®å®æ¯å¾å¥æªï¼F12çäºä¸ï¼çäºæ¥å£ä¹æ¯ä¸é¢é£ä¸ªæ¥å£ã</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213094323596.png" alt="image-20260213094323596" loading="lazy"></p>
<p>å¯ä¸ä¸åçä¹å°±æ¯åæ°æºå¸¦æ¹å¼æä¸ç¹å·®å¼ï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213094353557.png" alt="image-20260213094353557" loading="lazy"></p>
<p>è¿ä¸ªç½é¡µç«¯ï¼æ¯ç¨æ·åãå¯ç é½å¨formè¡¨åçhttp bodyéãèapié£è¾¹ï¼æ¯usernameå¨urléï¼å¯ç å¨bodyéã</p>
<h2 id="æäºº">æäºº</h2>
<p>ç¶åæä»¬å°±ç¡®è®¤æ¯nacos æå¡ç«¯æè§æç¹é®é¢ãå¦å¤ï¼æä»¬ä¹æ¾äºå¶ä»ç±»ä¼¼çæå¡Aï¼æé£ä¸ªæå¡Aç¨çnacosç¨æ·åãå¯ç æ¿è¿æ¥ï¼éç½®å°æ¬æå¡éï¼éå¯ï¼åç°ç«ç¶ä¹æ¥åæ ·çéè¯¯ã</p>
<p>ç¶åå°±æè§æ¯nacosæå¡ç«¯åºäºé®é¢ï¼æ¾å°å¯¹åºè´è´£çåäºï¼ä¸èµ·æ¥çãæä»¬è¿æµäºä¸ï¼ææå¡Aèªå·±éå¯äºä¸ï¼åç°éå¯ä¹å¯å¨ä¸èµ·æ¥äºï¼åæ ·æ¯æç¤º403ï¼ç¨æ·æ¾ä¸å°ã</p>
<p>æ¥ä¸æ¥ï¼ç»§ç»­æµè¯ï¼å½æ¶æ¯æçæ¯ä¸æ¯å¯ç æç¹æ®å­ç¬¦å¯¼è´çï¼ç¶ånacosè´è´£äººï¼ææä»¬çç¨æ·çå¯ç éç½®äºä¸ï¼ç¶åæä»¬éè¯ï¼åç°å¯ä»¥äºã</p>
<p>æç»çè§£å³ï¼å°±æ¯é ï¼</p>
<p>æç¨æ·çå¯ç éç½®ä¸ä¸ï¼ä¹å°±æ¯æ¹ä¸ä¸å¯ç å°±å¥½äºï¼ä½ä¸æ¯ç¹æ®å­ç¬¦çé®é¢ï¼æä»¬è¯çæ¹æäºæç¹æ®å­ç¬¦çå¯ç ï¼åç°è¿æ¯å¯ä»¥æåå¯å¨çï¼ã</p>
<p>è¿ä¸ªäºå½æ¶ä¹å°±äºäºï¼æ²¡ç®¡äºã</p>
<h1 id="ç»§ç»­æ¢ç´¢">ç»§ç»­æ¢ç´¢</h1>
<h2 id="ç»å½æ¥å£">ç»å½æ¥å£</h2>
<p>ä»å¤©ç©ºäºåï¼æè§è¿ä¸ªäºæè¿æ¯æç¹å¤æªï¼ä¸ºä»ä¹å¯ç éç½®åå°±å¥½äºï¼å½æ¶æå°±æçï¼nacosæå¡ç«¯åé¨ä¼°è®¡æç¼å­ï¼å¯è½æ¯ç¼å­åºé®é¢äºï¼ç¶åéç½®å¯ç è¿ä¸ªå¨ä½ï¼å°±å¯¼è´ç¼å­åå¾æ­£å¸¸äºã</p>
<p>ç½ä¸æ²¡æ¾å°ç¹å«å¹éæè¿ä¸ªæ¡ä¾çï¼ç¿»äºåå¤©ï¼çå°ænacosæºç è§£æçï¼äºæ¯æå°±æ³çä»£ç æä¸æ¥çä¸ä¸ç®äºã</p>
<p>çº¿ä¸çnacosçæ¬ä¸ç¡®å®ï¼ä½åºè¯¥æ¯2.2.2ï¼å ä¸ºæçäºä¸å¼åç¯å¢å°±æ¯è¿ä¸ªçæ¬ã</p>
<p>æ¾äºå¯¹åºçæºç ï¼</p>
<p><a href="https://github.com/alibaba/nacos/tree/2.2.2" target="_blank" rel="noopener nofollow">https://github.com/alibaba/nacos/tree/2.2.2</a></p>
<p><a href="https://github.com/alibaba/nacos/releases/tag/2.2.0" target="_blank" rel="noopener nofollow">https://github.com/alibaba/nacos/releases/tag/2.2.0</a></p>
<p>ç´æ¥ä¸äºä¸ªzipåï¼ideaéæå¼ã</p>
<p>å¨å±æç´¢login"ï¼åç°å¦ä¸ä»£ç ï¼</p>
<p>com.alibaba.nacos.plugin.auth.impl.controller.UserController#login</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213095720124.png" alt="image-20260213095720124" loading="lazy"></p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213095743794.png" alt="image-20260213095743794" loading="lazy"></p>
<p>ç¶åï¼è¿éæä¸ªæ ¹æ®ç¨æ·åï¼æ¥æ¾ç¨æ·è¯¦ç»ä¿¡æ¯çï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213095803120.png" alt="image-20260213095803120" loading="lazy"></p>
<p>ä¸é¢è¿éï¼åæ¯å»ä¸ä¸ªç¼å­mapéæ¥è¯¢ï¼å¦ææ²¡å¼å¯ä¸ä¸ªcacheEnabledçå¼å³ï¼åä¼ç»§ç»­å»æ¥æ°æ®åºï¼ä»¥æ°æ®åºçä¸ºåï¼</p>
<pre><code class="language-java">private Map&lt;String, User&gt; userMap = new ConcurrentHashMap&lt;&gt;();
</code></pre>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213095851520.png" alt="image-20260213095851520" loading="lazy"></p>
<p>æçäºä¸ï¼æä»¬æ¬å°å¼åç¯å¢çå¼å³ï¼åæ­£æ¯é»è®¤æå¼çï¼æä¼°è®¡ï¼çº¿ä¸ä¹æ¯è¿æ ·ï¼ä¹å°±æ¯è¯´ï¼æ¯åè®¸ç¼å­çï¼è¿é½å¹´æ«äºï¼è¿ç»´æ¾åäºï¼ä¸ææ°äºã</p>
<p>å·ä½çç¼å­å¼å³æ¯è¿ä¸ªï¼</p>
<pre><code class="language-java">public static final String NACOS_CORE_AUTH_CACHING_ENABLED = "nacos.core.auth.caching.enabled";
</code></pre>
<p>éç½®æä»¶ä¸­æ¯å¼å¯çï¼</p>
<pre><code class="language-shell">[root@COMPASS-NACOS-1 nacos]# cat conf/application.properties |grep caching
### Turn on/off caching of auth information. By turning on this switch, the update of auth information would have a 15 seconds delay.
nacos.core.auth.caching.enabled=true
</code></pre>
<p>é£å°±æ¯äºï¼åºè¯¥å°±æ¯ç¼å­éçç¨æ·æ°æ®æé®é¢ã</p>
<p>é£ä¸ºå¥ï¼éç½®å¯ç å°±å¥½äºå¢ï¼</p>
<h2 id="ä¿®æ¹å¯ç æ¥å£">ä¿®æ¹å¯ç æ¥å£</h2>
<p>ä¿®æ¹å¯ç è¿ä¸ªï¼æä»¬å½æ¶è¿æµè¯äºï¼èªå·±æ¹å¯ç è¿ä¸è¡ï¼å¿é¡»æ¯nacosè´è´£äººé£ä¸ªç®¡çè´¦å·æ¹äºæçæçã</p>
<p>å¦å¤ï¼æçäºä¸ï¼ä¸é¢é£ä¸ªç»å½æ¥å£éï¼æ¥ç¨æ·çsqlå¦ä¸ï¼</p>
<pre><code class="language-java">    public User findUserByUsername(String username) {
        String sql = "SELECT username,password FROM users WHERE username=? ";
        return databaseOperate.queryOne(sql, new Object[] {username}, USER_ROW_MAPPER);
    }
</code></pre>
<p>é£ä¿®æ¹å¯ç ï¼å¨å±æä¸ä¸<code>update users</code>ï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213100640175.png" alt="image-20260213100640175" loading="lazy"></p>
<pre><code class="language-shell">com.alibaba.nacos.plugin.auth.impl.controller.UserController#updateUser
</code></pre>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213100822326.png" alt="image-20260213100822326" loading="lazy"></p>
<p>æä»¬åç°ï¼æ¹å¯ç çæ¥å£ï¼æ´å®æ åï¼å°±æ¯æ¹ä¸æ°æ®åºï¼æ²¡æ¶åå°æ¸ä¸ç¼å­å¥çï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213100836452.png" alt="image-20260213100836452" loading="lazy"></p>
<p>é£å°±ä»é£ä¸ªç¼å­çmapçæï¼çäºä¸ï¼</p>
<pre><code class="language-shell">com.alibaba.nacos.plugin.auth.impl.users.NacosUserDetailsServiceImpl#reload
</code></pre>
<p>ç»æåç°äºä¸ä¸ªå®æ¶ä»»å¡ï¼è¿éæ¯é15sæ§è¡ä¸æ¬¡ï¼ä»æ°æ®åºå è½½useræ°æ®å°ç¼å­ï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213101021274.png" alt="image-20260213101021274" loading="lazy"></p>
<p>é£å°±çè§£äºï¼æ¹å¯ç æ¯åªæä½æ°æ®åºï¼ç¶åå®æ¶ä»»å¡å»æ°æ®åºæ¥è¯¢ææ°æ°æ®ï¼æ¾å°ç¼å­éï¼è¿æ ·å¢ï¼ç¼å­æ°æ®å°±åæ°æ®åºæ°æ®ä¸è´äºã</p>
<p>å¦ä¸ä¸ªçæµï¼ç¼å­æ¯15ç§ä»æ°æ®åºåæ­¥ï¼ç¼å­æ°æ®æé®é¢ï¼æ¯ä¸æ¯è¯´ææé®é¢çå¯è½æ¯æ°æ®åºå¢ï¼ä¹å°±æ¯è¯´ï¼æ°æ®åºéçç¨æ·æ°æ®åºäºé®é¢ï¼éè¿ä¿®æ¹å¯ç çæ¹å¼ææ­£å¸¸ï¼ç¶å15ç§åï¼ç¼å­éæ°æ®åå¾æ­£å¸¸ã</p>
<p>è³äºæ°æ®åºæ°æ®ä¸ºå¥åºäºé®é¢ï¼è¿ä¸ªå°±ä¸å¥½æ¾äºï¼æ¬ç¯å°±ä¸æ¢ç©¶äºã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 10:20">2026-02-13 10:19</span>&nbsp;
<a href="https://www.cnblogs.com/grey-wolf">ä¸å½æ¢¦å</a>&nbsp;
éè¯»(<span id="post_view_count">129</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19611093);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19611093', targetLink: 'https://www.cnblogs.com/grey-wolf/p/19611093', title: 'çº¿ä¸æå¡éå¯åï¼ä»nacosåä¸å°éç½®äºï¼æä¹åäº' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ MindIE è¸©åæ¥è®°åä¸ä¸ªwebå°å·¥å· ]]></title>
    <link>https://www.cnblogs.com/chumochen/p/19610004</link>
    <guid>3d44cbb25608888c062348019a1136a6</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/chumochen/p/19610004" title="åå¸äº 2026-02-12 22:40">
    <span role="heading" aria-level="2">MindIE è¸©åæ¥è®°åä¸ä¸ªwebå°å·¥å·</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h4 id="å¼è¨">å¼è¨</h4>
<p>æè¿å¨æè¾ï¼Ascendï¼NPU ä¸é¨ç½²å¤§æ¨¡åï¼å®æ¹ä¸»æ¨çæ¨çæ¡æ¶æ¯ MindIEãåè½ç¡®å®å®æ´ï¼ææ¡£ä¹åå¾æºâè§èâï¼ä½å®éç¨èµ·æ¥å´å­å¨ä¸å°âéå½¢é¨æ§âã</p>
<h4 id="è¸©åæ»ç»">è¸©åæ»ç»</h4>
<p><strong>1.  Dockerå®¹å¨æéä¸è¿ç¨ç®¡çå</strong></p>
<ul>
<li>å¿é¡»å  --privileged åæ°ï¼å¦åå®¹å¨éæ ¹æ¬è®¿é®ä¸å°NPUè®¾å¤ï¼å¯å¨å°±æ¥éã</li>
<li>åµå°¸è¿ç¨ï¼ä¸å  --init çè¯ï¼æ¨çæå¡éåºåï¼è¿ç¨åæ¶ä¸äºï¼ç´æ¥å¯¼è´åç»­æ¨çæå¡å¯å¨å¤±è´¥ï¼åªè½æå¨æè¿ç¨æéå¯å®¹å¨æå¡ã</li>
</ul>
<p><strong>2. å¨æåºæ¾ä¸å°ï¼libcsec.so: not found</strong><br>
å®¹å¨ä¸­è¿è¡æ¨çä¼åºç°libcsec.soæ¾ä¸å°çæåµï¼éè¦æå¨è®¾ç½® LD_LIBRARY_PATH æåå¥ /etc/ld.so.conf.d/</p>
<p><strong>3. å®¹å¨ç§é</strong><br>
å®æ¹éåæ²¡æåå°è¿ç¨ï¼docker run -d å¯å¨åç«å»éåºï¼è¦ä¹ä¸´æ¶ç¨ tail -f /dev/null å ä½ï¼æèèªå·±å°è£å¯å¨èæ¬ã</p>
<p><strong>4. CANNé«çæ¬é®é¢</strong><br>
æå¡å¨çNPUé©±å¨åCANNçé«çæ¬ä¸ä¸å®å¹éï¼å¦æå®è£é«çæ¬CANNä¼å¯¼è´ç³»ç»åæ ¸çæ¬åNPUé©±å¨çæ¬ä¸å¹éï¼å¯¼è´NPUæ æ³è¯å«</p>
<p><strong>5. æ¥å£å¼å®¹é®é¢ï¼</strong><br>
vllmå¼å®¹OpenAIçæ¨çæ¥å£/v1/completionsï¼å³ä½¿åæ°éç½®æ­£ç¡®ï¼ä¹ä¼æç¤ºâMessages token length must be in (0, 1048576], but got 0âéè¯¯ãè§£å³æ¹æ¡æ¯åæ¢ä¸ºå¼å®¹TGI 0.9.4çæ¬æ¥å£ç/generateæ¥å£ã</p>
<p>è¿æä¸äºå¶ä»çé®é¢ï¼æ¯å¦<br>
1 . éç½®ä¸å¯è§ãä¸å¯æ¹ï¼ææéç½®æä»¶æ·±èå®¹å¨åï¼ä¿®æ¹ééå»ºéåæ exec è¿å¥ã<br>
2 . æå¡å¯å¨ç¹çï¼æ¯æ¬¡é½è¦æå¨æ¿æ´» CANN ç¯å¢ãè®¾ç½®åéã<br>
3 . ç¼ºä¹å¯è§åæµè¯å·¥å·ï¼åªè½é  curl è°è¯ã<br>
4 . é¨ç½²æµç¨ä¸éæï¼æ¥å¿åæ£ï¼éè¯¯ä¿¡æ¯é¾å®ä½ã</p>
<p>è¸©åè¸©å¤äºï¼äººä¹éº»äºãå ä¸åé¢è¦äº¤ç»å®¢æ·ç¨ï¼æ»ä¸è½æ¯æ¬¡é½è®©äººå®¶å¼ç»ç«¯æ²å½ä»¤ã<br>
äºæ¯åäºä¸ªçº¯ Web çé¢ç MindIE å°å©æã</p>
<p>ä»åºå°åï¼<a href="https://github.com/jclown/MyMindIEWebConsole" target="_blank" rel="noopener nofollow">https://github.com/jclown/MyMindIEWebConsole</a><br>
<img src="https://img2024.cnblogs.com/blog/1212315/202602/1212315-20260212223800963-1865678913.png" alt="image" loading="lazy"></p>
<p><strong>1 å¯è§ååæ°éç½®</strong><br>
<img src="https://img2024.cnblogs.com/blog/1212315/202602/1212315-20260212223656466-1398105072.png" alt="image" loading="lazy"></p>
<p><strong>2 æ¨¡åç®¡çåé¨ç½²</strong><br>
<img src="https://img2024.cnblogs.com/blog/1212315/202602/1212315-20260212223713695-1347474859.png" alt="image" loading="lazy"></p>
<p><strong>3 å¯¹è¯æµè¯çé¢</strong><br>
<img src="https://img2024.cnblogs.com/blog/1212315/202602/1212315-20260212223737527-1308806231.png" alt="image" loading="lazy"></p>
<p><strong>4 æ¥å¿çæµ</strong><br>
<img src="https://img2024.cnblogs.com/blog/1212315/202602/1212315-20260212223724078-1950248665.png" alt="image" loading="lazy"></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-12 22:40">2026-02-12 22:40</span>&nbsp;
<a href="https://www.cnblogs.com/chumochen">å°å¹´ç¥æ</a>&nbsp;
éè¯»(<span id="post_view_count">42</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19610004);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19610004', targetLink: 'https://www.cnblogs.com/chumochen/p/19610004', title: 'MindIE è¸©åæ¥è®°åä¸ä¸ªwebå°å·¥å·' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãEF Coreãå®ä½è¿½è¸ªââEntryä¸­è®°å½çæ°æ® ]]></title>
    <link>https://www.cnblogs.com/tcjiaan/p/19601119</link>
    <guid>3550e3b347760566aa5070288843019a</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/tcjiaan/p/19601119" title="åå¸äº 2026-02-12 22:23">
    <span role="heading" aria-level="2">ãEF Coreãå®ä½è¿½è¸ªââEntryä¸­è®°å½çæ°æ®</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>è¿åç»äºå¯ä»¥ Free äºï¼åå¥½å¿«è¿å¹´äºï¼å·¥åçæºå¨ä¹å¾äººæ§åå°åäºï¼éè¦ä¾åºåç»´ä¿®ï¼ä¸ç¨æµè¯é¡¹ç®äºãæä»¥èå¨ä¹åå®¶å¿«æ´»äºå å¤©ãå¶å®ä»ä»¬èªå·±æå¼åå¢éï¼å°æ¹å°æµçä»ä»¬å®å¨å¯ä»¥èªå·±å¼ï¼éè¦æ¾èå¨éº»ç¦ã</p>
<p>å±ä»¬æ¥çä¸æ¬¡çè¯é¢èï¼ä¸æ¬¡èå¨ç»å¤§ä¼ä¼´ä»¬è¡è¯äºä¸çªæå³å®ä½ç¶æè¿½è¸ªçåºç¡ãè¿ä¸æ¬¡å±ä»¬ææ³¨æåæ¾å°åä¸º EntityEntry çå¯¹è±¡ä¸ãå¦ï¼è¿åæä¹ççè¿ä¹å¥è©ï¼å±ä»¬ä¸ç®¡å®å¥ä¸å¥è©ï¼åªè¦ç¥éå®è´è´£ä¿å­å®ä½å¯¹è±¡çå±æ§å¼å°±è¡äºã</p>
<p>æ¯ç«å®ä½ç±»éå¸¸å°±æ¯ä¸ä¸ªæ®éç±»ï¼EF Core éè¦ç¶æè¿½è¸ªåè½ï¼æ»ä¸è½è®©å¼åèèªå·±å»è·è¸ªå§ï¼æä»¥ï¼EF åé¨ä¼ç¨å­å¸æ°æ®ç»ææ¥ä¿å­å®ä½çåä¸ªå±æ§çå¼ãå­å¸æ¯ä¸ªå¥½ä¸è¥¿ï¼å¥é½è½æ¾ãææ¶åå¨å Web API æ¶ï¼ä¸äºè¿å JSON ç»ææ¯å¨æçï¼ä¸ºå®ä»¬é½å®ä¹ä¸ä¸ªç±»æ¥åºååæ¯ä¸ææºçï¼ç´æ¥æ¼è£ JSON æç¹éº»ç¦ï¼è¿æ¶åç¨å­å¸å°±å¾ç½ã</p>
<p>å½å®ä½ä»æ°æ®åºæ¥è¯¢åºæ¥æ¶ï¼EF åä¸ºå®ä½å¯¹è±¡åå»ºä¸ä¸ªå¿«ç§ï¼è¡¨æå®çåå§æ°æ®ãç¶åï¼å½ä½ å¯¹å®ä½è¿è¡åç§ææä½ä¹åï¼è°ç¨ä¸ä¸&nbsp;DetectChanges æ¹æ³ï¼å®ä¼æ«æå®ä½å¯¹è±¡åä¸ªå±æ§çå¼ï¼å¹¶åå½ååå»ºçå¿«ç§æ¯è¾ï¼ä»¥ç¡®å®å®ä½æ¯å¦è¢«ä¿®æ¹ï¼æå é¤ï¼ã</p>
<p>ä¸ºäºè®©åå­¦çå¤§ä¼ä¼´ä»¬å¥½çè§£ï¼å±ä»¬åä¸ªå¯¹æ¯å®éªã</p>
<p>åè®¾æè¿ä¹ä¸ªå®ä½ç±»ï¼å®è¡¨ç¤ºä¸æ¬ä¹¦çä¿¡æ¯ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> Book
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> BookId { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Name { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">null</span>!<span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> ISBN { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">null</span>!<span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Author { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">null</span>!<span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> PubYear {  <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
}</span></pre>
</div>
<p>ç¶åæ¯å®ç°æ°æ®åºä¸ä¸æã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> MyDb : DbContext
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> DbSet&lt;Book&gt; Books { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }

    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlite(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">data source=shop.db</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    }

    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> OnModelCreating(ModelBuilder modelBuilder)
    {
        </span><span style="color: rgba(0, 0, 255, 1)">var</span> bookEnt = modelBuilder.Entity&lt;Book&gt;<span style="color: rgba(0, 0, 0, 1)">();
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä¸»é®åç§°</span>
        bookEnt.HasKey(x =&gt; x.BookId).HasName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">PK_Book</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å­ç¬¦ä¸²é¿åº¦</span>
        bookEnt.Property(a =&gt; a.Name).HasMaxLength(<span style="color: rgba(128, 0, 128, 1)">65</span><span style="color: rgba(0, 0, 0, 1)">);
        bookEnt.Property(b </span>=&gt; b.Author).HasMaxLength(<span style="color: rgba(128, 0, 128, 1)">20</span><span style="color: rgba(0, 0, 0, 1)">);
        bookEnt.Property(c </span>=&gt; c.ISBN).HasMaxLength(<span style="color: rgba(128, 0, 128, 1)">15</span><span style="color: rgba(0, 0, 0, 1)">);
        bookEnt.ToTable(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">tb_Books</span><span style="color: rgba(128, 0, 0, 1)">"</span>, t =&gt;<span style="color: rgba(0, 0, 0, 1)">
        {
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> çº¦æ</span>
            t.HasCheckConstraint(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">CK_Pubyear</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\"PubYear\" &gt;= 2020 AND \"PubYear\" &lt;= 2080</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        });
    }
}</span></pre>
</div>
<p>ä¸é¢é£äºé½æ¯å¸¸è§æä½äºï¼å¤§å®¶çä¸¤ç¼å°±è¡ãä¸é¢ä»£ç åå»ºæ°æ®åºå¹¶æå¥ä¸æ¡æ°æ®ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">using</span> MyDb context = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">();
context.Database.EnsureCreated();</span><span style="color: rgba(0, 0, 0, 1)">

        <span style="background-color: rgba(255, 255, 0, 1)">Book bb </span></span><span style="background-color: rgba(255, 255, 0, 1)">= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">()
</span></span>        <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">{
</span></span>            <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">Name </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
</span></span>            <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">Author </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
</span></span>            <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">ISBN </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
</span></span>            <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">PubYear </span>= <span style="color: rgba(128, 0, 128, 1)">2028</span></span>
        <span style="color: rgba(0, 0, 0, 1)"><span style="background-color: rgba(255, 255, 0, 1)">};</span>
context.Books.Add(bb);
context.SaveChanges();</span></pre>
</div>
<p>ä¸é¢éå¤´ææ¥äºãå±ä»¬ä»æ°æ®åºä¸­æ¥è¯¢åºè¿æ¡è®°å½ï¼ç¶åæ¹å PubYear å±æ§çå¼ã</p>
<div class="cnblogs_code">
<pre> <span style="color: rgba(0, 0, 255, 1)">var</span> theBook =<span style="color: rgba(0, 0, 0, 1)"> context.Books.FirstOrDefault();
 </span><span style="color: rgba(0, 0, 255, 1)">if</span> (theBook == <span style="color: rgba(0, 0, 255, 1)">null</span>) <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)">;

 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°ä¸æ¬¡è¿½è¸ª</span>
<span style="color: rgba(0, 0, 0, 1)"> Console.WriteLine(context.ChangeTracker.ToDebugString());
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ´æ¹å±æ§</span>
 theBook.PubYear = <span style="color: rgba(128, 0, 128, 1)">2030</span><span style="color: rgba(0, 0, 0, 1)">;
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæå°ä¸æ¬¡</span>
 Console.WriteLine(context.ChangeTracker.ToDebugString());</pre>
</div>
<p>ChangeTracker.ToDebugString æ¹æ³æ¹ä¾¿æµè¯ï¼å¯ä»¥ç´æ¥è§å¯æ¡æ¶å¯¹å®ä½å¯¹è±¡çæ´æ¹è®°å½ãä¸¤æ¬¡è°ç¨çè¾åºå¦ä¸ï¼</p>
<div class="cnblogs_code">
<pre>Book {BookId: <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} Unchanged
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2028</span><span style="color: rgba(0, 0, 0, 1)">

Book {BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} Unchanged
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2030</span> Originally <span style="color: rgba(128, 0, 128, 1)">2028</span></pre>
</div>
<p>å¾ææ¾ï¼EF å¹¶ä¸ç¥éå±ä»¬ä¿®æ¹äºå®ä½ï¼æä»¥ï¼è°ç¨ä¸ä¸&nbsp;DetectChanges æ¹æ³ä¼è§¦åä¸æ¬¡æ«æåæ¯è¾ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°ä¸æ¬¡è¿½è¸ª</span>
<span style="color: rgba(0, 0, 0, 1)">Console.WriteLine(context.ChangeTracker.ToDebugString());
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ´æ¹å±æ§</span>
theBook.PubYear = <span style="color: rgba(128, 0, 128, 1)">2030</span><span style="color: rgba(0, 0, 0, 1)">;
<strong><span style="background-color: rgba(255, 255, 0, 1)">context.ChangeTracker.DetectChanges()</span></strong>;
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæå°ä¸æ¬¡</span>
Console.WriteLine(context.ChangeTracker.ToDebugString());</pre>
</div>
<p>è¿æ¬¡ EF å°±ç¥éå®ä½è¢«ä¿®æ¹äºã</p>
<div class="cnblogs_code">
<pre>Book {BookId: <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} Unchanged
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2028</span><span style="color: rgba(0, 0, 0, 1)">

Book {BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} <span style="background-color: rgba(255, 255, 0, 1)">Modified</span>
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span>
    <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2030</span> Modified Originally <span style="color: rgba(128, 0, 128, 1)">2028</span></span></pre>
</div>
<p>ç±äº PubYear å±æ§è¢«æ´æ°ï¼ä½¿å¾å®ä½çç¶æåæ´ä¸º Modifiedã</p>
<p>é£ï¼ä¸ºä»ä¹æè°ç¨ SaveChanges æ¹æ³æ¶ EF è½é¡ºå©çææ´æ° SQL å¢ï¼å ä¸ºè¿ä¸ªæ¹æ³ä¼å DetectChangesï¼åæ ¹æ®å®ä½çç¶ææ¥çææ´æ°è¯­å¥ã</p>
<p>ä½æ¯ï¼å¦æä½ å¨ä»£ç éé¢æ&nbsp;AutoDetectChangesEnabled å±æ§è®¾ç½®ä¸º falseï¼é£ä¹è°ç¨ SaveChanges æ¹æ³æ¯ä¸ä¼æ´æ°çã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">using</span> MyDb context = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">();
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ³¨æè¿ä¸è¡</span>
context.<strong><span style="background-color: rgba(255, 255, 0, 1)">ChangeTracker.AutoDetectChangesEnabled = <span style="color: rgba(0, 0, 255, 1)">false</span></span></strong><span style="color: rgba(0, 0, 0, 1)">;

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¾åºç¬¬ä¸æ¡è®°å½</span>
Book onebook =<span style="color: rgba(0, 0, 0, 1)"> context.Books.First();
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°ä¸æ¬¡</span>
Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{onebook.Name}, {onebook.PubYear}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¹ä¸ä¸å¹´ä»½</span>
onebook.PubYear = <span style="color: rgba(128, 0, 128, 1)">2031</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æäº¤æ´æ¹</span>
<span style="color: rgba(0, 0, 0, 1); background-color: rgba(0, 255, 0, 1)">context.SaveChanges();
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ¥è¯¢ä¸æ¬¡</span>
Book otherOne = context.Books.First(b =&gt; b.BookId ==<span style="color: rgba(0, 0, 0, 1)"> onebook.BookId);

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ¬¡æå°</span>
Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{otherOne.Name}, {otherOne.PubYear}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ççå®ä½è¿½è¸ªä¿¡æ¯</span>
Console.WriteLine(context.Entry(otherOne).DebugView.LongView);</pre>
</div>
<p>ççè°è¯ä¿¡æ¯ã</p>
<div class="cnblogs_code">
<pre>åé­æ¯, <span style="color: rgba(128, 0, 128, 1)">2028</span><span style="color: rgba(0, 0, 0, 1)">
åé­æ¯, </span><span style="color: rgba(128, 0, 128, 1)">2031</span><span style="color: rgba(0, 0, 0, 1)">
Book {BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} <strong><span style="background-color: rgba(255, 0, 0, 1); color: rgba(255, 255, 255, 1)">Unchanged</span></strong>
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span>
    <span style="background-color: rgba(0, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2031</span> Originally <span style="color: rgba(128, 0, 128, 1)">2028</span></span></pre>
</div>
<p>è½ç¶ EF è¿½è¸ªå° PubYear å±æ§è¢«æ¹ä¸º 2031ï¼ä½æ³¨æå®ç°å¨çç¶ææ¯ Unchangedï¼æä»¥ SaveChanges ä¸ä¼æ´æ°æ°æ®åºã</p>
<p>å¤§ä¼ä¼´ä»¬ï¼è¿éä½ åä¸å«ç¯ç³æ¶ï¼ææ¦å¿µææ··äºã<span style="background-color: rgba(255, 0, 0, 1); font-size: 15px; color: rgba(255, 255, 255, 1)"><strong>AutoDetectChangesEnabled å±æ§è®¾ç½®ä¸º false åªè¡¨æ EF å¨ SaveChanges æ¹æ³ä¸­ä¸ä¼èªå¨æ«ææ£æµå®ä½çç¶æï¼å¯äººå®¶æ²¡è¯´ä¸ä¼è¿½è¸ªå®ä½çåæ´å</strong></span>ã</p>
<p>ä½ å¦æåªæ¯æ¥è¯¢æ°æ®ï¼ä¸æ´æ¹æ°æ®ï¼ä¸éè¦è¿½è¸ªå®ä½ç¶æï¼ä»¥æåä¸å¤ªææ¾çæ§è½ï¼ï¼é£ä¹ä½ ä¸åºè¯¥å³é­&nbsp;AutoDetectChangesEnabled å±æ§ï¼èåºè¯¥è®¾ç½®&nbsp;QueryTrackingBehavior å±æ§ã</p>
<div class="cnblogs_code">
<pre>context.ChangeTracker.QueryTrackingBehavior = <strong><span style="background-color: rgba(255, 255, 0, 1)">QueryTrackingBehavior.NoTracking</span></strong>;</pre>
</div>
<p>ç¦ç¨è¿½è¸ªåï¼æ´æ°æ°æ®åºå°±è· Sugar ä¸æ ·ï¼éè¦ä½ å¼æå¨æ¡£ãä½ åªéè¦è°ç¨ä¸ä¸ Update æ¹æ³ï¼å°å®ä½ç¶æåä¸º Modified å°±è¡ï¼ç¼ºç¹æ¯çæç UPDATE è¯­å¥ä¼æææå­æ®µé½ SET ä¸éã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¾åºç¬¬ä¸æ¡è®°å½</span>
Book onebook =<span style="color: rgba(0, 0, 0, 1)"> context.Books.First();
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°ä¸æ¬¡</span>
Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{onebook.Name}, {onebook.PubYear}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¹ä¸ä¸å¹´ä»½</span>
onebook.PubYear = <span style="color: rgba(128, 0, 128, 1)">2024</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¹åç¶æ</span>
<span style="color: rgba(0, 0, 0, 1)"><strong><span style="background-color: rgba(255, 255, 0, 1)">context.Update(onebook)</span></strong>;

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æäº¤æ´æ¹</span>
context.SaveChanges();</pre>
</div>
<p>é£ææ²¡ææ¹æ³è®©çæç UPDATE è¯­å¥åª SET è¢«æ¹å¨è¿çå­æ®µå¢ï¼å¤§ä¼ä¼´è¯å®çå°ï¼èå¨æ¢ç¶è¿ä¹åï¼é£è¯´æè¯å®æçãä½èå¨å¸æä½ ä¸è¦æ­»è®°æ¹æ³ï¼èæ¯æè·¯ãå±ä»¬å¥½å¥½æ³ä¸ä¸ï¼EF æ¯ä¸æ¯å¨æ¥è¯¢åºæ°æ®å°ä¸ºå®ä½å»ºç«å¿«ç§ï¼ç¶åè¿è¡æ¯è¾ï¼ä»¥ç¡®å®åªäºå±æ§ï¼å­æ®µï¼è¢«ä¿®æ¹äºãæ¢ç¶è¿æ ·ï¼å±ä»¬å¨æ¥è¯¢å®ä½åï¼æå¨ç»å®å¼ä¸ªå¿«ç§ï¼ç¶ååä¿®æ¹å±æ§å¼ï¼åæäº¤æ´æ°ä¸å°±å®äºäºåï¼å¥½ï¼æ³å¹²å°±å¹²ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¾åºç¬¬ä¸æ¡è®°å½</span>
Book onebook =<span style="color: rgba(0, 0, 0, 1)"> context.Books.First();

context.Books.Attach(onebook);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è®°å½å¿«ç§</span>
<span style="color: rgba(0, 0, 0, 1)"><strong><span style="background-color: rgba(255, 255, 0, 1)">context.Entry(onebook).OriginalValues.SetValues(onebook)</span></strong>;

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¹ä¸ä¸å¹´ä»½</span>
onebook.PubYear = <span style="color: rgba(128, 0, 128, 1)">2021</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°ä¸ä¸ç¶æä¿¡æ¯</span>
<span style="color: rgba(0, 0, 0, 1)">Console.WriteLine(context.Entry(onebook).DebugView.LongView);

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä¸¥éè­¦åï¼å¦æä½ æ AutoDetectChangesEnabled å±æ§è®¾ç½®ä¸º falseï¼é£ä¸å®è¦è°ç¨ä¸é¢è¿ä¸è¡ä»¥æ«ææ´æ¹ï¼å¦ååªè½æ´æ°ä¸ªæ¯çº¿
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¦æä½ æ²¡ææ¹å¨ AutoDetectChangesEnabled å±æ§ï¼å®é»è®¤æ¯æå¼çï¼é£ä¸é¢è¿è¡å¯ä»¥å¿½ç¥
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> context.ChangeTracker.DetectChanges();
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æäº¤æ´æ¹</span>
<span style="color: rgba(0, 0, 0, 1)">context.SaveChanges();

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ¥è¯¢ä¸æ¬¡</span>
Book otherOne = context.Books.First(b =&gt; b.BookId ==<span style="color: rgba(0, 0, 0, 1)"> onebook.BookId);

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ¬¡æå°ç¶æä¿¡æ¯</span>
Console.WriteLine(context.Entry(otherOne).DebugView.LongView);</pre>
</div>
<p>ç»æå¦ä¸ï¼</p>
<div class="cnblogs_code">
<pre>Book {BookId: <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} Modified
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2021</span> <strong><span style="background-color: rgba(255, 255, 0, 1)">Modified Originally <span style="color: rgba(128, 0, 128, 1)">2025</span></span></strong><span style="color: rgba(0, 0, 0, 1)">
Book {BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} Detached
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2021</span></pre>
</div>
<p>çæçSQLè¯­å¥å¦ä¸ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">UPDATE</span> "tb_Books" <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 255, 1)">SET</span> "PubYear" <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(0, 128, 0, 1)">@p0</span></span>
<span style="color: rgba(0, 0, 255, 1)">WHERE</span> "BookId" <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(0, 128, 0, 1)">@p1</span><span style="color: rgba(0, 0, 0, 1)">
RETURNING </span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1</span>;</pre>
</div>
<p>å ä¸ºå±ä»¬è®¾ç½®ä¸ºä¸è¿½è¸ªå®ä½ï¼QueryTrackingBehavior.NoTrackingï¼ï¼æä»¥å¨æ¥è¯¢åï¼è¦ç¨ Attach æ¹æ³æå®ä½è¿æ¥å°è¿½è¸ªå¨ï¼å¹¶è®¾å®ç¶æä¸º Unchangedãç¶åï¼context.Entry æ¹æ³è·åå° EntityEntry å¯¹è±¡ï¼æ¬æçä¸»è§åºåºäºï¼ï¼åå¾&nbsp;OriginalValues éé¢æ¾ç¹åææï¼ç®åæ¥è¯¢åºæ¥çå¼ï¼ï¼è¿æ ·å¿«ç§å°±å»ºç«äºãåç¶åï¼å¯ä»¥å¤§èå°ä¿®æ¹å®ä½äºï¼è¿æ¶å EF è½æ«æå°æ´æ¹ãç±äºå±ä»¬è®¾ç½®çä¸è¿½è¸ªï¼æä»¥æ´æ°ä¹å EF åæå®ä½ç»ç©äºï¼äºæ¯å®ä½ç¶æååå Detachedã</p>
<p>è¯´ç®åç¹ï¼å¨æå¨æ¡£è¿½è¸ªä¸ï¼å®ä½çç¶æç»åäº Detached -&gt; Unchanged -&gt; Modified -&gt; Detached ççæ­»è½®åã</p>
<p>-----------------------------------------------------------------------------------------------------------------------------------------------------------</p>
<p>Entry æ¯âè®°å½âçææï¼EntityEntry ææçä¹ä¸ä¸å°±æ¯âå®ä½è®°å½âï¼å®ç»´æ¤çå®ä½çç¶æååå±æ§çå¼ãä¸å¥è¯æ¯åºæ»ç»ï¼å®æ¯ä¸ºå®ä½è¿½è¸ªï¼è·è¸ªï¼æå¡çï¼ç®¡ççå®ä½ç¸å³çæ°æ®ã</p>
<p>å¨ 80% çä½¿ç¨åºæ¯ä¸ï¼æä»¬ä¸éè¦ç¨ Entry çï¼èµ°å¸¸è§æµç¨ï¼ä»æ°æ®åºä¸­æ¥è¯¢æ°æ®ï¼èªå¨è¿½è¸ªï¼ä¿®æ¹åæäº¤å°±å®äºäºãä¸è¿ï¼åå½±å­å±æ§è¿ç§ä¸å¨å®ä½ç±»ä¸­çæåï¼ä½ ååï¼å½±å­å±æ§çåæ°æ®å¨æ°æ®åºæ¨¡åä¸­ï¼èå¼æ¯ä¿å­å¨ EntityEntry ä¸­ãä¸é¢å±ä»¬ç¨ä¸ä¸ªå®ä¾æ¥è¯´æã</p>
<p>å±ä»¬å®ä¹ä¸ä¸ªç¨æ·å®ä½ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> User
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> Id { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Name { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.Empty;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> LogName { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.Empty;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span>? Password {  <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
}</span></pre>
</div>
<p>ç¶åæ¯å®ç°èªå·±çæ°æ®åºä¸ä¸æã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> AppContext : DbContext
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> DbSet&lt;User&gt; Users { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }

    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlite(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">data source=demo996.db</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)</span><span style="color: rgba(0, 0, 0, 1)">;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> OnModelCreating(ModelBuilder modelBuilder)
    {
        EntityTypeBuilder</span>&lt;User&gt; entUser = modelBuilder.Entity&lt;User&gt;<span style="color: rgba(0, 0, 0, 1)">();
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¸¸è§éç½®</span>
        entUser.Property(x =&gt; x.Name).HasColumnName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">u_name</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        entUser.Property(w </span>=&gt; w.LogName).HasColumnName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">log_name</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        entUser.Property(t </span>=&gt; t.Password).HasColumnName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">u_pwd</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        entUser.Property(m </span>=&gt; m.Id).HasColumnName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">u_id</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        entUser.HasKey(x </span>=&gt; x.Id).HasName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">PK_Userid</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å½±å­å±æ§</span>
        <strong><span style="background-color: rgba(255, 255, 0, 1)">entUser.Property&lt;DateTime?&gt;(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">LastLog</span><span style="color: rgba(128, 0, 0, 1)">"</span>).HasColumnName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">_last_log</span><span style="color: rgba(128, 0, 0, 1)">"</span></span></strong><span style="color: rgba(0, 0, 0, 1)"><strong><span style="background-color: rgba(255, 255, 0, 1)">)</span></strong>;
    }
}</span></pre>
</div>
<p>User å®ä½æä¸ä¸ªå½±å­å±æ§ LastLogï¼è®°å½ç¨æ·ä¸ä¸æ¬¡ç»å½çæ¶é´ãå¨å®ä½ä¸­ä¸éè¦ä½¿ç¨ï¼æä¸å¸æè¢«è®¿é®çå±æ§ï¼å¨å»ºç«æ°æ®åºæ¨¡åæ¶å¯ä»¥ä½ä¸ºå½±å­å±æ§ã</p>
<p>å¨æ¥è¯¢è¡¨è¾¾å¼ä¸­å¯ä»¥ä½¿ç¨ EF.Property æ¹æ³æ¥è·åå½±å­å±æ§çå¼ï¼EF ç±»ä¸­çæ¹æ³æåé½ä¼æåºå¼å¸¸ï¼æ²¡æçæ­£å®ç°ï¼èæ¯éè¿è¡¨è¾¾å¼æ æ¥ç¿»è¯å¤çãå æ­¤ï¼å¨éæ¥è¯¢è¯­å¥ä¸­è®¿é®å½±å­å±æ§ï¼æè¦ä¿®æ¹å½±å­å±æ§å°±ä¸è½ä½¿ç¨ EF ç±»äºãå½±å­å±æ§çå¼ä¿å­å¨ Entry ä¸­ï¼å¯ä»¥ç¨ä»¥ä¸ä»£ç æ¥è®¾ç½® LastLog å±æ§çå¼ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ¥è¯¢åºå®ä½</span>
User? u = context.Users.FirstOrDefault(x =&gt; x.Name == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Teto</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 0, 255, 1)">if</span> (u <span style="color: rgba(0, 0, 255, 1)">is</span> <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">)
{
    Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ç¨æ·ä¸å­å¨</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)">;
}
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éè¿ Entry ä¿®æ¹å½±å­å±æ§</span>
DateTime theTime =<span style="color: rgba(0, 0, 0, 1)"> DateTime.Now;
context.<strong><span style="background-color: rgba(255, 255, 0, 1)">Entry(u).Property(</span></strong></span><strong><span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">LastLog</span><span style="color: rgba(128, 0, 0, 1)">"</span>).CurrentValue =</span></strong><span style="color: rgba(0, 0, 0, 1)"><strong><span style="background-color: rgba(255, 255, 0, 1)"> theTime</span></strong>;
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°è¿½è¸ªä¿¡æ¯</span>
<span style="color: rgba(0, 0, 0, 1)">Console.WriteLine(context.ChangeTracker.DebugView.LongView);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æäº¤ä¿å­</span>
context.SaveChanges();</pre>
</div>
<p>ç´æ¥ä½¿ç¨ Entry ä¿®æ¹å±æ§å¼ä¼èªå¨åºç¨å®ä½çç¶æãUser å®ä½åä¸º Modeified ç¶æã</p>
<div class="cnblogs_code">
<pre>User {Id: <span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)">} <strong><span style="background-color: rgba(255, 255, 0, 1)">Modified</span></strong>
    Id: </span><span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)"> PK
    LastLog: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 128, 0, 1)">2026/2/12 18:25:01</span><span style="color: rgba(128, 0, 0, 1)">'</span> Modified Originally <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 128, 0, 1)">2026/2/12 17:41:20</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    LogName: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 128, 0, 1)">teto</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 128, 0, 1)">Teto</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Password: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 128, 0, 1)">balabala</span><span style="color: rgba(128, 0, 0, 1)">'</span></pre>
</div>
<p>æ³éªè¯æ¯å¦æ´æ°æ°æ®åºï¼å¯ä»¥æ¥è¯¢ä¸éæ´ä¸ªè¡¨ã</p>
<div class="cnblogs_code">
<pre>using(var context =<span style="color: rgba(0, 0, 0, 1)"> new AppContext())
{
    Console.WriteLine(</span><span style="color: rgba(128, 128, 128, 1)">"</span><span style="color: rgba(128, 128, 128, 1)">\n------ ææç¨æ· ------");</span>
<span style="color: rgba(0, 0, 0, 1)">    foreach(User usr in context.Users)
    {
        Console.WriteLine($</span><span style="color: rgba(128, 128, 128, 1)">"</span><span style="color: rgba(128, 128, 128, 1)">""</span>
<span style="color: rgba(0, 0, 0, 1)">            ç¨æ·IDï¼{usr.Id}
            ç¨æ·åï¼{usr.Name}
            ä¸æ¬¡ç»å½æ¶é´ï¼{context.Entry(usr).Property(</span><span style="color: rgba(128, 128, 128, 1)">"</span><span style="color: rgba(128, 128, 128, 1)">LastLog").CurrentValue}</span>
            <span style="color: rgba(128, 128, 128, 1)">"</span><span style="color: rgba(128, 128, 128, 1)">"");</span>
        Console.Write(<span style="color: rgba(128, 128, 128, 1)">"</span><span style="color: rgba(128, 128, 128, 1)">\n");</span>
<span style="color: rgba(0, 0, 0, 1)">    }
}</span></pre>
</div>
<div class="cnblogs_code">
<pre>------ ææç¨æ· ------<span style="color: rgba(0, 0, 0, 1)">
ç¨æ·IDï¼</span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">
ç¨æ·åï¼Kaito
ä¸æ¬¡ç»å½æ¶é´ï¼</span><span style="color: rgba(128, 0, 128, 1)">2026</span>/<span style="color: rgba(128, 0, 128, 1)">2</span>/<span style="color: rgba(128, 0, 128, 1)">12</span> <span style="color: rgba(128, 0, 128, 1)">17</span>:<span style="color: rgba(128, 0, 128, 1)">40</span>:<span style="color: rgba(128, 0, 128, 1)">45</span><span style="color: rgba(0, 0, 0, 1)">

ç¨æ·IDï¼</span><span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">
ç¨æ·åï¼Gumi
ä¸æ¬¡ç»å½æ¶é´ï¼</span><span style="color: rgba(128, 0, 128, 1)">2026</span>/<span style="color: rgba(128, 0, 128, 1)">2</span>/<span style="color: rgba(128, 0, 128, 1)">12</span> <span style="color: rgba(128, 0, 128, 1)">17</span>:<span style="color: rgba(128, 0, 128, 1)">40</span>:<span style="color: rgba(128, 0, 128, 1)">13</span><span style="color: rgba(0, 0, 0, 1)">

ç¨æ·IDï¼</span><span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)">
ç¨æ·åï¼Teto
ä¸æ¬¡ç»å½æ¶é´ï¼</span><span style="color: rgba(128, 0, 128, 1)">2026</span>/<span style="color: rgba(128, 0, 128, 1)">2</span>/<span style="color: rgba(128, 0, 128, 1)">12</span> <span style="color: rgba(128, 0, 128, 1)">18</span>:<span style="color: rgba(128, 0, 128, 1)">25</span>:<span style="color: rgba(128, 0, 128, 1)">01</span></pre>
</div>
<p>ä¸é¢çåæ³è¦åæ¥è¯¢ä¸æ¬¡ï¼ç¶åæ´æ°ï¼å³æ°æ®åºå¾è¿ä¸¤åã99.99965% çæåµä¸ä¹æ²¡å¥å½±åçï¼èä¸å¾å¤æ¶åç¨æ·ç¼è¾æ°æ®æ¶ç¡®å®å¾åæ¥åæ¹çï¼æ¯ç«ç¼è¾çé¢ä½ å¾åæ¾ç¤ºç°æçæ°æ®ææ¹ä¾¿ç¨æ·å»ä¿®æ¹ãå¦æä½ ä¸æ³ SELECT åªæ³ç´æ¥ UPDATE ä¹å¯ä»¥çã</p>
<div class="cnblogs_code">
<pre> <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ç´æ¥å®ä¾å
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Id æ¯ä¸»é®ï¼å¿é¡»èµå¼ï¼æç¡®è¦æ´æ°çè®°å½</span>
 User data = <span style="color: rgba(0, 0, 255, 1)">new</span>() { <strong><span style="background-color: rgba(255, 255, 0, 1)">Id = <span style="color: rgba(128, 0, 128, 1)">2</span></span></strong><span style="color: rgba(0, 0, 0, 1)"> };
 </span><span style="color: rgba(0, 0, 255, 1)">var</span> entry =<span style="color: rgba(0, 0, 0, 1)"> context.Entry(data);
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ è®°å®ä½çç¶æä¸ºå·²ä¿®æ¹</span>
 entry.State =<span style="color: rgba(0, 0, 0, 1)"><span style="background-color: rgba(0, 255, 0, 1)"> EntityState.Modified</span>;
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ¹åå®ä½çç¶æåå»æ¹åæä¸ªå±æ§çç¶æ
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å ä¸ºå¨è®¾ç½®å®ä½ä¸º Modified æ¶ä¼æææå±æ§é½è®¾ç½®ä¸º Modified
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åè®¾ç½®å®ä½åè®¾ç½®å±æ§æåå°±ä¸ä¼è¢«è¦ç</span>
 <span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> p <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> entry.Properties)
 {
     </span><span style="color: rgba(0, 0, 255, 1)">if</span> (p.Metadata.Name == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">LastLog</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
     {
         </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åªä¿®æ¹è¿ä¸ªå±æ§</span>
         p.<span style="background-color: rgba(0, 255, 0, 1)">IsModified = <span style="color: rgba(0, 0, 255, 1)">true</span></span><span style="color: rgba(0, 0, 0, 1)">;
         p.CurrentValue </span>=<span style="color: rgba(0, 0, 0, 1)"> DateTime.Now;
     }
     </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">
     {
         </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¶ä»å±æ§ä¸æ¹ï¼æ è®°ä¸ºéä¿®æ¹ç¶æ</span>
         p.<span style="background-color: rgba(0, 255, 0, 1)">IsModified = <span style="color: rgba(0, 0, 255, 1)">false</span></span><span style="color: rgba(0, 0, 0, 1)">;
     }
 }

 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°è¿½è¸ªä¿¡æ¯</span>
<span style="color: rgba(0, 0, 0, 1)"> Console.WriteLine(context.ChangeTracker.DebugView.LongView);
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æäº¤ä¿å­</span>
 context.SaveChanges();</pre>
</div>
<p>å¨æ¹åå®ä½ç¶ææ¶ï¼åè®¾ç½®æ´ä¸ªå®ä½ä¸º Modifiedï¼æ­¤æ¶ç±äºæ²¡æåå§å¿«ç§åæ¯è¾ï¼å®ä½çææå±æ§ï¼ä¸å«ä¸»é®ï¼é½è¢«æ è®°ä¸º Modifiedï¼å¦æè¿æ ·æ´æ°æ°æ®åºçè¯ï¼ä¼æ NameãLogNameãPassword ç­å±æ§é½æ´æ¹ä¸º null äºãæä»¥ï¼å±ä»¬å¨è®¾ç½®å®ä½ä¸º Modified åï¼è¿è¦å¯¹åä¸ªå±æ§ååæèãç¨ foreach æä¸¾åä¸ªå±æ§ï¼åªæ LastLog å±æ§æè®¾ç½®ä¸º Modifiedï¼å¶ä»çå±æ§è®¾ç½®ä¸ºæªæ´æ¹ï¼è¿æ ·åéå°æ°æ®åºç UPDATE è¯­å¥åªä¼ SET LastLog å±æ§ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">UPDATE</span> "Users" <span style="color: rgba(0, 0, 255, 1)">SET</span> "_last_log" <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(0, 128, 0, 1)">@p0</span>
<span style="color: rgba(0, 0, 255, 1)">WHERE</span> "u_id" <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(0, 128, 0, 1)">@p1</span><span style="color: rgba(0, 0, 0, 1)">
RETURNING </span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1</span>;</pre>
</div>
<p>ç±äºå±ä»¬è¦æ´æ°çæ¯å½±å­å±æ§ï¼ä¸è½ä½¿ç¨ ExecuteUpdate è¿æ ·çä¾¿æ·æ¹æ³ã</p>
<p>æ¬æå°æ­¤ç»æã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-12 22:23">2026-02-12 22:23</span>&nbsp;
<a href="https://www.cnblogs.com/tcjiaan">ä¸éªç¬å­¤</a>&nbsp;
éè¯»(<span id="post_view_count">38</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19601119);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19601119', targetLink: 'https://www.cnblogs.com/tcjiaan/p/19601119', title: 'ãEF Coreãå®ä½è¿½è¸ªââEntryä¸­è®°å½çæ°æ®' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æç17å² ]]></title>
    <link>https://www.cnblogs.com/jayzorn-ljz/p/19611417</link>
    <guid>51aa6d758070f24e0d95cf866c19fb70</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jayzorn-ljz/p/19611417" title="åå¸äº 2026-02-13 13:46">
    <span role="heading" aria-level="2">æç17å²</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="æçåä¸å²">æçåä¸å²</h1>
<p><em>ä½ ä¸ºä»ä¹è¦æ»ç»èªå·±ï¼ä½ è¦åäºä»ä¹ï¼ä½ è¦æèä»ä¹ï¼</em></p>
<hr>
<h2 id="åèªå·±å¯¹è¯">åèªå·±å¯¹è¯</h2>
<p>è¿æ¯ç¬¬å æ¬¡æ»ç»èªå·±äºï¼æ¯æ¬¡åå¤´çï¼æ»è§å¾æäºä¸è¥¿æ²¡åéï¼æäºè¯è¯´å¾ä¸å¯¹ãä¸è¿ï¼it doesn't matter. åªè¦è½çä¸ç¹æç¨çï¼å°±å¤äºã</p>
<p>åä¸å²äºââè½ç¶è¿æåä¸ªæå°±åå«äºãä½ ææ²¡ææ´»æèªå·±æ³è¦çæ ·å­ï¼ä½ ç°å¨å¼å¿åï¼è½èä¸985ã211åï¼ååãè¯´æ¥æè¶£ï¼é¿å¤§ä¹åï¼å±ç¶ççè½åç­å°æ¶åé®èªå·±çé£äºé®é¢ã</p>
<p>æ¯ï¼ææ´»æäºèªå·±æ³è¦çæ ·å­ãæå¾å¼å¿ï¼ä½ä¸ç¡®å®è½ä¸è½èä¸985ã211ãæèèå¤è¯»ï¼æ³è¯è¯ãç°å¨çæï¼å¾åæ¬¢å­¦ä¹ ï¼åæ¬¢éè¯»ï¼å°¤å¶ç±è¯»é£äºæææ¿çãå²ç ´ç¢ç¬¼ãæææµçãæè´æ·±æ²çä¹¦ï¼æ¯å¦ãå¹³å¡çä¸çããç½ªä¸ç½ããå´åããçº¦ç¿°Â·åå©æ¯æµå¤«ããè¾¹åããæåæ¬¢æ²æµ¸è¿å»ï¼ä½éªä»ä»¬ççæ´»ï¼é£äºä¸æä¸åççæ´»ãææ¶ä¹è¯»è¯»å²å­¦ãæè¿åæ¬¢å¼¹åä»ãæå½±ãæè¡ãåæ¥è®°ãè¿å¨å¥èº«ãå¯¹äºï¼ç¼ç¨æä¹æ²¡æ¾ä¸ã</p>
<p>ä½ ç¥éåï¼æåæ¬¢ä¸äºä¸ä¸ªåæ ¡çå¥³å­©ãå¥¹å¾å¥½ï¼å¾ç¾ï¼å¸¦ç¹å¤©çï¼åæ¬¢åå¥½åçï¼åæ¬¢æå¥½ççç§çãæåæ¬¢å¥¹çæ´»çæ ·å­ï¼ä¹åæ¬¢å¥¹çéªä¼´ãäººççè·¯ä¸ï¼åéå°ä¸ä¸ªå¯ç±çåè·¯äººãæ»ä¹ï¼æå¾åæ¬¢å¥¹ã</p>
<p>ä¸ç¥éä»¥åçä½ æ¯æä¹æ³çãé£ä¹åå©ï¼é£ä¹çéæç»©ï¼å´ä¸æ¢æ¹æ¹æ³ï¼ä¸æ¢ç´é¢å¤±è´¥ãä½ çæ¯ä¸ªæ¦å¤«ã</p>
<p>ä½ è¿è®°å¾åï¼é£ä¸ªåæ¬¢ä½ çå¥³å­©ï¼å¯¹ä½ ççå¾å¥½ãå¯ä½ ç¯äºå¾ä¸¥éçéãä½ æ¯éå¥¹ï¼ä½ èªç§ï¼ä½ æ³ä¸è¿å´å¹²æ¶å¥¹ççæ´»ãä½ æ³å æå¥¹ï¼ä½ ä¸ç±å¥¹ââä½ åªæ¯æ»¡è¶³èªå·±çèè£å¿ï¼æ»¡è¶³é£ç§æ§æ§çæå°±æãä½ ä»å¦å°±æ¯ä¸ªæ··èã</p>
<p>å¹¸å¥½å¥¹èµ°äºï¼ç¦»ä½ è¶è¿è¶å¥½ï¼ä¸è³äºååä½ çæç£¨ã</p>
<p>è¿æï¼ä»¥åä½ å°±æ¯ä¸ªâåè±ªâï¼ä¸ºäºè£é¼å­¦çµèææ¯ãä¸è¿ï¼ä½ ç¡®å®ââç¡®å®æ¯æå®å½æäºç­ç±ãæå¾é«å´ä½ ä¸ç´æ²¡ä¸¢ãå¯ä½ çææ³å¤ªç­éäºï¼æ¯ä¸ªå¸åçâJunior geekâãåç¹å°å·¥å·å°±æ²¾æ²¾èªåï¼é¢å¯¹å¤§åé¡¹ç®ãéè¦ç³»ç»å­¦ä¹ è®¡ç®æºç¥è¯çæ¶åï¼åä¸æ¢å¨æãä¸è¿ï¼å¹¸äºä½ æ²¡ç¡¬æ¥ï¼ä¸ç¶è¿é«ä¸­ææ¯çè¦åºäºã</p>
<p>æä»C++ä¹ç¶é£å¿æ»ç»äºå æ¡ç»éªï¼<a href="https://www.bilibili.com/video/BV1jiZcYnEXe/?share_source=copy_web&amp;vd_source=2cc479c274bd7a9c44e39239f22b7ba6" target="_blank" rel="noopener nofollow">C++åå§äººè®¿è°ãç¼ç¨ç»éªæè®­ãè¡ä¸åå±</a>ï¼ï¼å¸æä½ æ¾å¨å¿ä¸ï¼</p>
<ol>
<li>ä¸è¦ç°å¨å°±ä¸ä¸åââä½ è¿ä¸ç¡®å®ä»¥ååä»ä¹ãè½¦å¼å¤ªå¿«ï¼è½¬ä¸äºå¼¯ã</li>
<li>å«æèªå·±å¹»æ³æå­¤å»çå¤©æãæ²¡å¿è¦ï¼ä¹ä¸å·æ§ä»·æ¯ãå­¦ä¼äº¤æµï¼äººç±»æ¯ç¾¤å±å¨ç©ï¼åä½æ¯æä»¬ç¬ä¸é£ç©é¾é¡¶ç«¯çæå¤§ä¼å¿ï¼å«ä¸¢æå®ã</li>
<li>å­¦åå²ãå¤«ä»¥éä¸ºéï¼å¯ä»¥æ­£è¡£å ï¼ä»¥å¤ä¸ºéï¼å¯ä»¥ç¥å´æ¿ï¼ä»¥äººä¸ºéï¼å¯ä»¥æå¾å¤±ãå­¦ä¼æ²éãæææ¯å½æ¡ç®­çãè½»è§äº¤æµçäººï¼å¿æ­»æ çã</li>
<li>è±æ¶é´å¹³è¡¡çæ´»ï¼ä¸ºå°æ¥åå¥½åå¤ã</li>
<li>å¹¿æ³çå­¦ä¹ åç»åï¼æ¯ä½ å¨æºä¼æ¥ä¸´æ¶è½æä½å®çåæãåªå­¦ææ¯ï¼å¿æ­»æ çã</li>
</ol>
<p>æåï¼ææ³è¯´ï¼å¯¹ä¸èµ·ã</p>
<p>ææ²¡æå¥½å¥½å­¦é£äºåºè¯çåè¯¾ï¼æå¤ªå¤æ¶é´è±å¨ç¼ç¨ä¸ï¼æä½ å¸¦è¿äºé©å¢ãæä»¬å¯è½åªè½è¯»ä¸ªå¤§ä¸äºâ¦â¦ä½å«æãæä¼æ£æçï¼æä¼å¸¦ä½ é¯åºå»ã</p>
<hr>
<h2 id="ææ³æä¹å">ææ³æä¹å</h2>
<p>å¥½å¦ï¼èå¤©å°æ­¤ä¸ºæ­¢ãè¯´è¯´ç°å¨ççæ´»åè®¡åå§ã</p>
<p>æçç®æ å¾ç®åï¼åè¿æ¬ç§çº¿ï¼ç¶ååæ¥å¤è¯»ï¼æåå²ä¸å²985ãæç¸ä¿¡æå¯ä»¥ãæå·²åå¥½èµ´æ­»çåå¤ã</p>
<p>çæ´»åæ¯å¾ä¸°å¯ãæä¸ååªæ²è¿·ç¼ç¨ï¼ä¹å¼å§å¬æ­ãççµå½±ãéè¯»ãåä½ãå­¦ä¸ä¸è¯¾ãç©ãæ­»äº¡ææµããæå½±ãæ£æ­¥ãå¥èº«ãååæ¬¢çå¥³å­©èå¤©ã</p>
<p>è¿æ¶åè¯å®æäººè´¨é®ï¼ç¦»é«èåªå©ä¸ç¾å¤©ï¼ä½ æä¹è¿æ¢åè¿ä¹å¤è¯¾å¤çäºï¼</p>
<p>ææ³è¯´ï¼è¿æ¯ç­ç¥é®é¢ãä½è¿å°±æ¯æççæ´»ââææ³åï¼ä¹ä¼åãå·¥ä½æ¥éï¼æçå­¦ä¹ æ¶é´è½å å°æ¯å¤©ç45.83%ï¼è½ç¶å¸¸å¸¸å ä¸ºæç»ªé®é¢éª¤éå°33.3%ä¸å°ââè¿å¤§æ¦ä¹æ¯æç»©ä¸å¥½çåå ä¹ä¸ãæ³å®ä¼æ¯æ¥å¯è½åªå©22.92%ãä½æ²¡å³ç³»ï¼ææè½åæ¯éèªå·±ççæ´»ï¼ä¸è³äºè·å¥æ·±æ¸ã</p>
<hr>
<h2 id="æ¹åä½ æå¤§çæ¯åªä»¶äº">æ¹åä½ æå¤§çï¼æ¯åªä»¶äºï¼</h2>
<p>æå¾æ©å°±å¼å§æ³ï¼æä¹è¾¾æç®æ ï¼æä¹åï¼æä¹æ¹åèªå·±ï¼ââææ³é¿è¯ç­è¯´ã</p>
<p>é«ä¸ï¼èä¸äºå¸éç¹ä¸­å­¦ââå¸ä¸ä¸­ä¹åï¼æå å¥äºâçµå¨è®¡ç®æºç¤¾âãé«äºï¼æ ¸å¿ç¤¾ååç¤¾é¿è¢«éæåºæ¥ï¼ç»å»ºäºä¸ä¸ªå«âç§åé¨âçå­¦çæºæï¼é¶å±äºæ ¡å¢å§ä¼ãå­¦æ ¡çå­¦çæºæä»¥âä¼âé¨âæ¶æè¿è¡ï¼æå¢å§ä¼ãå­¦çä¼ãç¤¾èçäºä¼ç­ï¼åä¼ä¸è®¾ä¸åé¨é¨ï¼æ¯å¦å¢å§ä¼ä¸æç»ç»é¨ï¼ç¤¾èçäºä¼æåªä½å¶ä½é¨ãç§åé¨æ¯å­¦æ ¡äºå¤§å­¦çé¨é¨ä¹ä¸ï¼æ¥è§¦ç®¡çå±çæºä¼æºå¤ã</p>
<p>ææ¯2026å±çï¼ç§åé¨ç¬¬äºä»»é¨é¿ï¼ä¹æ¯çµå¨è®¡ç®æºç¤¾ä¸ç¥ç¬¬å ä»»ç¤¾é¿ãåä»»é¨é¿æ¯2025å±çå­¦é¿ä»¬ãä»ä»¬ææ¯å¼ºãç¥è¯å¹¿ãæç»´ä¹åå«ãæä»ä»ä»¬èº«ä¸å­¦å°å¤ªå¤ââå ä¸ºä»ä»¬ï¼ææå¼å§è¯»ä¹¦ãéè§åå²ï¼å°è¯é£äºæä»æªåè¿ãçè³å®³æåçäºãä»ä»¬æ¯ææå¥½çèå¸ãææè°¢ä»ä»¬ã</p>
<p>å¶ä¸­æä¸ä½é¨é¿ï¼æç§°ä»ä¸ºâå­å¯âãå­å¯ä¸ªå­ä¸é«ï¼ççæç¹åãæå¯¹ä»äºè§£ä¸å¤ï¼å½¼æ­¤çå³ç³»å¾åå¸çââé£ç§ä¸­å¼å¸çã</p>
<p>2026å¹´1æ24æ¥é£æï¼å­å¯ä¸ºæå¼å¯¼äººçãæé®äºå¾å¤ï¼ä¸ºä»ä¹ææ»æ¯å¤±è´¥ï¼ä¸ºä»ä¹æäºäºä¸è½åï¼ä¸ºä»ä¹è¦æ´»å¨å½ä¸ï¼ä»é½ä¸ä¸ä½ç­ãé£ä¸æè¿åï¼æè§å¾äººçå¥½åäº®èµ·äºä¸ç¹åãåæ¥ï¼æç§ä»çæ¨èè¯»äºãè®¨åçåæ°ãï¼å¿éè±ç¶å¼æã</p>
<p>åæ¥ï¼æå®³æå¤±è´¥ï¼å®³æå¤±å»ï¼æè¿½æ±åå©ï¼èªæè®¤ç¥çç¾ï¼æç¼ºç±ï¼æ¸´æéªä¼´ï¼æè¿åº¦å¨æä»äººè¯ä»·ï¼åä¸æ¢æ¹åâ¦â¦</p>
<p>å¥½å¨ï¼æè½æ¥åï¼ä¹ç»äºæ¿è®¤äºã</p>
<p>ä»é£æ¶èµ·ï¼ææçæ­£å¼å§çæ´»ââæåé¢è¯´çé£äºï¼ä¸ä»¶ä¸ä»¶ï¼åäºä¸å»ã</p>
<h2 id="ç»èªå·±ç®åçå¥è¯å§">ç»èªå·±ç®åçå¥è¯å§</h2>
<p>å¸æä½ å°æ¥è½èä¸985ï¼çæèº«è¾¹åæ¬¢çäººï¼åæ¢çå»ç±ä½ ç±çäººï¼ä¿æèªå·±çæ³ççæ´»ï¼æ´»å¨å½ä¸ã</p>
<p>ææåä¸å²ãææ¥åä¸ççèéªï¼æââæ³ç»èªå·±æ¥ä¸ªçå¿«çæ´ç¤¼ï¼</p>
<hr>
<p><em>çæ­£çåæç»ä¸æ¯æ°¸æ²¡æé»æçæ¶é´ï¼åªæ¯æ°¸ä¸è¢«é»æææ©è½ç½¢äºãçæ­£çè±éç»ä¸æ¯æ°¸æ²¡æåä¸çææï¼åªæ¯æ°¸ä¸è¢«åä¸çæææå±æç½¢äºã</em><br>
<em>æä»¥å¨ä½ è¦æèå¤æ¥çæäººä¹åï¼åå¾æèä½ åå¨çæäººï¼ä½ ä¸å¿å®³ææ²æ²¦å è½ï¼åªæ¶ä½ è½ä¸æ­å°èªæä¸æ´æ°......</em><br>
<em>æå£«åï¼å½ä½ ç¥éä¸çä¸åè¦çä¸ç¥ä½ ä¸ä¸ªæ¶ï¼ä½ å®ä¼åå°çæ¥ï¼èä½ çå¸æä¹å°æ°¸è¿å¨ç»æä¸­åçäºç½¢ï¼</em></p>
<p>â                                                                                                   ââåé·ä¸ä¹ä¸ä¸å¹´è¯ãçº¦ç¿°åå©æ¯æµå¤«ãæ¶æç®(èé)</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.03819444444444445" data-date-updated="2026-02-13 14:41">2026-02-13 13:46</span>&nbsp;
<a href="https://www.cnblogs.com/jayzorn-ljz">JayZorn</a>&nbsp;
éè¯»(<span id="post_view_count">110</span>)&nbsp;
è¯è®º(<span id="post_comment_count">8</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19611417);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19611417', targetLink: 'https://www.cnblogs.com/jayzorn-ljz/p/19611417', title: 'æç17å²' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æçGISå®è·µä¸æèï¼æ°ä¹¦ãGISåºç¡åçä¸ææ¯å®è·µãåäº« ]]></title>
    <link>https://www.cnblogs.com/charlee44/p/19611747</link>
    <guid>2532538b05f8420f76ca470a0b05b349</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/charlee44/p/19611747" title="åå¸äº 2026-02-13 13:27">
    <span role="heading" aria-level="2">æçGISå®è·µä¸æèï¼æ°ä¹¦ãGISåºç¡åçä¸ææ¯å®è·µãåäº«</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        ä½èç»åèªèº«GISå¼åç»éªï¼åäº«èä¸è·¯å¾æèãæ°ä¹¦ãGISåºç¡åçä¸ææ¯å®è·µãçåä½åè¡·ï¼å¹¶éä¸å¤ç¯ææ¯èéä¸å¼æºèµæºï¼å¡å¯¼âåç+å®è·µâèåçå­¦ä¹ æ¹å¼ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="1-å¼è¨">1. å¼è¨</h1>
<p>ç»è¿å å¹´çç§¯ç´¯ä¸æç£¨ï¼ç¬èçæ°ä¹¦ãGISåºç¡åçä¸ææ¯å®è·µãç»äºæ­£å¼åºçäºãå¶å®è°ä¸ä¸ä»ä¹å®å¤§æä¹ï¼åªæ¯æè¿äºå¹´å¨ GIS å¼åä¸­è¸©è¿çåãçæ¸çæè·¯ãåè¿çä»£ç ï¼ç³»ç»å°æ´çåºæ¥ãè¶çæ°ä¹¦é¢ä¸ï¼ä¹æ³åæ­¤æºä¼ååäº«ä¸äºä½ä¼ä¸æèã</p>
<p><img alt="GISåºç¡åçä¸ææ¯å®è·µ" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1000410/202602/1000410-20260213132603470-1001452052.jpg" class="lazyload"></p>
<h1 id="2-gisä¹è·¯">2. GISä¹è·¯</h1>
<p>GIS æ¯ä¸æ¬ç»¼åæ§å¾å¼ºçå­¦ç§ï¼æä»¥å­¦ä¹  GIS ä»¥åä»ä¸ä¸ä¸å®æ¯èµ° GIS å¼åè¿æ¡è·¯ãæ¯å¦æ¯è¾ç¨³å¦¥çå°±æ¯å»ä½å¶åï¼åçº§èªç¶èµæºå±ãæµç»é¢ãè§åé¢ãæ°´å©/äº¤é/ç¯ä¿ç­æ¿åºé¨é¨åä¸å±äºä¸åä½ç­ç­ãä»ä»¬å¯è½ä¸åä»£ç ï¼ä½éè¦çè§£ç©ºé´æ°æ®ãä¼ç¨ä¸ä¸è½¯ä»¶ãè½åä¸é¡¹ç®è®¾è®¡æææå®¡æ¥ï¼å·¥ä½ç¸å¯¹ç¨³å®ï¼ä¹æ·±åº¦åä¸å½å®¶åºç¡å°çä¿¡æ¯ä½ç³»å»ºè®¾ãå½ç¶ï¼ä½å¶åçå²ä½ç±»åå¤æ ·ï¼èè´£ä¸èå¥åæä¸åï¼å¹¶éä¸æ¦è½»æ¾ââéåä¸å¦ï¼ç»ç©¶è¦çä¸ªäººå¿è¶£ä¸æé¿ãèå¨è¿æ ·çç¯å¢ä¸­ï¼ä¸ä¸è½ååºç¶æ¯åºç¡ï¼ä½æ²éåä½ãçè§£ç»ç»è¿è¡é»è¾ï¼å¾å¾ä¹å½±åçé¿è¿çåå±ç©ºé´ã</p>
<p>ä½æ¯ï¼å¦æéæ©ä½å¶å¤çåå±è·¯å¾ï¼å GIS å¼åä¼æ¯ä¸ä¸ªæ´æåå±ç©ºé´çæ¹åãå¦æåªæ¯ä¼ç¨ GIS è½¯ä»¶å¤çæ°æ®ãåºå¾ï¼å¨ç°å¨è¿ä¸ªèªå¨åè¶æ¥è¶æ®åçç¯å¢ä¸ï¼è¿ç±»æè½å¶å®å¾å®¹æè¢«æ¿ä»£ï¼ä¹å¾é¾å½¢æèªå·±çä¼å¿ãè¯´ç½äºï¼è¿æ´å¤æ¯ä¸ç§æ§è¡æ§çå·¥ä½ãè GIS æ¬èº«çåºç¨é¢å¶å®ä¸ç®ç¹å«å®½ï¼ä½å¦æå ä¸å¼åè½åï¼æåµå°±ä¸ä¸æ ·äºââä½ å¯ä»¥èªå·±åå·¥å·ãæ¹è¿æµç¨ï¼çè³åä¸å°æºæ§åå¸ãå®æ¯ä¸ç»´ãæ¶ç©ºå¹³å°è¿äºå®éé¡¹ç®ä¸­å»ãç°å¨ä¼ç¼ç¨çäººç¡®å®ä¸å°ï¼ä½æ¢æ GIS çä¸å¡é»è¾ï¼åè½æç©ºé´æ°æ®ãåæ ç³»ç»ãæå¡åå¸è¿äºäºæç¨ä»£ç çæ­£è·èµ·æ¥çäººæå¹¶ä¸å¤ã</p>
<p>æ´æ·±å¥å°è¯´ï¼GIS çæ­£çä»·å¼ï¼ä¸å¨äºå®æ¬èº«ï¼èå¨äºå®çâè¿æ¥æ§âââå®å¤©ç¶å·å¤ä¸åç§åæ²¿ææ¯èåçè½åãåçº¯åä¼ ç»ç GIS å·¥ä½ï¼æ è®ºæ¯æ°æ®å¤çè¿æ¯å¶å¾åæï¼èä¸åå±çå¤©è±æ¿å¾å¾æ¯è¾ææ¾ãä½å ä¹æ¯ä¸æ¬¡ææ¯æµªæ½®ââæ¯å¦äººå·¥æºè½ãé¥æè§£è¯ãæ¶ç©ºå¤§æ°æ®ãç©èç½ãä½ç©ºç»æµãæ°å­å­ªçââé½ç¦»ä¸å¼å¯¹âä½ç½®âåâç©ºé´å³ç³»âççè§£ï¼èè¿æ­£æ¯ GIS çæ ¸å¿ãäºå®ä¸ï¼ä¸å°ä»äºè¿äºæ°å´é¢åçå·¥ç¨å¸æç ç©¶äººåï¼é½æ GIS æå°çä¿¡æ¯ç¸å³çèæ¯ãä»ä»¬ä¹æä»¥è½è±é¢èåºï¼å¾å¾ä¸æ¯å ä¸ºåªæ GISï¼èæ¯æ GIS çç©ºé´æç»´ï¼åç¼ç¨ãç®æ³ãç³»ç»æ¶æç­åºå±è½åç»åèµ·æ¥ã</p>
<p>æä»¥ï¼ä¸å¶æèªå·±å±éå¨âGIS ä»ä¸èâçæ ç­¾éï¼ä¸å¦æ²ä¸å»ï¼å»ææ¡é£äºæ¯æ GIS åºç¨çåºç¡ææ¯ï¼åæ ç³»ç»ãæ°æ®ç»æãæå¡æ¶æãå¾å½¢æ¸²æãçè³æ°å­¦åç®æ³ãåªæè¿æ ·ï¼æè½å¨ææ¯åé©ä¸­çæ­£ç«ç¨³èè·ï¼èä¸æ¯è¢«å·¥å·æ¿ä»£ã</p>
<h1 id="3-ä¹¦ç±åºè¨">3. ä¹¦ç±åºè¨</h1>
<p>å°çä¿¡æ¯ç³»ç»ï¼Geographic Information Systemï¼ç®ç§° GISï¼èªè¯çä»¥æ¥ï¼å·²ä»ä¸é¨è¾¹ç¼ææ¯éæ­¥æé¿ä¸ºæ¯æç°ä»£ç¤¾ä¼ç©ºé´è®¤ç¥ä¸å³ç­çéè¦å·¥å·ãæ è®ºæ¯åå¸è§åãç¯å¢çæµãåºæ¥ç®¡çï¼è¿æ¯åä¸éåãæºæ§äº¤éãæ°å­å­ªçï¼GIS çèº«å½±æ å¤ä¸å¨ãå®ä¸ä»è¿æ¥äºç°å®ä¸ççå°çç©ºé´ä¸æ°å­ä¸ççæ½è±¡è¡¨è¾¾ï¼æ´å¨äººå·¥æºè½ãå¤§æ°æ®ãç©èç½ç­æ°å´ææ¯æµªæ½®ä¸­ä¸æ­çåæ°ççå½åã</p>
<p>å½åï¼GIS è¡ä¸æ­£å¤äºæ·±å»åé©çå³é®é¶æ®µï¼å¨å½å®¶âä¿¡åâæç¥æ¨å¨ä¸ï¼å½äº§åæ¿ä»£å éï¼èªä¸»å¯æ§ææ¯æ æ¥çæçï¼å®æ¯ä¸ç»´ä¸­å½å»ºè®¾å¸¦å¨ä¸ç»´ GIS å¿«éåå±ï¼ç©ºé´è¡¨è¾¾ä»äºç»´è¿åå¨ç©ºé´ç«ä½åï¼äººå·¥æºè½ä¸ GIS æ·±åº¦èåï¼æ¾èæåäºé¥æè§£è¯ãç©ºé´é¢æµç­è½åï¼åæ¶ï¼äºåçæ¶æçæ®åæ­£æ¨å¨ GIS æå¡åå¾®æå¡åãå¼¹æ§ä¼¸ç¼©åé«å¹¶åå±äº«æ¼è¿ï¼WebGIS ä¸ç©ºé´æ°æ®ä¸­å°éæ­¥æä¸ºè¡ä¸åºç¡è®¾æ½ãè¿äºè¶å¿ä¸æ­æå± GIS çè¾¹çï¼ä¹å¸¦æ¥å¨æ°çæºéä¸ææã</p>
<p>ç¶èï¼å¯¹äºåå­¦èèè¨ï¼GIS å¾å¾æ¾å¾åºæèæ½è±¡ãå®æ¨ªè·¨å°çå­¦ãæµç»å­¦ãé¥æãè®¡ç®æºç§å­¦ãæ°æ®ç§å­¦ç­å¤ä¸ªå­¦ç§ï¼æ¢æä¸¥è°¨çæ°å­¦åºç¡ï¼åæå¤æçå·¥ç¨å®ç°ï¼æ¢è¦çè§£åæ ç³»ç»ççè®ºé»è¾ï¼åè¦ææ¡æ°æ®å¤çä¸å¯è§åçå®ææè½ãè®¸å¤äººå¨å­¦ä¹ è¿ç¨ä¸­å®¹æé·å¥âç¥å¶ç¶ï¼ä¸ç¥å¶æä»¥ç¶âçå°å¢ââè®°ä½äºæä½æ­¥éª¤ï¼å´é¾ä»¥çè§£èåçåçï¼å­¦ä¼äºè½¯ä»¶ä½¿ç¨ï¼å´æ æ³åºå¯¹çå®åºæ¯ä¸­çå¤æé®é¢ã</p>
<p>æ¬ä¹¦æ­£æ¯ä¸ºå¼¥åè¿ä¸é¸¿æ²èåãä½ä¸ºä½èï¼ææ·±ç¥çè®ºè±ç¦»å®è·µçæ åï¼ä¹ä½ä¼è¿é¢å¯¹æµ·é GIS æ¦å¿µæ¶çè¿·è«ãå æ­¤ï¼æ¬ä¹¦ä¸ä»¥å ç æ¯è¯­ä¸ºç®æ ï¼ä¹ä¸æ»¡è¶³äºå¯¹è½¯ä»¶åè½çç®åå¤è¿°ï¼èæ¯åæâåçä¸ºåºãå®è·µä¸ºæ¡¥âççå¿µï¼åæ±å¨æ¸æ°ééæ ¸å¿æ¦å¿µçåæ¶ï¼éè¿å¤§éå¯è¿è¡ãå¯è°è¯ãå¯æ©å±çææ¯æ¡ä¾ï¼å¼å¯¼è¯»èäº²ææå»ºå¯¹ GIS çç³»ç»æ§çè§£ã</p>
<p>å¨ä¹¦å´ç»ä¸æ¡æ¸æ°çç¥è¯ä¸»çº¿å±å¼ï¼ä»ç©ºé´åèç³»ç»è¿ä¸âå°çä¸ççè¯­è¨âåºåï¼ä¾æ¬¡åæç¢éãæ æ ¼ãå°å½¢ä¸ä¸ç»´æ¨¡ååç§æ ¸å¿æ°æ®æ¨¡åçæ¬è´¨ä¸åºç¨ï¼ç»§èæ¢è®¨ç°ä»£ GIS å¦ä½éè¿æå¡åæ¹å¼å±äº«æ°æ®ï¼å¦ä½éè¿å¯è§ååç°ä»·å¼ï¼æç»è½èäºç©ºé´æ¥è¯¢ä¸åæè¿ä¸ GIS ççµé­æå¨ãæ¯ä¸ç« é½éæè¯¦å°½çä»£ç å®ç°ï¼æææ¡ä¾åæç®¡äºå¼æºå¹³å°https://github.com/fafa1899/GISBasic ï¼ï¼é¼å±è¯»èè¾¹è¯»è¾¹åï¼å¨å®è·µä¸­æ·±åè®¤ç¥ã</p>
<p>éè¦å¦è¯è¯´æçæ¯ï¼ç±äºæä¹¦æ¶é´è¾ä¸ºç´§ä¿ï¼å ä¹æ¬äººå­¦è¯æéï¼ä¹¦ä¸­é¾åå­å¨çæ¼ä¸ä¸è¶³ãå°¤å¶ç©ºé´åæä¸æºè½åºç¨è¿ä¸åï¼è½æåæ­¥æ¶çï¼ä½æªè½æ·±å¥å±å¼ï¼å®ä¸ºä¸å¤§éæ¾ãæªæ¥çæ¬ä¸­ï¼æå°å°½åè¡¥åç¸å³åå®¹ï¼ä¹æ³è¯·å¹¿å¤§è¯»èä¸åææ­£ï¼å±åå®åè¿æ¬é¢åå®è·µç GIS å¥é¨ä¹ä½ã</p>
<p>æ¿ä½ å¨éè¯»æ¬ä¹¦çè¿ç¨ä¸­ï¼ä¸ä»è½å­¦ä¼âæä¹åâï¼æ´è½é¢æâä¸ºä»ä¹è¿ä¹åâï¼ä¸ä»ææ¡ææ¯ï¼æ´è½å»ºç«èµ·å±äºèªå·±ç GIS ç¥è¯ä½ç³»ãå½ä½ è½å¤èªå¦å°å°å°çç©ºé´æç»´åºç¨äºå®éé®é¢æ¶ï¼ä¾¿æ¯æ¬ä¹¦æå¤§çæåã</p>
<p>è°¨ä»¥æ­¤ä¹¦ï¼ç®ç»ææå¯¹å°çä¸çåæ»¡å¥½å¥ãæ¿æå¨ææ¢ç´¢çä½ ã</p>
<h1 id="4-åå®¹èé">4. åå®¹èé</h1>
<ol>
<li><a href="https://charlee44.com/post.html?id=fd717a0e06a1402a90ea1a1c53320a92" target="_blank" rel="noopener nofollow">GISä¸­çâé«åº¦âå°åºæä»ä¹ï¼ä¸æåæ¸æ­£é«ãæ­£å¸¸é«ä¸å¤§å°é«çåºå«</a>ï¼æ·±å¥è§£æ GIS ä¸­é«ç¨åèç³»ç»çæ ¸å¿æ¦å¿µââå¤§å°æ°´åé¢ãä¼¼å¤§å°æ°´åé¢ä¸åèæ¤­çé¢çå³ç³»ï¼åæ¸æ­£é«ãæ­£å¸¸é«ä¸å¤§å°é«çåºå«åè½¬æ¢æ¹æ³ï¼å¹¶ä»ç»æå½é«ç¨åºåä¸å¨çéåæ¨¡åã</li>
<li><a href="https://charlee44.com/post.html?id=51b4a939e17b4426acd704b11f0031df" target="_blank" rel="noopener nofollow">GISå¼åå¿ç¥ï¼WKT ä¸ EPSG å¦ä½è¡¨è¾¾ç©ºé´åèåæ ç³»ï¼é GDAL å®ç°</a>ï¼æ·±å¥è§£æ GIS ä¸­ç©ºé´åèåæ ç³»çæ ååè¡¨è¾¾æ¹å¼ââWKT ä¸ EPSG ç¼ç ï¼å¹¶éè¿ GDAL ä»£ç å®ææ¼ç¤ºå¦ä½åå»ºä¸è¾åºå°çåæ ç³»åé«æ¯-ååæ ¼æå½±åæ ç³»ã</li>
<li><a href="https://charlee44.com/post.html?id=0494eaa683ad43ddbd4d87900b093050" target="_blank" rel="noopener nofollow">ä»Shapefileå°GeoJSONï¼ç¨GDALå®ç°GISç¢éæ°æ®è¯»åä¸ç©ºé´åæ</a>ï¼éè¿ GDAL/OGR å®ç°äº GIS ç¢éæ°æ®çå®æ´å¤çæµç¨ââä» Shapefile è¯»åãWGS84 å° Web å¢¨å¡æåæ è½¬æ¢ï¼å° GeoJSON åå¥ï¼å¹¶æ¼ç¤ºäºç¹ä¸å¤è¾¹å½¢ææå³ç³»ï¼å¦ Containsï¼çå¤æ­æ¹æ³ã</li>
<li><a href="https://charlee44.com/post.html?id=cad0147cbff74ad69e2c68c5203eb5f5" target="_blank" rel="noopener nofollow">ä¸åªæ¯å¾çï¼æ·±å¥çè§£ GIS æ æ ¼æ°æ®æ¬è´¨ä¸ GDAL è¯»åå®æ</a>ï¼æ·±å¥åæ GIS æ æ ¼æ°æ®çæ¬è´¨ââå®ä¸åªæ¯æ®éå¾çï¼è¿è½è¡¨ç¤ºé«ç¨ãéé¨ãåå°ç±»åç­ç©ºé´ä¿¡æ¯ï¼å¹¶éè¿ GDAL æ¼ç¤ºäº GeoTIFF çè¯»åä¸åå»ºå®æã</li>
<li><a href="https://charlee44.com/post.html?id=120dc48f44be4395934acf73046ea1b2" target="_blank" rel="noopener nofollow">ä»DEMå°ç­é«çº¿ï¼ææç¢éä¸æ æ ¼ä¸¤ç§å°å½¢è¡¨è¾¾</a>ï¼æ·±å¥è§£æç­é«çº¿å°å½¢å¾çç¢éä¸æ æ ¼ä¸¤ç§çæåçï¼å¹¶éè¿ C++ ä»£ç ä»é¶å®ç° DEM å°ç­é«çº¿çå®æ´æµç¨ï¼æ­ç¤º GIS å°å½¢è¡¨è¾¾çæ ¸å¿é»è¾ã</li>
<li><a href="https://charlee44.com/post.html?id=8c60d37fd0f74da2a7190894971f8673" target="_blank" rel="noopener nofollow">ä»DEMå°ä¸ç»´å°å½¢ï¼ç¨PLYãOBJãglTFæå»ºGISå¯è§åæ¨¡å</a>ï¼éè¿ä»DEMçæPLYç½æ¨¡ãOBJçº¹çæ¨¡åå°glTFæ åèµäº§çå®æ´ä»£ç ç¤ºä¾ï¼ç³»ç»æ­ç¤ºäºä¸ç»´GISæ¨¡åæå»ºçæ ¸å¿åçä¸ææ¯æ¼è¿ã</li>
<li><a href="https://charlee44.com/post.html?id=411a16083323420d855655c1ec41d9a5" target="_blank" rel="noopener nofollow">ä¸ç»´æ¨¡åç¦çæå¡ä¸åå®¢ï¼3D TilesãI3Sä¸S3Må¨è§£æ</a>:ç³»ç»è§£æäºä¸ç»´GISä¸­ä¸å¤§ä¸»æµç¦çæ åââCesium 3D TilesãEsri I3S åè¶å¾ S3M çæ ¸å¿æºå¶ãæ°æ®ç»æä¸éç¨åºæ¯ï¼æ¶µçç¦çæ ãåå´ä½ãå ä½è¯¯å·®ãè¦ç´ åè®¾è®¡åæ ·å¼è¡¨è¾¾ç­å³é®ææ¯ã</li>
<li><a href="https://charlee44.com/post.html?id=9a3aec3a04b54708a52f321784eb5152" target="_blank" rel="noopener nofollow">GISåæ²¿ææ¯</a>ï¼æ¢è®¨äºGISææ¯çææ°åæ²¿åå±æ¹ååå¶åºç¨ä»·å¼ï¼æ¶µçä¸ç»´GISãæ°å­å­ªçãäººå·¥æºè½ãæ¶ç©ºå¤§æ°æ®äºå¹³å°ä»¥åä½ç©ºç»æµç­å¤ä¸ªé¢åï¼å±ç¤ºäºGISå¨æºæ§åå¸ãèªç¶èµæºç®¡çãæ äººæºåºç¨ç­æ¹é¢çéè¦ä½ç¨åå¹¿éåæ¯ã</li>
<li><a href="https://charlee44.com/post.html?id=db441070211c496e9d2553af5b29e09e" target="_blank" rel="noopener nofollow">å°å¾æå¡å¨GeoServerçå®è£ä¸éç½®</a>ï¼è¯¦ç»ä»ç»äºå°å¾æå¡å¨GeoServerçå®è£ä¸éç½®è¿ç¨ã</li>
<li><a href="https://charlee44.com/post.html?id=003c0b5046da427dbca50ad300d8b62d" target="_blank" rel="noopener nofollow">GeoServeråå¸å°å¾æå¡ï¼WMSãWFSï¼</a>ï¼è¯¦ç»è®ºè¿°äºä½¿ç¨GeoServeråå¸å°å¾æå¡WMSåWFSçè¿ç¨ã</li>
<li><a href="https://charlee44.com/post.html?id=067f76316c76430c97c1440044c13f19" target="_blank" rel="noopener nofollow">ç½ç»å°å¾æå¡ï¼WMSï¼è¯¦è§£</a>ï¼æ ¹æ®å·ä½å®ä¾è¯¦ç»è®ºè¿°äºGISä¸­ç½ç»å°å¾æå¡ï¼WMSï¼çåå®¹ã</li>
<li><a href="https://charlee44.com/post.html?id=41fb5cab870c4f7c8760716671338826" target="_blank" rel="noopener nofollow">ç½ç»è¦ç´ æå¡ï¼WFSï¼è¯¦è§£</a>ï¼éè¿å®ä¾è¯¦ç»ä»ç»äºWebGISä¸­ç½ç»è¦ç´ æå¡ï¼WFSï¼çå·ä½åå®¹ã</li>
<li><a href="https://charlee44.com/post.html?id=bee53ec2f8bd4ce4a04c8f0abd277a14" target="_blank" rel="noopener nofollow">å¾æåä½åæ¨¡åææ¯å®ç°</a>ï¼è¯¦ç»ä»ç»äºå¾æåä½åæ¨¡åçåç§å®ç°æè·¯ã</li>
</ol>
<hr>
<blockquote>
<p>æ¬ä¹¦ã<strong>GISåºç¡åçä¸ææ¯å®è·µ</strong>ãå·²äº 2025 å¹´ 11 æç±åäº¬èªç©ºèªå¤©å¤§å­¦åºçç¤¾æ­£å¼åºçãå¨ä¹¦å±åç« ï¼ç³»ç»è¦çç©ºé´åèãåå¤§æ ¸å¿æ°æ®æ¨¡åï¼ç¢é/æ æ ¼/å°å½¢/ä¸ç»´ï¼ãå°çä¿¡æ¯æå¡ãå¯è§ååç©ºé´åæï¼å¹¶éå¥ <strong>C++/Python/C#/Java/JavaScript å¤è¯­è¨ç¤ºä¾ä»£ç </strong>ï¼ææèµæºå¼æºæç®¡äº GitHubã</p>
<p>ð <strong>æ¬¢è¿æå´è¶£çè¯»èéè¿ä»¥ä¸æ¸ éäºè§£ææ¯ææ­£ç</strong>ï¼<br>
ð <a href="https://item.jd.com/14603137.html" target="_blank" rel="noopener nofollow">äº¬ä¸è´­ä¹°</a>ï½<a href="https://product.dangdang.com/29988568.html" target="_blank" rel="noopener nofollow">å½å½è´­ä¹°</a><br>
ð» <strong>éå¥å¼æºé¡¹ç®</strong>ï¼<a href="https://github.com/fafa1899/GISBasic" target="_blank" rel="noopener nofollow">GitHub</a> | <a href="https://gitcode.com/charlee44/GISBasic" target="_blank" rel="noopener nofollow">GitCode</a></p>
</blockquote>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 13:27">2026-02-13 13:27</span>&nbsp;
<a href="https://www.cnblogs.com/charlee44">charlee44</a>&nbsp;
éè¯»(<span id="post_view_count">7</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19611747);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19611747', targetLink: 'https://www.cnblogs.com/charlee44/p/19611747', title: 'æçGISå®è·µä¸æèï¼æ°ä¹¦ãGISåºç¡åçä¸ææ¯å®è·µãåäº«' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ AI Ã åå®¢å­ç®è¤ ]]></title>
    <link>https://www.cnblogs.com/guangzan/p/19609096</link>
    <guid>e830f117701ded3fd34c9afd873210ae</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/guangzan/p/19609096" title="åå¸äº 2026-02-13 10:56">
    <span role="heading" aria-level="2">AI Ã åå®¢å­ç®è¤</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="1-åè¨">1. åè¨</h2>
<p>åå®¢å­èª 2004 å¹´ä¸çº¿ä»¥æ¥ï¼å­åçç®æ´ççé¢ãæµåçææ¯æ°å´æä¸ºäºå½åç¨åºåçæ ¸å¿åä½å¹³å°ä¹ä¸ï¼èç®è¤å®å¶åæ¯åå®¢å­ç¨æ·ä¸ªæ§åè¡¨è¾¾çéè¦æ¹å¼ãä»æ©æççº¯ CSS æ ·å¼ä¿®æ¹ï¼å°åæ¥ç JS èæ¬å¢å¼ºï¼åå®¢å­ç®è¤å¼åçéæ±ä¸æ­åçº§ï¼ä½å¹³å°çåçå¼åæ¨¡å¼å´å§ç»æ²¡æè·ä¸åç«¯ææ¯çåå±æ­¥ä¼ã</p>
<p>å¨åç«¯å·¥ç¨åãç°ä»£åæ¡æ¶ï¼React/Vueï¼ãå®ç¨å CSS æ¡æ¶ï¼Tailwind CSSï¼æä¸ºè¡ä¸ä¸»æµï¼ä¸ AI å¤§æ¨¡åæ·±åº¦èå¥åç«¯å¼åçä»å¤©ï¼åå®¢å­åççâæµè§å¨ç«¯ä¿®æ¹ CSS/JS çæ®µâçå¼åæ¨¡å¼æ¾å¾æ ¼æ ¼ä¸å¥ï¼ç¨æ·åªè½å¨æµè§å¨ä¸­æ£æ¥åç´ ãä¿®æ¹æ ·å¼ï¼æ²¡æç­æ¨¡åæ¿æ¢ï¼HMRï¼ãæ²¡æç±»åæ ¡éªãæ²¡ææåä¼åãæ²¡ææ¨¡ååï¼æ æ³äº«åç°ä»£åç«¯ä¾¿å©ãæ´è®© AI å¤§æ¨¡åæ æ³æææ¥å¥ââAI é¾ä»¥è¯»ååå®¢å­çåçæ¨¡æ¿ã</p>
<p>æ­£æ¯å¨è¿æ ·çèæ¯ä¸ï¼æåå»ºäº <strong>Tona</strong>ãTona æ¯åºäº Monorepo æ¶ææé çä¸å¥å®æ´çåå®¢å­ç®è¤å¼åå·¥å·é¾ãæ¬æå°ä»ææ¯åºå±å°å®æåºç¨ï¼å¨é¢ä»ç» Tona çè®¾è®¡ä¸å®ç°ï¼å¹¶ç»å AI å¤§æ¨¡åçè½åï¼æé ä¸å¥ <strong>AI Ã Tona Ã åå®¢å­ç®è¤</strong>çç°ä»£åå¼åèå¼ï¼è®©æ¯ä¸ä½å¼åèé½è½å¿«éå¼ååºé«è´¨éãå¯ç»´æ¤ãä¸ªæ§åçåå®¢å­ç®è¤ï¼åæ¶äº«å AI åä½å¼åçé«æä¸ä¾¿æ·ã</p>
<h2 id="2-åå®¢å­ç®è¤å¼åççç¹">2. åå®¢å­ç®è¤å¼åççç¹</h2>
<p>åå®¢å­ä¸ºç¨æ·æä¾äº<strong>é¡µé¢å®å¶ CSS</strong>ã<strong>åå®¢ä¾§è¾¹æ å¬å</strong>ã<strong>é¡µè HTML ä»£ç </strong>ã<strong>èªå®ä¹ JS èæ¬</strong>ç­å¥å£ï¼åè®¸ç¨æ·éè¿ç¼å CSS/JS/HTML çæ®µå®ç°ç®è¤å®å¶ï¼ä½è¿ç§å¼åæ¨¡å¼å­å¨å­å¤§æ ¸å¿çç¹ï¼ä¸¥éå¶çº¦äºå¼åæçåç®è¤è´¨éï¼</p>
<p><strong>ï¼1ï¼å¼åç¯å¢ç®éï¼æ ç°ä»£ååç«¯å·¥ç¨åè½å</strong></p>
<p>åå®¢å­çç®è¤å¼åå®å¨ä¾èµ<strong>æµè§å¨ç«¯</strong>ï¼å¼åèéè¦åå¨åå®¢å­åå°ç¼è¾ä»£ç ï¼ä¿å­åå·æ°é¡µé¢æ¥çææï¼æ²¡æ<strong>ç­æ´æ°ï¼HMRï¼</strong> è½åï¼ä¿®æ¹ä¸è¡æ ·å¼éè¦ç­å¾é¡µé¢éæ°å è½½ï¼æ²¡ææåå·¥å·ï¼æ æ³å¯¹ JS/CSS è¿è¡åç¼©ãæ æãæéå è½½ï¼æ²¡ææ¨¡åç³»ç»ï¼æ æ³ä½¿ç¨ ES6+ç<code>import/export</code>ï¼åªè½éè¿å¨å±åéå®ç°ä»£ç å¤ç¨ï¼ä»£ç åä½ä¸é¾ä»¥ç»´æ¤ã</p>
<p><strong>ï¼2ï¼è°è¯é¾åº¦å¤§ï¼æ å®æ´çè°è¯å·¥å·é¾</strong></p>
<p>åå®¢å­çåçä»£ç è¿è¡å¨å¹³å°çå¨å±ç¯å¢ä¸­ï¼å¼åèåªè½éè¿æµè§å¨çå¼åèå·¥å·è¿è¡ç®åçåç´ æ£æ¥åæ­ç¹è°è¯ï¼æ æ³ä½¿ç¨ ViteãWebpack ç­å·¥å·çè°è¯è½åï¼ä¹æ æ³å¯¹ä»£ç è¿è¡ååæµè¯ãéææµè¯ï¼åæ¶ï¼åå®¢å­çåç HTML æ¨¡æ¿ä¸å¯ä¿®æ¹ï¼å¼åèéè¦å¨å·²æ DOM ç»æä¸è¿è¡æ ·å¼è¦çå JS æä½ï¼DOM ç»æçä¸ç¡®å®æ§è¿ä¸æ­¥å¢å äºè°è¯é¾åº¦ã</p>
<p><strong>ï¼3ï¼ææ¯æ åéï¼æ æ³ä½¿ç¨ç°ä»£ååç«¯æ¡æ¶ä¸å·¥å·</strong></p>
<p>åå®¢å­åçå¼åä»æ¯æåç CSS/JS/HTMLï¼æ æ³ç´æ¥ä½¿ç¨ React/React/Vue ç­ç°ä»£ååç«¯æ¡æ¶ï¼ä¹æ æ³ä½¿ç¨ Tailwind CSSãUnoCSS ç­å®ç¨å CSS æ¡æ¶ï¼å³ä½¿å¼åèéè¿æå¨å¼å¥æ¡æ¶ CDN åå®ç°äºé¨ååè½ï¼ä¹ä¼é¢ä¸´å¨å±åéå²çªãæåä½ç§¯è¿å¤§ãæ§è½ä¸ä½³ç­é®é¢ï¼æ æ³åæ¥ç°ä»£åå·¥å·ççæ­£ä»·å¼ã</p>
<p><strong>ï¼4ï¼ä»£ç å¯ç»´æ¤æ§å·®ï¼æ æ¨¡ååä¸ç±»åå®å¨</strong></p>
<p>ç±äºæ²¡ææ¨¡åç³»ç»åç±»åæ ¡éªï¼åå®¢å­ç®è¤çä»£ç å¾å¾æ¯âé¢æ¡å¼ä»£ç âï¼CSS æ ·å¼ç¸äºè¦çï¼JS å½æ°å¨å±æè½½ï¼HTML çæ®µé¶æ£åå¸ï¼æ²¡æ TypeScript çç±»åæ ¡éªï¼å¼åèå¨ç¼åä»£ç æ¶å®¹æåºç°è¯­æ³éè¯¯ãåéåéè¯¯ç­é®é¢ï¼ä¸éè¯¯åªè½å¨è¿è¡æ¶åç°ï¼å¼åæçæä½ã</p>
<p><strong>ï¼5ï¼å¢éåä½å°é¾ï¼æ æ ååçå¼åæµç¨</strong></p>
<p>åå®¢å­ç®è¤çå¼åä»¥ä¸ªäººä¸ºä¸»ï¼æ²¡ææ ååçé¡¹ç®ç»æãä»£ç è§èãæäº¤è§èï¼ä»£ç ä¿å­å¨åå®¢å­åå°ï¼æ æ³éè¿ Git è¿è¡çæ¬ç®¡çï¼ä¹æ æ³è¿è¡å¢éåä½å¼åï¼åæ¶ï¼æ²¡æ Lint å·¥å·ãPrettier å·¥å·çä»£ç æ ¼å¼åè½åï¼ä¸åå¼åèçä»£ç é£æ ¼å·®å¼å¤§ï¼ä»£ç åå¹¶ä¸ç»´æ¤å°é¾ã</p>
<p><strong>ï¼6ï¼AI é¾ä»¥æ¥å¥ï¼æ æ³äº«å AI å¤§æ¨¡åçå¼åçº¢å©</strong></p>
<p>è¿æ¯æ°æ¶ä»£åå®¢å­ç®è¤å¼åçæ ¸å¿çç¹ä¹ä¸ãAI å¤§æ¨¡åçææå¼åéè¦<strong>æ ååçé¡¹ç®ç»æ</strong>ã<strong>å¯è®¿é®çä»£ç æä»¶</strong>ã<strong>æ¸æ°çææ¯è§è</strong>ï¼èåå®¢å­åçå¼åçä»£ç ä»å­å¨äºåå®¢å­åå°çé¶æ£çæ®µä¸­ï¼AI æ æ³è¯»ååå®¢å­çåç HTML æ¨¡æ¿ãæ æ³çè§£ä»£ç çä¸ä¸æãæ æ³çæç¬¦åè§èçæ¨¡ååä»£ç ï¼æ´æ æ³åä¸å·¥ç¨åçå¼åæµç¨ï¼è®©å¼åèéå¤± AI å¼åççº¢å©ã</p>
<h2 id="3-tonaæ¶æææ¯æ ä¸å·¥ç¨åæµæ°´çº¿">3. Tonaï¼æ¶æãææ¯æ ä¸å·¥ç¨åæµæ°´çº¿</h2>
<h3 id="31-åå®¢å­ç®è¤å¼åçç°ä»£åè§£å³æ¹æ¡">3.1 åå®¢å­ç®è¤å¼åçç°ä»£åè§£å³æ¹æ¡</h3>
<div class="mermaid">flowchart TD
    A[ä¼ ç» CNBlogs å¼å] --&gt; B[æµè§å¨æ£æ¥åç´ ]
    B --&gt; C[æå¨ä¿®æ¹ CSS/JS]
    C --&gt; D[ä¸ä¼ è®¾ç½®çé¢æµè¯]
    D --&gt; E[éå¤è°è¯ï¼æçä½]

    F[Tona å¼å] --&gt; G[pnpm create tona åå§å]
    G --&gt; H[Vite æ¬å°æå¡å¨ + æ¨¡æ¿æ³¨å¥]
    H --&gt; I[ç­æ´æ° + AI çæä»£ç ]
    I --&gt; J[æå»ºæå + é¨ç½²]

    subgraph è§£å³æ¹æ¡
    F --&gt; J
    end

    subgraph çç¹
    A --&gt; E
    end
</div><p>Tona æ ¸å¿å®ä½æ¯åå®¢å­ä¸å±çæ¨¡ååç®è¤å¼åå·¥å·é¾ï¼å¶è®¾è®¡åè¡·å°±æ¯è§£å³ä¸è¿°åå®¢å­åçå¼åçææçç¹ãTona åºäº Monorepo æ¶ææé äºä¸å¥å®æ´çç®è¤å¼åå·¥å·é¾ï¼åå«å¯å¤ç¨çæ ¸å¿åãé¢æå»ºçç®è¤ãå¯æ©å±çæä»¶ç³»ç»ï¼åæ¶æ·±åº¦æ´å Vite çæï¼å®ç°äºåå®¢å­ç®è¤çæ¬å°å¼åãå·¥ç¨åæå»ºãæ ååé¨ç½²ã</p>
<p>Tona çæ ¸å¿è§£å³æ¹æ¡å¯ä»¥æ»ç»ä¸ºä»¥ä¸äºç¹ï¼</p>
<ol>
<li><strong>æ¬å°å¼åç¯å¢æ­å»º</strong>ï¼éè¿<code>tona-vite</code>æä»¶å°åå®¢å­çåç HTML æ¨¡æ¿æ³¨å¥ Vite Dev Server ä¸­ï¼è®©å¼åèå¯ä»¥å¨æ¬å°è±ç¦»åå®¢å­ç¯å¢è¿è¡ç®è¤å¼åï¼äº«å Vite çç­æ´æ°ãè°è¯ãæåç­å·¥ç¨åè½åï¼</li>
<li><strong>ç°ä»£åææ¯æ æ¯æ</strong>ï¼åçæ¯æ TypeScriptãReactãTailwind CSS V4 ç­ç°ä»£ååç«¯ææ¯æ ï¼æä¾äºæ ååçé¡¹ç®ç»æåä»£ç è§èï¼è®©å¼åèå¯ä»¥ä½¿ç¨çæçå·¥å·å¼ååå®¢å­ç®è¤ï¼</li>
<li><strong>æ¨¡ååçæ ¸å¿åä½ç³»</strong>ï¼å°æ ¸å¿è½åæåä¸º<code>tona-core</code>ã<code>tona-hooks</code>ã<code>tona-options</code>ã<code>tona-utils</code>ç­å¤ä¸ªæ ¸å¿åï¼æ¯ä¸ªåè´è´£ç¹å®çåè½ï¼å®ç°äºåè½çè§£è¦ä¸å¤ç¨ï¼åæ¶ä¹ä¸º AI å¼åæä¾äºæ ååç APIï¼</li>
<li><strong>å·¥ç¨åçå¼åæµç¨</strong>ï¼æä¾äºå®æ´çå¼åãæå»ºãæµè¯ãåå¸ï¼éæäº VitestãBiomeãStylelint ç­å·¥å·ï¼å®ç°äºä»£ç ç Lintãæ ¼å¼åãååæµè¯ãéææµè¯ï¼åæ¶æ¯æ Git çæ¬ç®¡çåå¢éåä½å¼åï¼</li>
<li><strong>å¯æ©å±çæä»¶ç³»ç»</strong>ï¼æä¾äº<code>tona-plugins</code>æä»¶ç³»ç»ï¼å¼åèå¯ä»¥éè¿ç¼åæä»¶å®ç° DOM æä½ãåè½å¢å¼ºç­éæ±ï¼åæ¶åç½®äºå¤ä¸ªå®ç¨æä»¶ï¼æ»¡è¶³å¼åèçæ¥å¸¸å¼åéæ±ã</li>
</ol>
<p>ç®åæ¥è¯´ï¼Tona è®©åå®¢å­ç®è¤å¼åä»<strong>âæµè§å¨ç«¯çé¶æ£çæ®µå¼åâ</strong> åçº§ä¸º<strong>âæ¬å°çç°ä»£ååç«¯é¡¹ç®å¼åâ</strong>ï¼è®©å¼åèå¯ä»¥åå¼åæ®éåç«¯é¡¹ç®ä¸æ ·å¼ååå®¢å­ç®è¤ï¼åæ¶ä¸º AI æ¥å¥æ­å»ºäºæ ååçææ¯åºåº§ã</p>
<h3 id="32-monorepo-æ¶æè®¾è®¡">3.2 Monorepo æ¶æè®¾è®¡</h3>
<p>Tona éç¨<strong>åºäº pnpm workspace ç Monorepo æ¶æ</strong>ï¼è¿æ¯ç°ä»£ååç«¯çä¸»æµæ¶æéæ©ï¼å¶ä¼å¿å¨äºå¯ä»¥å°æ ¸å¿è½åæåä¸ºå¤ä¸ªç¬ç«çåï¼å®ç°åè½çè§£è¦ä¸å¤ç¨ï¼åæ¶ä¾¿äºçæ¬ç®¡çåå¢éåä½å¼åã</p>
<p>Tona ç Monorepo ç»æä¸»è¦åä¸º<strong>ä¸å¤§æ ¸å¿ç®å½</strong>ï¼</p>
<p><strong>ï¼1ï¼æ ¹ç®å½ï¼å·¥ç¨åæµæ°´çº¿éç½®</strong></p>
<p>Tona çæ ¹ç®å½åå«äºææå·¥ç¨åéç½®æä»¶ï¼å¦<code>pnpm-workspace.yaml</code>ï¼pnpm å·¥ä½åºéç½®ï¼ã<code>biome.jsonc</code>ï¼ä»£ç  Lint ä¸æ ¼å¼åï¼ã<code>vitest.config.ts</code>ï¼æµè¯éç½®ï¼ã<code>package.json</code>ï¼æ ¹ç®å½èæ¬ä¸ä¾èµï¼ç­ï¼åæ¶æä¾äº<code>scripts/</code>ç®å½ï¼åå«å¼åãæå»ºãåå¸çæ ¸å¿èæ¬ï¼å®ç°äº<strong>ä¸é®å¼åãä¸é®æå»ºãä¸é®åå¸</strong>ã</p>
<p><strong>ï¼2ï¼<code>packages/</code>ï¼æ ¸å¿åä¸å·¥å·é¾ï¼12 ä¸ªåï¼</strong></p>
<p><code>packages/</code>ç®å½æ¯ Tona çæ ¸å¿ï¼åå« 12 ä¸ªç¬ç«çåï¼æ¯ä¸ªåè´è´£ç¹å®çåè½ï¼éç¨<strong>åå±æ¶æ</strong>è®¾è®¡ï¼æå»ºå±ãæ©å±å±ãUI å±ãå·¥å·å±ãåºç¡å±ï¼ï¼åä¹é´éè¿<code>workspace:*</code>åè®®ç¸äºå¼ç¨ï¼å®ç°æ¬å°å¼åæ éåå¸ï¼åæ¶ä¾¿äºçæ¬åæ­¥ã</p>
<p>ææååä½¿ç¨ TypeScript å¼åï¼æä¾å®æ´çç±»åå®ä¹ï¼è¿ä¸ä»ä¿è¯äºç±»åå®å¨ï¼ä¹ä¸º AI å¼åæä¾äºæ¸æ°ç API æç¤ºã</p>
<p><strong>ï¼3ï¼<code>themes/</code>ï¼åç½®ç®è¤å®ç°ï¼3 ä¸ªç®è¤ï¼</strong></p>
<p><code>themes/</code>ç®å½åå« Tona åç½®ç 3 ä¸ªåå®¢å­ç®è¤ç®è¤ï¼åä¸º<strong>ç»ä»¶åæ¨¡å¼</strong>å<strong>æä»¶åæ¨¡å¼</strong>ä¸¤ç§å¼åèå¼ï¼</p>
<ul>
<li><strong>Shadcn ç®è¤</strong>ï¼åºäº React+Tailwind CSS V4 çç»ä»¶åç®è¤ï¼éç¨ Tona çå¨éæ ¸å¿åï¼éåå¼åå¤æãç¾è§ãå¯å®å¶çé«ç«¯ç®è¤ï¼</li>
<li><strong>Geek/Reacg ç®è¤</strong>ï¼åºäºåç DOM+Sass çæä»¶åç®è¤ï¼ä»ä½¿ç¨ Tona çæ ¸å¿åï¼core/options/pluginsï¼ï¼éåå¼åè½»éãé«æçæç®ç®è¤ã</li>
</ul>
<p>è¿ 3 ä¸ªç®è¤ä¸ä»æ¯å¯ç´æ¥ä½¿ç¨çåå®¢å­ç®è¤ï¼æ´æ¯ Tona ç<strong>å®æç¤ºä¾</strong>ï¼AI å¯ä»¥éè¿è¯»åè¿äºç®è¤çä»£ç ï¼å­¦ä¹  Tona çå¼åè§èåæä½³å®è·µã</p>
<p><img src="https://img2024.cnblogs.com/blog/1501373/202602/1501373-20260213101052637-421617829.png" alt="image" width="1511" height="935" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/1501373/202602/1501373-20260213100059752-592802182.png" alt="image" width="1511" height="943" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/1501373/202602/1501373-20260213100904348-378022767.png" alt="image" width="1511" height="939" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/1501373/202602/1501373-20260213101430958-1237882624.png" alt="image" width="1511" height="943" loading="lazy"></p>
<h3 id="34-æ ¸å¿ææ¯æ éå">3.4 æ ¸å¿ææ¯æ éå</h3>
<p>Tona çææ¯æ éåéµå¾ª<strong>è½»éãç°ä»£ãé«æãééåå®¢å­</strong>çååï¼ææææ¯æ åä¸ºå½ååç«¯è¡ä¸çä¸»æµéæ©ï¼åæ¶ååèèäºåå®¢å­çè¿è¡ç¯å¢ã</p>
<p>Tona çæ ¸å¿ææ¯æ å¯åä¸º<strong>æ ¸å¿å¼åå·¥å·</strong>ã<strong>åç«¯æ¡æ¶</strong>ã<strong>æ ·å¼å·¥å·</strong>ã<strong>å·¥ç¨åå·¥å·</strong>åå¤§ç±»ï¼å·ä½éååçæ¬ãç¨éå¦ä¸è¡¨æç¤ºï¼</p>
<table>
<thead>
<tr>
<th>åç±»</th>
<th>ææ¯æ </th>
<th>çæ¬</th>
<th>æ ¸å¿ç¨é</th>
</tr>
</thead>
<tbody>
<tr>
<td>æå»ºå·¥å·</td>
<td>Vite</td>
<td>^7.3.1</td>
<td>å¼åæå¡å¨ãç­æ´æ°ãæåæå»ºãæ æä¼å</td>
</tr>
<tr>
<td>åç®¡çå¨</td>
<td>pnpm</td>
<td>10.28.2</td>
<td>Monorepo å·¥ä½åºç®¡çãä¾èµå®è£ãåä¹é´çå¼ç¨</td>
</tr>
<tr>
<td>å¼åè¯­è¨</td>
<td>TypeScript</td>
<td>^5.9.3</td>
<td>å¨æ¡æ¶ç±»åå®å¨ãä»£ç æç¤ºãè¯­æ³æ ¡éª</td>
</tr>
<tr>
<td>UI æ¡æ¶</td>
<td>Preact</td>
<td>^10.28.2</td>
<td>è½»é React æ¿ä»£æ¹æ¡ï¼ä½ç§¯å°ãæ§è½é«ï¼ééåå®¢å­çå¨å±ç¯å¢</td>
</tr>
<tr>
<td>æ ·å¼æ¡æ¶</td>
<td>Tailwind CSS</td>
<td>^4.1.18</td>
<td>å·¥å·ç±»ä¼åç CSS æ¡æ¶ï¼å¿«éå®ç°æ ·å¼å¼åï¼æ¯æ@apply æä»¤</td>
</tr>
<tr>
<td>åæå»ºå·¥å·</td>
<td>tsdown</td>
<td>latest</td>
<td>TypeScript åç¼è¯ï¼å° TS ä»£ç ç¼è¯ä¸º ES æ¨¡åï¼éé Vite çæ</td>
</tr>
<tr>
<td>æµè¯å·¥å·</td>
<td>Vitest</td>
<td>^4.0.16</td>
<td>ååæµè¯ãéææµè¯ï¼æ¯æå¿«ç§æµè¯ãæ¨¡ææµè¯</td>
</tr>
<tr>
<td>ä»£ç  Lint</td>
<td>Biome</td>
<td>^2.3.11</td>
<td>ä»£ç  Lintãæ ¼å¼åãè¯­æ³æ ¡éªï¼æ¿ä»£ ESLint+Prettierï¼æ§è½æ´é«</td>
</tr>
<tr>
<td>Git Hooks</td>
<td>Lefthook</td>
<td>^2.0.13</td>
<td>æäº¤åä»£ç æ ¡éªãæµè¯ï¼ä¿è¯ä»£ç æäº¤è´¨é</td>
</tr>
<tr>
<td>CSS é¢å¤çå¨</td>
<td>Sass</td>
<td>latest</td>
<td>æä»¶åç®è¤çæ ·å¼å¼åï¼æ¯æåéãæ··åãåµå¥</td>
</tr>
<tr>
<td>å¨ç»åº</td>
<td>motion</td>
<td>^12.25.0</td>
<td>tona-theme-shadcn ç®è¤çå¨ç»ææï¼å®ç°æµççé¡µé¢è¿æ¸¡åäº¤äº</td>
</tr>
<tr>
<td>å¾æ åº</td>
<td>lucide-React</td>
<td>^0.562.0</td>
<td>tona-theme-shadcn ç®è¤çå¾æ ç³»ç»ï¼æä¾ä¸°å¯çç¢éå¾æ </td>
</tr>
<tr>
<td>ç»ä»¶åº</td>
<td>@base-ui-components</td>
<td>1.0.0-beta.4</td>
<td>tona-theme-shadcn ç®è¤çæ å¤´ UI ç»ä»¶ï¼å®ç°å¯å®å¶çåºç¡ç»ä»¶</td>
</tr>
</tbody>
</table>
<p><strong>ææ¯æ éåçæ ¸å¿èé</strong>ï¼</p>
<ol>
<li><strong>Preact</strong>ï¼React çä½ç§¯ä» 3KB å·¦å³ï¼è¿å°äº Reactï¼ä¸ API ä¸ React å®å¨å¼å®¹ï¼ä¸ä¼å¨åå®¢å­çå¨å±ç¯å¢ä¸­é æä½ç§¯è¿å¤§æåéå²çªçé®é¢ï¼</li>
<li><strong>Vite ä½ä¸ºæå»ºå·¥å·</strong>ï¼Vite çç­æ´æ°éåº¦æå¿«ï¼æåæçé«ï¼ä¸åçæ¯æ ES æ¨¡åï¼éå¸¸éååå®¢å­ç®è¤çæ¬å°å¼åï¼</li>
<li><strong>pnpm ä½ä¸ºåç®¡çå¨</strong>ï¼pnpm çåå®è£éåº¦å¿«ãç£çå ç¨ä½ï¼ä¸åçæ¯æ Monorepo æ¶æï¼æ¯ Tona çæä½³éæ©ï¼</li>
<li><strong>Tailwind CSS V4</strong>ï¼Tailwind CSS V4 ç¸æ¯æ§çæ¬æ§è½æ´é«ãåè½æ´å¨ï¼æ¯æ@apply æä»¤çé«çº§ç¨æ³ï¼éå¸¸éååå®¢å­ç®è¤çæ ·å¼å¼åï¼</li>
<li><strong>Biome æ¿ä»£ ESLint+Prettier</strong>ï¼Biome æ¯ä¸æ¬¾é«æ§è½çä¸ç«å¼ä»£ç å·¥å·ï¼éæäº Lintãæ ¼å¼åãè¯­æ³æ ¡éªç­åè½ï¼éç½®ç®åï¼æ§è½è¿é«äº ESLint+Prettierï¼éå Monorepo æ¶æçå·¥ç¨åç®¡çã</li>
</ol>
<h3 id="35-å¼åä¸æå»ºæµæ°´çº¿">3.5 å¼åä¸æå»ºæµæ°´çº¿</h3>
<p>Tona æä¾äº<strong>æ ååçå¼åä¸æå»ºæµæ°´çº¿</strong>ï¼æææä½é½éè¿æ ¹ç®å½ç<code>package.json</code>èæ¬å®ç°ï¼å¼åèæ éå³å¿åºå±çå®ç°ç»èï¼åªéæ§è¡ç®åçå½ä»¤å³å¯å®æå¼åãæå»ºãæµè¯ãåå¸ç­æä½ãåæ¶ï¼è¿ä¸æµæ°´çº¿ä¹ä¸º AI å¼åæä¾äºæ ååçæä½å¥å£ââAI å¯ä»¥éè¿æ§è¡è¿äºèæ¬ï¼åä¸å¨æµç¨çå¼åã</p>
<p>Tona çå¼åä¸æå»ºæµæ°´çº¿å¯éè¿ä»¥ä¸ Mermaid å¾ç´è§å±ç¤ºï¼</p>
<div class="mermaid">graph LR
    A[å¼åé¶æ®µ] --&gt; A1[pnpm devï¼å¯å¨å¼åæå¡å¨]
    A1 --&gt; A2[scripts/dev-theme.tsï¼ç®è¤å¼åèæ¬]
    A2 --&gt; A3[Vite Dev Server+HMRï¼ç­æ´æ°å¼å]
    B[æµè¯é¶æ®µ] --&gt; B1[pnpm testï¼æ§è¡åå/éææµè¯ï¼Vitestï¼]
    B1 --&gt; B2[pnpm typecheckï¼TypeScript ç±»åæ ¡éª]
    B2 --&gt; B3[pnpm lintï¼ä»£ç  Lint ä¸æ ¼å¼åï¼Biomeï¼]
    C[æå»ºé¶æ®µ] --&gt; C1[pnpm buildï¼æå»ºç®è¤ï¼Viteï¼]
    C1 --&gt; C2[pnpm build:pkgï¼å¹¶è¡æå»ºæææ ¸å¿å]
    C2 --&gt; C3[Vite Build+æ æï¼ç®è¤æåä¼å]
    C2 --&gt; C4[tsdownï¼TS åç¼è¯ä¸º ES æ¨¡å]
    C3 --&gt; C5[themes/*/dist/ï¼ç®è¤æå»ºäº§ç©]
    C4 --&gt; C6[packages/*/dist/ï¼åæå»ºäº§ç©]
    D[åå¸é¶æ®µ] --&gt; D1[pnpm releaseï¼çæ¬åå¸]
    D1 --&gt; D2[bumppï¼çæ¬å·èªå¢]
    D2 --&gt; D3[scripts/update-versions.mjsï¼åæ­¥ææåçæ¬]
    D3 --&gt; D4[åå¸å° npm/ç§æä»åº]
</div><p><strong>ï¼1ï¼æ ¸å¿èæ¬è¯´æ</strong></p>
<p>Tona çæ ¹ç®å½<code>package.json</code>æä¾äº 7 ä¸ªæ ¸å¿èæ¬ï¼è¦çäºå¼åãæµè¯ãæå»ºãåå¸çå¨æµç¨ï¼å·ä½å¦ä¸è¡¨æç¤ºï¼</p>
<table>
<thead>
<tr>
<th>èæ¬å</th>
<th>å·ä½å½ä»¤</th>
<th>æ ¸å¿ç¨é</th>
</tr>
</thead>
<tbody>
<tr>
<td>dev</td>
<td>node scripts/dev-theme.ts</td>
<td>å¯å¨ Vite å¼åæå¡å¨ï¼æ³¨å¥åå®¢å­æ¨¡æ¿ï¼å®ç°ç­æ´æ°å¼å</td>
</tr>
<tr>
<td>build</td>
<td>node scripts/build-theme.ts</td>
<td>æå»ºææç®è¤ï¼éè¿ Vite è¿è¡æåãåç¼©ãæ æä¼åï¼çæå¯é¨ç½²çæå»ºäº§ç©</td>
</tr>
<tr>
<td>build:pkg</td>
<td>pnpm -r --filter=./packages/** --parallel run build</td>
<td>å¹¶è¡æå»º<code>packages/</code>ç®å½ä¸çæææ ¸å¿åï¼æé«æå»ºæç</td>
</tr>
<tr>
<td>typecheck</td>
<td>tsc --noEmit</td>
<td>å¯¹ææ TypeScript ä»£ç è¿è¡ç±»åæ ¡éªï¼ä¿è¯ç±»åå®å¨</td>
</tr>
<tr>
<td>test</td>
<td>vitest test</td>
<td>æ§è¡ Vitest çååæµè¯åéææµè¯ï¼ä¿è¯ä»£ç è´¨é</td>
</tr>
<tr>
<td>lint</td>
<td>pnpm exec biome check --write</td>
<td>å¯¹ææä»£ç è¿è¡ Lint åæ ¼å¼åï¼èªå¨ä¿®å¤ä»£ç é£æ ¼é®é¢</td>
</tr>
<tr>
<td>release</td>
<td>bumpp ... -x "zx scripts/update-versions.mjs"</td>
<td>çæ¬å·èªå¢ï¼åæ­¥æææ ¸å¿ååç®è¤ççæ¬ï¼å®ç°ä¸é®åå¸</td>
</tr>
</tbody>
</table>
<p><strong>ï¼2ï¼æµæ°´çº¿çæ ¸å¿ç¹ç¹</strong></p>
<ol>
<li><strong>ä¸é®åæä½</strong>ï¼æææµç¨é½éè¿ç®åç<code>pnpm &lt;script&gt;</code>å½ä»¤å®ç°ï¼å¼åèæ éå³å¿åºå±ç»èï¼</li>
<li><strong>å¹¶è¡æå»º</strong>ï¼<code>build:pkg</code>èæ¬éè¿<code>pnpm -r --parallel</code>å®ç°æææ ¸å¿åçå¹¶è¡æå»ºï¼å¤§å¹æé«æå»ºæçï¼</li>
<li><strong>èªå¨åæ ¡éª</strong>ï¼<code>lint</code>ã<code>typecheck</code>ã<code>test</code>èæ¬å®ç°äºä»£ç çèªå¨åæ ¡éªï¼ä¿è¯ä»£ç è´¨éï¼</li>
<li><strong>çæ¬åæ­¥</strong>ï¼<code>release</code>èæ¬éè¿<code>bumpp</code>åèªå®ä¹èæ¬å®ç°äºææååç®è¤ççæ¬åæ­¥ï¼é¿åçæ¬ä¸ä¸è´çé®é¢ï¼</li>
<li><strong>äº§ç©æ åå</strong>ï¼æå»ºåçäº§ç©å­æ¾å¨<code>themes/*/dist/</code>å<code>packages/*/dist/</code>ç®å½ä¸­ï¼ç»ææ ååï¼ä¾¿äºé¨ç½²åä½¿ç¨ã</li>
</ol>
<h2 id="4-tona-æ ¸å¿åè§£æä»è®¾è®¡å°å®ç°">4. Tona æ ¸å¿åè§£æï¼ä»è®¾è®¡å°å®ç°</h2>
<p>Tona çæ ¸å¿è½åä½ç°å¨<code>packages/</code>ç®å½ç 12 ä¸ªæ ¸å¿åä¸­ï¼è¿äºåéç¨<strong>åå±æ¶æ</strong>è®¾è®¡ï¼ç¸äºè§£è¦åç¸äºåä½ï¼ææäº Tona çå®æ´è½åä½ç³»ãæ¬èå°éç¹è§£æ Tona ä¸­ææ ¸å¿çå ä¸ªåï¼åæ¬å¶è®¾è®¡æè·¯ãå³é®å®ç°ãç¤ºä¾ä»£ç ã</p>
<h3 id="41-tona-viteæ¬å°å¼åçæ ¸å¿å¼æè®©-ai-è¯»æåå®¢å­æ¨¡æ¿">4.1 tona-viteï¼æ¬å°å¼åçæ ¸å¿å¼æï¼è®© AI è¯»æåå®¢å­æ¨¡æ¿</h3>
<p><code>tona-vite</code>æ¯ Tona ç<strong>æ ¸å¿å¼æ</strong>ï¼ä¹æ¯ AI æ¥å¥åå®¢å­ç®è¤å¼åç<strong>å³é®å</strong>ãå¶æ ¸å¿åè½æ¯<strong>å°åå®¢å­çåç HTML æ¨¡æ¿æ³¨å¥ Vite Dev Server ä¸­</strong>ï¼è®©å¼åèå¯ä»¥å¨æ¬å°è±ç¦»åå®¢å­ç¯å¢è¿è¡ç®è¤å¼åï¼è®© AI å¯ä»¥ç´æ¥è¯»åè¿äºæ¨¡æ¿ï¼çè§£åå®¢å­ç DOM ç»æã</p>
<p><strong>ï¼1ï¼tona-vite çå·¥ä½åç</strong></p>
<p><code>tona-vite</code>ä½ä¸ºä¸æ¬¾ Vite æä»¶ï¼å¶å·¥ä½åçä¸»è¦åä¸º<strong>æ¨¡æ¿æ³¨å¥</strong>ã<strong>Dev Server å¯å¨</strong>ã<strong>ç­æ´æ°æ¯æ</strong>ä¸ä¸ªæ­¥éª¤ï¼å¯éè¿ä»¥ä¸ Mermaid å¾å±ç¤ºï¼</p>
<div class="mermaid">graph TD
    A[tona-vite æä»¶åå§å] --&gt; A1[è¯»åæ¬å°æ¨¡æ¿ï¼packages/tona-vite/public/templates/]
    A1 --&gt; A2[æ¨¡æ¿é¢å¤çï¼è§£æ DOM ç»æãæ³¨å¥å¨å±åé]
    B[Vite Dev Server å¯å¨] --&gt; B1[æä»¶æ³¨åï¼å°æ¨¡æ¿æ³¨å¥ Vite ç Dev Server]
    B1 --&gt; B2[è·¯ç±æ å°ï¼å°æ¨¡æ¿æ å°å° Vite çè·¯ç±ï¼/templates/*ï¼]
    C[æ¬å°å¼åé¶æ®µ] --&gt; C1[ç®è¤ä»£ç å¼åï¼React/CSS/JS]
    C1 --&gt; C2[ç­æ´æ°ï¼Vite HMR è§¦åç®è¤ä»£ç éæ°æ¸²æ]
    C2 --&gt; C3[æ¨¡æ¿æ¸²æï¼Vite Dev Server æ¸²ææ³¨å¥çåå®¢å­æ¨¡æ¿+ç®è¤ä»£ç ]
    C3 --&gt; C4[æµè§å¨è®¿é®ï¼æ¬å°æ¥çåå®¢å­ç®è¤ææ]
</div><p><strong>æ ¸å¿å³é®ç¹</strong>ï¼</p>
<ol>
<li><strong>æ¨¡æ¿æ¬å°å</strong>ï¼<code>tona-vite</code>å°åå®¢å­çææåç HTML æ¨¡æ¿ï¼é¦é¡µãæç« é¡µãç¸åé¡µãåç±»é¡µç­ï¼ä¸è½½å¹¶ä¿å­å°æ¬å°<code>packages/tona-vite/public/templates/</code>ç®å½ä¸­ï¼å°½å¯è½ä¿è¯äºä¸åå®¢å­çº¿ä¸ç¯å¢çä¸è´æ§ï¼</li>
<li><strong>è·¯ç±æ å°</strong>ï¼<code>tona-vite</code>å°æ¬å°æ¨¡æ¿æ å°å° Vite Dev Server ç<code>/templates/*</code>è·¯ç±ä¸­ï¼å¼åèå¯ä»¥éè¿<code>http://localhost:5173/templates/home.html</code>è®¿é®åå®¢å­é¦é¡µæ¨¡æ¿ï¼éè¿<code>http://localhost:5173/templates/post-markdown.html</code>è®¿é®æç« é¡µæ¨¡æ¿ï¼</li>
<li><strong>ä»£ç æ³¨å¥</strong>ï¼å¼åèç¼åçç®è¤ä»£ç ï¼React ç»ä»¶ãCSS æ ·å¼ãJS èæ¬ï¼ä¼è¢« Vite Dev Server æ³¨å¥å°æ¨¡æ¿ä¸­ï¼å®ç°ç®è¤ææçå®æ¶æ¸²æï¼</li>
<li><strong>ç­æ´æ°æ¯æ</strong>ï¼åºäº Vite ç HMR è½åï¼å¼åèä¿®æ¹ç®è¤ä»£ç åï¼é¡µé¢ä¼å®æ¶æ´æ°ï¼æ éå·æ°ï¼å¤§å¹æé«å¼åæçã</li>
</ol>
<p><strong>ï¼2ï¼tona-vite çå³é®å®ç°</strong></p>
<p>æä»¶ä½¿ç¨ Vite ç configResolved å configureServer é©å­ï¼æ³¨å¥åå®¢å­æ¨¡æ¿å° public ç®å½ã</p>
<pre><code class="language-typescript">// packages/tona-vite/index.ts ï¼ç®åçï¼
import { Plugin } from 'vite'
import fs from 'fs-extra'
import path from 'path'

export function tonaVite(): Plugin {
  return {
    name: 'tona-vite',
    configResolved(config) {
      // æ³¨å¥æ¨¡æ¿
      const templatesDir = path.resolve(__dirname, 'public/templates')
      fs.copySync(templatesDir, config.root + '/public/templates')
    },
    configureServer(server) {
      server.middlewares.use((req, res, next) =&gt; {
        if (req.url.startsWith('/templates/')) {
          // æ¨¡æ CNBlogs æ¨¡æ¿ååº
          res.end(fs.readFileSync(path.resolve(config.root, req.url)))
        } else {
          next()
        }
      })
    },
  }
}
</code></pre>
<p><strong>ï¼3ï¼AI æ¥å¥çæ ¸å¿ä¼å¿</strong></p>
<p><code>tona-vite</code>ä¸º AI å¼åæä¾äºä¸¤ä¸ªæ ¸å¿ä¼å¿ï¼</p>
<ol>
<li><strong>æ¨¡æ¿å¯è®¿é®æ§</strong>ï¼åå®¢å­çåç HTML æ¨¡æ¿è¢«ä¿å­å°æ¬å°ï¼AI å¯ä»¥ç´æ¥è¯»åè¿äºæ¨¡æ¿æä»¶ï¼çè§£åå®¢å­ç DOM ç»æãHTML å¸å±ï¼ä»èçæç¬¦åæ¨¡æ¿ç»æçç®è¤ä»£ç ï¼</li>
<li><strong>å¼åç¯å¢æ åå</strong>ï¼AI å¯ä»¥éè¿æ§è¡<code>pnpm dev</code>å½ä»¤å¯å¨ Vite Dev Serverï¼åä¸æ¬å°å¼åï¼åæ¶å¯ä»¥éè¿ Vite ç API è·åç®è¤ä»£ç çå®æ¶ç¶æï¼å®ç° AI ä¸äººç±»å¼åèçååå¼åã</li>
</ol>
<div class="mermaid">sequenceDiagram
    participant User/AI
    participant ViteServer
    participant TonaVitePlugin
    participant CNBlogsTemplate

    User/AI-&gt;&gt;ViteServer: pnpm dev
    ViteServer-&gt;&gt;TonaVitePlugin: configResolved
    TonaVitePlugin-&gt;&gt;CNBlogsTemplate: å¤å¶æ¨¡æ¿å° public/
    User/AI-&gt;&gt;ViteServer: ä¿®æ¹ä»£ç 
    ViteServer-&gt;&gt;TonaVitePlugin: HMR æ´æ°
    TonaVitePlugin-&gt;&gt;User/AI: å·æ°é¡µé¢
</div><h3 id="42-tona-coreæ ¸å¿-api">4.2 tona-coreï¼æ ¸å¿ API</h3>
<p><code>tona-core</code>æ¯ Tona ç<strong>åºç¡å</strong>ï¼æä¾<code>createTheme</code>å<code>defineOptions</code>ä¸¤ä¸ªæ ¸å¿ APIï¼è´è´£<strong>ç®è¤å®ä¾çåå»ºãæä»¶çæ³¨åä¸æ§è¡ãéç½®çåå¹¶ä¸è¯»å</strong>ãææç®è¤é½éè¿<code>createTheme().use(plugin)</code>ä¸²èæä»¶ï¼æææä»¶éè¿<code>defineOptions</code>å£°æå¯éç½®é¡¹ï¼å®ç°ç»ä¸çæ¨¡åä¸çå½å¨æç®¡çã</p>
<p><strong>ï¼1ï¼createThemeï¼ç®è¤å®ä¾ä¸æä»¶ç³»ç»</strong></p>
<p><code>createTheme()</code>è¿åä¸ä¸ªç®è¤å®ä¾ï¼å®ä¾æä¾<code>use(plugin, ...options)</code>æ¹æ³ç¨äºæ³¨åæä»¶ï¼</p>
<pre><code class="language-typescript">// packages/core/src/createThemeApi.ts ï¼ç®åçï¼
export function createTheme() {
  const context = { theme: null, config: { globalProperties: {} } }
  const installedPlugins = new Set()

  const theme = {
    version: '3.0',
    _context: context,
    get config() {
      return context.config
    },

    use(plugin, ...options) {
      if (installedPlugins.has(plugin)) return theme
      if (typeof plugin?.install === 'function') {
        installedPlugins.add(plugin)
        plugin.install(theme, ...options)
      } else if (typeof plugin === 'function') {
        installedPlugins.add(plugin)
        plugin(theme, ...options)
      }
      return theme
    },
  }

  context.theme = theme
  init()
  return theme
}
</code></pre>
<p>æä»¶å¯ä»¥æ¯<strong>å½æ°</strong>æ<strong>å¸¦<code>install</code>æ¹æ³çå¯¹è±¡</strong>ï¼è°ç¨æ¶ä¼ å¥ç®è¤å®ä¾åå¯éåæ°ï¼<code>use</code>æ¯æé¾å¼è°ç¨ï¼è¿åç®è¤å®ä¾æ¬èº«ã<code>init()</code>å¨åå»ºæ¶æ§è¡ï¼è´è´£éèåå®¢å­å è½½å¨ç»ãå¼åæ¨¡å¼ä¸åå§å<code>window.opts</code>ç­ã</p>
<p><strong>ï¼2ï¼defineOptionsï¼éç½®åå¹¶ä¸ç¨æ·è¦ç</strong></p>
<p><code>defineOptions</code>ç¨äºå£°æ<strong>æä»¶çéç½®é¡¹</strong>ï¼å°é»è®¤å¼ãç¨æ·éç½®ï¼<code>window.opts</code>ï¼ãå¼åæ¶è¦çä¸èåå¹¶ï¼ä¾æä»¶åé¨ä½¿ç¨ï¼</p>
<pre><code class="language-typescript">// packages/core/src/defineOptionsApi.ts ï¼ç®åçï¼
export function defineOptions(userOptionName, defaultOptions) {
  return (devOptions) =&gt; {
    const userConfig = window.opts || {}
    const user =
      typeof userOptionName === 'string'
        ? userConfig[userOptionName]
        : getValue(userOptionName, userConfig) // æ°ç»æ¶æé¡ºåºå¹éç¬¬ä¸ä¸ªå­å¨çé®
    return Object.assign({}, defaultOptions, user, devOptions)
  }
}

// ä½¿ç¨ç¤ºä¾
const getBackgroundOptions = defineOptions('bodyBackground', {
  enable: false,
  value: '',
  opacity: 0.85,
  repeat: false,
})

const opts = getBackgroundOptions({ enable: true }) // å¼åæ¶è¦ç
// çº¿ä¸ï¼ä» window.opts.bodyBackground è¯»åç¨æ·éç½®ï¼ä¸é»è®¤å¼åå¹¶
</code></pre>
<p><code>userOptionName</code>æ¯æå­ç¬¦ä¸²ææ°ç»ï¼å¤å«åï¼ï¼æ°ç»æ¶æé¡ºåºæ¥æ¾ç¬¬ä¸ä¸ªå­å¨äºç¨æ·éç½®ä¸­çé®ãåå®¢å­ç¨æ·éè¿ãé¡µè HTML ä»£ç ãæ³¨å¥<code>window.opts = { bodyBackground: { enable: true, ... } }</code>ï¼ç®è¤å³å¯è¯»åå°åå¹¶åçéç½®ã</p>
<h3 id="43-tona-hooks-å¸¸ç¨-hooks">4.3 tona-hooks: å¸¸ç¨ Hooks</h3>
<p><code>tona-hooks</code>æ¯ Tona ä¸º <strong>React çæ</strong>æé çèªå®ä¹ Hook åï¼å¶æ ¸å¿åè½æ¯<strong>å°è£åå®¢å­ç®è¤å¼åä¸­å¸¸ç¨ç DOM æä½ãç¶æç®¡çãä¸å¡é»è¾</strong>ï¼è®©å¼åèå¯ä»¥åä½¿ç¨ React Hook ä¸æ ·ï¼å¿«éå®ç°åå®¢å­ç®è¤çå¼åï¼åæ¶å¤§å¹åå°éå¤ä»£ç ãå¶è®¾è®¡éµå¾ª <strong>âé¢ååå®¢å­ä¸å¡åºæ¯â</strong> çååï¼ææ Hook é½éå¯¹åå®¢å­ç®è¤å¼åçå®ééæ±è¿è¡å°è£ã</p>
<p>å¶ä¸­ï¼<code>useQueryDOM</code>æ¯<code>tona-hooks</code>ä¸­çæ ¸å¿ Hookã<code>useQueryDOM</code>çæ ¸å¿åè½æ¯<strong>å°è£åå®¢å­ç DOM æ¥è¯¢æä½ï¼æ¯æ DOM èç¹çèªå¨æ´æ°åéæ¸²æ</strong>ï¼è§£å³äºåå®¢å­ DOM ç»æå¨æååå¯¼è´çæ¥è¯¢å¤±è´¥é®é¢ã</p>
<p><strong>useQueryDOM Hook çå®ç°</strong></p>
<pre><code class="language-typescript">// packages/tona-hooks/src/useQueryDOM.ts
import { useState, useEffect, useCallback } from 'React/hooks'

/**
 * åå®¢å­ DOM æ¥è¯¢ Hook
 * @param selector DOM éæ©å¨
 * @param options éç½®é¡¹ï¼æ¯å¦çå¬ DOM ååãæ¯å¦ç«å³æ¥è¯¢
 * @returns DOM èç¹ãéæ°æ¥è¯¢æ¹æ³
 */
export function useQueryDOM&lt;T extends HTMLElement&gt;(
  selector: string,
  options: { observe: boolean; immediate: boolean } = {
    observe: true,
    immediate: true,
  },
) {
  const [node, setNode] = useState&lt;T | null&gt;(null)

  // DOM æ¥è¯¢æ¹æ³
  const queryNode = useCallback(() =&gt; {
    const el = document.querySelector&lt;T&gt;(selector)
    setNode(el)
    return el
  }, [selector])

  // åå§åæ¥è¯¢
  useEffect(() =&gt; {
    if (options.immediate) {
      queryNode()
    }
  }, [options.immediate, queryNode])

  // çå¬ DOM åå
  useEffect(() =&gt; {
    if (!options.observe) return

    // åå»º MutationObserverï¼çå¬ DOM æ åå
    const observer = new MutationObserver((mutations) =&gt; {
      // å½ DOM æ åçååæ¶ï¼éæ°æ¥è¯¢
      queryNode()
    })

    // çå¬æ´ä¸ªææ¡£ç DOM åå
    observer.observe(document.documentElement, {
      childList: true,
      subtree: true,
      attributes: false,
      characterData: false,
    })

    // éæ¯æ¶åæ¶çå¬
    return () =&gt; {
      observer.disconnect()
    }
  }, [options.observe, queryNode])

  return [node, queryNode] as const
}
</code></pre>
<p><strong>useQueryDOM Hook çä½¿ç¨</strong></p>
<pre><code class="language-typescript">import { useQueryDOM } from 'tona-hooks';

export function PostTitle() {
  // æ¥è¯¢åå®¢å­æç« æ é¢èç¹
  const { data, isPending } = useQueryDOM({
    selector: '#cb_post_title_url',
    observe: true,
    queryFn: (el) =&gt; {
      return el?.querySelector('[role="heading"]')?.innerHTML ?? ''
    },
  });

  if (isPending) {
    return &lt;h1 className="text-2xl font-bold"&gt;å è½½ä¸­...&lt;/h1&gt;;
  }

  return (
    &lt;h1 className="text-3xl font-bold text-blue-600 hover:text-blue-800 transition-colors"&gt;
      {titleNode.innerText}
    &lt;/h1&gt;
  );
}
</code></pre>
<blockquote>
<p>ä½ å¯ä»¥è¯è¯éè¿æ­¤ Hook å®ç°çæç« åºé¨æ¨èæé®ãè¯è®ºåè¡¨ä»¥åä¸ªäººä¸»é¡µçå³æ³¨æé®åè½ã</p>
</blockquote>
<h3 id="44-tona-tailwind-stylelint-æä»¶">4.4 tona tailwind stylelint æä»¶</h3>
<p>å¦æå¨åå®¢å­ç®è¤å¼åä¸­ä½¿ç¨ tailwindï¼éè¦èèçé®é¢æ¯ class name è¢«æåè³ js æä»¶ä¸­ï¼js æä»¶ä½æ£å¿«éå¢é¿çé®é¢ãæä»¬å¯ä»¥å¨ CSS æä»¶åä½¿ç¨ tailwindã</p>
<p>stylelint-one-utility-class-per-line æä»¶å¼ºå¶ @apply æä»¤ä¸è¡ä¸ä¸ªç±»åï¼æ¯æèªå¨ä¿®å¤ãè§£å³å¤ç±»åä¸è¡å¯¼è´çå¯è¯»æ§å·®é®é¢ã</p>
<pre><code class="language-css">.card {
  @apply flex flex-col items-center justify-center p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300;
}
</code></pre>
<p>lint å</p>
<pre><code class="language-css">.card {
  @apply flex 
    flex-col 
    items-center 
    justify-center 
    p-6 
    bg-white 
    dark:bg-gray-800 
    rounded-lg 
    shadow-md 
    hover:shadow-lg 
    transition-shadow 
    duration-300;
}
</code></pre>
<h3 id="45-create-tonacli-å¿«éåå§åä¸é®æ­å»ºç®è¤å¼åèææ¶">4.5 create-tonaï¼CLI å¿«éåå§åï¼ä¸é®æ­å»ºç®è¤å¼åèææ¶</h3>
<p><img src="https://img2024.cnblogs.com/blog/1501373/202602/1501373-20260213102615101-1943776826.png" alt="image" width="1268" height="804" loading="lazy"></p>
<p><code>create-tona</code>æ¯ Tona ç <strong>CLI å¿«éåå§åå·¥å·</strong>ï¼å¶æ ¸å¿åè½æ¯<strong>éè¿ä¸è¡å½ä»¤åå»º Tona ç®è¤é¡¹ç®èææ¶</strong>ï¼è®©å¼åèæ éæå¨éç½® Viteãtona-vite æä»¶ãä¾èµå®è£ç­ï¼å³å¯å¨æ°ç§åè·å¾ä¸ä¸ªå¯è¿è¡çåå®¢å­ç®è¤å¼åç¯å¢ãå¶è®¾è®¡éµå¾ª<strong>âå¼ç®±å³ç¨ãæ¨¡æ¿å¯éãæµç¨æ ååâ</strong>çååï¼æ¯ Tona å¼åæµç¨ç**å¥å£åã</p>
<p><strong>ï¼1ï¼create-tona çå·¥ä½åç</strong></p>
<p><code>create-tona</code>ä½ä¸ºä¸æ¬¾ Node.js CLI å·¥å·ï¼å¶å·¥ä½åçä¸»è¦åä¸º<strong>äº¤äºå¼å¼å¯¼</strong>ã<strong>æ¨¡æ¿éæ©ä¸å¤å¶</strong>ã<strong>ä¾èµå®è£ä¸å¯å¨</strong>ä¸ä¸ªæ­¥éª¤ï¼å¯éè¿ä»¥ä¸ Mermaid å¾å±ç¤ºï¼</p>
<div class="mermaid">graph TD
    A[æ§è¡ pnpm create tona] --&gt; A1[è§£æå½ä»¤è¡åæ°ï¼-t --template, -i --immediate]
    A1 --&gt; A2[æ£æµè¿è¡ç¯å¢ï¼TTY äº¤äºæ¨¡å¼ / é TTY éé»æ¨¡å¼]
    B[äº¤äºå¼å¼å¯¼] --&gt; B1[é¡¹ç®åç§° &amp; ç®æ ç®å½]
    B1 --&gt; B2[ç®å½å²çªå¤çï¼è¦ç / å¿½ç¥ / åæ¶]
    B2 --&gt; B3[ååæ ¡éªï¼npm è§è]
    B3 --&gt; B4[æ¨¡æ¿éæ©ï¼TypeScript / JavaScript]
    B4 --&gt; B5[æ¯å¦ç«å³å®è£ä¾èµå¹¶å¯å¨ dev]
    C[é¡¹ç®æ­å»º] --&gt; C1[å¤å¶ template-ts æ template-js å°ç®æ ç®å½]
    C1 --&gt; C2[æ´æ° package.json ç name å­æ®µ]
    C2 --&gt; C3[å¯éï¼pnpm install + pnpm dev]
    C3 --&gt; C4[å®æï¼è¾åºåç»­å½ä»¤æç¤º]
</div><p><strong>æ ¸å¿å³é®ç¹</strong>ï¼</p>
<ol>
<li><strong>åæ¨¡æ¿æ¯æ</strong>ï¼<code>create-tona</code>æä¾<code>template-ts</code>ï¼TypeScriptï¼å<code>template-js</code>ï¼JavaScriptï¼ä¸¤ç§æ¨¡æ¿ï¼æ¨¡æ¿å·²é¢éç½®<code>tona-vite</code>æä»¶ã<code>tona</code>ä¾èµãVite æå»ºèæ¬ï¼å¼åèå¯æ ¹æ®ææ¯æ åå¥½éæ©ï¼</li>
<li><strong>åç®¡çå¨èªå¨è¯å«</strong>ï¼éè¿<code>npm_config_user_agent</code>ç¯å¢åéè¯å«è°ç¨æ¹ï¼pnpmãnpmãyarnãbunãdenoï¼ï¼èªå¨éç¨å¯¹åºå½ä»¤è¿è¡ä¾èµå®è£åèæ¬æ§è¡ï¼</li>
<li><strong>ç®å½å²çªå¤ç</strong>ï¼å½ç®æ ç®å½éç©ºæ¶ï¼æä¾âåæ¶ / æ¸ç©ºåç»§ç»­ / å¿½ç¥å¹¶ç»§ç»­âä¸ç§éé¡¹ï¼é¿åæå¤è¦çï¼</li>
<li><strong>å³æ¶å¯å¨</strong>ï¼æ¯æ<code>-i</code>æ<code>--immediate</code>åæ°ï¼å¨é¡¹ç®åå»ºå®æåèªå¨æ§è¡<code>pnpm install</code>å<code>pnpm dev</code>ï¼å®ç°âåå»ºå³å¼åâã</li>
</ol>
<p><strong>ï¼2ï¼create-tona çå³é®å®ç°</strong></p>
<p>CLI ä½¿ç¨<code>@clack/prompts</code>å®ç°äº¤äºå¼æé®ï¼ä½¿ç¨<code>mri</code>è§£æå½ä»¤è¡åæ°ï¼éè¿ Node.js ç<code>fs</code>æ¨¡åå¤å¶æ¨¡æ¿æä»¶ã</p>
<pre><code class="language-typescript">// packages/create-tona/src/index.ts ï¼ç®åçï¼
import fs from 'node:fs'
import path from 'node:path'
import { fileURLToPath } from 'node:url'
import * as prompts from '@clack/prompts'
import spawn from 'cross-spawn'
import mri from 'mri'

const argv = mri(process.argv.slice(2), {
  boolean: ['help', 'overwrite', 'immediate', 'interactive'],
  alias: { h: 'help', t: 'template', i: 'immediate' },
  string: ['template'],
})

async function init() {
  // 1. è·åç®æ ç®å½ï¼äº¤äºæåæ°ï¼
  const targetDir = argv._[0]
    ? formatTargetDir(String(argv._[0]))
    : await prompts.text({
        message: 'Project name:',
        defaultValue: 'tona-theme',
      })

  // 2. ç®å½å²çªå¤ç
  if (fs.existsSync(targetDir) &amp;&amp; !isEmpty(targetDir)) {
    const overwrite = await prompts.select({
      message: '...',
      options: ['no', 'yes', 'ignore'],
    })
    if (overwrite === 'yes') emptyDir(targetDir)
  }

  // 3. éæ©æ¨¡æ¿ï¼ts / js
  const template =
    argv.template ??
    (await prompts.select({
      message: 'Select a template:',
      options: [
        { label: 'TypeScript', value: 'ts' },
        { label: 'JavaScript', value: 'js' },
      ],
    }))

  // 4. å¤å¶ template-ts æ template-js å°ç®æ ç®å½
  const __dirname = path.dirname(fileURLToPath(import.meta.url))
  const templateDir = path.resolve(__dirname, '..', `template-${template}`)
  copyDir(templateDir, targetDir)

  // 5. æ´æ° package.json ç name
  const pkg = JSON.parse(
    fs.readFileSync(path.join(targetDir, 'package.json'), 'utf-8'),
  )
  pkg.name = path.basename(path.resolve(targetDir))
  fs.writeFileSync(
    path.join(targetDir, 'package.json'),
    JSON.stringify(pkg, null, 2),
  )

  // 6. å¯éï¼ç«å³å®è£å¹¶å¯å¨
  if (argv.immediate) {
    spawn.sync(pkgManager, ['install'], { cwd: targetDir })
    spawn.sync(pkgManager, ['dev'], { cwd: targetDir })
  }
}
</code></pre>
<p><strong>æ¨¡æ¿ç»æ</strong>ï¼æ¯ä¸ªæ¨¡æ¿åå«<code>package.json</code>ã<code>vite.config.mts</code>ã<code>src/main.ts</code>ã<code>src/style.css</code>ç­ï¼å¶ä¸­<code>vite.config.mts</code>å·²éç½®<code>tona-vite</code>æä»¶å<code>@</code>è·¯å¾å«åï¼<code>main.ts</code>ä¸ºæä»¶å¼å¥å£ç¤ºä¾ï¼<code>createTheme().use(myPlugin)</code>ï¼ã</p>
<h2 id="5-ç¤ºä¾ç®è¤å®ç°æè§£">5. ç¤ºä¾ç®è¤å®ç°æè§£</h2>
<p><code>tona-theme-shadcn</code>æ¯ Tona åç½®ç<strong>ç»ä»¶åæ¨¡å¼</strong>ç¤ºä¾ç®è¤ï¼è¿æå¼åå¹¶åå¸ãéç¨ Preact + Tailwind CSS V4 + shadcn/ui é£æ ¼è®¾è®¡ï¼æ¯ Tona ç®è¤å¼åçå®è·µåèãæ¬èä»é¡¹ç®ç»æãå¥å£ä¸æä»¶é¾ãé¡µé¢è·¯ç±ãæ°æ®è·åãæ ·å¼ä½ç³»ãæå»ºè¾åºå­ä¸ªç»´åº¦æè§£å¶å®ç°ï¼æä»¬ä¸èµ·ççå¦ä½åºäº Tona å¼åé«è´¨éåå®¢å­ç®è¤ã</p>
<h3 id="51-é¡¹ç®ç»æä¸ææ¯æ ">5.1 é¡¹ç®ç»æä¸ææ¯æ </h3>
<p><code>tona-theme-shadcn</code>éç¨<strong>ç»ä»¶å + æä»¶å</strong>çæ··åæ¶æï¼æ ¸å¿ UI ä»¥ Preact ç»ä»¶å®ç°ï¼å¢å¼ºåè½ä»¥æä»¶å½¢å¼æè½½ãç®å½ç»æå¦ä¸ï¼</p>
<pre><code class="language-md">themes/shadcn/
âââ src/
â âââ main.ts # å¥å£ï¼æä»¶é¾æ³¨å
â âââ styles/ # å¨å±æ ·å¼
â â âââ globals.css # Tailwind + shadcn + markdown + theme
â â âââ shadcn/ # shadcn ç®è¤åéãç»ä»¶æ ·å¼
â â âââ markdown.css # æç«  Markdown æ ·å¼
â â âââ theme.css # ç®è¤ç®è¤åé
â âââ lib/utils.ts # cn() å·¥å·å½æ°
â âââ components/ui/ # éç¨ UI ç»ä»¶ï¼ButtonãSeparatorãSonner ç­ï¼
â âââ plugins/
â âââ app/ # ä¸»åºç¨æä»¶ï¼Preact æ¸²ææ´é¡µ
â â âââ app.tsx # App æ ¹ç»ä»¶
â â âââ components/ # é¡µé¢çº§ç»ä»¶
â â â âââ page/ # è·¯ç±åå
â â â âââ home-page/ # é¦é¡µ
â â â âââ post-page/ # æç« é¡µ
â â â âââ top-nav-bar/ # é¡¶é¨å¯¼èª
â â â âââ post-comments/ # è¯è®º
â â â âââ ...
â â âââ hooks/ # ä¸å¡ hooks
â âââ code-copy-button/ # ä»£ç åå¤å¶ï¼åç DOM æä»¶ï¼
â âââ smooth-scroll/ # å¹³æ»æ»å¨ï¼åç DOM æä»¶ï¼
âââ vite.config.mts
âââ package.json
</code></pre>
<p><strong>ææ¯æ </strong>ï¼PreactãTailwind CSS V4ãclass-variance-authorityï¼cvaï¼ãclsx + tailwind-mergeï¼cnï¼ãlucide-preactï¼å¾æ ï¼ãmotionï¼å¨ç»ï¼ãtona-hooksï¼useQueryDOMï¼ãtona-utilsãtona-sonnerï¼Toastï¼ã</p>
<p>éè¿ç®å½ç»æå¯ä»¥çå°ï¼ç± preact å®ç°çé¨åï¼ç®è¤ä¸»ä½ï¼å ä¹æ¯ä¸ä¸ª SPAï¼åªæ¯ Tona çä¸ä¸ªæä»¶ãä½ å¯ä»¥ä½¿ç¨ä»»ä½åç«¯æ¡æ¶å¼ååå®¢å­ç®è¤ï¼ä½éè¦æè¡¡ä½ç§¯ãæ¯å¦ AI åå¥½ãçæç­å ç´ ãæè®¤ä¸º preact æ¯ä¸ä¸ªä¸éçéæ©ï¼æä»¥æéç¨ preact å®ç°äº tona-theme-shadcn ç®è¤ã</p>
<h3 id="52-å¥å£ä¸æä»¶é¾">5.2 å¥å£ä¸æä»¶é¾</h3>
<p>ç®è¤å¥å£éè¿<code>createTheme().use()</code>ä¸²èå¤ä¸ªæä»¶ï¼å®ç°<strong>æ¸è¿å¼å¢å¼º</strong>ï¼</p>
<pre><code class="language-typescript">// themes/shadcn/src/main.ts
import { createTheme } from 'tona'
import './styles/globals.css'
import { app } from './plugins/app'
import { codeCopyButton } from './plugins/code-copy-button'
import { smoothScroll } from './plugins/smooth-scroll'

createTheme().use(app).use(smoothScroll).use(codeCopyButton)
</code></pre>
<ul>
<li><strong>app</strong>ï¼Preact æ¸²ææ ¸å¿ï¼å°æ´é¡µ UI ä»¥<code>document.body.prepend(frag)</code>æ³¨å¥ï¼è¦çåå®¢å­åçå¸å±ï¼</li>
<li><strong>smoothScroll</strong>ï¼è®¾ç½®<code>scrollBehavior</code>ï¼</li>
<li><strong>codeCopyButton</strong>ï¼ä¸ºä»£ç åæ·»å å¤å¶æé®ï¼çº¯ DOM æä½ã</li>
</ul>
<p><code>app</code>æä»¶çå®ç°æ¹å¼ä½ç°äº<strong>ç»ä»¶å</strong>ä¸<strong>æ¨¡æ¿æ³¨å¥</strong>çç»åï¼å° Preact åºç¨æè½½å°<code>DocumentFragment</code>ï¼åæå¥å°<code>body</code>é¡¶é¨ï¼ä»èå¨åå®¢å­æ¨¡æ¿ä¹ä¸å å ç°ä»£å UIã</p>
<h3 id="53-é¡µé¢è·¯ç±ä¸ç»ä»¶å¤ç¨">5.3 é¡µé¢è·¯ç±ä¸ç»ä»¶å¤ç¨</h3>
<p>åå®¢å­ä¸åé¡µé¢ï¼é¦é¡µãæç« é¡µãåç±»é¡µç­ï¼å¯¹åºä¸åç DOM ç»æï¼shadcn éè¿<code>tona-utils</code>ç<code>getCurrentPage()</code>è¯å«å½åé¡µé¢ç±»åï¼åå¨<code>Page</code>ç»ä»¶ä¸­åè·¯ç±ååï¼</p>
<pre><code class="language-typescript">// themes/shadcn/src/plugins/app/components/page/index.tsx
import { getCurrentPage } from 'tona-utils'
import { HomePage } from '../home-page'
import { PostPage } from '../post-page'

export function Page() {
  const currentPage = getCurrentPage()

  if (currentPage === 'home') return &lt;HomePage /&gt;
  if (currentPage === 'post') return &lt;PostPage /&gt;
  return null
}
</code></pre>
<p>å¦æä½ çç®è¤æ¯è¾å¤æï¼çè³å¯ä»¥åä»£ç æåï¼å¨ä¸ååå®¢é¡µé¢æéå è½½èµæºã</p>
<h3 id="54-æ°æ®è·åä¸-dom-ééusequerydom-å®æ">5.4 æ°æ®è·åä¸ DOM ééï¼useQueryDOM å®æ</h3>
<p>åå®¢å­é¡µé¢ DOM ç±æå¡ç«¯æ¸²æï¼ç»æåºå®ä½åå®¹å¨æãshadcn ç®è¤ä½¿ç¨<code>tona-hooks</code>ç<code>useQueryDOM</code>ï¼ä» DOM ä¸­æåæ°æ®å¹¶é©±å¨ Preact ç»ä»¶æ¸²æã</p>
<p><strong>ç¤ºä¾ä¸ï¼æç« åè¡¨</strong>ãé¦é¡µç<code>.forFlow</code>ååå«ææ¥æåç»çæç« åè¡¨ï¼<code>usePostList</code>éè¿<code>queryFn</code>è§£æåºæ¯ç¯æç« çæ é¢ãé¾æ¥ãæ¶é´ãæµè§/è¯è®º/æ¨èæ°ç­ï¼</p>
<pre><code class="language-typescript">// themes/shadcn/src/plugins/app/components/home-page/post-list/hooks.ts
export function usePostList() {
  return useQueryDOM({
    selector: '.forFlow',
    observe: true,
    queryFn: (el) =&gt; {
      const items: PostItem[] = []
      const dayElements = el?.querySelectorAll('.day') ?? []
      dayElements.forEach((dayEl) =&gt; {
        // è§£æ .dayTitleã.postTitleã.postConã.postDesc ç­
        // æå titleãhrefãdateãviewCountãcommentCountãdiggCount...
        items.push({ date, title, href, description, ... })
      })
      return items
    },
  })
}
</code></pre>
<p><strong>ç¤ºä¾äºï¼æç« æ é¢ä¸åä¿¡æ¯</strong>ãæç« é¡µéè¿<code>#cb_post_title_url</code>ã<code>#cnblogs_post_body</code>ç­éæ©å¨è·åæ é¢ HTMLãåå¸æ¥æãéè¯»æ¶é´ç­ï¼</p>
<pre><code class="language-typescript">// themes/shadcn/src/plugins/app/components/post-hero/hooks.ts
export function usePostTitle() {
  return useQueryDOM({
    selector: '#cb_post_title_url',
    queryFn: (el) =&gt; el?.querySelector('[role="heading"]')?.innerHTML ?? '',
  })
}

export function usePostInfo() {
  return useQueryDOM({
    selector: '#cnblogs_post_body',
    observe: true,
    queryFn: (el) =&gt; ({
      publishTime: getCurrentPostDateAdded(),
      readingTime: calculateReadingTime(el?.textContent ?? ''),
      updateTime: null,
    }),
  })
}
</code></pre>
<p><code>observe: true</code>æ¶ï¼<code>useQueryDOM</code>åé¨ä½¿ç¨<code>MutationObserver</code>çå¬ DOM ååï¼å¨åå®¢å­ AJAX æ´æ°åå®¹åèªå¨éæ°æ¥è¯¢ï¼ä¿è¯æ°æ®ä¸è§å¾åæ­¥ã</p>
<p><strong>ç¤ºä¾ä¸ï¼æç« åå®¹âæ¬è¿â</strong>ã<code>PostDetails</code>ç»ä»¶ä¸éæ°æ¸²æåå®¢å­æç«  bodyï¼èæ¯éè¿<code>appendChild</code>å°<code>#cnblogs_post_body</code>è¿ç§»å° Preact æ¸²æçå®¹å¨åï¼å¨ä¿çåå®¢å­åç Markdown æ¸²æææçåæ¶ï¼å®ç°ä¸ç®è¤å¸å±çæ ç¼èåã</p>
<h3 id="55-æ ·å¼ä½ç³»tailwind--shadcn--ç®è¤åé">5.5 æ ·å¼ä½ç³»ï¼Tailwind + shadcn + ç®è¤åé</h3>
<p>shadcn çæ ·å¼éç¨<strong>åå±å¯¼å¥</strong>ï¼</p>
<pre><code class="language-css">/* themes/shadcn/src/styles/globals.css */
@import 'tailwindcss' source('../../src');
@import 'tw-animate-css';
@import './shadcn/index.css';
@import './markdown.css';
@import './theme.css';
@import './reset.css';
</code></pre>
<ul>
<li><strong>Tailwind</strong>ï¼å·¥å·ç±»ä¸»ä½ï¼<code>source()</code> æå <code>src</code> ä»¥æ¯æ <code>@theme</code> ç­éç½®ï¼</li>
<li><strong>tw-animate-css</strong>ï¼é¢è®¾å¨ç»ï¼</li>
<li><strong>shadcn</strong>ï¼CSS åéï¼<code>--background</code>ã<code>--foreground</code>ã<code>--primary</code> ç­ï¼ãç»ä»¶æ ·å¼ï¼</li>
<li><strong>markdown</strong>ï¼æç« åå®¹ Markdown æ¸²ææ ·å¼ï¼</li>
<li><strong>theme</strong>ï¼ç®è¤çº§ç®è¤åéï¼</li>
<li><strong>reset</strong>ï¼åºç¡éç½®ã</li>
</ul>
<p>ç»ä»¶ä½¿ç¨<code>cva</code>ç®¡çæ ·å¼åä½ï¼<code>cn()</code>åå¹¶ç±»åï¼</p>
<pre><code class="language-typescript">// themes/shadcn/src/components/ui/button.tsx
const buttonVariants = cva(
  "inline-flex items-center justify-center rounded-md font-medium ...",
  {
    variants: {
      variant: { default: '...', outline: '...', ghost: '...' },
      size: { default: '...', sm: '...', icon: '...' },
    },
    defaultVariants: { variant: 'default', size: 'default' },
  },
)

function Button({ variant, size, className, ...props }) {
  return &lt;slot className={cn(buttonVariants({ variant, size }), className)} {...props} /&gt;
}
</code></pre>
<p>æè²æ¨¡å¼éè¿<code>dark:</code>åç¼å CSS åéåæ¢å®ç°ï¼æ»¡è¶³ AGENTS.md ä¸­çç®è¤è§èã</p>
<h3 id="56-æå»ºä¸è¾åº">5.6 æå»ºä¸è¾åº</h3>
<p>Vite éç½®å°ç®è¤æåä¸º<strong>åæä»¶ IIFE</strong>ï¼ä¾¿äºåå®¢å­ãé¡µè HTML ä»£ç ããèªå®ä¹ JS èæ¬ãç­å¥å£å¼å¥ï¼</p>
<pre><code class="language-typescript">// themes/shadcn/vite.config.mtsï¼èéï¼
build: {
  lib: {
    formats: ['iife'],
    entry: resolve(__dirname, 'src/main.ts'),
    name: 'shadcn',
    fileName: () =&gt; 'shadcn.js',
  },
  cssCodeSplit: false,
  rollupOptions: {
    output: { assetFileNames: 'shadcn.[ext]' },
  },
}
</code></pre>
<p>æå»ºäº§ç©ä¸º<code>dist/shadcn.js</code>å<code>dist/shadcn.css</code>ï¼ç¨æ·å°ä¸¤èå¼å¥åå®¢å­åå°å³å¯ä½¿ç¨ã</p>
<hr>
<p>éè¿æ¬èæè§£ï¼å¯ä»¥çå° tona-theme-shadcn å¦ä½å°<strong>Tona æ ¸å¿å</strong>ï¼tona-viteãtona-hooksãtona-utilsï¼ã<strong>Preact ç»ä»¶å</strong>ã<strong>Tailwind æ ·å¼ä½ç³»</strong>ä¸<strong>åå®¢å­ DOM ç»æ</strong>ææºç»åï¼å½¢æä¸å¥å¯ç»´æ¤ãå¯æ©å±çç®è¤å®ç°èå¼ï¼ä¸º AI æä¾äºæ¸æ°çåèæ¨¡æ¿ã</p>
<p>é¡ºä¾¿ä¸æï¼è¯è®ºåè¡¨ä½ä¸ºè¿ä¸ªç®è¤çæå¤æçåè½ä¹ä¸ï¼æ ·å¼ååè½é½å®å¨ç± AI å®ç°ã</p>
<h2 id="6-æå">6. æå</h2>
<p>æ¬¢è¿ä½¿ç¨ç®è¤ï¼ä¹æ¬¢è¿å°è¯ä½¿ç¨ Tona äº²ææå»ºä¸æ¬¾ç®è¤ãä¸å¦¨ç¨<code>pnpm create tona</code>å¿«éåå§åä¸ä¸ªç®è¤é¡¹ç®ï¼æåæ¬å°ç­æ´æ°ãTypeScript ä¸ Tailwind å¸¦æ¥çå¼åæçï¼è®© AI åå¼åæ®éåç«¯é¡µé¢é£æ ·å¼ååå®¢å­ç®è¤ãä¹å¯ä»¥å° Tona ä»åºä¸­çæ¨¡æ¿ãæ ¸å¿åä¸ç¤ºä¾ç®è¤ä½ä¸ºä¸ä¸æï¼çæé«è´¨éçç®è¤ä»£ç ã</p>
<p>Tona æ¯å¼æºé¡¹ç®ï¼æç®¡äº <a href="https://github.com/guangzan/tona" target="_blank" rel="noopener nofollow">GitHub</a>ãæ¬¢è¿ ðãæäº¤ Issueãåä¸è®¨è®ºæè´¡ç®ä»£ç ï¼ä¸èµ·æ¨å¨åå®¢å­ç®è¤å¼åçç°ä»£åä¸ AI åã</p>
<h2 id="7-åèèµæ">7. åèèµæ</h2>
<ul>
<li><a href="https://github.com/guangzan/tona" target="_blank" rel="noopener nofollow">gitHub/tona</a></li>
<li><a href="https://www.yuque.com/r/awescnb/books" target="_blank" rel="noopener nofollow">ä½¿ç¨ç®è¤</a></li>
<li><a href="https://www.cnblogs.com/guangzan/p/19585389" target="_blank">shadcn ç®è¤ä¸çº¿</a></li>
</ul>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.003472222222222222" data-date-updated="2026-02-13 11:01">2026-02-13 10:56</span>&nbsp;
<a href="https://www.cnblogs.com/guangzan">guangzan</a>&nbsp;
éè¯»(<span id="post_view_count">85</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19609096);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19609096', targetLink: 'https://www.cnblogs.com/guangzan/p/19609096', title: 'AI &amp;#215; åå®¢å­ç®è¤' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>