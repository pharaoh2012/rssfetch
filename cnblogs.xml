<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-15T08:25:59.490Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ AI â JSON â UI ]]></title>
    <link>https://www.cnblogs.com/guangzan/p/19487446</link>
    <guid>50da358b9ff00137851738ca86276a9d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/guangzan/p/19487446" title="åå¸äº 2026-01-15 15:23">
    <span role="heading" aria-level="2">AI â JSON â UI</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="èæ¯">èæ¯</h2>
<p>è¿å»ä¸¤å¹´ï¼AI çæ UI çå®è·µåºæ¬éä¸­å¨ä¸¤ç§è·¯å¾ä¸ãç¬¬ä¸ç§æ¯ç´æ¥è®©æ¨¡åçæ JSXãHTML æ CSSãè¿æ¡è·¯çº¿çä¼å¿å¨äºèªç±åº¦æé«ï¼æ¨¡åå ä¹ä¸åçº¦æï¼çèµ·æ¥âä»ä¹é½è½åâãä½å¨çå®å·¥ç¨ç¯å¢ä¸­ï¼è¿ç§æ¹å¼å ä¹ä¸å¯æ§ï¼è¾åºç»æä¸ç¨³å®ï¼æ æ³ä¿è¯ç»ä»¶è¾¹çï¼é¾ä»¥åæéä¸å®¡è®¡æ§å¶ï¼çæçä»£ç ç»å¸¸æ æ³ç¼è¯æè¿èå·¥ç¨çº¦å®ï¼æ´éè¦çæ¯ï¼å®ä¸å®éä¸å¡ä¸­çç»ä»¶ä½ç³»åè®¾è®¡ç³»ç»ä¸¥éè±èã</p>
<p>å¦ä¸æ¡è·¯çº¿æ¯ä½ä»£ç æ schema é©±å¨ UIï¼ä¾å¦åºäº JSON Schema æè¡¨å schema çæ¹æ¡ãè¿ç±»æ¹æ¡å¨å·¥ç¨ä¸æ¯å¯æ§çï¼ç»æç¨³å®ãå¯æ ¡éªãå¯å¤ç¨ï¼ä½å®ä»¬æ¬è´¨ä¸æ¯ä¸ºâäººç¼åéç½®âè®¾è®¡çï¼èä¸æ¯ä¸ºâæ¨¡åçæç»æâè®¾è®¡çãschema è¡¨è¾¾è½åæéï¼æ©å±ææ¬é«ï¼å¹¶ä¸ä¸èªç¶è¯­è¨ä¹é´çæ å°å¹¶ä¸èªç¶ï¼Prompt å¾å¾éè¦å¤§éäººå·¥çº¦æã</p>
<p>Vercel ååå¼æºäº json-renderï¼json-render çåºç°ï¼æ¬è´¨ä¸æ¯å¯¹è¿ä¸¤æ¡è·¯çº¿çéæ°ååä¸ç»åãå®å¹¶æ²¡æè¯å¾è®© AI ååç«¯ä»£ç ï¼ä¹æ²¡ææ AI éå¶å¨ä¼ ç»ä½ä»£ç  schema ä¸­ï¼èæ¯å¼å¥äºä¸ä¸ªä¸­é´å±ï¼<strong>JSON UI AST</strong>ãAI åªè½çæè¿ç§ ASTï¼è AST çè½åè¾¹çå®å¨ç±å¼åèå®ä¹ãæ¸²æãç¶æãè¡ä¸ºè§£éå¨é¨çå¨ä¸å¡ä¾§å®æãå¼åèå æ­¤å¯ä»¥å®å¨å°è®©ç¨æ·éè¿èªç¶è¯­è¨çæä»ªè¡¨çãå°é¨ä»¶ææ°æ®è§å¾ï¼èä¸éè¦ææ§è¡æäº¤ç»æ¨¡åã</p>
<p><img src="https://img2024.cnblogs.com/blog/1501373/202601/1501373-20260115152759556-1171653435.gif" alt="iShot_2026-01-15_15.25.26" loading="lazy"></p>
<h2 id="æ´ä½æ¶æjson-render-æ¯ä¸ä¸ª-dsl-è§£éç³»ç»">æ´ä½æ¶æï¼json-render æ¯ä¸ä¸ª DSL è§£éç³»ç»</h2>
<p>ä»æ¶æè§è§çï¼json-render å¹¶ä¸æ¯ä¸ä¸ª UI æ¡æ¶ï¼èæ¯ä¸ä¸ª DSL æ§è¡ç³»ç»ãç³»ç»ç±ä¸å±ææï¼æåºå±æ¯ Catalogï¼ç¨æ¥å£°æâç³»ç»åè®¸ AI ä½¿ç¨åªäº UI è½åâï¼ä¸­é´å±æ¯ JSON UI Treeï¼è¿æ¯ AI çå¯ä¸è¾åºå½¢å¼ï¼æä¸å±æ¯ Rendererï¼ç±ä¸å¡ä¾§å®ç°ï¼ç¨äºè§£é JSON å¹¶æ¸²æçå® UIã</p>
<p>å®ä»¬ä¹é´çå³ç³»å¯ä»¥ç¨ä¸é¢è¿å¼ ç»æå¾æ¥çè§£ï¼</p>
<pre><code>ââââââââââââââ
â   Prompt   â
âââââââ¬âââââââ
      â
      â¼
ââââââââââââââââââââ
â  LLM / AI Model  â
âââââââ¬âââââââââââââ
      â  JSON UI ASTï¼å Catalog ä¸¥æ ¼çº¦æï¼
      â¼
ââââââââââââââââââââ
â     Catalog      â  â è½åç½åå / Schema / Grammar
âââââââ¬âââââââââââââ
      â æ ¡éª + è§£æ
      â¼
ââââââââââââââââââââ
â    Renderer      â  â React / Vue / Native
âââââââ¬âââââââââââââ
      â
      â¼
ââââââââââââââââââââ
â   Real UI View   â
ââââââââââââââââââââ
</code></pre>
<p>å¨è¿ä¸ªæ¨¡åä¸­ï¼AI åªåä¸âç»æçæâï¼ä¸åä¸âæ§è¡âãè¿ä¹æ¯ json-render å¨å·¥ç¨ä¸æç«çæ ¹æ¬åå ã</p>
<h2 id="ä»-catalog-å°-ui">ä» Catalog å° UI</h2>
<h3 id="1-catalogç³»ç»çè½åè¾¹çå®ä¹">1. Catalogï¼ç³»ç»çè½åè¾¹çå®ä¹</h3>
<p>ä¸é¢è¿æ®µä»£ç æ¯æ´ä¸ªç³»ç»ä¸­æéè¦çå¥å£ï¼å®å®ä¹äº AI è½ä½¿ç¨çå¨é¨ UI è½åã</p>
<pre><code class="language-ts">import { createCatalog } from '@json-render/core'
import { z } from 'zod'

export const catalog = createCatalog({
  components: {
    Card: {
      props: z.object({
        title: z.string()
      }),
      hasChildren: true
    },
    Metric: {
      props: z.object({
        label: z.string(),
        valuePath: z.string(),
        format: z.enum(['number', 'currency', 'percent']).optional()
      })
    }
  },
  actions: {
    refresh: {
      params: z.object({})
    }
  }
})
</code></pre>
<p>è¿éæ²¡æä»»ä½ UI ä»£ç ï¼åªæè½åå£°æãprops ä½¿ç¨ Zod å®ä¹ï¼è¿æå³çå®ä¸ä»æ¯ç±»åæç¤ºï¼è¿åå«è¿è¡æ¶æ ¡éªè§åãå¦æä½ å¯¹ Zod æ²¡æäºè§£ï¼å¯ä»¥ççè¿ç¯åæï¼<a href="https://www.cnblogs.com/guangzan/p/19350726" target="_blank">Zodï¼TypeScript ç±»åå®å«ä¸æ°æ®éªè¯</a>ãaction å¹¶ä¸æ¯å½æ°å®ç°ï¼èæ¯ä¸ä¸ªâæå¾å£°æâï¼å®åªæè¿°âå¯ä»¥åçä»ä¹âï¼ä¸æè¿°âæä¹åçâã</p>
<p>Catalog å¨ç³»ç»ä¸­çå°ä½ï¼ç¸å½äºä¸é¨è¯­è¨çè¯­æ³å®ä¹æä»¶ãAI åç»­çæçææ JSONï¼æ¬è´¨ä¸é½å¿é¡»ç¬¦åè¿å¥ grammarã</p>
<h3 id="2-ai-è¾åºç-json-ui-ast">2. AI è¾åºç JSON UI AST</h3>
<p>å½ç¨æ·è¾å¥ç±»ä¼¼âçæä¸ä¸ªæ¶å¥ä»ªè¡¨çâçæç¤ºæ¶ï¼æ¨¡åçæçç»æä¸æ¯ JSXï¼èæ¯ä¸é¢è¿æ ·ç JSONï¼</p>
<pre><code class="language-json">{
  "type": "Card",
  "props": { "title": "Revenue Overview" },
  "children": [
    {
      "type": "Metric",
      "props": {
        "label": "Total Revenue",
        "valuePath": "/metrics/revenue",
        "format": "currency"
      }
    }
  ]
}
</code></pre>
<p>è¿ä¸ª JSON æå ä¸ªéå¸¸å³é®çç¹å¾ãå®ä¸åå«ä»»ä½å½æ°ãä¸åå«æ¡ä»¶è¡¨è¾¾å¼ãä¸åå«æ ·å¼æç¶æé»è¾ãå®åªæ¯ç»æåå°æè¿°âä½¿ç¨åªä¸ªç»ä»¶ï¼ç¨ä»ä¹åæ°ï¼ç»ä»¶ä¹é´å¦ä½åµå¥âãææè½åå®å¨æ¥æºäº Catalogï¼å æ­¤è¿ä¸ª JSON æ¯å¯æ ¡éªãå¯å­å¨ãå¯ diffãå¯å®¡è®¡ãå¯åæ¾çã</p>
<h3 id="3-rendererjson-çè§£éæ§è¡">3. Rendererï¼JSON çè§£éæ§è¡</h3>
<p>å¨ React ä¾§ï¼Renderer æ®æ¼çæ¯è§£éå¨çè§è²ã</p>
<pre><code class="language-tsx">import { Renderer } from '@json-render/react'
import { catalog } from './catalog'

function App() {
  return (
    &lt;Renderer
      catalog={catalog}
      components={{
        Card: ({ title, children }) =&gt; (
          &lt;div className="card"&gt;
            &lt;h2&gt;{title}&lt;/h2&gt;
            {children}
          &lt;/div&gt;
        ),
        Metric: ({ label, value }) =&gt; (
          &lt;div&gt;
            {label}: {value}
          &lt;/div&gt;
        )
      }}
      data={{
        metrics: { revenue: 120000 }
      }}
    /&gt;
  )
}
</code></pre>
<p>Renderer å¹¶ä¸å³å¿ UI é¿ä»ä¹æ ·ï¼å®åªåä¸ä»¶äºï¼æ ¹æ® type æ¾å°å¯¹åºç»ä»¶å®ä¹ï¼æ ¹æ® Catalog æ ¡éª props å childrenï¼æ ¹æ® valuePath ç­è§åå®ææ°æ®æ³¨å¥ã</p>
<h2 id="ä¸ºä»ä¹-json-render-æ¯å¯æ§ç">ä¸ºä»ä¹ json-render æ¯âå¯æ§çâ</h2>
<p>ä¸é¢çåå© AI è½ååæåºäº <code>vercel-labs/json-render</code> ä¸»ä»åºãå¦æä½ å¯¹æ­¤ä¸æå´è¶£ï¼è·³è¿è¿é¨ååå®¹ã</p>
<h3 id="1-createcatalogè½åè¢«å»ç»çèµ·ç¹">1. createCatalogï¼è½åè¢«å»ç»çèµ·ç¹</h3>
<p>æä»¶è·¯å¾ä½äº <code>packages/core/src/create-catalog.ts</code>ãè¿ä¸ªå½æ°çæ ¸å¿ä½ç¨ä¸æ¯âæ³¨åç»ä»¶âï¼èæ¯âå»ç»è½åè¾¹çâã</p>
<p>ç®ååçæ ¸å¿é»è¾å¯ä»¥çè§£ä¸ºï¼</p>
<pre><code class="language-ts">export function createCatalog(definition) {
  return {
    components: definition.components,
    actions: definition.actions,
    validateNode(node) {
      // æ ¡éª type æ¯å¦å­å¨
      // æ ¡éª props æ¯å¦ç¬¦å Zod schema
      // æ ¡éª children æ¯å¦è¢«åè®¸
    }
  }
}
</code></pre>
<p>æ¯ä¸è¡ä»£ç é½å¨æå¡ä¸ä¸ªç®æ ï¼è®© Catalog æä¸ºä¸ä¸ªä¸å¯çªç ´çç½ååãRenderer å AI é½æ æ³ç»è¿å®ãè¿ä¹æ¯ä¸ºä»ä¹ json-render æ Catalog æ¾å¨ core åä¸­ï¼èä¸æ¯ React åä¸­ã</p>
<h3 id="2-schema-æ ¡éªai-è¾åºå¿é¡»åç¼è¯åæ§è¡">2. Schema æ ¡éªï¼AI è¾åºå¿é¡»âåç¼è¯åæ§è¡â</h3>
<p>å¨ JSON Tree è¿å¥ Renderer ä¹åï¼ç³»ç»ä¼éèç¹æ ¡éªãtype æ¯å¦å¨ Catalog ä¸­å£°æï¼props æ¯å¦éè¿ Zod æ ¡éªï¼children æ¯å¦ç¬¦å hasChildren çº¦æï¼action æ¯å¦å­å¨äºç½ååãè¿ä¸è¿ç¨æ¬è´¨ä¸å°±æ¯ä¸æ¬¡ AST æ ¡éªã</p>
<p>è¿æå³ç AI çè¾åºä¸æ¯âè¿è¡æ¶æ¥éâï¼èæ¯âä¸éè¿å³æç»æ§è¡âãå¨ AI UI ç³»ç»ä¸­ï¼è¿æ¯ä¸ä¸ªæå¶å³é®ä½ç»å¸¸è¢«å¿½è§çå·¥ç¨ç¹ã</p>
<h3 id="3-rendererçæ­£çè§£éå¨æ¨¡å">3. Rendererï¼çæ­£çè§£éå¨æ¨¡å</h3>
<p>React Renderer çåé¨é»è¾å¹¶ä¸æ¯ç®åç switch-caseï¼èæ¯ä¸ä¸ªéå½è§£éè¿ç¨ãå®æ ¹æ®èç¹ç type æ¥ Catalogï¼æé  propsï¼è§£æ valuePath æ³¨å¥æ°æ®ï¼ç»å® action handlerï¼ç¶åéå½æ¸²æ childrenã</p>
<p>ä»æ¶æè§åº¦çï¼å®æ´æ¥è¿ä¸ä¸ª JSON AST Interpreterï¼èä¸æ¯æ¨¡æ¿å¼æãè¿ä¹æ¯ json-render å¯ä»¥è·¨ ReactãVueãNative å¤ç¨æ ¸å¿ææ³çåå ã</p>
<h3 id="4-valuepathå»æé¿å-ai-åä¸ç¶æé»è¾">4. valuePathï¼å»æé¿å AI åä¸ç¶æé»è¾</h3>
<p>valuePath ä½¿ç¨å­ç¬¦ä¸²è·¯å¾æè¿°æ°æ®ä¾èµï¼ä¾å¦ï¼</p>
<pre><code class="language-json">"valuePath": "/metrics/revenue"
</code></pre>
<p>è¿æ ·è®¾è®¡çç´æ¥ç»ææ¯ï¼AI ä¸éè¦çè§£ç¶æç»æï¼ä¹ä¸éè¦åä»»ä½ç¶æé»è¾ãRenderer ç»ä¸è´è´£è§£æè·¯å¾ãè¯»åæ°æ®ãè§¦åæ´æ°ãè¿å¨æ¶æä¸å»æåæ­äºâAI ç´æ¥æä½ç¶æâçå¯è½æ§ã</p>
<p>ä¸é¢æ¯ä»åå«æ°å¢åå®¹çè¡¥åç« èï¼éç¹æ¾å¨å¯è½å°æºç å±é¢çæºå¶ï¼é¿åæ¦å¿µåæè¿°ãç¤ºä¾ä»£ç ä¸è§£éååºäº <code>vercel-labs/json-render</code> å½åä»åºç»æä¸å®ç°æè·¯ã</p>
<h2 id="prompt-ä¸-catalog-çèªå¨å¯¹é½">Prompt ä¸ Catalog çèªå¨å¯¹é½</h2>
<p>Prompt ä¸ Catalog çèªå¨å¯¹é½ï¼ä¸æ¯âè° Promptâï¼èæ¯âå¯¼åº Grammarâãjson-render ä¸­ï¼Prompt ä¸ Catalog çå¯¹é½å¹¶ä¸æ¯éè¿äººè Prompt Engineering å®æçï¼èæ¯éè¿ä» Catalog æ´¾çä¸ä»½æºå¨å¯çè§£çè½åæè¿°ï¼å¹¶å°å¶æ³¨å¥å°æ¨¡åä¸ä¸æä¸­ãè¿ä¸ç¹å¨ <code>packages/core</code> ä¸­çè®¾è®¡éå¸¸å³é®ã</p>
<p>å¨ core å±ï¼Catalog æ¬èº«å¹¶ä¸æ¯ä¸ä¸ªç®åçå¯¹è±¡ï¼å®åå«äºå®æ´çç»ä»¶å®ä¹ãprops schema ä»¥å action æè¿°ãè¿äºä¿¡æ¯ä¼è¢«è½¬æ¢ä¸ºä¸ç§âæè¿°æ§ç»æâï¼ç¨äºåè¯æ¨¡åå½åç³»ç»æ¯æç UI grammarã</p>
<p>ç±»ä¼¼è¿æ ·çé»è¾ï¼</p>
<pre><code class="language-ts">export function catalogToPrompt(catalog) {
  return `
You can generate a JSON UI tree.
Available components:
${Object.entries(catalog.components).map(([name, def]) =&gt; `
- ${name}
  props: ${describeSchema(def.props)}
  hasChildren: ${def.hasChildren}
`).join('\n')}

Available actions:
${Object.keys(catalog.actions).join(', ')}

Rules:
- Output must be valid JSON
- Only use listed components
- Follow prop schemas strictly
`
}
</code></pre>
<p>è¿éçå³é®ç¹ä¸å¨äºå­ç¬¦ä¸²æ¬èº«ï¼èå¨äºä¿¡æ¯æ¥æºå®å¨æ¥èª Catalogãæ¢å¥è¯è¯´ï¼Catalog æ¯ single source of truthï¼Prompt åªæ¯å®çä¸ç§åºååè§å¾ãå½å¼åèæ°å¢æä¿®æ¹ç»ä»¶å®ä¹æ¶ï¼Prompt ä¸­åè®¸æ¨¡åä½¿ç¨çè½åä¼èªå¨åçååï¼ä¸å­å¨âä»£ç å Prompt ä¸ä¸è´âçé®é¢ãè¿ä¹æ¯ json-render è½å¤é¿åå¤§éâPrompt èåâçæ ¹æ¬åå ã</p>
<p>ä»æ¨¡åè§è§çï¼å®é¢å¯¹çä¸æ¯ä¸æ®µæ¨¡ç³çèªç¶è¯­è¨è¯´æï¼èæ¯ä¸å¥æ¥è¿ BNF ç UI grammar æè¿°ãæ¨¡åçæ JSON UI Tree çè¿ç¨ï¼æ¬è´¨ä¸ç±»ä¼¼äºå¨ç»å®è¯­æ³çº¦æä¸çæ ASTãè¿ä¹æ¯ä¸ºä»ä¹ json-render è¦ä½¿ç¨ Zod èä¸æ¯ä»é  TypeScript ç±»åãZod schema å¯ä»¥è¢«åæ¶ç¨äºè¿è¡æ¶æ ¡éªå Prompt è¯­ä¹æè¿°ï¼å½¢æé­ç¯ã</p>
<h2 id="streaming-ui-çå®ç°ç»è">Streaming UI çå®ç°ç»è</h2>
<p>æµå¼æå»º ASTï¼èä¸æ¯æµå¼æ¼å­ç¬¦ä¸²ãjson-render ç Streaming UI è½åï¼æ ¸å¿å¹¶ä¸å¨âæ¨¡åæ¯ææµå¼è¾åºâï¼èå¨äº UI çä¸­é´è¡¨ç¤ºæ¯å¯å¢éåå¹¶ç JSON ASTãè¿ä¸ç¹å¨ React åä¸­çå®ç°éå¸¸æ¸æ°ã</p>
<p>å¨ <code>packages/react</code> ä¸­ï¼å¯ä»¥çå°ç±»ä¼¼ <code>useUIStream</code> ç hookï¼å¶æ ¸å¿èè´£æ¯ï¼<br>
ç»´æ¤ä¸æ£µå½å UI Treeï¼å¹¶å¨æ¨¡åæµå¼è¾åºæ¶ä¸æ­åè¿æ£µæ ä¸­åå¹¶æ°èç¹ã</p>
<p>ç®ååçåé¨ç»æå¤§è´å¦ä¸ï¼</p>
<pre><code class="language-ts">// packages/react/src/use-ui-stream.tsï¼æ¦å¿µç»æï¼
export function useUIStream() {
  const [tree, setTree] = useState&lt;UITree | null&gt;(null)

  function onChunk(chunk: string) {
    const partialNode = parseChunkToNode(chunk)
    if (!partialNode) return

    setTree(prevTree =&gt; {
      return mergeTree(prevTree, partialNode)
    })
  }

  return { tree, onChunk }
}
</code></pre>
<p>è¿éæä¸¤ä¸ªéå¸¸å³é®ä½å®¹æè¢«å¿½ç¥çç¹ã</p>
<p><code>parseChunkToNode</code> å¹¶ä¸æ¯ç®åç <code>JSON.parse</code>ãæ¨¡åå¨ streaming æ¨¡å¼ä¸è¾åºçéå¸¸æ¯ä¸å®æ´ JSONï¼å æ­¤ json-render éç¨çæ¯éæ®µè§£æãå»¶è¿æåçç­ç¥ãåªæå½ä¸ä¸ªèç¹å¨ç»æä¸æ¯å®æ´ä¸éè¿ Catalog æ ¡éªæ¶ï¼æä¼è¢«æåä¸ºâå¯åå¹¶èç¹âã<code>mergeTree</code> æ¯ä¸ä¸ªçº¯å½æ°ãå®ä¸ä¾èµå¤é¨ç¶æï¼åªæ ¹æ®å·²æ UI Tree åæ°èç¹çæä¸ä¸æ£µ Treeãè¿ä½¿å¾æ¯ä¸æ¬¡æ´æ°é½æ¯ç¡®å®æ§çï¼ä¹å¤©ç¶éå React çç¶ææ¨¡åã</p>
<p>å¨ Renderer å±ï¼è¿æ£µ Tree ä¼è¢«ç´æ¥ç¨äºéå½æ¸²æï¼</p>
<pre><code class="language-tsx">function RenderNode({ node }) {
  const Component = components[node.type]

  const resolvedProps = resolveProps(node.props)
  const children = node.children?.map(child =&gt;
    &lt;RenderNode key={child.id} node={child} /&gt;
  )

  return &lt;Component {...resolvedProps}&gt;{children}&lt;/Component&gt;
}
</code></pre>
<p>ç±äº Tree å§ç»æ¯âå·²æ ¡éªçåæ³ç»æâï¼Renderer ä¸éè¦å³å¿èç¹æ¯å¦å®æ´ï¼åªéè¦å³å¿âå½åæåªäºèç¹å·²ç»å­å¨âãè¿ä¹æ¯ Streaming UI è½å¨çææªå®ææ¶å°±å®å¨æ¸²æçæ ¹æ¬åå ã</p>
<h2 id="streaming-ä¸-catalog-æ ¡éªå¦ä½ååå·¥ä½">Streaming ä¸ Catalog æ ¡éªå¦ä½ååå·¥ä½</h2>
<p>Streaming UI å¹¶ä¸æ¯ç»è¿æ ¡éªæºå¶çæ·å¾ï¼æ°æ°ç¸åï¼å®ä¾èµæ ¡éªæºå¶æè½æç«ãå¨å®éæµç¨ä¸­ï¼æ¯ä¸ä¸ªåéèç¹å¨è¢«åå¹¶è¿ UI Tree ä¹åï¼é½ä¼ç»è¿ Catalog çæ ¡éªé»è¾ï¼</p>
<pre><code class="language-ts">// packages/core/src/validate-node.tsï¼æ¦å¿µç»æï¼
export function validateNode(node, catalog) {
  const def = catalog.components[node.type]
  if (!def) throw new Error('Unknown component')

  def.props.parse(node.props)

  if (node.children &amp;&amp; !def.hasChildren) {
    throw new Error('Children not allowed')
  }
}
</code></pre>
<p>Streaming æ¨¡å¼ä¸ï¼è¿ä¸ªæ ¡éªåçå¾æ´é¢ç¹ï¼ä½ç²åº¦æ´å°ãç³»ç»å®å¯âææ¶ä¸æ¸²æâï¼ä¹ä¸ä¼æä¸ä¸ªéæ³èç¹äº¤ç» Rendererãè¿ä¿è¯äº UI å¨ä»»ä½æ¶å»é½æ¯ä¸ä¸ªåæ³å­éï¼èä¸æ¯åæååå¾ç¶æã</p>
<p>Prompt ä¸ Catalog çèªå¨å¯¹é½ï¼ç¡®ä¿æ¨¡åâä¸ä¼å¹»æ³ä¸å­å¨çè½åâï¼Streaming UI ç AST çº§å¢éæå»ºï¼ç¡®ä¿ UIâå¯ä»¥å¨ä¸å®æ´æ¶ä»ç¶æ­£ç¡®è¿è¡âãä¸¤èç»åï¼ä½¿ json-render çæ§è¡æ¨¡åæ´æ¥è¿ç¼è¯å¨ä¸è§£éå¨ï¼èä¸æ¯æ¨¡æ¿çæå¨ãä»å·¥ç¨è§è§çï¼è¿æå³çä¸ä¸ªéè¦è½¬åï¼<strong>UI çæä¸åæ¯ä¸æ¬¡æ§ç»æï¼èæ¯ä¸ä¸ªå¯è§å¯ãå¯ä¸­æ­ãå¯åæ»çè¿ç¨ã</strong>è¿ä¹æ¯ json-render è½å¤çæ­£è¿å¥çäº§ç³»ç»ï¼èä¸ä»åçå¨ Demo å±é¢çæ ¹æ¬åå ã</p>
<h2 id="json-render-çæ­£è§£å³äºä»ä¹">json-render çæ­£è§£å³äºä»ä¹</h2>
<p>json-render æ¬èº«å¹¶ä¸æ¯ä¸ç§å¨æ°çææ¯èå¼ã<strong>âç¨åéç»ææè¿° UIï¼åç±è¿è¡æ¶è§£éæ§è¡âè¿ä¸ææ³ï¼å¨åç«¯å·¥ç¨ä¸­æ©å·²åå¤åºç°è¿ã</strong>æ©æç JSON Schema Formãreact-jsonschema-formãFormilyãæ¬è´¨ä¸é½æ¯ç¨ç»æåæ°æ®æè¿°çé¢ï¼åç±æ¸²æå¨çæçå® UIãä½ä»£ç å¹³å°ãæ­å»ºç³»ç»ãéç½®ååå°ï¼å ä¹å¨é¨å»ºç«å¨åä¸é»è¾ä¹ä¸ãå³ä¾¿å¨ AI åºç°ä¹åï¼è¿ç§æ¨¡å¼ä¹å·²ç»éå¸¸æçï¼å·¥ç¨å¸éè¿ schema æè¿°ç»ä»¶ãå±æ§åå¸å±ï¼è¿è¡æ¶è´è´£æ ¡éªä¸æ¸²æï¼ä¸å¡ä¾§åªæä½ç»æèä¸ç´æ¥è§¦ç¢°ä»£ç ãjson-render å¹¶æ²¡æåæè¿ç§æ¨¡å¼ï¼å®ç»§æ¿çæ­£æ¯è¿ä¸æ´æ¡ææ¯èç»ã</p>
<p>json-render çä¸åä¹å¤å¨äºï¼å®é¦æ¬¡æâæ¨¡åçæâä½ä¸ºä¸ç­å¬æ°çº³å¥è®¾è®¡åæãä¼ ç» schema UI åè®¾éç½®ç±äººç¼åï¼å æ­¤æ´å¼ºè°å®æ´æ§ãå¯è¯»æ§åç¼è¾ä½éªï¼è json-render åè®¾ç»æç±æ¨¡åçæï¼å æ­¤æ´å¼ºè°è¯­æ³è¾¹çæ¸æ°ãå¤±è´¥å¯æ¢å¤ãé¨åç»æå¯æ§è¡ï¼ä»¥åä¸ Prompt çèªå¨å¯¹é½è½åãä»è¿ä¸ªè§åº¦çï¼json-render æ´åæ¯âä¸º AI éæ°è®¾è®¡çä¸ä»£ schema UI æ§è¡æ¨¡åâãå®çæ­£è§£å³çé®é¢å¹¶ä¸æ¯âæä¹ç¨ JSON æ¸²æ UIâï¼èæ¯å½ç»ææ¥æºåæä¸å¯é çæ¨¡åæ¶ï¼å·¥ç¨è¾¹çåºè¯¥å¨åªéãå®ç»åºçç­æ¡éå¸¸æç¡®ï¼AI åªè´è´£çæç»æåæå¾ï¼å·¥ç¨å¸è´è´£è½åå®ä¹ãæ§è¡ä¸æ¸²æï¼JSON ä½ä¸ºå¯ä¸ä¸­ä»åçº¦æå±ãè¿ä½¿å¾ AI UI ä¸åæ¯ä¸æ¬¡æ§ Demoï¼èæ¯å¯ä»¥è¿å¥çäº§ç³»ç»çå·¥ç¨è½åãå¨å½åé¶æ®µï¼è¿æ¯å°æ°çæ­£ç«å¨å·¥ç¨ç«åºæè AI UI çæ¹æ¡ä¹ä¸ã</p>
<h2 id="åèèµæ">åèèµæ</h2>
<ul>
<li><a href="https://json-render.dev/" target="_blank" rel="noopener nofollow">json-render.dev</a></li>
<li><a href="https://github.com/vercel-labs/json-render" target="_blank" rel="noopener nofollow">github.com/vercel-labs/json-render</a></li>
<li><a href="https://vercel.com/blog" target="_blank" rel="noopener nofollow">vercel.com/blog</a></li>
<li><a href="https://www.cnblogs.com/guangzan/p/19350726" target="_blank">Zodï¼TypeScript ç±»åå®å«ä¸æ°æ®éªè¯</a></li>
</ul>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.004166666666666667" data-date-updated="2026-01-15 15:29">2026-01-15 15:23</span>&nbsp;
<a href="https://www.cnblogs.com/guangzan">guangzan</a>&nbsp;
éè¯»(<span id="post_view_count">111</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19487446);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19487446', targetLink: 'https://www.cnblogs.com/guangzan/p/19487446', title: 'AI â JSON â UI' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ SeaTunnel(2.3.12)çé«çº§ç¨æ³ï¼åï¼ï¼å¤ä¸ªsourceãå¤ä¸ªsink ]]></title>
    <link>https://www.cnblogs.com/kakarotto-chen/p/19487270</link>
    <guid>c3e89a01efea4f9af2521dc803308883</guid>
    <description>
    <![CDATA[ 
        <h2>
            <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/kakarotto-chen/p/19487270" title="åå¸äº 2026-01-15 15:08">
    <span role="heading" aria-level="2">SeaTunnel(2.3.12)çé«çº§ç¨æ³ï¼åï¼ï¼å¤ä¸ªsourceãå¤ä¸ªsink</span>
    

</a>

        </h2>
        <div class="postbody">
            <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="åç½®ç¥è¯seatunneléç½®ä¸­ææ°æ®æµdata-flowè½¬çæ¦å¿µ">åç½®ç¥è¯ï¼seatunneléç½®ä¸­ææ°æ®æµï¼Data Flowï¼è½¬çæ¦å¿µ</h2>
<p>è§ï¼<a href="https://www.cnblogs.com/kakarotto-chen/p/19487384" target="_blank">https://www.cnblogs.com/kakarotto-chen/p/19487384</a></p>
<h2 id="demo1ä¸¤ä¸ªsourceæ±èå°ä¸ä¸ªsink">demo1ï¼ä¸¤ä¸ªsourceæ±èå°ä¸ä¸ªsink</h2>
<ul>
<li>
<p><mark>å³é®éç½®ï¼sinkçï¼plugin_input = ["source_data1", "source_data2"]</mark></p>
</li>
<li>
<p>å¯¹åºæ¨¡å</p>
</li>
</ul>
<pre><code>ââââââââââââ
â Source A ââââ
ââââââââââââ  â
              ââââ¶  Sink
ââââââââââââ  â
â Source B ââââ
ââââââââââââ
</code></pre>
<ul>
<li>æ§è¡è¯­å¥</li>
</ul>
<pre><code># ds-st-demo10-2-mysql2pgsql.conf
sh /data/tools/seatunnel/seatunnel-2.3.12/bin/seatunnel.sh --config /data/tools/seatunnel/myconf/ds-st-demo10-2-mysql2pgsql.conf -i -DJvmOption="-Xms2G -Xmx2G" -m local
</code></pre>
<ul>
<li>å»ºè¡¨</li>
</ul>
<pre><code>-- ds-st-demo10-2-mysql2pgsql.conf
CREATE TABLE "public"."t_8_100w_imp_st_ds_demo10" (
  id BIGINT PRIMARY KEY,
  user_name VARCHAR(2000),
  sex VARCHAR(20),
  decimal_f NUMERIC(32, 6),
  phone_number VARCHAR(20),
  age INT,
  create_time TIMESTAMP,
  description TEXT,
  address VARCHAR(2000) DEFAULT 'æªç¥',
  my_status INT
);
COMMENT ON COLUMN "public"."t_8_100w_imp_st_ds_demo10"."id" IS 'ä¸»é®';
COMMENT ON COLUMN "public"."t_8_100w_imp_st_ds_demo10"."user_name" IS 'åå­';
COMMENT ON COLUMN "public"."t_8_100w_imp_st_ds_demo10"."sex" IS 'æ§å«ï¼ç·ï¼å¥³';
COMMENT ON COLUMN "public"."t_8_100w_imp_st_ds_demo10"."decimal_f" IS 'å¤§æ°å­';
COMMENT ON COLUMN "public"."t_8_100w_imp_st_ds_demo10"."phone_number" IS 'çµè¯';
COMMENT ON COLUMN "public"."t_8_100w_imp_st_ds_demo10"."age" IS 'å­ç¬¦ä¸²å¹´é¾è½¬æ°å­';
COMMENT ON COLUMN "public"."t_8_100w_imp_st_ds_demo10"."create_time" IS 'æ°å¢æ¶é´';
COMMENT ON COLUMN "public"."t_8_100w_imp_st_ds_demo10"."description" IS 'å¤§ææ¬';
COMMENT ON COLUMN "public"."t_8_100w_imp_st_ds_demo10"."address" IS 'ç©ºå°åè½¬é»è®¤å¼ï¼æªç¥';
COMMENT ON COLUMN "public"."t_8_100w_imp_st_ds_demo10"."my_status" IS 'ç¶æ';

</code></pre>
<ul>
<li>conféç½®</li>
</ul>
<pre><code>env {
  # ä»»å¡åå­ï¼ä¸å¡ä¸­å¯ä»¥å¼è¡¨id
  job.name = "ds-st-demo10.conf"
  # æå¤§æ¹çº¿ç¨æ°ï¼å¹¶è¡åº¦ï¼çº¿ç¨æ°ï¼
  parallelism = 5
  # ä»»å¡æ¨¡å¼ï¼BATCH:æ¹å¤çæ¨¡å¼ï¼STREAMING:æµå¤çæ¨¡å¼
  job.mode = "BATCH"
}

source {
  # ç¬¬ä¸ä¸ªæ°æ®é
  jdbc {
    # ç»è¿ä¸ªæ°æ®éèµ·ä¸ªåå­
    plugin_output = "source_data1"
  
    url = "jdbc:mysql://ip:port/cs1"
    driver = "com.mysql.cj.jdbc.Driver"
    user = "root"
    password = "***"
    # sql
    query = "select id,name as user_name,sex,decimal_f,phone_number,CAST(age AS SIGNED) as age,create_time,description,address from t_8_100w where id &lt; 10"
    
    # å¹¶è¡è¯»åéç½®
    # åççå­æ®µï¼æ¯æï¼StringãNumber(int, bigint, decimal, ...)ãDate
    partition_column = "id"
    # è¡¨çåå²å¤§å°ï¼è¡æ°ï¼ï¼æ¯ä¸ªåççæ°æ®è¡ï¼é»è®¤8096è¡ï¼ãæååçæ°=è¡¨çæ»è¡æ° / split.size
    split.size = 50000
    # åçæ°ï¼å¹éå¹¶è¡åº¦parallelismï¼2.3.12å·²ä¸æ¨èéç½®äºï¼ç¨split.sizeæ¥ä»£æ¿ï¼
    # partition_num = 5
    # æå¤§æ¹å¤çæ°:æ¥è¯¢çè¡æåå¤§å°(æå®å½åä»»å¡æ¯æ¬¡æ§è¡æ¶è¯»åæ°æ®æ¡æ°,è¯¥å¼(é»è®¤1000)åè¿è¡åå­å½±å,è¥è¯¥å¼è¾å¤§æåæ¡æ°æ®éè¾å¤§ï¼ééå½è°æ´è¿è¡åå­å¤§å°ã)
    fetch_size = 10000
    
    # è¿æ¥åæ°
    # è¿æ¥è¶æ¶æ¶é´300ms
    connection_check_timeout_sec = 300
    # å¶ä»jdbcçåæ°
    properties = {
      useUnicode = true
      characterEncoding = "utf8"
      # æ¶åºï¼ä¸åæ°æ®åºåæ°ä¸ä¸æ ·
      serverTimezone = "Asia/Shanghai"
      # ä½¿ç¨æ¸¸æ æé«å¤§ç»æéæ§è½
      useCursorFetch = "true"
      # æ¯æ¬¡è·åè¡æ°
      defaultFetchSize = "10000"
    }
  }
  
  # ç¬¬äºä¸ªæ°æ®é
  jdbc {
    # ç»è¿ä¸ªæ°æ®éèµ·ä¸ªåå­
    plugin_output = "source_data2"
  
    url = "jdbc:mysql://ip:port/cs1"
    driver = "com.mysql.cj.jdbc.Driver"
    user = "root"
    password = "***"
    # 
    query = "select id,name as user_name,sex,decimal_f,phone_number,CAST(age AS SIGNED) as age,create_time,description,address from t_8_100w where id &gt; 10 and id &lt; 20"
    
    # å¹¶è¡è¯»åéç½®
    # åççå­æ®µï¼æ¯æï¼StringãNumber(int, bigint, decimal, ...)ãDate
    partition_column = "id"
    # è¡¨çåå²å¤§å°ï¼è¡æ°ï¼ï¼æ¯ä¸ªåççæ°æ®è¡ï¼é»è®¤8096è¡ï¼ãæååçæ°=è¡¨çæ»è¡æ° / split.size
    split.size = 50000
    # åçæ°ï¼å¹éå¹¶è¡åº¦parallelismï¼2.3.12å·²ä¸æ¨èéç½®äºï¼ç¨split.sizeæ¥ä»£æ¿ï¼
    # partition_num = 5
    # æå¤§æ¹å¤çæ°:æ¥è¯¢çè¡æåå¤§å°(æå®å½åä»»å¡æ¯æ¬¡æ§è¡æ¶è¯»åæ°æ®æ¡æ°,è¯¥å¼(é»è®¤1000)åè¿è¡åå­å½±å,è¥è¯¥å¼è¾å¤§æåæ¡æ°æ®éè¾å¤§ï¼ééå½è°æ´è¿è¡åå­å¤§å°ã)
    fetch_size = 10000
    
    # è¿æ¥åæ°
    # è¿æ¥è¶æ¶æ¶é´300ms
    connection_check_timeout_sec = 300
    # å¶ä»jdbcçåæ°
    properties = {
      useUnicode = true
      characterEncoding = "utf8"
      # æ¶åºï¼ä¸åæ°æ®åºåæ°ä¸ä¸æ ·
      serverTimezone = "Asia/Shanghai"
      # ä½¿ç¨æ¸¸æ æé«å¤§ç»æéæ§è½
      useCursorFetch = "true"
      # æ¯æ¬¡è·åè¡æ°
      defaultFetchSize = "10000"
    }
  }
}

# æ¸æ´è½¬æ¢ï¼ç®åçæ¸æ´è½¬æ¢ï¼ç´æ¥å¨sourceçqueryçsqlä¸­å¤çäºå°±è¡ï¼
transform {
  # 1. å­æ®µæ å°ï¼sqlä¸­åäºï¼å®éçæä¸­ä¸å¨è¿éå¤çãç´æ¥å¨sourceçqueryçsqlä¸­å¤çäºå°±è¡
  # è¿å¯ä»¥ç¨ï¼FieldMapper æä»¶ï¼æ¥æ å°å­æ®µ
  
  # è½¬æ¢ageä¸ºæ°å­ç±»åï¼pgsqlå¿é¡»è½¬ï¼
  
  # 2. ææºå·è±æï¼13812341234 -&gt; 138****1234
  
  # 3. å¹´é¾è½¬æ¢ï¼å­ç¬¦ä¸²è½¬æ´æ°ï¼å®éçäº§ä¸­ï¼ä¸ç¨è½¬æ¢ï¼ä¹æ²¡æåç½®çè½¬æ¢æä»¶ï¼å¯ä»¥ç´æ¥ä¿å­æåï¼

  # 4. æ§å«è½¬æ¢ï¼1-&gt;ç·ï¼2-&gt;å¥³
  
  # 5. æ°æ®è¿æ»¤ï¼åªä¿ç age &gt; 25 çè®°å½ã
  
  # 6. å°åé»è®¤å¼ï¼ç©ºå°åè®¾ä¸º'æªç¥'
}

sink {
  jdbc {
    # æ¥æ¶çæç»æ°æ®éï¼æ±èå°ä¸ä¸ªç»æä¸­ï¼
    plugin_input = ["source_data1", "source_data2"]
    
    url = "jdbc:postgresql://ip:5432/source_db"
    driver = "org.postgresql.Driver"
    user = "postgres"
    password = "123456"
    # 
    # query = ""
    
    # èªå¨çæsqlçéç½®ï¼åqueryåæ°äºæ¥
    # çæèªå¨æå¥sqlãå¦æç®æ åºæ²¡æè¡¨ï¼ä¹ä¼èªå¨å»ºè¡¨
    generate_sink_sql = true
    # databaseå¿é¡»è¦ï¼å ä¸ºgenerate_sink_sql=trueã
    database = source_db
    # èªå¨çæsqlæ¶ï¼tableå¿é¡»è¦ã
    table = "public.t_8_100w_imp_st_ds_demo10"
    # çæç±»ä¼¼ï¼INSERT INTO â¦â¦ ON CONFLICT ("ä¸»é®") DO UPDATE SET â¦â¦ çsql
    # enable_upsert = true
    # å¤æ­å¼å¯ä¸çå¥ï¼æ­¤éé¡¹ç¨äºæ¯æå¨èªå¨çæ SQL æ¶è¿è¡ insertï¼delete å update æä½ã
    # primary_keys = ["id"]

    # è¡¨ç»æå¤çç­ç¥ï¼è¡¨ä¸å­å¨æ¶æ¥éï¼ä»»å¡å¤±è´¥ï¼ï¼ä¸è¬ç¨ï¼CREATE_SCHEMA_WHEN_NOT_EXISTï¼è¡¨ä¸å­å¨æ¶åå»ºè¡¨ï¼è¡¨å­å¨æ¶è·³è¿æä½ï¼ä¿çæ°æ®ï¼ï¼
    schema_save_mode = "ERROR_WHEN_SCHEMA_NOT_EXIST"
    # æå¥æ°æ®çå¤çç­ç¥
    # APPEND_DATAï¼ä¿çè¡¨ç»æåæ°æ®ï¼è¿½å æ°æ°æ®ï¼ä¸å é¤ç°ææ°æ®ï¼(ä¸è¬ç¨è¿ä¸ª)
    # DROP_DATAï¼ä¿çè¡¨ç»æï¼å é¤è¡¨ä¸­æææ°æ®ï¼æ¸ç©ºè¡¨ï¼ââå®ç°æ¸ç©ºéç
    # CUSTOM_PROCESSING :ç¨æ·å®ä¹å¤çãéè¦éåï¼custom_sqlä½¿ç¨
    data_save_mode = "DROP_DATA"
    # å½ data_save_mode éæ© CUSTOM_PROCESSING æ¶ï¼æ¨åºè¯¥å¡«å CUSTOM_SQL åæ°ãæ­¤åæ°éå¸¸å¡«å¥å¯æ§è¡ç SQLãSQL å°å¨åæ­¥ä»»å¡ä¹åæ§è¡ã
    #å¯ä»¥å®ç°ï¼åæ­¥å é¤ï¼æ§è¡åç½®updateãtruncateçsqlç­ï¼
    #è¿ä¸ªsqlæªæ§è¡ï¼ä¸ç¥éä¸ºå¥ã
    #è¿ä¸ªsqlå·²ç»æ§è¡ãåå ï¼å ä¸ºgenerate_sink_sql=trueçåå ãæä¼æ§è¡custom_sqlãï¼åªæèªå¨çæsqlçæ¶åï¼è¿ä¸ªæä¼æ§è¡ï¼
    custom_sql = """update "source_db"."public"."t_8_100w_imp_st_ds_demo10" set "my_status" = 23"""
    
    # æ¹éåå¥æ¡æ°
    batch_size = 10000
    # æ¹æ¬¡æäº¤é´é
    batch_interval_ms = 500
    # éè¯æ¬¡æ°
    max_retries = 3
    
    # è¿æ¥åæ°
    # è¿æ¥è¶æ¶æ¶é´300ms
    connection_check_timeout_sec = 300
    # å¶ä»jdbcçåæ°
    properties = {
      # PostgreSQLä¸ç¨åæ°
      # PostgreSQLçæ¹éä¼åï¼æ³¨æå¤§å°åï¼
      reWriteBatchedInserts = "true"  
      # å¦æéè¦æ¶åºè®¾ç½®
      options = "-c timezone=Asia/Shanghai"
    }
  }
}
</code></pre>
<ul>
<li>ç»æ(æ±èäº19æ¡æ°æ®)</li>
</ul>
<pre><code>2026-01-15 14:28:15,952 INFO  [s.c.s.s.c.ClientExecuteCommand] [main] - 
***********************************************
           Job Statistic Information
***********************************************
Start Time                : 2026-01-15 14:28:11
End Time                  : 2026-01-15 14:28:15
Total Time(s)             :                   4
Total Read Count          :                  19
Total Write Count         :                  19
Total Failed Count        :                   0
***********************************************
</code></pre>
<h2 id="demo2ä¸ä¸ªsourceååå°ä¸¤ä¸ªsink">demo2ï¼ä¸ä¸ªsourceååå°ä¸¤ä¸ªsink</h2>
<p>â¦â¦â¦â¦â¦â¦â¦â¦æªå®å¾ç»­</p>

</div>
<div class="clear"></div>

        </div>
        <p class="postfoot">
            posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-15 15:09">2026-01-15 15:08</span>&nbsp;
<a href="https://www.cnblogs.com/kakarotto-chen">C_C_èå­</a>&nbsp;
éè¯»(<span id="post_view_count">20</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19487270);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19487270', targetLink: 'https://www.cnblogs.com/kakarotto-chen/p/19487270', title: 'SeaTunnel(2.3.12)çé«çº§ç¨æ³ï¼åï¼ï¼å¤ä¸ªsourceãå¤ä¸ªsink' })">ä¸¾æ¥</a>

        </p>
     ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å¦ä½éè¿ C# å° PPT ææ¡£è½¬æ¢ä¸º PDF æ ¼å¼ ]]></title>
    <link>https://www.cnblogs.com/jazz-z/p/19486170</link>
    <guid>82d91dd3d6c8729df8b8f4cd2a51cdd7</guid>
    <description>
    <![CDATA[ 
            <div class="postcontent">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨æ¥å¸¸å¼åååå¬åºæ¯ä¸­ï¼å° PowerPointï¼PPT/PPTXï¼ è½¬æ¢ä¸º PDF æ ¼å¼æ¯é«é¢éæ±ãPDF æ ¼å¼å·æè·¨å¹³å°å¼å®¹æ§å¼ºãæ ¼å¼åºå®ä¸æç¯¡æ¹ãä¾¿äºååå½æ¡£ç­ä¼å¿ãæ¬æå°ä»ç»å¦ä½ä½¿ç¨ä¸æ¬¾ .NET PowerPoint ç»ä»¶éè¿ C# å®ç° PPT è½¬ PDFï¼å¹¶æä¾å®æ´ä»£ç ç¤ºä¾ã</p>
<h2 id="1-å®è£-net-åº">1. å®è£ .NET åº</h2>
<p>Spire.Presentation æ¯ä¸æ¬¾ä¸é¨ç¨äºå¤ç PowerPoint ææ¡£ç .NET ç»ä»¶ï¼æ éä¾èµ Microsoft Office æ PowerPoint å®¢æ·ç«¯å³å¯å®æ PPT ææ¡£çè¯»åãç¼è¾åæ ¼å¼è½¬æ¢ãæ¨èéè¿ NuGet åç®¡çå¨å®è£ï¼æ­¥éª¤å¦ä¸ï¼</p>
<ol>
<li>æå¼ Visual Studioï¼åå»ºä»»æ C# é¡¹ç®ï¼å¦Console Appï¼ï¼</li>
<li>å³é®é¡¹ç®ââç®¡çNuGetç¨åºåâï¼</li>
<li>æç´¢âSpire.Presentationâï¼éæ©å¯¹åºçæ¬å®è£ï¼</li>
<li>ä¹å¯éè¿NuGetå½ä»¤è¡å®è£ï¼</li>
</ol>
<pre><code class="language-bash">Install-Package Spire.Presentation
</code></pre>
<h2 id="2-åºç¡ç¤ºä¾åä¸ª-powerpoint-æä»¶è½¬-pdf">2. åºç¡ç¤ºä¾ï¼åä¸ª PowerPoint æä»¶è½¬ PDF</h2>
<p>è¿æ¯æå¸¸ç¨çåºæ¯ï¼æ¯æ PPT/PPTX æ ¼å¼è¾å¥ï¼ç´æ¥éè¿ <code>SaveToFile</code> æ¹æ³è¾åºä¸º PDF æä»¶ï¼</p>
<pre><code class="language-csharp">using System;
using Spire.Presentation;

namespace PptToPdfDemo
{
    class Program
    {
        static void Main(string[] args)
        {
            try
            {
                // 1. å®ä¹æä»¶è·¯å¾
                string pptFilePath = @"D:\Demo\source.pptx"; // è¾å¥PPTè·¯å¾
                string pdfFilePath = @"D:\Demo\output.pdf";   // è¾åºPDFè·¯å¾

                // 2. å è½½PPTææ¡£
                Presentation presentation = new Presentation();
                presentation.LoadFromFile(pptFilePath);

                // 3. è½¬æ¢ä¸ºPDFå¹¶ä¿å­
                // å¯éåæ°ï¼PDFå¯¼åºéé¡¹ï¼å¦åç¼©ãæéç­ï¼ï¼æ­¤å¤ä½¿ç¨é»è®¤éç½®
                presentation.SaveToFile(pdfFilePath, FileFormat.PDF);

                // 4. éæ¾èµæºï¼å³é®ï¼é¿ååå­æ³æ¼ï¼
                presentation.Dispose();

                Console.WriteLine("PPTè½¬PDFæåï¼");
            }
            catch (Exception ex)
            {
                // å¼å¸¸å¤çï¼æè·æä»¶ä¸å­å¨ãæ ¼å¼ä¸æ¯æãæéä¸è¶³ç­é®é¢
                Console.WriteLine($"è½¬æ¢å¤±è´¥ï¼{ex.Message}");
            }
        }
    }
}
</code></pre>
<h3 id="3-æ¹éè½¬æ¢è½¬æ¢å¤ä¸ª-powerpoint-æä»¶ä¸º-pdf">3. æ¹éè½¬æ¢ï¼è½¬æ¢å¤ä¸ª PowerPoint æä»¶ä¸º PDF</h3>
<p>éè¿éåæä»¶å¤¹å®ç°æ¹éè½¬æ¢ï¼éåå¤çå¤§é PPT æä»¶ï¼</p>
<pre><code class="language-csharp">using System;
using System.IO;
using Spire.Presentation;

namespace BatchPptToPdf
{
    class Program
    {
        static void Main(string[] args)
        {
            // æºPPTæä»¶å¤¹è·¯å¾
            string pptFolderPath = @"D:\Demo\PptFiles";
            // è¾åºPDFæä»¶å¤¹è·¯å¾
            string pdfFolderPath = @"D:\Demo\PdfFiles";

            // ç¡®ä¿è¾åºæä»¶å¤¹å­å¨
            if (!Directory.Exists(pdfFolderPath))
            {
                Directory.CreateDirectory(pdfFolderPath);
            }

            // éåæä»¶å¤¹ä¸­çPPT/PPTXæä»¶
            string[] pptFiles = Directory.GetFiles(pptFolderPath, "*", SearchOption.TopDirectoryOnly)
                .Where(file =&gt; file.EndsWith(".ppt", StringComparison.OrdinalIgnoreCase) 
                             || file.EndsWith(".pptx", StringComparison.OrdinalIgnoreCase))
                .ToArray();

            foreach (string pptFile in pptFiles)
            {
                try
                {
                    // è·åæä»¶åï¼ä¸å«æ©å±åï¼ï¼ç¨äºçæPDFæä»¶å
                    string fileName = Path.GetFileNameWithoutExtension(pptFile);
                    string pdfFile = Path.Combine(pdfFolderPath, $"{fileName}.pdf");

                    // å è½½å¹¶è½¬æ¢
                    using (Presentation presentation = new Presentation())
                    {
                        presentation.LoadFromFile(pptFile);
                        presentation.SaveToFile(pdfFile, FileFormat.PDF);
                    }

                    Console.WriteLine($"å·²è½¬æ¢ï¼{pptFile} â {pdfFile}");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"è½¬æ¢å¤±è´¥ {pptFile}ï¼{ex.Message}");
                }
            }

            Console.WriteLine("æ¹éè½¬æ¢å®æï¼");
        }
    }
}
</code></pre>
<h3 id="4-è¿é¶ç¤ºä¾å°-powerpoint-è½¬æ¢ä¸ºå å¯ç-pdf">4. è¿é¶ç¤ºä¾ï¼å° PowerPoint è½¬æ¢ä¸ºå å¯ç PDF</h3>
<p>è¿å¯ä»¥å¨è½¬æ¢æ¶ç´æ¥å å¯ä¿æ¤ PDF æä»¶ï¼å¹¶ä¸º PDF è®¾ç½®æéï¼</p>
<pre><code class="language-csharp">using Spire.Presentation;
using Spire.Presentation.External.Pdf;

namespace ConvertToEncryptedPdf
{
    class Program
    {
        static void Main(string[] args)
        {
            // å®ä¹æç¡®çæä»¶è·¯å¾ï¼å»ºè®®æ¿æ¢ä¸ºä½ çå®éè·¯å¾ï¼
            string inputPptPath = @"C:\Users\Administrator\Desktop\Input.pptx";
            string outputPdfPath = @"C:\Users\Administrator\Desktop\ToEncryptedPdf.pdf";
            
            // ä½¿ç¨usingè¯­å¥èªå¨éæ¾Presentationèµæºï¼ä¼äºæå¨Disposeï¼
            try
            {
                using (Presentation presentation = new Presentation())
                {
                    // å è½½PPTæä»¶
                    presentation.LoadFromFile(inputPptPath);

                    // è·åPDFä¿å­éé¡¹
                    SaveToPdfOption option = presentation.SaveToPdfOption;
                    
                    // è®¾ç½®PDFå¯ç åæé
                    // åæ°è¯´æï¼
                    // 1. ç¨æ·å¯ç ï¼æå¼PDFéè¦è¾å¥çå¯ç ï¼ï¼abc-123
                    // 2. ææèå¯ç ï¼ç¨äºä¿®æ¹PDFæéçå¯ç ï¼ï¼owner-456ï¼å¯èªå®ä¹ï¼
                    // 3. PDFæéï¼åè®¸æå° + åè®¸å¡«åè¡¨å
                    // 4. å å¯çº§å«ï¼é»è®¤128ä½ï¼é«å®å¨æ§ï¼
                  option.PdfSecurity.Encrypt("abc-123", "owner-456", 
                        PdfPermissionsFlags.Print | PdfPermissionsFlags.FillFields, 
                        PdfEncryptionKeySize.Key128Bit);

                    // ä¿å­ä¸ºå å¯PDF
                    presentation.SaveToFile(outputPdfPath, FileFormat.PDF, pdfOptions);

                    Console.WriteLine("PPTå·²æåè½¬æ¢ä¸ºå å¯PDFï¼");
                    Console.WriteLine($"è¾åºè·¯å¾ï¼{outputPdfPath}");
                }
            }
            catch (Exception ex)
            {
                // æè·ææå¯è½çå¼å¸¸å¹¶æç¤º
                Console.WriteLine($"è½¬æ¢å¤±è´¥ï¼{ex.Message}");
            }

            // æåæ§å¶å°ï¼ä¾¿äºæ¥çç»æ
            Console.ReadLine();
        }
    }
}
</code></pre>
<h2 id="5-å³é®æ³¨æäºé¡¹">5. å³é®æ³¨æäºé¡¹</h2>
<ol>
<li>
<p><strong>æ ¼å¼å¼å®¹æ§</strong>ï¼</p>
<ul>
<li>æ¯æè¾å¥æ ¼å¼ï¼PPTãPPTXãPPSãPPSX ç­ï¼</li>
<li>å¤æPPTåç´ ï¼å¦3Då¾è¡¨ãèªå®ä¹å¨ç»ãåµå¥å¼è§é¢ï¼è½¬æ¢åå¯è½ä¸¢å¤±ææ¾ç¤ºå¼å¸¸ï¼ã</li>
</ul>
</li>
<li>
<p><strong>èµæºéæ¾</strong>ï¼</p>
<ul>
<li>å¿é¡»éè¿ <code>Dispose()</code> æ¹æ³éæ¾ <code>Presentation</code> å¯¹è±¡ï¼æä½¿ç¨ <code>using</code> è¯­å¥ï¼æ¨èï¼ï¼å¦åæå¯¼è´åå­æ³æ¼ï¼å°¤å¶æ¹éè½¬æ¢æ¶éæ³¨æã</li>
</ul>
</li>
<li>
<p><strong>æéé®é¢</strong>ï¼</p>
<ul>
<li>ç¡®ä¿ç¨åºå¯¹è¾å¥/è¾åºè·¯å¾æè¯»åæéï¼å¦åä¼æåº <code>UnauthorizedAccessException</code>ã</li>
</ul>
</li>
</ol>
<h2 id="6-æ¿ä»£æ¹æ¡åè">6. æ¿ä»£æ¹æ¡åè</h2>
<ol>
<li><strong>LibreOffice SDK</strong>ï¼åè´¹å¼æºï¼éé¨ç½² LibreOffice æå¡ï¼API è¾å¤æï¼</li>
<li><strong>OpenXML SDK + iTextSharp</strong>ï¼ä»æ¯æ PPTXï¼OpenXML æ ¼å¼ï¼ï¼éèªè¡å¤çå¸å±è½¬æ¢ï¼å¼åææ¬é«ï¼</li>
<li><strong>GroupDocs.Conversion</strong>ï¼æåè´¹é¢åº¦ï¼äºåçæ¯æï¼ä½ä¾èµç½ç»ã</li>
</ol>
<hr>
<p>æ¬ææä¾äºå¯é ç C# PowerPoint è½¬ PDF è§£å³æ¹æ¡ï¼ç¹å«éåå¨æå¡å¨ç¯å¢ææ éå®è£ Microsoft Office çåºæ¯ä¸­ä½¿ç¨ãå¶ä¼ç¹åæ¬é¨ç½²ç®åãAPI è®¾è®¡æ¸æ°ãæ¯æå¤ç§è¾åºéé¡¹ç­ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="itemdesc">
                åè¡¨äº 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-15 10:38">2026-01-15 10:37</span>&nbsp;
<a href="https://www.cnblogs.com/jazz-z">LAYONTHEGROUND</a>&nbsp;
éè¯»(<span id="post_view_count">64</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19486170);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19486170', targetLink: 'https://www.cnblogs.com/jazz-z/p/19486170', title: 'å¦ä½éè¿ C# å° PPT ææ¡£è½¬æ¢ä¸º PDF æ ¼å¼' })">ä¸¾æ¥</a>

            </div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸æè·ä¸ªåï¼.NET 10 å¤§æ´æ°è®¡ç®å¯¹éµ Javaï¼ç»æä»¤äººæå¤ ]]></title>
    <link>https://www.cnblogs.com/sdcb/p/19484525/20261113-big-integer-dotnet-10-vs-java</link>
    <guid>9f38dd951b6a47bbb8de5c5c31048521</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sdcb/p/19484525/20261113-big-integer-dotnet-10-vs-java" title="åå¸äº 2026-01-15 08:50">
    <span role="heading" aria-level="2">ä¸æè·ä¸ªåï¼.NET 10 å¤§æ´æ°è®¡ç®å¯¹éµ Javaï¼ç»æä»¤äººæå¤</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å¼è¨ä»ç»éªå¼å°æ éå¤§">å¼è¨ï¼ä»âç»éªå¼âå°æ éå¤§</h2>
<p>æå¯¹æ°å¼è®¡ç®çæ§å¿µï¼æ¥èªåä¸­æ¶ä»£çé¾ç¼­ç»çç½å§ãé£æ¶ç©ãä¼å¥ãï¼æè®©æçè¿·çä¸æ¯ææªçè£å¤ï¼èæ¯è§è²é¢æ¿éé£æ¡é¿é¿ç<strong>ç»éªå¼</strong>ãççæ°å­ä¸æ­è·³å¨ãç´¯ç§¯ï¼æç»âå®âä¸å£°åçº§ï¼é£ç§ç®åçæ°å¼é©±å¨æ´ä¸ªä¸çè¿è½¬çæè§ï¼å®å¨å¤ªå¥å¦äºã</p>
<p>å½æ¶èªå­¦ç¼ç¨ï¼ä» G-BASIC éåªæ 16 ä½ç <code>INTEGER</code>ï¼å°ç¬¬ä¸æ¬¡åç° QBASIC <code>LONG</code> è½å­ä¸â20äº¿âæ¶çå´å¥ï¼åå°å¦ä»æä¸ºä¸å .NET ç¨åºåï¼ææ¡çè®ºä¸âæ éå¤§âç <code>System.Numerics.BigInteger</code>ãæå¯¹å¤§æ°çè¿·æä»æªæ¹åï¼åªæ¯çæéä¹èæ¥ï¼</p>
<blockquote>
<p><strong>ä½ä¸º .NET å¼åèï¼ææéç <code>BigInteger</code> å°åºå¤ä¸å¤å¿«ï¼ç¹å«æ¯åéå£ Java ç <code>BigInteger</code> ç¸æ¯ï¼ç©¶ç«è°æ´èä¸ç­¹ï¼</strong></p>
</blockquote>
<p>å°¤å¶æ¯æ¶åé«ç²¾åº¦è®¡ç®ãå¯ç å­¦ç­å³é®é¢åæ¶ï¼è¿ä¸ä»æ¯å¥½å¥ï¼æ´æ¯å³ä¹æ§è½çä¸¥èæ·é®ãä»å¤©ï¼æå°±éè¿ä¸æ¬¡è¯¦å°½çå¯¹æ¯æµè¯ï¼å« .NET 10ãJava 21ä»¥åJava 8ï¼ï¼æ¥ä¸ºå¤§å®¶æ­æç­æ¡ãç»æå¯è½åºä¹ææï¼è¯·å¡å¿çå°æåï¼ææ«è¿æä¸ä¸ªé«æ§è½çâå½©èâã</p>
<hr>
<h2 id="å®éªç®æ ä¸èå´">å®éªç®æ ä¸èå´</h2>
<p>æä»¬å¯¹æ¯è¿ä¸å¥å®ç°ï¼</p>
<ul>
<li><strong>.NET</strong>ï¼<code>System.Numerics.BigInteger</code>ï¼åºäº .NET 10ï¼</li>
<li><strong>Java</strong>ï¼<code>java.math.BigInteger</code>
<ul>
<li><strong>Java 21ï¼ææ°LTSï¼</strong>ï¼ä»£è¡¨æªæ¥è¶å¿</li>
<li><strong>Java 8ï¼å½åå­éæå¤§ï¼</strong>ï¼ä»£è¡¨åºå¤§çç°ç¶</li>
</ul>
</li>
</ul>
<h3 id="æµè¯æä½3ç±»è¦çå¸¸è§å¤§æ°ç­ç¹">æµè¯æä½ï¼3ç±»ï¼è¦çå¸¸è§å¤§æ°ç­ç¹ï¼</h3>
<ol>
<li><strong>ADD_MOD</strong>ï¼<code>(a + b) mod m</code>ï¼å æ³ + åæ¨¡ï¼</li>
<li><strong>MUL_MOD</strong>ï¼<code>(a * b) mod m</code>ï¼ä¹æ³ + åæ¨¡ï¼</li>
<li><strong>MODPOW</strong>ï¼<code>a^e mod m</code>ï¼æ¨¡å¹ï¼å¯ç å­¦ç­åºæ¯çæ§è½ç­ç¹ï¼</li>
</ol>
<h3 id="ä½å®½3æ¡£">ä½å®½ï¼3æ¡£ï¼</h3>
<ul>
<li>256 / 1024 / 4096 bits</li>
</ul>
<h3 id="è®¡æ¶å£å¾å°½éæå¶åªå£°">è®¡æ¶å£å¾ï¼å°½éæå¶åªå£°ï¼</h3>
<ul>
<li><strong>ç­èº«</strong>ï¼é¢ç­ 5 æ¬¡ï¼è®© JITï¼å³æ¶ç¼è¯å¨ï¼åååæ¥ã</li>
<li><strong>æµé</strong>ï¼æ­£å¼è· 11 æ¬¡ï¼åä¸­ä½æ°ï¼é¿ååæ¬¡æå¨å¹²æ°ã</li>
<li><strong>ææ </strong>ï¼<code>nsPerOp</code>ï¼æ¯æ¬¡æä½èæ¶å¤å°çº³ç§ï¼ï¼è¿ä¸ªå¼<strong>è¶å°è¶å¥½</strong>ã</li>
<li><strong>é²ä½å¼</strong>ï¼ç¨ <code>XOR</code> èåæ¯æ¬¡è®¡ç®ç»æï¼é²æ­¢èªæçç¼è¯å¨ææ´ä¸ªå¾ªç¯ä¼åæã</li>
</ul>
<hr>
<h2 id="æµè¯ç¯å¢">æµè¯ç¯å¢</h2>
<blockquote>
<p>è¯´æï¼ä»¥ä¸æ¯å¨åä¸ Linux å®¹å¨åå®æãå®¹å¨æèµæºéå¶ï¼å æ­¤âçå°ç CPU æ ¸æ°/åå­âä¸å®¿ä¸»æºä¸å®å¨ä¸è´ã</p>
</blockquote>
<ul>
<li><strong>OS</strong>ï¼Ubuntu 24.04.3 LTS</li>
<li><strong>CPUï¼å®¿ä¸»æºåå·ï¼</strong>ï¼AMD EPYC 7763 64-Core Processor<br>
<strong>å®¹å¨å¯ç¨æ ¸å¿æ°</strong>ï¼2 æ ¸ï¼åå®¹å¨éå¶ï¼</li>
<li><strong>åå­</strong>ï¼2GBï¼å®¹å¨éå¶ï¼</li>
<li><strong>.NET</strong>
<ul>
<li>SDKï¼10.0.101</li>
<li>Runtimeï¼10.0.1</li>
<li>ç¯å¢åéï¼<code>DOTNET_GCServer=1</code></li>
</ul>
</li>
<li><strong>Java</strong>
<ul>
<li>Java 21ï¼OpenJDK 21.0.9ï¼LTSï¼</li>
<li>Java 8ï¼Temurin(OpenJDK) 1.8.0_472-b08ï¼å¹¿æ³ä½¿ç¨ç 8u ç³»åï¼</li>
<li>JVM åæ°ï¼ä¸¤çæ¬ä¸è´ï¼ï¼
<ul>
<li><code>-Xms1g -Xmx1g</code>ï¼æ Java å åºå®ä¸º 1GBï¼é¿åå å¨ææ©å¼ å¹²æ°ï¼</li>
<li><code>-XX:+UseG1GC</code></li>
<li><code>-XX:+AlwaysPreTouch</code>ï¼å°½éåå°è¿è¡ä¸­é¡µåéæ°å¨ï¼</li>
</ul>
</li>
</ul>
</li>
<li><strong>ä¸è´æ§çº¦æ</strong>
<ul>
<li>Java 8/Java 21 ä½¿ç¨<strong>åä¸ä»½æºç </strong>ï¼ä»ä½¿ç¨ Java 8 è¯­æ³ï¼ï¼å¹¶ä¸ <strong>ç¨ Java 8 ç <code>javac</code> ç¼è¯</strong>ï¼classfile=52.0ï¼ååå«å¨ Java 8 / Java 21 ä¸è¿è¡ï¼ä»èå°½éæå·®å¼å½å å°è¿è¡æ¶/JIT/åºå®ç°ï¼èä¸æ¯ç¼è¯å¨çæå·®å¼ã</li>
</ul>
</li>
</ul>
<hr>
<h2 id="èµåææ²net-biginteger-ççä¸å¬å¹³å">èµåææ²ï¼.NET BigInteger ççâä¸å¬å¹³âåï¼</h2>
<p>æäººå¯è½æ³é®ï¼</p>
<blockquote>
<p>â.NET BigInteger æ¯æ¬¡è¿ç®é½ä¼åå»ºæ°çå¯¹è±¡ï¼ä¸å¯åï¼ï¼ä¸å¬å¹³ãâ</p>
</blockquote>
<p>è¿å¥è¯å¨âå¤§æ°åºæ¯âéåºæ¬æç«ï¼ä½<strong>Java BigInteger åæ ·æ¯ä¸å¯åç±»å</strong>ï¼<code>add/multiply/mod/xor/modPow</code> é½ä¼è¿åæ°å¼ï¼ä¸å¡ä»£ç å±é¢ä½ å¹¶æ²¡æå¬å¼ç in-place API å¯ä»¥å¤ç¨åé¨ç¼å²ã</p>
<p>å æ­¤ï¼å¨æ¬æçâä¸»å¯¹æ¯âï¼.NET vs Javaï¼éï¼åæ¹é½å¨ä¸å¯åèå¼ä¸è¿è¡ï¼è¿ç¹æ¯å¬å¹³çã</p>
<hr>
<h2 id="å®éªä¸net-biginteger-vs-java-21-biginteger">å®éªä¸ï¼.NET BigInteger vs Java 21 BigInteger</h2>
<h3 id="31-å®æ´æºä»£ç ">3.1 å®æ´æºä»£ç </h3>
<h4 id="java-æºç bigintbenchjava">Java æºç ï¼<code>BigIntBench.java</code></h4>
<blockquote>
<p>å¼å®¹ Java 8 è¯­æ³ï¼åä¸ä»½ä»£ç å¨ Java 21 ä¸è¿è¡ã</p>
</blockquote>
<pre><code class="language-java">import java.math.BigInteger;
import java.util.*;

public class BigIntBench {
    // SplitMix64 RNG (deterministic, fast)
    static final class SplitMix64 {
        private long x;
        SplitMix64(long seed) { this.x = seed; }
        long nextLong() {
            long z = (x += 0x9E3779B97F4A7C15L);
            z = (z ^ (z &gt;&gt;&gt; 30)) * 0xBF58476D1CE4E5B9L;
            z = (z ^ (z &gt;&gt;&gt; 27)) * 0x94D049BB133111EBL;
            return z ^ (z &gt;&gt;&gt; 31);
        }
        void nextBytes(byte[] dst) {
            int i = 0;
            while (i &lt; dst.length) {
                long v = nextLong();
                for (int k = 0; k &lt; 8 &amp;&amp; i &lt; dst.length; k++) {
                    dst[i++] = (byte)(v &gt;&gt;&gt; (56 - 8*k)); // big-endian stream
                }
            }
        }
    }

    static BigInteger[] genBigInts(int bitSize, int count, long seed) {
        SplitMix64 rng = new SplitMix64(seed);
        int byteLen = (bitSize + 7) / 8;
        BigInteger[] arr = new BigInteger[count];
        byte[] buf = new byte[byteLen];
        int topBit = (bitSize - 1) % 8;
        int keepBits = topBit + 1;
        int firstMask = (keepBits == 8) ? 0xFF : ((1 &lt;&lt; keepBits) - 1);
        byte topMask = (byte)(1 &lt;&lt; topBit);
        for (int i = 0; i &lt; count; i++) {
            rng.nextBytes(buf);
            // Ensure exact bit length:
            // - mask away unused top bits when bitSize is not byte-aligned
            // - set the top bit so the number has the requested bit length
            buf[0] &amp;= (byte)firstMask;
            buf[0] |= topMask;
            arr[i] = new BigInteger(1, buf);
        }
        return arr;
    }

    static BigInteger genModulus(int bitSize, long seed) {
        SplitMix64 rng = new SplitMix64(seed);
        int byteLen = (bitSize + 7) / 8;
        byte[] buf = new byte[byteLen];
        rng.nextBytes(buf);
        int topBit = (bitSize - 1) % 8;
        int keepBits = topBit + 1;
        int firstMask = (keepBits == 8) ? 0xFF : ((1 &lt;&lt; keepBits) - 1);
        buf[0] &amp;= (byte)firstMask;
        buf[0] |= (byte)(1 &lt;&lt; topBit);
        buf[buf.length - 1] |= 1; // odd
        return new BigInteger(1, buf);
    }

    enum Op { ADD_MOD, MUL_MOD, MODPOW }

    static final class Result {
        final String lang;
        final int bits;
        final Op op;
        final long ops;
        final double nsPerOp;
        final long checksum;
        Result(String lang, int bits, Op op, long ops, double nsPerOp, long checksum) {
            this.lang = lang; this.bits = bits; this.op = op; this.ops = ops; this.nsPerOp = nsPerOp; this.checksum = checksum;
        }
        String toJson() {
            return String.format(Locale.ROOT,
                    "{\"lang\":\"%s\",\"bits\":%d,\"op\":\"%s\",\"ops\":%d,\"nsPerOp\":%.3f,\"checksum\":%d}",
                    lang, bits, op.name(), ops, nsPerOp, checksum);
        }
    }

    static long runOnce(Op op, BigInteger[] a, BigInteger[] b, BigInteger[] e, BigInteger mod, int outer) {
        BigInteger acc = BigInteger.ZERO;
        int n = a.length;
        switch (op) {
            case ADD_MOD:
                for (int o = 0; o &lt; outer; o++) {
                    for (int i = 0; i &lt; n; i++) {
                        BigInteger r = a[i].add(b[i]).mod(mod);
                        acc = acc.xor(r);
                    }
                }
                break;

            case MUL_MOD:
                for (int o = 0; o &lt; outer; o++) {
                    for (int i = 0; i &lt; n; i++) {
                        BigInteger r = a[i].multiply(b[i]).mod(mod);
                        acc = acc.xor(r);
                    }
                }
                break;

            case MODPOW:
                // here we use a.length as n; e can be same length
                for (int o = 0; o &lt; outer; o++) {
                    for (int i = 0; i &lt; n; i++) {
                        BigInteger r = a[i].modPow(e[i], mod);
                        acc = acc.xor(r);
                    }
                }
                break;

            default:
                throw new IllegalArgumentException("Unknown op: " + op);
        }
        return acc.longValue();
    }

    static Result bench(String lang, int bits, Op op, BigInteger[] a, BigInteger[] b, BigInteger[] e, BigInteger mod, long targetOps, int warmups, int measures) {
        int n = a.length;
        int outer = (int)Math.max(1, targetOps / n);
        long actualOps = (long)n * outer;

        // warmup
        long ck = 0;
        for (int i = 0; i &lt; warmups; i++) {
            ck ^= runOnce(op, a, b, e, mod, outer);
        }

        long[] times = new long[measures];
        for (int i = 0; i &lt; measures; i++) {
            long t0 = System.nanoTime();
            long c = runOnce(op, a, b, e, mod, outer);
            long t1 = System.nanoTime();
            ck ^= c;
            times[i] = (t1 - t0);
        }
        Arrays.sort(times);
        long median = times[times.length / 2];
        double nsPerOp = (double)median / (double)actualOps;
        return new Result(lang, bits, op, actualOps, nsPerOp, ck);
    }

    static void printHuman(List&lt;Result&gt; results) {
        System.out.println("Java BigInteger benchmark");
        System.out.println("java.version=" + System.getProperty("java.version"));
        System.out.println("java.vm.name=" + System.getProperty("java.vm.name"));
        System.out.println();
        System.out.printf(Locale.ROOT, "%-6s %-9s %-12s %-12s\n", "Bits", "Op", "ns/op(med)", "ops/run");
        for (Result r : results) {
            System.out.printf(Locale.ROOT, "%-6d %-9s %-12.3f %-12d\n", r.bits, r.op.name(), r.nsPerOp, r.ops);
        }
        System.out.println();
        System.out.println("checksum=" + results.stream().mapToLong(x -&gt; x.checksum).reduce(0L, (x,y)-&gt;x^y));
    }

    public static void main(String[] args) {
        boolean json = false;
        for (String a : args) if (a.equals("--json")) json = true;

        int warmups = 5;
        int measures = 11;

        int[] bitSizes = new int[]{256, 1024, 4096};
        List&lt;Result&gt; results = new ArrayList&lt;&gt;();

        for (int bits : bitSizes) {
            BigInteger mod = genModulus(bits, 0xA1B2C3D4E5F60708L ^ bits);

            // add/mul datasets
            int nAddMul = 1024;
            BigInteger[] a = genBigInts(bits, nAddMul, 0x1111222233334444L ^ bits);
            BigInteger[] b = genBigInts(bits, nAddMul, 0x9999AAAABBBBCCCCL ^ bits);

            // modpow datasets (smaller)
            int nPow = 256;
            BigInteger[] ap = genBigInts(bits, nPow, 0x13579BDF2468ACE0L ^ bits);
            BigInteger[] ep = genBigInts(Math.min(bits, 512), nPow, 0x0FEDCBA987654321L ^ bits);

            long addOps;
            long mulOps;
            long powOps;
            if (bits == 256) {
                addOps = 2_000_000L;
                mulOps = 500_000L;
                powOps = 8_000L;
            } else if (bits == 1024) {
                addOps = 1_000_000L;
                mulOps = 120_000L;
                powOps = 1_500L;
            } else {
                addOps = 200_000L;
                mulOps = 20_000L;
                powOps = 250L;
            }

            results.add(bench("java", bits, Op.ADD_MOD, a, b, null, mod, addOps, warmups, measures));
            results.add(bench("java", bits, Op.MUL_MOD, a, b, null, mod, mulOps, warmups, measures));
            results.add(bench("java", bits, Op.MODPOW, ap, null, ep, mod, powOps, warmups, measures));
        }

        if (json) {
            for (Result r : results) System.out.println(r.toJson());
        } else {
            printHuman(results);
        }
    }
}
</code></pre>
<h4 id="net-æºç programcsbiginteger-é¨å">.NET æºç ï¼<code>Program.cs</code>ï¼BigInteger é¨åï¼</h4>
<blockquote>
<p>è¿æ¯âä¸»å¯¹æ¯âç¨ç .NET åºåç¨åºã</p>
</blockquote>
<pre><code class="language-csharp">using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Globalization;
using System.Linq;
using System.Numerics;

sealed class SplitMix64
{
    private ulong _x;
    public SplitMix64(ulong seed) =&gt; _x = seed;

    public ulong NextUInt64()
    {
        ulong z = (_x += 0x9E3779B97F4A7C15UL);
        z = (z ^ (z &gt;&gt; 30)) * 0xBF58476D1CE4E5B9UL;
        z = (z ^ (z &gt;&gt; 27)) * 0x94D049BB133111EBUL;
        return z ^ (z &gt;&gt; 31);
    }

    public void NextBytes(byte[] dst)
    {
        int i = 0;
        while (i &lt; dst.Length)
        {
            ulong v = NextUInt64();
            for (int k = 0; k &lt; 8 &amp;&amp; i &lt; dst.Length; k++)
            {
                dst[i++] = (byte)(v &gt;&gt; (56 - 8 * k)); // big-endian stream
            }
        }
    }
}

enum Op { ADD_MOD, MUL_MOD, MODPOW }

record Result(string Lang, int Bits, Op Op, long Ops, double NsPerOp, long Checksum)
{
    public string ToJson() =&gt; string.Create(CultureInfo.InvariantCulture,
        $"{{\"lang\":\"{Lang}\",\"bits\":{Bits},\"op\":\"{Op}\",\"ops\":{Ops},\"nsPerOp\":{NsPerOp:F3},\"checksum\":{Checksum}}}");
}

static class BigIntBench
{
    static BigInteger[] GenBigInts(int bitSize, int count, ulong seed)
    {
        var rng = new SplitMix64(seed);
        int byteLen = (bitSize + 7) / 8;
        var arr = new BigInteger[count];
        var buf = new byte[byteLen];
        int topBit = (bitSize - 1) % 8;
        byte topMask = (byte)(1 &lt;&lt; topBit);

        for (int i = 0; i &lt; count; i++)
        {
            rng.NextBytes(buf);
            buf[0] |= topMask;
            // unsigned + big-endian prevents negative
            arr[i] = new BigInteger(buf, isUnsigned: true, isBigEndian: true);
        }
        return arr;
    }

    static BigInteger GenModulus(int bitSize, ulong seed)
    {
        var rng = new SplitMix64(seed);
        int byteLen = (bitSize + 7) / 8;
        var buf = new byte[byteLen];
        rng.NextBytes(buf);
        int topBit = (bitSize - 1) % 8;
        buf[0] |= (byte)(1 &lt;&lt; topBit);
        buf[^1] |= 1; // odd
        return new BigInteger(buf, isUnsigned: true, isBigEndian: true);
    }

    static long RunOnce(Op op, BigInteger[] a, BigInteger[] b, BigInteger[] e, BigInteger mod, int outer)
    {
        BigInteger acc = BigInteger.Zero;
        int n = a.Length;

        switch (op)
        {
            case Op.ADD_MOD:
                for (int o = 0; o &lt; outer; o++)
                    for (int i = 0; i &lt; n; i++)
                    {
                        var r = (a[i] + b[i]) % mod;
                        acc ^= r;
                    }
                break;

            case Op.MUL_MOD:
                for (int o = 0; o &lt; outer; o++)
                    for (int i = 0; i &lt; n; i++)
                    {
                        var r = (a[i] * b[i]) % mod;
                        acc ^= r;
                    }
                break;

            case Op.MODPOW:
                for (int o = 0; o &lt; outer; o++)
                    for (int i = 0; i &lt; n; i++)
                    {
                        var r = BigInteger.ModPow(a[i], e[i], mod);
                        acc ^= r;
                    }
                break;
        }

        return (long)(acc &amp; long.MaxValue); // stable checksum
    }

    static Result Bench(string lang, int bits, Op op, BigInteger[] a, BigInteger[] b, BigInteger[] e, BigInteger mod, long targetOps, int warmups, int measures)
    {
        int n = a.Length;
        int outer = (int)Math.Max(1, targetOps / n);
        long actualOps = (long)n * outer;

        long ck = 0;
        for (int i = 0; i &lt; warmups; i++)
            ck ^= RunOnce(op, a, b, e, mod, outer);

        long[] timesNs = new long[measures];
        for (int i = 0; i &lt; measures; i++)
        {
            var sw = Stopwatch.StartNew();
            long c = RunOnce(op, a, b, e, mod, outer);
            sw.Stop();
            ck ^= c;
            // Stopwatch ticks to ns
            timesNs[i] = (long)(sw.ElapsedTicks * (1_000_000_000.0 / Stopwatch.Frequency));
        }

        Array.Sort(timesNs);
        long median = timesNs[timesNs.Length / 2];
        double nsPerOp = (double)median / actualOps;
        return new Result(lang, bits, op, actualOps, nsPerOp, ck);
    }

    static void PrintHuman(List&lt;Result&gt; results)
    {
        Console.WriteLine("C# BigInteger benchmark");
        Console.WriteLine($"dotnet.version={Environment.Version}");
        Console.WriteLine($"os={System.Runtime.InteropServices.RuntimeInformation.OSDescription}");
        Console.WriteLine($"arch={System.Runtime.InteropServices.RuntimeInformation.OSArchitecture}");
        Console.WriteLine();
        Console.WriteLine($"{ "Bits",-6} {"Op",-9} {"ns/op(med)",-12} {"ops/run",-12}");
        foreach (var r in results)
            Console.WriteLine(string.Create(CultureInfo.InvariantCulture, $"{r.Bits,-6} {r.Op,-9} {r.NsPerOp,-12:F3} {r.Ops,-12}"));
        Console.WriteLine();
        long checksum = 0;
        foreach (var r in results) checksum ^= r.Checksum;
        Console.WriteLine($"checksum={checksum}");
    }

    public static int Main(string[] args)
    {
        bool json = args.Any(a =&gt; a == "--json");

        int warmups = 5;
        int measures = 11;
        int[] bitSizes = [256, 1024, 4096];

        var results = new List&lt;Result&gt;();

        foreach (int bits in bitSizes)
        {
            var mod = GenModulus(bits, 0xA1B2C3D4E5F60708UL ^ (uint)bits);

            int nAddMul = 1024;
            var a = GenBigInts(bits, nAddMul, 0x1111222233334444UL ^ (uint)bits);
            var b = GenBigInts(bits, nAddMul, 0x9999AAAABBBBCCCCUL ^ (uint)bits);

            int nPow = 256;
            var ap = GenBigInts(bits, nPow, 0x13579BDF2468ACE0UL ^ (uint)bits);
            var ep = GenBigInts(Math.Min(bits, 512), nPow, 0x0FEDCBA987654321UL ^ (uint)bits);

            long addOps = bits switch { 256 =&gt; 2_000_000L, 1024 =&gt; 1_000_000L, _ =&gt; 200_000L };
            long mulOps = bits switch { 256 =&gt; 500_000L, 1024 =&gt; 120_000L, _ =&gt; 20_000L };
            long powOps = bits switch { 256 =&gt; 8_000L, 1024 =&gt; 1_500L, _ =&gt; 250L };

            results.Add(Bench("csharp", bits, Op.ADD_MOD, a, b, null!, mod, addOps, warmups, measures));
            results.Add(Bench("csharp", bits, Op.MUL_MOD, a, b, null!, mod, mulOps, warmups, measures));
            results.Add(Bench("csharp", bits, Op.MODPOW, ap, null!, ep, mod, powOps, warmups, measures));
        }

        if (json)
        {
            foreach (var r in results) Console.WriteLine(r.ToJson());
        }
        else
        {
            PrintHuman(results);
        }

        return 0;
    }
}
</code></pre>
<h3 id="32-è¿è¡æ¹å¼å¯å¤ç°å½ä»¤">3.2 è¿è¡æ¹å¼ï¼å¯å¤ç°å½ä»¤ï¼</h3>
<pre><code class="language-bash"># Java 21
cd /app/bigintbench/java
javac BigIntBench.java
java -Xms1g -Xmx1g -XX:+UseG1GC -XX:+AlwaysPreTouch BigIntBench --json

# .NET 10
cd /app/bigintbench/csharp
dotnet build -c Release
DOTNET_GCServer=1 dotnet run -c Release -- --json
</code></pre>
<h3 id="33-å®éªä¸åå§è¾åºjsonl">3.3 å®éªä¸åå§è¾åºï¼JSONLï¼</h3>
<h4 id="java-21results_java21jsonl">Java 21ï¼<code>results_java21.jsonl</code></h4>
<pre><code class="language-jsonl">{"lang":"java","bits":256,"op":"ADD_MOD","ops":1999872,"nsPerOp":139.589,"checksum":0}
{"lang":"java","bits":256,"op":"MUL_MOD","ops":499712,"nsPerOp":387.031,"checksum":0}
{"lang":"java","bits":256,"op":"MODPOW","ops":7936,"nsPerOp":17764.884,"checksum":0}
{"lang":"java","bits":1024,"op":"ADD_MOD","ops":999424,"nsPerOp":284.672,"checksum":0}
{"lang":"java","bits":1024,"op":"MUL_MOD","ops":119808,"nsPerOp":3094.540,"checksum":0}
{"lang":"java","bits":1024,"op":"MODPOW","ops":1280,"nsPerOp":264577.852,"checksum":0}
{"lang":"java","bits":4096,"op":"ADD_MOD","ops":199680,"nsPerOp":900.735,"checksum":0}
{"lang":"java","bits":4096,"op":"MUL_MOD","ops":19456,"nsPerOp":32062.554,"checksum":0}
{"lang":"java","bits":4096,"op":"MODPOW","ops":256,"nsPerOp":3422756.113,"checksum":0}
</code></pre>
<h4 id="net-10results_csharpjsonl">.NET 10ï¼<code>results_csharp.jsonl</code></h4>
<pre><code class="language-jsonl">{"lang":"csharp","bits":256,"op":"ADD_MOD","ops":1999872,"nsPerOp":146.261,"checksum":0}
{"lang":"csharp","bits":256,"op":"MUL_MOD","ops":499712,"nsPerOp":560.246,"checksum":0}
{"lang":"csharp","bits":256,"op":"MODPOW","ops":7936,"nsPerOp":169713.608,"checksum":0}
{"lang":"csharp","bits":1024,"op":"ADD_MOD","ops":999424,"nsPerOp":297.335,"checksum":0}
{"lang":"csharp","bits":1024,"op":"MUL_MOD","ops":119808,"nsPerOp":4792.760,"checksum":0}
{"lang":"csharp","bits":1024,"op":"MODPOW","ops":1280,"nsPerOp":1938407.720,"checksum":0}
{"lang":"csharp","bits":4096,"op":"ADD_MOD","ops":199680,"nsPerOp":1280.760,"checksum":0}
{"lang":"csharp","bits":4096,"op":"MUL_MOD","ops":19456,"nsPerOp":36894.568,"checksum":0}
{"lang":"csharp","bits":4096,"op":"MODPOW","ops":256,"nsPerOp":20617970.004,"checksum":0}
</code></pre>
<hr>
<h2 id="å®éªäºå å¥-java-8-çç°ç¶ä¸»æµå¤äºä»ä¹ä½ç½®">å®éªäºï¼å å¥ Java 8 ââçâç°ç¶ä¸»æµâå¤äºä»ä¹ä½ç½®</h2>
<p>è¿ä¸ç»çå³é®ç¹æ¯ï¼<strong>åä¸ä»½ Java æºç ç¨ Java 8 ç¼è¯</strong>ï¼åå«å¨ Java 8 ä¸ Java 21 ä¸è¿è¡ï¼å°½éé¿åâç¼è¯å¨äº§ç©å·®å¼âã</p>
<h3 id="41-è¿è¡æ¹å¼">4.1 è¿è¡æ¹å¼</h3>
<pre><code class="language-bash"># ç¼è¯ï¼Java 8ï¼
/path/to/jdk8/bin/javac BigIntBench.java

# è¿è¡ï¼Java 8ï¼
/path/to/jdk8/bin/java -Xms1g -Xmx1g -XX:+UseG1GC -XX:+AlwaysPreTouch BigIntBench --json

# è¿è¡ï¼Java 21ï¼
java -Xms1g -Xmx1g -XX:+UseG1GC -XX:+AlwaysPreTouch BigIntBench --json
</code></pre>
<h3 id="42-å®éªäºåå§è¾åºjsonl">4.2 å®éªäºåå§è¾åºï¼JSONLï¼</h3>
<h4 id="java-8results_java8jsonl">Java 8ï¼<code>results_java8.jsonl</code></h4>
<pre><code class="language-jsonl">{"lang":"java","bits":256,"op":"ADD_MOD","ops":1999872,"nsPerOp":207.335,"checksum":0}
{"lang":"java","bits":256,"op":"MUL_MOD","ops":499712,"nsPerOp":468.248,"checksum":0}
{"lang":"java","bits":256,"op":"MODPOW","ops":7936,"nsPerOp":17697.113,"checksum":0}
{"lang":"java","bits":1024,"op":"ADD_MOD","ops":999424,"nsPerOp":390.906,"checksum":0}
{"lang":"java","bits":1024,"op":"MUL_MOD","ops":119808,"nsPerOp":3089.474,"checksum":0}
{"lang":"java","bits":1024,"op":"MODPOW","ops":1280,"nsPerOp":277395.652,"checksum":0}
{"lang":"java","bits":4096,"op":"ADD_MOD","ops":199680,"nsPerOp":990.708,"checksum":0}
{"lang":"java","bits":4096,"op":"MUL_MOD","ops":19456,"nsPerOp":30692.214,"checksum":0}
{"lang":"java","bits":4096,"op":"MODPOW","ops":256,"nsPerOp":3468269.539,"checksum":0}
</code></pre>
<hr>
<h2 id="å¯è§åä¸æ»ç»">å¯è§åä¸æ»ç»</h2>
<p>ä»ä¸ä¸ª .NET ç¨åºåçè§è§æ¥çï¼è¿æ¬¡çæµè¯ç»æå¯ä»¥è¯´æ¢å¨æçä¹ä¸­ï¼åæäºåºä¹ææã</p>
<ol>
<li><strong>ADD_MOD (å æ³+åæ¨¡)</strong>: å¨è¿ä¸ªé¡¹ç®ä¸ï¼.NET å Java 21 å ä¹æäºä¸ªå¹³æï¼å·®è·å¾®ä¹å¶å¾®ãå¯ä»¥è¯´ï¼å¨åºç¡çå æ³è¿ç®ä¸ï¼.NET è¡¨ç°å¾ç¸å½ä¸éã<br>
<img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260114225530983-1114904260.png" alt="bar_csharp_baseline_add_mod" loading="lazy"></li>
<li><strong>MUL_MOD (ä¹æ³+åæ¨¡)</strong>: ä»è¿éå¼å§ï¼å·®è·åºç°äºã.NET ææ¾æ¢äº Javaï¼æ§è½é¸¿æ²å¼å§åå¾âèç¼å¯è§âã<br>
<img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260114225554833-1748112213.png" alt="bar_csharp_baseline_mul_mod" loading="lazy"></li>
<li><strong>MODPOW (æ¨¡å¹)</strong>: è¿æ¯å·®è·æå¤§çå°æ¹ã.NET å¨è¿é¡¹æµè¯ä¸­è¢« Java 21 æå¼äº <strong>6å°9å</strong> çå·®è·ãå¯¹äºä»äºå¯ç å­¦æéè¦å¤§éå¤§æ°è¿ç®çå¼åèæ¥è¯´ï¼è¿æ¯ä¸ä¸ªéå¸¸åºç¼çä¿¡å·ã<br>
<img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260114225547260-463566788.png" alt="bar_csharp_baseline_modpow" loading="lazy"></li>
<li><strong>Java 8 vs Java 21</strong>: æ¯«æ çé®ï¼Java 21 å¨ç»å¤§å¤æ°æåµä¸é½æ¯èè¿ç Java 8 è¦å¿«ãä¸è¿æè¶£çæ¯ï¼å¨ <code>MUL_MOD</code> ç 1024 å 4096 ä½æµè¯ä¸­ï¼Java 8 å±ç¶åºç°äºâåè¶âçç°è±¡ãè¿å¯è½æ¯ç±äº JIT ç­ç¥ãç®æ³éæ©çéå¼å·®å¼ï¼ææ¯åçº¯çæµéè¯¯å·®ãè½ç¶è¿ä¸å½±åâJava 21æ´å¿«âçæ»ä½ç»è®ºï¼ä½ä¹æéæä»¬æ§è½æµè¯çå¤ææ§ã</li>
</ol>
<p>æ»èè¨ä¹ï¼è¿æ¬¡å¯¹å³è®©æä»¬æ¸æ¥å°çå°ï¼å¨å¤æçå¤§æ°è¿ç®ä¸ï¼.NET ç <code>BigInteger</code> ç¡®å®è¿æå¾é¿çè·¯è¦èµ°ã</p>
<hr>
<h2 id="one-more-thingå½å¤æ´ç»åº">One More Thingï¼å½âå¤æ´âç»åº</h2>
<p>å¨å¯»æ¾ .NET å¤§æ°æ§è½ä¼åæ¹æ¡çè¿ç¨ä¸­ï¼æä»¬èªç¶è½æ³å°äºä¸çæ æ GMP ââå®æ¯ GNU Multi-Precision Arithmetic Libraryï¼å¾å¤æ°å­¦è½¯ä»¶/å¯ç å­¦å®ç°é½ä¼ç¨å®åé«æ§è½å¤§æ´æ°è¿ç®ã</p>
<p>æç¢°å·§ä¹ä¸ºå®åäºä¸ä¸ª .NET å°è£ï¼<a href="https://github.com/sdcb/Sdcb.Arithmetic" target="_blank" rel="noopener nofollow">Sdcb.Arithmetic</a>ã</p>
<p>ä½å¿é¡»æåå£°æï¼<strong>è®© GMP ä½ä¸ºâå¤æ´âå å¥è¿åºå¯¹æ¯ï¼æ¯âä¸å¬å¹³âç</strong>ãåå å¾ç®åï¼</p>
<ul>
<li><strong>è¯­è¨ä¼å¿</strong>ï¼GMP æ¯åç C/æ±ç¼ï¼è .NET å Java æ¯å¨èææºä¸è¿è¡çæç®¡è¯­è¨ã</li>
<li><strong>åå­ç­ç¥</strong>ï¼GMP é¼å±ä½¿ç¨ <strong>in-place API</strong>ï¼å¯ä»¥ç´æ¥å¨åå°ä¿®æ¹æ°å¼ï¼å¤§å¤§åå°äºåå­åéå GC ååãè .NET å Java ç <code>BigInteger</code> åæ¯ä¸å¯åå¯¹è±¡ã</li>
</ul>
<p>æä»¥ï¼è¿é¨åçç»ææ´åæ¯ä¸ä¸ªâå½©èâï¼å±ç¤ºçæ¯ï¼<strong>å¦æä½ æ¿æå¼å¥åçä¾èµï¼å¹¶æ¹åç¼ç é£æ ¼ï¼.NET çå¤§æ°æ§è½å¯ä»¥è¾¾å°ææ ·çé«åº¦ã</strong></p>
<h3 id="71-å®¢ä¸²å®éªå®æ´æºä»£ç net-biginteger--gmpinteger-ååº">7.1 å®¢ä¸²å®éªå®æ´æºä»£ç ï¼.NET BigInteger + GmpInteger ååºï¼</h3>
<blockquote>
<p>ä¸é¢ä»£ç ä¼åæ¶è¾åºä¸¤å¥ç»æï¼<code>csharp_bigint</code> ä¸ <code>csharp_gmp_inplace</code>ï¼ä»æ¯ JSONLï¼ã</p>
</blockquote>
<p><strong><code>Program.cs</code>ï¼å®¢ä¸²çï¼å®æ´ï¼</strong></p>
<pre><code class="language-csharp">using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Globalization;
using System.Linq;
using System.Numerics;
using Sdcb.Arithmetic.Gmp;

sealed class SplitMix64
{
    private ulong _x;
    public SplitMix64(ulong seed) =&gt; _x = seed;

    public ulong NextUInt64()
    {
        ulong z = (_x += 0x9E3779B97F4A7C15UL);
        z = (z ^ (z &gt;&gt; 30)) * 0xBF58476D1CE4E5B9UL;
        z = (z ^ (z &gt;&gt; 27)) * 0x94D049BB133111EBUL;
        return z ^ (z &gt;&gt; 31);
    }

    public void NextBytes(byte[] dst)
    {
        int i = 0;
        while (i &lt; dst.Length)
        {
            ulong v = NextUInt64();
            for (int k = 0; k &lt; 8 &amp;&amp; i &lt; dst.Length; k++)
                dst[i++] = (byte)(v &gt;&gt; (56 - 8 * k));
        }
    }
}

enum Op { ADD_MOD, MUL_MOD, MODPOW }

record Result(string Impl, int Bits, Op Op, long Ops, double NsPerOp, long Checksum)
{
    public string ToJson() =&gt; string.Create(CultureInfo.InvariantCulture,
        $"{{\"lang\":\"{Impl}\",\"bits\":{Bits},\"op\":\"{Op}\",\"ops\":{Ops},\"nsPerOp\":{NsPerOp:F3},\"checksum\":{Checksum}}}");
}

static class BenchUtil
{
    public static void MaskToBitSize(byte[] buf, int bitSize)
    {
        int topBit = (bitSize - 1) % 8;
        int keepBits = topBit + 1;
        int firstMask = keepBits == 8 ? 0xFF : ((1 &lt;&lt; keepBits) - 1);
        buf[0] &amp;= (byte)firstMask;
        buf[0] |= (byte)(1 &lt;&lt; topBit);
    }

    public static string ToHex(byte[] bytes) =&gt; Convert.ToHexString(bytes);
}

static class BigIntegerBench
{
    public static BigInteger[] Gen(int bitSize, int count, ulong seed)
    {
        var rng = new SplitMix64(seed);
        int byteLen = (bitSize + 7) / 8;
        var arr = new BigInteger[count];
        var buf = new byte[byteLen];

        for (int i = 0; i &lt; count; i++)
        {
            rng.NextBytes(buf);
            BenchUtil.MaskToBitSize(buf, bitSize);
            arr[i] = new BigInteger(buf, isUnsigned: true, isBigEndian: true);
        }
        return arr;
    }

    public static BigInteger GenModulus(int bitSize, ulong seed)
    {
        var rng = new SplitMix64(seed);
        int byteLen = (bitSize + 7) / 8;
        var buf = new byte[byteLen];
        rng.NextBytes(buf);
        BenchUtil.MaskToBitSize(buf, bitSize);
        buf[^1] |= 1;
        return new BigInteger(buf, isUnsigned: true, isBigEndian: true);
    }

    public static long RunOnce(Op op, BigInteger[] a, BigInteger[] b, BigInteger[] e, BigInteger mod, int outer)
    {
        BigInteger acc = BigInteger.Zero;
        int n = a.Length;

        switch (op)
        {
            case Op.ADD_MOD:
                for (int o = 0; o &lt; outer; o++)
                    for (int i = 0; i &lt; n; i++)
                        acc ^= (a[i] + b[i]) % mod;
                break;

            case Op.MUL_MOD:
                for (int o = 0; o &lt; outer; o++)
                    for (int i = 0; i &lt; n; i++)
                        acc ^= (a[i] * b[i]) % mod;
                break;

            case Op.MODPOW:
                for (int o = 0; o &lt; outer; o++)
                    for (int i = 0; i &lt; n; i++)
                        acc ^= BigInteger.ModPow(a[i], e[i], mod);
                break;
        }

        return (long)(acc &amp; long.MaxValue);
    }
}

static class GmpIntegerBench
{
    public static GmpInteger[] Gen(int bitSize, int count, ulong seed)
    {
        var rng = new SplitMix64(seed);
        int byteLen = (bitSize + 7) / 8;
        var arr = new GmpInteger[count];
        var buf = new byte[byteLen];

        for (int i = 0; i &lt; count; i++)
        {
            rng.NextBytes(buf);
            BenchUtil.MaskToBitSize(buf, bitSize);
            arr[i] = GmpInteger.Parse(BenchUtil.ToHex(buf), 16);
        }
        return arr;
    }

    public static GmpInteger GenModulus(int bitSize, ulong seed)
    {
        var rng = new SplitMix64(seed);
        int byteLen = (bitSize + 7) / 8;
        var buf = new byte[byteLen];
        rng.NextBytes(buf);
        BenchUtil.MaskToBitSize(buf, bitSize);
        buf[^1] |= 1;
        return GmpInteger.Parse(BenchUtil.ToHex(buf), 16);
    }

    public static long RunOnce(Op op, GmpInteger[] a, GmpInteger[] b, GmpInteger[] e, GmpInteger mod, int outer)
    {
        using var acc = GmpInteger.From(0);
        using var tmp = GmpInteger.From(0);

        int n = a.Length;
        switch (op)
        {
            case Op.ADD_MOD:
                for (int o = 0; o &lt; outer; o++)
                    for (int i = 0; i &lt; n; i++)
                    {
                        GmpInteger.AddInplace(tmp, a[i], b[i]);
                        GmpInteger.ModInplace(tmp, tmp, mod);
                        GmpInteger.BitwiseXorInplace(acc, acc, tmp);
                    }
                break;

            case Op.MUL_MOD:
                for (int o = 0; o &lt; outer; o++)
                    for (int i = 0; i &lt; n; i++)
                    {
                        GmpInteger.MultiplyInplace(tmp, a[i], b[i]);
                        GmpInteger.ModInplace(tmp, tmp, mod);
                        GmpInteger.BitwiseXorInplace(acc, acc, tmp);
                    }
                break;

            case Op.MODPOW:
                for (int o = 0; o &lt; outer; o++)
                    for (int i = 0; i &lt; n; i++)
                    {
                        GmpInteger.PowerModInplace(tmp, a[i], e[i], mod);
                        GmpInteger.BitwiseXorInplace(acc, acc, tmp);
                    }
                break;
        }

        return acc.GetHashCode();
    }

    public static void DisposeAll(GmpInteger[] xs)
    {
        foreach (var x in xs) x.Dispose();
    }
}

static class Runner
{
    static Result BenchBigInteger(int bits, Op op, BigInteger[] a, BigInteger[] b, BigInteger[] e, BigInteger mod, long targetOps, int warmups, int measures)
    {
        int n = a.Length;
        int outer = (int)Math.Max(1, targetOps / n);
        long actualOps = (long)n * outer;

        long ck = 0;
        for (int i = 0; i &lt; warmups; i++) ck ^= BigIntegerBench.RunOnce(op, a, b, e, mod, outer);

        long[] timesNs = new long[measures];
        for (int i = 0; i &lt; measures; i++)
        {
            var sw = Stopwatch.StartNew();
            long c = BigIntegerBench.RunOnce(op, a, b, e, mod, outer);
            sw.Stop();
            ck ^= c;
            timesNs[i] = (long)(sw.ElapsedTicks * (1_000_000_000.0 / Stopwatch.Frequency));
        }
        Array.Sort(timesNs);
        long median = timesNs[timesNs.Length / 2];
        return new Result("csharp_bigint", bits, op, actualOps, (double)median / actualOps, ck);
    }

    static Result BenchGmpInteger(int bits, Op op, GmpInteger[] a, GmpInteger[] b, GmpInteger[] e, GmpInteger mod, long targetOps, int warmups, int measures)
    {
        int n = a.Length;
        int outer = (int)Math.Max(1, targetOps / n);
        long actualOps = (long)n * outer;

        long ck = 0;
        for (int i = 0; i &lt; warmups; i++) ck ^= GmpIntegerBench.RunOnce(op, a, b, e, mod, outer);

        long[] timesNs = new long[measures];
        for (int i = 0; i &lt; measures; i++)
        {
            var sw = Stopwatch.StartNew();
            long c = GmpIntegerBench.RunOnce(op, a, b, e, mod, outer);
            sw.Stop();
            ck ^= c;
            timesNs[i] = (long)(sw.ElapsedTicks * (1_000_000_000.0 / Stopwatch.Frequency));
        }
        Array.Sort(timesNs);
        long median = timesNs[timesNs.Length / 2];
        return new Result("csharp_gmp_inplace", bits, op, actualOps, (double)median / actualOps, ck);
    }

    public static int Run(string[] args)
    {
        bool json = args.Any(a =&gt; a == "--json");

        int warmups = 5;
        int measures = 11;
        int[] bitSizes = [256, 1024, 4096];

        var results = new List&lt;Result&gt;();

        foreach (int bits in bitSizes)
        {
            long addOps = bits switch { 256 =&gt; 2_000_000L, 1024 =&gt; 1_000_000L, _ =&gt; 200_000L };
            long mulOps = bits switch { 256 =&gt; 500_000L, 1024 =&gt; 120_000L, _ =&gt; 20_000L };
            long powOps = bits switch { 256 =&gt; 8_000L, 1024 =&gt; 1_500L, _ =&gt; 250L };

            // BigInteger data
            var modB = BigIntegerBench.GenModulus(bits, 0xA1B2C3D4E5F60708UL ^ (uint)bits);
            var aB = BigIntegerBench.Gen(bits, 1024, 0x1111222233334444UL ^ (uint)bits);
            var bB = BigIntegerBench.Gen(bits, 1024, 0x9999AAAABBBBCCCCUL ^ (uint)bits);
            var apB = BigIntegerBench.Gen(bits, 256, 0x13579BDF2468ACE0UL ^ (uint)bits);
            var epB = BigIntegerBench.Gen(Math.Min(bits, 512), 256, 0x0FEDCBA987654321UL ^ (uint)bits);

            // GmpInteger data (same seeds/bit sizes)
            using var modG = GmpIntegerBench.GenModulus(bits, 0xA1B2C3D4E5F60708UL ^ (uint)bits);
            var aG = GmpIntegerBench.Gen(bits, 1024, 0x1111222233334444UL ^ (uint)bits);
            var bG = GmpIntegerBench.Gen(bits, 1024, 0x9999AAAABBBBCCCCUL ^ (uint)bits);
            var apG = GmpIntegerBench.Gen(bits, 256, 0x13579BDF2468ACE0UL ^ (uint)bits);
            var epG = GmpIntegerBench.Gen(Math.Min(bits, 512), 256, 0x0FEDCBA987654321UL ^ (uint)bits);

            try
            {
                results.Add(BenchBigInteger(bits, Op.ADD_MOD, aB, bB, null!, modB, addOps, warmups, measures));
                results.Add(BenchBigInteger(bits, Op.MUL_MOD, aB, bB, null!, modB, mulOps, warmups, measures));
                results.Add(BenchBigInteger(bits, Op.MODPOW, apB, null!, epB, modB, powOps, warmups, measures));

                results.Add(BenchGmpInteger(bits, Op.ADD_MOD, aG, bG, null!, modG, addOps, warmups, measures));
                results.Add(BenchGmpInteger(bits, Op.MUL_MOD, aG, bG, null!, modG, mulOps, warmups, measures));
                results.Add(BenchGmpInteger(bits, Op.MODPOW, apG, null!, epG, modG, powOps, warmups, measures));
            }
            finally
            {
                GmpIntegerBench.DisposeAll(aG);
                GmpIntegerBench.DisposeAll(bG);
                GmpIntegerBench.DisposeAll(apG);
                GmpIntegerBench.DisposeAll(epG);
            }
        }

        if (json)
        {
            foreach (var r in results) Console.WriteLine(r.ToJson());
        }

        return 0;
    }
}

public static class Program
{
    public static int Main(string[] args) =&gt; Runner.Run(args);
}
</code></pre>
<p><strong><code>gmpbench.csproj</code>ï¼å®¢ä¸²çé¡¹ç®æä»¶ï¼</strong></p>
<pre><code class="language-xml">&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;net10.0&lt;/TargetFramework&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
  &lt;/PropertyGroup&gt;

  &lt;ItemGroup&gt;
    &lt;PackageReference Include="Sdcb.Arithmetic.Gmp" Version="*" /&gt;
    &lt;PackageReference Include="Sdcb.Arithmetic.Gmp.runtime.linux-x64" Version="*" /&gt;
  &lt;/ItemGroup&gt;
&lt;/Project&gt;
</code></pre>
<h3 id="72-å®¢ä¸²å®éªåå§è¾åºjsonl">7.2 å®¢ä¸²å®éªåå§è¾åºï¼JSONLï¼</h3>
<pre><code class="language-jsonl">{"lang":"csharp_bigint","bits":256,"op":"ADD_MOD","ops":1999872,"nsPerOp":146.261,"checksum":0}
{"lang":"csharp_bigint","bits":256,"op":"MUL_MOD","ops":499712,"nsPerOp":560.246,"checksum":0}
{"lang":"csharp_bigint","bits":256,"op":"MODPOW","ops":7936,"nsPerOp":169713.608,"checksum":0}
{"lang":"csharp_gmp_inplace","bits":256,"op":"ADD_MOD","ops":1999872,"nsPerOp":76.644,"checksum":0}
{"lang":"csharp_gmp_inplace","bits":256,"op":"MUL_MOD","ops":499712,"nsPerOp":114.690,"checksum":0}
{"lang":"csharp_gmp_inplace","bits":256,"op":"MODPOW","ops":7936,"nsPerOp":13931.914,"checksum":0}
{"lang":"csharp_bigint","bits":1024,"op":"ADD_MOD","ops":999424,"nsPerOp":297.335,"checksum":0}
{"lang":"csharp_bigint","bits":1024,"op":"MUL_MOD","ops":119808,"nsPerOp":4792.760,"checksum":0}
{"lang":"csharp_bigint","bits":1024,"op":"MODPOW","ops":1280,"nsPerOp":1938407.720,"checksum":0}
{"lang":"csharp_gmp_inplace","bits":1024,"op":"ADD_MOD","ops":999424,"nsPerOp":97.260,"checksum":0}
{"lang":"csharp_gmp_inplace","bits":1024,"op":"MUL_MOD","ops":119808,"nsPerOp":562.235,"checksum":0}
{"lang":"csharp_gmp_inplace","bits":1024,"op":"MODPOW","ops":1280,"nsPerOp":218715.147,"checksum":0}
{"lang":"csharp_bigint","bits":4096,"op":"ADD_MOD","ops":199680,"nsPerOp":1280.760,"checksum":0}
{"lang":"csharp_bigint","bits":4096,"op":"MUL_MOD","ops":19456,"nsPerOp":36894.568,"checksum":0}
{"lang":"csharp_bigint","bits":4096,"op":"MODPOW","ops":256,"nsPerOp":20617970.004,"checksum":0}
{"lang":"csharp_gmp_inplace","bits":4096,"op":"ADD_MOD","ops":199680,"nsPerOp":179.720,"checksum":0}
{"lang":"csharp_gmp_inplace","bits":4096,"op":"MUL_MOD","ops":19456,"nsPerOp":5431.441,"checksum":0}
{"lang":"csharp_gmp_inplace","bits":4096,"op":"MODPOW","ops":256,"nsPerOp":2662198.492,"checksum":0}
</code></pre>
<h3 id="73-å®¢ä¸²å¯è§åä»¥gmpä¸ºåºå">7.3 å®¢ä¸²å¯è§åï¼ä»¥GMPä¸ºåºåï¼</h3>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260114225617406-1423853952.png" alt="bar_gmp_baseline_add_mod" loading="lazy"><br>
<img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260114225622152-863625745.png" alt="bar_gmp_baseline_mul_mod" loading="lazy"><br>
<img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260114225625327-2119127781.png" alt="bar_gmp_baseline_modpow" loading="lazy"></p>
<hr>
<h2 id="æ»ç»ä¸å±æ">æ»ç»ä¸å±æ</h2>
<p>ä»è¿æ¬¡âç¡¬ç¢°ç¡¬âçå¯¹å³ä¸­ï¼æä»¬å¯ä»¥æ¸æ°å°çå°ï¼å¨åºç¡å æ³ä¸ï¼.NET <code>BigInteger</code> ä¸ Java ä¸åä¼¯ä»²ï¼ä½å¨ä¹æ³ï¼å°¤å¶æ¯<strong>æ¨¡å¹è¿ç®</strong>ï¼å¯¹å¯ç å­¦ç­åºæ¯æå¶éè¦ï¼ä¸ï¼.NET ç®åç¡®å®å­å¨ææ¾çç­æ¿ï¼å¤§å¹è½åäº Javaã</p>
<p>æ¿è®¤ä¸è¶³æ¯æ¹è¿çå¼å§ãå¯¹äºç»å¤§å¤æ°ä¸å¡åºæ¯ï¼åç½®ç <code>BigInteger</code> ä¾ç¶å¤ç¨ä¸æ¹ä¾¿ãä½å¦æä½ çåºç¨å¤äºæ§è½ææåºï¼å¦å å¯ç®æ³ãç§å­¦è®¡ç®ï¼ï¼é£ä¹ä¹è®¸æ¯æ¶åèèä¸äºâéæ­¦å¨âäºã</p>
<p>è¿ä¹æ­£æ¯æå¼åå¹¶ç»´æ¤ <strong><a href="https://github.com/sdcb/Sdcb.Arithmetic" target="_blank" rel="noopener nofollow">Sdcb.Arithmetic</a></strong> çåè¡·ãå®éè¿å°è£ GMP ç­é«æ§è½åçåºï¼ä¸º .NET å¸¦æ¥äº<strong>åå°ä¿®æ¹ï¼in-placeï¼</strong>ä»¥åé«è¾¾æ°åçæ§è½æåï¼å¦æä¸­å®éªæç¤ºï¼ãå¦æä½ å¯¹æ§è½ææè´è¿½æ±ï¼æèæ³çç .NET å¨å¤§æ°è®¡ç®ä¸çæéï¼æ¬¢è¿å» GitHub ç¹ä¸ª Star â­ï¼è¯ä¸è¯è¿ä¸ªåºã</p>
<p>æè°¢éè¯»ï¼å¦æä½ è§å¾è¿ä¸¤ä¸ªè¯­è¨çå¯¹æ¯åææææï¼æèå¯¹ .NET é«æ§è½ç¼ç¨æå´è¶£ï¼æ¬¢è¿å¨è¯è®ºåºçè¨äº¤æµï¼ä¹æ¬¢è¿å å¥æç <strong>.NETéªæä½ QQç¾¤ï¼495782587</strong>ï¼æä»¬ä¸èµ·æ¢ç´¢æ´å¤ææ¯ç¡¬æ ¸ç©æ³ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-15 08:50">2026-01-15 08:50</span>&nbsp;
<a href="https://www.cnblogs.com/sdcb">.NETéªæä½</a>&nbsp;
éè¯»(<span id="post_view_count">992</span>)&nbsp;
è¯è®º(<span id="post_comment_count">11</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19484525);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19484525', targetLink: 'https://www.cnblogs.com/sdcb/p/19484525/20261113-big-integer-dotnet-10-vs-java', title: 'ä¸æè·ä¸ªåï¼.NET 10 å¤§æ´æ°è®¡ç®å¯¹éµ Javaï¼ç»æä»¤äººæå¤' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Flinkæºç éè¯»ï¼JobManagerçHAæºå¶ ]]></title>
    <link>https://www.cnblogs.com/Jackeyzhe/p/19484622</link>
    <guid>426abbc2dbe37130daba894a07fe9ee8</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Jackeyzhe/p/19484622" title="åå¸äº 2026-01-14 23:45">
    <span role="heading" aria-level="2">Flinkæºç éè¯»ï¼JobManagerçHAæºå¶</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/1828322/202601/1828322-20260114234320282-1778052120.png" alt="Flinkæºç éè¯»ï¼JobManagerçHAæºå¶" class="desc_img">
        JobManager å¨ Flink éç¾¤ä¸­åæ¥çéè¦çä½ç¨ï¼åæ¬ä»»å¡è°åº¦åèµæºç®¡çç­å·¥ä½ãå¦æ JobManager å®æºï¼é£ä¹æ´ä¸ªéç¾¤çä»»å¡é½å°å¤±è´¥ãä¸ºäºè§£å³ JobManager çåç¹é®é¢ï¼Flink ä¹è®¾è®¡äº HA æºå¶æ¥ä¿éæ´ä¸ªéç¾¤çç¨³å®æ§ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>JobManager å¨ Flink éç¾¤ä¸­åæ¥çéè¦çä½ç¨ï¼åæ¬ä»»å¡è°åº¦åèµæºç®¡çç­å·¥ä½ãå¦æ JobManager å®æºï¼é£ä¹æ´ä¸ªéç¾¤çä»»å¡é½å°å¤±è´¥ãä¸ºäºè§£å³ JobManager çåç¹é®é¢ï¼Flink ä¹è®¾è®¡äº HA æºå¶æ¥ä¿éæ´ä¸ªéç¾¤çç¨³å®æ§ã</p>
<h3 id="åºæ¬æ¦å¿µ">åºæ¬æ¦å¿µ</h3>
<p>å¨ JobManager å¯å¨æ¶ï¼è°ç¨ <code>HighAvailabilityServicesUtils.createHighAvailabilityServices</code> æ¥åå»º HA æå¡ï¼HA ä¾èµçæå¡é½è¢«å°è£å¨ HighAvailabilityServices ä¸­ãå½å Flink åé¨æ¯æä¸¤ç§é«å¯ç¨æ¨¡å¼ï¼åå«æ¯ ZooKeeper å KUBERNETESã</p>
<pre><code class="language-java">case ZOOKEEPER:
    return createZooKeeperHaServices(configuration, executor, fatalErrorHandler);
case KUBERNETES:
    return createCustomHAServices(
            "org.apache.flink.kubernetes.highavailability.KubernetesHaServicesFactory",
            configuration,
            executor);
</code></pre>
<p>HighAvailabilityServices ä¸­æä¾çå³é®ç»ä»¶åæ¬ï¼</p>
<ul>
<li>
<p>LeaderRetrievalServiceï¼æå¡åç°ï¼ç¨äºè·åå½å leader çå°åãç®åç¨å°æå¡åç°çç»ä»¶æ ResourceManagerãDispatcherãJobManagerãClusterRestEndpointã</p>
</li>
<li>
<p>LeaderElectionï¼éä¸¾æå¡ï¼ä»å¤ä¸ªåéèä¸­éåºä¸ä¸ªä½ä¸º leaderãç¨å°éä¸¾æå¡çåæ ·æ¯ ResourceManagerãDispatcherãJobManagerãClusterRestEndpoint è¿åä¸ªã</p>
</li>
<li>
<p>CheckpointRecoveryFactoryï¼Checkpoint æ¢å¤ç»ä»¶çå·¥åç±»ï¼æä¾äºåå»º CompletedCheckpointStore å CheckpointIDCounter çæ¹æ³ãCompletedCheckpointStore æ¯ç¨äºå­å¨å·²å®æç checkpoint çåä¿¡æ¯ï¼CheckpointIDCounter æ¯ç¨äºçæ checkpoint IDã</p>
</li>
<li>
<p>ExecutionPlanStoreï¼ç¨äºå­å¨æ§è¡è®¡åã</p>
</li>
<li>
<p>JobResultStoreï¼ç¨äºå­å¨ä½ä¸ç»æï¼è¿éæä¸¤ç§ç¶æï¼ä¸ç§æ¯ dirtyï¼è¡¨ç¤ºä½ä¸æ²¡æè¢«å®å¨æ¸çï¼å¦ä¸ç§æ¯ cleanï¼è¡¨ç¤ºä½ä¸æ¸çå·¥ä½å·²ç»æ§è¡å®æäºã</p>
</li>
<li>
<p>BlobStoreï¼å­å¨ä½ä¸è¿è¡æé´çä¸äºäºè¿å¶æä»¶ã</p>
</li>
</ul>
<h4 id="éä¸¾æå¡">éä¸¾æå¡</h4>
<p>Flink çéä¸¾æ¯ä¾é  LeaderElection å LeaderContender éåå®æçãLeaderElection æ¯ LeaderElectionService çä»£çæ¥å£ï¼æä¾äºæ³¨ååéèãç¡®è®¤ leader å å¤æ­åéèæ¯å¦æ¯ leader ä¸ä¸ªæ¥å£ãLeaderContender åæ¯ç¨æ¥è¡¨ç¤ºåéèå¯¹è±¡ãå½ä¸ä¸ª LeaderContender å½é leader åï¼LeaderElectionService ä¼ä¸ºå¶çæä¸ä¸ª leaderSessionIdï¼LeaderContender ä¼è°ç¨ confirmLeadershipAsync åå¸èªå·±çå°åãéä¸¾æå¡çå·ä½å®ç°å¨ LeaderElectionDriver æ¥å£ä¸­ã</p>
<h4 id="æå¡åç°">æå¡åç°</h4>
<p>æå¡åç°çä½ç¨æ¯è·ååç»ä»¶ç leader å°åãæå¡åç°ä¾èµ LeaderRetrievalService å LeaderRetrievalListenerãLeaderRetrievalService å¯ä»¥å¯å¨ä¸ä¸ªçå¬ï¼å½ææ°ç leader å½éæ¶ï¼ä¼è°ç¨ LeaderRetrievalListener ç notifyLeaderAddress æ¹æ³ã</p>
<h4 id="ä¿¡æ¯ä¿å­">ä¿¡æ¯ä¿å­</h4>
<p>å½ leader åçåæ¢æ¶ï¼æ°ç leader éè¦è·åå°æ§ leader å­å¨çä¿¡æ¯ï¼è¿å°±éè¦æ§ leader æè¿äºä¿¡æ¯å­å¨ä¸ä¸ªå¬å±çå­å¨ä¸ãå®å¯ä»¥æ¯ ZooKeeper æ Kubernetes çå­å¨ï¼ä¹å¯ä»¥æ¯åå¸å¼æä»¶ç³»ç»çå­å¨ã</p>
<h3 id="åºäº-zookeeper-ç-ha">åºäº ZooKeeper ç HA</h3>
<h4 id="éä¸¾æå¡-1">éä¸¾æå¡</h4>
<p>åé¢æä»¬æå°äºéä¸¾æå¡ä¸»è¦ä¾èµ LeaderElection å LeaderContender éåå®æãæä»¬å°±ä»¥ JobManager ä¸ºä¾ï¼çä¸ä¸æºé ZooKeeper çéä¸¾æµç¨çå·ä½å®ç°ã</p>
<p><img alt="ZKLeaderElection" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1767924499/Blog/flink/20/ZKLeaderElection.png" class="lazyload"></p>
<p>å¾ä¸­ JobMasterServiceLeadershipRunner æ¯ LeaderContender çå®ç°ç±»ãå¨å¯å¨æå¡æ¶ï¼ä¼å LeaderElection æ³¨åèªå·±çä¿¡æ¯ï¼å®éæ§è¡èæ¯ DefaultLeaderElectionServiceãå®ååå»ºäº LeaderElectionDriverï¼ç¶åå° LeaderContender ä¿å­å¨ leaderContenderRegistry ä¸­ãéä¸¾çæ ¸å¿é»è¾å°è£å¨ LeaderElectionDriver ä¸­ã</p>
<p>å¨åå»º LeaderElectionDriver æ¶ï¼ä¼åå»º LeaderLatch å¯¹è±¡å TreeCache å¯¹è±¡ï¼ LeaderLatch å°è£äºä¸ ZooKeeper å³èçåè°ï¼ä¼æ¥æ¶ä¸ä¸ª LeaderElectionDriver ä½ä¸ºçå¬ãTreeCache ä¸»è¦ç¨äºçå¬ ZooKeeper ä¸­ leader èç¹çåæ´ã</p>
<pre><code class="language-java">public ZooKeeperLeaderElectionDriver(
        CuratorFramework curatorFramework, LeaderElectionDriver.Listener leaderElectionListener)
        throws Exception {
    ...
    this.leaderLatch = new LeaderLatch(curatorFramework, ZooKeeperUtils.getLeaderLatchPath());
    this.treeCache =
            ZooKeeperUtils.createTreeCache(
                    curatorFramework,
                    "/",
                    new ZooKeeperLeaderElectionDriver.ConnectionInfoNodeSelector());

    treeCache
            .getListenable()
            .addListener(
                    (client, event) -&gt; {
                        switch (event.getType()) {
                            case NODE_ADDED:
                            case NODE_UPDATED:
                                Preconditions.checkNotNull(
                                        event.getData(),
                                        "The ZooKeeper event data must not be null.");
                                handleChangedLeaderInformation(event.getData());
                                break;
                            case NODE_REMOVED:
                                Preconditions.checkNotNull(
                                        event.getData(),
                                        "The ZooKeeper event data must not be null.");
                                handleRemovedLeaderInformation(event.getData().getPath());
                                break;
                        }
                    });

    leaderLatch.addListener(this);
    ...
    leaderLatch.start();
    treeCache.start();
}
</code></pre>
<p>æä»¬è¿å¥å° LeaderLatch ç start æ¹æ³ãå®çåé¨æ¯å¨ ZooKeeper ä¸åå»º latch-xxx èç¹ãxxx æ¯å½å LeaderLatch ç IDï¼å®ç± ZooKeeper çæï¼ID æå°çå½é Leaderã</p>
<pre><code class="language-java">private void checkLeadership(List&lt;String&gt; children) throws Exception {
    if (this.debugCheckLeaderShipLatch != null) {
        this.debugCheckLeaderShipLatch.await();
    }

    String localOurPath = (String)this.ourPath.get();
    List&lt;String&gt; sortedChildren = LockInternals.getSortedChildren("latch-", sorter, children);
    int ourIndex = localOurPath != null ? sortedChildren.indexOf(ZKPaths.getNodeFromPath(localOurPath)) : -1;
    this.log.debug("checkLeadership with id: {}, ourPath: {}, children: {}", new Object[]{this.id, localOurPath, sortedChildren});
    if (ourIndex &lt; 0) {
        this.log.error("Can't find our node. Resetting. Index: " + ourIndex);
        this.reset();
    } else if (ourIndex == 0) {
        this.lastPathIsLeader.set(localOurPath);
        this.setLeadership(true);
    } else {
        this.setLeadership(false);
        String watchPath = (String)sortedChildren.get(ourIndex - 1);
        Watcher watcher = new Watcher() {
            public void process(WatchedEvent event) {
                if (LeaderLatch.this.state.get() == LeaderLatch.State.STARTED &amp;&amp; event.getType() == EventType.NodeDeleted) {
                    try {
                        LeaderLatch.this.getChildren();
                    } catch (Exception ex) {
                        ThreadUtils.checkInterrupted(ex);
                        LeaderLatch.this.log.error("An error occurred checking the leadership.", ex);
                    }
                }

            }
        };
        BackgroundCallback callback = new BackgroundCallback() {
            public void processResult(CuratorFramework client, CuratorEvent event) throws Exception {
                if (event.getResultCode() == Code.NONODE.intValue()) {
                    LeaderLatch.this.getChildren();
                }

            }
        };
        ((ErrorListenerPathable)((BackgroundPathable)this.client.getData().usingWatcher(watcher)).inBackground(callback)).forPath(ZKPaths.makePath(this.latchPath, watchPath));
    }

}
</code></pre>
<p>å½é Leader åï¼ä¼åè° LeaderElectionDriver ç isLeader æ¹æ³ï¼å¦ææªå½éï¼åç»§ç»­çå¬ latch èç¹çåæ´ãisLeader ä¼ç»§ç»­åè° LeaderElection ç onGrantLeadership æ¹æ³ï¼æ¥çè°ç¨ LeaderContender ç grantLeadershipãè¿æ¶ä¼å¯å¨ JobMaster æå¡ï¼ç¶åè°ç¨ LeaderElection ç confirmLeadershipAsync æ¥ç¡®è®¤å½éæåãç¡®è®¤çè¿ç¨æ¯ç± LeaderElectionDriver æ¥æ§è¡çãä¸»è¦ä½ç¨æ¯æå½å leader çä¿¡æ¯ååå° ZooKeeper ç connection_info èç¹ã</p>
<pre><code class="language-java">public void publishLeaderInformation(String componentId, LeaderInformation leaderInformation) {
    Preconditions.checkState(running.get());

    if (!leaderLatch.hasLeadership()) {
        return;
    }

    final String connectionInformationPath =
            ZooKeeperUtils.generateConnectionInformationPath(componentId);

    LOG.debug(
            "Write leader information {} for component '{}' to {}.",
            leaderInformation,
            componentId,
            ZooKeeperUtils.generateZookeeperPath(
                    curatorFramework.getNamespace(), connectionInformationPath));

    try {
        ZooKeeperUtils.writeLeaderInformationToZooKeeper(
                leaderInformation,
                curatorFramework,
                leaderLatch::hasLeadership,
                connectionInformationPath);
    } catch (Exception e) {
        leaderElectionListener.onError(e);
    }
}
</code></pre>
<h4 id="æå¡åç°-1">æå¡åç°</h4>
<p>æ¢³çå®éä¸¾æå¡çæºç åï¼æä»¬åæ¥çä¸ä¸æå¡åç°çè¿ç¨ãæä»¬ä»¥ TaskManager è·å JobManager ç leader ä¸ºä¾ã</p>
<p><img alt="ZKLeaderRetrieval" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1767929447/Blog/flink/20/ZKLeaderRetrieval.png" class="lazyload"></p>
<p>å½æä»¬å¾ TaskManager æ·»å ä»»å¡æ¶ï¼ä¼è°ç¨ JobLeaderService ç addJob æ¹æ³ãè¿éä¼åè·å LeaderRetrievalï¼ç¶åè°ç¨ start æ¹æ³æ³¨å LeaderRetrievalListener çå¬ï¼å¹¶åå»º LeaderRetrievalDriverãå¨ LeaderRetrievalDriver ä¸­ä¸»è¦æ¯å ZooKeeper æ³¨å connection_info èç¹çåæ´ã</p>
<p>å¦æåçåæ´ï¼ZooKeeper ä¼åè° <code>LeaderRetrievalDriver.retrieveLeaderInformationFromZooKeeper</code> æ¹æ³ãæä»¬ä» ZooKeeper è·åå° leader çå°åå sessionId åï¼å°±åè° <code>LeaderRetrievalService.notifyLeaderAddress</code> æ¹æ³ãæç»è°ç¨å° JobLeaderService ç notifyLeaderAddress æ¹æ³ï¼è¿ä¸ªæ¹æ³ä¸­å°±æ¯æ­å¼ä¸æ§ leader çè¿æ¥ï¼å¢å ä¸æ° leader çè¿æ¥ã</p>
<h4 id="ä¿¡æ¯ä¿å­-1">ä¿¡æ¯ä¿å­</h4>
<p>æåæä»¬åæ¥çä¿¡æ¯ä¿å­ç¸å³çæºç ãå¨ JobManager å®æä¸æ¬¡ Checkpoint æ¶ï¼ä¼æ§è¡ <code>CheckpointCoordinator.completePendingCheckpoint</code> æ¹æ³ï¼è·éè°ç¨é¾è·¯å¯ä»¥æ¾å° <code>ZooKeeperStateHandleStore.addAndLock</code> æ¹æ³ï¼è¿éä¼æç¶æåå¥å°æä»¶ç³»ç»ä¸­ï¼ç¶åææä»¶è·¯å¾ä¿å­å¨ ZooKeeper ä¸­ã</p>
<pre><code class="language-java">public RetrievableStateHandle&lt;T&gt; addAndLock(String pathInZooKeeper, T state)
        throws PossibleInconsistentStateException, Exception {
    checkNotNull(pathInZooKeeper, "Path in ZooKeeper");
    checkNotNull(state, "State");
    final String path = normalizePath(pathInZooKeeper);
    final Optional&lt;Stat&gt; maybeStat = getStat(path);

    if (maybeStat.isPresent()) {
        if (isNotMarkedForDeletion(maybeStat.get())) {
            throw new AlreadyExistException(
                    String.format("ZooKeeper node %s already exists.", path));
        }

        Preconditions.checkState(
                releaseAndTryRemove(path),
                "The state is marked for deletion and, therefore, should be deletable.");
    }

    final RetrievableStateHandle&lt;T&gt; storeHandle = storage.store(state);
    final byte[] serializedStoreHandle = serializeOrDiscard(storeHandle);
    try {
        writeStoreHandleTransactionally(path, serializedStoreHandle);
        return storeHandle;
    } catch (KeeperException.NodeExistsException e) {
        // Transactions are not idempotent in the curator version we're currently using, so it
        // is actually possible that we've re-tried a transaction that has already succeeded.
        // We've ensured that the node hasn't been present prior executing the transaction, so
        // we can assume that this is a result of the retry mechanism.
        return storeHandle;
    } catch (Exception e) {
        if (indicatesPossiblyInconsistentState(e)) {
            throw new PossibleInconsistentStateException(e);
        }
        // In case of any other failure, discard the state and rethrow the exception.
        storeHandle.discardState();
        throw e;
    }
}
</code></pre>
<p>è³æ­¤ï¼åºäº ZooKeeper ç HA é»è¾æä»¬å°±æ¢³çå®äºãä» 1.12 çæ¬å¼å§ï¼Flink è¿æ¯æäº Kubernetes é«å¯ç¨ï¼ä¸é¢æä»¬åæ¥ä¸ä¸å®æ¯å¦ä½å®ç°çã</p>
<h3 id="åºäº-kubernetes-ç-ha">åºäº Kubernetes ç HA</h3>
<h4 id="éä¸¾æå¡-2">éä¸¾æå¡</h4>
<p>éè¿åé¢çå­¦ä¹ ï¼æä»¬å·²ç»äºè§£å°ï¼éä¸¾çä¸»è¦é»è¾æ¯å¨ LeaderElectionDriver ä¸­ï¼å æ­¤ï¼æä»¬ç´æ¥æ¥ç KubernetesLeaderElectionDriver çé»è¾å³å¯ãåå»º KubernetesLeaderElectionDriver æ¶ï¼åå»ºå¹¶å¯å¨äº KubernetesLeaderElectorãè¿ä¸ªç±»ä¼¼äº ZooKeeper é»è¾ä¸­ LeaderLatchï¼ä¼è· Kubernetes åºå±çéä¸¾é»è¾äº¤äºï¼åæ¶æ³¨åçå¬ã</p>
<pre><code class="language-java">public KubernetesLeaderElector(
        NamespacedKubernetesClient kubernetesClient,
        KubernetesLeaderElectionConfiguration leaderConfig,
        LeaderCallbackHandler leaderCallbackHandler,
        ExecutorService executorService) {
    this.kubernetesClient = kubernetesClient;
    this.leaderElectionConfig =
            new LeaderElectionConfigBuilder()
                    .withName(leaderConfig.getConfigMapName())
                    .withLeaseDuration(leaderConfig.getLeaseDuration())
                    .withLock(
                            new ConfigMapLock(
                                    new ObjectMetaBuilder()
                                            .withNamespace(kubernetesClient.getNamespace())
                                            .withName(leaderConfig.getConfigMapName())
                                            // Labels will be used to clean up the ha related
                                            // ConfigMaps.
                                            .withLabels(
                                                    KubernetesUtils.getConfigMapLabels(
                                                            leaderConfig.getClusterId()))
                                            .build(),
                                    leaderConfig.getLockIdentity()))
                    .withRenewDeadline(leaderConfig.getRenewDeadline())
                    .withRetryPeriod(leaderConfig.getRetryPeriod())
                    .withReleaseOnCancel(true)
                    .withLeaderCallbacks(
                            new LeaderCallbacks(
                                    leaderCallbackHandler::isLeader,
                                    leaderCallbackHandler::notLeader,
                                    newLeader -&gt;
                                            LOG.info(
                                                    "New leader elected {} for {}.",
                                                    newLeader,
                                                    leaderConfig.getConfigMapName())))
                    .build();
    this.executorService = executorService;

    LOG.info(
            "Create KubernetesLeaderElector on lock {}.",
            leaderElectionConfig.getLock().describe());
}
</code></pre>
<p>éä¸¾æååï¼ä¼åè° <code>LeaderElectionListener.onGrantLeadership</code> æ¹æ³ãåç»­çè°ç¨é¾è·¯è¿æ¯ä¼è°ç¨å° <code>KubernetesLeaderElectionDriver.publishLeaderInformation</code> æ¹æ³ãè¿ä¸ªæ¹æ³æ¯æ leader ä¿¡æ¯åå° Kubernetes ç configMap ä¸­ã</p>
<pre><code class="language-java">public void publishLeaderInformation(String componentId, LeaderInformation leaderInformation) {
    Preconditions.checkState(running.get());

    try {
        kubeClient
                .checkAndUpdateConfigMap(
                        configMapName,
                        updateConfigMapWithLeaderInformation(componentId, leaderInformation))
                .get();
    } catch (InterruptedException | ExecutionException e) {
        leaderElectionListener.onError(e);
    }

    LOG.debug(
            "Successfully wrote leader information {} for leader {} into the config map {}.",
            leaderInformation,
            componentId,
            configMapName);
}
</code></pre>
<h4 id="æå¡åç°-2">æå¡åç°</h4>
<p>æå¡åç°çé»è¾å¨ KubernetesLeaderRetrievalDriver ç±»ä¸­ï¼å¨åå»ºæ¶ï¼ä¼å°åé¨ç±» ConfigMapCallbackHandlerImpl æ³¨åä¸ºçå¬åè°ç±»ã</p>
<p>å½ configMap ææ°å¢æåæ´åï¼ä¼åè° <code>LeaderRetrievalService.notifyLeaderAddress</code> æ¹æ³ã</p>
<pre><code class="language-java">private class ConfigMapCallbackHandlerImpl
        implements FlinkKubeClient.WatchCallbackHandler&lt;KubernetesConfigMap&gt; {

    @Override
    public void onAdded(List&lt;KubernetesConfigMap&gt; configMaps) {
        // The ConfigMap is created by KubernetesLeaderElectionDriver with
        // empty data. We don't really need to process anything unless the retriever was started
        // after the leader election has already succeeded.
        final KubernetesConfigMap configMap = getOnlyConfigMap(configMaps, configMapName);
        final LeaderInformation leaderInformation = leaderInformationExtractor.apply(configMap);
        if (!leaderInformation.isEmpty()) {
            leaderRetrievalEventHandler.notifyLeaderAddress(leaderInformation);
        }
    }

    @Override
    public void onModified(List&lt;KubernetesConfigMap&gt; configMaps) {
        final KubernetesConfigMap configMap = getOnlyConfigMap(configMaps, configMapName);
        leaderRetrievalEventHandler.notifyLeaderAddress(
                leaderInformationExtractor.apply(configMap));
    }
    ...
}
</code></pre>
<h4 id="ä¿¡æ¯ä¿å­-2">ä¿¡æ¯ä¿å­</h4>
<p>ä¿¡æ¯ä¿å­çé»è¾å ZooKeeper ä¹éå¸¸ç±»ä¼¼ãå³åæ state ä¿å­å¨æä»¶ç³»ç»ï¼ç¶åæå­å¨è·¯å¾åå° Kubernetes åå° configMap ä¸­ãå·ä½å¯ä»¥ç <code>KubernetesStateHandleStore.addAndLock</code> æ¹æ³ã</p>
<h3 id="æ»ç»">æ»ç»</h3>
<p>æ¬ææä»¬ä¸èµ·æ¢³çäº Flink ä¸­ JobManager ç HA æºå¶ç¸å³æºç ãç®å Flink æ¯æ ZooKeeper å Kubernetes ä¸¤ç§å®ç°ãå¨æ¢³çè¿ç¨ä¸­ï¼æä»¬ä»¥ JobManager ä¸ºä¾ï¼å¶ä»å ä¸ªç¨å°é«å¯ç¨çæå¡çéä¸¾é»è¾ä¹æ¯ä¸æ ·çã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 23:46">2026-01-14 23:45</span>&nbsp;
<a href="https://www.cnblogs.com/Jackeyzhe">Jackeyzhe</a>&nbsp;
éè¯»(<span id="post_view_count">15</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19484622);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19484622', targetLink: 'https://www.cnblogs.com/Jackeyzhe/p/19484622', title: 'Flinkæºç éè¯»ï¼JobManagerçHAæºå¶' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å°ç½å­¦AIå¼å01ï¼åå»ºç¬¬ä¸ä¸ªç¤ºä¾Agent ]]></title>
    <link>https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l</link>
    <guid>445f0dafcb9d3942e311ecccb283a175</guid>
    <description>
    <![CDATA[ 
    <a name="top"></a>
    <h2><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l" title="åå¸äº 2026-01-14 23:43">
    <span role="heading" aria-level="2">å°ç½å­¦AIå¼å01ï¼åå»ºç¬¬ä¸ä¸ªç¤ºä¾Agent</span>
    

</a>
</h2>
    <small>
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 23:43">2026-01-14 23:43</span>&nbsp;
<a href="https://www.cnblogs.com/jyzhao">AlfredZhao</a>&nbsp;
éè¯»(<span id="post_view_count">20</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19484508);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19484508', targetLink: 'https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l', title: 'å°ç½å­¦AIå¼å01ï¼åå»ºç¬¬ä¸ä¸ªç¤ºä¾Agent' })">ä¸¾æ¥</a>
</small>
    <div class="entry">
        <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨ LangChain å¼åä¸­ï¼æä»¬çæ ¸å¿å·¥ä½æ¯å Promptï¼æç¤ºè¯ï¼ã</p>
<p>é¤æ­¤ä¹å¤ï¼è¿éè¦äºè§£ä¸pythonåºç¡ï¼ç®åäºè§£å³å¯ï¼ä¸éè¦ç³»ç»å­¦ä¹ ï¼è¿å°±æ¯AIæ¶ä»£å¯¹ææ¯ç±å¥½èççº¢å©ã</p>
<h2 id="01--æå»ºç¬ç«çpythonç¯å¢">01 | æå»ºç¬ç«çpythonç¯å¢</h2>
<p>ä½¿ç¨minicondaæå»ºç¬ç«çpythonç¯å¢ã</p>
<p>å®æ¹ç½ç«ï¼<a href="https://www.anaconda.com/" target="_blank" rel="noopener nofollow">https://www.anaconda.com/</a></p>
<p>éæ©éåä½ çï¼æè¿éç´æ¥éæ©å¾å½¢åå®è£çMinicondaï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202601/635610-20260114224646258-840865368.jpg" alt="" loading="lazy"></p>
<p>ä¸è½½åå®è£ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202601/635610-20260114224646142-163182582.jpg" alt="" loading="lazy"></p>
<p>å³é­å¹¶éæ°æå¼ç»ç«¯ãæ­¤æ¶ä½ ä¼çå°å½ä»¤è¡åé¢å¤äºä¸ª (base)ï¼è¿è¯´æ Conda å·²ç»æ¥ç®¡äºç¯å¢ã</p>
<p>ç¶ååå»º Python 3.12 ä¸å±å­¦ä¹ ç¯å¢ï¼</p>
<pre><code class="language-BASH"># åå»ºç¯å¢å¹¶æå® Python çæ¬
conda create -n lc python=3.12 -y

# æ¿æ´»ç¯å¢
conda activate lc
</code></pre>
<p>Tipsï¼å¦æåå»ºç¯å¢ï¼éå°è®©åææå¡/æ¡æ¬¾ä¹ç±»ï¼ç´æ¥ææç¤ºå½ä»¤æ§è¡åæå³å¯ã</p>
<p>åé¢æµè¯ä¸ååè½çpythonç¨åºè¯å®åä¸äºå¼ç¨åç§ç±»åçåï¼æä»¬ç»ä¸æ¾å° requirements.txt ä¸­ï¼åç»­æ°ç¯å¢ä¹å¯ä»¥ç´æ¥ä¸é®å®è£éè¦å¼å¥çç¸å³åã</p>
<pre><code class="language-BASH">pip install -r requirements.txt
</code></pre>
<p>å®æç»´æ¤requirements.txtæä»¶ï¼</p>
<pre><code class="language-BASH">langchain
langchain-openai
python-dotenv
</code></pre>
<h2 id="02--åå»ºç¬¬ä¸ä¸ªç¤ºä¾agent">02 | åå»ºç¬¬ä¸ä¸ªç¤ºä¾Agent</h2>
<p>è¿éä»¿ç§LangChainå®æ¹ææ¡£ï¼æå»ºä¸ä¸ªç®åçAgentã</p>
<ul>
<li><a href="https://docs.langchain.com/oss/python/langchain/quickstart" target="_blank" rel="noopener nofollow">https://docs.langchain.com/oss/python/langchain/quickstart</a></li>
</ul>
<p>å ä¸ºç¬èææ¶æ²¡æClaudeæ¨¡åå¯ç¨ï¼æä»¥æ¿æ¢ä¸ºå½åçæ¨¡åï¼å¨æä»¬å­¦ä¹ æµè¯é¶æ®µï¼åºæ¬æ¯æ²¡å¥å½±åçã</p>
<p>vi basic.py</p>
<pre><code class="language-python">import os
from dotenv import load_dotenv
from langchain.agents import create_agent
from langchain_openai import ChatOpenAI
from langchain.tools import tool

# å è½½ .env æä»¶ä¸­ç SILICONFLOW_API_KEY
load_dotenv()

# 1. å®ä¹å·¥å·ï¼å¿é¡»è¦åæ¸æ°ç Docstringï¼å½æ°æ³¨éï¼
@tool
def get_weather(city: str) -&gt; str:
    """è·åæå®åå¸çå®æ¶å¤©æ°æåµã"""
    return f"{city} çå¤©æ°æ»æ¯é´é¨è¿è¿ï¼"

# 2. åå§å SiliconFlow æ¨¡å
llm = ChatOpenAI(
    model="deepseek-ai/DeepSeek-V3", 
    api_key=os.getenv("SILICONFLOW_API_KEY"),
    base_url="https://api.siliconflow.cn/v1",
    temperature=0.1
)

# 3. åå»º Agent
agent = create_agent(
    model=llm,
    tools=[get_weather],
    system_prompt="ä½ æ¯ä¸ä¸ªä¹äºå©äººçå¤©æ°å©æã"
)

# 4. è¿è¡
if __name__ == "__main__":
    response = agent.invoke(
        {"messages": [{"role": "user", "content": "åäº¬å¤©æ°æä¹æ ·ï¼"}]}
    )
    # æå°æåä¸æ¡æ¶æ¯ï¼AI çåç­ï¼
    print(response["messages"][-1].content)
</code></pre>
<h2 id="03--å¢å¼ºè¿ä¸ªç¤ºä¾agent">03 | å¢å¼ºè¿ä¸ªç¤ºä¾Agent</h2>
<p>æ±åå¹¶ç¨å¾®æ¹é ä¸å®æ¹çç¤ºä¾ï¼ä½¿å¶éç¨äºæä»¬çæµè¯ç¯å¢ï¼</p>
<p>vi enhance.py</p>
<pre><code class="language-PYTHON">import os
from dataclasses import dataclass
from dotenv import load_dotenv

from langchain_openai import ChatOpenAI
from langchain.agents import create_agent
from langchain.tools import tool, ToolRuntime
from langgraph.checkpoint.memory import InMemorySaver
from langchain.agents.structured_output import ToolStrategy

load_dotenv()

# 1. å®ä¹ç³»ç»æç¤ºè¯ï¼è¦æ± AI åä¸ªâè°é³æ¢âä¸å®¶ï¼
SYSTEM_PROMPT = """ä½ æ¯ä¸ä½ä¸ä¸çèµæ·±å¤©æ°é¢æ¥åï¼è¯´è¯æå¶å¹½é»ï¼ç¹å«åæ¬¢è®²âè°é³æ¢âã

ä½ ææä½¿ç¨ä»¥ä¸ä¸¤ä¸ªå·¥å·ï¼
- get_weather_for_location: è·åç¹å®åå¸çå¤©æ°ã
- get_user_location: è·åå½åç¨æ·çæå¨å°ã

å¦æç¨æ·è¯¢é®å¤©æ°ï¼è¯·å¡å¿ç¡®è®¤å°ç¹ãå¦æç¨æ·è¯´çæ¯âæè¿å¿âæâæè¿éâï¼è¯·è°ç¨ get_user_location è·åä»ä»¬çä½ç½®ã"""

# 2. å®ä¹ä¸ä¸æç»æï¼å­å¨ç¨æ·ä¿¡æ¯ï¼
@dataclass
class Context:
    """èªå®ä¹è¿è¡æ¶ä¸ä¸æã"""
    user_id: str

# 3. å®ä¹å·¥å·
@tool
def get_weather_for_location(city: str) -&gt; str:
    """è·åæå®åå¸çå¤©æ°æåµã"""
    return f"{city} çå¤©æ°æ»æ¯é³åç¿çï¼"

@tool
def get_user_location(runtime: ToolRuntime[Context]) -&gt; str:
    """æ ¹æ®ç¨æ· ID è·åå¶å°çä½ç½®ã"""
    user_id = runtime.context.user_id
    # æ¨¡ææ°æ®åºï¼ç¨æ· 1 å¨åäº¬ï¼å¶ä»å¨ç æµ·
    return "åäº¬" if user_id == "1" else "ç æµ·"

# 4. éç½®ä½ çæ¨¡å (SiliconFlow)
model = ChatOpenAI(
    model="deepseek-ai/DeepSeek-V3",
    api_key=os.getenv("SILICONFLOW_API_KEY"),
    base_url="https://api.siliconflow.cn/v1",
    temperature=0.7  # ç¨å¾®æé«éæºæ§ï¼è®©è°é³æ¢æ´æåæ
)

# 5. å®ä¹ååºæ ¼å¼ï¼æ±åå­æ®µæè¿°ï¼è®© AI æç½å¡«ä»ä¹ï¼
@dataclass
class ResponseFormat:
    """Agent çç»æååå¤æ ¼å¼ã"""
    # å¹½é»çè°é³æ¢åå¤
    punny_response: str
    # ä»»ä½å³äºå¤©æ°çæè¶£ä¿¡æ¯ï¼å¦ææçè¯ï¼
    weather_conditions: str | None = None

# 6. è®¾ç½®è®°å¿å­å¨
checkpointer = InMemorySaver()

# 7. åå»º Agent
agent = create_agent(
    model=model,
    system_prompt=SYSTEM_PROMPT,
    tools=[get_user_location, get_weather_for_location],
    context_schema=Context,
    response_format=ToolStrategy(ResponseFormat),
    checkpointer=checkpointer
)

# --- è¿è¡æµè¯ ---

# è®¾ç½®ä¼è¯ ID
config = {"configurable": {"thread_id": "test_user_001"}}

# ç¬¬ä¸æ¬¡æé®
print("--- ç¬¬ä¸æ¬¡å¯¹è¯ ---")
response = agent.invoke(
    {"messages": [{"role": "user", "content": "å¤é¢å¤©æ°æä¹æ ·ï¼"}]},
    config=config,
    context=Context(user_id="1")
)

# è®¿é®ç»æåç»æ
res = response['structured_response']
print(f"AI: {res.punny_response}")
print(f"è¯¦æ: {res.weather_conditions}")

print("\n--- ç¬¬äºæ¬¡å¯¹è¯ï¼æµè¯è®°å¿ï¼ ---")
# ç¬¬äºæ¬¡æé®
response = agent.invoke(
    {"messages": [{"role": "user", "content": "è°¢è°¢ä½ ï¼æå¨åªéï¼"}]},
    config=config,
    context=Context(user_id="1")
)

res = response['structured_response']
print(f"AI: {res.punny_response}")
</code></pre>
<p>è¿æ®µç¤ºä¾ä»£ç çæ ¸å¿é»è¾æ¯ï¼</p>
<p><strong>ç¬¬ä¸æ¬¡å¯¹è¯ï¼</strong></p>
<p>ç¨æ·é®ï¼âå¤é¢å¤©æ°æä¹æ ·ï¼âï¼æ²¡è¯´å°ç¹ï¼ã<br>
AI æèï¼ç³»ç»æç¤ºè¯åè¯æï¼å¦æå°ç¹ä¸æï¼åå»æ¥ç¨æ·å¨åªã<br>
å¨ä½ï¼AI è°ç¨ get_user_location -&gt; å¾å°âåäº¬â -&gt; è°ç¨ get_weather_for_location -&gt; å¾å°å¤©æ°ã<br>
åå¤ï¼æ ¹æ® ResponseFormat ååºä¸ä¸ªè°é³æ¢ã</p>
<p><strong>ç¬¬äºæ¬¡å¯¹è¯ï¼</strong></p>
<p>ç¨æ·é®ï¼âè°¢è°¢ä½ ï¼æå¨åªéï¼â<br>
AI æèï¼ç±äºæ thread_id å checkpointerï¼AI è®°å¾ä¸ä¸æ¬¡æ¥è¯¢çç»æã<br>
å¨ä½ï¼å®ä¸éè¦åæ¬¡æ¥å·¥å·ï¼ç´æ¥ä»è®°å¿éæåä¿¡æ¯å¹¶åå¤ã</p>
<p>ç¶åæå·¥å°ä»£ç ä¸­ç user_id æ¹ä¸º2ï¼åæ¬¡è¿è¡ï¼å°±ä¼æ ¹æ®å·¥å· <code>get_user_location</code> ä¸­çç¤ºä¾é»è¾ï¼å¾å°å°ç¹ä¸ºâç æµ·âï¼ä¸¤æ¬¡æ§è¡çææåèå¦ä¸ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202601/635610-20260114224646132-69223909.jpg" alt="" loading="lazy"></p>
<p>è¯¥æ®µç¤ºä¾ä»£ç è½ç¶ç®åï¼ä½å¶å®å·²ç»è½å±ç°åºä¸ä¸ªä¼ä¸çº§ AI æºè½ä½ï¼Agentï¼çç¼©å½±ãå®æ¶µçäºç°ä»£ AI å¼åä¸­ææ ¸å¿çä¸ä¸ªæ¯æ±ï¼å·¥å·è°ç¨ï¼Tool Useï¼ãä¸ä¸æè®°å¿ï¼Memoryï¼ãä»¥åç»æåè¾åºï¼Structured Outputï¼ã</p>

</div>
<div id="MySignature" role="contentinfo">
    <a href="https://www.cnblogs.com/jyzhao/" target="_blank">AlfredZhao</a>Â©çæææãä»Oracleèµ·èªï¼é¢ç¥ç²¾å½©çITææ¯ãã<br>
è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l" target="_blank">https://www.cnblogs.com/jyzhao/p/19484508/xiao-bai-xueai-kai-fa01-chuang-jian-di-yi-ge-shi-l</a>
<hr>
<div style="text-align:center; margin-top:30px;">
  <p style="font-size:14px;color:#555;">
    ð æè°¢éè¯»ï¼æ¬¢è¿å³æ³¨æçå¬ä¼å· <b>ãèµµéå®ã</b>
  </p>
  <img src="https://images.cnblogs.com/cnblogs_com/jyzhao/824234/o_250208075013_qrcode-zjy.jpg" width="160" style="border:1px solid #ddd;border-radius:8px;">
</div>
</div>
<div class="clear"></div>

        <div class="clear"></div>
        
</div>
    <ul class="postmetadata">
        <vc:categories-tags blog-app="jyzhao" blog-id="186567" post-id="19484508"></vc:categories-tags>
    </ul>
 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ è¿é¶æå·§ï¼å¨Dashåºç¨ä¸­ç´æ¥ä½¿ç¨åçReactç»ä»¶ ]]></title>
    <link>https://www.cnblogs.com/feffery/p/19486989</link>
    <guid>04e9a5ae9dd214d6ab24a1926209f083</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/feffery/p/19486989" title="åå¸äº 2026-01-15 13:56">
    <span role="heading" aria-level="2">è¿é¶æå·§ï¼å¨Dashåºç¨ä¸­ç´æ¥ä½¿ç¨åçReactç»ä»¶</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<center style="font-size: 18px; font-weight: bold; padding-top: 40px">æ´å¤Dashåºç¨å¼åå¹²è´§ç¥è¯ãæ¡ä¾ï¼æ¬¢è¿å³æ³¨âç©è½¬Dashâå¾®ä¿¡å¬ä¼å·ð</center>
<p><img src="https://img2024.cnblogs.com/blog/1344061/202507/1344061-20250703190053776-1837084116.png" alt="image" loading="lazy"></p>
<h1 id="1-ç®ä»">1 ç®ä»</h1>
<p>å¤§å®¶å¥½ææ¯è´¹èå¸ãä½ä¸ºä¸ä¸ª<code>Python</code>æ¡æ¶ï¼æä»¬æ¥å¸¸å¨ä½¿ç¨<code>Dash</code>æå»ºåç§åºç¨çè¿ç¨ä¸­ï¼ä¸»æµå¸¸è§çåè½å¯ä»¥å©ç¨<code>Dash</code>çæä¸­ä¸°å¯ç<em>ç»ä»¶åº</em>ã<em>å·¥å·åº</em>ç­èµæºï¼éè¿ç¼å<code>Python</code>ä»£ç å®ç°<em>å¨æ åºç¨å¼å</em>ï¼ä¹å¯ä»¥é¢å¤éå<code>Dash</code>ä¸­ç<em>æµè§å¨ç«¯åè°</em>ï¼å¨<code>Dash</code>ä¸­å¾æ¹ä¾¿çè°ç¨<code>Echarts</code>ç­<em>åçJavaScript</em>åºå®ç°åç§<em>ç¹æ®åè½æå±</em>ã</p>
<p>é¤äºè¿äºå¸¸ç¨å½¢å¼ä»¥å¤ï¼æä»¬è¿å¯ä»¥åºäºä»å¤©æç« ä¸­è¦ç»å¤§å®¶ä»ç»ç<code>Dash</code>æä»¶<code>dash-vite-plugin</code>ï¼å®ç°å°éåç<code>JavaScript</code>åºè­¬å¦<code>React</code>ç­ä¼ ç»åç«¯æ¡æ¶ç¸å³çåè½é»è¾ï¼è½»æ¾æ´åå°æä»¬ç<code>Dash</code>åºç¨ä¸­ï¼è¿ä¸æ­¥æå<code>Dash</code>åºç¨åè½å¼åçä¸éð~</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260115134532456-1814849130.jpg"></center>
<h1 id="2-dash-vite-pluginæä»¶çä½¿ç¨">2 dash-vite-pluginæä»¶çä½¿ç¨</h1>
<p><code>dash-vite-plugin</code>é¡¹ç®å°åï¼æ¬¢è¿â­æ¯ææä»¬ï¼</p>
<ul>
<li>Githubä»åºï¼<a href="https://github.com/HogaStack/dash-vite-plugin" target="_blank" rel="noopener nofollow">https://github.com/HogaStack/dash-vite-plugin</a></li>
<li>Giteeéååæ­¥ä»åºï¼<a href="https://gitee.com/insistence2022/dash-vite-plugin" target="_blank" rel="noopener nofollow">https://gitee.com/insistence2022/dash-vite-plugin</a></li>
</ul>
<p>ä½ä¸º<code>Dash</code>åºç¨çæä»¶ï¼æä»¬å¯ä»¥ç´æ¥éè¿<code>pip</code>å¯¹<code>dash-vite-plugin</code>è¿è¡å®è£ï¼</p>
<pre><code class="language-bash">pip install dash-vite-plugin -U
</code></pre>
<p>å®æå®è£åï¼æä»¬ç´æ¥æ¥çå ä¸ªå®éåºç¨æ¡ä¾ï¼å®ä»¬å¯¹åºçå®æ´æºç ä½ å¯ä»¥å¨ðä¸é¢æå°çé¡¹ç®ä»åºä¸­ç<code>examples</code>ç®å½ä¸æ¾å°ï¼</p>
<h2 id="ç¤ºä¾åºç¨1shinytextç¹æ">ç¤ºä¾åºç¨1ï¼ShinyTextç¹æ</h2>
<p>è¿ä¸ªä¾å­åºäºéå¸¸æµè¡ç<code>React</code>å¨ç»ææåº<code>react-bits</code>ä¸­ç<code>ShinyText</code>ç»ä»¶ï¼ <a href="https://reactbits.dev/text-animations/shiny-text" target="_blank" rel="noopener nofollow">https://reactbits.dev/text-animations/shiny-text</a> ï¼ã</p>
<p>å¯¹åº<code>dash-vite-plugin</code>æºç ä»åºä¸­ç<code>examples/react-bits-shiny-text-demo</code>é¡¹ç®ï¼<code>python app.py</code>å¯å¨åï¼åå§æ§è¡éè¦ç¨ç­ä¸ä¼ï¼ç­å¾ç»ç«¯æç¤ºç¸å³æå»ºå®æåï¼è®¿é®æ¬æº<code>http://127.0.0.1:8050</code>å°±å¯ä»¥çå°å¦ä¸ææï¼å®ç¾è¿åäº<code>react-bits</code>ä¸­çæå­æ«åç¹æç»ä»¶åè½ï¼</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260115135151996-1596881536.gif"></center>
<h2 id="ç¤ºä¾åºç¨2lightningç¹æ">ç¤ºä¾åºç¨2ï¼Lightningç¹æ</h2>
<p>è¿ä¸ªä¾å­åºäº<code>react-bits</code>ä¸­ç<code>Lightning</code>ç»ä»¶ï¼ <a href="https://reactbits.dev/backgrounds/lightning" target="_blank" rel="noopener nofollow">https://reactbits.dev/backgrounds/lightning</a> ï¼ã</p>
<p>å¯¹åº<code>dash-vite-plugin</code>æºç ä»åºä¸­ç<code>examples/react-bits-lightning-demo</code>é¡¹ç®ï¼å®ç¾è¿åäº<code>react-bits</code>ä¸­çé·çµå¨æèæ¯ç»ä»¶ææï¼</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260115135155979-1022491345.gif"></center>
<h2 id="ç¤ºä¾åºç¨3gridscanç¹æ">ç¤ºä¾åºç¨3ï¼GridScanç¹æ</h2>
<p>è¿ä¸ªä¾å­åºäº<code>react-bits</code>ä¸­ç<code>GridScan</code>ç»ä»¶ï¼ <a href="https://reactbits.dev/backgrounds/grid-scan" target="_blank" rel="noopener nofollow">https://reactbits.dev/backgrounds/grid-scan</a> ï¼ã</p>
<p>å¯¹åº<code>dash-vite-plugin</code>æºç ä»åºä¸­ç<code>examples/react-bits-grid-scan-demo</code>é¡¹ç®ï¼å®ç¾è¿åäº<code>react-bits</code>ä¸­é¢å·èµåæåé£æ ¼çç½æ ¼æ«åèæ¯ç»ä»¶ææï¼</p>
<center><img src="https://img2024.cnblogs.com/blog/1344061/202601/1344061-20260115135159305-223594499.gif"></center>
<hr>
<p>æå³<code>dash-vite-plugin</code>çä½¿ç¨è¯´æè¯¦è§é¡¹ç®ä»åºææ¡£ï¼</p>
<ul>
<li>Githubä»åºï¼<a href="https://github.com/HogaStack/dash-vite-plugin" target="_blank" rel="noopener nofollow">https://github.com/HogaStack/dash-vite-plugin</a></li>
<li>Giteeéååæ­¥ä»åºï¼<a href="https://gitee.com/insistence2022/dash-vite-plugin" target="_blank" rel="noopener nofollow">https://gitee.com/insistence2022/dash-vite-plugin</a></li>
</ul>
<p>æ´å¤<code>Dash</code>åºç¨å¼åå¯ç¨æä»¶åè¡¨è¯¦è§ï¼</p>
<ul>
<li><a href="https://github.com/HogaStack/awesome-dash-hooks" target="_blank" rel="noopener nofollow">https://github.com/HogaStack/awesome-dash-hooks</a></li>
</ul>
<hr>
<p>æ´å¤æå³<code>Dash</code>åºç¨å¼åçå¹²è´§åå®¹ï¼æ¬¢è¿æç»­å³æ³¨æä»¬â¤ï¸</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-15 13:56">2026-01-15 13:56</span>&nbsp;
<a href="https://www.cnblogs.com/feffery">è´¹å¼é</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19486989);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19486989', targetLink: 'https://www.cnblogs.com/feffery/p/19486989', title: 'è¿é¶æå·§ï¼å¨Dashåºç¨ä¸­ç´æ¥ä½¿ç¨åçReactç»ä»¶' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºï¼èªç¶è¯­è¨å¤ç  ç¬¬ä¸å¨ï¼å¾ªç¯ç¥ç»ç½ç»  è¯¾åä¹ é¢ä¸ä»£ç å®è·µ ]]></title>
    <link>https://www.cnblogs.com/Goblinscholar/p/19484728</link>
    <guid>2dde7c3d820b4e876b4b90e80041efdc</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Goblinscholar/p/19484728" title="åå¸äº 2026-01-15 13:03">
    <span role="heading" aria-level="2">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºï¼èªç¶è¯­è¨å¤ç  ç¬¬ä¸å¨ï¼å¾ªç¯ç¥ç»ç½ç»  è¯¾åä¹ é¢ä¸ä»£ç å®è·µ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ­¤åç±»ç¨äºè®°å½å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨çå­¦ä¹ ç¬è®°ã<br>
è¯¾ç¨ç¸å³ä¿¡æ¯é¾æ¥å¦ä¸ï¼</p>
<ol>
<li>åè¯¾ç¨è§é¢é¾æ¥ï¼<a href="https://www.bilibili.com/video/BV1FT4y1E74V?buvid=XU762317353676D786954061C192FE625463B&amp;from_spmid=playlist.playlist-detail.0.0&amp;is_story_h5=false&amp;mid=zqernykrmpf7XfIorMR%2FnA%3D%3D&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=ce0bc526-db69-428a-962e-c65ed8c267bc&amp;share_source=COPY&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1713085655&amp;unique_k=DfBgvFW&amp;up_id=8654113&amp;vd_source=e035e9878d32f414b4354b839a4c31a4" target="_blank" rel="noopener nofollow">[åè¯­å­å¹]å´æ©è¾¾æ·±åº¦å­¦ä¹ deeplearning.ai</a></li>
<li>githubè¯¾ç¨èµæï¼å«è¯¾ä»¶ä¸ç¬è®°:<a href="https://github.com/robbertliu/deeplearning.ai-andrewNG" target="_blank" rel="noopener nofollow">å´æ©è¾¾æ·±åº¦å­¦ä¹ æå­¦èµæ</a></li>
<li>è¯¾ç¨éå¥ç»ä¹ ï¼ä¸­è±ï¼ä¸ç­æ¡ï¼<a href="https://blog.csdn.net/u013733326/article/details/79827273" target="_blank" rel="noopener nofollow">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾åä¹ é¢ä¸ç­æ¡</a></li>
</ol>
<p>æ¬ç¯ä¸ºç¬¬äºè¯¾ç¬¬ä¸å¨çè¯¾åä¹ é¢åä»£ç å®è·µé¨åã</p>
<hr>
<h1 id="1çè®ºä¹ é¢">1.çè®ºä¹ é¢</h1>
<p><a href="https://blog.csdn.net/u013733326/article/details/80855595" target="_blank" rel="noopener nofollow">ãä¸­è±ããå´æ©è¾¾è¯¾åæµéªãCourse 5 - åºåæ¨¡å - ç¬¬ä¸å¨æµéª</a><br>
æ¬å¨ççè®ºä¹ é¢ä¸­æä¸éè¾ä¸ºå·§å¦ï¼æä»¬æ¥ççï¼</p>
<blockquote>
<p>è¿éæä¸äºGRUçæ´æ°æ¹ç¨ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260115002949730-620648117.png" alt="image.png" loading="lazy"><br>
ç±ä¸½ä¸å»ºè®®éè¿ç§»é¤&nbsp;<span class="math inline">\(Î_u\)</span> æ¥ç®åGRUï¼å³è®¾ç½® <span class="math inline">\(Î_uï¼1\)</span>ãè´èæåºéè¿ç§»é¤ <span class="math inline">\(Î_r\)</span> æ¥ç®åGRUï¼å³è®¾ç½® <span class="math inline">\(Î_rï¼1\)</span>ãåªç§æ¨¡åæ´å®¹æ<strong>å¨æ¢¯åº¦ä¸æ¶å¤±é®é¢çæåµä¸è®­ç»</strong>ï¼å³ä½¿å¨å¾é¿çè¾å¥åºåä¸ä¹å¯ä»¥è¿è¡è®­ç»ï¼<br>
<strong>ç­æ¡ï¼&nbsp;è´èçæ¨¡åï¼å³ç§»é¤<span class="math inline">\(Î_r\)</span>ï¼ï¼å ä¸ºå¯¹äºä¸ä¸ªæ¶é´æ­¥èè¨ï¼å¦æ<span class="math inline">\(Î_uâ0\)</span>ï¼æ¢¯åº¦å¯ä»¥éè¿æ¶é´æ­¥ååä¼ æ­èä¸ä¼è¡°åã</strong></p>
</blockquote>
<p>æä»¬ååé¡¾ä¸ä¸<a href="https://www.cnblogs.com/Goblinscholar/p/19463351" target="_blank">GRU</a>ä¸­ä¸¤éé¨çè¯­ä¹ï¼</p>
<ol>
<li><strong>éç½®é¨</strong>ï¼æ§å¶å¨è®¡ç®å½ååééèç¶ææ¶ï¼ä¸ä¸æ¶å»éèç¶ææ¯å¦è¢«æå¶ã</li>
<li><strong>æ´æ°é¨</strong>ï¼æ§å¶å½åéèç¶æä¸­ï¼ä¸ä¸æ¶å»éèç¶æä¸å½ååééèç¶æçèåæ¯ä¾ã</li>
</ol>
<p>ç°å¨åæ¥çä¸ä¸é¢ä¸­çä¸¤ç§ç®åé»è¾ï¼</p>
<ol>
<li><strong>ç§»é¤ <span class="math inline">\(Î_u\)</span></strong>ï¼ä»¤æ´æ°é¨æä¸º 1ï¼æ­¤æ¶å½åéèç¶æå®å¨ç±åééèç¶æå³å®ã</li>
<li><strong>ç§»é¤ <span class="math inline">\(Î_r\)</span></strong>ï¼ä»¤éç½®é¨æä¸º 1ï¼ä½¿åééèç¶æå¨è®¡ç®æ¶ä¸åæå¶ä¸ä¸æ¶å»çéèç¶æã</li>
</ol>
<p>çå°è¿éï¼æä»¬å¯è½çä¸åºä»ä¹é®é¢ï¼å ä¸ºåªçè¯­ä¹ï¼äºèé½æ¯ä¸ç§ç®åï¼æ æ³ç´è§çåºå¯¹è®­ç»ææå½±åçç¨åº¦ã<br>
è¿éé¢çå³é®å¨äºé¢ç®ä¸­çï¼<strong>æ´å®¹æå¨æ¢¯åº¦ä¸æ¶å¤±é®é¢çæåµä¸è®­ç»</strong>ã<br>
ä¹å°±æ¯è¯´ï¼æä»¬è¦ççåºè¯¥æ¯<strong>ä¸¤ç§ç®åå¯¹æ¢¯åº¦ä¼ éçå½±å</strong>ã<br>
è¿å°±è¦åå°å¬å¼äº,æä»¬æ¥ççä¸¤ç§ç®ååçä¼ æ­å¬å¼ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260115002949669-1104514762.png" alt="image.png" loading="lazy"><br>
è¿éå°±å¯ä»¥å¾ææ¾çåç°ï¼<strong>å¦æå å»æ´æ°é¨ï¼å°±æ¯å å»äºæ¶é´æ­¥é´çæ¢¯åº¦ç´è¿éé</strong>ãèå å»éç½®é¨åä¸ä¼é æè¿ä¸ç¹ã<br>
æ¾ç¶ï¼å é¤æ´æ°é¨ä¼è®©æ¢¯åº¦å¨æ¶é´æ­¥é´çä¼ æ­è·¯å¾æ´é¿ï¼æ¢¯åº¦åªè½éè¿éçº¿æ§åæ¢ååä¼ æ­ï¼æ´å®¹æè¡°åï¼èªç¶å°±æ´å®¹æé ææ¢¯åº¦æ¶å¤±ï¼ç±æ­¤å¾å°ç­æ¡ã</p>
<h1 id="2ä»£ç å®è·µ">2.ä»£ç å®è·µ</h1>
<p><a href="https://blog.csdn.net/u013733326/article/details/80890454" target="_blank" rel="noopener nofollow">å´æ©è¾¾è¯¾ç¨5 RNNæ­å»ºä¸åºç¨</a><br>
ä¾æ§è¿æ¯åæä¸è¿ä½åä¸»çé¾æ¥ï¼è¿ç¯åå®¢éå¸¸è¯¦ç»å°å±ç¤ºäºæå¨æ­å»º RNNãLSTM ç­æ¬å¨çè®ºåå®¹çè¿ç¨ã<br>
æä»¬ä¾æ§è¿æ¯ç¨æçæ¡æ¶æ¥æ¼ç¤ºæ¬å¨æäºè§£çåå®¹ï¼<strong>ä»»å¡ç±»åä¸ºå½åå®ä½è¯å«</strong>ï¼æ¶åæ¨¡ååä¸¾å¦ä¸ï¼</p>
<ol>
<li><strong>åå±åå RNN</strong></li>
<li><strong>åå±åå RNN</strong></li>
<li><strong>åå±åå GRU</strong></li>
<li><strong>åå±åå LSTM</strong></li>
<li><strong>å¤å±åå LSTM</strong></li>
</ol>
<h2 id="21-æ°æ®éconll-2003">2.1 æ°æ®éï¼CoNLL-2003</h2>
<p>å¨æ¬èçä»£ç å®è·µä¸­ï¼æä»¬éç¨ <strong>CoNLL-2003 å½åå®ä½è¯å«æ°æ®é</strong> ä½ä¸ºæ°æ®éã<br>
å®æ¯åºåæ æ³¨ä»»å¡ä¸­æç»å¸ãä¹æå¸¸ç¨çæ°æ®éä¹ä¸ï¼æ¯ä¸ä¸ª<strong>è¯çº§å«çåºåæ æ³¨æ°æ®é</strong>ã</p>
<p>éè¦è¡¥åçæ¯ï¼å³äºå½åå®ä½è¯å«ä»»å¡ï¼æä»¬å¨ä¹åç<a href="https://www.cnblogs.com/Goblinscholar/p/19449622" target="_blank">çè®ºé¨å</a>éä»ä½¿ç¨ 0/1 æ¥è¿è¡äººåçè¯å«ï¼ä½å®éä¸çå½åå®ä½è¯å«æ¾ç¶åå®¹æ´ä¸°å¯ï¼å¹¶ä¸å¯¹äºåç±»å®ä½çæ ç­¾æ æ³¨ï¼ä¹æä¸å¥ä¸»æµçæçæ æ³¨ä½ç³»ï¼è¢«ç§°ä¸º <strong>BIO æ æ³¨ä½ç³»</strong>ã<br>
å¹¶ä¸å¤æï¼BIO çä¸ä¸ªæ ¸å¿ç¬¦å·å«ä¹å¦ä¸ï¼</p>
<ul>
<li><strong>B-ç±»å</strong>ï¼Beginï¼ï¼è¡¨ç¤ºè¿ä¸ªè¯æ¯ä¸ä¸ªå®ä½ç<strong>å¼å¤´</strong>ï¼ç¬¬ä¸ä¸ªè¯ï¼ã</li>
<li><strong>I-ç±»å</strong>ï¼Insideï¼ï¼è¡¨ç¤ºè¿ä¸ªè¯æ¯å®ä½ç<strong>åé¨</strong>ï¼éç¬¬ä¸ä¸ªè¯ï¼ã</li>
<li><strong>O</strong>ï¼Outsideï¼ï¼è¡¨ç¤ºè¿ä¸ªè¯<strong>ä¸å±äº</strong>ä»»ä½å®ä½ã</li>
</ul>
<p><strong>å¶ä¸­ï¼BãI åä¼æ¥ä»»å¡å®ä¹çå®ä½å½åã</strong><br>
æ¥çä¸ä¸ªå®ä¾ï¼<strong>æ²³å 2026 å¹´ 1 æ 14 æ¥ å¤©æ° å¾å¥½</strong></p>
<table>
<thead>
<tr>
<th>è¯</th>
<th>æ ç­¾</th>
<th>è§£é</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ²³å</td>
<td>B-LOC</td>
<td>å°åçå¼å¤´</td>
</tr>
<tr>
<td>2026</td>
<td>B-TIME</td>
<td>æ¶é´è¡¨è¾¾çå¼å¤´</td>
</tr>
<tr>
<td>å¹´</td>
<td>I-TIME</td>
<td>æ¶é´çåé¨</td>
</tr>
<tr>
<td>1</td>
<td>I-TIME</td>
<td>æ¶é´çåé¨</td>
</tr>
<tr>
<td>æ</td>
<td>I-TIME</td>
<td>æ¶é´çåé¨</td>
</tr>
<tr>
<td>14</td>
<td>I-TIME</td>
<td>æ¶é´çåé¨</td>
</tr>
<tr>
<td>æ¥</td>
<td>I-TIME</td>
<td>æ¶é´çåé¨</td>
</tr>
<tr>
<td>å¤©æ°</td>
<td>O</td>
<td>éå®ä½</td>
</tr>
<tr>
<td>å¾</td>
<td>O</td>
<td>éå®ä½</td>
</tr>
<tr>
<td>å¥½</td>
<td>O</td>
<td>éå®ä½</td>
</tr>
</tbody>
</table>
<p>CoNLL-2003 åæ ·éç¨ <strong>BIO æ æ³¨ä½ç³»</strong>ï¼å¹¶å®ä¹äºåç±»å½åå®ä½å¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>å®ä½ç±»å</th>
<th>å«ä¹</th>
<th>BIO æ ç­¾ç¤ºä¾</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>PER</td>
<td>äººåï¼Personï¼</td>
<td><code>B-PER</code>, <code>I-PER</code></td>
<td>è¡¨ç¤ºäººç©å§ååå¶ç»æé¨å</td>
</tr>
<tr>
<td>ORG</td>
<td>ç»ç»æºæï¼Organizationï¼</td>
<td><code>B-ORG</code>, <code>I-ORG</code></td>
<td>å¬å¸ãæ¿åºæºæãå­¦æ ¡ç­</td>
</tr>
<tr>
<td>LOC</td>
<td>å°åï¼Locationï¼</td>
<td><code>B-LOC</code>, <code>I-LOC</code></td>
<td>å½å®¶ãåå¸ãå°åºç­å°çåç§°</td>
</tr>
<tr>
<td>MISC</td>
<td>å¶ä»ä¸æåè¯ï¼Miscellaneousï¼</td>
<td><code>B-MISC</code>, <code>I-MISC</code></td>
<td>å¶ä»ä¸å±äºä¸è¿°ç±»å«çä¸å</td>
</tr>
<tr>
<td>O</td>
<td>éå®ä½</td>
<td><code>O</code></td>
<td>ä¸å±äºä»»ä½å½åå®ä½çæ®éè¯</td>
</tr>
</tbody>
</table>
<p>äºè§£äº CoNLL-2003 è¿ç±»æ°æ®éçåºåæ æ³¨é»è¾åï¼åå°æ°æ®æ¬èº«ï¼<br>
CoNLL-2003 æ°æ®éå·²ç»è¢«å®æ¹ååä¸ºè®­ç»éãéªè¯éåæµè¯éä¸é¨åï¼å¶ä¸­ï¼</p>
<ul>
<li><strong>è®­ç»é</strong>ï¼çº¦ <strong>14,000</strong> å¥ã</li>
<li><strong>éªè¯é</strong>ï¼çº¦ <strong>3,000</strong> å¥ã</li>
<li><strong>æµè¯é</strong>ï¼çº¦ <strong>3,500</strong> å¥ã</li>
</ul>
<p>æ»è®¡åå« <strong>20,000+</strong> æ¡æ æ³¨å¥å­ï¼è¯çº§æ ·æ¬æ°éå¨ <strong>20 ä¸çº§å«</strong>ã</p>
<p>CoNLL-2003 çä¸è½½æ¥å£åæ ·å¨è¢«å°è£å¨ python çè®¸å¤ç¬¬ä¸æ¹åºä¸­ï¼å¶ä¸­ä¸ä¸ªéæ©æ¯ PyTorch å®æ¹ç»´æ¤çä¸ä¸ª NLP å·¥å·åºï¼<code>torchtext</code> ï¼</p>
<pre><code class="language-python">pip install torchtext
</code></pre>
<p>å®è£åï¼ä¾¿å¯ä»¥è¿æ ·å¯¼å¥CoNLL-2003 çä¸è½½æ¥å£ï¼</p>
<pre><code class="language-python">from torchtext.datasets import CoNLL2003
</code></pre>
<p><strong>ä½æ¯ï¼ç±äº<code>torchtext</code>å¹¶é<code>torch</code> çå­æ¨¡åï¼éè¦åç¬å®è£ï¼ä¸é«åº¦ä¾èµå<code>torch</code>é´ççæ¬å¹éï¼å æ­¤å¨å®éå®è£ä¸­å¯è½åºç°å¾å¤å¼å®¹æ§é®é¢ã</strong><br>
å æ­¤ï¼æä»¬éæ©å¦ä¸ä¸ªå¼å®¹æ§æ´å¥½ä¸å®éä¸å¨è¿ç±»ä½¿ç¨ä¸ä¹æ´æµè¡çåºï¼HuggingFace ç <code>datasets</code>:</p>
<pre><code class="language-python">pip install datasets
</code></pre>
<p>å®è£åï¼ä¾¿å¯ä»¥è¿æ ·å¯¼å¥ï¼</p>
<pre><code class="language-python">from datasets import load_dataset
</code></pre>
<p>è¿æ ·ï¼æä»¬å°±å®æäºæ°æ®éæ¬èº«çåå¤ï¼æå°å æ¡ç¤ºä¾æ°æ®å¦ä¸ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260115002949955-1373934732.png" alt="image.png" loading="lazy"></p>
<h2 id="22-æ°æ®é¢å¤ç">2.2 æ°æ®é¢å¤ç</h2>
<p>å®ææ°æ®éåå¤åï¼èªç¶ä¸ä¸æ­¥å°±è¦å¼å§è®©æ°æ®è¾å¥æ¨¡åï¼ä½åºåæ°æ®ä¸åäºæä»¬ä¹åçå¾åï¼ç»ä¸é¢å¤çåå°±å¯ä»¥è¾å¥ç½ç»ï¼å¨ RNN ä¸­ï¼æä»¬éè¦å¨æ°æ®é¢å¤çä¸­è±æ´å¤åå¤«ï¼å·ä½å¦ä¸ï¼</p>
<h4 id="1å¯¼å¥ç¸å³åº">ï¼1ï¼å¯¼å¥ç¸å³åº</h4>
<p>å¼å±å½ç¶è¿æ¯åå¯¼åºï¼å¨ NLP ç¸å³ä»»å¡ä¸­ï¼è¿äºç¸å³åºé½å¾å¸¸è§ï¼å°¤å¶æ¯pythonåç½®ç<code>collections</code>åºï¼æä»¬å¸¸ç¨å®æ¥<strong>ç»è®¡è¯­æåºï¼æå»ºè¯å¸</strong>ã</p>
<pre><code class="language-python">import torch
import torch.nn as nn
from torch.nn.utils.rnn import pad_sequence  # ç¨äºå¯¹ä¸åé¿åº¦çåºåè¿è¡å¡«åï¼ä½¿å¾æ¹æ¬¡å¼ éå¯¹é½ã
from datasets import load_dataset # å¯¼å¥ CoNLL-2003 æ°æ®éã
from collections import Counter # ç¨äºç»è®¡è¯é¢åæ ç­¾é¢çï¼ä¾¿äºæå»ºè¯è¡¨åæ ç­¾è¡¨ã
from torch.utils.data import DataLoader # æ éï¼æä¾æ¹æ¬¡åå¤çåæä¹±æ°æ®éåè½ã
</code></pre>
<h4 id="2å è½½æ°æ®é">ï¼2ï¼å è½½æ°æ®é</h4>
<p>è¿æ­¥å¾ç®åï¼å°±ä¸å¤è§£éäºï¼</p>
<pre><code class="language-python"># ä½¿ç¨ HuggingFace datasets å è½½æ°æ®
dataset = load_dataset("conll2003")
# åå«è·åè®­ç»éãéªè¯éãæµè¯é
train_data = dataset['train']
valid_data = dataset['validation']
test_data = dataset['test']
</code></pre>
<h4 id="3æå»ºè¯è¡¨åæ ç­¾è¡¨">ï¼3ï¼æå»ºè¯è¡¨åæ ç­¾è¡¨</h4>
<p>å°±åæä»¬å¨<a href="https://www.cnblogs.com/Goblinscholar/p/19437798" target="_blank">çè®ºé¨å</a>ä»ç»çï¼å¨ååºåä»»å¡ä¸­ï¼æä»¬éè¦æææ¬åæ ç­¾é½è½¬æç´¢å¼å½¢å¼ï¼å³è®¡ç®æºè½çè§£çè¯å¸ã<br>
è¿éæä»¬åç¨ <code>Counter</code> ç»è®¡è¯é¢åæ ç­¾é¢çï¼ç¶åæå»ºè¯è¡¨åæ ç­¾è¡¨ã<br>
å¨è¿ééè¦è¡¥åçåå®¹æ¯<strong>å¡«åç¬¦<code>&lt;PAD&gt;</code></strong>,å ä¸ºæ¨¡åéè¦åºå®ç»´åº¦çè¾å¥ï¼èåºåå¾å¾é¿åº¦ä¸åï¼å æ­¤æä»¬éè¦<strong>å¯¹ä¸åé¿åº¦çåºåè¿è¡å¡«å</strong>æ¥ééæ¨¡åè¾å¥ã<br>
ä¸¾ä¸ªç®åçä¾å­ï¼</p>
<table>
<thead>
<tr>
<th>å¡«åå</th>
<th>å¡«åå</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hello my firend</td>
<td>Hello my firend</td>
</tr>
<tr>
<td>Hi</td>
<td>Hi <code>&lt;PAD&gt;``&lt;PAD&gt;</code></td>
</tr>
</tbody>
</table>
<p>åæ ·ï¼å½è¾å¥åºåä¸­åºç°<code>&lt;PAD&gt;</code>æ¶ï¼å¶å¯¹åºçæ ç­¾ä¹æ¯<code>&lt;PAD&gt;</code>ã<br>
å¨ä»£ç ä¸­ï¼æä»¬ä¸è¬è®¾ç½®<strong>è¾å¥</strong>åºåä¸­ç<code>&lt;PAD&gt;</code>ç ID ä¸º 0ï¼ä½å¨<strong>æ ç­¾</strong>åºåä¸­åä¸åï¼æä»¬ä¸è¬è®¾å®ä¸ºä¸ä¸ªç¹æ®å¼ï¼æ¯å¦ä¸é¢ç -100ï¼<strong>è¿ä¸ªç¹æ®å¼ä¼è¢«ç¹æ®è®°å½ï¼å¨è®¡ç®æå¤±æ¶ä¼å¿½ç¥è¯¥ä½ç½®çæå¤±è®¡ç®ã</strong><br>
å ä¸ºå®æ¬èº«çä½ç¨å°±æ¯å¡«ååºåé¿åº¦ï¼æ¨¡åä¸éè¦å¨è¿éæµªè´¹è®¡ç®æ§è½ï¼ä¹æ æ³ä»è¿éå­¦ä¹ ä¿¡æ¯ã<br>
ç¼ç å¦ä¸ï¼</p>
<pre><code class="language-python"># ç»è®¡è¯é¢åæ ç­¾é¢ç
# Counter()ï¼ç¨æ¥ç»è®¡åç´ åºç°æ¬¡æ°çå­å¸
word_counter = Counter() 
tag_counter = Counter()

for item in train_data:
    words = item['tokens']      # åè¯åè¡¨
    tags = item['ner_tags']     # æ ç­¾ç´¢å¼
    tag_counter.update(tags)    # ç»è®¡æ ç­¾
    word_counter.update(words)  # ç»è®¡è¯é¢

# æå»ºè¯è¡¨
word_vocab = {w: i + 2 for i, (w, _) in enumerate(word_counter.most_common())}
# word_counter.most_common() ï¼è¿åæè¯é¢ä»é«å°ä½æåç (åè¯, åºç°æ¬¡æ°) åè¡¨ã
# i + 2 æä»¬ç»åè¯åéæ´æ° IDï¼ä» 2 å¼å§ã
# {w: i + 2 for i, (w, _) in ...} ï¼éè¿å­å¸æ¨å¯¼å¼ï¼ææ¯ä¸ªåè¯ w æ å°ä¸ºå¯¹åºçæ´æ° IDã
# æç» word_vocab = {'I':2, 'love':3, 'Python':4, ...}
word_vocab["&lt;PAD&gt;"] = 0   # å¡«åç¬¦
word_vocab["&lt;UNK&gt;"] = 1   # æªç¥è¯

# æå»ºæ ç­¾è¡¨
tag_vocab = {t: t for t in tag_counter.keys()}  # æ ç­¾ç´¢å¼ç´æ¥æ å°èªå·±
pad_tag_id = -100        # å®ä¹ PAD æ ç­¾ç´¢å¼ï¼å¨åç»­æå¤±å½æ°åæ°ä¸­ä½¿ç¨ã
num_classes = len(tag_vocab) # é¢æµç±»å«ï¼å®ä¹è¾åºå±
vocab_size = len(word_vocab)  # ç¨äºç¬ç­ç¼ç 
</code></pre>
<h4 id="4å®ä¹ç¼ç å½æ°">ï¼4ï¼å®ä¹ç¼ç å½æ°</h4>
<p>å®ä¹å¥½å¥½è¯è¡¨åæ ç­¾è¡¨æ¬èº«åï¼æä»¬è¿éè¦å®ä¹ç¬¬ä¸ä¸ªç¼ç å½æ°ï¼å®çä½ç¨å°±æ¯<strong>æææ¬ä¿¡æ¯å¯¹ç§è¯å¸è½¬æ¢ä¸ºè®¡ç®æºè½çè§£çç¼ç ã</strong> æä»¬ä¸ä¸æ­¥å°±ä¼éè¿è¿ä¸ªå½æ°æ¥å¤çæ°æ®éã<br>
åæ¶ï¼è¿ä¸æ­¥è¿åæ¯ä¹åå·ç§¯ç½ç»ä¸­ç transform æ¹æ³ï¼æå¨è¾å¥æ¨¡ååï¼ææ°æ®è½¬æ¢æ PyTorch è¦æ±çTensor å¼ éã<br>
ä¸è¿åå¾åä¸åçæ¯ï¼è¿éå¤ççæ¯ææ¬åºåãè transform éå¯¹çæ¯å¾åæ°æ®ï¼ä¸å¤çé»è¾ä¹ä¸åï¼å æ­¤å¹¶ä¸è½å¨è¿éç´æ¥ä½¿ç¨ã</p>
<pre><code class="language-python"># å°åæ¡æ ·æ¬çåè¯åæ ç­¾ç¼ç ä¸º Tensor
def encode(item):
    words = item['tokens']
    tags = item['ner_tags'] 
    x = torch.tensor([word_vocab.get(w, 1) for w in words], dtype=torch.long) 
    # è¿æ®µé»è¾æ¯ï¼å¯¹äºæ¯ä¸ªè¯ï¼å¦æå¨è¯è¡¨éæ¾å°å°±è¿åå¶ç´¢å¼ï¼å¦ææ²¡æ¾å°ï¼å°±è¿å 1ï¼å³ &lt;UNK&gt; çç´¢å¼
    y = torch.tensor(tags, dtype=torch.long)  
    # æ ç­¾ç´¢å¼
    return x, y
</code></pre>
<h4 id="4æ°æ®å¡«ååæå»ºè¿­ä»£å¨">ï¼4ï¼æ°æ®å¡«ååæå»ºè¿­ä»£å¨</h4>
<p>å°è¿ä¸æ­¥ï¼æä»¬å·²ç»æ¥æäºè¯å¸åç¸åºçç¼ç å½æ°ï¼èªç¶ï¼æä»¬å¯ä»¥ä½¿ç¨å®ä»¬<strong>å¯¹æ°æ®è¿è¡é¢å¤ç</strong>äºï¼è¿ä¸æ­¥çå·¥ä½åä¸ºä¸é¨åï¼</p>
<ol>
<li><strong>å®ä¹å¡«åå½æ°ã</strong></li>
<li><strong>ä½¿ç¨ç¼ç å½æ°å¯¹ååå¥½çæ°æ®è¿è¡ç¼ç ã</strong></li>
<li><strong>ä½¿ç¨ç¼ç å¥½çæ°æ®ä¸å¡«åå½æ°ï¼å®ææç»çæ¹æ¬¡è¿­ä»£å¨å®ä¹ã</strong></li>
</ol>
<pre><code class="language-python"># èªå®ä¹å¡«åå½æ°
def collate_fn(batch): # åæ°ä¸ºä¸æ¹æ¬¡æ°æ® 
    xs, ys = zip(*batch) # æï¼æ ·æ¬ï¼æ ç­¾ï¼ææï¼æ ·æ¬ï¼æ ·æ¬ï¼åï¼æ ç­¾ï¼æ ç­¾ï¼
    xs_pad = pad_sequence(xs, batch_first=True, padding_value=word_vocab["&lt;PAD&gt;"])     # pad_sequence æ¹æ³ä¼èªå¨æ¾å°æé¿åºåå¹¶è¡¥åå¡«ååä¸æ¹æ¬¡ä¸­å¶ä»åºåå°è¯¥é¿åº¦ã
    # ä¸åæ¹æ¬¡çå¡«åé¿åº¦å¯ä»¥ä¸åã
    ys_pad = pad_sequence(ys, batch_first=True, padding_value=pad_tag_id)  
    return xs_pad.to(device), ys_pad.to(device)  
    
# å¯¹æææ°æ®è¿è¡ç¼ç 
train_dataset = [encode(item) for item in train_data]  
valid_dataset = [encode(item) for item in valid_data]  
test_dataset  = [encode(item) for item in test_data] 
 
# ä½¿ç¨ç¼ç å¥½çæ°æ®ååæ¹æ¬¡ï¼è¿è¡å¡«å 
train_loader = DataLoader(train_dataset, batch_size=32, shuffle=True, collate_fn=collate_fn)  
valid_loader = DataLoader(valid_dataset, batch_size=32, shuffle=False, collate_fn=collate_fn)  
test_loader  = DataLoader(test_dataset, batch_size=32, shuffle=False, collate_fn=collate_fn)
</code></pre>
<p>è³æ­¤ï¼æä»¬æå®æäºå¨æ°æ®éå¨è¾å¥æ¨¡ååçé¢å¤çå·¥ä½ï¼ä¸ä¸æ­¥ï¼èªç¶å°±æ¯è¦å®ä¹æ¨¡åäºã</p>
<h2 id="23-å®ä¹-rnn-æ¨¡å">2.3 å®ä¹ RNN æ¨¡å</h2>
<p>åæ ·ï¼å¯¹äº RNN ï¼PyTorch ä¹æå°è£å¥½çæ¹æ³ï¼æä»¬å®ä¹è¦ç¨ç RNN æ¨¡åå¦ä¸ï¼</p>
<pre><code class="language-python">class RNNTagger(nn.Module):  
    def __init__(self, vocab_size, hidden_dim, num_classes,  
                 rnn_type='RNN', bidirectional=False, num_layers=1):
        # ä½¿ç¨å¤ä¸ªåæ°ï¼æ¹ä¾¿æä»¬è°ç¨ä¸åæ¨¡å,é»è®¤ä¸ºåå±åå RNN
        super().__init__()  
        self.vocab_size = vocab_size  # è¯è¡¨
        self.bidirectional = bidirectional  # æ¯å¦åå
        self.rnn_type = rnn_type.upper()  # ä½¿ç¨çå¾ªç¯åå
         
        input_size = vocab_size  # ä½¿ç¨ç¬ç­ç¼ç ï¼ç¬ç­ç¼ç è¾å¥ç»´åº¦ = è¯è¡¨å¤§å°  
        # ä½¿ç¨æ®é RNN
        if self.rnn_type == 'RNN':  
            self.rnn = nn.RNN(input_size, hidden_dim, batch_first=True,  
                              bidirectional=bidirectional, num_layers=num_layers)
        # ä½¿ç¨ LSTM  
        elif self.rnn_type == 'LSTM':  
            self.rnn = nn.LSTM(input_size, hidden_dim, batch_first=True,  
                               bidirectional=bidirectional, num_layers=num_layers)         # ä½¿ç¨ GRU
        elif self.rnn_type == 'GRU':  
            self.rnn = nn.GRU(input_size, hidden_dim, batch_first=True,  
                              bidirectional=bidirectional, num_layers=num_layers)  
        else:  
            raise ValueError("rnn_type must be 'RNN','LSTM','GRU'")  
        # è¾åºå±
        self.fc = nn.Linear(hidden_dim * (2 if bidirectional else 1), num_classes)  
    def forward(self, x):  
	# x: [batch, seq_len], è½¬ç¬ç­  
	    x_onehot = torch.nn.functional.one_hot(x, num_classes=self.vocab_size).float()  
	    out, _ = self.rnn(x_onehot)  #å¨è¿éå°±å°è£äºææ¶é´æ­¥ä¼ æ­çé»è¾
	    out = self.fc(out)  
	    return out
</code></pre>
<p>å¨è¿éï¼ä½ ä¼åç°ï¼RNNãLSTMãGRU é½è¢«å°è£æäºåç¬çæ¨¡åï¼æä»¬åªéè¦æ´æ¹å¶åæ°ï¼å³å¯ä¿®æ¹å¶æ·±åº¦åæ¯å¦ååç­ã<br>
æåï¼å°±æ¯å®ä¹ç¸åºè®­ç»åéªè¯é»è¾äºã</p>
<h2 id="24-è®­ç»ä¸éªè¯">2.4 è®­ç»ä¸éªè¯</h2>
<p>æä»¬è¿æ¬¡ææ´ä¸ªè®­ç»ä¸éªè¯é»è¾ä¹å®ä¹ä¸ºå½æ°ï¼æ¹ä¾¿ä¹åä½¿ç¨ä¸åçæ¨¡åè°ç¨ï¼</p>
<pre><code class="language-python">def train_validate(model, train_loader, valid_loader, epochs=5, lr=0.001):
    model.to(device)
     # å¨æå¤±å½æ°ç§ä½¿ç¨ignore_indexåæ°æ¥å¿½ç¥å¯¹&lt;PAD&gt;çæå¤±è®¡ç®
    criterion = nn.CrossEntropyLoss(ignore_index=pad_tag_id)
    optimizer = torch.optim.Adam(model.parameters(), lr=lr)

    train_loss_history = []
    train_acc_history  = []
    val_acc_history    = []
    val_f1_history     = []

    epoch_times = []
    total_start_time = time.time()

    for epoch in range(epochs):
        epoch_start_time = time.time()

        # ========= è®­ç» =========
        model.train()
        total_loss = 0
        total_correct = 0
        total_tokens = 0

        for x_batch, y_batch in train_loader:
            optimizer.zero_grad()
            outputs = model(x_batch)

            outputs_reshape = outputs.view(-1, num_classes)
            y_batch_reshape = y_batch.view(-1)

            loss = criterion(outputs_reshape, y_batch_reshape)
            loss.backward()
            optimizer.step()
            total_loss += loss.item()

            preds = outputs.argmax(dim=-1)
            for i in range(y_batch.size(0)):
                mask = y_batch[i] != pad_tag_id
                total_correct += (preds[i][mask] == y_batch[i][mask]).sum().item()
                total_tokens += mask.sum().item()

        avg_train_loss = total_loss / len(train_loader)
        train_acc = total_correct / total_tokens

        train_loss_history.append(avg_train_loss)
        train_acc_history.append(train_acc)

        # ========= éªè¯ =========
        model.eval()
        val_total_correct = 0
        val_total_tokens = 0

        all_preds = []
        all_labels = []

        with torch.no_grad():
            for x_val, y_val in valid_loader:
                outputs = model(x_val)
                preds = outputs.argmax(dim=-1)

                for i in range(y_val.size(0)):
                    mask = y_val[i] != pad_tag_id

                    val_total_correct += (preds[i][mask] == y_val[i][mask]).sum().item()
                    val_total_tokens += mask.sum().item()

                    all_preds.extend(preds[i][mask].cpu().tolist())
                    all_labels.extend(y_val[i][mask].cpu().tolist())

        val_acc = val_total_correct / val_total_tokens

        # â­ token-level F1ï¼macroï¼
        val_f1 = f1_score(all_labels, all_preds, average='macro')

        val_acc_history.append(val_acc)
        val_f1_history.append(val_f1)

        epoch_time = time.time() - epoch_start_time
        epoch_times.append(epoch_time)

        print(
            f"è½®æ¬¡ {epoch+1}: "
            f"è®­ç»æå¤±={avg_train_loss:.4f}, "
            f"è®­ç»åç¡®ç={train_acc:.4f}, "
            f"éªè¯åç¡®ç={val_acc:.4f}, "
            f"éªè¯F1={val_f1:.4f}, "
            f"æ¬è½®ç¨æ¶={epoch_time:.2f} ç§"
        )

    total_time = time.time() - total_start_time
    avg_epoch_time = sum(epoch_times) / len(epoch_times)

    print("\n======== è®­ç»æ¶é´ç»è®¡ ========")
    print(f"æ»è®­ç»æ¶é´ï¼{total_time:.2f} ç§")
    print(f"å¹³åæ¯è½®ç¨æ¶ï¼{avg_epoch_time:.2f} ç§")

    history = {
        'train_loss': train_loss_history,
        'train_acc': train_acc_history,
        'val_acc': val_acc_history,
        'val_f1': val_f1_history
    }
    return model, history

</code></pre>
<p>èªæ­¤ï¼æä»¬ç»äºå®æäºä¸»è¦çä»£ç å·¥ä½ï¼ä¸é¢å°±æ¥è¿è¡ççå§ã</p>
<h2 id="25-è¿è¡ç»æ">2.5 è¿è¡ç»æ</h2>
<h4 id="1-åå±åå-rnn">(1) åå±åå RNN</h4>
<p>é¦åï¼åè¯è¯æåºç¡çåå±åå RNN,æä»¬å¨ä¸»å½æ°éè¿æ ·è°ç¨å®ï¼</p>
<pre><code class="language-python">if __name__ == '__main__':  
    # å®ä¹åæ°  
    cfg = {'rnn_type':'RNN','bidirectional':False,'num_layers':1}
    # ä¼ å¥æ¨¡å   
    model = RNNTagger(vocab_size=len(word_vocab),   
                      hidden_dim=128,   
                      num_classes=num_classes,  
                      rnn_type=cfg['rnn_type'],   
                      bidirectional=cfg['bidirectional'],  
                      num_layers=cfg['num_layers']) 
    # è¿è¡è®­ç»
    model, history = train_validate(model, train_loader, valid_loader, epochs=5)      # å¯è§å
    plot_training_curves(history) 
</code></pre>
<p>éè¦å¼ºè°çæ¯ï¼<strong>RNN éå¸¸ä¸éè¦è®¾ç½®è¿å¤çè®­ç»è½®æ¬¡</strong>ï¼è¿æ¯å ä¸ºå¶è®­ç»éç¨æ¶é´ååä¼ æ­ï¼æ¢¯åº¦éè¦æ²¿æ¶é´ç»´åº¦éæ­¥ä¼ éï¼æ¶é´æ­¥ä¸é¿å°±å®¹æåºç°æ¢¯åº¦æ¶å¤±æçç¸çé®é¢ï¼ä½¿å¾åæè®­ç»æ¶çè¿ééä½ã<br>
å®è·µä¸­ï¼RNN å¾å¾å¨åå è½®å°±å­¦å°ä¸»è¦çåºåæ¨¡å¼ï¼ç»§ç»­å¢å  epoch ä¸ä»æåæéï¼è¿å¯è½å¯¼è´éªè¯æ§è½æ³¢å¨çè³è¿æåï¼å æ­¤ç¸æ¯å¶ä»æ¨¡åï¼RNN çè®­ç»è½®æ¬¡éå¸¸è®¾ç½®å¾ç¸å¯¹è¾å°ã</p>
<p>ç°å¨æ¥ççè¿è¡ç»æï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260115002949968-1870151032.png" alt="image.png" loading="lazy"><br>
è¿éæä¸ä¸ªé®é¢ï¼ä½ ä¼åç°ï¼<strong>F1 åæ°ææ¾è¦æ¯åç¡®çä½ä¸æªã</strong></p>
<p>åå å¨äºï¼<strong>åºåæ æ³¨ä»»å¡ä¸­çç±»å«åå¸éå¸¸æ¯æåº¦ä¸åè¡¡ç</strong>ãä»¥å½åå®ä½è¯å«ä¸ºä¾ï¼å¤§é¨åè¯å®éä¸é½å±äºéå®ä½ç±»å«ï¼å¦ <code>O</code>ï¼ï¼æ¨¡åå³ä½¿åªæ¯âä¿å®å°âæç»å¤§å¤æ°ä½ç½®é¢æµä¸º <code>O</code>ï¼ä¹è½è·å¾ç¸å½å¯è§çåç¡®çãè¿ç§æåµä¸ï¼<strong>åç¡®çæ´å¤åæ çæ¯æ¨¡åå¯¹âå¤æ°ç±»âçæåè½åï¼èéå¯¹å®ä½è¾¹çåç±»å«ççå®è¯å«è½å</strong>ã<br>
ç¸æ¯ä¹ä¸ï¼<strong>F1 åæ°åæ¶èèäºç²¾ç¡®çåå¬åç</strong>ï¼åªæå½æ¨¡åæ¢è½æ­£ç¡®è¯å«å®ä½ãåä¸è¿åº¦æ¼æå®ä½æ¶ï¼F1 æä¼æé«ãå æ­¤ï¼å¨å½åå®ä½è¯å«è¿ç±»å³æ³¨âå°æ°ä½å³é®ç»æâçä»»å¡ä¸­ï¼F1 è½æ´çå®å°å»ç»æ¨¡åçå®éææã<br>
ä¹æ­£å å¦æ­¤ï¼<strong>å¨åºåæ æ³¨ä»»å¡ä¸­ï¼åç¡®çå¾å¾å·æè¾å¼ºçè¿·ææ§ï¼è F1 ææ¯æ´å·å¤å«åãä¹æ´è¢«å¹¿æ³éç¨çæ ¸å¿è¯ä»·ææ </strong>ã<br>
æä»¬ç»§ç»­ï¼ççå¶ä»æ¨¡åçè¡¨ç°ã</p>
<h4 id="2åå±åå-rnn">ï¼2ï¼åå±åå RNN</h4>
<p>ç¬¬äºä¸ªå®éªå¯¹è±¡ï¼åå±åå RNNï¼æä»¬åªéè¦æ´æ¹ä¸ä¸ªåæ°ï¼</p>
<pre><code class="language-python">if __name__ == '__main__':  
    # å®ä¹åæ°: 'bidirectional':True
    cfg = {'rnn_type':'RNN','bidirectional':True,'num_layers':1}
    # ä¼ å¥æ¨¡å   
    model = RNNTagger(vocab_size=len(word_vocab),   
                      hidden_dim=128,   
                      num_classes=num_classes,  
                      rnn_type=cfg['rnn_type'],   
                      bidirectional=cfg['bidirectional'],  
                      num_layers=cfg['num_layers']) 
    # è¿è¡è®­ç»
    model, history = train_validate(model, train_loader, valid_loader, epochs=5)      # å¯è§å
    plot_training_curves(history) 
</code></pre>
<p>æ¥çç»æï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260115002950498-1918940564.png" alt="image.png" loading="lazy"><br>
å¾ææ¾ï¼éªè¯éä¸ç F1 åæ°æææåä»ä¹åç 79% å·¦å³å°äº 83% å·¦å³ï¼ä½éçè®¡ç®éçå¢å ï¼è®­ç»ç¨æ¶ä¹ç¸åºçå¢å äºçº¦ 20%ã</p>
<p>æä»¬ç»§ç»­ã</p>
<h4 id="3åå±åå-gru">ï¼3ï¼åå±åå GRU</h4>
<p>ç¬¬ä¸ä¸ªå®éªå¯¹è±¡ï¼åå±åå GRUï¼åæ ·ä¿®æ¹åæ°å¦ä¸ï¼</p>
<pre><code class="language-python">cfg = {'rnn_type': 'GRU', 'bidirectional': True, 'num_layers': 1}  
</code></pre>
<p>æ¥çç»æï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260115003322668-1088493097.png" alt="image.png" loading="lazy"><br>
è§å¯ç»æï¼ä½ ä¼åç°ï¼GRU åæ¬¡å®ç°äº F1 åæ°çæåï¼ä½åæ¶ï¼æ´å å¤æçå¾ªç¯ååä¹è®©å¶è¿è¡æ¶é´å¤§å¹æåã</p>
<h4 id="4åå±åå-lstm">ï¼4ï¼åå±åå LSTM</h4>
<p>ç»§ç»­ï¼æ¥ççLSTM çè¡¨ç°ï¼</p>
<pre><code class="language-python">cfg = {'rnn_type': 'LSTM', 'bidirectional': True, 'num_layers': 1}  
</code></pre>
<p>ç»æå¦ä¸ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260115002950457-1403414203.png" alt="image.png" loading="lazy"></p>
<p>ç»ææ¾ç¤ºï¼<strong>å¨å½åè®¾ç½®ä¸ï¼ LSTM å¹¶ä¸å¦ GRU</strong>ã<br>
å¶å®åå ä¹æ¯è¾ç´è§ï¼LSTM å¹¶ä¸æ¯ä¸å®æ¯ GRU å¥½ï¼å®åªæ¯âä¸éæ´é«ãææ¬ä¹æ´é«âï¼åæ¶ä¹<strong>æ´é¾è®­ç»</strong>ï¼æä»¬ç»§ç»­ä¸ä¸æ­¥æ¥ççï¼</p>
<h4 id="5å¤å±åå-lstm">ï¼5ï¼å¤å±åå LSTM</h4>
<p>æåä¸æ¬¡ï¼æä»¬éæ©å¢å  LSTM çæ·±åº¦ï¼åæ¶å¢å è½®æ¬¡ä¸º10ã</p>
<pre><code class="language-python">cfg = {'rnn_type': 'LSTM', 'bidirectional': True, 'num_layers': 3}  
</code></pre>
<p>ç»æå¦ä¸ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260115002950526-729492931.png" alt="image.png" loading="lazy"><br>
ç»æå¥½åä¹å¹¶æ²¡æåæä»¬ææ³ä¸æ ·æææåï¼è¿ä¹ç¡®å®è¯´æäºï¼<strong>æ´å¤æçæ¨¡åï¼éè¦æ´å¤çè®­ç»æå·§ã</strong></p>
<p>æä»¬çæ¼ç¤ºé¨åå°±å°è¿éã<br>
ä½ ä¼åç°ï¼åå±åå RNN è®­ç»å¿«ãåç¡®çé«ä½ F1 åä½ï¼è¯´æå¯¹å°æ°ç±»è¯å«æéã<br>
åå±åå RNN å©ç¨ååæä¿¡æ¯æåäº F1ï¼ä½è®­ç»æ¶é´ä¹æææåã<br>
åå±åå GRU å¨ä¿æè®­ç»ç¨³å®çåæ¶è¿ä¸æ­¥æåäº F1ï¼æ§ä»·æ¯æå¥½ã<br>
åå±åå LSTM åæ°å¤ãè®­ç»é¾åº¦é«ï¼å¨å½åè®¾ç½®ä¸ä¸å¦ GRUï¼å¤å±åå LSTM å³ä¾¿å¢å è½®æ¬¡åæ·±åº¦ï¼F1 ä»æªæ¾èæåï¼è¯´æå¤ææ¨¡åéè¦æ´ç²¾ç»çè®­ç»ç­ç¥ã<br>
<strong>æ»ä½æ¥çï¼å¯¹äºä¸­ç­è§æ¨¡çåºåæ æ³¨ä»»å¡ï¼æµå± GRU æ¯æç¨³å¥çéæ©ã</strong></p>
<p>å½ç¶ï¼è¿åªæ¯éå¯¹æä»¬ç°å¨æä»ç»çææ¯èè¨ï¼ä¸ä¸å¨çåå®¹å³äºè¯åµå¥ï¼æ¯ç¸æ¯ç¬ç­ç¼ç èè¨ï¼æ´å åéçææ¬ç¼ç ææ¯ï¼å°æ¶æä»¬åæ¥ççåä¸ªæ¨¡åçæ§è½å¦ä½ã</p>
<h1 id="3-éå½">3. éå½</h1>
<h2 id="31-rnn-æ¨¡åè®­ç»ä»£ç -pytorchç">3.1 RNN æ¨¡åè®­ç»ä»£ç -PyTorchç</h2>
<pre><code class="language-python">import time  
import torch  
import torch.nn as nn  
from torch.nn.utils.rnn import pad_sequence  
from datasets import load_dataset  
from collections import Counter  
from torch.utils.data import DataLoader  
from sklearn.metrics import f1_score  
device = torch.device("cuda" if torch.cuda.is_available() else "cpu")  
  
dataset = load_dataset("conll2003")  
train_data = dataset['train']  
valid_data = dataset['validation']  
test_data  = dataset['test']  
  
word_counter = Counter()  
tag_counter = Counter()  
  
for item in train_data:  
    word_counter.update(item['tokens'])  
    tag_counter.update(item['ner_tags'])  
  
# è¯è¡¨
word_vocab = {w:i+2 for i,(w,_) in enumerate(word_counter.most_common())}  
word_vocab["&lt;PAD&gt;"] = 0  
word_vocab["&lt;UNK&gt;"] = 1  
  
# æ ç­¾è¡¨  
tag_vocab = {t:t for t in tag_counter.keys()}  
pad_tag_id = -100  
num_classes = len(tag_vocab)  
vocab_size = len(word_vocab)  # ç¨äºç¬ç­ç¼ç   
  
 
# ç¼ç å½æ°  
def encode(item):  
    x = torch.tensor([word_vocab.get(w,1) for w in item['tokens']], dtype=torch.long)  
    y = torch.tensor(item['ner_tags'], dtype=torch.long)  
    return x, y  
  

# DataLoader + å¡«åå½æ°  
def collate_fn(batch):  
    xs, ys = zip(*batch)  
    xs_pad = pad_sequence(xs, batch_first=True, padding_value=word_vocab["&lt;PAD&gt;"])  
    ys_pad = pad_sequence(ys, batch_first=True, padding_value=pad_tag_id)  
    return xs_pad.to(device), ys_pad.to(device)  
  
train_dataset = [encode(item) for item in train_data]  
valid_dataset = [encode(item) for item in valid_data]  
test_dataset  = [encode(item) for item in test_data]  
  
train_loader = DataLoader(train_dataset, batch_size=32, shuffle=True, collate_fn=collate_fn)  
valid_loader = DataLoader(valid_dataset, batch_size=32, shuffle=False, collate_fn=collate_fn)  
test_loader  = DataLoader(test_dataset, batch_size=32, shuffle=False, collate_fn=collate_fn)  
  

# RNN æ¨¡å  
class RNNTagger(nn.Module):  
    def __init__(self, vocab_size, hidden_dim, num_classes,  
                 rnn_type='RNN', bidirectional=False, num_layers=1):  
        super().__init__()  
        self.vocab_size = vocab_size  
        self.bidirectional = bidirectional  
        self.rnn_type = rnn_type.upper()  
  
        input_size = vocab_size  # ç¬ç­ç¼ç è¾å¥ç»´åº¦ = è¯è¡¨å¤§å°  
  
        if self.rnn_type == 'RNN':  
            self.rnn = nn.RNN(input_size, hidden_dim, batch_first=True,  
                              bidirectional=bidirectional, num_layers=num_layers)  
        elif self.rnn_type == 'LSTM':  
            self.rnn = nn.LSTM(input_size, hidden_dim, batch_first=True,  
                               bidirectional=bidirectional, num_layers=num_layers)  
        elif self.rnn_type == 'GRU':  
            self.rnn = nn.GRU(input_size, hidden_dim, batch_first=True,  
                              bidirectional=bidirectional, num_layers=num_layers)  
        else:  
            raise ValueError("rnn_type must be 'RNN','LSTM','GRU'")  
  
        self.fc = nn.Linear(hidden_dim * (2 if bidirectional else 1), num_classes)  
  
    def forward(self, x):  
        # x: [batch, seq_len], è½¬ç¬ç­  
        x_onehot = torch.nn.functional.one_hot(x, num_classes=self.vocab_size).float()  
        out, _ = self.rnn(x_onehot) # è¿RNN  
        out = self.fc(out) #è¿è¾åºå±  
        return out  
  
  
import matplotlib.pyplot as plt  
from matplotlib import rcParams  
  
 
rcParams['font.sans-serif'] = ['SimHei']    
rcParams['axes.unicode_minus'] = False    
  

# è®­ç» + éªè¯å½æ°
def train_validate(model, train_loader, valid_loader, epochs=5, lr=0.001):  
    model.to(device)  
    criterion = nn.CrossEntropyLoss(ignore_index=pad_tag_id)  
    optimizer = torch.optim.Adam(model.parameters(), lr=lr)  
  
    train_loss_history = []  
    train_acc_history  = []  
    val_acc_history    = []  
    val_f1_history     = []  
  
    epoch_times = []  
    total_start_time = time.time()  
  
    for epoch in range(epochs):  
        epoch_start_time = time.time()  
  
        # ========= è®­ç» =========        
        model.train()  
        total_loss = 0  
        total_correct = 0  
        total_tokens = 0  
  
        for x_batch, y_batch in train_loader:  
            optimizer.zero_grad()  
            outputs = model(x_batch)  
  
            outputs_reshape = outputs.view(-1, num_classes)  
            y_batch_reshape = y_batch.view(-1)  
  
            loss = criterion(outputs_reshape, y_batch_reshape)  
            loss.backward()  
            optimizer.step()  
            total_loss += loss.item()  
  
            preds = outputs.argmax(dim=-1)  
            for i in range(y_batch.size(0)):  
                mask = y_batch[i] != pad_tag_id  
                total_correct += (preds[i][mask] == y_batch[i][mask]).sum().item()  
                total_tokens += mask.sum().item()  
  
        avg_train_loss = total_loss / len(train_loader)  
        train_acc = total_correct / total_tokens  
  
        train_loss_history.append(avg_train_loss)  
        train_acc_history.append(train_acc)  
  
        # ========= éªè¯ =========        
        model.eval()  
        val_total_correct = 0  
        val_total_tokens = 0  
  
        all_preds = []  
        all_labels = []  
  
        with torch.no_grad():  
            for x_val, y_val in valid_loader:  
                outputs = model(x_val)  
                preds = outputs.argmax(dim=-1)  
  
                for i in range(y_val.size(0)):  
                    mask = y_val[i] != pad_tag_id  
  
                    val_total_correct += (preds[i][mask] == y_val[i][mask]).sum().item()  
                    val_total_tokens += mask.sum().item()  
  
                    all_preds.extend(preds[i][mask].cpu().tolist())  
                    all_labels.extend(y_val[i][mask].cpu().tolist())  
  
        val_acc = val_total_correct / val_total_tokens  
  
      
        val_f1 = f1_score(all_labels, all_preds, average='macro')  
  
        val_acc_history.append(val_acc)  
        val_f1_history.append(val_f1)  
  
        epoch_time = time.time() - epoch_start_time  
        epoch_times.append(epoch_time)  
  
        print(  
            f"è½®æ¬¡ {epoch+1}: "  
            f"è®­ç»æå¤±={avg_train_loss:.4f}, "  
            f"è®­ç»åç¡®ç={train_acc:.4f}, "  
            f"éªè¯åç¡®ç={val_acc:.4f}, "  
            f"éªè¯F1={val_f1:.4f}, "  
            f"æ¬è½®ç¨æ¶={epoch_time:.2f} ç§"  
        )  
  
    total_time = time.time() - total_start_time  
    avg_epoch_time = sum(epoch_times) / len(epoch_times)  
  
    print("\n======== è®­ç»æ¶é´ç»è®¡ ========")  
    print(f"æ»è®­ç»æ¶é´ï¼{total_time:.2f} ç§")  
    print(f"å¹³åæ¯è½®ç¨æ¶ï¼{avg_epoch_time:.2f} ç§")  
  
    history = {  
        'train_loss': train_loss_history,  
        'train_acc': train_acc_history,  
        'val_acc': val_acc_history,  
        'val_f1': val_f1_history  
    }  
    return model, history  
  
  
  

def plot_training_curves(history):  
    epochs = range(1, len(history['train_loss']) + 1)  
    fig, ax1 = plt.subplots(figsize=(10, 5))    
    ax1.plot(epochs, history['train_loss'], 'b-o', label='è®­ç»æå¤±')  
    ax1.set_xlabel("è½®æ¬¡", fontsize=12)  
    ax1.set_ylabel("è®­ç»æå¤±", color='b', fontsize=12)  
    ax1.tick_params(axis='y', labelcolor='b')  
    ax1.grid(True)  
    ax2 = ax1.twinx()  
    ax2.plot(epochs, history['train_acc'], 'g-o', label='è®­ç»åç¡®ç')  
    ax2.plot(epochs, history['val_acc'],   'r-o', label='éªè¯åç¡®ç')  
    ax2.plot(epochs, history['val_f1'],    'm-o', label='éªè¯ F1')  
    ax2.set_ylabel("ææ å¼", fontsize=12)  
    ax2.tick_params(axis='y')   
    lines1, labels1 = ax1.get_legend_handles_labels()  
    lines2, labels2 = ax2.get_legend_handles_labels()  
    ax2.legend(lines1 + lines2, labels1 + labels2, loc='lower right')  
    plt.title("è®­ç»æå¤±ãåç¡®çä¸ F1 æ²çº¿å¯¹æ¯", fontsize=14)  
    plt.tight_layout()  
    plt.show()  
  
if __name__ == '__main__':  
    # cfg = {'rnn_type': 'RNN', 'bidirectional': False, 'num_layers': 1}  
    # cfg = {'rnn_type':'RNN','bidirectional':True,'num_layers':1}    # cfg = {'rnn_type': 'GRU', 'bidirectional': True, 'num_layers': 1}    # cfg = {'rnn_type': 'LSTM', 'bidirectional': True, 'num_layers': 1}    cfg = {'rnn_type': 'LSTM', 'bidirectional': True, 'num_layers': 3}  
    model = RNNTagger(vocab_size=len(word_vocab),  
                      hidden_dim=128,  
                      num_classes=num_classes,  
                      rnn_type=cfg['rnn_type'],  
                      bidirectional=cfg['bidirectional'],  
                      num_layers=cfg['num_layers'])  
    model, history = train_validate(model, train_loader, valid_loader, epochs=10)  
    plot_training_curves(history)
</code></pre>
<h2 id="32-rnn-æ¨¡åè®­ç»ä»£ç -tfç">3.2 RNN æ¨¡åè®­ç»ä»£ç -TFç</h2>
<pre><code class="language-python">import time  
import numpy as np  
import tensorflow as tf  
from tensorflow.keras.layers import Layer, SimpleRNN, GRU, LSTM, Dense, Bidirectional, Input  
from tensorflow.keras.models import Model  
from tensorflow.keras.optimizers import Adam  
from datasets import load_dataset  
from collections import Counter  
from sklearn.metrics import f1_score  
import matplotlib.pyplot as plt  
from matplotlib import rcParams  
  
  
rcParams['font.sans-serif'] = ['SimHei']  
rcParams['axes.unicode_minus'] = False  
  
dataset = load_dataset("conll2003")  
train_data = dataset['train']  
valid_data = dataset['validation']  
test_data  = dataset['test']  
  
word_counter = Counter()  
tag_counter = Counter()  
  
for item in train_data:  
    word_counter.update(item['tokens'])  
    tag_counter.update(item['ner_tags'])  
  
# è¯è¡¨  
word_vocab = {w:i+2 for i,(w,_) in enumerate(word_counter.most_common())}  
word_vocab["&lt;PAD&gt;"] = 0  
word_vocab["&lt;UNK&gt;"] = 1  
vocab_size = len(word_vocab)  
  
# æ ç­¾è¡¨  
tag_vocab = {t:t for t in tag_counter.keys()}  
num_classes = len(tag_vocab)  
pad_tag_id = -100  # è®­ç»æ¶å¿½ç¥  
  
  
# ç¼ç å½æ°  
def encode(item):  
    x = [word_vocab.get(w, 1) for w in item['tokens']]  
    y = item['ner_tags']  
    return x, y  
  
train_dataset = [encode(item) for item in train_data]  
valid_dataset = [encode(item) for item in valid_data]  
test_dataset  = [encode(item) for item in test_data]  
  
  
# å¡«åå½æ°  
def pad_sequences(seqs, pad_value=0):  
    max_len = max(len(s) for s in seqs)  
    padded = [s + [pad_value]*(max_len - len(s)) for s in seqs]  
    return np.array(padded)  
  
def prepare_batch(dataset):  
    X = pad_sequences([x for x, y in dataset], pad_value=0)  
    y = pad_sequences([y for x, y in dataset], pad_value=pad_tag_id)  
    return X, y  
  
X_train, y_train = prepare_batch(train_dataset)  
X_valid, y_valid = prepare_batch(valid_dataset)  
X_test,  y_test  = prepare_batch(test_dataset)  
  
  
class OneHotLayer(Layer):  
    def __init__(self, depth, **kwargs):  
        super().__init__(**kwargs)  
        self.depth = depth  
  
    def call(self, inputs):  
        return tf.one_hot(inputs, depth=self.depth, dtype=tf.float32)  
  
  
def build_rnn_model(vocab_size, num_classes, hidden_dim=128, rnn_type='RNN', bidirectional=False, num_layers=1):  
    inputs = Input(shape=(None,), dtype=tf.int32)  
    x = OneHotLayer(depth=vocab_size)(inputs)  
  
    for i in range(num_layers):  
        return_seq = True  
        rnn_layer = None  
        if rnn_type.upper() == 'RNN':  
            rnn_layer = SimpleRNN(hidden_dim, return_sequences=return_seq)  
        elif rnn_type.upper() == 'GRU':  
            rnn_layer = GRU(hidden_dim, return_sequences=return_seq)  
        elif rnn_type.upper() == 'LSTM':  
            rnn_layer = LSTM(hidden_dim, return_sequences=return_seq)  
        else:  
            raise ValueError("rnn_type must be 'RNN','LSTM','GRU'")  
        if bidirectional:  
            rnn_layer = Bidirectional(rnn_layer)  
        x = rnn_layer(x)  
  
    outputs = Dense(num_classes, activation='softmax')(x)  
    model = Model(inputs, outputs)  
    return model  
  
def train_validate(model, X_train, y_train, X_valid, y_valid, batch_size=32, epochs=5, lr=0.001):  
    optimizer = Adam(learning_rate=lr)  
    loss_fn = tf.keras.losses.SparseCategoricalCrossentropy(ignore_class=pad_tag_id)  
  
    train_loss_history = []  
    train_acc_history  = []  
    val_acc_history    = []  
    val_f1_history     = []  
  
    train_data = tf.data.Dataset.from_tensor_slices((X_train, y_train)).shuffle(1000).batch(batch_size)  
    valid_data = tf.data.Dataset.from_tensor_slices((X_valid, y_valid)).batch(batch_size)  
  
    for epoch in range(epochs):  
        start_time = time.time()  
        total_loss = 0  
        total_correct = 0  
        total_tokens = 0  
  
        # ========= è®­ç» =========        
        for step, (x_batch, y_batch) in enumerate(train_data):  
            with tf.GradientTape() as tape:  
                logits = model(x_batch, training=True)  
                loss = loss_fn(y_batch, logits)  
            grads = tape.gradient(loss, model.trainable_variables)  
            optimizer.apply_gradients(zip(grads, model.trainable_variables))  
            total_loss += loss.numpy()  
  
            preds = tf.argmax(logits, axis=-1,output_type=tf.int32)  
            mask = y_batch != pad_tag_id  
            total_correct += tf.reduce_sum(tf.cast(preds[mask] == y_batch[mask], tf.float32)).numpy()  
            total_tokens += tf.reduce_sum(tf.cast(mask, tf.float32)).numpy()  
  
        train_loss_history.append(total_loss / len(train_data))  
        train_acc_history.append(total_correct / total_tokens)  
  
        # ========= éªè¯ =========        
        all_preds = []  
        all_labels = []  
        total_correct_val = 0  
        total_tokens_val = 0  
  
        for x_batch, y_batch in valid_data:  
            logits = model(x_batch, training=False)  
            preds = tf.argmax(logits, axis=-1,output_type=tf.int32)  
            mask = y_batch != pad_tag_id  
  
            total_correct_val += tf.reduce_sum(tf.cast(preds[mask] == y_batch[mask], tf.float32)).numpy()  
            total_tokens_val += tf.reduce_sum(tf.cast(mask, tf.float32)).numpy()  
  
            all_preds.extend(preds[mask].numpy())  
            all_labels.extend(y_batch[mask].numpy())  
  
        val_acc = total_correct_val / total_tokens_val  
        val_f1  = f1_score(all_labels, all_preds, average='macro')  
  
        val_acc_history.append(val_acc)  
        val_f1_history.append(val_f1)  
  
        epoch_time = time.time() - start_time  
        print(f"è½®æ¬¡ {epoch+1}: è®­ç»æå¤±={train_loss_history[-1]:.4f}, "  
              f"è®­ç»åç¡®ç={train_acc_history[-1]:.4f}, "  
              f"éªè¯åç¡®ç={val_acc:.4f}, éªè¯ F1={val_f1:.4f}, "  
              f"æ¬è½®ç¨æ¶={epoch_time:.2f} ç§")  
  
    history = {  
        'train_loss': train_loss_history,  
        'train_acc': train_acc_history,  
        'val_acc': val_acc_history,  
        'val_f1': val_f1_history  
    }  
    return history  
  
def plot_training_curves(history):  
    epochs = range(1, len(history['train_loss']) + 1)  
    fig, ax1 = plt.subplots(figsize=(10, 5))  
    ax1.plot(epochs, history['train_loss'], 'b-o', label='è®­ç»æå¤±')  
    ax1.set_xlabel("è½®æ¬¡", fontsize=12)  
    ax1.set_ylabel("è®­ç»æå¤±", color='b', fontsize=12)  
    ax1.tick_params(axis='y', labelcolor='b')  
    ax1.grid(True)  
  
    ax2 = ax1.twinx()  
    ax2.plot(epochs, history['train_acc'], 'g-o', label='è®­ç»åç¡®ç')  
    ax2.plot(epochs, history['val_acc'], 'r-o', label='éªè¯åç¡®ç')  
    ax2.plot(epochs, history['val_f1'], 'm-o', label='éªè¯ F1')  
    ax2.set_ylabel("ææ å¼", fontsize=12)  
    ax2.tick_params(axis='y')  
  
    lines1, labels1 = ax1.get_legend_handles_labels()  
    lines2, labels2 = ax2.get_legend_handles_labels()  
    ax2.legend(lines1 + lines2, labels1 + labels2, loc='lower right')  
  
    plt.title("è®­ç»æå¤±ãåç¡®çä¸ F1 æ²çº¿å¯¹æ¯", fontsize=14)  
    plt.tight_layout()  
    plt.show()  
  
if __name__ == '__main__':  
    cfg = {'rnn_type':'RNN','bidirectional':True,'num_layers':1}  
    model = build_rnn_model(vocab_size=vocab_size,  
                            num_classes=num_classes,  
                            hidden_dim=128,  
                            rnn_type=cfg['rnn_type'],  
                            bidirectional=cfg['bidirectional'],  
                            num_layers=cfg['num_layers'])  
    history = train_validate(model, X_train, y_train, X_valid, y_valid, batch_size=32, epochs=10, lr=0.001)  
    plot_training_curves(history)
</code></pre>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.013194444444444444" data-date-updated="2026-01-15 13:22">2026-01-15 13:03</span>&nbsp;
<a href="https://www.cnblogs.com/Goblinscholar">å¥å¸æå­¦è</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19484728);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19484728', targetLink: 'https://www.cnblogs.com/Goblinscholar/p/19484728', title: 'å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºï¼èªç¶è¯­è¨å¤ç  ç¬¬ä¸å¨ï¼å¾ªç¯ç¥ç»ç½ç»  è¯¾åä¹ é¢ä¸ä»£ç å®è·µ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ FastAPIç¼å­æéå®æï¼ææææä½ ç¨Redisä¸ºæ¥å£æ³¨å¥âè®°å¿â ]]></title>
    <link>https://www.cnblogs.com/ymtianyu/p/19485724</link>
    <guid>40333e9ac49058715b111f17795826f7</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ymtianyu/p/19485724" title="åå¸äº 2026-01-15 11:14">
    <span role="heading" aria-level="2">FastAPIç¼å­æéå®æï¼ææææä½ ç¨Redisä¸ºæ¥å£æ³¨å¥âè®°å¿â</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æå°è¯¦ç»ä»ç»å¦ä½å¨FastAPIåºç¨ä¸­éæRediså®ç°é«æçæ°æ®ç¼å­ãåå®¹æ¶µçRedisçæ ¸å¿ä½ç¨ä¸ä¼å¿ãå¨ä¸»è¦æä½ç³»ç»ä¸çå®è£ä¸éç½®æ­¥éª¤ãå¿é¡»ææ¡çå¸¸ç¨å½ä»¤ï¼å¹¶éè¿ä¸ä¸ªå®æ´çå®æç¤ºä¾ï¼å±ç¤ºå¦ä½ç¼åä¸ä¸ªå¯å¤ç¨çç¼å­è£é¥°å¨æ¥æ¾èæåæ¥å£æ§è½ï¼æååäº«ç¼å­ç­ç¥çæ³¨æäºé¡¹ä¸è¿é¶æèã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>ä½ çFastAPIæ¥å£æ¯ä¸æ¯å¨é«å¹¶åä¸è¶æ¥è¶æ¢ï¼æ°æ®åºé¢é¢åè­¦ï¼</p>
<p>ä¸ä¸ªæ¡ä¾ï¼ä¸ä¸ªæ ¸å¿æ¥è¯¢æ¥å£ï¼å¨æ¥æ´»ä»5ä¸æ¶ï¼å¹³åååºæ¶é´å°±é£åå°äº1.2ç§ãææ¥ååç°ï¼è¶è¿80%çè¯·æ±é½å¨éå¤æ¥è¯¢æ°æ®åºéé£å æ¡å ä¹ä¸åçç­ç¹æ°æ®ãå¨å¼å¥Redisç¼å­åï¼è¿ä¸ªæ¥å£ç<strong style="color: rgba(186, 55, 42, 1)">å¹³åååºæ¶é´ç´æ¥éå°äº0.2ç§ä»¥å</strong>ï¼æ°æ®åºè´è½½ä¸éäº70%ãè¿ï¼å°±æ¯ç¼å­çé­åã</p>
<p>ä»å¤©ï¼æä»¬å°±æ¥èèå¦ä½ä¸ºä½ FastAPIé¡¹ç®è£ä¸Redisè¿ä¸ªâé«éç¼å­âï¼è®©å®æ¥æâè®°å¿âï¼ä¸åæ¯æ¬¡é½å»å»å°éå¤å³å¨ã</p>
<h2>ð æ¬æä½ å°å­¦å°ï¼</h2>
<div>
<p>ð¯ 1. Redisæ¯ä»ä¹ï¼ä¸ºä»ä¹å®æ¯ç¼å­çé¦éï¼</p>
<p>ð¯ 2. å¦ä½å¿«éå®è£ãéç½®Redisã</p>
<p>ð¯ 3. å¿é¡»ææ¡çRedisæ ¸å¿å½ä»¤ã</p>
<p>ð¯ 4. ç¼åä¸ä¸ªéç¨çFastAPIç¼å­è£é¥°å¨ï¼ä¸å³æ°¸é¸ã</p>
</div>
<hr style="border: none; height: 1px; background: linear-gradient(90deg, rgba(0, 0, 0, 0), rgba(52, 152, 219, 1), rgba(0, 0, 0, 0)); margin: 20px 0">
<h2>ð§ ç¬¬ä¸é¨åï¼é®é¢ä¸èæ¯ - ä¸ºä»ä¹éè¦ç¼å­ï¼</h2>
<p>æ³è±¡ä¸ä¸ï¼ä½ æ¯é¤åï¼ä½ çWebæå¡ï¼çæå¡åï¼APIæ¥å£ï¼ãæ¯æ¬¡å®¢äººï¼å®¢æ·ç«¯ï¼ç¹ä¸ä»½âä»æ¥ç¹è²èâï¼ç­é¨æ°æ®ï¼ï¼ä½ é½éå¾è·ååå¨ï¼æ°æ®åºï¼é®å¨å¸ä¸éï¼å°½ç®¡è¿éèä¸å¤©é½ä¸ä¼åãç»æå°±æ¯ï¼ä½ ç´¯è¶´äºï¼åå¨ä¹è¢«ä½ é®ç¦äºï¼å®¢äººè¿å«ä¸èæ¢ã</p>
<p>ç¼å­ï¼å°±åæ¯ä½ å¨ååæ¾äºä¸ªå°æ¬å­ï¼Redisï¼ãç¬¬ä¸æ¬¡æå®¢äººç¹âä»æ¥ç¹è²èâï¼ä½ å»åå¨é®äºï¼ç¶å<strong style="color: rgba(186, 55, 42, 1)">æèååä»·æ ¼è®°å¨æ¬å­ä¸</strong>ãæ¥ä¸æ¥åæå®¢äººç¹ï¼ä½ ç´æ¥çä¸ç¼æ¬å­å°±åè¯ä»ï¼éåº¦å¿«äºååãåªæå½ç¹è²èæ´æ¢äºï¼æ°æ®åæ´ï¼ï¼ä½ æéè¦å»æ´æ°å°æ¬å­ã</p>
<p>å¨ææ¯å±é¢ï¼ç¼å­ä¸»è¦è§£å³ä¸¤ä¸ªé®é¢ï¼<strong style="color: rgba(186, 55, 42, 1)">1. æåæ°æ®è¯»åéåº¦</strong>ï¼åå­è¿å¿«äºç£ç/ç½ç»ï¼ï¼<strong style="color: rgba(186, 55, 42, 1)">2. åè½»åç«¯æ°æ®åºåå</strong>ã</p>
<h2>âï¸ ç¬¬äºé¨åï¼Redisæ ¸å¿ä¸å®è£éç½®</h2>
<h3>ð¯ Redisæ¯ä»ä¹ï¼</h3>
<p>Redisæ¯ä¸ä¸ªå¼æºãåºäºåå­ãå¯æä¹åç<code style="color: rgba(186, 55, 42, 1)">é®å¼å¯¹(Key-Value)</code>å­å¨ç³»ç»ãå®æ¯æå¤ç§æ°æ®ç»æï¼å­ç¬¦ä¸²ãåå¸ãåè¡¨ãéåç­ï¼ï¼æ§è½æé«ï¼å¸¸è¢«ç¨ä½æ°æ®åºãç¼å­åæ¶æ¯ä¸­é´ä»¶ãå¯¹äºç¼å­åºæ¯ï¼æä»¬ä¸»è¦çä¸­å®ï¼<strong style="color: rgba(186, 55, 42, 1)">åå­å­å¨éåº¦æå¿«</strong>ã<strong style="color: rgba(186, 55, 42, 1)">æ°æ®ç»æä¸°å¯</strong>ã<strong style="color: rgba(186, 55, 42, 1)">æ¯æè®¾ç½®è¿ææ¶é´</strong>ã</p>
<h3>ð¯ å®è£Redisï¼åå¹³å°éç¨æ­¥éª¤ï¼</h3>
<div>
<p><strong>1. macOS (ä½¿ç¨Homebrew):</strong></p>
<div>
<p>- æå¼ç»ç«¯ï¼æ§è¡ï¼<code style="color: rgba(186, 55, 42, 1)">brew install redis</code></p>
<p>- å¯å¨æå¡ï¼<code style="color: rgba(186, 55, 42, 1)">brew services start redis</code></p>
</div>
<p><strong>2. Linux (ä»¥Ubuntuä¸ºä¾):</strong></p>
<div>
<p>- æ´æ°åç®¡çå¨ï¼<code style="color: rgba(186, 55, 42, 1)">sudo apt update</code></p>
<p>- å®è£Redisï¼<code style="color: rgba(186, 55, 42, 1)">sudo apt install redis-server</code></p>
<p>- å¯å¨æå¡ï¼<code style="color: rgba(186, 55, 42, 1)">sudo systemctl start redis</code></p>
</div>
<p><strong>3. Windows:</strong></p>
<div>
<p>å®æ¹ä¸æ¯æWindowsåçå®è£ï¼ä½å¯ä»¥éè¿ï¼</p>
<p>- ä½¿ç¨WSL2ï¼æ¨èï¼å¨WSLçUbuntuä¸­æLinuxæ¹æ³å®è£ï¼ã</p>
<p>- æä¸è½½å¾®è½¯ç»´æ¤çæ§çæ¬Windowsç§»æ¤çï¼ä¸æ¨èç¨äºçäº§ï¼ã</p>
</div>
</div>
<p>å®è£å®æåï¼å¨ç»ç«¯è¾å¥ <code style="color: rgba(186, 55, 42, 1)">redis-cli ping</code>ï¼å¦æè¿å <code style="color: rgba(186, 55, 42, 1)">PONG</code>ï¼æ­åä½ ï¼Redisæå¡å·²æåè¿è¡ï¼</p>
<h3>ð¯ ä½ å¿é¡»ææ¡ç5ä¸ªRedisç¼å­æ ¸å¿å½ä»¤</h3>
<div>
<p><strong>1. SETï¼ è®¾ç½®é®å¼å¯¹</strong></p>
<pre class="language-dockerfile highlighter-hljs"><code>SET user:1001 '{"name": "Alice", "age": 30}' EX 60
# é®ï¼user:1001ï¼ å¼ï¼JSONå­ç¬¦ä¸²ï¼ EX 60è¡¨ç¤º60ç§åè¿æ</code></pre>
<p><strong>2. GETï¼ è·åé®å¯¹åºçå¼</strong></p>
<pre class="language-sql highlighter-hljs"><code>GET user:1001</code></pre>
<p><strong>3. EXISTSï¼ æ£æ¥é®æ¯å¦å­å¨</strong></p>
<pre class="language-dockerfile highlighter-hljs"><code>EXISTS user:1001 # è¿å1(å­å¨)æ0(ä¸å­å¨)</code></pre>
<p><strong>4. DELï¼ å é¤ä¸ä¸ªæå¤ä¸ªé®</strong></p>
<pre class="language-sql highlighter-hljs"><code>DEL user:1001 user:1002</code></pre>
<p><strong>5. TTLï¼ æ¥çé®çå©ä½çå­æ¶é´(ç§)</strong></p>
<pre class="language-dockerfile highlighter-hljs"><code>TTL user:1001 # è¿åå©ä½ç§æ°ï¼-1è¡¨ç¤ºæ°¸ä¸è¿æï¼-2è¡¨ç¤ºé®ä¸å­å¨</code></pre>
</div>
<h2>ð ç¬¬ä¸é¨åï¼FastAPIæ´åRediså®ææ¼ç¤º</h2>
<p>çè®ºè¯´åå¤ï¼ä¸å¦ä¸è¡ä»£ç ãè®©æä»¬å¼å§å®æï¼æå»ºä¸ä¸ªå¸¦ç¼å­çFastAPIåºç¨ã</p>
<h3>ð¯ ç¬¬ä¸æ­¥ï¼å®è£ä¾èµ</h3>
<pre class="highlighter-hljs" style="background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px; overflow-x: auto"><code>pip install fastapi uvicorn redis python-dotenv</code></pre>
<h3>ð¯ ç¬¬äºæ­¥ï¼é¡¹ç®ç»æä¸éç½®</h3>
<pre class="highlighter-hljs" style="background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px; overflow-x: auto"><code>your_project/
âââ main.py
âââ cache.py
âââ .env
âââ requirements.txt</code></pre>
<p>å¨<code style="color: rgba(186, 55, 42, 1)">.env</code>æä»¶ä¸­éç½®Redisè¿æ¥ï¼</p>
<pre class="highlighter-hljs" style="background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px; overflow-x: auto"><code>REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=  # é»è®¤æ å¯ç ï¼çäº§ç¯å¢ä¸å®è¦è®¾ï¼
CACHE_DEFAULT_TTL=3600  # é»è®¤ç¼å­è¿ææ¶é´1å°æ¶</code></pre>
<h3>ð¯ ç¬¬ä¸æ­¥ï¼åå»ºRedisè¿æ¥ä¸ç¼å­å·¥å·ç±» (cache.py)</h3>
<pre class="language-python highlighter-hljs"><code>import redis.asyncio as redis  # ä½¿ç¨å¼æ­¥å®¢æ·ç«¯
import json
from functools import wraps
from typing import Any, Optional
import os
from dotenv import load_dotenv

load_dotenv()

class RedisCache:
    def __init__(self):
        self.redis_client: Optional[redis.Redis] = None
        self.default_ttl = int(os.getenv(âCACHE_DEFAULT_TTLâ, 3600))

    async def connect(self):
        """è¿æ¥Redis"""
        if not self.redis_client:
            self.redis_client = redis.Redis(
                host=os.getenv(âREDIS_HOSTâ, âlocalhostâ),
                port=int(os.getenv(âREDIS_PORTâ, 6379)),
                db=int(os.getenv(âREDIS_DBâ, 0)),
                password=os.getenv(âREDIS_PASSWORDâ),
                decode_responses=True  # èªå¨è§£ç è¿åå­ç¬¦ä¸²
            )
        return self.redis_client

    async def disconnect(self):
        """å³é­è¿æ¥"""
        if self.redis_client:
            await self.redis_client.close()

    def cache_key(self, func_name: str, *args, **kwargs) -&gt; str:
        """çæå¯ä¸çç¼å­é®"""
        # ç®åç¤ºä¾ï¼å°å½æ°åååæ°åºåååæ¼æ¥
        arg_str = â_â.join([str(arg) for arg in args])
        kwarg_str = â_â.join([fâ{k}_{v}â for k, v in sorted(kwargs.items())])
        return fâfastapi_cache:{func_name}:{arg_str}:{kwarg_str}â.strip(â:â)

    async def get(self, key: str) -&gt; Any:
        """ä»ç¼å­è·åæ°æ®"""
        if not self.redis_client:
            await self.connect()
        data = await self.redis_client.get(key)
        if data:
            try:
                return json.loads(data)  # ååºååJSON
            except json.JSONDecodeError:
                return data  # å¦æä¸æ¯JSONï¼è¿ååå§å­ç¬¦ä¸²
        return None

    async def set(self, key: str, value: Any, ttl: Optional[int] = None) -&gt; bool:
        """è®¾ç½®ç¼å­"""
        if not self.redis_client:
            await self.connect()
        if isinstance(value, (dict, list)):
            value = json.dumps(value)  # åºååå¤æå¯¹è±¡
        expire_time = ttl if ttl is not None else self.default_ttl
        return await self.redis_client.setex(key, expire_time, value)

    async def delete(self, key: str) -&gt; int:
        """å é¤ç¼å­"""
        if not self.redis_client:
            await self.connect()
        return await self.redis_client.delete(key)

# å¨å±ç¼å­å®ä¾
cache = RedisCache()

def cached(ttl: Optional[int] = None):
    """ç¼å­è£é¥°å¨ï¼å¯å¤ç¨äºä»»ä½å¼æ­¥å½æ°"""
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, **kwargs):
            # çæç¼å­é®
            key = cache.cache_key(func.__name__, *args, **kwargs)
            # å°è¯ä»ç¼å­è·å
            cached_result = await cache.get(key)
            if cached_result is not None:
                print(fâCache HIT for key: {key}â)
                return cached_result
            # ç¼å­æªå½ä¸­ï¼æ§è¡åå½æ°
            print(fâCache MISS for key: {key}â)
            result = await func(*args, **kwargs)
            # å°ç»æå­å¥ç¼å­
            await cache.set(key, result, ttl)
            return result
        return wrapper
    return decorator</code></pre>
<h3>ð¯ ç¬¬åæ­¥ï¼å¨FastAPIåºç¨ä¸­ä½¿ç¨ (main.py)</h3>
<pre class="highlighter-hljs" style="background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px; overflow-x: auto"><code>from fastapi import FastAPI, Depends, HTTPException
from cache import cache, cached
import asyncio

app = FastAPI(title=âFastAPI Redisç¼å­æ¼ç¤ºâ)

# åºç¨å¯å¨åå³é­äºä»¶
@app.on_event(âstartupâ)
async def startup_event():
    await cache.connect()
    print(ââ Redis connectedâ)

@app.on_event(âshutdownâ)
async def shutdown_event():
    await cache.disconnect()
    print(âð Redis disconnectedâ)

# --- æ¨¡æä¸ä¸ªèæ¶çæ°æ®æ¥è¯¢å½æ° ---
async def fetch_user_data_from_db(user_id: int):
    """æ¨¡æä»æ°æ®åºæ¥è¯¢ç¨æ·æ°æ®ï¼èæ¶æä½ï¼"""
    await asyncio.sleep(2)  # æ¨¡æ2ç§çIOå»¶è¿
    return {âidâ: user_id, ânameâ: fâç¨æ·_{user_id}â, âscoreâ: user_id * 10}

# --- åºç¨ç¼å­çæ¥å£ ---
@app.get(â/user/{user_id}â)
@cached(ttl=30)  # ä¸ºæ­¤æ¥å£åç¬è®¾ç½®30ç§ç¼å­
async def get_user(user_id: int):
    """è·åç¨æ·ä¿¡æ¯ï¼å¸¦ç¼å­ï¼"""
    data = await fetch_user_data_from_db(user_id)
    return {âsourceâ: âdatabase (cached later)â, âdataâ: data}

@app.get(â/user/{user_id}/freshâ)
async def get_user_fresh(user_id: int):
    """è·åç¨æ·ä¿¡æ¯ï¼å¼ºå¶æ¥æ°æ®åºï¼ä¸ç¼å­ï¼"""
    data = await fetch_user_data_from_db(user_id)
    return {âsourceâ: âdatabase (fresh)â, âdataâ: data}

@app.delete(â/cache/user/{user_id}â)
async def delete_user_cache(user_id: int):
    """æå¨å é¤æä¸ªç¨æ·çç¼å­"""
    # æ³¨æï¼è¿ééè¦æ¨¡æçæåæ¥å£ä¸è´çç¼å­é®ï¼å®æä¸­å¯è½éè¦æ´å¤æçé®ç®¡ç
    key_pattern = fâfastapi_cache:get_user:{user_id}â
    deleted = await cache.delete(key_pattern)
    if deleted:
        return {âmessageâ: fâCache for user {user_id} deleted.â}
    raise HTTPException(status_code=404, detail=âCache key not foundâ)

if __name__ == â__main__â:
    import uvicorn
    uvicorn.run(âmain:appâ, host=â0.0.0.0â, port=8000, reload=True)</code></pre>
<p>ç°å¨ï¼è¿è¡<code style="color: rgba(186, 55, 42, 1)">python main.py</code>å¹¶è®¿é® <code style="color: rgba(186, 55, 42, 1)">http://localhost:8000/docs</code> æ¥çèªå¨çæçAPIææ¡£ã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">æµè¯ææï¼</strong></p>
<div>
<p>- é¦æ¬¡è®¿é® <code style="color: rgba(186, 55, 42, 1)">/user/1</code>ï¼ä¼ç­å¾çº¦2ç§ï¼è¿åæ¥æºä¸º<span style="color: rgba(186, 55, 42, 1)"><code>database</code></span>ã</p>
<p>- <strong>30ç§å</strong>åæ¬¡è®¿é® <code style="color: rgba(186, 55, 42, 1)">/user/1</code>ï¼ç¬é´è¿åï¼æ¥æºæ°æ®æ¥èªç¼å­ï¼æ§å¶å°ä¼æå°<span style="color: rgba(186, 55, 42, 1)"><code>Cache HIT</code></span>ã</p>
<p>- è®¿é® <code style="color: rgba(186, 55, 42, 1)">/user/1/fresh</code> åæ»æ¯è®¿é®âæ°æ®åºâã</p>
<p>- è°ç¨ <code style="color: rgba(186, 55, 42, 1)">DELETE /cache/user/1</code> å¯ä»¥æå¨æ¸é¤ç¼å­ã</p>
</div>
<h2>ð¡ ç¬¬åé¨åï¼æ³¨æäºé¡¹ä¸è¿é¶æè</h2>
<div>
<p><strong>1. ç¼å­ç©¿éï¼</strong> æ¥è¯¢ä¸ä¸ªä¸å­å¨çæ°æ®ï¼å¦<span style="color: rgba(186, 55, 42, 1)"><code>user_id=-1</code></span>ï¼ï¼ç¼å­æ°¸è¿ä¸ä¼å½ä¸­ï¼è¯·æ±æ¯æ¬¡é½æå°æ°æ®åºã</p>
<div>
<p>- <strong>è§£å³æ¹æ¡ï¼</strong> å³ä½¿æ²¡æ¥å°æ°æ®ï¼ä¹ç¼å­ä¸ä¸ªç©ºå¼æç¹æ®æ è®°ï¼å¦<span style="color: rgba(186, 55, 42, 1)"><code>NULL</code></span>ï¼ï¼å¹¶è®¾ç½®ä¸ä¸ªè¾ç­çè¿ææ¶é´ã</p>
</div>
<p><strong>2. ç¼å­éªå´©ï¼</strong> å¤§éç¼å­é®å¨åä¸æ¶å»è¿æï¼å¯¼è´ææè¯·æ±ç¬é´æ¶åæ°æ®åºã</p>
<div>
<p>- <strong>è§£å³æ¹æ¡ï¼</strong> ä¸ºç¼å­è¿ææ¶é´æ·»å ä¸ä¸ªéæºå¼ï¼å¦<span style="color: rgba(186, 55, 42, 1)"><code>åºç¡TTL + random.randint(0, 300)</code></span>ï¼ï¼é¿åéä½å¤±æã</p>
</div>
<p><strong>3. ç¼å­æ´æ°ç­ç¥ï¼</strong> æ°æ®åæ´æ¶ï¼å¦ä½åæ­¥æ´æ°ç¼å­ï¼å¸¸ç¨âåæ¶å é¤âï¼Cache-Asideï¼ã</p>
<div>
<p>- æ´æ°æ°æ®åºåï¼<strong style="color: rgba(186, 55, 42, 1)">ç«å³å é¤</strong>å¯¹åºçç¼å­é®ãä¸æ¬¡è¯»åæ¶èªç¶åæºå¹¶éæ°ç¼å­ã</p>
</div>
<p><strong>4. åºååï¼</strong> ç¼å­å¤æå¯¹è±¡ï¼å¦Pydanticæ¨¡åï¼æ¶ï¼è¦ç¡®ä¿å®ä»¬è½è¢«JSONåºååãå¯ä»¥ä½¿ç¨<span style="color: rgba(186, 55, 42, 1)"><code>.dict()</code></span>æ¹æ³å°å¶è½¬ä¸ºå­å¸ã</p>
<p><strong>5. é®çè®¾è®¡ï¼</strong> æ¸æ°çé®å½åç©ºé´ï¼å¦<span style="color: rgba(186, 55, 42, 1)"><code>app:entity:id</code></span>ï¼ä¾¿äºç®¡çåæ¹éæä½ï¼ä½¿ç¨<span style="color: rgba(186, 55, 42, 1)"><code>KEYS</code></span>æ<span style="color: rgba(186, 55, 42, 1)"><code>SCAN</code></span>å½ä»¤ï¼çäº§ç¯å¢æç¨<span style="color: rgba(186, 55, 42, 1)"><code>KEYS</code></span>ï¼ã</p>
<p><strong>6. æéè¦çä¸ç¹ï¼</strong> <strong style="color: rgba(186, 55, 42, 1)">ç¼å­ä¸æ¯ä¸è½çï¼å®æ¯ä¸ç§ç¨ç©ºé´æ¢æ¶é´çæè¡¡ã</strong> ä¸è¦ç¼å­é¢ç¹ååçæ°æ®ãæå°ç»æéæå·²ç»å¾å¿«çæ¥è¯¢ãå§ç»çæ§ç¼å­å½ä¸­çï¼å®æ¯è¡¡éç¼å­æççå³é®ææ ã</p>
</div>
<hr style="border: none; height: 1px; margin: 40px 0">
<p style="text-align: center">---<strong>åå¨æå</strong>---<br>å¸æè¿ä»½æ»ç»è½å¸®ä½ é¿å¼ä¸äºåãå¦æè§å¾æç¨ï¼ä¸å¦¨ç¹ä¸ª èµð æ æ¶èâ­ æ è®°ä¸ä¸ï¼æ¹ä¾¿éæ¶åé¡¾ãä¹æ¬¢è¿å³æ³¨æï¼åç»­ä¸ºä½ å¸¦æ¥æ´å¤ç±»ä¼¼çå®æè§£æãæä»»ä½çé®ææ³æ³ï¼æä»¬è¯è®ºåºè§ï¼ä¸èµ·äº¤æµå¼åä¸­çåç§å¿å¾ä¸é®é¢ã</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-15 11:14">2026-01-15 11:14</span>&nbsp;
<a href="https://www.cnblogs.com/ymtianyu">ä¸åç¨åºåªå</a>&nbsp;
éè¯»(<span id="post_view_count">60</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19485724);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19485724', targetLink: 'https://www.cnblogs.com/ymtianyu/p/19485724', title: 'FastAPIç¼å­æéå®æï¼ææææä½ ç¨Redisä¸ºæ¥å£æ³¨å¥âè®°å¿â' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å¦ä½ä¸æ­¥æ­¥å° ASP.NET MVC åçº§ä¸º.NET ]]></title>
    <link>https://www.cnblogs.com/powertoolsteam/p/19486260</link>
    <guid>eef0fda8e9295eb819c7b747ea7da91f</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/powertoolsteam/p/19486260" title="åå¸äº 2026-01-15 10:55">
    <span role="heading" aria-level="2">å¦ä½ä¸æ­¥æ­¥å° ASP.NET MVC åçº§ä¸º.NET</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å¼è¨">å¼è¨</h2>
<p>å° ASP.NET MVC åºç¨ä».NET Framework åçº§å°ç°ä»£.NET å¹¶ä¸æ¯ç®åççæ¬æåãæ­¤æ¬¡è¿ç§»ä»£è¡¨äºè¿è¡æ¶ãæç®¡æ¨¡åãéç½®ç³»ç»ãä¾èµæ³¨å¥å HTTP æµæ°´çº¿æ¶æçè½¬åãè®¸å¤å¢éä½ä¼°äºè¿ä¸ç¹ï¼æå®å½ä½æ åçæ¡æ¶åçº§ï¼ç»æå¨æµç¨åææåç°ä»ä»¬åºç¨ä¸­çæ ¸å¿åè®¾å·²ç»ä¸åæç«ã</p>
<p>å¥½æ¶æ¯æ¯ï¼Microsoft æä¾äºæç¡®çæå¯¼åæ¨¡å¼ï¼ä½¿å¾æ­£ç¡®æä½æ¶è¿ç§»è¿ç¨å¯é¢æµãæ¬æä»ç»äºä¸ä¸ªå®ç¨çéæ­¥ç­ç¥ï¼å¦ä½å°åºäº.NET Framework æå»ºç ASP.NET MVC 5 åºç¨è¿ç§»å°è¿è¡å¨ç°ä»£.NET ä¸ç ASP.NET Coreï¼åæ¶æå¤§éåº¦å°åå°é£é©ååæºæ¶é´ã</p>
<p>æ¬æåæ¯ä¸ºå·²ç»äºè§£ ASP.NET MVC å¹¶å¸ææä¸æ¡åå®å¯è¡ãåå¤å¥½çäº§çå¼åèåçã</p>
<h3 id="æ­¥éª¤1æ ¹æ®åºç¨å¤§å°éæ©è¿ç§»è·¯å¾">æ­¥éª¤1ï¼æ ¹æ®åºç¨å¤§å°éæ©è¿ç§»è·¯å¾</h3>
<p>éæ©è¿ä¸¤æ¡è·¯ä¸­çä¸æ¡ï¼</p>
<ol>
<li>
<p><strong>å¤§å¤æ°çå®åºç¨çå¢éè¿ç§»</strong><br>
ä½ ä¼å¨æ§åºç¨åé¢æ­å»ºä¸ä¸ªæ°ç ASP.NET Core åºç¨ï¼éæ­¥è¿ç§»è·¯ç±ååè½ï¼è¿ç§»æ¶ä¿ææ§åºç¨çå­å¨ãMicrosoft æ¨èè¿ç§æ¹æ³ç¨äºå¤§è§æ¨¡è¿ç§»ã</p>
</li>
<li>
<p><strong>å°ååºç¨ç Big Bang è¿ç§»</strong><br>
ä½ åå»ºä¸ä¸ªæ°ç ASP.NET Core MVC åºç¨ï¼ç§»æ¤æ§å¶å¨ãè§å¾åæå¡ï¼ç´å°ä¸åè¿è¡å®æ¯ï¼ç¶ååæ¢ã</p>
</li>
</ol>
<p>å¦æä¸ç¡®å®ï¼é»è®¤éç¨å¢éè¿ç§»ï¼å ä¸ºè¿æ ·å¯ä»¥éä½åæ¢é£é©ã</p>
<h3 id="æ­¥éª¤2æ¸ç¹ä»ä¹ä¼é»æ¡ä½ ">æ­¥éª¤2ï¼æ¸ç¹ä»ä¹ä¼é»æ¡ä½ </h3>
<p>ååºè¿ç§»è¿ç¨ä¸­å¸¸éè¦æ¹è¿çä¾èµååºç¨åè½ï¼</p>
<ul>
<li>
<p><strong>System.Web çä½¿ç¨</strong><br>
å HttpContext.CurrentãHttpModulesãHttpHandlersãGlobal.asax ä»¥åç»å¸æµæ°´çº¿åè½è¿äºåè½ä¸ä¼ç´æ¥è¿ç§»ã</p>
</li>
<li>
<p><strong>è®¤è¯ä¸ææ</strong><br>
ASP.NET Core éç¨äºä¸åçæ¨¡å¼ã</p>
</li>
<li>
<p><strong>ä¼è¯ãç¼å­ãéç½®ãæ¥å¿</strong><br>
API åæ¨¡å¼åä¸ç¸åï¼éè¦ææè¯çè¿ç§»è§åã</p>
</li>
</ul>
<p>å¿«éå¯¹ä½ ç NuGet ååä¸ªå¼å®¹æ§æ£æ¥ãå¯¹äºæ¯ä¸ªè½¯ä»¶åï¼æ£æ¥å®æ¯å¦æ¯æ netstandard2.0 æç°ä»£ç½ç»çæ¬ï¼æèæ¯å¦æ ASP.NET Core æ¿ä»£åãæ è®°ææä¸ System.Web ç¸å³çåå®¹ã</p>
<h3 id="æ­¥éª¤3å¨æ¥è§¦ä»£ç åå»ºç«å®å¨åºçº¿">æ­¥éª¤3ï¼å¨æ¥è§¦ä»£ç åå»ºç«å®å¨åºçº¿</h3>
<p>å»ç»å½åç¶æï¼</p>
<ol>
<li>ç»ä»åºæ è®°</li>
<li>ç¡®ä¿ä½ è½æå»ºè§£å³æ¹æ¡å¹¶è¿è¡æµè¯å¥ä»¶</li>
<li>å¦æè¦ççè¾å°ï¼å¯ä»¥å¢å æå å¼ºæµè¯<br>
éç¹å³æ³¨å³é®è·¯ç±ãæææµç¨åæéè¦çä¸å¡æä½ã</li>
</ol>
<p>å¦ææ æ³å¿«éæ·»å æµè¯ï¼è³å°è¦è®°å½çé¾æµè¯èæ¬åé¢æè¾åºã</p>
<h3 id="æ­¥éª¤4ååçº§åºåèèç½é¡µåºç¨">æ­¥éª¤4ï¼ååçº§åºï¼åèèç½é¡µåºç¨</h3>
<p>è¿æ¯æ ææé«çæä½ãå¦æè¿æ²¡æåï¼å°±æè§£å³æ¹æ¡åæå å±ï¼ç½é¡µé¡¹ç®ãåºç¨æå¡ãååãæ°æ®è®¿é®ãå±äº«å·¥å·ã</p>
<p>åç§»æ¤ç±»åºãå¦æå¯è½ï¼æåºè½¬æ¢æç®æ  NetStandard2.0 ä½ä¸ºæ¡¥æ¥ï¼æèç´æ¥é¢åç°ä»£ .NETãä¿®å¤ç¼è¯éè¯¯å¹¶æ¿æ¢ä¸æ¯æç APIã</p>
<p>Microsoft çéç¨ç§»æ¤æå¯¼æ¯è¯ä¼°é¡¹ç®ï¼å¹¶ä»¥éä½åå§åçº§åå¤ææ§çæ¹å¼æ¨è¿åä¸ªé¨åã</p>
<h3 id="æ­¥éª¤5å³å®æ¯å¦ä½¿ç¨è¿ç§»å·¥å·">æ­¥éª¤5ï¼å³å®æ¯å¦ä½¿ç¨è¿ç§»å·¥å·</h3>
<p>ä½ å¯ä»¥ä½¿ç¨ä¸¤ä¸ª Microsoft æ¯æçå·¥å·æä»¤æ¥å å¿«é¨åå·¥ä½éåº¦ï¼</p>
<ol>
<li>
<p><strong>.NET åçº§å©æ</strong><br>
å®å¸®å©åçº§é¡¹ç®å¹¶åæä¸å¼å®¹é®é¢ï¼åæ¬ .NET Framework é¡¹ç®ãå¨æå¸®å©çå°æ¹ä½¿ç¨å®ï¼ä½ä¸è¦ææå®è½å®å¨æ ASP.NET MVC 5 åºç¨èªå¨è½¬åä¸º ASP.NET Core MVCã</p>
</li>
<li>
<p><strong>ASP.NET Framework åºç¨çè¿ç§»å·¥å·</strong><br>
Microsoft æåºï¼å° ASP.NET æ¡æ¶ MVCãWeb API å Web Forms é¡¹ç®åçº§å° ASP.NET Coreï¼æä¾ä¸ç¨çç°ä»£åå·¥å·ã</p>
</li>
</ol>
<p>å¦æä½ æ¿æï¼ä½ ä»ç¶å¯ä»¥æå¨å®ææææä½ï¼ä½å·¥å·å¯ä»¥åå°æ¯ç¥çæºæ¢°ç¼è¾ã</p>
<h3 id="æ­¥éª¤6åå»ºæ°ç-aspnet-core-mvc-ä¸»æºåºç¨">æ­¥éª¤6ï¼åå»ºæ°ç ASP.NET Core MVC ä¸»æºåºç¨</h3>
<p>å³ä½¿æ¯å¢éè¿ç§»ï¼è¿ä¸æ­¥ä¹å¿é¡»ï¼å ä¸ºä½ éè¦ä¸ä¸ª ASP.NET Core åºç¨æè½å¨ç°ä»£.NET ä¸è¿è¡ã</p>
<p>åå»ºä¸ä¸ªæ°ç ASP.NET æ ¸å¿ MVC é¡¹ç®ï¼ä½¿ç¨æ åç ASP.NET æ ¸å¿ MVC æ¨¡æ¿ãæ·»å ä½ çæ ¸å¿åãæ¥å¿ãéç½®å DI ç»æã</p>
<p>å¨ ASP.NET Core ä¸­ï¼Program.cs éç½®ä¸»æºåä¸­é´ä»¶æµæ°´çº¿ãæ²¡æ Global.asaxãæ·»å ä¸äºä½ è¯å®éè¦çåºç¡ä¸­é´ä»¶ï¼è·¯ç±ãéææä»¶ãè®¤è¯åææï¼å¦éç¨ï¼ãMVC ç«¯ç¹ã</p>
<p>æå°ç¤ºä¾å½¢ç¶ï¼</p>
<pre><code class="language-csharp">var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllersWithViews();

var app = builder.Build();

app.UseStaticFiles();
app.UseRouting();

app.MapControllerRoute(
    name: "default",
    pattern: "{controller=Home}/{action=Index}/{id?}");

app.Run();
</code></pre>
<h3 id="æ­¥éª¤7åç§»å¨è·¯ç±ç¶åæ¯æ§å¶å¨æåæ¯è§å¾">æ­¥éª¤7ï¼åç§»å¨è·¯ç±ï¼ç¶åæ¯æ§å¶å¨ï¼æåæ¯è§å¾</h3>
<p>Microsoft ç MVC å°æ ¸å¿ç¤ºä¾æ»ç¥ä»è®¾ç½®å¼å§ï¼ç¶åæ¯æ§å¶å¨åè§å¾ï¼æåæ¯éæåå®¹åå®¢æ·ç«¯ä¾èµãéµå¾ªè¿ä¸ªé¡ºåºï¼å ä¸ºè¿æ ·å¯ä»¥è®©è¿ç§»å¨æ¯ä¸æ­¥é½å¯æµè¯ã</p>
<p><strong>è¿ç§»è·¯ç±</strong><br>
å¨ MVC 5 ä¸­ï¼ä½ å¾å¯è½ç¨è¿ RouteConfigï¼å¯è½è¿ç¨äºå±æ§è·¯ç±ãå¨ ASP.NET Core ä¸­ï¼ä½ éç½®ä¸­é´ä»¶æµæ°´çº¿åç«¯ç¹æ å°ä¸­çè·¯ç±ã</p>
<p><strong>è¿ç§»æ§å¶å¨</strong><br>
ä¸æ¬¡è¿ç§»ä¸ä¸ªæ§å¶å¨ãå¤å¶ä¸ä¸ªæ§å¶å¨ç±»ãéè¿æ´æ¢å½åç©ºé´åæ¿æ¢ä¾èµ System.Web çä»£ç æ¥ä¿®å¤ç¼è¯éè¯¯ãç¨æ§å¶å¨ HttpContext è®¿é®æ¿ä»£ HttpContext.Current æ¨¡å¼ã</p>
<p><strong>è¿ç§»è§å¾</strong><br>
Razor è¯­æ³ç±»ä¼¼ï¼ä½è¾å©å¨åä¸äºåè½ææä¸åãéè¦çå°æ¹è½¬æ¢ HTML è¾å©å·¥å·ï¼å¿è¦æ¶ä½¿ç¨æ ç­¾è¾å©å·¥å·ã</p>
<p>ä½ å¾å¯è½ä¼å¼å¥ ViewImports.cshtml å ViewStart.cshtml çæ¨¡å¼ã</p>
<h3 id="æ­¥éª¤8ç§»å¨éææä»¶åå®¢æ·ç«¯ä¾èµ">æ­¥éª¤8ï¼ç§»å¨éææä»¶åå®¢æ·ç«¯ä¾èµ</h3>
<p><strong>éææä»¶</strong><br>
å¨ MVC 5 ä¸­ï¼ä½ å¯è½ç¨è¿åå®¹åèæ¬ççº¦å®ãå¨ ASP.NET Core ä¸­ï¼é»è®¤æ¯ wwwroot å  UseStaticFiles ä¸­é´ä»¶ã</p>
<p><strong>æç»ä¸ç²¾ç®</strong><br>
å¦æä½ ä¾èµ System.Web.Optimizationï¼å¯ä»¥ç¨ç°ä»£åç«¯æå»ºæµæ°´çº¿æå¶ä»æ¯æçæ¹æ³æ¿ä»£å®ã</p>
<p>Microsoft çç¤ºä¾è¿ç§»æµç¨æç¡®æåºéæåå®¹åå®¢æ·ç«¯ä¾èµæ¯æ©æè¿ç§»æ­¥éª¤ã</p>
<h3 id="æ­¥éª¤9å°éç½®ä»-webconfig-è¿ç§»å°-appsettings">æ­¥éª¤9ï¼å°éç½®ä» Web.config è¿ç§»å° appsettings</h3>
<p>ç¡®å®ä½ å¨ Web.config ä¸­å­å¨äºä»ä¹ï¼è¿æ¥ä¸²ãåºç¨è®¾ç½®ãè®¤è¯è®¾ç½®ãèªå®ä¹éç½®é¨åã</p>
<p>å°è®¾ç½®è¿ç§»å° appsettings.json åç¯å¢ç¹å®ç appsettings æä»¶ä¸­ãéè¿æå»ºå¨è¯»å ASP.NET æ ¸å¿éç½®ç³»ç»ä¸­çè®¾ç½®ã</p>
<p>Microsoft æä¸é¨ç MVC è¿ç§»ç¤ºä¾ä¸­çè¿ç§»éç½®æåã</p>
<h3 id="æ­¥éª¤10è¿ç§»è®¤è¯åææ">æ­¥éª¤10ï¼è¿ç§»è®¤è¯åææ</h3>
<p>ç¡®å®ä½ å½åçè®¤è¯æ¨¡åï¼è¡¨åè®¤è¯ãOWIN cookiesãASP.NET MVC 5 ä¸­çèº«ä»½ãWindows è®¤è¯ã</p>
<p>å¨ ASP.NET Core ä¸­å®ç°ç±»ä¼¼çï¼</p>
<ol>
<li>å¨ DI ä¸­éç½®è®¤è¯æå¡</li>
<li>å¨æµç¨ä¸­å å¥ä¸­é´ä»¶</li>
<li>ç«¯å£ææå±æ§åç­ç¥</li>
</ol>
<p>Microsoft ç MVC è¿ç§»ç¤ºä¾æåäºéå¯¹è®¤è¯åèº«ä»½è¿ç§»çä¸é¨æå¯¼ï¼å ä¸ºè¿éå¸¸æ¯è¾ä¸ºç¹éçé¨åä¹ä¸ã</p>
<h3 id="æ­¥éª¤11è¿ç§»æ°æ®è®¿é®">æ­¥éª¤11ï¼è¿ç§»æ°æ®è®¿é®</h3>
<p><strong>å¦æä½ ä½¿ç¨å®ä½æ¡æ¶6</strong><br>
ä½ éå¸¸å¯ä»¥ä¿ç EF6 ä¸æ®µæ¶é´ï¼å³ä½¿æ¯å¨ç°ä»£.NET ä¸ï¼è¿åå³äºä½ çéç½®ãä»é¿è¿æ¥çï¼è®¸å¤å¢éè½¬å EF Core ä»¥è·åç°ä»£åçæ¨¡å¼ååè½ã</p>
<p><strong>å¦æä½ ç¨ ADO.NET æ Dapper</strong><br>
è¿äºéå¸¸è½å¹²åå°ç§»æ¤ï¼ä½ä½ ä¼æ´æ°éç½®åä¾èµæ³¨å¥æ¨¡å¼ã</p>
<h3 id="æ­¥éª¤12è¿è¡åºç¨ä¿®å¤è¿è¡æ¶é®é¢ç¶åè¿è¡ä¼å">æ­¥éª¤12ï¼è¿è¡åºç¨ï¼ä¿®å¤è¿è¡æ¶é®é¢ï¼ç¶åè¿è¡ä¼å</h3>
<p>æè¿ä¸ªå¸åé¡ºåºä¿®å¤è¿è¡æ¶é®é¢ï¼</p>
<ol>
<li>éç½®ä¸ç¯å¢å·®å¼</li>
<li>ä¸­é´ä»¶æåºé®é¢</li>
<li>èº«ä»½éªè¯ä¸ Cookie</li>
<li>ä¼è¯ä¸ç¼å­è¡ä¸º</li>
</ol>
<p>è¿è¡èªå¨åæµè¯åçé¾æµè¯ãå¨éå½æåµä¸æ·»å ç»æåæ¥å¿åå¥åº·æ£æ¥ã</p>
<h3 id="æ­¥éª¤13å¦æä½ éæ©äºå¢éè¿ç§»è®¾ç½®åé¨core-åºç¨">æ­¥éª¤13ï¼å¦æä½ éæ©äºå¢éè¿ç§»ï¼è®¾ç½®"åé¨"Core åºç¨</h3>
<p>å¯¹äºå¢éè¿ç§»ï¼å³é®ä¸¾æªæ¯å° ASP.NET æ ¸å¿åºç¨ç½®äºç°æç.NET Framework åºç¨ä¹åï¼å¹¶éè·¯ç±è¿ç§»ãMicrosoft å³äºå¢éè¿ç§»ç"å¥é¨æå"æ¨èéç¨ä»£çåçº¿æ¹æ³è¿è¡å¤§è§æ¨¡è¿ç§»ã</p>
<p>ä½ çæµç¨åæï¼</p>
<ol>
<li>è·¯ç± A ç± ASP.NET æ ¸å¿å¤çï¼å¶ä»ææè·¯ç±ä»£çå° MVC 5</li>
<li>ä¸æ¬¡ç§»å¨ä¸ä¸ªåç´åç</li>
<li>å½ææè·¯çº¿é½è¢«è¿ç§»åï¼å³é­æ§ç MVC 5 åºç¨</li>
</ol>
<h3 id="æ­¥éª¤14çäº§åæ¢æ¸å">æ­¥éª¤14ï¼çäº§åæ¢æ¸å</h3>
<p><strong>ä¸»æ</strong><br>
å³å® IIS å¨æµç¨ä¸­ãIIS å¨æµç¨å¤ï¼è¿æ¯å®¹å¨ã</p>
<p><strong>å¯è§æµæ§</strong><br>
å¨å¢éè¿ç§»è¿ç¨ä¸­ï¼ä¸¤ä¸ªåºç¨çæ¥å¿ãææ åè¿½è¸ªé½å¯¹é½äºã</p>
<p><strong>å®å¨</strong><br>
Cookie è®¾ç½®ãæ°æ®ä¿æ¤å¯é¥ãTLSãå¤´é¨ã</p>
<p><strong>æ§è½</strong><br>
è¿ç§»åç¡®è®¤ç¼å­åä¼è¯è¡ä¸ºã</p>
<h2 id="ç»è®º">ç»è®º</h2>
<p>å° ASP.NET MVC åºç¨ä».NET Framework è¿ç§»å°ç°ä»£.NET æ¯ä¸é¡¹æç¥æèµï¼èéæºæ¢°åçº§ãæ­£ç¡®æ§è¡æ¶ï¼å®è½å¸¦æ¥æ´æ¸æ°çæ¶æãæ§è½æåãäºåå¤åº¦æåä»¥åé¿æå¹³å°æ¯æã</p>
<p>éè¿å°è¿ç§»æåä¸ºæè®¡åãå¯æµè¯çæ­¥éª¤ï¼å¹¶ä¼åå³æ³¨æ¶æèéè¯­æ³ï¼å¢éå¯ä»¥èªä¿¡å°ç°ä»£åï¼åæ¶ä¸æ°ä¹±çäº§ç³»ç»ã</p>
<p>è¿ç§æ¹æ³å¨ç°å®ä¼ä¸è¿ç§»ä¸­å·²è¢«åå¤è¯æææï¼å¹¶ä¸ç¬¦å Microsoft æ¨èç ASP.NET åºç¨ç°ä»£åæç¥ã</p>

</div>
<div id="MySignature" role="contentinfo">
    <hr>
<br>
<p style="font-size: 16px; font-family: å¾®è½¯éé», é»ä½, Arial; color: #000">æ¬ææ¯ç±è¡èåææ¯å¼åå¢éåå¸ï¼è½¬è½½è¯·æ³¨æåºå¤ï¼<a href="https://www.grapecity.com.cn/" target="_blank">è¡èåå®ç½</a></p>
<!--p style="font-size: 16px; font-family: å¾®è½¯éé», é»ä½, Arial; color: #000">äºè§£ä¼ä¸çº§ä½ä»£ç å¼åå¹³å°ï¼è¯·åå¾<a href="https://www.grapecity.com.cn/solutions/huozige" target="_blank">æ´»å­æ ¼</a>
</p><p style="font-size: 16px; font-family: å¾®è½¯éé», é»ä½, Arial; color: #000">äºè§£å¯åµå¥æ¨ç³»ç»çå¨çº¿ Excelï¼è¯·åå¾<a href="https://www.grapecity.com.cn/developer/spreadjs" target="_blank">SpreadJSçº¯åç«¯è¡¨æ ¼æ§ä»¶</a></p>
<p style="font-size: 16px; font-family: å¾®è½¯éé», é»ä½, Arial; color: #000">äºè§£åµå¥å¼çåä¸æºè½åæ¥è¡¨è½¯ä»¶ï¼è¯·åå¾<a href="https://www.grapecity.com.cn/solutions/wyn" target="_blank">Wyn Enterprise
</a></p-->

<br>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-15 10:55">2026-01-15 10:55</span>&nbsp;
<a href="https://www.cnblogs.com/powertoolsteam">è¡èåææ¯å¢é</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19486260);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19486260', targetLink: 'https://www.cnblogs.com/powertoolsteam/p/19486260', title: 'å¦ä½ä¸æ­¥æ­¥å° ASP.NET MVC åçº§ä¸º.NET' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>