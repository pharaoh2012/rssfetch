<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-14T10:21:24.699Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ `i` å `e` ååå¼åçè¡æ¡ï¼å½ AI çâçº éçâéä¸ NexusContract çâç§å¦éâ ]]></title>
    <link>https://www.cnblogs.com/jieky/p/19481961</link>
    <guid>bf5ee1a0d5dcb0f2779bc7907a128f9b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jieky/p/19481961" title="åå¸äº 2026-01-14 14:19">
    <span role="heading" aria-level="2">`i` å `e` ååå¼åçè¡æ¡ï¼å½ AI çâçº éçâéä¸ NexusContract çâç§å¦éâ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        å¨å¯¹æ¥æå¤´é¨æ¯ä»ç½å³æ¶ï¼æé­éäºä¸æ¬¡å®ç¾çâéç»´æå»âãå®æ¹ææ¡£éä¸ä¸ªæ `ei` åæ `ie` çè±è¯­è¯­æ³éè¯¯ï¼éªè¿äº AI çè¯­æ³æ£æ¥ï¼ä¹éªè¿äºæçèç¼ Reviewãæ¬æå°æ¢è®¨ NexusContract å¦ä½éè¿**åæ°æ®éç¦»**æºå¶ï¼å¨æ··ä¹±çéçæ¥å£ä¸ç°ä»£åçæ´æ´ä»£ç ä¹é´å»ºç«ä¸éé²çº¿ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="i-å-e-ååå¼åçè¡æ¡å½-ai-ççº éçéä¸-nexuscontract-çç§å¦é"><code>i</code> å <code>e</code> ååå¼åçè¡æ¡ï¼å½ AI çâçº éçâéä¸ NexusContract çâç§å¦éâ</h1>
<blockquote>
<p><strong>æè¦</strong>ï¼å¨å¯¹æ¥æå¤´é¨æ¯ä»ç½å³æ¶ï¼æé­éäºä¸æ¬¡å®ç¾çâéç»´æå»âãå®æ¹ææ¡£éä¸ä¸ªæ <code>ei</code> åæ <code>ie</code> çè±è¯­è¯­æ³éè¯¯ï¼éªè¿äº AI çè¯­æ³æ£æ¥ï¼ä¹éªè¿äºæçèç¼ Reviewãæ¬æå°æ¢è®¨ NexusContract å¦ä½éè¿<strong>åæ°æ®éç¦»</strong>æºå¶ï¼å¨æ··ä¹±çéçæ¥å£ä¸ç°ä»£åçæ´æ´ä»£ç ä¹é´å»ºç«ä¸éé²çº¿ã</p>
</blockquote>
<h2 id="1-è¯¡å¼ç-parameter_missing">1. è¯¡å¼ç <code>PARAMETER_MISSING</code></h2>
<p>æäºåçå¨ä¸ä¹åï¼æä»¬æ­£å¨éæåé¨çä¸ä¸ªè¿è¡äºå å¹´çèæ§æ¯ä»ç½å³ã</p>
<p>ä¸ºäºæé«éææçï¼æææ§çææ¡£æªå¾åç»äº AIï¼æç¥åå¤§æ¨¡åï¼ï¼è®©å®å¸®æçæç¬¦å NexusContract è§èç C# DTOï¼æ°æ®ä¼ è¾å¯¹è±¡ï¼ãAI çè¡¨ç°å ªç§°å®ç¾ï¼ç¬é´ååºäºç»ææ¸æ°çä»£ç ï¼</p>
<pre><code class="language-csharp">public string ReceiverId { get; set; } // æ¶æ¬¾æ¹ID

</code></pre>
<p>ä»£ç ççæ²¡æ¯çï¼å½åä¹è§èãææ»¡æä¿¡å¿å°å¯å¨æå¡ï¼å¼å§<strong>æ¬å°èè°</strong>ã</p>
<p><strong>ç»æï¼æ¥å£æ­»æ´»ä¸éã</strong></p>
<p>ä¸æ¸¸ç½å³ä¸ç´è¿åå·å°å°çéè¯¯ï¼<code>PARAMETER_MISSING</code>ã</p>
<p>è¿å°±å¾éªé¨äºã<br>
ææäºæ­ç¹ï¼æ°æ®å¨ï¼<br>
æäºåï¼JSON å­æ®µä¹æï¼<br>
æèç¼æ£æ¥äºä¸éï¼<code>ReceiverId</code> æ¼åç»å¯¹æ²¡é®é¢ï¼<br>
æåè®© AI æ£æ¥äºä¸éä»£ç ï¼å®ä¹ä¿¡èªæ¦æ¦å°è¯´æ²¡æè¯­æ³éè¯¯ã</p>
<p><strong>æ´æ´ä¸¤ä¸ªå°æ¶ï¼æå°±å¡å¨è¿ä¸ªè«åå¶å¦çéè¯¯ä¸ï¼çè³å¼å§æçæ¯ä¸æ¯ HTTP åè®®å¤´çé®é¢ï¼æèæ¯ JSON åºåååºç Bugã</strong></p>
<p>ç´å°æå®å¨æ²¡æäºï¼åæ¬¡æå¼é£ä»½ææ¡£ï¼å¼ºè¿«èªå·±ä¸ä¸ªå­æ¯ä¸ä¸ªå­æ¯å°è·æçä»£ç æ¯å¯¹æ¶ï¼ææåç°äºä¸ä¸ªä»¤äººçªæ¯çç»èï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/45234/202601/45234-20260114141433336-590884100.png" alt="image" loading="lazy"></p>
<p><strong>ææ¡£éåçå­æ®µåï¼æ¯ <code>recieverId</code>ã</strong></p>
<p>æ³¨æå°äºåï¼<strong><code>i</code> å <code>e</code> ååäºï¼</strong></p>
<p>æ­£ç¡®çè±è¯­åè¯æ¯ <code>Receiver</code>ï¼c åé¢æ¥ eiï¼ï¼ä½ææ¡£éåæäº <code>Reciever</code>ï¼ieï¼ãè¿ç§âé¿å¾æåâçéè¯¯ï¼æå¶å®¹æåçè§éè§ã</p>
<p>é£ä¸å»æç®ç´æ³æé®çï¼<strong>AI å¤ªâèªæâäºã</strong> å®è¯å«åºè¿æ¯âæ¶æ¬¾æ¹âçææï¼åç°äºè¿ä¸ªè¯­æ³éè¯¯ï¼äºæ¯<strong>å¥½å¿å°å¨çæä»£ç æ¶å¸®ææå®âæ¹å¯¹âäº</strong>ãèæï¼ä½ä¸ºä¸ä¸ªæ­£å¸¸çäººç±»ç¨åºåï¼å¤§èä¹èªå¨è¿æ»¤äºè¿ä¸ªæ¼åéè¯¯ã</p>
<p>å¨éçç³»ç»çéæä¸­ï¼<strong>âåå²çéè¯¯âå¾å¾æ¯âæ­£ç¡®çè¯­æ³âæ´éè¦</strong>ã</p>
<h2 id="2-æ¶æçåå»ä»£ç æ´çä¸è®èç°å®">2. æ¶æçåå»ï¼ä»£ç æ´çä¸è®èç°å®</h2>
<p>é¢å¯¹è¿ç§åºæ¯ï¼ä¼ ç»åæ³éå¸¸æä¸¤ç§ï¼</p>
<ol>
<li><strong>åæµåæ±¡æ´¾ï¼</strong> ç´æ¥æ C# å±æ§åä¹åéã</li>
</ol>
<pre><code class="language-csharp">public string RecieverId { get; set; } // ççå°±é¾åï¼é¼æ­»å¼ºè¿«ç

</code></pre>
<p>è¿æä¸ªå·¨å¤§çéæ£ï¼æ°æ¥çåäºæèåæ¥ç»´æ¤ç AIï¼çå°è¿ä¸ªâéè¯¯æ¼åâï¼å¾æå¯è½ä¼é¡ºææå®âä¿®å¤âææ­£ç¡®ç <code>ReceiverId</code>ï¼ç¶å<strong>ç °ï¼ç³»ç»åæäºã</strong><br>
2. <strong>æå¨æ å°æ´¾ï¼</strong> å¨ä¸å¡ä»£ç éæå¨å <code>json["recieverId"] = request.ReceiverId</code>ã<br>
è¿ä¼å¯¼è´ä¸å¡é»è¾éåæ¥çå¤§éçå­ç¬¦ä¸²ç¡¬ç¼ç ï¼ç»´æ¤ææ¬æé«ã</p>
<p><strong>NexusContract çå²å­¦æ¯ï¼</strong> æä»¬æ¹åä¸äºå¤é¨ä¸ççâæç²âæ¼åï¼ä½æä»¬å¯ä»¥éè¿æ¶æææ®µï¼ä¸è®©è¿äºâèä¸è¥¿âæ±¡ææä»¬çæ ¸å¿ä»£ç ã</p>
<p>æä»¬éç¨äº <strong>[ApiField]</strong> ç¹æ§æ¥å®ç° <strong>ç©çéç¦»</strong>ï¼</p>
<pre><code class="language-csharp">[ApiOperation("payment.gateway.pay", HttpVerb.POST)]
public class PaymentRequest : IApiRequest
{
    // ç»å¯¹æ¹ççï¼å¿é¡»éï¼ï¼æ å°å°é£ä¸ªæ ie ååçèå­æ®µ
    [ApiField("recieverId", IsRequired = true)]
    
    // ç»èªå·±ççï¼å¿é¡»å¯¹ï¼ï¼ä¿æåé¨é¢åè¯­è¨ççº¯æ´æ§
    public string ReceiverId { get; set; }
}

</code></pre>
<p>è¿ä¸ä»æ¯ç®åçéå½åï¼è¿æ¯ <strong>è¯­ä¹è§£è¦ (Semantic Decoupling)</strong>ã</p>
<ul>
<li><strong>å±æ§å (Property):</strong> æå¡äºåé¨é»è¾ï¼ä½¿ç¨ <strong>Ubiquitous Language (éç¨è¯­è¨)</strong>ï¼å¿é¡»æ­£ç¡®ãå¯è¯»ã</li>
<li><strong>ç¹æ§å (Attribute):</strong> æå¡äºå¤é¨å¥çº¦ï¼æ¯å¯¹åå²äºå®ç <strong>å¿«ç§</strong>ï¼å¿é¡»çå®ãåªææ¯éçã</li>
</ul>
<h2 id="3-æ·±åº¦è§£å¯nexuscontractcore-çé»ç">3. æ·±åº¦è§£å¯ï¼NexusContract.Core çé»ç</h2>
<p>è¿æ¶ä½ å¯è½ä¼é®ï¼<em>âå¸é¢ä¸å¾å¤ JSON åºé½æ <code>JsonProperty</code>ï¼è¿æä»ä¹ç¨å¥çï¼â</em></p>
<p>åºå«å¨äº <strong>å¤çæ¶æº</strong> å <strong>ç¡®å®æ§</strong>ã</p>
<p>NexusContract å¨ <strong>ç³»ç»å¯å¨ (Startup)</strong> æ¶ï¼ä¼æ§è¡ä¸ä¸ª <strong>[å³ç­ A-301] åæ°æ®å·å» (Metadata Freezing)</strong> æµç¨ã</p>
<p>è½ç¶æ¡æ¶å¨å¯å¨æ¶æ æ³ç¥éå¤é¨æ¥å£å°åºå« <code>recieverId</code> è¿æ¯ <code>receiverId</code>ï¼é¤éæä»¬æ Schema æä»¶ï¼ï¼ä½å®åäºä¸ä»¶æ´éè¦çäºï¼<strong>ç¡®ç«å¥çº¦çç»å¯¹æå¨</strong>ã</p>
<h3 id="æ ¸å¿ä»£ç å±ç¤º">æ ¸å¿ä»£ç å±ç¤º</h3>
<pre><code class="language-csharp">// Copyright (c) 2026 NexusContract. All rights reserved.

using System.Collections.Concurrent;
using System.Reflection;
using NexusContract.Abstractions.Exceptions;

namespace NexusContract.Core.Reflection
{
    /// &lt;summary&gt;
    /// ãå³ç­ A-301ãNexusContractMetadataRegistryï¼å¥çº¦åæ°æ®æ³¨åè¡¨ï¼
    /// 
    /// æ ¸å¿èè½ï¼
    /// 1. åç°ï¼Discoveryï¼ï¼å¯å¨æ¶æ«æææå¥çº¦ç±»ç Attribute ç»æ
    /// 2. éªè¯ï¼Validationï¼ï¼æ§è¡ ContractValidator ç¡®ä¿åé¨çº¦æï¼å¦ Getter/Setter å®æ´æ§ï¼
    /// 3. å»ç»ï¼Freezingï¼ï¼å°åå°ç»æè½¬ä¸ºä¸å¯åå¯¹è±¡ï¼è¿è¡æé¶åå°æè
    /// &lt;/summary&gt;
    public sealed class NexusContractMetadataRegistry
    {
        // åä¾æ¨¡å¼ï¼ç¡®ä¿å¨å±å¯ä¸æ³¨åè¡¨
        private static readonly Lazy&lt;NexusContractMetadataRegistry&gt; _instance = new(() =&gt; new NexusContractMetadataRegistry());
        public static NexusContractMetadataRegistry Instance =&gt; _instance.Value;

        // ãå³ç­ A-302ãæ ¸å¿å·å»åº
        // Key: å¥çº¦ç±»å, Value: é¢ç¼è¯å¥½çåæ°æ®ï¼åå« Expression Tree å§æï¼
        private readonly ConcurrentDictionary&lt;Type, ContractMetadata&gt; _cache = new();

        private NexusContractMetadataRegistry() { }

        /// &lt;summary&gt;
        /// ãå³ç­ A-308ãå¯å¨æä½æ£ï¼Startup Health Checkï¼
        /// è¿ä¸æ¯ç®åçå è½½ï¼èæ¯ä¸æ¬¡å¨éçâCTæ«æâã
        /// ç¡®ä¿ææå¥çº¦å¨ç©çä¸æ¯åæ³çï¼ä¾å¦é²æ­¢ Attribute éå¤å®ä¹ï¼ã
        /// &lt;/summary&gt;
        public DiagnosticReport Preload(IEnumerable&lt;Type&gt; types)
        {
            var globalReport = new DiagnosticReport();

            foreach (var type in types)
            {
                // 1. éæéªè¯ï¼å­æ®µæ¼åãAttribute å²çªç­ï¼
                var perTypeReport = new DiagnosticReport();
                ContractValidator.Validate(type, perTypeReport);

                // 2. å¦æéªè¯éè¿ï¼æå»ºä¸å¯ååæ°æ®
                if (!perTypeReport.HasErrors)
                {
                    try 
                    {
                        var metadata = BuildMetadata(type, perTypeReport);
                        _cache.TryAdd(type, metadata); // å»ç»å¥åº
                    }
                    catch (Exception ex)
                    {
                        perTypeReport.AddCritical(type.Name, $"Metadata freeze failed: {ex.Message}");
                    }
                }
                globalReport.Merge(perTypeReport);
            }
            return globalReport; // è¿åä½æ£æ¥å
        }

        /// &lt;summary&gt;
        /// æå»ºåæ°æ®æ ¸å¿æµï¼å®¡è®¡ -&gt; ç¼è¯ -&gt; å°è£
        /// &lt;/summary&gt;
        private ContractMetadata BuildMetadata(Type type, DiagnosticReport report)
        {
            // ... (çç¥é¨åä»£ç ) ...

            // ãå³ç­ A-309ãå¯ç¨ Expression Tree é¢ç¼è¯ï¼çæ­£é¶åå°ï¼
            // å°åå°è¯»åè½¬æ¢ä¸ºå¼ºç±»åå§æï¼æ§è½æå 10 å
            var projector = ContractMetadataCompiler.CompileProjector(type, propertyMetadatas);
            var hydrator = ContractMetadataCompiler.CompileHydrator(type, propertyMetadatas);

            return new ContractMetadata(type, opAttr, propertyMetadatas.AsReadOnly(), projector, hydrator);
        }
    }
}

</code></pre>
<h3 id="ææ¯åçè§£è¯»">ææ¯åçè§£è¯»</h3>
<p><strong>ä¸ºä»ä¹è¿å¯¹ææ¥ Bug å¾æç¨ï¼</strong></p>
<p>è½ç¶ <code>PARAMETER_MISSING</code> æ¯å¨è¿è¡æ¶æ¥åºæ¥çï¼ä½ NexusContract çæºå¶ä¿è¯äº<strong>ä¿®å¤çå»ä»·æ§ä¸ç¡®å®æ§</strong>ã</p>
<ol>
<li><strong>Expression Tree é¢ç¼è¯ï¼</strong><br>
ä¸æ¦æä»¬å¨ Attribute éæåå­ä¿®æ­£ä¸º <code>[ApiField("recieverId")]</code>ï¼æ¡æ¶å¨ä¸æ¬¡å¯å¨æ¶ï¼ä¼éè¿ <strong>Expression Tree</strong> æè¿ä¸ªæ å°å³ç³»ç¼è¯æé«æç Delegateã<br>
è¿æå³çï¼å³ä½¿ä¸ºäºå¼å®¹èæ¥å£èå äº Attributeï¼<strong>è¿è¡æ¶æ§è½ä¾ç¶ç­åäºæåä»£ç </strong>ï¼å®å¨æ²¡æåå°çé¢å¤å¼éã</li>
<li><strong>å¥çº¦çæ¾å¼åï¼</strong><br>
è¿ç§åæ³å¼ºè¿«å¼åèå»ç¡®è®¤æ¯ä¸ä¸ªå­æ®µçæ å°å³ç³»ãä»£ç éç <code>[ApiField]</code> å°±åä¸ä¸ªä¸ªè­¦ç¤ºçï¼æ¶å»æéçåæ¥èï¼<strong>âæ³¨æï¼è¿éæä¸ªåï¼å«å¨ï¼â</strong></li>
</ol>
<h2 id="4-ç»è¯­">4. ç»è¯­</h2>
<p>ä»¥åæä»¬æ AI çç¼ä»£ç ï¼å¹»è§ï¼ï¼ç°å¨æä»¬æ AI <strong>ä»£ç åå¾å¤ªå¯¹</strong>ã</p>
<p>é¢å¯¹æèãæé¶è¡ãææ¯ä»é£äºåå å¹´åçâèå¤çº§âæ¥å£ï¼AI è¿ç§æ¿çæ´¥è¯å¸å½æ åçâé«æçâæ ¹æ¬æ°´åä¸æãå®ä¸ç¥é <code>recieverId</code> å¨è¿éä¸æ¯æ¼åéè¯¯ï¼å®æ¯<strong>æ³å¾</strong>ï¼æ¯<strong>ä¸å¯å¨æçå¥çº¦</strong>ã</p>
<p>è¿å°±æ¯ä¸ºä»ä¹æä»¬éè¦ NexusContract ââ <strong>å®åè®¸æä»¬å¨ä»£ç éä¼éå°âæé¹¿ä¸ºé©¬âï¼å¹¶ç¨æåºå±çææ¯ææ®µï¼åæ°æ®å·å»ï¼ï¼å°è¿ä»½âè®èçç°å®âé«æ§è½å°å°è£èµ·æ¥ã</strong></p>
<hr>

</div>
<div id="MySignature" role="contentinfo">
    <p>______________________________________<br>çæ´»ï¼è¦ç¨å£äººçè¸æé¢å¯¹ï¼ç¨ç§å­¦çæ¹æ³æ¯éï¼ <br>&nbsp; &nbsp; &nbsp; &nbsp; ç¨çå¸çå¾¡è³å»èï¼ç¨æ¸æ´çç©ºæ°æ´èºï¼ <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ç¨å°çªçæè§å»ç¡ï¼ç¨å¤ªé³çç­æçæ°´ã<br>______________________________________</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 14:20">2026-01-14 14:19</span>&nbsp;
<a href="https://www.cnblogs.com/jieky">æ¶å¤±è</a>&nbsp;
éè¯»(<span id="post_view_count">45</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19481961);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19481961', targetLink: 'https://www.cnblogs.com/jieky/p/19481961', title: '`i` å `e` ååå¼åçè¡æ¡ï¼å½ AI çâçº éçâéä¸ NexusContract çâç§å¦éâ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ FastAPIæ°æ®åºå®æï¼ä»SQLAlchemyåçå°é«æè¿æ¥ç®¡çï¼åå«æ§è½ç¶é¢ ]]></title>
    <link>https://www.cnblogs.com/ymtianyu/p/19480142</link>
    <guid>892bf7ce5a51f210f2ad0f395f81101e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ymtianyu/p/19480142" title="åå¸äº 2026-01-14 11:13">
    <span role="heading" aria-level="2">FastAPIæ°æ®åºå®æï¼ä»SQLAlchemyåçå°é«æè¿æ¥ç®¡çï¼åå«æ§è½ç¶é¢</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æä»FastAPIå¼åä¸­æ°æ®åºæä½çå¸¸è§çç¹åå¥ï¼æ·±å¥æµåºå°è§£æäºSQLAlchemyçæ ¸å¿åçï¼å¹¶éè¿ä¸ä¸ªå®æ´çSQLiteæä½å®ä¾ï¼æ¼ç¤ºäºå¦ä½æå»ºé«æãå¥å£®çæ°æ®åºè¿æ¥ä¸å­åæ¹æ¡ãéç¹åæäºè¿æ¥æ± æºå¶ä¸ä¾èµæ³¨å¥çæä½³å®è·µï¼æ¨å¨å¸®å©å¼åèååºæ§è½æ´ä¼ãæ´æç»´æ¤çWeb APIã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>ä½ æ¯å¦ä¹æ¾è¢«Web APIä¸­æä¹±æ ç« çæ°æ®åºè¿æ¥ä»£ç æå¾ç¦å¤´çé¢ï¼æ§è½ä¸ä¸å»ï¼Bugå´ä¸å°ã</p>
<p>è¯æ³å¨ä¸ä¸ªä¸­åé¡¹ç®ä¸­ï¼åæä¸ºäºå¾å¿«ï¼æ¯ä¸ªè¯·æ±é½æ°å»ºæ°æ®åºè¿æ¥ï¼ç»æå¨å¹¶åæµè¯æ¶ï¼APIååºæ¶é´ä»50msé£åå°2ç§ä»¥ä¸ï¼æ°æ®åºè¿æ¥æ°ç¬é´ææ»¡ï¼æå¡ç´æ¥éªå´©ãè¿ç»ä¸æ¯ä¸ªä¾ï¼<strong style="color: rgba(186, 55, 42, 1)">ä½æçæ°æ®åºè¿æ¥ç®¡çï¼æ¯Webåºç¨ä¸­æå¸¸è§å´ä¹æå®¹æè¢«å¿½è§çæ§è½ææä¹ä¸ã</strong></p>
<p>ä»å¤©ï¼æä»¬å°±ä»¥FastAPI + SQLite + SQLAlchemyè¿å¥è½»éä¸å¼ºå¤§çç»åä¸ºä¾ï¼å½»åºè®²æ¸æ¥å¦ä½é«æãä¼éå°æä½æ°æ®åºã</p>
<h2>ð¯ ä¸ãæ ¸å¿å°å¢ï¼æä»¬å°åºå¨è§£å³ä»ä¹é®é¢ï¼</h2>
<p>å¨Webå¼åä¸­ï¼æ°æ®åºæä½çä¼¼ç®åï¼æ éâè¿æ¥ãæ§è¡ãå³é­âãä½ä¸æ¦æ¾å°é«å¹¶åãé¿çå½å¨æçWebæå¡å¨ç¯å¢ä¸­ï¼é®é¢å°±å¤æäºï¼</p>
<div>
<p>- ð¢ <strong>æ§è½ç¶é¢</strong>ï¼é¢ç¹åå»ºåéæ¯æ°æ®åºè¿æ¥å¼éå·¨å¤§ã</p>
<p>- ð¥ <strong>èµæºèå°½</strong>ï¼è¿æ¥ä¸åæ¶éæ¾ï¼å¯¼è´è¿æ¥æ± èå°½ï¼æå¡ä¸å¯ç¨ã</p>
<p>- ð¤¯ <strong>ä»£ç æ··ä¹±</strong>ï¼ä¸å¡é»è¾åæ°æ®åºè¿æ¥ä»£ç çº ç¼ ä¸æ¸ï¼é¾ä»¥ç»´æ¤åæµè¯ã</p>
<p>- ð <strong>å¹¶åéæ£</strong>ï¼å¨å¤çº¿ç¨/å¼æ­¥ç¯å¢ä¸ï¼è¿æ¥å±äº«å¯è½å¼åæ°æ®éä¹±ã</p>
</div>
<p>FastAPIçå¼æ­¥ç¹æ§è®©äºæåå¾æ´âå¾®å¦âãç´æ¥ç¨ä¼ ç»çåæ­¥æ°æ®åºé©±å¨ï¼å¦<code style="color: rgba(186, 55, 42, 1)">sqlite3</code>æ¨¡åï¼ä¼é»å¡æ´ä¸ªäºä»¶å¾ªç¯ï¼<strong style="color: rgba(186, 55, 42, 1)">å¼æ­¥ä¼å¿è¡ç¶æ å­</strong>ãå æ­¤ï¼æä»¬éè¦ä¸ä¸ªæ¢è½ç®¡çè¿æ¥çå½å¨æï¼åè½ä¸å¼æ­¥æ¡æ¶åå¥½åä½çè§£å³æ¹æ¡ã</p>
<h2>ð§  äºãåçéè§ï¼SQLAlchemyï¼ä¸åªæ¯ORM</h2>
<p>å¾å¤äººæSQLAlchemyç­åäºä¸æ¬¾ORMï¼å¯¹è±¡å³ç³»æ å°ï¼å·¥å·ãè¿æ²¡éï¼ä½å®çæ ¸å¿ä»·å¼è¿ä¸æ­¢äºæ­¤ãä½ å¯ä»¥æå®çè§£ä¸ºä¸ä¸ª<strong style="color: rgba(186, 55, 42, 1)">å¼ºå¤§çâæ°æ®åºè¿æ¥ä¸æ¥è¯¢æå»ºå·¥åâ</strong>ã</p>
<p>æ³è±¡ä¸ä¸é¤åçåå¨ï¼</p>
<div>
<p>- ð ï¸ <strong>å¼æï¼Engineï¼</strong>ï¼é¤åçâä¸­å¤®å¨æ¿âãå®æ¯æ°æ®åºè¿æ¥çå·¥ååè¿æ¥æ± çææèãä½ éç½®å¥½ä¸æ¬¡ï¼æ°æ®åºå°åãè¿æ¥åæ°ãæ± å¤§å°ï¼ï¼æ´ä¸ªåºç¨é½ä»è¿éâåç¨âè¿æ¥ãå®æ¯å¨å±çãééçº§çã</p>
<p>- ð§¾ <strong>ä¼è¯ï¼Sessionï¼</strong>ï¼å¨å¸æä¸­çâè®¢åç¯®âãä¸ä¸ªSessionä»£è¡¨ä¸ä¸ªç¬ç«çæ°æ®åºæä½âå·¥ä½ååâãå®ä»Engineè·åä¸ä¸ªç©çè¿æ¥ï¼ç®¡çä¸ç³»åç¸å³çå¢å æ¹æ¥ï¼å¹¶å¨å®æåâå½è¿âè¿æ¥ãå®æ¯å±é¨çãè½»éçº§çï¼<strong style="color: rgba(186, 55, 42, 1)">å¹¶ä¸ç»å¯¹ä¸åºè¯¥è·¨è¯·æ±å±äº«</strong>ã</p>
<p>- ð <strong>ORMï¼Declarative Baseï¼</strong>ï¼æ ååçâèè°±âãå®å®ä¹äºæ°æ®æ¨¡åï¼è¡¨ç»æï¼åä¸å¡å¯¹è±¡ï¼Pythonç±»ï¼çæ å°å³ç³»ï¼è®©ä½ è½ç¨é¢åå¯¹è±¡çæ¹å¼æä½æ°æ®åºã</p>
</div>
<p><strong style="color: rgba(186, 55, 42, 1)">å³é®ç»è®ºï¼é«æ§è½å­åçæ ¸å¿ï¼å¨äºæ­£ç¡®ç®¡çEngineåSessionççå½å¨æã</strong> Engineéå¸¸åºç¨å¯å¨æ¶åå»ºï¼å³é­æ¶éæ¯ãèSessionå¿é¡»<strong style="color: rgba(186, 55, 42, 1)">âå³ç¨å³åï¼ç¨å®å³å³â</strong>ï¼ä¸æ¯ä¸ªè¯·æ±ç¬ç«ã</p>
<h2>âï¸ ä¸ãå®ææ¼ç»ï¼ä¸æ­¥æå»ºé«ææ°æ®å±</h2>
<p>çè®ºè¯´åå¤ï¼ä¸å¦ä»£ç æ¥å¾å®å¨ãä¸é¢æä»¬ä¸æ­¥æ­¥æ­å»ºä¸ä¸ªå¯ç¨çæ¡æ¶ã</p>
<h3>ç¬¬ä¸æ­¥ï¼åå»ºæ ¸å¿å¼æä¸æ¨¡å</h3>
<p>æä»¬ååå»ºæ°æ®åºè¿æ¥çæ ¸å¿ï¼Engineï¼åæ°æ®æ¨¡åçåºç±»ã</p>
<pre class="highlighter-hljs" style="background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px; overflow-x: auto"><code># database.py
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
import os

# å®ä¹æ°æ®åºæä»¶è·¯å¾
SQLALCHEMY_DATABASE_URL = f"sqlite:///./test.db"

# åå»ºå¼æ (æ ¸å¿)
# `connect_args={"check_same_thread": False}` å¯¹äºSQLiteå¤çº¿ç¨æ¯å¿é¡»ç
# `echo=True` å¼åæ¶å¼å¯ï¼å¯ä»¥æ¥ççæçSQLï¼çäº§ç¯å¢è¯·å³é­
# `pool_pre_ping=True` è¿æ¥æ± ååºè¿æ¥åè¿è¡å¥åº·æ£æ¥ï¼é¿åä½¿ç¨å¤±æè¿æ¥
engine = create_engine(
    SQLALCHEMY_DATABASE_URL,
    connect_args={"check_same_thread": False},
    echo=False, # çäº§ç¯å¢è®¾ä¸ºFalse
    pool_pre_ping=True,
    pool_size=5, # è¿æ¥æ± å¤§å°
    max_overflow=10 # åè®¸è¶åºpool_sizeçä¸´æ¶è¿æ¥æ°
)

# åå»ºä¼è¯å·¥åï¼ç»å®å°å¼æ
# `autocommit=False, autoflush=False` æ¯æ¨èè®¾ç½®ï¼ä¾¿äºäºå¡æ§å¶
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# å£°ææ§åºç±»ï¼æææ¨¡åç±»é½å°ç»§æ¿èªæ­¤
Base = declarative_base()</code></pre>
<h3>ç¬¬äºæ­¥ï¼å®ä¹æ°æ®æ¨¡åä¸ä¾èµæ³¨å¥</h3>
<p>æ¥çï¼æä»¬å®ä¹ä¸ä¸ªç¨æ·æ¨¡åï¼å¹¶åå»ºä¸ä¸ªè·åæ°æ®åºä¼è¯çFastAPIä¾èµé¡¹ãè¿æ¯å®ç°â<span style="color: rgba(186, 55, 42, 1)">è¯·æ±çº§å«Session</span>âçå³é®ï¼</p>
<pre class="highlighter-hljs" style="background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px; overflow-x: auto"><code># models.py
from sqlalchemy import Column, Integer, String
from database import Base

class User(Base):
    __tablename__ = "users"
    id = Column(Integer, primary_key=True, index=True)
    username = Column(String, unique=True, index=True, nullable=False)
    email = Column(String, unique=True, index=True)

# åå»ºè¡¨ï¼éå¸¸å¨åºç¨å¯å¨æ¶è°ç¨ä¸æ¬¡ï¼
# Base.metadata.create_all(bind=engine)

# dependencies.py
from database import SessionLocal
from fastapi import Depends
from typing import Generator

def get_db() -&gt; Generator:
    """
    æ°æ®åºä¼è¯ä¾èµé¡¹ã
    æ¯ä¸ªè¯·æ±è·åä¸ä¸ªç¬ç«Sessionï¼è¯·æ±ç»æåç¡®ä¿å³é­ã
    """
    db = SessionLocal()
    try:
        yield db # å°dbæ³¨å¥å°è·¯ç±å½æ°ä¸­
    finally:
        db.close() # æ è®ºè¯·æ±æåä¸å¦ï¼æç»é½ä¼å³é­ä¼è¯</code></pre>
<h3>ç¬¬ä¸æ­¥ï¼å¨è·¯ç±ä¸­å®ç°CRUD</h3>
<p>ç°å¨ï¼æä»¬å¯ä»¥å¨APIè·¯ç±ä¸­æå¿«å°ä½¿ç¨æ°æ®åºäºãæ³¨æç<code style="color: rgba(186, 55, 42, 1)">db: Session = Depends(get_db)</code>è¿è¡é­æ³ã</p>
<pre class="highlighter-hljs" style="background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px; overflow-x: auto"><code># main.py
from fastapi import FastAPI, Depends, HTTPException
from sqlalchemy.orm import Session
from pydantic import BaseModel
from typing import List
from models import User
from dependencies import get_db

app = FastAPI()

# Pydanticæ¨¡åï¼ç¨äºè¯·æ±/ååºéªè¯
class UserCreate(BaseModel):
    username: str
    email: str

class UserResponse(BaseModel):
    id: int
    username: str
    email: str

    class Config:
        orm_mode = True # åè®¸ä»ORMå¯¹è±¡è½¬æ¢

@app.post("/users/", response_model=UserResponse)
def create_user(user: UserCreate, db: Session = Depends(get_db)):
    # æ£æ¥ç¨æ·åæ¯å¦å·²å­å¨
    db_user = db.query(User).filter(User.username == user.username).first()
    if db_user:
        raise HTTPException(status_code=400, detail="Username already registered")
    # åå»ºORMå¯¹è±¡
    db_user = User(username=user.username, email=user.email)
    # æ·»å å°ä¼è¯
    db.add(db_user)
    # æäº¤äºå¡
    db.commit()
    # å·æ°ï¼ä½¿å¯¹è±¡è·å¾æ°æ®åºçæçIDç­æ°æ®
    db.refresh(db_user)
    return db_user

@app.get("/users/", response_model=List[UserResponse])
def read_users(skip: int = 0, limit: int = 10, db: Session = Depends(get_db)):
    users = db.query(User).offset(skip).limit(limit).all()
    return users</code></pre>
<h2>ð¨ åãæ³¨æäºé¡¹ä¸è¿é¶æè</h2>
<p>æ­åä½ ï¼ä¸ä¸ªç»ææ¸æ°ãè¿æ¥é«æçæ°æ®å±å·²ç»æ­å»ºå®æãä½å¨æå¥çäº§åï¼è¯·å¡å¿çæä»¥ä¸å ç¹ï¼</p>
<div>
<p>1. <strong style="color: rgba(186, 55, 42, 1)">è¿æ¥æ± éç½®æ¯èºæ¯</strong>ï¼<code style="color: rgba(186, 55, 42, 1)">pool_size</code>å<code style="color: rgba(186, 55, 42, 1)">max_overflow</code>æ²¡æé¶å¼¹ãè®¾ç½®å¤ªå°ï¼é«å¹¶åæ¶è¯·æ±æéï¼è®¾ç½®å¤ªå¤§ï¼æµªè´¹èµæºçè³æå®æ°æ®åºãéè¦æ ¹æ®å®éè´è½½ååæµè¯è°æ´ã</p>
<p>2. <strong style="color: rgba(186, 55, 42, 1)">Sessionççå½å¨æå°±æ¯äºå¡ççå½å¨æ</strong>ãä¸ä¸ªå¤æçä¸å¡æä½åºè¯¥å¨åä¸ä¸ªSessionä¸­å®æï¼ä»¥ä¿è¯äºå¡ä¸è´æ§ãä¸è¦å¨ä¸åè¯·æ±é´å±äº«Sessionã</p>
<p>3. <strong style="color: rgba(186, 55, 42, 1)">å¼æ­¥æ°æ®åºé©±å¨</strong>ï¼å¯¹äºè¿½æ±æè´æ§è½æåçå¼æ­¥æ°æ®åºï¼å¦PostgreSQLï¼ï¼èèä½¿ç¨<code style="color: rgba(186, 55, 42, 1)">asyncpg</code> + <code style="color: rgba(186, 55, 42, 1)">SQLAlchemy 1.4+</code>çå¼æ­¥æ¨¡å¼ãè¿æ¶ï¼EngineåSessioné½éè¦æ¢æå¼æ­¥çæ¬ï¼<code style="color: rgba(186, 55, 42, 1)">AsyncEngine</code>, <code style="color: rgba(186, 55, 42, 1)">AsyncSession</code>ï¼ï¼ä¾èµé¡¹ä¹è¦ç¨<code style="color: rgba(186, 55, 42, 1)">async with</code>ç®¡çã</p>
<p>4. <strong style="color: rgba(186, 55, 42, 1)">ä¸è¦å¨çäº§ç¯å¢ä½¿ç¨SQLite</strong>ï¼é¤éæ¯æå°è§æ¨¡åºç¨ï¼ãSQLiteå¨é«å¹¶ååå¥ãåå¸å¼é¨ç½²æ¹é¢æå¤©ç¶éå¶ãå®éå¸¸éåååå¼åãæµè¯åå°ååªè¯»åºç¨ã</p>
</div>
<p>ååä¸ä¸ï¼<strong style="color: rgba(186, 55, 42, 1)">æä»¬åå©SQLAlchemyï¼ä¸ä»ä»æ¯åæ´å°çSQLï¼æ´æ¯å¼å¥äºä¸å¥æçãå¯æ§çæ°æ®åºè®¿é®æ¨¡å¼ã</strong>å®å°ä½çº§çè¿æ¥ç®¡çãäºå¡æ§å¶æ½è±¡åºæ¥ï¼è®©æä»¬è½æ´ä¸æ³¨äºä¸å¡é»è¾æ¬èº«ãèFastAPIçä¾èµæ³¨å¥ç³»ç»ï¼å®ç¾å°å°è¿å¥æ¨¡å¼æ´åå°è¯·æ±çå½å¨æä¸­ï¼å®ç°äºèµæºç®¡ççèªå¨åä¸ä¼éåã</p>
<hr style="border: none; height: 1px; background: linear-gradient(90deg, rgba(0, 0, 0, 0), rgba(52, 152, 219, 1), rgba(0, 0, 0, 0)); margin: 40px 0">
<p style="text-align: center">---<strong>åå¨æå</strong>---<br>å¸æè¿ä»½æ»ç»è½å¸®ä½ é¿å¼ä¸äºåãå¦æè§å¾æç¨ï¼ä¸å¦¨ç¹ä¸ª èµð æ æ¶èâ­ æ è®°ä¸ä¸ï¼æ¹ä¾¿éæ¶åé¡¾ãä¹æ¬¢è¿å³æ³¨æï¼åç»­ä¸ºä½ å¸¦æ¥æ´å¤ç±»ä¼¼çå®æè§£æãæä»»ä½çé®ææ³æ³ï¼æä»¬è¯è®ºåºè§ï¼ä¸èµ·äº¤æµå¼åä¸­çåç§å¿å¾ä¸é®é¢ã</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 11:13">2026-01-14 11:13</span>&nbsp;
<a href="https://www.cnblogs.com/ymtianyu">ä¸åç¨åºåªå</a>&nbsp;
éè¯»(<span id="post_view_count">92</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19480142);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19480142', targetLink: 'https://www.cnblogs.com/ymtianyu/p/19480142', title: 'FastAPIæ°æ®åºå®æï¼ä»SQLAlchemyåçå°é«æè¿æ¥ç®¡çï¼åå«æ§è½ç¶é¢' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ°çä¸å¹´ï¼åç»åå®¢å­çå¤§å®¶ï¼ä¹åç»èªå·± ]]></title>
    <link>https://www.cnblogs.com/zxlh1529/p/19480754</link>
    <guid>8605ea59d1806e0890e523aeadae853c</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/zxlh1529/p/19480754" title="åå¸äº 2026-01-14 11:12">
    <span role="heading" aria-level="2">æ°çä¸å¹´ï¼åç»åå®¢å­çå¤§å®¶ï¼ä¹åç»èªå·±</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>2026 å¹´ï¼å·²ç»è¿å»åä¸ªæï¼æ¬æ¥å¹´åå¹´åæ³æ¾ä¸äºææ¯ç¹æ¥ä½ä¸ºé¦ç¯åè¡¨ï¼åé¢çäºçï¼æ³äºæ³ï¼æ²¡æ¾å°å¥½çç¹ï¼å½ç¶è¿ä¹æå ä¸ºæçææ¯è½åé®é¢ï¼æ·±çè°ä¸äºï¼æµçåè§å¾å¼ä¹æ å³ï¼å·²ç»æå¤ªå¤å¤§ä½¬åäºï¼å¾å¤åæ·±æå°±å¾åå½å»è¯´ 0110 äºã</p>
<p>æ°å¹´åå¼å§ï¼æ¶é´çº¿å·²ç»è¢«åç§é¢æµå æ»¡äºãé©¬æ¯ååå¤§é¢è¨ï¼é»éä¸æ¶¨çé¢æµï¼å¸æè¯è®ºåºå¤§ä½¬è·æè¯´å¥æ¶åä¼æï¼ã</p>
<p>æäººé¢æµææ¯è¶å¿ï¼æäººé¢æµè¡ä¸èµ°åï¼ä¹æäººè¯å¾ç¨å å¥è¯å¾ååºæªæ¥å å¹´çç­æ¡ãé¢æµæ¬èº«å¹¶ä¸ç½è§ï¼çè³å·²ç»æäºä¸ç§âæ°å¹´ä»ªå¼âã</p>
<p>ä½ææ³å¨æ°å¹´çç¬¬ä¸ç¯åå®¢éï¼å»æä¸è°è¿äºï¼éä¾¿è¯´è¯´ï¼ä¹æ¯ç¬¬ä¸æ¬¡ä¸åææ¯äºï¼ä»¥åå¨å­¦æ ¡å¤§ä¸è¿ä¸é¨æäºä¸ªå¬ä¼å·åææç±»çåååååååðã</p>
<hr>
<h2 id="å³äºèå¥">å³äºèå¥</h2>
<p>è¿å»ä¸å¹´ï¼æææ¾æåå°ä¸ç§ååï¼<br>
ä¿¡æ¯å¨å éï¼è§ç¹å¨åç¼©ï¼ç»è®ºå¨åç½®ã</p>
<p>å¾å¤åå®¹å·²ç»ä¸åè¯å¾âè§£éâï¼èæ¯ç´æ¥ç»åºæåº¦ï¼<br>
<strong>ä¸åè®¨è®ºè¿ç¨ï¼èæ¯åªä¿çç»æã</strong></p>
<p>å¨è¿æ ·çç¯å¢ä¸ï¼æ¢ä¸æ¥åèæäºä¸ç§éè¦å»æåæçéæ©ã</p>
<p>ååå®¢ä¹æ¯ã<br>
å®ä¸æ¯æå¿«çè¡¨è¾¾æ¹å¼ï¼ä¹ä¸æ¯æå®¹æè·å¾åé¦çæ¹å¼ï¼ä½å®è®©æä¿çäºä¸ç¹<strong>å®æ´æèçèå¥</strong>ââèä¸æ¯è¢«æ¨çèµ°ã</p>
<hr>
<h2 id="å³äºä¸ç¡®å®æ§">å³äºä¸ç¡®å®æ§</h2>
<p>é¢æµæµè¡ï¼æ¬è´¨ä¸æ¯æä»¬å¯¹ä¸ç¡®å®æ§çææã</p>
<p>ä½æ¯ä¸åè¿ä¸å¹´å¤å·¥ä½ä¹åè®©æè¶æ¥è¶æ¸æ¥ï¼<br>
<strong>ä¸ç¡®å®æ§ä¸æ¯é®é¢æ¬èº«ï¼å®æ¯ç¯å¢çå¸¸æã</strong></p>
<p>çæ­£æä»·å¼çè½åï¼å¹¶ä¸æ¯âçå¯¹æªæ¥âï¼èæ¯ï¼</p>
<ul>
<li>å½åè®¾å¤±ææ¶ï¼è½å¦åæ¶è°æ´</li>
<li>å½è·¯å¾ååæ¶ï¼æ¯å¦ä»ç¶å·å¤éæ©ç©ºé´</li>
<li>å½ç­æ¡ä¸å­å¨æ¶ï¼æ¯å¦è¿è½ç»§ç»­åè¿</li>
</ul>
<p>ææ¯æ ä¼åï¼æ¡æ¶ä¼åï¼èå¼ä¼åã<br>
ä½é¢å¯¹ååæ¶çå¤æ­ååä¿®æ­£è½åï¼å¾å°è¢«è¶å¿æ¬èº«æ·æ±°ã</p>
<hr>
<h2 id="å³äºé¿æä¸»ä¹">å³äºé¿æä¸»ä¹</h2>
<p>å¦æè¯´æä»ä¹ä¸è¥¿å¨ææ¯ä¸çéåå¾è¶æ¥è¶ç¨ç¼ºï¼é£ä¸å®ä¸æ¯ä¿¡æ¯ï¼èæ¯<strong>æç»­æ§</strong>ã</p>
<p>æç»­å­¦ä¹ ä¸é¾ï¼æç»­è¾åºä¸é¾ï¼<br>
é¾çæ¯å¨æ²¡ææå£°ãæ²¡æç­ç¹ãæ²¡æâæ­£ç¡®ç­æ¡âçæåµä¸ï¼ä¾ç¶æ¿æç»§ç»­ã</p>
<p>ååå®¢å¯¹ææ¥è¯´ï¼æ´åæ¯ä¸ç§é¿æè¡ä¸ºï¼</p>
<ul>
<li>ä¸è¿½ç­ç¹</li>
<li>ä¸å»æå¶é ç»è®º</li>
<li>ä¸æ¥çè¯æä»ä¹</li>
</ul>
<p>å å¹´åååå¤´çï¼å®å¯è½å¹¶ä¸è½è¯´ææâå¤åè¿âï¼ä½è³å°è½è¯ææ<strong>æ²¡æå®å¨è¢«ç­æåªå£°å¸¦èµ°</strong>ï¼ä¹æ¯æå­¦ä¹ çççï¼åè¿å¤´è½å¤ææ¦å²ç¬ä¸ä¸æ­¤æ¶çæã</p>
<hr>
<h2 id="å³äºè¾¹ç">å³äºè¾¹ç</h2>
<p>ææ¯å¾éè¦ï¼ä½ææ¯ä¸æ¯å¨é¨ã</p>
<p>å½ææé®é¢é½è¢«åè£æâæçé®é¢ââæé¿é®é¢ââè·¯çº¿éæ©é®é¢âæ¶ï¼åèå®¹æå¿½ç¥ä¸äºæ´åºç¡çä¸è¥¿ï¼</p>
<ul>
<li>ä½ æ¯å¦è¿è½ä¿æä¸æ³¨</li>
<li>ä½ æ¯å¦è¿è½äº«åè§£å³é®é¢çè¿ç¨</li>
<li>ä½ æ¯å¦è¿ç¥éèªå·±ä¸ºä»ä¹èµ°å¨è¿æ¡è·¯ä¸</li>
<li>ä½ æ¯å¦è¿ç­ç±çæ´»</li>
</ul>
<p>ç»ææ¯çè¾¹çï¼å¶å®ä¹æ¯å¨ç»èªå·±çç©ºé´ã</p>
<hr>
<h2 id="æå">æå</h2>
<p>è¿åä¸ªå³äºä¸ä¼ç»åºç­æ¡ï¼ä¹æ²¡æåºå®ç­æ¡ï¼ç¯å¹å¾ç­ï¼äººçå¾é¿ï¼å¹¶ä¸è½å¯¥å¯¥æ¦æ¬ã</p>
<p>å®æ´åæ¯ä¸æ¬¡å»æçåé¡¿ã</p>
<p>æ°çä¸å¹´ï¼æä¾ç¶ä¼åä»£ç ãåæ¶æãåå·¥ç¨å®è·µãåçæ´»ãåææï¼<br>
ä½å¨è¿äºä¹åï¼æå¸æèªå·±è½è®°ä½ï¼</p>
<ul>
<li>èå¥æ¯éåº¦éè¦</li>
<li>éåºæ¯é¢æµéè¦</li>
<li>æç»­æ¯çåéè¦</li>
<li>è¾¹çæ¯æ éæ©å¼ éè¦</li>
</ul>
<p>æ°å¹´ç¬¬ä¸ç¯ï¼åç»èªå·±ï¼ä¹åç»ä»ç¶æ¿ææ¢æ¢è¯»å®æ¯ä¸ç¯åå®¢çäººã</p>
<p>å¸ææ¥ä¸æ¥çä½ ï¼ç­ç±ææ¯ï¼ä¹ç­ç±çæ´»ï¼ç­ç±è¿å¾çä½ ï¼ç°å¨çä½ ï¼æªæ¥çä½ ï¼ä¸ç®¡åçä»ä¹ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.001388888888888889" data-date-updated="2026-01-14 11:14">2026-01-14 11:12</span>&nbsp;
<a href="https://www.cnblogs.com/zxlh1529">å¹¼å¿å­ææ¯å®¶</a>&nbsp;
éè¯»(<span id="post_view_count">635</span>)&nbsp;
è¯è®º(<span id="post_comment_count">2</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19480754);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19480754', targetLink: 'https://www.cnblogs.com/zxlh1529/p/19480754', title: 'æ°çä¸å¹´ï¼åç»åå®¢å­çå¤§å®¶ï¼ä¹åç»èªå·±' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å·¥ä½ä¸­æå¸¸ç¨ç5ç§æ¬å°ç¼å­ ]]></title>
    <link>https://www.cnblogs.com/12lisu/p/19480472</link>
    <guid>7683824e65a1bca80e35ca0d7e3a60c0</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/12lisu/p/19480472" title="åå¸äº 2026-01-14 09:55">
    <span role="heading" aria-level="2">å·¥ä½ä¸­æå¸¸ç¨ç5ç§æ¬å°ç¼å­</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="åè¨">åè¨</h2>
<p>ä»å¤©åå¤§å®¶èèä¸ä¸ªå ä¹ææJavaå¼åèé½ä¼ç¨å°ï¼ä½å¾å¤äººå¯¹å¶çè§£ä¸å¤æ·±å¥çææ¯ââ<strong>æ¬å°ç¼å­</strong>ã</p>
<p>æäºå°ä¼ä¼´å¨å·¥ä½ä¸­å¯è½éå°è¿è¿æ ·çåºæ¯ï¼ç³»ç»æ§è½æµè¯æ¶ï¼åç°æä¸ªæ¥å£ååºæ¶é´è¶æ¥è¶é¿ï¼ä¸æ¥åç°æ¯æ°æ®åºæ¥è¯¢å¤ªé¢ç¹ã</p>
<p>å äºRedisåå¸å¼ç¼å­åæææ¹åï¼ä½ç½ç»IOçå¼éä¾ç¶å­å¨ï¼ç¹å«æ¯å¯¹æ¶ææ§è¦æ±é«çæ°æ®ã</p>
<p>è¿æ¶åï¼æ¬å°ç¼å­çä»·å¼å°±å¸æ¾åºæ¥äºã</p>
<p>æ¬å°ç¼å­æ¯ä»ä¹ï¼</p>
<p>ç®åè¯´å°±æ¯å°æ°æ®å­å¨å¨<strong>åºç¨è¿ç¨çåå­ä¸­</strong>ï¼å®ç°æ°æ®çå¿«éè®¿é®ã</p>
<p>å®çè®¿é®éåº¦éå¸¸æ¯çº³ç§çº§ï¼èåå¸å¼ç¼å­ï¼å¦Redisï¼æ¯æ¯«ç§çº§ï¼æ°æ®åºæ¥è¯¢æ´æ¯æ¯«ç§å°ç§çº§ã</p>
<h2 id="01-ä¸ºä»ä¹éè¦æ¬å°ç¼å­">01 ä¸ºä»ä¹éè¦æ¬å°ç¼å­ï¼</h2>
<p>å¨æ·±å¥å·ä½æ¹æ¡åï¼æä»¬åææ¸æ¥æ¬å°ç¼å­çæ ¸å¿ä»·å¼ã</p>
<p>æ¥çä¸ä¸ªæ²¡æç¼å­çåºæ¯ï¼</p>
<pre><code class="language-java">// æ²¡æç¼å­çç¨æ·æ¥è¯¢æå¡
@Service
public class CategoryServiceWithoutCache {
    
    @Autowired
    private CategoryMapper categoryMapper;
    
    public Category getCategoryById(Long categoryId) {
        // æ¯æ¬¡è°ç¨é½ç´æ¥æ¥è¯¢æ°æ®åº
        return categoryMapper.selectById(categoryId);
    }
    
    // åè®¾è¿ä¸ªæ¥å£æ¯ç§è¢«è°ç¨1000æ¬¡
    // æ°æ®åºå°±è¦æ¿å1000QPSçåå
}
</code></pre>
<p>è¿ç§è®¾è®¡çé®é¢å¾ææ¾ï¼</p>
<ol>
<li><strong>æ°æ®åºååå¤§</strong>ï¼æ¯æ¬¡è¯·æ±é½è¦æ¥è¯¢æ°æ®åº</li>
<li><strong>ååºæ¶é´é¿</strong>ï¼æ°æ®åºæ¥è¯¢éå¸¸éè¦å æ¯«ç§å°å åæ¯«ç§</li>
<li><strong>ç³»ç»å¯æ©å±æ§å·®</strong>ï¼æ°æ®åºæä¸ºåç¹ç¶é¢</li>
</ol>
<p>å¼å¥æ¬å°ç¼å­åï¼æåµä¼å¤§å¤§æ¹åï¼</p>
<pre><code class="language-java">// ä½¿ç¨æ¬å°ç¼å­çç¨æ·æ¥è¯¢æå¡
@Service
public class CategoryServiceWithCache {
    
    @Autowired
    private CategoryMapper categoryMapper;
    
    // ä½¿ç¨ConcurrentHashMapä½ä¸ºæ¬å°ç¼å­
    private final Map&lt;Long, Category&gt; categoryCache = new ConcurrentHashMap&lt;&gt;();
    
    public Category getCategoryById(Long categoryId) {
        // 1. åæ¥ç¼å­
        Category category = categoryCache.get(categoryId);
        if (category != null) {
            return category;  // ç¼å­å½ä¸­ï¼ç´æ¥è¿å
        }
        
        // 2. ç¼å­æªå½ä¸­ï¼æ¥è¯¢æ°æ®åº
        category = categoryMapper.selectById(categoryId);
        if (category != null) {
            // 3. å°æ°æ®æ¾å¥ç¼å­
            categoryCache.put(categoryId, category);
        }
        
        return category;
    }
}
</code></pre>
<p>è¿æ ·æ¹é åï¼å¯¹äºåä¸ä¸ªåç±»çå¤æ¬¡æ¥è¯¢ï¼åªæç¬¬ä¸æ¬¡ä¼è®¿é®æ°æ®åºï¼åç»­æ¥è¯¢é½ç´æ¥è¿åç¼å­æ°æ®ï¼æ§è½æåå ä¸ªæ°éçº§ã</p>
<p>ä½æ¯ï¼ç®åç<code>ConcurrentHashMap</code>åªæ¯æ¬å°ç¼å­çæåºç¡å½¢æã</p>
<p>å¨å®éçäº§ä¸­ï¼æä»¬éè¦èèæ´å¤é®é¢ï¼<strong>åå­ç®¡çãè¿æç­ç¥ãç¼å­æ·æ±°ãå¹¶åæ§å¶</strong>ç­ã</p>
<p>è¿å°±æ¯åç§æ¬å°ç¼å­æ¡æ¶å­å¨çæä¹ã</p>
<h2 id="02-æ¬å°ç¼å­æ ¸å¿è¦ç´ ">02 æ¬å°ç¼å­æ ¸å¿è¦ç´ </h2>
<p>å¨ä»ç»å·ä½æ¹æ¡åï¼æä»¬åäºè§£ä¸ä¸ªä¼ç§æ¬å°ç¼å­åºè¯¥å·å¤çç¹æ§ï¼</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2238006/202601/2238006-20260114095253873-970129861.png" class="lazyload"></p>
<p>çè§£äºè¿äºæ ¸å¿è¦ç´ ï¼æä»¬å°±è½æ´å¥½å°è¯ä¼°åç§ç¼å­æ¹æ¡ã</p>
<p>ç°å¨ï¼è®©æä»¬æ·±å¥åæ5ç§æå¸¸ç¨çæ¬å°ç¼å­æ¹æ¡ã</p>
<h2 id="03-æ¹æ¡ä¸concurrenthashmap">03 æ¹æ¡ä¸ï¼ConcurrentHashMap</h2>
<h3 id="åçä¸ç¹ç¹">åçä¸ç¹ç¹</h3>
<p><code>ConcurrentHashMap</code>æ¯JDKèªåççº¿ç¨å®å¨çåå¸è¡¨ï¼å®éè¿<strong>åæ®µé</strong>ææ¯å®ç°é«å¹¶åè®¿é®ã</p>
<p>ä½ä¸ºç¼å­ä½¿ç¨æ¶ï¼å®æ¯æç®åãæè½»éçº§çéæ©ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2238006/202601/2238006-20260114095305279-96940489.png" class="lazyload"></p>
<p><strong>æ ¸å¿æºå¶</strong>ï¼</p>
<ul>
<li><strong>åæ®µé</strong>ï¼å°æ´ä¸ªMapåæå¤ä¸ªSegmentï¼æ¯ä¸ªSegmentç¬ç«å é</li>
<li><strong>å¹¶ååº¦</strong>ï¼é»è®¤16ä¸ªSegmentï¼å¯æ¯æ16ä¸ªçº¿ç¨å¹¶åå</li>
<li><strong>Java 8ä¼å</strong>ï¼å¨Java 8ä¸­æ¹ä¸ºä½¿ç¨<code>synchronized</code>+<code>CAS</code>+çº¢é»æ ï¼æ§è½æ´å¥½</li>
</ul>
<h3 id="å®æä»£ç ç¤ºä¾">å®æä»£ç ç¤ºä¾</h3>
<pre><code class="language-java">import java.util.concurrent.*;

/**
 * åºäºConcurrentHashMapçç®ææ¬å°ç¼å­
 * ç¹ç¹ï¼ç®åãè½»éãæ è¿æç­ç¥
 */
public class ConcurrentHashMapCache&lt;K, V&gt; {
    
    // æ ¸å¿ç¼å­å­å¨
    private final ConcurrentHashMap&lt;K, V&gt; cache;
    
    // å¯éçç¼å­å è½½å¨
    private final CacheLoader&lt;K, V&gt; loader;
    
    public ConcurrentHashMapCache() {
        this.cache = new ConcurrentHashMap&lt;&gt;();
        this.loader = null;
    }
    
    public ConcurrentHashMapCache(CacheLoader&lt;K, V&gt; loader) {
        this.cache = new ConcurrentHashMap&lt;&gt;();
        this.loader = loader;
    }
    
    /**
     * è·åç¼å­å¼
     * å¦æä¸å­å¨ä¸éç½®äºloaderï¼åå è½½æ°æ®
     */
    public V get(K key) {
        V value = cache.get(key);
        
        if (value == null &amp;&amp; loader != null) {
            // åéæ£æ¥éï¼é²æ­¢å¹¶åå è½½
            synchronized (this) {
                value = cache.get(key);
                if (value == null) {
                    value = loader.load(key);
                    if (value != null) {
                        cache.put(key, value);
                    }
                }
            }
        }
        
        return value;
    }
    
    /**
     * æ¾å¥ç¼å­
     */
    public void put(K key, V value) {
        cache.put(key, value);
    }
    
    /**
     * ç§»é¤ç¼å­
     */
    public V remove(K key) {
        return cache.remove(key);
    }
    
    /**
     * æ¸ç©ºç¼å­
     */
    public void clear() {
        cache.clear();
    }
    
    /**
     * è·åç¼å­å¤§å°
     */
    public int size() {
        return cache.size();
    }
    
    /**
     * å¤æ­æ¯å¦åå«key
     */
    public boolean containsKey(K key) {
        return cache.containsKey(key);
    }
    
    /**
     * ç¼å­å è½½å¨æ¥å£
     */
    @FunctionalInterface
    public interface CacheLoader&lt;K, V&gt; {
        V load(K key);
    }
}

/**
 * ä½¿ç¨ç¤ºä¾ï¼ç¨æ·ä¿¡æ¯ç¼å­
 */
@Service
public class UserServiceWithConcurrentHashMap {
    
    @Autowired
    private UserMapper userMapper;
    
    // ä½¿ç¨èªå®ä¹çConcurrentHashMapç¼å­
    private final ConcurrentHashMapCache&lt;Long, User&gt; userCache;
    
    public UserServiceWithConcurrentHashMap() {
        // åå§åç¼å­ï¼éç½®ç¼å­å è½½å¨
        userCache = new ConcurrentHashMapCache&lt;&gt;(userId -&gt; {
            // å½ç¼å­ä¸å­å¨æ¶ï¼è°ç¨æ­¤æ¹æ³å è½½æ°æ®
            System.out.println("ç¼å­æªå½ä¸­ï¼ä»æ°æ®åºå è½½ç¨æ·: " + userId);
            return userMapper.selectById(userId);
        });
    }
    
    /**
     * è·åç¨æ·ä¿¡æ¯ï¼å¸¦ç¼å­ï¼
     */
    public User getUserById(Long userId) {
        return userCache.get(userId);
    }
    
    /**
     * æ´æ°ç¨æ·ä¿¡æ¯ï¼åæ¶æ´æ°ç¼å­ï¼
     */
    public void updateUser(User user) {
        // 1. æ´æ°æ°æ®åº
        userMapper.updateById(user);
        
        // 2. æ´æ°ç¼å­
        userCache.put(user.getId(), user);
    }
    
    /**
     * å é¤ç¨æ·ï¼åæ¶å é¤ç¼å­ï¼
     */
    public void deleteUser(Long userId) {
        // 1. å é¤æ°æ®åºè®°å½
        userMapper.deleteById(userId);
        
        // 2. å é¤ç¼å­
        userCache.remove(userId);
    }
    
    /**
     * æ¹éè·åç¨æ·ï¼ä¼åN+1æ¥è¯¢ï¼
     */
    public Map&lt;Long, User&gt; getUsersByIds(List&lt;Long&gt; userIds) {
        Map&lt;Long, User&gt; result = new HashMap&lt;&gt;();
        List&lt;Long&gt; missingIds = new ArrayList&lt;&gt;();
        
        // 1. åä»ç¼å­è·å
        for (Long userId : userIds) {
            User user = userCache.get(userId);
            if (user != null) {
                result.put(userId, user);
            } else {
                missingIds.add(userId);
            }
        }
        
        // 2. æ¹éæ¥è¯¢ç¼ºå¤±çæ°æ®
        if (!missingIds.isEmpty()) {
            List&lt;User&gt; dbUsers = userMapper.selectBatchIds(missingIds);
            for (User user : dbUsers) {
                result.put(user.getId(), user);
                userCache.put(user.getId(), user);  // æ¾å¥ç¼å­
            }
        }
        
        return result;
    }
}
</code></pre>
<h3 id="ä¼ç¼ºç¹åæ">ä¼ç¼ºç¹åæ</h3>
<p><strong>ä¼ç¹ï¼</strong></p>
<ol>
<li><strong>JDKåçæ¯æ</strong>ï¼æ éå¼å¥ç¬¬ä¸æ¹ä¾èµ</li>
<li><strong>çº¿ç¨å®å¨</strong>ï¼åæ®µé/CASä¿è¯å¹¶åå®å¨</li>
<li><strong>æ§è½ä¼ç§</strong>ï¼è¯»æä½å®å¨æ éï¼åæä½éç²åº¦å°</li>
<li><strong>ç®åè½»é</strong>ï¼ä»£ç ç®åï¼èµæºæ¶èå°</li>
</ol>
<p><strong>ç¼ºç¹ï¼</strong></p>
<ol>
<li><strong>åè½æé</strong>ï¼ç¼ºä¹è¿æãæ·æ±°ç­é«çº§åè½</li>
<li><strong>åå­æ æ³éå¶</strong>ï¼å¯è½é æåå­æº¢åº</li>
<li><strong>éè¦æå¨ç®¡ç</strong>ï¼ç¼å­ç­ç¥éè¦èªå·±å®ç°</li>
</ol>
<p><strong>éç¨åºæ¯ï¼</strong></p>
<ul>
<li>ç¼å­æ°æ®éå°ä¸åºå®</li>
<li>ä¸éè¦èªå¨è¿æåè½</li>
<li>ä½ä¸ºæ´å¤æç¼å­çåºå±å®ç°</li>
<li>ä¸´æ¶æ§ãç®åçç¼å­éæ±</li>
</ul>
<p>æäºå°ä¼ä¼´å¨é¡¹ç®åæåæ¬¢ç¨<code>ConcurrentHashMap</code>åç¼å­ï¼å ä¸ºå®ç®åç´æ¥ã</p>
<p>ä½éçä¸å¡å¤æåï¼å¾å¾ä¼éå°åå­æº¢åºãç¼å­æ¸çç­é®é¢ï¼è¿æ¶åå°±éè¦æ´ä¸ä¸çç¼å­æ¹æ¡äºã</p>
<h2 id="04-æ¹æ¡äºlruç¼å­">04 æ¹æ¡äºï¼LRUç¼å­</h2>
<h3 id="åçä¸ç¹ç¹-1">åçä¸ç¹ç¹</h3>
<p>LRUï¼Least Recently Usedï¼æè¿æå°ä½¿ç¨ï¼æ¯ä¸ç§ç»å¸çç¼å­æ·æ±°ç®æ³ã</p>
<p>å½ç¼å­ç©ºé´ä¸è¶³æ¶ï¼ä¼åæ·æ±°<strong>æä¹æªè¢«è®¿é®</strong>çæ°æ®ã</p>
<p><code>LinkedHashMap</code>æ¯JDKæä¾çå®ç°äºLRUç¹æ§çMapå®ç°ã</p>
<p>å®éè¿ç»´æ¤ä¸ä¸ª<strong>ååé¾è¡¨</strong>æ¥è®°å½è®¿é®é¡ºåºã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2238006/202601/2238006-20260114095325773-1561315843.png" class="lazyload"></p>
<p><strong>æ ¸å¿æºå¶</strong>ï¼</p>
<ul>
<li><strong>è®¿é®é¡ºåº</strong>ï¼<code>accessOrder=true</code>æ¶ï¼æ¯æ¬¡è®¿é®ä¼å°èç¹ç§»å°é¾è¡¨å¤´é¨</li>
<li><strong>æ·æ±°ç­ç¥</strong>ï¼é¾è¡¨å°¾é¨çèç¹æ¯æä¹æªè®¿é®ç</li>
<li><strong>éåremoveEldestEntry</strong>ï¼æ§å¶ä½æ¶å é¤æèèç¹</li>
</ul>
<h3 id="å®æä»£ç ç¤ºä¾-1">å®æä»£ç ç¤ºä¾</h3>
<pre><code class="language-java">import java.util.*;

/**
 * åºäºLinkedHashMapçLRUç¼å­
 * ç¹ç¹ï¼èªå¨æ·æ±°æä¹æªä½¿ç¨çæ°æ®
 */
public class LRUCache&lt;K, V&gt; extends LinkedHashMap&lt;K, V&gt; {
    
    private final int maxCapacity;
    
    /**
     * åå»ºLRUç¼å­
     * @param maxCapacity æå¤§å®¹é
     */
    public LRUCache(int maxCapacity) {
        // ç¬¬ä¸ä¸ªåæ°accessOrderä¸ºtrueè¡¨ç¤ºæè®¿é®é¡ºåºæåº
        super(16, 0.75f, true);
        this.maxCapacity = maxCapacity;
    }
    
    /**
     * éåæ­¤æ¹æ³å³å®ä½æ¶å é¤æèçæ¡ç®
     * @param eldest æèçæ¡ç®ï¼æè¿æå°ä½¿ç¨ï¼
     * @return trueè¡¨ç¤ºåºè¯¥å é¤æèçæ¡ç®
     */
    @Override
    protected boolean removeEldestEntry(Map.Entry&lt;K, V&gt; eldest) {
        // å½å¤§å°è¶è¿æå¤§å®¹éæ¶ï¼å é¤æèçæ¡ç®
        return size() &gt; maxCapacity;
    }
    
    /**
     * è·åç¼å­å¼ï¼ä¼æ´æ°è®¿é®é¡ºåºï¼
     */
    @Override
    public V get(Object key) {
        synchronized (this) {
            return super.get(key);
        }
    }
    
    /**
     * æ¾å¥ç¼å­å¼
     */
    @Override
    public V put(K key, V value) {
        synchronized (this) {
            return super.put(key, value);
        }
    }
    
    /**
     * è·åç¼å­ç»è®¡ä¿¡æ¯
     */
    public CacheStats getStats() {
        return new CacheStats(size(), maxCapacity);
    }
    
    /**
     * è·åæè¿è®¿é®çNä¸ªé®
     */
    public List&lt;K&gt; getRecentlyAccessed(int n) {
        List&lt;K&gt; result = new ArrayList&lt;&gt;();
        Iterator&lt;K&gt; iterator = keySet().iterator();
        
        for (int i = 0; i &lt; n &amp;&amp; iterator.hasNext(); i++) {
            result.add(iterator.next());
        }
        
        return result;
    }
    
    /**
     * ç¼å­ç»è®¡ä¿¡æ¯
     */
    public static class CacheStats {
        private final int currentSize;
        private final int maxCapacity;
        private final double usageRatio;
        
        public CacheStats(int currentSize, int maxCapacity) {
            this.currentSize = currentSize;
            this.maxCapacity = maxCapacity;
            this.usageRatio = maxCapacity &gt; 0 ? (double) currentSize / maxCapacity : 0;
        }
        
        // getters...
    }
}

/**
 * çº¿ç¨å®å¨çLRUç¼å­å®ç°
 */
public class ConcurrentLRUCache&lt;K, V&gt; {
    
    private final LRUCache&lt;K, V&gt; cache;
    
    public ConcurrentLRUCache(int maxCapacity) {
        this.cache = new LRUCache&lt;&gt;(maxCapacity);
    }
    
    /**
     * è·åç¼å­å¼
     */
    public V get(K key) {
        synchronized (cache) {
            return cache.get(key);
        }
    }
    
    /**
     * æ¾å¥ç¼å­å¼
     */
    public V put(K key, V value) {
        synchronized (cache) {
            return cache.put(key, value);
        }
    }
    
    /**
     * æ¹éæ¾å¥ç¼å­
     */
    public void putAll(Map&lt;? extends K, ? extends V&gt; map) {
        synchronized (cache) {
            cache.putAll(map);
        }
    }
    
    /**
     * ç§»é¤ç¼å­
     */
    public V remove(K key) {
        synchronized (cache) {
            return cache.remove(key);
        }
    }
    
    /**
     * æ¸ç©ºç¼å­
     */
    public void clear() {
        synchronized (cache) {
            cache.clear();
        }
    }
    
    /**
     * è·åç¼å­å¤§å°
     */
    public int size() {
        synchronized (cache) {
            return cache.size();
        }
    }
    
    /**
     * æ£æ¥ç¼å­æ¯å¦åå«key
     */
    public boolean containsKey(K key) {
        synchronized (cache) {
            return cache.containsKey(key);
        }
    }
    
    /**
     * è·åç¼å­ç»è®¡ä¿¡æ¯
     */
    public LRUCache.CacheStats getStats() {
        synchronized (cache) {
            return cache.getStats();
        }
    }
}

/**
 * ä½¿ç¨ç¤ºä¾ï¼ååä¿¡æ¯ç¼å­
 */
@Service
public class ProductServiceWithLRUCache {
    
    @Autowired
    private ProductMapper productMapper;
    
    // LRUç¼å­ï¼æå¤ç¼å­1000ä¸ªåå
    private final ConcurrentLRUCache&lt;Long, Product&gt; productCache;
    
    // ç­é¨ååç¼å­ï¼æ´å°çLRUç¼å­ï¼
    private final ConcurrentLRUCache&lt;Long, Product&gt; hotProductCache;
    
    public ProductServiceWithLRUCache() {
        // ä¸»ç¼å­ï¼1000ä¸ªåå
        productCache = new ConcurrentLRUCache&lt;&gt;(1000);
        
        // ç­é¨ååç¼å­ï¼100ä¸ªåå
        hotProductCache = new ConcurrentLRUCache&lt;&gt;(100);
    }
    
    /**
     * è·åååä¿¡æ¯
     */
    public Product getProductById(Long productId) {
        // 1. åæ¥ç­é¨ååç¼å­
        Product product = hotProductCache.get(productId);
        if (product != null) {
            recordCacheHit("hot");  // è®°å½å½ä¸­
            return product;
        }
        
        // 2. æ¥ä¸»ç¼å­
        product = productCache.get(productId);
        if (product != null) {
            // å¦æååè¢«é¢ç¹è®¿é®ï¼ç§»å°ç­é¨ç¼å­
            if (isFrequentlyAccessed(productId)) {
                hotProductCache.put(productId, product);
            }
            recordCacheHit("main");
            return product;
        }
        
        // 3. ç¼å­æªå½ä¸­ï¼æ¥è¯¢æ°æ®åº
        product = productMapper.selectById(productId);
        if (product != null) {
            // æ¾å¥ä¸»ç¼å­
            productCache.put(productId, product);
            recordCacheMiss();
        }
        
        return product;
    }
    
    /**
     * è·åç­é¨åååè¡¨
     */
    public List&lt;Product&gt; getHotProducts(int limit) {
        // ç´æ¥ä»ç­é¨ç¼å­è·åæè¿è®¿é®çåå
        // æ³¨æï¼è¿åªæ¯ç®åç¤ºä¾ï¼å®ééè¦æ´å¤æçç­é¨åº¦è®¡ç®
        
        List&lt;Product&gt; hotProducts = new ArrayList&lt;&gt;();
        
        synchronized (hotProductCache) {
            // è¿ééè¦æ©å±ConcurrentLRUCacheä»¥æ¯æè·åææå¼
            // å®éå®ç°ä¸­éè¦ç»´æ¤é¢å¤çæ°æ®ç»æ
        }
        
        return hotProducts;
    }
    
    /**
     * æ´æ°ååä¿¡æ¯ï¼åæ¶æ´æ°ä¸¤ä¸ªç¼å­ï¼
     */
    public void updateProduct(Product product) {
        Long productId = product.getId();
        
        // 1. æ´æ°æ°æ®åº
        productMapper.updateById(product);
        
        // 2. æ´æ°ç¼å­
        productCache.put(productId, product);
        hotProductCache.put(productId, product);
        
        // 3. è®°å½æ´æ°æ¥å¿
        logProductUpdate(productId);
    }
    
    /**
     * æ¹éå¤±æç¼å­ï¼å½åååç±»æ´æ°æ¶ï¼
     */
    public void invalidateProductsByCategory(Long categoryId) {
        // å¨å®éåºç¨ä¸­ï¼è¿ééè¦éåç¼å­å¹¶å é¤å¯¹åºåç±»çåå
        // ä¸ºäºæ§è½ï¼å¯ä»¥ï¼
        // 1. ä½¿ç¨åä»£ç¼å­
        // 2. ä½¿ç¨å¼æ­¥æ¸ç
        // 3. ä½¿ç¨æ´ç»ç²åº¦çç¼å­é®
        
        System.out.println("åååç±»æ´æ°ï¼éè¦æ¸çç¸å³ç¼å­: " + categoryId);
        // è¿éç®åå¤çï¼æ¸ç©ºææç¼å­ï¼çäº§ç¯å¢ä¸æ¨èï¼
        // productCache.clear();
        // hotProductCache.clear();
    }
    
    private boolean isFrequentlyAccessed(Long productId) {
        // ç®åå®ç°ï¼æ»æ¯è¿åtrue
        // å®ééè¦åºäºè®¿é®é¢ççç­åº¦ç®æ³
        return true;
    }
    
    private void recordCacheHit(String cacheType) {
        // è®°å½ç¼å­å½ä¸­ï¼ç¨äºçæ§åè°ä¼
        System.out.println("ç¼å­å½ä¸­ [" + cacheType + "]: " + System.currentTimeMillis());
    }
    
    private void recordCacheMiss() {
        // è®°å½ç¼å­æªå½ä¸­
        System.out.println("ç¼å­æªå½ä¸­: " + System.currentTimeMillis());
    }
    
    private void logProductUpdate(Long productId) {
        // è®°å½ååæ´æ°
        System.out.println("ååæ´æ°: " + productId + " at " + System.currentTimeMillis());
    }
}
</code></pre>
<h3 id="ä¼ç¼ºç¹åæ-1">ä¼ç¼ºç¹åæ</h3>
<p><strong>ä¼ç¹ï¼</strong></p>
<ol>
<li><strong>èªå¨æ·æ±°</strong>ï¼æ éæå¨æ¸çï¼é²æ­¢åå­æº¢åº</li>
<li><strong>è®¿é®æ¨¡å¼ä¼å</strong>ï¼èªå¨å°ç­é¨æ°æ®ä¿æå¨ç¼å­ä¸­</li>
<li><strong>JDKåç</strong>ï¼åºäºLinkedHashMapï¼æ éé¢å¤ä¾èµ</li>
<li><strong>ç®åææ</strong>ï¼å¯¹äºè®¿é®æ¨¡å¼æææ¾ç­ç¹çåºæ¯æææ¾è</li>
</ol>
<p><strong>ç¼ºç¹ï¼</strong></p>
<ol>
<li><strong>æ·æ±°ç­ç¥åä¸</strong>ï¼åªåºäºè®¿é®æ¶é´ï¼ä¸èèè®¿é®é¢ç</li>
<li><strong>å¯è½æ·æ±°ç­ç¹æ°æ®</strong>ï¼å¦æç¼å­å¤ªå°ï¼å¯è½è¯¯æ·æ±°</li>
<li><strong>å¹¶åæ§è½</strong>ï¼éè¦é¢å¤åæ­¥æ¥ä¿è¯çº¿ç¨å®å¨</li>
<li><strong>åè½æé</strong>ï¼ç¼ºä¹è¿ææ¶é´ç­é«çº§åè½</li>
</ol>
<p><strong>éç¨åºæ¯ï¼</strong></p>
<ul>
<li>æ°æ®è®¿é®æææ¾ç­ç¹</li>
<li>ç¼å­å®¹éæéï¼éè¦èªå¨æ·æ±°</li>
<li>æ°æ®éè¦æ§ç¸å¯¹åå</li>
<li>ä½ä¸ºç¼å­ç³»ç»çä¸é¨å</li>
</ul>
<p>æäºå°ä¼ä¼´ä¼åç°ï¼LRUç¼å­è½è§£å³åå­æº¢åºçé®é¢ï¼ä½å¯¹äºâçªç¶è¢«å¤§éè®¿é®çå·æ°æ®âåºæ¯ï¼å¯è½ä¼æ·æ±°æçæ­£çç­ç¹æ°æ®ã</p>
<p>è¿æ¶åå°±éè¦æ´æºè½çæ·æ±°ç­ç¥äºã</p>
<h2 id="05-æ¹æ¡ä¸ehcache---ä¼ä¸çº§æ¬å°ç¼å­">05 æ¹æ¡ä¸ï¼Ehcache - ä¼ä¸çº§æ¬å°ç¼å­</h2>
<h3 id="åçä¸ç¹ç¹-2">åçä¸ç¹ç¹</h3>
<p>Ehcacheæ¯ä¸ä¸ªæççãåè½ä¸°å¯çJavaç¼å­æ¡æ¶ï¼æåä½ä¸ºHibernateçç¼å­æä¾èèé»åã</p>
<p>å®æ¯æ<strong>åå­+ç£ç</strong>çå¤çº§ç¼å­ï¼éåç¼å­å¤§éæ°æ®ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2238006/202601/2238006-20260114095343991-1005152632.png" class="lazyload"></p>
<p><strong>æ ¸å¿ç¹æ§</strong>ï¼</p>
<ul>
<li><strong>å¤çº§å­å¨</strong>ï¼å åå­ â å å¤åå­ â ç£ç</li>
<li><strong>ä¸°å¯çæ·æ±°ç­ç¥</strong>ï¼LRUãLFUãFIFO</li>
<li><strong>éç¾¤æ¯æ</strong>ï¼éè¿Terracottaå®ç°åå¸å¼ç¼å­</li>
<li><strong>çæ§ç®¡ç</strong>ï¼JMXæ¯æï¼å®åççæ§ææ </li>
</ul>
<h3 id="å®æä»£ç ç¤ºä¾-2">å®æä»£ç ç¤ºä¾</h3>
<p>ç±äºEhcacheåè½ä¸°å¯ï¼éç½®ç¸å¯¹å¤æï¼è¿éå±ç¤ºå¶æ ¸å¿ç¨æ³ï¼</p>
<pre><code class="language-java">import net.sf.ehcache.Cache;
import net.sf.ehcache.CacheManager;
import net.sf.ehcache.Element;
import net.sf.ehcache.config.CacheConfiguration;
import net.sf.ehcache.config.PersistenceConfiguration;
import net.sf.ehcache.store.MemoryStoreEvictionPolicy;

import java.io.Serializable;

/**
 * Ehcacheç¼å­å·¥å·ç±»
 */
public class EhcacheUtil {
    
    private static CacheManager cacheManager;
    
    static {
        // 1. åå»ºCacheManagerï¼éå¸¸ä»éç½®æä»¶å è½½ï¼
        cacheManager = CacheManager.create();
        
        // 2. æèä»¥ç¼ç¨æ¹å¼éç½®
        createUserCache();
        createProductCache();
    }
    
    /**
     * åå»ºç¨æ·ç¼å­
     */
    private static void createUserCache() {
        // ç¼å­éç½®
        CacheConfiguration cacheConfig = new CacheConfiguration()
            .name("userCache")  // ç¼å­åç§°
            .maxEntriesLocalHeap(1000)  // å åå­æå¤§æ¡ç®æ°
            .memoryStoreEvictionPolicy(MemoryStoreEvictionPolicy.LRU)  // æ·æ±°ç­ç¥
            .timeToLiveSeconds(3600)  // å­æ´»æ¶é´ï¼ç§ï¼
            .timeToIdleSeconds(600)  // ç©ºé²æ¶é´ï¼ç§ï¼
            .diskExpiryThreadIntervalSeconds(120)  // ç£çè¿ææ£æ¥é´é
            .persistence(new PersistenceConfiguration()
                .strategy(PersistenceConfiguration.Strategy.LOCALTEMPSWAP));  // æä¹åç­ç¥
        
        // åå»ºç¼å­
        Cache cache = new Cache(cacheConfig);
        
        // æ·»å å°CacheManager
        cacheManager.addCache(cache);
    }
    
    /**
     * åå»ºååç¼å­ï¼ä½¿ç¨å å¤åå­ï¼
     */
    private static void createProductCache() {
        CacheConfiguration cacheConfig = new CacheConfiguration()
            .name("productCache")
            .maxEntriesLocalHeap(5000)  // å åå­æ¡ç®æ°
            .maxBytesLocalOffHeap(256, MemoryUnit.MEGABYTES)  // å å¤åå­256MB
            .maxBytesLocalDisk(2, MemoryUnit.GIGABYTES)  // ç£çç¼å­2GB
            .memoryStoreEvictionPolicy(MemoryStoreEvictionPolicy.LFU)  // LFUæ·æ±°ç­ç¥
            .timeToLiveSeconds(1800)
            .timeToIdleSeconds(300)
            .persistence(new PersistenceConfiguration()
                .strategy(PersistenceConfiguration.Strategy.LOCALTEMPSWAP));
        
        Cache cache = new Cache(cacheConfig);
        cacheManager.addCache(cache);
    }
    
    /**
     * è·åç¼å­å®ä¾
     */
    public static Cache getCache(String cacheName) {
        return cacheManager.getCache(cacheName);
    }
    
    /**
     * æ¾å¥ç¼å­
     */
    public static void put(String cacheName, Serializable key, Serializable value) {
        Cache cache = getCache(cacheName);
        if (cache != null) {
            Element element = new Element(key, value);
            cache.put(element);
        }
    }
    
    /**
     * è·åç¼å­å¼
     */
    public static Object get(String cacheName, Serializable key) {
        Cache cache = getCache(cacheName);
        if (cache != null) {
            Element element = cache.get(key);
            return element != null ? element.getObjectValue() : null;
        }
        return null;
    }
    
    /**
     * ç§»é¤ç¼å­
     */
    public static boolean remove(String cacheName, Serializable key) {
        Cache cache = getCache(cacheName);
        if (cache != null) {
            return cache.remove(key);
        }
        return false;
    }
    
    /**
     * è·åç¼å­ç»è®¡ä¿¡æ¯
     */
    public static String getStats(String cacheName) {
        Cache cache = getCache(cacheName);
        if (cache != null) {
            return String.format(
                "ç¼å­: %s, å¤§å°: %d, å½ä¸­æ°: %d, æªå½ä¸­æ°: %d, å½ä¸­ç: %.2f%%",
                cacheName,
                cache.getSize(),
                cache.getStatistics().cacheHitCount(),
                cache.getStatistics().cacheMissCount(),
                cache.getStatistics().cacheHitRatio() * 100
            );
        }
        return "ç¼å­ä¸å­å¨: " + cacheName;
    }
}

/**
 * ä½¿ç¨ç¤ºä¾ï¼è®¢åæå¡
 */
@Service
public class OrderServiceWithEhcache {
    
    @Autowired
    private OrderMapper orderMapper;
    
    /**
     * è·åè®¢åè¯¦æï¼ä½¿ç¨Ehcacheï¼
     */
    public OrderDetail getOrderDetail(Long orderId) {
        String cacheName = "orderCache";
        
        // 1. åä»ç¼å­è·å
        OrderDetail detail = (OrderDetail) EhcacheUtil.get(cacheName, orderId);
        if (detail != null) {
            System.out.println("Ehcacheç¼å­å½ä¸­: " + orderId);
            return detail;
        }
        
        // 2. ç¼å­æªå½ä¸­ï¼æ¥è¯¢æ°æ®åº
        System.out.println("Ehcacheç¼å­æªå½ä¸­ï¼æ¥è¯¢æ°æ®åº: " + orderId);
        detail = orderMapper.selectOrderDetail(orderId);
        
        if (detail != null) {
            // 3. æ¾å¥ç¼å­
            EhcacheUtil.put(cacheName, orderId, detail);
            
            // 4. å¼æ­¥å è½½ç¸å³æ°æ®å°ç¼å­
            loadRelatedDataToCache(detail);
        }
        
        return detail;
    }
    
    /**
     * æ¹éè·åè®¢åï¼ç¼å­ä¼åï¼
     */
    public List&lt;OrderDetail&gt; getOrderDetails(List&lt;Long&gt; orderIds) {
        List&lt;OrderDetail&gt; result = new ArrayList&lt;&gt;();
        List&lt;Long&gt; missingIds = new ArrayList&lt;&gt;();
        
        // 1. æ¹éä»ç¼å­è·å
        for (Long orderId : orderIds) {
            OrderDetail detail = (OrderDetail) EhcacheUtil.get("orderCache", orderId);
            if (detail != null) {
                result.add(detail);
            } else {
                missingIds.add(orderId);
            }
        }
        
        // 2. æ¹éæ¥è¯¢ç¼ºå¤±çæ°æ®
        if (!missingIds.isEmpty()) {
            List&lt;OrderDetail&gt; dbDetails = orderMapper.selectOrderDetails(missingIds);
            result.addAll(dbDetails);
            
            // 3. æ¹éæ¾å¥ç¼å­
            for (OrderDetail detail : dbDetails) {
                EhcacheUtil.put("orderCache", detail.getOrderId(), detail);
            }
        }
        
        return result;
    }
    
    /**
     * æ´æ°è®¢åç¶æï¼åæ¶æ´æ°ç¼å­ï¼
     */
    @Transactional
    public void updateOrderStatus(Long orderId, String status) {
        // 1. æ´æ°æ°æ®åº
        orderMapper.updateOrderStatus(orderId, status);
        
        // 2. ä½¿ç¼å­å¤±æï¼ææ´æ°ç¼å­ï¼
        EhcacheUtil.remove("orderCache", orderId);
        
        // 3. å¯ä»¥éæ©éæ°å è½½å°ç¼å­
        OrderDetail detail = orderMapper.selectOrderDetail(orderId);
        if (detail != null) {
            EhcacheUtil.put("orderCache", orderId, detail);
        }
    }
    
    /**
     * å¼æ­¥å è½½ç¸å³æ°æ®å°ç¼å­
     */
    private void loadRelatedDataToCache(OrderDetail orderDetail) {
        // è¿éå¯ä»¥å¼æ­¥å è½½ç¨æ·ä¿¡æ¯ãååä¿¡æ¯ç­
        // åå°åç»­æ¥è¯¢çç¼å­æªå½ä¸­
        
        CompletableFuture.runAsync(() -&gt; {
            try {
                // ç¼å­ç¨æ·ä¿¡æ¯
                EhcacheUtil.put("userCache", orderDetail.getUserId(), orderDetail.getUserInfo());
                
                // ç¼å­ååä¿¡æ¯
                for (OrderItem item : orderDetail.getItems()) {
                    EhcacheUtil.put("productCache", item.getProductId(), item.getProductInfo());
                }
            } catch (Exception e) {
                // å¼æ­¥æä½ï¼è®°å½æ¥å¿ä½ä¸å½±åä¸»æµç¨
                System.err.println("å¼æ­¥å è½½ç¼å­å¤±è´¥: " + e.getMessage());
            }
        });
    }
    
    /**
     * è·åç¼å­ç»è®¡ä¿¡æ¯
     */
    public void printCacheStats() {
        System.out.println("=== ç¼å­ç»è®¡ ===");
        System.out.println(EhcacheUtil.getStats("orderCache"));
        System.out.println(EhcacheUtil.getStats("userCache"));
        System.out.println(EhcacheUtil.getStats("productCache"));
    }
}
</code></pre>
<h3 id="ä¼ç¼ºç¹åæ-2">ä¼ç¼ºç¹åæ</h3>
<p><strong>ä¼ç¹ï¼</strong></p>
<ol>
<li><strong>åè½å¨é¢</strong>ï¼æ¯æå¤çº§ç¼å­ãå¤ç§æ·æ±°ç­ç¥</li>
<li><strong>ä¼ä¸çº§ç¹æ§</strong>ï¼éç¾¤æ¯æãæä¹åãäºå¡æ¯æ</li>
<li><strong>æçç¨³å®</strong>ï¼ç»è¿å¤å¹´çäº§éªè¯</li>
<li><strong>çæ§å®å</strong>ï¼JMXæ¯æï¼ä¾¿äºçæ§ç®¡ç</li>
</ol>
<p><strong>ç¼ºç¹ï¼</strong></p>
<ol>
<li><strong>éç½®å¤æ</strong>ï¼åè½å¤å¯¼è´éç½®å¤æ</li>
<li><strong>è¾é</strong>ï¼ä¾èµè¾å¤ï¼å¯å¨è¾æ¢</li>
<li><strong>APIè¾è</strong>ï¼é¨åAPIè®¾è®¡ä¸å¤ç°ä»£</li>
<li><strong>ç¤¾åºæ´»è·åº¦ä¸é</strong>ï¼ç¸æ¯Caffeineç­æ°æ¡æ¶</li>
</ol>
<p><strong>éç¨åºæ¯ï¼</strong></p>
<ul>
<li>éè¦ç¼å­å¤§éæ°æ®ï¼åå­+ç£çï¼</li>
<li>éè¦éç¾¤ç¼å­æ¯æ</li>
<li>ä¼ä¸çº§åºç¨ï¼éè¦å®æ´è§£å³æ¹æ¡</li>
<li>å·²æEhcacheä½¿ç¨ç»éªçé¡¹ç®</li>
</ul>
<p>æäºå°ä¼ä¼´å¨ä¼ä¸çº§é¡¹ç®ä¸­æ¥è§¦è¿Ehcacheï¼å®çåè½ç¡®å®å¼ºå¤§ï¼ä½å¯¹äºç®åçç¼å­éæ±æ¥è¯´å¯è½è¿äºééçº§äºã</p>
<h2 id="06-æ¹æ¡åcaffeine---é«æ§è½ç°ä»£ç¼å­">06 æ¹æ¡åï¼Caffeine - é«æ§è½ç°ä»£ç¼å­</h2>
<h3 id="åçä¸ç¹ç¹-3">åçä¸ç¹ç¹</h3>
<p>Caffeineæ¯ä¸ä¸ªåºäºJava 8çé«æ§è½ç¼å­åºï¼ç±Guava Cacheçåä½èå¼åãå®æä¾äº<strong>è¿ä¹æä¼çå½ä¸­ç</strong>å<strong>åè¶çå¹¶åæ§è½</strong>ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2238006/202601/2238006-20260114095400675-630808822.png" class="lazyload"></p>
<p><strong>æ ¸å¿ä¼å</strong>ï¼</p>
<ul>
<li><strong>Window-TinyLFU</strong>ï¼ç»åLFUåLRUä¼ç¹ï¼æä¾æ´å¥½çå½ä¸­ç</li>
<li><strong>é¢çç´ æ</strong>ï¼ç¨æå°ç©ºé´ç»è®¡è®¿é®é¢ç</li>
<li><strong>å¼æ­¥æä½</strong>ï¼è¯»ä¸é»å¡åï¼åä¸é»å¡è¯»</li>
<li><strong>Java 8ä¼å</strong>ï¼å¤§éä½¿ç¨<code>CompletableFuture</code>å<code>StampedLock</code></li>
</ul>
<h3 id="å®æä»£ç ç¤ºä¾-3">å®æä»£ç ç¤ºä¾</h3>
<pre><code class="language-java">import com.github.benmanes.caffeine.cache.*;
import org.springframework.stereotype.Service;

import java.time.Duration;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.Executor;
import java.util.concurrent.TimeUnit;

/**
 * Caffeineç¼å­ç¤ºä¾
 */
@Service
public class CaffeineCacheService {
    
    // 1. åºç¡ç¼å­ç¤ºä¾
    private final Cache&lt;Long, User&gt; userCache = Caffeine.newBuilder()
        .maximumSize(1000)  // æå¤§å®¹é
        .expireAfterWrite(Duration.ofMinutes(10))  // åå¥å10åéè¿æ
        .expireAfterAccess(Duration.ofMinutes(5))  // è®¿é®å5åéè¿æ
        .recordStats()  // å¼å¯ç»è®¡
        .build();
    
    // 2. å¼æ­¥å è½½ç¼å­
    private final AsyncLoadingCache&lt;Long, Product&gt; productCache = 
        Caffeine.newBuilder()
            .maximumSize(5000)
            .expireAfterWrite(Duration.ofHours(1))
            .refreshAfterWrite(Duration.ofMinutes(30))  // åå¥30åéåå·æ°
            .recordStats()
            .buildAsync(new AsyncCacheLoader&lt;Long, Product&gt;() {
                @Override
                public CompletableFuture&lt;Product&gt; asyncLoad(Long productId, 
                        Executor executor) {
                    return CompletableFuture.supplyAsync(() -&gt; 
                        loadProductFromDB(productId), executor);
                }
                
                @Override
                public CompletableFuture&lt;Product&gt; asyncReload(Long productId, 
                        Product oldValue, Executor executor) {
                    return CompletableFuture.supplyAsync(() -&gt; 
                        reloadProductFromDB(productId), executor);
                }
            });
    
    // 3. å¸¦æéç¼å­çä¾å­ï¼æå¯¹è±¡å¤§å°ç¼å­ï¼
    private final Cache&lt;String, byte[]&gt; largeDataCache = Caffeine.newBuilder()
        .maximumWeight(100 * 1024 * 1024)  // æå¤§100MB
        .weigher((String key, byte[] value) -&gt; value.length)  // æéè®¡ç®å¨
        .expireAfterWrite(Duration.ofHours(2))
        .recordStats()
        .build();
    
    /**
     * ä½¿ç¨ç¼å­è·åç¨æ·ä¿¡æ¯
     */
    public User getUserWithCache(Long userId) {
        // æ¹å¼1ï¼æå¨å¤ç
        User user = userCache.getIfPresent(userId);
        if (user == null) {
            user = loadUserFromDB(userId);
            if (user != null) {
                userCache.put(userId, user);
            }
        }
        return user;
    }
    
    /**
     * ä½¿ç¨LoadingCacheèªå¨å è½½
     */
    public User getUserAutoLoad(Long userId) {
        LoadingCache&lt;Long, User&gt; loadingCache = Caffeine.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(Duration.ofMinutes(10))
            .build(this::loadUserFromDB);  // ç¼å­æªå½ä¸­æ¶è°ç¨
        
        return loadingCache.get(userId);
    }
    
    /**
     * ä½¿ç¨å¼æ­¥ç¼å­è·åååä¿¡æ¯
     */
    public CompletableFuture&lt;Product&gt; getProductAsync(Long productId) {
        return productCache.get(productId);
    }
    
    /**
     * æ¹éè·ååå
     */
    public CompletableFuture&lt;Iterable&lt;Product&gt;&gt; getProductsAsync(
            Iterable&lt;Long&gt; productIds) {
        return productCache.getAll(productIds);
    }
    
    /**
     * è·åç¼å­ç»è®¡ä¿¡æ¯
     */
    public String getCacheStats() {
        CacheStats stats = userCache.stats();
        
        return String.format(
            "å½ä¸­ç: %.2f%%, å½ä¸­æ°: %d, æªå½ä¸­æ°: %d, å è½½æå: %d, å è½½å¤±è´¥: %d, æ»å è½½æ¶é´: %dms",
            stats.hitRate() * 100,
            stats.hitCount(),
            stats.missCount(),
            stats.loadSuccessCount(),
            stats.loadFailureCount(),
            stats.totalLoadTime()
        );
    }
    
    /**
     * é«çº§ç¨æ³ï¼äºä»¶çå¬
     */
    public void setupCacheWithListener() {
        Cache&lt;Long, Order&gt; orderCache = Caffeine.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(Duration.ofMinutes(30))
            .removalListener((Long key, Order order, RemovalCause cause) -&gt; {
                // ç¼å­æ¡ç®è¢«ç§»é¤æ¶çåè°
                System.out.printf("ç¼å­ç§»é¤: key=%s, cause=%s%n", key, cause);
                
                // å¯ä»¥æ ¹æ®ä¸åçåå å¤ç
                switch (cause) {
                    case EXPLICIT:  // æ¾å¼ç§»é¤
                        System.out.println("æ¾å¼ç§»é¤ç¼å­: " + key);
                        break;
                    case REPLACED:  // è¢«æ¿æ¢
                        System.out.println("ç¼å­è¢«æ¿æ¢: " + key);
                        break;
                    case COLLECTED:  // åå¾åæ¶
                        System.out.println("ç¼å­è¢«GCåæ¶: " + key);
                        break;
                    case EXPIRED:  // è¿æ
                        System.out.println("ç¼å­è¿æ: " + key);
                        break;
                    case SIZE:  // å¤§å°éå¶
                        System.out.println("å å¤§å°éå¶ç§»é¤: " + key);
                        break;
                }
            })
            .recordStats()
            .build();
        
        // ä½¿ç¨ç¼å­
        orderCache.put(1L, new Order(1L, "å¾æ¯ä»"));
        
        // ç§»é¤ç¼å­ï¼ä¼è§¦åEXPLICITäºä»¶ï¼
        orderCache.invalidate(1L);
    }
    
    /**
     * å¤æåºæ¯ï¼åå±ç¼å­ç­ç¥
     */
    public void layeredCacheStrategy() {
        // ç¬¬ä¸å±ï¼å°å®¹éï¼è¶å¿«è®¿é®ï¼ä½¿ç¨ConcurrentHashMapï¼
        Cache&lt;Long, User&gt; L1Cache = Caffeine.newBuilder()
            .maximumSize(100)
            .expireAfterWrite(Duration.ofSeconds(30))
            .build();
        
        // ç¬¬äºå±ï¼å¤§å®¹éï¼è¾æ¢è®¿é®ï¼ä½¿ç¨Caffeineï¼
        Cache&lt;Long, User&gt; L2Cache = Caffeine.newBuilder()
            .maximumSize(10000)
            .expireAfterWrite(Duration.ofMinutes(10))
            .build();
        
        // ç¬¬ä¸å±ï¼å¼æ­¥å è½½ï¼é²æ­¢ç¼å­ç©¿é
        AsyncLoadingCache&lt;Long, User&gt; L3Cache = Caffeine.newBuilder()
            .maximumSize(50000)
            .expireAfterWrite(Diration.ofHours(1))
            .buildAsync(key -&gt; loadUserFromDB(key));
        
        // ä½¿ç¨åå±ç¼å­çç¤ºä¾
        public User getUserMultiLevel(Long userId) {
            // 1. æ¥L1ç¼å­
            User user = L1Cache.getIfPresent(userId);
            if (user != null) {
                recordHit("L1");
                return user;
            }
            
            // 2. æ¥L2ç¼å­
            user = L2Cache.getIfPresent(userId);
            if (user != null) {
                // åå¡«L1ç¼å­
                L1Cache.put(userId, user);
                recordHit("L2");
                return user;
            }
            
            // 3. æ¥L3ç¼å­ï¼å¼æ­¥å è½½ï¼
            try {
                user = L3Cache.get(userId).get(2, TimeUnit.SECONDS);
                
                // åå¡«L1åL2
                L1Cache.put(userId, user);
                L2Cache.put(userId, user);
                
                recordHit("L3");
                return user;
            } catch (Exception e) {
                // ç¼å­å è½½å¤±è´¥
                recordMiss();
                return loadUserFromDB(userId);  // éçº§å°ç´æ¥æ¥DB
            }
        }
    }
    
    private User loadUserFromDB(Long userId) {
        System.out.println("ä»æ°æ®åºå è½½ç¨æ·: " + userId);
        // æ¨¡ææ°æ®åºæ¥è¯¢
        return new User(userId, "ç¨æ·" + userId);
    }
    
    private Product loadProductFromDB(Long productId) {
        System.out.println("ä»æ°æ®åºå è½½åå: " + productId);
        return new Product(productId, "åå" + productId);
    }
    
    private Product reloadProductFromDB(Long productId) {
        System.out.println("å·æ°ååç¼å­: " + productId);
        return new Product(productId, "å·æ°åçåå" + productId);
    }
    
    private void recordHit(String cacheLevel) {
        // è®°å½å½ä¸­ç»è®¡
        System.out.println("ç¼å­å½ä¸­ [" + cacheLevel + "]");
    }
    
    private void recordMiss() {
        // è®°å½æªå½ä¸­
        System.out.println("ç¼å­æªå½ä¸­");
    }
}
</code></pre>
<h3 id="ä¼ç¼ºç¹åæ-3">ä¼ç¼ºç¹åæ</h3>
<p><strong>ä¼ç¹ï¼</strong></p>
<ol>
<li><strong>æ§è½åè¶</strong>ï¼è¯»æ§è½æ¥è¿<code>ConcurrentHashMap</code></li>
<li><strong>é«å½ä¸­ç</strong>ï¼Window-TinyLFUç®æ³æ¾èæåå½ä¸­ç</li>
<li><strong>ç°ä»£API</strong>ï¼åºäºJava 8ï¼æ¯æå¼æ­¥ãå½æ°å¼ç¼ç¨</li>
<li><strong>åå­åå¥½</strong>ï¼æºè½çæéæ§å¶åæ·æ±°ç­ç¥</li>
</ol>
<p><strong>ç¼ºç¹ï¼</strong></p>
<ol>
<li><strong>è¾æ°</strong>ï¼çæä¸å¦Guava Cacheæç</li>
<li><strong>å­¦ä¹ æ²çº¿</strong>ï¼é«çº§åè½éè¦çè§£å¶ç®æ³åç</li>
<li><strong>åè½ä¸æ³¨</strong>ï¼ä¸»è¦å³æ³¨åå­ç¼å­ï¼ä¸åEhcacheæ¯æç£ç</li>
</ol>
<p><strong>éç¨åºæ¯ï¼</strong></p>
<ul>
<li>å¯¹æ§è½è¦æ±æé«çåºæ¯</li>
<li>éè¦é«å½ä¸­ççç¼å­ç­ç¥</li>
<li>ç°ä»£Javaé¡¹ç®ï¼Java 8+ï¼</li>
<li>ä½ä¸ºGuava Cacheçåçº§æ¿ä»£</li>
</ul>
<p>æäºå°ä¼ä¼´ä»Guava Cacheè¿ç§»å°Caffeineåï¼ä¼åç°å½ä¸­çæææ¾æåï¼ç¹å«æ¯å¨æ°æ®è®¿é®æ¨¡å¼å¤æå¤åçåºæ¯ä¸ã</p>
<h2 id="07-æ¹æ¡äºguava-cache---ç»å¸çéæ©">07 æ¹æ¡äºï¼Guava Cache - ç»å¸çéæ©</h2>
<h3 id="åçä¸ç¹ç¹-4">åçä¸ç¹ç¹</h3>
<p>Guava Cacheæ¯Google Guavaåºçä¸é¨åï¼æ¯ä¸ä¸ªè®¾è®¡ä¼éãåè½å®åçæ¬å°ç¼å­å®ç°ã</p>
<p>å®æä¾äº<strong>ä¸°å¯çæå»ºéé¡¹</strong>å<strong>çµæ´»çè¿æç­ç¥</strong>ã</p>
<h3 id="å®æä»£ç ç¤ºä¾-4">å®æä»£ç ç¤ºä¾</h3>
<pre><code class="language-java">import com.google.common.cache.*;
import org.springframework.stereotype.Service;

import java.util.concurrent.ExecutionException;
import java.util.concurrent.TimeUnit;

/**
 * Guava Cacheä½¿ç¨ç¤ºä¾
 */
@Service
public class GuavaCacheService {
    
    // 1. åºç¡ç¼å­ç¤ºä¾
    private final Cache&lt;Long, User&gt; userCache = CacheBuilder.newBuilder()
        .maximumSize(1000)  // æå¤§å®¹é
        .expireAfterWrite(10, TimeUnit.MINUTES)  // åå¥å10åéè¿æ
        .expireAfterAccess(5, TimeUnit.MINUTES)  // è®¿é®å5åéè¿æ
        .concurrencyLevel(8)  // å¹¶åçº§å«
        .recordStats()  // å¼å¯ç»è®¡
        .build();
    
    // 2. å¸¦æéç¼å­çä¾å­
    private final Cache&lt;String, byte[]&gt; weightedCache = CacheBuilder.newBuilder()
        .maximumWeight(100 * 1024 * 1024)  // æå¤§100MB
        .weigher(new Weigher&lt;String, byte[]&gt;() {
            @Override
            public int weigh(String key, byte[] value) {
                return value.length;  // æå­èæ°ç»é¿åº¦è®¡ç®æé
            }
        })
        .expireAfterWrite(2, TimeUnit.HOURS)
        .build();
    
    // 3. ä½¿ç¨CacheLoaderèªå¨å è½½
    private final LoadingCache&lt;Long, Product&gt; productCache = CacheBuilder.newBuilder()
        .maximumSize(5000)
        .expireAfterWrite(1, TimeUnit.HOURS)
        .refreshAfterWrite(30, TimeUnit.MINUTES)  // åå¥30åéåå·æ°
        .build(new CacheLoader&lt;Long, Product&gt;() {
            @Override
            public Product load(Long productId) {
                // ç¼å­æªå½ä¸­æ¶è°ç¨
                return loadProductFromDB(productId);
            }
            
            @Override
            public Product reload(Long productId, Product oldValue) {
                // å·æ°æ¶è°ç¨ï¼é»è®¤å®ç°è°ç¨loadï¼
                return reloadProductFromDB(productId);
            }
        });
    
    /**
     * åºæ¬ç¨æ³ï¼æå¨put/get
     */
    public User getUserManual(Long userId) {
        // å°è¯è·åç¼å­
        User user = userCache.getIfPresent(userId);
        
        if (user == null) {
            // ç¼å­æªå½ä¸­ï¼å è½½æ°æ®
            user = loadUserFromDB(userId);
            if (user != null) {
                userCache.put(userId, user);
            }
        }
        
        return user;
    }
    
    /**
     * ä½¿ç¨CacheLoaderèªå¨å è½½
     */
    public Product getProductAutoLoad(Long productId) {
        try {
            // å¦æç¼å­ä¸å­å¨ï¼ä¼èªå¨è°ç¨CacheLoader.load()
            return productCache.get(productId);
        } catch (ExecutionException e) {
            // å¤çå è½½å¼å¸¸
            System.err.println("å è½½äº§åå¤±è´¥: " + productId);
            return null;
        }
    }
    
    /**
     * æ¹éè·å
     */
    public Iterable&lt;Product&gt; getProductsAutoLoad(Iterable&lt;Long&gt; productIds) {
        try {
            // æ¹éè·åï¼èªå¨å è½½ç¼ºå¤±çæ°æ®
            return productCache.getAll(productIds).values();
        } catch (ExecutionException e) {
            System.err.println("æ¹éå è½½äº§åå¤±è´¥");
            return null;
        }
    }
    
    /**
     * ç¼å­å·æ°ç¤ºä¾
     */
    public void refreshProduct(Long productId) {
        // åä¸ªå·æ°
        productCache.refresh(productId);
        
        // æèæ¹éå·æ°
        // for (Long id : productIds) {
        //     productCache.refresh(id);
        // }
    }
    
    /**
     * äºä»¶çå¬å¨
     */
    public void setupCacheWithListener() {
        RemovalListener&lt;Long, User&gt; removalListener = new RemovalListener&lt;Long, User&gt;() {
            @Override
            public void onRemoval(RemovalNotification&lt;Long, User&gt; notification) {
                RemovalCause cause = notification.getCause();
                Long userId = notification.getKey();
                User user = notification.getValue();
                
                System.out.printf("ç¼å­ç§»é¤: userId=%s, cause=%s%n", userId, cause);
                
                // æ ¹æ®ä¸åçç§»é¤åå å¤ç
                switch (cause) {
                    case EXPLICIT:  // æ¾å¼ç§»é¤
                        System.out.println("ä¸»å¨ç§»é¤ç¨æ·ç¼å­: " + userId);
                        break;
                    case REPLACED:  // è¢«æ¿æ¢
                        System.out.println("ç¨æ·ç¼å­è¢«æ¿æ¢: " + userId);
                        break;
                    case COLLECTED:  // åå¾åæ¶
                        System.out.println("ç¨æ·ç¼å­è¢«GC: " + userId);
                        break;
                    case EXPIRED:  // è¿æ
                        System.out.println("ç¨æ·ç¼å­è¿æ: " + userId);
                        // å¯ä»¥å¨è¿éæ§è¡ä¸äºæ¸çæä½
                        cleanupUserResources(user);
                        break;
                    case SIZE:  // å¤§å°éå¶
                        System.out.println("å å®¹ééå¶ç§»é¤ç¨æ·: " + userId);
                        break;
                }
            }
            
            private void cleanupUserResources(User user) {
                // æ¸çç¨æ·ç¸å³èµæº
                if (user != null) {
                    System.out.println("æ¸çç¨æ·èµæº: " + user.getId());
                }
            }
        };
        
        // åå»ºå¸¦çå¬å¨çç¼å­
        Cache&lt;Long, User&gt; cacheWithListener = CacheBuilder.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(10, TimeUnit.MINUTES)
            .removalListener(removalListener)
            .build();
        
        // ä½¿ç¨ç¼å­
        cacheWithListener.put(1L, new User(1L, "æµè¯ç¨æ·"));
        cacheWithListener.invalidate(1L);  // è§¦åEXPLICITç§»é¤
    }
    
    /**
     * ç»è®¡ä¿¡æ¯
     */
    public void printCacheStats() {
        CacheStats stats = userCache.stats();
        
        System.out.println("=== Guava Cache ç»è®¡ ===");
        System.out.println("å½ä¸­ç: " + stats.hitRate());
        System.out.println("å½ä¸­æ°: " + stats.hitCount());
        System.out.println("æªå½ä¸­æ°: " + stats.missCount());
        System.out.println("å è½½æåæ°: " + stats.loadSuccessCount());
        System.out.println("å è½½å¼å¸¸æ°: " + stats.loadExceptionCount());
        System.out.println("æ»å è½½æ¶é´: " + stats.totalLoadTime() + "ns");
        System.out.println("é©±éæ°: " + stats.evictionCount());
    }
    
    /**
     * å¤æåºæ¯ï¼å¤çº§ç¼å­ç­ç¥
     */
    public void multiLevelCacheExample() {
        // ç¬¬ä¸çº§ï¼é«é¢å°ç¼å­
        LoadingCache&lt;Long, String&gt; L1Cache = CacheBuilder.newBuilder()
            .maximumSize(100)
            .expireAfterWrite(30, TimeUnit.SECONDS)
            .build(new CacheLoader&lt;Long, String&gt;() {
                @Override
                public String load(Long key) {
                    // L1æªå½ä¸­ï¼æ¥L2
                    return L2Cache.get(key);
                }
            });
        
        // ç¬¬äºçº§ï¼ä½é¢å¤§ç¼å­
        LoadingCache&lt;Long, String&gt; L2Cache = CacheBuilder.newBuilder()
            .maximumSize(10000)
            .expireAfterWrite(10, TimeUnit.MINUTES)
            .build(new CacheLoader&lt;Long, String&gt;() {
                @Override
                public String load(Long key) {
                    // L2æªå½ä¸­ï¼æ¥æ°æ®æº
                    return loadFromDataSource(key);
                }
            });
        
        // ä½¿ç¨å¤çº§ç¼å­
        public String getValueMultiLevel(Long key) {
            try {
                return L1Cache.get(key);
            } catch (ExecutionException e) {
                System.err.println("å¤çº§ç¼å­è·åå¤±è´¥: " + key);
                return loadFromDataSource(key);
            }
        }
    }
    
    // è¾å©æ¹æ³
    private User loadUserFromDB(Long userId) {
        System.out.println("ä»æ°æ®åºå è½½ç¨æ·: " + userId);
        return new User(userId, "ç¨æ·" + userId);
    }
    
    private Product loadProductFromDB(Long productId) {
        System.out.println("ä»æ°æ®åºå è½½åå: " + productId);
        return new Product(productId, "åå" + productId);
    }
    
    private Product reloadProductFromDB(Long productId) {
        System.out.println("å·æ°ååæ°æ®: " + productId);
        return new Product(productId, "å·æ°åçåå" + productId);
    }
    
    private String loadFromDataSource(Long key) {
        System.out.println("ä»æ°æ®æºå è½½: " + key);
        return "æ°æ®" + key;
    }
}
</code></pre>
<h3 id="ä¼ç¼ºç¹åæ-4">ä¼ç¼ºç¹åæ</h3>
<p><strong>ä¼ç¹ï¼</strong></p>
<ol>
<li><strong>è®¾è®¡ä¼é</strong>ï¼APIè®¾è®¡ä¸è´ä¸æäºä½¿ç¨</li>
<li><strong>åè½å®å</strong>ï¼æ¯ææéãå·æ°ãçå¬å¨ç­é«çº§åè½</li>
<li><strong>Googleç»´æ¤</strong>ï¼è´¨éæä¿éï¼ææ¡£å®å</li>
<li><strong>çæä¸°å¯</strong>ï¼Guavaåºçå¶ä»åè½å¯ä»¥ååå·¥ä½</li>
</ol>
<p><strong>ç¼ºç¹ï¼</strong></p>
<ol>
<li><strong>æ§è½ä¸å¦Caffeine</strong>ï¼å¨å¹¶åæé«åºæ¯ä¸æ§è½ç¨å·®</li>
<li><strong>åæ­¢æ¼è¿</strong>ï¼æ°åè½å¼ååºæ¬åæ­¢</li>
<li><strong>åå­å ç¨</strong>ï¼ç»è®¡ä¿¡æ¯ç­å¼éè¾å¤§</li>
<li><strong>Java 8ç¹æ§å©ç¨ä¸è¶³</strong>ï¼åºäºè¾èçJavaçæ¬è®¾è®¡</li>
</ol>
<p><strong>éç¨åºæ¯ï¼</strong></p>
<ul>
<li>å·²ç»ä½¿ç¨Guavaåºçé¡¹ç®</li>
<li>å¯¹APIè®¾è®¡ä¼éæ§è¦æ±é«çåºæ¯</li>
<li>ä¸éè¦æè´æ§è½çä¸è¬ç¼å­éæ±</li>
<li>ä½ä¸ºCaffeineçè¿æ¸¡æ¹æ¡</li>
</ul>
<p>æäºå°ä¼ä¼´çé¡¹ç®å ä¸ºåå²åå ä¸ç´å¨ç¨Guava Cacheï¼å®çç¨³å®æ§ååè½æ§ç¡®å®è½æ»¡è¶³å¤§å¤æ°éæ±ãä½å¦ææ¯æ°é¡¹ç®ï¼Caffeineå¯è½æ¯æ´å¥½çéæ©ã</p>
<h2 id="08-ç»¼åå¯¹æ¯ä¸éåæå">08 ç»¼åå¯¹æ¯ä¸éåæå</h2>
<p>ç°å¨æä»¬å·²ç»æ·±å¥äºè§£äº5ç§æ¬å°ç¼å­æ¹æ¡ï¼å¦ä½å¨å®éé¡¹ç®ä¸­éæ©å¢ï¼ä¸é¢çå¯¹æ¯å¾åéåæåå¯ä»¥å¸®å©ä½ ååºå³ç­ã</p>
<h3 id="æ¹æ¡å¯¹æ¯æ»è§">æ¹æ¡å¯¹æ¯æ»è§</h3>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2238006/202601/2238006-20260114095421303-589618777.png" class="lazyload"></p>
<h3 id="è¯¦ç»å¯¹æ¯è¡¨">è¯¦ç»å¯¹æ¯è¡¨</h3>
<table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th><strong>ConcurrentHashMap</strong></th>
<th><strong>LRUç¼å­</strong></th>
<th><strong>Ehcache</strong></th>
<th><strong>Caffeine</strong></th>
<th><strong>Guava Cache</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æç¨æ§</strong></td>
<td>æç® â­â­â­â­â­</td>
<td>ç®å â­â­â­â­â</td>
<td>å¤æ â­â­âââ</td>
<td>ä¸­ç­ â­â­â­ââ</td>
<td>è¯å¥½ â­â­â­â­â</td>
</tr>
<tr>
<td><strong>åè½å®æ´æ§</strong></td>
<td>åºç¡ â­ââââ</td>
<td>åºæ¬ â­â­âââ</td>
<td>å¨é¢ â­â­â­â­â­</td>
<td>ä¸°å¯ â­â­â­â­â</td>
<td>å®å â­â­â­â­â</td>
</tr>
<tr>
<td><strong>æ§è½</strong></td>
<td>æä¼ â­â­â­â­â­</td>
<td>è¯å¥½ â­â­â­ââ</td>
<td>ä¸­ç­ â­â­â­ââ</td>
<td>åè¶ â­â­â­â­â­</td>
<td>ä¼ç§ â­â­â­â­â</td>
</tr>
<tr>
<td><strong>åå­ç®¡ç</strong></td>
<td>æ èªå¨ç®¡ç â­ââââ</td>
<td>LRUæ·æ±° â­â­â­ââ</td>
<td>å¤çº§ç®¡ç â­â­â­â­â­</td>
<td>æºè½æ·æ±° â­â­â­â­â</td>
<td>å®åç®¡ç â­â­â­â­â</td>
</tr>
<tr>
<td><strong>ç¤¾åºçæ</strong></td>
<td>JDKèªå¸¦ â­â­â­â­â­</td>
<td>JDKèªå¸¦ â­â­â­â­â­</td>
<td>æçä½è â­â­â­ââ</td>
<td>æ´»è·å¢é¿ â­â­â­â­â</td>
<td>ç¨³å®ä½åæ» â­â­â­ââ</td>
</tr>
<tr>
<td><strong>éç¨è§æ¨¡</strong></td>
<td>å°å â­â­âââ</td>
<td>ä¸­å°å â­â­â­ââ</td>
<td>ä¸­å¤§å â­â­â­â­â</td>
<td>å¨è§æ¨¡ â­â­â­â­â­</td>
<td>ä¸­å°å â­â­â­ââ</td>
</tr>
</tbody>
</table>
<h3 id="éåå³ç­æå">éåå³ç­æå</h3>
<p>æ ¹æ®ä¸åçä¸å¡åºæ¯åææ¯è¦æ±ï¼æç»åºä»¥ä¸éåå»ºè®®ï¼</p>
<ol>
<li>
<p><strong>ååé¡¹ç®/ååéªè¯</strong> â <strong>ConcurrentHashMap</strong> æ <strong>LRUç¼å­</strong></p>
<ul>
<li>çç±ï¼å¿«éå®ç°ï¼æ éå¼å¥å¤é¨ä¾èµ</li>
<li>æ³¨æï¼éçä¸å¡å¢é¿ï¼éè¦éæä¸ºæ´ä¸ä¸çæ¹æ¡</li>
</ul>
</li>
<li>
<p><strong>é«æ§è½è¦æ±/ç°ä»£Javaé¡¹ç®</strong> â <strong>Caffeine</strong></p>
<ul>
<li>çç±ï¼æä¼çæ§è½åå½ä¸­ç</li>
<li>æ³¨æï¼éè¦Java 8+ç¯å¢</li>
</ul>
</li>
<li>
<p><strong>ä¼ä¸çº§å¤æéæ±</strong> â <strong>Ehcache</strong></p>
<ul>
<li>çç±ï¼åè½å¨é¢ï¼æ¯æéç¾¤åæä¹å</li>
<li>æ³¨æï¼éç½®è¾å¤æï¼å­¦ä¹ ææ¬é«</li>
</ul>
</li>
<li>
<p><strong>å·²æGuavaçæ/APIè®¾è®¡ä¼å</strong> â <strong>Guava Cache</strong></p>
<ul>
<li>çç±ï¼ä¼éçAPIï¼è¯å¥½çå¼åèä½éª</li>
<li>æ³¨æï¼æ§è½ä¸æ¯æä¼ï¼ä¸ä¸åç§¯æå¼å</li>
</ul>
</li>
<li>
<p><strong>ç¹å®åºæ¯éæ±</strong>ï¼</p>
<ul>
<li><strong>è®¿é®æææ¾ç­ç¹</strong> â LRUç¼å­</li>
<li><strong>éè¦èªå®ä¹æ·æ±°ç­ç¥</strong> â åºäºConcurrentHashMapèªå®ç°</li>
<li><strong>åå­ææåºæ¯</strong> â Caffeineï¼æºè½æéæ§å¶ï¼</li>
<li><strong>éè¦çæ§ç»è®¡</strong> â EhcacheæCaffeine</li>
</ul>
</li>
</ol>
<h2 id="æ»ç»">æ»ç»</h2>
<p>æ¬å°ç¼å­æ¯Javaåºç¨ä¸­æåæ§è½çå©å¨ï¼éæ©æ­£ç¡®çæ¹æ¡å¯ä»¥è®©ç³»ç»æ§è½å¾å°è´¨çæåã</p>
<p>è®©æä»¬åé¡¾ä¸ä¸æ ¸å¿è¦ç¹ï¼</p>
<ol>
<li>
<p><strong>ConcurrentHashMap</strong>æ¯æåºç¡çæ¹æ¡ï¼éåç®ååºæ¯æä½ä¸ºèªå®ä¹ç¼å­çåºç¡ã</p>
</li>
<li>
<p><strong>LRUç¼å­</strong>åºäºLinkedHashMapï¼è§£å³äºèªå¨æ·æ±°çé®é¢ï¼éåè®¿é®æç­ç¹çåºæ¯ã</p>
</li>
<li>
<p><strong>Ehcache</strong>æ¯ä¼ä¸çº§éæ©ï¼åè½å¨é¢ä½è¾éï¼éåå¤æçä¼ä¸åºç¨ã</p>
</li>
<li>
<p><strong>Caffeine</strong>æ¯ç°ä»£é«æ§è½ç¼å­åºï¼æä¾äºæä¼çå½ä¸­çåå¹¶åæ§è½ï¼æ¯æ°é¡¹ç®çé¦éã</p>
</li>
<li>
<p><strong>Guava Cache</strong>è®¾è®¡ä¼éï¼APIåå¥½ï¼éåå·²ç»ä½¿ç¨Guavaåºæå¯¹APIè®¾è®¡æè¦æ±çé¡¹ç®ã</p>
</li>
</ol>
<p>**è®°ä½ï¼æ²¡ææå¥½çç¼å­æ¹æ¡ï¼åªææéåçç¼å­æ¹æ¡ã</p>
<p>æä¸ªäººçå¾åæ¯ï¼å¯¹äºæ°é¡¹ç®ï¼ä¼åèè<strong>Caffeine</strong>ï¼å¯¹äºå·²æGuavaçé¡¹ç®ï¼å¯ä»¥ç»§ç»­ä½¿ç¨<strong>Guava Cache</strong>ï¼å¯¹äºç¹å«ç®åçéæ±ï¼ç¨<strong>ConcurrentHashMap</strong>æ<strong>LRUç¼å­</strong>ï¼å¯¹äºéè¦ä¼ä¸çº§ç¹æ§çåºæ¯ï¼éæ©<strong>Ehcache</strong>ã</p>
<p>ç¼å­è½å¥½ï¼ä½ä¹è¦åçä½¿ç¨ãè¿åº¦ç¼å­ä¼å¢å ç³»ç»å¤ææ§ï¼ç¼å­ä¸ä¸è´ä¼å¯¼è´ä¸å¡é®é¢ã</p>
<h2 id="æåè¯´ä¸å¥æ±å³æ³¨å«ç½å«æ">æåè¯´ä¸å¥(æ±å³æ³¨ï¼å«ç½å«æ)</h2>
<p>å¦æè¿ç¯æç« å¯¹æ¨ææå¸®å©ï¼æèææå¯åçè¯ï¼å¸®å¿å³æ³¨ä¸ä¸æçååå¬ä¼å·ï¼èä¸è¯´ææ¯ï¼æ¨çæ¯ææ¯æåæåä½æå¤§çå¨åã</p>
<p>æ±ä¸é®ä¸è¿ï¼ç¹èµãè½¬åãå¨çã</p>
<p>å³æ³¨å¬ä¼å·ï¼ãèä¸è¯´ææ¯ãï¼å¨å¬ä¼å·ä¸­åå¤ï¼è¿å¤§åï¼å¯ä»¥åè´¹è·åææè¿æ´çç10ä¸å­çé¢è¯å®å¸ï¼å¥½å¤å°ä¼ä¼´é è¿ä¸ªå®å¸æ¿å°äºå¤å®¶å¤§åçofferã</p>
<p>æ´å¤é¡¹ç®å®æå¨æçææ¯ç½ç«ï¼<a href="http://www.susan.net.cn/project" target="_blank" rel="noopener nofollow">http://www.susan.net.cn/project</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 09:55">2026-01-14 09:55</span>&nbsp;
<a href="https://www.cnblogs.com/12lisu">èä¸è¯´ææ¯</a>&nbsp;
éè¯»(<span id="post_view_count">237</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19480472);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19480472', targetLink: 'https://www.cnblogs.com/12lisu/p/19480472', title: 'å·¥ä½ä¸­æå¸¸ç¨ç5ç§æ¬å°ç¼å­' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ C#/.NET/.NET Coreææ¯åæ²¿å¨å | ç¬¬ 65 æï¼2026å¹´1.1-1.11ï¼ ]]></title>
    <link>https://www.cnblogs.com/Can-daydayup/p/19479370</link>
    <guid>743cce62eae01a813111413158ffbad6</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Can-daydayup/p/19479370" title="åå¸äº 2026-01-13 22:12">
    <span role="heading" aria-level="2">C#/.NET/.NET Coreææ¯åæ²¿å¨å | ç¬¬ 65 æï¼2026å¹´1.1-1.11ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><img src="https://img2024.cnblogs.com/blog/1336199/202509/1336199-20250902130707396-140987169.png" alt="image" loading="lazy"></p>
<h2 data-tool="mdniceç¼è¾å¨"><span>åè¨</span></h2>
<p data-tool="mdniceç¼è¾å¨"><span>C#/.NET/.NET Coreææ¯åæ²¿å¨åï¼ä½ çæ¯å¨ææ¯æåéï¼è®°å½ãè¿½è¸ªC#/.NET/.NET Coreé¢åãçæçæ¯å¨ææ°ãæå®ç¨ãææä»·å¼çææ¯æç« ãç¤¾åºå¨æãä¼è´¨é¡¹ç®åå­¦ä¹ èµæºç­ãè®©ä½ æ¶å»ç«å¨ææ¯åæ²¿ï¼å©åææ¯æé¿ä¸è§éæå®½ã</span></p>
<blockquote>
<p><span>æ¬¢è¿æç¨¿ãæ¨èæèªèä¼è´¨æç« ãé¡¹ç®ãå­¦ä¹ èµæºç­ã</span></p>
</blockquote>
<ul class="list-paddingleft-1">
<li><strong>ðææ¯åæ²¿å¨åGiteeå¼æºå°åï¼</strong><span>https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetWeekly.md</span></li>
<li><strong>ð°ææ¯åæ²¿å¨åGitHubå¼æºå°åï¼</strong><span>https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetWeekly.md</span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span><span>TIOBE å¬å¸ C# æ¯ 2025 å¹´åº¦ç¼ç¨è¯­è¨</span></span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;TIOBE å¬å¸çæ°æ®æ¾ç¤ºï¼C# ä»¥ 2.94% çå¹´åº¦æå¤§æ¶¨å¹ååº¦è·è¯2025 å¹´åº¦ç¼ç¨è¯­è¨ï¼å¨è¿ä¸å¹´åï¼C# ç¬¬äºæ¬¡è¢« TIOBE ææ°è¯ä¸ºå¹´åº¦ç¼ç¨è¯­è¨ãè¿ä¸è£èªæäºäºå¨å¹´åº¦æåä¸­æ¶¨å¹æå¤§çç¼ç¨è¯­è¨ï¼è C# æ­£æ¯å­åè¿ä¸æå¤§å¢å¹è·æ­¤æ®è£ãå¤å¹´æ¥ï¼C# ç»åäºæ ¹æ¬æ§çåé©ï¼ä»è¯­è¨è®¾è®¡çè§åº¦æ¥çï¼å®å¸¸å¸¸æ¯ä¸»æµç¼ç¨è¯­è¨ä¸­çåéçº³æ°è¶å¿çåè¡èãä¸æ­¤åæ¶ï¼C# æåå®ç°äºä¸¤æ¬¡éå¤§è½¬åï¼ä¸æ¯ä»ä»é Windows å¹³å°è½¬åè·¨å¹³å°æ¯æï¼äºæ¯ä»å¾®è½¯ä¸å±èµ°åå¼æºãC# æ»è½å¨å³é®æ¶å»åæ¶æ¼è¿ï¼æç»­ä¿ææ´»åã</span></li>
<li><strong>æç« å°åï¼</strong><span><a class="normal_text_link mp_article_text_link" href="https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519243&amp;idx=1&amp;sn=4f8f058fff3a4cef01ff37453aeb2ce9&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" rel="noopener nofollow">https://mp.weixin.qq.com/s/Fd71l1ino3oTWA_ZKyttnA</a></span></li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202601/1336199-20260113221107944-1279102449.png" alt="image" loading="lazy"></p>
<h2 data-tool="mdniceç¼è¾å¨"><span>2026 å¹´ C<a class="wx_topic_link" data-topic="1">#ä¸­å¸¦æå¤§åè¯­è¨æ¨¡åççæå¼äººå·¥æºè½</a></span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;çæå¼äººå·¥æºè½æä¸ºåå²ä¸å¢é¿æå¿«çæ¶è´¹ææ¯ï¼è¶è¿äº Instagram å TikTokï¼å¨ä¸å°ä¸¤ä¸ªæçæ¶é´åè¾¾å°äº 1 äº¿ç¨æ·ã2022 å¹´åºï¼OpenAI åå¸äº GPT-3.5 çåè´¹é¢è§çï¼ä½ä¸ºå¯¹è¯å¼èå¤©å®¢æ·ç«¯ ChatGPTãè¯¥æ¨¡åéè¿äººç±»åé¦å¼ºåå­¦ä¹ ï¼<span>RLHFï¼è¿è¡äºå¾®è°ï¼æ å¿ççæå¼äººå·¥æºè½è¿å¥ä¸»æµè®¤ç¥çæ¶å»ã2023 å¹´åï¼Microsoft éè¿æ¨åº Azure OpenAI æå¡ä½åºååºï¼åè®¸å¼åèå¨ Azure ç®¡çç«¯ç¹åå®å¨éç½®åä½¿ç¨å¼å®¹ OpenAI çæ¨¡åã</span></span></li>
<li><strong>æç« å°åï¼</strong><span>&nbsp;https://devblogs.microsoft.com/dotnet/generative-ai-with-large-language-models-in-dotnet-and-csharp/</span></li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202601/1336199-20260113221119628-1072141145.png" alt="image" loading="lazy"></p>
<h2 data-tool="mdniceç¼è¾å¨"><span>å®å¨ä¸æºè½ï¼MongoDB EF Core Provider ä¸­çå¯æ¥è¯¢å å¯ä¸ç¢éæç´¢</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;MongoDB å®ä½æ¡æ¶ï¼EFï¼æ ¸å¿æä¾èèª 2024 å¹´ 5 æèµ·å·²æ­£å¼åå¸ãèªåå¸ä»¥æ¥ï¼æä»¬å¯¹ .NET å¼åèç¤¾åºçç§¯æååä»¥åå¶å¨å¹¿æ³åºç¨ä¸­çæ¥çæ®åæå°éå¸¸å´å¥ã</span></li>
<li><strong>æç« å°åï¼</strong><span>&nbsp;https://devblogs.microsoft.com/dotnet/mongodb-efcore-provider-queryable-encryption-vector-search/</span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>C#/.NET/.NET Coreä¼ç§é¡¹ç®åæ¡æ¶2025å¹´12æç®æ¥</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;å¬ä¼å·æ¯æå®ææ¨å¹¿ååäº«çC#/.NET/.NET Coreä¼ç§é¡¹ç®åæ¡æ¶ï¼æ¯å¨è³å°ä¼æ¨èä¸¤ä¸ªä¼ç§çé¡¹ç®åæ¡æ¶å½ç¶èåæ¥é¤å¤ï¼ï¼å¬ä¼å·æ¨æä¸­æé¡¹ç®åæ¡æ¶çè¯¦ç»ä»ç»ãåè½ç¹ç¹ãä½¿ç¨æ¹å¼ä»¥åé¨ååè½æªå¾ç­ï¼æä¸å¼æèæå¼GitHubå¾æ¢çåå­¦å¯ä»¥ä¼åæ¥çå¬ä¼å·æ¨æï¼ææ«ä¸å®ä¼éå¸¦é¡¹ç®åæ¡æ¶æºç å°åï¼ãæ³¨æï¼æåä¸åååï¼é½æ¯ååä¼ç§çå¼æºé¡¹ç®åæ¡æ¶ï¼æ¯å¨å®ææ´æ°åäº«ã</span></li>
<li><strong>æç« å°åï¼</strong><span><a class="normal_text_link mp_article_text_link" href="https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519171&amp;idx=1&amp;sn=9ce33aa68158372f1beec564643e0f9a&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" rel="noopener nofollow">https://mp.weixin.qq.com/s/t4Mv4g8WbHbTWeZJjb3tzw</a></span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>è®© WinForm.NET åæ¬¡ä¼å¤§ï¼ä¸ä¸ªä¸é¨è®¾è®¡ç¨äºå¸®å© WinForms åºç¨ç¨åºè¿ç§»å° Blazor WASM å¹³å°çé¡¹ç®</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;MWGAï¼Make WinForms Great Againï¼ æ¯ä¸ä¸ªä¸é¨è®¾è®¡ç¨äºå¸®å© WinForms åºç¨ç¨åºè¿ç§»å° Blazor WASM å¹³å°çé¡¹ç®ï¼å³ä½¿è¿äº WinForms åºç¨ç¨åºä½¿ç¨ GDI+ åè½ï¼MWGA é¡¹ç®ä¹é¢æå°å¯¹è¿äºç¨åºæºç çä¿®æ¹éä¸è¶è¿10%ãè¿æå¤§çéä½ WinForms è½¯ä»¶ç°ä»£åçææ¬åé£é©ãæ³¨æè¯¥é¡¹ç®æ¯ä¸ä¸ªå·¨å¤§çå·¥ç¨ç®åè¿å¨éæ­¥è§åãå®åä¸­ï¼å½åå·²å¼æºæ¼ç¤ºé¡¹ç®ï¼ä¸»è¦ç¨äºç»å¤§å®¶æ¼ç¤ºè¿ç§»æµç¨ä¸éªè¯å¼å®¹æ§ï¼å¤§å®¶ææ´å¥½çæ³æ³æè§£å³æ¹æ¡æ¬¢è¿åå¾å¼æºå°åæIssuesï¼ã</span></li>
<li><strong>æç« å°åï¼</strong><span><a class="normal_text_link mp_article_text_link" href="https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519200&amp;idx=1&amp;sn=0c792aba422e0c8b327627a50bbdc852&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" rel="noopener nofollow">https://mp.weixin.qq.com/s/2-JM1l6avTtjqhyPjgYr3g</a></span></li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202601/1336199-20260113221133397-1718029011.png" alt="image" loading="lazy"></p>
<h2 data-tool="mdniceç¼è¾å¨"><span>ä¸ä¸ªåºäº C# ç¼åãå¤åè½çä¸ä½æºè½¯ä»¶ï¼éæäºä¸²å£å©æãèæç¤ºæ³¢å¨ä»¥åæåå¤´å¾åæ¾ç¤ºç­å¤ç§å®ç¨åè½ï¼</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;éé£å©ææ¯ä¸ä¸ªåºäºC<a class="wx_topic_link" data-topic="1">#ç¼åçå¤åè½ä¸ä½æºè½¯ä»¶</a>ãè¯¥è½¯ä»¶éæäºä¸²å£å©æãèæç¤ºæ³¢å¨ä»¥åæåå¤´å¾åæ¾ç¤ºç­å¤ç§å®ç¨åè½ï¼æ¨å¨ä¸ºç¨æ·æä¾ä¾¿æ·ãé«æçæ°æ®è°è¯ä¸çæ§è§£å³æ¹æ¡ã</span></li>
<li><strong>æç« å°åï¼</strong><span><a class="normal_text_link mp_article_text_link" href="https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519244&amp;idx=2&amp;sn=0b8a409743f5e18bb2211ad347e4a3fa&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" rel="noopener nofollow">https://mp.weixin.qq.com/s/kIWtt1OsojIg7A5MTO3xXA</a></span></li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202601/1336199-20260113221146684-2612195.png" alt="image" loading="lazy"></p>
<h2 data-tool="mdniceç¼è¾å¨"><span>dotnet 10 run file æ¯æå¤æä»¶</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;dotnet 10 run file æ¯æå¤æä»¶ã</span></li>
<li><strong>æç« å°åï¼</strong><span><a class="normal_text_link mp_article_text_link" href="https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519244&amp;idx=3&amp;sn=9dda0fa330566ba7d29cf7a6f6103806&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" rel="noopener nofollow">https://mp.weixin.qq.com/s/p8Za-HrjSLxOhc1Qp5lCuA</a></span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>ä¸æ¬¾å¼æºãåè´¹ç WPF èªå®ä¹æ§ä»¶é</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;PropertyTools æ¯ä¸æ¬¾å¼æºï¼MIT licenseï¼ãåè´¹ç WPF èªå®ä¹æ§ä»¶éï¼è¯¥æ§ä»¶éæ¶µçäº PropertyGridãDataGridãæ¯æå¤éç TreeViewãColorPicker ç­å¸¸ç¨æ§ä»¶ã</span></li>
<li><strong>æç« å°åï¼</strong><span><a class="normal_text_link mp_article_text_link" href="https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519334&amp;idx=1&amp;sn=e163b6f037627858c7ddd0fa8befb76b&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" rel="noopener nofollow">https://mp.weixin.qq.com/s/fLsTZWyY1W7UFJWCmIa4mQ</a></span></li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202601/1336199-20260113221158997-22872837.png" alt="image" loading="lazy"></p>
<h2 data-tool="mdniceç¼è¾å¨"><span>ä¸ä¸ªåºäº C# å Halcon æºå¨è§è§å¼åçè½¦çè¯å«å·¥å·</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;halcon_chepaiä¸æ¬¾åºäºC<a class="wx_topic_link" data-topic="1">#ç¼ç¨è¯­è¨ä¸Halconæºå¨è§è§åºçè½¦çè¯å«ç³»ç»</a>ãè¯¥ç³»ç»å©ç¨Halconå¼ºå¤§çå¾åå¤çè½åï¼ç»åC<a class="wx_topic_link" data-topic="1">#ççµæ´»æ§ä¸æç¨æ§</a>ï¼å®ç°äºé«æãåç¡®çè½¦çè¯å«åè½ãè¯å«æåçé«è¾¾90%ã</span></li>
<li><strong>æç« å°åï¼</strong><span><a class="normal_text_link mp_article_text_link" href="https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519334&amp;idx=2&amp;sn=b2929b41edecf59aa2fb578d28f99ec3&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" rel="noopener nofollow">https://mp.weixin.qq.com/s/Bpz36wWHhK2MPQ9YR6y8TA</a></span></li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/1336199/202601/1336199-20260113221209763-194195567.png" alt="image" loading="lazy"></p>
<h2 data-tool="mdniceç¼è¾å¨"><span>ç²¾é 10 æ¬¾ .NET å¼æºåè´¹ãåè½å¼ºå¤§ç Windows æçè½¯ä»¶</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;å¨å½ä»å¿«èå¥çæ°å­å·¥ä½ç¯å¢ä¸­ï¼æçå·¥å·å·²æä¸ºå¼åèãITä¸ä¸äººå£«ä¹è³æ®éç¨æ·æåçäº§åçå³é®å©åãä»å¤©å¤§å§ç»å¤§å®¶åäº« 10 æ¬¾ .NET å¼æºåè´¹ãåè½å¼ºå¤§ç Windows æçè½¯ä»¶ï¼å¼åå·¥ä½æåå©å¨ï¼å¸æå¯ä»¥å¸®å©å°æéè¦çå°ä¼ä¼´ã</span></li>
<li><strong>æç« å°åï¼</strong><span><a class="normal_text_link mp_article_text_link" href="https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519364&amp;idx=1&amp;sn=f5b8f0ece898b9087f03c5ba58fcad86&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" rel="noopener nofollow">https://mp.weixin.qq.com/s/QvF0X_dR85ISeeWJcbSmdg</a></span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>C<a class="wx_topic_link" data-topic="1">#ä¸­ç7ç§æé å½æ°</a>ï¼ä½ é½ç¨è¿åï¼</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;å¨ C# ä¸­ï¼æé å½æ°æ¯å¯¹è±¡åå»ºæ¶èªå¨æ§è¡çç¹æ®æ¹æ³ï¼ç¨äºåå§åå®ä¾ç¶æãå®ä¸è¿åå¼ï¼åç§°å¿é¡»ä¸ç±»åä¸è´ãæ ¹æ®ä½¿ç¨åºæ¯ä¸åï¼C# æ¯æå¤ç§æé å½æ°å½¢å¼ï¼æ¯ç§é½æå¡äºç¹å®çåå§åéæ±ãææ¡è¿äºç±»åï¼æå©äºååºæ´æ¸æ°ãçµæ´»ä¸å¯ç»´æ¤çä»£ç ã</span></li>
<li><strong>æç« å°åï¼</strong><span><a class="normal_text_link mp_article_text_link" href="https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519364&amp;idx=2&amp;sn=ec78c18a7d94de1797fb5e38ec06a621&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" rel="noopener nofollow">https://mp.weixin.qq.com/s/C9UazT3ytk-VbGy3qzSYPw</a></span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>ä¸ä¸ªéå¯¹ Microsoft Office åºç¨ç¨åºç .NET å°è£åºï¼æ¨å¨ç®å Office COM ç»ä»¶çä½¿ç¨</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;OfficeInterop æ¯ä¸ä¸ªéå¯¹ Microsoft Office åºç¨ç¨åºç .NET å°è£åºï¼å¶æ ¸å¿ç®æ æ¯ç®å Office COM ç»ä»¶çä½¿ç¨ï¼ä½¿å¼åèè½å¤æ´æ¹ä¾¿ãæ´é«æå°å¨ .NET ç¯å¢ä¸­æä½ Office åºç¨ç¨åºï¼å¦ ExcelãWord ç­ã</span></li>
<li><strong>æç« å°åï¼</strong><span><a class="normal_text_link mp_article_text_link" href="https://mp.weixin.qq.com/s?__biz=MzIxMTUzNzM5Ng==&amp;mid=2247519132&amp;idx=1&amp;sn=30d44be5bd462bdee250a3c7b2b9861e&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" rel="noopener nofollow">https://mp.weixin.qq.com/s/SOJdHwrP-X1suv0v8PNEcg</a></span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>è®°ä¸æ¬¡ .NET æMESä¸ä½æºæç§ç³»ç» åå­æ´æ¶¨åæ</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;è¿æ¯è®­ç»è¥éçä¸ä½æåæ¾å°æçï¼è¯´ä»ä»¬çç³»ç»ä¼æå¶åçåå­æ´æ¶¨æåµï¼èªå·±ä¹æ²¡åæåºæ¥ï¼è®©æå¸®å¿çä¸æä¹åäºï¼æ¿äºä¸ä¸ª20G+çdumpæä»¶ï¼è¿æä»¶æ¯å¤å¤§çï¼æä¸ªäººå»ºè®®ä¸è¬æ¯ä¸è¶è¿10Gï¼ä¸ç¶çè¯windbgåæèµ·æ¥å¾ååã</span></li>
<li><strong>æç« å°åï¼</strong><span>&nbsp;https://www.cnblogs.com/huangxincheng/p/19450501</span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>ãè¯ãVisual Studio 11 ææ´æ° ââ Visual Studio 2026ãCloud Agent Preview åæ´å¤åå®¹</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;å¦ææ¨è¿æ²¡å¬è¯´è¿ä¸ªæ¶æ¯ï¼æä»¬å¾å´å¥å°åæ¨åäº«ï¼Visual Studio 2026 ç°å·²å¨é¢åå¸ï¼è¿ä¸ªæ°çæ¬å¨å¤é¡¹æ§è½æ¹è¿ãéæ°è®¾è®¡çç¨æ·ä½éªä»¥åäººå·¥æºè½é©±å¨çå¼åæ¹é¢å®ç°äºéå¤§é£è·ï¼è½ä¸ºæ¨æä¾æ´å¥½çå¸®å©ã</span></li>
<li><strong>æç« å°åï¼</strong><span>&nbsp;https://www.cnblogs.com/MeteorSeed/p/19441728</span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>ä½¿ç¨ C# å SQL Server èªå¨åé®ä»¶ä¸­çç¨æ·åéæ°æ®å¤ç</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;å¨éèåºç¨é¢åï¼éè¿çµå­é®ä»¶æå¨ç®¡çç¨æ·åéæ°æ®ä¸ä»èæ¶èä¸å®¹æåºéãä¼ ç»çäººå·¥å¤çæ¹å¼éè¦å·¥ä½äººåæ¯å¤©æ£æ¥é®ä»¶ãä¸è½½éä»¶ãè§£ææ°æ®å¹¶æ´æ°æ°æ®åºï¼è¿ä¸ç³»åéå¤æ§å·¥ä½æ¢ä½æåå­å¨æ°æ®å½å¥éè¯¯çé£é©ãæ¬æå°ä»ç»å¦ä½å©ç¨ C# å SQL Server æå»ºä¸ä¸ªèªå¨åè§£å³æ¹æ¡ï¼å®ç°ä»é®ä»¶è¯»åãéä»¶ä¸è½½å°æ°æ®åºæ´æ°çå¨æµç¨èªå¨åå¤çãè¯¥ç³»ç»ç¹å«éç¨äºå¤çä¸»é¢åå«"AllotmentsFiles"çé®ä»¶ï¼å¹¶æ´æ° SQL Server ä¸­ç bidfiledetails è¡¨ï¼æ¾èæé«æ°æ®å¤çæçååç¡®æ§ã</span></li>
<li><strong>æç« å°åï¼</strong><span>&nbsp;https://www.cnblogs.com/powertoolsteam/p/19444281</span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>Zenith.NET v0.0.2 åå¸ ð â ç»ä¸ç .NET GPU ç¼ç¨åºï¼æ¯æ DX12/Vulkan + 6 å¤§ UI æ¡æ¶</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;Zenith.NET æ¯ä¸ä¸ªç°ä»£çãè·¨å¹³å°ç .NET å¾å½¢ä¸è®¡ç®åºï¼æ¨å¨ä¸º .NET å¼åèæä¾ç»ä¸ç GPU ç¼ç¨æ¥å£ãæ è®ºä½ æ¯è¦åé«æ§è½æ¸²æãå¾å½¢åºç¨ï¼è¿æ¯ GPU éç¨è®¡ç®ï¼Zenith.NET é½è½å¸®ä½ å±è½åºå± API çå·®å¼ï¼è®©ä»£ç å¨ä¸åå¹³å°ä¸æ ç¼è¿è¡ã</span></li>
<li><strong>æç« å°åï¼</strong><span>&nbsp;https://www.cnblogs.com/xymfblogs/p/19443277</span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>.NET 10 New feature æ°å¢åè½ä»ç»-WebSocketåè½å¢å¼º</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;.NET 10 æ°å¢äº WebSocketStreamä¸ä¸ªæ°ç APIï¼ç¨äºç®å .NET ä¸­ä¸äºæå¸¸è§çWebSocket çæµå¼å¤çæ¹æ¡ã</span></li>
<li><strong>æç« å°åï¼</strong><span>&nbsp;https://www.cnblogs.com/tianqing/p/19439916</span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>.NET+AI | åºäº Microsoft Agent Framework ä¸æ­¥æ­¥éæ Agent Skillsï¼è®©ä½ ç <span>AI Agent æ´æºè½</span></span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;éç AI Agent ææ¯çå¿«éåå±ï¼å¦ä½è®© Agent å·å¤å¯å¤ç¨ãå¯æ©å±çä¸ä¸è½åæä¸ºä¸ä¸ªéè¦è¯¾é¢ãAgent Skills è§èæä¾äºä¸ç§æ ååçæ¹å¼æ¥å®ä¹ååå Agent æè½ï¼è Microsoft Agent Framework (<span>MAF) åæä¾äºæå»º AI Agent çå¼ºå¤§åºç¡è®¾æ½ãæ¬æå°æ·±å¥ä»ç»å¦ä½åºäº MAF çä¸ä¸ææ©å±ï¼AIContextProviderï¼å®ç° Agent Skills çéæï¼åæ¬æ ¸å¿æ¶æè®¾è®¡ãå³é®ç»ä»¶å®ç°ä»¥åå®éåºç¨ç¤ºä¾ã</span></span></li>
<li><strong>æç« å°åï¼</strong><span>&nbsp;https://www.cnblogs.com/sheng-jie/p/19442149</span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>ä» TIOBE 2025 å¹´åº¦è¯­è¨å° 2026 å¹´ C# æºè½ä½çæçå¨é¢å´èµ·</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;2026 å¹´ 1 æï¼éç TIOBE ææ°æ­£å¼å®£å¸ C# ä¸º 2025 å¹´åº¦ç¼ç¨è¯­è¨ï¼å¨çè½¯ä»¶å·¥ç¨é¢åè¿æ¥äºä¸ä¸ªå³å®æ§çè½¬æç¹ãè¿ä¸è£èªä¸ä»æ¯å¯¹ C# è¿å»ä¸å¹´å¨æç´¢ç­åº¦åå¼åèæ´»è·åº¦ä¸åå¾æå¤§å¢å¹çè®¤å¯ï¼æ´æ¯ä¸ä¸ªæ»åææ ï¼æ­ç¤ºäºåºå±ææ¯èå¼çæ·±å»åè¿ãå¦æè¯´è¿å»åå¹´æ¯ Python ä¾é æ°æ®ç§å­¦åæ¨¡åè®­ç»ç¡®ç«é¸æçæ¶ä»£ï¼é£ä¹ 2025 å¹´çæ°æ®è¡¨æï¼è¡ä¸éå¿æ­£å¨ä»âæ¨¡åæå»ºâåâç³»ç»ç¼æâè½¬ç§»ã</span></li>
<li><strong>æç« å°åï¼</strong><span>&nbsp;https://www.cnblogs.com/shanyou/p/19441004</span></li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span>2026ï¼è®©.NETåæ¬¡ä¼å¤§</span></h2>
<ul class="list-paddingleft-1">
<li><strong>æç« ç®ä»ï¼</strong><span>&nbsp;2026å¹´ï¼åºè¯¥èèä¸ä¸ªæç¥å³ç­ââå°.NET SDKçº³å¥æä½ç³»ç»ï¼è¿å°å¯¹æ´ä¸ªå¼åçæäº§çæ·±è¿å½±åã</span></li>
<li><strong>æç« å°åï¼</strong><span>&nbsp;https://www.cnblogs.com/msdeveloper/p/19427679/make-dotnet-great-again-2026</span></li>
</ul>
</div>
<div id="MySignature" role="contentinfo">
    <blockquote>
<p style="font-family:YouYuan;font-size: 16px;margin: 0 auto 0.01em auto;"><span style="font-size: 17px; ">ä½èåç§°ï¼</span><a href="https://www.cnblogs.com/Can-daydayup/" target="_blank">è¿½éæ¶åè</a></p>
<p style="font-family:YouYuan;font-size: 16px;margin: 0 auto 0.01em auto;"><span style="font-size: 17px; ">ä½èç®ä»ï¼</span>ä¸ä¸ªç­ç±ç¼ç¨ãåäºåäº«ãåæ¬¢å­¦ä¹ ãæ¢ç´¢ãå°è¯æ°äºç©åæ°ææ¯çå¨æ è½¯ä»¶å·¥ç¨å¸ã</p>
<p style="font-family:YouYuan;font-size: 16px;margin: 0 auto 0.01em auto;">
æ¬æçæå½ä½èååå®¢å­å±æï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»ä¿çæ­¤æ®µå£°æï¼ä¸å¨æç« é¡µé¢ææ¾ä½ç½®ç»åºåæé¾æ¥ï¼å¦åä¿çè¿½ç©¶æ³å¾è´£ä»»çæå©ãå¦æè¯¥ç¯æç« å¯¹æ¨æå¸®å©çè¯ï¼å¯ä»¥ç¹ä¸ä¸å³ä¸è§ç<a onclick="votePost(cb_entryId,'Digg')" href="javascript:void(0)" style="color:red;">ãâ¥æ¨èâ¥ã</a>ï¼å¸æè½å¤æç»­çä¸ºå¤§å®¶å¸¦æ¥å¥½çææ¯æç« ï¼æä¸­å¯è½å­å¨æè¿°ä¸æ­£ç¡®çå°æ¹ï¼æ¬¢è¿ææ­£æè¡¥åï¼ä¸èææ¿ã
</p>
</blockquote>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 22:13">2026-01-13 22:12</span>&nbsp;
<a href="https://www.cnblogs.com/Can-daydayup">è¿½éæ¶åè</a>&nbsp;
éè¯»(<span id="post_view_count">294</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479370);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479370', targetLink: 'https://www.cnblogs.com/Can-daydayup/p/19479370', title: 'C#/.NET/.NET Coreææ¯åæ²¿å¨å | ç¬¬ 65 æï¼2026å¹´1.1-1.11ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Spring IOC æºç å­¦ä¹  ä¸æå­¦ä¹ å®æ´çå è½½æµç¨ ]]></title>
    <link>https://www.cnblogs.com/dddy/p/19479364</link>
    <guid>e7fbb96de3c88cf71a86c8f462dbbb02</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/dddy/p/19479364" title="åå¸äº 2026-01-13 22:09">
    <span role="heading" aria-level="2">Spring IOC æºç å­¦ä¹  ä¸æå­¦ä¹ å®æ´çå è½½æµç¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ioc-çå¥å£è¯´æ">IOC çå¥å£è¯´æ</h1>
<h2 id="applicationcontext-å¯¹è±¡">ApplicationContext å¯¹è±¡</h2>
<p><strong>in short å¯ä»¥çè§£ä¸ºä½ä¸ºå·ç°åç IOC çå¯¹è±¡æ ¹æ¥å£, å®æ¯ä¸ä¸ªééçº§çå¯¹è±¡, æ´ä¸ªåºç¨æé´åºè¯¥ä¿æåä¾</strong></p>
<p>å®æ Container Overview: <a href="https://docs.spring.io/spring-framework/reference/core/beans/basics.html" target="_blank" rel="noopener nofollow">https://docs.spring.io/spring-framework/reference/core/beans/basics.html</a></p>
<blockquote>
<p>The&nbsp;<code>org.springframework.context.ApplicationContext</code>&nbsp;interface represents the Spring IoC container and is responsible for instantiating, configuring, and assembling the beans. The container gets its instructions on the components to instantiate, configure, and assemble by reading configuration metadata. The configuration metadata can be represented as annotated component classes, configuration classes with factory methods, or external XML files or Groovy scripts.</p>
</blockquote>
<blockquote>
<p><code>org.springframework.context.ApplicationContext</code>&nbsp;æ¥å£ä»£è¡¨ Spring IoC å®¹å¨ï¼è´è´£å®ä¾åãéç½®åç»è£ beanãå®¹å¨éè¿è¯»åéç½®åæ°æ®æ¥è·åå®ä¾åãéç½®åç»è£ç»ä»¶çæä»¤ãéç½®åæ°æ®å¯ä»¥è¡¨ç¤ºä¸ºå¸¦æ³¨è§£çç»ä»¶ç±»ãå·æå·¥åæ¹æ³çéç½®ç±»ï¼æå¤é¨ XML æä»¶æ Groovy èæ¬ã</p>
</blockquote>
<p>Several implementations of the&nbsp;<code>ApplicationContext</code>&nbsp;interface are part of core Spring. In stand-alone applications, it is common to create an instance of&nbsp;<a href="https://docs.spring.io/spring-framework/docs/7.0.1/javadoc-api/org/springframework/context/annotation/AnnotationConfigApplicationContext.html" target="_blank" rel="noopener nofollow"><code>AnnotationConfigApplicationContext</code></a>&nbsp;or&nbsp;<a href="https://docs.spring.io/spring-framework/docs/7.0.1/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html" target="_blank" rel="noopener nofollow"><code>ClassPathXmlApplicationContext</code></a>.</p>
<blockquote>
<p><code>ApplicationContext</code>&nbsp;æ¥å£æå¤ä¸ªå®ç° , æ¯Spring æ ¸å¿çä¸é¨åãå¨ç¬ç«åºç¨ç¨åºä¸­ï¼éå¸¸åå»º&nbsp;<a href="https://docs.spring.io/spring-framework/docs/7.0.1/javadoc-api/org/springframework/context/annotation/AnnotationConfigApplicationContext.html" target="_blank" rel="noopener nofollow"><code>AnnotationConfigApplicationContext</code></a>&nbsp;or&nbsp;<a href="https://docs.spring.io/spring-framework/docs/7.0.1/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html" target="_blank" rel="noopener nofollow"><code>ClassPathXmlApplicationContext</code></a>&nbsp;çå®ä¾ã</p>
</blockquote>
<h2 id="xmlåæ³¨è§£-éç½®ç-applicationcontext">XMLåæ³¨è§£ éç½®ç ApplicationContext</h2>
<p>æä»¬éå¸¸ä½¿ç¨ Spring IOC éç½®å®¹å¨çæ¹å¼ä¸è¬æä¸¤ç§: 1. éè¿XMLéç½®æä»¶,  2. åºäºæ³¨è§£çå½¢å¼éç½®, å®ä»¬åå«æ¯å¥å£ç±»ä¸ä¸æ ·.</p>
<ol>
<li>
<p>åºäºXMLéç½®, å®éæä¸¤ä¸ªç±»å®ç°  <strong>ClassPathXmlApplicationContext</strong> è¿æä¸ä¸ªæ¯ <strong>FileSystemXmlApplicationContext</strong> <s>(å¾å°ç¨å°±æ¯äº)</s> å®ä»¬ä¸»è¦çä»£ç é»è¾é½æ¯å¨å®ç¶ <code>AbstractXmlApplicationContext</code> ä¸­.</p>
</li>
<li>
<p>åºäºæ³¨è§£çå½¢å¼éç½®,  <a href="https://docs.spring.io/spring-framework/reference/core/beans/annotation-config.html" target="_blank" rel="noopener nofollow">Annotation-based configuration</a>  åºäº Spring èªå®ä¹, ä½¿ç¨<a href="https://docs.spring.io/spring-framework/reference/core/beans/factory-extension.html#beans-factory-extension-bpp-examples-aabpp" target="_blank" rel="noopener nofollow"><code>AutowiredAnnotationBeanPostProcessor</code></a> å¤çè§£æç¸å³æ³¨è§£çå®ç°, å¦å¤ JSR 330 ä¸­æ åçæ³¨è§£ä¹æ¯å®å¤çç.</p>
</li>
</ol>
<p>æ¬åæä»¥ XML å è½½ä½ä¸ºæºç å¥å£ç¹è¿è¡åæ:</p>
<h1 id="ä¸æ±æ»å¤§å¾">ä¸æ±æ»å¤§å¾</h1>
<p>ççå¾å¤§çå¤§å¾..</p>
<p><img alt="Spring IOC å®¹å¨å è½½çè¯¦ç»æµç¨" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3723410/202601/3723410-20260113220603061-1916535706.jpg" class="lazyload"></p>
<p>çä¸æ¸, è¯·ä½¿ç¨åçæµè§å¨æå¼é¾æ¥: <a href="https://img2024.cnblogs.com/blog/3723410/202601/3723410-20260113220603061-1916535706.jpg" target="_blank">https://img2024.cnblogs.com/blog/3723410/202601/3723410-20260113220603061-1916535706.jpg</a></p>
<h1 id="xml-å®ä¾å¥å£">XML å®ä¾å¥å£</h1>
<h2 id="å®ä¾ä»£ç ">å®ä¾ä»£ç </h2>
<p><code>org.yang.learn.spring.dto.Address</code></p>
<pre><code class="language-java">package org.yang.learn.spring.dto;

import org.springframework.beans.BeansException;
import org.springframework.beans.factory.config.BeanPostProcessor;

/**
 * @author yangfh
 * @date 2023-12-14 21:30
 **/
public class Address  {
	String city;
	String country;
	String street;

	public Address() {
		System.out.println("Address æ åæé å½æ°: "+ this.toString());
	}

	public Address(String city, String country, String street) {
		this.city = city;
		this.country = country;
		this.street = street;
		System.out.println("Address æé å½æ°: "+ this.toString());
	}
	... getter  setter ...
}

</code></pre>
<p><code>org.yang.learn.spring.dto.User</code></p>
<pre><code class="language-java">package org.yang.learn.spring.dto;

import org.springframework.beans.BeansException;
import org.springframework.beans.factory.DisposableBean;
import org.springframework.beans.factory.InitializingBean;
import org.springframework.beans.factory.config.BeanFactoryPostProcessor;
import org.springframework.beans.factory.config.BeanPostProcessor;
import org.springframework.core.PriorityOrdered;
import org.springframework.lang.Nullable;

/**
 * @author yangfh
 * @date 2023-12-14 21:30
 **/
public class User implements InitializingBean, DisposableBean {
	private Long id;
	private String username;
	private String email;
	private Address address;
	private Long age;

	public User() {
		System.out.println("User æ åæé å½æ°: "+ this.toString());
	}

	public User(Long id, String username, String email, Address address) {
		this.id = id;
		this.username = username;
		this.email = email;
		this.address = address;
		System.out.println("User æåæé å½æ°: "+ this.toString());
	}

	public void initMethod(){
		System.out.println("User initMethod");
	}

	public void destroyMethod(){
		System.out.println("User destroyMethod");
	}

	@Override
	public void afterPropertiesSet() throws Exception {
		System.out.println("User afterPropertiesSet");
	}

	@Override
	public void destroy() throws Exception {
		System.out.println("User destroy");
	}
	
	
	... getter  setter ...
}
</code></pre>
<p><code>org.yang.learn.spring.dto.UserServiceImpl</code></p>
<pre><code class="language-java">public class UserServiceImpl implements BeanPostProcessor, BeanFactoryPostProcessor, ApplicationContextAware {
	public UserServiceImpl(){
		System.out.println("UserServiceImpl æ åæé ");
	}

	@Override
	public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
		System.out.println("UserServiceImpl postProcessBeforeInitialization å¢å¼ºå¤ç ["+beanName+"]");
		return BeanPostProcessor.super.postProcessBeforeInitialization(bean, beanName);
	}

	@Override
	public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
		System.out.println("UserServiceImpl postProcessAfterInitialization å¢å¼ºå¤ç ["+beanName+"]");
		return BeanPostProcessor.super.postProcessAfterInitialization(bean, beanName);
	}

	@Override
	public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {
		System.out.println("UserServiceImpl postProcessBeanFactory beanFactory å¢å¼ºå¤ç ["+beanFactory+"]");
	}

	@Override
	public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
		System.out.println("UserServiceImpl setApplicationContext ");
	}
}
</code></pre>
<p><code>application.xml</code></p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:aop="http://www.springframework.org/schema/cache"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
		https://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context
		https://www.springframework.org/schema/context/spring-context.xsd
		http://www.springframework.org/schema/cache
		http://www.springframework.org/schema/cache/spring-cache.xsd"&gt;

	&lt;bean id="address" class="org.yang.learn.spring.dto.Address" &gt;
		&lt;constructor-arg value="æ·±å³"/&gt;
		&lt;constructor-arg value="ç½æ¹"/&gt;
		&lt;constructor-arg value="xxxè¡é101å·"/&gt;
	&lt;/bean&gt;
	&lt;bean id="user" class="org.yang.learn.spring.dto.User" init-method="initMethod" destroy-method="destroyMethod" &gt;
		&lt;property name="username" value="å¼ ä¸"&gt;&lt;/property&gt;
		&lt;property name="age" value="9764534"&gt;&lt;/property&gt;
	&lt;/bean&gt;
	&lt;bean id="userService" class="org.yang.learn.spring.dto.UserServiceImpl" &gt;
	&lt;/bean&gt;

&lt;/beans&gt;


</code></pre>
<pre><code class="language-java">public static void main(String[] args) throws Exception {
	System.out.println("===========================å®¹å¨å¯å¨===============================\n");
	ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext("application.xml");
	System.out.println("\n==========================å®¹å¨å®æ================================");
	User user = context.getBean("user", User.class);
	System.out.println("è·åå®¹å¨çuser Bean: "+user);
	context.close();
}
</code></pre>
<h2 id="å®¹å¨çåå»º-classpathxmlapplicationcontext">å®¹å¨çåå»º (ClassPathXmlApplicationContext)</h2>
<p><code>org.springframework.context.support.ClassPathXmlApplicationContext#ClassPathXmlApplicationContext(java.lang.String)</code><br>
<code>org.springframework.context.support.ClassPathXmlApplicationContext#ClassPathXmlApplicationContext(java.lang.String[], boolean, org.springframework.context.ApplicationContext)</code></p>
<pre><code class="language-java">/**
 * Create a new ClassPathXmlApplicationContext with the given parent,
 * loading the definitions from the given XML files.
 * @param configLocations array of resource locations
 * @param refresh whether to automatically refresh the context,
 * loading all bean definitions and creating all singletons.
 * Alternatively, call refresh manually after further configuring the context.
 * @param parent the parent context
 * @throws BeansException if context creation failed
 * @see #refresh()
 */
public ClassPathXmlApplicationContext(
		String[] configLocations, boolean refresh, @Nullable ApplicationContext parent)
		throws BeansException {
	/**
	 * è°ç¨ç¶ç±»æé , åå§äºä¸äºå¯¹è±¡åå­æ®µå±æ§, ä¾å¦:
	 *  1. å½å context çå±æ§åå§å:
	 *   - å­å¨BeanFactoryPostProcessor(BFPP)çéå  {@link org.springframework.context.support.AbstractApplicationContext#beanFactoryPostProcessors}
	 *	 - id å®¹å¨ID, displayName å®¹å¨åç§°,  closed, active å®¹å¨å³é­å¯å¨ æ´»å¨ç AtomicBooleanæ è¯ç¬¦ ; {@link org.springframework.context.support.AbstractApplicationContext#id}
	 *   - startupShutdownMonitor å®¹å¨éå¯¹è±¡, å¨å®¹å¨'å·æ°'å'éæ¯'æ¶éè¦éä½(åæ­¥)ç {@link AbstractApplicationContext#startupShutdownMonitor}
	 *    shutdownHook; JVM ç HOOK {@link AbstractApplicationContext#shutdownHook}
	 *
	 *  2. å¦ææç¶å®¹å¨,åè®¾ç½®ç¶å®¹å¨,è¿ä¼åå¹¶éç½®;
	 *  {@link org.springframework.context.support.AbstractApplicationContext#setParent(org.springframework.context.ApplicationContext)}
	 *
	 *  3. åå»ºæ¯æanté£æ ¼è§£æçèµæºè§£æå¨,æ¯æééç¬¦çç±»ä¼¼`"classpath*:applicationContext-*.xml"` è¿ç§, è§£æå®¹å¨æéè¦ç xml, yml, properties ç­éç½®æä»¶; `spring.profiles.active` çåé ä¹æ¯ç±è¿ä¸ªè§£æå¨è¿è¡å¤ç
	 * 	è§£æå®¹å¨æéè¦ç xml, yml, properties ç­éç½®æä»¶;  {@link AbstractApplicationContext#AbstractApplicationContext()}
	 */
	super(parent);
	/**
	 * è§£æè·¯å¾, è·¯å¾ä¸­æ¯æè¡¨è¾¾å¼çåé, ä¾å¦: æä»¶å application-${env}.xml ç¯å¢å¯¹è±¡éé¢æenvåéä¼æ¿æ¢ä¹
	 */
	setConfigLocations(configLocations);
	if (refresh) {
		refresh();
	}
}
</code></pre>
<h3 id="æ»ç»">æ»ç»</h3>
<p>è°ç¨ç¶ç±»æé , åå§äºä¸äºå¯¹è±¡åå­æ®µå±æ§, ä¾å¦:</p>
<ol>
<li>å½å context çå±æ§åå§å:</li>
</ol>
<ul>
<li>å­å¨ BeanFactoryPostProcessor(BFPP) çéå </li>
<li>id å®¹å¨ID, displayName å®¹å¨åç§°,  closed, active å®¹å¨å³é­å¯å¨ æ´»å¨ç AtomicBooleanæ è¯ç¬¦ ;</li>
<li><code>startupShutdownMonitor</code> å®¹å¨éå¯¹è±¡, å¨å®¹å¨'å·æ°'å'éæ¯'æ¶éè¦éä½(åæ­¥)ç</li>
<li>shutdownHook; JVM ç HOOK</li>
</ul>
<ol start="2">
<li>å¦ææç¶å®¹å¨,åè®¾ç½®ç¶å®¹å¨,è¿ä¼åå¹¶éç½®;</li>
</ol>
<ul>
<li></li>
</ul>
<ol start="3">
<li>åå»ºæ¯æanté£æ ¼è§£æçèµæºè§£æå¨,æ¯æééç¬¦çç±»ä¼¼<code>"classpath*:applicationContext-*.xml"</code> è¿ç§, è§£æå®¹å¨æéè¦ç xml, yml, properties ç­éç½®æä»¶; <code>spring.profiles.active</code> çåé ä¹æ¯ç±è¿ä¸ªè§£æå¨è¿è¡å¤ç<br>
è§£æå®¹å¨æéè¦ç xml, yml, properties ç­éç½®æä»¶; </li>
</ol>
<h2 id="refresh-æ¹æ³">refresh() æ¹æ³</h2>
<p>è¿ä¸ªæ¯éç¹æ¹æ³,  å ä¹æ´ä¸ªçå½å¨æçä»£ç , é½å¯ä»¥å¨è¿ä¸ªæ¹æ³åæ¾å°, æä»¥ä»£ç æ­ç¹ ä¹¦ç­¾ è°è¯, é½ç»å®å¹²ä¸..</p>
<p><code>org.springframework.context.support.AbstractApplicationContext#refresh</code></p>
<pre><code class="language-java">
	@Override
	public void refresh() throws BeansException, IllegalStateException {
		// å®¹å¨å·æ°, æ§è¡æ¶, éè¦éä½
		synchronized (this.startupShutdownMonitor) {
			//è®°å½å®¹å¨ å¯å¨æ¶é´, æ­¥éª¤ ç¨äºåææ§è½ç (ä¸éè¦)
			StartupStep contextRefresh = this.applicationStartup.start("spring.context.refresh");

			// Prepare this context for refreshing.
			/**
			 * ä¸, (ApplicationContext)çé¢åå¤å·¥ä½;
			 * å®¹å¨å·æ°åçåå¤å·¥ä½
			 * 1. è®¾ç½®å®¹å¨çä¸äºç¶ææ å¿ç¬¦;è®¾ç½®å¯å¨æ¶é´, æ´»å¨æ å¿ç¬¦; {@link AbstractApplicationContext#prepareRefresh()}
			 * 2. è·åæèåå»º Environment å¯¹è±¡; å è½½ System.getProperties(); {@see AbstractApplicationContext#environment}
			 * 3. éªè¯ç¯å¢æ¯å¦åå«æéç½®; æå¨æ·»å éç½®. {@link AbstractApplicationContext#initPropertySources()}
			 * 4. åå¤å­å¨ äºä»¶çå¬å¨ å äºä»¶ çéåå®¹å¨, é»è®¤ä¸ºç©º {@link AbstractApplicationContext#prepareRefresh()};
			 */
			prepareRefresh();

			// Tell the subclass to refresh the internal bean factory.
			/**
			 * äº, åå»º BeanFactory;
			 * 1. éæ¯ä¹åç beanFactory (å¦ææçè¯) {@link AbstractRefreshableApplicationContext#refreshBeanFactory()}
			 * 2. å®ä¾å/åå»º beanFactory, è¿éæ¯å®ä¾ç±»æ¯ `DefaultListableBeanFactory` {@link org.springframework.context.support.AbstractRefreshableApplicationContext#createBeanFactory}
			 * 3. è®¾ç½® beanFactory å¿½ç¥  BeanNameAware, BeanClassLoaderAware, BeanFactoryAwareè¿ä¸ä¸ªAwareçæ¥å£ {@link AbstractAutowireCapableBeanFactory#AbstractAutowireCapableBeanFactory()}
			 * 		å ä¸ºå¨åå§åBeanæ¶, ä¼ç´æ¥è°ç¨å®ä»¬(èä¸æ¯éè¿éè¿ BeanPostProcessoræ©å±çAwareæºå¶è°ç¨) {@link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#initializeBean(java.lang.String, java.lang.Object, org.springframework.beans.factory.support.RootBeanDefinition)}
			 * 4. è®¾ç½® beanFactory åºååID, åç§° {@link AbstractRefreshableApplicationContext#refreshBeanFactory()}
			 * 5. æ©å±ç¹, å®å¶åè¿ä¸ª BeanFactory ä¾å¦: æ¯å¦åè®¸ BeanDefinition è¦ç; æ¯å¦èªå¨å¤çå¾ªç¯ä¾èµ;
			 * 6. åå»º(XMLè§£æå¨/è¯»åå¨) XmlBeanDefinitionReader, å¹¶åå§å; çä¸æ©å±ç¹, æ©å±Reader ä¾å¦ æ¯å¦éªè¯xmlç­ {@link AbstractXmlApplicationContext#loadBeanDefinitions(DefaultListableBeanFactory)}
			 * 7. åå»ºç¸å³å¯¹è±¡DocumentLoader, BeanDefinitionDocumentReader,BeanDefinitionParserDelegate {@link org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions(org.w3c.dom.Document, org.springframework.core.io.Resource)}
			 * 		{@link DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions(Element)}
			 *    å è½½/è§£æ XMLæ ç­¾/åç´ /å±æ§ç­å°å¶å°è£ä¸º ä¸ä¸ªä¸ª BeanDefinition å¯¹è±¡
			 * 8. å° BeanDefinitions æ³¨åå° registry {@link BeanDefinitionReaderUtils#registerBeanDefinition(BeanDefinitionHolder, BeanDefinitionRegistry)}
			 */
			ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();

			/**
			 * ä¸,(BeanFactory)é¢åå¤å·¥ä½;
			 * {@link AbstractApplicationContext#prepareBeanFactory(ConfigurableListableBeanFactory)}
			 * 1. ä¸º beanFactory è®¾ç½® bean çç±»å è½½å¨ {@link ConfigurableBeanFactory#setBeanClassLoader(ClassLoader)}
			 * 2. ä¸º beanFactory è®¾ç½® bean ç StandardBeanExpressionResolver (è¡¨è¾¾å¼(Spring EL)è§£æå¨) {@link ConfigurableBeanFactory#setBeanExpressionResolver(BeanExpressionResolver)}
			 *   å³äº (Spring EL)è§£æå¨: StandardBeanExpressionResolver çè®¾è®¡æ¯ç»åä¼äºç»§æ¿, åé¨æä¸¤ä¸ª SpelExpressionParser(çæ­£è§£æç) SpelParserConfiguration(éç½®ç±»)
			 * 3. ä¸º beanFactory è®¾ç½® PropertyEditorRegistrar (ä¸»è¦ä¸º Bean è®¾ç½®å±æ§çç®¡çç±»){@link ConfigurableBeanFactory#addPropertyEditorRegistrar(PropertyEditorRegistrar)}
			 * 		 *  PropertyEditorRegistrar è¿ä¸ªä¸»è¦ä¸º Bean è®¾ç½®å±æ§çç®¡çç±», æ¯å¦, æ¥æç±»åçæ°æ®: å¯ä»¥æ¯ç¹å®æ ¼å¼çå­ç¬¦ä¸², æ°å­, è¿å¯ä»¥æ¯æ¶é´æ³...
			 * 		 *  Spring ä¸º bean å¡«åå±æ§, ä½¿ç¨ BeanWrapperImpl åè£äºä¸ä¸(è£é¥°æ¨¡å¼)
			 * 		 *  BeanWrapperImpl å®ç°äº PropertyEditorRegistry, å¯ä»¥å¾éé¢æ³¨å PropertyEditor, å¯ä»¥èªå®ä¹å±æ§çè½¬æ¢, ç¼è¾é»è¾
			 * 4. ç» beanFactory æ·»å ä¸ä¸ª å¤çAwareç BeanPostProcessor (ApplicationContextAwareProcessor) å¹¶å¿½ç¥æè¿7ä¸ªæ¥å£çèªå¨æ³¨å¥:{@link ConfigurableBeanFactory#addBeanPostProcessor(BeanPostProcessor)}
			 * 		EnvironmentAware.class, EmbeddedValueResolverAware.class, ResourceLoaderAware.class, ApplicationEventPublisherAware.class, MessageSourceAware.class, ApplicationContextAware.class, ApplicationStartupAware.class
			 * 5. æå®åç½®ç BeanFactory,ResourceLoader,ApplicationEventPublisher,ApplicationContext {@link ConfigurableListableBeanFactory#registerResolvableDependency(Class, Object)}
			 * 		è¿å ä¸ªBeanå¯¹è±¡,  èªå¨æ³¨å¥ç Primary
			 * 6. ç» beanFactory æ·»å ä¸ä¸ª BeanPostProcessor (ApplicationListenerDetector)TODO (äºä»¶çå¬ç¸å³)
			 * 7. ç» beanFactory æ·»å ä¸ä¸ª BeanPostProcessor(LoadTimeWeaverAwareProcessor) TODO (AOP AspectJ ç»å¥å¤çç¸å³ç)
			 * 8. beanFactoryä¸­å¦ææ²¡æä»¥ä¸åç§°ç bean, åç´æ¥ç» BeanFactory çä¸çº§ç¼å­, æ³¨åå ä¸ªç¯å¢å¯¹è±¡ Bean {@link SingletonBeanRegistry#registerSingleton(String, Object)}
			 *  åç§°å¸¸éåå«æ¯:
			 *  org.springframework.context.ConfigurableApplicationContext#ENVIRONMENT_BEAN_NAME
			 *  org.springframework.context.ConfigurableApplicationContext#SYSTEM_PROPERTIES_BEAN_NAME
			 *  org.springframework.context.ConfigurableApplicationContext#SYSTEM_ENVIRONMENT_BEAN_NAME
			 *  org.springframework.context.ConfigurableApplicationContext#APPLICATION_STARTUP_BEAN_NAME
			 *
			 */
			// Prepare the bean factory for use in this context.
			prepareBeanFactory(beanFactory);

			try {
				// Allows post-processing of the bean factory in context subclasses.
				/**
				 * å, beanFactory å·²ç»åå¤å¥½äº, è®¾è®¡ç®çæ¯ç»(Context)å­ç±»é¢çä¸ä¸ªæ©å±ç¹, å¨æ­¤æ¶è¿éææç Bean å·²ç»è¢«æ³¨åäº, å°æªå®ä¾åä»»ä½bean;
				 * BeanPostProcessors
				 * (è¿éæ¯ç©ºå®ç°)
				 */
				postProcessBeanFactory(beanFactory);

				StartupStep beanPostProcess = this.applicationStartup.start("spring.context.beans.post-process");

				// Invoke factory processors registered as beans in the context.
				/**
				 * äº, è°ç¨ BeanFactoryPostProcessor å BeanDefinitionRegistryPostProcessor
				 * è¥æ¯æ³¨åçbean definition å®ç°äºè¿ä¸¤ä¸ªæ¥å£, åä¼è°ç¨(getBean)å®ä¾åå®, åè°ç¨ç¸åºçæ¥å£æ¹æ³;
				 * (æ³¨æä¸ä¸ BeanDefinitionRegistryPostProcessor æ¯ç»§æ¿èª BeanFactoryPostProcessorç)
				 * æ»çæ¥è¯´ è°ç¨çä¼åçº§æ¯:
				 * 1. è°ç¨æ¥å£çä¼åçº§:
				 *    1. ä¼åè°ç¨(å­ç±») BeanDefinitionRegistryPostProcessor
				 *    2. åè°ç¨(ç¶ç±») BeanFactoryPostProcessor
				 * 2. è°ç¨æ·»å çæ¹å¼çä¼åçº§:
				 *    1. ä¼åè°ç¨å¤é¨å¥å, å³ç´æ¥éè¿{@link AbstractApplicationContext#addBeanFactoryPostProcessor(org.springframework.beans.factory.config.BeanFactoryPostProcessor)} ä»£ç æ·»å ç
				 *    2. åè°ç¨å®¹å¨ä¸­å®ç° BeanFactoryPostProcessor æè BeanDefinitionRegistryPostProcessor ç Bean
				 * è§: {@link org.springframework.context.support.PostProcessorRegistrationDelegate#invokeBeanFactoryPostProcessors(org.springframework.beans.factory.config.ConfigurableListableBeanFactory, java.util.List)}
				 *
				 * å¼å¾ä¸æçæ¯:  Spring å¯¹äºæ¯æ SPELè¡¨è¾¾å¼, å°±æ¯éè¿ `PropertySourcesPlaceholderConfigurer` è¿ç§æ¹å¼æ©å±å®ç°ç
				 * {@link org.springframework.context.support.PropertySourcesPlaceholderConfigurer}
				 */
				invokeBeanFactoryPostProcessors(beanFactory);

				// Register bean processors that intercept bean creation.
				/**
				 *  å­, æ³¨å BeanPostProcessor (BPP)å¤çå¨;
				 *
				 *  1. æ¿å°ææ BeanPostProcessor ç±»åç bean
				 *  2. å®ä¾å BeanPostProcessor
				 *  	ä¼åå®ä¾å å®ç°äº PriorityOrdered æ¥å£ç, å¨å®ä¾åå¶å®ç(BPP)
				 *  3. è¿è¡åç±»å­å°éå {@link PostProcessorRegistrationDelegate#registerBeanPostProcessors(ConfigurableListableBeanFactory, AbstractApplicationContext)}
				 *   	* å¯¹ BeanPostProcessor è¿è¡åç±»å­èµ·æ¥,  åè°ç¨, æ¯ä¸ªéååå«æ¯
				 * 		 * 1. priorityOrderedPostProcessors //æå®ç°(PriorityOrdered)æåºæ¥å£ç
				 * 		 * 2. internalPostProcessors //Springåé¨çbean, è§: Springå°beanåä¸ºä¸ç§è§è²
				 * 		 * 3. orderedPostProcessorNames //å®ç° Ordered æ¥å£
				 * 		 * 4. nonOrderedPostProcessorNames //æ²¡ææå®é¡ºåº, æ åºç
				 *  è¿æä¸ç¹, Spring å¯¹ BeanDefinition åæä¸ç§è§è²:
				 *  	1. ç¨æ·å®ä¹ç ä¸å¡ç¸å³ç Bean Bean (ROLE_APPLICATION)
				 *      2. è¾å¤æç (ROLE_SUPPORT) è¾å¤æç, æ¯æ AOPãäºå¡ç­åè½çåé¨å®ç°?  (ä¸éè¦, ä¸è¦æ¯ä¸ä¸ªç»èé½æ£...)
				 *      3. Spring åç½®ç(ROLE_INFRASTRUCTURE)
				 *
				 *  4. æåºå¹¶æ³¨åå° beanFactory
				 *    	1. è¿éæå®ç°(PriorityOrdered)æåºæ¥å£çã@Orderedæ³¨è§£ç ç­æåºå­èµ·æ¥. å®éè°ç¨çé¡ºåº å¶å®å°±æ¯å­èµ·æ¥çé¡ºåº
				 *      2. å¦å¤ BeanPostProcessor æ¥å£ç²ç²åº¦å¤ªå¤§äº, Spring è¿ç»åä¸äºå­æ¥å£:
				 *         1. SmartInstantiationAwareBeanPostProcessor å®æä¾äºæ´é«çº§çBeanå®ä¾åæ§å¶æ¹æ³ãä¸»è¦ä½ç¨å¨äºåè®¸å¯¹Beançå®ä¾åè¿ç¨è¿è¡æ´ç²¾ç»çæ§å¶åå®å¶ã
				 *         2. MergedBeanDefinitionPostProcessor å¨åå¹¶Beanå®ä¹ï¼MergedBeanDefinitionï¼ä¹åä½å¨å®ä¾åBeanä¹åï¼åè®¸å¯¹åå¹¶åçBeanå®ä¹è¿è¡ä¿®æ¹ãè°æ´æéå åæ°æ®ã
				 *         3. DestructionAwareBeanPostProcessor å®åè®¸å¨Beanè¢«éæ¯ä¹åï¼ä¾å¦ï¼å®¹å¨å³é­æç¹å®ä½ç¨åçBeanéæ¯ï¼æ§è¡ä¸äºæä½ã
				 *         ç­ç­ä»¥ä¸ä¹ä¼å­èµ·æ¥
				 *      3. æç»è°ç¨ BPPæ¯å¨ {@link AbstractApplicationContext#finishBeanFactoryInitialization(ConfigurableListableBeanFactory)} å®ä¾åå§åå¶ä»Beanè°ç¨
				 */
				registerBeanPostProcessors(beanFactory);

				beanPostProcess.end();

				// Initialize message source for this context.
				/**
				 * ä¸, åå§åå½éå(I18N) ä¿¡æ¯æº;
				 * éé¢å¾ç®å:
				 * 1. å¦æbeanFactoryä¸­æåç§°ä¸º messageSource çBeanå®ä¹ ï¼å°±ä½¿ç¨è¿beanä½ç©å½éåæ¶æ¯æº
				 * å¦ææ²¡æåé»è®¤ä½¿ç¨ org.springframework.context.support.DelegatingMessageSource å¹¶æ³¨åå° beanFactory
				 */
				initMessageSource();

				// Initialize event multicaster for this context.
				/**
				 * å«, åå§åäºä»¶å¤æ­å¨;
				 * 1. å¦æ beanFactory ä¸­åå«åç§°ä¸º applicationEventMulticaster çbeanå®ä¹, åä½¿ç¨è¿ä¸ªBeanä½ä¸ºäºä»¶å¤æ­å¨;
				 *   å¦æä¸åå«ååå»º SimpleApplicationEventMulticasterä½ä¸ºäºä»¶å¤æ­å¨;
				 * 2.åå»ºSimpleApplicationEventMulticasterå¶å®å°±æ¯åå§åäºä¸ä¸ª,ç¨äºå­æ¾/ç®¡ç ApplicationListener çå¬å¨(è§å¯è)çç±», å¹¶æ³¨åå° beanFactory
				 * 	ä¸»è¦æ¯ {@link org.springframework.context.event.AbstractApplicationEventMulticaster#defaultRetriever} ç¨äºå­æ¾/ç®¡ç åä¸ªçå¬å¨ç(è§å¯è)
				 *  {@link org.springframework.context.event.SimpleApplicationEventMulticaster#multicastEvent(org.springframework.context.ApplicationEvent, org.springframework.core.ResolvableType) }è°ç¨å®¹å¨åå¸äºä»¶
				 */
				initApplicationEventMulticaster();

				// Initialize other special beans in specific context subclasses.
				/**
				 * ä¹, ç»å­ç±»(Context)çä¸ä¸ä¸ªæ©å±ç¹
				 * æ²¡ä»ä¹å¥½è¯´ç, è¿éæ¯ç©ºå®ç°
				 */
				onRefresh();

				// Check for listener beans and register them.
				/**
				 * å, åå¤æ­å¨æ³¨åçå¬å¨;
				 * 1. åå¤æ­å¨ä¸­æ³¨å å¨contextä¸­ççå¬å¨(è§å¯è);
				 * 2. åå¤æ­å¨ä¸­æ³¨å å¨beanFactoryä¸­çbeanæ¯çå¬å¨(ApplicationListener.class)ç(è§å¯è)
				 * 3. å¹¿æ­ this.earlyApplicationEvents å±æ§ä¸­çäºä»¶;
				 * ä¸ºä»ä¹?
				 * å ä¸ºæå¯è½ å¨å®¹å¨çå½å¨æä¸­è°ç¨äºå½å `AbstractApplicationContext#publishEvent` åå¸äºä»¶, ä½æ¯å¤æ­å¨æ²¡æåå§åå®æ, æä»¥ä¼å°äºä»¶å­å¨this.earlyApplicationEvents ä¸­;
				 * å¾å®¹å¨åå§åå®æåå¨æµç¨  {@link org.springframework.context.support.AbstractApplicationContext#registerListeners()} ä¸­ä¼åå¸å­å¨è¿éé¢çäºä»¶
				 * (ä¾å¦: å¨ BeanFactoryPostProcessor çä¸å¡é»è¾è§¦åå®¹å¨çå¹¿æ­äºä»¶, è¿æ¶åå¤æ­å¨é½ä¸å­å¨)
				 * @see AbstractApplicationContext#prepareRefresh()
				 */
				registerListeners();

				// Instantiate all remaining (non-lazy-init) singletons.
				/**
				 * åä¸, å®ä¾åå©ä¸çææåä¾bean
				 *
				 * 1. ä¸º beanFactory è®¾ç½®ç±»åè½¬æ¢å¨(ConversionService) å±æ§å¡«åæ¶ä¼ç¨å° {@link AbstractApplicationContext#finishBeanFactoryInitialization(ConfigurableListableBeanFactory)}
				 * 2. ä¸º beanFactory æ·»å åéè§£æå¨ (StringValueResolver)
				 * 	å¦æ beanFactory ä¸ä¸æä¸­ä¸åå« "é»è®¤çåéè§£æå¨ (ç±»ä¼¼ PropertySourcesPlaceholderConfigurer) è§£æç±»ä¼¼ '${}' è¿æ ·çåé "
				 * 	åä½¿ç¨ç¯å¢å¯¹è±¡(ConfigurableEnvironment)ä¸­ç ConfigurablePropertyResolverå®ç°æ¥ä½ä¸º StringValueResolver æ·»å è¿å»
				 * 3. å»ç»éç½®, æ­¤åå°±ä¸ååè®¸æ´æ¹ beanDefinition äº
				 * 4. å®ä¾åææå©ä½ç (élazy-init) åä¾ Bean
				 * 5. å¤ç FactoryBean ç±»åçbean {@link DefaultListableBeanFactory#preInstantiateSingletons()}
				 * 	å¦æè¯¥beanæ¯ FactoryBean, åå¨ bean name åé¢å ä¸ä¸ª '&amp;' åç¼, åè·å/å®ä¾å FactoryBean æ¬èº«;
				 * 	(æ³¨æä¸ä¸ FactoryBean çæå¯¹è±¡æ¯ä¸éµå¾ª Spring çbeançå½å¨æç)
				 * 	è¿æä¸¤ä¸ªå¯¹è±¡, å¦ä½è·å? getBean(beanName) :
				 * 	1. ä¼ å¥ FactoryBean ç name è¿åçæ¯å¶ getObject çç®æ å¯¹è±¡å®ä¾;
				 * 	2. å¦ææ³è·å FactoryBean æ¬èº«å®ä¾, ååé¢éè¦å ä¸ä¸ª '&amp;' åç¼;
				 * 6. å°è¯ä»å½åå®¹å¨ ä¸ äº ä¸çº§ç¼å­è·å {@link AbstractBeanFactory#doGetBean(String, Class, Object[], boolean)}
				 * 7. å¤ç AOP ä»£çå¯¹è±¡çæ {@link AbstractAutowireCapableBeanFactory#createBean(String, RootBeanDefinition, Object[])}
				 * 8. å¨JVMå±é¢å®ä¾åå¯¹è±¡ {@link AbstractAutowireCapableBeanFactory#doCreateBean(String, RootBeanDefinition, Object[])}
				 * 	1.çæ­£å¨jvmå±é¢å®ä¾åå¯¹è±¡;
				 * 		1. å¦æè¯¥ BeanDefinition æéç½® instanceSupplierå±æ§(java.util.function.Supplier),
				 * 		 å°ä½¿ç¨å¶Supplier#getæ¹æ³çè¿å, ä½ä¸ºå®ä¾å¯¹è±¡
				 * 		2. å¦æè¯¥ BeanDefinition æéç½® factory-method å°ä½¿ç¨è¯¥æ¹æ³è¿åç, ä½ä¸ºå®ä¾å¯¹è±¡
				 * 		 è¿éè¿éåæ¬'éæå·¥å'å'å®ä¾å·¥å'çå¤ç(éè¿bdçfactoryBeanName è¿è¡å¤æ­, å¦æå­å¨åæ¯'å®ä¾å·¥å')
				 * 		3. ä½¿ç¨åå°å®ä¾å, æ ¹æ®ç­ç¥å®ä¾åBeanå¯¹è±¡ {@link org.springframework.beans.factory.support.SimpleInstantiationStrategy}
				 * 		- ä½¿ç¨æåæé å½æ°æ³¨å¥,åå»º (new)
				 * 		- ä½¿ç¨æ åæé å½æ°åå»º (new)
				 * 		- å·¥åæ¹æ³å®ä¾å ('éæå·¥å' 'å®ä¾å·¥å' )
				 * 		`&lt;bean  factory-bean="bookFactoryBean"  factory-method="getBook()"/&gt;`
				 * 		éæå·¥å: factory-bean è¥æ¯ å¨éå®ç±»å åä½¿ç¨ BookFactoryBean::getBook çéææ¹æ³è¿åçå¯¹è±¡
				 * 		å®ä¾å·¥å:  factory-bean è¥æ¯ bean å åä½¿ç¨è¯¥å®ä¾æ¹æ³è¿åçå¯¹è±¡
				 * 	2. ç¨ BeanWrapper åè£åå§bean (è£é¥°æ¨¡å¼)
				 * 	3. åå§å BeanWrapper
				 * 		1. ç» BeanWrapper è®¾ç½®äº, ConversionService
				 * 		2. ç» BeanWrapper æ³¨åäº, å½å bean factory (propertyEditorRegistrars)ä¸­çå¨é¨ PropertyEditor
				 * 		3. å¤ç MergedBeanDefinitionPostProcessor çæ¥å£åè° {@link AbstractAutowireCapableBeanFactory#applyMergedBeanDefinitionPostProcessors(RootBeanDefinition, Class, String)}
				 * 		è°ç¨ æ·»å å¨ context ä¸­ BeanPostProcessor ç MergedBeanDefinitionPostProcessor çæ¥å£åè°
				 * 		è§£æå°è¯¸å¦`@Autowired`ä¹ç±»çæ³¨è§£ (Metadata)åä¿¡æ¯,åå¹¶å°BeanDefinitionä¸­
				 * 	4. å¡«åBeanå±æ§ {@link AbstractAutowireCapableBeanFactory#populateBean(String, RootBeanDefinition, BeanWrapper)}
				 * 		1. å¦ææ¯AOP, pointcut, adviceç¸å³ç, synthetic ä¼éç½®ä¸º true  è°ç¨ BeanPostProcessor çå­æ¥å£ InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation
				 * 		(ä½ç¨æ¯ å¨å®ä¾åä¹åï¼å±æ§å¡«åä¹åæ§è¡æä½, å¯ä»¥æ¦æªå±æ§å¡«åæä½)
				 * 		2. å¤çæ³¨è§£ç  byName æè byType æ³¨å¥çå±æ§
				 * 		3. åè°ææ InstantiationAwareBeanPostProcessor#postProcessProperties æ¹æ³
				 * 		æ¯å¦, `@Autowired` çå¤çå¯¹åºå®ç°ç±»: {@link org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor}
				 * 		(ä½ç¨æ¯: å¨å·¥åå°å±æ§å¼åºç¨å°ç»å®beanä¹åï¼å¯¹å®ä»¬è¿è¡å¤ç)
				 * 		æ³¨æè¿éä¹åªæ¯è§£æ, å¹¶æ²¡æè®¾ç½®è¿å», å®éèµå¼æ¹æ³è§: {@link AbstractAutowireCapableBeanFactory#applyPropertyValues(java.lang.String, org.springframework.beans.factory.config.BeanDefinition, org.springframework.beans.BeanWrapper, org.springframework.beans.PropertyValues)}
				 * 	5.åå§åBeanå¯¹è±¡ {@link AbstractAutowireCapableBeanFactory#initializeBean(String, Object, RootBeanDefinition)}
				 * 		1. åè°ç¨è¿ä¸ä¸ª BeanNameAware, BeanClassLoaderAware, BeanFactoryAware {@link AbstractAutowireCapableBeanFactory#invokeAwareMethods(String, Object)}
				 * 		è¿ä¸ä¸ªæ¯å¨åå»ºBeanFactory æ¶å¿½ç¥çä¸ä¸ª Aware æ¥å£
				 * 		2. è°ç¨ææ BeanPostProcessors#postProcessBeforeInitialization (ä½ç¨: å¨Beanåå§åä¹åè°ç¨) {@link AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsBeforeInitialization(Object, String)}
				 * 		3. è°ç¨ init-method æ¹æ³ {@link AbstractAutowireCapableBeanFactory#invokeInitMethods(String, Object, RootBeanDefinition)}
				 * 		4. è°ç¨ææ BeanPostProcessors#postProcessAfterInitialization (ä½ç¨: å¨Beanåå§åä¹åè°ç¨) {@link AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsAfterInitialization(Object, String)}
				 * 	6. æ³¨å beanéæ¯çå·¥ä½(å¦æéè¦){@link AbstractBeanFactory#registerDisposableBeanIfNecessary(String, Object, RootBeanDefinition)}
				 * 			1. org.springframework.beans.factory.config.DestructionAwareBeanPostProcessor#postProcessBeforeDestruction(Object,String) BPPæ¥å£
				 * 			2. org.springframework.beans.factory.DisposableBean æ¥å£
				 * 			3. èªå®ä¹ destroyæ¹æ³
				 * 			(å¨å®¹å¨å³é­æ¶ä¼è°ç¨ä¼æè¿ä¸ªé¡ºåºè°ç¨)
				 *
				 */
				finishBeanFactoryInitialization(beanFactory);

				// Last step: publish corresponding event.
				/**
				 * åäº, å®æå®¹å¨å·æ°
				 * 1. æ¸çåç§ç¼å­èµæº
				 * 2. ä¸ºå½åä¸ä¸æåå§åçå½å¨æå¤çå¨
				 * 3. åå¸ ContextRefreshedEvent (Context å®æå·æ°)äºä»¶
				 */
				finishRefresh();
			}

			catch (RuntimeException | Error ex ) {
				if (logger.isWarnEnabled()) {
					logger.warn("Exception encountered during context initialization - " +
							"cancelling refresh attempt: " + ex);
				}
				// Destroy already created singletons to avoid dangling resources.
				destroyBeans();

				// Reset 'active' flag.
				cancelRefresh(ex);

				// Propagate exception to caller.
				throw ex;
			}

			finally {
				contextRefresh.end();
			}
		}
	}
</code></pre>
<h2 id="ä¸--applicationcontextçé¢åå¤å·¥ä½">ä¸.  (ApplicationContext)çé¢åå¤å·¥ä½</h2>
<p>ApplicationContext çé¢åå¤å·¥ä½, å®¹å¨å·æ°åçåå¤å·¥ä½<br>
<code>org.springframework.context.support.AbstractApplicationContext#prepareRefresh</code></p>
<pre><code class="language-java">/**
	 * Prepare this context for refreshing, setting its startup date and
	 * active flag as well as performing any initialization of property sources.
	 * å®¹å¨å·æ°åçåå¤å·¥ä½
	 * 1. è®¾ç½®å®¹å¨çä¸äºç¶ææ å¿ç¬¦;è®¾ç½®å¯å¨æ¶é´, æ´»å¨æ å¿ç¬¦; {@link AbstractApplicationContext#prepareRefresh()}
	 * 2. è·åæèåå»º Environment å¯¹è±¡; å è½½ System.getProperties(); {@see AbstractApplicationContext#environment}
	 * 3. éªè¯ç¯å¢æ¯å¦åå«æéç½®; æå¨æ·»å éç½®. {@link AbstractApplicationContext#initPropertySources()}
	 * 4. åå¤å­å¨ äºä»¶çå¬å¨ å äºä»¶ çéåå®¹å¨, é»è®¤ä¸ºç©º {@link AbstractApplicationContext#prepareRefresh()};
	 */
	protected void prepareRefresh() {
		// è®¾ç½®å®¹å¨çä¸äºç¶ææ å¿ç¬¦;è®¾ç½®å¯å¨æ¶é´, æ´»å¨æ å¿ç¬¦;
		// Switch to active.
		this.startupDate = System.currentTimeMillis();
		this.closed.set(false);
		this.active.set(true);

		if (logger.isDebugEnabled()) {
			if (logger.isTraceEnabled()) {
				logger.trace("Refreshing " + this);
			}
			else {
				logger.debug("Refreshing " + getDisplayName());
			}
		}

		// Initialize any placeholder property sources in the context environment.
		//çç»å­ç±»æ©å±çæ¹æ³: éªè¯ç¯å¢æ¯å¦åå«æéç½®; æå¨æ·»å éç½®;...
		initPropertySources();

		// Validate that all properties marked as required are resolvable:
		/**
		 *  éªè¯å¿é¡»çå­å¨çéç½®. ä¾å¦è°ç¨ `setRequiredProperties("iot.config.thread")`ä¹å, å¨è¿éä¼éªè¯æ¯å¦å­å¨ iot.config.thread éç½®,å¦åä¼æåºå¼å¸¸ MissingRequiredPropertiesException
		 * 	 {@link ConfigurablePropertyResolver#setRequiredProperties(String...) }
		 */
		getEnvironment().validateRequiredProperties();

		// s tore pre-refresh ApplicationListeners...
		//å­å¨çå¬å¨çéååå§å; this.earlyApplicationEvents(å·æ°åççå¬å¨)
		if (this.earlyApplicationListeners == null) {
			//å¦æä¸ºç©º,åæ·»å  this.applicationListeners å¨bootä¸­æ¯æå¼ç
			this.earlyApplicationListeners = new LinkedHashSet&lt;&gt;(this.applicationListeners);
		}
		else {
			// å¦æä¸ä¸ºç©º, åæ¸ç©º; æ³¨æè¿æ¯ content çå¤ç¨æ¹æ³ Refresh()
			// Reset local application listeners to pre-refresh state.
			this.applicationListeners.clear();
			this.applicationListeners.addAll(this.earlyApplicationListeners);
		}

		// Allow for the collection of early ApplicationEvents,
		// to be published once the multicaster is available...
		this.earlyApplicationEvents = new LinkedHashSet&lt;&gt;();
	}
</code></pre>
<h3 id="æ»ç»-1">æ»ç»</h3>
<ol>
<li>è®¾ç½®å®¹å¨çä¸äºç¶ææ å¿ç¬¦;è®¾ç½®å¯å¨æ¶é´, æ´»å¨æ å¿ç¬¦;</li>
<li>è·åæèåå»º Environment å¯¹è±¡; å è½½ System.getProperties();</li>
<li>éªè¯ç¯å¢æ¯å¦åå«æéç½®; æå¨æ·»å éç½®.</li>
<li>åå¤å­å¨ äºä»¶çå¬å¨ å äºä»¶ çéåå®¹å¨, é»è®¤ä¸ºç©º {@link AbstractApplicationContext#prepareRefresh()};</li>
</ol>
<h2 id="äº-åå»º-beanfactory---obtainfreshbeanfactory">äº. åå»º BeanFactory - obtainFreshBeanFactory()</h2>
<h3 id="åå»º-beanfactory">åå»º BeanFactory</h3>
<p>ç¬¬ä¸æ­¥å½ç¶æ¯åå»ºå­å¨Beançå®¹å¨å¦..<br>
<code>org.springframework.context.support.AbstractApplicationContext#obtainFreshBeanFactory</code><br>
<code>org.springframework.context.support.AbstractRefreshableApplicationContext#refreshBeanFactory</code></p>
<pre><code class="language-java">
	/**
	 * This implementation performs an actual refresh of this context's underlying
	 * bean factory, shutting down the previous bean factory (if any) and
	 * initializing a fresh bean factory for the next phase of the context's lifecycle.
	 *  {@link org.springframework.context.support.AbstractRefreshableApplicationContext#refreshBeanFactory}
	 */
	@Override
	protected final void refreshBeanFactory() throws BeansException {
		// å¦ææ åéæ¯ä¹åç BeanFactory
		if (hasBeanFactory()) {
			destroyBeans();
			closeBeanFactory();
		}
		try {
			/**
			 * &lt;!&gt; åå»º DefaultListableBeanFactory {@link org.springframework.context.support.AbstractRefreshableApplicationContext#createBeanFactory}
			 *  è®¾ç½® beanFactory å¿½ç¥  BeanNameAware, BeanClassLoaderAware, BeanFactoryAwareè¿ä¸ä¸ªAwareçæ¥å£ {@link AbstractAutowireCapableBeanFactory#AbstractAutowireCapableBeanFactory()}
			 *  å ä¸ºå¨åå§åBeanæ¶, ä¼ç´æ¥è°ç¨å®ä»¬(èä¸æ¯éè¿éè¿ BeanPostProcessoræ©å±çAwareæºå¶è°ç¨) {@link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#initializeBean(java.lang.String, java.lang.Object, org.springframework.beans.factory.support.RootBeanDefinition)}
			 */
			DefaultListableBeanFactory beanFactory = createBeanFactory();
			// è®¾ç½® beanFactory åºååID
			beanFactory.setSerializationId(getId());
			/**
			 *  å®å¶å BeanFactory &lt;!&gt; å¯æ©å±ç¹
			 *  {@link org.springframework.context.support.AbstractRefreshableApplicationContext#customizeBeanFactory(org.springframework.beans.factory.support.DefaultListableBeanFactory)}
			 *  1. æ¯å¦åè®¸ BeanDefinition è¦ç; å¦æä¸æ¯null,åè¦çé»è®¤å¼, å¯ä»¥çç»å­ç±»æ©å±ç
			 *  2. æ¯å¦èªå¨å¤çå¾ªç¯ä¾èµ; å¯ä»¥çç»å­ç±»æ©å±ç
			 */
			customizeBeanFactory(beanFactory);
			/**
			 * å è½½ BeanDefinitions &lt;!&gt;éç¹ {@link AbstractRefreshableApplicationContext#loadBeanDefinitions(DefaultListableBeanFactory)}
			 * 1. åå»º(XMLè§£æå¨/è¯»åå¨) XmlBeanDefinitionReader, å¹¶åå§å; çä¸æ©å±ç¹, æ©å±Reader ä¾å¦ æ¯å¦éªè¯xmlç­
			 * 2. åå»ºç¸å³å¯¹è±¡ DocumentLoader, BeanDefinitionDocumentReader, BeanDefinitionParserDelegate
			 *    å è½½è§£æ XMLçæ ç­¾/åç´ /å±æ§ ç­å¹¶ä¸å°å¶å°è£ä¸º ä¸ä¸ªä¸ª BeanDefinition å¯¹è±¡
			 * 3. å° BeanDefinitions æ³¨åå° registry
			 */
			loadBeanDefinitions(beanFactory);
			this.beanFactory = beanFactory;
		}
		catch (IOException ex) {
			throw new ApplicationContextException("I/O error parsing bean definition source for " + getDisplayName(), ex);
		}
	}
</code></pre>
<p><code>org.springframework.context.support.AbstractRefreshableApplicationContext#createBeanFactory</code></p>
<pre><code class="language-java">/**
	 * Create an internal bean factory for this context.
	 * Called for each {@link #refresh()} attempt.
	 * &lt;p&gt;The default implementation creates a
	 * {@link org.springframework.beans.factory.support.DefaultListableBeanFactory}
	 * with the {@linkplain #getInternalParentBeanFactory() internal bean factory} of this
	 * context's parent as parent bean factory. Can be overridden in subclasses,
	 * for example to customize DefaultListableBeanFactory's settings.
	 * @return the bean factory for this context
	 * @see org.springframework.beans.factory.support.DefaultListableBeanFactory#setAllowBeanDefinitionOverriding
	 * @see org.springframework.beans.factory.support.DefaultListableBeanFactory#setAllowEagerClassLoading
	 * @see org.springframework.beans.factory.support.DefaultListableBeanFactory#setAllowCircularReferences
	 * @see org.springframework.beans.factory.support.DefaultListableBeanFactory#setAllowRawInjectionDespiteWrapping
	 */
	protected DefaultListableBeanFactory createBeanFactory() {
		return new DefaultListableBeanFactory(getInternalParentBeanFactory());
	}
</code></pre>
<p>åå»ºçå®ä¾æ¯ <code>DefaultListableBeanFactory</code></p>
<h3 id="åå»º-xmlbeandefinitionreader">åå»º XmlBeanDefinitionReader</h3>
<p><code>XmlBeanDefinitionReader</code> è¿ä¸ªå¯¹è±¡æ¯ç¨æ¥è¯»å xml éç½®ç</p>
<p><code>org.springframework.context.support.AbstractXmlApplicationContext#loadBeanDefinitions(org.springframework.beans.factory.support.DefaultListableBeanFactory)</code></p>
<pre><code class="language-java">/**
 * Loads the bean definitions via an XmlBeanDefinitionReader.
 *
 *  1. åå»º(XMLè§£æå¨/è¯»åå¨) XmlBeanDefinitionReader {@link AbstractXmlApplicationContext#loadBeanDefinitions(DefaultListableBeanFactory)}
 *    - ç» beanDefinitionReader è®¾ç½®ç¯å¢å¯¹è±¡, å¯ä»¥è®© XmlBeanDefinitionReader ååéè¡¨è¾¾å¼è§£ææ¯å¦ ${jdbc.url}
 *    - ç» beanDefinitionReader è®¾ç½® BeanFactory
 * 	  - ç» beanDefinitionReader è®¾ç½® è¦ç¨äºè§£æçSAXå®ä½è§£æå¨; (SAXå¨ç§° Simple API for XMLï¼æ¢æ¯ä¸ç§æ¥å£ï¼ä¹æ¯ä¸ç§è½¯ä»¶åãå®æ¯ä¸ç§XMLè§£æçæ¿ä»£æ¹æ³)
 * 			æ³¨æè¿éå è½½äºä¸¤ä¸ªå¯¹è±¡: 1. BeansDtdResolver (XSD,DTDè§£æå¨); 2. PluggableSchemaResolver  æ å°(æ¬å°æä»¶xsdæ£éª) 'META-INF/spring.schemas'æä»¶ä¿¡æ¯
 * 			ä¾å¦, context å½åç©ºé´xmlæ£éªçæ å°:
 * 			&lt;code&gt; http\://www.springframework.org/schema/context/spring-context.xsd=org/springframework/context/config/spring-context.xsd&lt;/code&gt;
 * 			@see DelegatingEntityResolver#DelegatingEntityResolver(java.lang.ClassLoader)
 * {@link AbstractXmlApplicationContext#initBeanDefinitionReader(XmlBeanDefinitionReader)}
 *  2. è°ç¨æ©å±ç¹æ¹æ³, æ©å±/å®å¶ XmlBeanDefinitionReader
 *  3. å è½½ BeanDefinitions &lt;!&gt;
 *
 * @see org.springframework.beans.factory.xml.XmlBeanDefinitionReader
 * @see #initBeanDefinitionReader
 * @see #loadBeanDefinitions
 */
@Override
protected void loadBeanDefinitions(DefaultListableBeanFactory beanFactory) throws BeansException, IOException {
	// Create a new XmlBeanDefinitionReader for the given BeanFactory.
	/**
	 * åå»º(XMLè§£æå¨/è¯»åå¨) XmlBeanDefinitionReader {@link AbstractXmlApplicationContext#loadBeanDefinitions(DefaultListableBeanFactory)}
	 * æ³¨æä¼ è¿å»ç DefaultListableBeanFactory å®å®ç°äº BeanDefinitionRegistry ä½ä¸º Registry ä¼ éè¿å»
	 * æåè§£æåºæ¥ç BeanDefinition, ä½¿ç¨è¯¥ Registry ä½ä¸ºæ³¨åä¸­å¿
	 */
	XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory);
	// Configure the bean definition reader with this context's
	// resource loading environment.
	// ç» beanDefinitionReader è®¾ç½®ç¯å¢å¯¹è±¡, å¯ä»¥è®© XmlBeanDefinitionReader ååéè¡¨è¾¾å¼è§£ææ¯å¦ ${jdbc.url}
	beanDefinitionReader.setEnvironment(getEnvironment());
	// ç» beanDefinitionReader è®¾ç½® BeanFactory
	beanDefinitionReader.setResourceLoader(this);
	/**
	 * ç» beanDefinitionReader è®¾ç½® è¦ç¨äºè§£æçSAXå®ä½è§£æå¨; (SAXå¨ç§° Simple API for XMLï¼æ¢æ¯ä¸ç§æ¥å£ï¼ä¹æ¯ä¸ç§è½¯ä»¶åãå®æ¯ä¸ç§XMLè§£æçæ¿ä»£æ¹æ³)
	 * 		æ³¨æè¿éå è½½äºä¸¤ä¸ªå¯¹è±¡: 1. BeansDtdResolver (XSD,DTDè§£æå¨); 2. PluggableSchemaResolver  æ å°(æ¬å°æä»¶xsdæ£éª) 'META-INF/spring.schemas'æä»¶ä¿¡æ¯
	 * 				ä¾å¦, context å½åç©ºé´xmlæ£éªçæ å°: `http\://www.springframework.org/schema/context/spring-context.xsd=org/springframework/context/config/spring-context.xsd`
	 * 		ä½¿ç¨è¿ä¸¤ä¸ªè§£æå¨é¿åä»ç½ç»ä¸è½½DTDæXSD,è§£æå¨ä¼æ ¹æ®è¿äºæ¨¡å¼å®ä¹éªè¯éç½®æä»¶çç»ææ¯å¦æ­£ç¡®ãå¦æéªè¯å¤±è´¥ï¼å®¹å¨å°æ æ³å¯å¨
	 * @see DelegatingEntityResolver#DelegatingEntityResolver(java.lang.ClassLoader)
	 */
	beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this));

	// Allow a subclass to provide custom initialization of the reader,
	// then proceed with actually loading the bean definitions.
	/**
	 * è°ç¨æ©å±ç¹æ¹æ³, æ©å±/å®å¶ XmlBeanDefinitionReader {@link AbstractXmlApplicationContext#initBeanDefinitionReader(XmlBeanDefinitionReader)}
	 */
	initBeanDefinitionReader(beanDefinitionReader);
	
	/**
	 * å è½½ BeanDefinitions, å¹¶æ³¨åå° Registry ä¸­, è¿ä¸ªæ­¥éª¤, ä¸ºäºå¤ç¨ä»£ç åµå¥çæ¹æ³éå¸¸å¤, æ»ç»ä¸ä¸å³é®ç¹
	 * 1. ä¸ºäºä»£ç å¤ç¨,å¤ä¸ªæ¹æ³éè½½ éç½®æä»¶è·¯å¾ (Stringåæ°), å¤éç½®æä»¶(æ°ç»åæ°) , å¨ç»ä¸è½¬ä¸º `org.springframework.core.io.Resource` å¯¹è±¡å»è¿­ä»£
	 * 		æç»è¯»åéç½®æä»¶çè¾å¥æµå¨ {@link org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.support.EncodedResource)}
	 * 2.
	 */
	loadBeanDefinitions(beanDefinitionReader);
}
</code></pre>
<h4 id="èªå®ä¹å½åç©ºé´å¤çå¨">èªå®ä¹å½åç©ºé´å¤çå¨</h4>
<p>æ³¨æä¸ç¹  <code>XmlBeanDefinitionReader</code> ææ ä¸ä¸ª <code>namespaceHandlerResolver</code>, é»è®¤å®çåå»ºé»è¾æ¯å¨<br>
<code>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#createDefaultNamespaceHandlerResolver</code></p>
<pre><code class="language-java">
/**
	 * Create the default implementation of {@link NamespaceHandlerResolver} used if none is specified.
	 * &lt;p&gt;The default implementation returns an instance of {@link DefaultNamespaceHandlerResolver}.
	 * @see DefaultNamespaceHandlerResolver#DefaultNamespaceHandlerResolver(ClassLoader)
	 */
	protected NamespaceHandlerResolver createDefaultNamespaceHandlerResolver() {
		ResourceLoader resourceLoader = getResourceLoader();
		ClassLoader cl = (resourceLoader != null ? resourceLoader.getClassLoader() : getBeanClassLoader());
		// è§£æèªå®ä¹æ ç­¾ç NamespaceHandlerResolver å½åç©ºé´ handle æ å°
		//
		return new DefaultNamespaceHandlerResolver(cl);
	}
</code></pre>
<h3 id="å è½½-beandefinition-å°å®¹å¨">å è½½ BeanDefinition å°å®¹å¨</h3>
<p>è¿ä¸æ­¥ ä¸ºäºå¤ç¨, åµå¥çæ¹æ³éå¸¸å¤, è¿éååºå³é®æ¹æ³</p>
<h4 id="è½¬ä¸ºæ°ç»åæ°è¿­ä»£">è½¬ä¸ºæ°ç»åæ°è¿­ä»£</h4>
<p>æ°ç»æ¹å¼è¿­ä»£ä»¥æ¯æå¤éç½®æä»¶</p>
<pre><code class="language-java">	/**
	 * Load the bean definitions with the given XmlBeanDefinitionReader.
	 * &lt;p&gt;The lifecycle of the bean factory is handled by the {@link #refreshBeanFactory}
	 * method; hence this method is just supposed to load and/or register bean definitions.
	 *
	 * æ ¹æ®èµæºæä»¶æ°ç»è¿­ä»£å è½½è§£æ
	 * 		å è½½ Resource[] å½¢å¼çéç½®æä»¶
	 * 		å è½½ String[] å½¢å¼çéç½®æä»¶
	 *
	 * @param reader the XmlBeanDefinitionReader to use
	 * @throws BeansException in case of bean registration errors
	 * @throws IOException if the required XML document isn't found
	 * @see #refreshBeanFactory
	 * @see #getConfigLocations
	 * @see #getResources
	 * @see #getResourcePatternResolver
	 */
	protected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws BeansException, IOException {
		//å è½½ Resource[] å½¢å¼çéç½®æä»¶
		Resource[] configResources = getConfigResources();
		if (configResources != null) {
			reader.loadBeanDefinitions(configResources);
		}
		//å è½½ String[] å½¢å¼çéç½®æä»¶
		String[] configLocations = getConfigLocations();
		if (configLocations != null) {
			reader.loadBeanDefinitions(configLocations);
		}
	}
</code></pre>
<h4 id="è½¬ä¸º-resource">è½¬ä¸º Resource</h4>
<p>ç»ä¸è½¬ä¸º <code>Resource</code> å¯¹è±¡ä»¥æ¹ä¾¿å è½½</p>
<pre><code class="language-java">	/**
	 * Load bean definitions from the specified resource location.
	 * &lt;p&gt;The location can also be a location pattern, provided that the
	 * ResourceLoader of this bean definition reader is a ResourcePatternResolver.
	 * @param location the resource location, to be loaded with the ResourceLoader
	 * (or ResourcePatternResolver) of this bean definition reader
	 * @param actualResources a Set to be filled with the actual Resource objects
	 * that have been resolved during the loading process. May be {@code null}
	 * to indicate that the caller is not interested in those Resource objects.
	 * @return the number of bean definitions found
	 * @throws BeanDefinitionStoreException in case of loading or parsing errors
	 * @see #getResourceLoader()
	 * @see #loadBeanDefinitions(org.springframework.core.io.Resource)
	 * @see #loadBeanDefinitions(org.springframework.core.io.Resource[])
	 */
	public int loadBeanDefinitions(String location, @Nullable Set&lt;Resource&gt; actualResources) throws BeanDefinitionStoreException {
		ResourceLoader resourceLoader = getResourceLoader();
		if (resourceLoader == null) {
			throw new BeanDefinitionStoreException(
					"Cannot load bean definitions from location [" + location + "]: no ResourceLoader available");
		}
		if (resourceLoader instanceof ResourcePatternResolver resourcePatternResolver) {
			// Resource pattern matching available.
			try {
				/**
				 * å¯¹äºåéå¤ç å¨ {@link org.springframework.context.support.AbstractRefreshableConfigApplicationContext#setConfigLocations(String...)} å·²ç»å¤çè¿ä¸éäº, è¿éåå¤çä¸é?
				 *
				 * è¿éçéç¹æ¯: å° String è·¯å¾ è½¬ä¸ºResourcedå¯¹è±¡, å¤ä¸å¤çåéæ æè°, ä¸æ¯éç¹
				 * å¤çæä»¶ååå«åéè¡¨è¾¾å¼ç, ä¾å¦: application-${active}.xml, ç¨ç¯å¢å¯¹è±¡åéæ¿æ¢ä¹
				 */
				Resource[] resources = resourcePatternResolver.getResources(location);
				int count = loadBeanDefinitions(resources);
				if (actualResources != null) {
					Collections.addAll(actualResources, resources);
				}
				if (logger.isTraceEnabled()) {
					logger.trace("Loaded " + count + " bean definitions from location pattern [" + location + "]");
				}
				return count;
			}
			catch (IOException ex) {
				throw new BeanDefinitionStoreException(
						"Could not resolve bean definition resource pattern [" + location + "]", ex);
			}
		}
		else {
			// Can only load single resources by absolute URL.
			Resource resource = resourceLoader.getResource(location);
			int count = loadBeanDefinitions(resource);
			if (actualResources != null) {
				actualResources.add(resource);
			}
			if (logger.isTraceEnabled()) {
				logger.trace("Loaded " + count + " bean definitions from location [" + location + "]");
			}
			return count;
		}
	}
</code></pre>
<h4 id="è½¬ä¸º-encodedresource">è½¬ä¸º EncodedResource</h4>
<p>è½¬ä¸º <code>EncodedResource</code> å¯¹è±¡ä»¥è§£å³ç¼ç <br>
<code>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.Resource)</code></p>
<pre><code class="language-java">/**  
 * å° Resource åè£ä¸º EncodedResource å è½½, åºè¯¥ä¸»è¦æ¯è§£å³ç¼ç çé®é¢  
 * Load bean definitions from the specified XML file.  
 * @param resource the resource descriptor for the XML file  
 * @return the number of bean definitions found  
 * @throws BeanDefinitionStoreException in case of loading or parsing errors  
 */@Override  
public int loadBeanDefinitions(Resource resource) throws BeanDefinitionStoreException {  
    return loadBeanDefinitions(new EncodedResource(resource));  
}

</code></pre>
<h4 id="è¯»åéç½®æä»¶è¾å¥æµ">è¯»åéç½®æä»¶è¾å¥æµ</h4>
<p><code>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.support.EncodedResource)</code></p>
<pre><code class="language-java">/**
	 * æ ¡éªä¸ä¸, è¿éè§£å³å¾ªç¯å¯¼å¥
	 * Load bean definitions from the specified XML file.
	 * @param encodedResource the resource descriptor for the XML file,
	 * allowing to specify an encoding to use for parsing the file
	 * @return the number of bean definitions found
	 * @throws BeanDefinitionStoreException in case of loading or parsing errors
	 */
	public int loadBeanDefinitions(EncodedResource encodedResource) throws BeanDefinitionStoreException {
		Assert.notNull(encodedResource, "EncodedResource must not be null");
		if (logger.isTraceEnabled()) {
			logger.trace("Loading XML bean definitions from " + encodedResource);
		}

		//ä½¿ç¨Setå­å¨å·²å è½½çéç½®èµæº
		Set&lt;EncodedResource&gt; currentResources = this.resourcesCurrentlyBeingLoaded.get();

		// å½éå°å¾ªç¯ import definitions æ¶æåºå¼å¸¸
		if (!currentResources.add(encodedResource)) {
			throw new BeanDefinitionStoreException(
					"Detected cyclic loading of " + encodedResource + " - check your import definitions!");
		}
		// è·å¾éç½®æä»¶çè¾å¥æµ; è¿éçæ­£çå¼å§è¯»
		try (InputStream inputStream = encodedResource.getResource().getInputStream()) {
			InputSource inputSource = new InputSource(inputStream);
			if (encodedResource.getEncoding() != null) {
				inputSource.setEncoding(encodedResource.getEncoding());
			}
			return doLoadBeanDefinitions(inputSource, encodedResource.getResource());
		}
		catch (IOException ex) {
			throw new BeanDefinitionStoreException(
					"IOException parsing XML document from " + encodedResource.getResource(), ex);
		}
		finally {
			currentResources.remove(encodedResource);
			if (currentResources.isEmpty()) {
				this.resourcesCurrentlyBeingLoaded.remove();
			}
		}
	}
</code></pre>
<h4 id="åå»º--beandefinitiondocumentreader">åå»º  BeanDefinitionDocumentReader</h4>
<p><code>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions</code></p>
<pre><code class="language-java">/**
	 * Register the bean definitions contained in the given DOM document.
	 * Called by {@code loadBeanDefinitions}.
	 * &lt;p&gt;Creates a new instance of the parser class and invokes
	 * {@code registerBeanDefinitions} on it.
	 * @param doc the DOM document
	 * @param resource the resource descriptor (for context information)
	 * @return the number of bean definitions found
	 * @throws BeanDefinitionStoreException in case of parsing errors
	 * @see #loadBeanDefinitions
	 * @see #setDocumentReaderClass
	 * @see BeanDefinitionDocumentReader#registerBeanDefinitions
	 */
	public int registerBeanDefinitions(Document doc, Resource resource) throws BeanDefinitionStoreException {
		/**
		 *  è¿éååå»ºäºä¸ä¸ª BeanDefinitionDocumentReader å¯¹è±¡, ç¨æ¥è¯»å/è§£æ Document
		 */
		BeanDefinitionDocumentReader documentReader = createBeanDefinitionDocumentReader();
		int countBefore = getRegistry().getBeanDefinitionCount();

		/**
		 * è§£æå¹¶æ³¨å bean definitions å° Registry ä¸­
		 * &lt;br /&gt;
		 * è§£æXMLèªå®ä¹æ ç­¾ éè¦æ³¨æä¸ä¸, è¿éçç¬¬2ä¸ªåæ°åå»ºç XmlReaderContext;
		 * 		å®ä»è¿éåå»ºäº {@link XmlBeanDefinitionReader#getNamespaceHandlerResolver()} å½åç©ºé´å¤çå¨è§£æå¨, åç»­è§£æå°å¯¹åºçå½åç©ºé´å¤ç, è°ç¨å¶ NamespaceHandler#parse è¿è¡è§£æ
		 * 		å®é»è®¤è¯»åçéç½®æ¯ `META-INF/spring.handlers`
		 * 		ä¾å¦:
		 * 		spring-context æ¨¡åçä¸­ `META-INF/spring.handlers` å®ä¹çhandlesæå¦ä¸è¿äº
		 * http\://www.springframework.org/schema/context=org.springframework.context.config.ContextNamespaceHandler
		 * http\://www.springframework.org/schema/jee=org.springframework.ejb.config.JeeNamespaceHandler
		 * http\://www.springframework.org/schema/lang=org.springframework.scripting.config.LangNamespaceHandler
		 * http\://www.springframework.org/schema/task=org.springframework.scheduling.config.TaskNamespaceHandler
		 * http\://www.springframework.org/schema/cache=org.springframework.cache.config.CacheNamespaceHandler
		 *
		 * 		spring-aop æ¨¡åçä¸­ `META-INF/spring.handlers` å®ä¹çhandlesæå¦ä¸è¿äº
		 * http\://www.springframework.org/schema/aop=org.springframework.aop.config.AopNamespaceHandler
		 */
		documentReader.registerBeanDefinitions(doc, createReaderContext(resource));
		// è¿åè§£æ bean definitions çæ°é
		return getRegistry().getBeanDefinitionCount() - countBefore;
	}
</code></pre>
<h4 id="éå½åµå¥å è½½">éå½åµå¥å è½½</h4>
<p><code>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions</code></p>
<pre><code class="language-java">/**
	 * Register each bean definition within the given root {@code &lt;beans/&gt;} element.
	 *  å¨ç»å®ç(beans)æ ¹åç´ ä¸­æ³¨åæ¯ä¸ªbeanå®ä¹, è¿éç Element æ¯ xml æ ¹åç´ 
	 */
	@SuppressWarnings("deprecation")  // for Environment.acceptsProfiles(String...)
	protected void doRegisterBeanDefinitions(Element root) {
		// Any nested &lt;beans&gt; elements will cause recursion in this method. In
		// order to propagate and preserve &lt;beans&gt; default-* attributes correctly,
		// keep track of the current (parent) delegate, which may be null. Create
		// the new (child) delegate with a reference to the parent for fallback purposes,
		// then ultimately reset this.delegate back to its original (parent) reference.
		// this behavior emulates a stack of delegates without actually necessitating one.
		/**
		 * å¨æ­¤æ¹æ³ä¸­ï¼ä»»ä½åµå¥ç&lt;beans&gt;åç´ é½å°å¯¼è´éå½è°ç¨
		 *   ä¸ºäºæ­£ç¡®å°ä¼ æ­åä¿å­&lt;beans&gt;é»è®¤å±æ§ï¼è¯·è·è¸ªå½å(ç¶)å§æ(å®å¯è½ä¸ºç©º)ã
		 *   åå»ºæ°ç(å­)å§æï¼å¹¶å°å¶å¼ç¨å°ç¶(ç¶)å§æç¨äºåéç®çï¼ç¶åæç»å° this.delegateéç½®ä¸ºå¶åå§(ç¶)å¼ç¨ã
		 *   æ­¤è¡ä¸ºæ¨¡æå§æå æ ï¼èå®éä¸ä¸éè¦å§æå æ ã
		 *
		 * åºè¯¥æ¯åµå¥è§£æ/éå½æ¶, é½ç¨è¿ä¸ä¸ª delegateè§£æ, ä¿å­ç¶æ, ç¨äºä¼ éä¸ä¸æçåæ°;
		 */
		BeanDefinitionParserDelegate parent = this.delegate;
		/**
		 * å§æ namespaceHandlerResolver
		 */
		this.delegate = createDelegate(getReaderContext(), root, parent);//parent å§æ´¾, ä¸çº§çparent

		/**
		 * æ¯å¦é»è®¤å½åç©ºé´; è¿éæ¯ xml çå½åç©ºé´è§£æå¤æ­
		 *    ç®èè¨ä¹é»è®¤å½åç©ºé´å¤å®æ¯: http://www.springframework.org/schema/beans æèæ¯ org/springframework/beans/factory/xml/spring-beans.dtd å¶DTDå®ä¹çæ ç­¾
		 *    å¦:
		 *    &lt;beans..&gt;&lt;/beans&gt;, &lt;bean&gt;&lt;/bean&gt;, &lt;import resource="" /&gt; è¿äºæ ç­¾æ¯é»è®¤å½åç©ºé´
		 *    &lt;tx:TAG ...&gt; , &lt;aop:TAG ...&gt; è¿äºæ ç­¾ä¸æ¯é»è®¤å½åç©ºé´
		 */
		if (this.delegate.isDefaultNamespace(root)) {
			String profileSpec = root.getAttribute(PROFILE_ATTRIBUTE);
			if (StringUtils.hasText(profileSpec)) {
				String[] specifiedProfiles = StringUtils.tokenizeToStringArray(
						profileSpec, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS);
				// We cannot use Profiles.of(...) since profile expressions are not supported
				// in XML config. See SPR-12458 for details.
				if (!getReaderContext().getEnvironment().acceptsProfiles(specifiedProfiles)) {
					if (logger.isDebugEnabled()) {
						logger.debug("Skipped XML bean definition file due to specified profiles [" + profileSpec +
								"] not matching: " + getReaderContext().getResource());
					}
					return;
				}
			}
		}
		// åç½®-é©å­æ¹æ³, é¢çæ©å±, è¿éæ¯ç©ºå®ç°
		preProcessXml(root);
		// çæ­£è§£æé»è¾
		parseBeanDefinitions(root, this.delegate);
		// åç½®-é©å­æ¹æ³, é¢çæ©å±, è¿éæ¯ç©ºå®ç°
		postProcessXml(root);

		this.delegate = parent;
	}
</code></pre>
<h4 id="è§£æé»è®¤å½åç©ºé´">è§£æé»è®¤å½åç©ºé´</h4>
<pre><code class="language-java">/**
	 * Parse the elements at the root level in the document:
	 * "import", "alias", "bean".
	 * @param root the DOM root element of the document
	 */
	protected void parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) {
		if (delegate.isDefaultNamespace(root)) {
			NodeList nl = root.getChildNodes();
			for (int i = 0; i &lt; nl.getLength(); i++) {
				Node node = nl.item(i);
				if (node instanceof Element ele) {//æ¯å¦ æ¯åç´ æ ç­¾
					/**
					 * å¤çé»è®¤å½åç©ºé´çæ ç­¾, æå¦ä¸åä¸ª
					 * &lt;import&gt;&lt;/import&gt;, &lt;alias&gt;&lt;/alias&gt;, &lt;bean&gt;&lt;/bean&gt;, &lt;beans&gt;&lt;/beans&gt;
					 *
					 */
					if (delegate.isDefaultNamespace(ele)) {
						parseDefaultElement(ele, delegate);
					}
					else {
						/**
						 * å¤ç éé»è®¤å½åç©ºé´çæ ç­¾;
						 * 	æ³¨æè¿éåæ¬ &lt;context:bean ...&gt; &lt;aop:xx ...&gt; &lt;tx:xx ...&gt; ç­ç­æææå®å½åç©ºé´çxmléç½®
						 */
						delegate.parseCustomElement(ele);
					}
				}
			}
		}
		else {
			delegate.parseCustomElement(root);
		}
	}
</code></pre>
<p><code>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#parseDefaultElement</code></p>
<pre><code class="language-java">/**
	 * é»è®¤å½åç©ºé´çå¤ç
	 * @param ele
	 * @param delegate
	 */
	private void parseDefaultElement(Element ele, BeanDefinitionParserDelegate delegate) {
		// é»è®¤å½åç©ºé´ç import åç´ å¤ç
		if (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) {
			importBeanDefinitionResource(ele);
		}
		// é»è®¤å½åç©ºé´ç alias åç´ å¤ç
		else if (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) {
			processAliasRegistration(ele);
		}
		// é»è®¤å½åç©ºé´ç bean åç´ å¤ç
		else if (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) {
			processBeanDefinition(ele, delegate);
		}
		// é»è®¤å½åç©ºé´ç beans åç´ å¤ç
		else if (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) {
			// recurse
			doRegisterBeanDefinitions(ele);
		}
	}
</code></pre>
<h4 id="è§£æèªå®ä¹æ ç­¾">è§£æèªå®ä¹æ ç­¾</h4>
<p><code>org.springframework.beans.factory.xml.BeanDefinitionParserDelegate#parseCustomElement(org.w3c.dom.Element, org.springframework.beans.factory.config.BeanDefinition)</code></p>
<pre><code class="language-java">	/**
	 * ä¸»è¦é»è¾æ¯ æ¿å°åç´ çå½åç©ºé´URI, åä» XmlReaderContext æ¾å°å¯¹åºç NamespaceHandler è°ç¨è§£æ `parse`æ¹æ³è§£æå° BeanDefinition è¿å
	 *  Parse a custom element (outside the default namespace).
	 * @param ele the element to parse
	 * @param containingBd the containing bean definition (if any)
	 * @return the resulting bean definition
	 */
	@Nullable
	public BeanDefinition parseCustomElement(Element ele, @Nullable BeanDefinition containingBd) {
		//æ¿å° å½åç©ºé´URI
		String namespaceUri = getNamespaceURI(ele);
		if (namespaceUri == null) {
			return null;
		}
		/**
		 * æ¿å°å¯¹åºå½åç©ºé´ç Handler , this.readerContext æ¯å¨
		 * @see org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions(org.w3c.dom.Document, org.springframework.core.io.Resource) åå»ºç
		 * 		å®ä¼ä»ç¶å±æ§ç namespaceHandlerResolver ä¸­æ¿å°å½åç©ºé´å¤çå¨, è°ç¨NamespaceHandler#parse è¿è¡è§£æ
		 * 		å®é»è®¤è¯»åçéç½®æ¯ `META-INF/spring.handlers` æä»¶
		 *
		 * spring å¯¹äº æ³¨è§£ AOP TXäºå¡ çæ¯æ, åæ¯åä¸ªè¿ç§æ¹å¼æ©å±ç, ä½è¿äºä¸å±IOCåå®¹, æ¬ç¯ä¸ä½è¯´æ..
		 */
		NamespaceHandler handler = this.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);
		if (handler == null) {
			error("Unable to locate Spring NamespaceHandler for XML schema namespace [" + namespaceUri + "]", ele);
			return null;
		}
		// è°ç¨ Handler è§£æ, è¿åçæ¯ BeanDefinition;
		return handler.parse(ele, new ParserContext(this.readerContext, this, containingBd));
	}
</code></pre>
<h4 id="æ³¨å-beandefinition-å°-registry">æ³¨å BeanDefinition å° Registry</h4>
<p><code>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#processBeanDefinition</code></p>
<pre><code class="language-java">/**
	 * Process the given bean element, parsing the bean definition
	 * and registering it with the registry.
	 *
	 * - å¤çbeanåç´ ï¼è§£æ BeanDefinition å¹¶å°å¶æ³¨åå°æ³¨åä¸­å¿ã
	 * - å¶å®å°±æ¯å¾ DefaultListableBeanFactory çè¿ä¸¤ä¸ªéåå±æ§æ·»å :
	 * 		1. è¿ä¸ªlist å­å¨ææç bean definition åç§° {@link org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionNames}
	 * 		2. è¿ä¸ªmapå­å¨ææçBeanDefinition, keyæ¯beanä¸»name, valueæ¯BeanDefinition {@link org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionMap}
	 */
	protected void processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate) {
		/**
		 * å¯¹äº BeanDefinitionHolder å¶å®å®å°±æ¯ä¸ä¸ªDTOå¯¹è±¡, å®åå«ä»¥ä¸å±æ§:
		 * 	private final BeanDefinition beanDefinition;//Bean  beanDefinition
		 * 	private final String beanName; 				//Bean åç§°
		 *  private final String[] aliases;				//Bean å«ååè¡¨
		 *
		 */
		BeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele);

		// æ­¤æ¶, å°±å®æäº å¯¹ BeanDefinition è§£æäº
		if (bdHolder != null) {
			/**
			 * è£é¥° BeanDefinitionï¼å¦æéè¦ï¼, ç±»ä¼¼äº:
			 * 		&lt;bean id="user" class=".."&gt;
			 *  		&lt;myBean:user username="è¿æ¯ Spring"/&gt;
			 * 		&lt;/bean&gt;
			 *  å¯¹åº`myBean:user` è¿ç§èªå®ä¹æ ç­¾è¿è¡å¤ç;
			 *  åé¢ä¼æ¾å°å¯¹åºçå½åç©ºé´ Handler (NamespaceHandler) è¿è¡å¤ç : NamespaceHandler handler = this.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);
			 */
			bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder);
			try {
				/**
				 * æ³¨åå° Registry
				 */
				// Register the final decorated instance.
				BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());
			}
			catch (BeanDefinitionStoreException ex) {
				getReaderContext().error("Failed to register bean definition with name '" +
						bdHolder.getBeanName() + "'", ele, ex);
			}
			// Send registration event.
			getReaderContext().fireComponentRegistered(new BeanComponentDefinition(bdHolder));
		}
	}
</code></pre>
<p><code>org.springframework.beans.factory.support.BeanDefinitionReaderUtils#registerBeanDefinition</code></p>
<pre><code class="language-java">/**
	 * Register the given bean definition with the given bean factory.
	 * @param definitionHolder the bean definition including name and aliases
	 * @param registry the bean factory to register with
	 * @throws BeanDefinitionStoreException if registration failed
	 */
	public static void registerBeanDefinition(
			BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry)
			throws BeanDefinitionStoreException {

		// Register bean definition under primary name.
		/**
		 * ä»¥ beanName å Register æ³¨å
		 * å¶å®å°±æ¯å¾ DefaultListableBeanFactory çè¿ä¸¤ä¸ªéåå±æ§æ·»å :
		 * 1. è¿ä¸ªlist å­å¨ææç bean definition åç§° {@link org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionNames}
		 * 2. è¿ä¸ªmapå­å¨ææçBeanDefinition, keyæ¯beanä¸»name, valueæ¯BeanDefinition {@link org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionMap}
		 */
		String beanName = definitionHolder.getBeanName();
		registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition());

		/**
		 * å Register æ³¨åå«ååè¡¨
		 * å¶å®å°±æ¯ {@link org.springframework.core.SimpleAliasRegistry#aliasMap}
		 * å¨è¿ä¸ª mapå­å¨bean çå«å, keyæ¯å«å, value æ¯beanä¸»name;
		 */
		// Register aliases for bean name, if any.
		String[] aliases = definitionHolder.getAliases();
		if (aliases != null) {
			for (String alias : aliases) {
				registry.registerAlias(beanName, alias);
			}
		}
	}
</code></pre>
<p>è³æ­¤, BeanDefinition ç®æ¯æåè§£æ, å¹¶æ³¨åå° Register ä¸­äº</p>
<h3 id="æ»ç»-2">æ»ç»</h3>
<ol>
<li>éæ¯ä¹åç beanFactory (å¦ææçè¯)</li>
<li>å®ä¾å/åå»º beanFactory, è¿éæ¯å®ä¾ç±»æ¯ <code>DefaultListableBeanFactory</code></li>
<li>è®¾ç½® beanFactory å¿½ç¥  BeanNameAware, BeanClassLoaderAware, BeanFactoryAwareè¿ä¸ä¸ªAwareçæ¥å£ {@link AbstractAutowireCapableBeanFactory#AbstractAutowireCapableBeanFactory()}<br>
å ä¸ºå¨åå§åBeanæ¶, ä¼ç´æ¥è°ç¨å®ä»¬(èä¸æ¯éè¿éè¿ BeanPostProcessoræ©å±çAwareæºå¶è°ç¨)</li>
<li>è®¾ç½® beanFactory åºååID, åç§°</li>
<li>æ©å±ç¹, å®å¶åè¿ä¸ª BeanFactory ä¾å¦: æ¯å¦åè®¸ BeanDefinition è¦ç; æ¯å¦èªå¨å¤çå¾ªç¯ä¾èµ;</li>
<li>åå»º(XMLè§£æå¨/è¯»åå¨) XmlBeanDefinitionReader, å¹¶åå§å; çä¸æ©å±ç¹, æ©å±Reader ä¾å¦ æ¯å¦éªè¯xmlç­</li>
<li>åå»ºç¸å³å¯¹è±¡DocumentLoader, BeanDefinitionDocumentReader,BeanDefinitionParserDelegate {@link org.springframework.beans.factory.xml.XmlBeanDefinitionReader#registerBeanDefinitions(org.w3c.dom.Document, org.springframework.core.io.Resource)}<br>
{@link DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions(Element)}<br>
å è½½/è§£æ XMLæ ç­¾/åç´ /å±æ§ç­å°å¶å°è£ä¸º ä¸ä¸ªä¸ª BeanDefinition å¯¹è±¡</li>
<li>å° BeanDefinitions æ³¨åå° registry</li>
</ol>
<h2 id="ä¸-beanfactoryé¢åå¤å·¥ä½">ä¸. (BeanFactory)é¢åå¤å·¥ä½</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#prepareBeanFactory</code></p>
<pre><code class="language-java">	/**
	 * Configure the factory's standard context characteristics,
	 * such as the context's ClassLoader and post-processors.
	 * @param beanFactory the BeanFactory to configure
	 */
	protected void prepareBeanFactory(ConfigurableListableBeanFactory beanFactory) {
		// Tell the internal bean factory to use the context's class loader etc.
		/**
		 * ä¸º beanFactory è®¾ç½® bean çç±»å è½½å¨
		 */
		beanFactory.setBeanClassLoader(getClassLoader());
		/**
		 * ä¸º beanFactory è®¾ç½® bean çè¡¨è¾¾å¼(Spring EL)è§£æå¨
		 * é»è®¤é£æ ¼æ¯: `#{var}`  å½ç¶è¿äº åç¼ åç¼é½æ¯å¯ä»¥èªå®ä¹
		 * å³äº (Spring EL)è§£æå¨: StandardBeanExpressionResolver çè®¾è®¡æ¯ç»åä¼äºç»§æ¿, åé¨æä¸¤ä¸ª SpelExpressionParser(çæ­£è§£æç) SpelParserConfiguration(éç½®ç±»)
		 */
		beanFactory.setBeanExpressionResolver(new StandardBeanExpressionResolver(beanFactory.getBeanClassLoader()));

		/**
		 *  ä¸º beanFactory è®¾ç½® PropertyEditorRegistrar
		 *  è¿ä¸ªä¸»è¦ä¸º Bean è®¾ç½®å±æ§çç®¡çç±», æ¯å¦, æ¥æç±»åçæ°æ®: å¯ä»¥æ¯ç¹å®æ ¼å¼çå­ç¬¦ä¸², æ°å­, è¿å¯ä»¥æ¯æ¶é´æ³...
		 *  Spring ä¸º bean å¡«åå±æ§, ä½¿ç¨ BeanWrapperImpl åè£äºä¸ä¸(è£é¥°æ¨¡å¼)
		 *  BeanWrapperImpl å®ç°äº PropertyEditorRegistry, å¯ä»¥å¾éé¢æ³¨å PropertyEditor, å¯ä»¥èªå®ä¹å±æ§çè½¬æ¢, ç¼è¾é»è¾
		 */
		beanFactory.addPropertyEditorRegistrar(new ResourceEditorRegistrar(this, getEnvironment()));

		/**
		 * æ·»å ä¸ä¸ª BeanPostProcessor åè°, ä½ç¨æ¯å¦æBeanå®ç°è¿äºæ¥å£:
		 * (bean instanceof EnvironmentAware || bean instanceof EmbeddedValueResolverAware ||
		 * 				bean instanceof ResourceLoaderAware || bean instanceof ApplicationEventPublisherAware ||
		 * 				bean instanceof MessageSourceAware || bean instanceof ApplicationContextAware ||
		 * 				bean instanceof ApplicationStartupAware)
		 *  å®è´è´£è°ç¨å¶å¯¹åº Aware çæ¹æ³, ç»Bean æ³¨å¥å¯¹è±¡
		 *
		 * in short å°±æ¯ç» bean è®¾ç½® ä¸ä¸æ, åç½®çå¯¹è±¡; æ³¨ææ¯ (postProcessBeforeInitialization)
		 */
		// Configure the bean factory with context callbacks.
		beanFactory.addBeanPostProcessor(new ApplicationContextAwareProcessor(this));

		/**
		 * å ä¸ºä¸é¢ç± ApplicationContextAwareProcessor è´è´£æ³¨å¥ 7ä¸ªæ¥å£
		 * è¿éå°±å¿½ç¥æè¿7ä¸ªæ¥å£çèªå¨æ³¨å¥
		 * 		EnvironmentAware.class, EmbeddedValueResolverAware.class, ResourceLoaderAware.class,
		 * 		ApplicationEventPublisherAware.class, MessageSourceAware.class, ApplicationContextAware.class, ApplicationStartupAware.class
		 */
		beanFactory.ignoreDependencyInterface(EnvironmentAware.class);
		beanFactory.ignoreDependencyInterface(EmbeddedValueResolverAware.class);
		beanFactory.ignoreDependencyInterface(ResourceLoaderAware.class);
		beanFactory.ignoreDependencyInterface(ApplicationEventPublisherAware.class);
		beanFactory.ignoreDependencyInterface(MessageSourceAware.class);
		beanFactory.ignoreDependencyInterface(ApplicationContextAware.class);
		beanFactory.ignoreDependencyInterface(ApplicationStartupAware.class);

		/**
		 * ç±»ä¼¼ @Primary, å½æå¤ä¸ªçç¸åç±»åçæ¶å, æå®è°ä¼åæ³¨å¥
		 * æå®åç½®ç BeanFactory,ResourceLoader,ApplicationEventPublisher,ApplicationContext
		 *  å ä¸ªBeanå¯¹è±¡,  èªå¨æ³¨å¥ç Primary
		 * registerResolvableDependency
		 */
		// BeanFactory interface not registered as resolvable type in a plain factory.
		// MessageSource registered (and found for autowiring) as a bean.
		beanFactory.registerResolvableDependency(BeanFactory.class, beanFactory);
		beanFactory.registerResolvableDependency(ResourceLoader.class, this);
		beanFactory.registerResolvableDependency(ApplicationEventPublisher.class, this);
		beanFactory.registerResolvableDependency(ApplicationContext.class, this);

		// Register early post-processor for detecting inner beans as ApplicationListeners.
		/**
		 * TODO æ¶é´çå¬å¨ç¸å³
		 */
		beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(this));

		/**
		 * TODO  è¿éæ¯ AOP AspectJå¤ç
		 * LoadTimeWeaver (AOPçå è½½æ¶ç»å¥)
		 */
		// Detect a LoadTimeWeaver and prepare for weaving, if found.
		if (!NativeDetector.inNativeImage() &amp;&amp; beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) {
			beanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory));
			// Set a temporary ClassLoader for type matching.
			beanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));
		}

		/**
		 * beanFactory ä¸­å¦ææ²¡æä»¥ä¸è¿äºåç§°ç bean å ç´æ¥ç» BeanFactory çä¸çº§ç¼å­, æ³¨åå ä¸ªé»è®¤ç¯å¢ Bean
		 */
		// Register default environment beans.
		if (!beanFactory.containsLocalBean(ENVIRONMENT_BEAN_NAME)) {
			beanFactory.registerSingleton(ENVIRONMENT_BEAN_NAME, getEnvironment());
		}
		if (!beanFactory.containsLocalBean(SYSTEM_PROPERTIES_BEAN_NAME)) {
			beanFactory.registerSingleton(SYSTEM_PROPERTIES_BEAN_NAME, getEnvironment().getSystemProperties());
		}
		if (!beanFactory.containsLocalBean(SYSTEM_ENVIRONMENT_BEAN_NAME)) {
			beanFactory.registerSingleton(SYSTEM_ENVIRONMENT_BEAN_NAME, getEnvironment().getSystemEnvironment());
		}
		if (!beanFactory.containsLocalBean(APPLICATION_STARTUP_BEAN_NAME)) {
			beanFactory.registerSingleton(APPLICATION_STARTUP_BEAN_NAME, getApplicationStartup());
		}
	}
</code></pre>
<h3 id="æ»ç»-3">æ»ç»</h3>
<p>{@link AbstractApplicationContext#prepareBeanFactory(ConfigurableListableBeanFactory)}</p>
<ol>
<li>ä¸º beanFactory è®¾ç½® bean çç±»å è½½å¨</li>
<li>ä¸º beanFactory è®¾ç½® bean ç StandardBeanExpressionResolver (è¡¨è¾¾å¼(Spring EL)è§£æå¨) {@link ConfigurableBeanFactory#setBeanExpressionResolver(BeanExpressionResolver)}<br>
å³äº (Spring EL)è§£æå¨: StandardBeanExpressionResolver çè®¾è®¡æ¯ç»åä¼äºç»§æ¿, åé¨æä¸¤ä¸ª SpelExpressionParser(çæ­£è§£æç) SpelParserConfiguration(éç½®ç±»)</li>
<li>ä¸º beanFactory è®¾ç½® PropertyEditorRegistrar (ä¸»è¦ä¸º Bean è®¾ç½®å±æ§çç®¡çç±»){@link ConfigurableBeanFactory#addPropertyEditorRegistrar(PropertyEditorRegistrar)}<br>
PropertyEditorRegistrar è¿ä¸ªä¸»è¦ä¸º Bean è®¾ç½®å±æ§çç®¡çç±», æ¯å¦, æ¥æç±»åçæ°æ®: å¯ä»¥æ¯ç¹å®æ ¼å¼çå­ç¬¦ä¸², æ°å­, è¿å¯ä»¥æ¯æ¶é´æ³...<br>
Spring ä¸º bean å¡«åå±æ§, ä½¿ç¨ BeanWrapperImpl åè£äºä¸ä¸(è£é¥°æ¨¡å¼)<br>
BeanWrapperImpl å®ç°äº PropertyEditorRegistry, å¯ä»¥å¾éé¢æ³¨å PropertyEditor, å¯ä»¥èªå®ä¹å±æ§çè½¬æ¢, ç¼è¾é»è¾</li>
<li>ç» beanFactory æ·»å ä¸ä¸ª å¤çAwareç BeanPostProcessor (ApplicationContextAwareProcessor) å¹¶å¿½ç¥æè¿7ä¸ªæ¥å£çèªå¨æ³¨å¥:{@link ConfigurableBeanFactory#addBeanPostProcessor(BeanPostProcessor)}<br>
EnvironmentAware.class, EmbeddedValueResolverAware.class, ResourceLoaderAware.class, ApplicationEventPublisherAware.class, MessageSourceAware.class, ApplicationContextAware.class, ApplicationStartupAware.class</li>
<li>æå®åç½®ç BeanFactory,ResourceLoader,ApplicationEventPublisher,ApplicationContext {@link ConfigurableListableBeanFactory#registerResolvableDependency(Class, Object)}<br>
è¿å ä¸ªBeanå¯¹è±¡,  èªå¨æ³¨å¥ç Primary</li>
<li>ç» beanFactory æ·»å ä¸ä¸ª BeanPostProcessor (ApplicationListenerDetector)TODO (äºä»¶çå¬ç¸å³)</li>
<li>ç» beanFactory æ·»å ä¸ä¸ª BeanPostProcessor(LoadTimeWeaverAwareProcessor) TODO (AOP AspectJ ç»å¥å¤çç¸å³ç)</li>
<li>beanFactoryä¸­å¦ææ²¡æä»¥ä¸åç§°çbean, åç´æ¥ç» BeanFactory çä¸çº§ç¼å­, æ³¨åå ä¸ªç¯å¢å¯¹è±¡ Bean {@link SingletonBeanRegistry#registerSingleton(String, Object)}<br>
åç§°å¸¸éåå«æ¯:<br>
org.springframework.context.ConfigurableApplicationContext#ENVIRONMENT_BEAN_NAME<br>
org.springframework.context.ConfigurableApplicationContext#SYSTEM_PROPERTIES_BEAN_NAME<br>
org.springframework.context.ConfigurableApplicationContext#SYSTEM_ENVIRONMENT_BEAN_NAME<br>
org.springframework.context.ConfigurableApplicationContext#APPLICATION_STARTUP_BEAN_NAME</li>
</ol>
<h2 id="å-postprocessbeanfactory-æ©å±ç¹è°ç¨">å. postProcessBeanFactory æ©å±ç¹è°ç¨</h2>
<p>beanFactory å·²ç»åå¤å¥½äº, ç»å­ç±»(Context)é¢çä¸ä¸ªæ©å±ç¹;</p>
<p><code>org.springframework.context.support.AbstractApplicationContext#postProcessBeanFactory</code> (è¿éæ¯ç©ºå®ç°)</p>
<pre><code class="language-java">/**
 * Modify the application context's internal bean factory after its standard
 * initialization. The initial definition resources will have been loaded but no
 * post-processors will have run and no derived bean definitions will have been
 * registered, and most importantly, no beans will have been instantiated yet.
 * &lt;p&gt;This template method allows for registering special BeanPostProcessors
 * etc in certain AbstractApplicationContext subclasses.
 * @param beanFactory the bean factory used by the application context
 */
protected void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {
}
</code></pre>
<h2 id="äº-è°ç¨-beanfactorypostprocessor-å¤çå¨">äº. è°ç¨ BeanFactoryPostProcessor å¤çå¨</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#invokeBeanFactoryPostProcessors</code></p>
<pre><code class="language-java">/**
	 * Instantiate and invoke all registered BeanFactoryPostProcessor beans,
	 * respecting explicit order if given.
	 * &lt;p&gt;Must be called before singleton instantiation.
	 */
	protected void invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory beanFactory) {
		/**
		 * è°ç¨ BeanFactory åçææ BeanFactoryPostProcessor å BeanDefinitionRegistryPostProcessor
		 */
		PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());

		/**
		 * LOAD_TIME_WEAVER_BEAN_NAME bean æ¯AOPç¸å³ç.
		 * å¨ GraalVM ä¸­è½ç¼è¯ä¸ºæ¬å°ä»£ç , ä¸æ¯æAOPç
		 */
		// Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime
		// (e.g. through an @Bean method registered by ConfigurationClassPostProcessor)
		if (!NativeDetector.inNativeImage() &amp;&amp; beanFactory.getTempClassLoader() == null &amp;&amp;
				beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) {//è¿é beanFactory ä¸åå« LOAD_TIME_WEAVER_BEAN_NAME
			beanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory));
			beanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));
		}
	}
</code></pre>
<p><code>org.springframework.context.support.PostProcessorRegistrationDelegate#invokeBeanFactoryPostProcessors(org.springframework.beans.factory.config.ConfigurableListableBeanFactory, java.util.List&lt;org.springframework.beans.factory.config.BeanFactoryPostProcessor&gt;)</code></p>
<pre><code class="language-java">	/**
	 * æ³¨æä¸ç¹ BeanDefinitionRegistryPostProcessor æ¯ç»§æ¿èª BeanFactoryPostProcessorç
	 * æ»çæ¥è¯´, è°ç¨çæ¶åä¼åçº§æ¯:
	 * 1. è°ç¨æ¥å£çä¼åçº§
	 * ä¼åè°ç¨(å­ç±») BeanDefinitionRegistryPostProcessor
	 * åè°ç¨(ç¶ç±») BeanFactoryPostProcessor
	 *
	 * 2. è°ç¨æ·»å çæ¹å¼çä¼åçº§
	 * ä¼åè°ç¨å¤é¨å¥åç±», å³ç´æ¥éè¿ {@link AbstractApplicationContext#addBeanFactoryPostProcessor(org.springframework.beans.factory.config.BeanFactoryPostProcessor)} ä»£ç æ·»å ç
	 * åè°ç¨å®¹å¨ä¸­ å®ç° BeanFactoryPostProcessoræè BeanDefinitionRegistryPostProcessor ç Bean
	 */
	public static void invokeBeanFactoryPostProcessors(
			ConfigurableListableBeanFactory beanFactory, List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors) {

		// WARNING: Although it may appear that the body of this method can be easily
		// refactored to avoid the use of multiple loops and multiple lists, the use
		// of multiple lists and multiple passes over the names of processors is
		// intentional. We must ensure that we honor the contracts for PriorityOrdered
		// and Ordered processors. Specifically, we must NOT cause processors to be
		// instantiated (via getBean() invocations) or registered in the ApplicationContext
		// in the wrong order.
		//
		// Before submitting a pull request (PR) to change this method, please review the
		// list of all declined PRs involving changes to PostProcessorRegistrationDelegate
		// to ensure that your proposal does not result in a breaking change:
		// https://github.com/spring-projects/spring-framework/issues?q=PostProcessorRegistrationDelegate+is%3Aclosed+label%3A%22status%3A+declined%22

		// Invoke BeanDefinitionRegistryPostProcessors first, if any.
		/**
		 * å­å¨å·²ç»è°ç¨ BeanDefinitionRegistryPostProcessor è¿ç bean name
		 * é¿åéå¤å¤ç
		 */
		Set&lt;String&gt; processedBeans = new HashSet&lt;&gt;();

		if (beanFactory instanceof BeanDefinitionRegistry registry) {

			/**
			 * å­å¨ BeanFactoryPostProcessor çéå, åé¢ç»ä¸è°ç¨
			 */
			List&lt;BeanFactoryPostProcessor&gt; regularPostProcessors = new ArrayList&lt;&gt;();

			/**
			 * å­å¨å·²ç»è°ç¨è¿ç BeanDefinitionRegistryPostProcessor éå
			 */
			List&lt;BeanDefinitionRegistryPostProcessor&gt; registryProcessors = new ArrayList&lt;&gt;();

			/**
			 * åè°ç¨å¤é¨å¥åç BeanDefinitionRegistryPostProcessor (ä»£ç æ·»å ç)
			 */
			for (BeanFactoryPostProcessor postProcessor : beanFactoryPostProcessors) {
				if (postProcessor instanceof BeanDefinitionRegistryPostProcessor registryProcessor) {
					// è¿å°±è°äº
					registryProcessor.postProcessBeanDefinitionRegistry(registry);
					// æ¯ BeanDefinitionRegistryPostProcessor æ¥å£ å­å¥registryProcessors
					registryProcessors.add(registryProcessor);
				}
				else {
					// ä¸æ¯ BDRPP  æ¯ BeanFactoryPostProcessor(BFPP) å­å¥regularPostProcessors, åé¢å¨ç»ä¸è°ç¨
					regularPostProcessors.add(postProcessor);
				}
			}

			// Do not initialize FactoryBeans here: We need to leave all regular beans
			// uninitialized to let the bean factory post-processors apply to them!
			// Separate between BeanDefinitionRegistryPostProcessors that implement
			// PriorityOrdered, Ordered, and the rest.
			/**
			 * å½åå°è°ç¨ç BeanDefinitionRegistryPostProcessor éå
			 */
			List&lt;BeanDefinitionRegistryPostProcessor&gt; currentRegistryProcessors = new ArrayList&lt;&gt;();

			// First, invoke the BeanDefinitionRegistryPostProcessors that implement PriorityOrdered.
			// 1. åè°ç¨ å®ç°PriorityOrdered (æåº)ç BDRPP
			String[] postProcessorNames =
					beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);
			for (String ppName : postProcessorNames) {
				if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) {
					//&lt;!&gt; beanFactory.getBean, åèµ°å®ä¾åbeanæµç¨;
					currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));
					processedBeans.add(ppName);
				}
			}
			//æåº
			sortPostProcessors(currentRegistryProcessors, beanFactory);
			registryProcessors.addAll(currentRegistryProcessors);
			//è°ç¨ BDRPP
			invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());
			//è°å®äºå°±æ¸è°
			currentRegistryProcessors.clear();

			// Next, invoke the BeanDefinitionRegistryPostProcessors that implement Ordered.
			// 2. åè°ç¨ å®ç° Ordered (æåº)ç BDRPP
			postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);
			for (String ppName : postProcessorNames) {
				if (!processedBeans.contains(ppName) &amp;&amp; beanFactory.isTypeMatch(ppName, Ordered.class)) {
					currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));
					processedBeans.add(ppName);
				}
			}
			sortPostProcessors(currentRegistryProcessors, beanFactory);
			registryProcessors.addAll(currentRegistryProcessors);
			invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());
			currentRegistryProcessors.clear();

			// Finally, invoke all other BeanDefinitionRegistryPostProcessors until no further ones appear.
			// 3. åè°ç¨å¨å®¹å¨ä¸­å®ç° BeanDefinitionRegistryPostProcessors (BDRPP)ç
			boolean reiterate = true;
			while (reiterate) {
				reiterate = false;
				postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false);
				for (String ppName : postProcessorNames) {
					if (!processedBeans.contains(ppName)) {
						currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));
						processedBeans.add(ppName);
						reiterate = true;
					}
				}
				sortPostProcessors(currentRegistryProcessors, beanFactory);
				registryProcessors.addAll(currentRegistryProcessors);
				invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());
				currentRegistryProcessors.clear();
			}
			// Now, invoke the postProcessBeanFactory callback of all processors handled so far.
			invokeBeanFactoryPostProcessors(registryProcessors, beanFactory);
			// 3. æååè°ç¨BeanFactoryPostProcessor(BFPP)
			invokeBeanFactoryPostProcessors(regularPostProcessors, beanFactory);
		}

		else {
			// Invoke factory processors registered with the context instance.
			invokeBeanFactoryPostProcessors(beanFactoryPostProcessors, beanFactory);
		}

		// Do not initialize FactoryBeans here: We need to leave all regular beans
		// uninitialized to let the bean factory post-processors apply to them!
		String[] postProcessorNames =
				beanFactory.getBeanNamesForType(BeanFactoryPostProcessor.class, true, false);

		// Separate between BeanFactoryPostProcessors that implement PriorityOrdered,
		// Ordered, and the rest.
		List&lt;BeanFactoryPostProcessor&gt; priorityOrderedPostProcessors = new ArrayList&lt;&gt;();
		List&lt;String&gt; orderedPostProcessorNames = new ArrayList&lt;&gt;();
		List&lt;String&gt; nonOrderedPostProcessorNames = new ArrayList&lt;&gt;();
		for (String ppName : postProcessorNames) {
			if (processedBeans.contains(ppName)) {
				// skip - already processed in first phase above
			}
			else if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) {
				priorityOrderedPostProcessors.add(beanFactory.getBean(ppName, BeanFactoryPostProcessor.class));
			}
			else if (beanFactory.isTypeMatch(ppName, Ordered.class)) {
				orderedPostProcessorNames.add(ppName);
			}
			else {
				nonOrderedPostProcessorNames.add(ppName);
			}
		}

		// First, invoke the BeanFactoryPostProcessors that implement PriorityOrdered.
		sortPostProcessors(priorityOrderedPostProcessors, beanFactory);
		invokeBeanFactoryPostProcessors(priorityOrderedPostProcessors, beanFactory);

		// Next, invoke the BeanFactoryPostProcessors that implement Ordered.
		List&lt;BeanFactoryPostProcessor&gt; orderedPostProcessors = new ArrayList&lt;&gt;(orderedPostProcessorNames.size());
		for (String postProcessorName : orderedPostProcessorNames) {
			orderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));
		}
		sortPostProcessors(orderedPostProcessors, beanFactory);
		invokeBeanFactoryPostProcessors(orderedPostProcessors, beanFactory);

		// Finally, invoke all other BeanFactoryPostProcessors.
		List&lt;BeanFactoryPostProcessor&gt; nonOrderedPostProcessors = new ArrayList&lt;&gt;(nonOrderedPostProcessorNames.size());
		for (String postProcessorName : nonOrderedPostProcessorNames) {
			nonOrderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));
		}
		invokeBeanFactoryPostProcessors(nonOrderedPostProcessors, beanFactory);

		// Clear cached merged bean definitions since the post-processors might have
		// modified the original metadata, e.g. replacing placeholders in values...
		beanFactory.clearMetadataCache();
	}
</code></pre>
<h3 id="æ»ç»-4">æ»ç»</h3>
<p>è¥æ¯æ³¨åçbean definition å®ç°äºè¿ä¸¤ä¸ªæ¥å£, åä¼è°ç¨(getBean)å®ä¾åå®, åè°ç¨ç¸åºçæ¥å£æ¹æ³;<br>
(æ³¨æä¸ä¸ BeanDefinitionRegistryPostProcessor æ¯ç»§æ¿èª BeanFactoryPostProcessorç)<br>
æ»çæ¥è¯´ è°ç¨çä¼åçº§æ¯:</p>
<ol>
<li>è°ç¨æ¥å£çä¼åçº§:
<ol>
<li>ä¼åè°ç¨(å­ç±») BeanDefinitionRegistryPostProcessor</li>
<li>åè°ç¨(ç¶ç±») BeanFactoryPostProcessor</li>
</ol>
</li>
<li>è°ç¨æ·»å çæ¹å¼çä¼åçº§:
<ol>
<li>ä¼åè°ç¨å¤é¨å¥å, å³ç´æ¥éè¿{@link AbstractApplicationContext#addBeanFactoryPostProcessor(org.springframework.beans.factory.config.BeanFactoryPostProcessor)} ä»£ç æ·»å ç</li>
<li>åè°ç¨å®¹å¨ä¸­å®ç° BeanFactoryPostProcessor æè BeanDefinitionRegistryPostProcessor ç Bean<br>
è§:</li>
</ol>
</li>
</ol>
<blockquote>
<p>å¼å¾ä¸æçæ¯:  Spring å¯¹äºæ¯æ SPELè¡¨è¾¾å¼, å°±æ¯éè¿ <code>PropertySourcesPlaceholderConfigurer</code> è¿ç§æ¹å¼æ©å±å®ç°ç</p>
</blockquote>
<h2 id="å­-æ³¨å-beanpostprocessor-bppå¤çå¨">å­. æ³¨å BeanPostProcessor (BPP)å¤çå¨</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#registerBeanPostProcessors</code><br>
<code>org.springframework.context.support.PostProcessorRegistrationDelegate#registerBeanPostProcessors(org.springframework.beans.factory.config.ConfigurableListableBeanFactory, org.springframework.context.support.AbstractApplicationContext)</code></p>
<pre><code class="language-java">/**
	 *  in short:
	 *  1. æ¿å°ææå®ç° BeanPostProcessor ç bean, ç¶åè¿è¡åç±»å­èµ·æ¥
	 *  è¿æä¸ç¹, Spring å¯¹ BeanDefinition åæä¸ç§è§è²:
	 *  	1. ç¨æ·å®ä¹ç Bean (ROLE_APPLICATION)
	 *      2. è¾å¤æç (ROLE_SUPPORT) è¾å¤æç? éå¸¸æ¯ä¸ä¸ªå¤é¨éç½®
	 *      3. Spring åç½®ç(ROLE_INFRASTRUCTURE)
	 *  2. å¦æå®ç°äº BeanPostProcessor åä¼å®ä¾åè¿ä¸ªbean, ä½æ³¨æè¿éåªæ¯æ³¨å,å¹¶ä¸ä¼è°ç¨BeanPostProcessorçç¸å³æ¹æ³
	 *
	 *  å¦å¤ BeanPostProcessor ç²ç²åº¦å¤ªå¤§, Spring è¿ç»åä¸äºå­æ¥å£:
	 *  - SmartInstantiationAwareBeanPostProcessor å®æä¾äºæ´é«çº§çBeanå®ä¾åæ§å¶æ¹æ³ãä¸»è¦ä½ç¨å¨äºåè®¸å¯¹Beançå®ä¾åè¿ç¨è¿è¡æ´ç²¾ç»çæ§å¶åå®å¶ã
	 *  - MergedBeanDefinitionPostProcessor å¨åå¹¶Beanå®ä¹ï¼MergedBeanDefinitionï¼ä¹åä½å¨å®ä¾åBeanä¹åï¼åè®¸å¯¹åå¹¶åçBeanå®ä¹è¿è¡ä¿®æ¹ãè°æ´æéå åæ°æ®ã
	 *  - DestructionAwareBeanPostProcessor å®åè®¸å¨Beanè¢«éæ¯ä¹åï¼ä¾å¦ï¼å®¹å¨å³é­æç¹å®ä½ç¨åçBeanéæ¯ï¼æ§è¡ä¸äºæä½ã
	 */
	public static void registerBeanPostProcessors(
			ConfigurableListableBeanFactory beanFactory, AbstractApplicationContext applicationContext) {

		// WARNING: Although it may appear that the body of this method can be easily
		// refactored to avoid the use of multiple loops and multiple lists, the use
		// of multiple lists and multiple passes over the names of processors is
		// intentional. We must ensure that we honor the contracts for PriorityOrdered
		// and Ordered processors. Specifically, we must NOT cause processors to be
		// instantiated (via getBean() invocations) or registered in the ApplicationContext
		// in the wrong order.
		//
		// Before submitting a pull request (PR) to change this method, please review the
		// list of all declined PRs involving changes to PostProcessorRegistrationDelegate
		// to ensure that your proposal does not result in a breaking change:
		// https://github.com/spring-projects/spring-framework/issues?q=PostProcessorRegistrationDelegate+is%3Aclosed+label%3A%22status%3A+declined%22
		/**
		 * æ¿å°ææå®ç° BeanPostProcessor ç beanåç§°
		 */
		String[] postProcessorNames = beanFactory.getBeanNamesForType(BeanPostProcessor.class, true, false);

		// Register BeanPostProcessorChecker that logs an info message when
		// a bean is created during BeanPostProcessor instantiation, i.e. when
		// a bean is not eligible for getting processed by all BeanPostProcessors.
		/**
		 * è®¡ç® BeanPostProcessor(BPP) çæ»æ°.
		 * +1 æ¯ä»ä¹æä½? åå æ¯: ä¸ä¸è¡,åå äºä¸ä¸ª BeanPostProcessorChecker
		 */
		int beanProcessorTargetCount = beanFactory.getBeanPostProcessorCount() + 1 + postProcessorNames.length;
		// BeanPostProcessorChecker è¿ä¸ªBeanPostProcessor, æ²¡å¥å®éä½ç¨, å°±æ¯è®°å½äºä¸äºæ¥å¿;
		beanFactory.addBeanPostProcessor(
				new BeanPostProcessorChecker(beanFactory, postProcessorNames, beanProcessorTargetCount));
		// Separate between BeanPostProcessors that implement PriorityOrdered,
		// Ordered, and the rest.
		/**
		 * å¯¹ BeanPostProcessor è¿è¡åç±»å­èµ·æ¥,  åè°ç¨, æ¯ä¸ªéååå«æ¯
		 * 1. priorityOrderedPostProcessors //æå®ç°(PriorityOrdered)æåºæ¥å£ç
		 * 2. internalPostProcessors //Springåé¨çbean, è§: Springå°beanåä¸ºä¸ç§è§è²
		 * 3. orderedPostProcessorNames //å®ç° Ordered æ¥å£
		 * 4. nonOrderedPostProcessorNames //æ²¡ææå®é¡ºåº, æ åºç
		 */
		List&lt;BeanPostProcessor&gt; priorityOrderedPostProcessors = new ArrayList&lt;&gt;();
		List&lt;BeanPostProcessor&gt; internalPostProcessors = new ArrayList&lt;&gt;();
		List&lt;String&gt; orderedPostProcessorNames = new ArrayList&lt;&gt;();
		List&lt;String&gt; nonOrderedPostProcessorNames = new ArrayList&lt;&gt;();
		for (String ppName : postProcessorNames) {
			if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) {
				/**
				 * æ³¨æ, è¥ bean å®ç°äº PriorityOrdered æ¥å£, åä¼ä¼åå®ä¾åå®;
				 */
				BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);
				priorityOrderedPostProcessors.add(pp);
				if (pp instanceof MergedBeanDefinitionPostProcessor) {
					internalPostProcessors.add(pp);
				}
			}
			else if (beanFactory.isTypeMatch(ppName, Ordered.class)) {
				orderedPostProcessorNames.add(ppName);
			}
			else {
				nonOrderedPostProcessorNames.add(ppName);
			}
		}

		// First, register the BeanPostProcessors that implement PriorityOrdered.
		sortPostProcessors(priorityOrderedPostProcessors, beanFactory);
		registerBeanPostProcessors(beanFactory, priorityOrderedPostProcessors);

		// Next, register the BeanPostProcessors that implement Ordered.
		List&lt;BeanPostProcessor&gt; orderedPostProcessors = new ArrayList&lt;&gt;(orderedPostProcessorNames.size());
		for (String ppName : orderedPostProcessorNames) {
			BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);
			orderedPostProcessors.add(pp);
			if (pp instanceof MergedBeanDefinitionPostProcessor) {
				internalPostProcessors.add(pp);
			}
		}
		sortPostProcessors(orderedPostProcessors, beanFactory);
		registerBeanPostProcessors(beanFactory, orderedPostProcessors);

		/**
		 * æ³¨åææå¸¸è§BeanPostProcessors
		 * è¿é getBean å®ä¾åbean !;
		 */
		// Now, register all regular(å¸¸è§) BeanPostProcessors.
		List&lt;BeanPostProcessor&gt; nonOrderedPostProcessors = new ArrayList&lt;&gt;(nonOrderedPostProcessorNames.size());
		for (String ppName : nonOrderedPostProcessorNames) {
			BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);
			nonOrderedPostProcessors.add(pp);
			if (pp instanceof MergedBeanDefinitionPostProcessor) {
				internalPostProcessors.add(pp);
			}
		}
		registerBeanPostProcessors(beanFactory, nonOrderedPostProcessors);

		/**
		 * æå, æ³¨åææ åç½® BeanPostProcessor
		 */
		// Finally, re-register all internal BeanPostProcessors.
		sortPostProcessors(internalPostProcessors, beanFactory);
		registerBeanPostProcessors(beanFactory, internalPostProcessors);

		//æååæ¾ä¸ä¸ª ApplicationListenerDetector è®©å®å¨æå (ä¸æ¯éç¹, è§ååºè¯¥æ¯äºä»¶ç¸å³ç)
		// Re-register post-processor for detecting inner beans as ApplicationListeners,
		// moving it to the end of the processor chain (for picking up proxies etc).
		beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(applicationContext));
	}
</code></pre>
<h3 id="æ»ç»-5">æ»ç»</h3>
<ol>
<li>æ¿å°ææ BeanPostProcessor ç±»åç bean</li>
<li>å®ä¾å BeanPostProcessor<br>
ä¼åå®ä¾å å®ç°äº PriorityOrdered æ¥å£ç, å¨å®ä¾åå¶å®ç(BPP)</li>
<li>è¿è¡åç±»å­å°éå {@link PostProcessorRegistrationDelegate#registerBeanPostProcessors(ConfigurableListableBeanFactory, AbstractApplicationContext)}<br>
å¯¹ BeanPostProcessor è¿è¡åç±»å­èµ·æ¥,  åè°ç¨, æ¯ä¸ªéååå«æ¯
<ol>
<li>priorityOrderedPostProcessors //æå®ç°(PriorityOrdered)æåºæ¥å£ç</li>
<li>internalPostProcessors //Springåé¨çbean, è§: Springå°beanåä¸ºä¸ç§è§è²</li>
<li>orderedPostProcessorNames //å®ç° Ordered æ¥å£</li>
<li>nonOrderedPostProcessorNames //æ²¡ææå®é¡ºåº, æ åºç<br>
è¿æä¸ç¹, Spring å¯¹ BeanDefinition åæä¸ç§è§è²:
<ul>
<li>ç¨æ·å®ä¹ç ä¸å¡ç¸å³ç Bean Bean (ROLE_APPLICATION)</li>
<li>è¾å¤æç (ROLE_SUPPORT) è¾å¤æç, æ¯æ AOPãäºå¡ç­åè½çåé¨å®ç°?  (ä¸éè¦, ä¸è¦æ¯ä¸ä¸ªç»èé½æ£...)</li>
<li>Spring åç½®ç(ROLE_INFRASTRUCTURE)</li>
</ul>
</li>
</ol>
</li>
<li>æåºå¹¶æ³¨åå° beanFactory
<ol>
<li>è¿éæå®ç°(PriorityOrdered)æåºæ¥å£çã@Orderedæ³¨è§£ç ç­æåºå­èµ·æ¥. å®éè°ç¨çé¡ºåº å¶å®å°±æ¯å­èµ·æ¥çé¡ºåº</li>
<li>å¦å¤ BeanPostProcessor æ¥å£ç²ç²åº¦å¤ªå¤§äº, Spring è¿ç»åä¸äºå­æ¥å£:
<ol>
<li>SmartInstantiationAwareBeanPostProcessor å®æä¾äºæ´é«çº§çBeanå®ä¾åæ§å¶æ¹æ³ãä¸»è¦ä½ç¨å¨äºåè®¸å¯¹Beançå®ä¾åè¿ç¨è¿è¡æ´ç²¾ç»çæ§å¶åå®å¶ã</li>
<li>MergedBeanDefinitionPostProcessor å¨åå¹¶Beanå®ä¹ï¼MergedBeanDefinitionï¼ä¹åä½å¨å®ä¾åBeanä¹åï¼åè®¸å¯¹åå¹¶åçBeanå®ä¹è¿è¡ä¿®æ¹ãè°æ´æéå åæ°æ®ã</li>
<li>DestructionAwareBeanPostProcessor å®åè®¸å¨Beanè¢«éæ¯ä¹åï¼ä¾å¦ï¼å®¹å¨å³é­æç¹å®ä½ç¨åçBeanéæ¯ï¼æ§è¡ä¸äºæä½ã<br>
ç­ç­ä»¥ä¸ä¹ä¼å­èµ·æ¥</li>
</ol>
</li>
</ol>
</li>
<li>æç»è°ç¨ BPPæ¯å¨ {@link AbstractApplicationContext#finishBeanFactoryInitialization(ConfigurableListableBeanFactory)} å®ä¾åå§åå¶ä»Beanè°ç¨</li>
</ol>
<h2 id="ä¸-åå§åå½éåi18n-ä¿¡æ¯æº">ä¸. åå§åå½éå(I18N) ä¿¡æ¯æº</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#initMessageSource</code></p>
<pre><code class="language-java">/**
	 * Initialize the MessageSource.
	 * Use parent's if none defined in this context.
	 * ä¸»è¦æ¯å¯¹I18Nå½éåçå¤çï¼
	 */
	protected void initMessageSource() {
		/**
		 * //æ¿å° bean factory
		 */
		ConfigurableListableBeanFactory beanFactory = getBeanFactory();
		/**
		 * æ¯å¦æå®ä¹åç§°ä¸º MESSAGE_SOURCE_BEAN_NAME ç Bean
		 *  {@link org.springframework.context.support.AbstractApplicationContext#MESSAGE_SOURCE_BEAN_NAME }
		 */
		if (beanFactory.containsLocalBean(MESSAGE_SOURCE_BEAN_NAME)) {
			this.messageSource = beanFactory.getBean(MESSAGE_SOURCE_BEAN_NAME, MessageSource.class);
			// Make MessageSource aware of parent MessageSource.
			if (this.parent != null &amp;&amp; this.messageSource instanceof HierarchicalMessageSource hms &amp;&amp;
					hms.getParentMessageSource() == null) {
				// Only set parent context as parent MessageSource if no parent MessageSource
				// registered already.
				/**
				 * å¦ææçè¯ï¼å°±ä½¿ç¨è¯¥å®ä¹çMessageSource å¤çæ¶æ¯å½éå
				 */
				hms.setParentMessageSource(getInternalParentMessageSource());
			}
			if (logger.isTraceEnabled()) {
				logger.trace("Using MessageSource [" + this.messageSource + "]");
			}
		}
		else {
			/**
			 *  å¦ææ²¡æ MESSAGE_SOURCE_BEAN_NAME åé»è®¤ä½¿ç¨ DelegatingMessageSource;
			 *  æ³¨åå° beanFactory
			 */
			// Use empty MessageSource to be able to accept getMessage calls.
			DelegatingMessageSource dms = new DelegatingMessageSource();
			dms.setParentMessageSource(getInternalParentMessageSource());
			//æ³¨æè¿ Contextå±æ§
			this.messageSource = dms;
			beanFactory.registerSingleton(MESSAGE_SOURCE_BEAN_NAME, this.messageSource);
			if (logger.isTraceEnabled()) {
				logger.trace("No '" + MESSAGE_SOURCE_BEAN_NAME + "' bean, using [" + this.messageSource + "]");
			}
		}
	}
</code></pre>
<h3 id="æ»ç»-6">æ»ç»</h3>
<p>å¾ç®å:</p>
<ol>
<li>å¦æbeanFactoryä¸­æåç§°ä¸º messageSource çBeanå®ä¹ï¼å°±ä½¿ç¨è¿beanä½ç©å½éåæ¶æ¯æº<br>
å¦ææ²¡æåé»è®¤ä½¿ç¨ org.springframework.context.support.DelegatingMessageSource å¹¶æ³¨åå° beanFactory</li>
</ol>
<p><s>ç¨äºå½éåç, ä¸éè¦, æ¬å±ä½ä¸ºç¤¾ä¼åºå±çé©¬, ææªåè¿è·¨å½é¡¹ç®</s></p>
<h2 id="å«-åå§åäºä»¶å¤æ­å¨">å«. åå§åäºä»¶å¤æ­å¨</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#initApplicationEventMulticaster</code></p>
<pre><code class="language-java">	/**
	 * Initialize the ApplicationEventMulticaster.
	 * Uses SimpleApplicationEventMulticaster if none defined in the context.
	 * @see org.springframework.context.event.SimpleApplicationEventMulticaster
	 */
	protected void initApplicationEventMulticaster() {
		ConfigurableListableBeanFactory beanFactory = getBeanFactory();
		/**
		 * 1. å¦æ beanFactory ä¸­åå«åç§°ä¸º APPLICATION_EVENT_MULTICASTER_BEAN_NAMEçbeanå®ä¹, åä½¿ç¨è¿ä¸ª ApplicationEventMulticaster ä½ä¸º äºä»¶å¤æ­å¨
		 * å¦æä¸åå«ååå»º SimpleApplicationEventMulticasterä½ä¸ºäºä»¶å¤æ­å¨;
		 */
		if (beanFactory.containsLocalBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME)) {
			this.applicationEventMulticaster =
					beanFactory.getBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, ApplicationEventMulticaster.class);
			if (logger.isTraceEnabled()) {
				logger.trace("Using ApplicationEventMulticaster [" + this.applicationEventMulticaster + "]");
			}
		}
		else {
			/**
			 * 2. åå»º SimpleApplicationEventMulticaster ä½ä¸ºé»è®¤çäºä»¶å¤æ­å¨ (Event Channel)
			 *  å¶å®å°±æ¯åå§åäºä¸ä¸ª ç¨äºå­æ¾/ç®¡ç ApplicationListener çå¬å¨(è§å¯è)çç±»
			 *   å¨Spring äºä»¶æºå¶ä¸­, å¨å®¹å¨åå¸äºä»¶æ¶ `this.applicationEventMulticaster.multicastEvent(new ObjectEvent());`
			 *  @see org.springframework.context.event.AbstractApplicationEventMulticaster#defaultRetriever ç¨æ·å­æ¾/ç®¡ç åä¸ªçå¬å¨ç(è§å¯è)
			 *  @see AbstractApplicationContext#publishEvent(Object, ResolvableType) è°ç¨å®¹å¨åå¸äºä»¶
			 *
			 *  è¿ä¸ª applicationEventMulticaster é¤äºå¨å®¹å¨åå¸äºä»¶æ¶ç¨å®, å¨æ³¨åçå¬å¨æ¶ç´æ¥ç¨å® {@link AbstractApplicationContext#registerListeners()}
			 */
			this.applicationEventMulticaster = new SimpleApplicationEventMulticaster(beanFactory);
			/**
			 * å°å¶æ³¨åå° beanFactory;
			 * æ³¨æ è¿æ¯å®ä¾, å®ç´æ¥æ¾å°ä¸çº§ç¼å­ä¸­.
			 */
			beanFactory.registerSingleton(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, this.applicationEventMulticaster);
			if (logger.isTraceEnabled()) {
				logger.trace("No '" + APPLICATION_EVENT_MULTICASTER_BEAN_NAME + "' bean, using " +
						"[" + this.applicationEventMulticaster.getClass().getSimpleName() + "]");
			}
		}
	}
</code></pre>
<h3 id="æ»ç»-7">æ»ç»</h3>
<ol>
<li>å¦æ beanFactory ä¸­åå«åç§°ä¸º applicationEventMulticaster çbeanå®ä¹, åä½¿ç¨è¿ä¸ªBeanä½ä¸ºäºä»¶å¤æ­å¨;<br>
å¦æä¸åå«ååå»º SimpleApplicationEventMulticasterä½ä¸ºäºä»¶å¤æ­å¨;</li>
<li>åå»ºSimpleApplicationEventMulticasterå¶å®å°±æ¯åå§åäºä¸ä¸ª,ç¨äºå­æ¾/ç®¡ç ApplicationListener çå¬å¨(è§å¯è)çç±», å¹¶æ³¨åå° beanFactory</li>
</ol>
<ul>
<li>ä¸»è¦æ¯ {@link org.springframework.context.event.AbstractApplicationEventMulticaster#defaultRetriever} ç¨äºå­æ¾/ç®¡ç åä¸ªçå¬å¨ç(è§å¯è)</li>
<li>{@link org.springframework.context.event.SimpleApplicationEventMulticaster#multicastEvent(org.springframework.context.ApplicationEvent, org.springframework.core.ResolvableType) }è°ç¨å®¹å¨åå¸äºä»¶</li>
</ul>
<p>åèæ­¤åçåå®¢ - <a href="https://www.cnblogs.com/dddy/p/19191523" title="åå¸äº 2025-11-04 22:25" target="_blank">Spring ä¸­çEventæºå¶</a></p>
<h2 id="ä¹-ç»å­ç±»contextçä¸ä¸ä¸ªæ©å±ç¹">ä¹. ç»å­ç±»(Context)çä¸ä¸ä¸ªæ©å±ç¹</h2>
<p>æ²¡ä»ä¹å¥½è¯´ç, è¿éæ¯ç©ºå®ç°</p>
<p><code>org.springframework.context.support.AbstractApplicationContext#onRefresh</code></p>
<pre><code class="language-java">/**
 * Template method which can be overridden to add context-specific refresh work.
 * Called on initialization of special beans, before instantiation of singletons.
 * &lt;p&gt;This implementation is empty.
 * @throws BeansException in case of errors
 * @see #refresh()
 */
protected void onRefresh() throws BeansException {
	// For subclasses: do nothing by default.
}
</code></pre>
<h2 id="å-åå¤æ­å¨æ³¨åçå¬å¨">å. åå¤æ­å¨æ³¨åçå¬å¨</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#registerListeners</code></p>
<pre><code class="language-java">/**
	 * Add beans that implement ApplicationListener as listeners.
	 * Doesn't affect other listeners, which can be added without being beans.
	 */
	protected void registerListeners() {
		/**
		 * 1. åå¤æ­å¨ä¸­æ³¨å å¨contextä¸­ççå¬å¨(è§å¯è)
		 */
		// Register statically specified listeners first.
		for (ApplicationListener&lt;?&gt; listener : getApplicationListeners()) {
			getApplicationEventMulticaster().addApplicationListener(listener);
		}

		// Do not initialize FactoryBeans here: We need to leave all regular beans
		// uninitialized to let post-processors apply to them!
		/**
		 *  2. åå¤æ­å¨ä¸­æ³¨å å¨beanFactoryä¸­çbeanæ¯çå¬å¨(ApplicationListener.class)ç(è§å¯è)
		 *  æ³¨æ:
		 *  2.1 è¿éæ¯ä¼åä» BeanFactory (getBeanNamesForType)è·åæ¯ ApplicationListener.class ç bean name
		 *  2.2 æ³¨æåªæ¯æ¥æ¾å¹éç±»åç bean åç§°, æ²¡æå®ä¾å å­çä¹æ¯ bean name;
		 */
		String[] listenerBeanNames = getBeanNamesForType(ApplicationListener.class, true, false);
		for (String listenerBeanName : listenerBeanNames) {
			getApplicationEventMulticaster().addApplicationListenerBean(listenerBeanName);
		}

		/**
		 * 3. å¹¿æ­ this.earlyApplicationEvents å±æ§ä¸­çäºä»¶;
		 * ä¸ºä»ä¹?
		 * å ä¸ºæå¯è½ å¨å®¹å¨çå½å¨æä¸­è°ç¨äºå½å `AbstractApplicationContext#publishEvent` åå¸äºä»¶, ä½æ¯å¤æ­å¨æ²¡æåå§åå®æ, æä»¥ä¼å°äºä»¶å­å¨this.earlyApplicationEvents ä¸­;
		 * å¾å®¹å¨åå§åå®æå, 	å¨æµç¨  {@link org.springframework.context.support.AbstractApplicationContext#registerListeners()} ä¸­ä¼åå¸å­å¨è¿éé¢çäºä»¶
		 * (ä¾å¦: å¨ BeanFactoryPostProcessor çä¸å¡é»è¾è§¦åå®¹å¨çå¹¿æ­äºä»¶, è¿æ¶åå¤æ­å¨é½ä¸å­å¨, ä¹ä¸ç¥éæåªäº beanä½ä¸ºè§å¯è)
		 * @see AbstractApplicationContext#prepareRefresh()
		 */
		// Publish early application events now that we finally have a multicaster...
		Set&lt;ApplicationEvent&gt; earlyEventsToProcess = this.earlyApplicationEvents;
		this.earlyApplicationEvents = null;//ä¸ä¸æ­¥ multicastEvent åå°±æ²¡ç¨äº, èµ null éæ¾èµæº.
		if (!CollectionUtils.isEmpty(earlyEventsToProcess)) {
			for (ApplicationEvent earlyEvent : earlyEventsToProcess) {
				getApplicationEventMulticaster().multicastEvent(earlyEvent);
			}
		}
	}
</code></pre>
<h3 id="æ»ç»-8">æ»ç»</h3>
<ol>
<li>åå¤æ­å¨ä¸­æ³¨å å¨contextä¸­ççå¬å¨(è§å¯è);</li>
<li>åå¤æ­å¨ä¸­æ³¨å å¨beanFactoryä¸­çbeanæ¯çå¬å¨(ApplicationListener.class)ç(è§å¯è)</li>
<li>å¹¿æ­ this.earlyApplicationEvents å±æ§ä¸­çäºä»¶;<br>
ä¸ºä»ä¹?
<ul>
<li>å ä¸ºæå¯è½ å¨å®¹å¨çå½å¨æä¸­è°ç¨äºå½å <code>AbstractApplicationContext#publishEvent</code> åå¸äºä»¶, ä½æ¯å¤æ­å¨æ²¡æåå§åå®æ, æä»¥ä¼å°äºä»¶å­å¨this.earlyApplicationEvents ä¸­;  è¿éå¤æ­å¨å·²ç»åå¤ ä¼åå¸å­å¨è¿éé¢çäºä»¶ (ä¾å¦: å¨ BeanFactoryPostProcessor çä¸å¡é»è¾è§¦åå®¹å¨çå¹¿æ­äºä»¶, è¿æ¶åå¤æ­å¨é½ä¸å­å¨)</li>
</ul>
<ul>
<li>@see AbstractApplicationContext#prepareRefresh()</li>
</ul>
</li>
</ol>
<h2 id="åä¸-å®ä¾åå©ä¸çææåä¾bean">åä¸. å®ä¾åå©ä¸çææåä¾bean</h2>
<h3 id="åå¤ç±»åè½¬æ¢å¨-åéè§£æå¨ç­">åå¤ç±»åè½¬æ¢å¨ åéè§£æå¨ç­</h3>
<p><code>org.springframework.context.support.AbstractApplicationContext#finishBeanFactoryInitialization</code></p>
<pre><code class="language-java">/**
	 * Finish the initialization of this context's bean factory,
	 * initializing all remaining singleton beans.
	 */
	protected void finishBeanFactoryInitialization(ConfigurableListableBeanFactory beanFactory) {
		// Initialize conversion service for this context.
		/**
		 *
		 * 1. ä¸º beanFactory åå§åç±»åè½¬æ¢å¨(ConversionService)
		 *   æ³¨æ: å¨ Spring ä¸­`ConversionService` æ¯ç¨äºç±»åè½¬æ¢çæå¡æ¥å£, å®æ¯è½¬æ¢ç±»åçå¥å£ç¹, ä½æ¯çæ­£çè½¬æ¢é»è¾åè½ åç± Converter å GenericConverter æ¥å£çå®ç°å¤çç
		 */
		if (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp;
				beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) {
			beanFactory.setConversionService(
					beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class));
		}

		// Register a default embedded value resolver if no BeanFactoryPostProcessor
		// (such as a PropertySourcesPlaceholderConfigurer bean) registered any before:
		// at this point, primarily for resolution in annotation attribute values.
		/**
		 * 2. å¦æ beanFactory ä¸ä¸æä¸­ä¸åå« "é»è®¤çåéè§£æå¨ (ç±»ä¼¼ PropertySourcesPlaceholderConfigurer) è§£æç±»ä¼¼ '${}' è¿æ ·çåé "
		 * åä½¿ç¨ç¯å¢å¯¹è±¡(ConfigurableEnvironment)ä¸­ç ConfigurablePropertyResolverå®ç°æ¥ä½ä¸º StringValueResolver æ·»å è¿å»
		 */
		if (!beanFactory.hasEmbeddedValueResolver()) {
			beanFactory.addEmbeddedValueResolver(strVal -&gt; getEnvironment().resolvePlaceholders(strVal));
		}
		// Initialize LoadTimeWeaverAware beans early to allow for registering their transformers early.
		/**
		 * 3. åå®ä¾åå LoadTimeWeaverAware beanï¼ä»¥ä¾¿å°½æ©æ³¨åå®ä»¬çè½¬æ¢å¨ã
		 * TODO AOP ç¸å³ç
		 */
		String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, false, false);
		for (String weaverAwareName : weaverAwareNames) {
			getBean(weaverAwareName);
		}

		// Stop using the temporary ClassLoader for type matching.
		// åæ­¢ä½¿ç¨ä¸´æ¶ClassLoaderè¿è¡ç±»åå¹é
		beanFactory.setTempClassLoader(null);

		// Allow for caching all bean definition metadata, not expecting further changes.
		/**
		 * 4. å»ç»éç½®, è¿æ¶åå°±ä¸ååè®¸æ´æ¹ beanDefinition äº; (å¶å®å°±æ¯ clearMetadataCache å è®¾ç½®äºä¸ä¸ªæ è¯ç¬¦)
		 */
		beanFactory.freezeConfiguration();

		// Instantiate all remaining (non-lazy-init) singletons.
		/**
		 * 5. å®ä¾åææå©ä½ç (élazy-init) åä¾ Bean
		 */
		beanFactory.preInstantiateSingletons();
	}
</code></pre>
<h3 id="å¤ç-factorybean-ç­">å¤ç FactoryBean ç­</h3>
<p><code>org.springframework.beans.factory.support.DefaultListableBeanFactory#preInstantiateSingletons</code></p>
<pre><code class="language-java">@Override
	public void preInstantiateSingletons() throws BeansException {
		if (logger.isTraceEnabled()) {
			logger.trace("Pre-instantiating singletons in " + this);
		}
		// Iterate over a copy to allow for init methods which in turn register new bean definitions.
		// While this may not be part of the regular factory bootstrap, it does otherwise work fine.
		/**
		 *  ææå·²æ³¨åçBean name åè¡¨;
		 *  è¿éå¤å¶ä¸ä»½, æ¹ä¾¿éå;
		 */
		List&lt;String&gt; beanNames = new ArrayList&lt;&gt;(this.beanDefinitionNames);

		// Trigger initialization of all non-lazy singleton beans...
		for (String beanName : beanNames) {
			/**
			 * åå¹¶å°ç¶ç±»ç BeanDefinition å¾å° RootBeanDefinition, æ¾å¥ç¼å­ä¸­.
			 * (æ¯ä¸ä¸ªBeané½æ RootBeanDefinition, æ²¡æçè¯ getMergedLocalBeanDefinition ä¼åå»ºä¸ä¸ª, å¹¶æ¾å¥ç¼å­ä¸­)
			 *
			 * ä¸ºä»ä¹éè¦å¾ä¸ç¼å­ RootBeanDefinition ?
			 * å®ä¾åä¸ä¸ªå¯¹è±¡çæ¶å, è¯å®æ¯åå®ä¾åç¶å¯¹è±¡, æç¶å¯¹è±¡æè½å®ä¾å­å¯¹è±¡
			 */
			RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName);
			//å¦æè¯¥ bean æ¯: éæ½è±¡, æ¯åä¾, éæå è½½
			if (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) {
				/**
				 * å¦æè¯¥beanæ¯ FactoryBean, åå¨ bean name åé¢å ä¸ä¸ª '&amp;' åç¼, åè·å/å®ä¾å FactoryBean æ¬èº«;
				 *  æ³¨æä¸ä¸ FactoryBean çæå¯¹è±¡æ¯ä¸éµå¾ª Spring çbeançå½å¨æç
				 *
				 * è¿æä¸¤ä¸ªå¯¹è±¡, å¦ä½è·å? getBean(beanName) :
				 * 1. ä¼ å¥ FactoryBean ç name è¿åçæ¯å¶ getObject çç®æ å¯¹è±¡å®ä¾;
				 * 2. å¦ææ³è·å FactoryBean æ¬èº«å®ä¾, ååé¢éè¦å ä¸ä¸ª '&amp;' åç¼;
				 *
				 */
				if (isFactoryBean(beanName)) {
					/**
					 * è·å/å®ä¾å factoryBean æ¬èº«
					 */
					Object bean = getBean(FACTORY_BEAN_PREFIX + beanName);
					if (bean instanceof SmartFactoryBean&lt;?&gt; smartFactoryBean
							&amp;&amp; smartFactoryBean.isEagerInit()) {
						/**
						 * å¦ææ¯ SmartFactoryBean å¹¶ä¸ æ¯æ¥å è½½:
						 * ååè·å/å®ä¾åè¯¥ FactoryBean çç®æ å¯¹è±¡
						 */
						getBean(beanName);
					}
				}
				else {
					getBean(beanName);
				}
			}
		}

		// Trigger post-initialization callback for all applicable beans...
		for (String beanName : beanNames) {
			Object singletonInstance = getSingleton(beanName);
			if (singletonInstance instanceof SmartInitializingSingleton smartSingleton) {
				StartupStep smartInitialize = getApplicationStartup().start("spring.beans.smart-initialize")
						.tag("beanName", beanName);
				smartSingleton.afterSingletonsInstantiated();
				smartInitialize.end();
			}
		}
	}
</code></pre>
<h3 id="å°è¯ä»-ä¸-äº-ä¸çº§ç¼å­ä¸­è·å">å°è¯ä» ä¸ äº ä¸çº§ç¼å­ä¸­è·å</h3>
<p><code>org.springframework.beans.factory.support.AbstractBeanFactory#getBean(java.lang.String)</code><br>
<code>org.springframework.beans.factory.support.AbstractBeanFactory#doGetBean</code></p>
<pre><code class="language-java">/**
	 * Return an instance, which may be shared or independent, of the specified bean.
	 * @param name the name of the bean to retrieve
	 * @param requiredType the required type of the bean to retrieve
	 * @param args arguments to use when creating a bean instance using explicit arguments
	 * (only applied when creating a new instance as opposed to retrieving an existing one)
	 * @param typeCheckOnly whether the instance is obtained for a type check,
	 * not for actual use
	 * @return an instance of the bean
	 * @throws BeansException if the bean could not be created
	 */
	@SuppressWarnings("unchecked")
	protected &lt;T&gt; T doGetBean(
			String name, @Nullable Class&lt;T&gt; requiredType, @Nullable Object[] args, boolean typeCheckOnly)
			throws BeansException {

		/**
		 *
		 * è½¬æ¢ bean name; å¦æåç§°ä¸­å¸¦ BeanFactory.FACTORY_BEAN_PREFIX, åä¼å»æå®;
		 * {@link BeanFactory#FACTORY_BEAN_PREFIX}
		 */
		String beanName = transformedBeanName(name);
		Object beanInstance;
		// Eagerly check singleton cache for manually registered singletons.
		/**
		 * å°è¯ä»å½åå®¹å¨ ä¸ äº ä¸çº§ç¼å­è·å
		 */
		Object sharedInstance = getSingleton(beanName);
		if (sharedInstance != null &amp;&amp; args == null) {
			/**
			 * å¦æç¼å­ä¸­æ
			 */
			if (logger.isTraceEnabled()) {
				if (isSingletonCurrentlyInCreation(beanName)) {
					logger.trace("Returning eagerly cached instance of singleton bean '" + beanName +
							"' that is not fully initialized yet - a consequence of a circular reference");
				}
				else {
					logger.trace("Returning cached instance of singleton bean '" + beanName + "'");
				}
			}
			/**
			 * å¦ææ¿å°çBeanæ¯ FactoryBean å®ç°, åä¼è°ç¨ `T getObject() throws Exception` è·åå¶å¯¹è±¡
			 * åå°ç®æ å¯¹è±¡æ¾å¥org.springframework.beans.factory.support.FactoryBeanRegistrySupport#factoryBeanObjectCacheç¼å­ä¸­
			 * æç»å¨ {@link org.springframework.beans.factory.support.FactoryBeanRegistrySupport#doGetObjectFromFactoryBean}
			 */
			beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, null);
		}
		else {
			/**
			 * å¦æç¼å­ä¸­æ²¡æ
			 */

			/**
			 *  å¤æ­è¯¥beanæ¯å¦å¨åå»ºä¸­ (å¾ªç¯åå»º), ç¨çæ¯ä¸ä¸ªThreadLocal
			 *  {@link org.springframework.beans.factory.support.AbstractBeanFactory#prototypesCurrentlyInCreation}
			 */
			// Fail if we're already creating this bean instance:
			// We're assumably within a circular reference.
			if (isPrototypeCurrentlyInCreation(beanName)) {
				throw new BeanCurrentlyInCreationException(beanName);
			}
			/**
			 * ä¼åå°è¯ä» ç¶ BeanFactoryä¸­æ¿, ç±»ä¼¼ç±»å è½½å¨çåäº²å§ææºå¶
			 * ä¸è¬ ç¶å®¹å¨é½æ¯ç©ºç
			 */
			// Check if bean definition exists in this factory.
			BeanFactory parentBeanFactory = getParentBeanFactory();
			if (parentBeanFactory != null &amp;&amp; !containsBeanDefinition(beanName)) {
				// Not found -&gt; check parent.
				String nameToLookup = originalBeanName(name);
				if (parentBeanFactory instanceof AbstractBeanFactory abf) {
					return abf.doGetBean(nameToLookup, requiredType, args, typeCheckOnly);
				}
				else if (args != null) {
					// Delegation to parent with explicit args.
					return (T) parentBeanFactory.getBean(nameToLookup, args);
				}
				else if (requiredType != null) {
					// No args -&gt; delegate to standard getBean method.
					return parentBeanFactory.getBean(nameToLookup, requiredType);
				}
				else {
					return (T) parentBeanFactory.getBean(nameToLookup);
				}
			}

			/**
			 * æ è®°è¯¥ beanä¸ºåå»ºä¸­æèå·²åå»º;
			 * å¶å®å°±æ¯ç¨ Setéå {@link org.springframework.beans.factory.support.AbstractBeanFactory#alreadyCreated} å­èµ·æ¥
			 */
			if (!typeCheckOnly) {
				markBeanAsCreated(beanName);
			}

			/**
			 * è®°å½å¨ (æå°æäºå³é®è¿ç¨æ¥å¿, æ¶éåæ, ä¸éè¦)
			 */
			StartupStep beanCreation = this.applicationStartup.start("spring.beans.instantiate")
					.tag("beanName", name);
			try {
				if (requiredType != null) {
					beanCreation.tag("beanType", requiredType::toString);
				}
				/**
				 * æ¿å°å¶ RootBeanDefinition (å®æ´çBeanåæ°æ®æè¿°)
				 */
				RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);
				//æ£æ¥BeanDefinition, å°±å¤æ­ä¸ä¸æ¯è¯¥bean å¦æ½è±¡ç±»
				checkMergedBeanDefinition(mbd, beanName, args);

				/**
				 * å¦æå­å¨ä¾èµéç½®, åååå»ºä¾èµçBean
				 * (å³XMLç &lt;bean id="..." depends-on="" ...&gt;&lt;/bean&gt; éç½®)
				 */
				// Guarantee initialization of beans that the current bean depends on.
				String[] dependsOn = mbd.getDependsOn();
				if (dependsOn != null) {
					for (String dep : dependsOn) {
						if (isDependent(beanName, dep)) {
							throw new BeanCreationException(mbd.getResourceDescription(), beanName,
									"Circular depends-on relationship between '" + beanName + "' and '" + dep + "'");
						}
						registerDependentBean(dep, beanName);
						try {
							getBean(dep);
						}
						catch (NoSuchBeanDefinitionException ex) {
							throw new BeanCreationException(mbd.getResourceDescription(), beanName,
									"'" + beanName + "' depends on missing bean '" + dep + "'", ex);
						}
					}
				}

				// Create bean instance.
				if (mbd.isSingleton()) {
					/**
					 * å¦ææ¯åä¾ç Bean
					 * =============================
					 */

					/**
					 * æ³¨æ ä¼ éä¸ä¸ª 'åå»ºBean' çLambdaå½æ°/å¯¹è±¡ (ObjectFactory)
					 * getSingleton çé»è¾æ¯:
					 * 	 1. å°è¯ä»ä¸çº§ç¼å­ä¸­æ¿
					 * 	 2. å°Bean Name æ·»å å° åå»ºä¸­ç¶æçéå è®°å½èµ·æ¥;
					 * 	  {@link org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#singletonsCurrentlyInCreation}
					 *   3. è°ç¨ ObjectFactory#getObject() åè°åæ¥ createBean
					 *   4. å¦ææ¯æ°åå»ºçæ·»å å°ä¸çº§ç¼å²ä¸­
					 */
					sharedInstance = getSingleton(beanName, () -&gt; {
						try {
							/**
							 * è§: {@link AbstractAutowireCapableBeanFactory#createBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, java.lang.Object[])}
							 */
							return createBean(beanName, mbd, args);
						}
						catch (BeansException ex) {
							// Explicitly remove instance from singleton cache: It might have been put there
							// eagerly by the creation process, to allow for circular reference resolution.
							// Also remove any beans that received a temporary reference to the bean.
							destroySingleton(beanName);
							throw ex;
						}
					});
					beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);
				}
				else if (mbd.isPrototype()) {
					/**
					 * å¦ææ¯ååç Bean
					 * =============================
					 */
					// It's a prototype -&gt; create a new instance.
					Object prototypeInstance = null;
					try {
						beforePrototypeCreation(beanName);
						prototypeInstance = createBean(beanName, mbd, args);
					}
					finally {
						afterPrototypeCreation(beanName);
					}
					beanInstance = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);
				}

				else {
					String scopeName = mbd.getScope();
					if (!StringUtils.hasLength(scopeName)) {
						throw new IllegalStateException("No scope name defined for bean '" + beanName + "'");
					}
					Scope scope = this.scopes.get(scopeName);
					if (scope == null) {
						throw new IllegalStateException("No Scope registered for scope name '" + scopeName + "'");
					}
					try {
						Object scopedInstance = scope.get(beanName, () -&gt; {
							beforePrototypeCreation(beanName);
							try {
								return createBean(beanName, mbd, args);
							}
							finally {
								afterPrototypeCreation(beanName);
							}
						});
						beanInstance = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);
					}
					catch (IllegalStateException ex) {
						throw new ScopeNotActiveException(beanName, scopeName, ex);
					}
				}
			}
			catch (BeansException ex) {
				beanCreation.tag("exception", ex.getClass().toString());
				beanCreation.tag("message", String.valueOf(ex.getMessage()));
				cleanupAfterBeanCreationFailure(beanName);
				throw ex;
			}
			finally {
				beanCreation.end();
				if (!isCacheBeanMetadata()) {
					clearMergedBeanDefinition(beanName);
				}
			}
		}

		/**
		 * ééè½¬æ¢ä¸º éæ±çç®æ ç±»å requiredType
		 * å¤æ: å­ç±»æ¯å¯ä»¥åä¸è½¬åç
		 */
		return adaptBeanInstance(name, beanInstance, requiredType);
	}
</code></pre>
<h3 id="å¤çinstantiationawarebeanpostprocessor-aopä»£ç">å¤çInstantiationAwareBeanPostProcessor AOPä»£ç</h3>
<p><code>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#createBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, java.lang.Object[])</code></p>
<pre><code class="language-java">/**
	 * Central method of this class: creates a bean instance,
	 * populates the bean instance, applies post-processors, etc.
	 * @see #doCreateBean
	 */
	@Override
	protected Object createBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)
			throws BeanCreationException {

		if (logger.isTraceEnabled()) {
			logger.trace("Creating instance of bean '" + beanName + "'");
		}
		RootBeanDefinition mbdToUse = mbd;

		// Make sure bean class is actually resolved at this point, and
		// clone the bean definition in case of a dynamically resolved Class
		// which cannot be stored in the shared merged bean definition.
		/**
		 * 1. è§£æå° BeanDefinition ç Class
		 */
		Class&lt;?&gt; resolvedClass = resolveBeanClass(mbd, beanName);
		/**
		 * 2. åå»ºBeanDefinition å¤å¶ä¸ä»½ RootBeanDefinition
		 */
		if (resolvedClass != null &amp;&amp; !mbd.hasBeanClass() &amp;&amp; mbd.getBeanClassName() != null) {
			mbdToUse = new RootBeanDefinition(mbd);
			mbdToUse.setBeanClass(resolvedClass);
		}

		// Prepare method overrides.
		try {
			/**
			 * 3. åå¤åéªè¯ lookup-method å replace-method;
			 * æ³¨æ: è¿éåªæ¯æ è®°, çæ­£å¤çæ¯å¨å®ä¾åæ¶, éæ©ç­ç¥çæä¸ä¸ªCgLibçä»£çå¯¹è±¡ {@link org.springframework.beans.factory.support.CglibSubclassingInstantiationStrategy}
			 * å³äºå®ä»¬çä½ç¨è§ç¬è®° [[Spring lookup-method å replace-method.md]]
			 */
			mbdToUse.prepareMethodOverrides();
		}
		catch (BeanDefinitionValidationException ex) {
			throw new BeanDefinitionStoreException(mbdToUse.getResourceDescription(),
					beanName, "Validation of method overrides failed", ex);
		}

		try {
			// Give BeanPostProcessors a chance to return a proxy instead of the target bean instance.
			/**
			 * 4. ç» BeanPostProcessors ä¸ä¸ªè¿å(ç¨æ·èªå®ä¹, å¦ææAOP, åä¼ ç¨æ·ä»£ç å Springä»£ç)ä»£çå®ä¾çæºä¼;
			 * è°ç¨ InstantiationAwareBeanPostProcessor ç
			 * {@link InstantiationAwareBeanPostProcessor#postProcessBeforeInstantiation(java.lang.Class, java.lang.String)}
			 * å
			 * {@link InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation(java.lang.Class, java.lang.String)}
			 * å¯ä»¥èªå®ä¹åå»º beanå¨æä»£çå®ä¾è¿å (AOPç¸å³)
			 *  
			 * è§ç¬è®°:
			 * [[BeanPostProcessoræ¥å£.md]]
			 * [[Spring ä¸­çAOP]]
			 *
			 * æ³¨æ, è¿éçé»è¾:
			 * å¦æå¶ InstantiationAwareBeanPostProcessor è¿åä¸ä¸ºnull, åç´æ¥ä½¿ç¨è¿ä¸ªbeanå®ä¾è¿åäº, ä¸èµ° doCreateBeanç­ä¸é¢çæµç¨
			 * (æ³¨æçæ³¨æ! å¦ææç¨æ·èªå®ä¹çæ¦æªåå»º, çè³ä¼åSpringçAOPä»£çåå»º)
			 */
			Object bean = resolveBeforeInstantiation(beanName, mbdToUse);
			if (bean != null) {
				return bean;
			}
		}
		catch (Throwable ex) {
			throw new BeanCreationException(mbdToUse.getResourceDescription(), beanName,
					"BeanPostProcessor before instantiation of bean failed", ex);
		}

		try {
			/**
			 * ç»§ç»­
			 */
			Object beanInstance = doCreateBean(beanName, mbdToUse, args);
			if (logger.isTraceEnabled()) {
				logger.trace("Finished creating instance of bean '" + beanName + "'");
			}
			return beanInstance;
		}
		catch (BeanCreationException | ImplicitlyAppearedSingletonException ex) {
			// A previously detected exception with proper bean creation context already,
			// or illegal singleton state to be communicated up to DefaultSingletonBeanRegistry.
			throw ex;
		}
		catch (Throwable ex) {
			throw new BeanCreationException(
					mbdToUse.getResourceDescription(), beanName, "Unexpected exception during bean creation", ex);
		}
	}
</code></pre>
<h3 id="çæ­£å¨jvmå±é¢å®ä¾åå¯¹è±¡">çæ­£å¨jvmå±é¢å®ä¾åå¯¹è±¡</h3>
<p><code>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#doCreateBean</code></p>
<pre><code class="language-java">/**
	 * Actually create the specified bean. Pre-creation processing has already happened
	 * at this point, e.g. checking {@code postProcessBeforeInstantiation} callbacks.
	 * &lt;p&gt;Differentiates between default bean instantiation, use of a
	 * factory method, and autowiring a constructor.
	 *
	 * çæ­£ç å¨JVMå± åå»ºBeanå®ä¾
	 *
	 * @param beanName the name of the bean
	 * @param mbd the merged bean definition for the bean
	 * @param args explicit arguments to use for constructor or factory method invocation
	 * @return a new instance of the bean
	 * @throws BeanCreationException if the bean could not be created
	 * @see #instantiateBean
	 * @see #instantiateUsingFactoryMethod
	 * @see #autowireConstructor
	 *
	 */
	protected Object doCreateBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)
			throws BeanCreationException {

		// Instantiate the bean.
		BeanWrapper instanceWrapper = null;
		if (mbd.isSingleton()) {
			instanceWrapper = this.factoryBeanInstanceCache.remove(beanName);
		}
		if (instanceWrapper == null) {
			/**
			 *  1. çæ­£å¨jvmå±é¢å®ä¾åå¯¹è±¡;
			 *    1.1 å¦æè¯¥ BeanDefinition æéç½® instanceSupplierå±æ§(java.util.function.Supplier),
			 * 		 å°ä½¿ç¨å¶Supplier#getæ¹æ³çè¿å, ä½ä¸ºå®ä¾å¯¹è±¡
			 *    1.2 å¦æè¯¥ BeanDefinition æéç½® factory-method å°ä½¿ç¨è¯¥æ¹æ³è¿åç, ä½ä¸ºå®ä¾å¯¹è±¡
			 * 		 è¿éè¿éåæ¬'éæå·¥å'å'å®ä¾å·¥å'çå¤ç(éè¿bdçfactoryBeanName è¿è¡å¤æ­, å¦æå­å¨åæ¯'å®ä¾å·¥å')
			 * 	  1.3 ä½¿ç¨åå°å®ä¾å, æ ¹æ®ç­ç¥å®ä¾åBeanå¯¹è±¡ {@link org.springframework.beans.factory.support.SimpleInstantiationStrategy}
			 * 	   - ä½¿ç¨æåæé å½æ°æ³¨å¥,åå»º (new)
			 * 	   - ä½¿ç¨æ åæé å½æ°åå»º (new)
			 * 	   - å·¥åæ¹æ³å®ä¾å ('éæå·¥å' 'å®ä¾å·¥å' )
			 * 	     `&lt;bean  factory-bean="bookFactoryBean"  factory-method="getBook()"/&gt;`
			 * 	        éæå·¥å: factory-bean è¥æ¯ å¨éå®ç±»å åä½¿ç¨ BookFactoryBean::getBook çéææ¹æ³è¿åçå¯¹è±¡
			 * 	        å®ä¾å·¥å:  factory-bean è¥æ¯ bean å åä½¿ç¨è¯¥å®ä¾æ¹æ³è¿åçå¯¹è±¡
			 *
			 * 	{@link AbstractAutowireCapableBeanFactory#createBeanInstance(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, java.lang.Object[])}
			 *  2. ç¨BeanWrapper åè£åå§bean (è£é¥°æ¨¡å¼)
			 *  åå§å BeanWrapper
			 * 	 2.1 ç» BeanWrapper è®¾ç½®äº, ConversionService
			 *   2.2 ç» BeanWrapper æ³¨åäº, å½å bean factory (propertyEditorRegistrars)ä¸­çå¨é¨ PropertyEditor
			 * {@link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#instantiateBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition)}
			 *
			 */
			instanceWrapper = createBeanInstance(beanName, mbd, args);
		}
		/**
		 * è·å BeanWrapperä¸­çåå§ Bean å®ä¾
		 */
		Object bean = instanceWrapper.getWrappedInstance();
		/**
		 * è·å Bean Classç±»å
		 */
		Class&lt;?&gt; beanType = instanceWrapper.getWrappedClass();
		if (beanType != NullBean.class) {
			mbd.resolvedTargetType = beanType;
		}

		// Allow post-processors to modify the merged bean definition.
		synchronized (mbd.postProcessingLock) {
			if (!mbd.postProcessed) {
				try {
					/**
					 * 3. å¤ç MergedBeanDefinitionPostProcessor çæ¥å£åè°
					 * è°ç¨ æ·»å å¨ context ä¸­ BeanPostProcessor ç MergedBeanDefinitionPostProcessor çæ¥å£åè°
					 * è§£æå°è¯¸å¦`@Autowired`ä¹ç±»çæ³¨è§£ (Metadata)åä¿¡æ¯,åå¹¶å°BeanDefinitionä¸­
					 *
					 * æ³¨æå¨å½åæ­¥éª¤ä¸­,åªæ¯è§£æ,å¹¶æ³¨å(ä¿®æ¹)å° BeanDefinition ä¸­, å¹¶æ²¡æè°ç¨;
					 *
					 * ä¾å¦:
					 *  1. å¤ç `@Autowired` `@Value`, `@Inject`
					 * å¯¹åºå¤çç±»æ¯ `org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor`
					 * è¿ä¸ª çæ­£å¤çæ¯å¨å¡«åå±æ§æ¶, [[åè°ææ InstantiationAwareBeanPostProcessor#postProcessProperties æ¹æ³]] {@link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#populateBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, org.springframework.beans.BeanWrapper)}
					 * è´è´£æ¥æ¾ç¸åºçæ³¨è§£æ¹æ³ä¿¡æ¯, å°è£ä¸º Metadata åæ°æ®(ä½¿ç¨éåå­èµ·æ¥), åå°è¿äº Metadata åæ°æ®, æ³¨å(ä¿®æ¹)å° BeanDefinition ä¸­
					 *
					 *  2. å¤ç `@Resource`
					 * å¯¹åºå¤çç±» `org.springframework.context.annotation.CommonAnnotationBeanPostProcessor`
					 *
					 *  3. å¤ç `init-method`, `@PostConstruct`, `@PreDestroy`
					 * å¯¹åºå¤çç±» `org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor`
					 *
					 */
					applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);
				}
				catch (Throwable ex) {
					throw new BeanCreationException(mbd.getResourceDescription(), beanName,
							"Post-processing of merged bean definition failed", ex);
				}
				mbd.markAsPostProcessed();
			}
		}

		// Eagerly cache singletons to be able to resolve circular references
		// even when triggered by lifecycle interfaces like BeanFactoryAware.
		/**
		 * å¤æ­å½å:  æ¯å¦åä¾ &amp;&amp; æ¯å¦åè®¸å¾ªç¯ä¾èµ &amp;&amp; æ¯å¦æ­£å¨åå»ºè¿ç¨ä¸­
		 *(å¾ªç¯ä¾èµAOP)
		 */
		boolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp;
				isSingletonCurrentlyInCreation(beanName));
		if (earlySingletonExposure) {
			if (logger.isTraceEnabled()) {
				logger.trace("Eagerly caching bean '" + beanName +
						"' to allow for resolving potential circular references");
			}
			/**
			 * æ¾å°ä¸çº§ç¼å­(ä¸çº§ç¼å­ å­æ¾Lambda)
			 * &lt;!&gt; å¾ªç¯ä¾èµ AOP :è¿éå¶å®å°±æ¯ä¼è°ç¨å° AutoProxyCreator å¨å¶è¿è¡å¤æ­æ¯å¦éè¦, æç»ä¼è°ç¨å° createProxy è¿è¡å¨æä»£çå¯¹è±¡åå»º
			 * {@link org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator#getEarlyBeanReference(java.lang.Object, java.lang.String)}
			 *
			 */
			addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));
		}

		// Initialize the bean instance.
		Object exposedObject = bean;
		try {
			/**
			 * 2.å¡«åBeanå±æ§
			 * å¦ææ¯AOP, pointcut, adviceç¸å³ç, synthetic ä¼éç½®ä¸º true
			 *   1. è°ç¨ BeanPostProcessor çå­æ¥å£ InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation
			 * 	 (ä½ç¨æ¯ å¨å®ä¾åä¹åï¼å±æ§å¡«åä¹åæ§è¡æä½, å¯ä»¥æ¦æªå±æ§å¡«åæä½)
			 */
			populateBean(beanName, mbd, instanceWrapper);
			/**
			 * 3.åå§åBeanå¯¹è±¡
			 *   1.åè°ç¨è¿ä¸ä¸ª BeanNameAware, BeanClassLoaderAware, BeanFactoryAware
			 * 	  è¿ä¸ä¸ªæ¯å¨åå»ºBeanFactory æ¶å¿½ç¥çä¸ä¸ª Aware æ¥å£
			 *   2. è°ç¨ææ BeanPostProcessors#postProcessBeforeInitialization (ä½ç¨: å¨Beanåå§åä¹åè°ç¨)
			 *   3. è°ç¨ init-method æ¹æ³
			 *   4. è°ç¨ææ BeanPostProcessors#postProcessAfterInitialization (ä½ç¨: å¨Beanåå§åä¹åè°ç¨)
			 */
			exposedObject = initializeBean(beanName, exposedObject, mbd);
		}
		catch (Throwable ex) {
			if (ex instanceof BeanCreationException bce &amp;&amp; beanName.equals(bce.getBeanName())) {
				throw bce;
			}
			else {
				throw new BeanCreationException(mbd.getResourceDescription(), beanName, ex.getMessage(), ex);
			}
		}

		if (earlySingletonExposure) {
			/**
			 * å¾ªç¯ä¾èµAOP ç¸å³ (å¾ªç¯ä¾èµAOP)
			 * =======================
			 */

			/**
			 * åä»ç¼å­ä¸­æ¿ä¸æ¬¡è·åå¹¶æ¿æ¢,æ¯å ä¸ºæå¯è½æ¯è¢«ä»£ç(earlySingletonReference)
			 */
			Object earlySingletonReference = getSingleton(beanName, false);
			if (earlySingletonReference != null) {
				/**
				 *  (å¾ªç¯ä¾èµAOP)
				 *  æ³¨æ: è¿ä¸ªbeanæ¯åå§å®ä¾, åä»ç¼å­ä¸­æ¿ä¸æ¬¡,æ¯å ä¸ºæå¯è½æ¯è¢«ä»£ç(earlySingletonReference)
				 */
				if (exposedObject == bean) {
					// ä¸ä¸è´å°±æ¯è¢«ä»£çäº
					exposedObject = earlySingletonReference;
				}
				else if (!this.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) {
					String[] dependentBeans = getDependentBeans(beanName);
					Set&lt;String&gt; actualDependentBeans = new LinkedHashSet&lt;&gt;(dependentBeans.length);
					for (String dependentBean : dependentBeans) {
						if (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) {
							actualDependentBeans.add(dependentBean);
						}
					}
					if (!actualDependentBeans.isEmpty()) {
						throw new BeanCurrentlyInCreationException(beanName,
								"Bean with name '" + beanName + "' has been injected into other beans [" +
										StringUtils.collectionToCommaDelimitedString(actualDependentBeans) +
										"] in its raw version as part of a circular reference, but has eventually been " +
										"wrapped. This means that said other beans do not use the final version of the " +
										"bean. This is often the result of over-eager type matching - consider using " +
										"'getBeanNamesForType' with the 'allowEagerInit' flag turned off, for example.");
					}
				}
			}
		}

		// Register bean as disposable.
		try {
			/**
			 * æ³¨å beanéæ¯çå·¥ä½(å¦æéè¦)
			 * 1. org.springframework.beans.factory.config.DestructionAwareBeanPostProcessor#postProcessBeforeDestruction(Object,String) BPPæ¥å£
			 * 2. org.springframework.beans.factory.DisposableBean æ¥å£
			 * 3. èªå®ä¹ destroyæ¹æ³
			 * å¨å®¹å¨å³é­æ¶ä¼è°ç¨ä¼æè¿ä¸ªé¡ºåºè°ç¨
			 */
			registerDisposableBeanIfNecessary(beanName, bean, mbd);
		}
		catch (BeanDefinitionValidationException ex) {
			throw new BeanCreationException(
					mbd.getResourceDescription(), beanName, "Invalid destruction signature", ex);
		}

		return exposedObject;
	}
</code></pre>
<h3 id="å®ä¾å-æé å½æ°çç»è">å®ä¾å æé å½æ°çç»è</h3>
<pre><code class="language-java">
	/**
	 * å®ä¾åè¯¦ç»è¿ç¨
	 * 
	 * Create a new instance for the specified bean, using an appropriate instantiation strategy:
	 * factory method, constructor autowiring, or simple instantiation.
	 * @param beanName the name of the bean
	 * @param mbd the bean definition for the bean
	 * @param args explicit arguments to use for constructor or factory method invocation
	 * @return a BeanWrapper for the new instance
	 * @see #obtainFromSupplier
	 * @see #instantiateUsingFactoryMethod
	 * @see #autowireConstructor
	 * @see #instantiateBean
	 *
	 */
	protected BeanWrapper createBeanInstance(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) {
		// Make sure bean class is actually resolved at this point.
		// ç¡®ä¿Class æ¯å¯ä»¥å®ä¾åç
		Class&lt;?&gt; beanClass = resolveBeanClass(mbd, beanName);
		/**
		 * éªè¯ä¸ä¸æé æ¹æ³ è®¿é®ä¿®é¥°ç¬¦
		 */
		if (beanClass != null &amp;&amp; !Modifier.isPublic(beanClass.getModifiers()) &amp;&amp; !mbd.isNonPublicAccessAllowed()) {
			throw new BeanCreationException(mbd.getResourceDescription(), beanName,
					"Bean class isn't public, and nonpublic access not allowed: " + beanClass.getName());
		}
		/**
		 * å¦æè¯¥ BeanDefinition æéç½® instanceSupplierå±æ§(java.util.function.Supplier),
		 * å°ä½¿ç¨å¶Supplier#getæ¹æ³çè¿å, ä½ä¸ºå®ä¾å¯¹è±¡
		 */
		Supplier&lt;?&gt; instanceSupplier = mbd.getInstanceSupplier();
		if (instanceSupplier != null) {
			return obtainFromSupplier(instanceSupplier, beanName, mbd);
		}

		/**
		 * å¦æè¯¥ BeanDefinition æéç½® factory-method å°ä½¿ç¨è¯¥æ¹æ³çè¿å ä½ä¸ºå®ä¾å¯¹è±¡
		 * è¿éè¿éåæ¬'éæå·¥å'å'å®ä¾å·¥å'çå¤ç(éè¿bdçfactoryBeanName è¿è¡å¤æ­, å¦æå­å¨åæ¯'å®ä¾å·¥å')
		 *
		 * éæå·¥å(æ³¨æ å·¥åæ¹æ³æ¯staticæ¹æ³)
		 * &lt;bean id="user" class="org.yang.User"  factory-method="createUser"/&gt;
		 *
		 * å®ä¾å·¥å(æ³¨æ å·¥åå¯¹è±¡æ¯ä¸ä¸ªå®ä¾, ä½¿ç¨è¯¥å®ä¾æ¹æ³è¿åç)
		 * &lt;bean id="userFactory" class="org.yang.UserFactory"/&gt;
		 *  &lt;! -- factory-bean æåå®ä¾å·¥å Bean --&gt;
		 * &lt;bean id="user" class="org.yang.User" factory-bean="userFactory" factory-method="createUser"/&gt;
		 *
		 */
		if (mbd.getFactoryMethodName() != null) {
			return instantiateUsingFactoryMethod(beanName, mbd, args);
		}

		/**
		 *  =======================
		 *  in short : ä¸é¢ä¸»è¦é»è¾å°±æ¯ æ¾å°ä¸ä¸ªåéçæé å½æ°åæ³¨å¥æ¹å¼, ç¶åå­èµ·æ¥, éè¿åå°å®ä¾å
		 *  å¦æä¸æ¬¡è¿éè¦å°±ç´æ¥æ ¹æ®æåµç´æ¥æ§è¡(ä»ååBeanææéå¤åå»ºçæåµ)
		 */
		// Shortcut when re-creating the same bean...
		/**
		 * æ¯å¦å·²ç»è§£æ/åå»ºè¿äº
		 */
		boolean resolved = false;
		/**
		 * æ¯å¦éè¦èªå¨æ³¨å¥
		 */
		boolean autowireNecessary = false;
		if (args == null) {
			synchronized (mbd.constructorArgumentLock) {
				/**
				 * ç±»ä¼¼ä¸ä¸ªç¼å­æºå¶, åé¢å¨ {@link org.springframework.beans.factory.support.SimpleInstantiationStrategy#instantiate(org.springframework.beans.factory.support.RootBeanDefinition, java.lang.String, org.springframework.beans.factory.BeanFactory)}
				 * è§£æè¿ç¨ä¸­ä¼ç»å®èµå¼å­èµ·æ¥; ä¸é¢å°±æ ¹æ®è§£æçæåµæ§è¡
				 */
				if (mbd.resolvedConstructorOrFactoryMethod != null) {
					resolved = true;
					autowireNecessary = mbd.constructorArgumentsResolved;
				}
			}
		}
		/**
		 * å·²ç»è§£æè¿äº, æ ¹æ®è§£æçæåµ, æ§è¡
		 */
		if (resolved) {
			if (autowireNecessary) {
				/**
				 * ä½¿ç¨æåæé å½æ°æ³¨å¥,åå»º (new)
				 */
				return autowireConstructor(beanName, mbd, null, null);
			}
			else {
				/**
				 * ä½¿ç¨æ åæé å½æ°æ³¨å¥,åå»º (new)
				 */
				return instantiateBean(beanName, mbd);
			}
		}
		/**
		 * é¦æ¬¡è§£æåå»ºBean
		 * =============================
		 */

		// Candidate constructors for autowiring?
		/**
		 * ä» BeanPostProcessors éé¢æ¨æ­æé æ¹æ³
		 * SmartInstantiationAwareBeanPostProcessor æ¥å£å¯ä»¥å¯¹ 'æé æ¹æ³æ³¨å¥çéæ©' è¿è¡è°æ´(æ¨è?)
		 * {@link org.springframework.beans.factory.config.SmartInstantiationAwareBeanPostProcessor#determineCandidateConstructors(java.lang.Class, java.lang.String)}
		 *
		 */
		Constructor&lt;?&gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName);
		/**
		 * èªå¨è½¬éçæ¹å¼, æäºç§ (è§ {@link org.springframework.beans.factory.config.AutowireCapableBeanFactory}çå ä¸ªå¸¸é):
		 *  1. AUTOWIRE_NO = 0; æªæå®, ä¸æ³¨å¥
		 * 	2. AUTOWIRE_BY_NAME = 1; byName
		 * 	3. AUTOWIRE_BY_TYPE = 2; byType
		 * 	4. AUTOWIRE_CONSTRUCTOR = 3; byæé 
		 *  5. AUTOWIRE_AUTODETECT = 4;(å°å¼ç¨)
		 *
		 */
		if (ctors != null || mbd.getResolvedAutowireMode() == AUTOWIRE_CONSTRUCTOR ||
				mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) {
			/**
			 * ä½¿ç¨æåæé å½æ°æ³¨å¥,åå»º
			 */
			return autowireConstructor(beanName, mbd, ctors, args);
		}

		// Preferred constructors for default construction?
		/**
		 *  æ²¡ææ¾å°åéçæé å½æ°, å¦æmbdæéç½® é¦éçæé å½æ°, å°±ç¨å®
		 */
		ctors = mbd.getPreferredConstructors();
		if (ctors != null) {
			return autowireConstructor(beanName, mbd, ctors, null);
		}

		// No special handling: simply use no-arg constructor.
		/**
		 * ä½¿ç¨æ åæé å½æ°æ³¨å¥,åå»º
		 */
		return instantiateBean(beanName, mbd);
	}
</code></pre>
<h3 id="å¡«åå±æ§">å¡«åå±æ§</h3>
<pre><code class="language-java">/**
	 * Populate the bean instance in the given BeanWrapper with the property values
	 * from the bean definition.
	 * @param beanName the name of the bean
	 * @param mbd the bean definition for the beanT
	 * @param bw the BeanWrapper with bean instance
	 */
	protected void populateBean(String beanName, RootBeanDefinition mbd, @Nullable BeanWrapper bw) {
		// éªè¯ä¸ä¸å¥å
		if (bw == null) {
			if (mbd.hasPropertyValues()) {
				throw new BeanCreationException(
						mbd.getResourceDescription(), beanName, "Cannot apply property values to null instance");
			}
			else {
				// Skip property population phase for null instance.
				return;
			}
		}

		if (bw.getWrappedClass().isRecord()) {
			if (mbd.hasPropertyValues()) {
				throw new BeanCreationException(
						mbd.getResourceDescription(), beanName, "Cannot apply property values to a record");
			}
			else {
				// Skip property population phase for records since they are immutable.
				return;
			}
		}

		// Give any InstantiationAwareBeanPostProcessors the opportunity to modify the
		// state of the bean before properties are set. This can be used, for example,
		// to support styles of field injection.
		/**
		 * å¦ææ¯AOP, pointcut, adviceç¸å³ç, synthetic ä¼éç½®ä¸º true
		 * 1. è°ç¨ BeanPostProcessor çå­æ¥å£ InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation
		 * (ä½ç¨æ¯ å¨å®ä¾åä¹åï¼å±æ§å¡«åä¹åæ§è¡æä½, å¯ä»¥æ¦æªå±æ§å¡«åæä½)
		 */
		if (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) {
			for (InstantiationAwareBeanPostProcessor bp : getBeanPostProcessorCache().instantiationAware) {
				if (!bp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName)) {
					//postProcessAfterInstantiation è¿å false , æ¦æªå±æ§å¡«å;
					return;
				}
			}
		}
		/**
		 * åå«ä¸ä¸ªæå¤ä¸ª{@link PropertyValue}å¯¹è±¡çHolderï¼éå¸¸éå¯¹ç¹å®ç®æ beançä¸æ¬¡æ´æ°
		 * å¯ä»¥çè§£ä¸º: è¯¥beanææå±æ§çæè¿°
		 */
		PropertyValues pvs = (mbd.hasPropertyValues() ? mbd.getPropertyValues() : null);

		/**
		 * è·åèªå¨æ³¨å¥çæ¹å¼
		 */
		int resolvedAutowireMode = mbd.getResolvedAutowireMode();
		if (resolvedAutowireMode == AUTOWIRE_BY_NAME || resolvedAutowireMode == AUTOWIRE_BY_TYPE) {
			/**
			 * 2. å¤çæ³¨è§£ç  byName æè byType æ³¨å¥çå±æ§
			 * (ææ³¨è§£æä¼èµ°è¿ä¸ªåæ¯)
			 * ===============================
			 */
			MutablePropertyValues newPvs = new MutablePropertyValues(pvs);
			// Add property values based on autowire by name if applicable.
			if (resolvedAutowireMode == AUTOWIRE_BY_NAME) {
				/**
				 * éè¿åç§°æ³¨å¥
				 */
				autowireByName(beanName, mbd, bw, newPvs);
			}
			// Add property values based on autowire by type if applicable.
			if (resolvedAutowireMode == AUTOWIRE_BY_TYPE) {
				/**
				 * éè¿ç±»åæ³¨å¥
				 */
				autowireByType(beanName, mbd, bw, newPvs);
			}
			pvs = newPvs;
		}
		/**
		 *  3. åè°ææ InstantiationAwareBeanPostProcessor#postProcessProperties æ¹æ³
		 *  æ¯å¦, `@Autowired` çå¤çå¯¹åºå®ç°ç±»: {@link org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor}
		 *  (ä½ç¨æ¯: å¨å·¥åå°å±æ§å¼åºç¨å°ç»å®beanä¹åï¼å¯¹å®ä»¬è¿è¡å¤ç)
		 * 	 æ³¨æè¿éä¹åªæ¯è§£æ, å¹¶æ²¡æè®¾ç½®è¿å», å®éèµå¼æ¹æ³è§ä¸: {@link AbstractAutowireCapableBeanFactory#applyPropertyValues(java.lang.String, org.springframework.beans.factory.config.BeanDefinition, org.springframework.beans.BeanWrapper, org.springframework.beans.PropertyValues)}
		 *
		 */
		if (hasInstantiationAwareBeanPostProcessors()) {
			if (pvs == null) {
				pvs = mbd.getPropertyValues();
			}
			for (InstantiationAwareBeanPostProcessor bp : getBeanPostProcessorCache().instantiationAware) {
				PropertyValues pvsToUse = bp.postProcessProperties(pvs, bw.getWrappedInstance(), beanName);
				if (pvsToUse == null) {
					return;
				}
				pvs = pvsToUse;
			}
		}

		boolean needsDepCheck = (mbd.getDependencyCheck() != AbstractBeanDefinition.DEPENDENCY_CHECK_NONE);
		if (needsDepCheck) {
			PropertyDescriptor[] filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);
			checkDependencies(beanName, mbd, filteredPds, pvs);
		}
		/**
		 * 4. è§£æBeanDefinitionçæè¿°å¼, åå°è°ç¨ èµå¼ bean å±æ§ (å°è§£æå°ç pvs èµå¼å° bw)
		 */
		if (pvs != null) {
			applyPropertyValues(beanName, mbd, bw, pvs);
		}
	}
</code></pre>
<h3 id="åå§å-è°ç¨-init-method-aware-bppæ¹æ³">åå§å è°ç¨ init-method Aware BPPæ¹æ³</h3>
<p><code>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#initializeBean(java.lang.String, java.lang.Object, org.springframework.beans.factory.support.RootBeanDefinition)</code></p>
<pre><code class="language-java">/**
	 * Initialize the given bean instance, applying factory callbacks
	 * as well as init methods and bean post processors.
	 * &lt;p&gt;Called from {@link #createBean} for traditionally defined beans,
	 * and from {@link #initializeBean} for existing bean instances.
	 * @param beanName the bean name in the factory (for debugging purposes)
	 * @param bean the new bean instance we may need to initialize
	 * @param mbd the bean definition that the bean was created with
	 * (can also be {@code null}, if given an existing bean instance)
	 * @return the initialized bean instance (potentially wrapped)
	 * @see BeanNameAware
	 * @see BeanClassLoaderAware
	 * @see BeanFactoryAware
	 * @see #applyBeanPostProcessorsBeforeInitialization
	 * @see #invokeInitMethods
	 * @see #applyBeanPostProcessorsAfterInitialization
	 */
	@SuppressWarnings("deprecation")
	protected Object initializeBean(String beanName, Object bean, @Nullable RootBeanDefinition mbd) {

		/**
		 * åè°ç¨è¿ä¸ä¸ª BeanNameAware, BeanClassLoaderAware, BeanFactoryAware
		 * è¿ä¸ä¸ªæ¯å¨åå»º BeanFactory æ¶å¿½ç¥çä¸ä¸ª Aware æ¥å£
		 * { @link org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#AbstractAutowireCapableBeanFactory() }
		 *
		 */
		invokeAwareMethods(beanName, bean);

		Object wrappedBean = bean;
		if (mbd == null || !mbd.isSynthetic()) {
			/**
			 * è°ç¨ææ BeanPostProcessors#postProcessBeforeInitialization
			 * (ä½ç¨ å¨Beanåå§åä¹åè°ç¨)
			 * æ¯å¦ Spring ä¸­Awareå±æ§çè®¾ç½®, æ¯éè¿è¿ç§æ¹å¼æ©å±ç
			 * - org.springframework.context.support.ApplicationContextAwareProcessor
			 * å¯¹åºè°ç¨ ApplicationContextAware, EnvironmentAware, ApplicationEventPublisherAware ç­Awareæ¹æ³
			 *
			 */
			wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);
		}

		try {
			/**
			 * è°ç¨ init-method æ¹æ³
			 */
			invokeInitMethods(beanName, wrappedBean, mbd);
		}
		catch (Throwable ex) {
			throw new BeanCreationException(
					(mbd != null ? mbd.getResourceDescription() : null), beanName, ex.getMessage(), ex);
		}
		if (mbd == null || !mbd.isSynthetic()) {
			/**
			 * è°ç¨ææ BeanPostProcessors#postProcessAfterInitialization
			 * (ä½ç¨ å¨Beanåå§åä¹åè°ç¨)
			 *
			 * - AspectJAwareAdvisorAutoProxyCreator.class
			 * org.springframework.aop.config.internalAutoProxyCreator å¯¹åºçç±»ææ ¹æ®æåµæä¸ä¸ªå¯è½
			 *   InfrastructureAdvisorAutoProxyCreator.class,
			 *   AspectJAwareAdvisorAutoProxyCreator.class,
			 *   AnnotationAwareAspectJAutoProxyCreator.class
			 *
			 *  å¦æéè¦ä»£ç, è¿éä¼çæ­£çå¯¹åå§ bean è¿è¡ä»£ç  è¿è¡ä»£ççåå»º createProxy
			 *
			 */
			wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);
		}

		return wrappedBean;
	}
</code></pre>
<h3 id="æ»ç»-9">æ»ç»</h3>
<pre><code>1. ä¸º beanFactory è®¾ç½®ç±»åè½¬æ¢å¨(ConversionService) å±æ§å¡«åæ¶ä¼ç¨å° {@link AbstractApplicationContext#finishBeanFactoryInitialization(ConfigurableListableBeanFactory)}
2. ä¸º beanFactory æ·»å åéè§£æå¨ (StringValueResolver)
	å¦æ beanFactory ä¸ä¸æä¸­ä¸åå« "é»è®¤çåéè§£æå¨ (ç±»ä¼¼ PropertySourcesPlaceholderConfigurer) è§£æç±»ä¼¼ '${}' è¿æ ·çåé "
	åä½¿ç¨ç¯å¢å¯¹è±¡(ConfigurableEnvironment)ä¸­ç ConfigurablePropertyResolverå®ç°æ¥ä½ä¸º StringValueResolver æ·»å è¿å»
3. å»ç»éç½®, æ­¤åå°±ä¸ååè®¸æ´æ¹ beanDefinition äº
4. å®ä¾åææå©ä½ç (élazy-init) åä¾ Bean
5. å¤ç FactoryBean ç±»åçbean {@link DefaultListableBeanFactory#preInstantiateSingletons()}
	å¦æè¯¥beanæ¯ FactoryBean, åå¨ bean name åé¢å ä¸ä¸ª '&amp;' åç¼, åè·å/å®ä¾å FactoryBean æ¬èº«;
	(æ³¨æä¸ä¸ FactoryBean çæå¯¹è±¡æ¯ä¸éµå¾ª Spring çbeançå½å¨æç)
	è¿æä¸¤ä¸ªå¯¹è±¡, å¦ä½è·å? getBean(beanName) :
	1. ä¼ å¥ FactoryBean ç name è¿åçæ¯å¶ getObject çç®æ å¯¹è±¡å®ä¾;
	2. å¦ææ³è·å FactoryBean æ¬èº«å®ä¾, ååé¢éè¦å ä¸ä¸ª '&amp;' åç¼;
6. å°è¯ä»å½åå®¹å¨ ä¸ äº ä¸çº§ç¼å­è·å {@link AbstractBeanFactory#doGetBean(String, Class, Object[], boolean)}
7. å¤ç AOP ä»£çå¯¹è±¡çæ {@link AbstractAutowireCapableBeanFactory#createBean(String, RootBeanDefinition, Object[])}
8. å¨JVMå±é¢å®ä¾åå¯¹è±¡ {@link AbstractAutowireCapableBeanFactory#doCreateBean(String, RootBeanDefinition, Object[])}
	1.çæ­£å¨jvmå±é¢å®ä¾åå¯¹è±¡;
		1. å¦æè¯¥ BeanDefinition æéç½® instanceSupplierå±æ§(java.util.function.Supplier),
		 å°ä½¿ç¨å¶Supplier#getæ¹æ³çè¿å, ä½ä¸ºå®ä¾å¯¹è±¡
		2. å¦æè¯¥ BeanDefinition æéç½® factory-method å°ä½¿ç¨è¯¥æ¹æ³è¿åç, ä½ä¸ºå®ä¾å¯¹è±¡
		 è¿éè¿éåæ¬'éæå·¥å'å'å®ä¾å·¥å'çå¤ç(éè¿bdçfactoryBeanName è¿è¡å¤æ­, å¦æå­å¨åæ¯'å®ä¾å·¥å')
		3. ä½¿ç¨åå°å®ä¾å, æ ¹æ®ç­ç¥å®ä¾åBeanå¯¹è±¡ {@link org.springframework.beans.factory.support.SimpleInstantiationStrategy}
		- ä½¿ç¨æåæé å½æ°æ³¨å¥,åå»º (new)
		- ä½¿ç¨æ åæé å½æ°åå»º (new)
		- å·¥åæ¹æ³å®ä¾å ('éæå·¥å' 'å®ä¾å·¥å' )
		`&lt;bean  factory-bean="bookFactoryBean"  factory-method="getBook()"/&gt;`
		éæå·¥å: factory-bean è¥æ¯ å¨éå®ç±»å åä½¿ç¨ BookFactoryBean::getBook çéææ¹æ³è¿åçå¯¹è±¡
		å®ä¾å·¥å:  factory-bean è¥æ¯ bean å åä½¿ç¨è¯¥å®ä¾æ¹æ³è¿åçå¯¹è±¡
	2. ç¨BeanWrapper åè£åå§bean (è£é¥°æ¨¡å¼)
	3. åå§å BeanWrapper
		1. ç» BeanWrapper è®¾ç½®äº, ConversionService
		2. ç» BeanWrapper æ³¨åäº, å½å bean factory (propertyEditorRegistrars)ä¸­çå¨é¨ PropertyEditor
		3. å¤ç MergedBeanDefinitionPostProcessor çæ¥å£åè° {@link AbstractAutowireCapableBeanFactory#applyMergedBeanDefinitionPostProcessors(RootBeanDefinition, Class, String)}
		è°ç¨ æ·»å å¨ context ä¸­ BeanPostProcessor ç MergedBeanDefinitionPostProcessor çæ¥å£åè°
		è§£æå°è¯¸å¦`@Autowired`ä¹ç±»çæ³¨è§£ (Metadata)åä¿¡æ¯,åå¹¶å°BeanDefinitionä¸­
	4. å¡«åBeanå±æ§ {@link AbstractAutowireCapableBeanFactory#populateBean(String, RootBeanDefinition, BeanWrapper)}
		1. å¦ææ¯AOP, pointcut, adviceç¸å³ç, synthetic ä¼éç½®ä¸º true  è°ç¨ BeanPostProcessor çå­æ¥å£ InstantiationAwareBeanPostProcessor#postProcessAfterInstantiation
		(ä½ç¨æ¯ å¨å®ä¾åä¹åï¼å±æ§å¡«åä¹åæ§è¡æä½, å¯ä»¥æ¦æªå±æ§å¡«åæä½)
		2. å¤çæ³¨è§£ç  byName æè byType æ³¨å¥çå±æ§
		3. åè°ææ InstantiationAwareBeanPostProcessor#postProcessProperties æ¹æ³
		æ¯å¦, `@Autowired` çå¤çå¯¹åºå®ç°ç±»: {@link org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor}
		(ä½ç¨æ¯: å¨å·¥åå°å±æ§å¼åºç¨å°ç»å®beanä¹åï¼å¯¹å®ä»¬è¿è¡å¤ç)
		æ³¨æè¿éä¹åªæ¯è§£æ, å¹¶æ²¡æè®¾ç½®è¿å», å®éèµå¼æ¹æ³è§: {@link AbstractAutowireCapableBeanFactory#applyPropertyValues(java.lang.String, org.springframework.beans.factory.config.BeanDefinition, org.springframework.beans.BeanWrapper, org.springframework.beans.PropertyValues)}
	5. åå§åBeanå¯¹è±¡ {@link AbstractAutowireCapableBeanFactory#initializeBean(String, Object, RootBeanDefinition)}
		1. åè°ç¨è¿ä¸ä¸ª BeanNameAware, BeanClassLoaderAware, BeanFactoryAware {@link AbstractAutowireCapableBeanFactory#invokeAwareMethods(String, Object)}
		è¿ä¸ä¸ªæ¯å¨åå»ºBeanFactory æ¶å¿½ç¥çä¸ä¸ª Aware æ¥å£
		2. è°ç¨ææ BeanPostProcessors#postProcessBeforeInitialization (ä½ç¨: å¨Beanåå§åä¹åè°ç¨) {@link AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsBeforeInitialization(Object, String)}
		3. è°ç¨ init-method æ¹æ³ {@link AbstractAutowireCapableBeanFactory#invokeInitMethods(String, Object, RootBeanDefinition)}
		4. è°ç¨ææ BeanPostProcessors#postProcessAfterInitialization (ä½ç¨: å¨Beanåå§åä¹åè°ç¨) {@link AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsAfterInitialization(Object, String)}
	6. æ³¨å beanéæ¯çå·¥ä½(å¦æéè¦){@link AbstractBeanFactory#registerDisposableBeanIfNecessary(String, Object, RootBeanDefinition)}
		1. org.springframework.beans.factory.config.DestructionAwareBeanPostProcessor#postProcessBeforeDestruction(Object,String) BPPæ¥å£
		2. org.springframework.beans.factory.DisposableBean æ¥å£
		3. èªå®ä¹ destroyæ¹æ³
		(å¨å®¹å¨å³é­æ¶ä¼è°ç¨ä¼æè¿ä¸ªé¡ºåºè°ç¨)

</code></pre>
<h2 id="åäº-å®æå®¹å¨å·æ°">åäº å®æå®¹å¨å·æ°</h2>
<p><code>org.springframework.context.support.AbstractApplicationContext#finishRefresh</code></p>
<pre><code class="language-java">/**  
 * Finish the refresh of this context, invoking the LifecycleProcessor's * onRefresh() method and publishing the * {@link org.springframework.context.event.ContextRefreshedEvent}.  
 */
 protected void finishRefresh() {  
   
}
</code></pre>
<h3 id="æ»ç»-10">æ»ç»</h3>
<ol>
<li>æ¸çåç§ç¼å­</li>
<li>ä¸ºå½åä¸ä¸æåå§åçå½å¨æå¤çå¨</li>
<li>åå¸ ContextRefreshedEvent (Context å®æå·æ°)äºä»¶</li>
</ol>
<h1 id="å³äº-bean-çç»§æ¿parentå±æ§">å³äº Bean çç»§æ¿(parentå±æ§)</h1>
<p>è¿éçç»§æ¿å java è¯­æ³ä¸­çç»§æ¿æ²¡æä»»ä½å³ç³», ä¸è¿æè·¯æ¯ç¸éç; child bean ä¼ç»§æ¿ parent bean çææéç½®, ä¹å¯ä»¥è¦çä¸äºéç½®, å½ç¶ä¹å¯ä»¥æ°å¢é¢å¤çéç½®;</p>
<p>Spring ä¸­æä¾äºç»§æ¿èª AbstractBeanDefinition ç ChildBeanDefinition æ¥è¡¨ç¤º child bean;</p>
<p>çå¦ä¸ä¸ä¸ªä¾å­:</p>
<pre><code class="language-xml">&lt;bean id="inheritedTestBean" abstract="true" class="org.springframework.beans.TestBean"&gt;
    &lt;property name="name" value="parent"/&gt;
    &lt;property name="age" value="1"/&gt;
&lt;/bean&gt;

&lt;bean id="inheritsWithDifferentClass" class="org.springframework.beans.DerivedTestBean"
        parent="inheritedTestBean" init-method="initialize"&gt;

    &lt;property name="name" value="override"/&gt;
&lt;/bean&gt;

</code></pre>
<p>parent bean è®¾ç½®äº <code>abstract="true"</code> æä»¥å®ä¸ä¼è¢«å®ä¾å, child bean<strong>(inheritsWithDifferentClass)</strong>ç»§æ¿äº parent bean<strong>(inheritedTestBean)</strong> ç<code> name</code> <code>age</code> ä¸¤ä¸ªå±æ§, ä½æ¯å¯¹ <code>name</code> å±æ§è¿è¡äºè¦å, å¢å äº<code>init-method</code>;</p>
<p><strong>in short: å³éç½®ç»§æ¿, child bean ä¼ç»§æ¿ scope, æé å¨åæ°å¼, å±æ§å¼, init-method, destroy-method ç­ç­éç½®</strong></p>
<pre><code class="language-java">@Configuration
public class WebConfigBeans {
	
	@Autowired
	private RequestMappingHandlerAdapter handlerAdapter;
	
	@PostConstruct
	public void initEditableValidation(){
		//è·å¾ RequestMappingHandler ä¸­ç ConfigurableWebBindingInitializer
		ConfigurableWebBindingInitializer initializer =(ConfigurableWebBindingInitializer)handlerAdapter.getWebBindingInitializer();
		if(initializer.getConversionService()!=null){
			GenericConversionService genericConversionService=(GenericConversionService)initializer.getConversionService();
			//æ·»å èªå®ä¹è½¬æ¢å¨
			genericConversionService.addConverter(new StringToDateConverter());
		}
	}
	
}
</code></pre>
<h1 id="å³äº-factorybean">å³äº FactoryBean</h1>
<p><code>org.springframework.beans.factory.FactoryBean</code> éç¨äº Bean çåå»ºè¿ç¨æ¯è¾å¤æçåºæ¯, æ¯å¦æ°æ®åºè¿æ¥æ± çåå»º;</p>
<p>æä»¬åè®¾ç°å¨éè¦åå»ºä¸ä¸ª Person ç Bean, é¦åæä»¬éè¦ä¸ä¸ª Car çå®ä¾, æä»¬è¿éåè®¾ Car çå®ä¾åå»ºå¾éº»ç¦, é£ä¹æä»¬å¯ä»¥æåå»º Car çå¤æè¿ç¨åè£èµ·æ¥:</p>
<p><strong>æ³¨æ: ä½¿ç¨FactoryBean å®å¨èªå®ä¹åå»ºBean, ä¸ä¼èµ°Beançå½å¨æçåç§ Processoråè°.</strong></p>
<pre><code class="language-java">public class MyCarFactoryBean implements FactoryBean&lt;Car&gt;{
    private String make; 
    private int year ;

    public void setMake(String m){ this.make =m ; }

    public void setYear(int y){ this.year = y; }

    public Car getObject(){ 
      // è¿éæä»¬åè®¾ Car çå®ä¾åè¿ç¨éå¸¸å¤æ, åæ­£å°±ä¸æ¯å è¡ä»£ç å¯ä»¥åå®çé£ç§
      CarBuilder cb = CarBuilder.car();

      if(year!=0) cb.setYear(this.year);
      if(StringUtils.hasText(this.make)) cb.setMake( this.make ); 
      return cb.factory(); 
    }

    public Class&lt;Car&gt; getObjectType() { return Car.class ; } 

    public boolean isSingleton() { return false; }
}
</code></pre>
<p>è£éçæ¶åæ¯æä¹éç½®ç:</p>
<pre><code class="language-xml">&lt;bean class = "com.javadoop.MyCarFactoryBean" id = "car"&gt;
  &lt;property name = "make" value ="Honda"/&gt;
  &lt;property name = "year" value ="1984"/&gt;
&lt;/bean&gt;
&lt;bean class = "com.javadoop.Person" id = "josh"&gt;
  &lt;property name = "car" ref = "car"/&gt;
&lt;/bean&gt;
</code></pre>
<p><strong>ç®èè¨ä¹ å°±æ¯å®ç° FactoryBeançæ¥å£çbean, æå ä¸ªæ¹æ³:<code>T getObject()</code> ,<code>Class&lt;?&gt; getObjectType();</code> <code>default boolean isSingleton()</code>, ç¨æ¥å°è£åå»ºå¤æçbean</strong></p>
<h1 id="å³äºå¾ªç¯ä¾èµçå¤ç">å³äºå¾ªç¯ä¾èµçå¤ç</h1>
<h2 id="ä¸ºä»ä¹è¦éè¦ä¸çº§ç¼å­">ä¸ºä»ä¹è¦éè¦ä¸çº§ç¼å­?</h2>
<p><code>singletonObjects</code>:<br>
ç¬¬ä¸çº§ç¼å­, éé¢æ¾ç½®çæ¯å·²ç»å®ä¾åå¥½çåä¾å¯¹è±¡, æ¯åä¾ç¼å­æ± ï¼singletonObjectsï¼</p>
<p><code>earlySingletonObjects</code>:<br>
ç¬¬äºçº§ç¼å­, éé¢å­æ¾çæ¯ææ©æåçåä¾å¯¹è±¡, æ©æå¯¹è±¡ï¼earlySingletonObjectsï¼. ç®åç²æ´çè¯´å°±æ¯newçå¯¹è±¡, å¯æ¯è¿ä¸ªå¯¹è±¡è¿æ²¡å¡«åå±æ§</p>
<p><code>singletonFactories</code>:<br>
ç¬¬ä¸çº§ç¼å­, éé¢å­æ¾çæ¯å°è¦è¢«å®ä¾åçå¯¹è±¡çå¯¹è±¡å·¥åï¼å­æ¾ bean å·¥åå¯¹è±¡ï¼, æ¯ä¸ä¸ªåè£¹å¯¹è±¡<code>ObjectFactory(registeredSingletons)</code>, ç»è¿getObjectè·åå°æ©æå¯¹è±¡.</p>
<p>æ­£å¸¸æ¥è®², å¤çå¾ªç¯ä¾èµ, ç±»ä¼¼äº¤æ¢åé, åªéè¦ä¸çº§ç¼å­å°±å¯ä»¥äº; å ä¸åä¾ç¼å­æ± , ä¸¤çº§ç¼å­æ± å³å¯;</p>
<pre><code class="language-js">function swap(a, b){
	temp = a;
	a = b;
	b = temp;
}
</code></pre>
<p>ä¾å¦: <code>Aservice</code> ä¾èµ Bservice, <code>Bservice</code> ä¾èµ <code>Aservice</code>.</p>
<p>åå»º <code>Aservice</code> æ¶, å°çæAçlambdaæ¾å¥ä¸çº§ç¼å­, å¡«åå±æ§ <code>Bservice</code>, ä¸äºä¸çº§ç¼å­ä¸­é½æ²¡,<br>
å»åå»º <code>Bservice</code>, å°çæBçlambdaæ¾å¥ä¸çº§ç¼å­, å¡«å <code>Aservice</code> å±æ§, åç°ä¸çº§ç¼å­ä¸­æA, æ§è¡Açlambdaçæ <code>Aservice</code> å¯¹è±¡, æ¾å¥äºçº§ç¼å­(ä¸è½æ¾ä¸çº§è¿æ¶åAçBserviceå±æ§è¿æ¯null), å¹¶å é¤Açä¸çº§ç¼å­,<br>
ç»§ç»­æ§è¡Bç lambda çæ <code>Bservice</code> å¯¹è±¡, æ¾å¥ä¸çº§ç¼å­, å¹¶å é¤Bçä¸çº§ç¼å­;<br>
åå»º <code>Aservice</code> çæµç¨ä¸­è·åå°Bserviceå¯¹è±¡ä¹å, æäºçº§ç¼å­ç <code>Aservice</code> å¯¹è±¡å é¤, å¹¶æ¾å¥ä¸çº§ç¼å­.</p>
<p>ç¬¬ä¸çº§ç¼å­æ¯å¤ç AOP å¢å¼ºçbean é®é¢:<br>
<strong>å ä¸ºä¸ç¥éå½åå¯¹è±¡ä»ä¹æ¶åä¼è¢«å¼ç¨, æä»¥åªè½å¨ç¬¬ä¸æ¬¡å¼ç¨çæ¶åæ¥å¤æ­å¯¹è±¡æ¯å¦éè¦è¢«ä»£ç, æä»¥å®æ¯ä¸ä¸ªlambdaè¡¨è¾¾å¼</strong></p>
<h1 id="å³äºçå½å¨æ">å³äºçå½å¨æ</h1>
<h2 id="springä¸­çbeançå½å¨æ">Springä¸­çBeançå½å¨æ</h2>
<p>Springä¸­çBeançå½å¨æå¯ä»¥åä¸ºä»¥ä¸å ä¸ªé¶æ®µ:</p>
<ol>
<li>å®ä¾åï¼Instantiationï¼: å¨è¿ä¸ªé¶æ®µ, Springå®¹å¨æ ¹æ®Beançéç½®ä¿¡æ¯åå»ºBeanå®ä¾. éå¸¸, è¿æ¯éè¿æé å½æ°æå·¥åæ¹æ³æ¥å®æç.</li>
<li>å±æ§èµå¼ï¼Property Assignmentï¼: å¨å®ä¾åä¹å, Springå®¹å¨å°ä¼å¯¹Beançå±æ§è¿è¡èµå¼. è¿å¯ä»¥éè¿setteræ¹æ³ãæ³¨è§£ãææé å½æ°åæ°æ¥å®ç°.</li>
<li>Awareæ¥å£åè°ï¼Aware Interface Callbacksï¼: å¨å±æ§èµå¼ä¹å, Springå®¹å¨ä¼æ£æ¥Beanæ¯å¦å®ç°äºAwareæ¥å£. å¦æå®ç°äº, å®¹å¨ä¼è°ç¨ç¸åºçAwareæ¥å£åè°æ¹æ³, è®©Beanè·åä¸å®¹å¨ç¸å³çé¢å¤ä¿¡æ¯.</li>
<li>åå§åï¼Initializationï¼: å¨å±æ§èµå¼å®æå, Springå®¹å¨ä¼è°ç¨Beançåå§ååè°æ¹æ³. è¿å¯ä»¥éè¿å®ç°InitializingBeanæ¥å£çafterPropertiesSet()æ¹æ³æå¨éç½®æä»¶ä¸­å£°æçèªå®ä¹åå§åæ¹æ³æ¥å®ç°.</li>
<li>BeanPostProcessoråè°ï¼BeanPostProcessor Callbacksï¼: å¨Beanåå§åä¹ååä¹å, Springå®¹å¨ä¼è°ç¨æ³¨åçBeanPostProcessoræ¥å£çæ¹æ³. è¿åè®¸æ¨å¨Beançåå§åè¿ç¨ä¸­è¿è¡èªå®ä¹å¤ç, å¦æ·»å é¢å¤çé»è¾æå¯¹Beanè¿è¡ä»£çåè£.</li>
<li>ä½¿ç¨ï¼Bean in Useï¼: å¨åå§åå®æå, Beanå°±å¯ä»¥è¢«åºç¨ç¨åºä½¿ç¨äº</li>
<li>éæ¯ï¼Destructionï¼: å½å®¹å¨å³é­æèä»å®¹å¨ä¸­ç§»é¤Beanæ¶, ä¼è§¦åBeançéæ¯. è¿å¯ä»¥éè¿å®ç° DisposableBean æ¥å£çdestroy()æ¹æ³æå¨éç½®æä»¶ä¸­å£°æçèªå®ä¹éæ¯æ¹æ³æ¥å®ç°.</li>
</ol>
<p>å®ä¾å -&gt; å¡«åå±æ§ -&gt; åç§Aware<br>
-&gt; è°ç¨ BeanPostProcessor (åå§å)<br>
-&gt; è°ç¨ InitializingBean -&gt; è°ç¨èªå®ä¹ init-method<br>
-&gt; è°ç¨ BeanPostProcessor (åå§å)<br>
&lt;ä½¿ç¨&gt;<br>
-&gt; è°ç¨ DisposableBean -&gt; è°ç¨èªå®ä¹ destroy-method</p>

</div>
<div id="MySignature" role="contentinfo">
    é¢é²èå¹´ç´åï¼ä¿æç»èº«å­¦ä¹ !    ââ <a href="https://www.cnblogs.com/dddy/" target="_blank">daidaidaiyu</a>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.5236111111111111" data-date-updated="2026-01-14 10:43">2026-01-13 22:09</span>&nbsp;
<a href="https://www.cnblogs.com/dddy">daidaidaiyu</a>&nbsp;
éè¯»(<span id="post_view_count">60</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479364);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479364', targetLink: 'https://www.cnblogs.com/dddy/p/19479364', title: 'Spring IOC æºç å­¦ä¹  ä¸æå­¦ä¹ å®æ´çå è½½æµç¨' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãAzure ç¯å¢ãå¨Windowsç¯å¢ä¸­ä½¿ç¨OpenSSLçæèªç­¾åè¯ä¹¦é¾æ­¥éª¤åäº« ]]></title>
    <link>https://www.cnblogs.com/lulight/p/19479238</link>
    <guid>cc892459ded5cd2cd97221b69af18484</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lulight/p/19479238" title="åå¸äº 2026-01-13 21:08">
    <span role="heading" aria-level="2">ãAzure ç¯å¢ãå¨Windowsç¯å¢ä¸­ä½¿ç¨OpenSSLçæèªç­¾åè¯ä¹¦é¾æ­¥éª¤åäº«</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h1>é®é¢æè¿°</h1>
<p>å¨Webåºç¨é¨ç½²ç¯å¢ä¸­ï¼å¸¸å¸¸éè¦ä¸ºåé¨ç³»ç»ææµè¯ç¯å¢çæèªç­¾åè¯ä¹¦ï¼å°¤å¶æ¯åå«æ ¹è¯ä¹¦ãä¸­é´è¯ä¹¦åæå¡å¨è¯ä¹¦çå®æ´è¯ä¹¦é¾ï¼å¹¶æç»çæåå«ç§é¥ç PFX æä»¶ï¼.pfxï¼ã</p>
<p>å¦ä½ä½¿ç¨ openssl å·¥å·ä¸æ­¥æ­¥å®æè¿äºæä½ï¼æä¸ºå¾å¤å·¥ç¨å¸çå®ééæ±ã</p>
<p>æ¬æå°è¯¦ç»ä»ç»å¦ä½ç¨ openssl çæèªç­¾åè¯ä¹¦é¾ï¼å¹¶å°å¶æåä¸º PFX æä»¶ã</p>
<p>&nbsp;</p>
<h1>é®é¢è§£ç­</h1>
<p class="code-line" dir="auto" data-line="26">ä¸é¢æ¯ä¸å¥<strong>å¯å¤å¶å³ç¨</strong>çåæ­¥éª¤æåï¼ä½¿ç¨&nbsp;<strong>OpenSSL</strong>&nbsp;å¨æ¬æºåå»ºä¸ç±»è¯ä¹¦ï¼</p>
<ol class="code-line" dir="auto" data-line="28"><ol class="code-line" dir="auto" data-line="28">
<li class="code-line" dir="auto" data-line="8">èªç­¾å&nbsp;<strong>æ ¹ CAï¼Root CAï¼</strong>ï¼</li>
<li class="code-line" dir="auto" data-line="8">ç±æ ¹ CA ç­¾åç&nbsp;<strong>ä¸­é´ CAï¼Intermediate CAï¼</strong>ï¼</li>
<li class="code-line" dir="auto" data-line="8">ç±ä¸­é´ CA ç­¾åç&nbsp;<strong>æå¡å¨è¯ä¹¦ï¼Leaf/Server Certï¼</strong>ã</li>
</ol></ol>
<p class="code-line" dir="auto" data-line="8">åæ¶åå«&nbsp;<code>openssl.cnf</code>&nbsp;çç¤ºä¾ãè¯ä¹¦é¾éªè¯å½ä»¤ï¼ä»¥åçæ<strong>åå«ä¸å¼ è¯ä¹¦</strong>ï¼æå¡å¨ + ä¸­é´ + æ ¹ï¼ç&nbsp;<strong>PFX</strong>&nbsp;åçåæ³ã</p>
<p class="code-line" dir="auto" data-line="8">çæçæ­¥éª¤å¦ä¸æµç¨å¾æç¤ºã</p>
<p><img alt="image" width="666" height="664" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202601/2127802-20260113201926425-172063268.png" class="lazyload"></p>
<h2>ç¬¬ä¸æ­¥ï¼å®è£OpenSSL</h2>
<p>ä¸è½½è·¯å¾ï¼<a href="https://openssl-library.org/source/" target="_blank" rel="noopener nofollow">Downloads | OpenSSL Library</a>, Windows ç¯å¢ä¸­ç´æ¥ä¸è½½ææ°ç&nbsp;.tar.gz æä»¶ï¼æ¬å°è§£ååå¯ç´æ¥ä½¿ç¨</p>
<p>PS: æå¥½å¨PATHç¯å¢åéä¸­æ·»å OpenSSLçè·¯å¾ï¼æ¹ä¾¿åç»­ä½¿ç¨ã</p>
<p>&nbsp;</p>
<h2>ç¬¬äºæ­¥ï¼åå»ºéç½®æä»¶ openssl.cnf</h2>
<p>åå¤ä¸ä¸ªçæåå­æ¾è¯ä¹¦çç®å½ï¼ç¶ååå»ºopenssl.cnfæä»¶ï¼å¦ï¼</p>
<blockquote>
<div>mkdir certs_1 &amp;&amp; cd certs_1</div>
</blockquote>
<div>åå§åçopenssl.cnfåå®¹å¦ä¸ï¼éè¦æ¿æ¢åååç»ç»ä¿¡æ¯</div>
<div>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;"># ----- Basic req settings -----
[ req ]
default_bits        = 2048
prompt              = no
distinguished_name  = dn
req_extensions      = req_ext

<span style="background-color: rgba(255, 255, 0, 1)">[ dn ]
C   = CN
ST  = CQ
L   = CQ
O   = SelfCA Org
OU  = CertOps
CN  = myself.com</span>

# CSR-time extra extensions (used by: -reqexts req_ext)
[ req_ext ]
subjectAltName = @alt_names

<span style="background-color: rgba(255, 255, 0, 1)">[ alt_names ]
DNS.1 = *.myself.com
DNS.2 = www.myself.com</span>

# ----- Root CA certificate extensions -----
[ v3_root_ca ]
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid:always,issuer
basicConstraints = critical, CA:TRUE, pathlen:1
keyUsage = critical, keyCertSign, cRLSign

# ----- Intermediate CA certificate extensions -----
[ v3_intermediate_ca ]
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid:always,issuer
basicConstraints = critical, CA:TRUE, pathlen:0
keyUsage = critical, keyCertSign, cRLSign

# ----- Server (leaf) certificate extensions -----
[ server_cert ]
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer
basicConstraints = CA:FALSE
keyUsage = critical, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth
subjectAltName = @alt_names

# CSR-time server req (used with: -reqexts server_req)
[ server_req ]
basicConstraints = CA:FALSE
keyUsage = digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth</pre>
</div>
</div>
<h2>ç¬¬ä¸æ­¥ï¼çæ<span style="color: rgba(255, 102, 0, 1)"><strong>æ ¹CA</strong></span>ç§é¥åè¯ä¹¦</h2>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;"># çææ ¹ CA ç§é¥ï¼å å¯ç§é¥éè¾å¥å£ä»¤ï¼å¦ä¸å å¯å»æ -aes256ï¼
openssl genrsa -aes256 -out rootCA.key 4096

# çææ ¹ CA ç CSRï¼å¯ç´æ¥èªç­¾ï¼CN å¯åç»ç»åæ "Example Root CA"ï¼
openssl req -new -sha256 -key rootCA.key -out rootCA.csr -subj "/C=CN/ST=CQ /O=SelfCA Org/CN=My Self Root CA" -config openssl.cnf

# ä½¿ç¨ X.509 èªç­¾çææ ¹ CA è¯ä¹¦ï¼10 å¹´æææä¸¾ä¾ï¼
openssl x509 -req -sha256 -days 3650 -in rootCA.csr -signkey rootCA.key -out rootCA.crt -extfile openssl.cnf -extensions v3_root_ca</pre>
</div>
<h2>ç¬¬åæ­¥ï¼çæ<span style="color: rgba(255, 102, 0, 1)">ä¸­é´<strong>CA</strong></span>ç§é¥åè¯ä¹¦</h2>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">#çæä¸­é´ CA ç§é¥ä¸ CSR

openssl genrsa -out interCA.key 4096 openssl req -new -sha256 -key interCA.key -out interCA.csr -subj "/C=CN/ST=CQ/O=Self Intermediate Org/CN=My Self Intermediate CA" -config openssl.cnf
<br>
# ç¨æ ¹ CA ç­¾åä¸­é´ CA è¯ä¹¦
# éè¿æ ¹ CA ä¸ºä¸­é´ CA CSR ç­¾åï¼å¹¶æå®ä¸­é´ CA æ©å±ï¼pathlen=0/1 è§éæ±ï¼

openssl x509 -req -sha256 -days 1825 -in interCA.csr -CA rootCA.crt -CAkey rootCA.key -CAcreateserial -out interCA.crt -extfile openssl.cnf -extensions v3_intermediate_ca </pre>
</div>
<h2>ç¬¬äºæ­¥ï¼çæ<span style="color: rgba(255, 102, 0, 1)">æå¡å¨</span>ç§é¥åè¯ä¹¦</h2>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;"># çææå¡å¨ç§é¥ä¸ CSRï¼å« SANï¼
openssl genrsa -out server.key 2048

# çæ CSRï¼å¹¶å¨ -req æ©å±ä¸­å£°æ SANï¼å¨ openssl.cnf ç [server_req] ä¸ [alt_names] ä¸­å®ä¹ï¼
openssl req -new -sha256 -key server.key -out server.csr   -subj "/C=CN/ST=CQ/O=My Self Server Org/CN=*.mytest.com"   -config openssl.cnf -reqexts server_req

# ç¨ä¸­é´ CA ä¸ºæå¡å¨ CSR ç­¾å
openssl x509 -req -sha256 -days 825   -in server.csr   -CA interCA.crt -CAkey interCA.key -CAcreateserial   -out server.crt   -extfile openssl.cnf -extensions server_cert</pre>
<p>&nbsp;</p>
</div>
<p>ç¬¬ä¸ï¼åï¼äºæ­¥çå®éªç»æå¦å¾ï¼</p>
<p><img alt="image" width="666" height="231" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202601/2127802-20260113204733937-420736149.png" class="lazyload"></p>
<h2>ç¬¬å­æ­¥ï¼åå¹¶è¯ä¹¦é¾</h2>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;"># æé å®æ´è¯ä¹¦é¾æä»¶ï¼Intermediate + Rootï¼

type interCA.crt rootCA.crt &gt; chain.crt

# éªè¯ server.crt æ¯å¦è½ç± chain.crtï¼ä¸­é´+æ ¹ï¼ææå®æ´ä¿¡ä»»é¾

openssl verify -CAfile chain.crt server.crt</pre>
</div>
<h2>ç¬¬ä¸æ­¥ï¼çæPFXæä»¶</h2>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;"># å°ä¸­é´+æ ¹åå¹¶ä¸º chain.crt åä¸èµ·å¯¼å¥
openssl pkcs12 -export -out server_fullchain.pfx   -inkey server.key -in server.crt   -certfile chain.crt   -name "My Self Full Server Cert"   -passout pass:xxxxxxxxx
</pre>
</div>
<p>æç»æçæçè¯ä¹¦æä»¶å±ç¤ºï¼</p>
<p><img alt="image" width="666" height="546" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202601/2127802-20260113210344762-1429403106.png" class="lazyload"></p>
<p>&nbsp;</p>
<h1>åèèµæ</h1>
<p>openssl å®æ¹ææ¡£ï¼<a href="https://www.openssl.org/docs/" target="_blank" rel="noopener nofollow">https://www.openssl.org/docs/</a>&nbsp;</p>
<p id="generate-an-azure-application-gateway-self-signed-certificate-with-a-custom-root-ca">Generate an Azure Application Gateway self-signed certificate with a custom root CA :&nbsp;<a href="https://learn.microsoft.com/en-us/azure/application-gateway/self-signed-certificates" target="_blank" rel="noopener nofollow">https://learn.microsoft.com/en-us/azure/application-gateway/self-signed-certificates</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1>&nbsp;</h1>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;</p>
</div>
<div id="MySignature" role="contentinfo">
    <div style="background: #1c5f55;height: 36px;width: 618px;padding: 14px 5px 0px 3px;">
  <p style="
    font-weight: bold;
    color: white;
">å½å¨å¤æçç¯å¢ä¸­é¢ä¸´é®é¢ï¼æ ¼ç©ä¹ééï¼æµèéä¹å¾æ¸ï¼å®ä»¥å¨ä¹å¾çã äºä¸­ï¼æ°æ¯å¦æ­¤!</p>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 21:08">2026-01-13 21:08</span>&nbsp;
<a href="https://www.cnblogs.com/lulight">ç¼ç èå¢å¸</a>&nbsp;
éè¯»(<span id="post_view_count">31</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479238);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479238', targetLink: 'https://www.cnblogs.com/lulight/p/19479238', title: 'ãAzure ç¯å¢ãå¨Windowsç¯å¢ä¸­ä½¿ç¨OpenSSLçæèªç­¾åè¯ä¹¦é¾æ­¥éª¤åäº«' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ SpringBoot å®å®£åæ­¢ç»´æ¤ 3.2.x~3.4.xï¼ ]]></title>
    <link>https://www.cnblogs.com/javaguide/p/19479183</link>
    <guid>ac37d86835dd8ba1ed86a83eca1e3493</guid>
    <description>
    <![CDATA[ 
        <h2>
            <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/javaguide/p/19479183" title="åå¸äº 2026-01-13 20:44">
    <span role="heading" aria-level="2">SpringBoot å®å®£åæ­¢ç»´æ¤ 3.2.x~3.4.xï¼</span>
    

</a>

        </h2>
        <div class="postbody">
            <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¤§å®¶å¥½ï¼ææ¯ Guideï¼ææ¯çè¿­ä»£éåº¦ææ¶åççå¿«å°è®©äººçªæ¯ã</p>
<p>å°±å¨åéµå­ï¼<strong>Spring Boot 4.0</strong> æ­£å¼åå¸ï¼3.2.xã3.3.x å 3.4.x è¿äº 2024 å¹´åå¸ççæ¬å®æ¹å·²ç»ä¸å¨ç»´æ¤äºï¼ä¹å°±æ¯ä¸åæä¾åè´¹çå®å¨æ´æ°åéè¯¯ä¿®å¤ã</p>
<p>ä¸å¾æ¥æºäº SpringBoot å®æ¹ææ¡£ï¼<strong><a href="https://spring.io/projects/spring-boot#support" target="_blank" rel="noopener nofollow">https://spring.io/projects/spring-boot#support</a></strong> ã</p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202601/1843652-20260113204341636-134362817.png" alt="" loading="lazy"></p>
<p>å¶å®å½±åä¹ä¸å¤§ï¼å¾å¤èé¡¹ç®ç®åè¿æ¯ 2.x çæ¬ï¼çè³è¿æåçå¨ 1.x çæ¬çã</p>
<p>å¯¹äºå¬å¸é¡¹ç®ï¼å¦æè½ç¨³å®è¿è¡ï¼å°±ä¸å¿è¦å¼ºè¡å»åçº§æ°çæ¬ãä½ åçº§äºï¼èæ¿çä¸å°ææï¼è¿å®¹æåºç°é®é¢ï¼ä¸åºç°é®é¢è¯´ä¸å®å°±æ¯ä½ èéã</p>
<p>ä¸è¿ï¼å¯¹äºæ°é¡¹ç®åä¸ªäººé¡¹ç®æ¥è¯´ï¼è¿æ¯åºè¯¥å°½éä½¿ç¨ç¸å¯¹è¾æ°ä¸ç¨³å®ççæ¬ã</p>
<p><a href="https://javaguide.cn/zhuanlan/interview-guide.html" target="_blank" rel="noopener nofollow">InterviewGuide</a> ï¼åºäº Spring Boot 4.0 + Java 21 + Spring AI å¼åç AI ç®ååæåæ¨¡æé¢è¯ç³»ç»ï¼è¿ä¸ªé¡¹ç®æå½æ¶å¾çäºå¤å¶äºä¸ä¸ä¸ªé¡¹ç®çé¨åä¾èµæä»¶ï¼å¯¼è´ SpringBoot çæ¬æ¯ 3.3ï¼ç»èªå·±æ¾äºä¸ä¸ªéº»ç¦ï¼</p>
<p>æä¸å°æååé¦å»ºè®®å°å¶åçº§ä¸º 4.0 çæ¬ï¼äºæ¯ææ¨å¤©å°±æè¿ä»¶äºåäºï¼</p>
<p>è¿ä¸è·¯è¸©äºä¸å°åï¼å°¤å¶æ¯ Jackson 3 çååå¤§æ¹ï¼ç®ç´æ¯âå²è¯çº§âç Breaking Changeãä»å¤©å°±æè¿ä»½<strong>ç©¿éå¼åçº§æå</strong>åäº«ç»å¤§å®¶ï¼å»ºè®®æ¶èå¤ç¨ï¼</p>
<p>å·ä½çæ´æ°åå®¹å¯ä»¥æ¥çè¿ä¸ª Commitï¼<strong><a href="https://github.com/Snailclimb/interview-guide/commit/f7bb05980b725c8658f93a4c511bf4b2ec616b82" target="_blank" rel="noopener nofollow">https://github.com/Snailclimb/interview-guide/commit/f7bb05980b725c8658f93a4c511bf4b2ec616b82</a></strong> ã</p>
<h2 id="ä¸ºä»ä¹è¦åçº§">ä¸ºä»ä¹è¦åçº§ï¼</h2>
<p>Spring Boot 4.0.0 åºäº Spring Framework 7.0ï¼å¨é¢æ¯æ Java 25ï¼å«èæçº¿ç¨ä¼åï¼ãæ ¸å¿æ°ç¹æ§åæ¬ï¼HTTP Service Clients ç®åè¿ç¨è°ç¨ï¼åç API çæ¬ç®¡çï¼å¨é¢éç¨ JSpecify ç©ºå®å¨ä½ç³»ï¼é»è®¤éç©ºï¼ç¼è¯æé² NPEï¼ï¼å³é®ä¾èµåçº§è³ Jackson 3.0ãTomcat 11ãHibernate 7.1 ç­ï¼æ¨¡ååè®¾è®¡æ¹è¿ï¼åæ¯æ Gradle 9ï¼Redis éæä¸»ä»éç½®ï¼ç§»é¤ Undertowã</p>
<p>æä¸é¨åäº«è¿ä¸ç¯æç« ä»ç»è¿äºæ°ç¹æ§ï¼<a href="https://zhuanlan.zhihu.com/p/1975242864071026251" target="_blank" rel="noopener nofollow">Spring Boot 4.0 æ­£å¼åå¸ï¼äººå·²éº»ããã</a>ï¼ç¡®å®å·²ç»éº»äºï¼ã</p>
<h2 id="çæ¬åæ´æ»è§">çæ¬åæ´æ»è§</h2>
<p>å¨è¿éæä¸ªéï¼åçº§åä¸å«âè·³çº§âãå®æ¹å»ºè®®çåçº§è·¯å¾ï¼<strong>3.3/3.4 â 3.5 â 4.0</strong>ï¼è¿æ¡è·¯å¾è½é¿å 90% çåã</p>
<table>
<thead>
<tr>
<th>ç»ä»¶</th>
<th>åçº§å</th>
<th>åçº§å</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spring Boot</td>
<td>3.3.6</td>
<td>4.0.1</td>
</tr>
<tr>
<td>Spring Framework</td>
<td>6.x</td>
<td>7.x</td>
</tr>
<tr>
<td>Spring AI</td>
<td>1.1.2</td>
<td>2.0.0-M1</td>
</tr>
<tr>
<td>Redisson</td>
<td>3.24.3</td>
<td>4.0.0</td>
</tr>
<tr>
<td>Gradle</td>
<td>8.8</td>
<td>8.14</td>
</tr>
<tr>
<td>Hibernate</td>
<td>6.x</td>
<td>7.2.0.Final</td>
</tr>
<tr>
<td>Tomcat</td>
<td>10.x</td>
<td>11.0.15</td>
</tr>
<tr>
<td>Jackson</td>
<td>2.x</td>
<td>3.x</td>
</tr>
<tr>
<td>iText</td>
<td>7.2.5</td>
<td>8.0.5</td>
</tr>
<tr>
<td>MapStruct</td>
<td>1.5.5.Final</td>
<td>1.6.3</td>
</tr>
</tbody>
</table>
<h2 id="åçº§æ­¥éª¤è¯¦è§£">åçº§æ­¥éª¤è¯¦è§£</h2>
<h3 id="step-1-åçº§-gradle">Step 1: åçº§ Gradle</h3>
<p>Spring Boot 4.0 è¦æ± Gradle 8.14 ææ´é«çæ¬ãé¦åéè¦åçº§ Gradle Wrapperï¼</p>
<pre><code class="language-bash"># ä¸´æ¶ä½¿ç¨æ§çæ¬ Spring Boot æ§è¡ wrapper åçº§å½ä»¤
./gradlew wrapper --gradle-version=8.14
</code></pre>
<p>ä¿®æ¹ <code>gradle/wrapper/gradle-wrapper.properties</code>ï¼</p>
<pre><code class="language-properties">distributionUrl=https\://services.gradle.org/distributions/gradle-8.14-bin.zip
</code></pre>
<h3 id="step-2-æ´æ°ä¾èµçæ¬">Step 2: æ´æ°ä¾èµçæ¬</h3>
<p>ä¿®æ¹ <code>gradle/libs.versions.toml</code>ï¼</p>
<pre><code class="language-toml">[versions]
spring-boot = "4.0.1"
spring-ai = "2.0.0-M1"
redisson = "4.0.0"
mapstruct = "1.6.3"
aws-sdk = "2.29.51"
itext = "8.0.5"
lombok = "1.18.36"
junit-jupiter = "5.12.0"

[plugins]
spring-boot = { id = "org.springframework.boot", version.ref = "spring-boot" }
spring-dependency-management = { id = "io.spring.dependency-management", version = "1.1.7" }
</code></pre>
<p><code>libs.versions.toml</code>æ¯ Gradle 7.0 å¼å¥å¹¶ä» 7.4 çæ¬å¼å§æ­£å¼æ¨èç <strong>âçæ¬ç®å½âï¼Version Catalogï¼</strong> æä»¶ãå®çæ ¸å¿ä½ç¨æ¯<strong>éä¸­ç®¡çé¡¹ç®ä¸­ææçä¾èµåºåå¶çæ¬å·</strong>ã</p>
<h3 id="step-3-æ¨¡ååéæ-starter-åæ´">Step 3: æ¨¡ååéæ (Starter åæ´)</h3>
<p>Spring Boot 4.0 éç¨äºæ´ç»ç²åº¦çæ¨¡ååè®¾è®¡ï¼éè¦æ´æ° starter ä¾èµï¼</p>
<pre><code class="language-groovy">// åçº§å
implementation 'org.springframework.boot:spring-boot-starter-web'

// åçº§å
implementation 'org.springframework.boot:spring-boot-starter-webmvc'
</code></pre>
<p>å®æ´ç <code>build.gradle</code> ä¾èµåæ´ï¼</p>
<pre><code class="language-groovy">dependencies {
    // Spring Boot Starters (Boot 4.0 modular design)
    implementation 'org.springframework.boot:spring-boot-starter-webmvc'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'

    // Spring AI 2.0
    implementation "org.springframework.ai:spring-ai-starter-model-openai:${libs.versions.spring.ai.get()}"
    implementation "org.springframework.ai:spring-ai-starter-vector-store-pgvector:${libs.versions.spring.ai.get()}"

    // Redisson 4.0
    implementation "org.redisson:redisson-spring-boot-starter:${libs.versions.redisson.get()}"

    // iText 8
    implementation "com.itextpdf:itext-core:${libs.versions.itext.get()}"
    implementation "com.itextpdf:font-asian:${libs.versions.itext.get()}"
}
</code></pre>
<h3 id="step-4-å²ä¸æåç-jackson-3-è¿ç§»">Step 4: å²ä¸æåç Jackson 3 è¿ç§»</h3>
<p>è¿æ¯æ¬æ¬¡åçº§æçè¦çé¨åãJackson 3 å°ååä» <code>com.fasterxml.jackson</code> å¨é¢æ¹ä¸ºäº <code>tools.jackson</code>ãè¿æå³çä½ é¡¹ç®ä¸­ææç <code>ObjectMapper</code>ã<code>JsonNode</code> å¯¼å¥é½å¤±æäºã</p>
<p><strong>éè¦ä¿®æ¹çå¯¼å¥è¯­å¥ï¼</strong></p>
<table>
<thead>
<tr>
<th>åçº§å</th>
<th>åçº§å</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>com.fasterxml.jackson.databind.ObjectMapper</code></td>
<td><code>tools.jackson.databind.ObjectMapper</code></td>
</tr>
<tr>
<td><code>com.fasterxml.jackson.core.type.TypeReference</code></td>
<td><code>tools.jackson.core.type.TypeReference</code></td>
</tr>
<tr>
<td><code>com.fasterxml.jackson.core.JsonProcessingException</code></td>
<td><code>tools.jackson.core.JacksonException</code></td>
</tr>
</tbody>
</table>
<p><strong>ç¤ºä¾ä»£ç ä¿®æ¹ï¼</strong></p>
<pre><code class="language-java">// åçº§å
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;

try {
    String json = objectMapper.writeValueAsString(data);
} catch (JsonProcessingException e) {
    // å¤çå¼å¸¸
}

// åçº§å
import tools.jackson.core.JacksonException;
import tools.jackson.core.type.TypeReference;
import tools.jackson.databind.ObjectMapper;

try {
    String json = objectMapper.writeValueAsString(data);
} catch (JacksonException e) {
    // å¤çå¼å¸¸
}
</code></pre>
<p>æä»¬éè¦å¨ <code>PdfExportService</code>ã<code>RedisService</code> ç­ 7 ä¸ªæ ¸å¿ä¸å¡ç±»ä¸­ï¼å©ç¨ IDE çå¨å±æ¿æ¢åè½ï¼å° <code>com.fasterxml.jackson</code> ç»ä¸ä¿®æ­£ä¸º <code>tools.jackson</code>ã</p>
<h3 id="step-5-redisson-40-api-è¿ç§»">Step 5: Redisson 4.0 API è¿ç§»</h3>
<p>Redisson 4.0 å¯¹é¨åç±»è¿è¡äºåéç»ï¼<code>StreamMessageId</code> ç­ Stream ç¸å³ç±»ç§»è³æ°åï¼</p>
<pre><code class="language-java">// åçº§å
import org.redisson.api.StreamMessageId;

// åçº§å
import org.redisson.api.stream.StreamMessageId;
</code></pre>
<p>è¿ä¸ªè¿å¥½ç¹ï¼åªæ¶åå° 3 ä¸ªç±»ï¼</p>
<ul>
<li><code>infrastructure/redis/RedisService.java</code></li>
<li><code>modules/resume/listener/AnalyzeStreamConsumer.java</code></li>
<li><code>modules/knowledgebase/listener/VectorizeStreamConsumer.java</code></li>
</ul>
<h2 id="éªè¯åçº§ç»æ">éªè¯åçº§ç»æ</h2>
<p>åçº§å®æåï¼è¿è¡ä»¥ä¸å½ä»¤éªè¯ï¼</p>
<pre><code class="language-bash"># ç¼è¯é¡¹ç®
./gradlew :app:compileJava

# è¿è¡æµè¯
./gradlew :app:build

# å¯å¨åºç¨
./gradlew :app:bootRun
</code></pre>
<p>æåå¯å¨åï¼æ¥å¿åºæ¾ç¤ºï¼</p>
<pre><code>  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/

 :: Spring Boot ::                (v4.0.1)

... Tomcat initialized with port 8080 (http)
... Starting Servlet engine: [Apache Tomcat/11.0.15]
... Redisson 4.0.0
... HHH000001: Hibernate ORM core version 7.2.0.Final
</code></pre>
<h2 id="åèèµæ">åèèµæ</h2>
<ul>
<li><a href="https://spring.io/blog/2025/11/20/spring-boot-4-0-0-available-now/" target="_blank" rel="noopener nofollow">Spring Boot 4.0 åå¸å¬å</a></li>
<li><a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-4.0-Migration-Guide" target="_blank" rel="noopener nofollow">Spring Boot 4.0 Migration Guide</a></li>
<li><a href="https://spring.io/blog/2025/12/11/spring-ai-2-0-0-M1-available-now/" target="_blank" rel="noopener nofollow">Spring AI 2.0.0-M1 åå¸å¬å</a></li>
<li><a href="https://github.com/redisson/redisson/blob/master/CHANGELOG.md" target="_blank" rel="noopener nofollow">Redisson Changelog</a></li>
<li><a href="https://github.com/FasterXML/jackson/wiki/Jackson-Release-3.0" target="_blank" rel="noopener nofollow">Jackson 3 Release Notes</a></li>
</ul>
<h2 id="æ»ç»">æ»ç»</h2>
<p>æ¬æ¬¡ Spring Boot 4.0 çåçº§ä¸»è¦æ¶åä»¥ä¸å ä¸ªæ¹é¢ï¼</p>
<ol>
<li><strong>æå»ºå·¥å·åçº§</strong>ï¼Gradle 8.14+</li>
<li><strong>æ¨¡åååæ´</strong>ï¼<code>starter-web</code> â <code>starter-webmvc</code></li>
<li><strong>Jackson 3 è¿ç§»</strong>ï¼ååä» <code>com.fasterxml.jackson</code> æ¹ä¸º <code>tools.jackson</code></li>
<li><strong>ç¬¬ä¸æ¹åºå¼å®¹</strong>ï¼RedissonãSpring AI ç­éè¦åçº§å°å¯¹åºçå¼å®¹çæ¬</li>
</ol>
<p>éµå¾ªå®æ¹æ¨èç 3.3 â 3.5 â 4.0 åçº§è·¯å¾ï¼å¯ä»¥æ´å¹³æ»å°å®æè¿ç§»ãåçº§è¿ç¨ä¸­éå°çå¤§å¤æ°é®é¢é½ä¸åååæ´æå³ï¼éè¿å¨å±æç´¢æ¿æ¢å³å¯è§£å³ã</p>
<p><a href="https://javaguide.cn/zhuanlan/interview-guide.html" target="_blank" rel="noopener nofollow">InterviewGuide</a> ä¼ éé¨ï¼</p>
<ul>
<li>Github å°åï¼<strong><a href="https://github.com/Snailclimb/interview-guide" target="_blank" rel="noopener nofollow">https://github.com/Snailclimb/interview-guide</a></strong></li>
<li>Gitee å°åï¼<strong><a href="https://gitee.com/SnailClimb/interview-guide" target="_blank" rel="noopener nofollow">https://gitee.com/SnailClimb/interview-guide</a></strong></li>
</ul>

</div>
<div class="clear"></div>

        </div>
        <p class="postfoot">
            posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 20:44">2026-01-13 20:44</span>&nbsp;
<a href="https://www.cnblogs.com/javaguide">JavaGuide</a>&nbsp;
éè¯»(<span id="post_view_count">120</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479183);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479183', targetLink: 'https://www.cnblogs.com/javaguide/p/19479183', title: 'SpringBoot å®å®£åæ­¢ç»´æ¤ 3.2.x~3.4.xï¼' })">ä¸¾æ¥</a>

        </p>
     ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ SpringBoot-shiro-jwt-dubbo-redisåå¸å¼ç»ä¸æéç³»ç»ï¼å®ç»ï¼ ]]></title>
    <link>https://www.cnblogs.com/alineverstop/p/19482539</link>
    <guid>125b5a4b7a9f598abcfdde8e55922d02</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/alineverstop/p/19482539" title="åå¸äº 2026-01-14 15:51">
    <span role="heading" aria-level="2">SpringBoot-shiro-jwt-dubbo-redisåå¸å¼ç»ä¸æéç³»ç»ï¼å®ç»ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>åå¸å¼ç»ä¸æéç³»ç»</p>
<h1 id="è®¾è®¡">è®¾è®¡</h1>
<p><img alt="2026-1-14-1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3388489/202601/3388489-20260114154709552-1476767389.png" class="lazyload"></p>
<p>shiro-mgt:ç¨æ·ãè§è²ãèµæºçå®ä¹ï¼èµæºå¯¹åºç½å³çå®ä¹ï¼å¨æé¾çå®ä¹</p>
<p>shiroé´ææå¡éç¾¤ï¼ä¼è¯ä¿¡æ¯ãRealmä¿¡æ¯</p>
<p>dubbo-appéç¾¤ï¼å®éä¸å¡ç¸å³</p>
<h1 id="æ¨¡åä¾èµ">æ¨¡åä¾èµ</h1>
<p><img alt="2026-1-14-2" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3388489/202601/3388489-20260114154724948-1921692392.png" class="lazyload"></p>
<p>Springboot-shiro-gateway-handleråè½ï¼</p>
<ol>
<li>dubboä¸å¡æå¡è½¬æ¢httpéè®¯</li>
<li>è®¤è¯ä¸é´ææå¡åæ¶è´¹è</li>
<li>çæä¸å¡æå¡åæ¶è´¹è</li>
</ol>
<p>springboot-shiro-produceråè½ï¼</p>
<ol>
<li>è®¤è¯ä¸é´æçæå¡åçæè</li>
</ol>
<p>springboot-shiro-mgtåè½ï¼</p>
<ol>
<li>è®¤è¯ä¸é´æçæå¡åæ¶è´¹è</li>
</ol>
<p>springboot-shiro-dubbo-app-handleråè½ï¼</p>
<ol>
<li>çæä¸å¡æå¡åçäº§è</li>
</ol>
<h1 id="å¨æè¿æ»¤å¨é¾">å¨æè¿æ»¤å¨é¾</h1>
<p>å®ç°å¨æè¿æ»¤å¨é¾ï¼æä»¬éè¦ä¿è¯ä»¥ä¸å ä¸ªç¹æ§ï¼</p>
<p>1ãæä¹åï¼åæçpropertiesåå®¹æ¾å¥æ°æ®åºï¼</p>
<p>2ãæåºæ§ï¼å è¿æ»¤å¨é¾æåºå è½½çç¹æ§ï¼è¯»åè¿æ»¤å¨é¾çæ¶ä¿è¯å¶æåºæ§</p>
<p>3ãæå¡åï¼è¿æ»¤å¨é¾çæå¡åædubboæå¡ï¼åå°éä¸­å¼ç®¡ç</p>
<p>4ãåæ­¥æ§ï¼ä¸åä¸å¡ç³»ç»å¯¹äºè¿æ»¤å¨é¾çå è½½éè¦åæ­¥</p>
<p>5ãç­å è½½ï¼è¿æ»¤å¨é¾ä¿®æ¹ä¹åï¼åä¸ªä¸å¡ç³»ç»ä¸éè¦éå¯æå¡ï¼ä»¥è¾¾å°ç­å è½½çç®ç</p>
<h2 id="å®ç°æä¹åæåºå">å®ç°æä¹åãæåºå</h2>
<p>è¿æ»¤å¨é¾åå«çå­æ®µï¼</p>
<pre><code class="language-java">package com.itheima.shiro.vo;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.apache.commons.lang3.builder.ToStringBuilder;
import org.apache.commons.lang3.builder.ToStringStyle;

import java.io.Serializable;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class FilterChainVo implements Serializable {
    /**
     * ä¸»é®
     */
    private String id;

    /**
     * æè¿°
     */
    private String urlName;

    /**
     * è·¯å¾
     */
    private String url;

    /**
     * æ¦æªå¨åç§°
     */
    private String filterName;

    /**
     * æéè§è²ï¼å¯çç¥ï¼ç¨éå·åé
     */
    private String roles;

    /**
     * æéæéï¼å¯çç¥ï¼ç¨éå·åé
     */
    private String permissions;

    /**
     * æåº
     */
    private Integer sortNo;

    private String enableFlag;

    private static final long serialVersionUID = 1L;

    @Override
    public String toString() {
        return ToStringBuilder.reflectionToString(this, ToStringStyle.SHORT_PREFIX_STYLE);
    }
}
</code></pre>
<h2 id="å®ç°æå¡å">å®ç°æå¡å</h2>
<p>ç®çï¼ä½¿ææçæå¡å¨é¾æ¥è¯¢è¯·æ±é½éè¿è¿ä¸ªæå¡æ¥è°ç¨ã</p>
<pre><code class="language-java">package com.itheima.shiro.face;

import com.itheima.shiro.vo.FilterChainVo;

import java.util.List;

/**
 * @Descriptionï¼è¿æ»¤å¨é¾æå¡åæ¥å£
 */
public interface FilterChainFace {

    /**
     * @Description æ¥è¯¢ææææçè¿æ»¤å¨é¾
     */
    List&lt;FilterChainVo&gt; findFilterChainList();
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.faceImpl;

import com.itheima.shiro.face.FilterChainFace;
import com.itheima.shiro.pojo.FilterChain;
import com.itheima.shiro.service.FilterChainService;
import com.itheima.shiro.utils.BeanConv;
import com.itheima.shiro.utils.EmptyUtil;
import com.itheima.shiro.vo.FilterChainVo;
import org.apache.dubbo.config.annotation.Service;
import org.springframework.beans.factory.annotation.Autowired;

import java.util.List;

/**
 * @Descriptionï¼è¿æ»¤å¨é¾æå¡åæ¥å£
 */
@Service(version = "1.0.0",retries = 3,timeout = 5000)
public class FilterChainFaceImpl implements FilterChainFace {

    @Autowired
    FilterChainService filterChainService;

    @Override
    public List&lt;FilterChainVo&gt; findFilterChainList() {
        List&lt;FilterChain&gt; filterChainList = filterChainService.findFilterChainList();
        if (!EmptyUtil.isNullOrEmpty(filterChainList)){
            // å°æ°æ®åºè¿åçæ°æ®ç»æè½¬æ¢ææ åçè¿æ»¤å¨é¾æ ¼å¼
            return BeanConv.toBeanList(filterChainList, FilterChainVo.class);
        }
        return null;
    }
}
</code></pre>
<h2 id="å®ç°åæ­¥æ§">å®ç°åæ­¥æ§</h2>
<p>åè¯»åæ°æ®åºçè¿æ»¤å¨é¾ï¼è°ç¨ä¸é¢filterChainFaceæå¡</p>
<ol>
<li>FilterChainBridgeService:è¿æ»¤å¨é¾æ¡¥æ¥å¨serviceæ¥å£å±</li>
<li>FilterChainBridgeServiceImpl:è¿æ»¤å¨é¾æ¡¥æ¥å¨serviceæ¥å£å±å®ç°</li>
</ol>
<p>å°è¿æ»¤å¨é¾å è½½å°shiroä¸­</p>
<ol>
<li>ShiroFilerChainService:shiroè¿æ»¤å¨é¾æå¡å è½½æ¥å£</li>
<li>ShiroFilerChainService:shiroè¿æ»¤å¨é¾æå¡å è½½æ¥å£å®ç°</li>
</ol>
<pre><code class="language-java">package com.itheima.shiro.core.bridge;

import com.itheima.shiro.vo.FilterChainVo;

import javax.servlet.FilterChain;
import java.util.List;

/**
 * @Descriptionï¼èªå®ä¹è¿æ»¤å¨æ¡¥æ¥æ¥å£
 */
public interface FilterChainBridgeService {

    /**
     * @Description æ¥è¯¢ææææçè¿æ»¤å¨é¾
     */
    List&lt;FilterChainVo&gt; findFilterChainList();
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.client;

import com.itheima.shiro.core.bridge.FilterChainBridgeService;
import com.itheima.shiro.face.FilterChainFace;
import com.itheima.shiro.vo.FilterChainVo;
import org.apache.dubbo.config.annotation.Reference;
import org.springframework.stereotype.Service;

import java.util.List;

/**
 * @Descriptionï¼èªå®ä¹è¿æ»¤å¨æ¡¥æ¥æ¥å£å®ç°
 */
@Service("filterChainBridgeService")
public class FilterChainBridgeServiceImpl implements FilterChainBridgeService {

    @Reference(version = "1.0.0")
    private FilterChainFace filterChainFace;

    @Override
    public List&lt;FilterChainVo&gt; findFilterChainList() {
        return filterChainFace.findFilterChainList();
    }
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.service;

import com.itheima.shiro.vo.FilterChainVo;

import java.util.List;

/**
 * @Descriptionï¼è¿æ»¤å¨åæ­¥æ¥å£
 */
public interface ShiroFilerChainService {

    /**
     * @Description å¯å¨æ¶ï¼å¯å¨å®æ¶å¨ï¼æ¯é2åéå¨æå è½½æ°æ®åºéé¢çè¿æ»¤å¨é¾
     */
    void init();

    /**
     * @Description ä½¿ç¨DefaultFilterChainManagerçaddToChainæ¹æ³æå»ºè¿æ»¤å¨é¾
     */
    void initFilterChains(List&lt;FilterChainVo&gt; filterChainVos);
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.service.impl;

import com.itheima.shiro.core.bridge.FilterChainBridgeService;
import com.itheima.shiro.core.impl.CustomDefaultFilterChainManager;
import com.itheima.shiro.service.ShiroFilerChainService;
import com.itheima.shiro.vo.FilterChainVo;
import org.apache.shiro.web.filter.mgt.DefaultFilterChainManager;
import org.apache.shiro.web.filter.mgt.NamedFilterList;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import javax.annotation.PostConstruct;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

/**
 * @Descriptionï¼è¿æ»¤å¨åæ­¥æ¥å£å®ç°
 */
@Service("shiroFilerChainService")
public class ShiroFilerChainServiceImpl implements ShiroFilerChainService {

    //æ³¨å¥è¿æ»¤å¨é¾ç®¡çè
    @Autowired
    private CustomDefaultFilterChainManager defaultFilterChainManager;

    //ä½¿ç¨æ¡¥æ¥å¨è¯»åæ°æ®åºåçè¿æ»¤å¨é¾
    @Autowired
    FilterChainBridgeService filterChainBridgeService;

    private Map&lt;String, NamedFilterList&gt; defaultFilterChains;

    //å®æ¶å¨
    private ScheduledExecutorService executorService = Executors.newScheduledThreadPool(1);

    // æ¯ä¸ªæå¡å¨å¯å¨é½ä¼å è½½è¿ä¸ªæ¹æ³
    @Override
    @PostConstruct
    public void init() {
        defaultFilterChains = new LinkedHashMap&lt;&gt;();
        // å»¶æ¶ä¸º0ï¼æ¯120ç§æ§è¡ä¸æ¬¡
        executorService.scheduleAtFixedRate(new Runnable() {
            @Override
            public void run() {
                initFilterChains(filterChainBridgeService.findFilterChainList()) ;
            }
        }, 0, 120, TimeUnit.SECONDS);
    }

    @Override
    public void initFilterChains(List&lt;FilterChainVo&gt; filterChainVos) {

        //1ãé¦åå é¤ä»¥åèçfilterï¼æå»ºé»è®¤çè¿æ»¤å¨é¾
        defaultFilterChainManager.getFilterChains().clear();
        //2ãå è½½è¿æ»¤å¨é¾
        for (FilterChainVo urlFilterVo : filterChainVos) {
            String url = urlFilterVo.getUrl();
            String filterName = urlFilterVo.getFilterName();
            String[] filterNames = filterName.split(",");
            for (String name : filterNames) {
                //æ³¨åææfilterï¼åå«èªå®ä¹çè¿æ»¤å¨
                switch(name){
                    case "anon":
                        defaultFilterChainManager.addToChain(url, name);
                        break;
                    case "authc":
                        defaultFilterChainManager.addToChain(url, name);
                        break;
                    case "roles":
                        defaultFilterChainManager.addToChain(url, name, urlFilterVo.getRoles());
                        break;
                    case "perms":
                        defaultFilterChainManager.addToChain(url, name,urlFilterVo.getPermissions());
                        break;
                    case "role-or":
                        defaultFilterChainManager.addToChain(url, name,urlFilterVo.getRoles());
                        break;
                    case "kicked-out":
                        defaultFilterChainManager.addToChain(url, name);
                        break;
                    case "jwt-authc":
                        defaultFilterChainManager.addToChain(url, name);
                        break;
                    case "jwt-roles":
                        defaultFilterChainManager.addToChain(url, name, urlFilterVo.getRoles());
                        break;
                    case "jwt-perms":
                        defaultFilterChainManager.addToChain(url, name,urlFilterVo.getPermissions());
                        break;
                    default:
                        break;
                }
            }
        }
    }
}
</code></pre>
<h2 id="å®ç°ç­å è½½">å®ç°ç­å è½½</h2>
<p>ä¸ºäºå®ç°ç­å è½½æä»¬éè¦å®ä¹ä»¥ä¸3ä¸ªç±»ï¼</p>
<ul>
<li>CustomDefaultFilterChainManager:èªå®ä¹çé»è®¤è¿æ»¤å¨é¾ç®¡çè</li>
<li>CustomPathMatchingFilterChainResolver:èªå®ä¹çè·¯å¾å¹éè¿æ»¤å¨é¾è§£æå¨</li>
<li>CustomShiroFilterFactoryBean:èªå®ä¹shiroè¿æ»¤å¨å·¥åbean</li>
</ul>
<p><strong>CustomDefaultFilterChainManagerï¼ä¸»è¦æ¯æåæ¥å¯¹è±¡çåå»ºäº¤äºspringå®¹å¨ï¼åæ¶æå®è¿æ»¤å¨ï¼ç¶åæå»ºè¿æ»¤å¨é¾</strong></p>
<pre><code class="language-java">package com.itheima.shiro.core.impl;

import org.apache.shiro.util.StringUtils;
import org.apache.shiro.web.filter.AccessControlFilter;
import org.apache.shiro.web.filter.authc.AuthenticationFilter;
import org.apache.shiro.web.filter.authz.AuthorizationFilter;
import org.apache.shiro.web.filter.mgt.DefaultFilterChainManager;
import org.apache.shiro.web.filter.mgt.NamedFilterList;

import javax.annotation.PostConstruct;
import javax.servlet.Filter;
import java.util.LinkedHashMap;
import java.util.Map;

/**
 * @Descriptionï¼èªå®ä¹è¿æ»¤å¨é¾ç®¡çè
 */
public class CustomDefaultFilterChainManager extends DefaultFilterChainManager {

    //ç»å½å°å
    private String loginUrl;
    //ç»å½æåä¹åè·³è½¬å°å
    private String successUrl;
    //æªææè·³è½¬å°å
    private String unauthorizedUrl;

    /**
     * @Description æå»ºè¿æ»¤å¨åè¿æ»¤å¨é¾çmapå¯¹è±¡ï¼å è½½é»è®¤çè¿æ»¤å¨é¾
     */
    public CustomDefaultFilterChainManager() {
        setFilters(new LinkedHashMap&lt;String, Filter&gt;());
        setFilterChains(new LinkedHashMap&lt;String, NamedFilterList&gt;());
        addDefaultFilters(true);
    }

    @PostConstruct
    public void init(){
        Map&lt;String, Filter&gt; defaultFilters = getFilters();
        //apply global settings if necessary:
        for (Filter filter : defaultFilters.values()) {
            applyGlobalPropertiesIfNecessary(filter);
        }
    }

    private void applyGlobalPropertiesIfNecessary(Filter filter) {
        applyLoginUrlIfNecessary(filter);
        applySuccessUrlIfNecessary(filter);
        applyUnauthorizedUrlIfNecessary(filter);
    }

    private void applyLoginUrlIfNecessary(Filter filter) {
        String loginUrl = getLoginUrl();
        if (StringUtils.hasText(loginUrl) &amp;&amp; (filter instanceof AccessControlFilter)) {
            AccessControlFilter acFilter = (AccessControlFilter) filter;
            //only apply the login url if they haven't explicitly configured one already:
            String existingLoginUrl = acFilter.getLoginUrl();
            if (AccessControlFilter.DEFAULT_LOGIN_URL.equals(existingLoginUrl)) {
                acFilter.setLoginUrl(loginUrl);
            }
        }
    }

    private void applySuccessUrlIfNecessary(Filter filter) {
        String successUrl = getSuccessUrl();
        if (StringUtils.hasText(successUrl) &amp;&amp; (filter instanceof AuthenticationFilter)) {
            AuthenticationFilter authcFilter = (AuthenticationFilter) filter;
            //only apply the successUrl if they haven't explicitly configured one already:
            String existingSuccessUrl = authcFilter.getSuccessUrl();
            if (AuthenticationFilter.DEFAULT_SUCCESS_URL.equals(existingSuccessUrl)) {
                authcFilter.setSuccessUrl(successUrl);
            }
        }
    }

    private void applyUnauthorizedUrlIfNecessary(Filter filter) {
        String unauthorizedUrl = getUnauthorizedUrl();
        if (StringUtils.hasText(unauthorizedUrl) &amp;&amp; (filter instanceof AuthorizationFilter)) {
            AuthorizationFilter authzFilter = (AuthorizationFilter) filter;
            //only apply the unauthorizedUrl if they haven't explicitly configured one already:
            String existingUnauthorizedUrl = authzFilter.getUnauthorizedUrl();
            if (existingUnauthorizedUrl == null) {
                authzFilter.setUnauthorizedUrl(unauthorizedUrl);
            }
        }
    }

    /**
     * @Description å è½½èªå®ä¹è¿æ»¤å¨çå¯¹è±¡
     * @param customFilters èªå®ä¹è¿æ»¤å¨çmapæ¶æ
     * @return
     */
    public void setCustomFilters(Map&lt;String,Filter&gt; customFilters){
        for (Map.Entry&lt;String, Filter&gt; entry : customFilters.entrySet()) {
            addFilter(entry.getKey(), entry.getValue(), false);
        }

    }

    /**
     * @Description ä¸åä½¿ç¨shiroå®¹å¨å»æå»ºï¼èæ¯äº¤äºspringå»æå»º
     */
    @Override
    protected void initFilter(Filter filter) {

    }

    public String getLoginUrl() {
        return loginUrl;
    }

    public void setLoginUrl(String loginUrl) {
        this.loginUrl = loginUrl;
    }

    public String getSuccessUrl() {
        return successUrl;
    }

    public void setSuccessUrl(String successUrl) {
        this.successUrl = successUrl;
    }

    public String getUnauthorizedUrl() {
        return unauthorizedUrl;
    }

    public void setUnauthorizedUrl(String unauthorizedUrl) {
        this.unauthorizedUrl = unauthorizedUrl;
    }
}
</code></pre>
<p>CustomPathMatchingFilterChainResolverè¿éä¸»è¦æ ¸å¿åå®¹æ¯ï¼æå®ä½¿ç¨è¿æ»¤å¨é¾ç®¡çå¨ä¸ºèªå·±å®çè¿æ»¤å¨ç®¡çå¨</p>
<pre><code class="language-java">package com.itheima.shiro.core.impl;

import lombok.extern.log4j.Log4j2;
import org.apache.shiro.web.filter.mgt.FilterChainManager;
import org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver;

import javax.servlet.FilterChain;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;

/**
 * @Descriptionï¼èªå®ä¹è·¯å¾è§£æå¨
 */
@Log4j2
public class CustomPathMatchingFilterChainResolver extends PathMatchingFilterChainResolver {

    private CustomDefaultFilterChainManager defaultFilterChainManager;

    public CustomDefaultFilterChainManager getDefaultFilterChainManager() {
        return defaultFilterChainManager;
    }

    public void setDefaultFilterChainManager(CustomDefaultFilterChainManager defaultFilterChainManager) {
        this.defaultFilterChainManager = defaultFilterChainManager;
    }

    public FilterChain getChain(ServletRequest request, ServletResponse response, FilterChain originalChain) {
        //ä¸å¨ä½¿ç¨é»è®¤çè¿æ»¤å¨é¾ç®¡çèï¼èæ¯ä½¿ç¨èªå®ä¹çè¿æ»¤å¨ç®¡çè
        FilterChainManager filterChainManager = getDefaultFilterChainManager();
        if (!filterChainManager.hasChains()) {
            return null;
        }

        String requestURI = getPathWithinApplication(request);

        //the 'chain names' in this implementation are actually path patterns defined by the user.  We just use them
        //as the chain name for the FilterChainManager's requirements
        for (String pathPattern : filterChainManager.getChainNames()) {

            // If the path does match, then pass on to the subclass implementation for specific checks:
            if (pathMatches(pathPattern, requestURI)) {
                if (log.isTraceEnabled()) {
                    log.trace("Matched path pattern [" + pathPattern + "] for requestURI [" + requestURI + "].  " +
                            "Utilizing corresponding filter chain...");
                }
                return filterChainManager.proxy(originalChain, pathPattern);
            }
        }

        return null;
    }
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.core.impl;

import lombok.extern.log4j.Log4j2;
import org.apache.shiro.mgt.SecurityManager;
import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.filter.mgt.FilterChainManager;
import org.apache.shiro.web.filter.mgt.FilterChainResolver;
import org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver;
import org.apache.shiro.web.mgt.WebSecurityManager;
import org.apache.shiro.web.servlet.AbstractShiroFilter;
import org.springframework.beans.factory.BeanInitializationException;

/**
 * @Descriptionï¼éåshirodè¿æ»¤å¨å·¥å
 */
@Log4j2
public class CustomShiroFilterFactoryBean extends ShiroFilterFactoryBean {

    PathMatchingFilterChainResolver chainResolver ;

    public void setChainResolver(PathMatchingFilterChainResolver chainResolver) {
        this.chainResolver = chainResolver;
    }

    protected AbstractShiroFilter createInstance() throws Exception {

        log.debug("Creating Shiro Filter instance.");

        SecurityManager securityManager = getSecurityManager();
        if (securityManager == null) {
            String msg = "SecurityManager property must be set.";
            throw new BeanInitializationException(msg);
        }

        if (!(securityManager instanceof WebSecurityManager)) {
            String msg = "The security manager does not implement the WebSecurityManager interface.";
            throw new BeanInitializationException(msg);
        }

        FilterChainManager manager = createFilterChainManager();

        return new SpringShiroFilter((WebSecurityManager) securityManager, chainResolver);
    }

    private static final class SpringShiroFilter extends AbstractShiroFilter {

        protected SpringShiroFilter(WebSecurityManager webSecurityManager, FilterChainResolver resolver) {
            super();
            if (webSecurityManager == null) {
                throw new IllegalArgumentException("WebSecurityManager property cannot be null.");
            }
            setSecurityManager(webSecurityManager);
            if (resolver != null) {
                setFilterChainResolver(resolver);
            }
        }
    }
}
</code></pre>
<h3 id="shiroconfigä¿®æ¹">shiroConfigä¿®æ¹</h3>
<pre><code class="language-java">package com.itheima.shiro.config;


import com.itheima.shiro.constant.SuperConstant;
import com.itheima.shiro.core.ShiroDbRealm;
import com.itheima.shiro.core.filter.*;
import com.itheima.shiro.core.impl.*;
import com.itheima.shiro.properties.PropertiesUtil;
import lombok.extern.log4j.Log4j2;
import org.apache.shiro.authc.credential.HashedCredentialsMatcher;
import org.apache.shiro.session.mgt.eis.SessionDAO;
import org.apache.shiro.spring.LifecycleBeanPostProcessor;
import org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor;
import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.mgt.DefaultWebSecurityManager;
import org.apache.shiro.web.servlet.SimpleCookie;
import org.redisson.Redisson;
import org.redisson.api.RedissonClient;
import org.redisson.config.Config;
import org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.DependsOn;

import javax.servlet.Filter;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

/**
 * @Description æééç½®ç±»
 */
@Configuration
@ComponentScan(basePackages = {"com.itheima.shiro.core"})
@EnableConfigurationProperties({ShiroRedisProperties.class})
@Log4j2
public class ShiroConfig {

    @Autowired
    private ShiroRedisProperties shiroRedisProperties;

    @Autowired
    JwtTokenManager jwtTokenManager;

    /**
     * @Description redissionå®¢æ·ç«¯
     */
    @Bean("redissonClientForShiro")
    public RedissonClient redissonClient() {
        log.info("=====åå§åredissonClientForShiroå¼å§======");
        String[] nodeList = shiroRedisProperties.getNodes().split(",");
        Config config = new Config();
        if (nodeList.length == 1) {
            config.useSingleServer().setAddress(nodeList[0])
                    .setConnectTimeout(shiroRedisProperties.getConnectTimeout())
                    .setConnectionMinimumIdleSize(shiroRedisProperties.getConnectionMinimumidleSize())
                    .setConnectionPoolSize(shiroRedisProperties.getConnectPoolSize()).setTimeout(shiroRedisProperties.getTimeout());
        } else {
            config.useClusterServers().addNodeAddress(nodeList)
                    .setConnectTimeout(shiroRedisProperties.getConnectTimeout())
                    .setMasterConnectionMinimumIdleSize(shiroRedisProperties.getConnectionMinimumidleSize())
                    .setMasterConnectionPoolSize(shiroRedisProperties.getConnectPoolSize()).setTimeout(shiroRedisProperties.getTimeout());
        }
        RedissonClient redissonClient =  Redisson.create(config);
        log.info("=====åå§åredissonClientForShiroå®æ======");
        return redissonClient;
    }

    /**
     * @Description åå»ºcookieå¯¹è±¡
     */
    @Bean(name="sessionIdCookie")
    public SimpleCookie simpleCookie(){
        SimpleCookie simpleCookie = new SimpleCookie();
        simpleCookie.setName("ShiroSession");
        return simpleCookie;
    }

    /**
     * @Description æéç®¡çå¨
     * @param
     * @return
     */
    @Bean(name="securityManager")
    public DefaultWebSecurityManager defaultWebSecurityManager(){
        DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();
        securityManager.setRealm(shiroDbRealm());
        securityManager.setSessionManager(shiroSessionManager());
        return securityManager;
    }

    /**
     * @Description å¯ç æ¯è¾å¨
     */
    @Bean
    public HashedCredentialsMatcher hashedCredentialsMatcher (){
        RetryLimitCredentialsMatcher matcher = new RetryLimitCredentialsMatcher(SuperConstant.HASH_ALGORITHM,redissonClient());
        matcher.setHashIterations(SuperConstant.HASH_INTERATIONS);
        return matcher;
    }
    /**
     * @Description èªå®ä¹RealmImpl
     */
    @Bean(name="shiroDbRealm")
    public ShiroDbRealm shiroDbRealm(){
        ShiroDbRealm shiroDbRealm =new ShiroDbRealmImpl();
        shiroDbRealm.setCredentialsMatcher(hashedCredentialsMatcher());
        return shiroDbRealm;
    }


    /**
     * @Description èªå®ä¹sessionä¼è¯å­å¨çå®ç°ç±» ï¼ä½¿ç¨Redisæ¥å­å¨å±äº«sessionï¼è¾¾å°åå¸å¼é¨ç½²ç®ç
     */
    @Bean("redisSessionDao")
    public SessionDAO redisSessionDao(){
        RedisSessionDao sessionDAO =   new RedisSessionDao();
        sessionDAO.setGlobalSessionTimeout(shiroRedisProperties.getGlobalSessionTimeout());
        return sessionDAO;
    }

    /**
     * @Description ä¼è¯ç®¡çå¨
     */
    @Bean(name="sessionManager")
    public ShiroSessionManager shiroSessionManager(){
        ShiroSessionManager sessionManager = new ShiroSessionManager();
        sessionManager.setSessionDAO(redisSessionDao());
        sessionManager.setSessionValidationSchedulerEnabled(false);
        sessionManager.setSessionIdCookieEnabled(true);
        sessionManager.setSessionIdCookie(simpleCookie());
        sessionManager.setGlobalSessionTimeout(shiroRedisProperties.getGlobalSessionTimeout());
        return sessionManager;
    }

    /**
     * @Description ä¿è¯å®ç°äºShiroåé¨lifecycleå½æ°çbeanæ§è¡
     */
    @Bean(name = "lifecycleBeanPostProcessor")
    public static LifecycleBeanPostProcessor getLifecycleBeanPostProcessor() {
        return new LifecycleBeanPostProcessor();
    }

    /**
     * @Description AOPå¼æ¹æ³çº§æéæ£æ¥
     */
    @Bean
    @DependsOn("lifecycleBeanPostProcessor")
    public DefaultAdvisorAutoProxyCreator getDefaultAdvisorAutoProxyCreator() {
        DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator = new DefaultAdvisorAutoProxyCreator();
        defaultAdvisorAutoProxyCreator.setProxyTargetClass(true);
        return defaultAdvisorAutoProxyCreator;
    }

    /**
     * @Description éåDefaultAdvisorAutoProxyCreatoräºé¡¹æ³¨è§£æéæ ¡éª
     */
    @Bean
    public AuthorizationAttributeSourceAdvisor getAuthorizationAttributeSourceAdvisor() {
        AuthorizationAttributeSourceAdvisor aasa = new AuthorizationAttributeSourceAdvisor();
        aasa.setSecurityManager(defaultWebSecurityManager());
        return new AuthorizationAttributeSourceAdvisor();
    }

    /**
     * @Description èªå®ä¹è¿æ»¤å¨å®ä¹
     */
    private Map&lt;String, Filter&gt; filters() {
        Map&lt;String, Filter&gt; map = new HashMap&lt;String, Filter&gt;();
        map.put("role-or", new RolesOrAuthorizationFilter());
        map.put("kicked-out", new KickedOutAuthorizationFilter(redissonClient(), redisSessionDao(), shiroSessionManager()));
        map.put("jwt-authc", new JwtAuthcFilter(jwtTokenManager));
        map.put("jwt-perms", new JwtPermsFilter());
        map.put("jwt-roles", new JwtRolesFilter());
        return map;
    }

	// ===========================ä»¥ä¸æ¯ä¿®æ¹é¨å================================

    @Bean
    public CustomDefaultFilterChainManager defaultFilterChainManager(){
        CustomDefaultFilterChainManager defaultFilterChainManager = new CustomDefaultFilterChainManager();
        defaultFilterChainManager.setCustomFilters(filters());
        defaultFilterChainManager.setLoginUrl("/login");
        defaultFilterChainManager.setSuccessUrl("/home");
        defaultFilterChainManager.setUnauthorizedUrl("/login");
        return defaultFilterChainManager;
    }

    @Bean
    public CustomPathMatchingFilterChainResolver chainResolver(){
        CustomPathMatchingFilterChainResolver chainResolver = new CustomPathMatchingFilterChainResolver();
        //æå®è¿æ»¤å¨ç®¡çè
        chainResolver.setDefaultFilterChainManager(defaultFilterChainManager());
        return chainResolver;
    }
    /**
     * @Description Shiroè¿æ»¤å¨
     */
    @Bean("shiroFilter")
    public ShiroFilterFactoryBean shiroFilterFactoryBean(){
        CustomShiroFilterFactoryBean shiroFilter = new CustomShiroFilterFactoryBean();
        shiroFilter.setChainResolver(chainResolver());
        shiroFilter.setSecurityManager(defaultWebSecurityManager());
        return shiroFilter;
    }

}
</code></pre>
<h1 id="shiro-clientå®¢æ·ç«¯">shiro-clientå®¢æ·ç«¯</h1>
<p>shiro-clientä½ä¸ºjarçä¾èµï¼æ»¡è¶³ä»¥ä¸éæ±ï¼</p>
<p>1ãéä¾µå¥å¼ï¼ä½¿ç¨èåªéè¦å¯¹jarä¾èµååå°éçéç½®ï¼å°±å¯ä»¥è¾¾å°ç»ä¸é´æçç®æ </p>
<p>2ãå¯æ©å±æ§ï¼ç¨æ·é¤ä½¿ç¨æä¾çè¿æ»¤å¨å¤ï¼å¯ä»¥è½»æ¾å®èªå·±çä¸å¡åºå®ä¹è¿æ»¤å¨</p>
<p>3ãéä¸­å¼ç®¡çï¼ä¾èµjarä¹åï¼shiro-mgtåå°å¯ä»¥åæ¶ç®¡æ§å¤ä¸ªå¹³å°çæéçè®¤è¯ãé´æãåå¨æéç½®è¿æ»¤å¨é¾</p>
<h2 id="ä¾èµå³ç³»">ä¾èµå³ç³»</h2>
<p><img alt="1582688991837" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3388489/202601/3388489-20260114154822389-132813609.png" class="lazyload"></p>
<h2 id="åçåæ">åçåæ</h2>
<p>springboot-shiro-framework-clienté¡¹ç®åä¸ç»§æ¿äºspringboot-shiro-framework-coreé¡¹ç®ï¼springboot-shiro-framework-coreæ¯ä¸»è¦å®ç°è®¤è¯ãé´æãè¿æ»¤å¨å®ä¹ãä¼è¯ç»ä¸ãrealmç¼å­çæ ¸å¿é¡¹ç®ã</p>
<p>springboot-shiro-framework-clienté¡¹ç®ä»¥jarçæ¹å¼è¢«éè¦åæéæ§å¶çgatewayé¡¹ç®æä¾èµï¼åç±gatewayéè¿å¯¹springboot-shiro-producerçdubboæ¶è´¹ï¼ä»¥è¾¾å°ç»ä¸è®¤è¯ãé´æ</p>
<p>springboot-shiro-framework-clientæ¨¡åå®ç°äºspringboot-shiro-framework-coreæ¥å£ç3ä¸ªç±»ï¼</p>
<p>UserBridgeServiceImpl:æä¾ç¨æ·åºæ¬èµæºæä½çä¸å¡å®ç°<br>
FilterChainBridgeServiceImpl:æä¾è¿æ»¤å¨é¾æ¥å£çæ¥è¯¢<br>
ResourceBridgeServiceImpl:æä¾èµæºæ¥è¯¢</p>
<pre><code class="language-java">package com.itheima.shiro.client;

import com.itheima.shiro.core.bridge.FilterChainBridgeService;
import com.itheima.shiro.face.FilterChainFace;
import com.itheima.shiro.vo.FilterChainVo;
import org.apache.dubbo.config.annotation.Reference;
import org.springframework.stereotype.Service;

import java.util.List;

/**
 * @Descriptionï¼èªå®ä¹è¿æ»¤å¨æ¡¥æ¥æ¥å£å®ç°
 */
@Service("filterChainBridgeService")
public class FilterChainBridgeServiceImpl implements FilterChainBridgeService {

    @Reference(version = "1.0.0")
    private FilterChainFace filterChainFace;

    @Override
    public List&lt;FilterChainVo&gt; findFilterChainList() {
        return filterChainFace.findFilterChainList();
    }
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.client;

import com.itheima.shiro.core.bridge.ResourceBridgeService;
import com.itheima.shiro.face.ResourceAdapterFace;
import com.itheima.shiro.vo.ResourceVo;
import org.apache.dubbo.config.annotation.Reference;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import java.util.List;

/**
 * @Descriptionï¼ç½å³èµæºæ¡¥æ¥å¨æ¥å£å®ç°
 */
@Component("resourceBridgeService")
public class ResourceBridgeServiceImpl implements ResourceBridgeService {

    @Value("${itheima.resource.systemcode}")
    private String systemCode;

    @Reference(version = "1.0.0")
    ResourceAdapterFace resourceAdapterFace;

    @Override
    public List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode) {
        return resourceAdapterFace.findValidResourceVoAll(systemCode);
    }
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.client;

import com.itheima.shiro.constant.CacheConstant;
import com.itheima.shiro.core.SimpleCacheService;
import com.itheima.shiro.core.base.ShiroUser;
import com.itheima.shiro.core.base.SimpleMapCache;
import com.itheima.shiro.core.base.SimpleToken;
import com.itheima.shiro.core.bridge.UserBridgeService;
import com.itheima.shiro.face.UserAdapterFace;
import com.itheima.shiro.utils.BeanConv;
import com.itheima.shiro.utils.EmptyUtil;
import com.itheima.shiro.utils.ShiroUserUtil;
import com.itheima.shiro.vo.ResourceVo;
import com.itheima.shiro.vo.RoleVo;
import com.itheima.shiro.vo.UserVo;
import lombok.extern.slf4j.Slf4j;
import org.apache.dubbo.config.annotation.Reference;
import org.apache.shiro.authc.AuthenticationInfo;
import org.apache.shiro.authc.AuthenticationToken;
import org.apache.shiro.authc.SimpleAuthenticationInfo;
import org.apache.shiro.authc.UnknownAccountException;
import org.apache.shiro.authz.SimpleAuthorizationInfo;
import org.apache.shiro.util.ByteSource;
import org.redisson.api.RBucket;
import org.redisson.api.RedissonClient;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.concurrent.TimeUnit;


/**
 * @Description æéæ¡¥æ¥å¨
 */
@Slf4j
@Component("userBridgeService")
public class UserBridgeServiceImpl implements UserBridgeService {

    @Reference(version = "1.0.0")
    private UserAdapterFace userAdapterFace;

    @Autowired
    private SimpleCacheService simpleCacheService;

    @javax.annotation.Resource(name = "redissonClientForShiro")
    private RedissonClient redissonClient;

    public AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authcToken,String realmName) {
        SimpleToken token = (SimpleToken)authcToken;
        UserVo user  = this.findUserByLoginName(token.getUsername());
        if(EmptyUtil.isNullOrEmpty(user)){
            throw new UnknownAccountException("è´¦å·ä¸å­å¨");
        }
        ShiroUser shiroUser = BeanConv.toBean(user, ShiroUser.class);
        String sessionId = ShiroUserUtil.getShiroSessionId();
        String cacheKeyResourcesIds = CacheConstant.RESOURCES_KEY_IDS+sessionId;
        shiroUser.setResourceIds(this.findResourcesIdsList(cacheKeyResourcesIds,user.getId()));
        String salt = user.getSalt();
        String password = user.getPassWord();
        return new SimpleAuthenticationInfo(shiroUser, password, ByteSource.Util.bytes(salt), realmName);
    }

    @Override
    public SimpleAuthorizationInfo getAuthorizationInfo(ShiroUser shiroUser) {
        UserVo user = BeanConv.toBean(shiroUser, UserVo.class);
        SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();
        String sessionId = ShiroUserUtil.getShiroSessionId();
        //æ¥è¯¢ç¨æ·æ¥æçè§è²
        String cacheKeyRole = CacheConstant.ROLE_KEY + sessionId;
        info.addRoles(this.findRoleList(cacheKeyRole, user.getId()));

        //æ¥è¯¢ç¨æ·æ¥æçèµæº
        String cacheKeyResources = CacheConstant.RESOURCES_KEY + sessionId;
        info.addStringPermissions(this.findResourcesList(cacheKeyResources, user.getId()));
        return info;
    }


    @Override
    public List&lt;String&gt; findRoleList(String cacheKeyRole, String userId) {
        List&lt;RoleVo&gt; roles = new ArrayList&lt;RoleVo&gt;();
        if (simpleCacheService.getCache(cacheKeyRole) != null) {
            roles = (List&lt;RoleVo&gt;) simpleCacheService.getCache(cacheKeyRole).get(cacheKeyRole);
        } else {
            roles = userAdapterFace.findRoleByUserId(userId);
            if (roles.size() &gt; 0) {
                //ç¨æ·è§è²å­æ¾å°map
                Map&lt;Object, Object&gt; mapRole = new HashMap&lt;Object, Object&gt;();
                mapRole.put(cacheKeyRole, roles);
                //æ°å»ºSimpleMapCacheå®ä¾å¹¶æ¾å¥ç¼å­ç®¡çå¨
                SimpleMapCache cacheRole = new SimpleMapCache(cacheKeyRole, mapRole);
                simpleCacheService.creatCache(cacheKeyRole, cacheRole);
            }
        }
        List&lt;String&gt; rolesLabel = new ArrayList&lt;String&gt;();
        for (RoleVo role : roles) {
            rolesLabel.add(role.getLabel());
        }
        return rolesLabel;
    }


    @Override
    public List&lt;String&gt; findResourcesList(String cacheKeyResources,String userId) {
        List&lt;ResourceVo&gt; resourcesList = new ArrayList&lt;ResourceVo&gt;();
        if (simpleCacheService.getCache(cacheKeyResources) != null) {
            resourcesList = (List&lt;ResourceVo&gt;) simpleCacheService.getCache(cacheKeyResources).get(cacheKeyResources);
        } else {
            resourcesList = userAdapterFace.findResourceByUserId(userId);
            if (resourcesList.size() &gt; 0) {
                //ç¨æ·èµæºå­æ¾å°map
                Map&lt;Object, Object&gt; mapResource = new HashMap&lt;Object, Object&gt;();
                mapResource.put(cacheKeyResources, resourcesList);
                //æ°å»ºSimpleMapCacheå®ä¾å¹¶æ¾å¥ç¼å­ç®¡çå¨
                SimpleMapCache cacheResource = new SimpleMapCache(cacheKeyResources, mapResource);
                simpleCacheService.creatCache(cacheKeyResources, cacheResource);
            }
        }
        List&lt;String&gt; resourcesLabel = new ArrayList&lt;String&gt;();
        for (ResourceVo resources : resourcesList) {
            resourcesLabel.add(resources.getLabel());
        }
        return resourcesLabel;
    }


    @Override
    public UserVo findUserByLoginName(String loginName) {
        String key = CacheConstant.FIND_USER_BY_LOGINNAME+loginName;
        RBucket&lt;UserVo&gt; rBucket = redissonClient.getBucket(key);
        UserVo user = rBucket.get();
        if (!EmptyUtil.isNullOrEmpty(user)) {
            return user;
        }else {
            user = userAdapterFace.findUserByLoginName(loginName);
            if (!EmptyUtil.isNullOrEmpty(user)) {
                rBucket.set(user, 300, TimeUnit.SECONDS);
                return user;
            }
        }
        rBucket.set(new UserVo(), 3, TimeUnit.SECONDS);
        return null;
    }

    @Override
    public List&lt;String&gt; findResourcesIdsList(String cacheKeyResources,String userId) {
        List&lt;ResourceVo&gt; resourcesList = new ArrayList&lt;ResourceVo&gt;();
        if (simpleCacheService.getCache(cacheKeyResources) != null) {
            resourcesList = (List&lt;ResourceVo&gt;) simpleCacheService.getCache(cacheKeyResources).get(cacheKeyResources);
        } else {
            resourcesList = userAdapterFace.findResourceByUserId(userId);
            if (resourcesList.size() &gt; 0) {
                //ç¨æ·èµæºå­æ¾å°map
                Map&lt;Object, Object&gt; mapResource = new HashMap&lt;Object, Object&gt;();
                mapResource.put(cacheKeyResources, resourcesList);
                //æ°å»ºSimpleMapCacheå®ä¾å¹¶æ¾å¥ç¼å­ç®¡çå¨
                SimpleMapCache cacheResource = new SimpleMapCache(cacheKeyResources, mapResource);
                simpleCacheService.creatCache(cacheKeyResources, cacheResource);
            }
        }
        List&lt;String&gt; resourcesLabel = new ArrayList&lt;String&gt;();
        for (ResourceVo resources : resourcesList) {
            resourcesLabel.add(resources.getId());
        }
        return resourcesLabel;
    }

    @Override
    public void loadUserAuthorityToCache(ShiroUser user) {
        String sessionId = user.getSessionId();
        List&lt;RoleVo&gt; roles = userAdapterFace.findRoleByUserId(user.getId());
        //åå»ºè§è²cachaeKey
        String cacheKeyRole = CacheConstant.ROLE_KEY + sessionId;
        //ç¨æ·è§è²å­æ¾å°map
        Map&lt;Object, Object&gt; mapRole = new HashMap&lt;Object, Object&gt;();
        mapRole.put(cacheKeyRole, roles);
        //æ°å»ºSimpleMapCacheå®ä¾å¹¶æ¾å¥ç¼å­ç®¡çå¨
        SimpleMapCache cacheRole = new SimpleMapCache(cacheKeyRole, mapRole);
        simpleCacheService.creatCache(cacheKeyRole, cacheRole);

        List&lt;ResourceVo&gt; resourcesList = userAdapterFace.findResourceByUserId(user.getId());
        if (resourcesList.size() &gt; 0) {
            //åå»ºèµæºcachaeKey
            String cacheKeyResources = CacheConstant.RESOURCES_KEY + sessionId;
            //ç¨æ·èµæºå­æ¾å°map
            Map&lt;Object, Object&gt; mapResource = new HashMap&lt;Object, Object&gt;();
            mapResource.put(cacheKeyResources, resourcesList);
            //æ°å»ºSimpleMapCacheå®ä¾å¹¶æ¾å¥ç¼å­ç®¡çå¨
            SimpleMapCache cacheResource = new SimpleMapCache(cacheKeyResources, mapResource);
            simpleCacheService.creatCache(cacheKeyResources, cacheResource);
        }
    }
}
</code></pre>
<h1 id="shiro-gatewayç½å³">shiro-gatewayç½å³</h1>
<h2 id="åçåæ-1">åçåæ</h2>
<p><img alt="1582880165581" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3388489/202601/3388489-20260114154843500-1653774029.png" class="lazyload"></p>
<p>â	1ãä¾èµspringboot-shiro-framework-clientå®ç°è®¤è¯ãé´æãè¿æ»¤å¨å®ä¹ãä¼è¯ç»ä¸ãrealmç¼å­ç­åè½</p>
<p>â	2ãspringboot-shiro-mgtç®¡çåå°æä¹åç½å³èµæº</p>
<p>â	3ãspringboot-shiro-handlerå®ç°ç½å³èµæºæ¥è¯¢æå¡å</p>
<p>â	4ãgateway-serviceä¾æ®æä¹åçç½å³èµæºï¼å¨æåå»ºæ¶è´¹ç«¯æå¡</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="ç½å³èµæºæä¹å">ç½å³èµæºæä¹å</h3>
<p>è¿éå¨åæèµæºçåºç¡ä¸ï¼å¢å çç½å³èµæºçç®¡çï¼</p>
<p>â		1ãå®ä¹ç½å³systemcodeï¼ç¨ä»¥åºåä¸åç½å³ç³»ç»</p>
<p>â		2ãå®ä¹è®¿é®çè·¯å¾</p>
<p>â		3ãå®ä¹èµæºçå¯ä¸æ è¯ï¼ä½ä¸ºæéæ§å¶çæ è¯</p>
<p>â		4ãå®ä¹ä¸å¡ç«¯dubboæå¡ç«¯æ¥å£ãç®æ æ¹æ³ãä¼ å¥éè¿°ãè½®è®­ç®æ³ãè¶æ¶æ¶é´ãéè¯æ¬¡æ°ç­åæ°ï¼è¿äºåå®¹ä¼å¨gateway-serviceé¡¹ç®ä¸­è§£æ</p>
<h3 id="ç½å³èµæºæå¡å">ç½å³èµæºæå¡å</h3>
<pre><code class="language-properties">ResourceAdapterFace:ç½å³èµæºæå¡æ¥å£
ResourceAdapterFaceImpl:ç½å³èµæºæå¡æ¥å£å®ç°

ResourceBridgeService:ç½å³èµæºæ¡¥æ¥å¨æ¥å£
ResourceBridgeServiceImpl:ç½å³èµæºæ¡¥æ¥å¨æ¥å£å®ç°
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.face;

import com.itheima.shiro.vo.ResourceVo;

import java.util.List;

/**
 * @Descriptionï¼ç½å³èµæºæå¡æ¥å£
 */
public interface ResourceAdapterFace {

    /**
     * @Description è·å¾å½åç³»ç»æ¯ç±ææçdubboçèµæº
     */
    List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode);
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.faceImpl;

import com.itheima.shiro.face.ResourceAdapterFace;
import com.itheima.shiro.pojo.Resource;
import com.itheima.shiro.service.ResourceService;
import com.itheima.shiro.utils.BeanConv;
import com.itheima.shiro.utils.EmptyUtil;
import com.itheima.shiro.vo.ResourceVo;
import org.apache.dubbo.config.annotation.Service;
import org.springframework.beans.factory.annotation.Autowired;

import java.util.List;

/**
 * @Descriptionï¼ç½å³èµæºæå¡æ¥å£å®ç°
 */
@Service(version = "1.0.0", retries = 3,timeout = 5000)
public class ResourceAdapterFaceImpl implements ResourceAdapterFace {

    // ç½å³èµæºçæä¹åæå¡
    @Autowired
    ResourceService resourceService;

    @Override
    public List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode) {
        List&lt;Resource&gt; resourceList =  resourceService.findValidResourceVoAll(systemCode);
        if (!EmptyUtil.isNullOrEmpty(resourceList)){
            return BeanConv.toBeanList(resourceList, ResourceVo.class);
        }
        return  null;
    }
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.core.bridge;

import com.itheima.shiro.vo.ResourceVo;

import java.util.List;

/**
 * @Descriptionï¼ç½å³èµæºæ¡¥æ¥å¨æ¥å£
 */
public interface ResourceBridgeService {

    /**
     * @Description æ¥è¯¢å½åç³»ç»ææææçDUBBOç±»åçæå¡
     * @param systemCode ç³»ç»ç¼å·ï¼ä¸mgtæ·»å ç³»ç»ç¼å·ç¸å
     * @return
     */
    public List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode);
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.client;

import com.itheima.shiro.core.bridge.ResourceBridgeService;
import com.itheima.shiro.face.ResourceAdapterFace;
import com.itheima.shiro.vo.ResourceVo;
import org.apache.dubbo.config.annotation.Reference;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import java.util.List;

/**
 * @Descriptionï¼ç½å³èµæºæ¡¥æ¥å¨æ¥å£å®ç°
 */
@Component("resourceBridgeService")
public class ResourceBridgeServiceImpl implements ResourceBridgeService {

    @Value("${itheima.resource.systemcode}")
    private String systemCode;

    @Reference(version = "1.0.0")
    ResourceAdapterFace resourceAdapterFace;

    @Override
    public List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode) {
        return resourceAdapterFace.findValidResourceVoAll(systemCode);
    }
}
</code></pre>
<h3 id="å¨ææ¶è´¹ç«¯">å¨ææ¶è´¹ç«¯</h3>
<p><img alt="1582882166870" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3388489/202601/3388489-20260114154859603-165917733.png" class="lazyload"></p>
<p>CacheWare:ç¼å­ä»åº</p>
<p>CacheWareService:ç¼å­ä»åºæå¡æ¥å£<br>
CacheWareServiceImpl:ç¼å­ä»åºæå¡æ¥å£å®ç°</p>
<p>CacheWareSyncService:ç¼å­ä»åºåæ­¥æå¡æ¥å£<br>
CacheWareSyncServiceImpl:ç¼å­ä»åºåæ­¥æå¡æ¥å£å®ç°</p>
<p>LoginAction:ç»å½ç¸åºæ¥å£<br>
GateWayController:ç¸åºå±çç»ä¸å¥å£</p>
<pre><code class="language-java">package com.itheima.shiro.pojo;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.lang.reflect.Method;
import java.lang.reflect.Type;

/**
 * @Description ç¼å­ä»åºå¯æ§è¡ç±»
 */
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class CacheWare {

    //æ§è¡ç±»
    private String serviceName;

    //æ§è¡æ¹æ³
    private String methodName;

    //æ¹æ³å¯¹è±¡
    private Method method;

    //åæ°ç±»å
    private Class&lt;?&gt; methodParamsClass;

    //ä»£çç±»
    private Object proxy;


}
</code></pre>
<h4 id="cachewareservice">CacheWareService</h4>
<p>å¶ä¸»è¦è´è´£ï¼</p>
<p>1ãç¼å­çæ¸é¤</p>
<p>2ãåmapå®¹å¨ä¸­åå»ºç¼å­</p>
<p>3ãè·å¾ç¼å­ä»åºæ§è¡å¯¹è±¡</p>
<pre><code class="language-java">package com.itheima.shiro.cache;

import com.google.common.collect.Multimap;
import com.itheima.shiro.pojo.CacheWare;

/**
 * @Descriptionï¼ç¼å­ä»åºæå¡
 */
public interface CacheWareService {

    /**
     * @Description æ¸é¤ç¼å­
     */
    void clearCacheWare();

    /**
     * @Description åmapå®¹å¨ä¸­åå»ºç¼å­
     * @param cacheWareMap
     */
    void createCacheWare(Multimap&lt;String, CacheWare&gt; cacheWareMap);

    /**
     * @Description è·å¾ç¼å­ä»åºæ§è¡å¯¹è±¡
     * @param serviceName æå¡å
     * @param methodName  æ¹æ³å
     * @return {@link CacheWare}
     *
     */
    CacheWare queryCacheWare(String serviceName, String methodName);


}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.cache.impl;

import com.google.common.collect.ArrayListMultimap;
import com.google.common.collect.Multimap;
import com.itheima.shiro.cache.CacheWareService;
import com.itheima.shiro.pojo.CacheWare;
import com.itheima.shiro.utils.EmptyUtil;
import org.springframework.stereotype.Service;

import java.util.Collection;

/**
 * @Descriptionï¼ç¼å­ä»åºæå¡å®ç°
 */
@Service("cacheWareService")
public class CacheWareServiceImpl implements CacheWareService {

    private Multimap&lt;String, CacheWare&gt; cacheWareMap = ArrayListMultimap.create();

    @Override
    public void clearCacheWare() {
        cacheWareMap.clear();
    }

    @Override
    public void createCacheWare(Multimap&lt;String, CacheWare&gt; cacheWareMap) {
        this.cacheWareMap = cacheWareMap;
    }

    @Override
    public CacheWare queryCacheWare(String serviceName, String methodName) {
        if (EmptyUtil.isNullOrEmpty(serviceName)||EmptyUtil.isNullOrEmpty(methodName)){
            return null;
        }
        String key = serviceName+":"+methodName;
        Collection&lt;CacheWare&gt; cacheWares =cacheWareMap.get(key);
        return EmptyUtil.isNullOrEmpty(cacheWares)?null:cacheWares.iterator().next();
    }
}
</code></pre>
<h4 id="cachewaresyncservice">CacheWareSyncService</h4>
<p>å¶ä¸»è¦èè´£ï¼</p>
<p>1ãå¯å¨æ¶ãè°ç¨CacheWareServiceçåå»ºç¼å­æ¹æ³åå§åç¼å­ä»åº</p>
<p>2ãåæ­¥ç¼å­ä»åº</p>
<p>3ãç½å³èµæºè½¬åç¼å­ä»åºå¯æ§è¡å¯¹è±¡</p>
<p>4ãä»dubboä¸­ï¼åå§åä»£çå¯¹è±¡</p>
<p>æ³¨æï¼ä¸ºäºå¨å¤ä¸ªç½å³ç³»ç»ä¸ï¼æ¥å£è½¬æ¢çæ å¹²æ°ï¼è¯»åçåªæ¯æ¬ç½å³æå¯¹åºçèµæº</p>
<pre><code class="language-java">package com.itheima.shiro.cache;

import com.itheima.shiro.pojo.CacheWare;
import com.itheima.shiro.vo.ResourceVo;

/**
 * @Descriptionï¼ç¼å­ä»åºåæ­¥æ¥å£
 */
public interface CacheWareSyncService {

    /**
     * @Description åå§åç¼å­ä»åº
     */
    void initCacheWare();

    /**
     * @Description åæ­¥ç¼å­ä»åº
     */
    void refreshCacheWare();

    /**
     * @Description èµæºè½¬æ¢ç¼å­ä»åºå¯æ§è¡å¯¹è±¡
     */
    CacheWare resourceConvCacheWare(ResourceVo resource);

    /**
     * @Description åå§åä»£çå¯¹è±¡
     * @param interfaceClass æ¥å£
     * @param loadbalance ç®æ³
     * @param version çæ¬
     * @param timeout è¶æ¶æ¶é´
     * @param retries éè¯æ¬¡æ°
     */
    Object initProxy(Class&lt;?&gt; interfaceClass,
                     String loadbalance,
                     String version,
                     Integer timeout,
                     Integer retries);

    /**
     * @Description åæ¶èµæº
     */
    void destoryCacheWare();
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.cache.impl;

import com.google.common.collect.ArrayListMultimap;
import com.google.common.collect.Multimap;
import com.itheima.shiro.cache.CacheWareService;
import com.itheima.shiro.cache.CacheWareSyncService;
import com.itheima.shiro.core.bridge.ResourceBridgeService;
import com.itheima.shiro.pojo.CacheWare;
import com.itheima.shiro.utils.EmptyUtil;
import com.itheima.shiro.vo.ResourceVo;
import lombok.extern.log4j.Log4j2;
import org.apache.dubbo.config.ApplicationConfig;
import org.apache.dubbo.config.ReferenceConfig;
import org.apache.dubbo.config.RegistryConfig;
import org.apache.dubbo.config.utils.ReferenceConfigCache;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;

import javax.annotation.PostConstruct;
import javax.annotation.Resource;
import java.lang.reflect.Method;
import java.util.List;
import java.util.Set;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

/**
 * @Descriptionï¼ç¼å­ä»åºåæ­¥æå¡æ¥å£å®ç°
 */
@Service("cacheWareSyncService")
@Log4j2
public class CacheWareSyncServiceImpl implements CacheWareSyncService {

    @Value("${itheima.resource.systemcode}")
    private String systemCode;

    @Autowired
    CacheWareService cacheWareService;

    @Autowired
    ResourceBridgeService resourceBridgeService;

    @Autowired
    private ApplicationConfig applicationConfig;

    @Autowired
    private RegistryConfig registryConfig;

    //çº¿ç¨æ± 
    private ScheduledExecutorService executorService = Executors.newScheduledThreadPool(1);

    @Override
    @PostConstruct
    public void initCacheWare() {
        executorService.scheduleAtFixedRate(new Runnable() {
            @Override
            public void run() {
                refreshCacheWare();
            }
        }, 0, 2, TimeUnit.MINUTES);

    }

    @Override
    public void refreshCacheWare() {
        //è·å¾ç½å³èµæº
        List&lt;ResourceVo&gt; resources = resourceBridgeService.findValidResourceVoAll(systemCode);
        //å¤æ­ç½å³èµæºæ¯å¦ä¸ºç©ºï¼åæ¸ç©ºææmapå®¹å¨ä¸­çå¯æ§è¡å¯¹è±¡
        if (EmptyUtil.isNullOrEmpty(resources)){
            cacheWareService.clearCacheWare();
        }
        Multimap&lt;String,CacheWare&gt; cacheWareMultimap = ArrayListMultimap.create();
        //æç½å³èµæºè½¬æ¢ä¸ºç¼å­ä»åºå¯æ§è¡å¯¹è±¡
        for (ResourceVo resource : resources) {
            if (EmptyUtil.isNullOrEmpty(resource.getServiceName())||
                EmptyUtil.isNullOrEmpty(resource.getMethodName())){
                log.warn("ç½å³èµæºå®ä¹ä¸å®æ´ï¼{}",resource.toString());
                continue;
            }
            CacheWare cacheWare = resourceConvCacheWare(resource);
            if (!EmptyUtil.isNullOrEmpty(cacheWare)){
                String key = cacheWare.getServiceName()+":"+cacheWare.getMethodName();
                cacheWareMultimap.put(key, cacheWare);
            }
        }

        //æ¾å¥mapå®¹å¨
        cacheWareService.createCacheWare(cacheWareMultimap);
    }

    @Override
    public CacheWare resourceConvCacheWare(ResourceVo resource) {
        //ç½å³èµæºæå¡æ¥å£
        Class&lt;?&gt; serviceClass = null;
        try {
            serviceClass = Class.forName(resource.getServiceName());
        } catch (ClassNotFoundException e) {
            log.error("ä¸ºå¨å®¹å¨ä¸­åç°{}æ¥å£ç±»",resource.getServiceName());
            return null;
        }
        String serviceNameAll = resource.getServiceName();
        // è·å¾ç±»å
        String serviceName = serviceNameAll.substring(serviceNameAll.lastIndexOf(".")+1).toLowerCase();
        //å¯¹åºçæ§è¡æ¹æ³
        Method[] methods = serviceClass.getDeclaredMethods();
        Method methodTarget = null;
        for (Method method : methods) {
            if (method.getName().equals(resource.getMethodName())){
                methodTarget = method;
                break;
            }
        }
        //å¦ææ¹æ³è·åå¤±è´¥
        if (EmptyUtil.isNullOrEmpty(methodTarget)){
            log.error("ä¸ºå¨å®¹å¨ä¸­åç°{}æ¹æ³",resource.getMethodName());
            return null;
        }
        //è·å¾æ¹æ³ä¸çä¼ å¥åæ°
        Class&lt;?&gt;[] parameterTypes = methodTarget.getParameterTypes();
        Class&lt;?&gt; methodParamsClassTarget = null;
        for (Class&lt;?&gt; parameterType : parameterTypes) {
            if (parameterType.getName().equals(resource.getMethodParam())){
                methodParamsClassTarget = parameterType;
                break;
            }
        }
        //æå»ºæå¡ä»£çç±»
        Object proxy = initProxy(serviceClass, resource.getLoadbalance(), resource.getDubboVersion(), resource.getTimeout(), resource.getRetries());
        //æå»ºç¼å­ä»åºå¯æ§è¡å¯¹è±¡
        CacheWare cacheWare = CacheWare.builder()
                .serviceName(serviceName)
                .methodName(resource.getMethodName())
                .method(methodTarget)
                .methodParamsClass(methodParamsClassTarget)
                .proxy(proxy).build();
        return cacheWare;
    }

    // è·åä»£çç±»
    @Override
    public Object initProxy(Class&lt;?&gt; interfaceClass, String loadbalance, String version, Integer timeout, Integer retries) {
        // æå»ºæ¶è´¹ç«¯
        ReferenceConfig&lt;Object&gt; referenceConfig = new ReferenceConfig&lt;&gt;();
        referenceConfig.setApplication(applicationConfig);
        referenceConfig.setRegistry(registryConfig);
        referenceConfig.setLoadbalance(EmptyUtil.isNullOrEmpty(loadbalance)?"random":loadbalance);
        referenceConfig.setInterface(interfaceClass);
        referenceConfig.setVersion(version);
        referenceConfig.setTimeout(EmptyUtil.isNullOrEmpty(timeout)?20000:timeout);
        referenceConfig.setCheck(false);
        // æå®éè¯æ¬¡æ°
        referenceConfig.setRetries(EmptyUtil.isNullOrEmpty(retries)?0:retries);
        ReferenceConfigCache cache = ReferenceConfigCache.getCache();
        return cache.get(referenceConfig);
    }

    @Override
    public void destoryCacheWare() {
        executorService.shutdownNow();
    }
}
</code></pre>
<h3 id="ç½å³èµæºè§£æ">ç½å³èµæºè§£æ</h3>
<p>å¶ä¸»è¦è´è´£ï¼</p>
<p>1ãä¼ å¥åæ°å¤ç</p>
<p>2ãè·å¾å¯æ§è¡ç¼å­ä»åº</p>
<p>3ãæ§è¡è¿ç¨æå¡</p>
<p>4ãå¤çè¿åç»æ</p>
<pre><code class="language-java">package com.itheima.shiro.web;

import com.alibaba.fastjson.JSONObject;
import com.itheima.shiro.base.BaseRequest;
import com.itheima.shiro.cache.CacheWareService;
import com.itheima.shiro.constant.GateWayConstant;
import com.itheima.shiro.pojo.CacheWare;
import com.itheima.shiro.response.MultiResponse;
import com.itheima.shiro.response.PageResponse;
import com.itheima.shiro.response.SingleResponse;
import com.itheima.shiro.utils.EmptyUtil;
import com.itheima.shiro.view.JsonResult;
import lombok.extern.log4j.Log4j2;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;

import java.lang.reflect.Method;

/**
 * @Descriptionï¼ç½å³ç»ä¸å¥å£
 */
@Controller
@Log4j2
public class GateWayController {

    @Autowired
    CacheWareService cacheWareService;

    /**
     * @Description è¯·æ±å¥å£
     * @param serviceName æå¡åç§°
     * @param methodName ç®æ æ¹æ³
     * @param baseRequest è¯·æ±å¯¹è±¡
     * @return
     */
    @RequestMapping(value = "{serviceName}/{methodName}",method = RequestMethod.POST)
    @ResponseBody
    public JsonResult postGateWay(@PathVariable("serviceName") String serviceName,
                                  @PathVariable("methodName") String methodName,
                                  @RequestBody BaseRequest baseRequest) throws Exception{
        JsonResult jsonResult = null;
        if (EmptyUtil.isNullOrEmpty(serviceName)||EmptyUtil.isNullOrEmpty(methodName)){
            jsonResult = jsonResult.builder()
                    .result(GateWayConstant.FAIL)
                    .msg("åæ°ç¼ºå¤±")
                    .code(GateWayConstant.PARAMETERS_MISSING)
                    .build();
                    return  jsonResult;
        }
        //ä¼ å¥åæ°å¤ç
        JSONObject jsonObject = null;
        Object datas = baseRequest.getDatas();
        if (!EmptyUtil.isNullOrEmpty(datas)){
            jsonObject = JSONObject.parseObject(jsonObject.toJSONString(datas));
        }
        //è·å¾ç¼å­ä»åºå¯æ§è¡å¯¹è±¡
        CacheWare cacheWare = cacheWareService.queryCacheWare(serviceName, methodName);
        //æ§è¡è¿ç¨æå¡
        Object proxy = cacheWare.getProxy();
        Method method = cacheWare.getMethod();
        Class&lt;?&gt; methodParamsClass = cacheWare.getMethodParamsClass();
        Object result = null;
        if (EmptyUtil.isNullOrEmpty(methodParamsClass)){
            result = method.invoke(proxy);
        }else {
            Object arg = JSONObject.toJavaObject(jsonObject, methodParamsClass);
            result = method.invoke(proxy,arg);
        }
        //å¤çæ¾åç»æ
        return  convResult(result);
    }

    /**
     * @Description å¤çè¯·æ±ç»æ
     */
    private JsonResult convResult(Object result) {
        JsonResult jsonResult = JsonResult.builder()
                .result(GateWayConstant.SUCCEED)
                .msg("ç¸åºæ­£å¸¸")
                .code(GateWayConstant.SUCCEED_CODE)
                .build();
        if (EmptyUtil.isNullOrEmpty(result)) {
            jsonResult = JsonResult.builder()
                    .result(GateWayConstant.FAIL)
                    .msg("è¿åç»æä¸ºç©º")
                    .code(GateWayConstant.RESULT_ISNULLOREMPTY)
                    .build();
            return jsonResult;
        }
        if (result instanceof SingleResponse) {
            BeanUtils.copyProperties(result, jsonResult);
            @SuppressWarnings("rawtypes")
            SingleResponse singleResponse = (SingleResponse) result;
            jsonResult.setDatas(singleResponse.getValue());
        } else if (result instanceof MultiResponse) {
            BeanUtils.copyProperties(result, jsonResult);
            @SuppressWarnings("rawtypes")
            MultiResponse multiResponse = (MultiResponse) result;
            jsonResult.setDatas(multiResponse.getValues());
        } else if (result instanceof PageResponse) {
            BeanUtils.copyProperties(result, jsonResult);
            PageResponse pageResponse = (PageResponse)result;
            jsonResult.setDatas( pageResponse.getValues());
        } else {
            jsonResult = JsonResult.builder()
                    .result(GateWayConstant.FAIL)
                    .msg("è¿åç»ææ ¼å¼ä¸æ­£ç¡®")
                    .code(GateWayConstant.RESULT_MISSING)
                    .build();
            return jsonResult;
        }
        return jsonResult;
    }
}
</code></pre>

</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/alineverstop/" target="_blank">NE_STOP</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/alineverstop/p/19482539" target="_blank">https://www.cnblogs.com/alineverstop/p/19482539</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 15:51">2026-01-14 15:51</span>&nbsp;
<a href="https://www.cnblogs.com/alineverstop">NE_STOP</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19482539);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19482539', targetLink: 'https://www.cnblogs.com/alineverstop/p/19482539', title: 'SpringBoot-shiro-jwt-dubbo-redisåå¸å¼ç»ä¸æéç³»ç»ï¼å®ç»ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ é«å¾·å°å¾å®ç°å®æ¶è½¨è¿¹å±ç¤º ]]></title>
    <link>https://www.cnblogs.com/lijinhuaboke/p/19457121</link>
    <guid>8488ade48bc039f063c2243a2424896b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lijinhuaboke/p/19457121" title="åå¸äº 2026-01-14 14:35">
    <span role="heading" aria-level="2">é«å¾·å°å¾å®ç°å®æ¶è½¨è¿¹å±ç¤º</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="vue3--é«å¾·å°å¾amap-å®ç°å¹³æ»çå®æ¶è½¨è¿¹åæ¾ä¸è¿½è¸ª">Vue3 + é«å¾·å°å¾(AMap) å®ç°å¹³æ»çå®æ¶è½¨è¿¹åæ¾ä¸è¿½è¸ª</h1>
<h2 id="åè¨">åè¨</h2>
<p>å¨ç©èç½ãç©æµçæ§æå®é²è°åº¦ç³»ç»ä¸­ï¼å®æ¶å±ç¤ºè®¾å¤ï¼å¦æ äººæºãè½¦è¾ãæç¯ï¼çç§»å¨è½¨è¿¹æ¯ä¸ä¸ªå¸¸è§éæ±ãå¦æä»ä»æ¯ç®åçæ´æ°æ è®°ç¹ä½ç½®ï¼è§è§ä¸ä¼åºç°âè·³åâç°è±¡ï¼ä½éªå¾ä¸æµçã</p>
<p>æ¬æå°åäº«å¦ä½å¨ <strong>Vue 3</strong> é¡¹ç®ä¸­ï¼å©ç¨ <strong>é«å¾·å°å¾ (AMap) JS API</strong> å®ç°æ¯è¾ä¸æ»çå®æ¶è½¨ææã</p>
<h2 id="æ ¸å¿çç¹">æ ¸å¿çç¹</h2>
<ol>
<li><strong>å¹³æ»ç§»å¨</strong>ï¼ç¹ä½æ´æ°æ¶ï¼Marker éè¦ä»æ§ä½ç½®å¹³æ»è¿æ¸¡å°æ°ä½ç½®ï¼èä¸æ¯ç¬é´è·³è¿å»ã</li>
<li><strong>è½¨è¿¹è·é</strong>ï¼éç Marker çç§»å¨ï¼è½¨è¿¹çº¿ï¼Polylineï¼éè¦å®æ¶âçé¿âï¼ç´§è·å¨ Marker åé¢ã</li>
<li><strong>å¢éæ´æ°</strong>ï¼åç«¯éå¸¸è¿åå®æ´çåå²è·¯å¾æå½åç¶æï¼åç«¯éè¦è®¡ç®åºâæ°å¢çè·¯å¾æ®µâè¿è¡å¨ç»æ­æ¾ã</li>
</ol>
<h2 id="å®ç°é»è¾è§£æ">å®ç°é»è¾è§£æ</h2>
<p>æ ¸å¿æ¯å©ç¨é«å¾·å°å¾ API çè½¨è¿¹åæ¾åè½ãè½ç¶å®æ¹ææ¡£æä¾äºåºç¡çè½¨è¿¹åæ¾ç¤ºä¾ï¼åèï¼<a href="https://lbs.amap.com/demo/javascript-api-v2/example/marker/replaying-historical-running-data" target="_blank" rel="noopener nofollow">è½¨è¿¹åæ¾ç¤ºä¾</a>ï¼ï¼ä½å®æ¹ç¤ºä¾éå¸¸æ¯ä¸æ¬¡æ§å è½½å®æ´è·¯å¾ï¼ä¾å¦ï¼åè·åå®æ´ç»çº¬åº¦æ°ç»ï¼æ¸²æåºæµèè²èæ¯çº¿ï¼åè®©å°è½¦æ²¿çè·¯å¾è·å¹¶ç»åºæµç»¿è²è½¨è¿¹ï¼ã</p>
<p><strong>æä»¬çä¸å¡åºæ¯ä¸å®æ¹ç¤ºä¾çä¸»è¦åºå«å¨äºï¼</strong><br>
æä»¬çè·¯å¾æ°æ®æ¯<strong>å®æ¶å¢éæ´æ°</strong>çãåç«¯å¹¶æ²¡æä¸å¼å§å°±æ¿å°å®æ´çè·¯å¾ï¼èæ¯éè¿ WebSocket æè½®è¯¢å®æ¶è·ååç«¯è¿åçææ°è·¯å¾æ°æ®ãå æ­¤ï¼æä»¬éè¦èªè¡è®¾è®¡é»è¾ï¼è®¡ç®åºæ¯æ¬¡æ´æ°çâå¢éçæ®µâï¼å¹¶è®© Marker å¹³æ»å°èµ°å®è¿ä¸æ®µã</p>
<h3 id="æ ¸å¿æè·¯">æ ¸å¿æè·¯ï¼</h3>
<ol>
<li>
<p><strong>ååç«¯æ°æ®çº¦å®</strong>ï¼</p>
<ul>
<li>çæ³æåµä¸ï¼åç«¯æå¥½ç´æ¥è¿åâå¢éè·¯å¾âï¼å³ä¸ä¸æ¬¡ä½ç½®å°å½åä½ç½®çåæ éåï¼ã</li>
<li>ä½å¨å®éé¡¹ç®ä¸­ï¼æ¯å¦æ¬æ¡ä¾ï¼ï¼åç«¯æ¥å£è¿åçæ¯<strong>å½åæ¶å»çå®æ´ç´¯ç§¯è·¯å¾</strong>ãå æ­¤ï¼åç«¯éè¦èªè¡æ¯å¯¹ç¼å­çâä¸ä¸æ¬¡è·¯å¾âåâææ°è·¯å¾âï¼è®¡ç®åºå¢éé¨åã</li>
</ul>
</li>
<li>
<p><strong>ç¶æç®¡ç (ç¼å­å®ä¾)</strong>ï¼</p>
<ul>
<li>ä½¿ç¨ <code>Map</code> æ°æ®ç»ææ¥ç¼å­æ¯ä¸ªè®¾å¤ï¼å¦æ äººæºãæç¯ï¼ç <code>Marker</code>ï¼å¾æ ï¼å <code>Polyline</code>ï¼è½¨è¿¹çº¿ï¼å®ä¾ã</li>
<li>ç¡®ä¿æ¯ä¸ªè®¾å¤ ID å¯¹åºå¯ä¸çå°å¾å®ä¾ï¼é¿åæ°æ®å·æ°æ¶éå¤åå»ºå¯¼è´åå­æ³æ¼æéªçã</li>
</ul>
</li>
<li>
<p><strong>è®¡ç®å¢éè·¯å¾</strong>ï¼</p>
<ul>
<li>å½æ°æ°æ®å°è¾¾æ¶ï¼éè¿å¯¹æ¯æ°æ§è·¯å¾é¿åº¦ï¼æªååº<strong>æ°å¢çè·¯å¾æ®µ</strong>ã</li>
<li>è¿æ®µæ°å¢è·¯å¾å°±æ¯ Marker æ¥ä¸æ¥éè¦âå¹³æ»ç§»å¨âçè½¨è¿¹ã</li>
</ul>
</li>
<li>
<p><strong>å¹³æ»å¨ç» (<code>moveAlong</code>)</strong>ï¼</p>
<ul>
<li>è°ç¨é«å¾·å°å¾ç <code>marker.moveAlong()</code> æ¹æ³ï¼è®© Marker æ²¿çæ°å¢è·¯å¾å¹³æ»ç§»å¨ï¼èä¸æ¯ç¬é´è·³åã</li>
</ul>
</li>
<li>
<p><strong>å®æ¶ç»å¶è½¨è¿¹ (<code>moving</code> äºä»¶)</strong>ï¼</p>
<ul>
<li>çå¬ Marker ç <code>moving</code> äºä»¶ãå¨ç§»å¨è¿ç¨ä¸­ï¼å®æ¶æ´æ°è½¨è¿¹çº¿ï¼Polylineï¼çè·¯å¾ï¼ä»èå®ç°âè¾¹èµ°è¾¹ç»âçææã</li>
<li><strong>å³é®ç¹</strong>ï¼ä¸ºä»ä¹è¦å¨ <code>moving</code> äºä»¶ä¸­æ´æ°æ»è½¨è¿¹ï¼èä¸æ¯å¨å¨ç»ç»æ (<code>moveend</code>) åæ´æ°ï¼
<ul>
<li>è¿æ¯ä¸ºäºé²æ­¢æ°æ®æ¨éé¢çè¿å¿«ãå¦æç­å°å¨ç»ç»æåæ´æ°ï¼å¯è½ä¼åºç°âæ°çæ°æ®æ¨éæ¥äºï¼ä½ä¸ä¸æ¬¡å¨ç»è¿æ²¡ç»æï¼å¯¼è´è½¨è¿¹æ°æ®ä¸¢å¤±æè¡æ¥ä¸ä¸âçé®é¢ãå¨ <code>moving</code> è¿ç¨ä¸­å®æ¶å° <code>passedPath</code>ï¼å·²èµ°è¿çè·¯å¾ï¼æ¼æ¥å°æ»è½¨è¿¹ä¸­ï¼æ¯æç¨³å¦¥çæ¹å¼ã</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>å¨ç»ç»ææ¸ç</strong>ï¼</p>
<ul>
<li>å¨ç»ç»ææ¶ (<code>moveend</code>)ï¼æ¸çä¸´æ¶ç»å¶çè¾å©çº¿ï¼ç§»é¤çå¬å¨ï¼é²æ­¢åå­æ³æ¼ã</li>
</ul>
</li>
</ol>
<hr>
<h3 id="ä»£ç è¯¦è§£">ä»£ç è¯¦è§£</h3>
<h4 id="1-ç¶æç®¡çä¸åå§å">1. ç¶æç®¡çä¸åå§å</h4>
<p>æä»¬ä½¿ç¨ <code>Map</code> æ¥ç®¡çå°å¾ä¸ç Marker å Polyline å®ä¾ã</p>
<pre><code class="language-javascript">// å­å¨ Marker å®ä¾ (Key: è®¾å¤ID, Value: AMap.Marker)
const uavMarkers = ref(new Map());
// å­å¨è½¨è¿¹çº¿ Polyline å®ä¾ (Key: è®¾å¤ID, Value: AMap.Polyline)
const uavPaths = ref(new Map());
</code></pre>
<h4 id="2-æ ¸å¿å¤çå½æ°-refreshtemppoint">2. æ ¸å¿å¤çå½æ° <code>refreshTempPoint</code></h4>
<p>è¿ä¸ªå½æ°è´è´£å¤çåæ¡è®¾å¤æ°æ®çæ´æ°é»è¾ã</p>
<pre><code class="language-javascript">// å·æ°è®¾å¤ç¹ä½ä¸è½¨è¿¹
// item: åç«¯è¿åçè®¾å¤æ°æ®å¯¹è±¡
// position: å½åææ°çåæ ç¹
// type: æ´æ°ç±»åï¼'init' ä¸ºåå§åï¼å¶ä»ä¸ºå¢éæ´æ°ï¼
const refreshTempPoint = async (item, position, type, marker, tempOverlay, pathOverlay) =&gt; {
  // 1. æ¸çä¸ä¸è½®çä¸´æ¶è¦çç©ï¼å¦ä¸´æ¶è·¯çº¿ãè·ç¦»ææ¬ï¼
  tempOverlay?.clearOverlays();

  if (item.coordinatesLine) {
    const coordinatesLine = JSON.parse(item.coordinatesLine); // è§£æåç«¯è¿åçå®æ´è·¯å¾æ°ç»

    // --- A. åå§åèµ·ç¹ Marker ---
    let tempMarker = tempUavMarkers.value.get(item.id);
    if (!tempMarker) {
      // å¦ææ¯ç¬¬ä¸æ¬¡åºç°ï¼æ¸²æèµ·ç¹
      tempMarker = renderPoint(coordinatesLine[0], item, "", pathOverlay);
      tempUavMarkers.value.set(item.id, tempMarker);
    }

    // --- B. è·åæåå»ºåå²è½¨è¿¹çº¿ (Polyline) ---
    let polyline = uavPaths.value.get(item.id);
    if (!polyline) {
      polyline = trajectoryLine(item, pathOverlay); // åå»ºæ°ççº¿å®ä¾
      uavPaths.value.set(item.id, polyline);
    }

    // è·åå½åå°å¾ä¸å·²æçè·¯å¾ï¼ç¼å­çæ§è·¯å¾ï¼
    const existingPath = polyline.getPath() || [];

    if (type != "init") {
      // --- C. å¢éæ´æ°é»è¾ ---
      
      // 1. è®¡ç®å¢éè·¯å¾ï¼ä»å·²æè·¯å¾çæåä¸ä¸ªç¹å¼å§æªåï¼ç´å°ææ°è·¯å¾çæ«å°¾
      const newPathSegment = coordinatesLine.slice(
        existingPath.length ? existingPath.length - 1 : 0
      );

      // 2. åå»ºä¸æ¡ä¸´æ¶çâéå½¢âçº¿æ®µï¼ç¨äºè¾å©è®¡ç®æå±ç¤ºï¼è§éæ±èå®ï¼
      const newPolyline = trajectoryLine(item, tempOverlay);

      // 3. å¦æææ°å¢è·¯å¾ï¼å¼å§å¨ç»
      if (newPathSegment &amp;&amp; newPathSegment.length &gt; 0) {
        
        // çå¬ç§»å¨è¿ç¨
        marker.on("moving", function (e) {
          // e.passedPath æ¯ Marker å¨å½åå¨ç»çæ®µä¸­å·²ç»èµ°è¿çè·¯å¾
          newPolyline.setPath(e.passedPath);
          
          // [å³é®] å®æ¶å°èµ°è¿çè·¯å¾æ¼æ¥å°åå²æ»è½¨è¿¹ä¸­
          // è¿æ ·å³ä½¿ WebSocket æ¨éé¢çå¾å¿«ï¼ä¹è½ä¿è¯è½¨è¿¹æ°æ®çè¿ç»­æ§
          polyline.setPath([...existingPath, ...e.passedPath]);
        });

        // å¼å§å¹³æ»ç§»å¨
        marker.moveAlong(newPathSegment, {
          duration: 1000,    // å¨ç»æ¶é¿ï¼éæ ¹æ® WebSocket æ¨éé¢çè°æ´
          autoRotation: true, // è½¦å¤´èªå¨å¯¹åè·¯å¾æ¹å
        });

        // çå¬ç§»å¨ç»æ
        marker.on("moveend", function () {
          // å¨ç»ç»æï¼æ¸çä¸´æ¶è¦çç©
          tempOverlay?.clearOverlays();
          
          // æ´æ°è·ç¦»ææ¬ç­ä¿¡æ¯
          if (item.distance) {
            renderText(
              coordinatesLine[Math.ceil(coordinatesLine.length - 2)],
              `${item.distance}ç±³`,
              tempOverlay
            );
          }
          
          // ç§»é¤çå¬å¨ï¼é²æ­¢éå¤ç»å®
          marker.off("moveend");
        });
      } else {
        // å¦ææ²¡ææ°å¢è·¯å¾ï¼ä½ç½®æ²¡åï¼ï¼ä»æ´æ°æå­ä¿¡æ¯
        if (item.distance) {
          renderText(..., `${item.distance}ç±³`, tempOverlay);
        }
      }

    } else {
      // --- D. åå§åé»è¾ ---
      // å¦ææ¯åå§åå è½½ï¼ç´æ¥è®¾ç½®å®æ´è·¯å¾ï¼ä¸è¿è¡å¨ç»åæ¾
      if (item.distance) {
         renderText(..., `${item.distance}ç±³`, tempOverlay);
      }
      polyline.setPath(coordinatesLine);
    }
  } else {
    // --- E. æ è½¨è¿¹æ°æ®æ¶çéçº§å¤ç ---
    // å¦æåç«¯æ²¡æè¿åè·¯å¾æ°æ®ï¼ç´æ¥è·³åå°ææ°ä½ç½®
    marker.setPosition(position);
    
    // æ¸çç¸å³çè½¨è¿¹å®ä¾åç¼å­
    let tempMarker = tempUavMarkers.value.get(item.id);
    if (tempMarker) {
      tempMarker.setMap(null);
      pathOverlay &amp;&amp; pathOverlay.removeOverlay(tempMarker);
      tempUavMarkers.value.delete(item.id);
    }
    
    let polyline = uavPaths.value.get(item.id);
    if (polyline) {
      polyline.setMap(null);
      pathOverlay &amp;&amp; pathOverlay.removeOverlay(polyline);
      uavPaths.value.delete(item.id);
    }
  }
};
</code></pre>
<p>}<br>
};</p>
<pre><code class="language-javascript">
// æ äººæºåæç¯è½¨è¿¹ææ¶
const refreshAirMap = async (type, data) =&gt; {
  const res = await getUavElement();
  // console.log("æ äººæºæ°æ®", res.result);
  res.result.map(async (item) =&gt; {
    // data.map(async (item) =&gt; {
    if (item.type == "1") {
      let position = JSON.parse(item.coordinates);
      // è·åæåå»ºæ äººæºæ è®°
      let marker = uavMarkers.value.get(item.id);
      if (!marker) {
        // åå»ºæ äººæºãæç¯ç¹ä½ã
        marker = renderPoint(position, item, "", overlayGroups.value);
        uavMarkers.value.set(item.id, marker);
      }else{
        
        if (item.elementType == "2") {
          // å·²æç¹ä½ä¸æ¯æç¯ç¹ä½å°±æ´æ°çµé
          marker.setLabel({
            content: `&lt;div class="marker-label-container"&gt;
              &lt;div class="info-name"&gt;${item.name}&lt;/div&gt;
              &lt;div class="icon-placeholder"&gt;&lt;/div&gt;
              ${batteryHtml(item)}
            &lt;/div&gt;`,
            offset: new AMaps.value.Pixel(0, 0),
            direction: "center",
          });
        }
      }

      if (item.elementType == "1") {
        // æ äººæºè½¨è¿¹
        refreshTempPoint(
          item,
          position,
          type,
          marker,
          pathOverlayGroups.value,
          pathsStartPointOverlayGroups.value
        );
      } else if (item.elementType == "2") {
        // æç¯è½¨è¿¹
        refreshTempPoint(
          item,
          position,
          type,
          marker,
          rescuePathsOverlayGroups.value,
          rescueOverlayGroups.value
        );
      }
      // è½¨è¿¹é¨åï¼å¤æ­æ¯å¦æè½¨è¿¹
    }
  });
  // });
};
</code></pre>
<p>è¯´æä¸ä¸å¦ï¼æçé¡¹ç®ä¸­è¿éè¦å®ç°å¶ä»åè½åæ¯æç¯çµéå±ç¤ºï¼ç¹å»æé®å¯éèæ äººæºè½¨è¿¹ï¼ç¹å»æé®å¯éèæç¯è½¨è¿¹ï¼æ äººæºåæç¯è½¨è¿¹èµ·å§ç¹ä¹éè¦å±ç¤ºä¸ä¸ªç¹ä½å¾æ ï¼è½¨è¿¹çº¿ä¸æ¾ç¤ºè·ç¦»ï¼è¿èèäºç¬¬ä¸æ¬¡è¿å¥é¡¹ç®ï¼å¦æ è½¨è¿¹å°±åªæ´æ°ç¹ä½åæ ç­ç­è¿äºï¼æ å³çè½¨è¿¹å±ç¤ºé»è¾çåä½è§ä¼èç·ç¥è¿å°±å¥½ï¼è¿ç¯æç« ä¸»è¦æ¯åäº«ä¸ä¸å®æ¶è½¨è¿¹å®ç°çé»è¾ï¼æè½¨è¿¹ç¸å³é»è¾æ½åºæ¥éæ°åä¸ä»½ä»£ç ï¼æå«éº»ç¦å»å»ã</p>
<h2 id="æ»ç»">æ»ç»</h2>
<p>éè¿ç»å å¢éè·¯å¾è®¡ç®<code>moveAlong</code> è½¨è¿¹åæ¾ ä»¥å <code>moving</code> äºä»¶çå¬ï¼æä»¬å®ç°äºä¸ä¸ªé«æ§è½ä¸è§è§æµççå®æ¶è½¨è¿¹è¿½è¸ªåè½ãè¿ç§æ¹æ¡ç¹å«éåæ äººæºå·¡èªãè½¦è¾å®æ¶å®ä½ç­éè¦é«é¢æ´æ°ä½ç½®çåºæ¯ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.003472222222222222" data-date-updated="2026-01-14 14:40">2026-01-14 14:35</span>&nbsp;
<a href="https://www.cnblogs.com/lijinhuaboke">æ­¤é¢å·®ç£ã</a>&nbsp;
éè¯»(<span id="post_view_count">147</span>)&nbsp;
è¯è®º(<span id="post_comment_count">3</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19457121);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19457121', targetLink: 'https://www.cnblogs.com/lijinhuaboke/p/19457121', title: 'é«å¾·å°å¾å®ç°å®æ¶è½¨è¿¹å±ç¤º' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>