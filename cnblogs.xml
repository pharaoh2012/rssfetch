<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-11T17:00:42.759Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ ä½¿ç¨Mixinç±»ç®åéæéç½®æ¨¡å ]]></title>
    <link>https://www.cnblogs.com/XY-Heruo/p/19606287</link>
    <guid>ed2f48d64a5da0726c85ae434339b28c</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/XY-Heruo/p/19606287" title="åå¸äº 2026-02-12 00:29">
    <span role="heading" aria-level="2">ä½¿ç¨Mixinç±»ç®åéæéç½®æ¨¡å</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="åè¨">åè¨</h2>
<p>æç§ä¸ªäººä¹ æ¯ï¼é¡¹ç®ä¼å§æä¼æç§å¦ä¸ç»æç»ç»é¡¹ç®éç½®ï¼ä¹å°±æ¯éç½®æä»¶æ¾å¨<code>conf/</code>ç®å½ï¼åç¬åä¸ä¸ªéç½®æ¨¡å<code>pkg/config.py</code>å»è¯»åå è½½ãæçå°é¡¹ç®è¿å¥½ï¼æ²¡ä»ä¹éç½®é¡¹ãä½æçé¡¹ç®è¦è°ç¨å¾å¤ç¬¬ä¸æ¹çæ¥å£ï¼éç½®æä»¶åäºä¸å æ¥å£å°åãè®¤è¯æ¹å¼ç­ï¼éç½®æ¨¡åä¹ç¸åºå¢å äºå ç¾è¡ãççè¿å¿«ä¸åè¡çéç½®æ¨¡åï¼è¿æ¯å°½æ©æ¹æ¹æ¯è¾å¥½ã</p>
<pre><code>conf/
  app.toml
pkg/
  config.py
</code></pre>
<p>æçé¡¹ç®ä¼æéç½®ææ£ï¼åä¸ªæ¨¡åç»´æ¤åèªçéç½®ï¼ä½å¯¹äºä½¿ç¨åä¸éç½®æ¨¡åçé¡¹ç®ï¼é¤äºéç½®æ¨¡åï¼å¶å®æ¨¡åè°ç¨éç½®ç±»åä¾çå°æ¹æé½ä¸æ³å»ç¢°ï¼ä¹æå¾ç¢°ãè¿æ¶åï¼ä½¿ç¨Mixinç±»å°±æ¯è¾åéã</p>
<p>å¨Pythonä¸­ï¼Mixinåªæ¯ä¸ç§çº¦å®ï¼è¯­è¨å±é¢æ²¡ææ¾å¼æ¯æï¼å®éä¸å°±æ¯pythonçå¤éç»§æ¿ã</p>
<h2 id="æ§ä»£ç çéç½®ç±»">æ§ä»£ç çéç½®ç±»</h2>
<p>æ§çéç½®æ¨¡å<code>pkg/config.py</code>å¤§æ¦é¿è¿æ ·ï¼æ¯ä¸ªéç½®é¡¹é½åæäºå¨æå±æ§ãå³ä¾¿åªæ¯ç®åçåå¼ï¼ä¹å¯è½ä¼åå¾å¤ãå¦æåå ä¸æ ¡éªï¼åä¸ªæä»¶çåå®¹å°±ä¼å¾å¤äºï¼é¼ æ æ»è½®ç¿»å¿«ç¹ä¼°è®¡å°±æ¾ä¸å°åªå¯¹åªäºã</p>
<pre><code class="language-python">class Config:
    def __init__(self) -&gt; None:
        self._config_file = Path(__file__).parent.parent.parent / "conf" / "config.toml"
        self._config = self._load_config()

    def _load_config(self) -&gt; Dict[str, Any]:
        if not self._config_file.exists():
            raise FileNotFoundError(f"Configuration file {self._config_file} does not exist.")
        with open(self._config_file, "rb") as f:
            return tomllib.load(f)

    @property
    def service_host(self) -&gt; str:
        return self._config.get("service").get("host", "127.0.0.1")

    @property
    def service_port(self) -&gt; int:
        return self._config.get("service").get("port", 8000)
</code></pre>
<h2 id="æå">æå</h2>
<h3 id="ç®åç¤ºä¾">ç®åç¤ºä¾</h3>
<p>å¦æéç½®çå±çº§ç¹å«æ·±ï¼Mixinéåä¸é¿ä¸²<code>.get().get()</code>ä¹æºç¢ç¼çãå¯ä»¥åä¸ä¸ªåºç±»<code>BaseMixin</code>ï¼å¨åºç±»ä¸­å®ä¹ä¸ä¸ªéå½è¯»åéç½®çæ¹æ³ã</p>
<pre><code class="language-python">class BaseMixin:
    _config: Dict[str, Any]
    
    def _get_conf(self, *keys: str, default: Any = None) -&gt; Any:
        """éå½è·åéç½®"""
        data = self._config
        for k in keys:
            if isinstance(data, dict):
                data = data.get(k)
            else:
                return default
        return data if data is not None else default

class FeatureMixin(BaseMixin):
    @property
    def is_feature_enabled(self) -&gt; bool:
        return self._get_conf("module", "submodule", "enabled", default=False)
        
from typing import Any, Dict

class ServiceMixin(BaseMixin):
    """å¤ç Service ç¸å³çéç½®é¡¹"""
    @property
    def service_host(self) -&gt; str:
        return self._get_conf("service", "host", default="127.0.0.1")

    @property
    def service_port(self) -&gt; int:
        return self._get_conf("service", "port", default=8000)

class DatabaseMixin(BaseMixin):
    """å¤ç Database ç¸å³çéç½®é¡¹"""
    @property
    def db_url(self) -&gt; str:
        return self._get_conf("database", "url", default="sqlite:///./test.db")
</code></pre>
<p>ç»åææç»ç<code>Config</code>ç±»</p>
<pre><code class="language-python">import tomllib
from pathlib import Path

class Config(ServiceMixin, DatabaseMixin):
    """
    æç»çèåç±»ãç»§æ¿äºææ Mixinï¼å æ­¤å®æ¥æäºææå®ä¹å¥½ç @propertyã
    """

    def __init__(self) -&gt; None:
        self._config_file = Path(__file__).parent.parent.parent / "conf" / "config.toml"
        self._config = self._load_config()

    def _load_config(self) -&gt; Dict[str, Any]:
        if not self._config_file.exists():
            raise FileNotFoundError(f"Configuration file {self._config_file} does not exist.")
        with open(self._config_file, "rb") as f:
            return tomllib.load(f)

# --- è°ç¨ç«¯ä»£ç å®å¨ä¸éè¦ä¿®æ¹ ---
config = Config()
print(config.service_host)  # æ¥æºäº ServiceMixin
print(config.db_url)        # æ¥æºäº DatabaseMixin
</code></pre>
<p>å¦ä¸æ¹é åï¼è°ç¨æ¹ä¾ç¶ä½¿ç¨<code>config.db_url</code> è¿æ ·çæ¹å¼æ¥ä½¿ç¨ï¼ä¸ç¨ç®¡éç½®æ¨¡åå¦ä½æ¹å¨ãä»¥åå¦æåæ³æ°å¢éç½®ï¼æ¯å¦Redisçè¿æ¥éç½®ï¼åªéè¦æ°å¢ä¸ä¸ª<code>RedisMixin</code>ç±»ï¼å¹¶å å°<code>Config</code>çç»§æ¿åè¡¨éå³å¯ã</p>
<h3 id="ä¸­é´å±èå">ä¸­é´å±èå</h3>
<p>å½éç½®çMixinç±»è¶æ¥è¶å¤ï¼<code>Config</code>ç±»ä¼æä¸æºæçMixinç±»è¦ç»§æ¿ï¼ççæç¹å¤´éèè½»ãè¿æ¶å¯ä»¥æé»è¾é¢ååè¿è¡èåã</p>
<p>æ¯å¦ï¼æ°æ®åºç¸å³çåèåæ<code>DBMixins</code>ï¼è¿ç§ä¸­é´å±èåçMixinç±»ï¼æ¨èå½ååç¼ä¸º<code>Mixins</code>ï¼</p>
<pre><code class="language-python"># pkg/config/mixins/db.py

class PostgresMixin(BaseMixin):
    @property
    def pg_host(self) -&gt; str:
        pass
        
    @property
    def pg_port(self) -&gt; int:
        pass
        
class RedisMixin(BaseMixin):
    @property
    def redis_host(self) -&gt; str:
        pass
        
    @property
    def redis_port(self) -&gt; int:
        pass
        
class DBMixins(PostgresMixin, RedisMixin):
    pass
</code></pre>
<p>å¨<code>Config</code>ç±»ä¸­ç»è£</p>
<pre><code class="language-python"># pkg/config/config.py
from pkg.config.mixins.db import DBMixins
class Config(DBMixins):
    pass
</code></pre>
<p>æç»ç®å½ç»æå¦ä¸ï¼</p>
<pre><code>conf/
  config.toml
pkg/
  config/
    __init__.py  # å¨æ­¤åå»º Config ç±»çåä¾
    config.py    # å¶ä¸­åªæ Config ç±»
    mixins/
      __init__.py  # å®ä¹ BaseMixin åºç±»
      db.py
      third_parties.py
</code></pre>
<h2 id="è¡¥å">è¡¥å</h2>
<p>å¯¹äºæ°é¡¹ç®ï¼å¯ä»¥è¯è¯æéç½®å¨é¨æ¾å°ç¯å¢åéï¼åä¸ªæ¨¡åå®ç°åèªçéç½®æ¨¡åãå¥½å¤å°±æ¯æ¾èµ·æ¥æ¹ä¾¿ï¼èä¸ä»ç¯å¢åéä¸­è¯»åéç½®ä¹ä¸ç¨æå¿æä»¶è¯»åçé»å¡é®é¢ãç®åå¾å¤è¿è¡å¨k8sä¸çæå¡åæ¬¢ç¨è¿ç§è¯»åç¯å¢åéçéç½®æ¹å¼ãç¼ºç¹å¯è½å°±æ¯ç»´æ¤èµ·æ¥ä¸å¤ªæ¹ä¾¿ï¼æ¯ç«éç½®è¢«ææ£äºï¼äº¤æ¥ç»å«äººçè¯ï¼å«äººå¯è½å¾å°å¤æ¾éç½®ã</p>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/XY-Heruo/" target="_blank">è±ééä½ç°</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/XY-Heruo/p/19606287" target="_blank">https://www.cnblogs.com/XY-Heruo/p/19606287</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-12 00:29">2026-02-12 00:29</span>&nbsp;
<a href="https://www.cnblogs.com/XY-Heruo">è±ééä½ç°</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19606287);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19606287', targetLink: 'https://www.cnblogs.com/XY-Heruo/p/19606287', title: 'ä½¿ç¨Mixinç±»ç®åéæéç½®æ¨¡å' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å¦ä½ç¨SSHè®¿é®è¿ç¨æå¡å¨ä¸çåç½æå¡ï¼å¦ï¼MySQLãRedisãKafkaï¼ï¼ ]]></title>
    <link>https://www.cnblogs.com/hackyle/p/19606177</link>
    <guid>6209bdc8686ad8d04f332bf4dba7b904</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/hackyle/p/19606177" title="åå¸äº 2026-02-11 23:13">
    <span role="heading" aria-level="2">å¦ä½ç¨SSHè®¿é®è¿ç¨æå¡å¨ä¸çåç½æå¡ï¼å¦ï¼MySQLãRedisãKafkaï¼ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><strong>ä½ æ¯å¦æéå°ä»¥ä¸çéæ±åºæ¯ï¼</strong></p>
<ul>
<li>åºæ¯1ï¼ä½ é¨ç½²å¨ä¸ªäººçäºæå¡å¨ä¸çæå¡ï¼åºç°äºé®é¢ï¼æ³å¨æ¬å°çNavicat / DBeaveræ¥ä¸ä¸çº¿ä¸MySQLï¼å´åç°è¿é½è¿ä¸ä¸ã</li>
<li>åºæ¯2ï¼çº¿ä¸ Redis åºé®é¢äºï¼ä½ ææ¥æ¶åç°æ ä»ä¸æã
<ul>
<li>å¦æææå°æ¥å¿ï¼ä½ è¿å¯ä»¥ç»åä»£ç é»è¾åæ¥å¿æ¥åæ</li>
<li>ä½æ¯å¯¹äºæäºä¸å¡åºæ¯ä¸çç¼å­ç©¿éï¼Key è¢«è¯¯å ï¼ææ¥èµ·æ¥å°±æ¯è¾å°é¾äº</li>
</ul>
</li>
<li>åºæ¯3ï¼Kafka ææ¶æ¯ç§¯åï¼ä½æè¿ Topic é½çä¸å°
<ul>
<li>ææ¶æ¯ç§¯åï¼ä½ æ³ï¼ç topic åè¡¨ï¼ç consumer group ç¶æï¼å°è¯æå¨æ¶è´¹ä¸æ¡æ¶æ¯ãä½æ¯ï¼Kafka ç«¯å£ 9092 / 9093 ä¸å¼æ¾å¬ç½ï¼æ¬å° Kafka å·¥å·æ ¹æ¬è¿ä¸ä¸ã</li>
<li>Kafka æ¬èº«å°±å¤æï¼ä¸åºé®é¢ï¼ä½ è¿âè§å¯çªå£âé½æ²¡æï¼å®å¨ä¾èµè¿ç»´ãæ¥å¿åå¹³å°ï¼ææ¥é®é¢çå¤æåº¦é£åã</li>
</ul>
</li>
</ul>
<p><strong>ä»¥ä¸é®é¢çåå æ¯ä»ä¹ï¼</strong></p>
<ul>
<li>MySQLãRedisãKafkaéç½®äºåªææ¬å°127.0.0.1å¯ä»¥è®¿é®ï¼ä¸è½éè¿å¶ä»IPè®¿é®</li>
<li>é²ç«å¢æ²¡æå¯¹æå¡ç«¯å£å¼æ¾</li>
<li>äºæå¡å¨çå®å¨ç­ç¥ä¹æ²¡æå¯¹ç«¯å£æå¼</li>
</ul>
<p><strong>èæåªæ³ä¸´æ¶åå ä»¶äºï¼</strong></p>
<ul>
<li>åªæ³ä¸´æ¶æ¥çæ°æ®ãéªè¯é®é¢</li>
<li>ä¸æ³æ¹é²ç«å¢ãå®å¨ç­ç¥ç»</li>
<li>ä¸æ³æ¹ä»£ç ãä¸æ³æéæ±ãä¸æ³èµ°å®¡æ¹</li>
</ul>
<p>æè¦ä¸´æ¶è®¿é®åç½æå¡ï¼ä½æ¯ç½ç»ä¸éï¼ä¸è½éä¾¿æ¹ç½ç»ï¼ææ²¡æä»ä¹ææ¯æ¹æ³è§£å³è¿ä¸ªé®é¢ï¼ç­æ¡æ¯è¯å®ç ââ <strong>SSHæ¬å°ç«¯å£è½¬å</strong>ã</p>
<p><strong>æ³¨æï¼è¿æä¸ªå¾éè¦çåææ¡ä»¶ï¼ä½ è½éè¿SSHè¿æ¥å°è¿ç¨æå¡å¨ã</strong></p>
<h1><strong><u>å®ç°æè·¯</u></strong></h1>
<p><strong>ä¸å¥è¯æ¦æ¬åçï¼</strong>å©ç¨ SSH å¨æ¬å°åè¿ç¨æå¡å¨ä¹é´å»ºç«ä¸æ¡å å¯ééï¼æè¿ç¨åç½ç«¯å£âè½¬åâå°æ¬å°ç«¯å£ã</p>
<p><img alt="image" height="263" width="550" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211215118833-328938205.png" class="lazyload"></p>
<p>å¯¹æ¬å°å·¥å·æ¥è¯´ï¼å®ä»¥ä¸ºèªå·±è¿çæ¯ localhost</p>
<p>å®éä¸æµééè¿ SSHï¼</p>
<ol>
<li>åå°è¿ç¨æå¡å¨</li>
<li>åç±è¿ç¨æå¡å¨è®¿é®åç½æå¡</li>
<li>ä½ ä¸éè¦æ¹ç½ç»ãä¸éè¦å¼ç«¯å£ãä¸éè¦æ´é²æå¡ã</li>
</ol>
<p><strong>è¯­æ³ï¼ssh -L [æ¬å°ç«¯å£]:[ç®æ ä¸»æº]:[ç®æ ç«¯å£] [SSHæå¡å¨ç¨æ·å]@[SSHæå¡å¨å°å]</strong></p>
<p><strong>å¯¹äºå¼åäººåæ¥è¯´ï¼å¸¸ç¨çä¸¤ç±»åºç¨åºæ¯ï¼</strong></p>
<ul>
<li>è¿ç¨æå¡å¨ä¸çæäºæå¡æ æ³ä»å¬ç½è®¿é®</li>
</ul>
<ol>
<li>çº¿ä¸ç¯å¢éï¼æ°æ®åºãä¸­é´ä»¶ï¼MySQL / Redis / Kafkaï¼å ä¹ä»ä¸æ´é²å¬ç½ç«¯å£ï¼åªè½å¨åç½è®¿é®ã</li>
<li>é²ç«å¢æ¯å³é­ç¶æï¼æ´é²å¬ç½è®¿é®éè¦æ¹å¨é²ç«å¢ï¼æåºéï¼</li>
<li>äºæå¡å¨çå®å¨ç­ç¥é»æ­¢è®¿é®ï¼éè¦æå¨éç½®æµå¥ãæµåºçå®å¨ç­ç¥ç«¯å£</li>
</ol>
<ul>
<li>å¬å¸åç½æå¡å¨ä¸çæå¡æ æ³ä»æ¬æºè®¿é®</li>
</ul>
<ol>
<li>æå¡åç½é¨ç½²ï¼ä¸å¯¹å¼åäººåå¼æ¾</li>
<li>æéç®¡æ§ä¸¥æ ¼</li>
<li>æ³è°è¯é®é¢ï¼ä½å®å¨ç­ç¥æ¯é®é¢è¿å¤æï¼æå¾å»éç½®</li>
<li>åç½æå¡å¨ä¸ä¸åè®¸éä¾¿å®è£å¶ä»ç¬¬ä¸æ¹è½¯ä»¶</li>
<li>æ³¨æï¼æ­¤æ¹å¼å¯è½è®©ä½ è¿è§ï¼è°¨æä½¿ç¨</li>
</ol>
<p><strong>è¿ç§æ¹å¼éååªäºåºæ¯ï¼</strong></p>
<ul>
<li>éå¸¸éå
<ul>
<li>ä¸´æ¶ææ¥çº¿ä¸é®é¢</li>
<li>æ¥çç¼å­æ°æ®</li>
<li>ä¸æ³æ¹ä»£ç </li>
<li>ä¸æ³è£å®¢æ·ç«¯</li>
<li>æéåéç¯å¢</li>
</ul>
</li>
<li>ä¸éå
<ul>
<li>é¿æè¿ç»´éé</li>
<li>é«å¹¶åè®¿é®</li>
</ul>
</li>
</ul>
<h1><strong><u>æ§è¡æ­¥éª¤</u></strong></h1>
<p>å¨äºè§£äºåºæ¬åçåå®ç°æè·¯åï¼å¼å§æ¢³çæ§è¡æ­¥éª¤ï¼è·çæä¸æ­¥ä¸æ­¥æ¥å®ç°å§ã</p>
<p><strong>æ§è¡æ­¥éª¤</strong></p>
<ul>
<li>ç¬¬ä¸æ­¥ï¼è½æ­£å¸¸ SSH ç»å½å°ä¸å°æå¡å¨ï¼ä¸åè®¸ç«¯å£è½¬å</li>
<li>ç¬¬äºæ­¥ï¼æç¡®ä½ è¦è¿æ¥çç®æ ï¼å¼å¯æ¬å°ç«¯å£è½¬å</li>
<li>ç¬¬ä¸æ­¥ï¼éªè¯ SSH é§éæ¯å¦çæ</li>
<li>ç¬¬åæ­¥ï¼è¿ç¨è®¿é®ç®æ æå¡</li>
</ul>
<p>åè®¾æè¦è¿æ¥è¿ç¨æå¡å¨ï¼8.145.45.70ï¼çRedisæå¡ï¼ä»ä»¬å¨è¿ç¨æå¡å¨ä¸åå«ä½¿ç¨6379ç«¯å£ã</p>
<p>å¨æ¬å°éæ©ä¸ä¸ªæ²¡è¢«å ç¨ãä½ èªå·±è®°å¾ä½çç«¯å£ï¼æ¯å¦ï¼16379ãä¸è¦æ±åè¿ç«¯ç«¯å£ä¸è´ï¼åªæ¯ä¸ºäºå¥½è®°ã</p>
<p><strong>å¦ä½æ£æ¥SSHæå¡å¨æ¯å¦åè®¸ç«¯å£è½¬åï¼æ£æ¥sshd_configä¸­ä»¥ä¸éç½®é¡¹çå¼</strong></p>
<ul>
<li>AllowTcpForwarding no &nbsp;#åºè¯¥æ¹ä¸ºyes</li>
<li>AllowAgentForwarding no &nbsp;#åºè¯¥æ¹ä¸ºyes</li>
<li>PermitTunnel no &nbsp;#åºè¯¥æ¹ä¸ºyes</li>
</ul>
<h2><strong><u>å¼å¯æ¬å°ç«¯å£è½¬å</u></strong></h2>
<p>å¨æ¬å°åå»º SSH é§é</p>
<ul>
<li>è¿ä¸æä½çç®æ æ¯ï¼è®©æ¬å°æä¸ªç«¯å£ï¼æåè¿ç¨åç½æå¡ç«¯å£</li>
<li>æµéæµåï¼localhost:æ¬å°ç«¯å£ --&gt; SSH é§é --&gt; è¿ç¨åç½IP:æå¡ç«¯å£</li>
</ul>
<p><strong>å¨ç»ç«¯æ§è¡å½ä»¤ï¼</strong>ssh -L 16379:127.0.0.1:6379 root@8.145.45.70</p>
<p><img alt="image" height="225" width="637" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211223744883-1369635982.png" class="lazyload"></p>
<p><strong>éªè¯æ¬å°ç«¯å£æ¯å¦çæï¼netstat -ano | findstr 16379</strong></p>
<p><img alt="image" height="111" width="612" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211223911662-2126026790.png" class="lazyload"></p>
<p>éªè¯æ¹å¼æç®åï¼æ£æ¥æ¬å°ç«¯å£æ¯å¦å¤äºçå¬ç¶æãå¦ä¸å¾ï¼æ¬å°ç16379å·²ç»å¤äºLISTENINGç¶æã</p>
<p>æ§è¡å®æåï¼SSH è¿æ¥ä¼ä¿æï¼æ¬å°ç«¯å£å¼å§çå¬ï¼ææè®¿é®é½ä¼è¢«è½¬åãæ­¤æ¶ä½ âçèµ·æ¥ä»ä¹é½æ²¡åâï¼ä½ééå·²ç»æéäºã</p>
<p>&nbsp;</p>
<p>å¨ä¸é¢çå¼å¯æ¬å°ç«¯å£è½¬åçå¾çä¸­ï¼ä½ å¯è½åç°äºè¿ä¸ªSSHé¾æ¥è¿å¥äºäº¤äºå¼çShell Terminalï¼è¦æ¯æä¸æ³è¿å¥è¿ç§äº¤äºå¼çç»ç«¯ï¼åºè¯¥æä¹åå¢ï¼</p>
<p><strong>ä¸æå¼äº¤äºå¼å¯¹è¯ï¼</strong>ssh -N -L 16379:127.0.0.1:6379 root@8.145.45.70</p>
<ul>
<li>-Nï¼ä¸æ§è¡è¿ç¨å½ä»¤ï¼åªåç«¯å£è½¬åï¼</li>
<li>æ´å®å¨ãæ´æ¸æ°</li>
</ul>
<p><strong>æ¾å°åå°è¿è¡ï¼</strong>ssh -f -N -L 16379:127.0.0.1:6379 user@server_ip</p>
<ul>
<li>-fï¼æ¾å°åå°</li>
<li>ç¨å®è®°å¾ææè¿ç¨ï¼tasklist + taskkill / ps + kill</li>
</ul>
<h2><strong><u>è¿ç¨è®¿é®</u></strong></h2>
<p>æ¥ä¸æ¥æ¯æâåç´è§ä½æç½âçä¸æ­¥ï¼</p>
<ul>
<li>ä¸åä½¿ç¨åç½ IPï¼ä¹ä¸åä½¿ç¨è¿ç¨æå¡å¨ IPï¼èç»ä¸ä½¿ç¨ï¼ 127.0.0.1 æ localhost</li>
<li>ç«¯å£ä½¿ç¨ä½ ååå¨æ¬å°ç»å®çç«¯å£</li>
</ul>
<p>&nbsp;</p>
<p>æ¬å°ä½¿ç¨å·²å®è£ç&nbsp;redis-cli&nbsp;å·¥å·è¿æ¥Redisï¼redis-cli -h 127.0.0.1 -p 16379</p>
<p><img alt="image" height="120" width="996" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211224212748-461304407.png" class="lazyload"></p>
<p>ä½¿ç¨ GUI å®¢æ·ç«¯ï¼Another Redis Desktop Managerï¼è¿æ¥è¿ç¨Redis</p>
<p><img alt="image" height="285" width="879" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211224250941-2082874978.png" class="lazyload"></p>
<h2><strong><u>QA</u></strong></h2>
<p><strong>æ¥éï¼prohibited</strong></p>
<p>channel X: open failed: administratively prohibited</p>
<p>channel 3: open failed: administratively prohibited: open failed</p>
<p>åå ï¼ç®¡çåç¦æ­¢äºä½ ä½¿ç¨ç«¯å£è½¬å</p>
<p>è§£å³ï¼sshd_config ä¸­ç¦ç¨äºç«¯å£è½¬å</p>
<ul>
<li>AllowTcpForwarding no &nbsp;#åºè¯¥æ¹ä¸ºyes</li>
<li>AllowAgentForwarding no &nbsp;#åºè¯¥æ¹ä¸ºyes</li>
<li>PermitTunnel no &nbsp;#åºè¯¥æ¹ä¸ºyes</li>
</ul>
<p>&nbsp;</p>
<p><strong>æ¥éï¼Connection timed out</strong></p>
<p>åå ï¼è¿æ¥è¶æ¶ï¼ç½ç»é®é¢</p>
<p>è§£å³ï¼æ£æ¥ç½ç»æ¯å¦è¿éãé²ç«å¢æ¯å¦å¼æ¾</p>
<p>&nbsp;</p>
<p><strong>ææMySQLãredisãkafkaé½è¦è¿è¡æ¬å°ç«¯å£è½¬åï¼å¯ä»¥åªæä¸ä¸ªç«¯å£åï¼</strong></p>
<p>ä¸è¡ã</p>
<p>SSH æ¬å°ç«¯å£è½¬åæ¯ï¼ä¸ä¸ªæ¬å°ç«¯å£ ä¸ ä¸ä¸ªè¿ç¨å°å:ç«¯å£ æ¯ä¸å¯¹ä¸æ å°ã</p>
<p>ä¸æ¡å½ä»¤åæ¶å¼å¯è½¬åï¼ssh user@server \</p>
<p>&nbsp;&nbsp;-L 13306:127.0.0.1:3306 \</p>
<p>&nbsp;&nbsp;-L 16379:127.0.0.1:6379 \</p>
<p>&nbsp;&nbsp;-L 19092:127.0.0.1:9092</p>
<p>&nbsp;</p>
<p><strong>è¿ä¸ä¸ Redisï¼ä½ SSH æ²¡æ¥éï¼</strong></p>
<ul>
<li>æ£æ¥Redis æ¯å¦çå¬ 127.0.0.1</li>
<li>æ¯å¦å¯ç¨äºå¯ç </li>
<li>æ¯å¦éå¶ protected-mode</li>
</ul>
<p>&nbsp;</p>
<p><strong>å¨ä½¿ç¨è¿ç¨ä¸­ï¼æ¯å¦</strong><strong>SSH è¿æ¥å¿é¡»ä¿æ</strong><strong>ï¼</strong></p>
<ul>
<li>æ¯ç</li>
<li>SSH æ­å¼ = é§éå¤±æï¼æ¬å°å·¥å·ä¼ç«å³è¿ä¸ä¸</li>
<li>å»ºè®®åç¬å¼ä¸ä¸ªç»ç«¯ï¼ä¸é¨ç¨äºç»´æ¤ SSH é§é</li>
<li>æ ¹æ®åºæ¯èèæ¯-Nã-fåæ°</li>
</ul>
<p>&nbsp;</p>
<p><strong>ä¸ºä»ä¹æäºå¬å¸çå®å¨å¢éä¼å³é­SSHçç«¯å£è½¬åï¼</strong></p>
<ul>
<li>SSH ç«¯å£è½¬å = éå½¢é§é</li>
<li>å¯ç»è¿é²ç«å¢ / ç½å³ / å®¡è®¡</li>
<li>æ¬å°æµéè¿äºåç½ï¼é¾ä»¥è¿½è¸ª</li>
<li>å®¹æè¢«å½æåç½ä»£çæ»¥ç¨</li>
<li>åºæ¯éç½®ï¼
<ul>
<li>AllowTcpForwarding no</li>
<li>AllowAgentForwarding no</li>
<li>PermitTunnel no</li>
<li>X11Forwarding no #æ¯å¦åè®¸æâè¿ç¨æå¡å¨ä¸çå¾å½¢çé¢ç¨åºâï¼è½¬åå°ä½ æ¬å°å±å¹ä¸æ¾ç¤ºã</li>
</ul>
</li>
</ul>
<p><strong>é¢å¤æéï¼</strong></p>
<ul>
<li>SSHé§éç¨å®å³å³ï¼æ¬å°ç«¯å£ç«å³éæ¾ï¼ä¸çä»»ä½åé¨</li>
<li>å¦¥åä¿ç®¡SSHè¿æ¥å¯ç ãç§é¥</li>
</ul>
<h1><strong><u>å¤çº§è·³æ¿</u></strong></h1>
<p>ä¼ä¸æå¡å¨éå¸¸æä»¥ä¸ç¹ç¹ï¼</p>
<ul>
<li>åç½ç¯å¢ï¼ä¸ç´æ¥æ´é²å¬ç½</li>
<li>å®å¨è¦æ±é«ï¼å¿é¡»å¯¹è®¿é®è¿è¡å®¡è®¡</li>
<li>å¤äººè¿ç»´æå¼åå¢éå±ç¨æå¡å¨</li>
<li>ä¸åè®¸ç´æ¥æ´é²ç®¡çç«¯å£</li>
</ul>
<p>é®é¢ï¼å¦æä½ ç´æ¥ SSH ç»å½åç½æå¡å¨ï¼å°±ä¼å¯¼è´</p>
<ul>
<li>æ²¡ææ¥å¿è®°å½</li>
<li>é¾ä»¥å®¡è®¡æä½</li>
<li>å¯è½å¯¼è´å®å¨é£é©</li>
</ul>
<p>è§£å³æ¹æ¡å°±æ¯ï¼å¨å¬ç½é¨ç½²ä¸å°æå¤å°è·³æ¿æº (Bastion / JumpServer)ï¼éè¿ SSH é´æ¥è®¿é®ç®æ æå¡å¨ãæ¥ä¸æ¥ï¼æä»¬ä¸èµ·æ¢ç´¢å¦ä½å¨ä¸å°åå¤å°è·³æ¿æºä¸å®ç°ç«¯å£è½¬åã</p>
<h2><strong><u>ä¸çº§è·³æ¿</u></strong></h2>
<p>éè¿è·³æ¿æºï¼Jump Host / Bastion Hostï¼ï¼å©ç¨ SSH ä½ä¸ºä¸­è½¬ï¼è®¿é®åç½éçç®æ æå¡å¨ã</p>
<p><strong>ä¸çº§è·³æ¿çç½ç»ç»æï¼</strong></p>
<p><strong><img alt="image" height="227" width="517" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211225042832-192074460.png" class="lazyload"></strong></p>
<p><strong>å®ç°æ¹å¼ä¸ï¼æå¨ä¸¤æ¬¡SSHéæ­¥è·³è½¬</strong></p>
<ul>
<li>ç¬¬ä¸æ­¥ï¼åç»å½è·³æ¿æºï¼ssh jump_user@jump_host</li>
<li>ç¬¬äºæ­¥ï¼å¨è·³æ¿æºä¸ï¼å SSH å°ç®æ æå¡å¨ï¼ssh target_user@target_host</li>
</ul>
<p><strong>å®ç°æ¹å¼äºï¼</strong><strong>-J</strong><strong>è¯­æ³å®ç°</strong></p>
<p>è¯­æ³ï¼ssh -J jump_user@jump_host target_user@target_host</p>
<p>ä¾å¦ï¼ssh -NT -L 3306:127.0.0.1:3306 -J jump_user@jump_host target_user@target_host</p>
<ul>
<li>-L 3306:127.0.0.1:3306 &nbsp;æ¬å° 3306 â ç®æ 3306</li>
<li>-J jump_user@jump_host &nbsp;åè·³å°è·³æ¿æº</li>
<li>target_user@target_host åè¿å°ç®æ æº</li>
<li>-N &nbsp;ä¸æ§è¡è¿ç¨å½ä»¤</li>
<li>-T &nbsp;ä¸åé TTY</li>
<li>ä»æ¯æOpenSSHï¼7.3+ï¼</li>
</ul>
<p><strong>å®ç°æ¹å¼ä¸ï¼</strong><strong>-o</strong><strong>è¯­æ³å®ç°</strong></p>
<p>è¯­æ³ï¼ssh -o ProxyCommand="ssh jump_user@jump_host -W %h:%p" target_user@target_host</p>
<p>ä¾å¦ï¼ssh -NT -L 3306:127.0.0.1:3306 -o ProxyCommand="ssh jump_user@jump_host -W %h:%p" target_user@target_host</p>
<ul>
<li>å¦æ SSH çæ¬ &lt; 7.3ï¼æ²¡æ -Jï¼</li>
<li><strong>æ³¨ææ¯å°åço</strong></li>
</ul>
<h2><strong><u>äºçº§è·³æ¿</u></strong></h2>
<p><strong>äºçº§è·³æ¿çç½ç»ç»æï¼</strong></p>
<p><strong><img alt="image" height="214" width="533" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211225336322-880147829.png" class="lazyload"></strong></p>
<p><strong>å®ç°æ¹å¼ä¸ï¼</strong><strong>-J</strong><strong>è¯­æ³å®ç°</strong></p>
<p>ssh -J user1@jump1,user2@jump2 user3@target</p>
<p>ä¾å­ï¼ssh -NT -L 3306:127.0.0.1:3306&nbsp;-J user1@jump1,user2@jump2 user3@target</p>
<ul>
<li>è·³æ¿æºä¹é´è¿ç»­åï¼éå·åå²</li>
<li>æ³¨æï¼è·³æ¿æºååé¡ºåºéå¸¸éè¦ï¼æç½ç»è¿å¥æ¹ååã</li>
<li>-L 3306:127.0.0.1:3306 &nbsp;æ¬å° 3306 â ç®æ 3306</li>
<li>-N &nbsp;ä¸æ§è¡è¿ç¨å½ä»¤</li>
<li>-T &nbsp;ä¸åé TTY</li>
<li>ä»æ¯æOpenSSHï¼7.3+ï¼</li>
</ul>
<p><strong>å®ç°æ¹å¼äºï¼</strong><strong>-o</strong><strong>è¯­æ³å®ç°</strong></p>
<p>è¯­æ³ï¼ssh -o ProxyCommand="ssh user1@jump1 \</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-o ProxyCommand='ssh user2@jump2 \</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-o ProxyCommand=\"ssh user3@jump3 -W %h:%p\" -W %h:%p' \</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-W %h:%p" \</p>
<p>&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;user4@target</p>
<ul>
<li>æ³¨æå¼å·ï¼æå¤å±æ¯åå¼å·ï¼åå±æ¯åå¼å·ï¼åºåå¼å·çè¾¹ç</li>
<li>å½ä»¤å¤ªå¤æäºï¼ç»´æ¤èµ·æ¥å¾é¾</li>
<li>ä¸æ¨èä½¿ç¨</li>
</ul>
<p>&nbsp;</p>
<p><strong>ä¸çº§è·³æ¿ï¼</strong></p>
<p>è¯­æ³ï¼ssh -J jump1,jump2,jump3 target</p>
<p><strong>æ³¨æç¹ï¼-Jåé¢è·è·³æ¿æºï¼æ³¨æé¡ºåº</strong></p>
<h1><strong><u>æå¡é¨ç½²å¨Dockerä¸</u></strong></h1>
<p><strong>å¦æä½ çåç½æå¡é¨ç½²å¨Dockerä¸ï¼å¦ä½å®ç°SSHçæ¬å°è½¬åå¢ï¼</strong></p>
<p>ä¸¤ç§æåµ</p>
<ul>
<li>å®¹å¨çç«¯å£æ å°å°äºå®¿ä¸»æº</li>
<li>å®¹å¨çç«¯å£æ²¡ææ å°å°äºå®¿ä¸»æº</li>
</ul>
<h2><strong><u>æ å°å°äºå®¿ä¸»æº</u></strong></h2>
<p><strong>Redis</strong><strong>å®¹å¨çç«¯å£æ å°å°äºå®¿ä¸»æº</strong></p>
<ul>
<li>å¨å¯å¨å®¹å¨æ¶æå®äºç«¯å£æ å°ï¼docker run -d --name redis-server-16379 -p 16379:6379 redis:7</li>
<li>SSHæ¬å°ç«¯å£è½¬åç´æ¥åèä¸æä¸­çæ§è¡æ­¥éª¤ãå ä¸ºç¸å½äºå®¿ä¸»æºç16379å·ç«¯å£ä¸å·¥ä½äºRedisæå¡ï¼å¯¹äºæä»¬æ¥è¯´ï¼è·Redisç´æ¥è¿è¡äºå®¿ä¸»æºä¸æ²¡æåºå«ã</li>
</ul>
<p><strong>æ§è¡æ­¥éª¤</strong></p>
<ul>
<li>ç¯å¢åå¤
<ul>
<li>è¿å¥è¿ç¨æå¡å¨ï¼å¯å¨ä¸ä¸ªRedis Dockerï¼docker run -d --name redis-server-16379 -p 16379:6379 redis:7</li>
<li>è¿å¥å®¹å¨:docker exec -it redis-server-16379 /bin/bash</li>
<li>å¾å®¹å¨ä¸­çRediså¡å¥ä¸ä¸ªé®å¼å¯¹ï¼set name hackyle</li>
</ul>
</li>
</ul>
<p><strong><img alt="image" height="369" width="713" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211230123602-556526716.png" class="lazyload"></strong></p>
<p><strong><img alt="image" height="199" width="881" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211230201238-1099260311.png" class="lazyload"></strong></p>
<ul>
<li>å¨æ¬å°æºå¨ä¸å¼å¯æ¬å°ç«¯å£è½¬åï¼ssh -NT -L 16379:127.0.0.1:16379 <a href="mailto:root@8.145.45.70" rel="noopener nofollow"><u>root@8.145.45.70</u></a></li>
</ul>
<p><strong><img alt="image" height="176" width="569" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211230330785-1307889599.png" class="lazyload"></strong></p>
<ul>
<li><strong>éªè¯ï¼å¨æ¬å°æºå¨ä¸è¿æ¥16379ç«¯å£ï¼è®¿é®å°è¿ç¨Dockerä¸­çRedis</strong></li>
</ul>
<p><strong><img alt="image" height="246" width="671" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211230458069-231244983.png" class="lazyload"></strong></p>
<h2><strong><u>æªæ å°å°å®¿ä¸»æº</u></strong></h2>
<p><strong>MySQLå®¹å¨çç«¯å£æ²¡ææ å°å°äºå®¿ä¸»æº</strong></p>
<ul>
<li>åæ¥çå®¹å¨ IPï¼docker inspect mysql | grep IPAddress</li>
<li>åSSH æ¬å°ç«¯å£è½¬åï¼ç´æ¥æåå®¹å¨ IPï¼ssh -L 3306:172.17.0.3:6379user@remote-host</li>
</ul>
<p>&nbsp;</p>
<p><strong>æ§è¡æ­¥éª¤</strong></p>
<p>1.ç¯å¢åå¤</p>
<ul>
<li>è¿å¥è¿ç¨æå¡å¨ï¼å¯å¨ä¸ä¸ªRedis Dockerï¼docker run -d --name redis-server-26379 redis:7</li>
<li>æ¥çå®¹å¨IPï¼docker inspect redis-server-26379 | grep IPAddress</li>
<li>è¿å¥å®¹å¨:docker exec -it redis-server-16379 /bin/bash</li>
<li>å¾å®¹å¨ä¸­çRediså¡å¥ä¸ä¸ªé®å¼å¯¹ï¼set name hackyleshawe</li>
</ul>
<p><strong><img alt="image" height="315" width="908" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211230636360-296586627.png" class="lazyload"></strong></p>
<p>2. å¨æ¬å°æºå¨ä¸å¼å¯æ¬å°ç«¯å£è½¬åï¼ssh -NT -L 26379:172.17.0.3:6379 <a href="mailto:root@8.145.45.70" rel="noopener nofollow"><u>root@8.145.45.70</u></a></p>
<ul>
<li>æ¬å°ç«¯å£ä½¿ç¨26379ï¼è½¬åçç®æ æ¯dockerçIP</li>
<li>docker redisè¿è¡çç«¯å£æ¶6379ï¼æä»¥â-L 26379:172.17.0.3:6379â</li>
</ul>
<p><strong><img alt="image" height="200" width="820" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211230841057-1595647213.png" class="lazyload"></strong></p>
<p><strong>3.éªè¯ï¼å¨æ¬å°æºå¨ä¸è¿æ¥26379ç«¯å£ï¼è®¿é®å°è¿ç¨Dockerä¸­çRedis</strong></p>
<p><strong><img alt="image" height="329" width="826" style="display: block; margin-left: auto; margin-right: auto" data-src="https://img2024.cnblogs.com/blog/3067233/202602/3067233-20260211230947517-774638042.png" class="lazyload"></strong></p>
<h1><strong><u>ç»å°¾</u></strong></h1>
<p>æ¬æä¸»è¦éè¿°äºç¨SSHè®¿é®è¿ç¨æå¡å¨ä¸çåç½æå¡ï¼å¦ï¼Redisï¼çåçåæä½æ­¥éª¤ï¼åæ¶å¯¹é¨ç½²å¨Dockerä¸­çæå¡å¦ä½è®¿é®ä¹åäºè§£éè¯´æã</p>
<p>å¨æç« æåï¼å°è¯å¯¹èªå·±æé®ä¸ä¸é®é¢ï¼æ¥æ£éªä½ æ¯å¦çæ­£äºè§£å°äºæ¬æçæ ¸å¿åå®¹ï¼</p>
<ul>
<li>ä»ä¹æ¯SSHçæ¬å°ç«¯å£è½¬å(Local Port Forwardingï¼ï¼</li>
<li>ä»è½åä»ä¹ï¼è½å¸®ä½ è§£å³ä»ä¹é®é¢ï¼</li>
<li>æä¹ä½¿ç¨ï¼è¯­æ³æ¯ä»ä¹ï¼</li>
<li>åç½æå¡é¨ç½²å¨Dockeråå®¿ä¸»æºï¼ä½¿ç¨ç«¯å£è½¬åè®¿é®æ¶æä»ä¹åºå«ï¼</li>
</ul>
<p>æ¬æç»æã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-11 23:13">2026-02-11 23:13</span>&nbsp;
<a href="https://www.cnblogs.com/hackyle">ALGOé¿ç</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19606177);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19606177', targetLink: 'https://www.cnblogs.com/hackyle/p/19606177', title: 'å¦ä½ç¨SSHè®¿é®è¿ç¨æå¡å¨ä¸çåç½æå¡ï¼å¦ï¼MySQLãRedisãKafkaï¼ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä»é¶å¼å§å®ç°ä¸ä¸ªç®æjsonè§£æå¨ ]]></title>
    <link>https://www.cnblogs.com/xiaoxiongcanguan/p/19605794</link>
    <guid>1c2b2fb8de37c6f0d9bb583e9f32f4a0</guid>
    <description>
    <![CDATA[ 
	<h1 class="postTitle"><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaoxiongcanguan/p/19605794" title="åå¸äº 2026-02-11 20:23">
    <span role="heading" aria-level="2">ä»é¶å¼å§å®ç°ä¸ä¸ªç®æjsonè§£æå¨</span>
    

</a>
</h1>
	<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ä»é¶å¼å§å®ç°ä¸ä¸ªç®æjsonè§£æå¨">ä»é¶å¼å§å®ç°ä¸ä¸ªç®æjsonè§£æå¨</h1>
<h2 id="1-mysimplejsonparser-ä»ç»ä¸æ´ä½è®¾è®¡">1. MySimpleJsonParser ä»ç»ä¸æ´ä½è®¾è®¡</h2>
<p>æè¿å¨å­¦ä¹ ç¼è¯åçç¸å³çç¥è¯ãä¸ºäºå æ·±å¯¹è¯æ³åæãè¯­æ³åæé¶æ®µä¸­è¯¸å¦<strong>æéèªå¨æºãèªé¡¶åä¸è¯­æ³åæãAST</strong> ç­æ¦å¿µççè§£ï¼æéæ©å®ç°ä¸ä¸ªjsonè§£æå¨ä½ä¸ºç»ææºä¼ã</p>
<h5 id="_"></h5>
<p>ç¸æ¯ç´æ¥å®ç°ä¸é¨å®æ´çç¼ç¨è¯­è¨ï¼å°jsonè§£æä½ä¸ºç»æå¯¹è±¡æå ä¸ªææ¾ä¼å¿ï¼</p>
<ol>
<li><strong>å ä¹é¶é¢å¤å­¦ä¹ ææ¬</strong>ï¼jsonä½ä¸ºä¸ç§è½»éçº§çæ°æ®äº¤æ¢æ ¼å¼æ¯æ¥å¸¸å¼åä¸­ä½¿ç¨æé¢ç¹çæ°æ®æ ¼å¼ä¹ä¸ã</li>
<li><strong>ææ³è¶³å¤ç®å</strong>ï¼å¯¹äºç¼è¯åçå¥é¨èæ¥è¯´ï¼è¥éæ©çè¯­è¨å¤ªå¤æï¼å¾å®¹æå¨è¯æ³/è¯­æ³è§åä¸è¢«åéï¼èjsonçè¯æ³åè¯­æ³æ¯è¾è§æ´ï¼è¯­æ³åææ¶éå¸¸åªéæ ¹æ®ä¸ä¸ä¸ªtokenå³å¯å³å®ASTçæé æ¹åã</li>
<li><strong>æ éè¿è¡æ¶</strong>ï¼jsonä¸æ¯ç¼ç¨è¯­è¨ï¼å¶å®å¨ä¸éè¦åç«¯çè¿è¡æ¶ãåªè¦è½æjsonææ¬è½¬æ¢ææ­£ç¡®çASTå°±å·²ç»ç®å®æä»»å¡ï¼å¨æ­¤åºç¡ä¸å®ç°ä¸ä¸ªåºäºASTçPretty JSONè¾åºï¼å°±è½äº§çä¸å®çæå°±æã</li>
</ol>
<h5 id="_-1"></h5>
<p>å¨æ¬ç¯åå®¢ä¸­ï¼æä»¬å°åºäº<strong>javaè¯­è¨</strong>ï¼ä¸ä¾èµä»»ä½ç¬¬ä¸æ¹åºï¼ä»é¶å¼å§å®ç°ä¸ä¸ªç®åçjsonè§£æå¨ï¼<strong>MySimpleJsonParser</strong>ãå¶åæ¬ä»¥ä¸å ä¸ªä¸»è¦æ¨¡åï¼</p>
<ol>
<li><strong><code>StaticJsonLexer</code></strong>ï¼ä¸æ¬¡æ§è§£æåºå¨é¨tokençéæjsonè¯æ³åæå¨</li>
<li><strong><code>StreamJsonLexer</code></strong>ï¼æéæ°æ§è§£ætokençæµå¼jsonè¯æ³åæå¨</li>
<li><strong><code>RecursiveJsonParser</code></strong>ï¼åºäºéå½çjsonè¯­æ³è§£æå¨</li>
<li><strong><code>StackBaseJsonParser</code></strong>ï¼åºäºæ¾å¼å æ çjsonè¯­æ³è§£æå¨ï¼ééå½ï¼</li>
<li><strong><code>ASTç»æ</code></strong>ï¼JsonElementåå¶å­ç±»ï¼å¹¶åºäºASTçæPretty JSONå­ç¬¦ä¸²çå·¥å·æ¹æ³</li>
</ol>
<h2 id="2-ä»ææ³å°è¯æ³åæå¨æå-json-lexer">2. ä»ææ³å°è¯æ³åæå¨ï¼æå json lexer</h2>
<p>è¯æ³åæé¶æ®µçä»»å¡æ¯ï¼å°åå§çå­ç¬¦æµï¼æç§jsonçè¯æ³è§åï¼è½¬æ¢ä¸ºtokenæµãä¹åçè¯­æ³åæä¼å¨tokenæµçåºç¡ä¸æææ³è§åæå»ºASTã</p>
<h3 id="21-jsonææ³ä¸åºæ¬ç»æ">2.1 jsonææ³ä¸åºæ¬ç»æ</h3>
<p>æ ¹æ®<a href="https://www.json.org/json-en.html" target="_blank" rel="noopener nofollow"><strong>jsonå®æ¹ææ¡£</strong></a>ï¼jsonä¸­ä¸»è¦åå«ä»¥ä¸å ç±»ç»æï¼</p>
<ol>
<li><strong>string</strong>ï¼ç±åå¼å·åä½çUnicodeå­ç¬¦ä¸²ï¼å¯åå«è½¬ä¹å­ç¬¦ãä¸ä¸ªå­ç¬¦ï¼characterï¼ä¹å¯ä»¥æ¯ä¸ä¸ªåç¬çå­ç¬¦ä¸²ï¼character stringï¼ã</li>
<li><strong>number</strong>ï¼ä»¥<code>0</code>æ<code>-</code>å¼å¤´ï¼å¯ä»¥æ¯æ´æ°ãå°æ°ããè´æ°æèæ¯åå«ä¸ä¸ªE/eç¬¦å·çææ°ã</li>
<li><strong>object</strong>ï¼ä»¥â<code>{</code>â å¼å¤´ï¼ä»¥â<code>}</code>âç»å°¾ã</li>
<li><strong>array</strong>ï¼ä»¥â<code>[</code>â å¼å¤´ï¼ä»¥â<code>]</code>âç»å°¾ã</li>
<li><strong>value</strong>ï¼å¯ä»¥æ¯stringãnumberã<code>true</code>(å³é®å­)ã<code>false</code>(å³é®å­)ã<code>null</code>(å³é®å­)ãobjectæèarrayã</li>
<li><strong>whitespace</strong>ï¼ç±ä»»æä¸ªspaceç©ºæ ¼ãlinefeedæ¢è¡ç¬¦ãcarriage returnåè½¦ç¬¦ä»¥åtabå¶è¡¨ç¬¦ç»æï¼æ¬èº«æ æä¹ï¼ä»èµ·å°åå²çä½ç¨ã</li>
</ol>
<h5 id="_-2"></h5>
<ul>
<li>ä»ç»åæåï¼åç°stringç»æãnumberç»æåwhitespaceç»æä»¥å<code>{</code>ã<code>}</code>ã<code>[</code>ã<code>]</code> è¿ç±»ç¬¦å·é½æ¯åºæ¬ç»æï¼æ¯èªèº«æ æ³ååµå¥å¶å®ç»æçåºæ¬ååï¼å æ­¤å¶é½æ¯æç»ASTä¸­çå¶å­èç¹ï¼èobjectãarrayåvalueé½æ¯å¯ä»¥äºç¸åµå¥çå¤åç»æï¼å¶é½æ¯ASTä¸­çéå¶å­èç¹ã</li>
<li>å¯¹äºè¿äºå¯åµå¥çéASTå¶å­èç¹ï¼å¿é¡»å¨è¯­æ³åæä¸­æè½å®æè§£æï¼èstringç»æãnumberç»æãfalseãtrueãnullå³é®å­ä»¥åâ{âãâ]âç­ç¹æ®ç¬¦å·ï¼åéåå¨è¯æ³åæä¸­å®æè§£æã<br>
å ä¸ºjsonè¯­æ³ä¸­ï¼æ è®ºåå§çjsonå­ç¬¦ä¸²ä¸­ä¸ä¸ªnumberå­é¢éæå¤å¤æ(æ¯å¦-2.03214e+6605218)ï¼å¨è¯­æ³åæä¸­é½åªéè¦å½åä¸ä¸ªå®æ´çnumberç±»åçtokenæ¥å¤çå³å¯ã</li>
<li>è¯æ³åæä¸æ³¨äºå±é¨ï¼å°åå§çå­ç¬¦æµæç§è¯æ³è§åæ­£ç¡®çè½¬æ¢ä¸ºtokenæµï¼èè¯­æ³åæåä¸æ³¨äºå°tokenæµæç§è¯­æ³è§åè½¬æ¢ä¸ºæ­£ç¡®çASTæ ç»æã<br>
éè¿å°æ´ä¸ªåææµç¨ï¼ææºçåè§£ä¸ºè¯æ³åæåè¯­æ³åæç­ç­ä¸åæ­¥éª¤ï¼æ¯ä¸ªæ­¥éª¤é½ä¾èµäºåä¸ä¸ªæ­¥éª¤çäº§åºçåå±è®¾è®¡ï¼è½å¤å¾å¥½çæ§å¶è§£æå¨æ´ä½çå¤æåº¦ï¼æ¹ä¾¿è°è¯çåæ¶æ§è½ä¸ä¹æå¾å¤§çæåã<br>
å æ­¤ï¼é¤äºå°æ°éå¸¸ç®åçè¯­è¨å¤ï¼å ä¹ææçç¼è¯å¨é½ä¼éç¨åå±çæ¶ææ¥å®ç°æ´ä½çåè½ã</li>
</ul>
<h3 id="22-tokenç±»åå®ä¹">2.2 tokenç±»åå®ä¹</h3>
<p>ä»ææ³è§åº¦ï¼jsonä¸­åè®¸çtokenç±»åå¤§è´å¯åä¸ºä¸ç±»ï¼</p>
<ol>
<li>ç¹æ®ç¬¦å·ï¼è¯¸å¦â<code>{</code>âãâ<code>}</code>âãâ<code>[</code>âãâ<code>]</code>âãâ<code>,</code>â,â<code>:</code>â,â<code>"</code>âç­ç¬ç«çå­ç¬¦æ¯jsonä¸­çç¹æ®ç¬¦å·</li>
<li>å³é®å­ï¼å®æ´ä¸ç¬ç«ç<code>true</code>ã<code>false</code>ã<code>null</code>è¢«è§ä¸ºå³é®å­</li>
<li>å­é¢éï¼numberãstringè¿ä¸¤ç§å¤æå­ç¬¦æµå­é¢é</li>
</ol>
<h5 id="_-3"></h5>
<p>å æ­¤æä»¬å¯ä»¥åå®ä¹åºjsonçtokenç±»åæä¸¾ãå¶ä¸­EOFç±»åæ¯é¢å¤çï¼ç¨äºå¨å®ææ´ä¸ªå­ç¬¦æµçè¯æ³åæåï¼è¿½å å°tokenæµçæåï¼æ å¿çtokenæµçç»æã</p>
<pre><code class="language-java">public enum JsonTokenTypeEnum {
    LEFT_BRACE("{"),
    RIGHT_BRACE("}"),

    LEFT_BRACKET("["),
    RIGHT_BRACKET("]"),

    COMMA(","),
    COLON(":"),

    TRUE("true"),
    FALSE("false"),
    NULL("null"),

    STRING("string"),
    NUMBER("number"),

    EOF("EOF"),
    ;
    private final String key;

    JsonTokenTypeEnum(String key) {
        this.key = key;
    }

    public String getKey() {
        return key;
    }
}
</code></pre>
<h3 id="23-è¯æ³åæå¨æ´ä½æ¡æ¶ä¸ç¹æ®å­ç¬¦çè¯æ³åæ">2.3 è¯æ³åæå¨æ´ä½æ¡æ¶ä¸ç¹æ®å­ç¬¦çè¯æ³åæ</h3>
<p>ç°å¨æä»¬å·²ç»ç¥éè¯¸å¦â{âãâ]âç­ç¬ç«å­ç¬¦æ¯jsonä¸­çç¹æ®ç¬¦å·ï¼ä½æ¯å½æä»¬å¨å­ç¬¦æµä¸­éå°äºä¸ä¸ªâ{âå­ç¬¦æ¶ï¼å¹¶ä¸è½æ èçå°å¶ä½ä¸ºä¸ä¸ªLEFT_BRACEç±»åçtokenæ¥å¤çãå ä¸ºå¦æå¶æ¯è¢«åå¼å·åè£¹çï¼ä½ä¸ºstringç±»åtokenåå®¹çä¸é¨åï¼é£ä¹å°±å¹¶ä¸è½å°å¶ç´æ¥å½åç¬ç«çtokenæ¥å¯¹å¾ã<br>
æä»¥ï¼è¯æ³åæä¸­ä¸è¬ä½¿ç¨æéç¶æèªå¨æºæ¥è§£å³æ­¤ç±»âåä¸å­ç¬¦å¨ä¸åä¸ä¸æå«ä¹ä¸åâçé®é¢ï¼å¨å¤æ­å¦ä½å¤çå­ç¬¦æµæ¶å¹¶ä¸ä»ä»åå³äºä¸ä¸ä¸ªå­ç¬¦æ¯ä»ä¹ï¼èè¿è¦ç»åå½åèªå¨æºçç¶ææ¥å³å®è¡ä¸ºã<br>
ä»¥ä¸è¿°å¯¹â{âå­ç¬¦çå¤çä¸ºä¾ï¼å¦ææ¯å¨åå§åç¶æä¸(å·²ç»å®æäºä¸ä¸ªå®æ´tokençè§£æ,åå¤å¼å§è§£æä¸ä¸ä¸ªæ°token)ï¼ç¢°å°â{âå­ç¬¦æ¶å¯ä»¥ç¡®å®çå°å¶è½¬åä¸ºLEFT_BRACEç±»åçtokenï¼ä½æ¯å½èªå¨æºå¤äºstringç±»åtokençè§£æç¶ææ¶ï¼åéè¦å°å¶ä½ä¸ºstringç±»åtokenåå®¹çä¸é¨åã</p>
<h5 id="jsonè¯æ³åæèªå¨æºæ»è§å¾">jsonè¯æ³åæèªå¨æºæ»è§å¾</h5>
<p>åºäºå®æ¹ææ¡£ä¸­çjsonææ³è§åï¼æä»¬å¯ä»¥è®¾è®¡åºä¸ä¸ªå¦ä¸å¾æç¤ºçjsonæéç¶æèªå¨æºæ¥å®ç°æä»¬çè¯æ³åæã<br>
<img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211195126490-433213565.png" alt="lexer_total" loading="lazy"></p>
<h5 id="_-4"></h5>
<ul>
<li>å¨jsonè§£æä¸å¼å§ï¼èªå¨æºä½äºç¶æ0ï¼éåä¾¿ä¼åºäºå­ç¬¦æµçä¸ä¸ä¸ªå­ç¬¦çç±»åè¿è¡ç¶æè½¬æ¢ï¼å¨è¯»åå°è¯¸å¦â{âãâ[âãâ,âç­ç¬ç«ç¬¦å·æ¶ï¼ä¾¿ä¼ç´æ¥æ¥æ¶è¯¥å­ç¬¦ï¼æ¨è¿å­ç¬¦æµï¼åæ¶çæå¯¹åºç±»åçtokenã</li>
<li>å¨å®æ´çè§£æåºä¸ä¸ªå®æ´tokenåï¼èªå¨æºä¾¿ä¼éæ°åå°ç¶æ0ï¼åå¤å°è¯è§£æä¸ä¸ä¸ªæ°çtokenãç¶æ0åªè½åæ³çæ¥æ¶æéç§ç±»çå­ç¬¦ï¼å¯¹äºä¸ç¬¦åjsonææ³çå­ç¬¦å°è®¤ä¸ºå½åå­ç¬¦æµä¸æ¯åæ³çjsonå­ç¬¦ä¸²èç´æ¥æ¥éï¼éåºè§£æã</li>
<li>å¯¹äºæ´å¤æçstringç±»åãnumberç±»åtokençè§£æï¼æä»¬æ¾å¨åé¢çå°èåå±å¼ï¼æ»è§å¾ä¸­ææ¶çç¥ã</li>
</ul>
<h5 id="éæçè¯æ³åæå¨å®ç°">éæçè¯æ³åæå¨å®ç°</h5>
<pre><code class="language-java">public class StaticJsonLexer extends AbstractJsonLexer{

    public StaticJsonLexer(String jsonString) {
        super(jsonString);
    }

    /**
     * ä¸æ¬¡å®æ´çæ«æï¼éæµå¼çå¤ç
     * */
    public List&lt;JsonToken&gt; doLex(){
        char[] chars = super.jsonStringArray;

        // ç¸å½äºæ¯ç¶æ0
        while(doLexContext.currentIndex &lt; chars.length){
            char ch = chars[doLexContext.currentIndex];

            switch(ch){
                case '{':
                    doLexContext.tokenCollector.add(new JsonToken(JsonTokenTypeEnum.LEFT_BRACE));
                    doLexContext.currentIndex++;
                    break;
                case '}':
                    doLexContext.tokenCollector.add(new JsonToken(JsonTokenTypeEnum.RIGHT_BRACE));
                    doLexContext.currentIndex++;
                    break;
                case '[':
                    doLexContext.tokenCollector.add(new JsonToken(JsonTokenTypeEnum.LEFT_BRACKET));
                    doLexContext.currentIndex++;
                    break;
                case ']':
                    doLexContext.tokenCollector.add(new JsonToken(JsonTokenTypeEnum.RIGHT_BRACKET));
                    doLexContext.currentIndex++;
                    break;
                case ',':
                    doLexContext.tokenCollector.add(new JsonToken(JsonTokenTypeEnum.COMMA));
                    doLexContext.currentIndex++;
                    break;
                case ':':
                    doLexContext.tokenCollector.add(new JsonToken(JsonTokenTypeEnum.COLON));
                    doLexContext.currentIndex++;
                    break;
                case '"':
                    doLexContext.tokenCollector.add(parseString(chars, doLexContext));
                    break;
                case 't':
                    // å°è¯è§£ætrueå³é®å­
                    doLexContext.tokenCollector.add(parseTrueKeyword(chars, doLexContext));
                    break;
                case 'f':
                    // å°è¯è§£æfalseå³é®å­
                    doLexContext.tokenCollector.add(parseFalseKeyword(chars, doLexContext));
                    break;
                case 'n':
                    // å°è¯è§£ænullå³é®å­
                    doLexContext.tokenCollector.add(parseNullKeyword(chars, doLexContext));
                    break;
                default:
                    // å¶å®case
                    if(ch == '-' || CommonStringUtil.is0_9(ch)){
                        // numberè§£æ
                        JsonToken numberToken = parseNumber(chars, doLexContext);
                        doLexContext.tokenCollector.add(numberToken);
                        break;
                    }else if(CommonStringUtil.isWhitespace(ch)){
                        // whiteSpace ç´æ¥è·³è¿
                        doLexContext.currentIndex++;
                        break;
                    }else{
                        throw new MuJsonParserException("unexpected character: " + ch + " at index " + doLexContext.currentIndex);
                    }
            }
        }

        // æåå ä¸EOF
        doLexContext.tokenCollector.add(new JsonToken(JsonTokenTypeEnum.EOF));
        return doLexContext.tokenCollector;
    }
}
</code></pre>
<p>æ½è±¡ç¶ç±»<code>AbstractJsonLexer</code>å°è£äºstring/number/keywordç­å·ä½ç±»åçå¬å±è§£æé»è¾ï¼</p>
<pre><code class="language-java">public abstract class AbstractJsonLexer {

    protected final char[] jsonStringArray;

    protected final DoLexContext doLexContext;

    public AbstractJsonLexer(String jsonString) {
        this.jsonStringArray = jsonString.toCharArray();
        this.doLexContext = new DoLexContext();
    }

    protected JsonToken parseNumber(char[] chars, DoLexContext doLexContext){
        // numberç±»åçåå®¹
        String numberStr = new NumberLexStatemachine().tryParse(chars,doLexContext);

        return new JsonToken(JsonTokenTypeEnum.NUMBER, numberStr);
    }

    protected JsonToken parseString(char[] chars, DoLexContext doLexContext){
        // stringç±»åçåå®¹
        String stringStr = new StringLexStatemachine().tryParse(chars,doLexContext);

        return new JsonToken(JsonTokenTypeEnum.STRING, stringStr);
    }

    protected JsonToken parseTrueKeyword(char[] chars, DoLexContext doLexContext){
        // trueå³é®å­
        String stringStr = new KeywordTrueLexStatementMachine().tryParse(chars,doLexContext);

        return new JsonToken(JsonTokenTypeEnum.TRUE, stringStr);
    }

    protected JsonToken parseFalseKeyword(char[] chars, DoLexContext doLexContext){
        // falseå³é®å­
        String stringStr = new KeywordFalseLexStatementMachine().tryParse(chars,doLexContext);

        return new JsonToken(JsonTokenTypeEnum.FALSE, stringStr);
    }

    protected JsonToken parseNullKeyword(char[] chars, DoLexContext doLexContext){
        // nullå³é®å­
        String stringStr = new KeywordNullLexStatementMachine().tryParse(chars,doLexContext);

        return new JsonToken(JsonTokenTypeEnum.NULL, stringStr);
    }
}
</code></pre>
<h5 id="_-5"></h5>
<ul>
<li>ä¸ºäºæ¯æåç»­æµå¼çè¯æ³åæå¨ï¼éæçè¯æ³åæå¨StaticJsonLexerç»§æ¿èªAbstractJsonLexerç±»ï¼æé æ¹æ³ä¸­æ¥æ¶ä¸ä¸ªå­ç¬¦ä¸²ï¼å¹¶éè¿æ¹æ³doLexè¿è¡è§£æï¼è¿åä¸æ¬¡æ§å®æ´è§£æå­ç¬¦ä¸²åçtokenåè¡¨ã</li>
<li>doLexæ¹æ³ä¸­æ¯ä¸ä¸ªwhileå¾ªç¯ï¼æ¯ä¸æ¬¡å¾ªç¯å¼å§é½ç¸å½äºæ¯èªå¨æºä½äºç¶æ0ï¼å¨è§£ææ¶ä¼éè¿èªå¢currentIndexä¸æ­å°æ¨è¿å­ç¬¦æµï¼æåè§£æåºå®æ´çtokenåä¾¿ä¼å°æ°çtokenä¿å­å°ä¸ä¸æä¸­çtokenCollectorä¸­ãåªæå¨è§£ææ¥éæèæåå®æäºæ´ä¸ªå­ç¬¦ä¸²çè§£æåæä¼éåºå¾ªç¯ã</li>
<li>å¨æ­£å¸¸éåºwhileå¾ªç¯åï¼doLexæ¹æ³è¿ååtokenéåçå°¾é¨ä¼è¿½å ä¸ä¸ªç¹æ®çEOFç±»åçtokenï¼ç¨äºåç¥ä¸ä¸é¶æ®µçparserå·²ç»è§£æå°äºtokenæµçæ«å°¾ï¼è¯¥ç»æè§£æäºã</li>
</ul>
<h3 id="24-numberç±»åçè¯æ³åæ">2.4 numberç±»åçè¯æ³åæ</h3>
<p>numberçè¯æ³è§åç¸å¯¹å¤æï¼å ä¸ºnumberç±»åä½ä¸ºjsonä¸­è¡¨ç¤ºæ°å­çç»ä»¶ï¼å¶å¯ä»¥æ¯æ´æ°ï¼ä¹å¯ä»¥æ¯å°æ°ãè´æ°ï¼åæ¶è¿å¯ä»¥æ¯å¸¦ç¬¦å·e/Eçææ°å½¢å¼ã</p>
<h5 id="json-numberç±»åtokençè¯æ³è§å">json numberç±»åtokençè¯æ³è§å</h5>
<pre><code>number
    integer fraction exponent

integer
    digit
    onenine digits
    '-' digit
    '-' onenine digits

digits
    digit
    digit digits

digit
    '0'
    onenine

onenine
    '1' . '9'

fraction
    ""
    '.' digits

exponent
    ""
    'E' sign digits
    'e' sign digits

sign
    ""
    '+'
    '-'
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211195806369-790385529.png" alt="json_number_lex_rule" loading="lazy"></p>
<h5 id="_-6"></h5>
<p>åºäºä¸è¿°è¯æ³è§åï¼æä»¬å¯ä»¥æé åºå¦ä¸å¾æç¤ºçç¨äºè§£ænumberç±»åtokençç¶æèªå¨æºã</p>
<h5 id="numberç±»åè§£æçç¶æèªå¨æºç¤ºæå¾">numberç±»åè§£æçç¶æèªå¨æºç¤ºæå¾</h5>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211201818452-99218238.png" alt="json_number_lex_state_machine" loading="lazy"></p>
<h5 id="_-7"></h5>
<p>è®¾è®¡å¥½ä¸è¿°çç¶æèªå¨æºåï¼å°±å¯ä»¥æç§å¾ä¸­çç¶æè½¬ç§»å³ç³»æåä¸ä¸ªç®åçç¶ææºæ¥è§£ænumberç±»åçtokenäºã</p>
<h5 id="numberç±»åè§£æç¶ææºå®ç°æºç ">numberç±»åè§£æç¶ææºå®ç°æºç </h5>
<pre><code class="language-java">public class NumberLexStatemachine extends LexStatementMachine{

    private static final Map&lt;Integer,Boolean&gt; staticFinalStateMap;
    private static final LexStateHandler[] lexStateHandlers;

    static{
        staticFinalStateMap = new HashMap&lt;&gt;();
        staticFinalStateMap.put(-1,true);
        staticFinalStateMap.put(1,true);
        staticFinalStateMap.put(2,false);
        staticFinalStateMap.put(3,true);
        staticFinalStateMap.put(4,true);
        staticFinalStateMap.put(5,false);
        staticFinalStateMap.put(6,true);
        staticFinalStateMap.put(7,false);
        staticFinalStateMap.put(8,false);
        staticFinalStateMap.put(9,true);

        lexStateHandlers = new LexStateHandler[]{
            new State0Handler(), new State1Handler(), new State2Handler(), new State3Handler(), new State4Handler(),
            new State5Handler(),new State6Handler(),new State7Handler(),new State8Handler(),new State9Handler()
        };
    }

    public NumberLexStatemachine() {
        this.stateHandlers = lexStateHandlers;
        this.isFinalStateMap = staticFinalStateMap;
    }

    private static abstract class NumberLexStateHandler implements LexStateHandler {

        @Override
        public int processInState(char[] chars, DoLexContext doLexContext, LexStatementMachine lexStatementMachine, StringBuilder oneTokenAcceptResult) {
            char currentChar = chars[doLexContext.currentIndex];

            // whitespaceç¬¦å·ä»¥ånumberååæ³çç»ç»ç¬¦
            if(CommonStringUtil.isWhitespace(currentChar)
                || currentChar == ']' || currentChar == '}' || currentChar == ',' || currentChar == ':'){
                if(lexStatementMachine.currentStateIsFinal()){
                    // ç»ænumberçè§£æ
                    return -1;
                }else{
                    // éå°äºåéç¬¦ï¼ä½æ¯å½ånumberè§£æçç¶æä¸æ¯ç»æï¼æ æ³è½¬æ¢ä¸ºä¸ä¸ªåæ³çnumberç±»åçtokenï¼æå¼å¸¸
                    throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
                }
            }

            return doProcessInState(currentChar,doLexContext, oneTokenAcceptResult);
        }

        abstract int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult);
    }

    private static class State0Handler extends NumberLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(currentChar == '0'){
                // accept
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                // è¿å¥ç¶æ1
                return 1;
            }

            if(currentChar == '-'){
                // accept
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                // è¿å¥ç¶æ2
                return 2;
            }

            if(CommonStringUtil.is1_9(currentChar)){
                // accept
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                // è¿å¥ç¶æ3
                return 3;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State1Handler extends NumberLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(currentChar == '.'){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 5;
            }

            if(currentChar == 'e' || currentChar == 'E'){
                accept(currentChar,doLexContext, oneTokenAcceptResult);
                return 7;
            }

            throw new MuJsonParserException("unexpected char '" + currentChar + "', index=" + doLexContext.currentIndex);
        }
    }

    private static class State2Handler extends NumberLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(currentChar == '0'){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 1;
            }

            if(CommonStringUtil.is1_9(currentChar)){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 3;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State3Handler extends NumberLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(currentChar == '.'){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 5;
            }

            if(currentChar == 'e' || currentChar == 'E'){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 7;
            }

            if(CommonStringUtil.is0_9(currentChar)){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 4;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State4Handler extends NumberLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext,StringBuilder oneTokenAcceptResult) {
            if(currentChar == '.'){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 5;
            }

            if(currentChar == 'e' || currentChar == 'E'){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 7;
            }

            if(CommonStringUtil.is0_9(currentChar)){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 4;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State5Handler extends NumberLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(CommonStringUtil.is0_9(currentChar)){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 6;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State6Handler extends NumberLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext,StringBuilder oneTokenAcceptResult) {
            if(CommonStringUtil.is0_9(currentChar)){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 6;
            }

            if(currentChar == 'e' || currentChar == 'E'){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 7;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State7Handler extends NumberLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext,StringBuilder oneTokenAcceptResult) {
            if(CommonStringUtil.is0_9(currentChar)){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 9;
            }

            if(currentChar == '-' || currentChar == '+'){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 8;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State8Handler extends NumberLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(CommonStringUtil.is0_9(currentChar)){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 9;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State9Handler extends NumberLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(CommonStringUtil.is0_9(currentChar)){
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 9;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }
}

</code></pre>
<pre><code class="language-java">public abstract class LexStatementMachine {

    protected int currentState = 0;
    protected StringBuilder oneTokenAcceptResult = new StringBuilder();

    protected LexStateHandler[] stateHandlers;
    protected Map&lt;Integer,Boolean&gt; isFinalStateMap;

    public String tryParse(char[] chars, DoLexContext doLexContext){
        doParse(chars,doLexContext);

        boolean isFinalState = isFinalStateMap.get(currentState);
        if(isFinalState){
            return oneTokenAcceptResult.toString();
        }else{
            throw new MuJsonParserException(String.format("currentState is not finalState! acceptResult=%s, acceptResult=%s",currentState, oneTokenAcceptResult));
        }
    }

    public boolean currentStateIsFinal(){
        return isFinalStateMap.get(currentState);
    }

    protected static void accept(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult){
        oneTokenAcceptResult.append(currentChar);
        doLexContext.currentIndex++;
    }

    private void doParse(char[] chars, DoLexContext doLexContext){
        // ä¸è¿æ¥æ¯ç¶æ0
        while(doLexContext.currentIndex &lt; chars.length){
            if(currentState == -1){
                // éå°äºåæ³çåéç¬¦å·ï¼éåºtokenè§£æ
                return;
            }

            if(currentState &gt;= stateHandlers.length){
                // æbug
                throw new MuJsonParserException(String.format("unknown state! currentState=%s",currentState));
            }
            LexStateHandler targetStateHandler = stateHandlers[currentState];
            
            currentState = targetStateHandler.processInState(chars,doLexContext,this,oneTokenAcceptResult);
        }
    }
}
</code></pre>
<h5 id="_-8"></h5>
<ul>
<li>NumberLexStatemachineç»§æ¿èªç¶ç±»LexStatementMachineãå¨LexStatementMachineä¸­ä¸doLexæ¹æ³ç±»ä¼¼ï¼ä¹æ¯ä¸ä¸ªwhileå¾ªç¯æ¥åå¤çå¤çæ¯ä¸æ¬¡çç¶æè·³è½¬ã</li>
<li>å­ç±»NumberLexStatemachineå®ä¹äºä¸ç³»åçLexStateHandlerç¶æå¤çå¨ï¼æ¯ä¸ä¸ªç¶æå¤çå¨é½å¯¹åºç¶ææºç¤ºæå¾ä¸­çä¸ä¸ªç¶æã</li>
<li>æ¯ä¸ä¸ªLexStateHandlerä¸­çåè½é½æ¯è¾ç±»ä¼¼ï¼å³å³å®å¨å½åç¶æä¸èªå·±è½å¤æ¥æ¶çå­ç¬¦ç±»åï¼ä»¥åæ§å¶å¨åæ³æ¥æ¶å­ç¬¦æµå½åå­ç¬¦ååºè¯¥è·³è½¬çä¸ä¸ä¸ªç¶ææ¯ä»ä¹ã<br>
å¨åæ³æ¥æ¶å­ç¬¦æ¶ï¼ä¼ä¿®æ¹ä¸ä¸æä¸­çå½åå­ç¬¦æéä»¥æ¨è¿å­ç¬¦æµï¼åæ¶å°æ¥åå°çå½ååæ³å­ç¬¦è¿½å å°oneTokenAcceptResultä¸­ã</li>
<li>å¦æéå°äºåæ³çç»æåéç¬¦ï¼æ¯å¦whitespaceæèâ}âãâ]âä¹ç±»çå­ç¬¦ï¼ä¸å½åç¶ææ¯å±äºnumberè§£æçç»æï¼åNumberLexStateHandlerä¼è¿å-1ï¼ç»æ­¢å½åtokençè§£æã(æ¯å¦{"number":-123.0}ç»ææ¶çç¶ææ¯6ï¼6æ¯ç»æï¼æä»¥å¶æ¯åæ³çjsonä¸²)<br>
å¦æç¶æå¤çå¨ä¸­éå°å½åç¶æä¸ä¸åæ³çå­ç¬¦ï¼æèå¨éåºè§£ææ¶å½åç¶æä¸å±äºnumberè§£æçç»æï¼è¯´æå½åå­ç¬¦ä¸²ä¸æ¯åæ³çjsonä¸²ï¼åä¼ç´æ¥æåºå¼å¸¸ï¼éåºè¯æ³è§£æã(æ¯å¦{"number":-123.}ç»ææ¶çç¶ææ¯5,5ä¸æ¯ç»æï¼æä»¥å¶æ¯ä¸åæ³çjsonä¸²)</li>
<li>NumberLexStatemachineç¶ææºæ­£å¸¸éåºå½ånumberç±»åtokenåï¼è¿åæ¶éå°çææå­ç¬¦oneTokenAcceptResultï¼ä½ä¸ºnumberç±»åçå­é¢éè¿åã</li>
</ul>
<h3 id="25-stringç±»åçè¯æ³åæ">2.5 stringç±»åçè¯æ³åæ</h3>
<p>stringç±»åçè¯æ³è§åç¸æ¯ä¹ä¸æ¯è¾ç®åï¼è¦æ±ä»¥åå¼å·å¼å¤´ï¼å¹¶ä»¥åå¼å·ç»å°¾å³å¯ï¼ä½éè¦é¢å¤å¤çè½¬ä¹å­ç¬¦ç¸å³çé»è¾ã</p>
<h5 id="json-stringç±»åtokençè¯æ³è§å">json stringç±»åtokençè¯æ³è§å</h5>
<pre><code>string
    '"' characters '"'

characters
    ""
    character characters

character
    '0020' . '10FFFF' - '"' - '\'
    '\' escape

escape
    '"'
    '\'
    '/'
    'b'
    'f'
    'n'
    'r'
    't'
    'u' hex hex hex hex

hex
    digit
    'A' . 'F'
    'a' . 'f'
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211195844242-1192651121.png" alt="json_string_lex_rule" loading="lazy"></p>
<h5 id="_-9"></h5>
<p>åºäºä¸è¿°è¯æ³è§åï¼æä»¬æé åºå¦ä¸å¾æç¤ºçç¨äºè§£æstringç±»åtokençç¶æèªå¨æºã</p>
<h5 id="stringç±»åè§£æçç¶æèªå¨æºç¤ºæå¾">stringç±»åè§£æçç¶æèªå¨æºç¤ºæå¾</h5>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211195854133-180088812.png" alt="json_string_lex_state_machine" loading="lazy"></p>
<h5 id="stringç±»åè§£æç¶ææºå®ç°æºç ">stringç±»åè§£æç¶ææºå®ç°æºç </h5>
<pre><code class="language-java">public class StringLexStatemachine extends LexStatementMachine{

    private static final Map&lt;Integer,Boolean&gt; staticFinalStateMap;
    private static final LexStateHandler[] lexStateHandlers;

    static{
        staticFinalStateMap = new HashMap&lt;&gt;();
        staticFinalStateMap.put(-1,true);
        staticFinalStateMap.put(1,false);
        staticFinalStateMap.put(2,true);
        staticFinalStateMap.put(3,false);
        staticFinalStateMap.put(4,false);
        staticFinalStateMap.put(5,false);
        staticFinalStateMap.put(6,false);
        staticFinalStateMap.put(7,false);

        lexStateHandlers = new LexStateHandler[]{
            new State0Handler(),new State1Handler(),new State2Handler(),new State3Handler(),new State4Handler(),
            new State5Handler(),new State6Handler(),new State7Handler()};
    }

    public StringLexStatemachine() {
        this.stateHandlers = lexStateHandlers;
        this.isFinalStateMap = staticFinalStateMap;
    }

    private static abstract class StringLexStateHandler implements LexStateHandler {

        @Override
        public int processInState(char[] chars, DoLexContext doLexContext, LexStatementMachine lexStatementMachine, StringBuilder oneTokenAcceptResult) {
            char currentChar = chars[doLexContext.currentIndex];

            return doProcessInState(currentChar,doLexContext,oneTokenAcceptResult);
        }

        abstract int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult);
    }

    private static class State0Handler extends StringLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(currentChar == '"'){
                // accept
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                // è¿å¥ç¶æ1
                return 1;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State1Handler extends StringLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(currentChar == '"'){
                // accept
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                // è¿å¥ç¶æ2
                return 2;
            }

            if(currentChar == '\\'){
                // accept
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                // è¿å¥ç¶æ3
                return 3;
            }

            // æ§å¶å­ç¬¦æ¯ä¸åæ³çï¼ä¸è½åºç°å¨stringä¸­
            if (currentChar &lt; 0x20) {
                throw new MuJsonParserException("unexpected control char " + currentChar + " in string, " + doLexContext.currentIndex);
            }

            // é¤äº["]å[\]ä¸¤ä¸ªå­ç¬¦ï¼å«çé½å½åå­ç¬¦ä¸²çä¸é¨åæ¥æ¶
            // accept
            accept(currentChar,doLexContext,oneTokenAcceptResult);
            return 1;
        }
    }

    private static class State2Handler extends StringLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            // ç»æï¼å®æä¸ä¸ªstringçè§£æï¼ç´æ¥éåº
            return -1;
        }
    }

    private static class State3Handler extends StringLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            // åæ³çè½¬ä¹å­ç¬¦
            if(currentChar == '"' || currentChar == '\\' || currentChar == '/' ||
                currentChar == 'b' || currentChar == 'f' || currentChar == 'n' ||
                currentChar == 'r' || currentChar == 't'){
                // æ¥æ¶ï¼åå°ç¶æ1
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 1;
            }

            if(currentChar == 'u'){
                // ç¹æ®case è¦æ±åé¢è¿ç»­4ä¸ªhexå­ç¬¦ '\\u hex hex hex hex'
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 4;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State4Handler extends StringLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(CommonStringUtil.isHex(currentChar)){
                // æ¥æ¶ï¼è¿å¥ç¶æ5
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 5;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State5Handler extends StringLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(CommonStringUtil.isHex(currentChar)){
                // æ¥æ¶ï¼è¿å¥ç¶æ6
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 6;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State6Handler extends StringLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(CommonStringUtil.isHex(currentChar)){
                // æ¥æ¶ï¼è¿å¥ç¶æ7
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 7;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }

    private static class State7Handler extends StringLexStateHandler {
        @Override
        int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult) {
            if(CommonStringUtil.isHex(currentChar)){
                // è¿ç»­æ¥æ¶äº4ä¸ªhexå­ç¬¦ï¼åå°ç¶æ1
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return 1;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }
}
</code></pre>
<h5 id="_-10"></h5>
<ul>
<li>stringç±»åtokenè§£æçç¶ææºä¸numberç±»åçå·¥ä½æ¨¡å¼ç±»ä¼¼ï¼åæ ·ç»§æ¿èªLexStatementMachineï¼å¹¶ä¸å®ä¹äºä¸ç³»åçå¯¹åºç¶ææºç¤ºæå¾ä¸­åä¸ªç¶æçLexStateHandlerã</li>
</ul>
<h3 id="26-å³é®å­çè¯æ³åæ">2.6 å³é®å­çè¯æ³åæ</h3>
<p>æåï¼jsonçè¯æ³åæä¸­è¿æå³é®å­ç±»åçtokenè§£æéè¦å®ç°ãæå¹¸jsonçææ³éå¸¸ç®åï¼åªætrueãfalseånullä¸ä¸ªå³é®å­ï¼ä¸è¿ä¸ä¸ªå³é®å­çf(1)é½ä¸ç¸åï¼ä¹ä¸å¶å®ç±»åçtokençf(1)ä¸ç¸åã<br>
å æ­¤ï¼å¨è¯æ³è§£ææ¶ï¼æä»¬å¯ä»¥å¾ç®åçæ ¹æ®ç¬¬ä¸ä¸ªå­ç¬¦æ¥å³å®è¦è§£æçå³é®å­ç±»åï¼å¨ç¶æ0æ¶ï¼å¦æç¢°å°å­ç¬¦tå°±å°è¯è§£ætrueç±»åçtokenï¼ç¢°å°å­ç¬¦få°±å°è¯è§£æfalseç±»åçtokenï¼ç¢°å°å­ç¬¦nå°±å°è¯è§£ænullç±»åçtokenã<br>
å æ­¤æä»¬å¯ä»¥å¾ç®åçå¾å°å¦ä¸å¾æç¤ºçä¸ä¸ªå³é®å­çç¶æèªå¨æºã</p>
<h5 id="å³é®å­ç±»åè§£æçç¶æèªå¨æºç¤ºæå¾">å³é®å­ç±»åè§£æçç¶æèªå¨æºç¤ºæå¾</h5>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211195910810-282453956.png" alt="json_keyword_lex_state_machine" loading="lazy"></p>
<h5 id="keywordç±»åè§£æç¶ææºå®ç°æºç ">keywordç±»åè§£æç¶ææºå®ç°æºç </h5>
<pre><code class="language-java">public abstract class KeywordLexStatementMachine extends LexStatementMachine{

    protected final String keyword;

    public KeywordLexStatementMachine(String keyword) {
        this.keyword = keyword;
    }

    protected static Map&lt;Integer,Boolean&gt; buildIsFinalStateMap(String keyword){
        Map&lt;Integer,Boolean&gt; isFinalStateMap = new HashMap&lt;&gt;(keyword.length() + 1);
        isFinalStateMap.put(-1,true);

        for(int i=0; i&lt;keyword.length(); i++) {
            isFinalStateMap.put(i,false);
        }

        // æåä¸ä¸ªå­ç¬¦å°±æ¯åççç»æ
        isFinalStateMap.put(keyword.length(),true);

        return isFinalStateMap;
    }

    protected static LexStateHandler[] buildLexStateHandlers(String keyword){
        LexStateHandler[] lexStateHandlers = new LexStateHandler[keyword.length() + 1];

        for(int i=0; i&lt;keyword.length(); i++) {
            char c = keyword.charAt(i);

            lexStateHandlers[i] = new KeywordLexStateHandler(c,i+1);
        }

        // æåä¸ä¸ªç¶æï¼ç´æ¥è¿å
        lexStateHandlers[keyword.length()] = new KeywordLexStateHandler(' ',-1);

        return lexStateHandlers;
    }

    private static class KeywordLexStateHandler implements LexStateHandler {

        private final char targetCh;
        private final int nextState;

        public KeywordLexStateHandler(char targetCh, int nextState) {
            this.targetCh = targetCh;
            this.nextState = nextState;
        }

        @Override
        public int processInState(char[] chars, DoLexContext doLexContext, LexStatementMachine lexStatementMachine, StringBuilder oneTokenAcceptResult) {
            char currentChar = chars[doLexContext.currentIndex];

            return doProcessInState(currentChar,doLexContext,oneTokenAcceptResult);
        }

        private int doProcessInState(char currentChar, DoLexContext doLexContext, StringBuilder oneTokenAcceptResult){
            if(nextState == -1){
                // -1æ¯ç¹æ®çç´æ¥è¿å
                return nextState;
            }

            if(currentChar == targetCh) {
                // æ¥æ¶ï¼è¿å¥ä¸ä¸ä¸ªç¶æ
                accept(currentChar,doLexContext,oneTokenAcceptResult);
                return nextState;
            }

            throw new MuJsonParserException("unexpected char " + currentChar + " " + doLexContext.currentIndex);
        }
    }
}
</code></pre>
<pre><code class="language-java">/**
 * è§£æå³é®å­trueçç¶æèªå¨æº
 * */
public class KeywordTrueLexStatementMachine extends KeywordLexStatementMachine{

    private static final String KEYWORD = JsonTokenTypeEnum.TRUE.getKey();
    private static final Map&lt;Integer,Boolean&gt; staticIsFinalStateMap;
    private static final LexStateHandler[] lexStateHandlers;

    static {
        staticIsFinalStateMap = buildIsFinalStateMap(KEYWORD);
        lexStateHandlers = buildLexStateHandlers(KEYWORD);
    }

    public KeywordTrueLexStatementMachine() {
        super(KEYWORD);

        super.isFinalStateMap = staticIsFinalStateMap;
        super.stateHandlers = lexStateHandlers;
    }
}
</code></pre>
<h5 id="_-11"></h5>
<ul>
<li>ç±äºå³é®å­çè§£æé½æ¯æç®åçååç¶æè½¬ç§»ï¼æä»¥åç¬æ½è±¡åºäºKeywordLexStatementMachineç±»ï¼å¶æ ¹æ®æé æ¹æ³ä¸­ä¼ å¥çå³é®å­å­é¢éï¼èªå¨çæå¯¹åºæ°éçLexStateHandleréååIsFinalStateMapã</li>
<li>falseånullå³é®å­çè¯æ³è§£æä¸trueåºæ¬ä¸è´ï¼è¿éçç¥æ</li>
</ul>
<h5 id="27-jsontokenreader">2.7 jsonTokenReader</h5>
<p>è³æ­¤ï¼æä»¬å°±å·²ç»å®ç°äºåºæ¬çjsonè¯æ³åæè½åï¼è½å¤å°jsonå­ç¬¦ä¸²ä¸æ¬¡æ§çè§£æætokenåè¡¨ä¾ä¸ä¸é¶æ®µçè¯­æ³åæä½¿ç¨ã<br>
ä½å¨è¯­æ³è§£æé¶æ®µï¼parseræ´å¸ææ¥æ¶çæ¯è½å¤èªå·±è®°å¿å½åæå¤çtokençtokenæµï¼èä¸æ¯ä¸ä¸ªå­¤é¶é¶çList<jsontoken>ï¼æä»¥è¿éç®åçä»¥è¿­ä»£å¨çæ¹å¼åè£ä¸ä¸æ¹ä¾¿ä½¿ç¨ã</jsontoken></p>
<pre><code class="language-java">public interface JsonTokenReader {

    boolean hasNextToken();

    JsonToken nextToken();

    JsonToken peek();

    int currentIndex();
}
</code></pre>
<p>éæè¯æ³åæå¨çå®ç°ï¼</p>
<pre><code class="language-java">public class StaticJsonTokenReader implements JsonTokenReader {

    private int currentIndex;

    private final List&lt;JsonToken&gt; tokens;

    public StaticJsonTokenReader(String jsonString) {
        this.currentIndex = 0;

        StaticJsonLexer staticJsonLexer = new StaticJsonLexer(jsonString);
        this.tokens = staticJsonLexer.doLex();
    }

    @Override
    public boolean hasNextToken() {
        return tokens.get(currentIndex).getType() != JsonTokenTypeEnum.EOF;
    }

    @Override
    public JsonToken nextToken() {
        JsonToken jsonToken = tokens.get(currentIndex);
        currentIndex++;
        return jsonToken;
    }

    @Override
    public JsonToken peek() {
        return tokens.get(currentIndex);
    }

    @Override
    public int currentIndex() {
        return this.currentIndex;
    }
}
</code></pre>
<p>ç®ådemoï¼</p>
<pre><code class="language-java">    public static void main(String[] args) {
        String json = "{\"k1\":{\"abc\":123},\"k2\":true}";

        StaticJsonLexer staticJsonLexer = new StaticJsonLexer(json);
        List&lt;JsonToken&gt; jsonTokenList = staticJsonLexer.doLex();
        System.out.println("json=" + json);
        jsonTokenList.forEach(System.out::println);
    }
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211195926464-23510035.png" alt="static_json_lexer_demo_result" loading="lazy"></p>
<h2 id="3-æå-json-è¯­æ³åæå¨ä»-token-å°-ast">3. æå json è¯­æ³åæå¨ï¼ä» token å° AST</h2>
<p>è¯­æ³åæé¶æ®µï¼æ¥æ¶è¯æ³åæé¶æ®µè¾åºçtokenæµï¼éè¦æç§è¯­æ³è§åè§£æåºæ­£ç¡®çASTæ½è±¡è¯­æ³æ ã<br>
å¨jsonçASTä¸­å¶å®æ¬è´¨ä¸åªæä¸ç§ç±»åçåç´ ï¼</p>
<ul>
<li><code>JsonObject</code>ï¼å¯¹è±¡</li>
<li><code>JsonArray</code>ï¼æ°ç»</li>
<li><code>JsonPrimitiveStr</code>ï¼primitiveåºç¡ç±»åï¼string/number/true/false/nullï¼å°è£ä¸ºå­ç¬¦ä¸²å­é¢é</li>
</ul>
<h5 id="_-12"></h5>
<p>primitiveåºç¡ç±»åæ¯æ æ³è¿è¡éå½åµå¥çç±»åï¼æ¯ASTä¸­çå¶èç¹ï¼èobjectåarrayåæ¯å¯ä»¥äºç¸åµå¥ç(å¯¹è±¡çä¸ä¸ªå±æ§å¯ä»¥æ¯æ°ç»æèå¦ä¸ä¸ªå¯¹è±¡ï¼æ°ç»ä¸­çåç´ ä¹å¯ä»¥æ¯å¯¹è±¡æèå¦ä¸ä¸ªæ°ç»)ï¼å¶å±äºASTä¸­çéå¶å­ç»ç¹ã</p>
<h3 id="31-json-astèç¹ç»æå®ä¹">3.1 json ASTèç¹ç»æå®ä¹</h3>
<pre><code class="language-java">public abstract class JsonElement {
}
</code></pre>
<pre><code class="language-java">/**
 * json ASTçobjectç±»åèç¹
 * */
public class JsonObject extends JsonElement{

    private final Map&lt;String,JsonElement&gt; objMap = new LinkedHashMap&lt;&gt;();

    public void putKV(String key, JsonElement value) {
        objMap.put(key, value);
    }

    public Map&lt;String, JsonElement&gt; getObjMap() {
        return objMap;
    }
}
</code></pre>
<pre><code class="language-java">/**
 * json ASTçarrayç±»åèç¹
 * */
public class JsonArray extends JsonElement{

    private List&lt;JsonElement&gt; array = new ArrayList&lt;&gt;();

    public void addElement(JsonElement element) {
        array.add(element);
    }

    public List&lt;JsonElement&gt; getArray() {
        return array;
    }
}
</code></pre>
<pre><code class="language-java">/**
 * json ASTçprimitiveç±»åèç¹
 * */
public class JsonPrimitiveStr extends JsonElement{

    /**
     * åºç¡ç±»åçå­ç¬¦ä¸²å­é¢é
     * */
    private final String primitiveValueStr;

    public JsonPrimitiveStr(String primitiveValueStr) {
        this.primitiveValueStr = primitiveValueStr;
    }

    public String getPrimitiveValueStr() {
        return primitiveValueStr;
    }
}
</code></pre>
<h5 id="_-13"></h5>
<ul>
<li>jsonElementæ¯ææASTèç¹çå±åæ½è±¡ç¶ç±»</li>
<li>jsonçobjectç»ææ å°ä¸ºjavaä¸­æ¯ä¸ä¸ªæåºçk/v Mapç»æ</li>
<li>jsonçarrayç»ææ å°ä¸ºjavaä¸­æ¯ä¸ä¸ªListç»æ</li>
<li>jsonçprimitiveç»ææ å°ä¸ºjavaä¸­çä¸ä¸ªç®åå­ç¬¦ä¸²å­é¢é</li>
</ul>
<h3 id="32-jsonæ ¹èç¹è¯­æ³è§£æ">3.2 jsonæ ¹èç¹è¯­æ³è§£æ</h3>
<pre><code>json
    element
    
element
    ws value ws

value
    object
    array
    string
    number
    "true"
    "false"
    "null"

object
    '{' ws '}'
    '{' members '}'    

array
    '[' ws ']'
    '[' elements ']'
</code></pre>
<h5 id="_-14"></h5>
<p>ä¸è¿°ææ³ä¸­ï¼jsonæ¯ASTçæ ¹èç¹ï¼å¶æç»å¯ä»¥æ¯objectãarrayæè5ç§åºæ¬ç±»åçä¸ç§ã<br>
objectç±»åçf(1)æä¸ä»æ'{'ï¼èarrayç±»åçf(1)æä¸ä»æ'['ï¼å æ­¤æä»¬å¯ä»¥æé åºä¸ä¸ªç®åçæ ¹èç¹è§£æçç¶ææºæ¥å®ç°è¯­æ³åæã</p>
<ul>
<li>è¥tokenæµä¸­çç¬¬ä¸ä¸ª token æ¯ <code>{</code> â è§£æä¸º <code>JsonObject</code>ã</li>
<li>è¥tokenæµä¸­çç¬¬ä¸ä¸ª token æ¯ <code>[</code> â è§£æä¸º <code>JsonArray</code>ã</li>
<li>è¥tokenæµä¸­çç¬¬ä¸ä¸ª token æ¯åºç¡ç±»å â è§£æä¸º <code>JsonPrimitiveStr</code>ã</li>
<li>å¦åé½æ¯éæ³jsonã</li>
</ul>
<h5 id="jsonæ ¹èç¹è¯­æ³è§£æç¶æèªå¨æº">jsonæ ¹èç¹è¯­æ³è§£æç¶æèªå¨æº</h5>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211195937409-994915878.png" alt="json_parser_root" loading="lazy"></p>
<h5 id="jsonæ ¹èç¹è§£æç¶æèªå¨æºå®ç°">jsonæ ¹èç¹è§£æç¶æèªå¨æºå®ç°</h5>
<pre><code class="language-java">/**
 * åºäºéå½å®ç°çjsonè§£æå¨
 * */
public class RecursiveJsonParser extends JsonParser {

    public RecursiveJsonParser(JsonTokenReader tokenReader) {
        super(tokenReader);
    }

    @Override
    public JsonElement doParse() {
        JsonToken token = jsonTokenReader.peek();

        if (token.getType() == JsonTokenTypeEnum.LEFT_BRACE) {
            JsonObjectParseStatementMachine jsonObjectParseStatementMachine = new JsonObjectParseStatementMachine(jsonTokenReader);

            return jsonObjectParseStatementMachine.parseJsonElement();
        }

        if (token.getType() == JsonTokenTypeEnum.LEFT_BRACKET) {
            JsonArrayParseStatementMachine jsonArrayParseStatementMachine = new JsonArrayParseStatementMachine(jsonTokenReader);

            return jsonArrayParseStatementMachine.parseJsonElement();
        }

        // åºç¡ç±»åçvalue
        if (token.getType().isPrimitiveValue()) {
            return new JsonPrimitiveStr(token.getContent());
        }

        // ç¬¬ä¸ä¸ªtokenï¼ä¸å±äºjsonè§åçf(1)éå
        throw new MuJsonParserException("unexpected start json token! token=" + jsonTokenReader.currentIndex());
    }
}
</code></pre>
<pre><code class="language-java">public enum JsonTokenTypeEnum {
    // çç¥äºæ å³é»è¾

    /**
     * åºç¡ç±»åçvalueï¼stringãnumberãtrueãfalseãnullï¼
     * */
    public boolean isPrimitiveValue(){
        return this == STRING || this == NUMBER || this == NULL ||this == TRUE || this == FALSE;
    }
}
</code></pre>
<h3 id="33-json-objectå¯¹è±¡ç»æè§£æ">3.3 json objectå¯¹è±¡ç»æè§£æ</h3>
<p>ç°å¨æä»¬æ¥ç ç©¶json objectå¯¹è±¡çè¯­æ³è§£æãobjectç»ææ¯ä»¥â{âå¼å¤´ï¼â}âç»å°¾çç»æï¼åé¨å¯ä»¥æ0å°Nä¸ªkvé®å¼å¯¹ï¼å¶ä¸­keyå¿é¡»æ¯stringç±»åï¼èvalueåå¯ä»¥æ¯åµå¥çç»æï¼keyåvalueä¹é´ä»¥åå·åéï¼kvå¯¹ä¹é´ä»¥éå·åå²ã<br>
å æ­¤ï¼ä½¿ç¨éå½çæ¹å¼æ¥å®ç°objectå¯¹è±¡çè¯­æ³è§£ææ¯å¾å®¹æçè§£åå®ç°ç(å°½ç®¡éå½çå®ç°æçä¸å¤é«)ã</p>
<h5 id="json-objectå¯¹è±¡ç»æè¯­æ³">json objectå¯¹è±¡ç»æè¯­æ³</h5>
<pre><code>object
    '{' ws '}'
    '{' members '}'

members
    member
    member ',' members

member
    ws string ws ':' element

element
    ws value ws    

value
    object
    array
    string
    number
    "true"
    "false"
    "null"
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211195946762-1722527366.png" alt="json_object_parser" loading="lazy"></p>
<h5 id="objectç»æè§£æç¶æèªå¨æºç¤ºæå¾">objectç»æè§£æç¶æèªå¨æºç¤ºæå¾</h5>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211195955922-1227811677.png" alt="json_object_state_machine" loading="lazy"></p>
<h5 id="objectç»æè§£æç¶æèªå¨æºéå½å®ç°éå½çæ¬">objectç»æè§£æç¶æèªå¨æºéå½å®ç°ï¼éå½çæ¬ï¼</h5>
<p>è¯­æ³åæä¸è¯æ³åæç±»ä¼¼ï¼ä¹æ¯ä½¿ç¨ç¶æèªå¨æºæ¥å®ç°çãå®ç°çå¤§è´æ¹å¼ä¹æ¯éè¿æ½è±¡åºä¸ä¸ªç¶ç±»(AbstractJsonParseStatementMachine),å¨ç¶ç±»ä¸­éè¿æç»­ä¸æ­çä»tokenæµä¸­è¯»åtokenæ¥æ¨è¿ç¶æãå¨å­ç±»ä¸­å®ä¹ç¸åºçç¶æå¤çå¨æ¥å®ç°æ¯ä¸ªç¶æçå¤ç</p>
<pre><code class="language-java">/**
 * åºäºéå½å®ç°ç objectç±»åè¯­æ³è§£æç¶æèªå¨æº
 * */
public class JsonObjectParseStatementMachine extends AbstractJsonParseStatementMachine&lt;JsonObject&gt;{

    public JsonObjectParseStatementMachine(JsonTokenReader jsonTokenReader) {
        this.jsonTokenReader = jsonTokenReader;
        this.targetJsonElement = new JsonObject();
        this.recursiveDoParserContext = new RecursiveDoParserContext&lt;&gt;(this.targetJsonElement);
        stateHandlers = new ParserStateHandler[]{
            new ParserState0Handler(),new ParserState1Handler(),new ParserState2Handler(),new ParserState3Handler(),
            new ParserState4Handler(),new ParserState5Handler(),new ParserState6Handler()
        };
    }

    private static class ParserState0Handler implements ParserStateHandler&lt;JsonObject&gt;{

        @Override
        public int processInState(JsonTokenReader jsonTokenReader, RecursiveDoParserContext&lt;JsonObject&gt; recursiveDoParserContext) {
            JsonToken token = jsonTokenReader.peek();

            if(token.getType() != JsonTokenTypeEnum.LEFT_BRACE){
                throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
            }

            accept(jsonTokenReader);
            return 1;
        }
    }

    private static class ParserState1Handler implements ParserStateHandler&lt;JsonObject&gt;{

        @Override
        public int processInState(JsonTokenReader jsonTokenReader, RecursiveDoParserContext&lt;JsonObject&gt; recursiveDoParserContext) {
            JsonToken token = jsonTokenReader.peek();

            if(token.getType() == JsonTokenTypeEnum.RIGHT_BRACE){
                accept(jsonTokenReader);
                return 2;
            }

            if(token.getType() == JsonTokenTypeEnum.STRING){
                // ækeyååå¥æ ä¸­ï¼ç¶åç­æé kvå¯¹æ¶å¼¹åº
                recursiveDoParserContext.getTokenStack().push(token);
                accept(jsonTokenReader);
                return 3;
            }

            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }
    }

    private static class ParserState2Handler implements ParserStateHandler&lt;JsonObject&gt;{

        @Override
        public int processInState(JsonTokenReader jsonTokenReader, RecursiveDoParserContext&lt;JsonObject&gt; recursiveDoParserContext) {
            // ç»æï¼ç´æ¥è¿å
            return -1;
        }
    }

    private static class ParserState3Handler implements ParserStateHandler&lt;JsonObject&gt;{

        @Override
        public int processInState(JsonTokenReader jsonTokenReader, RecursiveDoParserContext&lt;JsonObject&gt; recursiveDoParserContext) {
            JsonToken token = jsonTokenReader.peek();

            if(token.getType() == JsonTokenTypeEnum.COLON){
                accept(jsonTokenReader);
                return 4;
            }

            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }
    }

    private static class ParserState4Handler implements ParserStateHandler&lt;JsonObject&gt;{

        @Override
        public int processInState(JsonTokenReader jsonTokenReader, RecursiveDoParserContext&lt;JsonObject&gt; recursiveDoParserContext) {
            JsonToken token = jsonTokenReader.peek();

            JsonToken keyToken = recursiveDoParserContext.getTokenStack().pop();
            Assert.assertTrue(keyToken != null &amp;&amp; keyToken.getType() == JsonTokenTypeEnum.STRING,"parse object keyToken not match!");

            // åµå¥çjsonObjectç»æ
            if(token.getType() == JsonTokenTypeEnum.LEFT_BRACE){
                JsonObjectParseStatementMachine jsonObjectParseStatementMachine = new JsonObjectParseStatementMachine(jsonTokenReader);

                JsonObject subJsonObject = jsonObjectParseStatementMachine.parseJsonElement();

                // æé å¥½äºä¸ä¸ªkvå¯¹ï¼key : objï¼
                recursiveDoParserContext.getTargetJsonElement().putKV(keyToken.getContent(), subJsonObject);

                return 5;
            }

            // åµå¥çjsonArrayç»æ
            if(token.getType() == JsonTokenTypeEnum.LEFT_BRACKET){
                // jsonArrayç¶ææº
                JsonArrayParseStatementMachine jsonArrayParseStatementMachine = new JsonArrayParseStatementMachine(jsonTokenReader);

                JsonArray jsonArray = jsonArrayParseStatementMachine.parseJsonElement();
                // æé å¥½äºä¸ä¸ªkvå¯¹ (key ï¼array)
                recursiveDoParserContext.getTargetJsonElement().putKV(keyToken.getContent(), jsonArray);

                return 5;
            }

            // åºç¡ç±»åçvalue
            if(token.getType().isPrimitiveValue()){
                accept(jsonTokenReader);
                recursiveDoParserContext.getTargetJsonElement().putKV(keyToken.getContent(), new JsonPrimitiveStr(token.getContent()));

                return 5;
            }

            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }
    }

    private static class ParserState5Handler implements ParserStateHandler&lt;JsonObject&gt;{

        @Override
        public int processInState(JsonTokenReader jsonTokenReader, RecursiveDoParserContext&lt;JsonObject&gt; recursiveDoParserContext) {
            JsonToken token = jsonTokenReader.peek();

            if(token.getType() == JsonTokenTypeEnum.RIGHT_BRACE){
                accept(jsonTokenReader);
                return 2;
            }

            if(token.getType() == JsonTokenTypeEnum.COMMA){
                accept(jsonTokenReader);
                return 6;
            }

            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }
    }

    private static class ParserState6Handler implements ParserStateHandler&lt;JsonObject&gt;{

        @Override
        public int processInState(JsonTokenReader jsonTokenReader, RecursiveDoParserContext&lt;JsonObject&gt; recursiveDoParserContext) {
            JsonToken token = jsonTokenReader.peek();

            if(token.getType() == JsonTokenTypeEnum.STRING){
                // ækeyååå¥æ ä¸­ï¼ç¶åç­æé kvå¯¹æ¶å¼¹åº
                recursiveDoParserContext.getTokenStack().push(token);
                accept(jsonTokenReader);
                return 3;
            }

            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }
    }
}
</code></pre>
<pre><code class="language-java">public class AbstractJsonParseStatementMachine&lt;T extends JsonElement&gt; {

    protected JsonTokenReader jsonTokenReader;

    protected RecursiveDoParserContext&lt;T&gt; recursiveDoParserContext;

    protected int currentState = 0;

    protected T targetJsonElement;

    protected ParserStateHandler[] stateHandlers;

    public T parseJsonElement(){
        while(jsonTokenReader.hasNextToken()){
            if(currentState == -1){
                // éå°äºåæ³çåéç¬¦å·ï¼éåºtokenè§£æ
                return targetJsonElement;
            }

            if(currentState &gt;= stateHandlers.length){
                // æbug
                throw new MuJsonParserException(String.format("unknown state! currentState=%s",currentState));
            }
            ParserStateHandler targetStateHandler = stateHandlers[currentState];
            
            currentState = targetStateHandler.processInState(jsonTokenReader, recursiveDoParserContext);
        }

        return targetJsonElement;
    }

    protected static void accept(JsonTokenReader jsonTokenReader){
        jsonTokenReader.nextToken();
    }
}
</code></pre>
<pre><code class="language-java">public class RecursiveDoParserContext&lt;T extends JsonElement&gt;  {

    private Stack&lt;JsonToken&gt; tokenStack = new Stack&lt;&gt;();

    private T targetJsonElement;

    public RecursiveDoParserContext(T targetJsonElement) {
        this.targetJsonElement = targetJsonElement;
    }

    public Stack&lt;JsonToken&gt; getTokenStack() {
        return tokenStack;
    }

    public T getTargetJsonElement() {
        return targetJsonElement;
    }
}
</code></pre>
<h5 id="_-15"></h5>
<ul>
<li>å¨è§£ækvå¯¹æ¶ï¼éè¦åå°stringç±»åçkeyææ¶ç¼å­èµ·æ¥ï¼ç­å¾åç»­çvalueç±»åç»æ(objectãarrayæèprimitive)ä¹å®æè§£æåï¼åä¸å¹¶çæ¾å¥ASTä¸­(getTargetJsonElement().putKV)ã</li>
<li>è§£ækvå¯¹çvalueæ¶ï¼å½åçå®ç°æ¯åºäºéå½å®ç°çãå³å½æ ¹æ®å½åtokençç±»ååå»ºä¸ä¸ªæ°çå¯¹åºç±»åçç¶ææºï¼å»éå½çè§£ææ´æ·±ä¸å±çASTç»æã<br>
éå½å®ç°çå¥½å¤æ¯æè·¯ç®åææï¼ä¸ç¨è¿å¤çèèä¸åç±»åç»æä¹é´ç¶æçäºç¸è½¬ç§»ï¼éè¿éå½è§£æå­ASTçæ¹å¼å¤©ç¶çå±è½æäºå¤§éçå¤æåº¦ã<br>
ä½ç¼ºç¹ä¹åæ ·ææ¾ï¼å¨è§£æå±æ¬¡éå¸¸æ·±çjsonå­ç¬¦ä¸²æ¶ï¼éå½çå±æ¬¡è¿æ·±å¯è½ä¼å¯¼è´å½åçº¿ç¨æ æº¢åºï¼è§£æå¤±è´¥ã</li>
</ul>
<h3 id="34-json-arrayæ°ç»ç»æè§£æ">3.4 json arrayæ°ç»ç»æè§£æ</h3>
<p>arrayç»ææ¯ä»¥â[âå¼å¤´ï¼â]âç»å°¾çç»æï¼åé¨å¯ä»¥æ0å°Nä¸ªvalueç±»åçåç´ ,ä»¥éå·ååå²ï¼valueåæ ·æ¯å¯ä»¥æ¯åµå¥çç»æãä¸ä¸é¢objectç»æçè§£æå®ç°æ¹å¼ä¸æ ·ï¼åæ ·æ¯åºäºéå½å®ç°çã</p>
<h5 id="json-arrayæ°ç»ç»æè¯­æ³">json arrayæ°ç»ç»æè¯­æ³</h5>
<pre><code>array
    '[' ws ']'
    '[' elements ']'

elements
    element
    element ',' elements

element
    ws value ws

value
    object
    array
    string
    number
    "true"
    "false"
    "null"
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211200007327-1872691214.png" alt="json_array_parser" loading="lazy"></p>
<h5 id="arrayç»æè§£æç¶æèªå¨æºç¤ºæå¾">arrayç»æè§£æç¶æèªå¨æºç¤ºæå¾</h5>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211200016319-1527985884.png" alt="json_array_state_machine" loading="lazy"></p>
<h5 id="arrayç»æè§£æç¶æèªå¨æºéå½å®ç°éå½çæ¬">arrayç»æè§£æç¶æèªå¨æºéå½å®ç°ï¼éå½çæ¬ï¼</h5>
<pre><code class="language-java">/**
 * åºäºéå½å®ç°ç arrayç±»åè¯­æ³è§£æç¶æèªå¨æº
 * */
public class JsonArrayParseStatementMachine extends AbstractJsonParseStatementMachine&lt;JsonArray&gt; {

    public JsonArrayParseStatementMachine(JsonTokenReader jsonTokenReader) {
        this.jsonTokenReader = jsonTokenReader;
        this.targetJsonElement = new JsonArray();
        this.recursiveDoParserContext = new RecursiveDoParserContext&lt;&gt;(this.targetJsonElement);
        stateHandlers = new ParserStateHandler[]{
            new ParserState0Handler(),new ParserState1Handler(),new ParserState2Handler(),
            new ParserState3Handler(), new ParserState4Handler()
        };
    }

    private static class ParserState0Handler implements ParserStateHandler&lt;JsonArray&gt;{

        @Override
        public int processInState(JsonTokenReader jsonTokenReader, RecursiveDoParserContext&lt;JsonArray&gt; recursiveDoParserContext) {
            JsonToken token = jsonTokenReader.peek();

            if(token.getType() != JsonTokenTypeEnum.LEFT_BRACKET){
                throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
            }

            accept(jsonTokenReader);
            return 1;
        }
    }

    private static class ParserState1Handler implements ParserStateHandler&lt;JsonArray&gt;{

        @Override
        public int processInState(JsonTokenReader jsonTokenReader, RecursiveDoParserContext&lt;JsonArray&gt; recursiveDoParserContext) {
            JsonToken token = jsonTokenReader.peek();

            if(token.getType() == JsonTokenTypeEnum.RIGHT_BRACKET){
                accept(jsonTokenReader);
                return 2;
            }

            // åµå¥çjsonObjectç»æ
            if(token.getType() == JsonTokenTypeEnum.LEFT_BRACE){
                JsonObjectParseStatementMachine jsonObjectParseStatementMachine = new JsonObjectParseStatementMachine(jsonTokenReader);

                JsonObject subJsonObject = jsonObjectParseStatementMachine.parseJsonElement();

                // addä¸ä¸ªobj
                recursiveDoParserContext.getTargetJsonElement().addElement(subJsonObject);

                return 3;
            }

            // åµå¥çjsonArrayç»æ
            if(token.getType() == JsonTokenTypeEnum.LEFT_BRACKET){
                // jsonArrayç¶ææº
                JsonArrayParseStatementMachine jsonArrayParseStatementMachine = new JsonArrayParseStatementMachine(jsonTokenReader);

                JsonArray jsonArray = jsonArrayParseStatementMachine.parseJsonElement();

                // addä¸ä¸ªarray
                recursiveDoParserContext.getTargetJsonElement().addElement(jsonArray);

                return 3;
            }

            // åºç¡ç±»åçvalue
            if(token.getType().isPrimitiveValue()){
                accept(jsonTokenReader);
                recursiveDoParserContext.getTargetJsonElement().addElement(new JsonPrimitiveStr(token.getContent()));

                return 3;
            }

            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }
    }

    private static class ParserState2Handler implements ParserStateHandler&lt;JsonArray&gt;{

        @Override
        public int processInState(JsonTokenReader jsonTokenReader, RecursiveDoParserContext&lt;JsonArray&gt; recursiveDoParserContext) {
            // ç»æï¼ç´æ¥è¿å
            return -1;
        }
    }

    private static class ParserState3Handler implements ParserStateHandler&lt;JsonArray&gt;{

        @Override
        public int processInState(JsonTokenReader jsonTokenReader, RecursiveDoParserContext&lt;JsonArray&gt; recursiveDoParserContext) {
            JsonToken token = jsonTokenReader.peek();

            if(token.getType() == JsonTokenTypeEnum.RIGHT_BRACKET){
                accept(jsonTokenReader);
                return 2;
            }

            if(token.getType() == JsonTokenTypeEnum.COMMA){
                accept(jsonTokenReader);
                return 4;
            }

            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }
    }

    private static class ParserState4Handler implements ParserStateHandler&lt;JsonArray&gt;{

        @Override
        public int processInState(JsonTokenReader jsonTokenReader, RecursiveDoParserContext&lt;JsonArray&gt; recursiveDoParserContext) {
            JsonToken token = jsonTokenReader.peek();

            // åµå¥çjsonObjectç»æ
            if(token.getType() == JsonTokenTypeEnum.LEFT_BRACE){
                JsonObjectParseStatementMachine jsonObjectParseStatementMachine = new JsonObjectParseStatementMachine(jsonTokenReader);

                JsonObject subJsonObject = jsonObjectParseStatementMachine.parseJsonElement();

                // addä¸ä¸ªobj
                recursiveDoParserContext.getTargetJsonElement().addElement(subJsonObject);

                return 3;
            }

            // åµå¥çjsonArrayç»æ
            if(token.getType() == JsonTokenTypeEnum.LEFT_BRACKET){
                // jsonArrayç¶ææº
                JsonArrayParseStatementMachine jsonArrayParseStatementMachine = new JsonArrayParseStatementMachine(jsonTokenReader);

                JsonArray jsonArray = jsonArrayParseStatementMachine.parseJsonElement();

                // addä¸ä¸ªarray
                recursiveDoParserContext.getTargetJsonElement().addElement(jsonArray);

                return 3;
            }

            // åºç¡ç±»åçvalue
            if(token.getType().isPrimitiveValue()){
                accept(jsonTokenReader);
                recursiveDoParserContext.getTargetJsonElement().addElement(new JsonPrimitiveStr(token.getContent()));

                return 3;
            }

            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }
    }
}
</code></pre>
<h5 id="_-16"></h5>
<ul>
<li>ç¸æ¯objectç»æçç¶æèªå¨æºï¼arrayç»æçç¶æèªå¨æºåæ¾å¾æ¯è¾ç®åãåæ ·å¨éå°å¤æç±»åçç»ææ¶ï¼éè¿å½åtokençç±»åéå½çåå»ºä¸ä¸ªæ°çç¶ææºå»æé åºå­AST(JsonElement)ï¼ç¶åå å¥å°å½åJsonArrayä¸­(getTargetJsonElement().addElement)ã</li>
</ul>
<h2 id="4-åºäºastçæbeauty-jsonå­ç¬¦ä¸²">4. åºäºASTçæbeauty jsonå­ç¬¦ä¸²</h2>
<p>ç°å¨æä»¬å·²ç»å®ç°äºjsonçè¯æ³è§£æåè¯­æ³è§£æï¼å¯ä»¥å°ä¸ä¸ªåå§çåæ³çjsonå­ç¬¦ä¸²æ­£ç¡®çè½¬æ¢æå¯¹åºçASTäºã<br>
æ¿å°ASTä¹åçè®ºä¸å¯ä»¥åå¾å¤äºæï¼æ¯å¦å°jsonä¸²ååºååä¸ºjavaå¯¹è±¡ãè¿éæä»¬å®ç°ä¸ä¸ª<strong>æ´ç®åä¹æ´ç´è§çåè½</strong>ï¼å³å°åå§çjsonå­ç¬¦ä¸²æ ¼å¼åæç¼©è¿è¯å¥½ï¼æ´ç¾è§ï¼å¯è¯»æ§æ´ä½³çbeautyå­ç¬¦ä¸²ã</p>
<h5 id="çææ ¼å¼ååçbeauty-jsonå­ç¬¦ä¸²å®ç°">çææ ¼å¼ååçbeauty jsonå­ç¬¦ä¸²å®ç°</h5>
<pre><code class="language-java">public abstract class JsonElement {

    private static final String BEAUTY_INDENT = "    ";  // åä¸ªç©ºæ ¼ç¼©è¿
    private static final String BEAUTY_KV_INDENT = " ";  // kvå¤ä¸ä¸ªç©ºæ ¼
    private static final String BEAUTY_LINE_BREAK = "\n"; // æ¢è¡åå²

    /**
     * çæç¾ååçbeautyå­ç¬¦ä¸²
     * */
    public String buildBeautyJsonString(){
        StringBuilder jsonStringBuilder = new StringBuilder();

        buildJsonString(this,jsonStringBuilder,"",BEAUTY_LINE_BREAK,BEAUTY_INDENT,BEAUTY_KV_INDENT);

        return jsonStringBuilder.toString();
    }

    private static void buildJsonString(JsonElement jsonElement, StringBuilder jsonStringBuilder, String currentIndent,
                                        String lineBreak, String indent, String kvIndent){
        if(jsonElement instanceof JsonPrimitiveStr){
            jsonStringBuilder.append(jsonElement);
            return;
        }

        if(jsonElement instanceof JsonArray){
            JsonArray jsonArray  = (JsonArray) jsonElement;
            jsonStringBuilder.append("[").append(lineBreak);
            List&lt;JsonElement&gt; jsonArrayList = jsonArray.getArray();
            int i=0;
            for(JsonElement arrayItem : jsonArrayList){
                jsonStringBuilder.append(currentIndent).append(indent);
                // éå½ä¸å»ï¼currentIndentå¤ç¼©è¿ä¸å±
                buildJsonString(arrayItem,jsonStringBuilder,currentIndent + indent,lineBreak,indent,kvIndent);
                if(i != jsonArrayList.size()-1){
                    jsonStringBuilder.append(",");
                }

                jsonStringBuilder.append(lineBreak);
                i++;
            }

            jsonStringBuilder.append(currentIndent).append("]");
        }

        if(jsonElement instanceof JsonObject){
            JsonObject jsonObject  = (JsonObject) jsonElement;
            jsonStringBuilder.append("{").append(lineBreak);

            Map&lt;String, JsonElement&gt; objMap = jsonObject.getObjMap();

            int i=0;
            for(Map.Entry&lt;String, JsonElement&gt; entry : objMap.entrySet()){
                String key = entry.getKey();
                JsonElement value = entry.getValue();

                // keyæ¯stringç±»åçï¼å­é¢ééèªå¸¦åå¼å·ç
                jsonStringBuilder.append(currentIndent).append(indent).append(key).append(kvIndent).append(":").append(kvIndent);
                // éå½ä¸å»ï¼currentIndentå¤ç¼©è¿ä¸å±
                buildJsonString(value,jsonStringBuilder,  currentIndent + indent, lineBreak,indent,kvIndent);

                if(i != objMap.size()-1){
                    jsonStringBuilder.append(",");
                }

                jsonStringBuilder.append(lineBreak);
                i++;
            }

            jsonStringBuilder.append(currentIndent).append("}");
        }
    }
}
</code></pre>
<h5 id="_-17"></h5>
<ul>
<li>ä»æºç å®ç°ä¸­å¯ä»¥çå°ï¼è¾åºç¾ååçbeautyå­ç¬¦ä¸²æ¬è´¨ä¸å°±æ¯ä¸ä¸ªéå¯¹ASTæ å½¢ç»æç<strong>æ·±åº¦ä¼åéå</strong>ï¼åªéè¦æ³¨æéçéå½æ·±åº¦å¨æè°æ´ç¼©è¿é¿åº¦å³å¯ã</li>
<li>æ ¼å¼åjsonçæ¹å¼å¤ç§å¤æ ·ï¼åjacksonè¿æ ·æççjsonå¤çæ¡æ¶ä¸­æä¾äºå¤§éçéç½®åæ°åè®¸ç¨æ·ä»¥ææ³è¦çæ¹å¼éå¸¸çµæ´»ççææéæ ¼å¼çjsonå­ç¬¦ä¸²ãæä»¬è¿éçå®ç°ä¸å¤çµæ´»ï¼æ§è½ä¹ä¸å¤é«æï¼ä»ä»æ¯èµ·å°ä¸ä¸ªæç å¼ççä½ç¨ã</li>
</ul>
<h5 id="json-beautyç¤ºæå¾">json beautyç¤ºæå¾</h5>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211200026283-104525624.png" alt="json_beauty_demo" loading="lazy"></p>
<h2 id="5-æµå¼çjsonè¯æ³è§£æ">5. æµå¼çjsonè¯æ³è§£æ</h2>
<p>æªæ­¢ç®åæä»¬å·²ç»å®ç°äºjsonå­ç¬¦ä¸²çè§£æåè½ï¼ä½è¿å­å¨ä¸¤ä¸ªä¸¥éçæ§è½é®é¢éè¦ä¼åã</p>
<ul>
<li>é¦åæ¯ç®åçè¯æ³åæå¨æ¯ä¸æ¬¡æ§çè§£æåºææçtokenåï¼åäº¤ç»è¯­æ³åæå»è§£æçãèè¿å­å¨ä¸ä¸ªéæ£ï¼å ä¸ºå¾å¤æ¶åæä»¬å®éè§£æçå¹¶ä¸æ»æ¯ä¸ä¸ªåæ³çjsonå­ç¬¦ä¸²ã<br>
å¦æä¸ä¸ªéå¸¸é¿çä¸åæ³çjsonå­ç¬¦ä¸²ï¼å¨è¯æ³åæé¶æ®µçä¸åºä»»ä½çé®é¢(æ¯å¦å¨åæ³çä»¥<code>{</code>å¼å¤´ç jsonå­ç¬¦ä¸²çåé¢è¯¯è¿½å ä¸ä¸ª123)ï¼èç´å°è¯­æ³åææåç°å­å¨è¯­æ³éè¯¯ï¼é£ä¹è¯æ³åæé¶æ®µè±è´¹çè®¡ç®èµæºå°±ç»ç»æµªè´¹äºã</li>
<li>å¦æè½å¤å¨å®æ´çè¯æ³åæå¤ççè¿ç¨ä¸­æååç°è¯­æ³éè¯¯å°±è½é¿åè¿ä¸ªé®é¢ãä½å®ç°è¿ä¸ªåè½ä¸éè¦å°è¯æ³åæåè¯­æ³åæçåè½è¦åå¨ä¸èµ·ï¼èæ¯å°è¯æ³åæå¨æ¹é ææéå è½½çæµå¼è§£æå³å¯ã<br>
æµå¼çè¯æ³åæè½å¤å¨è¯­æ³è§£æå¨éè¦è¯»åtokenæ¶æè§¦åè¯æ³åæï¼å¹¶ä¸ä¸æ¬¡å¯ä»¥åªæéçå®æ´è§£æåºä¸ä¸ªå®æ´çtokenäº¤ç»parserã</li>
<li>æäºæµå¼çè¯æ³åæï¼åä¸é¢ä¸¾å¾ä¾å­ï¼å¨åæ³çéå¸¸é¿çjsonå­ç¬¦ä¸²çåé¢è¯¯å ä¸ä¸ª123çåºæ¯ï¼ä¾¿è½å¤å¾æ©çå°±åç°è¯­æ³éè¯¯ï¼ç»æè§£æè¿ç¨ã</li>
</ul>
<h5 id="æµå¼çè¯æ³åæè§£æå®ç°">æµå¼çè¯æ³åæè§£æå®ç°</h5>
<pre><code class="language-java">public class StreamJsonLexer extends AbstractJsonLexer{

    public StreamJsonLexer(String jsonString) {
        super(jsonString);
    }

    public JsonToken doLex(){
        if(doLexContext.currentIndex &gt;= jsonStringArray.length){
            return new JsonToken(JsonTokenTypeEnum.EOF);
        }

        while(true) {
            char ch = jsonStringArray[doLexContext.currentIndex];

            // æ¯ä¸æ¬¡å°è¯è§£æä¸ä¸ªå®æ´çtokenåï¼é½æ¯ç¶æ0
            switch (ch) {
                case '{':
                    doLexContext.currentIndex++;
                    return new JsonToken(JsonTokenTypeEnum.LEFT_BRACE);
                case '}':
                    doLexContext.currentIndex++;
                    return new JsonToken(JsonTokenTypeEnum.RIGHT_BRACE);
                case '[':
                    doLexContext.currentIndex++;
                    return new JsonToken(JsonTokenTypeEnum.LEFT_BRACKET);
                case ']':
                    doLexContext.currentIndex++;
                    return new JsonToken(JsonTokenTypeEnum.RIGHT_BRACKET);
                case ',':
                    doLexContext.currentIndex++;
                    return new JsonToken(JsonTokenTypeEnum.COMMA);
                case ':':
                    doLexContext.currentIndex++;
                    return new JsonToken(JsonTokenTypeEnum.COLON);
                case '"':
                    return parseString(jsonStringArray, doLexContext);
                case 't':
                    // å°è¯è§£ætrueå³é®å­
                    return parseTrueKeyword(jsonStringArray, doLexContext);
                case 'f':
                    // å°è¯è§£æfalseå³é®å­
                    return parseFalseKeyword(jsonStringArray, doLexContext);
                case 'n':
                    // å°è¯è§£ænullå³é®å­
                    return parseNullKeyword(jsonStringArray, doLexContext);
                default:
                    // èµ°å¶å®case
                    break;
            }

            // å¶å®case
            if (CommonStringUtil.is0_9(ch) || ch == '-') {
                // numberè§£æ
                return parseNumber(jsonStringArray, doLexContext);
            } else if (CommonStringUtil.isWhitespace(ch)) {
                // whiteSpace ç´æ¥è·³è¿
                doLexContext.currentIndex++;
            } else{
                throw new MuJsonParserException("unexpected character: " + ch + ",charIndex=" + doLexContext.currentIndex);
            }
        }
    }
}
</code></pre>
<pre><code class="language-java">public class StreamJsonTokenReader implements JsonTokenReader {

    private int currentIndex;
    private final StreamJsonLexer streamJsonLexer;

    private JsonToken peekToken;
    private boolean hasNextToken;

    public StreamJsonTokenReader(String jsonString) {
        this.currentIndex = 0;
        this.hasNextToken = true;
        this.streamJsonLexer = new StreamJsonLexer(jsonString);
    }

    @Override
    public boolean hasNextToken() {
        return hasNextToken;
    }

    @Override
    public JsonToken nextToken() {
        JsonToken nextToken = getNextToken();
        if(nextToken.getType() == JsonTokenTypeEnum.EOF){
            hasNextToken = false;
        }

        currentIndex++;
        return nextToken;
    }

    private JsonToken getNextToken() {
        if(peekToken != null){
            JsonToken nextToken = peekToken;
            this.peekToken = null;
            return nextToken;
        }

        return streamJsonLexer.doLex();
    }

    @Override
    public JsonToken peek() {
        if(peekToken == null) {
            peekToken = streamJsonLexer.doLex();
        }

        return peekToken;
    }

    @Override
    public int currentIndex() {
        return currentIndex;
    }
}
</code></pre>
<h5 id="_-18"></h5>
<ul>
<li>æµå¼çè¯æ³è§£æå¨StreamJsonLexerçæ ¸å¿å·¥ä½åçä¸ä¹åå·²ç»å®ç°çéæçStaticJsonLexerå«æ äºè´ï¼å¶åºå±ä¾èµçä»£ç é½æ¯ç¸åçã<br>
æå¤§çåºå«å¨äºè§£æåºä¸ä¸ªå®æ´çtokenåï¼å¨ç»´æ¤å½åå­ç¬¦æµä¸æ çåæ¶æåç»æ­¢äºåç»­çè¯æ³åæãå¨StreamJsonTokenReaderè°ç¨nextTokenæ¶ï¼æä¼æéçæ°æ§è§£ææ°çtokenå¹¶è¿åã</li>
<li>æµå¼çè¯æ³è§£ææ¯«æ çé®æ¯æ§è½æ´å¥½çï¼ä¸»æµçjsonè§£æå¨ä¹é½æ¯æµå¼çè§£æãä½éæçè¯æ³è§£ææ´å®¹æçè§£ï¼ä¹æ´å®¹æè°è¯ï¼æä»¥å¨ä¸å¼å§ä»ç»è¯æ³åæåçæ¶ï¼æä»¬åå®ç°äºéæçè¯æ³åæï¼å°å¶ä½ä¸ºåºç¡ï¼ç¥å¾®çæ¹é åä¾¿å®ç°äºæµå¼çè¯æ³è§£æã</li>
</ul>
<h2 id="6-åºäºå æ å®ç°çjsonè¯­æ³è§£æ">6. åºäºå æ å®ç°çjsonè¯­æ³è§£æ</h2>
<p>ç¬¬äºä¸ªæ§è½é®é¢åæ¯åºäºéå½å®ç°çjsonè¯­æ³è§£æå¨åéäºè¾å°ççº¿ç¨æ ç©ºé´ï¼æ æ³å¤çåµå¥å±çº§éå¸¸æ·±çjsonä¸²ã</p>
<ul>
<li>æä»¬ç¥éï¼ä¸ä¸ªæ®éçjavaè¿ç¨éå¸¸é½å«æå¤§éççº¿ç¨ï¼å æ­¤ç»æ¯ä¸ªçº¿ç¨åéççº¿ç¨æ éå¸¸é½æ¯è¾å°ï¼æ¯å¦1mãèéå½å®ç°çè¯­æ³è§£æå¨ï¼å¨æ¯æ·±å¥ä¸ä¸ªå±æ¬¡çjsonå­æ æ¶ä¾¿ä¼åæ ä¸åå¥ä¸äºå±é¨åéï¼å½æç«¯æåµä¸è¦è§£æçjsonä¸²å±æ¬¡è¿æ·±æ¶ï¼åä¼åºç°StackOverflowErrorï¼å¯¼è´è§£æå¤±è´¥ã</li>
<li>èåå­çå éå¸¸é½æ¯ä»¥GBä¸ºåä½çï¼å æ­¤å¦ææéå½ä¸­éå¼åæ çè§£æé»è¾è½¬æ¢ä¸ºç­ä»·çæ¾å¼åºäºåå­å çåæ ï¼åå¯ä»¥å¾å¥½çè§£å³çº¿ç¨æ è¿å°æ æ³å¤çå¤§æ·±åº¦jsonä¸²çé®é¢äºã</li>
</ul>
<h5 id="åºäºå æ çè¯­æ³è§£æç¶æèªå¨æºç¤ºæå¾">åºäºå æ çè¯­æ³è§£æç¶æèªå¨æºç¤ºæå¾</h5>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211200035364-62927704.png" alt="stack_base_json_parser_state_machine" loading="lazy"></p>
<ul>
<li>ä¸ºäºå°½å¯è½çå°ç¶æè½¬ç§»ä¸éå½å®ç°çé»è¾ä¿æä¸è´ï¼å æ çç¶æèªå¨æºä¾ç¶åä½äºä¸¤ä¸ªç¶æ(obj-0åarr-0)ã</li>
<li>å¯ä»¥çå°ï¼åºäºå æ çç¶æèªå¨æºä¼å¨arrayä¸objectçè§£æç¶æä¸­äºç¸è½¬ç§»ï¼ç¸å½äºå°ä¹åéå½å®ç°çåä¸ªç¶æèªå¨æºçå­ç¶æå¾åå¹¶ä¸ºäºä¸ä¸ªå¤§èå¨çç¶æèªå¨æºã</li>
<li>åæ¶ï¼ç±äºè¿æ¶åäºæå¨æ¨¡æçå¥æ ä¸åºæ å¤ç(obj-2ï¼obj-4ï¼arr-1ï¼arr-2)ï¼å æ­¤æ´ä½çå¤æåº¦æ¯èµ·éå½å®ç°è¦é«åºä¸ä¸ªéçº§ã</li>
</ul>
<h5 id="jsonæ ¹èç¹è§£æç¶æèªå¨æºå®ç°æºç ">jsonæ ¹èç¹è§£æç¶æèªå¨æºå®ç°æºç </h5>
<pre><code class="language-java">/**
 * åºäºå æ çï¼ééå½çjsonè¯­æ³è§£æå¨
 * */
public class StackBaseJsonParser extends JsonParser {

    private final JsonParseStack parseStack = new JsonParseStack();

    private StackBaseJsonParserStatusEnum currentStatus;

    public StackBaseJsonParser(JsonTokenReader tokenReader) {
        super(tokenReader);

        this.currentStatus = StackBaseJsonParserStatusEnum.START_PARSE;
    }

    private void accept(){
        jsonTokenReader.nextToken();
    }

    @Override
    public JsonElement doParse() {
        while(jsonTokenReader.hasNextToken()){
            JsonToken token = jsonTokenReader.peek();

            if(currentStatus == StackBaseJsonParserStatusEnum.END_PARSE){
                break;
            }

            switch (currentStatus){
                case START_PARSE:
                    processInStartParse(token);
                    break;
                case PARSE_OBJECT_0:
                    processInParseObject0(token);
                    break;
                case PARSE_OBJECT_1:
                    processInParseObject1(token);
                    break;
                case PARSE_OBJECT_2:
                    processInParseObject2(token);
                    break;
                case PARSE_OBJECT_3:
                    processInParseObject3(token);
                    break;
                case PARSE_OBJECT_4:
                    processInParseObject4(token);
                    break;
                case PARSE_OBJECT_5:
                    processInParseObject5(token);
                    break;
                case PARSE_OBJECT_6:
                    processInParseObject6(token);
                    break;
                case PARSE_ARR_0:
                    processInParseArr0(token);
                    break;
                case PARSE_ARR_1:
                    processInParseArr1(token);
                    break;
                case PARSE_ARR_2:
                    processInParseArr2(token);
                    break;
                case PARSE_ARR_3:
                    processInParseArr3(token);
                    break;
                default:
                    throw new MuJsonParserException("Unexpected currentStatus: " + currentStatus);
            }
        }

        // å¦æjsonå­ç¬¦ä¸²æ¯åæ³çï¼é£ä¹æåæ é¡¶å¿ç¶æ¯æä¸å¯ä¸çä¸ä¸ªJsonElementç±»åçå¯¹è±¡
        if(this.parseStack.size() != 1){
            throw new MuJsonParserException("after parseï¼stack element size &gt; 1! stack=" + this.parseStack);
        }

        JsonParseStackValue object = this.parseStack.pop();
        return (JsonElement) object.getValue();
    }

    private void processInStartParse(JsonToken token){
        if (token.getType() == JsonTokenTypeEnum.LEFT_BRACE) {
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_0;
            this.parseStack.push(new JsonParseStackValue(JsonParseStackValueTypeEnum.JSON_OBJECT,new JsonObject()));
            return;
        }

        if (token.getType() == JsonTokenTypeEnum.LEFT_BRACKET) {
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_ARR_0;
            this.parseStack.push(new JsonParseStackValue(JsonParseStackValueTypeEnum.JSON_ARRAY,new JsonArray()));
            return;
        }

        if (token.getType().isPrimitiveValue()) {
            accept();
            this.currentStatus = StackBaseJsonParserStatusEnum.END_PARSE;
            this.parseStack.push(new JsonParseStackValue(JsonParseStackValueTypeEnum.JSON_PRIMITIVE,new JsonPrimitiveStr(token.getContent())));
            return;
        }

        // ç¬¬ä¸ä¸ªtokenï¼ä¸å±äºjsonè§åçf(1)éå
        throw new MuJsonParserException("unexpected start json token! token=" + jsonTokenReader.currentIndex());
    }

    private void processInParseObject0(JsonToken token){
        if(token.getType() != JsonTokenTypeEnum.LEFT_BRACE){
            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }

        accept();

        this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_1;
    }

    private void processInParseObject1(JsonToken token){
        if(token.getType() == JsonTokenTypeEnum.RIGHT_BRACE){
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_2;
            return;
        }

        if(token.getType() == JsonTokenTypeEnum.STRING){
            // ækeyååå¥æ ä¸­ï¼ç¶åç­æé kvå¯¹æ¶å¼¹åº
            this.parseStack.push(new JsonParseStackValue(JsonParseStackValueTypeEnum.JSON_KEY,token));
            accept();
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_3;
            return;
        }

        throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
    }

    private void processInParseObject2(JsonToken token){
        // éå°'}'æä¼è¿æ¥
        if(token.getType() != JsonTokenTypeEnum.RIGHT_BRACE){
            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }else{
            accept();
        }

        // å½åæ é¡¶å¿å®æ¯JsonObjectï¼åå°å¶å¼¹åºï¼ç¶åçæ é¡¶çåç´ ç±»åå¤æ­
        JsonParseStackValue currentJsonObjectStackValue = this.parseStack.popAndCheck(JsonParseStackValueTypeEnum.JSON_OBJECT);
        if(this.parseStack.isEmpty()){
            // è¯´ææ¯rootçJsonObjectè§£æå®äºï¼åæ¨åå»ç´æ¥è¿å
            this.parseStack.push(currentJsonObjectStackValue);
            this.currentStatus = StackBaseJsonParserStatusEnum.END_PARSE;
            return;
        }

        JsonObject currentJsonObject = (JsonObject) currentJsonObjectStackValue.getValue();

        JsonParseStackValueTypeEnum topObjType = this.parseStack.peekTopType();

        if(topObjType == JsonParseStackValueTypeEnum.JSON_KEY){
            // å¦ææ¯json_keyï¼è¯´ææ¯å½åjsonObjectæ¯ç¶objectçä¸ä¸ªk/vé¡¹ä¸­çvalueã
            JsonParseStackValue keyStackValue = this.parseStack.popAndCheck(JsonParseStackValueTypeEnum.JSON_KEY);
            JsonToken keyJsonToken = (JsonToken) keyStackValue.getValue();
            JsonParseStackValue parentObject = this.parseStack.peekAndCheck(JsonParseStackValueTypeEnum.JSON_OBJECT);

            // å°å½åk/vé¡¹éå å¨ç¶objectä¸
            ((JsonObject)parentObject.getValue()).putKV(keyJsonToken.getContent(), currentJsonObject);

            // åºäºä¸ä¸ä¸ªtokenå¤æ­ç¶æè·³è½¬
            JsonToken nextJsonToken = this.jsonTokenReader.peek();
            if(nextJsonToken.getType() == JsonTokenTypeEnum.COMMA){
                this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_5;
                return;
            }else if (nextJsonToken.getType() == JsonTokenTypeEnum.RIGHT_BRACE){
                this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_2;
                return;
            }else{
                throw new MuJsonParserException("unexpected token! index=" + (jsonTokenReader.currentIndex()+1));
            }

        }else if(topObjType == JsonParseStackValueTypeEnum.JSON_ARRAY){
            // è¯´æå½åjsonObjectæ¯jsonArrayçä¸ä¸ªåç´ 

            JsonParseStackValue parentArr = this.parseStack.peekAndCheck(JsonParseStackValueTypeEnum.JSON_ARRAY);
            ((JsonArray)parentArr.getValue()).addElement(currentJsonObject);

            // åºäºä¸ä¸ä¸ªtokenå¤æ­ç¶æè·³è½¬
            JsonToken nextJsonToken = this.jsonTokenReader.peek();
            if(nextJsonToken.getType() == JsonTokenTypeEnum.COMMA){
                this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_ARR_3;
                return;
            }else if (nextJsonToken.getType() == JsonTokenTypeEnum.RIGHT_BRACKET){
                this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_ARR_2;
                return;
            }else{
                throw new MuJsonParserException("unexpected token! index=" + (jsonTokenReader.currentIndex()+1));
            }
        }else{
            // å«çæåµé½è¯´ææé®é¢ï¼ä¸æ¯åæ³çjson
            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }
    }

    private void processInParseObject3(JsonToken token){
        if(token.getType() == JsonTokenTypeEnum.COLON){
            accept();
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_4;
            return;
        }

        throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
    }

    private void processInParseObject4(JsonToken token){
        // åµå¥çjsonObjectç»æ
        if(token.getType() == JsonTokenTypeEnum.LEFT_BRACE){
            // åç°'{'ï¼æ ä¸æ¨è¿ä¸ä¸ªJsonObject
            this.parseStack.push(new JsonParseStackValue(JsonParseStackValueTypeEnum.JSON_OBJECT, new JsonObject()));
            accept();
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_1;
            return;
        }

        // åµå¥çjsonArrayç»æ
        if(token.getType() == JsonTokenTypeEnum.LEFT_BRACKET){
            // åç°'['ï¼æ ä¸æ¨è¿ä¸ä¸ªJsonArr
            this.parseStack.push(new JsonParseStackValue(JsonParseStackValueTypeEnum.JSON_ARRAY, new JsonArray()));
            accept();
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_ARR_1;
            return;
        }

        // åºç¡ç±»åçvalue
        if(token.getType().isPrimitiveValue()){
            JsonParseStackValue jsonKeyToken = this.parseStack.popAndCheck(JsonParseStackValueTypeEnum.JSON_KEY);

            JsonToken keyToken  = (JsonToken) jsonKeyToken.getValue();
            Assert.assertTrue(keyToken.getType() == JsonTokenTypeEnum.STRING,"parse object keyToken not match!");

            // è·åæ é¡¶çjsonObjectå¯¹è±¡ï¼è®¾ç½®k/v
            JsonParseStackValue topJsonObject = this.parseStack.peekAndCheck(JsonParseStackValueTypeEnum.JSON_OBJECT);

            ((JsonObject) topJsonObject.getValue()).putKV(keyToken.getContent(), new JsonPrimitiveStr(token.getContent()));

            accept();

            // åºäºä¸ä¸ä¸ªtokenå¤æ­ç¶æè·³è½¬
            JsonToken nextJsonToken = this.jsonTokenReader.peek();
            if(nextJsonToken.getType() == JsonTokenTypeEnum.COMMA){
                this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_5;
                return;
            }else if (nextJsonToken.getType() == JsonTokenTypeEnum.RIGHT_BRACE){
                this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_2;
                return;
            }else{
                throw new MuJsonParserException("unexpected token! index=" + (jsonTokenReader.currentIndex()+1));
            }
        }

        throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
    }

    private void processInParseObject5(JsonToken token){
        if(token.getType() == JsonTokenTypeEnum.COMMA){
            accept();
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_6;
            return;
        }

        throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
    }

    private void processInParseObject6(JsonToken token){
        if(token.getType() == JsonTokenTypeEnum.STRING){
            // ækeyååå¥æ ä¸­ï¼ç¶åç­æé kvå¯¹æ¶å¼¹åº
            this.parseStack.push(new JsonParseStackValue(JsonParseStackValueTypeEnum.JSON_KEY,token));
            accept();
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_3;
            return;
        }

        throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
    }

    private void processInParseArr0(JsonToken token){
        if(token.getType() == JsonTokenTypeEnum.LEFT_BRACKET){
            accept();
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_ARR_1;
            return;
        }

        throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
    }

    private void processInParseArr1(JsonToken token){
        if(token.getType() == JsonTokenTypeEnum.RIGHT_BRACKET){
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_ARR_2;
            return;
        }

        // åµå¥çjsonObjectç»æ
        if(token.getType() == JsonTokenTypeEnum.LEFT_BRACE){
            // åç°'{'ï¼æ ä¸æ¨è¿ä¸ä¸ªJsonObject
            this.parseStack.push(new JsonParseStackValue(JsonParseStackValueTypeEnum.JSON_OBJECT, new JsonObject()));
            accept();
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_1;
            return;
        }

        // åµå¥çjsonArrayç»æ
        if(token.getType() == JsonTokenTypeEnum.LEFT_BRACKET){
            // åç°'['ï¼æ ä¸æ¨è¿ä¸ä¸ªJsonArr
            this.parseStack.push(new JsonParseStackValue(JsonParseStackValueTypeEnum.JSON_ARRAY, new JsonArray()));
            accept();
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_ARR_1;
            return;
        }

        // åºç¡ç±»åçvalue
        if(token.getType().isPrimitiveValue()){
            // è·åæ é¡¶çjsonArrå¯¹è±¡ï¼æ·»å ä¸ä¸ªåç´ 
            JsonParseStackValue topJsonArr = this.parseStack.peekAndCheck(JsonParseStackValueTypeEnum.JSON_ARRAY);

            ((JsonArray) topJsonArr.getValue()).addElement(new JsonPrimitiveStr(token.getContent()));

            accept();

            // åºäºä¸ä¸ä¸ªtokenå¤æ­ç¶æè·³è½¬
            JsonToken nextJsonToken = this.jsonTokenReader.peek();
            if(nextJsonToken.getType() == JsonTokenTypeEnum.COMMA){
                this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_ARR_3;
                return;
            }else if (nextJsonToken.getType() == JsonTokenTypeEnum.RIGHT_BRACKET){
                this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_ARR_2;
                return;
            }else{
                throw new MuJsonParserException("unexpected token! index=" + (jsonTokenReader.currentIndex()+1));
            }
        }

        throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
    }

    private void processInParseArr2(JsonToken token){
        // éå°']'æä¼è¿æ¥
        if(token.getType() != JsonTokenTypeEnum.RIGHT_BRACKET){
            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }else{
            accept();
        }

        // å½åæ é¡¶å¿å®æ¯JsonArrayï¼åå°å¶å¼¹åºï¼ç¶åçæ é¡¶çåç´ ç±»åå¤æ­
        JsonParseStackValue currentJsonObjectStackValue = this.parseStack.popAndCheck(JsonParseStackValueTypeEnum.JSON_ARRAY);
        if(this.parseStack.isEmpty()){
            // è¯´ææ¯rootçJsonArrè§£æå®äºï¼åæ¨åå»ç´æ¥è¿å
            this.parseStack.push(currentJsonObjectStackValue);
            this.currentStatus = StackBaseJsonParserStatusEnum.END_PARSE;
            return;
        }

        JsonArray jsonArray = (JsonArray) currentJsonObjectStackValue.getValue();

        JsonParseStackValueTypeEnum topObjType = this.parseStack.peekTopType();

        if(topObjType == JsonParseStackValueTypeEnum.JSON_KEY){
            // å¦ææ¯json_keyï¼è¯´ææ¯å½åjsonArrayæ¯ç¶objectçä¸ä¸ªk/vé¡¹ä¸­çvalueã
            JsonParseStackValue keyStackValue = this.parseStack.popAndCheck(JsonParseStackValueTypeEnum.JSON_KEY);
            JsonToken keyJsonToken = (JsonToken) keyStackValue.getValue();

            JsonParseStackValue parentObject = this.parseStack.peekAndCheck(JsonParseStackValueTypeEnum.JSON_OBJECT);

            // å°å½åk/vé¡¹éå å¨ç¶objectä¸
            ((JsonObject)parentObject.getValue()).putKV(keyJsonToken.getContent(), jsonArray);

            // åºäºä¸ä¸ä¸ªtokenå¤æ­ç¶æè·³è½¬
            JsonToken nextJsonToken = this.jsonTokenReader.peek();
            if(nextJsonToken.getType() == JsonTokenTypeEnum.COMMA){
                this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_5;
                return;
            }else if (nextJsonToken.getType() == JsonTokenTypeEnum.RIGHT_BRACE){
                this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_OBJECT_2;
                return;
            }else{
                throw new MuJsonParserException("unexpected token! index=" + (jsonTokenReader.currentIndex()+1));
            }

        }else if(topObjType == JsonParseStackValueTypeEnum.JSON_ARRAY){
            // è¯´æå½åjsonObjectæ¯jsonArrayçä¸ä¸ªåç´ 

            JsonParseStackValue parentArr = this.parseStack.peekAndCheck(JsonParseStackValueTypeEnum.JSON_ARRAY);
            ((JsonArray)parentArr.getValue()).addElement(jsonArray);

            // åºäºä¸ä¸ä¸ªtokenå¤æ­ç¶æè·³è½¬
            JsonToken nextJsonToken = this.jsonTokenReader.peek();
            if(nextJsonToken.getType() == JsonTokenTypeEnum.COMMA){
                this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_ARR_3;
                return;
            }else if (nextJsonToken.getType() == JsonTokenTypeEnum.RIGHT_BRACKET){
                this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_ARR_2;
                return;
            }else{
                throw new MuJsonParserException("unexpected token! index=" + (jsonTokenReader.currentIndex()+1));
            }
        }else{
            // å«çæåµé½è¯´ææé®é¢ï¼ä¸æ¯åæ³çjson
            throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
        }
    }

    private void processInParseArr3(JsonToken token){
        if(token.getType() == JsonTokenTypeEnum.COMMA){
            accept();
            this.currentStatus = StackBaseJsonParserStatusEnum.PARSE_ARR_1;
            return;
        }

        throw new MuJsonParserException("unexpected token! index=" + jsonTokenReader.currentIndex());
    }
}

</code></pre>
<h5 id="æ¯è¾å æ ä¸éå½å®ç°æ§è½å·®å¼çdemo">æ¯è¾å æ ä¸éå½å®ç°æ§è½å·®å¼çdemo</h5>
<p>æä»¬å¯ä»¥å¾ç®åçæé åºä¸ä¸ªéå¸¸æ·±åµå¥å±æ¬¡çjsonä¸²ï¼å³ç±è¿ç»­Nä¸ªâ[âåè¿ç»­Nä¸ªâ]âææçjsonå­ç¬¦ä¸²ãå³æ ¹èç¹ä¸ºæ°ç»ï¼åæ¶æ¯ä¸ªæ°ç»ä¸­é½æä¸ä»æä¸ä¸ªå­åç´ ï¼å­åç´ çç±»åä¾ç¶æ¯æ°ç»ï¼ä¾æ¬¡ç±»æ¨ã</p>
<pre><code class="language-java">public class TestHugeLevelJsonParse {

    @Test
    public void testHugeLevelJsonParse() {
        int level = 3500;
        String hugeLevelJson = TestUtil.buildHugeLevelJson(level);

        // 3500å±çæ·±åº¦ï¼ä¼StackOverflowErroræ æº¢åº
        Error recursiveJsonParseEx = null;
        try{
            RecursiveJsonParser recursiveJsonParser = new RecursiveJsonParser(new StreamJsonTokenReader(hugeLevelJson));
            JsonElement obj = recursiveJsonParser.doParse();
        }catch (Error e){
            recursiveJsonParseEx = e;
        }

        Assert.assertTrue(recursiveJsonParseEx instanceof StackOverflowError);
        System.out.println("level = " + level + " recursiveJsonParseEx has StackOverflowError!");

        // jacksoné»è®¤jsonæ·±åº¦ä¸º1000ï¼è¶è¿äºä¼æ¥é
        {
            try {
                Object obj = JackSonUtil.string2Obj(hugeLevelJson, Object.class);
            }catch (Exception e){
                // ä¼æ¥é
                System.out.println("jackson parse hugeLevelJson error!   " + e.getCause().getMessage());
            }
        }

        // åºäºå æ çè½æ­£ç¡®çè§£æåºæ¥ï¼ä¸ä¼StackOverflowErroræ æº¢åº
        {
            StackBaseJsonParser stackBaseJsonParser = new StackBaseJsonParser(new StreamJsonTokenReader(hugeLevelJson));
            JsonElement obj = stackBaseJsonParser.doParse();
            int arrayLevel = TestUtil.getSpecialJsonArrayLevel(obj);
            Assert.assertEquals(arrayLevel, level - 1);
            System.out.println("stackBaseJsonParser parseï¼arrayLevel=" + arrayLevel);
        }
    }
}
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1506329/202602/1506329-20260211200045678-964632399.png" alt="test_huge_level_json_parse" loading="lazy"></p>
<h5 id="éå½-vs-å æ è§£æçåè">éå½ vs å æ è§£æçåè</h5>
<ul>
<li>åºäºéå½çjsonè¯­æ³è§£æå¨å®ç°ç®åï¼æè·¯æ´ç´è§ï¼ä½åéäºçº¿ç¨æ å¤§å°ï¼å¨ææ·±å±çº§ä¸ä¼åºç°StackOverflowã</li>
<li>åºäºå æ çjsonè¯­æ³è§£æå¨ç¶ææºæ´åºå¤§ï¼å®ç°èµ·æ¥æ´å¤æï¼ä½å°è°ç¨æ æ¬å°å ä¸ä¹åï¼è½å¤çææ·±å±çº§çjsonï¼åªè¦å åå­è¶³å¤ï¼ã</li>
<li>Jacksonç­æççä¸æ¹åºå³ä½¿åæ ·åºäºå æ å®ç°ï¼éå¸¸ä¹ä¼è®¾ç½®ä¸ä¸ªåççæ·±åº¦ä¸éï¼é¿åæ¶ææå¼å¸¸çjsonå¯¼è´ç³»ç»èµæºèå°½ã</li>
</ul>
<h2 id="æ»ç»">æ»ç»</h2>
<p>å°è¿éï¼æä»¬å·²ç»å¦å¼å¤´æè¯´çé£è¬ï¼ä¸æ­¥ä¸æ­¥çä»é¶å¼å§å®ç°äºä¸ä¸ªç®åçjsonè§£æå¨ã<br>
è½ç¶ç½ç»ä¸å·²ç»æçå¤§éå³äºjsonè§£æå¨å®ç°åççåå®¢ï¼çè³å©ç¨aié½è½å¸®ä½ å®ç°çå¤§å·®ä¸å·®ãä½æ¯çº¸ä¸å¾æ¥ç»è§æµï¼ç»ç¥æ­¤äºè¦èº¬è¡ï¼æ³è¦æ´å¥½çå­¦ä¹ ç¼è¯åçï¼å»çè§£ä¹è³å®ç°æ´å¤æçç¼è¯å¨ãè§£éå¨ï¼éè¿èªå·±å¨æå»ä½ä¼é£äºæ¦æ¶©æ½è±¡çåçä¹è®¸æ¯ä¸ç§æçè¾ä½ä½é¿è¿çåçæ ç©·çå­¦ä¹ æ¹å¼ã</p>
<h5 id="_-19"></h5>
<p>åå®¢ä¸­å±ç¤ºçå®æ´ä»£ç å¨æçgithubä¸ï¼<a href="https://github.com/1399852153/MySimpleJsonParser" target="_blank" rel="noopener nofollow">https://github.com/1399852153/MySimpleJsonParser</a> (mainåæ¯)ã<br>
å¸æè½å¤å¸®å©å°å¯¹jsonè§£æææ¯ç¼è¯åçæå´è¶£çè¯»èï¼åå®¹å¦æéè¯¯ï¼è¿è¯·å¤å¤ææã</p>


</div>
<div class="clear"></div>

	<div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-11 20:23">2026-02-11 20:23</span>&nbsp;
<a href="https://www.cnblogs.com/xiaoxiongcanguan">å°çé¤é¦</a>&nbsp;
éè¯»(<span id="post_view_count">16</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19605794);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19605794', targetLink: 'https://www.cnblogs.com/xiaoxiongcanguan/p/19605794', title: 'ä»é¶å¼å§å®ç°ä¸ä¸ªç®æjsonè§£æå¨' })">ä¸¾æ¥</a>
</div>
 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ç±»åæ¦é¤ä¸é¨åå¼æ­¥ç¼ç¨ ]]></title>
    <link>https://www.cnblogs.com/suiyuan129/p/19605836</link>
    <guid>55518f514c3ebe17d7eff0dc90176303</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/suiyuan129/p/19605836" title="åå¸äº 2026-02-11 20:16">
    <span role="heading" aria-level="2">ç±»åæ¦é¤ä¸é¨åå¼æ­¥ç¼ç¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ç±»åæ¦é¤ä¸é¨åå¼æ­¥ç¼ç¨-æ¶é¤å·®å«ç»ä¸ä½¿ç¨">ç±»åæ¦é¤ä¸é¨åå¼æ­¥ç¼ç¨: æ¶é¤å·®å«ï¼ç»ä¸ä½¿ç¨</h1>
<p>C++ ä¸­ç±»åæ¦é¤æå¸åçå®ç°æè·¯åä¸ºä¸¤ç±»ââæ¨¡æ¿ï¼ç¼è¯ææ¦é¤ï¼ä¸å¤æï¼è¿è¡æ¶æ¦é¤ï¼ï¼è¿ä¸¤ç§æ¹å¼å¤§å®¶é½æ¯è¾çæãèæ ååºä¸ºæä»¬å°è£äºæ´æç¨çç±»åæ¦é¤å·¥å·ï¼æ ¸å¿åæ¬ <code>std::function</code>ã<code>std::any</code>ã<code>std::span</code> å <code>std::variant</code>ï¼å®ä»¬å¨ä¸ååºæ¯ä¸å¸®æä»¬âæ¶é¤ç±»åå·®å«ï¼å®ç°ç»ä¸ä½¿ç¨âï¼åæ¶ï¼ç±»åæ¦é¤ä¹æ¯å¼æ­¥ç¼ç¨çæ ¸å¿åºç¡ï¼<code>std::function</code> æ­éç¸å³ç»ä»¶å¯å®ç°ä»»æå¼æ­¥ä»»å¡çç»ä¸è°åº¦ï¼è¿ä¹æ¯æä»¬å°ä¸¤èç»åè®²è§£çæ ¸å¿åå ã</p>
<h2 id="1-stdfunctionå¯è°ç¨å¯¹è±¡çç»ä¸è°ç¨æ¥å£">1. std::functionï¼å¯è°ç¨å¯¹è±¡çâç»ä¸è°ç¨æ¥å£â</h2>
<p><code>std::function</code> æ¯éå¯¹<strong>å¯è°ç¨å¯¹è±¡</strong>çç±»åæ¦é¤å·¥å·ï¼å¶åºå±å®ç°æ ¸å¿æ¯ãæ½è±¡åºç±» + æ¨¡æ¿å­ç±»ãçå¤ææ¨¡å¼ï¼ä¹æ¯è¿è¡æ¶ç±»åæ¦é¤çå¸ååºç¨ï¼</p>
<ul>
<li>æ½è±¡åºç±»ï¼å®ä¹äºä¸âå½æ°ç­¾åâå®å¨å¹éççº¯èè°ç¨æ¥å£ï¼æ¯å¦ <code>virtual Ret call(Args...) = 0</code>ï¼ï¼ä½ä¸ºç»ä¸è°ç¨çåºåï¼</li>
<li>æ¨¡æ¿å­ç±»ï¼å­å¨å·ä½çå¯è°ç¨å¯¹è±¡ï¼å½æ°ãlambdaãä»¿å½æ°ã<code>std::bind</code> ç»æç­ï¼ï¼å¹¶éåæ½è±¡åºç±»ç <code>call</code> æ¹æ³ï¼ééå·ä½å¯¹è±¡çè°ç¨é»è¾ã</li>
</ul>
<p>æ­£å ä¸º <code>std::function</code> æ¯éè¿è°ç¨<strong>æ½è±¡åºç±»çç»ä¸æ¥å£</strong>ï¼é´æ¥å¼å«å­å¥æ¨¡æ¿å­ç±»ä¸­çå·ä½å½æ°ï¼æä»¥æä»¬<strong>å¿é¡»æåæç¡®åç¥ <code>std::function</code> å®æ´çå½æ°ç­¾åï¼è¿åå¼ç±»åãåæ°ç±»åãåæ°ä¸ªæ°ï¼</strong> ââ è¿æ¯æ½è±¡åºç±»å®ä¹ç»ä¸è°ç¨æ¥å£çåæï¼åªæç­¾åä¸è´ï¼ææè¢«æ¦é¤ç±»åçå¯è°ç¨å¯¹è±¡ï¼æè½éè¿æ½è±¡åºç±»çæ¥å£è¢«æ­£ç¡®è°ç¨ãä¹æ­£å è¿è¡æ¶çå¤ææ´¾åï¼éè¿æ½è±¡åºç±»æéè°ç¨å­ç±»ç <code>call</code> æ¹æ³ï¼ï¼<code>std::function</code> ä¼äº§çä¸å®çè¿è¡æ¶å¼éã</p>
<h3 id="æµè¯ä»£ç stdfunction-ç»ä¸è°ç¨ä¸åå¯è°ç¨å¯¹è±¡">æµè¯ä»£ç ï¼std::function ç»ä¸è°ç¨ä¸åå¯è°ç¨å¯¹è±¡</h3>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;functional&gt;
#include &lt;string&gt;

// æ®éå½æ°
int add(int a, int b) { return a + b; }

// ä»¿å½æ°
struct Multiply {
    int operator()(int a, int b) { return a * b; }
};

int main() {
    // å®ä¹å½æ°ç­¾åï¼int(int, int)
    std::function&lt;int(int, int)&gt; func;

    // å­å¨æ®éå½æ°
    func = add;
    std::cout &lt;&lt; "add(3,4) = " &lt;&lt; func(3, 4) &lt;&lt; std::endl; // è¾åº7

    // å­å¨lambdaè¡¨è¾¾å¼
    func = [](int a, int b) { return a - b; };
    std::cout &lt;&lt; "sub(3,4) = " &lt;&lt; func(3, 4) &lt;&lt; std::endl; // è¾åº-1

    // å­å¨ä»¿å½æ°
    func = Multiply{};
    std::cout &lt;&lt; "mul(3,4) = " &lt;&lt; func(3, 4) &lt;&lt; std::endl; // è¾åº12

    return 0;
}
</code></pre>
<p>ä»£ç è¯´æï¼æ è®ºå­å¨çæ¯æ®éå½æ°ãlambdaè¿æ¯ä»¿å½æ°ï¼åªè¦å½æ°ç­¾åå¹é <code>int(int, int)</code>ï¼å°±è½éè¿ <code>std::function</code> ç»ä¸è°ç¨ï¼ä½ç°äºç±»åæ¦é¤âæ¶é¤å·®å«ï¼ç»ä¸ä½¿ç¨âçæ ¸å¿ã</p>
<h2 id="2-stdany--stdvariantæ°æ®å­å¨çç±»åæ¦é¤åé">2. std::any &amp; std::variantï¼æ°æ®å­å¨çâç±»åæ¦é¤åéâ</h2>
<p>ä¸¤èåç¨äºå®ç°æ°æ®å­å¨çç±»åæ¦é¤ï¼ä½å®ä½äºè¡¥ï¼<code>std::variant</code> æ ¸å¿æ¯å¼¥è¡¥ <code>std::any</code> çç¹çä¸ä½æé®é¢ã</p>
<h3 id="stdanyæ çº¦æçå¨ç±»åæ¦é¤">std::anyï¼æ çº¦æçå¨ç±»åæ¦é¤</h3>
<p><code>std::any</code> æ¯ç»å¸çâå¨ç±»åæ¦é¤âå·¥å·ï¼å®å®å¨æ¦é¤ç¼è¯æçç±»åä¿¡æ¯ï¼ä»ä¿çâæ°æ®æ¬èº« + è¿è¡æ¶ç±»åIDï¼<code>std::type_info</code>ï¼âï¼ç¸å½äºä¸ä¸ªâå¸¦ç±»åæ ç­¾çä¸è½çå­âï¼è½å­å¨ä»»æç±»åçæ°æ®ã<br>
å <code>std::function</code> ç±»ä¼¼ï¼<code>std::any</code> éå¨è¿è¡æ¶éè¿ç±»åIDè¯å«åé¨æ°æ®ç±»åï¼å æ­¤å­å¨è¿è¡æ¶å¼éï¼æ­¤å¤ï¼<code>std::any</code> å¯¹å¤§ç±»åä¼è¿è¡å åå­åéï¼è¿ä¸æ­¥å¢å è½»å¾®çåå­å¼éãå¶æå¤§çç¹ç¹æ¯èªç±æ çº¦æï¼ä½è¿ä»½èªç±ä¹å¸¦æ¥äºæä½ç¹ççé®é¢ââä½¿ç¨æ¶å¿é¡»æå¨éè¿ <code>typeid</code> æ£æ¥ç±»åï¼åç¨ <code>any_cast</code> æåæ°æ®ï¼ä¸ç±»åéè¯¯åªè½å¨è¿è¡æ¶æ´é²ï¼æåº <code>std::bad_any_cast</code> å¼å¸¸ï¼ã</p>
<h3 id="stdvariantæéå¶çé«æç±»åæ¦é¤">std::variantï¼æéå¶çé«æç±»åæ¦é¤</h3>
<p><code>std::variant</code> æ¯ä¸ºè§£å³ <code>std::any</code> ççç¹èçï¼å®éè¿<strong>ç¼è¯ææåå£°æå¯å­å¨çç±»åèå´</strong>ï¼å®ç°äºæ´é«æãæ´å®å¨çç±»åæ¦é¤ï¼å±äºâæéç±»åæ¦é¤âï¼</p>
<ul>
<li>ç¼è¯æååºï¼åéç±»åï¼æ¯å¦ç¨ <code>std::get</code> æåéæ´»è·ç±»åï¼ä¼è¢«ç¼è¯å¨åæ¶æéï¼æ´æ©æ´é²é®é¢ï¼é¿åè¿è¡æ¶å¼å¸¸é¾ä»¥è°è¯ï¼</li>
<li>ç»ä¸ä¾¿æ·å¤çï¼æ éæåä¸å  <code>if (typeid)</code> å¤æ­åæ¯ï¼éè¿ <code>std::visit</code> å°±è½æ¹éå¤çææé¢å®ä¹ç±»åï¼ä»£ç æ´ç®æ´ãä¸ææ¼åæ¯ï¼</li>
<li>é¶å å¼éï¼<code>std::variant</code> çå¤§å°å¨ç¼è¯æç¡®å®ï¼ç­äºææé¢å®ä¹ç±»åä¸­æå¤§ç±»åçå°ºå¯¸ + ç±»åæ ç­¾å°ºå¯¸ï¼ï¼æææ°æ®åå­å¨å¨æ ä¸ï¼æ å åéå¼éï¼</li>
<li>å®å¨æåï¼æä¾ <code>std::holds_alternative</code>ï¼å¤æ­æ¯å¦ä¸ºæå®ç±»åï¼ã<code>std::get_if</code>ï¼å®å¨æåï¼ä¸å¹éè¿å <code>nullptr</code>ï¼ç­å·¥å·ï¼æ éæè·å¼å¸¸ï¼ç±»åæ£æ¥åæ°æ®æåæ´ç´è§ãå®å¨ã</li>
</ul>
<p>ç®åæ¥è¯´ï¼<code>std::any</code> æ¯âæ ææ æä½å¨é æå¨âï¼<code>std::variant</code> æ¯âæéå¶ä½ç¼è¯å¨å¸®ä½ ååºâï¼è¿ä»½éå¶æ°æ°æ¯å®ç®åæä½ãæåæççæ ¸å¿ã</p>
<h3 id="æµè¯ä»£ç stdany-ä¸-stdvariant-å¯¹æ¯">æµè¯ä»£ç ï¼std::any ä¸ std::variant å¯¹æ¯</h3>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;any&gt;
#include &lt;variant&gt;
#include &lt;string&gt;
#include &lt;typeinfo&gt;

// å¤çstd::any
void process_any(std::any val) {
    if (val.type() == typeid(int)) {
        std::cout &lt;&lt; "anyå­å¨intï¼" &lt;&lt; std::any_cast&lt;int&gt;(val) &lt;&lt; std::endl;
    } else if (val.type() == typeid(std::string)) {
        std::cout &lt;&lt; "anyå­å¨stringï¼" &lt;&lt; std::any_cast&lt;std::string&gt;(val) &lt;&lt; std::endl;
    } else if (val.type() == typeid(double)) {
        std::cout &lt;&lt; "anyå­å¨doubleï¼" &lt;&lt; std::any_cast&lt;double&gt;(val) &lt;&lt; std::endl;
    }
}

// å¤çstd::variant
using MyVariant = std::variant&lt;int, std::string, double&gt;;
void process_variant(const MyVariant&amp; val) {
    // æ éæåif(typeid)ï¼std::visitæ¹éå¤ç
    std::visit([](const auto&amp; v) {
        using T = std::decay_t&lt;decltype(v)&gt;;
        if constexpr (std::is_same_v&lt;T, int&gt;) {
            std::cout &lt;&lt; "variantå­å¨intï¼" &lt;&lt; v &lt;&lt; std::endl;
        } else if constexpr (std::is_same_v&lt;T, std::string&gt;) {
            std::cout &lt;&lt; "variantå­å¨stringï¼" &lt;&lt; v &lt;&lt; std::endl;
        } else if constexpr (std::is_same_v&lt;T, double&gt;) {
            std::cout &lt;&lt; "variantå­å¨doubleï¼" &lt;&lt; v &lt;&lt; std::endl;
        }
    }, val);
}

int main() {
    // std::anyæµè¯
    std::any a = 10;
    process_any(a); // è¾åºanyå­å¨intï¼10
    a = std::string("hello any");
    process_any(a); // è¾åºanyå­å¨stringï¼hello any
    a = 3.14;
    process_any(a); // è¾åºanyå­å¨doubleï¼3.14

    // std::variantæµè¯
    MyVariant v = 20;
    process_variant(v); // è¾åºvariantå­å¨intï¼20
    v = std::string("hello variant");
    process_variant(v); // è¾åºvariantå­å¨stringï¼hello variant
    v = 6.28;
    process_variant(v); // è¾åºvariantå­å¨doubleï¼6.28

    // std::variantå®å¨æåç¤ºä¾
    if (std::holds_alternative&lt;double&gt;(v)) {
        auto p = std::get_if&lt;double&gt;(&amp;v);
        std::cout &lt;&lt; "å®å¨æådoubleï¼" &lt;&lt; *p &lt;&lt; std::endl; // è¾åº6.28
    }

    return 0;
}
</code></pre>
<p>ä»£ç è¯´æï¼</p>
<ul>
<li><code>std::any</code> éæå¨å <code>if (typeid)</code> åæ¯ï¼æ°å¢ç±»åæ¶éæå¨æ©å±ï¼</li>
<li><code>std::variant</code> åå© <code>std::visit</code> æ¹éå¤çææé¢å®ä¹ç±»åï¼ä»£ç æ´ç®æ´ï¼ä¸ <code>holds_alternative</code>/<code>get_if</code> è®©ç±»åæ£æ¥/æåæ´å®å¨ã</li>
</ul>
<h2 id="3-stdspanè¿ç»­å®¹å¨çé¶å¼éç±»åæ¦é¤">3. std::spanï¼è¿ç»­å®¹å¨çâé¶å¼éç±»åæ¦é¤â</h2>
<p><code>std::span</code> æ¯éå¯¹<strong>è¿ç»­åå­å®¹å¨</strong>çâç¹å¶ç±»åæ¦é¤å·¥å·âï¼ä¸é¨ç¨äºæ¶é¤ä¸åè¿ç»­å®¹å¨çç±»åå·®å¼ï¼å®ç°ç»ä¸è®¿é®ï¼<br>
å®ä¼æ¦é¤ <code>std::vector</code>ã<code>std::array</code>ãCé£æ ¼æ°ç»ç­è¿ç»­å®¹å¨çå·ä½ç±»åï¼ä»ä¿çâèµ·å§æé + åç´ é¿åº¦âä¸¤ä¸ªæ ¸å¿ç¹å¾ï¼ç¸å½äºç»ææè¿ç»­åå­å®¹å¨æä¾äºä¸ä¸ªç»ä¸çâè§å¾âã<br>
<code>std::span</code> çæ ¸å¿ä¼å¿æ¯<strong>é¶è¿è¡æ¶å¼é</strong>ââç±»åæ¦é¤å¨ç¼è¯æå®æï¼æ éè¿è¡æ¶é¢å¤è®¡ç®æåå­åéï¼ä½ä¹ææç¡®éå¶ï¼ä»æ¯æè¿ç»­åå­å®¹å¨ï¼æ æ³å¤ç <code>std::list</code> ç­éè¿ç»­åå­å®¹å¨ã</p>
<h3 id="æµè¯ä»£ç stdspan-ç»ä¸è®¿é®ä¸åè¿ç»­å®¹å¨">æµè¯ä»£ç ï¼std::span ç»ä¸è®¿é®ä¸åè¿ç»­å®¹å¨</h3>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;span&gt;
#include &lt;vector&gt;
#include &lt;array&gt;

// ç»ä¸å¤çææè¿ç»­intå®¹å¨
void print_span(std::span&lt;int&gt; sp) {
    std::cout &lt;&lt; "å®¹å¨é¿åº¦ï¼" &lt;&lt; sp.size() &lt;&lt; "ï¼åå®¹ï¼";
    for (int val : sp) {
        std::cout &lt;&lt; val &lt;&lt; " ";
    }
    std::cout &lt;&lt; std::endl;
}

int main() {
    // std::vector
    std::vector&lt;int&gt; vec = {1, 2, 3};
    print_span(vec); // è¾åºå®¹å¨é¿åº¦ï¼3ï¼åå®¹ï¼1 2 3

    // std::array
    std::array&lt;int, 4&gt; arr = {4, 5, 6, 7};
    print_span(arr); // è¾åºå®¹å¨é¿åº¦ï¼4ï¼åå®¹ï¼4 5 6 7

    // Cé£æ ¼æ°ç»
    int c_arr[] = {8, 9, 10};
    print_span(c_arr); // è¾åºå®¹å¨é¿åº¦ï¼3ï¼åå®¹ï¼8 9 10

    // åçè®¿é®ï¼spançé¢å¤ä¼å¿ï¼
    print_span(std::span(vec).subspan(1, 2)); // è¾åºå®¹å¨é¿åº¦ï¼2ï¼åå®¹ï¼2 3

    return 0;
}
</code></pre>
<p>ä»£ç è¯´æï¼<code>print_span</code> å½æ°æ éå³å¿ä¼ å¥çæ¯ <code>vector</code>ã<code>array</code> è¿æ¯Cæ°ç»ï¼<code>std::span</code> æ¦é¤äºå®¹å¨ç±»åå·®å¼ï¼å®ç°ç»ä¸è®¿é®ï¼ä¸æ ä»»ä½è¿è¡æ¶å¼éã</p>
<h2 id="4-ç±»åæ¦é¤å¨å¼æ­¥ç¼ç¨ä¸­çæ ¸å¿åºç¨">4. ç±»åæ¦é¤å¨å¼æ­¥ç¼ç¨ä¸­çæ ¸å¿åºç¨</h2>
<p>ä¸ºä»ä¹è¦å°ç±»åæ¦é¤ä¸å¼æ­¥ç¼ç¨ç»åï¼å ä¸º <code>std::function</code> çç±»åæ¦é¤è½åï¼æ¯å¼æ­¥ä»»å¡âç»ä¸ç®¡çâçæ ¸å¿ï¼å®å¸¸æ­é lambda è¡¨è¾¾å¼ã<code>std::packaged_task</code>ã<code>std::bind</code> å®ç°ä»»æå¼æ­¥ä»»å¡çç»ä¸è°åº¦ï¼æ ¸å¿é»è¾æ¯âæ¦é¤ä»»å¡å·®å¼ï¼ç»ä¸ç®¡çï¼æéè·åç»æâï¼</p>
<ol>
<li>ç¨ <code>std::bind</code> å°ä»»å¡åæ°ä¸å¯è°ç¨å¯¹è±¡ç»å®ï¼æ¦é¤ä¸åä»»å¡çåæ°ç±»åå·®å¼ï¼è®©æåä»»å¡ééç»ä¸çè°ç¨å½¢å¼ï¼</li>
<li>å°ç»å®åçä»»å¡è£å¥ <code>std::packaged_task</code>ï¼éè¿ <code>std::packaged_task</code> åç½®ç <code>std::promise</code>ï¼è·å <code>std::future</code> å¯¹è±¡ï¼ç¨äºåç»­æ¥æ¶å¼æ­¥ä»»å¡çè¿åå¼ï¼ââ æ­¤æ¶ä»»å¡çè¿åå¼ç±»åæªè¢«æ¦é¤ï¼</li>
<li>éè¿ lambda è¡¨è¾¾å¼å°è£ <code>std::packaged_task</code> çæ§è¡é»è¾ï¼å°âæè¿åå¼çä»»å¡âåè£ææ è¿åå¼ç <code>void()</code> ç±»åï¼ä»èæ¦é¤è¿åå¼å·®å¼ï¼</li>
<li>æç»ï¼ææå¼æ­¥ä»»å¡åå¯ç»ä¸è£è¿ <code>std::function&lt;void()&gt;</code> ä¸­è¿è¡ç®¡çï¼ä»»å¡çè¿åå¼åå¨å¼æ­¥æ§è¡å®æåï¼èªå¨å­å¥ <code>std::packaged_task</code> åé¨ç <code>std::promise</code>ï¼æä»¬éè¿ä¹åè·åç <code>std::future</code> å°±è½æéè·åå¼æ­¥ç»æï¼å®ç°âä»»å¡ç»ä¸ç®¡ç + ç»ææéè·åâã</li>
</ol>
<h3 id="æµè¯ä»£ç ç±»åæ¦é¤å®ç°å¼æ­¥ä»»å¡ç»ä¸ç®¡ç">æµè¯ä»£ç ï¼ç±»åæ¦é¤å®ç°å¼æ­¥ä»»å¡ç»ä¸ç®¡ç</h3>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;functional&gt;
#include &lt;future&gt;
#include &lt;thread&gt;
#include &lt;queue&gt;
#include &lt;mutex&gt;
#include &lt;condition_variable&gt;
#include &lt;string&gt;

// å¨å±ä»»å¡éåï¼å­å¨ç»ä¸çæ è¿åå¼ä»»å¡
std::queue&lt;std::function&lt;void()&gt;&gt; task_queue;
std::mutex mtx;
std::condition_variable cv;
bool stop = false;

// å·¥ä½çº¿ç¨ï¼æ¶è´¹ä»»å¡éå
void worker() {
    while (!stop) {
        std::function&lt;void()&gt; task;
        // å éåä»»å¡
        {
            std::unique_lock&lt;std::mutex&gt; lock(mtx);
            cv.wait(lock, []() { return stop || !task_queue.empty(); });
            if (stop &amp;&amp; task_queue.empty()) return;
            task = std::move(task_queue.front());
            task_queue.pop();
        }
        // æ§è¡ä»»å¡
        task();
    }
}

// æäº¤ä»»å¡æ¨¡æ¿ï¼æ¦é¤åæ°/è¿åå¼å·®å¼ï¼ç»ä¸å­å¥éå
template&lt;typename F, typename... Args&gt;
auto submit_task(F&amp;&amp; f, Args&amp;&amp;... args) -&gt; std::future&lt;decltype(f(args...))&gt; {
    // ç»å®åæ°ï¼æ¦é¤åæ°å·®å¼
    auto bound_task = std::bind(std::forward&lt;F&gt;(f), std::forward&lt;Args&gt;(args)...);
    // å®ä¹packaged_taskï¼ä¿çè¿åå¼ç±»å
    using RetType = decltype(f(args...));
    std::packaged_task&lt;RetType()&gt; pt(std::move(bound_task));
    // è·åfutureç¨äºæ¥æ¶ç»æ
    std::future&lt;RetType&gt; fut = pt.get_future();
    // å°è£ævoid()ä»»å¡ï¼æ¦é¤è¿åå¼å·®å¼
    std::function&lt;void()&gt; wrapper = [pt = std::move(pt)]() mutable {
        pt(); // æ§è¡packaged_taskï¼ç»æå­å¥promise
    };
    // å­å¥ä»»å¡éå
    {
        std::lock_guard&lt;std::mutex&gt; lock(mtx);
        task_queue.push(std::move(wrapper));
    }
    cv.notify_one(); // å¤éå·¥ä½çº¿ç¨
    return fut;
}

// æµè¯ä»»å¡1ï¼æåæè¿åå¼ï¼è®¡ç®å¹³æ¹ï¼
int square(int x) {
    std::this_thread::sleep_for(std::chrono::seconds(1));
    return x * x;
}

// æµè¯ä»»å¡2ï¼æåæè¿åå¼ï¼æ¼æ¥å­ç¬¦ä¸²ï¼
std::string concat(const std::string&amp; a, const std::string&amp; b) {
    std::this_thread::sleep_for(std::chrono::seconds(1));
    return a + b;
}

int main() {
    // å¯å¨å·¥ä½çº¿ç¨
    std::thread t(worker);

    // æäº¤ä»»å¡1ï¼è®¡ç®5çå¹³æ¹
    auto fut1 = submit_task(square, 5);
    // æäº¤ä»»å¡2ï¼æ¼æ¥å­ç¬¦ä¸²
    auto fut2 = submit_task(concat, "hello ", "async");

    // ä¸»çº¿ç¨ç­å¾ç»æ
    std::cout &lt;&lt; "ç­å¾å¼æ­¥ä»»å¡ç»æ..." &lt;&lt; std::endl;
    std::cout &lt;&lt; "5çå¹³æ¹ï¼" &lt;&lt; fut1.get() &lt;&lt; std::endl; // è¾åº25
    std::cout &lt;&lt; "å­ç¬¦ä¸²æ¼æ¥ï¼" &lt;&lt; fut2.get() &lt;&lt; std::endl; // è¾åºhello async

    // åæ­¢å·¥ä½çº¿ç¨
    stop = true;
    cv.notify_one();
    t.join();

    return 0;
}
</code></pre>
<p>ä»£ç è¯´æï¼</p>
<ul>
<li><code>square</code> å <code>concat</code> æ¯ä¸åç­¾åçä»»å¡ï¼åæ°/è¿åå¼åä¸åï¼ï¼</li>
<li>éè¿ <code>std::bind</code> æ¦é¤åæ°å·®å¼ï¼<code>std::packaged_task</code> ä¿çè¿åå¼å¹¶ç»å® <code>future</code>ï¼lambda å°è£æ <code>void()</code> æ¦é¤è¿åå¼å·®å¼ï¼</li>
<li>æç»ææä»»å¡é½è½å­å¥ <code>std::function&lt;void()&gt;</code> éåï¼å®ç°ç»ä¸ç®¡çï¼ä½ç°äºç±»åæ¦é¤å¨å¼æ­¥ç¼ç¨ä¸­çæ ¸å¿ä»·å¼ã</li>
</ul>
<h2 id="æ´ä½æ»ç»">æ´ä½æ»ç»</h2>
<p>æ ååºä¸­çåç§ç±»åæ¦é¤å·¥å·ï¼è½å®ä½ä¸åï¼ä½æ ¸å¿ç®æ ä¸è´ââ<strong>æ¶é¤ç±»åå·®å«ï¼å®ç°ç»ä¸ä½¿ç¨</strong>ï¼</p>
<ol>
<li><code>std::function</code>ï¼éå¯¹å¯è°ç¨å¯¹è±¡ï¼ç»ä¸è°ç¨æ¥å£ï¼ä¾èµå½æ°ç­¾ååå¤æå®ç°ï¼æè¿è¡æ¶å¼éï¼</li>
<li><code>std::any</code>ï¼éå¯¹ä»»ææ°æ®ï¼å¨ç±»åæ¦é¤ï¼èªç±ä½ç¹çãæè¿è¡æ¶åå åå­å¼éï¼</li>
<li><code>std::variant</code>ï¼éå¯¹æéèå´æ°æ®ï¼å¼¥è¡¥ <code>std::any</code> ä¸è¶³ï¼ç¼è¯æååºãé«æä¾¿æ·ãé¶å å¼éï¼</li>
<li><code>std::span</code>ï¼éå¯¹è¿ç»­å®¹å¨ï¼é¶å¼éç±»åæ¦é¤ï¼ç»ä¸è¿ç»­åå­è®¿é®æ¥å£ï¼ä»æ¯æè¿ç»­å®¹å¨ã</li>
</ol>
<p>èç±»åæ¦é¤ä¸å¼æ­¥ç¼ç¨çç»åï¼æ ¸å¿æ¯åå© <code>std::function</code> çç»ä¸ç®¡çè½åï¼æ­é lambdaã<code>std::packaged_task</code>ã<code>std::bind</code> ç­ç»ä»¶ï¼æ¦é¤ä¸åå¼æ­¥ä»»å¡çåæ°åè¿åå¼å·®å¼ï¼å®ç°ä»»æå¼æ­¥ä»»å¡çç»ä¸è°åº¦ï¼è¿ä¹æ¯ç±»åæ¦é¤å¨å®éå¼åä¸­æå¸¸ç¨çåºæ¯ä¹ä¸ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.003472222222222222" data-date-updated="2026-02-11 20:21">2026-02-11 20:16</span>&nbsp;
<a href="https://www.cnblogs.com/suiyuan129">suiyuan129</a>&nbsp;
éè¯»(<span id="post_view_count">7</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19605836);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19605836', targetLink: 'https://www.cnblogs.com/suiyuan129/p/19605836', title: 'ç±»åæ¦é¤ä¸é¨åå¼æ­¥ç¼ç¨' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ç®æçåå¸å¼kvè®¾è®¡ ]]></title>
    <link>https://www.cnblogs.com/jackjavacpp/p/19605754</link>
    <guid>41de02f9f6dcc481cf83e91759f9ef13</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jackjavacpp/p/19605754" title="åå¸äº 2026-02-11 19:47">
    <span role="heading" aria-level="2">ç®æçåå¸å¼kvè®¾è®¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ç®æçåå¸å¼kvè®¾è®¡--ä¸">ç®æçåå¸å¼kvè®¾è®¡--(ä¸)</h1>
<p><strong>è¿ç¯æç« ç®ååªè®¾è®¡å°éç¾¤å¯å¨ï¼ç¶åèªå¨éä¸»çåè½ã</strong></p>
<p>å°åï¼<a href="https://github.com/Jack-txf/easy-kv" target="_blank" rel="noopener nofollow">https://github.com/Jack-txf/easy-kv</a></p>
<p><strong>TIPS</strong>ï¼æ­¤æç« å¯¹åºçåæ¯çæ¬æ¯<strong>version0211</strong></p>
<p>raftåºç¡ç¥è¯ï¼<a href="https://mp.weixin.qq.com/s/DHO2CK87kI-clf4O96t5Cw" target="_blank" rel="noopener nofollow">https://mp.weixin.qq.com/s/DHO2CK87kI-clf4O96t5Cw</a></p>
<h1 id="1-åè¨">1. åè¨</h1>
<p>å¨ Raft KV ç³»ç»ä¸­ï¼æ¯ä¸ªèç¹ï¼Nodeï¼é½æ¯å¯¹ç­çãä¸ä¸ªå¸åçè¯·æ±æµåæ¯ï¼ <code>Client</code> -&gt; <code>Leader Node</code> -&gt; <code>Raft æ¥å¿åæ­¥</code> -&gt; <code>å¤§å¤æ°èç¹ç¡®è®¤</code> -&gt; <code>åºç¨å°ç¶ææº (KV Store)</code> -&gt; <code>è¿å Client</code>ã</p>
<h1 id="2-è®¾è®¡æ­¥éª¤">2. è®¾è®¡æ­¥éª¤</h1>
<p>Raft æ ¸å¿ç»ä»¶åæ¬ï¼ä¸è´æ§ç»ç¹æ¨¡åï¼RPC éä¿¡ï¼æ¥å¿æ¨¡åã</p>
<h2 id="21-æ¥å¿">2.1 æ¥å¿</h2>
<pre><code class="language-txt">åæ¥å¿ â å¤å¶æ¥å¿ â commit â apply ãleaderåºç¨é¡ºåºã

ç»åä¸ä¸çè¯å°±å¦ä¸ï¼
Client
   â
Leader
   â append log (æ¬å°)
   â
åé AppendEntries
   â
Followers append log
   â
å¤æ°æå
   â
Leader commit
   â
Leader apply
   â
è¿åå®¢æ·ç«¯æå
   â
Leader ä¸æ¬¡å¿è·³å¸¦ commitIndex
   â
Followers apply
</code></pre>
<p>é¦åçä¸ä¸ï¼å®¢æ·ç«¯åéä¸ä¸ªè¯·æ±ï¼æ¶åå°çå¤§è´ä¸è¥¿æåªäºï¼</p>
<img src="https://img2024.cnblogs.com/blog/2358057/202602/2358057-20260211194613207-412932482.png" style="zoom: 80%">
<p>ä»åå¾åçï¼æä»¬éè¦è®¾è®¡çå°±æ¯å¦ä½åå¥æ¥å¿æä»¶ï¼ä»¥åæ¥å¿æä»¶çæ ¼å¼è¯¥å¦ä½è®¾è®¡å¢ï¼æ­¤å¤æä»¬å°±å¼ç®åä¸ç¹å¿å°±å¥½äº</p>
<table>
<thead>
<tr>
<th>totalLength ï¼intï¼</th>
<th>termï¼longï¼</th>
<th>indexï¼longï¼</th>
<th>commandLengthï¼intï¼</th>
<th>commandï¼byte[]ï¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ´æ¡log entry é¿åº¦</td>
<td>Raft term</td>
<td>æ¥å¿ index</td>
<td>å½ä»¤é¿åº¦</td>
<td>çæ­£å½ä»¤ï¼è¿ä¸ªè¯å®æ¯åé¿ç</td>
</tr>
</tbody>
</table>
<p>totalLength = 8 (term) + 8 (index) + 4 (commandLength) + commandLength</p>
<pre><code class="language-java">public class LogEntry {
    private final long term;
    private final long index;
    private final String command;
    ....
}
</code></pre>
<p>æ¥å¿å­å¨ä¸ç®¡ç</p>
<pre><code class="language-java">/**
 * @Description: æ¥å¿å­å¨ä¸ç®¡ç
 * @Author: txf
 * @Date: 2026/2/9
 */
public class LogManager {
    // æ¥å¿æä»¶è·¯å¾
    private static final String LOG_FILE_PATH = "easy_kv_log.dat";
    // åå­æ å°çåæ®µå¤§å°ï¼128MBï¼å¯æ ¹æ®åå­è°æ´ï¼,è¿éåè°æ´ä¸ºä¸¤å
    private static final int MAPPED_SIZE = 2 * 1024 * 1024;
    // æä»¶æå¼æ¨¡å¼ï¼rw = è¯»å
    private static final String FILE_MODE = "rw";

    private final File logFile;
    private RandomAccessFile raf;
    private FileChannel fileChannel;
    // å½åæ å°çåå­ç¼å²åº
    private MappedByteBuffer currentMappedBuffer;
    // å½åæ å°æ®µçèµ·å§åç§»ï¼æä»¶åç§»ï¼
    private long currentMappedOffset = 0;
    // å½ååå¥çä½ç½®ï¼ç¸å¯¹äºæä»¶çæ»åç§»ï¼
    private long writePosition = 0;

    public LogManager() {
        this.logFile = new File(LOG_FILE_PATH);
        initFileChannel();
        initMappedBuffer();
        // åå§åæ¶å®ä½å°æä»¶æ«å°¾ï¼ç»§ç»­è¿½å åï¼
        try {
            this.writePosition = fileChannel.size();
        } catch (IOException e) {
            throw new RuntimeException("è·åæä»¶å¤§å°å¤±è´¥", e);
        }
    }

    /**
     * è¿½å åå¥åæ¡æ¥å¿ï¼æ ¸å¿é«æ§è½åå¥ï¼
     * @param term Raftä»»æ
     * @param index æ¥å¿ç´¢å¼
     * @param command KVæä½å½ä»¤ï¼å¦"PUT key value"ï¼
     */
    public void appendLogEntry(long term, long index, String command) {
        // 1. åå¤å½ä»¤å­èæ°ç»
        byte[] commandBytes = command.getBytes(StandardCharsets.UTF_8);
        int commandLength = commandBytes.length;
        // 2. è®¡ç®æ»é¿åº¦
        int totalLength = 4 + 8 + 8 + 4 + commandLength;

        // 3. åå¤ç´æ¥ç¼å²åºï¼å å¤åå­ï¼é¿åæ·è´ï¼
        ByteBuffer directBuffer = ByteBuffer.allocateDirect(totalLength);
        // ææ ¼å¼åå¥ç¼å²åº -- è¿éæ¯åå¥äºè¿å¶çï¼æä»¶åå®¹æä»¬äººç±»å°±è¯»ä¸æäº
        directBuffer.putInt(totalLength);
        directBuffer.putLong(term);
        directBuffer.putLong(index);
        directBuffer.putInt(commandLength);
        directBuffer.put(commandBytes);

        // è¿éæ¯åå¥å­ç¬¦ä¸²ç
        // directBuffer.put((term + index + command).getBytes(StandardCharsets.UTF_8));

        // ç¿»è½¬ç¼å²åºï¼ä»åæ¨¡å¼è½¬ä¸ºè¯»æ¨¡å¼ï¼
        directBuffer.flip();
        // 4. åå¥å°åå­æ å°ç¼å²åºï¼æ ¸å¿ï¼é¶æ·è´ï¼
        writeToMappedBuffer(directBuffer);        // 5. æ´æ°å¨å±åå¥ä½ç½®
        writePosition += totalLength;
    }

    /**
     * å°ç¼å²åºæ°æ®åå¥åå­æ å°åºï¼èªå¨æ©å®¹æ å°æ®µï¼
     */
    private void writeToMappedBuffer(ByteBuffer buffer) {
        while (buffer.hasRemaining()) {
            // æ£æ¥å½åæ å°ç¼å²åºæ¯å¦æè¶³å¤å©ä½ç©ºé´
            if (currentMappedBuffer.remaining() &lt; buffer.remaining()) {
                // ååå¥å½åæ å°åºçå©ä½ç©ºé´
                int remaining = currentMappedBuffer.remaining();
                byte[] temp = new byte[remaining];
                buffer.get(temp);
                currentMappedBuffer.put(temp);
                // å¼ºå¶å·çï¼å°æ å°åå­çæ°æ®åæ­¥å°ç£çï¼å¯éï¼æ¹éå·çå¯æåæ§è½ï¼
                currentMappedBuffer.force();
                // æ©å®¹æ å°æ®µ
                initMappedBuffer();
            } else {
                // ç´æ¥åå¥æ å°ç¼å²åº
                currentMappedBuffer.put(buffer);
            }
        }
    }

    /**
     * è¯»åæå®ç´¢å¼çæ¥å¿æ¡ç®ï¼é«æ§è½è¯»åï¼
     */
    public LogEntry readLogEntry(long index) {
        try {
            // ä½¿ç¨FileChannel + ç´æ¥ç¼å²åºè¯»å
            ByteBuffer directBuffer = ByteBuffer.allocateDirect(1024 * 1024); // 1MBç´æ¥ç¼å²åº
            long fileOffset = 0;
            long fileSize = fileChannel.size();

            while (fileOffset &lt; fileSize) {
                // éç½®ç¼å²åº
                directBuffer.clear();
                // ä»æä»¶æå®åç§»è¯»åæ°æ®å°ç¼å²åº
                int readBytes = fileChannel.read(directBuffer, fileOffset);
                if (readBytes == -1) break;
                directBuffer.flip();

                // è§£æç¼å²åºä¸­çæ¥å¿æ¡ç®
                while (directBuffer.hasRemaining()) {
                    // æ£æ¥å©ä½å­èæ¯å¦è¶³å¤è¯»ååºå®å¤´é¨ï¼4+8+8+4=24å­èï¼
                    if (directBuffer.remaining() &lt; 24) break;
                    // è¯»ååºå®å­æ®µ
                    int totalLength = directBuffer.getInt();
                    long term = directBuffer.getLong();
                    long currentIndex = directBuffer.getLong();
                    int commandLength = directBuffer.getInt();
                    // æ£æ¥å©ä½å­èæ¯å¦è¶³å¤è¯»åcommand
                    if (directBuffer.remaining() &lt; commandLength) {
                        // åéç¼å²åºpositionï¼ä¸æ¬¡ç»§ç»­è§£æ
                        directBuffer.position(directBuffer.position() - 24);
                        break;
                    }
                    // è¯»åcommand
                    byte[] commandBytes = new byte[commandLength];
                    directBuffer.get(commandBytes);
                    String command = new String(commandBytes, StandardCharsets.UTF_8);
                    // æ ¡éªæ»é¿åº¦
                    int actualLength = 4 + 8 + 8 + 4 + commandLength;
                    if (totalLength != actualLength) {
                        throw new RuntimeException("æ¥å¿æä»¶æåï¼æ»é¿åº¦ä¸å¹é");
                    }
                    // æ¾å°ç®æ ç´¢å¼åè¿å
                    if (currentIndex == index) {
                        return new LogEntry(term, index, command);
                    }
                    // æ´æ°æä»¶åç§»
                    fileOffset += totalLength;
                }
            }
        } catch (IOException e) {
            throw new RuntimeException("è¯»åæ¥å¿æ¡ç®å¤±è´¥ [index=" + index + "]", e);
        }
        return null;
    }

    /**
     * å è½½æææ¥å¿æ¡ç®ï¼èç¹å¯å¨æ¶æ¢å¤ï¼
     */
    public List&lt;LogEntry&gt; loadAllLogEntries() {
        List&lt;LogEntry&gt; logEntries = new ArrayList&lt;&gt;();
        try {
            ByteBuffer directBuffer = ByteBuffer.allocateDirect(1024 * 1024);
            long fileOffset = 0;
            long fileSize = fileChannel.size();

            while (fileOffset &lt; fileSize) {
                directBuffer.clear();
                int readBytes = fileChannel.read(directBuffer, fileOffset);
                if (readBytes == -1) break;
                directBuffer.flip();

                while (directBuffer.hasRemaining()) {
                    if (directBuffer.remaining() &lt; 24) break;

                    int totalLength = directBuffer.getInt();
                    long term = directBuffer.getLong();
                    long index = directBuffer.getLong();
                    int commandLength = directBuffer.getInt();

                    if (directBuffer.remaining() &lt; commandLength) {
                        directBuffer.position(directBuffer.position() - 24);
                        break;
                    }

                    byte[] commandBytes = new byte[commandLength];
                    directBuffer.get(commandBytes);
                    String command = new String(commandBytes, StandardCharsets.UTF_8);

                    int actualLength = 4 + 8 + 8 + 4 + commandLength;
                    if (totalLength != actualLength) {
                        throw new RuntimeException("æ¥å¿æä»¶æåï¼æ»é¿åº¦ä¸å¹é");
                    }

                    logEntries.add(new LogEntry(term, index, command));
                    fileOffset += totalLength;
                }
            }
        } catch (IOException e) {
            throw new RuntimeException("å è½½æææ¥å¿æ¡ç®å¤±è´¥", e);
        }
        return logEntries;
    }

    /**
     * å¼ºå¶å·çï¼å°æ å°åå­çæ°æ®åæ­¥å°ç£çï¼
     */
    public void forceFlush() {
        if (currentMappedBuffer != null) {
            currentMappedBuffer.force(); // åæ­¥æ å°åå­å°ç£ç
        }
        try {
            fileChannel.force(true); // å¼ºå¶å·çï¼åå«åæ°æ®ï¼
        } catch (IOException e) {
            throw new RuntimeException("å·çå¤±è´¥", e);
        }
    }

    /**
     * å³é­èµæºï¼å¿é¡»è°ç¨ï¼å¦åä¼å¯¼è´æä»¶å¥ææ³æ¼ï¼
     */
    public void close() {
        try {
            forceFlush();
            if (fileChannel != null) {
                fileChannel.close();
            }
            if (raf != null) {
                raf.close();
            }
        } catch (IOException e) {
            throw new RuntimeException("å³é­èµæºå¤±è´¥", e);
        }
    }
    /**
     * åå§å/æ©å®¹åå­æ å°ç¼å²åº
     */
    private void initMappedBuffer() {
        try {
            // è®¡ç®éè¦æ å°çèµ·å§ä½ç½®åå¤§å°
            long fileSize = fileChannel.size();
            // å¦æå½åæ å°æ®µå·²åæ»¡ï¼æé¦æ¬¡åå§åï¼åå»ºæ°çæ å°
            if (currentMappedBuffer == null || writePosition &gt;= currentMappedOffset + MAPPED_SIZE) {
                currentMappedOffset = (writePosition / MAPPED_SIZE) * MAPPED_SIZE;
                // æ å°æä»¶çæå®åºé´å°åå­ï¼FileChannel.MapMode.READ_WRITEï¼è¯»åæ¨¡å¼ï¼
                currentMappedBuffer = fileChannel.map(
                        FileChannel.MapMode.READ_WRITE,
                        currentMappedOffset,
                        MAPPED_SIZE
                );
                // å°ç¼å²åºçpositionå®ä½å°å½ååå¥ä½ç½®ç¸å¯¹äºæ å°æ®µçåç§»
                currentMappedBuffer.position((int) (writePosition - currentMappedOffset));
            }
        } catch (IOException e) {
            throw new RuntimeException("åå§ååå­æ å°ç¼å²åºå¤±è´¥", e);
        }
    }

    /**
     * åå§åFileChannelï¼æ ¸å¿é«æ§è½ééï¼
     */
    private void initFileChannel() {
        try {
            // ä¸å­å¨ååå»ºæä»¶
            if (!logFile.exists()) {
                boolean newFile = logFile.createNewFile();
                if (!newFile) {
                    throw new RuntimeException("åå»ºæä»¶å¤±è´¥");
                }
            }
            this.raf = new RandomAccessFile(logFile, FILE_MODE);
            this.fileChannel = raf.getChannel();
        } catch (IOException e) {
            throw new RuntimeException("åå§åFileChannelå¤±è´¥", e);
        }
    }
}
</code></pre>
<h2 id="22-æå¡ç«¯è®¾è®¡">2.2 æå¡ç«¯è®¾è®¡</h2>
<h3 id="221-æ¶æ¯è®¾è®¡">2.2.1 æ¶æ¯è®¾è®¡</h3>
<p>æ¥å¿è®¾è®¡å¥½äºä¹åï¼æ¥ä¸æ¥çæå¡ç«¯å¦ä½è®¾è®¡ãæä»¬ä½¿ç¨çæ¯nettyæ¡æ¶ï¼è¦æ±ænettyåºç¡ãç¶ååºåååè®®éç¨çæ¯protobufï¼è¯»èå¯ä»¥åèè¿ç¯æç« ï¼<a href="https://mp.weixin.qq.com/s/kg_-AMHRn_DzFbfBnkK4VQ" target="_blank" rel="noopener nofollow">https://mp.weixin.qq.com/s/kg_-AMHRn_DzFbfBnkK4VQ</a> è¿ç¯æç« å¤§è´è®²è§£äºä¸ä¸è¯¥åºåååè®®ï¼å¹¶ä¸ä¹æ¯éç¨nettyæ´åçãæ ¹æ®protoæä»¶çæç±»çå½ä»¤å¦ä¸ï¼ä¹å¯ä»¥ç¨ideaçæä»¶èªå¨çæã</p>
<pre><code class="language-proto">protoc  --proto_path=xxxxç®å½  --java_out=xxxç®å½  å·ä½çprotoæä»¶
</code></pre>
<p>æ¶æ¯æ¨¡æ¿å¦ä¸ï¼</p>
<pre><code class="language-proto">syntax = "proto3";
option java_outer_classname = "KvRaftProto"; // çæçå¤å±ç±»å
option java_multiple_files = false; // çæå¤ä¸ªç¬ç«çJavaç±»ï¼èéåé¨ç±»ï¼

// ===================== 1. éç¨æ¶æ¯å°è£ä½ï¼æ ¸å¿ï¼ =====================
// Nettyä¼ è¾æ¶åªä¼ è¿ä¸ªæ¶æ¯ï¼éè¿typeè¯å«å·ä½æ¶æ¯ç±»å
message RaftKvMessage {
  // æ¶æ¯ç±»åæä¸¾ï¼è¦çææäº¤äºåºæ¯ï¼
  enum MessageType {
    UNKNOWN = 0; // æªç¥ç±»åï¼ååºï¼
    // å®¢æ·ç«¯ â èç¹ï¼KVæä½
    KV_REQUEST = 1;    // å®¢æ·ç«¯åèµ·KVè¯·æ±ï¼PUT/GET/DELETEï¼
    KV_RESPONSE = 2;   // èç¹ååºå®¢æ·ç«¯KVè¯·æ±
    // èç¹ â èç¹ï¼Raftå±è¯
    VOTE_REQUEST = 3;  // éä¸¾è¯·æ±ï¼CandidateâFollowerï¼
    VOTE_RESPONSE = 4; // éä¸¾ååºï¼FollowerâCandidateï¼
    APPEND_ENTRIES_REQUEST = 5;  // æ¥å¿è¿½å /å¿è·³ï¼LeaderâFollowerï¼
    APPEND_ENTRIES_RESPONSE = 6; // æ¥å¿è¿½å ååºï¼FollowerâLeaderï¼
  }

  MessageType type = 1; // æ¶æ¯ç±»åï¼å¿ä¼ ï¼
  string node_id = 2;   // åéæ¹èç¹IDï¼ç¨äºè¯å«èç¹ï¼

  // å·ä½æ¶æ¯ä½ï¼æ ¹æ®typeéæ©å¶ä¸­ä¸ä¸ªï¼
  KvRequest kv_request = 3;
  KvResponse kv_response = 4;
  VoteRequest vote_request = 5;
  VoteResponse vote_response = 6;
  AppendEntriesRequest append_entries_request = 7;
  AppendEntriesResponse append_entries_response = 8;
}

// ===================== 2. å®¢æ·ç«¯KVæä½ç¸å³ =====================
// å®¢æ·ç«¯åèµ·çKVè¯·æ±ï¼PUT/GET/DELETEï¼
message KvRequest {
  enum OpType {
    PUT = 0;    // åå¥/æ´æ°
    GET = 1;    // è¯»å
    DELETE = 2; // å é¤
  }
  OpType op_type = 1; // æä½ç±»åï¼å¿ä¼ ï¼
  string key = 2;     // KVçkeyï¼å¿ä¼ ï¼
  string value = 3;   // KVçvalueï¼ä»PUTæ¶ä¼ ï¼
  // å¯éï¼è¯·æ±IDï¼ç¨äºå¹ç­æ§ï¼é²æ­¢éå¤è¯·æ±ï¼
  string request_id = 4;
}

// èç¹ååºå®¢æ·ç«¯çKVç»æ
message KvResponse {
  bool success = 1;    // æä½æ¯å¦æå
  string message = 2;  // éè¯¯ä¿¡æ¯/æç¤ºï¼å¤±è´¥æ¶å¿ä¼ ï¼
  string value = 3;    // è¿åçvalueï¼ä»GETæåæ¶ä¼ ï¼
  string request_id = 4; // å¯¹åºè¯·æ±çIDï¼å¹ç­æ§ï¼
}

// ===================== 3. Raftéä¸¾ç¸å³ =====================
// CandidateåFolloweråèµ·çæç¥¨è¯·æ±
message VoteRequest {
  int64 term = 1;                // Candidateçå½åä»»æï¼å¿ä¼ ï¼
  string candidate_id = 2;       // Candidateçèç¹IDï¼å¿ä¼ ï¼
  int64 last_log_index = 3;      // Candidateæåä¸æ¡æ¥å¿çç´¢å¼ï¼ç¨äºæ¥å¿ä¸è´æ§æ£æ¥ï¼
  int64 last_log_term = 4;       // Candidateæåä¸æ¡æ¥å¿çä»»æï¼ç¨äºæ¥å¿ä¸è´æ§æ£æ¥ï¼
}

// FollowerååºCandidateçæç¥¨ç»æ
message VoteResponse {
  int64 term = 1;                // Followerçå½åä»»æï¼å¿ä¼ ï¼ç¨äºæ´æ°Candidateçä»»æï¼
  bool vote_granted = 2;         // æ¯å¦æèµæç¥¨ï¼å¿ä¼ ï¼
}

// ===================== 4. Raftæ¥å¿è¿½å /å¿è·³ç¸å³ =====================
// æ¥å¿æ¡ç®ï¼ä¸ä½ è®¾è®¡çæ¥å¿æ ¼å¼å¯¹é½ï¼åºåååå¯ç´æ¥åå¥æ¥å¿æä»¶ï¼
message LogEntry {
  int64 term = 1;        // Raftä»»æï¼å¯¹åºä½ æ¥å¿æ ¼å¼çtermï¼
  int64 index = 2;       // æ¥å¿ç´¢å¼ï¼å¯¹åºä½ æ¥å¿æ ¼å¼çindexï¼
  string command = 3;    // KVæä½å½ä»¤ï¼å¦"PUT key1 value1"ï¼å¯¹åºä½ æ¥å¿æ ¼å¼çcommandï¼
}

// LeaderåFolloweråéçæ¥å¿è¿½å /å¿è·³è¯·æ±
message AppendEntriesRequest {
  int64 term = 1;                // Leaderçå½åä»»æï¼å¿ä¼ ï¼
  string leader_id = 2;          // Leaderçèç¹IDï¼å¿ä¼ ï¼
  int64 prev_log_index = 3;      // åä¸æ¡æ¥å¿çç´¢å¼ï¼ç¨äºæ¥å¿ä¸è´æ§æ£æ¥ï¼
  int64 prev_log_term = 4;       // åä¸æ¡æ¥å¿çä»»æï¼ç¨äºæ¥å¿ä¸è´æ§æ£æ¥ï¼
  repeated LogEntry entries = 5; // å¾è¿½å çæ¥å¿æ¡ç®ï¼å¿è·³æ¶ä¸ºç©ºï¼
  int64 leader_commit = 6;       // Leaderå·²æäº¤çæ¥å¿ç´¢å¼ï¼Followeræ®æ­¤æ´æ°èªå·±çæäº¤ç´¢å¼ï¼
}

// FollowerååºLeaderçæ¥å¿è¿½å ç»æ
message AppendEntriesResponse {
  int64 term = 1;                // Followerçå½åä»»æï¼å¿ä¼ ï¼ç¨äºæ´æ°Leaderçä»»æï¼
  bool success = 2;              // æ¥å¿è¿½å æ¯å¦æåï¼å¿ä¼ ï¼
  int64 match_index = 3;         // Followerå·²å¹éçæ¥å¿ç´¢å¼ï¼Leaderæ®æ­¤æ´æ°nextIndexï¼
}
</code></pre>
<p>ä¸é¢æ¯æ¶æ¯çå¤§è´æ ¼å¼ã</p>
<p>æ¥ä¸æ¥çæå¡ç«¯çèç¹è®¾è®¡ï¼æä»¬ä»nettyæå¡å¯å¨å¼å§å¾ä¸çï¼</p>
<p>å¨kv-coreçappåéé¢</p>
<pre><code class="language-java">public static void main(String[] args) {
    int port = getPort(args);
    RaftNettyServer raftNettyServer = new RaftNettyServer(port);
    try {
        raftNettyServer.start();
    } catch (InterruptedException e) {
        throw new RuntimeException(e);
    }
}

private static int getPort(String[] args) {
    for (String arg : args) {
        if (arg.startsWith("node.port=")) {
            return Integer.parseInt(arg.substring(10));
        }
    }
    return 7777;
}
</code></pre>
<p>ä»javaç¨åºå¯å¨çå½ä»¤è¡è¯»åç»ç¹çç«¯å£åæ°ï¼æä»¬å¯ä»¥ç¨ä¸å°çµèå¼å¯å¤ä¸ªåºç¨ï¼å¨ideaä¸­è¿æ ·éç½®å°±å¯ä»¥äºï¼å¦ä¸å¾æç¤º</p>
<img src="https://img2024.cnblogs.com/blog/2358057/202602/2358057-20260211194613557-847947640.png" style="zoom: 50%">
<p>ä»ä¸å¾ä¸­å¯ä»¥çå°ï¼éç½®äºä¸ä¸ªèç¹ï¼ç¶åæ¬é¡¹ç®çjdkæ¯éç¨ç21è¿ä¸ªçæ¬ãéç½®å¥½äºä¹åï¼å¨ideaçserviceséé¢å¯ä»¥æè¿äºéç½®ä¸èµ·å è¿å»ï¼ç¶åå°±å¯ä»¥åæ¶å¯å¨å¤ä¸ªèç¹äºã</p>
<h3 id="222-è¿æ¥è®¾è®¡">2.2.2 è¿æ¥è®¾è®¡</h3>
<pre><code class="language-java">RaftNettyServer raftNettyServer = new RaftNettyServer(port);
...
raftNettyServer.start();
</code></pre>
<p>ä»ä¸ä¸èçå¯å¨ç±»çåºæ¥ä¸»è¦å°±æ¯newäºä¸ä¸ªserverå¯¹è±¡ï¼ç¶åè°ç¨startæ¹æ³ãæä»¬é¡ºçè¿ä¸¤ä¸ªçå°±å¯ä»¥äºã</p>
<p>é¦åæ¯æé æ¹æ³ï¼</p>
<pre><code class="language-java">public class RaftNettyServer {
  	....
    private final int port;
    private final RaftNode node;

    public RaftNettyServer(int port) {
        this.port = port;
         // è¿éåå»ºäºä¸ä¸ªraftç»ç¹å¯¹è±¡
        this.node = new RaftNode(port);
    }
}

// è¿ä¸ªæ¯RaftNodeç±»ï¼
public RaftNode(int port) {
    this.port = port;

    // ä»éç½®æä»¶ä¸­æ¾å°èªå·±
    this.nodesConfig = new NodesConfig();
    this.nodeId = nodesConfig.findSelf(port);

    // éè¦æèªèº«ç»ç¹
    this.rpcPeers = nodesConfig.getNodeList().stream()
        // nodeçæ ¼å¼æ¯'ip:port'
        .map(node -&gt; new RpcPeer(node, node.split(":")[0],
                                 Integer.parseInt(node.split(":")[1]), this))
        .toList();

    this.logManager = new LogManager();
    this.storage = new MemoryStorage();

    // æä¸¤ä¸ªæ¶é´ååå§åå¯
    this.electionTimeout = 8000 + ThreadLocalRandom.current().nextInt(4000);
    this.lastHeartbeatTime = System.currentTimeMillis();
    log.info("åå§åéä¸¾è¶æ¶ï¼{}", electionTimeout);

    // å®æ¶å¨
    scheduler = Executors.newScheduledThreadPool(2);
    scheduler.scheduleAtFixedRate(this::tick, 2, 2000, TimeUnit.MILLISECONDS);
}
</code></pre>
<p>Raftç±»æ¯ææ ¸å¿çä¸ä¸ªç±»ãä¸é¢çæé æ¹æ³å¶å®å¾ç®åãè¯»èèªè¡çè§£ãéè¦è¯´æä¸ä¸çå°±æ¯nodeIdçæ ¼å¼ï¼ãip:ç«¯å£ã</p>
<pre><code class="language-java">127.0.0.1:8888 // å°±æ¯è¿ç§å­ç¬¦ä¸²çæ ¼å¼
</code></pre>
<p>è¿æè¦è¯´æçå°±æ¯rpcPeersè¿ä¸ªListçæå»ºï¼å¯ä»¥çåºæ¥åæ¯ä»éç½®æä»¶è¯»åå°äºéç¾¤èç¹åè¡¨ï¼ç¶åéåè¿ä¸ªåè¡¨åå»ºäºå¯¹è±¡ï¼è¿ä¸ªå·ä½æ¯ä»ä¹ææå¢ï¼</p>
<p>é¦åçä¸ä¸Nettyçå®¢æ·ç«¯åéè¯·æ±å°æå¡ç«¯ï¼æå¡ç«¯å¤çåå¨è¿åç»å®¢æ·ç«¯ï¼å®¢æ·ç«¯æ ¹æ®ååºç»æè¿è¡é»è¾å¤çãè¿æ ·ä¸ä¸ªç¤ºæå¾ï¼</p>
<img src="https://img2024.cnblogs.com/blog/2358057/202602/2358057-20260211194613912-363189595.png" style="zoom: 50%">
<p>åçä¸ä¸ä¸é¢çè¿æ¥ç¤ºæå¾ï¼</p>
<img src="https://img2024.cnblogs.com/blog/2358057/202602/2358057-20260211194614275-746707923.png" style="zoom: 50%">
<p>NettyClientä¸ä»ä»æ¯ç»å®¢æ·ç¨çï¼éç¾¤ç»ç¹åé¨äºç¸éä¿¡ä¹è¦ç¨å°è¿ä¸ªï¼rpcPeerså°±æ¯éç¾¤èç¹åé¨éä¿¡ä½¿ç¨çãå¦ä¸å¾æç¤ºï¼æ¯ä¸ªèç¹é½æä¸ä¸ªNettyServerå¯å¨å¹¶çå¬çç«¯å£ï¼åæ¶Leaderç»ç¹éè¦ç»ææçFollowerç»ç¹åéå¿è·³è¯·æ±ï¼æ­¤æ¶è¿ä¸ªLeaderç¸å½äºå¶ä»ä¸¤ä¸ªFollowerç»ç¹å°±ç¸å½äºClientäºï¼æä»¥å¨ç»ç¹ä¸éé¢æclientçé¨åï¼å¨é¡¹ç®å½å°äºrpcçåä¸ï¼ä¹å°±æ¯ä¸é¢é£ä¸ªrpcPeersçç±æ¥äºã</p>
<p>å¨éç¾¤å¯å¨çæ¶åï¼é½æ¯Followerç»ç¹ï¼åªæç­å°è¶æ¶äºæä¼å¼å§éä¸»ï¼å¨æ­¤ä¹åï¼æ¯ä¸ªèç¹é½ææä¸ºCandidateçå¯è½ï¼ä¹å°±æ¯è¯´æ¯ä¸ªèç¹é½æåå¶ä»ç»ç¹åéæç¥¨è¯·æ±çå¯è½ï¼VoteRequestï¼ï¼é£ä¹æ¯ä¸ªèç¹éé¢é½è¦æä¸å¥Netty Clientåå¤çæµç¨ãå°±å¦ä¸å¾æç¤ºï¼</p>
<img src="https://img2024.cnblogs.com/blog/2358057/202602/2358057-20260211194614720-1938302844.png" style="zoom: 50%">
<p>è¿æ ·å°±æä¸ä¸ªé®é¢äºï¼ä¸ä¸ªèç¹ï¼æå°±è¦å­ä¸ªtcpè¿æ¥äºï¼åä¸ªèç¹å°±è¦12ä¸ªè¿æ¥ï¼åä¸ªèç¹å¢ï¼å°±è¦90ä¸ªè¿æ¥ï¼è¿ä¹å¤ªå¤äºå§ï¼é£ä¹ç¡®å®æ¯çãæä¸ä¸ªæè·¯æ¯æä¸ä¸ªä¸­é´å±å«årouteCenterï¼ææç»ç¹è¿åå®ï¼ç¶åæ¶æ¯é½ç»è¿è¿ä¸ªè·¯ç±ä¸­å¿æ¥è½¬åï¼è¿æ ·è¿æ¥æ°å°±ä¼å°å¾å¤äºã</p>
<p>è¿æä¸ä¸ªæè·¯ï¼åæ­£NettyClient + ä¸ä¸ªNettyServeræå»ºåºä¸ä¸ªChannelï¼çè®ºä¸æåªéè¦ä¸ä¸ªtcpè¿æ¥å°±å¯ä»¥äºåãå¦ä¸å¾æç¤ºï¼</p>
<img src="https://img2024.cnblogs.com/blog/2358057/202602/2358057-20260211194615069-208910434.png" style="zoom: 50%">
<p>ä½æ¯è¿æ ·çè¯ï¼èç¹é´éä¿¡éè¦è½¬åäºï¼ä»£ç é»è¾å°±å¤ªå¤æäºï¼åµä¸è¿æä¸ä¸ªé®é¢ï¼é£å°±æ¯å¦ä½ç¡®å®è¿ä¸ªtcpçè¿æ¥é¡ºåºå¢ï¼è¿ä¸ªå¯ä»¥æç§nodeIdçå­å¸é¡ºåºæ¥åãåæ­£å°±æ¯éº»ç¦å°±å®äºå¿äºããã</p>
<p>ç»¼ä¸æè¿°ï¼è¿æ¯æå¼å§çæ¹æ¡æç®åç´æ¥äºï¼åæ­£è¿å°±æ¯ä¸ä¸ªç®æçæ¡ä¾ï¼ä¸è¦èèå¤ªå¤äºãå¦ææä¸äºå¶ä»åéçæè·¯ï¼æ¬¢è¿è¯»èç»åºã</p>
<p>èç¹ä¹é´çè¿æ¥è®¾è®¡å°±æ¯ä¸é¢çæ ·å­äºã</p>
<p>æ¥ä¸æ¥çRaftNodeçè®¾è®¡ã</p>
<h3 id="223-raftnodeè®¾è®¡">2.2.3 RaftNodeè®¾è®¡</h3>
<p>é£å°±ä»æé å¨å¼å§çå§ï¼</p>
<pre><code class="language-java">public RaftNode(int port) {
    this.port = port;

    // ä»éç½®æä»¶ä¸­æ¾å°èªå·±
    this.nodesConfig = new NodesConfig();
    this.nodeId = nodesConfig.findSelf(port);

    // éè¦æèªèº«ç»ç¹
    this.rpcPeers = nodesConfig.getNodeList().stream()
        // nodeçæ ¼å¼æ¯'ip:port'
        .map(node -&gt; new RpcPeer(node, node.split(":")[0],
                                 Integer.parseInt(node.split(":")[1]), this))
        .toList();

    this.logManager = new LogManager();
    this.storage = new MemoryStorage();

    // æä¸¤ä¸ªæ¶é´ååå§åå¯
    this.electionTimeout = 8000 + ThreadLocalRandom.current().nextInt(4000);
    this.lastHeartbeatTime = System.currentTimeMillis();
    log.info("åå§åéä¸¾è¶æ¶ï¼{}", electionTimeout);

    // å®æ¶å¨
    scheduler = Executors.newScheduledThreadPool(2);
    scheduler.scheduleAtFixedRate(this::tick, 2, 2000, TimeUnit.MILLISECONDS);
}
</code></pre>
<p>å¯ä»¥çå°é½æ¯åä¸äºåå§åçå·¥ä½ï¼ç¶åä¸é¢æ¯å¼å¯äºä¸ä¸ªå®æ¶ä»»å¡tick</p>
<pre><code class="language-java">private void tick() {
    log.info("æ£æ¥æ¯å¦è¶æ¶ï¼{} ç¶æ: {}", nodeId, state);
    try {
        if (state != NodeState.LEADER &amp;&amp; isTimeout()) {
            becomeCandidate();
        } else if (state == NodeState.LEADER) {
            // sendHeartbeats();
        }
    } catch ( Exception e ) {
        log.error("{} èç¹tickå®æ¶ä»»å¡å¼å¸¸", nodeId, e);
    }
}
private void becomeCandidate() {
    log.info("{} éä¸¾è¶æ¶ï¼è½¬ä¸º Candidateï¼å¼å§ä»»æ: {}", nodeId, currentTerm.get() + 1);
    state = NodeState.CANDIDATE;
    currentTerm.getAndIncrement(); // ä»»æ+1
    votedFor = nodeId; // ç»èªå·±æä¸ç¥¨
    resetElectionTimeout();
    // éç¾¤åéæç¥¨è¯·æ±
    requestVotes();
}
 private boolean isTimeout() {
     return System.currentTimeMillis() - lastHeartbeatTime &gt; electionTimeout;
 }
private void resetElectionTimeout() {
    // 8000ms ~ 12000ms éæºè¶æ¶ï¼é¿åå¹³ç¥¨
    this.electionTimeout = 8000 + ThreadLocalRandom.current().nextInt(4000);
    log.info("éç½® {} èç¹éä¸¾æ¶é´ï¼éæºè¶æ¶ï¼{} ms", nodeId, electionTimeout);
    this.lastHeartbeatTime = System.currentTimeMillis();
}
</code></pre>
<p>ä¸»è¦å°±æ¯çbecomeCandidateè¿ä¸ªæ¹æ³æåçåéç¾¤åéæç¥¨è¯·æ±ã</p>
<pre><code class="language-java">private void requestVotes() {
    // 1. åå§åç¥¨æ°ï¼èªå·±çä¸ç¥¨
    AtomicInteger grantedVotes = new AtomicInteger(1);
    long count = rpcPeers.stream().filter(peer -&gt; !peer.isSelf()).count(); // ä¸åå«èªå·±çç»ç¹æ°
    int majority = (int) ((count + 1) / 2 + 1); // æ»èç¹æ°(åå«èªå·±)çåæ°ä»¥ä¸

    // 2.æé æç¥¨æ¶æ¯
    KvRaftProto.VoteRequest voteRequest = KvRaftProto.VoteRequest.newBuilder()
        .setTerm(currentTerm.get())
        .setCandidateId(nodeId)
        .setLastLogIndex(logManager.getLastLogIndex())
        .setLastLogTerm(logManager.getLastLogTerm())
        .build();
    // 3. åéæç¥¨è¯·æ±
    // æå»ºä¸ä¸ªå¯¹è±¡ï¼è¡¨ç¤ºå½åæç¥¨è¯·æ±çç¶æ
    // String voteId = UUID.randomUUID().toString().replaceAll("-", "");
    // è¿éä¸ºä»ä¹å¯ä»¥ç¨termï¼å ä¸º Raft è§å®ï¼ä¸ä¸ªèç¹å¨ä¸ä¸ª term ååªè½æä¸å¼ ç¥¨ã
    // æä»¥ï¼åªè¦ term å¹éï¼è¿ä¸ªååºå°±ä¸å®æ¯éå¯¹ä½ å½ååèµ·çè¿ä¸è½®éä¸¾çã
    GlobalVoteManager.setVoteState(currentTerm.get(), new VoteState(nodeId, currentTerm.get(), majority));

    int countSend = 0;
    for (RpcPeer peer : rpcPeers) {
        if (!peer.isSelf()) { // ä¸æ¯èªèº«ç»ç¹ï¼å°±åéæç¥¨è¯·æ±
            // sendæ¹æ³å°±å¾ç®åäºï¼è¯·è¯»èèªè¡æ¥ç
            boolean send = peer.send(KvRaftProto.RaftKvMessage.newBuilder()
                                     .setType(KvRaftProto.RaftKvMessage.MessageType.VOTE_REQUEST)
                                     .setVoteRequest(voteRequest)
                                     .build());
            if ( send ) countSend++;
        }
    }
    log.info("åéæç¥¨è¯·æ±ï¼{}ï¼å·²åéç»äº {} ä¸ªç»ç¹..", voteRequest, countSend);
}
</code></pre>
<p>è¿æ ·æç¥¨è¯·æ±å°±åéåºå»äºï¼æ­¤æ¶ç»ç¹æ¯ä½ä¸ºå®¢æ·ç«¯åéç»å¶ä»èç¹çï¼æ¥ä¸æ¥çé»è¾å°±æ¯å¶ä»èç¹æ¥æ¶å°voteRequestè¯·æ±ç¶ååé»è¾å¤çï¼æä»¥å°±è¦å¨serveråä¸é¢å»æ¥çå·ä½é»è¾ã</p>
<pre><code class="language-java">// å¨kv-coreçserveråä¸é¢çKvBusinessHandler.java
// 1.å¦ææ¯æç¥¨è¯·æ±
if ( raftKvMessage.getType() == KvRaftProto.RaftKvMessage.MessageType.VOTE_REQUEST) {
    log.info("receive vote request.........");
    KvRaftProto.VoteRequest voteRequest = raftKvMessage.getVoteRequest();
    // å¯ä»¥çå°äº¤ç»äºnodeå»å¤ç
    KvRaftProto.VoteResponse voteResponse = node.tackleVoteRequest(voteRequest);
    ctx.writeAndFlush(KvRaftProto.RaftKvMessage.newBuilder()
                      .setType(KvRaftProto.RaftKvMessage.MessageType.VOTE_RESPONSE)
                      .setVoteResponse(voteResponse)
                      .build());
}

// ååå°äºRaftNodeç±»äº
public KvRaftProto.VoteResponse tackleVoteRequest(KvRaftProto.VoteRequest voteRequest) {
    // æ¯è¾ä»»æ
    if (voteRequest.getTerm() &lt; currentTerm.get()) {
        log.info("{} æç¥¨è¯·æ±ä»»æå¤ªå°ï¼æç»æç¥¨", nodeId);
        return buildVoteResponse(false, currentTerm.get());
    }
    if ( votedFor != null &amp;&amp; !voteRequest.getCandidateId().equals(votedFor) ) {
        log.info("{}å·²æç»å¶ä»äººï¼æç»è¯¥æç¥¨è¯·æ±", nodeId);
        return buildVoteResponse(false, currentTerm.get());
    }
    // åæ¯è¾æ¥å¿æåµ
    if ( voteRequest.getLastLogIndex() &gt;= logManager.getLastLogIndex() &amp;&amp;
        voteRequest.getLastLogTerm() &gt;= logManager.getLastLogTerm() ) {
        log.info("{} æç¥¨è¯·æ±okï¼èµææç¥¨", nodeId);
        currentTerm.set(voteRequest.getTerm()); // æ´æ°èªå·±çä»»æ
        votedFor = voteRequest.getCandidateId(); // æç¥¨ç»è¯¥èç¹
        return buildVoteResponse(true, voteRequest.getTerm());
    }
    log.info("{} æç¥¨è¯·æ±æ¥å¿å¤ªæ§ï¼æç»è¯¥æç¥¨è¯·æ±", nodeId);
    return buildVoteResponse(false, currentTerm.get());
}
</code></pre>
<p>å¶ä»èç¹æ¶å°äºæç¥¨è¯·æ±ï¼ä¼è¿åresponseç»candidateç»ç¹ï¼candidateç»ç¹æ¯ä½ä¸ºClientåéçæç¥¨è¯·æ±ï¼æ¶å°çååºè¯å®æ¯å¨å®¢æ·ç«¯çå¤çå¨handlerï¼æ¥ä¸æ¥çé»è¾å°±è¦å¨rpcåä¸é¢çRpcClientHandlerå»æ¥çäºï¼</p>
<pre><code class="language-java">@Override
protected void channelRead0(ChannelHandlerContext ctx, KvRaftProto.RaftKvMessage msg) {
    // 2.VOTE_RESPONSE æç¥¨è¯·æ±åæ¥çååºãæç¥¨è¯·æ±æ¯ç»ç¹ä½ä¸ºå®¢æ·ç«¯ååºçï¼åºè¯¥å¨å®¢æ·ç«¯çhandlerå¤çååºã
    if (msg.getType() == KvRaftProto.RaftKvMessage.MessageType.VOTE_RESPONSE) {
        log.info("receive vote response.........");
        KvRaftProto.VoteResponse voteResponse = msg.getVoteResponse();
        raftNode.tackleVoteResponse(voteResponse); // ååå°äºRaftNode
    }
}

// RaftNode.java
// æç¥¨ç»æå¤ç,ãæç¥¨è¯·æ±æ¯ç»ç¹ä½ä¸ºå®¢æ·ç«¯ååºçï¼è¦å¨å®¢æ·ç«¯çhandlerå¤çååºã
public synchronized void tackleVoteResponse(KvRaftProto.VoteResponse voteResponse) {
    long term = voteResponse.getTerm();
    // 2. åç°æ´é«ä»»æï¼ç«å³éçº§å¹¶æ´æ°
    // 1. ä»»ææ£æ¥ï¼å¯¹æ¹æ¯æå¤§ï¼æç«å³è®¤è¾
    if (term &gt; currentTerm.get()) {
        stepDown(term);
        return;
    }
    // 2. ç¶ææ£æ¥ï¼å¦ææå·²ç»ä¸æ¯ Candidate äºï¼æ¯å¦å·²ç»è¶æ¶ééææ¶å°å¿è·³ï¼ï¼å¿½ç¥
    if (state != NodeState.CANDIDATE) return;

    // 3. ä»»æå¹éæ£æ¥ï¼ç¡®ä¿è¿æ¯å¯¹âå½åè¿ä¸è½®âéä¸¾çåå¤
    // å¦ææ¶å°çååºä»»ææ¯å½åå°ï¼è¯´ææ¯ä¹åè¿æçéä¸¾åå¤ï¼ç´æ¥ä¸¢å¼
    if (term &lt; currentTerm.get()) {
        return;
    }

    // 4. ä»å¨å±ç®¡çå¨è·åå½åéä¸¾çæç¥¨ç¶æ
    VoteState voteState = GlobalVoteManager.getVoteState(term);
    if (voteState == null) {
        log.error("æªæ¾å°ä»»æ {} çæç¥¨è®°å½ç¶æ", term);
        return;
    }

    // 5. å¦æå¯¹æ¹æäºèµæç¥¨
    if (voteResponse.getVoteGranted()) {
        // å¢å ç¥¨æ°ï¼è¿é AtomicInteger å¨ VoteState åé¨ä¿è¯äºçº¿ç¨å®å¨ï¼
        // ä½ç±äºæ¬æ¹æ³å äº synchronizedï¼å¶å®åéä¿é©ï¼
        int currentVotes = voteState.addVote();
        int majority = voteState.getMajority();
        log.info("èµæç¥¨ï¼å½åç¥¨æ°: {}/{}", currentVotes, nodesConfig.getNodeList().size());

        // 6. æ£æ¥æ¯å¦è¾¾å°å¤æ°æ´¾
        if (currentVotes &gt;= majority) {
            log.info("èç¹ {} è·å¾è¿åéç¥¨ ({})ï¼åå¤æåä¸º Leader", nodeId, currentVotes);
            becomeLeader();
        }
    } else {
        log.info("æç»äºæçæç¥¨è¯·æ±");
    }
}
private synchronized void becomeLeader() {
    if (state != NodeState.CANDIDATE) return;
    if (state == NodeState.LEADER) return;

    this.state = NodeState.LEADER;
    log.info("Node {} èµ¢å¾éä¸¾ï¼å³å°æä¸º Leader, Term: {}", nodeId, currentTerm.get());
    // 1. æ¸çä¸ä¸ä»»æçæ®çç¶æ
    this.votedFor = null;

    // 2. ç«å³åéç¬¬ä¸æ³¢å¿è·³ï¼å®£ç¤ºä¸»æ (é²æ­¢å¶ä»èç¹åè¶æ¶)
    sendHeartbeats();

    // 3. å¯å¨å®æ¶å¿è·³ä»»å¡ (æ¯å¦æ¯ 2 ç§ä¸æ¬¡)
    if (heartbeatTask != null) heartbeatTask.cancel(true);
    heartbeatTask = scheduler.scheduleAtFixedRate(this::sendHeartbeats,
                                                  0, 1000, TimeUnit.MILLISECONDS);
    log.info("&lt;&lt;&lt;&lt;&lt; èç¹ {} æ­£å¼æä¸º Term {} ç Leader &gt;&gt;&gt;&gt;&gt;", nodeId, currentTerm.get());
}
</code></pre>
<h1 id="3å¯å¨æµè¯éä¸»">3.å¯å¨æµè¯éä¸»</h1>
<p>æéç½®å¥½çä¸ä¸ªèç¹å¯å¨ä¸ä¸ççç»æ</p>
<p><img src="https://img2024.cnblogs.com/blog/2358057/202602/2358057-20260211194611564-1443963355.png" alt="" loading="lazy"></p>
<hr>
<p><img src="https://img2024.cnblogs.com/blog/2358057/202602/2358057-20260211194612379-843476723.png" alt="" loading="lazy"></p>
<hr>
<p><img src="https://img2024.cnblogs.com/blog/2358057/202602/2358057-20260211194612841-1185877353.png" alt="" loading="lazy"></p>
<p>ä»ä¸å¾å¯ä»¥çåºï¼ç«¯å£9999æä¸ºäºLeaderç»ç¹ï¼ç¶ååå¶ä»èç¹åéå¿è·³æ°æ®äºã</p>
<p>æ¥ä¸æ¥å°±æ¯å®åä¸ä¸æ¥å¿ååé£äºé»è¾äºã</p>
<h1 id="end-åè">end. åè</h1>
<ol>
<li><a href="http://thinkinjava.cn/2019/01/12/2019/2019-01-12-lu-raft-kv/#%E4%BB%80%E4%B9%88%E6%98%AF-Java-%E7%89%88-Raft-%E5%88%86%E5%B8%83%E5%BC%8F-KV-%E5%AD%98%E5%82%A8" target="_blank" rel="noopener nofollow">http://thinkinjava.cn/2019/01/12/2019/2019-01-12-lu-raft-kv/#ä»ä¹æ¯-Java-ç-Raft-åå¸å¼-KV-å­å¨</a></li>
<li><a href="https://github.com/stateIs0/lu-raft-kv" target="_blank" rel="noopener nofollow">https://github.com/stateIs0/lu-raft-kv</a></li>
</ol>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-11 19:47">2026-02-11 19:47</span>&nbsp;
<a href="https://www.cnblogs.com/jackjavacpp">å«æ¥æ æâ²</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19605754);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19605754', targetLink: 'https://www.cnblogs.com/jackjavacpp/p/19605754', title: 'ç®æçåå¸å¼kvè®¾è®¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ¨¡åè¯ä¼°å°åï¼1ï¼ ROC æ²çº¿ä¸ AUC ]]></title>
    <link>https://www.cnblogs.com/Goblinscholar/p/19605705</link>
    <guid>15558a1eb64188dca62eb459485a4e4d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Goblinscholar/p/19605705" title="åå¸äº 2026-02-11 19:19">
    <span role="heading" aria-level="2">æ¨¡åè¯ä¼°å°åï¼1ï¼ ROC æ²çº¿ä¸ AUC</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>ä¸ç¹åè¨ï¼ä¹åå®æäºå´æ©è¾¾æ·±åº¦å­¦ä¹ çç¸å³åå®¹ï¼æè¿å¿äºæ¯è®¾ï¼æ´æ°å¯è½æ²¡ä¹åé£ä¹é¢ç¹ãè¿ä¸ªæ°å¼çåç±»å³äº<strong>æ¨¡åè¯ä¼°çåç§ææ </strong>çè¯¦è§£ï¼ä¹åç¿»çä¹¦ç±æ»æ¯è¢«ä¸å å¾å®æ¹åçæ¦å¿µåå¯å¯éº»éº»çç¬¦å·æççä¸ä¸å»ï¼å æ­¤ï¼è¿æ¬¡çä¸­å¿ææ³æ¯ä»¥å°½å¯è½<strong>éä¿çè¯­è¨ãç²¾ç®çç¯å¹</strong>æ¥è®²è§£è¿ç±»æ¦å¿µå¹¶è¾ä»¥å®ä¾ã<br>
ä¸å¤åºè¯ï¼ä»¥ä¸ä¸ºæ­£æã</p>
<hr>
<h1 id="1-æ£æµé®é¢ä¸­çä¸¤é¾ææ¯">1. æ£æµé®é¢ä¸­çâä¸¤é¾ææ¯â</h1>
<p>åè®¾æä»¬å¨æºåºè´è´£å®æ£ãä»»å¡å¾ç®åï¼<strong>ææºå¸¦å±é©ç©åçäººæ¦ä¸æ¥ã</strong></p>
<p>ä½ç°å®è¿æ²¡æè¿ä¹ç®åï¼å¦ææä»¬æå®æ£<strong>æ åå®å¾éå¸¸ä¸¥æ ¼</strong>ââä¸ç¹å¯çé½ä¸æ¾è¿ï¼é£ä¹ç¡®å®å¯ä»¥æ¦ä¸å ä¹ææå±é©äººåã<br>
ä½ä»£ä»·æ¯ï¼<strong>æ­£å¸¸æå®¢ä¹ä¼è¢«é¢ç¹æ¦ä¸å¤æ£</strong>ï¼éä¼æå°å¤§åå¤ã</p>
<p>èå¦ææä»¬<strong>ææ åæ¾å®½</strong>ââåªå¨éå¸¸ææ¾çæåµä¸ææ¦äººï¼æå®¢éè¡æçä¼æé«ã<br>
ä½æ¾ç¶ï¼è¿å°±<strong>ææ´å¤§å¯è½æ¼æçæ­£çé£é©</strong>ã</p>
<p>è¿å°±æ¯ä¸ä¸ªç»å¸çä¸¤é¾ï¼<strong>éæ©æéè¿æ¯æ¾è¿</strong>ï¼</p>
<blockquote>
<p><strong>æå¾è¶å¤ï¼éæä¹è¶å¤ã</strong><br>
<strong>æå¾è¶å°ï¼æ¼æå°±è¶å¤ã</strong></p>
</blockquote>
<p><img src="https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260211191745572-2075288255.png" alt="f2bc31dc-fe19-439e-a7a0-4efb06659caf.png" loading="lazy"></p>
<p>ç®æ æ£æµé®é¢æ¬è´¨ä¸ä¹æ¯å¦æ­¤ï¼å¨é«åè°±ç®æ æ£æµãé·è¾¾æ¢æµãå¼å¸¸æ£æµç­ç®æ æ£æµä»»å¡ä¸­ï¼æä»¬é¢å¯¹çä¸æ¯âå¯¹æéâè¿ä¹ç®åï¼èæ¯<strong>å¨ä»»å¡ææ¯ä¸­ï¼å¯¹âéæ¥âåâæ¼æ¥âçæè¡¡éæ©</strong>ï¼</p>
<blockquote>
<p><strong>æçæ¨¡åï¼è½æ£æµåºå¤å°çå®ç®æ ï¼ä½åæ¶ä¼è¯¯æ¥å¤å°èæ¯ï¼æçä»»å¡è¦æ±ææ´åååªè¾¹ï¼å¨åªéäºèè¾ä¸ºåè¡¡ï¼</strong></p>
</blockquote>
<p>æ»ä¹ï¼å¨æ£æµç³»ç»ä¸­ï¼æ²¡æåè´¹çåé¤ï¼æé«æ£æµçï¼å¾å¾è¦ä»åºèè­¦ççä»£ä»·ã<br>
ROC æ²çº¿æè¿°çï¼æ­£æ¯è¿ä¸¤èä¹é´çå³ç³»ã</p>
<h1 id="2-rocreceiver-operating-characteristic">2. ROCï¼Receiver Operating Characteristicï¼</h1>
<p>ROC çè±æå¨ç§°ä¸º <strong>Receiver Operating Characteristic</strong> ï¼ç´è¯ä¸ºåè¯èå·¥ä½ç¹å¾æ²çº¿ï¼å®æ¥æºäº<strong>ç»è®¡å­¦ä¸­çæ£æµçè®º</strong>ï¼èææ©çåºç¨é¢åæ¯<strong>é·è¾¾æ¢æµ</strong>ã</p>
<p>ä¸åäºä¸äºå¸¸è§ææ ï¼<strong>ROC å»ç»çæ¯èè­¦æ¦çåæ£æµæ¦çé´çå½æ°å³ç³»</strong>ã<br>
ç´æ¥æ¥çä¸ä¸ªå®ä¾ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260211191746062-1023289789.png" alt="image.png" loading="lazy"><br>
ç°å¨ï¼åè®¾ä¸å¤©æ <strong>100 ä¸ªæºå¸¦å±é©ç©åçæå®¢</strong>å <strong>1000 ä¸ªæ®éæå®¢</strong>ï¼</p>
<p>1.<strong>çé³æ§çï¼TPR / Pdï¼</strong>ï¼ç³»ç»è½æ­£ç¡®æä½çæ­£å±é©æå®¢çæ¯ä¾ï¼å³âè¯¥æçæäºå¤å°âã<br>
2.<strong>åé³æ§çï¼FPR / Faï¼</strong>ï¼ç³»ç»ææ®éæå®¢è¯¯å¤ä¸ºå±é©æå®¢çæ¯ä¾ï¼å³âä¸è¯¥æçæéäºå¤å°âã</p>
<table>
<thead>
<tr>
<th>æ®éæå®¢æ°é</th>
<th>å±é©æå®¢æ°é</th>
<th>éè¿ / æ­£å¸¸æ°é</th>
<th>æå°æ°é</th>
<th>ææ åè®¡ç®è¿ç¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>â</td>
<td>100</td>
<td>3 æ¼æ</td>
<td>97  æå°</td>
<td><strong>çé³æ§ç Pd = 97 / 100 = 0.97 (97%)</strong></td>
</tr>
<tr>
<td>1000</td>
<td>â</td>
<td>800 æ­£å¸¸éè¿</td>
<td>200 è¯¯æ</td>
<td><strong>åé³æ§ç Fa = 200 / 1000 = 0.2 (20%)</strong></td>
</tr>
</tbody>
</table>
<p>å®éä¸äºèçè®¡ç®è¿æ¯å¯¹åç±»åºç¡ç»è®¡éçåºç¨ã<br>
è¿æ ·ï¼æä»¬å°±å¾å°äº ROC æ²çº¿ä¸­çä¸ä¸ªç¹ï¼<span class="math inline">\((0.2,0.97)\)</span> ï¼æä»¬ç§°ä¹ä¸º<strong>Pd @ Fa æ Pd / Fa</strong> ï¼å®è¯´æäº<strong>å¨ç¹å®èè­¦çä¸è½æå°å¤å°ç®æ </strong>ï¼å±å¼å¦ä¸ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260211191743792-444019702.png" alt="image.png" loading="lazy"><br>
å°è¿éï¼å°±ä¼åç°ï¼ <strong>ROC æ²çº¿ä¸­çä¸ä¸ªç¹å°±æ¯ä¸ç§å³ç­éå¼ä¸çæ¨¡åè¡¨ç°ã</strong><br>
æä»¬ä¸æ­æµè¯ä¸åçéå¼è®¡ç®ï¼æç»å°±ä¼å¾å° ROC æ²çº¿ï¼åä¸¾å ç§æåµå¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>éå¼ t</th>
<th>å¤å®è§å</th>
<th>å±é©æå®¢æå°æåµ (Pd)</th>
<th>æ®éæå®¢è¯¯ææåµ (Fa)</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.8</td>
<td>åªææ¦ç â¥ 0.8 å¤ä¸ºå±é©</td>
<td>80 / 100 = 0.80</td>
<td>50 / 1000 = 0.05</td>
<td>ä¸¥æ ¼å¤å®ï¼åªææææ¾çå±é©æå®¢ï¼èè­¦å¾å°</td>
</tr>
<tr>
<td>0.5</td>
<td>æ¦ç â¥ 0.5 å¤ä¸ºå±é©</td>
<td>95 / 100 = 0.95</td>
<td>200 / 1000 = 0.20</td>
<td>ä¸­ç­å¤å®ï¼æå°å¤§é¨åå±é©æå®¢ï¼èè­¦éä¸­</td>
</tr>
<tr>
<td>0.3</td>
<td>æ¦ç â¥ 0.3 å¤ä¸ºå±é©</td>
<td>99 / 100 = 0.99</td>
<td>400 / 1000 = 0.40</td>
<td>å®½æ¾å¤å®ï¼å ä¹æå°å¨é¨å±é©æå®¢ï¼ä½èè­¦ææ¾å¢å </td>
</tr>
<tr>
<td>0.1</td>
<td>æ¦ç â¥ 0.1 å¤ä¸ºå±é©</td>
<td>100 / 100 = 1.00</td>
<td>800 / 1000 = 0.80</td>
<td>æåº¦å®½æ¾ï¼æå°å¨é¨å±é©æå®¢ï¼ä½ç»å¤§é¨åæ®éæå®¢ä¹è¢«è¯¯æ</td>
</tr>
</tbody>
</table>
<p>è§å¯ä¸æ¥ï¼ä½ ä¼åç°ï¼<strong>è¯¯æ¥çè¶é«å¾å¾ä»£è¡¨éå¼è¶ä½ã</strong><br>
èå°äºè¿éï¼ä½ å¯è½ä¼æä¸ä¸ªé®é¢ï¼<strong>é£å¨å®éè¿è¡ä¸­ï¼ææ»ä¸è½ä¸ä¸ªä¸ªéå¼å»è¯å§ï¼è¦å¤å°æ¬¡æè½æ¼åºæ¥å®æ´æ²çº¿ï¼</strong></p>
<p>å®éä¸ï¼æä»¬<strong>å¨çå®è¿è¡ä¸­åªéè¦è¿è¡ä¸æ¬¡æ¨¡åå°±å¯ä»¥å¾å°å®æ´ ROC æ²çº¿ã</strong><br>
<strong>ç¨ä¸å¥è¯æ¦æ¬å¶ç®æ³ï¼å­å¨æ¨¡åå¯¹æ¯ä¸ªæ ·æ¬çè¾åºæ¦çå¹¶æåºï¼ä»é«å°ä½ä¾æ¬¡ç¡®è®¤ä¸ºæ­£ç±»ï¼ææï¼å¹¶è®¡ç® Pd @ Fa ï¼å å¥å¾åã</strong><br>
æ¥çä¸ªä¾å­ï¼</p>
<table>
<thead>
<tr>
<th>æå</th>
<th>æå®¢ ID</th>
<th>æ¯å¦å±é©</th>
<th>æ¨¡åæ¦ç p</th>
<th>æ¨ä¸ªæ</th>
<th>ç´¯è®¡ TP</th>
<th>ç´¯è®¡ FP</th>
<th>Pd = TP / 3</th>
<th>Fa = FP / 7</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>A</td>
<td>â å±é©</td>
<td>0.95</td>
<td>æ</td>
<td>1</td>
<td>0</td>
<td>0.33</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>B</td>
<td>â æ®é</td>
<td>0.90</td>
<td>æ</td>
<td>1</td>
<td>1</td>
<td>0.33</td>
<td>0.14</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
<td>â å±é©</td>
<td>0.85</td>
<td>æ</td>
<td>2</td>
<td>1</td>
<td>0.67</td>
<td>0.14</td>
</tr>
<tr>
<td>4</td>
<td>D</td>
<td>â æ®é</td>
<td>0.70</td>
<td>æ</td>
<td>2</td>
<td>2</td>
<td>0.67</td>
<td>0.29</td>
</tr>
<tr>
<td>5</td>
<td>E</td>
<td>â æ®é</td>
<td>0.60</td>
<td>æ</td>
<td>2</td>
<td>3</td>
<td>0.67</td>
<td>0.43</td>
</tr>
<tr>
<td><strong>6</strong></td>
<td><strong>F</strong></td>
<td><strong>â å±é©</strong></td>
<td><strong>0.50</strong></td>
<td><strong>æ</strong></td>
<td><strong>3</strong></td>
<td><strong>3</strong></td>
<td><strong>1.00</strong></td>
<td><strong>0.43</strong></td>
</tr>
<tr>
<td>7</td>
<td>G</td>
<td>â æ®é</td>
<td>0.45</td>
<td>æ</td>
<td>3</td>
<td>4</td>
<td>1.00</td>
<td>0.57</td>
</tr>
<tr>
<td>8</td>
<td>H</td>
<td>â æ®é</td>
<td>0.30</td>
<td>æ</td>
<td>3</td>
<td>5</td>
<td>1.00</td>
<td>0.71</td>
</tr>
<tr>
<td>9</td>
<td>I</td>
<td>â æ®é</td>
<td>0.20</td>
<td>æ</td>
<td>3</td>
<td>6</td>
<td>1.00</td>
<td>0.86</td>
</tr>
<tr>
<td>10</td>
<td>J</td>
<td>â æ®é</td>
<td>0.10</td>
<td>æ</td>
<td>3</td>
<td>7</td>
<td>1.00</td>
<td>1.00</td>
</tr>
</tbody>
</table>
<p>å¨è¿éï¼<strong>å½ææå®¢Fæææ¶ï¼è®¡ç®å¾å°ç Pd @ Fa è¾ä¼ï¼ä¹å°±æ¯è¯´ï¼å¶å¯¹åºçæ¨¡åæ¦ç p=0.5 å°±æ¯ä¸ä¸ªå¯è½è¾ä¼çå³ç­éå¼éæ©ã</strong></p>
<p>å°è¿é ROC çåå®¹å°±åºæ¬ç»æï¼ä½æ¯ä½ ä¼åç°ï¼<strong>æ²çº¿éæåçä¸åéå¼çæåµäºï¼é£è¿ä¸ªæ¨¡åæ¬èº«å°åºå¥½ä¸å¥½ï¼æå¤å¥½ï¼è½ä¸è½ç»æä¸ä¸ªæç¡®çè¯ä¼°å¢ï¼</strong><br>
è¿å°±æ¯ä¸ ROC æ²çº¿ç¸å³èçåå®¹ï¼AUC ã</p>
<h1 id="3-aucarea-under-curve">3. AUCï¼Area Under Curveï¼</h1>
<p>AUC çå¨ç§°æ¯ Area Under Curveï¼ç´è¯å°±æ¯ROC æ²çº¿ä¸é¢ç§¯ãå®ç¨ä¸ä¸ª<strong>åä¸ææ </strong>æ¥è¡¡éæ¨¡åæ´ä½è½åã<br>
å¨å¾å° ROC æ²çº¿åï¼AUCçè®¡ç®éå¸¸ç®åï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260211191744270-1543306405.png" alt="image.png" loading="lazy"><br>
æ¾ç¶ï¼AUCé¢ç§¯è¶å¤§ï¼æ¨¡åè¶è½å¨ä½èè­¦çä¸å®ç°é«æ£æµçï¼æ¨¡åçæ£æµææå°±è¶å¥½ã<br>
å¹¶ä¸ï¼æä»¬ä¸éè¦æåéå®å³ç­éå¼ï¼å°±å¯ä»¥ç¥éæ¨¡åæ´ä½çå¥½åã</p>
<p>æ»ç»ä¸å¥è¯ï¼<strong>ROC åè¯æä»¬å¨ä¸åæ åä¸æ¨¡åè¡¨ç°å¦ä½ï¼è AUC åç»åºä¸ä¸ªæ´ä½è¯åï¼å®ç°ä¸ç¨ç¯çæ¯ä¸ªéå¼ä¹è½ç¥éæ¨¡åå¥½ä¸å¥½ï¼ä»èå¸®å©ç¸å³ä»»å¡çè°ä¼åé¨ç½²ã</strong></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-11 19:20">2026-02-11 19:19</span>&nbsp;
<a href="https://www.cnblogs.com/Goblinscholar">å¥å¸æå­¦è</a>&nbsp;
éè¯»(<span id="post_view_count">13</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19605705);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19605705', targetLink: 'https://www.cnblogs.com/Goblinscholar/p/19605705', title: 'æ¨¡åè¯ä¼°å°åï¼1ï¼ ROC æ²çº¿ä¸ AUC' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Codeforces Round 1078 (Div. 2) A,B,C,D,E,F1ä¸ªäººé¢è§£ ]]></title>
    <link>https://www.cnblogs.com/CUC-MenG/p/19605002</link>
    <guid>6fe1876ec031b7d78dfe5fc44881ede8</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/CUC-MenG/p/19605002" title="åå¸äº 2026-02-11 16:26">
    <span role="heading" aria-level="2">Codeforces Round 1078 (Div. 2) A,B,C,D,E,F1ä¸ªäººé¢è§£</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="a-å²èæº">A. <a href="https://codeforces.com/contest/2194/problem/A" target="_blank" rel="noopener nofollow">å²èæº</a></h1>
<ul>
<li>
<h1 id="æ°å­¦">æ°å­¦</h1>
</li>
</ul>
<p>æ¯ä¸ªæµè¯æ¶é´éå¶ï¼1ç§<br>
æ¯ä¸ªæµè¯åå­éå¶ï¼256åå­è</p>
<p>å¤å­£å«å¢çåºå£ç±ä¸éæ æ å´æï¼æ æ ç± <span class="math inline">\(n\)</span> åæ¨æ¿ç»æï¼æ¯åæ¨æ¿å®½ <span class="math inline">\(1\)</span> ç±³ãåºå£çå·¦å³ä¸¤ä¾§æ¯å¶ä»å°åçæ æ ãä¸ºäºå»ºé æµ´å®¤ï¼éè¦ç§»é¤æ æ ä¸­çä¸äºæ¨æ¿ï¼å¯è½æ¯å¨é¨æä¸åä¹ä¸ç§»é¤ï¼ï¼åæ¶å°åä¸æä¸å°èªå¨å²èæºï¼å¶å®½åº¦ä¸º <span class="math inline">\(w\)</span> ç±³ï¼ä¸ä¸è½éè¿æ æ ä¸çç¼ºå£ç¦»å¼å°åã</p>
<p>å¦æè¢«ç§»é¤çæ¨æ¿ç¼å·ä¸­ï¼å­å¨è³å° <span class="math inline">\(w\)</span> åè¿ç»­è¢«ç§»é¤çæ¨æ¿ï¼å²èæºå°±è½å¤ç¦»å¼å°åãè¯·ç¡®å®å¯ä»¥ä»æ æ ä¸­ç§»é¤çæå¤§æ¨æ¿æ°éã</p>
<h2 id="è¾å¥">è¾å¥</h2>
<p>æ¯ä¸ªæµè¯åå«å¤ä¸ªæµè¯ç¨ä¾ãç¬¬ä¸è¡åå«æµè¯ç¨ä¾çæ°é <span class="math inline">\(t\)</span>ï¼<span class="math inline">\(1 \le t \le 10^4\)</span>ï¼ãæ¥ä¸æ¥æ¯æ¯ä¸ªæµè¯ç¨ä¾çæè¿°ã</p>
<p>æ¯ä¸ªæµè¯ç¨ä¾ä»åå«ä¸è¡ï¼å¶ä¸­æä¸¤ä¸ªæ´æ° <span class="math inline">\(n\)</span> å <span class="math inline">\(w\)</span>ï¼<span class="math inline">\(1 \le n \le 10^9\)</span>ï¼<span class="math inline">\(1 \le w \le 10^9\)</span>ï¼ââåå«è¡¨ç¤ºæ æ ä¸­çæ¨æ¿æ°éåå²èæºçå®½åº¦ï¼ä»¥ç±³ä¸ºåä½ï¼ã</p>
<h2 id="è¾åº">è¾åº</h2>
<p>å¯¹äºæ¯ä¸ªæµè¯ç¨ä¾ï¼è¾åºä¸ä¸ªæ°å­ââå¯ä»¥ä»æ æ ä¸­ç§»é¤çæå¤§æ¨æ¿æ°éã</p>
<h2 id="æè·¯">æè·¯</h2>
<p>éè¿è§å¯ï¼å¯ä»¥è®¡ç®åºä¸­é´éè¦æ¾ç½®çæ æ æ<span class="math inline">\(\left\lfloor  \frac{n}{k}  \right\rfloor\)</span>ä¸ªï¼å æ­¤ç©ºåºæ¥çæ æ ä¸å±æ<span class="math inline">\(n-\left\lfloor  \frac{n}{k}  \right\rfloor\)</span>ä¸ª</p>
<h2 id="ä»£ç ">ä»£ç </h2>
<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
using namespace std;
#define ll long long
#define int ll 
#define rep(i,a,b) for(int i=(a);i&lt;=(b);i++)
#define per(i,a,b) for(int i=(a);i&gt;=(b);i--)
 
void solve() {
    int n, k;cin &gt;&gt; n &gt;&gt; k;
    cout &lt;&lt; n - n / k &lt;&lt; '\n';
}
 
signed main() {
    ios::sync_with_stdio(0);
    cin.tie(0), cout.tie(0);
    int t = 1;
    cin &gt;&gt; t;
    while (t--)solve();
}
</code></pre>
<h1 id="bç¦»å²¸èµé">B.<a href="https://codeforces.com/contest/2194/problem/B" target="_blank" rel="noopener nofollow">ç¦»å²¸èµé</a></h1>
<ul>
<li>
<h1 id="æ°å­¦-1">æ°å­¦</h1>
</li>
</ul>
<p>æ¯ä¸ªæµè¯æ¶é´éå¶ 1.5 ç§<br>
æ¯ä¸ªæµè¯åå­éå¶ 256 MB<br>
é©¬åéå¸¸åæ¬¢é±ï¼å¹¶ä¸ä»æå¤§é¨åé±é½å­å¨é¶è¡éãä»å¨ <span class="math inline">\(n\)</span> å®¶ä¸åçé¶è¡ä¸­å­æèµéãå¨ç¬¬ <span class="math inline">\(i\)</span> å®¶é¶è¡ï¼ä»æ <span class="math inline">\(a_i\)</span> å¢å¸ã</p>
<p>æå¤©ï¼é©¬åå³å®å°ä»ææçé±éä¸­å°ä¸å®¶é¶è¡ï¼å æ­¤ä»éè¦å°èµéä»ä¸ä¸ªé¶è¡è´¦æ·è½¬ç§»å°å¦ä¸ä¸ªè´¦æ·ãææçé¶è¡é´è½¬è´¦é½æç§ç¸åçæ¹å¼è¿è¡ï¼ä»ä¸æ¬¡åªè½è½¬è´¦ <span class="math inline">\(x\)</span> å¢å¸ï¼å¹¶ä¸èèå°ææè´¹ç¨ï¼å®éå°è´¦éé¢ä¸º <span class="math inline">\(y\)</span> å¢å¸ï¼å ä¸ºé¶è¡è¦çå©ï¼æä»¥æ <span class="math inline">\(y \le x\)</span>ï¼ã</p>
<p>é©¬åå¯è½æ æ³å°ææçé±é½è½¬ç§»å°ä¸å®¶é¶è¡ï¼ä½ä»å¸ææ¾å°æç»ä»»ä½ä¸å®¶é¶è¡ä¸­è½å¾å°çæå¤§å¢å¸æ°éã</p>
<h2 id="è¾å¥-1">è¾å¥</h2>
<p>æ¯ä¸ªæµè¯åå«å¤ä¸ªæµè¯ç¨ä¾ãç¬¬ä¸è¡åå«æµè¯ç¨ä¾çæ°é <span class="math inline">\(t\)</span> <span class="math inline">\((1 \le t \le 10^4)\)</span>ãæ¥ä¸æ¥æ¯æ¯ä¸ªæµè¯ç¨ä¾çæè¿°ã</p>
<p>æ¯ä¸ªæµè¯ç¨ä¾çç¬¬ä¸è¡åå«ä¸ä¸ªæ´æ° <span class="math inline">\(n\)</span>ã<span class="math inline">\(x\)</span> å <span class="math inline">\(y\)</span> <span class="math inline">\((2 \le n \le 2 \cdot 10^5, 1 \le y \le x \le 10^9)\)</span> ââ é¶è¡æ°éãè½¬è´¦éé¢åå®éå°è´¦éé¢ã</p>
<p>æ¯ä¸ªæµè¯ç¨ä¾çç¬¬äºè¡åå« <span class="math inline">\(n\)</span> ä¸ªæ´æ° <span class="math inline">\(a_1, a_2, \dots, a_n\)</span> <span class="math inline">\((1 \le a_i \le 10^9)\)</span> ââ æ¯å®¶é¶è¡åå§çå¢å¸éé¢ã</p>
<p>ä¿è¯æææµè¯ç¨ä¾ç <span class="math inline">\(n\)</span> çæ»åä¸è¶è¿ <span class="math inline">\(2 \cdot 10^5\)</span>ã</p>
<h2 id="è¾åº-1">è¾åº</h2>
<p>å¯¹äºæ¯ä¸ªæµè¯ç¨ä¾ï¼è¾åºä¸ä¸ªæ°å­ ââ ä»»ä½ä¸å®¶é¶è¡ä¸­è½è·å¾çæå¤§å¢å¸æ°éã</p>
<h2 id="æè·¯-1">æè·¯</h2>
<p>å¯¹äºä¸ä¸ª<span class="math inline">\(a_{i}\)</span>ï¼å¦ææ³è¦æä»åç»å¶ä»é¶è¡ï¼é£ä¹æå¥½çæåµæ¯<span class="math inline">\(a_{i}\%x==0\)</span>ï¼æ­¤æ¶å¯ä»¥æ<span class="math inline">\(a_{i}\)</span>å®å¨å¯¹ç­æ¡ååº<span class="math inline">\(\frac{a_{i}}{x}\times y\)</span>çè´¡ç®ï¼å¦åå°ä¼æ<span class="math inline">\(r_{i}=a_{i}\%x\)</span>çå©ä½</p>
<p>å¯¹äºä¸ä¸ª<span class="math inline">\(r_{i}\neq 0\)</span>ï¼å¦ææå«çä»½é¢åå°äºèªå·±èº«ä¸ï¼å¯ä»¥è®°ä¸º<span class="math inline">\(r_{i}+t\cdot y\)</span>ï¼å½<span class="math inline">\((r_{i}+t\cdot y)\%x==0\)</span>æ¶ï¼å½åç<span class="math inline">\(r_{i}\)</span>è¢«å®å¨æ¶èå®æ¯</p>
<p>ç¶èï¼æ³¨æå°å°±ç®ä½¿ç¨å¶ä»çé¶è¡ä»½é¢<span class="math inline">\(t\cdot y\)</span>æ¥æ¶èå©ä½ç<span class="math inline">\(r_{i}\)</span>ï¼æç»è½å¤è´¡ç®ç»ç­æ¡ç<span class="math inline">\(y\)</span>çæ°éæ²¡æåçååãæ¯å¦è¯´ï¼<span class="math inline">\(a_{i}=t_{i}\cdot x+r_{i}\quad a_{j}=t_{j}\cdot x\)</span>ï¼å¹¶ä¸æ°å¥½æ<span class="math inline">\((r_{i}+t_{j}\cdot y)\%x==0\)</span>ï¼æ è®ºæ¯å¦å°<span class="math inline">\(j\)</span>è½¬ç§»å°<span class="math inline">\(i\)</span>ä¸ï¼è¿ä¸¤ä¸ªé¶è¡å¯¹ç­æ¡çæ»è´¡ç®é½ä¸º<span class="math inline">\((t_{i}+t_{j})\cdot y\)</span></p>
<p>å æ­¤ï¼æç»çç­ç¥ä¸å®æ¯ï¼éå®ä¸ä¸ªä½ç½®ä½ä¸ºæç»çç­æ¡ï¼å°é¤äºè¿ä¸ªä½ç½®ä»¥å¤çææé¶è¡é½åå°è¿ä¸ªä½ç½®ä¸ï¼é£ä¹éå®ä½ç½®<span class="math inline">\(i\)</span>ä½ä¸ºæç»ç­æ¡çç®å¼ä¸ºï¼</p>
<p></p><div class="math display">\[a_{i}+\left( \sum_{j=1}^{n}t_{j}-t_{i} \right)\cdot y
\]</div><p></p><p>å æ­¤ç­æ¡å³ä¸ºæä¸¾ææ<span class="math inline">\(i\)</span>åæå¤§å¼</p>
<p></p><div class="math display">\[ans=\max_{1\leq i\leq n}\left\{ a_{i}+\left( \sum_{j=1}^{n}t_{j}-t_{i} \right)\cdot y \right\}
\]</div><p></p><p>psï¼ä¸å¼å§æ²¡åç°è¿ä¸ªè§å¾ï¼æ³äºå¥½ä¹ï¼è¿æäºå¿«éå¹åä¹æ³éåããã</p>
<h2 id="ä»£ç -1">ä»£ç </h2>
<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
using namespace std;
#define ll long long
#define int ll 
#define rep(i,a,b) for(int i=(a);i&lt;=(b);i++)
#define per(i,a,b) for(int i=(a);i&gt;=(b);i--)
 
struct node {
    int val, m, t;
};
 
void solve() {
    int n, x, y;cin &gt;&gt; n &gt;&gt; x &gt;&gt; y;
    vector&lt;node&gt;a(n + 1);
    int sumt = 0;
    rep(i, 1, n) {
        int val, m, t;
        cin &gt;&gt; val;
        m = val % x;
        t = val / x;
        a[i] = { val,m,t };
        sumt += t;
    }
    int ans = 0;
    rep(i, 1, n) {
        ans = max(ans, (sumt - a[i].t) * y + a[i].val);
    }
    cout &lt;&lt; ans &lt;&lt; '\n';
}
 
signed main() {
    ios::sync_with_stdio(0);
    cin.tie(0), cout.tie(0);
    int t = 1;
    cin &gt;&gt; t;
    while (t--)solve();
}
</code></pre>
<h1 id="cç§å¯ä¿¡æ¯">C.<a href="https://codeforces.com/contest/2194/problem/C" target="_blank" rel="noopener nofollow">ç§å¯ä¿¡æ¯</a></h1>
<ul>
<li>
<h1 id="å­ç¬¦ä¸²-æ¨¡æ">å­ç¬¦ä¸² #æ¨¡æ</h1>
</li>
</ul>
<p>åç¹æ¶é´éå¶ 2 ç§<br>
åå­éå¶ 256 MB</p>
<p>å¤©æç¹å·¥ Bob æªè·äºä¸æ¡å å¯ä¿¡æ¯ãä»è®¤ä¸ºå¶ä¸­åå«ç§å¯ä¿¡æ¯ï¼å¹¶æ­£å¨ç§¯æç ´è§£ã</p>
<p>è½å¥ç¹å·¥æä¸­ççº¸æ¡ç± k æ¡ç»æï¼æ¯æ¡é¿åº¦ä¸º nï¼åå«ä¸¥æ ¼çå°åæä¸å­æ¯ãå­åå¨ç ´è¯æ­¤ç±»æä»¶æ¹é¢çä¸°å¯ç»éªï¼Bob çæµä»æå´è¶£çä¿¡æ¯ï¼å³çº¸æ¡çè§£å¯åå®¹ï¼ä¹æ¯ä¸ä¸ªé¿åº¦ä¸º n çå­ç¬¦ä¸²ï¼å¹¶ä¸è¯¥æ¶æ¯çç¬¬ i ä¸ªå­æ¯å¯¹åºäºå¶ä¸­ææ¡çº¸æ¡çç¬¬ i ä¸ªå­æ¯ã</p>
<p>å¨ Bob çæ¥ï¼å­ç¬¦ä¸² s çä¿¡æ¯åº¦å®ä¹ä¸ºæå°çæ­£æ´æ° dï¼ä½¿å¾å­å¨ä¸ä¸ªé¿åº¦ä¸º d çå­ç¬¦ä¸² tï¼å¹¶ä¸ s å¯ä»¥ç± t éå¤è¥å¹²æ¬¡ææãä¾å¦ï¼å­ç¬¦ä¸² "aaaa" çä¿¡æ¯åº¦ä¸º 1ï¼å­ç¬¦ä¸² "abab" çä¿¡æ¯åº¦ä¸º 2ï¼å­ç¬¦ä¸² "abcd" çä¿¡æ¯åº¦ä¸º 4ã</p>
<p>Bob åè®¾çº¸æ¡çä½èä¸ºç¡®ä¿ä¿¡æ¯ä¼ è¾çå¯é æ§ï¼å¨æ¶æ¯ä¸­éå¤äºæ°æ®å¤æ¬¡ãå æ­¤ï¼ä»è®¤ä¸ºæ´åççè§£å¯ç»æåºå·æå°½å¯è½å°çä¿¡æ¯åº¦ã</p>
<p>è¯·å¸®å©è¿ä½ç¹å·¥ï¼æ¾å°è½å¤è§£å¯è¯¥çº¸æ¡ä¸å·ææå°å¯è½ä¿¡æ¯åº¦çæ¶æ¯ã</p>
<h2 id="è¾å¥æ ¼å¼">è¾å¥æ ¼å¼</h2>
<p>æ¯ä¸ªæµè¯åå«å¤ä¸ªæµè¯ç¨ä¾ãç¬¬ä¸è¡åå«æµè¯ç¨ä¾çæ°é t <span class="math inline">\((1 \le t \le 10^4)\)</span>ãæ¥ä¸æ¥æ¯æ¯ä¸ªæµè¯ç¨ä¾çæè¿°ã</p>
<p>æ¯ä¸ªæµè¯ç¨ä¾çç¬¬ä¸è¡åå«æ°å­ n å k <span class="math inline">\((2 \le n, k \le 50000, 4 \le n \cdot k \le 10^5)\)</span> ââ çº¸æ¡çé¿åº¦åçº¸æ¡çæ°éã</p>
<p>å¨æ¯ä¸ªæµè¯ç¨ä¾æ¥ä¸æ¥ç k è¡ä¸­ï¼æ¯è¡æä¸ä¸ªç± n ä¸ªå°åæä¸å­æ¯ç»æçåºå ââ è¡¨ç¤ºä¸ä¸æ¡çº¸æ¡ã</p>
<p>ä¿è¯æææµè¯ç¨ä¾ç <span class="math inline">\(n \cdot k\)</span> æ»åä¸è¶è¿ <span class="math inline">\(10^5\)</span>ã</p>
<h2 id="è¾åºæ ¼å¼">è¾åºæ ¼å¼</h2>
<p>å¯¹äºæ¯ä¸ªæµè¯ç¨ä¾ï¼è¾åºä¸ä¸ªé¿åº¦ä¸º n çå­ç¬¦ä¸² ââ å·ææå°å¯è½ä¿¡æ¯åº¦ççº¸æ¡è§£å¯åå®¹ãå¦ææå¤ä¸ªåéçç­æ¡ï¼è¾åºå¶ä¸­ä»»æä¸ä¸ªå³å¯ã</p>
<h2 id="æè·¯-2">æè·¯</h2>
<p>é¦åæä¸ä¸ªå¾ææ¾çè§å¯ï¼è¿ä¸ªç­æ¡çé¿åº¦<span class="math inline">\(len\)</span>éæ©ç¹å«å°ï¼å ä¸ºå¿é¡»è¦æ»¡è¶³<span class="math inline">\(n\%len==0\)</span>ï¼æä»¥æä»¬å¯ä»¥å¨<span class="math inline">\(\sqrt{ n }\)</span>çå¤æåº¦éååºæä¸¾<span class="math inline">\(n\)</span>çå æ°ï¼ä¹å°±æ¯ææçé¿åº¦</p>
<p>ç¡®å®äºä¸ä¸ªé¿åº¦ä¹åï¼å°±å¤æ­æ¯å¦å¯ä»¥æ¾å°åæ³çç­æ¡ãå¦æä¸ä¸ªä¸²æ¯åæ³çç­æ¡ï¼é£ä¹<span class="math inline">\(s_{i}==s_{i+len}==s_{i+2len}==\dots==s_{i+t\cdot len}\)</span>ï¼å¶ä¸­<span class="math inline">\(1\leq i\leq len,0\leq t&lt; \frac{n}{len}\)</span></p>
<p>å æ­¤ï¼å¦æä¸ä¸ªå­æ¯å¯ä»¥å¡«å¥ä½ç½®<span class="math inline">\(i\)</span>ï¼é£ä¹å¨ææç<span class="math inline">\(i+t\cdot len\)</span>ä¸é½å¿é¡»è¦å¯ä»¥å¡«å¥è¿ä¸ªå­æ¯</p>
<p>å æ­¤å¼ä¸ä¸ªäºç»´æ°ç»ï¼<span class="math inline">\(a[j][c]\)</span>ä»£è¡¨ç¬¬<span class="math inline">\(j\)</span>åä¸æ¯å¦å­å¨å­æ¯<span class="math inline">\(c\)</span><br>
æä¸¾<span class="math inline">\(len\)</span>ä¸ª<span class="math inline">\(i\)</span>ï¼éåæ¥æ¾ææç<span class="math inline">\(i+t\cdot len\)</span>å¤æ­å³å¯</p>
<p>å¤æåº¦ä¸º<span class="math inline">\(O(n\cdot k+n\sqrt{ n })\)</span></p>
<h2 id="ä»£ç -2">ä»£ç </h2>
<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
using namespace std;
#define ll long long
#define int ll 
#define rep(i,a,b) for(int i=(a);i&lt;=(b);i++)
#define per(i,a,b) for(int i=(a);i&gt;=(b);i--)
 
void solve() {
    int n, k;cin &gt;&gt; n &gt;&gt; k;
    vector&lt;vector&lt;int&gt;&gt;a(n + 1, vector&lt;int&gt;(27));
    rep(i, 1, k) {
        string s;cin &gt;&gt; s;
        rep(j, 0, n - 1) {
            a[j + 1][s[j] - 'a']++;
        }
    }
    string res;
    for (int len = 1;len &lt;= n;len++) {
        if (n % len == 0) {
            res.clear();
            rep(i, 1, len) {
                char ans = '#';
                rep(c, 0, 25) {
                    bool find = 1;
                    rep(j, 0, n / len - 1) {
                        int pos = i + j * len;
                        if (!a[pos][c]) {
                            find = 0;break;
                        }
                    }
                    if (find) {
                        ans = 'a' + c;break;
                    }
                }
                if (ans != '#')res += ans;
                else break;
            }
            if (res.size() == len) {
                rep(i, 1, n / len)cout &lt;&lt; res;cout &lt;&lt; '\n';
                return;
            }
        }
    }
}
 
signed main() {
    ios::sync_with_stdio(0);
    cin.tie(0), cout.tie(0);
    int t = 1;
    cin &gt;&gt; t;
    while (t--)solve();
}
</code></pre>
<h1 id="d-è¡¨æ ¼åå²">D. <a href="https://codeforces.com/contest/2194/problem/D" target="_blank" rel="noopener nofollow">è¡¨æ ¼åå²</a></h1>
<ul>
<li>
<h1 id="dfs-æ°å­¦">dfs #æ°å­¦</h1>
</li>
</ul>
<p><strong>åç¹æµè¯æ¶é´éå¶</strong> 2 ç§<br>
<strong>åç¹æµè¯åå­éå¶</strong> 256 åå­è</p>
<p>ç»å®ä¸ä¸ªå¤§å°ä¸º <span class="math inline">\(n \times m\)</span> çè¡¨æ ¼ï¼å¶ä¸­æ¯ä¸ªååæ ¼åå« <span class="math inline">\(0\)</span> æ <span class="math inline">\(1\)</span>ãä»»å¡æ¯éè¿ä¸æ¡ä»å·¦ä¸è§å°å³ä¸è§çåå²çº¿å°å¶åæä¸¤é¨åãåå²çº¿åªè½åå³æåä¸å»¶ä¼¸ã</p>
<p>è®¾ <span class="math inline">\(a\)</span> ä¸ºåå²åè¡¨æ ¼ä¸é¨åä¸­ <span class="math inline">\(1\)</span> çæ°éï¼<span class="math inline">\(b\)</span> ä¸ºå¦ä¸é¨åä¸­ <span class="math inline">\(1\)</span> çæ°éãç®æ æ¯æå¤§å <span class="math inline">\(a \cdot b\)</span> çå¼ã</p>
<h2 id="è¾å¥-2">è¾å¥</h2>
<p>æ¯ä¸ªæµè¯åå«å¤ä¸ªæµè¯ç¨ä¾ãç¬¬ä¸è¡åå«æµè¯ç¨ä¾çæ°é <span class="math inline">\(t\)</span> <span class="math inline">\((1 \le t \le 10^4)\)</span>ãæ¥ä¸æ¥æ¯æµè¯ç¨ä¾çæè¿°ã</p>
<p>æ¯ä¸ªæµè¯ç¨ä¾çç¬¬ä¸è¡åå«ä¸¤ä¸ªæ´æ° <span class="math inline">\(n\)</span> å <span class="math inline">\(m\)</span> <span class="math inline">\((1 \le n, m \le 3 \cdot 10^5, 2 \le n \cdot m \le 3 \cdot 10^5)\)</span> ââ åå«æ¯è¡¨æ ¼çè¡æ°ååæ°ã</p>
<p>æ¥ä¸æ¥ç <span class="math inline">\(n\)</span> è¡ï¼æ¯è¡åå« <span class="math inline">\(m\)</span> ä¸ªæ´æ°ï¼å¶ä¸­ç¬¬ <span class="math inline">\(i\)</span> è¡çç¬¬ <span class="math inline">\(j\)</span> ä¸ªæ°å¯¹åºå¼ <span class="math inline">\(a_{i,j}\)</span> <span class="math inline">\((0 \le a_{i,j} \le 1)\)</span>ã</p>
<p>ä¿è¯æææµè¯ç¨ä¾ç <span class="math inline">\(n \cdot m\)</span> ä¹åä¸è¶è¿ <span class="math inline">\(3 \cdot 10^5\)</span>ã</p>
<h2 id="è¾åº-2">è¾åº</h2>
<p>å¯¹äºæ¯ä¸ªæµè¯ç¨ä¾ï¼å¨è¾åºæ°æ®çç¬¬ä¸è¡è¾åºä¸ä¸ªæ°å­ ââ ä¹ç§¯çæå¤§å¼ã</p>
<p>å¨ç¬¬äºè¡ï¼è¾åºä¸ä¸ªç± <span class="math inline">\(n\)</span> ä¸ªå­ç¬¦ 'D' å <span class="math inline">\(m\)</span> ä¸ªå­ç¬¦ 'R' ç»æçå­ç¬¦ä¸²ï¼è¡¨ç¤ºä¸ä¸æ­¥åå²çæ¹åï¼å¶ä¸­ 'D' è¡¨ç¤ºåä¸åå²ï¼'R' è¡¨ç¤ºåå³åå²ã!<img src="https://i-blog.csdnimg.cn/direct/8572c275568a4aba8cc862471babf6fa.png" alt="[[bf5a95bd1bfc341b05232d999b0048817fc8b08f.webp]]" loading="lazy"></p>
<h2 id="æè·¯-3">æè·¯</h2>
<p>æ¬é¢å®éä¸å°±æ¯ä¸ä¸ªå¾å¸åçåºæ¬ä¸ç­å¼é®é¢ï¼<br>
ç»å®<span class="math inline">\(x+y=k\)</span>ï¼æ±<span class="math inline">\(x\cdot y\)</span>çæå¤§å¼</p>
<p></p><div class="math display">\[\begin{align}
&amp;å·²ç¥x+y\geq 2\sqrt{ xy }\\ \\
&amp;\Leftrightarrow  \frac{(x+y)^{2}}{4}\geq xy\\ \\
&amp;\therefore xy\leq \frac{k}{4},å½ä¸ä»å½x=yåç­
\end{align}
\]</div><p></p><p>ä¹å°±æ¯è¯´ï¼ç´æ¥å<span class="math inline">\(x=\left\lfloor  \frac{k}{2}  \right\rfloor,y=\left\lceil  \frac{k}{2}  \right\rceil\)</span>å³å¯</p>
<p>é£ä¹æ¥ä¸æ¥å°±æ¯åå²è·¯çº¿<br>
æä»¬éç¨<span class="math inline">\(1-based\)</span>ä¸æ ï¼åé¢æå¦ç¨<br>
å®éä¸æä»¬ä»å³ä¸åå·¦ä¸éåææçæçº¿ï¼ä¸è¾¹éåä¸è¾¹è®°å½1çä¸ªæ°ï¼å½1çä¸ªæ°æ°å¥½ç­äº<span class="math inline">\(x\)</span>çæ¶ååæ­¢ï¼ææèµ°è¿çç¹é½æä¸æ è®°<span class="math inline">\(vis[i][j]=1\)</span><br>
æ¥ä¸æ¥æä»¬éè¦å°<span class="math inline">\(vis[0][j]\)</span>ä»¥å<span class="math inline">\(vis[i][m+1]\)</span>å¨é¨æ ä¸º1<br>
å°<span class="math inline">\((0,1)\)</span>è®¾ä¸ºèµ·ç¹ï¼<span class="math inline">\((n,m+1)\)</span>è®¾ä¸ºç»ç¹è¿è¡dfsï¼åªè½åå³æåä¸ï¼<span class="math inline">\(vis[i][j]=0\)</span>è§ä¸ºéç¢ç©ï¼å³å¯å¾å°ååçåºå</p>
<h2 id="ä»£ç -3">ä»£ç </h2>
<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
using namespace std;
#define ll long long
#define int ll 
#define rep(i,a,b) for(int i=(a);i&lt;=(b);i++)
#define per(i,a,b) for(int i=(a);i&gt;=(b);i--)
 
struct node {
    int x, y;
    char c;
};
vector&lt;int&gt;dx = { 1,0 };
vector&lt;int&gt;dy = { 0,1 };
vector&lt;char&gt;c = { 'D','R' };
vector&lt;vector&lt;bool&gt;&gt;vis;
int n, m;
bool dfs(int x, int y) {
    if (x == n &amp;&amp; y == m + 1)return 1;
    rep(i, 0, 1) {
        int nx = x + dx[i], ny = y + dy[i];
        if (nx &gt; n || ny &gt; m + 1 || vis[nx][ny] == 0)continue;
        vis[nx][ny] = 1;
        cout &lt;&lt; c[i];
        if (dfs(nx, ny))return 1;
    }
    return 0;
}
 
void solve() {
    cin &gt;&gt; n &gt;&gt; m;
    vector&lt;vector&lt;int&gt;&gt;a(n + 1, vector&lt;int&gt;(m + 1));
    int sum = 0;
    rep(i, 1, n) {
        rep(j, 1, m) {
            cin &gt;&gt; a[i][j];
            if (a[i][j])sum++;
        }
    }
    int x = sum / 2, y = sum - x;
    cout &lt;&lt; x * y &lt;&lt; '\n';
    int cnt = 0;
    vis.assign(n + 1, vector&lt;bool&gt;(m + 1, 0));
    per(d, m - 1, 1 - n) {
        rep(j, max(1ll, d + 1), m) {
            int i = j - d;
            if (i &gt; n)break;
            vis[i][j] = 1;
            if (a[i][j])cnt++;
            if (cnt == x) break;
        }
        if (cnt == x)break;
    }
    rep(j, 1, m)vis[0][j] = 1;
    rep(i, 0, n)vis[i][m + 1] = 1;
    dfs(0, 1);
    cout &lt;&lt; '\n';
}
 
signed main() {
    ios::sync_with_stdio(0);
    cin.tie(0), cout.tie(0);
    int t = 1;
    cin &gt;&gt; t;
    while (t--)solve();
}
</code></pre>
<h1 id="e-ä¹é¾åå»">E. <a href="https://codeforces.com/contest/2194/problem/E" target="_blank" rel="noopener nofollow">ä¹é¾åå»</a></h1>
<ul>
<li>
<h1 id="dp-åç¼å-åç¼å-æä¸¾">dp #åç¼å #åç¼å #æä¸¾</h1>
</li>
</ul>
<p><strong>åç¹æµè¯æ¶é´éå¶</strong> 2 ç§<br>
<strong>åç¹æµè¯åå­éå¶</strong> 512 åå­è</p>
<p>å¨ä¸æ¬¡è°è¦çè®­ç»åï¼ç±³å¼æåºç½åææå°å³å®ç¹æ«è¨ãä¸ºåºç¥èæ¥ï¼æ«è¨åºåå¤äº <span class="math inline">\(n\)</span> è¡ <span class="math inline">\(m\)</span> åçç©å½¢æ«è¨ãæ¯ä¸ååçé½æå¶ç¬ç¹çéæ¹åé£å³ã</p>
<p>ç±³å¼æåºç½é¦åæå¼äºçå­ï¼å¹¶ç²ç¥ä¼°è®¡äºäº«ç¨æ¯ä¸ååççææ¦åº¦ï¼ä½äºç¬¬ <span class="math inline">\(i\)</span> è¡ãç¬¬ <span class="math inline">\(j\)</span> åçåçå¸¦æ¥çææ¦åº¦ç­äº <span class="math inline">\(a_{i,j}\)</span>ãä¿è¯è³å°æä¸ååçæ¯ç±³å¼æåºç½åæ¬¢çï¼ä¹å°±æ¯è¯´å¨ <span class="math inline">\(a_{i,j}\)</span> ä¸­è³å°æä¸ä¸ªéè´æ°ã</p>
<p>ä¸¤åªä¹é¾çº¦å®ï¼ç±ç±³å¼æåºç½ååãæ ¹æ®å¤èçä¼ ç»ï¼ä»å¿é¡»éæ©ä¸æ¡ä»å·¦ä¸è§ <span class="math inline">\((1,1)\)</span> å°å³ä¸è§ <span class="math inline">\((n,m)\)</span> çè·¯å¾ï¼å¹¶åæè·¯å¾ä¸çææåçãå¨æ¯ä¸æ­¥ï¼ä»å¯ä»¥åå³æåä¸ç§»å¨å°ç¸é»çåçã</p>
<p>ç±³å¼æåºç½çç®æ æ¯æå¤§åä»æååççææ¦åº¦æ»åã</p>
<p>ç¶èï¼ææå°å³å®ä½¿ç¨é±æãå¨ç±³å¼æåºç½éæ©è·¯å¾ä¹åï¼ææå°å³å®æ°å¥½éæ©ä¸åæ«è¨åçï¼å¹¶æ¶ä¸ä»çæçé±æãä½ç±äºè¿ç§é±æçç¹æ§ï¼è¯¥åççææ¦åº¦ä¼åä¸ºç¸åæ°ï¼å¦æåæ¥æ¯ <span class="math inline">\(a_{i,j}\)</span>ï¼æ¶ä¸é±æååä¸º <span class="math inline">\(-a_{i,j}\)</span>ã</p>
<p>å¨è¿ä¹åï¼ç¥éäºææå°çéæ©ï¼ç±³å¼æåºç½å°ä¸ºèªå·±éæ©æä¼çè·¯å¾ï¼å¹¶åæè·¯å¾ä¸çææåçã</p>
<p>ææå°å¾å¥½å¥ï¼ç±³å¼æåºç½æç»å¯è½è·å¾çæå°ææ¦åº¦æ¯å¤å°ãå¸®å©ä»è®¡ç®è¿ä¸ªæ°å¼ã</p>
<h2 id="è¾å¥-3">è¾å¥</h2>
<p>æ¯ä¸ªæµè¯åå«å¤ä¸ªæµè¯ç¨ä¾ãç¬¬ä¸è¡åå«æµè¯ç¨ä¾çæ°é <span class="math inline">\(t\)</span> <span class="math inline">\((1 \le t \le 10^4)\)</span>ãæ¥ä¸æ¥æ¯æµè¯ç¨ä¾çæè¿°ã</p>
<p>æ¯ä¸ªæµè¯ç¨ä¾çç¬¬ä¸è¡ç»åºä¸¤ä¸ªæ´æ° <span class="math inline">\(n, m\)</span> <span class="math inline">\((1 \le n,m \le 10^6, 1 \le n \cdot m \le 10^6)\)</span> â åå«è¡¨ç¤ºè¡¨æ ¼çè¡æ°ååæ°ã</p>
<p>æ¯ä¸ªæµè¯ç¨ä¾æ¥ä¸æ¥ç <span class="math inline">\(n\)</span> è¡ä¸­ï¼æ¯è¡æä¾ <span class="math inline">\(m\)</span> ä¸ªä»¥ç©ºæ ¼åéçæ´æ°ãå¶ä¸­ç¬¬ <span class="math inline">\(i\)</span> è¡çç¬¬ <span class="math inline">\(j\)</span> ä¸ªæ°å¯¹åºå¼ <span class="math inline">\(a_{i,j}\)</span> <span class="math inline">\((-10^9 \le a_{i,j} \le 10^9)\)</span>ãä¿è¯å¨ <span class="math inline">\(a_{i,j}\)</span> ä¸­è³å°æä¸ä¸ªéè´å¼ã</p>
<p>ä¿è¯æææµè¯ç¨ä¾ç <span class="math inline">\(n \cdot m\)</span> ä¹åä¸è¶è¿ <span class="math inline">\(10^6\)</span>ã</p>
<h2 id="è¾åº-3">è¾åº</h2>
<p>å¯¹äºæ¯ä¸ªæµè¯ç¨ä¾ï¼è¾åºä¸ä¸ªæ´æ° â ææå°è½å¤ä¿è¯çãç±³å¼æåºç½å¯ä»¥è·å¾çæå°ææ¦åº¦ã</p>
<h2 id="æè·¯-4">æè·¯</h2>
<p>å¦ææ²¡æé¢å¤çæä½ï¼é£ä¹æ¬é¢å°±æ¯ä¸ä¸ªæ åçº¿æ§dpæ±æå¤§è·¯å¾ç¹æåé®é¢ï¼</p>
<p></p><div class="math display">\[dp[i][j]=max\{ dp[i-1][j],dp[i][j-1] \}+w[i][j]
\]</div><p></p><p>ä½æ¯ç±äºæä»¬å¯ä»¥éæ©ä¸ä¸ªæ¹åè¿è¡æå¼ä¸çååï¼å¹¶ä¸è¦æ±ææååæ¹æ¡è®¡ç®åºçæå¤§ç¹æåä¸­çæå°å¼ï¼æä»¥ä¸è½ç´æ¥éè¿ç¶ææ¥è½¬ç§»</p>
<p>æä¸ä¸ªç»å¸çæä¸¾æç»´ï¼<br>
æä¸¾æ¯ä¸ä¸ªååç¹ï¼é¢å¤çååç¹çåç¼ä»¥ååç¼ï¼è¿æ ·å°±å¯ä»¥<span class="math inline">\(O(1)\)</span>è®¡ç®å¾å°æ¯ä¸æ¬¡æä¸¾ååç¹çç­æ¡ï¼ååæå°å¼</p>
<p>è®¾<span class="math inline">\(pre[i][j]\)</span>ä¸ºä»¥<span class="math inline">\((1,1)\)</span>ä½ä¸ºèµ·ç¹ï¼èµ°å°<span class="math inline">\((i,j)\)</span>çæå¤§ç¹æåï¼</p>
<p></p><div class="math display">\[pre[i][j]=max\{ pre[i-1][j],pre[i][j-1] \}+w[i][j]
\]</div><p></p><p>è®¾<span class="math inline">\(suf[i][j]\)</span>ä¸ºä»¥<span class="math inline">\((n,m)\)</span>ä½ä¸ºèµ·ç¹ï¼ååèµ°å°<span class="math inline">\((i,j)\)</span>çæå¤§ç¹æåï¼</p>
<p></p><div class="math display">\[suf[i][j]=max\{ suf[i+1][j],suf[i][j+1] \}+w[i][j]
\]</div><p></p><p>è®¾<span class="math inline">\(dis[i][j]\)</span>ä¸ºä»¥<span class="math inline">\((1,1)\)</span>ä½ä¸ºèµ·ç¹ï¼<span class="math inline">\((n,m)\)</span>ä½ä¸ºç»ç¹ï¼éå¾<span class="math inline">\((i,j)\)</span>çæå¤§è·¯å¾ç¹æåï¼</p>
<p></p><div class="math display">\[dis[i][j]=max\{ pre[i-1][j],pre[i][j-1] \}+max\{ suf[i+1][j],suf[i][j+1] \}+w[i][j]
\]</div><p></p><p>æ¥ä¸æ¥èèæä¸¾æ¯ä¸ä¸ªç¹ä½ä¸ºååç¹çç­æ¡è®¡ç®æ¹å¼ï¼</p>
<p>åè®¾ç¿»è½¬<span class="math inline">\((i,j)\)</span>çä½ç½®çæå¼ï¼é£ä¹ä¹å°±åªæä¸¤ç§å³ç­æ¹å¼ï¼</p>
<ul>
<li>ç»§ç»­èµ°<span class="math inline">\((i,j)\)</span>çä½ç½®ï¼ç­æ¡åä¸º<span class="math inline">\(dis[i][j]-2w[i][j]\)</span></li>
<li>ä¸èµ°<span class="math inline">\((i,j)\)</span>çä½ç½®ï¼ä»<span class="math inline">\(\{ (x,y)|x&lt;i,y&gt;j \}\)</span>æè<span class="math inline">\(\{ (x,y)|x&gt;i,y&lt;j \}\)</span>ä¸¤ä¸ªåºåä¸­éå<span class="math inline">\(dis[x][y]\)</span>çæå¤§å¼ï¼è¿æ ·å¯ä»¥ä¿è¯ä¸å®ä¸ç»è¿<span class="math inline">\((i,j)\)</span></li>
</ul>
<p>ä¸ºäºå¿«éæ±åºå³ä¸ä»¥åå·¦ä¸ç©å½¢åºåçæå¤§å¼ï¼é¢å¤çä¸¤ä¸ªæå¤§å¼æ°ç»ï¼</p>
<ul>
<li><span class="math inline">\(RU[i][j]\)</span>è¡¨ç¤º<span class="math inline">\((i,j)\)</span>å³ä¸åºåç<span class="math inline">\(dis\)</span>æå¤§å¼</li>
<li><span class="math inline">\(LD[i][j]\)</span>è¡¨ç¤º<span class="math inline">\((i,j)\)</span>çå·¦ä¸åºåç<span class="math inline">\(dis\)</span>æå¤§å¼</li>
</ul>
<p>é¢å¤çå®åå°±å¯ä»¥æä¸¾ååç¹<span class="math inline">\(O(1)\)</span>è¿è¡å³ç­è®¡ç®äº</p>
<h2 id="ä»£ç -4">ä»£ç </h2>
<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
using namespace std;
#define ll long long
#define int ll 
#define rep(i,a,b) for(int i=(a);i&lt;=(b);i++)
#define per(i,a,b) for(int i=(a);i&gt;=(b);i--)
 
const int inf = 1e18;
 
void solve() {
    int n, m;cin &gt;&gt; n &gt;&gt; m;
    vector&lt;vector&lt;int&gt;&gt;a(n + 1, vector&lt;int&gt;(m + 1));
    rep(i, 1, n) {
        rep(j, 1, m)cin &gt;&gt; a[i][j];
    }
    vector&lt;vector&lt;int&gt;&gt;pre(n + 1, vector&lt;int&gt;(m + 1, -inf));
    pre[1][1] = a[1][1];
    rep(i, 1, n) {
        rep(j, 1, m) {
            if (i - 1 &gt; 0)pre[i][j] = max(pre[i][j], pre[i - 1][j] + a[i][j]);
            if (j - 1 &gt; 0)pre[i][j] = max(pre[i][j], pre[i][j - 1] + a[i][j]);
        }
    }
    vector&lt;vector&lt;int&gt;&gt;suf(n + 1, vector&lt;int&gt;(m + 1, -inf));
    suf[n][m] = a[n][m];
    per(i, n, 1) {
        per(j, m, 1) {
            if (i + 1 &lt;= n)suf[i][j] = max(suf[i][j], suf[i + 1][j] + a[i][j]);
            if (j + 1 &lt;= m)suf[i][j] = max(suf[i][j], suf[i][j + 1] + a[i][j]);
        }
    }
    vector&lt;vector&lt;int&gt;&gt;dis(n + 1, vector&lt;int&gt;(m + 1));
    rep(i, 1, n) {
        rep(j, 1, m) {
            int p = -inf, s = -inf;
            if (i - 1 &gt;= 1)p = max(p, pre[i - 1][j]);
            if (j - 1 &gt;= 1)p = max(p, pre[i][j - 1]);
            if (i + 1 &lt;= n)s = max(s, suf[i + 1][j]);
            if (j + 1 &lt;= m)s = max(s, suf[i][j + 1]);
            dis[i][j] = a[i][j];
            if (s != -inf)dis[i][j] += s;
            if (p != -inf)dis[i][j] += p;
        }
    }
    vector&lt;vector&lt;int&gt;&gt;RU(n + 5, vector&lt;int&gt;(m + 5, -inf));
    vector&lt;vector&lt;int&gt;&gt;LD(n + 5, vector&lt;int&gt;(m + 5, -inf));
    per(i, n, 1) {
        rep(j, 1, m) {
            LD[i][j] = dis[i][j];
            if (i + 1 &lt;= n)LD[i][j] = max(LD[i][j], LD[i + 1][j]);
            if (j - 1 &gt;= 1)LD[i][j] = max(LD[i][j], LD[i][j - 1]);
        }
    }
    rep(i, 1, n) {
        per(j, m, 1) {
            RU[i][j] = dis[i][j];
            if (i - 1 &gt;= 1)RU[i][j] = max(RU[i][j], RU[i - 1][j]);
            if (j + 1 &lt;= m)RU[i][j] = max(RU[i][j], RU[i][j + 1]);
        }
    }
    int ans = inf;
    rep(i, 1, n) {
        rep(j, 1, m) {
            int res = dis[i][j] - 2 * a[i][j];
            res = max(res, max(RU[i - 1][j + 1], LD[i + 1][j - 1]));
            ans = min(ans, res);
        }
    }
    cout &lt;&lt; ans &lt;&lt; '\n';
}
 
signed main() {
    ios::sync_with_stdio(0);
    cin.tie(0), cout.tie(0);
    int t = 1;
    cin &gt;&gt; t;
    while (t--)solve();
}
</code></pre>
<h1 id="f1-åæ¯æ ç®åçæ¬">F1. <a href="https://codeforces.com/contest/2194/problem/F1" target="_blank" rel="noopener nofollow">åæ¯æ ...ï¼ç®åçæ¬ï¼</a></h1>
<ul>
<li>
<h1 id="dp-æ ä¸dp-ç¶æåç¼©-ä½è¿ç®">dp #æ ä¸dp #ç¶æåç¼© #ä½è¿ç®</h1>
</li>
</ul>
<p>æ¶é´éå¶æ¯æ¬¡æµè¯1ç§<br>
åå­éå¶æ¯æ¬¡æµè¯1024 MB</p>
<p>è¿æ¯é®é¢çç®åçæ¬ãä¸åçæ¬ä¹é´çåºå«å¨äºï¼å¨è¿ä¸ªçæ¬ä¸­ï¼<span class="math inline">\(k \leq 4\)</span>ãåªæå¨ä½ è§£å³äºæ­¤é®é¢çææçæ¬çæåµä¸æè½è¿è¡é»å®¢æ»å»ã</p>
<p>ç»å®ä¸æ£µåå« <span class="math inline">\(n\)</span> ä¸ªé¡¶ç¹çæ ãæ¯ä¸ªé¡¶ç¹ä¸åæä¸ä¸ªéè´æ´æ° <span class="math inline">\(a_v\)</span>ãåæ¶ç»ä½  <span class="math inline">\(k\)</span> ä¸ªä¸åçéè´æ´æ° <span class="math inline">\(b_1, \ldots, b_k\)</span>ã</p>
<p>å¦æä¸ä¸ªè¾¹çéåæ¯ç¾ä¸½çï¼å½ä»æ ä¸­ç§»é¤è¿äºè¾¹åï¼æ ä¼åè£æè¥å¹²ä¸ªè¿éåéï¼å¶ä¸­æ¯ä¸ªåéåææ <span class="math inline">\(a_v\)</span> å¼çæä½å¼æï¼bitwise XORï¼å±äºéå <span class="math inline">\(b\)</span>ã</p>
<p>ä½ éè¦è®¡ç®ç¾ä¸½çè¾¹éåçæ°éï¼ç»æå¯¹ <span class="math inline">\(10^9+7\)</span> åæ¨¡ã</p>
<h2 id="è¾å¥-4">è¾å¥</h2>
<p>æ¯ä¸ªæµè¯åå«å¤ä¸ªæµè¯ç¨ä¾ãç¬¬ä¸è¡åå«æµè¯ç¨ä¾çæ°é <span class="math inline">\(t\)</span>ï¼<span class="math inline">\(1 \leq t \leq 500\)</span>ï¼ãéåæ¯æ¯ä¸ªæµè¯ç¨ä¾çæè¿°ã</p>
<p>æ¯ä¸ªæµè¯æ°æ®çç¬¬ä¸è¡åå«ä¸¤ä¸ªæ´æ° <span class="math inline">\(n\)</span> å <span class="math inline">\(k\)</span>ï¼<span class="math inline">\(2 \leq n \leq 10^5\)</span>ï¼<span class="math inline">\(1 \leq k \leq 4\)</span>ï¼ââæ ä¸­é¡¶ç¹çæ°éåéå <span class="math inline">\(b\)</span> çå¤§å°ã</p>
<p>æ¥ä¸æ¥ç <span class="math inline">\(n-1\)</span> è¡æè¿°æ çè¾¹ãç¬¬ <span class="math inline">\(i\)</span> è¡åå«ä¸¤ä¸ªæ´æ° <span class="math inline">\(v_i\)</span> å <span class="math inline">\(u_i\)</span>ï¼<span class="math inline">\(1 \leq v_i, u_i \leq n\)</span>ï¼ââç¬¬ <span class="math inline">\(i\)</span> æ¡è¾¹è¿æ¥çä¸¤ä¸ªé¡¶ç¹ç¼å·ã</p>
<p>æ¥ä¸æ¥ä¸è¡åå« <span class="math inline">\(n\)</span> ä¸ªæ´æ° <span class="math inline">\(a_1, a_2, \ldots, a_n\)</span>ï¼<span class="math inline">\(0 \leq a_i &lt; 2^{30}\)</span>ï¼ââåå¨é¡¶ç¹ä¸çå¼ã</p>
<p>éåä¸è¡åå« <span class="math inline">\(k\)</span> ä¸ªä¸åçæ´æ° <span class="math inline">\(b_1, b_2, \ldots, b_k\)</span>ï¼<span class="math inline">\(0 \leq b_i &lt; 2^{30}\)</span>ï¼ââéå <span class="math inline">\(b\)</span> çåç´ ã</p>
<p>ä¿è¯æææµè¯æ°æ®ç <span class="math inline">\(n\)</span> æ»åä¸è¶è¿ <span class="math inline">\(10^5\)</span>ã</p>
<h2 id="è¾åº-4">è¾åº</h2>
<p>å¯¹äºæ¯ä¸ªæµè¯æ°æ®ï¼è¾åºä¸ä¸ªæ´æ°ââé®é¢çç­æ¡ã<br>
<img src="https://i-blog.csdnimg.cn/direct/5fb94e47c9b948bfab1978b1691f845c.png" alt="![[2a2092f4086e1a411ce476deee506c62e3dec616.webp]]" loading="lazy"></p>
<h2 id="æè·¯-5">æè·¯</h2>
<p>é¦åéè¦äºè§£å³äºå¼æç©ºé´çæ°å­¦æ§è´¨ï¼<br>
å¯¹äº<span class="math inline">\(s_{b}=\{ b_{1},b_{2},\dots,b_{k} \}\)</span>ï¼å¶ä¸­ä»»éä»»ææ°éçåç´ è¿è¡å¼æï¼å°æå¾çææå¯è½æ¾å¥å¦ä¸ä¸ªéå<span class="math inline">\(B\)</span>ï¼é£ä¹å¦ä¸ä¸ªéåçå¤§å°ä¸º<span class="math inline">\(|B|=O(2^{k})\)</span><br>
å¦æ<span class="math inline">\(x\oplus y\in s_{b}\)</span>é£ä¹å¿ç¶è¦æ<span class="math inline">\(x\in B\)</span>ä¸<span class="math inline">\(y\in B\)</span></p>
<p>å¯¹äºç®åçï¼<span class="math inline">\(k\leq{4}\)</span>ï¼<span class="math inline">\(|B|\leq 16\)</span>ï¼ä¹å°±æ¯è¯´ï¼æä»¬dpè½¬ç§»å¯ä»¥æ´åæä¸¾è¿<span class="math inline">\(16\)</span>ä¸ªæ°</p>
<p>å æ­¤ï¼é¦åæä»¬åéè¿äºè¿å¶æä¸¾å°è¿ä¸ª<span class="math inline">\(B\)</span>éåæé åºæ¥</p>
<p>æ¥ä¸æ¥è¿è¡æ ä¸dpï¼</p>
<p>ç¶æè®¾è®¡ï¼</p>
<ul>
<li><span class="math inline">\(dp[u][x]\)</span>è¡¨ç¤ºå¨ä»¥<span class="math inline">\(u\)</span>ä¸ºæ ¹çå­æ ä¸­ï¼å·²ç»åæäºä¸äºè¾¹ï¼ææååºæ¥çåéçå¼æåä¸º<span class="math inline">\(x\)</span>çæ¹æ¡æ°ãç¹å«æ³¨æï¼åå«ç¹<span class="math inline">\(u\)</span>çè¿éåæ²¡æç®è¿<span class="math inline">\(x\)</span>ä¸­ï¼å ä¸ºè¿æ²¡æå³ç­å®æ¯å¦éè¦æ­è¾¹</li>
<li>è®¾<span class="math inline">\(S[u]\)</span>ä¸º<span class="math inline">\(u\)</span>çå­æ åçå¼æåï¼å<span class="math inline">\(u\)</span>æå¨è¿éåçå¼æåä¸º<span class="math inline">\(S[u]\oplus x\)</span>ï¼è¿ä¾¿æ¯ä¸ºä»ä¹è¦å°ç¬¬äºç»´è®¾è®¡æå·²ç»åæçè¿éåçå¼æå</li>
</ul>
<p>åå§ç¶æï¼</p>
<ul>
<li><span class="math inline">\(dp[u][0]=1\)</span>ï¼è¡¨ç¤ºæ²¡æè¾¹å¯ä»¥åï¼ä¹å°±æå³çè¢«åæçå¼æåä¸º0ï¼è¿æ ·çæ¹æ¡æä¸ä¸ª</li>
<li><span class="math inline">\(dp[u][x]=0\)</span>å¶ä½çç½®0</li>
</ul>
<p>ç¶æè½¬ç§»ï¼</p>
<ul>
<li>è®¾å½å<span class="math inline">\(u\)</span>å·²æçç¶æä¸º<span class="math inline">\(dp[u][x]\)</span>ï¼å¿å­<span class="math inline">\(son\)</span>çç¶æä¸º<span class="math inline">\(dp[son][y]\)</span>ï¼æä¸¾æ¶ä¿è¯<span class="math inline">\(x\in B,y\in B\)</span></li>
<li>ä¸åè¾¹<span class="math inline">\(u\to son\)</span>ï¼
<ul>
<li><span class="math inline">\(son\)</span>æå¨çè¿éåå°ä¸<span class="math inline">\(u\)</span>çè¿å¨ä¸èµ·</li>
<li><span class="math inline">\(son\)</span>å­æ åè¢«ååºæ¥çè¿éåå¨é¨å¹¶å¥<span class="math inline">\(u\)</span>ååºæ¥çè¿éåä¸­</li>
<li><span class="math inline">\(ndp[x\oplus y]+=dp[u][x]\cdot dp[son][y]\cdot[x\oplus y\in B]\)</span></li>
</ul>
</li>
<li>åæè¾¹<span class="math inline">\(u\to son\)</span>
<ul>
<li>å¦æè¿æ¡è¾¹è½å¤åæï¼åå¿é¡»æ»¡è¶³<span class="math inline">\(son\)</span>æå¨çè¿éåçå¼æåå¿é¡»å¨éå<span class="math inline">\(s_{b}\)</span>ä¸­ï¼å³<span class="math inline">\(S[son]\oplus y\in s_{b}\)</span></li>
<li>æ­¤æ¶<span class="math inline">\(u\)</span>å­æ åè¢«åæçè¿éåçå¼æååä¸ºäº<span class="math inline">\(x\oplus y\oplus(S[u]\oplus y)=x\oplus S[u]\)</span></li>
<li><span class="math inline">\(ndp[x\oplus S[son]]+=dp[u][x]\cdot dp[son][y]\cdot[S[son]\oplus y\in s_{b}]\cdot[x\oplus S[son]\in B]\)</span></li>
<li>æ³¨æå°æ¬æ¡éæ¨ç­å¼å·¦ç«¯åªæ<span class="math inline">\(x\)</span>ï¼æä»¥å¯ä»¥å°æä¸¾<span class="math inline">\(y\)</span>çè¿ç¨è¿è¡æ±åï¼<span class="math inline">\(ndp[x\oplus S[son]]+=dp[u][x]\cdot \sum_{S[son]\oplus y\in s_{b}}dp[son][y]\)</span></li>
<li>å æ­¤å¯ä»¥å¨å¾ªç¯ä¹ååé¢å¤çä¸ä¸ªå¸¸æ°<span class="math inline">\(w=\sum_{S[son]\oplus y\in s_{b}}dp[son][y]\)</span></li>
<li><span class="math inline">\(ndp[x\oplus S[son]]+=dp[u][x]\cdot w\)</span>å³å¯</li>
</ul>
</li>
</ul>
<p>æç»ç­æ¡å³ä¸º:</p>
<p></p><div class="math display">\[ans=\sum_{S[root]\oplus x\in s_{b}}dp[root][x]
\]</div><p></p><p>æ³¨æï¼</p>
<ul>
<li>è®¡ç®çæ¶åæ³¨æåæ¨¡</li>
<li>ä¸è¿°æä¸¾ç<span class="math inline">\(x,y\)</span>ä¸ºå·ä½å¼ï¼å¨dpçè¿ç¨ä¸­éè¦éè¿ä¸ä¸ªæ å°æ¥å°å¼æ å°å<span class="math inline">\([1,16]\)</span>çèå´ä¸­</li>
</ul>
<h2 id="ä»£ç -5">ä»£ç </h2>
<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
using namespace std;
#define ll long long
#define int ll 
#define rep(i,a,b) for(int i=(a);i&lt;=(b);i++)
#define per(i,a,b) for(int i=(a);i&gt;=(b);i--)

const int N = 1e5 + 5, mod = 1e9 + 7;
int n, k, S[N], b[5], a[N];
map&lt;int, int&gt;id;
set&lt;int&gt;sb;
vector&lt;int&gt;B;
int nb;
vector&lt;int&gt;e[N];
vector&lt;vector&lt;int&gt;&gt;dp;
void dfs(int u, int fa) {
    S[u] = a[u];
    for (auto son : e[u]) {
        if (son == fa)continue;
        dfs(son, u);
        S[u] ^= S[son];
    }
}

void dfs1(int u, int fa) {
    dp[u][0] = 1;
    for (auto son : e[u]) {
        if (son == fa)continue;
        dfs1(son, u);
        vector&lt;int&gt;ndp(17, 0);
        int w = 0;
        rep(i, 0, nb - 1) {
            int y = B[i] ^ S[son];
            if (sb.count(y)) {
                w += dp[son][i];
                w %= mod;
            }
        }
        rep(i, 0, nb - 1) {
            int x = B[i];
            rep(j, 0, nb - 1) {
                int y = B[j];
                if (id.count(x ^ y)) {
                    ndp[id[x ^ y]] += dp[u][i] * dp[son][j] % mod;
                    ndp[id[x ^ y]] %= mod;
                }
            }
            if (id.count(x ^ S[son])) {
                ndp[id[x ^ S[son]]] += dp[u][i] * w % mod;
                ndp[id[x ^ S[son]]] %= mod;
            }
        }
        dp[u] = ndp;
    }
}

void solve() {
    cin &gt;&gt; n &gt;&gt; k;
    B.clear();
    id.clear();
    sb.clear();
    dp.assign(n + 1, vector&lt;int&gt;(17, 0));
    rep(i, 1, n)e[i].clear();
    rep(i, 1, n - 1) {
        int u, v;cin &gt;&gt; u &gt;&gt; v;
        e[u].push_back(v);
        e[v].push_back(u);
    }
    rep(i, 1, n)cin &gt;&gt; a[i];
    rep(i, 1, k)cin &gt;&gt; b[i], sb.insert(b[i]);
    rep(mk, 0, (1ll &lt;&lt; k) - 1) {
        int now = 0;
        rep(pos, 0, k - 1) {
            if ((mk &gt;&gt; pos) &amp; 1)now ^= b[pos + 1];
        }
        B.push_back(now);
    }
    sort(B.begin(), B.end());
    nb = unique(B.begin(), B.end()) - B.begin();
    while (B.size() != nb)B.pop_back();
    rep(i, 0, B.size() - 1) {
        id[B[i]] = i;
    }
    dfs(1, 0);
    dfs1(1, 0);
    int ans = 0;
    rep(i, 0, nb - 1) {
        if (sb.count(B[i] ^ S[1])) {
            ans += dp[1][i];
            ans %= mod;
        }
    }
    cout &lt;&lt; ans &lt;&lt; '\n';
}

signed main() {
    ios::sync_with_stdio(0);
    cin.tie(0), cout.tie(0);
    int t = 1;
    cin &gt;&gt; t;
    while (t--)solve();
}
</code></pre>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-11 16:26">2026-02-11 16:26</span>&nbsp;
<a href="https://www.cnblogs.com/CUC-MenG">CUC-MenG</a>&nbsp;
éè¯»(<span id="post_view_count">23</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19605002);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19605002', targetLink: 'https://www.cnblogs.com/CUC-MenG/p/19605002', title: 'Codeforces Round 1078 (Div. 2) A,B,C,D,E,F1ä¸ªäººé¢è§£' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ V4L2 vs GStreamer vs FFmpegï¼Linuxå¤åªä½å¤ççä¸ä¸ªå±çº§ ]]></title>
    <link>https://www.cnblogs.com/tlink/p/19604853</link>
    <guid>902b6406f33b1df54ad469d0ad5f11ad</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/tlink/p/19604853" title="åå¸äº 2026-02-11 15:55">
    <span role="heading" aria-level="2">V4L2 vs GStreamer vs FFmpegï¼Linuxå¤åªä½å¤ççä¸ä¸ªå±çº§</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/394390/202602/394390-20260211155518455-1216702517.png" alt="V4L2 vs GStreamer vs FFmpegï¼Linuxå¤åªä½å¤ççä¸ä¸ªå±çº§" class="desc_img">
        V4L2ãGStreamer å FFmpegï¼çæ¸å®ä»¬ä¹é´çå³ç³»ãåºå«åéç¨åºæ¯
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ¬æè¯¦ç»è§£æ Linux ç³»ç»ä¸­ä¸ä¸ªå³é®çå¤åªä½ææ¯ï¼V4L2ãGStreamer å FFmpegï¼çæ¸å®ä»¬ä¹é´çå³ç³»ãåºå«åéç¨åºæ¯ã</p>
<h2 id="-æ¦è¿°">ð æ¦è¿°</h2>
<ul>
<li><strong>V4L2</strong>ï¼Linux è®¿é®æåå¤´ç<strong>åºå±æ åæ¥å£</strong>ï¼é©±å¨å±ï¼</li>
<li><strong>GStreamer</strong>ï¼æå»ºè§é¢å¤çæµæ°´çº¿ç<strong>åºç¨æ¡æ¶</strong>ï¼æ¡æ¶å±ï¼</li>
<li><strong>FFmpeg</strong>ï¼å¼ºå¤§çå¤åªä½<strong>å·¥å·ç®±</strong>ï¼å·¥å·å±ï¼</li>
</ul>
<h2 id="-æ ¸å¿æ¦å¿µè§£æ">ð¯ æ ¸å¿æ¦å¿µè§£æ</h2>
<h3 id="1-v4l2---è§é¢ééçåºç³">1. V4L2 - è§é¢ééçåºç³</h3>
<p><strong>Video for Linux 2</strong>ï¼Linux è§é¢æ¡æ¶ç¬¬ 2 çï¼æ¯ Linux åæ ¸ä¸­è§é¢è®¾å¤é©±å¨çæ åæ¥å£ã</p>
<h4 id="-ä¸»è¦åè½">ð§ ä¸»è¦åè½ï¼</h4>
<ul>
<li>æä¾ç»ä¸æ¥å£è®¿é®ææè§é¢è®¾å¤</li>
<li>æ§å¶æåå¤´åæ°ï¼åè¾¨çãå¸§çãæ ¼å¼ç­ï¼</li>
<li>ç®¡çè§é¢ç¼å²åº</li>
<li>æ¯ææµå¼ä¼ è¾</li>
</ul>
<h4 id="-è®¾å¤æä»¶">ð è®¾å¤æä»¶ï¼</h4>
<pre><code class="language-bash">/dev/video0    # ç¬¬ä¸ä¸ªæåå¤´
/dev/video1    # ç¬¬äºä¸ªæåå¤´
/dev/video2    # å¯è½æ¯ä¸ä¸ªæåå¤´çä¸åæµ
</code></pre>
<h4 id="ï¸-å¸¸ç¨å·¥å·">ð ï¸ å¸¸ç¨å·¥å·ï¼</h4>
<pre><code class="language-bash"># æ¥çè®¾å¤
v4l2-ctl --list-devices

# æ¥çæ¯æçæ ¼å¼
v4l2-ctl --list-formats --device /dev/video0

# è®¾ç½®åè¾¨ç
v4l2-ctl --set-fmt-video=width=640,height=480 --device /dev/video0

# æç§
v4l2-ctl --device /dev/video0 --stream-mmap=3 --stream-to=photo.jpg
</code></pre>
<h3 id="2-gstreamer---å¤åªä½æµæ°´çº¿æ¡æ¶">2. GStreamer - å¤åªä½æµæ°´çº¿æ¡æ¶</h3>
<p>GStreamer æ¯ä¸ä¸ªåºäºç®¡éçå¤åªä½æ¡æ¶ï¼éç¨æä»¶åè®¾è®¡ï¼éåæå»ºå¤æçå®æ¶æµåªä½åºç¨ã</p>
<h4 id="ï¸-æ ¸å¿æ¦å¿µ">ðï¸ æ ¸å¿æ¦å¿µï¼</h4>
<ul>
<li><strong>Pipelineï¼ç®¡éï¼</strong>ï¼è¿æ¥å¤ä¸ªåç´ çå®æ´å¤çæµç¨</li>
<li><strong>Elementï¼åç´ ï¼</strong>ï¼å¤çååï¼sourceãfilterãsinkï¼</li>
<li><strong>Padï¼è¿æ¥ç¹ï¼</strong>ï¼åç´ ä¹é´çæ°æ®è¿æ¥æ¥å£</li>
<li><strong>Capsï¼è½åï¼</strong>ï¼æè¿°æ°æ®æ ¼å¼çåæ°æ®</li>
</ul>
<p><img alt="1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/394390/202602/394390-20260211155105802-642991192.png" class="lazyload"></p>
<h4 id="-å¸åæµæ°´çº¿">ð å¸åæµæ°´çº¿ï¼</h4>
<pre><code class="language-bash"># æ¾ç¤ºæåå¤´
gst-launch-1.0 v4l2src device=/dev/video0 ! videoconvert ! autovideosink

# å½å¶è§é¢
gst-launch-1.0 v4l2src ! videoconvert ! x264enc ! mp4mux ! filesink location=output.mp4

# OpenCV ä½¿ç¨
std::string pipeline = "v4l2src ! videoconvert ! video/x-raw,format=BGR ! appsink";
cv::VideoCapture cap(pipeline, cv::CAP_GSTREAMER);
</code></pre>
<h3 id="3-ffmpeg---å¤åªä½çå£«åå">3. FFmpeg - å¤åªä½çå£«åå</h3>
<p>FFmpeg æ¯ä¸å¥å®æ´çè·¨å¹³å°è§£å³æ¹æ¡ï¼ç¨äºè®°å½ãè½¬æ¢åæµå¼ä¼ è¾é³é¢åè§é¢ã</p>
<h4 id="-æ ¸å¿ç»ä»¶">ð¯ æ ¸å¿ç»ä»¶ï¼</h4>
<ul>
<li><strong>ffmpeg</strong>ï¼å½ä»¤è¡å·¥å·ï¼ç¨äºæ ¼å¼è½¬æ¢</li>
<li><strong>ffplay</strong>ï¼ç®åçåªä½æ­æ¾å¨</li>
<li><strong>ffprobe</strong>ï¼å¤åªä½æµåæå¨</li>
<li><strong>libav</strong>*ï¼ä¾å¼åèä½¿ç¨çåº</li>
</ul>
<h4 id="-å¸åç¨æ³">ð å¸åç¨æ³ï¼</h4>
<pre><code class="language-bash"># æ¾ç¤ºæåå¤´
ffplay -f v4l2 -i /dev/video0 -video_size 640x480

# æ ¼å¼è½¬æ¢
ffmpeg -i input.mp4 output.avi

# è§é¢å¤ç
ffmpeg -i input.mp4 -vf "scale=640:480" output.mp4

# OpenCV ä½¿ç¨
cv::VideoCapture cap("video.mp4", cv::CAP_FFMPEG);
</code></pre>
<h2 id="-ä¸èå¯¹æ¯è¡¨">ð ä¸èå¯¹æ¯è¡¨</h2>
<table>
<thead>
<tr>
<th>ç¹æ§</th>
<th>V4L2</th>
<th>GStreamer</th>
<th>FFmpeg</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å±çº§å®ä½</strong></td>
<td>é©±å¨å±/åæ ¸æ¥å£</td>
<td>åºç¨æ¡æ¶å±</td>
<td>åºç¨å·¥å·å±</td>
</tr>
<tr>
<td><strong>ä¸»è¦ç¨é</strong></td>
<td>ç¡¬ä»¶è®¾å¤è®¿é®</td>
<td>å®æ¶æµå¤ç</td>
<td>æä»¶æ ¼å¼è½¬æ¢</td>
</tr>
<tr>
<td><strong>è®¾è®¡å²å­¦</strong></td>
<td>æ åç¡¬ä»¶æ¥å£</td>
<td>æ¨¡ååæµæ°´çº¿</td>
<td>ä¸ä½åå·¥å·é</td>
</tr>
<tr>
<td><strong>ç¼ç¨æ¥å£</strong></td>
<td>ç³»ç»è°ç¨/ioctl</td>
<td>C API/ç®¡éæè¿°</td>
<td>å½ä»¤è¡/åºAPI</td>
</tr>
<tr>
<td><strong>æä»¶ç³»ç»</strong></td>
<td>æ ï¼é©±å¨çº§å«ï¼</td>
<td>è¿è¡æ¶å¨æå è½½</td>
<td>ç¼è¯æ¶é¾æ¥</td>
</tr>
<tr>
<td><strong>å­¦ä¹ æ²çº¿</strong></td>
<td>é¡å³­ï¼éè¦äºè§£åæ ¸ï¼</td>
<td>ä¸­ç­</td>
<td>ç¸å¯¹å¹³ç¼</td>
</tr>
<tr>
<td><strong>å®æ¶æ§</strong></td>
<td>ä¼ç§ï¼ç´æ¥ç¡¬ä»¶è®¿é®ï¼</td>
<td>ä¼ç§</td>
<td>è¯å¥½</td>
</tr>
<tr>
<td><strong>ç¤¾åºè§æ¨¡</strong></td>
<td>ä¸­ç­ï¼Linuxåæ ¸ï¼</td>
<td>å¤§å</td>
<td>éå¸¸åºå¤§</td>
</tr>
<tr>
<td><strong>è¯­è¨ç»å®</strong></td>
<td>ä¸»è¦ä¸ºC</td>
<td>ä¸°å¯ï¼PythonãC++ãRustç­ï¼</td>
<td>æé</td>
</tr>
</tbody>
</table>
<h2 id="ï¸-ææ¯æ¶æå³ç³»">ðï¸ ææ¯æ¶æå³ç³»</h2>
<pre><code>âââââââââââââââââââââââââââââââââââââââââââ
â           åºç¨ç¨åºå±                      â
â  (OpenCVãPythonåºç¨ãèªå®ä¹ç¨åº)          â
âââââââââââââââ¬ââââââââââââââââââââââââââââ
              â
    âââââââââââ´ââââââââââ
    â                   â
âââââ¼âââââââ      âââââââ¼âââââââ
â GStreamerâ      â   FFmpeg   â
â (æ¡æ¶å±)  â      â  (å·¥å·å±)  â
âââââ¬âââââââ      âââââââ¬âââââââ
    â                   â
    âââââââââââ¬ââââââââââ
              â
       ââââââââ¼âââââââ
       â    V4L2     ââââââ å³é®è·¯å¾ï¼
       â (é©±å¨æ¥å£å±) â     ææLinuxè§é¢åºç¨é½è¦ç»è¿è¿é
       ââââââââ¬âââââââ
              â
       ââââââââ¼âââââââ
       â  æåå¤´é©±å¨  â
       â  (åæ ¸å±)   â
       ââââââââ¬âââââââ
              â
       ââââââââ¼âââââââ
       â  æåå¤´ç¡¬ä»¶  â
       â (USB/CSIç­) â
       âââââââââââââââ
</code></pre>
<h3 id="ç±»æ¯æä»¶ç³»ç»">ç±»æ¯æä»¶ç³»ç»</h3>
<ul>
<li><strong>V4L2</strong> = <strong>æä»¶æä½API</strong>ï¼open/read/writeï¼</li>
<li><strong>GStreamer</strong> = <strong>ææ¬å¤çæµæ°´çº¿</strong>ï¼cat | grep | sedï¼</li>
<li><strong>FFmpeg</strong> = <strong>æä»¶æ ¼å¼è½¬æ¢å·¥å·</strong>ï¼unzipãtarç­ï¼</li>
</ul>
<h2 id="-å¦ä½éæ©">ð¡ å¦ä½éæ©ï¼</h2>
<h3 id="å½ä½¿ç¨-v4l2">å½ä½¿ç¨ V4L2ï¼</h3>
<p>â éè¦ç´æ¥æ§å¶æåå¤´ç¡¬ä»¶åæ°<br>
â å¼ååºå±é©±å¨ç¨åº<br>
â éè¦æå°åå»¶è¿<br>
â è¿è¡æ§è½åºåæµè¯</p>
<h3 id="å½ä½¿ç¨-gstreamer">å½ä½¿ç¨ GStreamerï¼</h3>
<p>â æå»ºå®æ¶è§é¢å¤çåºç¨<br>
â éè¦å¤æçå¤çæµæ°´çº¿<br>
â å¼å GUI å¤åªä½åºç¨<br>
â éè¦æä»¶åæ¶æ<br>
â å¤çç½ç»æµåªä½</p>
<h3 id="å½ä½¿ç¨-ffmpeg">å½ä½¿ç¨ FFmpegï¼</h3>
<p>â æ¹éè½¬æ¢è§é¢æ ¼å¼<br>
â æ§è¡ç®åçå¤åªä½ä»»å¡<br>
â éè¦ä¸°å¯çç¼è§£ç å¨æ¯æ<br>
â å¿«éååå¼å<br>
â ä¸æ³åå¤ªå¤ä»£ç </p>
<h2 id="-å®éå¼åç¤ºä¾">ð§ å®éå¼åç¤ºä¾</h2>
<h3 id="opencv-ä¸­çä¸åè®¿é®æ¹å¼">OpenCV ä¸­çä¸åè®¿é®æ¹å¼ï¼</h3>
<pre><code class="language-cpp">// æ¹å¼1ï¼èªå¨éæ©åç«¯
cv::VideoCapture cap(0);

// æ¹å¼2ï¼ä½¿ç¨ V4L2 ç´æ¥è®¿é®
cv::VideoCapture cap(0, cv::CAP_V4L2);

// æ¹å¼3ï¼ä½¿ç¨ GStreamer æµæ°´çº¿
std::string pipeline = "v4l2src device=/dev/video0 ! "
                       "videoconvert ! "
                       "video/x-raw,format=BGR ! "
                       "appsink";
cv::VideoCapture cap(pipeline, cv::CAP_GSTREAMER);

// æ¹å¼4ï¼ä½¿ç¨ FFmpeg åç«¯
cv::VideoCapture cap("video.mp4", cv::CAP_FFMPEG);
</code></pre>
<h3 id="å¸ååºç¨åºæ¯">å¸ååºç¨åºæ¯ï¼</h3>
<table>
<thead>
<tr>
<th>åºæ¯</th>
<th>æ¨èææ¯</th>
<th>åå </th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>è§é¢çæ§ç³»ç»</strong></td>
<td>GStreamer</td>
<td>éè¦å¤è·¯æµãå®æ¶å¤çãç½ç»ä¼ è¾</td>
</tr>
<tr>
<td><strong>è§é¢ç¼è¾è½¯ä»¶</strong></td>
<td>GStreamer + FFmpeg</td>
<td>GStreameråå®æ¶é¢è§ï¼FFmpegåå¯¼åº</td>
</tr>
<tr>
<td><strong>æ¹éæ ¼å¼è½¬æ¢</strong></td>
<td>FFmpeg</td>
<td>å½ä»¤è¡ç®åé«æ</td>
</tr>
<tr>
<td><strong>æåå¤´é©±å¨å¼å</strong></td>
<td>V4L2</td>
<td>ç´æ¥ä¸ç¡¬ä»¶äº¤äº</td>
</tr>
<tr>
<td><strong>åµå¥å¼è§è§åºç¨</strong></td>
<td>V4L2 + GStreamer</td>
<td>V4L2è·åæ°æ®ï¼GStreamerå¤ç</td>
</tr>
<tr>
<td><strong>å¿«éèæ¬å·¥å·</strong></td>
<td>FFmpeg</td>
<td>ä¸è¡å½ä»¤å®æä»»å¡</td>
</tr>
</tbody>
</table>
<h2 id="-æ§è½å¯¹æ¯">ð æ§è½å¯¹æ¯</h2>
<table>
<thead>
<tr>
<th>ä»»å¡ç±»å</th>
<th>V4L2</th>
<th>GStreamer</th>
<th>FFmpeg</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åå¸§å»¶è¿</strong></td>
<td>â­â­â­â­â­</td>
<td>â­â­â­â­</td>
<td>â­â­â­</td>
</tr>
<tr>
<td><strong>CPUå ç¨</strong></td>
<td>ä½</td>
<td>ä¸­ç­</td>
<td>é«</td>
</tr>
<tr>
<td><strong>åå­ä½¿ç¨</strong></td>
<td>ä½</td>
<td>ä¸­ç­</td>
<td>é«</td>
</tr>
<tr>
<td><strong>å¤è·¯æµæ¯æ</strong></td>
<td>éè¦æå¨ç®¡ç</td>
<td>å¤©ç¶æ¯æ</td>
<td>éè¦å¤æå½ä»¤</td>
</tr>
<tr>
<td><strong>æ ¼å¼å¼å®¹æ§</strong></td>
<td>æéï¼ç¡¬ä»¶ä¾èµï¼</td>
<td>ä¼ç§ï¼æä»¶ä¸°å¯ï¼</td>
<td>æä½³ï¼æ¯æå¹¿æ³ï¼</td>
</tr>
</tbody>
</table>
<h2 id="-è°è¯æå·§">ð è°è¯æå·§</h2>
<h3 id="1-æåå¤´é®é¢ææ¥">1. æåå¤´é®é¢ææ¥ï¼</h3>
<pre><code class="language-bash"># æ£æ¥è®¾å¤
ls -l /dev/video*
v4l2-ctl --list-devices

# æµè¯æåå¤´
gst-launch-1.0 v4l2src ! autovideosink
ffplay -f v4l2 -i /dev/video0

# æ¥çè¯¦ç»åæ°
v4l2-ctl --all --device /dev/video0
</code></pre>
<h3 id="2-gstreamer-è°è¯">2. GStreamer è°è¯ï¼</h3>
<pre><code class="language-bash"># æ¥çåç´ ä¿¡æ¯
gst-inspect-1.0 v4l2src

# è°è¯è¾åº
GST_DEBUG=*:3 gst-launch-1.0 ...

# æ¥çæ¯æçæ ¼å¼
gst-launch-1.0 v4l2src device=/dev/video0 ! fakesink
</code></pre>
<h3 id="3-ffmpeg-è°è¯">3. FFmpeg è°è¯ï¼</h3>
<pre><code class="language-bash"># æ¥çæ¯ææ ¼å¼
ffmpeg -formats
ffmpeg -codecs

# è¯¦ç»è¾åº
ffmpeg -i input.mp4 -f null - 2&gt;&amp;1 | head -50
</code></pre>
<h2 id="-æ»ç»">ð æ»ç»</h2>
<table>
<thead>
<tr>
<th>ææ¯</th>
<th>æ ¸å¿ä»·å¼</th>
<th>ä¸å¥è¯æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>V4L2</strong></td>
<td>ç»ä¸ç¡¬ä»¶è®¿é®</td>
<td>Linux ä¸è®¿é®æåå¤´çå¯ä¸æ åæ¹å¼</td>
</tr>
<tr>
<td><strong>GStreamer</strong></td>
<td>çµæ´»æµæ°´çº¿å¤ç</td>
<td>æå»ºå¤æå¤åªä½åºç¨çæ¡æ¶</td>
</tr>
<tr>
<td><strong>FFmpeg</strong></td>
<td>å¼ºå¤§ç¼è§£ç è½å</td>
<td>å¤çå¤åªä½æä»¶ççå£«åå</td>
</tr>
</tbody>
</table>
<h2 id="-ä¸èåä½">ð¤ ä¸èåä½</h2>
<p>å¨å®éé¡¹ç®ä¸­ï¼ä¸èå¸¸å¸¸ååå·¥ä½ï¼</p>
<pre><code class="language-bash"># åºæ¯ï¼å®æ¶è§é¢åæç³»ç»
# 1. V4L2 ééåå§è§é¢
# 2. GStreamer è¿è¡å®æ¶å¤çååæ
# 3. FFmpeg å½å¶çæ®µæè½¬ç å­å¨

# æµæ°´çº¿ç¤ºä¾
gst-launch-1.0 v4l2src ! \
tee name=t ! \
queue ! videoconvert ! xvimagesink \
t. ! queue ! videoconvert ! x264enc ! mp4mux ! filesink location=record.mp4
</code></pre>
<h2 id="-åå±è¶å¿">ð åå±è¶å¿</h2>
<ol>
<li><strong>V4L2</strong>ï¼æç»­åå±ï¼å¢å å¯¹æ°ç¡¬ä»¶çæ¯æ</li>
<li><strong>GStreamer</strong>ï¼å¨åµå¥å¼ãIoTãæ±½è½¦é¢ååºç¨å¢å¤</li>
<li><strong>FFmpeg</strong>ï¼ä»ç¶æ¯è¡ä¸æ åï¼ç¤¾åºæ´»è·</li>
</ol>
<h2 id="-ç¸å³é¾æ¥">ð ç¸å³é¾æ¥</h2>
<ul>
<li><a href="https://www.kernel.org/doc/html/latest/userspace-api/media/v4l/v4l2.html" target="_blank" rel="noopener nofollow">V4L2 å®æ¹ææ¡£</a></li>
<li><a href="https://gstreamer.freedesktop.org/documentation/tutorials/" target="_blank" rel="noopener nofollow">GStreamer å®æ¹æç¨</a></li>
<li><a href="https://ffmpeg.org/documentation.html" target="_blank" rel="noopener nofollow">FFmpeg å®æ¹ææ¡£</a></li>
<li><a href="https://docs.opencv.org/4.x/" target="_blank" rel="noopener nofollow">OpenCV è§é¢I/Oæ¨¡å</a></li>
</ul>
<hr>
<p><strong>å³é®ç¹</strong>ï¼å¨ Linux ä¸ï¼æ è®ºä½ ä½¿ç¨ GStreamer è¿æ¯ FFmpeg è¿æ¯ OpenCVï¼æç»é½è¦éè¿ <strong>V4L2</strong> æ¥ä¸æåå¤´ç¡¬ä»¶éä¿¡ï¼éæ©åéçå·¥å·åå³äºä½ çå·ä½éæ±ååºæ¯ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.001388888888888889" data-date-updated="2026-02-11 15:57">2026-02-11 15:55</span>&nbsp;
<a href="https://www.cnblogs.com/tlink">Tlink</a>&nbsp;
éè¯»(<span id="post_view_count">41</span>)&nbsp;
è¯è®º(<span id="post_comment_count">2</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19604853);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19604853', targetLink: 'https://www.cnblogs.com/tlink/p/19604853', title: 'V4L2 vs GStreamer vs FFmpegï¼Linuxå¤åªä½å¤ççä¸ä¸ªå±çº§' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å¤§æ¨¡åæ¦åå¨æ¥ï¼2026/02/08ï¼ ]]></title>
    <link>https://www.cnblogs.com/xjk15082/p/19606070</link>
    <guid>ec2c029886bf82cdbca925ab58e8b6a4</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xjk15082/p/19606070" title="åå¸äº 2026-02-11 21:45">
    <span role="heading" aria-level="2">å¤§æ¨¡åæ¦åå¨æ¥ï¼2026/02/08ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="1-æ¬å¨æ¦è§">1. æ¬å¨æ¦è§</h2>
<p>æ¬å¨å¤§æ¨¡åè¡ä¸åç°å¤ç»´åº¦ç«äºæ ¼å±ï¼æ¨¡åè°ç¨éæ¦ååºç°æ¾èååï¼Google Gemini 3 Flash Previewå¼ºå¿ç»é¡¶ï¼Kimi K2.5çåå¼å¢é¿ãåå¤§ååå¯éåå¸æ°æ¨¡åï¼OpenAIæ¨åºGPT-5.3-Codexç¼ç æ¨¡åï¼Anthropicåå¸Claude Opus 4.6ï¼ç¾å¢æ¨åºå¤æ¨¡æç»ä¸å¤§æ¨¡åæ¹æ¡STARï¼å¿«æå¯çµAIåå¸3.0çæ¬ï¼ä¸æµ·AIå®éªå®¤åå¸ä¹¦çIntern-S1-Proãç¼ç¨è½åæ¦åä¸­ï¼Kimi K2.5-thinkingæä¸ºå½äº§ç¼ç¨æ¨¡åæ¦é¦ãåæ²¿æ°å­¦è½åæ¦ååºç°éå¤§è°æ´ï¼Claude Opus 4.5 (no thinking)æç»©æ´å¢è·å±åä¸ã</p>
<h2 id="2-éç¹å³æ³¨äºä»¶">2. éç¹å³æ³¨äºä»¶</h2>
<ul>
<li><strong>OpenAIåå¸GPT-5.3-Codexç¼ç æ¨¡å</strong>ï¼2.6ï¼ï¼èåGPT-5.2æ¨çè½åä¸GPT-5.2-Codexç¼ç æ§è½ï¼è¿è¡éåº¦æå25%ï¼æ¯æç»ç«¯æä½ä¸é¿æä»»å¡ãè¯¥æ¨¡åæ¾åä¸èªèº«è®­ç»è°è¯ï¼è¢«å®ä¸ºé¦ä¸ª"é«"ç½ç»å®å¨é£é©ç­çº§ã</li>
<li><strong>Anthropicåå¸Claude Opus 4.6</strong>ï¼2.6ï¼ï¼æ¾èæåç¼ç ãæ¨çä¸ä»£çä»»å¡è½åï¼é¦åç¾ä¸tokenä¸ä¸æçªå£ãTerminal-Bench 2.0ç­è¯æµé¢åï¼GDPval-AAè¶GPT-5.2è¾¾144 Eloåï¼å®ä»·ç»´æ$5/$25æ¯ç¾ä¸tokenä¸åã</li>
<li><strong>ç¾å¢æ¨åºå¤æ¨¡æç»ä¸å¤§æ¨¡åæ¹æ¡STAR</strong>ï¼2.4ï¼ï¼å­ååæ°ç"å å èªåå½æ¶æ + ä»»å¡éè¿è®­ç»"åæ ¸å¿è®¾è®¡ï¼GenEvalçªç ´0.91ï¼å®ç°äº"çè§£è½åä¸ææãçæè½åè¾¾é¡¶å°"çåéçªç ´ã</li>
<li><strong>å¿«æå¯çµAIåå¸3.0çæ¬</strong>ï¼2.4ï¼ï¼æ¨åºè§é¢3.0ä¸Omniæ¨¡åï¼æ¯ææºè½åéãå¾çè§é¢+ä¸»ä½åèãå¤è¯­ç§å¯¹å£åã15ç§é¿è§é¢çæã</li>
<li><strong>ä¸æµ·AIå®éªå®¤åå¸ä¹¦çIntern-S1-Pro</strong>ï¼2.4ï¼ï¼æ ¸å¿ç§å­¦è½åå®ç°è·åï¼é«é¾åº¦ç»¼åå­¦ç§è¯æµç¨³å±AI4Sé¢åå½éé¢åæ°´å¹³ï¼å¤ææ°çé»è¾æ¨çè½åè¾¾å¥¥èµéçæ°´å¹³ï¼é¢åçå®ç§ç æµç¨çæºè½ä½è½åä½å±å¼æºæ¨¡åç¬¬ä¸æ¢¯éã</li>
</ul>
<h2 id="3-æ¦ååå">3. æ¦ååå</h2>
<h3 id="openrouteræ¨¡åè°ç¨éæå">OpenRouteræ¨¡åè°ç¨éæå</h3>
<ul>
<li><strong>æ´ä½è°ç¨é</strong>ï¼Google Gemini 3 Flash Previewå¼ºå¿ç»é¡¶ï¼ä»ä¸å¨ç¬¬2ä½ï¼580B tokensï¼14%å¢é¿ï¼è·åè³æ¬å¨ç¬¬1ä½ï¼791B tokensï¼36%å¢é¿ï¼ï¼åè¶Claude Sonnet 4.5æä¸ºæ¦é¦ï¼Claude Sonnet 4.5éå±æ¬¡å¸­ï¼ä»ä¸å¨ç¬¬1ä½ï¼766B tokensï¼15%å¢é¿ï¼éè³æ¬å¨ç¬¬2ä½ï¼727B tokensï¼5%å¢é¿ï¼ï¼ç¯æ¯è°ç¨éç»å¯¹å¼åå°39B tokensï¼Kimi K2.5çåå¼å¢é¿æ°å¥åä¸ï¼æ¬å¨ä»¥673B tokenså350%çå¢é¿çä½åç¬¬3ï¼èä¸å¨æªè¿å¥ååæ¦åï¼Grok Code Fast 1å¤§å¹ä¸æ»ï¼ä»ä¸å¨ç¬¬3ä½ï¼477B tokensï¼12%å¢é¿ï¼éª¤éè³æ¬å¨ç¬¬8ä½ï¼336B tokensï¼ä¸é30%ï¼ï¼æåä¸è·5ä½ï¼MiniMax M2.1é«éå¢é¿æ°å¥æ¦ï¼æ¬å¨ä»¥371B tokenså115%çå¢é¿çä½åç¬¬7ï¼ä¸å¨æªå¨æ¦åä¸­ã</li>
<li><strong>æ¨¡åå¸å ç</strong>ï¼MoonshotAIçåå¼æåï¼ä»ä¸å¨203B tokensï¼3.5%ï¼ç¬¬7ä½ï¼æ´æ¶¨è³æ¬å¨606B tokensï¼8.8%ï¼ç¬¬5ä½ï¼ï¼ä»½é¢å¢é¿5.3ä¸ªç¾åç¹ï¼æåä¸å2ä½ï¼x-aiå¤§å¹ä¸æ»ï¼ä»ä¸å¨719B tokensï¼12.3%ï¼ç¬¬4ä½ï¼éª¤éè³æ¬å¨587B tokensï¼8.6%ï¼ç¬¬6ä½ï¼ï¼ä»½é¢åå°3.7ä¸ªç¾åç¹ï¼MiniMaxå¼ºå¿å¥æ¦ï¼æ¬å¨ä»¥323B tokensï¼4.7%ï¼æ°è¿å¥ååæ¦åç¬¬7ä½ï¼ä¸å¤§å·¨å¤´ä»½é¢é½éï¼Googleä¿æç¬¬1ä½ä»½é¢ä»24%éè³23%ï¼Anthropicä¿æç¬¬2ä½ä»½é¢ä»17.1%éè³15.4%ï¼OpenAIä¿æç¬¬3ä½ä»½é¢ä»14%éè³13.4%ï¼DeepSeekç¨³ä¸­æè¿ï¼ä»ä¸å¨553B tokensï¼9.4%ï¼ç¬¬5ä½ï¼å¢è³æ¬å¨651B tokensï¼9.5%ï¼ç¬¬4ä½ï¼ï¼è¶è¶x-aiä¸å1ä½ã</li>
<li><strong>æ¨¡åååé</strong>ï¼gpt-oss-120béåº¦å¤§å¹åè½ï¼ä»ä¸å¨ç¬¬2ä½ï¼836 tok/sï¼éª¤éè³æ¬å¨ç¬¬4ä½ï¼447 tok/sï¼ï¼éåº¦ä¸é46%ï¼Llama 3.1 8B Instructæ§ä»·æ¯è·åï¼ä»ä¸å¨ç¬¬9ä½ï¼Cerebrasæä¾ï¼203 tok/sï¼0.10/Mï¼åè³æ¬å¨ç¬¬6ä½ï¼Groqæä¾ï¼306tok/sï¼0.05/Mï¼ï¼éåº¦æå51%ä¸ä»·æ ¼éä½50%ï¼ä¸¤æ¬¾æ¨¡åè·åºååï¼ä¸å¨ç¬¬5ä½çLlama 3.3 70B Instructï¼265 tok/sï¼åç¬¬8ä½çQwen3 Next 80Bï¼233 tok/sï¼æ¬å¨éåºæ¦åï¼ä¸¤æ¬¾æ¨¡åå¥æ¦ï¼Llama 4 Maverickï¼ç¬¬8ä½ï¼181 tok/sï¼åMistral Small Creativeï¼ç¬¬9ä½ï¼180 tok/sï¼æ°è¿å¥ååï¼Gemini 2.5 Flash Lite Previewæç»­æéï¼ä»ä¸å¨ç¬¬10ä½ï¼169 tok/sï¼åè³æ¬å¨ç¬¬7ä½ï¼221 tok/sï¼ï¼éåº¦æå31%ã</li>
<li><strong>ç¼ç¨è°ç¨é</strong>ï¼Kimi K2.5çåå¼å¢é¿ç»é¡¶ï¼ä»ä¸å¨ç¬¬4ä½ï¼139B tokensï¼8.9%ï¼æ´æ¶¨è³æ¬å¨ç¬¬1ä½ï¼463B tokensï¼25.2%ï¼ï¼ä»½é¢æ¿å¢16.3ä¸ªç¾åç¹ï¼Grok Code Fast 1å¤§å¹ä¸æ»ï¼ä»ä¸å¨æ¦é¦ï¼255B tokensï¼16.4%ï¼éª¤éè³æ¬å¨ç¬¬3ä½ï¼173B tokensï¼9.4%ï¼ï¼ä»½é¢åå°7ä¸ªç¾åç¹ï¼MiniMax M2.1å¿«éæåï¼ä»ä¸å¨ç¬¬6ä½ï¼115B tokensï¼7.4%ï¼è·åè³æ¬å¨ç¬¬2ä½ï¼226B tokensï¼12.3%ï¼ï¼ä»½é¢å¢é¿4.9ä¸ªç¾åç¹ï¼Claudeåæ¨¡åä»½é¢é½éï¼Claude Sonnet 4.5ä»ç¬¬2ä½ï¼12.3%ï¼éè³ç¬¬5ä½ï¼7.9%ï¼ï¼Claude Opus 4.5ä»ç¬¬3ä½ï¼10.0%ï¼éè³ç¬¬4ä½ï¼8.7%ï¼ï¼GPT-5.2æç»­æ¶ç¼©ï¼ä»ç¬¬8ä½ï¼61.4B tokensï¼3.9%ï¼éè³ç¬¬9ä½ï¼38.7B tokensï¼2.1%ï¼ï¼åæ¶https://www.arcee.ai/åå¸ç400Båæ°ç¨çMoEå¼æºæ¨¡åTrinity Large Preview (free)æ°è¿å¥ååæ¦åï¼æåç¬¬7ä½ã</li>
</ul>
<h3 id="åé¢åè½åæ¦å">åé¢åè½åæ¦å</h3>
<ul>
<li><strong>ç¼ç¨è½åæ¦åï¼Code Arenaï¼</strong>ï¼Kimi K2.5-thinkingæ°ææ¦åç¬¬5ä½ï¼ä»æ¬¡äºå¾¡ä¸å®¶çæ¨¡åï¼æä¸ºå½äº§ç¼ç¨æ¨¡åæ¦é¦ã</li>
<li><strong>æçå¾è½åæ¦åï¼Artificial Analysis Text to Image Leaderboardï¼</strong>ï¼FLUX.2 [dev] Turboåæ°è¶è¿Nano Bananaï¼äºèæåæä½ï¼åå«æå9ã10ã</li>
<li><strong>çç§è½åæ¦åï¼GPQA LLM Statsï¼</strong>ï¼Claude Opus 4.6ä»¥91.3%çå¾åæåç¬¬4ä½ï¼ä»æ¬¡äºGPT-5.2 ProãGPT 5.2åGemini 3 Proã</li>
<li><strong>åæ²¿æ°å­¦è½åæ¦åï¼EPOCH AI FrontierMathï¼</strong>ï¼Claude Opus 4.5 (no thinking)æç»©æ´å¢è·å±åä¸ï¼ä»ä¸å¨äºç¬¬16ä½ï¼åç¡®ç20.7%ï¼60/290ï¼é£åè³æ¬å¨ç¬¬3ä½ï¼38.3%ï¼111/290ï¼ï¼åç¡®çæå17.6ä¸ªç¾åç¹ï¼å¶æ¬¡æ¯Kimi K2.5 (Fireworks)æ°è¿å¥ååæ¦åï¼ä»¥27.9%ï¼81/290ï¼æåç¬¬10ï¼åä»£äºåç³»åçKimi K2 Thinkingï¼21.4%ï¼ç¬¬15ä½ï¼ã</li>
<li><strong>GAIAæµè¯éæ¦å</strong>ï¼LR AILab of Lenovo CTO Orgåå¸çLemon agentç»é¡¶é¦ä½ã</li>
</ul>
<h2 id="4-æè¡æ¦">4. æè¡æ¦</h2>
<table>
<thead>
<tr>
<th>æµè¯ç±»å</th>
<th>ç¬¬ä¸å</th>
<th>ç¬¬äºå</th>
<th>ç¬¬ä¸å</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¨¡åè°ç¨é</td>
<td>Gemini 3 Flash Preview</td>
<td>Claude Sonnet 4.5</td>
<td>Kimi K 2.5</td>
</tr>
<tr>
<td>å¬å¸å¸å ç</td>
<td>Google</td>
<td>Anthropic</td>
<td>OpenAI</td>
</tr>
<tr>
<td>æ¨¡åéåº¦</td>
<td>gpt-oss-safeguard-20b</td>
<td>Qwen3 32B</td>
<td>gpt-oss-20b</td>
</tr>
<tr>
<td>ç¼ç¨æ¨¡åè°ç¨é</td>
<td>Kimi K 2.5</td>
<td>MiniMax M2.1</td>
<td>Grok Code Fast 1</td>
</tr>
</tbody>
</table>
<h3 id="åå¬å¸æä¸åè½åé¢åæåæ±æ»">åå¬å¸æä¸åè½åé¢åæåæ±æ»</h3>
<table>
<thead>
<tr>
<th>æµè¯ç±»å</th>
<th>é¢åå¬å¸</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¤§è¯­è¨æ¨¡å Text Arena</td>
<td>GoogleãxAIãAnthropicãç¾åº¦ãOpenAIãæºè°±ãé¿éå·´å·´ãæä¹æé¢</td>
</tr>
<tr>
<td>ç¼ç¨è½å Code Arena</td>
<td>AnthropicãOpenAIãGoogleãæºè°±ãMiniMax</td>
</tr>
<tr>
<td>ç¼ç¨è½å LiveCodeBench</td>
<td>OpenAIãAnthropicãGoogle</td>
</tr>
<tr>
<td>ä»£ç å·¥ç¨ä»»å¡è½å SWE-benchLite</td>
<td>åºäºClaudeãGeminiãGPTãQwenãDeepSeekå¼åçå¼æºç³»ç»</td>
</tr>
<tr>
<td>å¾åç¼è¾åçæè½å Image Edit Arena</td>
<td>OpenAIãGoogleãå­èãè¾è®¯ãBlack Forest LabsãReve</td>
</tr>
<tr>
<td>æçå¾è½å Text-to-Image Arena</td>
<td>OpenAIãGoogleãBlack Forest Labsãè¾è®¯</td>
</tr>
<tr>
<td>å¾åç¼è¾åçæè½å Image Editing Leaderboard</td>
<td>OpenAIãGoogleãå­èãBlack Forest Labsãé¿éå·´å·´ãReve</td>
</tr>
<tr>
<td>æçå¾è½å Text to Image Leaderboard</td>
<td>OpenAIãGoogleãBlack Forest Labsãå­èãFal</td>
</tr>
<tr>
<td>GPQA</td>
<td>OpenAIãGoogleãAnthropicãxAIãé¿éå·´å·´</td>
</tr>
<tr>
<td>FrontierMath</td>
<td>OpenAIãGoogleãAnthropicãDeepSeekãæä¹æé¢ãxAI</td>
</tr>
<tr>
<td>Humanity's Last Exam</td>
<td>GoogleãOpenAIãAnthropic</td>
</tr>
<tr>
<td>GAIA</td>
<td>LR AILab of Lenovo CTO OrgãJoinAIãNvidiaãSuzhou AI Lab&amp;Shuqian TechãMicrosoft AI Asia -AdsãShawnAgentãZTE-AICloud</td>
</tr>
</tbody>
</table>
<hr>
<p>å³æ³¨æï¼ç¬¬ä¸æ¶é´ææ¡æ´å¤AIåæ²¿èµè®¯ï¼</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-11 21:45">2026-02-11 21:45</span>&nbsp;
<a href="https://www.cnblogs.com/xjk15082">KAIæºä¹ </a>&nbsp;
éè¯»(<span id="post_view_count">10</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19606070);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19606070', targetLink: 'https://www.cnblogs.com/xjk15082/p/19606070', title: 'å¤§æ¨¡åæ¦åå¨æ¥ï¼2026/02/08ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ MyBatis XML éï¼![CDATA[ ]]ï¼çä½¿ç¨ ]]></title>
    <link>https://www.cnblogs.com/yanshajiuzhou/p/19606003</link>
    <guid>e58606048e7207ad27fc3bfb3a22912f</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yanshajiuzhou/p/19606003" title="åå¸äº 2026-02-11 21:15">
    <span role="heading" aria-level="2">MyBatis XML éï¼![CDATA[ ]]ï¼çä½¿ç¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
         æ¯ MyBatis ä¸­å¤ç SQL è¯­å¥ä¸ XML è¯­æ³å²çªçå®å¨å±éãå¯¹åå« ç¹æ®å­ç¬¦ ç SQL çæ®µè¿è¡æå°èå´ç CDATA åè£¹ï¼æ¢ä¿è¯äºå®å¨ï¼åç¡®ä¿äº MyBatis å¨æ SQL åè½çå®æ´æ§ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>ä»å¤©æä»¬æ¥èè&nbsp;MyBatis XML æä»¶éç&nbsp;<strong>&lt;![CDATA[ ]]&gt;</strong> ï¼æä¾ç¨è®°å¾æç¬¬ä¸æ¬¡çå°&nbsp;<strong>&lt;![CDATA[ ]]&gt;</strong>ï¼å¿æ³ï¼è¿æ¯ä¸ªå¥åï¼</p>
<p>é¦åæä»¬è¦æç¡®ï¼<strong>&lt;![CDATA[ ]]&gt;&nbsp; ä¸æ¯ MyBatis çä¸å±è¯­æ³</strong>ï¼èæ¯ XML çåçè¯­æ³ï¼å¨ç§° Character Dataï¼å­ç¬¦æ°æ®ï¼ã</p>
<p><strong>XML è§£æå¨&nbsp;</strong>å¯¹æäºç¹æ®å­ç¬¦ï¼æ¯å¦ <strong>&lt;ã&gt;ã&amp;ã'ã" </strong>ç­ï¼è¿è¡è§£æçæ¶åï¼å¯è½ä¼å°è¿äºç¹æ®å­ç¬¦ <strong>è¯¯å¤</strong>ï¼æ¯å¦ å° <strong>&lt;</strong> è¯å«ä¸º XML æ ç­¾çå¼å§ï¼ç­ç­ã</p>
<p><strong>&lt;![CDATA[ ]]&gt;</strong> çæ ¸å¿ä½ç¨ï¼<strong>å°åè£¹çåå®¹æ è®°ä¸º "çº¯ææ¬"</strong>ï¼XML è§£æå¨ä¼è·³è¿å¯¹å¶ä¸­åå®¹çè¯­æ³è§£æï¼ç´æ¥ <strong>åæ ·ä¿ç</strong>ï¼ä»èé¿åç¹æ®å­ç¬¦ä¸ XML è¯­æ³çå²çªï¼ä¿è¯ MyBatis æç»æ¿å°ç SQL æ¯æä»¬é¢æçæ ·å­ã</p>
<p>æä»¬é¤äºå¯ä»¥ä½¿ç¨&nbsp;<strong>&lt;![CDATA[ ]]&gt;</strong>ï¼ä¹å¯ä»¥ä½¿ç¨ <strong>è½¬ä¹å­ç¬¦</strong>ã</p>
<p>å¸¸ç¨ç <strong>è½¬ä¹å­ç¬¦å¯¹ç§</strong>ï¼</p>
<ul>
<li><strong>&lt; â &amp;lt;</strong></li>
<li><strong>&gt; â &amp;gt;</strong></li>
<li><strong>&amp; â &amp;amp;</strong></li>
<li><strong>" â &amp;quot;</strong></li>
<li><strong>' â &amp;apos;</strong></li>
</ul>
<p>æ³¨æç»å°¾ç <strong>; </strong>éè¦ççã</p>
<p><strong>éè¯¯åæ³</strong>ï¼</p>
<pre class="language-sql highlighter-hljs"><code>&lt;!-- XMLè§£æå¨ä¼æ &lt; è¯å«ä¸ºæ ç­¾å¼å§ï¼ç´æ¥æ¥é --&gt;
&lt;select id="getUserByAge" resultType="User"&gt;
    SELECT * FROM user WHERE age &lt; #{age}
&lt;/select&gt;</code></pre>
<p><strong>ä½¿ç¨ è½¬ä¹ åæ³</strong>ï¼</p>
<pre class="language-sql highlighter-hljs"><code>&lt;select id="getUserByAge" resultType="User"&gt;
    SELECT * FROM user WHERE age &amp;lt; #{age}
&lt;/select&gt;</code></pre>
<p><strong>ä½¿ç¨ CDATA åæ³</strong>ï¼</p>
<pre class="language-sql highlighter-hljs"><code>&lt;select id="getUserByAge" resultType="User"&gt;
    SELECT * FROM user WHERE &lt;![CDATA[ age &lt; #{age} ]]&gt;
&lt;/select&gt;</code></pre>
<p>æ¯ä¸æ¯ä½¿ç¨&nbsp;<strong>CDATA </strong>çå¯è¯»æ§è¦é«å¾å¤ï¼æä»¥æ¨èä½¿ç¨&nbsp;<strong>CDATA</strong>ï¼å°¤å¶æ¯å¤æSQLã</p>
<p>æä»¬çä¸ªä¸æ¯å¾å¤æçSQLã</p>
<p><strong>å¤æSQL è½¬ä¹ åæ³</strong>ï¼</p>
<pre class="language-sql highlighter-hljs"><code>&lt;select id="getUserBySpec" resultType="User"&gt;
    SELECT * FROM user WHERE (age &amp;lt; #{age} OR salary &amp;gt; #{salary})
    AND (create_time gt;= #{startTime} OR update_time lt;= #{endTime})
&lt;/select&gt;</code></pre>
<p><strong>å¤æSQL CDATA åæ³</strong>ï¼</p>
<pre class="language-sql highlighter-hljs"><code>&lt;select id="getUserBySpec" resultType="User"&gt;
    SELECT * FROM user
    &lt;![CDATA[
        WHERE (age &lt; #{age} OR salary &gt; #{salary}) 
        AND (create_time &gt;= #{startTime} OR update_time &lt;= #{endTime})
    ]]&gt;
&lt;/select&gt;</code></pre>
<p><strong>MyBatis é«çæ¬ </strong>å¯¹é¨åç¹æ®å­ç¬¦åäºå¼å®¹ï¼æ¯å¦ç´æ¥å <strong>&gt; </strong>å¯è½ä¸æ¥éäºãè¿æ¯ "å®½æ¾è§£æ"ï¼è·¨ç¯å¢ï¼æ¯å¦ä¸å XML è§£æå¨ãä¸åæ°æ®åºé©±å¨ç­ï¼ä»æå¯è½åºé®é¢ï¼<strong>æ¨èå§ç»ç¨ CDATA ä¿è¯å¼å®¹æ§</strong>ã</p>
<p><strong>&lt;![CDATA[ ]]&gt;</strong> æ¯ MyBatis ä¸­å¤ç SQL è¯­å¥ä¸ XML è¯­æ³å²çªçå®å¨å±éãå¯¹åå« <strong>ç¹æ®å­ç¬¦</strong> ç SQL çæ®µè¿è¡æå°èå´ç <strong>CDATA åè£¹</strong>ï¼æ¢ä¿è¯äºå®å¨ï¼åç¡®ä¿äº MyBatis å¨æ SQL åè½çå®æ´æ§ã</p>
<p style="text-align: right"><span style="color: rgba(53, 152, 219, 1)">ææ§çç«ä»¥è°çï¼å¿æè¯æä»¥è°ç±ã-- çæ²ä¹æ´²</span></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-11 21:15">2026-02-11 21:15</span>&nbsp;
<a href="https://www.cnblogs.com/yanshajiuzhou">çæ²ä¹æ´²</a>&nbsp;
éè¯»(<span id="post_view_count">6</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19606003);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19606003', targetLink: 'https://www.cnblogs.com/yanshajiuzhou/p/19606003', title: 'MyBatis XML éï¼![CDATA[ ]]ï¼çä½¿ç¨' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>