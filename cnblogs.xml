<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2025-12-30T01:16:24.063Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ ææ¡Fetchä¸Flaskäº¤äºï¼è®©åç«¯è¡¨åæäº¤æ´ä¼éçå¨æä¹é ]]></title>
    <link>https://www.cnblogs.com/ymtianyu/p/19418995</link>
    <guid>52285023aae08ab93f52b581fbeb15d0</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ymtianyu/p/19418995" title="åå¸äº 2025-12-30 08:18">
    <span role="heading" aria-level="2">ææ¡Fetchä¸Flaskäº¤äºï¼è®©åç«¯è¡¨åæäº¤æ´ä¼éçå¨æä¹é</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æè¯¦ç»è§£æäºåç«¯Fetch APIçå·¥ä½åçä¸å¸¸è§ç¨æ³ï¼å¹¶éç¹éè¿°äºå¶å¦ä½ä¸Python Flaskåç«¯æ¡æ¶ååå·¥ä½ãéè¿ç»å½éå®åãæ°æ®å¨æå¢å æ¹æ¥ç­å·ä½åºæ¯ï¼æ¼ç¤ºäºå¦ä½å®ç°æ å·æ°äº¤äºä½éªãæç« æä¾äºååç«¯éå¥çä»£ç ç¤ºä¾ï¼è®²è§£äºå¦ä½å¤çJSONãææ¬ç­ä¸åæ ¼å¼çååºï¼ä»¥åå¦ä½æ ¹æ®ååºç¶ææ´æ°ç¨æ·çé¢ï¼ä¸ºæå»ºç°ä»£Webåºç¨æä¾äºå®ç¨æåã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; line-height: 1.7; color: rgba(61, 61, 61, 1); font-size: 16px; padding: 0 15px">
<h1 style="font-size: 22px; line-height: 1.4; margin-top: 0; margin-bottom: 15px; font-weight: bold; color: rgba(26, 26, 26, 1)">è¿å¨ä¸ºè¡¨åæäº¤åé¡µé¢å·æ°ç¦æ¼ï¼ä¸ææå®Fetchä¸Flaskçæ ç¼äº¤äº</h1>
<p style="font-size: 15px; color: rgba(127, 140, 141, 1); margin-bottom: 20px; border-left: 3px solid rgba(74, 144, 226, 1); padding-left: 12px; font-style: italic">æ¬æå¸¦ä½ æ·±å¥çè§£ç°ä»£åç«¯ Fetch API çå·¥ä½åçï¼å¹¶ææææä½ å¦ä½ä¸ Flask åç«¯ä¼éç»åï¼å®ç°æ å·æ°ç»å½ãæ°æ®å¨æå¢å æ¹æ¥ç­äº¤äºã<br>äº®ç¹åæ¬ï¼Fetch æ ¸å¿åçåæãç»å½éå®åçå¼æ­¥å¤çãå©ç¨ååºç¶æç å¨ææ´æ°UIãä»¥åå¦ä½å¤çJSON/ææ¬ç­ä¸åæ ¼å¼çè¿åæ°æ®ã<br><br><span style="font-weight: bold">ä½ å°å­¦å°ï¼</span><br>- Fetch API çâæ¿è¯ºâæºå¶ä¸åºç¡ç¨æ³<br>- å¦ä½ç¨ Flask æå»º RESTful é£æ ¼ç API ç«¯ç¹<br>- ç»å½è¡¨åæäº¤ï¼åå«ä¼ ç»è¡¨åå·æ°ï¼å®ç°å¹³æ»è·³è½¬<br>- æ°æ®æä½ï¼åç«¯ä¸ä¸ªè¯·æ±ï¼åç«¯å¤çï¼åç«¯UIå³æ¶ååº<br>- æ ¹æ®åç«¯è¿åçä¸åæ°æ®ç±»åï¼JSON/Textï¼è¿è¡ç²¾åå¤ç</p>
<h2 style="font-size: 18px; font-weight: bold; color: rgba(44, 62, 80, 1); border-bottom: 1px solid rgba(238, 238, 238, 1); padding-bottom: 8px; margin-top: 30px; margin-bottom: 15px">â¨ ç®å½</h2>
<p>1. åè¯Fetchï¼ç°ä»£Webçéä¿¡ä¿¡ä½¿<br>2. ð ï¸ å®æåå¤ï¼Flaskåç«¯çç®åéç½®<br>3. ð åºæ¯ä¸ï¼ç»å½è¡¨åæäº¤ä¸é¡µé¢éå®å<br>4. â¨ åºæ¯äºï¼å¨ææ°å¢ä¸ä¿®æ¹æ°æ®<br>5. ð¦ åºæ¯ä¸ï¼å¤çä¸åç±»åçååºæ°æ®<br>6. ð» å®æ´ä»£ç åèä¸æ»ç»</p>
<h2 style="font-size: 20px; font-weight: bold; color: rgba(44, 62, 80, 1); margin-top: 35px; margin-bottom: 15px">1. åè¯Fetchï¼ç°ä»£Webçéä¿¡ä¿¡ä½¿</h2>
<p><code>fetch()</code> æ¯æµè§å¨æä¾çãåºäº <strong style="color: rgba(186, 55, 42, 1)">Promise</strong> çç°ä»£ç½ç»è¯·æ±APIãå®åä»£äºå¤èç XMLHttpRequestï¼è®©å¼æ­¥æ°æ®è¯·æ±åå¾æ¸æ°ãç®æ´ãä½ å¯ä»¥æå®æ³è±¡æä¸ä¸ªä¸ä¸çâä¿¡ä½¿âã</p>
<p>å®çåºæ¬å·¥ä½æµç¨æ¯ï¼ä½ ç»ä¿¡ä½¿ï¼fetchï¼ä¸ä¸ªå°åï¼URLï¼åæç¤ºï¼éç½®å¯¹è±¡ï¼ï¼å®ç«å»è¿åä¸ä¸ªâæ¿è¯ºæ¶æ®âï¼Promiseï¼ãè¿ä¸ªæ¿è¯ºæç»ä¼åç°ä¸ºâååºåè£¹âï¼Responseå¯¹è±¡ï¼ï¼ä½ éè¦æå¼è¿ä¸ªåè£¹ï¼è°ç¨å¦.json(), .text()ç­æ¹æ³ï¼æè½æ¿å°éé¢ççå®æ°æ®ã</p>
<pre class="language-javascript highlighter-hljs"><code>// ä¸ä¸ªæç®åçGETè¯·æ±ç¤ºä¾
fetch('/api/data')
  .then(response =&gt; response.json()) // æå¼åè£¹ï¼è§£æJSONæ°æ®
  .then(data =&gt; console.log(data))   // å¤ççå®æ°æ®
  .catch(error =&gt; console.error('åºéå¦ï¼', error)); // å¤çéè¯¯</code></pre>
<h2 style="font-size: 20px; font-weight: bold; color: rgba(44, 62, 80, 1); margin-top: 35px; margin-bottom: 15px">2. ð ï¸ å®æåå¤ï¼Flaskåç«¯çç®åéç½®</h2>
<p>ä¸ºäºè®©åç«¯Fetchè½é¡ºå©ä¸åç«¯âå¯¹è¯âï¼æä»¬éè¦ä¸ä¸ªè½å¤çJSONãå¹¶è½è¿è¡è·¨åèµæºå±äº«ï¼CORSï¼çFlaskåºç¨ãé¦åï¼å®è£å¿è¦åºï¼</p>
<pre class="language-python highlighter-hljs"><code>pip install flask flask-cors</code></pre>
<p>æ¥çï¼æ­å»ºä¸ä¸ªåºç¡çåç«¯æå¡ï¼</p>
<pre class="language-python highlighter-hljs"><code>from flask import Flask, request, jsonify
from flask_cors import CORS

app = Flask(__name__)
CORS(app)  # åè®¸åç«¯è·¨åè¯·æ±ï¼å¼åæ¶éå¸¸æ¹ä¾¿

# æä»¬å°å¨åç»­åºæ¯ä¸­éæ­¥å¡«åè¿ä¸ªappçè·¯ç±
if __name__ == '__main__':
    app.run(debug=True)</code></pre>
<h2 style="font-size: 20px; font-weight: bold; color: rgba(44, 62, 80, 1); margin-top: 35px; margin-bottom: 15px">3. ð åºæ¯ä¸ï¼ç»å½è¡¨åæäº¤ä¸é¡µé¢éå®å</h2>
<p>ä¼ ç»è¡¨åæäº¤ä¼å·æ°é¡µé¢ï¼ä½éªå²è£ãä½¿ç¨Fetchï¼æä»¬å¯ä»¥å®ç°æ å·æ°ç»å½ï¼å¹¶æ ¹æ®åç«¯æä»¤è¿è¡åç«¯è·¯ç±è·³è½¬ã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">åç«¯ (JavaScript)</strong>ï¼æ¦æªè¡¨åæäº¤äºä»¶ï¼ä½¿ç¨Fetchåéæ°æ®ã</p>
<pre class="language-javascript highlighter-hljs"><code>document.getElementById('loginForm').addEventListener('submit', function(event) {
    event.preventDefault(); // é»æ­¢è¡¨åé»è®¤æäº¤è¡ä¸º

    const formData = new FormData(this);
    // æèå°æ°æ®è½¬æ¢ä¸ºJSON: JSON.stringify(Object.fromEntries(formData))

    fetch('/api/login', {
        method: 'POST',
        body: formData, // åéFormDataå¯¹è±¡
        // headers: { 'Content-Type': 'application/json' }, // å¦æåéJSONéè®¾ç½®æ­¤header
    })
    .then(response =&gt; response.json()) // è§£æåç«¯è¿åçJSON
    .then(result =&gt; {
        if (result.success) {
            // ç»å½æåï¼ä½¿ç¨åç«¯è·¯ç±è·³è½¬ï¼èéåç«¯éå®å
            window.location.href = result.redirect_url || '/dashboard';
        } else {
            // ç»å½å¤±è´¥ï¼å¨ææ´æ°é¡µé¢ä¸çéè¯¯æç¤ºåç´ 
            document.getElementById('error-msg').textContent = result.message;
        }
    })
    .catch(error =&gt; console.error('Error:', error));
});</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">åç«¯ (Flask)</strong>ï¼éªè¯æ°æ®ï¼è¿ååå«ç¶æåæä»¤çJSONï¼èä¸æ¯ç´æ¥è¿åéå®åçHTMLã</p>
<pre class="language-python highlighter-hljs"><code>@app.route('/api/login', methods=['POST'])
def login():
    username = request.form.get('username')
    password = request.form.get('password')

    # è¿éåºæ¯ä½ çéªè¯é»è¾ï¼ä¾å¦æ¥è¯¢æ°æ®åº
    if username == 'admin' and password == 'secret':
        # è¿åæåç¶æååç«¯è·³è½¬å°å
        return jsonify({'success': True, 'redirect_url': '/dashboard'})
    else:
        # è¿åå¤±è´¥ç¶æåéè¯¯ä¿¡æ¯
        return jsonify({'success': False, 'message': 'ç¨æ·åæå¯ç éè¯¯'}), 401</code></pre>
<h2 style="font-size: 20px; font-weight: bold; color: rgba(44, 62, 80, 1); margin-top: 35px; margin-bottom: 15px">4. â¨ åºæ¯äºï¼å¨ææ°å¢ä¸ä¿®æ¹æ°æ®</h2>
<p>å¨ç®¡çç³»ç»ä¸­ï¼æ°å¢æä¿®æ¹ä¸æ¡æ°æ®åï¼æä»¬å¸æåè¡¨è½ç«å³æ´æ°ï¼èæ éå·æ°æ´ä¸ªé¡µé¢ã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">æ ¸å¿æè·¯</strong>ï¼Fetchè¯·æ±æååï¼å¨<code>.then()</code>ä¸­æ ¹æ®åç«¯è¿åçææ°æ°æ®ï¼ç´æ¥æä½DOMæ´æ°UIã</p>
<pre class="language-javascript highlighter-hljs"><code>// åè®¾æä¸ä¸ªä¿å­æé®ï¼ç¨äºæäº¤æ°å¢æä¿®æ¹çæ°æ®
saveButton.addEventListener('click', () =&gt; {
    const itemData = { title: 'æ°é¡¹ç®', status: 'active' };

    fetch('/api/items', {
        method: 'POST', // æ°å¢ç¨POSTï¼ä¿®æ¹å¯è½æ¯PUTæPATCH
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(itemData)
    })
    .then(response =&gt; response.json())
    .then(newItem =&gt; {
        // å³é®æ­¥éª¤ï¼è¯·æ±æååï¼å¨ææ´æ°åç«¯åè¡¨
        const itemList = document.getElementById('itemList');
        const newItemElement = document.createElement('li');
        newItemElement.id = `item-${newItem.id}`;
        newItemElement.innerHTML = `${newItem.title} ${newItem.status}`;
        itemList.appendChild(newItemElement);

        // æèï¼å¦ææ¯ä¿®æ¹æä½ï¼å¯ä»¥æ¾å°å¯¹åºçDOMåç´ æ´æ°å¶åå®¹
        // const oldItemElement = document.getElementById(`item-${newItem.id}`);
        // oldItemElement.innerHTML = ...;

        alert('æä½æåï¼'); // ææ´ä¼éçæç¤º
    });
});</code></pre>
<p>å¯¹åºçFlaskåç«¯éè¦è¿ååå»ºææ´æ°åçå®æ´æ°æ®å¯¹è±¡ï¼ä»¥ä¾¿åç«¯ä½¿ç¨ã</p>
<h2 style="font-size: 20px; font-weight: bold; color: rgba(44, 62, 80, 1); margin-top: 35px; margin-bottom: 15px">5. ð¦ åºæ¯ä¸ï¼å¤çä¸åç±»åçååºæ°æ®</h2>
<p>åç«¯å¯è½è¿åJSONï¼ä¹å¯è½è¿åçº¯ææ¬æHTMLçæ®µãFetchçResponseå¯¹è±¡æä¾äºä¸åçæ¹æ³æ¥å¤çã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">å¤çJSON (æå¸¸ç¨)</strong>ï¼å¦ä¸ææç¤ºï¼ä½¿ç¨<code>response.json()</code>ã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">å¤çææ¬</strong>ï¼ä¾å¦åç«¯è¿åä¸ä¸ªç®åçæåæ¶æ¯æCSVæ°æ®ã</p>
<pre class="language-javascript highlighter-hljs"><code>fetch('/api/export')
  .then(response =&gt; response.text())
  .then(textData =&gt; {
    console.log(textData);
    // å¤çææ¬æ°æ®...
  });</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">æ£æ¥ååºç¶æ</strong>ï¼å¨è§£ææ°æ®åï¼åæ£æ¥è¯·æ±æ¯å¦çæ­£æåæ¯ä¸ªå¥½ä¹ æ¯ã</p>
<pre class="language-javascript highlighter-hljs"><code>fetch('/api/some-data')
  .then(response =&gt; {
    if (!response.ok) { // æ£æ¥HTTPç¶æç æ¯å¦å¨200-299ä¹é´
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return response.json(); // ç¶ææ­£å¸¸æè§£æJSON
  })
  .then(data =&gt; /* å¤çæ°æ® */)
  .catch(error =&gt; /* å¤çç½ç»éè¯¯æç¶æç éè¯¯ */);</code></pre>
<h2 style="font-size: 20px; font-weight: bold; color: rgba(44, 62, 80, 1); margin-top: 35px; margin-bottom: 15px">6. ð» å®æ´ä»£ç åèä¸æ»ç»</h2>
<p>ä¸é¢æ¯ä¸ä¸ªæ´åäºç»å½åæ°å¢é¡¹ç®çè¶ç®æå®æ´ç¤ºä¾ï¼</p>
<pre class="language-python highlighter-hljs"><code># app.py (Flaskåç«¯)
from flask import Flask, request, jsonify
from flask_cors import CORS

app = Flask(__name__)
CORS(app)
items = [] # ç¨ä¸ä¸ªç®æåè¡¨æ¨¡ææ°æ®åº

@app.route('/api/login', methods=['POST'])
def login():
    data = request.get_json()
    if data.get('user') == 'demo':
        return jsonify({'success': True, 'token': 'fake-jwt-token'})
    return jsonify({'success': False}), 401

@app.route('/api/items', methods=['GET', 'POST'])
def handle_items():
    if request.method == 'GET':
        return jsonify(items)
    else: # POST
        new_item = request.get_json()
        new_item['id'] = len(items) + 1
        items.append(new_item)
        return jsonify(new_item), 201

if __name__ == '__main__':
    app.run(debug=True)</code></pre>
<pre class="language-html highlighter-hljs"><code>&lt;!-- index.html (é¨ååç«¯) --&gt;
&lt;script&gt;
// ç»å½
fetch('/api/login', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({user: 'demo', pass: 'demo'})
}).then(r =&gt; r.json()).then(console.log);

// æ°å¢é¡¹ç®å¹¶æ´æ°åè¡¨
fetch('/api/items', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({name: 'New Task'})
})
.then(r =&gt; r.json())
.then(newItem =&gt; {
    const list = document.getElementById('list');
    list.innerHTML += `&lt;li&gt;${newItem.id}: ${newItem.name}&lt;/li&gt;`;
});
&lt;/script&gt;</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">æ»ç»ä¸ä¸</strong>ï¼Fetch + Flask çç»åï¼éè¿âè¯·æ±-ååº-JSONâçæ¨¡å¼ï¼å°ååç«¯è§£è¦ï¼è®©Webäº¤äºåå¾<strong style="color: rgba(186, 55, 42, 1)">æ´å å¨æåé«æ</strong>ã<br>å³é®å¨äºï¼åç«¯è´è´£äº¤äºåUIæ´æ°ï¼åç«¯è´è´£æ°æ®åé»è¾ï¼ä¸¤èéè¿æ¸æ°çAPIå¥çº¦è¿è¡éä¿¡ã</p>
<div style="text-align: center; margin: 40px 0"><hr style="border-top: 1px solid rgba(221, 221, 221, 1); border-right: none; border-bottom: none; border-left: none"></div>
<p style="font-size: 15px; color: rgba(85, 85, 85, 1); text-align: center">åæ¬¢æ¬æï¼ä¸è¦éè¿â¨ï¼ç¹èµðæ¶èâ­å³æ³¨æðï¼ä¸èµ·å­¦ä¹ æ´å¤æç¨çç¥è¯ï¼å®åä½ æçæè½æ ï¼ä¹è¯·è·¯è¿çå¤§ä½¬ç»äºå»ºè®®åææðð¶ï¼</p>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-30 08:19">2025-12-30 08:18</span>&nbsp;
<a href="https://www.cnblogs.com/ymtianyu">æ²å¹½</a>&nbsp;
éè¯»(<span id="post_view_count">24</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19418995);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19418995', targetLink: 'https://www.cnblogs.com/ymtianyu/p/19418995', title: 'ææ¡Fetchä¸Flaskäº¤äºï¼è®©åç«¯è¡¨åæäº¤æ´ä¼éçå¨æä¹é' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Spring Boot Pf4jæ¨¡ååè½åè®¾è®¡æè ]]></title>
    <link>https://www.cnblogs.com/CreateMyself/p/19413005</link>
    <guid>e6f2a804798293671b69951ae41bcaa4</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/CreateMyself/p/19413005" title="åå¸äº 2025-12-30 08:00">
    <span role="heading" aria-level="2">Spring Boot Pf4jæ¨¡ååè½åè®¾è®¡æè</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h2>åè¨</h2>
<p><span style="font-size: 15px">ä¸ä¸ç¯æç« æä»¬æµå°è¾æ­¢æ¨¡ååæ´ä½æ¦è§ï¼æè°æ¨¡åååºç¡è®¾æ½åæ¯åºäºPf4jäºæ¬¡å°è£ï¼æä»¬å·ä½å°åºè¦å®ç°åªäºï¼æ¬ç¯æä»¬ä»Pf4jå¼å§è®²è§£ï¼æä»¬æ·±æç»èã</span></p>
<h2><span style="font-size: 15px">æ¨¡åååºç¡è®¾æ½</span></h2>
<p><span style="font-size: 15px">Pf4jå®æ¹æåºæ¬ä»ç»ä»¥åå¯¹æ´ä¸ªæ¡æ¶çæ¶æç­ç­ï¼æä»¬ä¸åæµªè´¹å£èãå¦ä¸æ¯éè¿AIæ»ç»Pf4jçè½åæå¯¼åºçæ¶åºå¾ï¼åºæ¬ä¸ç®æ¯é£ä¹åäºï¼ç»ä¸äºè§£Pf4jè½åçç«¥éçä¸ªåºæ¬å°è±¡</span></p>
<p><img src="https://img2024.cnblogs.com/blog/589642/202512/589642-20251228230453654-1092258168.png" alt="PF4Jæ ¸å¿è½åæ¶åºå¾" loading="lazy"></p>
<p><span style="font-size: 15px">åºäºä¸è¿°Pf4jçåºæ¬è½åæ¦æ¬ï¼å¯å¨ãåæ­¢ãç­å è½½/å¸è½½ãéæ¯ãæ©å±ç¹ï¼ï¼æä»¬åæå¼å°è£æ¶åWebåºç¨çåºç¡è½åï¼æä»¬åæ¥æèä¸ä¸ªé®é¢ï¼æ¨¡ååæ¡æ¶è¿åºå·å¤åªäºè½åï¼ä»¥æ­¤åå¯¹ç§æ·±å¥P4fjå®ç°ç»èç¡®è®¤æ¯å¦è½æ©å±å¢å¼ºæèå¯¹åºå±å¤æå®ç°è¿è¡ç®åç­ç­ï¼å¦ä¸æä»¬ä¸ä¸æ½ä¸å¥è§ä¸åç¹ä¸ºç®ä»¥åç´æ¥ç»åºè¥ä¸æ¯æå¦ä½æ©å±å®ç°ï¼æ³¨ï¼pf4jæ¢æ¯æjaråä¹æ¯æå°jaræåæzipï¼æä»¬ä»ä»¥åå§jaråä¸ºä¾è®²è§£ï¼zipçjaråæ éå¤äºä¸æ­¥å°jaråè§£åç­ç­ï¼é»è¾å¤§åå°å¼ï¼</span></p>
<h3>æä»¶ç®å½èªå®ä¹</h3>
<p><img src="https://img2024.cnblogs.com/blog/589642/202512/589642-20251229204902655-1327827454.png" alt="image" loading="lazy"></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">final</span> String PLUGINS_DIR_PROPERTY_NAME = "pf4j.pluginsDir"<span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">final</span> String MODE_PROPERTY_NAME = "pf4j.mode"<span style="color: rgba(0, 0, 0, 1)">;

</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">final</span> String DEFAULT_PLUGINS_DIR = "plugins"<span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">final</span> String DEVELOPMENT_PLUGINS_DIR = "../plugins"<span style="color: rgba(0, 0, 0, 1)">;

 </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> initialize() {

        </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> (pluginsRoots.isEmpty()) {
            pluginsRoots.addAll(createPluginsRoot());
        }
}

</span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">final</span> List&lt;Path&gt; pluginsRoots = <span style="color: rgba(0, 0, 255, 1)">new</span> ArrayList&lt;&gt;<span style="color: rgba(0, 0, 0, 1)">();

</span><span style="color: rgba(0, 0, 255, 1)">protected</span> List&lt;Path&gt;<span style="color: rgba(0, 0, 0, 1)"> createPluginsRoot() {
        String pluginsDir </span>=<span style="color: rgba(0, 0, 0, 1)"> System.getProperty(PLUGINS_DIR_PROPERTY_NAME);
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (pluginsDir != <span style="color: rgba(0, 0, 255, 1)">null</span> &amp;&amp; !<span style="color: rgba(0, 0, 0, 1)">pluginsDir.isEmpty()) {
            </span><span style="color: rgba(0, 0, 255, 1)">return</span> Arrays.stream(pluginsDir.split(","<span style="color: rgba(0, 0, 0, 1)">))
                .map(String::trim)
                .map(Paths::get)
                .collect(Collectors.toList());
        }

        pluginsDir </span>= isDevelopment() ?<span style="color: rgba(0, 0, 0, 1)"> DEVELOPMENT_PLUGINS_DIR : DEFAULT_PLUGINS_DIR;

        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> Collections.singletonList(Paths.get(pluginsDir));
    }</span></pre>
</div>
<p><span style="font-size: 15px">å½æä»¬å®ç°èªå®ä¹ç»§æ¿PluginManageræ¶ï¼è¥æä»¬å·²æå®æä»¶ç®å½è·¯å¾åæç§æå¨æå®çæä»¶ç®å½è§£æå¹¶å è½½æä»¶ï¼å¦åä»JVMç³»ç»å±æ§è·åpf4j.pluginsDirï¼è¥å·²æå®åæç§æå®è·¯å¾è§£æå¹¶å è½½æä»¶ï¼å¦åé»è®¤çæä»¶ç®å½åä¸ºpluginsæè../pluginsï¼pf4jåºåæµè¯åçäº§æ¨¡å¼ï¼ä¹æ¯ä»JVMç³»ç»å±æ§è·åMODE_PROPERTY_NAMEï¼ã</span></p>
<h3>æä»¶ä¸æä»¶ä¹é´çç®å½èªå®ä¹</h3>
<p><img src="https://img2024.cnblogs.com/blog/589642/202512/589642-20251229210110653-256153991.png" alt="image" loading="lazy"></p>
<p><span style="font-size: 15px">æä»¬è®¾è®¡çå·ä½æä»¶æ2ä¸ªå±çº§ï¼å°æä»¶jaråå»é¤çæ¬å·çåç§°ä½ä¸ºæä»¶ç®å½ï¼å¶ç®å½ä¸æ¾æä»¶jaråï¼åæ¶è¿æä¸ªlibç®å½ï¼è¯¥libç®å½ç¨äºå­æ¾æä»¶çä¾èµï¼æ­¤ä¾èµæ¢å¯æ¥æºäºæä»¶å¼å¥ç¬ç«ä¾èµçmvnä»åºåï¼ä¹å¯æ¥æºäºä¸å¤é¨å¯¹æ¥æ¶çç§æåï¼ä¸å­å¨äºmvnä»åºï¼ã å¾æ¾ç¶ï¼pf4jä¸æ¯æï¼ä¸å¥è¯æ¦æ¬ï¼pf4jæ²¡ææä»¶ç®å½å±çº§ä¹åï¼æææä»¶jaråç»ä¸æ¾å°æä»¶ç®å½ä¸ä»¥åä¾èµä¹ç»ä¸æ¾å°æä»¶ç®å½ä¸çlibç®å½ä¸ï¼å¨æ­¤ä¸ååè¿ä¸æ­¥çæºç è®²è§£ï¼ï¼æä»¬éåå¶æ¹æ³å®ç°</span></p>
<p><img src="https://img2024.cnblogs.com/blog/589642/202512/589642-20251229232706985-1871234307.png" alt="image" loading="lazy"></p>
<p><span style="font-size: 15px">å¦ä¸BasePluginRepositoryä¸ºpf4jæä¾çåºæ¬å®ç°ï¼åæ¶pf4jè¿ä¸æ­¥æä¾JarPluginRepositoryç»§æ¿BasePluginRepositoryï¼ä»ä»åªæ¯ä½ä¸ºæé å½æ°ä¼ éæä»¶ç®å½è·¯å¾ï¼æä»¥æä»¬å¯ä»¥èªå®ä¹ç»§JarPluginRepositoryï¼éåä¸è¿°streamFilesæ¹æ³å³å¯ï¼è¯¥æ¹æ³æ2ä¸ªåæ°ï¼ç¬¬ä¸ä¸ªåæ¯æä»¶ç®å½è·¯å¾ï¼ç¬¬äºä¸ªåæ¯æä»¶ç±»åè¿æ»¤ï¼jarï¼</span></p>
<p><img src="https://img2024.cnblogs.com/blog/589642/202512/589642-20251229233338450-1680010069.png" alt="image" loading="lazy"></p>
<p><span style="font-size: 15px">ä¸è¿°æä»¬å·²éåæç»å¾å°çå°æ¯å·ä½æä»¶jaråè·¯å¾ï¼è¿éæä»¬å¯èèåä¸¤æ¹é¢å¤çï¼ä¸æ¯å¼ºæ ¡éªæä»¶ç®å½çåç§°åjaråå¿½ç¥çæ¬å·çåç§°æ¯å¦å®å¨ä¸è´ï¼äºæ¯çæ¬å²çªå¤çå³å­å¨ä¸åçæ¬çjaråæ¶ï¼ä¾å¦å¯ä»¥æ ¹æ®çæ¬çº¦å®ä¿æçalphaãrcãreleaseçæ¬ç­è§ååææ°çjaråï¼å¶ä»åå­å®éæåµèªç±åæ¥ã</span></p>
<h3>æä»¶ç¬ç«ä¾èµåè§£æ</h3>
<p><span style="font-size: 15px">ä¸è¿°ä»ä»åªæ¯åå°äºå·ä½æä»¶jaråè·¯å¾ï¼æ¥ä¸æ¥éè¿ç±»å è½½å¨å è½½jaråä»¥åå è½½ä¾èµï¼é¦åéè¦è®¨è®ºç±»å è½½å¨çäºæï¼ä¸ªäººè®¤ä¸ºpf4jçç±»å è½½å¨èèçå¾å¨å°ï¼è®¾è®¡çæ¯è¾çµæ´»ï¼ä½æä»¬å®éå¯ä»¥ç¨å¾®ç®åä¸ï¼<span style="color: rgba(255, 102, 0, 1)">æ ¸å¿æè·¯æ»ç»èµ·æ¥ä¸»è¦ä¹å°±4ç¹ï¼éµå¾ªâåäº²å§æ´¾â åºç¡è§åï¼åæ£æ¥ç±»æ¯å¦å·²å è½½ï¼é¿åéå¤å è½½âéµå¾ªåäº²å§æ´¾æ ¸å¿ææ³ï¼ä¼åä»ä¸»åºç¨ï¼ç¶ç±»å è½½å¨ï¼å è½½âæä»¶ä¸å±ç±»ä¼åä»æä»¶å è½½ï¼å¯éï¼âç±»ä»æä»¶å è½½âèªå®ä¹é¢å¤ç±»è·¯å¾ååºï¼å¯éï¼âæç»å è½½å¤±è´¥æå¼å¸¸</span>ãå½ç¶å®éæåµä¸æä»¬å¯è½ä¹æå¶ä»èèï¼å¯ççpf4jç±»å è½½å¨æºç èªè¡ååèï¼å¦ä¸èªå®ä¹ç»§æ¿</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span> GJPluginClassLoader <span style="color: rgba(0, 0, 255, 1)">extends</span><span style="color: rgba(0, 0, 0, 1)"> PluginClassLoader {

    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">final</span> Logger log = LoggerFactory.getLogger(GJPluginClassLoader.<span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)">);

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æä»¶ä¸å±èµæº</span>
    <span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">final</span> Set&lt;String&gt; PLUGIN_FIRST_RESOURCES =<span style="color: rgba(0, 0, 0, 1)"> Set.of(
            </span>"META-INF/extensions.idx"<span style="color: rgba(0, 0, 0, 1)">
    );

  @Override
    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> Class&lt;?&gt; loadClass(String name, <span style="color: rgba(0, 0, 255, 1)">boolean</span> resolve) <span style="color: rgba(0, 0, 255, 1)">throws</span><span style="color: rgba(0, 0, 0, 1)"> ClassNotFoundException {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 1. æ£æ¥æ¯å¦å·²å è½½</span>
        Class&lt;?&gt; loadedClass =<span style="color: rgba(0, 0, 0, 1)"> findLoadedClass(name);
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (loadedClass != <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">) {
            </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> loadedClass;
        }

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 2. ä¼åä»ä¸»åºç¨ï¼ç¶ç±»å è½½å¨ï¼å è½½</span>
        <span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)"> {
            </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> parentClassLoader.loadClass(name);
        } </span><span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (ClassNotFoundException e) {
            log.debug(</span>"Class {} not found in parent classloader, trying plugin"<span style="color: rgba(0, 0, 0, 1)">, name);
        }

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 3. æ£æ¥æ¯å¦æ¯æä»¶ä¸ç¨èµæºï¼ä¼åä»æä»¶å è½½ï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> (isPluginOnlyResource(name)) {
            </span><span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)"> {
                Class</span>&lt;?&gt; pluginClass = <span style="color: rgba(0, 0, 255, 1)">super</span><span style="color: rgba(0, 0, 0, 1)">.loadClass(name, resolve);
                </span><span style="color: rgba(0, 0, 255, 1)">if</span> (pluginClass != <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">) {
                    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> pluginClass;
                }
            } </span><span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (ClassNotFoundException ignored) {
            }
        }

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 4. å°è¯ä»æä»¶ä¸­å è½½</span>
        <span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)"> {
            Class</span>&lt;?&gt; pluginClass = <span style="color: rgba(0, 0, 255, 1)">super</span><span style="color: rgba(0, 0, 0, 1)">.loadClass(name, resolve);
            </span><span style="color: rgba(0, 0, 255, 1)">if</span> (pluginClass != <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">) {
                </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> pluginClass;
            }
        } </span><span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (ClassNotFoundException e) {
            log.warn(</span>"Class {} not found in plugin, trying additional paths"<span style="color: rgba(0, 0, 0, 1)">, name);
        }

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 5. æåä»é¢å¤ç±»è·¯å¾ä¸­æ¥æ¾</span>
        Class&lt;?&gt; additionalClass =<span style="color: rgba(0, 0, 0, 1)"> findClassInAdditionalPaths(name);
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (additionalClass != <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">) {
            </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> additionalClass;
        }

        </span><span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> ClassNotFoundException("Class " + name + " not found in parent, plugin or additional paths"<span style="color: rgba(0, 0, 0, 1)">);
    }</span></pre>
</div>
<p><span style="font-size: 15px">æ¢ç¶æä»¬å·²èªå®ä¹ç±»å è½½å¨ï¼é£ä¹ä½æ¶å®ä¾åç±»å è½½å¨å¢ï¼å°±å¨æä»¬ç»§æ¿åºå±</span>DefaultPluginManager<span style="font-size: 15px">èªå®ä¹çPluginManageréé¢éåcreatePluginLoaderæ¹æ³</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">    @Override
    </span><span style="color: rgba(0, 0, 255, 1)">protected</span><span style="color: rgba(0, 0, 0, 1)"> PluginLoader createPluginLoader() {
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(0, 0, 255, 1)">new</span> GJJarPluginLoader(<span style="color: rgba(0, 0, 255, 1)">this</span><span style="color: rgba(0, 0, 0, 1)">);
    }</span></pre>
</div>
<p><span style="font-size: 15px">ä¸è¿°æä»¬æä¾ç»§æ¿èªåºå±çPluginClassLoaderèªå®ä¹ç±»å è½½å¨ï¼æä»¬å¼å§å è½½jarååå¶ä¾èµï¼æ­¤æ¶åå¾éè¦èªå®ä¹jaråå è½½ç±»ç»§æ¿èªåºå±çJarPluginLoaderï¼å¨é¨ä»£ç ä¸è´´å¦ä¸ï¼</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span> GJJarPluginLoader <span style="color: rgba(0, 0, 255, 1)">extends</span><span style="color: rgba(0, 0, 0, 1)"> JarPluginLoader {

    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">final</span> Logger log = LoggerFactory.getLogger(GJJarPluginLoader.<span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)">);

    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">final</span> String LIB_DIR = "lib"<span style="color: rgba(0, 0, 0, 1)">;

    </span><span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> GJJarPluginLoader(PluginManager pluginManager) {
        </span><span style="color: rgba(0, 0, 255, 1)">super</span><span style="color: rgba(0, 0, 0, 1)">(pluginManager);
    }

    @Override
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">boolean</span><span style="color: rgba(0, 0, 0, 1)"> isApplicable(Path pluginPath) {
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> Files.exists(pluginPath) &amp;&amp;<span style="color: rgba(0, 0, 0, 1)"> FileUtils.isJarFile(pluginPath);
    }

    @Override
    </span><span style="color: rgba(0, 0, 255, 1)">public</span><span style="color: rgba(0, 0, 0, 1)"> ClassLoader loadPlugin(Path pluginPath, PluginDescriptor pluginDescriptor) {
        GJPluginClassLoader pluginClassLoader </span>= <span style="color: rgba(0, 0, 255, 1)">new</span> GJPluginClassLoader(<span style="color: rgba(0, 0, 255, 1)">this</span>.pluginManager, pluginDescriptor, <span style="color: rgba(0, 0, 255, 1)">this</span><span style="color: rgba(0, 0, 0, 1)">.getClass().getClassLoader());
        pluginClassLoader.addFile(pluginPath.toFile());
        loadDependencyJars(pluginPath, pluginClassLoader);
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> pluginClassLoader;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> loadDependencyJars(Path pluginPath, GJPluginClassLoader pluginClassLoader) {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æä»¶ JAR æå¨ç®å½</span>
        Path pluginDir =<span style="color: rgba(0, 0, 0, 1)"> pluginPath.getParent();
        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (pluginDir == <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">) {
            log.warn(</span>"Plugin path has no parent directory: {}"<span style="color: rgba(0, 0, 0, 1)">, pluginPath);
            </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)">;
        }
        Path libDir </span>=<span style="color: rgba(0, 0, 0, 1)"> pluginDir.resolve(LIB_DIR);
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 1. LIB_DIRä¸å­å¨ï¼è¯´ææ ä¾èµï¼å¿½ç¥å è½½ç¬ç«ä¾èµ</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> (!<span style="color: rgba(0, 0, 0, 1)">Files.exists(libDir)) {
            </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)">;
        }
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 2. ä» MANIFEST.MF è¯»å Class-Path å£°æçä¾èµ</span>
        List&lt;Path&gt; declaredPaths =<span style="color: rgba(0, 0, 0, 1)"> getDeclaredClassPathJars(pluginPath);
        </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> (declaredPaths.isEmpty()) {
            log.debug(</span>"No Class-Path found in MANIFEST.MF"<span style="color: rgba(0, 0, 0, 1)">);
            </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)">;
        }
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 3. æå Class-Path ä¸­æææå lib/ ä¸ç JAR æä»¶åï¼æ ååä¸ºæä»¶åï¼</span>
        Set&lt;String&gt; declaredJarNames =<span style="color: rgba(0, 0, 0, 1)"> getDeclaredJarNames(declaredPaths);
        </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> (declaredJarNames.isEmpty()) {
            </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)">;
        }
        Set</span>&lt;String&gt; loadedJarNames = <span style="color: rgba(0, 0, 255, 1)">new</span> HashSet&lt;&gt;<span style="color: rgba(0, 0, 0, 1)">();
        </span><span style="color: rgba(0, 0, 255, 1)">try</span> (Stream&lt;Path&gt; stream =<span style="color: rgba(0, 0, 0, 1)"> Files.list(libDir)) {
            List</span>&lt;Path&gt; libJars =<span style="color: rgba(0, 0, 0, 1)"> stream
                    .filter(Files::isRegularFile)
                    .filter(path </span>-&gt; path.getFileName().toString().endsWith(".jar"<span style="color: rgba(0, 0, 0, 1)">))
                    .toList();

            </span><span style="color: rgba(0, 0, 255, 1)">for</span><span style="color: rgba(0, 0, 0, 1)"> (Path jarPath : libJars) {
                String jarName </span>=<span style="color: rgba(0, 0, 0, 1)"> jarPath.getFileName().toString();

                </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åªå è½½ Class-Path ä¸­å£°æç JAR</span>
                <span style="color: rgba(0, 0, 255, 1)">if</span> (!<span style="color: rgba(0, 0, 0, 1)">declaredJarNames.contains(jarName)) {
                    log.warn(</span>"Ignored undeclared JAR in lib/: {}"<span style="color: rgba(0, 0, 0, 1)">, jarName);
                    </span><span style="color: rgba(0, 0, 255, 1)">continue</span><span style="color: rgba(0, 0, 0, 1)">;
                }

                </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> é¿åéå¤å è½½</span>
                <span style="color: rgba(0, 0, 255, 1)">if</span> (!<span style="color: rgba(0, 0, 0, 1)">loadedJarNames.add(jarName)) {
                    log.warn(</span>"Duplicate JAR in lib/: {}"<span style="color: rgba(0, 0, 0, 1)">, jarName);
                    </span><span style="color: rgba(0, 0, 255, 1)">continue</span><span style="color: rgba(0, 0, 0, 1)">;
                }

                </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä½¿ç¨ PF4J æ åæ¹æ³æ·»å </span>
<span style="color: rgba(0, 0, 0, 1)">                pluginClassLoader.addFile(jarPath.toFile());
                log.debug(</span>"Loaded dependency JAR: {}"<span style="color: rgba(0, 0, 0, 1)">, jarName);
            }
        } </span><span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (IOException e) {
            log.error(</span>"Failed to scan lib directory: {}"<span style="color: rgba(0, 0, 0, 1)">, libDir, e);
        }
    }

    </span><span style="color: rgba(0, 0, 255, 1)">private</span> Set&lt;String&gt; getDeclaredJarNames(List&lt;Path&gt;<span style="color: rgba(0, 0, 0, 1)"> declaredPaths) {
        Set</span>&lt;String&gt; declaredJarNames =<span style="color: rgba(0, 0, 0, 1)"> declaredPaths.stream()
                .filter(path </span>-&gt;<span style="color: rgba(0, 0, 0, 1)"> {
                    </span><span style="color: rgba(0, 0, 255, 1)">try</span><span style="color: rgba(0, 0, 0, 1)"> {
                        </span><span style="color: rgba(0, 0, 255, 1)">return</span> path.startsWith(LIB_DIR) ||<span style="color: rgba(0, 0, 0, 1)">
                                path.getFileName().toString().equals(path.toString());
                    } </span><span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (Exception e) {
                        </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">;
                    }
                })
                .map(path </span>-&gt;<span style="color: rgba(0, 0, 0, 1)"> {
                    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¤çç¸å¯¹è·¯å¾ï¼å¦ "lib/xxx.jar"ï¼</span>
                    <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> path.getFileName().toString();
                })
                .collect(Collectors.toSet());

        </span><span style="color: rgba(0, 0, 255, 1)">if</span><span style="color: rgba(0, 0, 0, 1)"> (declaredJarNames.isEmpty()) {
            log.debug(</span>"No lib JARs declared in Class-Path"<span style="color: rgba(0, 0, 0, 1)">);
        }
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> declaredJarNames;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">private</span> List&lt;Path&gt;<span style="color: rgba(0, 0, 0, 1)"> getDeclaredClassPathJars(Path pluginJarPath) {
        </span><span style="color: rgba(0, 0, 255, 1)">try</span> (JarFile jarFile = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> JarFile(pluginJarPath.toFile())) {
            Manifest manifest </span>=<span style="color: rgba(0, 0, 0, 1)"> jarFile.getManifest();
            </span><span style="color: rgba(0, 0, 255, 1)">if</span> (manifest == <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">) {
                </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> Collections.emptyList();
            }

            Attributes mainAttrs </span>=<span style="color: rgba(0, 0, 0, 1)"> manifest.getMainAttributes();
            String classPath </span>=<span style="color: rgba(0, 0, 0, 1)"> mainAttrs.getValue(Attributes.Name.CLASS_PATH);

            </span><span style="color: rgba(0, 0, 255, 1)">if</span> (classPath == <span style="color: rgba(0, 0, 255, 1)">null</span> ||<span style="color: rgba(0, 0, 0, 1)"> classPath.trim().isEmpty()) {
                </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> Collections.emptyList();
            }
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æç©ºæ ¼åå²ï¼æ¯æå¤ä¸ªç©ºæ ¼ï¼</span>
            <span style="color: rgba(0, 0, 255, 1)">return</span> Arrays.stream(classPath.trim().split("\\s+"<span style="color: rgba(0, 0, 0, 1)">))
                    .filter(s </span>-&gt; !<span style="color: rgba(0, 0, 0, 1)">s.isEmpty())
                    .map(Paths::get)
                    .collect(Collectors.toList());
        } </span><span style="color: rgba(0, 0, 255, 1)">catch</span><span style="color: rgba(0, 0, 0, 1)"> (Exception e) {
            </span><span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> RuntimeException("Failed to read Class-Path from plugin manifest: " +<span style="color: rgba(0, 0, 0, 1)"> pluginJarPath, e);
        }
    }
}</span></pre>
</div>
<p><span style="font-size: 15px">ä¸è¿°æ»ç»èµ·æ¥ä¸å¥è¯ï¼<span style="color: rgba(255, 102, 0, 1)">æä»¶ååæå¥ç±»å è½½å¨ï¼åå°æä»¶libç®å½ç¬ç«ä¾èµæå¥ç±»å è½½å¨ï¼ä½å°¤å¶éè¦æ³¨æ2ç¹æ¶åå®å¨æ¹é¢çèèï¼ä¸æ¯é²æ­¢è·¯å¾ç©¿è¶ï¼äºæ¯å¨å©ç¨mvnèªå¨åæå»ºæ¶å°libä¸ææä¾èµåå¥å°JARæ¸åæä»¶MANIFEST.MFï¼å¹¶ä¸æ¯ééä¾¿ä¾¿æ¾ä¸ªJARåå°libç®å½ä¸æä»¬å°±ä»»æå»å è½½ï¼å½ç¶æ´éè¦çåç½®æ¡ä»¶æ¯å½æä»¶æ¾å°å¹³å°æä»¶ç®å½ä¸æ¶è¯å®è¦åSHA256ç­ç­ä¸è´æ§æ ¡éªï¼</span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/589642/202512/589642-20251230002407615-539248996.png" alt="image" loading="lazy"></p>
<h3>æä»¶ä¸æä»¶ç¸äºä¾èµè§£æ</h3>
<p><span style="font-size: 15px">pf4jä»¥éæææåºè§£ææä»¶ä¾èµï¼æä»¶ä¾èµç±çº¦å®çplugin.propertiesä¸­çplugin.dependencieså±æ§å®ä¹æä»¶ä¾èµï¼è¥ä¾èµæä»¶gj.plugin.demo2ågj.plugin.demo3ï¼å¯éæ¯å¦å¸¦ä¸çæ¬å·ï¼ï¼é£ä¹ï¼<span style="color: rgba(255, 102, 0, 1)">plugin.dependencies=gj.plugin.demo2@1.0.0-SNAPSHOT,gj.plugin.demo2@1.0.0-SNAPSHOTãæ³¨æå¤ä¸ªä¾èµç¨è±æåè§ç¬¦å·éå¼ï¼åæ¶è¥åºç°å¾ªç¯ä¾èµåä¼æåºå¼å¸¸ï¼ä¸ç¨æå¿æ­»å¾ªç¯é®é¢</span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/589642/202512/589642-20251230003923658-1583916127.png" alt="image" loading="lazy"></p>
<h3>æä»¶å è½½å¼å¸¸èªå®ä¹ç­ç¥</h3>
<p><span style="font-size: 15px; color: rgba(255, 102, 0, 1)">å¤ä¸ªæä»¶å è½½ï¼è¥æä¸ªæä»¶åºç°å è½½å¼å¸¸æä»¬å¯è½å¹¶ä¸å¸æå½±åå¶ä»æä»¶çæ­£å¸¸å è½½ï¼pf4jæä¾äºæä»¶å è½½å¼å¸¸ç­ç¥ï¼é»è®¤æ¯ä¼æåºå¼å¸¸ã</span></p>
<p><img src="https://img2024.cnblogs.com/blog/589642/202512/589642-20251230005419485-1178931856.png" alt="image" loading="lazy"></p>
<p><span style="font-size: 15px">è¥éè°æ´æä»¶å è½½å¼å¸¸ç­ç¥ï¼æä»¬å¨ç»§æ¿åºå±DefaultPluginManagerèªå®ä¹çPluginManageréé¢éåinitializeæ¹æ³ï¼å¨è°ç¨ç¶ç±»åå§åæ¹æ³åéåå¶ç­ç¥å³å¯</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">   @Override
    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> initialize() {
        </span><span style="color: rgba(0, 0, 255, 1)">super</span><span style="color: rgba(0, 0, 0, 1)">.initialize();
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è¦çé»è®¤è®¾ç½®è§£æä¾èµå¼å¸¸ä¸å½±åå¶ä»æä»¶æ­£å¸¸å è½½</span>
        <span style="color: rgba(0, 0, 255, 1)">this</span>.resolveRecoveryStrategy =<span style="color: rgba(0, 0, 0, 1)"> ResolveRecoveryStrategy.IGNORE_PLUGIN_AND_CONTINUE;
        </span><span style="color: rgba(0, 0, 255, 1)">this</span>.configurationRepository =<span style="color: rgba(0, 0, 0, 1)"> createConfigurationRepository();
    }</span></pre>
</div>
<h2>æ»ç»</h2>
<p><span style="font-size: 15px">è¿æ²¡å®ï¼çä¸ªå½©èï¼<span style="color: rgba(255, 102, 0, 1)">pf4jé»è®¤çPluginManagerå¯¹æä»¶çç¸å³æä½éçº¿ç¨å®å¨ï¼æä»¥è¯·æ³¨æåä¸ªæä»¶æä½çåå­æ§</span><span style="color: rgba(255, 102, 0, 1)">ã</span>å¦ä¸å¯¹pf4jäºæ¬¡å°è£æ¨¡ååå¤§è´è®¾è®¡æè·¯ï¼ä»ä¾åä½åèï¼æ¬ææå°æ­¤ä¸ºæ­¢ï¼æè°¢éè¯»ã&nbsp;</span></p>
</div>
<div id="MySignature" role="contentinfo">
    ä½ æçå°çå¹¶éäºç©æ¬èº«ï¼èæ¯ç»è¿è¯ éåæèµäºçæä¹
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-30 08:00">2025-12-30 08:00</span>&nbsp;
<a href="https://www.cnblogs.com/CreateMyself">Jeffcky</a>&nbsp;
éè¯»(<span id="post_view_count">32</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19413005);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19413005', targetLink: 'https://www.cnblogs.com/CreateMyself/p/19413005', title: 'Spring Boot Pf4jæ¨¡ååè½åè®¾è®¡æè' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨åï¼è®¡ç®æºè§è§ ç¬¬åå¨ï¼å·ç§¯ç½ç»åºç¨ (ä¸) äººè¸è¯å« ]]></title>
    <link>https://www.cnblogs.com/Goblinscholar/p/19418306</link>
    <guid>a5dfb8b270d6e86557d0e7c16ea47827</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Goblinscholar/p/19418306" title="åå¸äº 2025-12-29 23:52">
    <span role="heading" aria-level="2">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨åï¼è®¡ç®æºè§è§ ç¬¬åå¨ï¼å·ç§¯ç½ç»åºç¨ (ä¸) äººè¸è¯å«</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ­¤åç±»ç¨äºè®°å½å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨çå­¦ä¹ ç¬è®°ã<br>
è¯¾ç¨ç¸å³ä¿¡æ¯é¾æ¥å¦ä¸ï¼</p>
<ol>
<li>åè¯¾ç¨è§é¢é¾æ¥ï¼<a href="https://www.bilibili.com/video/BV1FT4y1E74V?buvid=XU762317353676D786954061C192FE625463B&amp;from_spmid=playlist.playlist-detail.0.0&amp;is_story_h5=false&amp;mid=zqernykrmpf7XfIorMR%2FnA%3D%3D&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=ce0bc526-db69-428a-962e-c65ed8c267bc&amp;share_source=COPY&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1713085655&amp;unique_k=DfBgvFW&amp;up_id=8654113&amp;vd_source=e035e9878d32f414b4354b839a4c31a4" target="_blank" rel="noopener nofollow">[åè¯­å­å¹]å´æ©è¾¾æ·±åº¦å­¦ä¹ deeplearning.ai</a></li>
<li>githubè¯¾ç¨èµæï¼å«è¯¾ä»¶ä¸ç¬è®°:<a href="https://github.com/robbertliu/deeplearning.ai-andrewNG" target="_blank" rel="noopener nofollow">å´æ©è¾¾æ·±åº¦å­¦ä¹ æå­¦èµæ</a></li>
<li>è¯¾ç¨éå¥ç»ä¹ ï¼ä¸­è±ï¼ä¸ç­æ¡ï¼<a href="https://blog.csdn.net/u013733326/article/details/79827273" target="_blank" rel="noopener nofollow">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾åä¹ é¢ä¸ç­æ¡</a></li>
</ol>
<p>æ¬ç¯ä¸ºç¬¬åè¯¾çç¬¬åå¨åå®¹ï¼<a href="https://www.bilibili.com/video/BV1FT4y1E74V?spm_id_from=333.788.videopod.episodes&amp;vd_source=e035e9878d32f414b4354b839a4c31a4&amp;p=140" target="_blank" rel="noopener nofollow">4.1</a>å°<a href="https://www.bilibili.com/video/BV1FT4y1E74V?spm_id_from=333.788.videopod.episodes&amp;vd_source=e035e9878d32f414b4354b839a4c31a4&amp;p=144" target="_blank" rel="noopener nofollow">4.5</a>çåå®¹ã</p>
<hr>
<p>æ¬å¨ä¸ºç¬¬åè¯¾çç¬¬åå¨åå®¹ï¼è¿ä¸è¯¾ææåå®¹çä¸­å¿åªæä¸ä¸ªï¼<strong>è®¡ç®æºè§è§</strong>ãåºç¨å¨æ·±åº¦å­¦ä¹ éï¼å°±æ¯ä¸é¨ç¨æ¥è¿è¡å¾å­¦ä¹ çæ¨¡ååææ¯ï¼æ¯å¨ä¹åå¨è¿æ¥åºç¡ä¸çâç¹åâï¼ä¹æ¯ç¸å³ä¸ä¸éçä¸ä¸ªéè¦ç ç©¶å¤§ç±»ã<br>
<strong>è¿ä¸æ´èè¯¾é½å­å¨å¤§ééè¦åå¤çè§£çåå®¹åæºå¨å­¦ä¹ ãæ°å­¦åºç¡ã</strong> å æ­¤æä¼å°½å¯è½çè¡¥è¶³åºç¡ï¼ç¨æ¯å»åå®ä¾æ¥æ¼ç¤ºæ¯ä¸ªé¨åï¼ä»èå¸®å©çè§£ã<br>
ç¬¬åå¨çåå®¹æ¯å¯¹åä¸å¨åå®¹çç»¼ååºç¨ï¼ä»ç»äºä¸äºéè¿å·ç§¯ç½ç»å®ç°çå®éåºç¨ï¼å®ä»¬å¨ä½¿ç¨å·ç§¯ç½ç»çåºç¡ä¸ååæèªå·±çç¹ç¹æ¥å¹éä¸åçä»»å¡è¦æ±ï¼æ¯å¯¹<strong>å¦ä½çå®åºç¨å·ç§¯ç½ç»</strong>çè¯å¥½æ¼ç¤ºã<br>
æ¬ç¯çåå®¹å³äº<strong>äººè¸è¯å«</strong>ã</p>
<h1 id="1-äººè¸éªè¯ä¸äººè¸è¯å«">1. äººè¸éªè¯ä¸äººè¸è¯å«</h1>
<p>äººè¸éªè¯åäººè¸è¯å«æ¯ä¸¤ä¸ªç¸ä¼¼çæ¦å¿µã<br>
èå¨äººè¸è¯å«ç³»ç»ä¸­ï¼æä»¬è¯´<strong>äººè¸éªè¯æ¯äººè¸è¯å«çä¸ä¸ªåºæ¬æ¨¡å</strong>ã<br>
ç°å¨å°±æ¥å±å¼ä¸ä¸äºèçå³ç³»ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234636631-73929260.png" alt="image" loading="lazy"><br>
æä»¬å¨å¾éæå°<strong>äººè¸éªè¯æ¯ä¸ä¸ª1å¯¹1é®é¢</strong>ï¼è¿æ¯å ä¸ºå¨åå®éªè¯å¨å®å¨åç¡®çæåµä¸ï¼å®åªä¼å¯¹ä¸ä¸ªäººè¯´ âYesâ èæç»å¶ä»ææäººã<br>
å¾æ¾ç¶ï¼è¿ç§é»è¾å¨æä»¬å®éçæ´»ä¸­çå¤§å¤åºæ¯é½ä¸éç¨ï¼å¬å¸ãå®¿èçé¨ç¦ç­é½æ¯æéè¿ä¸ä¸ªæ¨¡åè¯å«å¤ä¸ªäººãèä¸æ¯ä¸ºæ¯ä¸ªäººåç¬è®¾ç½®ä¸ä¸ªé¸æºã<br>
å æ­¤ï¼æä»¬ä¾¿ç§°è¿ç§<strong>å®ç°â1å¯¹å¤âé»è¾çç¸åºä»»å¡ä¸ºäººè¸è¯å«</strong>ã<br>
æç§åæçé»è¾æ¨ä¸å»ï¼ä¸ä¸ªå¾èªç¶ãä¹å¾âæºå¨å­¦ä¹ ç´è§âçæ³æ³æ¯ï¼<strong>é£äººè¸è¯å«ä¸å°±æ¯ä¸ä¸ªå¤åç±»é®é¢åï¼</strong> åè¿æ ·ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234219889-112044451.png" alt="image.png" loading="lazy"><br>
ä½å¦æå¨å®éé¨ç½²ä¸­è¿æ ·å®ç°äººè¸è¯å«ï¼ä½ ä¼åç°è¿æ ·ä¸äºé®é¢ï¼</p>
<ol>
<li>å¦æåä½ææ°åå·¥å å¥æèåå·¥ç¦»èï¼å°±è¦<strong>éæ°è°æ´æ°æ®åç½ç»è¾åºå±ï¼éæ°è®­ç»</strong>ã</li>
<li>å½åä½è§æ¨¡è¾å¤§æ¶ï¼æ°æ®å¯è½åå«<strong>æåä¸ä¸ä¸ªç±»å«</strong>ãæ´éè¦çæ¯ï¼æ¯ä¸ªç±»å«æ°æ®éå¾å°ï¼èæ·±åº¦å­¦ä¹ å¾å¾åä¾èµäº<strong>æ°æ®é</strong>ï¼é¾éåçå¥èè¦åæå ç¾å åå¼ ç§çåï¼</li>
</ol>
<p>å æ­¤ï¼æä»¬å¾åºç»è®ºï¼å ä¸ºäººè¸è¯å«ä»»å¡å¨å®éé¨ç½²ä¸­çç¹æ®æ§ï¼è®©æä»¬ä¹åäºè§£çå¸¸è§<strong>åç±»ç®æ³å¹¶ä¸éç¨</strong>ä½ä¸ºä¸ä¸ªå¯æç»­é¨ç½²æ¹æ¡å¯¹å¶åºç¨ã</p>
<p>èå¨ç°å®çæ´»ä¸­ï¼ä½ ä¼åç°ï¼æä»¬å¨ç¸å³ç³»ç»å½å¥äººè¸æ¶ï¼<strong>å¾å¾åªéè¦ä¸å¼ è¯ä»¶ç§å³å¯</strong>ï¼è¿æ¯æä¹åå°çå¢ï¼æä»¬ç»§ç»­ã</p>
<h1 id="2-ä¸æ¬¡å­¦ä¹ one-shot-learning">2. ä¸æ¬¡å­¦ä¹ ï¼one-shot learningï¼</h1>
<p>ç»§ç»­ååçåå®¹ï¼æä»¬ä¼åç°ä¸ä¸ªçä¼¼çç¾çç°è±¡ï¼<br>
å¨å®éçäººè¸ç³»ç»ä¸­ï¼å½å¥ä¸ä¸ªæ°ç¨æ·æ¶ï¼<strong>å¾å¾åªéè¦ä¸å¼ è¯ä»¶ç§</strong>ãä½å¨æ·±åº¦å­¦ä¹ çç»éªè®¤ç¥éï¼æ¨¡åæ§è½åé«åº¦ä¾èµæ°æ®éã  <strong>è¿ä¸¤ç¹ï¼ä¸å²çªåï¼</strong></p>
<p>è¦çè§£è¿ä¸ç¹ï¼æä»¬éè¦ååå°åæâæäººè¸è¯å«å½ä½å¤åç±»é®é¢âçæè·¯ã<br>
å¨æ åçå¤åç±»ä»»å¡ä¸­ï¼<strong>åç±»æ ç­¾æ¬èº«å°±ä¸ºæ°æ®ååäºæç¡®çè¾¹ç</strong>ï¼æ¨¡ååªè½éè¿<strong>åä¸æ ç­¾ä¸çæ ·æ¬</strong>æ¥å­¦ä¹ è¯¥ç±»å«çç¹å¾ï¼èä¸åç±»å«ä¹é´çæ°æ®æ¯è¢«ä¸¥æ ¼éç¦»ä½¿ç¨çã<br>
æ­£å ä¸ºå¦æ­¤ï¼å¦æå°äººè¸è¯å«ç´æ¥å»ºæ¨¡ä¸ºâæ¯ä¸ªäººä¸ä¸ªç±»å«âï¼é£ä¹æ¨¡åè¦å­¦å¥½æä¸ä¸ªäººçç¹å¾ï¼å°±å¿ç¶éè¦<strong>å¤§éå±äºè¿ä¸ªäººçæ ·æ¬</strong>ââä¹å°±åºç°äºâè¦ç»æ¯ä¸ªäººæåçéâçä¸ç°å®è¦æ±ã</p>
<p>ä½æ¯ï¼ä½ ä¼åç°ï¼å¨äººè¸è¯å«ä»»å¡ä¸­ï¼<strong>æ»çæ°æ®éå¶å®å¹¶ä¸å°</strong>ï¼çæ­£ç¨ç¼ºçåªæ¯âæ¯ä¸ªèº«ä»½å¯¹åºçæ ·æ¬æ°éâãè¿æå³çï¼å¹¶ä¸æ¯âæ°æ®ä¸å¤âï¼èæ¯<strong>æ°æ®è¢«æ ç­¾å¼ºè¡åå²åï¼æ æ³è¢«ååå©ç¨</strong>ã</p>
<p>æ­£æ¯ç±äºè¿ç§è®¾ç½®ä¸å®éé¨ç½²åºæ¯ä¸å¹éï¼æä»¬èªç¶ä¼äº§çä¸ä¸ªæ°ççé®ï¼<strong>è½ä¸è½è®©ææäººçæ ·æ¬é½åä¸å­¦ä¹ ï¼èä¸æ¯è¢«èº«ä»½æ ç­¾åèªéç¦»å¼æ¥ï¼</strong></p>
<p>å¨æºå¨å­¦ä¹ ä¸­ï¼è¿ç±»â<strong>æ¯ä¸ªç±»å«åªææå°æ ·æ¬</strong>âçé®é¢è¢«ç§°ä¸º<strong>ä¸æ¬¡å­¦ä¹ ï¼one-shot learningï¼é®é¢</strong>ã<br>
èå¨å·ä½çäººè¸è¯å«åºæ¯ä¸ï¼<strong>one-shot äººè¸è¯å«</strong>æçæ¯ï¼æ¯ä¸ªèº«ä»½å¨è®­ç»æå»ºåºé¶æ®µï¼ä»æä¾ä¸å¼ ï¼ææå°å å¼ ï¼å·²ç¥äººè¸æ ·æ¬ã</p>
<p>ä¸ºäºè§£å³è¿ç§â<strong>æ»ä½æ ·æ¬éå¾å¤§ï¼ä½åä¸ªèº«ä»½æ ·æ¬æå°</strong>âççç¾ï¼äººä»¬æåºäºä¸ç§ä¸åäºä¼ ç»åç±»çæè·¯ï¼  <strong>ä¸åè®©æ¨¡ååç­âè¿å¼ è¸å±äºææäººä¸­çåªä¸ä¸ªï¼âï¼èæ¯è®©å®å¤æ­âè¿å¼ è¸æ¯å¦åæä¸ä¸ªå·²ç¥çæå¼ è¸è¶³å¤ç¸ä¼¼ï¼â</strong></p>
<p>ç°å¨ï¼ç½ç»ç®æ å°±ä»ä¸å¼å§çâå­¦ä¹ åç±»âåæäºâ<strong>å­¦ç¸ä¼¼åº¦</strong>âï¼å°±åè¿æ ·ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234253679-642676291.png" alt="image.png" loading="lazy"><br>
å¦æå¦å¾ä¸­è¿æ ·ï¼ç½ç»å®ç°äºâ<strong>å­¦ä¹ ä¸¤å¼ äººè¸çç¸ä¼¼åº¦</strong>âï¼æä»¬å°±è§£å³äºååçé®é¢ï¼</p>
<ol>
<li>å¦æåä½ææ°åå·¥å å¥æèåå·¥ç¦»èï¼å°±è¦ä¸åéè¦è°æ´ç½ç»åéæ°è®­ç»ï¼<strong>åªéè¦æç¸åºæ°æ®å å¥æ°æ®åºæä»æ°æ®åºä¸­å é¤</strong>ã</li>
<li>ææçæ°æ®é½è¢«ååå©ç¨ï¼åæ¶æ¯äººåªéè¦ä¸å¼ è¯ä»¶ç§ï¼å¨é¨ç¦æ¶äººè¸åæ°æ®åºä¸­çäººè¸å¯¹æ¯ï¼<strong>æ¾å°æ»¡è¶³ç¸ä¼¼åº¦éå¼çæ ·æ¬å³éè¿ï¼ä¸å­å¨å³æç»ã</strong></li>
</ol>
<h1 id="3-siamese-ç½ç»">3. Siamese ç½ç»</h1>
<p>ç°å¨ï¼æä»¬æç¡®äºéå¯¹é¢é¨è¯å«ä»»å¡çç®æ ï¼<strong>è®­ç»ä¸ä¸ªå¯ä»¥å­¦ä¹ ä¸¤å¼ äººè¸ç¸ä¼¼åº¦çç½ç»</strong>ã<br>
ç°å¨ï¼è¦æä¹å®ç°è¿ä¸ç¹å¢ï¼<br>
ç­æ¡å°±æ¯è¿é¨åçæ é¢ï¼Siamese ç½ç»ã<br>
è¦è¯´æçæ¯ï¼å´æ©è¾¾èå¸å¨è¯¾ç¨éæå°äºä¸ç¯ 2014 å¹´çè®ºæ <a href="https://www.cv-foundation.org/openaccess/content_cvpr_2014/papers/Taigman_DeepFace_Closing_the_2014_CVPR_paper.pdf?utm_source=chatgpt.com" target="_blank" rel="noopener nofollow">DeepFace: Closing the Gap to Human-Level Performance in Face Verification</a>ã<strong>ä½ Siamese ç½ç»å¹¶ä¸æ¯ä»è¿ç¯è®ºæææåºç</strong>ââæ©å¨ 1993 å¹´ï¼å®å°±è¢«åæåºæ¥ï¼ç¨äºå¤æ­ä¸¤å¹æåç­¾åæ¯å¦åä¸äººãåæ¥ä¹è¢«åºç¨å°äººè¸è¯å«ä»»å¡ä¸­ã<br>
Siamese ç½ç»çæ ¸å¿æè·¯æ¯<strong>éè¿å±äº«æéçååæ¯ï¼æå¤åæ¯ï¼ç¥ç»ç½ç»ï¼å°è¾å¥çä¸¤å¼ å¾åæ å°å°åä¸ç¹å¾ç©ºé´ï¼ç¶åéè¿åº¦éå½æ°ï¼å¦æ¬§æ°è·ç¦»æä½å¼¦ç¸ä¼¼åº¦ï¼è®¡ç®å®ä»¬çç¸ä¼¼åº¦</strong>ã<br>
DeepFace åé´äº Siamese ç½ç»çæè·¯ï¼å¨æ·±åº¦ CNN ä¸ç´æ¥å­¦ä¹ äººè¸ç¹å¾çç¸ä¼¼åº¦ï¼å¹¶éè¿ä¼ååå¤§è§æ¨¡è®­ç»ï¼è¿æä½¿å¾<strong>ç³»ç»æ§è½æ¥è¿äººç±»æ°´å¹³ï¼çæ­£å·å¤é¨ç½²ä»·å¼</strong>ã</p>
<p>ç°å¨ï¼å°±æ¥è¯¦ç»ççä¸ä¸ªè¾å®åç Siamese ç½ç»çè¿è¡è¿ç¨ï¼</p>
<h2 id="31-å¯¹å¾åè¿è¡ç¼ç å¤çä¸åç»æå¤±triplet-loss">3.1 å¯¹å¾åè¿è¡ç¼ç å¤çï¼ä¸åç»æå¤±ï¼triplet lossï¼</h2>
<p>æä»¬åæ¥ççä»ä¹å«å¯¹å¾åè¿è¡ç¼ç å¤çï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234657431-1853718024.png" alt="image" loading="lazy"><br>
è¿æ ·ï¼æä»¬å°±å¯ä»¥ä½¿ç¨ä¸ç»ç¹å¾åéæ¥ç¼ç ä¸å¼ äººè¸ï¼å®éä¸ï¼è¿å°±æ¯ DeepFace æåºçä¸æ­¥ä¼åï¼è¿ä¸æ­¥è®¾ç½®<strong>ä¸æ­¢ä¸ºäºè®¡ç®ç¸ä¼¼åº¦ä½åå¤ï¼åæ¶ä¹æå¤§åå°äºè®¡ç®éï¼ç¼©ç­äºè¿è¡æ¶é´</strong>ï¼å¯ä»¥è¯´ç¸å½æåã</p>
<p>ä½æ¯ï¼åæ ·ä¹æ¯å ä¸ºè¿ä¸æ­¥ç¼ç ï¼æ°çé®é¢åºç°äºï¼<strong>ä½ ä¼åç°ï¼è¿ä¸ªç¨æ¥æå¾åè½¬æ¢æç¼ç çç½ç»åæ ·éè¦è®­ç»ã</strong><br>
æ²¡éï¼æä»¬éè¦è®­ç»è¿ä¸ªç½ç»ï¼èç®æ å°±æ¯ï¼<strong>è®©åä¸ä¸ªèº«ä»½çäººè¸ç¼ç å·®å¼æå°åï¼ä¸åèº«ä»½çäººè¸çç¼ç å·®å¼æå¤§åã</strong><br>
è¦å®ç°è¿ä¸ªç®æ çå¸¸ç¨æ¹æ³å«å<strong>ä¸åç»ï¼tripletï¼æå¤±</strong>ï¼è¿æ¶ï¼<strong>ç½ç»å¨è®­ç»é¶æ®µéè¦åæ¶è¾å¥ä¸å¼ å¾å</strong>ã<br>
å®çå¬å¼é¿è¿ä¸ªæ ·ï¼</p>
<p></p><div class="math display">\[L=maxâ¡(0,â¥f(a)âf(p)â¥^2_2ââ¥f(a)âf(n)â¥^2_2+Î±)
\]</div><p></p><p>å¶ä¸­ï¼</p>
<ul>
<li><span class="math inline">\(f(a)\)</span>ï¼anchorï¼åºåå¾åï¼æ å°åçç¹å¾åé</li>
<li><span class="math inline">\(f(p)\)</span>ï¼positiveï¼åä¸èº«ä»½çå¾åï¼æ å°åçç¹å¾åé</li>
<li><span class="math inline">\(f(n)\)</span>ï¼negativeï¼ä¸åèº«ä»½çå¾åï¼æ å°åçç¹å¾åé</li>
<li><span class="math inline">\(\alpha\)</span>ï¼é´éï¼marginï¼ï¼ä¿è¯ä¸åèº«ä»½çè·ç¦»æ¯åä¸èº«ä»½è·ç¦»è³å°å¤§ <span class="math inline">\(\alpha\)</span></li>
</ul>
<p>å«æï¼æä»¬ç¨ä¸ä¸ªä¾å­æ¥æ¼ç¤ºä¸éåçï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229235145998-454139387.png" alt="image" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234301253-442526298.png" alt="image.png" loading="lazy"><br>
åªçç¬¦å·å¯è½æäºå¤ªç»äºï¼<strong>æä»¬åæ¥çä¸ä¸ªå®ä¾</strong>ï¼<br>
åè®¾ä¸å¼ äººè¸å¾åï¼ç»è¿ç½ç»æ å°åçäºç»´ç¹å¾åéå¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>å¾å</th>
<th>ç¹å¾åé</th>
</tr>
</thead>
<tbody>
<tr>
<td>a (Alice)</td>
<td>[1.0, 1.0]</td>
</tr>
<tr>
<td>p (Alice)</td>
<td>[1.2, 1.1]</td>
</tr>
<tr>
<td>n (Bob)</td>
<td>[2.5, 2.0]</td>
</tr>
</tbody>
</table>
<h4 id="1è®¡ç®æ¬§æ°è·ç¦»">ï¼1ï¼è®¡ç®æ¬§æ°è·ç¦»</h4>
<p><strong>Anchor ä¸ Positiveï¼åä¸äººï¼</strong>ï¼</p>
<p></p><div class="math display">\[â¥f(a)-f(p)â¥_2^2 = (1.0-1.2)^2 + (1.0-1.1)^2 = 0.04 + 0.01 = 0.05  
\]</div><p></p><p><strong>Anchor ä¸ Negativeï¼ä¸åäººï¼</strong>ï¼</p>
<p></p><div class="math display">\[â¥f(a)-f(n)â¥_2^2 = (1.0-2.5)^2 + (1.0-2.0)^2 = 2.25 + 1.0 = 3.25  
\]</div><p></p><h4 id="2ä»£å¥ä¸åç»æå¤±å¬å¼">ï¼2ï¼ä»£å¥ä¸åç»æå¤±å¬å¼</h4>
<p>åè®¾ <span class="math inline">\(\alpha = 0.5\)</span>ï¼ä»£å¥æ°å¼ï¼</p>
<p></p><div class="math display">\[L = \max\Big(0,0.05 - 3.25 + 0.5\Big) = \max(0, -2.7) = 0  
\]</div><p></p><p>ä»£è¡¨å½åç¹å¾åéæ»¡è¶³ç®æ ï¼åä¸äººè·ç¦»æ¥è¿ï¼ä¸åäººè·ç¦»å¤§äº <span class="math inline">\(\alpha\)</span>ã</p>
<h4 id="3å¦æ-negative-å¤ªè¿">ï¼3ï¼å¦æ Negative å¤ªè¿</h4>
<p>åè®¾ <span class="math inline">\(f(n) = [1.5, 1.3]\)</span>ï¼è®¡ç®è·ç¦»ï¼</p>
<p></p><div class="math display">\[â¥f(a)-f(n)â¥_2^2 = (1.0-1.5)^2 + (1.0-1.3)^2 = 0.25 + 0.09 = 0.34  
\]</div><p></p><p>æå¤±ä¸ºï¼</p>
<p></p><div class="math display">\[L = \max\Big(0, 0.05 - 0.34 + 0.5\Big) = \max(0, 0.21) = 0.21  
\]</div><p></p><p>ä¾¿è¯´æä¸åäººè·ç¦»å¤ªè¿ï¼ç½ç»éè¦æ´æ°ï¼ä¿çæå¤±æ¥è¿è¡ååä¼ æ­ã</p>
<p><strong>éè¿è¿ç§è®¾è®¡ï¼ç½ç»å¯ä»¥ç´æ¥å­¦ä¹ ä¸ä¸ªéååº¦éç¸ä¼¼åº¦çç¹å¾ç©ºé´ã</strong></p>
<p>æåè¦å¼ºè°çä¸ç¹æ¯ï¼ä¸ºäºè®©è®­ç»æææ´å¥½ï¼<strong>æä»¬å¨éæ©ä¸åç»æ¶ï¼ä¼å°½éè®©åºåå¾åååä¸äººçå¾åå·®å«å°½å¯è½å¤§ï¼åæ¶è®©åºåå¾ååä¸åäººçå¾åå·®å«å°½å¯è½å°ã</strong><br>
è¿å°±åæ¯å¨æå¨æé«èè¯é¾åº¦ï¼é¾é¢ä¼äºï¼ç®åé¢èªç¶ä¸å¨è¯ä¸ã<br>
ç°å¨ï¼æä»¬ä¾¿ç»§ç»­ä¸ä¸é¨åã</p>
<h2 id="32-æ­£åä¼ æ­ä¸¤å¹å¾åå¹¶è®¡ç®ç¸ä¼¼åº¦">3.2 æ­£åä¼ æ­ä¸¤å¹å¾åå¹¶è®¡ç®ç¸ä¼¼åº¦</h2>
<p>å¨æ¥æäºå¯ä»¥å¯¹å¾åè¿è¡åéç¼ç çç½ç»åï¼æä»¬ä¾¿å¯ä»¥è¿è¡ç¸ä¼¼åº¦è®¡ç®çåºç¨ï¼è¿ä¸æ­¥çè¿ç¨æ¯è¿æ ·çï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234408230-256446436.png" alt="image.png" loading="lazy"><br>
å¦å¾æç¤ºï¼æä»¬éè¿æ­£åä¼ æ­å¾å°ä¸¤å¹è¾å¥äººè¸çç¼ç ï¼å¹¶æ ¹æ®ç¼ç è®¡ç®ç¸ä¼¼åº¦ï¼èªç¶å°±å¯ä»¥æ ¹æ®éå¼å¤æ­ä¸¤å¼ äººè¸æ¯å¦å±äºåä¸ä¸ªäººã<br>
èä¸ï¼è¿ç§ä¼ æ­åè®¡ç®ç¸ä¼¼åº¦åç¦»çè®¾è®¡ï¼ä»£è¡¨<strong>æä»¬å¯ä»¥æåä¸ºæ°æ®åºä¸­çå¾åè®¡ç®å¥½ç¼ç </strong>ï¼åªéå·è¸æ¶ä¼ å¥çäººè¸åç¬ä¼ æ­å¾å°ç¼ç åè¿è¡è®¡ç®å°±å¥½äºï¼è¿å¤§å¤§æé«äºå¯é¨ç½²æ§ã</p>
<h2 id="33-æå±å¦ä¸ç§è®­ç»ç¼ç ç½ç»çæ¹å¼">3.3 æå±ï¼å¦ä¸ç§è®­ç»ç¼ç ç½ç»çæ¹å¼</h2>
<p>æä»¬ååä»ç»äºå¯ä»¥éè¿ä¸åç»æå¤±æ¥è®­ç»ç¼ç ç½ç»ï¼ä½ä½ å¯è½ä¹åç°äºï¼è¿ä¸ªæ¹æ³å¨æ°æ®åå¤é¶æ®µè¾ä¸ºå¤æã<br>
å æ­¤ï¼å´æ©è¾¾èå¸è¿ä»ç»äºå¦ä¸ç§è®­ç»æ¹æ³ï¼<strong>æ´æ¹æ ç­¾ï¼è®©Siamese ç½ç»åæ¥é»è¾åå½åä¸ºäºåç±»é®é¢ã</strong><br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234243543-574274696.png" alt="image.png" loading="lazy"><br>
è¿æ ·ï¼æä»¬å°±åæäººè¸è¯å«é®é¢åè½¬æ¢åäºäºåç±»é®é¢ï¼éè¿ååä¼ æ­æ¥è¿è¡è®­ç»ã<br>
ä½æ¯ï¼ä½ ä¼åç°ï¼<strong>å½æ°åå·¥å å¥æ¶ï¼è¿æ¯è¦éæ°è®­ç»æ¨¡åã</strong><br>
å æ­¤ï¼å®éä¸è¿ç§æ¹å¼çå®éé¨ç½²ä»·å¼å¹¶ä¸å¦å®ç¨ä¸åç»æå¤±ã</p>
<h1 id="4æ»ç»">4.æ»ç»</h1>
<table>
<thead>
<tr>
<th>æ¦å¿µ</th>
<th>åç</th>
<th>æ¯å»</th>
</tr>
</thead>
<tbody>
<tr>
<td>äººè¸éªè¯ï¼Face Verificationï¼</td>
<td>1 å¯¹ 1 é®é¢ï¼å¤æ­è¾å¥äººè¸æ¯å¦ä¸ç®æ èº«ä»½å¹é</td>
<td>å°±åé¨å«åªå¯¹æä¸ªäººè¯´âå¯ä»¥è¿âï¼å¶ä»äººå¨é¨æç»</td>
</tr>
<tr>
<td>äººè¸è¯å«ï¼Face Recognitionï¼</td>
<td>1 å¯¹å¤é®é¢ï¼éè¿æ¨¡åè¯å«è¾å¥äººè¸å±äºåªä¸ä¸ªå·²ç¥èº«ä»½</td>
<td>é¨ç¦ç³»ç»è¯å«å¤ä¸ªåå·¥ï¼ä¸éè¦åç¬ä¸ºæ¯ä¸ªäººè®¾é¸æº</td>
</tr>
<tr>
<td>å¤åç±»å»ºæ¨¡é®é¢</td>
<td>å°æ¯ä¸ªäººä½ä¸ºä¸ä¸ªç±»å«è¿è¡è®­ç»</td>
<td>æ¯ä¸ªåå·¥é½æä¸æ¬åçéï¼è¦å­¦ä¼åºåæåä¸ä¸æ¬</td>
</tr>
<tr>
<td>ä¸æ¬¡å­¦ä¹ ï¼One-Shot Learningï¼</td>
<td>æ¯ä¸ªèº«ä»½ä»æä¾æå°æ ·æ¬ï¼éè¿ç¸ä¼¼åº¦å¤æ­è¯å«</td>
<td>åªéä¸å¼ è¯ä»¶ç§å°±è½è¯å«æ°åå·¥ï¼ä¸ç¨æåçé</td>
</tr>
<tr>
<td>Siamese ç½ç»</td>
<td>å±äº«æéçååæ¯ï¼æå¤åæ¯ï¼ç½ç»ï¼å°å¾åæ å°å°åä¸ç¹å¾ç©ºé´ï¼éè¿åº¦éå½æ°è®¡ç®ç¸ä¼¼åº¦</td>
<td>åæ¶çä¸¤å¼ ç§çï¼ç¶åæ¯è¾ç¸ä¼¼åº¦</td>
</tr>
<tr>
<td>ä¸åç»æå¤±ï¼Triplet Lossï¼</td>
<td>è®­ç»ç½ç»ä½¿åä¸äººè·ç¦»æå°ï¼ä¸åäººè·ç¦»æå¤§ï¼ç½ç»éè¾å¥ä¸å¼ å¾åï¼anchor, positive, negativeï¼</td>
<td>æé«èè¯é¾åº¦ï¼åºåé¢åç¸ä¼¼é¢å·®å«å°ï¼ä¸åé¢å·®å«å¤§ï¼è®­ç»æ´ææ</td>
</tr>
<tr>
<td>æ­£åä¼ æ­ä¸¤å¾è®¡ç®ç¸ä¼¼åº¦</td>
<td>å·²è®­ç»ç½ç»å¯¹ä¸¤å¹å¾åç¼ç åï¼è®¡ç®ç¹å¾è·ç¦»æç¸ä¼¼åº¦ï¼ç¨éå¼å¤æ­æ¯å¦åä¸äºº</td>
<td>åæç§çç¼ç æâèº«ä»½ç¹å¾å¡çâï¼å·è¸æ¶åªæ¯å¯¹å¡ç</td>
</tr>
<tr>
<td>Siamese + é»è¾åå½äºåç±»</td>
<td>å°ä¸¤å¼ å¾åè¾å¥ Siamese ç½ç»ï¼éè¿é»è¾åå½å¤æ­æ¯å¦åä¸äºº</td>
<td>å°äººè¸è¯å«é®é¢ç®åæâæ¯/ä¸æ¯åä¸äººâçéæ©é¢</td>
</tr>
<tr>
<td>é¨ç½²å¯è¡æ§å¯¹æ¯</td>
<td>ä¸åç»æå¤±æ¯æ one-shotãå¯æåè®¡ç®æ°æ®åºç¹å¾åéï¼æ³åå¼ºï¼é»è¾åå½æ¹å¼æ°èº«ä»½ééæ°è®­ç»ï¼æ³åå·®</td>
<td>ä¸åç»ï¼èè¯èéç¨è½åï¼é»è¾åå½ï¼èè¯åªä¼ç­å·²æé¢ç®</td>
</tr>
</tbody>
</table>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.001388888888888889" data-date-updated="2025-12-29 23:54">2025-12-29 23:52</span>&nbsp;
<a href="https://www.cnblogs.com/Goblinscholar">å¥å¸æå­¦è</a>&nbsp;
éè¯»(<span id="post_view_count">32</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19418306);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19418306', targetLink: 'https://www.cnblogs.com/Goblinscholar/p/19418306', title: 'å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨åï¼è®¡ç®æºè§è§ ç¬¬åå¨ï¼å·ç§¯ç½ç»åºç¨ (ä¸) äººè¸è¯å«' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Python osåº os.walkä½¿ç¨ï¼è¯¦ç»æç¨ãå¸¦å®è·µï¼ ]]></title>
    <link>https://www.cnblogs.com/io-T-T/p/19418274</link>
    <guid>a2f659a9411508120583e3c0fe7f4fad</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/io-T-T/p/19418274" title="åå¸äº 2025-12-29 23:19">
    <span role="heading" aria-level="2">Python osåº os.walkä½¿ç¨ï¼è¯¦ç»æç¨ãå¸¦å®è·µï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        Python osåº os.walkä½¿ç¨ï¼è¯¦ç»æç¨ãå¸¦å®è·µï¼
os.walk å¤çæä»¶
os.walkåç
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="python-osåº-oswalkä½¿ç¨è¯¦ç»æç¨å¸¦å®è·µ">Python osåº os.walkä½¿ç¨ï¼è¯¦ç»æç¨ãå¸¦å®è·µï¼</h2>
<p>-----------------------<em><strong>PSï¼env python version==3.10</strong></em>----------------</p>
<p>ç®ä»ï¼</p>
<p>â	æ¬æä»¥å®éæ¡ä¾è¯´æ<code>os.walk</code>å¯¹æä»¶çä½¿ç¨æ¹å¼ãä¸»è¦æå­¦åå®¹ï¼</p>
<ul>
<li><code>os.walk</code>åºå®éçä½¿ç¨</li>
<li><code>os.walk</code>æä½³å®è·µ</li>
<li><em>ï¼å¯éï¼os.walkåç</em></li>
<li><em>ï¼å¯éï¼è¿­ä»£å¨æ¹åçè§£</em></li>
</ul>
<p>å¨æ2000å­å·¦å³ï¼ä»£ç å­æ°800ï¼å«è¿­ä»£å¨180ï¼å·¦å³ï¼å»ºè®®å­¦ä¹ æ¶é´10-15minï¼ä¸å«è¿­ä»£å¨ï¼ãè¥å­¦ä¹ è¿­ä»£å¨å»ºè®®30min+</p>
<h3 id="1-æ¨¡æå®éä½¿ç¨ç¯å¢">1 æ¨¡æå®éä½¿ç¨ç¯å¢</h3>
<p>â	PSï¼ä»ä½ä¸ºæ¡ä¾è¯´æåèï¼è¥å·²æå¯ç¨çæä»¶å¤¹/ç®å½ï¼è¯·ç§»æ­¥ç¬¬äºæ­¥</p>
<p>â	<img alt="image-20251222214254412" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3244923/202512/3244923-20251229231342848-1708394222.png" class="lazyload"></p>
<ol>
<li>
<p>æ ¹æ®ä¸å¾æ¨¡æå®éä½¿ç¨æåµï¼</p>
<ul>
<li>
<p>éææ°å»ºä¸ä¸ªç®å½ï¼ç¡®ä¿ä¸ä¼æå¶ä»æä»¶ï¼</p>
</li>
<li>
<p>å¨ï¼æ°å»ºç®å½çï¼æ ¹ç®å½åå»ºä¸ä¸ª<strong>æä»¶</strong>å<strong>æä»¶å¤¹</strong>ï¼åç§°éæï¼ä¹å¯ä»¥åç§æçæ ·ä¾æ¥ï¼</p>
</li>
<li>
<p>è¿å¥<code>root</code>æä»¶å¤¹ï¼æ°å»ºä¸¤ä¸ªæ¬¡çº§æä»¶å¤¹ï¼<code>dir1</code>ã<code>dir2</code>ï¼</p>
<ul>
<li>rootæä»¶å¤¹ä¸ç´æ¥åå»ºæ¬¡çº§ç®å½æä»¶<code>F1.txt</code></li>
<li>åå»ºæ¬¡çº§ç®å½æä»¶<code>dir1</code>ã<code>dir2</code>
<ul>
<li>è¿å¥<code>dir2</code>æä»¶å¤¹
<ul>
<li>åå»ºæä»¶ï¼<code>F2.txt</code>ï¼</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="2-è§£æoswalkå½æ°">2 è§£æ<code>os.walk</code>å½æ°</h3>
<p>é¢ååºç¡è®²è§£ï¼è¯¦ç»è§ <a href="https://docs.python.org/zh-cn/3.10/library/os.html?highlight=os%20walk#os.walk" target="_blank" rel="noopener nofollow">os.walkå®æ¹è¯´æ</a></p>
<ul>
<li>
<p>ä»ä¹æ¯ python ç<code>os</code>åº</p>
<ul>
<li>æ¬æ¨¡åæä¾äºä¸ç§ä½¿ç¨ä¸æä½ç³»ç»ç¸å³çåè½çä¾¿æ·å¼éå¾ãï¼å¦æä»¶è·¯å¾æ§å¶ãæä»¶ä¿¡æ¯è·åãéåç®å½æä»¶ã<code>os.walk</code>ããå¶ä»ç³»ç»è°ç¨åè½ï¼</li>
</ul>
</li>
<li>
<p><code>os.walk</code>å½æ°è®²è§£ï¼</p>
<p><code>os.walk</code>(<strong><em>top</em>, <em>topdown=True</em>,</strong> <em>onerror=None</em>, <em>followlinks=False</em>)</p>
<ul>
<li>
<p>ä¸»è¦èç¦äºåä¸¤ä¸ªåæ°å³å¯ï¼</p>
<ul>
<li><code>top</code>ï¼æ ¹ç®å½è·¯å¾ï¼strï¼</li>
<li><code>topdown</code>ï¼èªä¸èä¸æ¨¡å¼ï¼é»è®¤ï¼<code>True</code>ï¼ä¸ºèªä¸èä¸éåï¼<code>False</code>åä»åºåä¸éå</li>
</ul>
</li>
<li>
<p>è¿åå¼ï¼</p>
<ul>
<li>
<p>è¿åè¿­ä»£å¨ ï¼è¿­ä»£å¨æ¯æ¬¡çæçå¯¹è±¡ä¸ºï¼<code>(dirpath, dirnames, filenames)</code></p>
<p><code>dirpath</code>ï¼ å½åæä»¶å¤¹è·¯å¾</p>
<p><code>dirnames</code>ï¼æä»¶å¤¹åç§°</p>
<p><code>filenames</code>ï¼æä»¶åç§°</p>
</li>
<li>
<p>å¦æä¸çè§£è¿­ä»£å¨ï¼å¯ä»¥ææ¶çè§£ä¸ºos.walkè¿åäº åç» <code>(dirpath, dirnames, filenames)</code>çåè¡¨ï¼ç±»ä¼¼äºä¸æ (çç¥åå¼å·):</p>
<pre><code class="language-python">[
	(C:/user/, [root],[rott_text.txt] ),		#æ ¹ç®å½
	(C:/user/root, [dir1,dir2],[F1.txt] ),		#è¿å¥rootæä»¶å¤¹
	(C:/user/root/dir1, [],[] ),				#è¿å¥dir1æä»¶å¤¹
	(C:/user/root/dir2, [],[F2.txt] )			#dir1ä¸­æ²¡ææä»¶äºï¼éåä¸ä¸å±çº§ï¼è¿å¥dir2æä»¶å¤¹ä¸­
    #è¯»åæææä»¶/æä»¶åå®æ¯ï¼
]
</code></pre>
<p>åªä¸è¿ä»çæçç¹æ®âåè¡¨âç»å¸¸éç¨äºforï¼ä¸è½ç´æ¥ä½ä¸ºåè¡¨æå°ï¼ç´æ¥æå°æ¯è¿æ ·å­çï¼</p>
<pre><code class="language-bash">#code
dir_path = r'your_dir'						#æ¿æ¢ä¸ºä½ çæä»¶å¤¹
dirpath, dirnames, filenames = os.walk(dir_path)
print(f'dir_path:{dirpath}\ndir_name:{dirnames}\nfile_names:{filenames}')

#resultï¼
	dirpath, dirnames, filenames = os.walk(dir_path)
ValueError: too many values to unpack (expected 3)
</code></pre>
<p>ç©¶å¶åå æ¯è¿åçåä¸ªè¿­ä»£å¨ï¼å¹¶éä¸ä¸ªåè¡¨åç»ï¼åæ¬¢ç»ç©¶è¿é¨åçè§åæï¼ç®è¦çè¯ç¥éä¸è½ç´æ¥è°ç¨ï¼ä¸è¬ç»å<code>for</code>è°ç¨å°±å¥½ï¼è¿ä¸ªå¹¶éæ·±åº¦ææï¼çå®åé¢ä¼çå¯è½ææ´å¥½ççè§£ã</p>
<p>è¿­ä»£å¨å­¦ä¹ å»ºè®®ï¼<a href="https://www.bilibili.com/video/BV1jt421c7yN/?" target="_blank" rel="noopener nofollow">ãPythonãä»è¿­ä»£å¨å°çæå¨ï¼å°åå­ä¹è½å¤çå¤§æ°æ®</a></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3-è°ç¨æ ·ä¾">3 è°ç¨æ ·ä¾ï¼</h3>
<p>åé¢åæ°æç¹ä¸å¥½çè§£ä¹æ²¡å³ç³»ï¼åªè¦å¤§æ¦ç¥éå°±å¥½äºï¼ä¸é¢æ¯å®éå½æ°ä½¿ç¨</p>
<ol>
<li>åå¤å¶ä¸é¢ä»£ç è³æ°pyæä»¶ï¼æ¹ä¸ä¸ <code>dir_path</code>è¿è¡ä¸ä¸ä½ä¼ä¸ä¸</li>
</ol>
<pre><code class="language-python">import os

def walk_example(dir_path:str):
    #os.walk è¿åç±»ä¼¼äºä¸åç»åè¡¨ç»æï¼ç¶åè¿è¡éå
    for root, dir_names, file_names in os.walk(dir_path):   #(dirpath, dirnames, filenames)
        print(f'dirpath :{root}')
        print(f'dir_names :{dir_names}')
        print(f'file_names:{file_names}')
        print('-'*50)


if __name__ == '__main__':
    dir_path = r'your_dir_path'
    walk_example(dir_path)
</code></pre>
<ol start="2">
<li>
<p>è¾åºç»æï¼</p>
<img alt="image-20251222223407130" style="zoom: 67%" data-src="https://img2024.cnblogs.com/blog/3244923/202512/3244923-20251229232107540-656148957.png" class="lazyload">
<p>è¿éå¯ä»¥çåºï¼é»è®¤ç¶æä¸ï¼ï¼æ¯ä»é¡¶åä¸ï¼ä¸å±å±éåã</p>
<blockquote>
<p>dirpath : <code>x:\your_path\walk</code></p>
<p>dir_names :['root']<br>
file_names:['root_text.txt']</p>
</blockquote>
<ul>
<li>è¿éæ¯æ ¹ç®å½ä¸­åºç°çæä»¶å¤¹åç§°(root)ãæä»¶('root_text.txt')</li>
</ul>
<blockquote>
<p>dirpath :<code>x:\your_path\walk\root</code><br>
dir_names :['dir1', 'dir2']<br>
file_names:['F1.txt']</p>
</blockquote>
<ul>
<li>è¿å¥äºrootæä»¶å¤¹ï¼éé¢åå«<strong>ä¸¤ä¸ªæä»¶å¤¹</strong>åå½åæä»¶å¤¹æ ¹ç®å½ä¸ç<strong>åä¸ªæä»¶</strong>
<ul>
<li>åé¢ä¸¤ä¸ªåçï¼ä¸»è¦æ¯æåæ¯ä¸å±çº§çååï¼æ¯æ¬¡è¿å¥ä¸ä¸ä¸ªæä»¶å¤¹æ¶ï¼<code>root</code><strong>æè¡¨è¾¾çå±æ§é½ä¼ææåå</strong>ï¼åæäºå½åæ ¹è·¯å¾ã</li>
<li>é¤æ­¤ä¹å¤ï¼å¯ä»¥çå°ï¼4é¡¹ç<code>dir_name</code>è¾åºï¼åå¥½æ¯æä»¬<strong>å¨é¨</strong>çç®å½åç§°ï¼<code>file_names</code>åç</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ä»ä¸æï¼å¯ä»¥çåº <code>os.walk</code>å½æ°çéåç»æä¼æ ¹æ®æ·±å¥çå±çº§è¾åºä»¥ä¸ä¿¡æ¯ï¼</p>
<ul>
<li>å½åæä»¶è·¯å¾ï¼strï¼</li>
<li>å­å¨çæä»¶å¤¹ï¼listï¼</li>
<li>å­å¨çæä»¶ï¼listï¼</li>
</ul>
<p>æä»ä»¬èåèµ·æ¥ï¼å°±è½è·åæä»¬æéè¦çï¼</p>
<ul>
<li>æåæä»¶å¤¹ä¿¡æ¯ï¼æå¤çï¼</li>
<li>æåæä»¶ä¿¡æ¯ï¼æå¤çï¼</li>
</ul>
</li>
</ol>
<h3 id="4-å®éè¿ç¨æ¡ä¾æä½³å®è·µ">4 å®éè¿ç¨æ¡ä¾ï¼æä½³å®è·µï¼</h3>
<p>æ¬å°èä¼ä»ä»¥ä¸å ç¹æ¥è¯´æå¦ä½éè¿<code>os.walk</code>è¿è¡æä»¶çæååå¤çã</p>
<ul>
<li>æåå¨é¨ä¿¡æ¯ï¼æä»¶å¤¹ãæä»¶ï¼ãçè§£è°ç¨æ¹å¼ã</li>
<li>æé æä»¶å¤¹ä¸­ï¼æææä»¶çè·¯å¾</li>
<li>æ ¹æ®å³é®å­æåï¼æä»¶/æä»¶å¤¹ï¼è·¯å¾</li>
</ul>
<h4 id="41-æåå¨é¨ä¿¡æ¯æä»¶å¤¹æä»¶çè§£è°ç¨æ¹å¼">4.1 æåå¨é¨ä¿¡æ¯ï¼æä»¶å¤¹ãæä»¶ï¼ãçè§£è°ç¨æ¹å¼ã</h4>
<p>â	å¾ç®åï¼åªè¦æå¯¹åºå¨é¨è¾åºæ¶éèµ·æ¥ï¼å°±è½è·å¾æä»¬éè¦çå¨æä»¶åãæä»¶ä¿¡æ¯äºã</p>
<pre><code class="language-python">def walk_get_all_info(dir_path:str):
    '''
    è·åæææä»¶åãæä»¶ä¿¡æ¯
    :param dir_path: è¾å¥æä»¶å¤¹è·¯å¾
    '''
    dir_list = []
    file_list = []
    for root, dirnames, files in os.walk(dir_path):
        for dir_name in dirnames:
            dir_list.append(dir_name)
            # print(dir_name)					#ä¸çè§£å¯ä»¥è°è¯æ¥ä¸ä¸çè§£ä¸ä¸ï¼ä¸¤èæ¯ç¸äºç¬ç«ç
        for file in files:
            file_list.append(file)
            # print(file)
    print(dir_list)
    print(file_list)
if __name__ == '__main__':
    dir_path = r'your_path'
    walk_get_all_info(dir_path)
</code></pre>
<p>â	è¾åºï¼</p>
<blockquote>
<p>root<br>
root_text.txt<br>
dir1<br>
dir2<br>
F1.txt<br>
F2.txt</p>
</blockquote>
<h4 id="42-æé æä»¶å¤¹ä¸­æææä»¶çè·¯å¾">4.2 æé æä»¶å¤¹ä¸­ï¼æææä»¶çè·¯å¾</h4>
<p>â	éè¿<strong>4.1</strong> æä»¬ç¥éäº<code>os.walk</code>çè¿­ä»£æ¹å¼ãå¯ä»¥éè¿âå½åæ ¹ç®å½âä¸ âæéæä»¶åç§°âç¸ç»åï¼ä»èéåæææä»¶çè·¯å¾ã</p>
<pre><code class="language-python">def walk_get_file_path(dir_path:str):
    '''
    è·åæä»¶è·¯å¾
    :param dir_path: è¾å¥æä»¶å¤¹è·¯å¾
    '''

    file_list = []
    for root, dirnames, files in os.walk(dir_path):
        print(f'local root path :{root}')
        for file in files:
            file_path = os.path.join(root, file)        #window ä¸ï¼ç­ä»·äº root + "\\" + file
            # file_path = root + "\\" + file
            print(f'file path :{file_path}')
            file_list.append(file_path)
        print('-'*50)
    print(file_list)
</code></pre>
<h4 id="43-æ ¹æ®å³é®å­æåæä»¶è·¯å¾">4.3 æ ¹æ®å³é®å­æåæä»¶è·¯å¾</h4>
<p>â	è¿éä»¥æç®åçå³é®å­æåï¼å³ <code>if keyword in file</code>ä¸ºä¾ã</p>
<pre><code class="language-python">def filter_by_key_word(dir_path,key_word:str='F1'):   
    '''
    æä»¶å¤¹è·¯å¾ä»¥å³é®å­ï¼éå½æ¥æ¾ç¬¦åå³é®å­çæä»¶
    :param dir_path: è¾å¥æ ¹æä»¶å¤¹
    :param key_word: å³é®å­
    '''
    res:list = []
    for root, dirnames, files in os.walk(dir_path):
        for file in files:
            if key_word in file:
                res.append(
                    os.path.join(root, file)
                )
    print(res)
    return
</code></pre>
<p>æç§é¢æï¼å°±åºè¯¥è¾åº<code>F1</code>ï¼</p>
<blockquote>
<p>['E:\walk\root\F1.txt']</p>
</blockquote>
<p>æ´æ¹å³é®å­ï¼ä¹å¯ä»¥åå°ç­éä¸åæä»¶çåè½ï¼å¯ä»¥èªå·±æ¹ä¸ä¸ãå¯¹<code>files</code>è¿­ä»£æ¹ä¸ºå¯¹<code>dirname</code>è¿­ä»£ï¼ä¸æ ·è½å®æå¯¹æä»¶å¤¹çå³é®å­æåï¼å¯ä»¥å°è¯ä¸ä¸</p>
<h4 id="44-å¶ä»è¿ç¨">4.4 å¶ä»è¿ç¨</h4>
<p>â	è½æ¾å°æä»¶å°åï¼åç»­å°±å¯ä»¥æç§ä½ æ³å¤ççæ¹å¼å¯¹æä»¶è¿è¡å¤çäºï¼è¿ä¸ªæ ¹æ®åèªéè¦è¿è¡æ©å±å°±å¥½ï¼æç¨ç»æã</p>
<h3 id="5-é¨åä»£ç ">5. é¨åä»£ç ï¼</h3>
<pre><code class="language-python">import os

def walk_example(dir_path:str):
	
    # walk_iter = os.walk(dir_path)
    # print(walk_iter.__next__())


    for root, dir_names, file_names in os.walk(dir_path):   #(dirpath, dirnames, filenames)
        print(f'dirpath :{root}')
        print(f'dir_names :{dir_names}')
        print(f'file_names:{file_names}')
        print('-'*50)


def walk_get_file_path(dir_path:str):
    '''
    è·åæä»¶è·¯å¾
    :param dir_path: è¾å¥æä»¶å¤¹è·¯å¾
    '''

    file_list = []
    for root, dirnames, files in os.walk(dir_path):
        print(f'local root path :{root}')
        for file in files:
            file_path = os.path.join(root, file)        #window ä¸ï¼ç­ä»·äº root + "\\" + file
            # file_path = root + "\\" + file
            print(f'file path :{file_path}')
            file_list.append(file_path)
        print('-'*50)
    print(file_list)
    return

def filter_by_key_word(dir_path,key_word:str='F1'):
    '''
    æä»¶å¤¹è·¯å¾ä»¥å³é®å­ï¼éå½æ¥æ¾ç¬¦åå³é®å­çæä»¶
    :param dir_path: è¾å¥æ ¹æä»¶å¤¹
    :param key_word: å³é®å­

    '''
    res:list = []
    for root, dirnames, files in os.walk(dir_path):
        for file in files:
            if key_word in file:
                res.append(
                    os.path.join(root, file)
                )
    print(res)
    return

if __name__ == '__main__':
    dir_path = r'your_path'
    # walk_example(dir_path)
    # walk_get_file_path(dir_path)
    filter_by_key_word(dir_path)
</code></pre>
<h3 id="6-è¿­ä»£å¨ç¸å³éå¿é¡»">6 è¿­ä»£å¨ç¸å³ï¼éå¿é¡»ï¼</h3>
<p>â	å»ºè®®åå»å­¦ä¹ ä¸ä¸ä»ä¹æ¯è¿­ä»£å¨ï¼åçè¿ä¸ªæ¼ç¤ºä»£ç ï¼å¯¹<code>os.walk</code>çè§£ä¼æ´æ·±ï¼è¿è¾¹è¿æ¯å»ºè®®å­¦ä¸ä¸çï¼å¦æå¤æ¶é´çè¯ï¼è¶å­¦os.walkå¤å­¦ä¸ä¸ªè¿­ä»£å¨/çæå¨ï¼ä½ä¹èä¸ä¸ºå¢ï¼å½æ°è®²è§£å¡éé¢äºï¼å°±è¿æ ·å§ã</p>
<pre><code class="language-python">def iter_example(dir_path:str):
    '''
    è¿­ä»£å¨çè§£ä»£ç 
    :param dir_path:
    '''
    #ææ²¡è®°éçè¯ï¼æ¯è¦æ__next__ å __iter__ ç±»æ¹æ³ï¼æè½æ¯è¿­ä»£å¨ç±»
    walk_iter = os.walk(dir_path)
    print(walk_iter.__next__())         #è·åè¿­ä»£å¨çä¸ä¸ä¸ªåç´ ï¼ä¸è¬é½ç¨nextè®¿é®ä¸ä¸ä¸ªåç´ 
    print(walk_iter.__iter__())         #è·åè¿­ä»£å¨æ¬èº«ï¼è¿éos.walkè¿åçæ¯generator objectï¼æ¬è´¨ä¸ä¹æ¯è¿­ä»£å¨ï¼ä¸å¤ªè½è·åå½åè¿­ä»£å¨çåç´ å¢ï¼
    print(next(walk_iter))              #ç¸ååæ³
    print('#'*25+"åéç¬¦"+'#'*25)
    count = 0
    while True:
        count += 1
        try:
            print(f'next element:{walk_iter.__next__()}')
            print("-"*50 + f"{count}")
        except Exception as e:          #æ å¯è¿­ä»£å¯¹è±¡åï¼ä¼raiseä¸ä¸ªStopIteration Error
            # print('finish iter, break')
            # break                         #å¸¸è§å¾ªç¯éåºæºå¶
            raise e

</code></pre>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.001388888888888889" data-date-updated="2025-12-29 23:21">2025-12-29 23:19</span>&nbsp;
<a href="https://www.cnblogs.com/io-T-T">io_T_T</a>&nbsp;
éè¯»(<span id="post_view_count">42</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19418274);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19418274', targetLink: 'https://www.cnblogs.com/io-T-T/p/19418274', title: 'Python osåº os.walkä½¿ç¨ï¼è¯¦ç»æç¨ãå¸¦å®è·µï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ docker-compose é¨ç½²åèç¹ kafka 4.0 æµè¯ç¯å¢ ]]></title>
    <link>https://www.cnblogs.com/apocelipes/p/19417908</link>
    <guid>75d9efcc5077d799d7d37cace482aade</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/apocelipes/p/19417908" title="åå¸äº 2025-12-29 20:34">
    <span role="heading" aria-level="2">docker-compose é¨ç½²åèç¹ kafka 4.0 æµè¯ç¯å¢</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>é«çæ¬kafkaå·²ç»ä¸åéè¦ZooKeeperå½ä¿å§æè½å¯å¨äºï¼ç°å¨é¨ç½²ä¸ä¸ªåæºåèç¹æµè¯ç¯å¢æ¯åæ¥æ¹ä¾¿ä¸å°ã</p>
<p>ä¸è¿æå¸¸ç¨ç<code>bitnami/kafka</code>ä¸åæä¾åè´¹éåï¼å¯¼è´æä»¬åªè½ç¨<code>apache/kafka</code>ï¼æ°éåçéç½®ä¼ç¨å¾®éº»ç¦ä¸äºï¼æä»¥è®°å½ä¸ä¸ã</p>
<p>é¨ç½²åå®¹ï¼</p>
<ul>
<li>åèç¹kafkaæå¡ï¼çæ¬4.0+</li>
<li>kafka UIï¼æ¹ä¾¿ç®¡çï¼çæ¬ç¨ææ°ç</li>
<li>å¼å¯ç®åçç¨æ·åå¯ç éªè¯</li>
</ul>
<p>docker-composeæä»¶ï¼</p>
<pre><code class="language-yaml">version: '3'

networks:
  kafka-net:

services:
  kafka:
    image: apache/kafka:latest
    container_name: kafka
    networks:
      - kafka-net
    ports:
      - "9092:9092"
    volumes:
      - ./kafka_data:/var/lib/kafka/data
      - ./kafka_server_jaas.conf:/etc/kafka/kafka_server_jaas.conf # éç½®ç¨æ·åå¯ç 
    environment:
      KAFKA_NODE_ID: 1
      KAFKA_PROCESS_ROLES: 'broker,controller'
      KAFKA_CONTROLLER_QUORUM_VOTERS: '1@localhost:9093'
      KAFKA_CONTROLLER_LISTENER_NAMES: 'CONTROLLER'
      
      # å®ä¹çå¬å¨ï¼EXTERNAL(9092) èµ° SASL è®¤è¯ï¼PLAINTEXT(29092) ç»å®¹å¨åç¨ï¼è¿éä¹æ¹ä¸º SASL ç¡®ä¿å®å¨ï¼
      KAFKA_LISTENERS: 'SASL_PLAINTEXT://0.0.0.0:29092,EXTERNAL://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093'
      KAFKA_ADVERTISED_LISTENERS: 'SASL_PLAINTEXT://kafka:29092,EXTERNAL://localhost:9092'
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: 'CONTROLLER:PLAINTEXT,SASL_PLAINTEXT:SASL_PLAINTEXT,EXTERNAL:SASL_PLAINTEXT'
      KAFKA_INTER_BROKER_LISTENER_NAME: 'SASL_PLAINTEXT'
      
      # SASL/PLAIN è®¤è¯éç½®
      KAFKA_SASL_ENABLED_MECHANISMS: 'PLAIN'
      KAFKA_SASL_MECHANISM_INTER_BROKER_PROTOCOL: 'PLAIN'
      # åè¯ Kafka è¯»åæä»¬ç JAAS æä»¶
      KAFKA_OPTS: "-Djava.security.auth.login.config=/etc/kafka/kafka_server_jaas.conf"

      # æ°æ®æä¹å
      KAFKA_LOG_DIRS: '/var/lib/kafka/data'

  kafka-ui:
    image: provectuslabs/kafka-ui:latest
    container_name: kafka-ui
    depends_on:
      - kafka
    networks:
      - kafka-net
    ports:
      # æ å°å°8090ï¼å ä¸º8080ä¸è¬è¿å¾æå¶ä»çæå¡åæµè¯
      - "8090:8080"
    environment:
      KAFKA_CLUSTERS_0_NAME: local
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka:29092
      # éç½® UI ä½¿ç¨ç¨æ·ååå¯ç è¿æ¥ Kafka
      KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL: SASL_PLAINTEXT
      KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM: PLAIN
      KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG: 'org.apache.kafka.common.security.plain.PlainLoginModule required username="ä½ éç½®çç¨æ·å" password="ä½ éç½®çå¯ç ";'
</code></pre>
<p>éç½®æä»¶éè¾å¥ç¨æ·åå¯ç ï¼</p>
<pre><code class="language-conf">KafkaServer {
    org.apache.kafka.common.security.plain.PlainLoginModule required
    username="èç¹å¨éç¾¤åéä¿¡æ¶çç¨æ·å"
    password="èç¹å¨éç¾¤åéä¿¡æ¶çå¯ç "
    # ä¸é¢è¿äºææ¯ç¨æ·éç½®
    # æ ¼å¼user_&lt;ç¨æ·å&gt;="å¯ç "
    user_apot="ä½ éç½®çå¯ç ";
};
</code></pre>
<p>åå»ºå¥½æä»¶åç®å½ä¹åç¨<code>docker-compose up -d</code>å°±è½å¯å¨æå¡äºãè®¿é®<code>localhost:8090</code>å¯ä»¥çå°kafkaçwebæ§å¶é¢æ¿ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1434464/202512/1434464-20251229202723957-374430349.png" alt="image" loading="lazy"></p>
<p>å®è£å¥½ä¹åå¯ä»¥ç¨ä¸é¢çå½ä»¤æ¥ççæ¬ï¼</p>
<pre><code class="language-console">$ docker exec -it kafka /opt/kafka/bin/kafka-server-start.sh --version

[2025-12-29 11:08:34,595] INFO Registered kafka:type=kafka.Log4jController MBean (kafka.utils.Log4jControllerRegistration$)
4.0.0
</code></pre>
<p>å¯ä»¥çå°å·²ç»éç½®å¥½äºkafka 4.0ç¯å¢ã</p>
<p><code>apache/kafka</code>çéåéåç½®äºåç§æä½kafkaçèæ¬ï¼ä¸è¿è¿äºèæ¬æ²¡è¢«æ·»å è¿<code>$PATH</code>ï¼æ§è¡çæ¶åéè¦æå®è·¯å¾ï¼</p>
<pre><code class="language-bash"># åéç½®ç»å½éªè¯ä¿¡æ¯
docker exec -it kafka bash -c "cat &lt;&lt;EOF &gt; /tmp/client.conf
security.protocol=SASL_PLAINTEXT
sasl.mechanism=PLAIN
sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required \
  username='å®¢æ·ç«¯ç»å½ç¨æ·åï¼å°±æ¯æä»¬ä¹åç¨user_xxxéç½®çé£äº' \
  password='å®¢æ·ç«¯ç»å½å¯ç ';
EOF"

# è°ç¨èæ¬åå»ºä¸ä¸ªtopicï¼éè¦æå®èæ¬è·¯å¾
docker exec -it kafka /opt/kafka/bin/kafka-topics.sh --command-config /tmp/client.conf \
  --bootstrap-server localhost:9092 \
  --create \
  --topic test.data \
  --partitions 1 \
  --replication-factor 1 \
  --config cleanup.policy=delete \
  --config retention.ms=86400000
</code></pre>
<p>ææèæ¬é½å­æ¾å¨<code>/opt/kafka/bin</code>è·¯å¾ä¸ï¼è°ç¨åè¿éè¦æä¾ç»å½å­è¯ä¿¡æ¯ï¼è¿äºéè¦æ³¨æãæå¼<code>localhost:8090</code>ä¸çweb UIï¼å°±è½æ¾å°æä»¬åååå»ºçtopicäºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1434464/202512/1434464-20251229202843717-1676041370.png" alt="image" loading="lazy"></p>
<p>è¿æå¤çç­ç¥åè¿ææ¶é´ä¹å·²ç»è¢«æ­£ç¡®è®¾ç½®ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1434464/202512/1434464-20251229203013465-1213915024.png" alt="image" loading="lazy"></p>
<p>æ»ä½èè¨æ§è¡èæ¬è¿æ¯æäºç¹çï¼ææ´æ¿æéè¿ä»£ç æèwebçé¢æ¥åè¿äºæä½ã</p>
<p>æåæä»¬åä¸ä¸ªgoçæµè¯ä»£ç ï¼åæä»¬çæµè¯ç¨åèç¹kafkaéåå¥ä¸äºæ°æ®ï¼</p>
<pre><code class="language-golang">package main

import (
	"context"
	"math/rand/v2"
	"strconv"
	"time"

	"github.com/segmentio/kafka-go"
	"github.com/segmentio/kafka-go/sasl/plain"
)

const (
	topic         = "lean.data1"
	kafkaEndpoint = "localhost:9092"
)

func main() {
	mechanism := plain.Mechanism{
		Username: "å®¢æ·ç«¯ç»å½ç¨æ·å",
		Password: "å®¢æ·ç«¯ç»å½å¯ç ",
	}

	dialer := &amp;kafka.Dialer{
		Timeout:       10 * time.Second,
		DualStack:     true,
		SASLMechanism: mechanism,
	}

	w := kafka.NewWriter(kafka.WriterConfig{
		Brokers: []string{kafkaEndpoint},
		Dialer:  dialer, // å¿é¡»ä¼ å¥å¸¦ SASL ç dialer
		Async:   false,
	})
	defer w.Close()

	msg := kafka.Message{
		Topic: topic,
		Key:   []byte("test"),
		Value: []byte(strconv.Itoa(rand.Int())), // éä¾¿åå¥ä¸äºéæºæ°æ®
	}

	ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)
	defer cancel()

	err := w.WriteMessages(ctx, msg)
	if err != nil {
		panic(err)
	}
}
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1434464/202512/1434464-20251229202601662-326565622.png" alt="image" loading="lazy"></p>
<p>å¯ä»¥çå°æä»¬çéæºæ°å·²ç»æ­£å¸¸åå¥topicäºã</p>
<p>æ³¨æï¼è¿ä¸ªéç½®åªä½¿ç¨äºæåºæ¬çéªè¯ï¼ä¸æ¯åèç¹ï¼ä¸éåå¨æµè¯åå­¦ä¹ ä¹å¤çä»»ä½ç¨éä½¿ç¨ï¼ä¸ºäºå®å¨æä¹å»ºè®®å¨æµè¯å®æä¹åå°±ç«å»ç¨<code>docker-compose down</code>å³é­æå¡ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.008333333333333333" data-date-updated="2025-12-29 20:46">2025-12-29 20:34</span>&nbsp;
<a href="https://www.cnblogs.com/apocelipes">apocelipes</a>&nbsp;
éè¯»(<span id="post_view_count">64</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19417908);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19417908', targetLink: 'https://www.cnblogs.com/apocelipes/p/19417908', title: 'docker-compose é¨ç½²åèç¹ kafka 4.0 æµè¯ç¯å¢' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãå¤§æ°æ® & AIãFlink Agents æºç è§£è¯» --- (2) ---  æ ¸å¿æ¶æ ]]></title>
    <link>https://www.cnblogs.com/rossiXYZ/p/19369781</link>
    <guid>3e73e9ef6d384f88f508205efca71659</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/rossiXYZ/p/19369781" title="åå¸äº 2025-12-29 20:24">
    <span role="heading" aria-level="2">ãå¤§æ°æ® &amp; AIãFlink Agents æºç è§£è¯» --- (2) ---  æ ¸å¿æ¶æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="å¤§æ°æ®--aiflink-agents-æºç è§£è¯»-----2------æ ¸å¿æ¶æ">ãå¤§æ°æ® &amp; AIãFlink Agents æºç è§£è¯» --- (2) ---  æ ¸å¿æ¶æ</h1>
<p></p><div class="toc"><div class="toc-container-header">ç®å½</div><ul><li><a href="#å¤§æ°æ®--aiflink-agents-æºç è§£è¯»-----2------æ ¸å¿æ¶æ" rel="noopener nofollow">ãå¤§æ°æ® &amp; AIãFlink Agents æºç è§£è¯» --- (2) ---  æ ¸å¿æ¶æ</a><ul><li><a href="#0x00-æè¦" rel="noopener nofollow">0x00 æè¦</a></li><li><a href="#0x01-flink-agentsä¸»è¦ç»ä»¶" rel="noopener nofollow">0x01 Flink Agentsä¸»è¦ç»ä»¶</a><ul><li><a href="#11-ä¸»è¦ç»ä»¶" rel="noopener nofollow">1.1 ä¸»è¦ç»ä»¶</a></li><li><a href="#12-åé¨æååéæ å°å³ç³»" rel="noopener nofollow">1.2 åé¨æååéæ å°å³ç³»</a><ul><li><a href="#121-agent-å°-agentplan" rel="noopener nofollow">1.2.1 Agent å° AgentPlan</a></li><li><a href="#122-agentplan-å°-actionexecutionoperator" rel="noopener nofollow">1.2.2 AgentPlan å° ActionExecutionOperator</a><ul><li><a href="#è¯¦ç»æ å°åæ" rel="noopener nofollow">è¯¦ç»æ å°åæ</a><ul><li><a href="#å¨ä½æ§è¡æ å°" rel="noopener nofollow">å¨ä½æ§è¡æ å°</a></li><li><a href="#èµæºç®¡çæ å°" rel="noopener nofollow">èµæºç®¡çæ å°</a></li><li><a href="#éç½®æ å°" rel="noopener nofollow">éç½®æ å°</a></li><li><a href="#ç¶æç®¡çæ å°" rel="noopener nofollow">ç¶æç®¡çæ å°</a></li></ul></li></ul></li></ul></li><li><a href="#13-æ§è¡æµç¨" rel="noopener nofollow">1.3 æ§è¡æµç¨</a></li></ul></li><li><a href="#0x02-ä¸åçflinkæ¯å¯¹" rel="noopener nofollow">0x02 ä¸åçFlinkæ¯å¯¹</a><ul><li><a href="#21-æ ¸å¿" rel="noopener nofollow">2.1 æ ¸å¿</a></li><li><a href="#22-å·ä½æ¯å¯¹" rel="noopener nofollow">2.2 å·ä½æ¯å¯¹</a><ul><li><a href="#221-agent" rel="noopener nofollow">2.2.1 Agent</a></li><li><a href="#222-agentplan" rel="noopener nofollow">2.2.2 AgentPlan</a></li><li><a href="#223-actionexecutionoperator" rel="noopener nofollow">2.2.3 ActionExecutionOperator</a></li><li><a href="#223-actiontask" rel="noopener nofollow">2.2.3 ActionTask</a></li></ul></li></ul></li><li><a href="#0x03-å®ä¾æè§£" rel="noopener nofollow">0x03 å®ä¾æè§£</a><ul><li><a href="#31-ç¬¬ä¸å±çº§agent--é¤åèååè§åæåblueprint" rel="noopener nofollow">3.1 ç¬¬ä¸å±çº§ï¼Agent â é¤åèååè§åæåï¼Blueprintï¼</a></li><li><a href="#32-ç¬¬äºå±çº§agentplan--é¤åçè¯¦ç»æä½æµç¨å¾compiled-planè®¡åç¼è¯å±" rel="noopener nofollow">3.2 ç¬¬äºå±çº§ï¼AgentPlan â é¤åçè¯¦ç»æä½æµç¨å¾ï¼Compiled Plan,è®¡åç¼è¯å±ï¼</a><ul><li><a href="#ç»æåè§£æ" rel="noopener nofollow">ç»æåè§£æ</a></li><li><a href="#å¹³å°ééæ§" rel="noopener nofollow">å¹³å°ééæ§</a></li></ul></li><li><a href="#33-ç¬¬ä¸å±çº§actionexecutionoperator--é¤åçæ§è¡ç®¡çå±runtime-executoræ§è¡å¼æå±" rel="noopener nofollow">3.3 ç¬¬ä¸å±çº§ï¼ActionExecutionOperator â é¤åçæ§è¡ç®¡çå±ï¼Runtime Executorï¼æ§è¡å¼æå±ï¼</a></li><li><a href="#34-ç¬¬åå±çº§actiontask--å·ä½çæå¡æ­¥éª¤execution-unit" rel="noopener nofollow">3.4 ç¬¬åå±çº§ï¼ActionTask â å·ä½çæå¡æ­¥éª¤ï¼Execution Unitï¼</a></li><li><a href="#35-å·¥ä½æµç¨ä¸¾ä¾" rel="noopener nofollow">3.5 å·¥ä½æµç¨ä¸¾ä¾</a></li></ul></li><li><a href="#0x04-å¹¶åæ§åå¹¶è¡æ§" rel="noopener nofollow">0x04 å¹¶åæ§åå¹¶è¡æ§</a><ul><li><a href="#41-flinkåçå¹¶åæ¨¡å" rel="noopener nofollow">4.1 Flinkåçå¹¶åæ¨¡å</a></li><li><a href="#42-æ¯ä¸ªkeyçç¶æç®¡ç" rel="noopener nofollow">4.2 æ¯ä¸ªKeyçç¶æç®¡ç</a></li><li><a href="#43-é®ç®±çº¿ç¨æ¨¡å" rel="noopener nofollow">4.3 é®ç®±çº¿ç¨æ¨¡å</a></li><li><a href="#44-å¼æ­¥ä»»å¡å¤ç" rel="noopener nofollow">4.4 å¼æ­¥ä»»å¡å¤ç</a></li><li><a href="#45-åå­ä¸è´æ§" rel="noopener nofollow">4.5 åå­ä¸è´æ§</a></li><li><a href="#46-æ°´å°åäºä»¶æ¶é´å¤ç" rel="noopener nofollow">4.6 æ°´å°åäºä»¶æ¶é´å¤ç</a></li><li><a href="#47-æ£æ¥ç¹åæ¢å¤" rel="noopener nofollow">4.7 æ£æ¥ç¹åæ¢å¤</a></li><li><a href="#48-æ»ç»" rel="noopener nofollow">4.8 æ»ç»</a></li></ul></li><li><a href="#0xff-åè" rel="noopener nofollow">0xFF åè</a></li></ul></li></ul></div><p></p>
<h2 id="0x00-æè¦">0x00 æè¦</h2>
<p>Flink Agents æ¡æ¶çæ ¸å¿æ¯ <strong>âäºä»¶é©±å¨ + ç¶æéç¦» + å¤è¯­è¨åä½â</strong>ï¼éè¿ Agent/AgentPlan å®ç°ä¸å¡é»è¾çå£°æå¼å®ä¹ï¼åå© Flink åççåå¸å¼ãé«å¹¶åè½åå®ç°å¯é æ§è¡ï¼åæ¶æ¯æ Python çæçå·¥å· / æ¨¡åéæï¼å¼é¡¾äºå¼åçµæ´»æ§ä¸è¿è¡æ¶æçï¼éç¨äºå¤æ AI ä»£çä»»å¡çåå¸å¼é¨ç½²ä¸æ§è¡ã</p>
<p>å·ä½èè¨ï¼Flink Agents çç»ä»¶æ¯å¯¹åç Flink ç»ä»¶å¨ âAgent ä¸å¡åºæ¯â ä¸çè¯­ä¹åå°è£ï¼èéå¨æ°åæãå æ­¤ï¼æ¬æå°åä»ç»Flink Agentsçåºæ¬ç»ä»¶ï¼ç¶åå°å¶ç»ä»¶ä¸Flink åçç»ä»¶åå¯¹æ¯ï¼æåç»åºä¸ä¸ªè¯¦ç»çä¾å­ï¼è¿æ ·è¯»èå¯ä»¥æ´å¥½ççè§£å¶è®¾è®¡ç²¾è¦ã</p>
<h2 id="0x01-flink-agentsä¸»è¦ç»ä»¶">0x01 Flink Agentsä¸»è¦ç»ä»¶</h2>
<p>å¯ä»¥æ Flink Agents çæ´ä¸ªæ§è¡æµç¨æ¯ä½ âåä¸éèâï¼æä»¬åæ­¤è¿è¡åæã</p>
<h3 id="11-ä¸»è¦ç»ä»¶">1.1 ä¸»è¦ç»ä»¶</h3>
<p>Flink Agents æ¯åºäºåç Flink åå¸å¼æµå¤çè½åå°è£çä¸å±æ¡æ¶ãå¶ä¸­åä¸ªä¸»è¦ç»ä»¶ä»£è¡¨äº Flink Agents æ¡æ¶ä¸­çåä¸ªå±æ¬¡ï¼</p>
<ul>
<li><strong>Agentï¼é¡¶å±è®¾è®¡ï¼å®ä¹äºâåä»ä¹âï¼</strong>ï¼ç¨æ·å®ä¹çæºè½å®ä½ï¼ç±»ä¼¼ âé¤åèå + è§åæåâï¼åå«ä¸å¡é»è¾ãå¨ä½ï¼Actionï¼åèµæºï¼å·¥å·ãæ¨¡åç­ï¼å®ä¹ï¼æç¡® âåä»ä¹âã</li>
<li><strong>AgentPlanï¼ä¸­é´ç¼è¯å±ï¼ç¡®å®äºâæä¹åâï¼</strong>ï¼å° Agent ç¼è¯åçå¯æ§è¡è®¡åï¼ç±»ä¼¼ âè¯¦ç»æä½æµç¨å¾âï¼æç¡®å¨ä½è§¦åè§åãèµæºæ å°å³ç³»ï¼ç¡®å® âæä¹åâã</li>
<li><strong>ActionExecutionOperatorï¼è¿è¡æ¶æ§è¡å±ï¼æ¯æ§è¡ç¯å¢ï¼è´è´£âåè°è°åº¦âï¼</strong>ï¼Flink éç¾¤ä¸­çæ§è¡æ ¸å¿ï¼å¨ Flink æµå¤çç¯å¢ä¸­å®éæ§è¡æä½ï¼ç±»ä¼¼ âé¤åé¦å¸­å¤§å¨âï¼è´è´£æ¥æ¶æ°æ®ãè°åº¦ä»»å¡ãç®¡çç¶æï¼åè°æ´ä½æ§è¡æµç¨ã</li>
<li><strong>ActionTaskï¼æå°æ§è¡ååï¼è´è´£âå·ä½å®æ½âï¼</strong>ï¼å·ä½çæ§è¡ä»»å¡ï¼ç±»ä¼¼ âåå·¥çåä¸ªæå¡æ­¥éª¤âï¼åä¸º JavaActionTask å PythonActionTaskï¼å¤çåä¸ªäºä»¶å¹¶è¿åç»æã</li>
</ul>
<p>å·ä½å¯ä»¥åè§ä¸å¾ã</p>
<pre><code class="language-python">[Agent] èåæå
    âï¼ç¼è¯ï¼
[AgentPlan] è¯¦ç»æµç¨å¾
    âï¼è¿è¡æ¶å®ä¾åï¼
[ActionExecutionOperator] é¤åé¦å¸­å¤§å¨
    âï¼åéä»»å¡ï¼
[ActionTask] åå·¥å·ä½ä»»å¡
</code></pre>
<p>è¿æ ·çè®¾è®¡ä½¿å¾ç³»ç»æ¢çµæ´»åé«æï¼è½å¤å¤çå¤æçAIä»£çä»»å¡ï¼åæ¶ä¿è¯äºè¯å¥½çæ©å±æ§åç»´æ¤æ§ã</p>
<h3 id="12-åé¨æååéæ å°å³ç³»">1.2 åé¨æååéæ å°å³ç³»</h3>
<p>AgentãAgentPlan å ActionExecutionOperator ä¹é´çå³ç³»ä»¥åå®ä»¬åé¨æååéçæ å°å³ç³»å¦ä¸ã</p>
<h4 id="121-agent-å°-agentplan">1.2.1 Agent å° AgentPlan</h4>
<p>Agent å° AgentPlan çæ å°å¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>Agent æå</th>
<th>AgentPlan å¯¹åºæå</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>_actionsï¼è£é¥°å¨å®ä¹ï¼</td>
<td>actions, actions_by_event</td>
<td>Agent ä¸­éè¿ @action è£é¥°å¨å®ä¹çå¨ä½è¢«ç¼è¯å° AgentPlan çå¨ä½æ å°ä¸­</td>
</tr>
<tr>
<td>_actionsï¼add_action æ·»å ï¼</td>
<td>actions, actions_by_event</td>
<td>éè¿ add_action æ¹æ³æ·»å çå¨ä½åæ ·ç¼è¯å°å¨ä½æ å°ä¸­</td>
</tr>
<tr>
<td>_resources</td>
<td>resource_providers</td>
<td>Agent ä¸­æ³¨åçèµæºè¢«è½¬æ¢ä¸ºèµæºæä¾è</td>
</tr>
</tbody>
</table>
<h4 id="122-agentplan-å°-actionexecutionoperator">1.2.2 AgentPlan å° ActionExecutionOperator</h4>
<p>AgentPlan å° ActionExecutionOperator çæ å°å¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>AgentPlan æå</th>
<th>ActionExecutionOperator å¯¹åºæå</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>actions</td>
<td>éè¿ getActionsTriggeredBy() æ¹æ³è°ç¨</td>
<td>Operator æ ¹æ®äºä»¶ç±»åæ¥æ¾å¯¹åºçå¨ä½</td>
</tr>
<tr>
<td>resource_providers</td>
<td>å¨ RunnerContextImpl ä¸­ä½¿ç¨</td>
<td>æä¾è¿è¡æ¶æéçèµæº</td>
</tr>
<tr>
<td>config</td>
<td>metricGroup, builtInMetrics ç­</td>
<td>ç¨äºéç½®ææ åå¶ä»è¿è¡æ¶è¡ä¸º</td>
</tr>
</tbody>
</table>
<h5 id="è¯¦ç»æ å°åæ">è¯¦ç»æ å°åæ</h5>
<h6 id="å¨ä½æ§è¡æ å°">å¨ä½æ§è¡æ å°</h6>
<p>å¨ <code>ActionExecutionOperator</code> ä¸­ï¼</p>
<pre><code class="language-java">// æ ¹æ®äºä»¶ç±»åè·åè§¦åçå¨ä½
private List&lt;Action&gt; getActionsTriggeredBy(Event event) {
    if (event instanceof PythonEvent) {
        return agentPlan.getActionsTriggeredBy(((PythonEvent) event).getEventType());
    } else {
        return agentPlan.getActionsTriggeredBy(event.getClass().getName());
    }
}

// åå»º ActionTask æ¥æ§è¡å¨ä½
private ActionTask createActionTask(Object key, Action action, Event event) {
    if (action.getExec() instanceof JavaFunction) {
        return new JavaActionTask(
            key, event, action, getRuntimeContext().getUserCodeClassLoader());
    } else if (action.getExec() instanceof PythonFunction) {
        return new PythonActionTask(key, event, action);
    }
    // ..
}
</code></pre>
<h6 id="èµæºç®¡çæ å°">èµæºç®¡çæ å°</h6>
<p><code>AgentPlan</code> ä¸­çèµæºæä¾èå¨ <code>ActionExecutionOperator</code> ä¸­éè¿ <code>RunnerContextImpl</code> è®¿é®ï¼</p>
<pre><code class="language-java">// å¨ RunnerContextImpl ä¸­
public Resource getResource(String name, ResourceType type) {
    return agentPlan.getResource(name, type);
}
</code></pre>
<h6 id="éç½®æ å°">éç½®æ å°</h6>
<p>AgentPlan ä¸­çéç½®ä¿¡æ¯è¢«ç¨äºåå§åActionExecutionOperatorçåç§è¿è¡æ¶ç»ä»¶ï¼</p>
<pre><code class="language-java">// å¨ ActionExecutionOperator.open() ä¸­
metricGroup = new FlinkAgentsMetricGroupImpl(getMetricGroup());
builtInMetrics = new BuiltInMetrics(metricGroup, agentPlan);

// ActionStateStore åå§åä¹ä¾èµäºéç½®
if (actionStateStore == null &amp;&amp; KAFKA.getType().equalsIgnoreCase(agentPlan.getConfig().get(ACTION_STATE_STORE_BACKEND))) {
    actionStateStore = new KafkaActionStateStore(agentPlan.getConfig());
}
</code></pre>
<h6 id="ç¶æç®¡çæ å°">ç¶æç®¡çæ å°</h6>
<p>ActionExecutionOperator ä¸­çåç§ç¶æä¸ AgentPlan çæ§è¡éæ±ç¸å¯¹åºï¼</p>
<pre><code class="language-java">// ç­æåå­ç¶æç¨äºå¨ä½é´çæ°æ®å±äº«
private transient MapState&lt;String, MemoryObjectImpl.MemoryItem&gt; shortTermMemState;

// å¨ä½ä»»å¡ç¶æç¨äºå¼æ­¥æ§è¡ç®¡ç
private transient ListState&lt;ActionTask&gt; actionTasksState;

// å¾å¤çäºä»¶ç¶æç¨äºæµæ§
private transient ListState&lt;Event&gt; pendingInputEventsState;
</code></pre>
<h3 id="13-æ§è¡æµç¨">1.3 æ§è¡æµç¨</h3>
<p>å·ä½æµç¨å¦ä¸ï¼</p>
<pre><code class="language-python">Action Code â Agent â AgentPlan â ActionExecutionOperator â ActionTask â Flink Runtime
</code></pre>
<p>ä»¥ ReActAgent ä¸ºä¾ï¼å¶æµç¨å¦ä¸ï¼</p>
<ul>
<li>
<p>ç¨æ·å®ä¹ ReActAgentï¼åå« <code>start_action</code> å <code>stop_action</code></p>
</li>
<li>
<p>éè¿ <code>AgentPlan.from_agent()</code> ç¼è¯æè®¡åï¼</p>
<ul>
<li>
<p><code>actions</code>ï¼åå« <code>start_action</code> å <code>stop_action</code></p>
</li>
<li>
<p><code>actions_by_event</code>ï¼æ å° <code>InputEvent</code> â <code>start_action</code>ï¼<code>ChatResponseEvent</code> â <code>stop_action</code></p>
</li>
</ul>
</li>
<li>
<p>å¨è¿è¡ç¯å¢ä¸­ï¼AgentPlan è¢«ä¼ éç» ActionExecutionOperatorFactoryãActionExecutionOperatorFactory åå»º ActionExecutionOperator å®ä¾ã</p>
</li>
<li>
<p>ActionExecutionOperator å¨è¿è¡æ¶æ ¹æ® AgentPlan æ§è¡å·ä½æä½ãå¨ ActionExecutionOperator ä¸­ï¼</p>
<ul>
<li>æ¥æ¶å° InputEvent åï¼æ¥æ¾å¹¶æ§è¡ start_action</li>
<li>start_action åé ChatRequestEvent</li>
<li>æ¥æ¾å¹¶æ§è¡å¤ç ChatRequestEvent çåç½®å¨ä½ï¼å¦ CHAT_MODEL_ACTIONï¼</li>
<li>PythonActionTask æ§è¡å·¥å·å½æ°ï¼è¥ä¸ºçæå¨ååå»º PythonGeneratorActionTask æç»­æ§è¡ï¼</li>
<li>å·¥å·æ§è¡å®æçæ ChatResponseEvent</li>
<li>æ¥æ¾å¹¶æ§è¡ stop_action</li>
<li>stop_action äº§ç OutputEvent å¹¶åéå°ä¸æ¸¸</li>
</ul>
</li>
</ul>
<p>è¿ç§è®¾è®¡å®ç°äºå³æ³¨ç¹åç¦»ï¼ç¨æ·åªéå³æ³¨ä¸å¡é»è¾å®ä¹ï¼æ¡æ¶è´è´£å°å¶ç¼è¯ä¸ºé«æçè¿è¡æ¶æ§è¡è®¡åã</p>
<h2 id="0x02-ä¸åçflinkæ¯å¯¹">0x02 ä¸åçFlinkæ¯å¯¹</h2>
<p>Flink Agents æ¯åç Flink ç âé¢åå°è£âï¼ææç»ä»¶é½è½æ å°å°åç Flink æ ¸å¿ç»ä»¶ï¼æªè±ç¦» Flink æµå¤ççæ ¸å¿æ¶æãæä»¬æ¥ä¸æ¥çç Flink Agents éç AgentãAgentPlanãActionExecutionOperatorãActionTask è¿äºæ ¸å¿ç»ä»¶ï¼åå«å¯¹åºåç Flink ä¸­çåªäºæ ¸å¿ç»ä»¶ï¼ä»¥åå®ä»¬çç¸ä¼¼æ§é»è¾ã</p>
<h3 id="21-æ ¸å¿">2.1 æ ¸å¿</h3>
<p>æä»¬åç¨ä¸å¼ è¡¨æ¥æ¦æ¬æ¯å¯¹å³ç³»ã</p>
<table>
<thead>
<tr>
<th>Flink Agents ç»ä»¶</th>
<th>åç Flink å¯¹åºç»ä»¶</th>
<th>æ ¸å¿è§è²</th>
</tr>
</thead>
<tbody>
<tr>
<td>Agent</td>
<td>StreamGraph / ç¨æ· DataStream ä»£ç </td>
<td>é«å±ä¸å¡é»è¾å£°æï¼åä»ä¹ï¼</td>
</tr>
<tr>
<td>AgentPlan</td>
<td>JobGraph</td>
<td>ç¼è¯åçå¯æ§è¡è®¡åï¼æä¹æï¼</td>
</tr>
<tr>
<td>ActionExecutionOperator</td>
<td>KeyedProcessOperator/StreamOperator</td>
<td>è¿è¡æ¶æ ¸å¿æ§è¡ç®å­ï¼æ ¸å¿è½½ä½ï¼</td>
</tr>
<tr>
<td>ActionTask</td>
<td>ç®å­åå¤çåå / AsyncFunction ä»»å¡</td>
<td>åå­æ§è¡ä»»å¡ï¼æå°æ§è¡ååï¼</td>
</tr>
</tbody>
</table>
<p>æ ¸å¿æ å°é»è¾å¦ä¸ï¼ãå£°æå±ï¼Agentï¼â ç¼è¯å±ï¼AgentPlanï¼â æ§è¡ç®å­ï¼ActionExecutionOperatorï¼â åå­ä»»å¡ï¼ActionTaskï¼ãå¯¹åºåç Flink çãStreamGraph â JobGraph â StreamOperator â ç®å­åå¤çååãï¼</p>
<p>åå° âåä¸éèâ ï¼æä»¬è¿è¡åæå¯¹æ¯ã</p>
<ul>
<li>Agent = ä½ åç âèè°±é»è¾âï¼æ¯å¦ âåçªèçèï¼åçèåççªèâï¼â å¯¹åº Flink StreamGraphï¼çº¯é»è¾ï¼ï¼</li>
<li>AgentPlan = é¤ååå¨æèè°±è½¬æ¢æç âå¯æ§è¡å·¥åâï¼æç¡® âè°æ¥çãç¨åªä¸ªéãæ¾å¤å°çâï¼â å¯¹åº  Flink JobGraphï¼å¯æ§è¡è®¡åï¼ï¼</li>
<li>ActionExecutionOperator = æåºå¨å¸ï¼æ§è¡å·¥åï¼â å¯¹åº Flink  StreamOperatorï¼</li>
<li>ActionTask = å¨å¸ç âåä¸ªç¿»çå¨ä½ââ å¯¹åº Flink ç®å­åçåå­å¤çä»»å¡ï¼</li>
<li>Flink ExecutionGraph = å¨å¸å®éç«å¨åªä¸ªç¶å°ãç¨åªå¥å¨å· â ç©çæ§è¡å±ï¼å AgentPlan æ å³ã</li>
</ul>
<h3 id="22-å·ä½æ¯å¯¹">2.2 å·ä½æ¯å¯¹</h3>
<h4 id="221-agent">2.2.1 Agent</h4>
<ul>
<li><strong>ç¸ä¼¼ç»ä»¶</strong>ï¼Flink Job çä¸å¡é»è¾å®ä¹ï¼å¦ DataStream ç®å­é¾ï¼ãStreamGraphï¼æµå¼ä½ä¸çé»è¾ææï¼</li>
<li><strong>ç¸ä¼¼æ§æ ¸å¿</strong>ï¼Agent æ¯ç¨æ·å®ä¹ç âæºè½å®ä½âï¼åå«ä¸å¡é»è¾ãå¨ä½ãèµæºï¼ï¼æ¬è´¨æ¯ä¸å¡å±é¢ç âä½ä¸é»è¾å£°æâï¼è¿ååç Flink ä¸­ç¨æ·ç¼åç DataStream ä»£ç ï¼å®ä¹ âæ°æ®æä¹å¤çâï¼ãStreamGraphï¼æè¿°é»è¾ææï¼çè§è²å®å¨ä¸è´ ââ é½æ¯ âåè¯ç³»ç»è¦åä»ä¹â çé¡¶å±é»è¾å®ä¹ï¼ä¸æ¶åå·ä½æ§è¡ã</li>
<li><strong>å·®å¼</strong>ï¼Agent æ´èç¦ âAgent è¡ä¸º / å·¥å·è°ç¨â çè¯­ä¹ï¼èåç StreamGraph æ¯éç¨çæ°æ®æµææã</li>
</ul>
<h4 id="222-agentplan">2.2.2 AgentPlan</h4>
<ul>
<li><strong>ç¸ä¼¼ç»ä»¶</strong>ï¼Flink ç JobGraphï¼StreamGraph ç¼è¯åçå¯æ§è¡ææï¼</li>
<li><strong>ç¸ä¼¼æ§æ ¸å¿</strong>ï¼AgentPlan æ¯ Agent ç¼è¯åç âå¯æ§è¡è®¡åâï¼æç¡®å¨ä½è§¦åè§åãèµæºæ å°ï¼ï¼æ¬è´¨æ¯å°é«å±ä¸å¡é»è¾è½¬æ¢ä¸ºç³»ç»å¯è¯å«çæ§è¡è®¡åï¼è¿ååç Flink ä¸­ StreamGraph ç¼è¯ä¸º JobGraph çè¿ç¨ä¸è´ ââJobGraph æç¨æ·çé»è¾ææè½¬æ¢ä¸ºåå«å¹¶è¡åº¦ãç®å­é¾ãä¸­é´ç»æä¼ éçå¯æ§è¡ææï¼AgentPlan åæ Agent ç âè¡ä¸ºè§åâ è½¬æ¢ä¸ºç³»ç»å¯è°åº¦ç âå¨ä½æ§è¡è§åâã</li>
<li><strong>å³é®å±æ§</strong>ï¼é½æ¯ âç¼è¯å±â äº§ç©ï¼è¿æ¥é«å±å®ä¹ä¸åºå±æ§è¡ã</li>
</ul>
<h4 id="223-actionexecutionoperator">2.2.3 ActionExecutionOperator</h4>
<ul>
<li>
<p><strong>ç¸ä¼¼ç»ä»¶</strong>ï¼Flink æ ¸å¿ç StreamOperatorï¼å¦ ProcessOperatorãFlatMapOperatorï¼ãKeyedProcessOperator</p>
</li>
<li>
<p><strong>ç¸ä¼¼æ§æ ¸å¿</strong>ï¼ActionExecutionOperator æ¯ Flink éç¾¤ä¸­æ§è¡ Agent é»è¾çæ ¸å¿ç®å­ï¼æ¬è´¨æ¯è¿è¡æ¶çæ ¸å¿æ§è¡ååï¼è¿ååç Flink ç StreamOperator å®å¨å¯¹åº ââStreamOperator æ¯å¤çæ°æ®æµçæ ¸å¿è½½ä½ï¼å¦ ProcessOperator å¤ç KeyedStreamãå®ç°ç¶æç®¡çï¼ï¼ActionExecutionOperator å°±æ¯éå¯¹ âAgent å¨ä½æ§è¡â åºæ¯å®å¶ç StreamOperatorï¼</p>
<ul>
<li>é½è¿è¡å¨ TaskManager ä¸­ï¼å¤çæµæ°æ®ï¼Eventï¼ï¼</li>
<li>é½æ¯æé®æ§ç¶æï¼Keyed Stateï¼ï¼æ key éç¦»æ§è¡ä¸ä¸æï¼</li>
<li>é½ä¾èµ Mailbox æºå¶è°åº¦ä»»å¡ï¼é¿åé»å¡ï¼</li>
<li>é½è´è´£ç¶æç®¡çãäºä»¶å¤çãç»æè¾åºã</li>
</ul>
</li>
<li>
<p><strong>å¸åå¯¹åº</strong>ï¼ActionExecutionOperator ææ¥è¿åçç <code>KeyedProcessOperator</code>ï¼é®æ§å¤çãç¶æç®¡çãå¼æ­¥ä»»å¡è°åº¦ï¼ã</p>
</li>
</ul>
<h4 id="223-actiontask">2.2.3 ActionTask</h4>
<ul>
<li>
<p><strong>ç¸ä¼¼ç»ä»¶</strong>ï¼Flink çãç®å­åçå¤çä»»å¡ãï¼å¦ ProcessFunction ä¸­çåä¸ªåç´ å¤çé»è¾ï¼ãAsync I/O ä¸­ç <code>AsyncFunction</code> ä»»å¡</p>
</li>
<li>
<p><strong>ç¸ä¼¼æ§æ ¸å¿</strong>ï¼ActionTask æ¯ âæå°æ§è¡ååâï¼å¦åä¸ª Python/Java å¨ä½æ§è¡ï¼ï¼æ¬è´¨æ¯ç®å­åçåå­å¤çä»»å¡ï¼è¿ååç Flink ä¸­ï¼</p>
<ul>
<li>ProcessOperator å¤çåä¸ª StreamElementï¼å¦ä¸æ¡æ°æ®ï¼çé»è¾ååï¼</li>
<li>Async I/O ä¸­ AsyncFunction å°è£çå¼æ­¥ä»»å¡ï¼å¦å¼æ­¥æ¥è¯¢æ°æ®åºï¼ï¼</li>
</ul>
<p>è§è²å®å¨ä¸è´ ââ é½æ¯ âç®å­åçæå°å¯æ§è¡ä»»å¡âï¼æ§è¡å®æåè¿åç»æï¼æ¯æå¼æ­¥ / åé¶æ®µæ§è¡ã</p>
</li>
<li>
<p><strong>å³é®å±æ§</strong>ï¼</p>
<ul>
<li>é½æ¯ âåå­æ§è¡ååâï¼ä¸å¯åæåï¼</li>
<li>æ¯æå¼æ­¥æ§è¡ï¼å¦ PythonActionTask å¯¹åº Async I/Oï¼ï¼</li>
<li>æ§è¡ç»æå¯è§¦ååç»­ä»»å¡ï¼å¦ ActionTaskResult çææ°ä»»å¡ï¼å¯¹åº Async I/O åè°è§¦ååç»­å¤çï¼ã</li>
</ul>
</li>
<li>
<p><strong>ç»åå¯¹åº</strong>ï¼</p>
<ul>
<li>JavaActionTask â åçåæ­¥å¤çä»»å¡ï¼å¦ ProcessFunction ä¸­çåæ­¥é»è¾ï¼ï¼</li>
<li>PythonActionTask â åç Async I/O ä»»å¡ï¼å¼æ­¥è°ç¨å¤é¨æå¡ / èæ¬ï¼ã</li>
</ul>
</li>
</ul>
<h2 id="0x03-å®ä¾æè§£">0x03 å®ä¾æè§£</h2>
<p>æä»¬æ¥è¿ä¸æ­¥è§£é Flink Agents è¿å ä¸ªæ ¸å¿æ¦å¿µçå³ç³»åéåãä¸ºäºæ´å¥½çè¯´æï¼æä»¬å¯ä»¥ææ´ä¸ªFlink Agentsç³»ç»ä»âåä¸éèâæå±å°âä¸ä¸ªæºè½é¤åèªå¨åæå¡ç³»ç»âãåæ¶ï¼ç»åå®ä¾ä¹æ·±å¥ä¸ææ¯ç»èã</p>
<h3 id="31-ç¬¬ä¸å±çº§agent--é¤åèååè§åæåblueprint">3.1 ç¬¬ä¸å±çº§ï¼Agent â é¤åèååè§åæåï¼Blueprintï¼</h3>
<p>Flink Agents ä¸­ç Agent æ¯ç¨æ·å®ä¹çæºè½å®ä½ï¼è´è´£åè°åç§èµæºåè¡ä¸ºæ¥å®æç¹å®çä»»å¡ãæä»¬æ Agent æ³è±¡æé¤åçèååè¿è¥æåï¼</p>
<ul>
<li>
<p>å®ä¹äºé¤åè½æä¾åªäºèååæå¡ï¼å¨ä½ï¼</p>
</li>
<li>
<p>è§å®äºéè¦ç¨å°åªäºè®¾å¤åé£æï¼èµæºï¼ï¼å¦åä¸ºæ°åå·¥éå¤å·¥å·ç®±ï¼å¯¹åºç¨åºåå®éç¨å°çï¼å¯ä»¥æ¯ï¼</p>
<ul>
<li>åç§ API æ¥å£ï¼ç¸å½äºå·¥å·ï¼</li>
<li>æ°æ®åºè®¿é®æéï¼ç¸å½äºåèèµæï¼</li>
<li>å³ç­é»è¾ä»£ç ï¼ç¸å½äºå¹è®­ææï¼</li>
</ul>
</li>
<li>
<p>éå°ä»ä¹æåµåºè¯¥åä»ä¹ï¼å¯¹åºäºä»¶çå¬ï¼</p>
</li>
<li>
<p>æè¿°äºé¡¾å®¢ç¹é¤å°ä¸èçå®æ´æµç¨</p>
<ul>
<li>æä¸ä¸ª start_actionï¼æ¥å¾åï¼è´è´£æ¥æ¶é¡¾å®¢é®é¢</li>
<li>æä¸ä¸ª stop_actionï¼æ¶é¶åï¼è´è´£æç»ç»è´¦è¾åºç»æ</li>
</ul>
</li>
</ul>
<p>è¿äºé½è¢«å°è£å¨ Agent å¯¹è±¡ä¸­ã</p>
<h3 id="32-ç¬¬äºå±çº§agentplan--é¤åçè¯¦ç»æä½æµç¨å¾compiled-planè®¡åç¼è¯å±">3.2 ç¬¬äºå±çº§ï¼AgentPlan â é¤åçè¯¦ç»æä½æµç¨å¾ï¼Compiled Plan,è®¡åç¼è¯å±ï¼</h3>
<p>Flink Agentæ¡æ¶ä¼æç¨æ·ç Agent è½¬æ¢ä¸ºä¸ä¸ªæ´éç¨ãæ´éåç³»ç»å¤ççå½¢å¼ ââ AgentPlanãå¨æ¬ä¾ä¸­ï¼AgentPlan ç¸å½äºå°é¤åè¿è¥æåç¼è¯æçè¯¦ç»å·¥ä½æµç¨å¾ï¼æ½è±¡åçå·¥ä½èå¾ï¼ï¼</p>
<ul>
<li>æèåä¸çæ¯éèåè§£æå·ä½çæ­¥éª¤</li>
<li>æç¡®æ¯ä¸ªå²ä½ï¼å¨ä½ï¼å¨ä»ä¹æåµä¸è¢«è§¦åï¼å³éå°å¥äºä»¶ï¼Eventï¼è¯¥å¹²å¥æ´»ï¼Actionï¼</li>
<li>åå¤å¥½ææéè¦çå·¥å·åæææ¸åï¼Resourceï¼</li>
</ul>
<p>å°±åé¤åç»çä¼å¶å®è¯¦ç»çæä½æåï¼åè¯æå¡åä»ä¹æ¶åè¯¥åä»ä¹äºã</p>
<h4 id="ç»æåè§£æ">ç»æåè§£æ</h4>
<p>AgentPlan åå«å ä¸ªå³é®é¨åï¼</p>
<p><strong>Actions æ å°è¡¨</strong></p>
<ul>
<li>æç¡®ååºææå¯ä»¥æ§è¡çå¨ä½åå¶è§¦åæ¡ä»¶</li>
<li>ä¾å¦ï¼âæ¶å°è®¢åæ¥è¯¢è¯·æ±â â âæ§è¡è®¢åæ¥è¯¢å¨ä½â</li>
</ul>
<p><strong>èµæºæä¾èç®å½</strong></p>
<ul>
<li>è®°å½ææå¯ç¨èµæºçä½ç½®åè·åæ¹å¼</li>
<li>ç±»ä¼¼äºå·¥åéåä¸ªä¾åºé¨é¨çèç³»æ¹å¼æ¸å</li>
</ul>
<p><strong>éç½®åæ°é</strong></p>
<ul>
<li>å­å¨è¿è¡æéçåé¡¹è®¾ç½®éé¡¹</li>
<li>åæ¯è®¾å¤æä½è§ç¨åææ¯è§è</li>
</ul>
<h4 id="å¹³å°ééæ§">å¹³å°ééæ§</h4>
<p>éè¿è¿ç§æ½è±¡åï¼æ è®ºåºå±æ¯ Java è¿æ¯ Python å®ç°ï¼é½å¯ä»¥ç»ä¸ç¨åä¸ä»½ AgentPlan æ¥è¿è¡è°åº¦ç®¡çã</p>
<h3 id="33-ç¬¬ä¸å±çº§actionexecutionoperator--é¤åçæ§è¡ç®¡çå±runtime-executoræ§è¡å¼æå±">3.3 ç¬¬ä¸å±çº§ï¼ActionExecutionOperator â é¤åçæ§è¡ç®¡çå±ï¼Runtime Executorï¼æ§è¡å¼æå±ï¼</h3>
<p>å¨å¤§è§æ¨¡çäº§ç¯å¢ä¸­ï¼ä¸è½åªé ä¸ä¸ªç®¡å®¶å¹²æ´»ï¼èæ¯éè¦ä¸æ¡èªå¨åæµæ°´çº¿ãActionExecutionOperator å°±åæ¯ä¸æ¡æºè½åçå·¥åè£éçº¿ï¼å®æç§æä½æåï¼AgentPlanï¼ç»ç»å¤ä¸ªå·¥ä½ç«æ¥ååå®æä»»å¡ãæèè¯´ï¼ActionExecutionOperator æ¯é¤åçç°åºæ§è¡ç®¡çå±ï¼æ¯æ´ä¸ªç³»ç»çâå¤§è + ä¸­æ¢æ§å¶å®¤âï¼</p>
<ul>
<li>è´è´£æ¥å¾è¿åºçé¡¾å®¢ï¼æ¥æ¶æ°æ®ï¼</li>
<li>æ ¹æ®æµç¨å¾åéä»»å¡ç»ä¸åçåå·¥ï¼æ§è¡å¨ä½ï¼</li>
<li>åè°åä¸ªå²ä½ä¹é´çå·¥ä½ï¼çæ§è¿åº¦ç¶æ / ç®¡çç¶æååå­ï¼</li>
<li>ç¡®ä¿æå¡æµç¨é¡ºçï¼å¤çå¹¶ååå®¹éï¼</li>
<li>é¤åç»çæ¿çè¯¦ç»æµç¨å¾ï¼ææ¥åä¸ªåå·¥ååå·¥ä½ã</li>
</ul>
<h3 id="34-ç¬¬åå±çº§actiontask--å·ä½çæå¡æ­¥éª¤execution-unit">3.4 ç¬¬åå±çº§ï¼ActionTask â å·ä½çæå¡æ­¥éª¤ï¼Execution Unitï¼</h3>
<p>ActionTask å°±åæ¯åå·¥æ§è¡çå·ä½æå¡æ­¥éª¤ï¼æ¯çäº§çº¿ä¸çæå°å·¥ä½ï¼ä¸æ¬¡åªå¹²ä¸ä»¶å·ä½æ´»ï¼è°ç¨ Python å½æ°ãæ¥æ°æ®åºãå HTTPãå Kafka â¦ï¼ï¼</p>
<ul>
<li>æ¯ä¸ªæå¡åæ¥å°çä»»å¡å°±æ¯ä¸ä¸ª ActionTask</li>
<li>å¯è½æ¯ç®åä¸æ­¥å®æï¼æ®éæå¡åï¼</li>
<li>å¯è½æ¯éè¦å¤æ­¥å®æï¼éè¦åè®¿çææ¯åï¼ï¼å³å¦ææ´»å¤ªå¤ï¼å¼æ­¥ãé¿èæ¶ï¼ï¼æå¡åä¼æèªå·±ãååãææ°ä»»å¡ï¼ç­ä¸æ¬¡è½®è¯¢åæ¥çå¹²ï¼å®ç°éé»å¡çåä½å¼è°åº¦ã</li>
<li>å®æåæ¥åç»æï¼å¹¶å¯è½è§¦åä¸ä¸æ­¥å·¥ä½ï¼å³å¹²å®å°±è½ç«å³æç»æï¼Eventï¼æåä¼ éå¸¦ï¼ç»§ç»­ä¸ä¸è½®</li>
</ul>
<h3 id="35-å·¥ä½æµç¨ä¸¾ä¾">3.5 å·¥ä½æµç¨ä¸¾ä¾</h3>
<p>åè®¾é¡¾å®¢æ¥å°é¤åç¹äºä¸ä»½å¤æçå¥é¤ï¼</p>
<ul>
<li>é¡¾å®¢è¿åºï¼InputEventï¼
<ul>
<li>é¤åç»çï¼ActionExecutionOperatorï¼æ¥å¾é¡¾å®¢</li>
<li>æ ¹æ®æµç¨å¾ç¥éåºè¯¥è®©æ¥å¾åï¼start_actionï¼å¤ç</li>
</ul>
</li>
<li>æ¥å¾åå¤çï¼ActionTaskï¼
<ul>
<li>æ¥å¾åï¼PythonActionTaskï¼æ¥å°ä»»å¡</li>
<li>çè§£é¡¾å®¢éæ±ï¼çæå¨æ¿è®¢åï¼ChatRequestEventï¼</li>
</ul>
</li>
<li>å¨æ¿å¶ä½ï¼åç½®å¨ä½ï¼
<ul>
<li>å¨å¸ï¼CHAT_MODEL_ACTIONï¼æ¶å°è®¢åå¼å§å¶ä½</li>
<li>å¶ä½å®æåéç¥æå¡åï¼ChatResponseEventï¼</li>
</ul>
</li>
<li>æ¶é¶ç»è´¦ï¼ActionTaskï¼
<ul>
<li>æ¶é¶åï¼stop_actionï¼å¤çæç»ç»æ</li>
<li>é¡¾å®¢æåå¸¦èµ°ï¼OutputEventï¼</li>
</ul>
</li>
</ul>
<p>ãç¨æ·åªç®¡æç®¡å®¶è®­å¥½ï¼æ¡æ¶è´è´£æç®¡å®¶åææåï¼åææååæå¹¶è¡çäº§çº¿ï¼æåè®©æ æ°workeræ key éç¦»ãäºä»¶é©±å¨ãå¯æ£æ¥ç¹çæ¹å¼è·å¨ Flink ä¸ããã</p>
<h2 id="0x04-å¹¶åæ§åå¹¶è¡æ§">0x04 å¹¶åæ§åå¹¶è¡æ§</h2>
<p>Flink Agents ç³»ç»å¨è®¾è®¡æ¶å·²ç»ååèèäºå¹¶åæ§åå¹¶è¡æ§ï¼æ¯å¦ï¼</p>
<ul>
<li><strong>äºä»¶é©±å¨æ¨¡å</strong>ï¼åºäºäºä»¶æµè½¬è§¦åå¨ä½ï¼åå§ä¸º InputEventï¼ç»å¤è½®äºä»¶ï¼å¦ ChatRequestEventãChatResponseEventï¼è§¦åï¼æç»è¾åº OutputEventã</li>
<li><strong>å¹¶åä¸éç¦»è®¾è®¡</strong>ï¼å©ç¨ Flink é®æ§æµï¼KeyedStreamï¼å®ç°æ key ååºï¼æ¯ä¸ª key æ¥æç¬ç«ç¶æï¼éè¿é®ç®±çº¿ç¨æ¨¡åï¼MailboxExecutorï¼å®ç°åä½å¼å¤ä»»å¡ï¼é¿åé»å¡ã</li>
<li><strong>ä»»å¡ååæºå¶</strong>ï¼é¿æ¶é´è¿è¡çä»»å¡ï¼å¦ Python çæå¨ï¼ä¼è¢«ååä¸ºå¤ä¸ª ActionTaskï¼æ§è¡åéè¿ ActionTaskResult ä¼ éä¸ä¸ä¸ªä»»å¡ï¼ç¡®ä¿å¹¶åæçã</li>
<li><strong>æ¬å°ä¸è¿ç¨æ§è¡</strong>ï¼æ¬å°ç¨ LocalRunner æ¨¡ææ§è¡ï¼è¿ç¨åºäº Flink éç¾¤ç ActionExecutionOperator åå¸å¼æ§è¡ï¼ä¿æ API ä¸è´æ§ã</li>
</ul>
<p>ä»¥ä¸æ¯å·ä½å®ç°æ¹å¼ï¼</p>
<h3 id="41-flinkåçå¹¶åæ¨¡å">4.1 Flinkåçå¹¶åæ¨¡å</h3>
<p>ç³»ç»ååå©ç¨äºApache Flinkçåçå¹¶åæºå¶ï¼</p>
<ul>
<li>é®æ§æµï¼Keyed Streamsï¼ï¼ä½¿ç¨FlinkçKeyedStreamækeyå¯¹æ°æ®è¿è¡ååºï¼ç¡®ä¿ç¸åkeyçäºä»¶ç±åä¸ä¸ªå¹¶è¡å®ä¾å¤ç</li>
<li>å¹¶è¡æä½ç¬¦ï¼ActionExecutionOperatorå¯ä»¥å¨Flinkéç¾¤ä¸­çå¤ä¸ªå®ä¾ä¸å¹¶è¡è¿è¡</li>
</ul>
<pre><code class="language-java">// å¨CompileUtils.javaä¸­ - å°ä»£çè¿æ¥å°é®æ§æµ
public static &lt;IN, K&gt; DataStream&lt;Object&gt; connectToAgent(
    DataStream&lt;IN&gt; inputStream, KeySelector&lt;IN, K&gt; keySelector, AgentPlan agentPlan) {
    return connectToAgent(inputStream.keyBy(keySelector), agentPlan);
}
</code></pre>
<p>å¨ RemoteExecutionEnvironment ä¸­æï¼</p>
<pre><code class="language-java">@Override
public DataStream&lt;Object&gt; toDataStream() {
    if (agentPlan == null) {
        throw new IllegalStateException("Must apply agent before calling toDataStream");
    }

    if (outputDataStream == null) {
        if (keySelector != null) {
            outputDataStream =
                    CompileUtils.connectToAgent(inputDataStream, keySelector, agentPlan);
        } else {
            // If no key selector provided, use a simple pass-through key selector
            outputDataStream =
                    CompileUtils.connectToAgent(inputDataStream, x -&gt; x, agentPlan);
        }
    }

    return outputDataStream;
}
</code></pre>
<h3 id="42-æ¯ä¸ªkeyçç¶æç®¡ç">4.2 æ¯ä¸ªKeyçç¶æç®¡ç</h3>
<p>æ¯ä¸ªkeyé½ç»´æ¤ç¬ç«çç¶æéç¦»ï¼</p>
<pre><code class="language-java">// å¨ActionExecutionOperator.javaä¸­ - ç»´æ¤æ¯ä¸ªkeyçç¶æ
private transient ListState&lt;ActionTask&gt; actionTasksKState;
private transient ListState&lt;Event&gt; pendingInputEventsKState;
private transient ValueState&lt;Long&gt; sequenceNumberKState;
</code></pre>
<p>è¿äºé½æ¯é®æ§ç¶æï¼keyed stateï¼ï¼æå³çæ¯ä¸ªkeyé½æèªå·±çç¬ç«ç¶æå®ä¾ï¼é²æ­¢ä¸åkeyä¹é´çç«äºæ¡ä»¶ã</p>
<h3 id="43-é®ç®±çº¿ç¨æ¨¡å">4.3 é®ç®±çº¿ç¨æ¨¡å</h3>
<p>ç³»ç»ä½¿ç¨Flinkçé®ç®±çº¿ç¨æ¨¡åå®ç°åä½å¼å¤ä»»å¡å¤çï¼</p>
<pre><code class="language-java">// å¨ActionExecutionOperator.javaä¸­
private final transient MailboxExecutor mailboxExecutor;

// æäº¤ä»»å¡è¿è¡å¤ç
mailboxExecutor.submit(() -&gt; tryProcessActionTaskForKey(key), "process action task");
</code></pre>
<p>è¿åè®¸é¿æ¶é´è¿è¡çæä½è®©åºæ§å¶æï¼é²æ­¢é»å¡æ´ä¸ªæä½ç¬¦ã</p>
<h3 id="44-å¼æ­¥ä»»å¡å¤ç">4.4 å¼æ­¥ä»»å¡å¤ç</h3>
<p>æ¯æå¼æ­¥æ§è¡å¹¶å·å¤éå½çç¶æç®¡çï¼</p>
<pre><code class="language-java">// å¨ ActionTask.java ä¸­ - æ¯æåºäºå»¶ç»­çæ§è¡
public class ActionTaskResult {
    private final boolean finished;
    private final List&lt;Event&gt; outputEvents;
    private final Optional&lt;ActionTask&gt; generatedActionTaskOpt;

    // åè®¸ä¸ä¸ªå¨ä½çæå»¶ç»­ä»»å¡
    public Optional&lt;ActionTask&gt; getGeneratedActionTask() {
        return generatedActionTaskOpt;
    }
}
</code></pre>
<h3 id="45-åå­ä¸è´æ§">4.5 åå­ä¸è´æ§</h3>
<p>å·æç¼å­ç¶æè®¿é®ççº¿ç¨å®å¨åå­ç®¡çï¼</p>
<pre><code class="language-java">// å¨ ActionExecutionOperator.java ä¸­
private void createAndSetRunnerContext(ActionTask actionTask) {
    // æ­£ç¡®ç®¡ç RunnerContext çåå»ºåéç¨
    if (actionTask.getRunnerContext() != null) {
        return;
    }
    // ... åå»ºéå½ç context
}
</code></pre>
<h3 id="46-æ°´å°åäºä»¶æ¶é´å¤ç">4.6 æ°´å°åäºä»¶æ¶é´å¤ç</h3>
<p>å·å¤å¹¶åæè¯çæ°´å°å¤çï¼</p>
<pre><code class="language-java">    private transient SegmentedQueue keySegmentQueue;
    
    keySegmentQueue = new SegmentedQueue();

    @Override
    public void processWatermark(Watermark mark) throws Exception {
        keySegmentQueue.addWatermark(mark);
        processEligibleWatermarks();
    }
</code></pre>
<h3 id="47-æ£æ¥ç¹åæ¢å¤">4.7 æ£æ¥ç¹åæ¢å¤</h3>
<p>ç¨äºå®¹éççº¿ç¨å®å¨ç¶æå¿«ç§</p>
<pre><code class="language-java">    @Override
    public void snapshotState(StateSnapshotContext context) throws Exception {
        if (actionStateStore != null) {
            Object recoveryMarker = actionStateStore.getRecoveryMarker();
            if (recoveryMarker != null) {
                recoveryMarkerOpState.update(List.of(recoveryMarker));
            }
        }

        HashMap&lt;Object, Long&gt; keyToSeqNum = new HashMap&lt;&gt;();
        getKeyedStateBackend()
                .applyToAllKeys(
                        VoidNamespace.INSTANCE,
                        VoidNamespaceSerializer.INSTANCE,
                        new ValueStateDescriptor&lt;&gt;(MESSAGE_SEQUENCE_NUMBER_STATE_NAME, Long.class),
                        (key, state) -&gt; keyToSeqNum.put(key, state.value()));
        checkpointIdToSeqNums.put(context.getCheckpointId(), keyToSeqNum);

        super.snapshotState(context);
    }
</code></pre>
<h3 id="48-æ»ç»">4.8 æ»ç»</h3>
<p>è®¾è®¡éç¨äºå¤ç§å¹¶åæºå¶ï¼</p>
<ul>
<li>Flinkå¹¶è¡å¤çï¼å©ç¨Flinkåççå¹¶è¡æ§åé®æ§æµ</li>
<li>æ¯ä¸ªKeyçéç¦»ï¼æ¯ä¸ªkeyç»´æ¤ç¬ç«ç¶æï¼æ¶é¤keyä¹é´çç«äº</li>
<li>åä½å¼çº¿ç¨ï¼ä½¿ç¨é®ç®±æ§è¡å¨å®ç°éé»å¡æ§è¡</li>
<li>å¼æ­¥å»¶ç»­ï¼éè¿ä»»å¡é¾æ¯æé¿æ¶é´è¿è¡çæä½</li>
<li>çº¿ç¨å®å¨ç¶æç®¡çï¼å¯¹å±äº«èµæºè¿è¡éå½çåæ­¥</li>
<li>å®¹éæºå¶ï¼æ£æ¥ç¹æºå¶ç¡®ä¿æéæåµä¸çæ°æ®ä¸è´æ§</li>
</ul>
<p>è¿ç§æ¹æ³ä½¿ç³»ç»è½å¤å¨ä¿æä¸è´æ§åæ¯ææ°´å¹³æ©å±çåæ¶å¤çé«ååéï¼å¯å¨ Flink éç¾¤çå¤ä¸ªèç¹é´æ©å±ã</p>
<h2 id="0xff-åè">0xFF åè</h2>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-29 20:25">2025-12-29 20:24</span>&nbsp;
<a href="https://www.cnblogs.com/rossiXYZ">ç½è¥¿çæè</a>&nbsp;
éè¯»(<span id="post_view_count">21</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19369781);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19369781', targetLink: 'https://www.cnblogs.com/rossiXYZ/p/19369781', title: 'ãå¤§æ°æ® &amp;amp; AIãFlink Agents æºç è§£è¯» --- (2) ---  æ ¸å¿æ¶æ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Java åªäºæåµä¼å¯¼è´åå­æ³æ¼ ]]></title>
    <link>https://www.cnblogs.com/yanshajiuzhou/p/19417793</link>
    <guid>75a705f582bb3bfbbaeb52795caf73eb</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yanshajiuzhou/p/19417793" title="åå¸äº 2025-12-29 19:29">
    <span role="heading" aria-level="2">Java åªäºæåµä¼å¯¼è´åå­æ³æ¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        åå­æ³æ¼ æ¯æå¯¹è±¡ å·²ç»ä¸åè¢«ç¨åºä½¿ç¨ï¼ä½å ä¸ºæäºåå  æ æ³è¢«åå¾åæ¶å¨åæ¶ï¼é¿æå ç¨åå­ï¼æç»å¯è½å¼å&nbsp;OOMï¼OutOfMemoryErrorï¼ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><span data-cke-copybin-start="1">â</span>ä»å¤©æä»¬æ¥ä¸èµ·èä¸èæåªäºæåµä¼å¯¼è´åå­æ³æ¼ã</p>
<p>ä»ä¹æ¯ <strong>åå­æ³æ¼</strong> å¢ï¼</p>
<p><strong>åå­æ³æ¼</strong> æ¯æå¯¹è±¡ <strong>å·²ç»ä¸åè¢«ç¨åºä½¿ç¨</strong>ï¼ä½å ä¸ºæäºåå  <strong>æ æ³è¢«åå¾åæ¶å¨åæ¶</strong>ï¼é¿æå ç¨åå­ï¼æç»å¯è½å¼å&nbsp;<strong>OOM</strong>ï¼OutOfMemoryErrorï¼ã</p>
<p>æ¥ä¸æ¥æä»¬çä¸ä¸å¸¸è§çå ç±»åå­æ³æ¼åºæ¯ã</p>
<p><strong>1ãçå½å¨æé¿çéå</strong></p>
<p>å°å¯¹è±¡æ¾å¥ <strong>éæ</strong> æ&nbsp;<strong>çå½å¨æå¾é¿&nbsp;</strong>çéåï¼å¦ public <strong>static</strong> List&lt;Object&gt; list = new ArrayList&lt;&gt;();ï¼ï¼å³ä½¿åé¢ä¸åéè¦ï¼éåä»ææå¶å¼ç¨ï¼å¯¼è´æ æ³<strong>GC</strong>ã</p>
<p><strong>2ãæªå³é­çèµæº</strong></p>
<p>è¿æ¥ãæµç­èµæºæªè°ç¨<strong> close() </strong>æ¹æ³å³é­ãè¿äºèµæºä¸ä»å ç¨åå­ï¼è¿å¯è½å ç¨æä»¶å¥æï¼æä½ç³»ç»åéçå¯ä¸æ è¯ï¼å­å®ï¼ä½ æè½æä½æä»¶èµæºï¼ãç½ç»è¿æ¥ç­ç³»ç»èµæºãæ¯å¦&nbsp;æ°æ®åºè¿æ¥ãæä»¶æµï¼FileInputStreamï¼ãSocketè¿æ¥ ç­ã</p>
<pre class="language-java highlighter-hljs"><code>public class FileTest {
    public static void main(String[] args) {
        FileInputStream fis = null;
        try {
            fis = new FileInputStream("test.txt");
            // è¯»åæä»¶ï¼æªè°ç¨ fis.close()
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } finally {
            // æªè°ç¨ fis.close() â fis ææ Native å¼ç¨ï¼æ æ³åæ¶
        }
    }
}</code></pre>
<p><strong>3ãThreadLocal ä½¿ç¨ä¸å½</strong></p>
<p>å°å¯¹è±¡å­å¥ <strong>ThreadLocal </strong>åï¼æªå¨åç»­è°ç¨ <strong>remove()</strong> æ¸çãè¥çº¿ç¨æ¥èªçº¿ç¨æ± ï¼ä¼å¤ç¨ï¼ï¼å¶ ThreadLocalMap ä¸­çå¼ä¼ä¸ç´å­æ´»ã</p>
<pre class="language-java highlighter-hljs"><code>public class ThreadLocalTest {
    private static ThreadLocal&lt;User&gt; userThreadLocal = new ThreadLocal&lt;&gt;();

    public static void main(String[] args) {
        // çº¿ç¨æ± ï¼æ ¸å¿çº¿ç¨é¿æå­æ´»ï¼
        TThreadPoolExecutor executor = new ThreadPoolExecutor(
                2,
                4,
                10,
                TimeUnit.SECONDS,
                new ArrayBlockingQueue&lt;&gt;(100),
                new ThreadFactoryBuilder().setNameFormat("my-thread-pool-%d").setDaemon(false).setPriority(Thread.NORM_PRIORITY).build(),
                new ThreadPoolExecutor.AbortPolicy()
        );

        executor.submit(() -&gt; {
            User user = new User("æå", 30);
            userThreadLocal.set(user); // å­å¨å° ThreadLocal

            // ä¸å¡æ§è¡å®æ¯ï¼æªè°ç¨ remove()
            // æ ¸å¿çº¿ç¨ä¸ä¼éæ¯ï¼ThreadLocal ä»ææ user å¼ç¨
        });
    }
}</code></pre>
<p>psï¼æªè¿è¡&nbsp;<strong>remove()</strong>ï¼è¿å¯è½ä¼å¯¼è´&nbsp;<strong>ThreadLocal </strong>åå¼ä¸²é¨ã</p>
<p><strong>4ãåé¨ç±»ä¸å¤é¨ç±»å¼ç¨</strong></p>
<p>ééæåé¨ç±»ï¼æå¿åç±»ï¼ä¼&nbsp;<strong>éå¼ææ&nbsp;</strong>å¤é¨ç±»çå¼ç¨ãå¦æåé¨ç±»å®ä¾çå½å¨ææ´é¿ï¼å¦è¢«ç¼å­æå¦ä¸ä¸ªçº¿ç¨å¼ç¨ï¼ï¼ä¼é»æ­¢å¤é¨ç±»è¢«åæ¶ã</p>
<pre class="language-java highlighter-hljs"><code>public class OuterClass {
    private byte[] bigData = new byte[1024 * 1024 * 10]; // 10MB å¤§å¯¹è±¡

    // ééæåé¨ç±»
    class InnerClass {
        // åé¨ç±»éå¼ææ OuterClass å¼ç¨
    }

    public InnerClass createInner() {
        return new InnerClass();
    }

    public static void main(String[] args) {
        OuterClass outer = new OuterClass();
        InnerClass inner = outer.createInner();

        // ç½®ç©ºå¤é¨ç±»å¼ç¨ï¼ä½ inner ä»ææ outer å¼ç¨
        outer = null;

        // è¥ inner è¢«éæåé/çº¿ç¨é¿æææ â outer å¯¹è±¡ï¼å« bigDataï¼æ æ³åæ¶
    }
}</code></pre>
<p><strong>5ã&nbsp;çå¬å¨ä¸åè°</strong></p>
<p>æ³¨åäº <strong>çå¬å¨&nbsp;</strong>æ <strong>åè°</strong> åï¼å¨å¯¹è±¡ä¸åéè¦æ¶ <strong>æ²¡ææ³¨é</strong>ï¼å¯¼è´æºå¯¹è±¡ä»ææçå¬å¨çå¼ç¨ï¼æ¯å¦ äºä»¶çå¬å¨ãæ¶æ¯éåçæ¶è´¹èç­ï¼ã</p>
<p><strong>ææ¥å·¥å·æ¨è</strong></p>
<ul>
<li><strong>MATï¼Memory Analyzer Toolï¼ï¼</strong>åæå  Dump æä»¶ï¼å®ä½æ³æ¼å¯¹è±¡ãå¼ç¨é¾ï¼è°å¨æææ³æ¼å¯¹è±¡ï¼ï¼</li>
<li><strong>VisualVMï¼</strong>JDK èªå¸¦å·¥å·ï¼çæ§åå­å ç¨è¶å¿ï¼çæå  Dumpï¼ç®åææ¥æ³æ¼ã</li>
</ul>
<p>è¿éæåªåäºå¸¸è§çå ç§æåµï¼æ¬¢è¿å¤§å®¶è¡¥åå¶ä»åå­æ³æ¼åºæ¯ã</p>
<p style="text-align: right"><span style="color: rgba(53, 152, 219, 1)">äººé´éååï¼åæåç§æï¼ä¸è¬è¦ã-- çæ²ä¹æ´²</span></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-29 19:29">2025-12-29 19:29</span>&nbsp;
<a href="https://www.cnblogs.com/yanshajiuzhou">çæ²ä¹æ´²</a>&nbsp;
éè¯»(<span id="post_view_count">51</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19417793);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19417793', targetLink: 'https://www.cnblogs.com/yanshajiuzhou/p/19417793', title: 'Java åªäºæåµä¼å¯¼è´åå­æ³æ¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ MAFå¿«éå¥é¨ï¼9ï¼å¤è·¯åæ¯è·¯ç±å·¥ä½æµ ]]></title>
    <link>https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper09</link>
    <guid>8d879eeff0eec1c38a24a10052f718a0</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper09" title="åå¸äº 2025-12-29 18:30">
    <span role="heading" aria-level="2">MAFå¿«éå¥é¨ï¼9ï¼å¤è·¯åæ¯è·¯ç±å·¥ä½æµ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/381412/202512/381412-20251224203108188-1569801702.png" alt="MAFå¿«éå¥é¨ï¼9ï¼å¤è·¯åæ¯è·¯ç±å·¥ä½æµ" class="desc_img">
        ä¸ä¸ç¯ï¼æä»¬å­¦ä¹ äºMAFä¸­å¦ä½è¿è¡if-elseç±»åçæ¡ä»¶è·¯ç±ï¼ä½æ¯å®éå·¥ä½ä¸­å¯è½ä¼æä¸­å¤ä¸ªåæ¯è·¯ç±çåºæ¯ãå¨å®éä¸å¡åºæ¯ä¸­ï¼å¾å¤çä¸å¡é»è¾æ¶åå°ä¸æ­¢ä¸¤ä¸ªå¤æ­æ¡ä»¶ï¼èæ¯å¤ä¸ªãå¨MAFä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨ Switch-Case æ¥å®ç°è¿ç§å·¥ä½æµåé¨å¤ç±»å³ç­æ¡ä»¶ç å·¥ä½æµéæ±ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><span><span>å¤§å®¶å¥½ï¼ææ¯Edisonã</span></span></p>
<p><span><span>æè¿æä¸ç´å¨è·çå£æ°çã<a class="normal_text_link mp_article_text_link" href="https://www.cnblogs.com/sheng-jie/p/19200934" target="_blank" data-itemshowtype="0" data-linktype="2"><span>.NET+AIæºè½ä½å¼åè¿é¶</span></a><span>ãè¯¾ç¨å­¦ä¹ MAFçå¼åæå·§ï¼æå¼ºçæ¨èä½ ä¹ä¸è½¦è·æä¸èµ·åºåï¼</span></span></span></p>
<p><span><a class="normal_text_link mp_article_text_link" href="https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper08" target="_blank" data-itemshowtype="0" data-linktype="2"><span>ä¸ä¸ç¯</span></a><span>ï¼æä»¬å­¦ä¹ äºMAFä¸­å¦ä½è¿è¡if-elseç±»åçæ¡ä»¶è·¯ç±<span>ï¼ä½æ¯å®éå·¥ä½ä¸­å¯è½ä¼å­å¨å¤ä¸ªåæ¯è·¯ç±çåºæ¯ãæ¬ç¯ï¼æä»¬æ¥äºè§£ä¸MAFä¸­çswitch-caseè·¯ç±å®ç°å¤åæ¯è·¯ç±å·¥ä½æµã</span></span></span></p>
<h1><strong>Why switch-case?</strong></h1>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span>å¨å®éä¸å¡åºæ¯ä¸­ï¼å¾å¤çä¸å¡é»è¾æ¶åå°ä¸æ­¢ä¸¤ä¸ªå¤æ­æ¡ä»¶ï¼èæ¯å¤ä¸ª<span>ã</span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span>ä¾å¦ï¼å¨ä¸ä¸ç¯çä¼ä¸åé¨é®ä»¶æ£æµæ¡ä¾ä¸­ï¼æä»¬çæ£æµç»æåªæä¸¤ä¸ªï¼åå¾é®ä»¶ æ æ­£å¸¸é®ä»¶ï¼ï¼ä½å¦ææä»¬æ³å¢å ä¸ä¸ªç»æï¼ä¸ç¡®å®ï¼å°±æ æ³éç¨äºã</span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span data-pm-slice="0 0 []"><span><span>å¨MAFä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨ Switch-Case æ¥å®ç°è¿ç§å·¥ä½æµåé¨å¤ç±»å³ç­æ¡ä»¶ç å·¥ä½æµéæ±<span>ã</span></span></span></span></span></span></span></span></p>
<h1><strong>å®éªæ¡ä¾</strong></h1>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span>ä»å¤©æ¥æä¸ä¸ä¸ç¯è¿ä¸ªä¼ä¸åé¨é®ä»¶æ£æµçå·¥ä½æµæ¡ä¾ï¼ä¸ä¸ç¯çæµç¨æ¯è¿æ ·çï¼</span></span></span></span></span></span></span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202512/381412-20251224202006911-1817307092.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span><span>ä»å¤©åè®¾æä»¬éè¦ææ´ä¸ºç²¾ç»çåç±»ï¼</span></span></span></span></span></span></span></span></span></span></p>
<p data-pm-slice="0 0 []"><span><span>&nbsp; â&nbsp;<span><span>**æ­£å¸¸é®ä»¶**<span><span>ï¼NotSpamï¼ï¼å®¢æ·å¨è¯¢ãä¸å¡å¾æ¥</span></span></span></span></span></span></p>
<p><span><span>&nbsp; â&nbsp;<span><span>**åå¾é®ä»¶**<span><span>ï¼Spamï¼ï¼ææ¾çè¯éªãå¹¿å</span></span></span></span></span></span></p>
<p><span><span>&nbsp;&nbsp;<span><span>â ï¸&nbsp;<span><span>**ä¸ç¡®å®é®ä»¶**<span><span>ï¼Uncertainï¼ï¼å¯è½æ¯éé±¼é®ä»¶ï¼éè¦äººå·¥å®¡æ ¸</span></span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>é£ä¹è¿å°±æ¯ä¸ä¸ªä¸ååç±»çï¼å¨ä¸å¡å¼åä¸­æä»¬éå¸¸ä¼ç¨å°switch-caseè¯­æ³ï¼èå¨MAFå·¥ä½æµä¸­ï¼ä¹ä¸ºæä»¬å®ä¹äºè¿ç§switch-caseæ¥å£ã</span></span></span></span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>å¨ä¸é¢çä»£ç ç¤ºä¾ä¸­ï¼æ¯å¯¹äºä¸¤ç§æ¥å£çä½¿ç¨æ¹å¼ï¼</span></span></span></span></span></span></span></span></span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Conditional Edge</span>
<span style="color: rgba(0, 0, 0, 1)">builder
    .AddEdge(source, target1, condition: c </span>=&gt; c.IsSpam == <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">)
    .AddEdge(source, target2, condition: c </span>=&gt; c.IsSpam == <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Switch-Case</span>
builder.AddSwitch(source, sb =&gt;<span style="color: rgba(0, 0, 0, 1)"> sb
    .AddCase(c </span>=&gt; c.Decision ==<span style="color: rgba(0, 0, 0, 1)"> NotSpam, target1)
    .AddCase(c </span>=&gt; c.Decision ==<span style="color: rgba(0, 0, 0, 1)"> Spam, target2)
    .WithDefault(target3)
);</span></pre>
</div>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>å¯ä»¥çå°ï¼switch-caseæ¨¡å¼å¶ä»·å¼ä¸»è¦å¨äºå¢å¼ºä»£ç å¯ç»´æ¤æ§ï¼å¯¹äºåç»­å¦æææ°å¢åç±»ï¼åªéè¦æ·»å ä¸ä¸ªAddCaseæ¥å£æ¹æ³å®ç°æ°å¢åç±»çå¤çï¼åæ¶åºäºWithDefaultæ¥å£æ¹æ³å®ç°ååºç¡®ä¿æææåµé½æå¤çã</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>æåï¼ä¸é¢æ¯æä»¬éè¦éæåçåæ¯è·¯ç±å¾ï¼</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202512/381412-20251224202047038-2027515638.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<h1><strong>åå¤å·¥ä½</strong></h1>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span>å¨ä»å¤©çè¿ä¸ªæ¡ä¾ä¸­ï¼æä»¬ä»ç¶åå»ºäºä¸ä¸ª.NETæ§å¶å°åºç¨ç¨åºï¼å®è£äºä»¥ä¸NuGetåï¼</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<ul class="list-paddingleft-1">
<li><span>Microsoft.Agents.AI.OpenAI</span></li>
<li><span>Microsoft.Agents.AI.Workflows</span></li>
<li><span>Microsoft.Extensions.AI.OpenAI</span></li>
</ul>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span>æä»¬çéç½®æä»¶ä¸­å®ä¹äºLLM APIçä¿¡æ¯ï¼</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">{
  </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">OpenAI</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">: {
    </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">EndPoint</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">https://api.siliconflow.cn</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
    </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ApiKey</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">******************************</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
    </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ModelId</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Qwen/Qwen3-30B-A3B-Instruct-2507</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
  }
}</span></pre>
</div>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span><span data-pm-slice="0 0 []"><span data-pm-slice="0 0 []"><span>è¿éæä»¬ä½¿ç¨ SiliconCloud æä¾<span><span>ç<span><span>&nbsp;<span><span>Qwen/Qwen3-30B-A3B-Instruct-2507&nbsp;<span><span>æ¨¡åï¼ä½ <span><span>å¯ä»¥éè¿è¿ä¸ªURLæ³¨åè´¦å·ï¼<span><span><a href="https://cloud.siliconflow.cn/i/DomqCefW" target="_blank" rel="noopener nofollow">https://cloud.siliconflow.cn/i/DomqCefW</a><span>&nbsp;è·åå¤§éåè´¹çTokenæ¥è¿è¡æ¬æ¬¡å®éªã</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span><span data-pm-slice="0 0 []"><span><span>ç¶åï¼æä»¬å°éç½®æä»¶ä¸­çAPIä¿¡æ¯è¯»ååºæ¥ï¼</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> config = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ConfigurationBuilder()
    .AddJsonFile($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">appsettings.json</span><span style="color: rgba(128, 0, 0, 1)">"</span>, optional: <span style="color: rgba(0, 0, 255, 1)">false</span>, reloadOnChange: <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">)
    .Build();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> openAIProvider = config.GetSection(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">OpenAI</span><span style="color: rgba(128, 0, 0, 1)">"</span>).Get&lt;OpenAIProvider&gt;();</pre>
</div>
<h2><span>å®ä¹æ°æ®ä¼ è¾æ¨¡å</span></h2>
<p><span><span>é¦åï¼æä»¬å®ä¹ä¸ä¸å¨è¿ä¸ªå·¥ä½æµä¸­éè¦çæä¼ éçæ°æ®æ¨¡åï¼</span></span></p>
<p><span><span>ï¼1ï¼DetectionResult ï¼æä»¶é®ä»¶æ£æµç»æ</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> DetectionResult
{
    </span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;summary&gt;</span>
    <span style="color: rgba(128, 128, 128, 1)">///</span><span style="color: rgba(0, 128, 0, 1)"> æ£æµå³ç­ï¼NotSpam / Spam / Uncertainï¼
    </span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;/summary&gt;</span>
    [JsonPropertyName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">spam_decision</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
    [JsonConverter(</span><span style="color: rgba(0, 0, 255, 1)">typeof</span>(JsonStringEnumConverter))]  <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> JSON åºååä¸ºå­ç¬¦ä¸²</span>
    <span style="color: rgba(0, 0, 255, 1)">public</span> SpamDecision spamDecision { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    </span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;summary&gt;</span>
    <span style="color: rgba(128, 128, 128, 1)">///</span><span style="color: rgba(0, 128, 0, 1)"> å¤å®çç±ï¼ç¨äºå®¡è®¡åè°è¯ï¼
    </span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;/summary&gt;</span>
    [JsonPropertyName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">reason</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Reason { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.Empty;
    </span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;summary&gt;</span>
    <span style="color: rgba(128, 128, 128, 1)">///</span><span style="color: rgba(0, 128, 0, 1)"> é®ä»¶IDï¼ç¨äºå³è Shared State ä¸­çåå§åå®¹ï¼
    </span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;/summary&gt;</span>
<span style="color: rgba(0, 0, 0, 1)">    [JsonIgnore]
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> EmailId { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.Empty;
}

</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">enum</span><span style="color: rgba(0, 0, 0, 1)"> SpamDecision
{
    Spam,        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå¾é®ä»¶</span>
    NotSpam, <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ­£å¸¸é®ä»¶</span>
    UnCertain <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ æ³ç¡®å®ï¼éè¦äººå·¥å®¡æ ¸ï¼</span>
}</pre>
</div>
<p><span><span>ï¼2ï¼EmailStateConstants ï¼å¸¸éï¼ç±»ä¼¼äºCache Keyçä½ç¨ï¼åèä¸ä¸ç¯åå®¢åå®¹ã</span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span><span data-pm-slice="0 0 []"><span><span>ï¼3ï¼EmailMessage &amp; EmailResponse ï¼DTOä½ç¨ï¼åèä¸ä¸ç¯åå®¢åå®¹ã</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<h2><span>å¥å£èç¹ï¼åå¾é®ä»¶æ£æµExecutor</span></h2>
<p><span data-pm-slice="0 0 []"><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span data-pm-slice="0 0 []">è¿ä¸ªåå¾é®ä»¶æ£æµæ¯æ¬æµç¨çæ ¸å¿èç¹ï¼è¿æ¬¡æä»¬å°å¶éæä¸ºæ¯æä¸åç±»ï¼</span></span></span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span> SpamDetectionExecutor : Executor&lt;ChatMessage, DetectionResult&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> AIAgent _agent;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> AgentThread _thread;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> SpamDetectionExecutor(AIAgent agent) : <span style="color: rgba(0, 0, 255, 1)">base</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">SpamDetectionExecutor</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå»º Agent åå¯¹è¯çº¿ç¨</span>
        <span style="color: rgba(0, 0, 255, 1)">this</span>._agent =<span style="color: rgba(0, 0, 0, 1)"> agent;
        </span><span style="color: rgba(0, 0, 255, 1)">this</span>._thread = <span style="color: rgba(0, 0, 255, 1)">this</span><span style="color: rgba(0, 0, 0, 1)">._agent.GetNewThread();
    }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span> ValueTask&lt;DetectionResult&gt; HandleAsync(ChatMessage message, IWorkflowContext context, CancellationToken cancellationToken = <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 1ï¸â£ çæå¯ä¸é®ä»¶IDå¹¶ä¿å­åå®¹å° Shared State</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> trackedEmail = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> EmailMessage
        {
            EmailId </span>= Guid.NewGuid().ToString(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">N</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">),
            EmailContent </span>=<span style="color: rgba(0, 0, 0, 1)"> message.Text
        };
        </span><span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> context.QueueStateUpdateAsync(
            trackedEmail.EmailId,
            trackedEmail,
            scopeName: EmailStateConstants.EmailStateScope,
            cancellationToken
        );
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 2ï¸â£ è°ç¨ AI Agent è¿è¡ä¸åç±»æ£æµ</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> agentResponse = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> _agent.RunAsync(
            message,
            _thread,
            cancellationToken: cancellationToken
        );
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 3ï¸â£ è§£æç»æåè¾åº</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> detection = JsonSerializer.Deserialize&lt;DetectionResult&gt;<span style="color: rgba(0, 0, 0, 1)">(agentResponse.Text)
            </span>?? <span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> InvalidOperationException(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ æ³è§£æ Spam Detection ååº</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 4ï¸â£ å³è EmailIdï¼ä¾ä¸æ¸¸ Executor æ¥æ¾åå§åå®¹ï¼</span>
        detection.EmailId =<span style="color: rgba(0, 0, 0, 1)"> trackedEmail.EmailId;
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> detection;
    }
}</span></pre>
</div>
<p>å¨è¿ä¸ªExecutorä¸­ï¼å®æ¥æ¶æä»¬å¦ä¸æç¤ºå®ä¹å¥½çAgentæ¥å®ç°ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> spamDetectionAgent = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatClientAgent(
    chatClient,
    </span><span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatClientAgentOptions(
        instructions: </span><span style="color: rgba(128, 0, 0, 1)">@"</span><span style="color: rgba(128, 0, 0, 1)">ä½ æ¯ä¸ä¸ªåå¾é®ä»¶æ£æµå©æãå¤å®è§åï¼
- NotSpam: ææ¾çæ­£å¸¸ä¸å¡é®ä»¶ï¼è®¢åæ¥è¯¢ãå®åå¨è¯¢ç­ï¼
- Spam: ææ¾çåå¾é®ä»¶ï¼è¯éªãå¹¿åãéé±¼ï¼
- Uncertain: æ æ³æç¡®å¤æ­ï¼åå«å¯çåç´ ä½ä¸ç¡®å®ï¼å¦å«å¯çé¾æ¥ä½åå®¹æ¨¡ç³ï¼
å¯¹äºæ¨¡æ£±ä¸¤å¯çæåµï¼å¾åäºæ è®°ä¸º Uncertain ä»¥ä¿è¯å®å¨ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
    )
    {
        ChatOptions </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatOptions
        {
            ResponseFormat </span>= ChatResponseFormat.ForJsonSchema&lt;DetectionResult&gt;<span style="color: rgba(0, 0, 0, 1)">()
        }
    }
);</span></pre>
</div>
<p>å¨ChatOptionsä¸­æå®äºè¯¥Agentè¿åçæ¶æ¯éè¦è¿è¡åºååå°å¼ºç±»åï¼ä¾¿äºåç»­éè¿å¼ºç±»åæ°æ®è¿è¡å³ç­è·¯ç±ã</p>
<h2 data-pm-slice="2 3 []"><span>ä¸æ¸¸èç¹Aï¼æ­£å¸¸é®ä»¶å¤ç+åé</span></h2>
<p>è¿éæä»¬éå¯¹è¯å«å°çæ­£å¸¸é®ä»¶å¼åä¸¤ä¸ªæ§è¡å¨ï¼åè®¾å¶ç¨äºé®ä»¶å¤åè½¬åï¼</p>
<h3>é®ä»¶å¤çï¼è¯»åå±äº«ç¶æåºçåæï¼ç¶åè°ç¨Agentè¾åºJSONåå¤ã</h3>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span> EmailAssistantExecutor : Executor&lt;DetectionResult, EmailResponse&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> AIAgent _agent;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> AgentThread _thread;

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> EmailAssistantExecutor(AIAgent agent) : <span style="color: rgba(0, 0, 255, 1)">base</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">EmailAssistantExecutor</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå»º Agent åå¯¹è¯çº¿ç¨</span>
        <span style="color: rgba(0, 0, 255, 1)">this</span>._agent =<span style="color: rgba(0, 0, 0, 1)"> agent;
        </span><span style="color: rgba(0, 0, 255, 1)">this</span>._thread = <span style="color: rgba(0, 0, 255, 1)">this</span><span style="color: rgba(0, 0, 0, 1)">._agent.GetNewThread();
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span> ValueTask&lt;EmailResponse&gt; HandleAsync(DetectionResult message, IWorkflowContext context, CancellationToken cancellationToken = <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ð¡ï¸ é²å¾¡æ§æ£æ¥ï¼ç¡®ä¿åªå¤çæ­£å¸¸é®ä»¶</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> (message.spamDecision ==<span style="color: rgba(0, 0, 0, 1)"> SpamDecision.Spam)
            </span><span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> InvalidOperationException(
                </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">EmailAssistantExecutor ä¸åºå¤çåå¾é®ä»¶ï¼è¯·æ£æ¥è·¯ç±éç½®ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
            );

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 1ï¸â£ ä» Shared State è¯»ååå§é®ä»¶åå®¹</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> email = <span style="color: rgba(0, 0, 255, 1)">await</span> context.ReadStateAsync&lt;EmailMessage&gt;<span style="color: rgba(0, 0, 0, 1)">(
            message.EmailId,
            scopeName: EmailStateConstants.EmailStateScope,
            cancellationToken
        ) </span>?? <span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> InvalidOperationException($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ¾ä¸å° EmailId={message.EmailId} çé®ä»¶åå®¹</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 2ï¸â£ è°ç¨ AI Agent çæåå¤</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> agentResponse = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> _agent.RunAsync(
            email.EmailContent,
            _thread,
            cancellationToken: cancellationToken
        );

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 3ï¸â£ è§£æç»æåè¾åº</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> emailResponse = JsonSerializer.Deserialize&lt;EmailResponse&gt;<span style="color: rgba(0, 0, 0, 1)">(agentResponse.Text)
            </span>?? <span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> InvalidOperationException(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ æ³è§£æ Email Assistant ååº</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> emailResponse;
    }
}</span></pre>
</div>
<p>è¿éçAgentå®ä¹å¦ä¸ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> emailAssistantAgent = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatClientAgent(
    chatClient,
    </span><span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatClientAgentOptions(
        instructions: </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä½ æ¯ä¸ä¸ªä¼ä¸é®ä»¶å©æï¼ä¸ºå®¢æ·é®ä»¶çæä¸ä¸ãåå¥½çä¸­æåå¤ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
    )
    {
        ChatOptions </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatOptions
        {
            ResponseFormat </span>= ChatResponseFormat.ForJsonSchema&lt;EmailResponse&gt;<span style="color: rgba(0, 0, 0, 1)">()
        }
    }
);</span></pre>
</div>
<h3><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;text-transform: none;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-align: left;line-height: 1.75em;margin-bottom: 8px;margin-top: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">é®ä»¶è½¬åï¼æ¨¡æé®ä»¶è½¬åå°å·ä½çå®¢æï¼è¿éä»ä»ä½¿ç¨YieldOutputAsyncå®æå·¥ä½æµè¾åºæ¶æ¯åå®¹ã</span></h3>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span> EmailSendingExecutor() : Executor&lt;EmailResponse&gt;(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">EmailSendingExecutor</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span> ValueTask HandleAsync(EmailResponse message, IWorkflowContext context, CancellationToken cancellationToken = <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¨¡æé®ä»¶åéï¼å®éé¡¹ç®ä¸­å¯è°ç¨ SMTPãSendGrid ç­æå¡ï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> context.YieldOutputAsync(
            $</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð¤ é®ä»¶å·²åé: {message.Response}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
            cancellationToken
        );
    }
}</span></pre>
</div>
<h2 data-pm-slice="2 3 []"><span>ä¸æ¸¸èç¹Bï¼åå¾é®ä»¶å¤ç</span></h2>
<p>å½å¤æ­å°æ¯åå¾é®ä»¶æ¶ï¼è½¬äº¤ç»è¯¥æ§è¡å¨å¤çï¼è¿éæ¨¡æè¾åºäºä¸æ®µé£é©æç¤ºï¼å®éä¸­å¯è½æ¯ä¸æ¥äººå·¥è·è¿ç­ç­æä½ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span> SpamHandlingExecutor() : Executor&lt;DetectionResult&gt;(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">SpamHandlingExecutor</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span> ValueTask HandleAsync(DetectionResult message, IWorkflowContext context, CancellationToken cancellationToken = <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ð¡ï¸ é²å¾¡æ§æ£æ¥ï¼ç¡®ä¿åªå¤çåå¾é®ä»¶</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> (message.spamDecision !=<span style="color: rgba(0, 0, 0, 1)"> SpamDecision.Spam)
            </span><span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> InvalidOperationException(
                </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">SpamHandlingExecutor åªåºå¤ç Spam ç±»åçé®ä»¶ï¼è¯·æ£æ¥è·¯ç±éç½®ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
            );

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è®°å½åå¾é®ä»¶ï¼å®éé¡¹ç®ä¸­å¯åå¥æ°æ®åºææ¥å¿ç³»ç»ï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> context.YieldOutputAsync(
            $</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð« åå¾é®ä»¶å·²æ¦æª: {message.Reason}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
            cancellationToken
        );
    }
}</span></pre>
</div>
<h2 data-pm-slice="2 3 []"><span>ä¸æ¸¸èç¹Cï¼<span><span>ä¸ç¡®å®é®ä»¶å¤çæ§è¡å¨ï¼ååºå¤çï¼</span></span></span></h2>
<p>å½å¤æ­å°å±äºä¸ç¡®å®çé®ä»¶åç±»æ¶ï¼è½¬äº¤ç»è¯¥æ§è¡å¨åååºå¤ç æ é»è®¤å¤çï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">class</span> UncertainHandlingExecutor() : Executor&lt;DetectionResult&gt;(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">UncertainHandlingExecutor</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span><span style="color: rgba(0, 0, 0, 1)"> ValueTask HandleAsync(
        DetectionResult message,
        IWorkflowContext context,
        CancellationToken cancellationToken </span>= <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ð¡ï¸ é²å¾¡æ§æ£æ¥ï¼ç¡®ä¿åªå¤çä¸ç¡®å®é®ä»¶</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> (message.spamDecision !=<span style="color: rgba(0, 0, 0, 1)"> SpamDecision.UnCertain)
            </span><span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> InvalidOperationException(
                </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">UncertainHandlingExecutor åªåºå¤ç Uncertain ç±»åçé®ä»¶ï¼æä½ä¸º Default Caseï¼ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
            );

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 1ï¸â£ ä» Shared State è¯»ååå§é®ä»¶åå®¹ï¼ç¨äºäººå·¥å®¡æ ¸ï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> email = <span style="color: rgba(0, 0, 255, 1)">await</span> context.ReadStateAsync&lt;EmailMessage&gt;<span style="color: rgba(0, 0, 0, 1)">(
            message.EmailId,
            scopeName: EmailStateConstants.EmailStateScope,
            cancellationToken
        );

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 2ï¸â£ è¾åºå¾å®¡æ ¸ä¿¡æ¯</span>
        <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> context.YieldOutputAsync(
            $</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â ï¸ ä¸ç¡®å®é®ä»¶éäººå·¥å®¡æ ¸:\n</span><span style="color: rgba(128, 0, 0, 1)">"</span> +<span style="color: rgba(0, 0, 0, 1)">
            $</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åå : {message.Reason}\n</span><span style="color: rgba(128, 0, 0, 1)">"</span> +<span style="color: rgba(0, 0, 0, 1)">
            $</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åå®¹é¢è§: {email?.EmailContent?.Substring(0, Math.Min(100, email.EmailContent.Length))}...</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
            cancellationToken
        );
    }
}</span></pre>
</div>
<h2>æå»ºå·¥ä½æµ</h2>
<p>ç°å¨ä¸äºä¿±å¤ï¼åªæ¬ ä¸ä¸ªWorkflowï¼ç°å¨Let's do it!</p>
<p><strong>Step1:</strong> è·åChatClient</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> chatClient = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> OpenAIClient(
        </span><span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ApiKeyCredential(openAIProvider.ApiKey),
        </span><span style="color: rgba(0, 0, 255, 1)">new</span> OpenAIClientOptions { Endpoint = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> Uri(openAIProvider.Endpoint) })
    .GetChatClient(openAIProvider.ModelId)
    .AsIChatClient();</span></pre>
</div>
<p><strong><span><span>Step2<span>: </span></span></span></strong>å®ä¾åèªå®ä¹Agent &amp; Executors</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> spamDetectionExecutor = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> SpamDetectionExecutor(spamDetectionAgent);
</span><span style="color: rgba(0, 0, 255, 1)">var</span> emailAssistantExecutor = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> EmailAssistantExecutor(emailAssistantAgent);
</span><span style="color: rgba(0, 0, 255, 1)">var</span> sendEmailExecutor = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> EmailSendingExecutor();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> handleSpamExecutor = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> SpamHandlingExecutor();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> handleUncertainExecutor = <span style="color: rgba(0, 0, 255, 1)">new</span> UncertainHandlingExecutor();</pre>
</div>
<p><strong><span><span>Step3<span>: </span></span></span></strong>åå»ºswitch-caseå¤è·¯ç±å³ç­å·¥ä½æµ</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> âââââââââââââââââââââââââââââ
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ð§ æ¡ä»¶å½æ°å·¥åæ¹æ³
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> âââââââââââââââââââââââââââââ</span>
Func&lt;<span style="color: rgba(0, 0, 255, 1)">object</span>?, <span style="color: rgba(0, 0, 255, 1)">bool</span>&gt; GetCondition(SpamDecision expectedDecision) =&gt;<span style="color: rgba(0, 0, 0, 1)">
    detectionResult </span>=&gt;<span style="color: rgba(0, 0, 0, 1)">
        detectionResult </span><span style="color: rgba(0, 0, 255, 1)">is</span> DetectionResult result &amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
        result.spamDecision </span>==<span style="color: rgba(0, 0, 0, 1)"> expectedDecision;

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> âââââââââââââââââââââââââââââ
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ð ä½¿ç¨ AddSwitch æå»º Switch-Case å·¥ä½æµ
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> âââââââââââââââââââââââââââââ</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> builder = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> WorkflowBuilder(spamDetectionExecutor);
builder.AddSwitch(spamDetectionExecutor, sb </span>=&gt;<span style="color: rgba(0, 0, 0, 1)">
        sb
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Case 1: NotSpam â EmailAssistant </span>
            .AddCase(GetCondition(expectedDecision: SpamDecision.NotSpam), <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">[] { (ExecutorBinding)emailAssistantExecutor })
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Case 2: Spam â HandleSpam</span>
            .AddCase(GetCondition(expectedDecision: SpamDecision.Spam), <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">[] { (ExecutorBinding)handleSpamExecutor })
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Default: Uncertain (æä»»ä½æªå¹éçæåµ) â HandleUncertain</span>
            .WithDefault(<span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">[] { (ExecutorBinding)handleUncertainExecutor })
    )
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> EmailAssistant ä¹åèªå¨åéé®ä»¶</span>
<span style="color: rgba(0, 0, 0, 1)">    .AddEdge(emailAssistantExecutor, sendEmailExecutor)
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éç½®è¾åºèç¹ï¼ä¸ä¸ªç»ç¹æ§è¡å¨é½ä¼äº§çè¾åºï¼</span>
<span style="color: rgba(0, 0, 0, 1)">    .WithOutputFrom(handleSpamExecutor, sendEmailExecutor, handleUncertainExecutor);
</span><span style="color: rgba(0, 0, 255, 1)">var</span> workflow =<span style="color: rgba(0, 0, 0, 1)"> builder.Build();

Console.OutputEncoding </span>=<span style="color: rgba(0, 0, 0, 1)"> Encoding.UTF8;
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â Conditional Workflow æå»ºå®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<h2>æµè¯å·¥ä½æµ</h2>
<p>é¦åï¼ä¸ºäºä¾¿äºåç»­æµè¯æä»¬å°æ§è¡å·¥ä½æµå°è£ä¸ºä¸ä¸ªéææ¹æ³ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">async</span><span style="color: rgba(0, 0, 0, 1)"> Task RunWorkflowAsync(
    Workflow workflow,
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> scenarioName,
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> emailContent)
{
    Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð¬ æµè¯åºæ¯ï¼{scenarioName}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð§ é®ä»¶åå®¹ï¼{emailContent.Substring(0, Math.Min(80, emailContent.Length))}...\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">await</span> <span style="color: rgba(0, 0, 255, 1)">using</span> <span style="color: rgba(0, 0, 255, 1)">var</span> run = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> InProcessExecution.StreamAsync(
        workflow,
        </span><span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatMessage(ChatRole.User, emailContent)
    );
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åé Turn Tokenï¼å¯ç¨äºä»¶æ¨é</span>
    <span style="color: rgba(0, 0, 255, 1)">await</span> run.TrySendMessageAsync(<span style="color: rgba(0, 0, 255, 1)">new</span> TurnToken(emitEvents: <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">));
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è®¢éäºä»¶æµ</span>
    <span style="color: rgba(0, 0, 255, 1)">await</span> <span style="color: rgba(0, 0, 255, 1)">foreach</span> (WorkflowEvent evt <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> run.WatchStreamAsync())
    {
        </span><span style="color: rgba(0, 0, 255, 1)">switch</span><span style="color: rgba(0, 0, 0, 1)"> (evt)
        {
            </span><span style="color: rgba(0, 0, 255, 1)">case</span><span style="color: rgba(0, 0, 0, 1)"> ExecutorCompletedEvent completedEvent:
                Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â {completedEvent.ExecutorId} å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
            </span><span style="color: rgba(0, 0, 255, 1)">case</span><span style="color: rgba(0, 0, 0, 1)"> WorkflowOutputEvent outputEvent:
                Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââââââââââââââââ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð å·¥ä½æµæ§è¡å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââââââââââââââââ\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{outputEvent.Data}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
            </span><span style="color: rgba(0, 0, 255, 1)">case</span><span style="color: rgba(0, 0, 0, 1)"> WorkflowErrorEvent errorEvent:
                Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â¨ æ¶å° Workflow Error Eventï¼</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{errorEvent.Data}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
            </span><span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">:
                </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
        }
    }
    Console.WriteLine();
}</span></pre>
</div>
<p><strong>æµè¯ç¨ä¾1ï¼</strong>æ­£å¸¸å¨è¯¢é®ä»¶è¾å¥</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> scenarioName1 = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ­£å¸¸é®ä»¶ â EmailAssistant â SendEmail</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">var</span> emailContent1 = <span style="color: rgba(128, 0, 0, 1)">@"</span><span style="color: rgba(128, 0, 0, 1)">
å°æ¬çå®¢æå¢éï¼
æ¨å¥½ï¼ææ¯è´µå¬å¸çé¿æå®¢æ·ï¼è®¢åå·ä¸º 
#2025
-001ã
ææ³ç¡®è®¤ä¸ä¸ä¸å¨æäº¤çéè´­è®¢åæ¯å¦å·²ç»å®æåè´§ã
å¦æéè¦è¡¥åä»»ä½ä¿¡æ¯ï¼è¯·éæ¶åç¥ã
æå¾æ¨çåå¤ï¼è°¢è°¢ï¼
å®¢æ·ï¼å¼ åç
</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> RunWorkflowAsync(workflow, scenarioName1, emailContent1);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â æ­£å¸¸é®ä»¶è·¯å¾éªè¯å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<p>æµè¯ç»æå¦ä¸å¾æç¤ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202512/381412-20251224202754097-83329301.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¯ä»¥çè§ï¼å¯¹äºæ­£å¸¸å¨è¯¢é®ä»¶ï¼è¿è¡æ­£å¸¸çé®ä»¶å¤çåè½¬åã</p>
<p><strong>æµè¯ç¨ä¾2ï¼</strong>åå¾é®ä»¶è¾å¥</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> scenarioName2 = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åå¾é®ä»¶ â HandleSpam</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">var</span> emailContent2 = <span style="color: rgba(128, 0, 0, 1)">@"</span><span style="color: rgba(128, 0, 0, 1)">
ððð æ­åæ¨ä¸­å¥å¦ï¼ððð

æ¨å·²è¢«éä¸­è·å¾ 100 ä¸ç°éå¤§å¥ï¼

ç«å³ç¹å»ä»¥ä¸é¾æ¥é¢åï¼
http://suspicious-site.com/claim-prize

ä»éä»æ¥ææï¼è¿æä½åºï¼
ä¸éè¦ä»»ä½æç»­è´¹ï¼å®å¨åè´¹ï¼

å¿«éè¡å¨ï¼æºä¸å¯å¤±ï¼
</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> RunWorkflowAsync(workflow, scenarioName2, emailContent2);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â åå¾é®ä»¶è·¯å¾éªè¯å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<p>æµè¯ç»æå¦ä¸å¾æç¤ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202512/381412-20251224202904798-37631196.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¯ä»¥çè§ï¼å¯¹äºåå¾é®ä»¶ï¼è¿è¡ææçæ¦æªï¼åç»­è¿å¯ä»¥è¿è¡ä¸æ¥äººå·¥è·è¸ªç­ç­ã</p>
<p><strong>æµè¯ç¨ä¾3ï¼</strong>æ æ³ç¡®è®¤ç±»åçé®ä»¶è¾å¥</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> uncertainEmail = <span style="color: rgba(128, 0, 0, 1)">@"</span><span style="color: rgba(128, 0, 0, 1)">
ä¸»é¢ï¼éè¦éªè¯æ¨çè´¦æ·
å°æ¬çå®¢æ·ï¼
æä»¬æ£æµå°æ¨çè´¦æ·å­å¨å¼å¸¸æ´»å¨ï¼éè¦éªè¯æ¨çèº«ä»½ä»¥ç¡®ä¿è´¦æ·å®å¨ã
è¯·ç»å½æ¨çè´¦æ·å¹¶å®æéªè¯æµç¨ï¼ä»¥ç»§ç»­ä½¿ç¨æå¡ã
è´¦æ·è¯¦æï¼
- ç¨æ·åï¼johndoe@contoso.com
- æåç»å½ï¼08/15/2025
- ç»å½å°ç¹ï¼è¥¿éå¾ï¼åçé¡¿å·
- ç»å½è®¾å¤ï¼ç§»å¨è®¾å¤
è¿æ¯ä¸é¡¹èªå¨å®å¨æªæ½ãå¦ææ¨è®¤ä¸ºæ­¤é®ä»¶æ¯éè¯¯åéçï¼è¯·ç«å³èç³»æä»¬çæ¯æå¢éã
æ­¤è´
å®å¨å¢é
å®¢æ·æå¡é¨é¨
</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> RunWorkflowAsync(
    workflow,
    </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä¸ç¡®å®é®ä»¶ â HandleUncertain (Default)</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
    uncertainEmail
);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â ä¸ç¡®å®é®ä»¶è·¯å¾éªè¯å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<p>æµè¯ç»æå¦ä¸å¾æç¤ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202512/381412-20251224202940842-749043447.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¯ä»¥çå°ï¼å¯¹äºLLMæ æ³ç¡®è®¤çç±»åï¼è¿å¥äºè¯¥æ§è¡å¨ï¼è¿æ¶å¯è½éè¦äººå·¥ä»å¥å®¡æ ¸ãåæ¶ï¼è¿ä¹æ¯å®éä¸­å¸¸è§çä¸ç§ååºæºå¶çå±ç°ï¼è¯å¥è¯è¯´ï¼<strong>å³ä½¿AIæ æ³æç¡®å¤æ­ï¼ä¹åºè¯¥æå¯¹åºçå¤çæµç¨</strong>ã</p>
<h1><strong><span>å°ç»</span></strong></h1>
<p>æ¬æä»ç»äºMAFä¸­çswitch-caseè·¯ç±ä»¥åå¦ä½å®ç°å¤æ¡ä»¶è·¯ç±ï¼æåä¼åäºä¸ä¸ç¯çä¼ä¸åé¨é®ä»¶æ£æµå·¥ä½æµæ¡ä¾ï¼ç¹å«éåäºå¤§äº3ä¸ªåæ¯çå¤æè·¯ç±åºæ¯ã</p>
<p>ä¸ä¸ç¯ï¼æä»¬å°ç»§ç»­å­¦ä¹ MAFä¸­å·¥ä½æµçå¾ªç¯å·¥ä½æµã</p>
<h1>åèèµæ</h1>
<p><span data-pm-slice="0 0 []"><span>å£æ°ï¼ã<a href="https://www.cnblogs.com/sheng-jie/p/19200934" target="_blank">.NET + AI æºè½ä½å¼åè¿é¶</a>ãï¼æ¨èææ°ï¼âââââï¼</span></span></p>
<p><span data-pm-slice="0 0 []"><span>Microsoft Learnï¼<span>ã<a href="https://learn.microsoft.com/en-us/agent-framework/overview/agent-framework-overview?wt.mc_id=MVP_397012" target="_blank" rel="noopener nofollow">Agent Framework Tutorials</a>ã</span></span></span></p>
<div><span data-pm-slice="0 0 []"><span>&nbsp;</span></span></div>
<p style="text-align: center"><img src="https://images.cnblogs.com/cnblogs_com/edisonchou/1647700/o_200902144330EdisonTalk-Footer.jpg" alt="" style="width: 65%; border: 1px solid rgba(221, 221, 221, 1); border-radius: 3px; box-shadow: 0 4px 8px rgba(3, 27, 78, 0.12)"></p>
<div id="Copyright">
<p>ä½èï¼<span style="text-decoration: underline">ç±è¿ªç</span></p>
<p>åºå¤ï¼<a title="from" href="https://edisontalk.cnblogs.com" target="_blank">https://edisontalk.cnblogs.com</a></p>
<p>æ¬æçæå½ä½èååå®¢å­å±æï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»ä¿çæ­¤æ®µå£°æï¼ä¸å¨æç« é¡µé¢ææ¾ä½ç½®ç»åºåæé¾æ¥ã</p>
</div>
</div>
<div id="MySignature" role="contentinfo">
    <div align="center"><a href="https://weibo.com/u/2068032061?s=6uyXnP" target="_blank"><img border="0" src="http://service.t.sina.com.cn/widget/qmd/2068032061/d643d182/10.png"></a></div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-29 18:30">2025-12-29 18:30</span>&nbsp;
<a href="https://www.cnblogs.com/edisontalk">EdisonZhou</a>&nbsp;
éè¯»(<span id="post_view_count">49</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19394484);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19394484', targetLink: 'https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper09', title: 'MAFå¿«éå¥é¨ï¼9ï¼å¤è·¯åæ¯è·¯ç±å·¥ä½æµ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ CodeSpirit å¼åç¯å¢æ­å»ºåå¯å¨æå ]]></title>
    <link>https://www.cnblogs.com/codelove/p/19392132</link>
    <guid>0a843efff4b9252f9b47679e48ee9529</guid>
    <description>
    <![CDATA[ 
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/codelove/p/19392132" title="åå¸äº 2025-12-29 15:07">
    <span role="heading" aria-level="2">CodeSpirit å¼åç¯å¢æ­å»ºåå¯å¨æå</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="æ¦è¿°">æ¦è¿°</h2>
<p>æ¬æåå°å¸®å©æ¨å¿«éæ­å»ºCodeSpiritï¼ç çµï¼ä½ä»£ç æ¡æ¶çå¼åç¯å¢ãCodeSpiritåºäº .NET 10 å Aspire 13.0 æå»ºï¼éè¿ç®åçå ä¸ªæ­¥éª¤å³å¯å¯å¨å®æ´çå¼åç¯å¢ã</p>
<p><strong>æåæ´æ°</strong>: 2025å¹´12æ22æ¥<br>
<strong>æ¡æ¶çæ¬</strong>: v2.0.0<br>
<img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224131727898-298580147.png" alt="image" loading="lazy"></p>
<h2 id="å¿«éå¼å§">å¿«éå¼å§</h2>
<h3 id="åç½®è¦æ±">åç½®è¦æ±</h3>
<ul>
<li><strong>æä½ç³»ç»</strong>: Windows 10/11, macOS 12+, æ Linux (Ubuntu 20.04+)</li>
<li><strong>CPU</strong>: Intel i5 æ AMD Ryzen 5 åä»¥ä¸ï¼æ¨èi7/Ryzen 7ï¼</li>
<li><strong>åå­</strong>: 16GB RAMï¼æ¨è32GBï¼</li>
<li><strong>å­å¨</strong>: è³å°20GBå¯ç¨ç©ºé´ï¼SSDæ¨èï¼</li>
</ul>
<blockquote>
<p><strong>æ³¨æ</strong>: CodeSpirité»è®¤ä½¿ç¨GreptimeDBè¿è¡å®¡è®¡æ¥å¿å­å¨åæç´¢ãElasticsearchä¸ºå¯éç»ä»¶ï¼å¦éä½¿ç¨è¯·åèç¸å³éç½®ææ¡£ã</p>
</blockquote>
<h3 id="1-å®è£-net-10-sdk">1. å®è£ .NET 10 SDK</h3>
<h4 id="windows">Windows</h4>
<pre><code class="language-powershell"># ä½¿ç¨ winget å®è£
winget install Microsoft.DotNet.SDK.10

# æä¸è½½å®è£å
# https://dotnet.microsoft.com/download/dotnet/10.0
</code></pre>
<h4 id="macos">macOS</h4>
<pre><code class="language-bash"># ä½¿ç¨ Homebrew
brew install --cask dotnet-sdk

# æä¸è½½å®è£å
# https://dotnet.microsoft.com/download/dotnet/10.0
</code></pre>
<h4 id="linux-ubuntu">Linux (Ubuntu)</h4>
<pre><code class="language-bash"># æ·»å å¾®è½¯åæº
wget https://packages.microsoft.com/config/ubuntu/22.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
sudo dpkg -i packages-microsoft-prod.deb
sudo apt-get update
sudo apt-get install -y dotnet-sdk-10.0
</code></pre>
<h4 id="éªè¯å®è£">éªè¯å®è£</h4>
<pre><code class="language-bash">dotnet --version
# åºæ¾ç¤º 10.x.x
</code></pre>
<h3 id="2-å®è£å¼åå·¥å·">2. å®è£å¼åå·¥å·</h3>
<h4 id="visual-studio-2026-æ¨è">Visual Studio 2026 (æ¨è)</h4>
<ul>
<li>ä¸è½½å°å: <a href="https://visualstudio.microsoft.com/vs/" target="_blank" rel="noopener nofollow">https://visualstudio.microsoft.com/vs/</a></li>
<li>éæ©å·¥ä½è´è½½ï¼<strong>ASP.NET å Web å¼å</strong></li>
</ul>
<h4 id="æè-visual-studio-code">æè Visual Studio Code</h4>
<pre><code class="language-bash"># Windows
winget install Microsoft.VisualStudioCode

# macOS
brew install --cask visual-studio-code

# Linux
sudo snap install code --classic
</code></pre>
<p>VS Codeå¿éæ©å±ï¼</p>
<pre><code class="language-bash">code --install-extension ms-dotnettools.csharp
code --install-extension ms-dotnettools.vscode-dotnet-runtime
</code></pre>
<h3 id="3-å®è£docker-desktop">3. å®è£Docker Desktop</h3>
<ul>
<li>ä¸è½½å°å: <a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener nofollow">https://www.docker.com/products/docker-desktop</a></li>
<li>å®è£åå¯å¨Docker Desktop</li>
</ul>
<p>éªè¯å®è£ï¼</p>
<pre><code class="language-bash">docker --version
</code></pre>
<h2 id="é¡¹ç®å¯å¨">é¡¹ç®å¯å¨</h2>
<h3 id="1-åéé¡¹ç®">1. åéé¡¹ç®</h3>
<pre><code class="language-bash">git clone https://gitee.com/magicodes/code-spirit.git
cd code-spirit
</code></pre>
<h3 id="2-å¯å¨åºç¡æå¡">2. å¯å¨åºç¡æå¡</h3>
<p>CodeSpiritä½¿ç¨Aspireèªå¨ç®¡çææä¾èµæå¡ï¼æ éæå¨å¯å¨Dockerå®¹å¨ï¼</p>
<pre><code class="language-bash"># Aspireä¼èªå¨å¯å¨ä»¥ä¸æå¡ï¼
# - MySQL/SQL Server (æ ¹æ®éç½®éæ©ï¼ç«¯å£: 3306/1433)
# - Redis (ç«¯å£: 6380)
# - RabbitMQ (ç«¯å£: 5672, ç®¡ççé¢: 15672)
# - GreptimeDB (ç«¯å£: 4000/4001)
# - Seqæ¥å¿æå¡ (ç«¯å£: 5341)
</code></pre>
<blockquote>
<p><strong>æå¡è¯´æ</strong>:</p>
<ul>
<li><strong>MySQL/SQL Server</strong>: ä¸»æ°æ®åºå­å¨ï¼æ ¹æ®DatabaseTypeéç½®éæ©ï¼</li>
<li><strong>Redis</strong>: ç¼å­åä¼è¯å­å¨ï¼ç«¯å£: 6380ï¼</li>
<li><strong>RabbitMQ</strong>: æ¶æ¯éåæå¡ï¼ç®¡ççé¢ç«¯å£: 15672ï¼</li>
<li><strong>GreptimeDB</strong>: æ¶åºæ°æ®åºï¼ç¨äºå®¡è®¡æ¥å¿å­å¨ï¼HTTPç«¯å£: 4000, gRPCç«¯å£: 4001ï¼</li>
<li><strong>Seq</strong>: ç»æåæ¥å¿æå¡ï¼ç«¯å£: 5341ï¼</li>
</ul>
</blockquote>
<h3 id="3-è¿è¡é¡¹ç®">3. è¿è¡é¡¹ç®</h3>
<h4 id="ä½¿ç¨net-aspireæ¨è">ä½¿ç¨.NET Aspireï¼æ¨èï¼</h4>
<pre><code class="language-bash"># è¿å¥AppHosté¡¹ç®ç®å½
cd Src/CodeSpirit.AppHost

# è¿è¡Aspireåºç¨
dotnet run
</code></pre>
<p>å¦ææ¯æ­£å¸¸å¯å¨ï¼å°çå°ä»¥ä¸ç¼¤çº·çæ§å¶å°è¾åºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224131931648-1820053723.png" alt="image" loading="lazy"></p>
<p>å¯å¨åè®¿é®ï¼</p>
<ul>
<li><strong>Aspire Dashboard</strong>: <a href="http://localhost:17109" target="_blank" rel="noopener nofollow">http://localhost:17109</a>ï¼èªå¨æå¼ï¼</li>
<li><strong>Webåºç¨</strong>: <a href="https://localhost:7120" target="_blank" rel="noopener nofollow">https://localhost:7120</a>ï¼å¯å¨åæ¾ç¤ºå·ä½ç«¯å£ï¼</li>
</ul>
<blockquote>
<p><strong>æ³¨æ</strong>:</p>
</blockquote>
<blockquote>
<ol>
<li>å®éç«¯å£å·å¯è½å ç³»ç»éç½®èå¼ï¼è¯·æ¥çAspire Dashboardè·ååç¡®çç«¯å£ä¿¡æ¯ã</li>
<li>å¦ä½ç»å½é¡µæ²¡ææ­£å¸¸åç°ï¼è¯·æç§ä¸é¢çå¿å¡«åæ°éç½®è¿è¡éç½®ã</li>
</ol>
</blockquote>
<h4 id="æèä½¿ç¨visual-studio">æèä½¿ç¨Visual Studio</h4>
<ol>
<li>
<p>æå¼ <code>CodeSpirit.sln</code></p>
</li>
<li>
<p>è®¾ç½® <code>CodeSpirit.AppHost</code> ä¸ºå¯å¨é¡¹ç®</p>
</li>
<li>
<p>æ F5 è¿è¡<br>
<img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224131917733-1101676572.png" alt="image" loading="lazy"><br>
æ³¨æï¼éç¡®ä¿ä»¥ä¸æå¡åæ­£å¸¸å¯å¨ï¼<br>
<img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224131931648-1820053723.png" alt="image" loading="lazy"></p>
</li>
</ol>
<h2 id="é¡¹ç®ç»æ">é¡¹ç®ç»æ</h2>
<p>CodeSpiritéç¨Clean Architectureè®¾è®¡ï¼é¡¹ç®ç»æå¦ä¸ï¼</p>
<pre><code>CodeSpirit/
âââ Src/
â   âââ ApiServices/                     # APIæå¡ï¼è§£å³æ¹æ¡æä»¶å¤¹ï¼
â   â   âââ CodeSpirit.IdentityApi/      # èº«ä»½è®¤è¯API
â   â   âââ CodeSpirit.ExamApi/          # èè¯ç³»ç»API  
â   â   âââ CodeSpirit.MessagingApi/     # æ¶æ¯æå¡API
â   â   âââ CodeSpirit.ConfigCenter/    # éç½®ä¸­å¿API
â   â   âââ CodeSpirit.FileStorageApi/  # æä»¶å­å¨API
â   â   âââ CodeSpirit.SurveyApi/        # é®å·è°æ¥API
â   â   âââ CodeSpirit.ApprovalApi/      # å®¡æ¹å·¥ä½æµAPI
â   â   âââ CodeSpirit.PathfinderApi/    # AIç®æ ç®¡çAPI
â   â   âââ CodeSpirit.AiCardsApi/       # AIå¡çAPI
â   âââ Components/                     # ç»ä»¶åº
â   â   âââ CodeSpirit.Aggregator/       # èåå¨ç»ä»¶
â   â   âââ CodeSpirit.AiFormFill/       # AIè¡¨åæºè½å¡«åç»ä»¶
â   â   âââ CodeSpirit.Amis/             # UIçæå¼æ
â   â   âââ CodeSpirit.Authorization/    # æéç»ä»¶
â   â   âââ CodeSpirit.Audit/            # å®¡è®¡ç»ä»¶
â   â   âââ CodeSpirit.Caching/          # åå¸å¼ç¼å­ç»ä»¶
â   â   âââ CodeSpirit.Charts/           # æºè½å¾è¡¨ç»ä»¶
â   â   âââ CodeSpirit.ConfigCenter.Client/ # éç½®ä¸­å¿å®¢æ·ç«¯
â   â   âââ CodeSpirit.LLM/              # å¤§è¯­è¨æ¨¡åç»ä»¶
â   â   âââ CodeSpirit.Messaging/        # æ¶æ¯éåç»ä»¶
â   â   âââ CodeSpirit.MultiTenant/      # å¤ç§æ·ç»ä»¶
â   â   âââ CodeSpirit.Navigation/       # å¯¼èªç»ä»¶
â   â   âââ CodeSpirit.PdfGeneration/    # PDFçæç»ä»¶
â   â   âââ CodeSpirit.ScheduledTasks/   # å®æ¶ä»»å¡ç»ä»¶
â   â   âââ CodeSpirit.Settings/         # è®¾ç½®ç®¡çç»ä»¶
â   â   âââ CodeSpirit.Shared/           # ç»ä»¶å±äº«åº
â   â   âââ CodeSpirit.UdlCards/         # UDLå¡çç»ä»¶
â   âââ CodeSpirit.AppHost/              # Aspireåºç¨å®¿ä¸»
â   âââ CodeSpirit.Core/                 # æ ¸å¿å®ä¹
â   âââ CodeSpirit.ServiceDefaults/      # æå¡é»è®¤éç½®
â   âââ CodeSpirit.Shared/               # å¨å±å±äº«åº
â   âââ CodeSpirit.Web/                  # Webåç«¯é¡¹ç®
âââ Tests/                               # æµè¯é¡¹ç®
âââ Docs/                                # é¡¹ç®ææ¡£
âââ k8s/                                 # Kubernetesé¨ç½²æä»¶
âââ CodeSpirit.sln                       # è§£å³æ¹æ¡æä»¶
</code></pre>
<h2 id="é»è®¤éç½®">é»è®¤éç½®</h2>
<p>é¡¹ç®ä½¿ç¨ä»¥ä¸é»è®¤éç½®ï¼ç±.NET Aspireèªå¨ç®¡çï¼</p>
<h3 id="æ°æ®åºè¿æ¥">æ°æ®åºè¿æ¥</h3>
<ul>
<li>
<p><strong>æ°æ®åºç±»å</strong>: æ¯æMySQLåSQL Serverä¸¤ç§æ°æ®åºï¼éè¿<code>DatabaseType</code>éç½®éæ©ï¼</p>
</li>
<li>
<p><strong>MySQL</strong>: ç«¯å£3306ï¼ç±Aspireèªå¨éç½®</p>
<p>å¯ä»¥ä»èµæºé¢æ¿è®¿é®ç®¡çUIï¼phpmyadminï¼ï¼<br>
<img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132002956-598129788.png" alt="image" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132042244-558588173.png" alt="image" loading="lazy"></p>
</li>
<li>
<p><strong>SQL Server</strong>: ç«¯å£1433ï¼ç±Aspireèªå¨éç½®</p>
</li>
<li>
<p><strong>æ°æ®åº</strong>: èªå¨åå»ºåè¿ç§»</p>
</li>
<li>
<p><strong>è¿æ¥å­ç¬¦ä¸²</strong>: ç±Aspireèªå¨ç®¡ç</p>
</li>
</ul>
<h3 id="ç¼å­åæ¶æ¯éå">ç¼å­åæ¶æ¯éå</h3>
<ul>
<li>
<p><strong>Redis</strong>: <code>localhost:6380</code>ï¼å·ä½è§ç®¡çUIï¼</p>
</li>
<li>
<p><strong>RabbitMQ</strong>: <code>localhost:5672</code> (ç®¡ççé¢: <a href="http://localhost:15672" target="_blank" rel="noopener nofollow">http://localhost:15672</a>, ç¨æ·å/å¯ç : admin/Password123)</p>
<p><img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132123458-1426760447.png" alt="image" loading="lazy"></p>
</li>
</ul>
<h3 id="å¶ä»æå¡ç«¯å£">å¶ä»æå¡ç«¯å£</h3>
<ul>
<li>
<p><strong>GreptimeDB</strong>:</p>
<ul>
<li>HTTPç«¯å£: <code>localhost:4000</code></li>
<li>gRPCç«¯å£: <code>localhost:4001</code></li>
<li>å¥åº·æ£æ¥: <a href="http://localhost:4000/health" target="_blank" rel="noopener nofollow">http://localhost:4000/health</a></li>
</ul>
</li>
<li>
<p><strong>Seqæ¥å¿æå¡</strong>: <code>localhost:5341</code>ï¼å·ä½ç«¯å£è§èµæºé¢æ¿ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132136208-2065968736.png" alt="image" loading="lazy"></p>
</li>
<li>
<p><strong>Redis Commander</strong>: éè¿Aspire Dashboardè®¿é®</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132147317-671812413.png" alt="image" loading="lazy"></p>
<h2 id="å¿å¡«åæ°éç½®">å¿å¡«åæ°éç½®</h2>
<p>CodeSpirit ä½¿ç¨ .NET Aspire çåæ°ç®¡çæºå¶æ¥éç½®ææä¿¡æ¯åç¯å¢ç¸å³åæ°ãå¨é¦æ¬¡å¯å¨åï¼æ¨éè¦éç½®ä»¥ä¸å¿å¡«åæ°ãæç¤ºUIå¦ä¸ï¼<br>
<img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132156259-1567610099.png" alt="image" loading="lazy"><br>
<img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132203941-1321498621.png" alt="image" loading="lazy"></p>
<h3 id="åæ°éç½®æ¹å¼">åæ°éç½®æ¹å¼</h3>
<p>Aspire æ¯æä¸¤ç§åæ°éç½®æ¹å¼ï¼éç½®ç³»ç»ä¼æä»¥ä¸ä¼åçº§è¯»åï¼é«ä¼åçº§ä¼è¦çä½ä¼åçº§ï¼ï¼</p>
<ol>
<li><strong>User Secrets</strong>ï¼å¼åç¯å¢æ¨èï¼é¿åæäº¤ææä¿¡æ¯å°ä»£ç åºï¼</li>
<li><strong>appsettings.json</strong>ï¼å¼åç¯å¢å¤éæ¹æ¡ï¼</li>
</ol>
<blockquote>
<p><strong>æç¤º</strong>: å¯¹äºææä¿¡æ¯ï¼å¦ API å¯é¥ï¼ï¼å¼ºçæ¨èä½¿ç¨ User Secretsï¼é¿åå°å¯é¥æäº¤å°ä»£ç åºã</p>
</blockquote>
<h3 id="å¿å¡«åæ°åè¡¨">å¿å¡«åæ°åè¡¨</h3>
<h4 id="llm-éç½®åæ°">LLM éç½®åæ°</h4>
<p>ä»¥ä¸åæ°ç¨äºéç½®éç¨ LLM æå¡ï¼å¦ AI å¡çãæºè½å®¡æ¹ç­åè½ï¼ï¼</p>
<table>
<thead>
<tr>
<th>åæ°åç§°</th>
<th>è¯´æ</th>
<th>æ¯å¦å¿å¡«</th>
<th>é»è®¤å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>llm-ApiKey</code></td>
<td>LLM APIå¯é¥</td>
<td>â <strong>å¿å¡«</strong></td>
<td>æ </td>
</tr>
<tr>
<td><code>llm-ApiBaseUrl</code></td>
<td>LLM APIåºç¡å°å</td>
<td>å¯é</td>
<td><code>https://dashscope.aliyuncs.com/compatible-mode/v1</code></td>
</tr>
<tr>
<td><code>llm-ModelName</code></td>
<td>LLMæ¨¡ååç§°</td>
<td>å¯é</td>
<td><code>qwen-flash</code></td>
</tr>
<tr>
<td><code>llm-TimeoutSeconds</code></td>
<td>è¯·æ±è¶æ¶æ¶é´ï¼ç§ï¼</td>
<td>å¯é</td>
<td><code>120</code></td>
</tr>
<tr>
<td><code>llm-MaxTokens</code></td>
<td>æå¤§Tokenæ°</td>
<td>å¯é</td>
<td><code>2048</code></td>
</tr>
<tr>
<td><code>llm-UseProxy</code></td>
<td>æ¯å¦ä½¿ç¨ä»£ç</td>
<td>å¯é</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>llm-ProxyAddress</code></td>
<td>ä»£çå°å</td>
<td>å¯é</td>
<td>ç©ºå­ç¬¦ä¸²</td>
</tr>
</tbody>
</table>
<h4 id="aiè¡¨åå¡«å-llm-éç½®åæ°">AIè¡¨åå¡«å LLM éç½®åæ°</h4>
<p>ä»¥ä¸åæ°ç¨äºéç½® AI è¡¨åæºè½å¡«ååè½ï¼</p>
<table>
<thead>
<tr>
<th>åæ°åç§°</th>
<th>è¯´æ</th>
<th>æ¯å¦å¿å¡«</th>
<th>é»è®¤å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ai-form-fill-llm-ApiKey</code></td>
<td>AIè¡¨åå¡«åLLM APIå¯é¥</td>
<td>â <strong>å¿å¡«</strong></td>
<td>æ </td>
</tr>
<tr>
<td><code>ai-form-fill-llm-ApiBaseUrl</code></td>
<td>APIåºç¡å°å</td>
<td>å¯é</td>
<td><code>https://dashscope.aliyuncs.com/compatible-mode/v1</code></td>
</tr>
<tr>
<td><code>ai-form-fill-llm-ModelName</code></td>
<td>æ¨¡ååç§°</td>
<td>å¯é</td>
<td><code>qwen3-max-preview</code></td>
</tr>
<tr>
<td><code>ai-form-fill-llm-DisableThinking</code></td>
<td>ç¦ç¨æèæ¨¡å¼</td>
<td>å¯é</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>ai-form-fill-llm-ResponseFormatType</code></td>
<td>ååºæ ¼å¼ç±»å</td>
<td>å¯é</td>
<td><code>json_object</code></td>
</tr>
<tr>
<td><code>ai-form-fill-llm-Temperature</code></td>
<td>æ¸©åº¦åæ°</td>
<td>å¯é</td>
<td><code>0.1</code></td>
</tr>
<tr>
<td><code>ai-form-fill-llm-TopP</code></td>
<td>TopPåæ°</td>
<td>å¯é</td>
<td><code>0.9</code></td>
</tr>
<tr>
<td><code>ai-form-fill-llm-EnableStreaming</code></td>
<td>å¯ç¨æµå¼ååº</td>
<td>å¯é</td>
<td><code>true</code></td>
</tr>
</tbody>
</table>
<h4 id="å¶ä»å¯éåæ°">å¶ä»å¯éåæ°</h4>
<p>ä»¥ä¸åæ°å·²æé»è®¤å¼ï¼éå¸¸æ éä¿®æ¹ï¼</p>
<table>
<thead>
<tr>
<th>åæ°åç§°</th>
<th>è¯´æ</th>
<th>é»è®¤å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jwt-SecretKey</code></td>
<td>JWTå¯é¥</td>
<td><code>ECBF8FA013844D77AE041A6800D7FF8F</code></td>
</tr>
<tr>
<td><code>jwt-Issuer</code></td>
<td>JWTé¢åè</td>
<td><code>codespirit.com</code></td>
</tr>
<tr>
<td><code>jwt-Audience</code></td>
<td>JWTåä¼</td>
<td><code>CodeSpirit</code></td>
</tr>
<tr>
<td><code>mysql-password</code></td>
<td>MySQLå¯ç </td>
<td><code>Password123</code></td>
</tr>
<tr>
<td><code>sqlserver-password</code></td>
<td>SQL Serverå¯ç </td>
<td><code>P@ssword123456</code></td>
</tr>
<tr>
<td><code>rabbitmq-username</code></td>
<td>RabbitMQç¨æ·å</td>
<td><code>admin</code></td>
</tr>
<tr>
<td><code>rabbitmq-password</code></td>
<td>RabbitMQå¯ç </td>
<td><code>Password123</code></td>
</tr>
</tbody>
</table>
<h3 id="éç½®æ¹æ³">éç½®æ¹æ³</h3>
<h4 id="æ¹æ³ä¸ä½¿ç¨-user-secretsæ¨èå¼åç¯å¢">æ¹æ³ä¸ï¼ä½¿ç¨ User Secretsï¼æ¨èå¼åç¯å¢ï¼</h4>
<p>ä½¿ç¨ .NET User Secrets å¯ä»¥å®å¨å°å­å¨ææä¿¡æ¯ï¼æ éæå¿æäº¤å°ä»£ç åºï¼</p>
<pre><code class="language-bash"># è¿å¥ AppHost é¡¹ç®ç®å½
cd Src/CodeSpirit.AppHost

# åå§å User Secretsï¼å¦æå°æªåå§åï¼
dotnet user-secrets init

# è®¾ç½® LLM API å¯é¥
dotnet user-secrets set "llm-ApiKey" "your-llm-api-key-here"

# è®¾ç½® AI è¡¨åå¡«å LLM API å¯é¥
dotnet user-secrets set "ai-form-fill-llm-ApiKey" "your-ai-form-fill-llm-api-key-here"

# æ¸é¤ææå¯é¥
# dotnet user-secrets clear
</code></pre>
<h4 id="æ¹æ³äºä½¿ç¨-appsettingsjsonå¼åç¯å¢å¤é">æ¹æ³äºï¼ä½¿ç¨ appsettings.jsonï¼å¼åç¯å¢å¤éï¼</h4>
<p>ç¼è¾ <code>Src/CodeSpirit.AppHost/appsettings.json</code> æä»¶ï¼æ·»å åæ°éç½®ï¼</p>
<pre><code class="language-json">{
  "DatabaseType": "MySql",
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Aspire.Hosting.Dcp": "Warning"
    }
  },
  "llm-ApiKey": "your-llm-api-key-here",
  "ai-form-fill-llm-ApiKey": "your-ai-form-fill-llm-api-key-here"
}
</code></pre>
<blockquote>
<p><strong>â ï¸ éè¦æç¤º</strong>:</p>
<ul>
<li>å¦æä½¿ç¨ <code>appsettings.json</code> éç½®ææä¿¡æ¯ï¼è¯·ç¡®ä¿è¯¥æä»¶å·²æ·»å å° <code>.gitignore</code> ä¸­</li>
<li>æèåå»º <code>appsettings.Local.json</code> æä»¶ï¼è¯¥æä»¶é»è®¤å·²å¨ <code>.gitignore</code> ä¸­ï¼ï¼é¿åå° API å¯é¥æäº¤å°ä»£ç åº</li>
<li><strong>å¼ºçæ¨èä½¿ç¨ User Secrets æ¹å¼</strong>ï¼æ´å®å¨ä¸ä¸ä¼è¯¯æäº¤</li>
</ul>
</blockquote>
<h3 id="è·å-api-å¯é¥">è·å API å¯é¥</h3>
<h4 id="é¿éäºéä¹åé®dashscope">é¿éäºéä¹åé®ï¼DashScopeï¼</h4>
<p>å¼åé¶æ®µåè´¹é¢åº¦å®å¨å¤ç¨ï¼</p>
<ol>
<li>è®¿é® <a href="https://www.aliyun.com/benefit?userCode=nw99vwgt" target="_blank" rel="noopener nofollow">é¿éäº DashScope</a></li>
<li>æ³¨å/ç»å½è´¦å·</li>
<li>åå»º API Key</li>
<li>å° API Key éç½®å°ä¸è¿°åæ°ä¸­</li>
</ol>
<blockquote>
<p>ð¡ <strong>æ¨èéè¯»</strong>ï¼<a href="./%E9%98%BF%E9%87%8C%E4%BA%91%E9%80%9A%E4%B9%89%E5%8D%83%E9%97%AE%E5%85%8D%E8%B4%B9%E4%BD%93%E9%AA%8C%E6%8C%87%E5%8D%97.md" target="_blank" rel="noopener nofollow">é¿éäºéä¹åé®åè´¹ä½éªæå</a> - è¯¦ç»çæ³¨åæåãéç½®æç¨åææ¬åæï¼å¸®å©æ¨é¶ææ¬ä½éª CodeSpirit çå¼ºå¤§ AI è½åï¼</p>
</blockquote>
<h4 id="openaiå¦ä½¿ç¨-openai-å¼å®¹æ¥å£">OpenAIï¼å¦ä½¿ç¨ OpenAI å¼å®¹æ¥å£ï¼</h4>
<p>å¦æä½¿ç¨ OpenAI å¼å®¹ç API æå¡ï¼éè¦ä¿®æ¹ä»¥ä¸åæ°ï¼</p>
<p>ä½¿ç¨ User Secrets éç½®ï¼</p>
<pre><code class="language-bash">dotnet user-secrets set "llm-ApiBaseUrl" "https://api.openai.com/v1"
dotnet user-secrets set "llm-ModelName" "gpt-4"
dotnet user-secrets set "llm-ApiKey" "your-openai-api-key-here"
</code></pre>
<p>æä½¿ç¨ appsettings.json éç½®ï¼</p>
<pre><code class="language-json">{
  "llm-ApiBaseUrl": "https://api.openai.com/v1",
  "llm-ModelName": "gpt-4",
  "llm-ApiKey": "your-openai-api-key-here"
}
</code></pre>
<h3 id="éªè¯åæ°éç½®">éªè¯åæ°éç½®</h3>
<p>å¯å¨é¡¹ç®åï¼å¦æåæ°éç½®ä¸æ­£ç¡®ï¼æ¨ä¼å¨æ§å¶å°æ Aspire Dashboard ä¸­çå°ç¸å³éè¯¯ä¿¡æ¯ãç¡®ä¿ä»¥ä¸æå¡è½å¤æ­£å¸¸å¯å¨ï¼</p>
<ul>
<li>â ConfigCenterï¼éç½®ä¸­å¿ï¼- éè¦ LLM åæ°</li>
<li>â Web åç«¯ - éè¦ AI è¡¨åå¡«å LLM åæ°</li>
</ul>
<blockquote>
<p><strong>æç¤º</strong>: å¦æææ¶ä¸éè¦ä½¿ç¨ AI åè½ï¼å¯ä»¥è®¾ç½®ä¸ä¸ªå ä½ç¬¦å¼ï¼ä½æäºä¾èµ AI çåè½å°æ æ³æ­£å¸¸å·¥ä½ã</p>
</blockquote>
<h2 id="å¼åå·¥å·éç½®">å¼åå·¥å·éç½®</h2>
<h3 id="visual-studio-code">Visual Studio Code</h3>
<p>åå»º <code>.vscode/launch.json</code>ï¼</p>
<pre><code class="language-json">{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch CodeSpirit",
      "type": "coreclr",
      "request": "launch",
      "preLaunchTask": "build",
      "program": "${workspaceFolder}/Src/CodeSpirit.AppHost/bin/Debug/net10.0/CodeSpirit.AppHost.dll",
      "cwd": "${workspaceFolder}/Src/CodeSpirit.AppHost",
      "env": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  ]
}
</code></pre>
<p>åå»º <code>.vscode/tasks.json</code>ï¼</p>
<pre><code class="language-json">{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "build",
      "command": "dotnet",
      "type": "process",
      "args": ["build", "${workspaceFolder}/CodeSpirit.sln"],
      "problemMatcher": "$msCompile"
    }
  ]
}
</code></pre>
<h2 id="éªè¯å®è£-1">éªè¯å®è£</h2>
<h3 id="1-æ£æ¥æå¡ç¶æ">1. æ£æ¥æå¡ç¶æ</h3>
<p>è®¿é®Aspire Dashboard (<a href="http://localhost:17109" target="_blank" rel="noopener nofollow">http://localhost:17109</a>) ç¡®è®¤æææå¡æ­£å¸¸è¿è¡ï¼</p>
<ul>
<li>â CodeSpirit.Web (Webåç«¯)</li>
<li>â CodeSpirit.IdentityApi (èº«ä»½è®¤è¯)</li>
<li>â CodeSpirit.ConfigCenter (éç½®ä¸­å¿)</li>
<li>â CodeSpirit.MessagingApi (æ¶æ¯æå¡)</li>
<li>â CodeSpirit.ExamApi (èè¯ç³»ç»)</li>
<li>â CodeSpirit.FileStorageApi (æä»¶å­å¨)</li>
<li>â CodeSpirit.SurveyApi (é®å·è°æ¥)</li>
<li>â CodeSpirit.ApprovalApi (å®¡æ¹æµç¨)</li>
<li>â CodeSpirit.PathfinderApi (AIç®æ ç®¡ç)</li>
<li>â MySQL/SQL Server (æ°æ®åºï¼æ ¹æ®éç½®)</li>
<li>â Redis (ç¼å­)</li>
<li>â RabbitMQ (æ¶æ¯éå)</li>
<li>â GreptimeDB (æ¶åºæ°æ®åº)</li>
<li>â Seq (æ¥å¿æå¡)</li>
</ul>
<h3 id="2-æ£æ¥éè¯¯">2. æ£æ¥éè¯¯</h3>
<p>æå¼ç»æåæ¥å¿é¢æ¿ï¼æ£æ¥æ¯å¦å­å¨éè¯¯ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132237841-409615542.png" alt="image" loading="lazy"></p>
<h3 id="3-è®¿é®webçé¢">3. è®¿é®Webçé¢</h3>
<p>ç³»ç»å¹³å°ï¼<a href="https://localhost:7120" target="_blank" rel="noopener nofollow">https://localhost:7120</a></p>
<p>è´¦å·ï¼systemadmin</p>
<p>å¯ç ï¼CodeSpirit@2025</p>
<p><img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132247398-182230200.png" alt="image" loading="lazy"></p>
<p>ç»å½åå¯ä»¥çå°ç³»ç»å¹³å°åå°ç®¡çUIï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132258347-1684698426.png" alt="image" loading="lazy"></p>
<p>ç§æ·å¹³å°ï¼é»è®¤ç§æ·ï¼ï¼<a href="https://localhost:7120/default/login" target="_blank" rel="noopener nofollow">https://localhost:7120/default/login</a></p>
<p>è´¦å·ï¼admin</p>
<p>å¯ç ï¼123@Admin</p>
<p><img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132312276-873776487.png" alt="image" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132320900-136012642.png" alt="image" loading="lazy"></p>
<h2 id="å¸¸è§é®é¢">å¸¸è§é®é¢</h2>
<h3 id="æ æ³æå¼ç½é¡µ">æ æ³æå¼ç½é¡µ</h3>
<p>ä¸è¬æ¯ä»¥ä¸æåµå¯¼è´ï¼</p>
<ol>
<li>
<p>éåæ æ³æåï¼ä¸è¬å¨dockeré¢æ¿æAspireç®¡çé¢æ¿çæ¥å¿ä¸­å¯ä»¥çå°ãå»ºè®®éç½®éåæºæè·¯ç±ä¸ç½ã</p>
</li>
<li>
<p>å³é®æå¡æéï¼æ¯å¦Webæå¡åºç°æéã</p>
</li>
<li>
<p>ç«¯å£å²çªæç½ç»éè¯¯ï¼å·ä½å¯ä»¥çå¯å¨æ§å¶å°éè¯¯ï¼</p>
</li>
</ol>
<p><img src="https://img2024.cnblogs.com/blog/70544/202512/70544-20251224132339285-1584044125.png" alt="image" loading="lazy"></p>
<h3 id="ç«¯å£å²çª">ç«¯å£å²çª</h3>
<p>å¦æéå°ç«¯å£å²çªï¼ä¿®æ¹ <code>Src/CodeSpirit.AppHost/Program.cs</code> ä¸­çç«¯å£éç½®ã</p>
<h3 id="dockeræå¡å¯å¨å¤±è´¥">Dockeræå¡å¯å¨å¤±è´¥</h3>
<p>ç±äºé¡¹ç®ä½¿ç¨.NET Aspireç®¡çæå¡ï¼å¦æéå°æå¡å¯å¨é®é¢ï¼</p>
<pre><code class="language-bash"># éå¯Aspireåºç¨
cd Src/CodeSpirit.AppHost
dotnet run --force

# æ¥çAspire Dashboardä¸­çæå¡ç¶æ
# è®¿é® http://localhost:17109
</code></pre>
<h3 id="greptimedbå¯å¨å¤±è´¥">GreptimeDBå¯å¨å¤±è´¥</h3>
<pre><code class="language-bash"># å¨Aspire Dashboardä¸­æ¥çGreptimeDBç¶æ
# å¦æåå­ä¸è¶³ï¼å¯ä»¥å¨Program.csä¸­è°æ´GreptimeDBéç½®

# æ£æ¥ç³»ç»èµæºä½¿ç¨æåµ
# GreptimeDBéè¦è³å°512MBåå­
</code></pre>
<h3 id="sslè¯ä¹¦é®é¢">SSLè¯ä¹¦é®é¢</h3>
<pre><code class="language-bash"># ä¿¡ä»»å¼åè¯ä¹¦
dotnet dev-certs https --trust
</code></pre>
<h3 id="æ°æ®åºè¿æ¥é®é¢">æ°æ®åºè¿æ¥é®é¢</h3>
<pre><code class="language-bash"># æ£æ¥æ°æ®åºå®¹å¨ç¶æï¼æ ¹æ®éç½®çæ°æ®åºç±»åï¼
docker ps | grep mysql    # MySQL
docker ps | grep sqlserver # SQL Server

# éå¯æ°æ®åºå®¹å¨
docker restart mysql      # MySQL
docker restart sqlserver  # SQL Server

# æå¨Aspire Dashboardä¸­æ¥çæ°æ®åºç¶æåè¿æ¥ä¿¡æ¯
</code></pre>
<h3 id="åå­ä¸è¶³é®é¢">åå­ä¸è¶³é®é¢</h3>
<p>å¦æç³»ç»åå­ä¸è¶³ï¼å¯ä»¥ï¼</p>
<ol>
<li>å³é­ä¸å¿è¦çåºç¨ç¨åº</li>
<li>è°æ´GreptimeDBåå­è®¾ç½®ï¼å¨Program.csä¸­ï¼</li>
<li>èèåçº§ç³»ç»åå­å°æ¨èéç½®ï¼16GBæ¨èï¼32GBæ´ä½³ï¼</li>
</ol>
<h3 id="llm-api-å¯é¥æªéç½®">LLM API å¯é¥æªéç½®</h3>
<p>å¦æå¯å¨æ¶éå°ä»¥ä¸éè¯¯ææå¡æ æ³æ­£å¸¸å¯å¨ï¼</p>
<ul>
<li>ConfigCenter æå¡å¯å¨å¤±è´¥</li>
<li>Web åç«¯æ æ³è®¿é® AI åè½</li>
<li>æ§å¶å°æç¤ºç¼ºå° LLM éç½®åæ°</li>
</ul>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ol>
<li>
<p><strong>æ£æ¥åæ°æ¯å¦å·²éç½®</strong>ï¼</p>
<pre><code class="language-bash"># æ¥ç User Secretsï¼å¦æä½¿ç¨ï¼
cd Src/CodeSpirit.AppHost
dotnet user-secrets list
</code></pre>
</li>
<li>
<p><strong>éç½®ç¼ºå¤±çåæ°</strong>ï¼</p>
<ul>
<li>åè <a href="#%E5%BF%85%E5%A1%AB%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE" rel="noopener nofollow">å¿å¡«åæ°éç½®</a> ç« è</li>
<li>ç¡®ä¿è³å°éç½®äº <code>llm-ApiKey</code> å <code>ai-form-fill-llm-ApiKey</code> ä¸¤ä¸ªå¿å¡«åæ°</li>
</ul>
</li>
<li>
<p><strong>éªè¯éç½®</strong>ï¼</p>
<ul>
<li>éå¯åºç¨åï¼æ£æ¥ Aspire Dashboard ä¸­çæå¡ç¶æ</li>
<li>æ¥çæå¡æ¥å¿ç¡®è®¤åæ°æ¯å¦æ­£ç¡®å è½½</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>æç¤º</strong>: å¦æææ¶ä¸éè¦ä½¿ç¨ AI åè½ï¼å¯ä»¥è®¾ç½®å ä½ç¬¦å¼ï¼å¦ <code>placeholder-key</code>ï¼ï¼ä½ç¸å³ AI åè½å°æ æ³æ­£å¸¸å·¥ä½ã</p>
</blockquote>
<h2 id="å¼åæ¨¡å¼">å¼åæ¨¡å¼</h2>
<h3 id="ç­éè½½å¼å">ç­éè½½å¼å</h3>
<pre><code class="language-bash"># å¯ç¨ç­éè½½
cd Src/CodeSpirit.AppHost
dotnet watch run
</code></pre>
<h3 id="è°è¯æ¨¡å¼">è°è¯æ¨¡å¼</h3>
<p>å¨Visual StudioæVS Codeä¸­è®¾ç½®æ­ç¹ï¼æF5å¯å¨è°è¯ã</p>
<h2 id="çäº§ç¯å¢é¨ç½²">çäº§ç¯å¢é¨ç½²</h2>
<h3 id="ä½¿ç¨kubernetesé¨ç½²">ä½¿ç¨Kubernetesé¨ç½²</h3>
<p>é¡¹ç®æä¾äºå®æ´çKubernetesé¨ç½²æä»¶ï¼</p>
<pre><code class="language-bash"># é¨ç½²å°Kuberneteséç¾¤
kubectl apply -f k8s/

# æ¥çé¨ç½²ç¶æ
kubectl get pods -n code-spirit-release
</code></pre>
<h3 id="ä½¿ç¨dockeré¨ç½²">ä½¿ç¨Dockeré¨ç½²</h3>
<pre><code class="language-bash"># æå»ºæææå¡çDockeréå
dotnet publish CodeSpirit.sln -c Release

# ä½¿ç¨é¡¹ç®æä¾çDockerfileæå»ºéå
docker build -f Src/CodeSpirit.Web/Dockerfile -t codespirit-web:latest .
docker build -f Src/CodeSpirit.IdentityApi/Dockerfile -t codespirit-identity:latest .
</code></pre>
<h3 id="éç½®ç®¡ç">éç½®ç®¡ç</h3>
<p>çäº§ç¯å¢éç½®éè¿ä»¥ä¸æ¹å¼ç®¡çï¼</p>
<ul>
<li><strong>Kubernetes ConfigMap</strong>: å­å¨åºç¨éç½®</li>
<li><strong>Kubernetes Secret</strong>: å­å¨ææä¿¡æ¯</li>
<li><strong>éç½®ä¸­å¿</strong>: å¨æéç½®ç®¡ç</li>
</ul>
<h2 id="ä¸ä¸æ­¥">ä¸ä¸æ­¥</h2>
<p>ç¯å¢æ­å»ºå®æåï¼æ¨å¯ä»¥ï¼</p>
<ol>
<li>ð éè¯» <a href="./%E9%A1%B9%E7%9B%AE%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.md" target="_blank" rel="noopener nofollow">é¡¹ç®æ´ä½æ¶æè®¾è®¡</a></li>
<li>ð§ äºè§£ <a href="./CodeSpirit.Core%E6%A0%B8%E5%BF%83%E6%A1%86%E6%9E%B6.md" target="_blank" rel="noopener nofollow">CodeSpirit.Coreæ ¸å¿æ¡æ¶</a></li>
<li>ð æ¥ç <a href="./%E6%80%BB%E4%BD%93%E6%8A%80%E6%9C%AF%E4%BD%93%E7%B3%BB%E8%AF%B4%E6%98%8E.md" target="_blank" rel="noopener nofollow">æ»ä½ææ¯ä½ç³»è¯´æ</a></li>
<li>ð å­¦ä¹  <a href="./CodeSpirit%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%8C%87%E5%8D%97.md" target="_blank" rel="noopener nofollow">ç»ä¸å¼å¸¸å¤çæå</a></li>
<li>ð» åè <a href="./CRUD%E5%BC%80%E5%8F%91%E7%A4%BA%E4%BE%8B.md" target="_blank" rel="noopener nofollow">CRUDå¼åç¤ºä¾</a> å¼å§å¼å</li>
</ol>
<h2 id="è·åå¸®å©">è·åå¸®å©</h2>
<p>å¦æéå°é®é¢ï¼è¯·åèï¼</p>
<ul>
<li><a href="https://github.com/your-org/code-spirit/issues" target="_blank" rel="noopener nofollow">GitHub Issues</a></li>
<li><a href="https://github.com/your-org/code-spirit/wiki" target="_blank" rel="noopener nofollow">é¡¹ç®Wiki</a></li>
<li><a href="https://github.com/your-org/code-spirit/discussions" target="_blank" rel="noopener nofollow">è®¨è®ºåº</a></li>
</ul>
<p>ç¥æ¨å¼åæå¿«ï¼ð</p>

</div>
<div id="MySignature" role="contentinfo">
    ä½èï¼<a href="http://www.cnblogs.com/codelove/" target="_blank">éªé</a><br>åºå¤ï¼<a href="http://www.cnblogs.com/codelove/" target="_blank">http://www.cnblogs.com/codelove/</a>
<br>å¦æåæ¬¢ä½èçæç« ï¼è¯·å³æ³¨ãCodeSpirit-ç çµãå¬ä¼å·ä»¥ä¾¿ç¬¬ä¸æ¶é´è·å¾ææ°åå®¹ãæ¬æçæå½ä½èææï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»ä¿çæ­¤æ®µå£°æï¼ä¸å¨æç« é¡µé¢ææ¾ä½ç½®ç»åºåæè¿æ¥ï¼å¦åä¿çè¿½ç©¶æ³å¾è´£ä»»çæå©ã<br><b>éå¬é¸è¯­è±é¦ï¼æ¼«èµäºå·äºèã</b>
<br>
<img src="https://images.cnblogs.com/cnblogs_com/codelove/315887/o_251224070213_%E5%85%AC%E4%BC%97%E5%8F%B7.jpg" width="100" height="100">
</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-29 15:08">2025-12-29 15:07</span>&nbsp;
<a href="https://www.cnblogs.com/codelove">éªé</a>&nbsp;
éè¯»(<span id="post_view_count">137</span>)&nbsp;
è¯è®º(<span id="post_comment_count">2</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19392132);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19392132', targetLink: 'https://www.cnblogs.com/codelove/p/19392132', title: 'CodeSpirit å¼åç¯å¢æ­å»ºåå¯å¨æå' })">ä¸¾æ¥</a>
</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ°çMOSï¼My Oracle Supportï¼ä¸»è¦åå ]]></title>
    <link>https://www.cnblogs.com/jyzhao/p/19415968/xin-banmosmy-oracle-support-zhu-yao-bian-hua</link>
    <guid>d1cc4f63ff929d5583c419ed845a7d85</guid>
    <description>
    <![CDATA[ 
    <a name="top"></a>
    <h2><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jyzhao/p/19415968/xin-banmosmy-oracle-support-zhu-yao-bian-hua" title="åå¸äº 2025-12-29 15:01">
    <span role="heading" aria-level="2">æ°çMOSï¼My Oracle Supportï¼ä¸»è¦åå</span>
    

</a>
</h2>
    <small>
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-29 15:01">2025-12-29 15:01</span>&nbsp;
<a href="https://www.cnblogs.com/jyzhao">AlfredZhao</a>&nbsp;
éè¯»(<span id="post_view_count">63</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19415968);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19415968', targetLink: 'https://www.cnblogs.com/jyzhao/p/19415968/xin-banmosmy-oracle-support-zhu-yao-bian-hua', title: 'æ°çMOSï¼My Oracle Supportï¼ä¸»è¦åå' })">ä¸¾æ¥</a>
</small>
    <div class="entry">
        <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ¬æ My Oracle Support åäºå¨é¢çåçº§ãOracle ç¡¬ä»¶ãè½¯ä»¶åæç®¡äºæå¡çæ¯æä¹å¨é¨è¿ç§»è³å¨æ°çæ¯æå¹³å°ãææ SR çåå»ºãæ´æ°ä¸ç®¡çæä½ä¹é½å°å¨è¿ä¸æ°å¹³å°ä¸å®æï¼åæ¥çç³»ç»å°ä¸åä½¿ç¨ã</p>
<p>å³äºæ°çMOSï¼å¾å¤æ©å·²çæå¤å¹´èçæ¬MOSçä»ä¸èæäºæå¿ï¼å®éä¸ï¼æ°çå¹¶æ²¡æå¢å ä»»ä½ä½¿ç¨é¾åº¦ï¼åèæ¯æå¤§å°éä½äºMOSä½¿ç¨é¨æ§ã</p>
<p>ä½è¿æ¯æä¸äºä¼åé¡¹å¯è½ä¼è®©èç¨æ·å¨åå¼å§æ¥è§¦æ°ççæ¶åæäºéçï¼è¿éååºæ¥è®©å¤§å®¶æåæ³¨æä¸ï¼åå°å¿ä¸­ææ°ï¼</p>
<h2 id="01--mosç¥è¯åºä¸­çæç« å·å½åé£æ ¼æ¹å">01 | MOSç¥è¯åºä¸­çæç« å·å½åé£æ ¼æ¹å</h2>
<p>æ°çæ¯<code>KB+ä¸ç»æ°å­</code>ï¼æ§çæ¯<code>æ°å­.æ°å­</code>æ ¼å¼ã</p>
<p>ä½æ¯ç¬èäº²æµå¯¹äºæäºæ¯è¾å¸¸ç¨çææ¡£æ¯å¯ä»¥éè¿æ§çæç´¢å°çï¼ä½è¿æ¯å»ºè®®çææ°ççå½åé£æ ¼ã</p>
<p>æ¯å¦çæExadataçå°ä¼ä¼´é½è³çè½è¯¦çä¸ç¯ææ¡£å·ï¼<code>888828.1</code></p>
<p>å¨æ°çæç´¢ä¹è½æ£ç´¢å°ï¼æ°çç»å®çç¼å·å°±æ¯ <code>KB153930</code></p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202512/635610-20251229150101685-1968954989.jpg" alt="" loading="lazy"></p>
<p>æå¼åï¼ä¹å¯ä»¥çå°éé¢ä¼è¯´æå°±æ¯å¯¹åºä¹åç 888828.1ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202512/635610-20251229150101698-2096446677.jpg" alt="" loading="lazy"></p>
<h2 id="02--mosä¸è½½è¡¥ä¸å¥å£æ´å ä¾¿å©">02 | MOSä¸è½½è¡¥ä¸å¥å£æ´å ä¾¿å©</h2>
<p>ä¹åç³»ç»ä¸è½½è¡¥ä¸ä»è´¨æ¶ï¼å¾å¤æ°æçè³é½æ¾ä¸å°åéçå¥å£ãç°å¨æ°çåå¾éå¸¸ç®åï¼å¨ä¸»é¡µé¢è¿éçæç´¢æ¡ç´æ¥éæ©è¡¥ä¸è¿ä¸ªåç±»ã</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202512/635610-20251229150101696-686065035.jpg" alt="" loading="lazy"></p>
<p>å°±ä¼å¼¹åºçªå£ï¼å¯ä»¥æéè¾å¥æéè¡¥ä¸ä¿¡æ¯ï¼Applyå³å¯çå°å¯¹åºçå¥å£ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202512/635610-20251229150101584-539479973.jpg" alt="" loading="lazy"></p>
<h2 id="03--sråç¼æ°å­æ¹åä¸º4-å¼å¤´">03 | SRåç¼æ°å­æ¹åä¸º4-å¼å¤´</h2>
<p>ä¹åçSRå·ç é½æ¯<code>3-</code>å¼å¤´å ä¸æ®µæ°å­ï¼ç°å¨æ¯<code>4-</code>å¼å¤´å ä¸æ®µæ°å­ï¼å ä¸ºç¬èçè´¦å·æ²¡æåå»ºä»»ä½SRï¼æä»¥çä¸å°è¿ä¸ªååãæè½çSRæéçå°ä¼ä¼´å¯ä»¥å¸®å¿ç¡®è®¤ä¸ï¼æ¬¢è¿çè¨ã</p>
<h2 id="04--ä¿®æ¹è´¦æ·ä¿¡æ¯æ¶éæ³¨æå®å¨pin">04 | ä¿®æ¹è´¦æ·ä¿¡æ¯æ¶éæ³¨æå®å¨PIN</h2>
<p>å¨ è´¦æ· -&gt; é¦éé¡¹ä¸é¢ï¼å¡«åè´¦å·ä¿¡æ¯æ¶ï¼æä¸ä¸ª <code>å®å¨PIN</code> æ®è¯´å¨SRçµè¯æ²éè¿ç¨ä¸­ï¼åå°ä¼è¦æ±ä½ æä¾è¿ä¸ªç æå¯ä»¥ãè¿æ¯ä¸ä¸ªå å¼ºå®å¨æ§çèèãç¬èæ²¡æè¿ä¸ªéæ±ï¼æè¿ä¸ªéæ±çå°ä¼ä¼´ä¹å¯ä»¥å¸®å¿ç¡®è®¤ä¸äºå®æ¯å¦å¦æ­¤ã</p>
<p>å¦å¤ï¼ååå·¥ç¨å¸ä¸ºæ­¤ä¸é¨å½å¶è¿ä¸æ®µè¯¦ç»çä¸­æä»ç»è§é¢ï¼æå´è¶£çåå­¦å¯ä»¥ç´æ¥ç»å½æ°çMOSï¼æç´¢ <code>KB822414</code> çå°è¿ç¯ä¸­æçæç« åè§é¢ã</p>
<p>å ä¸ºè¿æ¯ä¸ç¯ä¸­æçææ¡£ï¼å¦æé»è®¤æ¥ä¸å°ï¼æ³¨ææç´¢è¯­è¨åæ¢æä¸­æå³å¯ã</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202512/635610-20251229150101687-372899130.jpg" alt="" loading="lazy"></p>

</div>
<div id="MySignature" role="contentinfo">
    <a href="https://www.cnblogs.com/jyzhao/" target="_blank">AlfredZhao</a>Â©çæææãä»Oracleèµ·èªï¼é¢ç¥ç²¾å½©çITææ¯ãã<br>
è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/jyzhao/p/19415968/xin-banmosmy-oracle-support-zhu-yao-bian-hua" target="_blank">https://www.cnblogs.com/jyzhao/p/19415968/xin-banmosmy-oracle-support-zhu-yao-bian-hua</a>
<hr>
<div style="text-align:center; margin-top:30px;">
  <p style="font-size:14px;color:#555;">
    ð æè°¢éè¯»ï¼æ¬¢è¿å³æ³¨æçå¬ä¼å· <b>ãèµµéå®ã</b>
  </p>
  <img src="https://images.cnblogs.com/cnblogs_com/jyzhao/824234/o_250208075013_qrcode-zjy.jpg" width="160" style="border:1px solid #ddd;border-radius:8px;">
</div>
</div>
<div class="clear"></div>

        <div class="clear"></div>
        
</div>
    <ul class="postmetadata">
        <vc:categories-tags blog-app="jyzhao" blog-id="186567" post-id="19415968"></vc:categories-tags>
    </ul>
 ]]>
    </description>
    </item>
        </channel>
        </rss>