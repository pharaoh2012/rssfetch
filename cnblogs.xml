<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-12T20:30:37.921Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ Lab4-Lab: traps && MIT6.1810æä½ç³»ç»å·¥ç¨ãæç»­æ´æ°ã _ ]]></title>
    <link>https://www.cnblogs.com/xiaobai1523/p/19610063</link>
    <guid>9b1f39accf420e5d9df167c15caac71e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaobai1523/p/19610063" title="åå¸äº 2026-02-12 23:12">
    <span role="heading" aria-level="2">Lab4-Lab: traps &amp;&amp; MIT6.1810æä½ç³»ç»å·¥ç¨ãæç»­æ´æ°ã _</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="lab-traps">Lab: traps</h1>
<p>â	å¨è¿ä¸ä¸ªlabå½ä¸­<a href="https://pdos.csail.mit.edu/6.828/2025/labs/traps.html" target="_blank" rel="noopener nofollow">6.1810 / Fall 2025</a>å®è¦æ±æä»¬çè§£xv6å½ä¸­å½æ°è°ç¨æ¶çå æ æåµä»¥åå¦ä½ææ§åå­å¯»æ¾å¤çº§å½æ°è°ç¨çèµ·å§ï¼æ´éè¦çæ¯å®å¸¦æä»¬ç´è§å°æåå°äº<strong>ä¸­æ­çå¨è¿ç¨</strong>ã</p>
<p>â	å¨æ­¤ä¹åï¼å®ç½ç»åºäºä¸äºæç¤ºï¼</p>
<ul>
<li>å¨å¼å§ç¼ç¨ä¹åï¼	<a href="https://pdos.csail.mit.edu/6.828/2025/xv6/book-riscv-rev5.pdf" target="_blank" rel="noopener nofollow">è¯·éè¯»xv6æç¨çç¬¬4ç« </a>ï¼ä»¥åç¸å³çæºç æä»¶<code>kernel/trampoline.S</code>ã</li>
<li><code>kernel/trap.c</code>å½ä¸­æ¯å¤çææä¸­æ­çä»£ç ã</li>
</ul>
<h2 id="risc-v-assembly-ç®å">RISC-V assembly (ç®å)</h2>
<p>â	å¨è¿ä¸ªlabå½ä¸­ï¼è¦æ±æä»¬éè¯»ä¸äºæ±ç¼ä»£ç ï¼å¹¶ä¸äºè§£cè¯­è¨çæäºè¯­å¥å¯¹åºçæ±ç¼æ¯ææ ·çï¼åæ¶äºè§£ä¸åå¯å­å¨çä¸åèè´£ï¼ä¾å¦<strong>ra</strong>å¯å­å¨æ¯å­æ¾è¿åå°åçå¯å­å¨ï¼ãç¶åå¸¦æä»¬äºè§£äºä¸ä¸ç¼è¯å¨å¨ç¼è¯ä»£ç æ¶ï¼å¦ä½ä¼å/ç®åæä»¬çä»£ç ãæåå¸¦æä»¬ç´è§å°çè§£äºä¸ä¸å¤§ç«¯æ¨¡å¼åå°ç«¯æ¨¡å¼çåºå«ä»¥åä¸¤èå¨é¢å¯¹<strong>å¤å­èå­å¨</strong>å<strong>åä¸ªæ°å¼</strong>å­å¨æé æçä¸åçå½±åã</p>
<h2 id="å¦ä½éè¯»æ±ç¼ä»£ç ">å¦ä½éè¯»æ±ç¼ä»£ç </h2>
<p>â	ä»¥ä¸æ¯æªåäº<code>call.asm</code>å½ä¸­çä¸é¨åä»£ç ï¼è¿ç±»ä»£ç æ¯åæ±ç¼å¾æ¥çç»æãæ¥ä¸æ¥å°å¼å§è§£æè¿æ®µç¨åºã</p>
<pre><code class="language-assembly">##è¿æ¯cè¯­è¨å½æ°fçåæ±ç¼ä»£ç ï¼éè¿æªåç¼è¯å¨è¾åºå¾å°ï¼ä¸æ¯æåçæ±ç¼ä»£ç ï¼æåçæ±ç¼åªæå©è®°ç¬¦ï¼æ²¡æå°åç åæºå¨ç ï¼ã
int f(int x) {
  ##å¯¹äºè¿ä¸è¡ï¼eæ¯åå­è¿å¶çåå­å°å/åç§»ï¼1141æ¯åå­è¿å¶æºå¨ç ã
  ##åå¾åçaddi  sp,sp,-16æ¯å°æ æéspå16ãï¼ä¸è¬åªæåæ çæåµä¸æä¼ä¿®æ¹æ æéï¼
   e:	1141                	addi	sp,sp,-16
  ##å¯¹äºè¿ä¸è¡ï¼10æ¯åå­è¿å¶çåå­å°å/åç§»ï¼e422æ¯åå­è¿å¶æºå¨ç ã
  ##åå¾åçsd	s0,8(sp)æ¯å°å¯å­å¨s0çåå®¹ä¿å­å°æ ç8åç§»å¤ï¼sp+8ï¼ã
  10:	e422                	sd	s0,8(sp)
  ##å¯¹äºè¿ä¸è¡ï¼12æ¯åå­è¿å¶çåå­å°å/åç§»ï¼0800æ¯åå­è¿å¶æºå¨ç ã
  ##åå¾åçaddi  sp,sp,16æ¯å°æ æéspå 16ãï¼ä¸è¬åªæåºæ çæåµä¸æä¼ä¿®æ¹æ æéï¼
  12:	0800                	addi	s0,sp,16
  ##è°ç¨å½æ°g
  return g(x);
}
</code></pre>
<h2 id="é®é¢è§£ç­">é®é¢è§£ç­ï¼</h2>
<p>ä¸ãWhich registers contain arguments to functions? For example, which register holds 13 in main's call to <code>printf</code>?ï¼åªäºå¯å­å¨åå«å½æ°çåæ°ï¼ä¾å¦ï¼å¨mainè°ç¨printfæ¶ï¼åªä¸ªå¯å­å¨å­æ¾ç13ï¼ï¼</p>
<p><strong>ç­ï¼</strong>ä»mainå½æ°å¼å§ï¼æå¦ä¸å¯å­å¨ï¼</p>
<ol>
<li><strong>sp</strong>æ æéå¯å­å¨ï¼ç¨äºå­å¨å½åæ é¡¶å°åãï¼å¥æ ååå°ååå¥ï¼åºæ ååºåå¢ï¼ã</li>
<li><strong>ra</strong>è¿åå°åå¯å­å¨ï¼ä¸é¨ç¨äºä¿å­å½æ°è°ç¨è¿åå°åçå¯å­å¨ã</li>
<li><strong>s0</strong>ä¿å­å¯å­å¨ï¼ç¨äºä¿å­å½æ°æ§è¡è¿ç¨ä¸­éè¦æç»­ä½¿ç¨çä¸­é´å¼ãå¸§æéç­ã</li>
<li><strong>a0~a7</strong>æ¯å½æ°çåæ°å¯å­å¨ï¼ä¼ éå½æ°åæ°æ¶ä¼ç¨å°ã</li>
</ol>
<p>â	å¨mainè°ç¨printfæ¶ï¼å¯å­å¨<strong>a2</strong>å­æ¾ç13ã</p>
<p>äºãWhere is the call to function <code>f</code> in the assembly code for main? Where is the call to <code>g</code>? (Hint: the compiler may inline functions.)ï¼å¨mainå½æ°çæ±ç¼ä»£ç ä¸­ï¼å¯¹å½æ°fçè°ç¨å¨åªéï¼å¯¹gçè°ç¨åå¨åªéï¼ï¼æç¤ºï¼ç¼è¯å¨å¯è½ä¼åèå½æ°ãï¼ï¼</p>
<p><strong>ç­</strong>ï¼å¨mainå½æ°å½ä¸­ï¼å¯¹<strong>f</strong>çè°ç¨è¢«ç®åä¸ºäºä¸æ¡æä»¤ï¼<code>li	a1,12</code>ï¼å ä¸ºç¼è¯å¨å¨ç¼è¯ä»£ç æ¶ï¼å¯¹äºéå¸¸ç®åçå½æ°æ°ä¼è¿è¡<strong>åèä¼å</strong>ï¼ç®åºå¶ç»æï¼ç¶åç´æ¥åå¥å¯¹äºå¯å­å¨ä¸­ï¼æ éçæ<strong><code>jal</code>/<code>jalr</code>è°ç¨æä»¤</strong>ï¼ãå¯¹äº<strong>g</strong>çè°ç¨ä¼å¨<strong>f</strong>å½ä¸­ï¼ä½æ¯ç±äºå½æ°<strong>g</strong>è¿äºç®åï¼æä»¥å¯¹å½æ°<strong>f</strong>è¿è¡äº<strong>æä»¤èå</strong>ï¼å³å°å½æ°<strong>g</strong>å½ä¸­çæä»¤é»è¾èåå°<strong>f</strong>å½ä¸­ãå¨æ¬ä¾å­å½ä¸­ï¼<strong>g</strong>ä¼åå 3æä½ç¶åè¿åï¼ç¶åæä»¬å¯ä»¥å¨<strong>f</strong>å½ä¸­ç´æ¥è¿è¡å ä¸æä½ï¼æ éè°ç¨<strong>g</strong>ã</p>
<p>ä¸ãAt what address is the function printf located?ï¼å½æ°printfä½äºåªä¸ªå°åï¼ï¼</p>
<p><strong>ç­ï¼</strong>å¨<code>call.asm</code>å½ä¸­ï¼æä»¥ä¸ä¸è¡ä»£ç ï¼</p>
<pre><code class="language-assembly">30:	6c4000ef          	jal	ra,6f4 &lt;printf&gt;
</code></pre>
<p>â	å¶ä¸­<code>jal</code>æ¯è·³è½¬æä»¤ï¼æä»¤æ ¼å¼ä¸ºï¼<code>jal ra ç®æ å°å</code>,åç»ååé¢ç<code>&lt;printf&gt;</code>æä»¬å¯ä»¥å¾ç¥<strong><code>0x6f4</code></strong>æ¯printfçå°åï¼å¯¹åºprintfçå¥å£ã</p>
<p>åãWhat value is in the register <code>ra</code> just after the <code>jalr</code> to <code>printf</code> in <code>main</code>?ï¼å¨mainå½æ°ä¸­æ§è¡jalrå°printfä¹åï¼å¯å­å¨raä¸­çå¼æ¯ä»ä¹ï¼ï¼</p>
<p><strong>ç­ï¼</strong>å ä¸º<strong>ra</strong>æ¯è¿åå°åå¯å­å¨ï¼ä¹å°±æ¯è¯´å®éé¢ä¿å­çæ¯æ§è¡å®å½æ°è°ç¨ååºè¯¥è¿åçå°åï¼æä»¥æ­¤æ¶å¨æ§è¡å°printfåï¼<strong>ra</strong>åçå¼åºè¯¥æ¯æä»¤<code>jal	ra,6f4 &lt;printf&gt;</code>çä¸ä¸æ¡æä»¤çå°åï¼ä¹å°±æ¯<strong><code>0x34</code></strong>ã</p>
<p>äºãRun the following code.ï¼è¿è¡æ¥ä¸æ¥çä»£ç ï¼</p>
<pre><code class="language-c">	unsigned int i = 0x00646c72;
	printf("H%x Wo%s", 57616, (char *) &amp;i);
</code></pre>
<p>What is the output? <a href="https://www.asciitable.com/" target="_blank" rel="noopener nofollow">Here's an ASCII table</a> that maps bytes to characters.ï¼è¾åºæ¯ä»ä¹ï¼è¿æ¯ä¸ä¸ªå°å­èæ å°å°å­ç¬¦çASCIIè¡¨ãï¼</p>
<p>The output depends on that fact that the RISC-V is little-endian. If the RISC-V were instead big-endian what would you set <code>i</code> to in order to yield the same output? Would you need to change <code>57616</code> to a different value?ï¼è¾åºåå³äº RISC-V æ¯å°ç«¯å­èåºè¿ä¸äºå®ãå¦æ RISC-V æ¯å¤§ç«¯å­èåºï¼é£ä¹ä¸ºäºå¾å°ç¸åçè¾åºï¼ä½ ä¼å° i è®¾ä¸ºå¤å°ï¼ä½ éè¦å° 57616 æ¹æå¶ä»å¼åï¼ï¼</p>
<p><strong>ç­ï¼</strong>è¾åºåå®¹å¦ä¸ï¼xv6é»è®¤å°ç«¯æ¨¡å¼ï¼ï¼</p>
<pre><code class="language-powershell">He110,World
</code></pre>
<ul>
<li>å°ç«¯æ¨¡å¼ï¼ä½å°åå­æ¾ä½ä½ï¼é«å°åå­æ¾é«ä½ã</li>
<li>å¤§ç«¯æ¨¡å¼ï¼ä½å°åå­æ¾é«ä½ï¼é«å°åå­æ¾ä½ä½ã</li>
</ul>
<p>â	ä¾ç§å¤§ç«¯æ¨¡å¼ï¼æä»¬éè¦å°<strong>i</strong>è¿è¡ä¿®æ¹ï¼å¤§å°ç«¯æ¨¡å¼åªå½±åå¤å­èçå­å¨ï¼è<strong>57616</strong>åªæ¯åä¸ªæ°å¼ï¼ä¸æ¶åå¤å­èå­å¨ãä¸ºç¬¦åå¤§ç«¯è¦æ±ï¼æä»¬éè¦å°<strong>i</strong>ä¿®æ¹ä¸ºï¼<strong><code>0x726c6400</code></strong>å³å¯ã</p>
<p>å­ãIn the following code, what is going to be printed after <code>'y='</code>? (note: the answer is not a specific value.) Why does this happen?ï¼å¨ä¸é¢çä»£ç ä¸­ï¼'y='åé¢å°ä¼æå°åºä»ä¹ï¼ï¼æ³¨æï¼ç­æ¡ä¸æ¯ä¸ä¸ªå·ä½çå¼ãï¼ä¸ºä»ä¹ä¼åºç°è¿ç§æåµï¼ï¼</p>
<pre><code class="language-c">	printf("x=%d y=%d", 3);
</code></pre>
<p><strong>ç­ï¼</strong>å ä¸ºåé<strong>y</strong>æ²¡æå¯¹åºçèµå¼ï¼æä»¥ä¼è¾åºä¸ä¸ª<strong>æªåå§åçéæºçå¼</strong>ï¼ç±»ä¼¼ï¼0,1385ï¼-2294ï¼ãå¨æ±ç¼æ¶ï¼printfå½æ°ä¼ç¨å°ä¸¤ä¸ªå¯å­å¨ï¼å¶ä¸­ a1è´è´£å­æ¾3ï¼a2æ²¡ææå®è¦å­æ¾è°ï¼æä»¥éé¢çå¼æ¯æªç¥çã</p>
<h2 id="backtraceä¸­ç­">Backtraceï¼ä¸­ç­ï¼</h2>
<p>â	å½ä¸ä¸ªå½æ°è°ç¨å¦ä¸ä¸ªå½æ°æ¶ï¼CPU ä¼å°è°ç¨ç¹çè¿åå°åä¿å­å°æ ä¸ï¼è¿æ ·è¢«è°ç¨å½æ°æ§è¡å®åæè½åå°åæ¥çä½ç½®ç»§ç»­æ§è¡ãæ¯æ¬¡è°ç¨é½ä¼åå»ºæ°çæ å¸§ï¼å¹¶å¨æ å¸§ä¸­ä¿å­è¿åå°ååä¸ä¸å±çæ å¸§æéãå æ­¤ï¼å¦ææä»¬ç¥éå½åå½æ°çæ å¸§ä½ç½®ï¼å°±å¯ä»¥é¡ºçæ å¸§é¾âåæº¯âï¼æ¾å°ä¸ä¸å±å½æ°çè¿åå°åï¼åç»§ç»­åä¸ï¼ç´å°éåå®æ´ä¸ªè°ç¨é¾ãæä»¬æè¿ä¸ªè¿ç¨å½¢è±¡å°ç§°ä¸ºâé¡ºè¾æ¸çâï¼æææ¯æ²¿çæ å¸§é¾ï¼ä¸å±å±æ¾å°è°ç¨å³ç³»ã</p>
<p>â	æ¬ Lab è¦æ±å®ç°ä¸ä¸ª <code>backtrace()</code> å½æ°ï¼å®ä»å½åæ å¸§åºåï¼æ²¿çæ å¸§é¾æå°æ¯ä¸å±å½æ°çè¿åå°åãè¾åºé¡ºåºåºä¸è°ç¨é¾ä¸è´ï¼ä»å½åå½æ°åä¸ç´å°æåè°ç¨çåæ ¸å¥å£ï¼ã</p>
<p>â	<strong>æ å¸§ï¼</strong>æ<strong>å½æ°æ å¸§</strong>ï¼æ¯å½æ°å¨è¿è¡æ¶å¨æ ä¸åéçä¸æ®µåå­ï¼ç¨æ¥ä¿å­å½æ°è°ç¨éè¦çä¿¡æ¯ï¼ä¾å¦ï¼è¿åå°åï¼ä¸ä¸å±å½æ°çæ å¸§æéï¼å±é¨åéï¼ä¿å­çå¯å­å¨ï¼ã</p>
<h3 id="å®ç½æç¤ºåä¸ªäººè§£æ">å®ç½æç¤ºåä¸ªäººè§£æ</h3>
<p>â	1ãå¨<code>kernel/defs.h</code>å¨å£°æ <code>backtrace()</code> å½æ°ååï¼è¿æ ·å¶ä»æä»¶å¯ä»¥è°ç¨ï¼å¹¶ä¸å¨<code>kernel/printf.c</code>å½ä¸­å®ç°è¯¥å½æ°ã</p>
<p>â	2ãç±äºæä»¬éè¦è·åå½åçæ å¸§å°åï¼æä»¥å®ç½ç»æä»¬æä¾äºä¸ä¸ª<code>r_fp</code>å½æ°ï¼ç¨äºè¿åå½åçæ å¸§å°åãæä»¬éè¦å°è¿ä¸ªå½æ°å¤å¶å°<code>kernel/riscv.h</code>å½ä¸­ç<strong><code>#ifndef __ASSEMBLER__ ... #endif</code></strong> å®ä¹å½ä¸­ã</p>
<p>â	3ãå¨å®ç°è¯¥åè½æ¶ï¼æä»¬éè¦è·åå½åæ å¸§çå°åï¼å¥½å¨å®ç½æä¾äº<code>r_fp</code>å½æ°ï¼å®è¿åä¸ä¸ª<strong>uint64</strong>ç±»åçæ°æ®ï¼è¿æ¯æ å¸§æéï¼æåçä½ç½®å­æ¾ççæ­£çæ å¸§å°åï¼ï¼å¯¹å¶è§£å¼ç¨ä¼å¾å°å½åçæ å¸§å°åã</p>
<p>â	4ãæ¥ä¸æ¥æä»¬å¼å§âåä¸âå¯»æ¾è°ç¨é¾ä¸çå½æ°ï¼æ ¹æ®å®ç½çæç¤ºï¼å¨<strong>âæ å¸§å°å - 8â</strong>çä½ç½®ä¸å­æ¾çæ¯ä¸ä¸å±å½æ°çè¿åå°åï¼ä¹æ¯æä»¬è¦æå°çå°åãå¨<strong>âæ å¸§å°å - 16â</strong>çä½ç½®ä¸å­æ¾çæ¯ä¸ä¸å±å½æ°æ å¸§çå°åï¼å¨æå°å®æ¯åæä»¬åæ¢å°ä¸ä¸å±å½æ°çæ å¸§ï¼ç¶åç»§ç»­æå°è¿åå°åï¼ç¶ååæ¬¡åä¸å¯»æ¾æ å¸§ï¼ç´è³å°è¾¾é¡¶ç«¯ã</p>
<p>â	ä»¥ä¸æ¯xv6åæ ¸çç¸å³çº¦å®ï¼å ä¹æ¯ä¸ªå½æ°è°ç¨çæ¶åé½ä¼ä¼´éä»¥ä¸æ±ç¼ä»£ç ï¼ï¼</p>
<pre><code class="language-assembly">addi sp, sp, -X    # åéæ å¸§
sd ra, 8(sp)       # ä¿å­è¿åå°å
sd s0, 0(sp)       # ä¿å­æ§ç frame pointerï¼æ å¸§æéï¼æåå­æ¾æ å¸§çåå­ï¼
mv s0, sp          # æ´æ° frame pointerï¼æ å¸§æéï¼
</code></pre>
<p>â	æ´ç´è§ç¹ï¼</p>
<pre><code class="language-nginx">s0 â æåèªå·±æ å¸§ç s0 å­æ¾ä½ç½® + 8
s0-8 â ra
s0-16 â ä¸ä¸çº§ s0
</code></pre>
<p>â	5ãå¨åä¸å¯»æ¾æ¶ä¹è¦æ³¨æè¶ççé®é¢ï¼å¨xv6å½ä¸­ï¼æ´ä¸ªæ é½å¨åä¸ä¸ªé¡µé¢å½ä¸­ï¼å æ­¤ææçæ å¸§é½æ¯å¨ä¸ä¸ªé¡µé¢ä¸­ï¼è¿ä¹è§£éäºä¸ºä»ä¹éå½çå±çº§å¤äºä¼çæ çåå ï¼å ä¸ºè°ç¨æ°çå½æ°ä¼åå»ºæ°çæ å¸§ï¼å ç¨åä¸ä¸ªæ çåå­ï¼ï¼æä»¥æä»¬éè¦ä¿è¯æä»¬å¨è·åå°æ°çæ å¸§çåæ¶ï¼è¦ä¿è¯ä¸åææå¤çè¿çæ å¸§å¤äºåä¸é¡µé¢ï¼å®ç½å½ä¸­ç»åºäº<code>PGROUNDDOWN(fp)</code>å®æ¥å¸®å©æä»¬å¤æ­å½åfpçé¡µé¢ãåæ¶ä¹æä¸ä¸ªå¿½ç¥çç¹å°±æ¯è¦ä¿è¯å°åæ¯éåçï¼è¿æ ·æ»ä¼éåå°å½åé¡µçè¾¹çï¼ä½¿å¾å¾ªç¯ç»æ­¢ï¼å¦æå¿½ç¥è¯¥æ¡ä»¶ï¼å¯è½ä¼å¯¼è´å°åå å ååè·³ä¸åºæ¬é¡µï¼è¿èæ éå¾ªç¯ã</p>
<p>â	6ãéè¿å½åæ å¸§è·åä¸ä¸å±å½æ°çè¿åå°åï¼å¹¶ä¸æå°ã</p>
<p>â	7ãéè¿å½åæ å¸§è·åä¸ä¸å±å½æ°çæ å¸§ï¼ç¶åç»§ç»­å¯»æ¾ã</p>
<h3 id="ç¸å³ä»£ç ">ç¸å³ä»£ç </h3>
<p>â	å¨<code>kernel/printf.c</code>å½ä¸­ã</p>
<pre><code class="language-c">void backtrace(){
  // å½åçæ å¸§
  uint64 s0 = r_fp();
  // ä¸´æ¶åéï¼ææ°çå½æ°æ å¸§
  uint64 temp = s0;
  // ä¸´æ¶åéï¼ç¨äºæ¥ä¸æ¥çæ¯è¾
  uint64 log = s0;
  printf("backtrace:\n");
  // ç¡®ä¿æ¾å°çæ å¸§åææ°çæ å¸§æ¯åä¸é¡µï¼å¹¶ä¸æ å¸§åªè½åè°éåï¼ä¸è½åºç°ç¯è·¯ï¼é²æ­¢æ­»å¾ªç¯ã
  while((PGROUNDDOWN(s0) == PGROUNDDOWN(temp)) &amp;&amp; (s0 &gt;= log )){
    // æ å¸§-8æ¯è¿åå°åï¼ååºè¿åå°åå½ä¸­çå¼ï¼ä»¥å°åå½¢å¼æå°
    uint64 ra = *(uint64 *)(s0 - 8);
    printf("%p\n", (void *)ra);
    // ä¸´æ¶åéä¿å­å½åæ å¸§ï¼å¨ä¿è¯æ å¸§åè°éåçå¤æ­ä¸­ä½¿ç¨
    log = s0;
    // æ å¸§-16æ¯ä¸ä¸å±å½æ°çæ å¸§
    s0 = *(uint64*)(s0 - 16);
  }
}
</code></pre>
<p>â	<strong>ä¹åæ ¹æ®å®ç½çæç¤ºè¿è¡å®éªç»æçéªè¯å³å¯ã</strong></p>
<h2 id="alarmå°é¾">Alarmï¼å°é¾ï¼</h2>
<p>â	å¨è¿ä¸labå½ä¸­ï¼è¦æ±æä»¬<strong>å®ç°ç¨æ·æçå®æ¶âä¸­æ­âåè½</strong>ãç¨æ·è¿ç¨å¯ä»¥åæä½ç³»ç»æ³¨åä¸ä¸ªå½æ°ï¼handlerï¼ï¼å¹¶ä¸è¦æ±CPUå¨æ¯énä¸ªtickåæ§è¡è¯¥å½æ°ä¸æ¬¡ï¼å¨handlerå¨è¢«æ§è¡æ¶ï¼ç¨æ·ç¨åºéè¦âè¢«æåâï¼ç´å°handleræ§è¡å®æ¯ååè¿åç¨æ·ç¨åºï¼è¿ä¸ªè¿ç¨ç±»ä¼¼äºç¡¬ç¡¬ä»¶ä¸­æ­æºå¶ï¼åªä¸è¿éç¨äºè½¯ä»¶çæ¹æ³å®ç°ã</p>
<h3 id="å®ç½æç¤ºåä¸ªäººè§£æ-1">å®ç½æç¤ºåä¸ªäººè§£æï¼</h3>
<p>â	1ãé¦åè¦æ±æä»¬æ°æ·»å ä¸¤ä¸ªç³»ç»è°ç¨ï¼åå«æ¯ï¼<strong><code>sigalarm(interval, handler)</code>å<code>sigreturn(void)</code></strong>ï¼å·ä½çæ·»å æ¹å¼è¯¦è§ï¼<a href="https://www.cnblogs.com/xiaobai1523/p/19530432" target="_blank">Lab2-system calls &amp;&amp; MIT6.1810æä½ç³»ç»å·¥ç¨ãæç»­æ´æ°ã - å°ç½åå­¦_C - åå®¢å­</a>ãä¸æ­¤åæ¶ï¼<code>sigalarm(interval, handler)</code>å½æ°çç¬¬ä¸ä¸ªåæ°intervalä»£è¡¨æ¯éå¤å°åtickæ§è¡handlerï¼ç¬¬äºä¸ªåæ°handlerå°±ä»£è¡¨CPUæ¯ä¸ªnä¸ªtickè¦æ§è¡å½æ°çå°åäºãè¿å°±éè¦æä»¬å¨è¿ç¨ç<code>proc</code>å½ä¸­æ·»å æ°çæåç¨äºè®°å½å½åtickåå½åå·²ç»è¿å»äºå¤å°tickä»¥åæ³¨åçå½æ°æéã</p>
<p>â	2ãå¦æåºç¨ç¨åºè°ç¨ sigalarm (0, 0)ï¼åæ ¸åºåæ­¢çæå¨ææ§çè­¦æ¥è°ç¨ã</p>
<p>â	3ãhandleræ§è¡æ¶ï¼éè¦æä»¬æåç¨æ·ç¨åºï¼ä¹å°±æ¯åå°ç¨æ·ç¨åºçä»£ç ä¿æ¤èµ·æ¥ï¼æ¿æ¢ä¸ºhandlerçä»£ç ãå¾handleræ§è¡å®æ¯ååå°ç¨æ·ç¨åºçä»£ç æ¢å¤ï¼è¿å°±è¦æ±æä»¬å¨è¿ç¨ç<code>proc</code>å½ä¸­æ·»å ç¸åºçtrapframeå¸§ç¨äºä¿å­ç¨æ·ç¨åºç¶æï¼åä¸­æ­çææ³ä¸æ ·ï¼ææ­å½åæ§è¡çç¨åºâä¿æ¤æ­ç¹åç°åºâè·å¾ä¸­æ­åéâæ§è¡ä¸­æ­å¤çç¨åºâæ¢å¤æ­ç¹åç°åºâè¢«ææ­çç¨åºç»§ç»­æ§è¡ï¼ã</p>
<p>â	4ãæ<code>user/alarmtest.c</code> æ·»å å° Makefile ä¸­ã</p>
<p>â	5ãè®°å¾æ<code>sigalarm(interval, handler)</code>å<code>sigreturn(void)</code>æ·»å å°<code>user/user.h</code>å½ä¸­ãï¼æ ¼å¼å¦ä¸ï¼</p>
<pre><code class="language-c">	int sigalarm(int ticks, void (*handler)());
    int sigreturn(void);
</code></pre>
<p>â	6ãæ¯è¿ä¸ä¸ªtickï¼ç¡¬ä»¶æ¶éå°±ä¼è§¦åä¸æ¬¡ä¸­æ­ï¼è¯¥ä¸­æ­å¨<code> kernel/trap.c</code> ç <code>usertrap () </code>ä¸­å¤çï¼æä»¥æä»¬éè¦å¨è¿éè¿è¡ä¿®æ¹ãå®ç½è¯´äºï¼åªè¦åçå®æ¶å¨ä¸­æ­æ¶ï¼æä»¬æéè¦ä¿®æ¹/å¯¹æ¯è¿ç¨çæ¶étickæ°ãå¨å¦ä¸å¤æ­ä½åå®ç°âå¤æ­handleræ¯å¦æ§è¡çç¸å³é»è¾âï¼å¹¶ä¸ä¿å­ç¨æ·ç¨åºçæ­ç¹åå°ç¨æ·ç¨åºä»£ç æ¿æ¢ä¸ºhandlerå°±å¨æ­¤æ§è¡ã</p>
<pre><code class="language-c">	if(which_dev == 2) ...
</code></pre>
<p>â	7ã å½handleræ§è¡å®æ¯åï¼ä¹æ¯è°ç¨äº<code>sigreturn</code>å½æ°æ¶ï¼è¦æ±æä»¬è¿åå½åè¿ç¨ç<strong>a0</strong>å¯å­å¨ã</p>
<h3 id="ç¸å³ä»£ç -1">ç¸å³ä»£ç </h3>
<p>â	æå³æ·»å ç³»ç»è°ç¨çä»£ç å¨è¿éå°±åè·³è¿äºï¼å¯ä»¥ç¿»ç¿»åä¸»ä¹åçæç« <a href="https://www.cnblogs.com/xiaobai1523/p/19530432" target="_blank">Lab2-system calls &amp;&amp; MIT6.1810æä½ç³»ç»å·¥ç¨ãæç»­æ´æ°ã - å°ç½åå­¦_C - åå®¢å­</a>ã</p>
<p>â	ä¸ãkernel/proc.h</p>
<pre><code class="language-c">// å¨è¿ç¨çprocå½ä¸­æ°æ·»å å¦ä¸åå®¹ï¼
  int alarmticks;              // è­¦æ¥ä¹é´çæ»´ç­å£°
  int alarmtickscount;         // ä¸æ¬¡è­¦æ¥åçæ»´ç­å£°æ¬¡æ°
  uint64 alarmhandler;      // é¹éæ»´ç­å£°è¿å»æ¶è°ç¨çå¤çç¨åº
  int inhandler;               // æ¯å¦æ­£å¨å¤çalarm
  struct trapframe alarm_tf; // ç¨äºä¿å­è¢« alarm ææ­æ¶ç trapframe
</code></pre>
<p>â	äºãkernel/sysproc.c</p>
<pre><code class="language-c">uint64
sys_sigalarm(void)
{
  int ticks;
  uint64 handler;

  // è¯»åç¨æ·ä¼ å¥åæ°
  argint(0, &amp;ticks);
  argaddr(1, &amp;handler);

  struct proc *p = myproc();

  // è®¾ç½® alarmticks å alarmhandler
  p-&gt;alarmticks = ticks;
  p-&gt;alarmtickscount = 0;
  // å¦æ ticks å handler é½ä¸º 0ï¼è¡¨ç¤ºåæ¶ alarmï¼æä»¥å° alarmhandler è®¾ç½®ä¸º -1ï¼è¡¨ç¤ºä¸è°ç¨ handler
  if(ticks == 0 &amp;&amp; handler == 0) {
    p-&gt;alarmhandler = -1;
  }else{
    p-&gt;alarmhandler = handler;
  }

  return 0;
}

uint64 
sys_sigreturn(void)
{
  struct proc *p = myproc();
  // æ¢å¤è¢« alarm ææ­æ¶ç trapframeï¼ä»¥ä¾¿å¨ handler å¤çå®åç»§ç»­è¢«ææ­çç¨åº
  memmove(p-&gt;trapframe, &amp;p-&gt;alarm_tf, sizeof(struct trapframe));
  // å¤çå® alarm åï¼éç½® inhandler å alarmtickscount
  p-&gt;inhandler = 0;
  p-&gt;alarmtickscount = 0;
  return p-&gt;trapframe-&gt;a0; // è¿åç¨æ·ç¨åºä¸­ a0 çå¼
}
</code></pre>
<p>â	ä¸ãkernel/trap.c</p>
<pre><code class="language-c">// å¨usertrapå½æ°ç if(which_dev == 2)... å½ä¸­æ·»å å¦ä¸åå®¹ï¼
// å¨æ¶éä¸­æ­æ¶ï¼æ£æ¥æ¯å¦éè¦å¤ç alarm
  if(which_dev == 2){
    // è·åå½åè¿ç¨çæé
    struct proc *p = myproc();
    // å¦æå½åè¿ç¨è®¾ç½®äº alarmhandlerï¼å¹¶ä¸ä¸å¨å¤ç alarm çè¿ç¨ä¸­ï¼å°±æ£æ¥æ¯å¦éè¦è°ç¨ alarmhandler
    // æ³¨æï¼alarmhandler çå¼ä¸º -1 è¡¨ç¤ºæ²¡æè®¾ç½® handlerï¼ä¸è°ç¨ï¼ï¼å¼ä¸º 0 è¡¨ç¤ºæ­£å¨å¤ç alarmï¼
    // æä»¥åªæå½ alarmhandler å¤§äº 0 æ¶æè¡¨ç¤ºè®¾ç½®äº handler å¹¶ä¸ä¸å¨å¤ç alarm çè¿ç¨ä¸­
    if(p-&gt;alarmhandler == 0 || p-&gt;alarmhandler != -1){
      // å¢å æ»´ç­å£°è®¡æ°ï¼å¹¶æ£æ¥æ¯å¦è¾¾å°äº alarmticksï¼å¦æè¾¾å°äºï¼å¹¶ä¸ alarmticks å¤§äº 0ï¼å°±è°ç¨ handler
      p-&gt;alarmtickscount++;
      // å¦æè¾¾å°äºè®¾å®çæ»´ç­æ°ï¼ä¸è®¾ç½®äº alarmticksï¼å¤§äº 0ï¼ï¼å°±è°ç¨ handler
      if(p-&gt;alarmtickscount &gt;= p-&gt;alarmticks &amp;&amp; p-&gt;alarmticks &gt; 0 ){
        p-&gt;alarmtickscount = 0;
        // è°ç¨ç¨æ·è®¾ç½®ç alarm å¤çç¨åº
        if(!p-&gt;inhandler){
          // è®¾ç½®å½åæ­£å¨å¤ç alarmï¼é²æ­¢å¨å¤ç alarm çè¿ç¨ä¸­è¢«åæ¬¡ææ­è°ç¨ handler
          p-&gt;inhandler = 1;
          // ä¿å­è¢«ææ­æ¶ç trapframe å° alarm_tf ä¸­ï¼ä»¥ä¾¿å¨ handler å¤çå®åæ¢å¤
          memmove(&amp;p-&gt;alarm_tf, p-&gt;trapframe, sizeof(struct trapframe));
          // è®¾ç½® trapframe ç epc ä¸º handler çå°åï¼è¿æ ·å¨ usertrapret() æ¶å°±ä¼è·³è½¬å° handler å¤æ§è¡
          p-&gt;trapframe-&gt;epc = (uint64)p-&gt;alarmhandler;  

        }
        
      }
    }
    yield();
  }
</code></pre>
<h3 id="éªæ¶ææ">éªæ¶ææ</h3>
<pre><code class="language-shell">xiaobai@***:~/xv6-labs-2025$ ./grade-lab-traps alarm
make: 'kernel/kernel' is up to date.
== Test running alarmtest == (4.1s)
== Test   alarmtest: test0 ==
  alarmtest: test0: OK
== Test   alarmtest: test1 ==
  alarmtest: test1: OK
== Test   alarmtest: test2 ==
  alarmtest: test2: OK
== Test   alarmtest: test3 ==
  alarmtest: test3: OK
xiaobai@***:~/xv6-labs-2025$
</code></pre>
<h2 id="åå¨æå">åå¨æå</h2>
<p>â	è¿ä¸labå¯ä»¥è¯´å¾ç´è§å°è®©æä»¬æåå°ä¸­æ­çè¿ç¨æ¯ææ ·çï¼ç¹å«æ¯æ¶åâä¿æ¤æ­ç¹/ç°åºâï¼âè·åä¸­æ­æå¡ç¨åºå¥å£å°åâï¼âæ¢å¤æ­ç¹/ç°åºâç­åå®¹ã</p>
<p>â	å¿«è¿å¹´äºï¼äºåå¤§å¹´ä¸ååå°½å¿«èµ¶åºä¸ä¸ä¸ªlabã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0020833333333333333" data-date-updated="2026-02-12 23:15">2026-02-12 23:12</span>&nbsp;
<a href="https://www.cnblogs.com/xiaobai1523">å°ç½åå­¦_C</a>&nbsp;
éè¯»(<span id="post_view_count">5</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19610063);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19610063', targetLink: 'https://www.cnblogs.com/xiaobai1523/p/19610063', title: 'Lab4-Lab: traps &amp;amp;&amp;amp; MIT6.1810æä½ç³»ç»å·¥ç¨ãæç»­æ´æ°ã _' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ RAG æ¶ä»£çâç ´å£äººâï¼ä¸ºä»ä¹ä½ çå¤§æ¨¡ååºç¨æ¥é Doclingï¼ ]]></title>
    <link>https://www.cnblogs.com/jyzhao/p/19610038/rag-shi-dai-de-po-bi-ren-wei-shen-me-ni-de-da-mo-x</link>
    <guid>78ed27f4e3f64c3cf88aa33424efe821</guid>
    <description>
    <![CDATA[ 
    <a name="top"></a>
    <h2><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jyzhao/p/19610038/rag-shi-dai-de-po-bi-ren-wei-shen-me-ni-de-da-mo-x" title="åå¸äº 2026-02-12 22:58">
    <span role="heading" aria-level="2">RAG æ¶ä»£çâç ´å£äººâï¼ä¸ºä»ä¹ä½ çå¤§æ¨¡ååºç¨æ¥é Doclingï¼</span>
    

</a>
</h2>
    <small>
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-12 22:58">2026-02-12 22:58</span>&nbsp;
<a href="https://www.cnblogs.com/jyzhao">AlfredZhao</a>&nbsp;
éè¯»(<span id="post_view_count">12</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19610038);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19610038', targetLink: 'https://www.cnblogs.com/jyzhao/p/19610038/rag-shi-dai-de-po-bi-ren-wei-shen-me-ni-de-da-mo-x', title: 'RAG æ¶ä»£çâç ´å£äººâï¼ä¸ºä»ä¹ä½ çå¤§æ¨¡ååºç¨æ¥é Doclingï¼' })">ä¸¾æ¥</a>
</small>
    <div class="entry">
        <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨ RAGï¼æ£ç´¢å¢å¼ºçæï¼çå¼ååå­éï¼æä¸å¥æµä¼ çå¹¿çâé»è¯âï¼<strong>âåå¾è¿ï¼åå¾åºï¼Garbage In, Garbage Outï¼ãâ</strong> æ è®ºä½ çåéæ°æ®åºæå¤å¿«ï¼å¤§æ¨¡åï¼LLMï¼çæ¨çè½åæå¤å¼ºï¼å¦ææå¼å§åç»å®çææ¡£æ°æ®æ¯ä¸å¢ä¹±éº»ï¼é£æç»çåç­ææä¸å®ä¸å°½å¦äººæãæ­£æ¯å¨è¿ç§èæ¯ä¸ï¼IBM å¼æºç <strong>Docling</strong> åä¸å¹é»é©¬ï¼è¿éæä¸ºäº RAG é¢åçâæ°å® âã</p>
<p>ä»å¤©ï¼ç¬èå°±å¸¦å¤§å®¶æè§£ä¸ä¸ï¼ä¸ºä»ä¹å¨ RAG æµç¨ä¸­ï¼Docling æ¯ä¸å¯æç¼ºçåºå±æ¯æ±ã</p>
<hr>
<h2 id="01--çç¹è¢«å¿½è§çææ¡£è§£ææåä¸å¬é">01 | çç¹ï¼è¢«å¿½è§çææ¡£è§£æâæåä¸å¬éâ</h2>
<p>åè¿ RAG çåå­¦é½ç¥éï¼ç¬¬ä¸æ­¥éå¸¸æ¯è§£æ PDFãä½ä¼ ç»çè§£ææ¹å¼å¾å¾ä¼è®©å¼åèå¤´ç§ï¼</p>
<ul>
<li><strong>PDF æ ¼å¼çâéç»æåâæ¬è´¨</strong>ï¼PDF æ¬è´¨ä¸æ¯ç»æå°æºççãæ®éè§£æå·¥å·ï¼å¦ PyPDF ç­ï¼å¾å¾ä¼æç©çåæ æåææ¬ï¼å¯¼è´åæ æ··æ·ãé¡µçé¡µèæ¨ªæå¨æ­£æä¸­é´ã</li>
<li><strong>âç»æåâçå½»åºä¸¢å¤±</strong>ï¼æå¸åçå°±æ¯è¡¨æ ¼ãä¸æ¦è§£ææä¹±åºçº¯ææ¬ï¼è¡ä¸åçå³ç³»å°±ä¼ç°é£çç­ï¼å¤§æ¨¡åçå°çåªæ¯ä¸å æ¯«æ å³èçæ°å­âå¤©ä¹¦âã</li>
</ul>
<hr>
<h2 id="02--æ ¸å¿äº®ç¹docling-å­ä»ä¹è¢«ç§°ä¸ºéç»´æå»">02 | æ ¸å¿äº®ç¹ï¼Docling å­ä»ä¹è¢«ç§°ä¸ºâéç»´æå»âï¼</h2>
<p>Docling ä¸ä»ä»æ¯ä¸ä¸ªè½¬æ¢å·¥å·ï¼å®æ´åæ¯ä¸ä¸ªæ¥æâéè§ç¼âçæºè½ææ¡£ç¿»è¯å®ã</p>
<h3 id="-è¯­ä¹å¸å±åæèéå­ç¬¦æå">â  è¯­ä¹å¸å±åæï¼èéå­ç¬¦æå</h3>
<p>Docling éç¨äºåè¿çäººå·¥æºè½è§è§æ¨¡åï¼åºäº DocLayNet æ°æ®éï¼ãå®ä¸æ¯ç¡¬ççå°âæ£âå­ï¼èæ¯åäººç¼ä¸æ ·å»çè§£å¸å±ï¼<strong>âè¿éæ¯åæ æ é¢ï¼é£éæ¯è·¨è¡è¡¨æ ¼ï¼å³è¾¹æ¯éå¾çæ³¨éãâ</strong> è¿ç§å¯¹ææ¡£ææç»æçæ·±å»çè§£ï¼æ¯ä¿çåæé»è¾çå³é®ã</p>
<h3 id="-è¡¨æ ¼è§£æçå¤©è±æ¿tableformer">â¡ è¡¨æ ¼è§£æçâå¤©è±æ¿âï¼TableFormer</h3>
<p>è¿æ¯ Docling çææéãå®åç½®äº IBM ä¸é¨éå¯¹å¤æè¡¨æ ¼ç åç <strong>TableFormer</strong> æ¨¡åãå³ä¾¿æ¯æ²¡æè¾¹æ¡çº¿çè¡¨æ ¼ãå«æå¤æåå¹¶ååæ ¼çæ¥è¡¨ï¼å®é½è½ç²¾åè¿åå¹¶è½¬æ¢ä¸º Markdown æ JSONã</p>
<ul>
<li><strong>ä¸ºä»ä¹ Markdown å¯¹ RAG è³å³éè¦ï¼</strong> å¤§æ¨¡åå¤©çå¯¹ Markdown æ ¼å¼çè¡¨æ ¼ææå¼ºçæç¥åãéè¿ Doclingï¼å¤§æ¨¡åç»äºè½è¯»æâ2025å¹´Q3ççº¯Açæ¯Q2å¢é¿äºå¤å°âè¿ç§æ¶åè·¨è¡è·¨åå¯¹æ¯çå¤æé»è¾ã</li>
</ul>
<h3 id="-æç®ç-pipeline-ä¸-v2-ç»ä¸æ¶æ">â¢ æç®ç Pipeline ä¸ v2 ç»ä¸æ¶æ</h3>
<p>å¨ææ°ç <strong>v2 çæ¬</strong>ä¸­ï¼Docling å¼å¥äºç»ä¸çä¸­é´è¡¨ç¤ºï¼<code>DoclingDocument</code>ï¼ãè¿æå³çæ è®ºä½ è¾å¥çæ¯ PDFãWordãPPT è¿æ¯ HTMLï¼è¾åºçç»æåæ½è±¡æ¯å®å¨ä¸è´çãè¿ç§âä¸ç©å½ä¸âçç¹æ§ï¼æå¤§ç®åäº RAG åç«¯çæ°æ®å¤çé»è¾ã</p>
<hr>
<h2 id="03--è¿é¶çè§£docling-å¨-rag-å·¥ä½æµä¸­çåå­¦ååº">03 | è¿é¶çè§£ï¼Docling å¨ RAG å·¥ä½æµä¸­çåå­¦ååº</h2>
<h3 id="-åçè¯­ä¹åçsmart-chunking">â  åçè¯­ä¹åçï¼Smart Chunkingï¼</h3>
<p>ä¼ ç»çåçæ¯æå­æ°ç¡¬åï¼å¸¸å¯¼è´è¯­ä¹æ­è£ãDocling ç°å¨çå¼ºå¤§ä¹å¤å¨äºå®<strong>èªå¸¦åçé»è¾</strong>ãå ä¸ºå®ç¥éåªéæ¯æ é¢ãåªéæ¯æ®µè½ï¼æä»¥å®å¯ä»¥æ§è¡<strong>åºäºç»æçåç</strong>ï¼</p>
<blockquote>
<p><strong>ç¬èè§è§£</strong>ï¼éè¿ Doclingï¼æä»¬å¯ä»¥ç¡®ä¿æ¯ä¸ä¸ª Knowledge Chunk é½æ¯ä¸ä¸ªå®æ´çè¯­ä¹ååï¼ä¾å¦ï¼æ´ä¸ªäºçº§æ é¢ä¸çæææ®µè½ï¼ï¼è¿è½ä»æºå¤´ä¸æ¶é¤å¤§æ¨¡åå¨æ£ç´¢åçå¹»è§ã</p>
</blockquote>
<h3 id="-åæ°æ®ä¸åæ æ å°">â¡ åæ°æ®ä¸åæ æ å°</h3>
<p>Docling è§£ææ¶ä¼ä¿çæ¯ä¸ä¸ªåç´ å¨åä»¶ä¸­çåæ ãè¿ä½¿å¾å¨ RAG çâå¼ç¨æ¥æºâåè½ä¸­ï¼åºç¨ä¸ä»è½åè¯ç¨æ·ç­æ¡å¨åªä¸ªææ¡£ï¼çè³è½ç´æ¥å¨ PDF é¢è§ä¸­<strong>é«äº®æ¾ç¤º</strong>åºé£ä¸è¡æå­çä½ç½®ã</p>
<hr>
<h2 id="04--ææ°å¨æåå¨è½å¤æ¨¡æè·¨è¶">04 | ææ°å¨æï¼åå¨è½å¤æ¨¡æè·¨è¶</h2>
<p>ç¸æ¯æ©æçè§£æå·¥å·ï¼Docling æ­£å¨åâå¤æ¨¡æâè¿åãå®ä¸ä»å å¼ºäºå¯¹ <strong>OCRï¼åå­¦å­ç¬¦è¯å«ï¼</strong> çæ¯æï¼è§£å³æ«æä»¶é¾é¢ï¼çè³å¼å§æ¯æå¤çå¤æç <strong>LaTeX å¬å¼</strong>ãå®ä¸åä¾èµæè´µçåä¸é­æºæ¹æ¡ï¼å¦ Adobe Extractï¼ï¼èæ¯ä¸ºå¼æºç¤¾åºæä¾äºä¸ä¸ªå¨æ§è½ä¸å®å¨å¯¹æ çé«è´¨ééæ©ã</p>
<hr>
<h2 id="05--æ»ç»rag-å·¥ç¨å¸çæ éå·¥å·">05 | æ»ç»ï¼RAG å·¥ç¨å¸çæ éå·¥å·</h2>
<p>å¦æè¯´åéæ°æ®åºæ¯ RAG çå¤§èï¼é£ä¹ Docling å°±æ¯é£å <strong>âæå¶æéçæâ</strong>ï¼è´è´£æç²ç³çåææå å·¥æç²¾è´çé¥µæã</p>
<p><strong>ç¬èçå»ºè®®ï¼</strong><br>
å¦æä½ ç°å¨ç RAG ç³»ç»è¿å¨ä¸ºâè¡¨æ ¼è¯å«ä¸åâæâææ¡£ç»ææ··ä¹±âèç¦æ¼ï¼ä¸è¦æ¥çç ¸é±å»æ¢æ´è´µç LLM æ¥å£ï¼è¯çå¨è§£æå±å¼å¥ Doclingãä½ ä¼åç°ï¼ææ¶ååºå±çâåºå»ºâä¼åï¼æ¯ä¸å±çâç¼ä¸¹âæ´æå¥æã</p>


</div>
<div id="MySignature" role="contentinfo">
    <a href="https://www.cnblogs.com/jyzhao/" target="_blank">AlfredZhao</a>Â©çæææãä»Oracleèµ·èªï¼é¢ç¥ç²¾å½©çITææ¯ãã<br>
è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/jyzhao/p/19610038/rag-shi-dai-de-po-bi-ren-wei-shen-me-ni-de-da-mo-x" target="_blank">https://www.cnblogs.com/jyzhao/p/19610038/rag-shi-dai-de-po-bi-ren-wei-shen-me-ni-de-da-mo-x</a>
<hr>
<div style="text-align:center; margin-top:30px;">
  <p style="font-size:14px;color:#555;">
    ð æè°¢éè¯»ï¼æ¬¢è¿å³æ³¨æçå¬ä¼å· <b>ãèµµéå®ã</b>
  </p>
  <img src="https://images.cnblogs.com/cnblogs_com/jyzhao/824234/o_250208075013_qrcode-zjy.jpg" width="160" style="border:1px solid #ddd;border-radius:8px;">
</div>
</div>
<div class="clear"></div>

        <div class="clear"></div>
        
</div>
    <ul class="postmetadata">
        <vc:categories-tags blog-app="jyzhao" blog-id="186567" post-id="19610038"></vc:categories-tags>
    </ul>
 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ 3å¹´ï¼ä»0å°å¨çé¢è·ï¼ä¸å­é¿ææè§£DeepSeekå¤§æ¨¡åææ¯æ¼è¿ ]]></title>
    <link>https://www.cnblogs.com/aifrontiers/p/19608897</link>
    <guid>afe904a2b9cec0fb31a651bef3b8450d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/aifrontiers/p/19608897" title="åå¸äº 2026-02-12 16:15">
    <span role="heading" aria-level="2">3å¹´ï¼ä»0å°å¨çé¢è·ï¼ä¸å­é¿ææè§£DeepSeekå¤§æ¨¡åææ¯æ¼è¿</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>åæ: <a href="https://mp.weixin.qq.com/s/MG9nB7VYK-N4Q3RQFiwcuw" target="_blank" rel="noopener nofollow">https://mp.weixin.qq.com/s/MG9nB7VYK-N4Q3RQFiwcuw</a></p>
<p>å³æ³¨gzh: AI-Frontiers</p>
<p>èª2022å¹´chatgptåå¸ä»¥æ¥ï¼å¨çäººå·¥æºè½é¢åè¿å¥äºä»¥å¤§è¯­è¨æ¨¡åï¼LLMï¼ä¸ºæ ¸å¿çæ¿çåå¤ç«èµãOpenAIãGoogleãAnthropicç­ç¡è°·å·¨å¤´ï¼éè¿æ°ç¾äº¿ç¾åçèµæ¬æå¥åæ°ä¸å¼ H100GPUçç®åå å ï¼ä¸æ­å·æ°çæ¨¡åæºè½çä¸éãå¨è¿ç§å¤§ååºå¥è¿¹ï¼Scaling Lawsï¼çä¸»æµåäºä¸ï¼ç®åæä¸ºäºå¶çº¦æ¨¡ååå±çæ ¸å¿ç¡¬éè´§ï¼ä¹æå»ºäºæé«çè¡ä¸åå¥é¨æ§ã</p>
<p>ä¸åäºå½å¤éè¿å ç ç¡¬ä»¶æ¥è§£å³é®é¢çä¼ ç»è·¯å¾ï¼ä¸­å½æ­å·çAIååå¬å¸Deepseekï¼èµ°åºäºä¸æ¡æªç¶ä¸åçææ¯æ¼è¿è·¯çº¿ï¼å³å¯¹æè´æççè¿½æ±åå¯¹ç®æ³è¾¹ççæ¢ç´¢ï¼å¶ææ¯å²å­¦å¯ä»¥æ¦æ¬ä¸ºãç®æ³-ç¡¬ä»¶ååä¼åçæè´ä¸»ä¹ãã</p>
<p>DeepSeekä½ä¸ºä¸å®¶æºèªéåå¯¹å²åºéHigh-FlyerçAIç ç©¶æºæï¼æç«äº2023å¹´ï¼å¨ç­ç­ä¸å¹´åä»è·éèè¿éèåä¸ºå¨çå¤§æ¨¡åæ¶æåæ°çå¼é¢èãå¶ææ¯è·¯çº¿å±ç°åºé²æçé¿æä¸»ä¹ä¸æè´æçç¹å¾ï¼éè¿å¨æ¨¡åæ¶æãæ¨çç®æ³ãå¤æ¨¡æåè®­ç»åºç¡è®¾æ½åä¸ªç»´åº¦çæç»­çªç ´ï¼æåéå¡äºå¼æºå¤§æ¨¡åçæ§è½å¤©è±æ¿ã</p>
<p>DeepSeekçææ¯æ¼è¿å¯æ¸æ°å°ååä¸ºåä¸ªé¶æ®µï¼</p>
<ul>
<li>
<p><strong>åºç³å¥ å®æ¨¡åï¼2023å¹´ï¼ï¼</strong> ä»¥DeepSeek-CoderåDeepSeek-LLMä¸ºä»£è¡¨ï¼éªè¯äºå¨æéç®åä¸è®­ç»é«è´¨éç¨ å¯æ¨¡åçè½åï¼ç¡®ç«äºãä»£ç +æ°å­¦ãä¸ºæ ¸å¿ç«äºåçå·®å¼åè·¯çº¿ã</p>
</li>
<li>
<p><strong>æ¶æé©æ°ä¸<strong><strong>MOE</strong></strong>åï¼2024å¹´ï¼ï¼</strong> éè¿DeepSeek-V2åV3ï¼å¨å¤§æ¨¡åæ¶æåºå±è¿è¡äºé©å½æ§åæ°ãæåºäºå¤å¤´æ½å¨æ³¨æååç»ç²åº¦ä¸å®¶æ··åæ¶æï¼å½»åºè§£å³äºé¿ä¸ä¸ææ¨ççæ¾å­ç¶é¢ä¸è®­ç»ææ¬é®é¢ï¼ä»¥æä½çææ¬å®ç°äºå¯¹æ é¡¶å°é­æºæ¨¡åGPT-4 Turboçææã</p>
</li>
<li>
<p><strong>æ¨çä¸ç³»ç»2æç»´ï¼2025å¹´ï¼ï¼</strong> ä»¥DeepSeek-R1ä¸ºéç¨ç¢ï¼æ¢ç´¢åºçº¯å¼ºåå­¦ä¹ é©±å¨çæ¨çè½åæ¶ç°è·¯å¾ï¼è¯æäºæ éå¤§è§æ¨¡çç£å¾®è°ï¼å³å¯æ¿åæ¨¡åçèªæåæä¸ä¿®æ­£è½åãéåéè¿V3.1ãV3.2ç³»åå°è¿ç§ãæèãè½åæ³åè³å·¥å·è°ç¨ä¸Agentåºæ¯ã</p>
</li>
<li>
<p><strong>è®°å¿ä¸å æè§è§ï¼2025æ«-2026åï¼ï¼</strong> å¨DeepSeek-OCR-2ä¸­å¼å¥è§è§å ææµï¼å¨Engramæ¶æä¸­æåºåºäºæ¥è¡¨çå¯æ©å±æ¡ä»¶è®°å¿æºå¶ï¼è¯å¾ä»æ ¹æ¬ä¸çªç ´Transformerçä¸ä¸æé¿åº¦éå¶ä¸è§è§çè§£çé»è¾ç¼ºé·ï¼ä¸ºä¸ä¸ä»£æ¨¡åDeepSeek-V4å¥ å®åºç¡ã</p>
</li>
</ul>
<p>å®ç½åå¸ä¿¡æ¯ï¼è§ï¼<a href="https://api-docs.deepseek.com/news/news251201" target="_blank" rel="noopener nofollow">https://api-docs.deepseek.com/news/news251201</a></p>
<h1 id="tl-dræ»ç»ç">TL; DRï¼æ»ç»çï¼</h1>
<h2 id="deepseekæ¨¡åæ¼è¿æ¶é´çº¿æ±æ»2023-20260210">DeepSeekæ¨¡åæ¼è¿æ¶é´çº¿æ±æ»ï¼2023-2026.02.10ï¼</h2>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åå¸æ¥æ</td>
<td>æ¨¡ååç§°</td>
<td>æ ¸å¿åæ°/æ¶æ</td>
<td>å³é®ææ¯åæ°</td>
<td>å¯¹æ /æ§è½äº®ç¹</td>
</tr>
<tr>
<td>2023/11/2</td>
<td>DeepSeek Coder</td>
<td>1.3B/6.7B/33B</td>
<td>FIMé¢è®­ç», é¡¹ç®çº§ä¸ä¸æ</td>
<td>ä»£ç è½åè¶è¶CodeLlama-34B</td>
</tr>
<tr>
<td>2023/11/29</td>
<td>DeepSeek LLM</td>
<td>7B/67B</td>
<td>ç¨ å¯æ¶æ, ä¸­è±åè¯­å¯¹é½</td>
<td>67Bæç ´LLaMA 2 70Båæ­</td>
</tr>
<tr>
<td>2023/12/18</td>
<td>DreamCraft3D</td>
<td>N/A</td>
<td>3Dä¸è´æ§çæ</td>
<td>é«è´¨éæç3Dèµäº§</td>
</tr>
<tr>
<td>2024/2/5</td>
<td>DeepSeek-Math</td>
<td>7B</td>
<td>GRPOå¼ºåå­¦ä¹ , æç»éæ ·</td>
<td>æ°å­¦è½åé¼è¿GPT-4ï¼RLææ¯éªè¯</td>
</tr>
<tr>
<td>2024/3/11</td>
<td>DeepSeek-VL</td>
<td>1.3B/7B</td>
<td>æ··åè§è§ç¼ç å¨</td>
<td>çå®ä¸çè§è§çè§£ï¼é«åè¾¨çå¤ç</td>
</tr>
<tr>
<td>2024/5/7</td>
<td>DeepSeek-V2</td>
<td>236B (21Bæ¿æ´»)</td>
<td>MLA, DeepSeekMoE</td>
<td>éæ°å®ä¹MoEæ¶æï¼æ¾å­å ç¨é93%</td>
</tr>
<tr>
<td>2024/6/17</td>
<td>DeepSeek-Coder-V2</td>
<td>16B/236B</td>
<td>MoE for Code, 338ç§è¯­è¨</td>
<td>å¼æºæ¨¡åé¦æ¬¡å¨ä»£ç é¢åå¯¹é½GPT-4 Turbo</td>
</tr>
<tr>
<td>2024/9/6</td>
<td>DeepSeek-V2.5</td>
<td>236B</td>
<td>Chatä¸Coderåå¹¶</td>
<td>éç¨ä¸åç±»è½åç»ä¸ï¼ç¡¬çç¼å­API</td>
</tr>
<tr>
<td>2024/10/18</td>
<td>Janus</td>
<td>1.3B</td>
<td>è§è§çè§£/çæè§£è¦</td>
<td>è§£å³å¤æ¨¡æçè§£ä¸çæçå²çª</td>
</tr>
<tr>
<td>2024/12/13</td>
<td>DeepSeek-VL2</td>
<td>1B/2.8B/4.5B (æ¿æ´»)</td>
<td>MoEå¤æ¨¡æ, å¨æåè¾¨ç</td>
<td>æåOCRä¸å¾è¡¨çè§£è½å</td>
</tr>
<tr>
<td>2024/12/26</td>
<td>DeepSeek-V3</td>
<td>671B (37Bæ¿æ´»)</td>
<td>FP8è®­ç», MTP, æ æè´è½½åè¡¡</td>
<td>557ä¸ç¾åç»åºGPT-4oçº§æ¨¡åï¼å¼æºæ°åºåº§</td>
</tr>
<tr>
<td>2025/1/20</td>
<td>DeepSeek-R1</td>
<td>671B</td>
<td>çº¯RLè®­ç», æç»´é¾æ¶ç°, è¸é¦</td>
<td>Aha Momentï¼å¼å¯æ¨çå¤§æ¨¡åæ¶ä»£</td>
</tr>
<tr>
<td>2025/1/27</td>
<td>Janus-Pro</td>
<td>1B/7B</td>
<td>å¤æ¨¡æScaling</td>
<td>æ´å¼ºçæçå¾ä¸æä»¤éµå¾ª</td>
</tr>
<tr>
<td>2025/5/1</td>
<td>DeepSeek-Prover-V2</td>
<td>671B</td>
<td>å½¢å¼åè¯æ (Lean 4)</td>
<td>è§£å³æ°å­¦è¯ææ­¥éª¤åè§£é®é¢</td>
</tr>
<tr>
<td>2025/8/21</td>
<td>DeepSeek-V3.1</td>
<td>671B</td>
<td>æ··åæç»´æ¨¡å¼, Agentä¼å</td>
<td>å°R1çæèè½åæ³åè³Agentä»»å¡</td>
</tr>
<tr>
<td>2025/12/1</td>
<td>DeepSeek-V3.2</td>
<td>671B</td>
<td>DeepSeek Sparse Attention (DSA)</td>
<td>é¿ä¸ä¸ææççªç ´ï¼Thinking in Tool-Use</td>
</tr>
<tr>
<td>2026/1/3</td>
<td>mHC</td>
<td>N/A</td>
<td>å¼å¥å ä½çº¦æ</td>
<td>è¶å¤§è§æ¨¡æ¨¡åçä¿¡å·åæ£ä¸è®­ç»ä¸ç¨³å®æ§</td>
</tr>
<tr>
<td>2026/1/14</td>
<td>Engram (è®ºæ)</td>
<td>N/A</td>
<td>å¯æ©å±æ¥è¡¨è®°å¿</td>
<td>è§£å³è¶é¿ä¸ä¸æè®°å¿éå¿é®é¢</td>
</tr>
<tr>
<td>2026/1/27</td>
<td>DeepSeek-OCR-2</td>
<td>3B</td>
<td>è§è§å ææµ</td>
<td>æ¨¡æäººç±»éè¯»é¡ºåºï¼æè´ææ¡£çè§£</td>
</tr>
</tbody>
</table>
<h2 id="deepseekæ¨¡ååè½åç±»æ±æ»">DeepSeekæ¨¡ååè½åç±»æ±æ»</h2>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3719074/202602/3719074-20260212161129917-1761051077.png" class="lazyload"><br>
<img alt="8b843b06359b40d7ba1a91a59a820af1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3719074/202602/3719074-20260212161135127-145273109.png" class="lazyload"></p>
<h1 id="2023å¹´åºç³å¥ å®ä¸ç¨ å¯æ¨¡åæ¶ä»£">2023å¹´ï¼åºç³å¥ å®ä¸ç¨ å¯æ¨¡åæ¶ä»£</h1>
<p>2023å¹´æ¯å¤§æ¨¡åçåçåå¹´ãå¨LLaMAç­å¼æºæ¨¡åå¼åãç¾æ¨¡å¤§æãçèæ¯ä¸ï¼DeepSeekå¹¶æªæ¥äºåå¸å¯¹è¯æ¨¡åï¼èæ¯æéå°éæ©äºä»£ç ä½ä¸ºåå¥ç¹ï¼åºäºä¸¤ä¸ªæ ¸å¿å¤æ­ï¼â  ä»£ç æ°æ®å·ææå¼ºçé»è¾æ§ï¼æ¯æåæ¨¡åæ¨çè½åçæä½³è¯­æï¼â¡ ä»£ç çææ¯å¼åèæé«é¢çåéï¼ä¸å½æ¶å¼æºçå°ç¼ºä¹è½çæ­£å¯¹æ OpenAI Codexçæ¨¡åã</p>
<h2 id="deepseek-coderä»£ç æºè½çå´èµ·">DeepSeek Coderï¼ä»£ç æºè½çå´èµ·</h2>
<ul>
<li>
<p>åå¸æ¶é´: 2023å¹´11æ2æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ åç±»ä»£ç å¤§æ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ Fill-In-the-Middle (FIM) / Project-Level Context</p>
</li>
<li>
<p>è®ºæï¼<a href="https://arxiv.org/abs/2401.14196" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2401.14196</a></p>
</li>
<li>
<p>gitbubï¼<a href="https://github.com/deepseek-ai/DeepSeek-Coder" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-Coder</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=NWE2MGE5NThiYmNjNWE3YmNjNGRmZGRlYjI0ZDFkNzdfeHhUOTF2MUlWTTQyQmU0MUxpd0x2amlVanRjYk5ZY21fVG9rZW46S2RnYWI0THFjbzdQdWZ4anFIc2N2VVVZbjBjXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>DeepSeek Coderæ¯DeepSeekæ¨åºçé¦ä¸ªå·æå¹¿æ³å½±ååçæ¨¡åç³»åï¼åå«1.3Bã6.7Bã33Bç­å¤ç§å°ºå¯¸ãè¯¥ç³»åæ¨¡åå¹¶éç®åçå¾®è°ï¼èæ¯ä»é¶å¼å§é¢è®­ç»ã</p>
<ul>
<li>
<p><strong>æ°æ®ææä¸è®­ç»ç­ç¥ï¼</strong> æ¨¡åä½¿ç¨äº2ä¸äº¿ï¼2Tï¼Tokençé«è´¨éæ°æ®è¿è¡è®­ç»ï¼å¶ä¸­87%ä¸ºä»£ç ï¼13%ä¸ºä¸­è±æèªç¶è¯­è¨ãè¿ç§éæ¯ç¡®ä¿äºæ¨¡åæ¢å·å¤æ·±åçç¼ç¨ç¥è¯ï¼åæ¥ææµççæä»¤éµå¾ªè½å ã</p>
</li>
<li>
<p><strong>æ¶æäº®ç¹ï¼</strong></p>
<ul>
<li>
<p><strong>Fill-In-the-Middle (FIM)ï¼</strong> ä¸ºäºéåºIDEä¸­çä»£ç è¡¥å¨åºæ¯ï¼DeepSeek Coderå¨é¢è®­ç»é¶æ®µå¼å¥äºFIMä»»å¡ï¼å³è®©æ¨¡åæ ¹æ®ä¸ä¸æå¡«è¡¥ä¸­é´ç¼ºå¤±çä»£ç çæ®µãè¿ä¸è½åä½¿å¶å¨å®éç¼ç¨è¾å©ä¸­è¡¨ç°è¿è¶ä»æ¯æãä»å·¦å°å³ãçæçæ¨¡åã</p>
</li>
<li>
<p><strong>é¡¹ç®çº§ä¸ä¸æï¼Project-Level Contextï¼ï¼</strong> æ¨¡åæ¯æ16Kçä¸ä¸æçªå£ï¼è½å¤çè§£è·¨æä»¶çä»£ç ä¾èµå³ç³»ï¼è¿å¨å½æ¶æ¯å¼æºä»£ç æ¨¡åä¸­çé¢åæ°´å¹³ã</p>
</li>
</ul>
</li>
<li>
<p><strong>æ§è½è¡¨ç°ï¼</strong> å¨HumanEvalåMBPPç­åºåæµè¯ä¸­ï¼DeepSeek Coder 33Bä¸ä»è¶è¶äºåéçº§çCodeLlama-34Bï¼çè³å¨é¨åææ ä¸é¼è¿äºGPT-3.5 Turboï¼ç¡®ç«äºDeepSeekå¨ä»£ç é¢åçé¢åå°ä½ã</p>
</li>
</ul>
<h2 id="deepseek-llm-67béç¨è½åçå¨é¢å¯¹æ ">DeepSeek LLM (67B)ï¼éç¨è½åçå¨é¢å¯¹æ </h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2023å¹´11æ29æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ éç¨ç¨ å¯å¤§æ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ ä¸­è±åè¯­å¯¹é½/è§æ¨¡åè®­ç»ç¨³å®æ§</p>
</li>
<li>
<p>è®ºæï¼<a href="https://arxiv.org/abs/2401.02954" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2401.02954</a></p>
</li>
<li>
<p>githubï¼<a href="https://github.com/deepseek-ai/DeepSeek-LLM" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-LLM</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=OTU4MzI4ZjEyYTAyMTNmMmMzMzQwMmRiY2Y2ZThiM2JfejJiWUxmbnNIc21wenpqMTlmSnNSMlEyaERQekllbU5fVG9rZW46WDZjQ2JlN0JFb2dzeFN4RFV0VmMxeGdobmtlXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>å¨ä»£ç æ¨¡ååå¾æååï¼DeepSeekè¿éåå¸äºéç¨å¤§æ¨¡åDeepSeek LLM 67Bãè¿æ¯ä¸­å½é¦ä¸ªå®å¨å¼æºåæ°éè¾¾å°670äº¿çº§å«çæ¨¡åï¼ç´æ¥å¯¹æ MetaçLLaMA-2 70Bã</p>
<ul>
<li>
<p><strong>åè¯­ä¼å¿ï¼</strong> ç¸æ¯LLaMA-2ä¸»è¦ä»¥è±è¯­ä¸ºä¸»ï¼DeepSeek LLMå¨é¢è®­ç»æ°æ®ä¸­å¤§å¹å¢å äºä¸­æè¯­æçæéï¼ä½¿å¶å¨ä¸­æçè§£ãæåå¸¸è¯åé»è¾æ¨çä¸è¡¨ç°åºæ¾èä¼å¿ã</p>
</li>
<li>
<p><strong>æ¨çä¸æ°å­¦è½åï¼</strong> ç»§æ¿äºDeepSeek Coderçåºå ï¼DeepSeek LLMå¨æ°å­¦æ¨çï¼GSM8Kï¼åé»è¾æ¨æ­ä»»å¡ä¸è¡¨ç°åºè²ï¼è¯æäºãä»£ç è®­ç»æåéç¨æ¨çãçåè®¾ã</p>
</li>
<li>
<p><strong>å¼æºç­ç¥ï¼</strong> DeepSeekä¸ä»å¼æºäºæ¨¡åæéï¼è¿å¼æ¾äºä¸­é´æ£æ¥ç¹ï¼Checkpointsï¼ï¼æå¤§å°ä¿è¿äºå­¦æ¯çå¯¹å¤§æ¨¡åè®­ç»å¨æçç ç©¶ï¼å±ç¤ºäºDeepSeekç¬ç¹çå¼æºç²¾ç¥ï¼æä¾ç»æï¼æ´æä¾è¿ç¨ã</p>
</li>
</ul>
<h2 id="dreamcraft3då¤æ¨¡æçæçæ©ææ¢ç´¢">DreamCraft3Dï¼å¤æ¨¡æçæçæ©ææ¢ç´¢</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2023å¹´12æ18æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ æç3Dåå®¹çæ</p>
</li>
<li>
<p>ææ¯åæ°ï¼ 3Dä¸è´æ§ä¼å</p>
</li>
<li>
<p>è®ºæï¼<a href="https://arxiv.org/abs/2310.16818" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2310.16818</a></p>
</li>
<li>
<p>github: <a href="https://github.com/deepseek-ai/DreamCraft3D" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DreamCraft3D</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=NGQzYjNiYjJiOWEwMDAyYTU2OWM4MWU1MTM0MTVlMDBfZW1XQ01CbmNzampldE1QdzNldkZuYTlKeG8yYjFkUHdfVG9rZW46UmFjb2JiOWo5bzl0ZlF4OEw4MGMxV1VRbkFnXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>é¤äºè¯­è¨æ¨¡åï¼DeepSeekå¨2023å¹´åºè¿æ¢ç´¢äºå¤æ¨¡æçæé¢åãDreamCraft3Dæ¯ä¸ä¸ªè½å¤ä»ææ¬æè¿°çæé«ä¿ç3Dèµäº§çæ¨¡åãå®éè¿è§£å³å¤è§è§ä¸è´æ§é®é¢ï¼å®ç°äºä»2Då¾åå°3Då ä½çé«è´¨éè½¬æ¢ï¼ä¸ºåç»­çJanusç³»åå¥ å®äºå¤æ¨¡æææ¯ç§¯ç´¯ã</p>
<ul>
<li>
<p><strong>æ¶æäº®ç¹</strong>ï¼</p>
<ul>
<li>
<p>åå±ä¼åæµæ°´çº¿ï¼å ä½éå»é¶æ®µèå 2D+3D æ··å SDS æå¤±ãæ©æ£æ¶é´æ­¥éç«ãæ¸è¿å¼è§è§è®­ç»ç­ç­ç¥ï¼ä» NeuS éå¼è¡¨é¢è¡¨ç¤ºè¿æ¸¡å° DMTet ç½æ ¼è¡¨ç¤ºï¼ç¡®ä¿ 3D å ä½çå¤è§è§ä¸è´æ§ï¼çº¹çå¢å¼ºé¶æ®µæåºèªä¸¾å¼åæ°è¸é¦ï¼BSDï¼ï¼éè¿äº¤æ¿ä¼å 3D åºæ¯ä¸ DreamBooth ä¸ªæ§åæ©æ£æ¨¡åï¼å®ç°çº¹çç»èä¸è§è§ä¸è´æ§çç¸äºå¼ºåã</p>
</li>
<li>
<p>3D æç¥åéªèåï¼å¼å¥ Zero-1-to-3 è§å¾æ¡ä»¶æ©æ£æ¨¡åæä¾ä¸°å¯ 3D åéªï¼ç¼è§£åå¾çæçè§è§æ¨¡ç³æ§ï¼å©ç¨å¤è§å¾æ¸²æå¢å¼ºä¸é«æ¯åªå£°æ°å¨ï¼è®©æ©æ£æ¨¡åå­¦ä¹ åºæ¯ä¸å± 3D ç¥è¯ï¼çªç ´åºå®åå¸è¸é¦çå±éã</p>
</li>
</ul>
</li>
<li>
<p><strong>æ§è½è¡¨ç°</strong>ï¼å¨åå« 300 å¼ å¾åçæµè¯åºåä¸ï¼CLIP å¾åï¼0.896ï¼ãPSNRï¼31.801ï¼å LPIPSï¼0.005ï¼åæ¾èè¶è¶ Make-it-3DãMagic123 ç­ä¸»æµæ¹æ³ï¼ç¨æ·ç ç©¶ä¸­ 92% çåä¸èæ´åå¥½å¶çæç»æï¼å¨ 360Â° æ¸²æä¸­å±ç°åºæ´éå©çå ä½ç»èåé¼ççº¹çï¼ææè§£å³äºä¼ ç»æ¨¡åçè¯­ä¹ä¸ä¸è´é®é¢ï¼æ¨è¿äº 3D çæçææ¯ä¸éã</p>
</li>
</ul>
<h1 id="2024å¹´ä¸æ¶æé©å½ä¸moemlaçæåº">2024å¹´ï¼ä¸ï¼ï¼æ¶æé©å½ä¸MoE/MLAçæåº</h1>
<p>è¿å¥2024å¹´ï¼å¤§æ¨¡åç«äºè¿å¥æ·±æ°´åºãéçæ¨¡ååæ°éçè¨èï¼è®­ç»ææ¬åæ¨çæ¾å­å ç¨æä¸ºå¶çº¦åå±çæ ¸å¿ç¶é¢ãDeepSeekå¨è¿ä¸é¶æ®µå®æäºä»ãæ¶æè·éãå°ãæ¶æåæ°ãçåä¸½è½¬èº«ï¼æåºäºæ¹åè¡ä¸çMLAåDeepSeekMoEæ¶æã</p>
<h2 id="deepseek-mathå¼ºåå­¦ä¹ æ¨ççåå£°">DeepSeek-Mathï¼å¼ºåå­¦ä¹ æ¨ççåå£°</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2024å¹´2æ5æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ æ°å­¦æ¨çæ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ Group Relative Policy Optimization (GRPO)</p>
</li>
<li>
<p>è®ºæï¼<a href="https://arxiv.org/abs/2402.03300" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2402.03300</a></p>
</li>
<li>
<p>gitbubï¼<a href="https://github.com/deepseek-ai/DeepSeek-Math" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-Math</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=MDBlNDk2NDg5YmE0MDZiNjU3ZWYyYzNjMWM2Y2RiNzhfVGZXQXBKSDkwVkJmMWJ6ZzVUQ2dHTWx6bW5kdUhmZFpfVG9rZW46QkpqeWJJemlhb2NSWWh4ZmV3SGNVWVBGbjZjXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>DeepSeek-Math 7Bè½ç¶åæ°è§æ¨¡ä¸å¤§ï¼ä½å¶ææ¯æä¹æ·±è¿ãå®æ¯DeepSeeké¦æ¬¡å¤§è§æ¨¡åºç¨å¼ºåå­¦ä¹ ï¼RLï¼æ¥æåæ¨çè½åï¼å¹¶ä¸ºæ­¤åæäºGRPOï¼Group Relative Policy Optimizationï¼ç®æ³ã</p>
<ul>
<li>
<p><strong>GRPOç®æ³è¯¦è§£ï¼</strong> ä¼ ç»çRLHFï¼åºäºäººç±»åé¦çå¼ºåå­¦ä¹ ï¼éå¸¸ä¾èµPPOç®æ³ï¼éè¦è®­ç»ä¸ä¸ªä¸ç­ç¥æ¨¡ååç­å¤§å°çè¯è®ºå®¶æ¨¡åï¼è¿ä¼å¸¦æ¥ååçæ¾å­åè®¡ç®å¼éãDeepSeek-MathæåºçGRPOç®æ³æå¼äºè¯è®ºå®¶æ¨¡åï¼èæ¯éè¿å¯¹åä¸é®é¢éæ ·å¤ç»è¾åºï¼Group Samplingï¼ï¼å©ç¨ç»åè¾åºçç¸å¯¹ä¼å£æ¥è®¡ç®ä¼å¿å½æ°ãè¿ä¸åæ°ä¸ä»å¤§å¹éä½äºRLè®­ç»ææ¬ï¼è¿æé«äºè®­ç»ç¨³å®æ§ï¼ä¸º2025å¹´DeepSeek-R1ççååä¸äºä¼ç¬ã</p>
</li>
<li>
<p><strong>æ§è½ï¼</strong> å¨MATHåºåæµè¯ä¸­ï¼DeepSeek-Math 7Bå­åGRPOåç²¾éçæ°çæ°æ®ï¼å»è´¥äºä¼å¤70Bçº§å«çå¼æºæ¨¡åï¼çè³å¨é¨åææ ä¸é¼è¿GPT-4ã</p>
</li>
</ul>
<h2 id="deepseek-vlè¿åçå®ä¸ççè§è§çè§£">DeepSeek-VLï¼è¿åçå®ä¸ççè§è§çè§£</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2024å¹´3æ11æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ å¤æ¨¡æçè§£æ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ æ··åè§è§ç¼ç å¨ï¼Hybrid Vision Encoderï¼</p>
</li>
<li>
<p>è®ºæ: <a href="https://arxiv.org/abs/2403.05525" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2403.05525</a></p>
</li>
<li>
<p>github: <a href="https://github.com/deepseek-ai/DeepSeek-VL" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-VL</a></p>
</li>
</ul>
<p>DeepSeek-VLï¼1.3B/7Bï¼çè®¾è®¡å²å­¦æ¯å®ç¨ä¸»ä¹ãä¸åäºå½æ¶è®¸å¤å¤æ¨¡ææ¨¡åä¸æ³¨äºç®ç­ççå¾è¯´è¯ï¼DeepSeek-VLçéäºå¤ççå®ä¸çä¸­çå¤æè§è§ä»»å¡ï¼å¦é»è¾å¾è¡¨åæãç½é¡µä»£ç è½¬æ¢ãOCRè¯å«ç­ã</p>
<ul>
<li><strong>æ¶æè®¾è®¡ï¼</strong> éç¨äºæ··åè§è§ç¼ç å¨æ¶æï¼ç»åäºç¨äºæåé«å±è¯­ä¹çSigLIPåç¨äºææä½å±ç»èçSAM-Bï¼Segment Anything Modelï¼ãè¿ç§è®¾è®¡ä½¿å¾æ¨¡åå¨å¤çé«åè¾¨çï¼1024x1024ï¼å¾åæ¶ï¼æ¢è½ä¿æå¨å±çè§£ï¼åä¸ä¼ä¸¢å¤±å³é®çæå­åç»èä¿¡æ¯ã</li>
</ul>
<h2 id="deepseek-v2moeä¸mlaçéç¨ç¢">DeepSeek-V2ï¼MoEä¸MLAçéç¨ç¢</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2024å¹´5æ</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ ç»æµé«æçMoEéç¨å¤§æ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ Multi-Head Latent Attention (MLA) / DeepSeekMoE</p>
</li>
<li>
<p>è®ºæï¼<a href="https://arxiv.org/abs/2405.04434" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2405.04434</a></p>
</li>
<li>
<p>github: <a href="https://github.com/deepseek-ai/DeepSeek-V2" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-V2</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=NjVmMzI5YTJkZjY4NTc5YTI2OWQ2MzUzM2ViOWVkMjBfamZYZlNDU1NoNXd3a3M2eXJQWDd1T0FBSlBJU2RlVHZfVG9rZW46R3N1NWJBVGlHb0VWVjd4b2hNYWNoTEpKblFaXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>DeepSeek-V2æ¯DeepSeekåå±å²ä¸çå³é®è½¬æç¹ãå®ä¸ä»æ¯ä¸ä¸ªæ¨¡åï¼æ´æ¯ä¸å¥å¨æ°çé«ææ¶ææ åã</p>
<ul>
<li>
<p><strong>Multi-Head Latent Attention (<strong><strong>MLA</strong></strong>)ï¼</strong></p>
<ul>
<li>
<p><strong>èæ¯ï¼</strong> å¨é¿ä¸ä¸ææ¨çä¸­ï¼KV Cacheï¼é®å¼ç¼å­ï¼ä¼å ç¨æµ·éæ¾å­ï¼éå¶äºBatch Sizeåæ¨çéåº¦ã</p>
</li>
<li>
<p><strong>åçï¼</strong> MLAéè¿ä½ç§©åç¼©ææ¯ï¼å°KV Cacheåç¼©ä¸ºä¸ä¸ªæ½å¨åéï¼Latent Vectorï¼ï¼å¤§å¹åå°äºæ¨çæ¶çæ¾å­å ç¨ã</p>
</li>
<li>
<p><strong>ææï¼</strong> ç¸æ¯æ åå¤å¤´æ³¨æåææ¯ï¼MLAå°KV Cacheåå°äº93.3%ï¼ä½¿å¾DeepSeek-V2å¨åå¡ä¸å°±è½æ¯ææé¿çä¸ä¸æçªå£ï¼å¹¶å°æ¨çååéæåäº5.76åã</p>
</li>
</ul>
</li>
<li>
<p><strong>DeepSeekMoEï¼</strong></p>
<ul>
<li>
<p><strong>ç»ç²åº¦ä¸å®¶ï¼Fin****e-grained Expertsï¼ï¼</strong> ä¸åäºMixtralç­æ¨¡åå°FFNä½ä¸ºä¸ä¸ªå¤§ä¸å®¶ï¼DeepSeekMoEå°ä¸å®¶ååå¾æ´ç»ï¼ä½¿å¾ç¥è¯åéæ´å çµæ´»ã</p>
</li>
<li>
<p><strong>å±äº«ä¸å®¶ï¼Share****d Expertsï¼ï¼</strong> ä¸é¨è®¾ç½®ä¸é¨åä¸å®¶å§ç»å¤äºæ¿æ´»ç¶æï¼ç¨äºææéç¨ç¥è¯ï¼èè·¯ç±ä¸å®¶ä¸æ³¨äºç¹å®é¢åç¥è¯ãè¿ç§âå±äº«+è·¯ç±âçæºå¶ææè§£å³äºMoEæ¨¡åè®­ç»ä¸­çç¥è¯åä½åè·¯ç±åç¼©é®é¢ã</p>
</li>
</ul>
</li>
<li>
<p><strong>ç»¼åæè½ï¼</strong> DeepSeek-V2æ»åæ°236Bï¼æ¿æ´»åæ°ä»21Bï¼è®­ç»ææ¬èçäº42.5%ï¼æ§è½å´è¶è¶äºLLaMA 3 70Bï¼ä¸ä»æä¸ºå½æ¶æå¼ºçå¼æºMoEæ¨¡åï¼æ´å°APIä»·æ ¼æå°äºç½èä»·1å/ç¾ä¸Tokensã</p>
</li>
</ul>
<h2 id="deepseek-coder-v2ä»£ç è½åçå¨é¢çå">DeepSeek-Coder-V2ï¼ä»£ç è½åçå¨é¢çå</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2024å¹´6æ17æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ ä»£ç MoEæ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ 338ç§ç¼ç¨è¯­è¨æ¯æ</p>
</li>
<li>
<p>è®ºæï¼<a href="https://arxiv.org/abs/2406.11931" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2406.11931</a></p>
</li>
<li>
<p>github: <a href="https://github.com/deepseek-ai/DeepSeek-Coder-V2" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-Coder-V2</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=NmQyZDk0MThkZjJkZmUxMGQ3NWMzZTc0NGVhMGY1NTJfUm5FcUhoeXo4dW9mdVhHTjcwWGNad1VBd05sTEV4ZmlfVG9rZW46TEN0SGJPTzUyb2VkVTR4ZElMMWNWUVpMbkljXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>DeepSeek-Coder-V2æ¯V2æ¶æå¨ä»£ç é¢åçå»¶ç»­ãå®å¨DeepSeek-V2çä¸­é´æ£æ¥ç¹åºç¡ä¸ï¼é¢å¤ä½¿ç¨äº6ä¸äº¿ï¼6Tï¼Tokençé«è´¨éä»£ç åæ°å­¦æ°æ®è¿è¡æç»­é¢è®­ç»ã</p>
<ul>
<li>
<p><strong>å¤è¯­è¨æ¯æï¼</strong> æ¯æçç¼ç¨è¯­è¨ä»86ç§æ©å±å°äº338ç§ï¼å ä¹è¦çäºææä¸»æµåå·é¨è¯­è¨ã</p>
</li>
<li>
<p><strong>æ§è½è·åï¼</strong> é¦ä¸ªå¨ä»£ç çæåæ°å­¦æ¨çè½åä¸è½ä¸é­æºæ¨¡åGPT-4 Turboä¸è¾é«ä¸çå¼æºæ¨¡åãå¨HumanEvalãMBPP+ç­æ¦åä¸ï¼å¶è¡¨ç°ä»¤äººéæï¼è¯æäºMoEæ¶æå¨åç±»ä»»å¡ä¸çå·¨å¤§æ½å ã</p>
</li>
</ul>
<h1 id="2024å¹´ä¸èåä¼åä¸v3çè¯ç">2024å¹´ï¼ä¸ï¼ï¼èåãä¼åä¸V3çè¯ç</h1>
<p>2024å¹´ä¸åå¹´ï¼DeepSeekä¸æ¹é¢è´åäºæ¨¡ååè½çèåä¸å¯¹é½ï¼å¦ä¸æ¹é¢å¨åºç¡è®¾æ½å±é¢è¿è¡åºå±ä¼åï¼ä¸ºV3çåå¸ç§¯èåéã</p>
<h2 id="deepseek-v25chatä¸coderçåäºä¸ºä¸">DeepSeek-V2.5ï¼Chatä¸Coderçåäºä¸ºä¸</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2024å¹´9æ6æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ èåæ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ äººç±»åå¥½å¯¹é½ä¼å</p>
</li>
<li>
<p>è®ºæ: <a href="https://arxiv.org/pdf/2405.04434" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/2405.04434</a></p>
</li>
<li>
<p>github: <a href="https://github.com/deepseek-ai/DeepSeek-V2" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-V2</a></p>
</li>
<li>
<p>HuggingFace1: <a href="https://huggingface.co/deepseek-ai/DeepSeek-V2.5" target="_blank" rel="noopener nofollow">https://huggingface.co/deepseek-ai/DeepSeek-V2.5</a></p>
</li>
<li>
<p>HuggingFace2: <a href="https://huggingface.co/deepseek-ai/DeepSeek-V2.5-1210" target="_blank" rel="noopener nofollow">https://huggingface.co/deepseek-ai/DeepSeek-V2.5-1210</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=N2IwZGE5Y2ZmN2E5ZDc2NGZjOWZmM2Y3YWFmMGM4NzZfeDRaSUZsRWM0VUNEM0VNbFozRjFwbjhRMkVDSGxQZUxfVG9rZW46UWlDVGJudjZjb1ZtRkh4Wk5aUWMzREV6bmtoXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>æ­¤åï¼DeepSeekåæ¶ç»´æ¤Chatï¼éç¨ï¼åCoderï¼ä»£ç ï¼ä¸¤æ¡äº§åçº¿ãDeepSeek-V2.5çåå¸æ å¿çè¿ä¸¤æ¡è·¯çº¿çåå¹¶ãéè¿ç²¾ç»çæ°æ®éæ¯åå¼ºåå­¦ä¹ å¯¹é½ï¼V2.5å¨ä¿çCoder-V2å¼ºå¤§ä»£ç è½åçåæ¶ï¼å¤§å¹æåäºéç¨å¯¹è¯åæä»¤éµå¾ªè½åï¼ä½¿å¾ç¨æ·ä¸åéè¦å¨ä¸åæ¨¡åé´åæ¢ãè¿ä¸çæ¬ä¹å¼å¥äºéå¯¹APIç¨æ·çç¡¬çç¼å­ï¼Context Caching on Diskï¼ææ¯ï¼è¿ä¸æ­¥éä½äºä½¿ç¨ææ¬ ã</p>
<ul>
<li>
<p><strong>æ°æ®ææä¸è®­ç»ç­ç¥</strong>ï¼åºäº8.1Té«è´¨éå¤æº Token é¢è®­ç»ï¼ä¸­æTokenå æ¯ç¥é«äºè±æï¼ï¼ç»å»ååè´¨éç­éï¼éè¿150ä¸ä¼è¯SFTåä¸¤é¶æ®µRLå¯¹é½äººç±»åå¥½ï¼åå«èç¦æ¨çä¼åä¸å¤å¥å±ä¿¡å·èåã</p>
</li>
<li>
<p><strong>æ¶æäº®ç¹</strong>ï¼</p>
<ul>
<li>
<p>MLAï¼ä½ç§© KV èååç¼© + è§£è¦RoPEï¼åå°93.3%KV ç¼å­ï¼å¼é¡¾æ§è½ä¸æ¨çæçã</p>
</li>
<li>
<p>DeepSeekMoE ç¨çæ¶æï¼ç»ç²åº¦ä¸å®¶åå² + å¤éè´è½½åè¡¡ç­ç¥ï¼éä½è®­ç»ææ¬å¹¶é¿åè·¯ç±å´©æºä¸éä¿¡è¿è½½ã</p>
</li>
<li>
<p>128K é¿ä¸ä¸æï¼åºäºYaRNæ¹æ³æ©å±ï¼32Kè®­ç»åºåå®ç°128Kç¨³å®æ§è½ï¼âNeedle In A Haystackâ æµè¯è¡¨ç°ä¼å¼ã</p>
</li>
</ul>
</li>
<li>
<p><strong>æ§è½è¡¨ç°</strong>ï¼å¨ä»21Bæ¿æ´»åæ°çæåµä¸ï¼åºåº§æ¨¡åå¨ MMLUãBBH ç­åºåè·»èº«å¼æºç¬¬ä¸æ¢¯éï¼Chatï¼RLï¼çæ¬ MT-Bench 8.97 åãAlpacaEval 2.0 èç 38.9%ï¼ä¸­æ AlignBench 7.91 åè¶å¤æ°é­æºæ¨¡åï¼è®­ç»ææ¬é 42.5%ï¼çæååéæåè³ 5.76 åã</p>
</li>
</ul>
<h2 id="janus--janusflowå¤æ¨¡æçè§£ä¸çæçè§£è¦">Janus &amp; JanusFlowï¼å¤æ¨¡æçè§£ä¸çæçè§£è¦</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2024å¹´10æï¼Janusï¼ï¼11æï¼JanusFlowï¼</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ ç»ä¸å¤æ¨¡ææ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ è§£è¦è§è§ç¼ç ï¼Decoupling Visual Encodingï¼</p>
</li>
<li>
<p>è®ºæï¼<a href="https://arxiv.org/abs/2410.13848" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2410.13848</a></p>
</li>
<li>
<p>github: <a href="https://github.com/deepseek-ai/Janus" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/Janus</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=OWUzNGFjMjAzNWQ1NzA2NDJkZTdiZGU0M2YwN2QwY2VfM3lCYXNPaGM1VEhlcUNRb2FFMjdxZmpaZ1RSTk1TR3JfVG9rZW46SXUyZGI5YklEb2lsczB4bGhJT2NqdjRTbm1jXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>å¨Janusä¹åï¼ä¸ççå¤æ¨¡ææ¨¡åéå¸¸é¾ä»¥å¼é¡¾çè§£ï¼çå¾ï¼åçæï¼ç»å¾ï¼ï¼å ä¸ºä¸¤èçè§è§è¡¨å¾éæ±æªç¶ä¸åãDeepSeekæåºäºJanusæ¶æï¼åé æ§å°å°è§è§ç¼ç è§£è¦ï¼</p>
<ul>
<li>
<p><strong>çè§£è·¯å¾ï¼</strong> ä½¿ç¨SigLIPæåé«ç»´è¯­ä¹ç¹å¾ã</p>
</li>
<li>
<p><strong>çæè·¯å¾ï¼</strong> ä½¿ç¨VQ Tokenizeræåç¦»æ£è§è§Tokenã ä¸¤èéè¿åä¸ä¸ªTransformeråºåº§è¿è¡å¤çï¼äºä¸å¹²æ°ãéååå¸ç<strong>JanusFlow</strong>æ´æ¯å¼å¥äºæ´æµæµï¼Rectified Flowï¼ææ¯ï¼æ¿ä»£ä¼ ç»çèªåå½çæï¼å¤§å¹æåäºå¾åçæçè´¨éåéåº¦ã</p>
</li>
</ul>
<h2 id="deepseek-v3å®ä¹å¼æºæ°æ å">DeepSeek-V3ï¼å®ä¹å¼æºæ°æ å</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2024å¹´12æ26æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ æè°MoEæ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ FP8è®­ç»/æ è¾å©æå¤±è´è½½åè¡¡/å¤Tokené¢æµ</p>
</li>
<li>
<p>è®ºæï¼<a href="https://arxiv.org/abs/2412.19437" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2412.19437</a></p>
</li>
<li>
<p>github: <a href="https://github.com/deepseek-ai/DeepSeek-V3" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-V3</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=OWRlNTk1NzJhN2U0MTY5ZWRhM2NiMGQxZGQ0MDA3OGRfU1BNR1RJOUhGRnNGdllYaEZsUEdFajh1OFhycHNyT0JfVG9rZW46RWsyUmJ3ZDlNb0hpc2J4QTN3QmNSUURhbktiXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>DeepSeek-V3æ¯2024å¹´çæ¶å®ä¹ä½ï¼ä¹æ¯DeepSeekææ¯å®åçéå¤§æèãå®ä¸ä»æ¯ä¸ä¸ªæ¨¡åï¼æ´æ¯ä¸æ¬¡å¯¹AIåºç¡è®¾æ½çæéææã</p>
<ul>
<li>
<p><strong>FP8æ··åç²¾åº¦è®­ç»ï¼</strong> V3æ¯å¨çé¦ä¸ªå¨è¶å¤§è§æ¨¡ï¼671Båæ°ï¼ä¸æåéªè¯FP8ï¼8ä½æµ®ç¹æ°ï¼è®­ç»çæ¨¡åãéè¿æ·±åº¦ä¼åçFP8 GEMMåæ ¸ï¼V3æå¤§åå°äºæ¾å­å¸¦å®½åååéä¿¡å¼éï¼ä½¿å¾è®­ç»ææ¬ä»ä¸º557ä¸ç¾åï¼278.8ä¸H800 GPUæ¶ï¼ï¼éæäºå¨çä¸çã</p>
</li>
<li>
<p><strong>æ è¾å©æå¤±<strong><strong>è´è½½åè¡¡</strong></strong>ï¼Auxiliary-Loss-Free Load Balancingï¼ï¼</strong> ä¼ ç»MoEä¾èµè¾å©æå¤±ï¼Auxiliary Lossï¼æ¥å¼ºè¿«ä¸å®¶è´è½½åè¡¡ï¼ä½ä¼å¹²æ°æ¨¡åçä¸»ä»»å¡å­¦ä¹ ãV3åæ°æ§å°éç¨äºåºäºåç½®çå¨æåè¡¡ç­ç¥ï¼å¨ä¸çºç²æ¨¡åæ§è½çåæä¸å®ç°äºå®ç¾çè´è½½åè¡¡ã</p>
</li>
<li>
<p><strong>å¤Tokené¢æµï¼Multi-Token Prediction, MTPï¼ï¼</strong> V3å¨è®­ç»æ¶ä¸ååªé¢æµä¸ä¸ä¸ªTokenï¼èæ¯åæ¶é¢æµåç»­å¤ä¸ªTokenãè¿ç§æºå¶å¢å äºè®­ç»ä¿¡å·çå¯åº¦ï¼æåäºæ¨¡åçé¿ç¨è§åè½åï¼å¹¶æ¯ææ¨çæ¶çææºè§£ç ï¼ä½¿çæéåº¦æåäº3åã</p>
</li>
<li>
<p><strong>DualPipeï¼</strong>ä¸ºäºè§£å³å¤§è§æ¨¡MoEè®­ç»ä¸­çè·¨èç¹éä¿¡ç¶é¢ï¼DeepSeekç åäºDualPipeç®æ³ï¼å®ç°äºè®¡ç®ä¸éä¿¡çå®å¨éå ï¼å°ç¡¬ä»¶å©ç¨çæ¨åæè´ã</p>
</li>
</ul>
<p>DeepSeek-V3å¨ç¾ç§ç¥è¯ãæ°å­¦ãä»£ç ç­ç»´åº¦çè¡¨ç°å¨é¢å¯¹æ GPT-4oåClaude 3.5 Sonnetï¼æä¸ºå½æ¶æå¼ºçå¼æºåºåº§æ¨¡åã</p>
<h1 id="2025å¹´ä¸æ¨çæ¨¡åä¸agentçå¨é¢è¿å">2025å¹´ï¼ä¸ï¼ï¼æ¨çæ¨¡åä¸Agentçå¨é¢è¿å</h1>
<p>2025å¹´ï¼DeepSeekå¼é¢äºä»ãç¥è¯ç§¯ç´¯ï¼System 1ï¼ãåãæ·±åº¦æ¨çï¼System 2ï¼ãçèå¼è½¬ç§»ãéè¿å¼ºåå­¦ä¹ æ¿åæ¨¡åçæèè½åæä¸ºè¿ä¸é¶æ®µçä¸»æå¾ã</p>
<h2 id="deepseek-r1çº¯å¼ºåå­¦ä¹ çå¥ç¹">DeepSeek-R1ï¼çº¯å¼ºåå­¦ä¹ çå¥ç¹</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2025å¹´1æ20æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ æ¨çæ¨¡åï¼Reasoning Modelï¼</p>
</li>
<li>
<p>ææ¯åæ°ï¼ çº¯RLè®­ç»/æç»´é¾æ¶ç°/è¸é¦</p>
</li>
<li>
<p>è®ºæï¼<a href="https://arxiv.org/abs/2501.12948" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2501.12948</a></p>
</li>
<li>
<p>GitHubä»£ç ï¼<a href="https://github.com/deepseek-ai/DeepSeek-R1" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-R1</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=NTgxYWY4MTRmOWE0YjFlYzFhOTQ4YWU2ZDYzNDFjZDFfSW1mOVRDblAyRUppa2l1cXFYdjhyWVZtTEJWbXJrdjdfVG9rZW46QjR1VWJCZ3N4bzZGUkV4bFdBZGMxaGRablBlXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>DeepSeek-R1çåå¸å¼åäºå¨çèå´åçã R1æ¶å»ããå®è¯æäºæ¨çè½åå¯ä»¥éè¿çº¯å¼ºåå­¦ä¹ æ¶ç°ï¼èæ éå¤§éçäººå·¥æ æ³¨æ°æ®ã</p>
<ul>
<li>
<p><strong>DeepSeek-R1-Zeroï¼</strong> R1çåèº«ï¼éè¿å¨V3åºåº§ä¸ç´æ¥åºç¨GRPOç®æ³è¿è¡çº¯RLè®­ç»ãæ¨¡åå¨è®­ç»è¿ç¨ä¸­èªç¶æ¶ç°åºäºèªæåæãéªè¯åé¿æç»´é¾ï¼Chain-of-Thoughtï¼è½åï¼çè³åºç°äºãé¡¿æï¼Aha Momentãç°è±¡ãè½ç¶R1-Zeroå­å¨è¯­è¨æ··æåå¯è¯»æ§å·®çé®é¢ï¼ä½éªè¯äºRLæ¿åæ¨çæ½åçå¯è¡æ§ã</p>
</li>
<li>
<p><strong>DeepSeek-R1æ­£å¼çï¼</strong> ä¸ºäºè§£å³Zeroççé®é¢ï¼æ­£å¼çR1éç¨äºãå·å¯å¨æ°æ®+RLãçå¤é¶æ®µè®­ç»ç®¡çº¿ã</p>
<ul>
<li>
<p><strong>å·å¯å¨ï¼</strong> ä½¿ç¨å°éé«è´¨éçé¿æç»´é¾æ°æ®å¾®è°V3ï¼ä½¿å¶å­¦ä¼è§èçæèæ ¼å¼ã</p>
</li>
<li>
<p><strong>æ¨ç<strong><strong>RL</strong></strong>ï¼</strong> ä½¿ç¨GRPOè¿è¡å¤§è§æ¨¡å¼ºåå­¦ä¹ ï¼æåè§£å³å¤ææ°å­¦åä»£ç é®é¢çè½åã</p>
</li>
<li>
<p><strong>å¯¹é½ï¼</strong> ç»åéç¨æ°æ®è¿è¡æç»å¾®è°ï¼å¼é¡¾æ¨çè½åä¸éç¨å¯¹è¯ä½éªã</p>
</li>
</ul>
</li>
<li>
<p><strong>æ¨¡åè¸é¦ï¼</strong> DeepSeekä¸ä»å¼æºäºR1ï¼671Bï¼ï¼è¿å¼æºäºå©ç¨R1çæçæ¨çæ°æ®è¸é¦åºçä¸ç³»åå°æ¨¡åï¼QwenåLlamaæ¶æï¼1.5B-70Bãè¿äºå°æ¨¡åå¨æ¨çè½åä¸å¤§å¹è¶è¶äºåå°ºå¯¸çåºåº§æ¨¡åï¼çè³ä¼äºOpenAI o1-miniã</p>
</li>
</ul>
<h2 id="janus-proå¤æ¨¡æçå°ºåº¦å®å¾">Janus-Proï¼å¤æ¨¡æçå°ºåº¦å®å¾</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2025å¹´1æ27æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ å¢å¼ºçå¤æ¨¡ææ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ æ°æ®ä¸æ¨¡åè§æ¨¡å</p>
</li>
<li>
<p>è®ºæ: <a href="https://arxiv.org/pdf/2501.17811v1" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/2501.17811v1</a></p>
</li>
<li>
<p>Github: <a href="https://github.com/deepseek-ai/Janus" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/Janus</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=OWM2YWJmNTY5ODljOWQxMDI5MWJiMjEwYmE1ZjYyMTVfT3ZYYk9peGdnaGlsZDFzV2ZQQ0VmUVhFbWVmb1VxdEZfVG9rZW46Uk5kUWJSVE1Xb055aXh4eWJxM2NBV0g4bnBnXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>Janus-Proæ¯Janusæ¶æçåçº§çãéè¿ä¼åè®­ç»ç­ç¥ãæ©å±è®­ç»æ°æ®åå¢å¤§æ¨¡ååæ°ï¼1B -&gt; 7Bï¼ï¼Janus-Proå¨å¤æ¨¡æçè§£åæçå¾æä»¤éµå¾ªè½åä¸åå¾äºæ¾èæåï¼è¯æäºJanusæ¶æå·æè¯å¥½çScaling Lawï¼å°ºåº¦å®å¾ï¼ç¹æ§ ã</p>
<h2 id="deepseek-v31--terminusagentè½åçè§é">DeepSeek-V3.1 &amp; Terminusï¼Agentè½åçè§é</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2025å¹´8æ21æ¥ï¼V3.1ï¼ï¼9æ22æ¥ï¼Terminusï¼</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ Agentåºåº§æ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ æ··åæç»´æ¨¡å¼/å·¥å·è°ç¨ä¼å</p>
</li>
<li>
<p>Huggingface: <a href="https://huggingface.co/deepseek-ai/DeepSeek-V3.1-Terminus" target="_blank" rel="noopener nofollow">https://huggingface.co/deepseek-ai/DeepSeek-V3.1-Terminus</a></p>
</li>
<li>
<p>è®ºæ: <a href="https://arxiv.org/pdf/2412.19437" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/2412.19437</a></p>
</li>
<li>
<p>Github: <a href="https://github.com/deepseek-ai/deepseek-v3" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/deepseek-v3</a></p>
</li>
</ul>
<p>éçæ¨çè½åçæçï¼DeepSeekå¼å§æ¢ç´¢å°ãæèãåºç¨äºAgentï¼æºè½ä½ï¼åºæ¯ã</p>
<ul>
<li>
<p><strong>DeepSeek-V3.1ï¼</strong> å¼å¥äºãDeepThinkãæ¨¡å¼ï¼ç¨æ·å¯ä»¥å¨å¯¹è¯ä¸­ä¸é®å¼å¯æ·±åº¦æèãè¯¥çæ¬éç¹æåäºå·¥å·ä½¿ç¨ï¼Tool Useï¼è½åï¼ä½¿å¶è½å¤å¤çå¤æ­¥å¤æçAgentä»»å¡ã</p>
</li>
<li>
<p><strong>DeepSeek-V3.1-Terminusï¼</strong> éå¯¹V3.1å­å¨çè¯­è¨æ··æï¼ä¸­è±å¤¹æï¼åAgentæ§è¡ä¸ç¨³å®çé®é¢è¿è¡äºä¸é¡¹ä¿®å¤ãTerminusçæ¬å¨Code AgentåSearch Agentä»»å¡ä¸çè¡¨ç°æ´å é²æ£ï¼SWE-bench Verifiedåæ°è¾¾å°66.0ï¼æ å¿çDeepSeekæ­£å¼è¿å¥Agentæ¶ä»£ã</p>
</li>
</ul>
<h2 id="deepseek-v32--specialeç¨çæ³¨æåççªç ´">DeepSeek-V3.2 &amp; Specialeï¼ç¨çæ³¨æåççªç ´</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2025å¹´12æ1æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ é¿ä¸ä¸æAgentæ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ DeepSeek Sparse Attention (DSA) /Thinking in Tool-Use</p>
</li>
<li>
<p>è®ºæ: <a href="https://github.com/deepseek-ai/DeepSeek-V3.2-Exp/blob/main/DeepSeek_V3_2.pdf" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-V3.2-Exp/blob/main/DeepSeek_V3_2.pdf</a></p>
</li>
<li>
<p>Github: <a href="https://github.com/deepseek-ai/DeepSeek-V3.2-Exp" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-V3.2-Exp</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=MDI5MjI4OWRlNWY0YWZjMDNjNDk1YTgzMmYzNzliNGRfS2lqYXN5dTB2NUNFU1BDN2pKbkpBdDd6NnUzVzNHN2tfVG9rZW46Tkpma2JpbWhWb2pWWm14VGxacmNxbnBhbnhlXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>DeepSeek-V3.2çéè§£å³äºé¿ä¸ä¸æä¸çè®¡ç®æçé®é¢ï¼å¹¶è¿ä¸æ­¥å¼ºåäºAgentçæ¨çè½åã</p>
<ul>
<li>
<p><strong>DeepSeek</strong> <strong>Sparse</strong> <strong>Attention (DSA)ï¼</strong> ä¸ç§ç»ç²åº¦çç¨çæ³¨æåæºå¶ãä¸æ åå¨æ³¨æåç¸æ¯ï¼DSAå¨å¤ç128Kçè³æ´é¿ä¸ä¸ææ¶ï¼è½æ¾èéä½è®¡ç®å¤æåº¦åæ¾å­å ç¨ï¼ä¸å ä¹ä¸æå¤±æ¨¡åæ§è½ãè¿ä½¿å¾V3.2å¨é¿ææ¡£åæåRAGï¼æ£ç´¢å¢å¼ºçæï¼åºæ¯ä¸æå·ä¼å¿ã</p>
</li>
<li>
<p><strong>Thinking in Tool-Useï¼</strong> V3.2ä¸ä»ä¼æèï¼è¿è½å¨è°ç¨å·¥å·çè¿ç¨ä¸­è¿è¡æèãä¾å¦ï¼å¨æ§è¡ä»£ç è§£éå¨ä¹åï¼ä¼åæ¨æ¼ä»£ç é»è¾ï¼å¨è·å¾å·¥å·è¿åç»æåï¼ä¼åæ¬¡æèä¸ä¸æ­¥è¡å¨ã</p>
</li>
<li>
<p><strong>DeepSeek-V3.2-Specialeï¼</strong> ä¸ä¸ªä¸ä¸ºæé«é¾åº¦æ¨çä»»å¡è®¾è®¡ççæ¬ï¼è½ç¶ææ¬è¾é«ï¼ä½å¨IMO 2025ï¼å½éæ°å­¦å¥¥æå¹åï¼åIOI 2025ï¼å½éä¿¡æ¯å­¦å¥¥æå¹åï¼ä¸­åè·å¾äºéççº§è¡¨ç°ï¼æ¨çè½åå¯¹æ Gemini-3.0-Proã</p>
</li>
</ul>
<h1 id="2026å¹´1æ-2æçªç ´è®°å¿ä¸è§è§çæé">2026å¹´1æ-2æï¼çªç ´è®°å¿ä¸è§è§çæé</h1>
<p>æªè³åç¨¿æ¥ï¼DeepSeekå¨ä¿æè¯­è¨æ¨¡åä¼å¿çåæ¶ï¼å¼å§åå¤§æ¨¡åæåºå±çä¸ä¸ªçç¹ï¼è®°å¿éå¿ãè§è§é»è¾åTransformeråºå±æ¶æï¼åèµ·å¨é¢å²å»ã</p>
<h2 id="æ·±åº¦è§£æmanifold-constrained-hyper-connections-mhc">æ·±åº¦è§£æï¼Manifold-Constrained Hyper-Connections (mHC)</h2>
<ul>
<li>
<p>åå¸æ¥æï¼2026å¹´1æ3æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼è¶å¤§è§æ¨¡æ¨¡åçä¿¡å·åæ£ä¸è®­ç»ä¸ç¨³å®æ§ã</p>
</li>
<li>
<p>ææ¯åæ°ï¼å¼å¥å ä½çº¦æ</p>
</li>
<li>
<p>è®ºæï¼<a href="https://arxiv.org/pdf/2512.24880" target="_blank" rel="noopener nofollow">https://arxiv.org/pdf/2512.24880</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmFkNGU5NzI4NzkyYzA3ZDIxZjE5Y2U4ZDg2YzRlMmFfa2hsUVdIWDg5RTlOWThEc1ROQmJrcnZ4VDJKMFRmNGhfVG9rZW46SUZaSmJMdnE2b2F5dTF4ZUFnZ2NNZVdrblFmXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>mHC çæåºè§£å³äºå°æ°æ·±åº¦å­¦ä¹ çåå¹´çâæ·±åº¦-å®½åº¦âæè¡¡é®é¢ãå®è¯æäºéè¿æ½å ä¸¥æ ¼çå ä½çº¦æï¼æä»¬å¯ä»¥å¨ä¸çºç²è®­ç»ç¨³å®æ§çåæä¸ï¼æå¤§å°æ©å±æ¨¡åçå®½åº¦åå®¹éãè¿ä¸º DeepSeek V4 è®­ç»ä¸äº¿åæ°æ¨¡åå¥ å®äºæ°å­¦åºç¡ã</p>
<ul>
<li>
<p><strong>æ¶æäº®ç¹</strong>ï¼</p>
<ul>
<li>
<p>æµå½¢çº¦ææºå¶ï¼éè¿Sinkhorn-Knoppç®æ³å°æ®å·®æ å°æå½±å°åéæºç©éµæµå½¢ï¼æ¢å¤æç­æ å°ç¹æ§ï¼è§£å³ HC æ¶æçè®­ç»ä¸ç¨³å®æ§ã</p>
</li>
<li>
<p>é«æåºç¡è®¾æ½ä¼åï¼èåæ ¸å½æ°åå°åå­å¸¦å®½ç¶é¢ï¼éæ©æ§éè®¡ç®éä½æ¾å­å ç¨ï¼æ©å±DualPipeè°åº¦å®ç°éä¿¡ä¸è®¡ç®éå ï¼ä»å¢å 6.7%è®­ç»å¼éã</p>
</li>
<li>
<p>å¤æµæ®å·®è®¾è®¡ï¼æ©å±æ®å·®æµå®½åº¦ï¼n=4ï¼ï¼åæ¶éè¿éè´çº¦æé¿åä¿¡å·æµæ¶ï¼å¼é¡¾ææå¤æåº¦ä¸ä¼ æ­ç¨³å®æ§ã</p>
</li>
</ul>
</li>
<li>
<p><strong>æ§è½è¡¨ç°</strong>ï¼27B æ¨¡åå¨BBHãDROPç­8é¡¹åºåä¸­å¨é¢è¶è¶åºçº¿åHCæ¶æï¼æ¨çæ§è½æå2.1%-2.3%ï¼å¨3Bå° 27Bè§æ¨¡ä¸ä¿æç¨³å®æ§è½ä¼å¿ï¼ä¿¡å·å¢çå¹åº¦ä»HCç3000éè³1.6ï¼å¤§å¹æåè®­ç»scalabilityã</p>
</li>
</ul>
<h2 id="deepseek-ocr-2è§è§å ææµ">DeepSeek-OCR-2ï¼è§è§å ææµ</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2026å¹´1æ27æ¥</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ ä¸ä¸ä»£è§è§çè§£æ¨¡å</p>
</li>
<li>
<p>ææ¯åæ°ï¼ è§è§å ææµï¼Visual Causal Flowï¼</p>
</li>
<li>
<p>è®ºæ1ï¼<a href="https://arxiv.org/abs/2601.20552" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2601.20552</a></p>
</li>
<li>
<p>github2: <a href="https://github.com/deepseek-ai/DeepSeek-OCR-2" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-OCR-2</a></p>
</li>
<li>
<p>è®ºæ2ï¼<a href="https://arxiv.org/abs/2510.18234" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2510.18234</a></p>
</li>
<li>
<p>github2: <a href="https://github.com/deepseek-ai/DeepSeek-OCR" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-OCR</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=ODIyNDJiYTg4MGU0ODE1NWExNWUwZDBlMWQ4MzM3NGJfQmxFUGdiVjBJYkhYZGYxb09iSUtqRUxlQmZNR01xRkhfVG9rZW46T082VmJpOVZkb081a3B4SkowOGNWbGplbk5lXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>ä¼ ç»çè§è§ç¼ç å¨ï¼å¦ViTï¼éå¸¸å°å¾åè§ä¸ºæ åºçè¡¥ä¸ï¼Patchesï¼éåãDeepSeek-OCR-2ï¼3Båæ°ï¼é¢ è¦äºè¿ä¸èå¼ï¼å¼å¥äº<strong>è§è§å ææµ</strong>æ¦å¿µã</p>
<ul>
<li>
<p><strong>æ ¸å¿é»è¾ï¼</strong> å¼ºå¶æ¨¡åæç§äººç±»çéè¯»é¡ºåºï¼å¦ä»å·¦å°å³ãä»ä¸å°ä¸ãåæ é¢åæ­£æï¼æ¥å¤çè§è§ä¿¡æ¯ï¼èä¸æ¯å¹¶è¡å¤çãè¿ç§æåºçå æå¤çæ¹å¼ä½¿å¾æ¨¡åå¨çè§£å¤æ æçãå¤æè¡¨æ ¼ãåµå¥å¬å¼ç­ææ¡£ç»ææ¶ï¼åç¡®çå®ç°äºè´¨çé£è·ã</p>
</li>
<li>
<p><strong>æ§è½ï¼</strong> å°½ç®¡åæ°ä»ä¸º3Bï¼ä½å¨å¤æææ¡£çè§£ä»»å¡ä¸è¶è¶äºè®¸å¤ç¾äº¿çº§æ¨¡åã</p>
</li>
</ul>
<h2 id="engramæ éè®°å¿çæå">Engramï¼æ éè®°å¿çæå</h2>
<ul>
<li>
<p>åå¸æ¶é´ï¼ 2026å¹´1æ14æ¥ï¼è®ºæåå¸ï¼</p>
</li>
<li>
<p>æ ¸å¿å®ä½ï¼ æ°åè®°å¿æ¶æç ç©¶</p>
</li>
<li>
<p>ææ¯åæ°ï¼ å¯æ©å±æ¥è¡¨æ¡ä»¶è®°å¿ï¼Conditional Memory via Scalable Lookupï¼</p>
</li>
<li>
<p>è®ºæï¼<a href="https://arxiv.org/abs/2601.07372" target="_blank" rel="noopener nofollow">https://arxiv.org/abs/2601.07372</a></p>
</li>
<li>
<p>Github: <a href="https://github.com/deepseek-ai/Engram" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/Engram</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=MjIwYTdiNWYwNWJiMTE0MmEwMjlmMmYwMmVmMjkzZTdfdDVaVXJSbmJFWUVnUjNoUmFYbFpPN01neGZycU5CYkdfVG9rZW46VHJYVWJzV3RZb1cyY2d4WDAyZWM0aWVvbkhiXzE3NzA4ODA4NDY6MTc3MDg4NDQ0Nl9WNA" class="lazyload"></p>
<p>Transformerçæ³¨æåæºå¶è½ç¶å¼ºå¤§ï¼ä½å¶è®¡ç®å¤æåº¦éé¿åº¦åäºæ¬¡æ¹å¢é¿ï¼éå¶äºä¸ä¸æçæ éæ©å±ãDeepSeekæåºäº<strong>Engram</strong>æ¶æã</p>
<ul>
<li>
<p><strong>åçï¼</strong> æ¾å¼äºè®©æ¨¡åæ¶å»è®°ä½ææä¿¡æ¯ï¼èæ¯å»ºç«äºä¸ä¸ªå¤æçéæN-gramè®°å¿åºãæ¨¡åéè¿é«æçæ¥è¡¨æºå¶ï¼Lookupï¼æéæ£ç´¢è®°å¿ï¼å¹¶å°å¶ä¸å½åçå¨æéèç¶æèåã</p>
</li>
<li>
<p><strong>æä¹ï¼</strong> è¿ç§è®¾è®¡å°è®°å¿å­å¨ä»æè´µçGPUæ¾å­è½¬ç§»å°äºå»ä»·çCPUåå­çè³ç¡¬çä¸ï¼çè®ºä¸å¯ä»¥æ¯ææ éçä¸ä¸æé¿åº¦ï¼ä¸ºå¤çä»£ç åºçº§å«çè¶é¿ä»»å¡æ«æ¸äºéç¢ãè¿ä¹æ¯å³å°åå¸çDeepSeek-V4çæ ¸å¿ææ¯å¨å¤ ()ã</p>
</li>
</ul>
<h1 id="åºç¡è®¾æ½ä¸çææ¤åæ²³">åºç¡è®¾æ½ä¸çææ¤åæ²³</h1>
<p>DeepSeek çæåç¦»ä¸å¼å¶åºå±åºç¡è®¾æ½çæè´ä¼åãè¿äºå·¥å·åºåå·²å¼æºï¼ææäºå¶ææ¯æ¤åæ²³ã</p>
<ul>
<li>
<p><strong>DeepGEMM</strong>ï¼ä¸ä¸ºFP8ä¼åçç©éµä¹æ³åºï¼æ¯æç»ç²åº¦ç¼©æ¾ï¼Fine-grained Scalingï¼ï¼æ¯V3/V4é«æè®­ç»çåºç³ã</p>
<ul>
<li><a href="https://github.com/deepseek-ai/DeepGEMM" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepGEMM</a></li>
</ul>
</li>
<li>
<p><strong>FlashMLA</strong>ï¼éå¯¹Hopperæ¶æ GPU ä¼åç MLA è§£ç åæ ¸ï¼æå¤§æåäºæ¨çååéã</p>
<ul>
<li><a href="https://github.com/deepseek-ai/FlashMLA" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/FlashMLA</a></li>
</ul>
</li>
<li>
<p><strong>DeepEP</strong>ï¼é«æçä¸å®¶å¹¶è¡ï¼Expert Parallelï¼éä¿¡åºï¼è§£å³äºMoEæ¨¡åä¸­ä¸å®¶è·¯ç±å¸¦æ¥çå·¨å¤§éä¿¡å¼éã</p>
<ul>
<li><a href="https://github.com/deepseek-ai/DeepEP" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepEP</a></li>
</ul>
</li>
<li>
<p><strong>DualPipe</strong>ï¼ååæµæ°´çº¿å¹¶è¡ç®æ³ï¼å®ç°äºè®¡ç®ä¸éä¿¡çå®ç¾éå ï¼Overlapï¼ã</p>
<ul>
<li><a href="https://github.com/deepseek-ai/DualPipe" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DualPipe</a></li>
</ul>
</li>
<li>
<p><strong>3FS</strong>ï¼é«æ§è½åå¸å¼æä»¶ç³»ç»ï¼ä¸ä¸º AI è®­ç»çæµ·éæ°æ®ååè®¾è®¡ã</p>
<ul>
<li><a href="https://github.com/deepseek-ai/3FS" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/3FS</a></li>
</ul>
</li>
</ul>
<p>ä»2023å¹´å°2026å¹´ï¼DeepSeekèµ°è¿äºä¸æ¡ä»è·éèå°é¢ è¦èçéè·¯ãå¦æè¯´V2åV3æ¯éè¿å·¥ç¨æè´ä¼åï¼MLA, FP8, MoEï¼æ¥æç ´ç®ååæ­ï¼é£ä¹2026å¹´mHCåEngramçæåºï¼åæ å¿çDeepSeekå¼å§è§¦ç¢°æ·±åº¦å­¦ä¹ ççè®ºå¤©è±æ¿ã</p>
<p>mHCéè¿å¼å¥æµå½¢çº¦æï¼æ°å­¦ä¸ä¿è¯äºä¸äº¿åæ°æ¨¡åçä¿¡å·ç¨³å®æ§ï¼Engraméè¿å¼å¥å¤é¨è®°å¿ï¼æç ´äº Transformerä»ä»ä¾èµåæ°è®°å¿ç¥è¯çä½æèå¼ãè¿ä¸¤é¡¹ææ¯ä¸ä»ä¸ºå³å°å°æ¥ç DeepSeek V4å¥ å®äºåºç¡ï¼æ´ä¸ºæ´ä¸ªAIè¡ä¸å¨å ãScaling Lawãæ¶ä»£ææäºæ°çæ¹åï¼åå ä½è¦ç¨³å®æ§ï¼ååå­è¦ç¥è¯å®¹éã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-12 16:15">2026-02-12 16:15</span>&nbsp;
<a href="https://www.cnblogs.com/aifrontiers">AI-Frontiers</a>&nbsp;
éè¯»(<span id="post_view_count">213</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19608897);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19608897', targetLink: 'https://www.cnblogs.com/aifrontiers/p/19608897', title: '3å¹´ï¼ä»0å°å¨çé¢è·ï¼ä¸å­é¿ææè§£DeepSeekå¤§æ¨¡åææ¯æ¼è¿' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ°æ®åºç®å­ ]]></title>
    <link>https://www.cnblogs.com/aslanvon/p/19608578</link>
    <guid>133613f9a0f0c45114ad04b9485a2246</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/aslanvon/p/19608578" title="åå¸äº 2026-02-12 15:18">
    <span role="heading" aria-level="2">æ°æ®åºç®å­</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="åè¡¨">åè¡¨</h1>
<h2 id="1-ä¸ºä»ä¹ä¼åçåè¡¨">1. ä¸ºä»ä¹ä¼åçåè¡¨ï¼</h2>
<p>æ³è±¡ä½ å¨å¾ä¹¦é¦æ¥ä¹¦ï¼</p>
<ol>
<li><strong>ç´¢å¼ï¼Indexï¼</strong>ï¼å°±åå¾ä¹¦é¦ç<strong>ç´¢å¼å¡ç</strong>ãå¡çä¸åçï¼ä¹¦åãæ°æ®åºåçãï¼å­æ¾ä½ç½®ï¼3æ-Bæ¶-12å·ã</li>
<li><strong>è¡¨ï¼Table/Heapï¼</strong>ï¼å°±å<strong>ä¹¦æ¶ä¸çå®ç©ä¹¦</strong>ãä¹¦éææå·ä½çåå®¹ï¼ä½èãåºçç¤¾ãæ­£æï¼ã</li>
</ol>
<p>å¦æä½ åªæ³ç¥éä¹¦åï¼çå¡çï¼ç´¢å¼ï¼å°±å¤äºãä½å¦æä½ æ³çâä½èæ¯è°âæèâå·ä½åå®¹âï¼ä½ å°±å¿é¡»æ¿çå¡çä¸çä½ç½®ï¼èµ°å°ä¹¦æ¶åæé£æ¬ä¹¦æ½åºæ¥ç¿»å¼ã<strong>è¿ä¸ªâä»ç´¢å¼å°ä¹¦æ¶åä¹¦âçè¿ç¨ï¼å°±æ¯åè¡¨ã</strong></p>
<hr>
<h2 id="2-åè¡¨çè¿ç¨ä»¥-postgresqlmysql-ä¸ºä¾">2. åè¡¨çè¿ç¨ï¼ä»¥ PostgreSQL/MySQL ä¸ºä¾ï¼</h2>
<p>åè®¾ä½ æä¸å¼ è¡¨ <code>users</code>ï¼å¨ <code>username</code> å­æ®µä¸æç´¢å¼ï¼</p>
<pre><code class="language-sql">-- æ¥è¯¢è¯­å¥
SELECT id, username, age FROM users WHERE username = 'a';
</code></pre>
<ol>
<li><strong>ç¬¬ä¸æ­¥ï¼æ¥ç´¢å¼ã</strong> æ°æ®åºå¨ <code>username</code> ç´¢å¼æ ä¸­å¿«éå®ä½å° <code>'a'</code>ã</li>
<li><strong>ç¬¬äºæ­¥ï¼æ¿æéã</strong> ç´¢å¼èç¹éå­å¨çè¯¥è¡æ°æ®çç©çå°åï¼å¨ MySQL ä¸­æ¯ä¸»é® IDï¼å¨ PostgreSQL ä¸­æ¯ CTID/TIDï¼ã</li>
<li><strong>ç¬¬ä¸æ­¥ï¼åè¡¨ã</strong> ç´¢å¼é<strong>æ²¡æ <code>age</code> å­æ®µ</strong>ãæ°æ®åºæ ¹æ®ç©çå°åï¼åå°åå§æ°æ®è¡¨ï¼Heapï¼ä¸­æ¾å°è¿ä¸è¡ï¼æ <code>age</code> çå¼è¯»åºæ¥ã</li>
</ol>
<hr>
<h2 id="3-åè¡¨æä»ä¹ä»£ä»·">3. åè¡¨æä»ä¹ä»£ä»·ï¼</h2>
<p>åè¡¨æ¯æ°æ®åºæ§è½ä¼åç<strong>å¤´å·å¬æ</strong>ï¼ä¸»è¦åå æä¸¤ä¸ªï¼</p>
<ul>
<li><strong>éæº I/O å¢å </strong>ï¼ç´¢å¼éå¸¸æ¯é¡ºåºæåçï¼ä½æ°æ®è¡å¨ç£çä¸çåå¸æ¯é¶æ£çãæ¯åè¡¨ä¸æ¬¡ï¼å¯è½é½è¦è¿è¡ä¸æ¬¡ç£çéæºè¯»ï¼è¿æ¯é¡ºåºè¯»æ¢å¾å¤ã</li>
<li><strong>æ§è½æè</strong>ï¼å¦ææ¥è¯¢ç»ææ 10,000 è¡ï¼æ°æ®åºå°±è¦æ§è¡ 10,000 æ¬¡âåè¡¨âå¨ä½ã</li>
</ul>
<hr>
<h2 id="4-å¦ä½é¿ååè¡¨">4. å¦ä½é¿ååè¡¨ï¼</h2>
<p>æææçæ¹æ¡æ¯ï¼<strong>è¦çç´¢å¼ï¼Covering Indexï¼</strong>ã</p>
<p>å¦æä½ ç»å¸¸éè¦æ ¹æ® <code>username</code> æ¥ <code>age</code>ï¼ä½ å¯ä»¥å»ºç«ä¸ä¸ªåå«è¿ä¸¤ä¸ªå­æ®µçç´¢å¼ï¼</p>
<pre><code class="language-sql">-- PostgreSQL è¯­æ³
CREATE INDEX idx_user_age ON users(username) INCLUDE (age);

-- æèéç¨çå¤åç´¢å¼
CREATE INDEX idx_user_age_composite ON users(username, age);
</code></pre>
<p><strong>åçäºä»ä¹ååï¼</strong></p>
<p>ç°å¨ï¼<code>age</code> å­æ®µçä¿¡æ¯ç´æ¥å­å¨äºç´¢å¼æ éãæ°æ®åºæ¥å° <code>username</code> æ¶ï¼é¡ºæå°±è½ææè¾¹ç <code>age</code> å¸¦èµ°ï¼åä¹ä¸ç¨å»ç¿»åå§è¡¨äºãè¿ç§ç®å­å¨æ§è¡è®¡åä¸­ä¼æ¾ç¤ºä¸º <strong>Index Only Scan</strong>ã</p>
<hr>
<h2 id="5-ä»ä¹æ¶ååè¡¨æ¯ä¸åè¡¨è¿å¿«">5. ä»ä¹æ¶åâåè¡¨âæ¯âä¸åè¡¨âè¿å¿«ï¼</h2>
<p>å¹¶ä¸æ¯æææ¶åé½è¦é¿ååè¡¨ã</p>
<ul>
<li>å¦æä½ ç <code>WHERE</code> æ¡ä»¶è¿æ»¤åï¼<strong>åªå©ä¸å è¡æ°æ®</strong>ï¼åè¡¨çä»£ä»·å¾®ä¹å¶å¾®ã</li>
<li>å¦æè¡¨å¾å°ï¼æ°æ®åºå¯è½ä¼ç´æ¥æ¾å¼ç´¢å¼ï¼éæ© <strong>Seq Scanï¼å¨è¡¨æ«æï¼</strong>ãå ä¸ºå®è§å¾âä¸å¶åçå¡çåç¿»ä¹¦ï¼ä¸å¦ç´æ¥æè¿æ¬èä¹¦ä»å¤´å°å°¾ç¿»ä¸éâã</li>
</ul>
<h2 id="æ»ç»">æ»ç»</h2>
<ul>
<li><strong>åè¡¨</strong> = å¨ç´¢å¼éæ²¡æ¾å¨ï¼å¾ååè¡¨åã</li>
<li><strong>åæ</strong> = äº§çéæº I/Oï¼åæ¢ã</li>
<li><strong>å¯¹ç­</strong> = è¦çç´¢å¼ï¼ææ¥çå­æ®µé½å¡è¿ç´¢å¼éï¼ã</li>
</ul>
<h1 id="ç®å­">ç®å­</h1>
<p>å¨ PostgreSQL ä¸­ï¼ç®å­ï¼Operators/Nodesï¼æ¯æææ§è¡è®¡åçæå°ååãä¸ºäºæ¹ä¾¿è®°å¿ï¼æä»¬å¯ä»¥æç§å®ä»¬å¨æ°æ®å¤çæµä¸­ç<strong>åè½è§è²</strong>ï¼å°å¶åä¸ºåå¤§ç±»ï¼<strong>æ°æ®æ«æ</strong>ã<strong>è¿æ¥æ¥è¯¢</strong>ã<strong>éå/èåæä½</strong>ãä»¥å<strong>è¾å©æ§å¶ç®å­</strong>ã</p>
<hr>
<h2 id="1-æ°æ®æ«æç®å­-scan-nodes">1. æ°æ®æ«æç®å­ (Scan Nodes)</h2>
<p>è¿ç±»ç®å­è´è´£ä»ç©çå­å¨ï¼ç£çæåå­ç¼å²åºï¼ä¸­è¯»ååå§æ°æ®ã</p>
<table>
<thead>
<tr>
<th><strong>ç®å­åç§°</strong></th>
<th><strong>è±æå</strong></th>
<th><strong>åè½æè¿°</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¨è¡¨æ«æ</strong></td>
<td><strong>Seq Scan</strong></td>
<td>é¡ºåºè¯»åæ´ä¸ªè¡¨çæææ°æ®é¡µã</td>
</tr>
<tr>
<td><strong>ç´¢å¼æ«æ</strong></td>
<td><strong>Index Scan</strong></td>
<td>åæ«æç´¢å¼æ¾å°ä½ç½®ï¼ååè¡¨è¯»åæ°æ®è¡ã</td>
</tr>
<tr>
<td><strong>ç´¢å¼è¦çæ«æ</strong></td>
<td><strong>Index Only Scan</strong></td>
<td>ä»éè¿ç´¢å¼å°±è½æ¿å°æææéå­æ®µï¼æ éåè¡¨ã</td>
</tr>
<tr>
<td><strong>ä½å¾æ«æ</strong></td>
<td><strong>Bitmap Heap/Index Scan</strong></td>
<td>åå¨åå­ä¸­æå»ºä½å¾æ è®°å¹éè¡ï¼åæ¹éåè¡¨ï¼åå°éæº IOã</td>
</tr>
<tr>
<td><strong>TID æ«æ</strong></td>
<td><strong>Tid Scan</strong></td>
<td>éè¿è¡æ è¯ç¬¦ï¼Tuple IDï¼ç´æ¥å®ä½æ°æ®ã</td>
</tr>
</tbody>
</table>
<p>å¨ PostgreSQL ä¸­ï¼<strong>æ«æç®å­ï¼Scan Nodesï¼</strong>æ¯æ§è¡è®¡åçâå°åºâãæææ°æ®çå¤çé½å§äºæ«æï¼å®çæçç´æ¥å³å®äºæ¥è¯¢ççæ­»ã</p>
<p>PostgreSQL ä¼æ ¹æ®æ°æ®éçå¤§å°ãè¿æ»¤æ¡ä»¶çç­éçä»¥åç´¢å¼çåå¸ï¼ä»ä»¥ä¸å ç§ä¸»è¦æ«ææ¹å¼ä¸­éæ©æä¼è§£ã</p>
<hr>
<h3 id="1-å¨è¡¨æ«æ-seq-scan">1. å¨è¡¨æ«æ (Seq Scan)</h3>
<p>è¿æ¯æåå§çæ«ææ¹å¼ã</p>
<ul>
<li><strong>å·¥ä½åçï¼</strong> æ°æ®åºä»ç£çä¸é¡ºåºè¯»åè¯¥è¡¨çæææ°æ®é¡µï¼Blocksï¼ï¼å¹¶å¯¹æ¯ä¸è¡è¿è¡æ¡ä»¶æ£æ¥ã</li>
<li><strong>éç¨åºæ¯ï¼</strong>
<ul>
<li>è¡¨éå¸¸å°ï¼å è½½ç´¢å¼çä»£ä»·åèæ¯å¨è¡¨æ«æé«ï¼ã</li>
<li>æ¥è¯¢æ¡ä»¶æ²¡æç´¢å¼ã</li>
<li>è¿åçæ°æ®å å¨è¡¨æ¯ä¾å¾é«ï¼ä¾å¦è¶è¿ 20%-30%ï¼ï¼æ­¤æ¶é¡ºåº IO æ¯é¢ç¹çéæº IO æ´å¿«ã</li>
</ul>
</li>
<li><strong>EXPLAIN æ å¿ï¼</strong> <code>Seq Scan on table_name</code>ã</li>
</ul>
<hr>
<h3 id="2-ç´¢å¼æ«æ-index-scan">2. ç´¢å¼æ«æ (Index Scan)</h3>
<p>å½æ¥è¯¢æ¡ä»¶å½ä¸­ç´¢å¼æ¶ï¼æ°æ®åºä¼åå»æ¥ç´¢å¼ã</p>
<ul>
<li><strong>å·¥ä½åçï¼</strong>
<ol>
<li>å¨ B-Tree ç´¢å¼ä¸­æ¾å°å¹éæ¡ä»¶ç Entryï¼æ¡ç®ï¼ã</li>
<li>æ ¹æ® Entry ä¸­çæéï¼TIDï¼ï¼åè¡¨ï¼Heapï¼è¯»åå®æ´çæ°æ®è¡ã</li>
</ol>
</li>
<li><strong>ä¼ç¼ºç¹ï¼</strong> éåè¿åå°éæ°æ®çæ¥è¯¢ãå¦æè¿åè¡æ°å¤ªå¤ï¼é¢ç¹çâåè¡¨âä¼å¯¼è´å¤§ééæº IOï¼æ§è½åèä¸å¦ Seq Scanã</li>
<li><strong>EXPLAIN æ å¿ï¼</strong> <code>Index Scan using index_name on table_name</code>ã</li>
</ul>
<hr>
<h3 id="3-ç´¢å¼è¦çæ«æ-index-only-scan">3. ç´¢å¼è¦çæ«æ (Index Only Scan)</h3>
<p>è¿æ¯æ§è½ä¼åçâå¤©è±æ¿âã</p>
<ul>
<li><strong>å·¥ä½åçï¼</strong> å¦æä½ æ¥è¯¢çå­æ®µå¨é½å¨ç´¢å¼éï¼ä¾å¦ <code>SELECT id FROM users WHERE id &lt; 10</code>ï¼ï¼æ°æ®åºç´æ¥ä»ç´¢å¼æ æ¿å°ç»æå°±è¿åï¼<strong>å®å¨ä¸éè¦åè¡¨</strong>ã</li>
<li><strong>å³é®ç¹ï¼</strong> å <strong>Visibility Map</strong> çå½±åãå¦ææäºæ°æ®é¡µåè¢«æ´æ°è¿ï¼æ°æ®åºè¿æ¯å¾åè¡¨ç¡®è®¤æ°æ®çå¯è§æ§ï¼MVCCï¼ã</li>
<li><strong>EXPLAIN æ å¿ï¼</strong> <code>Index Only Scan using index_name on table_name</code>ã</li>
</ul>
<hr>
<h3 id="4-ä½å¾æ«æ-bitmap-scan">4. ä½å¾æ«æ (Bitmap Scan)</h3>
<p>è¿æ¯ PostgreSQL çä¸å¤§ç¹è²ï¼ä¸é¨è§£å³âç´¢å¼æ«æå¯¼è´éæº IO å¤ªå¤âçé®é¢ã</p>
<ul>
<li><strong>å·¥ä½åçï¼åä¸¤æ­¥ï¼ï¼</strong>
<ol>
<li><strong>Bitmap Index Scanï¼</strong> æ«æç´¢å¼ï¼ä½ä¸ç«å»åè¡¨ãå®å¨åå­ä¸­åå»ºä¸ä¸ªâä½å¾âï¼æ è®°åªäºæ°æ®é¡µåå«ç¬¦åæ¡ä»¶çè¡ã</li>
<li><strong>Bitmap Heap Scanï¼</strong> æ ¹æ®ä½å¾ï¼æç£çé¡ºåºè®¿é®æ°æ®é¡µã</li>
</ol>
</li>
<li><strong>æä¹ï¼</strong> å®å°éæº IO è½¬æ¢æäº<strong>å±é¨é¡ºåº IO</strong>ãå®æ¯ Index Scan æ´éåæ¥è¯¢âä¸­ç­è§æ¨¡âçæ°æ®ï¼æ¢ä¸å¤ªå¤ä¹ä¸å¤ªå°ï¼ã</li>
<li><strong>EXPLAIN æ å¿ï¼</strong> å¾å¾æå¯¹åºç°ï¼åæ <code>Bitmap Index Scan</code>ï¼åæ <code>Bitmap Heap Scan</code>ã</li>
</ul>
<hr>
<h3 id="5-å¸¸è§æ«æç®å­å¯¹æ¯è¡¨">5. å¸¸è§æ«æç®å­å¯¹æ¯è¡¨</h3>
<p>ä¸ºäºç´è§çè§£ï¼æä»¬åè®¾æä¸å¼  100 ä¸è¡çè¡¨ï¼</p>
<table>
<thead>
<tr>
<th><strong>æ«æç±»å</strong></th>
<th><strong>å¨ä½æ¯å»</strong></th>
<th><strong>éç¨æåµ</strong></th>
<th><strong>æ§è½ç¶é¢</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Seq Scan</strong></td>
<td>ç¿»å®æ´æ¬ä¹¦æ¾ä¸ä¸ªè¯</td>
<td>æ¥å¤§éæ°æ®/å°è¡¨</td>
<td>ç£çæ» IO é</td>
</tr>
<tr>
<td><strong>Index Scan</strong></td>
<td>çç®å½ï¼æ¥å°ä¸ä¸ªé¡µç ç¿»ä¸ä¸ä¹¦</td>
<td>æ¥æå°éæ°æ®</td>
<td>éæºè¯»åå»¶è¿</td>
</tr>
<tr>
<td><strong>Index Only Scan</strong></td>
<td>åªçç®å½å°±æ¾å°äºç­æ¡</td>
<td>è¦çç´¢å¼æ¥è¯¢</td>
<td>ç´¢å¼é¡µçå¤§å°</td>
</tr>
<tr>
<td><strong>Bitmap Scan</strong></td>
<td>çç®å½ï¼æææé¡µç è®°å¨çº¸ä¸ï¼æé¡µç ä»å°å°å¤§ç¿»ä¹¦</td>
<td>æ¥ä¸­ç­éæ°æ®</td>
<td>åå­ (Work_mem)</td>
</tr>
</tbody>
</table>
<h2 id="2-è¿æ¥ç®å­-join-nodes">2. è¿æ¥ç®å­ (Join Nodes)</h2>
<p>è¿æ¥ç®å­ï¼Join Nodesï¼æ¯æ°æ®åºæ§è¡è®¡åä¸­ææ ¸å¿çé¨åä¹ä¸ãå½ä½ ç SQL æ¥è¯¢æ¶åä¸¤å¼ ææ´å¤çè¡¨æ¶ï¼æ°æ®åºå¿é¡»å³å®<strong>âç¨ä»ä¹ç®æ³æè¿ä¸¤å æ°æ®æ¼å¨ä¸èµ·â</strong>ãPostgreSQLï¼ä»¥åå¤§å¤æ°å³ç³»åæ°æ®åºï¼ä¸»è¦æ¯æä¸ç§è¿æ¥ç®æ³ãçè§£å®ä»¬çåºå«ï¼æ¯ä¼åå¤è¡¨æ¥è¯¢çå³é®ã</p>
<table>
<thead>
<tr>
<th><strong>ç®å­åç§°</strong></th>
<th><strong>è±æå</strong></th>
<th><strong>åè½æè¿°</strong></th>
<th><strong>éç¨åºæ¯</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åµå¥å¾ªç¯è¿æ¥</strong></td>
<td><strong>Nested Loop</strong></td>
<td>å¯¹å¤è¡¨çæ¯ä¸è¡ï¼å»åè¡¨ä¸­æ¥æ¾å¹éè¡ã</td>
<td>å°æ°æ®éè¿æ¥ï¼æåè¡¨æç´¢å¼ã</td>
</tr>
<tr>
<td><strong>åå¸è¿æ¥</strong></td>
<td><strong>Hash Join</strong></td>
<td>ä¸ºåè¡¨å¨åå­å»ºç«åå¸è¡¨ï¼æ«æå¤è¡¨è¿è¡å¹éã</td>
<td>å¤§è¡¨å³èï¼ä¸æ ç´¢å¼æ¯æã</td>
</tr>
<tr>
<td><strong>å½å¹¶è¿æ¥</strong></td>
<td><strong>Merge Join</strong></td>
<td>å°ä¸¤ä¸ªæåºéååæé¾ä¸æ ·åå¹¶ã</td>
<td>ä¸¤è¡¨å¨å³èé®ä¸åå·²æåºï¼å¦å·²æç´¢å¼ï¼ã</td>
</tr>
</tbody>
</table>
<h3 id="1-åµå¥å¾ªç¯è¿æ¥-nested-loop-join">1. åµå¥å¾ªç¯è¿æ¥ (Nested Loop Join)</h3>
<p>è¿æ¯æç®åãæç´è§ï¼ä½å¨ç¹å®åºæ¯ä¸ä¹æ¯æå¿«çä¸ç§æ¹å¼ã</p>
<ul>
<li>
<p><strong>ç´è§çè§£ï¼</strong> å°±ååä»£ç æ¶çâåå± <code>for</code> å¾ªç¯âã</p>
<pre><code class="language-Python"># ä¼ªä»£ç é»è¾
for outer_row in Outer_Table:        # å¤å±å¾ªç¯ï¼é©±å¨è¡¨ï¼
    for inner_row in Inner_Table:    # åå±å¾ªç¯ï¼è¢«é©±å¨è¡¨ï¼
        if outer_row.id == inner_row.id:
            yield (outer_row, inner_row)
</code></pre>
</li>
<li>
<p><strong>å·¥ä½æµç¨ï¼</strong></p>
<ol>
<li>ä¼åå¨éæ©ä¸å¼ è¡¨ä½ä¸º<strong>é©±å¨è¡¨ï¼Outer Tableï¼</strong>ï¼éå¸¸æ¯è¿æ»¤åç»æéè¾å°çé£å¼ è¡¨ã</li>
<li>éè¡è¯»åé©±å¨è¡¨çæ°æ®ã</li>
<li>æ¿çè¿ä¸è¡æ°æ®çå³èé®ï¼å»<strong>è¢«é©±å¨è¡¨ï¼Inner Tableï¼</strong>ä¸­æ¥æ¾å¹éçè¡ã</li>
</ol>
</li>
<li>
<p><strong>æ§è½å³é®ç¹ï¼</strong></p>
<ul>
<li><strong>è¢«é©±å¨è¡¨å¿é¡»æç´¢å¼ï¼</strong> å¦æåå±å¾ªç¯æ¯æ¬¡é½è¦å¨è¡¨æ«æï¼æ§è½å°±æ¯ç¾é¾çº§ç O(N*M)ã</li>
<li>å¦ææç´¢å¼ï¼å¤æåº¦éä¸º O(N*log M)ã</li>
</ul>
</li>
<li>
<p><strong>éç¨åºæ¯ï¼</strong></p>
<ul>
<li><strong>âå°è¡¨é©±å¨å¤§è¡¨â</strong>ï¼é©±å¨è¡¨åªæå ç¾è¡ï¼è¢«é©±å¨è¡¨æå äº¿è¡ä½æç´¢å¼ã</li>
<li><strong>é¦è¡å¿«éååº</strong>ï¼å ä¸ºå®ä¸éè¦é¢å¤çï¼æ¾å°ç¬¬ä¸è¡å¹éå°±è½ç«å³è¿åï¼éååé¡µæ¥è¯¢çç¬¬ä¸é¡µã</li>
</ul>
</li>
</ul>
<hr>
<h3 id="2-åå¸è¿æ¥-hash-join">2. åå¸è¿æ¥ (Hash Join)</h3>
<p>è¿æ¯å¤ç<strong>å¤§æ°æ®é</strong>è¿æ¥çç¥å¨ï¼ä¹æ¯ç°ä»£æ°æ®åºæå¸¸ç¨çç®æ³ä¹ä¸ã</p>
<ul>
<li><strong>å·¥ä½æµç¨ï¼åä¸¤ä¸ªé¶æ®µï¼ï¼</strong>
<ol>
<li><strong>æå»ºé¶æ®µ (Build Phase)ï¼</strong> éæ©è¾å°çé£å¼ è¡¨ï¼å¨<strong>åå­</strong>ä¸­å»ºç«ä¸å¼ <strong>åå¸è¡¨ï¼Hash Tableï¼</strong>ãé®æ¯è¿æ¥å­æ®µï¼å¼æ¯è¡æ°æ®ã</li>
<li><strong>æ¢æµé¶æ®µ (Probe Phase)ï¼</strong> æ«æè¾å¤§çé£å¼ è¡¨ï¼å¯¹æ¯ä¸è¡è®¡ç®è¿æ¥å­æ®µçåå¸å¼ï¼å»åå­çåå¸è¡¨ä¸­æ¥æ¾æ¯å¦å­å¨ã</li>
</ol>
</li>
<li><strong>æ§è½å³é®ç¹ï¼</strong>
<ul>
<li><strong>åå­ï¼work_memï¼ï¼</strong> åå¸è¡¨å¿é¡»è½è£å¥åå­ãå¦æåå­ä¸å¤ï¼æ°æ®åºä¼æåå¸è¡¨åååå¥ç£çï¼ä¸´æ¶æä»¶ï¼ï¼æ§è½ä¼æ¥å§ä¸éï¼ä½ ä¼çå° <code>Disk: xxx kB</code>ï¼ã</li>
<li><strong>åªæ¯æç­å¼è¿æ¥ï¼</strong> åªè½ç¨äº <code>ON a.id = b.id</code>ï¼ä¸æ¯æ <code>&gt;</code> æ <code>&lt;</code>ã</li>
</ul>
</li>
<li><strong>éç¨åºæ¯ï¼</strong>
<ul>
<li><strong>ä¸¤å¼ è¡¨é½å¾å¤§</strong>ï¼ä¸è¢«é©±å¨è¡¨ä¸æ²¡æåéçç´¢å¼ã</li>
<li>æ¥è¯¢ç»æéå¾å¤§ï¼ç´¢å¼æ«æäº§ççéæº I/O ä»£ä»·å¤ªé«ã</li>
</ul>
</li>
</ul>
<hr>
<h3 id="3-å½å¹¶è¿æ¥-merge-join--sort-merge-join">3. å½å¹¶è¿æ¥ (Merge Join / Sort Merge Join)</h3>
<p>è¿æ¯ä¸ç§ä¼éçç®æ³ï¼åææ¯æ°æ®<strong>å·²ç»æå¥½åº</strong>ã</p>
<ul>
<li><strong>å·¥ä½æµç¨ï¼</strong>
<ol>
<li>å¦æä¸æåºï¼åå¯¹ä¸¤å¼ è¡¨åå«è¿è¡<strong>æåº (Sort)</strong>ã</li>
<li>ä½¿ç¨åæéç®æ³ï¼åæ¶éåä¸¤å¼ è¡¨ã</li>
<li>å¦æ <code>A.id &lt; B.id</code>ï¼A çæéå¾ä¸ç§»ï¼å¦æ <code>A.id &gt; B.id</code>ï¼B çæéå¾ä¸ç§»ï¼å¦æç¸ç­ï¼è¾åºç»æã</li>
</ol>
</li>
<li><strong>æ§è½å³é®ç¹ï¼</strong>
<ul>
<li><strong>æåºææ¬ï¼</strong> å¦ææ°æ®æ¬èº«æ²¡æåºï¼æåºçä»£ä»·éå¸¸é«ã</li>
<li><strong>ç´¢å¼ä¼å¿ï¼</strong> å¦æè¿æ¥å­æ®µä¸æ¬æ¥å°±æ B-Tree ç´¢å¼ï¼ç´¢å¼æ¬è´¨å°±æ¯æåºçï¼ï¼é£ä¹å¯ä»¥ç´æ¥è·³è¿æåºæ­¥éª¤ï¼æ§è½æå¿«ã</li>
</ul>
</li>
<li><strong>éç¨åºæ¯ï¼</strong>
<ul>
<li>è¿æ¥å­æ®µä¸æ<strong>ç´¢å¼</strong>ï¼å¤©ç¶æåºï¼ã</li>
<li>SQL ä¸­åå« <code>ORDER BY</code>ï¼æ­£å¥½å©ç¨è¿æ¥åçæåºç»æã</li>
<li><strong>éç­å¼è¿æ¥</strong>ä¸­çèå´è¿æ¥ï¼å¦ <code>BETWEEN</code> ï¼ã</li>
</ul>
</li>
</ul>
<hr>
<h3 id="4-ä¸ç§ç®å­å¯¹æ¯æ»ç»è¡¨">4. ä¸ç§ç®å­å¯¹æ¯æ»ç»è¡¨</h3>
<table>
<thead>
<tr>
<th><strong>ç¹æ§</strong></th>
<th><strong>Nested Loop (åµå¥å¾ªç¯)</strong></th>
<th><strong>Hash Join (åå¸è¿æ¥)</strong></th>
<th><strong>Merge Join (å½å¹¶è¿æ¥)</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ ¸å¿é»è¾</strong></td>
<td>åå±å¾ªç¯</td>
<td>åå­åå¸è¡¨å¹é</td>
<td>æåºåæé¾å¼åå¹¶</td>
</tr>
<tr>
<td><strong>éç¨æ°æ®é</strong></td>
<td><strong>å°æ°æ®é</strong> (å°è¡¨é©±å¨å¤§è¡¨)</td>
<td><strong>å¤§æ°æ®é</strong> (ä¸¤è¡¨åå¤§)</td>
<td><strong>å¤§æ°æ®é</strong> (ä¸æåº)</td>
</tr>
<tr>
<td><strong>ç´¢å¼ä¾èµ</strong></td>
<td>å¼ºä¾èµ (è¢«é©±å¨è¡¨éç´¢å¼)</td>
<td>ä¸ä¾èµ</td>
<td>æå¥½æ (å¯åå»æåº)</td>
</tr>
<tr>
<td><strong>åå­æ¶è</strong></td>
<td>æä½</td>
<td><strong>é«</strong> (éæå»ºåå¸è¡¨)</td>
<td>ä¸­ (è¥éæåºåé«)</td>
</tr>
<tr>
<td><strong>æ¯ææ¡ä»¶</strong></td>
<td>ä»»ä½ (ç­å¼/ä¸ç­å¼/èå´)</td>
<td><strong>ä»éç­å¼</strong> (<code>=</code>)</td>
<td>ç­å¼æèå´</td>
</tr>
<tr>
<td><strong>å¯å¨éåº¦</strong></td>
<td>å¿« (ç«å³è¿åé¦è¡)</td>
<td>æ¢ (éåæå»ºåå¸è¡¨)</td>
<td>æ¢ (éåæåº)</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="5-å¦ä½æ ¹æ®ç®å­ä¼å-sql">5. å¦ä½æ ¹æ®ç®å­ä¼å SQLï¼</h3>
<p>å½ä½ å¨ <code>EXPLAIN</code> ä¸­çå°ä»¥ä¸æåµæ¶ï¼å¯ä»¥å°è¯ä¼åï¼</p>
<ol>
<li><strong>çå° <code>Nested Loop</code> ä½å¾æ¢ï¼</strong>
<ul>
<li>æ£æ¥è¢«é©±å¨è¡¨ï¼Inner Tableï¼çè¿æ¥å­æ®µæ¯å¦æ<strong>ç´¢å¼</strong>ãå¦ææ²¡æï¼æ°æ®åºå¨ç¯çåå¨è¡¨æ«æã</li>
</ul>
</li>
<li><strong>çå° <code>Hash Join</code> ä¸å¸¦æ <code>Batches</code> æ <code>Disk</code>ï¼</strong>
<ul>
<li>è¯´æåå­ä¸å¤ç¨äºï¼æ°æ®æº¢åºå°äºç£çãå°è¯è°å¤§ <code>work_mem</code> åæ°ï¼æèä¼å WHERE æ¡ä»¶åå°åä¸è¿æ¥çæ°æ®éã</li>
</ul>
</li>
<li><strong>çå° <code>Merge Join</code> ä¹åæä¸ä¸ªå·¨å¤§ç <code>Sort</code>ï¼</strong>
<ul>
<li>æåºéå¸¸æ¶è CPU ååå­ãå¦æå¨è¿æ¥å­æ®µå»ºç«ç´¢å¼ï¼å¯ä»¥æ¶é¤è¿ä¸ªæåºæ­¥éª¤ï¼ç´æ¥å©ç¨ Index Scan è¿è¡ Merge Joinã</li>
</ul>
</li>
</ol>
<h2 id="3-éåä¸èåç®å­-aggregation--set-nodes">3. éåä¸èåç®å­ (Aggregation &amp; Set Nodes)</h2>
<p>è¿ç±»ç®å­è´è´£å¯¹æ°æ®è¿è¡å»éãåç»è®¡ç®æåå¹¶å¤ä¸ªç»æéã</p>
<ul>
<li><strong>èåç±»ï¼</strong>
<ul>
<li><strong>Aggregate:</strong> å®ç° <code>COUNT</code>, <code>SUM</code>, <code>AVG</code> ç­ã</li>
<li><strong>GroupAggregate:</strong> éå¯¹<strong>å·²æåº</strong>çæ°æ®è¿è¡åç»èåã</li>
<li><strong>HashAggregate:</strong> éå¯¹<strong>æªæåº</strong>çæ°æ®ï¼å©ç¨åå¸è¡¨å¨åå­ä¸­è¿è¡åç»ã</li>
</ul>
</li>
<li><strong>éåç±»ï¼</strong>
<ul>
<li><strong>Unique:</strong> å¯¹æåºæ°æ®è¿è¡å»éï¼å¦ <code>DISTINCT</code>ï¼ã</li>
<li><strong>HashSetOp:</strong> å©ç¨åå¸è¡¨è¿è¡éåæä½ï¼å¦ <code>INTERSECT</code> æ <code>EXCEPT</code>ï¼ã</li>
<li><strong>Append:</strong> å°å¤ä¸ªå­æ¥è¯¢çç»æéï¼å¦ <code>UNION ALL</code>ï¼ç®åå å å¨ä¸èµ·ã</li>
</ul>
</li>
</ul>
<p>å¨æ°æ®åºæ§è¡è®¡åä¸­ï¼<strong>éåä¸èåç®å­ï¼Aggregation &amp; Set Nodesï¼</strong> è´è´£å¯¹æ«ææè¿æ¥åçâåææâæ°æ®è¿è¡æ·±å å·¥ã</p>
<p>ç®åæ¥è¯´ï¼</p>
<ul>
<li><strong>èåç®å­</strong>æ¯åâæ°å­¦é¢âçï¼æ±åãè®¡æ°ãå¹³åãåç»ï¼ã</li>
<li><strong>éåç®å­</strong>æ¯åâæ¼å¾âçï¼åå¹¶ãäº¤éãå»éï¼ã</li>
</ul>
<h3 id="ç¬¬ä¸é¨åèåç®å­-aggregation-nodes">ç¬¬ä¸é¨åï¼èåç®å­ (Aggregation Nodes)</h3>
<p>å½ä½ ä½¿ç¨ <code>GROUP BY</code>ã<code>COUNT</code>ã<code>SUM</code>ã<code>AVG</code> ç­è¯­å¥æ¶ï¼å°±ä¼è§¦åæ­¤ç±»ç®å­ãæ°æ®åºéå¸¸æä¸¤ç§ç­ç¥æ¥å¤çèåï¼<strong>åå¸ï¼Hashï¼</strong> å <strong>æåºï¼Sort/Groupï¼</strong>ã</p>
<h5 id="1-hashaggregate-åå¸èå">1. HashAggregate (åå¸èå)</h5>
<p>è¿æ¯å¤ç<strong>æªæåºæ°æ®</strong>æå¸¸ç¨çèåæ¹å¼ã</p>
<ul>
<li><strong>å·¥ä½åçï¼æ¡¶æåºææ³ï¼ï¼</strong>
<ol>
<li>æ°æ®åºå¨åå­ï¼<code>work_mem</code>ï¼ä¸­åå»ºä¸ä¸ªåå¸è¡¨ã</li>
<li>æ«ææ¯ä¸è¡æ°æ®ï¼è®¡ç® <code>GROUP BY</code> å­æ®µçåå¸å¼ã</li>
<li>å°æ°æ®ä¸¢è¿å¯¹åºçâæ¡¶âéï¼å¹¶å®æ¶æ´æ°èåç¶æï¼ä¾å¦ï¼å¦ææ¯ <code>COUNT</code> å°± +1ï¼å¦ææ¯ <code>SUM</code> å°±ç´¯å ï¼ã</li>
<li>æ«æç»æåï¼éååå¸è¡¨è¾åºç»æã</li>
</ol>
</li>
<li><strong>ä¼ç¹ï¼</strong> ä¸éè¦æ°æ®é¢åæåºï¼éåº¦éå¸¸å¾å¿«ã</li>
<li><strong>ç¼ºç¹ï¼</strong> <strong>éå¸¸ååå­</strong>ãå¦æåç»çæ°éå¤ªå¤ï¼æ¯å¦æ UserID åç»ï¼æ 100 ä¸ä¸ªç¨æ·ï¼ï¼åå¸è¡¨ä¼æçåå­ï¼å¯¼è´æº¢åºå°ç£çï¼Disk Spillï¼ï¼æ§è½æ¥å§ä¸éã</li>
<li><strong>åºæ¯ï¼</strong> æ°æ®æ åºï¼ä¸åç»åºæ°ï¼Cardinalityï¼éä¸­ã</li>
</ul>
<h5 id="2-groupaggregate-åç»èå">2. GroupAggregate (åç»èå)</h5>
<p>è¿æ¯åºäº<strong>æåºæ°æ®</strong>çèåæ¹å¼ã</p>
<ul>
<li><strong>å·¥ä½åçï¼æµæ°´çº¿ææ³ï¼ï¼</strong>
<ol>
<li><strong>åæï¼</strong> è¾å¥çæ°æ®å¿é¡»å·²ç»æ <code>GROUP BY</code> å­æ®µæå¥½åºäºï¼éå¸¸ç±ä¸å±ç <code>Sort</code> ç®å­æ <code>Index Scan</code> ä¿è¯ï¼ã</li>
<li>æ°æ®åºéè¡è¯»åæ°æ®ã</li>
<li>å¦æå½åè¡çåç»é®åä¸ä¸è¡ä¸æ ·ï¼å°±ç´¯å ï¼å¦æä¸ä¸æ ·ï¼è¯´æä¸ä¸ä¸ªç»ç»æäºï¼è¾åºç»æï¼å¼å§ä¸ä¸ä¸ªç»ã</li>
</ol>
</li>
<li><strong>ä¼ç¹ï¼</strong> <strong>åå­å ç¨æä½</strong>ï¼åªéè¦å­å½åè¿ä¸ç»çç¶æï¼ï¼ä¸å¯ä»¥æµå¼è¾åºï¼ä¸ç¨ç­æææ°æ®è¯»å®å°±è½åºç¬¬ä¸è¡ç»æï¼ã</li>
<li><strong>ç¼ºç¹ï¼</strong> å¼ºä¾èµæ°æ®æåºãå¦ææ°æ®æ¬èº«æ²¡åºï¼åé¢å¿é¡»å ä¸ä¸ªæè´µç <code>Sort</code> ç®å­ã</li>
<li><strong>åºæ¯ï¼</strong> <code>GROUP BY</code> å­æ®µä¸æç´¢å¼ï¼æèæ°æ®éå¤§å°åå­è£ä¸ä¸åå¸è¡¨ã</li>
</ul>
<h5 id="3-plain-aggregate-æ®éèå">3. Plain Aggregate (æ®éèå)</h5>
<ul>
<li><strong>å«ä¹ï¼</strong> æ²¡æ <code>GROUP BY</code>ï¼åªç®ä¸ä¸ªå¨å±çæ»æ°ãä¾å¦ <code>SELECT COUNT(*) FROM table</code>ã</li>
<li><strong>ç¹ç¹ï¼</strong> æç®åï¼æ«ä¸éå¨è¡¨ï¼ç»´æ¤ä¸ä¸ªè®¡æ°å¨å³å¯ã</li>
</ul>
<hr>
<h3 id="ç¬¬äºé¨åéåä¸å»éç®å­-set--unique-nodes">ç¬¬äºé¨åï¼éåä¸å»éç®å­ (Set &amp; Unique Nodes)</h3>
<p>å½ä½ ä½¿ç¨ <code>UNION</code>ã<code>INTERSECT</code>ã<code>EXCEPT</code> æ <code>DISTINCT</code> æ¶ï¼ä¼ç¨å°è¿äºç®å­ã</p>
<h4 id="1-append-è¿½å ">1. Append (è¿½å )</h4>
<ul>
<li><strong>å¯¹åº SQLï¼</strong> <code>UNION ALL</code></li>
<li><strong>å·¥ä½åçï¼</strong> æå¶ç®åãåæç¬¬ä¸ä¸ªå­æ¥è¯¢çç»æååºæ¥ï¼åæç¬¬äºä¸ªå­æ¥è¯¢çç»æååºæ¥ãä¸åå»éï¼ä¸åæåºã</li>
<li><strong>æ§è½ï¼</strong> <strong>æå¿«</strong>ãåªè¦ä¸éè¦å»éï¼å°½éç¨ <code>UNION ALL</code> ä»£æ¿ <code>UNION</code>ã</li>
</ul>
<h4 id="2-unique-å»é">2. Unique (å»é)</h4>
<ul>
<li><strong>å¯¹åº SQLï¼</strong> <code>DISTINCT</code> æ <code>UNION</code>ï¼ä¸å¸¦ ALLï¼ã</li>
<li><strong>å·¥ä½åçï¼</strong> ç±»ä¼¼äº <code>GroupAggregate</code>ï¼å®è¦æ±è¾å¥æ°æ®æ¯æåºçãå®å¯¹æ¯å½åè¡åä¸ä¸è¡ï¼å¦æç¸åå°±ä¸¢å¼ï¼ä¸åå°±è¾åºã</li>
<li><strong>æ³¨æï¼</strong> å¦ææ°æ®æ²¡åºï¼éå¸¸ä¼åçå° <code>Sort</code>ï¼åçå° <code>Unique</code>ã</li>
</ul>
<h4 id="3-hashsetop--sortsetop-éåæä½">3. HashSetOp / SortSetOp (éåæä½)</h4>
<ul>
<li><strong>å¯¹åº SQLï¼</strong> <code>INTERSECT</code> (äº¤é) æ <code>EXCEPT</code> (å·®é)ã</li>
<li><strong>HashSetOpï¼</strong> ç¨åå¸è¡¨æ¥å¤æ­åç´ æ¯å¦å­å¨äºä¸¤ä¸ªéåä¸­ã</li>
<li><strong>SortSetOpï¼</strong> åæä¸¤ä¸ªéåæåºï¼ç¶åç¨åæéç®æ³æ¯å¯¹ã</li>
</ul>
<hr>
<h4 id="ç¬¬ä¸é¨åå®æä¸­çæ§è½åå¼">ç¬¬ä¸é¨åï¼å®æä¸­çæ§è½åå¼</h4>
<p>å¨çæ§è¡è®¡åæ¶ï¼ä½ éè¦å³æ³¨ä»¥ä¸å ç¹ï¼</p>
<h4 id="1-åå­-vs-æåº-hashagg-vs-groupagg">1. åå­ vs æåº (HashAgg vs GroupAgg)</h4>
<ul>
<li>å¦æä½ ç SQL è·å¾å¾æ¢ï¼ä¸çå° <strong>HashAggregate</strong> ä¸æ¹æ <code>Disk: xxx kB</code>ï¼è¯´æåå­ä¸å¤äºã
<ul>
<li><strong>ä¼åï¼</strong> è°å¤§ <code>work_mem</code> åæ°ï¼è®©åå¸è¡¨è½è£å¥åå­ã</li>
</ul>
</li>
<li>å¦æä½ çå° <strong>GroupAggregate</strong> ä¸æ¹æä¸ä¸ªå·¨å¤§ç <strong>Sort</strong>ï¼ä¸ <code>Sort Method: external merge</code>ã
<ul>
<li><strong>ä¼åï¼</strong> å°è¯å¨ <code>GROUP BY</code> å­æ®µä¸å ç´¢å¼ãæäºç´¢å¼ï¼æ°æ®å¤©ç¶æåºï¼<code>Sort</code> ç®å­å°±ä¼æ¶å¤±ï¼ç´æ¥è¿è¡ <code>GroupAggregate</code>ï¼æ§è½èµ·é£ã</li>
</ul>
</li>
</ul>
<h4 id="2-distinct-çä»£ä»·">2. DISTINCT çä»£ä»·</h4>
<p><code>DISTINCT</code> æ¬è´¨ä¸å°±æ¯ä¸æ¬¡èåææåºã</p>
<ul>
<li><code>SELECT DISTINCT user_id ...</code> ç­ä»·äº <code>SELECT user_id ... GROUP BY user_id</code>ã</li>
<li>åä¸ä¸è¦æ»¥ç¨ <code>DISTINCT</code>ãå¦æä½ åäº <code>DISTINCT</code>ï¼æ°æ®åºå°±å¿é¡»ææææ°æ®æ¿æ¥è¿è¡ä¸æ¬¡æè´µçå»éè®¡ç®ã</li>
</ul>
<h4 id="æ»ç»å¯¹æ¯è¡¨">æ»ç»å¯¹æ¯è¡¨</h4>
<table>
<thead>
<tr>
<th><strong>ç®å­åç§°</strong></th>
<th><strong>åè½</strong></th>
<th><strong>ä¾èµæ¡ä»¶</strong></th>
<th><strong>åå­æ¶è</strong></th>
<th><strong>éç¨åºæ¯</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>HashAggregate</strong></td>
<td>åç»/å»é</td>
<td>æ </td>
<td><strong>é«</strong> (ååºæ°å½±å)</td>
<td>æ ç´¢å¼ï¼åç»æ°ééä¸­</td>
</tr>
<tr>
<td><strong>GroupAggregate</strong></td>
<td>åç»/å»é</td>
<td><strong>æ°æ®å¿é¡»æåº</strong></td>
<td>ä½</td>
<td>æç´¢å¼ï¼ææ°æ®éæå¤§</td>
</tr>
<tr>
<td><strong>Append</strong></td>
<td>åå¹¶ç»æ</td>
<td>æ </td>
<td>æä½</td>
<td><code>UNION ALL</code></td>
</tr>
<tr>
<td><strong>Unique</strong></td>
<td>æåºå»é</td>
<td><strong>æ°æ®å¿é¡»æåº</strong></td>
<td>ä½</td>
<td><code>DISTINCT</code> (éåæåº)</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="4-è¾å©ä¸æ§å¶ç®å­-materialize--control-nodes">4. è¾å©ä¸æ§å¶ç®å­ (Materialize &amp; Control Nodes)</h2>
<p>è¿ç±»ç®å­ä¸ç´æ¥äº§çæ°æ°æ®ï¼èæ¯ä¸ºäºæ»¡è¶³ç¹å®è¯­æ³ï¼æåºãåé¡µï¼æä¼åæ§è¡æçã</p>
<ul>
<li><strong>æåº (Sort):</strong> æ§è¡ <code>ORDER BY</code>ï¼å¦æåå­è£ä¸ä¸ä¼è§¦åç£çæåºã</li>
<li><strong>ç©å (Materialize):</strong> å°ä¸å±ç®å­çç»æç¼å­å°åå­ä¸­ï¼ä¾ä¸å±ç®å­éå¤è¯»åï¼å¸¸è§äº Nested Loopï¼ã</li>
<li><strong>éå¶ (Limit):</strong> å¤ç <code>LIMIT</code> å <code>OFFSET</code>ï¼è¾¾å°è¡æ°åç«å³åæ­¢ä¸å±ç®å­ã</li>
<li><strong>éå® (LockRows):</strong> å¤ç <code>SELECT FOR UPDATE</code> ç­éå®è¡æä½ã</li>
<li><strong>ç»æ (Result):</strong> å¤çä¸æ¶åè¡¨çè®¡ç®ï¼å¦ <code>SELECT 1+1</code>ï¼ã</li>
</ul>
<p>å¨ PostgreSQL çæ§è¡è®¡åä¸­ï¼<strong>è¾å©ä¸æ§å¶ç®å­ï¼Auxiliary &amp; Control Nodesï¼</strong> è½ç¶ä¸ç´æ¥è´è´£âæ¾æ°æ®âæâæ¼æ°æ®âï¼ä½å®ä»¬æ¯æ´ä¸ªæµæ°´çº¿ç<strong>è°åº¦å</strong>å<strong>å å·¥å</strong>ãå®ä»¬å³å®äºæ°æ®å¦ä½æåºãä½æ¶åæ­¢ãå¦ä½å¹¶è¡å¤çä»¥åå¦ä½éå®ã</p>
<p>ä»¥ä¸æ¯è¿ç±»æ ¸å¿ç®å­çè¯¦ç»è®²è§£ï¼</p>
<hr>
<h3 id="1-æåºç®å­-sort-node">1. æåºç®å­ (Sort Node)</h3>
<p>è¿æ¯æå¸¸è§ï¼ä¹æ¯æå®¹ææä¸ºæ§è½ç¶é¢çè¾å©ç®å­ã</p>
<ul>
<li>
<p><strong>åè½ï¼</strong> å¯¹ä¸å±ç®å­è¿åçæ°æ®éè¿è¡æåºï¼ååº <code>ORDER BY</code>ï¼æèä¸º <code>Merge Join</code> ååå¤ï¼ã</p>
</li>
<li>
<p><strong>å³é®ç®æ³ä¸åå­æºå¶ï¼</strong></p>
<ul>
<li><strong>Quicksort (åå­æåº):</strong> å½æ°æ®éå°äº <code>work_mem</code> åæ°æ¶ï¼PostgreSQL ä¼å¨åå­ä¸­å®æå¿«éæåºã<strong>è¿æ¯æå¿«çã</strong></li>
<li><strong>External Merge Sort (ç£çæåº):</strong> å½æ°æ®éè¶è¿ <code>work_mem</code> æ¶ï¼æ°æ®åºè¢«è¿«ææ°æ®åå°ä¸´æ¶æä»¶ï¼Diskï¼ï¼æå¥½åºåååå¹¶ã<strong>è¿ä¼äº§çå¤§éç£ç I/Oï¼éå¸¸æ¢ã</strong></li>
<li><strong>Top-N Heapsort:</strong> å½ SQL åå« <code>ORDER BY ... LIMIT n</code> æ¶ï¼æ°æ®åºä¸éè¦å¨æï¼åªéè¦ç»´æ¤ä¸ä¸ªå¤§å°ä¸º N çå ãè¿æ¯å¨æå¿«å¾å¤ã</li>
</ul>
</li>
<li>
<p><strong>æ§è½è­¦æ¥ï¼</strong></p>
<p>å¦æå¨ EXPLAIN ä¸­çå° <code>Sort Method: external merge Disk: 25000kB</code>ï¼è¯´æåå­ä¸å¤ç¨äºã</p>
<ul>
<li><strong>ä¼åï¼</strong> è°å¤§ <code>work_mem</code>ï¼æèå»ºç«ç´¢å¼ï¼ç´¢å¼æ¬èº«å°±æ¯æåºçï¼å¯ä»¥æ¶é¤ Sort ç®å­ï¼ã</li>
</ul>
</li>
</ul>
<hr>
<h3 id="2-éå¶ç®å­-limit-node">2. éå¶ç®å­ (Limit Node)</h3>
<p>å®æ¯æ¥è¯¢ä¼åçâå¹è½¦çâã</p>
<ul>
<li><strong>åè½ï¼</strong> å¯¹åº SQL ä¸­ç <code>LIMIT</code> å <code>OFFSET</code>ã</li>
<li><strong>å·¥ä½åçï¼</strong> å®åä¸ä¸ªè®¡æ°å¨ï¼ç´§ç¯çä¸å±ç®å­ååºæ¥çæ°æ®ãä¸æ¦æ¿å°äºæå®çè¡æ°ï¼æ¯å¦ 10 è¡ï¼ï¼å®ä¼ç«å³<strong>åæ­</strong>ä¸å±ç®å­çæ§è¡ï¼ä¸åè®©å®ä»¬ç»§ç»­å·¥ä½ã</li>
<li><strong>æ§è½æä¹ï¼</strong>
<ul>
<li>è¿æ¯ä¸ä¸ªâé»è¾ç®å­âï¼æ¬èº«æ¶èæå°ã</li>
<li>å®çä»·å¼å¨äº<strong>âç­è·¯æåºâ</strong>ãæ¯å¦ <code>SELECT * FROM billion_table LIMIT 1</code>ï¼Limit ç®å­ä¼è®© Seq Scan å¨è¯»å°ç¬¬ä¸è¡æ¶å°±åæ­¢ï¼èä¸æ¯æ«å®åäº¿è¡ã</li>
</ul>
</li>
</ul>
<hr>
<h3 id="3-ç©åç®å­-materialize-node">3. ç©åç®å­ (Materialize Node)</h3>
<p>æ³¨æï¼è¿è·âç©åè§å¾âæ¯ä¸¤ç äºãè¿éç Materialize æ¯æ§è¡è®¡åä¸­çä¸ä¸ª<strong>ä¸´æ¶ç¼å­æºå¶</strong>ã</p>
<ul>
<li><strong>åè½ï¼</strong> å°ä¸å±ç®å­çç»æ<strong>å®æ´å°è¯»åå¹¶æå­</strong>ï¼å¨åå­æç£çä¸­ï¼ï¼ä»¥ä¾¿ä¸å±ç®å­å¯ä»¥<strong>åå¤è¯»å</strong>è¿äºæ°æ®ã</li>
<li><strong>å¸ååºæ¯ï¼</strong>
<ul>
<li>åºç°å¨ <strong>Nested Loop Join</strong>ï¼åµå¥å¾ªç¯è¿æ¥ï¼ä¸­ã</li>
<li>å¦æåè¡¨ï¼è¢«é©±å¨è¡¨ï¼æ¯ä¸ä¸ªå¤æçå­æ¥è¯¢æè®¡ç®ç»æï¼æ°æ®åºä¸å¸ææ¯å¤çå¤è¡¨çä¸è¡ï¼åè¡¨å°±éæ°è®¡ç®ä¸æ¬¡ã</li>
<li><strong>ä¼åé»è¾ï¼</strong> åè¡¨è®¡ç®ä¸æ¬¡ -&gt; Materialize å­èµ·æ¥ -&gt; å¤è¡¨æ¯è¡å» Materialize éæ¥ã</li>
</ul>
</li>
<li><strong>EXPLAIN ç¹å¾ï¼</strong> éå¸¸å¤¹å¨ Nested Loop ååå±æ«æä¹é´ã</li>
</ul>
<hr>
<h3 id="4-å¹¶è¡æ§å¶ç®å­-parallel-nodes">4. å¹¶è¡æ§å¶ç®å­ (Parallel Nodes)</h3>
<p>å½ PostgreSQL å³å®å¨ç¨å¤ä¸ª CPU æ ¸å¿æ¥å éæ¥è¯¢æ¶ï¼å°±ä¼åºç°è¿äºç®å­ãå®ä»¬è´è´£åè°âé¢éâåâå·¥äººâä¹é´çå³ç³»ã</p>
<ul>
<li><strong>Gather (æ¶é):</strong>
<ul>
<li><strong>è§è²ï¼</strong> å®æ¯âå·¥å¤´âï¼Leader Processï¼ã</li>
<li><strong>åè½ï¼</strong> å¯å¨å¤ä¸ªå¹¶è¡å·¥ä½çº¿ç¨ï¼Workersï¼ï¼ç­å¾å®ä»¬å¹²å®æ´»ï¼æç»ææ±æ»å°è¿éï¼ååç»ä¸å±ã</li>
</ul>
</li>
<li><strong>Gather Merge (æåºæ¶é):</strong>
<ul>
<li><strong>åè½ï¼</strong> ç±»ä¼¼äº Gatherï¼ä½å®è¦æ±ææ Worker è¿åçæ°æ®æ¯æåºçï¼å¹¶ä¸å®å¨æ±æ»æ¶ä¼ä¿æè¿ç§é¡ºåºï¼ç±»ä¼¼äºå½å¹¶æåºçæåä¸æ­¥ï¼ã</li>
<li><strong>åºæ¯ï¼</strong> å¹¶è¡æ¥è¯¢ä¸å¸¦æ <code>ORDER BY</code> æ¶ã</li>
</ul>
</li>
<li><strong>Parallel Seq Scan / Parallel Hash Join:</strong>
<ul>
<li>è¿äºå¸¦æ <code>Parallel</code> åç¼çç®å­ï¼è¯´æå®ä»¬æ¯å¨ Worker çº¿ç¨åé¨æ§è¡çã</li>
</ul>
</li>
</ul>
<hr>
<h3 id="5-ç»æç®å­-result-node">5. ç»æç®å­ (Result Node)</h3>
<p>è¿æ¯æç®åçç®å­ï¼éå¸¸å¤çä¸æ¶åè¡¨æ«æçè®¡ç®ã</p>
<ul>
<li><strong>åè½ï¼</strong> è®¡ç®å¹¶è¿åä¸ä¸ªå¸¸éæè¡¨è¾¾å¼ã</li>
<li><strong>åºæ¯ï¼</strong>
<ul>
<li><code>SELECT 1;</code></li>
<li><code>SELECT version();</code></li>
<li>æäºå¤æç <code>CASE WHEN</code> é»è¾ï¼å¦æä¼åå¨è®¤ä¸ºä¸éè¦æ¥è¡¨ï¼ä¹ä¼ç¨ Resultã</li>
<li><strong>One-Time Filter:</strong> å¦æ <code>WHERE</code> æ¡ä»¶æ¯å¸¸éä¸ä¸ºåï¼å¦ <code>WHERE 1=2</code>ï¼ï¼Result ç®å­ä¼ç´æ¥è¿åç©ºï¼æ´ä¸ªæ¥è¯¢ç¬é´ç»æã</li>
</ul>
</li>
</ul>
<hr>
<h3 id="6-éå®ç®å­-lockrows-node">6. éå®ç®å­ (LockRows Node)</h3>
<p>è¿æ¯ä¸ºäºå¹¶åæ§å¶èå­å¨çã</p>
<ul>
<li><strong>åè½ï¼</strong> å¯¹åº SQL ä¸­ç <code>SELECT ... FOR UPDATE</code> æ <code>FOR SHARE</code>ã</li>
<li><strong>å·¥ä½åçï¼</strong>
<ul>
<li>å®ä¼å»è®¿é®æ°æ®è¡ï¼å¹¶å°è¯å¨è¡å¤´ï¼Tuple Headerï¼æä¸éæ è®°ã</li>
<li>å¦ææå¶ä»äºå¡éä½äºè¿è¡ï¼å®ä¼å¨è¿é<strong>ç­å¾</strong>ï¼Blockedï¼ï¼ç´å°ééæ¾æè¶æ¶ã</li>
</ul>
</li>
<li><strong>ä½ç½®ï¼</strong> éå¸¸ä½äºæ§è¡è®¡åçæé¡¶å±éè¿ï¼ç¡®ä¿æ°æ®å¨è¿åç»ç¨æ·åå·²ç»è¢«éä½ã</li>
</ul>
<hr>
<h3 id="æ»ç»å¦ä½éè¿è¿äºç®å­è¯æ­é®é¢">æ»ç»ï¼å¦ä½éè¿è¿äºç®å­è¯æ­é®é¢ï¼</h3>
<table>
<thead>
<tr>
<th><strong>ç®å­</strong></th>
<th><strong>çå°çç°è±¡</strong></th>
<th><strong>æ½å¨é®é¢</strong></th>
<th><strong>è§£å³æ¹æ¡</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Sort</strong></td>
<td><code>Disk: xxx kB</code></td>
<td>åå­æº¢åºï¼ç£çæåº</td>
<td>è°å¤§ <code>work_mem</code> æå ç´¢å¼</td>
</tr>
<tr>
<td><strong>Materialize</strong></td>
<td>èæ¶å¾ä¹</td>
<td>åå±å­æ¥è¯¢å¤ªé</td>
<td>ä¼åå­æ¥è¯¢ï¼ææ¹å JOIN é»è¾</td>
</tr>
<tr>
<td><strong>Gather</strong></td>
<td><code>Workers Planned: 2, Launched: 0</code></td>
<td>å¹¶è¡æªçæ</td>
<td>æ£æ¥æå¡å¨è´è½½æå¹¶è¡åæ°éç½®</td>
</tr>
<tr>
<td><strong>LockRows</strong></td>
<td>æ¥è¯¢å¡æ­»ä¸è¿å</td>
<td>éç«äº</td>
<td>æ£æ¥æ¯å¦æé¿äºå¡æªæäº¤</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="5å¹¶è¡ç®å­-parallel-nodes">5.å¹¶è¡ç®å­ (Parallel Nodes)</h2>
<p>å¨å¼å¯å¹¶è¡æ¥è¯¢æ¶ï¼ä½ ä¼çå°å¸¦ <code>Gather</code> åç¼çç¹æ®ç®å­ï¼</p>
<ul>
<li><strong>Gather:</strong> æ±æ»èç¹ãæ¶éææå¹¶è¡å·¥ä½çº¿ç¨ï¼Workersï¼çç»æã</li>
<li><strong>Gather Merge:</strong> æ¶éç»æçåæ¶ä¿ææ°æ®çæåºæ§ã</li>
<li><strong>Parallel Seq Scan:</strong> å¤ä¸ªçº¿ç¨åæ¶åæ®µæ«æä¸å¼ è¡¨ã</li>
</ul>
<p>å¨ PostgreSQL 9.6 ä¹åï¼æ è®ºæå¡å¨æå¤å°ä¸ª CPU æ ¸å¿ï¼ä¸æ¡ SQL æ¥è¯¢åªè½ä½¿ç¨<strong>ä¸ä¸ª CPU æ ¸</strong>ï¼åçº¿ç¨ï¼ãè¿å°±åè®©ä½ ä¸ä¸ªäººæ¬ä¸ä¸åç ï¼åªææè¾¹ç«ç 10 ä¸ªäººä¹æ²¡ç¨ã<strong>å¹¶è¡ç®å­ (Parallel Nodes)</strong> çå¼å¥å½»åºæ¹åäºè¿ä¸ç¹ãå®åè®¸æ°æ®åºå¯å¨å¤ä¸ªåå°å·¥ä½çº¿ç¨ï¼Background Workersï¼ï¼å¤§å®¶ä¸èµ·å¹²æ´»ï¼æåç±âåå·¥å¤´âæ±æ»ç»æãä»¥ä¸æ¯å¹¶è¡æ¥è¯¢çæ ¸å¿æ¶æä¸å³é®ç®å­è¯¦è§£ï¼</p>
<hr>
<h3 id="1-æ ¸å¿æ¶æé¢éä¸å·¥äºº-leader--workers">1. æ ¸å¿æ¶æï¼é¢éä¸å·¥äºº (Leader &amp; Workers)</h3>
<p>çè§£å¹¶è¡ç®å­ï¼é¦åè¦çè§£ PostgreSQL çå¹¶è¡æ¨¡åï¼</p>
<ol>
<li><strong>Leader Process (é¢éè¿ç¨):</strong>
<ul>
<li>è¿æ¯ä½ è¿æ¥æ°æ®åºçé£ä¸ªä¸»ä¼è¯è¿ç¨ã</li>
<li>å®è´è´£å¶å®è®¡åãåéä»»å¡ãå¯å¨ Workerãæ¶éç»æï¼å¹¶ææç»ç»æè¿åç»å®¢æ·ç«¯ã</li>
</ul>
</li>
<li><strong>Worker Processes (å·¥äººè¿ç¨):</strong>
<ul>
<li>ç± Leader å¨æå¯å¨ã</li>
<li>å®ä»¬æ§è¡è®¡åä¸­æ è®°ä¸º <code>Parallel</code> çé¨åï¼å¦æ«æãèåãè¿æ¥ï¼ã</li>
<li>å®ä»¬éè¿<strong>å¨æå±äº«åå­ (Dynamic Shared Memory, DSM)</strong> ä¸ Leader äº¤æ¢æ°æ®ã</li>
</ul>
</li>
</ol>
<hr>
<h3 id="2-å³é®ç®å­è¯¦è§£">2. å³é®ç®å­è¯¦è§£</h3>
<p>å¨æ§è¡è®¡åæ ä¸­ï¼å¹¶è¡é¨åéå¸¸ä½äºæ ç<strong>ä¸åé¨å</strong>ï¼é¡¶é¨æ»ä¼æä¸ä¸ª <code>Gather</code> ç±»çèç¹ä½ä¸ºåççº¿ã</p>
<h5 id="a-gather-æ±æ»ç®å­">A. Gather (æ±æ»ç®å­)</h5>
<p>è¿æ¯å¹¶è¡æ§è¡ç<strong>æ»åºå£</strong>ï¼ä¹æ¯ Leader è¿ç¨ä¸»è¦å·¥ä½çå°æ¹ã</p>
<ul>
<li><strong>åè½ï¼</strong>
<ol>
<li>å¯å¨ N ä¸ª Worker çº¿ç¨ã</li>
<li>ç­å¾ææ Worker ææ°æ®å¤çå®ã</li>
<li>æ Worker ä¼ åæ¥çæ°æ®ï¼ä»¥å Leader èªå·±å¤ççä¸é¨åæ°æ®ï¼åå¹¶å¨ä¸èµ·ã</li>
<li>åä¸å±ç®å­è¾åºéå¹¶è¡çç»ææµã</li>
</ol>
</li>
<li><strong>EXPLAIN å³é®ä¿¡æ¯ï¼</strong>
<ul>
<li><code>Workers Planned: 2</code>: è®¡åå¯å¨ 2 ä¸ªå·¥äººã</li>
<li><code>Workers Launched: 2</code>: å®éå¯å¨äº 2 ä¸ªãå¦æç³»ç»è´è½½å¤ªé«ï¼Launched å¯è½å°äº Plannedï¼çè³ä¸º 0ï¼éçº§ä¸ºåçº¿ç¨ï¼ã</li>
</ul>
</li>
</ul>
<h5 id="b-gather-merge-æåºæ±æ»ç®å­">B. Gather Merge (æåºæ±æ»ç®å­)</h5>
<p>è¿æ¯ <code>Gather</code> çåçº§çï¼ç¨äºéè¦<strong>ä¿çé¡ºåº</strong>çåºæ¯ã</p>
<ul>
<li><strong>åè½ï¼</strong>
<ul>
<li>åè®¾ä¸å±çæ¯ä¸ª Worker è¿åçæ°æ®é½å·²ç»å±é¨æå¥½åºäºã</li>
<li><code>Gather Merge</code> å°±åå½å¹¶æåºçæåä¸æ­¥ï¼å®è¯»åææ Worker çè¾åºï¼éè¿æ¯è¾ï¼æé¡ºåºææ°æ®åç»ä¸å±ã</li>
</ul>
</li>
<li><strong>éç¨åºæ¯ï¼</strong> SQL ä¸­æ <code>ORDER BY</code>ï¼ä¸ä¸å±èµ°äº <code>Parallel Index Scan</code> æåè¿å¹¶è¡æåºã</li>
</ul>
<h5 id="c-parallel-seq-scan-å¹¶è¡å¨è¡¨æ«æ">C. Parallel Seq Scan (å¹¶è¡å¨è¡¨æ«æ)</h5>
<p>è¿æ¯ Worker ä»¬æå¸¸å¹²çæ´»ã</p>
<ul>
<li><strong>å·¥ä½åçï¼</strong>
<ul>
<li>å¹¶ä¸æ¯æè¡¨åæ N ä»½åºå®åéç» N ä¸ª Workerã</li>
<li>èæ¯éç¨<strong>âæ¢ä»»å¡âæ¨¡å¼ï¼Block-by-Blockï¼</strong>ã</li>
<li>ææ Workerï¼å ä¸ Leaderï¼å±äº«ä¸ä¸ªæ«ææ¸¸æ ãè°æ«å®ä¸ä¸ªæ°æ®åï¼Blockï¼ï¼å°±åç³»ç»ç³è¯·ä¸ä¸ä¸ªåãè¿æ ·è½é²æ­¢æç Worker æ«å°äºç©ºé²é¡µå¾å¿«å¹²å®ï¼æç Worker æ«å°äºå¤§å¯¹è±¡é¡µç´¯æ­»ã</li>
</ul>
</li>
<li><strong>ä¼å¿ï¼</strong> æå¤§å°æé«äº IOååéï¼å¦æç£çæå¾ä½ï¼å CPU è¿æ»¤éåº¦ã</li>
</ul>
<h5 id="d-parallel-hash--parallel-hash-join-å¹¶è¡åå¸è¿æ¥">D. Parallel Hash / Parallel Hash Join (å¹¶è¡åå¸è¿æ¥)</h5>
<p>è¿æ¯ PostgreSQL 11+ å¼å¥çéç£åè½ã</p>
<ul>
<li><strong>ä¼ ç» Hash Joinï¼</strong> ä¸ä¸ªè¿ç¨æå»ºåå¸è¡¨ï¼æå»ºå®åæ¢æµã</li>
<li><strong>å¹¶è¡ Hash Joinï¼</strong>
<ol>
<li><strong>Shared Hash Table:</strong> ææ Worker å±åå¨å±äº«åå­ä¸­æå»º<strong>åä¸ä¸ª</strong>å·¨å¤§çåå¸è¡¨ã</li>
<li><strong>ååæ¢æµ:</strong> æå»ºå®æåï¼ææ Worker åå¹¶è¡å»æ«æå¤è¡¨ï¼å©ç¨è¿ä¸ªå±äº«åå¸è¡¨è¿è¡æ¢æµã</li>
</ol>
</li>
<li><strong>æ³¨æï¼</strong> è¿éå¸¸æ¶èåå­ï¼</li>
</ul>
<hr>
<h3 id="3-ä¸ä¸ªå¸åçå¹¶è¡æ§è¡è®¡å">3. ä¸ä¸ªå¸åçå¹¶è¡æ§è¡è®¡å</h3>
<p>åè®¾æä»¬è¦ç»è®¡ä¸å¼  1 äº¿è¡å¤§è¡¨ <code>big_table</code> çè¡æ°ï¼</p>
<p>SQL</p>
<pre><code class="language-sql">EXPLAIN SELECT count(*) FROM big_table;
</code></pre>
<p><strong>æ§è¡è®¡åå¯è½é¿è¿æ ·ï¼</strong></p>
<pre><code class="language-sql">Finalize Aggregate  (cost=... rows=1 ...)
  -&gt;  Gather  (cost=... rows=3 ...)
        Workers Planned: 2
        -&gt;  Partial Aggregate  (cost=... rows=1 ...)
              -&gt;  Parallel Seq Scan on big_table  (cost=... rows=41666666 ...)
</code></pre>
<p><strong>è§£è¯»ï¼èªä¸èä¸ï¼ï¼</strong></p>
<ol>
<li>
<p><strong>Parallel Seq Scan:</strong> è¡¨è¢«åæäºå¾å¤åï¼3 ä¸ªè¿ç¨ï¼1 ä¸ª Leader + 2 ä¸ª Workersï¼åæ¶å»æ¢çæ«æã</p>
</li>
<li>
<p><strong>Partial Aggregate (é¨åèå):</strong> æ¯ä¸ª Worker æ«å®èªå·±é£é¨åæ°æ®åï¼åå¨æ¬å°ç®ä¸ä¸ª <code>count</code>ï¼æ¯å¦ Worker A ç®åº 3000 ä¸ï¼Worker B ç®åº 3500 ä¸ï¼ã</p>
</li>
<li>
<p><strong>Partial Aggregate (é¨åèå):</strong> æ¯<strong>å·¥äºº</strong>ï¼Workerï¼å¨å¹²æ´»ãæ¯ä¸ªäººåªç®èªå·±æå¤´é£ä¸å°å æ°æ®çâå°è´¦âã</p>
<p><strong>Aggregate / Finalize Aggregate (æç»èå):</strong> æ¯<strong>èæ¿</strong>ï¼Leaderï¼å¨å¹²æ´»ãä»æå·¥äººä»¬æ¥ä¸æ¥çâå°è´¦âå å¨ä¸èµ·ï¼ç®åºâæ»è´¦âã</p>
</li>
<li>
<p><strong>Gather:</strong> Leader è¿ç¨æè¿ 3 ä¸ªé¨åç»ææ¶ä¸æ¥ã</p>
</li>
<li>
<p><strong>Finalize Aggregate (æç»èå):</strong> Leader ææ¶ä¸æ¥ç 3 ä¸ªæ°å­å å¨ä¸èµ·ï¼å¾å°æç»ç 1 äº¿ï¼è¿åç»ç¨æ·ã</p>
</li>
</ol>
<hr>
<h3 id="4-å¹¶è¡ç®å­çåä¸è°ä¼">4. å¹¶è¡ç®å­çâåâä¸è°ä¼</h3>
<p>è½ç¶å¹¶è¡å¾å¿«ï¼ä½å®ä¸æ¯é¶å¼¹ï¼ä½¿ç¨æ¶éæ³¨æï¼</p>
<ol>
<li><strong>å¯å¨ææ¬ï¼</strong> å¯å¨ Worker è¿ç¨æ¯æå¼éçãå¦ææ¥è¯¢æ¬èº«åªé 10msï¼å¼å¯å¹¶è¡å¯è½åèè¦è± 20msãPostgreSQL ä¼éè¿ <code>min_parallel_table_scan_size</code> åæ°èªå¨å¤æ­è¡¨å¤ä¸å¤å¤§ï¼å°è¡¨ä¸ä¼èµ°å¹¶è¡ã</li>
<li><strong>åå­åå¢é£é© (work_mem):</strong>
<ul>
<li><strong>åè®°ï¼</strong> <code>work_mem</code> æ¯éå¶<strong>æ¯ä¸ªè¿ç¨</strong>çåå­ã</li>
<li>å¦æä½ è®¾ç½® <code>work_mem = 1GB</code>ï¼å¹¶å¯å¨äº 4 ä¸ª Workerãé£ä¹è¿ä¸ªæ¥è¯¢çè®ºä¸æé«å¯è½æ¶è <code>(4 + 1) * 1GB = 5GB</code> åå­ãå®¹æå¯¼è´ OOMï¼åå­æº¢åºï¼ã</li>
</ul>
</li>
<li><strong>åæä½éå¶ï¼</strong> ç®åï¼å¹¶è¡æ¥è¯¢ä¸»è¦ç¨äº <code>SELECT</code>ãå¯¹äº <code>UPDATE</code> / <code>DELETE</code>ï¼åªæå¨ <code>RETURNING</code> å­å¥åçé¨åæèå­æ¥è¯¢ä¸­æè½å©ç¨å¹¶è¡ï¼ä¿®æ¹æ°æ®æ¬èº«çæä½éå¸¸æ¯åçº¿ç¨çã</li>
</ol>
<h3 id="æ»ç»-1">æ»ç»</h3>
<ul>
<li><strong>Gather</strong> = åå·¥å¤´ï¼æ±æ»ï¼ã</li>
<li><strong>Parallel Scan</strong> = å·¥äººï¼å¹²è¦åï¼ã</li>
<li><strong>æ ¸å¿ä¼å¿</strong> = OLAP ç±»æ¥è¯¢ï¼å¤§è¡¨æ«æãèåãå¤§è¿æ¥ï¼éåº¦æåæåã</li>
<li><strong>ä»£ä»·</strong> = CPU é£åï¼åå­æ¶èç¿»åã</li>
</ul>
<h1 id="é»å¡ç®å­åéé»å¡ç®å­">é»å¡ç®å­åéé»å¡ç®å­</h1>
<p>è¿æ¯ä¸ä¸ªéå¸¸å³é®çæ¦å¿µï¼å®ç´æ¥å³å®äºä½ ç SQL æ¥è¯¢æ¯<strong>âé©¬ä¸å°±æç»æè¹¦åºæ¥â</strong>ï¼è¿æ¯<strong>âç­äºåå¤©æ²¡ååºï¼ç¶ååå¦ä¸ä¸å¨åºæ¥äºâ</strong>ã</p>
<p>å¨æ°æ®åºæ§è¡è®¡åä¸­ï¼ç®å­æ ¹æ®å¤çæ°æ®çæ¹å¼ï¼åä¸º<strong>é»å¡ï¼Blockingï¼</strong>å<strong>éé»å¡ï¼Non-Blocking / Pipelinedï¼</strong>ä¸¤å¤§ç±»ã</p>
<p>æä»¬å¯ä»¥ç¨<strong>âèªæ¥æ°´ç®¡â</strong>å<strong>âèæ°´æ± â</strong>æ¥æ¯å»ã</p>
<hr>
<h2 id="1-éé»å¡ç®å­-non-blocking-operators--èªæ¥æ°´ç®¡">1. éé»å¡ç®å­ (Non-Blocking Operators) ââ èªæ¥æ°´ç®¡</h2>
<p><strong>ç¹ç¹ï¼</strong></p>
<ul>
<li><strong>å³æ¶æ§ï¼</strong> åªè¦ä»ä¸å±æ¿å°äº<strong>ä¸è¡</strong>æ°æ®ï¼å¤çå®é©¬ä¸å°±åç»ä¸å±ï¼æèè¿åç»ç¨æ·ï¼ã</li>
<li><strong>æµå¼å¤ç (Pipelined)ï¼</strong> æ°æ®åæ°´æµä¸æ ·ï¼æºæºä¸æ­å°ç©¿è¿ç®å­ã</li>
<li><strong>ä½å»¶è¿ï¼</strong> ç¨æ·è½å¾å¿«çå°ç¬¬ä¸æ¡ç»æï¼First Row Time æç­ï¼ã</li>
</ul>
<p><strong>å¸åç®å­ï¼</strong></p>
<ul>
<li><strong>Seq Scan / Index Scan:</strong> è¯»å°ä¸è¡ï¼å°±ç»ä¸è¡ã</li>
<li><strong>Nested Loop Join:</strong> åªè¦å¤è¡¨æ¾å°ä¸è¡ï¼å»åè¡¨å¹éå°äºï¼å°±ç«é©¬è¿åè¿ä¸è¡ç»æã</li>
<li><strong>Limit:</strong> æ¿å°ä¸è¡ç®ä¸è¡ï¼æ°å¤äºå°±å³é¨ã</li>
<li><strong>Append:</strong> (<code>UNION ALL</code>) è¯»å®è¿è¡¨è¯»é£è¡¨ï¼ä¸­é´ä¸åé¡¿ã</li>
</ul>
<p><strong>åºæ¯ä¸¾ä¾ï¼</strong></p>
<pre><code class="language-sql">SELECT * FROM users WHERE age &gt; 20 LIMIT 10;
</code></pre>
<p>æ°æ®åºæ«å°ç¬¬ä¸æ¡ <code>age &gt; 20</code> çäººï¼ä½ é©¬ä¸å°±è½å¨å±å¹ä¸çå°ãä¸éè¦ç­å¨è¡¨æ«å®ã</p>
<hr>
<h2 id="2-é»å¡ç®å­-blocking-operators--èæ°´æ± ">2. é»å¡ç®å­ (Blocking Operators) ââ èæ°´æ± </h2>
<p><strong>ç¹ç¹ï¼</strong></p>
<ul>
<li><strong>å¨éç­å¾ï¼</strong> å¿é¡»æä¸å±ä¼ ä¸æ¥ç<strong>æææ°æ®</strong>é½è¯»å®ãå­ä¸æ¥ï¼éå¸¸å¨åå­æç£çï¼ï¼å¤çå®æ¯åï¼æè½ååº<strong>ç¬¬ä¸è¡</strong>ç»æã</li>
<li><strong>ç©å (Materialization)ï¼</strong> æ°æ®å¨è¿ä¸ªç®å­è¿éâåæ»âäºï¼è¢«å ç§¯æäºä¸´æ¶ç»æéã</li>
<li><strong>é«å»¶è¿ï¼</strong> å¨å¤çå®æåä¸è¡æ°æ®ä¹åï¼ç¨æ·ä»ä¹é½çä¸å°ã</li>
</ul>
<p><strong>å¸åç®å­ï¼</strong></p>
<ul>
<li><strong>Sort (æåº):</strong> è¿æ¯æå¸åçé»å¡ç®å­ãä½ æ³è¾åºâæè´µâçååï¼å¿é¡»æ<strong>ææ</strong>ååé½çä¸éå¹¶æå¥½åºï¼æè½ç¥éè°æ¯ç¬¬ä¸åã</li>
<li><strong>Aggregate (èå):</strong> æ¯å¦ <code>COUNT</code>, <code>SUM</code>, <code>AVG</code>ãä½ å¿é¡»æ°å®ææè±å­ï¼æè½åè¯ææ»å±æå¤å°é¢ã</li>
<li><strong>Hash Join (Build Phase):</strong> åå¸è¿æ¥çç¬¬ä¸æ­¥æ¯æå»ºåå¸è¡¨ãå®å¿é¡»æä¸å¼ è¡¨å®å¨è¯»å¥åå­æå»ºå¥½ Hash Mapï¼æè½å¼å§æ¢æµç¬¬äºå¼ è¡¨ã</li>
<li><strong>Unique / DISTINCT:</strong> ä¸ºäºå»éï¼éå¸¸éè¦ææ°æ®å¨çä¸éï¼é¤éåºäºæåºç´¢å¼ï¼ã</li>
</ul>
<p><strong>åºæ¯ä¸¾ä¾ï¼</strong></p>
<pre><code class="language-sql">SELECT * FROM users ORDER BY age;
</code></pre>
<p>åªæä½ åªçå 10 è¡ï¼æ°æ®åºä¹å¾æ 100 ä¸è¡ç¨æ·å¨è¯»åºæ¥ï¼æå¥½åºï¼æè½ç»ä½ æå¹´è½»çé£ 10 ä¸ªã</p>
<hr>
<h2 id="3-åé»å¡ç®å­-hash-join-çç¹æ®æ§">3. åé»å¡ç®å­ (Hash Join çç¹æ®æ§)</h2>
<p><strong>Hash Join</strong> æ¯ä¸ªæè¶£çæ··åä½ï¼</p>
<ol>
<li><strong>é¶æ®µä¸ï¼é»å¡ï¼ï¼</strong> æå»ºåå¸è¡¨ï¼Build Hash Tableï¼ã
<ul>
<li>æ°æ®åºè¯»å<strong>å³è¡¨ï¼åè¡¨ï¼</strong>çæææ°æ®ãæ­¤æ¶ï¼æ¥è¯¢å¤äºâå¡é¡¿âç¶æï¼æ²¡æä»»ä½è¾åºã</li>
</ul>
</li>
<li><strong>é¶æ®µäºï¼éé»å¡ï¼ï¼</strong> æ¢æµï¼Probeï¼ã
<ul>
<li>åå¸è¡¨å»ºå¥½åï¼æ°æ®åºå¼å§æ«æ<strong>å·¦è¡¨ï¼å¤è¡¨ï¼</strong>ãæ¯è¯»ä¸è¡å·¦è¡¨ï¼å»åå¸è¡¨éæ¥ä¸ä¸ãæ¥å°äºï¼<strong>ç«å»è¾åº</strong>ã</li>
</ul>
</li>
</ol>
<p>æä»¥ï¼Hash Join çå¯å¨éåº¦åå³äºå³è¡¨çå¤§å°ãè¿ä¹è§£éäºä¸ºä»ä¹ä¼åå¨æ»æ¯åæ¬¢ç¨<strong>å°è¡¨</strong>æ¥å Hash Join çæå»ºè¡¨ã</p>
<hr>
<h2 id="4-ä¸ºä»ä¹è¦åºåè¿ä¸ª">4. ä¸ºä»ä¹è¦åºåè¿ä¸ªï¼</h2>
<p>çè§£é»å¡ä¸éé»å¡ï¼å¯¹æ§è½ä¼åæä¸¤å¤§æå¯¼æä¹ï¼</p>
<h3 id="a-ååºæ¶é´-vs-æ»æ¶é´-response-time-vs-total-time">A. ååºæ¶é´ vs. æ»æ¶é´ (Response Time vs. Total Time)</h3>
<ul>
<li><strong>OLTP ç³»ç»ï¼Web åºç¨ï¼ï¼</strong> ç¨æ·å¸æç¹å¼é¡µé¢ç«é©¬çå°åå®¹ã
<ul>
<li><strong>ç®æ ï¼</strong> å°½éä½¿ç¨<strong>éé»å¡ç®å­</strong>ã</li>
<li><strong>ç­ç¥ï¼</strong> å©ç¨ç´¢å¼æ¶é¤ <code>Sort</code>ï¼å©ç¨ Nested Loop ä»£æ¿ Hash Joinï¼å¨æ°æ®éå°æ¶ï¼ã</li>
</ul>
</li>
<li><strong>OLAP ç³»ç»ï¼æ¥è¡¨åæï¼ï¼</strong> ç¨æ·å¯ä»¥ç­ 10 ç§ï¼ä½å¿é¡»è·å®å äº¿è¡æ°æ®ã
<ul>
<li><strong>ç®æ ï¼</strong> ååéä¼åã</li>
<li><strong>ç­ç¥ï¼</strong> <strong>é»å¡ç®å­</strong>ï¼å¦ Hash Join, Sort Merge Joinï¼éå¸¸å¨å¤çå¤§æ°æ®éæ¶æçæ´é«ã</li>
</ul>
</li>
</ul>
<h3 id="b-åå­æ¶è-work_mem">B. åå­æ¶è (<code>work_mem</code>)</h3>
<ul>
<li><strong>éé»å¡ç®å­</strong>éå¸¸ä¸æä¹ååå­ï¼å ä¸ºå®ä»¬åªå¤çå½åè¿ä¸è¡ã</li>
<li><strong>é»å¡ç®å­</strong>æ¯<strong>åå­ææ</strong>ã<code>Sort</code> éè¦åå­æåºï¼<code>Hash Agg</code> éè¦åå­å­åå¸è¡¨ãå¦æåå­ (<code>work_mem</code>) ä¸å¤ï¼å®ä»¬å°±ä¼ææ°æ®åå°<strong>ç£çä¸´æ¶æä»¶</strong>ï¼å¯¼è´æ§è½ä»âåå­çº§âè·è½å°âç£ççº§âï¼æ¢ 1000 åï¼ã</li>
</ul>
<h2 id="5-å¦ä½å¨-explain-ä¸­çåºæ¥">5. å¦ä½å¨ EXPLAIN ä¸­çåºæ¥ï¼</h2>
<p>ç <code>cost</code> çä¸¤ä¸ªæ°å­ï¼</p>
<pre><code>cost=å¯å¨ä»£ä»·..æ»ä»£ä»·
</code></pre>
<ul>
<li><strong>éé»å¡ç®å­ï¼</strong> å¯å¨ä»£ä»·ï¼ç¬¬ä¸ä¸ªæ°å­ï¼éå¸¸å¾å°ï¼æ¥è¿ <strong>0.00</strong>ã
<ul>
<li><code>Seq Scan (cost=0.00..145.00)</code> -&gt; é©¬ä¸å¼å§ã</li>
</ul>
</li>
<li><strong>é»å¡ç®å­ï¼</strong> å¯å¨ä»£ä»·éå¸¸<strong>å¾å¤§</strong>ï¼æ¥è¿æ»ä»£ä»·ã
<ul>
<li><code>Sort (cost=1000.00..1050.00)</code> -&gt; å 1000 çä»£ä»·é½å¨ç­å®æåºï¼æå®æå¼å§è¾åºã</li>
</ul>
</li>
</ul>
<h3 id="æ»ç»å¾è¡¨">æ»ç»å¾è¡¨</h3>
<table>
<thead>
<tr>
<th><strong>ç¹æ§</strong></th>
<th><strong>éé»å¡ç®å­ (Pipeline)</strong></th>
<th><strong>é»å¡ç®å­ (Blocking)</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ¯å»</strong></td>
<td>æ°´ç®¡æµè¿</td>
<td>èæ°´æ± èæ»¡</td>
</tr>
<tr>
<td><strong>é¦è¡è¾åº</strong></td>
<td>æå¿« (0ms çº§å«)</td>
<td>æ¢ (éå¤çå®æææ°æ®)</td>
</tr>
<tr>
<td><strong>åå­æ¶è</strong></td>
<td>ä½ (å¤çå®å³ä¸¢)</td>
<td>é« (éç¼å­æææ°æ®)</td>
</tr>
<tr>
<td><strong>å¸åä»£è¡¨</strong></td>
<td>Nested Loop, Seq/Index Scan</td>
<td>Sort, Hash Agg, Hash Join(æå»ºç«¯)</td>
</tr>
<tr>
<td><strong>ä¼åæ¹å</strong></td>
<td>éååé¡µãå¿«éååº</td>
<td>éåå¨éç»è®¡ãå¤§æ°æ®åå</td>
</tr>
</tbody>
</table>
<h1 id="æ§è¡è®¡ååæ">æ§è¡è®¡ååæ</h1>
<h2 id="ç¬¬ä¸ç»´åº¦explain">ç¬¬ä¸ç»´åº¦ï¼EXPLAIN</h2>
<p>å¨ä½¿ç¨ä¹åï¼ä½ å¿é¡»ç¥éä½ æéæ¿çæ¯åªä¸æâææ¯åâãä¸åçåæ°ç»åï¼çå°çæ·±åº¦å®å¨ä¸åã</p>
<ol>
<li><strong>Level 1: <code>EXPLAIN SELECT ...</code> (éææ¨æ¼)</strong>
<ul>
<li><strong>åçäºä»ä¹ï¼</strong> æ°æ®åº<strong>æ²¡æ</strong>æ§è¡ SQLãå®åªæ¯æ ¹æ®ç»è®¡ä¿¡æ¯ï¼Statisticsï¼âèè¡¥âäºä¸ä¸ªè®¡åã</li>
<li><strong>è½çä»ä¹ï¼</strong> ä¼åå¨æç®æä¹åãé¢ä¼°çææ¬ï¼Costï¼ãé¢ä¼°çè¡æ°ã</li>
<li><strong>ç¼ºç¹ï¼</strong> å®æ¯ççãå¦æç»è®¡ä¿¡æ¯è¿æï¼çå°çè®¡åå¯è½å®å¨æ¯éçã</li>
<li><strong>éç¨åºæ¯ï¼</strong> SQL è·å¾å¤ªæ¢ä¸æ¢è¿è¡ï¼æèæ¶å <code>DELETE</code>/<code>UPDATE</code> ä¸æ³å¼èæ°æ®ã</li>
</ul>
</li>
<li><strong>Level 2: <code>EXPLAIN (ANALYZE) SELECT ...</code> (å®æå¤ç)</strong>
<ul>
<li><strong>åçäºä»ä¹ï¼</strong> æ°æ®åº<strong>çç</strong>æ§è¡äº SQLï¼æ³¨æï¼å¦ææ¯ä¿®æ¹è¯­å¥ï¼æ°æ®ççä¼åï¼ï¼ã</li>
<li><strong>è½çä»ä¹ï¼</strong> é¤äºé¢ä¼°å¼ï¼è¿è½çå°<strong>å®éèæ¶ï¼Actual Timeï¼</strong>ã<strong>å®éè¡æ°ï¼Actual Rowsï¼</strong>ã<strong>å¾ªç¯æ¬¡æ°ï¼Loopsï¼</strong>ã</li>
<li><strong>æ ¸å¿ä»·å¼ï¼</strong> å¯¹æ¯âé¢ä¼°âåâå®éâçå·®å¼ï¼è¿æ¯è°ä¼çæ ¹åºã</li>
</ul>
</li>
<li><strong>Level 3: <code>EXPLAIN (ANALYZE, BUFFERS) SELECT ...</code> (IO éè§)</strong> ââ <strong>ææ¨èï¼</strong>
<ul>
<li><strong>åçäºä»ä¹ï¼</strong> å¨æ§è¡çåºç¡ä¸ï¼ç»è®¡äº<strong>åå­åç£ççäº¤äº</strong>ã</li>
<li><strong>è½çä»ä¹ï¼</strong> æ°æ®æ¯ä»åå­ï¼Shared Buffersï¼è¯»çï¼è¿æ¯ä»ç¡¬çï¼Diskï¼è¯»çã</li>
<li><strong>æ ¸å¿ä»·å¼ï¼</strong> æ°æ®åºæ¢ï¼90% æ¯å ä¸º IOãä¸ç Buffers å°±æ æ³ç²¾åå®ä½ IO ç¶é¢ã</li>
</ul>
</li>
<li><strong>Level 4: <code>EXPLAIN (ANALYZE, VERBOSE, SETTINGS) SELECT ...</code> (å¨æ¯è§å¾)</strong>
<ul>
<li><strong>VERBOSE:</strong> æ¾ç¤ºæ¯ä¸ªç®å­å·ä½è¾åºäºåªäºåï¼Output Listï¼ï¼æå©äºåææ¯å¦æ¥äºä¸è¯¥æ¥çå­æ®µã</li>
<li><strong>SETTINGS:</strong> æ¾ç¤ºåªäºéé»è®¤åæ°å½±åäºè¿æ¬¡è®¡åï¼æ¯å¦ä½ ä¸´æ¶æ <code>enable_seqscan</code> å³äºï¼ã</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ç¬¬äºç»´åº¦è§£ææ ç¶æ§è¡æµ">ç¬¬äºç»´åº¦ï¼è§£ææ ç¶æ§è¡æµ</h2>
<p>æ§è¡è®¡åæ¯ä¸ä¸ªåµå¥çæ ç¶ç»æãçè§£å®çéè¯»é¡ºåºè³å³éè¦ã</p>
<h4 id="1-éè¯»æ³åç±ååå¤èªä¸èä¸">1. éè¯»æ³åï¼ç±ååå¤ï¼èªä¸èä¸</h4>
<ul>
<li><strong>ç¼©è¿ææ·±</strong>çèç¹ï¼éå¸¸æ¯âå¶å­èç¹âï¼æåå¼å§å·¥ä½ï¼éå¸¸æ¯æ«æè¡¨ï¼ã</li>
<li><strong>ç¼©è¿ç¸å</strong>çèç¹ï¼éå¸¸æé¡ºåºæ§è¡ï¼å¯¹äº Hash Joinï¼ä¸é¢çåæ¯æ¯ Buildï¼ä¸é¢çåæ¯æ¯ Probeï¼ã</li>
<li><strong>ç¶èç¹</strong>ä¾èµå­èç¹çè¾åºã</li>
</ul>
<h4 id="2-ç®­å¤´---çå«ä¹">2. ç®­å¤´ <code>-&gt;</code> çå«ä¹</h4>
<p>å®ä»£è¡¨æ°æ®ç<strong>æµå¨æ¹å</strong>ãå­èç¹æå¤çå¥½çæ°æ®âåâç»ç¶èç¹ã</p>
<h4 id="3-ç¤ºä¾ç»æè§£æ">3. ç¤ºä¾ç»æè§£æ</h4>
<p>Plaintext</p>
<pre><code class="language-sql">-&gt;  Sort  (Level 1: æåæ§è¡ï¼ç­å¾ Hash Join çç»æ)
    -&gt;  Hash Join  (Level 2: å®æ¯ Sort çå­©å­ï¼ç­å¾ Hash å Seq Scan çç»æ)
          Hash Cond: (t1.id = t2.uid)
          -&gt;  Seq Scan on large_table t1  (Level 3: åä¸é¢ç Hash å¤äºåä¸çº§)
          -&gt;  Hash  (Level 3: å®æ¯ Hash Join çåè¡¨æå»ºè¿ç¨)
                -&gt;  Seq Scan on small_table t2 (Level 4: æåæ§è¡ï¼æ«æå°è¡¨)
</code></pre>
<p><strong>çå®æ§è¡é»è¾ï¼</strong></p>
<ol>
<li>åæ«æ <code>small_table t2</code>ã</li>
<li>å° t2 çæ°æ®æå»ºæä¸ä¸ªåå­åå¸è¡¨ï¼Hash èç¹ï¼ã</li>
<li>æ«æ <code>large_table t1</code>ã</li>
<li>æ¯æ«æä¸è¡ t1ï¼å°±å»åå¸è¡¨éæ¯å¯¹ï¼Hash Joinï¼ã</li>
<li>æ¯å¯¹æåçç»æï¼äº¤ç» <code>Sort</code> èç¹æåºã</li>
<li>æåºå®è¿åç»ç¨æ·ã</li>
</ol>
<hr>
<h2 id="ç¬¬ä¸ç»´åº¦æ ¸å¿åæ°æ·±åº¦è§£ç ">ç¬¬ä¸ç»´åº¦ï¼æ ¸å¿åæ°æ·±åº¦è§£ç </h2>
<p>æä»¬æ¥çä¸è¡å¸åçè¾åºï¼æå®åæç¸å¼¹ä¸æ ·æè§£å¼ï¼</p>
<pre><code class="language-sql">-&gt;  Seq Scan on orders  (cost=0.00..188.00 rows=1000 width=45) (actual time=0.006..2.500 rows=1200 loops=1)
</code></pre>
<h4 id="a-é¢ä¼°é¨å-æ¬å·ç¬¬ä¸é¨å">A. é¢ä¼°é¨å (æ¬å·ç¬¬ä¸é¨å)</h4>
<ol>
<li><strong><code>cost=0.00..188.00</code> (ä»£ä»·)</strong>
<ul>
<li><strong>åä½ï¼</strong> è¿æ¯ä¸ä¸ªæ½è±¡å¼ï¼æ²¡æåä½ï¼éå¸¸ 1.0 ä»£è¡¨è¯»åä¸ä¸ªç£çé¡µçä»£ä»·ï¼ã</li>
<li><strong>0.00 (Startup Cost - å¯å¨ä»£ä»·)ï¼</strong> æ¿å°<strong>ç¬¬ä¸è¡</strong>æ°æ®åéè¦å¤é¿æ¶é´ã
<ul>
<li><code>Seq Scan</code> æ¯ 0ï¼å ä¸ºæä»¬è¦çç¬¬ä¸è¡å°±å¨ç¬¬ä¸é¡µã</li>
<li><code>Sort</code> èç¹è¿éä¼å¾å¤§ï¼å ä¸ºå®å¿é¡»ææææ°æ®æå®åºæè½ååºç¬¬ä¸è¡ã</li>
</ul>
</li>
<li><strong>188.00 (Total Cost - æ»ä»£ä»·)ï¼</strong> æ¿å°<strong>ææ</strong>æ°æ®éè¦çæ»ä»£ä»·ãä¼åå¨ï¼Plannerï¼å°±æ¯å­è¿ä¸ªæ°å­éè·¯ï¼å®ä¼é Total Cost æå°çé£æ¡è·¯ã</li>
</ul>
</li>
<li><strong><code>rows=1000</code> (é¢ä¼°è¡æ°)</strong>
<ul>
<li>ä¼åå¨æ ¹æ®ç»è®¡ä¿¡æ¯ï¼pg_statisticï¼çåºæ¥çã</li>
<li><strong>éè¦æ§ï¼</strong> å®æ¯å³å®èµ° Nested Loop è¿æ¯ Hash Join çå³é®ãå¦æè¿éçéäºï¼è®¡åå°±ä¼ééã</li>
</ul>
</li>
<li><strong><code>width=45</code> (è¡å®½åº¦)</strong>
<ul>
<li>å¹³åæ¯ä¸è¡æ°æ®å ç¨ 45 å­èã</li>
<li><strong>éè¦æ§ï¼</strong> <code>rows * width</code> = é¢ä¼°çæ»æ°æ®éãè¿å³å®äºéä¸éè¦ææ°æ®åå°ä¸´æ¶æä»¶ï¼Disk Spillï¼ï¼å ä¸ºåå­ï¼work_memï¼æ¯æéçã</li>
</ul>
</li>
</ol>
<h4 id="b-å®éæ§è¡é¨å-æ¬å·ç¬¬äºé¨åä»å¨-analyze-æ¨¡å¼ä¸åºç°">B. å®éæ§è¡é¨å (æ¬å·ç¬¬äºé¨åï¼ä»å¨ ANALYZE æ¨¡å¼ä¸åºç°)</h4>
<ol>
<li>
<p><strong><code>actual time=0.006..2.500</code> (å®éæ¶é´)</strong></p>
<ul>
<li><strong>åä½ï¼</strong> æ¯«ç§ (ms)ã</li>
<li><strong>0.006 (Start Time)ï¼</strong> æ¿å°ç¬¬ä¸è¡è±äº 0.006msã</li>
<li><strong>2.500 (Total Time)ï¼</strong> <strong>å¹³åæ¯æ¬¡å¾ªç¯</strong>æ¿å°æææ°æ®è±äº 2.5msã</li>
<li><strong>åç¹ï¼</strong> å¦æ <code>loops &gt; 1</code>ï¼çå®æ»æ¶é´ = <code>Total Time * loops</code>ã</li>
</ul>
</li>
<li>
<p><strong><code>rows=1200</code> (å®éè¡æ°)</strong></p>
<ul>
<li>çå®è¿åäºå¤å°è¡ã</li>
</ul>
</li>
<li>
<p><strong><code>loops=1</code> (å¾ªç¯æ¬¡æ°)</strong></p>
<ul>
<li>
<p>è¿ä¸ªç®å­è¢«æ§è¡äºå æ¬¡ã</p>
</li>
<li>
<p><strong>Nested Loop ä¸­çå¤§åï¼</strong></p>
<pre><code class="language-sql">-&gt;  Index Scan on child_table ... (actual time=0.005..0.010 rows=1 loops=10000)
</code></pre>
<p>ä¹ä¸çåªè±äº 0.01msï¼<strong>éï¼</strong> çå®çèæ¶æ¯ <code>0.010 * 10000 = 100ms</code>ã<strong>ä¸å®è¦ä¹ Loopsï¼</strong></p>
</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ç¬¬åç»´åº¦buffers--io-çç§å¯">ç¬¬åç»´åº¦ï¼Buffers ââ IO çç§å¯</h2>
<p>å ä¸ <code>BUFFERS</code> éé¡¹åï¼ä½ ä¼çå°ç±»ä¼¼è¿æ ·çè¾åºï¼</p>
<pre><code>Buffers: shared hit=5 read=10 dirtied=2 written=1
</code></pre>
<p>è¿æ¯å¤æ­æ§è½ç¶é¢çéæ åï¼</p>
<ol>
<li><strong>Shared Hit (åå­å½ä¸­):</strong>
<ul>
<li>æ°æ®ç´æ¥ä» PostgreSQL çå±äº«åå­ï¼Shared Buffersï¼éæ¿å°äºã</li>
<li><strong>è¯ä»·ï¼</strong> å¾å¥½ï¼æå¿«ãæä»¬å¸æ Hit è¶é«è¶å¥½ã</li>
</ul>
</li>
<li><strong>Read (ç£çè¯»å):</strong>
<ul>
<li>åå­éæ²¡æï¼å¿é¡»åæä½ç³»ç»ç³è¯·ä»ç£çè¯»ã</li>
<li><strong>è¯ä»·ï¼</strong> æ¢ãå¦æ Read å¾é«ï¼è¯´æåå­ä¸å¤ç¨ï¼æèç´¢å¼æ²¡å»ºå¥½å¯¼è´æ«æäºå¤ªå¤å·æ°æ®ã</li>
</ul>
</li>
<li><strong>Dirtied (èé¡µ):</strong>
<ul>
<li>æ¥è¯¢è¿ç¨ä¸­ï¼åç°æ°æ®é¡µè¢«ä¿®æ¹äºï¼éå¸¸æ¯æªæäº¤çäºå¡ï¼ï¼éè¦æ è®°ä¸ºèé¡µã</li>
<li><strong>è¯ä»·ï¼</strong> å¨ <code>SELECT</code> æ¥è¯¢ä¸­ä¸åºè¯¥å¤§éåºç°ã</li>
</ul>
</li>
<li><strong>Temp Read / Written (ä¸´æ¶æä»¶è¯»å):</strong>
<ul>
<li><strong>è¯ä»·ï¼</strong> <strong>ç¾é¾çº§</strong>ã</li>
<li>è¯´æ <code>work_mem</code> å¤ªå°ï¼æåºï¼Sortï¼æåå¸è¡¨ï¼Hashï¼å¨åå­è£ä¸ä¸ï¼è¢«è¿«ææ°æ®åå°ç¡¬çä¸åè¯»åæ¥ãè¿ä¼è®©æ¥è¯¢æ¢å ä¸ªæ°éçº§ã</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ç¬¬äºç»´åº¦è­¦ç¤ºä¿¡å·--çå°è¿äºè¦æ¥è­¦">ç¬¬äºç»´åº¦ï¼è­¦ç¤ºä¿¡å· ââ çå°è¿äºè¦æ¥è­¦</h2>
<p>å¨å®¡è§é¿ç¯å¤§è®ºçè®¡åæ¶ï¼è¯·å¸¦ä¸âæ¾è¬âçç¼éï¼å¯»æ¾ä»¥ä¸çº¢çº¿ï¼</p>
<h4 id="1-ä¼°ç®ä¸å®éçå·¨å¤§åå·®-estimation-skew">1. ä¼°ç®ä¸å®éçå·¨å¤§åå·® (Estimation Skew)</h4>
<ul>
<li><strong>ç°è±¡ï¼</strong> <code>rows=1</code>ï¼ä½ <code>actual rows=1000000</code>ã</li>
<li><strong>åæï¼</strong> ä¼åå¨ä»¥ä¸ºæ°æ®å¾å°ï¼éäº Nested Loopï¼ç»æè¢«æµ·éæ°æ®æåäººã</li>
<li><strong>å¯¹ç­ï¼</strong> <code>ANALYZE table_name;</code> æ´æ°ç»è®¡ä¿¡æ¯ã</li>
</ul>
<h4 id="2-é«-filter-ç§»é¤ç-high-filter-ratio">2. é« Filter ç§»é¤ç (High Filter Ratio)</h4>
<ul>
<li><strong>ç°è±¡ï¼</strong> <code>Rows Removed by Filter: 99999</code> (Seq Scan è¿åäº 10 ä¸è¡ï¼è¿æ»¤ä¸¢æäº 9 ä¸ 9 åè¡)ã</li>
<li><strong>å«ä¹ï¼</strong> æ°æ®åºåäºå¤§éæ ç¨åãå®åä¸ªç¬¨æçå¾ä¹¦ç®¡çåï¼ææ´æ¶ä¹¦æ¬ä¸æ¥ï¼ä¸æ¬æ¬çï¼æååªç»ä½ ä¸æ¬ã</li>
<li><strong>å¯¹ç­ï¼</strong> éå¯¹ Filter çæ¡ä»¶å»ºç«ç´¢å¼ã</li>
</ul>
<h4 id="3-ä¸´æ¶æä»¶æº¢åº-disk-spill">3. ä¸´æ¶æä»¶æº¢åº (Disk Spill)</h4>
<ul>
<li><strong>ç°è±¡ï¼</strong> <code>Disk: 10240kB</code> (åºç°å¨ Sort æ Hash èç¹)ã</li>
<li><strong>å¯¹ç­ï¼</strong> è°å¤§ <code>work_mem</code> åæ°ï¼æèä¼å SQL åå°æåº/èåçæ°æ®éã</li>
</ul>
<h4 id="4-éè¯¯çè¿æ¥æ¹å¼">4. éè¯¯çè¿æ¥æ¹å¼</h4>
<ul>
<li><strong>ç°è±¡ï¼</strong> ä¸¤ä¸ªå¤§è¡¨è¿æ¥ï¼æ¯å¦å 100 ä¸è¡ï¼ï¼å´ç¨äº <code>Nested Loop</code>ã</li>
<li><strong>åå ï¼</strong> éå¸¸æ¯å ä¸ºä¸è¿°çâä¼°ç®åå·®âå¯¼è´çã</li>
</ul>
<hr>
<h2 id="ç¬¬å­ç»´åº¦å®æéè¡æè§£æ¡ä¾">ç¬¬å­ç»´åº¦ï¼å®æéè¡æè§£æ¡ä¾</h2>
<p>è®©æä»¬æ¥çä¸ä¸ªåå«âåâççå®å¤ææ¡ä¾ã</p>
<pre><code class="language-sql">SELECT * FROM users u
JOIN orders o ON u.id = o.user_id
WHERE u.age &gt; 20 AND o.status = 'paid'
ORDER BY o.create_time LIMIT 10;
</code></pre>
<p><strong>Execution Plan:</strong></p>
<pre><code class="language-sql">Limit  (cost=100.50..100.60 rows=10) (actual time=55.000..55.010 rows=10 loops=1)
  -&gt;  Sort  (cost=100.50..105.00 rows=500) (actual time=55.000..55.005 rows=10 loops=1)
        Sort Key: o.create_time
        Sort Method: external merge  Disk: 800kB  &lt;-- è­¦æ¥ 1
        -&gt;  Hash Join  (cost=20.00..80.00 rows=500) (actual time=10.000..45.000 rows=10000 loops=1)
              Hash Cond: (o.user_id = u.id)
              -&gt;  Seq Scan on orders o  (cost=0.00..50.00 rows=2000) (actual time=0.005..15.000 rows=50000 loops=1) &lt;-- è­¦æ¥ 2
                    Filter: (status = 'paid')
                    Rows Removed by Filter: 100000  &lt;-- è­¦æ¥ 3
              -&gt;  Hash  (cost=15.00..15.00 rows=100) (actual time=5.000..5.000 rows=100 loops=1)
                    Buckets: 1024  Batches: 1  Memory Usage: 9kB
                    -&gt;  Seq Scan on users u  (cost=0.00..15.00 rows=100) (actual time=0.004..3.000 rows=100 loops=1)
                          Filter: (age &gt; 20)
</code></pre>
<p><strong>éè¡ä¾¦æ¢åæï¼</strong></p>
<ol>
<li><strong>çæä¸é¢ (users):</strong> <code>Seq Scan on users</code>ãæ«äº users è¡¨ï¼è¿æ»¤ <code>age &gt; 20</code>ï¼å© 100 è¡ãéåº¦æºå¿« (3ms)ï¼æ²¡å¤§æ¯çã</li>
<li><strong>çä¸­é´ (Hash):</strong> æè¿ 100 ä¸ª user æ¾å¥åå­åå¸è¡¨ãåå­åªç¨äº 9kBï¼å¾å¥åº·ã</li>
<li><strong>çä¸é¢ (orders) - [è­¦æ¥ 2 &amp; 3]:</strong>
<ul>
<li><code>Seq Scan on orders</code>ã</li>
<li><code>Filter: status='paid'</code>ã</li>
<li><code>Rows Removed by Filter: 100000</code>ã</li>
<li><strong>è§£è¯»ï¼</strong> ä¸ºäºæ¾ 'paid' çè®¢åï¼å¨è¡¨æ«æå¹¶ææäº 10 ä¸è¡åºæ°æ®ï¼</li>
<li><strong>ä¼åï¼</strong> åºè¯¥å¨ <code>orders(status)</code> ä¸å ç´¢å¼ã</li>
</ul>
</li>
<li><strong>ç Join (Hash Join):</strong>
<ul>
<li><code>actual rows=10000</code>ãJoin å®æ 1 ä¸è¡æ°æ®ã</li>
</ul>
</li>
<li><strong>çæåº (Sort) - [è­¦æ¥ 1]:</strong>
<ul>
<li><code>Sort Method: external merge Disk: 800kB</code>ã</li>
<li><strong>è§£è¯»ï¼</strong> è¿éç 1 ä¸è¡æ°æ®è¦æåºï¼ä½æ¯åå­ä¸å¤ç¨äºï¼æ°æ®æº¢åºå°äºç£çï¼Diskï¼ãè¿ä¸¥éææ¢äºéåº¦ã</li>
<li><strong>ä¼åï¼</strong> è°å¤§ <code>work_mem</code>ï¼æèç» <code>orders(user_id, status, create_time)</code> å å¤åç´¢å¼ï¼å¯è½ç´æ¥æ¶é¤æåºã</li>
</ul>
</li>
<li><strong>çé¡¶å± (Limit):</strong> åäºå 10 æ¡ã</li>
</ol>
<h2 id="æ»ç»-2">æ»ç»</h2>
<p>çæ§è¡è®¡åï¼æ¬è´¨ä¸æ¯å¨åç­ä¸ä¸ªé®é¢ï¼</p>
<ol>
<li><strong>æ°æ®æä¹æ¾çï¼</strong> (Scan: æ¯å»å»çæ«å¨è¡¨ï¼è¿æ¯èªæçæ¥ç´¢å¼ï¼)</li>
<li><strong>æ°æ®æä¹è¿çï¼</strong> (Join: æ¯åå±å¾ªç¯ï¼è¿æ¯åå¸å¹éï¼)</li>
<li><strong>èµæºå¤ä¸å¤ï¼</strong> (Buffer/Disk: åå­å½ä¸­çé«åï¼ææ²¡ææº¢åºå°ç£çï¼)</li>
</ol>
<p>åªè¦æä½äº <code>Actual Time</code>ï¼çå®èæ¶ï¼ã<code>Rows Removed</code>ï¼è¿æ»¤æµªè´¹ï¼å <code>Disk/Buffers</code>ï¼èµæºç¶é¢ï¼ï¼ä½ å°±ææ¡äºæ§è½ä¼åçé¥åã</p>
<h1 id="æ¥è¯¢ä¼åå¨">æ¥è¯¢ä¼åå¨</h1>
<p>ç®åæ¥è¯´ï¼æ°æ®åºåå³å®çè¿ç¨ï¼å°±åæ¯ä½ å¨ç¨å°å¾è½¯ä»¶å¯¼èªã</p>
<ul>
<li><strong>èµ·ç¹</strong>æ¯æ°æ®ç°å¨çç¶æã</li>
<li><strong>ç»ç¹</strong>æ¯ä½ æ³è¦çæ¥è¯¢ç»æã</li>
<li><strong>è·¯å¾</strong>å°±æ¯åç§âæ§è¡è®¡åâã</li>
<li><strong>ä¼åå¨</strong>å°±æ¯é£ä¸ªç®æ³ï¼å®éè¦å¨æåä¸ä¸æ¡å¯è½çè·¯çº¿ä¸­ï¼ç®åºä¸æ¡<strong>âä»£ä»·ï¼Costï¼æä½â</strong>çè·¯ã</li>
</ul>
<p>è¿ä¸ªè¿ç¨è¢«ç§°ä¸º <strong>CBO (Cost-Based Optimizationï¼åºäºä»£ä»·çä¼å)</strong>ãä»¥ä¸æ¯å®åå³å®çå®æ´é»è¾é¾æ¡ï¼</p>
<hr>
<h2 id="ç¬¬ä¸é¶æ®µé¢å¤çä¸é»è¾ä¼å-query-rewriting">ç¬¬ä¸é¶æ®µï¼é¢å¤çä¸é»è¾ä¼å (Query Rewriting)</h2>
<p>å¨è®¡ç®ä»£ä»·ä¹åï¼ä¼åå¨ä¼åå¯¹ä½ ç SQL åâæ´å½¢ææ¯âï¼æå®æ¹åæé»è¾ä¸ç­ä»·ä½æ´å®¹æä¼åçå½¢å¼ãè¿å«<strong>é»è¾ä¼å</strong>ã</p>
<ul>
<li><strong>å»é¤å¤ä½æ¡ä»¶ï¼</strong> æ¯å¦ <code>WHERE 1=1</code> ä¼è¢«å æã</li>
<li><strong>å¸¸éæå ï¼</strong> <code>WHERE id = 1 + 2</code> ä¼åæ <code>WHERE id = 3</code>ã</li>
<li><strong>è§å¾åå¹¶ (View Merging)ï¼</strong> å¦ææ¥è¯¢éç¨äºè§å¾ï¼ä¼åå¨ä¼è¯å¾æè§å¾æå¼ï¼æéé¢çè¡¨ç´æ¥æ¿åºæ¥åå¤é¢çè¡¨è¿æ¥ï¼æ©å¤§éæ©ç©ºé´ã</li>
<li><strong>å­æ¥è¯¢æå¹³å (Subquery Unnesting)ï¼</strong> å°½éæå­æ¥è¯¢æ¹åæ JOINï¼å ä¸ºæ°æ®åºå¤ç JOIN çç®æ³æ¯å¤çå­æ¥è¯¢ä¸°å¯å¾å¤ã</li>
</ul>
<hr>
<h2 id="ç¬¬äºé¶æ®µæä¸¾åéè®¡å-plan-enumeration">ç¬¬äºé¶æ®µï¼æä¸¾åéè®¡å (Plan Enumeration)</h2>
<p>è¿æ¯æèæ¶çæ­¥éª¤ãä¼åå¨ä¼ååé­æ¯ä¸æ ·ï¼æåç»ååºåç§å¯è½çæ§è¡è·¯å¾ã</p>
<p>å¦æä¸å éå¶ï¼ä¸ä¸ªæ¶å 5 å¼ è¡¨çæ¥è¯¢ï¼å¯è½çè¿æ¥é¡ºåºå°±æ 5! = 120 ç§ï¼åä¹ä»¥æ¯ä¸¤å¼ è¡¨å¯è½æ 3 ç§è¿æ¥æ¹å¼ï¼Hash/Nested/Mergeï¼ï¼åä¹ä»¥æ¯å¼ è¡¨å¯è½æ 2-3 ç§æ«ææ¹å¼ï¼Seq/Index/Bitmapï¼â¦â¦<strong>æç´¢ç©ºé´æ¯ææ°çº§çç¸ç</strong>ã</p>
<p>ä¼åå¨ä¸»è¦èèä¸ä¸ªç»´åº¦çç»åï¼</p>
<ol>
<li><strong>è®¿é®è·¯å¾ (Access Path)ï¼</strong>
<ul>
<li>è¡¨ Aï¼æ¯ç¨å¨è¡¨æ«æï¼è¿æ¯ç¨ç´¢å¼ Xï¼è¿æ¯ç¨ç´¢å¼ Yï¼</li>
</ul>
</li>
<li><strong>è¿æ¥é¡ºåº (Join Order)ï¼</strong>
<ul>
<li>æ¯å A Join Bï¼ç»æå Join Cï¼</li>
<li>è¿æ¯å B Join Cï¼ç»æå Join Aï¼</li>
</ul>
</li>
<li><strong>è¿æ¥ç®æ³ (Join Method)ï¼</strong>
<ul>
<li>æ¯ç¨ Nested Loopï¼è¿æ¯ Hash Joinï¼è¿æ¯ Merge Joinï¼</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ç¬¬ä¸é¶æ®µä»£ä»·ä¼°ç®-cost-estimation--æ ¸å¿ä¸­çæ ¸å¿">ç¬¬ä¸é¶æ®µï¼ä»£ä»·ä¼°ç® (Cost Estimation) ââ æ ¸å¿ä¸­çæ ¸å¿</h2>
<p>é¢å¯¹çæçä¸å åéè®¡åï¼ä¼åå¨æä¹ç¥éåªä¸ªå¥½ï¼å®éè¦ç»æ¯ä¸ªè®¡åç®ä¸ä¸ªåï¼Costï¼ã</p>
<p><strong>å¬å¼å¤§è´å¦ä¸ï¼ç®åçï¼ï¼</strong></p>
<p>Cost = (IOä»£ä»· \times IOæé) + (CPUä»£ä»· \times CPUæé)</p>
<p>ä¸ºäºç®åºè¿ä¸ªå¬å¼ï¼ä¼åå¨å¿é¡»ä¾èµ<strong>ç»è®¡ä¿¡æ¯ (Statistics)</strong>ãå¦æç»è®¡ä¿¡æ¯ä¸åï¼ä¼åå¨å°±ä¼åæâç²äººâã</p>
<h4 id="1-ç»è®¡ä¿¡æ¯-the-fuel">1. ç»è®¡ä¿¡æ¯ (The Fuel)</h4>
<p>æ°æ®åºä¼å®æï¼éè¿ <code>ANALYZE</code> å½ä»¤ï¼æ¶éæ¯å¼ è¡¨çææ¥ï¼å­æ¾å¨ç³»ç»è¡¨éï¼å¦ PG ç <code>pg_statistic</code>ï¼ï¼</p>
<ul>
<li><strong>è¡æ° (Tuples):</strong> è¡¨éå¤§æ¦æå¤å°è¡ï¼</li>
<li><strong>é¡µé¢æ° (Pages):</strong> è¡¨å äºå¤å°ç£çåï¼</li>
<li><strong>å¯ä¸å¼ä¸ªæ° (n_distinct):</strong> æä¸åæå¤å°ä¸ªä¸åçå¼ï¼ï¼å³å®äºè¿æ»¤æ§ï¼</li>
<li><strong>é«é¢å¼ (MCV - Most Common Values):</strong> åªå ä¸ªå¼åºç°å¾æå¤ï¼ï¼æ¯å¦âç¶æâå­æ®µï¼90% é½æ¯ 'success'ï¼</li>
<li><strong>ç´æ¹å¾ (Histogram):</strong> æ°æ®çåå¸æåµæ¯ææ ·çï¼ï¼ç¨äºèå´æ¥è¯¢ä¼°ç®ï¼</li>
</ul>
<h4 id="2-æ¨ç®è¿ç¨-the-calculation">2. æ¨ç®è¿ç¨ (The Calculation)</h4>
<p>ä¼åå¨å©ç¨ç»è®¡ä¿¡æ¯è¿è¡<strong>åºæ°ä¼°ç® (Cardinality Estimation)</strong>ï¼ä¹å°±æ¯çæ¯ä¸åæ­¥éª¤ä¼è¿åå¤å°è¡ã</p>
<ul>
<li><strong>ä¾å­ï¼</strong> <code>SELECT * FROM users WHERE age &gt; 20 AND city = 'Beijing'</code>
<ul>
<li>ç»è®¡ä¿¡æ¯è¯´ï¼<code>age &gt; 20</code> çå¤§æ¦å  50%ï¼<code>city = 'Beijing'</code> çå¤§æ¦å  10%ã</li>
<li>ä¼åå¨åè®¾ä¸¤åä¸ç¸å³ï¼ä¼°ç®åºç¬¦åæ¡ä»¶çè¡æ° = æ»è¡æ° $\times$ 50% $\times$ 10%ã</li>
<li>å¦æç®åºæ¥åªæ 10 è¡ï¼å®å¯è½é <strong>Index Scan</strong>ã</li>
<li>å¦æç®åºæ¥æ 100 ä¸è¡ï¼å®å¯è½é <strong>Seq Scan</strong>ã</li>
</ul>
</li>
</ul>
<hr>
<h2 id="ç¬¬åé¶æ®µæç´¢ç®æ³-search-algorithms">ç¬¬åé¶æ®µï¼æç´¢ç®æ³ (Search Algorithms)</h2>
<p>å ä¸ºåéè®¡åå¤ªå¤äºï¼ä¸å¯è½ççææ¯ä¸ä¸ªé½ç®ä¸éï¼é£åæ¯çæè®¡åå°±è¦å åéï¼ãæ°æ®åºä½¿ç¨é«æçç®æ³æ¥âåªæâåæç´¢ã</p>
<h4 id="1-å¨æè§å-dynamic-programming--system-r-é£æ ¼">1. å¨æè§å (Dynamic Programming) ââ System R é£æ ¼</h4>
<p>è¿æ¯å¤§å¤æ°æ°æ®åºï¼åæ¬ PostgreSQL å Oracleï¼å¤çä¸­å°åæ¥è¯¢ï¼éå¸¸ &lt; 12 å¼ è¡¨ï¼çæ åç®æ³ã</p>
<ul>
<li><strong>æè·¯ï¼</strong> èªåºåä¸ã
<ul>
<li>åç®åºè®¿é®åè¡¨ AãBãC çæä¼è·¯å¾ã</li>
<li>ååºäºæ­¤ï¼ç®åº {A, B} è¿æ¥çæä¼è·¯å¾ï¼å {B, C} è¿æ¥çæä¼è·¯å¾ã</li>
<li>åç®åº {A, B, C} çæä¼è·¯å¾ã</li>
</ul>
</li>
<li><strong>ä¼å¿ï¼</strong> è½ä¿è¯æ¾å°<strong>å¨å±æä¼è§£</strong>ã</li>
</ul>
<h4 id="2-éä¼ ç®æ³-genetic-algorithm--geqo">2. éä¼ ç®æ³ (Genetic Algorithm / GEQO)</h4>
<p>å½è¡¨éå¸¸å¤ï¼æ¯å¦ PostgreSQL é»è®¤è¶è¿ 12 å¼ è¡¨ JOINï¼æ¶ï¼å¨æè§åå¤ªæ¢äºãä¼åå¨ä¼åæ¢å°éä¼ ç®æ³ã</p>
<ul>
<li><strong>æè·¯ï¼</strong> éæºçæå ä¸ªè®¡åï¼ç§ç¾¤ï¼ï¼è®©å®ä»¬âåå¼âåâæäº¤âï¼äº¤æ¢è¿æ¥é¡ºåºï¼ï¼ä¿ç Cost ä½çï¼æ·æ±°é«çï¼è¿­ä»£å è½®åï¼éä¸ä¸ªâè¶³å¤å¥½âçï¼ä½ä¸ä¸å®æ¯æä¼çï¼ã</li>
<li><strong>ä¼å¿ï¼</strong> éåº¦å¿«ï¼é¿åä¼åè¿ç¨æ¬èº«ææ°æ®åºææ­»ã</li>
</ul>
<hr>
<h2 id="ç¬¬äºé¶æ®µæç»å³ç­-plan-selection">ç¬¬äºé¶æ®µï¼æç»å³ç­ (Plan Selection)</h2>
<p>ç»è¿ä¸è¿°æ­¥éª¤ï¼ä¼åå¨æéæçå ä¸ªç»è¿ç­éçâå³èµåâè®¡åãå®ä¼ç®åç²æ´å°æ¯è¾å®ä»¬ç <strong>Total Cost</strong>ï¼</p>
<ul>
<li>è®¡å A (Hash Join): Cost = 500</li>
<li>è®¡å B (Nested Loop): Cost = 2000</li>
<li>è®¡å C (Merge Join): Cost = 480</li>
</ul>
<p><strong>å³å®ï¼</strong> éç¨è®¡å Cã</p>
<hr>
<h2 id="æ»ç»ä¸ºä»ä¹ä¼åå¨ææ¶åä¼ç¯å»">æ»ç»ï¼ä¸ºä»ä¹ä¼åå¨ææ¶åä¼âç¯å»âï¼</h2>
<p>äºè§£äºåçï¼ä½ å°±ç¥éä¸ºä»ä¹æ°æ®åºææ¶åä¼ééè®¡åï¼æ¯å¦éäºå¨è¡¨æ«æèä¸èµ°ç´¢å¼ï¼ï¼</p>
<ol>
<li><strong>ç»è®¡ä¿¡æ¯è¿æï¼</strong> æ°æ®åäºï¼ä½æ²¡è¿è¡ <code>ANALYZE</code>ï¼ä¼åå¨ä»¥ä¸ºè¡¨æ¯ç©ºçï¼ç»æè¡¨éæ 1 äº¿è¡ãå®ä¼éè¯¯å°éæ© Nested Loopï¼å¯¼è´ç³»ç»å¡æ­»ã</li>
<li><strong>æ°æ®ç¸å³æ§ (Correlation)ï¼</strong> ä¼åå¨é»è®¤åè®¾åä¸åä¹é´æ¯ç¬ç«çã
<ul>
<li>æ¯å¦æ¥è¯¢âçä»½=æ¹å AND åå¸=æ­¦æ±âã</li>
<li>ä¼åå¨è§å¾è¿ä¸¤ä¸ªæ¦çè¦ç¸ä¹ï¼0.03 * 0.01 = 0.0003ï¼ï¼è®¤ä¸ºç»ææå°ã</li>
<li>å®éä¸è¿ä¸¤ä¸ªæ¡ä»¶æ¯å¼ºç¸å³çï¼ç»æå¾å¤ãä¼°ç®éè¯¯å¯¼è´ééç´¢å¼ã</li>
</ul>
</li>
<li><strong>ä»£ä»·æ¨¡ååå·®ï¼</strong> ä¼ ç»ç Cost æ¨¡åä¸»è¦ç IOãç°å¨ç SSD å¾å¿«ï¼ææ¶åéæºè¯»ï¼Index Scanï¼æ¯é¡ºåºè¯»ï¼Seq Scanï¼å¿«ï¼ä½æ§çä»£ä»·åæ°å¯è½è¿è§å¾æºæ¢°ç¡¬ççéæºè¯»å¾æ¢ï¼ä»èä¸æ¢ç¨ç´¢å¼ã</li>
</ol>
<h2 id="ä¸å¾èåè¨">ä¸å¾èåè¨</h2>
<p>å¯ä»¥å°æ´ä¸ªè¿ç¨æ³è±¡æä¸ä¸ªæ¼æï¼</p>
<ol>
<li><strong>SQL ææ¬</strong> (è¾å¥)</li>
<li><strong>Parser</strong> (è¯­æ³æ )</li>
<li><strong>Rewriter</strong> (é»è¾ä¼ååçæ )</li>
<li><strong>Planner</strong> (çæ 1000 ä¸ªè·¯å¾ -&gt; ä¼°ç® Cost -&gt; å¨æè§ååªæ -&gt; å© 1 ä¸ªè·¯å¾)</li>
<li><strong>Executor</strong> (æ§è¡éå®çé£ä¸ªè®¡å)</li>
</ol>
<h1 id="hash-joinçbucketsåbatches">Hash JoinçBucketsåBatches</h1>
<p>å¨ PostgreSQL ç <code>EXPLAIN (ANALYZE)</code> è¾åºä¸­ï¼<code>Buckets</code> å <code>Batches</code> æ¯ Hash Joinï¼åå¸è¿æ¥ï¼ç®å­ä¸ä¸¤ä¸ªè³å³éè¦çåæ°ãå®ä»¬ç´æ¥æ­ç¤ºäºä½ çæ¥è¯¢æ¯<strong>âå¨åå­éé£â</strong>ï¼è¿æ¯<strong>âå¨ç¡¬çéç¬â</strong>ã</p>
<p>ç®åæ»ç»ï¼</p>
<ul>
<li><strong>Buckets (æ¡¶):</strong> æ¯åå¸è¡¨ç<strong>âæ¿é´æ°â</strong>ãå®å³å®äº CPU æ¥æ¾çæçï¼è§£å³åå¸å²çªï¼ã</li>
<li><strong>Batches (æ¹æ¬¡):</strong> æ¯åå¸è¡¨ç<strong>âåèº«æ°â</strong>ãå®å³å®äºåå­å¤ä¸å¤ç¨ï¼è§£å³åå­æº¢åºï¼ã<strong>è¿æ¯æ§è½ææã</strong></li>
</ul>
<hr>
<h2 id="1-buckets-æ¡¶--åå­éçé¨çå·">1. Buckets (æ¡¶) ââ åå­éçâé¨çå·â</h2>
<p>Hash Join çç¬¬ä¸æ­¥æ¯æå»ºåå¸è¡¨ï¼Build Phaseï¼ãæ°æ®åºä¼ç³è¯·ä¸ååå­ï¼æè¿ååå­ååä¸º N ä¸ªæ§½ä½ï¼æ¯ä¸ªæ§½ä½å°±æ¯ä¸ä¸ª <strong>Bucket</strong>ã</p>
<ul>
<li>
<p><strong>å·¥ä½åçï¼</strong></p>
<ol>
<li>æ°æ®åºè¯»ååè¡¨ï¼Build Tableï¼çä¸è¡æ°æ®ã</li>
<li>å¯¹è¿æ¥é®ï¼Join Keyï¼ç®åºä¸ä¸ªåå¸å¼ã</li>
<li>ç¨ <code>åå¸å¼ % Bucketæ»æ°</code> ç®åºè¿è¡æ°æ®è¯¥è¿åªä¸ªæ¡¶ã</li>
<li>ææ°æ®æå¨è¿ä¸ªæ¡¶çé¾è¡¨åé¢ã</li>
</ol>
</li>
<li>
<p><strong>çæ³æåµï¼</strong></p>
<p>æ¯ä¸ªæ¡¶éåªæ 1 è¡æ°æ®ãè¿æ ·æ¢æµï¼Probeï¼çæ¶åï¼ç®ä¸æ¬¡åå¸å°±è½ç´æ¥å®ä½å°æ°æ®ï¼å¤æåº¦æ¯ O(1)ã</p>
</li>
<li>
<p><strong>ç³ç³æåµï¼åå¸å²çªï¼ï¼</strong></p>
<p>å¦æ Buckets å¤ªå°ï¼æèåå¸å½æ°ä¸å¥½ï¼å¯¼è´å åè¡æ°æ®é½æ¤å¨ä¸ä¸ªæ¡¶éï¼å²çªï¼ãé£å¨è¿ä¸ªæ¡¶åé¨æ¥æ¾å°±åæäºçº¿æ§æ«æï¼CPU æ¶èå§å¢ã</p>
</li>
<li>
<p><strong>EXPLAIN ä¸­çè¡¨ç°ï¼</strong></p>
<p>PostgreSQL éå¸¸ä¼èªå¨è°æ´ Buckets çæ°éä»¥ä¿æè¾é«çæçï¼éå¸¸æ¯ 2 çå¹æ¬¡æ¹ï¼ã</p>
<blockquote>
<p><code>Buckets: 1024  Memory Usage: 50kB</code></p>
</blockquote>
<blockquote>
<ul>
<li>è¿è¯´æç³è¯·äº 1024 ä¸ªæ§½ä½ï¼åå­ç¨äº 50kBãè¿éå¸¸ä¸æ¯ç¶é¢ã</li>
</ul>
</blockquote>
</li>
</ul>
<hr>
<h2 id="2-batches-æ¹æ¬¡--åå­ä¸å¤æ¶çåèº«æ¯">2. Batches (æ¹æ¬¡) ââ åå­ä¸å¤æ¶çâåèº«æ¯â</h2>
<p>è¿æ¯æéè¦è­¦æçææ ã</p>
<p>Hash Join å¿é¡»ææ´ä¸ªåå¸è¡¨å»ºå¨åå­éãä½æ¯ï¼å¦æä½ ç <code>work_mem</code>ï¼å·¥ä½åå­ï¼åªæ 4MBï¼èåè¡¨æ 100MBï¼æä¹åï¼åå­è£ä¸ä¸ï¼</p>
<p>è¿æ¶åï¼PostgreSQL å°±ä¼å¯å¨ <strong>Batchingï¼åæ¹ï¼æºå¶</strong>ï¼ä¹å°±æ¯<strong>æå¤§è±¡ååè£è¿å°ç®±</strong>ã</p>
<ul>
<li><strong>å·¥ä½åçï¼åæ²»æ³ï¼ï¼</strong>
<ol>
<li><strong>ååï¼</strong> æ°æ®åºæ ¹æ®åå¸å¼ï¼å°åè¡¨ï¼Build Tableï¼åå¤è¡¨ï¼Probe Tableï¼ååæ N ä¸ª <strong>Batches</strong>ã</li>
<li><strong>é©»çä¸è½çï¼</strong>
<ul>
<li><strong>Batch 0</strong>ï¼çå¨åå­éï¼ç«å»å¼å§åè¿æ¥ã</li>
<li><strong>Batch 1 ~ N</strong>ï¼åå­æ¾ä¸ä¸äºï¼<strong>åå°ç£çä¸´æ¶æä»¶ï¼Temp Filesï¼é</strong>ã</li>
</ul>
</li>
<li><strong>è½®è¯¢ï¼</strong> ç­ Batch 0 å¤çå®ï¼æ¸ç©ºåå­ï¼æ Batch 1 ä»ç£çè¯»ååå­ï¼æå»ºåå¸è¡¨ï¼åå¤çâ¦â¦ç´å°ææ Batch å¤çå®ã</li>
</ol>
</li>
<li><strong>Batches = 1 (å®ç¾ç¶æ)ï¼</strong>
<ul>
<li>è¯´ææææ°æ®é½è½è£è¿åå­ (<code>work_mem</code>)ã</li>
<li>æ²¡æç£ç I/Oï¼éåº¦æå¿«ã</li>
<li><strong>EXPLAIN:</strong> <code>Batches: 1  Memory Usage: ...</code></li>
</ul>
</li>
<li><strong>Batches &gt; 1 (æº¢åºç¶æ)ï¼</strong>
<ul>
<li>è¯´æåå­ä¸å¤ï¼è§¦åäºç£çè¯»åã</li>
<li><strong>EXPLAIN:</strong> <code>Batches: 4  Disk: 2500kB</code>ã</li>
<li>è¿æå³çä½ çæ¥è¯¢æ­£å¨ç»åâåç -&gt; è¯»çâçæç£¨ï¼æ§è½ä¼ä¸éå ä¸ªæ°éçº§ã</li>
</ul>
</li>
</ul>
<hr>
<h2 id="3-å®ææ¡ä¾å¦ä½éè¿è¿ä¸¤ä¸ªåæ°è°ä¼">3. å®ææ¡ä¾ï¼å¦ä½éè¿è¿ä¸¤ä¸ªåæ°è°ä¼ï¼</h2>
<p>è®©æä»¬çä¸ä¸ªåçâåå­æº¢åºâç Hash Join æ§è¡è®¡åï¼</p>
<p>Plaintext</p>
<pre><code class="language-sql">-&gt;  Hash Join  (cost=...) (actual time=...)
      Hash Cond: (outer.id = inner.id)
      -&gt;  Seq Scan on outer_table ...
      -&gt;  Hash  (cost=...) (actual time=...)
            Buckets: 65536  Batches: 8  Memory Usage: 4096kB  &lt;-- å³é®ç¹å¨è¿éï¼
            Disk: 12000kB                                     &lt;-- è¯æ®ç¡®å¿
            -&gt;  Seq Scan on inner_table ...
</code></pre>
<h4 id="åæ">åæï¼</h4>
<ol>
<li><strong>Buckets: 65536</strong>
<ul>
<li>æ¡¶å¾å¤ï¼è¯´ææ°æ®éä¸å°ï¼PostgreSQL è¯å¾åæ£åå¸å²çªã</li>
</ul>
</li>
<li><strong>Batches: 8</strong>
<ul>
<li><strong>æ¥è­¦ï¼</strong> è¿æå³çæ°æ®è¢«åæäº 8 ä»½ã</li>
<li>ç¬¬ 1 ä»½å¨åå­å¤çäºï¼å©ä¸ 7 ä»½è¢«åå°äºç£çä¸ã</li>
</ul>
</li>
<li><strong>Disk: 12000kB</strong>
<ul>
<li>ä¸ºäºåè¿ä¸ª Joinï¼æ°æ®åºä¸´æ¶åäº 12MB çæ°æ®å°ç¡¬çã</li>
</ul>
</li>
<li><strong>Memory Usage: 4096kB</strong>
<ul>
<li>å½åç <code>work_mem</code> è®¾ç½®éå¶äºå®åªè½ç¨ 4MB åå­ãå ä¸ºè£ä¸ä¸ 16MBï¼12MB+4MBï¼çæ°æ®ï¼æä»¥è¢«è¿«åæ¹ã</li>
</ul>
</li>
</ol>
<h4 id="ä¼åæ¹æ¡">ä¼åæ¹æ¡ï¼</h4>
<p>ä¸ºäºè®© <code>Batches</code> åå 1ï¼æä»¬éè¦å¢å  <code>work_mem</code>ã</p>
<pre><code class="language-sql">-- ä¸´æ¶è°å¤§å½åä¼è¯çåå­éå¶ï¼æ¯å¦è°å° 32MBï¼
SET work_mem = '32MB';

-- åæ¬¡è¿è¡ EXPLAIN ANALYZE
EXPLAIN ANALYZE SELECT ...
</code></pre>
<p><strong>ä¼ååçå¯è½ç»æï¼</strong></p>
<p>Plaintext</p>
<pre><code class="language-sql">-&gt;  Hash  (cost=...) (actual time=...)
      Buckets: 65536  Batches: 1  Memory Usage: 16100kB  &lt;-- èæäº
      Disk: 0kB                                          &lt;-- ç£ç I/O æ¶å¤±
</code></pre>
<ul>
<li><strong>Batches: 1</strong>: æææ°æ®é½å¨åå­éã</li>
<li><strong>Memory Usage: 16100kB</strong>: å®éä¸åªç¨äº 16MB åå­ï¼å®å¨å¨æä»¬çé¢ç®ï¼32MBï¼ä¹åã</li>
<li><strong>æ§è½æå</strong>: æ¥è¯¢éåº¦éå¸¸ä¼æå 2-10 åã</li>
</ul>
<hr>
<h2 id="4-æ·±åº¦æºå¶dynamic-growing-å¨æå¢é¿">4. æ·±åº¦æºå¶ï¼Dynamic Growing (å¨æå¢é¿)</h2>
<p>ææ¶åä½ ä¼çå°è¿æ ·çè¾åºï¼</p>
<pre><code class="language-sql">Buckets: 1024  Batches: 1 (originally 1)  Memory Usage: ...
</code></pre>
<p>æèï¼</p>
<pre><code class="language-sql">Buckets: 1024  Batches: 2 (originally 1)  Memory Usage: ...
</code></pre>
<p><strong>è¿æ¯ä»ä¹ææï¼</strong></p>
<p>PostgreSQL çä¼åå¨å¨å¼å§æ§è¡åï¼åªæ¯<strong>ä¼°ç®</strong>éè¦å¤å° Buckets å Batchesã</p>
<ul>
<li>å¦ææ§è¡è¿ç¨ä¸­åç°ï¼âååï¼ä¼°ç®å°äºï¼åå­å¿«çäºï¼â</li>
<li>å®ä¼<strong>å¨æå¢å  Batches</strong>ï¼Doubling strategyï¼éå¸¸ç¿»åï¼ã</li>
<li>å®ä¼å°å½ååå¸è¡¨éçæ°æ®âåè£âï¼æä¸åçæ°æ®èµ¶åºåå­ï¼åå°ç£ççæ° Batch éï¼ï¼ä»èè¾åºç©ºé´ã</li>
</ul>
<p><strong>è¿è¯´æï¼</strong> ä½ çç»è®¡ä¿¡æ¯ï¼Statisticsï¼å¯è½ä¸¥éè¿æäºï¼å¯¼è´ä¼åå¨ä½ä¼°äºè¡æ°ã</p>
<p><strong>å¯¹ç­ï¼</strong> è¿è¡ <code>ANALYZE table_name;</code>ã</p>
<h2 id="æ»ç»-3">æ»ç»</h2>
<table>
<thead>
<tr>
<th><strong>åæ°</strong></th>
<th><strong>å«ä¹</strong></th>
<th><strong>çæ³å¼</strong></th>
<th><strong>å¼å¸¸å¼</strong></th>
<th><strong>å½±å</strong></th>
<th><strong>è§£å³æ¹æ¡</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Buckets</strong></td>
<td>åå¸è¡¨æ§½ä½æ°</td>
<td>2^N (å¦ 1024)</td>
<td>æ ç¹å®å¼å¸¸</td>
<td>å½±å CPU (åå¸å²çª)</td>
<td>éå¸¸æ éæå¨å¹²é¢</td>
</tr>
<tr>
<td><strong>Batches</strong></td>
<td>åæ¹å¤çæ°</td>
<td><strong>1</strong></td>
<td><strong>&gt; 1</strong></td>
<td><strong>ä¸¥éå½±å IO</strong> (åç£ç)</td>
<td><strong>è°å¤§ <code>work_mem</code></strong></td>
</tr>
</tbody>
</table>
<p>çå° <code>Batches &gt; 1</code>ï¼å°±æ¯çå°æ°æ®åºå¨åä½ æ±æï¼âç»æç¹åå­å§ï¼â</p>
<h1 id="hash-join-hash-å²çª">Hash Join Hash å²çª</h1>
<p>å¨æ°æ®åºç Hash Join ä¸­ï¼<strong>Hash å²çªï¼Hash Collisionï¼</strong> æ¯ä¸å¯é¿åçç©çç°è±¡ã</p>
<p>ç®ååé¡¾ä¸ä¸å®ä¹ï¼<strong>ä¸åç Join Keyï¼æ¯å¦ ID=10 å ID=100ï¼ï¼ç»è¿åå¸å½æ°è®¡ç®åï¼å¾å°äºå®å¨ç¸åçåå¸å¼ï¼æ¯å¦é½ç­äº 5ï¼ï¼äºæ¯å®ä»¬é½è¦æ¤è¿åä¸ä¸ª Bucketï¼æ¡¶ï¼éã</strong></p>
<p>æ°æ®åºï¼ä»¥ PostgreSQL ä¸ºä¾ï¼è§£å³è¿ä¸ªé®é¢çæ åæ¹æ¡æ¯ï¼<strong>æé¾æ³ï¼Separate Chainingï¼</strong> + <strong>å¼æ¯è¾ï¼Recheckï¼</strong>ã</p>
<h2 id="1-æ ¸å¿æºå¶æé¾æ³-separate-chaining">1. æ ¸å¿æºå¶ï¼æé¾æ³ (Separate Chaining)</h2>
<p>æ³è±¡ä¸ä¸ï¼Hash Table æ¯ä¸ä¸ªå·¨å¤§ç<strong>âå¿«éæâ</strong>ï¼æ¯ä¸ªæ ¼å­å°±æ¯ä¸ä¸ª <strong>Bucket</strong>ã</p>
<p>å¦æä¸¤ä¸ªåè£¹ï¼æ°æ®è¡ï¼çåä»¶ç ï¼Hash å¼ï¼ç®åºæ¥é½æ¯â5å·æâï¼æä¹åï¼</p>
<p>æ°æ®åºä¸ä¼æåæ¥çåè£¹ææï¼ä¹ä¸ä¼è¦çåé¢çï¼èæ¯<strong>å¨ 5 å·æåé¢æä¸æ¡é¿é¿çé¾å­ï¼Linked Listï¼</strong>ã</p>
<ul>
<li><strong>Bucket çç»æï¼</strong> å®ä¸åæ¯ä¸ä¸ªåªè½å­ä¸è¡æ°æ®çâæ­»æ ¼å­âï¼èæ¯ä¸ä¸ª<strong>é¾è¡¨å¤´æé</strong>ã</li>
<li><strong>å²çªå¤çï¼</strong>
<ul>
<li>ç¬¬ä¸ä¸ªå²çªçè¡ï¼æå¨ Bucket åé¢ã</li>
<li>ç¬¬äºä¸ªå²çªçè¡ï¼æå¨ç¬¬ä¸ä¸ªè¡åé¢ã</li>
<li>ä»¥æ­¤ç±»æ¨â¦â¦</li>
</ul>
</li>
</ul>
<pre><code>Bucket 0: [ NULL ]
Bucket 1: [ Row A (id=10) ] -&gt; [ Row B (id=100) ] -&gt; [ Row C (id=999) ] -&gt; NULL
Bucket 2: [ Row D (id=5) ] -&gt; NULL
...
</code></pre>
<p>å¨ä¸é¢çä¾å­ä¸­ï¼Row AãRow BãRow C ç ID ä¸åï¼ä½åå¸å¼é½æå°äº Bucket 1ãè¿å°±æ¯åå¸å²çªã</p>
<hr>
<h2 id="2-æ¢æµé¶æ®µå¿é¡»è¿è¡éªèº«-recheck">2. æ¢æµé¶æ®µï¼å¿é¡»è¿è¡âéªèº«â (Recheck)</h2>
<p>è§£å³äºâå­âçé®é¢ï¼å³é®å¨äºâåâï¼Probe é¶æ®µï¼ã</p>
<p>å½å¤è¡¨ï¼Outer Tableï¼çä¸è¡æ°æ®æ¥å¹éæ¶ï¼æ°æ®åºå¦ä½åºåé¾è¡¨éç AãBãC è°ææ¯çæ­£çâäº²äººâï¼</p>
<p><strong>æ­¥éª¤å¦ä¸ï¼</strong></p>
<ol>
<li><strong>ç®åå¸ï¼</strong> æ¿å¤è¡¨æ°æ®ç Join Keyï¼æ¯å¦ ID=100ï¼ï¼ç®åºåå¸å¼ -&gt; <code>Bucket 1</code>ã</li>
<li><strong>æ¾æ¡¶ï¼</strong> CPU å®ä½å°åå­ä¸­ç Bucket 1ã</li>
<li><strong>éåé¾è¡¨ï¼å³é®æ­¥éª¤ï¼ï¼</strong>
<ul>
<li><strong>çç¬¬ä¸ä¸ªèç¹ (Row A)ï¼</strong> å®çåå¸å¼å¹éï¼ä½æ°æ®åº<strong>ä¸æ¢ç¡®ä¿¡</strong>ãå¿é¡»æ¿åºåå§å¼æ¯å¯¹ï¼<code>Outer.ID (100) == Inner.ID (10)</code> åï¼<strong>ä¸ç¸ç­</strong>ãè·³è¿ã</li>
<li><strong>çç¬¬äºä¸ªèç¹ (Row B)ï¼</strong> æ¿åºåå§å¼æ¯å¯¹ï¼<code>Outer.ID (100) == Inner.ID (100)</code> åï¼<strong>ç¸ç­ï¼</strong> å¹éæåï¼è¿åç»æã</li>
<li><strong>çç¬¬ä¸ä¸ªèç¹ (Row C)ï¼</strong> ...</li>
</ul>
</li>
</ol>
<p><strong>ç»è®ºï¼</strong> Hash Join å¨å¹éæ¶ï¼<strong>ä¸ä»ä»æ¯è¾åå¸å¼ï¼è¿å¿é¡»å¨åå­ä¸­æ¯è¾åå§ç Join Key</strong>ã</p>
<hr>
<h2 id="3-æ§è½å½±åå²çªæ¯-cpu-ææ">3. æ§è½å½±åï¼å²çªæ¯ CPU ææ</h2>
<p>çè§£äºä¸è¿°è¿ç¨ï¼ä½ å°±æç½äºä¸ºä»ä¹åå¸å²çªæ¯æ§è½çæäººï¼</p>
<ul>
<li><strong>çæ³æåµ (æ å²çª)ï¼</strong> Bucket éåªæ 1 ä¸ªèç¹ã
<ul>
<li>å¤æåº¦ï¼<strong>O(1)</strong>ãç®ä¸æ¬¡åå¸ï¼æ¯å¯¹ä¸æ¬¡ï¼æå®ã</li>
</ul>
</li>
<li><strong>ç³ç³æåµ (ä¸¥éå²çª)ï¼</strong> Bucket åé¢æäº 1000 ä¸ªèç¹ã
<ul>
<li>å¤æåº¦ï¼<strong>O(N)</strong>ãç®ä¸æ¬¡åå¸ï¼ç¶åè¦è¿è¡ 1000 æ¬¡ CPU æ¯è¾æä½ï¼éåé¾è¡¨ï¼ã</li>
<li><strong>åæï¼</strong> è¿å®éä¸æé«æç Hash Join éåæäºä½æç <strong>Nested Loop</strong>ï¼å¨æ¡¶åé¨åå¾ªç¯ï¼ã</li>
</ul>
</li>
</ul>
<hr>
<h2 id="4-æç«¯æ¡ä¾æ°æ®å¾æ-data-skew">4. æç«¯æ¡ä¾ï¼æ°æ®å¾æ (Data Skew)</h2>
<p>ææ¶åï¼åå¸å²çªä¸æ¯å ä¸ºè¿æ°ä¸å¥½ï¼èæ¯å ä¸º<strong>æ°æ®æ¬èº«çé®é¢</strong>ã</p>
<p><strong>åºæ¯ï¼</strong></p>
<p>ä½ è¿æ¥çå­æ®µæ¯ <code>status</code>ï¼ç¶æï¼ï¼ä¸ 99% çæ°æ®é½æ¯ <code>'Success'</code>ï¼åªæ 1% æ¯ <code>'Failed'</code>ã</p>
<ul>
<li>Hash('Success') = Bucket 5</li>
<li>Hash('Failed') = Bucket 8</li>
</ul>
<p><strong>ç»æï¼</strong></p>
<ul>
<li>Bucket 5 åé¢æäºä¸ä¸ª<strong>é¿è¾¾å ç¾ä¸è¡</strong>çé¾è¡¨ï¼å ä¸º 99% çæ°æ®é½ä¸æ ·ï¼ã</li>
<li>Bucket 8 åªæå¯¥å¯¥å è¡ã</li>
<li>å¶ä» Bucket å¨æ¯ç©ºçã</li>
</ul>
<p><strong>è¿æ¯ Hash Join çå©æ¢¦ã</strong> å¨è¿ç§æåµä¸ï¼Hash Join çæ§è½ä¼æ¥å§ä¸éï¼çè³æ¯ Nested Loop è¿è¦æ¢ï¼å ä¸ºè¿å¤äºè§£æåå¸åç»´æ¤é¾è¡¨çå¼éï¼ã</p>
<p><strong>PostgreSQL çå¯¹ç­ï¼</strong></p>
<p>PostgreSQL çä¼åå¨ï¼Plannerï¼éå¸¸ä¼å©ç¨<strong>é«é¢å¼ç»è®¡ï¼MCV - Most Common Valuesï¼</strong>ãå¦æå®åç° Join Key åå¸æåº¦ä¸ååï¼å¾æä¸¥éï¼ï¼å®å¯è½ä¼ï¼</p>
<ol>
<li><strong>æ¾å¼ Hash Join</strong>ï¼æ¹ç¨ Merge Join æ Nested Loopã</li>
<li>æèå¨ Hash Join ä¹åï¼å¯¹é«é¢å¼åç¹æ®å¤çï¼ä½è¿æ¯è¾å¤æï¼ã</li>
</ol>
<hr>
<h2 id="5-æä¹é¿åå²çªæ°æ®åºå¨åä»ä¹">5. æä¹é¿åå²çªï¼(æ°æ®åºå¨åä»ä¹)</h2>
<p>è½ç¶æä»¬æ¹åä¸äºæ°æ®ï¼ä½æ°æ®åºåæ ¸å¨åªååå°âæå¤å²çªâï¼</p>
<ol>
<li><strong>ä¼ç§çåå¸ç®æ³ï¼</strong> PostgreSQL ä½¿ç¨ <code>Jenkins Hash</code> æ <code>MurmurHash</code> ç­ç®æ³ï¼ç¡®ä¿åå¸å¼åâæè¡æ¤é¢âä¸æ ·åååå¸ï¼é¿åä¸åçå¼ç®åºä¸æ ·çåå¸ã</li>
<li><strong>å¨ææ©å®¹ (Resizing)ï¼</strong> å¦æåç°æ°æ®éæ¯é¢æçå¤ï¼å¯¼è´ Bucket ä¸å¤ç¨äºï¼æ¯å¦æ¯ä¸ªæ¡¶é½æäº 5 ä¸ªèç¹ï¼ï¼æ°æ®åºå¯è½ä¼éæ°ç³è¯·æ´å¤§çåå­ï¼æ Bucket æ°éç¿»åï¼æ¯å¦ä» 1024 æ©å° 2048ï¼ï¼ç¶åææ°æ®éæ°æä¸éï¼Rehashï¼ã
<ul>
<li><em>æ³¨ï¼PostgreSQL ç Hash Join æ´å¤æ¯éè¿ Batchesï¼åæ¹ï¼æ¥è§£å³åå­ä¸è¶³ï¼éè¿é¢ä¼°è¶³å¤å¤§ç Buckets æ¥è§£å³å²çªã</em></li>
</ul>
</li>
</ol>
<h2 id="æ»ç»-4">æ»ç»</h2>
<p>Hash Join éå°å²çªæ¶ï¼</p>
<ol>
<li><strong>å­ï¼</strong> ç¨<strong>é¾è¡¨</strong>æå²çªçæ°æ®ä¸²èµ·æ¥ã</li>
<li><strong>åï¼</strong> éåé¾è¡¨ï¼éä¸ªè¿è¡<strong>åå§å¼æ¯è¾ (Recheck)</strong>ã</li>
<li><strong>ä»£ä»·ï¼</strong> å²çªè¶å¤ï¼é¾è¡¨è¶é¿ï¼CPU éåè¶æ¢ï¼æ§è½è¶å·®ã</li>
</ol>
<h1 id="parallelåpartial">ParallelåPartial</h1>
<p><strong>"Parallel"</strong>ï¼å¹¶è¡ï¼å <strong>"Partial"</strong>ï¼é¨åï¼ç»å¸¸æå¯¹åºç°ï¼ä½å®ä»¬æè¿°çæ¯å®å¨ä¸åçä¸¤ä¸ªç»´åº¦ï¼</p>
<ul>
<li><strong>Parallel (å¹¶è¡):</strong> æè¿°çæ¯<strong>âå¨ä½çæ¹å¼â</strong> ââ <strong>å¤§å®¶ä¸èµ·å¹²</strong>ã</li>
<li><strong>Partial (é¨å):</strong> æè¿°çæ¯<strong>âç»æçç¶æâ</strong> ââ <strong>å¹²äºä¸åï¼è¿æ²¡å®</strong>ã</li>
</ul>
<h2 id="1-parallelå¨ä½æä¹å¹²">1. "Parallel"ï¼å¨ä½ï¼æä¹å¹²ï¼ï¼</h2>
<p>å½ä½ å¨æ§è¡è®¡åä¸­çå° <strong>Parallel</strong>ï¼å¦ <code>Parallel Seq Scan</code>ï¼ï¼å®æå³ç<strong>âåèº«æ¯â</strong>ã</p>
<ul>
<li><strong>å«ä¹ï¼</strong> æ°æ®åºå¯å¨äºå¤ä¸ªå·¥äººï¼Worker Processesï¼ï¼å¤§å®¶<strong>åæ¶</strong>å»å¹²è¿ä¸ä»¶äºã</li>
<li><strong>åºæ¯ï¼</strong>
<ul>
<li><strong>Parallel Seq Scan:</strong> 3 ä¸ªå·¥äººï¼æ¯äººè´è´£æ« 1/3 çè¡¨ã</li>
<li><strong>Parallel Hash Join:</strong> 3 ä¸ªå·¥äººï¼æ¯äººè´è´£è¿æ¥ 1/3 çæ°æ®ã</li>
</ul>
</li>
<li><strong>å³é®ç¹ï¼</strong> å®çåä¹è¯æ¯ "Serial"ï¼ä¸²è¡ï¼åçº¿ç¨ï¼ã</li>
</ul>
<h2 id="2-partialç»æå¹²æå¥æ ·äº">2. "Partial"ï¼ç»æï¼å¹²æå¥æ ·äºï¼ï¼</h2>
<p>å½ä½ å¨æ§è¡è®¡åä¸­çå° <strong>Partial</strong>ï¼å¦ <code>Partial Aggregate</code>ï¼ï¼å®æå³ç<strong>âåæåâ</strong>ã</p>
<ul>
<li><strong>å«ä¹ï¼</strong> å ä¸ºæ°æ®æ¯å¤§å®¶åå¼å¤ççï¼æä»¥æ¯ä¸ªäººç®åºæ¥çç»æ<strong>åªæ¯å±é¨ç</strong>ï¼ä¸æ¯æç»ç­æ¡ã</li>
<li><strong>åºæ¯ï¼</strong>
<ul>
<li><strong>Partial Aggregate:</strong> å·¥äºº A ç®åºä»é£é¨åæ 100 ç¥¨ï¼å·¥äºº B ç®åºä»é£é¨åæ 200 ç¥¨ã</li>
<li><strong>æ³¨æï¼</strong> è¿æ¶åè°é½ä¸ç¥éæ»ç¥¨æ°æ¯å¤å°ã</li>
</ul>
</li>
<li><strong>å³é®ç¹ï¼</strong> å®çåä¹è¯æ¯ "Finalize"ï¼æç»æ±æ»ï¼ã</li>
</ul>
<hr>
<h2 id="3-ä¸ºä»ä¹ææ¶åæ-partialææ¶åæ²¡æ">3. ä¸ºä»ä¹ææ¶åæ Partialï¼ææ¶åæ²¡æï¼</h2>
<p>è¿åå³äºä½ ç SQL <strong>æ¯å¦éè¦âèåâï¼Aggregationï¼</strong>ã</p>
<h4 id="æåµ-aæ-parallelä¹æ-partial-èåæ¥è¯¢">æåµ Aï¼æ Parallelï¼ä¹æ Partial (èåæ¥è¯¢)</h4>
<p><strong>SQL:</strong> <code>SELECT count(*) FROM big_table;</code></p>
<p>ä½ æ³è¦ä¸ä¸ª<strong>æ±æ»çæ°å­</strong>ã</p>
<ol>
<li><strong>Parallel Seq Scan:</strong> å¤§å®¶åå¤´å»æ°ç¥¨ï¼å¨ä½æ¯å¹¶è¡çï¼ã</li>
<li><strong>Partial Aggregate:</strong> æ¯ä¸ªäººåææéçç¥¨æ°å ä¸å ï¼è®°å¨å°æ¬æ¬ä¸ï¼ç»ææ¯å±é¨çï¼ã
<ul>
<li><em>å¦æä¸åè¿ä¸æ­¥ï¼æ¯ä¸ªäººé½è¦æå ç¾ä¸å¼ éç¥¨æç»é¢å¯¼ï¼é¢å¯¼ä¼è¢«ç ¸æ­»ã</em></li>
</ul>
</li>
<li><strong>Gather:</strong> é¢å¯¼æå°æ¬æ¬æ¶ä¸æ¥ã</li>
<li><strong>Finalize Aggregate:</strong> é¢å¯¼æå°æ¬æ¬ä¸çæ°å­å å¨ä¸èµ·ï¼æç»ç»æï¼ã</li>
</ol>
<p><strong>æ§è¡è®¡åé¿è¿æ ·ï¼</strong></p>
<pre><code class="language-sql">Finalize Aggregate          &lt;-- 4. ç®åºæ»è´¦
  -&gt; Gather                 &lt;-- 3. æ¶å°æ¬æ¬
       -&gt; Partial Aggregate &lt;-- 2. è®°å°æ¬æ¬ (Partialåºç°äºï¼)
            -&gt; Parallel Seq Scan &lt;-- 1. åå¤´æ°ç¥¨ (Parallelåºç°äºï¼)
</code></pre>
<h4 id="æåµ-bæ-parallelä½æ²¡æ-partial-æç»æ¥è¯¢">æåµ Bï¼æ Parallelï¼ä½æ²¡æ Partial (æç»æ¥è¯¢)</h4>
<p><strong>SQL:</strong> <code>SELECT * FROM big_table WHERE id &gt; 1000;</code></p>
<p>ä½ åªæ³è¦<strong>åå§æ°æ®</strong>ï¼ä¸éè¦æ±æ»ã</p>
<ol>
<li><strong>Parallel Seq Scan:</strong> å¤§å®¶åå¤´å»æ¾ <code>id &gt; 1000</code> çè¡ã</li>
<li><strong>Gather:</strong> æ¾å°ä¸è¡ï¼å°±ç´æ¥æç»é¢å¯¼ã</li>
<li><strong>Result:</strong> é¢å¯¼ç´æ¥åç»ç¨æ·ã</li>
</ol>
<p><strong>æ§è¡è®¡åé¿è¿æ ·ï¼</strong></p>
<pre><code class="language-sql">Gather                      &lt;-- 2. æ¶åå§ç¥¨æ®
  -&gt; Parallel Seq Scan      &lt;-- 1. åå¤´æ¾ç¥¨ (åªæParallelï¼æ²¡æPartial)
</code></pre>
<p><strong>ä¸ºä»ä¹è¿éæ²¡æ Partialï¼</strong></p>
<p>å ä¸ºä¸éè¦è®¡ç® <code>SUM</code> æ <code>COUNT</code>ï¼ä¸éè¦âä¸­é´ç¶æâãå·¥äººæ¾å°çå°±æ¯æç»éè¦çè¡ã</p>
<hr>
<h2 id="4-æ·±åº¦å¯¹æ¯è¡¨">4. æ·±åº¦å¯¹æ¯è¡¨</h2>
<table>
<thead>
<tr>
<th><strong>å³é®è¯</strong></th>
<th><strong>è¯æ§</strong></th>
<th><strong>æ½å°è¯</strong></th>
<th><strong>å¸åç®å­</strong></th>
<th><strong>åºç°ä½ç½®</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Parallel</strong></td>
<td><strong>å¯è¯</strong> (Adverb)</td>
<td>"æä¸å­¤åï¼æåå¼å¸®æä¸èµ·å"</td>
<td><code>Parallel Seq Scan</code> <code>Parallel Index Scan</code> <code>Parallel Hash Join</code></td>
<td>æ ç<strong>åºå±</strong> (å¹²è¦åçå°æ¹)</td>
</tr>
<tr>
<td><strong>Partial</strong></td>
<td><strong>å½¢å®¹è¯</strong> (Adjective)</td>
<td>"è¿ä¸æ¯æç»ç­æ¡ï¼è¿è¦åå å·¥"</td>
<td><code>Partial Aggregate</code> <code>Partial HashAggregate</code></td>
<td>å¤¹å¨ Parallel å Gather <strong>ä¸­é´</strong> (ä¸ºäºåç¼©æ°æ®)</td>
</tr>
</tbody>
</table>
<h2 id="æ»ç»-5">æ»ç»</h2>
<ul>
<li>çå° <strong>Parallel</strong>ï¼è¯´æ<strong>âä¸ºäºå¿«ï¼äººå¤åéå¤§â</strong>ã</li>
<li>çå° <strong>Partial</strong>ï¼è¯´æ<strong>âä¸ºäºçï¼åå¨æ¬å°ç®ä¸ªå°è´¦â</strong>ã</li>
</ul>
<p><strong>Partial æ¯ Parallel å¨åèåè¿ç®æ¶çâå¿ç»ä¹è·¯âã</strong> å¦æä½ åªæ¯ç®åå°æ¬è¿æ°æ®ï¼SELECT *ï¼ï¼å°±ä¸éè¦ Partial è¿ä¸ªæ­¥éª¤ã</p>
<h1 id="æ°æ®åºç¼å­åæä½ç³»ç»ç¼å­çå³ç³»">æ°æ®åºç¼å­åæä½ç³»ç»ç¼å­çå³ç³»</h1>
<p>ç®åæ¥è¯´ï¼å®ä»¬æ¯<strong>ä¸¤å±é²å¾¡ä½ç³»</strong>ï¼æ¢æåä½ï¼ä¹æç«äºã</p>
<p>æä»¬å¯ä»¥ç¨ä¸ä¸ª<strong>âå¾ä¹¦é¦å¤ä¹ â</strong>çä¾å­æ¥ææ¯æ¹ï¼</p>
<ul>
<li><strong>ç¡¬ç (Disk):</strong> å¾ä¹¦é¦ç<strong>é­æ¶ä¹¦åº</strong>ãä¹¦å¾å¤ï¼ä½åä¹¦éå¸¸æ¢ï¼æ¯«ç§çº§ï¼ã</li>
<li><strong>æä½ç³»ç»ç¼å­ (OS Page Cache):</strong> å¾ä¹¦é¦ç<strong>è¿ä¹¦ææ¨è½¦</strong>ã
<ul>
<li>è½ç¶ä¹¦è¿æ²¡å½æ¶ï¼ä½å°±å¨æè¾¹ï¼æ¿èµ·æ¥å¾å¿«ã</li>
<li>è¿éä¹¦å¾æï¼ä»ä¹é½æï¼èä¸ç®¡çåï¼OSï¼ä¼å®ææè½¦æ¸ç©ºã</li>
</ul>
</li>
<li><strong>æ°æ®åºç¼å­ (DB Buffer Pool):</strong> ä½ èªå·±ç<strong>ä¹¦æ¡</strong>ã
<ul>
<li>è¿æ¯ä½ ç²¾å¿æéçãé©¬ä¸è¦ç¨çä¹¦ã</li>
<li>ä½ ç¥éåªä¸é¡µæéè¦ï¼ä½ ä¼ä¸ç´æå®ä»¬æå¼æ¾å¨æ¡ä¸ã</li>
</ul>
</li>
</ul>
<hr>
<h2 id="1-æ ¸å¿æ¶ææ°æ®çæµå¨è·¯å¾">1. æ ¸å¿æ¶æï¼æ°æ®çæµå¨è·¯å¾</h2>
<p>å½æ°æ®åºæ³è¦è¯»åä¸è¡æ°æ®æ¶ï¼å¹¶ä¸æ¯ç´æ¥ä»ç¡¬çåå°æ°æ®åºéçãè¿ä¸­é´ç»è¿äºå±å±å³å¡ã</p>
<p><strong>è¯»åè·¯å¾ (Read Path):</strong></p>
<ol>
<li><strong>App è¯·æ±æ°æ®:</strong> SQL åç»æ°æ®åºã</li>
<li><strong>DB Cache (Shared Buffers):</strong> æ°æ®åºåæ¥èªå·±çåå­ï¼ä¹¦æ¡ï¼ã
<ul>
<li><em>Hit:</em> ç´æ¥è¿åãéåº¦æå¿«ï¼çº³ç§çº§ï¼ã</li>
<li><em>Miss:</em> éè¦å»è¯»æä»¶ã</li>
</ul>
</li>
<li><strong>System Call (read):</strong> æ°æ®åºåèµ·ç³»ç»è°ç¨ï¼è¯·æ±æä½ç³»ç»è¯»æä»¶ã</li>
<li><strong>OS Cache (Page Cache):</strong> æä½ç³»ç»æ¥èªå·±çåå­ï¼ææ¨è½¦ï¼ã
<ul>
<li><em>Hit:</em> æä½ç³»ç»åç°è¿é¡µæ°æ®åå¥½å¨åå­éï¼å¯è½æ¯åææäººè¯»è¿ï¼æèååè¿å»è¿æ²¡è½çï¼ãç´æ¥æ·è´ç»æ°æ®åºã</li>
<li><em>Miss:</em> æä½ç³»ç»ççå»è¯»ç¡¬çã</li>
</ul>
</li>
<li><strong>Disk I/O:</strong> ç¡¬çæè½¬ï¼ç£å¤´å¯»éï¼ææ°æ®è¯»å¥ OS Cacheã</li>
<li><strong>Copy:</strong> æä½ç³»ç»ææ°æ®ä» <strong>OS Cache</strong> å¤å¶å° <strong>DB Cache</strong>ã</li>
</ol>
<p><strong>å³é®ç¹ï¼</strong> å¦ææ°æ®å¨ DB Cache æ²¡å½ä¸­ï¼ä½å¨ OS Cache å½ä¸­ï¼è½ç¶æ¯ç´æ¥è¯»åå­æ¢ä¸ç¹ï¼å ä¸ºæç³»ç»è°ç¨ååå­æ·è´çå¼éï¼ï¼ä½æ¯è¯»ç¡¬çå¿« 1000 åã</p>
<hr>
<h2 id="2-åéç¼å­-double-buffering-ç°è±¡">2. âåéç¼å­â (Double Buffering) ç°è±¡</h2>
<p>ä»ç»çä¸é¢çç¬¬ 6 æ­¥ï¼ä½ ä¼åç°ä¸ä¸ªå°´å°¬çç°è±¡ï¼</p>
<p><strong>åä¸ä»½æ°æ®ï¼å¨åå­éå­äºä¸¤ä»½ï¼</strong></p>
<ul>
<li>ä¸ä»½å¨ OS Page Cache éã</li>
<li>ä¸ä»½å¨ DB Buffer Pool éã</li>
</ul>
<p>è¿å°±å« <strong>Double Buffering</strong>ã</p>
<h4 id="è¿ç§åä½æ¯å¥½æ¯å">è¿ç§åä½æ¯å¥½æ¯åï¼</h4>
<ul>
<li><strong>åå¤ï¼</strong> æµªè´¹åå­ãå¦æä½ çæå¡å¨æ 64GB åå­ï¼ç»æ 30GB å­çæ¯éå¤æ°æ®ï¼é£æ¯æå¤§çæµªè´¹ã</li>
<li><strong>å¥½å¤ï¼</strong> äºè¡¥ã
<ul>
<li>DB Cache æ»¡äºè¦æ·æ±°æ°æ®æ¶ï¼è¢«æ·æ±°çæ°æ®åªæ¯ä»âä¹¦æ¡âç§»åäºâææ¨è½¦âï¼OS Cacheï¼ã</li>
<li>ä¸æ¬¡å¦æåçªç¶éè¦è¿é¡µæ°æ®ï¼è½ç¶ä¹¦æ¡ä¸æ²¡æï¼ä½ææ¨è½¦éæï¼è¿æ¯å¾å¿«ã</li>
</ul>
</li>
</ul>
<hr>
<h2 id="3-postgresql-çç­ç¥ä¾èµä¸åä½">3. PostgreSQL çç­ç¥ï¼ä¾èµä¸åä½</h2>
<p>PostgreSQL å¨è¿æ¹é¢éå¸¸ç¹å«ãå®<strong>é»è®¤ä¸ä½¿ç¨ Direct I/O</strong>ï¼å³ä¸ç»è¿ OS Cacheï¼ï¼èæ¯éæ©å©ç¨å®ã</p>
<ul>
<li><strong>éç½®ç­ç¥ï¼</strong>
<ul>
<li>è¿å°±æ¯ä¸ºä»ä¹ PostgreSQL å®æ¹å»ºè®® <code>shared_buffers</code>ï¼DB Cacheï¼åªè®¾ç½®ä¸ºæ»åå­ç <strong>25% - 40%</strong>ã</li>
<li><strong>å©ä¸çåå­å»åªäºï¼</strong> çç»æä½ç³»ç»ï¼PostgreSQL æææä½ç³»ç»ç¨å©ä¸çåå­å Page Cacheï¼æ¥åå®çâäºçº§ç¼å­âã</li>
</ul>
</li>
<li><strong>ä¼ç¹ï¼</strong> ä»£ç ç®åï¼å©ç¨äºæä½ç³»ç»æççé¢è¯»ï¼Prefetchingï¼ç®æ³ã</li>
<li><strong>ç¼ºç¹ï¼</strong> å­å¨åéç¼å­å¸¦æ¥çåå­æµªè´¹å CPU æ·è´å¼éã</li>
</ul>
<hr>
<h2 id="4-å¶ä»æ°æ®åºçç­ç¥direct-io-ç»è¿">4. å¶ä»æ°æ®åºçç­ç¥ï¼Direct I/O (ç»è¿)</h2>
<p>å¾å¤å¶ä»æ°æ®åºï¼å¦ Oracle, MySQL InnoDBï¼å¾åäºä¸ç§æ´é¸éçåæ³ï¼<strong>O_DIRECT</strong>ã</p>
<ul>
<li><strong>Direct I/O:</strong> æ°æ®åºåè¯æä½ç³»ç»ï¼âæè¦è¯»åæä»¶ï¼ä½ä½ å«ç®¡é²äºï¼å«ç»æåç¼å­ï¼ç´æ¥æç¡¬çæ°æ®è¯»å°æçåå­éãâ</li>
<li><strong>ææï¼</strong>
<ul>
<li><strong>æ¶é¤äºåéç¼å­ï¼</strong> æ°æ®åªå­å¨äº DB Buffer Pool ä¸­ã</li>
<li><strong>åå­å©ç¨çé«ï¼</strong> æ°æ®åºå¯ä»¥æ 80% çè³ 90% çç©çåå­é½æ®ä¸ºå·±æã</li>
</ul>
</li>
<li><strong>ä»£ä»·ï¼</strong> æ°æ®åºå¿é¡»èªå·±å®ç°æå¶å¤æçç¼å­ç®¡çãé¢è¯»ç®æ³åå·çç­ç¥ãå ä¸ºä¸æ¦ç¦»å¼äº OS çä¿æ¤ï¼èªå·±å¿é¡»å¨æè´è´£ã</li>
</ul>
<hr>
<h2 id="5-åå¥ä¸å·ç-write--fsync">5. åå¥ä¸å·ç (Write &amp; Fsync)</h2>
<p>å¨åå¥æ°æ®æ¶ï¼ä¸¤èçå³ç³»æ´å å¾®å¦ï¼å³ä¹<strong>æ°æ®å®å¨</strong>ã</p>
<ol>
<li><strong>DB Write:</strong> æ°æ®åºä¿®æ¹äº Buffer Pool éçæ°æ®ï¼åæäºèé¡µ Dirty Pageï¼ãæ­¤æ¶æ°æ®è¿å¨ç¨æ·ç©ºé´åå­ã</li>
<li><strong>OS Write:</strong> æ°æ®åºè°ç¨ <code>write()</code>ãæä½ç³»ç»ææ°æ®ä» DB Cache æ·è´å° OS Cacheã<strong>æ³¨æï¼æ­¤æ¶æ°æ®è¿æ²¡å°ç¡¬çï¼</strong> å¦æè¿æ¶åæçµæºï¼æ°æ®å°±ä¸¢äºã</li>
<li><strong>Fsync (å·ç):</strong> ä¸ºäºä¿è¯ ACID ä¸­ç Dï¼æä¹æ§ï¼ï¼æ°æ®åºå¿é¡»æ¾å¼è°ç¨ <code>fsync()</code>ã
<ul>
<li>è¿å°±åæ¯å¯¹æä½ç³»ç»å¤§åï¼âå«åªæ¾å¨ææ¨è½¦éï¼ç°å¨ãç«å»ãé©¬ä¸æå®æ¾åé­æ¶ä¹¦åºï¼ç¡¬çï¼å»ï¼â</li>
<li>åªæ <code>fsync</code> è¿åæåï¼æ°æ®åºææ¢åè¯ç¨æ·âäºå¡æäº¤æåâã</li>
</ul>
</li>
</ol>
<p><strong>WAL (é¢åæ¥å¿) çè§è²ï¼</strong></p>
<p>å ä¸º <code>fsync</code> éæºåæ°æ®æä»¶å¤ªæ¢äºï¼æ°æ®åºä¼åé¡ºåºå WAL æ¥å¿ï¼å¹¶é¢ç¹ <code>fsync</code> WAL æä»¶ãè³äºçæ­£çæ°æ®é¡µï¼Data Pageï¼ï¼å¯ä»¥å¨ OS Cache éå¤å¾ä¸ä¼å¿ï¼ç±æä½ç³»ç»ç pdflush çº¿ç¨æèæ°æ®åºç Checkpointer æ¢æ¢å·çã</p>
<h2 id="æ»ç»è°æ´èªæ">æ»ç»ï¼è°æ´èªæï¼</h2>
<table>
<thead>
<tr>
<th><strong>ç¹æ§</strong></th>
<th><strong>OS Cache (å»å¿«)</strong></th>
<th><strong>DB Cache (ç²¾æ)</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ç½®æ¢ç®æ³</strong></td>
<td>LRU (æè¿æå°ä½¿ç¨) çéç¨åç§ãæ¯è¾ç®åç²æ´ã</td>
<td><strong>Clock-Sweep / ARC</strong>ãæ°æ®åºç¥éåªæ¯ç´¢å¼ï¼åªæ¯å¨è¡¨æ«æãå®ä¼ä¿æ¤ç´¢å¼é¡µï¼å¿«éæ·æ±°å¨è¡¨æ«æçé¡µã</td>
</tr>
<tr>
<td><strong>é¢è¯»è½å</strong></td>
<td>åºäºæä»¶åç§»éçç®åé¢è¯»ï¼å¾ä¸è¯» 128KBï¼ã</td>
<td>çè§£ B+ æ ç»æï¼ç¥éä¸ä¸ä¸ªå¶å­èç¹å¨ç£ççä»ä¹ä½ç½®ï¼é¢è¯»æ´ç²¾åã</td>
</tr>
<tr>
<td><strong>åå­æ§å¶</strong></td>
<td>å¨ææ¢å ï¼åºç¨åå­ä¸å¤æ¶ä¼åç¼© Cacheã</td>
<td>å¤§å°åºå®ï¼éå¸¸å¯å¨æ¶åéï¼ã</td>
</tr>
<tr>
<td><strong>éç¨åºæ¯</strong></td>
<td>æä»¶æå¡å¨ãéç¨è®¡ç®ã</td>
<td>å¤æçæ¥è¯¢å¤çã</td>
</tr>
</tbody>
</table>


</div>
<div id="MySignature" role="contentinfo">
    <p>æªç»ä½èåæè¯·å¿è½¬è½½</p>
<p>æ¬ææ¥èªåå®¢å­ä½èï¼<a href="https://www.cnblogs.com/aslanvon/" target="_blank">aixueforever</a>ï¼åæé¾æ¥ï¼<a href="https://www.cnblogs.com/aslanvon/p/19608578" target="_blank">https://www.cnblogs.com/aslanvon/p/19608578</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.004861111111111111" data-date-updated="2026-02-12 15:25">2026-02-12 15:18</span>&nbsp;
<a href="https://www.cnblogs.com/aslanvon">aixueforever</a>&nbsp;
éè¯»(<span id="post_view_count">60</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19608578);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19608578', targetLink: 'https://www.cnblogs.com/aslanvon/p/19608578', title: 'æ°æ®åºç®å­' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ é©å½å½æ°æç´¢ NAVERï¼ä½¿ç¨ JuiceFS æé Hadoop ä¸ Kubernetes å­å¨å®è·µ ]]></title>
    <link>https://www.cnblogs.com/JuiceData/p/19607717</link>
    <guid>a9a77a12ae7caf873e5e8092946ab04a</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/JuiceData/p/19607717" title="åå¸äº 2026-02-12 11:45">
    <span role="heading" aria-level="2">é©å½å½æ°æç´¢ NAVERï¼ä½¿ç¨ JuiceFS æé Hadoop ä¸ Kubernetes å­å¨å®è·µ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>NAVER æ¯é©å½é¢åçäºèç½ç§æå¬å¸ï¼è¿è¥çé©å½æå¤§çæç´¢å¼æï¼å¹¶å¨äººå·¥æºè½ãèªå¨é©¾é©¶ç­é«ç§æé¢åç§¯æå¸å±ãä½è Nam Kyung-wan æ¥èª NAVER Infra å¢éï¼èª 2023 å¹´åä¸ JuiceFS ç¤¾åºä»£ç è´¡ç® (GitHub: <a href="https://github.com/kyungwan-nam" target="_blank" rel="noopener nofollow">kyungwan-nam</a>)ï¼ä¸º Hadoop åºæ¯æåºäºå¤é¡¹æ¹è¿ãæ¬ææ¯ä½èç»§â <a href="https://juicefs.com/zh-cn/blog/user-stories/naver-storage-solution-juicefs-ai-platforms" target="_blank" rel="noopener nofollow">ä¸º AI å¹³å°å¼å¥å­å¨æ¹æ¡ JuiceFS</a>âåçç¬¬äºç¯åå®¢ã</p>
<p>NAVER Infra å¢éè´è´£è¿è¥å¬å± Hadoop éç¾¤ï¼ä½¿ç¨ SparkãHiveãMapReduce ç­ Hadoop åºç¨å¤çæ°æ®ï¼å¹¶å°æ°æ®å­å¨å¨ HDFS ä¸­ãHDFS å¨ Hadoop çæç³»ç»ä¸­éè¿æ°æ®æ¬å°æ§æ¯æé«æ§è½ï¼å·å¤ä¼å¼çå®¹éæ§åå¯æ©å±æ§ã</p>
<p><strong>éçäººå·¥æºè½æå¡çæ®åï¼æ°æ®è§æ¨¡æ¥å§å¢é¿ï¼å¯¹å¤æ ·åæ°æ®å­å¨çéæ±ä¹æ¥çå¢å ãåæ¶ï¼å¦ä½é«æå°å±äº« Hadoop éç¾¤å¤é¨ AI å¹³å°ï¼å¦ Kubernetesï¼ä¸­çæ°æ®ï¼æä¸ºäºä¸é¡¹éè¦ææãå¨è¿ä¸èæ¯ä¸ï¼NAVER æ¢è®¨äºå¯¹è±¡å­å¨æ¯å¦å¯ä»¥æ¿ä»£ HDFSï¼å¹¶æç¡®äº JuiceFS ç»åå¯¹è±¡å­å¨çéç¨åºæ¯</strong>ã</p>
<h2 id="01-hdfs-çå±é">01 HDFS çå±é</h2>
<p><strong>å­å¨ææ¬ä¸å</strong></p>
<p>AI å¼åéè¦ä»¥é«æä¸ç»æµçæ¹å¼å­å¨ä¸æ­å¢é¿çæ°æ®ï¼å¹¶å¨æäºæåµä¸é¿æä¿çåå§æ°æ®ï¼ä»¥ä¾¿è¿è¡æ¨¡åæ¹è¿åéæ°è®­ç»ã</p>
<p>ç¶èï¼Hadoop çè®¡ç®åå­å¨æ¯ç´§å¯è¦åçï¼å¯¼è´å­å¨æ©å±é¾ä»¥ç¬ç«è¿è¡ãå½æ²¡æè®¡ç®éæ±æ¶ï¼ä»ä¸ºæ©å±å­å¨ç©ºé´èå¢å èç¹ä¼é æä¸å¿è¦çææ¬ãæ­¤å¤ï¼HDFS é»è®¤ä¿çä¸éå¯æ¬ï¼è¿ä¸æ­¥å¢å äºå­å¨ææ¬ã</p>
<p><strong>æä»¶æ°ééå¶</strong></p>
<p>AI å¼åæ¶åæ°åä¸ä¸ªå°æä»¶ï¼å¦å¾åãé³é¢åææ¬ç­ãHDFS å­å¨èåç<a href="https://www.cloudera.com/blog/technical/the-small-files-problem.html" target="_blank" rel="noopener nofollow">å°æä»¶é®é¢</a>ï¼å ä¸ºæææä»¶ååçåæ°æ®é½å­å¨å¨ NameNode çåå­ä¸­ãä¾å¦ï¼ç®¡ç 1000 ä¸ä¸ªæä»¶å¤§çº¦éè¦ 3GB çåå­ãå æ­¤ï¼HDFS å¯ç®¡ççæä»¶æ°éåå°åä¸ª NameNode åå­å®¹éçéå¶ã</p>
<p><strong>æ°æ®ä¸­å¿å®¹ç¾è½åå¼±</strong></p>
<p>HDFS éå¸¸ç±åä¸ªæ°æ®ä¸­å¿çèç¹ç»æãä¸ºåºå¯¹æ°æ®ä¸­å¿æéæç¾é¾ï¼éä½¿ç¨é¢å¤æ¹æ¡å°æ°æ®å¤å¶å°å¶ä»æ°æ®ä¸­å¿ï¼ä»èäº§çå¢å ææ¬ã</p>
<p><strong>è¿è¥ææ¬å¢å </strong></p>
<p>NAVER ç±ä¸ä¸äººåè¿è¥å¬å± Hadoop éç¾¤ï¼è´æç¸å¯¹è¾å°ï¼ä½éå¸¸ Hadoop éç¾¤çæå»ºåè¿è¥éå¸¸å¤æä¸ææ¬é«æãè¥è¦åç¬æå»ºåè¿è¥ç¨³å®ç Hadoop ç¯å¢ï¼éè¦ä¸ä¸ç¥è¯åè¾é«çç»´æ¤ææ¬ã</p>
<p><strong>Kubernetes ä¸­ççæå¼å®¹æ§å·®</strong></p>
<p>NAVER AI å¹³å°åºäº Kubernetes æå»ºï¼å¹¶å©ç¨ KubeflowãKServe ç­å¤ç§ AI å¼æºå·¥å·å GPU æ¯æãä½ HDFS ä¸æ¯æ POSIX API å CSI é©±å¨ï¼æ æ³ä½ä¸º Kubernetes å¸¸è§å­å¨æ¹å¼ï¼å³ PersistentVolumeï¼ä½¿ç¨ãå æ­¤ï¼å¨ Kubernetes ä¸­ä½¿ç¨ HDFS éå¨å®¹å¨ä¸­åå¤ Hadoop åãéç½®åè®¤è¯ä¿¡æ¯ï¼å¹¶ç¼å HDFS API ä»£ç ï¼éå¸¸ç¹çä¸ä¼éä½ AI å¼åæçã</p>
<h2 id="02-å¯¹è±¡å­å¨çä¼å¿ä¸å£å¿">02 å¯¹è±¡å­å¨çä¼å¿ä¸å£å¿</h2>
<p>Hadoop éè¿æ°æ®æ¬å°æ§æä¾é«æ§è½ï¼ä½ç±äº HDFS ä¸è®¡ç®èç¹è¦åï¼è®¡ç®åå­å¨èµæºé¾ä»¥ç¬ç«æ©å±ãå æ­¤ï¼æ©å±å­å¨ç©ºé´æ¶ï¼ä»éå¢å é¢å¤çè®¡ç®èç¹ã</p>
<p>ç¸æ¯ä¹ä¸ï¼äºç¯å¢æ¯æè®¡ç®åå­å¨çç¬ç«æ©å±ãéå¸¸ï¼æ°æ®å­å¨å¨å¯¹è±¡å­å¨ä¸­èé HDFSï¼è®¡ç®å¯ä»¥éè¿æç®¡æå¡ï¼å¦ AWS EMRãGoogle Dataprocï¼æåºäº Kubernetes çæ°æ®å¤çå¼æè¿è¡ï¼æ°æ®åå­å¨å¨ S3ãGCS ç­å¯¹è±¡å­å¨ä¸­ãè¿ç§æ¶ææ¯æçµæ´»æ©å±è®¡ç®åå­å¨èµæºã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202602/2544292-20260212114044823-1716877418.png" class="lazyload"></p>
<p>æ­¤å¤ï¼Hadoop ç¤¾åºåäºä¾åºåæä¾äº <a href="https://hadoop.apache.org/docs/r3.4.1/hadoop-aws/tools/hadoop-aws/index.html" target="_blank" rel="noopener nofollow">S3A</a>ã<a href="https://hadoop.apache.org/docs/r3.4.1/hadoop-azure/index.html" target="_blank" rel="noopener nofollow">Azure Blob</a>ã<a href="https://hadoop.apache.org/docs/r3.4.1/hadoop-aliyun/tools/hadoop-aliyun/index.html" target="_blank" rel="noopener nofollow">Aliyun OSS</a> ç­ HDFS å¼å®¹æä»¶ç³»ç»ï¼ä½¿å¾å¯¹è±¡å­å¨å¯ä»¥å HDFS ä¸æ ·ä½¿ç¨ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202602/2544292-20260212114052815-698013538.png" class="lazyload"></p>
<p>å¯¹è±¡å­å¨ä½ä¸ºè¿ç¨å­å¨ï¼è½ç¶é¾ä»¥å®ç°æ°æ®æ¬å°æ§ï¼ä½å·æä»¥ä¸ä¼å¿ï¼</p>
<ol>
<li><strong>å­å¨ææ¬éä½</strong>ï¼è®¡ç®åå­å¨åç¦»ï¼å¯ç¬ç«æ©å±ãå¯¹è±¡å­å¨éå¸¸ææ¬è¾ä½ï¼å¹¶è½æ ¹æ®éè¦éæ©ä¸åçå­å¨ç±»å«ãä¾å¦ï¼å¯¹äºè®¿é®é¢çä½ä½éé¿æä¿ççæ°æ®ï¼å¯ä½¿ç¨ä½ææ¬å­å¨ç±»å«ï¼å¦ S3 Glacierï¼ã</li>
<li><strong>åºè²çæ©å±æ§åå¼¹æ§</strong>ï¼å¯¹è±¡å­å¨è®¾è®¡ä¸æ¯æè¿ä¹æ éçæ©å±ãå¯¹è±¡æ°éåå®¹éæ éå¶ï¼å¯æ ¹æ®å·¥ä½è´è½½ååè½»æ¾æ©å±æç¼©åã</li>
<li><strong>æ°æ®ä¸­å¿ç¾é¾æ¢å¤æ¯æ</strong>ï¼S3 ç­å¯¹è±¡å­å¨æä¾è·¨åºåå¤å¶åè½ï¼å¯é²æ­¢æ°æ®ä¸­å¿æéæç¾é¾å¯¼è´çæ°æ®ä¸¢å¤±ã</li>
<li><strong>è¿è¥ææ¬éä½</strong>ï¼é¿å Hadoop éç¾¤çæå»ºåè¿è¥è´æï¼ä»èéä½è¿è¥ææ¬ã</li>
</ol>
<p>ä½å¯¹è±¡å­å¨æ¿ä»£ HDFS æ¯å¥½çéæ©åï¼</p>
<p><strong>ä¸æ¯æç®å½</strong>ï¼<br>
å¨æä»¶ç³»ç»ä¸­ï¼æä»¶éè¿ç®å½è¿è¡ç»ç»ï¼ååºç®å½ä¸çæä»¶æ¯ä¸é¡¹åºæ¬æä½ï¼éå¸¸éåº¦è¾å¿«ã<br>
èå¯¹è±¡å­å¨æ²¡æç®å½çæ¦å¿µï¼ææå¯¹è±¡æ¯ç¬ç«çæå¹³ç»æãååºæä»¶æ¶éè¦éè¿å¯¹è±¡åç¼æç´¢ï¼éåº¦è¾æ¢ãæ­¤å¤ï¼ä¸ºæ¨¡æç®å½ç»æèä¸´æ¶åå»ºç Directory Marker å¯¹è±¡ä¹ä¼å½±åæ§è½ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202602/2544292-20260212114100874-1306047346.png" class="lazyload"></p>
<p><strong>ä¸æ¯æéå½å</strong>ï¼<br>
å¨æä»¶ç³»ç»ä¸­ï¼éå½åæ¯åºæ¬æä½ï¼ä»¥ O(1) çº§å«çåå­äºå¡å¿«éæ§è¡ãä½å¯¹è±¡å­å¨ä¸æ¯æéå½åï¼ééè¿å¤å¶å¨é¨æ°æ®åå é¤åæ°æ®çæ¹å¼å¤çï¼å¯¼è´éåº¦éå¸¸æ¢ä¸å¯è½ä¸­éå¤±è´¥ã</p>
<p>è¿ä¸é®é¢å¯¹äº MapReduce å Spark ç­å¤§æ°æ®æ¡æ¶å½±åå°¤ä¸ºææ¾(<a href="https://hadoop.apache.org/docs/r3.4.1/hadoop-aws/tools/hadoop-aws/committers.html#Introduction:_The_Commit_Problem" target="_blank" rel="noopener nofollow">Apache Hadoop Amazon Web Services support â Committing work to S3 with the S3A Committers</a>)ãæä»¶è¾åºæä½éå¸¸ä¾èµéå½åæ¥ä¿è¯ä¸è´æ§ï¼FileOutputFormatCommitter å°±æ¯åºäºéå½åå®ç°çãå æ­¤ï¼å¨å¯¹è±¡å­å¨ä¸­ç´æ¥ä½¿ç¨ FileOutputFormatCommitter ä¼æ¾èéä½æ§è½ã</p>
<p>ä¸ºäºè§£å³è¿ä¸é®é¢ï¼å¯ä»¥ä½¿ç¨ <a href="https://hadoop.apache.org/docs/r3.4.1/hadoop-aws/tools/hadoop-aws/committers.html#The_Magic_Committer" target="_blank" rel="noopener nofollow">Magic Committer</a>ï¼å®é¿åäºéå½åæä½ï¼å¹¶éå¯¹å¯¹è±¡å­å¨è¿è¡äºä¼åã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202602/2544292-20260212114208955-1211579678.png" class="lazyload"></p>
<ol start="3">
<li>
<p><strong>ä¸æ¯ææä»¶æé</strong>ï¼<br>
HDFS æ¯æ POSIX æéä½ç³»ï¼å¯ä»¥è®¾ç½®æä»¶åç®å½çææèãç»ä»¥åå¶ä»ç¨æ·çæéãèå¯¹è±¡å­å¨ä¸æä¾æ­¤åè½ï¼å æ­¤æä»¶çææèåç»éå¸¸è¢«è§ä¸ºå½åç¨æ·ï¼æææä»¶åç®å½çæéé»è®¤ä¸º 666 å 777ï¼å³æä»¶å¯è¯»åï¼ç®å½å¯è¯»åå¹¶å¯æ§è¡ï¼(åè: <a href="https://hadoop.apache.org/docs/r3.4.1/hadoop-project-dist/hadoop-common/filesystem/introduction.html#Object_Stores_vs._Filesystems" target="_blank" rel="noopener nofollow">Object Stores vs. Filesystems</a>).ã</p>
</li>
<li>
<p><strong>æ°æ®è®¿é®éåº¦æ¢</strong>ï¼<br>
å¯¹è±¡å­å¨ä½ä¸ºè¿ç¨å­å¨ï¼æ æ³ä¿è¯æ°æ®æ¬å°æ§ï¼å¹¶ä¸æ¯æ¬¡è®¿é®é½æ¶åç½ç»ä¼ è¾ï¼å æ­¤ç¸è¾äº HDFSï¼å¶æ°æ®è®¿é®éåº¦è¾æ¢ï¼æ§è½åå°ç½ç»å»¶è¿åå¸¦å®½éå¶çå½±åã</p>
</li>
<li>
<p><strong>Kubernetes ä¸­çä½å¯ç¨æ§</strong>ï¼<br>
ä¸äºå·¥å·ï¼å¦ Mountpoint for Amazon S3 å s3fsï¼æ¯æéè¿ POSIX API å°å¯¹è±¡å­å¨æè½½ä¸ºç±»ä¼¼æ¬å°æä»¶ç³»ç»çæ¹å¼ãAWS S3 è¿éè¿ Mountpoint for Amazon S3 CSI é©±å¨ æ¯æå°å¯¹è±¡å­å¨ä½ä¸º Kubernetes å·ä½¿ç¨ã</p>
</li>
</ol>
<p>ç¶èï¼ç±äºå¯¹è±¡å­å¨ä¸ä¼ ç»æä»¶ç³»ç»å­å¨æ ¹æ¬å·®å¼ï¼å®æ æ³å®å¨å¼å®¹ POSIX APIï¼ä¸æ§è½è¾ä½ãå æ­¤ï¼å¨ä½¿ç¨è¿äºå·¥å·æ¶ï¼éè¦ååäºè§£å®ä»¬çå·¥ä½åçåå±éæ§ãæç»ï¼å³ä½¿å¨ Kubernetes ç¯å¢ä¸­ä½¿ç¨å¯¹è±¡å­å¨ï¼ä½å¯ç¨æ§é®é¢ä»ç¶æ æ³è§£å³ã</p>
<ol start="6">
<li><strong>S3 å¼å®¹å¯¹è±¡å­å¨ç API å¼å®¹æ§</strong>ï¼<br>
S3 å·²æä¸ºå¯¹è±¡å­å¨çäºå®æ åï¼è¢«å¤ç§åºç¨å¹¿æ³æ¯æãå æ­¤ï¼è®¸å¤äºä¾åºååå¼æºé¡¹ç®æä¾ S3 å¼å®¹å¯¹è±¡å­å¨ãç¶èï¼S3 å¼å®¹å¯¹è±¡å­å¨å¹¶ä¸å®å¨ç­åäºåç S3 æå¡ãå¨ä½¿ç¨æ¶ï¼éè¦ç¡®è®¤å¶æ¯å¦ä¸ S3AFileSystem æå¶ä»åºç¨æä½¿ç¨ç S3 API å¼å®¹ã</li>
</ol>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202602/2544292-20260212114416129-558375337.png" class="lazyload"></p>
<p>ç»¼ä¸ï¼å¯¹è±¡å­å¨å¯ä»¥å HDFS ä¸æ ·ä½¿ç¨ï¼ä½éè¦ååçè§£å¶å±éæ§ãç°æ Hadoop åºç¨é¾ä»¥ç´æ¥è¿ç§»ï¼ä»éé¢å¤çå¼ååééå·¥ä½ãå¯¹äºç´æ¥ä½¿ç¨ HDFS API ç¼åçä»£ç ï¼éè¦é¿åéå½åæä½ï¼å¹¶åå°æä»¶åè¡¨æä½ï¼ä»¥éåºå¯¹è±¡å­å¨çç¹æ§ãä¸ºé¿åç°æ Spark åºç¨æ§è½ä¸éï¼éèèä½¿ç¨ Magic Committerï¼ä½å®å¹¶éæ»æ¯ææï¼ç¹å«æ¯å¨ä¸æ¯æ Spark å¨æååºè¦ççæåµä¸ã</p>
<p>æ­¤å¤ï¼è½ç¶ Spark å Hadoop ç¤¾åºæç»­æ¹è¿å¯¹è±¡å­å¨ç¸å³é®é¢ï¼ä½æ´æ°è½¯ä»¶åçæ¬åè§£å³é®é¢ä»ç¶é¢ä¸´ææãä½¿ç¨ S3 å¼å®¹çå¯¹è±¡å­å¨æ¶ï¼è¿ééªè¯å¶ä¸ S3 API çå¼å®¹æ§ã</p>
<h2 id="03-å¨-hadoop-ä¸­ä½¿ç¨-juicefs">03 å¨ Hadoop ä¸­ä½¿ç¨ JuiceFS</h2>
<p>JuiceFS æ¯ä¸æ¬¾åå¸å¼æä»¶ç³»ç»ï¼æ¶æç±å®¢æ·ç«¯ãåæ°æ®å¼æåæ°æ®å­å¨ç»æãå¯¹è±¡å­å¨ä»ç¨äºå­å¨æ°æ®åï¼èæä»¶ç³»ç»æéçåæ°æ®åç±æ°æ®åºç®¡çã</p>
<p><strong>éæ³¨æ JuiceFS æ¯ä¸ HDFS ç±»ä¼¼çåå¸å¼æä»¶ç³»ç»ãå æ­¤ï¼ä¸ç´æ¥ä½¿ç¨å¯¹è±¡å­å¨ä¸åï¼JuiceFS è½å®ç¾æ¯æ HDFS APIãPOSIX API å Kubernetes CSI é©±å¨</strong>ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202511/2544292-20251120152102093-1542563421.png" class="lazyload"></p>
<p>ä¸ºäºå¨éåº¦æ¢ä¸ä¿®æ¹å°é¾çå¯¹è±¡å­å¨ä¸å®ç°åå¸å¼æä»¶ç³»ç»ï¼JuiceFS å¼å¥äº chunkãslice å block æ¦å¿µã</p>
<ul>
<li>chunkï¼64MBï¼ï¼å°æä»¶åå²ä¸º 64MB åä½ï¼æ¯æåºäºåç§»çå¹¶è¡å¤çã</li>
<li>sliceï¼chunk åçä¿®æ¹åä½ï¼åå¥æ¶åå»ºæ° slice å¹¶ä¼åä½¿ç¨ææ°çæ¬ã</li>
<li>blockï¼é»è®¤ 4MBï¼ï¼å®éå­å¨å¨å¯¹è±¡å­å¨ä¸­çæå°åä½ï¼éè¿å¹¶è¡å¤çç¼©ç­ä¸ä¼ æ¶é´ã</li>
</ul>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202510/2544292-20251030153139503-1484059455.png" class="lazyload"></p>
<p>æ­¤å¤ï¼ä»è¿ç¨å¯¹è±¡å­å¨è¯»åæ°æ®è¾æ¢ï¼JuiceFS æ¯æå¤çº§ç¼å­ï¼ä»¥æ­¤å¼¥è¡¥æ­¤æ§è½ä¸è¶³ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202602/2544292-20260212114447270-2054746288.png" class="lazyload"></p>
<p>NAVER åé¨ AI å¹³å°å·²ä½¿ç¨ JuiceFSãæ´å¤å³äº JuiceFS çè¯¦ç»ä¿¡æ¯å AI å¹³å°å¼å¥è¿ç¨å¯åè<a href="https://juicefs.com/zh-cn/blog/user-stories/naver-storage-solution-juicefs-ai-platforms" target="_blank" rel="noopener nofollow">ä¸º AI å¹³å°å¼å¥å­å¨æ¹æ¡ JuiceFS</a>ã</p>
<p>JuiceFS æ¯æ Hadoop SDKï¼éè¿éç½® JuiceFS åï¼ç¨æ·å³å¯å¨ Hadoop ç¯å¢ä¸­ä½¿ç¨å®ã</p>
<h3 id="éç½®-juicefs">éç½® JuiceFS</h3>
<p>ä¸ºä½¿ Hadoop è¯å« JuiceFS æä»¶ç³»ç»ï¼éå¨ core-site.xml æä»¶ä¸­æ·»å ä»¥ä¸åå®¹ãå¶ä¸­ <a href="https://juicefs.com/docs/community/hadoop_java_sdk/#core-configurations" target="_blank" rel="noopener nofollow">fs.jfs.implãfs.AbstractFileSystem.jfs.impl å juicefs.meta</a> æ¯å¿éçã</p>
<pre><code>&lt;!-- Configure JuiceFS to be available via jfs:// --&gt;    
  &lt;property&gt;  
    &lt;name&gt;fs.jfs.impl&lt;/name&gt;  
    &lt;value&gt;io.juicefs.JuiceFileSystem&lt;/value&gt;  
  &lt;/property&gt;  
  &lt;property&gt;  
    &lt;name&gt;fs.AbstractFileSystem.jfs.impl&lt;/name&gt;  
    &lt;value&gt;io.juicefs.JuiceFS&lt;/value&gt;  
  &lt;/property&gt;  
&lt;!-- juicefs meta url --&gt;    
  &lt;property&gt;  
    &lt;name&gt;juicefs.meta&lt;/name&gt;  
    &lt;value&gt;redis://:password@addr&lt;/value&gt;  
  &lt;/property&gt;  
&lt;!-- In this example, grant access permissions to all users to avoid permission issues. --&gt;    
  &lt;property&gt;  
    &lt;name&gt;juicefs.umask&lt;/name&gt;  
    &lt;value&gt;000&lt;/value&gt;  
  &lt;/property&gt;  
&lt;!-- Cache up to 100 GiB. --&gt;    
  &lt;property&gt;  
    &lt;name&gt;juicefs.cache-size&lt;/name&gt;  
    &lt;value&gt;102400&lt;/value&gt;  
  &lt;/property&gt;  
&lt;!-- Cache under the temporary path of YARN containers, so the cache is removed when the container terminates.    
Since it's a shared Hadoop, caching is temporary only during job execution. --&gt;  
  &lt;property&gt;  
    &lt;name&gt;juicefs.cache-dir&lt;/name&gt;  
    &lt;value&gt;${env.PWD}/tmp&lt;/value&gt;  
  &lt;/property&gt;  
&lt;!-- Prometheus remote write configuration for metrics collection --&gt;    
  &lt;property&gt;  
    &lt;name&gt;juicefs.push-remote-write&lt;/name&gt;  
    &lt;value&gt;http://host:port&lt;/value&gt;  
  &lt;/property&gt;  
  &lt;property&gt;  
    &lt;name&gt;juicefs.push-remote-write-auth&lt;/name&gt;  
    &lt;value&gt;username:password&lt;/value&gt;  
  &lt;/property&gt;  
&lt;!-- Additionally collect Hadoop user and YARN container ID.    
For shared Hadoop to distinguish users and applications. --&gt;  
  &lt;property&gt;  
    &lt;name&gt;juicefs.push-labels&lt;/name&gt;  
    &lt;value&gt;user:${env.USER};container_id:${env.CONTAINER_ID}&lt;/value&gt;  
  &lt;/property&gt;  
</code></pre>
<p>ä»¥ä¸ä¸ºåæä»¶ç³»ç»çé»è®¤éç½®ï¼ä½ä¹å¯æ ¹æ®éè¦éç½®å¤ä¸ªæä»¶ç³»ç»åæ¶ä½¿ç¨ã<br>
æ´å¤éç½®éé¡¹å¯åèâ<a href="https://juicefs.com/docs/community/hadoop_java_sdk/#client-configurations" target="_blank" rel="noopener nofollow">å®¢æ·ç«¯éç½®</a>âã</p>
<h3 id="hadoop-sdk">Hadoop SDK</h3>
<p>Hadoop SDK ç JAR æä»¶å¯ä»¥éè¿ä¸è½½é¢ç¼è¯å®¢æ·ç«¯æèªè¡ç¼è¯æºä»£ç è·åãä¸ºäºç®åé¨ç½²ï¼éå¸¸å¯ä»¥å¨ææ Hadoop èç¹ç Hadoop åè¡çå®è£è·¯å¾ä¸­é¢åå®è£ãç¶èï¼å¨å¤§è§æ¨¡ Hadoop éç¾¤ä¸­ï¼è¿ç§æ¹æ³æä½ç¹çï¼å°¤å¶æ¯å¯¹äºå¬å± Hadoop ç¯å¢ï¼å®ä¼éå¶ææç¨æ·ä½¿ç¨ç¹å®çæ¬ã</p>
<p>å¤§å¤æ° Hadoop åºç¨æ¯æå°æé JAR æä»¶é¨ç½²å¹¶æ·»å å° classpath ä¸­ï¼ç¨æ·å¯æ ¹æ®å®ééè¦éæ©é¨ç½²æ¹å¼ãä»¥ä¸æ¯ HDFS CLIãMapReduce å Spark ä¸­çå·ä½é¨ç½²æ¹æ³ã</p>
<h3 id="hdfs-cli">HDFS CLI</h3>
<p>éç½®å®ä¸è¿° <code>core-site.xml</code> æä»¶åï¼éè¦å¨ <code>HADOOP_CLASSPATH</code> ç¯å¢åéä¸­è®¾ç½® Hadoop SDK æä»¶è·¯å¾ãå®ææ­¤è®¾ç½®åï¼æ¨å¯ä»¥ä½¿ç¨ <code>hdfs</code> å½ä»¤æä½ <code>hdfs://</code> å <code>jfs://</code> æä»¶ç³»ç»ã</p>
<pre><code>$ export HADOOP_CLASSPATH=/home/juicefs/juicefs-hadoop-1.2.3.jar  
$ hdfs dfs -ls hdfs://home/foo  
Found 6 items    
...  
drwx------   - foo users          0 2022-10-14 20:55 hdfs://home/foo/.Trash    
drwx------   - foo users          0 2022-01-06 10:18 hdfs://home/foo/dfsio    
drwx------   - foo users          0 2025-01-22 17:54 hdfs://home/foo/tpcds

$ hdfs dfs -ls jfs://default/  
2025-08-25 19:15:43,964 INFO fs.TrashPolicyDefault: Namenode trash configuration: Deletion interval = 60 minutes, Emptier interval = 60 minutes.    
Found 8 items    
...  
drwxrwxrwx   - 10000 hadoop-admins       4096 2025-06-10 18:06 jfs://default/nyc    
drwxrwxrwx   - 10000 hadoop-admins       4096 2025-05-15 19:42 jfs://default/subdir    
</code></pre>
<h3 id="mapreduce">MapReduce</h3>
<p>MapReduce å¨ Hadoop çå¤ä¸ªèç¹ä¸å¹¶è¡è¿è¡ï¼å æ­¤ææåéä»»å¡çèç¹é½éè¦é¨ç½² JAR æä»¶ãæ¨èçæ¹æ³æ¯éè¿åå¸å¼ç¼å­è¿è¡é¨ç½²ãä½¿ç¨æ­¤æ¹æ³æ¶ï¼ä»»å¡æ§è¡æ¶ä¼èªå¨å° <code>mapreduce.application.framework.path</code> ä¸­è®¾ç½®ç MapReduce æ¡æ¶é¨ç½²å°ä»»å¡èç¹ã</p>
<p>ä»¥ä¸æ¯ <code>mapred-site.xml</code> æä»¶çç¤ºä¾éç½®ï¼</p>
<ul>
<li><code>mapreduce.application.framework.path</code>ï¼æå®åå« Hadoop SDK ç MapReduce æ¡æ¶ç HDFS è·¯å¾ã</li>
<li><code>mapreduce.application.classpath</code>ï¼éç½®ä¸ºåå« Hadoop SDK çè·¯å¾ã</li>
</ul>
<pre><code>&lt;property&gt;  
   &lt;name&gt;mapreduce.application.classpath&lt;/name&gt;  
   &lt;value&gt;$PWD/mr-framework/hadoop/share/hadoop/mapreduce/*:$PWD/mr-framework/hadoop/share/hadoop/mapreduce/lib/*:$PWD/mr-framework/hadoop/share/hadoop/common/*:$PWD/mr-framework/hadoop/share/hadoop/common/lib/*:$PWD/mr-framework/hadoop/share/hadoop/yarn/*:$PWD/mr-framework/hadoop/share/hadoop/yarn/lib/*:$PWD/mr-framework/hadoop/share/hadoop/hdfs/*:$PWD/mr-framework/hadoop/share/hadoop/hdfs/lib/*:$PWD/mr-framework/hadoop/share/hadoop/tools/lib/*&lt;/value&gt;  
 &lt;/property&gt;  
 &lt;property&gt;  
   &lt;name&gt;mapreduce.application.framework.path&lt;/name&gt;  
   &lt;value&gt;hdfs://mapred/framework/hadoop-mapreduce-3.1.2-juicefs-1.2.3.tar.gz#mrframework&lt;/value&gt;  
 &lt;/property&gt;  
</code></pre>
<h3 id="spark">Spark</h3>
<p>Spark çåºæ¬éç½®æä»¶æ¯ <code>spark-defaults.conf</code>ãå¨è¯¥æä»¶ä¸­ï¼å¯ä»¥æ¿ä»£ <code>core-site.xml</code> è¿è¡å¦ä¸è®¾ç½®ï¼</p>
<ul>
<li>ä»»æ Hadoop è®¾ç½®å¯ä»¥éè¿ <code>spark.hadoop.key=value</code> å½¢å¼æ·»å ã</li>
<li><code>spark.jars</code>ï¼æå®è¦é¨ç½²å° Spark driver å executorï¼å¹¶åå«å¨ classpath ä¸­ç JAR æä»¶ã</li>
</ul>
<pre><code>spark.hadoop.fs.jfs.impl io.juicefs.JuiceFileSystem    
spark.hadoop.fs.AbstractFileSystem.jfs.impl io.juicefs.JuiceFS    
spark.hadoop.juicefs.meta redis://:password@addr    
spark.hadoop.juicefs.umask 000    
spark.hadoop.juicefs.push-remote-write http://host:port    
spark.hadoop.juicefs.push-remote-write-auth username:password    
spark.hadoop.juicefs.push-labels user:${env.USER};container_id:${env.CONTAINER_ID}    
spark.hadoop.juicefs.cache-size 102400    
spark.hadoop.juicefs.cache-dir ${env.PWD}/tmp    
spark.jars hdfs://juicefs/juicefs-hadoop/juicefs-hadoop-1.2.3.jar  
</code></pre>
<h2 id="04-juicefs-æ¹è¿äºé¡¹">04 JuiceFS æ¹è¿äºé¡¹</h2>
<p>JuiceFS æä¾å¤ç§æ¥å£ï¼æ¯æè·¨å¹³å°çæ°æ®å±äº«ãä¾å¦ï¼å¨ Hadoop ä¸­ä½¿ç¨ MapReduce æ Spark å¤ççæ°æ®å­å¨å° JuiceFS åï¼å¯ä»¥è½»æ¾å¨ Kubernetes ç¯å¢ä¸­è®¿é®åä½¿ç¨è¿äºæ°æ®ã</p>
<p>ä¸ºä½¿ NAVER å¬å± Hadoop ååºäº Kubernetes ç AI å¹³å°é¡ºçå±äº«æ°æ®ï¼éè¦è¿è¡ä¸äºæ¹è¿ãï¼å·²ç»å¨é¨è´¡ç®å°ç¤¾åºçãï¼</p>
<h3 id="æ¯æ-all-squash-æè½½5394"><a href="https://github.com/juicedata/juicefs/issues/5394" target="_blank" rel="noopener nofollow">æ¯æ all-squash æè½½</a>ï¼#5394ï¼</h3>
<p>NAVER å¬å± Hadoop ä¸ LDAP éæç®¡çç¨æ·è´¦æ·ï¼å æ­¤ Hadoop ä¸­åå»ºçæ°æ®ç±ç¸åºç¨æ·ç LDAP UID å GID ææãç¶èï¼å¨ Kubernetes ä¸­ï¼å®¹å¨å¯ä»¥ä½¿ç¨ä»»æ UID å GID è¿è¡ï¼è¿å¯è½å¯¼è´è®¿é® Hadoop åå»ºçæ°æ®æ¶äº§çæéé®é¢ã</p>
<p>ä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼æä»¬å¢å äºæè½½éé¡¹ <code>--all-squash</code>ãè¯¥éé¡¹ä½¿å¾è®¿é®æè½½è·¯å¾æ¶ï¼æä½ä¸ä¼ä»¥å½åè´¦æ·ç UID å GID è¿è¡ï¼èæ¯ä½¿ç¨æå®ç UID:GIDãå æ­¤ï¼è®¾ç½® Hadoop ç¨æ·ç LDAP UID å GID åï¼Kubernetes ä¸­çå®¹å¨å¯ä»¥æ æéé®é¢å°è®¿é®æ°æ®ã</p>
<h3 id="æ¹è¿-juicefsusers-å-juicefsgroup-è®¾ç½®æ¹å¼4723"><a href="https://github.com/juicedata/juicefs/issues/4723" target="_blank" rel="noopener nofollow">æ¹è¿ juicefs.users å juicefs.group è®¾ç½®æ¹å¼</a>ï¼#4723ï¼</h3>
<p>å¦åæè¿°ï¼å¨ Hadoop éç¾¤ä¸­æ§è¡ä»»å¡æ¶ï¼æ°æ®å½ Hadoop ç¨æ·ç LDAP UID å GID ææãä½å¨ Hadoop éç¾¤å¤é¨ä½¿ç¨ Hadoop SDK æ¶ï¼æ°æ®å½ä»»æ UID å GID ææãä¾å¦ï¼å¨ Docker å®¹å¨ä¸­ä½¿ç¨ HDFS å½ä»¤å­å¨æ°æ®æ¶ï¼ææèä¸ºå®¹å¨åé¨è´¦æ·ç UID å GIDã</p>
<p>ä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼ç¨æ·éè¦éè¿ <code>juicefs.users</code> å <code>juicefs.groups</code> è®¾ç½®æå®æéç UID å GIDãä¹åï¼è¿è¦æ±ç¨æ·ç¼å <code>&lt;ç¨æ·å&gt;:&lt;UID&gt;</code> å <code>&lt;ç»å&gt;:&lt;GID&gt;</code> æ ¼å¼çæä»¶ï¼å¹¶è®¾ç½®æä»¶è·¯å¾ï¼è¿ä¸ªè¿ç¨éå¸¸ç¹çãç°å¨ï¼æä»¬å¢å äºç´æ¥éè¿éç½®å¼æ¥æå® UID å GID çåè½ï¼ç®åäºæä½ã</p>
<h3 id="æ¯æ-subdir6096"><a href="https://github.com/juicedata/juicefs/issues/6096" target="_blank" rel="noopener nofollow">æ¯æ subdir</a>ï¼#6096ï¼</h3>
<p>å¨åºäº Kubernetes ç AI å¹³å°ä¸­ï¼JuiceFS ä»¥å¨æä¾åºæ¹å¼ä½¿ç¨ãåå»º PersistentVolumeClaimï¼PVCï¼æ¶ï¼ä¼å¨ JuiceFS æä»¶ç³»ç»åçæä¸è¯¥å·å¯¹åºçå­ç®å½ãè¥è¦å¨ Hadoop ä¸­å±äº«è¯¥ PVCï¼éä»å®å¨å°å±äº«è¯¥å·å¯¹åºçç®å½ã</p>
<p>ç¶èï¼Hadoop SDK å¹¶ä¸æä¾ç±»ä¼¼ <code>--subdir</code> çæè½½éé¡¹ï¼æ æ³éå¶ Hadoop ä»è®¿é® JuiceFS çç¹å®å­è·¯å¾ãä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼æä»¬å¨ Hadoop SDK ä¸­å¢å äº <code>juicefs.subdir</code> è®¾ç½®ï¼ä½¿ç¨æ­¤è®¾ç½®å¯ä»¥éå¶ä»è®¿é®æå®è·¯å¾ã</p>
<h3 id="éè¿-hdfs-å½ä»¤æ¥çéé¢5937"><a href="https://github.com/juicedata/juicefs/issues/5937" target="_blank" rel="noopener nofollow">éè¿ hdfs å½ä»¤æ¥çéé¢</a>ï¼#5937ï¼</h3>
<p>JuiceFS å¯ä»¥ä¸ºæ´ä¸ªæä»¶ç³»ç»æç¹å®ç®å½è®¾ç½®éé¢ãå¨ Kubernetes ä¸­ï¼PVC ç <code>spec.resources.requests.storage</code> å¼å°è®¾ç½®ä¸ºè¯¥ç®å½çéé¢ã</p>
<p>å¨ Hadoop ä¸ PVC å±äº«æ¶ï¼ä¹éè¦æ¥çéé¢ä¿¡æ¯ãç¶èï¼åæç HDFS å½ä»¤ <code>hdfs dfs -count -q</code> æ æ³æ¥ç JuiceFS çéé¢ãä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼æä»¬å¯¹è¯¥åè½è¿è¡äºæ¹è¿ï¼ç°å¨å¯ä»¥éè¿ç¸åçå½ä»¤æ¥ç JuiceFS çéé¢ä¿¡æ¯ã</p>
<h3 id="æ¯æ-prometheus-remote_write-åè®®6295"><a href="https://github.com/juicedata/juicefs/issues/6295" target="_blank" rel="noopener nofollow">æ¯æ Prometheus remote_write åè®®</a>ï¼#6295ï¼</h3>
<p>ä½¿ç¨ JuiceFS Hadoop SDK æ¶ï¼å¯ä»¥å°ææ åéå° Pushgateway å Graphiteãä½ Pushgateway éè¦å®ææ¸çææ ï¼ä¸ Graphite æ ¼å¼ç¬ç¹ï¼ä½¿ç¨èµ·æ¥è¾ä¸ºå°é¾ã</p>
<p>è®¸å¤ç³»ç»æ¯æ Prometheus <code>remote_write</code> åè®®ãä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼æä»¬å¨ JuiceFS ä¸­å¢å äºéè¿è¯¥åè®®åéææ çåè½ãéè¿ <code>juicefs.push-remote-write</code> å <code>juicefs.push-remote-write-auth</code> è®¾ç½®ï¼ç¨æ·å¯ä»¥æå® VictoriaMetrics  <code>vmagent</code> æ Prometheusãè¿ä¸åè½ä¸ä»æ´åäºè·¨å¹³å°æ°æ®ï¼è¿è½æ´åçæ§ç³»ç»ã</p>
<h2 id="05-juicefs-çä¼å¿">05 JuiceFS çä¼å¿</h2>
<h3 id="ä¼å¿-1éè¿å¹¶è¡å¤çåç¼å­åæå¯¹è±¡å­å¨çæ§è½ç¶é¢">ä¼å¿ 1ï¼éè¿å¹¶è¡å¤çåç¼å­åæå¯¹è±¡å­å¨çæ§è½ç¶é¢</h3>
<p>JuiceFS éè¦éè¿ç½ç»ä¸è¿ç¨å¯¹è±¡å­å¨äº¤æ¢æ°æ®åï¼å æ­¤å¨æ§è½ä¸é¾ä»¥è¶è¶å·ææ°æ®æ¬å°æ§ä¼å¿ç HDFSã<strong>ç¶èï¼éè¿å°æ°æ®ååå¹¶è¡å¤çä»¥åç¼å­å·²è¯»åæ°æ®ï¼å¯ä»¥åæè¿ä¸æ§è½ç¶é¢</strong>ãæä»¬éè¿æ§è½æµè¯éªè¯äº HDFS å JuiceFS å¨ä¸ååºæ¯ä¸çè¡¨ç°ã</p>
<h4 id="dfsio">DFSIO</h4>
<p>ä½¿ç¨ 10 ä¸ª map taskï¼éå¯¹ 100GB æä»¶æµé HDFS å JuiceFS çé¡ºåºæ°æ®åå¥åè¯»åçååéãæ°å¼è¶é«æ§è½è¶å¥½ãä¸ºéåºé¡ºåºåå¥/è¯»åï¼å° JuiceFS çåå¤§å°è®¾ä¸º 16MBã</p>
<ul>
<li>åå¥ï¼JuiceFS çååéæ¯ HDFS ç 1.7 åãè¿æ¯å ä¸ºæ°æ®è¢«åå²æå°åå¹¶è¡ä¸ä¼ ã</li>
<li>è¯»åï¼JuiceFS çååéæ¯ HDFS ç 0.75 åãä½å¦ææ°æ®å·²ç¼å­ï¼é¢ææ§è½ä¸ HDFS ç¸ä¼¼ã</li>
</ul>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202602/2544292-20260212114515609-436981988.png" class="lazyload"></p>
<h4 id="tpc-ds">TPC-DS</h4>
<p>ä½¿ç¨ Spark SQL æµéå¯¹å­å¨å¨ HDFS å JuiceFS ç 100GB è§æ¨¡è¡¨çæ¥è¯¢ååºæ¶é´ãæ°å¼è¶ä½æ§è½è¶å¥½ã</p>
<ul>
<li>JuiceFS çååºæ¶é´æ¯ HDFS ç 1.8 åï¼è¿æ¯ç±äºæ°æ®æ¬å°æ§å·®å¼æè´ã</li>
<li>å·²ç¼å­ç JuiceFS è¡¨ç°åºä¸ HDFS ç¸ä¼¼çæ§è½ã</li>
</ul>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202602/2544292-20260212114525695-1671557329.png" class="lazyload"></p>
<h3 id="ä¼å¿-2ä¸-hdfs-å®å¨å¼å®¹æ éä¿®æ¹ç°æ-hadoop-åºç¨å³å¯ä½¿ç¨">ä¼å¿ 2ï¼ä¸ HDFS å®å¨å¼å®¹ï¼æ éä¿®æ¹ç°æ Hadoop åºç¨å³å¯ä½¿ç¨</h3>
<p>NAVER æ¥æç¨³å®è¿è¥çå¬å± Hadoop éç¾¤ï¼è¿è¡çå¤ç§æå¡ç Hadoop åºç¨ãå¦æä»å°ä¸å¸¸ç¨çæ°æ®å­å¨å¨å¯¹è±¡å­å¨ä¸­ä»¥éä½å­å¨ææ¬ï¼å¯è½ä¼åºç°é®é¢ãæ­£å¦åæè¿°ï¼å¯¹è±¡å­å¨ä¸æ¯æä»¶ç³»ç»ï¼æ æ³ä¿è¯ç°æ Hadoop åºç¨çæ§è½åè¿è¡ãä¸ºæ­¤ï¼éè¦éåä»£ç ææ£æ¥æ°æ®å¤çå¼ææ¯å¦æ¯æå¯¹è±¡å­å¨ãæ­¤å¤ï¼è¿éæ ¹æ®å­å¨ç±»ååç¬è¿è¡åç®¡ç Hadoop åºç¨ï¼å¢å äºç®¡çè´æã</p>
<p>ä¸ä¹ç¸åï¼ä½¿ç¨ JuiceFS å¯ä»¥ä¿æç°æ Hadoop åºç¨ä¸åãç¨æ·åªéå°è¾å¥è¾åºè·¯å¾æå®ä¸º <code>hdfs://</code> æ <code>jfs://</code>ï¼å³å¯ä»¥ç¸åæ¹å¼è¿è¡åºç¨ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202602/2544292-20260212114533472-1556168460.png" class="lazyload"></p>
<p>HDFS åºäºæ°æ®æ¬å°æ§ä¿è¯é«æ§è½ï¼èå¯¹è±¡å­å¨åå¨ä½ææ¬åæ©å±æ§æ¹é¢å·æä¼å¿ãä¸¤èåææé¿ï¼é¾ä»¥å®å¨æ¿ä»£ï¼éè¦æ ¹æ®éæ±éæ©ãä½¿ç¨ JuiceFS å¯ä»¥å¨ä¸ä¿®æ¹ç°æ Hadoop åºç¨çæåµä¸ï¼åæ¶å©ç¨ HDFS åå¯¹è±¡å­å¨çä¼å¿ã</p>
<h3 id="ä¼å¿-3æ¯æå¤ç§æ¥å£å¯ä½ä¸ºè·¨å¹³å°éæå­å¨">ä¼å¿ 3ï¼æ¯æå¤ç§æ¥å£ï¼å¯ä½ä¸ºè·¨å¹³å°éæå­å¨</h3>
<p>NAVER ä½¿ç¨å¤ç§å¹³å°è¿è¡æå¡å¼ååè¿è¥ãä¾å¦ï¼å¨å¼å/è¿è¥ AI æå¡æ¶ï¼éè¦å¨æ°æ®å¤çå¹³å°ä¸­æ¸æ´æ°æ®ï¼å¨ AI å¹³å°ä¸­è®­ç»æ¨¡åï¼å¹¶éè¿å®¹å¨å¹³å°æä¾æå¡ã</p>
<p>å¨ NAVERï¼åä¸ªå¹³å°æä¾ç¬ç«çå­å¨ï¼å¹³å°åé¨æäºä½¿ç¨ï¼ä½é¾ä»¥è®¿é®å¶ä»å¹³å°çå­å¨ãä¸åå¹³å°çå­å¨éç¦»å¯¼è´äºæ°æ®å­¤å²ç°è±¡ï¼å¹¶å®¹æé ææ°æ®éå¤åèµæºæµªè´¹ã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202602/2544292-20260212114541694-193616719.png" class="lazyload"></p>
<p>JuiceFS ä¸ä»æ¯æ HDFSï¼è¿å®ç¾å¼å®¹ POSIX å Kubernetes CSI é©±å¨ï¼éåä½ä¸ºè·¨å¹³å°çéæå­å¨ãéè¿å¨å¤ä¸ªå¹³å°é´é¡ºçä½¿ç¨ JuiceFS å±äº«æ°æ®ï¼å¯å¤§å¹æå AI æå¡å¼åæçï¼å®ç°æ°æ®ç»ä¸ç®¡çã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2544292/202602/2544292-20260212114549389-94535010.png" class="lazyload"></p>
<h2 id="06-ç»è¯­">06 ç»è¯­</h2>
<p>æ¬ææ¢è®¨äº JuiceFS å¨ Hadoop ç¯å¢ä¸­çä½¿ç¨æ¹æ³åå¶ä¼å¿ï¼èå¨é¨åä¸å¡åºæ¯ä¸ï¼ç´æ¥éç¨ HDFS æå¯¹è±¡å­å¨ä¼æ¯æ´ééçéæ©ãä¾å¦ï¼å½ä¸å¡éè¦ä¾ææ°æ®æ¬å°æ§å®ç°é«æå¿«éå¤çæ¶ï¼å»ºè®®å°æ°æ®å­å¨äº HDFS ä¸­ï¼æ­¤å¤ï¼éå¯¹è®¿é®é¢çè¾ä½çæ°æ®ï¼æéç¨ Iceberg ç­ä¸ä¸ºå¯¹è±¡å­å¨ä¼åçæ°æ®æ ¼å¼æ¶ï¼ç´æ¥ä½¿ç¨å¯¹è±¡å­å¨åæ´ä¸ºç®ä¾¿ã</p>
<p>èå¨ä»¥ä¸åºæ¯ä¸­ï¼JuiceFS ä¼æ¯æ´ä¼éæ©ï¼</p>
<ol>
<li>éå¨ Kubernetes ä¸ Hadoop ç¯å¢ä¹é´å®ç°æ°æ®å±äº«æ¶ï¼</li>
<li>å¸æå¨ä¸ä¿®æ¹ç°æ Hadoop åºç¨ä»£ç çåæä¸ï¼ä¸ HDFS å¹¶è¡é¨ç½²ä½¿ç¨æ¶ï¼</li>
<li>å¤çå­å¨éå¤è¯»åè¡ä¸ºãå¯éè¿ç¼å­æ¾èæåæççæ°æ®ä½ä¸æ¶ï¼</li>
<li>ä¸å¡æç¨ S3 API æ æ³è¢«åºå± S3 å¼å®¹å­å¨è¯å¥½æ¯ææ¶ã</li>
</ol>
<p>æ¬æä»ç»äºå¨ NAVER åé¨æ¬å°ç¯å¢ä¸­çåºç¨æ¡ä¾ï¼ä½å¨ AWSãGoogle Cloud ç­å¬æäºç¯å¢ä¸­åæ ·éç¨ãå¸æå¯¹æç±»ä¼¼å°æ°çè¯»èææå¸®å©ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-12 11:46">2026-02-12 11:45</span>&nbsp;
<a href="https://www.cnblogs.com/JuiceData">JuiceFS</a>&nbsp;
éè¯»(<span id="post_view_count">117</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19607717);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19607717', targetLink: 'https://www.cnblogs.com/JuiceData/p/19607717', title: 'é©å½å½æ°æç´¢ NAVERï¼ä½¿ç¨ JuiceFS æé Hadoop ä¸ Kubernetes å­å¨å®è·µ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å¸è°·é¸è¿æ»¤å¨åçè¯¦è§£ ]]></title>
    <link>https://www.cnblogs.com/lxl-233/p/19607712</link>
    <guid>893ccf84c3391778e8eecbc4483c2134</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lxl-233/p/19607712" title="åå¸äº 2026-02-12 11:46">
    <span role="heading" aria-level="2">å¸è°·é¸è¿æ»¤å¨åçè¯¦è§£</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div>
<div><span style="font-size: 18px"><strong>å¸è°·é¸è¿æ»¤å¨ vs å¸éè¿æ»¤å¨ æ ¸å¿åçä¸ç¹æ§è§£æ</strong></span></div>
</div>
<p>ä¸å¸éè¿æ»¤å¨ä¸æ ·,å¸è°·é¸è¿æ»¤å¨ä¹æ¯ç¨æ¥å¿«éå¤æ­ä¸ä¸ªåç´ æ¯å¦å­å¨ç,ä½æ¯è§£å³äºå¸éè¿æ»¤å¨"æ æ³å é¤"ççç¹</p>
<div>
<div><span style="font-size: 16px"><strong>ä¸ãåºå±æ°æ®ç»æå¯¹æ¯</strong></span></div>
</div>
<p>åºå±æ°æ®ç»æä¸­,å¸éè¿æ»¤å¨éç¨çæ¯ä¸ç»´bitæ°ç»,æ¯ä¸ªä½åªè½å­å¨01ç¶æ,éè¿è¥å¹²hashå½æ°å½ä¸­å¤ä¸ªä½æ¥å¤æ­åç´ æ¯å¦å­å¨,å·æå­å¨çè¯¯å¤é£é©<br>èå¸è°·é¸è¿æ»¤å¨éç¨çæ¯ä¸ç»´æ¡¶æ°ç»,æ¯ä¸ªbucketå­å¨åç´ ç"æçº¹"fingerprint,ä¹å°±æ¯å°åç´ å¼åäºä¸è¾¹hash,æ¯ä¸ä¸ª8ä½2è¿å¶æ°,èä¸åªæä¸¤ä¸ªhashå½æ°,åæ ·ä¹å·æå­å¨è¯¯å¤é£é©</p>
<div>
<div><span style="font-size: 16px"><strong>äºãå¸è°·é¸è¿æ»¤å¨æ ¸å¿æä½</strong></span></div>
</div>
<p>1. æå¥æ°æ®ï¼âååå¸æ¾å·¢ï¼æçº¹å ä½ç½®â å¯¹è¦å­å¥çä»»æå¼ï¼æ¯å¦å­ç¬¦ä¸² âuser123âï¼ï¼<br>â  çææçº¹ï¼åéè¿åå¸å½æ°æå¼è½¬åä¸ºç­ä¸åºå®é¿åº¦ç âæçº¹âï¼æ¯å¦æ âuser123â åå¸æ 8 ä½äºè¿å¶æ° â10110010âï¼ââ æçº¹æ¯å¼ç âç²¾ç®çâï¼æ¯åå¼å°å¾å¤ï¼ç®çæ¯èçåå­ï¼ <br>â¡ ååå¸å®ä½æ¡¶ï¼ç¨ä¸¤ä¸ªç¬ç«çåå¸å½æ°ï¼Hash1ãHash2ï¼ï¼è®¡ç®åºè¿ä¸ªå¼å¨ âæ¡¶æ°ç»â éçä¸¤ä¸ªåéæ¡¶ä½ç½®ï¼æ¯å¦ Hash1 ç®åºæ¥æ¯ç¬¬ 10 å·æ¡¶ï¼Hash2 ç®åºæ¥æ¯ç¬¬ 25 å·æ¡¶ï¼ï¼ <br>â¢ å­å¥è§åï¼ææçº¹æ¾è¿ä»»æä¸ä¸ªåéæ¡¶ï¼åªè¦æ¡¶éè¿æç©ºä½ï¼ï¼å¦æä¸¤ä¸ªæ¡¶é½æ»¡äºï¼å°± âè¸¢èµ°â å¶ä¸­ä¸ä¸ªæ¡¶éå·²æçæçº¹ï¼ç±»ä¼¼å¸è°·é¸å å«çé¸çå·¢ï¼ï¼è¢«è¸¢èµ°çæçº¹åç¨å®èªå·±çå¦ä¸ä¸ªåéæ¡¶ä½ç½®éæ°æå¥ï¼ç´å°æ¾å°ç©ºä½ï¼æéè¯ä¸éï¼è¯´æè¿æ»¤å¨æ»¡äºï¼ã</p>
<p>2. æ¥è¯¢æ°æ®ï¼âåæ¡¶æ¾æçº¹ï¼æåå¤å­å¨âï¼å¯¹åºå®æ¹ âmembership queryâï¼ è¦å¤æ­ âå¼ x æ¯å¦å­å¨âï¼<br>â  çæ x çæçº¹ï¼åæå¥æ¶çè§åä¸è´ï¼ï¼<br>â¡ ç¨ Hash1ãHash2 ç®åº x çä¸¤ä¸ªåéæ¡¶ï¼<br>â¢ åªè¦å¶ä¸­ä¸ä¸ªæ¡¶éè½æ¾å°å x å®å¨å¹éçæçº¹ï¼å°±è¿å âå­å¨âï¼ä¸¤ä¸ªæ¡¶é½æ²¡æï¼å°±è¿å âä¸å­å¨âã å³é®ç¹æ§ï¼åªæ âåé³æ§âï¼æ²¡æ âåé´æ§â åå¸éè¿æ»¤å¨ä¸æ ·ï¼å¸è°·é¸è¿æ»¤å¨çå¤æ­ç»æè§åæ¯ï¼ è¯´ âä¸å­å¨âï¼100% åç¡®ï¼ç»å¯¹ä¸å­å¨ï¼ï¼ è¯´ âå­å¨âï¼å¯è½è¯¯å¤ï¼å®éä¸å­å¨ï¼ä½æçº¹å·§åå¹éï¼ââ è¿å°±æ¯ âåé³æ§ï¼false positiveï¼âã</p>
<p>3. å é¤æ°æ®:&nbsp; &nbsp;"çæå¾å é¤åç´ æçº¹, ååå¸æ¾å·¢, æ¾å°ä¸¤ä¸ªåéæ¡¶, æ¡¶ä¸­æ¾å°ä»»æç¸åæçº¹,å é¤ä¸ä¸ªå³å¯"<br>ä¸ºä»ä¹ä¼ ç»å¸éè¿æ»¤å¨æ æ³å é¤å¢? å ä¸ºå¸éè¿æ»¤å¨ä¾é bitæ°ç»hashå½ä¸­,å¤ä¸ªåç´ å¯è½å½ä¸­ç¸åä½ç½®,é£ä¹è¿ä¸ªä½ç½®å®éåå«äºä¸¤ä¸ªåç´ å­å¨çä¿¡æ¯,æ¯"å±äº«"ç,å é¤ä¸ä¸ªåç´ ,éè¦æå¯¹åºä½ç½®ç½®ä¸º0,å°±ä¼å½±åå°å¶ä»åç´ çå¤æ­<br>èå¸è°·é¸è¿æ»¤å¨ä¸å,å®ä½¿ç¨çæ¯æ¡¶æ°ç»,å°±ç®ä¸¤ä¸ªåç´ æ°å¥½è®¡ç®çä¸¤ä¸ªåéæ¡¶æ¯ç¸åç,æ°å¥½è®¡ç®åºçæçº¹ä¹æ¯ç¸åç,ä¸æ°å¥½å­æ¾æçº¹çå®éæ¡¶ä¹æ¯åä¸ä¸ª,ä¹æ²¡å³ç³»,ç´æ¥å¾æ¡¶éå¡<br>å ä¸ºæ¡¶æ¯å¯ä»¥å­æ¾å¤ä¸ªç,å­æ¾å¤ä¸ªç¸åçæçº¹ä¹æ²¡å³ç³»,å¤©ç¶æ¯æå­æ¾ç¸åæçº¹<br>å é¤çæ¶å,ç´æ¥æ¾å°åéæ¡¶,å é¤å¯¹åºçä¸ä¸ªæçº¹å°±è¡äº<br>ä½ä¹æ­£å å¦æ­¤,åªå é¤ä¸ä¸ªå¯¹åºæçº¹,åå»å¤æ­æ­¤åç´ æ¯å¦å­å¨æ¶,æå¶ä»åç´ æ°å¥½æçº¹æ¯ç¸åç,ä¸å­äºåä¸ä¸ªæ¡¶ä¸­,è¿æ ·å¯è½ä¼å­å¨è¯¯å¤,å®æ¹è®ºæä¸­ç§°ä¸º"åé³æ§"</p>
<div>
<div><span style="font-size: 16px"><strong>ä¸ãè¯¯å¤çï¼æçº¹é¿åº¦çæ ¸å¿å½±å</strong></span></div>
</div>
<p>å®æ¹æç¡® âfingerprint size will directly determine the false positive rateâï¼æææ¯ æçº¹æ¯å¼ç âç²¾ç®æ è¯âï¼é¿åº¦è¶ç­ï¼æ¯å¦ 4 ä½ï¼ï¼ä¸åå¼çæç¸åæçº¹çæ¦çè¶é«ï¼è¯¯å¤çå°±è¶é«ï¼ æçº¹è¶é¿ï¼æ¯å¦ 16 ä½ï¼ï¼ç¸åæçº¹çæ¦çè¶ä½ï¼è¯¯å¤çå°±è¶ä½ï¼ä½æ¯ä¸ªåç´ çæçæçº¹è¶é¿,&nbsp; å ç¨çåå­ä¹è¶å¤ã <br>ä¸¾ä¸ªå®éæ°å¼ï¼Redis ä¸­å¸¸ç¨éç½®ï¼ï¼<br>8 ä½æçº¹ï¼è¯¯å¤çâ1/256ï¼0.39%ï¼ï¼éåå¯¹è¯¯å¤çè¦æ±ä¸é«ãè¿½æ±åå­æè´èççåºæ¯ï¼ <br>16 ä½æçº¹ï¼è¯¯å¤çâ1/65536ï¼0.0015%ï¼ï¼éåå¯¹è¯¯å¤çææçåºæ¯ï¼æ¯å¦é»ååæ ¡éªï¼ã</p>
<div>
<div><span style="font-size: 16px"><strong>åãRedis ä¸­å¸è°·é¸è¿æ»¤å¨çä¼å£å¿</strong></span></div>
</div>
<p>æ¯æå é¤æ°æ®ï¼å¸éè¿æ»¤å¨çä½æ°ç»ä¸æ¦ç½® 1 æ æ³åéï¼æ æ³å é¤ï¼å¸è°·é¸è¿æ»¤å¨åªéå é¤å¯¹åºæ¡¶éçæçº¹å³å¯ï¼éåéè¦å¨ææ´æ°çåºæ¯ï¼æ¯å¦é»ååæ°å¢ / å é¤ï¼ï¼<br>ç©ºé´æçæ´é«ï¼æçº¹æ¯ç´§åå­å¨çï¼ç¸æ¯å¸éè¿æ»¤å¨çç¨çä½æ°ç»(å­å¨å¤§éæµªè´¹) ç¸åè¯¯å¤çä¸ï¼å¸è°·é¸è¿æ»¤å¨çåå­å ç¨çº¦ä¸ºå¸éè¿æ»¤å¨ç 1/2~2/3ï¼<br>åå¸å½æ°æ´å°ï¼åºå® 2 ä¸ªåå¸å½æ°ï¼è®¡ç®å¼éæ¯å¸éè¿æ»¤å¨ï¼3-5 ä¸ªï¼æ´ä½ã<br>æ§è½: å¸è°·é¸è¿æ»¤å¨åªéè¦è®¡ç®ä¸æ¬¡æ¾å°hashæ¡¶,ä¸åä¸ªæ¡¶çä½ç½®è¾ä¸ºéä¸­,åå­ä¸è¾ä¸ºé è¿,CPUçç¼å­å½ä¸­çæ´é«,æ¥è¯¢éåº¦å¿«äºå¸éè¿æ»¤å¨<br><br>å£å¿:<br>å¨æ¥è¿æ»¡æ¶,å¸è°·é¸è¿æ»¤å¨æå¥åç´ å¯è½ä¼é¢ç¹å å·¢,å¯¼è´åç»­æçº¹ä¸å¾ä¸ç§»å¨èªå·±çä½ç½®,å¯¼è´æå¥æ§è½å¤§å¹ä¸é(ç±äºå¸è°·é¸è¿æ»¤å¨ç"å å·¢"ç¹ç¹,åç´ è¶å¤,è¶è¶åäºæ»¡æ¶,æå¥æ°æ®çæ§è½ä¼è¶æ¥è¶ä½,å ä¸ºæå¥ä¸ä¸ªå°±è¦å å«äººçå·¢,å«äººåè¦å»æ¾å¦ä¸ä¸ªå·¢,éå¤å¦æ­¤,æ§è½ä¼è¶æ¥è¶ä½)<br>èä¸å¸è°·é¸è¿æ»¤å¨çå®¹éå¤§å°å¿é¡»ä¸º2çå¹<br>å¯æçæ¯ç°å¨çå·ä½å®ç°å¹¶ä¸å¤,GitHubä¸åªæé¶æå ä¸ªGo,C++,Javaçå®ç°</p>
<div>
<div><span style="font-size: 16px"><strong>äºãæ ¸å¿æ»ç»</strong></span></div>
</div>
<p>å¸è°·é¸è¿æ»¤å¨åºå±æ¯æ¡¶æ°ç» + æçº¹ï¼é  2 ä¸ªåå¸å½æ°å®ä½æ¡¶ï¼ä¸åäºå¸éè¿æ»¤å¨ç âä½æ°ç» + å¤åå¸âï¼<br>æ¥è¯¢é»è¾ï¼åæ¡¶æ¾å¹éæçº¹ï¼æåå¤å­å¨ï¼æ åå¤ä¸å­å¨ï¼ä»å¯è½åé³æ§ï¼ï¼ <br>è¯¯å¤çæ ¸å¿ï¼æçº¹é¿åº¦è¶ç­ï¼è¯¯å¤çè¶é«ï¼åå­å ç¨è¶å°ï¼å¯æéå¹³è¡¡ï¼<br>æ ¸å¿ä¼å¿ï¼æ¯æå é¤ãåå­æçé«ï¼æ¯ Redis ä¸­å¸éè¿æ»¤å¨çåçº§ç, ä½æ¯æå¥æ§è½ç¥éäºä¼ ç»å¸éè¿æ»¤å¨</p>
<p>å®æ¹ææ¡£: <a href="https://redis.io/docs/latest/develop/data-types/probabilistic/cuckoo-filter/" target="_blank" rel="noopener nofollow">https://redis.io/docs/latest/develop/data-types/probabilistic/cuckoo-filter/</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.002777777777777778" data-date-updated="2026-02-12 11:50">2026-02-12 11:46</span>&nbsp;
<a href="https://www.cnblogs.com/lxl-233">é£ä¹</a>&nbsp;
éè¯»(<span id="post_view_count">140</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19607712);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19607712', targetLink: 'https://www.cnblogs.com/lxl-233/p/19607712', title: 'å¸è°·é¸è¿æ»¤å¨åçè¯¦è§£' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ é¸¿èåºç¨å¼åUIåºç¡ç¬¬å­è:Wantæèµ·åºç¨è·³è½¬ä¼ åå¹éè§åå®æ ]]></title>
    <link>https://www.cnblogs.com/san-xiu/p/19607664</link>
    <guid>98dc1c7f65a6545fb88d10c24c5cca6a</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/san-xiu/p/19607664" title="åå¸äº 2026-02-12 11:41">
    <span role="heading" aria-level="2">é¸¿èåºç¨å¼åUIåºç¡ç¬¬å­è:Wantæèµ·åºç¨è·³è½¬ä¼ åå¹éè§åå®æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å­¦ä¹ ç®æ ">ãå­¦ä¹ ç®æ ã</h2>
<ol>
<li>çè§£ Want æ¬è´¨ï¼ææ¡ Want ä½ä¸ºç»ä»¶é´ä¿¡æ¯ä¼ éè½½ä½çæ ¸å¿ä½ç¨ï¼æç¡®æ¾å¼/éå¼ Want çååä¸éç¨åºæ¯ï¼</li>
<li>ææ¡æ¾å¼å¯å¨ï¼ç²¾éè·¨åºç¨éè¿ <code>bundleName+abilityName</code> ç²¾åå¯å¨ç»ä»¶ï¼</li>
<li>ææ¡éå¼å¯å¨ï¼åé <code>linkFeature</code>ã<code>action</code>ã<code>entities</code>ã<code>uri</code>ã<code>type</code> çå®æ´å±çº§å¹éè§åï¼</li>
<li>æ°æ®ä¼ éä¸æ ¡éªï¼è§èä½¿ç¨ <code>parameters</code> ä¼ éæ°æ®ï¼åçè¿ç¨åè½æ è¯å®ç°ç²¾åå¹éã</li>
</ol>
<h2 id="åå®¹éºå«">ãåå®¹éºå«ã</h2>
<p>å¨ HarmonyOS ä¸­ï¼<strong>Want æ¯ç»ä»¶ï¼Ability/Extensionï¼é´äº¤äºçæ åä¿¡æ¯è½½ä½</strong>ï¼æ ¸å¿ç¨äºæè¿°âæä½ç®æ ââæä½æå¾âåâéå æ°æ®âï¼æ¯åºç¨å/è·¨åºç¨ç»ä»¶éä¿¡çæ ¸å¿æ¡¥æ¢ãæ è®ºæ¯åºç¨åé¡µé¢è·³è½¬ãè·¨åºç¨åè½è°ç¨ï¼å¦æå¼ææ¡£ãåäº«åå®¹ï¼ï¼æ¬è´¨é½æ¯éè¿ä¼ é Want å¯¹è±¡å®ç°çã</p>
<p>å¨ä¹åçç« èä¸­ï¼æä»¬å·²å¤æ¬¡ä½¿ç¨ Want å®ç° Ability æèµ·æä½ï¼æ¬èå°ææ Want æ ¸å¿è½åç´æ¥å¨ <code>Index</code> é¡µæ¼ç¤ºï¼æ éé¢å¤è·³è½¬é¡µé¢ã</p>
<blockquote>
<p>æ ¸å¿è§èæç¤ºï¼ä» API 12 å¼å§ï¼å·²ä¸åæ¨èä¸æ¹åºç¨ä½¿ç¨æå® Ability æ¹å¼ï¼å³æ¾å¼ Wantï¼æèµ·å¶ä»åºç¨ï¼æ¨èä½¿ç¨æå®åºç¨é¾æ¥æ¹å¼ï¼ä¸ä¸èè®²ï¼ï¼ä½ä½ä¸ºå¼åèï¼æä»¬ä»éææ¡æ¾å¼/éå¼ Want çæ ¸å¿åçï¼ä»¥ä¾¿åºå¯¹åç±»ç»ä»¶éä¿¡åºæ¯ã</p>
</blockquote>
<p>ç¤ºæå¾å¦ä¸ï¼</p>
<p><img alt="StartAbilityè°ç¨åç" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730991/202602/3730991-20260212111315904-959814962.png" class="lazyload"></p>
<h2 id="ä¸want-æ ¸å¿æ¦å¿µä¸ç»æ">ä¸ãWant æ ¸å¿æ¦å¿µä¸ç»æ</h2>
<p>Want æ¯å¯¹è±¡ç±»åï¼æ ¸å¿å­æ®µå³å®ç»ä»¶å¹éä¸å¯å¨é»è¾ï¼å³é®å­æ®µåçº¦æå¦ä¸ï¼</p>
<h3 id="1-æ ¸å¿å­æ®µè§£æ">1. æ ¸å¿å­æ®µè§£æ</h3>
<table>
<thead>
<tr>
<th>å­æ®µå</th>
<th>ç±»å</th>
<th>æ ¸å¿ä½ç¨</th>
<th>å¿éæ§</th>
<th>æ ¸å¿è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>deviceId</code></td>
<td>string</td>
<td>ç®æ è®¾å¤ID</td>
<td>å¦</td>
<td>ç©ºå­ç¬¦ä¸²è¡¨ç¤ºæ¬æºï¼è·¨è®¾å¤åºæ¯éæå®è®¾å¤æ è¯ï¼éå¼ Want æä¸æ¯æè·¨è®¾å¤è°ç¨</td>
</tr>
<tr>
<td><code>bundleName</code></td>
<td>string</td>
<td>ç®æ åºç¨åå</td>
<td>æ¾å¼å¿é</td>
<td>æ¾å¼ Want å¿é¡»æå®</td>
</tr>
<tr>
<td><code>abilityName</code></td>
<td>string</td>
<td>ç®æ ç»ä»¶åç§°</td>
<td>æ¾å¼å¿é</td>
<td>æ¾å¼ Want æ ¸å¿å­æ®µï¼API 12+ è·¨åºç¨åºæ¯ä¸æ¨èä½¿ç¨</td>
</tr>
<tr>
<td><code>moduleName</code></td>
<td>string</td>
<td>ç®æ æ¨¡ååç§°</td>
<td>å¦</td>
<td>åä¸åºç¨å¤æ¨¡åå­å¨éåç»ä»¶æ¶ï¼éæå®ï¼å¦åé»è®¤å¹éç¬¬ä¸ä¸ªæ¨¡å</td>
</tr>
<tr>
<td><code>uri</code></td>
<td>string</td>
<td>ç»ä¸èµæºæ è¯ç¬¦</td>
<td>éå¼å¯é</td>
<td>æ ¼å¼ä¸º <code>scheme://host:port/path</code>ï¼èªå®ä¹ scheme ä¸å¯ä¸ç³»ç»åºç¨éå¤ï¼å¦ <code>ohos</code> åç¼ï¼</td>
</tr>
<tr>
<td><code>action</code></td>
<td>string</td>
<td>æä½æå¾</td>
<td>éå¼æ ¸å¿</td>
<td>å¸¸ç¨å¼ï¼<code>ohos.want.action.viewData</code>ï¼æ¥çæ°æ®ï¼ã<code>ohos.want.action.share</code>ï¼åäº«ï¼ã<code>ohos.want.action.search</code>ï¼æç´¢ï¼</td>
</tr>
<tr>
<td><code>entities</code></td>
<td>Array<string></string></td>
<td>ç»ä»¶ç±»å«çº¦æ</td>
<td>éå¼å¯é</td>
<td>å¸¸ç¨å¼ï¼<code>entity.system.browsable</code>ï¼æµè§å¨ç±»ç»ä»¶ï¼ã<code>entity.system.home</code>ï¼æ¡é¢åºç¨ï¼</td>
</tr>
<tr>
<td><code>type</code></td>
<td>string</td>
<td>æ°æ®MIMEç±»å</td>
<td>éå¼å¯é</td>
<td>å¦ <code>text/plain</code>ï¼çº¯ææ¬ï¼ã<code>image/png</code>ï¼PNGå¾çï¼ï¼éä¸ <code>uri</code> ååå¹é</td>
</tr>
<tr>
<td><code>parameters</code></td>
<td>Object</td>
<td>èªå®ä¹éå æ°æ®</td>
<td>å¦</td>
<td>æ¯æåºç¡æ°æ®ç±»åï¼å­ç¬¦ä¸²ãæ°å­ãå¸å°å¼ç­ï¼ï¼å¯éè¿ <code>linkFeature</code> å­æ®µæ è®°åè½ç±»åï¼éå¼å¹éæé«ä¼åçº§ï¼</td>
</tr>
<tr>
<td><code>flags</code></td>
<td>number</td>
<td>å¯å¨æ¨¡å¼æ è®°</td>
<td>å¦</td>
<td>ä» <code>FLAG_START_WITHOUT_TIPS</code> æ¯æéå¼ Want åæ¶âææ å¯ç¨æå¼æ¹å¼âå¼¹æ¡ï¼æ æ³åæ¶âæ¯å¦åè®¸è·³è½¬âç³»ç»å¼¹æ¡</td>
</tr>
</tbody>
</table>
<h3 id="2-want-çä¸¤ç§æ ¸å¿ç±»å">2. Want çä¸¤ç§æ ¸å¿ç±»å</h3>
<ul>
<li><strong>æ¾å¼ Want</strong>ï¼åæ¶æå® <code>bundleName</code> å <code>abilityName</code>ï¼ç´æ¥å®ä½ç®æ ç»ä»¶ï¼æ éç³»ç»éåå¹éï¼å¹éæçé«ãæ ç³»ç»å¼éã</li>
<li><strong>éå¼ Want</strong>ï¼ä¸æå® <code>abilityName</code>ï¼éè¿ <code>linkFeature</code>ã<code>action</code>ã<code>entities</code>ã<code>uri</code>ã<code>type</code> æè¿°æä½æå¾ï¼ç±ç³»ç»å¹éå£°æå¯¹åº <code>skills</code> çç»ä»¶ï¼<strong>éç¨äºè·¨åºç¨éç¨åè½è°ç¨</strong>ï¼å¦è°ç¨ç³»ç»åäº«ãæå¼æµè§å¨ï¼ã</li>
</ul>
<h3 id="3-éå¼-want-å¹éè§åæ ¸å¿éç¹">3. éå¼ Want å¹éè§åï¼æ ¸å¿éç¹ï¼</h3>
<h4 id="1å¹éåºç¡åæ">ï¼1ï¼å¹éåºç¡åæ</h4>
<p>éå¼ Want å¹éçåºç¡åæï¼è¥ <code>action</code>/<code>entities</code>/<code>uri</code>/<code>type</code>/<code>parameters(linkFeature)</code> äºä¸ªå±æ§åæªéç½®ï¼ç³»ç»ç´æ¥å¤å®å¹éå¤±è´¥ï¼æ éåç»­æ ¡éªã</p>
<h4 id="2å¹éä¼åçº§ä»é«å°ä½">ï¼2ï¼å¹éä¼åçº§ï¼ä»é«å°ä½ï¼</h4>
<p><code>linkFeatureï¼parameters åç½®å­æ®µï¼</code> â <code>action</code> â <code>entities</code> â <code>uri + type</code></p>
<blockquote>
<p><code>linkFeature</code> æ¯ HarmonyOS API 11+ æ°å¢çæé«ä¼åçº§å¹éå­æ®µï¼éè¿ <code>parameters</code> ä¼ éï¼ä¸é¨è§£å³ä¼ ç»éå¼å¹éèå´è¿å®½çé®é¢ï¼éç¨äºè·¨åºç¨åºå®åè½çç²¾åéå¼è°ç¨ã</p>
</blockquote>
<h4 id="3åæ­¥è¯¦ç»è§å">ï¼3ï¼åæ­¥è¯¦ç»è§å</h4>
<p>è¡¨æ ¼ä¸­ action å¼å¦ <code>abc</code> ä»ä¸ºè¡¨è¾¾å¹éï¼å·¥ç¨ä¸­åå¼è¦è§èã</p>
<h5 id="-linkfeature-å¹éæé«ä¼åçº§">â  linkFeature å¹éï¼æé«ä¼åçº§ï¼</h5>
<h6 id="æ ¸å¿å¹éå­æ®µåæ ¡éªé»è¾ç²¾åå¹éä¸ºå¯ä¸è§å">æ ¸å¿å¹éå­æ®µåæ ¡éªé»è¾ï¼ç²¾åå¹éä¸ºå¯ä¸è§åï¼</h6>
<table>
<thead>
<tr>
<th>æ ¡éªå­æ®µ</th>
<th>è§¦åæ ¡éªæ¡ä»¶</th>
<th>å¹éè§å</th>
<th>å¤±è´¥å¤å®</th>
</tr>
</thead>
<tbody>
<tr>
<td>linkFeature</td>
<td>è°ç¨æ¹ä¼ è¯¥åæ°åå¿æ ¡éª</td>
<td>éä¸ skills éç½®å¼å®å¨ä¸è´</td>
<td>éç½®å¼â è°ç¨æ¹å¼ï¼å¦ linkâ errLinkï¼</td>
</tr>
<tr>
<td>schemeï¼URIï¼</td>
<td>è°ç¨æ¹ä¼  uri åå¿æ ¡éª scheme</td>
<td>éä¸ uri ç scheme å®å¨ä¸è´</td>
<td>schemeâ uri ç schemeï¼å¦ httpsâ fileï¼</td>
</tr>
<tr>
<td>type</td>
<td>è°ç¨æ¹ä¼  type åå¿æ ¡éª</td>
<td>éä¸è°ç¨æ¹ type å®å¨ä¸è´</td>
<td>typeâ è°ç¨æ¹å¼ï¼å¦ text/plainâ image/pngï¼</td>
</tr>
</tbody>
</table>
<h6 id="ååºæ¯å¹éè§å">ååºæ¯å¹éè§å</h6>
<ol>
<li><strong>åºæ¯1ï¼ä»ä¼  linkFeatureï¼</strong>ï¼ä»æ ¡éª linkFeatureï¼scheme/type ä¸åä¸ï¼ä¸è´åæåï¼å¦åå¤±è´¥ï¼</li>
<li><strong>åºæ¯2ï¼ä¼  uri+linkFeatureï¼</strong>ï¼éåæ¶æ»¡è¶³ scheme å¹é + linkFeature å¹éï¼ä»»ä¸ä¸æ»¡è¶³åå¤±è´¥ï¼</li>
<li><strong>åºæ¯3ï¼ä¼  type+linkFeatureï¼</strong>ï¼éåæ¶æ»¡è¶³ type å¹é + linkFeature å¹éï¼ä»»ä¸ä¸æ»¡è¶³åå¤±è´¥ï¼</li>
<li><strong>åºæ¯4ï¼ä¼  uri+type+linkFeatureï¼</strong>ï¼éåæ¶æ»¡è¶³ scheme å¹é + type å¹é + linkFeature å¹éï¼ä»»ä¸ä¸æ»¡è¶³åå¤±è´¥ã</li>
</ol>
<h6 id="è¡¥åè¯´æ">è¡¥åè¯´æ</h6>
<ul>
<li>æ ééç¬¦ãåç¼å¹éç­å®½æ¾è§åï¼ææåä¸æ ¡éªçå­æ®µåä¸º<strong>ç²¾åå®å¨å¹é</strong>ï¼</li>
<li>è°ç¨æ¹æªä¼ çå­æ®µï¼å¦ uri/typeï¼ï¼skills ä¸­å¯¹åºå­æ®µä¸åä¸æ ¡éªï¼</li>
<li>æ âé¨åå¹éââéçº§å¹éâé»è¾ï¼ä»»ä¸éæ ¡éªå­æ®µä¸å¹éåæ´ä½å¤±è´¥ã</li>
</ul>
<h5 id="-action-å¹éè§å">â¡ action å¹éè§å</h5>
<table>
<thead>
<tr>
<th>è°ç¨æ¹ <code>want</code> ç <code>action</code></th>
<th>ç®æ æ¹ <code>skills.actions</code></th>
<th>å¹éç»æ</th>
<th>æ ¸å¿è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç©ºå¼ <code>action:""</code></td>
<td>ç©ºå¼ <code>actions: []</code></td>
<td>å¤±è´¥</td>
<td>åæ¹åæªå£°ææä½æå¾ï¼ç³»ç»æ æ³å¹é</td>
</tr>
<tr>
<td>ç©ºå¼ <code>action:""</code></td>
<td>éç©ºå¼ <code>actions: ["abc"]</code></td>
<td>æå</td>
<td>è°ç¨æ¹æªæå®æå¾ï¼ç®æ æ¹å£°æäºè½åï¼é»è®¤å¹é</td>
</tr>
<tr>
<td>éç©ºå¼ <code>action:"abc"</code></td>
<td>ç©ºå¼ <code>actions: []</code></td>
<td>å¤±è´¥</td>
<td>è°ç¨æ¹æå®äºæå¾ï¼ç®æ æ¹æªå£°æå¯¹åºè½å</td>
</tr>
<tr>
<td>éç©ºå¼ <code>action:"abc"</code></td>
<td>åå«è°ç¨æ¹ <code>actions: ["abc"]</code></td>
<td>æå</td>
<td>ç®æ æ¹å£°æçè½ååå«è°ç¨æ¹æå¾</td>
</tr>
<tr>
<td>éç©ºå¼ <code>action:"abc"</code></td>
<td>ä¸åå«è°ç¨æ¹ <code>actions: ["bcd"]</code></td>
<td>å¤±è´¥</td>
<td>ç®æ æ¹æªå£°æè°ç¨æ¹æéè½å</td>
</tr>
</tbody>
</table>
<h5 id="-entities-å¹éè§å">â¢ entities å¹éè§å</h5>
<table>
<thead>
<tr>
<th>è°ç¨æ¹ <code>entities</code></th>
<th>ç®æ æ¹ <code>skills.entities</code></th>
<th>å¹éç»æ</th>
<th>æ ¸å¿è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç©ºï¼<code>entities: []</code>ï¼</td>
<td>éç©ºï¼<code>entities: ["a","b"]</code>ï¼</td>
<td>æå</td>
<td>è°ç¨æ¹æªéå®ç»ä»¶ç±»å«ï¼ç®æ æ¹æ è®ºæ¯å¦å£°æç±»å«åå¹é</td>
</tr>
<tr>
<td>ç©ºï¼<code>entities: []</code>ï¼</td>
<td>ç©ºï¼<code>entities: []</code>ï¼</td>
<td>æå</td>
<td>è°ç¨æ¹æªéå®ç»ä»¶ç±»å«ï¼ç®æ æ¹æ è®ºæ¯å¦å£°æç±»å«åå¹é</td>
</tr>
<tr>
<td>éç©ºï¼<code>entities: ["a"]</code>ï¼</td>
<td>ç©ºï¼<code>entities: []</code>ï¼</td>
<td>å¤±è´¥</td>
<td>è°ç¨æ¹éå®äºç»ä»¶ç±»å«ï¼ç®æ æ¹æªå£°æä»»ä½ç±»å«</td>
</tr>
<tr>
<td>éç©ºï¼<code>entities: ["a","b"]</code>ï¼</td>
<td>åå«ææè°ç¨æ¹ï¼<code>entities: ["a","b","c"]</code>ï¼</td>
<td>æå</td>
<td>ç®æ æ¹å£°æçç±»å«å®å¨åå«è°ç¨æ¹éæ±</td>
</tr>
<tr>
<td>éç©ºï¼<code>entities: ["a","b"]</code>ï¼</td>
<td>æªåå«ææè°ç¨æ¹ï¼<code>entities: ["a","c"]</code>ï¼</td>
<td>å¤±è´¥</td>
<td>ç®æ æ¹å£°æçç±»å«ç¼ºå¤±è°ç¨æ¹æéç±»å«ï¼å¦è°ç¨æ¹è¦ <code>browsable</code>ï¼ç®æ æ¹ä»å£°æ <code>home</code>ï¼</td>
</tr>
</tbody>
</table>
<h5 id="-uri--type-å¹éè§åååæ ¡éª">â£ uri + type å¹éè§åï¼ååæ ¡éªï¼</h5>
<table>
<thead>
<tr>
<th>åºæ¯</th>
<th>è°ç¨æ¹éç½®</th>
<th>å¹éè§å</th>
</tr>
</thead>
<tbody>
<tr>
<td>åºæ¯1</td>
<td>uri ç©º + type ç©º</td>
<td>1. ç®æ æ¹ <code>skills.uris</code> ä¸ºç©º â æåï¼<br>2. ç®æ æ¹ <code>skills.uris</code> å­å¨ãscheme å type åç©ºãçåç´  â æåï¼<br>3. å¶ä»æåµ â å¤±è´¥</td>
</tr>
<tr>
<td>åºæ¯2</td>
<td>uri éç©º + type ç©º</td>
<td>1. ç®æ æ¹ <code>skills.uris</code> ä¸ºç©º â å¤±è´¥ï¼<br>2. ç®æ æ¹ <code>skills.uris</code> å­å¨ãuri å¹é + type ç©ºãçåç´  â æåï¼<br>3. åä¸¤æ­¥å¤±è´¥ä¸ uri ä¸ºæä»¶è·¯å¾ â æåç¼æ¨å¯¼ MIME ç±»åï¼å¹éç®æ æ¹ <code>type</code> â æå/å¤±è´¥</td>
</tr>
<tr>
<td>åºæ¯3</td>
<td>uri ç©º + type éç©º</td>
<td>1. ç®æ æ¹ <code>skills.uris</code> ä¸ºç©º â å¤±è´¥ï¼<br>2. ç®æ æ¹ <code>skills.uris</code> å­å¨ãscheme ç©º + type å¹éãçåç´  â æåï¼<br>3. å¶ä»æåµ â å¤±è´¥</td>
</tr>
<tr>
<td>åºæ¯4</td>
<td>uri éç©º + type éç©º</td>
<td>1. ç®æ æ¹ <code>skills.uris</code> ä¸ºç©º â å¤±è´¥ï¼<br>2. ç®æ æ¹ <code>skills.uris</code> å­å¨ãuri å¹é + type å¹éãçåç´  â æåï¼<br>3. å¶ä»æåµ â å¤±è´¥</td>
</tr>
</tbody>
</table>
<h6 id="type-åç¬å¹éè§åä»è°ç¨æ¹-type-éç©ºæ¶çæ">Type åç¬å¹éè§åï¼ä»è°ç¨æ¹ <code>type</code> éç©ºæ¶çæï¼</h6>
<p>Type å¹éæ ¸å¿ä¸º <strong>MIME åªä½ç±»åå¹é</strong>ï¼éµå¾ª HarmonyOS å®æ¹è§èï¼æ éçº§å¹éé»è¾ï¼è§åå¦ä¸ï¼</p>
<ol>
<li><strong>ç²¾åå¹éï¼æé«ä¼åçº§ï¼</strong>ï¼è°ç¨æ¹ <code>type</code> ä¸ç®æ æ¹ <code>skills.uris</code> ä¸­ <code>type</code> å®å¨ä¸è´ â å¹éæåï¼</li>
<li><strong>ééç¬¦å¹é</strong>ï¼ä»æ¯æãä¸»ç±»å/*ãæ ¼å¼ï¼ç®æ æ¹ <code>type</code> ä¸ºæ­¤æ ¼å¼ä¸è°ç¨æ¹ <code>type</code> å±äºè¯¥ä¸»ç±»åèç´ â æåï¼ä¸æ¯æ <code>*/å­ç±»å</code> æ ¼å¼ï¼</li>
<li><strong>å¹éå¤±è´¥åºæ¯</strong>ï¼
<ul>
<li>ç®æ æ¹ <code>type</code> ä¸ºå·ä½å¼ä½ä¸è°ç¨æ¹ <code>type</code> ä¸ä¸è´ï¼</li>
<li>ç®æ æ¹ <code>type</code> ééç¬¦æ ¼å¼ä¸è§èï¼</li>
<li>è°ç¨æ¹ <code>type</code> ä¸ºå¤å MIME ç±»åï¼ç®æ æ¹æ å¯¹åºéç½®ã</li>
</ul>
</li>
</ol>
<blockquote>
<p>è¡¥åè¯´æï¼Type å¹éä»å¨ãè°ç¨æ¹ä¼ é typeãä¸ãè¿å¥ uri+type ååæ ¡éªç¯èãæ¶è§¦åï¼è¥ç®æ æ¹ <code>type</code> ä¸ºç©ºï¼ä»å½è°ç¨æ¹ <code>type</code> ä¹ä¸ºç©ºæ¶å¹éæåã</p>
</blockquote>
<h6 id="uri-å¹éè§å">uri å¹éè§å</h6>
<p>URI å¹éä»¥ <code>scheme â host â port â è·¯å¾</code> ä¸ºæ ¸å¿å±çº§ï¼ä»å½åä¸çº§å¹ééè¿æ¶è§¦åä¸ä¸çº§æ ¡éªï¼ä»»ä¸å±çº§å¤±è´¥åæ´ä½ URI å¹éå¤±è´¥ï¼å·ä½è§åï¼</p>
<ol>
<li><strong>scheme å±çº§ï¼é¦éªå±çº§ï¼</strong>ï¼
<ul>
<li>ç®æ  URI é¡¹ <code>scheme</code> ä¸ºç©º â ä»è°ç¨æ¹ <code>uri</code> ä¸ºç©ºæ¶å¹éæåï¼å¦åå¤±è´¥ï¼</li>
<li>ç®æ  URI é¡¹ <code>scheme</code> éç©º â è°ç¨æ¹ <code>uri</code> ç <code>scheme</code> éä¸å¶å®å¨ä¸è´ï¼å¤§å°åææï¼å®æ¹å»ºè®®å¨å°åï¼ï¼å¦åå¤±è´¥ã</li>
</ul>
</li>
<li><strong>host å±çº§ï¼ä» scheme å¹éæååè§¦åï¼</strong>ï¼
<ul>
<li>ç®æ  URI é¡¹ <code>host</code> ä¸ºç©º â ç´æ¥å¹éæåï¼</li>
<li>ç®æ  URI é¡¹ <code>host</code> éç©º â è°ç¨æ¹ <code>uri</code> ç <code>host</code> éä¸å¶å®å¨ä¸è´ï¼å¦åå¤±è´¥ã</li>
</ul>
</li>
<li><strong>port å±çº§ï¼ä» scheme+host å¹éæååè§¦åï¼</strong>ï¼
<ul>
<li>ç®æ  URI é¡¹ <code>port</code> ä¸ºç©º â ç´æ¥å¹éæåï¼</li>
<li>ç®æ  URI é¡¹ <code>port</code> éç©º â è°ç¨æ¹ <code>uri</code> ç <code>port</code> éä¸å¶å®å¨ä¸è´ï¼æ°å­æ ¼å¼ï¼ï¼å¦åå¤±è´¥ã</li>
</ul>
</li>
<li><strong>è·¯å¾å±çº§ï¼ä» scheme+host+port å¹éæååè§¦åï¼</strong>ï¼<br>
æ <code>path â pathStartWith â pathRegex</code> ä¼åçº§æ ¡éªï¼ä»»ä¸è§åå¹éæååç»æ­¢æ ¡éªï¼å¨é¨å¤±è´¥å URI å¹éå¤±è´¥ï¼
<ul>
<li><strong>path ç²¾åå¹é</strong>ï¼ç®æ  URI é¡¹ <code>path</code> éç©º â è°ç¨æ¹ <code>uri</code> å¨è·¯å¾ä¸å¶å®å¨ä¸è´ â æåï¼å¦åè¿å¥ä¸ä¸çº§ï¼</li>
<li><strong>pathStartWith åç¼å¹é</strong>ï¼ç®æ  URI é¡¹ <code>pathStartWith</code> éç©º â è°ç¨æ¹ <code>uri</code> è·¯å¾åå«è¯¥åç¼ â æåï¼å¦åè¿å¥ä¸ä¸çº§ï¼</li>
<li><strong>pathRegex æ­£åå¹é</strong>ï¼ç®æ  URI é¡¹ <code>pathRegex</code> éç©º â è°ç¨æ¹ <code>uri</code> è·¯å¾ç¬¦åè¯¥æ­£åè¡¨è¾¾å¼ â æåï¼å¦å URI å¹éå¤±è´¥ï¼</li>
<li><strong>è·¯å¾å­æ®µåä¸ºç©º</strong>ï¼ç®æ  URI é¡¹ <code>path</code>ã<code>pathStartWith</code>ã<code>pathRegex</code> åä¸ºç©º â ç´æ¥å¹éæåã</li>
</ul>
</li>
</ol>
<blockquote>
<p>è¡¥åè¯´æï¼</p>
<ol>
<li>æå·¦ URI å¹éï¼ä»å½ç®æ  URI é¡¹ä»éç½® <code>scheme</code>/<code>scheme+host</code>/<code>scheme+host+port</code>ï¼è·¯å¾å­æ®µåä¸ºç©ºï¼æ¶çæï¼è°ç¨æ¹ <code>uri</code> éä»¥ç®æ éç½®ä¸ºåç¼ï¼</li>
<li>æä»¶ URI è§£æï¼<code>file://</code> å¼å¤´ç URIï¼ç³»ç»èªå¨è§£ææä»¶åç¼æ¨å¯¼ MIME ç±»åï¼ç¨äºè¡¥ååºæ¯2ç type å¹éï¼</li>
<li>URI æ ¼å¼è§èï¼èªå®ä¹ <code>scheme</code> ä¸å¯ä¸ç³»ç»åç½®ï¼<code>ohos</code>/<code>http</code>/<code>https</code>/<code>file</code>ï¼éå¤ã</li>
</ol>
</blockquote>
<h4 id="4å¹éç»æè¯´æ">ï¼4ï¼å¹éç»æè¯´æ</h4>
<p>æ ¹æ®ç³»ç»ä¸­å¾å¹éåºç¨ç»ä»¶çå¹éæåµä¸åï¼ä½¿ç¨éå¼ Want å¯å¨åºç¨ç»ä»¶æ¶ä¼åºç°ä»¥ä¸ä¸ç§æåµï¼</p>
<ul>
<li>æªå¹éå°æ»¡è¶³æ¡ä»¶çåºç¨ç»ä»¶ï¼å¯å¨å¤±è´¥ã</li>
<li>å¹éå°ä¸ä¸ªæ»¡è¶³æ¡ä»¶çåºç¨ç»ä»¶ï¼ç´æ¥å¯å¨è¯¥åºç¨ç»ä»¶ã</li>
<li>å¹éå°å¤ä¸ªæ»¡è¶³æ¡ä»¶çåºç¨ç»ä»¶ï¼UIAbilityï¼ï¼å¼¹åºéæ©æ¡è®©ç¨æ·éæ©ã</li>
</ul>
<h2 id="äºæ¬èå·¥ç¨">äºãæ¬èå·¥ç¨</h2>
<h3 id="ä¸å·¥ç¨åå»º">ï¼ä¸ï¼å·¥ç¨åå»º</h3>
<h4 id="1-è°ç¨æ¹å·¥ç¨wantandlinkingdemo">1. è°ç¨æ¹å·¥ç¨ï¼WantAndLinkingDemo</h4>
<ul>
<li>åºç¡éç½®ï¼HarmonyOS 5.0+ãAPI 18+ãStage æ¨¡åï¼</li>
<li>æ ¸å¿ç¨éï¼æ¼ç¤ºæ¾å¼/éå¼ Want å¯å¨ï¼</li>
<li>ååï¼<code>com.example.wantandlinkingdemo</code>ã</li>
</ul>
<h4 id="2-æ¥æ¶æ¹å·¥ç¨implicitreceiverdemo">2. æ¥æ¶æ¹å·¥ç¨ï¼ImplicitReceiverDemo</h4>
<ul>
<li>åºç¡éç½®ï¼HarmonyOS 5.0+ãAPI 18+ãStage æ¨¡åï¼</li>
<li>æ ¸å¿ç¨éï¼ä½ä¸ºè·¨åºç¨æ¾å¼/éå¼å¯å¨çç®æ åºç¨ï¼æ¥æ¶å¹¶å±ç¤ºä¼ éçåæ°ï¼</li>
<li>ååï¼<code>com.example.implicitreceiverdemo</code>ã</li>
</ul>
<h3 id="äºè°ç¨æ¹å·¥ç¨æ ¸å¿ç®å½ç»æ">ï¼äºï¼è°ç¨æ¹å·¥ç¨æ ¸å¿ç®å½ç»æ</h3>
<pre><code>WantAndLinkingDemo/                  # é¡¹ç®æ ¹ç®å½ï¼Wantå®æDemoï¼
ââ AppScope/                        # åºç¨å¨å±éç½®ç®å½ï¼å¤æ¨¡ååºç¨å±äº«ï¼
â  ââ resources/                    # åºç¨å¨å±èµæºæä»¶ï¼å¦å¨å±æ ·å¼ãå¤è¯­è¨å­ç¬¦ä¸²ï¼
â  ââ app.json5                     # åºç¨çº§éç½®æä»¶ï¼åºç¨åç§°ãçæ¬å·ç­ï¼
ââ entry/                           # ä¸»æ¨¡åç®å½ï¼æ ¸å¿ä»£ç æå¨ï¼
â  ââ src/
â  â  ââ main/                      # ä¸»ä»£ç ç®å½ï¼åºç¨è¿è¡çæ ¸å¿ä»£ç ï¼
â  â  â  ââ ets/                    # ArkTSä»£ç ç®å½ï¼é»è¾å®ç°æ ¸å¿ï¼
â  â  â  â  ââ entryability/        # ä¸»Abilityç®å½ï¼åºç¨å¥å£ï¼
â  â  â  â  â  ââ EntryAbility.ets  # åºç¨å¥å£Abilityï¼å¤çå¯å¨åå§åï¼
â  â  â  â  ââ pages/               # ä¸»Abilityå¯¹åºçé¡µé¢ç®å½
â  â  â  â     ââ Index.ets          # æ ¸å¿åè½é¡µï¼æ´åæ¾å¼/éå¼Wantå¯å¨æææ¡ä¾ï¼
â  â  â  ââ resources/              # æ¨¡åçº§èµæºç®å½ï¼é¡µé¢å¸å±ãå¾çãå±é¨æ ·å¼ï¼
â  â  â  ââ module.json5            # æ¨¡åéç½®æä»¶ï¼æ ¸å¿ï¼éç½®skillsãexportedç­ï¼
â  ââ build-profile.json5           # æ¨¡åæå»ºéç½®æä»¶ï¼ç¼è¯ãæååæ°ï¼
â  ââ hvigorfile.ts                 # æ¨¡åæå»ºèæ¬ï¼hvigoræå»ºä»»å¡éç½®ï¼
â  ââ obfuscation-rules.txt         # ä»£ç æ··æ·è§åæä»¶ï¼åå¸æ¶å å¯ä»£ç ï¼å¯éï¼
â  ââ oh-package.json5              # æ¨¡åä¾èµéç½®æä»¶ï¼ç¬¬ä¸æ¹åºãå·¥å·ä¾èµï¼
</code></pre>
<h3 id="ä¸éå¼æ¾ç¤ºæèµ·åºç¨ä¼ åç¤ºä¾">ï¼ä¸ï¼éå¼/æ¾ç¤ºæèµ·åºç¨ä¼ åç¤ºä¾</h3>
<h4 id="è°ç¨æ¹wantandlinkingdemo-indexets">è°ç¨æ¹ï¼WantAndLinkingDemo Index.ets</h4>
<p>æé Wantæ°æ®ï¼æ¼ç¤ºæ¾å¼/éå¼ä¸åæ¨¡å¼æèµ·åºç¨ï¼éè¿ä¸åå¹éè§åã</p>
<pre><code class="language-javascript">import { BusinessError } from '@ohos.base';
import { common, Want, wantConstant } from '@kit.AbilityKit';
import { hilog } from '@kit.PerformanceAnalysisKit';
import { promptAction } from '@kit.ArkUI';

const DOMAIN = 0xFF00;
const TAG = 'WantAndLinkingDemo';

@Entry
@Component
struct Index {
  // è·åUIAbilityä¸ä¸æ
  private context = this.getUIContext().getHostContext() as common.UIAbilityContext;

  build() {
    Column({ space: 15 }) {
      // é¡µé¢æ é¢
      Text('Want æ¾å¼/éå¼å¯å¨å®æï¼å¹éè§åä¿®æ­£çï¼')
        .fontSize(30)
        .fontWeight(FontWeight.Bold)
        .margin({ bottom: 30 })

      // 1. æ¾å¼Wantï¼ç²¾åå¹éï¼æ è§åé®é¢ï¼
      Button('1. æ¾å¼Wantè·¨åºç¨æèµ·ä¼ å')
        .width('80%')
        .height(50)
        .fontSize(18)
        .backgroundColor('#1890ff')
        .fontColor('#ffffff')
        .onClick(() =&gt; {
          this.crossAppExplicitStart();
        })

      // 2. éå¼Want - linkFeatureï¼æé«ä¼åçº§ï¼éç²¾åå¹éï¼
      Button('2. éå¼Want-linkFeatureå¹éï¼æé«ä¼åçº§ï¼')
        .width('80%')
        .height(50)
        .fontSize(18)
        .backgroundColor('#1890ff')
        .fontColor('#ffffff')
        .onClick(() =&gt; {
          this.implicitStartShare();
        })

      // 3. éå¼Want - actionåç¬å¹éï¼æ ¸å¿ï¼ä»ä¼ actionï¼æ å¶ä»å¹²æ°å­æ®µï¼
      Button('3. éå¼Want-actionåç¬å¹é')
        .width('80%')
        .height(50)
        .fontSize(18)
        .backgroundColor('#1890ff')
        .fontColor('#ffffff')
        .onClick(() =&gt; {
          this.implicitStartActionMatch();
        })

      // 4. éå¼Want - entitiesåç¬å¹é
      Button('4. éå¼Want-entitiesåç¬å¹é')
        .width('80%')
        .height(50)
        .fontSize(18)
        .backgroundColor('#1890ff')
        .fontColor('#ffffff')
        .onClick(() =&gt; {
          this.implicitStartEntitiesMatch();
        })

      // 5. éå¼Want - uri+typeååå¹éï¼æ ¸å¿ï¼ä»ä¼ uri+typeï¼ééç¨actionï¼
      Button('5. éå¼Want-uri+typeååå¹é')
        .width('80%')
        .height(50)
        .fontSize(18)
        .backgroundColor('#1890ff')
        .fontColor('#ffffff')
        .onClick(() =&gt; {
          this.implicitStartUriTypeMatch();
        })
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
    .backgroundColor('#f5f5f5')
  }

  /**
   * åºæ¯1ï¼æ¾å¼Want
   * è§åï¼æå®bundleName+abilityNameï¼æ éå¹éskillsï¼ä»éæ¥æ¶æ¹è®¾ç½® exported=true
   */
  private async crossAppExplicitStart() {
    try {
      const want: Want = {
        bundleName: "com.example.implicitreceiverdemo", // æ¥æ¶æ¹ååï¼å¿é¡»ä¸å®éä¸è´ï¼
        abilityName: "EntryAbility", // æ¥æ¶æ¹ç»ä»¶åï¼å¿é¡»ä¸å®éä¸è´ï¼
        parameters: {
          "shareContent": "æ¾å¼Wantæµè¯ï¼è·¨åºç¨ç²¾åä¼ éåå®¹",
          "linkFeature": "Explicit"
        }
      };

      await this.context.startAbility(want);
      hilog.info(DOMAIN, TAG, "æ¾å¼Wantè·¨åºç¨æèµ·æå");
    } catch (err) {
      const businessErr = err as BusinessError;
      promptAction.showToast({
        message: `å¯å¨å¤±è´¥ï¼${businessErr.message}`,
        duration: 3000
      });
    }
  }

  /**
   * åºæ¯2ï¼éå¼Want - linkFeatureï¼æé«ä¼åçº§ï¼
   * è§åï¼uriåtypeåä¸ºç©ºæ¶ï¼ä»æ ¡éªlinkFeatureç²¾åå¹é
   * è§åï¼uriætypeä¸ä¸ºç©ºæ¶ï¼éåæ¶æ»¡è¶³linkFeatureç²¾åå¹é + uriçschemeå¹é + typeç²¾åå¹é
   */
  private async implicitStartShare() {
    const want: Want = {
      uri: "data://com.example.wantandlinkingdemo/share/text", // scheme/hostéå¹é
      type: "text/plain", // å¿é¡»ç²¾åå¹é
      parameters: {
        shareContent: "éå¼Wantæµè¯ï¼linkFeatureå¹éæåï¼",
        linkFeature: "Share" // æé«ä¼åçº§ï¼æ¥æ¶æ¹å¿é¡»ç²¾åéç½®
      },
    };

    try {
      await this.context.startAbility(want);
      hilog.info(DOMAIN, TAG, "éå¼Want(linkFeature)è·¨åºç¨æèµ·æå");
    } catch (error) {
      const businessErr = error as BusinessError;
      hilog.error(DOMAIN, TAG, `linkFeatureå¹éå¤±è´¥ï¼${businessErr.message}`);
      promptAction.showToast({
        message: 'å¯å¨å¤±è´¥ï¼æªå¹éå°æ¯æåäº«çåºç¨',
        duration: 3000
      });
    }
  }

  /**
   * åºæ¯3ï¼éå¼Want - actionåç¬å¹é
   * è§åï¼è°ç¨æ¹actionéå¹éæ¥æ¶æ¹skillsä¸­çactionéç½®
   */
  private async implicitStartActionMatch() {
    const want: Want = {
      action: 'ohos.want.action.viewData',
      parameters: {
        "shareContent": "éå¼Wantæµè¯ï¼actionå¹éæåï¼",
      }
    };

    try {
      await this.context.startAbility(want);
      hilog.info(DOMAIN, TAG, "éå¼Want(action)è·¨åºç¨æèµ·æå");
    } catch (error) {
      const businessErr = error as BusinessError;
      hilog.error(DOMAIN, TAG, `actionå¹éå¤±è´¥ï¼${businessErr.message}`);
      promptAction.showToast({
        message: 'å¯å¨å¤±è´¥ï¼æªå¹éå°æ¯ææ¥çæ°æ®çåºç¨',
        duration: 3000
      });
    }
  }
  
  /**
   * åºæ¯4ï¼éå¼Want - entitieså¹é
   * entitieså¹éè§åï¼è°ç¨æ¹ä¼ éçææentitieså¼ï¼éè¢«ç®æ æ¹skills.entitieså®å¨åå«æå¹éæåï¼æ¬ç¤ºä¾ä¸º"abc"ï¼
   * ç³»ç»æ åå¼åèï¼entity.system.browsableï¼æµè§å¨ç±»å«ï¼å¤çç½é¡µé¾æ¥ï¼ãentity.system.homeï¼åºç¨ä¸»å¥å£ç»ä»¶ï¼
   */
  private async implicitStartEntitiesMatch() {
    const want: Want = {
      action: 'ohos.want.action.viewData', // æ¥çæ°æ®
      entities: ["abc"],
      parameters: {
        "shareContent": "éå¼Wantæµè¯ï¼entitieså¹éæåï¼",
      }
    };

    try {
      await this.context.startAbility(want);
      hilog.info(DOMAIN, TAG, "éå¼Want(entities)è·¨åºç¨æèµ·æå");
    } catch (error) {
      const businessErr = error as BusinessError;
      hilog.error(DOMAIN, TAG, `entitieså¹éå¤±è´¥ï¼${businessErr.message}`);
      promptAction.showToast({
        message: 'å¯å¨å¤±è´¥ï¼æªå¹éå°æµè§å¨ç±»åºç¨',
        duration: 3000
      });
    }
  }

  /**
   * åºæ¯5ï¼éå¼Want - uri+typeååå¹é
   * æ ¸å¿ï¼éåæ¶æ»¡è¶³uriå±çº§å¹éï¼schemeâhostâportâè·¯å¾ï¼ + typeç²¾åå¹é
   */
  private async implicitStartUriTypeMatch() {
    const want: Want = {
      action: 'ohos.want.action.viewData',
      uri: "data://com.implicitreceiverdemo:8080/detail/page123",
      type: "text/plain",
      flags: wantConstant.Flags.FLAG_START_WITHOUT_TIPS // åæ¶å¤±è´¥å¼¹çªæç¤º
    };

    try {
      await this.context.startAbility(want);
      hilog.info(DOMAIN, TAG, "éå¼Want(uri+type)è·¨åºç¨æèµ·æå");
    } catch (error) {
      const businessErr = error as BusinessError;
      hilog.error(DOMAIN, TAG, `uri+typeå¹éå¤±è´¥ï¼${businessErr.message}`);
      promptAction.showToast({
        message: 'å¯å¨å¤±è´¥ï¼æªå¹éå°ç¬¦åuri+typeè§åçåºç¨',
        duration: 3000
      });
    }
  }
}
</code></pre>
<h5 id="2æ¥æ¶æ¹implicitreceiverdemo">ï¼2ï¼æ¥æ¶æ¹ï¼ImplicitReceiverDemo</h5>
<p>è·¨åºç¨æ¥æ¶è°ç¨æ¹Wantä¼ éçåæ°ï¼æèµ·ç»ä»¶åAbilityæ¥æ¶åæ°åçï¼æ¬èä¸åç¤ºä¾æ¼ç¤ºï¼</p>
<pre><code class="language-javascript">import { AbilityConstant, UIAbility, Want } from '@kit.AbilityKit';
import { hilog } from '@kit.PerformanceAnalysisKit';
import { ConfigurationConstant } from '@kit.AbilityKit';
import { window } from '@kit.ArkUI';

const DOMAIN = 0x0000;
const TAG = 'ImplicitReceiverDemo';

export default class EntryAbility extends UIAbility {
  onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void {
    hilog.info(DOMAIN, TAG, '%{public}s', 'ImplicitReceiverDemo onCreate è§¦å');
    try {
      // è§£æ Want ä¸­çåæ°ï¼æ¾å¼ä¼ éç data + éå¼ä¼ éç shareContentï¼
      const parameters = want.parameters as Record&lt;string, Object&gt;;
      // å­å¨åæ°å° AppStorageï¼ä¾ UI é¡µé¢å±ç¤ºï¼é»è®¤å¼é¿åç©ºæ¾ç¤ºï¼
      AppStorage.setOrCreate("shareContent", parameters["shareContent"] || 'æªæ¥æ¶åäº«æ°æ®');

      // è®¾ç½®åºç¨é¢è²æ¨¡å¼ï¼å¯éï¼ä¿æç³»ç»é»è®¤ï¼
      this.context.getApplicationContext().setColorMode(ConfigurationConstant.ColorMode.COLOR_MODE_NOT_SET);
    } catch (err) {
      hilog.error(DOMAIN, TAG, 'Failed to set colorMode. Cause: %{public}s', JSON.stringify(err));
    }
  }

  /**
   * å·²å¯å¨æ¶æ¥æ¶æ°ç Want åæ°ï¼å¦éå¼å¯å¨å¤æ¬¡è§¦åï¼
   */
  onNewWant(want: Want, launchParam: AbilityConstant.LaunchParam): void {
    hilog.info(DOMAIN, TAG, '%{public}s', 'ImplicitReceiverDemo onNewWant è§¦å');
    const parameters = want.parameters as Record&lt;string, Object&gt;;
    // æ´æ°åæ°ï¼å®æ¶åæ­¥å° UI é¡µé¢ï¼
    AppStorage.setOrCreate("shareContent", parameters["shareContent"] || 'æªæ¥æ¶åäº«æ°æ®');
    // æå°æ¥æ¶çåæ°
    console.log(`ImplicitReceiverDemo æ¥æ¶åæ°ï¼${JSON.stringify(want.parameters)}`);
  }

  /**
   * å è½½ UI é¡µé¢
   */
  onWindowStageCreate(windowStage:  window.WindowStage): void {
    windowStage.loadContent('pages/Index', (err) =&gt; {
      if (err.code) {
        hilog.error(DOMAIN, TAG, 'Failed to load the content. Cause: %{public}s', JSON.stringify(err));
        return;
      }
      hilog.info(DOMAIN, TAG, 'Succeeded in loading the content: Index');
    });
  }
}
</code></pre>
<h6 id="-æ¥æ¶æ¹indexetså±ç¤ºè·¨åºç¨æ¥æ¶çåæ°">â¡ æ¥æ¶æ¹ï¼Index.etsï¼å±ç¤ºè·¨åºç¨æ¥æ¶çåæ°ï¼</h6>
<pre><code class="language-javascript">@Entry
@Component
struct Index {
  @StorageProp('shareContent') shareContent: string = 'éå¼/æ¾å¼åäº«æ°æ®æªæ¥æ¶';

  build() {
    Column({ space: 20 }) {
      Text('ImplicitReceiverDemoï¼åæ°æ¥æ¶ï¼')
        .fontSize(25)
        .fontWeight(FontWeight.Bold)
        .margin({ bottom: 10 })

      Text(`æ¥æ¶çåå®¹ï¼${this.shareContent}`)
        .fontColor(Color.Red)
        .fontSize(18)
        .textWrap(true)
        .padding(10)
    }.justifyContent(FlexAlign.Center)
    .height('100%')
    .width('100%')
    .padding(20)
  }
}
</code></pre>
<h6 id="-æ¥æ¶æ¹modulejson5éç½®">â¢ æ¥æ¶æ¹ï¼module.json5éç½®</h6>
<pre><code class="language-json">{
  "module": {
    "name": "entry",
    "type": "entry",
    "description": "$string:module_desc",
    "mainElement": "EntryAbility",
    "deviceTypes": [
      "phone"
    ],
    "deliveryWithInstall": true,
    "installationFree": false,
    "pages": "$profile:main_pages",
    "abilities": [
      {
        "name": "EntryAbility",
        "srcEntry": "./ets/entryability/EntryAbility.ets",
        "description": "$string:EntryAbility_desc",
        "icon": "$media:layered_image",
        "label": "$string:EntryAbility_label",
        "startWindowIcon": "$media:startIcon",
        "startWindowBackground": "$color:start_window_background",
        "exported": true, // å¿é¡»å¼å¯ï¼åè®¸å¤é¨åºç¨è°ç¨ï¼æ¾å¼/éå¼åéï¼
        "skills": [
          {
            // åºç¡æè½ï¼æ¡é¢åºç¨ï¼é»è®¤éç½®ï¼
            "entities": ["entity.system.home"],
            "actions": ["ohos.want.action.home"]
          },
          // åºæ¯2ï¼linkFeatureå¹éè§å
          {
            "uris": [
              {
                "scheme": "data",
                "host": "com.example.wantandlinkingdemo",
                "type": "text/plain",
                "linkFeature": "Share"
              }
            ]
          },
          // åºæ¯3ï¼actionåç¬å¹éè§å
          {
            "actions": ["ohos.want.action.viewData"]
          },
          // åºæ¯4ï¼entitiesåç¬å¹éè§å
          {
            "actions": ["ohos.want.action.viewData"],
            "entities": ["abc"]
          },
          // åºæ¯5ï¼uri+typeååå¹éè§å
          {
            "actions": ["ohos.want.action.viewData"],
            "uris": [
              {
                "scheme": "data",                   // åè®®å¿é¡»å®å¨ä¸è´
                "host": "com.implicitreceiverdemo", // ååéå®æ´å¹é
                "port": "8080",                     // ç«¯å£ä¸å¯çç¥
                "path": "detail/page123",            // è·¯å¾éå®å¨ä¸è´æä½¿ç¨ééç¬¦
                "type": "text/plain"                // MIMEç±»åéä¸¥æ ¼å¹é
              }
            ]
          }
        ]
      }
    ],
    "extensionAbilities": [
      {
        "name": "EntryBackupAbility",
        "srcEntry": "./ets/entrybackupability/EntryBackupAbility.ets",
        "type": "backup",
        "exported": false,
        "metadata": [
          {
            "name": "ohos.extension.backup",
            "resource": "$profile:backup_config"
          }
        ]
      }
    ]
  }
}
</code></pre>
<h4 id="è¿è¡ç»æ">è¿è¡ç»æ</h4>
<p><img alt="Wantæ¾å¼éå¼æèµ·åºç¨" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730991/202602/3730991-20260212113449846-351657293.gif" class="lazyload"></p>
<p><img alt="Wantæ¾å¼/éå¼æèµ·åºç¨" loading="lazy" data-src="./%E8%B5%84%E6%BA%90%E5%9B%BE%E7%89%87/Want%E6%98%BE%E5%BC%8F%E9%9A%90%E5%BC%8F%E6%8B%89%E8%B5%B7%E5%BA%94%E7%94%A8.gif" class="lazyload"></p>
<h2 id="åå¼åæ ¸å¿è§èä¸é¿åæå">åãå¼åæ ¸å¿è§èä¸é¿åæå</h2>
<h3 id="1-æ ¸å¿çº¦æ">1. æ ¸å¿çº¦æ</h3>
<ul>
<li>ææå¯¹å¤æä¾è°ç¨ç Abilityï¼æ¾å¼/éå¼ï¼ï¼å¿é¡»å¨ <code>module.json5</code> ä¸­éç½® <code>exported: true</code>ï¼å¦åæ æ³è¢«å¤é¨è°ç¨ï¼</li>
<li>èªå®ä¹ scheme ä¸å¯ä¸ç³»ç»åç½® schemeï¼å¦ <code>ohos</code>ã<code>http</code>ã<code>https</code>ã<code>file</code>ï¼éå¤ï¼å»ºè®®éç¨âåºç¨æ è¯+åè½âå½åï¼å¦ <code>harmonydemo</code>ï¼ï¼</li>
<li>éå¼ Want è¥ä½¿ç¨ <code>linkFeature</code> å¹éï¼<code>actions</code> å­æ®µå¯å¿½ç¥ï¼ä½¿ç¨ <code>action/entities/uri+type</code> å¹éæ¶ï¼å¯¹åºå­æ®µä¸å¯ä¸ºç©ºã</li>
</ul>
<h3 id="2-é¿åæå">2. é¿åæå</h3>
<table>
<thead>
<tr>
<th>é®é¢ç°è±¡</th>
<th>ææ¥/è§£å³æ¹æ³</th>
</tr>
</thead>
<tbody>
<tr>
<td>éå¼å¯å¨å¹éå¤±è´¥</td>
<td>æ£æ¥ <code>linkFeature</code>ã<code>action</code>ã<code>entities</code>ã<code>uri</code>ã<code>type</code> æ¯å¦ä¸æ¥æ¶æ¹éç½®ä¸è´ï¼å°¤å¶æ¯ <code>scheme</code>ã<code>host</code> å¤§å°åï¼å»ºè®®å¨å°åï¼ï¼</td>
</tr>
<tr>
<td>åæ°ä¼ éå¤±è´¥</td>
<td>ç¡®ä¿ä¼ éçåæ°ä¸ºåºç¡æ°æ®ç±»åï¼é¿åä¼ éå¤æå¯¹è±¡ï¼ï¼æ¥æ¶æ¹éè¿ <code>want.parameters</code> è§£ææ¶éåç±»åæ­è¨ï¼</td>
</tr>
<tr>
<td>è·¨åºç¨æ¾å¼å¯å¨å¤±è´¥</td>
<td>ç¡®è®¤ç®æ åºç¨å·²å®è£ã<code>bundleName</code> å <code>abilityName</code> éç½®æ­£ç¡®ï¼ä¸ç®æ  Ability å·²è®¾ç½® <code>exported: true</code>ï¼</td>
</tr>
<tr>
<td>uri å¹éå¤±è´¥</td>
<td>æ <code>schemeâhostâportâè·¯å¾</code> å±çº§éä¸æ ¡éªï¼è·¯å¾å¹éä¼åç²¾åå¹éï¼åç¼/æ­£åå¹ééç¡®ä¿è§åæ­£ç¡®ã</td>
</tr>
</tbody>
</table>
<h2 id="äºåå®¹æ»ç»">äºãåå®¹æ»ç»</h2>
<ol>
<li>æ ¸å¿è½½ä½ï¼Want æ¯ç»ä»¶é´éä¿¡çæ ¸å¿è½½ä½ï¼æ¾å¼ Want ç¨äºè·¨åºç¨ç²¾åå¯å¨ï¼éå¼ Want ç¨äºè·¨åºç¨éç¨åè½è°ç¨ï¼</li>
<li>éå¼å¹éè§åï¼æ <code>linkFeatureâactionâentitiesâuri+type</code> ä¼åçº§æ ¡éªï¼ååºå­æ®µå¹éå¤±è´¥åæ´ä½å¤±è´¥ï¼ææåä¸å¹éçå­æ®µåä¸ºç²¾åå¹éï¼uriè·¯å¾é¤å¤ï¼ï¼</li>
<li>éç½®å³é®ï¼å¯¹å¤è°ç¨ç Ability éè®¾ <code>exported: true</code>ï¼éå¼å¯å¨éä¿è¯è°ç¨æ¹ Want å­æ®µä¸æ¥æ¶æ¹ <code>skills</code> éç½®å®å¨ä¸è´ï¼</li>
<li>å®è·µååï¼æåºæ¯éæ©å¹éè§åï¼éè§å¼å¸¸å¤çåç¨æ·ä½éªï¼éµå¾ª API 12+ è§èï¼ä¼åä½¿ç¨åºç¨é¾æ¥æ¿ä»£æ¾å¼ Wantï¼ã</li>
</ol>
<h2 id="å­ä»£ç ä»åº">å­ãä»£ç ä»åº</h2>
<ul>
<li>è°ç¨æ¹å·¥ç¨ï¼WantAndLinkingDemo</li>
<li>æ¥æ¶æ¹å·¥ç¨ï¼ImplicitReceiverDemo</li>
<li>ä»åºå°åï¼<a href="https://gitee.com/HarmonyOS-UI-Basics/harmony-os-ui-basics.git" target="_blank" rel="noopener nofollow">https://gitee.com/HarmonyOS-UI-Basics/harmony-os-ui-basics.git</a></li>
</ul>
<h2 id="ä¸ä¸èé¢å">ä¸ãä¸èé¢å</h2>
<p>ä¸ä¸èæä»¬å°å­¦ä¹  <strong>Deep Linking ä¸ App Linking åºç¨é¾æ¥</strong> çå®æ´éç½®ä¸è°ç¨ï¼éç¹åæ¬ï¼</p>
<ol>
<li>ææ¡ Deep Linking èªå®ä¹ scheme éç½®ã<code>openLink</code> è°ç¨å <code>canOpenLink</code> æ ¡éªï¼</li>
<li>ææ¡ App Linking HTTPS ååéç½®ãååæ ¡éªãåæ°è§£æåæªå®è£åºç¨çéçº§å¤çï¼</li>
<li>ææ° Deep Linking ä¸ App Linking çå®å¨æ§ãéç¨åºæ¯æ ¸å¿å·®å¼ï¼è½æééåï¼</li>
<li>ææ¡åºç¨é¾æ¥ä¸ Want ç»åçæä½³å®è·µï¼å®ç°è·¨åºç¨éä¿¡çè§£è¦ä¸é«å®å¨æ§ã</li>
</ol>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.009722222222222222" data-date-updated="2026-02-12 11:55">2026-02-12 11:41</span>&nbsp;
<a href="https://www.cnblogs.com/san-xiu">é¸¿è-æ£ä¿®</a>&nbsp;
éè¯»(<span id="post_view_count">45</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19607664);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19607664', targetLink: 'https://www.cnblogs.com/san-xiu/p/19607664', title: 'é¸¿èåºç¨å¼åUIåºç¡ç¬¬å­è:Wantæèµ·åºç¨è·³è½¬ä¼ åå¹éè§åå®æ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ è®¤è¯åºåé¾åæ¯ç¹å¸ï¼ä¸ï¼ï¼ä½é¢ä¸å°ç¥¨ ]]></title>
    <link>https://www.cnblogs.com/ofnoname/p/19592966</link>
    <guid>36c5037283fade73b6a4ee1e338e8c6f</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ofnoname/p/19592966" title="åå¸äº 2026-02-12 11:07">
    <span role="heading" aria-level="2">è®¤è¯åºåé¾åæ¯ç¹å¸ï¼ä¸ï¼ï¼ä½é¢ä¸å°ç¥¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>è¿ç¯æç« ä¸è°ä»·æ ¼æ¶¨è·åæèµè®¨è®ºãåªåä¸ä»¶äºï¼ææ¯ç¹å¸çåºæ¬åçè®²æ¸æ¥ãè¯»å®ä½ åºè¯¥è½çæåºåæµè§å¨éä¸ç¬äº¤æçâè¾å¥/è¾åºâï¼è½çè§£ä¸ºä»ä¹å¨æ²¡æé¶è¡çæåµä¸ï¼æ¯ç¹å¸ä¹è½ç»´æ¤ä½é¢åæ¯ä»ã</p>
<p>éè¦çåç½®ç¥è¯ä¸å¤ï¼ä½ åªéè¦äºè§£ä¸ä»¶åºç¡æ¦å¿µå³å¯ï¼<strong>å¬é¥/ç§é¥ä¸æ°å­ç­¾åï¼ç§é¥åâç­¾åç« âï¼ç¨æ¥è¯æä½ ææè±é±ï¼</strong>ã<strong>åå¸ï¼åæ°æ®æçº¹ï¼</strong>ãä»¥å<strong>åå¸å¼ç³»ç»çå¥é¨æ¦å¿µ</strong>ãè¿ä¸æ¯å¯ç å­¦è¯¾ç¨ï¼æä»¥æä»¬ä¸ä¼æ¨å¯¼æ°å­¦è¯æï¼åªç¨ç´è§åä¾å­ææºå¶è®²æç½ã</p>
<h2 id="æ¯ç¹å¸æ¯ä»ä¹">æ¯ç¹å¸æ¯ä»ä¹ï¼</h2>
<p>å¨å®æ´çè§£<strong>æ¯ç¹å¸æ¯ä¸ä¸ªå»ä¸­å¿åçè´¦æ¬/äº¤ææ°æ®åº/æ¯ä»ç³»ç»</strong>ä¹åï¼ä½ å¯ä»¥åææ¯ç¹å¸å½æï¼<strong>ä¸ä»½å¬å¼çãå¨ç½åæ­¥çâåå²è®°å½â</strong>ï¼ä¸é¢åªåä¸¤ç±»ä¿¡æ¯âââåªäºé±è¿æ²¡è¢«è±æâåâè¿äºé±æªæ¥éè¦æ»¡è¶³ä»ä¹æ¡ä»¶æåè®¸è¢«è±âãä»»ä½äººé½å¯ä»¥ä¿å­ä¸ä»½å¯æ¬ï¼è¿è¡èç¹ï¼ï¼å¹¶ç¨åä¸å¥å¬å¼è§åæ£æ¥ï¼æ°æ¥çè®°å½ææ²¡æä½å¼ãææ²¡æåè±ãææ²¡æä¼ªé ç­¾åãå®ä¸åé¶è¡ç³»ç»é£æ ·ç±æä¸ªæºæç»´æ¤âè´¦æ·ä½é¢è¡¨âï¼æ´åä¸ä¸ªç­çº§å±åç»´æ¤çå±äº«è®°è´¦æ¬ï¼æ²¡æç­é¿è½åæ¹é¢æ¹åæ°ï¼æ¯ä¸ªäººé½å¯ä»¥æ¿è§åå¯¹ç§æ£æ¥ãä¸è¿è¿ä¸ªâå±äº«è´¦æ¬ä¸ºä»ä¹ä¸ä¼ä¹±ãä¸ºä»ä¹æåå¤§å®¶è½æ¶æå°åä¸ä»½çæ¬ãä¸ºä»ä¹æäººæ¿æä»åºææ¬æ¥ç»´æ¤å®âï¼è¦å°åé¢è®²å®ç½ç»è§åä¸æç¿æºå¶åï¼ä½ æä¼å½»åºåéââèä»å¤©æä»¬åä»æåºå±çâé±çå½¢æâå¼å§ï¼UTXOã</p>
<h2 id="æ¯ç¹å¸ä¸åºåé¾çå³ç³»">æ¯ç¹å¸ä¸åºåé¾çå³ç³»</h2>
<p><strong>åºåé¾ï¼blockchainï¼</strong>ï¼ä»å­é¢ä¸çå°±æ¯âåºåç»æçé¾âãå®æ¯ä¸ç§æ°æ®ç»ç»æ¹å¼ï¼æä¸æ¹è®°å½æåæâåºåâï¼åç¨åå¸ææ°åºåååä¸ä¸ªåºåé¾æ¥èµ·æ¥ï¼è®©åå²è®°å½æ´é¾è¢«ææç¯¡æ¹ãä½ å¯ä»¥æå®çè§£ä¸ºä¸ç§âææ¶é´é¡ºåºè£è®¢æåãæ¯é¡µé½çäºåä¸é¡µæçº¹âçè´¦æ¬ç»æã</p>
<p>è <strong>æ¯ç¹å¸ï¼Bitcoinï¼</strong>ï¼æ¯ä¸å¥è¿è¡å¨äºèç½ä¸çç³»ç»ï¼åè®® + è½¯ä»¶ + èç¹ç½ç» + è§åï¼ï¼å®<strong>ç¨åºåé¾æ¥ä¿å­äº¤æåå²</strong>ï¼å¹¶ç¨ä¸å¥å¬å¼è§åè®©å¨ç½å¨âåªäºäº¤æææãåªäºåºåç®æ°âä¸è¾¾æä¸è´ãæ¢å¥è¯è¯´ï¼<strong>åºåé¾æ¯æ¯ç¹å¸ä½¿ç¨çä¸ç§è´¦æ¬ç»æï¼ä½æ¯ç¹å¸ä¸ä»ä»æ¯åºåé¾</strong>ââå®è¿æäº¤ææ ¼å¼ãéªè¯è§åãç½ç»ä¼ æ­ãæç¿æ¿å±ç­ä¸æ´å¥æºå¶ãå¨æ¯ç¹å¸ç³»ç»éï¼è¯è¯­ <strong>æ¯ç¹å¸ï¼bitcoin / BTCï¼</strong>ï¼è¿ä¸ªè¯ä¹æ¯è¿ä¸ªç³»ç»éçâè®°è´¦åä½/èµäº§âã</p>
<p>æ¯ç¹å¸æ¯åºåé¾ææ³ææ©çå¤§è§æ¨¡æåè½å°ä¹ä¸ï¼å æ­¤å½±ååæå¤§ãçæææçï¼ä½åºåé¾åæ¥è¢«è®¸å¤ç³»ç»éç¨å¹¶æå±äºç¨éï¼ä¸æ­¢åè½¬è´¦ï¼è¿å°è¯åæ´éç¨çâå¯éªè¯è®°å½âï¼ï¼å¦<strong>ä»¥å¤ªåï¼Ethereumï¼</strong>ãåæ¶ä¹åºç°äºå¤§éåºäºæ¯ç¹å¸ææ¯çå¿µè¡çåºæ¥çå¶ä»å¸ç§ä¸ç³»ç»ï¼å¦<strong>è±ç¹å¸ï¼Litecoinï¼</strong>ã<strong>é¨ç½å¸ï¼Moneroï¼</strong>ã</p>
<h2 id="utxoæ¯ç¹å¸éçé±">UTXOï¼æ¯ç¹å¸éçâé±â</h2>
<p>å¨æ¯ç¹å¸éï¼âä½ æå¤å°é±âä¸æ¯åå¨æå¼ <strong>è´¦æ·ä½é¢è¡¨</strong>ä¸ï¼èæ¯æ£è½å¨è´¦æ¬åå²éçä¸å âå°ç¥¨âãè¿äºå°ç¥¨çæ­£å¼åå­å«ï¼</p>
<p><strong>UTXOï¼Unspent Transaction Outputï¼æªè±è´¹äº¤æè¾åºï¼</strong>ï¼ä¸ç¬äº¤æäº§ççæ¯ä¸ªâè¾åºï¼outputï¼âï¼åªè¦è¿æ²¡æè¢«åç»­äº¤æè±æï¼å°±å¤äºâæªè±è´¹âç¶æï¼å®å°±æ¯ä¸ä¸ª UTXOã</p>
<p>æä»¥é±åéæ¾ç¤ºçâä½é¢âï¼æ¬è´¨ä¸æ¯ï¼</p>
<blockquote>
<p><strong>ä½ ææ§å¶çç§é¥ï¼è½å¤è§£éçä¸ç» UTXO çæ»åã</strong></p>
</blockquote>
<p>è¿éæä¸ä¸ªéå¸¸å³é®ä½å®¹æå¿½ç¥çç¹ï¼UTXO ä¸æ¯âè®°å¨ä½ åä¸çä½é¢âï¼èæ¯âå¸¦çä½¿ç¨æ¡ä»¶çä»·å¼çæ®µâãè¿ä»½âä½¿ç¨æ¡ä»¶âéå¸¸ä¼æåæä¸ªå¬é¥åå¸ï¼ä¹å°±æ¯æä»¬æ¥å¸¸çå°çâå°åâï¼ï¼æææ¯ï¼<strong>æªæ¥æ³è±è¿ç¬é±çäººï¼å¿é¡»æ¿åºè½æ»¡è¶³æ¡ä»¶çè¯æï¼éå¸¸å°±æ¯ç­¾åï¼</strong>ã</p>
<p><img src="https://img2024.cnblogs.com/blog/1545207/202602/1545207-20260212111529650-1331403071.png" alt="image" loading="lazy"></p>
<h3 id="utxo-éå°åºåå«äºä»ä¹">UTXO éå°åºåå«äºä»ä¹</h3>
<p>æ UTXO å½æâå°ç¥¨âï¼è¿å¼ å°ç¥¨ä¸è³å°åäºä¸¤æ ·æéè¦çä¸è¥¿ï¼</p>
<ol>
<li><strong>éé¢ï¼valueï¼</strong>ï¼æ¯å¦ 0.5 BTC</li>
<li><strong>éå®æ¡ä»¶ï¼locking conditionï¼</strong>ï¼ä¾å¦âè½æä¾æä¸ªå¬é¥å¯¹åºçææç­¾åçäººæè½è±âï¼å¨è¿ä¸ªåºæ¯ä¸ï¼å¯ä»¥ç®åç±»æ¯æ®éæ¯ä»ç³»ç»ï¼çè§£ä¸ºâé±å±äºè°âï¼ã</li>
</ol>
<h3 id="utxo-ä»åªéæ¥äº¤æè¾åºå¦ä½åæå¯è±çå°ç¥¨">UTXO ä»åªéæ¥ï¼äº¤æè¾åºå¦ä½åæâå¯è±çå°ç¥¨â</h3>
<p>UTXO çæ¥æºéå¸¸æ´ç´ ï¼<strong>æ¯ä¸ç¬äº¤æçæ¯ä¸ä¸ªè¾åºï¼é½æå¯è½åææªæ¥ç UTXO</strong>ã</p>
<p>ä¸¾ä¸ªæç®åçâæ¶æ¬¾âåºæ¯ï¼</p>
<ul>
<li>
<p>å°ææ¥æèªå·±çå¬é¥åç§é¥ï¼ä»æèªå·±çå¬é¥ï¼å³æ¶æ¬¾å°åï¼ç»å°çº¢</p>
</li>
<li>
<p>å°çº¢çæä¸ç¬äº¤æï¼å¨äº¤æéåä¸ä¸ªè¾åºï¼</p>
<ul>
<li>éé¢ï¼0.5 BTC</li>
<li>éå®æ¡ä»¶ï¼åªè½ç±âå°æçå¬é¥âå¯¹åºçç§é¥è±æ</li>
</ul>
</li>
<li>
<p>è¿ç¬äº¤æä¸æ¦è¢«ç½ç»æ¥åå¹¶æç»åè¿åºåé¾åå²éï¼è¿ä¸ªè¾åºå°±æäºä¸ä¸ª UTXO</p>
</li>
<li>
<p>å°æçé±åä¹æä»¥âçå°ä½é¢å¢å âï¼æ¯å ä¸ºå®æ«æç½ç»åå²è®°å½æ¶åç°ï¼âæä¸å¼ æ°çå°ç¥¨éç»æï¼èä¸è¿æ²¡è¢«è±æâãé±åå¹¶ä¸æ¯ä»âæä¸ªä¸­å¿æå¡å¨âè¯»åä½é¢ï¼èæ¯å¨æ¬å°ï¼æéè¿æå¡ï¼æ ¹æ®åå²è®°å½æ¨å¯¼âåªäº UTXO å±äºæâãä¹åï¼å°æä¹å¯ä»¥è±æè¿ä¸ª UTXOï¼ä¹åªæä»å¯ä»¥è±ï¼å ä¸ºåªæä»ææ¶æ¬¾å¬é¥å¯¹åºçç§é¥ï¼ã</p>
</li>
</ul>
<h2 id="utxo-çè±è´¹åæ¾é¶">UTXO çè±è´¹åæ¾é¶</h2>
<p>ä½ ä¸è½âä»ä¸ä¸ª UTXO éåªè±ä¸é¨åâãè±å®çæ¹å¼åªæä¸ç§ï¼æ´å¼ ç¨æãç¸æ¯å¾®ä¿¡æ¯ä»ï¼è¿å¶å®æ´ç±»ä¼¼ç°éæ¯ä»ï¼ä½ ç¨ä¸å¼  100 å»ä¹° 30 çä¸è¥¿ï¼æ¶é¶å°ä¸ä¼âæçº¸å¸åªæ 30âï¼èæ¯æ¶èµ° 100ï¼åæ¾ä½  70ã</p>
<p>æ¯ç¹å¸äº¤æä¹æ¯åæ ·çé»è¾ï¼</p>
<ul>
<li><strong>è¾å¥ï¼inputsï¼</strong>ï¼ä½ è¿æ¬¡åå¤âç¨æâçè¥å¹²å¼ æ§å°ç¥¨ï¼æ§ UTXOï¼</li>
<li><strong>è¾åºï¼outputsï¼</strong>ï¼è¿æ¬¡äº¤æâæ°çæâçè¥å¹²å¼ æ°å°ç¥¨ï¼æ°ç UTXOï¼</li>
</ul>
<p>ä¸ä¸ªå¸åçç®åæ¯ä»å ä¹æ»ä¼åºç°ä¸¤ä¸ªè¾åºï¼</p>
<ol>
<li><strong>ç»æ¶æ¬¾äºº</strong>ï¼æ¯å¦ç»å°çº¢ 0.7 BTCï¼éç»å°çº¢çæ¡ä»¶ï¼</li>
<li><strong>æ¾é¶ç»èªå·±</strong>ï¼æ¯å¦æ¾å 0.399 BTCï¼éç»å°æèªå·±çå¦ä¸ä¸ªå°åï¼</li>
</ol>
<p>ç»å¤§å¤æ°æ¶åï¼ä¸ç¬æ¯ä»æ»ä¼ææ¾é¶ãä½ å¨åºåæµè§å¨éçå°âä¸ç¬äº¤æè¾åº 2 ä¸ªâæ¶ï¼åæå«ä¹å°±æ¯âä»æ¬¾ + æ¾é¶âã</p>
<p><img src="https://img2024.cnblogs.com/blog/1545207/202602/1545207-20260212104533493-1727523767.png" alt="å¸åç UTXO äº¤æé¾æ¡" loading="lazy"></p>
<h3 id="æç»­è´¹">æç»­è´¹</h3>
<p>ä¸ç¬æ¯ä»åæ³çåºæ¬é»è¾æ¯ï¼<strong>è¾å¥éé¢æ»å &gt;= è¾åºéé¢æ»å</strong>ï¼å³ä½ ä¸è½å¤è±ï¼å½ç¶ä½ å¯ä»¥å°è±ï¼ä¸è¿æ²¡äººä¼ä¸»å¨æèªå·±çé±ä¸¢äºï¼ã</p>
<p>æ´å¤çæ¶åï¼è¾å¥è¾åºçéé¢å·®è¢«ä½ä¸º<strong>æç»­è´¹</strong>ã</p>
<blockquote>
<p><strong>æç»­è´¹ = è¾å¥éé¢æ»å â è¾åºéé¢æ»å</strong></p>
</blockquote>
<p>å®ä¸æ¯åå¨æä¸ªâæç»­è´¹å­æ®µâéï¼èæ¯ç±å·®é¢èªç¶å½¢æçã</p>
<ul>
<li>
<p>å°ææéæä¸¤å¼  UTXOï¼0.6 BTC å 0.5 BTCï¼å± 1.1 BTCï¼</p>
</li>
<li>
<p>å°æè¦ä»ç»å°çº¢ 0.7 BTC</p>
</li>
<li>
<p>å°æåå»ºäº¤æï¼</p>
<ul>
<li>è¾å¥ï¼0.6 + 0.5</li>
<li>è¾åºï¼0.7 ç»å°çº¢ + 0.399 ç»èªå·±</li>
</ul>
</li>
<li>
<p>è¾å¥æ»é¢ 1.1ï¼è¾åºæ»é¢ 1.099ï¼å·®é¢ 0.001 BTC</p>
</li>
<li>
<p>è¿ 0.001 BTC å°±æ¯æç»­è´¹ã<strong>æç»­è´¹æ¬è´¨ä¸å°±æ¯âä½ å°æ¾åæ¥çé£ç¹é¶é±â</strong>ã</p>
</li>
</ul>
<p>ä¸ºä»ä¹ä¸å¨é¨æ¾é¶ç»èªå·±ï¼èæ¯è¦çä¸äºæç»­è´¹å¢ï¼è¿ç±»ä¼¼äºç°å®æ¶è´¹çäº¤ç¨ãçåºä¸äºé±ä½ä¸ºäº¤æè´¹å¯ä»¥è®©ç¿å·¥æ´æ¿ææåè¿æ¬¡äº¤æï¼æå©äºç»´æ¤æ´ä¸ªæ¯ç¹å¸ç½ç»çè¿è¡ã</p>
<h3 id="é²åè±èç¹ç»´æ¤-utxo-set">é²âåè±âï¼èç¹ç»´æ¤ UTXO Set</h3>
<p>æ²¡æé¶è¡ï¼è°æ¥é²æ­¢åä¸ç¬é±è¢«è±ä¸¤æ¬¡ï¼</p>
<p>æ¯ä¸ªå¨èç¹é½å¨æ£æ¥åä¸ªæ³è¢«ç¡®è®¤çäº¤æçåæ³æ§ï¼<strong>é½å¨ç»´æ¤ä¸ä»½âå½åï¼ææäººï¼ä»ç¶æªè±è´¹çå°ç¥¨æ¸åâââUTXO Setã</strong></p>
<p>å½èç¹æ¶å°ä¸ç¬æ°äº¤ææ¶ï¼å®åçæ ¸å¿æ£æ¥ä¹ä¸å°±æ¯ï¼</p>
<ol>
<li>è¿ç¬äº¤æå¼ç¨çæ¯ä¸ä¸ªè¾å¥ï¼å¯¹åºçé£å¼ æ§å°ç¥¨ï¼æ§ UTXOï¼ççå­å¨åï¼</li>
<li>å®è¿å¨ UTXO Set éåï¼ï¼å¦æä¸å¨ï¼è¯´ææ©å°±è¢«è±è¿äºï¼æèåæ ¹ä¸å­å¨ï¼</li>
<li>ä½ æ¯å¦æä¾äºæ»¡è¶³éå®æ¡ä»¶çè¯æï¼ç­¾åç­ï¼ï¼</li>
<li>éé¢æ¯å¦æ­£ç¡®ï¼ï¼ä¸è½å¤è±ï¼</li>
</ol>
<p>ä¸æ¦è¿ç¬äº¤æè¢«æ¥åå¹¶æç»è¿å¥åºåï¼èç¹å°±ä¼æ´æ°èªå·±ç UTXO Setï¼</p>
<ul>
<li>æè¢«è±æçæ§ UTXO ä»éåéç§»é¤</li>
<li>æäº¤ææ°äº§çç outputs å è¿éåé</li>
</ul>
<p>è¿éæ²¡æä»»ä½âä¸­å¿è£å¤âãæ¯ä¸ªèç¹é½å¨ååä¸å¥ç¡®å®æ§çæ£æ¥ï¼æä»¥âåè±âä¸æ¯é âç¸ä¿¡æä¸ªæºæâè§£å³çï¼èæ¯é âææäººæè§åéªç®âè§£å³çã</p>
<p><img src="https://img2024.cnblogs.com/blog/1545207/202602/1545207-20260212105542420-446956606.png" alt="image" loading="lazy"></p>
<p>ä¸ä¸ª UTXO åªè½è±è´¹ä¸æ¬¡ï¼å æ­¤æäºäº¤æ 2 åï¼äº¤æ 3 å°±æ¯éæ³çï¼ä¸è½è¢«ç¡®è®¤äºï¼é¤éä½ ç´æ¥ä¸¢å¼äº¤æ 2ï¼åæ¢å°äº¤æ 3ï¼ã</p>
<h2 id="utxo-vs-ä½é¢è´¦æ¬">UTXO vs ä½é¢è´¦æ¬</h2>
<p>éå¸¸çè§£çæ¯ä»ç³»ç»ï¼åæ¬é¶è¡ãæ¯ä»å®/å¾®ä¿¡ï¼æ´åâè´¦æ·æ¨¡åâï¼ç»´æ¤ä¸å¼ è¡¨ï¼åçâå¼ ä¸ä½é¢ 100âãè½¬è´¦æ¶å°±æ¯æä¸ä¸ªè´¦æ·åãå¦ä¸ä¸ªè´¦æ·å ã</p>
<p>æ¯ç¹å¸ä¸è¿ä¹åãå®æ´åâç¥¨æ®æ¨¡åâï¼è´¦æ¬ä¸åâä½ æå¤å°é±âï¼èæ¯åâåªäºç¥¨æ®è¿æ²¡ç¨æï¼ä»¥åæ¯å¼ ç¥¨æ®çä½¿ç¨æ¡ä»¶âãæè°âä½é¢âï¼æ¯ä½ æâèªå·±è½è§£éçæææªè±è´¹ç¥¨æ®ï¼UTXOï¼âå æ»åºæ¥çç»æã</p>
<p>è¿ä¸¤ç§æ¨¡åå¹¶æ²¡æç»å¯¹ä¼å£ï¼ä½å¯¹çè§£æ¯ç¹å¸æ¥è¯´å¾å³é®ï¼</p>
<ul>
<li>
<p>å¨è´¦æ·æ¨¡åéï¼âä½é¢âæ¯ç³»ç»çæ¾å¼å­æ®µï¼</p>
</li>
<li>
<p>å¨ UTXO æ¨¡åéï¼âä½é¢âæ¯ä»åå²è®°å½æ¨å¯¼åºæ¥çï¼å æ­¤é±åéè¦æ«æ/åæ­¥/ç´¢å¼ï¼ã</p>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/1545207/202602/1545207-20260212110631731-1587525664.png" alt="image" loading="lazy"></p>
<h3 id="å½±åä¸utxo-è¶ç¢è±é±è¶é">å½±åä¸ï¼UTXO è¶ç¢ï¼è±é±è¶âéâ</h3>
<p>UTXO æ¨¡åæä¸ªå¾ç°å®çå¯ä½ç¨ï¼å¦æä½ ç UTXO å¾ç¢ï¼ä»æ¬¾æ¶å¯è½éè¦æ¼å¾å¤å¼ âå°ç¥¨âãèæ¯å¤ç¨ä¸ä¸ªè¾å¥ï¼å°±è¦å¨äº¤æéå¤åä¸æ®µâæå¼ç¨çæ¯åªå¼ æ§ç¥¨æ® + æå¦ä½è§£éå®âçæ°æ®ï¼äº¤æä½ç§¯éå¸¸ä¼åå¤§ãä½ç§¯åå¤§ï¼ç¿å·¥æåçææ¬ä¹æ´é«ï¼äºæ¯ä½ å¾å¾éè¦ä»æ´é«çæç»­è´¹ï¼äº¤æææ´å®¹æè¢«å°½å¿«ç¡®è®¤ã</p>
<p>æä»¥åæ ·æ¯âè½¬ 0.7 BTCâï¼ææ¶ä½ åªéè¦ 1 ä¸ªè¾å¥ï¼æ°å¥½æä¸å¼  0.7 çç¥¨æ®ï¼ï¼ææ¶å´éè¦ 10 ä¸ªè¾å¥ï¼åå¼  0.07 çç¢ç¥¨æ®ï¼ã<br>
è¿å°±æ¯ä¸ºä»ä¹å¾å¤é±åä¼å¨åéçæ¶ååâåå¹¶ UTXOâï¼æå¤å¼ ç¢ç¥¨æ®æ´åææ´å°çãé¢é¢æ´åéçç¥¨æ®ï¼ï¼ä»ä½éªä¸çå°±åâæ´çé¶é±âã</p>
<h3 id="å½±åäºéç§çº¿ç´¢">å½±åäºï¼éç§çº¿ç´¢</h3>
<p>ç»å¤§å¤æ°äº¤æé½ä¼å­å¨æ¾é¶ãä¸ç¬âä»æ¬¾âå¸¸å¸¸ä¼æä¸¤ä¸ªè¾åºââç»å¯¹æ¹ + æ¾é¶ç»èªå·±ãç°å®éè¿æ¯å¸¸è¯ï¼ä½å¨é¾ä¸å®ä¼åæçº¿ç´¢ï¼æè§èå¯ä»¥å°è¯çæµåªä¸ªè¾åºæ¯æ¾é¶ï¼ä»èæå¤ç¬äº¤æä¸²æâåä¸ä¸ªäºº/åä¸é±åâçè¡ä¸ºè½¨è¿¹ã</p>
<p>æ©æé±åä¹æä»¥å¾åäºææ¾é¶æå°ä¸ä¸ªâæ°å°åâï¼é¨ååå å°±æ¯ä¸ºäºåå°âæææè¡ä¸ºé½ç»å¨åä¸ä¸ªå°åä¸âçææ¾çè¿¹ââä½æ³¨æï¼è¿å¹¶ä¸ç­äºçæ­£å¿åï¼äº¤ææ¬èº«æ¯å¬å¼å¯æ¥çï¼å°åä¹é´ä»å¯è½è¢«å¯åå¼è§åå³èãå æ­¤ï¼æ¯ç¹å¸ç"å¿åä¸å®å¨"å¹¶ä¸è½è®©äººé«ææ å¿§ãä»æ´åâååå¶âèä¸æ¯âå¿åå¶âï¼ä½ ä¸åå§åï¼ä½ä½ åäºå¯è¢«åæçè¡ä¸ºè½¨è¿¹ãå¶ä¸­çæ»é²é»è¾é¨éå¾æ·±ï¼è¿éä¸è®²ã</p>
<h2 id="æ¥çä¸ä¸ªå¸åç-utxo">æ¥çä¸ä¸ªå¸åç UTXO</h2>
<p>æå¾å¤ç½ç«é½å¯ä»¥æ¥çæ¯ç¹å¸ä¸»é¾çä¿¡æ¯ãä»¥ <a href="https://mempool.space" target="_blank" rel="noopener nofollow">mempool.space</a> ä¸ºä¾å­ï¼</p>
<p>æä»¬éæéæ©ä¸ä¸ªå·²ç»ç¡®è®¤çåºåãåä¸æ»å¨ï¼å°±å¯ä»¥çå°æ¬åºåç¡®è®¤çææäº¤æï¼æ¯ä¸ªäº¤æå¼ç¨ä¸ä¸ªæå¤ä¸ª UTXOï¼å¹¶çææ°ç UTXOï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1545207/202602/1545207-20260211214405360-554665115.png" alt="image" loading="lazy"></p>
<p>ä¸å¾ä¸­æéææªåäºä¸¤ç¬äº¤æï¼ä¸ãä¸åä¸ç¬ï¼ã</p>
<p>åçç¬¬ä¸ç¬äº¤æï¼äº¤æåå¸ä»¥ <code>fb2628a7â¦</code> å¼å¤´ï¼ãå®åªæ <strong>1 ä¸ªè¾å¥</strong>ï¼æ¥èªå°å <code>bc1qvtdvvâ¦zdd70msz</code>ï¼éé¢ 0.03382740 BTCãè¿è¡¨ç¤ºï¼æ­¤åè´¦æ¬éå­å¨ä¸å¼ é¢é¢ 0.03382740 BTCãéç»è¿ä¸ªå°åçâæ§å°ç¥¨âï¼ç°å¨è¢«è¿ç¬äº¤ææ´å¼ ç¨æäºãç¶åå®çæäº 2 ä¸ªè¾åºï¼ä¸ä¸ªè¾åºè½¬å°å°å <code>3NCU3KvXâ¦W5tm3</code>ï¼éé¢ 0.00089565 BTCï¼å¦ä¸ä¸ªè¾åºååå°äº <code>bc1qvtdvvâ¦zdd70msz</code>ï¼éé¢ 0.03229910 BTCãè¿å°±æ¯å¸åçâ<strong>ä»æ¬¾ + æ¾é¶</strong>âï¼åèæ¯ä»ç»å¯¹æ¹çéé¢ï¼åèæ¯æ¾åç»èªå·±çé¶é±ãé¡µé¢å³ä¸è§èè²æ¡æ¾ç¤ºè¿ç¬äº¤æç è¾åºæ»é¢ä¸º 0.03319475 BTCï¼ä¹å°±æ¯ä¸¤ç¬è¾åºç¸å ï¼ã</p>
<p>è¿ç¬äº¤æçæç»­è´¹ï¼è¾å¥æ¯ 0.03382740ï¼è¾åºæ¯ 0.03319475ï¼ç¸åå¾å° 0.00063265 BTCï¼æ¢ç®æ satoshi å°±æ¯ 63,265 satsï¼BTC æ¯æ¯ç¹å¸ï¼è Satoshi æ¯æ¯ç¹å¸ç³»ç»çæå°åä½ï¼1 BTC ç­äº 1äº¿ Satoshiï¼ãäº¤æéæç»­è´¹å¾å¾ä¸æ¯ä¸ä¸ªåç¬çå­æ®µï¼èæ¯ç±âå°æ¾åæ¥çé¶é±âèªç¶å½¢æçã</p>
<p>åçç¬¬äºç¬äº¤æï¼äº¤æåå¸ä»¥ <code>d9195032â¦</code> å¼å¤´ï¼ãå®æ 2 ä¸ªè¾å¥ï¼èä¸ä¸¤å¼ æ§å°ç¥¨é½æ¥èªåä¸ä¸ªå°å <code>bc1qvtdvvâ¦zdd70msz</code>ï¼éé¢åå«æ¯ 0.00003777 BTC å 0.00642833 BTCãä¸¤å¼ å èµ·æ¥è¾å¥æ»é¢æ¯ 0.00646610 BTCãå®åæ ·äº§çäº 2 ä¸ªè¾åºï¼ä¸ä¸ªè¾åºå° <code>bc1qzgqfâ¦njp90rhl</code>ï¼éé¢ 0.00004840 BTCï¼è¿æ¯ä»æ¬¾ï¼ï¼å¦ä¸ä¸ªè¾åºå <code>bc1qvtdvvâ¦zdd70msz</code>ï¼éé¢ 0.00578845 BTCï¼è¿æ¾ç¶æ¯æ¾é¶ï¼ãè¾åºæ»é¢ 0.00583685 BTCï¼é¡µé¢å³ä¸èæ¡ï¼ï¼å æ­¤æç»­è´¹å°±æ¯ 0.00646610 â 0.00583685 = 0.00062925 BTC = 62,925 satsã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.008333333333333333" data-date-updated="2026-02-12 11:19">2026-02-12 11:07</span>&nbsp;
<a href="https://www.cnblogs.com/ofnoname">Ofnoname</a>&nbsp;
éè¯»(<span id="post_view_count">181</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19592966);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19592966', targetLink: 'https://www.cnblogs.com/ofnoname/p/19592966', title: 'è®¤è¯åºåé¾åæ¯ç¹å¸ï¼ä¸ï¼ï¼ä½é¢ä¸å°ç¥¨' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Docker Composeé¨ç½²å¤.NETåç«¯API+å¤Vueåç«¯Web å®æ´è®°å½ï¼å«å¤æ°æ®åºæ©å±+å®ç¨åºæ¯ï¼äº²æµæ åï¼ ]]></title>
    <link>https://www.cnblogs.com/huyong/p/19607257</link>
    <guid>077a78a2a0d0f0863473d4a98ac87b8a</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huyong/p/19607257" title="åå¸äº 2026-02-12 10:44">
    <span role="heading" aria-level="2">Docker Composeé¨ç½²å¤.NETåç«¯API+å¤Vueåç«¯Web å®æ´è®°å½ï¼å«å¤æ°æ®åºæ©å±+å®ç¨åºæ¯ï¼äº²æµæ åï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260212102740614-1259695947.png" alt="Docker Composeé¨ç½²å¤.NETåç«¯API+å¤Vueåç«¯Web å®æ´è®°å½ï¼å«å¤æ°æ®åºæ©å±+å®ç¨åºæ¯ï¼äº²æµæ åï¼" class="desc_img">
        æ¬æä»ç»å¨Linux æå¡å¨ä¸ï¼åºäº Docker Compose é¨ç½²å¤.NET åç«¯ API ä¸å¤ Vue åç«¯ Web çæ¹æ¡ï¼è§£å³å¤æå¡ç«¯å£å²çªãéç½®æ··ä¹±é®é¢ï¼ééä¸ªäººæµè¯ãå°åé¡¹ç®é¨ç½²åºæ¯ã
åå®æç¯å¢åå¤ï¼å®è£éç½® Docker CEãåçº§ Docker Compose è³ V2ï¼éç½®éåå éï¼æ´çæå¡å¨ç®å½ç»æå¹¶ä¸ä¼ æ¬å°æåæä»¶ãæ ¸å¿éè¿ docker-compose.yml ç¼æ MySQL/Redis/ å¤åç«¯ / å¤åç«¯ / Nginx æå¡ï¼åå© Nginx å®ç°åç«¯ä»£çååç«¯ API åæµï¼è®¾ç½®å¥åº·æ£æ¥ä¿éæå¡å¯å¨é¡ºåºãæ­¤å¤ï¼æä¾ PostgreSQLãSQL Server æ°æ®åºæ¿æ¢æ¹æ¡ï¼ä»éä¿®æ¹ç¼ææä»¶ååç«¯è¿æ¥ä¸²ï¼æ éè°æ´åç«¯ä¸ Nginx éç½®ï¼å¨ç¨å¯å¤ç°ï¼ä¾¿äºæ©å±æå¡æ°éã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ¥ä¸ç¯æç« ï¼<a href="http://www.rdiframework.net/article/detail/772191512834117" target="_blank" rel="noopener nofollow">Linux Docker Compose é¨ç½².NET+Vue+MySQL+Redis+Nginx å®æ´è®°å½ï¼äº²æµæ åï¼</a></p>
<p>åå¨åé¢ï¼å¨å®éå¼ååæµè¯ä¸­ï¼ç»å¸¸ä¼éå°éè¦å¨åä¸å°æå¡å¨é¨ç½²å¤ä¸ªåç«¯APIï¼å¦ä¸»æå¡+éå±æå¡ãæµè¯æå¡+çäº§æå¡ï¼åå¤ä¸ªåç«¯Webï¼å¦ç®¡çç«¯+ç¨æ·ç«¯ãPCç«¯+ç§»å¨ç«¯ééçï¼çåºæ¯ãåçº¯é docker runå½ä»¤éä¸ªå¯å¨å®¹å¨ï¼ä¼é¢ä¸´ç«¯å£å²çªãéç½®æ··ä¹±ãç»´æ¤å°é¾ç­é®é¢ã</p>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260212102640551-992507078.png" alt="å°é¢" loading="lazy"></p>
<p>æ¬æåºäºDocker Composeï¼å®ç°ã2ä¸ªåä»¥ä¸.NET8åç«¯API + 2ä¸ªåä»¥ä¸Vueåç«¯Webãçå®¹å¨åé¨ç½²ï¼æ ¸å¿è§£å³ç«¯å£éç¦»ãéç½®ç»ä¸ãNginxåæµç­é®é¢ï¼åæ¶æ©å±PostgreSQLãSQL Serverä¸¤ç§æ°æ®åºçæ¿æ¢æ¹æ¡ï¼è¡¥åå¤ä¸ªå®ç¨é¨ç½²åºæ¯ï¼å¦å­ååè®¿é®ãHTTPSãæ¥å¿éä¸­ï¼ï¼å¨ç¨äº²æµå¯å¤ç°ï¼ç¨äºåææ¥éï¼ä¹å¸æè½å¸®å°æåæ ·éæ±çåè¡ã</p>
<p>éç¨åºæ¯ï¼ä¸ªäººæµè¯ãå°åé¡¹ç®å¤æå¡é¨ç½²ãä¼ä¸åé¨å¤ç¯å¢ï¼æµè¯+å¼åï¼é¨ç½²ï¼å¯çµæ´»æ©å±æå¡æ°éï¼æ ééæ°æ­å»ºæ´ä½ç¯å¢ã</p>
<h1 id="ä¸é¨ç½²ç¯å¢åå¤æåç¡®è®¤é¿åå¼å®¹é®é¢">ä¸ãé¨ç½²ç¯å¢åå¤ï¼æåç¡®è®¤ï¼é¿åå¼å®¹é®é¢ï¼</h1>
<h2 id="1-æå¡å¨ç¯å¢éç¨æµè¯å°åçäº§åéç¨">1. æå¡å¨ç¯å¢ï¼éç¨ï¼æµè¯/å°åçäº§åéç¨ï¼</h2>
<ul>
<li>
<p>ç³»ç»ï¼CentOS 7.9ï¼æå°åå®è£ï¼å·²éç½®éæIPï¼192.168.1.100ï¼æ¿æ¢ä¸ºèªèº«æå¡å¨çå®IPï¼</p>
</li>
<li>
<p>åå­ï¼8Gï¼å»ºè®®ä¸ä½äº4Gï¼å¤æå¡åæ¶è¿è¡éè¶³å¤åå­ï¼é¿åå¡é¡¿ï¼</p>
</li>
<li>
<p>ç¡¬çï¼100Gï¼å­æ¾å¤ä¸ªæå¡çéåãæåæä»¶ãæ°æ®åºæ°æ®ï¼é¢çåä½ï¼</p>
</li>
<li>
<p>ç½ç»ï¼è½è®¿é®å¤ç½ï¼åææåéåãå®è£ä¾èµï¼åæå¯æ­ç½è¿è¡ï¼è¥åç½æå¡å¨ï¼æååå¤ç¦»çº¿éåï¼</p>
</li>
<li>
<p>æéï¼rootç¨æ·ï¼æå·å¤Dockerãç®å½æä½æéçæ®éç¨æ·ï¼çäº§ç¯å¢å»ºè®®ç¨æ®éç¨æ·ï¼</p>
</li>
</ul>
<h2 id="2-è½¯ä»¶çæ¬å¨ç¨ç»ä¸é¿åå¼å®¹é®é¢">2. è½¯ä»¶çæ¬ï¼å¨ç¨ç»ä¸ï¼é¿åå¼å®¹é®é¢ï¼</h2>
<ul>
<li>
<p>Dockerï¼Docker CE 24.0.7ï¼CentOS7ç¨³å®çï¼å¼å®¹æ§å¼ºï¼</p>
</li>
<li>
<p>Docker Composeï¼V2.27.1ï¼æ¯ææ°çéç½®ï¼è§£å³å¤æå¡ä¾èµãå¥åº·æ£æ¥å¼å®¹é®é¢ï¼</p>
</li>
<li>
<p>åç«¯ï¼.NET 8ï¼æ¬å°VS2022åå¸ä¸ºpublishæä»¶å¤¹ï¼æ æºç ï¼å¤åç«¯éåç¬åå¸ï¼</p>
</li>
<li>
<p>åç«¯ï¼Vue3ï¼æ¬å°yarn/npmæåä¸ºdistæä»¶å¤¹ï¼æ æºç ï¼å¤åç«¯éåç¬æåï¼</p>
</li>
<li>
<p>æ°æ®åºï¼å¤çæ¬å¯éï¼ï¼MySQL 8.0ãPostgreSQL 15ãSQL Server 2022ï¼Dockeréåï¼æ°æ®æä¹åï¼</p>
</li>
<li>
<p>ç¼å­ï¼Redis 7-alpineï¼è½»éçï¼å ç¨èµæºå°ï¼ééå¤æå¡å±äº«/éç¦»ç¼å­ï¼</p>
</li>
<li>
<p>ä»£çï¼Nginx alpineï¼è½»éçï¼å®ç°å¤åç«¯ä»£çãå¤åç«¯åæµï¼</p>
</li>
</ul>
<h2 id="3-æ¬å°åå¤æä»¶æåæåä¸ä¼ å°æå¡å¨">3. æ¬å°åå¤æä»¶ï¼æåæåï¼ä¸ä¼ å°æå¡å¨ï¼</h2>
<p>æææä»¶ç»ä¸æ¾å¨æ¬å°ææ¾å°çç®å½ï¼å¦æ¡é¢ï¼ï¼åç»­ç¨Xftp/WinSCPä¸ä¼ å°æå¡å¨ï¼é¿åæ··ä¹±ï¼æä»¶æ¸åå¦ä¸ï¼</p>
<ul>
<li>
<p>åç«¯æä»¶ï¼backend1-publishãbackend2-publishï¼2ä¸ªåç«¯ç.NET8åå¸æä»¶ï¼å¯æ°å¢backend3-publishç­ï¼å½ååºåï¼</p>
</li>
<li>
<p>åç«¯æä»¶ï¼frontend1-distãfrontend2-distï¼2ä¸ªåç«¯çVueæåæä»¶ï¼å¯æ°å¢ï¼å½ååºåï¼</p>
</li>
<li>
<p>éåtaråï¼ç¦»çº¿å¤ç¨ï¼ï¼multi-service-images.tarï¼å«æææééåï¼åç«¯è¿è¡æ¶ãåç«¯ä»£çã3ç§æ°æ®åºãRedisï¼è§£å³ç½ç»æåè¶æ¶ï¼</p>
</li>
<li>
<p>éç½®æä»¶ï¼</p>
<ul>
<li>
<p>nginx.confï¼Nginxæ ¸å¿éç½®ï¼å®ç°å¤åç«¯/å¤åç«¯åæµï¼</p>
</li>
<li>
<p>æ°æ®åºéç½®ï¼my.cnfï¼MySQLï¼ãpostgresql.confï¼PostgreSQLï¼ãsqlserver.confï¼SQL Serverï¼å¯éï¼</p>
</li>
<li>
<p>æ°æ®åºåå§åSQLï¼init-mysql.sqlãinit-postgresql.sqlãinit-sqlserver.sqlï¼å¯¹åºä¸åæ°æ®åºï¼åå»ºåºãè¡¨ãåå§åæ°æ®ï¼</p>
</li>
<li>
<p>docker-compose.ymlï¼æ ¸å¿ç¼ææä»¶ï¼ç®¡çæææå¡ï¼å«å¤æ°æ®åºå¯ééç½®ï¼</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260212102640244-1087151636.png" alt="" loading="lazy"></p>
<h1 id="äºåæåºç¡åå¤å·¥ä½å¿åå¥ å®é¨ç½²åºç¡">äºãåæåºç¡åå¤å·¥ä½ï¼å¿åï¼å¥ å®é¨ç½²åºç¡ï¼</h1>
<p>æ è®ºåç»­ç¨åªç§æ°æ®åºãé¨ç½²å¤å°æå¡ï¼è¿é¨åå·¥ä½é½æ¯åºç¡ï¼ä¸æ¬¡æ§åå¥½ï¼é¿ååç»­éå¤æä½ã</p>
<h2 id="1-centos7ç³»ç»åºç¡éç½®è¡¥åä¾èµé¿åæ¥é">1. CentOS7ç³»ç»åºç¡éç½®ï¼è¡¥åä¾èµï¼é¿åæ¥éï¼</h2>
<p>æå°åå®è£çCentOS7ç¼ºå°å¾å¤åºç¡å·¥å·ï¼åå®è£å¿è¦ä¾èµï¼ç¡®ä¿Dockerãå½ä»¤æ§è¡æ­£å¸¸ï¼</p>
<pre><code class="language-bash"># æ´æ°ç³»ç»è½¯ä»¶åï¼å¯éï¼å»ºè®®æ§è¡ï¼é¿åä¾èµçæ¬è¿ä½ï¼
yum update -y

# å®è£åºç¡å·¥å·ï¼wgetãvimãnet-toolsç­ï¼åç»­ç¼è¾éç½®ãæ¥çç«¯å£å¸¸ç¨ï¼
yum install -y wget vim net-tools epel-release

# å®è£Dockerä¾èµæéçé¢å¤å·¥å·ï¼é¿ååç»­å®è£Dockerå¤±è´¥ï¼
yum install -y curl policycoreutils-python-utils
</code></pre>
<h2 id="2-å®è£docker-ceç¨³å®çæ­¥éª¤åºå®">2. å®è£Docker CEï¼ç¨³å®çï¼æ­¥éª¤åºå®ï¼</h2>
<pre><code class="language-bash"># 1. å¸è½½æ§çæ¬Dockerï¼å¦æä¹åè£è¿ï¼é¿åå²çªï¼æ²¡è£è¿å¯è·³è¿ï¼
yum remove -y docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine

# 2. éç½®Dockerå®æ¹æºï¼CentOS7ä¸å±ï¼
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

# 3. å®è£Docker CE 24.0.7ï¼æå®çæ¬ï¼é¿åèªå¨æ´æ°å°ä¸ç¨³å®çæ¬ï¼
yum install -y docker-ce-24.0.7 docker-ce-cli-24.0.7 containerd.io

# 4. å¯å¨Dockeræå¡ï¼å¹¶è®¾ç½®å¼æºèªå¯ï¼å³é®ï¼å¤æå¡ééDockerèªå¨å¯å¨ï¼
systemctl start docker
systemctl enable docker

# 5. éªè¯Dockerå®è£æåï¼è¾åºçæ¬å·å³æåï¼
docker --version
</code></pre>
<p>â æåæ è¯ï¼<code>Docker version 24.0.7, build afdd53b</code></p>
<h2 id="3-éç½®dockeréåå éå½åå¿åé¿åéåæåè¶æ¶">3. éç½®Dockeréåå éï¼å½åå¿åï¼é¿åéåæåè¶æ¶ï¼</h2>
<p>Dockeré»è®¤æåå½å¤éåæºï¼å½åè®¿é®ææ¢ï¼çè³è¶æ¶ï¼éç½®é¿éäºä¸å±å éï¼æ¯å¬å±æºæ´ç¨³å®ï¼ãç»å½é¿éäºå®ç½ï¼<a href="https://www.aliyun.com/%EF%BC%89%EF%BC%8C%E6%90%9C%E7%B4%A2" target="_blank" rel="noopener nofollow">https://www.aliyun.com/ï¼ï¼æç´¢</a> âå®¹å¨éåæå¡âï¼è¿å¥ âéåå éå¨âï¼å¤å¶èªå·±çä¸å±å éå°åï¼ç¤ºä¾ï¼<a href="https://xxxxxx.mirror.aliyuncs.com" target="_blank" rel="noopener nofollow">https://xxxxxx.mirror.aliyuncs.com</a>ï¼æ¿æ¢æèªå·±çï¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260212102640329-1145206426.png" alt="éåå éå¨" loading="lazy"></p>
<pre><code class="language-bash"># 1. åå»ºDockeréç½®ç®å½ï¼å¦æä¸å­å¨ï¼
mkdir -p /etc/docker

# 2. åå¥å ééç½®ï¼æ¿æ¢æèªå·±çé¿éäºä¸å±å éå°åï¼è·åæ¹å¼ï¼é¿éäºâå®¹å¨éåæå¡âéåå éå¨ï¼
tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
  "registry-mirrors": ["https://xxxxxx.mirror.aliyuncs.com", "https://mirror.ccs.tencentyun.com"]
}
EOF

# 3. éæ°å è½½éç½®ï¼éå¯Dockerï¼è®©å éçæ
systemctl daemon-reload
systemctl restart docker

# 4. éªè¯å ééç½®æ¯å¦çæï¼è¾åºéç½®çå éå°åå³æåï¼
docker info | grep -A 2 "Registry Mirrors"
</code></pre>
<p>â æåæ è¯ï¼è¾åºä¸­åå«èªå·±éç½®çé¿éäºå éå°åï¼æ æ¥éã</p>
<p><img src="https://img2024.cnblogs.com/blog/157572/202602/157572-20260212102640225-1082113952.png" alt="é¿éäºå éå°å" loading="lazy"></p>
<h2 id="4-åçº§docker-composev2çæ¬æ¯æå¤æå¡éç½®">4. åçº§Docker Composeï¼V2çæ¬ï¼æ¯æå¤æå¡éç½®ï¼</h2>
<p>CentOS7é»è®¤å®è£çDocker Composeæ¯1.xçæ¬ï¼ä¸æ¯æå¤æå¡çå¥åº·æ£æ¥ãä¾èµæ¡ä»¶ç­éç½®ï¼åçº§å°V2çæ¬ï¼</p>
<pre><code class="language-bash"># 1. å é¤æ§çdocker-composeï¼å¦æä¹åè£è¿ï¼
rm -f /usr/local/bin/docker-compose

# 2. å®è£Docker Compose V2ï¼æä»¶å½¢å¼ï¼ç¨³å®ï¼åDockerèå¨æ´å¥½ï¼
yum install -y docker-compose-plugin

# 3. å»ºç«è½¯é¾æ¥ï¼ä¿ædocker-composeå½ä»¤å¯ç¨ï¼åæ§çç¨æ³ä¸è´ï¼æ éæ¹å½ä»¤ï¼
ln -s /usr/libexec/docker/cli-plugins/docker-compose /usr/local/bin/docker-compose

# 4. éªè¯åçº§æåï¼è¾åºV2çæ¬å·å³æåï¼
docker-compose --version
</code></pre>
<p>â æåæ è¯ï¼<code>Docker Compose version v2.27.1</code>ï¼çæ¬å·å¯ç¥æå·®å¼ï¼åªè¦æ¯V2å³å¯ï¼</p>
<h2 id="5-å³é­é²ç«å¢æµè¯ç¯å¢-å¼æ¾ç«¯å£çäº§ç¯å¢">5. å³é­é²ç«å¢ï¼æµè¯ç¯å¢ï¼/ å¼æ¾ç«¯å£ï¼çäº§ç¯å¢ï¼</h2>
<p>æµè¯ç¯å¢ï¼ç´æ¥å³é­é²ç«å¢ï¼é¿åç«¯å£è¢«æ¦æªï¼ç®åéç½®ï¼çäº§ç¯å¢ï¼ä»å¼æ¾æéç«¯å£ï¼æåå®å¨æ§ã</p>
<pre><code class="language-bash"># æµè¯ç¯å¢ï¼å³é­é²ç«å¢å¹¶ç¦æ­¢å¼æºèªå¯
systemctl stop firewalld
systemctl disable firewalld
systemctl status firewalld  # éªè¯ï¼è¾åºinactiveå³æå

# çäº§ç¯å¢ï¼å¼æ¾æéç«¯å£ï¼ç¤ºä¾ï¼æ ¹æ®èªå·±çç«¯å£ä¿®æ¹ï¼
# åç«¯ç«¯å£ï¼58588ã58589ï¼åç«¯ç«¯å£ï¼6866ã6867ï¼æ°æ®åºç«¯å£ï¼3306ï¼MySQLï¼ã5432ï¼PostgreSQLï¼ã1433ï¼SQL Serverï¼ï¼Redisç«¯å£ï¼6379
firewall-cmd --add-port=58588/tcp --permanent
firewall-cmd --add-port=58589/tcp --permanent
firewall-cmd --add-port=6866/tcp --permanent
firewall-cmd --add-port=6867/tcp --permanent
firewall-cmd --add-port=3306/tcp --permanent
firewall-cmd --add-port=5432/tcp --permanent
firewall-cmd --add-port=1433/tcp --permanent
firewall-cmd --add-port=6379/tcp --permanent
firewall-cmd --reload  # çæéç½®
firewall-cmd --list-ports  # éªè¯ï¼æ¥çå¼æ¾çç«¯å£æ¸å
</code></pre>
<h2 id="6-æå¡å¨ç®å½ç»ææ´çè§èç®å½é¿ååææ··ä¹±">6. æå¡å¨ç®å½ç»ææ´çï¼è§èç®å½ï¼é¿ååææ··ä¹±ï¼</h2>
<p>å°æ¬å°åå¤çæææä»¶ï¼ä¸ä¼ å°æå¡å¨ç<code>/root/multi-service-docker</code>ç®å½ï¼èªå®ä¹ç®å½ï¼æ¹ä¾¿è®°å¿ï¼ï¼æç»ç®å½ç»æå¦ä¸ï¼æ¯æå¤åç«¯ãå¤åç«¯ãå¤æ°æ®åºï¼ï¼</p>
<pre><code class="language-bash">multi-service-docker/                # é¡¹ç®æ ¹ç®å½ï¼æææä»¶é½æ¾å¨è¿éï¼
âââ docker-compose.yml               # æ ¸å¿ç¼ææä»¶ï¼ç®¡çæææå¡ï¼å«å¤æ°æ®åºéç½®ï¼
# åç«¯ç®å½ï¼2ä¸ªï¼å¯æ©å±æ´å¤ï¼
âââ backend1/                        # ç¬¬ä¸ä¸ªåç«¯APIæå¡
â   âââ publish/                     # åç«¯1ç.NET8åå¸æä»¶ï¼å«æ ¸å¿DLLãappsettings.jsonï¼
âââ backend2/                        # ç¬¬äºä¸ªåç«¯APIæå¡
â   âââ publish/                     # åç«¯2ç.NET8åå¸æä»¶
# åç«¯ç®å½ï¼2ä¸ªï¼å¯æ©å±æ´å¤ï¼
âââ frontend1/                       # ç¬¬ä¸ä¸ªåç«¯Webï¼å¦ç®¡çç«¯ï¼
â   âââ dist/                        # åç«¯1çVueæåæä»¶ï¼index.htmlãcssãjsï¼
âââ frontend2/                       # ç¬¬äºä¸ªåç«¯Webï¼å¦ç¨æ·ç«¯ï¼
â   âââ dist/                        # åç«¯2çVueæåæä»¶
# Nginxéç½®ç®å½
âââ nginx/
â   âââ nginx.conf                   # Nginxæ ¸å¿éç½®ï¼å¤åç«¯/å¤åç«¯åæµï¼
# æ°æ®åºéç½®ç®å½ï¼3ç§æ°æ®åºï¼æéä½¿ç¨ï¼
âââ mysql/
â   âââ my.cnf                       # MySQLéç½®æä»¶
â   âââ init-mysql.sql               # MySQLåå§åSQL
âââ postgresql/
â   âââ postgresql.conf              # PostgreSQLéç½®æä»¶
â   âââ init-postgresql.sql          # PostgreSQLåå§åSQL
âââ sqlserver/
â   âââ sqlserver.conf               # SQL Serveréç½®æä»¶ï¼å¯éï¼
â   âââ init-sqlserver.sql           # SQL Serveråå§åSQL
# ç¦»çº¿éååï¼å¤ç¨ï¼
âââ multi-service-images.tar         # æææééåçç¦»çº¿å
</code></pre>
<p>â ä¸ä¼ æ¹æ³ï¼ç¨ MobaXterm/Xftp/WinSCPè¿æ¥æå¡å¨ï¼IPï¼æå¡å¨çå®IPï¼è´¦å·ï¼rootï¼å¯ç ï¼èªå·±çæå¡å¨å¯ç ï¼ï¼å°æ¬å°åå¤çæä»¶ï¼æä¸è¿°ç®å½ç»æï¼æå°å¯¹åºæä»¶å¤¹ä¸­å³å¯ã</p>
<h1 id="ä¸æ ¸å¿æ¹æ¡2ä¸ªnet8åç«¯api--2ä¸ªvueåç«¯web-åºç¡é¨ç½²mysqlç">ä¸ãæ ¸å¿æ¹æ¡ï¼2ä¸ª.NET8åç«¯API + 2ä¸ªVueåç«¯Web åºç¡é¨ç½²ï¼MySQLçï¼</h1>
<p>åå®ç°æåºç¡çå¤æå¡é¨ç½²ï¼2åç«¯+2åç«¯+MySQL+Redis+Nginxï¼ï¼ææ¡æ ¸å¿é»è¾åï¼åæ©å±å¶ä»æ°æ®åºååºæ¯ï¼æ°æå»ºè®®åææ­¤æ¹æ¡é¨ç½²æåï¼åè¿è¡æ©å±ã</p>
<h2 id="1-ç¼ådocker-composeymlæ ¸å¿ç¼ææä»¶">1. ç¼ådocker-compose.ymlï¼æ ¸å¿ç¼ææä»¶ï¼</h2>
<p>è¯¥æä»¶æ¯å¤æå¡é¨ç½²çæ ¸å¿ï¼ç®¡çææå®¹å¨çå¯å¨ãä¾èµãç«¯å£ãæè½½ç­éç½®ï¼æ³¨éè¯¦ç»ï¼å¯ç´æ¥å¤å¶ä½¿ç¨ï¼å³é®éç½®å·²æ æ³¨ï¼</p>
<pre><code class="language-yaml">version: '3.8'

# æææå¡çéåï¼å¤åç«¯ãå¤åç«¯ãæ°æ®åºãRedisãNginxï¼
services:
  # === å¬å±ä¾èµæå¡ï¼MySQLï¼åºç¡çï¼åç»­å¯æ¿æ¢ä¸ºPostgreSQL/SQL Serverï¼ ===
  mysql:
    image: mysql:8.0                  # ä½¿ç¨MySQL 8.0éå
    container_name: multi-mysql       # èªå®ä¹å®¹å¨åï¼å¯ä¸ï¼æ¹ä¾¿ç®¡ç
    restart: always                   # å®¹å¨å¼å¸¸éåº/æå¡å¨éå¯åï¼èªå¨éå¯
    environment:
      MYSQL_ROOT_PASSWORD: Root@123456  # MySQL rootå¯ç ï¼èªå®ä¹ï¼å»ºè®®å¤æå¯ç ï¼
      MYSQL_USER: appuser             # é¡¹ç®è®¿é®MySQLçç¨æ·åï¼èªå®ä¹ï¼
      MYSQL_PASSWORD: App@123456      # é¡¹ç®è®¿é®MySQLçå¯ç ï¼èªå®ä¹ï¼
      MYSQL_DATABASE: app_db1         # åç«¯1æç¨æ°æ®åºå
      MYSQL_DATABASE2: app_db2        # åç«¯2æç¨æ°æ®åºåï¼ååºé¨ç½²ï¼å¯éï¼
      TZ: Asia/Shanghai               # å¼ºå¶å®¹å¨æ¶åºä¸ºä¸å«åºï¼è§£å³æ¶å·®é®é¢ï¼
    ports:
      - "3306:3306"                   # ç«¯å£æ å°ï¼å®¿ä¸»æº3306 â å®¹å¨å3306ï¼æ¬å°å·¥å·å¯è¿æ¥ï¼
    volumes:
      - ./mysql/my.cnf:/etc/mysql/conf.d/my.cnf  # æè½½MySQLéç½®æä»¶
      - ./mysql/init-mysql.sql:/docker-entrypoint-initdb.d/init-mysql.sql  # æè½½åå§åSQL
      - mysql-data:/var/lib/mysql     # æ°æ®å·ï¼æä¹åMySQLæ°æ®ï¼å®¹å¨å é¤ä¸ä¸¢å¤±ï¼
      - /etc/localtime:/etc/localtime:ro  # æè½½å®¿ä¸»æºæ¶åºæä»¶ï¼åéä¿éæ¶å·®
    command: --lower_case_table_names=1  # MySQLä¸åºåå¤§å°åï¼é¿åè¡¨åå¤§å°åé®é¢ï¼
    networks:
      - multi-service-network         # å å¥èªå®ä¹ç½ç»ï¼å®ç°ææå®¹å¨äºé
    # å¥åº·æ£æ¥ï¼æ£æµMySQLæ¯å¦çæ­£å°±ç»ªï¼é¿ååç«¯å¯å¨æ©äºMySQLï¼å¯¼è´è¿æ¥å¤±è´¥
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uappuser", "-pApp@123456"]
      interval: 5s                    # æ¯5ç§æ£æµä¸æ¬¡
      timeout: 30s                    # è¶æ¶æ¶é´30ç§
      retries: 10                     # éè¯10æ¬¡ï¼å¤±è´¥åè®¤ä¸ºå®¹å¨æªå°±ç»ª
      start_period: 20s               # å®¹å¨å¯å¨åï¼å»¶è¿20ç§å¼å§æ£æµ

  # === å¬å±ä¾èµæå¡ï¼Redisï¼ç¼å­ï¼å¤åç«¯å¯å±äº«/éç¦»ï¼ ===
  redis:
    image: redis:7-alpine             # è½»éçRedisï¼å ç¨èµæºå°
    container_name: multi-redis       # å¯ä¸å®¹å¨å
    restart: always                   # èªå¨éå¯
    ports:
      - "6379:6379"                   # ç«¯å£æ å°ï¼å®¿ä¸»æº6379 â å®¹å¨å6379
    volumes:
      - redis-data:/data              # æ°æ®å·ï¼æä¹åRedisæ°æ®
    command: redis-server --requirepass "Redis@123456"  # Rediså¯ç ï¼èªå®ä¹ï¼
    networks:
      - multi-service-network         # å å¥èªå®ä¹ç½ç»
    environment:
      TZ: Asia/Shanghai               # åæ­¥ä¸å«åºæ¶åº
    # Rediså¥åº·æ£æ¥ï¼å¯éï¼ä¼åå¤åç«¯ä¾èµï¼
    healthcheck:
      test: ["CMD", "redis-cli", "ping", "-a", "Redis@123456"]
      interval: 3s
      timeout: 10s
      retries: 5

  # === åç«¯API 1ï¼ç¬¬ä¸ä¸ªæå¡ï¼å¦ç®¡çç«¯åç«¯ï¼ ===
  backend1:
    image: mcr.microsoft.com/dotnet/aspnet:8.0  # .NET8è¿è¡æ¶éåï¼æ éæå»ºï¼ç´æ¥è¿è¡åå¸æä»¶ï¼
    container_name: multi-backend1    # å¯ä¸å®¹å¨åï¼åºåå¶ä»åç«¯
    restart: always                   # èªå¨éå¯
    ports:
      - "58588:58588"                 # å¯ä¸ç«¯å£ï¼é¿ååå¶ä»åç«¯å²çª
    depends_on:
      mysql:
        condition: service_healthy    # ä»å¨MySQLå¥åº·æ£æ¥éè¿ï¼çæ­£å°±ç»ªï¼åï¼æå¯å¨åç«¯1
      redis:
        condition: service_healthy    # Rediså°±ç»ªåï¼å¯å¨åç«¯1
    volumes:
      - ./backend1/publish:/app       # æè½½åç«¯1çåå¸ç®å½ï¼æ ¸å¿ï¼å®¹å¨ç´æ¥è¿è¡åå¸æä»¶ï¼
      - /wwwroot/Resources1:/wwwroot/Resources  # æè½½åç«¯1çæä»¶ç®å½ï¼å¦ç¨æ·å¤´åï¼æéæè½½ï¼
    environment:
      TZ: Asia/Shanghai               # åæ­¥æ¶åº
      ASPNETCORE_URLS: "http://*:58588"  # å¼ºå¶åç«¯1çå¬58588ç«¯å£ï¼è§£å³ç«¯å£ä¸éé®é¢ï¼
      ASPNETCORE_ENVIRONMENT: Production  # .NETç¯å¢ï¼çäº§ç¯å¢ï¼
      # åç«¯1çMySQLè¿æ¥å­ç¬¦ä¸²ï¼è¿æ¥MySQLçapp_db1åºï¼serverç¨å®¹å¨åmysqlï¼
      ConnectionStrings__MySQL: "server=mysql;port=3306;database=app_db1;user=appuser;password=App@123456;charset=utf8mb4;AllowPublicKeyRetrieval=True;SslMode=None"
      # åç«¯1çRedisè¿æ¥å­ç¬¦ä¸²ï¼serverç¨å®¹å¨åredisï¼å¯ç å¯¹åºä¸é¢çRediså¯ç ï¼
      ConnectionStrings__Redis: "redis:6379,password=Redis@123456,defaultDatabase=0,ssl=false,abortConnect=false"
    working_dir: /app                 # å®¹å¨å·¥ä½ç®å½ï¼æåæè½½çåå¸ç®å½
    entrypoint: ["dotnet", "Backend1.WebHost.dll"]  # å¯å¨åç«¯1çæ ¸å¿DLLï¼æ¿æ¢ä¸ºèªå·±çDLLåï¼
    networks:
      - multi-service-network         # å å¥èªå®ä¹ç½ç»ï¼å¯è®¿é®MySQL/Redis/å¶ä»åç«¯

  # === åç«¯API 2ï¼ç¬¬äºä¸ªæå¡ï¼å¦ç¨æ·ç«¯åç«¯ï¼ ===
  backend2:
    image: mcr.microsoft.com/dotnet/aspnet:8.0  # ååç«¯1å±ç¨.NET8è¿è¡æ¶éå
    container_name: multi-backend2    # å¯ä¸å®¹å¨åï¼åºååç«¯1
    restart: always                   # èªå¨éå¯
    ports:
      - "58589:58589"                 # å¯ä¸ç«¯å£ï¼é¿åååç«¯1å²çªï¼ä¸å¯éå¤ï¼
    depends_on:
      mysql:
        condition: service_healthy    # ä¾èµMySQLå°±ç»ª
      redis:
        condition: service_healthy    # ä¾èµRediså°±ç»ª
    volumes:
      - ./backend2/publish:/app       # æè½½åç«¯2çåå¸ç®å½ï¼ç¬ç«ç®å½ï¼é¿åä»£ç è¦çï¼
      - /wwwroot/Resources2:/wwwroot/Resources  # åç«¯2çæä»¶ç®å½ï¼ç¬ç«æè½½ï¼é¿åæä»¶æ··ä¹±ï¼
    environment:
      TZ: Asia/Shanghai
      ASPNETCORE_URLS: "http://*:58589"  # å¼ºå¶åç«¯2çå¬58589ç«¯å£
      ASPNETCORE_ENVIRONMENT: Production
      # åç«¯2çMySQLè¿æ¥å­ç¬¦ä¸²ï¼å¯è¿æ¥ä¸ååºapp_db2ï¼å®ç°ååºé¨ç½²ï¼
      ConnectionStrings__MySQL: "server=mysql;port=3306;database=app_db2;user=appuser;password=App@123456;charset=utf8mb4;AllowPublicKeyRetrieval=True;SslMode=None"
      # åç«¯2çRedisè¿æ¥å­ç¬¦ä¸²ï¼å¯æå®ä¸åæ°æ®åºdefaultDatabase=1ï¼å®ç°ç¼å­éç¦»ï¼
      ConnectionStrings__Redis: "redis:6379,password=Redis@123456,defaultDatabase=1,ssl=false,abortConnect=false"
    working_dir: /app
    entrypoint: ["dotnet", "Backend2.WebHost.dll"]  # åç«¯2çæ ¸å¿DLLï¼æ¿æ¢ä¸ºèªå·±çï¼
    networks:
      - multi-service-network

  # === Nginxæå¡ï¼æ ¸å¿ï¼å¤åç«¯ä»£ç+å¤åç«¯åæµï¼ ===
  nginx:
    image: nginx:alpine               # è½»éçNginx
    container_name: multi-nginx       # å¯ä¸å®¹å¨å
    restart: always                   # èªå¨éå¯
    ports:
      - "6866:6866"                   # åç«¯1è®¿é®ç«¯å£ï¼å¯ä¸ï¼
      - "6867:6867"                   # åç«¯2è®¿é®ç«¯å£ï¼å¯ä¸ï¼é¿åå²çªï¼
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf  # æè½½Nginxåæµéç½®
      - ./frontend1/dist:/usr/share/nginx/html/web1  # æè½½åç«¯1çéææä»¶
      - ./frontend2/dist:/usr/share/nginx/html/web2  # æè½½åç«¯2çéææä»¶
    depends_on:
      - backend1                      # åç«¯1å¯å¨åï¼åå¯å¨Nginxï¼é¿ååç«¯è®¿é®åç«¯å¤±è´¥ï¼
      - backend2                      # åç«¯2å¯å¨åï¼åå¯å¨Nginx
    networks:
      - multi-service-network
    environment:
      TZ: Asia/Shanghai

# æ°æ®å·ï¼æä¹åMySQLãRedisæ°æ®ï¼å®¹å¨å é¤ãdocker-compose downä¸ä¼å é¤æ°æ®ï¼
volumes:
  mysql-data:
  redis-data:

# èªå®ä¹ç½ç»ï¼æææå¡å å¥åä¸ç½ç»ï¼å®¹å¨é´å¯éè¿ãå®¹å¨åãç´æ¥éä¿¡ï¼æ ééç½®IP
networks:
  multi-service-network:
    driver: bridge
</code></pre>
<h2 id="2-ç¼ånginxéç½®nginxconfå¤æå¡åæµæ ¸å¿">2. ç¼åNginxéç½®ï¼nginx.confï¼å¤æå¡åæµæ ¸å¿ï¼</h2>
<p>Nginxçæ ¸å¿ä½ç¨æ¯ï¼ä»£çå¤ä¸ªåç«¯éææä»¶ï¼å°åç«¯çAPIè¯·æ±ï¼æè·¯å¾åç¼åæµå°å¯¹åºåç«¯ï¼é¿åç«¯å£æ··ä¹±ï¼éç½®å¦ä¸ï¼æ³¨éè¯¦ç»ï¼ï¼</p>
<pre><code class="language-nginx">worker_processes 1;  # ææå¡å¨CPUæ ¸å¿æ°è°æ´ï¼1æ ¸ç¨1ï¼2æ ¸ç¨2

events {
    worker_connections 1024;  # æå¤§è¿æ¥æ°ï¼è¶³å¤å¤æå¡ä½¿ç¨
}

http {
    include       /etc/nginx/mime.types;  # å¼å¥MIMEç±»åï¼æ¯æåç«¯éææä»¶ï¼
    default_type  application/octet-stream;

    sendfile        on;  # å¼å¯é«ææä»¶ä¼ è¾
    keepalive_timeout  65;  # è¿æ¥è¶æ¶æ¶é´

    # === åç«¯1éç½®ï¼è®¿é®ç«¯å£ï¼6866ï¼å¯¹åºç®¡çç«¯ï¼ ===
    server {
        listen       6866;  # åç«¯1çè®¿é®ç«¯å£ï¼ådocker-compose.ymlä¸­Nginxçç«¯å£æ å°ä¸è´ï¼
        server_name  localhost;  # æµè¯ç¯å¢ç¨localhostï¼çäº§ç¯å¢å¯æ¹ä¸ºåå

        # åç«¯1çéææä»¶ä»£çï¼å è½½Vueæååçindex.htmlãcssãjsï¼
        location / {
            root   /usr/share/nginx/html/web1;  # å¯¹åºåç«¯1çdistç®å½ï¼docker-compose.ymlä¸­æè½½çè·¯å¾ï¼
            index  index.html index.htm;
            try_files $uri $uri/ /index.html;  # è§£å³Vueè·¯ç±å·æ°404é®é¢ï¼å³é®ï¼
        }

        # åç«¯1è°ç¨çåç«¯1APIï¼è·¯å¾åç¼ï¼/api1/ï¼åæµå°backend1ï¼
        location /api1/ {
            proxy_pass http://multi-backend1:58588/;  # è½¬åå°åç«¯1å®¹å¨ï¼å®¹å¨å+ç«¯å£ï¼
            # è½¬åè¯·æ±å¤´ï¼ç¡®ä¿åç«¯è½è·åå®¢æ·ç«¯çå®IPãè¯·æ±å°åç­ä¿¡æ¯
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # åç«¯1å¦éè°ç¨åç«¯2APIï¼å¯éï¼æééç½®ï¼
        location /api2/ {
            proxy_pass http://multi-backend2:58589/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }

    # === åç«¯2éç½®ï¼è®¿é®ç«¯å£ï¼6867ï¼å¯¹åºç¨æ·ç«¯ï¼ ===
    server {
        listen       6867;  # åç«¯2çè®¿é®ç«¯å£ï¼å¯ä¸ï¼ä¸éå¤ï¼
        server_name  localhost;

        # åç«¯2çéææä»¶ä»£ç
        location / {
            root   /usr/share/nginx/html/web2;  # å¯¹åºåç«¯2çdistç®å½
            index  index.html index.htm;
            try_files $uri $uri/ /index.html;  # Vueè·¯ç±å¼å®¹
        }

        # åç«¯2è°ç¨çåç«¯2APIï¼è·¯å¾åç¼ï¼/api2/ï¼åæµå°backend2ï¼
        location /api2/ {
            proxy_pass http://multi-backend2:58589/;  # è½¬åå°åç«¯2å®¹å¨
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # åç«¯2å¦éè°ç¨åç«¯1APIï¼å¯éï¼æééç½®ï¼
        location /api1/ {
            proxy_pass http://multi-backend1:58588/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}
</code></pre>
<h2 id="3-å¯å¨æææå¡å¹¶éªè¯">3. å¯å¨æææå¡å¹¶éªè¯</h2>
<p>ææéç½®å®æåï¼ä¸é®å¯å¨æææå¡ï¼ç¶åéä¸ªéªè¯ï¼ç¡®ä¿æææå¡æ­£å¸¸è¿è¡ã</p>
<pre><code class="language-bash"># 1. è¿å¥é¡¹ç®æ ¹ç®å½ï¼å¿é¡»å¨docker-compose.ymlæå¨ç®å½æ§è¡å½ä»¤ï¼
cd /root/multi-service-docker

# 2. åå°å¯å¨æææå¡ï¼-dï¼åå°è¿è¡ï¼æ éæå¨å¼å®ï¼
docker-compose up -d

# 3. æ¥çæææå¡è¿è¡ç¶æï¼å³é®ï¼ç¡®è®¤æææå¡é½å¯å¨æåï¼
docker-compose ps
</code></pre>
<p>â æåæ è¯ï¼<code>docker-compose ps</code>è¾åºä¸­ï¼multi-mysqlãmulti-redisãmulti-backend1ãmulti-backend2ãmulti-nginx 5ä¸ªæå¡çStateåï¼åä¸º<code>Up (healthy)</code>æ<code>Up</code>ï¼æ Exitedç¶æã</p>
<h3 id="31-éä¸ªéªè¯æå¡ç¡®ä¿æ é®é¢">3.1 éä¸ªéªè¯æå¡ï¼ç¡®ä¿æ é®é¢ï¼</h3>
<ul>
<li><strong>éªè¯åç«¯1</strong>ï¼è®¿é®å°å<code>http://æå¡å¨IP:58588/swagger</code>ï¼å¦ï¼<a href="http://192.168.1.100:58588/swagger%EF%BC%89" target="_blank" rel="noopener nofollow">http://192.168.1.100:58588/swaggerï¼</a></li>
</ul>
<p>â		â æåæ è¯ï¼æµè§å¨è½æ­£å¸¸æå¼Swaggeré¡µé¢ï¼æ æ¥éï¼è½çå°åç«¯1çæææ¥å£ã</p>
<ul>
<li>
<p><strong>éªè¯åç«¯2</strong>ï¼è®¿é®å°å <code>http://æå¡å¨IP:58589/swagger</code><br>
â æåæ è¯ï¼æ­£å¸¸æå¼Swaggeré¡µé¢ï¼æ¥å£è½æ­£å¸¸æ¾ç¤ºã</p>
</li>
<li>
<p><strong>éªè¯åç«¯1</strong>ï¼è®¿é®å°å <code>http://æå¡å¨IP:6866</code><br>
â æåæ è¯ï¼è½æ­£å¸¸æå¼Vueé¡µé¢ï¼æ ·å¼ãå¾çæ­£å¸¸ï¼è°ç¨<code>/api1/xxx</code>æ¥å£è½è¿åæ­£å¸¸æ°æ®ã</p>
</li>
<li>
<p><strong>éªè¯åç«¯2</strong>ï¼è®¿é®å°å <code>http://æå¡å¨IP:6867</code><br>
â æåæ è¯ï¼è½æ­£å¸¸æå¼Vueé¡µé¢ï¼è°ç¨<code>/api2/xxx</code>æ¥å£è½è¿åæ­£å¸¸æ°æ®ã</p>
</li>
<li>
<p><strong>éªè¯MySQL</strong>ï¼ç¨Navicat/DBeaverè¿æ¥æå¡å¨IP:3306ï¼ç¨æ·åappuserï¼å¯ç App@123456ï¼è½æ­£å¸¸è¿æ¥ï¼è½çå°app_db1ãapp_db2ä¸¤ä¸ªæ°æ®åºï¼ä»¥ååå§åçè¡¨åæ°æ®ã</p>
</li>
<li>
<p><strong>éªè¯Redis</strong>ï¼ç¨Rediså®¢æ·ç«¯è¿æ¥æå¡å¨IP:6379ï¼å¯ç Redis@123456ï¼è½æ­£å¸¸æ§è¡setãgetå½ä»¤ï¼åç«¯1/2çç¼å­è½æ­£å¸¸çæã</p>
</li>
</ul>
<p>â å¤±è´¥ææ¥ï¼è¥æä¸ªæå¡å¯å¨å¤±è´¥æè®¿é®ä¸éï¼æ§è¡<code>docker-compose logs -f æå¡å</code>ï¼å¦<code>docker-compose logs -f multi-backend1</code>ï¼ï¼æ¥çå®æ¶æ¥å¿ï¼æ ¹æ®æ¥å¿æç¤ºææ¥é®é¢ï¼å¦ç«¯å£å²çªãè¿æ¥ä¸²éè¯¯ãç®å½æè½½å¤±è´¥ï¼ã</p>
<h1 id="åæ©å±æ¹æ¡1æ¿æ¢æ°æ®åºpostgresql--sql-server">åãæ©å±æ¹æ¡1ï¼æ¿æ¢æ°æ®åºï¼PostgreSQL / SQL Serverï¼</h1>
<p>å®éé¡¹ç®ä¸­ï¼å¯è½ä¼ç¨å°PostgreSQLï¼å¼æºãéåå¤ææ¥è¯¢ï¼æSQL Serverï¼å¾®è½¯çæãéå.NETé¡¹ç®ï¼ï¼ä»¥ä¸æ¯å®æ´çæ¿æ¢æ¹æ¡ï¼åªéä¿®æ¹docker-compose.ymlååç«¯è¿æ¥ä¸²ï¼æ éä¿®æ¹åç«¯åNginxéç½®ã</p>
<h2 id="1-æ¿æ¢ä¸ºpostgresqlå¼æºé¦ééénet6">1. æ¿æ¢ä¸ºPostgreSQLï¼å¼æºé¦éï¼éé.NET6+ï¼</h2>
<p>PostgreSQLæ¯å¼æºçé«æ§è½æ°æ®åºï¼å¼å®¹æ§å¼ºï¼éåå¤§å¤æ°.NETé¡¹ç®ï¼æ¿æ¢æ­¥éª¤å¦ä¸ï¼</p>
<h3 id="11-ä¿®æ¹docker-composeymlæ¿æ¢mysqlä¸ºpostgresql">1.1 ä¿®æ¹docker-compose.ymlï¼æ¿æ¢MySQLä¸ºPostgreSQLï¼</h3>
<p>å é¤åæçmysqlæå¡ï¼æ°å¢postgresqlæå¡ï¼å¶ä»æå¡ï¼åç«¯1/2ãåç«¯1/2ãRedisãNginxï¼æ éä¿®æ¹ï¼ä»ä¿®æ¹åç«¯çè¿æ¥ä¸²ï¼</p>
<pre><code class="language-yaml">version: '3.8'

services:
  # === æ¿æ¢ä¸ºPostgreSQLæå¡ï¼æ¿æ¢åæçMySQLï¼ ===
  postgresql:
    image: postgres:15                # PostgreSQL 15éåï¼ç¨³å®çï¼éé.NET8ï¼
    container_name: multi-postgresql  # å¯ä¸å®¹å¨å
    restart: always
    environment:
      POSTGRES_USER: appuser          # é¡¹ç®è®¿é®PostgreSQLçç¨æ·å
      POSTGRES_PASSWORD: App@123456   # å¯ç ï¼åä¹åMySQLä¸è´ï¼æ¹ä¾¿è®°å¿ï¼
      POSTGRES_DB: app_db1            # åç«¯1æç¨æ°æ®åº
      POSTGRES_DB2: app_db2           # åç«¯2æç¨æ°æ®åºï¼ååºé¨ç½²ï¼
      TZ: Asia/Shanghai               # åæ­¥ä¸å«åºæ¶åº
    ports:
      - "5432:5432"                   # PostgreSQLé»è®¤ç«¯å£5432
    volumes:
      - ./postgresql/postgresql.conf:/var/lib/postgresql/data/postgresql.conf  # æè½½éç½®æä»¶
      - ./postgresql/init-postgresql.sql:/docker-entrypoint-initdb.d/init-postgresql.sql  # æè½½åå§åSQL
      - postgresql-data:/var/lib/postgresql/data  # æ°æ®å·ï¼æä¹åæ°æ®
      - /etc/localtime:/etc/localtime:ro
    networks:
      - multi-service-network
    # å¥åº·æ£æ¥ï¼æ£æµPostgreSQLæ¯å¦å°±ç»ª
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U appuser -d app_db1"]
      interval: 5s
      timeout: 30s
      retries: 10
      start_period: 20s

  # === Redisæå¡ï¼ä¸åï¼ ===
  redis:
    image: redis:7-alpine
    container_name: multi-redis
    restart: always
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    command: redis-server --requirepass "Redis@123456"
    networks:
      - multi-service-network
    environment:
      TZ: Asia/Shanghai
    healthcheck:
      test: ["CMD", "redis-cli", "ping", "-a", "Redis@123456"]
      interval: 3s
      timeout: 10s
      retries: 5

  # === åç«¯1æå¡ï¼ä»ä¿®æ¹MySQLè¿æ¥ä¸²ä¸ºPostgreSQLè¿æ¥ä¸²ï¼ ===
  backend1:
    image: mcr.microsoft.com/dotnet/aspnet:8.0
    container_name: multi-backend1
    restart: always
    ports:
      - "58588:58588"
    depends_on:
      postgresql:  # ä¾èµæ¹ä¸ºpostgresqlï¼èémysql
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./backend1/publish:/app
      - /wwwroot/Resources1:/wwwroot/Resources
    environment:
      TZ: Asia/Shanghai
      ASPNETCORE_URLS: "http://*:58588"
      ASPNETCORE_ENVIRONMENT: Production
      # åç«¯1çPostgreSQLè¿æ¥ä¸²ï¼æ¿æ¢åæçMySQLè¿æ¥ä¸²ï¼
      ConnectionStrings__PostgreSQL: "Host=postgresql;Port=5432;Database=app_db1;Username=appuser;Password=App@123456;Pooling=true;Timeout=30;"
      # Redisè¿æ¥ä¸²ï¼ä¸åï¼
      ConnectionStrings__Redis: "redis:6379,password=Redis@123456,defaultDatabase=0,ssl=false,abortConnect=false"
    working_dir: /app
    entrypoint: ["dotnet", "Backend1.WebHost.dll"]
    networks:
      - multi-service-network

  # === åç«¯2æå¡ï¼ä»ä¿®æ¹è¿æ¥ä¸²ï¼ ===
  backend2:
    image: mcr.microsoft.com/dotnet/aspnet:8.0
    container_name: multi-backend2
    restart: always
    ports:
      - "58589:58589"
    depends_on:
      postgresql:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./backend2/publish:/app
      - /wwwroot/Resources2:/wwwroot/Resources
    environment:
      TZ: Asia/Shanghai
      ASPNETCORE_URLS: "http://*:58589"
      ASPNETCORE_ENVIRONMENT: Production
      # åç«¯2çPostgreSQLè¿æ¥ä¸²
      ConnectionStrings__PostgreSQL: "Host=postgresql;Port=5432;Database=app_db2;Username=appuser;Password=App@123456;Pooling=true;Timeout=30;"
      # Redisè¿æ¥ä¸²ï¼ä¸åï¼
      ConnectionStrings__Redis: "redis:6379,password=Redis@123456,defaultDatabase=1,ssl=false,abortConnect=false"
    working_dir: /app
    entrypoint: ["dotnet", "Backend2.WebHost.dll"]
    networks:
      - multi-service-network

  # === Nginxæå¡ï¼ä¸åï¼ ===
  nginx:
    image: nginx:alpine
    container_name: multi-nginx
    restart: always
    ports:
      - "6866:6866"
      - "6867:6867"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./frontend1/dist:/usr/share/nginx/html/web1
      - ./frontend2/dist:/usr/share/nginx/html/web2
    depends_on:
      - backend1
      - backend2
    networks:
      - multi-service-network
    environment:
      TZ: Asia/Shanghai

# æ°æ®å·ï¼æ¿æ¢ä¸ºpostgresql-dataï¼å é¤mysql-data
volumes:
  postgresql-data:
  redis-data:

# èªå®ä¹ç½ç»ï¼ä¸åï¼
networks:
  multi-service-network:
    driver: bridge
</code></pre>
<h3 id="12-åç«¯é¡¹ç®ä¿®æ¹å³é®">1.2 åç«¯é¡¹ç®ä¿®æ¹ï¼å³é®ï¼</h3>
<ul>
<li>
<ol>
<li>åç«¯é¡¹ç®ä¸­ï¼å®è£PostgreSQLä¾èµåï¼å¨VS2022ä¸­ï¼å³é®é¡¹ç®âç®¡çNuGetç¨åºåï¼æç´¢å¹¶å®è£<code>Npgsql.EntityFrameworkCore.PostgreSQL</code>ï¼éé.NET8ççæ¬ï¼ï¼</li>
</ol>
</li>
<li>
<ol start="2">
<li>ä¿®æ¹appsettings.jsonï¼å°åæ¥ç<code>ConnectionStrings:MySQL</code>ï¼æ¹ä¸º<code>ConnectionStrings:PostgreSQL</code>ï¼å¯¹åºdocker-compose.ymlä¸­çè¿æ¥ä¸²ï¼</li>
</ol>
</li>
<li>
<ol start="3">
<li>
<p>ä¿®æ¹Program.csï¼å¦ä½¿ç¨EF Coreçæ°æ®åºæä¾å¨ï¼ä»MySQLæ¹ä¸ºPostgreSQLï¼ç¤ºä¾ï¼</p>
<blockquote>
<p>// åæ¥çMySQLéç½®<br>
builder.Services.AddDbContext<appdbcontext>(options =&gt; options.UseMySql(builder.Configuration.GetConnectionString("MySQL"), new MySqlServerVersion(new Version(8, 0, 36))));</appdbcontext></p>
<p>// æ¹ä¸ºPostgreSQLéç½®<br>
builder.Services.AddDbContext<appdbcontext>(options =&gt; options.UseNpgsql(builder.Configuration.GetConnectionString("PostgreSQL")));</appdbcontext></p>
</blockquote>
</li>
</ol>
</li>
<li>
<ol start="4">
<li>éæ°åå¸åç«¯1/2é¡¹ç®ï¼å°æ°çpublishæä»¶å¤¹ï¼ä¸ä¼ å°æå¡å¨å¯¹åºç®å½ï¼è¦çåæ¥çæä»¶ã</li>
</ol>
</li>
</ul>
<h3 id="13-å¯å¨å¹¶éªè¯">1.3 å¯å¨å¹¶éªè¯</h3>
<pre><code class="language-bash">cd /root/multi-service-docker
# åæ­¢å¹¶å é¤åæå®¹å¨ï¼é¿åå²çªï¼
docker-compose down
# å¯å¨æ°æå¡
docker-compose up -d
# æ¥çç¶æ
docker-compose ps
</code></pre>
<p>â éªè¯ï¼ååºç¡æ¹æ¡ä¸è´ï¼è®¿é®åç«¯ãåç«¯ãPostgreSQLï¼ç¨Navicatè¿æ¥æå¡å¨IP:5432ï¼ï¼ç¡®è®¤æææå¡æ­£å¸¸ã</p>
<h2 id="2-æ¿æ¢ä¸ºsql-serverå¾®è½¯çæéåneté¡¹ç®">2. æ¿æ¢ä¸ºSQL Serverï¼å¾®è½¯çæï¼éå.NETé¡¹ç®ï¼</h2>
<p>SQL Serveræ¯å¾®è½¯æ¨åºçå³ç³»åæ°æ®åºï¼å.NETçæå¼å®¹æ§æä½³ï¼éåä¼ä¸çº§.NETé¡¹ç®ï¼æ¿æ¢æ­¥éª¤å¦ä¸ï¼ç±»ä¼¼PostgreSQLï¼ï¼</p>
<h3 id="21-ä¿®æ¹docker-composeymlæ¿æ¢mysqlä¸ºsql-server">2.1 ä¿®æ¹docker-compose.ymlï¼æ¿æ¢MySQLä¸ºSQL Serverï¼</h3>
<pre><code class="language-yaml">version: '3.8'

services:
  # === æ¿æ¢ä¸ºSQL Serveræå¡ ===
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest  # SQL Server 2022éå
    container_name: multi-sqlserver  # å¯ä¸å®¹å¨å
    restart: always
    environment:
      ACCEPT_EULA: "Y"                # å¿é¡»è®¾ç½®ä¸ºYï¼æ¥åSQL Serverè®¸å¯åè®®
      SA_PASSWORD: "App@12345678"     # SAå¯ç ï¼å¤æåº¦è¦æ±ï¼è³å°8ä½ï¼å«å­æ¯+æ°å­+ç¹æ®ç¬¦å·ï¼
      MSSQL_PID: "Express"            # çæ¬ï¼Expressï¼åè´¹çï¼éåæµè¯/å°åé¡¹ç®ï¼
      TZ: Asia/Shanghai               # åæ­¥æ¶åº
    ports:
      - "1433:1433"                   # SQL Serveré»è®¤ç«¯å£1433
    volumes:
      - ./sqlserver/sqlserver.conf:/var/opt/mssql/mssql.conf  # æè½½éç½®æä»¶
      - ./sqlserver/init-sqlserver.sql:/docker-entrypoint-initdb.d/init-sqlserver.sql  # åå§åSQL
      - sqlserver-data:/var/opt/mssql  # æ°æ®å·ï¼æä¹åæ°æ®
      - /etc/localtime:/etc/localtime:ro
    networks:
      - multi-service-network
    # å¥åº·æ£æ¥ï¼æ£æµSQL Serveræ¯å¦å°±ç»ª
    healthcheck:
      test: ["CMD-SHELL", "/opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P App@12345678 -Q 'SELECT 1'"]
      interval: 10s
      timeout: 30s
      retries: 10
      start_period: 30s  # SQL Serverå¯å¨è¾æ¢ï¼å»¶è¿30ç§å¼å§æ£æµ

  # === Redisæå¡ï¼ä¸åï¼ ===
  redis:
    image: redis:7-alpine
    container_name: multi-redis
    restart: always
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    command: redis-server --requirepass "Redis@123456"
    networks:
      - multi-service-network
    environment:
      TZ: Asia/Shanghai
    healthcheck:
      test: ["CMD", "redis-cli", "ping", "-a", "Redis@123456"]
      interval: 3s
      timeout: 10s
      retries: 5

  # === åç«¯1æå¡ï¼ä»ä¿®æ¹è¿æ¥ä¸²ï¼ ===
  backend1:
    image: mcr.microsoft.com/dotnet/aspnet:8.0
    container_name: multi-backend1
    restart: always
    ports:
      - "58588:58588"
    depends_on:
      sqlserver:  # ä¾èµæ¹ä¸ºsqlserver
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./backend1/publish:/app
      - /wwwroot/Resources1:/wwwroot/Resources
    environment:
      TZ: Asia/Shanghai
      ASPNETCORE_URLS: "http://*:58588"
      ASPNETCORE_ENVIRONMENT: Production
      # åç«¯1çSQL Serverè¿æ¥ä¸²
      ConnectionStrings__SQLServer: "Server=sqlserver,1433;Database=app_db1;User ID=sa;Password=App@12345678;TrustServerCertificate=True;"
      # Redisè¿æ¥ä¸²ï¼ä¸åï¼
      ConnectionStrings__Redis: "redis:6379,password=Redis@123456,defaultDatabase=0,ssl=false,abortConnect=false"
    working_dir: /app
    entrypoint: ["dotnet", "Backend1.WebHost.dll"]
    networks:
      - multi-service-network

  # === åç«¯2æå¡ï¼ä»ä¿®æ¹è¿æ¥ä¸²ï¼ ===
  backend2:
    image: mcr.microsoft.com/dotnet/aspnet:8.0
    container_name: multi-backend2
    restart: always
    ports:
      - "58589:58589"
    depends_on:
      sqlserver:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./backend2/publish:/app
      - /wwwroot/Resources2:/wwwroot/Resources
    environment:
      TZ: Asia/Shanghai
      ASPNETCORE_URLS: "http://*:58589"
      ASPNETCORE_ENVIRONMENT: Production
      # åç«¯2çSQL Serverè¿æ¥ä¸²
      ConnectionStrings__SQLServer: "Server=sqlserver,1433;Database=app_db2;User ID=sa;Password=App@12345678;TrustServerCertificate=True;"
      # Redisè¿æ¥ä¸²ï¼ä¸åï¼
      ConnectionStrings__Redis: "redis:6379,password=Redis@123456,defaultDatabase=1,ssl=false,abortConnect=false"
    working_dir: /app
    entrypoint: ["dotnet", "Backend2.WebHost.dll"]
    networks:
      - multi-service-network

  # === Nginxæå¡ï¼ä¸åï¼ ===
  nginx:
    image: nginx:alpine
    container_name: multi-nginx
    restart: always
    ports:
      - "6866:6866"
      - "6867:6867"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./frontend1/dist:/usr/share/nginx/html/web1
      - ./frontend2/dist:/usr/share/nginx/html/web2
    depends_on:
      - backend1
      - backend2
    networks:
      - multi-service-network
    environment:
      TZ: Asia/Shanghai

# æ°æ®å·ï¼æ¿æ¢ä¸ºsqlserver-data
volumes:
  sqlserver-data:
  redis-data:

# èªå®ä¹ç½ç»ï¼ä¸åï¼
networks:
  multi-service-network:
    driver: bridge
</code></pre>
<h3 id="22-åç«¯é¡¹ç®ä¿®æ¹">2.2 åç«¯é¡¹ç®ä¿®æ¹</h3>
<ul>
<li>
<p>å®è£SQL Serverä¾èµåï¼å¨VS2022ä¸­ï¼å®è£<code>Microsoft.EntityFrameworkCore.SqlServer</code>ï¼éé.NET8ççæ¬ï¼ï¼</p>
</li>
<li>
<p>ä¿®æ¹appsettings.jsonï¼å°<code>ConnectionStrings:MySQL</code>æ¹ä¸º<code>ConnectionStrings:SQLServer</code>ï¼å¯¹åºdocker-compose.ymlä¸­çè¿æ¥ä¸²ï¼</p>
</li>
</ul>
<h1 id="äºç¸å³åè">äºãç¸å³åè</h1>
<p>å¦ææ¬æå¯¹ä½ æä¸ç¹ç¹å¸®å©ï¼ç¹ä¸ªèµæ¯æä¸ä¸å§ï¼ä½ çæ¯ä¸ä¸ªãèµãé½æ¯æåä½çæå¤§å¨å _</p>
<p>æ´å¤ææ¯æç« è¯·å¾:</p>
<p><a href="http://www.guosisoft.com/article" target="_blank" rel="noopener nofollow">http://www.guosisoft.com/article</a></p>
<p><a href="http://www.rdiframework.net/article" target="_blank" rel="noopener nofollow">http://www.rdiframework.net/article</a></p>
<p>å¤§å®¶ä¸èµ·å±åäº¤æµåè¿æ­¥å!!</p>


</div>
<div id="MySignature" role="contentinfo">
    <span style="font-size:10pt;">
</span>
<p>
	<br>
</p>
<p style="background-color:#f8f8ee;font-family:å¾®è½¯éé»;font-size:12px;" id="mySignature">
	<span style="font-size:10pt;">ä½èï¼</span>
	<strong>
		<span style="color:red;font-size:12px;">
			<a href="http://www.guosisoft.com/" target="_blank">
				<span>
					<span style="font-size:10pt;">RDIF</span>
				</span>
			</a>
		</span>
	</strong>
	<br>
	<span style="font-size:10pt;">åºå¤ï¼</span>
	<a href="http://www.cnblogs.com/huyong/" target="_blank">
		<span style="font-size:10pt;">http://www.cnblogs.com/huyong/</span>
	</a>
	<br>
	<span style="font-size:10pt;">Emailï¼</span>
	<a href="mailto:406590790@qq.com" target="_blank">
		<span style="font-size:10pt;">406590790@qq.com</span>
	</a>
	<br>
	<span style="font-size:10pt;">QQï¼</span>
	<span style="font-size:10pt;">406590790</span>
	<br>
	<span style="font-size:10pt;">å¾®ä¿¡ï¼</span>
	<span style="font-size:10pt;">13005007127(åææºå·)</span>
	<br>
	<span style="font-size:10pt;">æ¡æ¶å®ç½ï¼</span>  
   <a href="http://www.guosisoft.com/" target="_blank">
		<span style="font-size:10pt;">http://www.guosisoft.com/</span>
	</a>
  &nbsp;&nbsp;&nbsp;
	<a href="http://www.rdiframework.net/" target="_blank">
		<span style="font-size:10pt;">http://www.rdiframework.net/</span>
	</a>
	<br>
	<span style="font-size:10pt;">æ¡æ¶å¶ä»åå®¢ï¼</span>
	<a href="http://blog.csdn.net/chinahuyong" target="_blank">
		<span style="font-size:10pt;">http://blog.csdn.net/chinahuyong</span>
	</a>
	<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="http://www.cnblogs.com/huyong" target="_blank">
		<span style="font-size:10pt;">http://www.cnblogs.com/huyong</span>
	</a>
	<br>
	<a href="http://www.guosisoft.com/" target="_blank">
		<span style="font-size:10pt;">å½æRDIFå¼åæ¡æ¶</span>
	</a>ï¼
	<span style="font-size:10pt;color:#FFFFFF;background-color:#009900;">ç»ç¨æ·åå¼åèæä½³ç.Netæ¡æ¶å¹³å°æ¹æ¡ï¼ä¸ºä¼ä¸å¿«éæå»ºè·¨å¹³å°ãä¼ä¸çº§çåºç¨æä¾å¼ºå¤§æ¯æã</span>
	<br>
	<span style="font-size:10pt;">å³äºä½èï¼ç³»ç»æ¶æå¸ãä¿¡æ¯ç³»ç»é¡¹ç®ç®¡çå¸ãDBAãä¸æ³¨äºå¾®è½¯å¹³å°é¡¹ç®æ¶æãç®¡çåä¼ä¸è§£å³æ¹æ¡ï¼å¤å¹´é¡¹ç®å¼åä¸ç®¡çç»éªï¼æ¾å¤æ¬¡ç»ç»å¹¶å¼åå¤ä¸ªå¤§åé¡¹ç®ï¼å¨é¢åå¯¹è±¡ãé¢åæå¡ä»¥åæ°æ®åºé¢åæä¸å®çé è¯£ãç°ä¸»è¦ä»äºåºäº</span>
	<a href="http://www.guosisoft.com/" target="_blank">
		<span style="font-size:10pt;">RDIF</span>
	</a>
	<span style="font-size:10pt;">æ¡æ¶çææ¯å¼åãå¨è¯¢å·¥ä½ï¼ä¸»è¦æå¡äºéèãå»çå«çãéè·¯ãçµä¿¡ãç©æµãç©èç½ãå¶é ãé¶å®ç­è¡ä¸ã</span>
	<br>
	<span style="font-size:10pt;">å¦æé®é¢æå»ºè®®ï¼è¯·å¤å¤èµæï¼</span>
	<br>
	<span style="font-size:10pt;">æ¬æçæå½ä½èåCNBLOGSåå®¢å±æï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»ä¿çæ­¤æ®µå£°æï¼ä¸å¨æç« é¡µé¢ææ¾ä½ç½®ç»åºåæè¿æ¥ï¼å¦æé®é¢ï¼å¯ä»¥éè¿å¾®ä¿¡ãé®ç®±ãQQç­èç³»æï¼éå¸¸æè°¢ã</span>
</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.03680555555555556" data-date-updated="2026-02-12 11:37">2026-02-12 10:44</span>&nbsp;
<a href="https://www.cnblogs.com/huyong">.NETå¿«éå¼åæ¡æ¶</a>&nbsp;
éè¯»(<span id="post_view_count">168</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19607257);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19607257', targetLink: 'https://www.cnblogs.com/huyong/p/19607257', title: 'Docker Composeé¨ç½²å¤.NETåç«¯API+å¤Vueåç«¯Web å®æ´è®°å½ï¼å«å¤æ°æ®åºæ©å±+å®ç¨åºæ¯ï¼äº²æµæ åï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ºæ¯ä¸ªåäºé¨ç½²ä¸ä¸ª OpenClawï¼å®å¨å¿«éçä½éª OpenClawçé­å ]]></title>
    <link>https://www.cnblogs.com/xguo/p/19607199</link>
    <guid>2957c9b4d34c7d015467bd8905b08324</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xguo/p/19607199" title="åå¸äº 2026-02-12 10:20">
    <span role="heading" aria-level="2">ä¸ºæ¯ä¸ªåäºé¨ç½²ä¸ä¸ª OpenClawï¼å®å¨å¿«éçä½éª OpenClawçé­å</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/57355/202602/57355-20260212101930780-112933356.png" alt="ä¸ºæ¯ä¸ªåäºé¨ç½²ä¸ä¸ª OpenClawï¼å®å¨å¿«éçä½éª OpenClawçé­å" class="desc_img">
        æå¿«éåº¦æèµ· OpenClawï¼Clawdbot, Moltbotï¼ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="agent-sandboxé¨ç½²ç¥å¨ä¸ºä½ å¬å¸æ¯ä¸ªåäºé¨ç½²ä¸ä¸ªopenclawclawdbot-moltbotå¿«éä½éªopenclawclawdbot-moltbotçé­å">Agent-Sandboxé¨ç½²ç¥å¨ï¼ä¸ºä½ å¬å¸æ¯ä¸ªåäºé¨ç½²ä¸ä¸ªOpenClawï¼Clawdbot, Moltbotï¼ï¼å¿«éä½éªOpenClawï¼Clawdbot, Moltbotï¼çé­å</h1>
<p>åå­åè¿ï¼Clawdbot -&gt; Moltbot -&gt; OpoenClaw</p>
<p>ç¨å°çå·¥å·ï¼<a href="https://github.com/agent-sandbox/agent-sandbox" target="_blank" rel="noopener nofollow">https://github.com/agent-sandbox/agent-sandbox</a></p>
<h2 id="ææ">ææï¼</h2>
<p><img src="https://img2024.cnblogs.com/blog/57355/202602/57355-20260212101717131-648382280.png" alt="20260130165008" width="1300" height="1020" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/57355/202602/57355-20260212101724909-1058470393.png" alt="20260130165103" width="1300" height="1020" loading="lazy"></p>
<h2 id="ä¸ç¨agent-sandbox-ä¸­åå»ºä¸ä¸ª-openclaw-æ²ç®±">ä¸ï¼ç¨Agent-Sandbox ä¸­åå»ºä¸ä¸ª OpenClaw æ²ç®±</h2>
<p>å¨ Agent-Sandbox ä¸­ï¼æææ²ç®±çåå»ºé½éè¿åä¸ä¸ª RESTful APIï¼<code>POST /api/v1/sandbox</code>ã</p>
<p>å½ä½ å®è£å¥½ Agent-Sandboxï¼åªéè¦ä¸è¡ <code>curl</code> å°±è½å¨éç¾¤ä¸­æèµ·ä¸ä¸ª OpenClaw å®ä¾ï¼</p>
<pre><code class="language-shell">curl --location 'http://agent-sandbox.your-host.com/api/v1/sandbox' \
  --header 'Content-Type: application/json' \
  --data '{"name":"openclaw1","template":"openclaw"}'
</code></pre>
<pre><code class="language-json">{
  "code": "0",
  "data": "Sandbox openclaw-alice created successfully"
}
</code></pre>
<p>è¿ä¸æ­¥ï¼å°±å·²ç»å¨ä½ ç Kubernetes éç¾¤éä¸ºæä½åäºæèµ·äºä¸ä¸ªå®æ´å¯ç¨ç OpenClaw å®ä¾ã</p>
<h2 id="ä»çè®¿é®å°åä¼æ¯">ä»çè®¿é®å°åä¼æ¯ï¼</h2>
<p><a href="http://localhost:10000/sandbox/openclaw1" target="_blank" rel="noopener nofollow">http://localhost:10000/sandbox/openclaw1</a></p>
<h2 id="äºopenclaw-éç½®">äºãOpenClaw éç½®</h2>
<p>é»è®¤éç½®ç¤ºä¾å¦ä¸ï¼</p>
<pre><code class="language-json">{
  "models": {
    "providers": {
      "custom-1": {
        "baseUrl": "https://xxx.com/v1",
        "apiKey": "fe87c9e9-f399-49ca-98da-2f2404a249c2",
        "auth": "api-key",
        "api": "openai-completions",
        "models": []
      }
    }
  },
  "agents": {
    "defaults": {
      "model": {"primary": "custom-1/glm-4.7" },
      "workspace": "/root/.openclaw/workspace",
      "maxConcurrent": 4,
      "subagents": {
        "maxConcurrent": 8
      }
    }
  },
  "gateway": {
    "port": 18789,
    "mode": "local",
    "bind": "lan",
    "controlUi": {
      "allowInsecureAuth": true
    }
  }
}
</code></pre>
<p>æ¨¡æ¿ä¸­ç <code>openclaw.json</code> ç»åºäºä¸ä¸ªé»è®¤éç½®ç¤ºä¾ï¼åæ¬ï¼</p>
<ul>
<li><strong>æ¨¡åéç½®</strong>ï¼ç¤ºä¾ä¸­ä½¿ç¨äºåä¸º <code>custom-1/glm-4.7</code> çæ¨¡åï¼ä½ å¯ä»¥æ ¹æ®å¬å¸åé¨æ¨¡åç½å³è¿è¡è°æ´ã</li>
<li><strong>ç½å³åæ°</strong>ï¼
<ul>
<li>ç«¯å£ï¼<code>18789</code></li>
<li>ç»å®æ¨¡å¼ï¼<code>lan</code></li>
<li>è®¤è¯æ¹å¼ï¼å¯ç ç»å½ï¼ç¤ºä¾å¯ç ä¸º <code>1</code>ï¼ã</li>
</ul>
</li>
</ul>
<p>ä¹åè®¿é® <a href="http://localhost:10000/sandbox/openclaw1" target="_blank" rel="noopener nofollow">http://localhost:10000/sandbox/openclaw1</a> å³å¯è¿å¥ OpenClaw çé¢ï¼ä¿®æ¹å¤§æ¨¡ååæ°ï¼</p>
<h3 id="1ä¿®æ¹å¤§æ¨¡åprovider">1ï¼ä¿®æ¹å¤§æ¨¡åProvider</h3>
<p><img src="https://img2024.cnblogs.com/blog/57355/202602/57355-20260212101755519-621083252.png" alt="img_1" loading="lazy"></p>
<h3 id="2ä¿®æ¹agenté»è®¤å¤§æ¨¡ååç§°">2ï¼ä¿®æ¹Agenté»è®¤å¤§æ¨¡ååç§°</h3>
<p><img src="https://img2024.cnblogs.com/blog/57355/202602/57355-20260212101805822-1587622280.png" alt="img" loading="lazy"></p>
<p>æ ¹æ®éè¦è°æ´æ¨¡ååç½å³éç½®ï¼å³å¯å¼å§ä½¿ç¨ OpenClaw äºï¼</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-12 10:21">2026-02-12 10:20</span>&nbsp;
<a href="https://www.cnblogs.com/xguo">i'mèåè±</a>&nbsp;
éè¯»(<span id="post_view_count">315</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19607199);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19607199', targetLink: 'https://www.cnblogs.com/xguo/p/19607199', title: 'ä¸ºæ¯ä¸ªåäºé¨ç½²ä¸ä¸ª OpenClawï¼å®å¨å¿«éçä½éª OpenClawçé­å' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>