<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-09T20:34:40.989Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ ä»é¶å­¦ä¹ Kafkaï¼æ°æ®å­å¨ ]]></title>
    <link>https://www.cnblogs.com/Jackeyzhe/p/19597292</link>
    <guid>04aafdb98eb02703ff8a42864bccdc55</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Jackeyzhe/p/19597292" title="åå¸äº 2026-02-09 23:47">
    <span role="heading" aria-level="2">ä»é¶å­¦ä¹ Kafkaï¼æ°æ®å­å¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/1828322/202601/1828322-20260127214703996-2017510713.png" alt="ä»é¶å­¦ä¹ Kafkaï¼æ°æ®å­å¨" class="desc_img">
        ä¸ç¥éææ²¡ææååæä¸æ ·ï¼è½ç¶äºè§£ Kafka çé»è¾å­å¨ï¼ä¾å¦ BrokerãTopicãPartition è¿äºæ¦å¿µï¼ä½æ¯å¯¹äºåºå±æ°æ®æ¯å¦ä½å­å¨è¿æ¯æ¯è¾æ¨¡ç³ãè¿æ ·èèµ·æ¥ Kafka æ°æ®å­å¨æ¶æ»æç§ä¸ç¥åè§£çæè§ãä»å¤©æä»¬å°±ä¸èµ·æ¥çä¸ä¸ Kafka åºå±æ°æ®å°åºæ¯æä¹å­å¨çã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>ä¸ç¥éææ²¡ææååæä¸æ ·ï¼è½ç¶äºè§£ Kafka çé»è¾å­å¨ï¼ä¾å¦ BrokerãTopicãPartition è¿äºæ¦å¿µï¼ä½æ¯å¯¹äºåºå±æ°æ®æ¯å¦ä½å­å¨è¿æ¯æ¯è¾æ¨¡ç³ãè¿æ ·èèµ·æ¥ Kafka æ°æ®å­å¨æ¶æ»æç§ä¸ç¥åè§£çæè§ãä»å¤©æä»¬å°±ä¸èµ·æ¥çä¸ä¸ Kafka åºå±æ°æ®å°åºæ¯æä¹å­å¨çã</p>
<h3 id="ç¯å¢åå¤">ç¯å¢åå¤</h3>
<p>å¨å¼å§ä¹åï¼æä»¬åæ­å»ºå¥½åæºç Kafka éç¾¤ï¼å¹¶ä¸å®éåå¥ä¸æ¹æ°æ®ï¼è¿æ ·å°±å¯ä»¥ç´æ¥è§å¯åå¥ Kafka çæ°æ®äºãä¸é¢å¯ä»¥è·çæçæ­¥éª¤ä¸èµ·æ­å»ºéç¾¤å¹¶åå¥æ°æ®ãå¼å§ä¹ååè¯´æä¸ä¸ï¼æä½è¿ç¨ä¸­å¯è½æ¶åå°ä¸äºéç½®åæ°çä¿®æ¹åæ£æ¥ï¼å¦æå¯¹éç½®åæ°ä¸çæçè¯ï¼å¯ä»¥æ¥çä¸ä¸ç¯æç« ã</p>
<p>é¦åå° Kafka çä¸è½½é¡µé¢ä¸è½½ææ°çæ¬çåç¼©åã</p>
<pre><code class="language-bash">https://www.apache.org/dyn/closer.cgi?path=/kafka/4.1.1/kafka_2.13-4.1.1.tgz
</code></pre>
<p>ä¸è½½å¥½ä¹åï¼è¿è¡è§£åå¹¶è¿å¥å°å¯¹åºçç®å½ã</p>
<pre><code class="language-bash">tar -xzf kafka_2.13-4.1.1.tgz
cd kafka_2.13-4.1.1
</code></pre>
<p>æ¥çæä»¬æ§è¡ä¸é¢ä¸¤æ¡å½ä»¤è¿è¡ä¸äºå¿è¦çéç½®ã</p>
<pre><code class="language-bash">KAFKA_CLUSTER_ID="$(bin/kafka-storage.sh random-uuid)"

bin/kafka-storage.sh format --standalone -t $KAFKA_CLUSTER_ID -c config/server.properties
</code></pre>
<p>ä¸ºäºæ¹ä¾¿è§å¯æä»¶ååï¼ææ segment æä»¶å¤§å°è°æ´ä¸ºäº 1MBï¼å·ä½ä¿®æ¹æ¹æ³ä¸ºç¼è¾ config/server.properties æä»¶ï¼ä¿®æ¹ <code>log.segment.bytes</code> åæ°çæ°å¼ã</p>
<p><img alt="segmentsize" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1769790300/Blog/Kafka/2/kafka_segment_size.png" class="lazyload"></p>
<p>ä¿®æ¹å¥½ä¹åï¼å°±å¯ä»¥å¯å¨ Kafka éç¾¤äºã</p>
<pre><code class="language-bash">bin/kafka-server-start.sh config/server.properties
</code></pre>
<p>å¯ä»¥è§å¯æ¥å¿ï¼çéç¾¤æ¯å¦å¯å¨æå</p>
<p><img alt="clusterstarted" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1769790383/Blog/Kafka/2/cluster_started.png" class="lazyload"></p>
<p>éç¾¤å¯å¨ä¹åï¼æä»¬æå¨åå»ºä¸ä¸ªæµè¯ topicã</p>
<pre><code class="language-bash">bin/kafka-topics.sh --create \
    --bootstrap-server localhost:9092 \
    --topic test-topic \
    --partitions 2 \
    --replication-factor 1
</code></pre>
<p>æ¥çå¯ä»¥ä½¿ç¨ Kafka æä¾çåæµå·¥å·æ¥åå¥ä¸æ¹æ°æ®ã</p>
<pre><code class="language-bash">bin/kafka-producer-perf-test.sh \
    --topic test-topic \
    --num-records 50000 \
    --record-size 100 \
    --throughput -1 \
    --producer-props bootstrap.servers=localhost:9092
</code></pre>
<p>è¿éæåä¸¤æ¬¡åå¥ï¼æ¯æ¬¡åå¥äº 50000 æ¡æ°æ®ï¼æ¯æ¡æ°æ®å¤§å° 100 å­èï¼ä¹å°±æ¯ä¸å±åå¥äºå¤§çº¦ 10MB æ°æ®ã</p>
<p>ç°å¨æç®åæå <code>/tmp/kraft-combined-logs</code> è¿ä¸ªç®å½ãå¦ææ²¡æè¿ä¸ªç®å½ï¼éè¦çä¸ä¸éç¾¤éç½®çç®å½ã</p>
<p><img alt="category" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1769791316/Blog/Kafka/2/catagory.png" class="lazyload"></p>
<h3 id="broker-æ ¹ç®å½">Broker æ ¹ç®å½</h3>
<p>é¦åæ¥çç¬¬ä¸çº§ç®å½</p>
<pre><code class="language-bash">drwxr-xr-x  10 wheel  320  1æ 31 00:25 __cluster_metadata-0
-rw-r--r--   1 wheel  355  1æ 31 00:14 bootstrap.checkpoint
-rw-r--r--   1 wheel    0  1æ 31 00:14 cleaner-offset-checkpoint
-rw-r--r--   1 wheel    4  1æ 31 00:52 log-start-offset-checkpoint
-rw-r--r--   1 wheel  122  1æ 31 00:14 meta.properties
-rw-r--r--   1 wheel   42  1æ 31 00:52 recovery-point-offset-checkpoint
-rw-r--r--   1 wheel   42  1æ 31 00:52 replication-offset-checkpoint
drwxr-xr-x  23 wheel  736  1æ 31 00:33 test-topic-0
drwxr-xr-x  27 wheel  864  1æ 31 00:33 test-topic-1
</code></pre>
<p>è¿éä¸å±æ 9 ä¸ªæä»¶ï¼ç®å½ï¼ï¼å¤§ä½ä¸å¯ä»¥åä¸ºä¸ç±»ï¼<strong>éç¾¤åæ°æ®ãæ°æ®ç®å½å Checkpoint æä»¶</strong>ã</p>
<h4 id="éç¾¤åæ°æ®">éç¾¤åæ°æ®</h4>
<p><code>meta.properties</code> æ¯ Broker çèº«ä»½è¯ï¼è¿éè®°å½äº Cluster ID å Node IDã</p>
<p><code>bootstrap.checkpoint</code> ç¨äºè®°å½éç¾¤åå§åä¿¡æ¯ã</p>
<p><code>__cluster_metadata-0</code> æ¯ä¸ä¸ªç¹æ®çæ°æ®ç®å½ï¼å®è®°å½äºéç¾¤çåæ°æ®ï¼å æ­¤æå°å¶å½ç±»å°éç¾¤åæ°æ®ä¸­ã</p>
<h4 id="æ°æ®ç®å½">æ°æ®ç®å½</h4>
<p><code>test-topic-0</code> å <code>test-topic-1</code> è¿ä¸¤ä¸ªç®å½å°±æ¯æä»¬ test-topic çä¸¤ä¸ª partition å­å¨æ°æ®çç®å½ï¼å¾ä¼å¿åè¯¦ç»åæç®å½ä¸çåå®¹ï¼ç°å¨ä½ åªéè¦ç¥é Kafka æ¯ä»¥ topicå + partitionId æ¥å½åæ°æ®ç®å½çã</p>
<h4 id="checkpoint-æä»¶">Checkpoint æä»¶</h4>
<p>å©ä¸çé½æ¯ checkpoint æä»¶ï¼æ¯ç¨äºå®æºéå¯åçå¿«éæ¢å¤çã</p>
<p><code>cleaner-offset-checkpoint</code> è¿æ¯æ¸çæ£æ¥ç¹æä»¶ï¼åªæè®¾ç½®äº <code>cleanup.policy=compact</code> æ¶ææç¨ï¼å®è®°å½äºä¸ä¸æ¬¡ Log Compact åä¸ª partition å·²æ¸ççåç§»éã</p>
<p><code>log-start-offset-checkpoint</code> æ¥å¿èµ·å§ä½ç½®ï¼è®°å½æ¯ä¸ªååºç¬¬ä¸ä¸ªææç Offsetã</p>
<p><code>recovery-point-offset-checkpoint</code> è®°å½æ¯ä¸ª partition å·²å·çç Offsetã</p>
<p><code>replication-offset-checkpoint</code> è®°å½æ¯ä¸ª partition å·²åæ­¥ç Offsetï¼è¿éè®°å½çå°±æ¯ High Watermarkã</p>
<h3 id="partition-å­å¨ç»æ">Partition å­å¨ç»æ</h3>
<p>ç°å¨æä»¬åæ¥çä¸æ°æ®ç®å½ä¸çåä¸ªæä»¶çä½ç¨æ¯ä»ä¹ã</p>
<h4 id="æ ¸å¿ä¸åå¼">æ ¸å¿ä¸åå¼</h4>
<p>é¦åæ¥ä»ç»æ°æ®å­å¨çæ ¸å¿ï¼åå«æ¯ <code>.log</code> ã<code>.index</code> å <code>.timeindex</code> æä»¶ï¼æ¯ä¸ª Segment é½ä¼æè¿ä¸ä¸ªæä»¶ï¼å®ä»¬çæä»¶åé½æ¯æä»¶åå­çç¬¬ä¸æ¡æ¶æ¯ç Offsetã</p>
<h5 id="log-æä»¶">log æä»¶</h5>
<p><code>.log</code> æ¯æ¶æ¯æ°æ®æä»¶ï¼Kafka æ¥æ¶çæ¶æ¯é½ä¼é¡ºåºåå¥å°è¿ä¸ªæä»¶ä¸­ãå¯ä»¥éè¿ä¸é¢è¿ä¸ªå½ä»¤æ¥çæä»¶çåå®¹ï¼</p>
<pre><code class="language-bash">~/workspace/kafka_2.13-4.1.1/bin/kafka-dump-log.sh --files test-topic-0/00000000000000009472.log --print-data-log
</code></pre>
<p><img alt="logdata" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1769952332/Blog/Kafka/2/log_data.png" class="lazyload"></p>
<p>å¯ä»¥çå° log æä»¶ä¸­å­å¨çä¸»è¦æ¯ Offset åå·ä½çåºåååçæ°æ®ã</p>
<h5 id="index-æä»¶">index æä»¶</h5>
<p><code>.index</code> æä»¶æ¯åç§»éç´¢å¼æä»¶ï¼è¿éçç´¢å¼æ¯ç¨çç´¢å¼ï¼æä»¶åå­å¨çæ¯ Offset å° log æä»¶ä½ç½®çæ å°ãæä»¬ä½¿ç¨ä¸é¢è¿æ¡å½ä»¤æ¥æ¥çæä»¶åå®¹ï¼</p>
<pre><code class="language-bash">~/workspace/kafka_2.13-4.1.1/bin/kafka-dump-log.sh --files test-topic-0/00000000000000009472.index --deep-iteration
</code></pre>
<p><img alt="indexdata" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1769953138/Blog/Kafka/2/index_data.png" class="lazyload"></p>
<p>Kafka é»è®¤æ¯ 4KB æ°æ®åå¥ä¸æ¬¡ç´¢å¼ï¼è¿ä¸ªå¼å¯ä»¥éè¿ <code>log.index.interval.bytes</code> åæ°è°æ´ã</p>
<h5 id="timeindex-æä»¶">timeindex æä»¶</h5>
<p><code>.timeindex</code> æ¯æ¶é´æ³ç´¢å¼æä»¶ï¼ç¨æ¥æ¯æ by_duration æç§æ¶é´åæº¯ãæ¥çæä»¶åå®¹çæ¹æ³ä¸æ¥ç index æä»¶çæ¹æ³ç±»ä¼¼ï¼</p>
<pre><code class="language-bash">~/workspace/kafka_2.13-4.1.1/bin/kafka-dump-log.sh --files test-topic-0/00000000000000009472.timeindex --deep-iteration
</code></pre>
<p><img alt="timeindexdata" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1769953464/Blog/Kafka/2/timeindex_data.png" class="lazyload"></p>
<p>æä»¬å¨å®ä½æ°æ®æ¶ï¼å¯ä»¥éè¿äºåæ³å¨ index ç´¢å¼æä»¶ä¸­æ¾å°å¯¹åºçæ°æ®ä½ç½®ï¼æèææ¥è¿çä½ç½®ï¼ï¼ä¹å¯ä»¥åéè¿æ¶é´å¨ timeindex æä»¶ä¸­æ¾å°ææ¥è¿ç Offsetï¼åå° index æä»¶ä¸­æ¾å°æ°æ®ä½ç½®ã</p>
<h4 id="è¾å©æä»¶">è¾å©æä»¶</h4>
<p>é¤äºä¸è¿°ä¸ä¸ªæ ¸å¿æä»¶ä¹å¤ï¼å¨æ°æ®ç®å½ä¸­è¿æä¸ç§è¾å©æä»¶ï¼æä»¬æ¥çä¸å®ä»¬çä½ç¨ã</p>
<ul>
<li><code>.snapshot</code> æä»¶æ¯ç¨æ¥è®°å½äºå¡å¿«ç§çãç¨äº Exactly-Once è¯­ä¹ï¼å¦æ Broker å®æºï¼å¯ä»¥éè¿å è½½è¿ä¸ªæä»¶ç¥é Producer ä¹ååéå°åªéäºï¼é²æ­¢æ°æ®éå¤ãæ¥çæä»¶åå®¹çæ¹æ³å¦ä¸</li>
</ul>
<pre><code class="language-bash">~/workspace/kafka_2.13-4.1.1/bin/kafka-dump-log.sh --files test-topic-0/00000000000000009472.snapshot
</code></pre>
<ul>
<li><code>leader-epoch-checkpoint</code> æä»¶æ¯ä¸ä¸ª Leader âä»»æè¡¨âï¼å®è®°å½äºæ¯ä¸ä»» Leader å¼å§å·¥ä½æ¶ç Offsetï¼ä¸»è¦ç¨äºå¨éä¸»æ¶ä¿è¯æ°æ®ä¸è´æ§ã</li>
<li><code>partition.metadata</code> æä»¶æ¯ Partition çâèº«ä»½è¯âï¼å®å­å¨äº Topic IDã</li>
</ul>
<h3 id="page-cache">Page Cache</h3>
<p>è³æ­¤ï¼æä»¬å·²ç»æ¯è¾ç»è´çäºè§£äº Kafka åºå±å­å¨ç»æãå°è¿éä¸ç¥éä½ ä¼ä¸ä¼æçé®ï¼Kafka æ¯åç£ççï¼ä¸ºä»ä¹éåº¦è¿ä¼è¿ä¹å¿«ï¼</p>
<p>Kafka å¨æä½ç£çæ¶ï¼éåº¦ä¾èµæä½ç³»ç»ç Page Cache åè½ï¼è¿ä¸ªåè½å°±æ¯ Kafka æ§è½é«çåå ä¹ä¸ãç®åæ¥è¯´ï¼Page Cache å°±æ¯å¨è¯»åç£çæ¶ï¼æä½ç³»ç»ä¼æè¯»å°çæ°æ®æ¾å°åå­ä¸­ä¸ä»½ï¼è¿ååå­å°±æ¯ Page Cacheãå¨ Kafka çåºç¨åºæ¯ä¸­ï¼Producer åå¥é¡ºåºåå¥æ°æ®æ¶ï¼æä½ç³»ç»ä¼åææ°æ®åå° Page Cacheï¼ç¶åå¼æ­¥å·çãå¨ Consumer æ¶è´¹æ°æ®æ¶ï¼ç±äºå¤§é¨åæåµä¸é½æ¯æ¶è´¹ææ°æ°æ®ï¼å æ­¤è¦è¯»çæ°æ®å¤§æ¦çè¿å¨ Page Cache ä¸­ï¼ æä½ç³»ç»å¯ä»¥ç´æ¥ä»åå­ä¸­è¿åã</p>
<p>é¢å¤è¯ï¼Kafka ä¸ºä»ä¹ä¸èªå·±ç»´æ¤ä¸å¥ç¼å­æºå¶å¢ï¼</p>
<p>æè§å¾ä¸»è¦æä»¥ä¸åå ï¼</p>
<ol>
<li>
<p>é¿å GC å¼éï¼å¦æèªå·±å¨ JVM åå­ä¸­ç»´æ¤ç¼å­ï¼é£ä¹ä¼å¸¦æ¥å¾å¤§ç GC ååãå¦æç¨æä½ç³»ç»ç Page Cacheï¼å°±å®å¨ä¸ç¨æå¿ GC é®é¢ã</p>
</li>
<li>
<p>Page Cache å¯¹åå­çå©ç¨çæ´é«ï¼å¦æ Kafka è¿ç¨éå¯ï¼Page Cache ä¹è¿ä¼å¨åå­ä¸­ï¼æ°æ®ä¸éè¦éæ°å è½½ã</p>
</li>
<li>
<p>é»è¾ç®åï¼Kafka åªéè¦è´è´£è¯»åæä½ï¼å©ä¸çç¼å­ç»´æ¤é»è¾å¨é¨äº¤ç»æä½ç³»ç»ã</p>
</li>
</ol>
<h3 id="æ»ç»">æ»ç»</h3>
<p>æ¬ææä»¬äºè§£äº Kafka ç©çå±é¢çæ°æ®å­å¨ãå¨ Broker æ ¹ç®å½ä¸ï¼æéç¾¤åæ°æ®ãæ°æ®ç®å½ãCheckpoint æä»¶ä¸ç§ç±»åçæä»¶ï¼ç®å½ï¼ãå¨æ°æ®ç®å½ä¸­ï¼ææ ¸å¿çä¸ç§æä»¶æ¯ <code>.log</code>ã<code>.index</code> å <code>.timeindex</code> ä¸ç§æä»¶ï¼å®ä»¬åå«å­å¨äºæ°æ®ãç¨ç Offset ç´¢å¼ä»¥åæ¶é´æ³ä¸ Offset çæ å°ã</p>
<p>å¸æä½ éè¿éè¯»æ¬æï¼å¯ä»¥å¯¹ Kafka çæ°æ®å­å¨æä¸ä¸ªæ´å æ¸æ°çè®¤è¯ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 23:48">2026-02-09 23:47</span>&nbsp;
<a href="https://www.cnblogs.com/Jackeyzhe">Jackeyzhe</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19597292);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19597292', targetLink: 'https://www.cnblogs.com/Jackeyzhe/p/19597292', title: 'ä»é¶å­¦ä¹ Kafkaï¼æ°æ®å­å¨' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åå®¢ç³»ç»æµè¯æ¥å ]]></title>
    <link>https://www.cnblogs.com/xi-yongqi/p/19597272</link>
    <guid>6275c6ae574f2bec8d01e00e914d2d7b</guid>
    <description>
    <![CDATA[ 
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xi-yongqi/p/19597272" title="åå¸äº 2026-02-09 23:36">
    <span role="heading" aria-level="2">åå®¢ç³»ç»æµè¯æ¥å</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h3 id="é¡¹ç®èæ¯">é¡¹ç®èæ¯</h3>
<ul>
<li>åå®¢ç³»ç»éç¨ååç«¯åç¦»çæ¶æå®ç°ãåç«¯ä¸»è¦æåä¸ªé¡µé¢ææï¼ç»å½é¡µãåå®¢åè¡¨é¡µãåå®¢è¯¦æé¡µãåå®¢ç¼è¾é¡µé¢ï¼ä¸é¢åä¸ªé¡µé¢æ¨¡æå®ç°äºæç®åçåå®¢ç³»ç»ãç»ååç«¯ï¼å®ç°äºç»å½ãåå¸åå®¢ãç¼è¾åå®¢ãå é¤åå®¢ãæ³¨éãå¼ºå¶ç»éåè½ã</li>
<li>è¯¥åå®¢ç³»ç»å¯ä»¥å®ç°ä¸ªäººç¨æ·ç®åçåå®¢è®°å½ï¼åå¸æ¶é´ãæ é¢å±ç¤ºãåå®¹è¯¦æä»¥åä½èä¿¡æ¯é½å¯ä»¥è¿è¡æ¥çã</li>
</ul>
<h3 id="é¡¹ç®åè½">é¡¹ç®åè½</h3>
<h5 id="è¯¥åå®¢ç³»ç»ä¸»è¦å®ç°äºç»å½æ³¨éååå®¢å é¤åå®¢ç­åè½">è¯¥åå®¢ç³»ç»ä¸»è¦å®ç°äºï¼ç»å½ãæ³¨éãååå®¢ãå é¤åå®¢ç­åè½ã</h5>
<ul>
<li>ç»å½åè½ï¼ç¨æ·åä»¥åå¯ç å·²ç»åå¥æ°æ®åºï¼æ²¡æå®ç°æ³¨ååè½ï¼éè¦æ³¨åæ°ç¨æ·éè¦å¨æ°æ®åºæå¨æ·»å ãå¨ç»éæååä¼è¿å¥åå®¢åè¡¨é¡µé¢ï¼ç»å½é¡µé¢å³ä¸è§å­å¨âä¸»é¡µâãâååå®¢âä¸¤ä¸ªæé®ï¼å¦ææ²¡æç»éå°±ç´æ¥è®¿é®åè¡¨é¡µä¼ç´æ¥è·³è½¬å°ç»éé¡µé¢ã</li>
<li>åè¡¨é¡µé¢ï¼å¨åè¡¨é¡µé¢å¯ä»¥çå°æéæ°éçåå®¢ï¼æ¯ä¸ä¸ªåå®¢åæ¬ï¼æ é¢ãåå¸æ¶é´ãåå®¹æ¦è¦ä»¥åæ¥çå¨ææé®ï¼åè¡¨é¡µå·¦ä¾§æ¯ç¨æ·ä¿¡æ¯ï¼å­å¨å¤´åãæµç§°ãæç« ä»¥åæç« åç±»æ°ï¼åè¡¨é¡µé¢å³ä¸è§å­å¨âä¸»é¡µâãâååå®¢âãâæ³¨éâä¸ä¸ªæé®ï¼ä¸»é¡µå°±æ¯åè¡¨é¡µé¢ï¼ååå®¢æ¯ç¼è¾é¡µé¢ï¼æ³¨éå°±æ¯éåºç»å½ï¼è¿åç»éé¡µé¢ã</li>
<li>è¯¦æé¡µé¢ï¼å¨åè¡¨é¡µé¢ç¹å»âæ¥çå¨æâæé®ä¼è·³è½¬å°åå®¢è¯¦æé¡µé¢ï¼æ­¤æ¶ä¼çå°åå®¢çå¨æåå®¹ãå¨åå®¢è¯¦æé¡µé¢åæ ·ä¼æåå®¢æ é¢ãåå¸æ¶é´ç­ä¿¡æ¯ï¼åæ¶è¿å­å¨ç¼è¾ãå é¤æé®ï¼å³ä¸è§ä¹åæ ·å­å¨âä¸»é¡µâãâååå®¢âãâæ³¨éâä¸ä¸ªæé®ãç¹å»å é¤æé®ä¼å¨å®æå é¤åè·³è½¬å°åè¡¨é¡µé¢ï¼ç¹å»ç¼è¾æé®ä¼è¿å¥ç¼è¾æ¨¡å¼ï¼å·¦è¾¹æ¯ç¼è¾åçæ ·å¼ï¼å³è¾¹ä¼åæ­¥æ¾ç¤ºç¼è¾åçæ ·å¼ï¼ç¼è¾å®æåç¹å»âæ´æ°æç« âæé®ï¼ä¼è·³è½¬å°åè¡¨é¡µé¢ã</li>
<li>ååå®¢é¡µé¢ï¼ç¹å»âååå®¢âæé®ä¼è¿å¥ç¼è¾é¡µé¢ï¼æ­¤æ¶å°±å¯ä»¥è¿è¡åå®¢ç¼åï¼ç¹å»âåå¸æç« âæé®ï¼åå¸åä¼è·³è½¬å°åè¡¨é¡µé¢ã</li>
</ul>
<h3 id="æµè¯è®¡å">æµè¯è®¡å</h3>
<h4 id="åè½æµè¯">åè½æµè¯</h4>
<ul>
<li>
<p>æµè¯ç¨ä¾ï¼èå¾å±ç¤ºï¼<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209200705366-521960011.png" class="lazyload"></p>
</li>
<li>
<p>å®éæµè¯æ§è¡æ­¥éª¤é¨åå±ç¤º</p>
</li>
</ul>
<ol>
<li>æ­£å¸¸ç»å½<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209201009704-1518181234.png" class="lazyload"></li>
<li>ååå®¢æµè¯<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209201337404-31535944.png" class="lazyload"></li>
<li>åå®¢åå¸åè¿å¥è¯¦æé¡µè¿è¡æ¥ç<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209201508754-1750559764.png" class="lazyload"></li>
<li>å é¤åå®¢</li>
</ol>
<ul>
<li>åæ2026-02-09 20:14åå¸çé£ç¯æç« å°±è¢«å é¤<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209201718720-2069130970.png" class="lazyload"></li>
</ul>
<ol start="5">
<li>ç¹å»âæ³¨éâæé®æååå°ç»å½é¡µé¢<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209201802336-1743616799.png" class="lazyload"></li>
</ol>
<h4 id="æ¥å£èªå¨åæµè¯">æ¥å£èªå¨åæµè¯</h4>
<ul>
<li><a href="https://www.cnblogs.com/xi-yongqi/p/19571986" target="_blank">æ¥å£èªå¨åæµè¯ç»æå±ç¤º</a></li>
</ul>
<h4 id="æ§è½æµè¯">æ§è½æµè¯</h4>
<ul>
<li>ä½¿ç¨jmeterè¿è¡ç®åçæ§è½æµè¯ï¼å¨è¿ä¸ªè¿ç¨ä¸­éè¦ä½¿ç¨postmanè¿è¡éåï¼è·åç¸å³è¯·æ±å¤´ä¿¡æ¯ã</li>
<li>æ·»å httpè¯·æ±é»è®¤å¼<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209204643780-448143202.png" class="lazyload"></li>
<li>æ·»å HTTPä¿¡æ¯å¤´ç®¡çå¨<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209204718678-937200365.png" class="lazyload"></li>
<li>æ¨¡æå¤ç»ç¨æ·ç»å½<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209204816472-684300318.png" class="lazyload"></li>
</ul>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209204833722-1194325797.png" class="lazyload"></p>
<ul>
<li>ç»å½æ¥å£<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209204925916-1741863794.png" class="lazyload">
<ul>
<li>ä½¿ç¨JSONæ­è¨å¤æ­è·åå°çtokenæ¯å¦ç¬¦åè¦æ±<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209205041379-2112726203.png" class="lazyload"></li>
</ul>
</li>
<li>åè¡¨æ¥å£</li>
</ul>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209205217082-1003185259.png" class="lazyload"></p>
<ul>
<li>è¯¦æé¡µæ¥å£</li>
</ul>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209205554883-1741692731.png" class="lazyload"></p>
<ul>
<li>
<p>ç»æå±ç¤º<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209205808169-2026356355.png" class="lazyload"></p>
</li>
<li>
<p>ä½¿ç¨å½ä»¤<code>Jmeter -n -t åå®¢ç³»ç»æ§è½æµè¯.jmx -l test.jtl -e -o reports</code>å¨ç»ç«¯çææµè¯æ¥å<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209205943308-181549083.png" class="lazyload"></p>
</li>
<li>
<p><a href="https://gitee.com/xylophone-queen/write-with-python/tree/dev/jmeter%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" target="_blank" rel="noopener nofollow">jmeteræµè¯ç»æé¾æ¥</a></p>
</li>
</ul>
<h3 id="æµè¯éè¦æ³¨æçç¹">æµè¯éè¦æ³¨æçç¹</h3>
<ul>
<li>å¨ç»å½æååï¼ä¼å¾å°å¦ä¸æ°æ®ï¼<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3672332/202602/3672332-20260209211223728-1095669383.png" class="lazyload"></li>
<li>å¶ä¸­"data"ä¸­çæ°æ®å¨åé¢ææé¡µé¢é½éè¦ä½¿ç¨ï¼å¹¶ä¸è¯¥dataæ°æ®æ¯å¨æååçï¼æä»¬å¯ä»¥ä½¿ç¨æ­£åè¡¨è¾¾å¼æ¥è·åå¹¶è¿è¡æ ¡éªã</li>
<li>ä½¿ç¨jmeteræ§è½æµè¯ï¼æ¥å£çurlå°åé½æ¯ä»¥<code>http://47.108.157.13:8090</code>å¼å§ï¼å æ­¤ä½¿ç¨Httpè¯·æ±é»è®¤å¼è¿è¡ç»ä¸è®¾ç½®æ¥èçæµè¯æ¶é´ï¼é¿åéå¤éç½®ã</li>
</ul>


</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 23:36">2026-02-09 23:36</span>&nbsp;
<a href="https://www.cnblogs.com/xi-yongqi">æä¼æ¿é£å»</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19597272);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19597272', targetLink: 'https://www.cnblogs.com/xi-yongqi/p/19597272', title: 'åå®¢ç³»ç»æµè¯æ¥å' })">ä¸¾æ¥</a>
</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ AI æ¶ä»£çåç«¯ææ¯ï¼ä»ç³»ç»ç¼ç¨å° JavaScript/TypeScript ]]></title>
    <link>https://www.cnblogs.com/kaiux/p/19596869</link>
    <guid>8350dedfce954601baf4660731e18d33</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/kaiux/p/19596869" title="åå¸äº 2026-02-09 20:26">
    <span role="heading" aria-level="2">AI æ¶ä»£çåç«¯ææ¯ï¼ä»ç³»ç»ç¼ç¨å° JavaScript/TypeScript</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/1158182/202602/1158182-20260209202606764-2110726327.png" alt="AI æ¶ä»£çåç«¯ææ¯ï¼ä»ç³»ç»ç¼ç¨å° JavaScript/TypeScript" class="desc_img">
        æ¬ä¹¦ä»ç³»ç»ç¨åºåçè§è§ï¼æ·±å¥è§£æäº JavaScript å TypeScript å¨ç°ä»£åºç¨ä¸­çæ ¸å¿ä½ç¨ï¼å°¤å¶æ¯å¨äººå·¥æºè½ï¼AIï¼åé«å¹¶åç³»ç»ä¸­çåºç¨ãéè¿åææµè§å¨å¼æãæå»ºå·¥å·ãè¿è¡æ¶æºå¶åè¯­è¨è®¾è®¡ï¼æ­ç¤ºäºåç«¯ææ¯æ å¦ä½æ¯æ AGI çåå±ãä» V8 å¼æçæ§è½ä¼åå°å¼æ­¥ç¼ç¨æ¨¡åçæ¼åï¼æ¬ä¹¦ä¸ä»å¸®å©å¼åèçè§£åç«¯çåºå±åçï¼ä¹ä¸ºçè§£æªæ¥ AI äº¤äºè®¾è®¡æä¾äºææ¯è§éã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p><img src="https://img2024.cnblogs.com/blog/1158182/202602/1158182-20260209202523377-936731118.png" alt="å¨æ¯2" loading="lazy"></p>
<h2 id="åè¨å½-ai-çå¤§èè·å¨-v8-å¼æä¹ä¸">åè¨ï¼å½ AI çâå¤§èâè·å¨ V8 å¼æä¹ä¸</h2>
<p><strong>The Prologue: When AGI Meets the Event Loop</strong></p>
<p>å¨ä¼ ç»çç³»ç»ç¨åºåç¼ä¸­ï¼åç«¯å¼åå¾å¾è¢«æç§°ä¸ºâDIV å±ä¸­å·¥ç¨å¸âæâNPM ä¾èµæ¬è¿å·¥âãæä»¬ä¹ æ¯äºè®¤ä¸ºï¼çæ­£çè®¡ç®ââé£äºæ¶åé«æ§è½ãé«å¹¶åãåºå±ç¡¬ä»¶è°åº¦çä»»å¡ââå¿ç¶å±äº C++ãRust æ Python çé¢å°ã</p>
<p><strong>ç¶èï¼å¨éå¾ AGIï¼éç¨äººå·¥æºè½ï¼çéè·¯ä¸ï¼ä¸ä¸ªåç´è§çç°è±¡æ­£å¨åçã</strong></p>
<p>å¦æä½ æè§£å½ä¸æç­é¨ç AI é¡¹ç®ï¼ä½ ä¼æè®¶å°åç°ï¼<strong>TypeScript å JavaScript æ­£å¨æä¸º AI åºç¨å±çâå®æ¹è¯­è¨âã</strong></p>
<ul>
<li><strong>OpenClaw (ClawdBot):</strong> è¿æ¯ä¸ä¸ªå¼ºå¤§çæ¬å°èªä¸»æºè½ä½ï¼Autonomous Agentï¼ï¼å®çâä¸­æ¢ç¥ç»âå¹¶éç± Python ç¼åï¼èæ¯è¿è¡å¨ Node.js çäºä»¶å¾ªç¯ä¹ä¸ã</li>
<li><strong>Claude Code / OpenCode:</strong> è¿äºè®©å¼åèæå¹ç AI ç¼ç¨å©æ CLIï¼å¶åºå±æ¶æå¾å¾æ¯ TypeScript å ä¸ V8 å¼æçè¿è¡æ¶ã</li>
<li><strong>Electron çæ:</strong> æ æ°çå¤§æ¨¡åæ¬å°å®¢æ·ç«¯ï¼Local LLM Runnersï¼ï¼æ¬è´¨ä¸é½æ¯ Chromium åæ ¸åè£¹ä¸ç Web åºç¨ã</li>
</ul>
<p><strong>ä¸ºä»ä¹ä¼è¿æ ·ï¼</strong></p>
<p>å ä¸º AI æ¶ä»£çæ¬è´¨åçäºååãå¤§æ¨¡åï¼LLMï¼æ¬èº«æ¯è®¡ç®å¯éåçï¼ç± CUDA/C++ è§£å³ï¼ï¼ä½<strong>AI åºç¨ï¼Agentï¼çæ¬è´¨æ¯ IO å¯éåç</strong>ã</p>
<p>ä¸ä¸ªä¼ç§ç AI Agent éè¦åæ¶å¤çæç¾ä¸åä¸ªå¹¶åçç½ç»è¯·æ±ï¼API Callsï¼ãéè¦å®æ¶è§£æéç»æåç JSON æ°æ®ãéè¦çµæ´»å°å è½½åç§âå·¥å·ï¼Toolsï¼âå½æ°ãéè¦æå»ºå¤æçå¼æ­¥äº¤äºçé¢ã</p>
<p>å¨å¤ç<strong>é«å¹¶å I/O</strong> å <strong>å¨æ JSON Schema</strong> æ¹é¢ï¼æ²¡æä»ä¹æ¯ <strong>Event Loop (libuv)</strong> å <strong>TypeScript ç±»åç³»ç»</strong> æ´é«æçç»åäºã</p>
<p><strong>å¨ AI æ¶ä»£ï¼ææ¡åç«¯ææ¯æ ï¼ä¸åæ¯ä¸ºäºç»åºæ¼äº®çç½é¡µï¼èæ¯ä¸ºäºæå»º AI çâèº¯å£³âä¸âæèâã</strong></p>
<p>å¦æä½ ä¸æ Promiseï¼ä½ å°±æ æ³çè§£ Agent çå¹¶åæèæ¨¡å¼ï¼å¦æä½ ä¸æ Virtual DOMï¼ä½ å°±æ æ³æå»ºé«æç AI äº¤äºç»ç«¯ï¼å¦æä½ ä¸æ Node.js è¿è¡æ¶ï¼ä½ å°±æ æ³å®å¨ææ§é£äºå¨è¯¥è¿è¡æ¶ä¸é£å¥çæºè½ä½ã</p>
<p>ä¸è¦è¢«âåç«¯âäºå­è¿·æãè¿æ¬æåå°å¸¦ä½ è¶è¿æµè§å¨çå´å¢ï¼ç¨ç³»ç»å·¥ç¨å¸çè§è§ï¼éæ°å®¡è§è¿å¥æ­£å¨å®ä¹ AI åºç¨å±çææ¯æ ã</p>
<p><strong>Welcome to the metal of the modern web.</strong></p>
<h2 id="1-çæå¨æ¯å¾--å¹»è±¡ä¸è£¸æº-the-illusion-vs-the-metal">1. çæå¨æ¯å¾ ââ å¹»è±¡ä¸è£¸æº (The Illusion vs. The Metal)</h2>
<p>å¯¹äºä¹ æ¯äºç³»ç»åºå±ç¼ç¨çç¨åºåï¼åå¥åç«¯ä¸çå¯è½ä¼æå°ä¸ç§ <strong>âåå½¢çæ··ä¹±â</strong> ï¼WebpackãViteãBabelãESLintãPrettierãPostCSSâ¦â¦è¿äºå·¥å·åè¤èä¸æ ·ç¼ ç»å¨ä¸èµ·ã</p>
<p>è¿æ¶åï¼è¯·ææ¶å¿æé£äºè±å¨çåè¯ãè®©æä»¬åå¥ç¦»æä½ç³»ç»æ½è±¡å±ä¸æ ·ï¼ç´æ¥çå <strong>âè£¸æºâ (The Metal)</strong> ã</p>
<h3 id="11-the-hard-constraint-ç©çæ³å">1.1. The Hard Constraint: ç©çæ³å</h3>
<p>å¨ Web å¼åçå®å®éï¼æµè§å¨ï¼Browserï¼å°±æ¯ä½ ç<strong>ç®æ ç¡¬ä»¶æ¶æ (Target Architecture)</strong>ã</p>
<p>æ è®ºä½ å¨ IDE éåå¾å¤ä¹å¤©è±ä¹±å ââä½¿ç¨äº TypeScript çé«çº§æ³åãReact çå½æ°å¼ç»ä»¶ãVue çåæä»¶æ¨¡æ¿ãè¿æ¯ SCSS çåµå¥è¯­æ³ââ<strong>æµè§å¨ä¸æ¦ä¸è®¤è¯</strong>ã</p>
<p>Chrome (V8 å¼æ) å Firefox (SpiderMonkey) æ¬è´¨ä¸æ¯ C++ ç¼åçè§£éå¨/JIT ç¼è¯å¨ï¼å®ä»¬<strong>åª</strong>æ¥åä¸ç§è¾å¥æ ¼å¼ï¼</p>
<ol>
<li><strong>HTML:</strong> DOM æ çæè¿°æä»¶ï¼ç±»ä¼¼ UI å¸å± XMLï¼ã</li>
<li><strong>CSS:</strong> æ ·å¼æè¿°ã</li>
<li><strong>JavaScript (ES5/ES6+):</strong> å¯ä¸çæä»¤éæ¶æ (ISA)ã</li>
</ol>
<p><strong>è¿æå³çï¼åç«¯å·¥ç¨åçæ¬è´¨ï¼å°±æ¯ä¸ä¸ªåºå¤§çâäº¤åç¼è¯âç³»ç» (Cross-Compilation System)ã</strong> ææçå¤æåº¦ï¼é½æºäºæä»¬éè¦æäººç±»åå¥½çâé«çº§è¯­è¨âï¼.ts, .vue, .jsxï¼ç¿»è¯ææµè§å¨è¿å°âè£¸æºâè½åä¸çâæºå¨ç âï¼.js, .html, .cssï¼ã</p>
<h3 id="12-nodejs-çåéèº«ä»½-the-build-environment">1.2. Node.js çåéèº«ä»½: The Build Environment</h3>
<p>è¿å°±å¼åºäºä¸ä¸ªæè®©åç«¯å¼åèå°æçé®é¢ï¼<em>âæå°±åä¸ªç½é¡µï¼ä¸ºä»ä¹éè¦å®è£ Node.jsï¼â</em></p>
<p>è¿éå­å¨ä¸ä¸ª<strong>è®¤ç¥é·é±</strong>ãNode.js å¨åç«¯çæä¸­æ®æ¼äºä¸¤ä¸ªå®å¨ä¸åçè§è²ï¼å¿é¡»ä¸¥æ ¼åºåï¼</p>
<h4 id="121-è§è²-aæå¡å¨è¿è¡æ¶-server-runtime">1.2.1. è§è² Aï¼æå¡å¨è¿è¡æ¶ (Server Runtime)</h4>
<p>è¿æ¯ä½ çæçãå Python æ Java ä¸æ ·ï¼Node.js ä½ä¸ºä¸ä¸ªå¸¸é©»è¿ç¨è¿è¡å¨æå¡å¨ä¸ï¼å¤ç HTTP è¯·æ±ï¼è¿æ¥æ°æ®åºãè¿å« <strong>Backend / SSR (Server-Side Rendering)</strong>ã</p>
<h4 id="122-è§è²-bæå»ºå·¥å·è¿è¡æ¶-the-build-environment--è¿æ¯éç¹">1.2.2. è§è² Bï¼æå»ºå·¥å·è¿è¡æ¶ (The Build Environment) ââ <strong>è¿æ¯éç¹</strong></h4>
<p>è¿æ¯ä½ å®è£å®ççæ­£åå ã<br>
å¨å¼åé¶æ®µï¼ä½ ççµèä¸å¹¶æ²¡æè¿è¡âæå¡å¨âï¼èæ¯è¿è¡äºä¸ä¸ª<strong>æå»ºç³»ç»</strong>ã</p>
<ul>
<li><strong>Node.js æ¯ä½ ç <code>make</code> + <code>gcc</code> + <code>ld</code>ã</strong></li>
<li><strong><code>package.json</code> æ¯ä½ ç <code>Makefile</code> / <code>CMakeLists.txt</code>ã</strong></li>
<li><strong><code>npm</code> / <code>pnpm</code> æ¯ä½ ç <code>vcpkg</code> / <code>apt-get</code>ã</strong></li>
</ul>
<p>å½ä½ æ§è¡ <code>npm run build</code> æ¶ï¼ä½ å®éä¸æ¯å¯å¨äºä¸ä¸ª Node.js è¿ç¨ãè¿ä¸ªè¿ç¨å è½½äºåä¸º <strong>Vite</strong> æ <strong>Webpack</strong> çåºï¼ç¼è¯å¨é©±å¨ï¼ï¼å®ä»¬è¯»åä½ çæºç ï¼è¿è¡è¯æ³åæãè½¬æ¢ãé¾æ¥ãåç¼©ï¼æåååº <code>dist/</code> ç®å½ã</p>
<blockquote>
<p><strong>ç³»ç»è§è§ç±»æ¯ï¼</strong><br>
ä½ å¨ Windows ä¸å C++ï¼ç®æ å¹³å°æ¯ Linuxãä½ éè¦å®è£ WSL (Node.js ç¯å¢) æ¥è¿è¡ GCC (Vite/Webpack)ï¼æç»çæ ELF æä»¶ (bundle.js) æå° Linux æå¡å¨ (Browser) ä¸å»è·ã</p>
</blockquote>
<h3 id="13-the-abstractions-æ¡æ¶å³-dsl">1.3. The Abstractions: æ¡æ¶å³ DSL</h3>
<p>æ¢ç¶æµè§å¨åªè®¤ JSï¼ä¸ºä»ä¹æä»¬è¦åæ React å Vueï¼</p>
<p>å ä¸ºåçç DOM API (<code>document.createElement</code>, <code>appendChild</code>) å°±åæ¯ <strong>Win32 API</strong> æè <strong>X11</strong>ââæå¶ç¹çãæä»¤å¼ãä¸é¾ä»¥ç»´æ¤ã</p>
<p>ç°ä»£åç«¯æ¡æ¶æ¬è´¨ä¸æ¯ <strong>DSL (é¢åç¹å®è¯­è¨)</strong>ï¼æ¨å¨è§£å³ UI å¼åä¸­ç<strong>ç¶æåæ­¥</strong>é¾é¢ã</p>
<h4 id="131-react-the-immutable-state-machine">1.3.1. React (The Immutable State Machine)</h4>
<p>React çæ ¸å¿å²å­¦æ¯ <code>UI = f(State)</code>ã<br>
JSX çèµ·æ¥å HTMLï¼ä½å®åªæ¯ <code>React.createElement()</code> çè¯­æ³ç³ã</p>
<ul>
<li><strong>Source (JSX):</strong></li>
</ul>
<pre><code class="language-jsx">// è¿ä¸æ¯ HTMLï¼è¿æ¯ JS è¡¨è¾¾å¼
const element = &lt;div className="btn"&gt;Click {count}&lt;/div&gt;;

</code></pre>
<ul>
<li><strong>Compiled (JS):</strong></li>
</ul>
<pre><code class="language-javascript">// ç¼è¯å¨ï¼Babel/Viteï¼å°å¶è½¬åä¸ºï¼
const element = React.createElement("div", { className: "btn" }, "Click ", count);

</code></pre>
<p><strong>æ¬è´¨ï¼</strong> React å¼å¥äº <strong>Virtual DOM</strong>ï¼è¿å®éä¸å°±æ¯å¾å½¢å­¦ä¸­ç <strong>åéç¼å² (Double Buffering)</strong>ãå®å¨åå­ä¸­æå»ºä¸ä¸å¸§ç UI æ ï¼è®¡ç® Diffï¼ç¶åä¸æ¬¡æ§éè¿ syscall (DOM API) æ´æ°å±å¹ï¼é¿åé¢ç¹ IO å¸¦æ¥çæ§è½æèã</p>
<h4 id="132-vue-the-reactive-observer">1.3.2. Vue (The Reactive Observer)</h4>
<p>Vue ç <code>.vue</code> æä»¶æ¯æ´çº¯ç²¹ç DSLãå®çè³ä¸ç¬¦å JS è¯­æ³ï¼å¿é¡»ç±ç¼è¯å¨ï¼Vue Compilerï¼å¤§å¸ä¸åã</p>
<ul>
<li><strong>Template:</strong> ç¼è¯æ Render Function (ç±»ä¼¼ React)ã</li>
<li><strong>Script:</strong> ç»è¿ TS è½¬è¯ã</li>
<li><strong>Style:</strong> ç»è¿ CSS é¢å¤çã</li>
</ul>
<p><strong>æ¬è´¨ï¼</strong> Vue 3 å©ç¨äº ES6 ç <code>Proxy</code> å¯¹è±¡ï¼å®ç°äºå¯¹åå­æ°æ®ç<strong>æ¦æª</strong>ãè¿ç±»ä¼¼äº C++ çæºè½æéæè¿ç®ç¬¦éè½½ï¼å½ä½ ä¿®æ¹åéæ¶ï¼èªå¨è§¦ååè°å»æ´æ° UIã</p>
<h3 id="14-æ»ç»the-pipeline-visualization">1.4. æ»ç»ï¼The Pipeline Visualization</h3>
<p>ç°å¨ï¼æä»¬å°æ´ä¸ªæµç¨ä¸²èèµ·æ¥ãä½ä¸ºç³»ç»æ¶æå¸ï¼ä½ èä¸­åºè¯¥å»ºç«èµ·è¿æ ·ä¸å¼ æ°æ®æµå¾ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1158182/202602/1158182-20260209202549474-1723785530.png" alt="mermaid" loading="lazy"></p>
<p><strong>æ ¸å¿ç»è®ºï¼</strong></p>
<ol>
<li><strong>å¹»è±¡ (Illusion):</strong> æä»¬å¨å TypeScriptãReact HooksãVue Templatesã</li>
<li><strong>ç°å® (Reality):</strong> æä»¬å¨åéç½®ï¼æç¤º Node.js è¿ç¨å¦ä½çæä¸å ç»è¿æ··æ·çãæµè§å¨è½è¯»æç ES5 ä»£ç ã</li>
<li><strong>Vite çä½ç¨ï¼</strong> å®å°±æ¯é£ä¸ª<strong>æéçå¢éé¾æ¥å¨ (Incremental Linker)</strong>ãå¨å¼åæ¶ï¼å®å©ç¨æµè§å¨ç ESM ç¹æ§åâå¨æé¾æ¥âï¼å¨åå¸æ¶ï¼å®è°ç¨ Rollup åâéæé¾æ¥â (Bundling)ã</li>
</ol>
<p>çè§£äºè¿ä¸ç¹ï¼å°±ä¸ä¼åè¢« <code>npm install</code> ä¸è½½çå åä¸ªååå°äºââé£åªæ¯ä¸ºäºç¼è¯ä½ çä»£ç èåå¤ç<strong>ç¼è¯å¨å·¥å·é¾</strong>èå·²ã</p>
<h2 id="2-runtime--the-metal--å¼æçåå®-the-engines-roar">2. Runtime &amp; The Metal ââ å¼æçåå® (The Engine's Roar)</h2>
<p>å¨ç¬¬ä¸ç« ï¼æä»¬å¥ç¦»äºæå»ºå·¥å·çå¹»è±¡ãç°å¨ï¼è®©æä»¬æè§çº¿èç¦å°ä»£ç çæ­£è¿è¡çå°æ¹ââ<strong>è¿è¡æ¶ (Runtime)</strong>ã</p>
<p>ä½ä¸ºç³»ç»å¼åèï¼ä½ å¯è½å¯¹è§£éåè¯­è¨ææåè§ï¼æ¢ãå¨æãä¸å¯é¢æµãä½ä»å¤©ç JavaScript å¼æï¼ç¹å«æ¯ Google ç V8ï¼å®éä¸æ¯ä¸ä¸ª<strong>æå¶å¤æçãåºäºéç½®æä»¶çå¨æä¼åç¼è¯å¨ (Profile-Guided Optimizing Compiler)</strong>ãå®å¨æäºåºæ¯ä¸çæ§è½çè³è½é¼è¿æªé«åº¦ä¼åç C++ã</p>
<p>è®©æä»¬é»è¿å¼æçä¸é¢ççã</p>
<h3 id="21-v8-çæ¬è´¨jit-ä¸å¨æè¿ä¸ä»-just-in-time-compilation">2.1. V8 çæ¬è´¨ï¼JIT ä¸å¨æè¿ä¸ä» (Just-In-Time Compilation)</h3>
<p>V8 å¹¶éåèå¼ Python é£æ ·éè¡è§£éæ§è¡ãå®æ¯ä¸ä¸ªå¤çº§ç¼è¯æµæ°´çº¿ã</p>
<ul>
<li><strong>Ignition (è§£éå¨):</strong> å½ä½ ç JS ä»£ç ç¬¬ä¸æ¬¡è¿è¡æ¶ï¼V8 ä¼å°å¶è§£æä¸º<strong>å­èç  (Bytecode)</strong> å¹¶ç± Ignition è§£éæ§è¡ãè¿ä¸æ­¥æ¯ä¸ºäºå¯å¨éåº¦ (Startup Time)ââå°±å Python ç <code>.pyc</code>ã</li>
<li><strong>TurboFan (ä¼åç¼è¯å¨):</strong> å¨ä»£ç è¿è¡è¿ç¨ä¸­ï¼V8 ä¼æ¶é<strong>åææ°æ® (Profiling Data)</strong>ã</li>
<li>å¦æå®åç°æä¸ªå½æ°è¢«åå¤è°ç¨ï¼"Hot" Functionï¼ï¼TurboFan å°±ä¼ä»å¥ã</li>
<li>å®ä¼å°å­èç ç¼è¯æé«åº¦ä¼åç<strong>æºå¨ç  (Machine Code)</strong>ã</li>
<li><em>System Analogy:</em> è¿å°±åä½ ç CPU å¨è¿è¡æ¶å¨æå°éåæä»¤æµï¼æè JVM ç HotSpot æºå¶ã</li>
</ul>
<h4 id="211-å³é®ææ¯åèç¼å­-inline-caching--hidden-classes">2.1.1. å³é®ææ¯ï¼åèç¼å­ (Inline Caching / Hidden Classes)</h4>
<p>JS æ¯å¨æç±»åçã<code>obj.x</code> å¨ C++ éæ¯ä¸ä¸ªåºå®çåå­åç§»éï¼Offsetï¼ï¼ä½å¨ JS éï¼å¼æçè®ºä¸æ¯æ¬¡é½è¦å» Hash Map éæ¥æ¾ <code>x</code>ãè¿æ¢å¾ä»¤äººåæã</p>
<p><strong>V8 çè§£å³æ¹æ¡æ¯âéèç±»â (Hidden Classes / Shapes)ï¼</strong></p>
<ol>
<li>å½ä½ å <code>function Point(x, y) { this.x = x; this.y = y; }</code> æ¶ï¼V8 å¨åé¨ææåå»ºäºä¸ä¸ªç±»ä¼¼ C++ <code>struct</code> çå¸å±æè¿°ã</li>
<li><strong>åèç¼å­ (IC):</strong> å½å¼æç¬¬ä¸æ¬¡è®¿é® <code>p.x</code> æ¶ï¼å®ä¼æ¥æ¾ Hash Mapï¼ä½å®ä¼<strong>è®°ä½</strong>è¿æ¬¡æ¥æ¾çç»æï¼âå¯¹äº <code>Point</code> è¿ç§å½¢ç¶çå¯¹è±¡ï¼<code>x</code> çåç§»éæ¯ 0âã</li>
<li>ä¸æ¬¡è®¿é®æ¶ï¼å®ç´æ¥ä½¿ç¨åç§»é 0ï¼è·³è¿ Hash æ¥æ¾ã</li>
<li><strong>å»ä¼å (Deoptimization):</strong> å¦æä½ çªç¶æè´±åäºä¸å¥ <code>p.z = 10</code>ï¼å¯¹è±¡çå½¢ç¶åäºãV8 å¿é¡»æå¼ä¹åçä¼åä»£ç ï¼Deoptï¼ï¼åéå°è§£éå¨æ¨¡å¼ï¼éæ°åæã</li>
</ol>
<blockquote>
<p><strong>ç»ç³»ç»ç¨åºåçå¯ç¤ºï¼</strong> å¨åé«æ§è½ JS æ¶ï¼<strong>ä¿æå¯¹è±¡çå½¢ç¶ç¨³å®</strong>ãä¸è¦éææ·»å /å é¤å±æ§ï¼å°½éåå C++ <code>struct</code> ä¸æ ·åå§åå¯¹è±¡ãè¿è½è®© JS å¼æçææ¥è¿ C++ æéè®¿é®æççæºå¨ç ã</p>
</blockquote>
<h3 id="22-the-great-lie-åçº¿ç¨æ¨¡å-the-single-threaded-model">2.2. The Great Lie: åçº¿ç¨æ¨¡å (The Single-Threaded Model)</h3>
<p>ä½ å¸¸å¬è¯´âJavaScript æ¯åçº¿ç¨çâãè¿æ¢æ¯ççï¼ä¹æ¯åçã</p>
<ul>
<li><strong>JS åå¶å æ  (Call Stack) æ¯åçº¿ç¨çã</strong> è¿æå³çå¨ä»»ä½ç»å®æ¶å»ï¼åªæä¸ä¸ª JS å½æ°å¨ CPU ä¸æ§è¡ã</li>
<li><strong>æµè§å¨/Node.js è¿è¡æ¶ (The Runtime) æ¯å¤çº¿ç¨çã</strong></li>
</ul>
<h4 id="221-ä¸ºä»ä¹æ¯åçº¿ç¨the-design-choice">2.2.1. ä¸ºä»ä¹æ¯åçº¿ç¨ï¼(The Design Choice)</h4>
<p>JS è¯çä¹åæ¯ä¸ºäºå¤ç DOMï¼ç½é¡µ UIï¼ã<br>
æ³è±¡ä¸ä¸ï¼å¦æä¸¤ä¸ªçº¿ç¨åæ¶æä½åä¸ä¸ª DOM èç¹ï¼ä¸ä¸ªçº¿ç¨è¦æ <code>&lt;div&gt;</code> å äºï¼å¦ä¸ä¸ªçº¿ç¨è¦ç»å®å ä¸ª <code>class</code>ãè¿éè¦å¤æçéæºå¶ (Mutex/Semaphore)ã</p>
<p>å¯¹äº UI ç¼ç¨æ¥è¯´ï¼<strong>æ­»é (Deadlock)</strong> å<strong>ç«ææ¡ä»¶ (Race Condition)</strong> æ¯å©æ¢¦ãJS éæ©äº<strong>åä½å¼å¤ä»»å¡ (Cooperative Multitasking)</strong> æ¨¡åï¼</p>
<ul>
<li><strong>ä¼ç¹ï¼</strong> åªè¦ä½ çä»£ç åä¸ç»æï¼æ²¡äººè½ææ­ä½ ãä½ ä¸éè¦åéï¼æ°¸è¿ä¸ç¨æå¿ç«ææ¡ä»¶ç ´ååå­ä¸è´æ§ã</li>
<li><strong>ç¼ºç¹ï¼</strong> <strong>Head-of-Line Blocking</strong>ãå¦æä½ åäºä¸ä¸ª <code>while(true)</code> æèè®¡ç®äº 10 äº¿æ¬¡ææ³¢é£å¥æ°åï¼æ´ä¸ªé¡µé¢å°±ä¼å¡æ­»ï¼UI æ¸²æçº¿ç¨ä¹è¢«é»å¡äºï¼ã</li>
</ul>
<h3 id="23-the-metal-äºä»¶å¾ªç¯-the-event-loop">2.3. The Metal: äºä»¶å¾ªç¯ (The Event Loop)</h3>
<p>å¦æ JS æ¯åçº¿ç¨çï¼å®æ¯æä¹å¤çç½ç»è¯·æ±ï¼I/Oï¼èä¸å¡æ­»çï¼<br>
ç­æ¡æ¯ï¼<strong>å®æèæ´»ç´¯æ´»é½ä¸¢ç»äºåºå± C++ çº¿ç¨æ± ï¼libuv ææµè§å¨åæ ¸ï¼ï¼èªå·±åªè´è´£æ¶ä¿¡ã</strong></p>
<p>è¿å°±æ¯ <strong>äºä»¶å¾ªç¯ (Event Loop)</strong>ãè¿æ¬è´¨ä¸å°±æ¯ä¸ä¸ª <strong>Windows Message Pump (GetMessage/DispatchMessage)</strong> æè Linux ä¸ç <strong><code>epoll</code> å¾ªç¯</strong>ã</p>
<h4 id="231-å¾ªç¯æºå¶-the-tick">2.3.1. å¾ªç¯æºå¶ (The Tick)</h4>
<p>æ³è±¡ä¸ä¸ªæ éå¾ªç¯ <code>while(queue.waitForMessage())</code>ï¼</p>
<ol>
<li><strong>Call Stack:</strong> æ§è¡åæ­¥ä»£ç ï¼V8 å¼æä¸»çº¿ç¨ï¼ã</li>
<li><strong>Web APIs / C++ Threads:</strong> å½ä½ è°ç¨ <code>fetch()</code> æ <code>setTimeout</code> æ¶ï¼JS åªæ¯ååºå± C++ æ¨¡ååéäºä¸ä¸ªæä»¤ï¼ç¶åç«å»è¿åãåºå±çº¿ç¨è´è´£ç­å¾ç½ç»ååºæåè®¡æ¶ã</li>
<li><strong>Callback Queue (Task Queue):</strong> å½åºå±å·¥ä½å®æï¼åè°å½æ°è¢«æè¿éåã</li>
<li><strong>Loop:</strong> ä¸æ¦ Call Stack ç©ºäºï¼Event Loop å°±ä»éåéååºä¸ä¸ªåè°åå¥æ ä¸­æ§è¡ã</li>
</ol>
<blockquote>
<p><strong>ç³»ç»è§è§ç±»æ¯ï¼</strong></p>
<ul>
<li>Main Thread = CPU Pipelineã</li>
<li>Async Operations = DMA (Direct Memory Access) æ§å¶å¨ã</li>
<li>Callback = ä¸­æ­å¤çç¨åº (ISR)ï¼ä½å®æ¯è¢«<strong>å»¶è¿</strong>è°åº¦ç ISRã</li>
</ul>
</blockquote>
<h3 id="24-å¼æ­¥è¿åè®ºä»åè°å°ç±å°åç¨-the-evolution">2.4. å¼æ­¥è¿åè®ºï¼ä»åè°å°ç±å°åç¨ (The Evolution)</h3>
<p>JS çå¼æ­¥æ¨¡åç»åäºä¸æ¬¡éå¤§çè¯­æ³æ¼è¿ï¼æ¯ä¸æ¬¡é½æ¯ä¸ºäºæ´ä¼éå°å¤ç<strong>æ ç»æ</strong>ã</p>
<h4 id="241-phase-1-callback-hell-å½æ°æéçæ»¥ç¨">2.4.1. Phase 1: Callback Hell (å½æ°æéçæ»¥ç¨)</h4>
<p>ææ©ç JS åè¿æ ·åï¼</p>
<pre><code class="language-javascript">getData(function(a) {
    getMoreData(a, function(b) {
        getMoreData(b, function(c) {
            // ...å³ç§»çä¸è§å½¢
        });
    });
});

</code></pre>
<p><strong>é®é¢ï¼</strong> è¿ä¸æ¯åµå¥é®é¢ï¼è¿æ¯<strong>æ§å¶åè½¬ (Inversion of Control)</strong> çä¸¢å¤±ãä½ æåç»­é»è¾çæ§è¡æäº¤ç»äºç¬¬ä¸æ¹åºï¼èä¸éè¯¯å¤ç (Error Handling) æå¶å°é¾ï¼<code>try/catch</code> æ æ³æè·å¼æ­¥åè°éçéè¯¯ï¼å ä¸ºæ å·²ç»éæ¯äºï¼ã</p>
<h4 id="242-phase-2-promises-ç¶ææº-monad">2.4.2. Phase 2: Promises (ç¶ææº Monad)</h4>
<p><code>Promise</code> æ¬è´¨ä¸æ¯ä¸ä¸ªå¯¹è±¡ï¼ä»£è¡¨âæªæ¥å¯è½åºç°çå¼âã</p>
<pre><code class="language-javascript">getData()
  .then(a =&gt; getMoreData(a))
  .then(b =&gt; getMoreData(b))
  .catch(e =&gt; console.error(e));

</code></pre>
<p><strong>æ¬è´¨ï¼</strong> å®æ ååäºåè°çç­¾åï¼å¹¶åè®¸é¾å¼è°ç¨ãéè¦çæ¯ï¼å®å¼å¥äº <strong>Microtask Queue (å¾®ä»»å¡éå)</strong>ã</p>
<ul>
<li><strong>Microtask (Promise):</strong> ä¼åçº§æé«ãå¨å½åæ æ¸ç©ºåï¼<strong>ç«å³</strong>æ§è¡ï¼æéå¨ææ IO åè°ä¹åã</li>
<li><strong>Macrotask (setTimeout):</strong> ä¼åçº§ä½ãä¸ä¸è½®å¾ªç¯ææ§è¡ã</li>
</ul>
<h4 id="243-phase-3-asyncawait-åç¨--coroutines">2.4.3. Phase 3: Async/Await (åç¨ / Coroutines)</h4>
<p>è¿æ¯ä½ æçæçå½¢æãES7 å¼å¥äº <code>async/await</code>ã</p>
<pre><code class="language-javascript">async function main() {
    try {
        const a = await getData();
        const b = await getMoreData(a);
    } catch (e) {
        console.error(e);
    }
}

</code></pre>
<p><strong>æ¬è´¨ï¼</strong> è¿å°±æ¯ <strong>C++20 çåç¨ (Coroutines)</strong> æ <strong>C# ç Task</strong>ã</p>
<ul>
<li><code>async</code> å½æ°ä¼å°ä»£ç ç¼è¯æä¸ä¸ªç¶ææº (State Machine)ã</li>
<li>éå° <code>await</code> æ¶ï¼å½æ°<strong>æå (Yield)</strong>ï¼ä¿å­å½åçæ å¸§ï¼é­å contextï¼ï¼å¹¶å°æ§å¶æäº¤è¿ç» Event Loopã</li>
<li>å½ Promise å®ææ¶ï¼è¿è¡æ¶æ¢å¤è¯¥å½æ°çæ§è¡ï¼å¹¶æç»æå¡«å¥ã</li>
</ul>
<p><strong>æ»ç»ï¼</strong> <code>async/await</code> è®©ä½ ç¨<strong>åæ­¥çæç»´</strong>ï¼çº¿æ§ç try/catchï¼å<strong>å¼æ­¥çä»£ç </strong>ï¼éé»å¡ I/Oï¼ãè¿æ¯ JS åå²ä¸æä¼å¤§çå·¥ç¨æå°±ä¹ä¸ã</p>
<h2 id="3-language--syntax--è¯­æ³ç³ä¸ç±»åé²å¾¡-syntactic-sugar--type-defense">3. Language &amp; Syntax ââ è¯­æ³ç³ä¸ç±»åé²å¾¡ (Syntactic Sugar &amp; Type Defense)</h2>
<p>å¨æ·±å¥äºè§£äºæå»ºå·¥å·çå¹»è±¡åè¿è¡æ¶çåºå±æºå¶åï¼æä»¬æ¥å°äºæå·äºè®®çé¢åï¼<strong>è¯­è¨æ¬èº«çæ¼è¿</strong>ã</p>
<p>å¯¹äº C++ ç¨åºåæ¥è¯´ï¼JavaScript çå¯¹è±¡æ¨¡åï¼åºäºååï¼å TypeScript çç±»åç³»ç»ï¼ç»æåç±»åï¼å¾å¾æ¯æåç´è§çä¸¤ä¸ªçç¹ãæ¬ç« å°å¥ç¦»è¯­æ³çè¡¨è±¡ï¼æ­ç¤ºå®ä»¬å¨åå­åç¼è¯æççå®å½¢æã</p>
<h3 id="31-ä»-prototype-å°-classé¢åå¯¹è±¡çä¼ªè£">3.1. ä» Prototype å° Classï¼é¢åå¯¹è±¡çâä¼ªè£â</h3>
<p>ES6 (ECMAScript 2015) å¼å¥äº <code>class</code> å³é®å­ï¼è¿è®© JS çèµ·æ¥ç»äºå Java/C++ äºã<br>
<strong>ä½è¿åªæ¯ä¸ä¸ªå·¨å¤§çè°è¨ï¼æèè¯´ï¼é«æçä¼ªè£ï¼ã</strong></p>
<p>å¨ C++ ä¸­ï¼<code>class</code> æ¯ç¼è¯æçèå¾ãå¯¹è±¡æ¯æ ¹æ®èå¾å¨åå­ä¸­åååºçæ°æ®åï¼vptr + æååéï¼ã<br>
å¨ JS ä¸­ï¼<code>class</code> ä»ä»æ¯ <strong>ååé¾ (Prototype Chain)</strong> çè¯­æ³ç³ã</p>
<h4 id="311-ååé¾çæ¬è´¨ååé¾è¡¨-singly-linked-list">3.1.1. ååé¾çæ¬è´¨ï¼ååé¾è¡¨ (Singly Linked List)</h4>
<p>æ³è±¡ä¸ä¸ï¼JS æ²¡æâç±»âçæ¦å¿µï¼åªæâå¯¹è±¡âãå¯¹è±¡ä¹é´éè¿ä¸ä¸ªéèæé <code>[[Prototype]]</code>ï¼å¨æµè§å¨è°è¯ä¸­éå¸¸æ¾ç¤ºä¸º <code>__proto__</code>ï¼è¿æ¥ã</p>
<ul>
<li><strong>æ¥æ¾æºå¶ï¼</strong> å½ä½ è®¿é® <code>obj.x</code> æ¶ï¼å¼æåå¨ <code>obj</code> èªèº«åå­ä¸­æ¾ãæ¾ä¸å°ï¼é¡ºç <code>__proto__</code> æéå»âç¶å¯¹è±¡âæ¾ãè¿æ¾ä¸å°ï¼ç»§ç»­åä¸ï¼ç´å° <code>null</code>ã</li>
<li><strong>åå­æ¨¡åï¼</strong> è¿ä¸æ¯ç»§æ¿ï¼Inheritanceï¼ï¼è¿æ¯<strong>å§æï¼Delegationï¼</strong>ã</li>
<li>C++ ç»§æ¿ï¼å­ç±»å¯¹è±¡åå«äºç¶ç±»å¯¹è±¡çæ°æ®æåï¼åå­å¸å±æ¯è¿ç»­çï¼ã</li>
<li>JS å§æï¼å­å¯¹è±¡åªæ¯ææäºä¸ä¸ªæåç¶å¯¹è±¡çæéã</li>
</ul>
<h4 id="312-es6-class-vs-the-metal">3.1.2. ES6 Class vs. The Metal</h4>
<p>ççè¿æ®µâç°ä»£âä»£ç ï¼</p>
<pre><code class="language-javascript">class Dog extends Animal {
  bark() { return "Woof!"; }
}

</code></pre>
<p>å®å¨åºå±ççå®é¢ç®ï¼ES5ï¼ï¼</p>
<pre><code class="language-javascript">function Dog() {} // æé å½æ°åªæ¯ä¸ä¸ªæ®éå½æ°
Dog.prototype = Object.create(Animal.prototype); // æå¨æ¥ä¸é¾è¡¨æé
Dog.prototype.bark = function() { return "Woof!"; }; // ææ¹æ³æå¨é¾è¡¨èç¹ä¸

</code></pre>
<blockquote>
<p><strong>ç³»ç»è§è§ç±»æ¯ï¼</strong></p>
<ul>
<li><strong>Prototype:</strong> å°±æ¯ä¸ä¸ªå±äº«ç <code>vtable</code>ï¼èå½æ°è¡¨ï¼ï¼ä½å®æ¬èº«ä¹æ¯ä¸ä¸ªæ®éç Heap Objectã</li>
<li><strong>Instance:</strong> å°±æ¯ä¸ä¸ªåå« <code>vptr</code>ï¼æå Prototypeï¼åæååéç <code>struct</code>ã</li>
<li><strong>Class å³é®å­:</strong> åªæ¯ä¸ºäºè®©ä½ åèµ·æ¥ä¸é£ä¹æ¶å¿ï¼ä¸ç¨æå¨æä½ <code>vptr</code>ã</li>
</ul>
</blockquote>
<h3 id="32-typescript-çä»å¥ç±»åç³»ç»çåå»">3.2. TypeScript çä»å¥ï¼ç±»åç³»ç»çåå»</h3>
<p>æ¢ç¶ V8 å¼æåé¨å·²ç»æäº Hidden Classesï¼å¨æç±»åæ¨å¯¼ï¼ï¼ä¸ºä»ä¹æä»¬è¿éè¦ TypeScriptï¼</p>
<p><strong>å ä¸º V8 çæ¨å¯¼åçå¨âè¿è¡æ¶âï¼è TypeScript çæ£æ¥åçå¨âç¼è¯æ¶âã</strong><br>
å¯¹äºå¤§åå·¥ç¨ï¼ç­å¾è¿è¡æ¶å´©æºï¼Runtime Panicï¼æ¯ä¸å¯æ¥åçãæä»¬éè¦å¨ä»£ç é¨ç½²åå°±æ¦æªéè¯¯ã</p>
<h4 id="321-structural-typing-ç»æåç±»å-vs-nominal-typing-åä¹ç±»å">3.2.1. Structural Typing (ç»æåç±»å) vs. Nominal Typing (åä¹ç±»å)</h4>
<p>è¿æ¯ TS ä¸ C++/Java ææ ¹æ¬çåºå«ã</p>
<ul>
<li><strong>C++ (Nominal):</strong> ç±»åç±<strong>åå­</strong>å³å®ã</li>
</ul>
<pre><code class="language-cpp">struct A { int x; };
struct B { int x; };
A a; B b = a; // â éè¯¯ï¼A å B æ¯ä¸åç±»åï¼å³ä½¿åå­å¸å±å®å¨ä¸æ ·ã

</code></pre>
<ul>
<li><strong>TypeScript (Structural):</strong> ç±»åç± <strong>å½¢ç¶ï¼Shapeï¼</strong> å³å®ã</li>
</ul>
<pre><code class="language-typescript">interface A { x: number; }
interface B { x: number; }
let a: A = { x: 1 };
let b: B = a; // â åæ³ï¼åªè¦é¿å¾åï¼é¸­å­ç±»åï¼ï¼å°±æ¯åä¸ç§ç±»åã

</code></pre>
<p><strong>è§£å³äºä»ä¹çç¹ï¼</strong><br>
å¨åç«¯ï¼æä»¬ç»å¸¸å¤ç JSON æ°æ®ãåç«¯ä¼ åæ¥ç JSON åªæ¯ä¸ä¸ªçº¯æ°æ®ç»æï¼æ²¡æç±»åãç»æåç±»ååè®¸æä»¬å®ä¹ä¸ä¸ª Interface æ¥âå¥âå¨ä»»ä½ç¬¦åå½¢ç¶ç JSON ä¸ï¼èä¸éè¦å C++ é£æ ·åç¹ççåºåå/ååºååæ å°å¨ã</p>
<h4 id="322-type-erasure-ç±»åæ¦é¤ç¼è¯åçèæ ">3.2.2. Type Erasure (ç±»åæ¦é¤)ï¼ç¼è¯åçèæ </h4>
<p>TypeScript çç±»åæ£æ¥æ¯<strong>çº¯ç²¹çéæåæ</strong>ã<br>
ä¸æ¦ç¼è¯éè¿ï¼TS ç¼è¯å¨ï¼tscï¼ä¼<strong>å é¤ææ</strong>ç±»åæ³¨è§£ãæ¥å£å®ä¹ãæ³åå£°æã</p>
<ul>
<li><strong>Input (.ts):</strong></li>
</ul>
<pre><code class="language-typescript">function add(a: number, b: number): number {
  return a + b;
}

</code></pre>
<ul>
<li><strong>Output (.js):</strong></li>
</ul>
<pre><code class="language-javascript">function add(a, b) {
  return a + b;
}

</code></pre>
<p>è¿æå³çï¼</p>
<ol>
<li><strong>è¿è¡æ¶æ²¡æå¼éï¼</strong> æ²¡æ RTTIï¼è¿è¡æ¶ç±»åè¯å«ï¼ï¼æ²¡æèå½æ°è¡¨æ¥æ¾çé¢å¤æèã</li>
<li><strong>è¿è¡æ¶æ²¡æä¿æ¤ï¼</strong> å¦æä½ å¨è¿è¡æ¶å¼ºè¡æä¸ä¸ª <code>string</code> ä¼ ç»ç¼è¯æ¶æ è®°ä¸º <code>number</code> çå½æ°ï¼æ¯å¦éè¿ API è¯·æ±ï¼ï¼JS å¼æä¼ç§åå¨æ¶ï¼ç¶åå¯è½å´©ç»ä½ çã</li>
</ol>
<blockquote>
<p><strong>ç»ç³»ç»ç¨åºåçå¯ç¤ºï¼</strong></p>
<ul>
<li>TypeScript å°±åæ¯ç» JavaScript ç©¿ä¸äºä¸å± <strong>ç¼è¯ææ­è¨ (Compile-time Assertions)</strong>ã</li>
<li>å®ä¸ä¼æ¹åçæçæºå¨ç ï¼JSï¼ï¼ä½å®è½ä¿è¯ä½ å¨åä»£ç æ¶é»è¾èªæ´½ã</li>
<li><strong>Trust Boundary:</strong> æ°¸è¿ä¸è¦ç¸ä¿¡ I/O è¾¹çï¼ç½ç»è¯·æ±ãç¨æ·è¾å¥ï¼è¿æ¥çæ°æ®èªå¨ç¬¦å TS ç±»åãä½ å¿é¡»ä½¿ç¨è¿è¡æ¶æ ¡éªåºï¼å¦ Zodï¼æ¥æå¨éªè¯ï¼è¿ææ¯çæ­£çâç±»åå®å¨âã</li>
</ul>
</blockquote>
<h2 id="4-the-engineering-layer--ä»æå·¥ä½åå°å·¥ä¸æµæ°´çº¿-engineering--frameworks">4. The Engineering Layer ââ ä»æå·¥ä½åå°å·¥ä¸æµæ°´çº¿ (Engineering &amp; Frameworks)</h2>
<p>åä¸ç« æä»¬æå®äºå·¥å·é¾ãè¿è¡æ¶åè¯­è¨æ¬èº«ãç°å¨ï¼æä»¬ç»äºå¯ä»¥è°è°é£äºè®©åç«¯å¼åèâä»¥æ­¤ä¸ºçâçä¸è¥¿äºï¼<strong>æ¡æ¶ (Frameworks)</strong>ã</p>
<p>å¯¹äºç³»ç»ç¨åºåæ¥è¯´ï¼React å Vue å¾å¾è¢«è¯¯è§£ä¸ºâä»ä»æ¯æ¨¡æ¿åºâãå®éä¸ï¼å®ä»¬çåºç°æ¯ä¸ºäºè§£å³ä¸ä¸ªè®¡ç®æºå¾å½¢å­¦ä¸­çç»å¸é¾é¢ï¼<strong>å¦ä½é«æå°å°åºç¨ç¨åºçåé¨ç¶æ (Internal State) æ å°å°å±å¹åç´  (Pixels) ä¸ï¼åæ¶ä¿æä»£ç çå¯ç»´æ¤æ§ï¼</strong></p>
<h3 id="41-the-dom-api-a-syscall-nightmare-ç³»ç»è°ç¨çå©æ¢¦">4.1. The DOM API: A Syscall Nightmare (ç³»ç»è°ç¨çå©æ¢¦)</h3>
<p>åé¡¾ä¸ä¸ jQuery æ¶ä»£ï¼2006-2013ï¼ãé£æ¶åæä»¬ç´æ¥æä½ DOMã</p>
<p><strong>ä¸ºä»ä¹ç´æ¥æä½ DOM æ¯åæ¨¡å¼ï¼</strong></p>
<ul>
<li>
<p><strong>The "Context Switch" Cost:</strong> å¨æµè§å¨ä¸­ï¼JavaScript å¼æï¼V8ï¼å æ¸²æå¼æï¼Blink/Webkitï¼æ¯ä¸¤ä¸ªç¬ç«çæ¨¡åï¼çè³å¨æäºæ¶æä¸è¿è¡å¨ä¸åççº¿ç¨ã</p>
</li>
<li>
<p>æ¯æ¬¡ä½ è°ç¨ <code>document.getElementById</code> æ <code>element.style.color = 'red'</code>ï¼å®éä¸é½åçäºä¸æ¬¡<strong>è·¨è¾¹çè°ç¨ (Cross-boundary Call)</strong>ã</p>
</li>
<li>
<p><strong>ç³»ç»ç±»æ¯ï¼</strong> è¿å°±åä½ å¨å C++ ç¨åºæ¶ï¼ä¸ºäºåå¥æä»¶ï¼æ¯åä¸ä¸ªå­èå°±è°ç¨ä¸æ¬¡ <code>write()</code> ç³»ç»è°ç¨ (Syscall)ãæ§è½å¼éæ¯å·¨å¤§çã</p>
</li>
<li>
<p><strong>State Synchronization Hell:</strong> æ³è±¡ä¸ä¸ï¼ä½ æä¸ä¸ªåé <code>int count = 0</code>ãæ¯æ¬¡ <code>count</code> ååï¼ä½ å¿é¡»æå¨å»å¯»æ¾é¡µé¢ä¸æææ¾ç¤º <code>count</code> ç <code>&lt;div&gt;</code> å¹¶æ´æ°å®ä»¬ã</p>
</li>
<li>
<p>jQuery ä»£ç åæ»¡äº <code>$('.counter').text(count)</code>ã</p>
</li>
<li>
<p>ä¸æ¦é»è¾å¤æï¼è¿å°±æ¯å¸åç <strong>"Spaghetti Code"</strong> ââ ç¶æï¼åå­ä¸­çæ°æ®ï¼å è§å¾ï¼DOM æ ï¼å®å¨è§£è¦ï¼åæ­¥å¨é æå¨ãè¿å¨ç³»ç»ç¼ç¨ä¸­ç­åäºæå¨ç®¡ç <code>malloc/free</code> ä¸æ²¡æä»»ä½ RAII æºå¶ï¼åå­æ³æ¼ï¼UI ç¶æä¸ä¸è´ï¼æ¯å¿ç¶çã</p>
</li>
</ul>
<h3 id="42-ui-as-a-function-of-state-å£°æå¼é©å½">4.2. UI as a Function of State: å£°æå¼é©å½</h3>
<p>React (2013) å¼å¥äºä¸ä¸ªå¨å½æ¶çèµ·æ¥ç¦»ç»åéçå¬å¼ï¼</p>
<p>è¿æå³çï¼<strong>UI åªæ¯ç¶æççº¯å½æ°æå½±ã</strong></p>
<ul>
<li><strong>Imperative (å½ä»¤å¼ - jQuery/Win32 API):</strong> "æ¾å°é£ä¸ªæé®ï¼æå®çé¢è²æ¹æçº¢è²ï¼ç¶åæå®çæå­æ¹æ 'Clicked'ã" -&gt; <strong>å³æ³¨è¿ç¨ (How)</strong>ã</li>
<li><strong>Declarative (å£°æå¼ - React/Vue):</strong> "æé®çç¶ææ¯ <code>clicked</code>ãå½ç¶æä¸º <code>clicked</code> æ¶ï¼å®åºè¯¥æ¯çº¢è²çä¸æ¾ç¤º 'Clicked'ã" -&gt; <strong>å³æ³¨ç»æ (What)</strong>ã</li>
</ul>
<p><strong>ç³»ç»ç±»æ¯ï¼</strong><br>
è¿å°±åä» <strong>Immediate Mode GUI (OpenGL <code>glBegin</code>/<code>glEnd</code>)</strong> è½¬åäº <strong>Retained Mode GUI (Qt/WPF)</strong>ãä½ ä¸ååè¯ GPU æä¹ç»æ¯ä¸å¸§ï¼ä½ åªæ¯ä¿®æ¹åºæ¯å¾ï¼Scene Graphï¼ä¸­çæ°æ®ï¼å¼æè´è´£æ¸²æã</p>
<h3 id="43-virtual-dom-the-double-buffering-åéç¼å²">4.3. Virtual DOM: The Double Buffering (åéç¼å²)</h3>
<p>æ¢ç¶ <code>UI = f(State)</code>ï¼é£å²ä¸æ¯æ¯æ¬¡ç¶ææ¹åï¼æ¯å¦ç¨æ·æ²äºä¸ä¸ªé®ï¼ï¼æä»¬é½è¦éæ¯æ´ä¸ªé¡µé¢éæ°æ¸²æï¼è¿å¨æ§è½ä¸æ¯ä¸å¯æ¥åçã</p>
<p>ä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼React å¼å¥äº <strong>Virtual DOM (èæ DOM)</strong>ã</p>
<h4 id="æºå¶è¯¦è§£">æºå¶è¯¦è§£ï¼</h4>
<ol>
<li><strong>Memory Buffer:</strong> Virtual DOM æ¬è´¨ä¸æ¯ä¸ä¸ªè½»éçº§ç JavaScript å¯¹è±¡æ ï¼JS Object Treeï¼ï¼å®å¨åå­ä¸­æ¨¡æäºçå®ç DOM ç»æã</li>
<li><strong>Render Phase:</strong> å½ç¶æåæ´æ¶ï¼React ä¼è°ç¨ä½ çç»ä»¶å½æ°ï¼çæä¸æ£µ<strong>æ°ç</strong> Virtual DOM æ ã</li>
<li><strong>Diff Algorithm (The "Linker"):</strong> React å°æ°æ ä¸æ§æ è¿è¡å¯¹æ¯ï¼Diffingï¼ãå®ä½¿ç¨ä¸ç§å¯åå¼ç®æ³ï¼å¤æåº¦ O(n)ï¼æ¾åºæå°åæ´é (Dirty Regions)ã</li>
<li><strong>Commit Phase (Flush):</strong> React å°è¿äºå·®å¼æ¹éåºç¨å°çå®ç DOM ä¸ã</li>
</ol>
<p><strong>ç³»ç»è§è§ç±»æ¯ï¼</strong><br>
è¿å°±æ¯å¾å½¢ç¼ç¨ä¸­ç <strong>åéç¼å² (Double Buffering)</strong>ã</p>
<ul>
<li><strong>Front Buffer:</strong> çå®ç DOMï¼ç¨æ·çå°çï¼åå¥æ¢ï¼ã</li>
<li><strong>Back Buffer:</strong> Virtual DOMï¼åå­ä¸­çï¼è¯»åæå¿«ï¼ã</li>
<li><strong>Swap/Flush:</strong> åªå° Back Buffer ä¸­ååçé¨å (Dirty Rectangles) å¤å¶å° Front Bufferã</li>
</ul>
<blockquote>
<p><strong>The Optimization:</strong> VDOM å¹¶ä¸æ»æ¯æ¯ç´æ¥æä½ DOM å¿«ï¼å ä¸ºå¤äº Diff ç CPU å¼éï¼ãä½å®ä¿è¯äº<strong>ä¸é</strong>ââæ è®ºä½ çç¶æç®¡çåå¾å¤ä¹çï¼å®é½è½éè¿æ¹å¤çï¼Batchingï¼é¿åæåçâæ¯å­èä¸æ¬¡ Syscallâçæåµã</p>
</blockquote>
<h3 id="44-componentization-the-shared-libraries-of-web">4.4. Componentization: The "Shared Libraries" of Web</h3>
<p>å¨æ¡æ¶åºç°ä¹åï¼åç«¯ä»£ç å¾å¾æ¯âé¡µé¢çº§âçï¼ä¸ä¸ªå·¨å¤§ç HTMLï¼éä¸ä¸ªå·¨å¤§ç CSS åä¸ä¸ªå·¨å¤§ç JSã</p>
<p>React/Vue å¼ºå¶æ¨è¡äº <strong>ç»ä»¶å (Componentization)</strong>ã</p>
<ul>
<li><strong>å°è£ (Encapsulation):</strong> ä¸ä¸ªç»ä»¶ï¼Componentï¼å°±æ¯ä¸ä¸ªæ¥æç¬ç«ç¶æï¼Stateï¼ãç¬ç«é»è¾ï¼JSï¼åç¬ç«è§å¾ï¼JSX/Templateï¼çååã</li>
<li><strong>å¤ç¨ (Reusability):</strong> ç»ä»¶å¯ä»¥å Lego ç§¯æ¨ä¸æ ·åµå¥ã</li>
<li><strong>æ¥å£ (Interface):</strong> ç»ä»¶éè¿ <strong>Props</strong>ï¼è¾å¥åæ°ï¼å <strong>Events</strong>ï¼åè°å½æ°ï¼è¿è¡éä¿¡ã</li>
</ul>
<p><strong>ç³»ç»ç±»æ¯ï¼</strong></p>
<ul>
<li><strong>ç»ä»¶ = ç±» (Class) / ç»æä½ (Struct)</strong>ã</li>
<li><strong>Props = æé å½æ°åæ°</strong>ã</li>
<li><strong>State = ç§ææååé</strong>ã</li>
<li><strong>Render = è¿éç <code>Draw()</code> å½æ°</strong>ã</li>
</ul>
<p>è¿ç§æ¶æå°åç«¯å¼åä»âåèæ¬âæåå°äºâè½¯ä»¶å·¥ç¨âçç»´åº¦ãæä»¬å¯ä»¥åè®¾è®¡ C++ ç±»åºä¸æ ·è®¾è®¡ UI ç³»ç»ï¼å®ç°äº <strong>å³æ³¨ç¹åç¦» (Separation of Concerns)</strong>ã</p>
<h2 id="5-modern-ecosystem--éåº¦ä¸è¾¹çççªå´-speed--boundaries">5. Modern Ecosystem ââ éåº¦ä¸è¾¹çççªå´ (Speed &amp; Boundaries)</h2>
<p>å¦æè¯´ååç« æ¯å³äºå¦ä½å¨æµè§å¨è¿ä¸ªâæ²çâéè·³èï¼é£ä¹è¿ä¸ç« åæ¯å³äº<strong>è¶ç±</strong>ã</p>
<p>ç°ä»£åç«¯çææ­£å¨ç»åä¸¤åºå§ççå°å£³è¿å¨ï¼</p>
<ol>
<li><strong>å·¥å·é¾çâåçåâ (Native Rewrite)ï¼</strong> æ¢ç¶ JS è§£éæ§è¡æ¢ï¼é£å°±ç¨ Go/Rust éåææå·¥å·ã</li>
<li><strong>è¿è¡æ¶çâæ³åâ (Universal Runtime)ï¼</strong> JavaScript ä¸åå±éäºæµè§å¨ï¼å®è¯å¾åå¬æå¡å¨ãæ¡é¢çè³åµå¥å¼è®¾å¤ã</li>
</ol>
<p>ä½ä¸ºç³»ç»ç¨åºåï¼ä½ ä¼å¯¹è¿ä¸ç« åæäº²åââå ä¸ºæä»¬è¦èçç»äºä¸åæ¯ DOMï¼èæ¯<strong>ç¼è¯åç</strong>ã<strong>ç³»ç»è°ç¨</strong>å<strong>è¿ç¨é´éä¿¡ (IPC)</strong>ã</p>
<h3 id="51-æå»ºå·¥å·çæäºä»-webpack-å°-viteesbuild">5.1. æå»ºå·¥å·çæäºï¼ä» Webpack å° Vite/Esbuild</h3>
<h4 id="511-the-legacy-webpack-the-make-written-in-python">5.1.1. The Legacy: Webpack (The "Make" written in Python)</h4>
<p>å¨å¾é¿ä¸æ®µæ¶é´éï¼Webpack æ¯æå»ºå·¥å·çé¸ä¸»ãå®åè½æå¶å¼ºå¤§ï¼ä½æä¸ä¸ªè´å½å¼±ç¹ï¼<strong>å®æ¯ç¨ JavaScript åçã</strong></p>
<ul>
<li><strong>çç¹ï¼</strong> éçé¡¹ç®è¨èï¼Webpack éè¦è§£ææåä¸ä¸ä¸ªæ¨¡åç ASTï¼æ½è±¡è¯­æ³æ ï¼ï¼è¿è¡ Tree-shaking å Bundlingãå¨åçº¿ç¨ç JS è¿è¡æ¶éï¼è¿å¯¼è´å·å¯å¨å¯è½éè¦ 2-5 åéã</li>
<li><strong>ç±»æ¯ï¼</strong> è¿å°±åä½ å¨åä¸ä¸ª C++ é¡¹ç®ï¼ä½æ¯ä½ çç¼è¯å¨ï¼GCCï¼åé¾æ¥å¨ï¼LDï¼æ¯å®å¨ç¨ Python åçãé»è¾æ²¡é®é¢ï¼ä½ååéï¼Throughputï¼è¢«è§£éåè¯­è¨çæ§è½å¤©è±æ¿éæ­»äºã</li>
</ul>
<h4 id="512-the-revolution-esbuild--swc-native-code">5.1.2. The Revolution: Esbuild &amp; SWC (Native Code)</h4>
<p>æ¢ç¶ç¶é¢å¨è¯­è¨ï¼è§£å³æ¹æ¡å°±æ¯<strong>æ¢è¯­è¨</strong>ã</p>
<ul>
<li><strong>Esbuild (Go):</strong> Evan Wallace ç¨ Go ç¼åçæåå¨ã</li>
<li><strong>SWC (Rust):</strong> ç¨ Rust ç¼åçç¼è¯å¨ï¼æ¿ä»£ Babelï¼ã</li>
</ul>
<p>å®ä»¬çæ§è½éå¸¸æ¯ Webpack ç <strong>10-100 å</strong>ãä¸ºä»ä¹ï¼</p>
<ol>
<li><strong>å¹¶è¡æ§ (Parallelism):</strong> Go å Rust è½ååå©ç¨å¤æ ¸ CPUï¼JS åªè½åçº¿ç¨ï¼ã</li>
<li><strong>åå­ç®¡ç:</strong> æå¨ç®¡çåå­å¸å±ï¼åå° GC ååã</li>
<li><strong>é¶ææ¬æ½è±¡:</strong> æ²¡æ JS å¼æç JIT é¢ç­å¼éã</li>
</ol>
<h4 id="513-the-game-changer-vite-the-jit-linker">5.1.3. The Game Changer: Vite (The "JIT" Linker)</h4>
<p>Vite (æ³è¯­âå¿«â) ç»åäºæµè§å¨åç ESM è½åå Esbuild çéåº¦ã</p>
<ul>
<li><strong>Dev Server (O(1) Start):</strong> Webpack å¯å¨æ¶éè¦ææææä»¶æåï¼Bundleï¼ãVite <strong>ä¸æå</strong>ãå®å¯å¨ä¸ä¸ª HTTP Serverï¼å½æµè§å¨è¯·æ± <code>main.js</code> æ¶ï¼å®æå®æ¶éè¿ Esbuild ç¼è¯è¯¥æä»¶å¹¶è¿åã</li>
<li><strong>ç³»ç»ç±»æ¯ï¼</strong></li>
<li><strong>Webpack:</strong> éæé¾æ¥ (Static Linking)ãä¿®æ¹ä¸è¡ä»£ç ï¼éæ°é¾æ¥æ´ä¸ª <code>.exe</code>ã</li>
<li><strong>Vite:</strong> å¨æé¾æ¥ (Dynamic Linking / <code>dlopen</code>)ãä¿®æ¹ä¸ä¸ª <code>.cpp</code>ï¼åªéç¼è¯å®çæç <code>.so</code>ï¼ç¨åºè¿è¡æ¶å¨æå è½½ã</li>
</ul>
<h3 id="52-æå¡ç«¯è¿è¡æ¶nodejs-vs-bundeno">5.2. æå¡ç«¯è¿è¡æ¶ï¼Node.js vs. Bun/Deno</h3>
<p>JavaScript è¿è¡æ¶çæäºï¼æ¬è´¨ä¸æ¯ <strong>C++ vs. Rust vs. Zig</strong> çä»£çäººæäºã</p>
<h4 id="521-nodejs-the-c-veteran">5.2.1. Node.js (The C++ Veteran)</h4>
<ul>
<li><strong>æ¶æï¼</strong> V8 (Engine) + libuv (Event Loop) + C++ Bindingsã</li>
<li><strong>å°ä½ï¼</strong> å°±å Linux ç <strong>glibc</strong>ãè½ç¶æåå²åè¢±ï¼æ¯å¦ <code>node_modules</code> çåµå¥é»æ´ï¼ï¼ä½å®æ¯æ åï¼çææå¨ï¼æå¶ç¨³å®ã</li>
</ul>
<h4 id="522-deno-the-rust-challenger">5.2.2. Deno (The Rust Challenger)</h4>
<ul>
<li><strong>æ¶æï¼</strong> V8 + Tokio (Rust Event Loop)ã</li>
<li><strong>åç¹ï¼</strong> å®å¨æ§ï¼é»è®¤æ æä»¶/ç½ç»æéï¼ãå»ä¸­å¿åä¾èµï¼æ²¡æ <code>package.json</code>ï¼ç´æ¥ import URLï¼ãåç TypeScript æ¯æã</li>
<li><strong>ç³»ç»è§è§ï¼</strong> Node.js å C++ï¼ç»ä½ æææéä½å®¹æå´©ï¼Deno å Rustï¼ç¼è¯å¨ï¼è¿è¡æ¶ï¼å¼ºè¿«ä½ å®è§ç©ã</li>
</ul>
<h4 id="523-bun-the-zig-speedster">5.2.3. Bun (The Zig Speedster)</h4>
<ul>
<li><strong>æ¶æï¼</strong> JavaScriptCore (Safari çå¼æ) + Zig èªç  IO å±ã</li>
<li><strong>åç¹ï¼</strong> <strong>å¿«ï¼ç¯ççå¿«ã</strong></li>
<li><strong>Why Zig?</strong> Bun çä½è Jarred Sumner éæ© Zig æ¯å ä¸ºå®å¯ä»¥æå¨æ§å¶åå­å¸å±ï¼å¹¶ä¸æ²¡æéèçæ§å¶æµãBun éæ°å®ç°äºåç®¡çå¨ï¼npm clientï¼ãæåå¨åæµè¯è¿è¡å¨ã</li>
<li><strong>ç³»ç»ç±»æ¯ï¼</strong> å¦æ Node.js æ¯æ åç Ubuntuï¼Bun å°±æ¯ <strong>Alpine Linux</strong> ââ æè´ç²¾ç®ï¼ä¸ºäºå¯å¨éåº¦å IO ååéçºç²äºä¸ååä½ãå®æ¨å¨æä¸ºä¸ä¸ª <strong>Drop-in Replacement</strong>ï¼ç´æ¥æ¿æ¢ libcï¼ã</li>
</ul>
<h3 id="53-electron-write-once-run-everywhere-çä»£ä»·">5.3. Electron: "Write Once, Run Everywhere" çä»£ä»·</h3>
<p>Electron æ¯è®©æ æ°ç³»ç»ç¨åºåâå¤ä¹ä»¥é¼»âä½åä¸å¾ä¸æçææ¯ãå®åè®¸ç¨ Web ææ¯å¼åè·¨å¹³å°æ¡é¢åºç¨ï¼VS Code, Discord, Slackï¼ã</p>
<h4 id="531-æ¶ææ¬è´¨chromium--nodejs">5.3.1. æ¶ææ¬è´¨ï¼Chromium + Node.js</h4>
<p>Electron çäºè¿å¶æä»¶éï¼å¡è¿äºä¸ä¸ªå®æ´çæµè§å¨åæ ¸ï¼Chromiumï¼åä¸ä¸ªå®æ´ç Node.js è¿è¡æ¶ã</p>
<ul>
<li><strong>Main Process (Kernel Space):</strong> è¿è¡ Node.jsãè´è´£åå»ºçªå£ãæä½ç³»ç»äº¤äºï¼æä»¶ãæçãåçèåï¼ãå®å°±åæ¯è¿ä¸ªåºç¨çâåæ ¸âã</li>
<li><strong>Renderer Process (User Space):</strong> è¿è¡ Chromiumãè´è´£æ¸²æ UIãæ¯ä¸ä¸ªçªå£éå¸¸æ¯ä¸ä¸ªç¬ç«çè¿ç¨ã</li>
<li><strong>IPC (Inter-Process Communication):</strong> ä¸¤ä¸ªä¸çéè¿ IPC ç®¡ééä¿¡ã</li>
</ul>
<h4 id="532-ä¸ºä»ä¹å®è½èµ¢the-trade-off">5.3.2. ä¸ºä»ä¹å®è½èµ¢ï¼(The Trade-off)</h4>
<ul>
<li><strong>ç³»ç»ç¨åºåçè´¨çï¼</strong> <em>âä¸ºäºåä¸ªè®°äºæ¬ï¼ä½ è®©æè·ä¸¤ä¸ªæµè§å¨åæ ¸ï¼è¿å¤ªæµªè´¹ RAM äºï¼â</em></li>
<li><strong>å·¥ç¨è§è§çåç­ï¼</strong> æ¯çï¼å®æå¶<strong>èè¿ (Bloated)</strong>ãä½æ¯ï¼å®è§£å³äº GUI å¼åæå¤§ççç¹ââ<strong>è·¨å¹³å°ä¸è´æ§</strong>ã</li>
<li>å Qt/MFC/GTKï¼ä½ éè¦å¤ç Windows/macOS/Linux çæ æ°ç»å¾®å·®å¼ï¼DPI ç¼©æ¾ãå­ä½æ¸²æãäºä»¶å¾ªç¯å·®å¼ï¼ã</li>
<li>Electron æè¿äºå·®å¼å¨é¨æ¹å¹³å¨ Chromium å±ä¹ä¸ã</li>
<li><strong>ç»è®ºï¼</strong> å®æ¯ <strong>RAM æ¢å¼åæç (Memory for Velocity)</strong> çæè´ä½ç°ãå¯¹äºç°ä»£ç¡¬ä»¶æ¥è¯´ï¼æµªè´¹ 500MB åå­æ¢å 3 åçå¼åéåº¦ï¼æ¯åä¸ä¸åççäº¤æ¢ã</li>
</ul>
<hr>
<p><strong>ç»è¯­ï¼å¨æ çç»å±</strong></p>
<p>è¯»å®è¿äºç« ï¼ä½ä¸ºç³»ç»ç¨åºåçä½ åºè¯¥å·²ç»çéäº JavaScript/TypeScript çæçæ¬è´¨ï¼</p>
<ol>
<li><strong>å®ä¸ååªæ¯èæ¬</strong>ï¼å®æ¯ä¸ä¸ªæå¶å¤æçãåå±çç¼è¯ç®æ ã</li>
<li><strong>å®æ­£å¨âä¸æ²â</strong>ï¼å·¥å·é¾æ­£å¨ç¨ç³»ç»è¯­è¨ï¼Go/Rustï¼éåï¼ä»¥è¿½æ±æè´æ§è½ã</li>
<li><strong>å®åªæ¯å·¥å·</strong>ï¼å°±å C++ æ¯æçºµåå­çå·¥å·ï¼React/TS æ¯æçºµ UI ç¶æçå·¥å·ã</li>
</ol>
<p>ä¸è¦è¢«è¡¨é¢çæ¡æ¶æäºè¿·æã<strong>Keep your eyes on the metal, even when coding in the cloud.</strong></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 20:27">2026-02-09 20:26</span>&nbsp;
<a href="https://www.cnblogs.com/kaiux">å¿µé£é¶å£¹</a>&nbsp;
éè¯»(<span id="post_view_count">16</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19596869);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19596869', targetLink: 'https://www.cnblogs.com/kaiux/p/19596869', title: 'AI æ¶ä»£çåç«¯ææ¯ï¼ä»ç³»ç»ç¼ç¨å° JavaScript/TypeScript' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãå¼æºããclipãä¸ä¸ªä¸å°4Mçãè·¨å¹³å°çãæ¯æåç»ãæç´¢ãèªå®ä¹æ¡æ°ãå±åç½å±äº«çãåªè´´æ¿åå²å·¥å· ]]></title>
    <link>https://www.cnblogs.com/Doyoung/p/19596816</link>
    <guid>841b08319e6dfe90d88106aad0b0360a</guid>
    <description>
    <![CDATA[ 
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Doyoung/p/19596816" title="åå¸äº 2026-02-09 20:03">
    <span role="heading" aria-level="2">ãå¼æºããclipãä¸ä¸ªä¸å°4Mçãè·¨å¹³å°çãæ¯æåç»ãæç´¢ãèªå®ä¹æ¡æ°ãå±åç½å±äº«çãåªè´´æ¿åå²å·¥å·</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å¼æºclipä¸ä¸ªä¸å°-4m-çè·¨å¹³å°åªè´´æ¿åå²å·¥å·">ãå¼æºããclipãä¸ä¸ªä¸å° 4M çè·¨å¹³å°åªè´´æ¿åå²å·¥å·</h2>
<p>ä¸æ¬¾è½»éçº§çåªè´´æ¿åå²ç®¡çå·¥å·ï¼æ¯æåç»ç®¡çãåå®¹æç´¢ãèªå®ä¹æ¡æ°ãå±åç½å±äº«ç­åè½ã</p>
<h3 id="ç¹æ§">ç¹æ§</h3>
<ul>
<li>ä½ç§¯å°å·§ï¼ä¸å° 4M</li>
<li>è·¨å¹³å°æ¯æ</li>
<li>æ¯æææ¬åå¾ç</li>
<li>åç»ç®¡ç</li>
<li>åå®¹æç´¢</li>
<li>èªå¨è¯å«é¢è²</li>
<li>å±åç½å±äº«</li>
</ul>
<h3 id="å¼æºä»åº">å¼æºä»åº</h3>
<ul>
<li><a href="https://github.com/DoYoungDo/clip" target="_blank" rel="noopener nofollow">GitHub</a></li>
<li><a href="https://gitee.com/DoyoungDo/clip" target="_blank" rel="noopener nofollow">Gitee</a></li>
</ul>
<h3 id="å®è£">å®è£</h3>
<p>ä» <a href="https://github.com/DoYoungDo/clip/releases" target="_blank" rel="noopener nofollow">GitHub Releases</a> æ <a href="https://gitee.com/DoyoungDo/clip/releases" target="_blank" rel="noopener nofollow">Gitee Releases</a> ä¸è½½å¯¹åºå¹³å°ççæ¬ã</p>
<p><strong>æ¯æå¹³å°</strong></p>
<ul>
<li>macOSï¼ç´æ¥ä¸è½½è¿è¡</li>
<li>Windowsï¼ç´æ¥ä¸è½½è¿è¡</li>
<li>Linuxï¼éè¦èªè¡ç¼è¯</li>
</ul>
<p>æ¬å·¥å·ä¸ºåå®è£çæ¬ï¼ä¸è½½è§£ååç´æ¥è¿è¡å³å¯ã</p>
<h3 id="åè½ä»ç»">åè½ä»ç»</h3>
<h4 id="åªè´´æ¿åå²è®°å½">åªè´´æ¿åå²è®°å½</h4>
<p>clip å¯å¨åä¼å¨ç³»ç»æçæ¾ç¤ºå¾æ ï¼</p>
<p><img alt="ç³»ç»æçå¾æ " loading="lazy" data-src="https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAEQz9BpibuGp8YpRgJFru9mmB-qcnyUxAACQB8AAplwUFTV4SAl4syhwzoE.png" class="lazyload"></p>
<p><strong>å·¦é®ç¹å»å¾æ </strong>ï¼æ¾ç¤ºèåï¼åä¸ºä¸¤é¨å</p>
<ul>
<li>ä¸åé¨åï¼æè¿çåªè´´æ¿åå²è®°å½</li>
<li>ä¸åé¨åï¼åç»åè¡¨</li>
</ul>
<p><img alt="èåçé¢" loading="lazy" data-src="https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAEQz9Npibyffo7BRRULi630AAFwpZEj_1UAAk0fAAKZcFBUN8doIOMWhEU6BA.png" class="lazyload"></p>
<p>ç¹å»ä»»æä¸æ¡è®°å½ï¼ä¼å°å¶å¤å¶å°ç³»ç»åªè´´æ¿ï¼åæ¶è¯¥è®°å½ä¼ç§»å¨å°åè¡¨é¡¶é¨ãåè¡¨é¡¶é¨å§ç»æ¾ç¤ºå½ååªè´´æ¿çåå®¹ã</p>
<p>æ¯æçåå®¹ç±»åï¼ææ¬ãå¾ç</p>
<p><strong>å³é®ç¹å»å¾æ </strong>ï¼é¤äºæ¾ç¤ºåå²è®°å½ï¼è¿ä¼æ¾ç¤ºé¢å¤çæä½éé¡¹ï¼å¦æ¸ç©ºåå²è®°å½ãåå»ºåç»ç­ã</p>
<p><img alt="å³é®èå" loading="lazy" data-src="https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAEQz-hpib4NFys9Z99u9c9F5g_YpsEYpAACbR8AAplwUFR7VRLlg4XZuToE.png" class="lazyload"></p>
<h4 id="åç»ç®¡ç">åç»ç®¡ç</h4>
<p><strong>åå»ºåç»</strong></p>
<p>æä½è·¯å¾ï¼<code>å³é®</code> â <code>åå»ºåç»</code></p>
<p>ä¼ä»¥å½ååªè´´æ¿åå®¹ï¼åè¡¨é¡¶é¨è®°å½ï¼ä½ä¸ºåç»ååå»ºåç»ã</p>
<p>æ³¨æäºé¡¹ï¼</p>
<ul>
<li>å¦æå½ååªè´´æ¿åå®¹æ¯å¾çï¼åå»ºä¼å¤±è´¥</li>
<li>å¯ä»¥åå¤å¶æ³è¦çåç»åï¼åæ§è¡åå»ºæä½</li>
</ul>
<p><strong>éå½ååç»</strong></p>
<p>æä½è·¯å¾ï¼<code>å³é®</code> â <code>åç»</code> â <code>éå½å</code></p>
<p>åæ ·ä¼ä½¿ç¨å½ååªè´´æ¿åå®¹ä½ä¸ºæ°çåç»åã</p>
<p><strong>æ¿æ´»ç¶æ</strong></p>
<p>åç»ææ¿æ´»åéæ¿æ´»ä¸¤ç§ç¶æï¼é»è®¤ä¸ºéæ¿æ´»ã</p>
<p>æ¿æ´»ç¶æä¸ï¼ææå¤å¶çåå®¹ä¼èªå¨åæ­¥å°è¯¥åç»ä¸­ï¼å¯ä»¥ç¨ä½ TODO LISTã</p>
<p><strong>æä¹åå­å¨</strong></p>
<p>å·¥å·æ¯ææ¬å°æä¹åå­å¨ï¼éåºååæ¬¡å¯å¨ä¼èªå¨å è½½ï¼</p>
<ul>
<li>åå²è®°å½</li>
<li>åç»ä¿¡æ¯</li>
<li>æ¿æ´»ç¶æ</li>
</ul>
<p><strong>å é¤åç»</strong></p>
<p>æä½è·¯å¾ï¼<code>å³é®</code> â <code>åç»</code> â <code>å é¤åç»</code></p>
<h4 id="åå®¹æç´¢">åå®¹æç´¢</h4>
<p>æ¬å·¥å·ä¸ºçº¯èåæä½ï¼æ è¾å¥æ¡ã</p>
<p>æç´¢æ­¥éª¤ï¼</p>
<ol>
<li>å°è¦æç´¢çåå®¹å¤å¶å°åªè´´æ¿ï¼ä½¿å¶æä¸ºåè¡¨é¡¶é¨è®°å½ï¼</li>
<li>æä½è·¯å¾ï¼<code>å³é®</code> â <code>æç´¢</code></li>
<li>åæ¬¡ç¹å»æçå¾æ æ¶ï¼ä¼æ¾ç¤ºè¿æ»¤åçç»æ</li>
</ol>
<h4 id="èªå¨è¯å«é¢è²">èªå¨è¯å«é¢è²</h4>
<p><strong>å¼å¯æ¹å¼</strong></p>
<p>æä½è·¯å¾ï¼<code>å³é®</code> â <code>éç½®</code> â <code>èªå¨è¯å«é¢è²</code></p>
<p><strong>æ¯æçé¢è²æ ¼å¼</strong></p>
<p>å¼å¯åï¼å·¥å·ä¼èªå¨è¯å«ä»¥ä¸æ ¼å¼çé¢è²ææ¬ï¼</p>
<ul>
<li>åå­è¿å¶ï¼<code>#fff</code>ã<code>#ffffff</code></li>
<li>RGBï¼<code>(255,255,255)</code>ã<code>255,255,255</code></li>
</ul>
<p><strong>å¿«éè½¬æ¢</strong></p>
<p>å¨é¢è²ææ¬è®°å½ä¸å¯ä»¥ç´æ¥å¤å¶ä¸ºæå®æ ¼å¼ï¼å®ç°å¿«éæ ¼å¼è½¬æ¢ã</p>
<p><img alt="é¢è²è¯å«" loading="lazy" data-src="https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAEQ0AxpicUAAVpC_cELk04GgItxgbD2S0YAArAfAAKZcFBUmOshBCmDGPQ6BA.png" class="lazyload"></p>
<h4 id="èªå®ä¹åå²è®°å½æ¡æ°">èªå®ä¹åå²è®°å½æ¡æ°</h4>
<p><strong>è®¾ç½®èå´</strong></p>
<p>æå° 1 æ¡ï¼æå¤§ 300 æ¡ï¼é»è®¤ 50 æ¡ã</p>
<p><strong>è®¾ç½®æ­¥éª¤</strong></p>
<ol>
<li>å°è¦è®¾ç½®çæ¡æ°ï¼æ°å­ï¼å¤å¶å°åªè´´æ¿</li>
<li>æä½è·¯å¾ï¼<code>å³é®</code> â <code>éç½®</code> â <code>è®¾ç½®æå¤§åå²è®°å½æ¡æ°</code></li>
</ol>
<p><strong>æ³¨æäºé¡¹</strong></p>
<ol>
<li>å¦ææ°è®¾ç½®çæ¡æ°å°äºå½ååå²è®°å½æ°éï¼è¶åºé¨åä¼è¢«å é¤ï¼ä»ä¿çææ°çè®°å½ãå é¤çè®°å½ä¸ä¼è¢«æä¹åä¿å­ã</li>
<li>å¦æåè¡¨é¡¶é¨è®°å½ä¸æ¯æ°å­ï¼ä¼è®¾ç½®å¤±è´¥</li>
</ol>
<h4 id="å±åç½å±äº«">å±åç½å±äº«</h4>
<p>å±åç½åçè®¾å¤å¯ä»¥éè¿æ¬å·¥å·å®ç°åªè´´æ¿å±äº«ï¼æ¯æææ¬åå¾çï¼ã</p>
<p><strong>å±äº«ç«¯ï¼æºå¨ Aï¼</strong></p>
<p>æä½è·¯å¾ï¼<code>å³é®</code> â <code>éç½®</code> â <code>å±åç½å±äº«</code> â <code>å±åç½å±äº«</code></p>
<p>å¼å¯åä¼èªå¨å°çå¬å°åï¼æ ¼å¼ï¼<code>192.168.1.100:8080</code>ï¼å¤å¶å°åªè´´æ¿ã</p>
<p><strong>æ¥æ¶ç«¯ï¼æºå¨ Bï¼</strong></p>
<ol>
<li>å°å±äº«ç«¯çå°åå¤å¶å°åªè´´æ¿</li>
<li>æä½è·¯å¾ï¼<code>å³é®</code> â <code>éç½®</code> â <code>å±åç½å±äº«</code> â <code>è¿æ¥å°</code></li>
<li>åæ¬¡æ§è¡ç¸åæä½å¯æ­å¼è¿æ¥</li>
</ol>
<p><strong>åæ­¥è¯´æ</strong></p>
<p>è¿æ¥æååï¼å±äº«ç«¯ï¼Aï¼çææå¤å¶æä½ä¼å®æ¶åæ­¥å°æ¥æ¶ç«¯ï¼Bï¼çåªè´´æ¿ï¼è¿æ¥åçåå²è®°å½ä¸ä¼åæ­¥ã</p>


</div>
<div id="MySignature" role="contentinfo">
    åä¸æ¡æçæ³çå¸é±¼
</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 20:03">2026-02-09 20:03</span>&nbsp;
<a href="https://www.cnblogs.com/Doyoung">å¸é±¼Doyoung</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19596816);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19596816', targetLink: 'https://www.cnblogs.com/Doyoung/p/19596816', title: 'ãå¼æºããclipãä¸ä¸ªä¸å°4Mçãè·¨å¹³å°çãæ¯æåç»ãæç´¢ãèªå®ä¹æ¡æ°ãå±åç½å±äº«çãåªè´´æ¿åå²å·¥å·' })">ä¸¾æ¥</a>
</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ OpenClaw for macOS: å®æ´æ¬å°åé¨ç½²æåï¼2026.2.6-3 çæ¬ï¼ ]]></title>
    <link>https://www.cnblogs.com/xiaobaiysf/p/19595515</link>
    <guid>14a0f52d34ad1dfdaab934c077874c7c</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaobaiysf/p/19595515" title="åå¸äº 2026-02-09 15:06">
    <span role="heading" aria-level="2">OpenClaw for macOS: å®æ´æ¬å°åé¨ç½²æåï¼2026.2.6-3 çæ¬ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260209150457965-1453431698.png" alt="OpenClaw for macOS: å®æ´æ¬å°åé¨ç½²æåï¼2026.2.6-3 çæ¬ï¼" class="desc_img">
        åºäºMacç¯å¢å®è£ OpenClaw ï¼æå»ºä½ çä¸ªäººAIå©çï¼
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ä¸ææ¡£è¯´æ">ä¸ãææ¡£è¯´æ</h1>
<p>æ¬ææ¡£é¢å macOS ç³»ç»ç¨æ·ï¼ä»<strong>åºç¡ç¯å¢æ­å»ºï¼Node.js å®è£ï¼</strong> å° <strong>OpenClaw å®æ´é¨ç½²</strong>ï¼åå°é®é¢ææ¥ãæ®ä½æ¸çï¼æä¾å¨æµç¨æ ååæä½ï¼éé OpenClaw 2026.2.6-3 çæ¬ï¼æç»å®ç° DeepSeek æ¨¡åçç¨³å®è°ç¨ã</p>
<h1 id="äºé¨ç½²åç½®æ¡ä»¶">äºãé¨ç½²åç½®æ¡ä»¶</h1>
<h2 id="1-ç³»ç»è¦æ±">1. ç³»ç»è¦æ±</h2>
<ul>
<li>
<p>æä½ç³»ç»ï¼macOS 10.15+ï¼æ¬æä»¥ MacBook Air (Mç³»å/Intel) ä¸ºä¾ï¼</p>
</li>
<li>
<p>æéï¼æ¥æç»ç«¯ç®¡çåæéï¼å¯æ§è¡ <code>sudo</code> å½ä»¤ï¼</p>
</li>
<li>
<p>ç½ç»ï¼è½æ­£å¸¸è®¿é® DeepSeek APIï¼å½åç½ç»ç´æ¥æ¯æï¼</p>
</li>
</ul>
<h2 id="2-é¢æææ">2. é¢æææ</h2>
<ul>
<li>
<p>å®æ Node.js ç¯å¢æ­å»ºï¼v24.13.0 åä»¥ä¸ï¼ï¼</p>
</li>
<li>
<p>OpenClaw ç½å³æ­£å¸¸å¯å¨ï¼ç«¯å£ 18789 å¯è®¿é®ï¼</p>
</li>
<li>
<p>OpenClaw UI è½è°ç¨ DeepSeek æ¨¡åå¹¶è¿åå¯¹è¯ç»æã</p>
</li>
</ul>
<h1 id="ä¸åºç¡ç¯å¢æ­å»ºnodejs-å®è£">ä¸ãåºç¡ç¯å¢æ­å»ºï¼Node.js å®è£ï¼</h1>
<p>OpenClaw åºäº Node.js è¿è¡ï¼éåå®æ Node.js å®è£ä¸çæ¬éªè¯ã</p>
<h3 id="æ­¥éª¤1å®è£-homebrewmacos-åç®¡çå¨æ¨è">æ­¥éª¤1ï¼å®è£ Homebrewï¼macOS åç®¡çå¨ï¼æ¨èï¼</h3>
<p>è¥å·²å®è£ Homebrewï¼è·³è¿æ­¤æ­¥éª¤ï¼æªå®è£åæ§è¡ï¼</p>
<pre><code class="language-Bash">
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
</code></pre>
<p>â éªè¯å®è£ï¼</p>
<pre><code class="language-Bash">
brew -v
</code></pre>
<p>è¾åº <code>Homebrew 4.x.x</code> å³å®è£æåã</p>
<h3 id="æ­¥éª¤2å®è£-nodejs">æ­¥éª¤2ï¼å®è£ Node.js</h3>
<p>éè¿ Homebrew å®è£ç¨³å®ç Node.jsï¼èªå¨éé v24+ï¼ï¼</p>
<pre><code class="language-Bash">
brew install node
</code></pre>
<p>â éªè¯å®è£ä¸çæ¬ï¼</p>
<pre><code class="language-Bash">
# æ¥ç Node.js çæ¬
node -v
# æ¥ç npm çæ¬ï¼Node.js èªå¸¦ï¼
npm -v
</code></pre>
<ul>
<li>
<p>â è¾åº <code>node v24.13.0</code> åä»¥ä¸ã<code>npm 10.x.x</code> å³ç¬¦åè¦æ±ï¼</p>
</li>
<li>
<p>â è¥çæ¬è¿ä½ï¼æ§è¡ <code>brew upgrade node</code> åçº§ã</p>
</li>
</ul>
<h3 id="æ­¥éª¤3éç½®-npm-å¨å±è·¯å¾å¯éé¿åæéæ¥é">æ­¥éª¤3ï¼éç½® npm å¨å±è·¯å¾ï¼å¯éï¼é¿åæéæ¥éï¼</h3>
<pre><code class="language-Bash">
# åå»ºå¨å±ç®å½
mkdir -p ~/.npm-global
# éç½® npm å¨å±è·¯å¾
npm config set prefix '~/.npm-global'
# å°å¨å±è·¯å¾å å¥ç¯å¢åéï¼æ°¸ä¹çæï¼
echo 'export PATH=~/.npm-global/bin:$PATH' &gt;&gt; ~/.zshrc
# çæç¯å¢åé
source ~/.zshrc
</code></pre>
<p>â éªè¯éç½®ï¼</p>
<pre><code class="language-Bash">
npm config get prefix
</code></pre>
<p>è¾åº <code>~/.npm-global</code> å³éç½®æåã</p>
<h2 id="åopenclaw-å®æ´é¨ç½²æµç¨">åãOpenClaw å®æ´é¨ç½²æµç¨</h2>
<h3 id="æ­¥éª¤1å®è£-openclaw-å">æ­¥éª¤1ï¼å®è£ OpenClaw å</h3>
<p>éè¿ npm å¨å±å®è£ OpenClawï¼</p>
<pre><code class="language-Bash">
npm install -g openclaw
</code></pre>
<p>â éªè¯å®è£è·¯å¾ï¼</p>
<pre><code class="language-Bash">
ls ~/.npm-global/lib/node_modules/openclaw
</code></pre>
<p>è¾åº OpenClaw ç¸å³æä»¶ï¼å¦ <code>dist</code>ã<code>package.json</code>ï¼å³å®è£æåã</p>
<h3 id="æ­¥éª¤2openclaw-éç½®æä»¶åå§åä¸ä¿®æ¹">æ­¥éª¤2ï¼OpenClaw éç½®æä»¶åå§åä¸ä¿®æ¹</h3>
<p>OpenClaw æ ¸å¿éç½®æä»¶ä¸º <code>~/.openclaw/openclaw.json</code>ï¼éç¡®ä¿è¯­æ³åæ³ä¸éé DeepSeek æ¨¡åã</p>
<h4 id="21-åå§åéç½®ç®å½é¦æ¬¡é¨ç½²">2.1 åå§åéç½®ç®å½ï¼é¦æ¬¡é¨ç½²ï¼</h4>
<pre><code class="language-Bash">
mkdir -p ~/.openclaw
</code></pre>
<h4 id="22-å¤ä»½åæéç½®è¥æ">2.2 å¤ä»½åæéç½®ï¼è¥æï¼</h4>
<pre><code class="language-Bash">
if [ -f ~/.openclaw/openclaw.json ]; then
  mkdir -p ~/.openclaw/backup
  cp ~/.openclaw/openclaw.json ~/.openclaw/backup/openclaw.json.bak
fi
</code></pre>
<h4 id="23-åå¥éé-deepseek-çæ ééç½®æ ¸å¿">2.3 åå¥éé DeepSeek çæ ééç½®ï¼æ ¸å¿ï¼</h4>
<p>æ§è¡ä»¥ä¸å½ä»¤ï¼ç´æ¥åå¥é¢éªè¯çåæ³éç½®ï¼æ¿æ¢å ä½ç¬¦ä¸ºçå®ä¿¡æ¯ï¼ï¼</p>
<pre><code class="language-Bash">
cat &gt; ~/.openclaw/openclaw.json &lt;&lt; 'EOF'
{
  "meta": {
    "lastTouchedVersion": "2026.2.6-3",
    "lastTouchedAt": "2026-02-08T07:43:20.228Z"
  },
  "models": {
    "mode": "merge",
    "providers": {
      "deepseek": {
        "baseUrl": "https://api.deepseek.com/v1",
        "apiKey": "ä½ çDeepSeek API Key", // æ¿æ¢ä¸ºçå®Keyï¼æ ¼å¼ï¼sk-xxxxï¼
        "api": "openai-completions",
        "models": [
          {
            "id": "deepseek-chat",
            "name": "DeepSeek Chat",
            "input": ["text"],
            "contextWindow": 128000,
            "maxTokens": 8192,
            "reasoning": false
          }
        ]
      }
    }
  },
  "agents": {
    "defaults": {
      "workspace": "/Users/ä½ çç¨æ·å/.openclaw/workspace", // æ¿æ¢ä¸ºå®éç¨æ·åï¼å¦ zhufeigeï¼
      "maxConcurrent": 4,
      "subagents": {
        "maxConcurrent": 8
      },
      "model": {
        "primary": "deepseek/deepseek-chat" // æå®é»è®¤è°ç¨ DeepSeek æ¨¡å
      }
    }
  },
  "gateway": {
    "port": 18789,
    "mode": "local",
    "auth": {
      "mode": "token",
      "token": "39769ded65eac493eceeb0fb6a543fb48ed4fce3f1166bf5" // æ¿æ¢ä¸ªäººçæçæ­¤å¼å³å¯
    }
  }
}
EOF
</code></pre>
<h4 id="24-éç½®æä»¶ä¿®æ¹è¯´æ">2.4 éç½®æä»¶ä¿®æ¹è¯´æ</h4>
<ul>
<li>
<p>æ¿æ¢ <code>ä½ çDeepSeek API Key</code>ï¼ä» <a href="https://platform.deepseek.com/" target="_blank" rel="noopener nofollow">DeepSeek æ§å¶å°</a> è·åï¼æ ¼å¼ä¸º <code>sk-xxxx</code>ï¼</p>
</li>
<li>
<p>æ¿æ¢ <code>ä½ çç¨æ·å</code>ï¼macOS ç¨æ·åå¯éè¿ <code>whoami</code> å½ä»¤æ¥çï¼ç»ç«¯æ§è¡ <code>whoami</code> å³å¯è¾åºï¼ï¼</p>
</li>
<li>
<p>çæå¹¶æå°OpenClawçtoken</p>
</li>
</ul>
<pre><code>node ~/.npm-global/lib/node_modules/openclaw/openclaw.mjs gateway token --print
</code></pre>
<h4 id="25-éç½®è¯­æ³éªè¯å¿åé¿åå¯å¨æ¥é">2.5 éç½®è¯­æ³éªè¯ï¼å¿åï¼é¿åå¯å¨æ¥éï¼</h4>
<pre><code class="language-Bash">
node -e "JSON.parse(require('fs').readFileSync('/Users/$(whoami)/.openclaw/openclaw.json', 'utf8'))"
</code></pre>
<ul>
<li>
<p>â ç»ç«¯æ ä»»ä½è¾åº â è¯­æ³å®å¨æ­£ç¡®ï¼</p>
</li>
<li>
<p>â è¥æ¥éï¼æ£æ¥æ¯å¦æå¨è§å­ç¬¦ï¼å¦ <code>ï¼</code>/<code>ï¼</code>ï¼ãå¤ä½/ç¼ºå¤±ç <code>{}</code>/<code>,</code>/<code>"</code>ã</p>
</li>
</ul>
<h4 id="26-ä¿®å¤éç½®æé">2.6 ä¿®å¤éç½®æé</h4>
<pre><code class="language-Bash">
node ~/.npm-global/lib/node_modules/openclaw/openclaw.mjs doctor --fix
</code></pre>
<p>â è¾åºæ  <code>Config validation failed</code> å³æéä¿®å¤æåã</p>
<h3 id="æ­¥éª¤3å¯å¨-openclaw-ç½å³">æ­¥éª¤3ï¼å¯å¨ OpenClaw ç½å³</h3>
<h4 id="31-æ¸çæ®ä½è¿ç¨é¿åç«¯å£å²çª">3.1 æ¸çæ®ä½è¿ç¨ï¼é¿åç«¯å£å²çªï¼</h4>
<pre><code class="language-Bash">
# æ¹æ³1ï¼OpenClaw å®æ¹åæ­¢å½ä»¤
openclaw gateway stop

# æ¹æ³2ï¼å¼ºå¶ææ­»ææ OpenClaw è¿ç¨ï¼æ¨èï¼
pkill -f openclaw

# æ¹æ³3ï¼ææ­»å ç¨ 18789 ç«¯å£çè¿ç¨ï¼è¥ç«¯å£è¢«å ç¨ï¼
lsof -i :18789 | grep -v PID | awk '{print $2}' | xargs kill -9 2&gt;/dev/null
</code></pre>
<h4 id="32-å¯å¨ç½å³æå®ç«¯å£å¹¶å¼ºå¶éè½½">3.2 å¯å¨ç½å³ï¼æå®ç«¯å£å¹¶å¼ºå¶éè½½ï¼</h4>
<pre><code class="language-Bash">
node ~/.npm-global/lib/node_modules/openclaw/openclaw.mjs gateway --port 18789 --force
</code></pre>
<p>â ç»ç«¯è¾åºä»¥ä¸åå®¹å³å¯å¨æåï¼</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260209145547789-839350878.png" class="lazyload"></p>
<h3 id="æ­¥éª¤4éªè¯é¨ç½²ææ">æ­¥éª¤4ï¼éªè¯é¨ç½²ææ</h3>
<h4 id="41-å®æ¶çæ§è¿è¡æ¥å¿">4.1 å®æ¶çæ§è¿è¡æ¥å¿</h4>
<p>æå¼æ°ç»ç«¯çªå£ï¼æ§è¡ä»¥ä¸å½ä»¤è·è¸ªæ¥å¿ï¼ææ¥é®é¢å³é®ï¼ï¼</p>
<pre><code class="language-Bash">
tail -f /tmp/openclaw/openclaw-$(date +%Y-%m-%d).log
</code></pre>
<ul>
<li>
<p>æ  <code>error</code>/<code>invalid config</code> å³é®å­ â è¿è¡æ­£å¸¸ï¼</p>
</li>
<li>
<p>è¥åºç° <code>API request failed</code> â æ£æ¥ DeepSeek API Key æ¯å¦ææã</p>
</li>
</ul>
<h4 id="42-è®¿é®-openclaw-ui-æµè¯å¯¹è¯">4.2 è®¿é® OpenClaw UI æµè¯å¯¹è¯</h4>
<ol>
<li>æå¼æµè§å¨ï¼è®¿é® <code>http://127.0.0.1:18789</code>ï¼</li>
</ol>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3600464/202602/3600464-20260209145655015-1404019001.png" class="lazyload"></p>
<ol start="2">
<li>
<p>å¨è¾å¥æ¡åéæµè¯æ¶æ¯ï¼å¦ãtestãæãä½ å¥½ãï¼ï¼</p>
</li>
<li>
<p>â æ¶å° DeepSeek åå¤ â é¨ç½²å®å¨æåï¼</p>
</li>
<li>
<p>â æ åå¤ï¼æ§è¡ä»¥ä¸å½ä»¤éªè¯ API Key æææ§ï¼</p>
<pre><code class="language-Bash">
curl -s -X POST https://api.deepseek.com/v1/chat/completions \
  -H "Authorization: Bearer ä½ çDeepSeek API Key" \
  -H "Content-Type: application/json" \
  -d '{"model":"deepseek-chat","messages":[{"role":"user","content":"test"}]}'
</code></pre>
<ul>
<li>
<p>è¾åºåå« <code>"content"</code> å­æ®µ â API Key ææï¼éå¯ç½å³å³å¯ï¼</p>
</li>
<li>
<p>è¾åº <code>Unauthorized</code> â API Key æ æï¼éæ°ä» DeepSeek æ§å¶å°çæã</p>
</li>
</ul>
</li>
</ol>
<h1 id="äºå¸¸è§é®é¢ææ¥">äºãå¸¸è§é®é¢ææ¥</h1>
<h2 id="é®é¢1nodejs-å®è£å¤±è´¥">é®é¢1ï¼Node.js å®è£å¤±è´¥</h2>
<ul>
<li>
<p>åå ï¼ç½ç»é®é¢å¯¼è´ Homebrew ä¸è½½å¤±è´¥ï¼</p>
</li>
<li>
<p>è§£å³ï¼åæ¢å½åæºå®è£ Node.jsï¼</p>
<pre><code class="language-Bash">
# éç½® npm å½åæº
npm config set registry https://registry.npmmirror.com
# ç´æ¥éè¿ npm å®è£ Node.js
npm install -g n
n 24.13.0
</code></pre>
</li>
</ul>
<h2 id="é®é¢2json-è¯­æ³éè¯¯å¦-invalid-character-">é®é¢2ï¼JSON è¯­æ³éè¯¯ï¼å¦ <code>invalid character ':'</code>ï¼</h2>
<ul>
<li>
<p>åå ï¼éç½®æä»¶å­å¨æ ¼å¼éè¯¯ï¼å¨è§å­ç¬¦ãå¤ä½ç¬¦å·ï¼ï¼</p>
</li>
<li>
<p>è§£å³ï¼ç´æ¥éæ°æ§è¡æ­¥éª¤2.3 çéç½®åå¥å½ä»¤ï¼é¿åæå¨ä¿®æ¹æ ¼å¼ã</p>
</li>
</ul>
<h2 id="é®é¢3ç«¯å£å²çªgateway-already-running-locally">é®é¢3ï¼ç«¯å£å²çªï¼<code>Gateway already running locally</code>ï¼</h2>
<ul>
<li>
<p>åå ï¼18789 ç«¯å£è¢«å ç¨ï¼æ OpenClaw è¿ç¨æªå½»åºåæ­¢ï¼</p>
</li>
<li>
<p>è§£å³ï¼æ§è¡æ­¥éª¤3.1 çè¿ç¨æ¸çå½ä»¤ï¼ææ´æ¢å¯å¨ç«¯å£ï¼å¦ <code>--port 18788</code>ï¼ã</p>
</li>
</ul>
<h2 id="é®é¢4ui-æ å¯¹è¯åé¦ç½å³å¯å¨æ­£å¸¸">é®é¢4ï¼UI æ å¯¹è¯åé¦ï¼ç½å³å¯å¨æ­£å¸¸ï¼</h2>
<ul>
<li>åå 1ï¼æªæå®é»è®¤æ¨¡åï¼<code>agents.defaults.model.primary</code> ç¼ºå¤±ï¼ï¼</li>
</ul>
<p>è§£å³ï¼ç¡®ä¿éç½®ä¸­åå« <code>"primary": "deepseek/deepseek-chat"</code>ï¼</p>
<ul>
<li>åå 2ï¼API Key æ æ/è¿æï¼</li>
</ul>
<p>è§£å³ï¼éæ°ä» DeepSeek æ§å¶å°çæ Key å¹¶æ¿æ¢éç½®ï¼</p>
<ul>
<li>åå 3ï¼éç½®åå«åä½å­æ®µï¼<code>wizard</code>/<code>messages</code>/<code>commands</code>ï¼ï¼</li>
</ul>
<p>è§£å³ï¼å é¤åä½å­æ®µï¼ä»ä¿çæ­¥éª¤2.3 ä¸­çæ ¸å¿éç½®ã</p>
<h2 id="é®é¢5docker-å®¹å¨åç§°å²çªcontainer-name-already-in-use">é®é¢5ï¼Docker å®¹å¨åç§°å²çªï¼<code>container name already in use</code>ï¼</h2>
<ul>
<li>
<p>åå ï¼1Panel é¨ç½²ç OpenClaw å®¹å¨æªå é¤ï¼</p>
</li>
<li>
<p>è§£å³ï¼</p>
<pre><code class="language-Bash">
# åæ­¢å²çªå®¹å¨ï¼æ¿æ¢ä¸ºå®éå®¹å¨ID/åç§°ï¼
docker stop 1Panel-openclaw-rt8j
# å é¤å²çªå®¹å¨
docker rm 1Panel-openclaw-rt8j
</code></pre>
</li>
</ul>
<h1 id="å­openclaw-æ®ä½åå®¹æ¸çå½»åºå¸è½½éç½®">å­ãOpenClaw æ®ä½åå®¹æ¸çï¼å½»åºå¸è½½/éç½®ï¼</h1>
<p>è¥ééæ°é¨ç½²æå®å¨å¸è½½ OpenClawï¼æ§è¡ä»¥ä¸å½ä»¤æ¸çæææ®ä½æä»¶ï¼</p>
<h3 id="1-åæ­¢ææ-openclaw-è¿ç¨">1. åæ­¢ææ OpenClaw è¿ç¨</h3>
<pre><code class="language-Bash">
pkill -f openclaw
openclaw gateway stop
</code></pre>
<h3 id="2-å é¤-openclaw-æ ¸å¿ç®å½éç½®æ°æ®">2. å é¤ OpenClaw æ ¸å¿ç®å½ï¼éç½®+æ°æ®ï¼</h3>
<pre><code class="language-Bash">
rm -rf ~/.openclaw
</code></pre>
<h3 id="3-å é¤-openclaw-æ¥å¿æä»¶">3. å é¤ OpenClaw æ¥å¿æä»¶</h3>
<pre><code class="language-Bash">
rm -rf /tmp/openclaw
</code></pre>
<h3 id="4-å¸è½½-openclaw-npm-å">4. å¸è½½ OpenClaw npm å</h3>
<pre><code class="language-Bash">
npm uninstall -g openclaw
</code></pre>
<h2 id="5-æ¸ç-docker-æ®ä½è¥éè¿-1paneldocker-é¨ç½²è¿">5. æ¸ç Docker æ®ä½ï¼è¥éè¿ 1Panel/Docker é¨ç½²è¿ï¼</h2>
<pre><code class="language-Bash">
# ååºææå®¹å¨
docker ps -a | grep openclaw
# å é¤ OpenClaw ç¸å³å®¹å¨ï¼æ¿æ¢ä¸ºå®éå®¹å¨IDï¼
docker rm å®¹å¨ID
# æ¸çæªä½¿ç¨çéå/å·ï¼å¯éï¼
docker system prune -a
</code></pre>
<h2 id="6-éªè¯æ¸çå®æ">6. éªè¯æ¸çå®æ</h2>
<pre><code class="language-Bash">
# æ£æ¥è¿ç¨ï¼æ è¾åºå³æ¸çæåï¼
ps -ef | grep openclaw | grep -v grep
# æ£æ¥ç®å½ï¼æ è¾åºå³æ¸çæåï¼
ls ~/.openclaw
ls /tmp/openclaw
</code></pre>
<h1 id="ä¸æ³¨æäºé¡¹">ä¸ãæ³¨æäºé¡¹</h1>
<h3 id="1-ç¯å¢éç½®è§è">1. ç¯å¢éç½®è§è</h3>
<ul>
<li>
<p>Node.js çæ¬ï¼å¿é¡» v24.13.0 åä»¥ä¸ï¼ä½çæ¬ä¼å¯¼è´ OpenClaw å¯å¨å¤±è´¥ï¼</p>
</li>
<li>
<p>npm å¨å±è·¯å¾ï¼éç½®åé¿å <code>EACCES</code> æéæ¥éï¼å»ºè®®å¿åï¼</p>
</li>
<li>
<p>éç½®æä»¶ï¼JSON è¯­æ³ä¸¥æ ¼ï¼ä»ä½¿ç¨åè§ç¬¦å·ï¼æ æ³¨éï¼é®å/å¼å¿é¡»ç¨åå¼å·åè£¹ã</p>
</li>
</ul>
<h3 id="2-æ¨¡åä½¿ç¨æ³¨æ">2. æ¨¡åä½¿ç¨æ³¨æ</h3>
<ul>
<li>
<p>ä¼åéæ© DeepSeekï¼Anthropic æ¨¡åéå½éä¿¡ç¨å¡åå¼ãåè§ç½ç»ï¼å½åç¨æ·ééæ§å·®ï¼</p>
</li>
<li>
<p>DeepSeek API Key æææï¼éç¡®ä¿ Key æªè¿æï¼ä¸è´¦å·æä½é¢ï¼DeepSeek æä¾åè´¹é¢åº¦ï¼ï¼</p>
</li>
<li>
<p>æ¨¡å ID ä¸å¯ä¿®æ¹ï¼DeepSeek å¿é¡»ä½¿ç¨ <code>deepseek-chat</code>ï¼èªå®ä¹ ID ä¼å¯¼è´è°ç¨å¤±è´¥ã</p>
</li>
</ul>
<h3 id="3-è¿ç¨ä¸ç«¯å£ç®¡ç">3. è¿ç¨ä¸ç«¯å£ç®¡ç</h3>
<ul>
<li>
<p>å¯å¨åå¿æ¸è¿ç¨ï¼é¿åç«¯å£å²çªåéç½®éè½½å¤±è´¥ï¼</p>
</li>
<li>
<p>ç«¯å£å ç¨å¤çï¼è¥ 18789 è¢«å ç¨ï¼å¯æ´æ¢ç«¯å£ï¼å¦ <code>--port 18788</code>ï¼ï¼åæ¶ä¿®æ¹éç½®æä»¶ä¸­ç <code>port</code> å­æ®µã</p>
</li>
</ul>
<h3 id="4-æéä¸ç½ç»">4. æéä¸ç½ç»</h3>
<ul>
<li>ç»ç«¯æéï¼æ§è¡ <code>rm</code>/<code>mkdir</code> å½ä»¤æ¶è¥æ¥éï¼å  <code>sudo</code> æåæéï¼</li>
</ul>
<h1 id="å«æ»ç»">å«ãæ»ç»</h1>
<h2 id="æ ¸å¿æµç¨åé¡¾">æ ¸å¿æµç¨åé¡¾</h2>
<ol>
<li>
<p>æ­å»ºåºç¡ç¯å¢ï¼å®è£ Homebrew â å®è£ Node.js â éç½® npm å¨å±è·¯å¾ï¼</p>
</li>
<li>
<p>é¨ç½² OpenClawï¼å®è£å â åå¥åæ³éç½® â éªè¯è¯­æ³ â å¯å¨ç½å³ï¼</p>
</li>
<li>
<p>éªè¯ææï¼è®¿é® UI æµè¯å¯¹è¯ â å®æ¶çæ§æ¥å¿ææ¥é®é¢ï¼</p>
</li>
<li>
<p>æ¸çæ®ä½ï¼åæ­¢è¿ç¨ â å é¤éç½®/æ¥å¿/åæä»¶ã</p>
</li>
</ol>
<h2 id="å³é®è¦ç¹">å³é®è¦ç¹</h2>
<ul>
<li>
<p>éç½®æä»¶æ¯æ ¸å¿ï¼è¯­æ³éè¯¯ãå­æ®µç¼ºå¤±æ¯é¨ç½²å¤±è´¥çä¸»è¦åå ï¼</p>
</li>
<li>
<p>DeepSeek ééæ§æä¼ï¼å½åç½ç»æ éé¢å¤éç½®ï¼API Key æè·åï¼</p>
</li>
<li>
<p>æ¥å¿æ¯ææ¥å©å¨ï¼å¯å¨åéè¿ <code>tail -f</code> å®æ¶æ¥çæ¥å¿ï¼å¿«éå®ä½é®é¢ã</p>
</li>
</ul>
<p>éè¿ä»¥ä¸æ­¥éª¤ï¼å¯å®ç° OpenClaw å¨ macOS ä¸çæ ååé¨ç½²ï¼ä¸è½ç¨³å®è°ç¨ DeepSeek æ¨¡åå®æå¯¹è¯äº¤äºã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 15:07">2026-02-09 15:06</span>&nbsp;
<a href="https://www.cnblogs.com/xiaobaiysf">å°ç½è·åå</a>&nbsp;
éè¯»(<span id="post_view_count">505</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19595515);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19595515', targetLink: 'https://www.cnblogs.com/xiaobaiysf/p/19595515', title: 'OpenClaw for macOS: å®æ´æ¬å°åé¨ç½²æåï¼2026.2.6-3 çæ¬ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ C++å°ç½è®­ç»ç¬¬åä¸å¤© ]]></title>
    <link>https://www.cnblogs.com/godjian/p/19594585</link>
    <guid>146724f09c15d6b6d2cb69a20f8de96d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/godjian/p/19594585" title="åå¸äº 2026-02-09 12:13">
    <span role="heading" aria-level="2">C++å°ç½è®­ç»ç¬¬åä¸å¤©</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="cå°ç½è®­ç»ç¬¬åä¸å¤©">C++å°ç½è®­ç»ç¬¬åä¸å¤©</h2>
<p>ä»¥ä¸ä¸ºçå®¢ææ</p>
<h2 id="ä»æ¥æ¶è·">ä»æ¥æ¶è·</h2>
<pre><code> vector&lt;pair&lt;int,int&gt;&gt;v;ç¨äºå­å¨åæ ï¼å¦æåæ ï¼
 æ¹å¼ï¼v.push_back({i,j}),v.emplace_back(i,j);
 
 v.push_back(make_pair(i, j));

dpèæ³çåä¸ä¸ªæ¡ä»¶ï¼å°±æ¯å ä¸ºéå¶åªå­å¨ä¸ç¸é»ï¼é£å°±ååé¢æ²¡æå³ç³»ï¼æä»¥èèdp


çè§£äºç½®æ¢ç¯ï¼n-ç¯æ°ç­äºæä½æ°ã
</code></pre>
<h2 id="çå®¢å¨èµ-round-130">çå®¢å¨èµ Round 130</h2>
<h3 id="çº¢ç¾éçè®¿å®¢ç»è®°">çº¢ç¾éçè®¿å®¢ç»è®°</h3>
<p><a href="https://ac.nowcoder.com/acm/contest/127702/A" target="_blank" rel="noopener nofollow">A-çº¢ç¾éçè®¿å®¢ç»è®°_çå®¢å¨èµ Round 130 (nowcoder.com)</a></p>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121302221-750510719.png" alt="image-20260209082136953" loading="lazy"></p>
<h4 id="è§£é¢ä»£ç ">è§£é¢ä»£ç </h4>
<pre><code class="language-c++">#include&lt;bits/stdc++.h&gt;
#define int long long
#define lll __uint128_t
#define PII pair&lt;int ,int&gt;
#define endl '\n'
using namespace std;
#define yn(ans) printf("%s\n", (ans)?"Yes":"No");//å¿«éæå°
#define YN(ans) printf("%s\n", (ans)?"YES":"NO");
#define REP(i, e) for (int i = 0; i &lt; (e); ++i)
#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)
#define TESTS int t; cin &gt;&gt; t; while (t--)
#define TEST
const int N=2e5+10,M=1e3+10,mod=1e9+7;
int a[N],b[N],c[N],pre[N];

signed main(){

	std::ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    string s;
    cin&gt;&gt;s;
    int count=0;
    for(int i=0;i&lt;s.size();i++){
        if(s[i]!='0'){
            count=i;
            break;
        }
    }
    for(int i=count;i&lt;s.size();i++){
        cout&lt;&lt;s[i];
    }
    

	return 0;
}
</code></pre>
<h3 id="ç±ä¸½ä¸çé­åé¶ä»¶åç±»">ç±ä¸½ä¸çé­åé¶ä»¶åç±»</h3>
<p><a href="https://ac.nowcoder.com/acm/contest/127702/B" target="_blank" rel="noopener nofollow">B-ç±ä¸½ä¸çé­åé¶ä»¶åç±»_çå®¢å¨èµ Round 130 (nowcoder.com)</a></p>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121303147-1985436397.png" alt="image-20260209084218695" loading="lazy"></p>
<pre><code>3
5
.....
.....
.***.
..*..
.....
5
.....
..*..
..*..
.**..
.....
6
......
..*...
.**...
..*...
......
......
</code></pre>
<pre><code>T
L
T
</code></pre>
<p><strong>é¢è§£</strong></p>
<h4 id="è§£é¢ä»£ç -1">è§£é¢ä»£ç </h4>
<p>å¯ä»¥åæè¿äºä¸º*çç¹åå­èµ·æ¥ï¼ç¶åå»å¤æ­ä»ä»¬çåº¦æ°åéå¾ªç¯ï¼æ¥å¤æ­ï¼å½æä»¬åç°æå¤åº¦æ°ä¸º3çæ¶åå°±å°±æ¯tï¼å¶ä»çå°±ä¸æ¯tï¼æ¯l</p>
<pre><code class="language-c++">#include&lt;bits/stdc++.h&gt;
#define int long long
#define lll __uint128_t
#define PII pair&lt;int ,int&gt;
#define endl '\n'
using namespace std;
#define yn(ans) printf("%s\n", (ans)?"Yes":"No");//å¿«éæå°
#define YN(ans) printf("%s\n", (ans)?"YES":"NO");
#define REP(i, e) for (int i = 0; i &lt; (e); ++i)
#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)
#define TESTS int t; cin &gt;&gt; t; while (t--)
#define TEST
const int N=2e5+10,M=1e3+10,mod=1e9+7;
int a[N],b[N],c[N],pre[N];
void solve(){
    int n;
    cin&gt;&gt;n;
    vector&lt;pair&lt;int,int&gt;&gt;v;
    for(int i=1;i&lt;=n;i++){
        for(int j=1;j&lt;=n;j++){
            char m;
            cin&gt;&gt;m;
            if(m=='*'){
                v.emplace_back(i,j);
            }
        }
    }
    int mx=0;
    for(auto [x,y]:v){
        int degree=0;
        for(auto [nx,ny]:v){
            if(abs(x-nx)+abs(y-ny)==1){
                degree++;
            }
        }
        mx=max(degree,mx);
    }
    if(mx==3){
        cout&lt;&lt;"T"&lt;&lt;endl;
    }else{
        cout&lt;&lt;"L"&lt;&lt;endl;
    }

};
signed main(){

	std::ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    TESTS{
        solve();
    };

	return 0;
}
</code></pre>
<h3 id="åä¸½å¤§ç»ççç¨³å®è½´å¿">åä¸½å¤§ç»ççç¨³å®è½´å¿</h3>
<p><a href="https://ac.nowcoder.com/acm/contest/127702/C" target="_blank" rel="noopener nofollow">C-åä¸½å¤§ç»ççç¨³å®è½´å¿_çå®¢å¨èµ Round 130 (nowcoder.com)</a></p>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121303545-355177775.png" alt="image-20260209090135699" loading="lazy"></p>
<pre><code>5
1 2
1 3
1 4
4 5
</code></pre>
<pre><code>4
</code></pre>
<p>æä»¬å¯ä»¥å»åæä¸ä¸äºåæ çç¹ç¹ï¼æ¯ä¸æ¯æå¤çèç¹æ°å¨3ä¸ªä»¥ä¸ï¼ä¸è¿ä¸ª3ä¸ªçèç¹ä¸ä¼ä½ä¸ºè½´å¿ç¹ã</p>
<p>ä¸¤ä¸ªçåä¸ä¸ªçé½å¯ä»¥ä½ä¸ºè½´å¿ç¹ã</p>
<p>æææä»¬å¯ä»¥å»åå¤æ­å°åºåªä¸ªæå¤§çç¹æ°æå¤å¤§ãå¤§äº3å°±ç´æ¥æ¯é¶ï¼å°äºç3å°±å¯ä»¥ä½ä¸ºè½´å¿ç¹ã</p>
<h4 id="è§£é¢ä»£ç -2">è§£é¢ä»£ç </h4>
<pre><code class="language-c++">#include&lt;bits/stdc++.h&gt;
#define int long long
#define lll __uint128_t
#define PII pair&lt;int ,int&gt;
#define endl '\n'
using namespace std;
#define yn(ans) printf("%s\n", (ans)?"Yes":"No");//å¿«éæå°
#define YN(ans) printf("%s\n", (ans)?"YES":"NO");
#define REP(i, e) for (int i = 0; i &lt; (e); ++i)
#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)
#define TESTS int t; cin &gt;&gt; t; while (t--)
#define TEST
const int N=2e5+10,M=1e3+10,mod=1e9+7;
int a[N],b[N],c[N],pre[N];

signed main(){

	std::ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    int n;
    cin&gt;&gt;n;
    vector&lt;vector&lt;int&gt;&gt;g(n+1);
    for(int i=1;i&lt;n;i++){
        int u,v;
        cin&gt;&gt;u&gt;&gt;v;
        g[u].push_back(v);
        g[v].push_back(u);
    }
    int mx=0;
    int ans=0;
    for(int i=1;i&lt;=n;i++){
        mx=max(mx,(int)g[i].size());
    }
    if(mx&lt;=3){
        for(int i=1;i&lt;=n;i++){
            if(g[i].size()&lt;=2){
                ans++;
            }
        }
    }
    cout&lt;&lt;ans&lt;&lt;endl;

	return 0;
}
</code></pre>
<h3 id="é­æ³äººå¶çåè¿å¶æ ¡å">é­æ³äººå¶çåè¿å¶æ ¡å</h3>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121303963-2021372242.png" alt="image-20260209094949846" loading="lazy"></p>
<pre><code>3
1 5
2 3
5 7
</code></pre>
<pre><code>1 2
1 3
3 7
</code></pre>
<p>é¦åæä»¬éè¿ææ ç¡®å®ä¸ä¸è§å¾ã</p>
<pre><code class="language-c++">for(double y=2;y&lt;=1000;y++){
	cout&lt;&lt;fixed&lt;&lt;setprecision(10)&lt;&lt;(1.0/y)&lt;&lt;endl;
}
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121304411-1460739702.png" alt="image-20260209095354057" loading="lazy"></p>
<p>å¯ä»¥åç°ç¹æ®ç</p>
<pre><code>1/9----ãå¾å°è¿ä¸ªã0.1111111ï¼è¿ä¸ªæä»¬å°±å¯ä»¥å»æé ä¸ä¸äºï¼ä½æ¯ï¼b/9

ç¶åç¹å¤å«çï¼åºä¸ºæ²¡æ9/9ï¼æä»¥æä»¬çå°0.9090...
æä»¬å¯ä»¥éè¿å¥å¶ä»£æ¢Ãä¸ä¸ª10å°±å¯ä»¥äºï¼æä»¬ç´æ¥9å¾å°è¿ä¸ªæ°.
ç¶åç¹å¤ä¸äº0ï¼åå¯ä»¥è¢«3ï¼6çæåµå°±è¡äº
</code></pre>
<h4 id="è§£é¢ä»£ç -3">è§£é¢ä»£ç </h4>
<pre><code class="language-c++">#include&lt;bits/stdc++.h&gt;
#define int long long
#define lll __uint128_t
#define PII pair&lt;int ,int&gt;
#define endl '\n'
using namespace std;
#define yn(ans) printf("%s\n", (ans)?"Yes":"No");//å¿«éæå°
#define YN(ans) printf("%s\n", (ans)?"YES":"NO");
#define REP(i, e) for (int i = 0; i &lt; (e); ++i)
#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)
#define TESTS int t; cin &gt;&gt; t; while (t--)
#define TEST
const int N=2e5+10,M=1e3+10,mod=1e9+7;

void solve(){
    int a,b;
    cin&gt;&gt;a&gt;&gt;b;
    if(b==0){
        if(a==1){
            cout&lt;&lt;1&lt;&lt;" "&lt;&lt;1000&lt;&lt;endl;
        }else{
            cout&lt;&lt;1&lt;&lt;" "&lt;&lt;2&lt;&lt;endl;
        }
        return;
    }else if(b==9){
        if(a%2){
            cout&lt;&lt;10&lt;&lt;" "&lt;&lt;11&lt;&lt;endl;
        }else{
            cout&lt;&lt;1&lt;&lt;" "&lt;&lt;11&lt;&lt;endl;
        }
        return;
    }
    if(b==3){
        cout&lt;&lt;1&lt;&lt;" "&lt;&lt;3&lt;&lt;endl;
        return;
    }
    if(b==6){
        cout&lt;&lt;2&lt;&lt;" "&lt;&lt;3&lt;&lt;endl;
        return;
    }
    cout&lt;&lt;b&lt;&lt;" "&lt;&lt;9&lt;&lt;endl;
};
signed main(){

	std::ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    TESTS{
        solve();
    };

	return 0;
}
</code></pre>
<h3 id="ç±ä¸½ä¸çäººå¶åèæ²">ç±ä¸½ä¸çäººå¶åèæ²</h3>
<p><a href="https://ac.nowcoder.com/acm/contest/127702/E" target="_blank" rel="noopener nofollow">E-ç±ä¸½ä¸çäººå¶åèæ²_çå®¢å¨èµ Round 130 (nowcoder.com)</a></p>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121304824-570108632.png" alt="image-20260209112816198" loading="lazy"></p>
<pre><code>abca
</code></pre>
<pre><code>1
</code></pre>
<p>å ä¸ºéå¶åªå­å¨ä¸ç¸é»ãæä»¬å°±å¯ä»¥å»èèdpçåæ³</p>
<p>è¿ä¸ªæ¯ä¸ä¸ªçº¿æ§dpçé¢ç®ï¼æä»¬å¯ä»¥å®ä¹ä¸ä¸ª</p>
<p>å ä¸ºdæ²¡æç¡®è®¤ï¼æä»¥æä»¬å»æä¸¾d</p>
<pre><code>f[i][j]---&gt;è¡¨ç¤ºåiä¸ªä½ç½®ååæ³ï¼ä¸si=jçæå°æ¬¡æ°

ä½ ä»¬è½¬ç§»å°±æ¯
minï¼f[i-1][(j-d+26)%26],f[(i+d)%26]ï¼+è¿ä¸ªæ°å°åºæ¯ä¸æ¯ç­äºjï¼ä¸ç­äºå°±è¦ç¨ä¸æ¬¡ï¼æååç®åºæå°å¼ã
</code></pre>
<h4 id="è§£é¢ä»£ç -4">è§£é¢ä»£ç </h4>
<pre><code class="language-c++">#include&lt;bits/stdc++.h&gt;
#define int long long
#define lll __uint128_t
#define PII pair&lt;int ,int&gt;
#define endl '\n'
using namespace std;
#define yn(ans) printf("%s\n", (ans)?"Yes":"No");//å¿«éæå°
#define YN(ans) printf("%s\n", (ans)?"YES":"NO");
#define REP(i, e) for (int i = 0; i &lt; (e); ++i)
#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)
#define TESTS int t; cin &gt;&gt; t; while (t--)
#define TEST
const int N=2e5+10,M=1e3+10,mod=1e9+7;
int a[N],b[N],c[N],pre[N];

signed main(){

	std::ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    string s;
    cin&gt;&gt;s;

    int n=s.size();
    s=" "+s;

    //dpåå§åã
    int mx=2e8;
    for(int d=0;d&lt;=25;d++){
        vector&lt;vector&lt;int&gt;&gt;f(n+1,vector&lt;int&gt;(26,2e8));
        for(int j=0;j&lt;=25;j++){
            if(j==s[1]-'a'){
                f[1][j]=0;
            }else{
                f[1][j]=1;
            }
        }
        for(int i=2;i&lt;=n;i++){
            for(int j=0;j&lt;=25;j++){
                f[i][j]=min(f[i-1][(j-d+26)%26],f[i-1][(j+d)%26])+(j!=s[i]-'a');
            }
        }

        for(int i=0;i&lt;=25;i++){
            mx=min(mx,f[n][i]);
        }

    }
    cout&lt;&lt;mx&lt;&lt;endl;




	return 0;
}
</code></pre>
<h3 id="çº¢é­é¦çå¾®çåºä½">çº¢é­é¦çå¾®çåºä½</h3>
<p><a href="https://ac.nowcoder.com/acm/contest/127702/F" target="_blank" rel="noopener nofollow">F-çº¢é­é¦çå¾®çåºä½_çå®¢å¨èµ Round 130 (nowcoder.com)</a></p>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121305276-651327063.png" alt="image-20260209120106423" loading="lazy"></p>
<pre><code>2
5
1 2 4 3 5
2
1 2
</code></pre>
<pre><code>0
1
</code></pre>
<p>æ¬é¢èçä¸ä¸ªç»å¸ç½®æ¢ç¯</p>
<pre><code>å¦æä¸ä¸ª1-nçæåï¼è¦äº¤æ¢å æ¬¡æè½ä½¿å¾å®æ¯ä¸ä¸ªæåã
ç»è®ºæ¯
n-ç¯çä¸ªæ°ï¼ç¸å½äºæç¯ã
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3621557/202602/3621557-20260209121305664-904288544.png" alt="image-20260209120521887" loading="lazy"></p>
<p>å¦å¾æ¯4åç¯</p>
<p>æä»¬éå¾å°2ï¼è¯å®å¾ä¸ä¸ªä¸¤ä¸ªç¸é»çåç´ ä¹é´æ²¡æå»äº¤æ¢</p>
<pre><code>1 2 4 3 5
</code></pre>
<p>é£æä»¬åæäº¤æ¢çæ¬¡æ°ç®åºæ¥ï¼åèèåæ¥å°åºå­ä¸å­å¨ç¸é»çç¯ã</p>
<h4 id="è§£é¢ä»£ç -5">è§£é¢ä»£ç </h4>
<pre><code class="language-c++">#include&lt;bits/stdc++.h&gt;
#define int long long
#define lll __uint128_t
#define PII pair&lt;int ,int&gt;
#define endl '\n'
using namespace std;
#define yn(ans) printf("%s\n", (ans)?"Yes":"No");//å¿«éæå°
#define YN(ans) printf("%s\n", (ans)?"YES":"NO");
#define REP(i, e) for (int i = 0; i &lt; (e); ++i)
#define REP1(i, s, e) for (int i = (s); i &lt;=(e); ++i)
#define TESTS int t; cin &gt;&gt; t; while (t--)
#define TEST
const int N=2e5+10,M=1e3+10,mod=1e9+7;
int a[N],b[N],c[N],pre[N];
void solve(){
    int n;
    cin&gt;&gt;n;
    vector&lt;int&gt;v(n+1);
    for(int i=1;i&lt;=n;i++){
        cin&gt;&gt;a[i];
    }
    int loop=0;
    for(int i=1;i&lt;=n;i++){
        if(v[i])continue;
        int j=i;
        loop++;
        while (!v[j]){
            v[j]=loop;
            j=a[j];
        }
    }
    int ans=n-loop+1;
    for(int i=2;i&lt;=n;i++){//å¤æ­æ¯ä¸æ¯ç¸é»çç¯
        if(v[i-1]==v[i]){
            ans-=2;
            break;
        }
    }
    cout&lt;&lt;ans&lt;&lt;endl;
};
signed main(){

	std::ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    TESTS{
        solve();
    };

	return 0;
}
</code></pre>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 12:14">2026-02-09 12:13</span>&nbsp;
<a href="https://www.cnblogs.com/godjian">Godjian</a>&nbsp;
éè¯»(<span id="post_view_count">110</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19594585);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19594585', targetLink: 'https://www.cnblogs.com/godjian/p/19594585', title: 'C++å°ç½è®­ç»ç¬¬åä¸å¤©' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ£å­Cozeå®æï¼ä»0å°1æ­å»ºå°çº¢ä¹¦å¾ææ¹åæºè½ä½ ]]></title>
    <link>https://www.cnblogs.com/tangshiye/p/19594522</link>
    <guid>3b3a5c30d278f35e4b18e511dd8f2a9e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/tangshiye/p/19594522" title="åå¸äº 2026-02-09 11:59">
    <span role="heading" aria-level="2">æ£å­Cozeå®æï¼ä»0å°1æ­å»ºå°çº¢ä¹¦å¾ææ¹åæºè½ä½</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¤§å®¶å¥½ï¼ææ¯æ±¤å¸ç·ï¼ä¸æ³¨AIæºè½ä½åäº«ï¼è´åäºå¸®å©100Wäººç¨æºè½ä½åå¯~</p>
<p>è¿å¨ä¸ºå°çº¢ä¹¦ç¬è®°åä½åæåï¼</p>
<p>æ¯å¤©é½è¦ç»å°½èæ±æ³ææ¡ï¼ççå«äººççæ¬¾ç¬è®°å´ä¸ç¥éå¦ä½æ¨¡ä»¿ï¼</p>
<p>ä»å¤©ï¼æå°±æä½ å¦ä½å©ç¨AIæºè½ä½ï¼è½»æ¾å®ç°å°çº¢ä¹¦å¾ææ¹åï¼è®©åä½æçæå10åï¼</p>
<p>æä»¬åçä¸æºè½ä½çæ§è¡ææï¼</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849425-348751088.jpg" class="lazyload"></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849389-79233689.jpg" class="lazyload"></p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849436-87560495.jpg" class="lazyload"></p>
<h2 id="1æ´ä½å·¥ä½æµ">1.æ´ä½å·¥ä½æµ</h2>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849359-444735043.jpg" class="lazyload"></p>
<p>1.è·åå°çº¢ä¹¦ç¬è®°è¯¦æ</p>
<p>2.ä½¿ç¨OCRææ¯ï¼æåå¾çä¸­çæå­</p>
<p>3.å°å¾çææ¡è¿è¡æ´ç</p>
<p>4.å¾çææ¡ä»¿å</p>
<h2 id="2è¯¦ç»å·¥ä½æµèç¹">2.è¯¦ç»å·¥ä½æµèç¹</h2>
<h3 id="21-å¼å§èç¹">2.1 å¼å§èç¹</h3>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849454-1421324949.jpg" class="lazyload"></p>
<p>å¼å§èç¹æä¸¤ä¸ªè¾å¥åéã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>noteUrlï¼å°çº¢ä¹¦ç¬è®°é¾æ¥</li>
<li>cookieStrï¼å°çº¢ä¹¦cookie</li>
</ul>
</li>
</ul>
<h3 id="22-å¦ä½è·åå°çº¢ä¹¦cookie">2.2 å¦ä½è·åå°çº¢ä¹¦cookieï¼</h3>
<p>1.ç»é<a href="https://www.xiaohongshu.com/" target="_blank" rel="noopener nofollow">https://www.xiaohongshu.com/</a></p>
<p>2.å¨é¡µé¢ç©ºç½å¤å³å»é¼ æ ï¼éæ©ãæ£æ¥ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849458-1366667585.jpg" class="lazyload"></p>
<p>3.å¨ååæå¼çé¢æ¿ä¸­ï¼ç¹å»ãç½ç»ãéé¡¹å¡</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849445-295607363.jpg" class="lazyload"></p>
<p>4.å·æ°å½åé¡µé¢</p>
<p>5.ç¹å»ç¬¬ä¸æ¡è®°å½ï¼å¨å³ä¾§ãæ å¤´ãé¨ååä¸æ»å¨ï¼æ¾å°cookieä¸è¡ï¼å°å¶åå®¹å¤å¶ä¸ï¼è¿å°±æ¯æä»¬éè¦çcookieStr</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849421-829853038.jpg" class="lazyload"></p>
<h3 id="23-è·åå°çº¢ä¹¦ç¬è®°è¯¦æ">2.3 è·åå°çº¢ä¹¦ç¬è®°è¯¦æ</h3>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849435-90047701.jpg" class="lazyload"></p>
<p>æä»¬å°ä½¿ç¨ãå°çº¢ä¹¦ãæä»¶çxhs_note_detailåè½ã</p>
<p>éè¿è¿ä¸ªåè½ï¼æä»¬å¯ä»¥æ ¹æ®ç¬è®°é¾æ¥è·åç¬è®°è¯¦æã</p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>cookieStrï¼å¼å§ - cookieStr</li>
<li>noteUrlï¼å¼å§ - noteUrl</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849369-1430779758.jpg" class="lazyload"></p>
<h3 id="24-ä½¿ç¨ocrææ¯æåå¾çä¸­çæå­">2.4 ä½¿ç¨OCRææ¯ï¼æåå¾çä¸­çæå­</h3>
<p><strong>1.æ¥ä¸æ¥ï¼æä»¬ä½¿ç¨å¾ªç¯èç¹ï¼æ¹éæåå¾çä¸­çæå­ã</strong></p>
<ul>
<li>è¾å¥ï¼
<ul>
<li>inputï¼è·åå°çº¢ä¹¦ç¬è®°è¯¦æ-note_image_list</li>
</ul>
</li>
<li>è¾åº
<ul>
<li>outputï¼ä»å¾çä¸­æåæå­-data</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849354-1469357748.jpg" class="lazyload"></p>
<p><strong>2.ä½¿ç¨å¾ªç¯ä½ï¼æ¹éæåå¾ççæå­</strong></p>
<p>æä»¬ä¼ä½¿ç¨ãOCRãæä»¶ï¼æåå¾ççæå­ã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849192-2085345149.jpg" class="lazyload"></p>
<p>è¾å¥åæ°å¦ä¸å¾æç¤ºã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849459-913346874.jpg" class="lazyload"></p>
<h3 id="25-ä½¿ç¨å¤§æ¨¡åå°ææ¡åå®¹è¿è¡æ´çæç">2.5 ä½¿ç¨å¤§æ¨¡åå°ææ¡åå®¹è¿è¡æ´çãæç</h3>
<p>å¨è¿ä¸æ­¥ï¼æä»¬ä¼ä½¿ç¨å¤§æ¨¡åèç¹ï¼å¯¹ææ¡åå®¹è¿è¡æ´çãæçã</p>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849386-2050592021.jpg" class="lazyload"></p>
<p>å¤§æ¨¡åèç¹çç³»ç»æç¤ºè¯å¦ä¸ï¼</p>
<pre><code class="language-markdown">## è§è²ï¼Roleï¼
ä½ æ¯ä¸ä½ç²¾éåå®¹æ´çå Markdown æçç AI å©æãä½ æé¿éè¯»åçè§£éç»æåçææ¬åå®¹ï¼å¹¶è½å¤å°å¶è½¬åä¸ºç»ææ¸æ°ãæ ¼å¼ä¼ç¾ç Markdown ææ¡£ã

## èæ¯ï¼Backgroundï¼
éçç¤¾äº¤åªä½å¹³å°çæ®åï¼å¤§éçå¾æåå®¹è¢«åä½ååäº«ãç¶èï¼è¿äºåå®¹å¾å¾ç¼ºä¹è¯å¥½çç»æåæ ¼å¼ï¼ä¸å©äºéè¯»åçè§£ãå°è¿äºåå®¹æ´çæç»æåç Markdown ææ¡£ï¼å¯ä»¥å¤§å¤§æé«åå®¹çå¯è¯»æ§åä»·å¼ã

## ä»»å¡ï¼Taskï¼
ä½ çä»»å¡æ¯æ¥æ¶ä¸æ®µä»æä»¶è¾åºçéç»æåææ¬åå®¹ï¼ä¸»è¦æ¯æé³å¾æä¸­çæå­ï¼ï¼ä»ç»éè¯»å¹¶çè§£åå®¹ï¼ç¶åå°å¶è½¬åä¸ºç»ææ¸æ°ãæ ¼å¼è§èç Markdown ææ¡£ãä½ éè¦ï¼

1. è¯å«å¹¶æåææ¬ä¸­çå³é®ä¿¡æ¯ï¼å¦æ é¢ãä½èãä¸»è¦åå®¹ç­
2. æ ¹æ®åå®¹çé»è¾å³ç³»ï¼å¯¹ææ¬è¿è¡åç±»åæ´ç
3. ä½¿ç¨ Markdown è¯­æ³è¿è¡æçï¼åæ¬ä½ä¸éäºä½¿ç¨æ é¢ãç²ä½ãæä½ãåè¡¨ç­æ ¼å¼
4. ç¡®ä¿ææåå§åå®¹é½è¢«åå«å¨æç»ç Markdown ææ¡£ä¸­ï¼ä¸éæ¼ä»»ä½ä¿¡æ¯

## è§åä¸éå¶ï¼Rules &amp; Restrictionsï¼
1. å¿é¡»ä½¿ç¨ Markdown è¯­æ³è¿è¡æç
2. ä½¿ç¨ #ã##ã### ç­è¿è¡æ é¢ååï¼å±çº§ä¸è¶è¿ 3 çº§
3. ä½¿ç¨ - æ * è¿è¡æ åºåè¡¨ç¼åï¼ä½¿ç¨ 1. 2. 3. ç­è¿è¡æåºåè¡¨ç¼å
4. éè¦åå®¹ä½¿ç¨ç²ä½ï¼**æå­**ï¼æ æ³¨ï¼éè¦å¼ºè°çåå®¹ä½¿ç¨æä½ï¼*æå­*ï¼æ æ³¨
5. ä¿æåæçä¸»è¦ç»æåé¡ºåºï¼ä½å¯ä»¥éå½è°æ´ä»¥æé«å¯è¯»æ§
6. ä¸å¾æ·»å ãå é¤æä¿®æ¹åæçå®è´¨åå®¹
7. å¦éå°ä¸ç¡®å®çåå®¹ï¼ä¿çåæ ·å¹¶ç¨æ¬å·æ æ³¨

## åèç­è¯­ï¼Reference sentencesï¼
- åå®¹å®æ´ï¼ä¸éæ¼ä»»ä½ä¿¡æ¯
- ç»ææ¸æ°ï¼å±æ¬¡åæ
- æ ¼å¼è§èï¼ç¾è§å®ç¨
- é»è¾ä¸¥å¯ï¼æ¡çæ¸æ°
- éç¹çªåºï¼æäºéè¯»

## æ¡ä¾å±ç¤ºï¼Case Showï¼
### è¾å¥ï¼
{
  "code": 0,
  "data": {
    "results": [
      {
        "words": [
          {
            "lang": "auto",
            "text": "æ±å¤§è¿è¿ä¸¤ä¸ª"
          },
          {
            "lang": "auto",
            "text": "å°æ¹æå¥"
          },
          {
            "lang": "auto",
            "text": "åºå«åï¼ï¼"
          }
        ]
      }
    ]
  },
  "log_id": "20250325123913080C6F506498C6F581B7",
  "msg": "success"
}

## é£æ ¼åè¯­æ°ï¼Style &amp; Toneï¼
- ä¿æä¸ä¸ãæ¸æ°çè¯­æ°
- ä½¿ç¨ç®æ´ãç´æ¥çè¡¨è¾¾æ¹å¼
- ä¿æåæçéç¹åå¼ºè°

## åä¼ç¾¤ä½ï¼Audienceï¼
- å°çº¢ä¹¦çµåæ°æåå®¶
- å¯¹å¼è®¾å°çº¢ä¹¦åºéºæå´è¶£çäººç¾¤
- æ³è¦äºè§£å°çº¢ä¹¦çµåè¿è¥çäººç¾¤

## è¾åºæ ¼å¼ï¼Output formatï¼
ä½¿ç¨ Markdown æ ¼å¼è¾åºï¼åæ¬ï¼
1. ä¸çº§æ é¢ï¼#ï¼ç¨äºæç« ä¸»æ é¢
2. äºçº§æ é¢ï¼##ï¼ç¨äºä¸»è¦ç« è
3. ä¸çº§æ é¢ï¼###ï¼ç¨äºå­ç« è
4. æ åºåè¡¨ä½¿ç¨ - æ *
5. æåºåè¡¨ä½¿ç¨ 1. 2. 3. ç­
6. éè¦åå®¹ä½¿ç¨ç²ä½ï¼**æå­**ï¼
7. éè¦å¼ºè°çåå®¹ä½¿ç¨æä½ï¼*æå­*ï¼

## å·¥ä½æµç¨ï¼Workflowï¼
1. ä»ç»éè¯»è¾å¥çææ¬åå®¹ï¼çè§£å¶ç»æåä¸»è¦ä¿¡æ¯ç¹
2. æåæ é¢ãä½èãæ ç­¾ç­åä¿¡æ¯
3. è¯å«ä¸»è¦ç« èåå­ç« èï¼è§åææ¡£ç»æ
4. æç§è§åçç»æï¼ä½¿ç¨ Markdown è¯­æ³éæ°æçåå®¹
5. ä½¿ç¨ç²ä½åæä½çªåºéè¦ä¿¡æ¯åéè¦å¼ºè°çåå®¹
6. æ£æ¥ç¡®ä¿ææåå§åå®¹é½è¢«åå«ï¼æ²¡æéæ¼
7. æåæ£æ¥ Markdown æ ¼å¼æ¯å¦æ­£ç¡®ï¼è°æ´ä»¥ç¡®ä¿æä½³å¯è¯»æ§

## åå§åï¼Initializationï¼

ä¸é¢æ¯ä½ éè¦æ´çåæ ¼å¼åçææ¬åå®¹ï¼

&lt;è¯ä»·åå®¹&gt;

è¯·æä¾éè¦æ´çåæ ¼å¼åçææ¬åå®¹ãæä¼ä»ç»éè¯»å¹¶æç§ä¸è¿°è¦æ±å°å¶è½¬åä¸ºç»ææ¸æ°ç Markdown ææ¡£ãä¸éè¦è¾åºé¢å¤é¤å¾çè¯å«æå­ä»¥å¤çåå®¹ã
</code></pre>
<h3 id="26-å¾çææ¡ä»¿å">2.6 å¾çææ¡ä»¿å</h3>
<p>æ¥ä¸æ¥ï¼æä»¬éè¦éè¿å¤§æ¨¡åèç¹éå¾çææ¡è¿è¡ä»¿åã</p>
<p><img alt="image.png" loading="lazy" data-src="%E6%89%A3%E5%AD%90Coze%E6%99%BA%E8%83%BD%E4%BD%93%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BB%8E0%E5%88%B01%E6%90%AD%E5%BB%BA%E5%B0%8F%E7%BA%A2%E4%B9%A6%E5%9B%BE%E6%96%87%E6%94%B9%E5%86%99%E6%99%BA%E8%83%BD%E4%BD%93/image%2014.png" class="lazyload"></p>
<p>å¤§æ¨¡åèç¹çç³»ç»æç¤ºè¯å¦ä¸ï¼</p>
<pre><code class="language-markdown"># è§è²è¯´æ
ä½ æ¯ä¸ä½ä¸ä¸çå¾æåå®¹ä»¿åå©æï¼è´è´£æ ¹æ®å¾çä¸­æåçæå­åå®¹ï¼ç»åè§è§åç´ åèæ¯ä¿¡æ¯ï¼åä½é£æ ¼ä¸è´çä»¿ååå®¹ã

# èæ¯è¯´æ
å¤çç¨æ·æä¾çå¾çæå­åå®¹æ¶ï¼ä½ éè¦ï¼
1. çè§£å¾ççæ´ä½é£æ ¼åèæ¯ï¼äº§åä»ç»ãæç¨æ­¥éª¤ãä½¿ç¨å¿å¾ç­ï¼
2. åææå­çè¯­è¨ç¹ç¹ï¼æ­£å¼/å£è¯­åãå¥å¼ç¹å¾ãä¸ä¸æ¯è¯­ç­ï¼
3. ç»åå¾çåç°çè§è§ä¿¡æ¯ï¼äº§åå¤è§ãä½¿ç¨åºæ¯ç­ï¼
4. å¨ä¿æåæçåºç¡ä¸è¿è¡èªç¶çä»¿åæ©å±

# ä»¿ååå
1. ä¿æåæå®æ´æ§
2. å¹éåæè¯­è¨é£æ ¼
3. è¡¥åæ°å½çç»è
4. ä¸å¾çåå®¹ä¿æä¸è´
5. é¿åæ·»å èåä¿¡æ¯

# å·¥ä½æµç¨
1. æ¥æ¶å¾çæå­åå®¹
2. åæå¾çèæ¯ä¿¡æ¯ï¼å¯éï¼
3. åæåæç¹ç¹ï¼
   - è¯­è¨é£æ ¼
   - åå®¹ç»æ
   - å³é®è¯ä½¿ç¨
4. åä½ä¸ä¸ªçæ¬ï¼
   - è´´è¿åæçä¿å®ç
   - éåº¦ä¼åçæ¹è¿ç
   - åæå å¼ºçäº®ç¹ç

# è¾åºç¤ºä¾
## åæï¼
"å¤æ¥å¿å¤é²æé
SPF50+ PA++++
æ¸ç½ä¸æ²¹è»"

## ä»¿åçæ¬ï¼
1. ãä¿å®çã
"å¤å­£å¿å¤é²æäº§å
é²æææ°SPF50+ PA++++
è´¨å°æ¸ç½ä¸æ²¹è»"

2. ãä¼åçã
"å¤æ¥é²ææ¨è
é«åé²æ¤SPF50+ PA++++
è½»èæ°´æè´¨å°ï¼èè¤é¶è´æ"

3. ãåæçã
"ä»å¤é²æå¤©è±æ¿ï¼
SPF50+ PA++++è¶å¼ºé²æ¤
ä¸æ¹åæ°´ï¼æ¸ç½ä¸é»è»"

# æ§è¡è¦æ±
è¯·æä¾ï¼
1. å¾çæå­æååå®¹
2. å¾çèæ¯è¯´æï¼å¦æï¼

æå°æç§ä»¥ä¸è§èè¿è¡ä»¿ååä½ã
</code></pre>
<h3 id="27-ä½¿ç¨ææ¬å¤çæä»¶æ¼æ¥å­ç¬¦ä¸²">2.7 ä½¿ç¨ææ¬å¤çæä»¶æ¼æ¥å­ç¬¦ä¸²</h3>
<ul>
<li>è¾å¥ï¼
<ul>
<li>String1ï¼è·åå°çº¢ä¹¦ç¬è®°è¯¦æ-note</li>
<li>String2ï¼å¾çææ¡åå®¹æ´ç-output</li>
<li>String3ï¼å¾çææ¡ä»¿å-output</li>
</ul>
</li>
</ul>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849406-1197371456.jpg" class="lazyload"></p>
<h3 id="28-ç»æèç¹">2.8 ç»æèç¹</h3>
<p><img alt="image.png" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2625446/202602/2625446-20260209115849192-257301299.jpg" class="lazyload"></p>
<h2 id="3æ»ç»">3.æ»ç»</h2>
<p>éè¿ä»¥ä¸ä»ç»ï¼ç¸ä¿¡ä½ äºè§£äºå¦ä½å©ç¨DeepSeek+Cozeæ¥æå»ºé«æçå°çº¢ä¹¦å¾çææ¡æ¹åæºè½ä½ã</p>
<p>å¨AIæ¶ä»£ï¼ææ¯é¨æ§å°è¶æ¥è¶ä½ï¼å°ç½ä¹è½æ­å»ºæºè½ä½ï¼ç¨AIå·¥å·æ¥æåå·¥ä½æçã</p>
<p>ç¨AIæºè½ä½ä¸æ¯æªæ¥ï¼èæ¯AIæ¶ä»£æ¯ä¸ªäººççå­æè½ï¼å­¦ä¼AIæºè½ä½ï¼äººäººé½æ¯è¶çº§ä¸ªä½ã</p>
<p>å¦æä½ è§å¾è¿ç¯æç« æå¸®å©ï¼å«å¿äºç¹èµãå³æ³¨ãæ¶èï¼æä»¬ä¸æåè§ï¼</p>
<blockquote>
<p>å¯¹äºï¼ææ´çäºä¸ä»½å¼æºãæºè½ä½å­¦ä¹ æåãï¼çè 10 ä¸å­ï¼ä»·å¼ 999 åãéæ¶å¼æ¾é¢åðï¼<a href="https://tangshiye.cn" target="_blank" rel="noopener nofollow">tangshiye.cn</a></p>
</blockquote>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/tangshiye/" target="_blank">AIæ¶æå¸æ±¤å¸ç·</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/tangshiye/p/19594522" target="_blank">https://www.cnblogs.com/tangshiye/p/19594522</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 11:59">2026-02-09 11:59</span>&nbsp;
<a href="https://www.cnblogs.com/tangshiye">AIæ¶æå¸æ±¤å¸ç·</a>&nbsp;
éè¯»(<span id="post_view_count">179</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19594522);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19594522', targetLink: 'https://www.cnblogs.com/tangshiye/p/19594522', title: 'æ£å­Cozeå®æï¼ä»0å°1æ­å»ºå°çº¢ä¹¦å¾ææ¹åæºè½ä½' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ FastAPIä¸æ­¢äºAPIï¼ææææä½ ç¨Jinja2æé å¨æWebé¡µé¢ ]]></title>
    <link>https://www.cnblogs.com/ymtianyu/p/19594466</link>
    <guid>51f4cb54d9b23eb5577a58fd5b6cb570</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ymtianyu/p/19594466" title="åå¸äº 2026-02-09 11:48">
    <span role="heading" aria-level="2">FastAPIä¸æ­¢äºAPIï¼ææææä½ ç¨Jinja2æé å¨æWebé¡µé¢</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æç³»ç»ä»ç»äºå¦ä½å¨FastAPIæ¡æ¶ä¸­éæJinja2æ¨¡æ¿å¼ææ¥æå»ºå¨æWebé¡µé¢ãåå®¹æ¶µçä»å®è£éç½®ãæ¨¡æ¿ä¸ä¸ææ°æ®ä¼ éï¼åæ¬è¯·æ±çº§åå¨å±ä¸¤ç§æ¹å¼ï¼ãéææä»¶æ­£ç¡®å¼å¥ï¼å°å®æ´å®ææ¼ç¤ºä¸å¸¸è§é¿åæåãå¸®å©å¼åèå¿«éææ¡å©ç¨FastAPIæå¡ç«¯æ¸²æé¡µé¢çæè½ï¼éç¨äºå¿«éååãç®¡çåå°ç­åºæ¯ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Helvetica Neue&quot;, sans-serif; line-height: 1.6; color: rgba(51, 51, 51, 1)">
<p>ä½ æ¯ä¸æ¯ä¹è§å¾ï¼ç¨FastAPIåæ¥å£ç½å°é£èµ·ï¼ä½ä¸æ³å°è¦è¿åä¸ªå¸¦æ°æ®çHTMLé¡µé¢ï¼å°±ç¬é´å¤´å¤§ï¼ð¯</p>
<p>æåç¨FastAPIé£ä¼å¿ä¹è¿æ ·ï¼ä»¥ä¸ºå®å°±æ¯ä¸ªâAPIä¸ç¨æ¡æ¶âï¼æ¸²æé¡µé¢ï¼é£ä¸æ¯DjangoåFlaskçæ´»å¿åï¼ç´å°æå¨ä¸ä¸ªç´§æ¥é¡¹ç®éï¼éè¦å¿«éç»åé¨ç³»ç»åä¸ªå¸¦æ°æ®çæ¿çç®¡çåå°ï¼ææåç°ï¼<strong style="color: rgba(186, 55, 42, 1)">FastAPIéåJinja2æ¨¡æ¿ï¼åæ¥å¯ä»¥è¿ä¹é¦ï¼</strong> ä»å¤©å°±è·ä½ å æç½è¿äºå¿ï¼ä¿ä½ 10åéä¸æï¼åå«âååç«¯åç¦»å¼ºè¿«çâå¨ç®ååºæ¯ä¸ççº ç»ã</p>
<h2 style="color: rgba(52, 152, 219, 1); border-bottom: 2px solid rgba(52, 152, 219, 1); padding-bottom: 5px">ð æ¬æè½å¸®ä½ è§£å³</h2>
<div style="background-color: rgba(248, 249, 250, 1); padding: 15px; border-left: 4px solid rgba(52, 152, 219, 1); margin: 20px 0">
<p>1. å¨FastAPIä¸­å¦ä½å®è£ãéç½®Jinja2æ¨¡æ¿å¼æã</p>
<p>2. å¦ä½æåå°æ°æ®ï¼ä¸ä¸æï¼å®å¨åæ¹ä¾¿å°âå¡âç»åç«¯æ¨¡æ¿ã</p>
<p>3. å¦ä½å¨æ¨¡æ¿éæ­£ç¡®å¼å¥CSSãJSç­éææä»¶ï¼é¿åâ404æ¨æ¡âã</p>
<p>4. æè¸©è¿çå ä¸ªååæä½³å®è·µï¼è®©ä½ ä¸æ¬¡åå¯¹ã</p>
</div>
<h2>ð ä¸»è¦åå®¹èç»</h2>
<p>ð åèèï¼ä¸ºä»ä¹éè¦æ¨¡æ¿å¼æï¼ï¼ä¸åªæ¯ä¸ºäºçäºï¼</p>
<p>ð æ ¸å¿æä½ï¼å®è£ãéç½®ãä¼ éæ°æ®çâä¸¤æ¡è·¯å¾âã</p>
<p>ð å®ææ¼ç¤ºï¼ä¸ä¸ªåå«ç¨æ·åè¡¨åæ ·å¼çå°é¡¹ç®ã</p>
<p>ð é¿åæåï¼éææä»¶é£äºâè·¯å¾çå­¦âä¸è¿é¶æèã</p>
<hr style="border: none; height: 1px; background-color: rgba(238, 238, 238, 1); margin: 30px 0">
<h2>ð ä¸ãé®é¢ä¸èæ¯ï¼FastAPIåªè½âåâJSONï¼</h2>
<p>FastAPIä»¥æå»ºé«æ§è½APIé»åï¼<code style="color: rgba(186, 55, 42, 1)">return JSONResponse</code> å ä¹æ¯èèè®°å¿ãä½å¾å¤åºæ¯ä¸ï¼æ¯å¦ï¼</p>
<div>
<p>- å¿«éååå¼åï¼æä¸ªå¸¦é¡µé¢çdemoã</p>
<p>- åé¨ç®¡çåå°ï¼å¤æåº¦ä¸é«ï¼ä¸æ³å¨ç¨åç«¯æ¡æ¶ã</p>
<p>- éè¦æå¡ç«¯æ¸²æï¼SSRï¼çç®åé¡µé¢ã</p>
</div>
<p>è¿æ¶åï¼ä½ ç¡¬è¦ååç«¯å½»åºåç¦»ï¼åèæç§âæé¸¡ç¨çåâçç¹çãå°±å¥½æ¯ä½ åªæ³å¨å®¶é¨å£åç¢é¢ï¼ç»æéè¦å¼è½¦å»å¸ä¸­å¿çé«çº§é¤åç¹åãç­é¤ãæåååæ¥ã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">æ¨¡æ¿å¼æï¼å°±æ¯è®©ä½ å¨FastAPIè¿ä¸ªâé«æ§è½å¨æ¿âéï¼ç´æ¥å¼ä¸ªâå é£çªå£âã</strong> Jinja2å°±æ¯è¿ä¸ªçªå£æå¾åçä¼è®¡ï¼å®è½æä½ çæ°æ®ï¼èãèï¼åHTMLæ¨¡æ¿ï¼ç¢ãæ±¤åºï¼å¿«éç»åæä¸ç¢ç­è¾è¾çé¢ï¼æç»é¡µé¢ï¼ã</p>
<h2>ð§  äºãæ ¸å¿åçä¸æ­¥éª¤ï¼âä¸¤æ¡è¿âèµ°è·¯</h2>
<p>å¥½ï¼å±ä»¬åæ¥è§£å³ææ ¸å¿çé®é¢ï¼æ°æ®æä¹ä»åç«¯âèµ°âå°æ¨¡æ¿éï¼</p>
<p>æ ¸å¿å°±ä¸¤æ­¥ï¼1. éç½®å¼æï¼2. ä¼ éæ°æ®ãæ°æ®ä¼ éæä¸¤æ¡å³é®âè·¯å¾âï¼æç»ä¸ªçµé­å¾ç¤ºç»ä½ çï¼</p>
<div style="background-color: rgba(248, 249, 250, 1); padding: 15px; border-radius: 5px; margin: 20px 0">
<p><strong>è·¯å¾Aï¼ä¾èµé¡¹æ³¨å¥ï¼å¨å±/è¯·æ±çº§ä¸ä¸æï¼</strong></p>
<p>å¨è·¯ç±å¤çå½æ°éï¼éè¿ <code style="color: rgba(186, 55, 42, 1)">TemplateResponse</code> ç <code style="color: rgba(186, 55, 42, 1)">context</code> åæ°ä¼ éãè¿æ¯<strong style="color: rgba(186, 55, 42, 1)">æå¸¸ç¨ãæçµæ´»</strong>çæ¹å¼ï¼æ°æ®éå¯¹æ¯æ¬¡è¯·æ±ã</p>
<p><strong>è·¯å¾Bï¼å¨å±æ¨¡æ¿ä¸ä¸æï¼æ¯ä¸ªæ¨¡æ¿é½è½ç¨ï¼</strong></p>
<p>å¨åå§å <code style="color: rgba(186, 55, 42, 1)">Jinja2Templates</code> æ¶ï¼éè¿ <code style="color: rgba(186, 55, 42, 1)">context</code> åæ°ä¼ éãæ¯å¦ç«ç¹åãå½åå¹´ä»½ç­<strong style="color: rgba(186, 55, 42, 1)">å¨å±éç¨æ°æ®</strong>ã</p>
</div>
<p>æ¯ä¸æ¯æç¹æ½è±¡ï¼å«æ¥ï¼å±ä»¬æ¥ççå®æï¼ä»£ç ä¸åä½ å°±å¨æç½äºã</p>
<h2>ð» ä¸ãå®ææ¼ç¤ºï¼ä»é¶æ­å»ºä¸ä¸ªç¨æ·åè¡¨é¡µ</h2>
<p>æ¥ä¸æ¥éç¹æ¥äºï¼å±ä»¬ä¸æ­¥æ­¥æ¥ãåè®¾æä»¬è¦åä¸ä¸ªæ¾ç¤ºç¨æ·åè¡¨çé¡µé¢ã</p>
<h3>1ï¸â£ å®è£ä¸é¡¹ç®ç»æ</h3>
<p>åå®è£å¿å¤åºï¼</p>
<pre class="language-powershell highlighter-hljs"><code>pip install fastapi jinja2 uvicorn</code></pre>
<p>é¡¹ç®ç®å½ç»æå»ºè®®è¿æ ·å®æï¼æ¸æ°æäºï¼</p>
<div>
<pre class="language-powershell highlighter-hljs"><code>ð your_project/
âââ ð templates/ # å­æ¾ææJinja2 HTMLæ¨¡æ¿
â     âââ index.html
âââ ð static/ # å­æ¾CSS, JS, å¾çç­éææä»¶
â     âââ style.css
âââ main.py # FastAPI ä¸»åºç¨æä»¶</code></pre>
</div>
<h3>2ï¸â£ éç½®FastAPIä¸Jinja2</h3>
<p>å¨ <code style="color: rgba(186, 55, 42, 1)">main.py</code> éè¿è¡åå§åãè¿éæä¸ª<strong style="color: rgba(186, 55, 42, 1)">å³é®ç¹</strong>ï¼<code style="color: rgba(186, 55, 42, 1)">directory</code> åæ°å¿é¡»æ¯<strong style="color: rgba(186, 55, 42, 1)">å­ç¬¦ä¸²è·¯å¾</strong>ï¼ä¸è½æ¯Pathå¯¹è±¡ï¼Jinja2çèè§ç©ï¼ã</p>
<pre class="language-python highlighter-hljs"><code>from fastapi import FastAPI, Request
from fastapi.responses import HTMLResponse
from fastapi.templating import Jinja2Templates
from fastapi.staticfiles import StaticFiles

app = FastAPI(title="FastAPI+Jinja2 Demo")

# éç½®æ¨¡æ¿å¼æï¼åè¯å®æ¨¡æ¿æä»¶å¨åª
templates = Jinja2Templates(directory="templates")

# éç½®éææä»¶æå¡ï¼æè½½å°`/static`è·¯å¾
app.mount("/static", StaticFiles(directory="static"), name="static")</code></pre>
<h3>3ï¸â£ å®ä¹è·¯ç±ä¸ä¼ éæ°æ®ï¼è·¯å¾Aï¼</h3>
<p>æä»¬å®ä¹ä¸ä¸ªè·¯ç±ï¼æ¨¡æä»æ°æ®åºè·åç¨æ·åè¡¨ï¼å¹¶ä¼ éç»æ¨¡æ¿ï¼</p>
<pre class="language-python highlighter-hljs"><code>@app.get("/", response_class=HTMLResponse)
async def read_users(request: Request):
    # æ¨¡ææ°æ®ï¼å®éä¸­å¯è½æ¥èªæ°æ®åº
    user_list = [
        {"id": 1, "name": "å¼ ä¸", "role": "ç®¡çå"},
        {"id": 2, "name": "æå", "role": "ç¼è¾"},
        {"id": 3, "name": "çäº", "role": "è®¢éç¨æ·"},
    ]
    # ç½ç«æ é¢ï¼ä½ä¸ºé¢å¤æ°æ®ä¼ é
    site_title = "åé¨ç¨æ·ç®¡çç³»ç»"
    
    # æ ¸å¿æä½ï¼æ¸²ææ¨¡æ¿ï¼å¹¶éè¿contextä¼ éæ°æ®
    return templates.TemplateResponse(
        request=request,
        name="index.html", # æ¨¡æ¿æä»¶å
        context={
            "request": request, # è¿ä¸ªå¿é¡»æï¼Jinja2Templatesè¦æ±
            "users": user_list,
            "title": site_title
        }
    )</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">åä¸æ³¨æ</strong>ï¼<code style="color: rgba(186, 55, 42, 1)">context</code> å­å¸é<strong style="color: rgba(186, 55, 42, 1)">å¿é¡»åå« "request" é®</strong>ï¼è¿æ¯ <code style="color: rgba(186, 55, 42, 1)">Jinja2Templates</code> çå·¥ä½æºå¶è¦æ±çï¼ä¸ç¶æ¨¡æ¿éä¸äºåºäºè¯·æ±çåè½ä¼å¤±æã</p>
<h3>4ï¸â£ ç¼åæ¨¡æ¿æä»¶ (templates/index.html)</h3>
<p>ççæ°æ®å¨æ¨¡æ¿éæä¹ç¨ï¼</p>
<pre class="language-html highlighter-hljs"><code>&lt;!DOCTYPE html&gt;
&lt;html lang="zh-CN"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;{{ title }}&lt;/title&gt;
    &lt;!-- éç¹ï¼å¼å¥éæCSSæä»¶ --&gt;
    &lt;link rel="stylesheet" href="{{ url_for('static', path='/style.css') }}"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;æ¬¢è¿ä½¿ç¨ {{ title }}&lt;/h1&gt;
    &lt;table border="1"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;ID&lt;/th&gt;
                &lt;th&gt;å§å&lt;/th&gt;
                &lt;th&gt;è§è²&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            {% for user in users %}
            &lt;tr&gt;
                &lt;td&gt;{{ user.id }}&lt;/td&gt;
                &lt;td&gt;{{ user.name }}&lt;/td&gt;
                &lt;td&gt;{{ user.role }}&lt;/td&gt;
            &lt;/tr&gt;
            {% endfor %}
        &lt;/tbody&gt;
    &lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">æ²é»æ¿</strong>ï¼å¼å¥éææä»¶ç¨çæ¯ <code style="color: rgba(186, 55, 42, 1)">url_for('static', path='/style.css')</code>ãè¿éç <code style="color: rgba(186, 55, 42, 1)">'static'</code> å¯¹åºæä»¬ <code style="color: rgba(186, 55, 42, 1)">app.mount</code> æ¶è®¾ç½®ç <code style="color: rgba(186, 55, 42, 1)">name="static"</code>ãè¿æ¯æåæå¸¸ééçå°æ¹ï¼<strong style="color: rgba(186, 55, 42, 1)">nameå¿é¡»ä¸è´</strong>ï¼</p>
<h3>5ï¸â£ ç¼åéææä»¶ (static/style.css)</h3>
<p>éä¾¿åç¹æ ·å¼ï¼ç¡®è®¤å®è½è¢«å è½½ï¼</p>
<pre class="language-css highlighter-hljs"><code>body {
    font-family: sans-serif;
    padding: 20px;
    background-color: #f5f5f5;
}
h1 {
    color: #2c3e50;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}
th, td {
    padding: 10px;
    text-align: left;
}
thead {
    background-color: #3498db;
    color: white;
}</code></pre>
<p>å¥½äºï¼ç°å¨è¿è¡ <code style="color: rgba(186, 55, 42, 1)">uvicorn main:app --reload</code>ï¼æå¼ <code style="color: rgba(186, 55, 42, 1)">http://127.0.0.1:8000</code>ï¼ä¸ä¸ªå¸¦æ ·å¼åå¨ææ°æ®çç¨æ·åè¡¨é¡µé¢å°±åºæ¥äºï¼æ°æ®ä»åç«¯âæµâå°äºåç«¯ï¼éææä»¶ä¹æ­£å¸¸å è½½ã</p>
<h2>â ï¸ åãæ³¨æäºé¡¹ä¸è¿é¶æè</h2>
<p>æ¯ä¸æ¯ä»¥ä¸ºè¿æ ·å°±å®äºï¼åè¯´å ä¸ªå®¹æç¿»è½¦çç¹ã</p>
<h3>ð¯ é¿åæå</h3>
<div>
<p><strong>1. éææä»¶404ï¼</strong></p>
<p>- æ£æ¥ <code style="color: rgba(186, 55, 42, 1)">app.mount</code> ç <code style="color: rgba(186, 55, 42, 1)">directory</code> è·¯å¾æ¯å¦æ­£ç¡®ï¼ç¸å¯¹è·¯å¾ä»é¡¹ç®æ ¹ç®å½ç®èµ·ï¼ã</p>
<p>- æ£æ¥æ¨¡æ¿ä¸­ <code style="color: rgba(186, 55, 42, 1)">url_for</code> ç <code style="color: rgba(186, 55, 42, 1)">name</code> åæ°æ¯å¦ä¸ <code style="color: rgba(186, 55, 42, 1)">mount</code> ç <code style="color: rgba(186, 55, 42, 1)">name</code> ä¸è´ã</p>
<p>- çäº§ç¯å¢éå¸¸ç¨Nginxç­ä¸é¨å¤çéææä»¶ï¼å¼åæ¶ç¨ <code style="color: rgba(186, 55, 42, 1)">StaticFiles</code> å¾æ¹ä¾¿ã</p>
<p><strong>2. å¨å±ä¸ä¸æï¼è·¯å¾Bï¼æä¹ç¨ï¼</strong></p>
<p>æ¯å¦ä½ æ³å¨æ¯ä¸ªé¡µé¢é½æ¾ç¤ºçæå¹´ä»½ï¼</p>
</div>
<pre class="language-python highlighter-hljs"><code>templates = Jinja2Templates(
    directory="templates",
    context={"current_year": 2024} # å¨å±æ³¨å¥
)
# ç¶åï¼å¨ä»»ä½æ¨¡æ¿éé½å¯ä»¥ç´æ¥ä½¿ç¨ {{ current_year }}</code></pre>
<h3>ð è¿é¶æè</h3>
<p><strong>æ¨¡æ¿ç»§æ¿æ¯ççï¼</strong> ç¨ <code style="color: rgba(186, 55, 42, 1)">{% extends "base.html" %}</code> å <code style="color: rgba(186, 55, 42, 1)">{% block content %}...{% endblock %}</code> æ¥å¤ç¨å¸å±ï¼å¦å¯¼èªæ ãé¡µèï¼ï¼è½è®©ä½ çæ¨¡æ¿ä»£ç å¹²åååãå¼ºçå»ºè®®ä½ ç¨èµ·æ¥ã</p>
<p><strong>ä¸ä¸æå¤çå¨ï¼</strong> å¦æä½ æ³å¨æ¯ä¸ªè¯·æ±çæ¨¡æ¿éé½èªå¨æ³¨å¥ä¸äºæ°æ®ï¼æ¯å¦å½åç»å½ç¨æ·ï¼ï¼å¯ä»¥èªå®ä¹ä¾èµé¡¹ï¼å¹¶å¨æ¯ä¸ªè·¯ç±ç <code style="color: rgba(186, 55, 42, 1)">TemplateResponse</code> éè°ç¨ãè½ç¶æç¹ç»ï¼ä½ç»ææ´æ¸æ°ã</p>
<p><strong>ä½æ¶ç¨ï¼ä½æ¶ä¸ç¨ï¼</strong> å¯¹äºå¤æçãäº¤äºæ§å¼ºçç°ä»£Webåºç¨ï¼ååç«¯åç¦»ï¼React/Vue + FastAPI APIï¼ä»æ¯é¦éãä½å¯¹äºå·¥å·ç±»ãç®¡çç±»ãéè¦SEOçç®ååå®¹é¡µï¼<strong style="color: rgba(186, 55, 42, 1)">FastAPI + Jinja2 çç»åè½è®©ä½ ä¸äººé¡¶ä¸ä¸ªå¨æ å¢éï¼å¼åéåº¦é£å¿«</strong>ã</p>
<hr style="border: none; height: 1px; background: linear-gradient(90deg, rgba(0, 0, 0, 0), rgba(52, 152, 219, 1), rgba(0, 0, 0, 0)); margin: 40px 0">
<p>å¥½äºï¼ä»å¤©çåäº«å°±å°è¿å¿ãå¸æè¿ç¯âè¸©åç»éªæ»ç»âè½å¸®ä½ æFastAPIçâå¦ä¸é¢âä¹å©ç¨èµ·æ¥ã</p>
<p>ææ¯éåæ²¡æé¶å¼¹ï¼<strong style="color: rgba(186, 55, 42, 1)">æå¥½çå·¥å·æ¯é£ä¸ªè½å¸®ä½ é«æãç¨³å®è§£å³é®é¢çå·¥å·</strong>ãä¸æ¬¡å½ä½ éè¦å¿«éæ£é¼ä¸ªå¸¦çé¢çå°å·¥å·æ¶ï¼ä¸å¦¨è¯è¯è¿ä¸ªç»åã</p>
<p>ä½ å¨ç¨FastAPIåWebé¡µé¢æ¶è¿éå°è¿ä»ä¹å¥è©é®é¢ï¼æèææ´ä¼éçå®è·µï¼<strong style="color: rgba(186, 55, 42, 1)">æ¬¢è¿å¨è¯è®ºåºä¸èµ·èè</strong>ï¼ä½ çç»éªå¾å¯è½ä¹è½å¸®å°å«äººã</p>
<p style="text-align: center; color: rgba(127, 140, 141, 1); font-size: 0.9em">è§å¾æç¨çè¯ï¼è®°å¾æ¶èãç¹èµãå³æ³¨å¦~ å±ä»¬ä¸æè§ï¼</p>
</div>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 11:49">2026-02-09 11:48</span>&nbsp;
<a href="https://www.cnblogs.com/ymtianyu">ä¸åç¨åºåªå</a>&nbsp;
éè¯»(<span id="post_view_count">147</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19594466);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19594466', targetLink: 'https://www.cnblogs.com/ymtianyu/p/19594466', title: 'FastAPIä¸æ­¢äºAPIï¼ææææä½ ç¨Jinja2æé å¨æWebé¡µé¢' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä»æ¨¡åè¯ä¼°ãæ¢¯åº¦é¾é¢å°ç§å­¦åå§åï¼ä¸æ­¥æ­¥è§£ææ·±åº¦å­¦ä¹ çè®­ç»é®é¢ ]]></title>
    <link>https://www.cnblogs.com/yldeveloper/p/19597056</link>
    <guid>18b529031b00aa9bb50e0e386b40ab79</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yldeveloper/p/19597056" title="åå¸äº 2026-02-09 21:47">
    <span role="heading" aria-level="2">ä»æ¨¡åè¯ä¼°ãæ¢¯åº¦é¾é¢å°ç§å­¦åå§åï¼ä¸æ­¥æ­¥è§£ææ·±åº¦å­¦ä¹ çè®­ç»é®é¢</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        è¦è§£å³æ¨¡åæ³åè½åä¸è®­ç»ç¨³å®æ§ä¸¤å¤§é¾é¢ï¼å³é®å¨äºçè§£åå·®-æ¹å·®æè¡¡ãæ¢¯åº¦ä¼ æ­ååæ°åå§åä¸èé´çæ·±å±èç³»ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å¼è¨">å¼è¨</h2>
<p>è®­ç»ä¸ä¸ªç¥ç»ç½ç»è¿ç¨ä¸­ï¼æä»¬ä¼å³æ³¨ä¸¤ä¸ªé®é¢ï¼</p>
<ol>
<li>æ¨¡åè½å¦æ¯«ä¸è´¹åå¤çåºç¨ç¯å¢ä¸­æ²¡è§è¿çæ°æ®ï¼</li>
<li>æ¨¡åè½å¦è¢«ææè®­ç»ï¼</li>
</ol>
<p>ç¬¬ä¸ä¸ªé®é¢æ¶å<strong>åå·®ä¸æ¹å·®çæè¡¡</strong>ï¼ç¬¬äºä¸ªé®é¢æ¶å<strong>æ¢¯åº¦ä¼ æ­çç¨³å®æ§</strong>ãæ¬æé¦åæ¢è®¨åå·®ä¸æ¹å·®ï¼ç¶ååææ¢¯åº¦é®é¢ï¼æåå¼åºè§£å³æ¢¯åº¦é®é¢çå³é®ä¹ä¸ââ<strong>ç§å­¦çåå§åæ¹æ³</strong>ã</p>
<h2 id="åå·®--æ¹å·®">åå·® &amp; æ¹å·®</h2>
<p>è¦çè§£æ¨¡åçæ³åè½åï¼æä»¬é¦åè¦éåå®çâæ³åè¯¯å·®âï¼å³æ¨¡åå¨æªç¥æ°æ®ä¸çè¡¨ç°ãç¶èï¼æ³åè¯¯å·®å¹¶éä¸ä¸ªåä¸çé®é¢ï¼å®æºäºä¸ç§ä¸åæ§è´¨çéè¯¯ï¼æ¨¡ååºæçè¿ä¼¼è½åä¸è¶³ãå¯¹è®­ç»æ°æ®çè¿åº¦ææãæ¨¡åæ°æ®æ¬èº«çä¸å¯çº¦åªå£°ã</p>
<h4 id="åå·®---æ¹å·®åè§£å¬å¼">åå·® - æ¹å·®åè§£å¬å¼</h4>
<p>è§å®ï¼</p>
<ul>
<li><span class="math inline">\(P_{\text{data}}(x,y)\)</span>ï¼æ°æ®çæåå¸</li>
<li><span class="math inline">\(\mathcal{D}\)</span>ï¼ä»<span class="math inline">\(P_{\text{data}}\)</span>ä¸­ç¬ç«ååå¸éæ ·å¾å°çè®­ç»æ°æ®é</li>
<li><span class="math inline">\(f(x;\mathcal{D})\)</span>ï¼ç±è®­ç»é <span class="math inline">\(\mathcal{D}\)</span> å­¦å¾çæ¨¡å <span class="math inline">\(f\)</span> å¯¹ <span class="math inline">\(x\)</span> çé¢æµè¾åºã</li>
<li><span class="math inline">\(\overline f(x)\)</span>ï¼<span class="math inline">\(\mathbb{E}_{\mathcal{D} \sim P_{\text{data}}^{\otimes n}}[f(x; \mathcal{D})]\)</span>ï¼å¯¹ææå¯è½è®­ç»éçææ</li>
<li><span class="math inline">\(\mathbb{E}_{\mathcal{D} \sim P_{\text{data}}^{\otimes n}}[\cdot]\)</span>ï¼å¯¹è®­ç»ééæ ·çææ</li>
</ul>
<p>æï¼</p>
<p></p><div class="math display">\[\mathbb{E}_{y|x} \mathbb{E}_{\mathcal{D}}[(f(x; \mathcal{D}) - y)^2] = \text{Bias}^2(f(x)) + \text{Var}(f(x)) + \sigma_\epsilon^2
\]</div><p></p><p>å¶ä¸­ï¼</p>
<ul>
<li><span class="math inline">\(\text{Bias}^2(f(x))\)</span>ï¼åå·®ï¼åæ æ¨¡åæåè½åãè®¾çå®å½æ°ä¸º <span class="math inline">\(h(x) = \mathbb{E}[y|x]\)</span>ï¼æ¡ä»¶ææï¼ï¼ååå·®åºå®ä¹ä¸º <span class="math inline">\((\overline f(x) - h(x))^2\)</span></li>
<li><span class="math inline">\(\text{Var}(f(x))\)</span>ï¼æ¹å·®ï¼åæ ä¸åæ°æ®éè¡¨ç°æ³¢å¨æåµå³æ³åè½åï¼<span class="math inline">\(:=\mathbb{E}_\mathcal{D}[(f(x;\mathcal{D})-\overline f(x))^2]\)</span></li>
<li><span class="math inline">\(\sigma_\epsilon ^2\)</span>ï¼åªå£°ï¼åæ å­¦ä¹ é¾åº¦ï¼<span class="math inline">\(:=\mathbb{E}[(y - h(x))^2]\)</span></li>
</ul>
<p>è¿éæ­£å¥½å¯¹åºä¸¤ç§æ¨¡åï¼çº¿æ§æå vs. ç¥ç»ç½ç»</p>
<ul>
<li>è¥çº¿æ§æåï¼æ¨¡åå®¹éä½ï¼å¹¶ä¸åè®¾ç©ºé´ç®åï¼å³å¤§åå·®å°æ¹å·®ï¼æ³åè¯¯å·®å¤§ï¼æ¬ æåã</li>
<li>è¥å¤æåº¦è¿é«çç¥ç»ç½ç»ï¼å¦æªæ­£ååï¼ï¼ä¼å­¦å°è®­ç»æ°æ®ä¸­çåªå£°ï¼å¯¼è´å¨è®­ç»æ°æ®ä¸è¡¨ç°å¾å¥½ï¼å°åå·®ï¼ï¼ä½å¨æªè§è¿çæ°æ®ä¸è¡¨ç°æ³¢å¨å¾å¤§ï¼å¤§æ¹å·®ï¼ï¼æ³åè¯¯å·®å¤§ï¼è¿æåã</li>
<li>è¥å¤æåº¦éä¸­çç¥ç»ç½ç»ï¼ä¸­ç­åå·®ä¸­ç­æ¹å·®ï¼æ³åè¯¯å·®å°ï¼æä½³äºã</li>
</ul>
<p>å¾åºç»è®ºï¼<em>åå·®å¤§ï¼æ¬ æåï¼æå³çæ¨¡åè½åä¸è¶³ï¼æªè½æææ°æ®ä¸­ççå®æ¨¡å¼ï¼æ¹å·®å¤§ï¼è¿æåï¼æå³çæ¨¡åè¿äºå¤æï¼å¯¹è®­ç»æ°æ®ä¸­çåªå£°åéæºæ³¢å¨è¿åº¦ææã</em></p>
<h4 id="å½±ååå·®ä¸æ¹å·®çä¸å¤§å ç´ ">å½±ååå·®ä¸æ¹å·®çä¸å¤§å ç´ </h4>
<p><strong>1. å­¦ä¹ ç®æ³è½åï¼æ¨¡åå¤æåº¦ï¼</strong></p>
<p>å¦ææ¨¡åæ¬ æåï¼åå·®å¤§ï¼ï¼å°±æ¢æ´å¤æçæ¨¡åï¼å¦æè¿æåï¼æ¹å·®å¤§ï¼ï¼å°±æ¢æ´ç®åçæ¨¡åï¼æå¯¹å¤ææ¨¡ååæ­£ååï¼ã</p>
<p><strong>2. è®­ç»æ°æ®é</strong></p>
<p>å¯é´æ¥éä½åå·®ï¼å¯¹æ¹å·®å½±åå¤§<br>
å¦ææ¨¡åè¿æåï¼æ¹å·®å¤§ï¼ï¼ä¼åå¢å è®­ç»æ°æ®ã</p>
<p><strong>3. å­¦ä¹ ä»»å¡æ¬èº«çé¾åº¦ï¼ä»»å¡å¤æåº¦ï¼</strong></p>
<p>å¦æä»»å¡ç®åä½æ¹å·®å¤§ï¼å°±æ§å¶æ¨¡åå¤æåº¦æå¢å æ°æ®ï¼å¦æä»»å¡å¤æå¯¼è´åå·®å¤§ï¼å°±æåæ¨¡åå¤æåº¦</p>
<h4 id="å¤çæ¨¡åé«åå·®é«æ¹å·®çä¸äºæ¹æ³">å¤çæ¨¡åé«åå·®ãé«æ¹å·®çä¸äºæ¹æ³</h4>
<p><strong>æ¬ æåï¼é«åå·®ï¼</strong>ï¼åºè¯¥æ¢æ´å¤æçæ¨¡åãå¢å ç¹å¾ç»´æ°ãä»ç»å¤æ­è®­ç»è¯¯å·®æ¯å¦æ¶æå°æä½ã</p>
<p><strong>è¿æåï¼é«æ¹å·®ï¼</strong>ï¼åºè¯¥å¢å è®­ç»æ°æ®ãæ­£ååï¼å¦ä½¿ç¨L1æ­£ååãL2æ­£ååï¼å³æéè¡°åï¼ãDropoutç­ï¼ãæ¹éå½ä¸åãåªæéå¤æåº¦ãéä½ç¹å¾ç»´åº¦ã</p>
<h4 id="åå·®-æ¹å·®æè¡¡">åå·®-æ¹å·®æè¡¡</h4>
<p>åå·®ä¸æ¹å·®éå¸¸æ¯å¯¹ç«çï¼æé«æ¨¡åå¤æåº¦å¯ä»¥åå°åå·®ï¼ä½å¯è½å¢å æ¹å·®ï¼åä¹ï¼éä½æ¨¡åå¤æåº¦å¯ä»¥åå°æ¹å·®ï¼ä½åå·®å¯è½ä¼åé«ãè¿ç§æè¡¡å³ç³»è¢«ç§°ä¸º <strong>åå·®-æ¹å·®æè¡¡ï¼Bias-Variance Tradeoffï¼</strong></p>
<p><strong>å¨æ­¤æä»¬åºè¯¥æå±ä¸ä¸</strong>ï¼ç»å¸çè®ºè®¤ä¸ºæ¨¡åå¤æåº¦ï¼å¦åæ°æ°éï¼å¢å ï¼æ³åè¯¯å·®ä¼åå åå·®éä½èä¸éï¼åå æ¹å·®å¢å¤§èä¸åï¼å½¢æåä¸çUåæ²çº¿ã<strong>åéä¸é</strong>åæ­ç¤ºäºå¨æå¼éå¼ï¼æ¨¡ååå¥½è½å®ç¾æåè®­ç»æ°æ®ï¼åï¼éçå¤æåº¦è¿ä¸æ­¥å¢å ï¼è¯¯å·®ä¼åæ¬¡ä¸éï¼å½¢æâä¸é-ä¸å-ä¸éâçæ³¢æµªå½¢æ²çº¿ãå¨è¿åæ°ååºåï¼æ¨¡åå¹¶éå¿ç¶è¿æåå°æ´å·®çç¨åº¦ï¼ä¼åè¿ç¨ä¼å¼å¯¼å¶æ¾å°ä¸ä¸ªæ³åè¯å¥½çè§£ãå¨è¿åæ°åä½å¶ä¸ï¼æ¨¡åå¥½åæ¯åâè®°å¿âï¼æååªå£°ï¼ï¼åéè¿æ¼«é¿çä¼åè¿ç¨âéæ¸è·å¾âæ³åè§åãï¼å¶å®çæ­£çåå æ¯<strong>éå¼æ­£åå</strong>ä½¿å¾ä¼åç®æ³ï¼å¦SGDï¼å¾åäºæ¾å°æå°èæ°è§£æå¹³å¦æå°å¼ï¼</p>
<p>è¿åè¯æä»¬ï¼å¦æè§å¯å°å¢å æ¨¡ååæ°åæ§è½ååå·®ï¼ä¸è¦ç«å³æ­¢æ­¥ãè¿å¯è½åªæ¯å¤äºæå¼éå¼éè¿çå±é©åºãç»§ç»­å¢å è§æ¨¡ï¼å¹¶éåè¶³å¤çè®­ç»ï¼æ§è½å¯è½ä¼çªç ´å¹¶åå¾æ´å¥½ã</p>
<p>çè§£äºæ¨¡åçè¯¯å·®é®é¢ç±åå·®ãæ¹å·®é´çæè¡¡å³å®ï¼æä»¬å¤§ä½äºè§£å¦ä½éæ©æ¨¡åçå¤æåº¦ãä½æ¯ï¼å½æä»¬çæè®­ç»ä¸ä¸ªå¤ææ·±å±æ¨¡åï¼å°¤å¶æ¯ç°ä»£ç½ç»å±æ°ä¸æ­å æ·±æ¶ï¼æä»¬åºè¯¥èèï¼è®­ç»æ¬èº«æ¯å¦è½å¤æ­£å¸¸è¿è¡ï¼å¦åç»æä¸çâåå·®ãæ¹å·®âé½æç©ºè°ãè¿å°±å¼åºäºæ·±åº¦å­¦ä¹ ä¸­ç <strong>æ¢¯åº¦é®é¢</strong> ã</p>
<h2 id="æ¢¯åº¦é®é¢">æ¢¯åº¦é®é¢</h2>
<p>æä»¬å¯ä»¥è®¤ä¸ºï¼</p>
<p><span class="math inline">\(\mathbf{h}^{(l)} = f_l (\mathbf{h}^{(l-1)})\)</span></p>
<p>å æ­¤</p>
<p><span class="math inline">\(\mathbf{o} = f_L \circ f_{L-1}\circ \ldots\circ f_2\circ f_1(\mathbf{x})\)</span></p>
<p>é£ä¹ä¸é¾å¾å°ï¼</p>
<p></p><div class="math display">\[\partial_{\mathbf{W}^{(l)}} \mathbf{o} = \underbrace{\partial_{\mathbf{h}^{(L-1)}} \mathbf{h}^{(L)}}_{ \mathbf{M}^{(L)} \stackrel{\mathrm{def}}{=}} \cdot \ldots \cdot \underbrace{\partial_{\mathbf{h}^{(l)}} \mathbf{h}^{(l+1)}}_{ \mathbf{M}^{(l+1)} \stackrel{\mathrm{def}}{=}} \underbrace{\partial_{\mathbf{W}^{(l)}} \mathbf{h}^{(l)}}_{ \mathbf{v}^{(l)} \stackrel{\mathrm{def}}{=}}.
\]</div><p></p><p>ä¹å æ­¤ï¼æ¢¯åº¦ <span class="math inline">\(\partial_{\mathbf{W}^{(l)}} \mathbf{o}\)</span> æ¯ <span class="math inline">\((L-l)\)</span> ä¸ªéå¯æ¯ç©éµ <span class="math inline">\(\mathbf{M}^{(L)}, \dots, \mathbf{M}^{(l+1)}\)</span> ä¸ä¸ä¸ªäºç»´å¼ é <span class="math inline">\(\mathbf{v}^{(l)}\)</span> çä¹ç§¯ãå¨æ·±å±ç½ç»ä¸­ï¼è¿ç»­ç©éµä¹æ³å¯è½å¯¼è´ç»ææ°å¼è¿å¤§ï¼<strong>çç¸</strong>ï¼æè¿å°ï¼<strong>æ¶å¤±</strong>ï¼ã</p>
<p><strong>æ¢¯åº¦æ¶å¤±</strong>ï¼</p>
<p>å¦æä½¿ç¨Sigmoidå½æ°ï¼å°±è¦èè Sigmoid å½æ°å¨å¶é¥±ååºæ¢¯åº¦é¼è¿äºé¶çæåµãå æ­¤å½è¾å¥å¾å¤§æå¾å°æ¶ï¼æ¢¯åº¦æ¶å¤±ãä¸ºæ­¤æä»¬æå¥½ç¨ReLUå½æ°æ¿ä»£ä¹ã</p>
<p>å¦ææ¯ä¸æ¬¡ç æ¢¯åº¦é½åå°ä¸ç¹ï¼é£ä¹å¤å±ä¼ æ­åæ¢¯åº¦å¼ä¼éå¸¸å°ã</p>
<p>å¦ææéçåå§å¼å¤ªå°ï¼ååä¼ æ­è¿ç¨ä¸­æ¯å±çº¿æ§åæ¢çè¾åºæ¹å·®å¤§å¹è¡°åï¼è¿èä½¿æ¿æ´»å½æ°çè¾å¥è½å¥è¯¥å½æ°çå±é©åºï¼å¦ Sigmoid çé¥±ååºãReLUçæ©æåºï¼ã</p>
<p><strong>æ¢¯åº¦çç¸</strong>ï¼</p>
<p>ç¹æååä¼ æ­è¿ç¨ä¸­ï¼æ¢¯åº¦å¼éçå±çº§å¢å èä¸æ­åå¤§ï¼ä¹è³ææ°åå¢å ã</p>
<p>å¾å¯è½å ä¸º <span class="math inline">\(weight\)</span> çåå§å¼å¤ªå¤§ï¼å±æ°è¿å¤ç­ç­</p>
<p><strong>åæ°åçå¯¹ç§°æ§</strong>ï¼<br>
è¥åä¸å±åççæææéååå§åä¸ºç¸åå¼ï¼é£ä¹è¯¥å±ææçç¥ç»åå¨ååä¼ æ­ä¸­é½ä¼è·å¾å®å¨ä¸æ ·çæ¢¯åº¦ï¼æ°¸è¿å­¦ä¹ ç¸åçç¹å¾ï¼æå¤§éä½æ¨¡åå®¹éã</p>
<p>é£ä¹ï¼å¦ä½ä¸ºæä»¬æ¨¡åçè®­ç»æä¾ä¸ä¸ªè¯å¥½ãç¨³å¥çèµ·ç¹å¢ï¼è¿å°±æ¯ç¥ç»ç½ç» <strong>åæ°åå§å</strong> çshowtimeäºãè¯å¥½çåå§åæ¹å¼ï¼è½å¤ååä¼ æ­ä¸­ä¿æä¼ éå¼ºåº¦ï¼å¨ååä¼ æ­ä¸­ä¿è¯æ¢¯åº¦æµå¨ï¼ä»èæç ´ä¸æç <em>åæ°åçå¯¹ç§°æ§</em> ç­ç­é®é¢ã</p>
<h3 id="ä¸ç§å¸¸è§çåå§å">ä¸ç§å¸¸è§çåå§å</h3>
<h4 id="xavieråå§å">Xavieråå§å</h4>
<p>ç®æ ï¼ä¿æåå±æ¿æ´»å¼æ¹å·®ç¨³å®ï¼ç¡®ä¿ååä¼ æ­çä¿¡å·å¼ºåº¦åååä¼ æ­çæ¢¯åº¦å¼ºåº¦å¨åå§åæ¶ä¸è¡°åä¹ä¸çç¸ã</p>
<p>Xavier åå§åå ä¸ºæåºçæ¶é´è¾æ©ï¼å®ä¸»è¦éå¯¹å <span class="math inline">\(tanh\)</span> è¿æ ·å¨åç¹éè¿è¿ä¼¼çº¿æ§ä¸å¯¹ç§°çé¥±åæ¿æ´»å½æ°ãå æ­¤å¯¹äºåæ¥å¹¿æ³ä½¿ç¨ç ReLU åå¶åç§ï¼å®çææå¹¶éæä¼ã</p>
<p>è¿éç3ä¸ªå½æ°é½æé¥±ååºï¼ä¹å°±æ¯æ¢¯åº¦æ¶å¤±çé£æ®µåºåï¼å¤ªå¤§æå¤ªå°æ¶å½æ°å¯¼æ°è¶äº <span class="math inline">\(0\)</span> ã</p>
<p>è¿ä¸ªçè®ºçåºæ¬ååå°±æ¯ï¼<strong>å¨ååä¼ æ­ä¸­ï¼ä¿æåå±æ¿æ´»å¼çæ¹å·®ä¸è´ï¼å¨ååä¼ æ­ä¸­ï¼ä¿æåå±æ¢¯åº¦çæ¹å·®ä¸è´</strong>ã ä¹å°±æ¯è¯´åå§åé¶æ®µçæ¿æ´»å¼åæ¢¯åº¦çææåä¸º <span class="math inline">\(0\)</span>ãXavieråå§åæ¯ä¸º <span class="math inline">\(tanh\)</span> è¿ç±»å¨é¶ç¹éè¿è¿ä¼¼çº¿æ§ä¸å¯¹ç§°çæ¿æ´»å½æ°è®¾è®¡çï¼å¯¹äº <span class="math inline">\(Sigmoid\)</span>ï¼è½ç¶ Xavieråå§åå¯ä»¥ç¨äº <span class="math inline">\(Sigmoid\)</span> ï¼ä½ä¸æ¯æä¼çãå®éåºç¨ä¸­ï¼å¯¹ <span class="math inline">\(Sigmoid\)</span> å¯ä»¥ä½¿ç¨ Xavieråå§åï¼ä½å¯è½éè¦è°æ´ç¼©æ¾å å­ã</p>
<p>ç¨æ°å­¦è¯­è¨è¡¨è¿°ï¼å°±æ¯è¦æ¿æ´»å½æ°å¨åç¹æ³°åå±å¼çä¸é¶è¿ä¼¼ï¼å½ç¶ <span class="math inline">\(x\)</span> ä¹å¨ <span class="math inline">\(0\)</span> éè¿ï¼ <span class="math inline">\(f(x)\)</span> æ»¡è¶³ï¼</p>
<p></p><div class="math display">\[\begin{split}
&amp;f(x) = -f(-x)ï¼å³f(0)=0\\
&amp;f'(0)=1\end{split}
\]</div><p></p><p>åæ¢å¥è¯ï¼ç±è§å¯ï¼æä»¬å¸æä»»æå±çè¾å¥ä¿¡å·æ¹å·®åºç­äºå¶è¾åºä¿¡å·æ¹å·®ï¼</p>
<p></p><div class="math display">\[Var(a^{(l-1)}) \approx Var(a^{(l)})
\]</div><p></p><p>è§å¯ç¬¬ <span class="math inline">\(l\)</span> å±ççº¿æ§åæ¢ï¼</p>
<p></p><div class="math display">\[\mathcal{z_i^{l}}=\sum_{j=1}^{n_{in}}w_{ij}^{(l)}\cdot a_j^{(l-1)}
\]</div><p></p><p>è¿éååºæ¬åè®¾ä¸ä¸ï¼</p>
<ol>
<li>æé <span class="math inline">\(w_{ij}^{(l)}\)</span> ç¬ç«ååå¸ï¼åå¼ä¸º <span class="math inline">\(0\)</span>ï¼æ¹å·® <span class="math inline">\(\sigma _w^2\)</span></li>
<li>æ¿æ´»å¼ <span class="math inline">\(a_{j}^{(l-1)}\)</span> ç¬ç«ååå¸ï¼åå¼ä¸º <span class="math inline">\(0\)</span>ï¼æ¹å·® <span class="math inline">\(\sigma _a^2\)</span></li>
<li>æéåæ¿æ´»å¼ç¸äºç¬ç«</li>
</ol>
<h5 id="åççææ">åççææï¼</h5>
<p></p><div class="math display">\[\begin{split}
\mathbb{E}[z^{(l)}_i]&amp;=\mathbb{E}\bigg[ \sum^{n_{in}}_{j=1}w_{ij}^{(l)}a_j^{(l-1)} \bigg]\\
\mathbb{E}[z_i^{(l)}]&amp;=\sum_{j=1}^{n_{in}}\mathbb{E}[w_{ij}^{(l)}]\cdot \mathbb{E}[a_j^{(l - 1)}]\\
\mathbb{E}[z_i^{(l)}]&amp;=0

\end{split}
\]</div><p></p><h5 id="åççæ¹å·®åçç¼äºååä¼ æ­çè¿ç¨">åççæ¹å·®ï¼åçç¼äºååä¼ æ­çè¿ç¨ï¼</h5>
<p></p><div class="math display">\[\begin{split}
Var(\mathcal{z_i^{(l)}})&amp;=\mathbb E[(\mathcal{z_i^{(l)}})^2]-(\mathbb E[\mathcal z_i^{(l)}])^2\\
&amp;=\mathbb E[(\mathcal{z_i^{(l)}})^2]
\\
&amp;=  \mathbb{E} \left[ \left( \sum_{j=1}^{n_{\text{in}}} w_{ij}^{(l)} a_j^{(l-1)} \right)^2 \right] \\
&amp;= \mathbb{E} \left[ \sum_{j=1}^{n_{\text{in}}} \sum_{k=1}^{n_{\text{in}}} w_{ij}^{(l)} w_{ik}^{(l)} a_j^{(l-1)} a_k^{(l-1)} \right]\\
&amp;= \ldots\\
&amp;= \sum_{j=1}^{n_{in}}\mathbb E[(\mathcal{w}_{ij}^{(l)})^2]\cdot\mathbb E [(a_j^{(l - 1)})^2] \space(j=k)\\
&amp;=n_{in}\cdot\sigma_w^2\cdot\sigma_a^2\\
\end{split}\]</div><p></p><p>ä¸æå¬å¼æ¨å¯¼çç¥å·ä¸­çåå®¹ï¼</p>
<ul>
<li>å½ <span class="math inline">\(j\neq k\)</span>ï¼å¼å­ä¸º <span class="math inline">\(0\)</span></li>
<li>å½ <span class="math inline">\(j=k\)</span>ï¼å¼å­ä¸º <span class="math inline">\(\sum_{j=1}^{n_{in}}\mathbb E[(\mathcal{w}_{ij}^{(l)})^2]\cdot\mathbb E [(a_j^{(l = 1)})^2]\)</span></li>
<li>å æ­¤ï¼æ±åä¸­ä» <span class="math inline">\(j=k\)</span> çé¡¹æè´¡ç®ã</li>
</ul>
<p>ä¸ºäºä¿è¯æ¿æ´»æ¹å·®ä¸åï¼å³</p>
<p></p><div class="math display">\[\begin{split}
Var(z_i^{(l)})&amp;=Var(a_j^{(l - 1)})\\
n_{in}\cdot\sigma^2\cdot\sigma_a^2&amp;=\sigma_a^2\\
n_{in}\cdot\sigma_w^2&amp;=1\\
\end{split}
\]</div><p></p><h5 id="æ¥çæ¨å¯¼ä¸ä¸ååä¼ æ­">æ¥çæ¨å¯¼ä¸ä¸ååä¼ æ­ï¼</h5>
<p>ååä¼ æ­çæ¢¯åº¦ä¼ æ­å¬å¼å¦ä¸</p>
<p></p><div class="math display">\[\frac{\partial L}{\partial a_j^{(l-1)}}=\sum_{i=1}^{n_{out}}w_{ij}^{(l)}\cdot\frac{\partial L}{\partial z_i^{(l)}}
\]</div><p></p><p>é£ä¹åè®¾ <span class="math inline">\(\frac{\partial L}{\partial z_i^{(l)}}\)</span> ç¬ç«ååå¸ï¼æ¹å·®ä¸º <span class="math inline">\(\sigma_g^2\)</span> ï¼å¯ä»¥å¾å°æ¢¯åº¦æ¹å·®çè¡¨ç¤ºï¼</p>
<p></p><div class="math display">\[\begin{split}
Var\left( \frac{\partial L}{\partial a_j^{(l-1)}} \right)&amp;=\sum_{i=1}^{n_{out}}\mathbb{E}[(w_{ij}^{(l)})^2]\cdot\mathbb{E}\left[ \left( \frac{\partial L}{\partial z_i^{(l)}} \right)^2 \right] \\

&amp;=n_{out}\cdot\sigma_w^2\cdot\sigma_g^2\\
\end{split}
\]</div><p></p><p>æä»¬å¸æååä¼ æ­ååæ¢¯åº¦æ¹å·®ä¸åãå³å¸æï¼</p>
<p></p><div class="math display">\[Var\left( \frac{\partial L}{\partial a_j^{(l-1)}} \right)=Var\left( \frac{\partial L}{\partial z_i^{(l)}} \right)
\]</div><p></p><p>é£ä¹å°±å¯ä»¥å¾å°ååä¼ æ­ä¿ææ¹å·®ä¸åæ¶åºæ»¡è¶³çæ¡ä»¶ï¼</p>
<p></p><div class="math display">\[\begin{split}

n_{out}\cdot\sigma_w^2\cdot\sigma_g^2&amp;=\sigma_g^2\\
n_{out}\cdot\sigma_w^2&amp;=1

\end{split}
\]</div><p></p><h5 id="å æ­¤è¿ç§ä¸ä¸è¿ä¸¤ä¸ªæ¡ä»¶åè°åå¹³å">å æ­¤ï¼è¿ç§ä¸ä¸è¿ä¸¤ä¸ªæ¡ä»¶ï¼åè°åå¹³åï¼</h5>
<p></p><div class="math display">\[\begin{split}
n_{in}\cdot\sigma_w^2&amp;=1\\
n_{out}\cdot\sigma_w^2&amp;=1\\
\sigma_w^2&amp;=\frac{2}{n_{in}+n_{out}}\\
\end{split}
\]</div><p></p><p>å³ï¼</p>
<p></p><div class="math display">\[Var(\mathcal w) = \frac{2}{n_{in}+n_{out}}
\]</div><p></p><p>è¿æ ·ï¼æ åå·®å°±åºæ¥äºï¼</p>
<p></p><div class="math display">\[\sigma = \sqrt \frac{2}{n_{in}+n_{out}}
\]</div><p></p><p>å æ­¤åå§æå¼åºç¬¦åçæ­£æåå¸ï¼</p>
<p></p><div class="math display">\[W\sim \mathcal N(0,\sigma^2)
\]</div><p></p><p>æèè½¬åä¸ºåååå¸å½¢å¼ï¼å³</p>
<p></p><div class="math display">\[w\sim U\left[ -\sqrt{\frac{6}{n_{in}+n_{out}}},\sqrt{\frac{6}{n_{in}+n_{out}}} \right]
\]</div><p></p><p>ç¶èï¼Xavieråå§åæåºçæ¶é´æç¹æ©ï¼ReLUæ¿æ´»å½æ°è¿æ²¡æå¾å°å¹¿æ³åºç¨ã<br>
å¯¹äºReLUå½æ°ï¼Xavieråå§ååä¸ä»å¿ï¼</p>
<ol>
<li>ReLUçå½æ°è¾åºéå¯¹ç§°ï¼<span class="math inline">\(y \in [0,+â)\)</span></li>
<li>è´çè¾å¥ååè¾åºæ¶æ¢¯åº¦ä¸º <span class="math inline">\(0\)</span></li>
<li>ä¼å° <span class="math inline">\(50\%\)</span> çç¥ç»åè¾åºæ¸é¶ï¼ä»è</li>
</ol>
<ul>
<li>ååä¼ æ­ï¼<span class="math inline">\(Var(a) \approx \frac{1}{2}Var(y)\)</span></li>
<li>ååä¼ æ­ï¼æ¢¯åº¦æ¹å·®åæ ·åå</li>
</ul>
<p>èä¸å¯¹äºæ·±å±ç¥ç»ç½ç»èè¨ï¼çº¿æ§æ¿æ´»å½æ°ä»·å¼ä¸å¤§ï¼å ä¸ºå®éè¦éçº¿æ§æ¿æ´»å½æ°æ¥æå»ºå¤æçéçº¿æ§ç¥ç»ç½ç»ã</p>
<p>é¢å¯¹è¿äºé®é¢ï¼Heåå§åï¼Kaimingåå§åï¼è¢«æäºåºæ¥ã</p>
<h4 id="kaiming-åå§å">Kaiming åå§å</h4>
<p>ä¸ Xavier åå§åç±»ä¼¼ï¼Kaiming åå§åçç®çä¹æ¯å°½éè®©æ¯ä¸å±è¾åºå±çæ¹å·®ä¸è¾å¥å±çæ¹å·®ä¸è´ï¼ä»¥ç¼è§£æ·±å±ç½ç»ä¸­çæ¢¯åº¦æ¶å¤±ãæ¢¯åº¦çç¸é®é¢ï¼æåä½¿ææ·±æ´æµç½ç»ï¼å¦30å±ï¼è½ä»é¶å¼å§ç´æ¥è®­ç»å¹¶æ¶æã</p>
<p>å¯¹äºååä¼ æ­ï¼</p>
<p></p><div class="math display">\[\begin{split}
\text{Var}(y_i) &amp;= \text{Var} \left( \sum_{j=1}^{n_{\text{in}}} w_{ij} \cdot x_j \right) \\&amp;= n_{\text{input}}\cdot\text{Var}(w_{ij}) \cdot \text{Var}(x_j)
\end{split}
\]</div><p></p><p>å¯¹<span class="math inline">\(y_i\)</span>å å¥ReLUå½æ°å¾å°<span class="math inline">\(a_i\)</span>ï¼é£ä¹æä»¬å°±å¸æï¼</p>
<p></p><div class="math display">\[\text{Var}(a_i) \approx \text{Var}(x_j),\quad \forall i,j
\]</div><p></p><p>è¿éçåå§ååè®¾ä¸ Xavier ç¸åã</p>
<p>å ä¸º <span class="math inline">\(w_{ij}\)</span> ä¸ <span class="math inline">\(x_j\)</span> ç¬ç«ä¸åå¼ä¸º <span class="math inline">\(0\)</span>ï¼æ</p>
<p></p><div class="math display">\[\text{Var}(w_{ij}x_j)=\text{Var}(w_{ij})\text{Var}(x_j)=\sigma_w^2\sigma_x^2
\]</div><p></p><p>å <span class="math inline">\(y_i\)</span> çæ¹å·®ä¸ºï¼</p>
<p></p><div class="math display">\[\begin{split}
\text{Var}(y_i) &amp;= \text{Var}\left( \sum_{j=1}^{n_{in}}w_{ij}x_j \right)\\ 
&amp;=\sum_{j=1}^{n_{in}}\text{Var}(w_{ij}x_j)\\
&amp;=\sum_{j=1}^{n_{in}}\sigma_w^2\sigma_x^2\\
&amp;=n_{in}\sigma_w^2\sigma_x^2\\
&amp;=n_{in}\cdot\text{Var}(w)\cdot\text{Var}(x)
\end{split}
\]</div><p></p><p>æä»¬åè®¾ <span class="math inline">\(y_i\)</span> çåå¸æ¯å³äº 0 å¯¹ç§°çï¼é£ä¹ <span class="math inline">\(y_i\)</span> åæ­£æ°ååè´æ°çæ¦çåå ä¸åã</p>
<p>åç <span class="math inline">\(y_i^2\)</span>ãå ä¸ºå¹³æ¹ææ­£è´é½åæäºæ­£æ°ï¼æä»¥ <span class="math inline">\(y_i^2\)</span> çææå¼ <span class="math inline">\(E[y_i^2]\)</span> å¯ä»¥ææä¸¤åï¼ä¸åæ¥èª <span class="math inline">\(y_i&gt;0\)</span>ï¼ä¸åæ¥èª <span class="math inline">\(y_i&lt;0\)</span>ãç±äºå¯¹ç§°ï¼è¿ä¸¤åçè´¡ç®æ¯ä¸æ¨¡ä¸æ ·çã</p>
<p>è ReLU å½æ° <span class="math inline">\(a_i = \max(0, y_i)\)</span> åªå <span class="math inline">\(y_i\)</span> çæ­£å¼é¨åï¼è´æ°é¨åç´æ¥å½é¶ãæä»¥ <span class="math inline">\(a_i^2\)</span> å¶å®å°±æ¯ <span class="math inline">\(y_i^2\)</span> å¨ <span class="math inline">\(y_i&gt;0\)</span> æ¶çå¼ï¼å¶ä»æåµä¸º 0ã</p>
<p>å æ­¤ï¼<span class="math inline">\(a_i^2\)</span> çææ <span class="math inline">\(E[a_i^2]\)</span> æ­£å¥½å°±ç­äº <span class="math inline">\(y_i^2\)</span> ææçä¸åï¼å³</p>
<p></p><div class="math display">\[E[a_i^2]=\frac{1}{2}E[y_i^2]
\]</div><p></p><p>è <span class="math inline">\(E[y_i]=0\)</span>ï¼æ <span class="math inline">\(E[y_i^2]=\text{Var}(y_i)\)</span>ï¼æ</p>
<p></p><div class="math display">\[E[a_i^2]=\frac{1}{2}\text{Var}(y_i)
\]</div><p></p><p>å½ <span class="math inline">\((E[a_i])^2\)</span> ç¸è¾äº <span class="math inline">\(E[a_i^2]\)</span> å¯ä»¥å¿½ç¥æ¶ï¼å¯è¿ä¼¼ä¸ºï¼</p>
<p></p><div class="math display">\[\text{Var}(a_i)\approx\frac{1}{2}\text{Var}(y_i)
\]</div><p></p><p>æä»¬å¸æ <span class="math inline">\(\text{Var}(a_i) = \text{Var}(x)\)</span>ï¼å½ç¶è³å°å¾æ¯è¿ä¼¼çï¼ï¼ç»åå¯å¾ï¼</p>
<p></p><div class="math display">\[\begin{split}
\frac{1}{2}\cdot n_{in}\cdot Var(w)\cdot Var(x) &amp;=Var{(x)}\\
Var(w)&amp;=\frac{2}{n_{in}}
\end{split}\]</div><p></p><p>ä»¥æ­¤ç±»æ¨ï¼å¯ä»¥å¾å°ååä¼ æ­æ¶ï¼</p>
<p></p><div class="math display">\[Var(w)=\frac{2}{n_{out}}
\]</div><p></p><p>ä¸è¿ä¸è¬æåµï¼æä»¬ä½¿ç¨ååä¼ æ­ä¼åï¼å³</p>
<p></p><div class="math display">\[W\sim \mathcal{N}(0,\sqrt \frac{2}{n_{in}})
\]</div><p></p><p>æä»¬ä¸ºä»ä¹ä¸å¸¸è§ç±»æ¯Xavieråè°åå¹³åå¢ï¼ï¼å¶å®æ¯å¯ä»¥çï¼è§ PyTorch ä¸­ç <code>mode='fan_avg'</code> ï¼å ä¸º<strong>ReLUçååæ¿æ´»ç¹æ§</strong>ä½¿å¾ååä¼ æ­åååä¼ æ­çæ¹å·®ä¼ æ­è§å¾ä¸åï¼</p>
<ul>
<li>å¯¹ååä¼ æ­ï¼ReLU ææ­»ä¸åçç¥ç»åï¼æ¹å·®ååï¼å¯¹ååä¼ æ­ï¼ç¸å½äºç®åçä¼¯åªå©æ©ç ï¼æ¹å·®ä¾æ§ååã</li>
<li>é®é¢å¨äºæ­£åååçç½æ ¼ç»æå¯è½æ¯ä¸åçï¼ä¸æ­£åååçè¡°åæºå¶æå¸­ä½å·®å«ã</li>
</ul>
<p>pytorchå®ç°ï¼</p>
<pre><code class="language-python">layer = nn.Linear(64, 128)
init.kaiming_normal_(layer.weight, a=0, mode='fan_in', nonlinearity='relu')
# aï¼è´æçï¼Leaky ReLU çæåµï¼é»è®¤ä¸º0ï¼
# Leaky ReLU : è´xè½´è®¾ç½®ä¸º ax ï¼èä¸æ¯ 0 ï¼éå¸¸ a = 0.01
</code></pre>
<h4 id="æ­£äº¤åå§å">æ­£äº¤åå§å</h4>
<p>ä¸é¢ä¸¤ç§æ¹æ³é½æ¯å¯¹æ¯ä¸ªæéåå«è¿è¡éæºç¬ç«éæ ·ï¼ä½æ¯ç±äºéæ ·çéæºæ§ï¼ä»ä¸å¯é¿ååºç°åç§æ¢¯åº¦é®é¢ã</p>
<p>å¯¹äºä¸ä¸ª L å±çç­å®½çº¿æ§ç½ç»ï¼å¯ä»¥å¾å®¹æå¾å°è¿ä¸ªç­å¼ï¼</p>
<p></p><div class="math display">\[y=W^{(L)}W^{(L-1)}W^{(L-2)}\cdots W^{(2)}W^{(1)}x
\]</div><p></p><p>é£ä¹ï¼æä»¬å¯ä»¥ç´æ¥å° <span class="math inline">\(W^{(i)}\)</span> åå§åä¸ºæ­£äº¤ç©éµã</p>
<p>æ ¹æ®çº¿ä»£ç¥è¯ï¼æä»¬å¯¹è¿ä¸ªåå§æéç©éµçæå»ºåä¸ºä¸¤æ­¥ï¼</p>
<ol>
<li>ç¨åå¼ <span class="math inline">\(0\)</span> , æ¹å·® <span class="math inline">\(1\)</span> çé«æ¯åå¸æå»ºä¸ä¸ªç©éµ</li>
<li>å¥å¼å¼åè§£è¿ä¸ªç©éµï¼å¾å°ä¸¤ä¸ªæ­£äº¤ç©éµï¼éæ©å¶ä¸­ä¸ä¸ªä½ä¸ºæéç©éµ</li>
</ol>
<p>æ ¹æ®æ­£äº¤ç©éµçæ§è´¨ï¼è¿ä¸ªçº¿æ§ç½ç»å°±ä¼å¨ååãååä¼ æ­ä¸­é½æä¸å®çèæ°ä¿ææ§ãå¦æè¿ä¸ªç½ç»æ¯éçº¿æ§çï¼åªéå¨ç©éµåé¢ä¹ä¸ä¸ä¸ªç³»æ° <span class="math inline">\(\rho\)</span>ï¼è¿ä¸ªç³»æ°ä¸æ¿æ´»å½æ°æå³ï¼å¦å¯¹äº <span class="math inline">\(ReLU\)</span> åºè¯¥ <span class="math inline">\(\rho=\sqrt 2\)</span> ï¼å¯¹äº <span class="math inline">\(tanh\)</span> åºè¯¥ <span class="math inline">\(\rho\approx 1.0\)</span>ï¼è¿æ¯ä¸ºäºè¡¥å¿æ¿æ´»å½æ°å¯¹ä¿¡å·å¹åº¦çåç¼©ï¼æ©å¼ ï¼æåºã</p>
<h3 id="æ´å ç°ä»£çåå§åæ¹æ³">æ´å ç°ä»£çåå§åæ¹æ³</h3>
<h4 id="fixup">Fixup</h4>
<p>å¯ä½¿å¨ä¸ä½¿ç¨æ¹éå½ä¸åçæåµä¸å®ææ·±åº¦æ®å·®ç½ç»è®­ç»ã</p>
<p>éè¿ç¼©æ¾æ®å·®ç½ç»åæ¯çæéæ¥æ§å¶æ¢¯åº¦è§æ¨¡ï¼é¿åæ·±å±ç½ç»çæ¢¯åº¦çç¸</p>
<p>æ¹æ³ï¼</p>
<ul>
<li>å°åç±»å±ãæ®å·®åæ¯çæåä¸å±åå§åä¸º <span class="math inline">\(0\)</span></li>
<li>å¯¹å¶ä»å±ä½¿ç¨æ åæ¹æ³çåå§åï¼ç¶åå°æ®å·®åæ¯ä¸­çæéå±ä¹ä»¥ç¼©æ¾ç³»æ° <span class="math inline">\(L^{-\frac{1}{2m-2}}\)</span></li>
<li>å¨æ¯ä¸ªåæ¯ä¸­æ·»å ä¸ä¸ªæ éä¹æ°ï¼å°±æ¯åé¢çç¼©æ¾ç³»æ°ï¼ï¼å¨æ¯ä¸ªå·ç§¯ãçº¿æ§ååç´ çº§æ¿æ´»å±åé¢æ·»å ä¸ä¸ªå¯å­¦ä¹ æ éåå·®ï¼åå§ä¸º <span class="math inline">\(0\)</span> ï¼ã</li>
</ul>
<p>å¶ä¸­</p>
<ul>
<li><span class="math inline">\(m\)</span>ï¼æ¯ä¸ªæ®å·®åä¸­çæéå±æ°</li>
<li><span class="math inline">\(L\)</span>ï¼ç½ç»æ»æ®å·®åæ°</li>
</ul>
<h4 id="t-fixup">T-Fixup</h4>
<p>å¨å®å¨ç§»é¤å±å½ä¸åçæåµä¸ï¼ç¨³å®å¹¶é«æå°è®­ç» Transformer æ¨¡å</p>
<p>éè¿ç²¾å¿è®¾è®¡çåæ°åå§ååç®åçæ éåå·®ï¼å¨æ°å­¦ä¸ä½¿ååä¼ æ­çä¿¡å·å¹åº¦åååä¼ æ­çæ¢¯åº¦èæ°å¨åå§åæ¶ä¿æç¨³å®ï¼ä»èå®å¨ç§»é¤ææ LN å±ã</p>
<h2 id="åèæç®">åèæç®</h2>
<p>Glorot &amp; Bengio. Understanding the difficulty of training deep feedforward neural networks. Jan 2010</p>
<p>He et al. Deep Residual Learning for Image Recognition. arXiv:1512.03385 [cs.CV] 10 Dec 2015</p>
<p>Saxe et al. Sparser, Better, Deeper, Stronger: Improving Static Sparse Training with Exact Orthogonal Initialization. arXiv:2406.01755v1 [cs.LG] 03 Jun 2024</p>
<p>Yilmaz &amp; Heckel. Regularization-wise Double Descent: Why It Occurs and How to Eliminate It. arXiv:2206.09012, 2022.</p>
<p>Zhang et al. Fixup Initialization: Residual Learning Without Normalization. arXiv:1901.09321 [cs.LG] 27 Jan 2019</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-09 21:47">2026-02-09 21:47</span>&nbsp;
<a href="https://www.cnblogs.com/yldeveloper">yLDeveloper</a>&nbsp;
éè¯»(<span id="post_view_count">11</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19597056);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19597056', targetLink: 'https://www.cnblogs.com/yldeveloper/p/19597056', title: 'ä»æ¨¡åè¯ä¼°ãæ¢¯åº¦é¾é¢å°ç§å­¦åå§åï¼ä¸æ­¥æ­¥è§£ææ·±åº¦å­¦ä¹ çè®­ç»é®é¢' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Lab3-page tables  && MIT6.1810æä½ç³»ç»å·¥ç¨ãæç»­æ´æ°ã ]]></title>
    <link>https://www.cnblogs.com/xiaobai1523/p/19596981</link>
    <guid>4ed9abe34eeab198bc43d458728761b1</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaobai1523/p/19596981" title="åå¸äº 2026-02-09 21:21">
    <span role="heading" aria-level="2">Lab3-page tables  &amp;&amp; MIT6.1810æä½ç³»ç»å·¥ç¨ãæç»­æ´æ°ã</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="labpage-tables">Labï¼page tables</h1>
<p>â	å¨è¿ä¸ªlabä¸­<a href="https://pdos.csail.mit.edu/6.828/2025/labs/pgtbl.html" target="_blank" rel="noopener nofollow">6.1810 / Fall 2025</a>ï¼è¦æ±æä»¬åéè¯»xv6è¯¾æ¬ç<a href="https://pdos.csail.mit.edu/6.828/2025/xv6/book-riscv-rev5.pdf" target="_blank" rel="noopener nofollow">Chapter 3 Page tables</a>(ç¬¬ä¸ç« )ãè¦æ±æä»¬æ¢ç´¢xv6å½ä¸­å³äºé¡µè¡¨çåå®¹ãå¹¶ä¸è¦æ±æä»¬å®ç°ä¸äºé¡µè¡¨ç¸å³åè½çå®ç°ï¼ä¾å¦ï¼èå°ååç©çå°åçæ å°/è§£é¤æ å°ï¼é¡µè¡¨çåå»ºåéæ¾ç­ï¼ã</p>
<p>â	å¹¶ä¸å®ç½ä¹ç»åºäºæç¤ºï¼</p>
<ul>
<li>å¨<code>kernel/memlayout.h</code>å½ä¸­å­æ¾äºåå­å¸å±ï¼é¡µè¡¨å¤§å°ç¸å³çå¸¸éå°±å¨æ­¤ã</li>
<li>å¨<code>kernel/vm.c</code>å½ä¸­æ¯é¡µè¡¨ç¸å³é»è¾çå®ç°ï¼æ¥ä¸æ¥çå¤§é¨ålabåå®¹å°±å¨æ­¤å®ç°ã</li>
<li>å¨<code>kernel/kalloc.c</code>å½ä¸­å­æ¾çæ¶åå­åéç¸å³çé»è¾ï¼å¨æ°å»º/å é¤é¡µè¡¨æ¶ä¼ç¨å°è¿éçå½æ°ã</li>
</ul>
<h2 id="speed-up-system-calls-ç®å">Speed up system calls ï¼ç®åï¼</h2>
<p>â	å¨è¿ä¸ªlabå½ä¸­ï¼è¦æ±æä»¬å¨ xv6 ä¸­æ·»å ä¸ä¸ªæ°ç <strong>ç¨æ·å¯è¯»çåªè¯»åå­æ å°ï¼USYSCALLï¼</strong>ï¼ç¨æ¥è®©ç¨æ·æç¨åºå¨ä¸é·å¥åæ ¸çæåµä¸ï¼ç´æ¥è¯»åé¨ååæ ¸æ°æ®ï¼å¦ <code>pid</code>ï¼ï¼å¹¶æ­£ç¡®å¤çå¶ <strong>åå»ºãæ å°ãè®¿é®ä¸éæ¾çå®æ´çå½å¨æ</strong>ã</p>
<h3 id="å¦ä½å°ä¸ä¸ªç¨æ·å¯è¯»çåªè¯»åå­æ å°usyscallæ·»å å°è¿ç¨é¡µè¡¨åä»¥åå¦ä½å é¤è¯¥æ å°">å¦ä½å°ä¸ä¸ª<strong>ç¨æ·å¯è¯»çåªè¯»åå­æ å°ï¼USYSCALLï¼</strong>æ·»å å°è¿ç¨é¡µè¡¨åï¼ä»¥åå¦ä½å é¤è¯¥æ å°ï¼</h3>
<p>â	<strong>åè¨åæ³¨æäºé¡¹</strong>ï¼å¨xv6å½ä¸­çæå³è¿ç¨çåå»º/éæ¾ï¼è¿ç¨é¡µè¡¨çåå»º/éæ¾çè¿ç¨é½å¨<code>kernel/proc.h</code>,å¹¶ä¸æç§å®ç½çè¯´æ³ï¼æä»¬éè¦å°è¿ç¨ç<strong>pid</strong>å­æ¾å°åå­å½ä¸­ï¼è¿æ ·å¨è°ç¨<strong><code>gitpid</code>ç³»ç»è°ç¨</strong>æ¶ï¼åç´æ¥éæ©ä»åå­ç©ºé´å½ä¸­è¯»åè¯¥pidï¼å¤§å¤§æé«äºæ§è¡æçï¼å¹¶ä¸ä¸ç¨é·å¥å°åæ ¸æï¼è¿å°±æå³çæä»¬éè¦å¨<strong>è¿ç¨çç»æä½</strong>å½ä¸­æ·»å ä¸ä¸ªæåç¨äºæåå­æ¾å½åè¿ç¨ç<strong>pid</strong>çç©ºé´ï¼ä¸ºäºä¹åçè¯»åã</p>
<p>â	<strong>ä¸ãåéç©çåå­</strong>ï¼</p>
<p>â		åé¢æå°è¿ï¼è¿ç¨çç»æä½æåå½ä¸­ææåè¿ç¨pidçæé<code>(struct usyscall *)</code>ï¼å æ­¤ï¼æä»¬éè¦åç»ä»åéç©çåå­ï¼ç±åæ ¸åéï¼ã</p>
<pre><code class="language-c">p-&gt;usyscall = (struct usyscall *)kalloc(); //åéç©çåå­
</code></pre>
<p>â	<strong>äºãåå§ååå®¹ï¼</strong></p>
<p>â		å°å½åè¿ç¨ç<strong>pid</strong>å­æ¾å°åæçæé<code>p-&gt;usyscall</code>ææåçç©ºé´ä¸­ã</p>
<pre><code class="language-c">p-&gt;usyscall-&gt;pid = p-&gt;pid;

// ä»¥ä¸æ¯xv6æååå¥½çï¼æ¹è¿åçugetpidæ¹æ³
int
ugetpid(void)
{
  struct usyscall *u = (struct usyscall *)USYSCALL;  //éè¿èæå°åUSYSCALLè®¿é®ç¹ç¹åå­
  return u-&gt;pid;
}
</code></pre>
<p>â		ä¸ºä»ä¹æä»¬å¿é¡»éè¿<code>struct usyscall *</code>æ¥è®¿é®ï¼èä¸æ¯ç´æ¥è¿åè¿ç¨ç»æä½å½ä¸­ç<strong>pid</strong>å¢ï¼</p>
<p>â		ç­ï¼é¦åï¼xv6æ<strong>åæ ¸é¡µè¡¨</strong>å<strong>ç¨æ·é¡µè¡¨</strong>ï¼å¹¶ä¸ç¨æ·æä¸çè¿ç¨åªè½çå¾è§åå­ãå ä¸ºè¿ç¨çç»æä½å­æ¾å¨åæ ¸é¡µè¡¨å½ä¸­ï¼å¨ç¨æ·æä¸æä»¬åªè½è®¿é®å°ç¨æ·é¡µè¡¨ï¼æä»¥åç¡®æ¥è¯´æä»¬åªè½éè¿<strong>èæåå­</strong>æ­é<strong>é¡µè¡¨æºå¶</strong>çæ¹å¼æ¥è®¿é®å­æ¾å¨è¯¥ç©çç©ºé´å½ä¸­åå®¹ãæä»¬å¨åæ ¸æä¸éè¿<code>p-&gt;usyscall = (struct usyscall *)kalloc(); </code>åéçåå­ä¼¼ä¹ä¹æ¯è¢«åæ ¸æç®¡çï¼ä½æ¯æä»¬å°<strong>USYSCALL</strong>è¿ä¸ªèæå°ååç©çå°åç¸æ å°äºèµ·æ¥ï¼å æ­¤æä»¬å¯ä»¥éè¿å¨ç¨æ·æä¸è®¿é®è¯¥èæå°åçæ¹å¼ä¸è®¿é®å°å·ä½çç©çå°åå½ä¸­çå¼ã</p>
<p>â	<strong>ä¸ãåå»ºç¨æ·é¡µè¡¨ï¼</strong></p>
<p>â		ä¼æå¨ç¥ï¼OSå½ä¸­çè¿ç¨éç¨é¡µè¡¨æºå¶æ¥å°è¿ç¨çèå°åæ å°å°ç©çå°åä¸ï¼æä»¥è¯´æ è®ºæä»¬æ¯å¦è¦æ·»å æ å°å°é¡µè¡¨ä¸­ï¼æä»¬é½å¿ä¸å¯åå°è¦åå»ºä¸ä¸ªç¨æ·é¡µè¡¨ã</p>
<pre><code class="language-c">p-&gt;pagetable = proc_pagetable(p);
</code></pre>
<p>â	<strong>åãå»ºç«èæå°å  å°  ç©çå°åæ å°:</strong></p>
<p>â		è¯´ç½äºå°±æ¯å¨ç¨æ·é¡µè¡¨ä¸­æ·»å ä¸ä¸ªæ°çé¡µè¡¨é¡¹ï¼æä»¥è¿ä¸æ­¥çæä½è¦å¨<strong>é¡µè¡¨çç¸å³é»è¾</strong>å½ä¸­è¿è¡ï¼è¯¥é¡µè¡¨é¡¹ç¨äºæ å°å°åæåéçç©çåå­ãå¨<code>kernel/defs.h</code>å½ä¸­ï¼æä»¬å¯ä»¥çå°<strong><code>mappages</code></strong>çå£°æï¼è¯¥å½æ°ç¨äºæ·»å æ å°å°é¡µè¡¨ï¼ã</p>
<p>â		æ³¨æï¼é¡µè¡¨æºå¶æ¯å°è¿ç¨çèæå°åæ å°ä¸ºåå­ä¸­çå®çç©çå°åï¼æä»¥å¨æ·»å æ°çæ å°æ¶ï¼è¦ä¸å¹¶ç»åºè¿äºåæ°ä»¥åæ å°å¤§å°åæéã</p>
<pre><code class="language-c">// æ å° USYSCALL
  if(mappages(pagetable,
              USYSCALL,  //èæå°å
              PGSIZE,  // æ å°å¤§å°
              (uint64)p-&gt;usyscall, //ç©çå°å
              PTE_R | PTE_U | PTE_V) &lt; 0){  // å®ç½è¦æ±è®¾ç½®çæé
    uvmfree(pagetable, 0);
    return 0;
  }
</code></pre>
<p>â		<strong>xv6</strong>çæéï¼æ·»å æéçç®çæ¯é²æ­¢âç¯¡æ¹âï¼âéæ³è®¿é®âç­ç­æä½ï¼ï¼</p>
<table>
<thead>
<tr>
<th>ä½</th>
<th>å«ä¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>PTE_R</td>
<td>ç¨æ·å¯è¯»</td>
</tr>
<tr>
<td>PTE_W</td>
<td>é²æ­¢ç¨æ·å</td>
</tr>
<tr>
<td>PTE_X</td>
<td>é²æ­¢æ§è¡</td>
</tr>
<tr>
<td>PTE_U</td>
<td>ç¨æ·æå¯è®¿é®</td>
</tr>
<tr>
<td>PTE_V</td>
<td>æ å°ææ</td>
</tr>
</tbody>
</table>
<p>â	<strong>äºãå é¤/éæ¾æ å°:</strong></p>
<p>â		é¦åå¨<strong>é¡µè¡¨éæ¾çç¸å³é»è¾</strong>å½ä¸­è¿è¡éæ¾æ å°çæä½ï¼å¨<code>kernel/defs.h</code>å½ä¸­ï¼æä»¬å¯ä»¥çå°<code>uvmunmap</code>çå£°æï¼è¯¥å½æ°ç¨äºå é¤/éæ¾æ å°å°é¡µè¡¨ï¼ã</p>
<pre><code class="language-c">uvmunmap(pagetable, USYSCALL, 1, 0); //éæ¾USYSCALL
</code></pre>
<p>â		ä¹åå¨<strong>è¿ç¨éæ¾çç¸å³é»è¾</strong>è¿è¡éæ¾ä¹åè®¿é®çç©çç©ºé´çæä½ï¼å¨<code>kernel/defs.h</code>å½ä¸­ï¼æä»¬å¯ä»¥çå°<code>kfree</code>çå£°æï¼è¯¥å½æ°ç¨äºéæ¾åéçåå­ï¼ã</p>
<pre><code class="language-c">kfree(p-&gt;usyscall);
</code></pre>
<p>â	<strong>å­ãæ·±å¥äºè§£è¿ç¨åé¡µè¡¨çåºå±é»è¾ï¼</strong></p>
<table>
<thead>
<tr>
<th>å½æ°ï¼kernel/proc.cï¼</th>
<th>è´è´£ä»ä¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allocproc</code></td>
<td>åéâè¿ç¨èµæºâï¼pidãusyscallãtrapframeãkstackï¼<strong>(ç¬¬ä¸ï¼äºï¼ä¸æ­¥å¨æ­¤è¿è¡)</strong></td>
</tr>
<tr>
<td><code>freeproc</code></td>
<td>éæ¾âè¿ç¨èµæºâ <strong>ï¼ç¬¬äºæ­¥ååé¨åå¨æ­¤è¿è¡ï¼</strong></td>
</tr>
<tr>
<td><code>proc_pagetable</code></td>
<td>æé é¡µè¡¨ç»æ <strong>ï¼ç¬¬äºæ­¥ååé¨åå¨æ­¤è¿è¡ï¼</strong></td>
</tr>
<tr>
<td><code>proc_freepagetable</code></td>
<td>æé¤é¡µè¡¨ç»æ <strong>ï¼ç¬¬åæ­¥å¨æ­¤è¿è¡ï¼</strong></td>
</tr>
</tbody>
</table>
<p>â		ç±æ­¤æä»¬å¯ä»¥å¾ç¥é¡µè¡¨ççå½å¨æå ä¹ä¼´éæ´ä¸ªè¿ç¨ã</p>
<h3 id="ä»£ç çç¸å³åå®¹">ä»£ç çç¸å³åå®¹ï¼</h3>
<pre><code class="language-c">/* kernel/proc.c */
static struct proc*
allocproc(void)
{
  struct proc *p;

  for(p = proc; p &lt; &amp;proc[NPROC]; p++) {
    acquire(&amp;p-&gt;lock);
    if(p-&gt;state == UNUSED) {
      goto found;
    } else {
      release(&amp;p-&gt;lock);
    }
  }
  return 0;

found:
  p-&gt;pid = allocpid();
  p-&gt;state = USED;
  // åéç©çåå­
  p-&gt;usyscall = (struct usyscall *)kalloc();
  if(p-&gt;usyscall == 0){
    freeproc(p);
    release(&amp;p-&gt;lock);
    return 0;
  }
  // åå§ååå®¹
  p-&gt;usyscall-&gt;pid = p-&gt;pid;

  // Allocate a trapframe page.
  if((p-&gt;trapframe = (struct trapframe *)kalloc()) == 0){
    freeproc(p);
    release(&amp;p-&gt;lock);
    return 0;
  }

  // An empty user page table.
  p-&gt;pagetable = proc_pagetable(p);
  if(p-&gt;pagetable == 0){
    freeproc(p);
    release(&amp;p-&gt;lock);
    return 0;
  }

  // Set up new context to start executing at forkret,
  // which returns to user space.
  memset(&amp;p-&gt;context, 0, sizeof(p-&gt;context));
  p-&gt;context.ra = (uint64)forkret;
  p-&gt;context.sp = p-&gt;kstack + PGSIZE;

  return p;
}

// free a proc structure and the data hanging from it,
// including user pages.
// p-&gt;lock must be held.
static void
freeproc(struct proc *p)
{
  // éæ¾ä¹ååéçç©çåå­
  if(p-&gt;usyscall){
    kfree((void*)p-&gt;usyscall);
    p-&gt;usyscall = 0;
  }
  if(p-&gt;trapframe)
    kfree((void*)p-&gt;trapframe);
  p-&gt;trapframe = 0;
  if(p-&gt;pagetable)
    proc_freepagetable(p-&gt;pagetable, p-&gt;sz);
  p-&gt;pagetable = 0;
  p-&gt;sz = 0;
  p-&gt;pid = 0;
  p-&gt;parent = 0;
  p-&gt;name[0] = 0;
  p-&gt;chan = 0;
  p-&gt;killed = 0;
  p-&gt;xstate = 0;
  p-&gt;state = UNUSED;
}

// Create a user page table for a given process, with no user memory,
// but with trampoline and trapframe pages.
pagetable_t
proc_pagetable(struct proc *p)
{
  pagetable_t pagetable;

  // An empty page table.
  pagetable = uvmcreate();
  if(pagetable == 0)
    return 0;

  // æ å° USYSCALLï¼ä¹æ¯å³é®é¨åï¼
  if(mappages(pagetable,
              USYSCALL,  //èæå°å
              PGSIZE,  // æ å°å¤§å°
              (uint64)p-&gt;usyscall,  //ç©çå°å
              PTE_R | PTE_U | PTE_V) &lt; 0){ // æé
    uvmfree(pagetable, 0);
    return 0;
  }
  

  // map the trampoline code (for system call return)
  // at the highest user virtual address.
  // only the supervisor uses it, on the way
  // to/from user space, so not PTE_U.
  if(mappages(pagetable, TRAMPOLINE, PGSIZE,
              (uint64)trampoline, PTE_R | PTE_X) &lt; 0){
    uvmfree(pagetable, 0);
    return 0;
  }

  // map the trapframe page just below the trampoline page, for
  // trampoline.S.
  if(mappages(pagetable, TRAPFRAME, PGSIZE,
              (uint64)(p-&gt;trapframe), PTE_R | PTE_W) &lt; 0){
    uvmunmap(pagetable, TRAMPOLINE, 1, 0);
    uvmfree(pagetable, 0);
    return 0;
  }

  return pagetable;
}

// Free a process's page table, and free the
// physical memory it refers to.
void
proc_freepagetable(pagetable_t pagetable, uint64 sz)
{
  uvmunmap(pagetable, USYSCALL, 1, 0);  //éæ¾/å é¤USYSCALLå¯¹åºçæ å°
  uvmunmap(pagetable, TRAMPOLINE, 1, 0);
  uvmunmap(pagetable, TRAPFRAME, 1, 0);
  uvmfree(pagetable, sz);
}

</code></pre>
<h2 id="print-a-page-table-ç®å">Print a page table ï¼ç®åï¼</h2>
<p>â	è¿ä¸ªlabè¦æ±æä»¬å®ç°ä¸ä¸ªæå°é¡µè¡¨çå½æ°ï¼åæ¶ä¹è½å¸®å©æä»¬çè§£xv6å½ä¸­ï¼é¡µè¡¨æ¯å¦ä½å®ç°çãå¨æ¬æ¬¡å®éªåï¼è¿é¨è¯¾ç¨çä½èå·²ç»å°<code>kpgtblï¼ï¼</code>è¿ä¸ªç³»ç»è°ç¨æ·»å å°åæ ¸å½ä¸­äºï¼ç°å¨æä»¬è¦åçå°±æ¯å®å<code>kernel/vm.c</code>å½ä¸­ç<strong><code>vmprint()</code></strong>å½æ°ï¼è¿ä¸ªå½æ°æ¥æ¶ä¸ä¸ª<strong>pagetable_t</strong>ï¼é¡µè¡¨ç±»åï¼çåæ°ã</p>
<h3 id="xv6å½ä¸­çé¡µè¡¨æ¯ææ ·ç">xv6å½ä¸­çé¡µè¡¨æ¯ææ ·çï¼</h3>
<p>â	<strong>é¶ãä¸ä¸è¯æ±éè¿°</strong></p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å«ä¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>VA</td>
<td>èæå°åï¼CPU ä½¿ç¨ï¼</td>
</tr>
<tr>
<td>PTE</td>
<td>é¡µè¡¨é¡¹ï¼æ å° + æéï¼</td>
</tr>
<tr>
<td>PA</td>
<td>ç©çå°åï¼RAM ç´¢å¼ï¼</td>
</tr>
<tr>
<td>PPN</td>
<td>ç©çé¡µå·ï¼PA çé«ä½ï¼</td>
</tr>
</tbody>
</table>
<p>â	<strong>ä¸ãèæå°åvaçç»æåxv6å½ä¸­çä¸çº§é¡µè¡¨</strong></p>
<p>â		æ ¹æ®æ¬è¯¾ç¨å¯¹åºçè¯¾æ¬<a href="https://pdos.csail.mit.edu/6.828/2025/xv6/book-riscv-rev5.pdf" target="_blank" rel="noopener nofollow">xv6 book</a> å½ä¸­çç¬¬ä¸ç« ï¼æä»¬å¯ä»¥å¾ç¥å¨xv6å½ä¸­ï¼èæå°åvaçä½æ°ä¸º64ä½ï¼å¹¶ä¸æä»¬åªä½¿ç¨<strong>ä½39ä½</strong>ï¼é«25ä½ç¨äºæ©å±ãç¸ä¿¡ä½ å¨çå°è¿éæ¶è¯å®å­¦è¿æä½ç³»ç»è¿é¨è¯¾ç¨ï¼å¨ä»»ä½ä¸æ¬æä½ç³»ç»çæç§ä¹¦å½ä¸­ï¼å¯¹äºèæå°åvaçææçæè¿°é½æ¯ä½nä½æ¯é¡µååç§»å°åï¼ç¨äºå®ä½æé¡µåçé¡µè¡¨é¡¹ï¼å©ä¸çé«ä½é½æ¯ç´¢å¼ï¼ç¨äºå®ä½å°æä¸é¡µã</p>
<p>â		å¨xv6å½ä¸­ï¼é¡µè¡¨ç<strong>æ¯é¡µå¤§å°ä¸º4096B</strong>ï¼<strong>æ¯ä¸ªé¡µè¡¨é¡¹ï¼PTEï¼çå¤§å°ä¸º8B</strong>ï¼æä»¥<strong>ä¸ä¸ªé¡µè¡¨çå½ä¸­æ4096/8 = 512ä¸ªPTE</strong>ãæä»¥39ä½çèæå°åvaå½ä¸­ï¼ä½12ä½ä¸ºé¡µååç§»éï¼çä¸ç27ä½ç¨äºç´¢å¼é¡µè¡¨ã</p>
<p>â		xv6éç¨ä¸çº§é¡µè¡¨ï¼ä¹å°±æ¯è¯´27ä½çç´¢å¼å°åï¼æ¯9ä½ææä¸ä¸ªå±çº§ï¼ç±»ä¼¼ä¸ä¸ªæ ãä»¥ä¸åå®¹æ¯39ä½èæå°åçææã</p>
<p>â		PSï¼ï¼åºå¾ç½ç«éæ¶å¯è½å¤±æï¼æä»¥ä¸é¢æå°½éä½¿ç¨æå­æ¥è¿è¡æè¿°ï¼ã</p>
<pre><code class="language-c">|VPN[2] | VPN[1] | VPN[0]|é¡µååç§»|
  9        9        9		12       å±39ä½
ä¸çº§ç´¢å¼  äºçº§ç´¢å¼  ä¸çº§ç´¢å¼  é¡µååç§»é   æ»ä½æ°
  æ ¹                å¶å­
</code></pre>
<p>â		å¯»åæ¶ï¼åè®¿é®VPN[2]å½ä¸­çæä¸ªPTEï¼è¯¥PTEæåVPN[1]ï¼ä¹åä»VPN[1]ä¸­éåæ°çPTEï¼åæ¬¡éè¿æ°çPTEå¯»åVPN[0]ï¼ç¨VPN[0]è·å¾æç»çPTEåå³å¯è·å¾PNNï¼ç©çé¡µå·ï¼ãæåéè¿å¯¹PNNæä½å¾å°PAï¼ç©çå°åï¼ãæ´ä¸ªè¿ç¨ç±»ä¼¼å¯»æ¾æ çå¶å­ç»ç¹é£æ ·ï¼ä¸å±ä¸å±åä¸å¯»æ¾ã</p>
<p>â	<strong>äºãä¸ºä»ä¹xv6éç¨ä¸çº§é¡µè¡¨ï¼</strong></p>
<p>â		 è¿ç¨å¨åå»ºä¹åï¼å¿é¡»ä¸è³å°æ¥æä¸ä¸ªé¡µè¡¨ã<br>
å¦æéç¨ä¸çº§é¡µè¡¨è®¾è®¡ï¼ä¸ºäºæ»¡è¶³è¿ä¸å¿é¡»çæ¡ä»¶ï¼æä½ç³»ç»å¿é¡»ä¸æ¬¡æ§åéä¸å¼ è¦çæ´ä¸ªèæå°åç©ºé´çé¡µè¡¨ï¼å³ä½¿è¿ç¨åªä½¿ç¨å¶ä¸­æå°çä¸é¨åï¼å¤§é¨ååå­ç©ºé´ä¼æµªè´¹æï¼ï¼ä¹å¿é¡»éµå®è¯¥è§å®ã</p>
<p>â		èå¨éç¨ä¸çº§é¡µè¡¨çè®¾è®¡ä¸­ï¼è¿ç¨åå»ºæ¶åªéè¦åéä¸ä¸ª 4KB çæ ¹é¡µè¡¨é¡µï¼å¶ä½é¡µè¡¨é¡µå¨èæå°åç©ºé´è¢«å®éä½¿ç¨æ¶ææéåéã</p>
<p>â	<strong>äºãPTEçåå®¹</strong></p>
<p>â		å·²ç¥æ¯ä¸ªPTEçå¤§å°ä¸º8Bï¼å³ä¸å±64ä½ãå¶ä¸­ä½10ä½ï¼9<sub>0ä½ï¼ä¸ºflagsï¼æéä½/æ è®°ï¼ï¼å©ä¸çé«ä½ï¼53</sub>10ä½å±44bitï¼ä¸ºPNNï¼ç©çé¡µæ¡å·ï¼åéåå­ä¹æ¶ï¼OSä»ç©ºé²é¡µæ¡è¡¨å½ä¸­çè¡¨å¤´åä¸æ¥çï¼ãæåç10ä½ï¼63~54ä½ï¼ææ¶æªç¨ï¼ç½®ä¸º0ã</p>
<p>â		flagsçåå®¹ï¼</p>
<table>
<thead>
<tr>
<th>ä½</th>
<th>å«ä¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>V</td>
<td>æ¯å¦ææ</td>
</tr>
<tr>
<td>R</td>
<td>å¯è¯»</td>
</tr>
<tr>
<td>W</td>
<td>å¯å</td>
</tr>
<tr>
<td>X</td>
<td>å¯æ§è¡</td>
</tr>
<tr>
<td>U</td>
<td>ç¨æ·å¯è®¿é®</td>
</tr>
<tr>
<td>A/D</td>
<td>ç¡¬ä»¶è®¿é®/ä¿®æ¹æ è®°</td>
</tr>
</tbody>
</table>
<p>â	å½ä¸ä¸ª PTE ç <strong>R/W/X ä»»ä¸ä½ä¸º 1 æ¶</strong>ï¼è¯¥ PTE æ¯å¶å­ç»ç¹ï¼æåçå®ç©çé¡µï¼</p>
<p>â	è¥ <strong>R/W/X å¨ä¸º 0 ä¸ V=1</strong>ï¼åè¯¥ PTE æåä¸ä¸çº§é¡µè¡¨ã</p>
<p>â	é¡µè¡¨çæ¬è´¨é¤äºææèæå°åæ å°å°åªéå¤ï¼è¿å¯ä»¥å³å®è¿ä¸ªå°å<strong>æ¯å¦å¯è¯»ï¼æ¯å¦å¯åï¼æ¯å¦å¯æ§è¡ï¼æ¯å¦å¯ç¨æ·æè®¿é®/æ§è¡</strong>ã</p>
<p><strong>ä¸ãPNNå¦ä½è½¬ä¸ºç©çå°å</strong></p>
<p>â		xv6å½ä¸­è§å®ç©çå°åçä½æ°ä¸º56ä½ï¼ç±PNNåvaçä½12ä½æ¼æ¥èæï¼å·ä½æä½ææ³å¦ä¸ï¼</p>
<p>â		1ãé¦åè®²PTEå³ç§»10ä½ï¼è¿æ ·ä½10ä½çflagsä¼æ¶å¤±ã</p>
<p>â		2ãä¹åè®²PTEå·¦ç§»12ä½ï¼è¿æ ·ä½12ä½çç©ºç½æ­£å¥½å¯ä»¥ç±èæå°åçä½12ä½åç§»éè¿è¡å¡«è¡¥ã</p>
<p>â		3ãæä»¬ç°å¨éè¦å°èæå°åvaçç¬¬12ä½è¿è¡å¡«è¡¥ï¼æä»¥æä»¬<strong>å°vaå0xFFFç¸ä¸</strong>ï¼è¿æ ·vaå°±åªå©ä¸äºç¬¬12ä½çåç§»éã</p>
<p>â		4ãå°PTEåvaç¸å æçè¿è¡âé»è¾æâæä½ï¼è¿æ ·å°±æ¼æ¥å¥½äºä¸ä¸ªå®æ´çç©çå°åã</p>
<p>â		æ³¨æï¼å¨xv6å½ä¸­ï¼ä»¥ä¸çæä½é½æçå¯¹åºçå®ï¼å¨ç¼ç æ¶å¯ä»¥ç´æ¥ä½¿ç¨å®æä½ã</p>
<h3 id="è¯¥labçå®ç°åä»£ç ç¸å³åå®¹">è¯¥labçå®ç°åä»£ç ç¸å³åå®¹</h3>
<p>â	<strong>ä¸ãä¸ªäººçè§£æåå®ç½æç¤º</strong></p>
<ol>
<li>æå°æ ¼å¼ï¼ç¬¬ä¸è¡æ¾ç¤º vmprint çåæ°ãä¹åï¼æ¯ä¸ªé¡µè¡¨é¡¹ï¼PTEï¼å¯¹åºä¸è¡ï¼åæ¬é£äºæåæ ä¸­æ´æ·±å±æ¬¡é¡µè¡¨é¡µçé¡µè¡¨é¡¹ãæ¯ä¸ªé¡µè¡¨é¡¹è¡é½ç¼©è¿è¥å¹²ä¸ª â..âï¼ä»¥è¡¨ç¤ºå¶å¨æ ä¸­çæ·±åº¦ãæ¯ä¸ªé¡µè¡¨é¡¹è¡é½ä¼æ¾ç¤ºå¶èæå°åãé¡µè¡¨é¡¹ä½ä»¥åä»è¯¥é¡µè¡¨é¡¹ä¸­æåçç©çå°åãä¸è¦æå°æ æçé¡µè¡¨é¡¹ã</li>
<li>å¨<code>kernel/riscv.h</code>çæä»¶æ«å°¾ï¼æå³äºvaè½¬paçå®ã</li>
<li><code>freewalk</code>è¿ä¸ªå½æ°ä¹è®¸ä¼å¸¦æ¥å¯åã</li>
<li>å¨printfè°ç¨ä¸­ä½¿ç¨%pï¼ä»¥å®ç½ä¸ç¤ºä¾æç¤ºçæ¹å¼æå°å®æ´ç64ä½åå­è¿å¶é¡µè¡¨é¡¹ï¼PTEï¼åå°åã</li>
</ol>
<p>â	<strong>äºãä»£ç ç¸å³åå®¹</strong></p>
<pre><code class="language-c">##å¨kernel/vm.cæä»¶åï¼

static void
vmprint_walk(pagetable_t pagetable, int level, uint64 va){
  //æ¯ä¸ªé¡µè¡¨521ä¸ªPTE
  for(int i = 0; i &lt; 512; i++){
    pte_t pte = pagetable[i];
    // pteææ å¹¶ä¸ Vä½ä¸º1åä¸æ¯å¶å­ç»ç¹
    if((pte &amp; PTE_V) == 0)
      continue;
    // å°ä¼ å¥çPAç©çå°åï¼æ­¤æ¶PAç¬¬12ä½ä¸ºç©ºï¼ååç§»éç¸å åå¹¶ä¸ºå®æ´çç©çå°å
    uint64 newva = va | ((uint64)i &lt;&lt; (12 + 9 * level));

    // æå°å±çº§ï¼ depth = 2 - level
    for(int d = 0; d &lt; 2 - level; d++)
      printf(" ..");

    printf("%p: pte %p pa %p\n",
           (void*)newva,
           (void*)pte,
           (void*)PTE2PA(pte));

    // ä¸æ¯å¶å­ç»ç¹ååä¸éå½
    if((pte &amp; (PTE_R | PTE_W | PTE_X)) == 0){
      // PTE2PAæ¯å°pteè½¬ä¸ºäºç©çå°åPAï¼æ­¤æ¶ä½12ä½ä¸ºç©ºï¼
      pagetable_t child = (pagetable_t)PTE2PA(pte);
      vmprint_walk(child, level - 1, newva);
    }
  }

}

#if defined(LAB_PGTBL) || defined(SOL_MMAP) || defined(SOL_COW)
void
vmprint(pagetable_t pagetable) {
  // your code here
  // æå°ç¬¬ä¸è¡ï¼ä¹åéå½è¿è¡éå
  printf("page table %p\n", pagetable);
  vmprint_walk(pagetable, 2, 0);
  
}
#endif
</code></pre>
<h2 id="use-superpages-å°é¾">Use superpages (å°é¾)</h2>
<p>â	è¿ä¸ªlabå¯ä»¥è¯´æ¯æé¾çlabãå¡äºæå¿«20ä¸ªå°æ¶ãå½ç¨æ·éè¿<code>sbrk()</code>ç³è¯·åå­æ¶ï¼å¦æç³è¯·çåå­<strong>â¥2MB</strong>æ¶ï¼xv6ä¸åä½¿ç¨ä¼ ç»çä¸çº§é¡µè¡¨ï¼å³å¤§å°ä¸º4Kçé¡µï¼ï¼èæ¯éç¨äºçº§é¡µè¡¨ï¼å³1ä¸ª2MBçè¶çº§é¡µï¼ãå¹¶ä¸ç¸å³çå½æ°ä¹è¦ééå¤çè¶çº§é¡µçåè½ã</p>
<p>â	éç¨è¶çº§é¡µåçå°åç»æå¦ä¸ï¼</p>
<pre><code>|VPN[2] | VPN[1]ï¼åå«VPN[0]ï¼|é¡µååç§»|
  9        9        9		   12       å±39ä½
ä¸çº§ç´¢å¼         äºçº§ç´¢å¼      é¡µååç§»é   æ»ä½æ°
  æ ¹              å¶å­
===============================
level-2 (512GB)
  |
level-1 (2MB)   â â superpage å¨è¿éï¼ç¬¬ä¸å±ï¼
  |
level-0 (4KB)   â æ®éçé¡µé¢å¨è¿éï¼ç¬¬0å±ï¼
</code></pre>
<p>â	èµ·å§è¯¥labçæäºå°æ¹çåæ³æ¯æè¿¹å¯å¾ªçï¼ä½ å¯ä»¥ç´æ¥ç§æ¬ä¹ååå çé¨åä»£ç ã</p>
<h3 id="é¡ºè¾æ¸çå¯»æ¾éè¦ä¿®æ¹çåå®¹">é¡ºè¾æ¸çå¯»æ¾éè¦ä¿®æ¹çåå®¹</h3>
<p>â	ä¸ãå¨<code>kernel/kalloc.c</code>æä»¶å½ä¸­çå½æ°æ¯è´è´£åéé¡µè¡¨åå­çï¼ç®åè¿éåªææ®éé¡µçåå®¹ï¼æä»¬éè¦æ·»å è¶çº§é¡µçç¸å³åå®¹ãå¨<code>kmem</code>ä¸­æ·»å ä¸ä¸ª<code>run</code>ç»æï¼è®©å¶æåä¸ä¸ªè¶çº§é¡µçç©ºé²é¡µè¡¨ã ä¹åå¨<code>freerange</code>å½æ°å½ä¸­ä»¿ç§æ®éé¡µçåå­åéé»è¾ï¼ç§è«è¦ç»ç¢åä¸ä¸ªè¶çº§é¡µçåå­åéé»è¾ãåæ¶ä»¿ç§<code>kfree</code>å<code>kalloc</code>åä¸ä¸ª<code>superalloc</code>å<code>superfree</code>ï¼è¿ä¸¤ä¸ªåå«æ¯è¶çº§é¡µçåéåéæ¾ã</p>
<p>â	äºã<code>sbrk()</code>å½ä¸­è°ç¨äº<code>growproc()</code>å½æ°ï¼ä½¿ç¨åæ°<strong>n</strong>è°æ´åå­çå¤§å°ãå½<strong>n</strong>ä¸ºææå¼æ¶åè°ç¨<code>uvmalloc</code>å½æ°æ¥å¯¹ç¨æ·è¿è¡èæåå­çåé<strong>ï¼è¿ééè¦ä¿®æ¹uvmallocï¼</strong>ãè¿ä¸æ­¥è¿å¥<code>uvmalloc</code>å½æ°å½ä¸­ï¼å¶ä¸­æ¶åäº<code>mappages</code>å½æ°ï¼è¯¥å½æ°è´è´£ä¸ºæ¯ä¸ªé¡µè¡¨é¡¹æ å°ç©çå°å<strong>ï¼è¿ééè¦ä¿®æ¹mappagesï¼</strong>ï¼åæ¶ä¹æ¶åäº<code>uvmdealloc</code>å½æ°ï¼è¯¥å½æ°çåè½æ¯éæ¾ç¨æ·é¡µé¢ï¼å¶åé¨æ¶å<code>uvmunmap</code>å½æ°ï¼è¿ä¸ªå½æ°æ¯é¡µé¢éæ¾çå·ä½å®ç°<strong>ï¼è¿ééè¦ä¿®æ¹uvmunmapï¼</strong>ãå¨<code>mappages</code>å½æ°å½ä¸­æ¶åäº<code>walk</code>å½æ°ï¼è¯¥å½æ°è´è´£è¿åèæå°å va å¯¹åºçé¡µè¡¨é¡¹ï¼PTEï¼çå°å<strong>ï¼è¿ééè¦ä¿®æ¹walkï¼</strong>ã</p>
<p>â	ä¸ãå®ç½è¯´äºï¼éè¿ç¨æ·ç¨åº<code>pgtbltest</code>æ¥æµè¯è¶çº§é¡µåè½æ¯å¦å®æï¼æä»¥æä»¬é¡ºè¤æ¸çå¨<code>kernel/pgtbltest.c</code>å½ä¸­åç°<code>superpg_kfork</code>å½æ°è°ç¨äº<code>fork</code>è¿ç¨æ¥åå»ºæ°è¿ç¨ï¼æç®è®©æ°çè¿ç¨éç¨è¶çº§é¡µãæä»¥æä»¬åæ¬¡é¡ºè¾æ¸çæ¾å°äº<code>kfork</code>å½æ°ï¼éé¢æ¶åäº<code>uvmcopy</code>å½æ°ï¼è¿ä¸ªå½æ°è´è´£å°ç¶è¿ç¨çé¡µè¡¨å¤å¶ç»å­è¿ç¨ï¼æç¶è¿ç¨çæ°æ®æ·è´ä¸ä»½ç»å­è¿ç¨ï¼ï¼<strong>ï¼è¿ééè¦ä¿®æ¹uvmcopyï¼</strong>ã</p>
<h3 id="ä»£ç ç¸å³åå®¹">ä»£ç ç¸å³åå®¹</h3>
<p>â	<strong>è¿ä¸å°èæ¬äººä¸å¼å§æ²¡ååºæ¥ï¼å æ­¤åèäºå¾å¤å¤§ä½¬çåå®¢åè§é¢æå¾ä»¥ååºï¼ä»¥ä¸ä»£ç åèäºè¿ä½å¤§ä½¬çåå®¢â<a href="https://chenby99.github.io/p/mit6.1810lab3-page-tables/#use-superpages" target="_blank" rel="noopener nofollow">mit6.1810]Lab3: page tables</a>ã</strong></p>
<p>â	1ãå¨<code>kalloc.c</code>å½ä¸­ç§è«è¦ç»ç¢æ·»å å¯¹è¶çº§é¡µçç®¡çã</p>
<pre><code class="language-c">struct {
  struct spinlock lock;
  struct run *freelist;
  struct run *superfreelist;   // ä»¿ç§ä¸é¢çfreelist
} kmem;

void
freerange(void *pa_start, void *pa_end)
{
  char *p;
  p = (char*)PGROUNDUP((uint64)pa_start);
#ifndef LAB_PGTBL
  for(; p + PGSIZE &lt;= (char*)pa_end; p += PGSIZE)
    kfree(p);
#else
  int superpg_num = 10;
  // è®¡ç®è¶çº§é¡µçèµ·å§å°åï¼ä» pa_end åä¸å¯¹é½å°è¶çº§é¡µè¾¹ç
  char *superp = (char*)SUPERPGROUNDUP((uint64)pa_end - superpg_num * SUPERPGSIZE);
  // åéæ¾æ®éé¡µé¢é¨å
  for(; p + PGSIZE &lt;= superp; p += PGSIZE)
    kfree(p);
   // åéæ¾è¶çº§é¡µé¨å
  for(; superp + SUPERPGSIZE &lt;= (char*)pa_end; superp += SUPERPGSIZE)
    superfree(superp);
#endif
}

#ifdef LAB_PGTBL
// è¶çº§é¡µéæ¾å½æ°
void
superfree(void *pa)
{
  struct run *r;
  // åæ°éªè¯ï¼ç¡®ä¿ pa å¯¹é½å°è¶çº§é¡µå¤§å°ä¸å¨åæ³åå­èå´å
  if(((uint64)pa % SUPERPGSIZE) != 0 || (char*)pa &lt; end || (uint64)pa &gt;= PHYSTOP)
    panic("superfree"); 
  
  memset(pa, 1, SUPERPGSIZE);
  r = (struct run*)pa;
  //å é
  acquire(&amp;kmem.lock);
  r-&gt;next = kmem.superfreelist;
  // å°è¶çº§é¡µæå¥ç©ºé²é¾è¡¨å¤´é¨
  kmem.superfreelist = r;
  //è§£é
  release(&amp;kmem.lock);
}

// è¶çº§é¡µåéå½æ°
void *
superalloc(void)
{
  struct run *r;
  acquire(&amp;kmem.lock);
  // ä»ç©ºé²é¾è¡¨ä¸­ååºä¸ä¸ªè¶çº§é¡µ
  r = kmem.superfreelist; 
  if(r)
    kmem.superfreelist = r-&gt;next;
  release(&amp;kmem.lock);
  if(r)
    memset((char*)r, 5, SUPERPGSIZE);
   // è¿ååéçè¶çº§é¡µå°å
  return (void*)r;
}
#endif
</code></pre>
<p>â	2ã<code>kalloc.h</code>å½ä¸­ï¼æä»¬ç»æ®éé¡µåéåå­æ¶ç¨å°äº<code>PGROUNDUP</code>ï¼äºæ¯è¶çº§é¡µçåå­åéä¹éè¦ç±»ä¼¼çåå®¹ãæä»¬é¡ºè¾æ¸çæ¾å°<code>riscv.h</code>ï¼å¨éé¢ä»¿ç§<code>PGROUNDUP</code>å<code>PGROUNDDOWN</code>ï¼æ°å¢<code>SUPERPGROUNDUP</code>å<code>SUPERPGROUNDDOWN</code>ã</p>
<pre><code class="language-c">#define SUPERPGROUNDUP(sz)  (((sz)+SUPERPGSIZE-1) &amp; ~(SUPERPGSIZE-1))
#define SUPERPGROUNDDOWN(a) (((a)) &amp; ~(SUPERPGSIZE-1)) 
</code></pre>
<p>â	3ãå¨<code>defs.h</code>ä¸­æ·»å ä¸åæçæ°å¢çå£°æã</p>
<pre><code class="language-c">void *          superalloc(void);
void            superfree(void *pa);
pte_t *         superwalk(pagetable_t, uint64, int, int *);
</code></pre>
<p>â	<strong>æ¥ä¸æ¥çåå®¹é½å¨kernel/vm.cå½ä¸­å®ç°</strong>ã</p>
<p>â	4ãæ·»å <code>uvmalloc</code>å½æ°ã</p>
<pre><code class="language-c">uint64
uvmalloc(pagetable_t pagetable, uint64 oldsz, uint64 newsz, int xperm)
{
  char *mem;
  uint64 a;
  int sz;

  if(newsz &lt; oldsz)
    return oldsz;

  oldsz = PGROUNDUP(oldsz);
  for(a = oldsz; a &lt; newsz; a += sz){
    sz = PGSIZE;
#ifdef LAB_PGTBL
    //å¤æ­å½åå¤§å°æ¯å¦æ»¡è¶³ä½¿ç¨è¶çº§é¡µçå¼é
    if (newsz - a &gt;= SUPERPGSIZE &amp;&amp; a % SUPERPGSIZE == 0) {
      //æ´æ°å¤§å°ä¸ºè¶çº§é¡µæ¹ä¾¿æ¥ä¸æ¥çéå¢
      sz = SUPERPGSIZE;
      //åéè¶çº§é¡µå¤§å°çç©çåå­
      mem = superalloc();
    } else
#endif
    mem = kalloc();
    if(mem == 0){
      uvmdealloc(pagetable, a, oldsz);
      return 0;
    }
#ifndef LAB_SYSCALL
    memset(mem, 0, sz);
#endif
    //ç»åéçé¡µæ·»å æ å°
    if(mappages(pagetable, a, sz, (uint64)mem, PTE_R|PTE_U|xperm) != 0){
#ifdef LAB_PGTBL
       // å¦æåéçæ¯è¶çº§é¡µå¤§å°åå­åéæ¾è¶çº§é¡µåå­
      if(sz == SUPERPGSIZE)
        superfree(mem);
      else
#endif
      kfree(mem);
      uvmdealloc(pagetable, a, oldsz);
      return 0;
    }
  }
  return newsz;
}
</code></pre>
<p>â	5ãä¿®æ¹<code>mappages</code>å½æ°ã</p>
<pre><code class="language-c">int
mappages(pagetable_t pagetable, uint64 va, uint64 size, uint64 pa, int perm)
{
  uint64 a, last;
  pte_t *pte;

  if((va % PGSIZE) != 0)
    panic("mappages: va not aligned");

  if((size % PGSIZE) != 0)
    panic("mappages: size not aligned");

  if(size == 0)
    panic("mappages: size");
  
  a = va;
  last = va + size - PGSIZE;
  for (;;) {
#ifdef LAB_PGTBL
    int use_superpage = 0; // ç¨äºæ è¯æ¯å¦ä½¿ç¨è¶çº§é¡µé¢æ å°
    // å¤æ­æ¯å¦å¯ä»¥ä½¿ç¨è¶çº§é¡µé¢æ å°
    if ((a % SUPERPGSIZE) == 0 &amp;&amp; (a + SUPERPGSIZE &lt;= last + PGSIZE) &amp;&amp; (perm &amp; PTE_U)) {
      use_superpage = 1; // æ´æ¹æ è¯
    }
    // å¦ææ¯è¶çº§é¡µåè®¾ç½®lä¸º1ï¼ä»£è¡¨æ¥ä¸æ¥å¨superwalkå½ä¸­å°1å±ååæ­¢
    // ä¼ ç»çwalkä¼èµ°å°level0ï¼ä¹åè¿åpteï¼é¡µè¡¨é¡¹å°åï¼
    // èæ¹è¿è¿çsuperwalkå¯ä»¥è¢«äººä¸ºææ§åå°æå®çå±çº§ã
    //  å±çº§ä»é«å°åºä¸ºï¼2 1 0
    if (use_superpage) {
      int l = 1;
      if ((pte = superwalk(pagetable, a, 1, &amp;l)) == 0)
        return -1;
    } else {
      if ((pte = walk(pagetable, a, 1)) == 0)
        return -1;
    }
#else 
    // å¦æä¸è½ä½¿ç¨è¶çº§é¡µé¢æ å° å°±ç¨æ®éé¡µ
    if ((pte = walk(pagetable, a, 1)) == 0)
      return -1;
#endif
    // æ£æ¥PTEæ¯å¦å·²ç»è¢«æ è®°ä¸ºææ
    if (*pte &amp; PTE_V)
      panic("mappages: remap");
    // å¦æææåå°ç©çå°åè½¬æ¢ä¸ºPTEæ ¼å¼ å¹¶å ä¸æéä½åææä½
    // è¿éå°±æ¯æ·»å æ å°çæ ¸å¿
    *pte = PA2PTE(pa) | perm | PTE_V; 
#ifdef LAB_PGTBL
    //å¦æä½¿ç¨è¶çº§é¡µ
    if (use_superpage) { 
      // åæ£æ¥æ¯å¦å·²ç»æ å°å°æåä¸ä¸ªè¶çº§é¡µé¢
      if (a + SUPERPGSIZE == last + PGSIZE) 
        break;
      // æ´æ°èµ·å§å°ååç©çå°å
      a += SUPERPGSIZE;
      pa += SUPERPGSIZE;
    } else {
      if (a == last)
        break;
      a += PGSIZE;
      pa += PGSIZE;
    }
#else 
    //ä¸ä½¿ç¨è¶çº§é¡µï¼åæ¯æ¬¡èªå¢ä¸ä¸ªæ®éé¡µçå¤§å°
    if (a == last)
      break;
    a += PGSIZE;
    pa += PGSIZE;
#endif
    }
    return 0;
}
</code></pre>
<p>â	6ãä¿®æ¹<code>uvmunmap</code>å½æ°ã</p>
<p><strong>æ³¨æï¼</strong>å¨éæ¾æ´ä¸ªé¡µæ¶æ¶åä¸ç§æåµï¼é¡µåªä¼å¨å¶å¯¹åºçèæå°åè¢«å®å¨ unmap æ¶è¢«éæ¾ï¼ï¼</p>
<ol>
<li>ç¬¬ä¸ç§æåµæ¯éæ¾æ®éé¡µï¼å·²ç¥æ¯ä¸ªæ®éé¡µé½æ¯4KBï¼å¹¶ä¸xv6çä¸çº§é¡µè¡¨çæä½çº§ä¹é½æ¯4KBï¼æä»¥ç´æ¥éæ¾å³å¯ã</li>
<li>ç¬¬äºç§æåµæ¯éæ¾è¶çº§é¡µï¼æ´åéæ¾ï¼ï¼è¶çº§é¡µçå¤§å°ä¸º2Mï¼å ä¸ºxv6çä¸çº§é¡µè¡¨çç¬¬äºå±æ¯è¡¨ç¤ºè¶çº§é¡µçå±çº§ï¼å¦æç¬¬äºå± PTE æ¯ leaf å¹¶ä¸è¦ç 2MBï¼åæ¯è¶çº§é¡µï¼ï¼æ­¤æ¶å¨å°åå¯¹å¶çæåµä¸å¹¶ä¸éæ¾è¯¥é¡µä¸ä¼å¯¹å¶å®çé¡µé æå½±ååç´æ¥éæ¾å³å¯ã</li>
<li>ç¬¬ä¸ç§æåµæ¯éæ¾è¶çº§é¡µï¼éæ´åéæ¾ï¼å¯è½æ¯ä¸åå°ä¹å¯è½æ¯ä¸åå¤§ï¼ï¼ä¼æå¨ç¥ï¼å¨æä½ç³»ç»å½ä¸­ï¼ä¸ä¸ª leaf PTE è¦ä¹æ å°æ´ä¸ª 4KB é¡µæ¡ï¼è¦ä¹æ å°æ´ä¸ª 2MB é¡µæ¡ï¼ä¸è½åªæ å°å¶ä¸­ä¸é¨åãæä»¥ï¼å½æä»¬éæ¾åå­æ¶ï¼è¢«éæ¾çåå­å¤§å°æ²¡æè¶è¿ä¸ä¸ªè¶çº§é¡µ æè è¶è¿äºä¸ä¸ªè¶çº§é¡µï¼é£ä¹å°±å¿ç¶å¯¼è´æä¸ä¸ªé¡µçå®æ´æ§è¢«æç ´ï¼ä»èè¿åæä½ç³»ç»å¯¹åä¸ªé¡µå®æ´æ§çè§å®ãæä»¥æä»¬è¦å°åªäºè¢«ç ´åäºå®æ´æ§çè¶çº§é¡µè¿è¡éçº§æä½ï¼ä½¿å¾å¶éä¸ºæ®éé¡µãéçº§çè¿ç¨å°±æ¯åå¼è¾æ°çæ®éé¡µï¼ç¶åå°åæ¥è¶çº§é¡µçåå®¹ï¼æ­£å¸¸å­å¨æ ééæ¾çåå®¹ï¼å¤å¶å°æ°çæ®éé¡µï¼ä¹åæä»¬å é¤/éæ¾åæ¥çè¶çº§é¡µã</li>
</ol>
<p><strong>é®ï¼</strong>ä¸ºä»ä¹2MBçè¶çº§é¡µçå®æ´æ§è¢«ç ´ååå°±å¿é¡»éçº§ä¸º4KBçæ®éé¡µï¼<br>
<strong>ç­ï¼</strong>xv6æ¯æ3çº§é¡µè¡¨ï¼æ®éé¡µï¼4KBï¼å·²ç»æ¯æå°çç¡¬ä»¶æ å°ç²åº¦ï¼ä¸è½åç»åï¼æä»¥ä¸å­å¨âæ®éé¡µè¢«é¨åç ´åååéçº§âçé®é¢ã</p>
<pre><code class="language-c">void
uvmunmap(pagetable_t pagetable, uint64 va, uint64 npages, int do_free)
{
  uint64 a;
  pte_t *pte;
  int sz;

  if((va % PGSIZE) != 0)
    panic("uvmunmap: not aligned");

  for(a = va; a &lt; va + npages*PGSIZE; a += sz){
    sz = PGSIZE;
#ifdef LAB_PGTBL
    int l = 0; // æ å¿åé ç¨äºç¡®å®æ¯è¶çº§é¡µè¿æ¯æ®éé¡µã
    int flag = 0; // æ è®°æ¯å¦å·²ç»å¤çè¿è¶çº§é¡µ
    if((pte = superwalk(pagetable, a, 0, &amp;l)) == 0)
      panic("uvmunmap: walk");
#else
    if((pte = walk(pagetable, a, 0)) == 0)
      panic("uvmunmap: walk");
#endif
    if((*pte &amp; PTE_V) == 0) {
      printf("va=%ld pte=%ld\n", a, *pte);
      panic("uvmunmap: not mapped");
    }
    if(PTE_FLAGS(*pte) == PTE_V)
      panic("uvmunmap: not a leaf");
    
    /*ä¸é¢å¼å§è§£é¤é¡µé¢æ å°*/
    if(do_free){
      uint64 pa = PTE2PA(*pte); //  ä»é¡µè¡¨é¡¹ä¸­æåç©çå°å
#ifdef LAB_PGTBL
      if(l == 1) { 
        // å¦ææ¯è¶çº§é¡µåè·åæé
        int perm = *pte &amp; 0xFFF;
        // ç¶åæ¸ç©ºé¡µè¡¨é¡¹
        *pte = 0; 
        // è®¾ç½®æ å¿
        flag = 1; 
        // æ´æ°å¤§å°ä¸ºè¶çº§é¡µå¤§å°
        sz = SUPERPGSIZE;
        // è¿éæ¯ä¸è¿°çç¬¬ä¸ç§æåµï¼å¦æèæå°åæªå¯¹é½å°è¶çº§é¡µ
        if(a % SUPERPGSIZE != 0){ 
          // å¯¹é½å°è¶çº§é¡µè¾¹ç
          for(uint64 i = SUPERPGROUNDDOWN(a); i &lt; va; i += PGSIZE) {
            char *mem = kalloc(); // åéæ°çç©çé¡µé¢
            if(mem == 0)
              panic("uvmunmap: kalloc");
            mappages(pagetable, i, PGSIZE, (uint64)mem, perm); // å°æ°åéçé¡µé¢æ å°å°èæå°åç©ºé´
            memmove(mem, (char*)pa + i - SUPERPGROUNDDOWN(a), PGSIZE); // å°æ°æ®ä»è¶çº§é¡µå¤å¶å°æ°åéçé¡µé¢
          }
          a = SUPERPGROUNDUP(a); // æ´æ°èæå°å
          sz = 0; // æ´æ°å¤§å°
        }
        superfree((void*)pa); // éæ¾è¶çº§é¡µ
      } else
#endif
      // å¦ææ¯æ®éé¡µ
      kfree((void*)pa); // éæ¾æ®éé¡µ
    }
#ifdef LAB_PGTBL
    if(flag == 0) // é¿åä½¿ç¨è¶çº§é¡µæ¶åè¢«éå¤æ¸é¤
#endif
    *pte = 0;
  }
}
</code></pre>
<p>â	7ãä»¿ç§<code>walk</code>æ·»å <code>superwalkã</code></p>
<pre><code class="language-c">#ifdef LAB_PGTBL
// åæ°lç¨äºæå®é¡µè¡¨çèµ·å§çº§å«
pte_t *
superwalk(pagetable_t pagetable, uint64 va, int alloc, int *l)
{
  if(va &gt;= MAXVA)
    panic("superwalk");

  for(int level = 2; level &gt; *l; level--) {
    // è·åå½åå±çé¡µè¡¨é¡¹å°å
    pte_t *pte = &amp;pagetable[PX(level, va)]; 
    if(*pte &amp; PTE_V) { 
      // å¦æé¡µè¡¨é¡¹ææ,å°å¶è½¬ä¸ºç©çå°å
      pagetable = (pagetable_t)PTE2PA(*pte); 
      if(PTE_LEAF(*pte)) { 
        // å¦ææ¯å¶èç¹ä»£è¡¨æ¾å°æ³è¦çäºï¼æ´æ°é¡µè¡¨çº§å«ï¼è¿åé¡µè¡¨å°åã
        *l = level;
        return pte;
      }
    } else {
      //é¡µè¡¨é¡¹æ æåå°è¯åéï¼åéå¤±è´¥è¿å0
      if(!alloc || (pagetable = (pde_t*)kalloc()) == 0) 
        return 0;
      // åå§åæ°åéçé¡µè¡¨
      memset(pagetable, 0, PGSIZE);
      // æ´æ°é¡µè¡¨é¡¹ä¸ºææ
      *pte = PA2PTE(pagetable) | PTE_V; 
    }
  }
  // è¿åç®æ é¡µè¡¨é¡¹å°å
  return &amp;pagetable[PX(*l, va)]; 
}
#endif
</code></pre>
<p>â	8ãæ·»å <code>uvmcopy</code>å½æ°ã</p>
<pre><code class="language-c">int
uvmcopy(pagetable_t old, pagetable_t new, uint64 sz)
{
  pte_t *pte;
  uint64 pa, i;
  uint flags;
  char *mem;
  int szinc;

  for(i = 0; i &lt; sz; i += szinc){
    szinc = PGSIZE;
#ifdef LAB_PGTBL
    int l = 0; // æ å¿åé ç¨äºç¡®å®æ¯æ®éé¡µè¿æ¯è¶çº§é¡µ
    if((pte = superwalk(old, i, 0, &amp;l)) == 0)
      // å¦ææ¯è¶çº§é¡µl=1,æ®éé¡µl=0
      panic("uvmcopy: pte should exist");
#else
    if((pte = walk(old, i, 0)) == 0)
      panic("uvmcopy: pte should exist");
#endif
    if((*pte &amp; PTE_V) == 0)
      panic("uvmcopy: page not present");
    pa = PTE2PA(*pte);
    flags = PTE_FLAGS(*pte);
#ifdef LAB_PGTBL
    if(l == 1) { 
      // å¦ææ¯è¶çº§é¡µåå°å°åå¢éè®¾ç½®ä¸ºè¶çº§é¡µçå¤§å°
      szinc = SUPERPGSIZE;
      // åéè¶çº§é¡µå¤§å°çåå­
      if((mem = superalloc()) == 0)
        goto err;
      // å°è¶çº§é¡µå¤§å°çç©çåå­ä»æ§å°åå¤å¶å°æ°åéçåå­å°åï¼ç¶è¿ç¨çæ°æ®è´è´£ç»å­è¿ç¨ï¼
      memmove(mem, (char*)pa, SUPERPGSIZE); 
      // å°è¶çº§é¡µå¤§å°çæ°åå­æ å°å°æ°é¡µè¡¨çèæå°å
      if(mappages(new, i, SUPERPGSIZE, (uint64)mem, flags) != 0){ 
        // éæ¾ä¹ååéçè¶çº§é¡µåå­
        superfree(mem); 
        goto err;
      }
    } else { 
      // å¦ææ¯æ®éé¡µ
#endif
    if((mem = kalloc()) == 0)
      goto err;
    memmove(mem, (char*)pa, PGSIZE);
    if(mappages(new, i, PGSIZE, (uint64)mem, flags) != 0){
      kfree(mem);
      goto err;
    }
#ifdef LAB_PGTBL
    }
#endif
  }
  return 0;

 err:
  uvmunmap(new, 0, i / PGSIZE, 1);
  return -1;
}
</code></pre>
<h2 id="åå¨åé¢">åå¨åé¢</h2>
<p>â	è¿ä¸labï¼å°¤å¶æ¯æåç<strong>ç¨æ·é¡µè¡¨lab</strong>ç¡®å®éå¸¸é¾ï¼ä¸å¼å§è±è´¹äºå¥½é¿æ¶é´é½æ²¡ååºæ¥ï¼å¥½å¨ç½ç»ä¸æå¾å¤å¤§ä½¬å¯¹è¯¥labè¿è¡äºè®²è§£åæä¾äºæåä»£ç ï¼ä½¿å¾æ¬äººå¨åç»­çç ç©¶ä¸­æå¾ä»¥æç½è¯¥labçåºå±é»è¾ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.002777777777777778" data-date-updated="2026-02-09 21:25">2026-02-09 21:21</span>&nbsp;
<a href="https://www.cnblogs.com/xiaobai1523">å°ç½åå­¦_C</a>&nbsp;
éè¯»(<span id="post_view_count">9</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19596981);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19596981', targetLink: 'https://www.cnblogs.com/xiaobai1523/p/19596981', title: 'Lab3-page tables  &amp;amp;&amp;amp; MIT6.1810æä½ç³»ç»å·¥ç¨ãæç»­æ´æ°ã' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>