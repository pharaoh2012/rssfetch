<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2025-12-30T04:36:51.199Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ è®© AI åææ 3 å¹´ååçä»£ç ï¼å¨æ¯æ¼æ´ï¼ ]]></title>
    <link>https://www.cnblogs.com/yupi/p/19420512</link>
    <guid>e624b3ac76e0e99f7f1a466fd162a8b5</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yupi/p/19420512" title="åå¸äº 2025-12-30 11:48">
    <span role="heading" aria-level="2">è®© AI åææ 3 å¹´ååçä»£ç ï¼å¨æ¯æ¼æ´ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/2225420/202512/2225420-20251230112305334-1414820438.png" alt="è®© AI åææ 3 å¹´ååçä»£ç ï¼å¨æ¯æ¼æ´ï¼" class="desc_img">
        å¯¹äºä¸ªäººå¼åèæ¥è¯´ï¼è¿ç±»å·¥å·å¯ä»¥å¸®ä½ å¨æäº¤ä»£ç ååç°æ½å¨é®é¢ï¼æ¿æ¥æ£æµä¸ä¸èªå·±ä¹åçèé¡¹ç®ä»£ç ä¹æ¯ä¸éçï¼å¯¹äºå¢éæ¥è¯´ï¼å¯ä»¥æ AI æ¥å¥å° CI/CD æµç¨ä¸­ï¼èªå¨åä»£ç å®å¨æ£æ¥ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p class="md-end-block md-heading"><span class="md-plain">å¤§å®¶å¥½ï¼ä¿ºæ¯ç¨åºåé±¼ç®ãæè¿é GitHub çæ¶åï¼åç°äºä¸ä¸ªæºææ½åçå¼æºé¡¹ç® ââ DeepAuditï¼è®© AI å¸®ä½ ææé¡¹ç®æ¼æ´ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766890155845-c8a8541d-70ee-4a09-9fa3-bacc4930980c.png"><img data-src="https://pic.yupi.icu/1/1766890155845-c8a8541d-70ee-4a09-9fa3-bacc4930980c.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">å¿å¤´å¾çåï¼ç­ç­æ¶é´å°±æ¶¨äºä¸å° starï¼çè¿ star è¶å¿å¾ï¼</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766890171350-baeb457c-b7f4-4b61-b30e-327d500fcc0a.png"><img data-src="https://pic.yupi.icu/1/1766890171350-baeb457c-b7f4-4b61-b30e-327d500fcc0a.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">è¿æ¯ä¸ä¸ª AI ä»£ç å®¡è®¡å·¥å·ï¼è½èªå¨åæä½ çä»£ç ï¼æ¾åºæ½å¨çå®å¨æ¼æ´åä»£ç é®é¢ã</span></p>
<p class="md-end-block md-p"><span class="md-plain">ä½èå¾è´´å¿å°æä¾äºå¨çº¿ä½éªçï¼å¯ä»¥ç´æ¥ä½¿ç¨ï¼å½ç¶ä¹æ¯ææ¬å°é¨ç½²ãä¸é¢é±¼ç®ä»¥ä½èé¨ç½²çå¨çº¿ä½éªçï¼å¸¦å¤§å®¶ä½éªä¸ä¸è¿ä¸ªé¡¹ç®çåè½ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766293652932-7a2c7184-2236-4ec7-b759-077aa2c3929a.png"><img data-src="https://pic.yupi.icu/1/1766293652932-7a2c7184-2236-4ec7-b759-077aa2c3929a.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">é¦åéè¦éç½®èªå·±çå¤§æ¨¡å API Keyï¼å½åçå¾å¤å¤§æ¨¡åé½æ¯æï¼</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766293615819-08e4558c-28ab-4830-91e5-4cfc3434013b.png"><img data-src="https://pic.yupi.icu/1/1766293615819-08e4558c-28ab-4830-91e5-4cfc3434013b.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">å¦ææ³ç´æ¥å¯¼å¥å¹¶åæä½ å¨ GitHub ä¸çé¡¹ç®ï¼èä¸æ¯æå¨ä¸ä¼ ä»£ç ï¼é£ä¹è¿éè¦éç½® GitHub Tokenï¼è®©å·¥å·è½å¤è¯»åå°ä½ çä»åºä»£ç ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766293368966-7a52a142-d359-499b-8a4c-b1018acc692d.png"><img data-src="https://pic.yupi.icu/1/1766293368966-7a52a142-d359-499b-8a4c-b1018acc692d.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">å¯ä»¥å¨ GitHub ä¸çæä¸ä¸ªæ°ç Tokenï¼</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766293465724-59185e9e-8617-4cbb-aae9-6375cf213d59.png"><img data-src="https://pic.yupi.icu/1/1766293465724-59185e9e-8617-4cbb-aae9-6375cf213d59.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">éç½®å¥½ä¹åï¼å°±å¯ä»¥åå»ºä¸ä¸ªè¦åæçé¡¹ç®äºï¼ä»åºå°åè¦å¡«åæ­£ç¡®ãè¿éé±¼ç®æ¿èªå·± 3 å¹´ååçä¸ªäººå¼æºé¡¹ç® ââ SQL ä»£ç åæ°æ®çæå¨è¯è¯æ°´ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766293350054-c2c6e239-664f-434b-959c-eeebca8eb416.png"><img alt="åå»ºæ°é¡¹ç®" data-src="https://pic.yupi.icu/1/1766293350054-c2c6e239-664f-434b-959c-eeebca8eb416.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">ç¶åæ°å»ºä¸ä¸ªå®¡è®¡ä»»å¡ï¼</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766293359433-bc4f7593-0a0b-4810-8c3c-ff5c6c13abc4.png"><img data-src="https://pic.yupi.icu/1/1766293359433-bc4f7593-0a0b-4810-8c3c-ff5c6c13abc4.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">å¡«åè¦åæçåæ¯ï¼è¿å¯ä»¥è®¾ç½®ä¸äºæä»¶æé¤è§åï¼æ¯å¦æé¤ <span class="md-pair-s"><code>node_modules</code><span class="md-plain">ãæµè¯æä»¶ç­ã</span></span></span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766293382731-bc1d83f3-15b2-4549-b482-7f9ff6931f50.png"><img data-src="https://pic.yupi.icu/1/1766293382731-bc1d83f3-15b2-4549-b482-7f9ff6931f50.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">ç¹å»å¼å§åæï¼AI å°±å±é¢ å¿å±é¢ å¿å¹²æ´»äº~</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766293891399-bf6b9ed8-f9fa-470b-80b0-2817a1944a14.png"><img data-src="https://pic.yupi.icu/1/1766293891399-bf6b9ed8-f9fa-470b-80b0-2817a1944a14.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">æå»ï¼ç«ç¶åç°äº 123 ä¸ªé®é¢ï¼ï¼</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766293852195-aa65d8f7-1d4e-4117-ae84-4cf0b74cdd53.png"><img data-src="https://pic.yupi.icu/1/1766293852195-aa65d8f7-1d4e-4117-ae84-4cf0b74cdd53.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">ä¸è¿è½ååº 123 ä¸ªé®é¢ï¼ææè§èªå·±ä¹æ¯æºåå®³çåååã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/image-20251228110245704.png"><img data-src="https://pic.yupi.icu/1/image-20251228110245704.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">è¿å¥ä»»å¡è¯¦æé¡µé¢ï¼æåè¦ççé½æ¯ä»ä¹é®é¢ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766294419890-495fccc5-73b6-41cf-94c5-eb0cc2a8e044.png"><img data-src="https://pic.yupi.icu/1/1766294419890-495fccc5-73b6-41cf-94c5-eb0cc2a8e044.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">åççæä¸¥éç ââ SQL æ³¨å¥æ¼æ´ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766294403395-e0b4384f-043b-4f0c-ab84-e8d3fc031d13.png"><img data-src="https://pic.yupi.icu/1/1766294403395-e0b4384f-043b-4f0c-ab84-e8d3fc031d13.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">AI çè§£éè¿æºå°ä½çï¼ç¡®å®å­å¨ SQL æ³¨å¥é£é©ãå½æ¶è¿ä¹åçº¯å±å¾æ¹ä¾¿ï¼æ²¡æ³å°è¢« AI ä¸ç¼çç©¿äºã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766294522626-f3d896e0-e504-42f5-9c66-7e3fe3113efd.png"><img data-src="https://pic.yupi.icu/1/1766294522626-f3d896e0-e504-42f5-9c66-7e3fe3113efd.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">ä¸äºå°ç»èä¹è¢«æåºæ¥äºï¼æ¯å¦ç¡¬ç¼ç ãå¼å¸¸å¤çä¸å¤å®åãæ¥å¿è®°å½ä¸è§èç­ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766294568168-d9a1e79a-b081-413e-86c6-9fe962cba9ee.png"><img data-src="https://pic.yupi.icu/1/1766294568168-d9a1e79a-b081-413e-86c6-9fe962cba9ee.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">ä¸è¿ä¹æä¸äºè¯¯æ¥ï¼AI ææ­£å¸¸çä»£ç é»è¾å¤æ­æäºé®é¢ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766294642941-3c50a496-f1ae-4f9c-97d2-c53c815d91fd.png"><img data-src="https://pic.yupi.icu/1/1766294642941-3c50a496-f1ae-4f9c-97d2-c53c815d91fd.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">æ»ä½æ¥è¯´ï¼è¿ä¸ªå·¥å·è¿æè¿æ­¥ç©ºé´ï¼ä½å·²ç»å¾å®ç¨äºãæ­£å¥½æä»¬å¢ééè¦è¿æ ·çä»£ç å®¡è®¡å·¥å·ï¼è¿æ¯æºæå¾ä½èè½è¿ä¸æ­¥å®åçã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766294767600-1b040934-3a67-4983-8d27-38c06508814e.png"><img data-src="https://pic.yupi.icu/1/1766294767600-1b040934-3a67-4983-8d27-38c06508814e.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">å®¡è®¡å®æåï¼è¿å¯ä»¥ç´æ¥å¯¼åºæ¥åï¼</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766294119958-f47c9cc6-c871-4505-8192-c309b86b2fef.png"><img data-src="https://pic.yupi.icu/1/1766294119958-f47c9cc6-c871-4505-8192-c309b86b2fef.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">ä¸ä¸å­å°±å¾å°äºæ´æ´ 70 å¤é¡µçä¸ä¸æ¥åï¼</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766294291323-c09b4ead-e084-4fd2-9b02-50df2c35220a.png"><img data-src="https://pic.yupi.icu/1/1766294291323-c09b4ead-e084-4fd2-9b02-50df2c35220a.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">æ³æ³æå¤§å­¦çæ¶ååè¯¾è®¾ä½ä¸ï¼è¦æ¯æ AI å¸®å¿çæè¿ç§æ¥åï¼ä¸å¾ç½é£è¾¹å­äºï¼</span></p>
<p class="md-end-block md-p"><span class="md-plain">é¤äºé¡¹ç®å®¡è®¡ï¼ä½èè¿æä¾äºå³æ¶åæåè½ãä¸è¿è¿ä¸ªå°±æ²¡ä»ä¹æ°æäºï¼æä»¬å¢éç <span class="md-meta-i-c  md-link"><a href="https://codecopy.cn/" rel="noopener nofollow"><span class="md-plain">ä»£ç å°æ</span></a><span class="md-plain">å¨ 24 å¹´åå°±å·²ç»ä¸çº¿äºè¿ä¸ªåè½ã</span></span></span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766293773091-5aa2145b-bbe7-45f6-a935-cd933a485c0d.png"><img data-src="https://pic.yupi.icu/1/1766293773091-5aa2145b-bbe7-45f6-a935-cd933a485c0d.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">æä½éªè¿ä¸ªé¡¹ç®çæ¶åï¼è¿æå¾å¤åè½æ²¡åå®ï¼ä¸è¿è¿ä¹æ¯ MVP æå°å¯è¡äº§ååååï¼å¿«ééªè¯æ³æ³æéè¦ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766293932749-481edb10-ce36-465c-9f35-0c115288048c.png"><img data-src="https://pic.yupi.icu/1/1766293932749-481edb10-ce36-465c-9f35-0c115288048c.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">å¼å¾ä¸æçæ¯ï¼ä½èæ´æ°éå¸¸é¢ç¹ãæªæ­¢å°ç®åï¼é¡¹ç®çé¢å·²ç»çç¶ä¸æ°äºï¼æ´ææå®¢èå¿ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766890324400-f74560b6-eb99-4482-842e-9beb25bdac10.png"><img data-src="https://pic.yupi.icu/1/1766890324400-f74560b6-eb99-4482-842e-9beb25bdac10.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">å¨å®¡è®¡æµæ¥å¿é¡µé¢å¯ä»¥çå° AI æèåæçè¿ç¨ï¼</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766890344124-864fe6c9-7aa1-46f8-b0a3-6c492d86e6c4.png"><img data-src="https://pic.yupi.icu/1/1766890344124-864fe6c9-7aa1-46f8-b0a3-6c492d86e6c4.png" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">è¿ææºè½ä»ªè¡¨çï¼å¯ä»¥ç´è§å°çå°ä»£ç è´¨éè¶å¿ï¼</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/1766890353762-cde9026b-aab8-4230-a531-09a9cde76adf.png"><img data-src="https://pic.yupi.icu/1/1766890353762-cde9026b-aab8-4230-a531-09a9cde76adf.png" class="lazyload"></span></p>
<p class="md-end-block md-p">&nbsp;</p>
<h2 class="md-end-block md-heading"><span class="md-plain">æå</span></h2>
<p class="md-end-block md-p"><span class="md-plain">è¿ä¸ªé¡¹ç®çå®ç°æè·¯å¶å®æºå¼å¾å­¦ä¹ çãéè¿è°ç¨å¤§æ¨¡åç APIï¼è®© AI çè§£ä»£ç é»è¾ï¼ç¶åæ ¹æ®å¸¸è§çå®å¨æ¼æ´æ¨¡å¼åæä½³å®è·µè¿è¡åæï¼æåçæç»æåçå®¡è®¡æ¥åãæ´ä¸ªæµç¨å AI ä»£ç å®¡æ¥æ¯ç±»ä¼¼çï¼ä½æ´ä¸æ³¨äºå®å¨æ¼æ´çåç°ã</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/zy/640-20251230112201900"><img alt="DeepAudit æ¶æå¾" data-src="https://pic.yupi.icu/zy/640-20251230112201900" class="lazyload"></span></p>
<p class="md-end-block md-p"><span class="md-plain">å¯¹äºä¸ªäººå¼åèæ¥è¯´ï¼è¿ç±»å·¥å·å¯ä»¥å¸®ä½ å¨æäº¤ä»£ç ååç°æ½å¨é®é¢ï¼æ¿æ¥æ£æµä¸ä¸èªå·±ä¹åçèé¡¹ç®ä»£ç ä¹æ¯ä¸éçï¼å¯¹äºå¢éæ¥è¯´ï¼å¯ä»¥æ AI æ¥å¥å° CI/CD æµç¨ä¸­ï¼èªå¨åä»£ç å®å¨æ£æ¥ãè½ç¶æ¬é¡¹ç®ææ¶è¿æè¯¯æ¥ï¼ä½éç AI è½åçæåï¼ä»¥åä½èå¨é¢åç¥è¯æ¹é¢çå¡«åï¼ç¸ä¿¡ä¼è¶æ¥è¶åç¡®ã</span></p>
<p class="md-end-block md-p"><span class="md-plain">æ¥è¯è¯çï¼ä½ çé¡¹ç®ä»£ç éæå¤å°ä¸ª Bugï¼</span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://pic.yupi.icu/1/wechat_2025-12-12_121451_634.png"><img data-src="https://pic.yupi.icu/1/wechat_2025-12-12_121451_634.png" class="lazyload"></span></p>
<h2 class="md-end-block md-heading"><span class="md-plain">æ´å¤ç¼ç¨å­¦ä¹ èµæº</span></h2>
<ul class="ul-list" data-mark="-">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/course" rel="noopener nofollow"><span class="md-plain">Javaåç«¯ç¨åºåå¿åé¡¹ç®å®ææç¨+æ¯è®¾ç½ç«</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/" rel="noopener nofollow"><span class="md-plain">ç¨åºååè´¹ç¼ç¨å­¦ä¹ äº¤æµç¤¾åºï¼èªå­¦å¿å¤ï¼</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/course/cv" rel="noopener nofollow"><span class="md-plain">ç¨åºåä¿å§çº§æ±èåç®åæåï¼æ¾å·¥ä½å¿å¤ï¼</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.mianshiya.com/" rel="noopener nofollow"><span class="md-plain">ç¨åºååè´¹é¢è¯å·é¢ç½ç«å·¥å·ï¼æ¾å·¥ä½å¿å¤ï¼</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640584449888772098" rel="noopener nofollow"><span class="md-plain">ææ°Javaé¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + Javaæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640586673306091521" rel="noopener nofollow"><span class="md-plain">ææ°Pythoné¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + Pythonæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640586014108303362" rel="noopener nofollow"><span class="md-plain">ææ°åç«¯é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + åç«¯æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640586867363954689" rel="noopener nofollow"><span class="md-plain">ææ°æ°æ®ç»æåç®æ³é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + ç®æ³æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1644279832026075138" rel="noopener nofollow"><span class="md-plain">ææ°C++é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ãC++æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1641797333479903234" rel="noopener nofollow"><span class="md-plain">ææ°æ°æ®åºé¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + æ°æ®åºæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640589994284695553" rel="noopener nofollow"><span class="md-plain">ææ°Redisé¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + Redisæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1641035880439271426" rel="noopener nofollow"><span class="md-plain">ææ°è®¡ç®æºåºç¡å¥é¨å­¦ä¹ è·¯çº¿ + è®¡ç®æºåºç¡æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1641366118197153793" rel="noopener nofollow"><span class="md-plain">ææ°å°ç¨åºå¥é¨å­¦ä¹ è·¯çº¿ + å°ç¨åºå¼åæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="http://sqlmother.yupi.icu/" rel="noopener nofollow"><span class="md-plain">ææ°SQLé¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + SQLæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640586295529324545" rel="noopener nofollow"><span class="md-plain">ææ°Linuxé¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + Linuxæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640588753362108417" rel="noopener nofollow"><span class="md-plain">ææ°Git/GitHubé¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + Gitæç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640587909942099969" rel="noopener nofollow"><span class="md-plain">ææ°æä½ç³»ç»é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + æä½ç³»ç»æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640588119619551233" rel="noopener nofollow"><span class="md-plain">ææ°è®¡ç®æºç½ç»é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + è®¡ç®æºç½ç»æç¨</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-meta-i-c  md-link"><a href="https://www.code-nav.cn/post/1640588392073150465" rel="noopener nofollow"><span class="md-plain">ææ°è®¾è®¡æ¨¡å¼é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + è®¾è®¡æ¨¡å¼æç¨</span></a></span></p>
</li>
<li class="md-list-item md-focus-container">
<p class="md-end-block md-p md-focus"><span class="md-meta-i-c md-link md-expand"><a href="https://www.code-nav.cn/post/1640648711119892481" rel="noopener nofollow"><span class="md-plain">ææ°è½¯ä»¶å·¥ç¨é¶åºç¡å¥é¨å­¦ä¹ è·¯çº¿ + è½¯ä»¶å·¥ç¨æç¨</span></a></span></p>
</li>
</ul>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-30 11:49">2025-12-30 11:48</span>&nbsp;
<a href="https://www.cnblogs.com/yupi">ç¨åºåé±¼ç®</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19420512);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19420512', targetLink: 'https://www.cnblogs.com/yupi/p/19420512', title: 'è®© AI åææ 3 å¹´ååçä»£ç ï¼å¨æ¯æ¼æ´ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ææ¡Fetchä¸Flaskäº¤äºï¼è®©åç«¯è¡¨åæäº¤æ´ä¼éçå¨æä¹é ]]></title>
    <link>https://www.cnblogs.com/ymtianyu/p/19418995</link>
    <guid>52285023aae08ab93f52b581fbeb15d0</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ymtianyu/p/19418995" title="åå¸äº 2025-12-30 08:18">
    <span role="heading" aria-level="2">ææ¡Fetchä¸Flaskäº¤äºï¼è®©åç«¯è¡¨åæäº¤æ´ä¼éçå¨æä¹é</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æè¯¦ç»è§£æäºåç«¯Fetch APIçå·¥ä½åçä¸å¸¸è§ç¨æ³ï¼å¹¶éç¹éè¿°äºå¶å¦ä½ä¸Python Flaskåç«¯æ¡æ¶ååå·¥ä½ãéè¿ç»å½éå®åãæ°æ®å¨æå¢å æ¹æ¥ç­å·ä½åºæ¯ï¼æ¼ç¤ºäºå¦ä½å®ç°æ å·æ°äº¤äºä½éªãæç« æä¾äºååç«¯éå¥çä»£ç ç¤ºä¾ï¼è®²è§£äºå¦ä½å¤çJSONãææ¬ç­ä¸åæ ¼å¼çååºï¼ä»¥åå¦ä½æ ¹æ®ååºç¶ææ´æ°ç¨æ·çé¢ï¼ä¸ºæå»ºç°ä»£Webåºç¨æä¾äºå®ç¨æåã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; line-height: 1.7; color: rgba(61, 61, 61, 1); font-size: 16px; padding: 0 15px">
<h1 style="font-size: 22px; line-height: 1.4; margin-top: 0; margin-bottom: 15px; font-weight: bold; color: rgba(26, 26, 26, 1)">è¿å¨ä¸ºè¡¨åæäº¤åé¡µé¢å·æ°ç¦æ¼ï¼ä¸ææå®Fetchä¸Flaskçæ ç¼äº¤äº</h1>
<p style="font-size: 15px; color: rgba(127, 140, 141, 1); margin-bottom: 20px; border-left: 3px solid rgba(74, 144, 226, 1); padding-left: 12px; font-style: italic">æ¬æå¸¦ä½ æ·±å¥çè§£ç°ä»£åç«¯ Fetch API çå·¥ä½åçï¼å¹¶ææææä½ å¦ä½ä¸ Flask åç«¯ä¼éç»åï¼å®ç°æ å·æ°ç»å½ãæ°æ®å¨æå¢å æ¹æ¥ç­äº¤äºã<br>äº®ç¹åæ¬ï¼Fetch æ ¸å¿åçåæãç»å½éå®åçå¼æ­¥å¤çãå©ç¨ååºç¶æç å¨ææ´æ°UIãä»¥åå¦ä½å¤çJSON/ææ¬ç­ä¸åæ ¼å¼çè¿åæ°æ®ã<br><br><span style="font-weight: bold">ä½ å°å­¦å°ï¼</span><br>- Fetch API çâæ¿è¯ºâæºå¶ä¸åºç¡ç¨æ³<br>- å¦ä½ç¨ Flask æå»º RESTful é£æ ¼ç API ç«¯ç¹<br>- ç»å½è¡¨åæäº¤ï¼åå«ä¼ ç»è¡¨åå·æ°ï¼å®ç°å¹³æ»è·³è½¬<br>- æ°æ®æä½ï¼åç«¯ä¸ä¸ªè¯·æ±ï¼åç«¯å¤çï¼åç«¯UIå³æ¶ååº<br>- æ ¹æ®åç«¯è¿åçä¸åæ°æ®ç±»åï¼JSON/Textï¼è¿è¡ç²¾åå¤ç</p>
<h2 style="font-size: 18px; font-weight: bold; color: rgba(44, 62, 80, 1); border-bottom: 1px solid rgba(238, 238, 238, 1); padding-bottom: 8px; margin-top: 30px; margin-bottom: 15px">â¨ ç®å½</h2>
<p>1. åè¯Fetchï¼ç°ä»£Webçéä¿¡ä¿¡ä½¿<br>2. ð ï¸ å®æåå¤ï¼Flaskåç«¯çç®åéç½®<br>3. ð åºæ¯ä¸ï¼ç»å½è¡¨åæäº¤ä¸é¡µé¢éå®å<br>4. â¨ åºæ¯äºï¼å¨ææ°å¢ä¸ä¿®æ¹æ°æ®<br>5. ð¦ åºæ¯ä¸ï¼å¤çä¸åç±»åçååºæ°æ®<br>6. ð» å®æ´ä»£ç åèä¸æ»ç»</p>
<h2 style="font-size: 20px; font-weight: bold; color: rgba(44, 62, 80, 1); margin-top: 35px; margin-bottom: 15px">1. åè¯Fetchï¼ç°ä»£Webçéä¿¡ä¿¡ä½¿</h2>
<p><code>fetch()</code> æ¯æµè§å¨æä¾çãåºäº <strong style="color: rgba(186, 55, 42, 1)">Promise</strong> çç°ä»£ç½ç»è¯·æ±APIãå®åä»£äºå¤èç XMLHttpRequestï¼è®©å¼æ­¥æ°æ®è¯·æ±åå¾æ¸æ°ãç®æ´ãä½ å¯ä»¥æå®æ³è±¡æä¸ä¸ªä¸ä¸çâä¿¡ä½¿âã</p>
<p>å®çåºæ¬å·¥ä½æµç¨æ¯ï¼ä½ ç»ä¿¡ä½¿ï¼fetchï¼ä¸ä¸ªå°åï¼URLï¼åæç¤ºï¼éç½®å¯¹è±¡ï¼ï¼å®ç«å»è¿åä¸ä¸ªâæ¿è¯ºæ¶æ®âï¼Promiseï¼ãè¿ä¸ªæ¿è¯ºæç»ä¼åç°ä¸ºâååºåè£¹âï¼Responseå¯¹è±¡ï¼ï¼ä½ éè¦æå¼è¿ä¸ªåè£¹ï¼è°ç¨å¦.json(), .text()ç­æ¹æ³ï¼æè½æ¿å°éé¢ççå®æ°æ®ã</p>
<pre class="language-javascript highlighter-hljs"><code>// ä¸ä¸ªæç®åçGETè¯·æ±ç¤ºä¾
fetch('/api/data')
  .then(response =&gt; response.json()) // æå¼åè£¹ï¼è§£æJSONæ°æ®
  .then(data =&gt; console.log(data))   // å¤ççå®æ°æ®
  .catch(error =&gt; console.error('åºéå¦ï¼', error)); // å¤çéè¯¯</code></pre>
<h2 style="font-size: 20px; font-weight: bold; color: rgba(44, 62, 80, 1); margin-top: 35px; margin-bottom: 15px">2. ð ï¸ å®æåå¤ï¼Flaskåç«¯çç®åéç½®</h2>
<p>ä¸ºäºè®©åç«¯Fetchè½é¡ºå©ä¸åç«¯âå¯¹è¯âï¼æä»¬éè¦ä¸ä¸ªè½å¤çJSONãå¹¶è½è¿è¡è·¨åèµæºå±äº«ï¼CORSï¼çFlaskåºç¨ãé¦åï¼å®è£å¿è¦åºï¼</p>
<pre class="language-python highlighter-hljs"><code>pip install flask flask-cors</code></pre>
<p>æ¥çï¼æ­å»ºä¸ä¸ªåºç¡çåç«¯æå¡ï¼</p>
<pre class="language-python highlighter-hljs"><code>from flask import Flask, request, jsonify
from flask_cors import CORS

app = Flask(__name__)
CORS(app)  # åè®¸åç«¯è·¨åè¯·æ±ï¼å¼åæ¶éå¸¸æ¹ä¾¿

# æä»¬å°å¨åç»­åºæ¯ä¸­éæ­¥å¡«åè¿ä¸ªappçè·¯ç±
if __name__ == '__main__':
    app.run(debug=True)</code></pre>
<h2 style="font-size: 20px; font-weight: bold; color: rgba(44, 62, 80, 1); margin-top: 35px; margin-bottom: 15px">3. ð åºæ¯ä¸ï¼ç»å½è¡¨åæäº¤ä¸é¡µé¢éå®å</h2>
<p>ä¼ ç»è¡¨åæäº¤ä¼å·æ°é¡µé¢ï¼ä½éªå²è£ãä½¿ç¨Fetchï¼æä»¬å¯ä»¥å®ç°æ å·æ°ç»å½ï¼å¹¶æ ¹æ®åç«¯æä»¤è¿è¡åç«¯è·¯ç±è·³è½¬ã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">åç«¯ (JavaScript)</strong>ï¼æ¦æªè¡¨åæäº¤äºä»¶ï¼ä½¿ç¨Fetchåéæ°æ®ã</p>
<pre class="language-javascript highlighter-hljs"><code>document.getElementById('loginForm').addEventListener('submit', function(event) {
    event.preventDefault(); // é»æ­¢è¡¨åé»è®¤æäº¤è¡ä¸º

    const formData = new FormData(this);
    // æèå°æ°æ®è½¬æ¢ä¸ºJSON: JSON.stringify(Object.fromEntries(formData))

    fetch('/api/login', {
        method: 'POST',
        body: formData, // åéFormDataå¯¹è±¡
        // headers: { 'Content-Type': 'application/json' }, // å¦æåéJSONéè®¾ç½®æ­¤header
    })
    .then(response =&gt; response.json()) // è§£æåç«¯è¿åçJSON
    .then(result =&gt; {
        if (result.success) {
            // ç»å½æåï¼ä½¿ç¨åç«¯è·¯ç±è·³è½¬ï¼èéåç«¯éå®å
            window.location.href = result.redirect_url || '/dashboard';
        } else {
            // ç»å½å¤±è´¥ï¼å¨ææ´æ°é¡µé¢ä¸çéè¯¯æç¤ºåç´ 
            document.getElementById('error-msg').textContent = result.message;
        }
    })
    .catch(error =&gt; console.error('Error:', error));
});</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">åç«¯ (Flask)</strong>ï¼éªè¯æ°æ®ï¼è¿ååå«ç¶æåæä»¤çJSONï¼èä¸æ¯ç´æ¥è¿åéå®åçHTMLã</p>
<pre class="language-python highlighter-hljs"><code>@app.route('/api/login', methods=['POST'])
def login():
    username = request.form.get('username')
    password = request.form.get('password')

    # è¿éåºæ¯ä½ çéªè¯é»è¾ï¼ä¾å¦æ¥è¯¢æ°æ®åº
    if username == 'admin' and password == 'secret':
        # è¿åæåç¶æååç«¯è·³è½¬å°å
        return jsonify({'success': True, 'redirect_url': '/dashboard'})
    else:
        # è¿åå¤±è´¥ç¶æåéè¯¯ä¿¡æ¯
        return jsonify({'success': False, 'message': 'ç¨æ·åæå¯ç éè¯¯'}), 401</code></pre>
<h2 style="font-size: 20px; font-weight: bold; color: rgba(44, 62, 80, 1); margin-top: 35px; margin-bottom: 15px">4. â¨ åºæ¯äºï¼å¨ææ°å¢ä¸ä¿®æ¹æ°æ®</h2>
<p>å¨ç®¡çç³»ç»ä¸­ï¼æ°å¢æä¿®æ¹ä¸æ¡æ°æ®åï¼æä»¬å¸æåè¡¨è½ç«å³æ´æ°ï¼èæ éå·æ°æ´ä¸ªé¡µé¢ã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">æ ¸å¿æè·¯</strong>ï¼Fetchè¯·æ±æååï¼å¨<code>.then()</code>ä¸­æ ¹æ®åç«¯è¿åçææ°æ°æ®ï¼ç´æ¥æä½DOMæ´æ°UIã</p>
<pre class="language-javascript highlighter-hljs"><code>// åè®¾æä¸ä¸ªä¿å­æé®ï¼ç¨äºæäº¤æ°å¢æä¿®æ¹çæ°æ®
saveButton.addEventListener('click', () =&gt; {
    const itemData = { title: 'æ°é¡¹ç®', status: 'active' };

    fetch('/api/items', {
        method: 'POST', // æ°å¢ç¨POSTï¼ä¿®æ¹å¯è½æ¯PUTæPATCH
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(itemData)
    })
    .then(response =&gt; response.json())
    .then(newItem =&gt; {
        // å³é®æ­¥éª¤ï¼è¯·æ±æååï¼å¨ææ´æ°åç«¯åè¡¨
        const itemList = document.getElementById('itemList');
        const newItemElement = document.createElement('li');
        newItemElement.id = `item-${newItem.id}`;
        newItemElement.innerHTML = `${newItem.title} ${newItem.status}`;
        itemList.appendChild(newItemElement);

        // æèï¼å¦ææ¯ä¿®æ¹æä½ï¼å¯ä»¥æ¾å°å¯¹åºçDOMåç´ æ´æ°å¶åå®¹
        // const oldItemElement = document.getElementById(`item-${newItem.id}`);
        // oldItemElement.innerHTML = ...;

        alert('æä½æåï¼'); // ææ´ä¼éçæç¤º
    });
});</code></pre>
<p>å¯¹åºçFlaskåç«¯éè¦è¿ååå»ºææ´æ°åçå®æ´æ°æ®å¯¹è±¡ï¼ä»¥ä¾¿åç«¯ä½¿ç¨ã</p>
<h2 style="font-size: 20px; font-weight: bold; color: rgba(44, 62, 80, 1); margin-top: 35px; margin-bottom: 15px">5. ð¦ åºæ¯ä¸ï¼å¤çä¸åç±»åçååºæ°æ®</h2>
<p>åç«¯å¯è½è¿åJSONï¼ä¹å¯è½è¿åçº¯ææ¬æHTMLçæ®µãFetchçResponseå¯¹è±¡æä¾äºä¸åçæ¹æ³æ¥å¤çã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">å¤çJSON (æå¸¸ç¨)</strong>ï¼å¦ä¸ææç¤ºï¼ä½¿ç¨<code>response.json()</code>ã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">å¤çææ¬</strong>ï¼ä¾å¦åç«¯è¿åä¸ä¸ªç®åçæåæ¶æ¯æCSVæ°æ®ã</p>
<pre class="language-javascript highlighter-hljs"><code>fetch('/api/export')
  .then(response =&gt; response.text())
  .then(textData =&gt; {
    console.log(textData);
    // å¤çææ¬æ°æ®...
  });</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">æ£æ¥ååºç¶æ</strong>ï¼å¨è§£ææ°æ®åï¼åæ£æ¥è¯·æ±æ¯å¦çæ­£æåæ¯ä¸ªå¥½ä¹ æ¯ã</p>
<pre class="language-javascript highlighter-hljs"><code>fetch('/api/some-data')
  .then(response =&gt; {
    if (!response.ok) { // æ£æ¥HTTPç¶æç æ¯å¦å¨200-299ä¹é´
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return response.json(); // ç¶ææ­£å¸¸æè§£æJSON
  })
  .then(data =&gt; /* å¤çæ°æ® */)
  .catch(error =&gt; /* å¤çç½ç»éè¯¯æç¶æç éè¯¯ */);</code></pre>
<h2 style="font-size: 20px; font-weight: bold; color: rgba(44, 62, 80, 1); margin-top: 35px; margin-bottom: 15px">6. ð» å®æ´ä»£ç åèä¸æ»ç»</h2>
<p>ä¸é¢æ¯ä¸ä¸ªæ´åäºç»å½åæ°å¢é¡¹ç®çè¶ç®æå®æ´ç¤ºä¾ï¼</p>
<pre class="language-python highlighter-hljs"><code># app.py (Flaskåç«¯)
from flask import Flask, request, jsonify
from flask_cors import CORS

app = Flask(__name__)
CORS(app)
items = [] # ç¨ä¸ä¸ªç®æåè¡¨æ¨¡ææ°æ®åº

@app.route('/api/login', methods=['POST'])
def login():
    data = request.get_json()
    if data.get('user') == 'demo':
        return jsonify({'success': True, 'token': 'fake-jwt-token'})
    return jsonify({'success': False}), 401

@app.route('/api/items', methods=['GET', 'POST'])
def handle_items():
    if request.method == 'GET':
        return jsonify(items)
    else: # POST
        new_item = request.get_json()
        new_item['id'] = len(items) + 1
        items.append(new_item)
        return jsonify(new_item), 201

if __name__ == '__main__':
    app.run(debug=True)</code></pre>
<pre class="language-html highlighter-hljs"><code>&lt;!-- index.html (é¨ååç«¯) --&gt;
&lt;script&gt;
// ç»å½
fetch('/api/login', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({user: 'demo', pass: 'demo'})
}).then(r =&gt; r.json()).then(console.log);

// æ°å¢é¡¹ç®å¹¶æ´æ°åè¡¨
fetch('/api/items', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({name: 'New Task'})
})
.then(r =&gt; r.json())
.then(newItem =&gt; {
    const list = document.getElementById('list');
    list.innerHTML += `&lt;li&gt;${newItem.id}: ${newItem.name}&lt;/li&gt;`;
});
&lt;/script&gt;</code></pre>
<p><strong style="color: rgba(186, 55, 42, 1)">æ»ç»ä¸ä¸</strong>ï¼Fetch + Flask çç»åï¼éè¿âè¯·æ±-ååº-JSONâçæ¨¡å¼ï¼å°ååç«¯è§£è¦ï¼è®©Webäº¤äºåå¾<strong style="color: rgba(186, 55, 42, 1)">æ´å å¨æåé«æ</strong>ã<br>å³é®å¨äºï¼åç«¯è´è´£äº¤äºåUIæ´æ°ï¼åç«¯è´è´£æ°æ®åé»è¾ï¼ä¸¤èéè¿æ¸æ°çAPIå¥çº¦è¿è¡éä¿¡ã</p>
<div style="text-align: center; margin: 40px 0"><hr style="border-top: 1px solid rgba(221, 221, 221, 1); border-right: none; border-bottom: none; border-left: none"></div>
<p style="font-size: 15px; color: rgba(85, 85, 85, 1); text-align: center">åæ¬¢æ¬æï¼ä¸è¦éè¿â¨ï¼ç¹èµðæ¶èâ­å³æ³¨æðï¼ä¸èµ·å­¦ä¹ æ´å¤æç¨çç¥è¯ï¼å®åä½ æçæè½æ ï¼ä¹è¯·è·¯è¿çå¤§ä½¬ç»äºå»ºè®®åææðð¶ï¼</p>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-30 08:19">2025-12-30 08:18</span>&nbsp;
<a href="https://www.cnblogs.com/ymtianyu">æ²å¹½</a>&nbsp;
éè¯»(<span id="post_view_count">24</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19418995);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19418995', targetLink: 'https://www.cnblogs.com/ymtianyu/p/19418995', title: 'ææ¡Fetchä¸Flaskäº¤äºï¼è®©åç«¯è¡¨åæäº¤æ´ä¼éçå¨æä¹é' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨åï¼è®¡ç®æºè§è§ ç¬¬åå¨ï¼å·ç§¯ç½ç»åºç¨ (ä¸) äººè¸è¯å« ]]></title>
    <link>https://www.cnblogs.com/Goblinscholar/p/19418306</link>
    <guid>a5dfb8b270d6e86557d0e7c16ea47827</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Goblinscholar/p/19418306" title="åå¸äº 2025-12-29 23:52">
    <span role="heading" aria-level="2">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨åï¼è®¡ç®æºè§è§ ç¬¬åå¨ï¼å·ç§¯ç½ç»åºç¨ (ä¸) äººè¸è¯å«</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ­¤åç±»ç¨äºè®°å½å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨çå­¦ä¹ ç¬è®°ã<br>
è¯¾ç¨ç¸å³ä¿¡æ¯é¾æ¥å¦ä¸ï¼</p>
<ol>
<li>åè¯¾ç¨è§é¢é¾æ¥ï¼<a href="https://www.bilibili.com/video/BV1FT4y1E74V?buvid=XU762317353676D786954061C192FE625463B&amp;from_spmid=playlist.playlist-detail.0.0&amp;is_story_h5=false&amp;mid=zqernykrmpf7XfIorMR%2FnA%3D%3D&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=ce0bc526-db69-428a-962e-c65ed8c267bc&amp;share_source=COPY&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1713085655&amp;unique_k=DfBgvFW&amp;up_id=8654113&amp;vd_source=e035e9878d32f414b4354b839a4c31a4" target="_blank" rel="noopener nofollow">[åè¯­å­å¹]å´æ©è¾¾æ·±åº¦å­¦ä¹ deeplearning.ai</a></li>
<li>githubè¯¾ç¨èµæï¼å«è¯¾ä»¶ä¸ç¬è®°:<a href="https://github.com/robbertliu/deeplearning.ai-andrewNG" target="_blank" rel="noopener nofollow">å´æ©è¾¾æ·±åº¦å­¦ä¹ æå­¦èµæ</a></li>
<li>è¯¾ç¨éå¥ç»ä¹ ï¼ä¸­è±ï¼ä¸ç­æ¡ï¼<a href="https://blog.csdn.net/u013733326/article/details/79827273" target="_blank" rel="noopener nofollow">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾åä¹ é¢ä¸ç­æ¡</a></li>
</ol>
<p>æ¬ç¯ä¸ºç¬¬åè¯¾çç¬¬åå¨åå®¹ï¼<a href="https://www.bilibili.com/video/BV1FT4y1E74V?spm_id_from=333.788.videopod.episodes&amp;vd_source=e035e9878d32f414b4354b839a4c31a4&amp;p=140" target="_blank" rel="noopener nofollow">4.1</a>å°<a href="https://www.bilibili.com/video/BV1FT4y1E74V?spm_id_from=333.788.videopod.episodes&amp;vd_source=e035e9878d32f414b4354b839a4c31a4&amp;p=144" target="_blank" rel="noopener nofollow">4.5</a>çåå®¹ã</p>
<hr>
<p>æ¬å¨ä¸ºç¬¬åè¯¾çç¬¬åå¨åå®¹ï¼è¿ä¸è¯¾ææåå®¹çä¸­å¿åªæä¸ä¸ªï¼<strong>è®¡ç®æºè§è§</strong>ãåºç¨å¨æ·±åº¦å­¦ä¹ éï¼å°±æ¯ä¸é¨ç¨æ¥è¿è¡å¾å­¦ä¹ çæ¨¡ååææ¯ï¼æ¯å¨ä¹åå¨è¿æ¥åºç¡ä¸çâç¹åâï¼ä¹æ¯ç¸å³ä¸ä¸éçä¸ä¸ªéè¦ç ç©¶å¤§ç±»ã<br>
<strong>è¿ä¸æ´èè¯¾é½å­å¨å¤§ééè¦åå¤çè§£çåå®¹åæºå¨å­¦ä¹ ãæ°å­¦åºç¡ã</strong> å æ­¤æä¼å°½å¯è½çè¡¥è¶³åºç¡ï¼ç¨æ¯å»åå®ä¾æ¥æ¼ç¤ºæ¯ä¸ªé¨åï¼ä»èå¸®å©çè§£ã<br>
ç¬¬åå¨çåå®¹æ¯å¯¹åä¸å¨åå®¹çç»¼ååºç¨ï¼ä»ç»äºä¸äºéè¿å·ç§¯ç½ç»å®ç°çå®éåºç¨ï¼å®ä»¬å¨ä½¿ç¨å·ç§¯ç½ç»çåºç¡ä¸ååæèªå·±çç¹ç¹æ¥å¹éä¸åçä»»å¡è¦æ±ï¼æ¯å¯¹<strong>å¦ä½çå®åºç¨å·ç§¯ç½ç»</strong>çè¯å¥½æ¼ç¤ºã<br>
æ¬ç¯çåå®¹å³äº<strong>äººè¸è¯å«</strong>ã</p>
<h1 id="1-äººè¸éªè¯ä¸äººè¸è¯å«">1. äººè¸éªè¯ä¸äººè¸è¯å«</h1>
<p>äººè¸éªè¯åäººè¸è¯å«æ¯ä¸¤ä¸ªç¸ä¼¼çæ¦å¿µã<br>
èå¨äººè¸è¯å«ç³»ç»ä¸­ï¼æä»¬è¯´<strong>äººè¸éªè¯æ¯äººè¸è¯å«çä¸ä¸ªåºæ¬æ¨¡å</strong>ã<br>
ç°å¨å°±æ¥å±å¼ä¸ä¸äºèçå³ç³»ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234636631-73929260.png" alt="image" loading="lazy"><br>
æä»¬å¨å¾éæå°<strong>äººè¸éªè¯æ¯ä¸ä¸ª1å¯¹1é®é¢</strong>ï¼è¿æ¯å ä¸ºå¨åå®éªè¯å¨å®å¨åç¡®çæåµä¸ï¼å®åªä¼å¯¹ä¸ä¸ªäººè¯´ âYesâ èæç»å¶ä»ææäººã<br>
å¾æ¾ç¶ï¼è¿ç§é»è¾å¨æä»¬å®éçæ´»ä¸­çå¤§å¤åºæ¯é½ä¸éç¨ï¼å¬å¸ãå®¿èçé¨ç¦ç­é½æ¯æéè¿ä¸ä¸ªæ¨¡åè¯å«å¤ä¸ªäººãèä¸æ¯ä¸ºæ¯ä¸ªäººåç¬è®¾ç½®ä¸ä¸ªé¸æºã<br>
å æ­¤ï¼æä»¬ä¾¿ç§°è¿ç§<strong>å®ç°â1å¯¹å¤âé»è¾çç¸åºä»»å¡ä¸ºäººè¸è¯å«</strong>ã<br>
æç§åæçé»è¾æ¨ä¸å»ï¼ä¸ä¸ªå¾èªç¶ãä¹å¾âæºå¨å­¦ä¹ ç´è§âçæ³æ³æ¯ï¼<strong>é£äººè¸è¯å«ä¸å°±æ¯ä¸ä¸ªå¤åç±»é®é¢åï¼</strong> åè¿æ ·ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234219889-112044451.png" alt="image.png" loading="lazy"><br>
ä½å¦æå¨å®éé¨ç½²ä¸­è¿æ ·å®ç°äººè¸è¯å«ï¼ä½ ä¼åç°è¿æ ·ä¸äºé®é¢ï¼</p>
<ol>
<li>å¦æåä½ææ°åå·¥å å¥æèåå·¥ç¦»èï¼å°±è¦<strong>éæ°è°æ´æ°æ®åç½ç»è¾åºå±ï¼éæ°è®­ç»</strong>ã</li>
<li>å½åä½è§æ¨¡è¾å¤§æ¶ï¼æ°æ®å¯è½åå«<strong>æåä¸ä¸ä¸ªç±»å«</strong>ãæ´éè¦çæ¯ï¼æ¯ä¸ªç±»å«æ°æ®éå¾å°ï¼èæ·±åº¦å­¦ä¹ å¾å¾åä¾èµäº<strong>æ°æ®é</strong>ï¼é¾éåçå¥èè¦åæå ç¾å åå¼ ç§çåï¼</li>
</ol>
<p>å æ­¤ï¼æä»¬å¾åºç»è®ºï¼å ä¸ºäººè¸è¯å«ä»»å¡å¨å®éé¨ç½²ä¸­çç¹æ®æ§ï¼è®©æä»¬ä¹åäºè§£çå¸¸è§<strong>åç±»ç®æ³å¹¶ä¸éç¨</strong>ä½ä¸ºä¸ä¸ªå¯æç»­é¨ç½²æ¹æ¡å¯¹å¶åºç¨ã</p>
<p>èå¨ç°å®çæ´»ä¸­ï¼ä½ ä¼åç°ï¼æä»¬å¨ç¸å³ç³»ç»å½å¥äººè¸æ¶ï¼<strong>å¾å¾åªéè¦ä¸å¼ è¯ä»¶ç§å³å¯</strong>ï¼è¿æ¯æä¹åå°çå¢ï¼æä»¬ç»§ç»­ã</p>
<h1 id="2-ä¸æ¬¡å­¦ä¹ one-shot-learning">2. ä¸æ¬¡å­¦ä¹ ï¼one-shot learningï¼</h1>
<p>ç»§ç»­ååçåå®¹ï¼æä»¬ä¼åç°ä¸ä¸ªçä¼¼çç¾çç°è±¡ï¼<br>
å¨å®éçäººè¸ç³»ç»ä¸­ï¼å½å¥ä¸ä¸ªæ°ç¨æ·æ¶ï¼<strong>å¾å¾åªéè¦ä¸å¼ è¯ä»¶ç§</strong>ãä½å¨æ·±åº¦å­¦ä¹ çç»éªè®¤ç¥éï¼æ¨¡åæ§è½åé«åº¦ä¾èµæ°æ®éã  <strong>è¿ä¸¤ç¹ï¼ä¸å²çªåï¼</strong></p>
<p>è¦çè§£è¿ä¸ç¹ï¼æä»¬éè¦ååå°åæâæäººè¸è¯å«å½ä½å¤åç±»é®é¢âçæè·¯ã<br>
å¨æ åçå¤åç±»ä»»å¡ä¸­ï¼<strong>åç±»æ ç­¾æ¬èº«å°±ä¸ºæ°æ®ååäºæç¡®çè¾¹ç</strong>ï¼æ¨¡ååªè½éè¿<strong>åä¸æ ç­¾ä¸çæ ·æ¬</strong>æ¥å­¦ä¹ è¯¥ç±»å«çç¹å¾ï¼èä¸åç±»å«ä¹é´çæ°æ®æ¯è¢«ä¸¥æ ¼éç¦»ä½¿ç¨çã<br>
æ­£å ä¸ºå¦æ­¤ï¼å¦æå°äººè¸è¯å«ç´æ¥å»ºæ¨¡ä¸ºâæ¯ä¸ªäººä¸ä¸ªç±»å«âï¼é£ä¹æ¨¡åè¦å­¦å¥½æä¸ä¸ªäººçç¹å¾ï¼å°±å¿ç¶éè¦<strong>å¤§éå±äºè¿ä¸ªäººçæ ·æ¬</strong>ââä¹å°±åºç°äºâè¦ç»æ¯ä¸ªäººæåçéâçä¸ç°å®è¦æ±ã</p>
<p>ä½æ¯ï¼ä½ ä¼åç°ï¼å¨äººè¸è¯å«ä»»å¡ä¸­ï¼<strong>æ»çæ°æ®éå¶å®å¹¶ä¸å°</strong>ï¼çæ­£ç¨ç¼ºçåªæ¯âæ¯ä¸ªèº«ä»½å¯¹åºçæ ·æ¬æ°éâãè¿æå³çï¼å¹¶ä¸æ¯âæ°æ®ä¸å¤âï¼èæ¯<strong>æ°æ®è¢«æ ç­¾å¼ºè¡åå²åï¼æ æ³è¢«ååå©ç¨</strong>ã</p>
<p>æ­£æ¯ç±äºè¿ç§è®¾ç½®ä¸å®éé¨ç½²åºæ¯ä¸å¹éï¼æä»¬èªç¶ä¼äº§çä¸ä¸ªæ°ççé®ï¼<strong>è½ä¸è½è®©ææäººçæ ·æ¬é½åä¸å­¦ä¹ ï¼èä¸æ¯è¢«èº«ä»½æ ç­¾åèªéç¦»å¼æ¥ï¼</strong></p>
<p>å¨æºå¨å­¦ä¹ ä¸­ï¼è¿ç±»â<strong>æ¯ä¸ªç±»å«åªææå°æ ·æ¬</strong>âçé®é¢è¢«ç§°ä¸º<strong>ä¸æ¬¡å­¦ä¹ ï¼one-shot learningï¼é®é¢</strong>ã<br>
èå¨å·ä½çäººè¸è¯å«åºæ¯ä¸ï¼<strong>one-shot äººè¸è¯å«</strong>æçæ¯ï¼æ¯ä¸ªèº«ä»½å¨è®­ç»æå»ºåºé¶æ®µï¼ä»æä¾ä¸å¼ ï¼ææå°å å¼ ï¼å·²ç¥äººè¸æ ·æ¬ã</p>
<p>ä¸ºäºè§£å³è¿ç§â<strong>æ»ä½æ ·æ¬éå¾å¤§ï¼ä½åä¸ªèº«ä»½æ ·æ¬æå°</strong>âççç¾ï¼äººä»¬æåºäºä¸ç§ä¸åäºä¼ ç»åç±»çæè·¯ï¼  <strong>ä¸åè®©æ¨¡ååç­âè¿å¼ è¸å±äºææäººä¸­çåªä¸ä¸ªï¼âï¼èæ¯è®©å®å¤æ­âè¿å¼ è¸æ¯å¦åæä¸ä¸ªå·²ç¥çæå¼ è¸è¶³å¤ç¸ä¼¼ï¼â</strong></p>
<p>ç°å¨ï¼ç½ç»ç®æ å°±ä»ä¸å¼å§çâå­¦ä¹ åç±»âåæäºâ<strong>å­¦ç¸ä¼¼åº¦</strong>âï¼å°±åè¿æ ·ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234253679-642676291.png" alt="image.png" loading="lazy"><br>
å¦æå¦å¾ä¸­è¿æ ·ï¼ç½ç»å®ç°äºâ<strong>å­¦ä¹ ä¸¤å¼ äººè¸çç¸ä¼¼åº¦</strong>âï¼æä»¬å°±è§£å³äºååçé®é¢ï¼</p>
<ol>
<li>å¦æåä½ææ°åå·¥å å¥æèåå·¥ç¦»èï¼å°±è¦ä¸åéè¦è°æ´ç½ç»åéæ°è®­ç»ï¼<strong>åªéè¦æç¸åºæ°æ®å å¥æ°æ®åºæä»æ°æ®åºä¸­å é¤</strong>ã</li>
<li>ææçæ°æ®é½è¢«ååå©ç¨ï¼åæ¶æ¯äººåªéè¦ä¸å¼ è¯ä»¶ç§ï¼å¨é¨ç¦æ¶äººè¸åæ°æ®åºä¸­çäººè¸å¯¹æ¯ï¼<strong>æ¾å°æ»¡è¶³ç¸ä¼¼åº¦éå¼çæ ·æ¬å³éè¿ï¼ä¸å­å¨å³æç»ã</strong></li>
</ol>
<h1 id="3-siamese-ç½ç»">3. Siamese ç½ç»</h1>
<p>ç°å¨ï¼æä»¬æç¡®äºéå¯¹é¢é¨è¯å«ä»»å¡çç®æ ï¼<strong>è®­ç»ä¸ä¸ªå¯ä»¥å­¦ä¹ ä¸¤å¼ äººè¸ç¸ä¼¼åº¦çç½ç»</strong>ã<br>
ç°å¨ï¼è¦æä¹å®ç°è¿ä¸ç¹å¢ï¼<br>
ç­æ¡å°±æ¯è¿é¨åçæ é¢ï¼Siamese ç½ç»ã<br>
è¦è¯´æçæ¯ï¼å´æ©è¾¾èå¸å¨è¯¾ç¨éæå°äºä¸ç¯ 2014 å¹´çè®ºæ <a href="https://www.cv-foundation.org/openaccess/content_cvpr_2014/papers/Taigman_DeepFace_Closing_the_2014_CVPR_paper.pdf?utm_source=chatgpt.com" target="_blank" rel="noopener nofollow">DeepFace: Closing the Gap to Human-Level Performance in Face Verification</a>ã<strong>ä½ Siamese ç½ç»å¹¶ä¸æ¯ä»è¿ç¯è®ºæææåºç</strong>ââæ©å¨ 1993 å¹´ï¼å®å°±è¢«åæåºæ¥ï¼ç¨äºå¤æ­ä¸¤å¹æåç­¾åæ¯å¦åä¸äººãåæ¥ä¹è¢«åºç¨å°äººè¸è¯å«ä»»å¡ä¸­ã<br>
Siamese ç½ç»çæ ¸å¿æè·¯æ¯<strong>éè¿å±äº«æéçååæ¯ï¼æå¤åæ¯ï¼ç¥ç»ç½ç»ï¼å°è¾å¥çä¸¤å¼ å¾åæ å°å°åä¸ç¹å¾ç©ºé´ï¼ç¶åéè¿åº¦éå½æ°ï¼å¦æ¬§æ°è·ç¦»æä½å¼¦ç¸ä¼¼åº¦ï¼è®¡ç®å®ä»¬çç¸ä¼¼åº¦</strong>ã<br>
DeepFace åé´äº Siamese ç½ç»çæè·¯ï¼å¨æ·±åº¦ CNN ä¸ç´æ¥å­¦ä¹ äººè¸ç¹å¾çç¸ä¼¼åº¦ï¼å¹¶éè¿ä¼ååå¤§è§æ¨¡è®­ç»ï¼è¿æä½¿å¾<strong>ç³»ç»æ§è½æ¥è¿äººç±»æ°´å¹³ï¼çæ­£å·å¤é¨ç½²ä»·å¼</strong>ã</p>
<p>ç°å¨ï¼å°±æ¥è¯¦ç»ççä¸ä¸ªè¾å®åç Siamese ç½ç»çè¿è¡è¿ç¨ï¼</p>
<h2 id="31-å¯¹å¾åè¿è¡ç¼ç å¤çä¸åç»æå¤±triplet-loss">3.1 å¯¹å¾åè¿è¡ç¼ç å¤çï¼ä¸åç»æå¤±ï¼triplet lossï¼</h2>
<p>æä»¬åæ¥ççä»ä¹å«å¯¹å¾åè¿è¡ç¼ç å¤çï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234657431-1853718024.png" alt="image" loading="lazy"><br>
è¿æ ·ï¼æä»¬å°±å¯ä»¥ä½¿ç¨ä¸ç»ç¹å¾åéæ¥ç¼ç ä¸å¼ äººè¸ï¼å®éä¸ï¼è¿å°±æ¯ DeepFace æåºçä¸æ­¥ä¼åï¼è¿ä¸æ­¥è®¾ç½®<strong>ä¸æ­¢ä¸ºäºè®¡ç®ç¸ä¼¼åº¦ä½åå¤ï¼åæ¶ä¹æå¤§åå°äºè®¡ç®éï¼ç¼©ç­äºè¿è¡æ¶é´</strong>ï¼å¯ä»¥è¯´ç¸å½æåã</p>
<p>ä½æ¯ï¼åæ ·ä¹æ¯å ä¸ºè¿ä¸æ­¥ç¼ç ï¼æ°çé®é¢åºç°äºï¼<strong>ä½ ä¼åç°ï¼è¿ä¸ªç¨æ¥æå¾åè½¬æ¢æç¼ç çç½ç»åæ ·éè¦è®­ç»ã</strong><br>
æ²¡éï¼æä»¬éè¦è®­ç»è¿ä¸ªç½ç»ï¼èç®æ å°±æ¯ï¼<strong>è®©åä¸ä¸ªèº«ä»½çäººè¸ç¼ç å·®å¼æå°åï¼ä¸åèº«ä»½çäººè¸çç¼ç å·®å¼æå¤§åã</strong><br>
è¦å®ç°è¿ä¸ªç®æ çå¸¸ç¨æ¹æ³å«å<strong>ä¸åç»ï¼tripletï¼æå¤±</strong>ï¼è¿æ¶ï¼<strong>ç½ç»å¨è®­ç»é¶æ®µéè¦åæ¶è¾å¥ä¸å¼ å¾å</strong>ã<br>
å®çå¬å¼é¿è¿ä¸ªæ ·ï¼</p>
<p></p><div class="math display">\[L=maxâ¡(0,â¥f(a)âf(p)â¥^2_2ââ¥f(a)âf(n)â¥^2_2+Î±)
\]</div><p></p><p>å¶ä¸­ï¼</p>
<ul>
<li><span class="math inline">\(f(a)\)</span>ï¼anchorï¼åºåå¾åï¼æ å°åçç¹å¾åé</li>
<li><span class="math inline">\(f(p)\)</span>ï¼positiveï¼åä¸èº«ä»½çå¾åï¼æ å°åçç¹å¾åé</li>
<li><span class="math inline">\(f(n)\)</span>ï¼negativeï¼ä¸åèº«ä»½çå¾åï¼æ å°åçç¹å¾åé</li>
<li><span class="math inline">\(\alpha\)</span>ï¼é´éï¼marginï¼ï¼ä¿è¯ä¸åèº«ä»½çè·ç¦»æ¯åä¸èº«ä»½è·ç¦»è³å°å¤§ <span class="math inline">\(\alpha\)</span></li>
</ul>
<p>å«æï¼æä»¬ç¨ä¸ä¸ªä¾å­æ¥æ¼ç¤ºä¸éåçï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229235145998-454139387.png" alt="image" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234301253-442526298.png" alt="image.png" loading="lazy"><br>
åªçç¬¦å·å¯è½æäºå¤ªç»äºï¼<strong>æä»¬åæ¥çä¸ä¸ªå®ä¾</strong>ï¼<br>
åè®¾ä¸å¼ äººè¸å¾åï¼ç»è¿ç½ç»æ å°åçäºç»´ç¹å¾åéå¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>å¾å</th>
<th>ç¹å¾åé</th>
</tr>
</thead>
<tbody>
<tr>
<td>a (Alice)</td>
<td>[1.0, 1.0]</td>
</tr>
<tr>
<td>p (Alice)</td>
<td>[1.2, 1.1]</td>
</tr>
<tr>
<td>n (Bob)</td>
<td>[2.5, 2.0]</td>
</tr>
</tbody>
</table>
<h4 id="1è®¡ç®æ¬§æ°è·ç¦»">ï¼1ï¼è®¡ç®æ¬§æ°è·ç¦»</h4>
<p><strong>Anchor ä¸ Positiveï¼åä¸äººï¼</strong>ï¼</p>
<p></p><div class="math display">\[â¥f(a)-f(p)â¥_2^2 = (1.0-1.2)^2 + (1.0-1.1)^2 = 0.04 + 0.01 = 0.05  
\]</div><p></p><p><strong>Anchor ä¸ Negativeï¼ä¸åäººï¼</strong>ï¼</p>
<p></p><div class="math display">\[â¥f(a)-f(n)â¥_2^2 = (1.0-2.5)^2 + (1.0-2.0)^2 = 2.25 + 1.0 = 3.25  
\]</div><p></p><h4 id="2ä»£å¥ä¸åç»æå¤±å¬å¼">ï¼2ï¼ä»£å¥ä¸åç»æå¤±å¬å¼</h4>
<p>åè®¾ <span class="math inline">\(\alpha = 0.5\)</span>ï¼ä»£å¥æ°å¼ï¼</p>
<p></p><div class="math display">\[L = \max\Big(0,0.05 - 3.25 + 0.5\Big) = \max(0, -2.7) = 0  
\]</div><p></p><p>ä»£è¡¨å½åç¹å¾åéæ»¡è¶³ç®æ ï¼åä¸äººè·ç¦»æ¥è¿ï¼ä¸åäººè·ç¦»å¤§äº <span class="math inline">\(\alpha\)</span>ã</p>
<h4 id="3å¦æ-negative-å¤ªè¿">ï¼3ï¼å¦æ Negative å¤ªè¿</h4>
<p>åè®¾ <span class="math inline">\(f(n) = [1.5, 1.3]\)</span>ï¼è®¡ç®è·ç¦»ï¼</p>
<p></p><div class="math display">\[â¥f(a)-f(n)â¥_2^2 = (1.0-1.5)^2 + (1.0-1.3)^2 = 0.25 + 0.09 = 0.34  
\]</div><p></p><p>æå¤±ä¸ºï¼</p>
<p></p><div class="math display">\[L = \max\Big(0, 0.05 - 0.34 + 0.5\Big) = \max(0, 0.21) = 0.21  
\]</div><p></p><p>ä¾¿è¯´æä¸åäººè·ç¦»å¤ªè¿ï¼ç½ç»éè¦æ´æ°ï¼ä¿çæå¤±æ¥è¿è¡ååä¼ æ­ã</p>
<p><strong>éè¿è¿ç§è®¾è®¡ï¼ç½ç»å¯ä»¥ç´æ¥å­¦ä¹ ä¸ä¸ªéååº¦éç¸ä¼¼åº¦çç¹å¾ç©ºé´ã</strong></p>
<p>æåè¦å¼ºè°çä¸ç¹æ¯ï¼ä¸ºäºè®©è®­ç»æææ´å¥½ï¼<strong>æä»¬å¨éæ©ä¸åç»æ¶ï¼ä¼å°½éè®©åºåå¾åååä¸äººçå¾åå·®å«å°½å¯è½å¤§ï¼åæ¶è®©åºåå¾ååä¸åäººçå¾åå·®å«å°½å¯è½å°ã</strong><br>
è¿å°±åæ¯å¨æå¨æé«èè¯é¾åº¦ï¼é¾é¢ä¼äºï¼ç®åé¢èªç¶ä¸å¨è¯ä¸ã<br>
ç°å¨ï¼æä»¬ä¾¿ç»§ç»­ä¸ä¸é¨åã</p>
<h2 id="32-æ­£åä¼ æ­ä¸¤å¹å¾åå¹¶è®¡ç®ç¸ä¼¼åº¦">3.2 æ­£åä¼ æ­ä¸¤å¹å¾åå¹¶è®¡ç®ç¸ä¼¼åº¦</h2>
<p>å¨æ¥æäºå¯ä»¥å¯¹å¾åè¿è¡åéç¼ç çç½ç»åï¼æä»¬ä¾¿å¯ä»¥è¿è¡ç¸ä¼¼åº¦è®¡ç®çåºç¨ï¼è¿ä¸æ­¥çè¿ç¨æ¯è¿æ ·çï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234408230-256446436.png" alt="image.png" loading="lazy"><br>
å¦å¾æç¤ºï¼æä»¬éè¿æ­£åä¼ æ­å¾å°ä¸¤å¹è¾å¥äººè¸çç¼ç ï¼å¹¶æ ¹æ®ç¼ç è®¡ç®ç¸ä¼¼åº¦ï¼èªç¶å°±å¯ä»¥æ ¹æ®éå¼å¤æ­ä¸¤å¼ äººè¸æ¯å¦å±äºåä¸ä¸ªäººã<br>
èä¸ï¼è¿ç§ä¼ æ­åè®¡ç®ç¸ä¼¼åº¦åç¦»çè®¾è®¡ï¼ä»£è¡¨<strong>æä»¬å¯ä»¥æåä¸ºæ°æ®åºä¸­çå¾åè®¡ç®å¥½ç¼ç </strong>ï¼åªéå·è¸æ¶ä¼ å¥çäººè¸åç¬ä¼ æ­å¾å°ç¼ç åè¿è¡è®¡ç®å°±å¥½äºï¼è¿å¤§å¤§æé«äºå¯é¨ç½²æ§ã</p>
<h2 id="33-æå±å¦ä¸ç§è®­ç»ç¼ç ç½ç»çæ¹å¼">3.3 æå±ï¼å¦ä¸ç§è®­ç»ç¼ç ç½ç»çæ¹å¼</h2>
<p>æä»¬ååä»ç»äºå¯ä»¥éè¿ä¸åç»æå¤±æ¥è®­ç»ç¼ç ç½ç»ï¼ä½ä½ å¯è½ä¹åç°äºï¼è¿ä¸ªæ¹æ³å¨æ°æ®åå¤é¶æ®µè¾ä¸ºå¤æã<br>
å æ­¤ï¼å´æ©è¾¾èå¸è¿ä»ç»äºå¦ä¸ç§è®­ç»æ¹æ³ï¼<strong>æ´æ¹æ ç­¾ï¼è®©Siamese ç½ç»åæ¥é»è¾åå½åä¸ºäºåç±»é®é¢ã</strong><br>
<img src="https://img2024.cnblogs.com/blog/3708248/202512/3708248-20251229234243543-574274696.png" alt="image.png" loading="lazy"><br>
è¿æ ·ï¼æä»¬å°±åæäººè¸è¯å«é®é¢åè½¬æ¢åäºäºåç±»é®é¢ï¼éè¿ååä¼ æ­æ¥è¿è¡è®­ç»ã<br>
ä½æ¯ï¼ä½ ä¼åç°ï¼<strong>å½æ°åå·¥å å¥æ¶ï¼è¿æ¯è¦éæ°è®­ç»æ¨¡åã</strong><br>
å æ­¤ï¼å®éä¸è¿ç§æ¹å¼çå®éé¨ç½²ä»·å¼å¹¶ä¸å¦ä½¿ç¨ä¸åç»æå¤±ã</p>
<h1 id="4æ»ç»">4.æ»ç»</h1>
<table>
<thead>
<tr>
<th>æ¦å¿µ</th>
<th>åç</th>
<th>æ¯å»</th>
</tr>
</thead>
<tbody>
<tr>
<td>äººè¸éªè¯ï¼Face Verificationï¼</td>
<td>1 å¯¹ 1 é®é¢ï¼å¤æ­è¾å¥äººè¸æ¯å¦ä¸ç®æ èº«ä»½å¹é</td>
<td>å°±åé¨å«åªå¯¹æä¸ªäººè¯´âå¯ä»¥è¿âï¼å¶ä»äººå¨é¨æç»</td>
</tr>
<tr>
<td>äººè¸è¯å«ï¼Face Recognitionï¼</td>
<td>1 å¯¹å¤é®é¢ï¼éè¿æ¨¡åè¯å«è¾å¥äººè¸å±äºåªä¸ä¸ªå·²ç¥èº«ä»½</td>
<td>é¨ç¦ç³»ç»è¯å«å¤ä¸ªåå·¥ï¼ä¸éè¦åç¬ä¸ºæ¯ä¸ªäººè®¾é¸æº</td>
</tr>
<tr>
<td>å¤åç±»å»ºæ¨¡é®é¢</td>
<td>å°æ¯ä¸ªäººä½ä¸ºä¸ä¸ªç±»å«è¿è¡è®­ç»</td>
<td>æ¯ä¸ªåå·¥é½æä¸æ¬åçéï¼è¦å­¦ä¼åºåæåä¸ä¸æ¬</td>
</tr>
<tr>
<td>ä¸æ¬¡å­¦ä¹ ï¼One-Shot Learningï¼</td>
<td>æ¯ä¸ªèº«ä»½ä»æä¾æå°æ ·æ¬ï¼éè¿ç¸ä¼¼åº¦å¤æ­è¯å«</td>
<td>åªéä¸å¼ è¯ä»¶ç§å°±è½è¯å«æ°åå·¥ï¼ä¸ç¨æåçé</td>
</tr>
<tr>
<td>Siamese ç½ç»</td>
<td>å±äº«æéçååæ¯ï¼æå¤åæ¯ï¼ç½ç»ï¼å°å¾åæ å°å°åä¸ç¹å¾ç©ºé´ï¼éè¿åº¦éå½æ°è®¡ç®ç¸ä¼¼åº¦</td>
<td>åæ¶çä¸¤å¼ ç§çï¼ç¶åæ¯è¾ç¸ä¼¼åº¦</td>
</tr>
<tr>
<td>ä¸åç»æå¤±ï¼Triplet Lossï¼</td>
<td>è®­ç»ç½ç»ä½¿åä¸äººè·ç¦»æå°ï¼ä¸åäººè·ç¦»æå¤§ï¼ç½ç»éè¾å¥ä¸å¼ å¾åï¼anchor, positive, negativeï¼</td>
<td>æé«èè¯é¾åº¦ï¼åºåé¢åç¸ä¼¼é¢å·®å«å°ï¼ä¸åé¢å·®å«å¤§ï¼è®­ç»æ´ææ</td>
</tr>
<tr>
<td>æ­£åä¼ æ­ä¸¤å¾è®¡ç®ç¸ä¼¼åº¦</td>
<td>å·²è®­ç»ç½ç»å¯¹ä¸¤å¹å¾åç¼ç åï¼è®¡ç®ç¹å¾è·ç¦»æç¸ä¼¼åº¦ï¼ç¨éå¼å¤æ­æ¯å¦åä¸äºº</td>
<td>åæç§çç¼ç æâèº«ä»½ç¹å¾å¡çâï¼å·è¸æ¶åªæ¯å¯¹å¡ç</td>
</tr>
<tr>
<td>Siamese + é»è¾åå½äºåç±»</td>
<td>å°ä¸¤å¼ å¾åè¾å¥ Siamese ç½ç»ï¼éè¿é»è¾åå½å¤æ­æ¯å¦åä¸äºº</td>
<td>å°äººè¸è¯å«é®é¢ç®åæâæ¯/ä¸æ¯åä¸äººâçéæ©é¢</td>
</tr>
<tr>
<td>é¨ç½²å¯è¡æ§å¯¹æ¯</td>
<td>ä¸åç»æå¤±æ¯æ one-shotãå¯æåè®¡ç®æ°æ®åºç¹å¾åéï¼æ³åå¼ºï¼é»è¾åå½æ¹å¼æ°èº«ä»½ééæ°è®­ç»ï¼æ³åå·®</td>
<td>ä¸åç»ï¼èè¯èéç¨è½åï¼é»è¾åå½ï¼èè¯åªä¼ç­å·²æé¢ç®</td>
</tr>
</tbody>
</table>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.4097222222222222" data-date-updated="2025-12-30 09:42">2025-12-29 23:52</span>&nbsp;
<a href="https://www.cnblogs.com/Goblinscholar">å¥å¸æå­¦è</a>&nbsp;
éè¯»(<span id="post_view_count">59</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19418306);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19418306', targetLink: 'https://www.cnblogs.com/Goblinscholar/p/19418306', title: 'å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨åï¼è®¡ç®æºè§è§ ç¬¬åå¨ï¼å·ç§¯ç½ç»åºç¨ (ä¸) äººè¸è¯å«' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Python osåº os.walkä½¿ç¨ï¼è¯¦ç»æç¨ãå¸¦å®è·µï¼ ]]></title>
    <link>https://www.cnblogs.com/io-T-T/p/19418274</link>
    <guid>a2f659a9411508120583e3c0fe7f4fad</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/io-T-T/p/19418274" title="åå¸äº 2025-12-29 23:19">
    <span role="heading" aria-level="2">Python osåº os.walkä½¿ç¨ï¼è¯¦ç»æç¨ãå¸¦å®è·µï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        Python osåº os.walkä½¿ç¨ï¼è¯¦ç»æç¨ãå¸¦å®è·µï¼
os.walk å¤çæä»¶
os.walkåç
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="python-osåº-oswalkä½¿ç¨è¯¦ç»æç¨å¸¦å®è·µ">Python osåº os.walkä½¿ç¨ï¼è¯¦ç»æç¨ãå¸¦å®è·µï¼</h2>
<p>-----------------------<em><strong>PSï¼env python version==3.10</strong></em>----------------</p>
<p>ç®ä»ï¼</p>
<p>â	æ¬æä»¥å®éæ¡ä¾è¯´æ<code>os.walk</code>å¯¹æä»¶çä½¿ç¨æ¹å¼ãä¸»è¦æå­¦åå®¹ï¼</p>
<ul>
<li><code>os.walk</code>åºå®éçä½¿ç¨</li>
<li><code>os.walk</code>æä½³å®è·µ</li>
<li><em>ï¼å¯éï¼os.walkåç</em></li>
<li><em>ï¼å¯éï¼è¿­ä»£å¨æ¹åçè§£</em></li>
</ul>
<p>å¨æ2000å­å·¦å³ï¼ä»£ç å­æ°800ï¼å«è¿­ä»£å¨180ï¼å·¦å³ï¼å»ºè®®å­¦ä¹ æ¶é´10-15minï¼ä¸å«è¿­ä»£å¨ï¼ãè¥å­¦ä¹ è¿­ä»£å¨å»ºè®®30min+</p>
<h3 id="1-æ¨¡æå®éä½¿ç¨ç¯å¢">1 æ¨¡æå®éä½¿ç¨ç¯å¢</h3>
<p>â	PSï¼ä»ä½ä¸ºæ¡ä¾è¯´æåèï¼è¥å·²æå¯ç¨çæä»¶å¤¹/ç®å½ï¼è¯·ç§»æ­¥ç¬¬äºæ­¥</p>
<p>â	<img alt="image-20251222214254412" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3244923/202512/3244923-20251229231342848-1708394222.png" class="lazyload"></p>
<ol>
<li>
<p>æ ¹æ®ä¸å¾æ¨¡æå®éä½¿ç¨æåµï¼</p>
<ul>
<li>
<p>éææ°å»ºä¸ä¸ªç®å½ï¼ç¡®ä¿ä¸ä¼æå¶ä»æä»¶ï¼</p>
</li>
<li>
<p>å¨ï¼æ°å»ºç®å½çï¼æ ¹ç®å½åå»ºä¸ä¸ª<strong>æä»¶</strong>å<strong>æä»¶å¤¹</strong>ï¼åç§°éæï¼ä¹å¯ä»¥åç§æçæ ·ä¾æ¥ï¼</p>
</li>
<li>
<p>è¿å¥<code>root</code>æä»¶å¤¹ï¼æ°å»ºä¸¤ä¸ªæ¬¡çº§æä»¶å¤¹ï¼<code>dir1</code>ã<code>dir2</code>ï¼</p>
<ul>
<li>rootæä»¶å¤¹ä¸ç´æ¥åå»ºæ¬¡çº§ç®å½æä»¶<code>F1.txt</code></li>
<li>åå»ºæ¬¡çº§ç®å½æä»¶<code>dir1</code>ã<code>dir2</code>
<ul>
<li>è¿å¥<code>dir2</code>æä»¶å¤¹
<ul>
<li>åå»ºæä»¶ï¼<code>F2.txt</code>ï¼</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="2-è§£æoswalkå½æ°">2 è§£æ<code>os.walk</code>å½æ°</h3>
<p>é¢ååºç¡è®²è§£ï¼è¯¦ç»è§ <a href="https://docs.python.org/zh-cn/3.10/library/os.html?highlight=os%20walk#os.walk" target="_blank" rel="noopener nofollow">os.walkå®æ¹è¯´æ</a></p>
<ul>
<li>
<p>ä»ä¹æ¯ python ç<code>os</code>åº</p>
<ul>
<li>æ¬æ¨¡åæä¾äºä¸ç§ä½¿ç¨ä¸æä½ç³»ç»ç¸å³çåè½çä¾¿æ·å¼éå¾ãï¼å¦æä»¶è·¯å¾æ§å¶ãæä»¶ä¿¡æ¯è·åãéåç®å½æä»¶ã<code>os.walk</code>ããå¶ä»ç³»ç»è°ç¨åè½ï¼</li>
</ul>
</li>
<li>
<p><code>os.walk</code>å½æ°è®²è§£ï¼</p>
<p><code>os.walk</code>(<strong><em>top</em>, <em>topdown=True</em>,</strong> <em>onerror=None</em>, <em>followlinks=False</em>)</p>
<ul>
<li>
<p>ä¸»è¦èç¦äºåä¸¤ä¸ªåæ°å³å¯ï¼</p>
<ul>
<li><code>top</code>ï¼æ ¹ç®å½è·¯å¾ï¼strï¼</li>
<li><code>topdown</code>ï¼èªä¸èä¸æ¨¡å¼ï¼é»è®¤ï¼<code>True</code>ï¼ä¸ºèªä¸èä¸éåï¼<code>False</code>åä»åºåä¸éå</li>
</ul>
</li>
<li>
<p>è¿åå¼ï¼</p>
<ul>
<li>
<p>è¿åè¿­ä»£å¨ ï¼è¿­ä»£å¨æ¯æ¬¡çæçå¯¹è±¡ä¸ºï¼<code>(dirpath, dirnames, filenames)</code></p>
<p><code>dirpath</code>ï¼ å½åæä»¶å¤¹è·¯å¾</p>
<p><code>dirnames</code>ï¼æä»¶å¤¹åç§°</p>
<p><code>filenames</code>ï¼æä»¶åç§°</p>
</li>
<li>
<p>å¦æä¸çè§£è¿­ä»£å¨ï¼å¯ä»¥ææ¶çè§£ä¸ºos.walkè¿åäº åç» <code>(dirpath, dirnames, filenames)</code>çåè¡¨ï¼ç±»ä¼¼äºä¸æ (çç¥åå¼å·):</p>
<pre><code class="language-python">[
	(C:/user/, [root],[rott_text.txt] ),		#æ ¹ç®å½
	(C:/user/root, [dir1,dir2],[F1.txt] ),		#è¿å¥rootæä»¶å¤¹
	(C:/user/root/dir1, [],[] ),				#è¿å¥dir1æä»¶å¤¹
	(C:/user/root/dir2, [],[F2.txt] )			#dir1ä¸­æ²¡ææä»¶äºï¼éåä¸ä¸å±çº§ï¼è¿å¥dir2æä»¶å¤¹ä¸­
    #è¯»åæææä»¶/æä»¶åå®æ¯ï¼
]
</code></pre>
<p>åªä¸è¿ä»çæçç¹æ®âåè¡¨âç»å¸¸éç¨äºforï¼ä¸è½ç´æ¥ä½ä¸ºåè¡¨æå°ï¼ç´æ¥æå°æ¯è¿æ ·å­çï¼</p>
<pre><code class="language-bash">#code
dir_path = r'your_dir'						#æ¿æ¢ä¸ºä½ çæä»¶å¤¹
dirpath, dirnames, filenames = os.walk(dir_path)
print(f'dir_path:{dirpath}\ndir_name:{dirnames}\nfile_names:{filenames}')

#resultï¼
	dirpath, dirnames, filenames = os.walk(dir_path)
ValueError: too many values to unpack (expected 3)
</code></pre>
<p>ç©¶å¶åå æ¯è¿åçåä¸ªè¿­ä»£å¨ï¼å¹¶éä¸ä¸ªåè¡¨åç»ï¼åæ¬¢ç»ç©¶è¿é¨åçè§åæï¼ç®è¦çè¯ç¥éä¸è½ç´æ¥è°ç¨ï¼ä¸è¬ç»å<code>for</code>è°ç¨å°±å¥½ï¼è¿ä¸ªå¹¶éæ·±åº¦ææï¼çå®åé¢ä¼çå¯è½ææ´å¥½ççè§£ã</p>
<p>è¿­ä»£å¨å­¦ä¹ å»ºè®®ï¼<a href="https://www.bilibili.com/video/BV1jt421c7yN/?" target="_blank" rel="noopener nofollow">ãPythonãä»è¿­ä»£å¨å°çæå¨ï¼å°åå­ä¹è½å¤çå¤§æ°æ®</a></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3-è°ç¨æ ·ä¾">3 è°ç¨æ ·ä¾ï¼</h3>
<p>åé¢åæ°æç¹ä¸å¥½çè§£ä¹æ²¡å³ç³»ï¼åªè¦å¤§æ¦ç¥éå°±å¥½äºï¼ä¸é¢æ¯å®éå½æ°ä½¿ç¨</p>
<ol>
<li>åå¤å¶ä¸é¢ä»£ç è³æ°pyæä»¶ï¼æ¹ä¸ä¸ <code>dir_path</code>è¿è¡ä¸ä¸ä½ä¼ä¸ä¸</li>
</ol>
<pre><code class="language-python">import os

def walk_example(dir_path:str):
    #os.walk è¿åç±»ä¼¼äºä¸åç»åè¡¨ç»æï¼ç¶åè¿è¡éå
    for root, dir_names, file_names in os.walk(dir_path):   #(dirpath, dirnames, filenames)
        print(f'dirpath :{root}')
        print(f'dir_names :{dir_names}')
        print(f'file_names:{file_names}')
        print('-'*50)


if __name__ == '__main__':
    dir_path = r'your_dir_path'
    walk_example(dir_path)
</code></pre>
<ol start="2">
<li>
<p>è¾åºç»æï¼</p>
<img alt="image-20251222223407130" style="zoom: 67%" data-src="https://img2024.cnblogs.com/blog/3244923/202512/3244923-20251229232107540-656148957.png" class="lazyload">
<p>è¿éå¯ä»¥çåºï¼é»è®¤ç¶æä¸ï¼ï¼æ¯ä»é¡¶åä¸ï¼ä¸å±å±éåã</p>
<blockquote>
<p>dirpath : <code>x:\your_path\walk</code></p>
<p>dir_names :['root']<br>
file_names:['root_text.txt']</p>
</blockquote>
<ul>
<li>è¿éæ¯æ ¹ç®å½ä¸­åºç°çæä»¶å¤¹åç§°(root)ãæä»¶('root_text.txt')</li>
</ul>
<blockquote>
<p>dirpath :<code>x:\your_path\walk\root</code><br>
dir_names :['dir1', 'dir2']<br>
file_names:['F1.txt']</p>
</blockquote>
<ul>
<li>è¿å¥äºrootæä»¶å¤¹ï¼éé¢åå«<strong>ä¸¤ä¸ªæä»¶å¤¹</strong>åå½åæä»¶å¤¹æ ¹ç®å½ä¸ç<strong>åä¸ªæä»¶</strong>
<ul>
<li>åé¢ä¸¤ä¸ªåçï¼ä¸»è¦æ¯æåæ¯ä¸å±çº§çååï¼æ¯æ¬¡è¿å¥ä¸ä¸ä¸ªæä»¶å¤¹æ¶ï¼<code>root</code><strong>æè¡¨è¾¾çå±æ§é½ä¼ææåå</strong>ï¼åæäºå½åæ ¹è·¯å¾ã</li>
<li>é¤æ­¤ä¹å¤ï¼å¯ä»¥çå°ï¼4é¡¹ç<code>dir_name</code>è¾åºï¼åå¥½æ¯æä»¬<strong>å¨é¨</strong>çç®å½åç§°ï¼<code>file_names</code>åç</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ä»ä¸æï¼å¯ä»¥çåº <code>os.walk</code>å½æ°çéåç»æä¼æ ¹æ®æ·±å¥çå±çº§è¾åºä»¥ä¸ä¿¡æ¯ï¼</p>
<ul>
<li>å½åæä»¶è·¯å¾ï¼strï¼</li>
<li>å­å¨çæä»¶å¤¹ï¼listï¼</li>
<li>å­å¨çæä»¶ï¼listï¼</li>
</ul>
<p>æä»ä»¬èåèµ·æ¥ï¼å°±è½è·åæä»¬æéè¦çï¼</p>
<ul>
<li>æåæä»¶å¤¹ä¿¡æ¯ï¼æå¤çï¼</li>
<li>æåæä»¶ä¿¡æ¯ï¼æå¤çï¼</li>
</ul>
</li>
</ol>
<h3 id="4-å®éè¿ç¨æ¡ä¾æä½³å®è·µ">4 å®éè¿ç¨æ¡ä¾ï¼æä½³å®è·µï¼</h3>
<p>æ¬å°èä¼ä»ä»¥ä¸å ç¹æ¥è¯´æå¦ä½éè¿<code>os.walk</code>è¿è¡æä»¶çæååå¤çã</p>
<ul>
<li>æåå¨é¨ä¿¡æ¯ï¼æä»¶å¤¹ãæä»¶ï¼ãçè§£è°ç¨æ¹å¼ã</li>
<li>æé æä»¶å¤¹ä¸­ï¼æææä»¶çè·¯å¾</li>
<li>æ ¹æ®å³é®å­æåï¼æä»¶/æä»¶å¤¹ï¼è·¯å¾</li>
</ul>
<h4 id="41-æåå¨é¨ä¿¡æ¯æä»¶å¤¹æä»¶çè§£è°ç¨æ¹å¼">4.1 æåå¨é¨ä¿¡æ¯ï¼æä»¶å¤¹ãæä»¶ï¼ãçè§£è°ç¨æ¹å¼ã</h4>
<p>â	å¾ç®åï¼åªè¦æå¯¹åºå¨é¨è¾åºæ¶éèµ·æ¥ï¼å°±è½è·å¾æä»¬éè¦çå¨æä»¶åãæä»¶ä¿¡æ¯äºã</p>
<pre><code class="language-python">def walk_get_all_info(dir_path:str):
    '''
    è·åæææä»¶åãæä»¶ä¿¡æ¯
    :param dir_path: è¾å¥æä»¶å¤¹è·¯å¾
    '''
    dir_list = []
    file_list = []
    for root, dirnames, files in os.walk(dir_path):
        for dir_name in dirnames:
            dir_list.append(dir_name)
            # print(dir_name)					#ä¸çè§£å¯ä»¥è°è¯æ¥ä¸ä¸çè§£ä¸ä¸ï¼ä¸¤èæ¯ç¸äºç¬ç«ç
        for file in files:
            file_list.append(file)
            # print(file)
    print(dir_list)
    print(file_list)
if __name__ == '__main__':
    dir_path = r'your_path'
    walk_get_all_info(dir_path)
</code></pre>
<p>â	è¾åºï¼</p>
<blockquote>
<p>root<br>
root_text.txt<br>
dir1<br>
dir2<br>
F1.txt<br>
F2.txt</p>
</blockquote>
<h4 id="42-æé æä»¶å¤¹ä¸­æææä»¶çè·¯å¾">4.2 æé æä»¶å¤¹ä¸­ï¼æææä»¶çè·¯å¾</h4>
<p>â	éè¿<strong>4.1</strong> æä»¬ç¥éäº<code>os.walk</code>çè¿­ä»£æ¹å¼ãå¯ä»¥éè¿âå½åæ ¹ç®å½âä¸ âæéæä»¶åç§°âç¸ç»åï¼ä»èéåæææä»¶çè·¯å¾ã</p>
<pre><code class="language-python">def walk_get_file_path(dir_path:str):
    '''
    è·åæä»¶è·¯å¾
    :param dir_path: è¾å¥æä»¶å¤¹è·¯å¾
    '''

    file_list = []
    for root, dirnames, files in os.walk(dir_path):
        print(f'local root path :{root}')
        for file in files:
            file_path = os.path.join(root, file)        #window ä¸ï¼ç­ä»·äº root + "\\" + file
            # file_path = root + "\\" + file
            print(f'file path :{file_path}')
            file_list.append(file_path)
        print('-'*50)
    print(file_list)
</code></pre>
<h4 id="43-æ ¹æ®å³é®å­æåæä»¶è·¯å¾">4.3 æ ¹æ®å³é®å­æåæä»¶è·¯å¾</h4>
<p>â	è¿éä»¥æç®åçå³é®å­æåï¼å³ <code>if keyword in file</code>ä¸ºä¾ã</p>
<pre><code class="language-python">def filter_by_key_word(dir_path,key_word:str='F1'):   
    '''
    æä»¶å¤¹è·¯å¾ä»¥å³é®å­ï¼éå½æ¥æ¾ç¬¦åå³é®å­çæä»¶
    :param dir_path: è¾å¥æ ¹æä»¶å¤¹
    :param key_word: å³é®å­
    '''
    res:list = []
    for root, dirnames, files in os.walk(dir_path):
        for file in files:
            if key_word in file:
                res.append(
                    os.path.join(root, file)
                )
    print(res)
    return
</code></pre>
<p>æç§é¢æï¼å°±åºè¯¥è¾åº<code>F1</code>ï¼</p>
<blockquote>
<p>['E:\walk\root\F1.txt']</p>
</blockquote>
<p>æ´æ¹å³é®å­ï¼ä¹å¯ä»¥åå°ç­éä¸åæä»¶çåè½ï¼å¯ä»¥èªå·±æ¹ä¸ä¸ãå¯¹<code>files</code>è¿­ä»£æ¹ä¸ºå¯¹<code>dirname</code>è¿­ä»£ï¼ä¸æ ·è½å®æå¯¹æä»¶å¤¹çå³é®å­æåï¼å¯ä»¥å°è¯ä¸ä¸</p>
<h4 id="44-å¶ä»è¿ç¨">4.4 å¶ä»è¿ç¨</h4>
<p>â	è½æ¾å°æä»¶å°åï¼åç»­å°±å¯ä»¥æç§ä½ æ³å¤ççæ¹å¼å¯¹æä»¶è¿è¡å¤çäºï¼è¿ä¸ªæ ¹æ®åèªéè¦è¿è¡æ©å±å°±å¥½ï¼æç¨ç»æã</p>
<h3 id="5-é¨åä»£ç ">5. é¨åä»£ç ï¼</h3>
<pre><code class="language-python">import os

def walk_example(dir_path:str):
	
    # walk_iter = os.walk(dir_path)
    # print(walk_iter.__next__())


    for root, dir_names, file_names in os.walk(dir_path):   #(dirpath, dirnames, filenames)
        print(f'dirpath :{root}')
        print(f'dir_names :{dir_names}')
        print(f'file_names:{file_names}')
        print('-'*50)


def walk_get_file_path(dir_path:str):
    '''
    è·åæä»¶è·¯å¾
    :param dir_path: è¾å¥æä»¶å¤¹è·¯å¾
    '''

    file_list = []
    for root, dirnames, files in os.walk(dir_path):
        print(f'local root path :{root}')
        for file in files:
            file_path = os.path.join(root, file)        #window ä¸ï¼ç­ä»·äº root + "\\" + file
            # file_path = root + "\\" + file
            print(f'file path :{file_path}')
            file_list.append(file_path)
        print('-'*50)
    print(file_list)
    return

def filter_by_key_word(dir_path,key_word:str='F1'):
    '''
    æä»¶å¤¹è·¯å¾ä»¥å³é®å­ï¼éå½æ¥æ¾ç¬¦åå³é®å­çæä»¶
    :param dir_path: è¾å¥æ ¹æä»¶å¤¹
    :param key_word: å³é®å­

    '''
    res:list = []
    for root, dirnames, files in os.walk(dir_path):
        for file in files:
            if key_word in file:
                res.append(
                    os.path.join(root, file)
                )
    print(res)
    return

if __name__ == '__main__':
    dir_path = r'your_path'
    # walk_example(dir_path)
    # walk_get_file_path(dir_path)
    filter_by_key_word(dir_path)
</code></pre>
<h3 id="6-è¿­ä»£å¨ç¸å³éå¿é¡»">6 è¿­ä»£å¨ç¸å³ï¼éå¿é¡»ï¼</h3>
<p>â	å»ºè®®åå»å­¦ä¹ ä¸ä¸ä»ä¹æ¯è¿­ä»£å¨ï¼åçè¿ä¸ªæ¼ç¤ºä»£ç ï¼å¯¹<code>os.walk</code>çè§£ä¼æ´æ·±ï¼è¿è¾¹è¿æ¯å»ºè®®å­¦ä¸ä¸çï¼å¦æå¤æ¶é´çè¯ï¼è¶å­¦os.walkå¤å­¦ä¸ä¸ªè¿­ä»£å¨/çæå¨ï¼ä½ä¹èä¸ä¸ºå¢ï¼å½æ°è®²è§£å¡éé¢äºï¼å°±è¿æ ·å§ã</p>
<pre><code class="language-python">def iter_example(dir_path:str):
    '''
    è¿­ä»£å¨çè§£ä»£ç 
    :param dir_path:
    '''
    #ææ²¡è®°éçè¯ï¼æ¯è¦æ__next__ å __iter__ ç±»æ¹æ³ï¼æè½æ¯è¿­ä»£å¨ç±»
    walk_iter = os.walk(dir_path)
    print(walk_iter.__next__())         #è·åè¿­ä»£å¨çä¸ä¸ä¸ªåç´ ï¼ä¸è¬é½ç¨nextè®¿é®ä¸ä¸ä¸ªåç´ 
    print(walk_iter.__iter__())         #è·åè¿­ä»£å¨æ¬èº«ï¼è¿éos.walkè¿åçæ¯generator objectï¼æ¬è´¨ä¸ä¹æ¯è¿­ä»£å¨ï¼ä¸å¤ªè½è·åå½åè¿­ä»£å¨çåç´ å¢ï¼
    print(next(walk_iter))              #ç¸ååæ³
    print('#'*25+"åéç¬¦"+'#'*25)
    count = 0
    while True:
        count += 1
        try:
            print(f'next element:{walk_iter.__next__()}')
            print("-"*50 + f"{count}")
        except Exception as e:          #æ å¯è¿­ä»£å¯¹è±¡åï¼ä¼raiseä¸ä¸ªStopIteration Error
            # print('finish iter, break')
            # break                         #å¸¸è§å¾ªç¯éåºæºå¶
            raise e

</code></pre>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.001388888888888889" data-date-updated="2025-12-29 23:21">2025-12-29 23:19</span>&nbsp;
<a href="https://www.cnblogs.com/io-T-T">io_T_T</a>&nbsp;
éè¯»(<span id="post_view_count">42</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19418274);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19418274', targetLink: 'https://www.cnblogs.com/io-T-T/p/19418274', title: 'Python osåº os.walkä½¿ç¨ï¼è¯¦ç»æç¨ãå¸¦å®è·µï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ docker-compose é¨ç½²åèç¹ kafka 4.0 æµè¯ç¯å¢ ]]></title>
    <link>https://www.cnblogs.com/apocelipes/p/19417908</link>
    <guid>75d9efcc5077d799d7d37cace482aade</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/apocelipes/p/19417908" title="åå¸äº 2025-12-29 20:34">
    <span role="heading" aria-level="2">docker-compose é¨ç½²åèç¹ kafka 4.0 æµè¯ç¯å¢</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>é«çæ¬kafkaå·²ç»ä¸åéè¦ZooKeeperå½ä¿å§æè½å¯å¨äºï¼ç°å¨é¨ç½²ä¸ä¸ªåæºåèç¹æµè¯ç¯å¢æ¯åæ¥æ¹ä¾¿ä¸å°ã</p>
<p>ä¸è¿æå¸¸ç¨ç<code>bitnami/kafka</code>ä¸åæä¾åè´¹éåï¼å¯¼è´æä»¬åªè½ç¨<code>apache/kafka</code>ï¼æ°éåçéç½®ä¼ç¨å¾®éº»ç¦ä¸äºï¼æä»¥è®°å½ä¸ä¸ã</p>
<p>é¨ç½²åå®¹ï¼</p>
<ul>
<li>åèç¹kafkaæå¡ï¼çæ¬4.0+</li>
<li>kafka UIï¼æ¹ä¾¿ç®¡çï¼çæ¬ç¨ææ°ç</li>
<li>å¼å¯ç®åçç¨æ·åå¯ç éªè¯</li>
</ul>
<p>docker-composeæä»¶ï¼</p>
<pre><code class="language-yaml">version: '3'

networks:
  kafka-net:

services:
  kafka:
    image: apache/kafka:latest
    container_name: kafka
    networks:
      - kafka-net
    ports:
      - "9092:9092"
    volumes:
      - ./kafka_data:/var/lib/kafka/data
      - ./kafka_server_jaas.conf:/etc/kafka/kafka_server_jaas.conf # éç½®ç¨æ·åå¯ç 
    environment:
      KAFKA_NODE_ID: 1
      KAFKA_PROCESS_ROLES: 'broker,controller'
      KAFKA_CONTROLLER_QUORUM_VOTERS: '1@localhost:9093'
      KAFKA_CONTROLLER_LISTENER_NAMES: 'CONTROLLER'
      
      # å®ä¹çå¬å¨ï¼EXTERNAL(9092) èµ° SASL è®¤è¯ï¼PLAINTEXT(29092) ç»å®¹å¨åç¨ï¼è¿éä¹æ¹ä¸º SASL ç¡®ä¿å®å¨ï¼
      KAFKA_LISTENERS: 'SASL_PLAINTEXT://0.0.0.0:29092,EXTERNAL://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093'
      KAFKA_ADVERTISED_LISTENERS: 'SASL_PLAINTEXT://kafka:29092,EXTERNAL://localhost:9092'
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: 'CONTROLLER:PLAINTEXT,SASL_PLAINTEXT:SASL_PLAINTEXT,EXTERNAL:SASL_PLAINTEXT'
      KAFKA_INTER_BROKER_LISTENER_NAME: 'SASL_PLAINTEXT'
      
      # SASL/PLAIN è®¤è¯éç½®
      KAFKA_SASL_ENABLED_MECHANISMS: 'PLAIN'
      KAFKA_SASL_MECHANISM_INTER_BROKER_PROTOCOL: 'PLAIN'
      # åè¯ Kafka è¯»åæä»¬ç JAAS æä»¶
      KAFKA_OPTS: "-Djava.security.auth.login.config=/etc/kafka/kafka_server_jaas.conf"

      # æ°æ®æä¹å
      KAFKA_LOG_DIRS: '/var/lib/kafka/data'

  kafka-ui:
    image: provectuslabs/kafka-ui:latest
    container_name: kafka-ui
    depends_on:
      - kafka
    networks:
      - kafka-net
    ports:
      # æ å°å°8090ï¼å ä¸º8080ä¸è¬è¿å¾æå¶ä»çæå¡åæµè¯
      - "8090:8080"
    environment:
      KAFKA_CLUSTERS_0_NAME: local
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka:29092
      # éç½® UI ä½¿ç¨ç¨æ·ååå¯ç è¿æ¥ Kafka
      KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL: SASL_PLAINTEXT
      KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM: PLAIN
      KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG: 'org.apache.kafka.common.security.plain.PlainLoginModule required username="ä½ éç½®çç¨æ·å" password="ä½ éç½®çå¯ç ";'
</code></pre>
<p>éç½®æä»¶éè¾å¥ç¨æ·åå¯ç ï¼</p>
<pre><code class="language-conf">KafkaServer {
    org.apache.kafka.common.security.plain.PlainLoginModule required
    username="èç¹å¨éç¾¤åéä¿¡æ¶çç¨æ·å"
    password="èç¹å¨éç¾¤åéä¿¡æ¶çå¯ç "
    # ä¸é¢è¿äºææ¯ç¨æ·éç½®
    # æ ¼å¼user_&lt;ç¨æ·å&gt;="å¯ç "
    user_apot="ä½ éç½®çå¯ç ";
};
</code></pre>
<p>åå»ºå¥½æä»¶åç®å½ä¹åç¨<code>docker-compose up -d</code>å°±è½å¯å¨æå¡äºãè®¿é®<code>localhost:8090</code>å¯ä»¥çå°kafkaçwebæ§å¶é¢æ¿ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1434464/202512/1434464-20251229202723957-374430349.png" alt="image" loading="lazy"></p>
<p>å®è£å¥½ä¹åå¯ä»¥ç¨ä¸é¢çå½ä»¤æ¥ççæ¬ï¼</p>
<pre><code class="language-console">$ docker exec -it kafka /opt/kafka/bin/kafka-server-start.sh --version

[2025-12-29 11:08:34,595] INFO Registered kafka:type=kafka.Log4jController MBean (kafka.utils.Log4jControllerRegistration$)
4.0.0
</code></pre>
<p>å¯ä»¥çå°å·²ç»éç½®å¥½äºkafka 4.0ç¯å¢ã</p>
<p><code>apache/kafka</code>çéåéåç½®äºåç§æä½kafkaçèæ¬ï¼ä¸è¿è¿äºèæ¬æ²¡è¢«æ·»å è¿<code>$PATH</code>ï¼æ§è¡çæ¶åéè¦æå®è·¯å¾ï¼</p>
<pre><code class="language-bash"># åéç½®ç»å½éªè¯ä¿¡æ¯
docker exec -it kafka bash -c "cat &lt;&lt;EOF &gt; /tmp/client.conf
security.protocol=SASL_PLAINTEXT
sasl.mechanism=PLAIN
sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required \
  username='å®¢æ·ç«¯ç»å½ç¨æ·åï¼å°±æ¯æä»¬ä¹åç¨user_xxxéç½®çé£äº' \
  password='å®¢æ·ç«¯ç»å½å¯ç ';
EOF"

# è°ç¨èæ¬åå»ºä¸ä¸ªtopicï¼éè¦æå®èæ¬è·¯å¾
docker exec -it kafka /opt/kafka/bin/kafka-topics.sh --command-config /tmp/client.conf \
  --bootstrap-server localhost:9092 \
  --create \
  --topic test.data \
  --partitions 1 \
  --replication-factor 1 \
  --config cleanup.policy=delete \
  --config retention.ms=86400000
</code></pre>
<p>ææèæ¬é½å­æ¾å¨<code>/opt/kafka/bin</code>è·¯å¾ä¸ï¼è°ç¨åè¿éè¦æä¾ç»å½å­è¯ä¿¡æ¯ï¼è¿äºéè¦æ³¨æãæå¼<code>localhost:8090</code>ä¸çweb UIï¼å°±è½æ¾å°æä»¬åååå»ºçtopicäºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1434464/202512/1434464-20251229202843717-1676041370.png" alt="image" loading="lazy"></p>
<p>è¿æå¤çç­ç¥åè¿ææ¶é´ä¹å·²ç»è¢«æ­£ç¡®è®¾ç½®ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1434464/202512/1434464-20251229203013465-1213915024.png" alt="image" loading="lazy"></p>
<p>æ»ä½èè¨æ§è¡èæ¬è¿æ¯æäºç¹çï¼ææ´æ¿æéè¿ä»£ç æèwebçé¢æ¥åè¿äºæä½ã</p>
<p>æåæä»¬åä¸ä¸ªgoçæµè¯ä»£ç ï¼åæä»¬çæµè¯ç¨åèç¹kafkaéåå¥ä¸äºæ°æ®ï¼</p>
<pre><code class="language-golang">package main

import (
	"context"
	"math/rand/v2"
	"strconv"
	"time"

	"github.com/segmentio/kafka-go"
	"github.com/segmentio/kafka-go/sasl/plain"
)

const (
	topic         = "lean.data1"
	kafkaEndpoint = "localhost:9092"
)

func main() {
	mechanism := plain.Mechanism{
		Username: "å®¢æ·ç«¯ç»å½ç¨æ·å",
		Password: "å®¢æ·ç«¯ç»å½å¯ç ",
	}

	dialer := &amp;kafka.Dialer{
		Timeout:       10 * time.Second,
		DualStack:     true,
		SASLMechanism: mechanism,
	}

	w := kafka.NewWriter(kafka.WriterConfig{
		Brokers: []string{kafkaEndpoint},
		Dialer:  dialer, // å¿é¡»ä¼ å¥å¸¦ SASL ç dialer
		Async:   false,
	})
	defer w.Close()

	msg := kafka.Message{
		Topic: topic,
		Key:   []byte("test"),
		Value: []byte(strconv.Itoa(rand.Int())), // éä¾¿åå¥ä¸äºéæºæ°æ®
	}

	ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)
	defer cancel()

	err := w.WriteMessages(ctx, msg)
	if err != nil {
		panic(err)
	}
}
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/1434464/202512/1434464-20251229202601662-326565622.png" alt="image" loading="lazy"></p>
<p>å¯ä»¥çå°æä»¬çéæºæ°å·²ç»æ­£å¸¸åå¥topicäºã</p>
<p>æ³¨æï¼è¿ä¸ªéç½®åªä½¿ç¨äºæåºæ¬çéªè¯ï¼ä¸æ¯åèç¹ï¼ä¸éåå¨æµè¯åå­¦ä¹ ä¹å¤çä»»ä½ç¨éä½¿ç¨ï¼ä¸ºäºå®å¨æä¹å»ºè®®å¨æµè¯å®æä¹åå°±ç«å»ç¨<code>docker-compose down</code>å³é­æå¡ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.008333333333333333" data-date-updated="2025-12-29 20:46">2025-12-29 20:34</span>&nbsp;
<a href="https://www.cnblogs.com/apocelipes">apocelipes</a>&nbsp;
éè¯»(<span id="post_view_count">64</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19417908);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19417908', targetLink: 'https://www.cnblogs.com/apocelipes/p/19417908', title: 'docker-compose é¨ç½²åèç¹ kafka 4.0 æµè¯ç¯å¢' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãå¤§æ°æ® & AIãFlink Agents æºç è§£è¯» --- (2) ---  æ ¸å¿æ¶æ ]]></title>
    <link>https://www.cnblogs.com/rossiXYZ/p/19369781</link>
    <guid>3e73e9ef6d384f88f508205efca71659</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/rossiXYZ/p/19369781" title="åå¸äº 2025-12-29 20:24">
    <span role="heading" aria-level="2">ãå¤§æ°æ® &amp; AIãFlink Agents æºç è§£è¯» --- (2) ---  æ ¸å¿æ¶æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="å¤§æ°æ®--aiflink-agents-æºç è§£è¯»-----2------æ ¸å¿æ¶æ">ãå¤§æ°æ® &amp; AIãFlink Agents æºç è§£è¯» --- (2) ---  æ ¸å¿æ¶æ</h1>
<p></p><div class="toc"><div class="toc-container-header">ç®å½</div><ul><li><a href="#å¤§æ°æ®--aiflink-agents-æºç è§£è¯»-----2------æ ¸å¿æ¶æ" rel="noopener nofollow">ãå¤§æ°æ® &amp; AIãFlink Agents æºç è§£è¯» --- (2) ---  æ ¸å¿æ¶æ</a><ul><li><a href="#0x00-æè¦" rel="noopener nofollow">0x00 æè¦</a></li><li><a href="#0x01-flink-agentsä¸»è¦ç»ä»¶" rel="noopener nofollow">0x01 Flink Agentsä¸»è¦ç»ä»¶</a><ul><li><a href="#11-ä¸»è¦ç»ä»¶" rel="noopener nofollow">1.1 ä¸»è¦ç»ä»¶</a></li><li><a href="#12-åé¨æååéæ å°å³ç³»" rel="noopener nofollow">1.2 åé¨æååéæ å°å³ç³»</a><ul><li><a href="#121-agent-å°-agentplan" rel="noopener nofollow">1.2.1 Agent å° AgentPlan</a></li><li><a href="#122-agentplan-å°-actionexecutionoperator" rel="noopener nofollow">1.2.2 AgentPlan å° ActionExecutionOperator</a><ul><li><a href="#è¯¦ç»æ å°åæ" rel="noopener nofollow">è¯¦ç»æ å°åæ</a><ul><li><a href="#å¨ä½æ§è¡æ å°" rel="noopener nofollow">å¨ä½æ§è¡æ å°</a></li><li><a href="#èµæºç®¡çæ å°" rel="noopener nofollow">èµæºç®¡çæ å°</a></li><li><a href="#éç½®æ å°" rel="noopener nofollow">éç½®æ å°</a></li><li><a href="#ç¶æç®¡çæ å°" rel="noopener nofollow">ç¶æç®¡çæ å°</a></li></ul></li></ul></li></ul></li><li><a href="#13-æ§è¡æµç¨" rel="noopener nofollow">1.3 æ§è¡æµç¨</a></li></ul></li><li><a href="#0x02-ä¸åçflinkæ¯å¯¹" rel="noopener nofollow">0x02 ä¸åçFlinkæ¯å¯¹</a><ul><li><a href="#21-æ ¸å¿" rel="noopener nofollow">2.1 æ ¸å¿</a></li><li><a href="#22-å·ä½æ¯å¯¹" rel="noopener nofollow">2.2 å·ä½æ¯å¯¹</a><ul><li><a href="#221-agent" rel="noopener nofollow">2.2.1 Agent</a></li><li><a href="#222-agentplan" rel="noopener nofollow">2.2.2 AgentPlan</a></li><li><a href="#223-actionexecutionoperator" rel="noopener nofollow">2.2.3 ActionExecutionOperator</a></li><li><a href="#223-actiontask" rel="noopener nofollow">2.2.3 ActionTask</a></li></ul></li></ul></li><li><a href="#0x03-å®ä¾æè§£" rel="noopener nofollow">0x03 å®ä¾æè§£</a><ul><li><a href="#31-ç¬¬ä¸å±çº§agent--é¤åèååè§åæåblueprint" rel="noopener nofollow">3.1 ç¬¬ä¸å±çº§ï¼Agent â é¤åèååè§åæåï¼Blueprintï¼</a></li><li><a href="#32-ç¬¬äºå±çº§agentplan--é¤åçè¯¦ç»æä½æµç¨å¾compiled-planè®¡åç¼è¯å±" rel="noopener nofollow">3.2 ç¬¬äºå±çº§ï¼AgentPlan â é¤åçè¯¦ç»æä½æµç¨å¾ï¼Compiled Plan,è®¡åç¼è¯å±ï¼</a><ul><li><a href="#ç»æåè§£æ" rel="noopener nofollow">ç»æåè§£æ</a></li><li><a href="#å¹³å°ééæ§" rel="noopener nofollow">å¹³å°ééæ§</a></li></ul></li><li><a href="#33-ç¬¬ä¸å±çº§actionexecutionoperator--é¤åçæ§è¡ç®¡çå±runtime-executoræ§è¡å¼æå±" rel="noopener nofollow">3.3 ç¬¬ä¸å±çº§ï¼ActionExecutionOperator â é¤åçæ§è¡ç®¡çå±ï¼Runtime Executorï¼æ§è¡å¼æå±ï¼</a></li><li><a href="#34-ç¬¬åå±çº§actiontask--å·ä½çæå¡æ­¥éª¤execution-unit" rel="noopener nofollow">3.4 ç¬¬åå±çº§ï¼ActionTask â å·ä½çæå¡æ­¥éª¤ï¼Execution Unitï¼</a></li><li><a href="#35-å·¥ä½æµç¨ä¸¾ä¾" rel="noopener nofollow">3.5 å·¥ä½æµç¨ä¸¾ä¾</a></li></ul></li><li><a href="#0x04-å¹¶åæ§åå¹¶è¡æ§" rel="noopener nofollow">0x04 å¹¶åæ§åå¹¶è¡æ§</a><ul><li><a href="#41-flinkåçå¹¶åæ¨¡å" rel="noopener nofollow">4.1 Flinkåçå¹¶åæ¨¡å</a></li><li><a href="#42-æ¯ä¸ªkeyçç¶æç®¡ç" rel="noopener nofollow">4.2 æ¯ä¸ªKeyçç¶æç®¡ç</a></li><li><a href="#43-é®ç®±çº¿ç¨æ¨¡å" rel="noopener nofollow">4.3 é®ç®±çº¿ç¨æ¨¡å</a></li><li><a href="#44-å¼æ­¥ä»»å¡å¤ç" rel="noopener nofollow">4.4 å¼æ­¥ä»»å¡å¤ç</a></li><li><a href="#45-åå­ä¸è´æ§" rel="noopener nofollow">4.5 åå­ä¸è´æ§</a></li><li><a href="#46-æ°´å°åäºä»¶æ¶é´å¤ç" rel="noopener nofollow">4.6 æ°´å°åäºä»¶æ¶é´å¤ç</a></li><li><a href="#47-æ£æ¥ç¹åæ¢å¤" rel="noopener nofollow">4.7 æ£æ¥ç¹åæ¢å¤</a></li><li><a href="#48-æ»ç»" rel="noopener nofollow">4.8 æ»ç»</a></li></ul></li><li><a href="#0xff-åè" rel="noopener nofollow">0xFF åè</a></li></ul></li></ul></div><p></p>
<h2 id="0x00-æè¦">0x00 æè¦</h2>
<p>Flink Agents æ¡æ¶çæ ¸å¿æ¯ <strong>âäºä»¶é©±å¨ + ç¶æéç¦» + å¤è¯­è¨åä½â</strong>ï¼éè¿ Agent/AgentPlan å®ç°ä¸å¡é»è¾çå£°æå¼å®ä¹ï¼åå© Flink åççåå¸å¼ãé«å¹¶åè½åå®ç°å¯é æ§è¡ï¼åæ¶æ¯æ Python çæçå·¥å· / æ¨¡åéæï¼å¼é¡¾äºå¼åçµæ´»æ§ä¸è¿è¡æ¶æçï¼éç¨äºå¤æ AI ä»£çä»»å¡çåå¸å¼é¨ç½²ä¸æ§è¡ã</p>
<p>å·ä½èè¨ï¼Flink Agents çç»ä»¶æ¯å¯¹åç Flink ç»ä»¶å¨ âAgent ä¸å¡åºæ¯â ä¸çè¯­ä¹åå°è£ï¼èéå¨æ°åæãå æ­¤ï¼æ¬æå°åä»ç»Flink Agentsçåºæ¬ç»ä»¶ï¼ç¶åå°å¶ç»ä»¶ä¸Flink åçç»ä»¶åå¯¹æ¯ï¼æåç»åºä¸ä¸ªè¯¦ç»çä¾å­ï¼è¿æ ·è¯»èå¯ä»¥æ´å¥½ççè§£å¶è®¾è®¡ç²¾è¦ã</p>
<h2 id="0x01-flink-agentsä¸»è¦ç»ä»¶">0x01 Flink Agentsä¸»è¦ç»ä»¶</h2>
<p>å¯ä»¥æ Flink Agents çæ´ä¸ªæ§è¡æµç¨æ¯ä½ âåä¸éèâï¼æä»¬åæ­¤è¿è¡åæã</p>
<h3 id="11-ä¸»è¦ç»ä»¶">1.1 ä¸»è¦ç»ä»¶</h3>
<p>Flink Agents æ¯åºäºåç Flink åå¸å¼æµå¤çè½åå°è£çä¸å±æ¡æ¶ãå¶ä¸­åä¸ªä¸»è¦ç»ä»¶ä»£è¡¨äº Flink Agents æ¡æ¶ä¸­çåä¸ªå±æ¬¡ï¼</p>
<ul>
<li><strong>Agentï¼é¡¶å±è®¾è®¡ï¼å®ä¹äºâåä»ä¹âï¼</strong>ï¼ç¨æ·å®ä¹çæºè½å®ä½ï¼ç±»ä¼¼ âé¤åèå + è§åæåâï¼åå«ä¸å¡é»è¾ãå¨ä½ï¼Actionï¼åèµæºï¼å·¥å·ãæ¨¡åç­ï¼å®ä¹ï¼æç¡® âåä»ä¹âã</li>
<li><strong>AgentPlanï¼ä¸­é´ç¼è¯å±ï¼ç¡®å®äºâæä¹åâï¼</strong>ï¼å° Agent ç¼è¯åçå¯æ§è¡è®¡åï¼ç±»ä¼¼ âè¯¦ç»æä½æµç¨å¾âï¼æç¡®å¨ä½è§¦åè§åãèµæºæ å°å³ç³»ï¼ç¡®å® âæä¹åâã</li>
<li><strong>ActionExecutionOperatorï¼è¿è¡æ¶æ§è¡å±ï¼æ¯æ§è¡ç¯å¢ï¼è´è´£âåè°è°åº¦âï¼</strong>ï¼Flink éç¾¤ä¸­çæ§è¡æ ¸å¿ï¼å¨ Flink æµå¤çç¯å¢ä¸­å®éæ§è¡æä½ï¼ç±»ä¼¼ âé¤åé¦å¸­å¤§å¨âï¼è´è´£æ¥æ¶æ°æ®ãè°åº¦ä»»å¡ãç®¡çç¶æï¼åè°æ´ä½æ§è¡æµç¨ã</li>
<li><strong>ActionTaskï¼æå°æ§è¡ååï¼è´è´£âå·ä½å®æ½âï¼</strong>ï¼å·ä½çæ§è¡ä»»å¡ï¼ç±»ä¼¼ âåå·¥çåä¸ªæå¡æ­¥éª¤âï¼åä¸º JavaActionTask å PythonActionTaskï¼å¤çåä¸ªäºä»¶å¹¶è¿åç»æã</li>
</ul>
<p>å·ä½å¯ä»¥åè§ä¸å¾ã</p>
<pre><code class="language-python">[Agent] èåæå
    âï¼ç¼è¯ï¼
[AgentPlan] è¯¦ç»æµç¨å¾
    âï¼è¿è¡æ¶å®ä¾åï¼
[ActionExecutionOperator] é¤åé¦å¸­å¤§å¨
    âï¼åéä»»å¡ï¼
[ActionTask] åå·¥å·ä½ä»»å¡
</code></pre>
<p>è¿æ ·çè®¾è®¡ä½¿å¾ç³»ç»æ¢çµæ´»åé«æï¼è½å¤å¤çå¤æçAIä»£çä»»å¡ï¼åæ¶ä¿è¯äºè¯å¥½çæ©å±æ§åç»´æ¤æ§ã</p>
<h3 id="12-åé¨æååéæ å°å³ç³»">1.2 åé¨æååéæ å°å³ç³»</h3>
<p>AgentãAgentPlan å ActionExecutionOperator ä¹é´çå³ç³»ä»¥åå®ä»¬åé¨æååéçæ å°å³ç³»å¦ä¸ã</p>
<h4 id="121-agent-å°-agentplan">1.2.1 Agent å° AgentPlan</h4>
<p>Agent å° AgentPlan çæ å°å¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>Agent æå</th>
<th>AgentPlan å¯¹åºæå</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>_actionsï¼è£é¥°å¨å®ä¹ï¼</td>
<td>actions, actions_by_event</td>
<td>Agent ä¸­éè¿ @action è£é¥°å¨å®ä¹çå¨ä½è¢«ç¼è¯å° AgentPlan çå¨ä½æ å°ä¸­</td>
</tr>
<tr>
<td>_actionsï¼add_action æ·»å ï¼</td>
<td>actions, actions_by_event</td>
<td>éè¿ add_action æ¹æ³æ·»å çå¨ä½åæ ·ç¼è¯å°å¨ä½æ å°ä¸­</td>
</tr>
<tr>
<td>_resources</td>
<td>resource_providers</td>
<td>Agent ä¸­æ³¨åçèµæºè¢«è½¬æ¢ä¸ºèµæºæä¾è</td>
</tr>
</tbody>
</table>
<h4 id="122-agentplan-å°-actionexecutionoperator">1.2.2 AgentPlan å° ActionExecutionOperator</h4>
<p>AgentPlan å° ActionExecutionOperator çæ å°å¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>AgentPlan æå</th>
<th>ActionExecutionOperator å¯¹åºæå</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>actions</td>
<td>éè¿ getActionsTriggeredBy() æ¹æ³è°ç¨</td>
<td>Operator æ ¹æ®äºä»¶ç±»åæ¥æ¾å¯¹åºçå¨ä½</td>
</tr>
<tr>
<td>resource_providers</td>
<td>å¨ RunnerContextImpl ä¸­ä½¿ç¨</td>
<td>æä¾è¿è¡æ¶æéçèµæº</td>
</tr>
<tr>
<td>config</td>
<td>metricGroup, builtInMetrics ç­</td>
<td>ç¨äºéç½®ææ åå¶ä»è¿è¡æ¶è¡ä¸º</td>
</tr>
</tbody>
</table>
<h5 id="è¯¦ç»æ å°åæ">è¯¦ç»æ å°åæ</h5>
<h6 id="å¨ä½æ§è¡æ å°">å¨ä½æ§è¡æ å°</h6>
<p>å¨ <code>ActionExecutionOperator</code> ä¸­ï¼</p>
<pre><code class="language-java">// æ ¹æ®äºä»¶ç±»åè·åè§¦åçå¨ä½
private List&lt;Action&gt; getActionsTriggeredBy(Event event) {
    if (event instanceof PythonEvent) {
        return agentPlan.getActionsTriggeredBy(((PythonEvent) event).getEventType());
    } else {
        return agentPlan.getActionsTriggeredBy(event.getClass().getName());
    }
}

// åå»º ActionTask æ¥æ§è¡å¨ä½
private ActionTask createActionTask(Object key, Action action, Event event) {
    if (action.getExec() instanceof JavaFunction) {
        return new JavaActionTask(
            key, event, action, getRuntimeContext().getUserCodeClassLoader());
    } else if (action.getExec() instanceof PythonFunction) {
        return new PythonActionTask(key, event, action);
    }
    // ..
}
</code></pre>
<h6 id="èµæºç®¡çæ å°">èµæºç®¡çæ å°</h6>
<p><code>AgentPlan</code> ä¸­çèµæºæä¾èå¨ <code>ActionExecutionOperator</code> ä¸­éè¿ <code>RunnerContextImpl</code> è®¿é®ï¼</p>
<pre><code class="language-java">// å¨ RunnerContextImpl ä¸­
public Resource getResource(String name, ResourceType type) {
    return agentPlan.getResource(name, type);
}
</code></pre>
<h6 id="éç½®æ å°">éç½®æ å°</h6>
<p>AgentPlan ä¸­çéç½®ä¿¡æ¯è¢«ç¨äºåå§åActionExecutionOperatorçåç§è¿è¡æ¶ç»ä»¶ï¼</p>
<pre><code class="language-java">// å¨ ActionExecutionOperator.open() ä¸­
metricGroup = new FlinkAgentsMetricGroupImpl(getMetricGroup());
builtInMetrics = new BuiltInMetrics(metricGroup, agentPlan);

// ActionStateStore åå§åä¹ä¾èµäºéç½®
if (actionStateStore == null &amp;&amp; KAFKA.getType().equalsIgnoreCase(agentPlan.getConfig().get(ACTION_STATE_STORE_BACKEND))) {
    actionStateStore = new KafkaActionStateStore(agentPlan.getConfig());
}
</code></pre>
<h6 id="ç¶æç®¡çæ å°">ç¶æç®¡çæ å°</h6>
<p>ActionExecutionOperator ä¸­çåç§ç¶æä¸ AgentPlan çæ§è¡éæ±ç¸å¯¹åºï¼</p>
<pre><code class="language-java">// ç­æåå­ç¶æç¨äºå¨ä½é´çæ°æ®å±äº«
private transient MapState&lt;String, MemoryObjectImpl.MemoryItem&gt; shortTermMemState;

// å¨ä½ä»»å¡ç¶æç¨äºå¼æ­¥æ§è¡ç®¡ç
private transient ListState&lt;ActionTask&gt; actionTasksState;

// å¾å¤çäºä»¶ç¶æç¨äºæµæ§
private transient ListState&lt;Event&gt; pendingInputEventsState;
</code></pre>
<h3 id="13-æ§è¡æµç¨">1.3 æ§è¡æµç¨</h3>
<p>å·ä½æµç¨å¦ä¸ï¼</p>
<pre><code class="language-python">Action Code â Agent â AgentPlan â ActionExecutionOperator â ActionTask â Flink Runtime
</code></pre>
<p>ä»¥ ReActAgent ä¸ºä¾ï¼å¶æµç¨å¦ä¸ï¼</p>
<ul>
<li>
<p>ç¨æ·å®ä¹ ReActAgentï¼åå« <code>start_action</code> å <code>stop_action</code></p>
</li>
<li>
<p>éè¿ <code>AgentPlan.from_agent()</code> ç¼è¯æè®¡åï¼</p>
<ul>
<li>
<p><code>actions</code>ï¼åå« <code>start_action</code> å <code>stop_action</code></p>
</li>
<li>
<p><code>actions_by_event</code>ï¼æ å° <code>InputEvent</code> â <code>start_action</code>ï¼<code>ChatResponseEvent</code> â <code>stop_action</code></p>
</li>
</ul>
</li>
<li>
<p>å¨è¿è¡ç¯å¢ä¸­ï¼AgentPlan è¢«ä¼ éç» ActionExecutionOperatorFactoryãActionExecutionOperatorFactory åå»º ActionExecutionOperator å®ä¾ã</p>
</li>
<li>
<p>ActionExecutionOperator å¨è¿è¡æ¶æ ¹æ® AgentPlan æ§è¡å·ä½æä½ãå¨ ActionExecutionOperator ä¸­ï¼</p>
<ul>
<li>æ¥æ¶å° InputEvent åï¼æ¥æ¾å¹¶æ§è¡ start_action</li>
<li>start_action åé ChatRequestEvent</li>
<li>æ¥æ¾å¹¶æ§è¡å¤ç ChatRequestEvent çåç½®å¨ä½ï¼å¦ CHAT_MODEL_ACTIONï¼</li>
<li>PythonActionTask æ§è¡å·¥å·å½æ°ï¼è¥ä¸ºçæå¨ååå»º PythonGeneratorActionTask æç»­æ§è¡ï¼</li>
<li>å·¥å·æ§è¡å®æçæ ChatResponseEvent</li>
<li>æ¥æ¾å¹¶æ§è¡ stop_action</li>
<li>stop_action äº§ç OutputEvent å¹¶åéå°ä¸æ¸¸</li>
</ul>
</li>
</ul>
<p>è¿ç§è®¾è®¡å®ç°äºå³æ³¨ç¹åç¦»ï¼ç¨æ·åªéå³æ³¨ä¸å¡é»è¾å®ä¹ï¼æ¡æ¶è´è´£å°å¶ç¼è¯ä¸ºé«æçè¿è¡æ¶æ§è¡è®¡åã</p>
<h2 id="0x02-ä¸åçflinkæ¯å¯¹">0x02 ä¸åçFlinkæ¯å¯¹</h2>
<p>Flink Agents æ¯åç Flink ç âé¢åå°è£âï¼ææç»ä»¶é½è½æ å°å°åç Flink æ ¸å¿ç»ä»¶ï¼æªè±ç¦» Flink æµå¤ççæ ¸å¿æ¶æãæä»¬æ¥ä¸æ¥çç Flink Agents éç AgentãAgentPlanãActionExecutionOperatorãActionTask è¿äºæ ¸å¿ç»ä»¶ï¼åå«å¯¹åºåç Flink ä¸­çåªäºæ ¸å¿ç»ä»¶ï¼ä»¥åå®ä»¬çç¸ä¼¼æ§é»è¾ã</p>
<h3 id="21-æ ¸å¿">2.1 æ ¸å¿</h3>
<p>æä»¬åç¨ä¸å¼ è¡¨æ¥æ¦æ¬æ¯å¯¹å³ç³»ã</p>
<table>
<thead>
<tr>
<th>Flink Agents ç»ä»¶</th>
<th>åç Flink å¯¹åºç»ä»¶</th>
<th>æ ¸å¿è§è²</th>
</tr>
</thead>
<tbody>
<tr>
<td>Agent</td>
<td>StreamGraph / ç¨æ· DataStream ä»£ç </td>
<td>é«å±ä¸å¡é»è¾å£°æï¼åä»ä¹ï¼</td>
</tr>
<tr>
<td>AgentPlan</td>
<td>JobGraph</td>
<td>ç¼è¯åçå¯æ§è¡è®¡åï¼æä¹æï¼</td>
</tr>
<tr>
<td>ActionExecutionOperator</td>
<td>KeyedProcessOperator/StreamOperator</td>
<td>è¿è¡æ¶æ ¸å¿æ§è¡ç®å­ï¼æ ¸å¿è½½ä½ï¼</td>
</tr>
<tr>
<td>ActionTask</td>
<td>ç®å­åå¤çåå / AsyncFunction ä»»å¡</td>
<td>åå­æ§è¡ä»»å¡ï¼æå°æ§è¡ååï¼</td>
</tr>
</tbody>
</table>
<p>æ ¸å¿æ å°é»è¾å¦ä¸ï¼ãå£°æå±ï¼Agentï¼â ç¼è¯å±ï¼AgentPlanï¼â æ§è¡ç®å­ï¼ActionExecutionOperatorï¼â åå­ä»»å¡ï¼ActionTaskï¼ãå¯¹åºåç Flink çãStreamGraph â JobGraph â StreamOperator â ç®å­åå¤çååãï¼</p>
<p>åå° âåä¸éèâ ï¼æä»¬è¿è¡åæå¯¹æ¯ã</p>
<ul>
<li>Agent = ä½ åç âèè°±é»è¾âï¼æ¯å¦ âåçªèçèï¼åçèåççªèâï¼â å¯¹åº Flink StreamGraphï¼çº¯é»è¾ï¼ï¼</li>
<li>AgentPlan = é¤ååå¨æèè°±è½¬æ¢æç âå¯æ§è¡å·¥åâï¼æç¡® âè°æ¥çãç¨åªä¸ªéãæ¾å¤å°çâï¼â å¯¹åº  Flink JobGraphï¼å¯æ§è¡è®¡åï¼ï¼</li>
<li>ActionExecutionOperator = æåºå¨å¸ï¼æ§è¡å·¥åï¼â å¯¹åº Flink  StreamOperatorï¼</li>
<li>ActionTask = å¨å¸ç âåä¸ªç¿»çå¨ä½ââ å¯¹åº Flink ç®å­åçåå­å¤çä»»å¡ï¼</li>
<li>Flink ExecutionGraph = å¨å¸å®éç«å¨åªä¸ªç¶å°ãç¨åªå¥å¨å· â ç©çæ§è¡å±ï¼å AgentPlan æ å³ã</li>
</ul>
<h3 id="22-å·ä½æ¯å¯¹">2.2 å·ä½æ¯å¯¹</h3>
<h4 id="221-agent">2.2.1 Agent</h4>
<ul>
<li><strong>ç¸ä¼¼ç»ä»¶</strong>ï¼Flink Job çä¸å¡é»è¾å®ä¹ï¼å¦ DataStream ç®å­é¾ï¼ãStreamGraphï¼æµå¼ä½ä¸çé»è¾ææï¼</li>
<li><strong>ç¸ä¼¼æ§æ ¸å¿</strong>ï¼Agent æ¯ç¨æ·å®ä¹ç âæºè½å®ä½âï¼åå«ä¸å¡é»è¾ãå¨ä½ãèµæºï¼ï¼æ¬è´¨æ¯ä¸å¡å±é¢ç âä½ä¸é»è¾å£°æâï¼è¿ååç Flink ä¸­ç¨æ·ç¼åç DataStream ä»£ç ï¼å®ä¹ âæ°æ®æä¹å¤çâï¼ãStreamGraphï¼æè¿°é»è¾ææï¼çè§è²å®å¨ä¸è´ ââ é½æ¯ âåè¯ç³»ç»è¦åä»ä¹â çé¡¶å±é»è¾å®ä¹ï¼ä¸æ¶åå·ä½æ§è¡ã</li>
<li><strong>å·®å¼</strong>ï¼Agent æ´èç¦ âAgent è¡ä¸º / å·¥å·è°ç¨â çè¯­ä¹ï¼èåç StreamGraph æ¯éç¨çæ°æ®æµææã</li>
</ul>
<h4 id="222-agentplan">2.2.2 AgentPlan</h4>
<ul>
<li><strong>ç¸ä¼¼ç»ä»¶</strong>ï¼Flink ç JobGraphï¼StreamGraph ç¼è¯åçå¯æ§è¡ææï¼</li>
<li><strong>ç¸ä¼¼æ§æ ¸å¿</strong>ï¼AgentPlan æ¯ Agent ç¼è¯åç âå¯æ§è¡è®¡åâï¼æç¡®å¨ä½è§¦åè§åãèµæºæ å°ï¼ï¼æ¬è´¨æ¯å°é«å±ä¸å¡é»è¾è½¬æ¢ä¸ºç³»ç»å¯è¯å«çæ§è¡è®¡åï¼è¿ååç Flink ä¸­ StreamGraph ç¼è¯ä¸º JobGraph çè¿ç¨ä¸è´ ââJobGraph æç¨æ·çé»è¾ææè½¬æ¢ä¸ºåå«å¹¶è¡åº¦ãç®å­é¾ãä¸­é´ç»æä¼ éçå¯æ§è¡ææï¼AgentPlan åæ Agent ç âè¡ä¸ºè§åâ è½¬æ¢ä¸ºç³»ç»å¯è°åº¦ç âå¨ä½æ§è¡è§åâã</li>
<li><strong>å³é®å±æ§</strong>ï¼é½æ¯ âç¼è¯å±â äº§ç©ï¼è¿æ¥é«å±å®ä¹ä¸åºå±æ§è¡ã</li>
</ul>
<h4 id="223-actionexecutionoperator">2.2.3 ActionExecutionOperator</h4>
<ul>
<li>
<p><strong>ç¸ä¼¼ç»ä»¶</strong>ï¼Flink æ ¸å¿ç StreamOperatorï¼å¦ ProcessOperatorãFlatMapOperatorï¼ãKeyedProcessOperator</p>
</li>
<li>
<p><strong>ç¸ä¼¼æ§æ ¸å¿</strong>ï¼ActionExecutionOperator æ¯ Flink éç¾¤ä¸­æ§è¡ Agent é»è¾çæ ¸å¿ç®å­ï¼æ¬è´¨æ¯è¿è¡æ¶çæ ¸å¿æ§è¡ååï¼è¿ååç Flink ç StreamOperator å®å¨å¯¹åº ââStreamOperator æ¯å¤çæ°æ®æµçæ ¸å¿è½½ä½ï¼å¦ ProcessOperator å¤ç KeyedStreamãå®ç°ç¶æç®¡çï¼ï¼ActionExecutionOperator å°±æ¯éå¯¹ âAgent å¨ä½æ§è¡â åºæ¯å®å¶ç StreamOperatorï¼</p>
<ul>
<li>é½è¿è¡å¨ TaskManager ä¸­ï¼å¤çæµæ°æ®ï¼Eventï¼ï¼</li>
<li>é½æ¯æé®æ§ç¶æï¼Keyed Stateï¼ï¼æ key éç¦»æ§è¡ä¸ä¸æï¼</li>
<li>é½ä¾èµ Mailbox æºå¶è°åº¦ä»»å¡ï¼é¿åé»å¡ï¼</li>
<li>é½è´è´£ç¶æç®¡çãäºä»¶å¤çãç»æè¾åºã</li>
</ul>
</li>
<li>
<p><strong>å¸åå¯¹åº</strong>ï¼ActionExecutionOperator ææ¥è¿åçç <code>KeyedProcessOperator</code>ï¼é®æ§å¤çãç¶æç®¡çãå¼æ­¥ä»»å¡è°åº¦ï¼ã</p>
</li>
</ul>
<h4 id="223-actiontask">2.2.3 ActionTask</h4>
<ul>
<li>
<p><strong>ç¸ä¼¼ç»ä»¶</strong>ï¼Flink çãç®å­åçå¤çä»»å¡ãï¼å¦ ProcessFunction ä¸­çåä¸ªåç´ å¤çé»è¾ï¼ãAsync I/O ä¸­ç <code>AsyncFunction</code> ä»»å¡</p>
</li>
<li>
<p><strong>ç¸ä¼¼æ§æ ¸å¿</strong>ï¼ActionTask æ¯ âæå°æ§è¡ååâï¼å¦åä¸ª Python/Java å¨ä½æ§è¡ï¼ï¼æ¬è´¨æ¯ç®å­åçåå­å¤çä»»å¡ï¼è¿ååç Flink ä¸­ï¼</p>
<ul>
<li>ProcessOperator å¤çåä¸ª StreamElementï¼å¦ä¸æ¡æ°æ®ï¼çé»è¾ååï¼</li>
<li>Async I/O ä¸­ AsyncFunction å°è£çå¼æ­¥ä»»å¡ï¼å¦å¼æ­¥æ¥è¯¢æ°æ®åºï¼ï¼</li>
</ul>
<p>è§è²å®å¨ä¸è´ ââ é½æ¯ âç®å­åçæå°å¯æ§è¡ä»»å¡âï¼æ§è¡å®æåè¿åç»æï¼æ¯æå¼æ­¥ / åé¶æ®µæ§è¡ã</p>
</li>
<li>
<p><strong>å³é®å±æ§</strong>ï¼</p>
<ul>
<li>é½æ¯ âåå­æ§è¡ååâï¼ä¸å¯åæåï¼</li>
<li>æ¯æå¼æ­¥æ§è¡ï¼å¦ PythonActionTask å¯¹åº Async I/Oï¼ï¼</li>
<li>æ§è¡ç»æå¯è§¦ååç»­ä»»å¡ï¼å¦ ActionTaskResult çææ°ä»»å¡ï¼å¯¹åº Async I/O åè°è§¦ååç»­å¤çï¼ã</li>
</ul>
</li>
<li>
<p><strong>ç»åå¯¹åº</strong>ï¼</p>
<ul>
<li>JavaActionTask â åçåæ­¥å¤çä»»å¡ï¼å¦ ProcessFunction ä¸­çåæ­¥é»è¾ï¼ï¼</li>
<li>PythonActionTask â åç Async I/O ä»»å¡ï¼å¼æ­¥è°ç¨å¤é¨æå¡ / èæ¬ï¼ã</li>
</ul>
</li>
</ul>
<h2 id="0x03-å®ä¾æè§£">0x03 å®ä¾æè§£</h2>
<p>æä»¬æ¥è¿ä¸æ­¥è§£é Flink Agents è¿å ä¸ªæ ¸å¿æ¦å¿µçå³ç³»åéåãä¸ºäºæ´å¥½çè¯´æï¼æä»¬å¯ä»¥ææ´ä¸ªFlink Agentsç³»ç»ä»âåä¸éèâæå±å°âä¸ä¸ªæºè½é¤åèªå¨åæå¡ç³»ç»âãåæ¶ï¼ç»åå®ä¾ä¹æ·±å¥ä¸ææ¯ç»èã</p>
<h3 id="31-ç¬¬ä¸å±çº§agent--é¤åèååè§åæåblueprint">3.1 ç¬¬ä¸å±çº§ï¼Agent â é¤åèååè§åæåï¼Blueprintï¼</h3>
<p>Flink Agents ä¸­ç Agent æ¯ç¨æ·å®ä¹çæºè½å®ä½ï¼è´è´£åè°åç§èµæºåè¡ä¸ºæ¥å®æç¹å®çä»»å¡ãæä»¬æ Agent æ³è±¡æé¤åçèååè¿è¥æåï¼</p>
<ul>
<li>
<p>å®ä¹äºé¤åè½æä¾åªäºèååæå¡ï¼å¨ä½ï¼</p>
</li>
<li>
<p>è§å®äºéè¦ç¨å°åªäºè®¾å¤åé£æï¼èµæºï¼ï¼å¦åä¸ºæ°åå·¥éå¤å·¥å·ç®±ï¼å¯¹åºç¨åºåå®éç¨å°çï¼å¯ä»¥æ¯ï¼</p>
<ul>
<li>åç§ API æ¥å£ï¼ç¸å½äºå·¥å·ï¼</li>
<li>æ°æ®åºè®¿é®æéï¼ç¸å½äºåèèµæï¼</li>
<li>å³ç­é»è¾ä»£ç ï¼ç¸å½äºå¹è®­ææï¼</li>
</ul>
</li>
<li>
<p>éå°ä»ä¹æåµåºè¯¥åä»ä¹ï¼å¯¹åºäºä»¶çå¬ï¼</p>
</li>
<li>
<p>æè¿°äºé¡¾å®¢ç¹é¤å°ä¸èçå®æ´æµç¨</p>
<ul>
<li>æä¸ä¸ª start_actionï¼æ¥å¾åï¼è´è´£æ¥æ¶é¡¾å®¢é®é¢</li>
<li>æä¸ä¸ª stop_actionï¼æ¶é¶åï¼è´è´£æç»ç»è´¦è¾åºç»æ</li>
</ul>
</li>
</ul>
<p>è¿äºé½è¢«å°è£å¨ Agent å¯¹è±¡ä¸­ã</p>
<h3 id="32-ç¬¬äºå±çº§agentplan--é¤åçè¯¦ç»æä½æµç¨å¾compiled-planè®¡åç¼è¯å±">3.2 ç¬¬äºå±çº§ï¼AgentPlan â é¤åçè¯¦ç»æä½æµç¨å¾ï¼Compiled Plan,è®¡åç¼è¯å±ï¼</h3>
<p>Flink Agentæ¡æ¶ä¼æç¨æ·ç Agent è½¬æ¢ä¸ºä¸ä¸ªæ´éç¨ãæ´éåç³»ç»å¤ççå½¢å¼ ââ AgentPlanãå¨æ¬ä¾ä¸­ï¼AgentPlan ç¸å½äºå°é¤åè¿è¥æåç¼è¯æçè¯¦ç»å·¥ä½æµç¨å¾ï¼æ½è±¡åçå·¥ä½èå¾ï¼ï¼</p>
<ul>
<li>æèåä¸çæ¯éèåè§£æå·ä½çæ­¥éª¤</li>
<li>æç¡®æ¯ä¸ªå²ä½ï¼å¨ä½ï¼å¨ä»ä¹æåµä¸è¢«è§¦åï¼å³éå°å¥äºä»¶ï¼Eventï¼è¯¥å¹²å¥æ´»ï¼Actionï¼</li>
<li>åå¤å¥½ææéè¦çå·¥å·åæææ¸åï¼Resourceï¼</li>
</ul>
<p>å°±åé¤åç»çä¼å¶å®è¯¦ç»çæä½æåï¼åè¯æå¡åä»ä¹æ¶åè¯¥åä»ä¹äºã</p>
<h4 id="ç»æåè§£æ">ç»æåè§£æ</h4>
<p>AgentPlan åå«å ä¸ªå³é®é¨åï¼</p>
<p><strong>Actions æ å°è¡¨</strong></p>
<ul>
<li>æç¡®ååºææå¯ä»¥æ§è¡çå¨ä½åå¶è§¦åæ¡ä»¶</li>
<li>ä¾å¦ï¼âæ¶å°è®¢åæ¥è¯¢è¯·æ±â â âæ§è¡è®¢åæ¥è¯¢å¨ä½â</li>
</ul>
<p><strong>èµæºæä¾èç®å½</strong></p>
<ul>
<li>è®°å½ææå¯ç¨èµæºçä½ç½®åè·åæ¹å¼</li>
<li>ç±»ä¼¼äºå·¥åéåä¸ªä¾åºé¨é¨çèç³»æ¹å¼æ¸å</li>
</ul>
<p><strong>éç½®åæ°é</strong></p>
<ul>
<li>å­å¨è¿è¡æéçåé¡¹è®¾ç½®éé¡¹</li>
<li>åæ¯è®¾å¤æä½è§ç¨åææ¯è§è</li>
</ul>
<h4 id="å¹³å°ééæ§">å¹³å°ééæ§</h4>
<p>éè¿è¿ç§æ½è±¡åï¼æ è®ºåºå±æ¯ Java è¿æ¯ Python å®ç°ï¼é½å¯ä»¥ç»ä¸ç¨åä¸ä»½ AgentPlan æ¥è¿è¡è°åº¦ç®¡çã</p>
<h3 id="33-ç¬¬ä¸å±çº§actionexecutionoperator--é¤åçæ§è¡ç®¡çå±runtime-executoræ§è¡å¼æå±">3.3 ç¬¬ä¸å±çº§ï¼ActionExecutionOperator â é¤åçæ§è¡ç®¡çå±ï¼Runtime Executorï¼æ§è¡å¼æå±ï¼</h3>
<p>å¨å¤§è§æ¨¡çäº§ç¯å¢ä¸­ï¼ä¸è½åªé ä¸ä¸ªç®¡å®¶å¹²æ´»ï¼èæ¯éè¦ä¸æ¡èªå¨åæµæ°´çº¿ãActionExecutionOperator å°±åæ¯ä¸æ¡æºè½åçå·¥åè£éçº¿ï¼å®æç§æä½æåï¼AgentPlanï¼ç»ç»å¤ä¸ªå·¥ä½ç«æ¥ååå®æä»»å¡ãæèè¯´ï¼ActionExecutionOperator æ¯é¤åçç°åºæ§è¡ç®¡çå±ï¼æ¯æ´ä¸ªç³»ç»çâå¤§è + ä¸­æ¢æ§å¶å®¤âï¼</p>
<ul>
<li>è´è´£æ¥å¾è¿åºçé¡¾å®¢ï¼æ¥æ¶æ°æ®ï¼</li>
<li>æ ¹æ®æµç¨å¾åéä»»å¡ç»ä¸åçåå·¥ï¼æ§è¡å¨ä½ï¼</li>
<li>åè°åä¸ªå²ä½ä¹é´çå·¥ä½ï¼çæ§è¿åº¦ç¶æ / ç®¡çç¶æååå­ï¼</li>
<li>ç¡®ä¿æå¡æµç¨é¡ºçï¼å¤çå¹¶ååå®¹éï¼</li>
<li>é¤åç»çæ¿çè¯¦ç»æµç¨å¾ï¼ææ¥åä¸ªåå·¥ååå·¥ä½ã</li>
</ul>
<h3 id="34-ç¬¬åå±çº§actiontask--å·ä½çæå¡æ­¥éª¤execution-unit">3.4 ç¬¬åå±çº§ï¼ActionTask â å·ä½çæå¡æ­¥éª¤ï¼Execution Unitï¼</h3>
<p>ActionTask å°±åæ¯åå·¥æ§è¡çå·ä½æå¡æ­¥éª¤ï¼æ¯çäº§çº¿ä¸çæå°å·¥ä½ï¼ä¸æ¬¡åªå¹²ä¸ä»¶å·ä½æ´»ï¼è°ç¨ Python å½æ°ãæ¥æ°æ®åºãå HTTPãå Kafka â¦ï¼ï¼</p>
<ul>
<li>æ¯ä¸ªæå¡åæ¥å°çä»»å¡å°±æ¯ä¸ä¸ª ActionTask</li>
<li>å¯è½æ¯ç®åä¸æ­¥å®æï¼æ®éæå¡åï¼</li>
<li>å¯è½æ¯éè¦å¤æ­¥å®æï¼éè¦åè®¿çææ¯åï¼ï¼å³å¦ææ´»å¤ªå¤ï¼å¼æ­¥ãé¿èæ¶ï¼ï¼æå¡åä¼æèªå·±ãååãææ°ä»»å¡ï¼ç­ä¸æ¬¡è½®è¯¢åæ¥çå¹²ï¼å®ç°éé»å¡çåä½å¼è°åº¦ã</li>
<li>å®æåæ¥åç»æï¼å¹¶å¯è½è§¦åä¸ä¸æ­¥å·¥ä½ï¼å³å¹²å®å°±è½ç«å³æç»æï¼Eventï¼æåä¼ éå¸¦ï¼ç»§ç»­ä¸ä¸è½®</li>
</ul>
<h3 id="35-å·¥ä½æµç¨ä¸¾ä¾">3.5 å·¥ä½æµç¨ä¸¾ä¾</h3>
<p>åè®¾é¡¾å®¢æ¥å°é¤åç¹äºä¸ä»½å¤æçå¥é¤ï¼</p>
<ul>
<li>é¡¾å®¢è¿åºï¼InputEventï¼
<ul>
<li>é¤åç»çï¼ActionExecutionOperatorï¼æ¥å¾é¡¾å®¢</li>
<li>æ ¹æ®æµç¨å¾ç¥éåºè¯¥è®©æ¥å¾åï¼start_actionï¼å¤ç</li>
</ul>
</li>
<li>æ¥å¾åå¤çï¼ActionTaskï¼
<ul>
<li>æ¥å¾åï¼PythonActionTaskï¼æ¥å°ä»»å¡</li>
<li>çè§£é¡¾å®¢éæ±ï¼çæå¨æ¿è®¢åï¼ChatRequestEventï¼</li>
</ul>
</li>
<li>å¨æ¿å¶ä½ï¼åç½®å¨ä½ï¼
<ul>
<li>å¨å¸ï¼CHAT_MODEL_ACTIONï¼æ¶å°è®¢åå¼å§å¶ä½</li>
<li>å¶ä½å®æåéç¥æå¡åï¼ChatResponseEventï¼</li>
</ul>
</li>
<li>æ¶é¶ç»è´¦ï¼ActionTaskï¼
<ul>
<li>æ¶é¶åï¼stop_actionï¼å¤çæç»ç»æ</li>
<li>é¡¾å®¢æåå¸¦èµ°ï¼OutputEventï¼</li>
</ul>
</li>
</ul>
<p>ãç¨æ·åªç®¡æç®¡å®¶è®­å¥½ï¼æ¡æ¶è´è´£æç®¡å®¶åææåï¼åææååæå¹¶è¡çäº§çº¿ï¼æåè®©æ æ°workeræ key éç¦»ãäºä»¶é©±å¨ãå¯æ£æ¥ç¹çæ¹å¼è·å¨ Flink ä¸ããã</p>
<h2 id="0x04-å¹¶åæ§åå¹¶è¡æ§">0x04 å¹¶åæ§åå¹¶è¡æ§</h2>
<p>Flink Agents ç³»ç»å¨è®¾è®¡æ¶å·²ç»ååèèäºå¹¶åæ§åå¹¶è¡æ§ï¼æ¯å¦ï¼</p>
<ul>
<li><strong>äºä»¶é©±å¨æ¨¡å</strong>ï¼åºäºäºä»¶æµè½¬è§¦åå¨ä½ï¼åå§ä¸º InputEventï¼ç»å¤è½®äºä»¶ï¼å¦ ChatRequestEventãChatResponseEventï¼è§¦åï¼æç»è¾åº OutputEventã</li>
<li><strong>å¹¶åä¸éç¦»è®¾è®¡</strong>ï¼å©ç¨ Flink é®æ§æµï¼KeyedStreamï¼å®ç°æ key ååºï¼æ¯ä¸ª key æ¥æç¬ç«ç¶æï¼éè¿é®ç®±çº¿ç¨æ¨¡åï¼MailboxExecutorï¼å®ç°åä½å¼å¤ä»»å¡ï¼é¿åé»å¡ã</li>
<li><strong>ä»»å¡ååæºå¶</strong>ï¼é¿æ¶é´è¿è¡çä»»å¡ï¼å¦ Python çæå¨ï¼ä¼è¢«ååä¸ºå¤ä¸ª ActionTaskï¼æ§è¡åéè¿ ActionTaskResult ä¼ éä¸ä¸ä¸ªä»»å¡ï¼ç¡®ä¿å¹¶åæçã</li>
<li><strong>æ¬å°ä¸è¿ç¨æ§è¡</strong>ï¼æ¬å°ç¨ LocalRunner æ¨¡ææ§è¡ï¼è¿ç¨åºäº Flink éç¾¤ç ActionExecutionOperator åå¸å¼æ§è¡ï¼ä¿æ API ä¸è´æ§ã</li>
</ul>
<p>ä»¥ä¸æ¯å·ä½å®ç°æ¹å¼ï¼</p>
<h3 id="41-flinkåçå¹¶åæ¨¡å">4.1 Flinkåçå¹¶åæ¨¡å</h3>
<p>ç³»ç»ååå©ç¨äºApache Flinkçåçå¹¶åæºå¶ï¼</p>
<ul>
<li>é®æ§æµï¼Keyed Streamsï¼ï¼ä½¿ç¨FlinkçKeyedStreamækeyå¯¹æ°æ®è¿è¡ååºï¼ç¡®ä¿ç¸åkeyçäºä»¶ç±åä¸ä¸ªå¹¶è¡å®ä¾å¤ç</li>
<li>å¹¶è¡æä½ç¬¦ï¼ActionExecutionOperatorå¯ä»¥å¨Flinkéç¾¤ä¸­çå¤ä¸ªå®ä¾ä¸å¹¶è¡è¿è¡</li>
</ul>
<pre><code class="language-java">// å¨CompileUtils.javaä¸­ - å°ä»£çè¿æ¥å°é®æ§æµ
public static &lt;IN, K&gt; DataStream&lt;Object&gt; connectToAgent(
    DataStream&lt;IN&gt; inputStream, KeySelector&lt;IN, K&gt; keySelector, AgentPlan agentPlan) {
    return connectToAgent(inputStream.keyBy(keySelector), agentPlan);
}
</code></pre>
<p>å¨ RemoteExecutionEnvironment ä¸­æï¼</p>
<pre><code class="language-java">@Override
public DataStream&lt;Object&gt; toDataStream() {
    if (agentPlan == null) {
        throw new IllegalStateException("Must apply agent before calling toDataStream");
    }

    if (outputDataStream == null) {
        if (keySelector != null) {
            outputDataStream =
                    CompileUtils.connectToAgent(inputDataStream, keySelector, agentPlan);
        } else {
            // If no key selector provided, use a simple pass-through key selector
            outputDataStream =
                    CompileUtils.connectToAgent(inputDataStream, x -&gt; x, agentPlan);
        }
    }

    return outputDataStream;
}
</code></pre>
<h3 id="42-æ¯ä¸ªkeyçç¶æç®¡ç">4.2 æ¯ä¸ªKeyçç¶æç®¡ç</h3>
<p>æ¯ä¸ªkeyé½ç»´æ¤ç¬ç«çç¶æéç¦»ï¼</p>
<pre><code class="language-java">// å¨ActionExecutionOperator.javaä¸­ - ç»´æ¤æ¯ä¸ªkeyçç¶æ
private transient ListState&lt;ActionTask&gt; actionTasksKState;
private transient ListState&lt;Event&gt; pendingInputEventsKState;
private transient ValueState&lt;Long&gt; sequenceNumberKState;
</code></pre>
<p>è¿äºé½æ¯é®æ§ç¶æï¼keyed stateï¼ï¼æå³çæ¯ä¸ªkeyé½æèªå·±çç¬ç«ç¶æå®ä¾ï¼é²æ­¢ä¸åkeyä¹é´çç«äºæ¡ä»¶ã</p>
<h3 id="43-é®ç®±çº¿ç¨æ¨¡å">4.3 é®ç®±çº¿ç¨æ¨¡å</h3>
<p>ç³»ç»ä½¿ç¨Flinkçé®ç®±çº¿ç¨æ¨¡åå®ç°åä½å¼å¤ä»»å¡å¤çï¼</p>
<pre><code class="language-java">// å¨ActionExecutionOperator.javaä¸­
private final transient MailboxExecutor mailboxExecutor;

// æäº¤ä»»å¡è¿è¡å¤ç
mailboxExecutor.submit(() -&gt; tryProcessActionTaskForKey(key), "process action task");
</code></pre>
<p>è¿åè®¸é¿æ¶é´è¿è¡çæä½è®©åºæ§å¶æï¼é²æ­¢é»å¡æ´ä¸ªæä½ç¬¦ã</p>
<h3 id="44-å¼æ­¥ä»»å¡å¤ç">4.4 å¼æ­¥ä»»å¡å¤ç</h3>
<p>æ¯æå¼æ­¥æ§è¡å¹¶å·å¤éå½çç¶æç®¡çï¼</p>
<pre><code class="language-java">// å¨ ActionTask.java ä¸­ - æ¯æåºäºå»¶ç»­çæ§è¡
public class ActionTaskResult {
    private final boolean finished;
    private final List&lt;Event&gt; outputEvents;
    private final Optional&lt;ActionTask&gt; generatedActionTaskOpt;

    // åè®¸ä¸ä¸ªå¨ä½çæå»¶ç»­ä»»å¡
    public Optional&lt;ActionTask&gt; getGeneratedActionTask() {
        return generatedActionTaskOpt;
    }
}
</code></pre>
<h3 id="45-åå­ä¸è´æ§">4.5 åå­ä¸è´æ§</h3>
<p>å·æç¼å­ç¶æè®¿é®ççº¿ç¨å®å¨åå­ç®¡çï¼</p>
<pre><code class="language-java">// å¨ ActionExecutionOperator.java ä¸­
private void createAndSetRunnerContext(ActionTask actionTask) {
    // æ­£ç¡®ç®¡ç RunnerContext çåå»ºåéç¨
    if (actionTask.getRunnerContext() != null) {
        return;
    }
    // ... åå»ºéå½ç context
}
</code></pre>
<h3 id="46-æ°´å°åäºä»¶æ¶é´å¤ç">4.6 æ°´å°åäºä»¶æ¶é´å¤ç</h3>
<p>å·å¤å¹¶åæè¯çæ°´å°å¤çï¼</p>
<pre><code class="language-java">    private transient SegmentedQueue keySegmentQueue;
    
    keySegmentQueue = new SegmentedQueue();

    @Override
    public void processWatermark(Watermark mark) throws Exception {
        keySegmentQueue.addWatermark(mark);
        processEligibleWatermarks();
    }
</code></pre>
<h3 id="47-æ£æ¥ç¹åæ¢å¤">4.7 æ£æ¥ç¹åæ¢å¤</h3>
<p>ç¨äºå®¹éççº¿ç¨å®å¨ç¶æå¿«ç§</p>
<pre><code class="language-java">    @Override
    public void snapshotState(StateSnapshotContext context) throws Exception {
        if (actionStateStore != null) {
            Object recoveryMarker = actionStateStore.getRecoveryMarker();
            if (recoveryMarker != null) {
                recoveryMarkerOpState.update(List.of(recoveryMarker));
            }
        }

        HashMap&lt;Object, Long&gt; keyToSeqNum = new HashMap&lt;&gt;();
        getKeyedStateBackend()
                .applyToAllKeys(
                        VoidNamespace.INSTANCE,
                        VoidNamespaceSerializer.INSTANCE,
                        new ValueStateDescriptor&lt;&gt;(MESSAGE_SEQUENCE_NUMBER_STATE_NAME, Long.class),
                        (key, state) -&gt; keyToSeqNum.put(key, state.value()));
        checkpointIdToSeqNums.put(context.getCheckpointId(), keyToSeqNum);

        super.snapshotState(context);
    }
</code></pre>
<h3 id="48-æ»ç»">4.8 æ»ç»</h3>
<p>è®¾è®¡éç¨äºå¤ç§å¹¶åæºå¶ï¼</p>
<ul>
<li>Flinkå¹¶è¡å¤çï¼å©ç¨Flinkåççå¹¶è¡æ§åé®æ§æµ</li>
<li>æ¯ä¸ªKeyçéç¦»ï¼æ¯ä¸ªkeyç»´æ¤ç¬ç«ç¶æï¼æ¶é¤keyä¹é´çç«äº</li>
<li>åä½å¼çº¿ç¨ï¼ä½¿ç¨é®ç®±æ§è¡å¨å®ç°éé»å¡æ§è¡</li>
<li>å¼æ­¥å»¶ç»­ï¼éè¿ä»»å¡é¾æ¯æé¿æ¶é´è¿è¡çæä½</li>
<li>çº¿ç¨å®å¨ç¶æç®¡çï¼å¯¹å±äº«èµæºè¿è¡éå½çåæ­¥</li>
<li>å®¹éæºå¶ï¼æ£æ¥ç¹æºå¶ç¡®ä¿æéæåµä¸çæ°æ®ä¸è´æ§</li>
</ul>
<p>è¿ç§æ¹æ³ä½¿ç³»ç»è½å¤å¨ä¿æä¸è´æ§åæ¯ææ°´å¹³æ©å±çåæ¶å¤çé«ååéï¼å¯å¨ Flink éç¾¤çå¤ä¸ªèç¹é´æ©å±ã</p>
<h2 id="0xff-åè">0xFF åè</h2>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-29 20:25">2025-12-29 20:24</span>&nbsp;
<a href="https://www.cnblogs.com/rossiXYZ">ç½è¥¿çæè</a>&nbsp;
éè¯»(<span id="post_view_count">21</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19369781);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19369781', targetLink: 'https://www.cnblogs.com/rossiXYZ/p/19369781', title: 'ãå¤§æ°æ® &amp;amp; AIãFlink Agents æºç è§£è¯» --- (2) ---  æ ¸å¿æ¶æ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Java åªäºæåµä¼å¯¼è´åå­æ³æ¼ ]]></title>
    <link>https://www.cnblogs.com/yanshajiuzhou/p/19417793</link>
    <guid>75a705f582bb3bfbbaeb52795caf73eb</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yanshajiuzhou/p/19417793" title="åå¸äº 2025-12-29 19:29">
    <span role="heading" aria-level="2">Java åªäºæåµä¼å¯¼è´åå­æ³æ¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        åå­æ³æ¼ æ¯æå¯¹è±¡ å·²ç»ä¸åè¢«ç¨åºä½¿ç¨ï¼ä½å ä¸ºæäºåå  æ æ³è¢«åå¾åæ¶å¨åæ¶ï¼é¿æå ç¨åå­ï¼æç»å¯è½å¼å&nbsp;OOMï¼OutOfMemoryErrorï¼ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><span data-cke-copybin-start="1">â</span>ä»å¤©æä»¬æ¥ä¸èµ·èä¸èæåªäºæåµä¼å¯¼è´åå­æ³æ¼ã</p>
<p>ä»ä¹æ¯ <strong>åå­æ³æ¼</strong> å¢ï¼</p>
<p><strong>åå­æ³æ¼</strong> æ¯æå¯¹è±¡ <strong>å·²ç»ä¸åè¢«ç¨åºä½¿ç¨</strong>ï¼ä½å ä¸ºæäºåå  <strong>æ æ³è¢«åå¾åæ¶å¨åæ¶</strong>ï¼é¿æå ç¨åå­ï¼æç»å¯è½å¼å&nbsp;<strong>OOM</strong>ï¼OutOfMemoryErrorï¼ã</p>
<p>æ¥ä¸æ¥æä»¬çä¸ä¸å¸¸è§çå ç±»åå­æ³æ¼åºæ¯ã</p>
<p><strong>1ãçå½å¨æé¿çéå</strong></p>
<p>å°å¯¹è±¡æ¾å¥ <strong>éæ</strong> æ&nbsp;<strong>çå½å¨æå¾é¿&nbsp;</strong>çéåï¼å¦ public <strong>static</strong> List&lt;Object&gt; list = new ArrayList&lt;&gt;();ï¼ï¼å³ä½¿åé¢ä¸åéè¦ï¼éåä»ææå¶å¼ç¨ï¼å¯¼è´æ æ³<strong>GC</strong>ã</p>
<p><strong>2ãæªå³é­çèµæº</strong></p>
<p>è¿æ¥ãæµç­èµæºæªè°ç¨<strong> close() </strong>æ¹æ³å³é­ãè¿äºèµæºä¸ä»å ç¨åå­ï¼è¿å¯è½å ç¨æä»¶å¥æï¼æä½ç³»ç»åéçå¯ä¸æ è¯ï¼å­å®ï¼ä½ æè½æä½æä»¶èµæºï¼ãç½ç»è¿æ¥ç­ç³»ç»èµæºãæ¯å¦&nbsp;æ°æ®åºè¿æ¥ãæä»¶æµï¼FileInputStreamï¼ãSocketè¿æ¥ ç­ã</p>
<pre class="language-java highlighter-hljs"><code>public class FileTest {
    public static void main(String[] args) {
        FileInputStream fis = null;
        try {
            fis = new FileInputStream("test.txt");
            // è¯»åæä»¶ï¼æªè°ç¨ fis.close()
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } finally {
            // æªè°ç¨ fis.close() â fis ææ Native å¼ç¨ï¼æ æ³åæ¶
        }
    }
}</code></pre>
<p><strong>3ãThreadLocal ä½¿ç¨ä¸å½</strong></p>
<p>å°å¯¹è±¡å­å¥ <strong>ThreadLocal </strong>åï¼æªå¨åç»­è°ç¨ <strong>remove()</strong> æ¸çãè¥çº¿ç¨æ¥èªçº¿ç¨æ± ï¼ä¼å¤ç¨ï¼ï¼å¶ ThreadLocalMap ä¸­çå¼ä¼ä¸ç´å­æ´»ã</p>
<pre class="language-java highlighter-hljs"><code>public class ThreadLocalTest {
    private static ThreadLocal&lt;User&gt; userThreadLocal = new ThreadLocal&lt;&gt;();

    public static void main(String[] args) {
        // çº¿ç¨æ± ï¼æ ¸å¿çº¿ç¨é¿æå­æ´»ï¼
        TThreadPoolExecutor executor = new ThreadPoolExecutor(
                2,
                4,
                10,
                TimeUnit.SECONDS,
                new ArrayBlockingQueue&lt;&gt;(100),
                new ThreadFactoryBuilder().setNameFormat("my-thread-pool-%d").setDaemon(false).setPriority(Thread.NORM_PRIORITY).build(),
                new ThreadPoolExecutor.AbortPolicy()
        );

        executor.submit(() -&gt; {
            User user = new User("æå", 30);
            userThreadLocal.set(user); // å­å¨å° ThreadLocal

            // ä¸å¡æ§è¡å®æ¯ï¼æªè°ç¨ remove()
            // æ ¸å¿çº¿ç¨ä¸ä¼éæ¯ï¼ThreadLocal ä»ææ user å¼ç¨
        });
    }
}</code></pre>
<p>psï¼æªè¿è¡&nbsp;<strong>remove()</strong>ï¼è¿å¯è½ä¼å¯¼è´&nbsp;<strong>ThreadLocal </strong>åå¼ä¸²é¨ã</p>
<p><strong>4ãåé¨ç±»ä¸å¤é¨ç±»å¼ç¨</strong></p>
<p>ééæåé¨ç±»ï¼æå¿åç±»ï¼ä¼&nbsp;<strong>éå¼ææ&nbsp;</strong>å¤é¨ç±»çå¼ç¨ãå¦æåé¨ç±»å®ä¾çå½å¨ææ´é¿ï¼å¦è¢«ç¼å­æå¦ä¸ä¸ªçº¿ç¨å¼ç¨ï¼ï¼ä¼é»æ­¢å¤é¨ç±»è¢«åæ¶ã</p>
<pre class="language-java highlighter-hljs"><code>public class OuterClass {
    private byte[] bigData = new byte[1024 * 1024 * 10]; // 10MB å¤§å¯¹è±¡

    // ééæåé¨ç±»
    class InnerClass {
        // åé¨ç±»éå¼ææ OuterClass å¼ç¨
    }

    public InnerClass createInner() {
        return new InnerClass();
    }

    public static void main(String[] args) {
        OuterClass outer = new OuterClass();
        InnerClass inner = outer.createInner();

        // ç½®ç©ºå¤é¨ç±»å¼ç¨ï¼ä½ inner ä»ææ outer å¼ç¨
        outer = null;

        // è¥ inner è¢«éæåé/çº¿ç¨é¿æææ â outer å¯¹è±¡ï¼å« bigDataï¼æ æ³åæ¶
    }
}</code></pre>
<p><strong>5ã&nbsp;çå¬å¨ä¸åè°</strong></p>
<p>æ³¨åäº <strong>çå¬å¨&nbsp;</strong>æ <strong>åè°</strong> åï¼å¨å¯¹è±¡ä¸åéè¦æ¶ <strong>æ²¡ææ³¨é</strong>ï¼å¯¼è´æºå¯¹è±¡ä»ææçå¬å¨çå¼ç¨ï¼æ¯å¦ äºä»¶çå¬å¨ãæ¶æ¯éåçæ¶è´¹èç­ï¼ã</p>
<p><strong>ææ¥å·¥å·æ¨è</strong></p>
<ul>
<li><strong>MATï¼Memory Analyzer Toolï¼ï¼</strong>åæå  Dump æä»¶ï¼å®ä½æ³æ¼å¯¹è±¡ãå¼ç¨é¾ï¼è°å¨æææ³æ¼å¯¹è±¡ï¼ï¼</li>
<li><strong>VisualVMï¼</strong>JDK èªå¸¦å·¥å·ï¼çæ§åå­å ç¨è¶å¿ï¼çæå  Dumpï¼ç®åææ¥æ³æ¼ã</li>
</ul>
<p>è¿éæåªåäºå¸¸è§çå ç§æåµï¼æ¬¢è¿å¤§å®¶è¡¥åå¶ä»åå­æ³æ¼åºæ¯ã</p>
<p style="text-align: right"><span style="color: rgba(53, 152, 219, 1)">äººé´éååï¼åæåç§æï¼ä¸è¬è¦ã-- çæ²ä¹æ´²</span></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-29 19:29">2025-12-29 19:29</span>&nbsp;
<a href="https://www.cnblogs.com/yanshajiuzhou">çæ²ä¹æ´²</a>&nbsp;
éè¯»(<span id="post_view_count">51</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19417793);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19417793', targetLink: 'https://www.cnblogs.com/yanshajiuzhou/p/19417793', title: 'Java åªäºæåµä¼å¯¼è´åå­æ³æ¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ MAFå¿«éå¥é¨ï¼9ï¼å¤è·¯åæ¯è·¯ç±å·¥ä½æµ ]]></title>
    <link>https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper09</link>
    <guid>8d879eeff0eec1c38a24a10052f718a0</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper09" title="åå¸äº 2025-12-29 18:30">
    <span role="heading" aria-level="2">MAFå¿«éå¥é¨ï¼9ï¼å¤è·¯åæ¯è·¯ç±å·¥ä½æµ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/381412/202512/381412-20251224203108188-1569801702.png" alt="MAFå¿«éå¥é¨ï¼9ï¼å¤è·¯åæ¯è·¯ç±å·¥ä½æµ" class="desc_img">
        ä¸ä¸ç¯ï¼æä»¬å­¦ä¹ äºMAFä¸­å¦ä½è¿è¡if-elseç±»åçæ¡ä»¶è·¯ç±ï¼ä½æ¯å®éå·¥ä½ä¸­å¯è½ä¼æä¸­å¤ä¸ªåæ¯è·¯ç±çåºæ¯ãå¨å®éä¸å¡åºæ¯ä¸­ï¼å¾å¤çä¸å¡é»è¾æ¶åå°ä¸æ­¢ä¸¤ä¸ªå¤æ­æ¡ä»¶ï¼èæ¯å¤ä¸ªãå¨MAFä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨ Switch-Case æ¥å®ç°è¿ç§å·¥ä½æµåé¨å¤ç±»å³ç­æ¡ä»¶ç å·¥ä½æµéæ±ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><span><span>å¤§å®¶å¥½ï¼ææ¯Edisonã</span></span></p>
<p><span><span>æè¿æä¸ç´å¨è·çå£æ°çã<a class="normal_text_link mp_article_text_link" href="https://www.cnblogs.com/sheng-jie/p/19200934" target="_blank" data-itemshowtype="0" data-linktype="2"><span>.NET+AIæºè½ä½å¼åè¿é¶</span></a><span>ãè¯¾ç¨å­¦ä¹ MAFçå¼åæå·§ï¼æå¼ºçæ¨èä½ ä¹ä¸è½¦è·æä¸èµ·åºåï¼</span></span></span></p>
<p><span><a class="normal_text_link mp_article_text_link" href="https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper08" target="_blank" data-itemshowtype="0" data-linktype="2"><span>ä¸ä¸ç¯</span></a><span>ï¼æä»¬å­¦ä¹ äºMAFä¸­å¦ä½è¿è¡if-elseç±»åçæ¡ä»¶è·¯ç±<span>ï¼ä½æ¯å®éå·¥ä½ä¸­å¯è½ä¼å­å¨å¤ä¸ªåæ¯è·¯ç±çåºæ¯ãæ¬ç¯ï¼æä»¬æ¥äºè§£ä¸MAFä¸­çswitch-caseè·¯ç±å®ç°å¤åæ¯è·¯ç±å·¥ä½æµã</span></span></span></p>
<h1><strong>Why switch-case?</strong></h1>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span>å¨å®éä¸å¡åºæ¯ä¸­ï¼å¾å¤çä¸å¡é»è¾æ¶åå°ä¸æ­¢ä¸¤ä¸ªå¤æ­æ¡ä»¶ï¼èæ¯å¤ä¸ª<span>ã</span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span>ä¾å¦ï¼å¨ä¸ä¸ç¯çä¼ä¸åé¨é®ä»¶æ£æµæ¡ä¾ä¸­ï¼æä»¬çæ£æµç»æåªæä¸¤ä¸ªï¼åå¾é®ä»¶ æ æ­£å¸¸é®ä»¶ï¼ï¼ä½å¦ææä»¬æ³å¢å ä¸ä¸ªç»æï¼ä¸ç¡®å®ï¼å°±æ æ³éç¨äºã</span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span data-pm-slice="0 0 []"><span><span>å¨MAFä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨ Switch-Case æ¥å®ç°è¿ç§å·¥ä½æµåé¨å¤ç±»å³ç­æ¡ä»¶ç å·¥ä½æµéæ±<span>ã</span></span></span></span></span></span></span></span></p>
<h1><strong>å®éªæ¡ä¾</strong></h1>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span>ä»å¤©æ¥æä¸ä¸ä¸ç¯è¿ä¸ªä¼ä¸åé¨é®ä»¶æ£æµçå·¥ä½æµæ¡ä¾ï¼ä¸ä¸ç¯çæµç¨æ¯è¿æ ·çï¼</span></span></span></span></span></span></span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202512/381412-20251224202006911-1817307092.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span><span>ä»å¤©åè®¾æä»¬éè¦ææ´ä¸ºç²¾ç»çåç±»ï¼</span></span></span></span></span></span></span></span></span></span></p>
<p data-pm-slice="0 0 []"><span><span>&nbsp; â&nbsp;<span><span>**æ­£å¸¸é®ä»¶**<span><span>ï¼NotSpamï¼ï¼å®¢æ·å¨è¯¢ãä¸å¡å¾æ¥</span></span></span></span></span></span></p>
<p><span><span>&nbsp; â&nbsp;<span><span>**åå¾é®ä»¶**<span><span>ï¼Spamï¼ï¼ææ¾çè¯éªãå¹¿å</span></span></span></span></span></span></p>
<p><span><span>&nbsp;&nbsp;<span><span>â ï¸&nbsp;<span><span>**ä¸ç¡®å®é®ä»¶**<span><span>ï¼Uncertainï¼ï¼å¯è½æ¯éé±¼é®ä»¶ï¼éè¦äººå·¥å®¡æ ¸</span></span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>é£ä¹è¿å°±æ¯ä¸ä¸ªä¸ååç±»çï¼å¨ä¸å¡å¼åä¸­æä»¬éå¸¸ä¼ç¨å°switch-caseè¯­æ³ï¼èå¨MAFå·¥ä½æµä¸­ï¼ä¹ä¸ºæä»¬å®ä¹äºè¿ç§switch-caseæ¥å£ã</span></span></span></span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>å¨ä¸é¢çä»£ç ç¤ºä¾ä¸­ï¼æ¯å¯¹äºä¸¤ç§æ¥å£çä½¿ç¨æ¹å¼ï¼</span></span></span></span></span></span></span></span></span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Conditional Edge</span>
<span style="color: rgba(0, 0, 0, 1)">builder
    .AddEdge(source, target1, condition: c </span>=&gt; c.IsSpam == <span style="color: rgba(0, 0, 255, 1)">false</span><span style="color: rgba(0, 0, 0, 1)">)
    .AddEdge(source, target2, condition: c </span>=&gt; c.IsSpam == <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Switch-Case</span>
builder.AddSwitch(source, sb =&gt;<span style="color: rgba(0, 0, 0, 1)"> sb
    .AddCase(c </span>=&gt; c.Decision ==<span style="color: rgba(0, 0, 0, 1)"> NotSpam, target1)
    .AddCase(c </span>=&gt; c.Decision ==<span style="color: rgba(0, 0, 0, 1)"> Spam, target2)
    .WithDefault(target3)
);</span></pre>
</div>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>å¯ä»¥çå°ï¼switch-caseæ¨¡å¼å¶ä»·å¼ä¸»è¦å¨äºå¢å¼ºä»£ç å¯ç»´æ¤æ§ï¼å¯¹äºåç»­å¦æææ°å¢åç±»ï¼åªéè¦æ·»å ä¸ä¸ªAddCaseæ¥å£æ¹æ³å®ç°æ°å¢åç±»çå¤çï¼åæ¶åºäºWithDefaultæ¥å£æ¹æ³å®ç°ååºç¡®ä¿æææåµé½æå¤çã</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>æåï¼ä¸é¢æ¯æä»¬éè¦éæåçåæ¯è·¯ç±å¾ï¼</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202512/381412-20251224202047038-2027515638.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<h1><strong>åå¤å·¥ä½</strong></h1>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span>å¨ä»å¤©çè¿ä¸ªæ¡ä¾ä¸­ï¼æä»¬ä»ç¶åå»ºäºä¸ä¸ª.NETæ§å¶å°åºç¨ç¨åºï¼å®è£äºä»¥ä¸NuGetåï¼</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<ul class="list-paddingleft-1">
<li><span>Microsoft.Agents.AI.OpenAI</span></li>
<li><span>Microsoft.Agents.AI.Workflows</span></li>
<li><span>Microsoft.Extensions.AI.OpenAI</span></li>
</ul>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span>æä»¬çéç½®æä»¶ä¸­å®ä¹äºLLM APIçä¿¡æ¯ï¼</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">{
  </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">OpenAI</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">: {
    </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">EndPoint</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">https://api.siliconflow.cn</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
    </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ApiKey</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">******************************</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
    </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ModelId</span><span style="color: rgba(128, 0, 0, 1)">"</span>: <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Qwen/Qwen3-30B-A3B-Instruct-2507</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
  }
}</span></pre>
</div>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span><span data-pm-slice="0 0 []"><span data-pm-slice="0 0 []"><span>è¿éæä»¬ä½¿ç¨ SiliconCloud æä¾<span><span>ç<span><span>&nbsp;<span><span>Qwen/Qwen3-30B-A3B-Instruct-2507&nbsp;<span><span>æ¨¡åï¼ä½ <span><span>å¯ä»¥éè¿è¿ä¸ªURLæ³¨åè´¦å·ï¼<span><span><a href="https://cloud.siliconflow.cn/i/DomqCefW" target="_blank" rel="noopener nofollow">https://cloud.siliconflow.cn/i/DomqCefW</a><span>&nbsp;è·åå¤§éåè´¹çTokenæ¥è¿è¡æ¬æ¬¡å®éªã</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span><span data-pm-slice="0 0 []"><span><span>ç¶åï¼æä»¬å°éç½®æä»¶ä¸­çAPIä¿¡æ¯è¯»ååºæ¥ï¼</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> config = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ConfigurationBuilder()
    .AddJsonFile($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">appsettings.json</span><span style="color: rgba(128, 0, 0, 1)">"</span>, optional: <span style="color: rgba(0, 0, 255, 1)">false</span>, reloadOnChange: <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">)
    .Build();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> openAIProvider = config.GetSection(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">OpenAI</span><span style="color: rgba(128, 0, 0, 1)">"</span>).Get&lt;OpenAIProvider&gt;();</pre>
</div>
<h2><span>å®ä¹æ°æ®ä¼ è¾æ¨¡å</span></h2>
<p><span><span>é¦åï¼æä»¬å®ä¹ä¸ä¸å¨è¿ä¸ªå·¥ä½æµä¸­éè¦çæä¼ éçæ°æ®æ¨¡åï¼</span></span></p>
<p><span><span>ï¼1ï¼DetectionResult ï¼æä»¶é®ä»¶æ£æµç»æ</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> DetectionResult
{
    </span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;summary&gt;</span>
    <span style="color: rgba(128, 128, 128, 1)">///</span><span style="color: rgba(0, 128, 0, 1)"> æ£æµå³ç­ï¼NotSpam / Spam / Uncertainï¼
    </span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;/summary&gt;</span>
    [JsonPropertyName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">spam_decision</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
    [JsonConverter(</span><span style="color: rgba(0, 0, 255, 1)">typeof</span>(JsonStringEnumConverter))]  <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> JSON åºååä¸ºå­ç¬¦ä¸²</span>
    <span style="color: rgba(0, 0, 255, 1)">public</span> SpamDecision spamDecision { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    </span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;summary&gt;</span>
    <span style="color: rgba(128, 128, 128, 1)">///</span><span style="color: rgba(0, 128, 0, 1)"> å¤å®çç±ï¼ç¨äºå®¡è®¡åè°è¯ï¼
    </span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;/summary&gt;</span>
    [JsonPropertyName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">reason</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)]
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Reason { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.Empty;
    </span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;summary&gt;</span>
    <span style="color: rgba(128, 128, 128, 1)">///</span><span style="color: rgba(0, 128, 0, 1)"> é®ä»¶IDï¼ç¨äºå³è Shared State ä¸­çåå§åå®¹ï¼
    </span><span style="color: rgba(128, 128, 128, 1)">///</span> <span style="color: rgba(128, 128, 128, 1)">&lt;/summary&gt;</span>
<span style="color: rgba(0, 0, 0, 1)">    [JsonIgnore]
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> EmailId { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.Empty;
}

</span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">enum</span><span style="color: rgba(0, 0, 0, 1)"> SpamDecision
{
    Spam,        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå¾é®ä»¶</span>
    NotSpam, <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ­£å¸¸é®ä»¶</span>
    UnCertain <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ æ³ç¡®å®ï¼éè¦äººå·¥å®¡æ ¸ï¼</span>
}</pre>
</div>
<p><span><span>ï¼2ï¼EmailStateConstants ï¼å¸¸éï¼ç±»ä¼¼äºCache Keyçä½ç¨ï¼åèä¸ä¸ç¯åå®¢åå®¹ã</span></span></p>
<p><span><span><span><span data-pm-slice="0 0 []"><span><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span><span data-pm-slice="0 0 []"><span><span>ï¼3ï¼EmailMessage &amp; EmailResponse ï¼DTOä½ç¨ï¼åèä¸ä¸ç¯åå®¢åå®¹ã</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<h2><span>å¥å£èç¹ï¼åå¾é®ä»¶æ£æµExecutor</span></h2>
<p><span data-pm-slice="0 0 []"><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;text-align: left;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span data-pm-slice="0 0 []">è¿ä¸ªåå¾é®ä»¶æ£æµæ¯æ¬æµç¨çæ ¸å¿èç¹ï¼è¿æ¬¡æä»¬å°å¶éæä¸ºæ¯æä¸åç±»ï¼</span></span></span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span> SpamDetectionExecutor : Executor&lt;ChatMessage, DetectionResult&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> AIAgent _agent;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> AgentThread _thread;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> SpamDetectionExecutor(AIAgent agent) : <span style="color: rgba(0, 0, 255, 1)">base</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">SpamDetectionExecutor</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå»º Agent åå¯¹è¯çº¿ç¨</span>
        <span style="color: rgba(0, 0, 255, 1)">this</span>._agent =<span style="color: rgba(0, 0, 0, 1)"> agent;
        </span><span style="color: rgba(0, 0, 255, 1)">this</span>._thread = <span style="color: rgba(0, 0, 255, 1)">this</span><span style="color: rgba(0, 0, 0, 1)">._agent.GetNewThread();
    }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span> ValueTask&lt;DetectionResult&gt; HandleAsync(ChatMessage message, IWorkflowContext context, CancellationToken cancellationToken = <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 1ï¸â£ çæå¯ä¸é®ä»¶IDå¹¶ä¿å­åå®¹å° Shared State</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> trackedEmail = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> EmailMessage
        {
            EmailId </span>= Guid.NewGuid().ToString(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">N</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">),
            EmailContent </span>=<span style="color: rgba(0, 0, 0, 1)"> message.Text
        };
        </span><span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> context.QueueStateUpdateAsync(
            trackedEmail.EmailId,
            trackedEmail,
            scopeName: EmailStateConstants.EmailStateScope,
            cancellationToken
        );
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 2ï¸â£ è°ç¨ AI Agent è¿è¡ä¸åç±»æ£æµ</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> agentResponse = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> _agent.RunAsync(
            message,
            _thread,
            cancellationToken: cancellationToken
        );
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 3ï¸â£ è§£æç»æåè¾åº</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> detection = JsonSerializer.Deserialize&lt;DetectionResult&gt;<span style="color: rgba(0, 0, 0, 1)">(agentResponse.Text)
            </span>?? <span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> InvalidOperationException(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ æ³è§£æ Spam Detection ååº</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 4ï¸â£ å³è EmailIdï¼ä¾ä¸æ¸¸ Executor æ¥æ¾åå§åå®¹ï¼</span>
        detection.EmailId =<span style="color: rgba(0, 0, 0, 1)"> trackedEmail.EmailId;
        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> detection;
    }
}</span></pre>
</div>
<p>å¨è¿ä¸ªExecutorä¸­ï¼å®æ¥æ¶æä»¬å¦ä¸æç¤ºå®ä¹å¥½çAgentæ¥å®ç°ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> spamDetectionAgent = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatClientAgent(
    chatClient,
    </span><span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatClientAgentOptions(
        instructions: </span><span style="color: rgba(128, 0, 0, 1)">@"</span><span style="color: rgba(128, 0, 0, 1)">ä½ æ¯ä¸ä¸ªåå¾é®ä»¶æ£æµå©æãå¤å®è§åï¼
- NotSpam: ææ¾çæ­£å¸¸ä¸å¡é®ä»¶ï¼è®¢åæ¥è¯¢ãå®åå¨è¯¢ç­ï¼
- Spam: ææ¾çåå¾é®ä»¶ï¼è¯éªãå¹¿åãéé±¼ï¼
- Uncertain: æ æ³æç¡®å¤æ­ï¼åå«å¯çåç´ ä½ä¸ç¡®å®ï¼å¦å«å¯çé¾æ¥ä½åå®¹æ¨¡ç³ï¼
å¯¹äºæ¨¡æ£±ä¸¤å¯çæåµï¼å¾åäºæ è®°ä¸º Uncertain ä»¥ä¿è¯å®å¨ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
    )
    {
        ChatOptions </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatOptions
        {
            ResponseFormat </span>= ChatResponseFormat.ForJsonSchema&lt;DetectionResult&gt;<span style="color: rgba(0, 0, 0, 1)">()
        }
    }
);</span></pre>
</div>
<p>å¨ChatOptionsä¸­æå®äºè¯¥Agentè¿åçæ¶æ¯éè¦è¿è¡åºååå°å¼ºç±»åï¼ä¾¿äºåç»­éè¿å¼ºç±»åæ°æ®è¿è¡å³ç­è·¯ç±ã</p>
<h2 data-pm-slice="2 3 []"><span>ä¸æ¸¸èç¹Aï¼æ­£å¸¸é®ä»¶å¤ç+åé</span></h2>
<p>è¿éæä»¬éå¯¹è¯å«å°çæ­£å¸¸é®ä»¶å¼åä¸¤ä¸ªæ§è¡å¨ï¼åè®¾å¶ç¨äºé®ä»¶å¤åè½¬åï¼</p>
<h3>é®ä»¶å¤çï¼è¯»åå±äº«ç¶æåºçåæï¼ç¶åè°ç¨Agentè¾åºJSONåå¤ã</h3>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span> EmailAssistantExecutor : Executor&lt;DetectionResult, EmailResponse&gt;<span style="color: rgba(0, 0, 0, 1)">
{
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> AIAgent _agent;
    </span><span style="color: rgba(0, 0, 255, 1)">private</span> <span style="color: rgba(0, 0, 255, 1)">readonly</span><span style="color: rgba(0, 0, 0, 1)"> AgentThread _thread;

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> EmailAssistantExecutor(AIAgent agent) : <span style="color: rgba(0, 0, 255, 1)">base</span>(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">EmailAssistantExecutor</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå»º Agent åå¯¹è¯çº¿ç¨</span>
        <span style="color: rgba(0, 0, 255, 1)">this</span>._agent =<span style="color: rgba(0, 0, 0, 1)"> agent;
        </span><span style="color: rgba(0, 0, 255, 1)">this</span>._thread = <span style="color: rgba(0, 0, 255, 1)">this</span><span style="color: rgba(0, 0, 0, 1)">._agent.GetNewThread();
    }

    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span> ValueTask&lt;EmailResponse&gt; HandleAsync(DetectionResult message, IWorkflowContext context, CancellationToken cancellationToken = <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ð¡ï¸ é²å¾¡æ§æ£æ¥ï¼ç¡®ä¿åªå¤çæ­£å¸¸é®ä»¶</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> (message.spamDecision ==<span style="color: rgba(0, 0, 0, 1)"> SpamDecision.Spam)
            </span><span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> InvalidOperationException(
                </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">EmailAssistantExecutor ä¸åºå¤çåå¾é®ä»¶ï¼è¯·æ£æ¥è·¯ç±éç½®ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
            );

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 1ï¸â£ ä» Shared State è¯»ååå§é®ä»¶åå®¹</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> email = <span style="color: rgba(0, 0, 255, 1)">await</span> context.ReadStateAsync&lt;EmailMessage&gt;<span style="color: rgba(0, 0, 0, 1)">(
            message.EmailId,
            scopeName: EmailStateConstants.EmailStateScope,
            cancellationToken
        ) </span>?? <span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> InvalidOperationException($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ¾ä¸å° EmailId={message.EmailId} çé®ä»¶åå®¹</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 2ï¸â£ è°ç¨ AI Agent çæåå¤</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> agentResponse = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> _agent.RunAsync(
            email.EmailContent,
            _thread,
            cancellationToken: cancellationToken
        );

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 3ï¸â£ è§£æç»æåè¾åº</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> emailResponse = JsonSerializer.Deserialize&lt;EmailResponse&gt;<span style="color: rgba(0, 0, 0, 1)">(agentResponse.Text)
            </span>?? <span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span> InvalidOperationException(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ æ³è§£æ Email Assistant ååº</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> emailResponse;
    }
}</span></pre>
</div>
<p>è¿éçAgentå®ä¹å¦ä¸ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> emailAssistantAgent = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatClientAgent(
    chatClient,
    </span><span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatClientAgentOptions(
        instructions: </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä½ æ¯ä¸ä¸ªä¼ä¸é®ä»¶å©æï¼ä¸ºå®¢æ·é®ä»¶çæä¸ä¸ãåå¥½çä¸­æåå¤ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
    )
    {
        ChatOptions </span>= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatOptions
        {
            ResponseFormat </span>= ChatResponseFormat.ForJsonSchema&lt;EmailResponse&gt;<span style="color: rgba(0, 0, 0, 1)">()
        }
    }
);</span></pre>
</div>
<h3><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;text-transform: none;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;text-align: left;line-height: 1.75em;margin-bottom: 8px;margin-top: 8px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">é®ä»¶è½¬åï¼æ¨¡æé®ä»¶è½¬åå°å·ä½çå®¢æï¼è¿éä»ä»ä½¿ç¨YieldOutputAsyncå®æå·¥ä½æµè¾åºæ¶æ¯åå®¹ã</span></h3>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span> EmailSendingExecutor() : Executor&lt;EmailResponse&gt;(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">EmailSendingExecutor</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span> ValueTask HandleAsync(EmailResponse message, IWorkflowContext context, CancellationToken cancellationToken = <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¨¡æé®ä»¶åéï¼å®éé¡¹ç®ä¸­å¯è°ç¨ SMTPãSendGrid ç­æå¡ï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> context.YieldOutputAsync(
            $</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð¤ é®ä»¶å·²åé: {message.Response}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
            cancellationToken
        );
    }
}</span></pre>
</div>
<h2 data-pm-slice="2 3 []"><span>ä¸æ¸¸èç¹Bï¼åå¾é®ä»¶å¤ç</span></h2>
<p>å½å¤æ­å°æ¯åå¾é®ä»¶æ¶ï¼è½¬äº¤ç»è¯¥æ§è¡å¨å¤çï¼è¿éæ¨¡æè¾åºäºä¸æ®µé£é©æç¤ºï¼å®éä¸­å¯è½æ¯ä¸æ¥äººå·¥è·è¿ç­ç­æä½ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">sealed</span> <span style="color: rgba(0, 0, 255, 1)">class</span> SpamHandlingExecutor() : Executor&lt;DetectionResult&gt;(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">SpamHandlingExecutor</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span> ValueTask HandleAsync(DetectionResult message, IWorkflowContext context, CancellationToken cancellationToken = <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ð¡ï¸ é²å¾¡æ§æ£æ¥ï¼ç¡®ä¿åªå¤çåå¾é®ä»¶</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> (message.spamDecision !=<span style="color: rgba(0, 0, 0, 1)"> SpamDecision.Spam)
            </span><span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> InvalidOperationException(
                </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">SpamHandlingExecutor åªåºå¤ç Spam ç±»åçé®ä»¶ï¼è¯·æ£æ¥è·¯ç±éç½®ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
            );

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è®°å½åå¾é®ä»¶ï¼å®éé¡¹ç®ä¸­å¯åå¥æ°æ®åºææ¥å¿ç³»ç»ï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> context.YieldOutputAsync(
            $</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð« åå¾é®ä»¶å·²æ¦æª: {message.Reason}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
            cancellationToken
        );
    }
}</span></pre>
</div>
<h2 data-pm-slice="2 3 []"><span>ä¸æ¸¸èç¹Cï¼<span><span>ä¸ç¡®å®é®ä»¶å¤çæ§è¡å¨ï¼ååºå¤çï¼</span></span></span></h2>
<p>å½å¤æ­å°å±äºä¸ç¡®å®çé®ä»¶åç±»æ¶ï¼è½¬äº¤ç»è¯¥æ§è¡å¨åååºå¤ç æ é»è®¤å¤çï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">internal</span> <span style="color: rgba(0, 0, 255, 1)">class</span> UncertainHandlingExecutor() : Executor&lt;DetectionResult&gt;(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">UncertainHandlingExecutor</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">async</span><span style="color: rgba(0, 0, 0, 1)"> ValueTask HandleAsync(
        DetectionResult message,
        IWorkflowContext context,
        CancellationToken cancellationToken </span>= <span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">)
    {
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ð¡ï¸ é²å¾¡æ§æ£æ¥ï¼ç¡®ä¿åªå¤çä¸ç¡®å®é®ä»¶</span>
        <span style="color: rgba(0, 0, 255, 1)">if</span> (message.spamDecision !=<span style="color: rgba(0, 0, 0, 1)"> SpamDecision.UnCertain)
            </span><span style="color: rgba(0, 0, 255, 1)">throw</span> <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> InvalidOperationException(
                </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">UncertainHandlingExecutor åªåºå¤ç Uncertain ç±»åçé®ä»¶ï¼æä½ä¸º Default Caseï¼ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
            );

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 1ï¸â£ ä» Shared State è¯»ååå§é®ä»¶åå®¹ï¼ç¨äºäººå·¥å®¡æ ¸ï¼</span>
        <span style="color: rgba(0, 0, 255, 1)">var</span> email = <span style="color: rgba(0, 0, 255, 1)">await</span> context.ReadStateAsync&lt;EmailMessage&gt;<span style="color: rgba(0, 0, 0, 1)">(
            message.EmailId,
            scopeName: EmailStateConstants.EmailStateScope,
            cancellationToken
        );

        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> 2ï¸â£ è¾åºå¾å®¡æ ¸ä¿¡æ¯</span>
        <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> context.YieldOutputAsync(
            $</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â ï¸ ä¸ç¡®å®é®ä»¶éäººå·¥å®¡æ ¸:\n</span><span style="color: rgba(128, 0, 0, 1)">"</span> +<span style="color: rgba(0, 0, 0, 1)">
            $</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åå : {message.Reason}\n</span><span style="color: rgba(128, 0, 0, 1)">"</span> +<span style="color: rgba(0, 0, 0, 1)">
            $</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åå®¹é¢è§: {email?.EmailContent?.Substring(0, Math.Min(100, email.EmailContent.Length))}...</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
            cancellationToken
        );
    }
}</span></pre>
</div>
<h2>æå»ºå·¥ä½æµ</h2>
<p>ç°å¨ä¸äºä¿±å¤ï¼åªæ¬ ä¸ä¸ªWorkflowï¼ç°å¨Let's do it!</p>
<p><strong>Step1:</strong> è·åChatClient</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> chatClient = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> OpenAIClient(
        </span><span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ApiKeyCredential(openAIProvider.ApiKey),
        </span><span style="color: rgba(0, 0, 255, 1)">new</span> OpenAIClientOptions { Endpoint = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> Uri(openAIProvider.Endpoint) })
    .GetChatClient(openAIProvider.ModelId)
    .AsIChatClient();</span></pre>
</div>
<p><strong><span><span>Step2<span>: </span></span></span></strong>å®ä¾åèªå®ä¹Agent &amp; Executors</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> spamDetectionExecutor = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> SpamDetectionExecutor(spamDetectionAgent);
</span><span style="color: rgba(0, 0, 255, 1)">var</span> emailAssistantExecutor = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> EmailAssistantExecutor(emailAssistantAgent);
</span><span style="color: rgba(0, 0, 255, 1)">var</span> sendEmailExecutor = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> EmailSendingExecutor();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> handleSpamExecutor = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> SpamHandlingExecutor();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> handleUncertainExecutor = <span style="color: rgba(0, 0, 255, 1)">new</span> UncertainHandlingExecutor();</pre>
</div>
<p><strong><span><span>Step3<span>: </span></span></span></strong>åå»ºswitch-caseå¤è·¯ç±å³ç­å·¥ä½æµ</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> âââââââââââââââââââââââââââââ
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ð§ æ¡ä»¶å½æ°å·¥åæ¹æ³
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> âââââââââââââââââââââââââââââ</span>
Func&lt;<span style="color: rgba(0, 0, 255, 1)">object</span>?, <span style="color: rgba(0, 0, 255, 1)">bool</span>&gt; GetCondition(SpamDecision expectedDecision) =&gt;<span style="color: rgba(0, 0, 0, 1)">
    detectionResult </span>=&gt;<span style="color: rgba(0, 0, 0, 1)">
        detectionResult </span><span style="color: rgba(0, 0, 255, 1)">is</span> DetectionResult result &amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
        result.spamDecision </span>==<span style="color: rgba(0, 0, 0, 1)"> expectedDecision;

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> âââââââââââââââââââââââââââââ
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ð ä½¿ç¨ AddSwitch æå»º Switch-Case å·¥ä½æµ
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> âââââââââââââââââââââââââââââ</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> builder = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> WorkflowBuilder(spamDetectionExecutor);
builder.AddSwitch(spamDetectionExecutor, sb </span>=&gt;<span style="color: rgba(0, 0, 0, 1)">
        sb
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Case 1: NotSpam â EmailAssistant </span>
            .AddCase(GetCondition(expectedDecision: SpamDecision.NotSpam), <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">[] { (ExecutorBinding)emailAssistantExecutor })
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Case 2: Spam â HandleSpam</span>
            .AddCase(GetCondition(expectedDecision: SpamDecision.Spam), <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">[] { (ExecutorBinding)handleSpamExecutor })
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Default: Uncertain (æä»»ä½æªå¹éçæåµ) â HandleUncertain</span>
            .WithDefault(<span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">[] { (ExecutorBinding)handleUncertainExecutor })
    )
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> EmailAssistant ä¹åèªå¨åéé®ä»¶</span>
<span style="color: rgba(0, 0, 0, 1)">    .AddEdge(emailAssistantExecutor, sendEmailExecutor)
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éç½®è¾åºèç¹ï¼ä¸ä¸ªç»ç¹æ§è¡å¨é½ä¼äº§çè¾åºï¼</span>
<span style="color: rgba(0, 0, 0, 1)">    .WithOutputFrom(handleSpamExecutor, sendEmailExecutor, handleUncertainExecutor);
</span><span style="color: rgba(0, 0, 255, 1)">var</span> workflow =<span style="color: rgba(0, 0, 0, 1)"> builder.Build();

Console.OutputEncoding </span>=<span style="color: rgba(0, 0, 0, 1)"> Encoding.UTF8;
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â Conditional Workflow æå»ºå®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<h2>æµè¯å·¥ä½æµ</h2>
<p>é¦åï¼ä¸ºäºä¾¿äºåç»­æµè¯æä»¬å°æ§è¡å·¥ä½æµå°è£ä¸ºä¸ä¸ªéææ¹æ³ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">async</span><span style="color: rgba(0, 0, 0, 1)"> Task RunWorkflowAsync(
    Workflow workflow,
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> scenarioName,
    </span><span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)"> emailContent)
{
    Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð¬ æµè¯åºæ¯ï¼{scenarioName}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð§ é®ä»¶åå®¹ï¼{emailContent.Substring(0, Math.Min(80, emailContent.Length))}...\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">await</span> <span style="color: rgba(0, 0, 255, 1)">using</span> <span style="color: rgba(0, 0, 255, 1)">var</span> run = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> InProcessExecution.StreamAsync(
        workflow,
        </span><span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatMessage(ChatRole.User, emailContent)
    );
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åé Turn Tokenï¼å¯ç¨äºä»¶æ¨é</span>
    <span style="color: rgba(0, 0, 255, 1)">await</span> run.TrySendMessageAsync(<span style="color: rgba(0, 0, 255, 1)">new</span> TurnToken(emitEvents: <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">));
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è®¢éäºä»¶æµ</span>
    <span style="color: rgba(0, 0, 255, 1)">await</span> <span style="color: rgba(0, 0, 255, 1)">foreach</span> (WorkflowEvent evt <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> run.WatchStreamAsync())
    {
        </span><span style="color: rgba(0, 0, 255, 1)">switch</span><span style="color: rgba(0, 0, 0, 1)"> (evt)
        {
            </span><span style="color: rgba(0, 0, 255, 1)">case</span><span style="color: rgba(0, 0, 0, 1)"> ExecutorCompletedEvent completedEvent:
                Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â {completedEvent.ExecutorId} å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
            </span><span style="color: rgba(0, 0, 255, 1)">case</span><span style="color: rgba(0, 0, 0, 1)"> WorkflowOutputEvent outputEvent:
                Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââââââââââââââââ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð å·¥ä½æµæ§è¡å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââââââââââââââââ\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{outputEvent.Data}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
            </span><span style="color: rgba(0, 0, 255, 1)">case</span><span style="color: rgba(0, 0, 0, 1)"> WorkflowErrorEvent errorEvent:
                Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â¨ æ¶å° Workflow Error Eventï¼</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{errorEvent.Data}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
            </span><span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">:
                </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
        }
    }
    Console.WriteLine();
}</span></pre>
</div>
<p><strong>æµè¯ç¨ä¾1ï¼</strong>æ­£å¸¸å¨è¯¢é®ä»¶è¾å¥</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> scenarioName1 = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ­£å¸¸é®ä»¶ â EmailAssistant â SendEmail</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">var</span> emailContent1 = <span style="color: rgba(128, 0, 0, 1)">@"</span><span style="color: rgba(128, 0, 0, 1)">
å°æ¬çå®¢æå¢éï¼
æ¨å¥½ï¼ææ¯è´µå¬å¸çé¿æå®¢æ·ï¼è®¢åå·ä¸º 
#2025
-001ã
ææ³ç¡®è®¤ä¸ä¸ä¸å¨æäº¤çéè´­è®¢åæ¯å¦å·²ç»å®æåè´§ã
å¦æéè¦è¡¥åä»»ä½ä¿¡æ¯ï¼è¯·éæ¶åç¥ã
æå¾æ¨çåå¤ï¼è°¢è°¢ï¼
å®¢æ·ï¼å¼ åç
</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> RunWorkflowAsync(workflow, scenarioName1, emailContent1);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â æ­£å¸¸é®ä»¶è·¯å¾éªè¯å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<p>æµè¯ç»æå¦ä¸å¾æç¤ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202512/381412-20251224202754097-83329301.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¯ä»¥çè§ï¼å¯¹äºæ­£å¸¸å¨è¯¢é®ä»¶ï¼è¿è¡æ­£å¸¸çé®ä»¶å¤çåè½¬åã</p>
<p><strong>æµè¯ç¨ä¾2ï¼</strong>åå¾é®ä»¶è¾å¥</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> scenarioName2 = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åå¾é®ä»¶ â HandleSpam</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">var</span> emailContent2 = <span style="color: rgba(128, 0, 0, 1)">@"</span><span style="color: rgba(128, 0, 0, 1)">
ððð æ­åæ¨ä¸­å¥å¦ï¼ððð

æ¨å·²è¢«éä¸­è·å¾ 100 ä¸ç°éå¤§å¥ï¼

ç«å³ç¹å»ä»¥ä¸é¾æ¥é¢åï¼
http://suspicious-site.com/claim-prize

ä»éä»æ¥ææï¼è¿æä½åºï¼
ä¸éè¦ä»»ä½æç»­è´¹ï¼å®å¨åè´¹ï¼

å¿«éè¡å¨ï¼æºä¸å¯å¤±ï¼
</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> RunWorkflowAsync(workflow, scenarioName2, emailContent2);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â åå¾é®ä»¶è·¯å¾éªè¯å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<p>æµè¯ç»æå¦ä¸å¾æç¤ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202512/381412-20251224202904798-37631196.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¯ä»¥çè§ï¼å¯¹äºåå¾é®ä»¶ï¼è¿è¡ææçæ¦æªï¼åç»­è¿å¯ä»¥è¿è¡ä¸æ¥äººå·¥è·è¸ªç­ç­ã</p>
<p><strong>æµè¯ç¨ä¾3ï¼</strong>æ æ³ç¡®è®¤ç±»åçé®ä»¶è¾å¥</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> uncertainEmail = <span style="color: rgba(128, 0, 0, 1)">@"</span><span style="color: rgba(128, 0, 0, 1)">
ä¸»é¢ï¼éè¦éªè¯æ¨çè´¦æ·
å°æ¬çå®¢æ·ï¼
æä»¬æ£æµå°æ¨çè´¦æ·å­å¨å¼å¸¸æ´»å¨ï¼éè¦éªè¯æ¨çèº«ä»½ä»¥ç¡®ä¿è´¦æ·å®å¨ã
è¯·ç»å½æ¨çè´¦æ·å¹¶å®æéªè¯æµç¨ï¼ä»¥ç»§ç»­ä½¿ç¨æå¡ã
è´¦æ·è¯¦æï¼
- ç¨æ·åï¼johndoe@contoso.com
- æåç»å½ï¼08/15/2025
- ç»å½å°ç¹ï¼è¥¿éå¾ï¼åçé¡¿å·
- ç»å½è®¾å¤ï¼ç§»å¨è®¾å¤
è¿æ¯ä¸é¡¹èªå¨å®å¨æªæ½ãå¦ææ¨è®¤ä¸ºæ­¤é®ä»¶æ¯éè¯¯åéçï¼è¯·ç«å³èç³»æä»¬çæ¯æå¢éã
æ­¤è´
å®å¨å¢é
å®¢æ·æå¡é¨é¨
</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> RunWorkflowAsync(
    workflow,
    </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä¸ç¡®å®é®ä»¶ â HandleUncertain (Default)</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
    uncertainEmail
);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â ä¸ç¡®å®é®ä»¶è·¯å¾éªè¯å®æ</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<p>æµè¯ç»æå¦ä¸å¾æç¤ºï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202512/381412-20251224202940842-749043447.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>å¯ä»¥çå°ï¼å¯¹äºLLMæ æ³ç¡®è®¤çç±»åï¼è¿å¥äºè¯¥æ§è¡å¨ï¼è¿æ¶å¯è½éè¦äººå·¥ä»å¥å®¡æ ¸ãåæ¶ï¼è¿ä¹æ¯å®éä¸­å¸¸è§çä¸ç§ååºæºå¶çå±ç°ï¼è¯å¥è¯è¯´ï¼<strong>å³ä½¿AIæ æ³æç¡®å¤æ­ï¼ä¹åºè¯¥æå¯¹åºçå¤çæµç¨</strong>ã</p>
<h1><strong><span>å°ç»</span></strong></h1>
<p>æ¬æä»ç»äºMAFä¸­çswitch-caseè·¯ç±ä»¥åå¦ä½å®ç°å¤æ¡ä»¶è·¯ç±ï¼æåä¼åäºä¸ä¸ç¯çä¼ä¸åé¨é®ä»¶æ£æµå·¥ä½æµæ¡ä¾ï¼ç¹å«éåäºå¤§äº3ä¸ªåæ¯çå¤æè·¯ç±åºæ¯ã</p>
<p>ä¸ä¸ç¯ï¼æä»¬å°ç»§ç»­å­¦ä¹ MAFä¸­å·¥ä½æµçå¾ªç¯å·¥ä½æµã</p>
<h1>åèèµæ</h1>
<p><span data-pm-slice="0 0 []"><span>å£æ°ï¼ã<a href="https://www.cnblogs.com/sheng-jie/p/19200934" target="_blank">.NET + AI æºè½ä½å¼åè¿é¶</a>ãï¼æ¨èææ°ï¼âââââï¼</span></span></p>
<p><span data-pm-slice="0 0 []"><span>Microsoft Learnï¼<span>ã<a href="https://learn.microsoft.com/en-us/agent-framework/overview/agent-framework-overview?wt.mc_id=MVP_397012" target="_blank" rel="noopener nofollow">Agent Framework Tutorials</a>ã</span></span></span></p>
<div><span data-pm-slice="0 0 []"><span>&nbsp;</span></span></div>
<p style="text-align: center"><img src="https://images.cnblogs.com/cnblogs_com/edisonchou/1647700/o_200902144330EdisonTalk-Footer.jpg" alt="" style="width: 65%; border: 1px solid rgba(221, 221, 221, 1); border-radius: 3px; box-shadow: 0 4px 8px rgba(3, 27, 78, 0.12)"></p>
<div id="Copyright">
<p>ä½èï¼<span style="text-decoration: underline">ç±è¿ªç</span></p>
<p>åºå¤ï¼<a title="from" href="https://edisontalk.cnblogs.com" target="_blank">https://edisontalk.cnblogs.com</a></p>
<p>æ¬æçæå½ä½èååå®¢å­å±æï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»ä¿çæ­¤æ®µå£°æï¼ä¸å¨æç« é¡µé¢ææ¾ä½ç½®ç»åºåæé¾æ¥ã</p>
</div>
</div>
<div id="MySignature" role="contentinfo">
    <div align="center"><a href="https://weibo.com/u/2068032061?s=6uyXnP" target="_blank"><img border="0" src="http://service.t.sina.com.cn/widget/qmd/2068032061/d643d182/10.png"></a></div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-29 18:30">2025-12-29 18:30</span>&nbsp;
<a href="https://www.cnblogs.com/edisontalk">EdisonZhou</a>&nbsp;
éè¯»(<span id="post_view_count">49</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19394484);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19394484', targetLink: 'https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper09', title: 'MAFå¿«éå¥é¨ï¼9ï¼å¤è·¯åæ¯è·¯ç±å·¥ä½æµ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åç»åç«¯çè¡ç¥¨è¡æ SDK: stock-sdkï¼ç»äºä¸ç¨åæ±åç«¯å¸®å¿äº ]]></title>
    <link>https://www.cnblogs.com/chengzp/p/19417561/stock-sdk</link>
    <guid>dad89fdcfcc5a925e94a7e158299aa65</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/chengzp/p/19417561/stock-sdk" title="åå¸äº 2025-12-29 18:16">
    <span role="heading" aria-level="2">åç»åç«¯çè¡ç¥¨è¡æ SDK: stock-sdkï¼ç»äºä¸ç¨åæ±åç«¯å¸®å¿äº</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/1265396/202512/1265396-20251229181351247-1080670278.png" alt="åç»åç«¯çè¡ç¥¨è¡æ SDK: stock-sdkï¼ç»äºä¸ç¨åæ±åç«¯å¸®å¿äº" class="desc_img">
        ä½èèªå·±å¨æåäºä¸ä¸ª JavaScript/TypeScript çæ¬çè¡ç¥¨è¡æ SDKãæç« ä»ç»äºè¿ä¸ª SDK è½è·å A è¡ãæ¸¯è¡ãç¾è¡çå®æ¶è¡æå K çº¿æ°æ®ï¼è¿åç½®äºå¸¸ç¨çææ¯ææ è®¡ç®ï¼æ¯ææµè§å¨å Node.js åç«¯è¿è¡ï¼éåç¨æ¥åè¡æçæ¿ãæ°æ®å¯è§åãéåéªè¯è¿ç±»é¡¹ç®ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>ç¨ JavaScript è·åè¡ç¥¨æ°æ®ï¼ççæè¿ä¹é¾åï¼</p>
</blockquote>
<h2 id="èµ·å ">èµ·å </h2>
<p>è¯´å®è¯ï¼è¿ä¸ªé¡¹ç®çè¯çå®å¨æ¯è¢«é¼åºæ¥çã</p>
<p>å»å¹´ææ³åä¸ä¸ªè¡ç¥¨è¡æçæ¿ï¼å°±æ¯é£ç§ç®åçé¡µé¢ï¼è½å®æ¶æ¾ç¤ºå åªèªéè¡çæ¶¨è·ãå¬èµ·æ¥å¾ç®åå¯¹å§ï¼ä½å½æçæ­£å¼å§å¨æçæ¶åï¼æåç°äºææ²¡é£ä¹ç®åã</p>
<p>ç½ä¸æä¸åï¼è¡ç¥¨æ°æ®æ¥å£ç¸å³çå·¥å·å ä¹å¨æ¯ Python çãAkShareãTushareãæééåâ¦â¦ç¡®å®çï¼åè½ä¹ç¡®å®å¨ï¼ä½é®é¢æ¯ââ<strong>ææ¯ä¸ªåç«¯å</strong>ã</p>
<p>ä¸ºäºä¸ä¸ªå°çæ¿ï¼é¾éè¦æä¸é¨æ­ä¸ä¸ª Python åç«¯ï¼ååä¸ªæ¥å£è½¬åç»åç«¯ï¼è¿ä¹å¤ªæè¾äºã</p>
<p>äºæ¯æå¼å§æ¾ææ²¡æ JavaScript è½ç¨çæ¹æ¡ãç»æä½ çæä¹çï¼ç¿»éäº npmï¼å ä¹æ¾ä¸å°ä¸ä¸ªå¥½ç¨çãæçå¹´ä¹å¤±ä¿®ï¼æçåªæ¯æ Node.js ä¸æ¯ææµè§å¨ï¼æçç±»åæ¯æä¸å¡ç³æ¶ï¼è¿æçæ¥å£è«åå¶å¦å°±æäºã</p>
<p>æ¸ç´¢äºä¸åä¹åï¼æå³å®ï¼<strong>ç®äºï¼èªå·±åä¸ä¸ªå¾äºã</strong></p>
<h2 id="stock-sdk-æ¯ä»ä¹">stock-sdk æ¯ä»ä¹ï¼</h2>
<p>ç®åè¯´ï¼<strong>stock-sdk</strong> å°±æ¯ä¸ä¸ªä¸é¨ç»åç«¯å Node.js ç¨çè¡ç¥¨è¡æ SDKã</p>
<p>æ ¸å¿ç®æ å°±ä¸ä¸ªï¼è®©ä½ ç¨æçæç JavaScript / TypeScriptï¼10 è¡ä»£ç æå®è¡ç¥¨æ°æ®è·åã</p>
<pre><code class="language-ts">import { StockSDK } from 'stock-sdk';

const sdk = new StockSDK();

const quotes = await sdk.getSimpleQuotes(['sh000001', 'sz000858', 'sh600519']);

quotes.forEach(q =&gt; {
  console.log(`${q.name}: ${q.price} (${q.changePercent}%)`);
});
</code></pre>
<p>å°±è¿ä¹ç®åãä¸ç¨æ­åç«¯ï¼ä¸ç¨è£ Pythonï¼æµè§å¨éç´æ¥è·ã</p>
<h2 id="å®è½å¹²ä»ä¹">å®è½å¹²ä»ä¹ï¼</h2>
<p>åå°ç°å¨ï¼åè½å·²ç»æ¯è¾é½å¨äºï¼</p>
<p><strong>è¡ææ°æ®</strong></p>
<ul>
<li>A è¡ãæ¸¯è¡ãç¾è¡ãå¬ååºéçå®æ¶è¡æ</li>
<li>åå² K çº¿ï¼æ¥çº¿ãå¨çº¿ãæçº¿ï¼</li>
<li>åé K çº¿ï¼1 åéå° 60 åéé½æ¯æï¼</li>
<li>å½æ¥åæ¶èµ°å¿</li>
</ul>
<p><strong>æ¿åæ°æ®</strong></p>
<ul>
<li>è¡ä¸æ¿åãæ¦å¿µæ¿åçåè¡¨åå®æ¶è¡æ</li>
<li>æ¿åæåè¡</li>
<li>æ¿å K çº¿æ°æ®</li>
</ul>
<p><strong>ææ¯ææ </strong></p>
<ul>
<li>åç½® MAãMACDãBOLLãKDJãRSI ç­å¸¸ç¨ææ </li>
<li>ä¸ä¸ªæ¥å£æå® K çº¿ + ææ è®¡ç®</li>
</ul>
<p><strong>æ©å±æ°æ®</strong></p>
<ul>
<li>èµéæµå</li>
<li>çå£å¤§å</li>
<li>A è¡äº¤ææ¥å</li>
</ul>
<p><strong>æ¹éè½å</strong></p>
<ul>
<li>ä¸æ¬¡æ§è·åå¨å¸åº 5000+ åª A è¡è¡æ</li>
<li>åç½®å¹¶åæ§å¶ï¼ä¸ä¼ææ¥å£ææ</li>
<li>è¿åº¦åè°ï¼ç¥éå½åæåå°åªéäº</li>
</ul>
<h2 id="ä¸ºä»ä¹è¦ç¨å®">ä¸ºä»ä¹è¦ç¨å®ï¼</h2>
<p>è¯´å®è¯ï¼è¿ä¸ªé®é¢æèªå·±ä¹æ³è¿å¾ä¹ãæ¯ç«å¸é¢ä¸ä¸æ¯æ²¡æå¶ä»æ¹æ¡ã</p>
<p>ä½ä»ç»æ³æ³ï¼stock-sdk ç¡®å®è§£å³äºä¸äºçç¹ï¼</p>
<p><strong>1. é¶ä¾èµï¼ççå¾å°</strong></p>
<p>åç¼©åä¸å° 20KBãæ²¡æä¹±ä¸å«ç³çä¾èµï¼ä¸ä¼ç»ä½ çé¡¹ç®å¢å é¢å¤è´æã</p>
<p><strong>2. æµè§å¨å Node.js é½è½è·</strong></p>
<p>è¿ä¸ªæ¯æä¸å¼å§å°±ç¡®å®çè®¾è®¡ç®æ ãä¸ç®¡ä½ æ¯å Web é¡µé¢è¿æ¯ Node.js èæ¬ï¼é½è½ç´æ¥ç¨ãåæ¶æä¾ ESM å CommonJS ä¸¤ç§æ ¼å¼ï¼ç°ä»£é¡¹ç®åèé¡¹ç®é½å¼å®¹ã</p>
<p><strong>3. TypeScript ç±»åå®æ´</strong></p>
<p>è¯´ççï¼ç±»åæç¤ºè¿ä¸ªä¸è¥¿ï¼ç¨è¿å°±åä¸å»äºãæ¯ä¸ªæ¥å£è¿åä»ä¹å­æ®µãæ¯ä¸ªåæ°æ¯ä»ä¹ç±»åï¼IDE éä¸ç®äºç¶ãåä»£ç çæ¶åä¸ç¨åå¤æ¥ææ¡£ã</p>
<p><strong>4. æ¥å£ç¨³å®</strong></p>
<p>æ°æ®æºç¨çæ¯è¾è®¯è´¢ç»åä¸æ¹è´¢å¯çå¬å¼æ¥å£ï¼ç¨³å®æ§è¿æ¯æä¿éçãèä¸æåäºæ¯è¾å®åçéè¯¯å¤çï¼ä¸ä¼å ä¸ºæä¸ªè¯·æ±å¤±è´¥å°±æ´ä¸ªå´©æã</p>
<h2 id="éåä»ä¹åºæ¯">éåä»ä¹åºæ¯ï¼</h2>
<p>è¿ä¸ª SDK ä¸æ¯ä¸è½çï¼æä¹ä¸æç®æå®åæå¤§èå¨çä¸è¥¿ãå®æ¯è¾éåè¿äºåºæ¯ï¼</p>
<ul>
<li><strong>è¡ç¥¨çæ¿</strong>ï¼åä¸ä¸ªèªéè¡é¡µé¢ï¼ççæ¶¨è·</li>
<li><strong>æ°æ®å¯è§å</strong>ï¼ç¨ ECharts æè TradingView ç» K çº¿å¾</li>
<li><strong>å­¦ä¹  Demo</strong>ï¼éèè¯¾ç¨ãéåå¥é¨çæ¼ç¤ºé¡¹ç®</li>
<li><strong>éåéªè¯</strong>ï¼å¿«ééªè¯ä¸ä¸ªäº¤æç­ç¥çæ³æ³</li>
<li><strong>å®æ¶èæ¬</strong>ï¼Node.js å®æ¶æåè¡ææ°æ®</li>
</ul>
<p>å¦æä½ éè¦æ´ä¸ä¸çéååæµãé«é¢äº¤æä¹ç±»çï¼è¿ä¸ª SDK å¯è½å°±ä¸å¤ªå¤ç¨äºãé£ç§åºæ¯è¿æ¯ Python çææ´æçã</p>
<h2 id="ä¸äºå®éçä¾å­">ä¸äºå®éçä¾å­</h2>
<p><strong>è·åå¨å¸åº A è¡è¡æ</strong></p>
<pre><code class="language-ts">const allQuotes = await sdk.getAllAShareQuotes({
  batchSize: 300,
  concurrency: 5,
  onProgress: (completed, total) =&gt; {
    console.log(`è¿åº¦: ${completed}/${total}`);
  },
});

console.log(`å±è·å ${allQuotes.length} åªè¡ç¥¨`);
</code></pre>
<p>5000 å¤åªè¡ç¥¨ï¼å ç§éå°±æå®äºãå¹¶åæ§å¶æ¯åç½®çï¼ä¸ç¨èªå·±æå¿ã</p>
<p><strong>è·åå¸¦ææ¯ææ ç K çº¿</strong></p>
<pre><code class="language-ts">const data = await sdk.getKlineWithIndicators('sh600519', {
  period: 'daily',
  count: 100,
  indicators: {
    ma: { periods: [5, 10, 20] },
    macd: true,
    boll: true,
  },
});

// data.kline æ¯åå§ K çº¿
// data.indicators.ma æ¯åçº¿æ°æ®
// data.indicators.macd æ¯ MACD æ°æ®
// data.indicators.boll æ¯å¸æå¸¦æ°æ®
</code></pre>
<p>ä¸ä¸ªæ¥å£æ K çº¿åææ é½ç®å¥½äºï¼ç´æ¥æ¿å»ç»å¾å°±è¡ã</p>
<h2 id="åå¨æå">åå¨æå</h2>
<p>è¿ä¸ªé¡¹ç®ä»å»å¹´å¼å§åï¼æ­æ­ç»­ç»­ç»´æ¤å°ç°å¨ï¼åè½ä¹è¶æ¥è¶å®åäºã</p>
<p>å¶å®æä¸ç´è§å¾ï¼å·¥å·è¿ä¸ªä¸è¥¿ï¼å¥½ä¸å¥½ç¨èªå·±ææ¸æ¥ãstock-sdk å°±æ¯æèªå·±å¨ç¨çä¸è¥¿ï¼éå°é®é¢å°±ä¿®ï¼éè¦æ°åè½å°±å ã</p>
<p>å¦æä½ ä¹æ¯åç«¯ï¼ä¹éè¦è·åè¡ç¥¨æ°æ®ï¼ä¸å¦¨è¯è¯ãæé®é¢æ¬¢è¿æ Issueï¼æä¼å°½éååºã</p>
<hr>
<p><strong>ç¸å³é¾æ¥</strong></p>
<ul>
<li>ð¦ <a href="https://www.npmjs.com/package/stock-sdk" target="_blank" rel="noopener nofollow">NPM</a></li>
<li>ð <a href="https://github.com/chengzuopeng/stock-sdk" target="_blank" rel="noopener nofollow">GitHub</a></li>
<li>ð <a href="https://stock-sdk.linkdiary.cn/" target="_blank" rel="noopener nofollow">å®æ¹ææ¡£</a></li>
<li>ð® <a href="https://stock-sdk.linkdiary.cn/playground/" target="_blank" rel="noopener nofollow">å¨çº¿æ¼ç¤º</a></li>
</ul>
<p>å®è£å°±ä¸è¡å½ä»¤ï¼</p>
<pre><code class="language-bash">npm install stock-sdk
</code></pre>
<p>å¦æè§å¾è¿ä¸éï¼ç»ä¸ª Star â­ å~</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0763888888888889" data-date-updated="2025-12-29 20:06">2025-12-29 18:16</span>&nbsp;
<a href="https://www.cnblogs.com/chengzp">ç¨åºç¿çç¨</a>&nbsp;
éè¯»(<span id="post_view_count">160</span>)&nbsp;
è¯è®º(<span id="post_comment_count">3</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19417561);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19417561', targetLink: 'https://www.cnblogs.com/chengzp/p/19417561/stock-sdk', title: 'åç»åç«¯çè¡ç¥¨è¡æ SDK: stock-sdkï¼ç»äºä¸ç¨åæ±åç«¯å¸®å¿äº' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ºä»ä¹å¤§åä¸è¬ä¸æ¨èä½¿ç¨@Transactionalï¼ ]]></title>
    <link>https://www.cnblogs.com/12lisu/p/19420241</link>
    <guid>072c2a283a341f8aa6b189c3d82602fb</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/12lisu/p/19420241" title="åå¸äº 2025-12-30 11:18">
    <span role="heading" aria-level="2">ä¸ºä»ä¹å¤§åä¸è¬ä¸æ¨èä½¿ç¨@Transactionalï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="åè¨">åè¨</h2>
<p>å¯¹äºä»äºjavaå¼åå·¥ä½çåå­¦æ¥è¯´ï¼Springçäºå¡è¯å®åçæä¸è¿äºã</p>
<p>å¨æäºä¸å¡åºæ¯ä¸ï¼å¦æä¸ä¸ªè¯·æ±ä¸­ï¼éè¦åæ¶åå¥å¤å¼ è¡¨çæ°æ®ãä¸ºäºä¿è¯æä½çåå­æ§ï¼è¦ä¹åæ¶æåï¼è¦ä¹åæ¶å¤±è´¥ï¼ï¼é¿åæ°æ®ä¸ä¸è´çæåµï¼æä»¬ä¸è¬é½ä¼ç¨å°Springäºå¡ã</p>
<p>ç¡®å®ï¼Springäºå¡ç¨èµ·æ¥è´¼ç½ï¼å°±ç¨ä¸ä¸ªç®åçæ³¨è§£ï¼<code>@Transactional</code>ï¼å°±è½è½»æ¾æå®äºå¡ãæçå¤§é¨åå°ä¼ä¼´ä¹æ¯è¿æ ·ç¨çï¼èä¸ä¸ç´ç¨ä¸ç´ç½ã</p>
<p>ä½å¦æä½ ä½¿ç¨ä¸å½ï¼å®ä¹ä¼åä½ äºæ å½¢ã</p>
<p>ä»å¤©æä»¬å°±ä¸èµ·èèï¼äºå¡å¤±æçä¸äºåºæ¯ï¼è¯´ä¸å®ä½ å·²ç»ä¸­æäºãä¸ä¿¡ï¼è®©æä»¬ä¸èµ·ççã</p>
<p><img alt="" loading="lazy" data-src="https://pic.imgdb.cn/item/6130e80344eaada7399a9dfa.jpg" class="lazyload"></p>
<h2 id="ä¸-äºå¡ä¸çæ">ä¸ äºå¡ä¸çæ</h2>
<h3 id="1è®¿é®æéé®é¢">1.è®¿é®æéé®é¢</h3>
<p>ä¼æå¨ç¥ï¼javaçè®¿é®æéä¸»è¦æåç§ï¼privateãdefaultãprotectedãpublicï¼å®ä»¬çæéä»å·¦å°å³ï¼ä¾æ¬¡åå¤§ã</p>
<p>ä½å¦ææä»¬å¨å¼åè¿ç¨ä¸­ï¼æææäºäºå¡æ¹æ³ï¼å®ä¹äºéè¯¯çè®¿é®æéï¼å°±ä¼å¯¼è´äºå¡åè½åºé®é¢ï¼ä¾å¦ï¼</p>
<pre><code class="language-java">@Service
public class UserService {
    
    @Transactional
    private void add(UserModel userModel) {
         saveData(userModel);
         updateData(userModel);
    }
}
</code></pre>
<p>æä»¬å¯ä»¥çå°addæ¹æ³çè®¿é®æéè¢«å®ä¹æäº<code>private</code>ï¼è¿æ ·ä¼å¯¼è´äºå¡å¤±æï¼springè¦æ±è¢«ä»£çæ¹æ³å¿é¡»æ¯<code>public</code>çã</p>
<p>è¯´ç½äºï¼å¨<code>AbstractFallbackTransactionAttributeSource</code>ç±»ç<code>computeTransactionAttribute</code>æ¹æ³ä¸­æä¸ªå¤æ­ï¼å¦æç®æ æ¹æ³ä¸æ¯publicï¼å<code>TransactionAttribute</code>è¿ånullï¼å³ä¸æ¯æäºå¡ã</p>
<pre><code class="language-java">protected TransactionAttribute computeTransactionAttribute(Method method, @Nullable Class&lt;?&gt; targetClass) {
    // Don't allow no-public methods as required.
    if (allowPublicMethodsOnly() &amp;&amp; !Modifier.isPublic(method.getModifiers())) {
      return null;
    }

    // The method may be on an interface, but we need attributes from the target class.
    // If the target class is null, the method will be unchanged.
    Method specificMethod = AopUtils.getMostSpecificMethod(method, targetClass);

    // First try is the method in the target class.
    TransactionAttribute txAttr = findTransactionAttribute(specificMethod);
    if (txAttr != null) {
      return txAttr;
    }

    // Second try is the transaction attribute on the target class.
    txAttr = findTransactionAttribute(specificMethod.getDeclaringClass());
    if (txAttr != null &amp;&amp; ClassUtils.isUserLevelMethod(method)) {
      return txAttr;
    }

    if (specificMethod != method) {
      // Fallback is to look at the original method.
      txAttr = findTransactionAttribute(method);
      if (txAttr != null) {
        return txAttr;
      }
      // Last fallback is the class of the original method.
      txAttr = findTransactionAttribute(method.getDeclaringClass());
      if (txAttr != null &amp;&amp; ClassUtils.isUserLevelMethod(method)) {
        return txAttr;
      }
    }
    return null;
  }
</code></pre>
<p>ä¹å°±æ¯è¯´ï¼å¦ææä»¬èªå®ä¹çäºå¡æ¹æ³ï¼å³ç®æ æ¹æ³ï¼ï¼å®çè®¿é®æéä¸æ¯<code>public</code>ï¼èæ¯privateãdefaultæprotectedçè¯ï¼springåä¸ä¼æä¾äºå¡åè½ã</p>
<h3 id="2-æ¹æ³ç¨finalä¿®é¥°">2. æ¹æ³ç¨finalä¿®é¥°</h3>
<p>ææ¶åï¼æä¸ªæ¹æ³ä¸æ³è¢«å­ç±»éæ°ï¼è¿æ¶å¯ä»¥å°è¯¥æ¹æ³å®ä¹æfinalçãæ®éæ¹æ³è¿æ ·å®ä¹æ¯æ²¡é®é¢çï¼ä½å¦æå°äºå¡æ¹æ³å®ä¹æfinalï¼ä¾å¦ï¼</p>
<pre><code class="language-java">@Service
public class UserService {

    @Transactional
    public final void add(UserModel userModel){
        saveData(userModel);
        updateData(userModel);
    }
}
</code></pre>
<p>æä»¬å¯ä»¥çå°addæ¹æ³è¢«å®ä¹æäº<code>final</code>çï¼è¿æ ·ä¼å¯¼è´äºå¡å¤±æã</p>
<p>ä¸ºä»ä¹ï¼</p>
<p>å¦æä½ çè¿springäºå¡çæºç ï¼å¯è½ä¼ç¥éspringäºå¡åºå±ä½¿ç¨äºaopï¼ä¹å°±æ¯éè¿jdkå¨æä»£çæècglibï¼å¸®æä»¬çæäºä»£çç±»ï¼å¨ä»£çç±»ä¸­å®ç°çäºå¡åè½ã</p>
<p>ä½å¦ææä¸ªæ¹æ³ç¨finalä¿®é¥°äºï¼é£ä¹å¨å®çä»£çç±»ä¸­ï¼å°±æ æ³éåè¯¥æ¹æ³ï¼èæ·»å äºå¡åè½ã</p>
<blockquote>
<p>æ³¨æï¼å¦ææä¸ªæ¹æ³æ¯staticçï¼åæ ·æ æ³éè¿å¨æä»£çï¼åæäºå¡æ¹æ³ã</p>
</blockquote>
<h3 id="3æ¹æ³åé¨è°ç¨">3.æ¹æ³åé¨è°ç¨</h3>
<p>ææ¶åæä»¬éè¦å¨æä¸ªServiceç±»çæä¸ªæ¹æ³ä¸­ï¼è°ç¨å¦å¤ä¸ä¸ªäºå¡æ¹æ³ï¼æ¯å¦ï¼</p>
<pre><code class="language-java">@Service
public class UserService {

    @Autowired
    private UserMapper userMapper;

    //@Transactional
    public void add(UserModel userModel) {
        userMapper.insertUser(userModel);
        updateStatus(userModel);
    }

    @Transactional
    public void updateStatus(UserModel userModel) {
        doSameThing();
    }
}
</code></pre>
<p>æä»¬çå°å¨äºå¡æ¹æ³addä¸­ï¼ç´æ¥è°ç¨äºå¡æ¹æ³updateStatusãä»åé¢ä»ç»çåå®¹å¯ä»¥ç¥éï¼updateStatusæ¹æ³æ¥æäºå¡çè½åæ¯å ä¸ºspring aopçæä»£çäºå¯¹è±¡ï¼ä½æ¯è¿ç§æ¹æ³ç´æ¥è°ç¨äºthiså¯¹è±¡çæ¹æ³ï¼æä»¥updateStatusæ¹æ³ä¸ä¼çæäºå¡ã</p>
<p>ç±æ­¤å¯è§ï¼å¨åä¸ä¸ªç±»ä¸­çæ¹æ³ç´æ¥åé¨è°ç¨ï¼ä¼å¯¼è´äºå¡å¤±æã</p>
<p>é£ä¹é®é¢æ¥äºï¼å¦ææäºåºæ¯ï¼ç¡®å®æ³å¨åä¸ä¸ªç±»çæä¸ªæ¹æ³ä¸­ï¼è°ç¨å®èªå·±çå¦å¤ä¸ä¸ªæ¹æ³ï¼è¯¥æä¹åå¢ï¼</p>
<h4 id="31-æ°å ä¸ä¸ªserviceæ¹æ³">3.1 æ°å ä¸ä¸ªServiceæ¹æ³</h4>
<p>è¿ä¸ªæ¹æ³éå¸¸ç®åï¼åªéè¦æ°å ä¸ä¸ªServiceæ¹æ³ï¼æ@Transactionalæ³¨è§£å å°æ°Serviceæ¹æ³ä¸ï¼æéè¦äºå¡æ§è¡çä»£ç ç§»å°æ°æ¹æ³ä¸­ãå·ä½ä»£ç å¦ä¸ï¼</p>
<pre><code class="language-java">@Servcie
public class ServiceA {
   @Autowired
   prvate ServiceB serviceB;

   public void save(User user) {
         queryData1();
         queryData2();
         serviceB.doSave(user);
   }
 }

 @Servcie
 public class ServiceB {

    @Transactional(rollbackFor=Exception.class)
    public void doSave(User user) {
       addData1();
       updateData2();
    }

 }
</code></pre>
<h4 id="32-å¨è¯¥serviceç±»ä¸­æ³¨å¥èªå·±">3.2 å¨è¯¥Serviceç±»ä¸­æ³¨å¥èªå·±</h4>
<p>å¦æä¸æ³åæ°å ä¸ä¸ªServiceç±»ï¼å¨è¯¥Serviceç±»ä¸­æ³¨å¥èªå·±ä¹æ¯ä¸ç§éæ©ãå·ä½ä»£ç å¦ä¸ï¼</p>
<pre><code class="language-java">@Servcie
public class ServiceA {
   @Autowired
   prvate ServiceA serviceA;

   public void save(User user) {
         queryData1();
         queryData2();
         serviceA.doSave(user);
   }

   @Transactional(rollbackFor=Exception.class)
   public void doSave(User user) {
       addData1();
       updateData2();
    }
 }
</code></pre>
<p>å¯è½æäºäººå¯è½ä¼æè¿æ ·ççé®ï¼è¿ç§åæ³ä¼ä¸ä¼åºç°å¾ªç¯ä¾èµé®é¢ï¼</p>
<p>ç­æ¡ï¼ä¸ä¼ã</p>
<p>å¶å®spring iocåé¨çä¸çº§ç¼å­ä¿è¯äºå®ï¼ä¸ä¼åºç°å¾ªç¯ä¾èµé®é¢ãä½æäºåï¼å¦æä½ æ³è¿ä¸æ­¥äºè§£å¾ªç¯ä¾èµé®é¢ï¼å¯ä»¥ççæä¹åæç« ã<a href="https://mp.weixin.qq.com/s?__biz=MzUxODkzNTQ3Nw==&amp;mid=2247485600&amp;idx=1&amp;sn=0c49b94e7fbd35c88c4470e936023e3e&amp;chksm=f9800e7acef7876ca05ab45ce9420ea140f188e84153f23d0af9d044f475458ad38d49a6546a&amp;token=1641046204&amp;lang=zh_CN#rd" target="_blank" rel="noopener nofollow">springï¼ææ¯å¦ä½è§£å³å¾ªç¯ä¾èµçï¼</a>ãã</p>
<h4 id="33-éè¿aopcontentç±»">3.3 éè¿AopContentç±»</h4>
<p>å¨è¯¥Serviceç±»ä¸­ä½¿ç¨AopContext.currentProxy()è·åä»£çå¯¹è±¡</p>
<p>ä¸é¢çæ¹æ³2ç¡®å®å¯ä»¥è§£å³é®é¢ï¼ä½æ¯ä»£ç çèµ·æ¥å¹¶ä¸ç´è§ï¼è¿å¯ä»¥éè¿å¨è¯¥Serviceç±»ä¸­ä½¿ç¨AOPProxyè·åä»£çå¯¹è±¡ï¼å®ç°ç¸åçåè½ãå·ä½ä»£ç å¦ä¸ï¼</p>
<pre><code class="language-java">@Servcie
public class ServiceA {

   public void save(User user) {
         queryData1();
         queryData2();
         ((ServiceA)AopContext.currentProxy()).doSave(user);
   }

   @Transactional(rollbackFor=Exception.class)
   public void doSave(User user) {
       addData1();
       updateData2();
    }
 }
</code></pre>
<h3 id="4æªè¢«springç®¡ç">4.æªè¢«springç®¡ç</h3>
<p>å¨æä»¬å¹³æ¶å¼åè¿ç¨ä¸­ï¼æä¸ªç»èå¾å®¹æè¢«å¿½ç¥ãå³ä½¿ç¨springäºå¡çåææ¯ï¼å¯¹è±¡è¦è¢«springç®¡çï¼éè¦åå»ºbeanå®ä¾ã</p>
<p>éå¸¸æåµä¸ï¼æä»¬éè¿@Controllerã@Serviceã@Componentã@Repositoryç­æ³¨è§£ï¼å¯ä»¥èªå¨å®ç°beanå®ä¾ååä¾èµæ³¨å¥çåè½ã</p>
<p>å½ç¶åå»ºbeanå®ä¾çæ¹æ³è¿æå¾å¤ï¼æå´è¶£çå°ä¼ä¼´å¯ä»¥ççæä¹ååçå¦ä¸ç¯æç« ã<a href="https://mp.weixin.qq.com/s?__biz=MzUxODkzNTQ3Nw==&amp;mid=2247488466&amp;idx=1&amp;sn=1e63e6991b5fb47e067d2edf055981d3&amp;chksm=f9801508cef79c1ea208906ceef09593a9f594b3926478eb65b7ef64e0311f13ac5aaf4135ce&amp;token=1641046204&amp;lang=zh_CN#rd" target="_blank" rel="noopener nofollow">@Autowiredçè¿äºéªæä½ï¼ä½ é½ç¥éåï¼</a>ã</p>
<p>å¦ææä¸å¤©ï¼ä½ ååå¿å¿çå¼åäºä¸ä¸ªServiceç±»ï¼ä½å¿äºå @Serviceæ³¨è§£ï¼æ¯å¦ï¼</p>
<pre><code class="language-java">//@Service
public class UserService {

    @Transactional
    public void add(UserModel userModel) {
         saveData(userModel);
         updateData(userModel);
    }    
}
</code></pre>
<p>ä»ä¸é¢çä¾å­ï¼æä»¬å¯ä»¥çå°UserServiceç±»æ²¡æå <code>@Service</code>æ³¨è§£ï¼é£ä¹è¯¥ç±»ä¸ä¼äº¤ç»springç®¡çï¼æä»¥å®çaddæ¹æ³ä¹ä¸ä¼çæäºå¡ã</p>
<h3 id="5å¤çº¿ç¨è°ç¨">5.å¤çº¿ç¨è°ç¨</h3>
<p>å¨å®éé¡¹ç®å¼åä¸­ï¼å¤çº¿ç¨çä½¿ç¨åºæ¯è¿æ¯æºå¤çãå¦æspringäºå¡ç¨å¨å¤çº¿ç¨åºæ¯ä¸­ï¼ä¼æé®é¢åï¼</p>
<pre><code class="language-java">@Slf4j
@Service
public class UserService {

    @Autowired
    private UserMapper userMapper;
    @Autowired
    private RoleService roleService;

    @Transactional
    public void add(UserModel userModel) throws Exception {
        userMapper.insertUser(userModel);
        new Thread(() -&gt; {
            roleService.doOtherThing();
        }).start();
    }
}

@Service
public class RoleService {

    @Transactional
    public void doOtherThing() {
        System.out.println("ä¿å­roleè¡¨æ°æ®");
    }
}
</code></pre>
<p>ä»ä¸é¢çä¾å­ä¸­ï¼æä»¬å¯ä»¥çå°äºå¡æ¹æ³addä¸­ï¼è°ç¨äºäºå¡æ¹æ³doOtherThingï¼ä½æ¯äºå¡æ¹æ³doOtherThingæ¯å¨å¦å¤ä¸ä¸ªçº¿ç¨ä¸­è°ç¨çã</p>
<p>è¿æ ·ä¼å¯¼è´ä¸¤ä¸ªæ¹æ³ä¸å¨åä¸ä¸ªçº¿ç¨ä¸­ï¼è·åå°çæ°æ®åºè¿æ¥ä¸ä¸æ ·ï¼ä»èæ¯ä¸¤ä¸ªä¸åçäºå¡ãå¦ææ³doOtherThingæ¹æ³ä¸­æäºå¼å¸¸ï¼addæ¹æ³ä¹åæ»æ¯ä¸å¯è½çã</p>
<p>å¦æçè¿springäºå¡æºç çæåï¼å¯è½ä¼ç¥éspringçäºå¡æ¯éè¿æ°æ®åºè¿æ¥æ¥å®ç°çãå½åçº¿ç¨ä¸­ä¿å­äºä¸ä¸ªmapï¼keyæ¯æ°æ®æºï¼valueæ¯æ°æ®åºè¿æ¥ã</p>
<pre><code class="language-java">private static final ThreadLocal&lt;Map&lt;Object, Object&gt;&gt; resources =

  new NamedThreadLocal&lt;&gt;("Transactional resources");
</code></pre>
<p>æä»¬è¯´çåä¸ä¸ªäºå¡ï¼å¶å®æ¯æåä¸ä¸ªæ°æ®åºè¿æ¥ï¼åªææ¥æåä¸ä¸ªæ°æ®åºè¿æ¥æè½åæ¶æäº¤ååæ»ãå¦æå¨ä¸åççº¿ç¨ï¼æ¿å°çæ°æ®åºè¿æ¥è¯å®æ¯ä¸ä¸æ ·çï¼æä»¥æ¯ä¸åçäºå¡ã</p>
<h3 id="6è¡¨ä¸æ¯æäºå¡">6.è¡¨ä¸æ¯æäºå¡</h3>
<p>å¨æå¨ç¥ï¼å¨mysql5ä¹åï¼é»è®¤çæ°æ®åºå¼ææ¯<code>myisam</code>ã</p>
<p>å®çå¥½å¤å°±ä¸ç¨å¤è¯´äºï¼ç´¢å¼æä»¶åæ°æ®æä»¶æ¯åå¼å­å¨çï¼å¯¹äºæ¥å¤åå°çåè¡¨æä½ï¼æ§è½æ¯innodbæ´å¥½ã</p>
<p>æäºèé¡¹ç®ä¸­ï¼å¯è½è¿å¨ç¨å®ã</p>
<p>å¨åå»ºè¡¨çæ¶åï¼åªéè¦æ<code>ENGINE</code>åæ°è®¾ç½®æ<code>MyISAM</code>å³å¯ï¼</p>
<pre><code class="language-java">CREATE TABLE `category` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `one_category` varchar(20) COLLATE utf8mb4_bin DEFAULT NULL,
  `two_category` varchar(20) COLLATE utf8mb4_bin DEFAULT NULL,
  `three_category` varchar(20) COLLATE utf8mb4_bin DEFAULT NULL,
  `four_category` varchar(20) COLLATE utf8mb4_bin DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
</code></pre>
<p>myisamå¥½ç¨ï¼ä½æä¸ªå¾è´å½çé®é¢æ¯ï¼<code>ä¸æ¯æäºå¡</code>ã</p>
<p>å¦æåªæ¯åè¡¨æä½è¿å¥½ï¼ä¸ä¼åºç°å¤ªå¤§çé®é¢ãä½å¦æéè¦è·¨å¤å¼ è¡¨æä½ï¼ç±äºå¶ä¸æ¯æäºå¡ï¼æ°æ®ææå¯è½ä¼åºç°ä¸å®æ´çæåµã</p>
<p>æ­¤å¤ï¼myisamè¿ä¸æ¯æè¡éåå¤é®ã</p>
<p>æä»¥å¨å®éä¸å¡åºæ¯ä¸­ï¼myisamä½¿ç¨çå¹¶ä¸å¤ãå¨mysql5ä»¥åï¼myisamå·²ç»éæ¸éåºäºåå²çèå°ï¼åèä»£ä¹çæ¯innodbã</p>
<blockquote>
<p>ææ¶åæä»¬å¨å¼åçè¿ç¨ä¸­ï¼åç°æå¼ è¡¨çäºå¡ä¸ç´é½æ²¡æçæï¼é£ä¸ä¸å®æ¯springäºå¡çéï¼æå¥½ç¡®è®¤ä¸ä¸ä½ ä½¿ç¨çé£å¼ è¡¨ï¼æ¯å¦æ¯æäºå¡ã</p>
</blockquote>
<h3 id="7æªå¼å¯äºå¡">7.æªå¼å¯äºå¡</h3>
<p>ææ¶åï¼äºå¡æ²¡æçæçæ ¹æ¬åå æ¯æ²¡æå¼å¯äºå¡ã</p>
<p>ä½ çå°è¿å¥è¯å¯è½ä¼è§å¾å¥½ç¬ã</p>
<p>å¼å¯äºå¡ä¸æ¯ä¸ä¸ªé¡¹ç®ä¸­ï¼æææåºæ¬çåè½åï¼</p>
<p>ä¸ºä»ä¹è¿ä¼æ²¡æå¼å¯äºå¡ï¼</p>
<p>æ²¡éï¼å¦æé¡¹ç®å·²ç»æ­å»ºå¥½äºï¼äºå¡åè½è¯å®æ¯æçã</p>
<p>ä½å¦æä½ æ¯å¨æ­å»ºé¡¹ç®demoçæ¶åï¼åªæä¸å¼ è¡¨ï¼èè¿å¼ è¡¨çäºå¡æ²¡æçæãé£ä¹ä¼æ¯ä»ä¹åå é æçå¢ï¼</p>
<p>å½ç¶åå æå¾å¤ï¼ä½æ²¡æå¼å¯äºå¡ï¼è¿ä¸ªåå æå¶å®¹æè¢«å¿½ç¥ã</p>
<p>å¦æä½ ä½¿ç¨çæ¯springbooté¡¹ç®ï¼é£ä¹ä½ å¾å¹¸è¿ãå ä¸ºspringbootéè¿<code>DataSourceTransactionManagerAutoConfiguration</code>ç±»ï¼å·²ç»é»é»çå¸®ä½ å¼å¯äºäºå¡ã</p>
<p>ä½ æè¦åçäºæå¾ç®åï¼åªéè¦éç½®<code>spring.datasource</code>ç¸å³åæ°å³å¯ã</p>
<p>ä½å¦æä½ ä½¿ç¨çè¿æ¯ä¼ ç»çspringé¡¹ç®ï¼åéè¦å¨applicationContext.xmlæä»¶ä¸­ï¼æå¨éç½®äºå¡ç¸å³åæ°ãå¦æå¿äºéç½®ï¼äºå¡è¯å®æ¯ä¸ä¼çæçã</p>
<p>å·ä½éç½®å¦ä¸ä¿¡æ¯ï¼</p>
<pre><code class="language-java">   
&lt;!-- éç½®äºå¡ç®¡çå¨ --&gt; 
&lt;bean class="org.springframework.jdbc.datasource.DataSourceTransactionManager" id="transactionManager"&gt; 
    &lt;property name="dataSource" ref="dataSource"&gt;&lt;/property&gt; 
&lt;/bean&gt; 
&lt;tx:advice id="advice" transaction-manager="transactionManager"&gt; 
    &lt;tx:attributes&gt; 
        &lt;tx:method name="*" propagation="REQUIRED"/&gt;
    &lt;/tx:attributes&gt; 
&lt;/tx:advice&gt; 
&lt;!-- ç¨åç¹æäºå¡åè¿å» --&gt; 
&lt;aop:config&gt; 
    &lt;aop:pointcut expression="execution(* com.susan.*.*(..))" id="pointcut"/&gt; 
    &lt;aop:advisor advice-ref="advice" pointcut-ref="pointcut"/&gt; 
&lt;/aop:config&gt; 
</code></pre>
<p>é»é»çè¯´ä¸å¥ï¼å¦æå¨pointcutæ ç­¾ä¸­çåå¥ç¹å¹éè§åï¼ééäºçè¯ï¼æäºç±»çäºå¡ä¹ä¸ä¼çæã</p>
<h2 id="äº-äºå¡ä¸åæ»">äº äºå¡ä¸åæ»</h2>
<h3 id="1éè¯¯çä¼ æ­ç¹æ§">1.éè¯¯çä¼ æ­ç¹æ§</h3>
<p>å¶å®ï¼æä»¬å¨ä½¿ç¨<code>@Transactional</code>æ³¨è§£æ¶ï¼æ¯å¯ä»¥æå®<code>propagation</code>åæ°çã</p>
<p>è¯¥åæ°çä½ç¨æ¯æå®äºå¡çä¼ æ­ç¹æ§ï¼springç®åæ¯æ7ç§ä¼ æ­ç¹æ§ï¼</p>
<ul>
<li><code>REQUIRED</code> å¦æå½åä¸ä¸æä¸­å­å¨äºå¡ï¼é£ä¹å å¥è¯¥äºå¡ï¼å¦æä¸å­å¨äºå¡ï¼åå»ºä¸ä¸ªäºå¡ï¼è¿æ¯é»è®¤çä¼ æ­å±æ§å¼ã</li>
<li><code>SUPPORTS</code> å¦æå½åä¸ä¸æå­å¨äºå¡ï¼åæ¯æäºå¡å å¥äºå¡ï¼å¦æä¸å­å¨äºå¡ï¼åä½¿ç¨éäºå¡çæ¹å¼æ§è¡ã</li>
<li><code>MANDATORY</code> å¦æå½åä¸ä¸æä¸­å­å¨äºå¡ï¼å¦åæåºå¼å¸¸ã</li>
<li><code>REQUIRES_NEW</code> æ¯æ¬¡é½ä¼æ°å»ºä¸ä¸ªäºå¡ï¼å¹¶ä¸åæ¶å°ä¸ä¸æä¸­çäºå¡æèµ·ï¼æ§è¡å½åæ°å»ºäºå¡å®æä»¥åï¼ä¸ä¸æäºå¡æ¢å¤åæ§è¡ã</li>
<li><code>NOT_SUPPORTED</code> å¦æå½åä¸ä¸æä¸­å­å¨äºå¡ï¼åæèµ·å½åäºå¡ï¼ç¶åæ°çæ¹æ³å¨æ²¡æäºå¡çç¯å¢ä¸­æ§è¡ã</li>
<li><code>NEVER</code> å¦æå½åä¸ä¸æä¸­å­å¨äºå¡ï¼åæåºå¼å¸¸ï¼å¦åå¨æ äºå¡ç¯å¢ä¸æ§è¡ä»£ç ã</li>
<li><code>NESTED</code> å¦æå½åä¸ä¸æä¸­å­å¨äºå¡ï¼ååµå¥äºå¡æ§è¡ï¼å¦æä¸å­å¨äºå¡ï¼åæ°å»ºäºå¡ã</li>
</ul>
<p>å¦ææä»¬å¨æå¨è®¾ç½®propagationåæ°çæ¶åï¼æä¼ æ­ç¹æ§è®¾ç½®éäºï¼æ¯å¦ï¼</p>
<pre><code class="language-java">@Service
public class UserService {

    @Transactional(propagation = Propagation.NEVER)
    public void add(UserModel userModel) {
        saveData(userModel);
        updateData(userModel);
    }
}
</code></pre>
<p>æä»¬å¯ä»¥çå°addæ¹æ³çäºå¡ä¼ æ­ç¹æ§å®ä¹æäºPropagation.NEVERï¼è¿ç§ç±»åçä¼ æ­ç¹æ§ä¸æ¯æäºå¡ï¼å¦ææäºå¡åä¼æå¼å¸¸ã</p>
<p>ç®ååªæè¿ä¸ç§ä¼ æ­ç¹æ§æä¼åå»ºæ°äºå¡ï¼REQUIREDï¼REQUIRES_NEWï¼NESTEDã</p>
<h3 id="2èªå·±åäºå¼å¸¸">2.èªå·±åäºå¼å¸¸</h3>
<p>äºå¡ä¸ä¼åæ»ï¼æå¸¸è§çé®é¢æ¯ï¼å¼åèå¨ä»£ç ä¸­æå¨try...catchäºå¼å¸¸ãæ¯å¦ï¼</p>
<pre><code class="language-java">@Slf4j
@Service
public class UserService {
    
    @Transactional
    public void add(UserModel userModel) {
        try {
            saveData(userModel);
            updateData(userModel);
        } catch (Exception e) {
            log.error(e.getMessage(), e);
        }
    }
}
</code></pre>
<p>è¿ç§æåµä¸springäºå¡å½ç¶ä¸ä¼åæ»ï¼å ä¸ºå¼åèèªå·±æè·äºå¼å¸¸ï¼åæ²¡ææå¨æåºï¼æ¢å¥è¯è¯´å°±æ¯æå¼å¸¸åæäºã</p>
<p>å¦ææ³è¦springäºå¡è½å¤æ­£å¸¸åæ»ï¼å¿é¡»æåºå®è½å¤å¤ççå¼å¸¸ãå¦ææ²¡ææå¼å¸¸ï¼åspringè®¤ä¸ºç¨åºæ¯æ­£å¸¸çã</p>
<h3 id="3æå¨æäºå«çå¼å¸¸">3.æå¨æäºå«çå¼å¸¸</h3>
<p>å³ä½¿å¼åèæ²¡ææå¨æè·å¼å¸¸ï¼ä½å¦ææçå¼å¸¸ä¸æ­£ç¡®ï¼springäºå¡ä¹ä¸ä¼åæ»ã</p>
<pre><code class="language-java">@Slf4j
@Service
public class UserService {
    
    @Transactional
    public void add(UserModel userModel) throws Exception {
        try {
             saveData(userModel);
             updateData(userModel);
        } catch (Exception e) {
            log.error(e.getMessage(), e);
            throw new Exception(e);
        }
    }
}
</code></pre>
<p>ä¸é¢çè¿ç§æåµï¼å¼åäººåèªå·±æè·äºå¼å¸¸ï¼åæå¨æåºäºå¼å¸¸ï¼Exceptionï¼äºå¡åæ ·ä¸ä¼åæ»ã</p>
<p>å ä¸ºspringäºå¡ï¼é»è®¤æåµä¸åªä¼åæ»<code>RuntimeException</code>ï¼è¿è¡æ¶å¼å¸¸ï¼å<code>Error</code>ï¼éè¯¯ï¼ï¼å¯¹äºæ®éçExceptionï¼éè¿è¡æ¶å¼å¸¸ï¼ï¼å®ä¸ä¼åæ»ã</p>
<h3 id="4èªå®ä¹äºåæ»å¼å¸¸">4.èªå®ä¹äºåæ»å¼å¸¸</h3>
<p>å¨ä½¿ç¨@Transactionalæ³¨è§£å£°æäºå¡æ¶ï¼ææ¶æä»¬æ³èªå®ä¹åæ»çå¼å¸¸ï¼springä¹æ¯æ¯æçãå¯ä»¥éè¿è®¾ç½®<code>rollbackFor</code>åæ°ï¼æ¥å®æè¿ä¸ªåè½ã</p>
<p>ä½å¦æè¿ä¸ªåæ°çå¼è®¾ç½®éäºï¼å°±ä¼å¼åºä¸äºè«åå¶å¦çé®é¢ï¼ä¾å¦ï¼</p>
<pre><code class="language-java">@Slf4j
@Service
public class UserService {
    
    @Transactional(rollbackFor = BusinessException.class)
    public void add(UserModel userModel) throws Exception {
       saveData(userModel);
       updateData(userModel);
    }
}
</code></pre>
<p>å¦æå¨æ§è¡ä¸é¢è¿æ®µä»£ç ï¼ä¿å­åæ´æ°æ°æ®æ¶ï¼ç¨åºæ¥éäºï¼æäºSqlExceptionãDuplicateKeyExceptionç­å¼å¸¸ãèBusinessExceptionæ¯æä»¬èªå®ä¹çå¼å¸¸ï¼æ¥éçå¼å¸¸ä¸å±äºBusinessExceptionï¼æä»¥äºå¡ä¹ä¸ä¼åæ»ã</p>
<p>å³ä½¿rollbackForæé»è®¤å¼ï¼ä½é¿éå·´å·´å¼åèè§èä¸­ï¼è¿æ¯è¦æ±å¼åèéæ°æå®è¯¥åæ°ã</p>
<p>è¿æ¯ä¸ºä»ä¹å¢ï¼</p>
<p>å ä¸ºå¦æä½¿ç¨é»è®¤å¼ï¼ä¸æ¦ç¨åºæåºäºExceptionï¼äºå¡ä¸ä¼åæ»ï¼è¿ä¼åºç°å¾å¤§çbugãæä»¥ï¼å»ºè®®ä¸è¬æåµä¸ï¼å°è¯¥åæ°è®¾ç½®æï¼ExceptionæThrowableã</p>
<h3 id="5åµå¥äºå¡åæ»å¤äº">5.åµå¥äºå¡åæ»å¤äº</h3>
<pre><code class="language-java">public class UserService {

    @Autowired
    private UserMapper userMapper;

    @Autowired
    private RoleService roleService;

    @Transactional
    public void add(UserModel userModel) throws Exception {
        userMapper.insertUser(userModel);
        roleService.doOtherThing();
    }
}

@Service
public class RoleService {

    @Transactional(propagation = Propagation.NESTED)
    public void doOtherThing() {
        System.out.println("ä¿å­roleè¡¨æ°æ®");
    }
}
</code></pre>
<p>è¿ç§æåµä½¿ç¨äºåµå¥çåé¨äºå¡ï¼åæ¬æ¯å¸æè°ç¨roleService.doOtherThingæ¹æ³æ¶ï¼å¦æåºç°äºå¼å¸¸ï¼åªåæ»doOtherThingæ¹æ³éçåå®¹ï¼ä¸åæ» userMapper.insertUseréçåå®¹ï¼å³åæ»ä¿å­ç¹ããä½äºå®æ¯ï¼insertUserä¹åæ»äºã</p>
<p>why?</p>
<p>å ä¸ºdoOtherThingæ¹æ³åºç°äºå¼å¸¸ï¼æ²¡ææå¨æè·ï¼ä¼ç»§ç»­å¾ä¸æï¼å°å¤å±addæ¹æ³çä»£çæ¹æ³ä¸­æè·äºå¼å¸¸ãæä»¥ï¼è¿ç§æåµæ¯ç´æ¥åæ»äºæ´ä¸ªäºå¡ï¼ä¸åªåæ»åä¸ªä¿å­ç¹ã</p>
<p>æä¹æ ·æè½åªåæ»ä¿å­ç¹å¢ï¼</p>
<pre><code class="language-java">@Slf4j
@Service
public class UserService {

    @Autowired
    private UserMapper userMapper;

    @Autowired
    private RoleService roleService;

    @Transactional
    public void add(UserModel userModel) throws Exception {

        userMapper.insertUser(userModel);
        try {
            roleService.doOtherThing();
        } catch (Exception e) {
            log.error(e.getMessage(), e);
        }
    }
}
</code></pre>
<p>å¯ä»¥å°åé¨åµå¥äºå¡æ¾å¨try/catchä¸­ï¼å¹¶ä¸ä¸ç»§ç»­å¾ä¸æå¼å¸¸ãè¿æ ·å°±è½ä¿è¯ï¼å¦æåé¨åµå¥äºå¡ä¸­åºç°å¼å¸¸ï¼åªåæ»åé¨äºå¡ï¼èä¸å½±åå¤é¨äºå¡ã</p>
<h2 id="ä¸-å¶ä»">ä¸ å¶ä»</h2>
<h3 id="1-å¤§äºå¡é®é¢">1 å¤§äºå¡é®é¢</h3>
<p>å¨ä½¿ç¨springäºå¡æ¶ï¼æä¸ªè®©äººéå¸¸å¤´ç¼çé®é¢ï¼å°±æ¯å¤§äºå¡é®é¢ã</p>
<p>éå¸¸æåµä¸ï¼æä»¬ä¼å¨æ¹æ³ä¸<code>@Transactional</code>æ³¨è§£ï¼å¡«å äºå¡åè½ï¼æ¯å¦ï¼</p>
<pre><code class="language-java">@Service
public class UserService {
    
    @Autowired 
    private RoleService roleService;
    
    @Transactional
    public void add(UserModel userModel) throws Exception {
       query1();
       query2();
       query3();
       roleService.save(userModel);
       update(userModel);
    }
}


@Service
public class RoleService {
    
    @Autowired 
    private RoleService roleService;
    
    @Transactional
    public void save(UserModel userModel) throws Exception {
       query4();
       query5();
       query6();
       saveData(userModel);
    }
}
</code></pre>
<p>ä½<code>@Transactional</code>æ³¨è§£ï¼å¦æè¢«å å°æ¹æ³ä¸ï¼æä¸ªç¼ºç¹å°±æ¯æ´ä¸ªæ¹æ³é½åå«å¨äºå¡å½ä¸­äºã</p>
<p>ä¸é¢çè¿ä¸ªä¾å­ä¸­ï¼å¨UserServiceç±»ä¸­ï¼å¶å®åªæè¿ä¸¤è¡æéè¦äºå¡ï¼</p>
<pre><code class="language-java">roleService.save(userModel);
update(userModel);
</code></pre>
<p>å¨RoleServiceç±»ä¸­ï¼åªæè¿ä¸è¡éè¦äºå¡ï¼</p>
<pre><code class="language-java">saveData(userModel);
</code></pre>
<p>ç°å¨çè¿ç§åæ³ï¼ä¼å¯¼è´ææçqueryæ¹æ³ä¹è¢«åå«å¨åä¸ä¸ªäºå¡å½ä¸­ã</p>
<p>å¦æqueryæ¹æ³éå¸¸å¤ï¼è°ç¨å±çº§å¾æ·±ï¼èä¸æé¨åæ¥è¯¢æ¹æ³æ¯è¾èæ¶çè¯ï¼ä¼é ææ´ä¸ªäºå¡éå¸¸èæ¶ï¼èä»é æå¤§äºå¡é®é¢ã</p>
<p>å³äºå¤§äºå¡é®é¢çå±å®³ï¼å¯ä»¥éè¯»ä¸ä¸æçå¦ä¸ç¯æç« ã<a href="https://mp.weixin.qq.com/s?__biz=MzUxODkzNTQ3Nw==&amp;mid=2247485262&amp;idx=1&amp;sn=abe19452e4c13876270f329cc6929be7&amp;chksm=f9800194cef78882e5ad4d8eb00b7e3f745a4159aee6afb1858cc16cae599f8889afa330e17b&amp;token=305097496&amp;lang=zh_CN#rd" target="_blank" rel="noopener nofollow">è®©äººå¤´ççå¤§äºå¡é®é¢å°åºè¦å¦ä½è§£å³ï¼</a>ãï¼ä¸é¢æè¯¦ç»çè®²è§£ã</p>
<p><img alt="" loading="lazy" data-src="https://pic.imgdb.cn/item/6130f3d044eaada739be3541.jpg" class="lazyload"></p>
<h3 id="2ç¼ç¨å¼äºå¡">2.ç¼ç¨å¼äºå¡</h3>
<p>ä¸é¢èçè¿äºåå®¹é½æ¯åºäº<code>@Transactional</code>æ³¨è§£çï¼ä¸»è¦è¯´çæ¯å®çäºå¡é®é¢ï¼æä»¬æè¿ç§äºå¡å«åï¼<code>å£°æå¼äºå¡</code>ã</p>
<p>å¶å®ï¼springè¿æä¾äºå¦å¤ä¸ç§åå»ºäºå¡çæ¹å¼ï¼å³éè¿æå¨ç¼åä»£ç å®ç°çäºå¡ï¼æä»¬æè¿ç§äºå¡å«åï¼<code>ç¼ç¨å¼äºå¡</code>ãä¾å¦ï¼</p>
<pre><code class="language-java">
   @Autowired
   private TransactionTemplate transactionTemplate;
   
   ...
   
   public void save(final User user) {
         queryData1();
         queryData2();
         transactionTemplate.execute((status) =&gt; {
            addData1();
            updateData2();
            return Boolean.TRUE;
         })
   }
</code></pre>
<p>å¨springä¸­ä¸ºäºæ¯æç¼ç¨å¼äºå¡ï¼ä¸é¨æä¾äºä¸ä¸ªç±»ï¼TransactionTemplateï¼å¨å®çexecuteæ¹æ³ä¸­ï¼å°±å®ç°äºäºå¡çåè½ã</p>
<p>ç¸è¾äº<code>@Transactional</code>æ³¨è§£å£°æå¼äºå¡ï¼ææ´å»ºè®®å¤§å®¶ä½¿ç¨ï¼åºäº<code>TransactionTemplate</code>çç¼ç¨å¼äºå¡ãä¸»è¦åå å¦ä¸ï¼</p>
<ol>
<li>é¿åç±äºspring aopé®é¢ï¼å¯¼è´äºå¡å¤±æçé®é¢ã</li>
<li>è½å¤æ´å°ç²åº¦çæ§å¶äºå¡çèå´ï¼æ´ç´è§ã</li>
</ol>
<blockquote>
<p>å»ºè®®å¨é¡¹ç®ä¸­å°ä½¿ç¨@Transactionalæ³¨è§£å¼å¯äºå¡ãä½å¹¶ä¸æ¯è¯´ä¸å®ä¸è½ç¨å®ï¼å¦æé¡¹ç®ä¸­æäºä¸å¡é»è¾æ¯è¾ç®åï¼èä¸ä¸ç»å¸¸åå¨ï¼ä½¿ç¨@Transactionalæ³¨è§£å¼å¯äºå¡å¼å¯äºå¡ä¹æ å¦¨ï¼å ä¸ºå®æ´ç®åï¼å¼åæçæ´é«ï¼ä½æ¯åä¸è¦å°å¿äºå¡å¤±æçé®é¢ã</p>
</blockquote>
<h2 id="æåè¯´ä¸å¥æ±å³æ³¨å«ç½å«æ">æåè¯´ä¸å¥(æ±å³æ³¨ï¼å«ç½å«æ)</h2>
<p>å¦æè¿ç¯æç« å¯¹æ¨ææå¸®å©ï¼æèææå¯åçè¯ï¼å¸®å¿å³æ³¨ä¸ä¸æçååå¬ä¼å·ï¼èä¸è¯´ææ¯ï¼æ¨çæ¯ææ¯æåæåä½æå¤§çå¨åã</p>
<p>æ±ä¸é®ä¸è¿ï¼ç¹èµãè½¬åãå¨çã</p>
<p>å³æ³¨å¬ä¼å·ï¼ãèä¸è¯´ææ¯ãï¼å¨å¬ä¼å·ä¸­åå¤ï¼è¿å¤§åï¼å¯ä»¥åè´¹è·åææè¿æ´çç10ä¸å­çé¢è¯å®å¸ï¼å¥½å¤å°ä¼ä¼´é è¿ä¸ªå®å¸æ¿å°äºå¤å®¶å¤§åçofferã</p>
<p>æ´å¤é¡¹ç®å®æå¨æçææ¯ç½ç«ï¼<a href="http://www.susan.net.cn/project" target="_blank" rel="noopener nofollow">http://www.susan.net.cn/project</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2025-12-30 11:18">2025-12-30 11:18</span>&nbsp;
<a href="https://www.cnblogs.com/12lisu">èä¸è¯´ææ¯</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19420241);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19420241', targetLink: 'https://www.cnblogs.com/12lisu/p/19420241', title: 'ä¸ºä»ä¹å¤§åä¸è¬ä¸æ¨èä½¿ç¨@Transactionalï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>