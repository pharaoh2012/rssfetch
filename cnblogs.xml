<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-14T20:21:28.948Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ åä¸æ¬¾å½äº§å¼æºä¼ä¸çº§æä»¶ç®¡çç³»ç»è¯çäºï¼åºäº Spring Boot 3.5.x + Sa-Token + MyBatis Flex ]]></title>
    <link>https://www.cnblogs.com/javaguide/p/19616059</link>
    <guid>575302cf458aa554153bccb4dd05d3df</guid>
    <description>
    <![CDATA[ 
        <h2>
            <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/javaguide/p/19616059" title="åå¸äº 2026-02-14 15:52">
    <span role="heading" aria-level="2">åä¸æ¬¾å½äº§å¼æºä¼ä¸çº§æä»¶ç®¡çç³»ç»è¯çäºï¼åºäº Spring Boot 3.5.x + Sa-Token + MyBatis Flex</span>
    

</a>

        </h2>
        <div class="postbody">
            <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>åå å¤©å¨ææ¯ç¾¤éçå°å¤§å®¶è®¨è®ºä¼ä¸ç½çéåãä»è´¹çå¤ªè´µï¼å¼æºçåè½ä¸å¤å®æ´ï¼é¨ç½²ç»´æ¤åéº»ç¦ââè¿äºé®é¢å¾å¤å¢éé½éå°è¿ãæ³è¦ä¸ä¸ªè½å¤çå¤§æä»¶ãæ¯æå¨çº¿é¢è§ãè¿è½å¤äºå­å¨çæ¹æ¡ï¼ç¡®å®ä¸å®¹ææ¾ã</p>
<p>Dromara å¼æºç¤¾åºåæ®µæ¶é´æ°è¿äºä¸ä¸ªåºäº Spring Boot çæä»¶ç®¡çç³»ç» ââ Free-FSï¼æç ç©¶äºä¸ä¸ï¼åè½æ¯è¾å®æ´ï¼æ¶æä¹æ¸æ°ï¼åäº«ç»å¤§å®¶ï¼JavaGuide ææå¼æºé¡¹ç®åäº«é½æ åå¡æ§è´¨ï¼çº¯åäº«ï¼æ¬¢è¿èªèï¼å°åï¼ <a href="https://github.com/CodingDocs/awesome-java%EF%BC%89%E3%80%82" target="_blank" rel="noopener nofollow">https://github.com/CodingDocs/awesome-javaï¼ã</a></p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200920-1716388728.webp" alt="å¾ç" loading="lazy"></p>
<h2 id="free-fs-æ¯ä»ä¹"><strong>Free-FS æ¯ä»ä¹ï¼</strong></h2>
<p>Free-FS æ¯ä¸ä¸ªä¼ä¸çº§æä»¶ç®¡çç³»ç»åç«¯ï¼åºäº Spring Boot 3.5 + MyBatis Flex + Sa-Token + React/Vue æå»ºã</p>
<p>ä¸»è¦åè½åæ¬å¤§æä»¶åçä¸ä¼ /æ­ç¹ç»­ä¼ /ç§ä¼ ãå¤æ ¼å¼å¨çº¿é¢è§ãå¤äºå­å¨æä»¶åæ©å±ãæéæ§å¶ãåæ¶ç«ç­ãæéå¥ç Vue 3 åç«¯ã</p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200958-1718842586.webp" alt="" loading="lazy"></p>
<p>è¿éç»ä¸æçæåç®åè§£éä¸ä¸é¢æå°çå ä¸ªå³é®æ¯è¯­ï¼</p>
<table>
<thead>
<tr>
<th style="text-align: left">æ¯è¯­</th>
<th style="text-align: left">å«ä¹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>åçä¸ä¼ </strong></td>
<td style="text-align: left">æå¤§æä»¶åæå¤ä¸ªå°ååå«ä¸ä¼ ï¼ç½ç»ä¸­æ­ååªéä¸ä¼ æªå®æçåç</td>
</tr>
<tr>
<td style="text-align: left"><strong>æ­ç¹ç»­ä¼ </strong></td>
<td style="text-align: left">è®°å½ä¸ä¼ è¿åº¦ï¼ä¸­æ­åä»æ­ç¹ç»§ç»­ï¼ä¸ç¨éæ°ä¸ä¼ æ´ä¸ªæä»¶</td>
</tr>
<tr>
<td style="text-align: left"><strong>ç§ä¼ </strong></td>
<td style="text-align: left">éè¿è®¡ç®æä»¶åå¸å¼ï¼å¦ MD5ãSHA-256ï¼ï¼å¦ææå¡å¨å·²æç¸ååå¸çæä»¶ï¼ç´æ¥å»ºç«å¼ç¨èä¸ä¸ä¼ å®éæ°æ®</td>
</tr>
</tbody>
</table>
<h2 id="å®è§£å³äºä»ä¹é®é¢"><strong>å®è§£å³äºä»ä¹é®é¢ï¼</strong></h2>
<p>ä¼ä¸æä»¶ç®¡çå¸¸è§çå ä¸ªéº»ç¦ï¼</p>
<ul>
<li><strong>å¤§æä»¶ä¸ä¼ å°é¾</strong>ï¼æ²¡æåçä¸ä¼ ãæ­ç¹ç»­ä¼ ï¼ç½ç»ä¸ä¸­æ­å°±å¾éæ°å¼å§</li>
<li><strong>å­å¨å¹³å°ç»å®</strong>ï¼ç»æ­»åä¸äºå­å¨ï¼åæ¢ææ¬é«ï¼è¿ç§»å°é¾</li>
<li><strong>é¢è§è½åå¼±</strong>ï¼åªæ¯æå°æ°æ ¼å¼ï¼Office/å¾ç/PDF é¢è§è¦é¢å¤éç½®</li>
<li><strong>æéç®¡çç²ç³</strong>ï¼ç¼ºå°ç»ç²åº¦æéæ§å¶ï¼æ æ³æ»¡è¶³ä¼ä¸å®å¨è¦æ±</li>
<li><strong>é¨ç½²å¤æ</strong>ï¼ä¾èµå¤ãéç½®ç¹çï¼å¼ç®±å³ç¨å°é¾</li>
</ul>
<p>Free-FS ç¨ä¸»æµææ¯æ åäºä¸ä¸ªåè½å®æ´ãæ¶ææ¸æ°ãå¯æ©å±çæä»¶ç®¡çåç«¯ã</p>
<h2 id="æ ¸å¿åè½"><strong>æ ¸å¿åè½</strong></h2>
<h3 id="æä»¶ç®¡ç"><strong>æä»¶ç®¡ç</strong></h3>
<p>æ¯æåè¡¨åç½æ ¼ä¸¤ç§è§å¾ã</p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200928-973813390.webp" alt="å¾ç" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200936-1846826600.webp" alt="" loading="lazy"></p>
<h3 id="å¤§æä»¶ä¸ä¼ ä¸ç§ä¼ "><strong>å¤§æä»¶ä¸ä¼ ä¸ç§ä¼ </strong></h3>
<p>åç«¯æå¤§æä»¶åçå¹¶è¡ä¸ä¼ ï¼åç«¯éè¿ SSE å®æ¶æ¨è¿åº¦ï¼ç²¾ç¡®å°æ¯ä¸ªåççç¶æãç½ç»ä¸­æ­åï¼ç³»ç»è®°å½æ­ç¹ä½ç½®ï¼ç»­ä¼ æ¶ä»æ­ç¹ç»§ç»­ã</p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200939-1166332110.webp" alt="" loading="lazy"></p>
<p>ç§ä¼ çåçæ¯åç®æä»¶ MD5 åç»æå¡ç«¯ï¼æå¡å¨æç¸ååå¸çæä»¶å°±ç´æ¥å»ºç«å¼ç¨ï¼è·³è¿æ°æ®ä¼ è¾ãæä»¥ä¸ä¼ å ä¸ª G çæä»¶ææ¶è½"ç§å®"ã</p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200907-1394867558.webp" alt="" loading="lazy"></p>
<h3 id="å¤äºå­å¨æä»¶å"><strong>å¤äºå­å¨æä»¶å</strong></h3>
<p>å­å¨å±ç¨ SPI æä»¶åè®¾è®¡ï¼æå­å¨è½åæ½è±¡æç»ä¸æ¥å£ã</p>
<p>åç½®çå­å¨å®ç°ææ¬å°å­å¨ãé¿éäº OSSãä¸çäº KodoãAWS S3 å¼å®¹å­å¨ãRustFSã</p>
<p>ä¸å¥ç³»ç»å¯ä»¥ç®¡çå¤ä¸ªå­å¨å¹³å°ï¼æéåéæä¸é®åæ¢ãæ°å¢å­å¨å¹³å°åªè¦å®ç°æ ¸å¿æ¥å£å¹¶æ³¨åï¼ä¸ç¨æ¹ä¸»ä¸å¡ä»£ç ã</p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200904-1719820535.webp" alt="" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200945-674949107.webp" alt="" loading="lazy"></p>
<p>æ·»å å­å¨éç½®</p>
<h3 id="å¨çº¿é¢è§"><strong>å¨çº¿é¢è§</strong></h3>
<p>æ¯æäºå¤§ç±»æä»¶é¢è§ï¼</p>
<table>
<thead>
<tr>
<th style="text-align: left">ç±»å</th>
<th style="text-align: left">æ¯ææ ¼å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">å¾ç</td>
<td style="text-align: left">jpg/png/gif/webp/svg ç­</td>
</tr>
<tr>
<td style="text-align: left">Office ææ¡£</td>
<td style="text-align: left">doc/docx/xls/xlsx/ppt/pptxï¼éè¦ LibreOfficeï¼</td>
</tr>
<tr>
<td style="text-align: left">ææ¬ä»£ç </td>
<td style="text-align: left">30+ ç§ç¼ç¨è¯­è¨è¯­æ³é«äº®</td>
</tr>
<tr>
<td style="text-align: left">é³è§é¢</td>
<td style="text-align: left">æµå¼æ­æ¾</td>
</tr>
<tr>
<td style="text-align: left">åç¼©å</td>
<td style="text-align: left">æ¥çç®å½ç»æ</td>
</tr>
</tbody>
</table>
<p>Office ææ¡£éè¿ LibreOffice è½¬æ PDF åäº¤ç»åç«¯ï¼è½¬æ¢ç¨è¿ç¨æ± æ¨¡å¼ï¼å¯ä»¥éç½®å¹¶ååº¦åè¶æ¶ã</p>
<h3 id="æéä¸å®å¨"><strong>æéä¸å®å¨</strong></h3>
<p>ç¨ Sa-Token åæéè®¤è¯ï¼JWT æ ç¶æä¼è¯ï¼æ¯æåå¸å¼é¨ç½²ã</p>
<p>æéå¯ä»¥æ§å¶å°æä»¶çæ¥çãä¸è½½ãç¼è¾ãå é¤ç­æä½ã</p>
<h3 id="æä»¶åäº«ååæ¶ç«"><strong>æä»¶åäº«ååæ¶ç«</strong></h3>
<p>æä»¶åäº«æå¬å¼é¾æ¥åææç ä¸¤ç§æ¨¡å¼ï¼ææç åäº«è½è®¾ç½®æææåè®¿é®æ¬¡æ°ã</p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200953-1235074064.webp" alt="" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200890-1175658548.webp" alt="" loading="lazy"></p>
<p>åæ¶ç«ç»å é¤æä½ä¸ä¸ªç¼å²åºï¼æ¯ææ¹éè¿åãæ°¸ä¹å é¤åèªå¨æ¸çã</p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200924-1191218721.webp" alt="" loading="lazy"></p>
<p>åæ¶ç«</p>
<h2 id="å®è£ä¸å¿«éä¸æ"><strong>å®è£ä¸å¿«éä¸æ</strong></h2>
<h3 id="ç¯å¢è¦æ±"><strong>ç¯å¢è¦æ±</strong></h3>
<ul>
<li>JDK 17+</li>
<li>Maven 3.8+</li>
<li>MySQL 8.0+ æ PostgreSQL 14+ï¼äºéä¸ï¼</li>
<li>Redis</li>
<li>LibreOffice (å¯éï¼ç¨äº Office ææ¡£é¢è§åè½)</li>
</ul>
<h3 id="å®è£æ­¥éª¤"><strong>å®è£æ­¥éª¤</strong></h3>
<pre><code>git clone https://gitee.com/dromara/free-fs.git
cd free-fs
mvn clean install -DskipTests
</code></pre>
<h3 id="æ°æ®åºåå§å"><strong>æ°æ®åºåå§å</strong></h3>
<p>MySQLï¼</p>
<pre><code>CREATE DATABASE `free-fs` CHARACTER SET 'utf8mb4' COLLATE 'utf8mb4_general_ci';
</code></pre>
<p>PostgreSQLï¼</p>
<pre><code>CREATE DATABASE free-fs ENCODING 'UTF8' LC_COLLATE='zh_CN.UTF-8' LC_CTYPE='zh_CN.UTF-8';
</code></pre>
<p>æ°æ®åºåå»ºå®æä¹åï¼å¯¼å¥é¡¹ç®æ ¹ç®å½ä¸å¯¹åºç SQL æä»¶å°ååå»ºçæ°æ®åºä¸­ï¼</p>
<ul>
<li>MySQL: <code>_sql/mysql/free-fs.sql</code></li>
<li>PostgreSQL: <code>_sql/postgresql/free-fs_pg.sql</code></li>
</ul>
<h3 id="éç½®ä¸è¿è¡"><strong>éç½®ä¸è¿è¡</strong></h3>
<p>ä¿®æ¹ <code>fs-admin/src/main/resources/application-dev.yml</code> ä¸­çæ°æ®åºå Redis éç½®ï¼</p>
<pre><code>cd fs-admin
mvn spring-boot:run
</code></pre>
<p>è®¿é®å°åï¼</p>
<ul>
<li>æå¡å°åï¼<a href="http://localhost:8080" target="_blank" rel="noopener nofollow">http://localhost:8080</a></li>
<li>API ææ¡£ï¼<a href="http://localhost:8080/swagger-ui.html" target="_blank" rel="noopener nofollow">http://localhost:8080/swagger-ui.html</a></li>
<li>é»è®¤è´¦å·ï¼admin / admin</li>
</ul>
<p><a href="https://javaguide.cn/zhuanlan/interview-guide.html" target="_blank" rel="noopener nofollow">ãSpringAI æºè½é¢è¯å¹³å°+RAG ç¥è¯åºã</a>éå¥å®æé¡¹ç®æç¨æ­£å¨æ´æ°ï¼æ¶åå° Prompt Engineeringãå¤§æ¨¡åéæãRAGï¼æ£ç´¢å¢å¼ºçæï¼ãé«æ§è½å¯¹è±¡å­å¨ä¸åéæ°æ®åºãåç»­çè¯ï¼è¿ä¼åæ­¥ä¸Agent é¡¹ç®ã</p>
<p>åå®¹éå¸¸å¨é¢ï¼éå¸¸éåæ³è¦å®æ AI é¡¹ç®æèåå¤ AI å¤§æ¨¡ååºç¨å¼åå²ä½é¢è¯çæåï¼æ¥ä¸å¼ ååå®ç<strong>3.4w å­+35 éé¢ç®</strong>ç RAG é¢è¯é¢æ»ç»ï¼å¤§å®¶æåä¸ä¸ï¼ç¹æ­¤é¾æ¥äºè§£ï¼ <a href="https://javaguide.cn/about-the-author/zhishixingqiu-two-years.html" target="_blank" rel="noopener nofollow">æç</a>ï¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200946-1262024442.webp" alt="" loading="lazy"></p>
<h2 id="ææ¯æ¶æ"><strong>ææ¯æ¶æ</strong></h2>
<h3 id="ææ¯æ éå"><strong>ææ¯æ éå</strong></h3>
<p>åç«¯ç¨ Spring Boot 3.5.4ï¼æ­é MyBatis Flex å ORM å±ã</p>
<p>MyBatis Flex æ¯ MyBatis çå¢å¼ºçï¼å MyBatis-Plus æäºå·®å¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200941-432078960.webp" alt="" loading="lazy"></p>
<p>MyBatis Flex çè¯¦ç»ä»ç»å¯ä»¥åèè¿ç¯æç« ï¼<a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247549675&amp;idx=1&amp;sn=d74db8ecc003815d890de5aef0baef86&amp;scene=21#wechat_redirect" target="_blank" rel="noopener nofollow">åè§ MyBatisï¼è¿æ¬¾ ORM æ¡æ¶ç¡®å®å¤ªä¼éï¼ï¼</a></p>
<p>è®¤è¯ææç¨ Sa-Tokenï¼æ¯ Spring Security ç®æ´ãæ°æ®åºæ¯æ MySQL 8.0+ å PostgreSQL 14+ï¼HikariCP è¿æ¥æ± ï¼éå Caffeine æ¬å°ç¼å­å Redis åå¸å¼ç¼å­ã</p>
<h3 id="é¡¹ç®ç»æ"><strong>é¡¹ç®ç»æ</strong></h3>
<p>å¤æ¨¡å Maven ç»æï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/1843652/202602/1843652-20260214155200922-414133016.webp" alt="" loading="lazy"></p>
<p>å­å¨æä»¶ç¨ SPI è®¾è®¡ï¼<code>storage-plugin-core</code> å®ä¹æ¥å£ï¼åå­å¨å®ç°æ·»å æ°æä»¶æ¨¡åå°±è¡ã</p>
<h2 id="ä¸å¶ä»æ¹æ¡å¯¹æ¯"><strong>ä¸å¶ä»æ¹æ¡å¯¹æ¯</strong></h2>
<table>
<thead>
<tr>
<th style="text-align: left">å¯¹æ¯ç»´åº¦</th>
<th style="text-align: left">Free-FS</th>
<th style="text-align: left">MinIO</th>
<th style="text-align: left">Nextcloud</th>
<th style="text-align: left">Seafile</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">ææ¯æ </td>
<td style="text-align: left">Spring Boot 3.x</td>
<td style="text-align: left">Go</td>
<td style="text-align: left">PHP</td>
<td style="text-align: left">Go/C</td>
</tr>
<tr>
<td style="text-align: left">å®ä½</td>
<td style="text-align: left">åç«¯æå¡</td>
<td style="text-align: left">å¯¹è±¡å­å¨</td>
<td style="text-align: left">å®æ´ç½ç</td>
<td style="text-align: left">å®æ´ç½ç</td>
</tr>
<tr>
<td style="text-align: left">å¤§æä»¶ä¸ä¼ </td>
<td style="text-align: left">åç/æ­ç¹ç»­ä¼ /ç§ä¼ </td>
<td style="text-align: left">éèªè¡å®ç°</td>
<td style="text-align: left">æ¯æ</td>
<td style="text-align: left">æ¯æ</td>
</tr>
<tr>
<td style="text-align: left">å¨çº¿é¢è§</td>
<td style="text-align: left">å¤æ ¼å¼æ¯æ</td>
<td style="text-align: left">éèªè¡å®ç°</td>
<td style="text-align: left">æ¯æ</td>
<td style="text-align: left">æ¯æ</td>
</tr>
<tr>
<td style="text-align: left">å¤äºå­å¨</td>
<td style="text-align: left">æä»¶ååæ¢</td>
<td style="text-align: left">åä¸</td>
<td style="text-align: left">æ¯æ</td>
<td style="text-align: left">æ¯æ</td>
</tr>
<tr>
<td style="text-align: left">æéç®¡ç</td>
<td style="text-align: left">Sa-Token ç»ç²åº¦</td>
<td style="text-align: left">ç®å</td>
<td style="text-align: left">ç»ç²åº¦</td>
<td style="text-align: left">ç»ç²åº¦</td>
</tr>
<tr>
<td style="text-align: left">é¨ç½²é¾åº¦</td>
<td style="text-align: left">ä¸­ï¼éæ°æ®åºï¼</td>
<td style="text-align: left">ä½</td>
<td style="text-align: left">ä¸­</td>
<td style="text-align: left">ä¸­</td>
</tr>
<tr>
<td style="text-align: left">å¼æºåè®®</td>
<td style="text-align: left">Apache 2.0</td>
<td style="text-align: left">AGPL v3</td>
<td style="text-align: left">AGPL v3</td>
<td style="text-align: left">GPL-3.0</td>
</tr>
</tbody>
</table>
<p>åªåå¯¹è±¡å­å¨çè¯ MinIO æ´åéï¼éè¦å®æ´ç½ç UI ååä½åè½çè¯ Nextcloud æ Seafile æ´å¥½ï¼éè¦ä¸ä¸ªå¯å®å¶ãæéæçæä»¶ç®¡çåç«¯ï¼Free-FS å¯ä»¥èèã</p>
<h2 id="æ»ç»"><strong>æ»ç»</strong></h2>
<p>Free-FS ç¨ Spring Boot 3.x + MyBatis Flex + Sa-Token åäºä¸ä¸ªåè½å®æ´çä¼ä¸çº§æä»¶ç®¡çåç«¯ã</p>
<ul>
<li><strong>ä¼å¿</strong>ï¼åè½å®æ´ï¼å¼ç®±å³ç¨ï¼å¤§æä»¶ä¸ä¼ ï¼åç/æ­ç¹ç»­ä¼ /ç§ä¼ ï¼ï¼æä»¶åå­å¨æ©å±ï¼å¤æ ¼å¼å¨çº¿é¢è§ï¼Sa-Token æéç®¡çï¼Apache 2.0 åè®®åå¥½ã</li>
<li><strong>å±é</strong>ï¼éè¦é¨ç½²æ°æ®åºï¼MySQL/PostgreSQL + Redisï¼ï¼Office é¢è§è¦éç½® LibreOfficeã</li>
<li><strong>éç¨åºæ¯</strong>ï¼æ­å»ºä¼ä¸çº§æä»¶ç®¡çç³»ç»ãéè¦å¤äºå­å¨æ¯æãéè¦å¤§æä»¶ä¸ä¼ è½åã</li>
</ul>
<p>å»ºè®®åé¨ç½²åºç¡çæ¬è·éä¸ä¼ ä¸è½½æµç¨ï¼åæéè¦æ¥å¥äºå­å¨åéç½®é¢è§ã</p>
<ul>
<li>åç«¯å°åï¼<strong><a href="https://gitee.com/dromara/free-fs" target="_blank" rel="noopener nofollow">https://gitee.com/dromara/free-fs</a></strong></li>
<li>åç«¯å°åï¼<strong><a href="https://gitee.com/xddcode/free-fs-frontend" target="_blank" rel="noopener nofollow">https://gitee.com/xddcode/free-fs-frontend</a></strong></li>
</ul>
<p><strong>â­ï¸æ¨è</strong>:</p>
<ul>
<li><a href="https://javaguide.cn/home.html" target="_blank" rel="noopener nofollow">Java é¢è¯ &amp; åç«¯éç¨é¢è¯æå</a></li>
<li><a href="https://javaguide.cn/zhuanlan/interview-guide.html" target="_blank" rel="noopener nofollow">ãSpringAI æºè½é¢è¯å¹³å°+RAG ç¥è¯åºã</a></li>
<li><a href="https://javaguide.cn/interview-preparation/java-roadmap.html" target="_blank" rel="noopener nofollow">Java å­¦ä¹ è·¯çº¿(ææ°çï¼4w+å­)</a></li>
<li><a href="https://javaguide.cn/interview-preparation/pdf-interview-javaguide.html" target="_blank" rel="noopener nofollow">åç«¯é¢è¯ PDF ææ°ç</a></li>
</ul>


</div>
<div class="clear"></div>

        </div>
        <p class="postfoot">
            posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-14 15:52">2026-02-14 15:52</span>&nbsp;
<a href="https://www.cnblogs.com/javaguide">JavaGuide</a>&nbsp;
éè¯»(<span id="post_view_count">148</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19616059);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19616059', targetLink: 'https://www.cnblogs.com/javaguide/p/19616059', title: 'åä¸æ¬¾å½äº§å¼æºä¼ä¸çº§æä»¶ç®¡çç³»ç»è¯çäºï¼åºäº Spring Boot 3.5.x + Sa-Token + MyBatis Flex' })">ä¸¾æ¥</a>

        </p>
     ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ OneTransï¼å¨å·¥ä¸çº§æ¨èç³»ç»ä¸­ä»¥åä¸ Transformer å®ç°ç¹å¾äº¤äºä¸åºåå»ºæ¨¡çç»ä¸æ¡æ¶ ]]></title>
    <link>https://www.cnblogs.com/GlenTt/p/19614879</link>
    <guid>107db6706d49e6bd7a6290d216f3059e</guid>
    <description>
    <![CDATA[ 
		<h2>
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/GlenTt/p/19614879" title="åå¸äº 2026-02-14 11:31">
    <span role="heading" aria-level="2">OneTransï¼å¨å·¥ä¸çº§æ¨èç³»ç»ä¸­ä»¥åä¸ Transformer å®ç°ç¹å¾äº¤äºä¸åºåå»ºæ¨¡çç»ä¸æ¡æ¶</span>
    

</a>

		</h2>
		<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="onetranså¨å·¥ä¸çº§æ¨èç³»ç»ä¸­ä»¥åä¸-transformer-å®ç°ç¹å¾äº¤äºä¸åºåå»ºæ¨¡çç»ä¸æ¡æ¶">OneTransï¼å¨å·¥ä¸çº§æ¨èç³»ç»ä¸­ä»¥åä¸ Transformer å®ç°ç¹å¾äº¤äºä¸åºåå»ºæ¨¡çç»ä¸æ¡æ¶</h1>
<h2 id="æè¦">æè¦</h2>
<p>å¨æ¨èç³»ç»ä¸­ï¼æ©å±ç¹å¾äº¤äºæ¨¡åï¼ä¾å¦ WukongãRankMixerï¼æç¨æ·è¡ä¸ºåºåæ¨¡åï¼ä¾å¦ LONGERï¼å·²ç»åå¾äºæ¾èææãç¶èï¼è¿ä¸¤ç±»å·¥ä½éå¸¸æ²¿çå½¼æ­¤ç¬ç«çè·¯å¾æ¨è¿ï¼è¿ä¸ä»é»ç¢äºååä¿¡æ¯äº¤äºï¼ä¹éå¶äºç»ä¸ä¼åä¸ç»ä¸æ©å±è½åã</p>
<p>æ¬ææåº OneTransï¼ä¸ç§ç»ä¸ç Transformer ä¸»å¹²ç½ç»ï¼å¯åæ¶å®æç¨æ·è¡ä¸ºåºåå»ºæ¨¡ä¸ç¹å¾äº¤äºãOneTrans éç¨ç»ä¸ç tokenizerï¼å°åºåå±æ§ä¸éåºåå±æ§å±åè½¬æ¢ä¸ºåä¸ç token åºåãå å ç OneTrans æ¨¡åå¯¹ç¸ä¼¼çåºå token å±äº«åæ°ï¼èå¯¹éåºå token åéç¹å®åæ°ãéè¿å ææ³¨æåæºå¶ä¸è·¨è¯·æ±ç KV ç¼å­æºå¶ï¼OneTrans æ¯æä¸­é´è¡¨ç¤ºçé¢è®¡ç®ä¸ç¼å­ï¼å¨è®­ç»ä¸æ¨çé¶æ®µåæ¾èéä½è®¡ç®ææ¬ã</p>
<p>å¨å·¥ä¸çº§è§æ¨¡æ°æ®éä¸çå®éªç»æè¡¨æï¼OneTrans éåæ°è§æ¨¡æ©å±å·æè¯å¥½çå¯æ©å±æ§ï¼ç¨³å®ä¼äºå¤ä¸ªå¼ºåºçº¿æ¨¡åï¼å¹¶å¨çå®å¨çº¿ A/B å®éªä¸­å®ç°äºç¨æ·çº§ GMV æå 5.68%ã</p>
<h2 id="1-å¼è¨">1 å¼è¨</h2>
<p>æ¨èç³»ç»å¨åç±»ä¿¡æ¯æå¡ä¸­åæ¥çåºç¡æ§ä½ç¨ï¼ä¾å¦çµåãæµåªä½åç¤¾äº¤ç½ç»ãå·¥ä¸çº§æ¨èç³»ç»éå¸¸éç¨çº§èå¼æåºæ¶æãé¦åï¼å¨å¬åé¶æ®µä»åäº¿è§æ¨¡çåéåºä¸­éåºæ°ç¾ä¸ªåéé¡¹ï¼éåï¼å¨æåºé¶æ®µå¯¹æ¯ä¸ªåéè¿è¡æåå¹¶è¿å Top-k ç»æãæ·±åº¦å­¦ä¹ æ¨èæ¨¡åï¼DLRMï¼å·²å¹¿æ³åºç¨äºå·¥ä¸æ¨èç³»ç»çæåºé¶æ®µã</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3670197/202602/3670197-20260214112850770-44878667.png" class="lazyload"></p>
<p>æ¬æèç¦æåºé¶æ®µï¼éµå¾ª DLRM é£æ ¼çæåºèå¼ãå½åä¸»æµæ¹æ³éå¸¸å´ç»ä¸¤ä¸ªç¸äºç¬ç«çæ¨¡åè¿è¡è¿­ä»£ä¼åï¼ï¼aï¼åºåå»ºæ¨¡æ¨¡åï¼å°ç¨æ·å¤è¡ä¸ºåºåç¼ç ä¸ºä¸åéç¸å³çè¡¨ç¤ºï¼éå¸¸éç¨å±é¨æ³¨æåæ Transformer ç¼ç å¨ï¼ï¼bï¼ç¹å¾äº¤äºæ¨¡åï¼éè¿åè§£æ¹æ³ãæ¾å¼äº¤åç½ç»æåºäºç¹å¾ç»çæ³¨æåæºå¶ï¼å­¦ä¹ éåºåç¹å¾ï¼å¦ç¨æ·ç»åãç©åç»ååä¸ä¸æç¹å¾ï¼ä¹é´çé«é¶äº¤åå³ç³»ãå¦å¾ 1(a) æç¤ºï¼è¿ç±»æ¹æ³éå¸¸åå°ç¨æ·è¡ä¸ºç¼ç ä¸ºåç¼©çåºåè¡¨ç¤ºï¼ç¶åä¸éåºåç¹å¾æ¼æ¥ï¼åéè¿ç¹å¾äº¤äºæ¨¡åå­¦ä¹ é«é¶äº¤äºãæ¬æå°è¿ä¸è®¾è®¡ç§°ä¸ºâåç¼ç åäº¤äºâï¼encode-then-interactionï¼æµç¨ã</p>
<p>å¤§è¯­è¨æ¨¡åï¼LLMï¼çæåè¡¨æï¼æ©å¤§æ¨¡åè§æ¨¡ï¼å¦åæ°è§æ¨¡åè®­ç»æ°æ®è§æ¨¡ï¼å¯ä»¥å¸¦æ¥å¯é¢æµçæ§è½æåãè¿ä¸ç°è±¡ä¹å¯åäºæ¨èç³»ç»ä¸­çç¸å³ç ç©¶ãå¨ç¹å¾äº¤äºæ¹é¢ï¼Wukong éè¿å å å å­åè§£æºæ¨¡åå¹¶ç»åçº¿æ§åç¼©æ¥å»ºæ¨¡é«é¶ç¹å¾äº¤äºï¼å¹¶å»ºç«äºæ©å±è§å¾ï¼RankMixer éè¿ç¡¬ä»¶åå¥½ç token æ··åæºå¶ä»¥å token ç¹å®çåé¦ç½ç»ï¼FFNï¼å®ç°äºè¯å¥½çè§æ¨¡æ©å±è½åãå¨åºåå»ºæ¨¡æ¹é¢ï¼LONGER éç¨å æ Transformer å»ºæ¨¡é¿ç¨æ·è¡ä¸ºåå²ï¼å¹¶è¯æéçæ·±åº¦åå®½åº¦çå¢å ï¼æ§è½ååè°æåè¶å¿ã</p>
<p>å°½ç®¡ä¸è¿°æ¹æ³å¨å®è·µä¸­ææï¼ä½å°åºåå»ºæ¨¡ä¸ç¹å¾äº¤äºä½ä¸ºç¬ç«æ¨¡åä¼å¸¦æ¥ä¸¤ä¸ªä¸»è¦å±éãç¬¬ä¸ï¼âåç¼ç åäº¤äºâçæµç¨éå¶äºååä¿¡æ¯æµï¼ä½¿éææä¸ä¸æç¹å¾é¾ä»¥ååå½±ååºåè¡¨ç¤ºçå»ºæ¨¡ãç¬¬äºï¼æ¨¡ååç¦»å¯¼è´æ§è¡è¿ç¨å²è£å¹¶å¢å ç³»ç»å»¶è¿ï¼ç¸æ¯ä¹ä¸ï¼ç»ä¸ç Transformer ä¸»å¹²ç»æå¯ä»¥å¤ç¨ LLM çæçä¼åææ¯ï¼å¦ KV ç¼å­ãåå­é«ææ³¨æåæºå¶åæ··åç²¾åº¦è®­ç»ï¼ä»èå®ç°æ´é«æçè§æ¨¡æ©å±ã</p>
<p>ä¸ºæ­¤ï¼æ¬ææåº OneTransï¼ä¸ç§åæ°æ§çæ¶æèå¼ï¼éè¿ç»ä¸ç Transformer ä¸»å¹²ç½ç»åæ¶å®æç¨æ·è¡ä¸ºåºåå»ºæ¨¡ä¸ç¹å¾äº¤äºãå¦å¾ 1(b) æç¤ºï¼OneTrans å¨ç»ä¸ä¸»å¹²åé¨å®ç°äºååä¿¡æ¯äº¤äºãå¶æ ¸å¿å¨äºä¸ä¸ªç»ä¸ç tokenizerï¼å°åºåç¹å¾ï¼å¤æ ·åè¡ä¸ºåºåï¼åéåºåç¹å¾ï¼ç¨æ·ãç©ååä¸ä¸æéæç¹å¾ï¼å±åè½¬æ¢ä¸ºåä¸ç token åºåï¼ç¶åéå¥ç±å¤å±å å ç OneTrans æ¨¡åç»æçéå­å¡ç»æä¸­ãè¯¥ç»ææ¯éå¯¹å·¥ä¸æ¨èç³»ç»å®å¶ç Transformer åä½ã</p>
<p>èèå°æ¨èç³»ç»ä¸­ token æ¥æºå¤æ ·ãè¯­ä¹å¼æï¼ä¸åäº LLM ä¸­åä¸ææ¬ tokenï¼ï¼æ¯ä¸ª OneTrans æ¨¡åéç¨ç±»ä¼¼ HiFormer çæ··ååæ°åç­ç¥ãå·ä½èè¨ï¼æææ¥èªåºåç¹å¾ç token å±äº«åä¸ç» Q/K/V å FFN åæ°ï¼èæ¯ä¸ªéåºå token ååéç¬ç«çç¹å®åæ°ï¼ä»¥ä¿çå¶ç¬ç¹è¯­ä¹ã</p>
<p>ä¸åäºä¼ ç»çâåç¼ç åäº¤äºâæ¡æ¶ï¼OneTrans éè¿ç»ä¸çå æ Transformer ä¸»å¹²æ¶é¤äºåºåä¸éåºåç¹å¾ä¹é´çç»ææ§éç¦»ï¼ä½¿æ¨èç³»ç»çæ©å±æ¹å¼ä¸ LLM å®è·µä¿æä¸è´ï¼éè¿è°æ´ä¸»å¹²ç½ç»çæ·±åº¦åå®½åº¦å³å¯æ©å±æ´ä½æ¨¡åè§æ¨¡ï¼åæ¶å¯æ ç¼ç»§æ¿æçç LLM ä¼åææ¯ï¼å¦ FlashAttention åæ··åç²¾åº¦è®­ç»ãå°¤å¶æ¯è·¨åéä¸è·¨è¯·æ±ç KV ç¼å­æºå¶ï¼å¯å°åå« C ä¸ªåéçä¼è¯æ¶é´å¤æåº¦ä» ð(C) éè³ ð(1)ï¼ä»èä½¿å¤§è§æ¨¡ OneTrans é¨ç½²æä¸ºå¯è½ã</p>
<h3 id="ä¸»è¦è´¡ç®">ä¸»è¦è´¡ç®</h3>
<p>æ¬æçè´¡ç®å¯æ¦æ¬ä¸ºåç¹ï¼</p>
<ol>
<li>
<p><strong>ç»ä¸æ¡æ¶</strong>ï¼æåº OneTrans åä¸ Transformer ä¸»å¹²æåºæ¨¡åï¼éå¤ç»ä¸ tokenizerï¼å°åºåä¸éåºåç¹å¾ç¼ç ä¸ºç»ä¸ token åºåï¼å¹¶éè¿ç»ä¸ Transformer æ¨¡ååæ¶å®æåºåå»ºæ¨¡ä¸ç¹å¾äº¤äºã</p>
</li>
<li>
<p><strong>é¢åæ¨èç³»ç»çå®å¶è®¾è®¡</strong>ï¼ä¸ºå¼¥å LLM ä¸æ¨èä»»å¡ä¹é´çå·®è·ï¼æåºæ··ååæ°åæºå¶ï¼å¯¹å¤æ ·åçéåºå token åéç¹å®åæ°ï¼åæ¶å¯¹ææåºå token å±äº«åæ°ã</p>
</li>
<li>
<p><strong>é«æè®­ç»ä¸æ¨ç</strong>ï¼éè¿éå­å¡ç­ç¥éå±è£åªåºå tokenï¼å¹¶å¼å¥è·¨è¯·æ± KV ç¼å­å¤ç¨ç¨æ·ä¾§è®¡ç®ç»æãåæ¶éç¨ FlashAttentionãæ··åç²¾åº¦è®­ç»ååç²¾åº¦æ¨çç­ä¼åææ®µï¼éä½åå­ä¸è®¡ç®å¼éã</p>
</li>
<li>
<p><strong>è§æ¨¡æ©å±ä¸å¨çº¿é¨ç½²éªè¯</strong>ï¼OneTrans éæ¨¡åè§æ¨¡å¢å åç°è¿ä¼¼å¯¹æ°çº¿æ§æ§è½å¢é¿è¶å¿ï¼å¨çå®çäº§æ°æ®ä¸éªè¯äºè§æ¨¡è§å¾ï¼å¨çº¿é¨ç½²åï¼å¨ä¿æå·¥ä¸çº§å»¶è¿çåæä¸ï¼æ¾èæåå³é®ä¸å¡ææ ã</p>
</li>
</ol>
<h2 id="2-ç¸å³å·¥ä½">2 ç¸å³å·¥ä½</h2>
<p>æ©ææ¨èç³»ç»æ¨¡åï¼å¦ DIN åå¶é¢åä¼è¯çåä½ DSINï¼éç¨å±é¨æ³¨æåæºå¶å­¦ä¹ ä¸åéç©åæ¡ä»¶ç¸å³çç¨æ·åå²è¡ä¸ºæè¦ï¼ä½éå¸¸å°è¡ä¸ºåç¼©ä¸ºéå¯¹æ¯ä¸ªåéçåºå®é¿åº¦åéï¼ä»èéå¶äºé¿ç¨ä¾èµå³ç³»çå»ºæ¨¡è½åãèªæ³¨æåæ¹æ³ï¼å¦ SASRecãBERT4Rec å BSTï¼éè¿åè®¸åºåä¸­æ¯ä¸ªä½ç½®å³æ³¨å®æ´åå²ï¼æ¶é¤äºè¿ä¸ç¶é¢ï¼å¹¶éè¿ååæ©ç æºå¶æåäºæ ·æ¬å©ç¨æçã</p>
<p>è¿å¹´æ¥ï¼éçæ¨èç³»ç»ä¸­è§æ¨¡è§å¾ï¼scaling lawï¼ç ç©¶çæ¨è¿ï¼LONGER å°åºåå»ºæ¨¡æ©å±è³å·¥ä¸çº§è§æ¨¡ï¼éè¿é«ææ³¨æåæºå¶åé¢åæå¡çæ¶æè®¾è®¡ï¼æ¯æè¶é¿ç¨æ·è¡ä¸ºåºåå»ºæ¨¡ãç¶èï¼å¨ä¸»æµå·¥ä¸æµç¨ä¸­ï¼è¿äºåºåç¼ç å¨éå¸¸ä»ä¸ç¹å¾äº¤äºæ¨¡åç¸äºç¬ç«ï¼å¯¼è´ç¹å¾èååçå¨åæé¶æ®µï¼èéä¸éæä¸ä¸æç¹å¾è¿è¡èåä¼åã</p>
<p>å¨ç¹å¾äº¤äºæ¹åï¼æ©ææ¨èç³»ç»ä¾èµäººå·¥æé çäº¤åç¹å¾æèªå¨ä¹æ§äº¤äºå±ãç»å¸æ¨¡åå¦ Wide&amp;DeepãFM/DeepFM å DCN/DCNv2 æä¾äºé«æçä½é¶ææçé¶äº¤äºè½åãç¶èï¼è¿æçè§æ¨¡ç ç©¶åç°ï¼ä¸æ¦äº¤åå±å å å°ä¸å®ç¨åº¦ï¼ç»§ç»­å¢å å±æ°å¾å¾æ æ³å¸¦æ¥æ§è½æåï¼æ¨¡åææè¶äºå¹³å°æã</p>
<p>ä¸ºçªç ´é¢è®¾äº¤åå½¢å¼çåæ§éå¶ï¼åºäºæ³¨æåçæ¨¡åè½å¤èªå¨å­¦ä¹ é«é¶äº¤äºå³ç³»ãAutoInt å­¦ä¹ ä»»æé¶å³ç³»ï¼HiFormer éè¿ç»ç¹å®æå½±æ´å¥½å°å»ç»å¼æä¸éå¯¹ç§°çç¹å¾äº¤äºãéçè§æ¨¡åæ¹æ³éæ¸åºç¨äºç¹å¾äº¤äºæ¨¡åï¼å¤§è§æ¨¡ç³»ç»å¦ Wukong éè¿å å  FM é£æ ¼äº¤äºæ¨¡åå¹¶ç»åçº¿æ§åç¼©ï¼å®ç°äºå¯é¢æµçæ§è½å¢é¿ï¼RankMixer åå¨ä¸¥æ ¼å»¶è¿çº¦æä¸ï¼éè¿å¹¶è¡ token æ··ååç¨ç MoE å®ç°äºè¯å¥½çè§æ¨¡æ©å±è½åãç¶èï¼è¿ç±»äº¤äºæ¨¡åéå¸¸ä»éµå¾ªâäº¤äºåç½®âçèå¼ï¼å°äº¤äºéå¶å¨ç¬ç«é¶æ®µï¼é»ç¢äºä¸ç¨æ·åºåå»ºæ¨¡çç»ä¸ä¼åã</p>
<p>æ»ä½èè¨ï¼æ¨èç³»ç»çåå±é¿ææ²¿çä¸¤æ¡ç¸å¯¹ç¬ç«çè·¯å¾æ¨è¿ï¼åºåå»ºæ¨¡ä¸ç¹å¾äº¤äºãInterFormer éè¿åºäºæè¦çååäº¤åæ¶æå°è¯å¼¥åä¸¤èå·®è·ï¼å®ç°ä¿¡å·äºéï¼ä½ä»ä¿çä¸ºä¸¤ä¸ªç¬ç«æ¨¡åï¼å¶äº¤åç»æå¢å äºæ¶æå¤æåº¦åæ§è¡å²è£æ§ãå¨ç¼ºä¹ç»ä¸ä¸»å¹²è¿è¡èåå»ºæ¨¡ä¸æ´ä½ä¼åçæåµä¸ï¼å®ç°ç³»ç»çº§è§æ¨¡æ©å±ä»é¢ä¸´ææã</p>
<p>è¿æçæå¼æ¨èï¼Generative Recommendersï¼å°æ¨èä»»å¡å»ºæ¨¡ä¸ºåºåè½¬å¯¼é®é¢ï¼å¹¶æåºå¦ HSTU ç­é«æé¿ä¸ä¸æä¸»å¹²ç»æãè¿ä¸è·¯çº¿ä¸ä¾èµä¸°å¯éåºåç¹å¾ç DLRM ç³»ç»å½¢æäºè¡¥ã</p>
<h2 id="3-æ¹æ³">3 æ¹æ³</h2>
<p>å¨è¯¦ç»ä»ç»æ¹æ³ä¹åï¼é¦åè¯´æä»»å¡è®¾å®ã</p>
<p>å¨çº§èå¼å·¥ä¸æ¨èç³»ç»ä¸­ï¼æ¯å½å¬åé¶æ®µä¸ºç¨æ· ð¢ è¿åä¸ä¸ªåééåï¼éå¸¸ä¸ºæ°ç¾ä¸ªåéç©åï¼åï¼æåºæ¨¡åä¼ä¸ºæ¯ä¸ªåéç©å ð é¢æµä¸ä¸ªå¾åï¼</p>
<p></p><div class="math display">\[\hat{y}_{u,i} = f(i, NS, S; \Theta)
\]</div><p></p><p>å¶ä¸­ï¼NS è¡¨ç¤ºæ¥èªç¨æ·ãåéç©ååä¸ä¸æçéåºåç¹å¾éåï¼S è¡¨ç¤ºç¨æ·çåå²è¡ä¸ºåºåéåï¼Î ä¸ºå¯è®­ç»åæ°ãå¸¸è§çé¢æµä»»å¡åæ¬ç¹å»çï¼CTRï¼ä¸ç¹å»åè½¬åçï¼CVRï¼ï¼</p>
<p></p><div class="math display">\[CTR_{u,i} = P(click=1 \mid NS, S; \Theta)
\]</div><p></p><p></p><div class="math display">\[CVR_{u,i} = P(conv=1 \mid click=1, NS, S; \Theta)
\]</div><p></p><h3 id="31-onetrans-æ¡æ¶æ¦è¿°">3.1 OneTrans æ¡æ¶æ¦è¿°</h3>
<p><img alt="image-1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3670197/202602/3670197-20260214112929960-1601192000.png" class="lazyload"></p>
<p>å¦å¾ 2(a) æç¤ºï¼OneTrans éç¨ç»ä¸ tokenizerï¼å°åºåç¹å¾ S æ å°ä¸º S-tokensï¼å°éåºåç¹å¾ NS æ å°ä¸º NS-tokensãéåï¼ä¸ä¸ªéå­å¡å¼å å ç Transformer å¨åä¸è®¡ç®å¾ä¸­èåå¤çè¿ä¸ç»ä¸ token åºåãåå§ token åºåå®ä¹ä¸ºï¼</p>
<p></p><div class="math display">\[X^{(0)} = [S\text{-tokens}; NS\text{-tokens}] \in \mathbb{R}^{(L_S + L_{NS}) \times d}
\]</div><p></p><p>è¯¥åºåç± (L_S) ä¸ª S-tokens ä¸ (L_{NS}) ä¸ª NS-tokens æ¼æ¥èæï¼ææ token çç»´åº¦åä¸º (d)ãéè¦æ³¨æçæ¯ï¼å¨ S-tokens ä¸­æå¥äºå¯å­¦ä¹ ç [SEP] tokenï¼ç¨äºåºåä¸åç±»åçç¨æ·è¡ä¸ºåºåè¾¹çã</p>
<p>å¦å¾ 2(b) æç¤ºï¼æ¯ä¸ª OneTrans Block éè¿å¦ä¸æ¹å¼éå±æ´æ° token è¡¨ç¤ºï¼</p>
<p></p><div class="math display">\[Z^{(n)} = \text{MixedMHA}(\text{Norm}(X^{(n-1)})) + X^{(n-1)}
\]</div><p></p><p></p><div class="math display">\[X^{(n)} = \text{MixedFFN}(\text{Norm}(Z^{(n)})) + Z^{(n)}
\]</div><p></p><p>å¶ä¸­ï¼MixedMHAï¼æ··åå¤å¤´æ³¨æåï¼ä¸ MixedFFNï¼æ··ååé¦ç½ç»ï¼éç¨æ··ååæ°åç­ç¥ï¼è§å¾ 2(c)ï¼ï¼ææåºå token å±äº«åä¸ç» Q/K/V ä¸ FFN æéï¼èæ¯ä¸ªéåºå token å¨æ³¨æåå±ä¸åé¦å±ä¸­ååéç¬ç«çä¸å±åæ°ã</p>
<p>æ¨¡åéç¨ç»ä¸çå ææ©ç ï¼causal maskï¼ï¼æ½å èªåå½çº¦æï¼ä½¿æ¯ä¸ªä½ç½®åªè½å³æ³¨å¶ä¹åç tokenãå·ä½èè¨ï¼NS-tokens åè®¸è®¿é®å¨é¨ S-tokens çåå²ä¿¡æ¯ï¼ä»èå®ç°ååçè·¨ token äº¤äºã</p>
<p>éè¿å å å¤ä¸ªæ­¤ç±» Blockï¼å¹¶å¯¹ S-tokens æ½å éå­å¡å¼å°¾é¨è£åªï¼tail truncationï¼ï¼æ¨¡åéå±å°é«é¶ä¿¡æ¯åç¼©å¹¶è¸é¦è³ NS-tokens ä¸­ãæç»ç token è¡¨ç¤ºè¾å¥è³ä»»å¡ç¹å®çé¢æµå¤´å®æè¾åºã</p>
<h3 id="ç»ä¸å»ºæ¨¡å¸¦æ¥çç»æä¼å¿">ç»ä¸å»ºæ¨¡å¸¦æ¥çç»æä¼å¿</h3>
<p>éè¿å°åºåä¸éåºåç¹å¾ç»ä¸ä¸ºåä¸ token åºåï¼å¹¶ä½¿ç¨å æ Transformer è¿è¡å»ºæ¨¡ï¼OneTrans æå¼äºä¼ ç»âåç¼ç åäº¤äºâæµç¨ãè¿ç§ç»ä¸è®¾è®¡å¨åä¸ Transformer å å ä¸­èªç¶å®ç°äºï¼</p>
<ol>
<li>ååºååé¨çäº¤äºå»ºæ¨¡</li>
<li>å¤åºåä¹é´çäº¤äºå»ºæ¨¡</li>
<li>ç¨æ·ãç©åä¸ä¸ä¸æç­å¤æºç¹å¾ä¹é´çäº¤äº</li>
<li>åºåç¹å¾ä¸éåºåç¹å¾ä¹é´çäº¤äº</li>
</ol>
<p>ç»ä¸å»ºæ¨¡å½¢å¼ä½¿å¾æ¨¡åå¯ä»¥æ ç¼ç»§æ¿æççå¤§æ¨¡åå·¥ç¨ä¼åææ¯ï¼åæ¬ KV ç¼å­ä¸åå­é«ææ³¨æåæºå¶ï¼ä»èæ¾èéä½æ¨çå»¶è¿ãè¯¥ç»ä¸æ¡æ¶å¨åä¸å¯æ©å±æ¶æä¸å¤çå¤åºåä¸è·¨åæ¨èä»»å¡ï¼å·å¤è¯å¥½çæ©å±æ½åã</p>
<h3 id="32-ç¹å¾ä¸-token-å">3.2 ç¹å¾ä¸ Token å</h3>
<p>ä¸ºæå»ºåå§ token åºå (X^{(0)})ï¼OneTrans é¦åéè¿ç¹å¾é¢å¤çæµç¨ï¼å°ææåå§ç¹å¾æ å°ä¸º embedding åéãè¿äº embedding éåè¢«ååä¸ºä¸¤é¨åï¼ï¼iï¼å¤è¡ä¸ºåºåå­éï¼ï¼iiï¼è¡¨ç¤ºç¨æ·ãç©åæä¸ä¸æçéåºåç¹å¾å­éãéååå«å¯¹ä¸¤ç±»ç¹å¾åºç¨ä¸åç tokenizerã</p>
<h4 id="321-éåºåç¹å¾ç-token-å">3.2.1 éåºåç¹å¾ç Token å</h4>
<p>éåºåç¹å¾ NS åæ¬æ°å¼ç¹å¾ï¼å¦ä»·æ ¼ãCTRï¼åç±»å«ç¹å¾ï¼å¦ç¨æ· IDãç©åç±»ç®ï¼ãææç¹å¾åè¿è¡åæ¡¶æ one-hot ç¼ç ï¼åæ å°ä¸º embeddingã</p>
<p>ç±äºå·¥ä¸ç³»ç»éå¸¸åå«æ°ç¾ä¸ªç¹å¾ï¼ä¸éè¦æ§å·®å¼æ¾èï¼å æ­¤æ§å¶éåºå token æ°é (L_{NS}) æä¸¤ç§æ¹å¼ï¼</p>
<p><strong>ï¼1ï¼åç»å¼ Tokenizerï¼Group-wise Tokenizerï¼</strong><br>
ä¸ RankMixer å¯¹é½ï¼å°ç¹å¾æå¨ååä¸ºè¯­ä¹ç» ({g_1, ..., g_{L_{NS}}})ãæ¯ä¸ªç»åç¹å¾æ¼æ¥åéè¿ç¬ç«ç MLP æå½±ï¼</p>
<p></p><div class="math display">\[NS\text{-tokens} =
MLP_1(concat(g_1)), ..., MLP_{L_{NS}}(concat(g_{L_{NS}}))
\]</div><p></p><p><strong>ï¼2ï¼èªå¨åå Tokenizerï¼Auto-Split Tokenizerï¼</strong><br>
å°ææç¹å¾æ¼æ¥åï¼éè¿ä¸ä¸ªç»ä¸ MLP æå½±ï¼åè¿è¡ååï¼</p>
<p></p><div class="math display">\[NS\text{-tokens} = split(MLP(concat(NS)), L_{NS})
\]</div><p></p><p>Auto-Split æ¹å¼éè¿ä¸æ¬¡ç¨ å¯æå½±åå° kernel å¯å¨å¼éï¼ç¸è¾åç»å¼æ¹æ³æ´é«æãè®ºæå°å¨å®éªä¸­å¯¹ä¸¤ç§æ¹å¼è¿è¡å¯¹æ¯ã</p>
<p>æç»ï¼éåºå token åå¾å° (L_{NS}) ä¸ªéåºå tokenï¼æ¯ä¸ªç»´åº¦ä¸º (d)ã</p>
<h4 id="322-åºåç¹å¾ç-token-å">3.2.2 åºåç¹å¾ç Token å</h4>
<p>OneTrans æ¯æå¤è¡ä¸ºåºåè¾å¥ï¼</p>
<p></p><div class="math display">\[S = {S_1, ..., S_n}, \quad S_i = {e_{i1}, ..., e_{iL_i}}
\]</div><p></p><p>æ¯ä¸ªåºå (S_i) åå« (L_i) ä¸ªäºä»¶ embeddingãæ¯ä¸ªäºä»¶ embedding ç±ç©å ID åå¶éå ä¿¡æ¯ï¼å¦ç±»ç®ãä»·æ ¼ç­ï¼æ¼æ¥ææã</p>
<p>ç±äºä¸ååºåçåå§ç»´åº¦å¯è½ä¸åï¼å¯¹æ¯ä¸ªåºå (S_i) ä½¿ç¨å±äº«æå½±ç½ç» (MLP_i)ï¼å°ææäºä»¶æ å°è³ç»ä¸ç»´åº¦ (d)ï¼</p>
<p></p><div class="math display">\[\tilde{S}*i =
MLP_i(e*{i1}), ..., MLP_i(e_{iL_i})
\in \mathbb{R}^{L_i \times d}
\]</div><p></p><p>å¯¹é½åçåºå (\tilde{S}_i) å¯éè¿ä¸¤ç§è§ååå¹¶ä¸ºç»ä¸ token åºåï¼</p>
<ol>
<li><strong>æ¶é´æç¥ï¼Timestamp-awareï¼</strong>ï¼ææ¶é´é¡ºåºäº¤éææäºä»¶ï¼å¹¶æ·»å åºåç±»åæ è¯ã</li>
<li><strong>æ¶é´æ å³ï¼Timestamp-agnosticï¼</strong>ï¼æè¡ä¸ºå½±ååæåºæ¼æ¥ï¼ä¾å¦âè´­ä¹° â å è´­ â ç¹å»âï¼å¨åºåä¹é´æå¥å¯å­¦ä¹ ç [SEP] tokenãé«æå¾è¡ä¸ºæå¨åé¢ã</li>
</ol>
<p>æ¶èå®éªè¡¨æï¼å½æ¶é´æ³å¯ç¨æ¶ï¼æ¶é´æç¥æ¹å¼ä¼äºæè¡ä¸ºå½±åæåºçæ¹å¼ã</p>
<p>å½¢å¼åè¡¨ç¤ºä¸ºï¼</p>
<p></p><div class="math display">\[S\text{-tokens} = Merge(\tilde{S}_1, ..., \tilde{S}_n)
\in \mathbb{R}^{L_S \times d}
\]</div><p></p><p>å¶ä¸­</p>
<p></p><div class="math display">\[L_S = \sum_{i=1}^{n} L_i + L_{SEP}
\]</div><p></p><h3 id="33-onetrans-block">3.3 OneTrans Block</h3>
<p>å¦å¾ 2(b) æç¤ºï¼æ¯ä¸ª OneTrans Block æ¯ä¸ä¸ª pre-norm å æ Transformerï¼è¾å¥ä¸ºè§èååç token åºåï¼å (L_S) ä¸ªä¸ºåºå tokenï¼å (L_{NS}) ä¸ªä¸ºéåºå tokenã</p>
<p>åå¼æç¹å¾ç»ç ç©¶çå¯åï¼OneTrans å¯¹æ å Transformer è¿è¡äºè½»éçº§æ¹é ï¼å¼å¥æ··ååæ°æºå¶ï¼åè´¨ç S-tokens å±äº«åæ°ï¼èæ¥æºä¸è¯­ä¹å¼æç NS-tokens ä½¿ç¨åèªçä¸å±åæ°ã</p>
<p>ç±äºæ¨èç³»ç»ç token åºåæ··åäºç»è®¡åå¸å·®å¼è¾å¤§ç S-tokens ä¸ NS-tokensï¼è¥éç¨ post-norm ç»æå®¹æå¯¼è´æ³¨æåå¡ç¼©åè®­ç»ä¸ç¨³å®ãå æ­¤ï¼OneTrans éç¨ RMSNorm ä½ä¸º pre-normï¼å¯¹ææ token è¿è¡å½ä¸åï¼ä»èå¯¹é½å°ºåº¦å¹¶ç¨³å®ä¼åè¿ç¨ã</p>
<h4 id="331-æ··åå±äº«ä¸å±å ææ³¨æå">3.3.1 æ··åï¼å±äº«/ä¸å±ï¼å ææ³¨æå</h4>
<p>OneTrans ä½¿ç¨æ åå¤å¤´æ³¨æåï¼MHAï¼åå ææ©ç ï¼å¯ä¸çååå¨äº Q/K/V çåæ°åæ¹å¼ã</p>
<p>è®¾ç¬¬ (i) ä¸ª token ä¸º (x_i \in \mathbb{R}^d)ï¼åï¼</p>
<p></p><div class="math display">\[q_i, k_i, v_i =
W_i^Q x_i,\quad
W_i^K x_i,\quad
W_i^V x_i
\]</div><p></p><p>å¶ä¸­åæ°ç©éµéç¨æ··ååæ°åï¼</p>
<p></p><div class="math display">\[W_i^\Psi =
\begin{cases}
W_S^\Psi, &amp; i \le L_S \quad ï¼S\text{-tokens å±äº«åæ°ï¼} \
W_{NS,i}^\Psi, &amp; i &gt; L_S \quad ï¼NS\text{-tokens ä¸å±åæ°ï¼}
\end{cases}
\]</div><p></p><p>å ææ©ç çè®¾è®¡ä¸º NS-tokens æå¨ S-tokens ä¹åï¼ä»èå½¢æå¦ä¸ç»æï¼</p>
<ol>
<li><strong>S ä¾§è¡ä¸º</strong><br>
æ¯ä¸ª S-token ä»å³æ³¨å¶ä¹åç S-tokenã</li>
</ol>
<ul>
<li>è¥éç¨æ¶é´æç¥é¡ºåºï¼æ¯ä¸ªè¡ä¸ºåºäºåå²å»ºæ¨¡ï¼</li>
<li>è¥éç¨ææå¾æåºæ¹å¼ï¼å ææ©ç ä½¿é«æå¾è¡ä¸ºå½±ååç»­ä½æå¾è¡ä¸ºã</li>
</ul>
<ol start="2">
<li>
<p><strong>NS ä¾§è¡ä¸º</strong><br>
æ¯ä¸ª NS-token å¯è®¿é®å®æ´ S åå²ï¼ç¸å½äºå¯¹è¡ä¸ºè¯æ®è¿è¡ç®æ æ³¨æåèåï¼åæ¶å¯è®¿é®ååº NS-tokenï¼å¢å¼ºéåºå token ä¹é´çäº¤äºã</p>
</li>
<li>
<p><strong>æ¯æéå­å¡ç»æ</strong><br>
å æç»æä½¿ä¿¡æ¯éæ­¥ååéä¸­ï¼ä¸ºéå±è£åª token çéå­å¡æºå¶æä¾èªç¶æ¯æã</p>
</li>
</ol>
<h4 id="332-æ··åå±äº«ä¸å±åé¦ç½ç»">3.3.2 æ··åï¼å±äº«/ä¸å±ï¼åé¦ç½ç»</h4>
<p>FFN éç¨ç¸åçæ··ååæ°ç­ç¥ï¼</p>
<p></p><div class="math display">\[MixedFFN(x_i) = W_{2,i} , \phi(W_{1,i} x_i)
\]</div><p></p><p>å¶ä¸­ (W_{1,i}) ä¸ (W_{2,i}) éµå¾ªä¸è¿°æ··ååæ°è§åï¼<br>
S-tokens å±äº«åæ°ï¼NS-tokens ä½¿ç¨ä¸å±åæ°ã</p>
<h4 id="å°ç»">å°ç»</h4>
<p>ä¸æ åå æ Transformer ç¸æ¯ï¼OneTrans ä»å¨åæ°åå±é¢è¿è¡ä¿®æ¹ï¼</p>
<ul>
<li>NS-tokens ä½¿ç¨ä¸å± QKV ä¸ FFNï¼</li>
<li>S-tokens å±äº«ä¸å¥åæ°ï¼</li>
<li>åä¸å ææ©ç ç»ä¸è¿æ¥æ´ä¸ªåºåã</li>
</ul>
<p>è¿ç§è®¾è®¡ä½¿ NS-tokens è½å¤èåå®æ´è¡ä¸ºåå²ï¼åæ¶ä¿æ Transformer é£æ ¼çé«æè®¡ç®ç»æã</p>
<h2 id="34-éå­å¡å å pyramid-stack">3.4 éå­å¡å å ï¼Pyramid Stackï¼</h2>
<p>å¦ç¬¬ 3.3 èæè¿°ï¼å ææ©ç ä¼å°ä¿¡æ¯éæ­¥éä¸­å°åºåçåé¨ä½ç½®ãå©ç¨è¿ä¸âä¿¡æ¯åå°¾é¨èéâçç»æç¹æ§ï¼OneTrans éç¨éå­å¡å¼è°åº¦ç­ç¥ï¼å¨æ¯ä¸å± OneTrans Block ä¸­ï¼ä»æè¿çä¸é¨å S-tokens åä¸ Query è®¡ç®ï¼è Key ä¸ Value ä»å¨å®æ´åºåä¸è®¡ç®ï¼éçç½ç»æ·±åº¦å¢å ï¼åä¸ Query ç token æ°ééå±ç¼©åã</p>
<p>è®¾è¾å¥ token åºåä¸º</p>
<p></p><div class="math display">\[X = {x_i}_{i=1}^{L}
\]</div><p></p><p>å®ä¹å°¾é¨ç´¢å¼éå</p>
<p></p><div class="math display">\[Q = {L - L' + 1, ..., L}, \quad L' \le L
\]</div><p></p><p>å¨è¯¥å±ä¸­ï¼ä»å¯¹ (i \in Q) ç token è®¡ç® Queryï¼</p>
<p></p><div class="math display">\[q_i = W_i^Q x_i, \quad i \in Q
\]</div><p></p><p>è Key ä¸ Value ä»å¨å®æ´ç´¢å¼éå ({1, ..., L}) ä¸è®¡ç®ãæ³¨æåè®¡ç®å®æåï¼ä»ä¿ç (i \in Q) çè¾åºè¡¨ç¤ºï¼ä»èå° token é¿åº¦ç¼©åä¸º (L')ï¼å½¢æè·¨å±éæ­¥æ¶ç¼©çéå­å¡ç»æã</p>
<p>è¯¥è®¾è®¡å¸¦æ¥ä¸¤ä¸ªæ ¸å¿ä¼å¿ï¼</p>
<ol>
<li>
<p><strong>æ¸è¿å¼ä¿¡æ¯è¸é¦</strong><br>
é¿è¡ä¸ºåºåçä¿¡æ¯è¢«éå±åç¼©è³å°¾é¨ tokenï¼æ¨¡åå®¹ééä¸­äºæå·ä¿¡æ¯éçè¿æè¡ä¸ºï¼å¹¶éæ­¥å°é«é¶ä¿¡æ¯æ±èè³ NS-tokensã</p>
</li>
<li>
<p><strong>è®¡ç®æçæå</strong><br>
æ³¨æåå¤æåº¦ç± (O(L^2 d)) éä¸º (O(L L' d))ï¼FFN å¤æåº¦ä¸ (L') çº¿æ§ç¸å³ãéç Query éåç¼©å°ï¼FLOPs ä¸æ¿æ´»åå­æ¾èéä½ã</p>
</li>
</ol>
<h2 id="35-è®­ç»ä¸é¨ç½²ä¼å">3.5 è®­ç»ä¸é¨ç½²ä¼å</h2>
<h3 id="351-è·¨è¯·æ±-kv-ç¼å­cross-request-kv-caching">3.5.1 è·¨è¯·æ± KV ç¼å­ï¼Cross-Request KV Cachingï¼</h3>
<p>å¨å·¥ä¸æ¨èç³»ç»ä¸­ï¼åä¸è¯·æ±ä¸çå¤ä¸ªåéæ ·æ¬å¨è®­ç»ä¸æ¨çé¶æ®µéå¸¸è¿ç»­å¤çï¼å®ä»¬ç S-tokens å®å¨ç¸åï¼è NS-tokens éåéç©åååãåºäºè¿ä¸ç»æï¼OneTrans å¼å¥ KV Caching æºå¶ï¼å½¢æç»ä¸çä¸¤é¶æ®µè®¡ç®èå¼ã</p>
<p><strong>é¶æ®µ Iï¼S ä¾§ï¼æ¯è¯·æ±ä¸æ¬¡ï¼</strong><br>
å¯¹å¨é¨ S-tokens è¿è¡å ææ³¨æåè®¡ç®ï¼å¹¶ç¼å­å¶ Key/Value åæ³¨æåè¾åºãè¯¥é¶æ®µå¨æ¯ä¸ªè¯·æ±ä¸­ä»æ§è¡ä¸æ¬¡ã</p>
<p><strong>é¶æ®µ IIï¼NS ä¾§ï¼æ¯åéä¸æ¬¡ï¼</strong><br>
å¯¹æ¯ä¸ªåéç©åè®¡ç®å¶ NS-tokensï¼å¹¶ä¸ç¼å­ç S ä¾§ Key/Value è¿è¡è·¨æ³¨æåè®¡ç®ï¼éåè¿å¥ token-specific FFN å±ã<br>
å¯¹äºåéç¸å³çåºåç¹å¾ï¼å¦ SIMï¼ï¼ç±äºæ æ³å¤ç¨ S ä¾§ç¼å­ï¼éåéè¿æ± åæ¹å¼é¢èåä¸º NS-tokensã</p>
<p>KV ç¼å­æºå¶å° S ä¾§è®¡ç®å¨åéé´è¿è¡æéï¼ä½¿ååéè®¡ç®éå¤§å¹ä¸éï¼é¿åéå¤è®¡ç®ï¼ä»èæ¾èæåååçã</p>
<p>æ­¤å¤ï¼ç±äºç¨æ·è¡ä¸ºåºåæ¯è¿½å å¼å¢é¿çï¼å¯å° KV ç¼å­æ©å±è³è·¨è¯·æ±å¤ç¨ï¼<br>
æ¯æ¬¡æ°è¯·æ±å¤ç¨åä¸ç¼å­ï¼ä»å¯¹æ°å¢è¡ä¸ºè®¡ç®å¢é Key/Valueã<br>
å æ­¤åæ¬¡è¯·æ±çåºåè®¡ç®å¤æåº¦ç± (O(L)) éè³ (O(\Delta L))ï¼å¶ä¸­ (\Delta L) ä¸ºèªä¸æ¬¡è¯·æ±ä»¥æ¥æ°å¢è¡ä¸ºæ°éã</p>
<h3 id="352-ç»ä¸-llm-ä¼åç­ç¥">3.5.2 ç»ä¸ LLM ä¼åç­ç¥</h3>
<p>ä¸ºè¿ä¸æ­¥æåæçï¼OneTrans å¼å¥æççå¤§æ¨¡åå·¥ç¨ä¼åæ¹æ³ï¼</p>
<ol>
<li>
<p><strong>FlashAttention-2</strong><br>
éè¿ååè®¡ç®ä¸ kernel èåï¼åå°æ³¨æåè®¡ç®ä¸­ç I/O å¼éä¸äºæ¬¡æ¿æ´»å­å¨éæ±ï¼ä»èå¨è®­ç»ä¸æ¨çé¶æ®µéä½åå­å ç¨å¹¶æåååçã</p>
</li>
<li>
<p><strong>æ··åç²¾åº¦è®­ç»ï¼BF16/FP16ï¼ä¸æ¿æ´»éè®¡ç®</strong><br>
éç¨ä½ç²¾åº¦è®¡ç®ä»¥éä½æ¾å­å ç¨ï¼å¹¶ç»åæ¿æ´»éè®¡ç®ç­ç¥ï¼å¨ååä¼ æ­é¶æ®µéæ°è®¡ç®é¨åååæ¿æ´»å¼ã<br>
è¯¥ç­ç¥ä»¥å°éé¢å¤è®¡ç®æ¢åæ¾èåå­èçï¼ä½¿å¾æ´å¤§ batch ä¸æ´æ·±æ¨¡åæä¸ºå¯è½ï¼èæ éä¿®æ¹æ¨¡åç»æã</p>
</li>
</ol>
<p>æ»ä½èè¨ï¼éå­å¡ç»æè´è´£æ§å¶åºåé¿åº¦ä¸è®¡ç®è§æ¨¡ï¼KV ç¼å­è´è´£è·¨åéä¸è·¨è¯·æ±çè®¡ç®å¤ç¨ï¼è LLM ä¼åææ¯åè¿ä¸æ­¥æååºå±ç®å­æçãä¸èç»åï¼ä½¿ OneTrans å¨å·¥ä¸è§æ¨¡ä¸å·å¤å¯æ©å±æ§ä¸å¯é¨ç½²æ§ã</p>
<h2 id="4-å®éª">4 å®éª</h2>
<p>éè¿ç¦»çº¿è¯ä¼°ä¸å¨çº¿å®éªï¼æ¬æå´ç»ä»¥ä¸ç ç©¶é®é¢å±å¼åæï¼</p>
<p><strong>RQ1ï¼ç»ä¸å å ç»æ vs. âåç¼ç åäº¤äºâèå¼</strong><br>
å¨è®¡ç®èµæºç¸å½çæ¡ä»¶ä¸ï¼åä¸ Transformer ä¸»å¹²æ¯å¦è½å¤ç¨³å®ä¼äºä¼ ç»ç encodeâthenâinteraction æ¶æï¼</p>
<p><strong>RQ2ï¼å³é®è®¾è®¡å ç´ åæ</strong><br>
éè¿æ¶èå®éªè¯ä¼°ä¸åè®¾è®¡éæ©å¯¹æ§è½ä¸æççå½±åï¼åæ¬ï¼</p>
<ul>
<li>è¾å¥å±è®¾è®¡ï¼å¦ tokenizer æ¹å¼ãåºåèåç­ç¥ï¼ï¼</li>
<li>OneTrans Block ç»æè®¾è®¡ï¼å¦åæ°å±äº«ç­ç¥ãæ³¨æåå½¢å¼ãéå­å¡å å æºå¶ï¼ã</li>
</ul>
<p><strong>RQ3ï¼ç³»ç»æçè¯ä¼°</strong><br>
å¨ç¸å OneTrans è®¡ç®å¾ä¸ï¼éå­å¡å å ãè·¨è¯·æ± KV ç¼å­ãFlashAttention-2ï¼ä»¥åæ··åç²¾åº¦è®­ç»ä¸æ¿æ´»éè®¡ç®ï¼æ¯å¦è½å¤ææéä½ FLOPsãæ¾å­å ç¨ä¸æ¨çå»¶è¿ï¼</p>
<p><strong>RQ4ï¼è§æ¨¡è§å¾ï¼Scaling Lawï¼</strong><br>
éçæ¨¡åé¿åº¦ï¼token åºåé¿åº¦ï¼ãå®½åº¦ï¼(d_{model})ï¼ãæ·±åº¦ï¼å±æ°ï¼çæ©å±ï¼æå¤±ææ§è½æ¯å¦åç°é¢æçè¿ä¼¼å¯¹æ°çº¿æ§å¢é¿è¶å¿ï¼</p>
<p><strong>RQ5ï¼å¨çº¿ A/B æµè¯ææ</strong><br>
å¨æ»¡è¶³çäº§ç¯å¢å»¶è¿çº¦æçåæä¸ï¼OneTrans å¨çº¿é¨ç½²æ¯å¦è½å¤å¨å³é®ä¸å¡ææ ï¼å¦äººåè®¢åæ°ãç¨æ·çº§ GMVï¼ä¸å®ç°ç»è®¡æ¾èçæåï¼</p>
<p>è¯¥å®éªè®¾è®¡ç³»ç»æ§å°ä»æ¶ææææ§ãè®¾è®¡åçæ§ãç³»ç»æçãè§æ¨¡æ©å±è½åä»¥åçå®ä¸å¡ææäºä¸ªç»´åº¦è¿è¡éªè¯ã</p>
<h3 id="41-å®éªè®¾ç½®">4.1 å®éªè®¾ç½®</h3>
<h4 id="411-æ°æ®é">4.1.1 æ°æ®é</h4>
<p>å¨ç¦»çº¿è¯ä¼°ä¸­ï¼æä»¬å¨ä¸ä¸ªå¤§è§æ¨¡å·¥ä¸æåºåºæ¯ä¸è¯ä¼° OneTransï¼ä½¿ç¨ä¸¥æ ¼éç§åè§æ¡ä»¶ä¸ççäº§æ¥å¿æ°æ®ï¼ææä¸ªäººå¯è¯å«ä¿¡æ¯åå·²å¿ååå¹¶åå¸å¤çï¼ã</p>
<p>æ°æ®ææ¶é´é¡ºåºååï¼ææç¹å¾åå¨æåæ¶å»è¿è¡å¿«ç§ï¼ä»¥é²æ­¢æ¶é´ä¿¡æ¯æ³é²å¹¶ä¿è¯çº¿ä¸çº¿ä¸ä¸è´æ§ãæ ç­¾ï¼å¦ç¹å»ä¸ä¸åï¼å¨ä¸çäº§ç¯å¢å¯¹é½çåºå®æ¶é´çªå£åèåãæ°æ®éç»è®¡ä¿¡æ¯è§è¡¨ 1ã</p>
<p><img alt="image-2" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3670197/202602/3670197-20260214112938750-1297664972.png" class="lazyload"></p>
<h4 id="412-ä»»å¡ä¸ææ ">4.1.2 ä»»å¡ä¸ææ </h4>
<p>æä»¬è¯ä¼°ä¸¤ä¸ªäºåç±»æåºä»»å¡ï¼è§å¬å¼ (2)ï¼ï¼CTR ä¸ CVRãæ§è½ææ åæ¬ï¼</p>
<ul>
<li><strong>AUC</strong></li>
<li><strong>UAUCï¼åºäºæåå æçç¨æ·çº§ AUCï¼</strong></li>
</ul>
<h5 id="next-batch-è¯ä¼°æ¹å¼">Next-batch è¯ä¼°æ¹å¼</h5>
<p>æ°æ®ææ¶é´é¡ºåºå¤çãå¯¹äºæ¯ä¸ª mini-batchï¼</p>
<ol>
<li>å¨è¯ä¼°æ¨¡å¼ä¸è®°å½é¢æµç»æï¼</li>
<li>éåå¨åä¸ batch ä¸è¿è¡è®­ç»ã</li>
</ol>
<p>AUC ä¸ UAUC æå¤©è®¡ç®ï¼ç¶åå¯¹åå¤©ç»æè¿è¡å®å¹³åã</p>
<h5 id="æçææ ">æçææ </h5>
<ul>
<li><strong>Params</strong>ï¼æ¨¡ååæ°éï¼ä¸åå«ç¨ç embeddingï¼</li>
<li><strong>TFLOPs</strong>ï¼è®­ç»è®¡ç®éï¼batch size = 2048 æ¶ç TFLOPsï¼</li>
</ul>
<h4 id="413-åºçº¿æ¨¡å">4.1.3 åºçº¿æ¨¡å</h4>
<p>æä»¬æå»ºäºå·¥ä¸æ åæ¨¡åç»åä½ä¸ºå¯¹æ¯åºçº¿ï¼ä½¿ç¨ç¸åç¹å¾å¹¶å¹éè®¡ç®é¢ç®ã</p>
<p>å¨ encodeâthenâinteraction èå¼ä¸ï¼</p>
<ul>
<li>ä»çäº§ä¸­å¸¸ç¨ç DCNv2 + DIN ä½ä¸ºåºç¡æ¨¡åï¼</li>
<li>éæ­¥å¢å¼ºç¹å¾äº¤äºæ¨¡åï¼<br>
DCNv2 â Wukong â HiFormer â RankMixerã</li>
</ul>
<p>å¨åºå® RankMixer çåæä¸ï¼è¿ä¸æ­¥æ¿æ¢åºåå»ºæ¨¡æ¨¡åï¼</p>
<ul>
<li>StackDIN â Transformer â LONGERã</li>
</ul>
<h4 id="414-è¶åæ°è®¾ç½®">4.1.4 è¶åæ°è®¾ç½®</h4>
<p>æä»¬æ¥åä¸¤ç§æ¨¡åè§æ¨¡ï¼</p>
<ul>
<li>
<p><strong>OneTrans-S</strong></p>
<ul>
<li>6 å± OneTrans Block</li>
<li>å®½åº¦ (d = 256)</li>
<li>4 ä¸ªæ³¨æåå¤´</li>
<li>çº¦ 1 äº¿åæ°</li>
</ul>
</li>
<li>
<p><strong>OneTrans-L</strong></p>
<ul>
<li>8 å±</li>
<li>å®½åº¦ (d = 384)</li>
</ul>
</li>
</ul>
<h4 id="è¾å¥ä¸éå­å¡è®¾ç½®">è¾å¥ä¸éå­å¡è®¾ç½®</h4>
<ul>
<li>
<p>åºåç¹å¾éç¨æ¶é´æç¥èåæ¹å¼ï¼</p>
</li>
<li>
<p>éåºåç¹å¾ä½¿ç¨ Auto-Split tokenizerï¼</p>
</li>
<li>
<p>ä½¿ç¨å¯åå¼éå­å¡è°åº¦ï¼</p>
<ul>
<li>OneTrans-Sï¼åºå Query token ä» 1190 çº¿æ§ç¼©åè³ 12</li>
<li>OneTrans-Lï¼ä» 1500 ç¼©åè³ 16</li>
</ul>
</li>
</ul>
<p>å·ä½å®ç°ä¸ºï¼è·¨å±çº¿æ§åå°åºå Query token æ°éï¼å¹¶å¨æ¯å±å° token æ°éåèäºå¥è³ 32 çåæ°ï¼æé¡¶å± token æ°éä¸éåºå token æ°éä¸è´ã</p>
<h4 id="ä¼åä¸åºç¡è®¾æ½">ä¼åä¸åºç¡è®¾æ½</h4>
<p>éç¨åä¼åå¨ç­ç¥ï¼ä¸ä½¿ç¨ weight decayï¼ï¼</p>
<ul>
<li>ç¨ç embeddingï¼Adagradï¼Î²â=0.1ï¼Î²â=1.0ï¼</li>
<li>ç¨ å¯åæ°ï¼RMSPropï¼lr=0.005ï¼alpha=0.99999ï¼momentum=0ï¼</li>
</ul>
<p>è®­ç»ç¨³å®æ§ç­ç¥åæ¬ï¼</p>
<ul>
<li>Pre-Norm ç»æ</li>
<li>å¨å±æ¢¯åº¦èæ°è£åª</li>
</ul>
<p>è®­ç»é¶æ®µï¼</p>
<ul>
<li>æ¯ GPU batch size = 2048</li>
<li>ç¨ å¯å±æ¢¯åº¦è£åªéå¼ = 90</li>
<li>ç¨çå±æ¢¯åº¦è£åªéå¼ = 120</li>
<li>ä½¿ç¨ 16 å¼  H100 GPUï¼æ°æ®å¹¶è¡ All-Reduce</li>
</ul>
<p>å¨çº¿æ¨çé¶æ®µï¼</p>
<ul>
<li>æ¯ GPU batch size = 100</li>
<li>å¨ååçä¸å»¶è¿ä¹é´è¿è¡æè¡¡ä¼å</li>
</ul>
<p>è¯¥å®éªè®¾ç½®ç¡®ä¿äºæ¨¡åè§æ¨¡ãè®­ç»ç¨³å®æ§ä¸å·¥ä¸é¨ç½²çº¦æä¹é´çå¹³è¡¡ï¼ä½¿ç¦»çº¿è¯ä¼°ä¸çº¿ä¸ææå·æé«åº¦ä¸è´æ§ã</p>
<h3 id="42-rq1æ§è½è¯ä¼°">4.2 RQ1ï¼æ§è½è¯ä¼°</h3>
<p><img alt="image-3" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3670197/202602/3670197-20260214112949883-513117867.png" class="lazyload"></p>
<p>æä»¬ä»¥ DCNv2 + DIN ä½ä¸ºå¯¹æ¯åºåæ¨¡åï¼è¯¥æ¨¡åä¸ºæ¬åºæ¯ä¸­è§æ¨¡æ©å±åççäº§åºçº¿ï¼è§è¡¨ 2ï¼ã</p>
<p>å¨ encodeâthenâinteraction èå¼ä¸ï¼åå«å¯¹ä¸¤ä¸ªç»ä»¶è¿è¡ç¬ç«æ©å±åè½å¸¦æ¥æ¶çï¼</p>
<ul>
<li>åçº§ç¹å¾äº¤äºæ¨¡åï¼DCNv2 â Wukong â HiFormer â RankMixerï¼ï¼</li>
<li>åçº§åºåå»ºæ¨¡æ¨¡åï¼StackDIN â Transformer â LONGERï¼ï¼</li>
</ul>
<p>ä¸è¿°æ¹è¿å¨ CTR AUC/UAUC ä¸ CVR AUC ä¸åè¡¨ç°åºç¨³å®æåã</p>
<p>å¨æä»¬çç³»ç»ä¸­ï¼AUC æ UAUC æåè¶è¿ +0.1% å³è¢«è§ä¸ºå·æå®éæä¹ï¼è¶è¿ +0.3% éå¸¸å¯¹åºå¨çº¿ A/B æµè¯ä¸­çç»è®¡æ¾èæåãç±äºç¨æ·çº§æ ·æ¬æ°éè¾å°ä¸æ³¢å¨è¾å¤§ï¼CVR UAUC ææ éè°¨æè§£è¯»ã</p>
<p>å¨ç»ä¸æ¶æä¸ï¼OneTrans-S ç¸æ¯åºçº¿åå¾ï¼</p>
<ul>
<li>CTRï¼+1.13% / +1.77%ï¼AUC / UAUCï¼</li>
<li>CVRï¼+0.90% / +1.66%ï¼AUC / UAUCï¼</li>
</ul>
<p>å¨ç¸è¿åæ°è§æ¨¡ä¸è®­ç»ç®åæ¡ä»¶ä¸ï¼2.64T vs. 2.51Tï¼ï¼OneTrans-S ä¹æ¾èä¼äº RankMixer + Transformerï¼éªè¯äºç»ä¸å»ºæ¨¡çä¼å¿ã</p>
<p>è¿ä¸æ­¥æ©å±æ¨¡åè§æ¨¡ï¼OneTrans-L åå¾æä½³æ´ä½è¡¨ç°ï¼</p>
<ul>
<li>CTRï¼+1.53% / +2.79%</li>
<li>CVRï¼+1.14% / +3.23%</li>
</ul>
<p>éçæ¨¡åå®¹éå¢å ï¼æ§è½åç°ç¨³å®ãå¯é¢æµçå¢é¿è¶å¿ã</p>
<p>æ»ç»èè¨ï¼å¨åä¸ Transformer ä¸»å¹²ä¸­ç»ä¸åºåå»ºæ¨¡ä¸ç¹å¾äº¤äºï¼ç¸æ¯ç¬ç«æ©å±å¶ä¸­ä»»ä¸æ¨¡åï¼è½å¤å¸¦æ¥æ´å¯é ä¸æ´å·è®¡ç®æççæ§è½æåãè¿ä¸ç»æç´æ¥åç­äº RQ1ï¼å¹¶ä¸ºç»ä¸æ¶ææä¾äºå®è¯æ¯æã</p>
<h3 id="43-rq2è®¾è®¡éæ©çæ¶èç ç©¶">4.3 RQ2ï¼è®¾è®¡éæ©çæ¶èç ç©¶</h3>
<p>æä»¬å¯¹ OneTrans çå³é®è®¾è®¡è¿è¡ç³»ç»æ§æ¶èå®éªï¼ä»¥éååç»ä»¶çè´¡ç®ãå®æ´ç»æè§è¡¨ 3ãå®éªåä½åæ¬ï¼</p>
<p><img alt="image-4" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3670197/202602/3670197-20260214113002042-1855745462.png" class="lazyload"></p>
<p><img alt="image-5" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3670197/202602/3670197-20260214113007601-654025203.png" class="lazyload"></p>
<h4 id="è¾å¥å±åä½">è¾å¥å±åä½</h4>
<ol>
<li>å° Auto-Split Tokenizer æ¿æ¢ä¸º Group-wise Tokenizerï¼è¡¨ 3 ç¬¬ 1 è¡ï¼ï¼</li>
<li>ä½¿ç¨æ¶é´æ å³çåºåèåæ¹å¼æ¿ä»£æ¶é´æç¥èåï¼ç¬¬ 2 è¡ï¼ï¼</li>
<li>å¨æ¶é´æç¥èåä¸­ç§»é¤å¯å­¦ä¹ ç [SEP] tokenï¼ç¬¬ 3 è¡ï¼ã</li>
</ol>
<h4 id="onetrans-block-ç»æåä½">OneTrans Block ç»æåä½</h4>
<ol start="4">
<li>ææ token å±äº«åä¸ç» Q/K/V ä¸ FFN åæ°ï¼èä¸å¯¹ NS-tokens ä½¿ç¨ä¸å±åæ°ï¼ç¬¬ 4 è¡ï¼ï¼</li>
<li>ä½¿ç¨å¨æ³¨æåï¼full attentionï¼æ¿ä»£å ææ³¨æåï¼ç¬¬ 5 è¡ï¼ï¼</li>
<li>åæ¶éå­å¡å å ï¼å¨ææå±ä¿çå®æ´ token åºåï¼ç¬¬ 6 è¡ï¼ã</li>
</ol>
<h4 id="æ¶èç»è®º">æ¶èç»è®º</h4>
<ol>
<li>
<p><strong>Auto-Split Tokenizer ä¼äºäººå·¥åç»æ¹å¼</strong><br>
ç¸æ¯å°éåºåç¹å¾äººå·¥ååä¸ºè¯­ä¹ç»ï¼èªå¨æå»º NS-token çæ¹å¼æææ´ä¼ãè¿è¡¨æç±æ¨¡åèªå¨å­¦ä¹ ç¹å¾ç»ç»ç»æä¼äºäººä¸ºåéªåç»ã</p>
</li>
<li>
<p><strong>æ¶é´æç¥èåä¼äºæè¡ä¸ºæå¾æåº</strong><br>
å¨å­å¨æ¶é´æ³ä¿¡æ¯æ¶ï¼ææ¶é´é¡ºåºèåä¼äºæè¡ä¸ºå½±ååæåºï¼è¯´ææ¶é´ä¿¡æ¯æ¯ä¸»è§è®¾å®çè¡ä¸ºå¼ºå¼±æåºæ´å·è¡¨è¾¾åã</p>
</li>
<li>
<p><strong>[SEP] token æå©äºåºååºå</strong><br>
å¨æ¶é´æ å³èåä¸ï¼å¯å­¦ä¹ ç [SEP] token æå©äºæ¨¡ååºåä¸ååºåï¼æé«è¡¨ç¤ºè½åã</p>
</li>
<li>
<p><strong>NS-token ä¸å±åæ°ä¼äºå±äº«åæ°</strong><br>
ä¸ºéåºå token åéä¸å± Q/K/V ä¸ FFN åæ°ä¼äºå®å¨å±äº«æå½±ï¼æå©äºå¢å¼ºä¸åç¹å¾æ¥æºä¹é´çè¡¨è¾¾åºåè½åã</p>
</li>
<li>
<p><strong>å ææ³¨æåä¸å¨æ³¨æåæææ¥è¿ï¼ä½å ææ³¨æåæ´å·å·¥ç¨ä¼å¿</strong><br>
æ§è½ä¸äºèç¸è¿ï¼ä½å¨æ³¨æåä¼ç ´å KV ç¼å­ç­æ åä¼åææ®µï¼å æ­¤ä¸å·å¤ç³»ç»å±é¢çå¯æ©å±æ§ã</p>
</li>
<li>
<p><strong>éå­å¡è®¾è®¡ä¸ä¼æå¤±ææï¼å´æ¾èèçè®¡ç®</strong><br>
å¨ææå±ä¿çå®æ´ token åºåå¹¶æªå¸¦æ¥æ§è½æåãOneTrans è½ææå°ä¿¡æ¯åç¼©è³å°¾é¨ tokenï¼å æ­¤éå­å¡ç»æå¯ä»¥å®å¨è£åª Query tokenï¼ä»èéä½è®¡ç®éã</p>
</li>
</ol>
<p>æ­¤å¤ï¼å¨åºå® TFLOPs é¢ç®ä¸ï¼éå­å¡è®¾è®¡æ¯ææ¥è¿ 1.75 åæ´é¿çè¾å¥åºåï¼ç¸æ¯å¨é¿åº¦è®¾è®¡æ´è½ææå©ç¨åºåæ©å±å¸¦æ¥çæ¶çã</p>
<p>æ»ä½èè¨ï¼æ¶èç»æè¡¨æ OneTrans çå³é®è®¾è®¡å¹¶éç»éªæ§å å ï¼èæ¯å·ææç¡®ç»æå¿è¦æ§ï¼èªå¨ token æå»ºãæ¶é´æç¥èåãNS ä¸å±åæ°ä»¥åéå­å¡è£åªå±åææäºæ§è½ä¸æçå¼é¡¾çæ ¸å¿æºå¶ã</p>
<h2 id="44-rq3ç³»ç»æç">4.4 RQ3ï¼ç³»ç»æç</h2>
<p>ä¸ºéåç¬¬ 3.5 èæåºçç³»ç»ä¼åç­ç¥ï¼æä»¬å¨ä¸ä¸ªæªåä¼åç OneTransS åºçº¿æ¨¡åä¸éé¡¹è¿è¡æ¶èï¼å¹¶å¨è¡¨ 4 ä¸­æ¥åè®­ç»ä¸æ¨çé¶æ®µçæçææ ã</p>
<p><img alt="image-6" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3670197/202602/3670197-20260214113021845-1623277081.png" class="lazyload"></p>
<p>å®éªç»æè¡¨æï¼</p>
<ol>
<li>
<p><strong>éå­å¡å å ï¼Pyramid Stackï¼</strong><br>
éè¿è£åªåºå Query tokenï¼æ¾èéä½è®­ç»é¶æ®µçè¿è¡æ¶é´ä¸æ¾å­å ç¨ï¼åæ¶åå°çº¿ä¸æå¡é¶æ®µç p99 å»¶è¿ä¸åå­æ¶èã</p>
</li>
<li>
<p><strong>è·¨è¯·æ± KV ç¼å­ï¼Cross-request KV Cachingï¼</strong><br>
æ¶é¤éå¤çåºåè®¡ç®ï¼å¨è®­ç»ä¸æ¨çé¶æ®µåç¨³å®æåè¿è¡æçä¸åå­å©ç¨çã</p>
</li>
<li>
<p><strong>FlashAttention</strong><br>
å¨è®­ç»é¶æ®µå¸¦æ¥æ¾èå éææï¼èå¨æ¨çé¶æ®µçæ¹è¿ç¸å¯¹æéä½ä»ææ¶çã</p>
</li>
<li>
<p><strong>æ··åç²¾åº¦ä¸éè®¡ç®ï¼Mixed Precision + Re-computationï¼</strong><br>
å¯¹çº¿ä¸æå¡æ¶çæå¤§ï¼æ¾èéä½ p99 å»¶è¿ä¸æ¨çæ¾å­å¼éï¼åæ¶æåè®­ç»æçã</p>
</li>
</ol>
<h3 id="ç»¼åç»è®º">ç»¼åç»è®º</h3>
<p><img alt="image-7" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3670197/202602/3670197-20260214113029018-1899707250.png" class="lazyload"></p>
<p>ä¸è¿°ç»æéªè¯äºå°å¤§æ¨¡åï¼LLMï¼ç³»ç»ä¼åææ¯è¿ç§»å°å¤§è§æ¨¡æ¨èåºæ¯çæææ§ãå¨æ­¤åºç¡ä¸ï¼æ¨¡åè¿ä¸æ­¥æ©å±è³ OneTransLï¼å¹¶å¨è¡¨ 5 ä¸­å±ç¤ºå¶çº¿ä¸æçå¯ä¸è§æ¨¡è¿å°å¾å¤ç DCNv2+DIN åºçº¿æ¨¡åç¸å½ã</p>
<p>è¿è¯´æç»ä¸ç Transformer ä¸»å¹²ç»æå·æéè¦å·¥ç¨ä¼å¿ï¼å®åè®¸ç´æ¥å¤ç¨æççå¤§æ¨¡åä¼åææ¯ï¼ä»èå¨æ¨¡åè§æ¨¡æ¾èæåçåæ¶ï¼ç»´æå¯æ§çå¨çº¿è®¡ç®å¼éã</p>
<p>æ»ä½æ¥çï¼æ¬èè¯æäº OneTrans å¨æ©å¤§æ¨¡åå®¹éçåæ¶ï¼å¹¶æªçºç²ç³»ç»æçï¼èæ¯éè¿æ¶æç»ä¸åå®ç°äºæ§è½ä¸å·¥ç¨å¯æ©å±æ§çå¼é¡¾ã</p>
<h2 id="45-rq4scaling-law-éªè¯">4.5 RQ4ï¼Scaling-Law éªè¯</h2>
<p>æä»¬ä»ä¸ä¸ªç»´åº¦ç³»ç»ç ç©¶ OneTrans çæ©å±è§å¾ï¼scaling lawsï¼ï¼</p>
<ol>
<li><strong>é¿åº¦ï¼Lengthï¼</strong>ï¼è¾å¥ token åºåé¿åº¦</li>
<li><strong>æ·±åº¦ï¼Depthï¼</strong>ï¼å å  Transformer block çå±æ°</li>
<li><strong>å®½åº¦ï¼Widthï¼</strong>ï¼éèå±ç»´åº¦å¤§å°</li>
</ol>
<h3 id="åè½´æ©å±ç»æ">åè½´æ©å±ç»æ</h3>
<p>å¦å¾ 3(a) æç¤ºï¼</p>
<ul>
<li>
<p><strong>å¢å åºåé¿åº¦å¸¦æ¥æå¤§æ¶ç</strong>ï¼å ä¸ºæ´é¿çè¡ä¸ºåºåæä¾äºæ´ä¸°å¯çç¨æ·è¡ä¸ºè¯æ®ã</p>
</li>
<li>
<p>å¨æ·±åº¦ä¸å®½åº¦ä¹é´å­å¨ææ¾æè¡¡ï¼</p>
<ul>
<li>å¢å æ·±åº¦éå¸¸æ¯åçº¯å¢å å®½åº¦å¸¦æ¥æ´å¤§çæ§è½æåï¼å ä¸ºæ´æ·±çç½ç»å¯ä»¥å­¦ä¹ æ´é«é¶äº¤äºä¸æ´ä¸°å¯çæ½è±¡è¡¨ç¤ºã</li>
<li>ä½æ´æ·±çæ¨¡åå¢å ä¸²è¡è®¡ç®è·¯å¾ï¼å½±åå»¶è¿ã</li>
<li>æ©å®½ç»´åº¦åæ´æå¹¶è¡åï¼å¨ç¡¬ä»¶å©ç¨çä¸æ´åå¥½ã</li>
</ul>
</li>
</ul>
<p>å æ­¤ï¼å¨å®éé¨ç½²æ¶ï¼æ·±åº¦ä¸å®½åº¦çéæ©åºç»¼åèèæ§è½æ¶çä¸ç®æ ç¡¬ä»¶é¢ç®ä¸çç³»ç»æçã</p>
<h3 id="èåæ©å±ä¸å¯¹æ¯åæ">èåæ©å±ä¸å¯¹æ¯åæ</h3>
<p>æä»¬è¿ä¸æ­¥èåå¢å  OneTrans çæ·±åº¦ä¸å®½åº¦ï¼åæ¶å¯¹æ¯æ©å± RankMixer+Transformer åºçº¿ï¼ä¸»è¦å¨ RankMixer ä¾§æ©å±è³ 1B åæ°è§æ¨¡ï¼ï¼å¹¶ç»å¶ ÎUAUC ç¸å¯¹äºè®­ç» FLOPsï¼å¯¹æ°å°ºåº¦ï¼çå³ç³»æ²çº¿ã</p>
<p>å¾ 3(b) è¡¨æï¼</p>
<ul>
<li>OneTrans ä¸ RankMixer ååç°æ¸æ°çå¯¹æ°çº¿æ§è¶å¿ï¼log-linear scalingï¼ã</li>
<li>ä½ <strong>OneTrans çæçæ´é¡å³­</strong>ï¼å³å¨ç¸åè®¡ç®å¢éä¸å¸¦æ¥æ´å¤§çæ§è½æåã</li>
</ul>
<p>å¶åå å¯è½å¨äºï¼</p>
<ul>
<li>RankMixer çæ©å±ç¼ºä¹ç»ä¸ä¸»å¹²ç»æï¼</li>
<li>åºäº MoE çæ©å±ä¸»è¦ä½ç°å¨ FFN éèå±ç»´åº¦çâå®½åº¦æ©å±âï¼</li>
<li>è OneTrans éè¿ç»ä¸ Transformer ä¸»å¹²å®ç°ç»æå±é¢çæ´ä½æ©å±ï¼æåäºåæ°ä¸è®¡ç®å©ç¨æçã</li>
</ul>
<h3 id="ç»è®ºä¸é¨ç½²è¾¹ç">ç»è®ºä¸é¨ç½²è¾¹ç</h3>
<p>è¿äºç»æè¡¨æï¼</p>
<ul>
<li>OneTrans å¨åæ°æçä¸è®¡ç®æçæ¹é¢æ´å·ä¼å¿ï¼</li>
<li>å¨å·¥ä¸é¨ç½²åºæ¯ä¸­ï¼å¶æ§è½âè®¡ç®æè¡¡æ´å·å¸å¼åã</li>
</ul>
<p>ç®åï¼OneTransL å·²å¯å¨ä¸¥æ ¼ççº¿ä¸ p99 å»¶è¿çº¦æä¸ç¨³å®é¨ç½²ãä½è¿ä¸æ­¥è¶åºå½åè§æ¨¡çæ©å±ä»åå°å¨çº¿æçç¶é¢éå¶ãæªæ¥å·¥ä½å°èç¦äºç³»ç»ä¸æ¨¡åçèåä¼åï¼ä»¥çªç ´è¿ä¸æ©å±ä¸éã</p>
<p>ä»æ¬èå¯ä»¥æç¼åºä¸ä¸ªæ ¸å¿ç»è®ºï¼<br>
<strong>å¨æ¨èç³»ç»åºæ¯ä¸­ï¼ç»ä¸ Transformer ä¸»å¹²ä¸ä»å¸¦æ¥ç»æè¡¨è¾¾ä¼å¿ï¼ä¹å¸¦æ¥æ´ä¼ç scaling-law æçï¼å³åä½ç®åå¯¹åºæ´é«çæ§è½å¢çãè¿ä¸ç¹æ¯å¶ç¸è¾äºä¼ ç»âç»ä»¶æ¼æ¥å¼æ©å±âæ¹æ³çæ ¹æ¬ä¼å¿ã</strong></p>
<h2 id="46-rq5å¨çº¿-ab-å®éª">4.6 RQ5ï¼å¨çº¿ A/B å®éª</h2>
<p>æä»¬å¨ä¸¤ä¸ªå¤§è§æ¨¡å·¥ä¸åºæ¯ä¸­è¯ä¼° OneTrans çä¸å¡å½±åï¼</p>
<ol>
<li><strong>Feeds</strong>ï¼é¦é¡µä¿¡æ¯æµï¼</li>
<li><strong>Mall</strong>ï¼åå« Feeds åå¶ä»å­åºæ¯çæ´ä½ä¸å¡ç¯å¢ï¼</li>
</ol>
<p>æµéå¨ç¨æ·/è´¦å·å±çº§è¿è¡åå¸ååä¸éæºåéãæ§å¶ç»ä¸å®éªç»ååºäºè¿å» 1.5 å¹´ççäº§æ°æ®è¿è¡è®­ç»ä¸é¨ç½²ï¼ä»¥ç¡®ä¿å¯¹æ¯å¬å¹³ã</p>
<h3 id="å®éªè®¾ç½®">å®éªè®¾ç½®</h3>
<ul>
<li>
<p><strong>æ§å¶ç»ï¼Controlï¼</strong>ï¼<br>
RankMixer + Transformerï¼çº¦ 1 äº¿ç¥ç»ç½ç»åæ°ï¼ï¼ä¸ä½¿ç¨åºå KV ç¼å­ã</p>
</li>
<li>
<p><strong>å®éªç»ï¼Treatmentï¼</strong>ï¼<br>
OneTransLï¼å¹¶éç¨ç¬¬ 3.5 èæè¿°çæå¡ç«¯ä¼åç­ç¥ã</p>
</li>
</ul>
<p>è¯ä¼°ææ åæ¬ï¼</p>
<ul>
<li>ç¨æ·çº§ click/uãorder/uãgmv/uï¼ç¸å¯¹ RankMixer+Transformer ç Î%ï¼ï¼</li>
<li>åä¾§ 95% ç½®ä¿¡åºé´ï¼åºäºç¨æ·åå± bootstrapï¼ï¼</li>
<li>ç«¯å°ç«¯å»¶è¿ï¼p99 æ¯æåå»¶è¿ååç¾åæ¯ï¼æ°å¼è¶ä½è¶å¥½ï¼ã</li>
</ul>
<h3 id="å®éªç»æ">å®éªç»æ</h3>
<p>å¦è¡¨ 6 æç¤ºï¼OneTransL å¨ä¸¤ä¸ªåºæ¯ååå¾ç¨³å®æåã</p>
<p><img alt="image-8" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3670197/202602/3670197-20260214113037965-1243414740.png" class="lazyload"></p>
<h4 id="feeds-åºæ¯">Feeds åºæ¯</h4>
<ul>
<li>click/uï¼+7.737%</li>
<li>order/uï¼+4.3510%</li>
<li>gmv/uï¼+5.6848%</li>
<li>p99 å»¶è¿ï¼â3.91%</li>
</ul>
<h4 id="mall-åºæ¯">Mall åºæ¯</h4>
<ul>
<li>click/uï¼+5.143%</li>
<li>order/uï¼+2.5772%</li>
<li>gmv/uï¼+3.6696%</li>
<li>p99 å»¶è¿ï¼â3.26%</li>
</ul>
<p>ç»æè¡¨æï¼ç¸è¾äºå¼ºåºçº¿ RankMixer+Transformerï¼ç»ä¸å»ºæ¨¡æ¡æ¶å¨æåæ ¸å¿ä¸å¡ææ çåæ¶ï¼åèéä½äºçº¿ä¸æå¡å»¶è¿ã</p>
<h3 id="æ³åè½ååæ">æ³åè½ååæ</h3>
<p>è¿ä¸æ­¥è§å¯å°ï¼</p>
<ul>
<li>ç¨æ· Active Days æå +0.7478%ï¼</li>
<li>å·å¯å¨åå order/u æå +13.59%ã</li>
</ul>
<p>è¿è¯´æ OneTrans å¨å·å¯å¨ä¸æ³åè½åæ¹é¢å·ææ¾èä¼å¿ï¼è½å¤æ´ææå°å»ºæ¨¡ç¨çæä½é¢è¡ä¸ºæ¨¡å¼ã</p>
<h3 id="ç»¼åç»è®º-1">ç»¼åç»è®º</h3>
<p>æ¬èéªè¯äºç»ä¸ Transformer ä¸»å¹²ä¸ä»å¨ç¦»çº¿ææ ä¸ç³»ç»æçä¸å·æä¼å¿ï¼å¨çå®å¤§è§æ¨¡çº¿ä¸ç¯å¢ä¸­äº¦è½å®ç°ï¼</p>
<ol>
<li>æ¾èçæ ¸å¿ä¸å¡ææ æåï¼</li>
<li>æå¡å»¶è¿ä¸éï¼</li>
<li>å·å¯å¨æ³åè½åå¢å¼ºã</li>
</ol>
<p>ä»å·¥ç¨ä¸ä¸å¡åéç»´åº¦çï¼OneTrans å®ç°äºæ§è½ãæçä¸æ³åè½åçååæåï¼è¯æç»ä¸å»ºæ¨¡è®¾è®¡å¨å·¥ä¸æ¨èç³»ç»ä¸­çå®éå¯è¡æ§ä¸åä¸ä»·å¼ã</p>
<h2 id="5-ç»è®º">5 ç»è®º</h2>
<p>æ¬ææåº OneTransï¼ä¸ç§ç¨äºä¸ªæ§åæåºçç»ä¸ Transformer ä¸»å¹²ç»æï¼ç¨ä»¥æ¿ä»£ä¼ ç»çâç¼ç âäº¤äºâï¼encodeâthenâinteractionï¼èå¼ã</p>
<p>è¯¥æ¹æ³éè¿ç»ä¸ç Tokenizer å°åºåç¹å¾ä¸éåºåç¹å¾è½¬æ¢ä¸ºåä¸ token åºåï¼å¹¶éè¿ç»ä¸ç Transformer Block å¨åä¸æ¡æ¶ååæ¶å®æåºåå»ºæ¨¡ä¸ç¹å¾äº¤äºãå¶ä¸­ï¼</p>
<ul>
<li>å¯¹åè´¨çåºå token å±äº«åæ°ï¼</li>
<li>å¯¹å¼è´¨çéåºå token ä½¿ç¨ä¸å±åæ°ï¼ä»¥å¢å¼ºè¡¨è¾¾è½åã</li>
</ul>
<p>ä¸ºä¿è¯ç»ä¸æ¶æå¨å¤§è§æ¨¡åºæ¯ä¸çæçï¼</p>
<ul>
<li>éç¨éå­å¡å¼è°åº¦ç­ç¥ï¼éå±è£åªåºå tokenï¼</li>
<li>ä½¿ç¨è·¨è¯·æ± KV ç¼å­å¤ç¨ç¨æ·ä¾§è®¡ç®ï¼</li>
<li>åæ¶å¼å¥å¤§æ¨¡åé£æ ¼çç³»ç»ä¼åææ¯ï¼å¦ FlashAttention ä¸æ··åç²¾åº¦è®¡ç®ã</li>
</ul>
<p>å¨å¤§è§æ¨¡å®éªä¸­ï¼OneTrans éæ¨¡åå®½åº¦ä¸æ·±åº¦æ©å±åç°è¿ä¼¼å¯¹æ°çº¿æ§ï¼log-linearï¼çæ§è½å¢é¿è¶å¿ï¼å¹¶å¨çå®çº¿ä¸ç¯å¢ä¸­åå¾ç»è®¡æ¾èçä¸å¡ææ æåï¼åæ¶ä¿æçäº§çº§å»¶è¿è¦æ±ã</p>
<p>æ»ä½èè¨ï¼è¯¥ç»ä¸è®¾è®¡ä¸ºæ¨èç³»ç»çè§æ¨¡æ©å±æä¾äºä¸æ¡å¯è¡è·¯å¾ï¼ä½¿å¶è½å¤ç´æ¥å¤ç¨è¿å¹´æ¥æ¨å¨å¤§è¯­è¨æ¨¡ååå±çç³»ç»ä¼åææ¯ï¼å®ç°æ¨¡åè½åä¸å·¥ç¨æççååæåã</p>


</div>
<div class="clear"></div>

		<p class="postfoot">
			posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-14 11:32">2026-02-14 11:31</span>&nbsp;
<a href="https://www.cnblogs.com/GlenTt">GlenTt</a>&nbsp;
éè¯»(<span id="post_view_count">50</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19614879);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19614879', targetLink: 'https://www.cnblogs.com/GlenTt/p/19614879', title: 'OneTransï¼å¨å·¥ä¸çº§æ¨èç³»ç»ä¸­ä»¥åä¸ Transformer å®ç°ç¹å¾äº¤äºä¸åºåå»ºæ¨¡çç»ä¸æ¡æ¶' })">ä¸¾æ¥</a>

		</p>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åå¸å­å­çç¬¬ä¸ä¸ªBç«è§é¢ï¼æåç¥å¤§å®¶æ¥èå¿«ä¹ï¼ ]]></title>
    <link>https://www.cnblogs.com/cmt/p/19613749</link>
    <guid>ac279bb9fd354533ef538d311b4102d3</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/cmt/p/19613749" title="åå¸äº 2026-02-13 22:43">
    <span role="heading" aria-level="2">åå¸å­å­çç¬¬ä¸ä¸ªBç«è§é¢ï¼æåç¥å¤§å®¶æ¥èå¿«ä¹ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å­å­å¥é©»Bç«å¦ï¼ä»å¤©åå¸äºç¬¬ä¸ä¸ªè§é¢ï¼æåç¥å¤§å®¶é©¬å¹´æ¥èå¿«ä¹ï¼ç å°æåï¼æ¬¢è¿å¤§å®¶åå¾<a href="https://www.bilibili.com/video/BV1UVcEzJEUD/" target="_blank" rel="noopener nofollow">Bç«</a>æ§åºï¼</p>
<p><iframe src="https://player.bilibili.com/player.html?isOutside=true&amp;bvid=BV1UVcEzJEUD&amp;p=1&amp;autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="668" height="376"></iframe></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.5465277777777777" data-date-updated="2026-02-14 11:50">2026-02-13 22:43</span>&nbsp;
<a href="https://www.cnblogs.com/cmt">åå®¢å­å¢é</a>&nbsp;
éè¯»(<span id="post_view_count">343</span>)&nbsp;
è¯è®º(<span id="post_comment_count">5</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19613749);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19613749', targetLink: 'https://www.cnblogs.com/cmt/p/19613749', title: 'åå¸å­å­çç¬¬ä¸ä¸ªBç«è§é¢ï¼æåç¥å¤§å®¶æ¥èå¿«ä¹ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ç¡åè®²ä¸æ®µdockerç¼è¯éåçæäº ]]></title>
    <link>https://www.cnblogs.com/freephp/p/19613690</link>
    <guid>427ca62e72c05c52e9edf237bebf2526</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/freephp/p/19613690" title="åå¸äº 2026-02-13 22:31">
    <span role="heading" aria-level="2">ç¡åè®²ä¸æ®µdockerç¼è¯éåçæäº</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æè¿å¨åå¢éçå·¥ç¨å¸å¼åä¸äºåæ°é¡¹ç®ï¼æéè¦ææ¬å°é¡¹ç®æåædockeréåï¼å¹¶ä¸æ¨éå¾å°AWSäºæå¡ä¸çéåä»åºï¼ECRï¼ã<br>
æåå¥½Dockerfileä¹åå°±å¼å§åç¼è¯ï¼ç¶ååæ¨éãå½ä»¤å¦ä¸æç¤ºï¼</p>
<pre><code class="language-bash">docker build -t ai-service:latest .
docker tag ai-service:latest XXXXX.dkr.ecr.us-east-1.amazonaws.com/ai-service:latest
docker push XXXXX.dkr.ecr.us-east-1.amazonaws.com/ai-service:latest
</code></pre>
<p>ä¸åçä¼¼é¡ºå©ï¼ä½å½æä½¿ç¨è¿ä¸ªå®¹å¨éåæ¥åå»ºEC2ï¼æéæ©äºt3.microï¼çæ¶åï¼å´éå°äºéååç³»ç»å¹³å°ä¸å¼å®¹çæ¥éï¼å·ä½å¦ä¸æç¤ºï¼</p>
<pre><code class="language-bash">latest: Pulling from smart-inventory
no matching manifest for linux/amd64 in the manifest list entries
</code></pre>
<p>å¯ä»¥çåºEC2çç³»ç»æ¯linux/amd64çï¼èæçç¬è®°æ¬çµèæ¯MacOS M1è¯çï¼æ¯arm64çæ¶æãDockeré»è®¤ç¼è¯åºæ¥çéåæ¯åºäºæå¨å¹³å°çï¼ä¹å°±æ¯è¯´ç¨MacOS M1ç¼è¯åºçéåä¹æ¯armæ¶æã<br>
è§£å³è¿ä¸ªé®é¢ååç®åï¼Dockeræä¾äºå¼ºå¤§çbuildxå·¥å·ï¼å¯ä»¥å¨ç¼è¯çæ¶åæå®ç¼è¯åºçæ¶æã<br>
ä¾å¦ææ³ç¼è¯åºéålinxu/amd64çéåï¼å¯ä»¥ç¨å¦ä¸å½ä»¤ï¼</p>
<pre><code class="language-bash">docker buildx build --platform linux/amd64 -t ai-service:latest .
</code></pre>
<p>è¿æ ·ç¼è¯åºæ¥çéåå°±è½å¨linux/amd64æ¶æçæºå¨ä¸è¿è¡äºã</p>
<p>ä»ç»åæ³ä¸æ³ï¼ä¸ºä»ä¹ä¹åææ²¡æéå°è¿ä¸ªé®é¢å¢ï¼<br>
åå æ¯å ä¸ºæå¹¶ä¸æ¯ç´æ¥å¨ææ¬å°çµèä¸ç¼è¯éåå¹¶æ¨éå°è¿ç«¯éååºçï¼æä»¬éå¸¸æ¯éè¿æç»­éæç³»ç»ï¼CI/CDï¼æ¥å®æçãå¨CI/CDæµç¨ä¸­ï¼æä»¬ä½¿ç¨çæ¯amd64æ¶æçèææºæ¥å®æéåç¼è¯ï¼è¿æ ·ç¼è¯åºçéåé½æ¯amd64çã<br>
æä»¥å¦ææè¦åæå¨æ¬å°ç¼è¯éåæ¥æ¨éï¼åéè¦åå¤æ­å½åç³»ç»æ¯å¦æ¯MacOSï¼å¦ææ¯ï¼åä½¿ç¨â--platform linux/amd64âåæ°å®æç¼è¯å³å¯ï¼ç¨Pythonå®ç°å¦ä¸æç¤ºï¼</p>
<pre><code class="language-python">  if os.name == 'posix' and 'darwin' in os.uname().sysname.lower():
            # On macOS, build for linux/amd64 platform
            build_cmd = ["docker", "buildx", "build", "--platform", "linux/amd64", "-t", image_name, "."]
        else:
            build_cmd = ["docker", "build", "-t", image_name, "."]
</code></pre>
<p>æ¯æ¬¡éå°é®é¢ï¼ææ»æ¯æ³å¤æèä¸ä¸èåçåå ï¼æç¹åæéç¿ä¸æ ·ï¼æ¶è·è®å¤§ã</p>
<p>çé³æè¯´ï¼<strong>äººé¡»å¨äºä¸ç£¨ï¼æ¹ç«å¾ä½ï¼æ¹è½éäº¦å®ï¼å¨äº¦å®ã</strong></p>
<p>æè¿éè¦ç»§ç»­ç£¨å±ï¼ç»§ç»­ä¸ç ï¼æäºå¿åå¥½ãèµ°å¥½èä¸è·¯çï¼æè½æå¥½æªæ¥ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.019444444444444445" data-date-updated="2026-02-13 22:59">2026-02-13 22:31</span>&nbsp;
<a href="https://www.cnblogs.com/freephp">freephp</a>&nbsp;
éè¯»(<span id="post_view_count">96</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19613690);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19613690', targetLink: 'https://www.cnblogs.com/freephp/p/19613690', title: 'ç¡åè®²ä¸æ®µdockerç¼è¯éåçæäº' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ MAFå¿«éå¥é¨ï¼16ï¼ç¨æ·æºè½ä½äº¤äºåè®®AG-UIï¼ä¸ï¼ ]]></title>
    <link>https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper16</link>
    <guid>640285e3b7654c624be4d7e1b173d2f1</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper16" title="åå¸äº 2026-02-13 22:27">
    <span role="heading" aria-level="2">MAFå¿«éå¥é¨ï¼16ï¼ç¨æ·æºè½ä½äº¤äºåè®®AG-UIï¼ä¸ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/381412/202602/381412-20260213222607884-1836311076.png" alt="MAFå¿«éå¥é¨ï¼16ï¼ç¨æ·æºè½ä½äº¤äºåè®®AG-UIï¼ä¸ï¼" class="desc_img">
        AG-UI å¨ç§° AgentâUser Interaction Protocol å³ æºè½ä½-ç¨æ· äº¤äºåè®®ï¼è¿æ¯ä¸ä¸ªå¼æ¾çãåºäºäºä»¶çåè®®ï¼ç± CopilotKit å¢éåèµ·ï¼ç¨äºæ åå AI Agent ä¸ ç¨æ·çé¢ çå®æ¶äº¤äºãæ¬æä»ç»äºAG-UIåè®®çåºæ¬æ¦å¿µï¼ä¸ºä»ä¹ä¼åºç°AG-UIåè®®ï¼AG-UIåMCPï¼A2Açå¯¹æ¯ï¼éåä»ç»äºå¦ä½å¨MAFä¸­å¿«éå¼åä¸ä¸ªåºäºAG-UIçå¯¹è¯åºç¨ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>å¤§å®¶å¥½ï¼ææ¯Edisonã</p>
<p>æè¿æä¸ç´å¨è·çå£æ°çã<a class="normal_text_link mp_article_text_link" href="https://mp.weixin.qq.com/s?__biz=MzA4NzQzNTg4Ng==&amp;mid=2651744458&amp;idx=1&amp;sn=139f7584e81aeecd0945133bdc2b4791&amp;scene=21#wechat_redirect" rel="noopener nofollow" target="_blank" data-itemshowtype="0" data-linktype="2">.NET+AIæºè½ä½å¼åè¿é¶</a>ãè¯¾ç¨å­¦ä¹ MAFå¼åå¤æºè½ä½å·¥ä½æµï¼æå¼ºçæ¨èä½ ä¹ä¸è½¦è·æä¸èµ·åºåï¼</p>
<p><a class="normal_text_link mp_article_text_link" href="https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper15" target="_blank" data-itemshowtype="0" data-linktype="2">ä¸ä¸ç¯</a>ï¼<span><span>æä»¬å­¦ä¹ äºMAFä¸­<span>å¿«éè°è¯çå©å¨DevUI<span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;padding: 0px;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.544px;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;font-family: -apple-system-font, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;min-height: 1em;text-align: justify;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-align: left;caret-color: var(--weui-BRAND);&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>ãæ¬ç¯ï¼æä»¬æ¥äºè§£ä¸ä¸ªç¨æ·æºè½ä½äº¤äºåè®®ï¼AG-UIã</span></span></span></span></span></p>
<h1><strong>1 ä»ä¹æ¯AG-UI</strong></h1>
<p><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;padding: 0px;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.544px;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;font-family: -apple-system-font, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;min-height: 1em;text-align: justify;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-align: left;caret-color: var(--weui-BRAND);&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span data-pm-slice="0 0 []"><span><span>AG-UI å¨ç§°&nbsp;<strong data-pm-slice="0 0 []"><span><span>AgentâUser Interaction Protocol&nbsp;<span><span>å³&nbsp;<span>æºè½ä½-ç¨æ· äº¤äºåè®®<span>ï¼</span></span></span></span></span></span></strong>è¿æ¯ä¸ä¸ªå¼æ¾çãåºäºäºä»¶çåè®®ï¼ç± CopilotKit å¢éåèµ·ï¼ç¨äºæ åå AI Agent ä¸ ç¨æ·çé¢ çå®æ¶äº¤äºã</span></span></span></span></span></span></span></span></p>
<h3><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;padding: 0px;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.544px;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;font-family: -apple-system-font, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;min-height: 1em;text-align: justify;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-align: left;caret-color: var(--weui-BRAND);&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>ä¸ºä»ä¹åºç°AG-UIåè®®ï¼</span></span></span></span></span></h3>
<p><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;padding: 0px;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.544px;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;font-family: -apple-system-font, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;min-height: 1em;text-align: justify;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-align: left;caret-color: var(--weui-BRAND);&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span>è¿æ¯å ä¸ºå¨æå»ºAI Agentåºç¨ççé¢æ¶ï¼ä¼ ç»APIæ¨¡å¼é¢ä¸´å¾å¤é®é¢åææï¼</span></span></span></span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202602/381412-20260213222047426-1470758576.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<p><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;padding: 0px;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.544px;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;font-family: -apple-system-font, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;min-height: 1em;text-align: justify;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-align: left;caret-color: var(--weui-BRAND);&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span><span>èAG-UIåæ¯ä¸é¨ä¸ºAI Agentä¸ç¨æ·çé¢çäº¤äºèè®¾è®¡çåè®®ï¼å¶æ ¸å¿ä»·å¼ä½ç°å¨ï¼</span></span></span></span></span></span></span></p>
<ul class="list-paddingleft-1">
<li>
<p><span>ð¡&nbsp;<strong>å®æ¶æµå¼ååº</strong><span>ï¼å³æ¶å±ç¤º Agent è¾åºï¼æ éç­å¾</span></span></p>
</li>
<li>
<p><span>ð¯&nbsp;<strong>äºä»¶é©±å¨æ¶æ</strong><span>ï¼ç»ç²åº¦çäº¤äºäºä»¶ï¼ç²¾ç¡®æ§å¶ UI</span></span></p>
</li>
<li>
<p><span>ð&nbsp;<strong>ç¶æåæ­¥æºå¶</strong><span>ï¼Snapshot/Delta æ¨¡å¼ï¼ä¿æ UI ä¸ Agent ç¶æä¸è´</span></span></p>
</li>
<li>
<p><span>ð§&nbsp;<strong>å·¥å·è°ç¨å¯è§å</strong><span>ï¼éæå±ç¤º Agent çæèåè¡å¨è¿ç¨</span></span></p>
</li>
</ul>
<h3><span><span><span><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;padding: 0px;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.544px;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;font-family: -apple-system-font, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;min-height: 1em;text-align: justify;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-align: left;caret-color: var(--weui-BRAND);&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span><span><span>ä¸å¤§Agentåè®®å¯¹æ¯</span></span></span></span></span></span></span></h3>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;padding: 0px;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.544px;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;font-family: -apple-system-font, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;min-height: 1em;text-align: justify;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-align: left;caret-color: var(--weui-BRAND);&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">æä»¬ä¹åå·²ç»å­¦ä¹ äºMCP å A2Aä¸¤ä¸ªéè¦çåè®®äºï¼å ä¸AG-UIï¼å®ä»¬å±åç»æäºAgentçä¸å¤§éä¿¡åè®®ä½ç³»ã</span></p>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;padding: 0px;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.544px;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;font-family: -apple-system-font, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;min-height: 1em;text-align: justify;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-align: left;caret-color: var(--weui-BRAND);&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ä¸è¿ï¼å®ä»¬çå®ä½åæä¾§éï¼å¹¶ééæ­¤å³å½¼ï¼èæ¯ååä½¿ç¨ï¼ç¨å½¢è±¡çæ¯å»æ¥è®²ï¼</span></p>
<p data-pm-slice="0 0 []"><strong><span><span>AG-UI åæ¯"å®¢æçªå£"ï¼</span></span></strong></p>
<ul class="list-paddingleft-1">
<li>
<p><span><span>ç¨æ·ä¸ Agent ä¹é´çäº¤äºçé¢</span></span></p>
</li>
<li>
<p><span><span>å®æ¶å±ç¤º Agent çå·¥ä½ç¶æ</span></span></p>
</li>
<li>
<p><span><span>æ¯æç¨æ·è¾å¥ååé¦</span></span></p>
</li>
</ul>
<p><strong><span><span>MCP åæ¯"å·¥å·ç®±"ï¼</span></span></strong></p>
<ul class="list-paddingleft-1">
<li>
<p><span><span>Agent è°ç¨å¤é¨å·¥å·å®æä»»å¡</span></span></p>
</li>
<li>
<p><span><span>å·¥å·æ¯è¢«å¨çï¼ç­å¾è°ç¨</span></span></p>
</li>
<li>
<p><span><span>æ©å± Agent çè½åè¾¹ç</span></span></p>
</li>
</ul>
<p><strong><span><span>A2A åæ¯"åäºåä½"ï¼</span></span></strong></p>
<ul class="list-paddingleft-1">
<li>
<p><span><span>å¤ä¸ª Agent ä¹é´çä»»å¡åå</span></span></p>
</li>
<li>
<p><span><span>æ¯ä¸ª Agent é½æ¯èªä¸»ç</span></span></p>
</li>
<li>
<p><span><span>å¯ä»¥äºç¸å§æååä½</span></span></p>
</li>
</ul>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;padding: 0px;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.544px;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;font-family: -apple-system-font, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;min-height: 1em;text-align: justify;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-align: left;caret-color: var(--weui-BRAND);&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span data-lark-record-format="docx/record"><span data-lark-record-format="docx/record">å¨å®éä¼ä¸åºæ¯ä¸­ï¼<strong data-pm-slice="0 0 []"><strong data-pm-slice="0 0 []"><span><span>ä¸å¤§åè®®éå¸¸ååä½¿ç¨ï¼</span></span></strong></strong></span></span></span></p>
<ul class="list-paddingleft-1">
<li>
<p><strong>AG-UI</strong><span>ï¼ç¨æ·éè¿çé¢ä¸ä¸» Agent äº¤äº</span></p>
</li>
<li>
<p><strong>MCP</strong><span>ï¼Agent åé¨ä½¿ç¨ MCP è°ç¨å·¥å·</span></p>
</li>
<li>
<p><strong>A2A</strong><span>ï¼å¤æä»»å¡å§æç»ä¸å®¶ Agent å¤ç</span></p>
</li>
</ul>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;padding: 0px;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.544px;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;font-family: -apple-system-font, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;min-height: 1em;text-align: justify;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-align: left;caret-color: var(--weui-BRAND);&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span data-lark-record-format="docx/record"><span data-lark-record-format="docx/record">ä¸å¾å±ç¤ºäºä¸å¤§åè®®çè¯¦ç»å¯¹æ¯ï¼</span></span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202602/381412-20260213222138115-952680249.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<h1><strong><span>2 å¿«éå¼å§ï¼AG-UIå¯¹è¯åºç¨<strong><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;section&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;letter-spacing: 0.578px;text-align: left;margin: 8px;&quot;,&quot;data-pm-slice&quot;:&quot;6 3 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;outline: 0px;visibility: visible;line-height: 1.75em;margin-top: 16px;margin-bottom: 16px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;color: rgb(0, 179, 139);font-family: \&quot;PingFang SC\&quot;, \&quot;Lantinghei SC\&quot;, \&quot;Microsoft Yahei\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft Sans Serif\&quot;, \&quot;WenQuanYi Micro Hei\&quot;, Helvetica, sans-serif;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;letter-spacing: 0.544px;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><br></span></strong></span></strong></h1>
<p data-pm-slice="0 0 []">AG-UIåè®®å®ä¹äºæ¸æ°çæ¶æç»ä»¶ï¼åæ¬ ServerãClient å Agentã</p>
<p data-pm-slice="0 0 []">å¨MAFä¸­æä¾äºä¸ä¸ªåç½®çAG-UIç»ä»¶ï¼æä»¬å¯ä»¥éå¸¸æ¹ä¾¿å°åå»ºéæAG-UIçAgentåºç¨ã</p>
<p data-pm-slice="0 0 []">æ¥ä¸æ¥ï¼æä»¬å°±ä¸æ­¥ä¸æ­¥å®æä¸ä¸ªAG-UIå¯¹è¯åºç¨æ¶åå°çServer å Clientã</p>
<h3 data-pm-slice="0 0 []">AG-UI Server</h3>
<p data-pm-slice="0 0 []">é¦åï¼æä»¬åå»ºä¸ä¸ªASP.NET Webåºç¨ï¼å®è£ä»¥ä¸NuGetåï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">Microsoft.Agents.AI.Hosting.AGUI.AspNetCore
Microsoft.Agents.AI.OpenAI
Microsoft.Extensions.AI.OpenAI</span></pre>
</div>
<p data-pm-slice="0 0 []">ç¶åï¼å°±æ¯æ´ä¸ªç¤ºä¾çæ ¸å¿é¨åï¼æä»¬ä¸åä¸åæ¥è¯´ï¼</p>
<p>ï¼1ï¼åå»ºåºç¨å¹¶æ³¨åAG-UIæå¡</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Step0. Create WebApplication builder</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> builder =<span style="color: rgba(0, 0, 0, 1)"> WebApplication.CreateBuilder(args);
builder.Services.AddHttpClient().AddLogging();

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Step1. Register AG-UI services</span>
builder.Services.AddAGUI();</pre>
</div>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;margin: 8px;padding: 0px;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.544px;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;font-family: -apple-system-font, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;min-height: 1em;text-align: justify;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;span&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;font-family: system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;PingFang SC\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.544px;text-align: left;caret-color: var(--weui-BRAND);&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ï¼2ï¼åå»ºä¸ä¸ªAI Agentï¼</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">var</span> app =<span style="color: rgba(0, 0, 0, 1)"> builder.Build();

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Step2. Load Configuration</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> config = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ConfigurationBuilder()
    .AddJsonFile($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">appsettings.json</span><span style="color: rgba(128, 0, 0, 1)">"</span>, optional: <span style="color: rgba(0, 0, 255, 1)">false</span>, reloadOnChange: <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">)
    .AddJsonFile($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">appsettings.{Environment.GetEnvironmentVariable(</span><span style="color: rgba(128, 0, 0, 1)">"</span>ASPNETCORE_ENVIRONMENT<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">)}.json</span><span style="color: rgba(128, 0, 0, 1)">"</span>, optional: <span style="color: rgba(0, 0, 255, 1)">true</span>, reloadOnChange: <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">)
    .Build();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> openAIProvider = config.GetSection(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">OpenAI</span><span style="color: rgba(128, 0, 0, 1)">"</span>).Get&lt;OpenAIProvider&gt;<span style="color: rgba(0, 0, 0, 1)">();

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Step3. Create one ChatClient</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> chatClient = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> OpenAIClient(
        </span><span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ApiKeyCredential(openAIProvider.ApiKey),
        </span><span style="color: rgba(0, 0, 255, 1)">new</span> OpenAIClientOptions { Endpoint = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> Uri(openAIProvider.Endpoint) })
    .GetChatClient(openAIProvider.ModelId)
    .AsIChatClient();

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Step4. Create one AI Agent</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> agent =<span style="color: rgba(0, 0, 0, 1)"> chatClient.AsAIAgent(
    name: </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">AGUI-Assistant</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
    instructions: </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä½ æ¯ä¸ä¸ªåå¥½çAIå©æï¼è¯·ä½¿ç¨ä¸­æåç­ç¨æ·çé®é¢ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">â AI Agent åå»ºæå</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 8px 0px;padding: 0px;outline: 0px;max-width: 100%;clear: both;min-height: 1em;color: rgba(0, 0, 0, 0.9);font-family: \&quot;PingFang SC\&quot;, system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.578px;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;line-height: 1.75em;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);padding: 0px;outline: 0px;max-width: 100%;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ï¼3ï¼æ å°AGUIç«¯ç¹å¹¶å¯å¨åºç¨ï¼</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Step5. Mapping AG-UI Endpoints</span>
app.MapAGUI(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">/</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, agent);

Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââââââââââââââââ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð AG-UI Server å·²å¯å¨</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð ç«¯ç¹å°å: https://localhost:8443/</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð¡ ä½¿ç¨ Ctrl+C åæ­¢æå¡</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââââââââââââââââ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

app.Run();</span></pre>
</div>
<p>å¯ä»¥çå°ï¼æä»¬ä»ç¨ä¸è¡ä»£ç  app.MapAGUI() å°±å¯ç¨äºAG-UIåè®®ï¼So Easy!</p>
<p><span><span>å¯å¨èµ·æ¥çææå¦ä¸å¾æç¤ºï¼</span></span></p>
<p><img src="https://img2024.cnblogs.com/blog/381412/202602/381412-20260213222325381-1327622437.png" alt="image" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></p>
<h3><strong><span><span>AG-UI Client</span></span></strong></h3>
<p>é¦åï¼æä»¬åå»ºä¸ä¸ªæ§å¶å°åºç¨ï¼å®è£ä»¥ä¸NuGetåï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 0, 1)">Microsoft.Agents.AI.AGUI
Microsoft.Agents.AI</span></pre>
</div>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 8px 0px;padding: 0px;outline: 0px;max-width: 100%;clear: both;min-height: 1em;color: rgba(0, 0, 0, 0.9);font-family: \&quot;PingFang SC\&quot;, system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.578px;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;line-height: 1.75em;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);padding: 0px;outline: 0px;max-width: 100%;visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 8px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;clear: both;min-height: 1em;color: rgba(0, 0, 0, 0.9);font-family: \&quot;PingFang SC\&quot;, system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.578px;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;line-height: 1.75em;visibility: visible;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;visibility: visible;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ç¶åï¼æä»¬åå»ºAG-UI Client å AI Agentï¼</span></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Load Configuration</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> config = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ConfigurationBuilder()
    .AddJsonFile($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">appsettings.json</span><span style="color: rgba(128, 0, 0, 1)">"</span>, optional: <span style="color: rgba(0, 0, 255, 1)">false</span>, reloadOnChange: <span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">)
    .Build();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> openAIProvider = config.GetSection(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">OpenAI</span><span style="color: rgba(128, 0, 0, 1)">"</span>).Get&lt;OpenAIProvider&gt;<span style="color: rgba(0, 0, 0, 1)">();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> serverEndpoint = config.GetValue&lt;<span style="color: rgba(0, 0, 255, 1)">string</span>&gt;(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">AGUI_SERVER_URL</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
    </span>?? <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">https://localhost:8443</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">;
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââââââââââââââââ</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð AG-UI å®¢æ·ç«¯å·²å¯å¨</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð æå¡ç«¯å°å: {serverEndpoint}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ââââââââââââââââââââââââââââââââââââââââââââââ\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Step1. Create HTTP Client</span>
<span style="color: rgba(0, 0, 255, 1)">using</span> HttpClient httpClient = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">()
{
    Timeout </span>= TimeSpan.FromSeconds(<span style="color: rgba(128, 0, 128, 1)">60</span><span style="color: rgba(0, 0, 0, 1)">)
};
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Step2. Create AG-UI Client</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> chatClient = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> AGUIChatClient(httpClient, serverEndpoint);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Step3. Create AI Agent</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> agent =<span style="color: rgba(0, 0, 0, 1)"> chatClient.AsAIAgent(
    name: </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">agui-client</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
    description: </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">AG-UI Client Agent</span><span style="color: rgba(128, 0, 0, 1)">"</span>);</pre>
</div>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 8px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;clear: both;min-height: 1em;color: rgba(0, 0, 0, 0.9);font-family: \&quot;PingFang SC\&quot;, system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.578px;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;line-height: 1.75em;visibility: visible;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;visibility: visible;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">ç¶åï¼åå¤å¼å§å¯¹è¯ï¼</span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Step4. Prepare for Conversation</span>
<span style="color: rgba(0, 0, 255, 1)">var</span> session = <span style="color: rgba(0, 0, 255, 1)">await</span><span style="color: rgba(0, 0, 0, 1)"> agent.GetNewSessionAsync();
</span><span style="color: rgba(0, 0, 255, 1)">var</span> messages = <span style="color: rgba(0, 0, 255, 1)">new</span> List&lt;ChatMessage&gt;<span style="color: rgba(0, 0, 0, 1)">()
{
    </span><span style="color: rgba(0, 0, 255, 1)">new</span> ChatMessage(ChatRole.System, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ä½ æ¯ä¸ä¸ªåå¥½çAIå©æï¼ä½¿ç¨ä¸­æåç­ç¨æ·çé®é¢ã</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
};
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð¬ å¼å§å¯¹è¯ï¼è¾å¥ :q æ quit éåºï¼\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

</span><span style="color: rgba(0, 0, 255, 1)">while</span> (<span style="color: rgba(0, 0, 255, 1)">true</span><span style="color: rgba(0, 0, 0, 1)">)
{
    Console.Write(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð¤ ç¨æ·: </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">string</span>? message =<span style="color: rgba(0, 0, 0, 1)"> Console.ReadLine();
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (<span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.IsNullOrWhiteSpace(message)) 
        </span><span style="color: rgba(0, 0, 255, 1)">continue</span><span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (message <span style="color: rgba(0, 0, 255, 1)">is</span> <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">:q</span><span style="color: rgba(128, 0, 0, 1)">"</span> or <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">quit</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">) 
        </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ·»å ç¨æ·æ¶æ¯</span>
    messages.Add(<span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)"> ChatMessage(ChatRole.User, message));
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æµå¼æ¥æ¶ååº</span>
    Console.Write(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð¤ å©æ: </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">await</span> <span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> update <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> agent.RunStreamingAsync(messages, session))
    {
        </span><span style="color: rgba(0, 0, 255, 1)">foreach</span> (AIContent content <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> update.Contents)
        {
            </span><span style="color: rgba(0, 0, 255, 1)">switch</span><span style="color: rgba(0, 0, 0, 1)"> (content)
            {
                </span><span style="color: rgba(0, 0, 255, 1)">case</span><span style="color: rgba(0, 0, 0, 1)"> TextContent textContent:
                    Console.Write(textContent.Text);
                    </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
                </span><span style="color: rgba(0, 0, 255, 1)">case</span><span style="color: rgba(0, 0, 0, 1)"> UsageContent usageContent:
                    Console.WriteLine($</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\n[ð Tokens: {usageContent.Details.TotalTokenCount}]</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                    </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
                </span><span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">:
                    Console.Write(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Unknown content!</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
                    </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
            }
        }
    }
    Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
}
Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ð åè§ï¼</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
Console.ReadKey();</span></pre>
</div>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 8px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;clear: both;min-height: 1em;color: rgba(0, 0, 0, 0.9);font-family: \&quot;PingFang SC\&quot;, system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.578px;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;line-height: 1.75em;visibility: visible;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;visibility: visible;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">æç»çè°è¯ææå¦ä¸å¾æç¤ºï¼</span></p>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 8px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;clear: both;min-height: 1em;color: rgba(0, 0, 0, 0.9);font-family: \&quot;PingFang SC\&quot;, system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.578px;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;line-height: 1.75em;visibility: visible;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;visibility: visible;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><img src="https://img2024.cnblogs.com/blog/381412/202602/381412-20260213222507160-684244773.gif" alt="agui-gif-demo-001" loading="lazy" style="display: block; margin-left: auto; margin-right: auto"></span></p>
<p data-pm-slice="0 0 []"><span><span>å¯ä»¥çå°ï¼æä»¬å¾å®¹æå°±åå»ºäºä¸ä¸ªç¨æ·åå¥½çå¯¹è¯å®¢æ·ç«¯ï¼å®æ¶çæµå¼ååºä¹ä¸éè¦æä»¬åè¿å¤ä»£ç å®ç°ã</span></span></p>
<h1><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 8px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;clear: both;min-height: 1em;color: rgba(0, 0, 0, 0.9);font-family: \&quot;PingFang SC\&quot;, system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.578px;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;line-height: 1.75em;visibility: visible;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;visibility: visible;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]"><strong><span>3 å°ç»</span></strong></span></h1>
<p><span data-pm-slice="1 1 [&quot;para&quot;,{&quot;tagName&quot;:&quot;p&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 8px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;clear: both;min-height: 1em;color: rgba(0, 0, 0, 0.9);font-family: \&quot;PingFang SC\&quot;, system-ui, -apple-system, BlinkMacSystemFont, \&quot;Helvetica Neue\&quot;, \&quot;Hiragino Sans GB\&quot;, \&quot;Microsoft YaHei UI\&quot;, \&quot;Microsoft YaHei\&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: 0.578px;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;white-space: normal;background-color: rgb(255, 255, 255);text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;line-height: 1.75em;visibility: visible;&quot;,&quot;data-pm-slice&quot;:&quot;0 0 []&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;},&quot;node&quot;,{&quot;tagName&quot;:&quot;strong&quot;,&quot;attributes&quot;:{&quot;style&quot;:&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;visibility: visible;&quot;},&quot;namespaceURI&quot;:&quot;http://www.w3.org/1999/xhtml&quot;}]">æ¬æä»ç»äºAG-UIåè®®çåºæ¬æ¦å¿µï¼ä¸ºä»ä¹ä¼åºç°AG-UIåè®®ï¼AG-UIåMCPï¼A2Açå¯¹æ¯ï¼éåä»ç»äºå¦ä½å¨MAFä¸­å¿«éå¼åä¸ä¸ªåºäºAG-UIçå¯¹è¯åºç¨ã</span></p>
<h1>ç¤ºä¾æºç </h1>
<p>GitHub:&nbsp;<a href="https://github.com/EdisonTalk/MAFD" target="_blank" rel="noopener nofollow">https://github.com/EdisonTalk/MAFD</a></p>
<h1>åèèµæ</h1>
<p><span data-pm-slice="0 0 []"><span>å£æ°ï¼ã<a href="https://www.cnblogs.com/sheng-jie/p/19200934" target="_blank">.NET + AI æºè½ä½å¼åè¿é¶</a>ãï¼æ¨èææ°ï¼âââââï¼</span></span></p>
<p><span data-pm-slice="0 0 []"><span>Microsoft Learnï¼<span>ã<a href="https://learn.microsoft.com/en-us/agent-framework/overview/agent-framework-overview?wt.mc_id=MVP_397012" target="_blank" rel="noopener nofollow">Agent Framework Tutorials</a>ã</span></span></span></p>
<div><span data-pm-slice="0 0 []"><span>&nbsp;</span></span></div>
<p style="text-align: center"><img src="https://images.cnblogs.com/cnblogs_com/edisonchou/1647700/o_200902144330EdisonTalk-Footer.jpg" alt="" style="width: 65%; border: 1px solid rgba(221, 221, 221, 1); border-radius: 3px; box-shadow: 0 4px 8px rgba(3, 27, 78, 0.12)"></p>
<div id="Copyright">
<p>ä½èï¼<span style="text-decoration: underline">ç±è¿ªç</span></p>
<p>åºå¤ï¼<a title="from" href="https://edisontalk.cnblogs.com" target="_blank">https://edisontalk.cnblogs.com</a></p>
<p>æ¬æçæå½ä½èååå®¢å­å±æï¼æ¬¢è¿è½¬è½½ï¼ä½æªç»ä½èåæå¿é¡»ä¿çæ­¤æ®µå£°æï¼ä¸å¨æç« é¡µé¢ææ¾ä½ç½®ç»åºåæé¾æ¥ã</p>
</div>

</div>
<div id="MySignature" role="contentinfo">
    <div align="center"><a href="https://weibo.com/u/2068032061?s=6uyXnP" target="_blank"><img border="0" src="http://service.t.sina.com.cn/widget/qmd/2068032061/d643d182/10.png"></a></div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 22:27">2026-02-13 22:27</span>&nbsp;
<a href="https://www.cnblogs.com/edisontalk">EdisonZhou</a>&nbsp;
éè¯»(<span id="post_view_count">36</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19613733);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19613733', targetLink: 'https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper16', title: 'MAFå¿«éå¥é¨ï¼16ï¼ç¨æ·æºè½ä½äº¤äºåè®®AG-UIï¼ä¸ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æ¶èï¼RAGæ ¸å¿å·¥å·å¤§å¨: 7å¤§è§£æå·¥å·+åéæ¨¡å+æ°æ®åº+æ£ç´¢æåº ]]></title>
    <link>https://www.cnblogs.com/aifrontiers/p/19613559</link>
    <guid>62ddbc62e2ba75fc08ec5dcbfcafd59e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/aifrontiers/p/19613559" title="åå¸äº 2026-02-13 21:04">
    <span role="heading" aria-level="2">æ¶èï¼RAGæ ¸å¿å·¥å·å¤§å¨: 7å¤§è§£æå·¥å·+åéæ¨¡å+æ°æ®åº+æ£ç´¢æåº</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>åæ: <a href="https://mp.weixin.qq.com/s/5XAWHqjZspU9xtC_CckV3w" target="_blank" rel="noopener nofollow">https://mp.weixin.qq.com/s/5XAWHqjZspU9xtC_CckV3w</a></p>
<p><strong>å³æ³¨gzh: AI-Frontiers</strong></p>
<p><strong>RAGå¾ææç« æ¨è</strong></p>
<p><a href="https://mp.weixin.qq.com/s/VV29xpdOMEkbz4iXmD_szg" target="_blank" rel="noopener nofollow">RAGææå·®ï¼7ä¸ªææ è®©ä½ çåç¡®çå¤§å¹æå</a></p>
<p><a href="https://mp.weixin.qq.com/s/am89yasxAvuYUToEAWNyTA" target="_blank" rel="noopener nofollow">RAGè¯æµå®æ´æåï¼ææ ãæµè¯åæä½³å®è·µ</a></p>
<p>æ£ç´¢å¢å¼ºçæï¼Retrieval-Augmented Generation, RAGï¼æ¶æå·²æä¸ºLLMè½å°ä¼ä¸çº§åºç¨çæ ¸å¿èå¼ãä½ï¼å¨å®éé¨ç½²ä¸­ï¼æ®éé¢ä¸´ãåå¾è¿ï¼åå¾åºãï¼Garbage In, Garbage Outï¼çå°å¢ãRAGç³»ç»çä¸éå¾å¾ä¸ç±æ¨¡åï¼å¦GPT-4æDeepSeek-V3ï¼å³å®ï¼èæ¯ç±ä¸æ¸¸çæ°æ®å¤çæµæ°´çº¿ï¼ETL Pipelineï¼æéå¶ã</p>
<p>æ¬ææ¨å¨å¯¹æå»ºé«æ§è½å¼æºRAGç³»ç»çå³é®æ¨¡åè¿è¡è¯¦å°½çææ¯æè§£ï¼å¹¶éå¸¦æææ ¸å¿å·¥å·çGitHubãå®æ¹ææ¡£åæ¨¡åä¸è½½å°åãæä»¬å°æ·±å¥åæä¸å¤§ä¸»æµå¼æºè§£æå·¥å·ï¼Unstructured, Marker, PyMuPDF, Docling, MinerU, PaddleOCR, DeepSeek-OCRï¼çæ¶æåçä¸æ§è½ç¹å¾ãéåï¼å°æ²¿çæ°æ®æµåï¼ç³»ç»æ§æ¢³çååãåéåãæ£ç´¢åæåºç­ä¸æ¸¸æ¨¡åçææ°å¼æºææ¯è¿å±ï¼æå¨ä¸ºæå»ºä¼ä¸çº§ãé«ç²¾åº¦çRAGç³»ç»æä¾çè®ºä¾æ®ä¸å®æåèã</p>
<h1 id="æ ¸å¿æ¨¡åæ·±åº¦è§£æææ¡£è§£æä¸çé¢åæ">æ ¸å¿æ¨¡åæ·±åº¦è§£æï¼ææ¡£è§£æä¸çé¢åæ</h1>
<p>ææ¡£è§£ææ¨¡åçä»»å¡æ¯å°éç»æåçææ¡£ï¼å¦PDF/Images/PPT/word/excelï¼è¿åä¸ºæºå¨å¯çè§£çç»æåææ¬ï¼å³Markdown/JSONãè¯¥è¿ç¨æ¶åOCRï¼Optical Character Recognitionï¼åå­¦å­ç¬¦è¯å«ï¼ãOLAï¼ Layout Analysisï¼çé¢åæï¼ãTSRï¼Table Structure Recognitionï¼è¡¨æ ¼ç»æè¯å«ï¼åéè¯»é¡ºåºéæç­å¤ä¸ªå¤æå­ä»»å¡ã</p>
<h2 id="unstructuredå¨è½åetlä¸­é´ä»¶æ¶æ">Unstructuredï¼å¨è½åETLä¸­é´ä»¶æ¶æ</h2>
<ul>
<li>
<p>å®æ¹ææ¡£: <a href="https://docs.unstructured.io/" target="_blank" rel="noopener nofollow">https://docs.unstructured.io</a></p>
</li>
<li>
<p>Github: <a href="https://github.com/Unstructured-IO/unstructured" target="_blank" rel="noopener nofollow">https://github.com/Unstructured-IO/unstructured</a></p>
</li>
<li>
<p><strong>éç¨åºæ¯:</strong> ä¼ä¸çº§éç¨ETLæµç¨ï¼å¤çå¤æºå¼ææ°æ®ï¼é®ä»¶ãåå¬ææ¡£ãPDFæ··åï¼</p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDhjMzhmOGM1NzY1YmFlOGE1M2NjNDhhM2VkMzllMWJfWnhrQVNCZFZaRDJHWFJNdm94WkdTcnFlZVYxV0RDMXVfVG9rZW46RENHemJYVjByb3RaTE94RnVZamNNMFZ1bkVLXzE3NzA5ODY2Mzc6MTc3MDk5MDIzN19WNA" class="lazyload"></p>
<p>ç®åRAGçæä¸­è¦çé¢æå¹¿çéç¨ETLæ¡æ¶ï¼å¶è®¾è®¡å²å­¦æ¯æä¾ä¸ä¸ªæ ååçå½ä¸åå±ï¼å°åæ¬PDFãHTMLãEmailãPPTXå¨åç25ç§ä»¥ä¸å¼ææ ¼å¼è½¬æ¢ä¸ºç»ä¸çJSON Schema</p>
<p><strong>æ¶æåçä¸ååºç­ç¥</strong></p>
<p>Unstructuredçæ ¸å¿æ¯ååºæºå¶ï¼è¯¥æºå¶å¹¶éä¾èµåä¸æ¨¡åï¼èæ¯æ ¹æ®ææ¡£ç±»åå¨æå¹éä¸åå¤çç®¡çº¿ï¼</p>
<ul>
<li>
<p><strong>åºäºè§åçå¿«éè§£æï¼Fast Strategyï¼</strong>ï¼éå¯¹åçæ°å­PDFï¼éè¿pdfminer.sixç­åºå±åºç´æ¥æåææ¬æµï¼éåº¦å¿«ãCPUå¼éä½ï¼ä½æ æ³å¤çæ«æä»¶ï¼ä¸æä¸¢å¤±å¤æåæ éè¯»é¡ºåºï¼</p>
</li>
<li>
<p><strong>é«ç²¾åº¦è§è§è§£æï¼Hi-Res Strategyï¼</strong>ï¼ä½ä¸ºå¤çå¤æææ¡£çæ ¸å¿ï¼åå©YOLOX/Detectron2æ¶æçç®æ æ£æµæ¨¡åï¼å°é¡µé¢åå²ä¸ºæ é¢ãæ­£æãåè¡¨é¡¹ãè¡¨æ ¼ãå¾çç­è¯­ä¹åºåï¼è½ç²¾åè¯å«å¹¶åé¤é¡µçé¡µèï¼é¿åå¹²æ°RAG ä¸ä¸æï¼</p>
</li>
<li>
<p><strong>è¡¨æ ¼å¤çå­ç³»ç»</strong>ï¼æ£æµå°è¡¨æ ¼åºåæ¶è§¦åä¸å±è¯å«æ¨¡åï¼å¼æºçæ¬ä¾èµTesseract OCRæç®åHTMLè½¬æ¢ï¼åä¸ APIåéææ´é«çº§è§è§æ¨¡åæ¢å¤å¤æè¡åç»æã</p>
</li>
</ul>
<p><strong>å±éæ§ä¸çæä½åæ</strong></p>
<p>Unstructuredå æ ¼å¼æ¯æå¹¿æ³æä¸ºRAGåå­¦èé¦éï¼ä½å¼æºçä¸åä¸çæ§è½å·®è·æ¾èï¼å¼æºçç¼ºå°éå¯¹éèæ¥è¡¨ãå­¦æ¯è®ºæç­ç¹å®é¢åå¾®è°çOCRæ¨¡åï¼æ æ³ä½¿ç¨ææ°VLMï¼è§è§è¯­è¨æ¨¡åï¼åè½ï¼hi_resç­ç¥å¤çé¿ææ¡£è®¡ç®ææ¬é«ï¼ä¸ä¾èµTesseractä½ä¸ºOCRå¼æï¼å¤çéè±è¯­ææ¡£æ¶ç²¾åº¦åéãä¸è¿å¶æ ååçåæ°æ®è¾åºï¼å«ç¶å­èç¹å³ç³»ãé¡µç åæ ï¼ï¼ä¸ºä¸æ¸¸æ··åååæä¾äºä¼è´¨æ°æ®åºç¡ã</p>
<h2 id="markerä¸æ³¨äºç§å­¦æç®çé«ç²¾åº¦è½¬æ¢ç®¡çº¿">Markerï¼ä¸æ³¨äºç§å­¦æç®çé«ç²¾åº¦è½¬æ¢ç®¡çº¿</h2>
<ul>
<li>
<p>Github: <a href="https://github.com/VikParuchuri/marker" target="_blank" rel="noopener nofollow">https://github.com/VikParuchuri/marker</a></p>
</li>
<li>
<p>éç¨åºæ¯: å­¦æ¯è®ºæãæç§ä¹¦ãææ¯æåï¼å¬å¼/ä»£ç å¯éåææ¡£ï¼</p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWY5ZTRhMmE3YjM5NGQ0NDA3OGE3YmIyZjQ2YTA2ZTFfUkJ3NXZmWWxUaEQwSVpTaGhhbldqUGYwc2xOTlhQTTBfVG9rZW46TDk2OWJ6VXFsb0RZaXp4VmE0T2NHdzVPbktmXzE3NzA5ODY2Mzc6MTc3MDk5MDIzN19WNA" class="lazyload"></p>
<p>ç±Vik Paruchuriå¼åï¼ä¸ä¸ºå°PDFè½¬æ¢ä¸ºé«è´¨éMarkdownèè®¾è®¡ï¼ç¹å«éå¯¹æ°å­¦å¬å¼ãä»£ç ååå­¦æ¯æçè¿è¡äºæ·±åº¦ä¼åã</p>
<p><strong>æ·±åº¦å­¦ä¹ æµæ°´çº¿æºå¶</strong></p>
<ul>
<li>
<p><strong>Suryaçé¢åæ</strong>: ä½ä¸ºé«ç²¾åº¦OCRä¸çé¢åææ¨¡åï¼è½ç²¾åæ£æµææ¬è¡ãéè¯»é¡ºåºãåè¾¹çï¼è¿å¯éè¿è§è§ç¹å¾å¤æ­ææ¬é»è¾æµåï¼è§£å³å¤æ æçï¼å¦åæ è®ºæï¼çä¹±åºé®é¢ã</p>
</li>
<li>
<p><strong>Texifyå¬å¼å¼æ</strong>: éå¯¹ç§å­¦æç®çæ°å­¦å¬å¼çç¹ï¼å¯å°ä½å¾/PDFç»å¶æä»¤å½¢å¼çå¬å¼è½¬æ¢ä¸ºæ åLaTeXä»£ç ï¼è®©Markerå¤çarXivè®ºæãææ¯æåæ¶è¯­ä¹å®æ´æ§è¿è¶ä¼ ç»OCRã</p>
</li>
<li>
<p><strong>æ··å****OCR</strong>ï¼ä¼åæåPDFååµææ¬å±ä¿è¯éåº¦ï¼å¯¹å¬å¼åºå/æ«æå¾çèªå¨åæ¢è§è§æ¨¡åè¯å«ï¼å¼é¡¾ç²¾åº¦ä¸ååéã</p>
</li>
</ul>
<p><strong>å¢å¼ºçåå¤çä¸LLMèå</strong></p>
<p>Markeræ°å¢å¯é--use_llmåæ°ï¼å¯å¨åå¤çé¶æ®µè°ç¨è½»éçº§ LLMï¼å¦ Gemini Flashãæ¬å°æ¨¡åï¼ï¼è§£å³ææ¡£è§£æ ãæåä¸å¬éãé®é¢ï¼åå¹¶è·¨é¡µè¡¨æ ¼ãä¿®æ­£ OCR ä¹±ç ãä»å¤æè¡¨åæåç»æåé®å¼å¯¹ãæµè¯è¡¨æï¼å¼å¯LLMè¾å©åï¼Markerè¡¨æ ¼è¿ååº¦ä¼äºåä¸æ¨¡åã</p>
<h2 id="pymupdf-fitzæè´éåº¦çåºå±æµå¼è§£æ">PyMuPDF (Fitz)ï¼æè´éåº¦çåºå±æµå¼è§£æ</h2>
<ul>
<li>
<p>GitHub: <a href="https://github.com/pymupdf/PyMuPDF" target="_blank" rel="noopener nofollow">https://github.com/pymupdf/PyMuPDF</a></p>
</li>
<li>
<p>å®æ¹ææ¡£: <a href="https://pymupdf.readthedocs.io/" target="_blank" rel="noopener nofollow">https://pymupdf.readthedocs.io</a></p>
</li>
<li>
<p>éç¨åºæ¯: æµ·éåçæ°å­PDFæ¸æ´ï¼çº¯CPUç¯å¢ï¼å¯¹éåº¦è¦æ±æé«ï¼æ¯«ç§çº§ï¼çåºæ¯ã</p>
</li>
</ul>
<p>PyMuPDFæ¯MuPDFå¼æçPythonç»å®ï¼ä»£è¡¨äºææ¡£è§£æçå¦ä¸ä¸ªæç«¯ï¼æè´çå·¥ç¨åæçãä¸åºäºAIçè§è§æ¨¡åä¸åï¼PyMuPDFç´æ¥æä½PDFæä»¶çåé¨å¯¹è±¡ç»æåæ¸²ææµã</p>
<p><strong>ææ¬åä¸å­å¸æ¨¡å¼çææ¯åç</strong></p>
<p>PyMuPDFçæ ¸å¿è½åå¨äºå¶å¯¹PDFåºå±æä»¤çè§£æï¼</p>
<ul>
<li>
<p><code>get_text("blocks")</code>ï¼éè¿åæææ¬å¨é¡µé¢ä¸çç©çä½ç½®åæ ï¼å©ç¨å¯åå¼ç®æ³å°ç¸é»çææ¬è¡èç±»ä¸ºæ®µè½ï¼è¯¥æ¹æ³éåº¦æå¿«ï¼æ¯«ç§çº§ï¼ï¼ä½å¯¹æçççè§£æ¯æµå±çï¼å®¹æå°é¡µçé¡µèè¯¯å¤ä¸ºæ­£æã</p>
</li>
<li>
<p><code>get_text("dict")</code>ï¼æ´ä¸ºç²¾ç»çæåæ¨¡å¼ï¼è¿åä¸ä¸ªå±çº§åçJSONå¯¹è±¡ï¼<code>Page -&gt; Block -&gt; Line -&gt; Span -&gt; Char</code>ãå¶ä¸­ï¼Spanï¼ææ¬è·¨åº¦ï¼æ¯åå«ç¸åå­ä½ãå¤§å°åé¢è²çæå°ææ¬ååãè¿ä¸å±çº§ä¿¡æ¯å¯¹äºRAGè³å³éè¦ï¼å¼åèå¯ä»¥éè¿åæSpançå­ä½å¤§å°æ¥åºåæ é¢åæ­£æï¼æéè¿é¢è²è¿æ»¤ææ°´å°ã</p>
</li>
</ul>
<p><strong>å±éæ§ä¸éç¨åºæ¯</strong></p>
<p>PyMuPDFä¸æ¯ææ«æä»¶ï¼éå¤æ¥Tesseractï¼ï¼ä¹æ åçè¯­ä¹çè§£è½åï¼ä»è½è¯å«ææ¬ä½ç½®ï¼æ æ³åºåæè¦ãåèæç®ç­è¯­ä¹ï¼ãä½å¨å¤çæµ·éåçæ°å­åååãè´¢æ¥ãçµå­ä¹¦æ¶ï¼å¶çº¯CPUè¿è¡ãè¶é«ååéçä¼å¿ï¼ä½¿å¶æä¸ºæ¸æ´å¤§è§æ¨¡é¢è®­ç»è¯­æçé¦éï¼å¯¹äºç®åRAGåºç¨ï¼éè¿å®å¶Pythonèæ¬è¿æ»¤é¡µçé¡µèåï¼PyMuPDFçæ§ä»·æ¯ä¹æé«ã</p>
<h2 id="doclingibmçä¼ä¸çº§å¤æ¨¡æææ¡£çè§£æ¡æ¶">Doclingï¼IBMçä¼ä¸çº§å¤æ¨¡æææ¡£çè§£æ¡æ¶</h2>
<ul>
<li>
<p>GitHub: <a href="https://github.com/docling-project/docling" target="_blank" rel="noopener nofollow">https://github.com/docling-project/docling</a></p>
</li>
<li>
<p>å®æ¹ææ¡£: <a href="https://docling-project.github.io/docling/" target="_blank" rel="noopener nofollow">https://docling-project.github.io/docling/</a></p>
</li>
<li>
<p>Hugging Face: <a href="https://huggingface.co/ibm-granite/granite-docling-258M" target="_blank" rel="noopener nofollow">https://huggingface.co/ibm-granite/granite-docling-258M</a></p>
</li>
<li>
<p>éç¨åºæ¯: Agentic RAGï¼éè¦çè§£ææ¡£ç»æä¾Agentè°ç¨ï¼ï¼é«ç²¾åº¦è¡¨æ ¼è¿å</p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=MjExYTQ1N2QwOTdmZjEyYTY4ZTlhZGJlNWFlOTI1MDNfWncxcmpUUkhpWWxDSDlwWWJwc1gwOWJMekdRa2pBakVfVG9rZW46SFZyc2JyakZib3JhRXl4dHpDUGNvbHFrbjFmXzE3NzA5ODY2Mzc6MTc3MDk5MDIzN19WNA" class="lazyload"></p>
<p>Doclingæ¯IBM Researchæ¨åºçæ°ä¸ä»£ææ¡£å¤çåºï¼æ¨å¨æéä¼ ç»ææ¡£ä¸çæå¼AIçå£åï¼ç¹å«å¼ºè°å¯¹è¡¨æ ¼ç»æåææ¡£å±çº§çè¿åãDoclingä¸ä»ä»æ¯ä¸ä¸ªè§£æå¨ï¼å®ä¹äºä¸ç§ç»ä¸çææ¡£å¯¹è±¡æ¨¡åï¼æ¨å¨ä¸ºAgentic RAGï¼ä»£çå¼RAGï¼æä¾ç»æåæ¯æã</p>
<p><strong>ç»ä¸ææ¡£è¡¨ç¤ºä¸VLMéæ</strong></p>
<ul>
<li>
<p><strong>DoclingDocument å¯¹è±¡æ¨¡å</strong>ï¼å°PDFãDOCXãHTMLç­è¾å¥è½¬ä¸ºç»ä¸åé¨è¡¨ç¤ºï¼ä¿çSectionãGroupãBodyãFurnitureå±çº§ç»æï¼æ¯æRAGåºç¨ãåºäºç»æçååãï¼å¦ä»æ£ç´¢æå®ç« èè¡¨æ ¼ï¼èéç²ç®ææ¬åçã</p>
</li>
<li>
<p><strong>Granite VLMæµæ°´çº¿</strong>ï¼DoclingéæIBMèªç Graniteè§è§è¯­è¨æ¨¡åï¼ä»¥ç«¯å°ç«¯æ¹å¼çè§£é¡µé¢ï¼é¤æå­è½¬å½å¤ï¼è¿è½è§£æå¾è¡¨ï¼å¦å°æ±ç¶å¾/æçº¿å¾è½¬ä¸ºæ°æ®æè¿°ï¼ï¼éééèç æ¥åæéæ±ã</p>
</li>
<li>
<p>è¡¨æ ¼ç»ææ¢å¤ï¼éç¨TableFormerç­åä½ç®æ³ï¼é«ä¿çéå»ºå«åå¹¶ååæ ¼ãæ æ¡çº¿çå¤æè¡¨æ ¼ï¼æ¯æå¯¼åºä¸º HTML/Markdown æ ¼å¼ã</p>
</li>
</ul>
<p><strong>ä¸Agentçæçæ·±åº¦èå</strong></p>
<p>Doclingè®¾è®¡é«åº¦ééAgentic Workflowï¼æä¾MCPï¼Model Context Protocolï¼æå¡ï¼å¯è®©Claude Desktopç­ AIä»£çç´æ¥è°ç¨å¶ææ¡£è§£æè½åãå¨æå»ºå¤æRAG Agentæ¶ï¼Doclingå¯ä½ä¸ºå·¥å·è¢«å¨æè°ç¨ï¼æç¨æ·æå¾æåæå®ä¿¡æ¯ã</p>
<h2 id="mineru-pdf-extract-kité¢ållmè®­ç»çé«è´¨éè¯­ææ¸æ´">MinerU (PDF-Extract-Kit)ï¼é¢åLLMè®­ç»çé«è´¨éè¯­ææ¸æ´</h2>
<ul>
<li>
<p>GitHub: <a href="https://github.com/opendatalab/MinerU" target="_blank" rel="noopener nofollow">https://github.com/opendatalab/MinerU</a></p>
</li>
<li>
<p>HuggingFace: <a href="https://huggingface.co/opendatalab" target="_blank" rel="noopener nofollow">https://huggingface.co/opendatalab</a></p>
</li>
<li>
<p>å®æ¹ææ¡£: <a href="https://opendatalab.github.io/MinerU/" target="_blank" rel="noopener nofollow">https://opendatalab.github.io/MinerU/</a></p>
</li>
<li>
<p>éç¨åºæ¯: æå»ºé«è´¨éç¥è¯åºï¼å¤çåå«å¤ææ°å­¦ç¬¦å·ååæ æççå­¦æ¯æç®</p>
</li>
</ul>
<p>MinerUæ¯OpenDataLabï¼ä¸æµ·äººå·¥æºè½å®éªå®¤ï¼ä¸ºæ¯æInternLMï¼ä¹¦çÂ·æµ¦è¯­ï¼å¤§æ¨¡åé¢è®­ç»èå¼åçä¸ç¨å·¥å·ãå¶æ ¸å¿ç®æ æ¯ä»æå¤æçç§å­¦æç®ä¸­æååºé¶åªå£°ãè¯­ä¹è¿è´¯çMarkdownæ°æ®ã</p>
<p><strong>PDF-Extract-Kitä¸é«ç²¾åº¦ç®¡çº¿</strong></p>
<p>MinerUçåç«¯å¼æè¢«ç§°ä¸ºPDF-Extract-Kitï¼è¿æ¯ä¸ä¸ªéæäºå¤ç§SOTAæ¨¡åçç»¼åå·¥å·åï¼</p>
<ul>
<li>
<p><strong>å¸å±åæ</strong>ï¼å©ç¨åºäºYOLOæ¶ææ¹è¿çæ¨¡åï¼ç²¾ç¡®åºåæ­£æãæ é¢ãå¾çãè¡¨æ ¼ãèæ³¨åè¾¹æ³¨ãMinerUç¹å«å¼ºè°å¯¹è¾¹æ³¨åé¡µçé¡µèçåé¤ï¼ç¡®ä¿çæçMarkdownææ¬æµå¨è¯­ä¹ä¸æ¯è¿ç»­çï¼ä¸ä¼è¢«é¡µé¢åæ°æ®ææ­ã</p>
</li>
<li>
<p><strong>å¬å¼ä¸ç¬¦å·è½¬æ¢</strong>ï¼éå¯¹å­¦æ¯è®ºæä¸­çæ°å­¦ç¬¦å·ï¼MinerUåç½®äºå¼ºå¤§çè½¬æ¢é»è¾ï¼è½å¤å°å¤æçæ°å­¦è¡¨è¾¾å¼è¿åä¸ºLaTeXãè¿è§£å³äºä¼ ç»OCRå°"$$x^2$$"è¯å«ä¸º"x2"çå¸¸è§éè¯¯ï¼å¯¹äºæå»ºçå·¥ç§ç¥è¯åºå·æå³å®æ§æä¹ã</p>
</li>
<li>
<p><strong>ä¹±ç èªå¨æ£æµ</strong>ï¼å¨å¤çPDFæ¶ï¼ç»å¸¸éå°ç¼ç å´©åï¼Garbled Textï¼çæåµãMinerUåç½®äºèªå¨æ£æµæºå¶ï¼ä¸æ¦åç°ç´æ¥æåçææ¬ä¹±ç çè¿é«ï¼ä¼ç«å³æ ç¼åæ¢è³OCRæ¨¡å¼ï¼å©ç¨è§è§ä¿¡æ¯éæææ¬ï¼ä¿è¯äºæé«çå¬åç ã</p>
</li>
</ul>
<p><strong>äº§å­¦ç ç»åçå·¥ç¨ä¼å</strong></p>
<p>MinerUæ¯æCUDAå éï¼è¿ééåä¸ºæè¾NPUãApple Silicon MPSï¼ééæ§å¹¿æ³ï¼å¶ å¤æ¨¡æMarkdownè¾åºæ ¼å¼ä¿çå¾çå ä½ç¬¦å¹¶å³èé«åè¾¨çå¾åï¼éåæå»ºå¤æ¨¡æRAGï¼MM-RAGï¼ç³»ç»ã</p>
<h2 id="paddleocr-pp-structureå·¥ä¸çº§è¡¨æ ¼ä¸çé¢è¿å">PaddleOCR (PP-Structure)ï¼å·¥ä¸çº§è¡¨æ ¼ä¸çé¢è¿å</h2>
<ul>
<li>
<p>GitHub: <a href="https://github.com/PaddlePaddle/PaddleOCR" target="_blank" rel="noopener nofollow">https://github.com/PaddlePaddle/PaddleOCR</a></p>
</li>
<li>
<p>å®æ¹ææ¡£: <a href="https://paddlepaddle.github.io/PaddleOCR/" target="_blank" rel="noopener nofollow">https://paddlepaddle.github.io/PaddleOCR/</a></p>
</li>
<li>
<p>Hugging Face: <a href="https://huggingface.co/PaddlePaddle/PaddleOCR-VL" target="_blank" rel="noopener nofollow">https://huggingface.co/PaddlePaddle/PaddleOCR-VL</a></p>
</li>
<li>
<p>éç¨åºæ¯: éèæ¥è¡¨è¯å«ãç¥¨æ®å¤çãéè¦ç§æåé¨ç½²å°è¾¹ç¼è®¾å¤çåºæ¯ã</p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=YTBjZjgwMGQ5YjlhYjVlZDk5N2U2YmY4ZDgzYzI3ZTFfcVZJdEtSR05kRWZzUUVzR1BKVlh5eklXaTNiYjdhUnBfVG9rZW46TVprWWJzWUNkb0ZZd0l4MU9OQWM0Nm52bkFiXzE3NzA5ODY2Mzc6MTc3MDk5MDIzN19WNA" class="lazyload"></p>
<p>PaddleOCR æ¯ç¾åº¦é£æ¡¨ä½ç³»ä¸çææé¡¹ç®ï¼å¶PP-Structureæ¨¡åä»£è¡¨äºå·¥ä¸çå¨ææ¡£ç»æåé¢åçæé«æ°´å¹³ãä¸å­¦æ¯ççå®éªæ§æ¨¡åä¸åï¼PaddleOCRæå¶å¼ºè°æ¨¡åå¨æå¡å¨ãç§»å¨ç«¯ååµå¥å¼è®¾å¤ä¸çé¨ç½²è½å ã</p>
<p><strong>PP-StructureV2/V3æ ¸å¿ææ¯</strong></p>
<ul>
<li>
<p><strong>çé¢åæï¼Layout Analysisï¼</strong>ï¼PP-Structureè§çé¢åæä¸ºå¸åçè®¡ç®æºè§è§ä»»å¡ï¼å©ç¨è½»éçº§çä¸»å¹²ç½ç»ï¼å¦MobileNetï¼éåFPNç»æï¼å¿«éæ£æµé¡µé¢åç´ ãå¶ä¼å¿å¨äºæ¥æåºå¤§çä¸­æåå¤è¯­è¨é¢è®­ç»æ°æ®ï¼å¯¹ä¸­æææ¡£ççé¢çè§£è½åå°¤ä¸ºçªåºã</p>
</li>
<li>
<p><strong>è¡¨æ ¼è¯å«ï¼Table Recognitionï¼</strong>ï¼è¿æ¯PaddleOCRçææéãå®éç¨äºSLANetï¼Structure-Location Alignment Networkï¼ç­åè¿ç®æ³ï¼å°è¡¨æ ¼è¯å«è§£è¦ä¸ºç»æé¢æµåååæ ¼åæ åå½ãå³ä½¿æ¯æ­æ²ãå¾ææåç§ä¸åçæç§ææ¡£è¡¨æ ¼ï¼PP-Structureä¹è½è¿ååºç²¾ç¡®çExcelæHTMLç»æã</p>
</li>
<li>
<p><strong>é®å¼å¯¹æåï¼KIEï¼</strong>ï¼éå¯¹åç¥¨ãè¡¨åç­åç»æåææ¡£ï¼PP-StructureéæäºSERï¼è¯­ä¹å®ä½è¯å«ï¼åREï¼å³ç³»æ½åï¼æ¨¡åï¼è½å¤ç´æ¥æåãå§å-å¼ ä¸ãããéé¢-100åãç­é®å¼å¯¹å³ç³»ï¼è¿å¯¹äºè´¢å¡RAGç³»ç»æå·ä»·å¼ã</p>
</li>
</ul>
<h2 id="deepseek-ocrç«¯å°ç«¯ççæå¼è§£æé©å½">DeepSeek-OCRï¼ç«¯å°ç«¯ççæå¼è§£æé©å½</h2>
<ul>
<li>
<p>GitHub: <a href="https://github.com/deepseek-ai/DeepSeek-OCR" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-OCR</a></p>
</li>
<li>
<p>Github: <a href="https://github.com/deepseek-ai/DeepSeek-OCR-2" target="_blank" rel="noopener nofollow">https://github.com/deepseek-ai/DeepSeek-OCR-2</a></p>
</li>
<li>
<p>Hugging Face: <a href="https://huggingface.co/deepseek-ai/DeepSeek-OCR" target="_blank" rel="noopener nofollow">https://huggingface.co/deepseek-ai/DeepSeek-OCR</a></p>
</li>
<li>
<p>éç¨åºæ¯: ä¼ ç»OCRæ æ³å¤ççæå¤ææçï¼å¦æ¥çº¸ãæå¿ãæç¨¿ï¼ï¼éè¦è§è§çè§£çä»»å¡</p>
</li>
</ul>
<p>DeepSeek-OCRä»£è¡¨äºææ¡£è§£æææ¯çææ°èå¼è½¬ç§»ï¼ä»æµæ°´çº¿å¼åç«¯å°ç«¯çæå¼æ¼è¿ãåºäºDeepSeek-VL2å¤æ¨¡æå¤§æ¨¡åï¼è¯¥ç³»ç»ä¸åå°è§£ææè§£ä¸ºæ£æµãè¯å«ãæ¼æ¥ç­æ­¥éª¤ï¼èæ¯ç´æ¥çå¾è¯´è¯ã</p>
<p><strong>è§è§å ææµï¼Visual Causal Flowï¼</strong></p>
<ul>
<li>
<p><strong>è§è§Tokenå</strong>ï¼DeepSeek-VL2å¼å¥äºå¨æåè¾¨çç­ç¥ï¼å°é«åè¾¨ççææ¡£å¾ååçå¹¶ç¼ç ä¸ºè§è§Tokenåºåãè¿äºTokenä¸ææ¬Tokenå±äº«åä¸ä¸ªTransformeråµå¥ç©ºé´ã</p>
</li>
<li>
<p><strong>çæå¼è¾åº</strong>ï¼æ¨¡åæ¥æ¶ææ¡£å¾åä½ä¸ºè¾å¥ï¼ç´æ¥èªåå½å°çæMarkdownä»£ç ãè¿ç§æ¹æ³çé©å½æ§å¨äºå®å·å¤äºæ¨çè½åãä¾å¦ï¼å¨è§£æä¸ä¸ªå¤æçæµç¨å¾æ¶ï¼ä¼ ç»OCRåªè½è¾åºé¶æ£çæå­ï¼èDeepSeek-OCRå¯ä»¥æ ¹æ®ç®­å¤´åå¸å±çææè¿°æ§çææ¬ï¼æ­¥éª¤Aå¯¼è´äºæ­¥éª¤Bãå®è½çè§£å¤éæ¡æè¾¹çæå­æ¯æ ç­¾ï¼ä»èè¾åº"Checked: Yes"ã</p>
</li>
<li>
<p><strong>ä¸ä¸æåå­¦åç¼©</strong>ï¼ä¸ºäºå¤çé¿ææ¡£ï¼DeepSeekè®¾è®¡äºè§è§åç¼©æºå¶ï¼å¨ä¿çé«é¢ç»èï¼å¦æå­ç¬ç»ï¼çåæ¶åç¼©ä½é¢èæ¯ä¿¡æ¯ï¼ä½¿å¾å¨æéçContext Windowåå¤çå¤é¡µææ¡£æä¸ºå¯è½ã</p>
</li>
</ul>
<h2 id="ææ¡£è§£ææ¨¡åå¯¹æ¯æ»ç»è¡¨">ææ¡£è§£ææ¨¡åå¯¹æ¯æ»ç»è¡¨</h2>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¹æ§/å·¥å·</td>
<td>Unstructured</td>
<td>Marker</td>
<td>PyMuPDF</td>
<td>Docling</td>
<td>MinerU</td>
<td>PaddleOCR</td>
<td>DeepSeek-OCR</td>
</tr>
<tr>
<td>æ ¸å¿æ¶æ</td>
<td>æ··åç­ç¥ï¼è§å+è§è§æ¨¡åï¼</td>
<td>æ·±åº¦å­¦ä¹ æµæ°´çº¿ (Surya + Texify)</td>
<td>åºå±PDFæµè§£æ (C++ç»å®)</td>
<td>æ··åæ¶æ (ç»ä¸DOM + VLM)</td>
<td>æ·±åº¦å­¦ä¹ æµæ°´çº¿ (PDF-Extract-Kit)</td>
<td>æ·±åº¦å­¦ä¹  (PP-Structure / OCR)</td>
<td>ç«¯å°ç«¯çæå¼VLM (MoEæ¶æ)</td>
</tr>
<tr>
<td>è§£æç­ç¥</td>
<td>ååº</td>
<td>çé¢æ£æµ -&gt; Markdownçæ</td>
<td>ææ¬å/è·¨åº¦æå</td>
<td>å¯¹è±¡æ¨¡åéæ -&gt; å¯¼åº</td>
<td>å¸å±åæ -&gt; å¤æ¨¡æMD</td>
<td>æ£æµ+è¯å«+ç»æååå½</td>
<td>è§è§Token -&gt; ææ¬çæ</td>
</tr>
<tr>
<td>æä½³éç¨åºæ¯</td>
<td>éç¨ETLï¼å¤æ ¼å¼æ··åå¤ç</td>
<td>ç§å­¦è®ºæãæ°å­¦å¬å¼ãä¹¦ç±</td>
<td>æµ·éåçæ°å­PDFæ¸æ´</td>
<td>ä¼ä¸çº§ææ¡£ãAgentic RAG</td>
<td>å­¦æ¯æç®ãLLMé¢è®­ç»æ°æ®</td>
<td>è¡¨åãç¥¨æ®ãå¤æè¡¨æ ¼</td>
<td>æå¤ææçãè§è§æ¨çä»»å¡</td>
</tr>
<tr>
<td>è¡¨æ ¼å¤çè½å</td>
<td>HTML/CSV (å¼æºçè½åä¸è¬)</td>
<td>é«ç²¾åº¦ (æ¯æè·¨é¡µåå¹¶)</td>
<td>åºç¡ (ä»ä¾èµææ¬ä½ç½®)</td>
<td>é«ç²¾åº¦ (ç»ææ¢å¤å¼º)</td>
<td>é«ç²¾åº¦ (è½¬HTML)</td>
<td>SOTA (æé¿æ­æ²/æ æ¡çº¿è¡¨)</td>
<td>çæå¼ (è¯­ä¹æè¿°/ç»æå)</td>
</tr>
<tr>
<td>å¬å¼/æ°å­¦æ¯æ</td>
<td>åºç¡ (ä¾èµOCR)</td>
<td>åè¶ (Texifyè½¬LaTeX)</td>
<td>æ  (ä»åå§å­ç¬¦)</td>
<td>è¯å¥½ (æ¯æLaTeX)</td>
<td>åè¶ (LaTeXè½¬æ¢)</td>
<td>è¯å¥½ (å­ç¬¦è¯å«)</td>
<td>åè¶ (çæLaTeX)</td>
</tr>
<tr>
<td>å¤çéåº¦</td>
<td>ä¸­ç­ (åå³äºç­ç¥)</td>
<td>ä¸­ç­ (å»ºè®®GPU)</td>
<td>æå¿« (çº¯CPU)</td>
<td>ä¸­ç­åæ¢ (VLMæ¨¡å¼)</td>
<td>ä¸­ç­ (å»ºè®®GPU)</td>
<td>å¿« (æä¾è½»éçº§æ¨¡å)</td>
<td>æ¢ (å¤§æ¨¡åæ¨çå¼é)</td>
</tr>
<tr>
<td>è¾å¥æ¨¡æ</td>
<td>å¤æ ¼å¼ (PDF, PPT, HTML, Email)</td>
<td>PDF, EPUB, Images</td>
<td>PDF, XPS, Ebook</td>
<td>å¤æ ¼å¼ (PDF, DOCX, Images)</td>
<td>PDF, Images</td>
<td>Images, PDF</td>
<td>Images, PDF</td>
</tr>
<tr>
<td>è¾åºæ ¼å¼</td>
<td>JSON (æ ååSchema)</td>
<td>Markdown, JSON, HTML</td>
<td>Dict, String</td>
<td>Markdown, JSON, Doctags</td>
<td>Markdown (å¤æ¨¡æ), JSON</td>
<td>JSON, Excel, HTML</td>
<td>Markdown, JSON</td>
</tr>
<tr>
<td>ä¸»è¦ä¾èµ</td>
<td>Tesseract, Poppler, NLTK</td>
<td>PyTorch, Surya, Texify</td>
<td>MuPDF (æ å¤é¨ä¾èµ)</td>
<td>PyTorch, Granite Model</td>
<td>PyTorch, YOLO, Ray</td>
<td>PaddlePaddle</td>
<td>PyTorch, FlashAttention</td>
</tr>
</tbody>
</table>
<h1 id="ååæ¨¡åä»ææ¬æµå°è¯­ä¹åå">ååæ¨¡åï¼ä»ææ¬æµå°è¯­ä¹åå</h1>
<p>è§£æåçæ°æ®å¿é¡»ç»è¿ååæè½è¿å¥åéç©ºé´ãååç­ç¥ç´æ¥å³å®äºæ£ç´¢çç²åº¦ä¸ä¸ä¸æå®æ´æ§ã</p>
<h2 id="ç­ç¥æ¼è¿">ç­ç¥æ¼è¿</h2>
<ul>
<li>
<p><strong>åºå®çªå£åå</strong>ï¼è¿æ¯æåºç¡çæ¹æ³ï¼å©ç¨LangChainç<code>RecursiveCharacterTextSplitter</code>æå­ç¬¦æ°ï¼å¦512 tokensï¼ååï¼å¹¶è®¾ç½®éå ï¼Overlapï¼ãä¼ç¹æ¯ç¨³å®ï¼ç¼ºç¹æ¯å®¹æåæ­è¯­ä¹ï¼ä¾å¦å°ä¸å¥è¯æªæ­å¨ä¸¤ä¸ªåä¸­ã</p>
</li>
<li>
<p><strong>è¯­ä¹åå</strong>ï¼å©ç¨åµå¥æ¨¡åè®¡ç®å¥ä¸å¥ä¹é´çä½å¼¦ç¸ä¼¼åº¦ãå½ç¸ä¼¼åº¦éª¤éæ¶ï¼æå³çè¯é¢åçäºè½¬æ¢ï¼ç³»ç»å¨æ­¤å¤è¿è¡ååãè¿ç§æ¹æ³è½ä¿è¯æ¯ä¸ªååå«ä¸ä¸ªå®æ´çè¯­ä¹ä¸»é¢ãå¼æºåºChonkieåSemChunkæä¾äºè½»éçº§çå®ç°ï¼æ¯æå¨ä¸ä¾èµéåæ¡æ¶çæåµä¸å¿«éè¿è¡è¯­ä¹ååã</p>
</li>
<li>
<p><strong>å±çº§åå</strong>ï¼å©ç¨DoclingæMinerUè¾åºçç»æåä¿¡æ¯ï¼Header, Sectionï¼ï¼åæç« èåå¤§åï¼åå¨å¤§åååå°åãæ£ç´¢æ¶å¹éå°åï¼ä½è¿åå¤§åï¼Parent Document Retrievalï¼ï¼å¼é¡¾äºæ£ç´¢çç²¾ååº¦ä¸çæçä¸ä¸æä¸°å¯åº¦ã</p>
</li>
</ul>
<h2 id="æºè½agentåå">æºè½Agentåå</h2>
<p>ææ°çè¶å¿æ¯Agentic Chunkingï¼å³å©ç¨LLMå°ææ¬éåä¸ºç¬ç«çãå½é¢ããä¾å¦ï¼å°ãå¼ ä¸ï¼ç¾åº¦çå·¥ç¨å¸ï¼å»äºåäº¬ãæè§£ä¸ºãå¼ ä¸æ¯ç¾åº¦çå·¥ç¨å¸ãåãå¼ ä¸å»äºåäº¬ãä¸¤ä¸ªç¬ç«äºå®ãè½ç¶ææ¬é«ï¼ä½è½æ¾èæåå¤æé®é¢çæ£ç´¢å¬åçã</p>
<h2 id="èµæºé¾æ¥">èµæºé¾æ¥</h2>
<p><strong>Chonkie</strong></p>
<ul>
<li>
<p>ä¸ä¸ªè½»éçº§ãæéçRAGåååºï¼ä¸æ³¨äºè¯­ä¹ååã</p>
<ul>
<li>
<p><strong>GitHub</strong>: <a href="https://github.com/chonkie-inc/chonkie" target="_blank" rel="noopener nofollow">https://github.com/chonkie-inc/chonkie</a></p>
</li>
<li>
<p><strong>Docs</strong>: <a href="https://docs.chonkie.ai/" target="_blank" rel="noopener nofollow">https://docs.chonkie.ai/</a></p>
</li>
</ul>
</li>
</ul>
<p><strong>Semantic</strong> <strong>Router</strong></p>
<ul>
<li>
<p>è½ç¶ä¸»è¦ç¨äºè·¯ç±ï¼ä½ä¹åå«å¼ºå¤§çè¯­ä¹åæå±ï¼å¯ç¨äºé«çº§ååã</p>
<ul>
<li>GitHub: <a href="https://github.com/aurelio-labs/semantic-router" target="_blank" rel="noopener nofollow">https://github.com/aurelio-labs/semantic-router</a></li>
</ul>
</li>
</ul>
<h1 id="åéåæ¨¡åè¯­ä¹ç©ºé´çæå»º">åéåæ¨¡åï¼è¯­ä¹ç©ºé´çæå»º</h1>
<p>åéåæ¯å°ææ¬æå½±å°é«ç»´è¯­ä¹ç©ºé´çè¿ç¨ãå¨2025-2026å¹´ï¼MTEB (Massive Text Embedding Benchmark) æè¡æ¦æä¸ºäºè¡¡éæ¨¡åæ§è½çé»éæ åãå¼æºæ¨¡åå¨è¿ä¸é¢åå·²ç»å¨é¢è¿½å¹³çè³è¶è¶äºé­æºåä¸æ¨¡åï¼å¦OpenAI text-embedding-3ï¼</p>
<h2 id="bge-baai-general-embedding-ç³»å">BGE (BAAI General Embedding) ç³»å</h2>
<ul>
<li>
<p>GitHub: <a href="https://github.com/FlagOpen/FlagEmbedding" target="_blank" rel="noopener nofollow">https://github.com/FlagOpen/FlagEmbedding</a></p>
</li>
<li>
<p>Hugging Face: <a href="https://huggingface.co/BAAI/bge-m3" target="_blank" rel="noopener nofollow">https://huggingface.co/BAAI/bge-m3</a></p>
</li>
<li>
<p>å®æ¹ææ¡£: <a href="https://bge-model.com/" target="_blank" rel="noopener nofollow">https://bge-model.com/</a></p>
</li>
<li>
<p>åèèµæï¼<a href="https://www.bentoml.com/blog/a-guide-to-open-source-embedding-models" target="_blank" rel="noopener nofollow">https://www.bentoml.com/blog/a-guide-to-open-source-embedding-models</a></p>
</li>
</ul>
<p><img alt="" loading="lazy" data-src="https://pcnzmyb3bo4o.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDJkMTM1ZDc2NWM2N2EyZmQ4MjY1ODVhYzk5OGUwNDRfam9ES1VwM21EbkZuYmo4Q0xPUmJHR1B5VE5MdlJUM1VfVG9rZW46UWE4bGI2Ymhxb1g2OXV4VWRhamNzdmZtbmNlXzE3NzA5ODY2Mzc6MTc3MDk5MDIzN19WNA" class="lazyload"></p>
<p>ç±åäº¬æºæºäººå·¥æºè½ç ç©¶é¢å¼åãBGE-M3æ¯ç®åçSOTAæ¨¡åï¼æ¯æå¤è¯­è¨ï¼100+ï¼ãå¤åè½ï¼ç¨ å¯ãç¨çãå¤åéæ£ç´¢ï¼åé¿ææ¬ï¼8192 tokensï¼ãå¶ç¬ç¹çæ··åæ£ç´¢è½åä½¿å¶æä¸ºæå»ºå¤è·¯å¬åç³»ç»çé¦éãè¯¥æ¨¡åéæäºä¸ç§æ£ç´¢èå¼ï¼</p>
<ul>
<li>
<p><strong>å¯éæ£ç´¢ï¼Dense Retrievalï¼</strong>ï¼åºäºè¯­ä¹åéã</p>
</li>
<li>
<p><strong>ç¨çæ£ç´¢ï¼****Sparse</strong> <strong>Retrievalï¼</strong>ï¼ç±»ä¼¼äºBM25çè¯æ±å¹éï¼ç¨äºå¼¥è¡¥å¯éæ£ç´¢å¨ä¸æåè¯å¹éä¸çä¸è¶³ã</p>
</li>
<li>
<p><strong>å¤åéæ£ç´¢ï¼Multi-Vector/ColBERTï¼</strong>ï¼ä¿çæ¯ä¸ªTokençåéè¿è¡ç»ç²åº¦äº¤äºã è¿ç§âå¨è½åâè®¾è®¡ä½¿å¾ BGE-M3 è½å¤éåºå¤è¯­è¨ï¼100+ï¼ãé¿ææ¬ï¼8192 Tokenï¼çå¤æåºæ¯ã</p>
</li>
</ul>
<h2 id="qwen-embedding">Qwen-Embedding</h2>
<ul>
<li>Huggingface: <a href="https://huggingface.co/collections/Qwen/qwen3-embedding" target="_blank" rel="noopener nofollow">https://huggingface.co/collections/Qwen/qwen3-embedding</a></li>
</ul>
<p>é¿éå·´å·´æ¨åºçQwen3-Embeddingç³»åæ¨¡åå¨MTEBæ¦åä¸è¡¨ç°ä¼å¼ï¼ç¹å«æ¯å¨å¤è¯­è¨ä»»å¡åé¿ä¸ä¸æä»»å¡ä¸­ã</p>
<ul>
<li><strong>å¼¹æ§ç»´åº¦ï¼Matryoshka Representation Learning, MRLï¼</strong>ï¼Qwenæ¨¡åæ¯æå¼¹æ§è¾åºç»´åº¦ãç¨æ·å¯ä»¥æ ¹æ®å­å¨é¢ç®ï¼çµæ´»éæ©ä½¿ç¨å1024ç»´çè³512ç»´åéï¼èæ§è½æå¤±å¾®ä¹å¶å¾®ãè¿ä½¿å¾RAGç³»ç»å¯ä»¥å¨éåº¦åç²¾åº¦ä¹é´è¿è¡å¨ææè¡¡ã</li>
</ul>
<h2 id="e5ç³»å">E5ç³»å</h2>
<ul>
<li>Hugging Face: <a href="https://huggingface.co/intfloat/multilingual-e5-large" target="_blank" rel="noopener nofollow">https://huggingface.co/intfloat/multilingual-e5-large</a></li>
</ul>
<p>E5ç³»å (EmbEddings from bidirEcTional Encoder rEpresentations)æ¨¡åï¼å¦multilingual-e5-largeï¼éè¿æä»¤å¾®è°ä¼åäºéå¯¹ç§°æç´¢ä»»å¡ï¼ç­Queryæ¾é¿Passageï¼ãä½¿ç¨æ¶éæ·»å åç¼<code>query:</code>å<code>passage:</code>ï¼å¨MTEBæ¦åä¸é¿æé¸æ¦ã</p>
<h2 id="jina-embeddings-v3"><strong>Jina Embeddings v3</strong></h2>
<ul>
<li>Hugging Face: <a href="https://huggingface.co/jinaai/jina-embeddings-v3" target="_blank" rel="noopener nofollow">https://huggingface.co/jinaai/jina-embeddings-v3</a></li>
</ul>
<p>ä¸ä¸ºé¿ææ¡£åä»£ç è®¾è®¡ï¼å©ç¨ALiBiä½ç½®ç¼ç å¤æ¨ä¸ä¸æé¿åº¦ï¼éå¸¸éåææ¯ææ¡£åºçRAGã</p>
<h1 id="æ£ç´¢æ¨¡åretrievalåéæ°æ®åºéå">æ£ç´¢æ¨¡åï¼Retrievalï¼ï¼åéæ°æ®åºéå</h1>
<p>åéæ°æ®åºæ¯RAGç³»ç»çé¿æ¶è®°å¿ãå½åå¸åºå·²ç»å½¢æäºä»¥MilvusãQdrantåWeaviateä¸ºä»£è¡¨çå¼æºä¸å·¨å¤´ï¼ä»¥åpgvectorè¿ç§ä¾æäºPostgreSQLçè½»éåæ¹æ¡ã</p>
<h2 id="milvusäºåçæ¶ä»£çå·¨è°">Milvusï¼äºåçæ¶ä»£çå·¨è°</h2>
<ul>
<li>
<p>GitHub: <a href="https://github.com/milvus-io/milvus" target="_blank" rel="noopener nofollow">https://github.com/milvus-io/milvus</a></p>
</li>
<li>
<p>ææ¡£: <a href="https://milvus.io/docs" target="_blank" rel="noopener nofollow">https://milvus.io/docs</a></p>
</li>
</ul>
<p>ç±Zillizå¼åçMilvuséç¨äºå­å¨ä¸è®¡ç®åç¦»çäºåçæ¶æï¼ä¸ä¸ºå¤çåäº¿çº§ï¼Billion-scaleï¼åéæ°æ®èè®¾è®¡ã</p>
<ul>
<li><strong>æ ¸å¿ç¹æ§</strong>ï¼æ¯æåå¸å¼é¨ç½²ãKubernetes ç¼æãå¤ç§æ·éç¦»ä»¥åå¤ç§ç´¢å¼ç±»åï¼HNSW, DiskANNï¼ãå®éåéè¦æé«ååéåå¤§è§æ¨¡æ°æ®åççä¼ä¸çº§åºç¨ã</li>
</ul>
<h2 id="qdranté«æ§è½ä¸çµæ´»æ§çå¹³è¡¡">Qdrantï¼é«æ§è½ä¸çµæ´»æ§çå¹³è¡¡</h2>
<ul>
<li>
<p>GitHub: <a href="https://github.com/qdrant/qdrant" target="_blank" rel="noopener nofollow">https://github.com/qdrant/qdrant</a></p>
</li>
<li>
<p>ææ¡£: <a href="https://qdrant.tech/documentation/" target="_blank" rel="noopener nofollow">https://qdrant.tech/documentation/</a></p>
</li>
</ul>
<p>QdrantåºäºRustè¯­è¨å¼åï¼ä»¥é«æ§è½åä½å»¶è¿èç§°ã</p>
<ul>
<li><strong>æ ¸å¿ç¹æ§</strong>ï¼å°åéç´¢å¼ä¸Payloadï¼åæ°æ®ï¼ç´¢å¼ç´§å¯ç»åï¼æ¯æå¼ºå¤§çè¿æ»¤æ¥è¯¢ï¼Filteringï¼ãä¸ä¼ ç»çåæ£ç´¢åè¿æ»¤ä¸åï¼Qdrantè½å¤å¨ç´¢å¼éåè¿ç¨ä¸­åºç¨è¿æ»¤æ¡ä»¶ï¼æå¤§æåäºæ··åæ¥è¯¢çæçãå¶æ¨èç³»ç»åå»éåè½ä¹éå¸¸å®åã</li>
</ul>
<h2 id="weaviateaiåççæ¨¡ååæ°æ®åº">Weaviateï¼AIåççæ¨¡ååæ°æ®åº</h2>
<ul>
<li>
<p>GitHub: <a href="https://github.com/weaviate/weaviate" target="_blank" rel="noopener nofollow">https://github.com/weaviate/weaviate</a></p>
</li>
<li>
<p>ææ¡£: <a href="https://weaviate.io/developers/weaviate" target="_blank" rel="noopener nofollow">https://weaviate.io/developers/weaviate</a></p>
</li>
</ul>
<p>Weaviateä¸ä»ä»æ¯ä¸ä¸ªæ°æ®åºï¼æ´åæ¯ä¸ä¸ªAIä¸­é´ä»¶å¹³å°ã</p>
<ul>
<li><strong>æ ¸å¿ç¹æ§</strong>ï¼åç½®äºå¤§éçæ¨¡åï¼å¯ä»¥ç´æ¥å¨æ°æ®åºå±é¢éæOpenAIãHuggingFaceç­æ¨¡åçåéåè½åãç¨æ·åªéå­å¥ææ¬ï¼Weaviateä¼èªå¨è°ç¨æ¨¡åçæåéãå¶GraphQLæ¥å£ä¹ä¸ºå¤æçæ°æ®å³èæ¥è¯¢æä¾äºä¾¿å©ã</li>
</ul>
<h2 id="pgvectorpostgresqlç¨æ·çå¡å®ä¹é">pgvectorï¼PostgreSQLç¨æ·çå¡å®ä¹é</h2>
<ul>
<li>GitHub: <a href="https://github.com/pgvector/pgvector" target="_blank" rel="noopener nofollow">https://github.com/pgvector/pgvector</a></li>
</ul>
<p>pgvectoræ¯PostgreSQLçä¸ä¸ªå¼æºæ©å±ï¼ä¸ºç°æçå³ç³»åæ°æ®åºæ·»å äºåéå­å¨åç¸ä¼¼åº¦æç´¢åè½ã</p>
<ul>
<li><strong>æ ¸å¿ç¹æ§</strong>ï¼åè®¸åéæ°æ®ä¸ä¸å¡æ°æ®ï¼å¦ç¨æ·ä¿¡æ¯ãè®¢åè®°å½ï¼å­å¨å¨åä¸å¼ è¡¨ä¸­ï¼å¤©ç¶æ¯æACIDäºå¡åå¤æçSQL Joinæä½ãå¯¹äºæ°æ®éå¨åä¸çº§å«ä»¥ä¸ï¼ä¸å·²æPostgresåºç¡è®¾æ½çå¢éï¼è¿æ¯ææ¬æä½çæ¹æ¡ã</li>
</ul>
<h1 id="æåºæ¨¡åç²¾åº¦çæåä¸éé²çº¿">æåºæ¨¡åï¼ç²¾åº¦çæåä¸éé²çº¿</h1>
<p>æ£ç´¢æ¨¡åéå¸¸è¿å Top-Kï¼å¦50-100ï¼ä¸ªåéçæ®µï¼ä½è¿äºçæ®µæ¯åºäºç²ç¥çåéç¸ä¼¼åº¦è·åçãä¸ºäºè®©LLMè·å¾æç²¾åçä¸ä¸æï¼éè¦å¼å¥éæåºæ¨¡åãéæåºæ¨¡åéå¸¸éç¨äº¤åç¼ç å¨æ¶æï¼å®å°æ¥è¯¢åææ¡£åæ¶è¾å¥æ¨¡åï¼è®¡ç®å®ä»¬ä¹é´çæ·±å±äº¤äºï¼ä»èç»åºæé«ç²¾åº¦çç¸å³æ§è¯åã</p>
<h2 id="bge-rerankerå¼æºéæåºçæ æ">BGE-Rerankerï¼å¼æºéæåºçæ æ</h2>
<ul>
<li>
<p>GitHub: <a href="https://github.com/FlagOpen/FlagEmbedding" target="_blank" rel="noopener nofollow">https://github.com/FlagOpen/FlagEmbedding</a></p>
</li>
<li>
<p>Hugging Face: <a href="https://huggingface.co/BAAI/bge-reranker-v2-m3" target="_blank" rel="noopener nofollow">https://huggingface.co/BAAI/bge-reranker-v2-m3</a></p>
</li>
</ul>
<p>BGE-Rerankerç³»åï¼v2, v2.5ï¼æ¯ç®åå¼æºç¤¾åºä¸­æå¼ºå¤§çéæåºæ¨¡åä¹ä¸ã</p>
<ul>
<li>
<p><strong>å¤è¯­è¨è½å</strong>ï¼æ¯æä¸­è±ç­å¤è¯­è¨æ··åæåºã</p>
</li>
<li>
<p><strong>è½»éåè¸é¦</strong>ï¼ææ°çBGE-Reranker-v2.5-Gemma2-Lightweightéè¿å±çº§è¸é¦ææ¯ï¼å¨ä¿æLLMçº§æåºè½åçåæ¶ï¼å¤§å¹éä½äºæ¨çå»¶è¿ï¼ä½¿å¶è½å¤é¨ç½²å¨å®æ¶æ§è¦æ±è¾é«ççäº§ç¯å¢ä¸­ã</p>
</li>
</ul>
<h2 id="rankgptå©ç¨llmè¿è¡åè¡¨æåº">RankGPTï¼å©ç¨LLMè¿è¡åè¡¨æåº</h2>
<ul>
<li><strong>GitHub</strong>: <a href="https://github.com/sunnweiwei/RankGPT" target="_blank" rel="noopener nofollow">https://github.com/sunnweiwei/RankGPT</a></li>
</ul>
<p>RankGPTæ¢ç´¢äºä¸ç§ä¸åçè·¯å¾ï¼å©ç¨çæå¼ LLMï¼å¦ GPT-4, Qwenï¼çæ¨çè½åè¿è¡æåºã</p>
<ul>
<li><strong>åè¡¨å¼ï¼Listwiseï¼æåº</strong>ï¼ä¸åäºCross-Encoder å¯¹æ¯å¯¹ (Query, Doc) åç¬æåï¼RankGPTå°Queryåä¸ç»ææ¡£ï¼å¦10ä¸ªï¼åæ¶è¾å¥LLMï¼å¹¶æç¤ºæ¨¡åãè¯·æç¸å³æ§å¯¹è¿äºææ¡£è¿è¡æåºããè¿ç§æ¹æ³èèäºææ¡£ä¹é´çç¸å¯¹å³ç³»ï¼å¾å¾è½è·å¾æ¯Pairwiseæ¹æ³æ´é«çMAPææ ï¼ä½å»¶è¿åææ¬ä¹æ¾èå¢å ã</li>
</ul>
<h2 id="flashrankæè´è½»éåçcpuæ¹æ¡">FlashRankï¼æè´è½»éåçCPUæ¹æ¡</h2>
<ul>
<li>GitHub: <a href="https://github.com/PrithivirajDamodaran/FlashRank" target="_blank" rel="noopener nofollow">https://github.com/PrithivirajDamodaran/FlashRank</a></li>
</ul>
<p><strong>FlashRank</strong> æ¯ä¸ä¸ªä¸ä¸ºæ  GPU ç¯å¢è®¾è®¡ç Python åºã</p>
<ul>
<li><strong>æ ¸å¿ç¹æ§</strong>ï¼åºäºéååçTinyBERTç­å¾®åæ¨¡åï¼è½å¤å¨æ®éCPUä¸å®ç°æ¯«ç§çº§çéæåºãè¿å¯¹äºé¨ç½²å¨AWS Lambdaç­Serverlessç¯å¢æè¾¹ç¼è®¾å¤ä¸çRAGåºç¨è³å³éè¦ ã</li>
</ul>
<h1 id="éåå»ºè®®">éåå»ºè®®</h1>
<p>æå»ºå¼æºRAGç³»ç»å·²ä¸åæ¯ç®åçæ¨¡åå ç ï¼èæ¯å¯¹æ°æ®å¤çå¨é¾è·¯çç²¾ç»åå·¥ç¨ã</p>
<ul>
<li>
<p><strong>è§£æå±</strong>ï¼å¯¹äºéç¨åºæ¯ï¼æ¨èä½¿ç¨Unstructuredè¿è¡å¿«éååå¼åï¼å¯¹äºç§å­¦æç®åå¤ææ¥è¡¨ï¼MarkeråMinerUæ¯ç®åçæä½³å®è·µï¼è¥éå¤çæµ·éåçPDFï¼PyMuPDFä¸å¯æç¼ºï¼èå¯¹äºè¿½æ±æè´ç»æååAgentäº¤äºçä¼ä¸çº§åºç¨ï¼Doclingå±ç°äºå·¨å¤§çæ½åã</p>
</li>
<li>
<p><strong>æ°æ®æµå±</strong>ï¼åºæå¼åºå®çå­ç¬¦ååï¼è½¬åè¯­ä¹ååæå±çº§ååã</p>
</li>
<li>
<p><strong>æ¨¡åå±</strong>ï¼BGE-M3ï¼Embeddingï¼éåBGE-Reranker-v2-m3ï¼Rerankingï¼ææäºç®åæå¼ºçå¼æºè¯­ä¹çè§£ç»åï¼éåMilvusæQdrantå¯æå»ºåºæ§è½åª²ç¾åä¸é­æºæ¹æ¡çRAGç³»ç»ã</p>
</li>
</ul>
<p>éçDeepSeek-OCRç­çæå¼è§£æææ¯çæçï¼æªæ¥çææ¡£è§£æå°éæ¸å·å¤æ¨çè½åï¼è¿ä¸æ­¥æ¨¡ç³æç¥ä¸è®¤ç¥çè¾¹çï¼ä¸ºRAGç³»ç»æ³¨å¥æ´æ·±å±çæºè½ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 21:05">2026-02-13 21:04</span>&nbsp;
<a href="https://www.cnblogs.com/aifrontiers">AI-Frontiers</a>&nbsp;
éè¯»(<span id="post_view_count">114</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19613559);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19613559', targetLink: 'https://www.cnblogs.com/aifrontiers/p/19613559', title: 'æ¶èï¼RAGæ ¸å¿å·¥å·å¤§å¨: 7å¤§è§£æå·¥å·+åéæ¨¡å+æ°æ®åº+æ£ç´¢æåº' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Volcano v1.14 éç£åå¸ï¼è¿å AI ç»ä¸è°åº¦æ°çºªå ]]></title>
    <link>https://www.cnblogs.com/huaweiyun/p/19612682</link>
    <guid>9fd7af0fb39f5bbf00537e5d0adb6977</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huaweiyun/p/19612682" title="åå¸äº 2026-02-13 16:35">
    <span role="heading" aria-level="2">Volcano v1.14 éç£åå¸ï¼è¿å AI ç»ä¸è°åº¦æ°çºªå</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>æ¬æåäº«èªåä¸ºäºç¤¾åºã<a href="https://bbs.huaweicloud.com/blogs/474065?utm_source=zhihu&amp;utm_medium=bbs-ex&amp;utm_campaign=other&amp;utm_content=content" target="_blank" rel="noopener nofollow">Volcano v1.14 éç£åå¸ï¼è¿å AI ç»ä¸è°åº¦æ°çºªå</a>ã</p>
<p>åäº¬æ¶é´2026å¹´1æï¼<strong>Volcano</strong>[1] v1.14 æ­£å¼åå¸ãéç AI ä¸å¡å½¢æä»åä¸çç¦»çº¿è®­ç»åå¨çº¿æ¨çãAgent æºè½ä½ç­å¤åååºæ¯å»¶ä¼¸ï¼è°åº¦ç³»ç»é¢ä¸´çåææªæçææã<strong>v1.14</strong>[2] éè¿æ¶æçº§çåæ°ï¼å¨ä¿æå¤§è§æ¨¡æ¹éè®¡ç®ä¼å¿çåæ¶ï¼è¡¥é½äºå¯¹å»¶è¿ææåä¸å¡çè°åº¦ç­æ¿ï¼åç <strong>âAIè®­æ¨ãRLãAgentå¨åºæ¯ç»ä¸è°åº¦å¹³å°â</strong> çç®æ è¿åºäºåå®ä¸æ­¥ã</p>
<p data-tool="mdniceç¼è¾å¨"><img alt="download" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2030258/202602/2030258-20260213163013597-24056382.png" class="lazyload"></p>
<h1 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>çæ¬äº®ç¹</strong></span></span></h1>
<p data-tool="mdniceç¼è¾å¨">v1.14.0 çæ¬å¸¦æ¥ä»¥ä¸éç£æ´æ°ï¼</p>
<p data-tool="mdniceç¼è¾å¨"><strong>ç»ä¸è°åº¦å¹³å°æ¶æ</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>å¤è°åº¦å¨æ¶æåçº§ï¼å¨æèç¹åçæºå¶ (Alpha)</li>
<li>AI Agent å·¥ä½è´è½½æéè°åº¦è½å (Alpha)</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>ç½ç»æææç¥è°åº¦å¢å¼º</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>HyperNode çº§ Binpack ç­ç¥</li>
<li>SubGroup çº§ç²¾ç»åæææç¥</li>
<li>PodGroup ä¸ SubGroup å¤å±çº§ Gang Scheduling</li>
<li>Volcano Job ååºæ¯æ</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>æ··é¨è½åå¢å¼º</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>å¨é¢æ¯æéç¨æä½ç³»ç»ï¼UbuntuãCentOS ç­ï¼</li>
<li>Cgroup V2 å¨é¢éé</li>
<li>CPU å¨æåå¶</li>
<li>åºäº Cgroup V2 çåå­ QoS</li>
<li>æ¯æ CPU Burst</li>
<li>æ¯æ systemd driver èªå¨æ£æµ</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>å¼æç¡¬ä»¶æ¯æ</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>æè¾ vNPU è°åº¦ï¼æ¯æ MindCluster å HAMi æ¨¡å¼ï¼</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>Volcano Global å¢å¼º</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>HyperJob å¤éç¾¤ä½ä¸èªå¨æå</li>
<li>æ°æ®æç¥å¤éç¾¤è°åº¦</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>Volcano Dashboard å¢å¼º</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>PodGroup å¨æ¯å¯è§å</li>
<li>Job / Queue å¨çå½å¨æç®¡ç</li>
</ul>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>å¤è°åº¦å¨æ¶æåçº§ï¼å¨æèç¹åçæºå¶ (Alpha)</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">éç Volcano æ¿è½½çå·¥ä½è´è½½ç±»åæ¥çä¸°å¯ãè§æ¨¡æç»­æ©å¤§ï¼åä¸è°åº¦å¨æ¶æéæ¸æ¾é²ç¶é¢ãæ¹éè®­ç»ãAI Agentãå¾®æå¡ç­ä¸åç±»åçå·¥ä½è´è½½ï¼å¯¹è°åº¦æ¶å»¶ãèµæºå©ç¨æ¨¡å¼çè¯æ±åä¸ç¸åãåè°åº¦å¨é¾ä»¥å¼é¡¾ï¼èéæèµæºåååä¼é æå©ç¨çä½ä¸ã<br>
æ°å¼å¥ç Sharding Controller æå»ºäºä¸å¥å¯æ©å±çå¤è°åº¦å¨æ¶æï¼è½å¤æ ¹æ®éç¾¤å®æ¶ç¶æï¼ä¸ºæ¯ä¸ªè°åº¦å¨å¨æè®¡ç®åéèç¹æ± ãä¸ä¼ ç»çéæååºä¸åï¼Sharding Controller éç¨å¨æè®¡ç®çæ¹å¼ååèµæºï¼èéå¼ºå¶ç¡¬éç¦»ãè¿ç§çµæ´»æºå¶è®© Volcano çæ­£æä¸º"ä¸ä¸ªå¹³å°è°åº¦ææè´è½½"çç»ä¸è°åº¦å¹³å°ï¼åæ¶ä¿æé«ååãä½æ¶å»¶ã<br>
</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ ¸å¿è½å</strong>ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>å¨æåçç­ç¥</strong>ï¼æ¯æå¤ç§ç­ç¥æ¥è®¡ç®å¨æåéèç¹æ± ãå½åçæ¬çåæ¯æåºäº CPU å©ç¨ççåçç­ç¥ï¼å¹¶éç¨äºå¯æ©å±çæ¶æè®¾è®¡ï¼ä»¥ä¾¿æªæ¥è½»æ¾éææ´å¤åçç®æ³ã</li>
<li><strong>èç¹æ± åç®¡ç</strong>ï¼å¼å¥ NodeShard CRDï¼ä¸ºç¹å®è°åº¦å¨ç®¡çä¸å±çå¨æåéèç¹æ± ã</li>
<li><strong>æ¯æå¤§è§æ¨¡éç¾¤</strong>ï¼éè¿å¨å¤ä¸ªè°åº¦å¨ä¹é´çµæ´»åéè´è½½ï¼å¤©ç¶ééå¤§è§æ¨¡éç¾¤åºæ¯ã</li>
<li><strong>å¤è°åº¦å¨åå</strong>ï¼æ¯æå¤ç§è°åº¦å¨ç»åçæ ç¼åä½ãæ è®ºæ¯é¨ç½²å¤ä¸ª Batch Scheduler è¿è¡è´è½½åæï¼è¿æ¯æ··åé¨ç½² Agent Scheduler ä¸ Batch Scheduler ä»¥åºå¯¹ä¸åä¸å¡éæ±ï¼é½è½çµæ´»ééã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">éç½®ç¤ºä¾ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;"># Sharding Controller å¯å¨åæ°
--scheduler-configs="volcano:volcano:0.0:0.6:false:2:100,agent-scheduler:agent:0.7:1.0:true:2:100"
--shard-sync-period=60s
--enable-node-event-trigger=true

# åæ°æ ¼å¼: name:type:min_util:max_util:prefer_warmup:min_nodes:max_nodes</pre>
</div>
<p data-tool="mdniceç¼è¾å¨">ç¸å³ PRï¼https://github.com/volcano-sh/volcano/pull/4777<br>
è®¾è®¡ææ¡£ï¼<strong>Sharding Controller Design</strong>[3]<br>
æè°¢ç¤¾åºå¼åèï¼@ssfffss, @Haoran, @qi-min</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>AI Agent å·¥ä½è´è½½æéè°åº¦ (Alpha)</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">AI Agent ç±»ä¸å¡å¯¹æ¶å»¶æåº¦ææï¼ä»»å¡åå»ºé¢ç¹ä¸çå½å¨æç­ï¼å¯¹è°åº¦å¨çååºéåº¦åååéæåºäºä¸¥èè¦æ±ãåç Volcano Batch Scheduler ä¸ä¸ºæ¹éè®¡ç®è®¾è®¡ï¼æåºå®å¨æå¤ç Podï¼é¾ä»¥æ»¡è¶³ Agent åºæ¯çæ¯«ç§çº§ååºéæ±ã<br>
ä¸ºæé å¼å®¹æ¹éè®¡ç®ä¸å»¶è¿ææåä¸å¡çç»ä¸è°åº¦å¹³å°ï¼v1.14 å¼å¥äºä¸ç¨ç <strong>Agent Scheduler</strong>ãå®éè¿ Sharding Controller ä¸æ¹éè°åº¦å¨ååå·¥ä½ï¼åå¸å¶èåæ ç¼éåï¼çæ­£å®ç°"ä¸ä¸ªå¹³å°ãå¤ç§è´è½½"ã<br>
</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ ¸å¿è½å</strong>ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>æéè°åº¦éé</strong>ï¼ä¸ä¸ºå»¶è¿ææåè´è½½ï¼å¦ AI Agentï¼æé çç¬ç«è°åº¦å¨ï¼æä¾æè´ååºéåº¦ã</li>
<li><strong>å¤ Worker å¹¶è¡å¤ç</strong>ï¼éç¨å¤ Worker å¹¶åæ¶è´¹è°åº¦éåçæ¶æï¼å¤§å¹æåè°åº¦ååéã</li>
<li><strong>ä¹è§å¹¶åæ§å¶</strong>ï¼å¼å¥ Conflict-Aware Binder æºå¶ï¼å¨å®éç»å®åé¢åè§£å³å²çªï¼åå°æ ææä½ã</li>
<li><strong>å¢å¼ºåè°åº¦éå</strong>ï¼ä¼åéåæºå¶ï¼æ¯æç´§æ¥ä»»å¡éè¯ï¼ç¡®ä¿å³é®ä»»å¡ä¸é»å¡ã</li>
<li><strong>ç»ä¸å¹³å°èå</strong>ï¼éè¿ Sharding Controller ä¸æ¹éè°åº¦å¨æ ç¼åä½ï¼å±äº«éç¾¤èµæºã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">ç¸å³ PRï¼</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4804,<br>
https://github.com/volcano-sh/volcano/pull/4801,<br>
https://github.com/volcano-sh/volcano/pull/4805<br>
è®¾è®¡ææ¡£ï¼<strong>Agent Scheduler Design</strong>[4]<br>
æè°¢ç¤¾åºå¼åèï¼@qi-min, @JesseStutler, @handan-yxh</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>ç½ç»æææç¥è°åº¦å¢å¼º</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">Volcano v1.14.0 å¯¹ç½ç»æææç¥è°åº¦è¿è¡äºè¿ä¸æ­¥å¢å¼ºï¼æ»¡è¶³åå¸å¼å·¥ä½è´è½½ï¼åæ¬ LLM è®­ç»ãæ¨çãHPC åå¶ä»ç½ç»å¯éååºç¨ï¼æ¥çå¢é¿çéæ±ã<br>
</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ ¸å¿å¢å¼º</strong>ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>SubGroup çº§ç²¾ç»åæææç¥</strong>ï¼æ¯æå¨ SubGroup / Partition ç²åº¦è®¾ç½®ç½ç»ææçº¦æï¼è°åº¦é¢ç²åº¦æ´ç²¾ç»ã</li>
<li><strong>çµæ´»çç½ç»å±çº§çº¦æ</strong>ï¼æ°å¢ highestTierNameï¼æ¯ææåç§°æå®åè®¸è·¨è¶çæé«ç½ç»å±çº§ã</li>
<li><strong>å¤å±çº§ Gang Scheduling</strong>ï¼åæ¶æ¯æ PodGroup çº§å«å SubGroup çº§å«ç Gang Schedulingï¼ç¡®ä¿åå¸å¼ä»»å¡çæ´ä½æ§ã</li>
<li><strong>Volcano Job ååº</strong>ï¼æ¯æå° Job æåä¸ºå¤ä¸ªååºï¼Partitionï¼ï¼ä¾¿äºç®¡ç TP/PP/DP ç­å¹¶è¡ç­ç¥ï¼å¹¶ä¼åç½ç»äº²åæ§ã</li>
<li><strong>HyperNode çº§ Binpacking</strong>ï¼å¨ HyperNodeï¼å¦äº¤æ¢æºãæºæ¶ï¼å±çº§è¿è¡èµæºè£ç®±ï¼åå°ç½ç»ç¢çï¼æåéä¿¡æçã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">éç½®ç¤ºä¾ - Volcano Jobï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">apiVersion: batch.volcano.sh/v1alpha1
kind: Job
metadata:
name: llm-training-job
spec:
networkTopology:
mode: hard
highestTierAllowed: 2 # æ´ä¸ª Job æå¤è·¨è¶ Tier 2 HyperNode
tasks:
- name: trainer
replicas: 8
partitionPolicy:
totalPartitions: 2 # æåä¸º 2 ä¸ªååº
partitionSize: 4 # æ¯ä¸ªååº 4 ä¸ª Pod
minPartitions: 2 # è³å°éè¦ 2 ä¸ªååº
networkTopology:
mode: hard
highestTierAllowed: 1 # åä¸ªååºå¿é¡»å¨ Tier 1 å
template:
spec:
containers:
- name: trainer
image: training-image:v1
resources:
requests:
nvidia.com/gpu: 8</pre>
</div>
<p data-tool="mdniceç¼è¾å¨">ç¸å³ PRï¼</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4721,<br>
https://github.com/volcano-sh/volcano/pull/4810,<br>
https://github.com/volcano-sh/volcano/pull/4795,<br>
https://github.com/volcano-sh/volcano/pull/4785,<br>
https://github.com/volcano-sh/volcano/pull/4889</p>
<p data-tool="mdniceç¼è¾å¨">è®¾è®¡ææ¡£ï¼<strong>Network Topology Aware Scheduling</strong>[5]<br>
æè°¢ç¤¾åºå¼åèï¼@ouyangshengjia, @3sunny, @zhaoqi, @wangyang0616, @MondayCha, @Tau721</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>æ··é¨è½åå¨é¢åçº§ï¼æ¯æéç¨æä½ç³»ç»</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">æ¬æ¬¡åå¸å¯¹ Volcano çæ··é¨è½åè¿è¡äºå¨é¢æ¹è¿ï¼å¶ä¸­ä¸ä¸ªéè¦éç¨ç¢æ¯ï¼Volcano æ··é¨è½å<strong>æ­£å¼æ¯æéç¨æä½ç³»ç»</strong>ï¼UbuntuãCentOS ç­ï¼ï¼ä¸åå±éäº OpenEulerãè¿æå³çæ´å¤ç¨æ·å¯ä»¥ä½¿ç¨ Volcano Agent å®ç°å¨ç¦»çº¿æ··é¨ï¼æåéç¾¤æ´ä½èµæºå©ç¨çã</p>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>CPU å¨æåå¶ (CPU Suppression)</strong></span></span></h3>
<p data-tool="mdniceç¼è¾å¨">å¨çº¿ä¸å¡æµééå¸¸å·ææ½®æ±ç¹æ§ãä¸ºäºå¨ä¿éå¨çº¿ä¸å¡ SLA çåæ¶æå¤§åèµæºå©ç¨ï¼ç¦»çº¿ Pod ç CPU éé¢éè¦éå¨çº¿ç¨éå¨æè°æ´ï¼å¨çº¿ç¨éé«æ¶åå¶ç¦»çº¿éé¢ï¼ç¨éåè½æ¶éæ­¥æ¢å¤ï¼å®ç°èªéåºçèµæºåéã</p>
<p data-tool="mdniceç¼è¾å¨">æ ¸å¿è®¾è®¡ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li>æ ¹æ®èç¹å¯åé CPU åå®æ¶ç¨éï¼å¨æè°æ´ BestEffort root cgroup ç CPU éé¢ã</li>
<li>éç¨"çæ§-äºä»¶-å¤ç"æ¶æï¼å¹¶å®æ½ä¿å®æ´æ°ç­ç¥ï¼æææå¶æå¨ã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">éç½®ç¤ºä¾ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">cpuThrottlingConfig:

enable: true

cpuThrottlingThreshold: 80 # BE éé¢ä¸éä¸ºå¯åé CPU ç 80%

cpuJitterLimitPercent: 1 # éé¢ååè¶è¿ 1% æè§¦åæ´æ°
cpuRecoverLimitPercent: 10 # åæ¬¡æ¢å¤ä¸é 10%</pre>
</div>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>åå­ QoS (Cgroup V2)</strong></span></span></h3>
<p data-tool="mdniceç¼è¾å¨">åºäº Cgroup V2 å®ç°æ··é¨åºæ¯çåå­éç¦»ãæ°å¢ ColocationConfiguration CRDï¼æ¯æä¸ºæå®å·¥ä½è´è½½éç½®åå­ QoS ç­ç¥ã</p>
<p data-tool="mdniceç¼è¾å¨">æ ¸å¿è½åï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>New API</strong>ï¼éè¿æ ç­¾éæ©å¨å®ä¹åå­éç¦»ç­ç¥ç ColocationConfiguration CRD</li>
<li><strong>å¨æè®¡ç®</strong>ï¼
<ul>
<li>memory.high = pod.limits.memory * highRatio %</li>
<li>memory.low = pod.requests.memory * lowRatio %</li>
<li>memory.min = pod.requests.memory * minRatio %</li>
</ul>
</li>
<li><strong>ç»ä¸æ¥å£</strong>ï¼å¯é æ£æµåæ¯æ Cgroup V2 ç¯å¢</li>
</ul>
<p data-tool="mdniceç¼è¾å¨">ä½¿ç¨ç¤ºä¾ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">apiVersion: config.volcano.sh/v1alpha1

kind: ColocationConfiguration

metadata:

name: colo-config1

spec:

selector:

*matchLabels:*

  *app: offline-test*
memoryQos:

*highRatio: 100  \# memory.high \= memory.limits \* 100%*

*lowRatio: 50    \# memory.low \= memory.requests \* 50%*  
*minRatio: 0     \# memory.min \= memory.requests \* 0%*</pre>
</div>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>CPU Burst ä¸ Cgroup V2 å¨é¢æ¯æ</strong></span></span></h3>
<p data-tool="mdniceç¼è¾å¨">CPU Burst è½åå·²æ©å±è³éç¨æä½ç³»ç»ãåæ¶ï¼Volcano Agent ç°å·²å¨é¢éé Cgroup V2 ç¯å¢ï¼æ¯æèªå¨æ£æµ Cgroup çæ¬åé©±å¨ç±»åï¼å¦ systemd driverï¼ï¼æ éäººå·¥å¹²é¢å³å¯å¨ç°ä»£ Linux åè¡çä¸æ ç¼è¿è¡ã</p>
<p data-tool="mdniceç¼è¾å¨">ç¸å³ PRï¼</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4632,</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4945,</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4913,</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4984</p>
<p data-tool="mdniceç¼è¾å¨">è®¾è®¡ææ¡£ï¼<strong>CPU Throttle Design</strong>[6], <strong>Agent Cgroup V2 Adaptation</strong>[7]</p>
<p data-tool="mdniceç¼è¾å¨">æè°¢ç¤¾åºå¼åèï¼@Haibara-Ai97, @JesseStutler, @ouyangshengjia</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>æè¾ vNPU è°åº¦</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">v1.14 åçéæäºæè¾ vNPUï¼èæ NPUï¼è°åº¦è½åï¼å®ç°æè¾ AI å¤çå¨å¨å¤ä¸ªå·¥ä½è´è½½ä¹é´çé«æç®åå¤ç¨ãæä¾ä¸¤ç§æ¨¡å¼ï¼çµæ´»ééä¸åé¨ç½²åºæ¯ã</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ¯ææ¨¡å¼</strong>ï¼</p>
<p data-tool="mdniceç¼è¾å¨"><strong>1. MindCluster æ¨¡å¼</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>éæèª Ascend MindCluster è°åº¦æä»¶ï¼https://gitcode.com/Ascend/mind-cluster
<ul>
<li>æ¯ææè¾ 310P ç³»åçå¨æèæå</li>
</ul>
</li>
</ul>
<p data-tool="mdniceç¼è¾å¨"><strong>2. HAMi æ¨¡å¼</strong></p>
<ul data-tool="mdniceç¼è¾å¨">
<li>ç± HAMi ç¤¾åºå¼å
<ul>
<li>åæ¶æ¯ææè¾ 310 å 910 ç³»å</li>
<li>æ¯æå¼ææè¾éç¾¤ï¼910Aã910B2ã910B3ã310Pï¼</li>
</ul>
</li>
</ul>
<p data-tool="mdniceç¼è¾å¨">è°åº¦å¨éç½®ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;"># MindCluster æ¨¡å¼

- name: deviceshare

arguments:

*deviceshare.AscendMindClusterVNPUEnable: true*
# HAMi æ¨¡å¼

- name: deviceshare

arguments:

*deviceshare.AscendHAMiVNPUEnable: true*  
*deviceshare.SchedulePolicy: binpack  \# æ spread*</pre>
</div>
<p data-tool="mdniceç¼è¾å¨">ç¸å³ PRï¼</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4656,<br>
https://github.com/volcano-sh/volcano/pull/4717<br>
ä½¿ç¨ææ¡£ï¼<strong>How to Use vNPU</strong>[8]<br>
æè°¢ç¤¾åºå¼åèï¼@JackyTYang, @DSFans2014</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>Volcano Global å¢å¼º</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">Volcano Global v0.3.0 å¼å¥äºä¸¤ä¸ªéè¦åè½ï¼éè¿åºäºè®¡ç®èµæºåæ°æ®å±é¨æ§çæºè½è°åº¦ï¼æ¾èæ©å±äº Volcano Global å¯¹ AI/ML åå¤§æ°æ®å·¥ä½è´è½½çè½åã</p>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>HyperJobï¼å¤éç¾¤ä½ä¸èªå¨æå</strong></span></span></h3>
<p data-tool="mdniceç¼è¾å¨">éç AI è®­ç»å·¥ä½è´è½½è§æ¨¡åå¤ææ§çå¢é¿ï¼ä¼ä¸è¶æ¥è¶é¢ä¸´è·¨å¤ä¸ªå¼æéç¾¤ç®¡çå¤§è§æ¨¡è®­ç»ä½ä¸çææãHyperJob æ¯æå»ºå¨ Volcano Job ä¹ä¸çæ´é«çº§æ½è±¡ãå®ç»åå¤ä¸ª Volcano Job æ¨¡æ¿ï¼å°è®­ç»è½åæ©å±å°åéç¾¤è¾¹çä¹å¤ï¼åæ¶ä¿çæ¯ä¸ªéç¾¤åç°æ Volcano Job çå¨é¨è½åã</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ ¸å¿è½å</strong>ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>Karmada æ·±åº¦éæ</strong>ï¼èªå¨çæ PropagationPolicyï¼ç²¾åéç½®éç¾¤äº²åæ§ä¸å¯æ¬è°åº¦ã</li>
<li><strong>ç¶æç»ä¸èå</strong>ï¼å°åéç¾¤å­ä»»å¡ç¶ææ±æ»ä¸ºç»ä¸ç HyperJob ç¶æï¼å¨å±å¯è§æµã</li>
<li><strong>èªå¨èµæºçæ</strong>ï¼æ ¹æ® ReplicatedJob å®ä¹èªå¨åå»º VCJob å PropagationPolicyã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">HyperJob èµæºç¤ºä¾ï¼è·¨ 2 ä¸ªéç¾¤æåå¤§è§æ¨¡è®­ç»ä½ä¸ï¼å± 256 ä¸ª GPUï¼ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:csharp;gutter:true;">apiVersion: training.volcano.sh/v1alpha1

kind: HyperJob

metadata:

name: llm-training

spec:

replicatedJobs:

- name: trainer

replicas: 2

templateSpec:

  tasks:

  \- name: worker

    replicas: 128

    template:

      spec:

        containers:

        \- name: trainer

          image: training-image:v1

          resources:

            requests:  
              nvidia.com/gpu: 1</pre>
</div>
<h3 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>æ°æ®æç¥è°åº¦</strong></span></span></h3>
<p data-tool="mdniceç¼è¾å¨">å¨ AI è®­ç»åå¤§æ°æ®åæç­é«æ§è½è®¡ç®åºæ¯ä¸­ï¼ä»»å¡æ§è¡ä¸ä»ä¾èµè®¡ç®èµæºï¼è¿ä¸¥éä¾èµæ°æ®èµæºãå¨å¤éç¾¤ç¯å¢ä¸­ï¼è°åº¦å¨å¯è½ä¼å°ä»»å¡åæ´¾å°ä¸æ°æ®æºç©çè·ç¦»è¾è¿çéç¾¤ï¼å¯¼è´è·¨å°åå¸¦å®½ææ¬è¿é«å I/O å»¶è¿è¿é«ã</p>
<p data-tool="mdniceç¼è¾å¨">æ°æ®æç¥è°åº¦æ¡æ¶å¼å¥ <strong>DataDependencyController</strong>ï¼æéäºé»è¾æ°æ®éæ±ä¸ç©çéç¾¤åå¸çå£åãéè¿å¤é¨æä»¶ï¼å¦ Amoroï¼å®æ¶è·åæ°æ®åå¸ä¿¡æ¯ï¼èªå¨å°è°åº¦çº¦ææ³¨å¥ Karmadaï¼å®ç°"è®¡ç®éæ°æ®èå¨"çå¨èªå¨å·¥ä½æµã</p>
<p data-tool="mdniceç¼è¾å¨"><strong>æ ¸å¿è½å</strong>ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>æä»¶åæ¶æ</strong>ï¼å¯æ©å±æ¯æ AmoroãHiveãS3 ç­å¤ç§æ°æ®ç³»ç»ã</li>
<li><strong>å£°æå¼ API</strong>ï¼DataSourceClaim / DataSource CRDï¼éç¨"å£°æ-ç¼å­"æ¨¡å¼ã</li>
<li><strong>èªå¨äº²åæ³¨å¥</strong>ï¼å°æ°æ®å±é¨æ§è½¬åä¸º ClusterAffinity çº¦æï¼æ³¨å¥ ResourceBindingã</li>
</ul>
<p data-tool="mdniceç¼è¾å¨">è¯¦è§ï¼ <strong>Volcano Global v0.3.0 Release Notes</strong>[9]<br>
æè°¢ç¤¾åºå¼åèï¼@JesseStutler, @fx147, @Monokaix, @zhoujinyu, @anryko, @tanberBro</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>Volcano Dashboard v0.2.0</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">Volcano Dashboard v0.2.0 å¯¹èµæºç®¡çè½åè¿è¡äºéå¤§å¢å¼ºï¼ä½¿å¾éè¿ Web çé¢ç®¡ç Volcano èµæºæ´å ä¾¿æ·ã<br>
<strong>æ ¸å¿å¢å¼º</strong>ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>PodGroup å¨æ¯å¯è§å</strong>ï¼è·¨å½åç©ºé´æ¥çãæç´¢ãè¿æ»¤ PodGroupï¼æ¯æ YAML è¯­æ³é«äº®ã</li>
<li><strong>Job çå½å¨æç®¡ç</strong>ï¼ç´æ¥å¨çé¢åå»ºãå é¤ Volcano Jobï¼æä½æ´ä¾¿æ·ã</li>
<li><strong>Queue ç®¡çå¢å¼º</strong>ï¼å¨çº¿ç¼è¾ Queue éé¢ãæéï¼æ¯æ YAML ç´æ¥ä¿®æ¹ã</li>
<li><strong>å®å¨å åº</strong>ï¼é»è®¤éç½® SELinuxãSeccompãé root è¿è¡åç¦æ­¢ææï¼ä¿éçäº§å®å¨ã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">è¯¦è§ï¼ <strong>Volcano Dashboard v0.2.0 Release Notes</strong>[10]<br>
æè°¢ç¤¾åºå¼åèï¼@vzhou-p, @Shrutim1505, @JesseStutler, @karanBRAVO, @Sayan4444, @jayesh9747, @Alivestars24, @kuldeep, @Monokaix</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>è°åº¦å¨ç¨³å®æ§ä¸æ§è½æå</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨"><strong>Reclaim éæä¸å¢å¼º</strong><br>
å¯¹ Reclaim Action è¿è¡äºå¨é¢éæï¼å¹¶ä¿®å¤äº Capacity Plugin ä¸­çå³é®é»è¾é®é¢ï¼å¤§å¹æåå¤ç§æ·éç¾¤èµæºåæ¶çåç¡®æ§ãç¨³å®æ§åæ§è½ã<br>
ä¸»è¦æ¹è¿ï¼</p>
<ul data-tool="mdniceç¼è¾å¨">
<li><strong>Reclaim Action éæ</strong>ï¼éæäº reclaim å·¥ä½æµï¼æé«ä»£ç å¯è¯»æ§ãå¯ç»´æ¤æ§åæµè¯è¦ççã</li>
<li><strong>å¢å¼ºç Capacity Plugin é»è¾</strong>ï¼ä¿®å¤äº reclaimableFn å preemptiveFnï¼æ­£ç¡®å¤çæ éèµæºå¹¶é²æ­¢éè¯¯çæ¢å å³ç­ã</li>
<li><strong>ç¨³å®æ§æå</strong>ï¼è§£å³äºèµæºè®¡ç®ä¸­çè¾¹ç¼æåµï¼é²æ­¢è°åº¦æ­»å¾ªç¯åè¯¯é©±éã</li>

</ul>
<p data-tool="mdniceç¼è¾å¨">ç¸å³ PRï¼</p>
<p data-tool="mdniceç¼è¾å¨">https://github.com/volcano-sh/volcano/pull/4794,<br>
https://github.com/volcano-sh/volcano/pull/4659,<br>
https://github.com/volcano-sh/volcano/pull/4919<br>
æè°¢ç¤¾åºå¼åèï¼@guoqinwill, @hajnalmt</p>
<h2 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>æ¯æ Kubernetes 1.34</strong></span></span></h2>
<p data-tool="mdniceç¼è¾å¨">Volcano çæ¬ç´§è· Kubernetes ç¤¾åºãv1.14 å·²å¨é¢æ¯æææ°ç Kubernetes v1.34ï¼å¹¶éè¿å®æ´çååæµè¯å E2E æµè¯ä¿éåè½ä¸ç¨³å®æ§ã<br>
ç¸å³ PRï¼https://github.com/volcano-sh/volcano/pull/4704<br>
æè°¢ç¤¾åºå¼åèï¼@suyiiyii, @tunedev</p>
<h1 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>æ»ç»ï¼Volcano v1.14.0 â AI æ¶ä»£çç»ä¸è°åº¦å¹³å°</strong></span></span></h1>
<p data-tool="mdniceç¼è¾å¨">Volcano v1.14 æ¯ä¸ä¸ªéç¨ç¢å¼ççæ¬ãéè¿å¼å¥å¤è°åº¦å¨æ¶æå Agent Schedulerï¼Volcano æ­£å¼è¿å¥ç»ä¸è°åº¦å¹³å°æ°é¶æ®µï¼æ¢è½é«æå¤çæ¹é AI è®­ç»ï¼åè½æ»¡è¶³ AI Agent çæè´æ¶å»¶è¦æ±ãç½ç»æææç¥å¢å¼ºãéç¨æä½ç³»ç»æ··é¨æ¯æãæè¾ vNPU éæï¼è¿ä¸æ­¥å¤¯å®äº Volcano å¨ AI åºç¡è®¾æ½é¢åçé¢åå°ä½ã<br>
åæ¶ï¼Volcano Global v0.3.0 éè¿ HyperJob å®ç°å¤§è§æ¨¡åå¸å¼è®­ç»åæ°æ®æç¥è°åº¦ï¼æ©å±äºå¤éç¾¤è½åãVolcano Dashboard v0.2.0 éè¿å¨é¢çèµæºç®¡çåè½æ¾èæ¹åäºç¨æ·ä½éªã</p>
<p data-tool="mdniceç¼è¾å¨"><strong>ç«å³ä½éª Volcano v1.14ï¼å±å¯ AI æ¶ä»£ç»ä¸è°åº¦æ°ç¯ç« ï¼</strong></p>
<p data-tool="mdniceç¼è¾å¨"><strong>v1.14.0 åå¸å°åï¼</strong>https://github.com/volcano-sh/volcano/releases/tag/v1.14.0<br>
<strong>Volcano Global v0.3.0 åå¸å°åï¼</strong>https://github.com/volcano-sh/volcano-global/releases/tag/v0.3.0<br>
<strong>Volcano Dashboard v0.2.0 åå¸å°åï¼</strong>https://github.com/volcano-sh/dashboard/releases/tag/v0.2.0</p>
<h1 data-tool="mdniceç¼è¾å¨"><span class="prefix"><span class="content"><strong>è´   è°¢</strong></span></span></h1>
<p data-tool="mdniceç¼è¾å¨">Volcano v1.14 çæçæ¬ï¼å« Volcano Global v0.3.0ãDashboard v0.2.0ï¼å±æ 55 ä½ç¤¾åºè´¡ç®èåä¸ãè¡·å¿æè°¢æ¯ä¸ä½è´¡ç®èï¼</p>
<table data-draft-node="block" data-draft-type="table" data-size="normal">
<tbody>
<tr><th>@3sunny</th><th>@3th4novo</th><th>@acsoto</th>
</tr>
<tr>
<td>@Alivestars24</td>
<td>@Aman-Cool</td>
<td>@anryko</td>


</tr>
<tr>
<td>@archlitchi</td>
<td>@dafu-wu</td>
<td>@DSFans2014</td>


</tr>
<tr>
<td>@FAUST-BENCHOU</td>
<td>@fengruotj</td>
<td>@Freshwlnd</td>


</tr>
<tr>
<td>@fx147</td>
<td>@goyalpalak18</td>
<td>@guoqinwill</td>


</tr>
<tr>
<td>@Haibara-Ai97</td>
<td>@hajnalmt</td>
<td>@halcyon-r</td>


</tr>
<tr>
<td>@handan-yxh</td>
<td>@JackyTYang</td>
<td>@jayesh9747</td>


</tr>
<tr>
<td>@JesseStutler</td>
<td>@jiahuat</td>
<td>@karanBRAVO</td>


</tr>
<tr>
<td>@kingeasternsun</td>
<td>@kiritoxkiriko</td>
<td>@kube-gopher</td>


</tr>
<tr>
<td>@kuldeep</td>
<td>@LiZhenCheng9527</td>
<td>@medyagh</td>


</tr>
<tr>
<td>@MondayCha</td>
<td>@Monokaix</td>
<td>@mvinchoo</td>


</tr>
<tr>
<td>@neeraj542</td>
<td>@nitindhiman314e</td>
<td>@ouyangshengjia</td>


</tr>
<tr>
<td>@PersistentJZH</td>
<td>@qi-min</td>
<td>@rhh777</td>


</tr>
<tr>
<td>@ruanwenjun</td>
<td>@RushabhMehta2005</td>
<td>@sailorvii</td>


</tr>
<tr>
<td>@Sayan4444</td>
<td>@Shrutim1505</td>
<td>@ssfffss</td>


</tr>
<tr>
<td>@suyiiyii</td>
<td>@tanberBro</td>
<td>@Tau721</td>


</tr>
<tr>
<td>@vzhou-p</td>
<td>@wangyang0616</td>
<td>@weapons97</td>


</tr>
<tr>
<td>@Wonki4</td>
<td>@zhaoqi612</td>
<td>@zhengchenyu</td>


</tr>
<tr>
<td>@zhoujinyu</td>
<td>@zjj2wry</td>
<td>&nbsp;</td>


</tr>


</tbody>


</table>
<p data-tool="mdniceç¼è¾å¨"><strong>ç¸å³é¾æ¥</strong></p>
<p data-tool="mdniceç¼è¾å¨">[1] Volcano: <em>https://volcano.sh/en/</em><br>
[2] Volcano v1.14.0: <em>https://github.com/volcano-sh/volcano/releases/tag/v1.14.0</em><br>
[3] Sharding Controller Design: <em>https://github.com/volcano-sh/volcano/blob/v1.14.0/docs/design/sharding_controller.md</em><br>
[4] Agent Scheduler Design: <em>https://github.com/volcano-sh/volcano/blob/v1.14.0/docs/design/agent-scheduler.md</em><br>
[5] Network Topology Aware Scheduling: <em>https://github.com/volcano-sh/volcano/blob/v1.14.0/docs/design/Network%20Topology%20Aware%20Scheduling.md</em><br>
[6] CPU Throttle Design: <em>https://github.com/volcano-sh/volcano/blob/v1.14.0/docs/design/cpu-throttle-design.md</em><br>
[7] Agent Cgroup V2 Adaptation: <em>https://github.com/volcano-sh/volcano/blob/v1.14.0/docs/design/agent-cgroup-v2-adaptation.md</em><br>
[8] How to Use vNPU: <em>https://github.com/volcano-sh/volcano/blob/v1.14.0/docs/user-guide/how_to_use_vnpu.md</em><br>
[9] Volcano Global v0.3.0 Release Notes: <em>https://github.com/volcano-sh/volcano-global/releases/tag/v0.3.0</em><br>
[10] Volcano Dashboard v0.2.0 Release Notes: <em>https://github.com/volcano-sh/dashboard/releases/tag/v0.2.0</em></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 16:36">2026-02-13 16:35</span>&nbsp;
<a href="https://www.cnblogs.com/huaweiyun">åä¸ºäºå¼åèèç</a>&nbsp;
éè¯»(<span id="post_view_count">87</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19612682);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19612682', targetLink: 'https://www.cnblogs.com/huaweiyun/p/19612682', title: 'Volcano v1.14 éç£åå¸ï¼è¿å AI ç»ä¸è°åº¦æ°çºªå' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ºä»ä¹ç°ä»£ C++ åºé½ç¨ PIMPLï¼ä¸åºå³äºå°è£ãä¾èµä¸å®å¨çæ¼è¿ ]]></title>
    <link>https://www.cnblogs.com/charlee44/p/19616660</link>
    <guid>8e81f508b84fe94d286e066ebb7e17c6</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/charlee44/p/19616660" title="åå¸äº 2026-02-14 21:27">
    <span role="heading" aria-level="2">ä¸ºä»ä¹ç°ä»£ C++ åºé½ç¨ PIMPLï¼ä¸åºå³äºå°è£ãä¾èµä¸å®å¨çæ¼è¿</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        ç³»ç»éè¿°äºå¨ C++ å·¥ç¨ä¸­å¦ä½éè¿ PIMPL æ¯ç¨æ³ï¼å¨åå® RAII èµæºå®å¨çåæä¸ï¼ææè§£è¦å¤´æä»¶ä¾èµãæåç¼è¯æçå¹¶ä¿ææ¥å£ç®æ´ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>å¨ C++ çå·¥ç¨å®è·µä¸­ï¼å¦ä½å¨ä¿è¯èµæºå®å¨ç®¡ççåæ¶ï¼åé¿åå¤´æä»¶æ±¡æåä¸å¿è¦çç¼è¯ä¾èµï¼è¿ä¸ªé®é¢è´¯ç©¿äºç°ä»£ C++ åºè®¾è®¡çæ ¸å¿ãæ¬æå°æ²¿çä¸æ¡æ¸æ°çææ¯æ¼è¿è·¯å¾ï¼æ¢è®¨ä» RAII å°è£åºåï¼åç»å¼è¯­ä¹ãè£¸æéãæºè½æéç­é¶æ®µï¼æç»èµ°å PIMPLï¼Pointer to Implementationï¼ è¿ä¸æçä¸ä¼éçè§£å³æ¹æ¡ã</p>
</blockquote>
<h1 id="1-raiièµæºç®¡ççåºç³">1. RAIIââèµæºç®¡ççåºç³</h1>
<p>C++ çæ ¸å¿å²å­¦ä¹ä¸æ¯ RAIIï¼Resource Acquisition Is Initializationï¼ï¼èµæºï¼åå­ãæä»¶å¥æãç½ç»è¿æ¥ç­ï¼ççå½å¨æåºç±å¯¹è±¡çæé ä¸ææèªå¨ç®¡çãä¾å¦ï¼</p>
<pre><code class="language-cpp">class FileHandle {
    FILE* fp;
public:
    FileHandle(const char* path) : fp(fopen(path, "r")) {}
    ~FileHandle() { if (fp) fclose(fp); }
};
</code></pre>
<p>RAII è®©èµæºç®¡çåå¾å®å¨ï¼å©ç¨ç±»å¯¹è±¡ççå½å¨æï¼å¨æé å½æ°ä¸­ç³è¯·èµæºï¼å¨ææå½æ°ä¸­éæ¾èµæºãå¦æè¿ä¸ªç±»å¯¹è±¡æ¯åºäºæ çå¼å¯¹è±¡ï¼é£ä¹å°±å¯ä»¥èªå¨å®ç°èµæºçç®¡çãå æ­¤ï¼å¨ç°ä»£ C++ ä¸­ï¼ç¸æ¯ä¼ ç»çæéè¯­ä¹ï¼æ´å æå¡ä½¿ç¨åºäº RAII çå¼è¯­ä¹ã</p>
<h1 id="2-å¼è¯­ä¹çè¯±æä¸ä»£ä»·">2. å¼è¯­ä¹çè¯±æä¸ä»£ä»·</h1>
<p>ä½æ¯ï¼å½æä»¬æè¿ç§ææ³ç¨äºå°è£å¤æç»ä»¶ï¼å¦ ONNX æ¨¡åä¼è¯ãæ°æ®åºè¿æ¥æ± ï¼æ¶ï¼é®é¢åºç°äºãçæ³æåµä¸ï¼æä»¬å¸æåä½¿ç¨ std::string ä¸æ ·ï¼ç¨âå¼è¯­ä¹âæä½ä¸ä¸ªå°è£å¯¹è±¡ï¼</p>
<pre><code class="language-cpp">class Embedder {
    Ort::Session session; // å¼æå
public:
    std::vector&lt;float&gt; embed(const std::string&amp; text);
};
</code></pre>
<p>è¿çèµ·æ¥éå¸¸ç®æ´ãé«æãç¬¦åç°ä»£ C++ é£æ ¼ãä½ä¹æå¦å¤ä¸ä¸ªé®é¢ï¼ç ´åäºå°è£ï¼å¯¼è´ä¸å¿è¦çç¯å¢ä¾èµãæç´è§çé®é¢å°±æ¯ <code>Ort::Session</code> çå®æ´å®ä¹å¿é¡»åºç°å¨å¤´æä»¶ä¸­ï¼è¿æå³çä½¿ç¨èå¿é¡»åå« onnxruntime ï¼èè¿ä¸ªå¤´æä»¶å¯è½éè¾¾æ° MB ï¼ä¾èµæ°åä¸ªç³»ç»åºãè¿å°±ä¼é æå¦ä¸é®é¢ï¼</p>
<ul>
<li>ç¼è¯æ¶é´æ´å¢ï¼å¾®å°çæ¹å¨é½éè¦ç¼è¯å¾é¿çæ¶é´ã</li>
<li>å¤´æä»¶è¦åä¸¥éï¼è°ç¨èä½¿ç¨ä¸æ¹ä¾¿ï¼çè³é æç¯å¢æ±¡æã</li>
<li>ABI æå¶èå¼±ï¼åé¨æ¹å¨å¯¼è´ææç¨æ·éç¼è¯ã</li>
</ul>
<h1 id="3-æéè¯­ä¹çåé">3. æéè¯­ä¹çåé</h1>
<p>ä¸ºäºè§£è¦ï¼ä¸ä¸ªæ¯è¾å¥½çåæ³å°±æ¯ä½¿ç¨åç½®å£°æ + æéè¯­ä¹ï¼</p>
<pre><code class="language-cpp">// header
class SessionImpl; // åç½®å£°æ
class Embedder {
    SessionImpl* pimpl;
public:
    Embedder();
    ~Embedder(); // å¿é¡»æå¨ delete
};
</code></pre>
<p>è¿æ ·åç¡®å®åæ­äºç¼è¯ä¾èµï¼ä½ä¹å¼å¥äºæ°çé®é¢ãé£å°±æ¯éè¦æç§ RAII åååå¥½æé å½æ°åææå½æ°ãèä¸æ¦è¦åææå½æ°ï¼ä¹å¾å¾æå³çéè¦åå¦å¤åä¸ªç¹æ®çæåå½æ°ï¼</p>
<ol>
<li>æ·è´æé å½æ°ï¼Copy Constructorï¼</li>
<li>æ·è´èµå¼è¿ç®ç¬¦ï¼Copy Assignment Operatorï¼</li>
<li>ç§»å¨æé å½æ°ï¼Move Constructorï¼</li>
<li>ç§»å¨èµå¼è¿ç®ç¬¦ï¼Move Assignment Operatorï¼</li>
</ol>
<p>è¿æ ·åè¦åéå¸¸å¤çæ ·æ¿ä»£ç ï¼èä¸ä¹å¾å®¹æåºé®é¢ãä¸ºäºå°è£çºç²å®å¨ï¼å¾ä¸å¿å¤±ã</p>
<h1 id="4-ä½¿ç¨æºè½æé">4. ä½¿ç¨æºè½æé</h1>
<p>ä½¿ç¨è£¸æéåéº»ç¦åä¸å®å¨ï¼é£ä¹å°±å¯ä»¥ä½¿ç¨ C++11 å¼å¥çæºè½æéï¼std::unique_ptr å std::shared_ptrï¼æºè½æéåæ ·æ¯åºäº RAII çï¼</p>
<pre><code class="language-cpp">class SessionImpl;
class Embedder {
    std::unique_ptr&lt;SessionImpl&gt; pimpl;
};
</code></pre>
<p>è¿éä¸ºä»ä¹ä½¿ç¨ <code>std::unique_ptr</code> èä¸ä½¿ç¨ <code>std::shared_ptr</code> å¢ï¼å¶å®ä¹å¯ä»¥ï¼ä¸è¿å¨ç°ä»£ C++ ä¸­ï¼æ´æ¨èä½¿ç¨ <code>std::unique_ptr</code> ã<code>std::shared_ptr</code> æ¯ç¨æ¥å±äº«èµæºçæææï¼ä¼å¯¹å¼ç¨èµæºè¿è¡è®¡æ°ï¼ä½æ¯æå¯è½ä¼é æç¸äºå¾ªç¯å¼ç¨é æä¸è½éæ¾èµæºçé®é¢ï¼è<code>std::unique_ptr</code> åè¡¨ç¤ºç¬å èµæºçæææï¼ä¸ä»å¼éæ´ä½ï¼æ å¼ç¨è®¡æ°ï¼ï¼ä¹æ´å å®å¨ï¼åªè½éè¿ <code>std::move</code> è½¬ç§»æææ ï¼ã</p>
<p>ä¸è¿æä¸ç¹éè¦æ³¨æï¼<code>std::unique_ptr</code> å <code>std::shared_ptr</code> å¨å¤çä¸å®æ´ç±»åï¼incomplete typeï¼æ¶çè¡ä¸ºæªç¶ä¸åãå·ä½æ¥è¯´ï¼å½å¨å¤´æä»¶ä¸­ä½¿ç¨åç½®å£°æï¼å¦ <code>class Impl;</code>ï¼å¹¶ç¨æºè½æéææå®æ¶ï¼<code>Impl</code> æ¯ä¸ä¸ªä¸å®æ´ç±»åã</p>
<ul>
<li><code>std::shared_ptr</code> å¯ä»¥å®å¨å°å¨å¤´æä»¶ä¸­é»è®¤ææï¼å ä¸ºå®å¨æé æ¶ï¼éå¸¸å¨ <code>.cpp</code> æä»¶ä¸­ï¼ä¼æè·ä¸ä¸ªå®æ´çå é¤å¨ï¼deleterï¼ï¼å³ä½¿ææåçå¨å¤´æä»¶ä¸ä¸æä¸­ï¼ä¹è½æ­£ç¡®è°ç¨ <code>delete</code>ã</li>
<li>è <code>std::unique_ptr</code> çå é¤å¨æ¯å¶ç±»åçä¸é¨åï¼éå¸¸æ¯é»è®¤ç <code>std::default_delete&lt;Impl&gt;</code>ï¼ï¼å®è¦æ±å¨ææç¹ï¼å³ç±»çææå½æ°è¢«å®ä¾åçå°æ¹ï¼<code>Impl</code> å¿é¡»æ¯å®æ´ç±»åãå¦æå¨å¤´æä»¶ä¸­å <code>~Embedder() = default;</code>ï¼æ­¤æ¶ <code>Impl</code> ä»æ¯ä¸å®æ´çï¼ç¼è¯å¨å¯è½ä¸ä¼æ¥éï¼ä½ä¼å¯¼è´æªå®ä¹è¡ä¸ºï¼éå¸¸æ¯é¾æ¥å¤±è´¥æè¿è¡æ¶å´©æºï¼ã</li>
</ul>
<p>å æ­¤ï¼ä½¿ç¨ <code>std::unique_ptr&lt;Impl&gt;</code> æ¶ï¼å¿é¡»å°ä¸»ç±»çææå½æ°å®ä¹ç§»å° <code>.cpp</code> æä»¶ä¸­ï¼ç¡®ä¿ <code>Impl</code> å·²è¢«å®æ´å®ä¹ï¼</p>
<pre><code class="language-cpp">// Embedder.cpp
class Embedder::Impl {
    // å®æ´å®ä¹...
};

Embedder::~Embedder() = default; // â æ­¤æ¶ Impl å®æ´ï¼å®å¨ææ
</code></pre>
<h1 id="5-å°è£ä¸æççå¹³è¡¡pimpl">5. å°è£ä¸æççå¹³è¡¡ï¼PIMPL</h1>
<p>ä½¿ç¨æºè½æéè½ç¶å¥½ï¼ä½æ¯æ»å½æ¯æ¯ä¸ä¸å¼è¯­ä¹æ¹ä¾¿ãå½ç±»ä¸­åªæä¸ä¸ªéè¦éèçæåè¿å¥½ï¼å¦ææå¾å¤ä¸ªéè¦éèçæåï¼æ¯ä¸ä¸ªé½ååç½®å£°æï¼å¹¶ç¨æºè½æéæ¥ç®¡çï¼é£å°±å®å¨å¤ªç¹çäºãå¹¶ä¸ï¼ä»ç¼ç¨åå³ä¸æ¥è¯´ï¼C++ æºè½æéçåæ³è¯´ä¸ä¸ä¼éï¼æºè½æéæ¯ç±ä¼ ææ§çï¼å½æ»¡å±é½æ¯ <code>std::shared_ptr</code> æè <code>std::unique_ptr</code> çæ¶åï¼å®å¨å¾å½±åéè¯»æ§ã</p>
<p>å¦å¤ï¼ä½ä¸ºå¯¹å¤çæ¥å£ï¼æå¥½æ¯æä¾å Java / C# é£æ ·çæ¥å£ï¼C++ ççº¯èå½ç±»ä¹è¡ï¼éèæææçç»èï¼åæ¬ç§æå½æ°åæ°æ®æåãè¿æ ·æéå¸¸å¤çå¥½å¤ï¼</p>
<ol>
<li>æå°åä¾èµç¯å¢ï¼æåç¼è¯éåº¦ã</li>
<li>è°ç¨èä½¿ç¨æ¹ä¾¿ï¼ä¸ä¼æ±¡æç¯å¢ã</li>
<li>ABI ç¨³å®ï¼å¯ä»¥åªæ´æ°åºèä¸ç¨æ´æ°æ´ä¸ªç¨åºã</li>
</ol>
<p>é£ä¹è¦æä¹è¿è¡ä¼åå¢ï¼å¾ç®åï¼æä»¬å¯ä»¥å®ç°ä¸ä¸ªåä¸º <code>Impl</code> çç±»ä¸­ç±» ï¼ä½¿ç¨<code>std::unique_ptr</code>è¿è¡ç®¡çã<code>Impl</code> æ¯å®ç°å¨ cpp ä¸­çï¼å¯ä»¥å°ä¸åå®ç°çç»èï¼æ¯è¯´ç§æå½æ°åæ°æ®æåï¼é½æ¾å¨è¿ä¸ª <code>Impl</code> ä¸­ãæ´éè¦çæ¯ï¼<code>Impl</code> ä¸­çæ°æ®æåå®å¨å¯ä»¥ä½¿ç¨å¼ç±»åï¼å¦ä¸æç¤ºï¼</p>
<pre><code class="language-cpp">// å¤´æä»¶
class Embedder {
    class Impl;
    std::unique_ptr&lt;Impl&gt; impl;
public:
    Embedder(const std::string&amp; model);
    ~Embedder(); // å£°æä½ä¸å¨å¤´æä»¶å®ä¹ï¼
    std::vector&lt;float&gt; embed(std::string_view text) const;
};
</code></pre>
<pre><code class="language-cpp">// æºæä»¶
class Embedder::Impl {
    Ort::Session session;
    hf::Tokenizer tokenizer;
    int64_t dim;
public:
    Impl(const std::string&amp; path, const hf::Tokenizer&amp; tok) 
        : session(...), tokenizer(tok) { /* init */ }
    std::vector&lt;float&gt; embed(std::string_view text) const { /* ... */ }
};

Embedder::Embedder(const std::string&amp; path) 
    : impl(std::make_unique&lt;Impl&gt;(path, global_tokenizer)) {}

Embedder::~Embedder() = default; // æ­¤æ¶ Impl å®æ´ï¼å®å¨ï¼
</code></pre>
<p>è¿ä¸ªå®ç°ï¼å°±æ¯æè°ç PIMPLï¼Pointer to IMPLementationï¼æ¯ç¨æ³ï¼ä¹å¸¸è¢«ç§°ä½ âç¼è¯é²ç«å¢âï¼Compilation Firewallï¼ æ âOpaque Pointerâ æ¨¡å¼ãä¸å¾ä¸è¯´ï¼è¿ç§ PIMPL è®¾è®¡æ¨¡å¼ç¡®å®ç²¾å¦ââå®å¨å®å¨æ§ãå°è£æ§ãç¼è¯æçä¸æ¥å£ç®æ´æ§ä¹é´åå¾äºè¿ä¹å®ç¾çå¹³è¡¡ï¼æ¢åå®äº RAII çèµæºç®¡çååï¼åææéç¦»äºå®ç°ç»èï¼å ªç§°ç°ä»£ C++ å·¥ç¨å®è·µä¸­âé«åèãä½è¦åâçå¸èã</p>
<h1 id="6-æ²¡æé¶å¼¹åªææè¡¡">6. æ²¡æé¶å¼¹ï¼åªææè¡¡</h1>
<p>PIMPL ä½¿ç¨äºåç½®å£°æãæ¯å¦ä½¿ç¨åç½®å£°æä¸ç´æ¯ C++ ä¸­æ¯è¾äºè®®çä¸ç¹ï¼Qt éµå¾ªåç½®å£°æçååå®ç°äºéå¸¸å¼ºå¤§ãä¼éä¸é«æç C++ è¿è¡æ¶æ¡æ¶ãGoogle åç»åäºä»æ¨èä½¿ç¨åç½®å£°æå°ä¸æ¨èä½¿ç¨åç½®å£°æçè½¬åãä¸ªäººè®¤ä¸ºï¼PIMPL è§£å³çå°±æ¯ C++ ä¸­ä¸¤ä¸ªéè¦ååçç¾çé®é¢ï¼</p>
<ul>
<li>æ¨èä½¿ç¨å¼è¯­ä¹ï¼ä½æ¯ä¼å¼å¥æ´å¤ç¯å¢ä¾èµ</li>
<li>å°è£éè¦å°½å¯è½éèä¸å¿è¦çç»è</li>
</ul>
<p>å¦æä¸¤èåªè½éæ©å¶ä¸­ä¸ä¸ªï¼é£ä¹è¿æ¯å°½éä½¿ç¨å¼è¯­ä¹çååæ´å éè¦ï¼æ¯ç«è¿æ¶åå°å®å¨é®é¢ï¼èèµæºç®¡ççå®å¨é®é¢è´¯ç©¿ C++ ç¨åºçå§ç»ãäºå®ä¸ï¼å¦æä¸æ¯æä¾å¯¹å¤æ¥å£ï¼æèå®ç°æ¯è¾å°ï¼é£ä¹ç´æ¥ä½¿ç¨å¼è¯­ä¹å³å¯ï¼ç¬¬2èä¸­çåå®¹ï¼ââå¼è¯­ä¹æ°¸è¿æ¯æç®æ´å®å¨çå®ç°ã</p>
<p>å¦å¤ï¼å¦æå®ç° C++20 Modules ï¼é£ä¹å°±ä¸å¿è¦ä½¿ç¨ PIMPL äºï¼å®å¨å¯ä»¥åå½å¼è¯­ä¹å®ç°ï¼å ä¸º C++20 Modules å¨è¯­è¨å±é¢å·²ç»å®ç°äº PIMPL çè¯¸å¤ä¼ç¹ã</p>
<h1 id="7-ç¤ºä¾ä»£ç ">7. ç¤ºä¾ä»£ç </h1>
<p>æåæ¾åºç¬èèªå·±å®ç°çåºäº PIMPL çåµå¥å¨çå®æ´ä»£ç ä¾è¯»èåèï¼</p>
<pre><code class="language-cpp">// BgeOnnxEmbedder.h
#pragma once

#include &lt;memory&gt;
#include &lt;string&gt;
#include &lt;vector&gt;

namespace embedding {

namespace hf {
class Tokenizer;
}

class BgeOnnxEmbedder {
 public:
  explicit BgeOnnxEmbedder(const std::string&amp; modelPath,
                           const hf::Tokenizer&amp; tokenizer);
  ~BgeOnnxEmbedder();

  const int64_t&amp; EmbeddingDim() const;

  std::vector&lt;float&gt; Embed(const std::string&amp; text) const;

 private:
  class Impl;  // ååå£°æ
  std::unique_ptr&lt;Impl&gt; impl;
};

}  // namespace embedding
</code></pre>
<pre><code class="language-cpp">//BgeOnnxEmbedder.cpp
#include "BgeOnnxEmbedder.h"

#include &lt;onnxruntime_cxx_api.h&gt;

#include "HfTokenizer.h"
#include "Util/StringEncode.h"

namespace embedding {

class BgeOnnxEmbedder::Impl {
 public:
  Ort::Env&amp; GetOrtEnv() {
    static Ort::Env env(ORT_LOGGING_LEVEL_WARNING, "BgeOnnxEmbedder");
    return env;
  }

  const int64_t&amp; EmbeddingDim() const { return embeddingDim; }

  explicit Impl(const std::string&amp; modelPath, const hf::Tokenizer&amp; tokenizer)
      : session{GetOrtEnv(),
#ifdef _WIN32
                util::StringEncode::Utf8StringToWideString(modelPath).c_str(),
#else
                modelPath.c_str(),
#endif
                Ort::SessionOptions()},
        memInfo{Ort::MemoryInfo::CreateCpu(OrtDeviceAllocator, OrtMemTypeCPU)},
        tokenizer(tokenizer),
        embeddingDim(0) {

    //
    const auto&amp; outputInfo = session.GetOutputTypeInfo(0);
    const auto&amp; tensorInfo = outputInfo.GetTensorTypeAndShapeInfo();
    const auto&amp; shape = tensorInfo.GetShape();

    // åè®¾è¾åºæ¯ [batch, seq, dim] æ [batch, dim]
    // æä»¬åæåä¸ä¸ªé -1 çç»´åº¦
    for (auto it = shape.rbegin(); it != shape.rend(); ++it) {
      if (*it != -1) {
        embeddingDim = *it;
        break;
      }
    }

    if (embeddingDim == 0) {
      throw std::runtime_error(
          "Failed to infer embedding dimension from ONNX model.");
    }
  }

  std::vector&lt;float&gt; Embed(const std::string&amp; text) const {
    hf::Tokenizer::ResultPtr result = tokenizer.Encode(text);
    if (!result) {
      throw std::runtime_error("tokenizer_encode failed");
    }

    // å®ä¹å¼ éç»´åº¦
    int64_t seqLen = static_cast&lt;int64_t&gt;(result-&gt;length);
    std::vector&lt;int64_t&gt; inputShape = {1, seqLen};
    size_t dataByteCount = sizeof(int64_t) * seqLen;

    Ort::Value inputIdsTensor = Ort::Value::CreateTensor(
        memInfo.GetConst(), result-&gt;input_ids, dataByteCount, inputShape.data(),
        inputShape.size(),
        ONNXTensorElementDataType::ONNX_TENSOR_ELEMENT_DATA_TYPE_INT64);

    Ort::Value attentionMaskTensor = Ort::Value::CreateTensor(
        memInfo.GetConst(), result-&gt;attention_mask, dataByteCount,
        inputShape.data(), inputShape.size(),
        ONNXTensorElementDataType::ONNX_TENSOR_ELEMENT_DATA_TYPE_INT64);

    Ort::Value tokenTypeIdsTensor = Ort::Value::CreateTensor(
        memInfo.GetConst(), result-&gt;token_type_ids, dataByteCount,
        inputShape.data(), inputShape.size(),
        ONNXTensorElementDataType::ONNX_TENSOR_ELEMENT_DATA_TYPE_INT64);

    // è¾å¥åå¿é¡»ä¸æ¨¡åå®ä¹ä¸è´
    const char* inputNames[] = {"input_ids", "attention_mask",
                                "token_type_ids"};
    const char* outputNames[] = {"last_hidden_state"};

    // æä¸ä¸ªè¾å¥å¼ éæ¾è¿æ°ç»
    std::vector&lt;Ort::Value&gt; inputs;
    inputs.push_back(std::move(inputIdsTensor));
    inputs.push_back(std::move(attentionMaskTensor));
    inputs.push_back(std::move(tokenTypeIdsTensor));

    // æ§è¡æ¨ç
    auto outputs = session.Run(Ort::RunOptions(),  // è¿è¡éé¡¹ï¼éå¸¸ nullptrï¼
                               inputNames,         // è¾å¥åæ°ç»
                               inputs.data(),  // è¾å¥å¼ éæ°ç»
                               inputs.size(),  // è¾å¥æ°éï¼3ï¼
                               outputNames,    // è¾åºåæ°ç»
                               1               // è¾åºæ°éï¼1ï¼
    );

    // è·åè¾åºä¿¡æ¯
    auto&amp; output_tensor = outputs[0];
    auto output_shape = output_tensor.GetTensorTypeAndShapeInfo().GetShape();
    if (output_shape.size() != 3 || output_shape[0] != 1) {
      throw std::runtime_error("Unexpected output shape");
    }

    // è·åè¾åºå¼ éçåå§ float æé
    const float* outputData = outputs[0].GetTensorData&lt;float&gt;();

    // æå [CLS] token ç embeddingï¼ç¬¬0ä¸ªtokenï¼
    int64_t hiddenSize = output_shape[2];
    std::vector&lt;float&gt; embedding(outputData, outputData + hiddenSize);

    // L2 å½ä¸åï¼BGE è¦æ±ï¼
    float norm = 0.0f;
    for (float v : embedding) norm += v * v;
    norm = std::sqrt(norm);
    if (norm &gt; 1e-8) {
      for (float&amp; v : embedding) v /= norm;
    }

    return embedding;
  }

 private:
  mutable Ort::Session session;
  Ort::MemoryInfo memInfo;
  const hf::Tokenizer&amp; tokenizer;
  int64_t embeddingDim;
};

BgeOnnxEmbedder::BgeOnnxEmbedder(const std::string&amp; modelPath,
                                 const hf::Tokenizer&amp; tokenizer)
    : impl(std::make_unique&lt;Impl&gt;(modelPath, tokenizer)) {}

BgeOnnxEmbedder::~BgeOnnxEmbedder() = default;  // æ­¤æ¶ Impl å·²å®ä¹ï¼å¯å®å¨ææ

const int64_t&amp; BgeOnnxEmbedder::EmbeddingDim() const {
  return impl-&gt;EmbeddingDim();
}

std::vector&lt;float&gt; BgeOnnxEmbedder::Embed(const std::string&amp; text) const {
  return impl-&gt;Embed(text);
}

}  // namespace embedding
</code></pre>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-14 21:28">2026-02-14 21:27</span>&nbsp;
<a href="https://www.cnblogs.com/charlee44">charlee44</a>&nbsp;
éè¯»(<span id="post_view_count">6</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19616660);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19616660', targetLink: 'https://www.cnblogs.com/charlee44/p/19616660', title: 'ä¸ºä»ä¹ç°ä»£ C++ åºé½ç¨ PIMPLï¼ä¸åºå³äºå°è£ãä¾èµä¸å®å¨çæ¼è¿' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ linuxå­ç¬¦è®¾å¤é©±å¨ ]]></title>
    <link>https://www.cnblogs.com/cear/p/19616290</link>
    <guid>e1d8d7c150adabf5bb3d1c842f062d48</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/cear/p/19616290" title="åå¸äº 2026-02-14 17:57">
    <span role="heading" aria-level="2">linuxå­ç¬¦è®¾å¤é©±å¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        Linuxå­ç¬¦è®¾å¤é©±å¨ä¸­çåæ ¸å½æ°è®²è§£åä½¿ç¨å®ä¾
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h2>1.å­ç¬¦è®¾å¤é©±å¨ç¸å³ç³»ç»å½æ°ç®ä»</h2>
<h3>1.1 container_of</h3>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)">*
 * container_of éè¿ä¸ä¸ªç»æä½æåçæéï¼è·ååå«è¯¥æåçç»æä½çèµ·å§å°å
 * @ptr:        åéçæé
 * @type:       æéæåçç»æä½ç±»å
 * @member:     ç»æä½ä¸­çåéç±»å
 </span><span style="color: rgba(0, 128, 0, 1)">*/</span>
<span style="color: rgba(0, 0, 255, 1)">#define</span> container_of(ptr, type, member) ({              \
    <span style="color: rgba(0, 0, 255, 1)">void</span> *__mptr = (<span style="color: rgba(0, 0, 255, 1)">void</span> *<span style="color: rgba(0, 0, 0, 1)">)(ptr);                   \
    BUILD_BUG_ON_MSG(</span>!__same_type(*(ptr), ((type *)<span style="color: rgba(128, 0, 128, 1)">0</span>)-&gt;member) &amp;&amp;<span style="color: rgba(0, 0, 0, 1)">   \
                     </span>!__same_type(*(ptr), <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)">),            \
                     </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">pointer type mismatch in container_of</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">); \
    ((type </span>*)(__mptr - offsetof(type, member))); })</pre>
</div>
<p>ä¸ºäºç®åçè§£ï¼å¯ä»¥å°&nbsp;<span class="cnblogs_code">container_of</span>&nbsp;å½æ°çè§£ä¸ºå¦ä¸è¡¨ç¤º</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">#define</span> container_of(ptr, type, member) \<span style="color: rgba(0, 0, 0, 1)">
    ((type </span>*)((<span style="color: rgba(0, 0, 255, 1)">char</span> *)(ptr) - offsetof(type, member)))</pre>
</div>
<p>è¯¥å½æ°æ ¹æ® ç»æä½æååéçæéï¼éè¿è¯¥åéç¸å¯¹äºç»æä½çåç§»ï¼å¾å°äºè¯¥åéå¯¹åºçç»æä½çæéã</p>
<p>è¿æ¯ä¸ä¸ªéå¸¸çµæ´»çç¨æ³ï¼éè¿ä¿å­æä¸ªç»æä½åéçæéï¼å¯ä»¥éè¿è¯¥æéååæ¨åºè¯¥ç»æä½çæéãå¨åç»­æ¡ä¾ä¸­æè¯¦ç»è§£éã</p>
<h3>1.2 register_chrdev_region</h3>
<p class="ds-markdown-paragraph">&nbsp;<span class="cnblogs_code">register_chrdev_region</span> æ¯ Linux åæ ¸ä¸­ç¨äºæ³¨åå­ç¬¦è®¾å¤ç¼å·èå´çå½æ°ãè¯¥å½æ°ä¸ºé©±å¨ç¨åºé¢çä¸æ®µè¿ç»­çè®¾å¤å·ï¼ä¸»è®¾å¤å· + èµ·å§æ¬¡è®¾å¤å·ï¼ï¼åç»­å°å­ç¬¦è®¾å¤ï¼éè¿ &nbsp;<span class="cnblogs_code">cdev_add</span>&nbsp;ï¼ç»å®å°è¿äºè®¾å¤å·ä¸ï¼å½æ°ååå¦ä¸</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)">*
 * firstï¼dev_t ç±»åï¼æå®è¦æ³¨åçèµ·å§è®¾å¤å·ãä½¿ç¨ MKDEV(major, minor) å®çæ
 * countï¼éè¦æ³¨åçè¿ç»­è®¾å¤å·æ°éï¼æ¬¡è®¾å¤å·çèå´ï¼
 * nameï¼è®¾å¤çåç§°ï¼è¯¥åç§°ä¼åºç°å¨ /proc/devices æä»¶ä¸­ï¼ç¨äºæ è¯è¯¥ç»è®¾å¤å·å±äºåªä¸ªé©±å¨ã
 * è¿åå¼: æåè¿å0
 *        åæ°æ æè¿å     -EINVAL
 *        è®¾å¤å·è¢«å ç¨è¿å -EBUSY
</span><span style="color: rgba(0, 128, 0, 1)">*/</span>
<span style="color: rgba(0, 0, 255, 1)">int</span> register_chrdev_region(dev_t first, unsigned <span style="color: rgba(0, 0, 255, 1)">int</span> count, <span style="color: rgba(0, 0, 255, 1)">const</span> <span style="color: rgba(0, 0, 255, 1)">char</span> *name);</pre>
</div>
<h3>1.3 cdev_init</h3>
<p>&nbsp;<span class="cnblogs_code"><span style="color: rgba(0, 0, 255, 1)">struct</span> cdev</span>&nbsp;æ¯åæ ¸è¡¨ç¤ºå­ç¬¦è®¾å¤çå¯¹è±¡ï¼æ¯ä¸ªå­ç¬¦è®¾å¤é©±å¨é½éè¦åå»º&nbsp;<span class="cnblogs_code">cdev</span> å®ä¾ï¼å¹¶å°å¶æ³¨åå°åæ ¸</p>
<p>&nbsp;<span class="cnblogs_code">cdev_init</span>&nbsp;&nbsp;è´è´£è®¾ç½® <span class="cnblogs_code">cdev</span> çåºæ¬å­æ®µï¼ä¸ºåç»­ç <span class="cnblogs_code">cdev_add</span>ååå¤</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)">
 * devï¼æåè¦åå§åç struct cdev ç»æä½çæéã
 *       è¯¥ç»æä½å¯ä»¥ç±é©±å¨éæåé (kmalloc) ï¼ä¹å¯ä»¥å¨æåé (cdev_alloc)
 * fopsï¼æå struct file_operations ç»æä½çæé
 *       è¯¥ç»æä½åå«äºè®¾å¤æ¯æçåç§æä½å½æ°ï¼å¦ openãreadãwriteãioctl ç­ï¼
</span><span style="color: rgba(0, 128, 0, 1)">*/</span>
<span style="color: rgba(0, 0, 255, 1)">void</span> cdev_init(<span style="color: rgba(0, 0, 255, 1)">struct</span> cdev *cdev, <span style="color: rgba(0, 0, 255, 1)">const</span> <span style="color: rgba(0, 0, 255, 1)">struct</span> file_operations *<span style="color: rgba(0, 0, 0, 1)">fops)
{
    memset(cdev, </span><span style="color: rgba(128, 0, 128, 1)">0</span>, <span style="color: rgba(0, 0, 255, 1)">sizeof</span> *<span style="color: rgba(0, 0, 0, 1)">cdev);
    INIT_LIST_HEAD(</span>&amp;cdev-&gt;<span style="color: rgba(0, 0, 0, 1)">list);
    kobject_init(</span>&amp;cdev-&gt;kobj, &amp;<span style="color: rgba(0, 0, 0, 1)">ktype_cdev_default);
    cdev</span>-&gt;ops =<span style="color: rgba(0, 0, 0, 1)"> fops;
}</span></pre>
</div>
<h3>1.4 cdev_add</h3>
<p>è¯¥å½æ°å»ºç«äºè®¾å¤å·ä¸å­ç¬¦è®¾å¤é©±å¨çå³èï¼ä½¿ VFSï¼èææä»¶ç³»ç»ï¼è½å¤éè¿è®¾å¤å·æ¾å°å¯¹åºçé©±å¨ç¨åºï¼ä»èååºç¨æ·ç©ºé´çæå¼ãè¯»åç­æä½</p>
<ul>
<li>å°&nbsp;<span class="cnblogs_code"><span style="color: rgba(0, 0, 255, 1)">struct</span> cdev</span>&nbsp;å¯¹è±¡ä¸è®¾å¤å·ç»å®ï¼å¨åæ ¸çå­ç¬¦è®¾å¤æ å°è¡¨ä¸­å»ºç«å³è</li>
<li>å°&nbsp;<span class="cnblogs_code">cdev</span>&nbsp;å¯¹è±¡å å¥åæ ¸çå¨å±å­ç¬¦è®¾å¤é¾è¡¨æåå¸è¡¨ï¼ä½¿ VFS è½å¤æ ¹æ®è®¾å¤å·æ¾å°å¯¹åºç<span class="cnblogs_code">cdev</span>&nbsp;</li>
<li>æ¿æ´»è®¾å¤ï¼è°ç¨&nbsp;<span class="cnblogs_code">cdev_add</span>&nbsp;åï¼è¯¥è®¾å¤ä¾¿å¯ä»¥è¢«ç¨æ·ç©ºé´è®¿é®ï¼éè¦ä½¿ç¨<code>mknod</code>å³èå°<code>/dev/mydevname</code>ï¼</li>
</ul>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)">
 * pï¼æå cdev_init() å·²ç»åå§åç struct cdev å¯¹è±¡çæéã
 * devï¼åéç»è¯¥è®¾å¤çèµ·å§è®¾å¤å·ï¼åºè¯¥ä¸ register_chrdev_region() ååæ ¸ç³è¯·çè®¾å¤å·ä½ç½®ä¸è´
 * countï¼ä¸è¯¥è®¾å¤å³èçæ¬¡è®¾å¤å·æ°é
 * è¿åå¼ï¼æå 0
          åæ°æ æ    -EINVAL
          è®¾å¤å·è¢«å ç¨ -EBUSY ï¼çè®ºä¸å¨åéè®¾å¤å·æ¶å·²ç»æ£æ¥è¿ï¼ä½è¿éä»å¯è½åçï¼å¦å¨ææ·»å æ¶ç«äºï¼
          åå­ä¸è¶³    -ENOMEM
</span><span style="color: rgba(0, 128, 0, 1)">*/</span>
<span style="color: rgba(0, 0, 255, 1)">int</span> cdev_add(<span style="color: rgba(0, 0, 255, 1)">struct</span> cdev *p, dev_t dev, unsigned count);</pre>
</div>
<h2>2. ä½¿ç¨å­ç¬¦è®¾å¤é©±å¨å®ç°å±äº«åå­</h2>
<p>ä¸é¢æ¯ä½¿ç¨å­ç¬¦è®¾å¤é©±å¨å®ç°å±äº«åå­çæ¡ä¾ï¼ç¨æ¥å¿«éçæé©±å¨å½æ°çä½¿ç¨æ¹æ³ï¼ä»£ç åèä¹¦ç±ä¸ºLinuxè®¾å¤é©±å¨è¯¦è§£</p>
<div class="cnblogs_code">
<pre>#include &lt;linux/init.h&gt;<span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;linux/errno.h&gt;<span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;linux/mm.h&gt;<span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;linux/sched.h&gt;<span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;linux/module.h&gt;<span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;linux/ioctl.h&gt;<span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;linux/io.h&gt;<span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;linux/fs.h&gt;<span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;linux/cdev.h&gt;<span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;linux/uaccess.h&gt;<span style="color: rgba(0, 0, 0, 1)">
#include </span>&lt;linux/slab.h&gt;

<span style="color: rgba(0, 0, 255, 1)">#define</span> GLOBALMEM_SIZE    1024
<span style="color: rgba(0, 0, 255, 1)">#define</span> GLOBALMEM_MAGIC    'M'
<span style="color: rgba(0, 0, 255, 1)">#define</span> MEM_CLEAR        _IO(GLOBALMEM_MAGIC, 0)

<span style="color: rgba(0, 0, 255, 1)">struct</span><span style="color: rgba(0, 0, 0, 1)"> globalmem_dev 
{
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å­ç¬¦è®¾å¤</span>
    <span style="color: rgba(0, 0, 255, 1)">struct</span><span style="color: rgba(0, 0, 0, 1)"> cdev m_cdev;
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å±äº«åå­</span>
    unsigned <span style="color: rgba(0, 0, 255, 1)">char</span><span style="color: rgba(0, 0, 0, 1)"> mem[GLOBALMEM_SIZE];
};


</span><span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">int</span> globalmem_major = <span style="color: rgba(128, 0, 128, 1)">266</span><span style="color: rgba(0, 0, 0, 1)">;

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å­æ¾ä¸¤ä¸ªå­ç¬¦è®¾å¤ç§ææ°æ®</span>
<span style="color: rgba(0, 0, 255, 1)">struct</span> globalmem_dev*<span style="color: rgba(0, 0, 0, 1)"> globalmem_devp;


</span><span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)"> user open fd </span><span style="color: rgba(0, 128, 0, 1)">*/</span>
<span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">int</span> globalmem_open(<span style="color: rgba(0, 0, 255, 1)">struct</span> inode* inode, <span style="color: rgba(0, 0, 255, 1)">struct</span> file*<span style="color: rgba(0, 0, 0, 1)"> filp) {
    
    </span><span style="color: rgba(0, 0, 255, 1)">struct</span> globalmem_dev*<span style="color: rgba(0, 0, 0, 1)"> dev;
    </span><span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)"> ä¸é¢æ¯ä¸ç§å¸¸ç¨çåºåæ¬¡è®¾å¤å·çæ¹æ³
     * éè¿ globalmem_init åå§åæ¶ä¼ å¥ä¸åç cdev æéå®ç°åºå </span><span style="color: rgba(0, 128, 0, 1)">*/</span>
    <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> inode ä¸­ä¿å­ç i_cdev æéæ¯ globalmem_init å½æ°ä¸­ä¼ å¥çï¼globalmem_dev ç»æä½åé m_cdev çæé
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æä»¥éè¿ inode-&gt;i_cdev æéï¼å³ m_cdev æååéçæéï¼å¯ä»¥æ¾å°å¶å¯¹åºçç»æä½æé</span>
    dev = container_of(inode-&gt;i_cdev, <span style="color: rgba(0, 0, 255, 1)">struct</span><span style="color: rgba(0, 0, 0, 1)"> globalmem_dev, m_cdev);

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å°è®¾å¤ç»æä½æéä¼ ç»æä»¶ç§ææ°æ®æéï¼æä¾ç»å¶ä»å½æ°è°ç¨æ¶ä½¿ç¨</span>
    filp-&gt;private_data =<span style="color: rgba(0, 0, 0, 1)"> dev;
    </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
}


</span><span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)"> user release fd</span><span style="color: rgba(0, 128, 0, 1)">*/</span>
<span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">int</span> globalmem_release(<span style="color: rgba(0, 0, 255, 1)">struct</span> inode* inode, <span style="color: rgba(0, 0, 255, 1)">struct</span> file*<span style="color: rgba(0, 0, 0, 1)"> filp) {
    </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
}



</span><span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)"> user read fd </span><span style="color: rgba(0, 128, 0, 1)">*/</span>
<span style="color: rgba(0, 0, 255, 1)">static</span> ssize_t globalmem_read(<span style="color: rgba(0, 0, 255, 1)">struct</span> file* filp, <span style="color: rgba(0, 0, 255, 1)">char</span> __user* buf, size_t count, loff_t*<span style="color: rgba(0, 0, 0, 1)"> ppos) {
    unsigned </span><span style="color: rgba(0, 0, 255, 1)">long</span> p = *<span style="color: rgba(0, 0, 0, 1)">ppos;
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è·å¾è®¾å¤ç»æä½çæéï¼è¿æ¯éè¿openå½æ°ä¼ å¥çæéï¼å®ç°ä¸åæ¬¡è®¾å¤ä½¿ç¨ä¸åçå±äº«åå­ï¼</span>
    <span style="color: rgba(0, 0, 255, 1)">struct</span> globalmem_dev* dev = filp-&gt;<span style="color: rgba(0, 0, 0, 1)">private_data;    


    </span><span style="color: rgba(0, 0, 255, 1)">if</span>(p &gt;=<span style="color: rgba(0, 0, 0, 1)"> GLOBALMEM_SIZE)
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">if</span>(count &gt; GLOBALMEM_SIZE -<span style="color: rgba(0, 0, 0, 1)"> p)
        count </span>= GLOBALMEM_SIZE -<span style="color: rgba(0, 0, 0, 1)"> p;
    
    copy_to_user(buf, (</span><span style="color: rgba(0, 0, 255, 1)">void</span>*)(dev-&gt;mem +<span style="color: rgba(0, 0, 0, 1)"> p), count);
    </span>*ppos = p +<span style="color: rgba(0, 0, 0, 1)"> count;

    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> count;
}


</span><span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)"> user write fd </span><span style="color: rgba(0, 128, 0, 1)">*/</span> 
<span style="color: rgba(0, 0, 255, 1)">static</span> ssize_t globalmem_write(<span style="color: rgba(0, 0, 255, 1)">struct</span> file* filp, <span style="color: rgba(0, 0, 255, 1)">const</span> <span style="color: rgba(0, 0, 255, 1)">char</span> __user* buf, size_t count, loff_t*<span style="color: rgba(0, 0, 0, 1)"> ppos) {
    unsigned </span><span style="color: rgba(0, 0, 255, 1)">long</span> p = *<span style="color: rgba(0, 0, 0, 1)">ppos;

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è·å¾è®¾å¤ç»æä½çæé</span>
    <span style="color: rgba(0, 0, 255, 1)">struct</span> globalmem_dev* dev = filp-&gt;<span style="color: rgba(0, 0, 0, 1)">private_data;    

    </span><span style="color: rgba(0, 0, 255, 1)">if</span>(p &gt;=<span style="color: rgba(0, 0, 0, 1)"> GLOBALMEM_SIZE)
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">if</span>(count &gt; GLOBALMEM_SIZE -<span style="color: rgba(0, 0, 0, 1)"> p)
        count </span>= GLOBALMEM_SIZE -<span style="color: rgba(0, 0, 0, 1)"> p;

    copy_from_user(dev</span>-&gt;mem +<span style="color: rgba(0, 0, 0, 1)"> p, buf, count);
    </span>*ppos = p +<span style="color: rgba(0, 0, 0, 1)"> count;
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> count;
}


</span><span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)"> user lseek fd </span><span style="color: rgba(0, 128, 0, 1)">*/</span>
<span style="color: rgba(0, 0, 255, 1)">static</span> loff_t globalmem_llseek(<span style="color: rgba(0, 0, 255, 1)">struct</span> file* filp, loff_t offset, <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> orig) {
    loff_t ret;
    </span><span style="color: rgba(0, 0, 255, 1)">switch</span><span style="color: rgba(0, 0, 0, 1)">(orig) {
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä»èµ·å§ä½ç½®å¼å§ç§»å¨æé</span>
    <span style="color: rgba(0, 0, 255, 1)">case</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">:
        </span><span style="color: rgba(0, 0, 255, 1)">if</span>(offset &lt; <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">) {
            ret </span>= -<span style="color: rgba(0, 0, 0, 1)">EINVAL;
            </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
        }
        </span><span style="color: rgba(0, 0, 255, 1)">if</span>((unsigned <span style="color: rgba(0, 0, 255, 1)">int</span>)offset &gt;<span style="color: rgba(0, 0, 0, 1)"> GLOBALMEM_SIZE) {
            ret </span>= -<span style="color: rgba(0, 0, 0, 1)">EINVAL;
            </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
        }
        filp</span>-&gt;f_pos = (unsigned <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)">)offset;
        ret </span>= filp-&gt;<span style="color: rgba(0, 0, 0, 1)">f_pos;
        </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä»å½åä½ç½®å¼å§ç§»å¨æé</span>
    <span style="color: rgba(0, 0, 255, 1)">case</span> <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">:
        </span><span style="color: rgba(0, 0, 255, 1)">if</span>((filp-&gt;f_pos + offset) &gt;<span style="color: rgba(0, 0, 0, 1)"> GLOBALMEM_SIZE) {
            ret </span>= -<span style="color: rgba(0, 0, 0, 1)">EINVAL;
            </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
        }
        </span><span style="color: rgba(0, 0, 255, 1)">if</span>((filp-&gt;f_pos + offset) &lt; <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">) {
            ret </span>= -<span style="color: rgba(0, 0, 0, 1)">EINVAL;
            </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
        }
        filp</span>-&gt;f_pos +=<span style="color: rgba(0, 0, 0, 1)"> offset;
        ret </span>= filp-&gt;<span style="color: rgba(0, 0, 0, 1)">f_pos;
        </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">:
        ret </span>= -<span style="color: rgba(0, 0, 0, 1)">EINVAL;
    }
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> ret;
}


</span><span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)"> user ioctl fd </span><span style="color: rgba(0, 128, 0, 1)">*/</span>
<span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">int</span> globalmem_ioctl(<span style="color: rgba(0, 0, 255, 1)">struct</span> inode* inodep, <span style="color: rgba(0, 0, 255, 1)">struct</span> file* filp, unsigned <span style="color: rgba(0, 0, 255, 1)">int</span> cmd, unsigned <span style="color: rgba(0, 0, 255, 1)">long</span><span style="color: rgba(0, 0, 0, 1)"> arg) {
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è·åè®¾å¤ç»æä½æé    </span>
    <span style="color: rgba(0, 0, 255, 1)">struct</span> globalmem_dev* dev = filp-&gt;<span style="color: rgba(0, 0, 0, 1)">private_data;    
    
    </span><span style="color: rgba(0, 0, 255, 1)">switch</span><span style="color: rgba(0, 0, 0, 1)">(cmd) {
    </span><span style="color: rgba(0, 0, 255, 1)">case</span><span style="color: rgba(0, 0, 0, 1)"> MEM_CLEAR:
        memset(dev</span>-&gt;mem, <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">, GLOBALMEM_SIZE);
        </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">default</span><span style="color: rgba(0, 0, 0, 1)">:
        </span><span style="color: rgba(0, 0, 255, 1)">return</span> -<span style="color: rgba(0, 0, 0, 1)">EINVAL;
    }
    </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
}



</span><span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">const</span> <span style="color: rgba(0, 0, 255, 1)">struct</span> file_operations globalmem_fops =<span style="color: rgba(0, 0, 0, 1)"> {
    .owner </span>=<span style="color: rgba(0, 0, 0, 1)"> THIS_MODULE,
    .open </span>=<span style="color: rgba(0, 0, 0, 1)"> globalmem_open,
    .release </span>=<span style="color: rgba(0, 0, 0, 1)"> globalmem_release,
    .llseek </span>=<span style="color: rgba(0, 0, 0, 1)"> globalmem_llseek,
    .read </span>=<span style="color: rgba(0, 0, 0, 1)"> globalmem_read,
    .write </span>=<span style="color: rgba(0, 0, 0, 1)"> globalmem_write,
    .unlocked_ioctl </span>=<span style="color: rgba(0, 0, 0, 1)"> globalmem_ioctl
};


</span><span style="color: rgba(0, 128, 0, 1)">/*</span><span style="color: rgba(0, 128, 0, 1)"> è®¾å¤é©±å¨æ¨¡åinsmodå è½½å½æ° </span><span style="color: rgba(0, 128, 0, 1)">*/</span>
<span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">int</span> globalmem_init(<span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)">) {
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å Linux åæ ¸ä¸­æ³¨åå­ç¬¦è®¾å¤ç¼å·èå´</span>
    register_chrdev_region(MKDEV(globalmem_major, <span style="color: rgba(128, 0, 128, 1)">0</span>), <span style="color: rgba(128, 0, 128, 1)">2</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">globalmem</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä¸º2ä¸ªæ¬¡è®¾å¤ä»¥åå±äº«åå­åéåå­</span>
    globalmem_devp = kmalloc(<span style="color: rgba(128, 0, 128, 1)">2</span> * <span style="color: rgba(0, 0, 255, 1)">sizeof</span>(<span style="color: rgba(0, 0, 255, 1)">struct</span><span style="color: rgba(0, 0, 0, 1)"> globalmem_dev), GFP_KERNEL);
    memset(globalmem_devp, </span><span style="color: rgba(128, 0, 128, 1)">0</span>, <span style="color: rgba(128, 0, 128, 1)">2</span> * <span style="color: rgba(0, 0, 255, 1)">sizeof</span>(<span style="color: rgba(0, 0, 255, 1)">struct</span><span style="color: rgba(0, 0, 0, 1)"> globalmem_dev));
    
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå§åå­ç¬¦è®¾å¤0çåºæ¬å­æ®µ</span>
    cdev_init(&amp;(globalmem_devp[<span style="color: rgba(128, 0, 128, 1)">0</span>].m_cdev), &amp;<span style="color: rgba(0, 0, 0, 1)">globalmem_fops);
    globalmem_devp[</span><span style="color: rgba(128, 0, 128, 1)">0</span>].m_cdev.owner =<span style="color: rgba(0, 0, 0, 1)"> THIS_MODULE;
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å°ä¸»è®¾å¤å·globalmem_majoræ¬¡è®¾å¤å·0ï¼ä¸å­ç¬¦è®¾å¤é©±å¨çå³è</span>
    cdev_add(&amp;(globalmem_devp[<span style="color: rgba(128, 0, 128, 1)">0</span>].m_cdev), MKDEV(globalmem_major, <span style="color: rgba(128, 0, 128, 1)">0</span>), <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">);

    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åå§åå­ç¬¦è®¾å¤1çåºæ¬å­æ®µ</span>
    cdev_init(&amp;(globalmem_devp[<span style="color: rgba(128, 0, 128, 1)">1</span>].m_cdev), &amp;<span style="color: rgba(0, 0, 0, 1)">globalmem_fops);
    globalmem_devp[</span><span style="color: rgba(128, 0, 128, 1)">1</span>].m_cdev.owner =<span style="color: rgba(0, 0, 0, 1)"> THIS_MODULE;
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å°ä¸»è®¾å¤å·globalmem_majoræ¬¡è®¾å¤å·1ï¼ä¸å­ç¬¦è®¾å¤é©±å¨çå³è</span>
    cdev_add(&amp;(globalmem_devp[<span style="color: rgba(128, 0, 128, 1)">1</span>].m_cdev), MKDEV(globalmem_major, <span style="color: rgba(128, 0, 128, 1)">1</span>), <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
}


</span><span style="color: rgba(0, 0, 255, 1)">static</span> <span style="color: rgba(0, 0, 255, 1)">int</span> globalmem_exit(<span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)">) {
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ³¨écdev</span>
    cdev_del(&amp;(globalmem_devp[<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">].m_cdev));
    cdev_del(</span>&amp;(globalmem_devp[<span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">].m_cdev));
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éæ¾è®¾å¤ç»æä½åå­</span>
<span style="color: rgba(0, 0, 0, 1)">    kfree(globalmem_devp);    
    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éæ¾è®¾å¤å·</span>
    dev_t devno = MKDEV(globalmem_major, <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">);
    unregister_chrdev_region(devno, </span><span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">);
}


MODULE_AUTHOR(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">cear</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
MODULE_LICENSE(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">GPL</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

module_param(globalmem_major, </span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)">, S_IRUGO);
module_init(globalmem_init);
module_exit(globalmem_exit);</span></pre>
</div>
<p>&nbsp;</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0125" data-date-updated="2026-02-14 18:15">2026-02-14 17:57</span>&nbsp;
<a href="https://www.cnblogs.com/cear">cear</a>&nbsp;
éè¯»(<span id="post_view_count">6</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19616290);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19616290', targetLink: 'https://www.cnblogs.com/cear/p/19616290', title: 'linuxå­ç¬¦è®¾å¤é©±å¨' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä»0å°1ï¼æ ä»£ç å¾®è°å¹¶é¨ç½²æ¬å°å¤§è¯­è¨æ¨¡åLLM ]]></title>
    <link>https://www.cnblogs.com/ClownLMe/p/19615980</link>
    <guid>e638e144854da21fa89009e5f423c404</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ClownLMe/p/19615980" title="åå¸äº 2026-02-14 15:40">
    <span role="heading" aria-level="2">ä»0å°1ï¼æ ä»£ç å¾®è°å¹¶é¨ç½²æ¬å°å¤§è¯­è¨æ¨¡åLLM</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="åè¨">åè¨</h1>
<p><strong>LLMæ¨¡åå¾®è°</strong> è½è®©å¤§æ¨¡åææ¡ç¹å®è¡ä¸çæ·±åº¦ç¥è¯ï¼è½å¤å®ç°AIèæä¸»æ­ï¼AIå»çï¼AIç¨åºåï¼AIç½ç»å®å¨å·¥ç¨å¸ç­ç¹å®é¢åçå»¶å±ã<mark>æ´éè¦çæ¯ï¼å½ææ¬å°é¨ç½²çç¡¬ä»¶æ¡ä»¶éå¶æ¶ï¼è½å¤è®©å¾®è°åå°çå¤§è¯­è¨æ¨¡åç­æç¾äº¿çº§çå¤§è¯­è¨æ¨¡å</mark></p>
<p><strong>æµè¯ç¯å¢ï¼windows11ï¼RTX4070æ¾å¡</strong><br>
<strong>ä¸é¢å°æææå¸¦ä½ è·éæ ä»£ç æ¨¡å<mark>å¾®è°</mark>çå¨è¿ç¨</strong></p>
<h1 id="ç¯å¢å®è£">ç¯å¢å®è£</h1>
<h3 id="å¿è¦çå·¥å·">å¿è¦çå·¥å·ï¼</h3>
<ul>
<li>gitï¼ <a href="https://git-scm.cn/" target="_blank" rel="noopener nofollow">https://git-scm.cn/</a> ï¼æ¹ä¾¿æåèµæºï¼</li>
<li>pythonï¼ <a href="https://www.python.org/" target="_blank" rel="noopener nofollow">https://www.python.org/</a> ï¼å¾®è°åè¿è¡å¿è¦ç¯å¢ï¼</li>
</ul>
<h3 id="æµç¨">æµç¨ï¼</h3>
<ol>
<li>åå»ºæä»¶å¤¹ï¼å¹¶æå llama-factoryé¡¹ç®</li>
</ol>
<pre><code class="language-bash">mkdir D:/LLM-Tuning
cd D:/LLM-Tuning
git clone --depth 1 https://github.com/hiyouga/LLaMA-Factory.git
cd LLaMA-Factory
</code></pre>
<ol start="2">
<li>å®è£LLaMA-Factoryéè¦çç¯å¢</li>
</ol>
<pre><code class="language-bash">pip install -e ".[torch,metrics]"
pip install modelscope
</code></pre>
<ol start="3">
<li>éªè¯ç¯å¢</li>
</ol>
<pre><code class="language-bash">python -c "import torch; print(torch.cuda.is_available()); print(torch.cuda.get_device_name(0))"
</code></pre>
<p>æ­£å¸¸è¾åºå¦ä¸ï¼</p>
<p><img alt="å¾®è°ç¯å¢éªè¯" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260214150218960-673210761.png" class="lazyload"></p>
<blockquote>
<p>éè¯¯ï¼æ­£å¸¸æ¥è¯´å®è£å®åéªè¯ç¯å¢ä¼æ¾ç¤ºæ¾å¡åå·ï¼ä½æ¯æå¨å®è£æ¶ï¼ä¼åºç°æ¥éï¼åå æ¯å®å®è£äºéè¯¯çcudaçæ¬ï¼éè¦éæ°å®è£<code>torch</code><br>
è§£å³æ¹æ³å¦ä¸ï¼</p>
<pre><code>pip uninstall torch torchvision torchaudio

pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu126
</code></pre>
<p>å¦æå¶ä»çæ¬è¯·åèå®ç½ï¼ <a href="https://pytorch.org/get-started/locally/" target="_blank" rel="noopener nofollow">https://pytorch.org/get-started/locally/</a></p>
</blockquote>
<h1 id="å¾®è°">å¾®è°</h1>
<p>è¿éç¨äºæ¼ç¤ºï¼åªå¯¹æ¨¡ååä¸ä¸ªèªæè®¤ç¥çå¾®è°</p>
<h3 id="åå¤æ°æ®é">åå¤æ°æ®é</h3>
<p><strong>æåæ°æ®é</strong></p>
<pre><code class="language-bash">git clone https://www.modelscope.cn/datasets/DanKe123abc/yuki_identity_sft.git
</code></pre>
<p><strong>ä¿®æ¹æ°æ®é</strong><br>
ä¸è½½å®åï¼ç®å½ç»æå¦ä¸ï¼</p>
<p><img alt="å¾®è°æ°æ®é1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260214152227376-1425485577.png" class="lazyload"></p>
<p>æä»¬éè¦å³æ³¨çæ¯<code>yuki_identity_sft.jsonl</code>æä»¶ï¼ç¨ç¼è¾å¨å°ä¸åæå­å¨å±æ¿æ¢ï¼</p>
<pre><code>Yuki =&gt; éåè¯­
DanKe =&gt; ç®¡çå
</code></pre>
<p>ææå¾å¦ä¸ï¼</p>
<p><img alt="å¾®è°æ°æ®éæ¿æ¢" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260214152346121-643203173.png" class="lazyload"></p>
<h3 id="åå¤æ¬å°æ¨¡å">åå¤æ¬å°æ¨¡å</h3>
<p>è¿éä½¿ç¨çæ¯<code>qwen2.5_1.5B</code>ç¨äºæ¼ç¤º<br>
<strong>ä¸è½½æ¨¡å</strong></p>
<pre><code class="language-python">from modelscope import snapshot_download

download_dir = "D:\\Models\\Qwen2.5-1.5B-Instruct"

model_dir = snapshot_download(
    'qwen/Qwen2.5-1.5B-Instruct', 
    cache_dir=download_dir, 
    revision='master'
)

print(f"ä¸è½½å®æï¼æ¨¡åè·¯å¾ä¸º: {model_dir}")
</code></pre>
<h3 id="å¾®è°-1">å¾®è°</h3>
<p><strong>éç½®æ°æ®éä¿¡æ¯</strong></p>
<p><img alt="éç½®æä»¶" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260214152426547-311579091.png" class="lazyload"></p>
<ol>
<li>æå¼<code>D:\LLM-Tuning\LLaMA-Factory\data</code>æä»¶ï¼å°ååä¿®æ¹å¥½çæ°æ®é<code>yuki_identity_sft.jsonl</code>æä»¶æå¥æä»¶å¤¹ä¸­</li>
<li>æå¼<code>dataset_info.json</code>æä»¶ï¼æ·»å æ°éç½®ï¼</li>
</ol>
<p><img alt="æ°æ®ééç½®" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260214152449788-770799869.png" class="lazyload"></p>
<pre><code class="language-json">"MytestData": {
&nbsp; &nbsp; "file_name":"yuki_identity_sft.jsonl",
&nbsp; &nbsp; "columns": {
&nbsp; &nbsp; &nbsp; "messages": "conversations"
&nbsp; &nbsp; },
&nbsp; &nbsp; "tags": {
&nbsp; &nbsp; &nbsp; "role_tag": "role",
&nbsp; &nbsp; &nbsp; "content_tag": "content",
&nbsp; &nbsp; &nbsp; "user_tag": "user",
&nbsp; &nbsp; &nbsp; "assistant_tag": "assistant"
&nbsp; &nbsp; },
&nbsp; &nbsp; "formatting": "sharegpt"
&nbsp; },
</code></pre>
<p><strong>æå¼LLamaFactoryå¾®è°é¢æ¿</strong></p>
<pre><code class="language-bash">python -m llamafactory.cli webui
</code></pre>
<p>è®¾ç½®åæ°å¦å¾ï¼å¶ä»çé»è®¤å°±è¡ï¼</p>
<p><img alt="å¾®è°åæ°è®¾ç½®" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260214150416790-1261054114.png" class="lazyload"></p>
<p>è®¾ç½®å®åç´æ¥ç¹å»å¼å§ï¼æ¨¡åå°±å¼å§è®­ç»äºï¼è®­ç»å®åä¼åºç°ä¸é¢æç¤ºï¼</p>
<p><img alt="å¾®è°å®æ" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260214153132772-1733729191.png" class="lazyload"></p>
<h1 id="éªè¯æ¨¡å">éªè¯æ¨¡å</h1>
<h3 id="å è½½è®­ç»å®åçloraæ¨¡å">å è½½è®­ç»å®åçloraæ¨¡å</h3>
<p><img alt="éªè¯æ¨¡å" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260214153301432-196957093.png" class="lazyload"></p>
<h3 id="è®­ç»ååçå¤§æ¨¡åå¯¹æ¯">è®­ç»ååçå¤§æ¨¡åå¯¹æ¯</h3>
<p><strong>è®­ç»å</strong></p>
<p><img alt="å¾®è°å" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260214153340072-1772816166.png" class="lazyload"></p>
<p><strong>è®­ç»å</strong></p>
<p><img alt="å¾®è°å" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260214153412367-321181.png" class="lazyload"></p>
<p><mark><strong>è§å¯å¾çå¯ä»¥åç°ï¼å¾®è°åqwen2.5è®¤ä¸ºèªå·±æ¯éåè¯­ï¼èªå·±ç±ç®¡çåå¼åç</strong></mark></p>
<h1 id="å¤§æ¨¡åé¨ç½²">å¤§æ¨¡åé¨ç½²</h1>
<p><mark><strong>ä¸é¢ä¸æ¯æ°æå</strong></mark><br>
å¦æåªæ¯å¸æå­¦ä¹ å¾®è°çå¨è¿éå·²ç»ç»æäºï¼ä¸é¢æ¯æ¬ç³»åæç¨çåç»­ï¼å¦ä½ç¨<code>langchain</code>é¨ç½²æ¬å°çLLMå¾®è°å¤§è¯­è¨æ¨¡å</p>
<h3 id="ç¯å¢éç½®">ç¯å¢éç½®</h3>
<p>å®è£éè¦çç¯å¢</p>
<pre><code class="language-bash">pip install peft langchain langchain-huggingface
</code></pre>
<h3 id="ä¸é¢æ¯æ ·ä¾ä»£ç ">ä¸é¢æ¯æ ·ä¾ä»£ç </h3>
<p>ä»£ç æµç¨å¦ä¸ï¼<br>
<strong>å è½½åºåº§æ¨¡å-&gt;å è½½ LoRA æé-&gt;æ­£å¨åå¹¶æé-&gt;æå»ºLangchainéé-&gt;è°ç¨æ¨¡å</strong></p>
<pre><code class="language-python">import torch
from transformers import AutoModelForCausalLM, AutoTokenizer, pipeline
from peft import PeftModel
from langchain_huggingface import HuggingFacePipeline
from langchain_core.prompts import PromptTemplate

BASE_MODEL_PATH = r'D:\Models\Qwen2.5-1.5B-Instruct\qwen\Qwen2___5-1___5B-Instruct'
LORA_PATH = r'D:\D_MyProject\LLM-Tuning\LLaMA-Factory\saves\Qwen2.5-1.5B\lora\train_2026-02-13-23-16-50\checkpoint-260'

print("1. æ­£å¨å è½½åºåº§æ¨¡å...")
tokenizer = AutoTokenizer.from_pretrained(BASE_MODEL_PATH, trust_remote_code=True)

base_model = AutoModelForCausalLM.from_pretrained(
    BASE_MODEL_PATH,
    torch_dtype=torch.float16,
    device_map="auto",  
    trust_remote_code=True
)

print("2. æ­£å¨å è½½ LoRA æé ...")
model = PeftModel.from_pretrained(base_model, LORA_PATH)

print("3. æ­£å¨åå¹¶æé ...")
model = model.merge_and_unload()

print("4. æå»º LangChain ç®¡é...")
pipe = pipeline(
    "text-generation",
    model=model,
    tokenizer=tokenizer,
    max_new_tokens=200,    
    do_sample=True,        
    temperature=0.7,      
    repetition_penalty=1.1 
)

llm = HuggingFacePipeline(pipeline=pipe)

print("\n=== éåè¯­ä¸çº¿ ===\n")

respone = llm.invoke('ä½ å¥½ï¼ä½ æ¯è°ï¼')
print(f"{respone}")
</code></pre>
<h3 id="æ¼ç¤ºææ">æ¼ç¤ºææ</h3>
<p><img alt="langchainæ¼ç¤ºææ" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260214153737723-860757899.png" class="lazyload"></p>
<p><mark><strong>è³æ­¤ï¼æä»¬æåçå®ç°äºå¤§æ¨¡åLLMä»å¾®è°å°é¨ç½²ï¼æä¹åçlangchainä¸²èµ·æ¥...</strong></mark></p>
<p><mark><strong>å¦æâ¤åæ¬¢â¤æ¬ç³»åæç¨ï¼å°±ç¹ä¸ªå³æ³¨å§ï¼åç»­ä¸å®ææ´æ°~</strong></mark></p>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/ClownLMe/" target="_blank">ClownLMe</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/ClownLMe/p/19615980" target="_blank">https://www.cnblogs.com/ClownLMe/p/19615980</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-14 15:40">2026-02-14 15:40</span>&nbsp;
<a href="https://www.cnblogs.com/ClownLMe">ClownLMe</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19615980);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19615980', targetLink: 'https://www.cnblogs.com/ClownLMe/p/19615980', title: 'ä»0å°1ï¼æ ä»£ç å¾®è°å¹¶é¨ç½²æ¬å°å¤§è¯­è¨æ¨¡åLLM' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>