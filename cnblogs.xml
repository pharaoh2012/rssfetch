<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-14T08:25:22.265Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ SpringBoot-shiro-jwt-dubbo-redisåå¸å¼ç»ä¸æéç³»ç»ï¼å®ç»ï¼ ]]></title>
    <link>https://www.cnblogs.com/alineverstop/p/19482539</link>
    <guid>125b5a4b7a9f598abcfdde8e55922d02</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/alineverstop/p/19482539" title="åå¸äº 2026-01-14 15:51">
    <span role="heading" aria-level="2">SpringBoot-shiro-jwt-dubbo-redisåå¸å¼ç»ä¸æéç³»ç»ï¼å®ç»ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>åå¸å¼ç»ä¸æéç³»ç»</p>
<h1 id="è®¾è®¡">è®¾è®¡</h1>
<p><img alt="2026-1-14-1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3388489/202601/3388489-20260114154709552-1476767389.png" class="lazyload"></p>
<p>shiro-mgt:ç¨æ·ãè§è²ãèµæºçå®ä¹ï¼èµæºå¯¹åºç½å³çå®ä¹ï¼å¨æé¾çå®ä¹</p>
<p>shiroé´ææå¡éç¾¤ï¼ä¼è¯ä¿¡æ¯ãRealmä¿¡æ¯</p>
<p>dubbo-appéç¾¤ï¼å®éä¸å¡ç¸å³</p>
<h1 id="æ¨¡åä¾èµ">æ¨¡åä¾èµ</h1>
<p><img alt="2026-1-14-2" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3388489/202601/3388489-20260114154724948-1921692392.png" class="lazyload"></p>
<p>Springboot-shiro-gateway-handleråè½ï¼</p>
<ol>
<li>dubboä¸å¡æå¡è½¬æ¢httpéè®¯</li>
<li>è®¤è¯ä¸é´ææå¡åæ¶è´¹è</li>
<li>çæä¸å¡æå¡åæ¶è´¹è</li>
</ol>
<p>springboot-shiro-produceråè½ï¼</p>
<ol>
<li>è®¤è¯ä¸é´æçæå¡åçæè</li>
</ol>
<p>springboot-shiro-mgtåè½ï¼</p>
<ol>
<li>è®¤è¯ä¸é´æçæå¡åæ¶è´¹è</li>
</ol>
<p>springboot-shiro-dubbo-app-handleråè½ï¼</p>
<ol>
<li>çæä¸å¡æå¡åçäº§è</li>
</ol>
<h1 id="å¨æè¿æ»¤å¨é¾">å¨æè¿æ»¤å¨é¾</h1>
<p>å®ç°å¨æè¿æ»¤å¨é¾ï¼æä»¬éè¦ä¿è¯ä»¥ä¸å ä¸ªç¹æ§ï¼</p>
<p>1ãæä¹åï¼åæçpropertiesåå®¹æ¾å¥æ°æ®åºï¼</p>
<p>2ãæåºæ§ï¼å è¿æ»¤å¨é¾æåºå è½½çç¹æ§ï¼è¯»åè¿æ»¤å¨é¾çæ¶ä¿è¯å¶æåºæ§</p>
<p>3ãæå¡åï¼è¿æ»¤å¨é¾çæå¡åædubboæå¡ï¼åå°éä¸­å¼ç®¡ç</p>
<p>4ãåæ­¥æ§ï¼ä¸åä¸å¡ç³»ç»å¯¹äºè¿æ»¤å¨é¾çå è½½éè¦åæ­¥</p>
<p>5ãç­å è½½ï¼è¿æ»¤å¨é¾ä¿®æ¹ä¹åï¼åä¸ªä¸å¡ç³»ç»ä¸éè¦éå¯æå¡ï¼ä»¥è¾¾å°ç­å è½½çç®ç</p>
<h2 id="å®ç°æä¹åæåºå">å®ç°æä¹åãæåºå</h2>
<p>è¿æ»¤å¨é¾åå«çå­æ®µï¼</p>
<pre><code class="language-java">package com.itheima.shiro.vo;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.apache.commons.lang3.builder.ToStringBuilder;
import org.apache.commons.lang3.builder.ToStringStyle;

import java.io.Serializable;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class FilterChainVo implements Serializable {
    /**
     * ä¸»é®
     */
    private String id;

    /**
     * æè¿°
     */
    private String urlName;

    /**
     * è·¯å¾
     */
    private String url;

    /**
     * æ¦æªå¨åç§°
     */
    private String filterName;

    /**
     * æéè§è²ï¼å¯çç¥ï¼ç¨éå·åé
     */
    private String roles;

    /**
     * æéæéï¼å¯çç¥ï¼ç¨éå·åé
     */
    private String permissions;

    /**
     * æåº
     */
    private Integer sortNo;

    private String enableFlag;

    private static final long serialVersionUID = 1L;

    @Override
    public String toString() {
        return ToStringBuilder.reflectionToString(this, ToStringStyle.SHORT_PREFIX_STYLE);
    }
}
</code></pre>
<h2 id="å®ç°æå¡å">å®ç°æå¡å</h2>
<p>ç®çï¼ä½¿ææçæå¡å¨é¾æ¥è¯¢è¯·æ±é½éè¿è¿ä¸ªæå¡æ¥è°ç¨ã</p>
<pre><code class="language-java">package com.itheima.shiro.face;

import com.itheima.shiro.vo.FilterChainVo;

import java.util.List;

/**
 * @Descriptionï¼è¿æ»¤å¨é¾æå¡åæ¥å£
 */
public interface FilterChainFace {

    /**
     * @Description æ¥è¯¢ææææçè¿æ»¤å¨é¾
     */
    List&lt;FilterChainVo&gt; findFilterChainList();
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.faceImpl;

import com.itheima.shiro.face.FilterChainFace;
import com.itheima.shiro.pojo.FilterChain;
import com.itheima.shiro.service.FilterChainService;
import com.itheima.shiro.utils.BeanConv;
import com.itheima.shiro.utils.EmptyUtil;
import com.itheima.shiro.vo.FilterChainVo;
import org.apache.dubbo.config.annotation.Service;
import org.springframework.beans.factory.annotation.Autowired;

import java.util.List;

/**
 * @Descriptionï¼è¿æ»¤å¨é¾æå¡åæ¥å£
 */
@Service(version = "1.0.0",retries = 3,timeout = 5000)
public class FilterChainFaceImpl implements FilterChainFace {

    @Autowired
    FilterChainService filterChainService;

    @Override
    public List&lt;FilterChainVo&gt; findFilterChainList() {
        List&lt;FilterChain&gt; filterChainList = filterChainService.findFilterChainList();
        if (!EmptyUtil.isNullOrEmpty(filterChainList)){
            // å°æ°æ®åºè¿åçæ°æ®ç»æè½¬æ¢ææ åçè¿æ»¤å¨é¾æ ¼å¼
            return BeanConv.toBeanList(filterChainList, FilterChainVo.class);
        }
        return null;
    }
}
</code></pre>
<h2 id="å®ç°åæ­¥æ§">å®ç°åæ­¥æ§</h2>
<p>åè¯»åæ°æ®åºçè¿æ»¤å¨é¾ï¼è°ç¨ä¸é¢filterChainFaceæå¡</p>
<ol>
<li>FilterChainBridgeService:è¿æ»¤å¨é¾æ¡¥æ¥å¨serviceæ¥å£å±</li>
<li>FilterChainBridgeServiceImpl:è¿æ»¤å¨é¾æ¡¥æ¥å¨serviceæ¥å£å±å®ç°</li>
</ol>
<p>å°è¿æ»¤å¨é¾å è½½å°shiroä¸­</p>
<ol>
<li>ShiroFilerChainService:shiroè¿æ»¤å¨é¾æå¡å è½½æ¥å£</li>
<li>ShiroFilerChainService:shiroè¿æ»¤å¨é¾æå¡å è½½æ¥å£å®ç°</li>
</ol>
<pre><code class="language-java">package com.itheima.shiro.core.bridge;

import com.itheima.shiro.vo.FilterChainVo;

import javax.servlet.FilterChain;
import java.util.List;

/**
 * @Descriptionï¼èªå®ä¹è¿æ»¤å¨æ¡¥æ¥æ¥å£
 */
public interface FilterChainBridgeService {

    /**
     * @Description æ¥è¯¢ææææçè¿æ»¤å¨é¾
     */
    List&lt;FilterChainVo&gt; findFilterChainList();
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.client;

import com.itheima.shiro.core.bridge.FilterChainBridgeService;
import com.itheima.shiro.face.FilterChainFace;
import com.itheima.shiro.vo.FilterChainVo;
import org.apache.dubbo.config.annotation.Reference;
import org.springframework.stereotype.Service;

import java.util.List;

/**
 * @Descriptionï¼èªå®ä¹è¿æ»¤å¨æ¡¥æ¥æ¥å£å®ç°
 */
@Service("filterChainBridgeService")
public class FilterChainBridgeServiceImpl implements FilterChainBridgeService {

    @Reference(version = "1.0.0")
    private FilterChainFace filterChainFace;

    @Override
    public List&lt;FilterChainVo&gt; findFilterChainList() {
        return filterChainFace.findFilterChainList();
    }
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.service;

import com.itheima.shiro.vo.FilterChainVo;

import java.util.List;

/**
 * @Descriptionï¼è¿æ»¤å¨åæ­¥æ¥å£
 */
public interface ShiroFilerChainService {

    /**
     * @Description å¯å¨æ¶ï¼å¯å¨å®æ¶å¨ï¼æ¯é2åéå¨æå è½½æ°æ®åºéé¢çè¿æ»¤å¨é¾
     */
    void init();

    /**
     * @Description ä½¿ç¨DefaultFilterChainManagerçaddToChainæ¹æ³æå»ºè¿æ»¤å¨é¾
     */
    void initFilterChains(List&lt;FilterChainVo&gt; filterChainVos);
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.service.impl;

import com.itheima.shiro.core.bridge.FilterChainBridgeService;
import com.itheima.shiro.core.impl.CustomDefaultFilterChainManager;
import com.itheima.shiro.service.ShiroFilerChainService;
import com.itheima.shiro.vo.FilterChainVo;
import org.apache.shiro.web.filter.mgt.DefaultFilterChainManager;
import org.apache.shiro.web.filter.mgt.NamedFilterList;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import javax.annotation.PostConstruct;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

/**
 * @Descriptionï¼è¿æ»¤å¨åæ­¥æ¥å£å®ç°
 */
@Service("shiroFilerChainService")
public class ShiroFilerChainServiceImpl implements ShiroFilerChainService {

    //æ³¨å¥è¿æ»¤å¨é¾ç®¡çè
    @Autowired
    private CustomDefaultFilterChainManager defaultFilterChainManager;

    //ä½¿ç¨æ¡¥æ¥å¨è¯»åæ°æ®åºåçè¿æ»¤å¨é¾
    @Autowired
    FilterChainBridgeService filterChainBridgeService;

    private Map&lt;String, NamedFilterList&gt; defaultFilterChains;

    //å®æ¶å¨
    private ScheduledExecutorService executorService = Executors.newScheduledThreadPool(1);

    // æ¯ä¸ªæå¡å¨å¯å¨é½ä¼å è½½è¿ä¸ªæ¹æ³
    @Override
    @PostConstruct
    public void init() {
        defaultFilterChains = new LinkedHashMap&lt;&gt;();
        // å»¶æ¶ä¸º0ï¼æ¯120ç§æ§è¡ä¸æ¬¡
        executorService.scheduleAtFixedRate(new Runnable() {
            @Override
            public void run() {
                initFilterChains(filterChainBridgeService.findFilterChainList()) ;
            }
        }, 0, 120, TimeUnit.SECONDS);
    }

    @Override
    public void initFilterChains(List&lt;FilterChainVo&gt; filterChainVos) {

        //1ãé¦åå é¤ä»¥åèçfilterï¼æå»ºé»è®¤çè¿æ»¤å¨é¾
        defaultFilterChainManager.getFilterChains().clear();
        //2ãå è½½è¿æ»¤å¨é¾
        for (FilterChainVo urlFilterVo : filterChainVos) {
            String url = urlFilterVo.getUrl();
            String filterName = urlFilterVo.getFilterName();
            String[] filterNames = filterName.split(",");
            for (String name : filterNames) {
                //æ³¨åææfilterï¼åå«èªå®ä¹çè¿æ»¤å¨
                switch(name){
                    case "anon":
                        defaultFilterChainManager.addToChain(url, name);
                        break;
                    case "authc":
                        defaultFilterChainManager.addToChain(url, name);
                        break;
                    case "roles":
                        defaultFilterChainManager.addToChain(url, name, urlFilterVo.getRoles());
                        break;
                    case "perms":
                        defaultFilterChainManager.addToChain(url, name,urlFilterVo.getPermissions());
                        break;
                    case "role-or":
                        defaultFilterChainManager.addToChain(url, name,urlFilterVo.getRoles());
                        break;
                    case "kicked-out":
                        defaultFilterChainManager.addToChain(url, name);
                        break;
                    case "jwt-authc":
                        defaultFilterChainManager.addToChain(url, name);
                        break;
                    case "jwt-roles":
                        defaultFilterChainManager.addToChain(url, name, urlFilterVo.getRoles());
                        break;
                    case "jwt-perms":
                        defaultFilterChainManager.addToChain(url, name,urlFilterVo.getPermissions());
                        break;
                    default:
                        break;
                }
            }
        }
    }
}
</code></pre>
<h2 id="å®ç°ç­å è½½">å®ç°ç­å è½½</h2>
<p>ä¸ºäºå®ç°ç­å è½½æä»¬éè¦å®ä¹ä»¥ä¸3ä¸ªç±»ï¼</p>
<ul>
<li>CustomDefaultFilterChainManager:èªå®ä¹çé»è®¤è¿æ»¤å¨é¾ç®¡çè</li>
<li>CustomPathMatchingFilterChainResolver:èªå®ä¹çè·¯å¾å¹éè¿æ»¤å¨é¾è§£æå¨</li>
<li>CustomShiroFilterFactoryBean:èªå®ä¹shiroè¿æ»¤å¨å·¥åbean</li>
</ul>
<p><strong>CustomDefaultFilterChainManagerï¼ä¸»è¦æ¯æåæ¥å¯¹è±¡çåå»ºäº¤äºspringå®¹å¨ï¼åæ¶æå®è¿æ»¤å¨ï¼ç¶åæå»ºè¿æ»¤å¨é¾</strong></p>
<pre><code class="language-java">package com.itheima.shiro.core.impl;

import org.apache.shiro.util.StringUtils;
import org.apache.shiro.web.filter.AccessControlFilter;
import org.apache.shiro.web.filter.authc.AuthenticationFilter;
import org.apache.shiro.web.filter.authz.AuthorizationFilter;
import org.apache.shiro.web.filter.mgt.DefaultFilterChainManager;
import org.apache.shiro.web.filter.mgt.NamedFilterList;

import javax.annotation.PostConstruct;
import javax.servlet.Filter;
import java.util.LinkedHashMap;
import java.util.Map;

/**
 * @Descriptionï¼èªå®ä¹è¿æ»¤å¨é¾ç®¡çè
 */
public class CustomDefaultFilterChainManager extends DefaultFilterChainManager {

    //ç»å½å°å
    private String loginUrl;
    //ç»å½æåä¹åè·³è½¬å°å
    private String successUrl;
    //æªææè·³è½¬å°å
    private String unauthorizedUrl;

    /**
     * @Description æå»ºè¿æ»¤å¨åè¿æ»¤å¨é¾çmapå¯¹è±¡ï¼å è½½é»è®¤çè¿æ»¤å¨é¾
     */
    public CustomDefaultFilterChainManager() {
        setFilters(new LinkedHashMap&lt;String, Filter&gt;());
        setFilterChains(new LinkedHashMap&lt;String, NamedFilterList&gt;());
        addDefaultFilters(true);
    }

    @PostConstruct
    public void init(){
        Map&lt;String, Filter&gt; defaultFilters = getFilters();
        //apply global settings if necessary:
        for (Filter filter : defaultFilters.values()) {
            applyGlobalPropertiesIfNecessary(filter);
        }
    }

    private void applyGlobalPropertiesIfNecessary(Filter filter) {
        applyLoginUrlIfNecessary(filter);
        applySuccessUrlIfNecessary(filter);
        applyUnauthorizedUrlIfNecessary(filter);
    }

    private void applyLoginUrlIfNecessary(Filter filter) {
        String loginUrl = getLoginUrl();
        if (StringUtils.hasText(loginUrl) &amp;&amp; (filter instanceof AccessControlFilter)) {
            AccessControlFilter acFilter = (AccessControlFilter) filter;
            //only apply the login url if they haven't explicitly configured one already:
            String existingLoginUrl = acFilter.getLoginUrl();
            if (AccessControlFilter.DEFAULT_LOGIN_URL.equals(existingLoginUrl)) {
                acFilter.setLoginUrl(loginUrl);
            }
        }
    }

    private void applySuccessUrlIfNecessary(Filter filter) {
        String successUrl = getSuccessUrl();
        if (StringUtils.hasText(successUrl) &amp;&amp; (filter instanceof AuthenticationFilter)) {
            AuthenticationFilter authcFilter = (AuthenticationFilter) filter;
            //only apply the successUrl if they haven't explicitly configured one already:
            String existingSuccessUrl = authcFilter.getSuccessUrl();
            if (AuthenticationFilter.DEFAULT_SUCCESS_URL.equals(existingSuccessUrl)) {
                authcFilter.setSuccessUrl(successUrl);
            }
        }
    }

    private void applyUnauthorizedUrlIfNecessary(Filter filter) {
        String unauthorizedUrl = getUnauthorizedUrl();
        if (StringUtils.hasText(unauthorizedUrl) &amp;&amp; (filter instanceof AuthorizationFilter)) {
            AuthorizationFilter authzFilter = (AuthorizationFilter) filter;
            //only apply the unauthorizedUrl if they haven't explicitly configured one already:
            String existingUnauthorizedUrl = authzFilter.getUnauthorizedUrl();
            if (existingUnauthorizedUrl == null) {
                authzFilter.setUnauthorizedUrl(unauthorizedUrl);
            }
        }
    }

    /**
     * @Description å è½½èªå®ä¹è¿æ»¤å¨çå¯¹è±¡
     * @param customFilters èªå®ä¹è¿æ»¤å¨çmapæ¶æ
     * @return
     */
    public void setCustomFilters(Map&lt;String,Filter&gt; customFilters){
        for (Map.Entry&lt;String, Filter&gt; entry : customFilters.entrySet()) {
            addFilter(entry.getKey(), entry.getValue(), false);
        }

    }

    /**
     * @Description ä¸åä½¿ç¨shiroå®¹å¨å»æå»ºï¼èæ¯äº¤äºspringå»æå»º
     */
    @Override
    protected void initFilter(Filter filter) {

    }

    public String getLoginUrl() {
        return loginUrl;
    }

    public void setLoginUrl(String loginUrl) {
        this.loginUrl = loginUrl;
    }

    public String getSuccessUrl() {
        return successUrl;
    }

    public void setSuccessUrl(String successUrl) {
        this.successUrl = successUrl;
    }

    public String getUnauthorizedUrl() {
        return unauthorizedUrl;
    }

    public void setUnauthorizedUrl(String unauthorizedUrl) {
        this.unauthorizedUrl = unauthorizedUrl;
    }
}
</code></pre>
<p>CustomPathMatchingFilterChainResolverè¿éä¸»è¦æ ¸å¿åå®¹æ¯ï¼æå®ä½¿ç¨è¿æ»¤å¨é¾ç®¡çå¨ä¸ºèªå·±å®çè¿æ»¤å¨ç®¡çå¨</p>
<pre><code class="language-java">package com.itheima.shiro.core.impl;

import lombok.extern.log4j.Log4j2;
import org.apache.shiro.web.filter.mgt.FilterChainManager;
import org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver;

import javax.servlet.FilterChain;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;

/**
 * @Descriptionï¼èªå®ä¹è·¯å¾è§£æå¨
 */
@Log4j2
public class CustomPathMatchingFilterChainResolver extends PathMatchingFilterChainResolver {

    private CustomDefaultFilterChainManager defaultFilterChainManager;

    public CustomDefaultFilterChainManager getDefaultFilterChainManager() {
        return defaultFilterChainManager;
    }

    public void setDefaultFilterChainManager(CustomDefaultFilterChainManager defaultFilterChainManager) {
        this.defaultFilterChainManager = defaultFilterChainManager;
    }

    public FilterChain getChain(ServletRequest request, ServletResponse response, FilterChain originalChain) {
        //ä¸å¨ä½¿ç¨é»è®¤çè¿æ»¤å¨é¾ç®¡çèï¼èæ¯ä½¿ç¨èªå®ä¹çè¿æ»¤å¨ç®¡çè
        FilterChainManager filterChainManager = getDefaultFilterChainManager();
        if (!filterChainManager.hasChains()) {
            return null;
        }

        String requestURI = getPathWithinApplication(request);

        //the 'chain names' in this implementation are actually path patterns defined by the user.  We just use them
        //as the chain name for the FilterChainManager's requirements
        for (String pathPattern : filterChainManager.getChainNames()) {

            // If the path does match, then pass on to the subclass implementation for specific checks:
            if (pathMatches(pathPattern, requestURI)) {
                if (log.isTraceEnabled()) {
                    log.trace("Matched path pattern [" + pathPattern + "] for requestURI [" + requestURI + "].  " +
                            "Utilizing corresponding filter chain...");
                }
                return filterChainManager.proxy(originalChain, pathPattern);
            }
        }

        return null;
    }
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.core.impl;

import lombok.extern.log4j.Log4j2;
import org.apache.shiro.mgt.SecurityManager;
import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.filter.mgt.FilterChainManager;
import org.apache.shiro.web.filter.mgt.FilterChainResolver;
import org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver;
import org.apache.shiro.web.mgt.WebSecurityManager;
import org.apache.shiro.web.servlet.AbstractShiroFilter;
import org.springframework.beans.factory.BeanInitializationException;

/**
 * @Descriptionï¼éåshirodè¿æ»¤å¨å·¥å
 */
@Log4j2
public class CustomShiroFilterFactoryBean extends ShiroFilterFactoryBean {

    PathMatchingFilterChainResolver chainResolver ;

    public void setChainResolver(PathMatchingFilterChainResolver chainResolver) {
        this.chainResolver = chainResolver;
    }

    protected AbstractShiroFilter createInstance() throws Exception {

        log.debug("Creating Shiro Filter instance.");

        SecurityManager securityManager = getSecurityManager();
        if (securityManager == null) {
            String msg = "SecurityManager property must be set.";
            throw new BeanInitializationException(msg);
        }

        if (!(securityManager instanceof WebSecurityManager)) {
            String msg = "The security manager does not implement the WebSecurityManager interface.";
            throw new BeanInitializationException(msg);
        }

        FilterChainManager manager = createFilterChainManager();

        return new SpringShiroFilter((WebSecurityManager) securityManager, chainResolver);
    }

    private static final class SpringShiroFilter extends AbstractShiroFilter {

        protected SpringShiroFilter(WebSecurityManager webSecurityManager, FilterChainResolver resolver) {
            super();
            if (webSecurityManager == null) {
                throw new IllegalArgumentException("WebSecurityManager property cannot be null.");
            }
            setSecurityManager(webSecurityManager);
            if (resolver != null) {
                setFilterChainResolver(resolver);
            }
        }
    }
}
</code></pre>
<h3 id="shiroconfigä¿®æ¹">shiroConfigä¿®æ¹</h3>
<pre><code class="language-java">package com.itheima.shiro.config;


import com.itheima.shiro.constant.SuperConstant;
import com.itheima.shiro.core.ShiroDbRealm;
import com.itheima.shiro.core.filter.*;
import com.itheima.shiro.core.impl.*;
import com.itheima.shiro.properties.PropertiesUtil;
import lombok.extern.log4j.Log4j2;
import org.apache.shiro.authc.credential.HashedCredentialsMatcher;
import org.apache.shiro.session.mgt.eis.SessionDAO;
import org.apache.shiro.spring.LifecycleBeanPostProcessor;
import org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor;
import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.mgt.DefaultWebSecurityManager;
import org.apache.shiro.web.servlet.SimpleCookie;
import org.redisson.Redisson;
import org.redisson.api.RedissonClient;
import org.redisson.config.Config;
import org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.DependsOn;

import javax.servlet.Filter;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

/**
 * @Description æééç½®ç±»
 */
@Configuration
@ComponentScan(basePackages = {"com.itheima.shiro.core"})
@EnableConfigurationProperties({ShiroRedisProperties.class})
@Log4j2
public class ShiroConfig {

    @Autowired
    private ShiroRedisProperties shiroRedisProperties;

    @Autowired
    JwtTokenManager jwtTokenManager;

    /**
     * @Description redissionå®¢æ·ç«¯
     */
    @Bean("redissonClientForShiro")
    public RedissonClient redissonClient() {
        log.info("=====åå§åredissonClientForShiroå¼å§======");
        String[] nodeList = shiroRedisProperties.getNodes().split(",");
        Config config = new Config();
        if (nodeList.length == 1) {
            config.useSingleServer().setAddress(nodeList[0])
                    .setConnectTimeout(shiroRedisProperties.getConnectTimeout())
                    .setConnectionMinimumIdleSize(shiroRedisProperties.getConnectionMinimumidleSize())
                    .setConnectionPoolSize(shiroRedisProperties.getConnectPoolSize()).setTimeout(shiroRedisProperties.getTimeout());
        } else {
            config.useClusterServers().addNodeAddress(nodeList)
                    .setConnectTimeout(shiroRedisProperties.getConnectTimeout())
                    .setMasterConnectionMinimumIdleSize(shiroRedisProperties.getConnectionMinimumidleSize())
                    .setMasterConnectionPoolSize(shiroRedisProperties.getConnectPoolSize()).setTimeout(shiroRedisProperties.getTimeout());
        }
        RedissonClient redissonClient =  Redisson.create(config);
        log.info("=====åå§åredissonClientForShiroå®æ======");
        return redissonClient;
    }

    /**
     * @Description åå»ºcookieå¯¹è±¡
     */
    @Bean(name="sessionIdCookie")
    public SimpleCookie simpleCookie(){
        SimpleCookie simpleCookie = new SimpleCookie();
        simpleCookie.setName("ShiroSession");
        return simpleCookie;
    }

    /**
     * @Description æéç®¡çå¨
     * @param
     * @return
     */
    @Bean(name="securityManager")
    public DefaultWebSecurityManager defaultWebSecurityManager(){
        DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();
        securityManager.setRealm(shiroDbRealm());
        securityManager.setSessionManager(shiroSessionManager());
        return securityManager;
    }

    /**
     * @Description å¯ç æ¯è¾å¨
     */
    @Bean
    public HashedCredentialsMatcher hashedCredentialsMatcher (){
        RetryLimitCredentialsMatcher matcher = new RetryLimitCredentialsMatcher(SuperConstant.HASH_ALGORITHM,redissonClient());
        matcher.setHashIterations(SuperConstant.HASH_INTERATIONS);
        return matcher;
    }
    /**
     * @Description èªå®ä¹RealmImpl
     */
    @Bean(name="shiroDbRealm")
    public ShiroDbRealm shiroDbRealm(){
        ShiroDbRealm shiroDbRealm =new ShiroDbRealmImpl();
        shiroDbRealm.setCredentialsMatcher(hashedCredentialsMatcher());
        return shiroDbRealm;
    }


    /**
     * @Description èªå®ä¹sessionä¼è¯å­å¨çå®ç°ç±» ï¼ä½¿ç¨Redisæ¥å­å¨å±äº«sessionï¼è¾¾å°åå¸å¼é¨ç½²ç®ç
     */
    @Bean("redisSessionDao")
    public SessionDAO redisSessionDao(){
        RedisSessionDao sessionDAO =   new RedisSessionDao();
        sessionDAO.setGlobalSessionTimeout(shiroRedisProperties.getGlobalSessionTimeout());
        return sessionDAO;
    }

    /**
     * @Description ä¼è¯ç®¡çå¨
     */
    @Bean(name="sessionManager")
    public ShiroSessionManager shiroSessionManager(){
        ShiroSessionManager sessionManager = new ShiroSessionManager();
        sessionManager.setSessionDAO(redisSessionDao());
        sessionManager.setSessionValidationSchedulerEnabled(false);
        sessionManager.setSessionIdCookieEnabled(true);
        sessionManager.setSessionIdCookie(simpleCookie());
        sessionManager.setGlobalSessionTimeout(shiroRedisProperties.getGlobalSessionTimeout());
        return sessionManager;
    }

    /**
     * @Description ä¿è¯å®ç°äºShiroåé¨lifecycleå½æ°çbeanæ§è¡
     */
    @Bean(name = "lifecycleBeanPostProcessor")
    public static LifecycleBeanPostProcessor getLifecycleBeanPostProcessor() {
        return new LifecycleBeanPostProcessor();
    }

    /**
     * @Description AOPå¼æ¹æ³çº§æéæ£æ¥
     */
    @Bean
    @DependsOn("lifecycleBeanPostProcessor")
    public DefaultAdvisorAutoProxyCreator getDefaultAdvisorAutoProxyCreator() {
        DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator = new DefaultAdvisorAutoProxyCreator();
        defaultAdvisorAutoProxyCreator.setProxyTargetClass(true);
        return defaultAdvisorAutoProxyCreator;
    }

    /**
     * @Description éåDefaultAdvisorAutoProxyCreatoräºé¡¹æ³¨è§£æéæ ¡éª
     */
    @Bean
    public AuthorizationAttributeSourceAdvisor getAuthorizationAttributeSourceAdvisor() {
        AuthorizationAttributeSourceAdvisor aasa = new AuthorizationAttributeSourceAdvisor();
        aasa.setSecurityManager(defaultWebSecurityManager());
        return new AuthorizationAttributeSourceAdvisor();
    }

    /**
     * @Description èªå®ä¹è¿æ»¤å¨å®ä¹
     */
    private Map&lt;String, Filter&gt; filters() {
        Map&lt;String, Filter&gt; map = new HashMap&lt;String, Filter&gt;();
        map.put("role-or", new RolesOrAuthorizationFilter());
        map.put("kicked-out", new KickedOutAuthorizationFilter(redissonClient(), redisSessionDao(), shiroSessionManager()));
        map.put("jwt-authc", new JwtAuthcFilter(jwtTokenManager));
        map.put("jwt-perms", new JwtPermsFilter());
        map.put("jwt-roles", new JwtRolesFilter());
        return map;
    }

	// ===========================ä»¥ä¸æ¯ä¿®æ¹é¨å================================

    @Bean
    public CustomDefaultFilterChainManager defaultFilterChainManager(){
        CustomDefaultFilterChainManager defaultFilterChainManager = new CustomDefaultFilterChainManager();
        defaultFilterChainManager.setCustomFilters(filters());
        defaultFilterChainManager.setLoginUrl("/login");
        defaultFilterChainManager.setSuccessUrl("/home");
        defaultFilterChainManager.setUnauthorizedUrl("/login");
        return defaultFilterChainManager;
    }

    @Bean
    public CustomPathMatchingFilterChainResolver chainResolver(){
        CustomPathMatchingFilterChainResolver chainResolver = new CustomPathMatchingFilterChainResolver();
        //æå®è¿æ»¤å¨ç®¡çè
        chainResolver.setDefaultFilterChainManager(defaultFilterChainManager());
        return chainResolver;
    }
    /**
     * @Description Shiroè¿æ»¤å¨
     */
    @Bean("shiroFilter")
    public ShiroFilterFactoryBean shiroFilterFactoryBean(){
        CustomShiroFilterFactoryBean shiroFilter = new CustomShiroFilterFactoryBean();
        shiroFilter.setChainResolver(chainResolver());
        shiroFilter.setSecurityManager(defaultWebSecurityManager());
        return shiroFilter;
    }

}
</code></pre>
<h1 id="shiro-clientå®¢æ·ç«¯">shiro-clientå®¢æ·ç«¯</h1>
<p>shiro-clientä½ä¸ºjarçä¾èµï¼æ»¡è¶³ä»¥ä¸éæ±ï¼</p>
<p>1ãéä¾µå¥å¼ï¼ä½¿ç¨èåªéè¦å¯¹jarä¾èµååå°éçéç½®ï¼å°±å¯ä»¥è¾¾å°ç»ä¸é´æçç®æ </p>
<p>2ãå¯æ©å±æ§ï¼ç¨æ·é¤ä½¿ç¨æä¾çè¿æ»¤å¨å¤ï¼å¯ä»¥è½»æ¾å®èªå·±çä¸å¡åºå®ä¹è¿æ»¤å¨</p>
<p>3ãéä¸­å¼ç®¡çï¼ä¾èµjarä¹åï¼shiro-mgtåå°å¯ä»¥åæ¶ç®¡æ§å¤ä¸ªå¹³å°çæéçè®¤è¯ãé´æãåå¨æéç½®è¿æ»¤å¨é¾</p>
<h2 id="ä¾èµå³ç³»">ä¾èµå³ç³»</h2>
<p><img alt="1582688991837" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3388489/202601/3388489-20260114154822389-132813609.png" class="lazyload"></p>
<h2 id="åçåæ">åçåæ</h2>
<p>springboot-shiro-framework-clienté¡¹ç®åä¸ç»§æ¿äºspringboot-shiro-framework-coreé¡¹ç®ï¼springboot-shiro-framework-coreæ¯ä¸»è¦å®ç°è®¤è¯ãé´æãè¿æ»¤å¨å®ä¹ãä¼è¯ç»ä¸ãrealmç¼å­çæ ¸å¿é¡¹ç®ã</p>
<p>springboot-shiro-framework-clienté¡¹ç®ä»¥jarçæ¹å¼è¢«éè¦åæéæ§å¶çgatewayé¡¹ç®æä¾èµï¼åç±gatewayéè¿å¯¹springboot-shiro-producerçdubboæ¶è´¹ï¼ä»¥è¾¾å°ç»ä¸è®¤è¯ãé´æ</p>
<p>springboot-shiro-framework-clientæ¨¡åå®ç°äºspringboot-shiro-framework-coreæ¥å£ç3ä¸ªç±»ï¼</p>
<p>UserBridgeServiceImpl:æä¾ç¨æ·åºæ¬èµæºæä½çä¸å¡å®ç°<br>
FilterChainBridgeServiceImpl:æä¾è¿æ»¤å¨é¾æ¥å£çæ¥è¯¢<br>
ResourceBridgeServiceImpl:æä¾èµæºæ¥è¯¢</p>
<pre><code class="language-java">package com.itheima.shiro.client;

import com.itheima.shiro.core.bridge.FilterChainBridgeService;
import com.itheima.shiro.face.FilterChainFace;
import com.itheima.shiro.vo.FilterChainVo;
import org.apache.dubbo.config.annotation.Reference;
import org.springframework.stereotype.Service;

import java.util.List;

/**
 * @Descriptionï¼èªå®ä¹è¿æ»¤å¨æ¡¥æ¥æ¥å£å®ç°
 */
@Service("filterChainBridgeService")
public class FilterChainBridgeServiceImpl implements FilterChainBridgeService {

    @Reference(version = "1.0.0")
    private FilterChainFace filterChainFace;

    @Override
    public List&lt;FilterChainVo&gt; findFilterChainList() {
        return filterChainFace.findFilterChainList();
    }
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.client;

import com.itheima.shiro.core.bridge.ResourceBridgeService;
import com.itheima.shiro.face.ResourceAdapterFace;
import com.itheima.shiro.vo.ResourceVo;
import org.apache.dubbo.config.annotation.Reference;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import java.util.List;

/**
 * @Descriptionï¼ç½å³èµæºæ¡¥æ¥å¨æ¥å£å®ç°
 */
@Component("resourceBridgeService")
public class ResourceBridgeServiceImpl implements ResourceBridgeService {

    @Value("${itheima.resource.systemcode}")
    private String systemCode;

    @Reference(version = "1.0.0")
    ResourceAdapterFace resourceAdapterFace;

    @Override
    public List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode) {
        return resourceAdapterFace.findValidResourceVoAll(systemCode);
    }
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.client;

import com.itheima.shiro.constant.CacheConstant;
import com.itheima.shiro.core.SimpleCacheService;
import com.itheima.shiro.core.base.ShiroUser;
import com.itheima.shiro.core.base.SimpleMapCache;
import com.itheima.shiro.core.base.SimpleToken;
import com.itheima.shiro.core.bridge.UserBridgeService;
import com.itheima.shiro.face.UserAdapterFace;
import com.itheima.shiro.utils.BeanConv;
import com.itheima.shiro.utils.EmptyUtil;
import com.itheima.shiro.utils.ShiroUserUtil;
import com.itheima.shiro.vo.ResourceVo;
import com.itheima.shiro.vo.RoleVo;
import com.itheima.shiro.vo.UserVo;
import lombok.extern.slf4j.Slf4j;
import org.apache.dubbo.config.annotation.Reference;
import org.apache.shiro.authc.AuthenticationInfo;
import org.apache.shiro.authc.AuthenticationToken;
import org.apache.shiro.authc.SimpleAuthenticationInfo;
import org.apache.shiro.authc.UnknownAccountException;
import org.apache.shiro.authz.SimpleAuthorizationInfo;
import org.apache.shiro.util.ByteSource;
import org.redisson.api.RBucket;
import org.redisson.api.RedissonClient;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.concurrent.TimeUnit;


/**
 * @Description æéæ¡¥æ¥å¨
 */
@Slf4j
@Component("userBridgeService")
public class UserBridgeServiceImpl implements UserBridgeService {

    @Reference(version = "1.0.0")
    private UserAdapterFace userAdapterFace;

    @Autowired
    private SimpleCacheService simpleCacheService;

    @javax.annotation.Resource(name = "redissonClientForShiro")
    private RedissonClient redissonClient;

    public AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authcToken,String realmName) {
        SimpleToken token = (SimpleToken)authcToken;
        UserVo user  = this.findUserByLoginName(token.getUsername());
        if(EmptyUtil.isNullOrEmpty(user)){
            throw new UnknownAccountException("è´¦å·ä¸å­å¨");
        }
        ShiroUser shiroUser = BeanConv.toBean(user, ShiroUser.class);
        String sessionId = ShiroUserUtil.getShiroSessionId();
        String cacheKeyResourcesIds = CacheConstant.RESOURCES_KEY_IDS+sessionId;
        shiroUser.setResourceIds(this.findResourcesIdsList(cacheKeyResourcesIds,user.getId()));
        String salt = user.getSalt();
        String password = user.getPassWord();
        return new SimpleAuthenticationInfo(shiroUser, password, ByteSource.Util.bytes(salt), realmName);
    }

    @Override
    public SimpleAuthorizationInfo getAuthorizationInfo(ShiroUser shiroUser) {
        UserVo user = BeanConv.toBean(shiroUser, UserVo.class);
        SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();
        String sessionId = ShiroUserUtil.getShiroSessionId();
        //æ¥è¯¢ç¨æ·æ¥æçè§è²
        String cacheKeyRole = CacheConstant.ROLE_KEY + sessionId;
        info.addRoles(this.findRoleList(cacheKeyRole, user.getId()));

        //æ¥è¯¢ç¨æ·æ¥æçèµæº
        String cacheKeyResources = CacheConstant.RESOURCES_KEY + sessionId;
        info.addStringPermissions(this.findResourcesList(cacheKeyResources, user.getId()));
        return info;
    }


    @Override
    public List&lt;String&gt; findRoleList(String cacheKeyRole, String userId) {
        List&lt;RoleVo&gt; roles = new ArrayList&lt;RoleVo&gt;();
        if (simpleCacheService.getCache(cacheKeyRole) != null) {
            roles = (List&lt;RoleVo&gt;) simpleCacheService.getCache(cacheKeyRole).get(cacheKeyRole);
        } else {
            roles = userAdapterFace.findRoleByUserId(userId);
            if (roles.size() &gt; 0) {
                //ç¨æ·è§è²å­æ¾å°map
                Map&lt;Object, Object&gt; mapRole = new HashMap&lt;Object, Object&gt;();
                mapRole.put(cacheKeyRole, roles);
                //æ°å»ºSimpleMapCacheå®ä¾å¹¶æ¾å¥ç¼å­ç®¡çå¨
                SimpleMapCache cacheRole = new SimpleMapCache(cacheKeyRole, mapRole);
                simpleCacheService.creatCache(cacheKeyRole, cacheRole);
            }
        }
        List&lt;String&gt; rolesLabel = new ArrayList&lt;String&gt;();
        for (RoleVo role : roles) {
            rolesLabel.add(role.getLabel());
        }
        return rolesLabel;
    }


    @Override
    public List&lt;String&gt; findResourcesList(String cacheKeyResources,String userId) {
        List&lt;ResourceVo&gt; resourcesList = new ArrayList&lt;ResourceVo&gt;();
        if (simpleCacheService.getCache(cacheKeyResources) != null) {
            resourcesList = (List&lt;ResourceVo&gt;) simpleCacheService.getCache(cacheKeyResources).get(cacheKeyResources);
        } else {
            resourcesList = userAdapterFace.findResourceByUserId(userId);
            if (resourcesList.size() &gt; 0) {
                //ç¨æ·èµæºå­æ¾å°map
                Map&lt;Object, Object&gt; mapResource = new HashMap&lt;Object, Object&gt;();
                mapResource.put(cacheKeyResources, resourcesList);
                //æ°å»ºSimpleMapCacheå®ä¾å¹¶æ¾å¥ç¼å­ç®¡çå¨
                SimpleMapCache cacheResource = new SimpleMapCache(cacheKeyResources, mapResource);
                simpleCacheService.creatCache(cacheKeyResources, cacheResource);
            }
        }
        List&lt;String&gt; resourcesLabel = new ArrayList&lt;String&gt;();
        for (ResourceVo resources : resourcesList) {
            resourcesLabel.add(resources.getLabel());
        }
        return resourcesLabel;
    }


    @Override
    public UserVo findUserByLoginName(String loginName) {
        String key = CacheConstant.FIND_USER_BY_LOGINNAME+loginName;
        RBucket&lt;UserVo&gt; rBucket = redissonClient.getBucket(key);
        UserVo user = rBucket.get();
        if (!EmptyUtil.isNullOrEmpty(user)) {
            return user;
        }else {
            user = userAdapterFace.findUserByLoginName(loginName);
            if (!EmptyUtil.isNullOrEmpty(user)) {
                rBucket.set(user, 300, TimeUnit.SECONDS);
                return user;
            }
        }
        rBucket.set(new UserVo(), 3, TimeUnit.SECONDS);
        return null;
    }

    @Override
    public List&lt;String&gt; findResourcesIdsList(String cacheKeyResources,String userId) {
        List&lt;ResourceVo&gt; resourcesList = new ArrayList&lt;ResourceVo&gt;();
        if (simpleCacheService.getCache(cacheKeyResources) != null) {
            resourcesList = (List&lt;ResourceVo&gt;) simpleCacheService.getCache(cacheKeyResources).get(cacheKeyResources);
        } else {
            resourcesList = userAdapterFace.findResourceByUserId(userId);
            if (resourcesList.size() &gt; 0) {
                //ç¨æ·èµæºå­æ¾å°map
                Map&lt;Object, Object&gt; mapResource = new HashMap&lt;Object, Object&gt;();
                mapResource.put(cacheKeyResources, resourcesList);
                //æ°å»ºSimpleMapCacheå®ä¾å¹¶æ¾å¥ç¼å­ç®¡çå¨
                SimpleMapCache cacheResource = new SimpleMapCache(cacheKeyResources, mapResource);
                simpleCacheService.creatCache(cacheKeyResources, cacheResource);
            }
        }
        List&lt;String&gt; resourcesLabel = new ArrayList&lt;String&gt;();
        for (ResourceVo resources : resourcesList) {
            resourcesLabel.add(resources.getId());
        }
        return resourcesLabel;
    }

    @Override
    public void loadUserAuthorityToCache(ShiroUser user) {
        String sessionId = user.getSessionId();
        List&lt;RoleVo&gt; roles = userAdapterFace.findRoleByUserId(user.getId());
        //åå»ºè§è²cachaeKey
        String cacheKeyRole = CacheConstant.ROLE_KEY + sessionId;
        //ç¨æ·è§è²å­æ¾å°map
        Map&lt;Object, Object&gt; mapRole = new HashMap&lt;Object, Object&gt;();
        mapRole.put(cacheKeyRole, roles);
        //æ°å»ºSimpleMapCacheå®ä¾å¹¶æ¾å¥ç¼å­ç®¡çå¨
        SimpleMapCache cacheRole = new SimpleMapCache(cacheKeyRole, mapRole);
        simpleCacheService.creatCache(cacheKeyRole, cacheRole);

        List&lt;ResourceVo&gt; resourcesList = userAdapterFace.findResourceByUserId(user.getId());
        if (resourcesList.size() &gt; 0) {
            //åå»ºèµæºcachaeKey
            String cacheKeyResources = CacheConstant.RESOURCES_KEY + sessionId;
            //ç¨æ·èµæºå­æ¾å°map
            Map&lt;Object, Object&gt; mapResource = new HashMap&lt;Object, Object&gt;();
            mapResource.put(cacheKeyResources, resourcesList);
            //æ°å»ºSimpleMapCacheå®ä¾å¹¶æ¾å¥ç¼å­ç®¡çå¨
            SimpleMapCache cacheResource = new SimpleMapCache(cacheKeyResources, mapResource);
            simpleCacheService.creatCache(cacheKeyResources, cacheResource);
        }
    }
}
</code></pre>
<h1 id="shiro-gatewayç½å³">shiro-gatewayç½å³</h1>
<h2 id="åçåæ-1">åçåæ</h2>
<p><img alt="1582880165581" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3388489/202601/3388489-20260114154843500-1653774029.png" class="lazyload"></p>
<p>â	1ãä¾èµspringboot-shiro-framework-clientå®ç°è®¤è¯ãé´æãè¿æ»¤å¨å®ä¹ãä¼è¯ç»ä¸ãrealmç¼å­ç­åè½</p>
<p>â	2ãspringboot-shiro-mgtç®¡çåå°æä¹åç½å³èµæº</p>
<p>â	3ãspringboot-shiro-handlerå®ç°ç½å³èµæºæ¥è¯¢æå¡å</p>
<p>â	4ãgateway-serviceä¾æ®æä¹åçç½å³èµæºï¼å¨æåå»ºæ¶è´¹ç«¯æå¡</p>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="ç½å³èµæºæä¹å">ç½å³èµæºæä¹å</h3>
<p>è¿éå¨åæèµæºçåºç¡ä¸ï¼å¢å çç½å³èµæºçç®¡çï¼</p>
<p>â		1ãå®ä¹ç½å³systemcodeï¼ç¨ä»¥åºåä¸åç½å³ç³»ç»</p>
<p>â		2ãå®ä¹è®¿é®çè·¯å¾</p>
<p>â		3ãå®ä¹èµæºçå¯ä¸æ è¯ï¼ä½ä¸ºæéæ§å¶çæ è¯</p>
<p>â		4ãå®ä¹ä¸å¡ç«¯dubboæå¡ç«¯æ¥å£ãç®æ æ¹æ³ãä¼ å¥éè¿°ãè½®è®­ç®æ³ãè¶æ¶æ¶é´ãéè¯æ¬¡æ°ç­åæ°ï¼è¿äºåå®¹ä¼å¨gateway-serviceé¡¹ç®ä¸­è§£æ</p>
<h3 id="ç½å³èµæºæå¡å">ç½å³èµæºæå¡å</h3>
<pre><code class="language-properties">ResourceAdapterFace:ç½å³èµæºæå¡æ¥å£
ResourceAdapterFaceImpl:ç½å³èµæºæå¡æ¥å£å®ç°

ResourceBridgeService:ç½å³èµæºæ¡¥æ¥å¨æ¥å£
ResourceBridgeServiceImpl:ç½å³èµæºæ¡¥æ¥å¨æ¥å£å®ç°
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.face;

import com.itheima.shiro.vo.ResourceVo;

import java.util.List;

/**
 * @Descriptionï¼ç½å³èµæºæå¡æ¥å£
 */
public interface ResourceAdapterFace {

    /**
     * @Description è·å¾å½åç³»ç»æ¯ç±ææçdubboçèµæº
     */
    List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode);
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.faceImpl;

import com.itheima.shiro.face.ResourceAdapterFace;
import com.itheima.shiro.pojo.Resource;
import com.itheima.shiro.service.ResourceService;
import com.itheima.shiro.utils.BeanConv;
import com.itheima.shiro.utils.EmptyUtil;
import com.itheima.shiro.vo.ResourceVo;
import org.apache.dubbo.config.annotation.Service;
import org.springframework.beans.factory.annotation.Autowired;

import java.util.List;

/**
 * @Descriptionï¼ç½å³èµæºæå¡æ¥å£å®ç°
 */
@Service(version = "1.0.0", retries = 3,timeout = 5000)
public class ResourceAdapterFaceImpl implements ResourceAdapterFace {

    // ç½å³èµæºçæä¹åæå¡
    @Autowired
    ResourceService resourceService;

    @Override
    public List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode) {
        List&lt;Resource&gt; resourceList =  resourceService.findValidResourceVoAll(systemCode);
        if (!EmptyUtil.isNullOrEmpty(resourceList)){
            return BeanConv.toBeanList(resourceList, ResourceVo.class);
        }
        return  null;
    }
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.core.bridge;

import com.itheima.shiro.vo.ResourceVo;

import java.util.List;

/**
 * @Descriptionï¼ç½å³èµæºæ¡¥æ¥å¨æ¥å£
 */
public interface ResourceBridgeService {

    /**
     * @Description æ¥è¯¢å½åç³»ç»ææææçDUBBOç±»åçæå¡
     * @param systemCode ç³»ç»ç¼å·ï¼ä¸mgtæ·»å ç³»ç»ç¼å·ç¸å
     * @return
     */
    public List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode);
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.client;

import com.itheima.shiro.core.bridge.ResourceBridgeService;
import com.itheima.shiro.face.ResourceAdapterFace;
import com.itheima.shiro.vo.ResourceVo;
import org.apache.dubbo.config.annotation.Reference;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import java.util.List;

/**
 * @Descriptionï¼ç½å³èµæºæ¡¥æ¥å¨æ¥å£å®ç°
 */
@Component("resourceBridgeService")
public class ResourceBridgeServiceImpl implements ResourceBridgeService {

    @Value("${itheima.resource.systemcode}")
    private String systemCode;

    @Reference(version = "1.0.0")
    ResourceAdapterFace resourceAdapterFace;

    @Override
    public List&lt;ResourceVo&gt; findValidResourceVoAll(String systemCode) {
        return resourceAdapterFace.findValidResourceVoAll(systemCode);
    }
}
</code></pre>
<h3 id="å¨ææ¶è´¹ç«¯">å¨ææ¶è´¹ç«¯</h3>
<p><img alt="1582882166870" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3388489/202601/3388489-20260114154859603-165917733.png" class="lazyload"></p>
<p>CacheWare:ç¼å­ä»åº</p>
<p>CacheWareService:ç¼å­ä»åºæå¡æ¥å£<br>
CacheWareServiceImpl:ç¼å­ä»åºæå¡æ¥å£å®ç°</p>
<p>CacheWareSyncService:ç¼å­ä»åºåæ­¥æå¡æ¥å£<br>
CacheWareSyncServiceImpl:ç¼å­ä»åºåæ­¥æå¡æ¥å£å®ç°</p>
<p>LoginAction:ç»å½ç¸åºæ¥å£<br>
GateWayController:ç¸åºå±çç»ä¸å¥å£</p>
<pre><code class="language-java">package com.itheima.shiro.pojo;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.lang.reflect.Method;
import java.lang.reflect.Type;

/**
 * @Description ç¼å­ä»åºå¯æ§è¡ç±»
 */
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class CacheWare {

    //æ§è¡ç±»
    private String serviceName;

    //æ§è¡æ¹æ³
    private String methodName;

    //æ¹æ³å¯¹è±¡
    private Method method;

    //åæ°ç±»å
    private Class&lt;?&gt; methodParamsClass;

    //ä»£çç±»
    private Object proxy;


}
</code></pre>
<h4 id="cachewareservice">CacheWareService</h4>
<p>å¶ä¸»è¦è´è´£ï¼</p>
<p>1ãç¼å­çæ¸é¤</p>
<p>2ãåmapå®¹å¨ä¸­åå»ºç¼å­</p>
<p>3ãè·å¾ç¼å­ä»åºæ§è¡å¯¹è±¡</p>
<pre><code class="language-java">package com.itheima.shiro.cache;

import com.google.common.collect.Multimap;
import com.itheima.shiro.pojo.CacheWare;

/**
 * @Descriptionï¼ç¼å­ä»åºæå¡
 */
public interface CacheWareService {

    /**
     * @Description æ¸é¤ç¼å­
     */
    void clearCacheWare();

    /**
     * @Description åmapå®¹å¨ä¸­åå»ºç¼å­
     * @param cacheWareMap
     */
    void createCacheWare(Multimap&lt;String, CacheWare&gt; cacheWareMap);

    /**
     * @Description è·å¾ç¼å­ä»åºæ§è¡å¯¹è±¡
     * @param serviceName æå¡å
     * @param methodName  æ¹æ³å
     * @return {@link CacheWare}
     *
     */
    CacheWare queryCacheWare(String serviceName, String methodName);


}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.cache.impl;

import com.google.common.collect.ArrayListMultimap;
import com.google.common.collect.Multimap;
import com.itheima.shiro.cache.CacheWareService;
import com.itheima.shiro.pojo.CacheWare;
import com.itheima.shiro.utils.EmptyUtil;
import org.springframework.stereotype.Service;

import java.util.Collection;

/**
 * @Descriptionï¼ç¼å­ä»åºæå¡å®ç°
 */
@Service("cacheWareService")
public class CacheWareServiceImpl implements CacheWareService {

    private Multimap&lt;String, CacheWare&gt; cacheWareMap = ArrayListMultimap.create();

    @Override
    public void clearCacheWare() {
        cacheWareMap.clear();
    }

    @Override
    public void createCacheWare(Multimap&lt;String, CacheWare&gt; cacheWareMap) {
        this.cacheWareMap = cacheWareMap;
    }

    @Override
    public CacheWare queryCacheWare(String serviceName, String methodName) {
        if (EmptyUtil.isNullOrEmpty(serviceName)||EmptyUtil.isNullOrEmpty(methodName)){
            return null;
        }
        String key = serviceName+":"+methodName;
        Collection&lt;CacheWare&gt; cacheWares =cacheWareMap.get(key);
        return EmptyUtil.isNullOrEmpty(cacheWares)?null:cacheWares.iterator().next();
    }
}
</code></pre>
<h4 id="cachewaresyncservice">CacheWareSyncService</h4>
<p>å¶ä¸»è¦èè´£ï¼</p>
<p>1ãå¯å¨æ¶ãè°ç¨CacheWareServiceçåå»ºç¼å­æ¹æ³åå§åç¼å­ä»åº</p>
<p>2ãåæ­¥ç¼å­ä»åº</p>
<p>3ãç½å³èµæºè½¬åç¼å­ä»åºå¯æ§è¡å¯¹è±¡</p>
<p>4ãä»dubboä¸­ï¼åå§åä»£çå¯¹è±¡</p>
<p>æ³¨æï¼ä¸ºäºå¨å¤ä¸ªç½å³ç³»ç»ä¸ï¼æ¥å£è½¬æ¢çæ å¹²æ°ï¼è¯»åçåªæ¯æ¬ç½å³æå¯¹åºçèµæº</p>
<pre><code class="language-java">package com.itheima.shiro.cache;

import com.itheima.shiro.pojo.CacheWare;
import com.itheima.shiro.vo.ResourceVo;

/**
 * @Descriptionï¼ç¼å­ä»åºåæ­¥æ¥å£
 */
public interface CacheWareSyncService {

    /**
     * @Description åå§åç¼å­ä»åº
     */
    void initCacheWare();

    /**
     * @Description åæ­¥ç¼å­ä»åº
     */
    void refreshCacheWare();

    /**
     * @Description èµæºè½¬æ¢ç¼å­ä»åºå¯æ§è¡å¯¹è±¡
     */
    CacheWare resourceConvCacheWare(ResourceVo resource);

    /**
     * @Description åå§åä»£çå¯¹è±¡
     * @param interfaceClass æ¥å£
     * @param loadbalance ç®æ³
     * @param version çæ¬
     * @param timeout è¶æ¶æ¶é´
     * @param retries éè¯æ¬¡æ°
     */
    Object initProxy(Class&lt;?&gt; interfaceClass,
                     String loadbalance,
                     String version,
                     Integer timeout,
                     Integer retries);

    /**
     * @Description åæ¶èµæº
     */
    void destoryCacheWare();
}
</code></pre>
<pre><code class="language-java">package com.itheima.shiro.cache.impl;

import com.google.common.collect.ArrayListMultimap;
import com.google.common.collect.Multimap;
import com.itheima.shiro.cache.CacheWareService;
import com.itheima.shiro.cache.CacheWareSyncService;
import com.itheima.shiro.core.bridge.ResourceBridgeService;
import com.itheima.shiro.pojo.CacheWare;
import com.itheima.shiro.utils.EmptyUtil;
import com.itheima.shiro.vo.ResourceVo;
import lombok.extern.log4j.Log4j2;
import org.apache.dubbo.config.ApplicationConfig;
import org.apache.dubbo.config.ReferenceConfig;
import org.apache.dubbo.config.RegistryConfig;
import org.apache.dubbo.config.utils.ReferenceConfigCache;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;

import javax.annotation.PostConstruct;
import javax.annotation.Resource;
import java.lang.reflect.Method;
import java.util.List;
import java.util.Set;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

/**
 * @Descriptionï¼ç¼å­ä»åºåæ­¥æå¡æ¥å£å®ç°
 */
@Service("cacheWareSyncService")
@Log4j2
public class CacheWareSyncServiceImpl implements CacheWareSyncService {

    @Value("${itheima.resource.systemcode}")
    private String systemCode;

    @Autowired
    CacheWareService cacheWareService;

    @Autowired
    ResourceBridgeService resourceBridgeService;

    @Autowired
    private ApplicationConfig applicationConfig;

    @Autowired
    private RegistryConfig registryConfig;

    //çº¿ç¨æ± 
    private ScheduledExecutorService executorService = Executors.newScheduledThreadPool(1);

    @Override
    @PostConstruct
    public void initCacheWare() {
        executorService.scheduleAtFixedRate(new Runnable() {
            @Override
            public void run() {
                refreshCacheWare();
            }
        }, 0, 2, TimeUnit.MINUTES);

    }

    @Override
    public void refreshCacheWare() {
        //è·å¾ç½å³èµæº
        List&lt;ResourceVo&gt; resources = resourceBridgeService.findValidResourceVoAll(systemCode);
        //å¤æ­ç½å³èµæºæ¯å¦ä¸ºç©ºï¼åæ¸ç©ºææmapå®¹å¨ä¸­çå¯æ§è¡å¯¹è±¡
        if (EmptyUtil.isNullOrEmpty(resources)){
            cacheWareService.clearCacheWare();
        }
        Multimap&lt;String,CacheWare&gt; cacheWareMultimap = ArrayListMultimap.create();
        //æç½å³èµæºè½¬æ¢ä¸ºç¼å­ä»åºå¯æ§è¡å¯¹è±¡
        for (ResourceVo resource : resources) {
            if (EmptyUtil.isNullOrEmpty(resource.getServiceName())||
                EmptyUtil.isNullOrEmpty(resource.getMethodName())){
                log.warn("ç½å³èµæºå®ä¹ä¸å®æ´ï¼{}",resource.toString());
                continue;
            }
            CacheWare cacheWare = resourceConvCacheWare(resource);
            if (!EmptyUtil.isNullOrEmpty(cacheWare)){
                String key = cacheWare.getServiceName()+":"+cacheWare.getMethodName();
                cacheWareMultimap.put(key, cacheWare);
            }
        }

        //æ¾å¥mapå®¹å¨
        cacheWareService.createCacheWare(cacheWareMultimap);
    }

    @Override
    public CacheWare resourceConvCacheWare(ResourceVo resource) {
        //ç½å³èµæºæå¡æ¥å£
        Class&lt;?&gt; serviceClass = null;
        try {
            serviceClass = Class.forName(resource.getServiceName());
        } catch (ClassNotFoundException e) {
            log.error("ä¸ºå¨å®¹å¨ä¸­åç°{}æ¥å£ç±»",resource.getServiceName());
            return null;
        }
        String serviceNameAll = resource.getServiceName();
        // è·å¾ç±»å
        String serviceName = serviceNameAll.substring(serviceNameAll.lastIndexOf(".")+1).toLowerCase();
        //å¯¹åºçæ§è¡æ¹æ³
        Method[] methods = serviceClass.getDeclaredMethods();
        Method methodTarget = null;
        for (Method method : methods) {
            if (method.getName().equals(resource.getMethodName())){
                methodTarget = method;
                break;
            }
        }
        //å¦ææ¹æ³è·åå¤±è´¥
        if (EmptyUtil.isNullOrEmpty(methodTarget)){
            log.error("ä¸ºå¨å®¹å¨ä¸­åç°{}æ¹æ³",resource.getMethodName());
            return null;
        }
        //è·å¾æ¹æ³ä¸çä¼ å¥åæ°
        Class&lt;?&gt;[] parameterTypes = methodTarget.getParameterTypes();
        Class&lt;?&gt; methodParamsClassTarget = null;
        for (Class&lt;?&gt; parameterType : parameterTypes) {
            if (parameterType.getName().equals(resource.getMethodParam())){
                methodParamsClassTarget = parameterType;
                break;
            }
        }
        //æå»ºæå¡ä»£çç±»
        Object proxy = initProxy(serviceClass, resource.getLoadbalance(), resource.getDubboVersion(), resource.getTimeout(), resource.getRetries());
        //æå»ºç¼å­ä»åºå¯æ§è¡å¯¹è±¡
        CacheWare cacheWare = CacheWare.builder()
                .serviceName(serviceName)
                .methodName(resource.getMethodName())
                .method(methodTarget)
                .methodParamsClass(methodParamsClassTarget)
                .proxy(proxy).build();
        return cacheWare;
    }

    // è·åä»£çç±»
    @Override
    public Object initProxy(Class&lt;?&gt; interfaceClass, String loadbalance, String version, Integer timeout, Integer retries) {
        // æå»ºæ¶è´¹ç«¯
        ReferenceConfig&lt;Object&gt; referenceConfig = new ReferenceConfig&lt;&gt;();
        referenceConfig.setApplication(applicationConfig);
        referenceConfig.setRegistry(registryConfig);
        referenceConfig.setLoadbalance(EmptyUtil.isNullOrEmpty(loadbalance)?"random":loadbalance);
        referenceConfig.setInterface(interfaceClass);
        referenceConfig.setVersion(version);
        referenceConfig.setTimeout(EmptyUtil.isNullOrEmpty(timeout)?20000:timeout);
        referenceConfig.setCheck(false);
        // æå®éè¯æ¬¡æ°
        referenceConfig.setRetries(EmptyUtil.isNullOrEmpty(retries)?0:retries);
        ReferenceConfigCache cache = ReferenceConfigCache.getCache();
        return cache.get(referenceConfig);
    }

    @Override
    public void destoryCacheWare() {
        executorService.shutdownNow();
    }
}
</code></pre>
<h3 id="ç½å³èµæºè§£æ">ç½å³èµæºè§£æ</h3>
<p>å¶ä¸»è¦è´è´£ï¼</p>
<p>1ãä¼ å¥åæ°å¤ç</p>
<p>2ãè·å¾å¯æ§è¡ç¼å­ä»åº</p>
<p>3ãæ§è¡è¿ç¨æå¡</p>
<p>4ãå¤çè¿åç»æ</p>
<pre><code class="language-java">package com.itheima.shiro.web;

import com.alibaba.fastjson.JSONObject;
import com.itheima.shiro.base.BaseRequest;
import com.itheima.shiro.cache.CacheWareService;
import com.itheima.shiro.constant.GateWayConstant;
import com.itheima.shiro.pojo.CacheWare;
import com.itheima.shiro.response.MultiResponse;
import com.itheima.shiro.response.PageResponse;
import com.itheima.shiro.response.SingleResponse;
import com.itheima.shiro.utils.EmptyUtil;
import com.itheima.shiro.view.JsonResult;
import lombok.extern.log4j.Log4j2;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;

import java.lang.reflect.Method;

/**
 * @Descriptionï¼ç½å³ç»ä¸å¥å£
 */
@Controller
@Log4j2
public class GateWayController {

    @Autowired
    CacheWareService cacheWareService;

    /**
     * @Description è¯·æ±å¥å£
     * @param serviceName æå¡åç§°
     * @param methodName ç®æ æ¹æ³
     * @param baseRequest è¯·æ±å¯¹è±¡
     * @return
     */
    @RequestMapping(value = "{serviceName}/{methodName}",method = RequestMethod.POST)
    @ResponseBody
    public JsonResult postGateWay(@PathVariable("serviceName") String serviceName,
                                  @PathVariable("methodName") String methodName,
                                  @RequestBody BaseRequest baseRequest) throws Exception{
        JsonResult jsonResult = null;
        if (EmptyUtil.isNullOrEmpty(serviceName)||EmptyUtil.isNullOrEmpty(methodName)){
            jsonResult = jsonResult.builder()
                    .result(GateWayConstant.FAIL)
                    .msg("åæ°ç¼ºå¤±")
                    .code(GateWayConstant.PARAMETERS_MISSING)
                    .build();
                    return  jsonResult;
        }
        //ä¼ å¥åæ°å¤ç
        JSONObject jsonObject = null;
        Object datas = baseRequest.getDatas();
        if (!EmptyUtil.isNullOrEmpty(datas)){
            jsonObject = JSONObject.parseObject(jsonObject.toJSONString(datas));
        }
        //è·å¾ç¼å­ä»åºå¯æ§è¡å¯¹è±¡
        CacheWare cacheWare = cacheWareService.queryCacheWare(serviceName, methodName);
        //æ§è¡è¿ç¨æå¡
        Object proxy = cacheWare.getProxy();
        Method method = cacheWare.getMethod();
        Class&lt;?&gt; methodParamsClass = cacheWare.getMethodParamsClass();
        Object result = null;
        if (EmptyUtil.isNullOrEmpty(methodParamsClass)){
            result = method.invoke(proxy);
        }else {
            Object arg = JSONObject.toJavaObject(jsonObject, methodParamsClass);
            result = method.invoke(proxy,arg);
        }
        //å¤çæ¾åç»æ
        return  convResult(result);
    }

    /**
     * @Description å¤çè¯·æ±ç»æ
     */
    private JsonResult convResult(Object result) {
        JsonResult jsonResult = JsonResult.builder()
                .result(GateWayConstant.SUCCEED)
                .msg("ç¸åºæ­£å¸¸")
                .code(GateWayConstant.SUCCEED_CODE)
                .build();
        if (EmptyUtil.isNullOrEmpty(result)) {
            jsonResult = JsonResult.builder()
                    .result(GateWayConstant.FAIL)
                    .msg("è¿åç»æä¸ºç©º")
                    .code(GateWayConstant.RESULT_ISNULLOREMPTY)
                    .build();
            return jsonResult;
        }
        if (result instanceof SingleResponse) {
            BeanUtils.copyProperties(result, jsonResult);
            @SuppressWarnings("rawtypes")
            SingleResponse singleResponse = (SingleResponse) result;
            jsonResult.setDatas(singleResponse.getValue());
        } else if (result instanceof MultiResponse) {
            BeanUtils.copyProperties(result, jsonResult);
            @SuppressWarnings("rawtypes")
            MultiResponse multiResponse = (MultiResponse) result;
            jsonResult.setDatas(multiResponse.getValues());
        } else if (result instanceof PageResponse) {
            BeanUtils.copyProperties(result, jsonResult);
            PageResponse pageResponse = (PageResponse)result;
            jsonResult.setDatas( pageResponse.getValues());
        } else {
            jsonResult = JsonResult.builder()
                    .result(GateWayConstant.FAIL)
                    .msg("è¿åç»ææ ¼å¼ä¸æ­£ç¡®")
                    .code(GateWayConstant.RESULT_MISSING)
                    .build();
            return jsonResult;
        }
        return jsonResult;
    }
}
</code></pre>

</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/alineverstop/" target="_blank">NE_STOP</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/alineverstop/p/19482539" target="_blank">https://www.cnblogs.com/alineverstop/p/19482539</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-14 15:51">2026-01-14 15:51</span>&nbsp;
<a href="https://www.cnblogs.com/alineverstop">NE_STOP</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19482539);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19482539', targetLink: 'https://www.cnblogs.com/alineverstop/p/19482539', title: 'SpringBoot-shiro-jwt-dubbo-redisåå¸å¼ç»ä¸æéç³»ç»ï¼å®ç»ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ é«å¾·å°å¾å®ç°å®æ¶è½¨è¿¹å±ç¤º ]]></title>
    <link>https://www.cnblogs.com/lijinhuaboke/p/19457121</link>
    <guid>8488ade48bc039f063c2243a2424896b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lijinhuaboke/p/19457121" title="åå¸äº 2026-01-14 14:35">
    <span role="heading" aria-level="2">é«å¾·å°å¾å®ç°å®æ¶è½¨è¿¹å±ç¤º</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="vue3--é«å¾·å°å¾amap-å®ç°å¹³æ»çå®æ¶è½¨è¿¹åæ¾ä¸è¿½è¸ª">Vue3 + é«å¾·å°å¾(AMap) å®ç°å¹³æ»çå®æ¶è½¨è¿¹åæ¾ä¸è¿½è¸ª</h1>
<h2 id="åè¨">åè¨</h2>
<p>å¨ç©èç½ãç©æµçæ§æå®é²è°åº¦ç³»ç»ä¸­ï¼å®æ¶å±ç¤ºè®¾å¤ï¼å¦æ äººæºãè½¦è¾ãæç¯ï¼çç§»å¨è½¨è¿¹æ¯ä¸ä¸ªå¸¸è§éæ±ãå¦æä»ä»æ¯ç®åçæ´æ°æ è®°ç¹ä½ç½®ï¼è§è§ä¸ä¼åºç°âè·³åâç°è±¡ï¼ä½éªå¾ä¸æµçã</p>
<p>æ¬æå°åäº«å¦ä½å¨ <strong>Vue 3</strong> é¡¹ç®ä¸­ï¼å©ç¨ <strong>é«å¾·å°å¾ (AMap) JS API</strong> å®ç°æ¯è¾ä¸æ»çå®æ¶è½¨ææã</p>
<h2 id="æ ¸å¿çç¹">æ ¸å¿çç¹</h2>
<ol>
<li><strong>å¹³æ»ç§»å¨</strong>ï¼ç¹ä½æ´æ°æ¶ï¼Marker éè¦ä»æ§ä½ç½®å¹³æ»è¿æ¸¡å°æ°ä½ç½®ï¼èä¸æ¯ç¬é´è·³è¿å»ã</li>
<li><strong>è½¨è¿¹è·é</strong>ï¼éç Marker çç§»å¨ï¼è½¨è¿¹çº¿ï¼Polylineï¼éè¦å®æ¶âçé¿âï¼ç´§è·å¨ Marker åé¢ã</li>
<li><strong>å¢éæ´æ°</strong>ï¼åç«¯éå¸¸è¿åå®æ´çåå²è·¯å¾æå½åç¶æï¼åç«¯éè¦è®¡ç®åºâæ°å¢çè·¯å¾æ®µâè¿è¡å¨ç»æ­æ¾ã</li>
</ol>
<h2 id="å®ç°é»è¾è§£æ">å®ç°é»è¾è§£æ</h2>
<p>æ ¸å¿æ¯å©ç¨é«å¾·å°å¾ API çè½¨è¿¹åæ¾åè½ãè½ç¶å®æ¹ææ¡£æä¾äºåºç¡çè½¨è¿¹åæ¾ç¤ºä¾ï¼åèï¼<a href="https://lbs.amap.com/demo/javascript-api-v2/example/marker/replaying-historical-running-data" target="_blank" rel="noopener nofollow">è½¨è¿¹åæ¾ç¤ºä¾</a>ï¼ï¼ä½å®æ¹ç¤ºä¾éå¸¸æ¯ä¸æ¬¡æ§å è½½å®æ´è·¯å¾ï¼ä¾å¦ï¼åè·åå®æ´ç»çº¬åº¦æ°ç»ï¼æ¸²æåºæµèè²èæ¯çº¿ï¼åè®©å°è½¦æ²¿çè·¯å¾è·å¹¶ç»åºæµç»¿è²è½¨è¿¹ï¼ã</p>
<p><strong>æä»¬çä¸å¡åºæ¯ä¸å®æ¹ç¤ºä¾çä¸»è¦åºå«å¨äºï¼</strong><br>
æä»¬çè·¯å¾æ°æ®æ¯<strong>å®æ¶å¢éæ´æ°</strong>çãåç«¯å¹¶æ²¡æä¸å¼å§å°±æ¿å°å®æ´çè·¯å¾ï¼èæ¯éè¿ WebSocket æè½®è¯¢å®æ¶è·ååç«¯è¿åçææ°è·¯å¾æ°æ®ãå æ­¤ï¼æä»¬éè¦èªè¡è®¾è®¡é»è¾ï¼è®¡ç®åºæ¯æ¬¡æ´æ°çâå¢éçæ®µâï¼å¹¶è®© Marker å¹³æ»å°èµ°å®è¿ä¸æ®µã</p>
<h3 id="æ ¸å¿æè·¯">æ ¸å¿æè·¯ï¼</h3>
<ol>
<li>
<p><strong>ååç«¯æ°æ®çº¦å®</strong>ï¼</p>
<ul>
<li>çæ³æåµä¸ï¼åç«¯æå¥½ç´æ¥è¿åâå¢éè·¯å¾âï¼å³ä¸ä¸æ¬¡ä½ç½®å°å½åä½ç½®çåæ éåï¼ã</li>
<li>ä½å¨å®éé¡¹ç®ä¸­ï¼æ¯å¦æ¬æ¡ä¾ï¼ï¼åç«¯æ¥å£è¿åçæ¯<strong>å½åæ¶å»çå®æ´ç´¯ç§¯è·¯å¾</strong>ãå æ­¤ï¼åç«¯éè¦èªè¡æ¯å¯¹ç¼å­çâä¸ä¸æ¬¡è·¯å¾âåâææ°è·¯å¾âï¼è®¡ç®åºå¢éé¨åã</li>
</ul>
</li>
<li>
<p><strong>ç¶æç®¡ç (ç¼å­å®ä¾)</strong>ï¼</p>
<ul>
<li>ä½¿ç¨ <code>Map</code> æ°æ®ç»ææ¥ç¼å­æ¯ä¸ªè®¾å¤ï¼å¦æ äººæºãæç¯ï¼ç <code>Marker</code>ï¼å¾æ ï¼å <code>Polyline</code>ï¼è½¨è¿¹çº¿ï¼å®ä¾ã</li>
<li>ç¡®ä¿æ¯ä¸ªè®¾å¤ ID å¯¹åºå¯ä¸çå°å¾å®ä¾ï¼é¿åæ°æ®å·æ°æ¶éå¤åå»ºå¯¼è´åå­æ³æ¼æéªçã</li>
</ul>
</li>
<li>
<p><strong>è®¡ç®å¢éè·¯å¾</strong>ï¼</p>
<ul>
<li>å½æ°æ°æ®å°è¾¾æ¶ï¼éè¿å¯¹æ¯æ°æ§è·¯å¾é¿åº¦ï¼æªååº<strong>æ°å¢çè·¯å¾æ®µ</strong>ã</li>
<li>è¿æ®µæ°å¢è·¯å¾å°±æ¯ Marker æ¥ä¸æ¥éè¦âå¹³æ»ç§»å¨âçè½¨è¿¹ã</li>
</ul>
</li>
<li>
<p><strong>å¹³æ»å¨ç» (<code>moveAlong</code>)</strong>ï¼</p>
<ul>
<li>è°ç¨é«å¾·å°å¾ç <code>marker.moveAlong()</code> æ¹æ³ï¼è®© Marker æ²¿çæ°å¢è·¯å¾å¹³æ»ç§»å¨ï¼èä¸æ¯ç¬é´è·³åã</li>
</ul>
</li>
<li>
<p><strong>å®æ¶ç»å¶è½¨è¿¹ (<code>moving</code> äºä»¶)</strong>ï¼</p>
<ul>
<li>çå¬ Marker ç <code>moving</code> äºä»¶ãå¨ç§»å¨è¿ç¨ä¸­ï¼å®æ¶æ´æ°è½¨è¿¹çº¿ï¼Polylineï¼çè·¯å¾ï¼ä»èå®ç°âè¾¹èµ°è¾¹ç»âçææã</li>
<li><strong>å³é®ç¹</strong>ï¼ä¸ºä»ä¹è¦å¨ <code>moving</code> äºä»¶ä¸­æ´æ°æ»è½¨è¿¹ï¼èä¸æ¯å¨å¨ç»ç»æ (<code>moveend</code>) åæ´æ°ï¼
<ul>
<li>è¿æ¯ä¸ºäºé²æ­¢æ°æ®æ¨éé¢çè¿å¿«ãå¦æç­å°å¨ç»ç»æåæ´æ°ï¼å¯è½ä¼åºç°âæ°çæ°æ®æ¨éæ¥äºï¼ä½ä¸ä¸æ¬¡å¨ç»è¿æ²¡ç»æï¼å¯¼è´è½¨è¿¹æ°æ®ä¸¢å¤±æè¡æ¥ä¸ä¸âçé®é¢ãå¨ <code>moving</code> è¿ç¨ä¸­å®æ¶å° <code>passedPath</code>ï¼å·²èµ°è¿çè·¯å¾ï¼æ¼æ¥å°æ»è½¨è¿¹ä¸­ï¼æ¯æç¨³å¦¥çæ¹å¼ã</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>å¨ç»ç»ææ¸ç</strong>ï¼</p>
<ul>
<li>å¨ç»ç»ææ¶ (<code>moveend</code>)ï¼æ¸çä¸´æ¶ç»å¶çè¾å©çº¿ï¼ç§»é¤çå¬å¨ï¼é²æ­¢åå­æ³æ¼ã</li>
</ul>
</li>
</ol>
<hr>
<h3 id="ä»£ç è¯¦è§£">ä»£ç è¯¦è§£</h3>
<h4 id="1-ç¶æç®¡çä¸åå§å">1. ç¶æç®¡çä¸åå§å</h4>
<p>æä»¬ä½¿ç¨ <code>Map</code> æ¥ç®¡çå°å¾ä¸ç Marker å Polyline å®ä¾ã</p>
<pre><code class="language-javascript">// å­å¨ Marker å®ä¾ (Key: è®¾å¤ID, Value: AMap.Marker)
const uavMarkers = ref(new Map());
// å­å¨è½¨è¿¹çº¿ Polyline å®ä¾ (Key: è®¾å¤ID, Value: AMap.Polyline)
const uavPaths = ref(new Map());
</code></pre>
<h4 id="2-æ ¸å¿å¤çå½æ°-refreshtemppoint">2. æ ¸å¿å¤çå½æ° <code>refreshTempPoint</code></h4>
<p>è¿ä¸ªå½æ°è´è´£å¤çåæ¡è®¾å¤æ°æ®çæ´æ°é»è¾ã</p>
<pre><code class="language-javascript">// å·æ°è®¾å¤ç¹ä½ä¸è½¨è¿¹
// item: åç«¯è¿åçè®¾å¤æ°æ®å¯¹è±¡
// position: å½åææ°çåæ ç¹
// type: æ´æ°ç±»åï¼'init' ä¸ºåå§åï¼å¶ä»ä¸ºå¢éæ´æ°ï¼
const refreshTempPoint = async (item, position, type, marker, tempOverlay, pathOverlay) =&gt; {
  // 1. æ¸çä¸ä¸è½®çä¸´æ¶è¦çç©ï¼å¦ä¸´æ¶è·¯çº¿ãè·ç¦»ææ¬ï¼
  tempOverlay?.clearOverlays();

  if (item.coordinatesLine) {
    const coordinatesLine = JSON.parse(item.coordinatesLine); // è§£æåç«¯è¿åçå®æ´è·¯å¾æ°ç»

    // --- A. åå§åèµ·ç¹ Marker ---
    let tempMarker = tempUavMarkers.value.get(item.id);
    if (!tempMarker) {
      // å¦ææ¯ç¬¬ä¸æ¬¡åºç°ï¼æ¸²æèµ·ç¹
      tempMarker = renderPoint(coordinatesLine[0], item, "", pathOverlay);
      tempUavMarkers.value.set(item.id, tempMarker);
    }

    // --- B. è·åæåå»ºåå²è½¨è¿¹çº¿ (Polyline) ---
    let polyline = uavPaths.value.get(item.id);
    if (!polyline) {
      polyline = trajectoryLine(item, pathOverlay); // åå»ºæ°ççº¿å®ä¾
      uavPaths.value.set(item.id, polyline);
    }

    // è·åå½åå°å¾ä¸å·²æçè·¯å¾ï¼ç¼å­çæ§è·¯å¾ï¼
    const existingPath = polyline.getPath() || [];

    if (type != "init") {
      // --- C. å¢éæ´æ°é»è¾ ---
      
      // 1. è®¡ç®å¢éè·¯å¾ï¼ä»å·²æè·¯å¾çæåä¸ä¸ªç¹å¼å§æªåï¼ç´å°ææ°è·¯å¾çæ«å°¾
      const newPathSegment = coordinatesLine.slice(
        existingPath.length ? existingPath.length - 1 : 0
      );

      // 2. åå»ºä¸æ¡ä¸´æ¶çâéå½¢âçº¿æ®µï¼ç¨äºè¾å©è®¡ç®æå±ç¤ºï¼è§éæ±èå®ï¼
      const newPolyline = trajectoryLine(item, tempOverlay);

      // 3. å¦æææ°å¢è·¯å¾ï¼å¼å§å¨ç»
      if (newPathSegment &amp;&amp; newPathSegment.length &gt; 0) {
        
        // çå¬ç§»å¨è¿ç¨
        marker.on("moving", function (e) {
          // e.passedPath æ¯ Marker å¨å½åå¨ç»çæ®µä¸­å·²ç»èµ°è¿çè·¯å¾
          newPolyline.setPath(e.passedPath);
          
          // [å³é®] å®æ¶å°èµ°è¿çè·¯å¾æ¼æ¥å°åå²æ»è½¨è¿¹ä¸­
          // è¿æ ·å³ä½¿ WebSocket æ¨éé¢çå¾å¿«ï¼ä¹è½ä¿è¯è½¨è¿¹æ°æ®çè¿ç»­æ§
          polyline.setPath([...existingPath, ...e.passedPath]);
        });

        // å¼å§å¹³æ»ç§»å¨
        marker.moveAlong(newPathSegment, {
          duration: 1000,    // å¨ç»æ¶é¿ï¼éæ ¹æ® WebSocket æ¨éé¢çè°æ´
          autoRotation: true, // è½¦å¤´èªå¨å¯¹åè·¯å¾æ¹å
        });

        // çå¬ç§»å¨ç»æ
        marker.on("moveend", function () {
          // å¨ç»ç»æï¼æ¸çä¸´æ¶è¦çç©
          tempOverlay?.clearOverlays();
          
          // æ´æ°è·ç¦»ææ¬ç­ä¿¡æ¯
          if (item.distance) {
            renderText(
              coordinatesLine[Math.ceil(coordinatesLine.length - 2)],
              `${item.distance}ç±³`,
              tempOverlay
            );
          }
          
          // ç§»é¤çå¬å¨ï¼é²æ­¢éå¤ç»å®
          marker.off("moveend");
        });
      } else {
        // å¦ææ²¡ææ°å¢è·¯å¾ï¼ä½ç½®æ²¡åï¼ï¼ä»æ´æ°æå­ä¿¡æ¯
        if (item.distance) {
          renderText(..., `${item.distance}ç±³`, tempOverlay);
        }
      }

    } else {
      // --- D. åå§åé»è¾ ---
      // å¦ææ¯åå§åå è½½ï¼ç´æ¥è®¾ç½®å®æ´è·¯å¾ï¼ä¸è¿è¡å¨ç»åæ¾
      if (item.distance) {
         renderText(..., `${item.distance}ç±³`, tempOverlay);
      }
      polyline.setPath(coordinatesLine);
    }
  } else {
    // --- E. æ è½¨è¿¹æ°æ®æ¶çéçº§å¤ç ---
    // å¦æåç«¯æ²¡æè¿åè·¯å¾æ°æ®ï¼ç´æ¥è·³åå°ææ°ä½ç½®
    marker.setPosition(position);
    
    // æ¸çç¸å³çè½¨è¿¹å®ä¾åç¼å­
    let tempMarker = tempUavMarkers.value.get(item.id);
    if (tempMarker) {
      tempMarker.setMap(null);
      pathOverlay &amp;&amp; pathOverlay.removeOverlay(tempMarker);
      tempUavMarkers.value.delete(item.id);
    }
    
    let polyline = uavPaths.value.get(item.id);
    if (polyline) {
      polyline.setMap(null);
      pathOverlay &amp;&amp; pathOverlay.removeOverlay(polyline);
      uavPaths.value.delete(item.id);
    }
  }
};
</code></pre>
<p>}<br>
};</p>
<pre><code class="language-javascript">
// æ äººæºåæç¯è½¨è¿¹ææ¶
const refreshAirMap = async (type, data) =&gt; {
  const res = await getUavElement();
  // console.log("æ äººæºæ°æ®", res.result);
  res.result.map(async (item) =&gt; {
    // data.map(async (item) =&gt; {
    if (item.type == "1") {
      let position = JSON.parse(item.coordinates);
      // è·åæåå»ºæ äººæºæ è®°
      let marker = uavMarkers.value.get(item.id);
      if (!marker) {
        // åå»ºæ äººæºãæç¯ç¹ä½ã
        marker = renderPoint(position, item, "", overlayGroups.value);
        uavMarkers.value.set(item.id, marker);
      }else{
        
        if (item.elementType == "2") {
          // å·²æç¹ä½ä¸æ¯æç¯ç¹ä½å°±æ´æ°çµé
          marker.setLabel({
            content: `&lt;div class="marker-label-container"&gt;
              &lt;div class="info-name"&gt;${item.name}&lt;/div&gt;
              &lt;div class="icon-placeholder"&gt;&lt;/div&gt;
              ${batteryHtml(item)}
            &lt;/div&gt;`,
            offset: new AMaps.value.Pixel(0, 0),
            direction: "center",
          });
        }
      }

      if (item.elementType == "1") {
        // æ äººæºè½¨è¿¹
        refreshTempPoint(
          item,
          position,
          type,
          marker,
          pathOverlayGroups.value,
          pathsStartPointOverlayGroups.value
        );
      } else if (item.elementType == "2") {
        // æç¯è½¨è¿¹
        refreshTempPoint(
          item,
          position,
          type,
          marker,
          rescuePathsOverlayGroups.value,
          rescueOverlayGroups.value
        );
      }
      // è½¨è¿¹é¨åï¼å¤æ­æ¯å¦æè½¨è¿¹
    }
  });
  // });
};
</code></pre>
<p>è¯´æä¸ä¸å¦ï¼æçé¡¹ç®ä¸­è¿éè¦å®ç°å¶ä»åè½åæ¯æç¯çµéå±ç¤ºï¼ç¹å»æé®å¯éèæ äººæºè½¨è¿¹ï¼ç¹å»æé®å¯éèæç¯è½¨è¿¹ï¼æ äººæºåæç¯è½¨è¿¹èµ·å§ç¹ä¹éè¦å±ç¤ºä¸ä¸ªç¹ä½å¾æ ï¼è½¨è¿¹çº¿ä¸æ¾ç¤ºè·ç¦»ï¼è¿èèäºç¬¬ä¸æ¬¡è¿å¥é¡¹ç®ï¼å¦æ è½¨è¿¹å°±åªæ´æ°ç¹ä½åæ ç­ç­è¿äºï¼æ å³çè½¨è¿¹å±ç¤ºé»è¾çåä½è§ä¼èç·ç¥è¿å°±å¥½ï¼è¿ç¯æç« ä¸»è¦æ¯åäº«ä¸ä¸å®æ¶è½¨è¿¹å®ç°çé»è¾ï¼æè½¨è¿¹ç¸å³é»è¾æ½åºæ¥éæ°åä¸ä»½ä»£ç ï¼æå«éº»ç¦å»å»ã</p>
<h2 id="æ»ç»">æ»ç»</h2>
<p>éè¿ç»å å¢éè·¯å¾è®¡ç®<code>moveAlong</code> è½¨è¿¹åæ¾ ä»¥å <code>moving</code> äºä»¶çå¬ï¼æä»¬å®ç°äºä¸ä¸ªé«æ§è½ä¸è§è§æµççå®æ¶è½¨è¿¹è¿½è¸ªåè½ãè¿ç§æ¹æ¡ç¹å«éåæ äººæºå·¡èªãè½¦è¾å®æ¶å®ä½ç­éè¦é«é¢æ´æ°ä½ç½®çåºæ¯ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.003472222222222222" data-date-updated="2026-01-14 14:40">2026-01-14 14:35</span>&nbsp;
<a href="https://www.cnblogs.com/lijinhuaboke">æ­¤é¢å·®ç£ã</a>&nbsp;
éè¯»(<span id="post_view_count">147</span>)&nbsp;
è¯è®º(<span id="post_comment_count">3</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19457121);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19457121', targetLink: 'https://www.cnblogs.com/lijinhuaboke/p/19457121', title: 'é«å¾·å°å¾å®ç°å®æ¶è½¨è¿¹å±ç¤º' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ PHP 8.5 åçº§çå­æåï¼é¿ååæ¨ä¸¤ç¹åæ»çæ£æ¥æ¸å ]]></title>
    <link>https://www.cnblogs.com/catchadmin/p/19479967</link>
    <guid>d088b37c914c481da8416f6e7c9f37ca</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/catchadmin/p/19479967" title="åå¸äº 2026-01-14 07:43">
    <span role="heading" aria-level="2">PHP 8.5 åçº§çå­æåï¼é¿ååæ¨ä¸¤ç¹åæ»çæ£æ¥æ¸å</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="php-85-åçº§çå­æåé¿ååæ¨ä¸¤ç¹åæ»çæ£æ¥æ¸å">PHP 8.5 åçº§çå­æåï¼é¿ååæ¨ä¸¤ç¹åæ»çæ£æ¥æ¸å</h1>
<h2 id="åçº§-php-ä¸é¾è¢«åæé¾">åçº§ PHP ä¸é¾ï¼è¢«åæé¾</h2>
<p>ä¸æåæ¯åé£ç§"ä½ æ°¸è¿ä¸æ³èµ¶å·¥"çå·¥ä½çå¥½æ¶æºï¼è¿è¡æ¶åçº§ã</p>
<p>å¤§å¤æ° PHP 8.x å°çæ¬åçº§å¾é¡ºå©ï¼ä½"é¡ºå©"ä¸ç­äº"é¶é£é©"ãçæ­£çé®é¢éå¸¸æ¥èªï¼</p>
<ul>
<li>éèçå¹³å°çº¦æï¼æ©å±ãç³»ç»åºãSAPIï¼ï¼</li>
<li>è½ç¼è¯ä½è¡ä¸ºä¸åçä¾èµï¼</li>
<li>è¢«å¿½ç¥å¤å¹´çè­¦å/å¼ç¨çªç¶æ·¹æ²¡æ¥å¿ï¼</li>
<li>åè®¾åæ»"å¾ç®å"çä¸çº¿è®¡åï¼å®éä¸å¾å°ç®åï¼ã</li>
</ul>
<p>è¿ç¯æç« ä¾§éå®æãæä¸ä¼éæ°è®² PHP 8.5 çæ°ç¹æ§ï¼æ¯å¦ç®¡éæä½ç¬¦æ URI å¤çãæ°ç¹æ§åªä¼ä½ä¸ºå¼å®¹æ§æ£æ¥ç¹ç®åæåãç®æ æ¯åæå¹´äººä¸æ ·åå¸ PHP 8.5ï¼æè®¡åãæé²æ¤ãæçæ§ãæçæ­£è½ç¨çåæ»è·¯å¾ã</p>
<p>PHP 8.5 çç¨³å®çäº 2025 å¹´ 11 æ 20 æ¥åå¸ï¼éµå¾ªæ­£å¸¸ç PHP æ¯æå¨æã</p>
<p><a href="https://catchadmin.com/post/2026-01/php85-upgrade-survival-guide-checklist" target="_blank" rel="noopener nofollow">åæ PHP 8.5 åçº§çå­æåï¼é¿ååæ¨ä¸¤ç¹åæ»çæ£æ¥æ¸å</a></p>
<h2 id="ç¡®å®ç®æ çæ¬å®ä¹åé¨æ¯æç­ç¥">ç¡®å®ç®æ çæ¬ï¼å®ä¹åé¨æ¯æç­ç¥</h2>
<p>å¨å¨ CI æ Composer ä¹åï¼ååç­ä¸ä¸ªé®é¢ï¼</p>
<p><strong>å¨ä½ çç»ç»éï¼è¿æ¬¡åçº§"å®æ"æå³çä»ä¹ï¼</strong></p>
<h3 id="ç¡®å®ç®æ åæªæ­¢æ¥æ">ç¡®å®ç®æ åæªæ­¢æ¥æ</h3>
<p>PHP åæ¯æä¸¤å¹´çæ´»è·æ¯æï¼ç¶åæ¯ä¸¤å¹´çå®å¨ä¿®å¤ã</p>
<p>å®æ¹æ¯æè¡¨ï¼</p>
<ul>
<li>PHP 8.5ï¼2025 å¹´ 11 æ 20 æ¥åå§åå¸</li>
<li>æ´»è·æ¯æè³ 2027 å¹´ 12 æ 31 æ¥</li>
<li>å®å¨æ¯æè³ 2029 å¹´ 12 æ 31 æ¥</li>
</ul>
<p>æ¯æçªå£å¾å®½è£ââä½ä½ çåé¨æªæ­¢æ¥æéå¸¸ç±ä»¥ä¸å ç´ é©±å¨ï¼</p>
<ul>
<li>åè§è¦æ±ï¼</li>
<li>æç®¡éå / åºç¡å®¹å¨ï¼</li>
<li>æ¡æ¶æ¯æçªå£ï¼</li>
<li>åçå¨"ä»å®å¨ä¿®å¤"é¶æ®µçææ¬ã</li>
</ul>
<h3 id="å®ä¹èå´åçº§å¸¸å¸¸å¨è¿éæ å£°å¤±è´¥">å®ä¹èå´ï¼åçº§å¸¸å¸¸å¨è¿éæ å£°å¤±è´¥ï¼</h3>
<p>åä¸ä»ä¹åå«ãä»ä¹ä¸åå«ï¼</p>
<p><strong>åå«ï¼</strong></p>
<ul>
<li>è¿è¡æ¶çæ¬åçº§ï¼FPM/CLIï¼ï¼</li>
<li>Composer ä¾èµè°æ´ï¼</li>
<li>CI ç©éµæ´æ°ï¼</li>
<li>çäº§ç¯å¢ä¸çº¿ç­ç¥ï¼</li>
<li>åçº§åéªè¯ã</li>
</ul>
<p><strong>ä¸åå«ï¼é¤éä½ æç¡®å è¿å»ï¼ï¼</strong></p>
<ul>
<li>éæä»£ç ä»¥ä½¿ç¨ PHP 8.5 æ°ç¹æ§ï¼</li>
<li>ä¸ PHP 8.5 æ å³çä¸»è¦æ¡æ¶åçº§ï¼</li>
<li>"é¡ºææ¹"çéåã</li>
</ul>
<p>å¦æä¸å®ä¹èå´ï¼"åçº§"ä¼åæ"éå"ï¼ç¶åå°±ä¼åæ»ã</p>
<h3 id="æåå³å®å¼å®¹æ§ç­ç¥">æåå³å®å¼å®¹æ§ç­ç¥</h3>
<p>å¦æä»£ç åºéè¦å¨æ§ç PHP å 8.5 ä¸åæ¶è¿è¡ä¸æ®µæ¶é´ï¼</p>
<ul>
<li>ç¨ CI å¼ºå¶åçæ¬å¼å®¹ï¼</li>
<li>å¨çäº§ç¯å¢åå° 8.5 ä¹åï¼ä¸è¦åå¹¶ 8.5 ä¸å±è¯­æ³ï¼æ¯å¦ <code>|&gt;</code>ï¼ã</li>
</ul>
<p>å¦æåç¡¬åæ¢ï¼</p>
<ul>
<li>ç¡®ä¿ä¸çº¿/åæ»æ¹æ¡ä¸æ ä¸å¤±ï¼</li>
<li>æ¥ååè½åæ¯å¯è½æ´æ©å¼å§ä½¿ç¨ 8.5 ä¸å±è¯­æ³ã</li>
</ul>
<h2 id="åå§å®¡è®¡å½å-phpæ©å±åä¾èµçº¦æ">åå§å®¡è®¡ï¼å½å PHPãæ©å±åä¾èµçº¦æ</h2>
<p>å¤§å¤æ°"PHP åçº§"bug ä¸æ¯è¯­è¨ bugï¼èæ¯ç¯å¢ä¸å¹éã</p>
<h3 id="å¿«ç§å®éè¿è¡çè¿è¡æ¶">å¿«ç§å®éè¿è¡çè¿è¡æ¶</h3>
<p>å¨çäº§ç¯å¢è¿è¡è¿äºå½ä»¤ï¼ä¸æ¯ä½ çç¬è®°æ¬ï¼</p>
<pre><code class="language-bash">php -v
php -m
php --ini
php -i | head -n 50
</code></pre>
<p>å¦æç¨ PHP-FPMï¼è¿è¦æè·ï¼</p>
<ul>
<li>FPM pool éç½®ï¼</li>
<li>ini è¦çï¼</li>
<li>ä¼ ç» FPM çç¯å¢åéï¼</li>
<li>opcache/JIT è®¾ç½®ï¼è¿äºå¨ä¸åç¯å¢å¯è½ä¸åï¼ã</li>
</ul>
<h3 id="åå»ºå¯å¤ç¨çå¹³å°å¿«ç§èæ¬">åå»ºå¯å¤ç¨ç"å¹³å°å¿«ç§"èæ¬</h3>
<p>æè¿æ ·ä¸ä¸ªèæ¬æ¾å° <code>tools/php-platform-snapshot.php</code>ï¼å¨æ¯ä¸ªç¯å¢ï¼å¼å/é¢å/çäº§ï¼è¿è¡ãæäº¤èæ¬æ¬èº«ï¼ä¸è¦è®©å®æä¸ºå£å£ç¸ä¼ çç¥è¯ã</p>
<pre><code class="language-php">&lt;?php
declare(strict_types=1);
function ext_version(string $ext): ?string {
    $v = phpversion($ext);
    return $v === false ? null : $v;
}
$snapshot = [
    'php_version' =&gt; PHP_VERSION,
    'php_version_id' =&gt; PHP_VERSION_ID,
    'sapi' =&gt; PHP_SAPI,
    'os' =&gt; PHP_OS_FAMILY . ' ' . php_uname('r'),
    'ini_loaded' =&gt; php_ini_loaded_file(),
    'ini_scanned' =&gt; php_ini_scanned_files(),
    'extensions' =&gt; [],
];
$exts = get_loaded_extensions();
sort($exts);
foreach ($exts as $ext) {
    $snapshot['extensions'][$ext] = ext_version($ext);
}
echo json_encode($snapshot, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES) . PHP_EOL;
</code></pre>
<p>è¿è½ç»ä½ ä¸¤ä¸ªæç¨çä¸è¥¿ï¼</p>
<ul>
<li>æµè¯ 8.5 æ¶å¯ä»¥ diff ç"ä»ä¹åäº"è®°å½ï¼</li>
<li>å¿«éåç°"é¢åè½è·çäº§ä¸è½è·"é®é¢çæ¹æ³ââå¾å¾æ¯çäº§å¤äºä¸ä¸ªæ©å±æ ini ä¸åã</li>
</ul>
<h3 id="çç¹-composer-å¹³å°è¦æ±">çç¹ Composer å¹³å°è¦æ±</h3>
<p>Composer æä½ ç PHP è¿è¡æ¶åæ©å±å½ä½"å¹³å°å"ï¼ä¾èµå¯ä»¥ require å®ä»¬ã</p>
<p>æç¨çå½ä»¤ï¼</p>
<pre><code class="language-bash">composer show --platform
composer check-platform-reqs
</code></pre>
<ul>
<li><code>composer show --platform</code> ååº Composer çå°çå¹³å°åã</li>
<li><code>composer check-platform-reqs</code> éªè¯ä½ ççå®æå¡å¨æ¯å¦æ»¡è¶³å·²å®è£åç PHP/ext è¦æ±ï¼å®ä¼ææå¿½ç¥ <code>config.platform</code>ï¼ã</li>
</ul>
<p>è¿æ¯å¨é¨ç½²ååç°"çäº§ç¼º ext-intl"æå¿«çæ¹æ³ã</p>
<h2 id="æå»º-ci-ç©éµå¨æ§ç-php-å-85-ä¸è¿è¡æµè¯æè­¦åå½ä¿¡å·">æå»º CI ç©éµï¼å¨æ§ç PHP å 8.5 ä¸è¿è¡æµè¯ï¼æè­¦åå½ä¿¡å·ï¼</h2>
<p>CI æ¯è®©åçº§åå¾å¯é¢æµçå°æ¹ã</p>
<h3 id="è§åå¨çäº§ç¨³å®è¿è¡-85-ä¹åä¿çæ§è¿è¡æ¶å¨-ci-ä¸­">è§åï¼å¨çäº§ç¨³å®è¿è¡ 8.5 ä¹åï¼ä¿çæ§è¿è¡æ¶å¨ CI ä¸­</h3>
<p>å³ä½¿ä½ è®¡åç¡¬åæ¢ï¼ç­æçéå æä¹è½å¸®ä½ é¿å"æä»¬å¨çäº§åå¤å¥½ä¹ååå¹¶äº 8.5 ä¸å±ä»£ç "ã</p>
<h3 id="github-actions-ç©éµç¤ºä¾æ§ç-php--php-85">GitHub Actions ç©éµç¤ºä¾ï¼æ§ç PHP + PHP 8.5ï¼</h3>
<p>å¦æç¨ GitHub Actionsï¼shivammathur/setup-php æ¯æç´æ¥æå® <code>'8.5'</code>ã</p>
<pre><code class="language-yaml">name: CI
on:
  push:
  pull_request:
jobs:
  tests:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        php: ['8.3', '8.5'] # è°æ´ä¸ºä½ çå½åçæ¬ + ç®æ çæ¬
    steps:
      - uses: actions/checkout@v4
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php }}
          tools: composer:v2
          coverage: none
      - name: Install dependencies
        run: composer install --no-interaction --prefer-dist
      - name: Run tests
        run: vendor/bin/phpunit
</code></pre>
<h3 id="åºåéè¯¯è­¦ååå¼ç¨">åºå"éè¯¯"ã"è­¦å"å"å¼ç¨"</h3>
<p>ä¸è¦ç«å»æææä¸è¥¿é½å½å¤±è´¥ãååç±»ï¼</p>
<ul>
<li><strong>è§£æéè¯¯ / è´å½éè¯¯</strong>ï¼é»æ­¢åçº§ã</li>
<li><strong>è¡ä¸ºåæ´</strong>ï¼éå¸¸éè¦æµè¯ + ä»£ç ä¿®å¤ã</li>
<li><strong>å¼ç¨</strong>ï¼ä¸ä¸å®é»æ­¢åçº§ï¼ä½å®ä»¬é¢ç¤ºæªæ¥ä¼åââèä¸å¯è½å¾å¿«æ·¹æ²¡æ¥å¿ã</li>
</ul>
<p>PHPUnit æ¬èº«å°±åºå outcomesï¼failed/erroredï¼å issuesï¼warningsãrisky tests ç­ï¼ã</p>
<p>ä¸ä¸ªå®ç¨çåçº§ç­ç¥ï¼</p>
<ul>
<li>å³ä½¿å­å¨å¼ç¨ï¼ä¹è®©æµè¯å¨ 8.5 ä¸éè¿ï¼</li>
<li>ä½å ä¸ä¸ªåç¬ç CI job æ¥ç»è®¡å¼ç¨æ°éå¹¶å¼ºå¶æ§è¡é¢ç®ï¼æ¯å¦"å¼ç¨ä¸è½è¶è¿ N æ¡"ï¼ã</li>
</ul>
<p>è¿éå¸¸æ¯ä¸å¤ä¹é´æå¼"ä»»ä½å¼ç¨é½å¤±è´¥"æ´ç°å®ã</p>
<h2 id="å¼ç¨åè¡ä¸ºåæ´åå¤çæéä¸æ ·åç±»èéå½éæ">å¼ç¨åè¡ä¸ºåæ´ï¼åå¤çæéä¸æ ·åç±»ï¼èéå½éæ</h2>
<p>PHP 8.5 æ°å¢äºä¸æ¹å¼ç¨ç¹æ§åå ä¸ªå¯è½è®©äººæå¤çä¸å¼å®¹åæ´ãå®æ¹è¿ç§»æåå¯¹æ­¤æè¯¦ç»è¯´æã</p>
<h3 id="ä¸ä¸ªææçåç±»å·¥ä½æµ">ä¸ä¸ªææçåç±»å·¥ä½æµ</h3>
<ol>
<li>
<p><strong>æ´é²</strong>ï¼å¨ CI åé¢åç¯å¢å¯ç¨ E_ALLã</p>
</li>
<li>
<p><strong>åç»</strong>ï¼ææ¶æ¯ç­¾åèç±»ï¼ç¸åæä»¶/è¡/æ¶æ¯ï¼ã</p>
</li>
<li>
<p><strong>æåº</strong>ï¼æé£é©ä¼åï¼</p>
<ul>
<li>å®å¨ç¸å³ï¼</li>
<li>è¿è¡æ¶æ­£ç¡®æ§ï¼</li>
<li>æ¥å¿é / è¿ç»´åªé³ï¼</li>
<li>æªæ¥ç ´åå¯è½æ§ã</li>
</ul>
</li>
<li>
<p><strong>ä¿®å¤</strong>ï¼æå°çå®å¨åæ´ã</p>
</li>
<li>
<p><strong>é²æ­¢åå½</strong>ï¼æ·»å éå¯¹æ§æµè¯æéæè§åã</p>
</li>
</ol>
<h3 id="å°å¤é½ä¼ååºæ¥çå¸¸è§å¼ç¨">å°å¤é½ä¼ååºæ¥çå¸¸è§å¼ç¨</h3>
<p>è¿äºæ¯è®©å¢éè¯´"ç­ç­ï¼è¿ä»¥åå±ç¶åè®¸ï¼"çé®é¢ï¼</p>
<p><strong>éè§èçç±»åè½¬æ¢åç§°å·²å¼ç¨</strong>ï¼<code>(boolean)</code>ã<code>(integer)</code>ã<code>(double)</code>ã<code>(binary)</code> â ç¨ <code>(bool)</code>ã<code>(int)</code>ã<code>(float)</code>ã<code>(string)</code>ã</p>
<p>å¿«éæç´¢ï¼</p>
<ul>
<li>grep æ <code>\(integer\)</code> / <code>\(boolean\)</code> ç­ï¼</li>
<li>åºç¨ codemodï¼æ Rectorââåé¢ä¼è®²ï¼ã</li>
</ul>
<p><strong>case è¯­å¥ç¨åå·ç»å°¾å·²å¼ç¨</strong>ï¼ç¨ <code>:</code>ï¼ã</p>
<p>è¿å¸¸åºç°å¨"ä¸ç´è½è·"çè switch åéã</p>
<p><strong>ç¨ null ä½ä¸ºæ°ç»åç§»ï¼æå¨ array_key_exists ä¸­ï¼å·²å¼ç¨</strong>ï¼PHP å»ºè®®ç¨ç©ºå­ç¬¦ä¸²ä»£æ¿ã</p>
<p>è¿éå¸¸æåè¾å¥è§èå bugââä¿®æ ¹æ¬åå ï¼ä¸åªæ¯ä¿®è­¦åã</p>
<p><strong>éå¢éæ°å­å­ç¬¦ä¸²å·²å¼ç¨</strong>ï¼ç¨ <code>str_increment()</code> ä»£æ¿ã</p>
<p>å¦æä½ æä»£ç ç¨ <code>$s++</code> åå­æ¯éå¢ï¼ä¼çå°è¿ä¸ªã</p>
<p><strong>åå¼å·æä½ç¬¦å·²å¼ç¨</strong>ï¼å®æ¯ shell_exec çå«åï¼ã</p>
<p>å³ä½¿ä½ æ¥åå®å¨é£é©ï¼ä¹ä¸æ³è®©å¼ç¨è­¦åé£æ´æ·¹æ²¡çäº§æ¥å¿ã</p>
<p><strong><code>__sleep()</code> å <code>__wakeup()</code> è½¯å¼ç¨</strong>ï¼ä¼åç¨ <code>__serialize()</code> / <code>__unserialize()</code>ï¼æå¨è¿æ¸¡æåæ¶æ¯æä¸¤èï¼ã</p>
<h3 id="è¿ç»´ç¸å³çå¼ç¨æ©å±iniç©ºæä½å½æ°">è¿ç»´ç¸å³çå¼ç¨ï¼æ©å±ãiniã"ç©ºæä½"å½æ°ï¼</h3>
<p>æäºå¼ç¨æ¯"ä½ ä¸åéè¦è¿ä¸ªäº"ï¼ä½ä»å¯è½è®©ä½ æªæä¸åï¼</p>
<ul>
<li><code>curl_close()</code> å <code>curl_share_close()</code> å·²å¼ç¨ï¼å ä¸ºå¥æä¼èªå¨éæ¾ã</li>
<li><code>imagedestroy()</code> å·²å¼ç¨ï¼å ä¸º GdImage ä¼èªå¨éæ¾ã</li>
<li><code>finfo_close()</code> å·²å¼ç¨ï¼å ä¸º finfo å¯¹è±¡ä¼èªå¨éæ¾ã</li>
<li><code>MHASH_*</code> å¸¸éå·²å¼ç¨ã</li>
<li>PDO <code>"uri:"</code> DSN scheme å å®å¨åå å·²å¼ç¨ã</li>
</ul>
<p>å¦æä½ è¿ç»´å¤§ååºç¨ï¼è¿äºå¾éè¦ï¼å ä¸ºå®ä»¬å¯è½ï¼</p>
<ul>
<li>æ¥å¿çç¸ï¼åªé³ï¼ï¼</li>
<li>æ©ççæ­£çéè¯¯ï¼</li>
<li>ææç¤ºå¼å¾å®¡æ¥çå®å¨ææè¡ä¸ºï¼è¿ç¨ URI ç PDO DSNï¼ã</li>
</ul>
<h3 id="å¼å¾å°½æ©æ£æ¥çä¸å¼å®¹åæ´">å¼å¾å°½æ©æ£æ¥çä¸å¼å®¹åæ´</h3>
<p>æ¥èªå®æ¹åè¡¨ï¼</p>
<ul>
<li><code>class_alias()</code> ä¸è½åç¨ "array" æ "callable" ä½ä¸ºå«åã</li>
<li>å¯¹è±¡å°å¸å°çæ¾æ£æ¯è¾è¢«ç»ä¸ä¸ºä¸ <code>(bool)$object</code> è¡ä¸ºä¸è´ã</li>
<li>Trait å¨ç¶ç±»ä¹åç»å®ï¼å¾®å¦çè¡ä¸ºåæ´ï¼ã</li>
<li>æäº attribute ç®æ éªè¯éè¯¯ç°å¨å¨ç¼è¯æåçï¼æéé¡¹å¯ä»¥å»¶è¿ï¼ã</li>
</ul>
<p>ä½ å¯è½æ°¸è¿ä¸ä¼éå°è¿äºãä½å¦æéå°ï¼ä½ å¸æå®ä»¬å¨ CI ç«å»å¤±è´¥ââèä¸æ¯å¨çäº§ç¯å¢ã</p>
<h2 id="composer-ç­ç¥lock-æä»¶å¹³å°è¦æ±ååé¶æ®µæ´æ°">Composer ç­ç¥ï¼lock æä»¶ãå¹³å°è¦æ±ååé¶æ®µæ´æ°</h2>
<p>ä¾èµç®¡çæ¯åçº§åºé®é¢çå°æ¹ã</p>
<h3 id="çè§£-composer-å¨æ£æ¥ä»ä¹">çè§£ Composer å¨æ£æ¥ä»ä¹</h3>
<p>Composer æå½å PHP çæ¬å»ºæ¨¡ä¸ºå¹³å°åï¼<code>php</code>ï¼ï¼å¹¶æ®æ­¤æ£æ¥ä½ çä¾èµã</p>
<p>æä»¥ä½ æä¸¤ä¸ªç¸å³çé®é¢ï¼</p>
<ol>
<li>"æçä¾èµå¾è½å¨ PHP 8.5 ä¸è§£æåï¼"</li>
<li>"æççäº§ç¯å¢ççæ»¡è¶³è§£æåºçä¾èµå¾åï¼"</li>
</ol>
<h3 id="åé¶æ®µæ´æ°ä¾èµä¸è¦ä¸æ¬¡æ§æå®">åé¶æ®µæ´æ°ä¾èµï¼ä¸è¦"ä¸æ¬¡æ§æå®"ï¼</h3>
<p>ä¸ä¸ªå®ç¨çåé¶æ®µæ¹æ³ï¼</p>
<p><strong>é¶æ®µ Aï¼ä¸æ¹åè¿è¡æ¶ï¼è§£æä¾èµ</strong></p>
<ul>
<li>å¨å½å PHP çæ¬ä¸æ´æ°ä¾èµï¼å¦æå¯è½ï¼ã</li>
<li>ç®æ ï¼åå°åæ¶åºç°çæªç¥æ°ã</li>
</ul>
<p><strong>é¶æ®µ Bï¼åè®¾å¨ PHP 8.5 ä¸è§£æä¾èµ</strong></p>
<ul>
<li>å¨ <code>composer.json</code> ä¸­ç¨ <code>config.platform.php</code> æ¨¡æ PHP 8.5 è¿è¡ä¾èµè§£æï¼ä¸´æ¶çï¼å¨åæ¯ä¸ï¼ã</li>
<li>ç¶åå¯æ§å°è¿è¡ <code>composer update</code>ã</li>
</ul>
<p><strong>é¶æ®µ Cï¼å¨çå® PHP 8.5 è¿è¡æ¶ä¸å®è£</strong></p>
<ul>
<li>å¨ CI/é¢åç¯å¢ççå® 8.5 ä¸è¿è¡å®æ´æµè¯å¥ä»¶ã</li>
</ul>
<h3 id="æ­£ç¡®ä½¿ç¨-composer-çå¹³å°æ£æ¥">æ­£ç¡®ä½¿ç¨ Composer çå¹³å°æ£æ¥</h3>
<ul>
<li><code>platform-check</code> æ§å¶å¨ Composer ç autoloader bootstrap ä¸­çæ <code>platform_check.php</code>ã</li>
<li><code>composer check-platform-reqs</code> éªè¯çå®è¿è¡æ¶æ¯å¦å¹éå·²å®è£åçè¦æ±ã</li>
</ul>
<p>æ¢å¥è¯è¯´ï¼</p>
<ul>
<li>ç¨ <code>config.platform</code> æ¥æ¨¡æåè§£æã</li>
<li>ç¨ <code>check-platform-reqs</code> æ¥ç¡®ä¿çäº§å®éå¼å®¹ã</li>
</ul>
<h3 id="åçº§æé´ä¼åå¤ä½¿ç¨çå®å¨æ´æ°å½ä»¤">åçº§æé´ä¼åå¤ä½¿ç¨çå®å¨æ´æ°å½ä»¤</h3>
<p>å¸¸è§æ¨¡å¼ï¼</p>
<pre><code class="language-bash"># ä¿å®å°æ´æ°ä¾èµ
composer update --no-interaction --with-all-dependencies

# ä¸¥æ ¼æ lock æä»¶å®è£
composer install --no-interaction --prefer-dist
</code></pre>
<p>å¦æéè¦è¿½æ¥ä¸ä¸ªæé®é¢çåï¼</p>
<ul>
<li>æ¾å¼æ´æ°å®ï¼å ä¾èµï¼ï¼</li>
<li>å¨ CI çä¸¤ä¸ªè¿è¡æ¶ä¸éæ°è¿è¡ã</li>
</ul>
<p>é¿åæ"å¿½ç¥å¹³å°è¦æ±"å½æè§£å³æ¹æ¡ãå®è½è®©ä½ æ¬å°è±å°ï¼ä½ä¸æ¯è¿ç§»ç­ç¥ã</p>
<h2 id="é¨ç½²åæ·»å å¯è§æµæ§è¿æ ·ä½ è½è¯æåçº§æ¯å¥åº·ç">é¨ç½²åæ·»å å¯è§æµæ§ï¼è¿æ ·ä½ è½è¯æåçº§æ¯å¥åº·çï¼</h2>
<p>å¦æä¸è½åº¦éï¼å°±ä¼äºè®ºã</p>
<h3 id="åºçº¿åå¥åº·çå«ä¹">åºçº¿å"å¥åº·"çå«ä¹</h3>
<p>å¨é¨ç½² PHP 8.5 ä¹åï¼æè·ï¼</p>
<ul>
<li>éè¯¯çï¼HTTP 5xx + æªæè·å¼å¸¸ï¼ï¼</li>
<li>æ¢è¯·æ±çï¼p95/p99ï¼ï¼</li>
<li>åå­ä½¿ç¨è¶å¿ï¼FPM workerï¼ï¼</li>
<li>éåå»¶è¿ï¼å¦æä½ è· workerï¼ï¼</li>
<li>æ¥å¿éï¼å°¤å¶æ¯è­¦å/å¼ç¨ï¼ã</li>
</ul>
<h3 id="ä¸´æ¶å¢å æ¥å¿ä¿¡å·ä½ä¸è¦è®©æ¥å¿åæåå¾åº">ä¸´æ¶å¢å æ¥å¿ä¿¡å·ï¼ä½ä¸è¦è®©æ¥å¿åæåå¾åºï¼</h3>
<p>å¨åçº§çªå£æé´ï¼å ä¸ä¸ªç­æç"åçº§è§è§"æ¯åççï¼</p>
<ul>
<li>å¨è¿ç¨å¯å¨æ¶è®°å½ PHP çæ¬ï¼FPM/CLI workerï¼ï¼</li>
<li>ç»éè¯¯æä¸è¿è¡æ¶æ ç­¾ï¼æ§ç vs 8.5ï¼ï¼</li>
<li>æç«¯ç¹/worker ç±»åç»è®¡å¼ç¨æ°éã</li>
</ul>
<p>å¨ PHP ä¸­ï¼ä½ å¯ä»¥å¨åç«¯æ§å¶å¨ï¼ææ¡æ¶ bootstrapï¼éä¸ºé¢åç¯å¢æ·»å ä¸ä¸ªæå°çéè¯¯å¤çå¨ï¼</p>
<pre><code class="language-php">set_error_handler(static function (int $severity, string $message, string $file, int $line): bool {
    if (!(error_reporting() &amp; $severity)) {
        return false;
    }
    // ç¤ºä¾ï¼æå¼ç¨/è­¦åè·¯ç±å°ä¸ç¨ logger channel
    if ($severity === E_DEPRECATED || $severity === E_USER_DEPRECATED) {
        error_log("[DEPRECATED] {$message} in {$file}:{$line}");
        return true; // å·²å¤ç
    }
    return false; // è®©æ­£å¸¸å¤çå¨è¿è¡
});
</code></pre>
<p>ä¿æä¸´æ¶æ§ãç®æ æ¯ä¸çº¿æé´çæ¸æ°åº¦ï¼ä¸æ¯ä¸ä¸ªæ°¸ä¹çèªå®ä¹éè¯¯æ¡æ¶ã</p>
<h3 id="ç¡®ä¿ç»è¿å¤çå¨çè­¦åä¸ä¼è®©ä½ æªæä¸å">ç¡®ä¿"ç»è¿å¤çå¨çè­¦å"ä¸ä¼è®©ä½ æªæä¸å</h3>
<p>PHP 8.5 å¼ç¨äºå¨ç¨æ·è¾åºå¤çå¨åé¨äº§çè¾åºçè¡ä¸ºï¼å¹¶æåºè­¦åä¼ç»è¿å¤çå¨ä»¥ç¡®ä¿å¯è§æ§ã</p>
<p>å¦æä½ åèªå®ä¹è¾åºç¼å²çéªæä½ï¼å¨é¢åç¯å¢ç¨çå®æµéæ¨¡å¼æµè¯å®ä»¬ã</p>
<h2 id="ä¸çº¿ç­ç¥éä¸éæèç»¿é¨ç½²å ä¸å®éè½ç¨çåæ»">ä¸çº¿ç­ç¥ï¼éä¸éæèç»¿é¨ç½²ï¼å ä¸å®éè½ç¨çåæ»</h2>
<p>è¿æ¯è¿ç»´åçº§æè´¥çå³é®ã</p>
<h3 id="éä¸éåºç¡æå°å¯è¡çå®å¨ä¸çº¿">éä¸éåºç¡ï¼æå°å¯è¡çå®å¨ä¸çº¿ï¼</h3>
<ol>
<li>åæ PHP 8.5 é¨ç½²å°å°æ¯ä¾çæµéã</li>
<li>å¯¹æ¯éè¯¯çåå»¶è¿ä¸åºçº¿ã</li>
<li>ä¿æéä¸éè¶³å¤é¿çæ¶é´ä»¥è¦ççå®ä¸å¡æµç¨ï¼ä¸åªæ¯å¥åº·æ£æ¥ï¼ã</li>
</ol>
<p>å®ç°åå³äºä½ çææ¯æ ï¼</p>
<ul>
<li>è´è½½åè¡¡å¨åé¢çä¸¤ä¸ª FPM poolï¼</li>
<li>Kubernetes deployment å æéè·¯ç±ï¼</li>
<li>ä¸¤ä¸ª ASG / ä¸¤ä¸ª service å æ¸è¿æµéåæ¢ã</li>
</ul>
<h3 id="èç»¿é¨ç½²éåå¤§çç¸å¼ç»ç»">èç»¿é¨ç½²éå"å¤§çç¸"å¼ç»ç»</h3>
<p>å¦æä½ çç»ç»åå¥½ç¡¬åæ¢ï¼</p>
<ul>
<li>ä¿ææ°æ§ç¯å¢é½å¨çº¿ï¼</li>
<li>åæ¢æµéï¼</li>
<li>ä¿ææ§ç¯å¢ç­å¤ä»¥ä¾¿å¿«éåæ»ã</li>
</ul>
<h3 id="åæ»è®¡åå¿é¡»åå«ä¾èµåç¼å­">åæ»è®¡åå¿é¡»åå«ä¾èµåç¼å­</h3>
<p>åæ»ä¸åªæ¯"æåæ§ç PHP äºè¿å¶"ã</p>
<p>åæ»ç°å®æ§æ£æ¥æ¸åï¼</p>
<ul>
<li>ä¿çä¹åçå®¹å¨éåï¼æåï¼ã</li>
<li>ä¿çä¹åç <code>composer.lock</code> å¶åã</li>
<li>ç¥éåæ¢è¿è¡æ¶æ¶ opcache/APCu ææ¡æ¶ç¼å­æ¯å¦éè¦æ¸çã</li>
<li>ç¡®ä¿æ°æ®åºè¿ç§»æ¯ååå¼å®¹çï¼ææç¡®æé¤å¨åçº§èå´å¤ï¼ã</li>
</ul>
<p>å¦æåæ»éè¦ä¸ä¸ªäººåä¸ä»½ wiki é¡µé¢ï¼å¨ååä¸å®ä¼å¤±è´¥ã</p>
<h2 id="åçº§åæ£æ¥æ¸ååéªè¯æ­£ç¡®æ§åéªè¯æ§è½ç¶åæ¸ç">åçº§åæ£æ¥æ¸åï¼åéªè¯æ­£ç¡®æ§ï¼åéªè¯æ§è½ï¼ç¶åæ¸ç</h2>
<p>ä¸æ¦ PHP 8.5 å¼å§æå¡çå®æµéï¼ä½ çå·¥ä½è¿æ²¡å®ãç°å¨è¿å¥"éªè¯åç¨³å®"æ¨¡å¼ã</p>
<h3 id="å³æ¶æ£æ¥ç¬¬ä¸å°æ¶">å³æ¶æ£æ¥ï¼ç¬¬ä¸å°æ¶ï¼</h3>
<ul>
<li>æ«æéè¯¯æ¥å¿æ¥æ¾æ°çè´å½éè¯¯/å¼å¸¸ã</li>
<li>è§å¯æ¥å¿éæ¯å¦çªç¶å¢é¿ï¼éå¸¸æ¯å¼ç¨ï¼ã</li>
<li>å¨çäº§ä¸»æºä¸éªè¯ <code>composer check-platform-reqs</code>ã</li>
<li>ç¨åææ£æ¥éªè¯æ ¸å¿æµç¨ï¼ç»å½ãç»è´¦ãä¸ä¼ ãå®æ¶ä»»å¡ç«¯ç¹ï¼ã</li>
</ul>
<h3 id="é¦æ¥æ£æ¥">é¦æ¥æ£æ¥</h3>
<ul>
<li>å¯¹æ¯ p95/p99 å»¶è¿ä¸åºçº¿ã</li>
<li>æ£æ¥åå­ä½¿ç¨ï¼
<ul>
<li>FPM worker RSS å¢é¿ï¼</li>
<li>worker åæ¶é¢çï¼</li>
<li>éå worker åå­æ³æ¼ã</li>
</ul>
</li>
<li>éªè¯åå°ä»»å¡ï¼
<ul>
<li>worker å¨æ°è¿è¡æ¶ä¸å·²éå¯ï¼</li>
<li>æ²¡æ"å¡ä½"çéåï¼</li>
<li>æ²¡æéé»å¤±è´¥ã</li>
</ul>
</li>
</ul>
<h3 id="é¦å¨æ¸ç">é¦å¨æ¸ç</h3>
<ul>
<li>ç§»é¤ä½ ä¸ºä¸çº¿è§è§æ·»å çä¸´æ¶é¢å¤æ¥å¿ã</li>
<li>æé«é¢å¼ç¨è½¬æè·è¸ªçå·¥åå¹¶éæ­¥æ¶ç­ã</li>
<li>åæ¬¡æ¶ç´§ CIï¼
<ul>
<li>æé«å¼ç¨çæ åï¼</li>
<li>ç¡®è®¤ç¨³å®åä»ç©éµä¸­ç§»é¤æ§ PHP çæ¬ã</li>
</ul>
</li>
</ul>
<h2 id="å³äº-php-85-ç¹æ§çå¿«éå¼å®¹æ§è¯´æä¸å±å¼æç¨">å³äº PHP 8.5 ç¹æ§çå¿«éå¼å®¹æ§è¯´æï¼ä¸å±å¼æç¨ï¼</h2>
<p>PHP 8.5 å¼å¥äºæ°çè¯­è¨åè¿è¡æ¶ç¹æ§ï¼å¦ç®¡éæä½ç¬¦ãURI æ©å±ãclone-with ç­ã</p>
<p>åçº§æé´ä¸éè¦éç¨å®ä»¬ãä½ä½ åºè¯¥ï¼</p>
<ul>
<li>ç¡®ä¿ä½ ç linter/formatter è¯å« PHP 8.5 è¯­æ³ï¼</li>
<li>ç¡®ä¿ CI å¨ PHP 8.5 ä¸è¿è¡åååå¹¶ä»»ä½ 8.5 ä¸å±è¯­æ³ï¼</li>
<li>æç¹æ§éç¨åè¿è¡æ¶è¿ç§»åå¼ï¼èå´æ§å¶ï¼ã</li>
</ul>
<h2 id="ç»è®ºæåçº§å½é¨ç½²æ¥å¯¹å¾å°±ä¼é¡ºå©">ç»è®ºï¼æåçº§å½é¨ç½²æ¥å¯¹å¾ï¼å°±ä¼é¡ºå©</h2>
<p>åçº§å° PHP 8.5 éå¸¸ä¸æ¯"éå"é®é¢ãæ¯çºªå¾é®é¢ï¼</p>
<ul>
<li>å®ä¹èå´ï¼</li>
<li>å®¡è®¡çå®å¹³å°ï¼</li>
<li>è¿è¡ CI ç©éµï¼</li>
<li>ç³»ç»å°åç±»å¼ç¨åä¸å¼å®¹ï¼</li>
<li>ææè¯å°ç®¡çä¾èµï¼</li>
<li>ä¸çº¿åæ·»å å¯è§æµæ§ï¼</li>
<li>å¸¦çç­ç¥ååæ»è·¯å¾é¨ç½²ï¼</li>
<li>åæ¢åéªè¯åç¨³å®ã</li>
</ul>
<p>å¦æä½ éµå¾ªè¿ä¸ªé¡ºåºï¼PHP åçº§å°±ä¸åå¯æââå®åªæ¯å¦ä¸ä¸ªå¸¸è§çè¿ç»´åæ´ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.002777777777777778" data-date-updated="2026-01-14 07:47">2026-01-14 07:43</span>&nbsp;
<a href="https://www.cnblogs.com/catchadmin">JaguarJack</a>&nbsp;
éè¯»(<span id="post_view_count">10</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479967);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479967', targetLink: 'https://www.cnblogs.com/catchadmin/p/19479967', title: 'PHP 8.5 åçº§çå­æåï¼é¿ååæ¨ä¸¤ç¹åæ»çæ£æ¥æ¸å' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ LangChainãLangFlowãLangGraphï¼ä¸æè®²æ¸ä¸å¤§ LLM æ¡æ¶çå®ä½ä¸å·®å¼ ]]></title>
    <link>https://www.cnblogs.com/jyzhao/p/19479470/langchainlangflowlanggraph-yi-wen-jiang-qing-san-d</link>
    <guid>88c9b78cc1ca2c9bde876d7c031b53cb</guid>
    <description>
    <![CDATA[ 
    <a name="top"></a>
    <h2><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jyzhao/p/19479470/langchainlangflowlanggraph-yi-wen-jiang-qing-san-d" title="åå¸äº 2026-01-13 23:25">
    <span role="heading" aria-level="2">LangChainãLangFlowãLangGraphï¼ä¸æè®²æ¸ä¸å¤§ LLM æ¡æ¶çå®ä½ä¸å·®å¼</span>
    

</a>
</h2>
    <small>
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 23:25">2026-01-13 23:25</span>&nbsp;
<a href="https://www.cnblogs.com/jyzhao">AlfredZhao</a>&nbsp;
éè¯»(<span id="post_view_count">163</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479470);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479470', targetLink: 'https://www.cnblogs.com/jyzhao/p/19479470/langchainlangflowlanggraph-yi-wen-jiang-qing-san-d', title: 'LangChainãLangFlowãLangGraphï¼ä¸æè®²æ¸ä¸å¤§ LLM æ¡æ¶çå®ä½ä¸å·®å¼' })">ä¸¾æ¥</a>
</small>
    <div class="entry">
        <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>éçå¤§æ¨¡åï¼LLMï¼è¿å¥å·¥ç¨åè½å°é¶æ®µï¼<strong>âå¦ä½ææ¨¡ååæçæ­£å¯ç¨çåºç¨â</strong> æäºå¾å¤ä»ä¸èç»ä¸å¼çé®é¢ã<br>
å´ç»è¿ä¸ªç®æ ï¼ç¤¾åºééæ¸å½¢æäºä¸æ¹æççå¼æºæ¡æ¶ï¼å¶ä¸­è¢«è®¨è®ºæå¤çå°±æ¯ <strong>LangChainãLangFlowãLangGraph</strong>ã</p>
<p>å®ä»¬åå­ç¸ä¼¼ï¼ä½<strong>è§£å³çé®é¢å¹¶ä¸ç¸å</strong>ãæ¬æç¬èå°åºäºå®æ¹ææ¡£ä¸å¼æºå®è·µï¼ä»<strong>å®ä½ãè½åãä½¿ç¨åºæ¯åå·®å¼</strong>å ä¸ªè§åº¦ï¼å¸®ä½ ä¸æ¬¡æ§çæ¸ã</p>
<hr>
<h2 id="01--langchainllm-åºç¨çåºç¡è®¾æ½å±">01 | LangChainï¼LLM åºç¨çâåºç¡è®¾æ½å±â</h2>
<h3 id="-langchain-æ¯ä»ä¹">â  LangChain æ¯ä»ä¹ï¼</h3>
<p>LangChain æ¯ä¸ä¸ª<strong>ç¨äºæå»º LLM åºç¨çéç¨æ¡æ¶</strong>ï¼æ ¸å¿ç®æ åªæä¸å¥è¯ï¼</p>
<blockquote>
<p>æãå¤§æ¨¡å + å¤é¨å·¥å· + æ°æ®æº + Promptãç³»ç»åå°ç»ç»èµ·æ¥ã</p>
</blockquote>
<p>å®å¹¶ä¸æ¯ä¸ä¸ªâäº§åâï¼èæ¯ä¸å¥ <strong>å¼åèå¼åç»ä»¶åº</strong>ã</p>
<hr>
<h3 id="-langchain-è§£å³ä»ä¹é®é¢">â¡ LangChain è§£å³ä»ä¹é®é¢ï¼</h3>
<p>å¨æ²¡æ LangChain ä¹åï¼å¼åèéå¸¸éè¦èªå·±å¤çï¼</p>
<ul>
<li>Prompt æ¼æ¥</li>
<li>æ¨¡åè°ç¨</li>
<li>ä¸ä¸æç®¡ç</li>
<li>å·¥å·è°ç¨ï¼SQLãæç´¢ãAPIï¼</li>
<li>RAGï¼æ£ç´¢å¢å¼ºçæï¼</li>
</ul>
<p>LangChain æè¿äºæ½è±¡æäºæ åç»ä»¶ï¼ä¾å¦ï¼</p>
<ul>
<li>LLM / ChatModel</li>
<li>PromptTemplate</li>
<li>Chain</li>
<li>Tool / Agent</li>
<li>Memory</li>
</ul>
<hr>
<h3 id="-å¸ååºç¨åºæ¯">â¢ å¸ååºç¨åºæ¯</h3>
<ul>
<li>RAG é®ç­ç³»ç»</li>
<li>NL2SQL</li>
<li>AI å©æ / Copilot</li>
<li>å·¥å·å Agent</li>
</ul>
<p><strong>ä¸å¥è¯æ»ç»</strong>ï¼<br>
<strong>LangChain = å LLM åºç¨çâåç«¯å¼åæ¡æ¶â</strong></p>
<hr>
<h2 id="02--langflowlangchain-çå¯è§åä½ä»£ç å¥å£">02 | LangFlowï¼LangChain çå¯è§åâä½ä»£ç å¥å£â</h2>
<h3 id="-langflow-æ¯ä»ä¹">â  LangFlow æ¯ä»ä¹ï¼</h3>
<p>LangFlow æ¯ä¸ä¸ª <strong>åºäº LangChain çå¯è§åç¼æå·¥å·</strong>ã</p>
<p>ä½ å¯ä»¥çè§£ä¸ºï¼</p>
<blockquote>
<p>ç¨âææ½æµç¨å¾âçæ¹å¼æ¥æ­ LangChain åºç¨ã</p>
</blockquote>
<p>å®æ¬è´¨ä¸æ¯ï¼</p>
<ul>
<li>åç«¯å¯è§å</li>
<li>åç«¯ä»ç¶è¿è¡ LangChain é»è¾</li>
</ul>
<hr>
<h3 id="-langflow-çæ ¸å¿ä»·å¼">â¡ LangFlow çæ ¸å¿ä»·å¼</h3>
<p>LangFlow å¹¶æ²¡æå¼å¥æ°çæ¨¡åè½åï¼å®çä¼å¿å¨äºï¼</p>
<ul>
<li><strong>éä½å­¦ä¹ é¨æ§</strong></li>
<li>å¿«éååéªè¯</li>
<li>Prompt / Chain å¯è§åè°è¯</li>
</ul>
<p>å¯¹ä¸çæ Python æåæ¥è§¦ LLM çäººéå¸¸åå¥½ã</p>
<hr>
<h3 id="-å¸ååºç¨åºæ¯-1">â¢ å¸ååºç¨åºæ¯</h3>
<ul>
<li>äº§åç»ç / å¨è¯¢é¡¾é®å Demo</li>
<li>Prompt è°ä¼ä¸æµç¨éªè¯</li>
<li>æå­¦ä¸åäº«æ¼ç¤º</li>
<li>å°å PoC é¡¹ç®</li>
</ul>
<p><strong>ä¸å¥è¯æ»ç»</strong>ï¼<br>
<strong>LangFlow = LangChain çâå¯è§åæä½å°â</strong></p>
<hr>
<h2 id="03--langgraphä¸ºå¤æ-agent-èççç¶ææºæ¡æ¶">03 | LangGraphï¼ä¸ºå¤æ Agent èççâç¶ææºæ¡æ¶â</h2>
<h3 id="-langgraph-æ¯ä»ä¹">â  LangGraph æ¯ä»ä¹ï¼</h3>
<p>LangGraph æ¯ LangChain å®æ¹æ¨åºçä¸ä¸ª<strong>æ°æ¡æ¶</strong>ï¼ä¸é¨è§£å³ä¸ä¸ªé®é¢ï¼</p>
<blockquote>
<p>å½ Agent é»è¾åå¤æï¼Chain å·²ç»ä¸å¤ç¨äºï¼æä¹åï¼</p>
</blockquote>
<p>LangGraph å¼å¥çæ¯ï¼</p>
<ul>
<li><strong>Graphï¼å¾ï¼</strong></li>
<li><strong>Stateï¼ç¶æï¼</strong></li>
<li><strong>èç¹ + è¾¹ + å¾ªç¯</strong></li>
</ul>
<p>æ¬è´¨ä¸æ¯ï¼<br>
<strong>æ LLM Agent å½æä¸ä¸ªâæç¶æçå·¥ä½æµ/ç¶ææºâæ¥å»ºæ¨¡</strong>ã</p>
<hr>
<h3 id="-langgraph-ä¸ºä»ä¹åºç°">â¡ LangGraph ä¸ºä»ä¹åºç°ï¼</h3>
<p>å¨çå®é¡¹ç®ä¸­ï¼Agent å¾å¾éè¦ï¼</p>
<ul>
<li>å¤è½®å³ç­</li>
<li>æ¡ä»¶åæ¯</li>
<li>åé / éè¯</li>
<li>äººå·¥ä»å¥ï¼Human-in-the-loopï¼</li>
</ul>
<p>è¿äºç¨ä¼ ç» Chain éå¸¸å«æ­ï¼è LangGraph å¤©ç¶æ¯æï¼</p>
<ul>
<li>å¾ªç¯</li>
<li>åæ¯</li>
<li>å¹¶è¡</li>
<li>å¯æ¢å¤æ§è¡</li>
</ul>
<hr>
<h3 id="-å¸ååºç¨åºæ¯-2">â¢ å¸ååºç¨åºæ¯</h3>
<ul>
<li>å¤ Agent åä½ç³»ç»</li>
<li>å¤æä¸å¡æµç¨èªå¨å</li>
<li>é¿ä»»å¡ AI å©æ</li>
<li>éè¦âå¯æ§è¡ä¸ºâçæºè½ä½</li>
</ul>
<p><strong>ä¸å¥è¯æ»ç»</strong>ï¼<br>
<strong>LangGraph = é¢åå¤æ Agent çâæµç¨ä¸ç¶ææ§å¶å±â</strong></p>
<hr>
<h2 id="04--ä¸èæ ¸å¿å·®å¼ä¸å¾è¯»æ">04 | ä¸èæ ¸å¿å·®å¼ä¸å¾è¯»æ</h2>
<table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>LangChain</th>
<th>LangFlow</th>
<th>LangGraph</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ ¸å¿å®ä½</td>
<td>LLM åºç¨æ¡æ¶</td>
<td>å¯è§åç¼æå·¥å·</td>
<td>Agent ç¶ææºæ¡æ¶</td>
</tr>
<tr>
<td>æ½è±¡æ¨¡å</td>
<td>Chain / Agent</td>
<td>Flow</td>
<td>Graph / State</td>
</tr>
<tr>
<td>ä½¿ç¨æ¹å¼</td>
<td>åä»£ç </td>
<td>ææµç¨</td>
<td>åå¾ç»æä»£ç </td>
</tr>
<tr>
<td>éåäººç¾¤</td>
<td>å·¥ç¨å¸</td>
<td>åå­¦è / äº§å</td>
<td>é«çº§å·¥ç¨å¸</td>
</tr>
<tr>
<td>å¤æé»è¾</td>
<td>ä¸è¬</td>
<td>ä¸è¬</td>
<td>éå¸¸å¼º</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="05--åºè¯¥å¦ä½éæ©">05 | åºè¯¥å¦ä½éæ©ï¼</h2>
<p>ç¬èç»ä½ ä¸ä¸ª<strong>ä¸è¸©åçéæ©å»ºè®®</strong>ï¼</p>
<ul>
<li><strong>æ³ç³»ç»å LLM åºç¨</strong> â åå­¦ <strong>LangChain</strong></li>
<li><strong>æ³å¿«éåº Demo / å­¦æ¦å¿µ</strong> â ç¨ <strong>LangFlow</strong></li>
<li><strong>Agent é»è¾å¼å§åå¤æ</strong> â ä¸ <strong>LangGraph</strong></li>
</ul>
<p>ç°å®é¡¹ç®ä¸­ï¼<strong>ä¸èæ¯å¯ä»¥ç»åä½¿ç¨ç</strong>ï¼</p>
<blockquote>
<p>LangFlow ç»æµç¨ â LangChain è½ä»£ç  â LangGraph æ§å¤ææ§å¶</p>
</blockquote>
<hr>
<h2 id="06--åå¨æå">06 | åå¨æå</h2>
<p>LangChain çæçæ¼è¿ï¼æ¬è´¨ä¸åæ äºä¸ä»¶äºï¼</p>
<blockquote>
<p>LLM åºç¨ï¼æ­£å¨ä»âPrompt å·¥ç¨âï¼èµ°åçæ­£çè½¯ä»¶å·¥ç¨ã</p>
</blockquote>
<p>çè§£è¿ä¸èçè¾¹çï¼æ¯æ­»è®° API æ´éè¦ã<br>
å¦æä½ æ­£å¨å <strong>RAGãNL2SQLãAI Agent</strong>ï¼è¿å¥è®¤ç¥å ä¹æ¯ç»ä¸å¼çåºç¡ã</p>
<p>å¸æè¿ç¯æç« ï¼è½å¸®ä½ å°èµ°ä¸äºå¼¯è·¯ã</p>

</div>
<div id="MySignature" role="contentinfo">
    <a href="https://www.cnblogs.com/jyzhao/" target="_blank">AlfredZhao</a>Â©çæææãä»Oracleèµ·èªï¼é¢ç¥ç²¾å½©çITææ¯ãã<br>
è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/jyzhao/p/19479470/langchainlangflowlanggraph-yi-wen-jiang-qing-san-d" target="_blank">https://www.cnblogs.com/jyzhao/p/19479470/langchainlangflowlanggraph-yi-wen-jiang-qing-san-d</a>
<hr>
<div style="text-align:center; margin-top:30px;">
  <p style="font-size:14px;color:#555;">
    ð æè°¢éè¯»ï¼æ¬¢è¿å³æ³¨æçå¬ä¼å· <b>ãèµµéå®ã</b>
  </p>
  <img src="https://images.cnblogs.com/cnblogs_com/jyzhao/824234/o_250208075013_qrcode-zjy.jpg" width="160" style="border:1px solid #ddd;border-radius:8px;">
</div>
</div>
<div class="clear"></div>

        <div class="clear"></div>
        
</div>
    <ul class="postmetadata">
        <vc:categories-tags blog-app="jyzhao" blog-id="186567" post-id="19479470"></vc:categories-tags>
    </ul>
 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ æµèç®æ³ç«èµä¸­ç»´æ¤ä¸­ä½æ°çå°æå·§ ]]></title>
    <link>https://www.cnblogs.com/GroundhogKing/p/19479345</link>
    <guid>78576c713959f1fba2ffcc2d440488b6</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/GroundhogKing/p/19479345" title="åå¸äº 2026-01-13 23:13">
    <span role="heading" aria-level="2">æµèç®æ³ç«èµä¸­ç»´æ¤ä¸­ä½æ°çå°æå·§</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>é¦åæ¥çæåæ­çµå¤æ ¡çä¸éé¢ç®ï¼</p>
<hr>
<p>å¯¹äºä¸ä¸ªé¿åº¦ä¸º <span class="math inline">\(L\)</span>(<span class="math inline">\(L\)</span>ä¸ºå¥æ°) çæ°ç» <span class="math inline">\(a\)</span>ï¼å®ä¹å®çä¸­ä½æ° <span class="math inline">\(median(a)\)</span> ä¸º <span class="math inline">\(a\)</span> ä¸­ç¬¬ <span class="math inline">\(\frac{L+1}{2}\)</span> å¤§çæ°ãç°å¨ç»ä½ ä¸ä¸ªé¿åº¦ä¸º <span class="math inline">\(n\)</span> çæåï¼å¯¹äºæ¯å¯¹æ»¡è¶³ <span class="math inline">\(1\leq i \leq j \leq n\)</span> ä¸ <span class="math inline">\(j-i \equiv 0 (mod 2)\)</span> ç <span class="math inline">\((i,j)\)</span>ï¼ä½ éè¦è®¡ç® <span class="math inline">\(i*j*median(p[i,j])\)</span>ãè¾åºææå¼çåã</p>
<p>å¤æµæ° <span class="math inline">\(T \leq 20\)</span>ï¼æåé¿åº¦ <span class="math inline">\(n \leq 2000\)</span>ã</p>
<hr>
<p>å¯¹äºè¿éé¢ï¼é¦åæ³å°çæ¯æä¸¾ææ <span class="math inline">\([i,j]\)</span>ï¼éè¿æ°æ®ç»æ(å¯¹é¡¶å ç­)ç»´æ¤ä¸­ä½æ°ãç±äºè¿äºæ¹æ³é½å¸¦logï¼å¹¶ä¸æ¬é¢å¤æµæ°æ®ä¸ä¿è¯ <span class="math inline">\(n\)</span> çæ»åãå æ­¤å¤æåº¦ <span class="math inline">\(O(n^2lognT)\)</span>ï¼æ æ³éè¿æ¬é¢ã</p>
<p>æ¢ä¸ªæè·¯ï¼æä¸¾åºé´ä¸è¡ï¼å°±è®¡ç®æ¯ä¸ªä½ç½®çè´¡ç®ãæ³æ³ä¸ä¸ªä½ç½®è½æä¸ºä¸ä¸ªåºé´çä¸­ä½æ°ï¼éè¦æ»¡è¶³ä»ä¹æ¡ä»¶ï¼è¯¥åºé´ä¸­å¤§äºå®åå°äºå®çæ°çæ°éç¸ç­ã</p>
<p>ä¸ä¸ªå¾ç»å¸çå¤çå°±æ¯ï¼å°å°äº <span class="math inline">\(x\)</span> çæ°èµ-1ï¼å°å¤§äº <span class="math inline">\(x\)</span> çæ°èµ1ï¼æä»¬å¯¹è¿ä¸ªæ°ç»ååç¼åï¼è®°ä½ <span class="math inline">\(pre\)</span>ãäºæ¯é®é¢å°±è½¬æ¢ä¸ºï¼å¨ <span class="math inline">\(x\)</span> çå·¦è¾¹æ¾å° <span class="math inline">\(pre_i\)</span>ï¼å¨ <span class="math inline">\(x\)</span> çå³è¾¹æ¾å° <span class="math inline">\(pre_j\)</span>ï¼ä½¿å¾ <span class="math inline">\(pre_i = pre_j\)</span>ãé£ä¹ <span class="math inline">\(pre_j - pre_i = 0\)</span>ï¼è¿å°±æå³çï¼åºé´ <span class="math inline">\([l+1,r]\)</span> ä¸­å¤§äº <span class="math inline">\(x\)</span> åå°äº <span class="math inline">\(x\)</span> çæ°çæ°éç¸ç­ã</p>
<p>å¯¹äºæ¯ä¸ªæ°å¤çä¸æ¬¡è¿æ ·çåç¼åæ°ç»æ¯ <span class="math inline">\(O(n)\)</span> çï¼å æ­¤å¯ä»¥å¨ <span class="math inline">\(O(n^2T)\)</span> çæ¶é´ä¸éè¿æ¬é¢ã</p>
<p><strong>Code:</strong></p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;vector&gt;
using namespace std;

using ll = long long;

void solve()
{
    int n;
    cin &gt;&gt; n;
    vector&lt;int&gt; a(n+10);
    for (int i = 1 ; i &lt;= n ; i++) cin &gt;&gt; a[i];

    ll ans = 0;
    for (int i = 1 ; i &lt;= n ; i++) //æä¸¾ä¸­ä½æ°
    {
        vector&lt;int&gt; pre(n+10);
        vector&lt;int&gt; t(2*n+10); //æ¡¶,å ä¸ºä¼åºç°è´æ°ï¼è¦å¸¦nçåç§»
        t[n]++;
        for (int j = 1 ; j &lt;= n ; j++)
        {
            pre[j] = pre[j-1];
            if (a[j] &gt; a[i]) pre[j]++;
            else if (a[j] &lt; a[i]) pre[j]--;

            if (j &lt; i) t[pre[j]+n] += j + 1;
            else ans += (ll)a[i] * t[pre[j]+n] * j;
        }
    }

    cout &lt;&lt; ans &lt;&lt; endl;
}

int main()
{
    ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);

    int T;
    cin &gt;&gt; T;
    while (T--) solve();

    return 0;
}
</code></pre>
<p>åºäºæ¬é¢ï¼å¯ä»¥å½çº³ä¸ä¸ªç»´æ¤ä¸­ä½æ°çå°æå·§ï¼éè¿ç»å¤§äº <span class="math inline">\(x\)</span> å å°äº <span class="math inline">\(x\)</span> çæ°åå«èµå¼ï¼å¹¶æ±åç¼åï¼å°±å¯ä»¥ææ±ä¸­ä½æ°é®é¢ï¼è½¬åæç»´æ¤åç¼åä¹å·®ä¸º0ã</p>
<p>ä»¥ä¸ååä¸ªæå±ï¼åºå <span class="math inline">\(a\)</span> çä¸­ä½æ° <span class="math inline">\(median(a) \ge v\)</span>ï¼å½ä¸ä»å½ <span class="math inline">\(a\)</span> ä¸­ <span class="math inline">\(cnt_{a_i \geq v} \geq cnt_{a_i &lt; v}\)</span>ï¼å¼ä¸­æ¯å¦åç­å·åå³äºé¢ç®æä¹å®ä¹ä¸­ä½æ°ï¼ãä¹å°±æ¯è¯´ï¼<span class="math inline">\(median(a) \geq v\)</span> çåè¦æ¡ä»¶æ¯ <span class="math inline">\(a\)</span> ä¸­ <span class="math inline">\(\geq v\)</span> çæ°çæ°éå¤äºæç­äº <span class="math inline">\(&lt; v\)</span> çæ°çæ°éãè¿ä¸ªå¼å­æ¯è¾å¥½çè§£ï¼è¿éä¸åè¯æã</p>
<p>è¿ä¸ªå¼å­ç»æä»¬æä¾äºä¸ç§äºåçæè·¯ã</p>
<p>çä¸é¢è¿éé¢<a href="https://codeforces.com/contest/2128/problem/E1" target="_blank" rel="noopener nofollow">Submedians (Easy Version)</a>ï¼</p>
<hr>
<p>å¯¹äºé¿åº¦ä¸º <span class="math inline">\(m\)</span> çæ°ç» <span class="math inline">\(b\)</span>ï¼æ´æ° <span class="math inline">\(v\)</span> æ¯ <span class="math inline">\(b\)</span> çä¸­ä½æ°ï¼å½ä¸ä»å½ï¼</p>
<ul>
<li><span class="math inline">\(v\)</span> è³å°å¤§äºç­äºæ°ç»ä¸­ <span class="math inline">\(\lceil \frac{m}{2} \rceil\)</span> ä¸ªåç´ ï¼å¹¶ä¸</li>
<li><span class="math inline">\(v\)</span> è³å°å°äºç­äºæ°ç»ä¸­ <span class="math inline">\(\lceil \frac{m}{2} \rceil\)</span> ä¸ªåç´ ã</li>
</ul>
<p>ç°å¨ç»å®ä¸ä¸ªæ´æ° <span class="math inline">\(k\)</span> åä¸ä¸ªç± <span class="math inline">\(1\)</span> å° <span class="math inline">\(n\)</span> ä¹é´çæ´æ°ææçæ°ç» <span class="math inline">\(a_1, \ldots, a_n\)</span>ã</p>
<p>å¦æå­å¨è³å°ä¸å¯¹ä¸æ  <span class="math inline">\((l, r)\)</span> æ»¡è¶³ï¼</p>
<ul>
<li><span class="math inline">\(1 \leq l \leq r \leq n\)</span>ï¼</li>
<li><span class="math inline">\(r - l + 1 \geq k\)</span>ï¼</li>
<li><span class="math inline">\(v\)</span> æ¯å­æ°ç» <span class="math inline">\([a_l, \ldots, a_r]\)</span> çä¸­ä½æ°ï¼</li>
</ul>
<p>åç§° <span class="math inline">\(1\)</span> å° <span class="math inline">\(n\)</span> ä¹é´çæ´æ° <span class="math inline">\(v\)</span> æ¯ä¸ä¸ªå­ä¸­ä½æ°ã</p>
<p>å¯ä»¥è¯æï¼è³å°å­å¨ä¸ä¸ªå­ä¸­ä½æ°ãè¯·ä½ æ¾åºæå¤§çå­ä¸­ä½æ° <span class="math inline">\(v_{\max}\)</span>ï¼ä»¥åä»»æä¸ç»å¯¹åºçä¸æ å¯¹ <span class="math inline">\((l, r)\)</span>ã</p>
<hr>
<p>èèäºåï¼å½ <span class="math inline">\(v\)</span> è¶å¤§ï¼<span class="math inline">\(cnt_{a_i\geq v}\)</span> è¶å°ï¼åä¹ <span class="math inline">\(cnt_{a_i &lt; v}\)</span> è¶å¤§ï¼å æ­¤è¶å¤§çæ°è¶ä¸å¯è½ä½ä¸ºä¸­ä½æ°ã</p>
<p>åæ ·å° <span class="math inline">\(\geq v\)</span> çæ°èµ1ï¼<span class="math inline">\(&lt; v\)</span> çæ°èµ-1ï¼ååç¼åç»´æ¤å³å¯ã</p>
<p><strong>Code:</strong></p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;vector&gt;
using namespace std;

void solve()
{
    int n,k;
    cin &gt;&gt; n &gt;&gt; k;
    vector&lt;int&gt; a(n+10);
    for (int i = 1 ; i &lt;= n ; i++) cin &gt;&gt; a[i];

    int ansl, ansr;
    auto check = [&amp;](int mid)
    {
        vector&lt;int&gt; sum(n+10);
        for (int i = 1 ; i &lt;= n ; i++)
        {
            sum[i] = sum[i-1];
            if (a[i] &gt;= mid) sum[i]++;
            else sum[i]--;
        }

        int minn = 2e9;
        int l;
        for (int i = k ; i &lt;= n ; i++)
        {
            if (sum[i-k] &lt; minn)
            {
                minn = sum[i-k];
                l = i - k + 1;
            }
            if (sum[i]-minn &gt;= 0)
            {
                ansl = l;
                ansr = i;
                return true;
            }
        }

        return false;
    };

    int l = 0;
    int r = n + 1;
    while (l+1 != r)
    {
        int mid = (l+r) &gt;&gt; 1;
        if (check(mid)) l = mid;
        else r = mid;
    }

    check(l);
    cout &lt;&lt; l &lt;&lt; " " &lt;&lt; ansl &lt;&lt; " " &lt;&lt; ansr &lt;&lt; endl;
}

int main()
{
    ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);

    int T;
    cin &gt;&gt; T;
    while (T--) solve();

    return 0;
}
</code></pre>
<p>ä¸éä¸ä¸é¢å ä¹ä¸æ ·çé¢ç®<a href="https://codeforces.com/contest/1486/problem/D" target="_blank" rel="noopener nofollow">Max Median</a>ï¼</p>
<p>é¢ç®å¾ç­ï¼è¿éä¸åé¢ææ¦è¿°ãéè¦æ³¨æçæ¯ï¼ç±äºæ¬é¢å®ä¹ä¸­ä½æ°ä¸ºç¬¬ <span class="math inline">\(\lfloor \frac{L+1}{2} \rfloor\)</span> å¤§çæ°ï¼å æ­¤æ¬é¢ <span class="math inline">\(median(a) \geq v\)</span> çæ¡ä»¶ä¸ºï¼<span class="math inline">\(cnt_{a_i \geq v} &gt; cnt_{a_i &lt; v}\)</span>ã</p>
<p><strong>Code:</strong></p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;vector&gt;
using namespace std;

void solve()
{
    int n,k;
    cin &gt;&gt; n &gt;&gt; k;
    vector&lt;int&gt; a(n+10);
    for (int i = 1 ; i &lt;= n ; i++) cin &gt;&gt; a[i];

    int ansl, ansr;
    auto check = [&amp;](int mid)
    {
        vector&lt;int&gt; sum(n+10);
        for (int i = 1 ; i &lt;= n ; i++)
        {
            sum[i] = sum[i-1];
            if (a[i] &gt;= mid) sum[i]++;
            else sum[i]--;
        }

        int minn = 2e9;
        int l;
        for (int i = k ; i &lt;= n ; i++)
        {
            if (sum[i-k] &lt; minn)
            {
                minn = sum[i-k];
                l = i - k + 1;
            }
            if (sum[i]-minn &gt; 0)
            {
                ansl = l;
                ansr = i;
                return true;
            }
        }

        return false;
    };

    int l = 0;
    int r = n + 1;
    while (l+1 != r)
    {
        int mid = (l+r) &gt;&gt; 1;
        if (check(mid)) l = mid;
        else r = mid;
    }

    check(l);
    cout &lt;&lt; l &lt;&lt; endl;
}

int main()
{
    ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);

    int T = 1;
    while (T--) solve();

    return 0;
}
</code></pre>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 23:13">2026-01-13 23:13</span>&nbsp;
<a href="https://www.cnblogs.com/GroundhogKing">GroundhogKing</a>&nbsp;
éè¯»(<span id="post_view_count">51</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479345);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479345', targetLink: 'https://www.cnblogs.com/GroundhogKing/p/19479345', title: 'æµèç®æ³ç«èµä¸­ç»´æ¤ä¸­ä½æ°çå°æå·§' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å½æ¡å½¢å¾éä¸æåæ ï¼å¾åä¸åå½¢æ¡å½¢å¾çè§è§é©å½ ]]></title>
    <link>https://www.cnblogs.com/wang_yb/p/19479454</link>
    <guid>3df46e653b4c65413fc3368a038ee851</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/wang_yb/p/19479454" title="åå¸äº 2026-01-13 23:10">
    <span role="heading" aria-level="2">å½æ¡å½¢å¾éä¸æåæ ï¼å¾åä¸åå½¢æ¡å½¢å¾çè§è§é©å½</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ³è±¡ä¸ä¸ï¼ä½ æ­£ç«å¨ä¸ä¸ªåå½¢å¹¿åºçä¸­å¿ï¼å¨å´ååæåç12æ ¹é«åº¦ä¸åçç¯æ±ï¼è¿å°±æ¯<strong>å¾åæ¡å½¢å¾</strong>å¸¦ç»æä»¬çè§è§ä½éªã</p>
<p>å¨æ°æ®å¯è§åé¢åï¼æä»¬å¸¸å¸¸æ»¡è¶³äºä¼ ç»çç´è§åæ ç³»æ¡å½¢å¾ï¼ä½å½æ°æ®å·æå¨ææ§ææ¯è¾æ§æ¶ï¼<strong>å¾åæ¡å½¢å¾</strong>å<strong>åå½¢æ¡å½¢å¾</strong>ä¸ºæä»¬æå¼äºæ°çå¯è½æ§ã</p>
<h1 id="1-è®¾è®¡åç">1. è®¾è®¡åç</h1>
<p>è¿ä¸¤ç§å¾è¡¨æä¼ ç»ç<strong>ç¬å¡å°åæ ç³»</strong>æ¢æ<strong>æåæ ç³»</strong>ï¼è§åº¦è¡¨ç¤ºç±»å«ï¼åå¾æè§åº¦é¿åº¦è¡¨ç¤ºæ°å¼ã</p>
<h2 id="11-å¾åæ¡å½¢å¾">1.1. å¾åæ¡å½¢å¾</h2>
<p><strong>å¾åæ¡å½¢å¾</strong>æ¬è´¨ä¸æ¯å°ä¼ ç»æ¡å½¢å¾çç´è§åæ ç³»è½¬æ¢ä¸ºæåæ ç³»ã</p>
<p>å¨æåæ ç³»ä¸­ï¼æ¯ä¸ªæ°æ®ç¹ä¸åç±<code>(x, y)</code>å®ä½ï¼èæ¯ç±<strong>(è§åº¦, åå¾)</strong>ç¡®å®ï¼æ¡å½¢çé«åº¦ï¼æé¿åº¦ï¼ç±åå¾å¼è¡¨ç¤ºï¼èæ¡å½¢çæååæ²¿çåå¨æ¹åã</p>

<p><img src="https://img2024.cnblogs.com/blog/83005/202601/83005-20260113230907077-321355021.png" alt="" loading="lazy"></p>
<p><strong>è®¾è®¡çµæ</strong>ï¼å¦åéè¡¨çæéæé·è¾¾çæ«æçº¿ï¼å¾åæ¡å½¢å¾åé´äºèªç¶çåäººå·¥å¶åä¸­å¸¸è§çåå½¢å¸å±ï¼å©ç¨äºäººç±»å¯¹è§åº¦åå¯¹ç§°æ§çå¤©ç¶æç¥è½åã</p>
<h2 id="12-åå½¢æ¡å½¢å¾">1.2. åå½¢æ¡å½¢å¾</h2>
<p><strong>åå½¢æ¡å½¢å¾</strong>æ¯å¾åæ¡å½¢å¾çä¸ç§ç¹æ®å½¢å¼ï¼å®åºå®äºèµ·ç¹åç»ç¹ï¼ä½¿æææ¡å½¢é½å¨åä¸åå¨ä¸å¼å§ï¼åªå¨åå¾æ¹åä¸å»¶ä¼¸ã</p>
<p>è¿ç§è®¾è®¡è§£å³äºå®å¨å¾åå¸å±å¯è½å¯¼è´ç<strong>æ°æ®æ¯è¾å°é¾</strong>é®é¢ï¼å ä¸ºæææ¡å½¢çåºåçº¿æ¯ä¸è´çã</p>

<p><img src="https://img2024.cnblogs.com/blog/83005/202601/83005-20260113230907250-2040360098.png" alt="" loading="lazy"></p>
<p><strong>è®¾è®¡æ¯å»</strong>ï¼æ³è±¡ä¸ç»è·³é«è¿å¨åï¼ä»ä»¬é½ä»åä¸é«åº¦èµ·è·³ï¼åªæ¯è·³è·çé«åº¦ä¸åââåå½¢æ¡å½¢å¾å°±æ¯è¿æ ·å¬å¹³ç"ç«æåº"ã</p>
<h1 id="2-åºç¨ç¤ºä¾">2. åºç¨ç¤ºä¾</h1>
<p>ä¸é¢éè¿ç¤ºä¾æ¥æ¼ç¤ºè¿ä¸¤ç§å¾å¨å®éåºæ¯ä¸­çåºç¨ã</p>
<h2 id="21-å¾åæ¡å½¢å¾">2.1. å¾åæ¡å½¢å¾</h2>
<pre><code class="language-python"># --- 1. æé æµè¯æ°æ® ---
# åè®¾æä»¬æ³æ¯è¾ä¸å¹´ä¸­æ¯ä¸ªæçå¹³åéæ°´é
æä»½ = [
    "ä¸æ",
    "äºæ",
    "ä¸æ",
    "åæ",
    "äºæ",
    "å­æ",
    "ä¸æ",
    "å«æ",
    "ä¹æ",
    "åæ",
    "åä¸æ",
    "åäºæ",
]
# çææ¨¡æçéæ°´éæ°æ® (åä½: mm)
np.random.seed(42)  # ä¸ºäºç»æå¯å¤ç°
éæ°´é = np.random.uniform(30, 150, size=len(æä»½))  # éæºçæ30-150mmçæ°æ®

# --- 2. åå»ºå¾å½¢ ---
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 7), facecolor="white")

# --- 2.1 ç»å¶ä¼ ç»æ¡å½¢å¾ ---
# ... çç¥ ...

# --- 2.2 ç»å¶å¾åæ¡å½¢å¾ ---
# è®¡ç®æ¯ä¸ªæ¡å½¢çè§åº¦ä½ç½®
# ... çç¥ ...

# ä½¿ç¨æåæ å­å¾
ax2 = plt.subplot(122, projection="polar")
# å³é®ï¼è®¾ç½® 'bottom' åæ°ä¸º inner_radiusï¼è¿æ ·æ¡å½¢å°±ä» inner_radius å¼å§ç»ï¼é¿åº¦ä¸º radii
bars = ax2.bar(
    theta,
    radii,
    width=0.4,
    bottom=inner_radius,
    color="lightcoral",
    edgecolor="darkred",
    alpha=0.7,
)

# æ·»å æ°å¼æ ç­¾ (å¨æ¡å½¢åé¨ï¼é è¿å¤ä¾§)
for angle, radius, month in zip(theta, radii, æä»½):
    ax2.text(
        angle,
        inner_radius + radius / 2,
        f"{radius:.1f}",
        ha="center",
        va="center",
        fontsize=8,
        color="black",
    )

# æ·»å æä»½æ è®° (å¨æ¡å½¢å¤é¨)
# ... çç¥ ...

# --- 3. æ¾ç¤ºå¾å½¢ ---
plt.tight_layout()
plt.show()
</code></pre>
<p>è¿æ®µä»£ç é¦åçæäºæ¨¡æçæåº¦éæ°´éæ°æ®ï¼ç¶åå¨åä¸ä¸ªå¾å½¢çªå£ä¸­åå»ºäºä¸¤ä¸ªå­å¾ã</p>
<p>å·¦ä¾§æ¯ä½¿ç¨ <code>plt.bar</code> åå»ºçä¼ ç»æ¡å½¢å¾ï¼å³ä¾§æ¯ä½¿ç¨ <code>plt.subplot(..., projection='polar')</code> å <code>ax.bar</code> åå»ºçå¾åæ¡å½¢å¾ã</p>
<p><strong>å¾åæ¡å½¢å¾</strong>å©ç¨äºæåæ ç³»ï¼å°ç±»å«ï¼æä»½ï¼åå¸å¨åå¨ä¸ï¼å°æ°å¼ï¼éæ°´éï¼æ å°å°å¾åé¿åº¦ä¸ã</p>

<p><img src="https://img2024.cnblogs.com/blog/83005/202601/83005-20260113230907232-60855079.png" alt="" loading="lazy"></p>
<p><strong>å¾åæ¡å½¢å¾</strong>æ¯ä¸ç§å¨æåæ ç³»ä¸ç»å¶çå¾è¡¨ï¼å¯ä»¥æä¾æ¯ä¼ ç»æ¡å½¢å¾æ´å·è§è§å¸å¼åçæ¿ä»£æ¹æ¡ãå®éè¿å¼§é¿æ¥è¡¨ç¤ºæ°å¼ï¼å¹¶ä¸å¯ä»¥ææå°å©ç¨ç©ºé´ï¼å°¤å¶æ¯å¨å¤çç±»å«è¾å¤æéè¦å¼ºè°å¨ææ§æ¨¡å¼ï¼ä¾å¦ææä»½æå­£åº¦åç»çæ°æ®ï¼æ¶ã</p>
<h2 id="22-åå½¢æ¡å½¢å¾">2.2. åå½¢æ¡å½¢å¾</h2>
<pre><code class="language-python">from matplotlib import cm
from math import log10

labels = list("ABCDEFG")
data = [21, 57, 88, 14, 76, 91, 26]
# ... çç¥ ...

#create colors along a chosen colormap
colors = [cm.terrain(i / n) for i in range(n)]

#create figure, axis
fig, ax = plt.subplots()

#create rings of donut chart
for i in range(n):
    current_outer_radius = r - i * w
    innerring, _ = ax.pie([m - data[i], data[i]], 
                          radius = current_outer_radius, 
                          startangle = 90, 
                          colors = ["white", colors[i]])

    # æ·»å æ ç­¾
    # ... çç¥ ...

plt.show()
</code></pre>

<p><img src="https://img2024.cnblogs.com/blog/83005/202601/83005-20260113230907034-1742470964.png" alt="" loading="lazy"></p>
<p><strong>åå½¢æ¡å½¢å¾</strong>ä»åä¸åºåçº¿å¼å§ï¼é¿åäº<strong>å¾åæ¡å½¢å¾</strong>ä¸­ä¸åè§åº¦èµ·å§ç¹ä¸åçé®é¢ï¼æ´å ä¾¿äºæ¯è¾ã</p>
<h1 id="3-æ»ç»">3. æ»ç»</h1>
<p><strong>å¾åæ¡å½¢å¾</strong>å<strong>åå½¢æ¡å½¢å¾</strong>ä»£è¡¨äºæ°æ®å¯è§åä»çº¯åè½ååè½ç¾å­¦å¹³è¡¡çæ¼è¿ã</p>
<p>å®ä»¬ä¸æ¯è¦å®å¨åä»£ä¼ ç»æ¡å½¢å¾ï¼èæ¯ä¸ºæä»¬æä¾äºæ´å¤è§è§åäºçå·¥å·ã</p>
<p>å°±åä¸ä½çç»çå¨å¸æ¥æå¤ç§åå·ä¸æ ·ï¼ä¼ç§çæ°æ®åæå¸ä¹åºè¯¥ææ¡å¤ç§å¯è§åææ¯ï¼æ ¹æ®æ°æ®ç¹æ§åæ²éç®æ éæ©æåéç"åå·"ã</p>
<p>å½ä½ çæ°æ®è®²è¿°çå¨ææ§çæäºï¼æéè¦å¨æéç©ºé´åè¿è¡å¤ç»´åº¦æ¯è¾æ¶ï¼ä¸å¦¨å°è¯è¿äºåå½¢å¯è§åæ¹æ³ãå®ä»¬ä¸ä»è½æ´ææå°ä¼ è¾¾ä¿¡æ¯ï¼è¿è½ä¸ºä½ çæ¥åæä»ªè¡¨æ¿å¢æ·»ç¬ç¹çè§è§é­åã</p>
<p>æå¥½çå¯è§åä¸æ¯æå¤æçï¼èæ¯æè½æ¸æ°ä¼ è¾¾æ°æ®æäºçã</p>
<p><strong>å¾å</strong>å<strong>åå½¢æ¡å½¢å¾</strong>æ­£æ¯è¿æ ·ä¸ç§å·¥å·ï¼å¨ä¼ ç»ä¸ç°ä»£ä¹é´ï¼å¨åè½ä¸ç¾å­¦ä¹é´ï¼æ¾å°äºä¼éçå¹³è¡¡ç¹ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 23:10">2026-01-13 23:10</span>&nbsp;
<a href="https://www.cnblogs.com/wang_yb">wang_yb</a>&nbsp;
éè¯»(<span id="post_view_count">47</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479454);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479454', targetLink: 'https://www.cnblogs.com/wang_yb/p/19479454', title: 'å½æ¡å½¢å¾éä¸æåæ ï¼å¾åä¸åå½¢æ¡å½¢å¾çè§è§é©å½' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Spring çè¥¿è¥¿å¼æ¯ä¹ç³ï¼çè§£ BeanFactoryãFactoryBean ä¸ ObjectFactory ]]></title>
    <link>https://www.cnblogs.com/xzqcsj/p/19479429</link>
    <guid>5f42092059049f38cc1030daeae31568</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xzqcsj/p/19479429" title="åå¸äº 2026-01-13 22:46">
    <span role="heading" aria-level="2">Spring çè¥¿è¥¿å¼æ¯ä¹ç³ï¼çè§£ BeanFactoryãFactoryBean ä¸ ObjectFactory</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3703499/202601/3703499-20260113224556329-1020363253.png" alt="Spring çè¥¿è¥¿å¼æ¯ä¹ç³ï¼çè§£ BeanFactoryãFactoryBean ä¸ ObjectFactory" class="desc_img">
        ä»å¤©ï¼ä»£ç åæ¥éäºãæèä¹è®¸æ¯æ¨å¤©ï¼æä¸æ¸æ¥ã
ä¸ç®¡ææ ·ï¼Spring å®¹å¨æåºäºä¸ä¸ª BeanCreationExceptionãä¸ºäºè§£å³å®ï¼æè¢«è¿«æ½å¥æ¡æ¶çæ·±å¤ï¼å»æ³¨è§é£äºå¹³æ¶è¢« @Autowired æ©ççé½¿è½®ã
å¨ Spring çä¸çéï¼å­å¨çä¸ç§å¿ç¶çå¤ææ§ãè¿ç§å¤ææ§å¹¶éè®¾è®¡èçæ¶è¶£å³ï¼èæ¯ä¸ºäºå¨ä¸ä¸ªéæçè¯­è¨ä¸­æå»ºå¨æä¸çæä»åºçä»£ä»·ã
å¨è¿ä¸ªåºå¤§çæºå¨ä¸­ï¼æä¸ä¸ªåå­æå¶ç¸ä¼¼çæ¦å¿µç»å¸¸è¢«æ··æ·ï¼BeanFactoryãFactoryBean å ObjectFactoryãè¿å¹¶ä¸æ¯å½åçè´«ç ï¼èæ¯å®ä»¬å¨æ¬è´¨ä¸ç¡®å®å­å¨çå¾®å¦ççº ç¼ ã
ä»å¤©ï¼æä»¬å¥ç¦»æé£äºè±å¨çæ¯å»åæ ç¨çç³è¡£ï¼ç¨ä¸ç§å·éçãè¿ä¹è§£åå­¦çè§è§ï¼å»å®¡è§è¿ä¸ä¸ªæ¦å¿µçæ¬è´¨ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>ä»å¤©ï¼ä»£ç åæ¥éäºãæèä¹è®¸æ¯æ¨å¤©ï¼æä¸æ¸æ¥ã<br>
ä¸ç®¡ææ ·ï¼Spring å®¹å¨æåºäºä¸ä¸ª <code>BeanCreationException</code>ãä¸ºäºè§£å³å®ï¼æè¢«è¿«æ½å¥æ¡æ¶çæ·±å¤ï¼å»æ³¨è§é£äºå¹³æ¶è¢« <code>@Autowired</code> æ©ççé½¿è½®ã</p>
<p>å¨ Spring çä¸çéï¼å­å¨çä¸ç§å¿ç¶çå¤ææ§ãè¿ç§å¤ææ§å¹¶éè®¾è®¡èçæ¶è¶£å³ï¼èæ¯ä¸ºäºå¨ä¸ä¸ªéæçè¯­è¨ä¸­æå»ºå¨æä¸çæä»åºçä»£ä»·ã</p>
<p>å¨è¿ä¸ªåºå¤§çæºå¨ä¸­ï¼æä¸ä¸ªåå­æå¶ç¸ä¼¼çæ¦å¿µç»å¸¸è¢«æ··æ·ï¼<code>BeanFactory</code>ã<code>FactoryBean</code> å <code>ObjectFactory</code>ãè¿å¹¶ä¸æ¯å½åçè´«ç ï¼èæ¯å®ä»¬å¨æ¬è´¨ä¸ç¡®å®å­å¨çå¾®å¦ççº ç¼ ã</p>
<p>ä»å¤©ï¼æä»¬å¥ç¦»æé£äºè±å¨çæ¯å»åæ ç¨çç³è¡£ï¼ç¨ä¸ç§å·éçãè¿ä¹è§£åå­¦çè§è§ï¼å»å®¡è§è¿ä¸ä¸ªæ¦å¿µçæ¬è´¨ã</p>
<hr>
<h2 id="ä¸beanfactoryå­å¨çå®¹å¨">ä¸ãBeanFactoryï¼å­å¨çå®¹å¨</h2>
<p><strong>è®©æä»¬é¦åçº æ­£ä¸ä¸ªè§å¿µï¼BeanFactory åä¸ºå·¥åï¼ä½å¶æ¬è´¨æ¯å®¹å¨ï¼Containerï¼ã</strong></p>
<p>å½æä»¬è°è®º Spring å®¹å¨æ¶ï¼æä»¬å®éä¸æ¯å¨è°è®º <code>BeanFactory</code>ãå®æ¯ Spring IoC å®¹å¨çæ ¹æ¥å£ï¼æ¯æ´ä¸ªä¸ççç©çæ³åã</p>
<h3 id="11-å¯ä¸çèè´£">1.1 å¯ä¸çèè´£</h3>
<p>å®çå®ä¹æå¶åå¶ãå®ä¸å³å¿ä¸å¡é»è¾ï¼åªå³å¿ä¸ä»¶äºï¼<strong>ç®¡çå¯¹è±¡ççå½å¨æ</strong>ã</p>
<pre><code class="language-java">public interface BeanFactory {
    Object getBean(String name) throws BeansException;
    &lt;T&gt; T getBean(String name, Class&lt;T&gt; requiredType);
    boolean containsBean(String name);
    // ...
}
</code></pre>
<p>å½ä½ å¯å¨ä¸ä¸ª Spring Boot åºç¨æ¶ï¼<code>ApplicationContext</code> å°±åä¸ä¸ªåæ»¡æ´»åçåå¸ï¼è <code>BeanFactory</code> åæ¯æ¯æè¿åº§åå¸çå°ä¸ç®¡ç½ãææç BeanDefinitionï¼å³äº Bean åºè¯¥å¦ä½åå»ºçèå¾ï¼é½æ³¨åå¨è¿éã</p>
<h3 id="12-æ®é·çç°å®">1.2 æ®é·çç°å®</h3>
<p>å¨å¤§å¤æ°æåµä¸ï¼ä½ ä¸éè¦ç´æ¥ä¸ <code>BeanFactory</code> å¯¹è¯ãå ä¸º <code>ApplicationContext</code> å·²ç»ä¸ºä½ å°è£å¥½äºä¸åã<br>
ä½å½ä½ è¯å¾çè§£ä¸ºä»ä¹ä½ ç Bean æ²¡æè¢«æ­£ç¡®åå§åï¼æèä¸ºä»ä¹ä½ çå¾ªç¯ä¾èµå¤±ææ¶ï¼ä½ å°±å¿é¡»æè¯å°ï¼<strong>ä½ ææç Beanï¼é½åªæ¯ <code>BeanFactory</code> ä¸­ç entriesï¼æ¡ç®ï¼ã</strong></p>
<p>å®æ¯ä¸ä¸ªå·¨å¤§ç <code>Map&lt;String, BeanDefinition&gt;</code> å <code>Map&lt;String, Object&gt;</code> çç®¡çèãå®å·é·æ æï¼åªæç§å®ä¹çè§åï¼Scope, Lazy, Dependenceï¼æ¥å®ä¾åå¯¹è±¡ã</p>
<hr>
<h2 id="äºfactorybeanå¿è¦çæ¬ºéª">äºãFactoryBeanï¼å¿è¦çæ¬ºéª</h2>
<p>å¦æè¯´ <code>BeanFactory</code> æ¯å®è§è§åçå¶å®èï¼é£ä¹ <code>FactoryBean</code> å°±æ¯å¾®è§è§åç<strong>æ½è¡è</strong>ã</p>
<h3 id="21-éæè¯­è¨çå°å¢">2.1 éæè¯­è¨çå°å¢</h3>
<p>æ³è±¡è¿æ ·ä¸ä¸ªåºæ¯ï¼<strong>ä½ éè¦æ³¨å¥ä¸ä¸ªæ¥å£çå®ç°ï¼ä½è¿ä¸ªå®ç°ç±»å¹¶ä¸å­å¨äºä»£ç ä¸­ï¼å®æ¯éè¿å¨æä»£çå¨è¿è¡æ¶çæçã</strong><br>
è¿å¨ RPC æ¡æ¶ï¼å¦ DubboãFeignï¼å ORM æ¡æ¶ï¼å¦ MyBatisï¼ä¸­æå¶å¸¸è§ã</p>
<p>ä½ æ æ³éè¿ç®åç <code>&lt;bean class="..."&gt;</code> æ <code>@Component</code> æ¥æè¿°ä¸ä¸ªâä¸å­å¨çç±»âã<br>
è¿æ¶åï¼ä½ éè¦ä¸ä¸ªä¸­é´äººãè¿ä¸ªä¸­é´äººè¡¨é¢ä¸æ¯ä¸ä¸ªæ®éç Beanï¼ä½å®éä¸ï¼å®æ¯ä¸ä¸ªå·¥åã</p>
<h3 id="22-ä¼ªè£çèºæ¯ä»¥-mybatis-ä¸ºä¾">2.2 ä¼ªè£çèºæ¯ï¼ä»¥ MyBatis ä¸ºä¾</h3>
<p>ä¸ºä»ä¹ä½ åªéè¦åä¸ä¸ª <code>UserMapper</code> æ¥å£ï¼å°±è½ç´æ¥ <code>@Autowired</code> ä½¿ç¨ï¼<br>
å ä¸º Spring å®¹å¨éæ³¨åçé£ä¸ª "userMapper" Beanï¼æ ¹æ¬ä¸æ¯ä½ çæ¥å£å®ç°ï¼èæ¯ä¸ä¸ª <code>MapperFactoryBean</code>ã</p>
<pre><code class="language-java">// ç®åçé»è¾ç¤ºæ
public class MapperFactoryBean&lt;T&gt; implements FactoryBean&lt;T&gt; {
    
    private Class&lt;T&gt; mapperInterface;

    @Override
    public T getObject() throws Exception {
        // å¾éè·è¿ï¼æç»è¿éåçäºé­æ³ï¼éè¿ JDK å¨æä»£ççææ¥å£çå®
        return (T) Proxy.newProxyInstance(
            mapperInterface.getClassLoader(), 
            new Class[] { mapperInterface }, 
            new MapperProxy&lt;&gt;()
        );
    }

    @Override
    public Class&lt;?&gt; getObjectType() {
        return mapperInterface;
    }

    @Override
    public boolean isSingleton() {
        return true;
    }
}
</code></pre>
<h3 id="23-è¿éççç¸">2.3 è¿éççç¸</h3>
<p>å½å®¹å¨è°ç¨ <code>getBean("userMapper")</code> æ¶ï¼å®åç°è¿æ¯ä¸ä¸ª <code>FactoryBean</code>ãäºæ¯ï¼å®ä¸ä¼è¿å <code>FactoryBean</code> å®ä¾æ¬èº«ï¼èæ¯é»é»å°è°ç¨ <code>getObject()</code>ï¼å¹¶è¿åé£ä¸ªä»£çå¯¹è±¡ã</p>
<p>è¿å°±æ¯æ¬ºéªã<strong>ä½ ä»¥ä¸ºä½ æ¿å°äºä¸ä¸ª Beanï¼å¶å®ä½ æ¿å°çæ¯ Bean çäº§çäº§åã</strong></p>
<p>å¦æä½ æ¸´æçå°çç¸ï¼çå°é£ä¸ªæçºµåå¡çå¹åé»æï¼ä½ éè¦å¨ Bean åç§°åå ä¸ <code>&amp;</code>ï¼</p>
<pre><code class="language-java">// è·åçæ¯ MapperProxy ä»£çå¯¹è±¡
Object product = context.getBean("userMapper"); 

// è·åçæ¯ FactoryBean å·¥åæ¬èº«
Object factory = context.getBean("&amp;userMapper");
</code></pre>
<hr>
<h2 id="ä¸objectfactoryæ¶é´çå»¶è¿">ä¸ãObjectFactoryï¼æ¶é´çå»¶è¿</h2>
<p><code>BeanFactory</code> è´è´£ææ§ç©ºé´ï¼å®¹å¨ï¼ï¼<code>FactoryBean</code> è´è´£ææ§æé ï¼é»è¾ï¼ï¼è <code>ObjectFactory</code> åæ¯ä¸ºäºææ§<strong>æ¶é´</strong>ã</p>
<h3 id="31-å¾ªç¯çæ­»ç»">3.1 å¾ªç¯çæ­»ç»</h3>
<p>å¨ Spring çä¸çéï¼æä¸ä¸ªç»å¸çèè°¬ï¼A éè¦ Bï¼B éè¦ Aã<br>
å¦ææ¯æé å¨æ³¨å¥ï¼åªéå¦ç¶æ¿è®¤å¤±è´¥ãä½å¦ææ¯ Setter æ³¨å¥ï¼Spring è¯å¾æ½æè¿ç§æ­»ç»ã</p>
<p>å¨ A åå»ºçè¿ç¨ä¸­ï¼éè¦æ³¨å¥ BãB åå»ºæ¶ï¼åéè¦æ³¨å¥ Aã<br>
æ­¤æ¶ A è¿å¨åå»ºä¸­ï¼å°ä¸æ¯ä¸ä¸ªå®æ´ç Beanãæä¹åï¼<br>
Spring å¼å¥äºä¸çº§ç¼å­çæ¦å¿µãèç¬¬ä¸çº§ç¼å­ï¼å­æ¾çå°±æ¯ä¸ä¸ª <code>ObjectFactory</code>ã</p>
<h3 id="32-åè°çæ¬è´¨">3.2 åè°çæ¬è´¨</h3>
<p><code>ObjectFactory</code> å¨æºç ä¸­ç®åå¾ä»¤äººåæï¼</p>
<pre><code class="language-java">@FunctionalInterface
public interface ObjectFactory&lt;T&gt; {
    T getObject() throws BeansException;
}
</code></pre>
<p>å®åªæ¯ä¸ä¸ª<strong>å½æ°å¼æ¥å£</strong>ï¼ä¸ä¸ªåè°ã<br>
å®å­å¨çæä¹å¨äºï¼<strong>æç°å¨ä¸æ³è¦è¿ä¸ªå¯¹è±¡ï¼ä½ææ³è¦ä¸ä¸ªâå¨æªæ¥æä¸ªæ¶å»è½è·åè¿ä¸ªå¯¹è±¡âçè½åã</strong></p>
<p>å¨å¾ªç¯ä¾èµä¸­ï¼Spring æåæ´é²äºä¸ä¸ª <code>ObjectFactory</code>ï¼</p>
<pre><code class="language-java">addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));
</code></pre>
<p>å½ B éè¦ A æ¶ï¼å®éè¿è¿ä¸ª <code>ObjectFactory</code> æ¿å°äº A çæ©æå¼ç¨ï¼Early Referenceï¼ãå°½ç®¡ A è¿æ²¡å®å¨åå§åå¥½ï¼ä½ B å·²ç»å¯ä»¥ææå®çå¼ç¨äºãæ­»ç»è§£å¼äºã</p>
<h3 id="33-ä½ç¨åçéä½">3.3 ä½ç¨åçéä½</h3>
<p>å¦ä¸ä¸ªåºæ¯æ¯ï¼ä¸ä¸ªåä¾ï¼Singletonï¼ç Service éè¦ä½¿ç¨ä¸ä¸ª ååï¼Prototypeï¼ç Beanã<br>
å¦æä½ ç´æ¥ <code>@Autowired</code>ï¼ååç Bean åªæå¨ Service åå»ºæ¶è¢«æ³¨å¥ä¸æ¬¡ï¼ä¹åä¹å°±æ¯æ°¸è¿åä¸ä¸ªå¯¹è±¡äºãè¿è¿èäºååçåè¡·ã</p>
<p>å¦ä½è§£å³ï¼ä½¿ç¨ <code>ObjectFactory</code> å»¶è¿è·åã</p>
<pre><code class="language-java">@Service
public class ReportService {
    
    @Autowired
    private ObjectFactory&lt;ReportBuilder&gt; builderFactory;

    public void generate() {
        // æ¯æ¬¡è°ç¨ getObject()ï¼å®¹å¨é½ä¼åå»ºä¸ä¸ªå¨æ°ç ReportBuilder
        ReportBuilder builder = builderFactory.getObject();
        builder.build();
    }
}
</code></pre>
<p>å¨è¿éï¼<strong><code>ObjectFactory</code> å°±åæ¯ä¸ä¸ªéå¾å®¹å¨çå¥æï¼è®©ä½ éæ¶å¯ä»¥ä¼¸æè¿å»æ¿ä¸ä¸ªæ°çå¯¹è±¡ï¼èä¸æ¯å®çéæ§çç¼å­ã</strong></p>
<hr>
<h2 id="åå®¡å¤ä¸è£å³">åãå®¡å¤ä¸è£å³</h2>
<p>è®©æä»¬å¨æåï¼ç¨æå®¢è§çè¡¨æ ¼æ¥å®¡å¤è¿ä¸èçåºå«ãè¿ä¸æ¯ä¸ºäºèè¯µï¼èæ¯ä¸ºäºçæ¸æ··ä¹±ã</p>
<table>
<thead>
<tr>
<th style="text-align: left">ç»´åº¦</th>
<th style="text-align: left">BeanFactory</th>
<th style="text-align: left">FactoryBean</th>
<th style="text-align: left">ObjectFactory</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>å­å¨å½¢å¼</strong></td>
<td style="text-align: left"><strong>å®¹å¨</strong> (Container)</td>
<td style="text-align: left"><strong>Bean</strong> (Component)</td>
<td style="text-align: left"><strong>æ¥å£</strong> (Interface/Callback)</td>
</tr>
<tr>
<td style="text-align: left"><strong>åºå±é»è¾</strong></td>
<td style="text-align: left"><code>ApplicationContext</code> çç¶çº§æ¥å£ / <strong>å®è§å·¥å</strong></td>
<td style="text-align: left">å®ç°äº <code>FactoryBean</code> æ¥å£çç±» / <strong>å¾®è§å·¥å</strong></td>
<td style="text-align: left">å½æ°å¼æ¥å£ / <strong>å»¶è¿åè°</strong></td>
</tr>
<tr>
<td style="text-align: left"><strong>æ ¸å¿èè´£</strong></td>
<td style="text-align: left">ç®¡çææ Bean ççå½å¨æ</td>
<td style="text-align: left">æ­¤ Bean è´è´£<strong>çäº§</strong>å¦ä¸ä¸ªå¤æç Bean</td>
<td style="text-align: left">å°è£å¯¹è±¡çåå»ºè¿ç¨ï¼æä¾<strong>å»¶è¿</strong>è·åè½å</td>
</tr>
<tr>
<td style="text-align: left"><strong>è·åæ¹å¼</strong></td>
<td style="text-align: left"><code>ApplicationContext</code> æ¯å®çè¶é</td>
<td style="text-align: left"><code>getBean("name")</code> æ¿äº§å<br><code>getBean("&amp;name")</code> æ¿å·¥å</td>
<td style="text-align: left">æ³¨å¥ <code>ObjectFactory&lt;T&gt;</code> åè°ç¨ <code>getObject()</code></td>
</tr>
<tr>
<td style="text-align: left"><strong>çå®åºæ¯</strong></td>
<td style="text-align: left">Spring æ¡æ¶çåºç³</td>
<td style="text-align: left">Mybatis <code>MapperFactoryBean</code>, <code>ProxyFactoryBean</code></td>
<td style="text-align: left">è§£å³å¾ªç¯ä¾èµ(ä¸çº§ç¼å­), Scope(ååæ¨¡å¼)éé</td>
</tr>
</tbody>
</table>
<h2 id="äºç»è¯­">äºãç»è¯­</h2>
<p>å¨ä»£ç çèåä¸ï¼æä»¬éè¿æå»ºæ½è±¡æ¥å¯¹ææ··ä¹±ã</p>
<ul>
<li><strong>BeanFactory</strong> æ¯æä»¬èä¸çå¤§å°ã<strong>å®è¢«ç§°ä¸ºå·¥åï¼ä½å®å®éæ¯å­è²ä¸ç©çåå£¤ï¼å®¹å¨ï¼ã</strong></li>
<li><strong>FactoryBean</strong> æ¯æä»¬æä¸­çç²¾å¯æºåºã<strong>å®æ¯ä¸ä¸ªç¹æ®ç Beanï¼å­å¨çç®çå´æ¯ä¸ºäºå¶é å¦ä¸ä¸ª Beanã</strong></li>
<li><strong>ObjectFactory</strong> æ¯æä»¬é¢ççæ¶é´è¶åã<strong>å®åªæ¯ä¸ä¸ªåçº¯çæ¥å£ï¼ä¸ºäºåºå¯¹å¾ªç¯ä¸æªæ¥çä¸ç¡®å®æ§ã</strong></li>
</ul>
<p>çè§£å®ä»¬ï¼å¹¶ä¸æ¯ä¸ºäºéè¿é¢è¯ï¼èæ¯ä¸ºäºå¨ä¸ä¸æ¬¡æåºå¼å¸¸æ¶ï¼ä½ è½å·éå°åè§å æ ä¿¡æ¯ï¼ç¥éæºå¨çåªä¸ªé½¿è½®åçäºéä½ã</p>
<p>æ¢ç¶æä»¬éæ©äºä¸æºå¨å±èï¼å°±å¿é¡»çè§£æºå¨çé»è¾ãè¿æè®¸å°±æ¯ä½ä¸ºå¼åèçè¥¿è¥¿å¼æ¯å¼å½è¿ââ<strong>æä»¬éè¦ä¸æ¬¡åä¸æ¬¡å°å°å·¨ç³æ¨åå±±é¡¶ï¼ä»¥æ­¤è¯ææä»¬å¯¹è¿ä¸ªåºå¤§ç³»ç»çææ§</strong>ã</p>
<blockquote>
<p><strong>æ¬æéè¿ AI æ¶¦è²ï¼å ç¼ªé£æ ¼ï¼ï¼è¯å¾ä»¥ä¸ç§å·éãå®¢è§çè³å­å¨ä¸»ä¹çè§è§ï¼å»è§£æè¿äºå¨æ¥å¸¸ Coding ä¸­è¢«æä»¬ä¹ ä»¥ä¸ºå¸¸çæ¦å¿µãå¸æè¿ç§ç¬ç¹çåäºé£æ ¼ï¼è½è®©ä½ å¯¹è¿äºæ¯ç¥çææ¯æ¦å¿µææ´æ·±å»çâå­å¨æâã</strong></p>
</blockquote>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 22:47">2026-01-13 22:46</span>&nbsp;
<a href="https://www.cnblogs.com/xzqcsj">ä¸æäºº</a>&nbsp;
éè¯»(<span id="post_view_count">77</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479429);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479429', targetLink: 'https://www.cnblogs.com/xzqcsj/p/19479429', title: 'Spring çè¥¿è¥¿å¼æ¯ä¹ç³ï¼çè§£ BeanFactoryãFactoryBean ä¸ ObjectFactory' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºï¼èªç¶è¯­è¨å¤ç  ç¬¬ä¸å¨ï¼å¾ªç¯ç¥ç»ç½ç» ï¼ä¸ï¼åå RNN ä¸æ·±å± RNN ]]></title>
    <link>https://www.cnblogs.com/Goblinscholar/p/19479253</link>
    <guid>837c20fdbd1f629c1bd95d615a2a784e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Goblinscholar/p/19479253" title="åå¸äº 2026-01-13 22:37">
    <span role="heading" aria-level="2">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºï¼èªç¶è¯­è¨å¤ç  ç¬¬ä¸å¨ï¼å¾ªç¯ç¥ç»ç½ç» ï¼ä¸ï¼åå RNN ä¸æ·±å± RNN</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ­¤åç±»ç¨äºè®°å½å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨çå­¦ä¹ ç¬è®°ã<br>
è¯¾ç¨ç¸å³ä¿¡æ¯é¾æ¥å¦ä¸ï¼</p>
<ol>
<li>åè¯¾ç¨è§é¢é¾æ¥ï¼<a href="https://www.bilibili.com/video/BV1FT4y1E74V?buvid=XU762317353676D786954061C192FE625463B&amp;from_spmid=playlist.playlist-detail.0.0&amp;is_story_h5=false&amp;mid=zqernykrmpf7XfIorMR%2FnA%3D%3D&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=ce0bc526-db69-428a-962e-c65ed8c267bc&amp;share_source=COPY&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1713085655&amp;unique_k=DfBgvFW&amp;up_id=8654113&amp;vd_source=e035e9878d32f414b4354b839a4c31a4" target="_blank" rel="noopener nofollow">[åè¯­å­å¹]å´æ©è¾¾æ·±åº¦å­¦ä¹ deeplearning.ai</a></li>
<li>githubè¯¾ç¨èµæï¼å«è¯¾ä»¶ä¸ç¬è®°:<a href="https://github.com/robbertliu/deeplearning.ai-andrewNG" target="_blank" rel="noopener nofollow">å´æ©è¾¾æ·±åº¦å­¦ä¹ æå­¦èµæ</a></li>
<li>è¯¾ç¨éå¥ç»ä¹ ï¼ä¸­è±ï¼ä¸ç­æ¡ï¼<a href="https://blog.csdn.net/u013733326/article/details/79827273" target="_blank" rel="noopener nofollow">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾åä¹ é¢ä¸ç­æ¡</a></li>
</ol>
<p>æ¬ç¯ä¸ºç¬¬äºè¯¾çç¬¬ä¸å¨åå®¹ï¼<a href="https://www.bilibili.com/video/BV1FT4y1E74V?spm_id_from=333.788.videopod.episodes&amp;vd_source=e035e9878d32f414b4354b839a4c31a4&amp;p=161" target="_blank" rel="noopener nofollow">1.11</a>å°<a href="https://www.bilibili.com/video/BV1FT4y1E74V?spm_id_from=333.788.videopod.episodes&amp;vd_source=e035e9878d32f414b4354b839a4c31a4&amp;p=162" target="_blank" rel="noopener nofollow">1.12</a>çåå®¹ï¼åæ¶ä¹æ¯æ¬å¨çè®ºé¨åçæåä¸ç¯ã</p>
<hr>
<p>æ¬å¨ä¸ºç¬¬äºè¯¾çç¬¬ä¸å¨åå®¹ï¼ä¸ CV ç¸å¯¹åºçï¼è¿ä¸è¯¾ææåå®¹çä¸­å¿åªæä¸ä¸ªï¼<strong>èªç¶è¯­è¨å¤çï¼Natural Language Processingï¼NLPï¼</strong>ã<br>
åºç¨å¨æ·±åº¦å­¦ä¹ éï¼å®æ¯ä¸é¨ç¨æ¥è¿è¡<strong>ææ¬ä¸åºåä¿¡æ¯å»ºæ¨¡</strong>çæ¨¡ååææ¯ï¼æ¬è´¨ä¸æ¯å¨å¨è¿æ¥ç½ç»ä¸ç»è®¡è¯­è¨æ¨¡ååºç¡ä¸çä¸æ¬¡âç»æåç¹åâï¼ä¹æ¯äººå·¥æºè½ä¸­<strong>æè´´è¿äººç±»æç»´è¡¨è¾¾æ¹å¼</strong>çéè¦ç ç©¶æ¹åä¹ä¸ã<br>
<strong>è¿ä¸æ´èè¯¾åæ ·æ¶åå¤§ééè¦åå¤æ¶åçåå®¹ï¼æ¨ªè·¨æºå¨å­¦ä¹ ãæ¦çç»è®¡ãçº¿æ§ä»£æ°ä»¥åè¯­è¨å­¦ç´è§ã</strong><br>
è¯­è¨ä¸åå¾åé£æ ·âç´è§å¯è§âï¼æ´å¤æ¯æ½è±¡ç¬¦å·ä¸ä¸ä¸æå³ç³»çç»åï¼å æ­¤<strong>çè§£é¨æ§åèæ´é«</strong>ã<br>
å æ­¤ï¼æåæ ·ä¼å°½éè¡¥è¶³å¿è¦çèæ¯ç¥è¯ï¼å°½å¯è½ç¨æ¯å»åå®ä¾éä½çè§£é¾åº¦ã<br>
æ¬ç¯çåå®¹å³äº<strong>åå RNN ä¸æ·±å± RNN</strong>ï¼æ¯å¯¹åºç¡ RNN ç»æçä¸äºè¡¥åã</p>
<h1 id="1-åå-rnnbidirectional-rnn">1. åå RNNï¼Bidirectional RNNï¼</h1>
<p>å¨åé¢å¯¹ <strong><a href="https://www.cnblogs.com/Goblinscholar/p/19449622" target="_blank">RNN</a>ã<a href="https://www.cnblogs.com/Goblinscholar/p/19463351" target="_blank">GRU</a> ä¸ <a href="https://www.cnblogs.com/Goblinscholar/p/19474433" target="_blank">LSTM</a></strong> çè®¨è®ºä¸­ï¼æä»¬å§ç»é»è®¤äºä¸ä¸ªåæï¼<strong>åºååªè½æ²¿æ¶é´è½´ååå±å¼ï¼æ¨¡åå¨å½åæ¶å»åªè½å©ç¨å·²ç»åºç°çåå²ä¿¡æ¯ã</strong></p>
<p>è¿ç§è®¾å®å¨ä¸äºç®åä»»å¡ä¸­æ¯åççï¼ä½å¨å¤§é<strong>åºåçè§£ä¸æ æ³¨ä»»å¡</strong>ä¸­ï¼å´éèçä¸ä¸ªç»ææ§éå¶ï¼  <strong>å½åæ¶å»çè¯­ä¹æç¶æï¼å¾å¾åæ¶ä¾èµäºè¿å»åæªæ¥çä¸ä¸æä¿¡æ¯ã</strong><br>
ä¸¾ä¸ªè¯¾ç¨éçä¾å­ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260113211513804-150472822.png" alt="image.png" loading="lazy"><br>
äºæ¯ï¼é®é¢åºç°äºï¼<strong>å¦ææªæ¥ä¿¡æ¯ææ¯å¤å®å½åç¶æçéè¦ä¾æ®ï¼è¯¥æä¹åï¼</strong></p>
<p>æ­£æ¯å¨è¿æ ·çèæ¯ä¸ï¼<strong>åå RNNï¼Bidirectional Recurrent Neural Networksï¼</strong> è¢«æåºã<br>
æ©å¨ <strong>1997 å¹´</strong>ï¼<strong><a href="https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&amp;arnumber=650093" target="_blank" rel="noopener nofollow">Bidirectional Recurrent Neural Networks</a></strong> è¿ç¯è®ºæä¸­å°±æåºï¼å¯¹äºåºåæ æ³¨ä¸æ´ä½çè§£ä»»å¡ï¼ä»ä¾èµè¿å»ä¸ä¸æä¼é æä¿¡æ¯å©ç¨ä¸çåå¤©ä¸è¶³ï¼å æ­¤æå¿è¦å¨æ¨¡åç»æå±é¢<strong>åæ¶å»ºæ¨¡æ­£åä¸ååçæ¶é´ä¾èµå³ç³»</strong>ã</p>
<p>éè¦å¼ºè°çæ¯ï¼åå RNN å¹¶ä¸æ¯ä¸ç§æ°çå¾ªç¯ååè®¾è®¡ã<br>
å®å¹¶ä¸æ¹å RNNãLSTM æ GRU åé¨çè®¡ç®å½¢å¼ï¼èæ¯éè¿å¨æ¶é´ç»´åº¦ä¸å¼å¥<strong>ååä¸ååä¸¤æ¡ç¬ç«çç¶æä¼ æ­é¾è·¯</strong>ï¼ä½¿æ¨¡åå¨æ¯ä¸ä¸ªæ¶é´æ­¥é½è½å¤èå<strong>åå²ä¸æªæ¥çä¸ä¸æä¿¡æ¯</strong>ã</p>
<p>ä¹æ­£å ä¸ºè¿ç§âç»æç¬ç«äºååâçç¹æ§ï¼åå RNN å¯ä»¥èªç¶å°ä¸ LSTMãGRU ç»åï¼å½¢æ <strong>Bi-LSTMãBi-GRU</strong>ï¼æä¸ºæåä¸ä¸æå»ºæ¨¡è½åçæ åéç½®ã</p>
<p>å®çå®ç°é»è¾å¹¶ä¸å¤æï¼è¿éå¼ç¨ä¸å¼ æ¯è¾æ¸æ°ææçä¼ æ­å¾ï¼ï¼<a href="https://medium.com/@fraidoonomarzai99/bidirectional-rnn-in-depth-1efd32c3cf46" target="_blank" rel="noopener nofollow">åºå¤</a>ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260113211514563-1603287401.png" alt="image.png" loading="lazy"><br>
è¿æ ·ï¼ä½ å°±ä¼åç°ï¼åä¸åºåè¢« <strong>æ­£åï¼èè²ï¼</strong> å <strong>ååï¼ç»¿è²ï¼</strong> ä¸¤æ¡ RNN åæ¶å»ºæ¨¡ï¼æ¯ä¸ªæ¶é´æ­¥ <span class="math inline">\(t\)</span> é½è½âçå°âæ­£åçåå²ä¸ä¸æåååçæªæ¥ä¸ä¸æï¼æç»è¾åº <span class="math inline">\(\hat y^{\langle t\rangle}\)</span> ç±ä¸¤ä¸ªæ¹åçä¿¡æ¯å±åå³å®ã</p>
<p></p><div class="math display">\[h^{(t)}
=
\operatorname{concat}\!\left(
\overrightarrow{{h}^{(t)}},
\overleftarrow{{h}^{(t)}}
\right)
\quad \text{or} \quad
\overrightarrow{{h}^{(t)}} + \overleftarrow{{h}^{(t)}}
\]</div><p></p><p>å¨å®è·µä¸­ï¼åå RNN æ´å¸¸éç¨<strong>æ¼æ¥æ¹å¼</strong>ä¿çæ¥èªä¸¤ä¸ªæ¶é´æ¹åçå®æ´ä¿¡æ¯ï¼è<strong>éåç´ ç¸å </strong>åæ¯ä¸ç§æ´ç´§åãä½è¡¨è¾¾è½ååéçæä¸­éæ©ã</p>
<p>æåï¼åæä¸ªæ¯æ¹ï¼æåºåæ¯ä½ä¸åº§<strong>è¦å»ºçæ¡¥</strong>ï¼åå RNN å°±åæ¯ä¸¤éå·¥äººä»ä¸¤ä¾§åæ¶æ½å·¥å¹¶ä¸æ­äº¤æµè¿åº¦ï¼ç¡®ä¿ç²¾åï¼ä½åæ¶ï¼æ½å·¥éä¼ç¿»åï¼æ´ä½ææ¬ä¹éä¹ä¸åã<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260113211553645-1826290875.png" alt="image.png" loading="lazy"></p>
<h1 id="2-æ·±å±-rnn">2. æ·±å± RNN</h1>
<p>æ·±å± RNN çæ¦å¿µåæ ·ä¸é¾çè§£ã<br>
å¨æå¼å§å¼å¥ <strong><a href="https://www.cnblogs.com/Goblinscholar/p/19449622" target="_blank">å¾ªç¯ç¥ç»ç½ç»</a></strong> æ¶ï¼æä»¬è¯´æè¿ï¼é»è®¤ä½¿ç¨<strong>åå± RNN</strong> æ¥è¿è¡æ¼ç¤ºï¼<br>
å¨æ¯ä¸ä¸ªæ¶é´æ­¥ <span class="math inline">\(t\)</span>ï¼è¾å¥ <span class="math inline">\(x^{(t)}\)</span> ç»è¿ä¸æ¬¡å¾ªç¯è®¡ç®ï¼å¾å°å¯¹åºçéèç¶æ <span class="math inline">\(a^{(t)}\)</span>ï¼å¹¶æ²¿æ¶é´è½´ä¸æ­ä¼ éã</p>
<p>ä½ä»æ¨¡åè¡¨è¾¾è½åçè§åº¦æ¥çï¼è¿ç§ç»æå­å¨éå¶ï¼<strong>æ¯ä¸ªæ¶é´æ­¥åé¨ï¼åªè¿è¡äºä¸æ¬¡éçº¿æ§åæ¢ã</strong><br>
è¿æå³çï¼æ è®ºåºåæ¬èº«æå¤å¤æï¼å¨âåä¸æ¶å»âå¯¹è¾å¥ä¿¡æ¯çå¤çæ·±åº¦é½æ¯æéçã<br>
å°è¿éï¼å°±åä¹åçå¨è¿æ¥ãå·ç§¯ç½ç»ç¸éäºï¼<br>
<strong>å¦ææä»¬å¸ææ¨¡åå¨æ¯ä¸ä¸ªæ¶é´æ­¥ä¸ï¼ä¹å·å¤ç±»ä¼¼æ·±åº¦åé¦ç½ç»ãå·ç§¯ç½ç»é£æ ·çå±çº§è¡¨è¾¾è½åï¼è¯¥æä¹åï¼</strong><br>
ç­æ¡èªç¶å°±æ¯ï¼<strong>å¨æ¶é´ç»´åº¦ä¹å¤ï¼åå¼å¥å±çº§ç»´åº¦ã</strong></p>
<p>å¨æ·±å± RNN ä¸­ï¼å¾ªç¯ç»æä¸ååªæä¸å±ï¼èæ¯<strong>å¨åä¸æ¶é´æ­¥ä¸å å å¤å± RNN åå</strong>ã<br>
å®çä¼ æ­å¾æ¯è¿æ ·çï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260113211513339-2004923823.png" alt="image.png" loading="lazy"><br>
å³äºæ·±åº¦çé»è¾åä¹åé½æ¯ç¸åçï¼æ·±å± RNN éè¿å¨åä¸æ¶é´æ­¥ä¸çå å ï¼è®©æ¨¡åå¯ä»¥è¿è¡æ´å¤æçéçº¿æ§åæ¢ï¼<strong>å¢å¼ºäºå¶è¡¨è¾¾è½å</strong>ãä½åæ ·ä¹ä¼å¢å è®¡ç®ææ¬ï¼<strong>å¸¦æ¥æ¢¯åº¦é®é¢ä¸è¿æåé£é©</strong>ï¼è¿äºé½æ¯æä»¬çèçå¸¸è°äºã</p>
<p>äºæ­¤åæ¶ï¼ååå RNN ç±»ä¼¼ï¼<strong>æ·±å±ç»æåæ ·ç¬ç«äºå·ä½çå¾ªç¯ååè®¾è®¡</strong>ã  èä¸å¨å·¥ç¨å®è·µä¸­ï¼<strong>æ·±åº¦ãæ¹åæ§åé¨æ§æºå¶å¾å¾æ¯å¯ä»¥åæ¶å å ç</strong>ï¼ä¾å¦ï¼</p>
<ul>
<li>å¤å± Bi-LSTM</li>
<li>å¤å± Bi-GRU</li>
</ul>
<p>æä»¬æåä¸ªç»ä»¶ç»åæåæ°ï¼ä¾¿å½¢æäºæ·±åº¦å­¦ä¹  NLP ä¸­çº·ç¹å¤æçè¯¸å¤æ¨¡åã</p>
<p>æåï¼å¦æç»§ç»­æ²¿ç¨åé¢çæ¯å»ï¼<br>
<strong>åå RNN</strong> åæ¯ä»æ¡¥çä¸¤ç«¯åæ¶æ½å·¥ã<br>
é£ä¹ <strong>æ·±å± RNN</strong> æ´åæ¯ï¼ æ¯ä¸ä¸ªæ½å·¥ç¹ä¸ï¼ä¸åªæ¯éºä¸å±è·¯é¢ï¼èæ¯<strong>ä¸å±å±æå°åºãå ç»æãåéºè¡¨å±ã</strong> è¿æ ·ç»ææ´ç¨³ãè¡¨è¾¾æ´å¼ºï¼ä½æ½å·¥æµç¨æ´å¤æï¼ææ¬åè®­ç»é¾åº¦ä¹éä¹ä¸åã<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202601/3708248-20260113211517590-653078512.png" alt="image.png" loading="lazy"></p>
<h1 id="3æ»ç»">3.æ»ç»</h1>
<table>
<thead>
<tr>
<th>æ¦å¿µ</th>
<th>åç</th>
<th>æ¯å»</th>
</tr>
</thead>
<tbody>
<tr>
<td>åå RNNï¼Bidirectional RNNï¼</td>
<td>å¨æ¶é´ç»´åº¦ä¸å¼å¥<strong>æ­£ååååä¸¤æ¡ç¬ç«ç¶æé¾è·¯</strong>ï¼æ¯ä¸ªæ¶é´æ­¥åæ¶å©ç¨è¿å»åæªæ¥ä¸ä¸æä¿¡æ¯ãéç¨äºåºåæ æ³¨ä¸æ´ä½çè§£ä»»å¡ãå¯ä»¥ä¸ RNN/LSTM/GRU ç»åï¼å½¢æ Bi-RNNãBi-LSTMãBi-GRUã</td>
<td>åºåæ¯ä½æ¡¥ï¼ä¸¤éå·¥äººä»ä¸¤ç«¯åæ¶æ½å·¥å¹¶äº¤æµè¿åº¦ï¼ç¡®ä¿ç²¾åï¼ä½æ½å·¥éä¼ç¿»åï¼ææ¬å¢å ã</td>
</tr>
<tr>
<td>æ·±å± RNNï¼Deep RNNï¼</td>
<td>å¨åä¸æ¶é´æ­¥ä¸<strong>å å å¤å± RNN åå</strong>ï¼å¢å æ¯ä¸ªæ¶é´æ­¥åé¨çéçº¿æ§è¡¨è¾¾è½åï¼ä»èå¢å¼ºæ¨¡åçè¡¨ç¤ºè½åãå¯ä¸é¨æ§æºå¶åååç»æå å ï¼å½¢æå¤å± Bi-LSTMãBi-GRU ç­ã</td>
<td>æ¯ä¸ªæ½å·¥ç¹ä¸ä¸æ¯åªéºä¸å±è·¯é¢ï¼èæ¯<strong>ä¸å±å±æå°åºãå ç»æãåéºè¡¨å±</strong>ï¼ç»ææ´ç¨³ãè¡¨è¾¾æ´å¼ºï¼ä½æ½å·¥æµç¨å¤æï¼ææ¬åè®­ç»é¾åº¦å¢å ã</td>
</tr>
</tbody>
</table>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 22:37">2026-01-13 22:37</span>&nbsp;
<a href="https://www.cnblogs.com/Goblinscholar">å¥å¸æå­¦è</a>&nbsp;
éè¯»(<span id="post_view_count">24</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479253);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479253', targetLink: 'https://www.cnblogs.com/Goblinscholar/p/19479253', title: 'å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºï¼èªç¶è¯­è¨å¤ç  ç¬¬ä¸å¨ï¼å¾ªç¯ç¥ç»ç½ç» ï¼ä¸ï¼åå RNN ä¸æ·±å± RNN' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ synchronizedå³é®å­ç¸å³ ]]></title>
    <link>https://www.cnblogs.com/xi-yongqi/p/19479394</link>
    <guid>478f0dee31a30b459b4667c9d97a16b7</guid>
    <description>
    <![CDATA[ 
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xi-yongqi/p/19479394" title="åå¸äº 2026-01-13 22:24">
    <span role="heading" aria-level="2">synchronizedå³é®å­ç¸å³</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h5 id="synchronizedæ¯javaä¸­ç¨äºè§£å³å¹¶åé®é¢çæ ¸å¿å³é®å­å®éè¿ç¡®ä¿å¤ä¸ªçº¿ç¨å¯¹å±äº«èµæºçäºæ¥è®¿é®æ¥é¿åçº¿ç¨å®å¨é®é¢å¦ç«ææ¡ä»¶æ°æ®ä¸ä¸è´ç­">synchronizedæ¯Javaä¸­ç¨äºè§£å³å¹¶åé®é¢çæ ¸å¿å³é®å­ï¼å®éè¿ç¡®ä¿å¤ä¸ªçº¿ç¨å¯¹å±äº«èµæºçäºæ¥è®¿é®ï¼æ¥é¿åçº¿ç¨å®å¨é®é¢ï¼å¦ç«ææ¡ä»¶ãæ°æ®ä¸ä¸è´ç­ï¼ã</h5>
<h4 id="synchronizedçæ ¸å¿ç¹æ§">synchronizedçæ ¸å¿ç¹æ§</h4>
<ul>
<li>åå­æ§ï¼Atomicityï¼ï¼ç¡®ä¿ä¸ä¸ªæå¤ä¸ªæä½è¦ä¹å¨é¨æ§è¡æåï¼è¦ä¹å¨é¨æ§è¡å¤±è´¥ãå¨synchronizedä»£ç åä¸­çä»£ç æ¯ä¸å¯ä¸­æ­çï¼åä¸æ¶å»åªæä¸ä¸ªçº¿ç¨è½æ§è¡ã</li>
<li>å¯è§æ§ï¼Visibilityï¼ï¼ä¿è¯ä¸ä¸ªçº¿ç¨å¯¹å±äº«åéçä¿®æ¹ï¼å¯¹äºå¶ä»åç»­è¿å¥åæ­¥ä»£ç åççº¿ç¨æ¯å¯è§çãå½çº¿ç¨éæ¾éæ¶ï¼ä¼å°ç§æåå­ä¸­çåéå¼å·æ°åä¸»åå­ã</li>
<li>æåºæ§ï¼Orderingï¼ï¼è½ç¶ç¼è¯å¨åå¤çå¨ä¸ºäºä¼åä¼è¿è¡æä»¤éæï¼ä½synchronizedå¯ä»¥ä¿è¯å¤çº¿ç¨ç¨åºå¨é»è¾ä¸çæ§è¡é¡ºåºï¼å³âåæ­¥ååçä»£ç å¨æ§è¡ä¸å·æååé¡ºåºâã</li>
<li>å¯éå¥æ§ï¼å¯éå¥æ§æ¯æä¸ä¸ªçº¿ç¨å·²ç»è·åå°æä¸ªéåï¼åæ¬¡è¯·æ±è¯¥éæ¶å¯ä»¥ç´æ¥è·åï¼æ ééæ°ç«äºãsynchronizedæ¯å¯éå¥éï¼å¶åé¨éè¿è®¡æ°å¨è®°å½éçæææ¬¡æ°ï¼åå§ä¸º0ï¼è·åéæ¶å 1ï¼éæ¾éæ¶å1ï¼è®¡æ°å¨ä¸º0æ¶éæè¢«çæ­£éæ¾ï¼ãè¿ä¸ç¹æ§é¿åäºçº¿ç¨å¨éå½è°ç¨åæ­¥æ¹æ³/ä»£ç åæ¶åºç°æ­»éãä¾å¦ï¼ä¸ä¸ªåæ­¥æ¹æ³Aè°ç¨å¦ä¸ä¸ªåæ­¥æ¹æ³Bï¼ä¸¤èéå¯¹è±¡ç¸åï¼ï¼çº¿ç¨è·åAçéåï¼è°ç¨Bæ¶å¯ç´æ¥è·åéã</li>
</ul>
<h4 id="synchronizedçä½¿ç¨æ¹å¼">synchronizedçä½¿ç¨æ¹å¼</h4>
<h5 id="synchronizedçä½¿ç¨çµæ´»å¯ä¿®é¥°ä¸åçä»£ç ç»ææ ¸å¿æ¯æç¡®éå¯¹è±¡çº¿ç¨ç«äºçæ¯éå¯¹è±¡åªæè·åå°éå¯¹è±¡ççº¿ç¨æè½æ§è¡åæ­¥ä»£ç å¸¸è§ä½¿ç¨æ¹å¼æ3ç§">synchronizedçä½¿ç¨çµæ´»ï¼å¯ä¿®é¥°ä¸åçä»£ç ç»æï¼æ ¸å¿æ¯æç¡®âéå¯¹è±¡âââçº¿ç¨ç«äºçæ¯éå¯¹è±¡ï¼åªæè·åå°éå¯¹è±¡ççº¿ç¨æè½æ§è¡åæ­¥ä»£ç ï¼å¸¸è§ä½¿ç¨æ¹å¼æ3ç§ã</h5>
<ol>
<li>ä¿®é¥°å®ä¾æ¹æ³ï¼å¯¹è±¡éï¼ï¼è¯­æ³ï¼<code>public synchronized void methodName() { ... }</code></li>
</ol>
<ul>
<li>éå¯¹è±¡ï¼å½åç±»çå®ä¾å¯¹è±¡ï¼thisï¼ã</li>
<li>ç¹ç¹ï¼ä¸åå®ä¾å¯¹è±¡çéç¸äºç¬ç«ï¼å³å¤ä¸ªçº¿ç¨è®¿é®åä¸ä¸ªå®ä¾çåæ­¥å®ä¾æ¹æ³æ¶ä¼ç«äºéï¼è®¿é®ä¸åå®ä¾çåæ­¥å®ä¾æ¹æ³æ¶ï¼å éå¯¹è±¡ä¸åï¼ä¸ä¼ç«äºã</li>
<li>ç¤ºä¾ï¼åä¸Userå®ä¾çadd()æ¹æ³è¢«å¤çº¿ç¨è°ç¨æ¶äºæ¥ï¼ä¸åUserå®ä¾çadd()æ¹æ³å¯å¹¶è¡æ§è¡ã</li>
</ul>
<ol start="2">
<li>ä¿®é¥°éææ¹æ³ï¼ç±»éï¼è¯­æ³ï¼<code>public static synchronized void methodName() { ... }</code></li>
</ol>
<ul>
<li>éå¯¹è±¡ï¼å½åç±»çClasså¯¹è±¡ï¼æ¯ä¸ªç±»å¨JVMä¸­åªæä¸ä¸ªClasså¯¹è±¡ï¼æ¯å¨å±å¯ä¸çï¼ã</li>
<li>ç¹ç¹ï¼ç±»éæ¯å¨å±éï¼æ è®ºåå»ºå¤å°ä¸ªç±»çå®ä¾ï¼ææçº¿ç¨è®¿é®è¯¥ç±»çåæ­¥éææ¹æ³æ¶ï¼é½ä¼ç«äºåä¸ä¸ªClasså¯¹è±¡éã</li>
<li>æ³¨æï¼ç±»éä¸å¯¹è±¡éç¸äºç¬ç«ï¼å³åæ­¥éææ¹æ³ååæ­¥å®ä¾æ¹æ³çéå¯¹è±¡ä¸åï¼çº¿ç¨è®¿é®æ¶ä¸ä¼ç«äºã</li>
</ul>
<ol start="3">
<li>ä¿®é¥°ä»£ç åï¼èªå®ä¹éå¯¹è±¡ï¼ï¼è¯­æ³ï¼<code>synchronized (éå¯¹è±¡) { ... åæ­¥ä»£ç  ... }</code></li>
</ol>
<ul>
<li>éå¯¹è±¡ï¼å¯èªå®ä¹ï¼æ¯æä¸¤ç§ç±»åï¼â  å®ä¾å¯¹è±¡ï¼thisæå¶ä»å®ä¾ï¼ï¼â¡ Classå¯¹è±¡ï¼ç±»å.classï¼ã</li>
<li>ç¹ç¹ï¼ç²åº¦æç»ï¼å¯ç²¾åæ§å¶éè¦åæ­¥çä»£ç çæ®µï¼èéæ´ä¸ªæ¹æ³ï¼ï¼åå°éç«äºï¼æé«ç¨åºæ§è½ã</li>
<li>å¸¸è§åºæ¯ï¼
<ul>
<li>éå½åå®ä¾ï¼<code>synchronized (this) { ... }</code>ï¼ææä¸ä¿®é¥°å®ä¾æ¹æ³ä¸è´ï¼ä½ä»åæ­¥ä»£ç ååçé»è¾ã</li>
<li>éClasså¯¹è±¡ï¼<code>synchronized (User.class) { ... }</code>ï¼ææä¸ä¿®é¥°éææ¹æ³ä¸è´ã</li>
<li>éèªå®ä¹å¯¹è±¡ï¼<code>private Object lock = new Object(); synchronized (lock) { ... }</code>ï¼éè¿ç¬ç«çéå¯¹è±¡ï¼é¿åä¸å¶ä»åæ­¥é»è¾ç«äºéï¼çµæ´»æ§æé«ã</li>
</ul>
</li>
</ul>
<h4 id="synchronizedçéæºå¶">synchronizedçéæºå¶</h4>
<ul>
<li>Java 6åä»¥åå¯¹synchronizedè¿è¡äºå¤§å¹ä¼åï¼å¼å¥äºâååéãè½»éçº§éãééçº§éâä¸ç§éç¶æï¼ç®çæ¯æ ¹æ®çº¿ç¨ç«äºçæ¿çç¨åº¦å¨æåæ¢éç¶æï¼å¹³è¡¡æ§è½ä¸çº¿ç¨å®å¨ãéæºå¶çæ ¸å¿æ¯âå¯¹è±¡å¤´âââJavaå¯¹è±¡å¨åå­ä¸­çå¸å±åæ¬å¯¹è±¡å¤´ãå®ä¾æ°æ®ãå¯¹é½å¡«åï¼å¶ä¸­å¯¹è±¡å¤´å­å¨äºéçç¶æä¿¡æ¯ï¼Mark Wordï¼ãç±»åæ°æ®æéç­ã</li>
<li>ä¸ç§éç¶æçä¼åçº§ï¼æ é &lt; ååé &lt; è½»éçº§é &lt; ééçº§éï¼éççº¿ç¨ç«äºçå å§ï¼éä¼ä»ä½çº§å«åé«çº§å«åçº§ï¼ä¸åçº§è¿ç¨ä¸å¯éï¼ä¸æ¦åçº§ä¸ºééçº§éï¼æ æ³åéä¸ºè½»éçº§éæååéï¼ã
<ul>
<li>æ éï¼No Lockï¼ï¼åå§ç¶æã</li>
<li>ååéï¼Biased Lockï¼ï¼å½åªæä¸ä¸ªçº¿ç¨è®¿é®åæ­¥åæ¶ï¼ç´æ¥å¨å¯¹è±¡å¤´è®°å½çº¿ç¨IDï¼ä¸æ¬¡è¯¥çº¿ç¨è¿å¥æ¶æ éCASæä½ï¼æ§è½æé«ã</li>
<li>è½»éçº§éï¼Lightweight Lockï¼ï¼å½åºç°ç«äºï¼ä½ç«äºä¸æ¿çæ¶ï¼éè¿CASèªææ¥å°è¯è·åéï¼é¿åçº¿ç¨é»å¡ã</li>
<li>ééçº§éï¼Heavyweight Lockï¼ï¼å½èªæè¶è¿ä¸å®æ¬¡æ°æç«äºéå¸¸æ¿çæ¶ï¼åçº§ä¸ºééçº§éãæ­¤æ¶æªè·åå°éççº¿ç¨ä¼è¿å¥é»å¡ï¼Blockedï¼ç¶æï¼äº¤ç»æä½ç³»ç»ç®¡çã</li>
</ul>
</li>
</ul>
<h5 id="éä¼åè¡¥å">éä¼åè¡¥å</h5>
<ul>
<li><strong>éæ¶é¤</strong>ï¼JVMçå³æ¶ç¼è¯å¨ï¼JITï¼å¨è¿è¡æ¶ï¼ä¼å¯¹ä¸äºâä¸å¯è½å­å¨ç«äºçéâè¿è¡æ¶é¤ãä¾å¦ï¼å±é¨åéä½ä¸ºéå¯¹è±¡ï¼æ¯ä¸ªçº¿ç¨é½æç¬ç«çå±é¨åéï¼æ å±äº«ï¼ï¼JVMä¼ç´æ¥å é¤è¯¥synchronizedä¿®é¥°ï¼é¿åä¸å¿è¦çéå¼éã</li>
<li><strong>éç²å</strong>ï¼å½å¤ä¸ªè¿ç»­çsynchronizedä»£ç åä½¿ç¨åä¸ä¸ªéå¯¹è±¡æ¶ï¼JVMä¼å°è¿äºä»£ç ååå¹¶ä¸ºä¸ä¸ªå¤§çåæ­¥ä»£ç åï¼åå°éçè·å/éæ¾æ¬¡æ°ï¼æ¯æ¬¡è·å/éæ¾éé½æå¼éï¼ãä¾å¦ï¼å¾ªç¯åå¤æ¬¡è°ç¨åæ­¥æ¹æ³ï¼JVMå¯è½å°éç²åå°å¾ªç¯å¤é¨ã</li>
</ul>
<hr>
<h4 id="cas-compare-and-swapæ¯è¾å¹¶äº¤æ¢-æ¯å¹¶åç¼ç¨ä¸­å®ç°åå­æä½çæ ¸å¿ç®æ³æ¯ä¸ç§ä¹è§éçå®ç°ç­ç¥">CAS (Compare And Swapï¼æ¯è¾å¹¶äº¤æ¢) æ¯å¹¶åç¼ç¨ä¸­å®ç°åå­æä½çæ ¸å¿ç®æ³ï¼æ¯ä¸ç§ä¹è§éçå®ç°ç­ç¥ã</h4>
<ol>
<li>CASçå·¥ä½åçï¼åå«ä¸ä¸ªæ ¸å¿åæ°ï¼</li>
</ol>
<ul>
<li>åå­å°å V (Memory Location)ï¼åéå¨åå­ä¸­çå®éå¼ã</li>
<li>ææå¼ A (Expected Value)ï¼çº¿ç¨è®¤ä¸ºè¯¥åéå½ååºè¯¥æ¯ä»ä¹å¼ã</li>
<li>æ°å¼ B (New Value)ï¼çº¿ç¨æ³è¦æ´æ°æçå¼ã</li>
<li>æ§è¡é»è¾ï¼å½ä¸ä»å½åå­å°å V çå¼ç­äºææå¼ A æ¶ï¼å¤çå¨æä¼å° V çå¼æ´æ°ä¸º Bãå¦åï¼è¯´æè¯¥åéå·²è¢«å¶ä»çº¿ç¨ä¿®æ¹ï¼å½åçº¿ç¨ä»ä¹é½ä¸åï¼éå¸¸ä¼è¿å¥èªæï¼æ­»å¾ªç¯éè¯ï¼ã</li>
</ul>
<ol start="2">
<li>CASçä¼ç¼ºç¹<br>
<strong>ä¼ç¹ï¼</strong></li>
</ol>
<ul>
<li>éé»å¡æ§ï¼CAS æ¯ä¸ç§éé»å¡ç®æ³ï¼Non-blockingï¼ï¼å®ä¸éè¦å synchronized é£æ ·æèµ·åæ¢å¤çº¿ç¨ã</li>
<li>æ§è½é«ï¼å¨ä½ãä¸­åº¦ç«äºçæåµä¸ï¼ç±äºåå°äºçº¿ç¨ä¸ä¸æåæ¢çå¼éï¼æçè¿é«äºééçº§éã<br>
<strong>ç¼ºç¹ï¼</strong></li>
<li>å¾ªç¯æ¶é´é¿ï¼èªæå¼éï¼ï¼å¦æé«å¹¶åä¸ç«äºæ¿çï¼CAS ä¼é¢ç¹å¤±è´¥å¹¶ä¸æ­èªæï¼è¿ä¼ç» CPU å¸¦æ¥å·¨å¤§çè®¡ç®ååã</li>
<li>åªè½ä¿è¯ä¸ä¸ªå±äº«åéçåå­æä½ï¼å¯¹äºå¤ä¸ªåéçæä½ï¼ä»éä½¿ç¨ synchronized æ ReentrantLockã</li>
<li>ABA é®é¢ï¼æç»å¸çç¼ºç¹ï¼ã</li>
</ul>
<ol start="3">
<li>ä»ä¹æ¯ ABA é®é¢ï¼</li>
</ol>
<ul>
<li>å¦æåéåå§å¼ä¸ºAï¼å¨çº¿ç¨1åå¤ä¿®æ¹å®çè¿ç¨ä¸­ï¼çº¿ç¨2å¿«éå°å°å¶æ¹æäºBï¼ç¶ååæ¹åäºAã ç°è±¡ï¼çº¿ç¨1è§å¯å°å¼ä¾ç¶æ¯Aï¼è®¤ä¸ºå®æ²¡åè¿ï¼äºæ¯CASæåã é£é©ï¼è½ç¶æ°å¼æ²¡åï¼ä½åéçç¶æï¼æå¯¹è±¡åé¨çå±æ§ï¼å¯è½å·²ç»åçäºååï¼å¯¼è´é»è¾éè¯¯ã</li>
<li>Javaæä¾äºAtomicStampedReferenceç±»ï¼éè¿å¼å¥çæ¬å·ï¼Stampï¼æ¥è§£å³ï¼ æ¯æ¬¡åéæ´æ°æ¶ï¼ä¸ä»æ´æ°å¼ï¼è¿å¢å ä¸ä¸ªçæ¬å·ãåªæå¼åçæ¬å·é½ä¸è´ï¼CASæä¼æåã</li>
<li>è¿å¯ä»¥è®¾ç½®æ¶é´æ³æ¥è§£å³ã</li>
</ul>
<ol start="4">
<li>CAS å¨Javaä¸­çå®ç°</li>
</ol>
<ul>
<li>å¨Javaä¸­ï¼CASä¸»è¦ç± sun.misc.Unsafe ç±»æä¾æ¯æãè¯¥ç±»ä¸­çæ¹æ³ï¼å¦ compareAndSwapIntï¼æ¯ native çï¼ç´æ¥è°ç¨ç¡¬ä»¶åºå±çæä»¤ã</li>
</ul>
<hr>
<h4 id="reentrantlockå¯éå¥é">ReentrantLockï¼å¯éå¥éï¼</h4>
<ul>
<li>ReentrantLockæ¯ Java java.util.concurrent.locks åä¸çå¯éå¥éå®ç°ï¼åºäº AQSï¼æ½è±¡éååæ­¥å¨ï¼æå»ºï¼æ¯ synchronized ç âå¢å¼ºçâââ æ¢ä¿çäº synchronized çå¯éå¥ç¹æ§ï¼åæä¾äºæ´çµæ´»çåæ­¥æ§å¶è½åã</li>
</ul>
<h5 id="ä¸¤èå¯¹æ¯">ä¸¤èå¯¹æ¯:</h5>
<table>
<thead>
<tr>
<th>ç¹æ§</th>
<th>synchronized</th>
<th>ReentrantLock</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®ç°å±é¢</td>
<td>JVM å±é¢ï¼å³é®å­ï¼ï¼ç± C++ å®ç°</td>
<td>JDK å±é¢ï¼APIï¼ï¼ç± Java ç¼åï¼åºäº AQSï¼</td>
</tr>
<tr>
<td>éçéæ¾</td>
<td>èªå¨éæ¾ï¼ä»£ç æ§è¡å®æå¼å¸¸åï¼</td>
<td>æå¨éæ¾ï¼å¿é¡»å¨ finally ä¸­è°ç¨ unlock()ï¼</td>
</tr>
<tr>
<td>çµæ´»æ§</td>
<td>ä½ï¼ä¸å¯ä¸­æ­ï¼æ è¶æ¶æºå¶ï¼</td>
<td>é«ï¼æ¯æå°è¯è·åãè¶æ¶è·åãå¯ä¸­æ­è·åï¼</td>
</tr>
<tr>
<td>å¬å¹³æ§</td>
<td>åªæ¯æéå¬å¹³é</td>
<td>æ¯æå¬å¹³éä¸éå¬å¹³éï¼é»è®¤éå¬å¹³ï¼</td>
</tr>
<tr>
<td>ç­å¾éå</td>
<td>åªè½å³è 1 ä¸ª ç­å¾éåï¼wait/notifyï¼</td>
<td>å¯ä»¥ç»å® å¤ä¸ª Conditionï¼ç²¾ç»åå¤éï¼</td>
</tr>
</tbody>
</table>
<h5 id="reentrantlockçç¹æé«çº§åè½">ReentrantLockçç¹æé«çº§åè½</h5>
<ol>
<li>ååºä¸­æ­ (lockInterruptibly)</li>
</ol>
<ul>
<li>synchronizedä¸æ¦è¿å¥é»å¡ç­å¾ï¼é¤éæ¿å°éï¼å¦åæ æ³è¢«ä¸­æ­ãèReentrantLockåè®¸çº¿ç¨å¨ç­å¾éçè¿ç¨ä¸­ååºThread.interrupt()ï¼ä»èé¿åæ­»ç­ã</li>
</ul>
<ol start="2">
<li>è¶æ¶æºå¶ (tryLock)</li>
</ol>
<ul>
<li>çº¿ç¨å¯ä»¥å°è¯è·åéï¼å¦æéè¢«å ç¨ï¼ç«å³è¿å false æèç­å¾ä¸æ®µæ¶é´åè¿åï¼èä¸æ¯ä¸ç´é»å¡ãè¿å¨é¢é²æ­»éæ¶éå¸¸æç¨ã</li>
</ul>
<ol start="3">
<li>å¬å¹³é (Fairness)</li>
</ol>
<ul>
<li>å¬å¹³éï¼æç§çº¿ç¨è¯·æ±éçé¡ºåºåéï¼åå°åå¾ã</li>
<li>éå¬å¹³éï¼é»è®¤ï¼ï¼åè®¸âæéâãå¦ææ°æ¥ççº¿ç¨æ­£å¥½ç¢°å°ééæ¾ï¼å®å¯ä»¥ç´æ¥æ¢å ï¼æ§è½éå¸¸æ¯å¬å¹³éé«ã</li>
</ul>
<ol start="4">
<li>å¤ä¸ª Condition å¯¹è±¡</li>
</ol>
<ul>
<li>éè¿lock.newCondition()ï¼ä½ å¯ä»¥åå»ºå¤ä¸ªç­å¾éãä¾å¦å¨é»å¡éåä¸­ï¼å¯ä»¥å®ä¹ notFull å notEmpty ä¸¤ä¸ªæ¡ä»¶ï¼å®ç°æ¯ notifyAll æ´ç²¾åççº¿ç¨å¤éã</li>
</ul>
<h5 id="åºæ¬ä½¿ç¨ç¤ºä¾">åºæ¬ä½¿ç¨ç¤ºä¾ï¼</h5>
<pre><code class="language-java">import java.util.concurrent.locks.ReentrantLock;

public class ReentrantLockDemo {
    // åå»ºéå¬å¹³éï¼é»è®¤ï¼ï¼è¥éå¬å¹³éï¼new ReentrantLock(true)
    private static final ReentrantLock lock = new ReentrantLock();

    public static void doTask() {
        // 1. æ®éè·åéï¼ä¸å¯ä¸­æ­ï¼
        lock.lock();
        try {
            // ä¸´çåºä»£ç ï¼çº¿ç¨å®å¨ï¼
            System.out.println(Thread.currentThread().getName() + " æ§è¡ä»»å¡");
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        } finally {
            // å¿é¡»å¨finallyä¸­éæ¾éï¼å¦åéæ°¸è¿æ æ³éæ¾
            lock.unlock();
        }
    }

    // è¶æ¶è·åéç¤ºä¾
    public static void tryLockWithTimeout() {
        try {
            // å°è¯å¨2ç§åè·åéï¼è·åæåè¿åtrueï¼å¤±è´¥è¿åfalse
            if (lock.tryLock(2, java.util.concurrent.TimeUnit.SECONDS)) {
                try {
                    System.out.println(Thread.currentThread().getName() + " è¶æ¶è·åéæå");
                } finally {
                    lock.unlock();
                }
            } else {
                System.out.println(Thread.currentThread().getName() + " è¶æ¶è·åéå¤±è´¥");
            }
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }

    public static void main(String[] args) {
        // æµè¯æ®éè·åé
        new Thread(ReentrantLockDemo::doTask, "çº¿ç¨1").start();
        new Thread(ReentrantLockDemo::doTask, "çº¿ç¨2").start();
        
        // æµè¯è¶æ¶è·åé
        new Thread(ReentrantLockDemo::tryLockWithTimeout, "çº¿ç¨3").start();
    }
}
</code></pre>

</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-13 22:24">2026-01-13 22:24</span>&nbsp;
<a href="https://www.cnblogs.com/xi-yongqi">æä¼æ¿é£å»</a>&nbsp;
éè¯»(<span id="post_view_count">26</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479394);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479394', targetLink: 'https://www.cnblogs.com/xi-yongqi/p/19479394', title: 'synchronizedå³é®å­ç¸å³' })">ä¸¾æ¥</a>
</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä»Shapefileå°GeoJSONï¼ç¨GDALå®ç°GISç¢éæ°æ®è¯»åä¸ç©ºé´åæ ]]></title>
    <link>https://www.cnblogs.com/charlee44/p/19479143</link>
    <guid>6bcd8da550301ab8407175bad2c0797b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/charlee44/p/19479143" title="åå¸äº 2026-01-13 20:25">
    <span role="heading" aria-level="2">ä»Shapefileå°GeoJSONï¼ç¨GDALå®ç°GISç¢éæ°æ®è¯»åä¸ç©ºé´åæ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/1000410/202601/1000410-20260113202625252-636759511.png" alt="ä»Shapefileå°GeoJSONï¼ç¨GDALå®ç°GISç¢éæ°æ®è¯»åä¸ç©ºé´åæ" class="desc_img">
        éè¿ GDAL/OGR å®ç°äº GIS ç¢éæ°æ®çå®æ´å¤çæµç¨ââä» Shapefile è¯»åãWGS84 å° Web å¢¨å¡æåæ è½¬æ¢ï¼å° GeoJSON åå¥ï¼å¹¶æ¼ç¤ºäºç¹ä¸å¤è¾¹å½¢ææå³ç³»ï¼å¦ Containsï¼çå¤æ­æ¹æ³ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>æ¬æèéèªä½èæ°ä¹¦<a href="https://item.jd.com/14603137.html" target="_blank" rel="noopener nofollow">ãGISåºç¡åçä¸ææ¯å®è·µã</a>ç¬¬4ç« ï¼ç³»ç»è®²è§£ç¢éæ°æ®å¼ååºç¡ï¼æ¶µç OGR/GDAL ä½¿ç¨ãåæ è½¬æ¢ãææå¤æ­ç­å®æåå®¹ã</p>
</blockquote>
<p><img alt="GISåºç¡åçä¸ææ¯å®è·µ" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1000410/202601/1000410-20260109210341528-489326821.png" class="lazyload"></p>
<h2 id="44-ç¢éæ°æ®å¼ååºç¡">4.4 ç¢éæ°æ®å¼ååºç¡</h2>
<p>éè¿ä¹åçä»ç»ï¼ç¸ä¿¡è¯»èå·²ç»å¯¹äºGISçç¢éæ°æ®æäºä¸ä¸ªå¨é¢çè®¤è¯ï¼å°½ç®¡å¯è½ä¸æ¯é£ä¹æ·±å¥ãä½æ¯æ²¡æå³ç³»ï¼æä»¬å¯ä»¥å¨å®éçå¼åè¿ç¨ä¸­å æ·±å¯¹å¶çè®¤è¯ã</p>
<h3 id="441-ç¬¬ä¸æ¹å¼æºåºogrgdal">4.4.1 ç¬¬ä¸æ¹å¼æºåºOGR/GDAL</h3>
<p>å¨ç¬¬3ç« çæ¶åï¼æä»¬å°è¯çåï¼éè¿ç¬¬ä¸æ¹å¼æºåºPROJ/GDALå¾ç®åçå°±å®ç°äºå°çç©ºé´åèç³»ç»çç¸äºè½¬æ¢ãå¨è¿éåæ ·å¦æ­¤ï¼æä»¬å¯ä»¥éè¿GDALçOGRç»ä»¶ï¼è½»æ¾å®ç°GISç¢éæ°æ®çåºç¡å¼åã</p>
<p>OGRæ¾ç»æ¯ä¸ä¸ªç¬ç«çç¢éIOåºï¼è¡¨ç¤ºOpenGIS Simple Features Reference Implementationçææï¼ä½å¶å®OGRä¸å®å¨ç¬¦åOGCçSimple Featureæ åè§èï¼å æ­¤æªè¢«æ¹åä½ä¸ºè¯¥è§èçåèå®ç°ï¼å½ç¶ä¹éå¸¸æ¥è¿è§èäºï¼ãä»GDAL2.0å¼å§ï¼GDALåOGRç»ä»¶è¢«éæå¨ä¸èµ·ã</p>
<p>OGR/GDALæä¾äºéå¸¸å¼ºå¤§çç¢éè¯»åè½åï¼æ¯æå¸é¢ä¸ç»å¤§å¤æ°ç¢éæ°æ®æ ¼å¼ãå¨ç¬¬3ç« æä»¬ä»ç»GDALçæ¶åå°±æå°è¿ï¼GDALæ¯ä¸ä¸ªGISæ°æ®æ½è±¡åºãæè°æ°æ®æ½è±¡ï¼æ¯ææ è®ºæ¯åªä¸ç§å·ä½çç¢éæ°æ®æ ¼å¼ï¼GDALé½ä¼å°å¶æ½è±¡ææ°æ®éå¯¹è±¡ï¼Datasetï¼ï¼ä»èå¯ä»¥æ¯æè¯»åãååºåå¤çæä½ãå¸¸ç¨çç¢éæ°æ®æ ¼å¼å¦ä¸ï¼</p>
<ul>
<li>DXF/DWGï¼åºç¨æå¹¿æ³çå ä½å¾å½¢æ°æ®æ ¼å¼ï¼å¨CADé¢ååç¨çéå¸¸å¤ï¼ä½æ¯ç¼ºç¹æ¯ç¼ºå°å°çä¿¡æ¯ã</li>
<li>ESRI Shapefileï¼GISä¸­æå¸¸è§çç¢éæ°æ®æ ¼å¼ï¼å ä¹ææçåä¸åå¼æºGISè½¯ä»¶é½æ¯æãé¤äºå ä½ä¿¡æ¯ä¹å¤ï¼è¿åå«ç©ºé´ä¿¡æ¯åå±æ§ä¿¡æ¯ã</li>
<li>GeoJSONï¼ä¸ç§éè¿JSONæ¥è¡¨è¿°è¦ç´ çç¢éæ°æ®æ ¼å¼ï¼å èå¾å®¹æè¢«JavaScriptè§£æåå¤çï¼éç¨äºWebç«¯çè½»éååºç¨ã</li>
<li>KMLï¼Googleæåºçä¸ç§åºäºXMLæ åæ¥æè¿°å°çç©ºé´ä¿¡æ¯çæ°æ®æ ¼å¼ï¼åæ¬ç¹ãçº¿ãé¢ãå¤è¾¹å½¢åæ¨¡åç­ï¼ï¼å¹¶ä¸å·²ç»è¢«OGCè®¤å®ä¸ºå¼æ¾å°çä¿¡æ¯ç¼ç æ åã</li>
</ul>
<p>å¨GDALä¸­ï¼å¯¹æ°æ®æ ¼å¼çæ¯æè¢«å°è£æé©±å¨ï¼dirverï¼ï¼åæ¬ä¸è¿°æ ¼å¼å¨åçæ°æ®é©±å¨è¦ä¹ååµå¨GDALä¸­ï¼è¦ä¹éè¿å¦å¤çç¬¬ä¸æ¹åºæ¥æ¯æãå½ç¶è¿äºæä»¬å¯ä»¥ææ¶ä¸ç¨å³å¿ï¼ç´æ¥ä½¿ç¨æ¬ä¹¦Githubä¸»é¡µä»£ç ä»åºä¸­çGDALå³å¯ã</p>
<h3 id="442-ç¢éæ°æ®çè¯»åå¤çååå¥">4.4.2 ç¢éæ°æ®çè¯»åãå¤çååå¥</h3>
<p>äºè§£äºç¬¬ä¸æ¹åºOGR/GDALï¼æ¥ä¸æ¥æä»¬å°±éè¿å¶å®ç°å³äºGISç¢éæ°æ®çåºç¡å¼åãä¸ä¸ªå¾å®¹æçè§£çå¸¸è¯æ¯ï¼åå«GISç¢éæ°æ®å¨åçä»»ä½æ°æ®çæä½é½ç¦»ä¸å¼ä¸ä¸ªè¿ç¨ï¼è¯»åãå¤çååå¥ãå æ­¤ï¼è¿éæä»¬ç»ååé¢ç©ºé´åæ åèè½¬æ¢çå®è·µï¼å®ç°ä¸ä¸ªç®åçå®ä¾ï¼è¯»åä¸ä¸ªé¢çç¢éï¼ç¶åå¯¹å¶è¿è¡ç©ºé´åèçè½¬æ¢ï¼æåéæ°ååºä¸ä¸ªç¢éãå·ä½çå®ç°ä»£ç å¦ä¸ï¼</p>
<pre><code class="language-cpp">#include &lt;ogrsf_frmts.h&gt;

#include &lt;Eigen/Eigen&gt;
#include &lt;iostream&gt;
#include &lt;vector&gt;

using namespace std;
using namespace Eigen;

using Point = Vector3d;
using Line = vector&lt;Point&gt;;
using Polygon = vector&lt;Line&gt;;

vector&lt;Polygon&gt; polygonData;

OGRSpatialReference srcFileSpatialReference;
OGRSpatialReference dstFileSpatialReference;

void OgrRing2Line(OGRLinearRing *ogrLinearRing, Line &amp;line) {
  for (int i = 0; i &lt; ogrLinearRing-&gt;getNumPoints(); i++) {
    line.emplace_back(ogrLinearRing-&gt;getX(i), ogrLinearRing-&gt;getY(i),
                      ogrLinearRing-&gt;getZ(i));
  }
}

void OgrPolygon2Polygon(OGRPolygon *ogrPolygon, Polygon &amp;polygon) {
  //å¤ç¯
  Line line;
  OgrRing2Line(ogrPolygon-&gt;getExteriorRing(), line);
  polygon.push_back(line);

  //åç¯
  for (int ri = 0; ri &lt; ogrPolygon-&gt;getNumInteriorRings(); ri++) {
    Line line;
    OgrRing2Line(ogrPolygon-&gt;getInteriorRing(ri), line);
    polygon.push_back(line);
  }
}

bool ReadShp() {
  string srcFile = getenv("GISBasic");
  srcFile = srcFile + "/../Data/Vector/multipolygons.shp";

  GDALDataset *poDS = (GDALDataset *)GDALOpenEx(srcFile.c_str(), GDAL_OF_VECTOR,
                                                NULL, NULL, NULL);
  if (!poDS) {
    printf("æ æ³è¯»åè¯¥æä»¶ï¼è¯·æ£æ¥æ°æ®æ¯å¦å­å¨é®é¢ï¼");
    return false;
  }

  if (poDS-&gt;GetLayerCount() &lt; 1) {
    printf("è¯¥æä»¶çå±æ°å°äº1ï¼è¯·æ£æ¥æ°æ®æ¯å¦å­å¨é®é¢ï¼");
    return false;
  }

  //åå§æ°æ®ç©ºé´åè
  char *pszWKT = nullptr;
  poDS-&gt;GetLayer(0)-&gt;GetSpatialRef()-&gt;exportToWkt(&amp;pszWKT);
  srcFileSpatialReference.importFromWkt(pszWKT);
  CPLFree(pszWKT);
  pszWKT = nullptr;

  for (int li = 0; li &lt; poDS-&gt;GetLayerCount(); li++) {
    OGRLayer *poLayer = poDS-&gt;GetLayer(li);  //è¯»åå±
    poLayer-&gt;ResetReading();

    //è¾åºå­æ®µå
    OGRFeatureDefn *poFDefn = poLayer-&gt;GetLayerDefn();
    int n = poFDefn-&gt;GetFieldCount();
    for (int iField = 0; iField &lt; n; iField++) {
      OGRFieldDefn *OGRFieldDefn = poFDefn-&gt;GetFieldDefn(iField);
      cout &lt;&lt; OGRFieldDefn-&gt;GetNameRef() &lt;&lt; endl;
    }

    //éåç¹å¾
    OGRFeature *poFeature = nullptr;
    while ((poFeature = poLayer-&gt;GetNextFeature()) != nullptr) {
      OGRGeometry *geometry = poFeature-&gt;GetGeometryRef();
      OGRwkbGeometryType geometryType = geometry-&gt;getGeometryType();

      switch (geometryType) {
        case wkbPolygon:
        case wkbPolygonM:
        case wkbPolygonZM: {
          OGRPolygon *ogrPolygon = dynamic_cast&lt;OGRPolygon *&gt;(geometry);
          if (!ogrPolygon) {
            continue;
          }

          Polygon polygon;
          OgrPolygon2Polygon(ogrPolygon, polygon);
          polygonData.push_back(polygon);

          break;
        }
        case wkbMultiPolygon:
        case wkbMultiPolygonM:
        case wkbMultiPolygonZM: {
          OGRMultiPolygon *ogrMultiPolygon =
              dynamic_cast&lt;OGRMultiPolygon *&gt;(geometry);
          if (!ogrMultiPolygon) {
            continue;
          }

          for (int gi = 0; gi &lt; ogrMultiPolygon-&gt;getNumGeometries(); gi++) {
            OGRPolygon *ogrPolygon =
                dynamic_cast&lt;OGRPolygon *&gt;(ogrMultiPolygon-&gt;getGeometryRef(gi));
            if (!ogrPolygon) {
              continue;
            }

            Polygon polygon;
            OgrPolygon2Polygon(ogrPolygon, polygon);
            polygonData.push_back(polygon);
          }

          break;
        }
        default: {
          printf("æªå¤ççç¹å¾ç±»å\n");
          break;
        }
      }

      //è¾åºæ¯ä¸ªå­æ®µçå¼
      for (int iField = 0; iField &lt; n; iField++) {
        cout &lt;&lt; poFeature-&gt;GetFieldAsString(iField) &lt;&lt; "    ";
      }
      cout &lt;&lt; endl;

      OGRFeature::DestroyFeature(poFeature);
    }
  }

  GDALClose(poDS);
  poDS = nullptr;

  return true;
}

void Convert() {
  dstFileSpatialReference.importFromEPSG(3857);
  dstFileSpatialReference.SetAxisMappingStrategy(OAMS_TRADITIONAL_GIS_ORDER);
  srcFileSpatialReference.SetAxisMappingStrategy(OAMS_TRADITIONAL_GIS_ORDER);

  OGRCoordinateTransformation *src2DstTransformation =
      OGRCreateCoordinateTransformation(&amp;srcFileSpatialReference,
                                        &amp;dstFileSpatialReference);

  if (!src2DstTransformation) {
    return;
  }

  for (auto &amp;polygon : polygonData) {
    for (auto &amp;line : polygon) {
      for (auto &amp;point : line) {
        src2DstTransformation-&gt;Transform(1, point.data(), point.data() + 1,
                                         point.data() + 2);
      }
    }
  }
}

bool CreateField(OGRLayer *poLayer) {
  // å­ç¬¦ä¸²
  OGRFieldDefn oField1("Type", OFTString);
  oField1.SetWidth(8);
  if (poLayer-&gt;CreateField(&amp;oField1) != OGRERR_NONE) {
    printf("Creating Name field failed.\n");
    return false;
  }

  // æµ®ç¹æ°
  OGRFieldDefn oField2("Area", OFTReal);
  oField2.SetPrecision(3);
  if (poLayer-&gt;CreateField(&amp;oField2) != OGRERR_NONE) {
    printf("Creating Name field failed.\n");
    return false;
  }

  // æ´å
  OGRFieldDefn oField3("VertexCount", OFTInteger);
  if (poLayer-&gt;CreateField(&amp;oField3) != OGRERR_NONE) {
    printf("Creating Name field failed.\n");
    return false;
  }

  return true;
}

bool WriteGeoJson() {
  string dstFile = getenv("GISBasic");
  dstFile = dstFile + "/../Data/Out.geoJson";

  //åå»º
  GDALDriver *driver = GetGDALDriverManager()-&gt;GetDriverByName("GeoJSON");
  if (!driver) {
    printf("Get Driver GeoJSON Errorï¼\n");
    return false;
  }

  GDALDataset *dataset =
      driver-&gt;Create(dstFile.c_str(), 0, 0, 0, GDT_Unknown, NULL);
  OGRLayer *poLayer = dataset-&gt;CreateLayer(
      "FirstLayer", &amp;dstFileSpatialReference, wkbPolygon, NULL);

  if (!CreateField(poLayer)) {
    return false;
  }

  //åå»ºç¹å¾
  for (const auto &amp;polygon : polygonData) {
    OGRFeature ogrFeature(poLayer-&gt;GetLayerDefn());

    OGRPolygon ogrPolygon;

    int vertexNum = 0;
    for (const auto &amp;line : polygon) {
      OGRLinearRing ogrRing;
      for (const auto &amp;point : line) {
        ogrRing.addPoint(point.x(), point.y(), point.z());
        vertexNum++;
      }
      ogrPolygon.addRing(&amp;ogrRing);
    }
    ogrFeature.SetGeometry(&amp;ogrPolygon);

    ogrFeature.SetField("Type", "Polygon");
    ogrFeature.SetField("Area", ogrPolygon.get_Area());
    ogrFeature.SetField("VertexCount", vertexNum);

    if (poLayer-&gt;CreateFeature(&amp;ogrFeature) != OGRERR_NONE) {
      printf("Failed to create feature.\n");
      return false;
    }
  }

  //éæ¾
  GDALClose(dataset);
  dataset = nullptr;

  return true;
}

int main() {
  GDALAllRegister();
  CPLSetConfigOption("GDAL_FILENAME_IS_UTF8", "NO");  //æ¯æä¸­æè·¯å¾
  CPLSetConfigOption("SHAPE_ENCODING", "");           //è§£å³ä¸­æä¹±ç é®é¢

  if (!ReadShp()) {
    return 1;
  }

  Convert();

  WriteGeoJson();
}
</code></pre>
<p>å¨è¿éï¼è¯»åçç¢éæ¯ä¸ä¸ªShapefileæä»¶ï¼åå«çé½æ¯å¤è¾¹å½¢çè¦ç´ ï¼ç©ºé´åèä¸ºWGS84å°çåæ ç³»ï¼EPSGï¼4326ï¼ï¼æ¾ç¤ºå¦ä¸å¾4.14æç¤ºï¼</p>
<p><img alt="å¾4.14 å¤çåå¤è¾¹å½¢ç¢éè¦ç´ " loading="lazy" data-src="https://img2024.cnblogs.com/blog/1000410/202601/1000410-20260113202314711-1548077459.jpg" class="lazyload"></p>
<p>ç»è¿ç©ºé´åèè½¬æ¢åï¼ç©ºé´åèä¸ºWebå¢¨å¡ææå½±åæ ç³»ï¼EPSGï¼3857ï¼ï¼ä¸çæçæ¯ä¸ä¸ªGeoJsonæä»¶ãå¦ä¸å¾4.15æç¤ºï¼å¯ä»¥çå°å¨ç©ºé´åæ åèè½¬æ¢ä¹åå½¢ç¶ä¼¼ä¹âåçªâäºä¸ç¹ï¼è¿æ¯å°å¾æå½±åæ¢çç¹æ§å³å®çï¼åèç¬¬2ç« ä»ç»çç¥è¯ï¼ã</p>
<p><img alt="å¾4.15 å¤çåå¤è¾¹å½¢ç¢éè¦ç´ " loading="lazy" data-src="https://img2024.cnblogs.com/blog/1000410/202601/1000410-20260113202328946-325091388.jpg" class="lazyload"></p>
<p>è¿æ®µä»£ç çå³é®å¨äºå¦ä¸å ç¹ï¼</p>
<ul>
<li>
<p>è¯»åç¢éæ¶ï¼ç¢éæ°æ®è¢«è¯»åææ°æ®éå¯¹è±¡GDALDatasetï¼GDALDatasetç®¡çå¾å±å¯¹è±¡OGRLayerï¼OGRLayerç®¡çç¹å¾ç±»å¯¹è±¡OGRFeatureï¼OGRFeatureååå«å ä½å¯¹è±¡ç±»OGRGeometryãOGRGeometryæ¯ä¸ä¸ªæ½è±¡ç¶ç±»ï¼ææä¹çæ¯å¶è¡¨è¾¾å·ä½çå ä½å¯¹è±¡çå­ç±»ï¼æ¯å¦OGRPolygonä»£è¡¨å¤è¾¹å½¢å ä½å¯¹è±¡ãOGRPolygonåæ¯ç±1ä¸ªå¤ç¯åå¤ä¸ªåç¯ï¼ç¯çº¿ï¼OGRLinearRingï¼ç»æãç¢éå°±æ¯è¿æ ·ä¸å±å±æ½è±¡ç»åè¡¨è¾¾åºæ¥çã</p>
</li>
<li>
<p>å¨è¿è¡æ°æ®å¤çä¹å°±æ¯ç©ºé´åèè½¬æ¢ä¹åï¼æä»¬æè¯»åçæ°æ®æ¾å°æä»¬èªå·±çæ°æ®å®¹å¨ä¸­ï¼</p>
<pre><code class="language-cpp">using Point = Vector3d;
using Line = vector&lt;Point&gt;;
using Polygon = vector&lt;Line&gt;;

vector&lt;Polygon&gt; polygonData;
</code></pre>
<p>çå®çGISæ°æ®å¤çå¼åè¦æ±æ¯ååä¸åçï¼æä½çå¾å¾ä¸æ¯è¯»åç»ä»¶ï¼è¿éæOGRï¼å®ä¹çæ°æ®ç»æå¯¹è±¡ãæä»¬å¯ä»¥å°å¶è¯»åå¨æèªå®ä¹çæ°æ®ç»æä¸­ï¼ä»¥æ¹ä¾¿æä»¬è¿è¡æ´å éç¨çæä½ï¼æèè¿è¡å¹¶è¡ä¼åãå¨è¿éæä»¬éåäºèªå®ä¹çæ°æ®ç»æå¯¹è±¡ä¸­çé¡¶ç¹ï¼éç¹è¿è¡ç©ºé´åæ åèçè½¬æ¢ãè¿è¡å¶ä»çæ°æ®å¤çä¹æ¯å¦æ­¤ï¼æ ¹æ®èªå·±çéè¦æä½èªå·±çæ°æ®ç»æå®¹å¨ã</p>
</li>
<li>
<p>ååºç¢éæ¶ï¼å°å¤çç»æçèªå®ä¹æ°æ®ç»æå¯¹è±¡æ¢å¤ææ°æ®éå¯¹è±¡GDALDatasetï¼è¯»åç¢éçéæä½ï¼ãå¦å¤ï¼éè¦å³æ³¨çæ¯GDALçæ°æ®é©±å¨GDALDriverï¼å¶æ¯éè¿åç§°æ¥åå»ºå¯¹åºæ ¼å¼çç¢éæä»¶ï¼ä¾å¦è¿éä¼ å¥å°åç§°æ¯GeoJson:</p>
<pre><code class="language-cpp">GDALDriver *driver = GetGDALDriverManager()-&gt;GetDriverByName("GeoJSON");
if (!driver) {
  printf("Get Driver GeoJSON Errorï¼\n");
  return false;
}
</code></pre>
</li>
<li>
<p>ç¢éæ°æ®çå±æ§è¡¨æ°æ®ä¸æ°æ®åºä¸­çè¡¨ç»ææ¯è¾ç±»ä¼¼ï¼æ¯ä¸ªå­æ®µå·æèªå·±çå®ä¹å±æ§ï¼ä¾å¦æ°æ®ç±»åãé¿åº¦ãç²¾åº¦ç­ãå¹¶ä¸ï¼æ¯ä¸ä¸ªç¹å¾é½å¯¹åºäºä¸è¡è®°å½ãå èå±æ§è¡¨çæä½è¿æ¯æºå¤æçï¼å¾å¾ä¸ä¸å¡æä½ç¸å³èãè¿éä»ä»åªæ¯è¾åºæ¾ç¤ºäºè¯»åçå±æ§è¡¨ä¿¡æ¯ï¼åå¥äºèªå·±åå»ºçå­æ®µä¸å¼ãè¯»åååå¥çå±æ§è¡¨æ°æ®å¦ä¸å¾4.16ãå¾4.17æç¤ºï¼</p>
</li>
</ul>
<p><img alt="å¾4.16 è¯»åçå±æ§è¡¨ä¿¡æ¯" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1000410/202601/1000410-20260113202342130-737019255.jpg" class="lazyload"><br>
<img alt="å¾4.17 åå¥çå±æ§è¡¨ä¿¡æ¯" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1000410/202601/1000410-20260113202352772-344125405.jpg" class="lazyload"></p>
<h3 id="443-ç©ºé´ææå³ç³»çå¤æ­">4.4.3 ç©ºé´ææå³ç³»çå¤æ­</h3>
<p>å¯¹ç¢éè¦ç´ è¿è¡ç©ºé´ææå³ç³»çå¤æ­ä¹æ¯GISå¼åä¸­å¸¸ç¨çåè½ãå¨4.3.3èä¸­ä»ç»äºOGCçSimple Featureæ åè§èä¸­ææå³ç³»ï¼OGR/GDALå¯¹å¶åäºå·ä½çå®ç°ãä»»ä½ç»§æ¿äºOGRGeometryçå ä½å¯¹è±¡ç±»ï¼å¦OGRPointãOGRPolygonï¼é½å¯ä»¥è°ç¨æ åä¸­å®ä¹çæ¥å£ï¼äºåè°è¯ï¼ï¼å¤æ­è¯¥å ä½å¯¹è±¡ä¸å¦å¤ä¸ä¸ªå ä½å¯¹è±¡çææå³ç³»ãå¨å¦ä¸å®ä¾ä¸­ï¼å¤æ­äºç©ºé´ä¸­æç¹ä¸æå¤è¾¹å½¢æ¯å¦å­å¨åå«ï¼Containsï¼å³ç³»ï¼</p>
<pre><code class="language-cpp">#include &lt;ogrsf_frmts.h&gt;

#include &lt;iostream&gt;

using namespace std;

int main() {
  OGRLinearRing linearRing;
  linearRing.addPoint(268.28, 784.75);
  linearRing.addPoint(153.98, 600.60);
  linearRing.addPoint(274.63, 336.02);
  linearRing.addPoint(623.88, 401.64);
  linearRing.addPoint(676.80, 634.47);
  linearRing.addPoint(530.75, 822.85);
  linearRing.closeRings();

  OGRPolygon polygon;
  polygon.addRing(&amp;linearRing);

  cout &lt;&lt; "ç¹Aæ¯å¦å¨å¤è¾¹å½¢åï¼";
  OGRPoint pointA(407.98, 579.43);  
  cout &lt;&lt; polygon.Contains(&amp;pointA) &lt;&lt; endl;

  cout &lt;&lt; "ç¹Bæ¯å¦å¨å¤è¾¹å½¢åï¼";
  OGRPoint pointB(678.92, 482.07);  
  cout &lt;&lt; polygon.Contains(&amp;pointB) &lt;&lt; endl;
}
</code></pre>
<p>è¿è¡çç»æå¦ä¸æç¤ºï¼</p>
<pre><code class="language-text">ç¹Aæ¯å¦å¨å¤è¾¹å½¢åï¼1
ç¹Bæ¯å¦å¨å¤è¾¹å½¢åï¼0
</code></pre>
<p>å¨4.3.3èä¸­ä»ç»è¿ï¼åå«(Contains)ä¸åå«(Within)æ¯ä¸å¯¹ç¸åçå³ç³»ãå¨è¿éæä»¬å½ç¶ä¹å¯ä»¥è°ç¨OGRPointçåå«(Within)æ¥å£ï¼ä¼è¿åä¸ä¸è¿°åæ ·çç»æãä¸æ­¢å¦æ­¤ï¼å¶ä»ç©ºé´ææå³ç³»çæ¥å£ä¹æ¯è¿æ ·è°ç¨ï¼è¯»èå¯ä»¥æ ¹æ®èªå·±çéæ±å°è¯ä¸äºï¼è¿éåªæ¯æç å¼çã</p>
<hr>
<p>æ¬æèéèªä½èæ°ä¹¦ãGISåºç¡åçä¸ææ¯å®è·µãç¬¬4ç« ãä¹¦ä¸­ç³»ç»è®²è§£ GIS æ ¸å¿çè®ºä¸å¤è¯­è¨å®æï¼éåå¼åèä¸é«æ ¡å¸çã</p>
<p>ð <strong>éå¥èµæºå¼æº</strong>ï¼<a href="https://github.com/fafa1899/GISBasic" target="_blank" rel="noopener nofollow">GitHub</a> | <a href="https://gitcode.com/charlee44/GISBasic" target="_blank" rel="noopener nofollow">GitCode</a></p>
<p>ð <strong>æ¯ææ­£ç</strong>ï¼<a href="https://item.jd.com/14603137.html" target="_blank" rel="noopener nofollow">äº¬ä¸</a>ï½<a href="https://product.dangdang.com/29988568.html" target="_blank" rel="noopener nofollow">å½å½</a></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.001388888888888889" data-date-updated="2026-01-13 20:27">2026-01-13 20:25</span>&nbsp;
<a href="https://www.cnblogs.com/charlee44">charlee44</a>&nbsp;
éè¯»(<span id="post_view_count">27</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19479143);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19479143', targetLink: 'https://www.cnblogs.com/charlee44/p/19479143', title: 'ä»Shapefileå°GeoJSONï¼ç¨GDALå®ç°GISç¢éæ°æ®è¯»åä¸ç©ºé´åæ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>