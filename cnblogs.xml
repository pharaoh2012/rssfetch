<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-05T20:28:23.872Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ AIåºäºAAæ¸¸æèæ¬è¾åºçä¼ å¥3æé¿çº¿éç½®è¡¨ ]]></title>
    <link>https://www.cnblogs.com/ygluu/p/19581913</link>
    <guid>606bde3213f613fb93867001d4b378bf</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ygluu/p/19581913" title="åå¸äº 2026-02-06 00:16">
    <span role="heading" aria-level="2">AIåºäºAAæ¸¸æèæ¬è¾åºçä¼ å¥3æé¿çº¿éç½®è¡¨</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="ä»¥ä¸æ¯-kimi-k25-agent-åºäºaaæ¸¸æèæ¬è¾åºçä¼ å¥3æé¿çº¿éç½®è¡¨">ä»¥ä¸æ¯ Kimi K2.5 Agent åºäºAAæ¸¸æèæ¬è¾åºçä¼ å¥3æé¿çº¿éç½®è¡¨ï¼</h2>
<h3 id="è¾åºä¹ä¸">è¾åºä¹ä¸ï¼</h3>
<p><img alt="83f69baaa4c0aff2969be15d1e4b0bd9" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3509144/202602/3509144-20260206001251839-763572087.png" class="lazyload"><br>
<img alt="86ce0cfbb8f1cb7ce7e98b8346e11fbd" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3509144/202602/3509144-20260206001303273-547526818.png" class="lazyload"></p>
<h3 id="è¾åºä¹äº">è¾åºä¹äºï¼</h3>
<p><img alt="6a3f69b70b7e18f8a027b14f5f31c0e3" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3509144/202602/3509144-20260206001312181-870589264.png" class="lazyload"><br>
<img alt="cd185b8d62db1b7c5373bf2b01eba36a" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3509144/202602/3509144-20260206001321082-424442324.png" class="lazyload"></p>
<h2 id="ä»¥ä¸æ¯æç¤ºè¯">ä»¥ä¸æ¯æç¤ºè¯ï¼</h2>
<p>ä½ æ¯ä¸ä¸ªç»éªä¸°å¯çä¼ å¥ç­åå¤§ä½¬ï¼ä¹æé¿äºä½¿ç¨exceléç½®è¡¨æ¥éç½®æ¸¸æã<br>
è¿ä¸ªé¾æ¥æ¯ä¸ä¸ªéç¨æ¸¸æèæ¬çè§èï¼<br>
<a href="https://www.cnblogs.com/ygluu/p/19550578" target="_blank">https://www.cnblogs.com/ygluu/p/19550578</a><br>
è¯·è®¤çéè¯»ä¸è¿°é¾æ¥çèæ¬è§èï¼å¹¶ä½¿ç¨è¯¥èæ¬ç¼åçå»æçº¿éç½®è¡¨ã<br>
è¦æ±ï¼<br>
1ãæ¨¡ååï¼èµéçäºº<br>
2ãæ¡£æ°ï¼10æ¡£<br>
3ãç¬¦åä¼ å¥3çæ¬ç¹å¾<br>
4ãä½çº§çäººä»å¤æ­ææªæ°éå³å¯<br>
5ãä¸­çº§çäººç»åæªç©åè´¨è®¡ç®ææªæ°é<br>
6ãé«çº§çäººç»åå°å¾åæªç©åè´¨ç­è®¡ç®æªç©æ°éã<br>
è¯·ä»¥è¡¨æ ¼å½¢å¼è¾åºï¼<br>
åééç½®è¡¨<br>
æ¨¡åéç½®è¡¨</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-06 00:17">2026-02-06 00:16</span>&nbsp;
<a href="https://www.cnblogs.com/ygluu">ç å®¢-ygluu</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19581913);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19581913', targetLink: 'https://www.cnblogs.com/ygluu/p/19581913', title: 'AIåºäºAAæ¸¸æèæ¬è¾åºçä¼ å¥3æé¿çº¿éç½®è¡¨' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ LLVMçæ··æ·ä¹æ(äº)-æå¨å®ç°æ§å¶æµå¹³å¦åæ··æ· ]]></title>
    <link>https://www.cnblogs.com/ClownLMe/p/19581710</link>
    <guid>1a2c5ccfa22b6fbf379f9e820c5c7466</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ClownLMe/p/19581710" title="åå¸äº 2026-02-05 22:54">
    <span role="heading" aria-level="2">LLVMçæ··æ·ä¹æ(äº)-æå¨å®ç°æ§å¶æµå¹³å¦åæ··æ·</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ç®ä»">ç®ä»</h1>
<p>ä¹åçæå­¦ä¸­ï¼ç®åçæ¼ç¤ºäºLLVMçåºæ¬ç¨æ³ï¼ä¸é¢ï¼å±ç¤ºä¸ä¸ªå®æé¡¹ç®ã</p>
<h1 id="ç¼è¯ç®æ ">ç¼è¯ç®æ </h1>
<p>æ¬æ¬¡çå®éªç¼è¯æ ·ä¾æ¯ä¸é¢å¤æ­æ­£æ°ï¼è´æ°ï¼åé¶çä»£ç </p>
<pre><code class="language-c">#include &lt;stdio.h&gt;

int main() {
    int a = 9;
    scanf_s("%d", &amp;a);
    if (a &lt; 0) {
        printf("Negative number!\n");
    } else if(a &gt; 0) {
        printf("Positive number!\n");
    } else {
        printf("Zero!\n");
    }
    
    printf("Done.\n");
    return 0;
} 
</code></pre>
<h1 id="ä¸æ§å¶æµæ··æ·å¹³å¦å">ä¸ï¼æ§å¶æµæ··æ·å¹³å¦å</h1>
<h3 id="ç®ä»-1">ç®ä»</h3>
<p>ä»ä¹æ¯æ§å¶æµå¹³å¦åï¼ç®åæ¥è¯´ï¼å°±æ¯è®©åæ¬åç´çæµç¨åæ¯å¹³æå°æ°´å¹³æ¹åä¸ï¼ä½¿ç¨è¿ç§æ¹æ³å¯ä»¥æé«éåé¾åº¦ï¼è½¯ä»¶æ´èé ã</p>
<pre><code>            +-----------------------+
            |        [å¼å§]          |
            |    è®¾å®åå§ç¶æ = 1     |
            +-----------|-----------+
                        |
      +----------------&gt;V&lt;----------------+
      |       +-------------------+       |
      |       |    å¾ªç¯æ§å¶ä¸­å¿     |       | 
      |       |     (ååå¨)       |       |
      |       +---------|---------+       |
      |                 |                 |
      |        _________V_________        |
      |       |                   |       |
      |       |  switch(ç¶æåé)  |       | 
      |       |___________________|       |
      |          /      |      \          |
      |         /       |       \         |
      |   [ç¶æ 1]   [ç¶æ 2]    [éåº]     |
      |   +-----+    +-----+    +-----+   |
      |   | å 1|    | å 2 |    |ç»æ |   |
      |   |     |    |     |    +-----+   |
      |   |æ´æ° |    | æ´æ°  |             |
      |   |ç¶æ |    | ç¶æ  |             |
      |   +--|--+    +--|--+              |
      |      |          |                 |
      +------+----------+-----------------+
</code></pre>
<h3 id="å®ç°æ§å¶æµå¹³å¦åpassçæ ¸å¿ä»£ç ">å®ç°æ§å¶æµå¹³å¦åPassçæ ¸å¿ä»£ç </h3>
<p><strong>ä»£ç æµç¨ï¼</strong><br>
è¯å«ä¸æ¶éåæ¯è·¯å¾ï¼ä»£ç åï¼-&gt; æå»ºæ§å¶éª¨æ¶ -&gt; åå§åç¶æåé -&gt; éç½®ååå¨ -&gt; éæè·³è½¬é»è¾<br>
<mark>æå°ä»£ç çè§£éé½æ æ³¨å¨æ³¨éä¸­</mark></p>
<pre><code class="language-cpp">namespace{
    struct mypass : public PassInfoMixin&lt;mypass&gt;{
        PreservedAnalyses run(Function &amp;F, FunctionAnalysisManager &amp;AM){
	        //è¿éä¸ºäºæ¼ç¤ºåªæ··æ·mainå½æ°
            if(F.getName() != "main"){
                return PreservedAnalyses::all();
            }

            errs() &lt;&lt; "My Flattening Function:" &lt;&lt; F.getName() &lt;&lt; "\n";
			
			//éè¿éåï¼è·åmainå½æ°ä¸­çææä»£ç å
            std::vector&lt;BasicBlock*&gt; OrigBBs;
            DenseMap&lt;BasicBlock*, int&gt; BBtoID;
            BasicBlock &amp;EntryBB = F.getEntryBlock();
            int id_counter = 0;

            for(BasicBlock &amp;BB : F){
	            //è¿éå»é¤é¦ä»£ç å
                if(&amp;BB == &amp;EntryBB) continue;
                //è®°å½ä»£ç åå¹¶ç»ä»£ç åæ åºå·
                //è¿éä¸»è¦æ¹ä¾¿caseä¸­ä½¿ç¨ï¼å¯ä»¥æ¯å¾å¤æçç¬ä¸æ äºçæ°å­
                OrigBBs.push_back(&amp;BB);
                BBtoID[&amp;BB] = id_counter++;
            }
			
			//å¤æ­æ¶éå°çåæ¯æ¯å¦å­å¨ï¼å¦ææ²¡æåæ¯ï¼å°±
            if(OrigBBs.empty()){
                return PreservedAnalyses::all();
            }
			
			//åå»ºå¾ªç¯æ§å¶ä»£ç å
            BasicBlock *LoopEntry = BasicBlock::Create(F.getContext(), "loop_entry", &amp;F);
            //æ§å¶æµååå¨ä»£ç å
            BasicBlock *SwitchBB = BasicBlock::Create(F.getContext(), "switch_block", &amp;F);
            //å¾ªç¯ååå¨å°¾é¨ï¼ç¨äºååºï¼å¯ä»¥ä¸ä½¿ç¨ï¼
            BasicBlock *LoopEnd = BasicBlock::Create(F.getContext(), "loop_end", &amp;F);
			
			//å¨é¦ä»£ç åä¸­ï¼åå»ºåå§ç¶æåéï¼ç¨äºè·ååå¼å§è·³è½¬çç¶æé
            IRBuilder&lt;&gt; builderEntry(&amp;EntryBB);
            Instruction *EntryTerm = EntryBB.getTerminator();
            if (EntryTerm) builderEntry.SetInsertPoint(EntryTerm);
            AllocaInst *SwitchVar = builderEntry.CreateAlloca(builderEntry.getInt32Ty(), nullptr, "switchVar");
			//è·åè·³è½¬æä»¤
            if(BranchInst *BI = dyn_cast_or_null&lt;BranchInst&gt;(EntryTerm)){
	            //å¤æ­æ¯å¦æ¯æ¡ä»¶è·³è½¬
	            //å¦ææ¯ï¼åç´æ¥è·åè·³è½¬åçä»£ç ååºå·
                if(BI-&gt;isUnconditional()){
                    BasicBlock *Target = BI-&gt;getSuccessor(0);
                    if(BBtoID.count(Target)){
                        builderEntry.CreateStore(builderEntry.getInt32(BBtoID[Target]), SwitchVar);
                    }
                    //å¦ææ¯æ¡ä»¶è·³è½¬
                    //åå»ºä¸æ¡æ¡ä»¶å¤æ­æä»¤
                }else if(BI-&gt;isConditional()){
                    Value *Cond = BI-&gt;getCondition();
                    BasicBlock *TrueBB = BI-&gt;getSuccessor(0);
                    BasicBlock *FalseBB = BI-&gt;getSuccessor(1);
                    if(BBtoID.count(TrueBB) &amp;&amp; BBtoID.count(FalseBB)){
                        Value*Select = builderEntry.CreateSelect(
                            Cond, 
                            builderEntry.getInt32(BBtoID[TrueBB]), 
                            builderEntry.getInt32(BBtoID[FalseBB]),
                            "init_state"
                        );
                        builderEntry.CreateStore(Select, SwitchVar);
                    }
                }
            }
			
			//é¦é¨åå»ºè·³è½¬-&gt;è·³è½¬å°å¾ªç¯æ§å¶å¥å£
            builderEntry.CreateBr(LoopEntry);
            //å é¤æ§çè·³è½¬æä»¤
            if(EntryTerm) EntryTerm-&gt;eraseFromParent();
			
			//åå»ºç¶æåéï¼ç¨äºæ§å¶ååå¨çèµ°å
            IRBuilder&lt;&gt; builderLoop(LoopEntry);
            LoadInst *CurrState = builderLoop.CreateLoad(builderLoop.getInt32Ty(), SwitchVar, "curr_state");
            builderLoop.CreateBr(SwitchBB);
			
			//åå»ºswitchæä»¤
            IRBuilder&lt;&gt; builderSwitch(SwitchBB);
            SwitchInst *SwitchI = builderSwitch.CreateSwitch(CurrState, LoopEnd, OrigBBs.size());
            //åå»ºcase
            //å¶ä¸­çæ è¯ç¬¦æ¯ä¸é¢æ¶éå°çä»£ç åçåºå·
            for(BasicBlock *BB :OrigBBs){
	            //ææé½è·³è½¬å°å°¾é¨
                BB-&gt;moveBefore(LoopEnd);
                SwitchI-&gt;addCase(builderSwitch.getInt32(BBtoID[BB]), BB);
            }
			
			//ç¨äºååºï¼è·³è½¬åå¾ªç¯æ§å¶å¤´é¨
            IRBuilder&lt;&gt; builderEnd(LoopEnd);
            builderEnd.CreateBr(LoopEntry);
			
			//éåæ¯ä¸ªä»£ç åï¼æå¥ä¿®æ¹ç¶æåéçæä»¤
			//è¿éæ ¹æ®ä¸ä¸ä¸ªè·³è½¬å°çä»£ç åæ¥æ è¯ç¶æåé
			//è¿éçä»£ç è·è·ååæ¬¡è·³è½¬æ°å¼ä¸æ¨¡ä¸æ ·
            for(BasicBlock *BB : OrigBBs){
                Instruction *Term = BB-&gt;getTerminator();
                IRBuilder&lt;&gt; builder(BB);
				//ç±äºè·³è½¬åä¸ºææ¡ä»¶è·³è½¬åæ æ¡ä»¶è·³è½¬
				//è¿éç§æ ·è¦åä¸ªå¤æ­
                if(BranchInst*BI = dyn_cast_or_null&lt;BranchInst&gt;(Term)){
	                
                    if(BI-&gt;isUnconditional()){
                        BasicBlock *Target = BI-&gt;getSuccessor(0);
                        if(BBtoID.count(Target)){
                            builder.SetInsertPoint(Term);
                            builder.CreateStore(builderSwitch.getInt32(BBtoID[Target]), SwitchVar);
                            builder.CreateBr(LoopEntry);
                            Term-&gt;eraseFromParent();
                        }
                    }
                    else if(BI-&gt;isConditional()){
                        BasicBlock *TrueBB = BI-&gt;getSuccessor(0);
                        BasicBlock *FalseBB = BI-&gt;getSuccessor(1);
                        if(BBtoID.count(TrueBB) &amp;&amp; BBtoID.count(FalseBB)){
                            builder.SetInsertPoint(Term);
                            Value *Select = builder.CreateSelect(
                                BI-&gt;getCondition(),
                                builder.getInt32(BBtoID[TrueBB]),
                                builder.getInt32(BBtoID[FalseBB]),
                                "next_state"
                            );
                            builder.CreateStore(Select, SwitchVar);
                            builder.CreateBr(LoopEntry);
                            Term-&gt;eraseFromParent();
                        }
                    }
                }
            }
        }
    };
}
</code></pre>
<h1 id="ç¼è¯åä½¿ç¨">ç¼è¯åä½¿ç¨</h1>
<p><mark><strong>è¿é¨åä¹åæç« è®²è¿ï¼è¿éå°±ä¸æµªè´¹ç¯å¹ï¼ä¸æçå¯ä»¥ç¿»ç</strong></mark></p>
<h1 id="ä½¿ç¨æææ¼ç¤º">ä½¿ç¨æææ¼ç¤º</h1>
<h3 id="æªä½¿ç¨æ¶">æªä½¿ç¨æ¶</h3>
<p><img alt="æ§å¶æµ3" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260205223717404-1628621907.png" class="lazyload"><br>
<img alt="æ§å¶æµ4" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260205223722896-459325263.png" class="lazyload"></p>
<h3 id="ä½¿ç¨å">ä½¿ç¨å</h3>
<p><img alt="æ§å¶æµ1" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260205223654729-2096773336.png" class="lazyload"><br>
<img alt="æ§å¶æµ2" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2450496/202602/2450496-20260205223712038-638219478.png" class="lazyload"></p>
<p><mark><strong>è³æ­¤ï¼æä»¬æåå®ç°äºæ§å¶æµå¹³å¦å</strong></mark></p>
<p><strong>å¦æâ¤åæ¬¢â¤æ¬ç³»åæç¨ï¼å°±ç¹ä¸ªå³æ³¨å§ï¼åç»­ä¸å®ææ´æ°~</strong></p>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/ClownLMe/" target="_blank">ClownLMe</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/ClownLMe/p/19581710" target="_blank">https://www.cnblogs.com/ClownLMe/p/19581710</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0020833333333333333" data-date-updated="2026-02-05 22:57">2026-02-05 22:54</span>&nbsp;
<a href="https://www.cnblogs.com/ClownLMe">ClownLMe</a>&nbsp;
éè¯»(<span id="post_view_count">1</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19581710);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19581710', targetLink: 'https://www.cnblogs.com/ClownLMe/p/19581710', title: 'LLVMçæ··æ·ä¹æ(äº)-æå¨å®ç°æ§å¶æµå¹³å¦åæ··æ·' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ [å¤§æ¨¡åå®æ 03] æè§£ Transformersï¼ä»åçå¾è§£å° HuggingFace Transformers å®æ ]]></title>
    <link>https://www.cnblogs.com/algieba/p/19581327</link>
    <guid>4bb968309d4e1032f73320d4a92e7515</guid>
    <description>
    <![CDATA[ 
		<div class="postcontent">
			    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3169973/202602/3169973-20260205193318638-616281954.png" alt="[å¤§æ¨¡åå®æ 03] æè§£ Transformersï¼ä»åçå¾è§£å° HuggingFace Transformers å®æ" class="desc_img">
        ä¼è·ä»£ç è¿ä¸å¤ï¼æä»¬è¦æåçãæ¬æä» Transformer çåºå±è§è§åºåï¼å¾è§£ä»ä½ç½®ç¼ç å°æ³¨æåæºå¶çå¨æµç¨ï¼å¹¶åºäº Kaggle å¹³å°ï¼æ·±å¥æè§£ HuggingFace Transformers åºçâéä¸è§âç»ä»¶ä¸çæåæ°ççæºã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="å¤§æ¨¡åå®æ-03-æè§£-transformersä»åçå¾è§£å°-huggingface-transformers-å®æ">[å¤§æ¨¡åå®æ 03] æè§£ Transformersï¼ä»åçå¾è§£å° HuggingFace Transformers å®æ</h1>
<blockquote>
<p><strong>æ ¸å¿æè¦ (TL;DR)</strong></p>
<ul>
<li><strong>åç</strong>ï¼å¾è§£ Transformer æ¯å¦ä½éè¿âæ³¨æåæºå¶âåâä½ç½®ç¼ç âæ¥çè§£äººç±»è¯­è¨çã</li>
<li><strong>å®æ</strong>ï¼å¨ <strong>Kaggle (å T4 GPU)</strong> ç¯å¢ä¸ï¼æè§£ HuggingFace ä»£ç çâéä¸è§âï¼Config, Tokenizer, Modelï¼ã</li>
<li><strong>æå·§</strong>ï¼ææ¡ <code>Temperature</code> å <code>Top_p</code>ï¼å­¦ä¼æ§å¶ AI çâåé åâã</li>
</ul>
</blockquote>
<h2 id="åè¨">åè¨</h2>
<p>åä½åäººä»¬ï¼å¤§å®¶å¥½ï¼è¿éæ¯é¿å°ãå¨ä¸ä¸èçâç¼ä¸¹âç¯å¢æ­å»ºä¸­ï¼å±ä»¬æåå°å°Qwen2.5æ¨¡åè¿è¡äºèµ·æ¥ï¼è·éäºã ä½æ¯ç¸ä¿¡å¤§å®¶å¯¹è¿è¡çæ¶åçé£äºåæ°é½ä»£è¡¨çä»ä¹ï¼é½è¿æ¯æµçã è¿ç¯åå®¢å°±æ¯ä¸ºæ­¤åå¤çï¼æä»¬æç®åå¿«éå¤§æ¦å°äºè§£ä¸ä¸å½åçå¤§æ¨¡åçåºå±åçï¼åç»åå¨ä¸èµ·ä»ç»éç¨çtransformersåº, å»ççä»£ç åå¦ä½å¯¹åºè¿äºçè®ºçã</p>
<h2 id="1-transformer-æç®åçå¤§æ¨¡åæ¯æä¹æèç">1. Transformer æç®åçï¼å¤§æ¨¡åæ¯æä¹æèçï¼</h2>
<p>å¤§æ¨¡ååæ®éçæºå¨å­¦ä¹ æ¨¡åä¸æ ·ï¼æ¬è´¨ä¹æ¯ä¸ä¸ªå½æ°ï¼ä¸åçæ¯ï¼ä¼ ç»æºå¨å­¦ä¹ å¯è½è¾å¥çæ¯ä¸äºæ´çå¥½çæ°æ®ï¼æ¯å¦æ¿å­çå°ºå¯¸ï¼å°æ®µï¼è´­ä¹°æ¶é¿ï¼åå¸ä¸­å¿çè·ç¦»ç­ç­æ°æ®ï¼è¾åºä¸ä¸ªé¢æµçæ¾åï¼èå¤§æ¨¡åè¾å¥çæ¯æä»¬çé®é¢ï¼æ¿å°çæ¯å¤§æ¨¡åç»åºçåç­ãä½ï¼å±ä»¬ç©¶å¶æ ¹æ¬ï¼å®ä»¬é½å¯ä»¥çä½æ¯ä¸ä¸ªå½æ°ï¼æä»¬è¾å¥ä¸äºä¸è¥¿ï¼ç»è¿è¿ç®ä¹åï¼è¾åºç»æä»¬ä¸äºä¸è¥¿ã</p>
<p>å¯¹äºå¤§æ¨¡åï¼å®çæ¬è´¨å°±æ¯ä¸ä¸ª<strong>ä¸ä¸ä¸ªå­ç¬¦é¢æµå¨</strong>ï¼æä»¬è¾å¥ä¸äºæå­ï¼å®åªè´è´£æ ¹æ®å®æè®­ç»çæµ·éæ°æ®ï¼è¾åºæç¬¦åï¼ææå¯è½çä¸ä¸ä¸ªå­ç¬¦ï¼å°±åä¸ä¸ª<strong>æå­æ¥é¾æºå¨</strong>ï¼å¶æ ¸å¿ä»»å¡åªæä¸ä¸ªï¼<strong>æ ¹æ®ä¸æï¼çä¸ä¸ä¸ªå­æ¯ä»ä¹ã</strong></p>
<p>ä¸ºäºå®ç°è¿ä¸ªç®æ ï¼Transformer æ¶æç»åäºä¸ä¸ªç²¾å¯çæµæ°´çº¿ï¼<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/01_cover.png" alt="åå«Transformerç5ä¸ªæ­¥éª¤çæ»è§å¾" loading="lazy"><br>
ä¸é¢ï¼æä»¬ä¼ç¨å¾®è¯¦ç»ä¸ç¹å°ä»ç»ä¸ä¸åä¸ªæ­¥éª¤ã</p>
<h3 id="11-ç¬¬ä¸æ­¥token-å-tokenization--æ¥å­å¸">1.1 ç¬¬ä¸æ­¥ï¼Token å (Tokenization) ââ æ¥å­å¸</h3>
<p>å¤§æ¨¡åæ¢ç¶æ¯ä¸ä¸ªå½æ°ï¼é£ä¹è¯å®æ¯éå¯¹æ°å­è¿è¡å¤ççï¼æä»¥ï¼æä»¬å°±éè¦ä¸ä¸ªæ³å­ï¼å»å°æä»¬çæå­å­ç¬¦ï¼çè³æ¯å¾çï¼åæå¤§æ¨¡åè®¤è¯çæ°å­ï¼æèè¯´å¼ éï¼åéï¼ã è¿å°±æ¯Tokenåï¼å»åè¿ä¸æ­¥æä½çå½æ°ï¼æèæ¨¡åå°±æ¯<strong>åè¯å¨ï¼Tokenizerï¼</strong>ã</p>
<p>é£ä¹<strong>Tokenizer</strong>å·ä½æ¯å¦ä½å·¥ä½çï¼å®å®éä¸å°±æ¯å°ä¸ä¸ªä¸ªçå­ç¬¦ï¼å¯¹åºæä¸ä¸ªä¸ªæ°å­ï¼æèè¯´IDï¼å°±åASCIIç ä¸æ ·ï¼ä¸è¿å®åå¾æ´é«çº§ã</p>
<p>ææ¯ä¸ä¸ªå­é½æ¾ä¸ä¸ªæ°å­å¯¹åºï¼æç¹å¥¢ä¾ï¼ç¹å«æ¯å¯¹äºè±è¯­,act, acting,action,actorå¶å®é½æç¸åçè¯æ ¹ï¼ä¸»è¦çè¯­ä¹æ¥æºäºå¶è¯æ ¹actï¼æä»¥åè¯å¨æ¯æç§è¯åï¼tokenï¼å»æåçï¼è½ææäºè¯ææè¯æ ¹ãåç¼ååç¼ç­ç­ï¼å½ç¶å·ä½å¦ä½æï¼åå³äºå­å¸å¦ä½å®ä¹ï¼å­å¸æå¤å¤§ã</p>
<p>è¿éæä»¬ç»ä¸ä¸ªç®åçä¾å­</p>
<ul>
<li><strong>è¾å¥</strong>ï¼âæç± AIâ</li>
<li><strong>å¨ä½</strong>ï¼åå -&gt; <code>["æ", "ç±", "AI"]</code> -&gt; æ¥è¡¨ -&gt; <code>[2301, 452, 1083]</code><br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/1.1_tokenization.png" alt="Tokenåçç¤ºæå¾" loading="lazy"></li>
</ul>
<h3 id="12-ç¬¬äºæ­¥embedding--ä½ç½®ç¼ç --èµäºå«ä¹ä¸é¡ºåº">1.2 ç¬¬äºæ­¥ï¼Embedding &amp; ä½ç½®ç¼ç  ââ èµäºå«ä¹ä¸é¡ºåº</h3>
<p>æäºtokenä¹åï¼æä»¬æ³ç¥éè¯åè¯çå³ç³»ï¼æä»¬æ³è¦éè¿ä¸ä¸ªå¯ä»¥éåçéå»å¤æ­ä¸¤ä¸ªè¯æ¯å¦æ¯æå³ç³»çï¼å³ç³»å¤å¤§ãè¿å°±å¼å¥äºæä»¬çä¸ä¸ä¸ªæ¨¡åï¼è¯åµå¥æ¨¡åï¼Embeddingï¼ã</p>
<ul>
<li><strong>Embedding (è¯åé)</strong>ï¼ææ¯ä¸ª ID åæä¸ä¸ªé¿é¿çåéï¼æ¯å¦ 4096 ç»´çæ°ç»ï¼ãè¿ä¸ªåéå¨æ¨¡åè®­ç»ä¹åæ¯éæºçï¼å¶åéçæµ·éçè®­ç»æ°æ®æ´ç¤¼ï¼è¶ç¸å³çè¯åéè¶é è¿ï¼è¶ä¸ç¸å³çè¯è¶è¿ç¦»ãè¿ä¸ªåéä»£è¡¨äºè¯ç<strong>å«ä¹</strong>ãæ¯å¦âç«âåâçâçåéå¨ç©ºé´éè·ç¦»å¾è¿ï¼âè¹æâåâææºâå¨æç§è¯­å¢ä¸ä¹æ´è¿ã</li>
</ul>
<p>åç¥éè¯åè¯çå³ç³»è¿ä¸å¤ï¼âæç±ä½ âåâä½ ç±æâçæ¯ä¸ä¸ªè¯é½æ¯ç¸åçï¼ä½æ¯å®ä»¬ç¡®å®å¯ä»¥ä¸ç¸å³çä¸¤ä¸ªå¥å­ï¼âå°çå¬äºæâåâæå¬äºå°çâï¼ä¹ä¼è¢«äººè§ä½âå¯ä»¥æ­£å¸¸çè§£âåâè¿äººå¥½åä¸å¯¹å²âä¸¤ç§å®å¨ä¸åççè§£ãæ¾èæè§ï¼è¯è¯­å¨å¥ä¸­çä½ç½®æ¯ä¸ä¸ªéå¸¸éè¦çä¿¡æ¯ï¼æä»¬ä¸è½å¼ä¸¢å®ï¼ä¹éè¦å°è¿ä¸é¨åä¿¡æ¯ä¼ éç»æ¨¡åè®­ç»æ¶åå»å­¦ä¹ ã</p>
<ul>
<li><strong>Positional Encoding (ä½ç½®ç¼ç )</strong>ï¼Transformer æ¯å¹¶è¡è®¡ç®çï¼å®ä¸ç¼çå®ææè¯ï¼ï¼è¿å¯¼è´å®ä¸ç¥éâæç±ä½ âåâä½ ç±æâçåºå«ãæä»¥ï¼æä»¬éè¦ç»æ¯ä¸ªè¯è´´ä¸ä¸ä¸ªâåº§ä½å·âï¼åè¯æ¨¡åè°å¨åé¢ï¼è°å¨åé¢ã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/1.2_ebedding.png" alt="Embedding &amp; ä½ç½®ç¼ç  ââ èµäºå«ä¹ä¸é¡ºåºç¤ºæå¾" loading="lazy"></li>
</ul>
<h3 id="13-ç¬¬ä¸æ­¥self-attention-èªæ³¨æå--å¯»æ¾å³ç³»">1.3 ç¬¬ä¸æ­¥ï¼Self-Attention (èªæ³¨æå) ââ å¯»æ¾å³ç³»</h3>
<p>æ¥ä¸æ¥å°±æ¯å¤§æ¨¡åççµé­ï¼æä»¬æ³ç¥éä¸å¥è¯éçæ¯ä¸ä¸ªè¯ååå¶ä»è¯åç<strong>å³èåº¦</strong>ï¼å¶å®å°±æ¯ä¸ä¸æçèç³»ãå½æ¨¡åå¤çâè¹æâè¿ä¸ªè¯æ¶ï¼å¦æä¸ä¸æéæâææºâãâåå¸ä¼âï¼æ³¨æåæºå¶ä¼åè¯æ¨¡åï¼âå¿ï¼è¿éçâè¹æâæçæ¯ç§æå¬å¸ï¼ä¸æ¯æ°´æï¼â,èªæ³¨æåæºå¶ï¼è®©æ¨¡åè½çè§£ä¸ä¸æã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/1.3-self-attention.png" alt="Self-Attention ç¤ºæå¾" loading="lazy"></p>
<h3 id="14-ç¬¬åæ­¥mlp-åé¦ç¥ç»ç½ç»--æ¶åå¸æ¶">1.4 ç¬¬åæ­¥ï¼MLP (åé¦ç¥ç»ç½ç») ââ æ¶åå¸æ¶</h3>
<p>å¦æè¯´æ³¨æåæºå¶æ¯âçâï¼é£ä¹ MLP å°±æ¯âæ³âãå®åå«å¤å±ç¥ç»åï¼è´è´£å¯¹æåå°çä¿¡æ¯è¿è¡å¤æçéçº¿æ§åæ¢åé»è¾æ¨ç,ä¹å°±æ¯ä¼ ç»çæ·±åº¦å­¦ä¹ ã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/1.4-mlp.png" alt="MLP (åé¦ç¥ç»ç½ç»)ç¤ºæå¾" loading="lazy"></p>
<h3 id="15-ç¬¬äºæ­¥decoder--softmax--è¾åºæ¦ç">1.5 ç¬¬äºæ­¥ï¼Decoder &amp; Softmax ââ è¾åºæ¦ç</h3>
<p>ç»è¿å±å±è®¡ç®ï¼æ¨¡åæç»ä¼è¾åºä¸ä¸ªåå«äºææè¯æ±ï¼æ¯å¦ 15 ä¸ä¸ªè¯ï¼ç<strong>æ¦çåè¡¨</strong>ã</p>
<ul>
<li><code>AI</code> (80%)</li>
<li><code>å</code> (10%)</li>
<li><code>ç¡</code> (5%)<br>
...<br>
æåï¼æä»¬æ ¹æ®è¿ä¸ªæ¦çåè¡¨ï¼éæ©ä¸ä¸ä¸ªè¯ã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/1.5-decoder&amp;softmax.png" alt="è¾åºæ¦ççç¤ºæå¾" loading="lazy"></li>
</ul>
<hr>
<p>è¿å°±æ¯å¤§æ¨¡åè¯è¯­æ¥é¾çåçäºã</p>
<h2 id="2-æè§£æ¨¡åæä»¶å¤¹ä¸è½½ä¸æ¥çå°åºæ¯ä»ä¹">2. æè§£æ¨¡åæä»¶å¤¹ï¼ä¸è½½ä¸æ¥çå°åºæ¯ä»ä¹ï¼</h2>
<p>çè®ºè®²å®äºï¼æä»¬æ¥ççå¨ <strong>Kaggle</strong> çæä»¶ç³»ç»éï¼è¿äºçè®ºåæäºä»ä¹æä»¶ã</p>
<p>å½ä½ ä¸è½½ä¸ä¸ªæ¨¡åï¼ä»¥ Qwen2.5-7B ä¸ºä¾ï¼æ¶ï¼æä»¶å¤¹ç»æå¦ä¸ï¼</p>
<p><img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/safetensor.png" alt="safetensoræ ¼å¼çæä»¶ç»ç»ç¤ºæå¾" loading="lazy"></p>
<h3 id="21-æ ¸å¿æ¶æconfigjson">2.1 æ ¸å¿æ¶æï¼config.json</h3>
<p><strong>config.json</strong>: æ¯å¤§æ¨¡åçèº«ä»½è¯ï¼ä¹å¯ä»¥è¯´æ¯ä½æ£è¡¨ï¼å®å¶ä¸­å°±æ¯çæ­£çæä»¬çæ¨¡åï¼å·ä½ç±åªäºå±ææï¼æ¯ä»ä¹æ¶æç±»åï¼éèå±æå¤æ·±ï¼æ³¨æåå¤´çæ°éæå ä¸ªï¼è¯è¡¨çå¤§å°æ¯å¤å°ãå¯¹äºå¤§æ¨¡åèè¨ï¼å®å°±æ¯æ¨¡åæ¬èº«ï¼ä¹æ¯<strong>éª¨æ¶</strong>ï¼å ä¸ºå¤§æ¨¡åéè¦çæ¯è®­ç»å®çåæ°ï¼æ¨¡åæ¬èº«æ¯å¾å°çã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/config.json.png" alt="config.jsonçç¤ºæå¾" loading="lazy"></p>
<h3 id="22-è¡ä¸ºé¢è®¾generation_configjson">2.2 è¡ä¸ºé¢è®¾ï¼generation_config.json</h3>
<p><strong>generation_config.json</strong>:æ¯æ¨¡åçåºåé»è®¤è®¾ç½®ã<br>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/generation_config_.png" alt="generation_configçç¤ºæå¾" loading="lazy"></p>
<h3 id="23-å¤§èæ¬èº«safetensorsåindexjson">2.3 å¤§èæ¬èº«ï¼*.safetensorså*.index.json</h3>
<p>æäºconfig.jsonä¸­çèº¯ä½ï¼æä»¬åä»<em>.safetensorså</em>.index.jsonè½½å¥çµé­ï¼è¿ææ¯æä»¬è½è¯´ä¼éçå¤§æ¨¡åã</p>
<ul>
<li><strong><code>model-xxxxx.safetensors</code></strong>ï¼è¿éé¢å­çæ¯å®æå®ç<strong>å¼ éï¼Tensorï¼æ°æ®</strong>ï¼å³æ°åäº¿ä¸ªåæ°çæµ®ç¹æ°ãä¸ºäºæ¹ä¾¿å­å¨åå è½½ï¼éå¸¸ä¼è¢«ååæå¤ä¸ª 2GB-5GB çå°æä»¶ï¼Shardï¼ã</li>
<li><strong><code>model.safetensors.index.json</code></strong>ï¼è¿æ¯ä¸å¼ <strong>èå®å¾</strong>ãå ä¸ºæéè¢«ååäºï¼æ¨¡åéè¦ç¥éâç¬¬ 5 å±çæéâå°åºèå¨åªä¸ªæä»¶éã
<ul>
<li><strong>åé¨é¿è¿æ ·</strong>ï¼<pre><code class="language-json">{
  "metadata": { "total_size": 15423653888 },
  "weight_map": {
    "model.layers.0.self_attn.q_proj.weight": "model-00001-of-00004.safetensors",
    "model.layers.20.mlp.gate_proj.weight": "model-00003-of-00004.safetensors"
  }
}
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="æ°å­åæå­çç¿»è¯å®tokenizerç¸å³æä»¶">æ°å­åæå­çç¿»è¯å®ï¼tokenizerç¸å³æä»¶</h3>
<ul>
<li><strong><code>vocab.json</code> / <code>merges.txt</code></strong>ï¼è¿æ¯æåå§ç<strong>çè¯è¡¨</strong>ãè®°å½äºææå­ãè¯æ ¹å¯¹åºç IDã</li>
<li><strong><code>tokenizer.json</code></strong>ï¼è¿æ¯ä¸ä¸ª<strong>ç¼è¯å</strong>çé«æå­å¸æä»¶ï¼åå«äºåè¯çææé»è¾ï¼Pre-tokenization, Normalization ç­ï¼ï¼å è½½éåº¦æ¯è¯»åå§ææ¬å¿«å¾å¤ã</li>
<li><strong><code>tokenizer_config.json</code> (è³å³éè¦)</strong>ï¼è¿æ¯åè¯å¨ç<strong>éç½®æä»¶</strong>ã
<ul>
<li>å®å®ä¹äº<strong>ç¹æ®ç¬¦å·</strong>ï¼Special Tokensï¼ï¼æ¯å¦åªä¸ª ID ä»£è¡¨âå¼å§âï¼åªä¸ªä»£è¡¨âç»æâã</li>
<li>å®åå«äº <strong>Chat Template (èå¤©æ¨¡æ¿)</strong>ï¼è¿æ¯ä¸æ®µ Jinja2 ä»£ç ï¼å³å®äº <code>apply_chat_template</code> å¦ä½å·¥ä½ã</li>
<li><strong>åé¨é¿è¿æ ·</strong>ï¼<pre><code class="language-json">{
  "chat_template": "{% for message in messages %}...&lt;|im_start|&gt;...",
  "eos_token": "&lt;|im_end|&gt;",
  "pad_token": "&lt;|endoftext|&gt;"
}
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="3-transformersåºå®æä»£ç ä¸­çéä¸è§">3. Transformersåºå®æï¼ä»£ç ä¸­çâéä¸è§â</h2>
<p>å¨Transformsåºä¸­ï¼æä»¬æ°¸è¿ç»ä¸å¼ä¸ä¸ªæ ¸å¿ç±»ã</p>
<p><strong>ç¯å¢åå¤ï¼</strong><br>
å¨ Kaggle å³ä¾§è®¾ç½®ä¸­ï¼ç¡®ä¿ <strong>Internet: On</strong> ä¸ <strong>Accelerator: GPU T4 x2</strong>ã</p>
<pre><code class="language-python">!pip install -U transformers accelerate bitsandbytes
</code></pre>
<h3 id="31-autotokenizer-ç¿»è¯å®">3.1 AutoTokenizer (ç¿»è¯å®)</h3>
<p>å¯¹åºçè®ºä¸­ç <strong>Token å</strong> æ­¥éª¤,åæ¨¡åæä»¶ä¸­çtokenizerç¸å³æä»¶ã</p>
<pre><code class="language-python">from transformers import AutoTokenizer

model_path = "/kaggle/input/qwen2.5/transformers/7b-instruct/1/"

# å è½½åè¯å¨
tokenizer = AutoTokenizer.from_pretrained(model_path, trust_remote_code=True)

text = "Transformer is amazing"
# 1. ç¼ç  (Encode): ææ¬ -&gt; æ°å­ ID
input_ids = tokenizer.encode(text)
print(f"åæ: {text}")
print(f"æ°å­ ID: {input_ids}")

# 2. è§£ç  (Decode): æ°å­ ID -&gt; ææ¬
decoded_text = tokenizer.decode(input_ids)
print(f"è¿å: {decoded_text}")
</code></pre>
<p>å¾å°çç»æå°ä¼æ¯è¿æ ·</p>
<pre><code class="language-bash">åæ: Transformer is amazing
æ°å­ ID: [46358, 374, 7897]
è¿å: Transformer is amazing
</code></pre>
<p><strong>å¯¹è¯æ ¼å¼ï¼Chat Template</strong><br>
å¤§æ¨¡åéè¦ç¹å®çå¯¹è¯æ ¼å¼ï¼Promptï¼ãæ¥å°æ¨¡åçåç­ï¼åç¨æ·çé®é¢ååºå, æä»¬ä¸è¬é½å¯ä»¥éè¿è½½å¥è¯­è¨æ¨¡åå¯¹åºæ¨¡æ¿ï¼ä¸åå®¶çæ¨¡åï¼å¯è½æ¨¡æ¿ä¼æä¸åï¼ï¼çè³å»æ¼è£åå²è®°å½ã</p>
<pre><code class="language-python">messages = [
    {"role": "system", "content": "ä½ æ¯ä¸ä¸ªç©çå­¦å®¶ã"},
    {"role": "user", "content": "ç¨ä¸å¥è¯è§£éç¸å¯¹è®ºã"}
]

# èªå¨åºç¨èå¤©æ¨¡æ¿
formatted_prompt = tokenizer.apply_chat_template(messages, tokenize=False, add_generation_prompt=True)
print("æ¨¡åå®éçå°çè¾å¥:\n", formatted_prompt)
</code></pre>
<p>è¿è¡ç»æå¦ä¸</p>
<pre><code class="language-bash">æ¨¡åå®éçå°çè¾å¥:
 &lt;|im_start|&gt;system
ä½ æ¯ä¸ä¸ªç©çå­¦å®¶ã&lt;|im_end|&gt;
&lt;|im_start|&gt;user
ç¨ä¸å¥è¯è§£éç¸å¯¹è®ºã&lt;|im_end|&gt;
&lt;|im_start|&gt;assistant
</code></pre>
<p>çå°è¿éï¼æä»¬ä¹è½æ´å¥½å°çè§£ï¼ä¸ºä»ä¹ä¸ä¸ªæ¬è´¨æ¯è¯è¯­æ¥é¾çæ¨¡åï¼è½å¤åºåé®é¢ï¼ç¶åååºåç­ãå ä¸ºå¨è®­ç»çè¿ç¨ä¸­ï¼æä»¬ä¼è®©ä»ç¥é&lt;|im_start&gt;è¡¨ç¤ºä¸ä¸ªmessageçå¼å§ï¼å¶ä¸­ä¼åè¯æ¨¡åï¼è¿å¥è¯æ¯è°è¯´çï¼è¿å¥è¯å¨ä»ä¹ä½ç½®ç»æï¼å®æ¥é¾çæ¶åä¹ä¼å¸¦ä¸å¼å§åç»æç¬¦å·ï¼å¨æ¨çæ¨¡åä¸­ï¼çè³ä¼å¸¦ä¸æèçæ ç­¾ã</p>
<h3 id="32-automodel-å¤§èæ¬ä½">3.2 AutoModel (å¤§èæ¬ä½)</h3>
<p>å¯¹åºçè®ºä¸­ç <strong>Embedding -&gt; Attention -&gt; MLP</strong> è®¡ç®è¿ç¨,éè¿ä»config.jsonä¸­å è½½æ¨¡åèº¯ä½ï¼å¨å è½½ä¸æ¨¡åçsafetensorçµé­æ°æ®ä»¥ågeneration_config.jsonçé»è®¤åå§å,<br>
å¨ Kaggle ä¸ï¼æä»¬æ¥æ <strong>å T4 (15GB x 2)</strong>ï¼ä¸å®è¦å©ç¨ <code>device_map="auto"</code> è®©åºèªå¨åéæ¾å­ã</p>
<pre><code class="language-python">from transformers import AutoModelForCausalLM
import torch

# å è½½æ¨¡å
model = AutoModelForCausalLM.from_pretrained(
    model_path,
    device_map="auto",      # å³é®ï¼èªå¨å°æ¨¡åååå°ä¸¤å¼  T4 æ¾å¡ä¸
    torch_dtype=torch.float16, # ä½¿ç¨åç²¾åº¦ï¼èçæ¾å­
    trust_remote_code=True
)

print(f"æ¨¡åå è½½æåï¼æ¾å­åå¸: {model.hf_device_map}")
</code></pre>
<p>è¾åºç»æä¸º</p>
<pre><code class="language-bash">æ¨¡åå è½½æåï¼æ¾å­åå¸: {'model.embed_tokens': 0, 'model.layers.0': 0, 'model.layers.1': 0, 'model.layers.2': 0, 'model.layers.3': 0, 'model.layers.4': 0, 'model.layers.5': 0, 'model.layers.6': 0, 'model.layers.7': 0, 'model.layers.8': 0, 'model.layers.9': 0, 'model.layers.10': 0, 'model.layers.11': 0, 'model.layers.12': 1, 'model.layers.13': 1, 'model.layers.14': 1, 'model.layers.15': 1, 'model.layers.16': 1, 'model.layers.17': 1, 'model.layers.18': 1, 'model.layers.19': 1, 'model.layers.20': 1, 'model.layers.21': 1, 'model.layers.22': 1, 'model.layers.23': 1, 'model.layers.24': 1, 'model.layers.25': 1, 'model.layers.26': 1, 'model.layers.27': 1, 'model.norm': 1, 'model.rotary_emb': 1, 'lm_head': 1}
</code></pre>
<h2 id="4-ææ§çæçè°èæé®">4. ææ§çæçâè°èæé®â</h2>
<p>å¨æ¨¡åè¾åºçè¿ç¨ä¸­ï¼æä»¬æä¸äºåæ°å¯ä»¥å¯¹è¾åºç»æè¿è¡è°èï¼å¯¹åºäºæä»¬è®²çè®ºé¨åçä¸­ç <strong>ç¬¬äºæ­¥ (Softmax æ¦çè¾åº)</strong>, æä»¬æä¸å ä¸ä¸ä¸ªè¯åçæ¦çåå¸äºï¼ä½æ¯æä»¬åºè¯¥å¦ä½å»éæ©å¢ï¼</p>
<h3 id="41-temperature-æ¸©åº¦">4.1 Temperature (æ¸©åº¦)</h3>
<p>æä»¬å¯ä»¥è®¾å®çTemperatureåæ°ï¼æä»¬å¨generation_config.jsonä¸­ä¹çè§è¿å®</p>
<p>å¼è¶å¤§ï¼æ´ç­ï¼æ´å·åé æ§ï¼æ´å®¹æè¾åºåç§å¤©é©¬è¡ç©ºçè¯, ä¼ç¼©å°ææè¯åçå·®è·ï¼<strong>é¨é²åæ²¾</strong>ï¼ä»¥è¾¾å°åé æ§ï¼è®©ä½æ¦ççè¯ï¼ä¹ææºä¼è¢«éä¸­ï¼å½ç¶,ä¹æ´å®¹æè¡è¯´å«éï¼åºç°å¹»è§.<br>
å¼è¶å°ï¼æ´å·ï¼æ´ä¸¥èï¼å¨æ¸©åº¦ä¸º0çæ¶åçè³ä¼åºå®è¾åºæé«çé£ä¸ªè¯ï¼å®ä¼æå¤§é«æ¦çåä½æ¦ççå·®è·ï¼<strong>èµ¢å®¶éå</strong>ï¼è®©æ¨¡åçåç­æ´ç¨³å®ï¼ä¸¥è°¨ã</p>
<h3 id="42-top_p-æ ¸éæ ·">4.2 Top_p (æ ¸éæ ·)</h3>
<p>åæ¸©åº¦ä¸åï¼æä»¬è¿æå¦ä¸ç§æ¹å¼ï¼è¿ç§æ¹å¼æ´ç±»ä¼¼äºæç½ï¼æä»¬åªè¦å¯è½æ§å80%çè¯ï¼å¨é£äºè¯éè¿è¡æéï¼è¿ä¸ªå¯è½æ§å°±æ¯Pï¼è¿ä¸ªéè¯ï¼éæ ·ï¼æ¹æ³åå«top_p(æ ¸éæ ·).<br>
ç®èè¨ä¹ï¼å¶åªå¨ç´¯ç§¯æ¦çè¾¾å° P (e.g., 0.9) çåå ä¸ªè¯ééãç´æ¥åæå°¾é¨é£äºæä½æ¦ççç¦»è°±è¯ã</p>
<h3 id="43-å®éªä¸ä¸">4.3 å®éªä¸ä¸</h3>
<p>æä»¬è¿éåå®ä¹ä¸ä¸ªå½æ°ï¼ä»¥æ¸©åº¦åtop_pä¸ºåæ°å»æµè¯ä¸åçåæ°å¯¹åç­çå½±å</p>
<pre><code class="language-python"># å®ä¹ä¸ä¸ªæµè¯å½æ°
def test_generation(temp, top_p, prompt_text):
    messages = [
        {"role": "system", "content": "ä½ æ¯ä¸ä¸ªåå«çç§å¹»å°è¯´å®¶ã"},
        {"role": "user", "content": prompt_text}
    ]
    text = tokenizer.apply_chat_template(messages, tokenize=False, add_generation_prompt=True)
    inputs = tokenizer([text], return_tensors="pt").to(model.device)

    print(f"\n======== è®¾ç½®: Temperature={temp}, Top_p={top_p} ========")

    try:
        generated_ids = model.generate(
            **inputs,
            max_new_tokens=100,  # éå¶é¿åº¦ï¼æ¹ä¾¿å¿«éçç»æ
            temperature=temp,
            top_p=top_p,
            do_sample=True,      # å¿é¡»å¼å¯éæ ·
            pad_token_id=tokenizer.eos_token_id
        )
        response = tokenizer.batch_decode(generated_ids, skip_special_tokens=True)[0]
        # åªæå°åç­é¨å
        print(response.split('assistant')[-1].strip())
    except Exception as e:
        print(f"çæåºé: {e}")
</code></pre>
<h3 id="æ¸©åº¦å®éª">æ¸©åº¦å®éª</h3>
<p>ç¶ååå¶ä¸æ°å»ºcode blockå»æµè¯ï¼ççææ</p>
<pre><code class="language-python">prompt = "è¯·ç¨è¿ä¸ä¸ªè¯åä¸ä¸ªå¾®æäºï¼éå­ãå¤±æãçé¥­ã"

# 1. ä½æ¸©æ¨¡å¼ (0.1)ï¼ä¸¥è°¨ãæ­»æ¿
test_generation(temp=0.1, top_p=0.9, prompt_text=prompt)

# 2. éä¸­æ¨¡å¼ (0.7)ï¼æ­£å¸¸ãæµç
test_generation(temp=0.7, top_p=0.9, prompt_text=prompt)

# 3. é«æ¸©æ¨¡å¼ (1.5)ï¼ç¯çãæ··ä¹±
# æ³¨æï¼å¯è½ä¼è¾åºä¹±ç æå®å¨ä¸éé¡ºçå¥å­
test_generation(temp=1.5, top_p=0.9, prompt_text=prompt)
</code></pre>
<p>è¿æ¯æçè¿è¡ç»æ</p>
<pre><code class="language-bash">======== è®¾ç½®: Temperature=0.1, Top_p=0.9 ========
å¨éå­ä¸çéï¼æ¶é´ä¸ç©ºé´çæ¦å¿µåå¾æ¨¡ç³ä¸æ¸ï¼èææçä¸çä¹å ä¸ºä¸æ®µå¤±è´¥çææèåå¾ä¸çæ··æ²ãä»å°è¯çç¨éå­çº ç¼ çè®ºæ¥ä¿®å¤èªå·±ç ´ç¢çå¿çµï¼å´æå¤å°å°èªå·±ä»ç°å®ä¸çéå¥äºä¸ä¸ªå¹³è¡å®å®ã

å¨è¿ä¸ªå¹³è¡å®å®ä¸­ï¼ææåç°äºä¸å®¶ç¹å«çé¤é¦ï¼è¿éçå¨å¸æ¯ä¸ä½æ¾ç»çæäººï¼å¥¹æ­£å¨ä¸ºä¸ä½é¡¾å®¢åå¤ä¸éç¹å«ççé¥­ãè¿éçé¥­ä¸ä»è²é¦å³ä¿±å¨ï¼è¿

======== è®¾ç½®: Temperature=0.7, Top_p=0.9 ========
å¨éå­ä¸ççè¾¹ç¼ï¼ææç¬èªä¸äººåå¨ä¸å®¶ä¸èµ·ç¼çå°é¤é¦éï¼é¢åæ¯ä¸ç¢æ®éççé¥­ãä»åå¥³æååæçåå ï¼æ¯å ä¸ºå¥¹æ²è¿·äºèæç°å®ä¸­çéå­ä¸çï¼èä»å´å¯¹ç°å®ä¸çåæ»¡äºçæã

å°±å¨å å¤©åï¼ä»ä»¬æåä¸æ¬¡äºåµåï¼å¥¹åè¯ä»ï¼âææ¾å°äºçæ­£çèªæââä¸ä¸ªç©¿æ¢­å¨éå­ä¸ççæ¢ç´¢èãâå¥¹çä¸äºä¸çæªåå®ççé¥­ï¼ç¶åæ¶å¤±å¨äºèæç°å®ä¸­ã

æææçé£ççé¥­ï¼

======== è®¾ç½®: Temperature=1.5, Top_p=0.9 ========
æ é¢ï¼æ¶ç©ºæ³¡é¥­

æææè¿å¤±æäºï¼æ¯å¤©åªè½ç®ä¸å¤§éæ³¡é¥­æ¥æ¶ç£¨æ¶é´ã

è¿å¤©æææ­£å¨åé¥­ï¼ä»å¿½ç¶æ¥æ¶å°ä¸æ¡éå­ä¿¡å·ãä»æå¥å°åç°é£æ¯èªå·±å¤±æåå¥³åçåæ ä½ç½®ãæ³å°è½ä¸èªå·±ç¸ç±è¿çäººå±åº¦æ¶åæ¯å¤ä¹ç¾å¦çäºæï¼ä»ä¾¿å°èªå·±ç®äºä¸éæ³¡é¥­éè¿äºåæ ä¼ éå¨ã

ç»æå´æ¯ä¸éçé¥­ã

ææç¾æä¸è§£ã
</code></pre>
<h3 id="top_på®éª">top_på®éª</h3>
<p>æ¥ä¸æ¥æ¯top_p</p>
<pre><code class="language-python">prompt_2 = "è¯·ç»ä¸ç§ä¸å­å¨çé¢è²èµ·ä¸ªåå­ï¼å¹¶æè¿°å®çæ ·å­ã"

# 1. æçªéæ · (0.01)ï¼åªéæ¦çæé«çé£ä¸ªè¯ï¼è¿ä¼¼è´ªå©ªæç´¢ï¼
test_generation(temp=0.8, top_p=0.01, prompt_text=prompt_2)

# 2. å®½å¹¿éæ · (0.95)ï¼åè®¸ç½è§è¯åºç°
test_generation(temp=0.8, top_p=0.95, prompt_text=prompt_2)
</code></pre>
<p>è¾åºç»æä¸º</p>
<pre><code class="language-bash">======== è®¾ç½®: Temperature=0.8, Top_p=0.01 ========
è¿ç§ä¸å­å¨çé¢è²æå½åä¸ºâæå°ç´«âãå®æ¯ä¸ç§æ¢¦å¹»è¬çé¢è²ï¼ä»äºç´«è²åé¶è²ä¹é´ï¼ä»¿ä½æ¯å®å®ä¸­æ æ°å¾®å°çæè¾°ç¢çå¨éªçæ¶ææ£ååºçåèãå¨ä¸åçåçº¿ä¸ï¼æå°ç´«ä¼åç°åºä¸åçè²è°ï¼ææ¶åç´«ï¼ææ¶åé¶ï¼ææ¶ååæ¯æºæäºç¹ç¹æåçæ·¡èè²ãå®æ¢ç¥ç§åä¼éï¼ä»¿ä½è½è®©äººæåå°å®å®çæµ©çä¸æ·±éã

======== è®¾ç½®: Temperature=0.8, Top_p=0.95 ========
è¿ç§ä¸å­å¨çé¢è²æç§°ä¹ä¸ºâæéå¹»å½©âï¼Stellar Mirageï¼ãå¨è§è§ä¸ï¼å®å¹¶éåä¸è²è°ï¼èæ¯ä¸ç§å¨æååçè²å½©ç»åï¼åæ¯æ æ°å¾®å°çåç¹å¨ç¼åéªçåå¹»ï¼è¿äºåç¹åå«äºææå¯è§åè°±çé¢è²ï¼åæ¶åå¸¦çä¸ç§ç¥ç§çãä¸å¯åç¶çè²å½©ã

å½è§å¯èæ³¨è§çâæéå¹»å½©âçæ¶åï¼ä»å¯ä»¥çå°èãç»¿ãç´«ç­é¢è²å¿«éå°å¨ç¼ååæ¢åæ··åï¼å®ä»¬ä»¥ä¸ç§å 
</code></pre>
<h2 id="5-å®æ´-transformers-ä»£ç å®æ">5. å®æ´ Transformers ä»£ç å®æ</h2>
<p>æææç§¯æ¨æ­å¨ä¸èµ·ï¼è¿å°±æ¯ä¸æ®µæ åçæ¨¡åæ¨çä»£ç ï¼</p>
<pre><code class="language-python">import torch
from transformers import AutoModelForCausalLM, AutoTokenizer

# 1. è®¾ç½®æ¨¡å ID
model_id = "/kaggle/input/qwen2.5/transformers/7b-instruct/1/"

# 2. å è½½ç¿»è¯å®
tokenizer = AutoTokenizer.from_pretrained(model_id, trust_remote_code=True)

# 3. å è½½å¤§è (åå¡æ¨¡å¼)
model = AutoModelForCausalLM.from_pretrained(
    model_id,
    device_map="auto",
    torch_dtype=torch.float16,
    trust_remote_code=True
)

# 4. åå¤è¾å¥
prompt = "è¯·ç¨è¿ä¸ä¸ªè¯åä¸ä¸ªå¾®å°è¯´ï¼Kaggleãæ·±å¤ãçæ¾å­"
messages = [
    {"role": "system", "content": "ä½ æ¯ä¸ä¸ªå¹½é»çç¨åºåã"},
    {"role": "user", "content": prompt}
]

text = tokenizer.apply_chat_template(messages, tokenize=False, add_generation_prompt=True)
model_inputs = tokenizer([text], return_tensors="pt").to(model.device)

# 5. çæ (è°èåæ°ï¼)
print(" æ­£å¨çæ...")
generated_ids = model.generate(
    **model_inputs,
    max_new_tokens=512,
    temperature=0.8,  # ç¨å¾®æç¹åæ
    top_p=0.9,        # åé¤ç¦»è°±è¯
    do_sample=True    # å¿é¡»å¼å¯éæ ·ï¼æ¸©åº¦æçæ
)

# 6. è§£ç å¹¶è¾åº
generated_ids = [
    output_ids[len(input_ids):] for input_ids, output_ids in zip(model_inputs.input_ids, generated_ids)
]
response = tokenizer.batch_decode(generated_ids, skip_special_tokens=True)[0]

print("-" * 20)
print(f" åç­:\n{response}")
print("-" * 20)
</code></pre>
<p>è¿æ¯è¾åºç»æ</p>
<pre><code class="language-bash">Loadingâcheckpointâshards:â100%
â4/4â[00:13&lt;00:00,ââ3.27s/it]
The module name  (originally ) is not a valid Python identifier. Please rename the original module to avoid import issues.
WARNING:accelerate.big_modeling:Some parameters are on the meta device because they were offloaded to the cpu.
 æ­£å¨çæ...
--------------------
 åç­:
å¨ä¸ä¸ªå¯å·çæ·±å¤ï¼æé·åå¨ä»é£é´å æ»¡åå¡ç½åä»£ç æä»¶çæ¿é´éï¼å±å¹ä¸æ¯Kaggleç«èµçæ°æ®éãä»æ­£å°è¯è®­ç»ä¸ä¸ªå¤æçæ·±åº¦å­¦ä¹ æ¨¡åãç¶èï¼å°±å¨ä»è®¤ä¸ºèå©å¨æçæ¶åï¼âå¶~âçä¸å£°ï¼æ¾ç¤ºå¨ç¬é´åæäºä¸çæ¼é»ï¼ä¼´éçä¸å£°æ²å£®çâçæ¾å­äºâã

æé·æäºæç¼çï¼ççç¼åä¸çç©ºç½çå±å¹ï¼å¿ä¸­åæ»¡äºæ«è´¥æï¼ä½ä»è½¬å¿µä¸æ³ï¼âè¿å¥½ä¸æ¯âçåå­äºâï¼å¦åæè¿å°èæ§çµèå¯è½å°±è¦å½»åºéä¼äºãâäºæ¯ï¼ä»åå¼å§è°æ´åæ°ï¼å¸æè½å¨è¿ä¸ªæ·±å¤éæ¾å°é£ä¸ªéèå¨æ°æ®æµ·æ´ä¸­çå®èã
--------------------
</code></pre>
<h3 id="hint">Hint:</h3>
<p><strong>ææçä»£ç ï¼é½å¯ä»¥å¨ <a href="https://www.kaggle.com/code/thaodinhoio/llm03-transformers" target="_blank" rel="noopener nofollow">è¿ä¸ªç¬è®°æ¬</a>ä¸­ç´æ¥è·åè¿è¡å¦</strong></p>
<h2 id="6-å¸¸è§é®é¢-qa">6. å¸¸è§é®é¢ (Q&amp;A)</h2>
<p><strong>Q: å¨ Kaggle ä¸ <code>device_map="auto"</code> æ¯å¿é¡»çåï¼</strong><br>
<strong>A:</strong> å¦æä½ ä½¿ç¨åå¡ T4 (15GB) è· 7B æ¨¡åï¼çº¦ 14GBï¼ï¼åå¼ºè½å¡è¿ä¸å¼ å¡ãä½å¦æä½ å¼å¯äº Kaggle ç <strong>T4 x2</strong>ï¼ä¸ºäºå©ç¨å¨é¨ 30GB æ¾å­ï¼<strong>å¿é¡»</strong>å è¿ä¸ªåæ°ï¼å¦åæ¨¡ååªä¼å¡è¿ç¬¬ä¸å¼ å¡ï¼å¯¼è´ç¬¬ä¸å¼ çæ»¡ï¼ç¬¬äºå¼ å´è§ã</p>
<p><strong>Q: ä¸ºä»ä¹çæçæ¯ä¸å¥è¯é½ä¸ä¸æ ·ï¼</strong><br>
<strong>A:</strong> å ä¸ºæä»¬å¼å¯äº <code>do_sample=True</code> å¹¶ä¸è®¾ç½®äº <code>temperature &gt; 0</code>ãæ¨¡åå¨éæ©ä¸ä¸ä¸ªè¯æ¶æ¯<strong>ææ¦çéæºæ½å</strong>çãå¦æä½ æ³è®©ç»ææ¯æ¬¡é½ä¸æ ·ï¼æ¯å¦åæ°å­¦é¢ï¼ï¼è¯·è®¾ç½® <code>do_sample=False</code>ï¼æ­¤æ¶æ¸©åº¦å¤±æï¼åä¸ºè´ªå©ªè§£ç ï¼ã</p>
<p><strong>Q: ä»ä¹æ¯ Logitsï¼</strong><br>
<strong>A:</strong> å¨ä»£ç æ·±å¤ï¼æ¨¡åè¾åºçé£ä¸ªâæ¦çè¡¨âå¨åæç¾åæ¯ä¹åï¼å« Logitsï¼æªå½ä¸åçæ°å¼ï¼ãSoftmax å½æ°çä½ç¨å°±æ¯æ Logits åææ¦çãä½ å¯ä»¥æ Logits çè§£ä¸ºæ¨¡åå¯¹æ¯ä¸ªè¯çâåå§æåâã</p>
<p><strong>Q: Token åå­æ¯ä¸ä¸å¯¹åºçåï¼</strong><br>
<strong>A:</strong> ä¸ä¸å®ã</p>
<ul>
<li>è±æï¼éå¸¸ä¸ä¸ªåè¯æ¯ä¸ä¸ª Tokenï¼é¿åè¯å¯è½è¢«ååã</li>
<li>ä¸­æï¼éå¸¸ä¸ä¸ªæ±å­æ¯ä¸ä¸ª Tokenï¼ä½å¸¸è§è¯ï¼å¦âä½ å¥½âï¼å¯è½ä¼åå¹¶ä¸ºä¸ä¸ª Tokenã</li>
<li>å¹³åæ¥è¯´ï¼<strong>0.75 ä¸ªè±æåè¯ â 1 Token</strong>ï¼<strong>1 ä¸ªæ±å­ â 1.5 - 2 Token</strong>ï¼åå³äºåè¯å¨æçï¼Qwen çä¸­æåç¼©çå¾é«ï¼ã</li>
</ul>
<hr>
<p><strong>æ¬æä½èï¼</strong> Algieba<br>
<strong>æ¬æé¾æ¥ï¼</strong> <a href="https://blog.algieba12.cn/llm03-know-more-about-transformer-lib/" target="_blank" rel="noopener nofollow">https://blog.algieba12.cn/llm03-know-more-about-transformer-lib/</a><br>
<strong>çæå£°æï¼</strong> æ¬åå®¢æææç« é¤ç¹å«å£°æå¤ï¼åéç¨ BY-NC-SA è®¸å¯åè®®ãè½¬è½½è¯·æ³¨æåºå¤ï¼</p>
<pre><code>
</code></pre>


</div>
<div class="clear"></div>

		</div>
		<div class="itemdesc">
			åè¡¨äº 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-05 19:34">2026-02-05 19:33</span>&nbsp;
<a href="https://www.cnblogs.com/algieba">é¿å°çä»£ç å±</a>&nbsp;
éè¯»(<span id="post_view_count">33</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19581327);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19581327', targetLink: 'https://www.cnblogs.com/algieba/p/19581327', title: '[å¤§æ¨¡åå®æ 03] æè§£ Transformersï¼ä»åçå¾è§£å° HuggingFace Transformers å®æ' })">ä¸¾æ¥</a>

		</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºï¼èªç¶è¯­è¨å¤ç  ç¬¬ä¸å¨ï¼åºåæ¨¡åä¸æ³¨æåæºå¶ è¯¾åä¹ é¢ä¸ä»£ç å®è·µ ]]></title>
    <link>https://www.cnblogs.com/Goblinscholar/p/19579899</link>
    <guid>959916bbe6acf6a4c35f0ec3e1333a6e</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Goblinscholar/p/19579899" title="åå¸äº 2026-02-05 16:34">
    <span role="heading" aria-level="2">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºï¼èªç¶è¯­è¨å¤ç  ç¬¬ä¸å¨ï¼åºåæ¨¡åä¸æ³¨æåæºå¶ è¯¾åä¹ é¢ä¸ä»£ç å®è·µ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ­¤åç±»ç¨äºè®°å½å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨çå­¦ä¹ ç¬è®°ã<br>
è¯¾ç¨ç¸å³ä¿¡æ¯é¾æ¥å¦ä¸ï¼</p>
<ol>
<li>åè¯¾ç¨è§é¢é¾æ¥ï¼<a href="https://www.bilibili.com/video/BV1FT4y1E74V?buvid=XU762317353676D786954061C192FE625463B&amp;from_spmid=playlist.playlist-detail.0.0&amp;is_story_h5=false&amp;mid=zqernykrmpf7XfIorMR%2FnA%3D%3D&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=ce0bc526-db69-428a-962e-c65ed8c267bc&amp;share_source=COPY&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1713085655&amp;unique_k=DfBgvFW&amp;up_id=8654113&amp;vd_source=e035e9878d32f414b4354b839a4c31a4" target="_blank" rel="noopener nofollow">[åè¯­å­å¹]å´æ©è¾¾æ·±åº¦å­¦ä¹ deeplearning.ai</a></li>
<li>githubè¯¾ç¨èµæï¼å«è¯¾ä»¶ä¸ç¬è®°:<a href="https://github.com/robbertliu/deeplearning.ai-andrewNG" target="_blank" rel="noopener nofollow">å´æ©è¾¾æ·±åº¦å­¦ä¹ æå­¦èµæ</a></li>
<li>è¯¾ç¨éå¥ç»ä¹ ï¼ä¸­è±ï¼ä¸ç­æ¡ï¼<a href="https://blog.csdn.net/u013733326/article/details/79827273" target="_blank" rel="noopener nofollow">å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾åä¹ é¢ä¸ç­æ¡</a></li>
</ol>
<p>æ¬ç¯ä¸ºç¬¬äºè¯¾ç¬¬ä¸å¨çè¯¾åä¹ é¢åä»£ç å®è·µé¨åã</p>
<hr>
<h1 id="1çè®ºä¹ é¢">1.çè®ºä¹ é¢</h1>
<p><a href="https://blog.csdn.net/u013733326/article/details/90144255" target="_blank" rel="noopener nofollow">ãä¸­è±ããå´æ©è¾¾è¯¾åæµéªãCourse 5 - åºåæ¨¡å - ç¬¬ä¸å¨æµéª</a></p>
<p>å¨è¿ä¸å¨çä¹ é¢åå®¹ä¸­æä¸éé¢çç¸å³åå®¹éè¦å±å¼ï¼åçä¸ä¸é¢é¢ï¼</p>
<blockquote>
<p>ç½ç»éè¿å­¦ä¹ æ³¨æååæ°æ¥å³å®ãææ³¨æåæ¾å¨åªéãï¼è¿äºå¼æ¯ç±ä¸ä¸ªå°ç¥ç»ç½ç»è®¡ç®å¾å°çã<br>
è¿éï¼æä»¬<strong>ä¸è½</strong>æ <span class="math inline">\(s^{&lt;t-1&gt;}\)</span> æ¿æ¢æ <span class="math inline">\(s^{&lt;t&gt;}\)</span> ä½ä¸ºè¿ä¸ªç¥ç»ç½ç»çè¾å¥ï¼<br>
åå å¦ä¸ï¼å ä¸º <span class="math inline">\(s^{&lt;t&gt;}\)</span> ä¾èµäºå½åçæ³¨æåæéï¼èå½åçæ³¨æåæéåä¾èµäºæ³¨æååæ°ï¼å æ­¤å¨éè¦è®¡ç®æ³¨æååæ°çæ¶å»ï¼<span class="math inline">\(s^{&lt;t&gt;}\)</span> <strong>å°æªè¢«è®¡ç®åºæ¥</strong>ï¼ æ­¤æ¶åªè½ä½¿ç¨åä¸æ¶å»çéèç¶æ <span class="math inline">\(s^{&lt;t-1&gt;}\)</span>ï¼èæ æ³ä½¿ç¨å½åç <span class="math inline">\(s^{&lt;t&gt;}\)</span>ã<br>
<strong>ç­æ¡ï¼æ­£ç¡®</strong></p>
</blockquote>
<p>è¿éé¢ä¸ç¼çä¸æ¥æ¯å¾è¿·æçï¼è¿æ¯<strong>å ä¸ºè¿éé¢è®²çæ¯ææ©çæ³¨æåæºå¶çé»è¾ï¼åæä»¬å¨çè®ºé¨åä»ç»çä¸»æµé»è¾ææä¸å</strong>ã<br>
å¨<a href="https://www.cnblogs.com/Goblinscholar/p/19563950" target="_blank">çè®ºé¨å</a>ï¼æä»¬ä»ç»çæ³¨æåæºå¶ï¼å­¦ä¹ æ³¨æååæ°çç½ç»çè¾å¥å°±æ¯ <span class="math inline">\(s^{&lt;t&gt;}\)</span> ï¼ä½å¨ææ©çæ³¨æåæºå¶ä¸­ï¼å®çè¾å¥æ¯ <span class="math inline">\(s^{&lt;t-1&gt;}\)</span>ã<br>
å¶ä¼ æ­é»è¾å¯ä»¥ç¨ä¸å¥è¯æ»ç»ï¼<strong>å¨å½åæ¶é´æ­¥ä¸­ï¼åå§æ³¨æåæºå¶å°ç±ä¸ä¸æ¶å»è§£ç ç¶æè®¡ç®å¾å°çä¸ä¸æåé <span class="math inline">\(c^{&lt;t&gt;}\)</span> ä½ä¸ºè§£ç å¨è¾å¥çä¸é¨åï¼ç¨äºè®¡ç®å½åè§£ç ç¶æ <span class="math inline">\(s^{&lt;t&gt;}\)</span>ã</strong><br>
æä»¬å±å¼å¦ä¸ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260205162801516-704399919.png" alt="image.png" loading="lazy"><br>
14 å¹´çåè®ºæä½¿ç¨çå°±æ¯è¿ç§ä¼ æ­æ¹å¼ï¼å·æå¼åæ§ä»·å¼ãä½å¨ç°ä»£ï¼è¿ç§å°ä¸ä¸æåéç´æ¥çº³å¥ç¶æéæ¨çåæ³æ´å¤åªå·æåå²æä¹ï¼äºè§£å³å¯ã</p>
<h1 id="2ä»£ç å®è·µ">2.ä»£ç å®è·µ</h1>
<p><a href="https://blog.csdn.net/u013733326/article/details/97619187" target="_blank" rel="noopener nofollow">ãä¸­æããå´æ©è¾¾è¯¾åç¼ç¨ä½ä¸ãCourse 5 - åºåæ¨¡å - ç¬¬ä¸å¨ä½ä¸</a><br>
è¿æ¯åæé¾æ¥ï¼è¿ç¯éåä¸»å°±æºå¨ç¿»è¯åè§¦åè¯æ£æµä¸¤é¨ååå®¹ï¼éå¸¸è¯¦ç»å°æ¼ç¤ºäºæ¬å¨çåå®¹ï¼ä½è¿æ¯è¦æ³¨æ Keras çå¯¼åæ´æ°é®é¢ã<br>
æä»¬åæ ·ä½¿ç¨æ¡æ¶æ¥æ¼ç¤ºè¿é¨ååå®¹ï¼ä¸»è¦åå®¹å¦ä¸ï¼</p>
<ol>
<li><strong>ä½¿ç¨ç¼ç è§£ç æ¡æ¶è¿è¡æ¥ææ ¼å¼ç¿»è¯</strong></li>
<li><strong>å¨ç¼ç è§£ç æ¡æ¶ä¸å¯¹æ¯è´ªå¿è§£ç åææç´¢æ§è½</strong></li>
<li><strong>ä½¿ç¨å¸¦æ³¨æåæºå¶çç¼ç è§£ç æ¡æ¶è¿è¡æ¥ææ ¼å¼ç¿»è¯</strong></li>
</ol>
<h2 id="21-æ°æ®åå¤">2.1 æ°æ®åå¤</h2>
<p>éè¦è¯´æçæ¯ï¼ç±äº <strong>seq2seq æ¨¡åèªèº«çç¼ç âè§£ç ç»æ</strong> ä»¥å <strong>åºåæ°æ®çæ¶åºç¹æ§</strong>ï¼è¿ç±»ä»»å¡ç¸æ¯è®¸å¤å¸¸è§çç£å­¦ä¹ ä»»å¡ï¼éå¸¸<strong>å¯¹è®¡ç®èµæºææ´é«çè¦æ±</strong>ã<br>
ä»¥æºå¨ç¿»è¯ä»»å¡ä¸ºä¾ï¼ç½ç»ä¸å­å¨å¤§éå¬å¼æ°æ®éï¼å¦è±æ³ç¿»è¯ãä¸­è±ç¿»è¯ç­ãç±äºè¿ç±»æ°æ®è·åç¸å¯¹å®¹æï¼åæ¶èªç¶è¯­è¨æ¬èº«å·æ<strong>è¯æ±è§æ¨¡å¤§ãè¡¨è¾¾å½¢å¼å¤æ ·</strong>çç¹ç¹ï¼æ¨¡åå¨è®­ç»è¿ç¨ä¸­å¾å¾éè¦åæ¶ç»´æ¤<strong>æºè¯­è¨è¯å¸åç®æ è¯­è¨è¯å¸</strong>ï¼å¶è§æ¨¡éå¸¸è³å°è¾¾å° <strong>æ°ä¸çº§å«</strong>ãè¿ç´æ¥å¯¼è´æ¨¡åå¨åæ°è§æ¨¡ãè®¡ç®éä»¥åæ¾å­å ç¨ç­æ¹é¢çææ¬æ¾èæåã<br>
å æ­¤ï¼è¿æ¬¡æä»¬éç¨ä¸ç§ç¸å¯¹ç®åçæºå¨ç¿»è¯ä»»å¡ââ<strong>æ¥ææ ¼å¼ç¿»è¯</strong>ï¼è¯¥ç±»ä»»å¡çä¸»è¦ç¹ç¹å¨äº<strong>è¯å¸è§æ¨¡å°ãè¾å¥è¾åºç»ææ¸æ°ãè¯­ä¹æ­§ä¹æå°</strong>ï¼å¯ä»¥è¾é«æçå°æ¼ç¤ºæ¬å¨åå®¹ã</p>
<p>è¿æ¬¡æä»¬ä¸ä½¿ç¨ç½ä¸å¬å¼çæ°æ®éï¼èæ¯æå±å´æ©è¾¾èå¸å¨ç¼ç¨ä½ä¸éçé»è¾ï¼è¿è¡<strong>äººå·¥åææ°æ®</strong>ã<br>
æä»¬éè¿è®¾è®¡å¥½çèæ¬ï¼çæ <strong>10000 æ¡</strong> ä»¥ä¸æ ¼å¼çç¸å³æ°æ®åå¯¹åºæ ç­¾å¹¶ä¿å­ä¸ºæä»¶ï¼</p>
<pre><code class="language-python">HUMAN_TEMPLATES = [  
    "{day} {month} {year}",  
    "{month} {day}, {year}",  
    "{day} of {month}, {year}",  
    "{month} {day} {year}",  
    "{day}/{month_num}/{year_short}",  
    "{month_num}/{day}/{year_short}",  
    "{weekday}, {day} {month_abbr} {year}",  
    "{month_abbr} {day}th {year_short}",  
    "{year}-{month_num}-{day}",  
    "The {day}{day_suffix} of {month}, {year}",  
    "{day}th {month_abbr}, {year}",  
    "{month} the {day}{day_suffix}, {year}",  
    "Date: {year}/{month_num}/{day}",  
    "{day} in Roman: {roman_day} {month} {year}",  
    "{month_abbr}. {day}, '{year_short}",  
]
</code></pre>
<p>å®æ´ä»£ç æ¾å¨éå½ï¼æå°å æ¡çææ°æ®å¦ä¸ï¼</p>
<pre><code>[1] The 28th of April, 1975  ==&gt;  1975-04-28
[2] Date: 2017/05/5  ==&gt;  2017-05-05
[3] Jan 10th 44  ==&gt;  1944-01-10
[4] Tuesday, 6 Nov 2096  ==&gt;  2096-11-06
[5] The 26th of August, 2089  ==&gt;  2089-08-26
[6] Date: 2061/08/18  ==&gt;  2061-08-18
[7] 08/4/35  ==&gt;  1935-08-04
[8] 27 of May, 1948  ==&gt;  1948-05-27
[9] 8 of April, 1907  ==&gt;  1907-04-08
[10] November 11, 1937  ==&gt;  1937-11-11
</code></pre>
<p>åå¤å¥½æ°æ®åï¼æä»¬ä¾¿å¯ä»¥è¿è¡ä¸ä¸æ­¥åå®¹ã</p>
<h2 id="22-æ¨¡åè®¾è®¡">2.2 æ¨¡åè®¾è®¡</h2>
<p>å¨<a href="https://www.cnblogs.com/Goblinscholar/p/19547898" target="_blank">æ¬å¨ç¬¬ä¸ç¯</a>åå®¹éæä»¬å°±æå°è¿ï¼ç¼ç è§£ç æ¡æ¶ä¸çç½ç»ç»æå®éä¸æ¯åå«è®¾è®¡çä¸¤ä¸ªå­ç½ç»ï¼å¨ä»£ç é»è¾ä¸­ï¼å°±æ¯<strong>ååå«å®ä¹è®¾è®¡ç¼ç å¨åè§£ç å¨ï¼åå¨æ´ä½ç½ç»ä¸­è°ç¨</strong>ãæä»¬åç¹å±å¼å¦ä¸ï¼</p>
<h4 id="1ç¼ç å¨">ï¼1ï¼ç¼ç å¨</h4>
<pre><code class="language-python">class Encoder(nn.Module):
    def __init__(self, vocab_size, emb_dim, hidden_dim):
        super().__init__()
        # åµå¥å±
        self.embedding = nn.Embedding(vocab_size, emb_dim)
        # ä½¿ç¨åå LSTM
        self.lstm = nn.LSTM(emb_dim, hidden_dim, batch_first=True, bidirectional=True)
    def forward(self, x):
        embedded = self.embedding(x) 
        outputs, (hidden, cell) = self.lstm(embedded)
        # outputs: LSTM å¯¹æ¯ä¸ªæ¶é´æ­¥çè¾åº,ç¨äºæ³¨æåçç¸å³è®¡ç®ã
        # (hidden,cell): æåæ¶é´æ­¥çéèç¶æåç»èç¶æï¼æ¯è§£ç å¨çåå§è¾å¥ã
        return outputs, (hidden, cell)

</code></pre>
<h4 id="2è§£ç å¨">ï¼2ï¼è§£ç å¨</h4>
<pre><code class="language-python">class Decoder(nn.Module):
    def __init__(self, vocab_size, emb_dim, hidden_dim, use_attention=False):
        super().__init__()
        # è®¾ç½®åæ°ï¼é»è®¤ä¸ä½¿ç¨æ³¨æåæºå¶
        self.use_attention = use_attention
        # åµå¥å±
        self.embedding = nn.Embedding(vocab_size, emb_dim)
        # LSTM 
        self.lstm = nn.LSTM(emb_dim, hidden_dim, batch_first=True)
        if use_attention:
            # æ³¨æåè¯åå±ï¼å°è§£ç å¨ hidden ä¸ç¼ç å¨ outputs æ¼æ¥è®¡ç®æ³¨æååæ°
            self.attn = nn.Linear(hidden_dim + hidden_dim * 2, 1)
            # æ³¨æåç»åå±ï¼å°è§£ç å¨ hidden ä¸ä¸ä¸æåéèåä¸ºæç» LSTM è¾åº
            self.attn_combine = nn.Linear(hidden_dim + hidden_dim * 2, hidden_dim)

        # è¾åºå±ï¼å° LSTM è¾åºæ å°å°è¯è¡¨ç»´åº¦ï¼é¢æµä¸ä¸ä¸ª token
        self.out = nn.Linear(hidden_dim, vocab_size)

    def forward(self, input_step, hidden_cell, encoder_outputs):
        embedded = self.embedding(input_step)
        # LSTM ååè®¡ç®ï¼å¾å°å½åæ¶é´æ­¥è¾åºåæ°ç hidden/cell
        lstm_out, hidden_cell = self.lstm(embedded, hidden_cell)
        # å»ææ¶é´ç»´åº¦ï¼æ¹ä¾¿æ³¨æåè®¡ç®
        query = lstm_out.squeeze(1)

        if self.use_attention:
            # æ©å± queryï¼å®éä¸å°±æ¯æå½åè§£ç éèç¶æå¤å¶å°åç¼ç éèç¶ææ°ç¸åã
            query_exp = query.unsqueeze(1).repeat(1, encoder_outputs.size(1), 1)
            # è®¡ç®æ³¨æååæ°
            attn_scores = self.attn(torch.cat((query_exp, encoder_outputs), dim=-1)).squeeze(-1)
            # è½¬ä¸ºæ³¨æåæé
            attn_weights = F.softmax(attn_scores, dim=-1).unsqueeze(1)
            # è®¡ç®ä¸ä¸æåé bmm:æ¹éç©éµä¹æ³
            context = torch.bmm(attn_weights, encoder_outputs).squeeze(1)
            # å° query ä¸ä¸ä¸æåéèå
            combined = torch.cat((query, context), dim=1)
            output = torch.tanh(self.attn_combine(combined))
        else:
            # ä¸ä½¿ç¨æ³¨æåæ¶ï¼ç´æ¥ç¨ LSTM è¾åºé¢æµ
            output = query

        # è¾åºå±
        output = self.out(output)
        return output, hidden_cell
</code></pre>
<h4 id="3æ´ä½ç½ç»">ï¼3ï¼æ´ä½ç½ç»</h4>
<pre><code class="language-python">class Seq2Seq(nn.Module):  
    def __init__(self, encoder, decoder):  
        super().__init__()  
        # ç¼ç å¨åè§£ç å¨ç´æ¥ä½ä¸ºåå§ååæ°ï¼å¨ä¸»å½æ°ä¸­åå»ºä¼ å¥
        self.encoder = encoder  
        self.decoder = decoder 
         
    def forward(self, src, tgt):  
        # src:æ ·æ¬ tgt:æ ç­¾
        # ç¼ç å¨
        enc_outputs, (hidden, cell) = self.encoder(src)

        # è¿éæ¯åå¹¶åå LSTM ç hidden/cell
        # å°ä¸¤ä¸ªæ¹åç hidden/cell å¨å±ç»´åº¦ä¸åå¼ï¼åæ±åææ¼æ¥ä½ä¸ºè§£ç å¨åå§ç¶æ
        hidden = hidden.view(2, -1, hidden.size(-1)).sum(dim=0, keepdim=True)
        cell   = cell.view(2, -1, cell.size(-1)).sum(dim=0, keepdim=True)
        dec_hidden = (hidden, cell)  # è§£ç å¨åå§ç¶æ

        outputs = []  # å­å¨æ¯ä¸ªæ¶é´æ­¥çè¾åº

        # è§£ç å¨
        for t in range(tgt.size(1)):
            # è®­ç»é»è¾ï¼æ¯æ­¥ä½¿ç¨çå®æ ç­¾ä½ä¸ºè¾å¥
            out, dec_hidden = self.decoder(
                tgt[:, t].unsqueeze(1), dec_hidden, enc_outputs
            )
            # tgt[:, t] å ä¸ºæ¹æ¬¡è®­ç»ï¼æ¯æ¬¡è¦å»åç¬¬ t å
            # out: å½åæ¶é´æ­¥é¢æµç token æ¦çåå¸ [batch_size, vocab_size]
            # dec_hidden: æ´æ°åçè§£ç å¨éèç¶æ
            outputs.append(out)  # ä¿å­å½åè¾åº

        # å°æææ¶é´æ­¥è¾åºå å ä¸ºæç»ç»æã
        return torch.stack(outputs, dim=1)

</code></pre>
<p>è¿æ ·æä»¬å°±å®æäºæ¨¡åçè®¾è®¡ï¼ç»§ç»­ä¸ä¸é¨ååå®¹ã</p>
<h2 id="23-è§£ç å½æ°">2.3 è§£ç å½æ°</h2>
<p>è¿æ¯çè®ºé¨åæå°çï¼å¨æ¨çé¶æ®µï¼è§£ç å¨çè¾åºå¶å®æ¯ä¸ç³»åçæ¦çåå¸ï¼æä»¬<strong>ä½¿ç¨è§£ç å½æ°ï¼å°±æ¯è®¾è®¡ç¸åºçæç´¢ç­ç¥æ¥å¯»æ¾æå¤§çèåæ¦çï¼å¾å°æç»è¾åºã</strong><br>
è¿éï¼æä»¬å®ä¹å®æ´çè§£ç å½æ°ï¼<strong>ä¸»é»è¾ä¸ºè´ªå¿è§£ç ï¼è¡¥åææç´¢çç¸å³é»è¾å¹¶éè¿åæ°éæ©æ¯å¦ä½¿ç¨</strong>ï¼</p>
<pre><code class="language-python">def decode(model, input_tensor, use_beam_search=False, beam_width=3, max_len=20):
    """
    åæ°ï¼
    - model: å·²è®­ç»ç Seq2Seq æ¨¡åï¼åå« encoder å decoderï¼
    - input_tensor: è¾å¥åºåç tensorï¼ä¸ä¸ªæ ·æ¬ï¼
    - use_beam_search: æ¯å¦ä½¿ç¨ææç´¢
    - beam_width: ææç´¢æ¶çåéæ°é
    - max_len: è§£ç æå¤§é¿åº¦
    """
    model.eval()  # è¯ä¼°æ¨¡å¼
    with torch.no_grad():  
        input_tensor = input_tensor.unsqueeze(0) 
        # ç¼ç å¨ä¼ æ­
        enc_outputs, (hidden, cell) = model.encoder(input_tensor)
        hidden = hidden.view(2, -1, hidden.size(-1)).sum(dim=0, keepdim=True)
        cell   = cell.view(2, -1, cell.size(-1)).sum(dim=0, keepdim=True)
        dec_hidden = (hidden, cell)  # è§£ç å¨åå§ç¶æ
        
        # è´ªå¿è§£ç 
        if not use_beam_search:
            # åå§è§£ç è¾å¥ï¼SOSï¼åå§ç¬¦ï¼è¿éæ¯ç®åä¸ºäº \t
            dec_input = torch.tensor([[target_token_index['\t']]], device=device)
            result = []
            for _ in range(max_len):
                # è§£ç å¨ä¼ æ­
                out, dec_hidden = model.decoder(dec_input, dec_hidden, enc_outputs)
                # åå½åæ¶é´æ­¥æå¤§æ¦çç token
                pred = out.argmax(dim=-1)
                token = pred.item()
                if token == target_token_index['\n']:  # éå° EOS åæ­¢ï¼åæ ·ç®åä¸º\n
                    break
                result.append(reverse_target_char_index[token])  # ä¿å­å­ç¬¦
                dec_input = pred.unsqueeze(0)  # ä¸ä¸æ­¥è¾å¥ä¸ºå½åé¢æµï¼å³èªåå½ã

            return ''.join(result)  # è¿åè§£ç åçå­ç¬¦ä¸²

       
        # ææç´¢
        candidates = [([target_token_index['\t']], 0.0, dec_hidden)]  # åå§ååéåºå
        for _ in range(max_len):
            new_cands = []
            for seq, score, h in candidates:
                # å¦æåºåå·²éå° EOSï¼ä¿çåé
                if seq[-1] == target_token_index['\n']:
                    new_cands.append((seq, score, h))
                    continue
                # å½åæ¶é´æ­¥è¾å¥
                inp = torch.tensor([[seq[-1]]], device=device)
                out, new_h = model.decoder(inp, h, enc_outputs)
                # è®¡ç® log æ¦ç
                log_probs = F.log_softmax(out, dim=-1).squeeze(0)
                # å top-k åé
                top_vals, top_idx = log_probs.topk(beam_width)
                for v, idx in zip(top_vals, top_idx):
                    new_seq = seq + [idx.item()]  # æ©å±åºå
                    new_score = score + v.item()  # æ´æ°ç´¯ç§¯ log æ¦ç
                    new_cands.append((new_seq, new_score, new_h))
            # æç´¯ç§¯æ¦çæåºï¼ä¿çå beam_width ä¸ªåºå
            candidates = sorted(new_cands, key=lambda x: x[1], reverse=True)[:beam_width]
        # æç»éæ©æ¦çæé«çåºå
        best = candidates[0][0]
        # å»ææ§å¶ç¬¦ï¼è½¬æ¢ä¸ºæç»å­ç¬¦
        return ''.join(reverse_target_char_index.get(i, '') 
                       for i in best[1:] if i != target_token_index['\n'])

</code></pre>
<p>è§£ç çé»è¾ä¹è¢«ä½¿ç¨å¨ä¹åçè¯ä¼°ç¯èä¸­ã</p>
<h2 id="24-è¯ä¼°ææ belu-åå®å¨å¹éç">2.4 è¯ä¼°ææ ï¼BELU åå®å¨å¹éç</h2>
<p>èªç¶ï¼å¨å®æè®­ç»åï¼æä»¬è¦æç¸åºçææ æ¥è¿è¡è¯ä¼°ï¼é¦åå°±æ¯æä»¬å¨çè®ºé¨åä»ç»ç BELU ï¼å®éè¿è®¡ç®è¾åºåæ ç­¾å¨ä¸åå°ºåº¦ä¸çå¹éåº¦æ¥è¯ä¼°æ¨¡åææã<br>
ä½æ¯ï¼æä»¬è¯´ï¼BELU è¿ç±»è¯­è¨ææ ä½¿ç¨çåå æ¯å ä¸ºå­å¨âåä¹ä¸åå½¢âçæåµã<br>
è<strong>å¨æ¥æç¿»è¯éï¼ç¿»è¯ç»ææ¯å¯ä¸çï¼éä¸ä¸ªæ°å­å°±æ¯å®å¨ä¸åçä¸å¤©ã</strong><br>
å æ­¤ï¼æä»¬åæå·¥å®ä¹ä¸ä¸ªå®å¨å¹éçï¼è¾åºåæ ç­¾åªæç¸ååä¸ç¸åä¸¤ç§æåµã<br>
è¿æ ·ï¼<strong>æä»¬ä½¿ç¨ BELU æ¥è¯ä¼°åºåæ¨¡åæåçå¤§è´ææï¼åç¨å®å¨å¹éçæ¥è§å¯å¨æ¥æç¿»è¯ä»»å¡ä¸­æ¨¡åççæ­£æ§è½ã</strong></p>
<pre><code class="language-python">from nltk.translate.bleu_score import sentence_bleu, SmoothingFunction
# BLEU
def evaluate_bleu(model, test_enc_input, test_targets, use_beam_search=False, beam_width=3):
    total_bleu = 0
    # BLEU å¹³æ»æ¹æ³ï¼é¿åç­å¥å¯¼è´åæ°è¿ä½
    smoother = SmoothingFunction().method4

    for i in range(len(test_enc_input)):
        # ä½¿ç¨ decode å½æ°çæé¢æµåºå
        pred = decode(model, test_enc_input[i], use_beam_search, beam_width)
        # å»æç®æ åºåçèµ·å§ç¬¦åç»æç¬¦
        true = test_targets[i][1:-1]
        # BLEU æ¥ååè¡¨å½¢å¼ï¼ref æ¯åèåºååè¡¨ï¼hyp æ¯é¢æµåºå
        ref = [list(true)]
        hyp = list(pred)
        # è®¡ç®å½åæ ·æ¬ BLEU åæ°
        bleu = sentence_bleu(ref, hyp, smoothing_function=smoother)
        total_bleu += bleu

    # å¹³å BLEU åæ°ï¼å¹¶è½¬æ¢ä¸ºç¾åæ¯
    avg_bleu = total_bleu / len(test_enc_input) * 100
    print(f"BLEU: {avg_bleu:.2f}")
    return avg_bleu

# å®å¨å¹éç
def evaluate_exact_match(model, test_enc_input, test_targets, use_beam_search=False, beam_width=3):
    correct = 0
    total = len(test_enc_input)
    for i in range(total):
        pred = decode(model, test_enc_input[i], use_beam_search, beam_width)
        true = test_targets[i][1:-1]
        # å¤æ­é¢æµä¸çå®æ¯å¦å®å¨ä¸è´
        if pred == true:
            correct += 1
    acc = correct / total * 100
    print(f"å®å¨å¹éç: {acc:.2f}%")
    return acc

</code></pre>
<p><strong>è¿éåå¼åä¸¤ä¸ªææ æ¹ä¾¿æ¼ç¤ºååç¬è°ç¨ï¼å®éä¸ï¼æäºèçååé¨åé»è¾åå¨ä¸èµ·æ¯æ´é«æçåæ³ã</strong><br>
å°æ­¤ï¼éè¦å¼ºè°çé¨åå°±å¨é¨å®ä¹å®æ¯ï¼æä»¬å¼å§æ­£å¼è¿è¡ã</p>
<h2 id="25-è¿è¡ææ">2.5 è¿è¡ææ</h2>
<p>æä»¬è®¾ç½®åæ°å¦ä¸ï¼</p>
<pre><code class="language-python">EMB_DIM = 64  
HIDDEN_DIM = 256  
EPOCHS = 10  
BATCH_SIZE = 128  
LR = 0.001
</code></pre>
<p>ä¸é¢ï¼å°±æ¥åæåµççææï¼</p>
<h4 id="1ä¸ä½¿ç¨æ³¨æåæºå¶ä½¿ç¨è´ªå¿è§£ç ">ï¼1ï¼ä¸ä½¿ç¨æ³¨æåæºå¶ï¼ä½¿ç¨è´ªå¿è§£ç </h4>
<p>å¨è¿ä¸ªæ¡ä»¶ä¸ï¼æä»¬å®ä¹ä¸»å½æ°å¦ä¸ï¼</p>
<pre><code class="language-python">if __name__ == "__main__":  
	EMB_DIM = 64  
	HIDDEN_DIM = 256  
	EPOCHS = 10  
	BATCH_SIZE = 128  
	LR = 0.001
	# å³é®è®¾ç½®
    USE_ATTENTION    = False  
    USE_BEAM_SEARCH  = False  
    BEAM_WIDTH       = 3  
  
    print(f"\n=== éç½® ===")  
    print(f"ä½¿ç¨æ³¨æå: {USE_ATTENTION}")  
    print(f"ä½¿ç¨ææç´¢: {USE_BEAM_SEARCH} (beam width = {BEAM_WIDTH if USE_BEAM_SEARCH else 'No'})")  
  
    encoder = Encoder(num_encoder_tokens, EMB_DIM, HIDDEN_DIM).to(device)  
    decoder = Decoder(num_decoder_tokens, EMB_DIM, HIDDEN_DIM, use_attention=USE_ATTENTION).to(device)  
    model = Seq2Seq(encoder, decoder).to(device)  
  
    print("\nå¼å§è®­ç»...")  
    train_time = train(model, epochs=EPOCHS, batch_size=BATCH_SIZE, lr=LR)  
  
    print("\nè¯ä¼°ä¸­...")  
    bleu = evaluate_bleu(model, test_encoder_input, test_targets,  
                         use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  
    exact_acc = evaluate_exact_match(model, test_encoder_input, test_targets,  
                                     use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  
  
	print("\n=== æ½åæµè¯æ ·æ¬è¾åº ===")  
	sample_indices = random.sample(range(len(test_encoder_input)), 10)  
	for i in sample_indices:  
	    src = test_inputs[i]  
	    true = test_targets[i][1:-1]  
	    pred,_ = decode(model, test_encoder_input[i],  
	                  use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  
	    print(f"Human  : {src} | True  : {true} | Predicted  : {pred}")
</code></pre>
<p>ç»æå¦ä¸ï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260205162800621-1772145123.png" alt="image.png" loading="lazy"></p>
<p>å¾çäºä»»å¡æ¬èº«ååææ°æ®è¾ä¸ºç®åï¼å¯ä»¥åç°ææ è¿ä¸éï¼æä»¬ä¸çæ¥åæ ï¼ç»§ç»­ä¸ä¸æ­¥è®¾ç½®è¿è¡å¯¹æ¯ã</p>
<h4 id="2ä¸ä½¿ç¨æ³¨æåæºå¶ä½¿ç¨ææç´¢">ï¼2ï¼ä¸ä½¿ç¨æ³¨æåæºå¶ï¼ä½¿ç¨ææç´¢</h4>
<p>è¿æ¬¡ï¼è®¾ç½®ä¸»å½æ°åæ°å¦ä¸ï¼</p>
<pre><code class="language-python">USE_ATTENTION    = False  
USE_BEAM_SEARCH  = True # ä½¿ç¨ææç´¢ 
BEAM_WIDTH       = 3 # æå®½
</code></pre>
<p>ççç»æï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260205162801820-1581242608.png" alt="image.png" loading="lazy"></p>
<p>ææ å¥½åæææåï¼ä½ä¹å¯è½æ¯è®­ç»ä¸­çå¶ç¶æ§ï¼æä»¬åå¢å æå®½ççï¼</p>
<pre><code class="language-python">BEAM_WIDTH       = 10 
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260205162800857-1336184228.png" alt="image.png" loading="lazy"><br>
å¯ä»¥åç°ï¼<strong>éçæå®½çå¢å ï¼è§£ç æ¶é´ææ¾å¢å ï¼èææ æµ®å¨ä¸å¤§</strong>ï¼è¿è¯´æéå¶ææ çå³é®å ç´ å¯è½ä¸æ¯æç´¢ç­ç¥ã<br>
ç±æ­¤ï¼æä»¬è¿å¥ä¸ä¸æ­¥ï¼</p>
<h4 id="3ä½¿ç¨æ³¨æåæºå¶">ï¼3ï¼ä½¿ç¨æ³¨æåæºå¶</h4>
<p>ç°å¨ï¼è®¾ç½®åæ°å¦ä¸ï¼</p>
<pre><code class="language-python">USE_ATTENTION    = True # ä½¿ç¨æ³¨æåæºå¶  
USE_BEAM_SEARCH  = True  
BEAM_WIDTH       = 3 
</code></pre>
<p>ççç»æï¼<br>
<img src="https://img2024.cnblogs.com/blog/3708248/202602/3708248-20260205162800597-1996349670.png" alt="image.png" loading="lazy"></p>
<p>å¥½åä¹æ²¡ä»ä¹ç¨åï¼ ä½ ä¼åç°ï¼<strong>ä½¿ç¨æ³¨æåæºå¶åï¼è®­ç»æ¶é´å ç¸å³è®¡ç®ææ¾å¢å ï¼ä½æ¯ææ å¹¶æ²¡æææ¾æåã</strong><br>
å®éä¸ï¼è¿åæä»¬çæ¥æç¿»è¯ä»»å¡æ¬èº«çç¹ç¹æå³ï¼</p>
<ol>
<li><strong>è¾å¥è¾åºåºåè¾ç­</strong>ï¼æ¯ä¸ªæ ·æ¬éå¸¸åªæ 5~15 ä¸ªå­ç¬¦å·¦å³ï¼LSTM å¾å®¹æå¨æ²¡ææ³¨æåçæåµä¸å°±ææå°åºåæ´ä½ä¿¡æ¯ã</li>
<li><strong>ä¿¡æ¯å¯¹é½è¾ç®å</strong>ï¼æ¥æç¿»è¯æ¬è´¨ä¸æ¯å­ç¬¦çº§çå¯¹é½æ å°ï¼ä¾å¦ âJan 5, 2003â â â2003-01-05âï¼å ä¹ä¸å­å¨å¤æçé¿è·ç¦»ä¾èµã</li>
</ol>
<p>æ³¨æåæºå¶æææ¾çä½ç¨æ¯å¨åºåè¾é¿æè¾å¥è¾åºå³ç³»å¤ææ¶ï¼å¸®å©è§£ç å¨èç¦å°ç¸å³çç¼ç ç¶æãèå¯¹äºç°å¨è¿ç§ç­åºåãè§åæ§å¼ºçä»»å¡ï¼å¶è®¡ç®ææ¬å¢å ï¼èå¸¦æ¥çæ§è½æåå¾æéã</p>
<p>å¨è¿ä¸ªä»»å¡ä¸­ï¼æ³è¦ææ ç»§ç»­å¢å ï¼æä¸ä¸ªå¾ç®åçæ¹æ³å°±æ¯<strong>å¨èæ¬ä¸­å¢å æä»¬äººå·¥åæçæ°æ®é</strong>ï¼å°±ä¸åå±ç¤ºäºã</p>
<p><strong>è³æ­¤ï¼å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºè¯¾åäºå¨çåå®¹å°±å¨é¨ç»æäºï¼ä¹åä¼åºä¸ä¸ªå®æ´çç®å½ã</strong></p>
<h1 id="3-éå½">3. éå½</h1>
<h2 id="31-æ°æ®åæ">3.1 æ°æ®åæ</h2>
<pre><code class="language-python">import torch
import random
import numpy as np
from datetime import datetime, timedelta
from sklearn.model_selection import train_test_split

device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
PAD_TOKEN = "&lt;PAD&gt;"

MONTHS_FULL = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
]
MONTHS_ABBR = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
               "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]

HUMAN_TEMPLATES = [
    "{day} {month} {year}",
    "{month} {day}, {year}",
    "{day} of {month}, {year}",
    "{month} {day} {year}",
    "{day}/{month_num}/{year_short}",
    "{month_num}/{day}/{year_short}",
    "{weekday}, {day} {month_abbr} {year}",
    "{month_abbr} {day}th {year_short}",
    "{year}-{month_num}-{day}",
    "The {day}{day_suffix} of {month}, {year}",
    "{day}th {month_abbr}, {year}",
    "{month} the {day}{day_suffix}, {year}",
    "Date: {year}/{month_num}/{day}",
    "{day} in Roman: {roman_day} {month} {year}",
    "{month_abbr}. {day}, '{year_short}",
]

def roman_numeral(n):
    vals = (10, 9, 5, 4, 1)
    nums = ('X', 'IX', 'V', 'IV', 'I')
    result = ""
    for v, r in zip(vals, nums):
        while n &gt;= v:
            result += r
            n -= v
    return result

def random_date(start_year=1900, end_year=2100):
    start = datetime(start_year, 1, 1)
    end = datetime(end_year, 12, 31)
    delta = end - start
    return start + timedelta(days=random.randint(0, delta.days))

def human_readable_date(date):
    template = random.choice(HUMAN_TEMPLATES)
    day = date.day
    month_idx = date.month - 1
    month_full = MONTHS_FULL[month_idx]
    month_abbr = MONTHS_ABBR[month_idx]
    year = date.year
    month_num = str(date.month).zfill(2)
    year_short = str(year % 100).zfill(2)
    weekday = date.strftime("%A")

    day_suffix = "th"
    if day % 10 == 1 and day != 11: day_suffix = "st"
    elif day % 10 == 2 and day != 12: day_suffix = "nd"
    elif day % 10 == 3 and day != 13: day_suffix = "rd"

    day_str = str(day)
    roman_day = roman_numeral(day) if random.random() &lt; 0.2 else day_str

    return template.format(
        day=day_str,
        day_suffix=day_suffix,
        month=month_full,
        month_abbr=month_abbr,
        year=year,
        month_num=month_num,
        year_short=year_short,
        weekday=weekday,
        roman_day=roman_day
    )

def machine_readable_date(date):
    return date.strftime("%Y-%m-%d")

def generate_date_pair():
    d = random_date()
    return human_readable_date(d), machine_readable_date(d)


NUM_SAMPLES = 10000
input_texts, target_texts = [], []

for _ in range(NUM_SAMPLES):
    human, machine = generate_date_pair()
    input_texts.append(human)
    target_texts.append('\t' + machine + '\n')

train_inputs, test_inputs, train_targets, test_targets = train_test_split(
    input_texts, target_texts, test_size=0.2, random_state=42
)

all_input_chars = [PAD_TOKEN] + sorted(set(''.join(input_texts)))
all_target_chars = [PAD_TOKEN] + sorted(set(''.join(target_texts)))

input_token_index = {c: i for i, c in enumerate(all_input_chars)}
target_token_index = {c: i for i, c in enumerate(all_target_chars)}

reverse_input_char_index = {i: c for c, i in input_token_index.items()}
reverse_target_char_index = {i: c for c, i in target_token_index.items()}

max_encoder_len = max(len(txt) for txt in input_texts)
max_decoder_len = max(len(txt) for txt in target_texts)

num_encoder_tokens = len(all_input_chars)
num_decoder_tokens = len(all_target_chars)

print(f"max enc len: {max_encoder_len}, max dec len: {max_decoder_len}")
print(f"input vocab size: {num_encoder_tokens}, target vocab size: {num_decoder_tokens}")

def texts_to_tensor(texts, token_index, max_len):
    pad_idx = token_index[PAD_TOKEN]
    data = np.full((len(texts), max_len), pad_idx, dtype=np.int64)
    for i, txt in enumerate(texts):
        for t, char in enumerate(txt):
            if t &lt; max_len:
                data[i, t] = token_index[char]
    return torch.tensor(data, dtype=torch.long, device=device)

train_encoder_input = texts_to_tensor(train_inputs, input_token_index, max_encoder_len)
train_decoder_input = texts_to_tensor(train_targets, target_token_index, max_decoder_len)

test_encoder_input = texts_to_tensor(test_inputs, input_token_index, max_encoder_len)
test_decoder_input = texts_to_tensor(test_targets, target_token_index, max_decoder_len)


dataset_pt = {
    'train_encoder_input': train_encoder_input,
    'train_decoder_input': train_decoder_input,
    'test_encoder_input': test_encoder_input,
    'test_decoder_input': test_decoder_input,
    'input_token_index': input_token_index,
    'target_token_index': target_token_index,
    'reverse_input_char_index': reverse_input_char_index,
    'reverse_target_char_index': reverse_target_char_index,
    'max_encoder_len': max_encoder_len,
    'max_decoder_len': max_decoder_len,
    'num_encoder_tokens': num_encoder_tokens,
    'num_decoder_tokens': num_decoder_tokens
}

torch.save(dataset_pt, "date_dataset.pt")
print("å·²ä¿å­ï¼date_dataset.pt")



def tensor_to_numpy(t):
    return t.detach().cpu().numpy()

dataset_npz = {
    "train_encoder_input": tensor_to_numpy(train_encoder_input),
    "train_decoder_input": tensor_to_numpy(train_decoder_input),
    "test_encoder_input": tensor_to_numpy(test_encoder_input),
    "test_decoder_input": tensor_to_numpy(test_decoder_input),

    "input_token_index": np.array(input_token_index, dtype=object),
    "target_token_index": np.array(target_token_index, dtype=object),
    "reverse_input_char_index": np.array(reverse_input_char_index, dtype=object),
    "reverse_target_char_index": np.array(reverse_target_char_index, dtype=object),

    "max_encoder_len": max_encoder_len,
    "max_decoder_len": max_decoder_len,
    "num_encoder_tokens": num_encoder_tokens,
    "num_decoder_tokens": num_decoder_tokens
}

np.savez("date_dataset.npz", **dataset_npz)
print("å·²ä¿å­ï¼date_dataset.npz\n")

def decode(tensor_row, reverse_dict):
    return ''.join(
        reverse_dict[idx.item()]
        for idx in tensor_row
        if reverse_dict[idx.item()] != PAD_TOKEN
    )

print("ç¤ºä¾æ°æ®ï¼")
for i in range(20):
    src = decode(train_encoder_input[i], reverse_input_char_index)
    tgt = decode(train_decoder_input[i], reverse_target_char_index)
    print(f"[{i+1}] {src}  ==&gt;  {tgt.strip()}")
</code></pre>
<h2 id="32-æ¥ææ ¼å¼ç¿»è¯-pytorchç">3.2 æ¥ææ ¼å¼ç¿»è¯-PyTorchç</h2>
<pre><code class="language-python">import random  
import torch  
import torch.nn as nn  
import torch.nn.functional as F  
from torch import optim  
import time  
from nltk.translate.bleu_score import sentence_bleu, SmoothingFunction  
device = torch.device("cuda" if torch.cuda.is_available() else "cpu")  
  
data = torch.load("date_dataset.pt", map_location=device)  
  
train_encoder_input = data['train_encoder_input']  
train_decoder_input = data['train_decoder_input']  
test_encoder_input  = data['test_encoder_input']  
test_decoder_input  = data['test_decoder_input']  
  
input_token_index = data['input_token_index']  
target_token_index = data['target_token_index']  
reverse_target_char_index = data['reverse_target_char_index']  
  
num_encoder_tokens = data['num_encoder_tokens']  
num_decoder_tokens = data['num_decoder_tokens']  
  
max_encoder_len = data['max_encoder_len']  
max_decoder_len = data['max_decoder_len']  
  
PAD_TOKEN = "&lt;PAD&gt;"  
reverse_input_char_index = {i: c for c, i in input_token_index.items()}  
  
def tensor_to_text(tensor_row, reverse_dict):  
    return ''.join(  
        reverse_dict[idx.item()]  
        for idx in tensor_row  
        if reverse_dict[idx.item()] != PAD_TOKEN  
    )  
  
test_inputs = [tensor_to_text(test_encoder_input[i], reverse_input_char_index)  
               for i in range(len(test_encoder_input))]  
  
test_targets = [tensor_to_text(test_decoder_input[i], reverse_target_char_index)  
                for i in range(len(test_decoder_input))]  
  
class Encoder(nn.Module):  
    def __init__(self, vocab_size, emb_dim, hidden_dim):  
        super().__init__()  
        self.embedding = nn.Embedding(vocab_size, emb_dim)  
        self.lstm = nn.LSTM(emb_dim, hidden_dim, batch_first=True, bidirectional=True)  
  
    def forward(self, x):  
        embedded = self.embedding(x)  
        outputs, (hidden, cell) = self.lstm(embedded)  
        return outputs, (hidden, cell)  
  
class Decoder(nn.Module):  
    def __init__(self, vocab_size, emb_dim, hidden_dim, use_attention=False):  
        super().__init__()  
        self.use_attention = use_attention  
        self.embedding = nn.Embedding(vocab_size, emb_dim)  
        self.lstm = nn.LSTM(emb_dim, hidden_dim, batch_first=True)  
  
        if use_attention:  
            self.attn = nn.Linear(hidden_dim + hidden_dim * 2, 1)  
            self.attn_combine = nn.Linear(hidden_dim + hidden_dim * 2, hidden_dim)  
  
        self.out = nn.Linear(hidden_dim, vocab_size)  
  
    def forward(self, input_step, hidden_cell, encoder_outputs):  
        embedded = self.embedding(input_step)  
        lstm_out, hidden_cell = self.lstm(embedded, hidden_cell)  
  
        query = lstm_out.squeeze(1)  
  
        if self.use_attention:  
            query_exp = query.unsqueeze(1).repeat(1, encoder_outputs.size(1), 1)  
            attn_scores = self.attn(torch.cat((query_exp, encoder_outputs), dim=-1)).squeeze(-1)  
            attn_weights = F.softmax(attn_scores, dim=-1).unsqueeze(1)  
            context = torch.bmm(attn_weights, encoder_outputs).squeeze(1)  
            combined = torch.cat((query, context), dim=1)  
            output = torch.tanh(self.attn_combine(combined))  
        else:  
            output = query  
  
        output = self.out(output)  
        return output, hidden_cell  
  
class Seq2Seq(nn.Module):  
    def __init__(self, encoder, decoder):  
        super().__init__()  
        self.encoder = encoder  
        self.decoder = decoder  
  
    def forward(self, src, tgt):  
        enc_outputs, (hidden, cell) = self.encoder(src)  
        hidden = hidden.view(2, -1, hidden.size(-1)).sum(dim=0, keepdim=True)  
        cell   = cell.view(2, -1, cell.size(-1)).sum(dim=0, keepdim=True)  
        dec_hidden = (hidden, cell)  
        outputs = []  
  
        for t in range(tgt.size(1)):  
            out, dec_hidden = self.decoder(tgt[:, t].unsqueeze(1), dec_hidden, enc_outputs)  
            outputs.append(out)  
  
        return torch.stack(outputs, dim=1)  
  
def train(model, epochs=10, batch_size=128, lr=0.001):  
    enc_optimizer = optim.Adam(model.encoder.parameters(), lr=lr)  
    dec_optimizer = optim.Adam(model.decoder.parameters(), lr=lr)  
    criterion = nn.CrossEntropyLoss(ignore_index=0)  
  
    start_time = time.time()  
  
    for epoch in range(epochs):  
        total_loss = 0  
        num_batches = 0  
        perm = torch.randperm(len(train_encoder_input))  
        for i in range(0, len(train_encoder_input), batch_size):  
            idx = perm[i:i+batch_size]  
            enc_in = train_encoder_input[idx]  
            dec_in_full = train_decoder_input[idx]  
            dec_in = dec_in_full[:, :-1]  
            dec_target = dec_in_full[:, 1:]  
  
            enc_optimizer.zero_grad()  
            dec_optimizer.zero_grad()  
  
            outputs = model(enc_in, dec_in)  
  
            loss = criterion(outputs.reshape(-1, num_decoder_tokens), dec_target.reshape(-1))  
            loss.backward()  
            enc_optimizer.step()  
            dec_optimizer.step()  
  
            total_loss += loss.item()  
            num_batches += 1  
  
        avg_loss = total_loss / num_batches  
        print(f"Epoch [{epoch+1}/{epochs}], Loss: {avg_loss:.4f}")  
  
    train_time = time.time() - start_time  
    print(f"è®­ç»æ»æ¶é´: {train_time:.2f} ç§")  
    return train_time  
  
import time  
  
def decode(model, input_tensor, use_beam_search=False, beam_width=3, max_len=20):  
    model.eval()  
    start_time = time.time()    
    with torch.no_grad():  
        input_tensor = input_tensor.unsqueeze(0)  
        enc_outputs, (hidden, cell) = model.encoder(input_tensor)  
        hidden = hidden.view(2, -1, hidden.size(-1)).sum(dim=0, keepdim=True)  
        cell   = cell.view(2, -1, cell.size(-1)).sum(dim=0, keepdim=True)  
        dec_hidden = (hidden, cell)  
  
        if not use_beam_search:  
            dec_input = torch.tensor([[target_token_index['\t']]], device=device)  
            result = []  
            for _ in range(max_len):  
                out, dec_hidden = model.decoder(dec_input, dec_hidden, enc_outputs)  
                pred = out.argmax(dim=-1)  
                token = pred.item()  
                if token == target_token_index['\n']:  
                    break  
                result.append(reverse_target_char_index[token])  
                dec_input = pred.unsqueeze(0)  
            decoded = ''.join(result)  
  
        else:  
            candidates = [([target_token_index['\t']], 0.0, dec_hidden)]  
            for _ in range(max_len):  
                new_cands = []  
                for seq, score, h in candidates:  
                    if seq[-1] == target_token_index['\n']:  
                        new_cands.append((seq, score, h))  
                        continue  
                    inp = torch.tensor([[seq[-1]]], device=device)  
                    out, new_h = model.decoder(inp, h, enc_outputs)  
                    log_probs = F.log_softmax(out, dim=-1).squeeze(0)  
                    k = min(beam_width, log_probs.size(0))    
                    top_vals, top_idx = log_probs.topk(k)  
                    for v, idx in zip(top_vals, top_idx):  
                        new_seq = seq + [idx.item()]  
                        new_score = score + v.item()  
                        new_cands.append((new_seq, new_score, new_h))  
                candidates = sorted(new_cands, key=lambda x: x[1], reverse=True)[:beam_width]  
  
            best = candidates[0][0]  
            decoded = ''.join(reverse_target_char_index.get(i, '') for i in best[1:] if i != target_token_index['\n'])  
  
    decode_time = time.time() - start_time  
    return decoded, decode_time  
  
  
def evaluate_bleu(model, test_enc_input, test_targets, use_beam_search=False, beam_width=3):  
    total_bleu = 0  
    total_time = 0  
    smoother = SmoothingFunction().method4  
  
    for i in range(len(test_enc_input)):  
        pred, dt = decode(model, test_enc_input[i], use_beam_search, beam_width)  
        total_time += dt  
        true = test_targets[i][1:-1]  
        ref = [list(true)]  
        hyp = list(pred)  
        bleu = sentence_bleu(ref, hyp, smoothing_function=smoother)  
        total_bleu += bleu  
  
    avg_bleu = total_bleu / len(test_enc_input) * 100  
    avg_time = total_time / len(test_enc_input)  
    print(f"BLEU: {avg_bleu:.2f} | å¹³åè§£ç æ¶é´: {avg_time:.4f} ç§/æ ·æ¬")  
    return avg_bleu, avg_time  
  
  
def evaluate_exact_match(model, test_enc_input, test_targets, use_beam_search=False, beam_width=3):  
    correct = 0  
    total = len(test_enc_input)  
  
    for i in range(total):  
        pred, _ = decode(model, test_enc_input[i], use_beam_search, beam_width)    
        true = test_targets[i][1:-1]    
        if pred == true:  
            correct += 1  
  
    acc = correct / total * 100  
    print(f"å®å¨å¹éç: {acc:.2f}%")  
    return acc  
  
if __name__ == "__main__":  
    EMB_DIM = 64  
    HIDDEN_DIM = 256  
    EPOCHS = 10  
    BATCH_SIZE = 128  
    LR = 0.001  
  
    USE_ATTENTION    = True  
    USE_BEAM_SEARCH  = True  
    BEAM_WIDTH       = 3  
  
    print(f"\n=== éç½® ===")  
    print(f"ä½¿ç¨æ³¨æå: {USE_ATTENTION}")  
    print(f"ä½¿ç¨ææç´¢: {USE_BEAM_SEARCH} (beam width = {BEAM_WIDTH if USE_BEAM_SEARCH else 'No'})")  
  
    encoder = Encoder(num_encoder_tokens, EMB_DIM, HIDDEN_DIM).to(device)  
    decoder = Decoder(num_decoder_tokens, EMB_DIM, HIDDEN_DIM, use_attention=USE_ATTENTION).to(device)  
    model = Seq2Seq(encoder, decoder).to(device)  
  
    print("\nå¼å§è®­ç»...")  
    train_time = train(model, epochs=EPOCHS, batch_size=BATCH_SIZE, lr=LR)  
  
    print("\nè¯ä¼°ä¸­...")  
    bleu = evaluate_bleu(model, test_encoder_input, test_targets,  
                         use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  
    exact_acc = evaluate_exact_match(model, test_encoder_input, test_targets,  
                                     use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  
  
    print("\n=== æ½åæµè¯æ ·æ¬è¾åº ===")  
    sample_indices = random.sample(range(len(test_encoder_input)), 10)  
    for i in sample_indices:  
        src = test_inputs[i]  
        true = test_targets[i][1:-1]  
        pred,_ = decode(model, test_encoder_input[i],  
                      use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  
        print(f"Human  : {src} | True  : {true} | Predicted  : {pred}")
</code></pre>
<h2 id="33-æ¥ææ ¼å¼ç¿»è¯-tfç">3.3 æ¥ææ ¼å¼ç¿»è¯-TFç</h2>
<pre><code class="language-python">import numpy as np  
import tensorflow as tf  
from tensorflow.keras.layers import Embedding, LSTM, Dense, Bidirectional  
import random  
import time  
from nltk.translate.bleu_score import sentence_bleu, SmoothingFunction  
  
dataset = np.load("date_dataset.npz", allow_pickle=True)  
  
train_encoder_input = dataset['train_encoder_input']  
train_decoder_input = dataset['train_decoder_input']  
test_encoder_input = dataset['test_encoder_input']  
test_decoder_input = dataset['test_decoder_input']  
  
input_token_index = dataset['input_token_index'].item()  
target_token_index = dataset['target_token_index'].item()  
reverse_target_char_index = dataset['reverse_target_char_index'].item()  
  
num_encoder_tokens = int(dataset['num_encoder_tokens'])  
num_decoder_tokens = int(dataset['num_decoder_tokens'])  
max_encoder_len = int(dataset['max_encoder_len'])  
max_decoder_len = int(dataset['max_decoder_len'])  
  
reverse_input_char_index = {i: c for c, i in input_token_index.items()}  
  
PAD_TOKEN = "&lt;PAD&gt;"    
  
def tensor_to_text(tensor_row, reverse_dict):  
    return ''.join(  
        reverse_dict.get(int(idx), '')  
        for idx in tensor_row  
        if reverse_dict.get(int(idx), '') != PAD_TOKEN  
    )  
  
  
test_inputs = [tensor_to_text(test_encoder_input[i], reverse_input_char_index)  
               for i in range(len(test_encoder_input))]  
  
test_targets = [tensor_to_text(test_decoder_input[i], reverse_target_char_index)  
                for i in range(len(test_decoder_input))]  
  
class Encoder(tf.keras.Model):  
    def __init__(self, vocab_size, emb_dim, hidden_dim):  
        super(Encoder, self).__init__()  
        self.embedding = Embedding(vocab_size, emb_dim, mask_zero=True)  
        self.lstm = Bidirectional(  
            LSTM(hidden_dim, return_sequences=True, return_state=True)  
        )  
  
    def call(self, x):  
        embedded = self.embedding(x)  
        outputs, fw_h, fw_c, bw_h, bw_c = self.lstm(embedded)  
        hidden = tf.concat([fw_h, bw_h], axis=-1)  
        cell = tf.concat([fw_c, bw_c], axis=-1)  
        return outputs, (hidden, cell)  
  
  
class Decoder(tf.keras.layers.Layer):  
    def __init__(self, vocab_size, emb_dim, hidden_dim, use_attention=False):  
        super(Decoder, self).__init__()  
        self.use_attention = use_attention  
        self.embedding = Embedding(vocab_size, emb_dim, mask_zero=True)  
        self.lstm = LSTM(hidden_dim, return_sequences=False, return_state=True)  
        self.out = Dense(vocab_size)  
  
        if use_attention:  
            self.attn_W1 = Dense(hidden_dim)                 
            self.attn_W2 = Dense(hidden_dim)               
            self.attn_V  = Dense(1)  
            self.attn_combine = Dense(hidden_dim)  
  
    def call(self, input_step, hidden_cell, encoder_outputs):  
   
        embedded = self.embedding(input_step)            
        lstm_out, h, c = self.lstm(embedded, initial_state=hidden_cell)  
        query = lstm_out                                  
if self.use_attention:  
            score = self.attn_V(  
                tf.tanh(  
                    self.attn_W1(encoder_outputs) +  
                    self.attn_W2(query[:, tf.newaxis, :])  
                )  
            )                                             
  
            attn_weights = tf.nn.softmax(score, axis=1)   
  
            context = tf.reduce_sum(encoder_outputs * attn_weights, axis=1)  
            combined = tf.concat([query, context], axis=-1)  
            output = tf.tanh(self.attn_combine(combined))  
        else:  
            output = query  
  
        logits = self.out(output)                         
        return logits, (h, c)  
  
  
class Seq2Seq(tf.keras.Model):  
    def __init__(self, encoder, decoder):  
        super(Seq2Seq, self).__init__()  
        self.encoder = encoder  
        self.decoder = decoder  
  
    def call(self, src, tgt, training=True):  
        enc_outputs, (hidden, cell) = self.encoder(src)  
  
        hidden_fw, hidden_bw = tf.split(hidden, num_or_size_splits=2, axis=-1)  
        cell_fw, cell_bw = tf.split(cell, num_or_size_splits=2, axis=-1)  
  
        hidden = hidden_fw + hidden_bw  
        cell = cell_fw + cell_bw  
  
        dec_hidden = (hidden, cell)  
  
        outputs = []  
        for t in range(tgt.shape[1]):  
            step_input = tgt[:, t:t + 1]  
            logits, dec_hidden = self.decoder(  
                step_input, dec_hidden, enc_outputs  
            )  
            outputs.append(logits)  
  
        return tf.stack(outputs, axis=1)  
  
def train(model, epochs=10, batch_size=128, lr=0.001):  
    optimizer = tf.keras.optimizers.Adam(learning_rate=lr)  
    loss_fn = tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True)  
  
    start_time = time.time()  
    n_samples = len(train_encoder_input)  
  
    for epoch in range(epochs):  
        total_loss = 0.0  
        num_batches = 0  
  
        indices = np.random.permutation(n_samples)  
        enc = train_encoder_input[indices]  
        dec = train_decoder_input[indices]  
  
        for i in range(0, n_samples, batch_size):  
            enc_batch = enc[i:i + batch_size]  
            dec_batch = dec[i:i + batch_size]  
  
            dec_in = dec_batch[:, :-1]  
            dec_tgt = dec_batch[:, 1:]  
  
            with tf.GradientTape() as tape:  
                logits = model(enc_batch, dec_in, training=True)  
                loss_value = loss_fn(dec_tgt, logits)  
                loss_value += tf.reduce_sum(model.losses)  
  
            grads = tape.gradient(loss_value, model.trainable_variables)  
            optimizer.apply_gradients(zip(grads, model.trainable_variables))  
  
            total_loss += float(loss_value)  
            num_batches += 1  
  
        avg_loss = total_loss / num_batches  
        print(f"Epoch [{epoch + 1}/{epochs}], Loss: {avg_loss:.4f}")  
  
    train_time = time.time() - start_time  
    print(f"è®­ç»ç¨æ¶: {train_time:.2f} ç§")  
    return train_time  
  
@tf.function  
def greedy_decode_step(decoder, dec_input, dec_hidden, enc_outputs):  
    logits, dec_hidden = decoder(dec_input, dec_hidden, enc_outputs)  
    return logits, dec_hidden  
  
  
def decode(model, input_tensor, use_beam_search=False, beam_width=3, max_len=20):  
    dummy_src = tf.zeros((1, max_encoder_len), dtype=tf.int32)  
    dummy_tgt = tf.zeros((1, 1), dtype=tf.int32)  
    _ = model(dummy_src, dummy_tgt, training=False)  
  
    start_time = time.time()  
  
    input_tensor = tf.expand_dims(input_tensor, 0)  
    enc_outputs, (hidden, cell) = model.encoder(input_tensor)  
  
    hidden_fw, hidden_bw = tf.split(hidden, num_or_size_splits=2, axis=-1)  
    cell_fw, cell_bw = tf.split(cell, num_or_size_splits=2, axis=-1)  
  
    hidden = hidden_fw + hidden_bw  
    cell = cell_fw + cell_bw  
  
    dec_hidden = (hidden, cell)  
  
    if not use_beam_search:  
        dec_input = tf.constant([[target_token_index['\t']]], dtype=tf.int32)  
        result = []  
        for _ in range(max_len):  
            logits, dec_hidden = greedy_decode_step(  
                model.decoder, dec_input, dec_hidden, enc_outputs  
            )  
            pred = tf.argmax(logits, axis=-1)  
            token = int(pred[0])  
            if token == target_token_index.get('\n', -1):  
                break  
            result.append(reverse_target_char_index.get(token, ''))  
            dec_input = pred[:, tf.newaxis]  
  
        decoded = ''.join(result)  
  
    else:  
        candidates = [([target_token_index['\t']], 0.0, dec_hidden)]  
        for _ in range(max_len):  
            new_cands = []  
            for seq, score, h_c in candidates:  
                if seq[-1] == target_token_index.get('\n', -1):  
                    new_cands.append((seq, score, h_c))  
                    continue  
                inp = tf.constant([[seq[-1]]], dtype=tf.int32)  
                logits, new_h_c = model.decoder(inp, h_c, enc_outputs)  
                log_probs = tf.nn.log_softmax(logits, axis=-1)[0]  
                top_vals, top_idx = tf.math.top_k(log_probs, k=beam_width)  
                for v, idx in zip(top_vals, top_idx):  
                    new_seq = seq + [int(idx)]  
                    new_score = score + float(v)  
                    new_cands.append((new_seq, new_score, new_h_c))  
  
            candidates = sorted(new_cands, key=lambda x: x[1], reverse=True)[:beam_width]  
  
        best_seq = candidates[0][0]  
        decoded = ''.join(  
            reverse_target_char_index.get(i, '') for i in best_seq[1:] if i != target_token_index.get('\n', -1))  
  
    decode_time = time.time() - start_time  
    return decoded, decode_time  
  
  
def evaluate_bleu(model, test_enc_input, test_targets, use_beam_search=False, beam_width=3):  
    total_bleu = 0  
    total_time = 0  
    smoother = SmoothingFunction().method4  
  
    for i in range(len(test_enc_input)):  
        pred, dt = decode(model, test_enc_input[i], use_beam_search, beam_width)  
        total_time += dt  
        true = test_targets[i][1:-1]    
        ref = [list(true)]  
        hyp = list(pred)  
        bleu = sentence_bleu(ref, hyp, smoothing_function=smoother)  
        total_bleu += bleu  
  
    avg_bleu = total_bleu / len(test_enc_input) * 100  
    avg_time = total_time / len(test_enc_input)  
    print(f"BLEU: {avg_bleu:.2f} | å¹³åè§£ç æ¶é´: {avg_time:.4f} ç§/æ ·æ¬")  
    return avg_bleu, avg_time  
  
  
def evaluate_exact_match(model, test_enc_input, test_targets, use_beam_search=False, beam_width=3):  
    correct = 0  
    total = len(test_enc_input)  
  
    for i in range(total):  
        pred, _ = decode(model, test_enc_input[i], use_beam_search, beam_width)  
        true = test_targets[i][1:-1]  
        if pred == true:  
            correct += 1  
  
    acc = correct / total * 100  
    print(f"å®å¨å¹éç: {acc:.2f}%")  
    return acc  
  
  
if __name__ == "__main__":  
    EMB_DIM = 64  
    HIDDEN_DIM = 256   
    BATCH_SIZE = 128  
    LR = 0.001  
  
    USE_ATTENTION = True  
    USE_BEAM_SEARCH = True  
    BEAM_WIDTH = 3  
  
    print(f"\n=== éç½® ===")  
    print(f"ä½¿ç¨æ³¨æå: {USE_ATTENTION}")  
    print(f"ä½¿ç¨ææç´¢: {USE_BEAM_SEARCH} (beam width = {BEAM_WIDTH if USE_BEAM_SEARCH else 'No'})")  
  
    encoder = Encoder(num_encoder_tokens, EMB_DIM, HIDDEN_DIM)  
    decoder = Decoder(num_decoder_tokens, EMB_DIM, HIDDEN_DIM, use_attention=USE_ATTENTION)  
    model = Seq2Seq(encoder, decoder)  
  
    print("\nå¼å§è®­ç»...")  
    train_time = train(model, epochs=EPOCHS, batch_size=BATCH_SIZE, lr=LR)  
  
    print("\nè¯ä¼°ä¸­...")  
    bleu = evaluate_bleu(model, test_encoder_input, test_targets,  
                         use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  
    exact_acc = evaluate_exact_match(model, test_encoder_input, test_targets,  
                                     use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  
  
    print("\n=== æ½åæµè¯æ ·æ¬è¾åº ===")  
    sample_indices = random.sample(range(len(test_encoder_input)), 10)  
    for i in sample_indices:  
        src = test_inputs[i]  
        true = test_targets[i][1:-1]  
        pred, _ = decode(model, test_encoder_input[i],  
                         use_beam_search=USE_BEAM_SEARCH, beam_width=BEAM_WIDTH)  
        print(f"Human  : {src} | True  : {true} | Predicted  : {pred}")
</code></pre>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0020833333333333333" data-date-updated="2026-02-05 16:37">2026-02-05 16:34</span>&nbsp;
<a href="https://www.cnblogs.com/Goblinscholar">å¥å¸æå­¦è</a>&nbsp;
éè¯»(<span id="post_view_count">73</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19579899);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19579899', targetLink: 'https://www.cnblogs.com/Goblinscholar/p/19579899', title: 'å´æ©è¾¾æ·±åº¦å­¦ä¹ è¯¾ç¨äºï¼èªç¶è¯­è¨å¤ç  ç¬¬ä¸å¨ï¼åºåæ¨¡åä¸æ³¨æåæºå¶ è¯¾åä¹ é¢ä¸ä»£ç å®è·µ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ é¸¿èåºç¨å¼åUIåºç¡ç¬¬ä¸èï¼UIAbilityçå½å¨æå¨è§£æ ]]></title>
    <link>https://www.cnblogs.com/san-xiu/p/19579716</link>
    <guid>3ca5eda0bf9f7bfbdfaee80d9a97b4f5</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/san-xiu/p/19579716" title="åå¸äº 2026-02-05 15:55">
    <span role="heading" aria-level="2">é¸¿èåºç¨å¼åUIåºç¡ç¬¬ä¸èï¼UIAbilityçå½å¨æå¨è§£æ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å­¦ä¹ ç®æ ">ãå­¦ä¹ ç®æ ã</h2>
<ol>
<li>ææ¡UIAbilityæ ¸å¿çå½å¨ææ¹æ³çè§¦åæ¶æºãç³»ç»è¡ä¸ºåçº¦æè§åï¼</li>
<li>çè§£çå½å¨æä¸WindowStageçæ·±åº¦èå¨é»è¾ï¼æç¡®é¡µé¢å è½½ãäºä»¶è®¢éçæ¶æºï¼</li>
<li>ææ¡<code>onDestroy</code>åè°çç¹æ®è§¦åè§åï¼å«API 13ä¸é®æ¸çãè°è¯æ¨¡å¼ãterminateSelfè°ç¨åºæ¯ï¼ï¼</li>
<li>è½éè¿å®æéªè¯çå½å¨ææ§è¡é¡ºåºï¼ææ¡WindowStageäºä»¶çå¬çæ­£ç¡®æ¹å¼ï¼é¿åæ°æå¸¸è§æ··æ·ï¼</li>
<li>åºåâåºç¨éåå°âä¸âåºç¨éæ¯âçæ ¸å¿å·®å¼ï¼è§é¿çå½å¨æç¸å³çå¼åè¯¯åºã</li>
</ol>
<h2 id="æ¬èéç¹">ãæ¬èéç¹ã</h2>
<h3 id="1-æ ¸å¿é®é¢å¯¼å¥">1. æ ¸å¿é®é¢å¯¼å¥</h3>
<ul>
<li>åºç¨å¯å¨ãååå°ãååå°ãéåºæ¶ï¼UIAbilityä¼ç»ååªäºç¶æååï¼</li>
<li>çªå£çè·ç¦/å¤±ç¦ãåå°/åå°ç¶æè¯¥å¦ä½éè¿WindowStageäºä»¶çå¬ï¼</li>
<li>WindowStageçäºä»¶è®¢éä¸è§£ç»ï¼åå«åºå¨åªä¸ªçå½å¨ææ¹æ³ä¸­æ§è¡ï¼</li>
<li>ä¸åå³é­åºç¨çæ¹å¼ï¼æå¨è°ç¨APIãä¸é®æ¸çãè°è¯æ¨¡å¼ç§»é¤ä»»å¡ï¼å¯¹<code>onDestroy</code>è§¦åæä½å½±åï¼</li>
<li>ä¸ºä»ä¹é¡µé¢åªè½å¨<code>onWindowStageCreate</code>ä¸­å è½½ï¼ä¸è½å¨<code>onCreate</code>ä¸­å è½½ï¼</li>
</ul>
<h3 id="2-æ ¸å¿æ¦å¿µ">2. æ ¸å¿æ¦å¿µ</h3>
<p>UIAbilityçå½å¨ææ¯æUIAbilityä»åå»ºå°éæ¯çå¨æµç¨ï¼ç±ç³»ç»ç»ä¸è°åº¦ï¼åå«åå»ºãçªå£ç®¡çãååå°åæ¢ãéæ¯ç­æ ¸å¿é¶æ®µãéè¿éåçå½å¨ææ¹æ³ï¼å¯å¨ç¹å®æ¶æºå®æåå§åãèµæºç³è¯·/éæ¾ãé¡µé¢å è½½ç­æä½ï¼</p>
<p>çªå£çæ´»å¨ç¶æï¼è·ç¦/å¤±ç¦ãåå°/åå°ï¼ééè¿<code>WindowStage</code>äºä»¶çå¬å®ç°ï¼èéçå½å¨ææ¹æ³ã<br>
<code>onDestroy</code>ä½ä¸ºçå½å¨ææåä¸ä¸ªæ¹æ³ï¼å¶è§¦åä¸å¦åå³é­åºç¨çæ¹å¼ãAPIçæ¬ãåºç¨ç±»åï¼ææ å®åµçªï¼ãè¿è¡æ¨¡å¼ï¼è°è¯/æ­£å¼ï¼ç­å ç´ å½±åã</p>
<blockquote>
<p>æ¬èåå®¹å»¶ç¨<code>FirstApplication</code>å·¥ç¨,æ æ°å¢æä»¶ã ä½¿ç¨é»è®¤å¯å¨æ¨¡å¼singletonã</p>
</blockquote>
<h2 id="äºuiabilityçå½å¨ææ ¸å¿é¶æ®µä¸æ¹æ³">äºãUIAbilityçå½å¨ææ ¸å¿é¶æ®µä¸æ¹æ³</h2>
<h3 id="1-çå½å¨æå¯è§åç¤ºæå¾">1. çå½å¨æå¯è§åç¤ºæå¾</h3>
<p>çå½å¨æçå®æ´æµè½¬é»è¾å¯éè¿ä»¥ä¸ç¤ºæå¾ç´è§çè§£ï¼æ¶µçå¯å¨ãååå°åæ¢ãå³é­å¨æµç¨çæ¹æ³è§¦åé¡ºåºä¸WindowStageäºä»¶å³èï¼</p>
<p>ç¤ºæå¾è¯´æï¼å·¦ä¾§ä¸ºUIAbilityæ ¸å¿çå½å¨ææ¹æ³ï¼å³ä¾§ä¸ºå³èçWindowStageäºä»¶ï¼çªå£çè·ç¦/å¤±ç¦ãåå°/åå°ç¶æééè¿<code>windowStageEvent</code>äºä»¶çå¬å®ç°ï¼éæ¯é¶æ®µç<code>onDestroy</code>è§¦åè§åéç»åå³é­åºç¨çæ¹å¼å¤æ­ã</p>
<p><img alt="UIAbilityççå½å¨æç¤ºæå¾" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3730991/202602/3730991-20260205155157818-1758502701.png" class="lazyload"></p>
<h3 id="2-æ ¸å¿æ¹æ³">2. æ ¸å¿æ¹æ³</h3>
<p>ä»¥ä¸æ¯UIAbilityæ ¸å¿çå½å¨ææ¹æ³çè¯¦ç»è¯´æï¼èç¦åæ¹æ³çè§¦åæ¶æºãæ ¸å¿ä½ç¨ä¸æ§è¡æ¬¡æ°ï¼</p>
<h4 id="oncreatewant-launchparam"><code>onCreate(want, launchParam)</code></h4>
<ul>
<li><strong>è§¦åæ¶æº</strong>ï¼UIAbilityå®ä¾é¦æ¬¡åå»ºæ¶è§¦åï¼</li>
<li><strong>æ ¸å¿ä½ç¨</strong>ï¼å®æåºç¨å¨å±åå§åå·¥ä½ï¼æ¯å¦å»ºç«æ°æ®åºè¿æ¥ãåå§åå¨å±éç½®åæ°ãæ¥å¿æ¨¡åãç½ç»éç½®ãåå»ºå¨å±éç¨å·¥å·ç±»ç­ï¼è¿äºèµæºä¼å¨<code>onDestroy</code>ä¸­å¯¹åºéæ¾ï¼</li>
<li><strong>æ§è¡æ¬¡æ°</strong>ï¼æ´ä¸ªUIAbilityå®ä¾çå½å¨æåä»è§¦å1æ¬¡ã</li>
</ul>
<h4 id="onwindowstagecreatewindowstage"><code>onWindowStageCreate(windowStage)</code></h4>
<ul>
<li><strong>è§¦åæ¶æº</strong>ï¼UIAbilityå®ä¾åå»ºå®æåãåºç¨è¿å¥åå°åï¼ä¸ç³»ç»é¦æ¬¡åå»ºWindowStageï¼çªå£å®¹å¨ï¼æ¶è§¦åï¼</li>
<li><strong>æ ¸å¿ä½ç¨</strong>ï¼è´è´£é¡µé¢å è½½ãè®¢éWindowStageç¸å³äºä»¶ï¼å¦çªå£ç¦ç¹ååãæ¾ç¤º/éèäºä»¶ï¼ï¼</li>
<li><strong>æ§è¡æ¬¡æ°</strong>ï¼åå®ä¾ï¼singletonï¼æ¨¡å¼ä¸ä»è§¦å1æ¬¡ï¼å¤å®ä¾æ¨¡å¼ä¸æ¯æ¬¡åå»ºæ°å®ä¾é½ä¼è§¦åï¼ã</li>
</ul>
<h4 id="onforeground"><code>onForeground()</code></h4>
<ul>
<li><strong>è§¦åæ¶æº</strong>ï¼UIAbilityä»åå°åæ¢è³åå°ãçé¢å³å°å¯è§ä¹åè§¦åï¼</li>
<li><strong>æ ¸å¿ä½ç¨</strong>ï¼æ¢å¤åå°è¿è¡æéèµæºï¼æ¯å¦éå¯æåçå®æ¶å¨ãéæ°å¼å¯å®ä½æå¡ãæ¢å¤ç½ç»è¯·æ±è½®è¯¢ç­ï¼</li>
<li><strong>æ§è¡æ¬¡æ°</strong>ï¼å¯å¤æ¬¡è§¦åï¼æ¯æ¬¡ååå°é½ä¼æ§è¡ï¼ã</li>
</ul>
<h4 id="onbackground"><code>onBackground()</code></h4>
<ul>
<li><strong>è§¦åæ¶æº</strong>ï¼UIAbilityçé¢å®å¨ä¸å¯è§ï¼å¦æHomeé®ååå°ãæå¼å¶ä»åºç¨è¦çå½åçé¢ï¼åè§¦åï¼</li>
<li><strong>æ ¸å¿ä½ç¨</strong>ï¼æååå°èµæºä»¥èçç³»ç»å¼éï¼æ¯å¦åæ­¢å®æ¶å¨ãå³é­å®ä½æå¡ãä¿å­ç¨æ·æä½æ°æ®ï¼ä½ä¸º<code>onDestroy</code>æªè§¦åæ¶çååºæ¹æ¡ï¼ï¼</li>
<li><strong>æ§è¡æ¬¡æ°</strong>ï¼å¯å¤æ¬¡è§¦åï¼æ¯æ¬¡ååå°é½ä¼æ§è¡ï¼ã</li>
</ul>
<h4 id="onwindowstagewilldestroywindowstage"><code>onWindowStageWillDestroy(windowStage)</code></h4>
<ul>
<li><strong>è§¦åæ¶æº</strong>ï¼WindowStageï¼çªå£å®¹å¨ï¼å³å°è¢«éæ¯åè§¦åï¼</li>
<li><strong>æ ¸å¿ä½ç¨</strong>ï¼è§£ç»å¨<code>onWindowStageCreate</code>ä¸­è®¢éçWindowStageäºä»¶ãæ¸ççªå£ç¸å³ç¼å­èµæºï¼é¿ååå­æ³æ¼ï¼</li>
<li><strong>æ§è¡æ¬¡æ°</strong>ï¼ä»å¨åºç¨âä¼ééæ¯âï¼å¦è°ç¨<code>terminateSelf()</code>ãæ­£å¸¸éåºï¼æ¶è§¦å1æ¬¡ï¼ä¸é®æ¸çç­å¼ºå¶éæ¯åºæ¯ä¸è§¦åã</li>
</ul>
<h4 id="onwindowstagedestroy"><code>onWindowStageDestroy()</code></h4>
<ul>
<li><strong>è§¦åæ¶æº</strong>ï¼WindowStageï¼çªå£å®¹å¨ï¼éæ¯å®æåè§¦åï¼</li>
<li><strong>æ ¸å¿ä½ç¨</strong>ï¼ç¡®è®¤çªå£ç¸å³èµæºå·²éæ¾ï¼åæç»ççªå£ç¶ææ ¡éªï¼</li>
<li><strong>æ§è¡æ¬¡æ°</strong>ï¼ä»å¨åºç¨âä¼ééæ¯âæ¶è§¦å1æ¬¡ï¼å¼ºå¶éæ¯åºæ¯ä¸è§¦åã</li>
</ul>
<h4 id="ondestroy"><code>onDestroy()</code></h4>
<ul>
<li><strong>è§¦åæ¶æº</strong>ï¼UIAbilityå®ä¾å³å°è¢«éæ¯åè§¦åï¼</li>
<li><strong>æ ¸å¿ä½ç¨</strong>ï¼éæ¾<code>onCreate</code>ä¸­åå§åçå¨å±èµæºï¼æ¯å¦å³é­æ°æ®åºè¿æ¥ãæ¸çå¨å±ç¼å­ãä¿å­æç»çåºç¨ç¶ææ°æ®ï¼</li>
<li><strong>æ§è¡æ¬¡æ°</strong>ï¼ä»å¨âä¼ééæ¯âæ¶è§¦å1æ¬¡ï¼API 13+ä¸­ï¼æ å®åµçªåºç¨è¢«ä¸é®æ¸çãè°è¯æ¨¡å¼ç§»é¤ä»»å¡æ¶ï¼ç³»ç»ç´æ¥ç»æ­¢è¿ç¨ï¼è¯¥æ¹æ³ä¸è§¦åï¼ã</li>
</ul>
<h4 id="onnewwantwant-launchparam"><code>onNewWant(want, launchParam)</code></h4>
<ul>
<li><strong>è§¦åæ¶æº</strong>ï¼UIAbilityå®ä¾å·²å¯å¨ï¼æªéæ¯ï¼ãåæ¬¡è¢«å¤é¨è°ç¨ï¼å¦å¶ä»é¡µé¢/åºç¨è·³è½¬ï¼æ¶è§¦åï¼</li>
<li><strong>æ ¸å¿ä½ç¨</strong>ï¼å¤çæ°çå¯å¨åæ°ï¼æ¯å¦æ¥æ¶è·³è½¬ä¼ åãæ´æ°é¡µé¢å±ç¤ºåå®¹ï¼</li>
<li><strong>æ§è¡æ¬¡æ°</strong>ï¼æéè§¦åï¼æ¯æ¬¡å¤ç¨å®ä¾è°ç¨é½ä¼æ§è¡ï¼ã</li>
<li></li>
</ul>
<p><strong>æ³¨æ</strong>ï¼</p>
<ul>
<li><code>onDestroy</code>è§¦åç¹æ®è§åï¼API 13åä»¥ä¸çæ¬ä¸­ï¼æ å®åµçªåºç¨è¢«ä¸é®æ¸çãè°è¯æ¨¡å¼ä¸ç§»é¤ä»»å¡æ¶ï¼ç³»ç»ç´æ¥ç»æ­¢è¿ç¨ï¼è¯¥æ¹æ³ä¸ä¼è§¦åï¼ä»<code>terminateSelf()</code>è°ç¨ãæ­£å¸¸è¿åéåºãæå®åµçªåºç¨è¢«ä¸é®æ¸çæ¶è§¦åã</li>
</ul>
<h3 id="3-windowstageäºä»¶è¯¦è§£çå¬çªå£æ´»å¨ç¶æ">3. WindowStageäºä»¶è¯¦è§£ï¼çå¬çªå£æ´»å¨ç¶æï¼</h3>
<p>çªå£çæææ´»å¨ç¶æåéè¿<code>windowStageEvent</code>äºä»¶çå¬ï¼æ ¸å¿äºä»¶è¯´æï¼</p>
<ul>
<li><code>SHOWN</code>ï¼çªå£ä»åå°åæ¢å°åå°ï¼å¯è§ï¼ï¼ä»£è¡¨åºç¨ååå°ï¼</li>
<li><code>HIDDEN</code>ï¼çªå£ä»åå°åæ¢å°åå°ï¼ä¸å¯è§ï¼ï¼ä»£è¡¨åºç¨ååå°ï¼</li>
<li><code>ACTIVE</code>ï¼çªå£è·å¾ç¦ç¹ï¼å¯æ¥æ¶ç¹å»/è¾å¥ï¼ï¼å¤äºå¯äº¤äºç¶æï¼</li>
<li><code>INACTIVE</code>ï¼çªå£å¤±å»ç¦ç¹ï¼æ æ³æ¥æ¶è¾å¥ï¼ï¼å¤äºä¸å¯äº¤äºç¶æï¼</li>
<li><code>RESUMED</code>ï¼çªå£è¿å¥åå°å¯äº¤äºç¶æï¼åºç¨æ­£å¸¸è¿è¡ï¼</li>
<li><code>PAUSED</code>ï¼çªå£è¿å¥åå°ä¸å¯äº¤äºç¶æã</li>
</ul>
<h2 id="ä¸å®æ´çå½å¨æä»£ç ç¤ºä¾">ä¸ãå®æ´çå½å¨æä»£ç ç¤ºä¾</h2>
<pre><code class="language-javascript">import { UIAbility, AbilityConstant, Want, common } from '@kit.AbilityKit';
import { window } from '@kit.ArkUI';
import { hilog } from '@kit.LogKit';
import { BusinessError } from '@ohos.base';

const TAG = 'UIAbility_Lifecycle';
const DOMAIN = 0x0000;

export default class EntryAbility extends UIAbility {
  // 1. åå»ºé¶æ®µï¼ä»1æ¬¡ï¼
  onCreate(want: Want, launchParam: AbilityConstant.LaunchParam) {
    hilog.info(DOMAIN, TAG, '--- onCreate è§¦åï¼å¨å±åå§åï¼---');
    // èµæºåå§åï¼å¨å±éç½®ãæ°æ®åºè¿æ¥ç­ï¼å¯¹åºéæ¾ï¼onDestroyï¼
  }

  // 2. çªå£åå»ºé¶æ®µï¼çªå£é¦æ¬¡åå»º/éå»ºï¼
  onWindowStageCreate(windowStage: window.WindowStage): void {
    hilog.info(DOMAIN, TAG, '--- onWindowStageCreate è§¦åï¼å è½½é¡µé¢ï¼---');
    // è®¢éWindowStageäºä»¶
    this.registerWindowStageEvent(windowStage);
    // å è½½é¡µé¢ï¼å¯ä¸åæ³æ¶æºï¼
    windowStage.loadContent('pages/Index').then(()=&gt;{
      hilog.info(DOMAIN, TAG, 'Indexé¡µé¢å è½½æå');
    }).catch((err:BusinessError)=&gt;{
      hilog.error(DOMAIN, TAG, `é¡µé¢å è½½å¤±è´¥ï¼code=${err.code}, message=${err.message}`);
    })
  }

  // 3. åå°é¶æ®µï¼ååå°æ¶ï¼
  onForeground() {
    hilog.info(DOMAIN, TAG, '--- onForeground è§¦åï¼æ¢å¤åå°èµæºï¼---');
    // å¯å¨åå°ä¸å±èµæºï¼å®æ¶å¨ãå®ä½ç­ï¼
  }

  // 4. åå°é¶æ®µï¼ååå°æ¶ï¼
  onBackground() {
    hilog.info(DOMAIN, TAG, '--- onBackground è§¦åï¼éæ¾åå°èµæºï¼---');
    // æååå°èµæºï¼ä¿å­å³é®æ°æ®ï¼ååºï¼
  }

  // 5. çªå£é¢éæ¯é¶æ®µï¼çªå£å³å°éæ¯ï¼
  onWindowStageWillDestroy(windowStage: window.WindowStage) {
    hilog.info(DOMAIN, TAG, '--- onWindowStageWillDestroy è§¦åï¼çªå£é¢éæ¯ï¼---');
    // è§£ç»WindowStageäºä»¶ï¼é¿ååå­æ³æ¼
    this.unregisterWindowStageEvent(windowStage);
  }

  // 6. çªå£éæ¯é¶æ®µï¼çªå£å·²éæ¯ï¼
  onWindowStageDestroy() {
    hilog.info(DOMAIN, TAG, '--- onWindowStageDestroy è§¦åï¼éæ¯çªå£ï¼---');
    // çªå£å®ä¾å¤±æï¼æ éé¢å¤æä½
  }

  // 7. éæ¯é¶æ®µï¼ä»1æ¬¡ï¼å­å¨ä¸è§¦ååºæ¯ï¼
  onDestroy() {
    hilog.info(DOMAIN, TAG, '--- onDestroy è§¦åï¼éæ¯åºç¨ï¼---');
    // éæ¾å¨å±èµæºãä¿å­æç»æ°æ®
  }

  // 8. æ°åæ°é¶æ®µï¼å·²å¯å¨åæ¥æ¶æ°è¯·æ±ï¼
  onNewWant(want: Want, launchParam: AbilityConstant.LaunchParam) {
    hilog.info(DOMAIN, TAG, `--- onNewWant è§¦åï¼æ°åæ°ï¼${JSON.stringify(want)}ï¼---`);
    // å¤çæ°çå¯å¨åæ°
  }
  /**
   * è®¢éWindowStageäºä»¶ï¼çå¬çªå£æ´»å¨ç¶æï¼
   * @param windowStage - å½åçªå£å®ä¾
   */
  private registerWindowStageEvent(windowStage: window.WindowStage): void {
    try {
      windowStage.on('windowStageEvent', (data) =&gt; {
        const stageEventType: window.WindowStageEventType = data;
        switch (stageEventType) {
          case window.WindowStageEventType.SHOWN:
            hilog.info(DOMAIN, TAG, `windowStage foreground`);
            break;
          case window.WindowStageEventType.ACTIVE:
            hilog.info(DOMAIN, TAG, `windowStage active`);
            break;
          case window.WindowStageEventType.INACTIVE:
            hilog.info(DOMAIN, TAG, `windowStage inactive`);
            break;
          case window.WindowStageEventType.HIDDEN:
            hilog.info(DOMAIN, TAG, `windowStage background`);
            break;
          case window.WindowStageEventType.RESUMED:
            hilog.info(DOMAIN, TAG, `windowStage resumed`);
            break;
          case window.WindowStageEventType.PAUSED:
            hilog.info(DOMAIN, TAG, `windowStage paused.`);
            break;
          default:
            break;
        }
      });
      hilog.info(DOMAIN, TAG, 'WindowStageäºä»¶è®¢éæå');
    } catch (exception) {
      hilog.error(DOMAIN, TAG, `è®¢éçªå£äºä»¶å¤±è´¥ï¼${JSON.stringify(exception)}`);
    }
  }

  /**
   * è§£ç»WindowStageäºä»¶ï¼èµæºéæ¾ï¼
   */
  private unregisterWindowStageEvent(windowStage: window.WindowStage): void {
    try {
      windowStage.off('windowStageEvent');
      hilog.info(DOMAIN, TAG, 'çªå£äºä»¶è§£ç»æå');
    } catch (err) {
      hilog.error(DOMAIN, TAG, `è§£ç»çªå£äºä»¶å¤±è´¥ï¼code=${err.code}, message=${err.message}`);
    }
  }
}

/**
 * æå¨åæ­¢å½åUIAbilityå®ä¾ï¼è§¦åonDestroyï¼
 */
export function stopCurrentAbility(context: common.UIAbilityContext): void {
  context.terminateSelf().then(()=&gt;{
    hilog.info(DOMAIN, TAG, 'terminateSelfè°ç¨æåï¼å°è§¦åonDestroy');
  }).catch((err: BusinessError) =&gt; {
    hilog.error(DOMAIN, TAG, `åæ­¢UIAbilityå¤±è´¥ï¼code=${err.code}, message=${err.message}`);
  });
}
</code></pre>
<h2 id="åæ°å¢æå¨å³é­åºç¨indexets">åãæ°å¢æå¨å³é­åºç¨Index.ets</h2>
<pre><code class="language-javascript">import { common } from '@kit.AbilityKit';
import { stopCurrentAbility } from '../entryability/EntryAbility';

@Entry
@Component
struct Index {
  @State message: string = 'ç¬¬ä¸ä¸ªåºç¨';
  private context: common.UIAbilityContext = this.getUIContext().getHostContext() as common.UIAbilityContext;

  aboutToAppear(): void {}

  build() {
    Column() {
      Text(this.message)
        .fontSize($r('app.float.page_text_font_size'))
        .fontWeight(FontWeight.Bold);

      Button("å³é­åºç¨ç¨åº")
        .onClick(()=&gt;{
          stopCurrentAbility(this.context);
        });
    }
    .height('100%')
    .width('100%');
  }
}
</code></pre>
<h2 id="äºå®æå®æéªè¯çå½å¨ææ§è¡é¡ºåº">äºãå®æå®æï¼éªè¯çå½å¨ææ§è¡é¡ºåº</h2>
<h3 id="ç®æ ">ç®æ </h3>
<p>éè¿æå¨æä½åºç¨ï¼å¨Logcatä¸­è§å¯çå½å¨ææ¹æ³åWindowStageäºä»¶çè§¦åé¡ºåºï¼éç¹éªè¯ä¸ååºæ¯ä¸<code>onDestroy</code>çè§¦åæåµã</p>
<blockquote>
<p>ç¯å¢è¯´æï¼å¼åå·¥å·æä½æ¯æAPI 13ï¼æ æ³æµè¯API 12åä»¥ä¸çæ¬ï¼æææµè¯åºäºAPI 13 ææºæ¨¡æå¨ã<br>
ä¸åç±»åçè®¾å¤çå¬çªå£æ´»å¨ç¶æè¾åºæ¥å¿ä¼æå·®å¼ã</p>
</blockquote>
<h3 id="åºæ¯1å¯å¨åºç¨--è¿åæ¡é¢--åæ¬¡æå¼åºç¨">åºæ¯1ï¼å¯å¨åºç¨ â è¿åæ¡é¢ â åæ¬¡æå¼åºç¨</h3>
<p><strong>æ¥å¿è¾åº</strong>ï¼</p>
<pre><code>&lt;!-- å¯å¨åºç¨ --&gt;
--- onCreate è§¦åï¼å¨å±åå§åï¼---
--- onWindowStageCreate è§¦åï¼å è½½é¡µé¢ï¼---
WindowStageäºä»¶è®¢éæå
--- onForeground è§¦åï¼æ¢å¤åå°èµæºï¼---
windowStage foreground
windowStage active
Indexé¡µé¢å è½½æå

&lt;!-- è¿åæ¡é¢ --&gt;
windowStage paused.
windowStage inactive
--- onBackground è§¦åï¼éæ¾åå°èµæºï¼---
windowStage background


&lt;!-- åæ¬¡æå¼åºç¨ --&gt;
--- onNewWant è§¦åï¼æ°åæ°ï¼{"deviceId":"","bundleName":"com.example.FirstApplication","abilityName":"EntryAbility","moduleName":"entry","uri":"","type":"","flags":0,"action":"action.system.home","parameters":{"debugApp":true,"moduleName":"entry","ohos.aafwk.param.displayId":0},"fds":{},"entities":["entity.system.home"]}ï¼---
--- onForeground è§¦åï¼æ¢å¤åå°èµæºï¼---
windowStage foreground
windowStage active
</code></pre>
<h3 id="åºæ¯2ç¹å»å³é­åºç¨ç¨åºæé®è°ç¨terminateself">åºæ¯2ï¼ç¹å»âå³é­åºç¨ç¨åºâæé®ï¼è°ç¨terminateSelfï¼</h3>
<p><strong>æ¥å¿è¾åº</strong>ï¼</p>
<pre><code>&lt;!-- terminateSelfè°ç¨æåï¼å°è§¦åonDestroy --&gt;
windowStage inactive
--- onBackground è§¦åï¼éæ¾åå°èµæºï¼---
windowStage background
--- onWindowStageWillDestroy è§¦åï¼çªå£é¢éæ¯ï¼---
çªå£äºä»¶è§£ç»æå
--- onWindowStageDestroy è§¦åï¼éæ¯çªå£ï¼---
--- onDestroy è§¦åï¼éæ¯åºç¨ï¼---
</code></pre>
<h3 id="åºæ¯3å¯å¨åºç¨--ååå°--ä¸é®æ¸çæ å®åµçªåºç¨">åºæ¯3ï¼å¯å¨åºç¨ â ååå° â ä¸é®æ¸çæ å®åµçªåºç¨</h3>
<p><strong>æ¥å¿è¾åº</strong>ï¼</p>
<pre><code>--- onCreate è§¦åï¼å¨å±åå§åï¼---
--- onWindowStageCreate è§¦åï¼å è½½é¡µé¢ï¼---
WindowStageäºä»¶è®¢éæå
--- onForeground è§¦åï¼æ¢å¤åå°èµæºï¼---
windowStage foreground
windowStage active
Indexé¡µé¢å è½½æå
windowStage inactive
--- onBackground è§¦åï¼éæ¾åå°èµæºï¼---
windowStage background
</code></pre>
<p><strong>å³é®ç»è®º</strong>ï¼ä¸é®æ¸çæ¶ç³»ç»ç´æ¥ç»æ­¢è¿ç¨ï¼æªè§¦å<code>onWindowStageWillDestroy</code>/<code>onWindowStageDestroy</code>/<code>onDestroy</code>ã</p>
<h2 id="å­åå®¹æ»ç»">å­ãåå®¹æ»ç»</h2>
<ol>
<li><strong>çå½å¨æåå·¥</strong>ï¼<code>onCreate</code>åå¨å±åå§åï¼ä»1æ¬¡ï¼ï¼<code>onWindowStageCreate</code>è´è´£é¡µé¢å è½½/äºä»¶è®¢éï¼åå®ä¾æ¨¡å¼ä¸ä»é¦æ¬¡å¯å¨è§¦å1æ¬¡ï¼ï¼<code>onDestroy</code>éæ¾å¨å±èµæºï¼API 13+ä¸é®æ¸çæ å®åµçªåºç¨ä¸è§¦åï¼ï¼</li>
<li><strong>WindowStageæ ¸å¿è§å</strong>ï¼äºä»¶è®¢é/è§£ç»å¿é¡»æå¯¹åºç°å¨<code>onWindowStageCreate</code>/<code>onWindowStageWillDestroy</code>ï¼é¿ååå­æ³æ¼ï¼</li>
<li><strong>æ°æ®å®å¨ååº</strong>ï¼å <code>onDestroy</code>å­å¨ä¸è§¦ååºæ¯ï¼å³é®æ°æ®éå¨<code>onBackground</code>ä¸­ä¿å­ï¼</li>
<li><strong>ååå°åæ¢é¾è·¯</strong>ï¼ååå°åè§¦åPAUSED/INACTIVEâ<code>onBackground</code>âHIDDENï¼ååå°åè§¦åSHOWNâ<code>onForeground</code>âACTIVE/RESUMEDã</li>
</ol>
<h3 id="æ ¸å¿é®é¢è§£ç­ä¸ºä»ä¹é¡µé¢åªè½å¨onwindowstagecreateä¸­å è½½">æ ¸å¿é®é¢è§£ç­ï¼ä¸ºä»ä¹é¡µé¢åªè½å¨<code>onWindowStageCreate</code>ä¸­å è½½ï¼</h3>
<p>é¡µé¢å è½½çæ¬è´¨æ¯å° UI ç»ä»¶æè½½å°ç³»ç»ççªå£å®¹å¨ï¼WindowStageï¼ä¸ï¼ä¸¤ä¸ªçå½å¨æé¶æ®µçæ ¸å¿å·®å¼å³å®äºå è½½æ¶æºï¼</p>
<ul>
<li><code>onCreate</code>é¶æ®µï¼UIAbility å®ä¾ååå»ºï¼ç³»ç»å°æªåé WindowStageï¼æ é¡µé¢æ¿è½½è½½ä½ï¼ï¼æ­¤æ¶è°ç¨<code>loadContent</code>ä¼å æ çªå£å®¹å¨èå¤±è´¥ï¼çè³å¯¼è´åºç¨å´©æºï¼</li>
<li><code>onWindowStageCreate</code>é¶æ®µï¼ç³»ç»å·²åå»º WindowStage å¹¶ä½ä¸ºåæ°ä¼ å¥ï¼æ­¤æ¶æ¥æäºé¡µé¢æ¸²ææéççªå£å®¹å¨ï¼æ¯å è½½é¡µé¢çæ¶æºã</li>
</ul>
<h3 id="æ°æé¿åæå">æ°æé¿åæå</h3>
<ul>
<li>ç¦æ­¢å¨<code>onCreate</code>ä¸­å è½½é¡µé¢ï¼æ WindowStageå®ä¾ï¼ï¼</li>
<li>ä¸è¦ä¾èµ<code>onDestroy</code>ä¿å­å³é®æ°æ®ï¼ä¼åå¨<code>onBackground</code>ååºï¼</li>
<li>çå½å¨æåè°æ¯å¨åºç¨ä¸»çº¿ç¨æ§è¡ï¼ä¸ºäºç¡®ä¿åºç¨æ§è½ï¼å»ºè®®å¨çå½å¨æåè°ä¸­ï¼ä»æ§è¡å¿è¦çè½»éçº§æä½ãå¯¹äºèæ¶ä»»å¡ï¼æ¨èéç¨å¼æ­¥å¤çæäº¤ç±å­çº¿ç¨æ§è¡ï¼é¿åé»å¡ä¸»çº¿ç¨ã</li>
<li>å¦æéè¦æç¥UIAbilityçå½å¨æååï¼å¼åèå¯ä»¥ä½¿ç¨ApplicationContextæ³¨åæ¥å£çå¬UIAbilityçå½å¨æååã</li>
</ul>
<pre><code class="language-javascript">  // å®ä¹çå½å¨æID
  private lifecycleId: number = -1;
  
  // å®ä¹çå½å¨æåè°å¯¹è±¡
  let abilityLifecycleCallback: AbilityLifecycleCallback = {
    // ååè°æ¹æ³
  }
    // è·ååºç¨ä¸ä¸æ
  let applicationContext = this.context.getApplicationContext();
   // æ³¨ååºç¨åçå½å¨æåè°
  this.lifecycleId = applicationContext.on('abilityLifecycle', abilityLifecycleCallback);
  
</code></pre>
<h2 id="ä¸ä»£ç ä»åº">ä¸ãä»£ç ä»åº</h2>
<ul>
<li>å·¥ç¨åç§°ï¼FirstApplication</li>
<li>ä»åºå°åï¼<a href="https://gitee.com/HarmonyOS-UI-Basics/harmony-os-ui-basics.git" target="_blank" rel="noopener nofollow">https://gitee.com/HarmonyOS-UI-Basics/harmony-os-ui-basics.git</a></li>
</ul>
<h2 id="å«ä¸èé¢å">å«ãä¸èé¢å</h2>
<p>ä¸ä¸èæä»¬å°ç³»ç»å­¦ä¹ UIAbilityçå¨éå¯å¨æ¨¡å¼ï¼éç¹ææ¡ï¼</p>
<ol>
<li>multitonï¼å¤å®ä¾ï¼ãsingletonï¼åå®ä¾ï¼ãspecifiedï¼æå®å®ä¾ï¼ä¸ç§å¯å¨æ¨¡å¼çæ ¸å¿å·®å¼ä¸å®ä¾åå»ºè§åï¼</li>
<li>ä¸åå¯å¨æ¨¡å¼çéç½®æ¹æ³ï¼module.json5éç½®+ä»£ç å±é¢åæ°ä¼ éï¼åéç¨ä¸å¡åºæ¯ï¼</li>
<li>å¤å®ä¾/æå®å®ä¾æ¨¡å¼ä¸çå½å¨æçèå¨å³ç³»ï¼åæ<code>onCreate</code>/<code>onNewWant</code>/<code>onWindowStageCreate</code>çå·®å¼åè§¦åé»è¾ï¼ï¼</li>
<li>å®æéªè¯ä¸åå¯å¨æ¨¡å¼çææï¼è§£å³å®ä¾å²çªãåæ°ä¼ éå¼å¸¸ç­å¼åå¸¸è§é®é¢ã</li>
</ol>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.0006944444444444445" data-date-updated="2026-02-05 15:56">2026-02-05 15:55</span>&nbsp;
<a href="https://www.cnblogs.com/san-xiu">é¸¿è-æ£ä¿®</a>&nbsp;
éè¯»(<span id="post_view_count">81</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19579716);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19579716', targetLink: 'https://www.cnblogs.com/san-xiu/p/19579716', title: 'é¸¿èåºç¨å¼åUIåºç¡ç¬¬ä¸èï¼UIAbilityçå½å¨æå¨è§£æ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ AIå¼å-python-langchainæ¡æ¶ï¼1-11 è¿åæä¸¾-æ ¼å¼è§£æå¨ï¼ ]]></title>
    <link>https://www.cnblogs.com/yclh/p/19578042</link>
    <guid>ab8571a09f7f9642648092b72b8461e0</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yclh/p/19578042" title="åå¸äº 2026-02-05 10:56">
    <span role="heading" aria-level="2">AIå¼å-python-langchainæ¡æ¶ï¼1-11 è¿åæä¸¾-æ ¼å¼è§£æå¨ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>è·ä¸ä¸ç¯åå®¹ä¸æ ·ï¼è¿æ¬¡æä»¬æ¥çå¦ä½éå®å¤§æ¨¡åè¿åçç»æå¼æ¯æä¸¾ç±»åçã</p>
<p>åçä»£ç ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;"># å¯¼å¥å¿è¦çæ¨¡å
from langchain.prompts import PromptTemplate          # ç¨äºåå»ºåç®¡çæç¤ºæ¨¡æ¿
from langchain_openai import ChatOpenAI               # ç¨äºè°ç¨OpenAIå¼å®¹çèå¤©æ¨¡åï¼å¦DeepSeekï¼
from langchain.output_parsers.enum import EnumOutputParser  # ç¨äºå°LLMè¾åºè§£æä¸ºæä¸¾ç±»å
from enum import Enum                                 # Pythonæ ååºï¼ç¨äºå®ä¹æä¸¾ç±»å
import os                                             # ç¨äºè¯»åç¯å¢åé

# å®ä¹é¢è²æä¸¾ç±»ï¼éå®LLMè¾åºå¿é¡»ä¸ºä»¥ä¸äºç§é¢è²ä¹ä¸
class Colors(Enum):
    RED = "çº¢è²"
    BROWN = "æ£è²"
    BLACK = "é»è²"
    WHITE = "ç½è²"
    YELLOW = "é»è²"

# åå»ºæä¸¾è¾åºè§£æå¨ï¼å¼ºå¶LLMè¾åºå¿é¡»å¹éColorsæä¸¾ä¸­çå¼
output_parser = EnumOutputParser(enum=Colors)

# è·åæ ¼å¼åæä»¤ï¼åè¯LLMå¦ä½æ­£ç¡®æ ¼å¼åè¾åºï¼ä¾å¦ï¼"è¾åºå¿é¡»æ¯ï¼çº¢è²ãæ£è²..."ï¼
format_instructions = output_parser.get_format_instructions()
print(format_instructions)  # æå°æ ¼å¼è¦æ±ï¼ç¨äºè°è¯ææç¤ºç¨æ·
print('###########')         # åéçº¿

# åå»ºæç¤ºæ¨¡æ¿ï¼åå«ä¸¤ä¸ªå ä½ç¬¦ {person}ï¼äººç©ï¼å {instructions}ï¼è¾åºæ ¼å¼è¦æ±ï¼
promptTemplate = PromptTemplate.from_template(
    """{person}çç®è¤ä¸»è¦æ¯ä»ä¹é¢è²ï¼
{instructions}"""
)

# åºå®instructionsé¨åçåå®¹ï¼é¿åæ¯æ¬¡è°ç¨æ¶éå¤ä¼ å¥
instructions = "ååºçç»æè¯·éæ©ä»¥ä¸éé¡¹ä¹ä¸ï¼çº¢è²ãæ£è²ãé»è²ãç½è²ãé»è²ã"
prompt = promptTemplate.partial(instructions=instructions)  # partialç¨äºé¢å¡«åæ¨¡æ¿ä¸­çé¨ååé

# è¾åºå®æ´æç¤ºè¯ç¤ºä¾ï¼ä»¥"äºæ´²äºº"ä¸ºä¾ï¼ï¼ç¨äºè°è¯æ¥çå®éåéç»LLMçåå®¹
print(prompt.invoke({"person": "äºæ´²äºº"}).text)
print('--------------')

# åå§åèå¤©æ¨¡åï¼ä½¿ç¨DeepSeek APIï¼
llm = ChatOpenAI(
    api_key=os.getenv("DEEPSEEK_API_KEY"),            # ä»ç¯å¢åéè¯»åAPIå¯é¥
    base_url=os.getenv("BASE_URL"),                   # ä»ç¯å¢åéè¯»åAPIåºç¡URLï¼å¦ https://api.deepseek.comï¼
    model="deepseek-v3:671b",                         # æå®ä½¿ç¨çæ¨¡åçæ¬
    temperature=0.7,                                  # çæéæºæ§æ§å¶ï¼0.7 éä¸­åé æ§
    max_tokens=1024                                   # åæ¬¡ååºæå¤§tokenæ°
)

# æå»ºå¤çé¾ï¼æç¤ºæ¨¡æ¿ â å¤§è¯­è¨æ¨¡å â æä¸¾è§£æå¨
# å®ç°ç«¯å°ç«¯æµç¨ï¼çææç¤º â è°ç¨LLM â å¼ºå¶è¾åºä¸ºæä¸¾ç±»å
chain = prompt | llm | output_parser

# è°ç¨é¾ï¼ä¼ å¥"äºæ´²äºº"ä½ä¸ºè¾å¥
result = chain.invoke({"person": "äºæ´²äºº"})

# è¾åºè§£æåçç»æï¼Enumç±»åï¼
print(result)        # æå°æä¸¾å¯¹è±¡ï¼å¦ï¼Colors.YELLOWï¼
print(result.name)   # æå°æä¸¾æååç§°ï¼å¦ï¼"YELLOW"ï¼
print(result.value)  # æå°æä¸¾æåå¼ï¼å¦ï¼"é»è²"ï¼
</pre>
</div>
<p>&nbsp;è¿åå¼ï¼</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">Select one of the following options: çº¢è², æ£è², é»è², ç½è², é»è²
###########
äºæ´²äººçç®è¤ä¸»è¦æ¯ä»ä¹é¢è²ï¼
ååºçç»æè¯·éæ©ä»¥ä¸éé¡¹ä¹ä¸ï¼çº¢è²ãæ£è²ãé»è²ãç½è²ãé»è²ã
--------------
Colors.YELLOW
YELLOW
é»è²
</pre>
</div>
<p>&nbsp;</p>
<p><span style="font-size: 18pt"><strong>éç¹è¯´æï¼</strong></span></p>
<div class="response-message-content t2t phase-answer">
<div class="custom-qwen-markdown">
<div class="qwen-markdown">
<div class="qwen-markdown-paragraph"><strong class="qwen-markdown-strong"><span class="qwen-markdown-text">ç²¾åæ§å¶å¤§æ¨¡åè¾åºèå´</span></strong><br><span class="qwen-markdown-text">æ¬æ¹æ¡çæ ¸å¿ç®æ æ¯å¼ºå¶å¤§è¯­è¨æ¨¡åè¿åé¢å®ä¹çæä¸¾ç±»åå¼ï¼å½»åºè§£å³èªç±ææ¬è¾åºçä¸ç¡®å®æ§é®é¢ãéè¿ç»æåçº¦ææºå¶ï¼ç¡®ä¿æ¨¡åååºä¸¥æ ¼éå®å¨ä¸å¡åè®¸çéé¡¹éååï¼å¦ä»è¿åâçº¢è²ãæ£è²ãé»è²ãç½è²ãé»è²âï¼ï¼ä»æºå¤´æç»âæµé»ââç±³ç½âç­éæ åå¼ï¼æ¾èæåç³»ç»å¯é æ§ä¸æ°æ®ä¸è´æ§ã</span></div>
<div class="qwen-markdown-space">&nbsp;</div>
<div class="qwen-markdown-paragraph"><strong class="qwen-markdown-strong"><span class="qwen-markdown-text">åéçº¦æä¿éè¾åºåè§æ§</span></strong><br><span class="qwen-markdown-text">æä¸¾è¾åºè§£æå¨ï¼EnumOutputParserï¼æå»ºååç«¯åéé²æ¤ï¼åç«¯éè¿<code class="qwen-markdown-codespan" style="cursor: pointer">get_format_instructions()</code><span class="qwen-markdown-text">èªå¨çææ ¼å¼æä»¤å¹¶æ³¨å¥æç¤ºè¯ï¼æç¡®å¼å¯¼æ¨¡åâä»å¯éæ©ä»¥ä¸éé¡¹ä¹ä¸âï¼åç«¯å¨è§£æé¶æ®µå¯¹è¿åç»æè¿è¡å¼ºæ ¡éªï¼ä»»ä½è¶åºæä¸¾èå´çå¼å°ç«å³æåº<code class="qwen-markdown-codespan" style="cursor: pointer">OutputParserException</code><span class="qwen-markdown-text">å¼å¸¸ï¼å½¢æä»çæå°è§£æçå¨é¾è·¯çº¦æã</span></span></span></div>
<div class="qwen-markdown-space">&nbsp;</div>
<div class="qwen-markdown-paragraph"><strong class="qwen-markdown-strong"><span class="qwen-markdown-text">æä¸¾ç±»åå®ä¹æ°æ®å¥çº¦</span></strong><br><span class="qwen-markdown-text">éè¿PythonçEnumç±»é¢åå£°æåæ³å¼éåï¼å¦<code class="qwen-markdown-codespan" style="cursor: pointer">Colors</code><span class="qwen-markdown-text">æä¸¾ï¼ï¼å»ºç«ç³»ç»ä¸æ¨¡åä¹é´çæ ååæ°æ®å¥çº¦ãè¯¥è®¾è®¡ä¸ä»æç¡®ä¸å¡è§åè¾¹çï¼æ´ä½¿æ¨¡åè¾åºç´æ¥è½¬æ¢ä¸ºç±»åå®å¨çæä¸¾å¯¹è±¡ï¼å¼åèå¯ç´æ¥éè¿<code class="qwen-markdown-codespan" style="cursor: pointer">.name</code><span class="qwen-markdown-text">ï¼å¦"YELLOW"ï¼å<code class="qwen-markdown-codespan" style="cursor: pointer">.value</code><span class="qwen-markdown-text">ï¼å¦"é»è²"ï¼å±æ§è·åç»æåç»æï¼å½»åºè§é¿å­ç¬¦ä¸²æ¸æ´ä¸å¹éçç¹çå¤çã</span></span></span></span></div>
&nbsp;
<div class="qwen-markdown-paragraph"><strong class="qwen-markdown-strong"><span class="qwen-markdown-text">å¸ååºç¨åºæ¯ä¸ä¸å¡ä»·å¼</span></strong><br><span class="qwen-markdown-text">è¯¥æ¹æ¡ç¹å«éç¨äºéä¸¥æ ¼è¾åºæ§å¶çåºæ¯ï¼ææåæéå®{æ­£é¢/ä¸­æ§/è´é¢}ãå®¡æ¹ç¶æçº¦æ{å¾å®¡/éè¿/æç»}ãé¢è²è¯å«è§èæ åè²ç³»ç­ãç¸æ¯ä¼ ç»ä¾èµæ­£åè¡¨è¾¾å¼æå³é®è¯å¹éçåå¤çæ¹æ¡ï¼æä¸¾æ§å¶ä»è®¾è®¡å±é¢æ ¹é¤èæ°æ®é£é©ï¼éä½90%ä»¥ä¸çæ°æ®æ¸æ´ææ¬ï¼ä¸ºå³é®ä¸å¡ç³»ç»æä¾ç¡®å®æ§ä¿éã</span></div>
<div class="qwen-markdown-space">&nbsp;</div>
<div class="qwen-markdown-paragraph" data-spm-anchor-id="a2ty_o01.29997173.0.i57.26465171FY7rLs"><strong class="qwen-markdown-strong"><span class="qwen-markdown-text">å¢å¼ºé²æ£æ§çå®è·µå»ºè®®</span></strong><br><span class="qwen-markdown-text">å®éé¨ç½²æ¶å»ºè®®ç»åéè¯æºå¶æåå®¹éè½åï¼å½æ¨¡åé¦æ¬¡è¾åºä¸ç¬¦åæä¸¾è¦æ±æ¶ï¼èªå¨è§¦å2-3æ¬¡éè¯å¹¶å¼ºåæ ¼å¼æç¤ºï¼æåçå¯è¾¾99%ä»¥ä¸ãå¯¹äºéèãå»çç­å³é®åºæ¯ï¼å¯è®¾ç½®å¼å¸¸ååºç­ç¥ââè¿ç»­è§£æå¤±è´¥æ¶èªå¨è½¬äº¤äººå·¥å®¡æ ¸ï¼å½¢æâèªå¨çº¦æ+äººå·¥ååºâçå®æ´è´¨éä¿éé­ç¯ã</span></div>

</div>

</div>

</div>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-05 10:57">2026-02-05 10:56</span>&nbsp;
<a href="https://www.cnblogs.com/yclh">ä¸ç¬ä½</a>&nbsp;
éè¯»(<span id="post_view_count">135</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19578042);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19578042', targetLink: 'https://www.cnblogs.com/yclh/p/19578042', title: 'AIå¼å-python-langchainæ¡æ¶ï¼1-11 è¿åæä¸¾-æ ¼å¼è§£æå¨ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ LVMå¨ææ©å®¹å®å¨æåï½å°ç½ä¹è½ä¸æï¼é¶åæºæ©å±ç£çç©ºé´ï¼5ç§æ¹æ³ï¼ ]]></title>
    <link>https://www.cnblogs.com/liuziyi1/p/19577932</link>
    <guid>6048b2f88a3dcc2348363670aeb1fa43</guid>
    <description>
    <![CDATA[ 
		<h2>
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/liuziyi1/p/19577932" title="åå¸äº 2026-02-05 10:42">
    <span role="heading" aria-level="2">LVMå¨ææ©å®¹å®å¨æåï½å°ç½ä¹è½ä¸æï¼é¶åæºæ©å±ç£çç©ºé´ï¼5ç§æ¹æ³ï¼</span>
    

</a>

		</h2>
		<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>åè¿ç»´ãææå¡å¨çå°ä¼ä¼´ï¼è¯å®éå°è¿è¿ç§å´©æºåºæ¯ï¼</p>
<p>åå¤è¢«åè­¦æéï¼æç¤ºç£çç©ºé´æ»¡äºï¼MySQLãæ¥å¿æå¡ç´æ¥å¡å£³ï¼æ³æ©å®¹ï¼å´åç°ä¼ ç»ç£çååºä¸æ¦åå»ºå°±åºå®å¤§å°ï¼æ¹èµ·æ¥åéº»ç¦åå®¹æä¸¢æ°æ®â¦â¦</p>
<p>å«æï¼ä»å¤©ç»å¤§å®¶å¸¦æ¥ <strong>LVMå¨ææ©å®¹å®å¨æå</strong>ï¼ä»åºç¡çè®ºå°å®ææ­¥éª¤ï¼å¨ç¨éä¿æè§£ï¼å°ç½ä¹è½è·çä¸æ­¥æ­¥åï¼è½»æ¾å®ç°ãé¶åæºæ©å®¹ãï¼åä¹ä¸ç¨æç£çåè­¦ã</p>
<p>åä¸å¥è¯ææLVMï¼å®å°±åä¸ä¸ªãç£çé­æ¯çãï¼è½æå¤åç©çç¡¬çï¼æäºçï¼æ´åèµ·æ¥ï¼åæä¸ä¸ªç»ä¸çãå­å¨æ°´æ± ãï¼åç»­æ©å®¹ãç¼©å®¹ä¸ç¨å¨åºå±ç¡¬çï¼ä¹ä¸ç¨åä¸å¡ï¼çµæ´»åå®å¨ã</p>
<h1 id="ä¸åæælvmæ¯ä»ä¹ä¸ºä»ä¹è¦ç¨å®">ä¸ãåææï¼LVMæ¯ä»ä¹ï¼ä¸ºä»ä¹è¦ç¨å®ï¼</h1>
<h2 id="11-æ ¸å¿èæ¯å°ç½å¿ç">1.1 æ ¸å¿èæ¯ï¼å°ç½å¿çï¼</h2>
<p>ä¼ ç»ç£çååºï¼æ¯å¦/dev/sda1ï¼ï¼åå»ºæ¶å¤å¤§ï¼åç»­å°±åªè½ç¨å¤å¤§ï¼æ³æ©å®¹å°±å¾éæ°ååºãæ ¼å¼åï¼ä¸ä»éº»ç¦ï¼è¿å®¹æä¸¢å¤±æ°æ®ï¼å°¤å¶çäº§ç¯å¢æ ¹æ¬ä¸æ¢å¨ã</p>
<p>LVMï¼é»è¾å·ç®¡çå¨ï¼çåºç°ï¼å°±æ¯ä¸ºäºè§£å³è¿ä¸ªçç¹ââå®å¨ç©çç¡¬çåæä»¶ç³»ç»ä¹é´å äºä¸å±ãä¸­é´å±ãï¼æå¤åç¡¬çæ´åä¸ºä¸ä¸ªãå­å¨æ± ãï¼ç©ºé´å¯ä»¥èªç±åéãéæ¶æ©å®¹ï¼ä¸ç¨å³å¿åºå±ç¡¬ççè¾¹çã</p>
<p>éç¹ä¼å¿ï¼<strong>é¶åæºæ©å®¹</strong>ï¼ä¸å¡å®å¨æ æç¥ï¼å¤ç¡¬çæ´åï¼æç ´åçå®¹ééå¶ï¼æ¯æå¿«ç§å¤ä»½ï¼æ°æ®æ´å®å¨ã</p>
<h2 id="12-å°ç½è½æçæ ¸å¿æ¯è¯­å¿è®°3ä¸ª">1.2 å°ç½è½æçæ ¸å¿æ¯è¯­ï¼å¿è®°3ä¸ªï¼</h2>
<p>LVMå°±åãæ°´æ± ç³»ç»ãï¼è®°ä½è¿3ä¸ªæ¯è¯­ï¼åç»­æä½ä¸è¿·è·¯ï¼</p>
<ul>
<li>
<p><strong>PVï¼ç©çå·ï¼</strong>ï¼æåºå±çãæ°´æºãï¼å°±æ¯æä»¬çç©çç¡¬çï¼æ¯å¦/dev/sdbï¼ãäºçï¼æ¯LVMç®¡ççæå°ç©çååã</p>
</li>
<li>
<p><strong>VGï¼å·ç»ï¼</strong>ï¼æå¤ä¸ªPVæ´åèµ·æ¥çãå¤§æ°´æ± ãï¼ç¸å½äºæå¤åå°ç¡¬çåå¹¶æä¸ä¸ªå¤§å­å¨æ± ï¼ç»ä¸ç®¡çç©ºé´ã</p>
</li>
<li>
<p><strong>LVï¼é»è¾å·ï¼</strong>ï¼ä»VGãå¤§æ°´æ± ãéååºæ¥çãå°æ°´çãï¼æä»¬å®éä½¿ç¨çç£çç©ºé´ï¼æ¯å¦æè½½å°/var/lib/mysqlçååºï¼ï¼å°±æ¯LVã</p>
</li>
</ul>
<p>ç®åç±»æ¯ï¼PV=å¤ä¸ªå°æ°´æ¡¶ï¼VG=æå°æ°´æ¡¶é½åè¿ä¸ä¸ªå¤§æ°´æ± ï¼LV=ä»å¤§æ°´æ± éèåºçä¸ç¢æ°´ï¼æä»¬å®éç¨çï¼ãæ©å®¹ï¼å°±æ¯ç»å¤§æ°´æ± å æ°´ï¼å PVï¼ï¼æèæç¢åå¤§ï¼æ©LVï¼ã</p>
<h2 id="13-éç¨åºæ¯ççä½ ææ²¡æéæ±">1.3 éç¨åºæ¯ï¼ççä½ ææ²¡æéæ±ï¼</h2>
<ul>
<li>
<p>æ°æ®åºæå¡å¨ï¼MySQLãPostgreSQLï¼ï¼æ°æ®è¶å­è¶å¤ï¼éè¦å¨çº¿æ©å®¹ï¼ä¸è½ååºã</p>
</li>
<li>
<p>èææº/å®¹å¨ï¼KVMãK8sï¼ï¼èææºç£çä¸å¤ç¨ï¼å®¹å¨æä¹åå­å¨ä¸è¶³ï¼éè¦çµæ´»æ©å®¹ã</p>
</li>
<li>
<p>æ¥å¿æå¡å¨ï¼ELKï¼ï¼æ¥å¿éçªå¢ï¼ç£çå¾å¿«æ»¡ï¼éè¦å¿«éæ©å®¹ã</p>
</li>
<li>
<p>æ®éæå¡å¨ï¼å¤åå°ç¡¬çï¼æ³åå¹¶æä¸åå¤§ç©ºé´ä½¿ç¨ï¼åç»­æ¹ä¾¿æ©å®¹ã</p>
</li>
</ul>
<h2 id="14-ç¯å¢è¦æ±æååå¤é¿åè¸©å">1.4 ç¯å¢è¦æ±ï¼æååå¤ï¼é¿åè¸©åï¼</h2>
<p>ä¸ç¨è®°å¤ªå¤æï¼æ»¡è¶³è¿å ä¸ªåºç¡æ¡ä»¶å³å¯ï¼</p>
<ul>
<li>
<p>æä½ç³»ç»ï¼CentOS 8+/Ubuntu 20.04+/Debian 11+ï¼ä¸»æµçæ¬é½æ¯æï¼ã</p>
</li>
<li>
<p>å®è£LVMå·¥å·ï¼ç³»ç»ä¸è¬é»è®¤å®è£ï¼æ²¡æçè¯ï¼ä¸ææå®è£å½ä»¤ã</p>
</li>
<li>
<p>ç£çï¼è³å°æ1åæªä½¿ç¨çç¡¬ç/ååºï¼æå·²æ©å®¹çäºçï¼ï¼ç¨äºæ©å®¹ã</p>
</li>
</ul>
<h1 id="äºå®æåå¤3æ­¥æå®åç½®å·¥ä½å¿å">äºãå®æåå¤ï¼3æ­¥æå®åç½®å·¥ä½ï¼å¿åï¼</h1>
<p>å¼å§æ©å®¹åï¼ååå¥½è¿3æ­¥ï¼é¿åæä½åºéï¼å°ç½ä¹è½è½»æ¾å®æã</p>
<h2 id="21-æ£æ¥ç³»ç»ç¯å¢ç¡®è®¤æ¯ælvm">2.1 æ£æ¥ç³»ç»ç¯å¢ï¼ç¡®è®¤æ¯æLVMï¼</h2>
<p>å¤å¶ä¸é¢çå½ä»¤ï¼ä¾æ¬¡æ§è¡ï¼æ¥çç³»ç»æ¯å¦æ¯æLVMï¼ä¸ç¨æå½ä»¤å«ä¹ï¼æ§è¡å°±è¡ï¼ï¼</p>
<pre><code class="language-bash"># æ£æ¥æä½ç³»ç»çæ¬
cat /etc/os-release | grep -E "^(NAME|VERSION)="

# æ£æ¥LVMçæ¬ï¼æè¾åºå°±æ¯å·²å®è£ï¼
lvm version 2&gt;&amp;1 | head -5

# æ£æ¥åæ ¸æ¨¡åï¼ç¡®ä¿LVMè½æ­£å¸¸å·¥ä½ï¼
lsmod | grep -E "^dm_"

# è¥æ²¡æè¾åºï¼æ¨¡åæªå è½½ï¼ï¼æ§è¡ä¸é¢2è¡å½ä»¤å è½½
modprobe dm-mod
modprobe dm-snapshot
</code></pre>
<h2 id="22-å®è£lvmå·¥å·æªå®è£åæ§è¡">2.2 å®è£LVMå·¥å·ï¼æªå®è£åæ§è¡ï¼</h2>
<pre><code class="language-bash"># CentOS/Rocky Linuxï¼çº¢å¸½ç³»ï¼
dnf install -y lvm2 device-mapper-persistent-data

# Ubuntu/Debianï¼debianç³»ï¼
apt update &amp;&amp; apt install -y lvm2 thin-provisioning-tools

# éªè¯å®è£ï¼æè¾åºå°±æ¯å®è£æåï¼
pvs --version
</code></pre>
<h2 id="23-æ£æ¥ç£çç¶æå³é®é¿åè¯¯æä½">2.3 æ£æ¥ç£çç¶æï¼å³é®ï¼é¿åè¯¯æä½ï¼</h2>
<p>æ§è¡å½ä»¤ï¼æ¥çå½åç£çæåµï¼ç¡®è®¤ææªä½¿ç¨çç£çï¼æ¯å¦/dev/sdbï¼æ²¡ææè½½ç¹ï¼æ²¡ææä»¶ç³»ç»ï¼ï¼</p>
<pre><code class="language-bash"># ååºææç£çï¼éç¹çãMOUNTPOINTãåï¼ç©ºçå°±æ¯æªä½¿ç¨ï¼
lsblk -o NAME,SIZE,TYPE,FSTYPE,MOUNTPOINT
</code></pre>
<p>è¾åºç¤ºä¾ï¼éç¹çsdbï¼æªæè½½ãæ æä»¶ç³»ç»ï¼å¯ç¨äºæ©å®¹ï¼ï¼</p>
<p>NAME SIZE TYPE FSTYPE MOUNTPOINT sda 50G disk ââsda1 1G part xfs /boot ââsda2 49G part LVM2_member sdb 100G disk ï¼æªä½¿ç¨ï¼å¯åPVï¼</p>
<p>â ï¸ è­¦åï¼ä¸å®è¦ç¡®è®¤ç£çæ æ°æ®ãæªæè½½ï¼å¦åæä½ä¼ä¸¢å¤±æ°æ®ï¼</p>
<h1 id="ä¸æ ¸å¿å®æ5ç§lvmæ©å®¹æ¹æ³å°ç½ä¼åçå3ç§">ä¸ãæ ¸å¿å®æï¼5ç§LVMæ©å®¹æ¹æ³ï¼å°ç½ä¼åçå3ç§ï¼</h1>
<p>ä»¥ä¸5ç§æ¹æ³ï¼è¦çä¸ååºæ¯ï¼å°ç½ä¼åææ¡ãæ¹æ³ä¸ãäºãä¸ãï¼æå¸¸ç¨ãæç®åï¼ï¼æ¹æ³åãäºéåç¹å®åºæ¯ï¼èæåãå¤ä»½å­å¨ï¼ã</p>
<p>ææå½ä»¤é½å¯ä»¥ç´æ¥å¤å¶æ§è¡ï¼éç¹çãæ­¥éª¤+æ³¨éãï¼ä¸ç¨æ­»è®°å½ä»¤å«ä¹ã</p>
<h2 id="æ¹æ³ä¸æ·»å æ°ç£çæå¸¸ç¨-æ°å¢ç¡¬çäºçæ©å±vgåæ©lv">æ¹æ³ä¸ï¼æ·»å æ°ç£çï¼æå¸¸ç¨ï¼ââ æ°å¢ç¡¬ç/äºçï¼æ©å±VGåæ©LV</h2>
<p>åºæ¯ï¼æå¡å¨æ°å¢ç©çç¡¬çï¼æäºä¸»æºæè½½æ°äºçï¼æ¯å¦é¿éäºãè¾è®¯äºæ°å¢äºçï¼ï¼æéç¨çæ©å®¹æ¹å¼ã</p>
<p>æ­¥éª¤ï¼4æ­¥æå®ï¼å¨ç¨å¨çº¿ï¼ä¸ç¨åä¸å¡ï¼ï¼</p>
<h3 id="æ­¥éª¤1åå»ºpvææ°ç£çåææ°´æº">æ­¥éª¤1ï¼åå»ºPVï¼ææ°ç£çåæãæ°´æºãï¼</h3>
<pre><code class="language-bash"># ææ°ç£çï¼/dev/sdbï¼åå§åä¸ºPVï¼æ¿æ¢æä½ çç£çè·¯å¾ï¼æ¯å¦/dev/sdcï¼
pvcreate /dev/sdb

# éªè¯PVåå»ºæåï¼æè¾åºå°±æ¯æåï¼
pvdisplay /dev/sdb
</code></pre>
<h3 id="æ­¥éª¤2æ©å±vgç»å¤§æ°´æ± å æ°´">æ­¥éª¤2ï¼æ©å±VGï¼ç»ãå¤§æ°´æ± ãå æ°´ï¼</h3>
<pre><code class="language-bash"># ææ°åå»ºçPVï¼/dev/sdbï¼å å¥ç°æçVGï¼æ¿æ¢æä½ çVGåç§°ï¼æ¯å¦vg_dataï¼
# ä¸ç¥éVGåç§°ï¼æ§è¡vgså½ä»¤æ¥ç
vgextend vg_data /dev/sdb

# éªè¯VGæ©å±æåï¼æ¥çVGå©ä½ç©ºé´ï¼ææ°å¢ç©ºé´å°±æ¯æåï¼
vgdisplay vg_data | grep -E "(VG Size|Free)"
</code></pre>
<h3 id="æ­¥éª¤3æ©å±lvæå°æ°´çåå¤§">æ­¥éª¤3ï¼æ©å±LVï¼æãå°æ°´çãåå¤§ï¼</h3>
<pre><code class="language-bash"># 3ç§æ¹å¼ï¼éä¸ç§å³å¯ï¼æ¿æ¢æä½ çLVè·¯å¾ï¼æ¯å¦/dev/vg_data/lv_mysqlï¼
# æ¹å¼1ï¼æ©å±æå®å¤§å°ï¼æ¯å¦æ°å¢50Gï¼
lvextend -L +50G /dev/vg_data/lv_mysql

# æ¹å¼2ï¼æ©å±å°æå®å¤§å°ï¼æ¯å¦æ©å±å°150Gï¼
lvextend -L 150G /dev/vg_data/lv_mysql

# æ¹å¼3ï¼ä½¿ç¨VGææå©ä½ç©ºé´ï¼æ¨èï¼ç´æ¥ç¨æ»¡æ°å¢çç©ºé´ï¼
lvextend -l +100%FREE /dev/vg_data/lv_mysql

# éªè¯LVæ©å±æåï¼æ¥çLVå¤§å°ï¼åå¤§å°±æ¯æåï¼
lvdisplay /dev/vg_data/lv_mysql | grep "LV Size"
</code></pre>
<h3 id="æ­¥éª¤4æ©å±æä»¶ç³»ç»å³é®è®©ç³»ç»è¯å«æ°å¢ç©ºé´">æ­¥éª¤4ï¼æ©å±æä»¶ç³»ç»ï¼å³é®ï¼è®©ç³»ç»è¯å«æ°å¢ç©ºé´ï¼</h3>
<p>LVæ©å±åï¼ç³»ç»è¿è¯å«ä¸å°æ°å¢ç©ºé´ï¼éè¦æ§è¡ä¸é¢çå½ä»¤ï¼æ ¹æ®ä½ çæä»¶ç³»ç»ç±»åéæ©ï¼å¸¸è§ext4ãXFSï¼ï¼</p>
<pre><code class="language-bash"># æåµ1ï¼æä»¶ç³»ç»æ¯ext4ï¼æ§è¡è¿ä¸ªï¼
resize2fs /dev/vg_data/lv_mysql

# æåµ2ï¼æä»¶ç³»ç»æ¯XFSï¼æ§è¡è¿ä¸ªï¼æ¿æ¢æLVçæè½½ç¹ï¼æ¯å¦/data/mysqlï¼
xfs_growfs /data/mysql

# éªè¯æåï¼æ¥çæè½½ç¹ç©ºé´ï¼åå¤§å°±æ¯æåï¼
df -hT /data/mysql
</code></pre>
<p>â å®æï¼å¨ç¨ä¸ç¨åä¸å¡ï¼ç£çç©ºé´å·²ç»æ©å®¹æåï¼</p>
<h2 id="æ¹æ³äºæ©å±ç°æç£çäºçå¸¸ç¨-äºçæ©å®¹åæ©å±ç°æpv">æ¹æ³äºï¼æ©å±ç°æç£çï¼äºçå¸¸ç¨ï¼ââ äºçæ©å®¹åï¼æ©å±ç°æPV</h2>
<p>åºæ¯ï¼äºä¸»æºï¼é¿éäºãè¾è®¯äºï¼å¨æ§å¶å°æ©å®¹äºäºçï¼æ¯å¦æ50Gäºçæ©å°100Gï¼ï¼ä½ç³»ç»éçä¸å°æ°å¢ç©ºé´ï¼éè¦ææ°å¢ç©ºé´çº³å¥LVMç®¡çã</p>
<p>æ­¥éª¤ï¼4æ­¥ï¼ä¸ç¨å æ°ç£çï¼ç´æ¥æ©ç°æç©ºé´ï¼ï¼</p>
<h3 id="æ­¥éª¤1ç¡®è®¤äºçå·²æ©å®¹è®©ç³»ç»è¯å«æ°å®¹é">æ­¥éª¤1ï¼ç¡®è®¤äºçå·²æ©å®¹ï¼è®©ç³»ç»è¯å«æ°å®¹éï¼</h3>
<pre><code class="language-bash"># éæ°æ«æç£çï¼äºçç­æ©å®¹åå¿æ§è¡ï¼è®©ç³»ç»è¯å«æ°å®¹éï¼
echo 1 &gt; /sys/class/block/sdb/device/rescan

# ç¡®è®¤ç£çæ°å®¹éï¼æ¥çç£çå¤§å°ï¼å·²ç»åææ©å®¹åçå¤§å°å°±æ¯æåï¼
lsblk /dev/sdb
fdisk -l /dev/sdb
</code></pre>
<h3 id="æ­¥éª¤2æ©å±ç£çååºè®©ååºå ç¨æ°å¢ç©ºé´">æ­¥éª¤2ï¼æ©å±ç£çååºï¼è®©ååºå ç¨æ°å¢ç©ºé´ï¼</h3>
<pre><code class="language-bash"># å®è£æ©å±å·¥å·ï¼çº¢å¸½ç³»ãdebianç³»äºéä¸ï¼
dnf install -y cloud-utils-growpart  # CentOS/Rocky Linux
apt install -y cloud-guest-utils     # Ubuntu/Debian

# æ©å±ååºï¼æ¿æ¢æä½ çç£çåååºï¼æ¯å¦/dev/sdbçç¬¬1ä¸ªååºï¼
growpart /dev/sdb 1
</code></pre>
<h3 id="æ­¥éª¤3æ©å±pvè®©lvmè¯å«ååºçæ°å¢ç©ºé´">æ­¥éª¤3ï¼æ©å±PVï¼è®©LVMè¯å«ååºçæ°å¢ç©ºé´ï¼</h3>
<pre><code class="language-bash"># è°æ´PVå¤§å°ï¼æ¿æ¢æä½ çååºè·¯å¾ï¼æ¯å¦/dev/sdb1ï¼
pvresize /dev/sdb1

# éªè¯æåï¼æ¥çPVå©ä½ç©ºé´ï¼ææ°å¢ç©ºé´å°±æ¯æåï¼
pvdisplay /dev/sdb1 | grep -E "(PV Size|Free PE)"
</code></pre>
<h3 id="æ­¥éª¤4ä¸é®æ©å±lvåæä»¶ç³»ç»ç®åæä½">æ­¥éª¤4ï¼ä¸é®æ©å±LVåæä»¶ç³»ç»ï¼ç®åæä½ï¼</h3>
<pre><code class="language-bash"># ä¸æ¡å½ä»¤æå®ï¼æ©å±LVï¼åæ¶èªå¨æ©å±æä»¶ç³»ç»ï¼ä¸ç¨åç¬æ§è¡resize2fs/xfs_growfsï¼
lvextend -r -l +100%FREE /dev/vg_data/lv_mysql
</code></pre>
<p>â å®æï¼äºçæ©å®¹åçç©ºé´ï¼å·²ç»æåçº³å¥LVMç®¡çï¼ä¸å¡æ æç¥ã</p>
<h2 id="æ¹æ³ä¸ä¸é®æ©å®¹æç®å-lvextend--r-ä¸é®æå®">æ¹æ³ä¸ï¼ä¸é®æ©å®¹ï¼æç®åï¼ââ lvextend -r ä¸é®æå®</h2>
<p>åºæ¯ï¼VGæå©ä½ç©ºé´ï¼æ¯å¦ä¹åå è¿PVï¼è¿ææªåéç©ºé´ï¼ï¼æ³å¿«éæ©å®¹LVï¼ä¸ç¨åæ­¥æ§è¡ã</p>
<p>æ ¸å¿ï¼å©ç¨LVMçã-rãåæ°ï¼èªå¨æ©å±LV+æä»¶ç³»ç»ï¼ä¸æ­¥å°ä½ã</p>
<pre><code class="language-bash"># 3ç§ä¸é®æ©å®¹æ¹å¼ï¼éä¸ç§å³å¯ï¼æ¿æ¢æä½ çLVè·¯å¾ï¼
# æ¹å¼1ï¼æ°å¢20Gç©ºé´ï¼èªå¨æ©å±æä»¶ç³»ç»
lvextend -r -L +20G /dev/vg_data/lv_mysql

# æ¹å¼2ï¼ä½¿ç¨VGå©ä½ç©ºé´ç50%
lvextend -r -l +50%FREE /dev/vg_data/lv_mysql

# æ¹å¼3ï¼ä½¿ç¨VGææå©ä½ç©ºé´ï¼æ¨èï¼
lvextend -r -l +100%FREE /dev/vg_data/lv_mysql
</code></pre>
<p>â å®æï¼æç®åçæ©å®¹æ¹å¼ï¼å°ç½é¦éï¼é¿ååæ­¥æä½åºéã</p>
<h2 id="æ¹æ³åç²¾ç®éç½®æ©å®¹èæåå¸¸ç¨-thin-provisioning">æ¹æ³åï¼ç²¾ç®éç½®æ©å®¹ï¼èæåå¸¸ç¨ï¼ââ Thin Provisioning</h2>
<p>åºæ¯ï¼èæåç¯å¢ï¼KVMãProxmoxï¼ãå®¹å¨å­å¨ï¼éè¦ãè¶åéç©ºé´ãï¼æ¯å¦å®éåªæ100Gç©çç©ºé´ï¼å´è½åå»º200GçLVï¼ï¼æéåéå®éç©ºé´ï¼èçå­å¨ææ¬ã</p>
<p>æ­¥éª¤ï¼ç®åçï¼å°ç½äºè§£å³å¯ï¼å®ææéåèï¼ï¼</p>
<pre><code class="language-bash"># 1. åå»ºç²¾ç®æ± ï¼thin poolï¼æ¿æ¢æä½ çVGåç§°ï¼
lvcreate -L 80G -T vg_data/thin_pool

# 2. åå»ºç²¾ç®å·ï¼èæ200Gï¼å®éæéåéï¼
lvcreate -V 200G -T vg_data/thin_pool -n lv_vm_disk1

# 3. æ©å®¹ç²¾ç®æ± ï¼å½æ± ç©ºé´ä¸è¶³æ¶ï¼
lvextend -L +50G vg_data/thin_pool

# 4. æ©å®¹ç²¾ç®å·åæä»¶ç³»ç»
lvextend -L +100G /dev/vg_data/lv_vm_disk1
xfs_growfs /mnt/vm_disk1
</code></pre>
<h2 id="æ¹æ³äºvdoåç¼©æ©å®¹2026æ°ç¹æ§-åç¼©å»éèçç©ºé´">æ¹æ³äºï¼VDOåç¼©æ©å®¹ï¼2026æ°ç¹æ§ï¼ââ åç¼©å»éï¼èçç©ºé´</h2>
<p>åºæ¯ï¼å¤ä»½å­å¨ãèææºéåï¼éå¤æ°æ®å¤çåºæ¯ï¼ï¼å©ç¨LVM2 2.03.xæ°ç¹æ§ï¼å®ç°æ°æ®åç¼©+å»éï¼æ¯å¦100Gç©çç©ºé´ï¼å¯å­å¨300Gæ°æ®ï¼3:1åç¼©æ¯ï¼ã</p>
<p>æ­¥éª¤ï¼ç®åçï¼éLVM2 2.03.xä»¥ä¸çæ¬ï¼ï¼</p>
<pre><code class="language-bash"># 1. åå»ºVDOæ± ï¼100Gç©çç©ºé´ï¼èæ300Gé»è¾ç©ºé´ï¼
lvcreate --type vdo -L 100G -V 300G -n vdo_pool vg_data

# 2. æ©å®¹VDOç©çç©ºé´ï¼æ°å¢50Gï¼
lvextend -L +50G vg_data/vdo_pool_vpool

# 3. æ©å®¹VDOé»è¾ç©ºé´ï¼æ°å¢100Gï¼
lvextend -L +100G vg_data/vdo_pool

# 4. æ©å±æä»¶ç³»ç»
xfs_growfs /mnt/vdo_storage
</code></pre>
<h1 id="åå®ææ¡ä¾mysqlæ°æ®åºé¶åæºæ©å®¹å°ç½å¿ç">åãå®ææ¡ä¾ï¼MySQLæ°æ®åºé¶åæºæ©å®¹ï¼å°ç½å¿çï¼</h1>
<p>ç»åæ¹æ³ä¸ï¼å®ææ¼ç¤ºãMySQLæ°æ®åºå¨çº¿æ©å®¹ãï¼æ¨¡æçäº§ç¯å¢æå¸¸è§åºæ¯ï¼è·çåå°±è½æå®ã</p>
<h2 id="åºæ¯æè¿°">åºæ¯æè¿°</h2>
<p>çäº§ç¯å¢MySQLæå¡å¨ï¼æ°æ®ç®å½/var/lib/mysqlï¼æè½½å¨/dev/vg_data/lv_mysqlï¼100Gï¼XFSæä»¶ç³»ç»ï¼ï¼ä½¿ç¨çè¾¾å°85%ï¼éè¦æ°å¢50Gç©ºé´ï¼ä¸åæ­¢MySQLæå¡ã</p>
<p>ç¯å¢ï¼CentOS 9ï¼MySQL 8.0ï¼æ°å¢ç£ç/dev/sdcï¼100Gï¼ã</p>
<h2 id="å®ææ­¥éª¤ç´æ¥å¤å¶æ§è¡">å®ææ­¥éª¤ï¼ç´æ¥å¤å¶æ§è¡ï¼</h2>
<pre><code class="language-bash"># 1. ç¡®è®¤å½åç£çä½¿ç¨çï¼æ¥çæ¯å¦ççæ»¡äºï¼
df -hT /var/lib/mysql

# 2. ç¡®è®¤MySQLæå¡æ­£å¸¸è¿è¡ï¼æ©å®¹ä¸å½±åæå¡ï¼
systemctl status mysqld
mysql -e "SHOW STATUS LIKE 'Uptime';"

# 3. åå»ºPVï¼æ°å¢ç£ç/dev/sdcï¼
pvcreate /dev/sdc

# 4. æ©å±VGï¼å å¥ç°ævg_dataï¼
vgextend vg_data /dev/sdc

# 5. ä¸é®æ©å®¹LV+æä»¶ç³»ç»ï¼æ°å¢50Gï¼
lvextend -r -L +50G /dev/vg_data/lv_mysql

# 6. éªè¯æ©å®¹æå
df -hT /var/lib/mysql

# 7. ç¡®è®¤MySQLæå¡æ­£å¸¸ï¼æ ä¸­æ­ï¼
mysql -e "SHOW STATUS LIKE 'Uptime';"
</code></pre>
<p>â ç»æï¼MySQLæå¡å¨ç¨æªä¸­æ­ï¼ç£çç©ºé´ä»100Gæ©å±å°150Gï¼ä½¿ç¨çä»85%éå°57%ï¼å®ç¾è§£å³ç£çåè­¦ã</p>
<h1 id="äºå°ç½å¿çæ³¨æäºé¡¹é¿åæåéä¸­ä¹é">äºãå°ç½å¿çï¼æ³¨æäºé¡¹+é¿åæåï¼éä¸­ä¹éï¼</h1>
<p>LVMæä½æ¶ååºå±å­å¨ï¼ä¸æ­¥éå¯è½ä¸¢æ°æ®ï¼ä»¥ä¸æ³¨æäºé¡¹ï¼ä¸å®è¦çå®åæä½ï¼</p>
<h2 id="51-æ ¸å¿è­¦åå¿ç">5.1 æ ¸å¿è­¦åï¼å¿çï¼</h2>
<ul>
<li>
<p>â ï¸ æææä½åï¼<strong>å¡å¿å¤ä»½æ°æ®</strong>ï¼åªææ¯å¨çº¿æ©å®¹ï¼ä¹ææå°æ¦çåºéï¼å¤ä»½æ¯æåä¿éï¼æ¯å¦å¤ä»½MySQLæ°æ®ãéè¦æä»¶ï¼ã</p>
</li>
<li>
<p>â ï¸ XFSæä»¶ç³»ç»ãåªè½æ©å®¹ï¼ä¸è½ç¼©å®¹ãï¼è§åLVå¤§å°æ¶ï¼å°½éé¢çä¸å®ç©ºé´ï¼é¿ååç»­æ³ç¼©å®¹å´æ æ³æä½ã</p>
</li>
<li>
<p>â ï¸ ä¸è¦è¯¯æä½æ­£å¨ä½¿ç¨çç£çï¼æ§è¡lsblkå½ä»¤ï¼ç¡®è®¤ç£çæªæè½½ãæ æ°æ®ï¼åè¿è¡PVåå»ºã</p>
</li>
</ul>
<h2 id="52-å¸¸è§é¿åç¹">5.2 å¸¸è§é¿åç¹</h2>
<ul>
<li>
<p>å1ï¼LVæ©å±åï¼dfå½ä»¤çä¸å°æ°å¢ç©ºé´ â å¿è®°æ©å±æä»¶ç³»ç»ï¼æ§è¡resize2fsï¼ext4ï¼æxfs_growfsï¼XFSï¼å³å¯ã</p>
</li>
<li>
<p>å2ï¼äºçæ©å®¹åï¼ç³»ç»çä¸å°æ°å®¹é â å¿è®°æ§è¡ç£çæ«æå½ä»¤ï¼echo 1 &gt; /sys/class/block/sdb/device/rescanï¼ã</p>
</li>
<li>
<p>å3ï¼vgextendå½ä»¤å¤±è´¥ â ç¡®è®¤PVåå»ºæåï¼pvdisplayæ¥çï¼ï¼ä¸VGåç§°æ­£ç¡®ï¼vgså½ä»¤æ¥çï¼ã</p>
</li>
</ul>
<h2 id="53-æä½³å®è·µå°ç½åè">5.3 æä½³å®è·µï¼å°ç½åèï¼</h2>
<ul>
<li>
<p>åå»ºVGæ¶ï¼æå®PEå¤§å°ä¸º16MBæ32MBï¼å¤§å®¹éå­å¨æ´é«æï¼ï¼vgcreate -s 16M vg_data /dev/sdbã</p>
</li>
<li>
<p>å®æå¤ä»½LVMåæ°æ®ï¼vgcfgbackup vg_dataï¼é¿åVGæåï¼æ æ³æ¢å¤ï¼ã</p>
</li>
<li>
<p>çæ§VGå©ä½ç©ºé´ï¼å½å©ä½ç©ºé´ä½äº10%æ¶ï¼æåæ©å®¹ï¼é¿åç£çæ»¡å¯¼è´ä¸å¡ä¸­æ­ã</p>
</li>
</ul>
<h1 id="å­ç»å°¾æ»ç»å½ä»¤éæ¥è¡¨">å­ãç»å°¾æ»ç»+å½ä»¤éæ¥è¡¨</h1>
<h2 id="61-æ ¸å¿æ»ç»">6.1 æ ¸å¿æ»ç»</h2>
<p>LVMå¨ææ©å®¹çæ ¸å¿é»è¾ï¼<strong>æ©PV â æ©VG â æ©LV â æ©æä»¶ç³»ç»</strong>ï¼ä¸é®æ©å®¹å¯è·³è¿é¨åæ­¥éª¤ï¼ã</p>
<p>å°ç½éç¹ææ¡å3ç§æ¹æ³ï¼æ·»å æ°ç£çãæ©å±ç°æç£çãä¸é®æ©å®¹ï¼ï¼å°±è½åºå¯¹90%ä»¥ä¸çæ©å®¹åºæ¯ï¼å¨ç¨é¶åæºï¼ä¸å¡æ æç¥ã</p>
<h2 id="62-å¸¸ç¨å½ä»¤éæ¥è¡¨å°ç½æ¶èå¤ç¨">6.2 å¸¸ç¨å½ä»¤éæ¥è¡¨ï¼å°ç½æ¶èï¼å¤ç¨ï¼</h2>
<pre><code class="language-bash"># PVæä½ï¼ç©çå·ï¼
pvcreate /dev/sdb    # åå»ºPV
pvdisplay /dev/sdb   # æ¥çPVè¯¦æ
pvs                  # ååºææPV

# VGæä½ï¼å·ç»ï¼
vgcreate vg_data /dev/sdb  # åå»ºVG
vgextend vg_data /dev/sdc  # æ©å±VG
vgdisplay vg_data          # æ¥çVGè¯¦æ
vgs                        # ååºææVG

# LVæä½ï¼é»è¾å·ï¼
lvcreate -L 50G -n lv_data vg_data  # åå»ºLV
lvextend -r -L +20G /dev/vg_data/lv_data  # ä¸é®æ©å®¹LV
lvdisplay /dev/vg_data/lv_data            # æ¥çLVè¯¦æ
lvs                                       # ååºææLV

# æä»¶ç³»ç»æ©å±
resize2fs /dev/vg_data/lv_data  # ext4æ©å®¹
xfs_growfs /data/mysql          # XFSæ©å®¹
</code></pre>
<p>ð¡ æåæéï¼å®ææ¶ï¼ä¸å®è¦æ¿æ¢æèªå·±çç£çè·¯å¾ï¼/dev/sdbï¼ãVGåç§°ï¼vg_dataï¼ãLVè·¯å¾ï¼é¿åå¤å¶éè¯¯ï¼</p>
<p>å¦ææä½ä¸­éå°é®é¢ï¼è¯è®ºåºçè¨ï¼æä¼ä¸ä¸è§£ç­ï¼å¸®å©å¤§å®¶é¿åï¼è½»æ¾æå®LVMæ©å®¹ï½</p>


</div>
<div class="clear"></div>

		<p class="postfoot">
			posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-05 10:42">2026-02-05 10:42</span>&nbsp;
<a href="https://www.cnblogs.com/liuziyi1">åå­æ¯</a>&nbsp;
éè¯»(<span id="post_view_count">159</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19577932);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19577932', targetLink: 'https://www.cnblogs.com/liuziyi1/p/19577932', title: 'LVMå¨ææ©å®¹å®å¨æåï½å°ç½ä¹è½ä¸æï¼é¶åæºæ©å±ç£çç©ºé´ï¼5ç§æ¹æ³ï¼' })">ä¸¾æ¥</a>

		</p>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ FastAPIçå½å¨æç®¡çå®æï¼ä»å¯å¨å°å³é­ï¼å¦ä½ä¼éå°ç®¡å¥½ä½ çâèµæºå®¶å½â ]]></title>
    <link>https://www.cnblogs.com/ymtianyu/p/19577804</link>
    <guid>4c6bca9b46d532a08d5f75eb0a8c5797</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ymtianyu/p/19577804" title="åå¸äº 2026-02-05 10:23">
    <span role="heading" aria-level="2">FastAPIçå½å¨æç®¡çå®æï¼ä»å¯å¨å°å³é­ï¼å¦ä½ä¼éå°ç®¡å¥½ä½ çâèµæºå®¶å½â</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬ææ·±å¥è®²è§£äºFastAPIçLifespançå½å¨æç®¡çæºå¶ï¼è¯¦ç»åæäºå¶å·¥ä½åçï¼å¹¶æä¾äºä½¿ç¨@asynccontextmanagerçå®æ´å®æä»£ç ç¤ºä¾ãéç¹æ»ç»äºèµæºåå§åãä¼éå³é­çå®ç°æ¹æ³ï¼ä»¥åå¨å®éä½¿ç¨ä¸­å¸¸è§çåä¸ªâåç¹âä¸è§£å³æ¹æ¡ï¼æ¨å¨å¸®å©å¼åèæå»ºæ´ç¨³å®ãä¸ä¸çFastAPIåºç¨ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h2>FastAPIå®æï¼ä½ ä»¥ä¸ºçå¯å¨ä¸å³é­ï¼è¿ä¸æ­¢å¼å§åç»æ</h2>
<p><strong style="color: rgba(186, 55, 42, 1)">æè¦ï¼</strong>æ¬æè¯¦ç»æ¢è®¨äºFastAPIçLifespanï¼çå½å¨æï¼ç®¡çï¼ä»ä¸ºä»ä¹éè¦å®ãå®çæ ¸å¿å·¥ä½åçï¼å°ä½¿ç¨<span style="color: rgba(186, 55, 42, 1)"><code>@asynccontextmanager</code></span>çæä½³å®è·µãå¸¸è§âåç¹âåè§£å³æ¹æ¡ãéè¿ä¸ä¸ªå®æ´çå®æç¤ºä¾ï¼ä½ å°å­¦ä¼å¦ä½ä¼éå°ç®¡çæ°æ®åºè¿æ¥æ± ãéç½®å è½½ç­èµæºï¼ç¡®ä¿åºç¨ç¨³å®å¯æ§ã</p>
<hr style="border: none; height: 1px; background: linear-gradient(90deg, rgba(0, 0, 0, 0), rgba(52, 152, 219, 1), rgba(0, 0, 0, 0)); margin: 20px 0">
<p>ææ²¡æå¨é¨ç½²FastAPIåºç¨åï¼éå°è¿è¿äºç¶åµï¼ð</p>
<p>â æå¡ä¸éå¯ï¼åå ä¸ªè¯·æ±æ»æ¯å¤±è´¥ï¼æ¥å¿éé£çâæ°æ®åºè¿æ¥éè¯¯âã</p>
<p>â æ³ä¼éå°å³é­ï¼ç»ä¸æ¸¸æå¡åä¸ªéç¥ï¼å´åç°è¯·æ±ç´æ¥è¢«ææ­ï¼èµæºæ¸çäºä¸ªå¯å¯ã</p>
<p>â ä¾èµé¡¹ï¼æ¯å¦éç½®ãå¤é¨å®¢æ·ç«¯ï¼çåå§åä»£ç ï¼æ£è½å¨è·¯ç±åä¸­é´ä»¶éï¼ç»´æ¤èµ·æ¥å¤´å¤§ã</p>
<p>è¿äºé½æ¯ç¨ <code style="color: rgba(186, 55, 42, 1)">@app.on_event("startup")</code> å <code style="color: rgba(186, 55, 42, 1)">"shutdown"</code> è¸©åè¸©åºæ¥çç»éªï¼åç¼æ³ªï¼ãä»å¤©ï¼å±ä»¬å°±æ¥èèå®çæ­£ç»æ¥ç­äººââ<strong><span style="color: rgba(186, 55, 42, 1)"><code>Lifespan</code></span></strong>ï¼ä»¥åæä¹ç¨å®ååºæ´å¥å£®ãæ´ä¸ä¸çFastAPIåºç¨ã</p>
<h2>ð¯ ç¬¬ä¸é¨åï¼é®é¢åºå¨åªï¼ä»âé¤åâçæ··ä¹±å¼ä¸è¯´èµ·</h2>
<p>æ³è±¡ä¸ä¸ä½ å¼äºä¸å®¶æ°å­é¤åï¼ä½ çFastAPIåºç¨ï¼ã</p>
<p>ð <strong>èåæ³ï¼on_eventï¼ï¼</strong> æ©ä¸å¼ä¸æ¶é´å°äºï¼å¨å¸ï¼æ°æ®åºè¿æ¥æ± ï¼ãæå¡åï¼éç½®ï¼ãéè´­åï¼HTTPå®¢æ·ç«¯ï¼æææå¼ å¼ å°åèªå¼å§åå¤ãå®¢äººï¼è¯·æ±ï¼å·²ç»è¿é¨ç¹èäºï¼å¨å¸å¯è½è¿éé½è¿æ²¡ç­ãæä¸æçæ¶ï¼ä¸å£°ä»¤ä¸ç´æ¥æé¸ï¼éè´­åæéè¿å¨è¿è¡çè®¢åãå¨å¸æ²¡æ´çéï¼å¨é½æç¶èæ­¢ã</p>
<p>è¿ï¼å°±æ¯æ©æå¯å¨/å³é­äºä»¶çå¼æ­¥é®é¢ï¼ä»¥åç¼ºä¹å¯¹âåå¤âåâæ¸çâé¶æ®µçç²¾ç»æ§å¶ã</p>
<p>FastAPIå¨è¾æ°ççæ¬ä¸­ï¼å¼å¥äº<code style="color: rgba(186, 55, 42, 1)">lifespan</code>åæ°ï¼å®æ¯ä¸ä¸ªå¼æ­¥ä¸ä¸æç®¡çå¨ãå®çæ ¸å¿ææ³æ¯ï¼<strong style="color: rgba(186, 55, 42, 1)">å¨åºç¨æ­£å¼å¤çè¯·æ±åï¼æææâå®¶å½âé½åå¤å¥½ï¼å¨åºç¨éåºåï¼ææ¡ä¸ç´å°æ¶æ¾å¥½ææâå®¶å½âã</strong></p>
<p>è¿ç¡®ä¿äºå¨åºç¨çå½å¨æåï¼èµæºç¶ææ¯ç¡®å®çã</p>
<h2>ð§  ç¬¬äºé¨åï¼æ ¸å¿åçä¸æ­¥éª¤ï¼ä¸ä¸ª yield æå®ææ</h2>
<p><code style="color: rgba(186, 55, 42, 1)">lifespan</code> çåçï¼å¶å®å°±æ¯Pythonå¼æ­¥ä¸ä¸æç®¡çå¨çç»å¸æ¨¡å¼ï¼<code style="color: rgba(186, 55, 42, 1)">__aenter__</code> å <code style="color: rgba(186, 55, 42, 1)">__aexit__</code>ãå¨FastAPIéï¼æä»¬ç¨ä¸ä¸ª<code style="color: rgba(186, 55, 42, 1)">@asynccontextmanager</code>è£é¥°å¨å°±è½ä¼éå®ç°ã</p>
<p>å®çå·¥ä½æµè¶çº§æ¸æ°ï¼</p>
<div>
<p>â1ï¸â£ <code style="color: rgba(186, 55, 42, 1)">yield</code> ä¹åï¼å¯å¨é»è¾ãå¨è¿éè¿æ¥æ°æ®åºãå è½½éç½®ãåå»ºåç§å®¢æ·ç«¯ã</p>
<p>â2ï¸â£ <code style="color: rgba(186, 55, 42, 1)">yield</code> é£ä¸å»ï¼åºç¨è¿å¥âè¿è¡å°±ç»ªâç¶æãæ­¤æ¶ææèµæºé½å·²åå§åå®æ¯ï¼å¯ä»¥å®å¨æ¥æ¶è¯·æ±ã</p>
<p>â3ï¸â£ <code style="color: rgba(186, 55, 42, 1)">yield</code> ä¹åï¼å³é­é»è¾ãå¨è¿éå³é­è¿æ¥æ± ãæ¸çä¸´æ¶æä»¶ãåéå³é­éç¥ã</p>
</div>
<p><strong style="color: rgba(186, 55, 42, 1)">éç¹ï¼</strong> ææå¨<code style="color: rgba(186, 55, 42, 1)">yield</code>ååå§åçå¯¹è±¡ï¼é½å¯ä»¥éè¿<code style="color: rgba(186, 55, 42, 1)">request.app.state</code>å¨æ´ä¸ªåºç¨èå´åå±äº«ãè¿æ¯ä¾èµæ³¨å¥çâåå¤æ»é¨âï¼</p>
<h2>ð» ç¬¬ä¸é¨åï¼å®ææ¼ç¤ºï¼ææææ­ä¸ä¸ªç¨³å¦èççåºç¨</h2>
<p>åè¯´ä¸ç»åæå¼ï¼æ¥çä¸ä¸ªéæäºRedisè¿æ¥æ± åéç½®ç®¡ççå®æä¾å­ãä½ å®å¨å¯ä»¥ç´æ¥å¤å¶ï¼æ¹æ¹å°±è½ç¨ã</p>
<pre class="language-python highlighter-hljs"><code>from contextlib import asynccontextmanager
from fastapi import FastAPI, Depends, Request
import redis.asyncio as redis

# åè£ä»ç¯å¢ææä»¶å è½½çéç½®
APP_CONFIG = {"redis_url": "redis://localhost", "max_connections": 10}

# è¿éæ¯æ ¸å¿ï¼å®ä¹ lifespan
@asynccontextmanager
async def app_lifespan(app: FastAPI):
    """
    åºç¨çå½å¨æç®¡ç
    1. å¯å¨ï¼åå»ºRedisè¿æ¥æ± 
    2. è¿è¡ï¼ä¿æ
    3. å³é­ï¼æ¸çè¿æ¥æ± 
    """
    print("ð åºç¨å¯å¨ä¸­...æ­£å¨åå§åèµæº")
    # --- å¯å¨é¶æ®µ ---
    # åå§åRedisè¿æ¥æ± 
    try:
        redis_pool = redis.ConnectionPool.from_url(
            APP_CONFIG["redis_url"],
            max_connections=APP_CONFIG["max_connections"],
            decode_responses=True
        )
        app.state.redis_pool = redis_pool
        app.state.config = APP_CONFIG  # éç½®ä¹å­è¿å»
        print("â Redisè¿æ¥æ± åéç½®åå§åå®æï¼")
    except Exception as e:
        print(f"â èµæºåå§åå¤±è´¥: {e}")
        # è¿éä¸å®è¦å¤±è´¥ï¼ä¸è¦è®©åºç¨å¸¦çé®é¢å¯å¨
        raise

    #  yield æ å¿çåºç¨æ­£å¼å¯å¨å®æï¼å¼å§æ¥æ¶è¯·æ±
    yield

    # --- å³é­é¶æ®µ ---
    print("\nð åºç¨å³é­ä¸­...æ­£å¨æ¸çèµæº")
    # å³é­Redisè¿æ¥æ± 
    if hasattr(app.state, 'redis_pool'):
        await app.state.redis_pool.disconnect()
        print("â Redisè¿æ¥æ± å·²å³é­ã")
    print("ð èµæºæ¸çå®æ¯ï¼åºç¨å®å¨éåºã")

# åå»ºAppï¼æ³¨å¥lifespan
app = FastAPI(title="Lifespan Demo", lifespan=app_lifespan)

# ä¸ä¸ªä¾èµé¡¹ï¼ç¨äºå¨è·¯ç±ä¸­æ¹ä¾¿å°è·åRedisè¿æ¥
async def get_redis(request: Request):
    # ç´æ¥ä»app.stateè·åè¿æ¥æ± ï¼å¹¶åå»ºä¸´æ¶è¿æ¥
    async with redis.Redis(connection_pool=request.app.state.redis_pool) as client:
        yield client

# ç¤ºä¾è·¯ç±
@app.get("/cache/{key}")
async def get_cache(key: str, redis = Depends(get_redis)):
    value = await redis.get(key)
    return {"key": key, "value": value}

@app.post("/cache/{key}")
async def set_cache(key: str, value: str, redis = Depends(get_redis)):
    await redis.set(key, value, ex=60)  # 60ç§è¿æ
    return {"msg": "OK"}

@app.get("/config")
async def show_config(request: Request):
    # ç´æ¥è®¿é®å¨å±éç½®
    return request.app.state.config

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
    </code></pre>
<p>è·èµ·æ¥ä¹åï¼ä½ ä¼çå°æ§å¶å°åæå°å¯å¨æ¥å¿ï¼Uvicornå·¥äººå°±ä½åï¼åºç¨æå¼å§çå¬è¯·æ±ãç¨<code style="color: rgba(186, 55, 42, 1)">Ctrl+C</code>å³é­æ¶ï¼å³é­é»è¾ä¹ä¼è¢«æ§è¡ã</p>
<h2>ð¨ ç¬¬åé¨åï¼å¸¸è§åç¹ &amp; æçè¡æ³ªç»éª</h2>
<p>å¥½äºï¼ä»£ç è·éäºï¼ä½ä¸é¢è¿äºææ¯ä¿è¯ä½ ä¸ä¸çäº§ç¯å¢âæ¼ç ¸âçå³é®ã</p>
<div>
<p><strong>ð¥ åç¹ä¸ï¼å¯å¨å¤±è´¥å¤çä¸å½</strong></p>
<p>â- <strong>é®é¢ï¼</strong> å¦æå¨<code style="color: rgba(186, 55, 42, 1)">yield</code>ä¹ååå§åæ°æ®åºå¤±è´¥äºï¼ä½ è¯¥æä¹åï¼</p>
<p>â- <strong>æçæè®­ï¼</strong> åä¸å«åå¼å¸¸ï¼å°±åä¸é¢ä»£ç éåçï¼å¿é¡»<code style="color: rgba(186, 55, 42, 1)">raise</code>åºå»ï¼è®©åºç¨å¯å¨å¤±è´¥ãä¸ä¸ªè¿ä¸ä¸æ°æ®åºçåºç¨ï¼ä¸å¦ä¸å¯å¨ãå¯ä»¥éè¿æ¥å¿åçæ§ç³»ç»åæ¶åè­¦ã</p>
</div>
<div>
<p><strong>ð¥ åç¹äºï¼å¨lifespanéåâæ¢âé»è¾</strong></p>
<p>â- <strong>é®é¢ï¼</strong> Lifespançå¯å¨é¶æ®µä¼é»å¡åºç¨å¯å¨ãå¦æä½ å¨è¿éè·ä¸ä¸ªèæ¶10åéçæ°æ®åæ­¥ä»»å¡ï¼ä½ çæå¡å°±10åéä¸å¯ç¨ã</p>
<p>â- <strong>æçå»ºè®®ï¼</strong> å¯¹äºéæ ¸å¿ãèæ¶çåå§åï¼å¦é¢å è½½å¤§æ°æ®æ¨¡åï¼ï¼èèå¨<code style="color: rgba(186, 55, 42, 1)">yield</code>åï¼ç¨åå°ä»»å¡å¼æ­¥æ§è¡ãæèï¼è®¾è®¡ææå è½½æ¨¡å¼ï¼å¨ç¬¬ä¸æ¬¡è¯·æ±æ¶åå§åã</p>
</div>
<div>
<p><strong>ð¥ åç¹ä¸ï¼å¿½ç¥å¼æ­¥ä¸ä¸æç®¡ç</strong></p>
<p>â- <strong>é®é¢ï¼</strong> åæ°æ®åºè¿æ¥æ± ãHTTPå®¢æ·ç«¯è¿ç±»èµæºï¼å®ä»¬èªå·±å¾å¾ä¹éè¦<code style="color: rgba(186, 55, 42, 1)">async with</code>æ¥ç®¡ççå½å¨æã</p>
<p>â- <strong>æ­£ç¡®åæ³ï¼</strong> ä»ç»éè¯»ä½ ç¨çå®¢æ·ç«¯åºææ¡£ãåä¸é¢redisç<code style="color: rgba(186, 55, 42, 1)">ConnectionPool.disconnect()</code>ï¼å®å°±æ¯å¼æ­¥çï¼å¿é¡»<code style="color: rgba(186, 55, 42, 1)">await</code>ãåæ­¥å®¢æ·ç«¯åéå¸¸å¨<code style="color: rgba(186, 55, 42, 1)">.close()</code>ã</p>
</div>
<div>
<p><strong>ð¥ åç¹åï¼Stateæ»¥ç¨</strong></p>
<p>â- <strong>é®é¢ï¼</strong> <code style="color: rgba(186, 55, 42, 1)">app.state</code>ä¸æ¯ä¸è½çå¨ç©é´ï¼å®éåæ¾<strong>å¨å±ãåªè¯»æçº¿ç¨/åç¨å®å¨</strong>çå¯¹è±¡ã</p>
<p>â- <strong>è­¦åï¼</strong> å«å¾éå¡è¯·æ±çº§å«çæ°æ®ï¼ä¹å«æ¾é¢ç¹ä¿®æ¹çå¨å±åéï¼è¿ä¼å¨å¤workerç¯å¢ä¸è®©ä½ æçäººçãå±äº«éç½®ãè¿æ¥æ± ãåå§åå¥½çå®¢æ·ç«¯å®ä¾ï¼æ¯å®çæä½³ææ¡£ã</p>
</div>
<h2>ð æåå°å¦ä¸å¥</h2>
<p>ä½¿ç¨<code style="color: rgba(186, 55, 42, 1)">lifespan</code>ï¼æ¬è´¨ä¸æ¯ä¸ç§<strong style="color: rgba(186, 55, 42, 1)">âå¥çº¦ç¼ç¨â</strong>ãä½ åæ¡æ¶æ¿è¯ºï¼âæä¼ç®¡å¥½æå¸¦æ¥çèµæºâï¼æ¡æ¶åä½ ä¿è¯ï¼âæä¼å¨æ­£ç¡®çæ¶é´ç¹ç»ä½ æ§è¡ç®¡ççæå©âã</p>
<p>å®è®©æä»¬çåºç¨ä»âè½è·âè¿åå°âè·å¾ç¨³ãå³å¾ä¼éâãå°¤å¶æ¯å¨äºåçåå®¹å¨åç¯å¢ä¸ï¼ä¼éå¯åæ¯ä¿è¯æå¡é«å¯ç¨çåºç¡ä¸ç¯ã</p>
<p>å¸æè¿ç¯èåäºæä¸å°âåâçæç« ï¼è½å¸®ä½ æFastAPIç¨å¾æ´å å¾å¿åºæãå¦æä½ ææ´å¦çç¨æ³æèä¹è¸©è¿æè¶£çåï¼æ¬¢è¿æ¥èèï¼</p>
<hr style="border: none; height: 1px; background: linear-gradient(90deg, rgba(0, 0, 0, 0), rgba(52, 152, 219, 1), rgba(0, 0, 0, 0)); margin: 40px 0">
<p style="text-align: center; color: rgba(127, 140, 141, 1); font-size: 0.9em">è§å¾æç¨å°±èµ¶ç´§æ¶èå§ï¼è¿ç§å®æç»èï¼ä¸æ¬¡éç½®æ°é¡¹ç®æ¶ç¿»åºæ¥çä¸ç¼ï¼è½çä¸ä¸å°æ¥ææ¡£åDebugçæ¶é´ãææ¯ä¸åç¨åºåªï¼æä»¬ä¸æ¬¡è§ï¼ð©ð»</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-05 10:23">2026-02-05 10:23</span>&nbsp;
<a href="https://www.cnblogs.com/ymtianyu">ä¸åç¨åºåªå</a>&nbsp;
éè¯»(<span id="post_view_count">129</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19577804);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19577804', targetLink: 'https://www.cnblogs.com/ymtianyu/p/19577804', title: 'FastAPIçå½å¨æç®¡çå®æï¼ä»å¯å¨å°å³é­ï¼å¦ä½ä¼éå°ç®¡å¥½ä½ çâèµæºå®¶å½â' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Redis äºå¡çâåå­æ§âè¿·æï¼ä¸ºä»ä¹æä»¬æç»éæ©äº Lua èæ¬ ]]></title>
    <link>https://www.cnblogs.com/xzqcsj/p/19577555</link>
    <guid>7e311e3baeb7c98651e12e85d284f2b0</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xzqcsj/p/19577555" title="åå¸äº 2026-02-05 09:49">
    <span role="heading" aria-level="2">Redis äºå¡çâåå­æ§âè¿·æï¼ä¸ºä»ä¹æä»¬æç»éæ©äº Lua èæ¬</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3703499/202602/3703499-20260205094823688-1305507315.png" alt="Redis äºå¡çâåå­æ§âè¿·æï¼ä¸ºä»ä¹æä»¬æç»éæ©äº Lua èæ¬" class="desc_img">
        ä½ä¸ºä¸ä¸ªé¿æåå³ç³»åæ°æ®åºï¼RDBMSï¼æäº¤éçå¼åèï¼åæ¬¡æ¥é Redis ææ¡£æ¶ï¼çå° MULTIãEXECãDISCARD è¿äºæä»¤ï¼å¿ä¸­é¾åæ¶èµ·ä¸è¡ç±äºçæèå¸¦æ¥çå®å¨æã
æä»¬çå¤§èä¼èªå¨å»ºç«æ å°ï¼MULTI å°±æ¯ BEGINï¼EXEC å°±æ¯ COMMITï¼DISCARD å°±æ¯ ROLLBACKãè¿å¥ç»åæ³æä¸æ¥ï¼ææçä¸å¡é»è¾ä¼¼ä¹é½åºè¯¥å·å¤äºâä¸æåä¾¿æä»âçåå­æ§ä¿éã
ä½è¿æ°æ°æ¯ Redis ç»æä¸çç¬¬ä¸è¯¾ï¼ç¸ä¼¼çå½åèåï¼å¾å¾èçæªç¶ä¸åççµé­ã å½ä½ æ MySQL çäºå¡è§çæ¬ç¡¬å¥å° Redis èº«ä¸æ¶ï¼éä»å°±å·²ç»å¼å§äºã
è¿ç¯æç« å°å¸¦ä½ å¥å¼ Redis äºå¡çå¤è¡£ï¼ä»âåå­æ§âçå®ä¹åå·®è¯´èµ·ï¼èèä¸ºä»ä¹å¨ç°ä»£å¼åä¸­ï¼æä»¬è¶æ¥è¶å¾åäºç¨ Lua èæ¬æ¥æ¿ä»£å®ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p><strong>åå¨åé¢çè¯</strong></p>
<p>ä½ä¸ºä¸ä¸ªé¿æåå³ç³»åæ°æ®åºï¼RDBMSï¼æäº¤éçå¼åèï¼åæ¬¡æ¥é Redis ææ¡£æ¶ï¼çå° <code>MULTI</code>ã<code>EXEC</code>ã<code>DISCARD</code> è¿äºæä»¤ï¼å¿ä¸­é¾åæ¶èµ·ä¸è¡ç±äºçæèå¸¦æ¥çå®å¨æã</p>
<p>æä»¬çå¤§èä¼èªå¨å»ºç«æ å°ï¼<code>MULTI</code> å°±æ¯ <code>BEGIN</code>ï¼<code>EXEC</code> å°±æ¯ <code>COMMIT</code>ï¼<code>DISCARD</code> å°±æ¯ <code>ROLLBACK</code>ãè¿å¥ç»åæ³æä¸æ¥ï¼ææçä¸å¡é»è¾ä¼¼ä¹é½åºè¯¥å·å¤äºâä¸æåä¾¿æä»âçåå­æ§ä¿éã</p>
<p>ä½è¿æ°æ°æ¯ Redis ç»æä¸çç¬¬ä¸è¯¾ï¼<strong>ç¸ä¼¼çå½åèåï¼å¾å¾èçæªç¶ä¸åççµé­ã</strong> å½ä½ æ MySQL çäºå¡è§çæ¬ç¡¬å¥å° Redis èº«ä¸æ¶ï¼éä»å°±å·²ç»å¼å§äºã</p>
<p>è¿ç¯æç« å°å¸¦ä½ å¥å¼ <strong>Redis äºå¡</strong>çå¤è¡£ï¼ä»âåå­æ§âçå®ä¹åå·®è¯´èµ·ï¼èèä¸ºä»ä¹å¨ç°ä»£å¼åä¸­ï¼æä»¬è¶æ¥è¶å¾åäº<strong>ç¨ Lua èæ¬æ¥æ¿ä»£å®ã</strong></p>
</blockquote>
<hr>
<h2 id="ä¸åæè¯¯ä¼è§£å¼redis-äºå¡ä¸æ¯-acid">ä¸ãåæè¯¯ä¼è§£å¼ï¼Redis äºå¡ä¸æ¯ ACID</h2>
<p><strong>å¨å³ç³»åæ°æ®åºçä¸çéï¼âäºå¡âäºå­éè¥åé§</strong>ï¼å®å ä¹ç­åäº <strong>ACID</strong>ï¼åå­æ§ãä¸è´æ§ãéç¦»æ§ãæä¹æ§ï¼ãæä»¬ä¹ æ¯äºâè¦ä¹å¨æï¼è¦ä¹å¨æ âçå®å¨æã</p>
<p>èå¨ Redis çä¸çéï¼<code>MULTI</code> å <code>EXEC</code> æ´åæ¯ä¸ä¸ª<strong>æ¹å¤çä¿¡å·</strong>ï¼</p>
<blockquote>
<p><strong>æä¸å å½ä»¤åæ¾è¿éåéæéï¼ç­å° <code>EXEC</code> æ¶ï¼ä¸æ¬¡æ§ãæé¡ºåºå°æ§è¡å®ä»¬ã</strong></p>
</blockquote>
<p>è¿éæä¸ä¸ªå·¨å¤§çè®¤ç¥åå·®ãå½æä»¬è°è®º Redis çâåå­æ§âæ¶ï¼Redis æçå¶å®æ¯ <strong>éç¦»æ§ï¼Isolationï¼</strong>ï¼èä¸æ¯ <strong>åæ»ï¼Rollbackï¼</strong>ã</p>
<ul>
<li><strong>å®ä¿è¯çæ¯</strong>ï¼<strong>ææ§è¡è¿æ®µå½ä»¤çæ¶åï¼å«äººä¸è½æéï¼ç¬å æ§è¡ï¼ã</strong></li>
<li><strong>å®ä¸ä¿è¯çæ¯</strong>ï¼<strong>å¦æææ§è¡å°ä¸åæ¥éäºï¼æä¼å¸®ä½ æåé¢çæä½æ¤éï¼å¤±è´¥åæ»ï¼ã</strong></li>
</ul>
<p>ä¸ºäºæ´ç´è§å°çè§£ï¼æä»¬å¯ä»¥å¯¹æ¯ä¸ä¸ Redis äºå¡åæ å ACID äºå¡çåºå«ï¼</p>
<table>
<thead>
<tr>
<th style="text-align: left">ç¹æ§</th>
<th style="text-align: left">å³ç³»åæ°æ®åº (MySQL)</th>
<th style="text-align: left">Redis äºå¡</th>
<th style="text-align: left">å·®å¼è§£è¯»</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>åå­æ§ (Atomicity)</strong></td>
<td style="text-align: left"><strong>All or Nothing</strong> <br> å¤±è´¥å³åæ»ï¼å¦åæªåçè¿</td>
<td style="text-align: left"><strong>All or Partial</strong> <br> æ²¡å¾åéï¼éäºå°±éäºï¼å©ä¸çæ¥çå¹²</td>
<td style="text-align: left">Redis ä¸æ¯æ Rollbackï¼é¨åæåæ¯å¸¸æ</td>
</tr>
<tr>
<td style="text-align: left"><strong>ä¸è´æ§ (Consistency)</strong></td>
<td style="text-align: left">å¼ºä¸è´æ§ <br> çº¦æå¿é¡»æ»¡è¶³</td>
<td style="text-align: left">å¼±ä¸è´æ§ <br> ä¾èµä¸å¡ä»£ç ä¿é</td>
<td style="text-align: left">Redis ä¸ä¼æ ¡éªä¸å¡çº¦æï¼å¦å¤é®ãéç©ºç­ï¼</td>
</tr>
<tr>
<td style="text-align: left"><strong>éç¦»æ§ (Isolation)</strong></td>
<td style="text-align: left">æå¤ç§éç¦»çº§å« (RC/RR/Serializable)</td>
<td style="text-align: left"><strong>ä¸²è¡åæ§è¡</strong> <br> æ§è¡æé´ä¸å¯è¢«ææ­</td>
<td style="text-align: left">å¾çäºåçº¿ç¨æ¨¡åï¼<code>EXEC</code> æé´å¤©ç¶éç¦»</td>
</tr>
<tr>
<td style="text-align: left"><strong>æä¹æ§ (Durability)</strong></td>
<td style="text-align: left">WAL æ¥å¿ä¿é <br> æçµä¸ä¸¢å¤±</td>
<td style="text-align: left">åå³äº AOF/RDB éç½®</td>
<td style="text-align: left">é»è®¤éç½®ä¸éå¸¸ææ°æ®ä¸¢å¤±é£é©</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>ä¸å¥è¯æ»ç»ï¼</strong><br>
<strong>Redis äºå¡æ¯âå½ä»¤éå + ç¬å æ§è¡âï¼ç»ä¸æ¯âå¤±è´¥åæ» + å¼ºä¸è´âã</strong></p>
</blockquote>
<hr>
<h2 id="äºæ®é·ççç¸å®ççä¸ååæ»">äºãæ®é·ççç¸ï¼å®ççä¸ååæ»</h2>
<p>ä¸ºäºæè¿ä¸ªæ¦å¿µå»è¿ DNAï¼æä»¬çä¸¤ç§çå®çéè¯¯åºæ¯ã</p>
<h3 id="1-å¥éæ¶çä½çº§éè¯¯å¨åè¿å">1. å¥éæ¶çâä½çº§éè¯¯âï¼å¨åè¿åï¼</h3>
<p>å¦æä½ å¨<strong>å½ä»¤å¥éé¶æ®µ</strong>å°±ç¯äºè¯­æ³éè¯¯ï¼æ¯å¦åæ°åå°äºï¼ï¼Redis è¿æ¯è®²éççï¼å®ä¼ç´æ¥æç»æ´ä¸ªäºå¡ã</p>
<pre><code class="language-bash">127.0.0.1:6379&gt; MULTI
OK
127.0.0.1:6379&gt; SET key1 value1
QUEUED
127.0.0.1:6379&gt; SET key2      # &lt;--- è¯­æ³éè¯¯ï¼å°äºåæ°
(error) ERR wrong number of arguments for 'set' command
127.0.0.1:6379&gt; EXEC
(error) EXECABORT Transaction discarded because of previous errors.
</code></pre>
<p>è¿æ¶åï¼<strong>ææå½ä»¤é½ä¸ä¼æ§è¡</strong>ãè¿ç¬¦åæä»¬å¯¹âäºå¡âçé¢æã</p>
<h3 id="2-æ§è¡æ¶çè¿è¡æ¶éè¯¯è½æ­»ç¹è¿">2. æ§è¡æ¶çâè¿è¡æ¶éè¯¯âï¼è½æ­»ç¹è¿ï¼</h3>
<p>è¿ææ¯çæ­£çåãåè®¾è¯­æ³æ²¡é®é¢ï¼ä½å¨<strong>æ§è¡æé´</strong>ï¼ææ¡å½ä»¤å ä¸ºæ°æ®ç±»åä¸å¹éæ¥éäºï¼</p>
<pre><code class="language-bash">127.0.0.1:6379&gt; MULTI
OK
127.0.0.1:6379&gt; SET user:A:points 100
QUEUED
127.0.0.1:6379&gt; LPUSH user:A:points "error_data"  # &lt;--- å¯¹ String ç±»åå List æä½ï¼æ³¨å®è¿è¡æ¥é
QUEUED
127.0.0.1:6379&gt; INCR user:A:points                 # &lt;--- åç»­å½ä»¤
QUEUED

127.0.0.1:6379&gt; EXEC
1) OK
2) (error) WRONGTYPE Operation against a key holding the wrong kind of value  &lt;--- æ¥éï¼
3) (integer) 101                                                              &lt;--- ä¾ç¶æåäºï¼
</code></pre>
<p><strong>ç®çªå£åäºåï¼</strong><br>
ç¬¬äºæ¡å½ä»¤æ¥éäºï¼ä½ç¬¬ä¸æ¡å½ä»¤ä¾ç¶æ¬¢å¿«å°æ§è¡äºãæ°æ®åºç°äºä¸­é´æï¼å³æè°çâä¸ä¸è´âã</p>
<p>Redis å®æ¹å¯¹æ­¤çè§£ééå¸¸âç´ç·âï¼</p>
<blockquote>
<p>âåªæè¯­æ³éè¯¯æä¼è¢«æ¦æªï¼è¿è¡æ¶éè¯¯å±äºç¨åºåçé»è¾ Bugï¼æ¯å¦æ String å½ List ç¨ï¼ã<strong>æ°æ®åºä¸åºè¯¥ä¸ºäºç¨åºåç Bug ä¹°åï¼å»æå¤æçåæ»æºå¶ã</strong>â</p>
</blockquote>
<hr>
<h2 id="ä¸è¿é¶ä¹è·¯ä»åçæ¹éå°-lua-èæ¬">ä¸ãè¿é¶ä¹è·¯ï¼ä»åçæ¹éå° Lua èæ¬</h2>
<blockquote>
<p><strong>ð¡ é¢å¤ç¥è¯ï¼RTT æ¯æ§è½ææ</strong></p>
<p>ä¸ä¸ª Redis å½ä»¤çæ§è¡å¯ä»¥ç®åä¸º 4 æ­¥ï¼<strong>åéå½ä»¤ â å½ä»¤æé â å½ä»¤æ§è¡ â è¿åç»æ</strong>ã</p>
<p>å¶ä¸­ï¼ç¬¬ 1 æ­¥åç¬¬ 4 æ­¥çæ¶é´ä¹åç§°ä¸º <strong>RTT (å¾è¿æ¶é´)</strong>ãå¦æææ 100 ä¸ªå½ä»¤ï¼ä¸ä¸ªä¸ªåå°±éè¦ 100 æ¬¡ RTTï¼å¤§é¨åæ¶é´é½æµªè´¹å¨ç½ç»ä¼ è¾ä¸ã<br>
<strong>æ¹éæä½çæ ¸å¿æä¹ï¼å°±æ¯æ 100 æ¬¡ RTT åç¼©æ 1 æ¬¡ã</strong></p>
</blockquote>
<p>æ¢ç¶ <code>MULTI/EXEC</code> è¿ä¹âå¤´éâï¼é£æä»¬å¨å®éå¼åä¸­å°åºè¯¥æä¹éï¼æä»¬å¯ä»¥æ Redis çæ¹éæä½è½ååä¸ºå ä¸ªæ®µä½ã</p>
<h3 id="lv1-åçæ¹éå½ä»¤-mset--mget">Lv1. åçæ¹éå½ä»¤ (MSET / MGET)</h3>
<p>è¿æ¯æç®åãæå¿«çæ¹å¼ã</p>
<ul>
<li><strong>ç¹ç¹</strong>ï¼åççåå­æ§ã<code>MSET key1 val1 key2 val2</code> æ¯ä¸ä¸ªåå­æä½ï¼<strong>è¦ä¹é½æåï¼è¦ä¹é½å¤±è´¥</strong>ï¼å¨ Redis å±é¢ï¼ã</li>
<li><strong>ç¤ºä¾</strong>ï¼<pre><code class="language-bash">MSET key1 "Hello" key2 "World"
</code></pre>
</li>
<li><strong>å±é</strong>ï¼åªè½å¤çåä¸ç§å½ä»¤ï¼é»è¾æ­»æ¿ã</li>
</ul>
<h3 id="lv2-ç®¡é-pipeline">Lv2. ç®¡é (Pipeline)</h3>
<p>å½ä½ éè¦æ¹éæ§è¡å åä¸ªä¸åçå½ä»¤ï¼ä¸ä¸éè¦å®ä»¬ä¹é´æé»è¾ä¾èµæ¶ï¼Pipeline æ¯é¦éã</p>
<ul>
<li><strong>ç¹ç¹</strong>ï¼<strong>å¯å¿«ä¸ç ´</strong>ãå®æå åä¸ªå½ä»¤æåï¼ä¸æ¬¡ç½ç»è¯·æ±ï¼RTTï¼åç»æå¡å¨ï¼æå¡å¨æ§è¡å®åä¸æ¬¡æ§è¿åã</li>
<li><strong>å½¢è±¡çè§£</strong>ï¼<strong>ä¸ 100 ä¸ªå -&gt; ä¸æ¬¡æ§æ¶ 100 ä¸ªå¿«é (1 æ¬¡ RTT)</strong>ã</li>
<li><strong>ä¸äºå¡çåºå«</strong>ï¼
<ul>
<li><strong>éåå­æ§</strong>ï¼Pipeline åªæ¯æååéï¼Redis å¯è½ä¼å¨å¤ç Pipeline ä¸­é´ç©¿ææ§è¡å¶ä»å®¢æ·ç«¯çå½ä»¤ï¼äº¤éæ§è¡ï¼ã</li>
<li><strong>æçæ´é«</strong>ï¼ä¸éè¦åäºå¡é£æ ·æ¯ä¸ªå½ä»¤é½åä¸æ¬¡ï¼åªéè¦åéä¸æ¬¡ã</li>
</ul>
</li>
</ul>
<h3 id="lv3-äºå¡-multi--exec">Lv3. äºå¡ (MULTI / EXEC)</h3>
<p>æ¯ Pipeline å¤äºä¸å±ä¿éï¼<strong>ç¬å æ§è¡</strong>ã</p>
<ul>
<li><strong>ç¹ç¹</strong>ï¼<strong>åå­æä½ï¼éç¦»æ§ï¼</strong>ã
<ul>
<li><strong>ä¸¤ä¸ªä¸åçäºå¡ä¸ä¼åæ¶è¿è¡</strong>ãå¨ <code>EXEC</code> æ§è¡æé´ï¼Redis ä¼âä»¥æ­¤ä¸ºå°âï¼ä¿è¯æ²¡æå¶ä»å®¢æ·ç«¯è½æéã</li>
</ul>
</li>
<li><strong>ç¼ºç¹</strong>ï¼
<ul>
<li><strong>RTT å¼éå¤§</strong>ï¼äºå¡ä¸­ <strong>æ¯ä¸ªå½ä»¤é½éè¦åç¬åé</strong> å°æå¡ç«¯å¥éï¼è¯·æ±æ¬¡æ°å¹¶æ²¡æåå°ã</li>
<li><strong>ä¸æ¯æåæ»</strong>ï¼ä¸æ¯æå¨äºå¡ä¸­é´åé»è¾å¤æ­ã</li>
</ul>
</li>
</ul>
<h3 id="lv31-äºå¡--watch-ä¹è§é">Lv3.1 äºå¡ + WATCH (ä¹è§é)</h3>
<p>åçº¯ç <code>MULTI/EXEC</code> å¾å¾æ¯è¾é¸¡èï¼å ä¸ºå®æ æ³æç¥ä¸­é´ç¶æã<strong>ä½è¿å¥æºå¶å¯ä¸çâççâç»åæ¯éå <code>WATCH</code> å½ä»¤ï¼å®ç°ä¹è§é (CAS)ã</strong></p>
<ul>
<li>
<p><strong>åºæ¯</strong>ï¼ç§ææ£ååºå­ã</p>
<ul>
<li>å¨ <code>MULTI</code> ä¹å <code>WATCH stock</code>ã</li>
<li>å¦æå¨ <code>EXEC</code> æ§è¡å <code>stock</code> è¢«å«äººæ¹äºï¼æ´ä¸ªäºå¡åå°åæ¶ï¼è¿å nilï¼ã</li>
</ul>
</li>
<li>
<p><strong>ä»£ç ç¤ºä¾</strong>ï¼</p>
<pre><code class="language-bash">WATCH stock:001                # 1. çè§åºå­
GET stock:001                  # 2. è¯»åºå­ï¼åç°æ¯ 10
MULTI                          # 3. å¼å¯äºå¡ (å¼å§æé)
DECR stock:001                 # 4. ååºå­
EXEC                           # 5. æ§è¡
# å¦æå¨æ­¥éª¤ 1-5 ä¹é´ï¼å«äººæ¹äº stock:001ï¼è¿éä¼è¿å (nil)ï¼äºå¡åæ»ã
</code></pre>
</li>
<li>
<p><strong>è´å½å¼±ç¹</strong>ï¼<strong>é«å¹¶åä¸æ§è½æå·®</strong>ã</p>
<ul>
<li>å°±åä¸ç¾¤äººæ¢ä¸ä¸ªéº¦åé£ï¼ä¸ä¸ªäººæ¢å°äºï¼å¶ä»äººç <code>CAS</code> å¨é¨å¤±è´¥ï¼åªè½å®¢æ·ç«¯éè¯ï¼èªæï¼ã</li>
<li><strong>ç«äºè¶æ¿çï¼éè¯è¶é¢ç¹ï¼CPU ç©ºè½¬è¶ä¸¥éã</strong></li>
</ul>
</li>
</ul>
<h3 id="lv4-æç»åµå¨--lua-èæ¬">Lv4. æç»åµå¨ ââ Lua èæ¬</h3>
<p>ä» Redis 2.6 å¼å§ï¼Lua èæ¬æä¸ºäºè§£å³å¤æåå­æ§é®é¢çæ ¸å¿æ¹æ¡ï¼å®å®ç¾æ¿ä»£äº <code>WATCH</code> äºå¡ã</p>
<p><strong>ä¸ºä»ä¹å®æ¯äºå¡å¼ºï¼</strong></p>
<ol>
<li><strong>é»è¾åå­æ§</strong>ï¼ä¸æ®µ Lua èæ¬è¢«è§ä½ä¸æ¡å½ä»¤ãRedis ä¿è¯èæ¬æ§è¡æé´ï¼<strong>ä¸ä¼æä»»ä½å¶ä»èæ¬æå½ä»¤æå¥</strong>ã</li>
<li><strong>æçæ´é«</strong>ï¼ä¸éè¦å <code>WATCH</code> é£æ ·åå¤éè¯ãèæ¬å¨æå¡å¨ç«¯æ§è¡ï¼åªæä¸æ¬¡ RTTã</li>
</ol>
<p><strong>ç¤ºä¾ï¼å®å¨çâåæ¥åæ¹â</strong></p>
<pre><code class="language-lua">-- å¤æ­ key æ¯å¦ç­äºé¢æå¼ï¼å¦ææ¯åå é¤
if redis.call("GET", KEYS[1]) == ARGV[1] then
    return redis.call("DEL", KEYS[1])
else
    return 0
end
</code></pre>
<p><strong>â ï¸ å¿é¡»è­¦æçç¼ºé·ï¼Lua ä¹ä¸åæ»ï¼</strong><br>
è½ç¶ Lua èæ¬è¢«ç§°ä¸ºâåå­æä½âï¼ä½è¯·æ³¨æï¼å®çåå­æ§ä¾ç¶æçæ¯<strong>ä¸è¢«ææ°</strong>ï¼èä¸æ¯<strong>å¤±è´¥åæ»</strong>ã</p>
<blockquote>
<p><strong>å¦æ Lua èæ¬è¿è¡å°ä¸­éåºéï¼æ¯å¦è°ç¨äºä¸å­å¨çå½ä»¤ï¼ææ¾å¼æ¥ééåºï¼ï¼èæ¬ä¼åæ­¢æ§è¡ï¼ä½ä¹åå·²ç»æ§è¡è¿çåæä½ï¼æ¯ä¸ä¼è¢«æ¤éçï¼</strong></p>
</blockquote>
<p>è¿æå³çï¼å³ä½¿æ¯ Luaï¼ä¹ä¸è½ç»ä½ å¸¦æ¥ RDBMS é£ç§âåæ»ä¸åâçå®å¨æãä½ ä¾ç¶éè¦å¨ä»£ç å±é¢ä¿è¯é»è¾çä¸¥å¯æ§ã</p>
<hr>
<h2 id="åæ»ç»éåå³ç­è¡¨">åãæ»ç»ï¼éåå³ç­è¡¨</h2>
<p>ä¸ºäºè®©ä½ å¨å®éä¸å¡ä¸­ä¸åçº ç»ï¼ææ´çäºä¸ä»½ç®åçå³ç­è¡¨ï¼</p>
<table>
<thead>
<tr>
<th style="text-align: left">éæ±åºæ¯</th>
<th style="text-align: left">æ¨èæ¹æ¡</th>
<th style="text-align: left">æ ¸å¿çç±</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>ç®åæ¹éè¯»å (KV)</strong></td>
<td style="text-align: left"><strong>MSET / MGET</strong></td>
<td style="text-align: left">åçå½ä»¤ï¼æå¿«ï¼æçå¿ã</td>
</tr>
<tr>
<td style="text-align: left"><strong>å¤§éç¦»æ£å½ä»¤ (æ å³è)</strong></td>
<td style="text-align: left"><strong>Pipeline</strong></td>
<td style="text-align: left">ç½ç»å¼éæä½ï¼ååéæé«ã</td>
</tr>
<tr>
<td style="text-align: left"><strong>éè¦ CAS (ä½å¹¶å)</strong></td>
<td style="text-align: left"><strong>WATCH + MULTI</strong></td>
<td style="text-align: left"><strong>äºå¡å¯ä¸çç¨æ­¦ä¹å°ã</strong> éåä½é¢ç«äºï¼å®ç°ç®åã</td>
</tr>
<tr>
<td style="text-align: left"><strong>å¤æé»è¾ / é«å¹¶å</strong></td>
<td style="text-align: left"><strong>Lua èæ¬</strong></td>
<td style="text-align: left"><strong>è¡ä¸æ åã</strong> é¿åäº CAS èªæçæ§è½å¼éï¼åå­æ§å¼ºã</td>
</tr>
<tr>
<td style="text-align: left"><strong>å³ä½¿æ¥éä¹è¦åæ»</strong></td>
<td style="text-align: left"><strong>MySQL / RDBMS</strong></td>
<td style="text-align: left"><strong>å«ä¸ºé¾ Redisã</strong> å®æ²¡æ Undo Logï¼åä¸å°çæ­£çåæ»ã</td>
</tr>
</tbody>
</table>
<h2 id="åå¨æå">åå¨æå</h2>
<p>åå¤´çï¼<strong>Redis äºå¡è¿å¥æºå¶ï¼å°±åæ¯ä¸ä¸ªâå¦æä¸ä»ç»è¯»è¯´æä¹¦ä¸å®ä¼ç¨éâçåæåã</strong></p>
<p>ä½æ­£æ¯è¿ä¸ªâåæåâï¼æå°åºäº Redis æåºå±çä»·å¼è§ï¼<strong>ä¸ºäºæ§è½ï¼å¯ä»¥çºç²ä¸åâçèµ·æ¥å¾ç¾âçæ½è±¡</strong>ãå®æç»äºæ²éç Undo Logï¼æç»äºå¤æçéç¦»çº§å«ï¼åªçä¸äºä¸ä¸ªæç®åçâæéæ§è¡âé»è¾ã</p>
<p>æä»¥ï¼å½æä»¬ä¸æ¬¡ååä¸ <code>MULTI</code> çæ¶åï¼å¿éè¦æ¸æ¥ï¼</p>
<ul>
<li>å¦æåªæ¯ä¸ºäºå¿«ï¼<strong>Pipeline</strong> ææ¯é£ä¸ªä¸è®²æ­¦å¾·çâå éå¨âã</li>
<li>å¦æåªæ¯ä¸ºäºé²æéï¼<strong>Transaction</strong> å¤ç¨äºï¼ä½å¨é«å¹¶åä¸ï¼å®èå¼±å¾åä¸ªæç¢åã</li>
<li>å¦æè¦å¤ççæ­£çå¤æé»è¾ï¼è¯·æ¯«ä¸ç¹è±«å°æ¥æ± <strong>Lua</strong> ââ è½ç¶å®ä¹ä¸ä¼åæ»ï¼ä½è³å°å¨âæ§è¡åå­æ§âä¸ï¼å®æ¯æä»¬æéæç¨³çé£å¼ çã</li>
</ul>
<p>çæ­£çææ¯æçï¼ä¸æ¯èè¯µå«è¡æéç ACID å®ä¹ï¼èæ¯æå¾å¨<strong>ç±äºç©çéå¶èæ»¡æ¯éæ¾ççå®ä¸çé</strong>ï¼ååºé£ä¸ªæä¸åçéæ©ã</p>
<hr>
<blockquote>
<p>æç« çæåï¼æ³åä½ å¤èä¸¤å¥ã</p>
<p>ææ¯ä¹è·¯ï¼å¸¸å¸¸æ¯ç­é¹ä¸å­¤ç¬å¹¶å­ãé£äºæ·±å¤çè°è¯ãçµåä¸éªçæ¹æ¡ãè¿æè¸©åç¬èµ·åçé¡¿æï¼å¦æè½æäººä¸èµ·èèï¼è¯¥å¤å¥½ã</p>
<p>ä¸ºæ­¤ï¼æå»ºäºä¸ä¸ªå°è±å­ââæçå¾®ä¿¡å¬ä¼å·ã<strong>[åªåçå°é]</strong>ãã</p>
<p>è¿éæ²¡æé«æ·±è«æµççè®ºå ç ï¼åªææå¯¹åç«¯å¼åãç³»ç»è®¾è®¡åå·¥ç¨å®è·µçæç»­æèä¸æ²æ·ãå®æ´åæç<strong>æ°å­ç¬è®°æ¬</strong>ï¼è®°å½çé£äºå¼å¾è¢«è®°ä½çè§£å³æ¹æ¡åæç»´ç«è±ã</p>
<p>å¦æä½ è§å¾ä»å¤©çæç« è¿æä¸ç¹å¯åï¼æèåçº¯æ³æ¾ä¸ä¸ªåè¡èå¶å°èèææ¯ãè°è°æèï¼é£ä¹ï¼æ¬¢è¿ä½ æ¥ååã<br>
<img alt="85f114bceb12e933bb817ec5fecdfef7" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3703499/202601/3703499-20260105210259813-964799315.jpg" class="lazyload"></p>
<p>æ¿ä½ åè¡è·¯ä¸ï¼æ»æä»£ç å¯åï¼ææ¢¦å¯è¿½ï¼ä¹æç¯ç«å¯äº²ã</p>
</blockquote>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-05 09:50">2026-02-05 09:49</span>&nbsp;
<a href="https://www.cnblogs.com/xzqcsj">ä¸æäºº</a>&nbsp;
éè¯»(<span id="post_view_count">275</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19577555);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19577555', targetLink: 'https://www.cnblogs.com/xzqcsj/p/19577555', title: 'Redis äºå¡çâåå­æ§âè¿·æï¼ä¸ºä»ä¹æä»¬æç»éæ©äº Lua èæ¬' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ 32å²ç¨åºåçæ­»ï¼è®©ææ³èµ·äºææ¾ç»çå ç­ç»åï¼åºå¹¸èªå·±è¿æ´»ç ]]></title>
    <link>https://www.cnblogs.com/StephenYoung/p/19539895</link>
    <guid>b8817eabc4fef9e18ae7cea2adac05f6</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/StephenYoung/p/19539895" title="åå¸äº 2026-02-05 20:41">
    <span role="heading" aria-level="2">32å²ç¨åºåçæ­»ï¼è®©ææ³èµ·äºææ¾ç»çå ç­ç»åï¼åºå¹¸èªå·±è¿æ´»ç</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æè¿ï¼çå°32å²ç¨åºåçæ­»çæ°é»å·çå¨ç½ã</p>
<p>æç¬é´æ³èµ·äºèªå·±æ¾ç»çå ç­ç»åï¼å¿åºåªå©ä¸å¥åºå¹¸ââè¿å¥½ï¼æè¿æ´»çã</p>
<p>æ¾ç»ï¼æè´è´£å¨çèåAå®¢æ·çé¡¹ç®è®¾å¤è½¯ä»¶å¼åï¼é£æ®µæ¶é´å¸¸å¹´è¾è½¬äºå½ååå¤§ä»£å·¥åï¼èæ­¥ä»æªåæ­ãæé¾å¿çä¸æ¬¡ï¼æ¯è¿ç»­å ç­æ´æ´90å¤©ï¼è¿ä¸ä¸ªæéï¼æå ä¹è¿è½´è½¬ãæ ä¸å¤©ä¼æ¯ï¼å¶ä¸­è¿æå¥½å å¤©ç¬äºéå®µãå ä¸ºå·¥åæ¯24å°æ¶çï¼è®¾å¤æ¯24å°æ¶çãæ°äº§åè¯äº§ï¼ä»»ä½ä¸ä¸ªç¯èçä»»ä½ä¸ä¸ªå°é®é¢ï¼é½æ¯å¤§é®é¢ãå¿é¡»éè§ï¼å¿é¡»è§£å³ãå¯¹äºè´¨éçææ§ï¼è¿ä¹åæï¼å¦åï¼è¿å®¶Aå®¢æ·çäº§åä¹ä¸å¯è½ç¬æ­¥å¨çäºã</p>
<p>å°è±¡ææ·±çä¸æ¬¡ï¼å¤´å¤©æ©ä¸7ç¹åæ¶èµ·åºï¼ååæ´æ¼±åå°±é»è¿å·¥åè½¦é´æå¥å·¥ä½ï¼ç´å°ç¬¬äºå¤©ä¸åå«ä¹ç¹ï¼ææççäºéä¼¼çèº«ä½èµ°åºååºãæ¬ä»¥ä¸ºè½ç­ææ­å£æ°ãç¯ä¸ä¸ä¼å¿ï¼å¯å½å¤©ä¸å3ç¹ï¼ä¸ä¸ªç´§æ¥çµè¯çªç¶ææ¥ï¼æåä¸å¾ä¸æèµ·ç²¾ç¥ï¼é£é£ç«ç«å°åæ¬¡å²è¿è½¦é´ï¼æå¥å°è®¾å¤è°è¯ä¸­ã</p>
<p>è½¦é´éè°è¯ä»£ç ï¼å¿é¡»ç«çæä½çµèï¼æå¹³åä¸å¤©ç«ç«è¶è¿10å°æ¶ï¼ä¸ç­ååèè¿å¾è¿éå­é½é¾è±ä¸ãä¸æ®µæ¶é´åï¼çç®ä¹ç¯äºï¼å½¼æ¶åºå·®å¨éçåå¸ï¼æåªè½ç¬èªæ½2ä¸ªå°æ¶å»éè¿å»é¢æ¿è¯ï¼å³ä¾¿é¡¶çç¼çï¼ç¬¬äºå¤©ä¾æ§è¦ç«çè°è¯ä»£ç ãå½æ¶æåªæä¸ä¸ªå¿µå¤´ï¼å¿å®è¿éµï¼ä¸å®è¦æ¢ä¸ªç¯å¢ï¼å«ççæ²¡å½æ£é±ãæ²¡å½è±ã</p>
<p>åææåæ ·æåçï¼è¿ææä»¬å¨åä¸ä¸ªé¡¹ç®ç»çåä½ååçä¸ä¸ªHå¥ä»¬å¿ï¼Hå¥åæåé¾ï¼åªæ¯äººå®¶æ­£ç»985æ¯ä¸çï¼èæä¸æ¯ãHå¥ä¹æ¾å¤æ¬¡è·ææ±æ¨ï¼âçä¸æ³åAå®¢æ·çé¡¹ç®äºï¼å¤ªç´¯äºï¼åä¸æ¶ãæ¯å¤©è¿é¥­é½ä¸è½ææ¶åä¸ï¼æè¿é½é¥¿å¾èç¼ãè·å®¢æ·å¼ä¼æ¯è±æï¼æå¿é¡»åé¥±äºæè½å¬æèå¤è¯´è¯âãç¡®å®ï¼å¯å¸¸å¸¸å°ä¸åä¸å«ç¹å ä¸ºå®¢æ·è¿å¨è·æä»¬å¼ä¼ï¼æècheckæä»¬çé¡¹ç®è¿åº¦ï¼å®æå·¥ä½ä»»å¡ãç»å¸¸é½æ¯æ²¡åæé¥­ï¼é£ä¼å¿èå­åæµï¼å«è¯´å¬è±è¯­äºï¼æè¿æ±è¯­é½å¬ä¸æäºãæåç­Hå¥è¯´ï¼ååï¼ä½ è¿æ¯çµæ± æ²¡çµäºåï¼å½ç¶å¬ä¸æäºãææçµä¹å¬ä¸å¤ªæå¤å°ãç¡®å®ï¼ç°å¨æä¹æ¯ä¹é¥¿å¾ä¸è¡ï¼è¿ç»éé¿ä¹ä¹è®¡åã</p>
<p>æç¶ï¼é¡¹ç®çä¸ä¸ä¸ªé¶æ®µå¼å§æ¶ï¼ææ²¡åè§å°ä»çèº«å½±ï¼å¾®ä¿¡è¯¢é®åæå¾ç¥ï¼ä»ç³è¯·è°å°äºå¶ä»é¡¹ç®ï¼ä¸ç¨åé¥¿èå­å ç­äºï¼ååãå¶å°çå ç­ä¹è½æ¥åï¼è¯­æ°éæ»¡æ¯ä¹è¿çææ°ä¸å¹³åã</p>
<p>åå¹´åï¼æä¹æä½ä¸æ¬¡å¶ç¶çæºä¼ç¦»èï¼ç¦»å¼äºåä¸å®¶ï¼å½»åºåå«äºAå®¢æ·çé¡¹ç®ï¼ä¸ç¨åå¿åé¥¿èå­ãè¿è½´è½¬çå ç­æ¥å­ã</p>
<p>å¦ä»åæ³é£æ®µæ¥å­ï¼ä¾æ§å¿æä½æ¸ã</p>
<p>æå¹ï¼é£äºæ²¡æ¥æ²¡å¤çå ç­ãèº«ä½æ¿åççè¦ï¼é½æäºé¾å¿çè¿å¾ãå·¥ä½æ¯çæ´»çä¸é¨åï¼æ£é±æ¯ä¸ºäºæ»å»çæ´»ï¼èéæ¶èçæ´»ãå ç­æè®¸æ æ³å®å¨é¿åï¼æ£é±ä¹ä¾ç¶æ¯æä»¬åè¡çå¨åï¼ä½æä»¬ä¸è½è¢«è¿ä»½æ§å¿µè£¹æï¼å¿½ç¥äºçæ´»è´¨éï¼éæ¯äºèº«ä½å¥åº·ã</p>
<p>çæ­£çæçï¼ä»æ¥ä¸æ¯ä¸å³æ¼å½å ç­ãç²ç®æ£é±ï¼èæ¯æå¾å¹³è¡¡å ç­ä¸çæ´»ï¼å¼é¡¾æ£é±ä¸å¥åº·ãå·¥ä½åéè¦ï¼ä¹ä¸è½æ¿ä»£ä¸é¤åå­£çå®ç¨³ï¼èªèµåè¯±äººï¼ä¹ä¸åèº«ä½å¥åº·ççè´µãæ¿æ¯ä¸ä¸ªä¸ºçæ´»å¥æ³¢ãä¸ºæ£é±åªåçäººï¼é½è½å®ä½å¹³è¡¡ï¼ä¸è¾è´å·¥ä½ï¼ä¹ä¸è¾è´èªå·±ï¼ä¸éæ¯å¥åº·ï¼ä¹ä¸æµªè´¹æ¶åââæ¯ç«ï¼è½å¥½å¥½å·¥ä½ãå¥½å¥½çæ´»ãå¥½å¥½æ´»çï¼ææ¯æé¾å¾çå¹¸ç¦ã</p>
<p>ä»å¹´ï¼2026å¹´ï¼æä¾ç¶åºå¹¸èªå·±è¿æ´»çã<br>
<img src="https://img2024.cnblogs.com/blog/2213992/202602/2213992-20260205204048587-607747837.png" alt="å¬ä¼å·å¨æ¼«+å¾®ä¿¡å®æ¹ç " loading="lazy"></p>
<p>æ´å¤ç²¾å½©å³æ³¨å¾®ä¿¡å¬ä¼å·ï¼</p>
<p>è½»æ¾ååºæ¼äº®çLabVIEWçé¢-FlateUI2.0(æºç åäº«)</p>
<p>15å¹´ææ¯äºº+3å¹´åä¸å¤±è´¥èçææï¼å·¥æ§åéï¼ææ¯çè¯è¯­æä¸ºå¥è¿ä¹å¼±ï¼</p>
<p>LabVIEWè®°å½XYè½´è¿å¨è½¨è¿¹å¹¶ç»å¾çç¼ç¨æ¹æ³(æºç éä»¶)</p>
<p>C#éé¾ç¹2ï¼äºä»¶</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-05 20:42">2026-02-05 20:41</span>&nbsp;
<a href="https://www.cnblogs.com/StephenYoung">Stephen_Young</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19539895);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19539895', targetLink: 'https://www.cnblogs.com/StephenYoung/p/19539895', title: '32å²ç¨åºåçæ­»ï¼è®©ææ³èµ·äºææ¾ç»çå ç­ç»åï¼åºå¹¸èªå·±è¿æ´»ç' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>