<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-21T01:20:02.552Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ ä¸¤å¤©ç§æ200ç¾åï¼æAIå¤§æ¨¡åç½å³ç»äºæ¯æäºClaudeæ¨¡å ]]></title>
    <link>https://www.cnblogs.com/sdcb/p/19508169/20260120-chats-190</link>
    <guid>707eb8e520c6aa5ddcb1d2f7ae796218</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sdcb/p/19508169/20260120-chats-190" title="åå¸äº 2026-01-21 08:45">
    <span role="heading" aria-level="2">ä¸¤å¤©ç§æ200ç¾åï¼æAIå¤§æ¨¡åç½å³ç»äºæ¯æäºClaudeæ¨¡å</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>è¿æ¯ä¸ä¸ªå³äºâçéç½é¶âçå¼åæäºã</p>
<p>Chats 1.9.0 åå¸äº 2025 å¹´ 11 æ 27 æ¥ï¼è·ç¦»ä¸ä¸ä¸ªçæ¬åå¸ä»è¿å»äºä¸å°ä¸ä¸ªæãä½å¯¹ Chats æ¥è¯´ï¼è¿å´æ¯ä¸ä¸ªéç¨ç¢å¼ççæ¬ï¼<strong>æä»¬ä¸ä»å¨é¢æ¯æäº Anthropicï¼Claudeï¼æ¨¡åï¼è¿é¡ºå¸¦æ .NET 10 ç»åäºï¼çè³è¿æåºäºä¸å¥è½å¨ Chats éâåå£³âè· Claude Code ç API å¼å®¹å±ã</strong></p>
<p>èå¨è¿ä¸åçèåï¼æ¯ä¸å¼ è®©æâèçâç Azure è´¦åã</p>
<hr>
<h2 id="ä¸åæºäºå¾®è½¯ä¸-anthropic-èæ">ä¸åæºäºâå¾®è½¯ä¸ Anthropic èæâ</h2>
<p>äºæè¦ä» 2025 å¹´ 11 æ 19 æ¥è¯´èµ·ãé£å¤©ï¼å¾®è½¯ä¸ Anthropic è¾¾æåä½ï¼å®£å¸å°å¨ Azure å¹³å°ä¸æä¾ Anthropic ç Claude å¤§æ¨¡åæå¡ãè¿æå³çå¼åèåä¼ä¸ç¨æ·å¯ä»¥éè¿ Azure äºæå¡è®¿é® Claude æ¨¡åã</p>
<p>ä½ä¸ºä¸åå¾®è½¯ MVPï¼ææ¬ä»¥ä¸º Claude æ¨¡åå¯¹ MVP é¢åº¦æ¥è¯´æ¯å¯ä»¥ä½¿ç¨çï¼å ä¸ºæ ¹æ®ä»¥å¾çç»éªï¼å¦ææ²¡æèµæ ¼ä½¿ç¨æé¡¹æå¡ï¼éå¸¸ä¼ç´æ¥å¨æ§å¶å°éæç¤ºâæ æéâæâæ æ³å¯ç¨âï¼èä¸æ¯ç´æ¥åè®¸ä½¿ç¨ç¶åäº§çé«é¢è´¹ç¨ï¼ä½æå¤§æäºã</p>
<p>å æ­¤æç¬¬ä¸æ¶é´å°±æ³å°äºå° Claude æ¨¡åéæå°æèªå·±çé¡¹ç®ä¸­ââ<strong>Sdcb Chats</strong>ã</p>
<p>å½æ¶ä¸ºäºç¡®ä¿ Anthropic Messages API å·¥ä½æ­£å¸¸ä¸ç¨³å®ï¼æåäºå¤§éçæµè¯ãä¸ºäºéªè¯å¼å®¹æ§ï¼æçè³è¿âç«èµ·æ¥è¹¬âï¼ç´æ¥æ¥å¥äº Anthropic å®æ¹çå½ä»¤è¡å·¥å· <code>Claude Code</code> æ¥è· Opus æ¨¡åã</p>
<p>ç»æâ¦â¦ç­ç­ 2 å¤©æ¶é´ï¼æå¨ Azure ä¸è· Claude æ¨¡åç API è°ç¨è´¹ç¨å°±é«è¾¾ <strong>192.95 ç¾å</strong>ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120172700464-1622754976.png" alt="" loading="lazy"></p>
<p>å½æ¶çå°è´¦åæ´ä¸ªäººé½æ¯èçãä¸è¿å¥½å¨âæ°ªéâæ²¡æç½è´¹ï¼æç»ææåå° Claude æ¨¡åå®ç¾éæå°äº Sdcb Chats ä¸­ãç°å¨ï¼å¤§å®¶å¯ä»¥å¨ Chats ä¸­æå¿«å°ä½¿ç¨ Claude æ¨¡åäºï¼</p>
<hr>
<h2 id="190-çæ ¸å¿anthropic-å¨é¢è½å°">1.9.0 çæ ¸å¿ï¼Anthropic å¨é¢è½å°</h2>
<p>å¨ 1.9.0 ä¹åï¼Chats å¯¹ Claude çæ¯æåªè½è¯´æ¯âè½ç¨âï¼å ä¸ºå¹¶æ²¡æåçæ¯æ Anthropic Messages APIï¼éè¦éè¿ OpenAI å¼å®¹æ¥å£è½¬è¯ââè OpenAI Chat Completions å¼å®¹æ¥å£å¹¶ä¸æ¯æ Extended Thinkingãä½è¿ä¸æ¬¡ï¼ææ¯<strong>åçæ¯æ</strong>ã</p>
<h3 id="åç-httpclient-å®ç°ä¸-thinking-æ¯æ">åç HttpClient å®ç°ä¸ Thinking æ¯æ</h3>
<p>ä¸ºäºè¿½æ±æè´çæ§è½åå¯æ§æ§ï¼æéåäº Chats çåºå±è°ç¨é»è¾ã</p>
<p>åæ¬ Anthropic æä¾äº<a href="https://github.com/anthropics/anthropic-sdk-csharp" target="_blank" rel="noopener nofollow">Anthropic C# API Library</a>ï¼æä¸å¼å§ä½¿ç¨äºè¿ä¸ª SDKï¼ä½åç°éé¢çéªè¯é»è¾æç¹å¤ªè¿åäºï¼è¿æ¨¡ååç§°é½è¦éªè¯ï¼æ¥éè¯´ï¼<code>AnthropicInvalidDataException: Data did not match any variant of RawMessageStreamEvent</code>ï¼ãå¨æå¼åçæ¶åï¼Opus æ¨¡åè¿æ²¡åå¸ 4.5 çæ¬ï¼æä½¿ç¨è¿ä¸ª SDK è¿èªå®¶ç Claude 4.5 Opus é½æ¥éï¼ç¬æ­»ï¼æ´ä¸è¦æç¨è¿ä¸ª SDK è¿æ¥å½äº§ç MiniMax/GLM/DeepSeek v3.2 äºï¼è¿ç§æä½éå¸¸âAnthropicâï¼è¿ä¸ªé®é¢ç´å° <strong>2026-01-14</strong> åå¸ç <code>12.2.0</code> çæ¬ä¸­æè§£å³ï¼ï¼ã</p>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120214334386-1499186789.png" alt="image" loading="lazy"></p>
<p>å æ­¤æç <code>Git</code> æäº¤è®°å½éå¯ä»¥çå°ï¼æä¸å¼å§æ¯åå¤èµ° SDK å Anthropic æ¯æçï¼ä½æç»åæ¾å¼äºï¼è½¬èå¨ä»£ç ä¸­ç¨åç <code>HttpClient</code> ææ¸äºä¸ä¸ªè¿ 1000 è¡ç <code>AnthropicChatService</code>ã</p>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120172700992-1302091122.png" alt="" loading="lazy"></p>
<p>è¿æå³çä»ä¹ï¼</p>
<ol>
<li>
<p><strong>å®æ´æ¯æ Thinkingï¼æç»´é¾ï¼</strong>ï¼Claude æ¨¡åç Thinking å¯ä»¥åå¨å®æ¹ç½é¡µçé£æ ·å±ç¤ºï¼æ¯ææµå¼è¾åºï¼âæèâä¸âåç­âåç¦»ãä¸ºæ­¤æå¨æ°æ®åºä¸­ä¸é¨æ°å¢äº <code>StepContentThink</code> è¡¨ï¼ç¨äºç¬ç«å­å¨æç»´åå®¹ã</p>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120172701332-89257932.png" alt="" loading="lazy"></p>
</li>
<li>
<p><strong>Signatureï¼ç­¾åï¼éªè¯</strong>ï¼Chats ç°å¨è½æ­£ç¡®å¤çåå­å¨ Claude çæç»´ç­¾åï¼Signatureï¼ï¼ç¡®ä¿è¯æ®é¾å®æ´ã</p>
</li>
<li>
<p><strong>Vision Link ä¼å</strong>ï¼é»è®¤ä½¿ç¨ URL èé Base64 ä¼ å¾ï¼å¤§å¹èçå¸¦å®½å Tokenã</p>
</li>
</ol>
<p>åæ¶ï¼æè¿å¼å¥äº <code>MaxThinkingBudget</code>ï¼æ¨¡åçº§ï¼å <code>ThinkingBudget</code>ï¼ä¼è¯çº§ï¼éç½®ï¼é²æ­¢ä½ ç Token ååæä¸æ ·âä¸ç¥ä¸è§âå°ç§å®ã</p>
<hr>
<h2 id="åå£³ä¸ä½anthropic-messages-api-å¼å®¹">âåå£³ä¸ä½âï¼Anthropic Messages API å¼å®¹</h2>
<p>è¿ä¸æ¡å¯è½æ¯åçæ¯ææ´ç¡¬æ ¸ã</p>
<p>Chats 1.9.0 <strong>ååå®ç°</strong>äº Anthropic çå®æ¹ API åè®®ï¼<code>/v1/messages</code>ï¼ãæå¨ <code>src/BE/web/Controllers/Api/AnthropicCompatible/AnthropicMessagesController.cs</code> ä¸­å®æ´å¤å»äº Anthropic çæ¥å£è§èãè¿æå³ç Chats ä¸ä»æ¯ä¸ä¸ªå®¢æ·ç«¯ï¼å®æ¬èº«ä¹åæäºä¸ä¸ª<strong>æ åç Anthropic API æå¡ç«¯</strong>ã</p>
<p><strong>ä¸ºä»ä¹è¦è¿ä¹åï¼</strong></p>
<p>å ä¸ºç°å¨æå¾å¤ä¼ç§çå·¥å·ï¼æ¯å¦ CursorãClaude Codeãåç§ AI æä»¶ï¼åªæ¯æ Anthropic åçåè®®ãä¸ºäºæ¯æå®æ¹ç <code>claude-code</code> å½ä»¤è¡å·¥å·ï¼å¦å¨å¾ï¼åå°å¯ä»¥å®æ¶è¿½è¸ª Claude Code çä½¿ç¨ä¿¡æ¯ï¼ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120172701746-1289382319.avif" alt="" loading="lazy"></p>
<p>æçè³ä¸é¨ä¿®å¤äº System Prompt çè§£æé»è¾ï¼åæ¶ï¼æè¿å¼å¥äº <code>MaxThinkingBudget</code>ï¼æ¨¡åçº§ï¼å <code>ThinkingBudget</code>ï¼ä¼è¯çº§ï¼éç½®ï¼ä»¥å <strong>Prompt Cache Token</strong> çè®¡è´¹æ¯æï¼Commit <code>85a1c2a6</code>ï¼ï¼é²æ­¢ä½ ç Token ååæä¸æ ·âä¸ç¥ä¸è§âå°ç§å®ã</p>
<p>æ¢ç¶ Chats å·²ç»åæäºä¸ä¸ªå¼ºå¤§ç API ç½å³ï¼é£ä¹éå¥çå¼åèä½éªå¿é¡»è·ä¸ã</p>
<p>1.9.0 æ°å¢äº <strong>Build</strong> æ¨¡åï¼åå«ä¸ä¸ªæ ¸å¿é¡µé¢ï¼</p>
<ul>
<li><strong>API Keys</strong>ï¼æ´å®å¨çå¯é¥ç®¡çï¼æ¯æè¿ææ¶é´ãå¤æ³¨ï¼è¿è½çå°å¯é¥æ©ç ã</li>
<li><strong>Docs</strong>ï¼ä¸ç«å¼ææ¡£ï¼ååºäºææå¼å®¹ OpenAI å Anthropic ç API ç«¯ç¹ï¼æ¯æä¸é®å¤å¶ï¼ã</li>
<li><strong>Usage</strong>ï¼æ API Key ç»´åº¦çç¨éç»è®¡ï¼è°ç¨äºå¤å° Tokenï¼ä¸ç®äºç¶ã</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120172702273-280531674.png" alt="" loading="lazy"></p>
<hr>
<h2 id="è§è§çäº§åopenai-å¾å-api-ä¸-net-10">è§è§çäº§åï¼OpenAI å¾å API ä¸ .NET 10</h2>
<p>é¤äºå¤§è¯­è¨æ¨¡åï¼1.9.0 è¿è¡¥é½äºè§è§è½åï¼</p>
<ul>
<li>å®ç°äºæ åç OpenAI å¾åçæï¼<code>/v1/images/generations</code>ï¼åç¼è¾ï¼<code>/v1/images/edits</code>ï¼APIã</li>
<li>éååç«¯ç <strong>ChatInput å¨ç»ä¼å</strong>ï¼ç°å¨çå¾ççæä½éªæ´å æµçã</li>
</ul>
<p><img src="https://img2024.cnblogs.com/blog/233608/202601/233608-20260120172702911-1941831639.png" alt="" loading="lazy"></p>
<p>æåï¼ä½ä¸ºä¸ä¸ª .NET ä¿¡ä»°ç²ï¼Chats 1.9.0 å·²ç»<strong>å¨çº¿åçº§å°äº .NET 10</strong>ãè½ç¶ç¨æ·æç¥ä¸å¼ºï¼ä½è¿å¸¦æ¥äºæ´å¥½çæ§è½åæ´ç°ä»£çåºå±è®¾æ½ï¼ä¸ºæªæ¥çé¿è¿åå±æä¸äºåºç¡ã</p>
<hr>
<h2 id="ç»è¯­ä¸ºäºæ´èªç±ç-ai-ç½å³">ç»è¯­ï¼ä¸ºäºæ´èªç±ç AI ç½å³</h2>
<p>ä» 1.7 ç MCP è½å°ï¼å° 1.9 ç Anthropic åçæ¯æä¸ API å¼å®¹ï¼Chats æ­£å¨ä¸æ­¥æ­¥ä»ä¸ä¸ªâèå¤©ç½é¡µâè¿åæä¸ä¸ª<strong>çæ­£éç¨ç AI åºç¡è®¾æ½</strong>ã</p>
<p>é£ä¸ª 200 ç¾åçè´¦åè½ç¶è®©äººå¿çï¼ä½å®æ¢æ¥äº Chats å¯¹ Claude çå®ç¾æ¯æï¼ä»¥åé£æ®µâä¸ºäºæµè¯èç¯çè°ç¨âçæ¿ææ¶åï¼æè§å¾ââå¼äºï¼</p>
<p>å¦å¤ç¸ä¿¡æï¼æåäºä¸ååªåå°è¯èç³»å¾®è½¯å Anthropicï¼äºåæé£ 200 ç¾åçè´¹ç¨ç»è¦åæ¥ï¼ä½ä»ä»¬äºç¸æ¨è¯¿ï¼ä¹æ²¡è¯´æ¯ç¨æ·èªå·±çè¡ä¸ºæèå¹³å°è´£ä»»ï¼åªæ¯äºç¸è¯´è¿æ¯å¯¹æ¹ï¼å¾®è½¯/Anthropicï¼çè´£ä»»ï¼æä»¥æåä¹å°±ä¸äºäºä¹äºã</p>
<p>æè°¢éè¯»ï¼åæ¬¢çæåè¯·ç»æç GitHub é¡¹ç®ä¸ä¸ª starï¼<a href="https://github.com/sdcb/chats" target="_blank" rel="noopener nofollow">https://github.com/sdcb/chats</a></p>
<p>è¿æ¯å®æ´çæ´æ°æ¥å¿ï¼<a href="https://github.com/sdcb/chats/blob/main/doc/zh-CN/release-notes/README.md" target="_blank" rel="noopener nofollow">https://github.com/sdcb/chats/blob/main/doc/zh-CN/release-notes/README.md</a></p>
<p>æä»ä¹æ³æ³ä¹æ¬¢è¿å¨è¯è®ºåºçè¨äº¤æµï¼ä¹æ¬¢è¿å å¥æçæ°åå»ºçå¾®ä¿¡ç¾¤ï¼</p>
<p><img src="https://io.starworks.cc:88/cv-public/2026/chats-wxg-qr.png" alt="" loading="lazy"></p>
<p>å¦æä½ æ´ä¹ æ¯ç¨ QQ çè¯ï¼ä¹å¯ä»¥å å¥ Chats QQ ç¾¤ï¼498452653ï¼æä»¬ä¸èµ·æ¢ç´¢æ´å¤ AI ææ¯ç¡¬æ ¸ç©æ³ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-21 08:45">2026-01-21 08:45</span>&nbsp;
<a href="https://www.cnblogs.com/sdcb">.NETéªæä½</a>&nbsp;
éè¯»(<span id="post_view_count">86</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508169);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508169', targetLink: 'https://www.cnblogs.com/sdcb/p/19508169/20260120-chats-190', title: 'ä¸¤å¤©ç§æ200ç¾åï¼æAIå¤§æ¨¡åç½å³ç»äºæ¯æäºClaudeæ¨¡å' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ºä»ä¹ IO æµéå¸¸åªè½è¢«è¯»åä¸æ¬¡ ]]></title>
    <link>https://www.cnblogs.com/yanshajiuzhou/p/19508716</link>
    <guid>8d3025a7d271c46f648b13878349879c</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/yanshajiuzhou/p/19508716" title="åå¸äº 2026-01-20 20:22">
    <span role="heading" aria-level="2">ä¸ºä»ä¹ IO æµéå¸¸åªè½è¢«è¯»åä¸æ¬¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        IO æµåªè½è¯»åä¸æ¬¡ï¼æ¯ ç²¾å¿è®¾è®¡çï¼è´´åæä½ç³»ç»æä»¶ / ç½ç» IO ç "é¡ºåºæ¶è´¹"&nbsp;ç¹æ§ï¼ä¿æååºå±ç³»ç»çä¸è´æ§ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>ä»å¤©æä»¬æ¥ä¸èµ·æ¢è®¨ä¸&nbsp;ä¸ºä»ä¹<strong> IO æµ</strong>éå¸¸åªè½è¢«è¯»åä¸æ¬¡ï¼</p>
<p>æä¸ºä»ä¹ä¼ååºè¿ä¸ªçé®å¢ï¼æ¯å ä¸ºæç ç©¶Webå¼åä¸­çä¸ä¸ªé®é¢æ¶ï¼HTTPè¯·æ±ä½å¨ <strong>Filterï¼è¿æ»¤å¨ï¼</strong>å¤è¢«è¯»åäºä¹åï¼å¨ Controllerï¼æ§å¶å±ï¼å°±è¯»ä¸å°å¼äºï¼ä½¿ç¨ @RequestBody çæ¶åã</p>
<p>æ è®ºæ¯å­èæµï¼InputStream / OutputStreamï¼è¿æ¯å­ç¬¦æµï¼Reader / Writerï¼ï¼ææåºäºæµçè¯»åæä½é½ä¼ç»´æ¤ä¸ä¸ª <strong>"ä½ç½®æé"</strong>ã</p>
<ul>
<li>åå§ç¶æä¸ï¼æéæåæµçèµ·å§ä½ç½®<strong>ï¼position = 0ï¼</strong>ï¼</li>
<li>æ¯æ¬¡è°ç¨ <strong>read() / read(byte[]) / read(char[])</strong> ç­è¯»åæ¹æ³æ¶ï¼æéä¼ååç§»å¨å¯¹åºå­èæ°ï¼</li>
<li>å½æéç§»å¨å°æµçæ«å°¾ï¼æ²¡ææ´å¤æ°æ®ï¼ï¼read() æ¹æ³ä¼è¿å <strong>-1</strong>ï¼è¡¨ç¤ºæµè¯»åå®æ¯ï¼</li>
<li>æéç§»å¨åä¸ä¼èªå¨åéï¼ä¹æ æ³ååç§»å¨ï¼é¤éæµæ¾å¼æ¯æéç½®ï¼ï¼å æ­¤åæ¬¡è¯»ååªè½å¾å° <strong>-1</strong>ã</li>
</ul>
<p><strong>ç±»æ¯</strong>ï¼<strong>IO æµ</strong>çè¯»åè¿ç¨ï¼å°±åç¨ <strong>ç£å¸¦æ­æ¾å¨å¬ç£å¸¦</strong> ââ ç£å¤´ï¼å¯¹åºæµçä½ç½®æéï¼ä»ç£å¸¦å¼å¤´ï¼æé 0ï¼å¼å§ç§»å¨ï¼æ¯è¯»ä¸ä¸ªå­è / å­ç¬¦ï¼ç£å¤´å°±å¾åèµ°ä¸æ­¥ï¼å½ç£å¤´èµ°å°ç£å¸¦æ«å°¾ï¼åç»§ç»­æ­æ¾ï¼è¯»åï¼å°±åªè½å¬å° "æ²æ²å£°"ï¼æµè¿å <strong>-1</strong>ï¼ï¼å¹¶ä¸ç£å¤´ä¸ä¼èªå¨åå°å¼å¤´ã</p>
<p>å½ç¶ï¼<strong>ä¸æ¯æææµé½åªè½è¯»ä¸æ¬¡</strong>ï¼<strong>åºäºåå­çæµ</strong>ï¼å¦ <strong>ByteArrayInputStream / CharArrayReader</strong>ï¼æ¯æéç½®æéï¼å ä¸ºå®ä»¬çæ°æ®æºæ¯åå­ä¸­çæ°ç»ï¼<strong>æ°æ®ä¸ä¼æ¶å¤±</strong>ï¼ï¼å¯ä»¥éè¿ <strong>mark()</strong> å <strong>reset()&nbsp;</strong>æ¹æ³å°æé <strong>æ¢å¤</strong> å°æ è®°ä½ç½®ã</p>
<p>éè¦æ³¨æï¼</p>
<ul>
<li>è°ç¨ <strong>reset()&nbsp;</strong>åå¿é¡»åè°ç¨ <strong>mark(int readlimit)</strong>ï¼</li>
<li>ä¸æ¯æææµé½æ¯æ <strong>mark() / reset()</strong>ï¼å¯ä»¥éè¿ <strong>inputStream.markSupported()</strong> æ¥è¿è¡å¤æ­ã</li>
</ul>
<p><strong>ä½¿ç¨ mark() å reset() æ¹æ³ï¼</strong></p>
<pre class="language-java highlighter-hljs"><code>// ä»éç¨äºæ¯æmarkçæµ
public void processWithMark(InputStream input) throws IOException {
    if (!input.markSupported()) {
        throw new IOException("Mark not supported");
    }
    
    // æ è®°å½åä½ç½®ï¼åæ°100è¡¨ç¤ºæå¤å¯åé100å­è
    input.mark(100);
    
    // ç¬¬ä¸æ¬¡è¯»å
    byte[] firstRead = new byte[50];
    input.read(firstRead);
    System.out.println("First read: " + new String(firstRead));
    
    // éç½®å°æ è®°ä½ç½®
    input.reset();
    
    // ç¬¬äºæ¬¡è¯»åï¼ç¸ååå®¹ï¼
    byte[] secondRead = new byte[50];
    input.read(secondRead);
    System.out.println("Second read: " + new String(secondRead));
}</code></pre>
<p>ä½¿ç¨ <strong>åè£ç±»</strong> è§£å³ä¸ææä»¬æå°ç&nbsp;<strong>HTTPè¯·æ±ä½å¤æ¬¡è¯»å </strong>çé®é¢ï¼</p>
<pre class="language-java highlighter-hljs"><code>public class MyRequestWrapper extends HttpServletRequestWrapper {
    private final byte[] body; // ç¼å­è¯·æ±ä½çå­èæ°ç»

    public MyRequestWrapper(HttpServletRequest request) throws IOException {
        super(request);
        // å³é®æ­¥éª¤ï¼å¨æé æ¶ä¸æ¬¡æ§è¯»åå¹¶å­å¨åå§è¯·æ±æµ
        body = StreamUtils.copyToByteArray(request.getInputStream());
    }

    // æä¾ä¸ä¸ªä¾¿æ·æ¹æ³ï¼ç¨äºå¨è¿æ»¤å¨ä¸­è·åè¯·æ±ä½åå®¹ï¼ä¾å¦è®°å½æ¥å¿ï¼
    // ä½¿ç¨æ¶ï¼ç´æ¥è°ç¨ getBodyString() å³å¯
    public String getBodyString() throws UnsupportedEncodingException {
        return new String(body, this.getCharacterEncoding());
    }

    @Override
    public ServletInputStream getInputStream() throws IOException {
        // æ¯æ¬¡è°ç¨é½è¿åä¸ä¸ªåºäºç¼å­æ°æ®çæ°æµ
        ByteArrayInputStream bais = new ByteArrayInputStream(body);
        return new ServletInputStream() {
            @Override
            public int read() {
                return bais.read();
            }

            @Override
            public boolean isFinished() {
                return bais.available() == 0;
            }

            @Override
            public boolean isReady() {
                return true;
            }

            @Override
            public void setReadListener(ReadListener readListener) {
                // æ éå®ç°
            }
        };
    }

    @Override
    public BufferedReader getReader() throws IOException {
        return new BufferedReader(new InputStreamReader(this.getInputStream(), this.getCharacterEncoding()));
    }
}</code></pre>
<p>ç¶åå¨ <strong>è¿æ»¤å¨</strong> å¤åè£è¯·æ±ï¼</p>
<pre class="language-java highlighter-hljs"><code>@Slf4j
@Configuration
public class RequestCachingFilterConfig {

    @Bean
    public FilterRegistrationBean requestCachingFilter() {
        FilterRegistrationBean registrationBean = new FilterRegistrationBean();

        // æ ¸å¿ï¼åå»ºè¿æ»¤å¨ï¼åè£è¯·æ±ä¸º ContentCachingRequestWrapper
        registrationBean.setFilter(new OncePerRequestFilter() {
            @Override
            protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
                    throws ServletException, IOException {
                // 1. ä»åè£ HTTP è¯·æ±ï¼æé¤ WebSocket ç­ï¼
                if (request instanceof HttpServletRequest &amp;&amp; !(request instanceof ContentCachingRequestWrapper)) {
                    log.info("==========è¿å¥requestCachingFilter========");
                    // 2. åè£è¯·æ±ï¼èªå¨ç¼å­è¯·æ±ä½ï¼
                    MyRequestWrapper wrappedRequest = new MyRequestWrapper(request);
                    filterChain.doFilter(wrappedRequest, response); // ä¼ éåè£åçè¯·æ±
                } else {
                    filterChain.doFilter(request, response); // æ éåè£ï¼ç´æ¥æ¾è¡
                }
            }
        });

        // 3. éç½®æ¦æªææè¯·æ±ï¼å¯æ ¹æ®éæ±è°æ´ URL æ¨¡å¼ï¼
        registrationBean.addUrlPatterns("/*");
        registrationBean.setOrder(1); // ä¼åçº§æé«ï¼ç¡®ä¿åäºå¶ä»è¿æ»¤å¨æ§è¡
        registrationBean.setName("requestCachingFilter");
        return registrationBean;
    }
}</code></pre>
<p><strong>IO æµ</strong>åªè½è¯»åä¸æ¬¡ï¼æ¯ <strong>ç²¾å¿è®¾è®¡ç</strong>ï¼è´´åæä½ç³»ç»æä»¶ / ç½ç» IO ç <strong>"é¡ºåºæ¶è´¹"</strong>&nbsp;ç¹æ§ï¼ä¿æååºå±ç³»ç»çä¸è´æ§ã</p>
<p style="text-align: right"><span style="color: rgba(53, 152, 219, 1)">å¤å¨å½¢å¼è¶ç®åçä¸è¥¿ï¼æºæ§å«éè¶é«ï¼å ä¸ºå®å·²ç»ä¸åä¾èµå½¢å¼ï¼å¿é¡»ä¾é æºæ§ã-- çæ²ä¹æ´²</span></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 20:23">2026-01-20 20:22</span>&nbsp;
<a href="https://www.cnblogs.com/yanshajiuzhou">çæ²ä¹æ´²</a>&nbsp;
éè¯»(<span id="post_view_count">51</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508716);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508716', targetLink: 'https://www.cnblogs.com/yanshajiuzhou/p/19508716', title: 'ä¸ºä»ä¹ IO æµéå¸¸åªè½è¢«è¯»åä¸æ¬¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åå« throw exceptionï¼ä¸ºä»ä¹ Result<T> ææ¯ä¸å¡é»è¾çæ­£ç¡®éæ© ]]></title>
    <link>https://www.cnblogs.com/diamondhusky/p/19508626</link>
    <guid>5b146f83f56da1052f4440a052407726</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/diamondhusky/p/19508626" title="åå¸äº 2026-01-20 19:40">
    <span role="heading" aria-level="2">åå« throw exceptionï¼ä¸ºä»ä¹ Result&lt;T&gt; ææ¯ä¸å¡é»è¾çæ­£ç¡®éæ©</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p></p><div class="toc"><div class="toc-container-header">ç®å½</div><ul><li><a href="#å¼è¨ä¸ä¸ªæ®éå­å¨çåå³é" rel="noopener nofollow">å¼è¨ï¼ä¸ä¸ªæ®éå­å¨çâåå³éâ</a></li><li><a href="#ä¸å¼å¸¸çåç½ª--æä»¬ä¸ç´å¨æ»¥ç¨å®" rel="noopener nofollow">ä¸ãå¼å¸¸çâåç½ªâ ââ æä»¬ä¸ç´å¨æ»¥ç¨å®</a><ul><li><a href="#11-å¼å¸¸çæ¬è´¨æ¯ä»ä¹" rel="noopener nofollow">1.1 å¼å¸¸çæ¬è´¨æ¯ä»ä¹ï¼</a></li><li><a href="#12-ä¸å¡é»è¾--å¼å¸¸æåµ" rel="noopener nofollow">1.2 ä¸å¡é»è¾ â  å¼å¸¸æåµ</a></li></ul></li><li><a href="#äºresultä¸å¡é»è¾çä¼ééçº§" rel="noopener nofollow">äºãResult<t>ââä¸å¡é»è¾ç"ä¼ééçº§"</t></a><ul><li><a href="#21-ä»ä¹æ¯result" rel="noopener nofollow">2.1 ä»ä¹æ¯Result<t>ï¼</t></a></li><li><a href="#22-å¦ä½æ­£ç¡®ä½¿ç¨result" rel="noopener nofollow">2.2 å¦ä½æ­£ç¡®ä½¿ç¨Result<t>ï¼</t></a></li></ul></li><li><a href="#ä¸æ§è½å¯¹å³--å è¿ç¢¾åçæ§è½å·®è·" rel="noopener nofollow">ä¸ãæ§è½å¯¹å³ ââ å è¿ç¢¾åçæ§è½å·®è·</a><ul><li><a href="#31-é¨åæµè¯ä»£ç " rel="noopener nofollow">3.1 é¨åæµè¯ä»£ç </a></li><li><a href="#32-æµè¯ç»æè§¦ç®æå¿" rel="noopener nofollow">3.2 æµè¯ç»æï¼è§¦ç®æå¿</a></li><li><a href="#33-å¹¶ååºæ¯ä¸æ§è½å·®è·ä¾æ§ä¸å¿ç´è§" rel="noopener nofollow">3.3 å¹¶ååºæ¯ä¸ï¼æ§è½å·®è·ä¾æ§ä¸å¿ç´è§</a></li></ul></li><li><a href="#åä¸ºä»ä¹å¼å¸¸å¨ä¸å¡åºæ¯ä¸å¦æ­¤æè´µ" rel="noopener nofollow">åãä¸ºä»ä¹å¼å¸¸å¨ä¸å¡åºæ¯ä¸å¦æ­¤"æè´µ"ï¼</a><ul><li><a href="#41-clrå¼å¸¸æºå¶çåºå±åç" rel="noopener nofollow">4.1 CLRå¼å¸¸æºå¶çåºå±åç</a><ul><li><a href="#411-å¼å¸¸å¯¹è±¡çæé è¿ç¨" rel="noopener nofollow">4.1.1 å¼å¸¸å¯¹è±¡çæé è¿ç¨</a></li><li><a href="#412-å æ è·è¸ªççå®ä»£ä»·" rel="noopener nofollow">4.1.2 å æ è·è¸ªççå®ä»£ä»·</a></li><li><a href="#413-jitåaotç¼è¯å¯¹å¼å¸¸çå½±å" rel="noopener nofollow">4.1.3 JITåAOTç¼è¯å¯¹å¼å¸¸çå½±å</a></li></ul></li><li><a href="#42-å¼å¸¸å¤ççåå­åéç»è" rel="noopener nofollow">4.2 å¼å¸¸å¤ççåå­åéç»è</a><ul><li><a href="#421-å¼å¸¸å¯¹è±¡çåå­å¸å±" rel="noopener nofollow">4.2.1 å¼å¸¸å¯¹è±¡çåå­å¸å±</a></li><li><a href="#422-gcçå½±å" rel="noopener nofollow">4.2.2 GCçå½±å</a></li></ul></li><li><a href="#43-cpuçº§å«çæ§è½å½±å" rel="noopener nofollow">4.3 CPUçº§å«çæ§è½å½±å</a><ul><li><a href="#431-ç°ä»£cpuçå¼å¸¸å¤çå¼é" rel="noopener nofollow">4.3.1 ç°ä»£CPUçå¼å¸¸å¤çå¼é</a></li><li><a href="#432-å¯¹æ¯æ­£å¸¸è¿ååå¼å¸¸è¿å" rel="noopener nofollow">4.3.2 å¯¹æ¯æ­£å¸¸è¿ååå¼å¸¸è¿å</a></li></ul></li><li><a href="#44-å¯¹æ¯å¶ä»ç¼ç¨è¯­è¨" rel="noopener nofollow">4.4 å¯¹æ¯å¶ä»ç¼ç¨è¯­è¨</a><ul><li><a href="#441-javaçå¼å¸¸æºå¶" rel="noopener nofollow">4.4.1 Javaçå¼å¸¸æºå¶</a></li><li><a href="#442-goçéè¯¯å¤çå²å­¦" rel="noopener nofollow">4.4.2 Goçéè¯¯å¤çå²å­¦</a></li><li><a href="#443-rustçresultç±»å" rel="noopener nofollow">4.4.3 RustçResultç±»å</a></li><li><a href="#444-cçéè¯¯å¤ç" rel="noopener nofollow">4.4.4 C++çéè¯¯å¤ç</a></li></ul></li><li><a href="#45-net-coreçæ¹è¿åå±é" rel="noopener nofollow">4.5 .NET Coreçæ¹è¿åå±é</a></li></ul></li><li><a href="#äºresultçè¿é¶ä¼å¿" rel="noopener nofollow">äºãResult<t>çè¿é¶ä¼å¿</t></a><ul><li><a href="#51-ä¸°å¯çéè¯¯ä¿¡æ¯" rel="noopener nofollow">5.1 ä¸°å¯çéè¯¯ä¿¡æ¯</a></li><li><a href="#52-å½æ°å¼ç¼ç¨æ¯æ" rel="noopener nofollow">5.2 å½æ°å¼ç¼ç¨æ¯æ</a></li><li><a href="#53-æ´å¥½çapiè®¾è®¡" rel="noopener nofollow">5.3 æ´å¥½çAPIè®¾è®¡</a></li></ul></li><li><a href="#å­-resultæ¨¡å¼çä¸äºå¼ç«¯" rel="noopener nofollow">å­ã Result<t>æ¨¡å¼çä¸äºå¼ç«¯</t></a><ul><li><a href="#61-ifå°ç±é®é¢æ¡ä»¶å¤æ­æ³æ»¥" rel="noopener nofollow">6.1 "ifå°ç±"é®é¢ï¼æ¡ä»¶å¤æ­æ³æ»¥ï¼</a></li><li><a href="#62-å¼ç±»åstructvs-å¼ç¨ç±»åclassçä¸¤é¾éæ©" rel="noopener nofollow">6.2 å¼ç±»åï¼structï¼vs å¼ç¨ç±»åï¼classï¼çä¸¤é¾éæ©</a></li><li><a href="#63-å¼æ­¥ç¼ç¨çå¤ææ§" rel="noopener nofollow">6.3 å¼æ­¥ç¼ç¨çå¤ææ§</a></li><li><a href="#64-ç±»åç³»ç»åé¿" rel="noopener nofollow">6.4 ç±»åç³»ç»åé¿</a></li><li><a href="#65-å¶ä»é®é¢" rel="noopener nofollow">6.5 å¶ä»é®é¢</a></li></ul></li><li><a href="#ä¸å¸¸è§é®é¢ä¸ç­ç" rel="noopener nofollow">ä¸ãå¸¸è§é®é¢ä¸ç­ç</a></li><li><a href="#å«æ»ç»" rel="noopener nofollow">å«ãæ»ç»</a></li></ul></div><p></p>
<h1 id="å¼è¨ä¸ä¸ªæ®éå­å¨çåå³é">å¼è¨ï¼ä¸ä¸ªæ®éå­å¨çâåå³éâ</h1>
<p>å¦æä½ å¨C#é¡¹ç®ä¸­çå°è¿æ ·çä»£ç ï¼ä¸å®ä¸ä¼æå°éçï¼</p>
<pre><code class="language-csharp">public User Login(string username, string password)
{
    var user = FindUser(username);
    if (user == null)
        throw new Exception("ç¨æ·ä¸å­å¨");  // â çæçæ¨¡å¼
    
    if (!VerifyPassword(user, password))
        throw new Exception("å¯ç éè¯¯");    // â å¦ä¸ä¸ªçæçæ¨¡å¼
    
    return user;
}
</code></pre>
<p>è¿ç§ä½¿ç¨å¼å¸¸æ¥å¤çä¸å¡é»è¾çåæ³ï¼å ä¹æäºC#å¼åçâæ åèå¼âã<br>
å¯æ¯ï¼<strong>ä»æ¥å¦æ­¤ï¼ä¾¿æ¯å¯¹çä¹ï¼</strong></p>
<h1 id="ä¸å¼å¸¸çåç½ª--æä»¬ä¸ç´å¨æ»¥ç¨å®">ä¸ãå¼å¸¸çâåç½ªâ ââ æä»¬ä¸ç´å¨æ»¥ç¨å®</h1>
<h2 id="11-å¼å¸¸çæ¬è´¨æ¯ä»ä¹">1.1 å¼å¸¸çæ¬è´¨æ¯ä»ä¹ï¼</h2>
<p>é¦åï¼æä»¬è¦æç½C#è¯­è¨éçå¼å¸¸ï¼Exceptionï¼çè®¾è®¡åè¡·ï¼</p>
<pre><code class="language-csharp">// è¿äºææ¯å¼å¸¸çæ­£çä½¿ç¨åºæ¯ï¼
public void ReadFile(string path)
{
    if (string.IsNullOrEmpty(path))
        throw new ArgumentNullException(nameof(path));  // â åæ°æ£æ¥
    
    if (!File.Exists(path))
        throw new FileNotFoundException($"æä»¶ä¸å­å¨: {path}");  // â ç³»ç»éè¯¯
    
    // å°è¯è¯»åæä»¶ï¼å¯è½æåºIOExceptionç­
    var content = File.ReadAllText(path);
}
</code></pre>
<p>å¼å¸¸æ¯ä¸ºçæ­£ç"å¼å¸¸æåµ"è®¾è®¡çï¼æ¯å¦ï¼</p>
<ul>
<li>ç³»ç»èµæºä¸å¯ç¨ï¼æä»¶ä¸å­å¨ãæ°æ®åºè¿æ¥å¤±è´¥ï¼</li>
<li>ç¨åºç¶æå¼å¸¸ï¼ç©ºæéãæ°ç»è¶çï¼</li>
<li>åæ°éªè¯å¤±è´¥ï¼åç½®æ¡ä»¶ä¸æ»¡è¶³ï¼</li>
</ul>
<h2 id="12-ä¸å¡é»è¾--å¼å¸¸æåµ">1.2 ä¸å¡é»è¾ â  å¼å¸¸æåµ</h2>
<p>ä¸å¡éè¯¯ï¼ç¨æ·ä¸å­å¨ãå¯ç éè¯¯ãä½é¢ä¸è¶³ï¼æ¯<strong>å¯é¢è§çæ­£å¸¸ä¸å¡æµç¨</strong>ï¼èä¸æ¯å¼å¸¸æåµã<br>
æä¸å¡éè¯¯ç¨å¼å¸¸å¤çï¼å°±åï¼</p>
<ul>
<li>ç¨"å°éè­¦æ¥"æ¥å¤ç"å®¶éæ²¡ç±³äº"</li>
<li>ç¨"æ¶é²è½¦"æ¥è¿é"å¿«éåè£¹"</li>
<li>ç¨"ææ¯å®¤"æ¥å¤ç"æååç§"</li>
</ul>
<p>è¿æ¯å¯¹å¼å¸¸æºå¶çä¸¥éæ»¥ç¨ï¼</p>
<h1 id="äºresultä¸å¡é»è¾çä¼ééçº§">äºãResult<t>ââä¸å¡é»è¾ç"ä¼ééçº§"</t></h1>
<h2 id="21-ä»ä¹æ¯result">2.1 ä»ä¹æ¯Result<t>ï¼</t></h2>
<p>ä¸ä¸ªç®åï¼å·å¤åºæ¬åè½çResultç±»å¦ä¸ï¼</p>
<pre><code class="language-csharp">public class Result&lt;T&gt;
{
    public bool Success { get; }
    public T? Value { get; }
    public string? Error { get; }
    
    private Result(T value) { Success = true; Value = value; Error = null; }
    private Result(string error) { Success = false; Value = default; Error = error; }
    
    public static Result&lt;T&gt; Ok(T value) =&gt; new(value);
    public static Result&lt;T&gt; Fail(string error) =&gt; new(error);
}
</code></pre>
<h2 id="22-å¦ä½æ­£ç¡®ä½¿ç¨result">2.2 å¦ä½æ­£ç¡®ä½¿ç¨Result<t>ï¼</t></h2>
<pre><code class="language-csharp">public Result&lt;User&gt; Login(string username, string password)
{
    if (string.IsNullOrEmpty(username))
        return Result&lt;User&gt;.Fail("ç¨æ·åä¸è½ä¸ºç©º");  // â æç¡®è¿åä¸å¡éè¯¯
    
    if (string.IsNullOrEmpty(password))
        return Result&lt;User&gt;.Fail("å¯ç ä¸è½ä¸ºç©º");    // â æç¡®è¿åä¸å¡éè¯¯
    
    var user = FindUser(username);
    if (user == null)
        return Result&lt;User&gt;.Fail("ç¨æ·ä¸å­å¨");      // â æç¡®è¿åä¸å¡éè¯¯
    
    if (!VerifyPassword(user, password))
        return Result&lt;User&gt;.Fail("å¯ç éè¯¯");        // â æç¡®è¿åä¸å¡éè¯¯
    
    return Result&lt;User&gt;.Ok(user);                   // â æç¡®è¿åæå
}
</code></pre>
<h1 id="ä¸æ§è½å¯¹å³--å è¿ç¢¾åçæ§è½å·®è·">ä¸ãæ§è½å¯¹å³ ââ å è¿ç¢¾åçæ§è½å·®è·</h1>
<h2 id="31-é¨åæµè¯ä»£ç ">3.1 é¨åæµè¯ä»£ç </h2>
<p>é¡¹ç®ç¯å¢ï¼</p>
<pre><code>&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
	&lt;PropertyGroup&gt;
		&lt;OutputType&gt;Exe&lt;/OutputType&gt;
		&lt;TargetFramework&gt;net8.0&lt;/TargetFramework&gt;
		&lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
		&lt;Nullable&gt;enable&lt;/Nullable&gt;
		&lt;LangVersion&gt;latest&lt;/LangVersion&gt;
	&lt;/PropertyGroup&gt;
&lt;/Project&gt;
</code></pre>
<p>é¨åæµè¯ä»£ç ï¼</p>
<pre><code class="language-csharp"> public class LoginService
 {
     private readonly Dictionary&lt;string, User&gt; _users = new()
     {
         ["valid_user"] = new User { Id = 1, Username = "valid_user" }
     };

    
     public User LoginWithException(string username, string password)
     {
         if (!_users.TryGetValue(username, out var user))
             throw new BusinessException("ç¨æ·ä¸å­å¨");

         if (password != "correct_password")
             throw new BusinessException("å¯ç éè¯¯");

         return user;
     }

    
     public Result&lt;User&gt; LoginWithResult(string username, string password)
     {
         if (!_users.TryGetValue(username, out var user))
             return Result&lt;User&gt;.Fail("ç¨æ·ä¸å­å¨");

         if (password != "correct_password")
             return Result&lt;User&gt;.Fail("å¯ç éè¯¯");

         return Result&lt;User&gt;.Ok(user);
     }
 }
</code></pre>
<pre><code class="language-csharp">public class PerformanceTester
{
    private readonly LoginService _service = new();
    private readonly Random _random = new(42);

    public void RunAllTests(int iterations = 1000000)
    {
        Console.WriteLine($"æ§è½å¯¹æ¯æµè¯ - è¿­ä»£æ¬¡æ°: {iterations:N0}");
        Console.WriteLine("=".PadRight(60, '='));

        // æµè¯1ï¼æåè·¯å¾ï¼æ­£å¸¸æåµï¼
        TestSuccessPath(iterations);

        // æµè¯2ï¼å¤±è´¥è·¯å¾ï¼éè¯¯æåµï¼
        TestErrorPath(iterations);

        // æµè¯3ï¼æ··åè·¯å¾ï¼30%æåçï¼
        TestMixedPath(iterations, 0.3);
    }

    private void TestSuccessPath(int iterations)
    {
        Console.WriteLine("\næµè¯1ï¼æåè·¯å¾ï¼100%æåï¼");

        // å¼å¸¸æ¹å¼
        var exceptionTime = Measure(() =&gt;
        {
            try
            {
                _service.LoginWithException("valid_user", "correct_password");
            }
            catch
            {
                // ä¸åºè¯¥åç
            }
        }, iterations, "å¼å¸¸æ¹å¼");

        // Resultæ¹å¼
        var resultTime = Measure(() =&gt;
        {
            var result = _service.LoginWithResult("valid_user", "correct_password");
            if (!result.Success)
            {
                // ä¸åºè¯¥åç
            }
        }, iterations, "Resultæ¹å¼");

        PrintComparison(exceptionTime, resultTime);
    }

    private void TestErrorPath(int iterations)
    {
        Console.WriteLine("\næµè¯2ï¼å¤±è´¥è·¯å¾ï¼100%å¤±è´¥ï¼");

        // å¼å¸¸æ¹å¼
        var exceptionTime = Measure(() =&gt;
        {
            try
            {
                _service.LoginWithException("invalid_user", "wrong_password");
            }
            catch (BusinessException)
            {
                // é¢æå¼å¸¸
            }
        }, iterations, "å¼å¸¸æ¹å¼");

        // Resultæ¹å¼
        var resultTime = Measure(() =&gt;
        {
            var result = _service.LoginWithResult("invalid_user", "wrong_password");
            if (result.Success)
            {
                // ä¸åºè¯¥åç
            }
        }, iterations, "Resultæ¹å¼");

        PrintComparison(exceptionTime, resultTime);
    }

    private void TestMixedPath(int iterations, double successRate)
    {
        Console.WriteLine($"\næµè¯3ï¼æ··åè·¯å¾ï¼{successRate:P0}æåçï¼");

        // åå¤æµè¯æ°æ®
        var testData = new (string user, string pwd, bool shouldSucceed)[iterations];
        for (int i = 0; i &lt; iterations; i++)
        {
            testData[i] = _random.NextDouble() &lt; successRate
                ? ("valid_user", "correct_password", true)   // æå
                : ("invalid_user", "wrong_password", false); // å¤±è´¥
        }

        // å¼å¸¸æ¹å¼
        var exceptionTime = MeasureMixed(testData, true, "å¼å¸¸æ¹å¼");

        // Resultæ¹å¼
        var resultTime = MeasureMixed(testData, false, "Resultæ¹å¼");

        PrintComparison(exceptionTime, resultTime);
    }

    private static long Measure(Action action, int iterations, string testName)
    {
        // é¢ç­
        for (int i = 0; i &lt; 1000; i++) action();

        GC.Collect();
        GC.WaitForPendingFinalizers();
        GC.Collect();

        var sw = Stopwatch.StartNew();
        for (int i = 0; i &lt; iterations; i++)
        {
            action();
        }
        sw.Stop();

        var opsPerSecond = iterations / (sw.ElapsedMilliseconds / 1000.0);
        Console.WriteLine($"  {testName}: {sw.ElapsedMilliseconds,8}ms ({opsPerSecond,12:N0} ops/s)");

        return sw.ElapsedMilliseconds;
    }

    private long MeasureMixed(
        (string user, string pwd, bool shouldSucceed)[] testData,
        bool useException,
        string testName)
    {
        // é¢ç­
        for (int i = 0; i &lt; Math.Min(1000, testData.Length); i++)
        {
            var (user, pwd, _) = testData[i];
            if (useException)
            {
                try
                {
                    _service.LoginWithException(user, pwd);
                }
                catch { }
            }
            else
            {
                _service.LoginWithResult(user, pwd);
            }
        }

        GC.Collect();
        GC.WaitForPendingFinalizers();
        GC.Collect();

        var sw = Stopwatch.StartNew();

        if (useException)
        {
            for (int i = 0; i &lt; testData.Length; i++)
            {
                var (user, pwd, _) = testData[i];
                try
                {
                    _service.LoginWithException(user, pwd);
                }
                catch { }
            }
        }
        else
        {
            for (int i = 0; i &lt; testData.Length; i++)
            {
                var (user, pwd, _) = testData[i];
                _service.LoginWithResult(user, pwd);
            }
        }

        sw.Stop();

        var opsPerSecond = testData.Length / (sw.ElapsedMilliseconds / 1000.0);
        Console.WriteLine($"  {testName}: {sw.ElapsedMilliseconds,8}ms ({opsPerSecond,12:N0} ops/s)");

        return sw.ElapsedMilliseconds;
    }

    private static void PrintComparison(long exceptionTime, long resultTime)
    {
        var speedup = exceptionTime / (double)resultTime;
        var improvement = (exceptionTime - resultTime) * 100.0 / exceptionTime;

        if (speedup &gt; 1)
        {
            Console.WriteLine($"Resultæ¯Exceptionå¿« {speedup:F1}xï¼æ§è½æå {improvement:F1}%");
        }
        else
        {
            Console.WriteLine($"å·®å¼ä¸å¤§: {speedup:F2}x");
        }
    }
}
</code></pre>
<h2 id="32-æµè¯ç»æè§¦ç®æå¿">3.2 æµè¯ç»æï¼è§¦ç®æå¿</h2>
<p>åä¸å¾ï¼çæµè¯ç»æ(<strong>åºäºRELEASEæ¨¡å¼ç¼è¯</strong>)ï¼</p>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1553709/202601/1553709-20260120175226554-1542544296.png" class="lazyload"></p>
<h2 id="33-å¹¶ååºæ¯ä¸æ§è½å·®è·ä¾æ§ä¸å¿ç´è§">3.3 å¹¶ååºæ¯ä¸ï¼æ§è½å·®è·ä¾æ§ä¸å¿ç´è§</h2>
<p>å¹¶åæµè¯æ ¸å¿ä»£ç ï¼</p>
<pre><code class="language-csharp">/// &lt;summary&gt;
/// // å¹¶åæµè¯ç»æç±»
/// &lt;/summary&gt;
public class ConcurrentTestResult
{
    public int Concurrency { get; set; }
    public long ExceptionTime { get; set; }
    public long ResultTime { get; set; }
    public double ExceptionOpsPerSecond { get; set; }
    public double ResultOpsPerSecond { get; set; }
}


/// &lt;summary&gt;
/// å¹¶åæµè¯å¨
/// &lt;/summary&gt;
public class ConcurrentPerformanceTester
{
    private readonly LoginService _service = new();
    private readonly Random _random = new(42);

    private readonly double _errorRate = 0.3;


    public async Task RunConcurrentTests(int totalIterations = 1000000)
    {
        Console.WriteLine("\nå¹¶åæ§è½æµè¯ - æ»è¿­ä»£æ¬¡æ°: {0:N0} - éè¯¯çï¼{1:P0}", totalIterations, _errorRate);
        Console.WriteLine("=".PadRight(60, '='));

        var concurrencyLevels = new[] { 4, 8, 16, 32, 64, 128, 256 };

        foreach (var concurrency in concurrencyLevels)
        {
            Console.WriteLine($"\nå¹¶åæ°: {concurrency}");

            // é¢ç­
            await Warmup(concurrency);

            // å¼å¸¸æ¹å¼å¹¶åæµè¯ï¼30%éè¯¯çæ¨¡æçå®åºæ¯ï¼
            var exceptionTime = await RunConcurrentExceptionTest(
                concurrency,
                totalIterations,
                errorRate: _errorRate
            );

            // Resultæ¹å¼å¹¶åæµè¯
            var resultTime = await RunConcurrentResultTest(
                concurrency,
                totalIterations,
                errorRate: _errorRate
            );

            var exceptionOps = totalIterations / (exceptionTime / 1000.0);
            var resultOps = totalIterations / (resultTime / 1000.0);
            var speedup = exceptionTime / (double)resultTime;

            Console.WriteLine($"  å¼å¸¸: {exceptionTime,5}ms ({exceptionOps,8:N0} ops/s)");
            Console.WriteLine($"  Result: {resultTime,5}ms ({resultOps,8:N0} ops/s)");
            Console.WriteLine($"  Resultå¿« {speedup:F1}x");
        }
    }

    /// &lt;summary&gt;
    /// å¹¶åå¼å¸¸æµè¯
    /// &lt;/summary&gt;
    /// &lt;param name="concurrency"&gt;&lt;/param&gt;
    /// &lt;param name="totalIterations"&gt;&lt;/param&gt;
    /// &lt;param name="errorRate"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private async Task&lt;long&gt; RunConcurrentExceptionTest(
        int concurrency,
        int totalIterations,
        double errorRate)
    {
        var iterationsPerTask = totalIterations / concurrency;
        var tasks = new Task[concurrency];

        var sw = Stopwatch.StartNew();

        for (int i = 0; i &lt; concurrency; i++)
        {
            // æ¯ä¸ªä»»å¡ä½¿ç¨èªå·±çéæºå®ä¾ï¼é¿åç«äº
            var taskRandom = new Random(_random.Next());
            tasks[i] = Task.Run(() =&gt;
            {
                for (int j = 0; j &lt; iterationsPerTask; j++)
                {
                    // ä¸ºæ¯æ¬¡è¿­ä»£çææµè¯æ°æ®ï¼é¿åç´¢å¼é®é¢
                    var (user, pwd) = GenerateTestDataForIteration(taskRandom, errorRate);
                    try
                    {
                        _service.LoginWithException(user, pwd);
                    }
                    catch (BusinessException)
                    {
                        // é¢æå¼å¸¸
                    }
                }
            });
        }

        await Task.WhenAll(tasks);
        sw.Stop();

        return sw.ElapsedMilliseconds;
    }

    /// &lt;summary&gt;
    /// å¹¶åResultæµè¯
    /// &lt;/summary&gt;
    /// &lt;param name="concurrency"&gt;&lt;/param&gt;
    /// &lt;param name="totalIterations"&gt;&lt;/param&gt;
    /// &lt;param name="errorRate"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private async Task&lt;long&gt; RunConcurrentResultTest(
        int concurrency,
        int totalIterations,
        double errorRate)
    {
        var iterationsPerTask = totalIterations / concurrency;
        var tasks = new Task[concurrency];

        var sw = Stopwatch.StartNew();

        for (int i = 0; i &lt; concurrency; i++)
        {
            var taskRandom = new Random(_random.Next());
            tasks[i] = Task.Run(() =&gt;
            {
                for (int j = 0; j &lt; iterationsPerTask; j++)
                {
                    var (user, pwd) = GenerateTestDataForIteration(taskRandom, errorRate);
                    var result = _service.LoginWithResult(user, pwd);
                    // ä¸éè¦é¢å¤å¤çï¼Resultå·²ç»åå«äºæå/å¤±è´¥ç¶æ
                }
            });
        }

        await Task.WhenAll(tasks);
        sw.Stop();

        return sw.ElapsedMilliseconds;
    }

    /// &lt;summary&gt;
    /// ä¸ºåæ¬¡è¿­ä»£çææµè¯æ°æ®
    /// &lt;/summary&gt;
    /// &lt;param name="random"&gt;&lt;/param&gt;
    /// &lt;param name="errorRate"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private static (string user, string pwd) GenerateTestDataForIteration(Random random, double errorRate)
    {
        if (random.NextDouble() &gt; errorRate)
        {
            // æåæ¡ä¾
            return ("valid_user", "correct_password");
        }
        else
        {
            // å¤±è´¥æ¡ä¾ - éæºéæ©å¤±è´¥ç±»å
            if (random.Next(2) == 0)
                return ("invalid_user", "any_password");  // ç¨æ·ä¸å­å¨
            else
                return ("valid_user", "wrong_password");   // å¯ç éè¯¯
        }
    }

    /// &lt;summary&gt;
    /// é¢ç­
    /// &lt;/summary&gt;
    /// &lt;param name="concurrency"&gt;&lt;/param&gt;
    /// &lt;param name="errorRate"&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private async Task Warmup(int concurrency, double errorRate = 0.3)
    {
        var warmupTasks = new Task[Math.Min(concurrency, 4)];

        for (int i = 0; i &lt; warmupTasks.Length; i++)
        {
            warmupTasks[i] = Task.Run(() =&gt;
            {
                var taskRandom = new Random(_random.Next());
                for (int j = 0; j &lt; 100; j++)
                {
                    var (user, pwd) = GenerateTestDataForIteration(taskRandom, errorRate);
                    try
                    {
                        _service.LoginWithException(user, pwd);
                    }
                    catch { }

                    _service.LoginWithResult(user, pwd);
                }
            });
        }

        await Task.WhenAll(warmupTasks);
        GC.Collect();
        GC.WaitForPendingFinalizers();
        GC.Collect();
    }
}
</code></pre>
<p>å¹¶åæµè¯ç»æï¼<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1553709/202601/1553709-20260120180104863-50492398.png" class="lazyload"></p>
<p>ä¸è¿°æµè¯å¯è½å¹¶ä¸ä¸¥è°¨åæå¨ï¼ä½æ¯æ´é²åºæ¥çé®é¢è¿æ¯éå¸¸ææ¾çï¼</p>
<ul>
<li>å¨100%å¤±è´¥åºæ¯ä¸ï¼Resultæ¯Exceptionå¿«äºå·®ä¸å¤200å</li>
<li>æ¥è¿å®éä¸å¡åºæ¯ç30%éè¯¯çæåµä¸ï¼Resultæ¯Exceptionä¹å¿«äº160å¤å</li>
<li>å¹¶ååºæ¯ä¸ï¼æ§è½å·®è·ä¹ææ¥è¿ç¾å</li>
</ul>
<h1 id="åä¸ºä»ä¹å¼å¸¸å¨ä¸å¡åºæ¯ä¸å¦æ­¤æè´µ">åãä¸ºä»ä¹å¼å¸¸å¨ä¸å¡åºæ¯ä¸å¦æ­¤"æè´µ"ï¼</h1>
<h2 id="41-clrå¼å¸¸æºå¶çåºå±åç">4.1 CLRå¼å¸¸æºå¶çåºå±åç</h2>
<h3 id="411-å¼å¸¸å¯¹è±¡çæé è¿ç¨">4.1.1 å¼å¸¸å¯¹è±¡çæé è¿ç¨</h3>
<p>å½æä»¬å¨C#ä¸­æåºå¼å¸¸æ¶ï¼çä¼¼ç®åçä¸è¡ä»£ç ï¼èåå´åçäºå¤§éå¤æçæä½ï¼</p>
<pre><code class="language-csharp">throw new BusinessException("ç¨æ·ä¸å­å¨");
</code></pre>
<p>è¿ä¸ªæä½çå®éæ§è¡æµç¨å¦ä¸ï¼</p>
<pre><code class="language-csharp">// ä¼ªä»£ç å±ç¤ºå¼å¸¸æé çå®éå¼é
public static Exception CreateException(string message)
{
    // 1. å åéï¼å¼å¸¸å¯¹è±¡æ¬èº«ï¼è³å°40-64å­èï¼
    var exception = RuntimeHelpers.AllocateException(typeof(BusinessException));
    
    // 2. å­æ®µåå§åï¼è°ç¨æé å½æ°é¾ï¼
    exception._message = message;  // å­ç¬¦ä¸²åé
    exception._stackTrace = null;
    exception._innerException = null;
    exception._helpURL = null;
    exception._source = null;
    
    // 3. æè·è°ç¨å æ ï¼ææè´µçé¨åï¼ï¼
    exception.CaptureStackTrace();
    
    return exception;
}

private void CaptureStackTrace()
{
    // 4. è·åå½åçº¿ç¨çè°ç¨å æ 
    var frames = new StackFrame[64];  // åéæ°ç»
    var frameCount = StackTraceHelper.CaptureStackTrace(
        frames, 0,  // èµ·å§ä½ç½®
        false,      // æ¯å¦éè¦æä»¶ä¿¡æ¯
        null);      // å¼å¸¸å¯¹è±¡æ¬èº«
    
    // 5. æ ¼å¼åæå­ç¬¦ä¸²ï¼å¯è½æ¶åå¤§éå­ç¬¦ä¸²æä½ï¼
    this._stackTrace = FormatStackTrace(frames, frameCount);
}
</code></pre>
<h3 id="412-å æ è·è¸ªççå®ä»£ä»·">4.1.2 å æ è·è¸ªççå®ä»£ä»·</h3>
<p>è®©æä»¬æ·±å¥çç<code>CaptureStackTrace</code>å°åºåäºä»ä¹ï¼</p>
<pre><code class="language-csharp">// Windowsä¸çå®éå®ç°ï¼ç®åï¼
internal static unsafe int CaptureStackTrace(
    StackFrame[] frames, 
    int startIndex,
    bool needFileInfo,
    Exception exception)
{
    // 1. è°ç¨ç³»ç»APIè·åå½åçº¿ç¨çä¸ä¸æ
    CONTEXT context;
    RtlCaptureContext(&amp;context);
    
    // 2. éåè°ç¨å æ ï¼æ§è½ææï¼ï¼
    STACKFRAME64 stackFrame = new STACKFRAME64();
    while (StackWalk64(
        IMAGE_FILE_MACHINE_AMD64,
        GetCurrentProcess(),
        GetCurrentThread(),
        &amp;stackFrame,
        &amp;context,
        null,
        SymFunctionTableAccess64,
        SymGetModuleBase64,
        null))
    {
        // 3. è§£ææ¯ä¸ªæ å¸§çä¿¡æ¯
        frames[frameCount++] = new StackFrame(
            stackFrame.AddrPC.Offset,
            needFileInfo ? GetSourceInfo(stackFrame) : null);
        
        if (frameCount &gt;= frames.Length) break;
    }
    
    return frameCount;
}
</code></pre>
<p>å³é®ç¹ï¼</p>
<ul>
<li>æ¯ä¸ªthrowæä½é½è¦éåæ´ä¸ªè°ç¨å æ </li>
<li>å æ éåæ¶åå¤ä¸ªç³»ç»è°ç¨ååå­è®¿é®</li>
<li>éè¦å°åå­å°åè§£æä¸ºæ¹æ³åãæä»¶åãè¡å·ç­</li>
<li>å¨Releaseæ¨¡å¼ä¸ï¼JITä¼åå¯è½ä¼å½±åå æ ä¿¡æ¯</li>
</ul>
<h3 id="413-jitåaotç¼è¯å¯¹å¼å¸¸çå½±å">4.1.3 JITåAOTç¼è¯å¯¹å¼å¸¸çå½±å</h3>
<pre><code class="language-csharp">// èèä»¥ä¸ä»£ç 
public int Process(int value)
{
    try
    {
        return ProcessValue(value);  // å¯è½æåºå¼å¸¸
    }
    catch (Exception)
    {
        return -1;
    }
}

// JITç¼è¯å¨éè¦çæï¼
// 1. æ­£å¸¸æ§è¡è·¯å¾çä»£ç 
// 2. å¼å¸¸å¤çè¡¨ï¼EHè¡¨ï¼
// 3. å æ å±å¼ä»£ç 
// 4. finallyåæ§è¡é»è¾ï¼å¦ææï¼
</code></pre>
<p>EHè¡¨çç»æï¼</p>
<pre><code>Method Exception Handling Table:
Start   Length  Handler Type    Class           Filter
0x0000  0x0020  0x0030  CLAUSE  Exception       null
</code></pre>
<p>æ¯ä¸ªtry-catchåé½ä¼å¨æ¹æ³çåæ°æ®ä¸­æ·»å EHè¡¨æ¡ç®ï¼å¢å æ¹æ³å¤§å°åå è½½æ¶é´ã</p>
<h2 id="42-å¼å¸¸å¤ççåå­åéç»è">4.2 å¼å¸¸å¤ççåå­åéç»è</h2>
<h3 id="421-å¼å¸¸å¯¹è±¡çåå­å¸å±">4.2.1 å¼å¸¸å¯¹è±¡çåå­å¸å±</h3>
<pre><code class="language-csharp">// Exceptionç±»çç®ååå­å¸å±
class Exception
{
    // å¯¹è±¡å¤´ï¼8-16å­èï¼
    MethodTable* _methodTable;  // 8å­è
    // åæ­¥åç´¢å¼ï¼å¯éï¼
    
    // å®ä¾å­æ®µ
    string _message;           // 8å­èï¼å¼ç¨ï¼
    IDictionary _data;         // 8å­èï¼éå¸¸ä¸ºnullï¼
    Exception _innerException; // 8å­è
    string _helpURL;          // 8å­è
    string _source;           // 8å­è
    string _stackTrace;       // 8å­èï¼å­ç¬¦ä¸²ï¼å®éåéæ´å¤§ï¼
    object _stackTraceString; // 8å­èï¼å¯è½ä¸åæ ¼å¼ï¼
    object _remoteStackTrace; // 8å­è
    int _remoteStackIndex;    // 4å­è
    int _HResult;             // 4å­è
    
    // æ»å±ï¼è³å°80å­èï¼64ä½ç³»ç»ï¼
    // å ä¸å­ç¬¦ä¸²åå®¹ï¼å¯è½æ°ç¾å°æ°åå­è
}
</code></pre>
<h3 id="422-gcçå½±å">4.2.2 GCçå½±å</h3>
<pre><code class="language-csharp">// é«é¢æåºå¼å¸¸ä¼æ¾èå½±åGC
public void TestExceptionGC()
{
    var list = new List&lt;Exception&gt;();
    
    for (int i = 0; i &lt; 10000; i++)
    {
        try
        {
            throw new Exception($"Error {i}");
        }
        catch (Exception ex)
        {
            list.Add(ex);  // å¤§éå¯¹è±¡è¿å¥ç¬¬0ä»£å 
        }
    }
}

</code></pre>
<p>ä¸è¿°ä»£ç ä¼å¯¼è´:</p>
<ul>
<li>è§¦åé¢ç¹çGen0 GC</li>
<li>å¦æexè¢«é¿æ¶é´å¼ç¨ï¼å¯è½è¿å¥Gen1/Gen2</li>
<li>å¢å GCæåæ¶é´</li>
<li>éä½ç¼å­å±é¨æ§</li>
</ul>
<h2 id="43-cpuçº§å«çæ§è½å½±å">4.3 CPUçº§å«çæ§è½å½±å</h2>
<h3 id="431-ç°ä»£cpuçå¼å¸¸å¤çå¼é">4.3.1 ç°ä»£CPUçå¼å¸¸å¤çå¼é</h3>
<pre><code class="language-assembly">; x64æ±ç¼å±é¢çå¼å¸¸å¤ç
; æ­£å¸¸è·¯å¾ï¼
process_value:
    mov eax, [rcx]      ; å è½½å¼
    add eax, 100        ; è®¡ç®
    ret                 ; è¿å
    
; å¼å¸¸è·¯å¾ï¼
throw_exception:
    ; 1. ä¿å­ææå¯å­å¨å°å æ 
    push rbx
    push rbp
    push r12
    push r13
    push r14
    push r15
    sub rsp, 28h        ; åéå æ ç©ºé´
    
    ; 2. è°ç¨å¼å¸¸æé å½æ°
    call Exception..ctor
    
    ; 3. è®¾ç½®SEHï¼ç»æåå¼å¸¸å¤çï¼
    mov [rsp+20h], rcx  ; ä¿å­å¼å¸¸å¯¹è±¡
    call __CxxThrowException@8
    
    ; 4. æ¸çå æ 
    add rsp, 28h
    pop r15
    pop r14
    pop r13
    pop r12
    pop rbp
    pop rbx
</code></pre>
<p>CPUå±é¢çé®é¢:</p>
<ul>
<li><strong>åæ¯é¢æµå¤±è´¥</strong>ï¼å¼å¸¸è·¯å¾å¾å°æ§è¡ï¼CPUåæ¯é¢æµå¨é¾ä»¥ä¼å</li>
<li><strong>ç¼å­å¤±æ</strong>ï¼å¼å¸¸å¤çä»£ç éå¸¸ä¸å¨æä»¤ç¼å­ä¸­</li>
<li><strong>æµæ°´çº¿åé¡¿</strong>ï¼å¼å¸¸å¤çéè¦ä¿å­/æ¢å¤å¤§éå¯å­å¨ç¶æ</li>
<li><strong>åå­è®¿é®æ¨¡å¼å·®</strong>ï¼EHè¡¨æ¥æ¾å¯¼è´éæºåå­è®¿é®</li>
</ul>
<h3 id="432-å¯¹æ¯æ­£å¸¸è¿ååå¼å¸¸è¿å">4.3.2 å¯¹æ¯æ­£å¸¸è¿ååå¼å¸¸è¿å</h3>
<pre><code class="language-csharp">// Result&lt;T&gt;çæ­£å¸¸è¿åè·¯å¾
return Result&lt;User&gt;.Fail("ç¨æ·ä¸å­å¨");
// æ±ç¼ï¼
; 1. æé Resultå¯¹è±¡ï¼å¯è½å¨æ ä¸ï¼
; 2. è®¾ç½®Success=false
; 3. è®¾ç½®Errorå­æ®µ
; 4. è¿åï¼æ®éretæä»¤ï¼

// å¼å¸¸è¿åè·¯å¾
throw new BusinessException("ç¨æ·ä¸å­å¨");
// æ±ç¼ï¼
; 1. å åéå¼å¸¸å¯¹è±¡
; 2. æè·å æ è·è¸ª
; 3. è®¾ç½®SEHå¸§
; 4. è°ç¨kernel32!RaiseException
; 5. å æ å±å¼
; 6. æ¥æ¾catchå
; 7. æ§è¡catchåä»£ç 
</code></pre>
<h2 id="44-å¯¹æ¯å¶ä»ç¼ç¨è¯­è¨">4.4 å¯¹æ¯å¶ä»ç¼ç¨è¯­è¨</h2>
<h3 id="441-javaçå¼å¸¸æºå¶">4.4.1 Javaçå¼å¸¸æºå¶</h3>
<pre><code class="language-java">// Javaçå¼å¸¸ä½¿ç¨çèµ·æ¥åC#ç¸ä¼¼
public User login(String username, String password) 
    throws UserNotFoundException, InvalidPasswordException
{
    User user = findUser(username);
    if (user == null) {
        throw new UserNotFoundException("ç¨æ·ä¸å­å¨");
    }
    if (!verifyPassword(user, password)) {
        throw new InvalidPasswordException("å¯ç éè¯¯");
    }
    return user;
}
</code></pre>
<p>Javaå¼å¸¸çç¹ç¹ï¼<br>
1.æ£æ¥åå¼å¸¸ï¼Checked Exceptionï¼ï¼å¼ºå¶å¤çæå£°æ<br>
2.æ§è½å¼éä¸C#ç±»ä¼¼ï¼åæ ·éè¦æè·å æ è·è¸ª<br>
3.JVMçä¼åï¼HotSpot JVMææ´æççå¼å¸¸ä¼å:</p>
<ul>
<li>åèç¼å­ï¼Inline Cacheï¼</li>
<li>æ ä¸æ¿æ¢ï¼On-Stack Replacementï¼</li>
<li>ä½ä¸å¡å¼å¸¸ä»ç¶æè´µ</li>
</ul>
<p><strong>éè¦åºå«ï¼</strong></p>
<pre><code class="language-java">// Java 14+å¼å¥äºRecordsï¼ä½å¼å¸¸å¼éä¾æ§
public record Result&lt;T&gt;(T value, String error) {
    public boolean isSuccess() { return error == null; }
}

// Javaç¤¾åºä¹å¨è½¬åResultæ¨¡å¼ï¼ç¹å«æ¯ååºå¼ç¼ç¨
public Mono&lt;User&gt; login(String username, String password) {
    return Mono.fromCallable(() -&gt; findUser(username))
        .switchIfEmpty(Mono.error(new UserNotFoundException()))
        .filter(user -&gt; verifyPassword(user, password))
        .switchIfEmpty(Mono.error(new InvalidPasswordException()));
}
</code></pre>
<h3 id="442-goçéè¯¯å¤çå²å­¦">4.4.2 Goçéè¯¯å¤çå²å­¦</h3>
<pre><code class="language-go">// Goçéè¯¯å¤çï¼æ¾å¼è¿åéè¯¯
func Login(username, password string) (*User, error) {
    user, err := findUser(username)
    if err != nil {
        return nil, fmt.Errorf("æ¥æ¾ç¨æ·å¤±è´¥: %w", err)
    }
    
    if !verifyPassword(user, password) {
        return nil, errors.New("å¯ç éè¯¯")
    }
    
    return user, nil
}

// è°ç¨æ¹å¿é¡»æ¾å¼å¤çéè¯¯
user, err := Login("test", "123")
if err != nil {
    // å¤çéè¯¯
    switch {
    case strings.Contains(err.Error(), "å¯ç éè¯¯"):
        // ç¹å®å¤ç
    default:
        // éç¨å¤ç
    }
}
</code></pre>
<p>Goçè®¾è®¡éæ©ï¼</p>
<ul>
<li><strong>æ²¡æå¼å¸¸æºå¶</strong>ï¼åªæéè¯¯è¿åå¼</li>
<li><strong>éè¯¯æ¯å¼ï¼errors are valuesï¼</strong>ï¼å¯ä»¥åæ®éå¼ä¸æ ·ä¼ é</li>
<li><strong>å¼ºå¶æ¾å¼å¤ç</strong>ï¼æ æ³å¿½ç¥éè¯¯ï¼é¤éä½¿ç¨_ï¼</li>
<li><strong>é¶ææ¬æ½è±¡</strong>ï¼éè¯¯å¤çå ä¹æ²¡æè¿è¡æ¶å¼é</li>
</ul>
<p>Goçéè¯¯æ§è½ä¼å¿:</p>
<pre><code class="language-go">// Goçerrors.Newå®éä¸å¾ç®å
func New(text string) error {
    return &amp;errorString{text}
}

type errorString struct {
    s string
}

func (e *errorString) Error() string {
    return e.s
}

// æ²¡æå æ è·è¸ªï¼æ²¡æå¤ææé 
// åªæ¯ä¸ä¸ªåå«å­ç¬¦ä¸²çç»æä½
</code></pre>
<h3 id="443-rustçresultç±»å">4.4.3 RustçResultç±»å</h3>
<pre><code class="language-rust">// Rustçéè¯¯å¤çï¼åºäºæä¸¾çResult
fn login(username: &amp;str, password: &amp;str) -&gt; Result&lt;User, LoginError&gt; {
    let user = find_user(username)?;  // ?æä½ç¬¦èªå¨ä¼ æ­éè¯¯
    
    if !verify_password(&amp;user, password) {
        return Err(LoginError::InvalidPassword);
    }
    
    Ok(user)
}

// éè¯¯ç±»åå®ä¹
#[derive(Debug)]
enum LoginError {
    UserNotFound,
    InvalidPassword,
    DatabaseError(DbError),
}

// ä½¿ç¨matchå¤ç
match login("test", "123") {
    Ok(user) =&gt; println!("æ¬¢è¿ {}", user.name),
    Err(LoginError::UserNotFound) =&gt; println!("ç¨æ·ä¸å­å¨"),
    Err(LoginError::InvalidPassword) =&gt; println!("å¯ç éè¯¯"),
    Err(e) =&gt; println!("å¶ä»éè¯¯: {:?}", e),
}
</code></pre>
<p>Rustçè®¾è®¡ç¹ç¹:</p>
<ul>
<li>é¶ææ¬æ½è±¡ï¼Resultå¨è¿è¡æ¶éå¸¸æ¯æ®éæä¸¾</li>
<li>æ¨¡å¼å¹éï¼ç¼è¯å¨ç¡®ä¿æææåµé½è¢«å¤ç</li>
<li>éè¯¯ä¼ æ­è¿ç®ç¬¦ï¼?ï¼ï¼ç®åéè¯¯ä¼ æ­</li>
<li>ä¸°å¯çéè¯¯åºï¼anyhowãthiserrorç­</li>
</ul>
<p>Rustçæ§è½ä¼å¿ï¼</p>
<pre><code>ç¼è¯åçResultéå¸¸ä¼åä¸ºï¼
1.æåï¼å­å¨User
2.å¤±è´¥ï¼å­å¨éè¯¯ç ï¼éå¸¸æ¯æ´æ°ï¼
3.æ²¡æå åéï¼æ²¡æèå½æ°è°ç¨
</code></pre>
<h3 id="444-cçéè¯¯å¤ç">4.4.4 C++çéè¯¯å¤ç</h3>
<pre><code class="language-cpp">// C++çå¤ç§éè¯¯å¤çæ¹å¼

// 1. å¼å¸¸ï¼ç±»ä¼¼C#/Javaï¼
User login(const std::string&amp; username, const std::string&amp; password) {
    auto user = find_user(username);
    if (!user) {
        throw UserNotFoundException("ç¨æ·ä¸å­å¨");
    }
    if (!verify_password(*user, password)) {
        throw InvalidPasswordException("å¯ç éè¯¯");
    }
    return *user;
}

// 2. éè¯¯ç ï¼ä¼ ç»æ¹å¼ï¼
int login(const std::string&amp; username, 
          const std::string&amp; password,
          User&amp; out_user) {
    User user;
    int err = find_user(username, user);
    if (err != 0) return err;
    
    if (!verify_password(user, password)) {
        return ERROR_INVALID_PASSWORD;
    }
    
    out_user = user;
    return 0;  // æå
}

// 3. std::expectedï¼C++23ï¼
std::expected&lt;User, Error&gt; login(const std::string&amp; username,
                                 const std::string&amp; password) {
    auto user = find_user(username);
    if (!user) {
        return std::unexpected(Error::UserNotFound);
    }
    if (!verify_password(*user, password)) {
        return std::unexpected(Error::InvalidPassword);
    }
    return *user;
}
</code></pre>
<p>C++çéæ©ï¼</p>
<ul>
<li>æ¸¸æååµå¥å¼ï¼éå¸¸ç¦ç¨å¼å¸¸ï¼ä½¿ç¨éè¯¯ç </li>
<li>æ§è½ææåºç¨ï¼é¿åå¼å¸¸ï¼å ä¸ºé¶å¼éåå</li>
<li>ç°ä»£C++ï¼å¾åäºstd::expectedç­ç±»åå®å¨æ¹æ¡</li>
</ul>
<h2 id="45-net-coreçæ¹è¿åå±é">4.5 .NET Coreçæ¹è¿åå±é</h2>
<p>.Net 8.0çæ¬ï¼å®æ¹å¢ééå¯¹å¼å¸¸å¤çè¿åè¿è¡äºå¤§å¹çä¼åï¼åæ¬é¢åéå¼å¸¸å¯¹è±¡ï¼PREallocated Exceptionï¼ãå»¶è¿å æ è·è¸ªçæï¼Lazy Stack Traceï¼ãå æ è·è¸ªç¼å­åå¤ç¨ãæ°çå æ è·è¸ªç®æ³ç­å¤ç§ææ®µï¼åæ¶ä¹å¯¹JITåRunTimeè¿è¡äºéå¯¹æ§ä¼åãä½æ¯ç®åæ¥çï¼ä¾æ§è¿æå¾å¤§çæåç©ºé´ã<br>
è¯¦æè¯·è§å®æ¹å¢éçåå®¢ï¼<a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/#exception-handling" target="_blank" rel="noopener nofollow">https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/#exception-handling</a></p>
<pre><code class="language-csharp">// .NET 8.0 å¯¹åæ°å¼å¸¸çç¹æ®ä¼å
public void ValidateUser(string username, int age)
{
    // è¿äºè°ç¨å¨ .NET 8.0 ä¸­éå¸¸é«æ
    ArgumentNullException.ThrowIfNull(username);
    ArgumentOutOfRangeException.ThrowIfNegative(age);
    ArgumentException.ThrowIfNullOrEmpty(username);
    
    // ä½æ³¨æï¼ä¸å¡å¼å¸¸ä¸å¨æ­¤ä¼åèå´åï¼
    if (!IsValidUsername(username))
        throw new BusinessException("æ æç¨æ·å"); // ä»£ä»·ä»ç¶æè´µ
}
</code></pre>
<h1 id="äºresultçè¿é¶ä¼å¿">äºãResult<t>çè¿é¶ä¼å¿</t></h1>
<h2 id="51-ä¸°å¯çéè¯¯ä¿¡æ¯">5.1 ä¸°å¯çéè¯¯ä¿¡æ¯</h2>
<pre><code class="language-csharp">public class Result&lt;T&gt;
{
    public bool Success { get; }
    public T? Value { get; }
    public string ErrorCode { get; }    // éè¯¯ä»£ç 
    public string ErrorMessage { get; } // éè¯¯æ¶æ¯
    public Dictionary&lt;string, object&gt; Metadata { get; } // éå ä¿¡æ¯
}

// ä½¿ç¨ï¼
var result = Login("test", "wrong");
if (!result.Success)
{
    switch (result.ErrorCode)
    {
        case "USER_NOT_FOUND":
            // ç¨æ·ä¸å­å¨ï¼è·³è½¬æ³¨åé¡µé¢
            break;
        case "INVALID_PASSWORD":
            // å¯ç éè¯¯ï¼æ¾ç¤ºæç¤º
            break;
        case "ACCOUNT_LOCKED":
            // è´¦æ·éå®ï¼æ¾ç¤ºéå®æ¶é´
            var lockTime = result.Metadata["LockUntil"];
            break;
    }
}
</code></pre>
<h2 id="52-å½æ°å¼ç¼ç¨æ¯æ">5.2 å½æ°å¼ç¼ç¨æ¯æ</h2>
<pre><code class="language-csharp">// Map - è½¬æ¢æåçå¼
var userResult = GetUser(123);
var userName = userResult.Map(user =&gt; user.Name.ToUpper());

// Bind - é¾å¼æä½
var orderResult = GetUser(123)
    .Bind(user =&gt; GetOrder(user.CurrentOrderId))
    .Bind(order =&gt; ValidateOrder(order));

// Match - æ¨¡å¼å¹é
var message = loginResult.Match(
    success: user =&gt; $"æ¬¢è¿åæ¥ï¼{user.Name}!",
    failure: error =&gt; $"ç»å½å¤±è´¥: {error.Message}"
);
</code></pre>
<h2 id="53-æ´å¥½çapiè®¾è®¡">5.3 æ´å¥½çAPIè®¾è®¡</h2>
<pre><code class="language-csharp">// Web APIä¸­çä½¿ç¨
[HttpPost("login")]
public IActionResult Login([FromBody] LoginRequest request)
{
    var result = _authService.Login(request);
    
    return result.Match&lt;IActionResult&gt;(
        success: user =&gt; Ok(new { success = true, user }),
        failure: error =&gt; BadRequest(new { 
            success = false, 
            errorCode = error.Code,
            message = error.Message 
        })
    );
}

// å®¢æ·ç«¯è·å¾æ¸æ°çååºï¼
// æå: { success: true, user: { ... } }
// å¤±è´¥: { success: false, errorCode: "INVALID_PASSWORD", message: "å¯ç éè¯¯" }
</code></pre>
<h1 id="å­-resultæ¨¡å¼çä¸äºå¼ç«¯">å­ã Result<t>æ¨¡å¼çä¸äºå¼ç«¯</t></h1>
<h2 id="61-ifå°ç±é®é¢æ¡ä»¶å¤æ­æ³æ»¥">6.1 "ifå°ç±"é®é¢ï¼æ¡ä»¶å¤æ­æ³æ»¥ï¼</h2>
<p>æå¸¸è¢«è¯ççé®é¢ï¼å°±æ¯ä»£ç ä¸­åæ¥å¤§éç if (!result.Success) æ£æ¥ã</p>
<pre><code class="language-csharp">// "ifå°ç±"çå¸åä¾å­
public Result&lt;Order&gt; ProcessOrder(int userId, OrderRequest request)
{
    var userResult = GetUser(userId);
    if (!userResult.Success)
        return Result&lt;Order&gt;.Fail(userResult.Error);
    
    var validationResult = ValidateOrder(request);
    if (!validationResult.Success)
        return Result&lt;Order&gt;.Fail(validationResult.Error);
    
    var inventoryResult = CheckInventory(request.Items);
    if (!inventoryResult.Success)  
        return Result&lt;Order&gt;.Fail(inventoryResult.Error);
    
    var paymentResult = ProcessPayment(userResult.Value, request);
    if (!paymentResult.Success)
        return Result&lt;Order&gt;.Fail(paymentResult.Error);
    
    // ... æ´å¤æ£æ¥
}
</code></pre>
<p>è¿ä¸ªé®é¢ï¼ä½¿ç¨å½æ°å¼ç¼ç¨ææ³å¯ä»¥å·§å¦è§£å³ï¼è¿ä¸åJAVAåççå¿æºä¸éçã</p>
<pre><code class="language-csharp">// ä½¿ç¨ Railway-Oriented Programming
public Result&lt;Order&gt; ProcessOrder(int userId, OrderRequest request)
{
    return GetUser(userId)
        .Bind(user =&gt; ValidateOrder(request)
            .Bind(validated =&gt; CheckInventory(request.Items)
                .Bind(inventory =&gt; ProcessPayment(user, request)
                    .Map(payment =&gt; CreateOrder(user, validated, payment)))));
}

// æèä½¿ç¨æ©å±æ¹æ³
public Result&lt;Order&gt; ProcessOrder(int userId, OrderRequest request)
{
    return GetUser(userId)
        .Then(user =&gt; ValidateOrder(request))
        .Then(validated =&gt; CheckInventory(request.Items))
        .Then(inventory =&gt; ProcessPayment(user, request))
        .Map(payment =&gt; CreateOrder(user, validated, payment));
}
</code></pre>
<h2 id="62-å¼ç±»åstructvs-å¼ç¨ç±»åclassçä¸¤é¾éæ©">6.2 å¼ç±»åï¼structï¼vs å¼ç¨ç±»åï¼classï¼çä¸¤é¾éæ©</h2>
<pre><code class="language-csharp">public readonly struct Result&lt;T&gt;  // å¼ç±»å
{
    private readonly T? _value;
    private readonly string? _error;
    
    // é®é¢1ï¼Tæ¯å¼ç¨ç±»åæ¶ï¼structå­å¨çæ¯å¼ç¨
    // é®é¢2ï¼structå¤å¶å¼éï¼å¦æTæ¯å¤§å¯¹è±¡ï¼
    // é®é¢3ï¼è£ç®±/æç®±å¼é
    // é®é¢4ï¼ä¸è½ä¸ºnullï¼éè¦é¢å¤ç¶ææ è®°
}

public class Result&lt;T&gt;  // å¼ç¨ç±»å
{
    // é®é¢ï¼æ¯ä¸ªResulté½æ¯å åéï¼å¢å GCåå
    // å³ä½¿æåæåµä¹è¦åéå¯¹è±¡
}

</code></pre>
<p>æä¸­æ¹æ¡ï¼éå¯¹å¼ç±»ååå¼ç¨ç±»ååå«ä¼åï¼éå¯¹éç¨çResultå¯¹è±¡è¿è¡ç¼å­åå¤ç¨ã</p>
<pre><code class="language-csharp">/// &lt;summary&gt;
/// ç»æåºç±»
/// &lt;/summary&gt;
/// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;
public abstract class Result&lt;T&gt;
{
    /// &lt;summary&gt;
    /// æ¯å¦æå
    /// &lt;/summary&gt;
    public abstract bool IsSuccess { get; }
    /// &lt;summary&gt;
    /// å·ä½è¿åå¼ï¼æåæ¶ææï¼
    /// &lt;/summary&gt;
    public abstract T? Value { get; }
    /// &lt;summary&gt;
    /// éè¯¯ç 
    /// &lt;/summary&gt;
    public abstract string? ErrorCode { get; }
    /// &lt;summary&gt;
    /// éè¯¯ä¿¡æ¯
    /// &lt;/summary&gt;
    public abstract string? ErrorMessage { get; }
  
    // ç¼å­åä¾æåï¼ä»éå¯¹ default(T)ï¼
    private static readonly ConcurrentDictionary&lt;Type, Result&lt;T&gt;&gt; _successCache = new();
    //åªæ errorCode ç¼å­ï¼é¿åæ message æ éå¢é¿ï¼
    private static readonly ConcurrentDictionary&lt;string, Result&lt;T&gt;&gt; _errorCache = new();  
} 

/// &lt;summary&gt;
/// ä»ç¨äºæ§è½å³é®è·¯å¾ï¼ä¸å­å¨å¤§å¯¹è±¡
/// &lt;/summary&gt;
/// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;
public readonly ref struct ValueResult&lt;T&gt; where T : struct
{
  //çç¥
}

 /// &lt;summary&gt;
 /// å¼ç¨ç±»åç»æï¼ä»ç¨äºæ§è½å³é®è·¯å¾
 /// &lt;/summary&gt;
 /// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;
 public readonly ref struct RefResult&lt;T&gt; where T : class
{
 //çç¥
}
</code></pre>
<h2 id="63-å¼æ­¥ç¼ç¨çå¤ææ§">6.3 å¼æ­¥ç¼ç¨çå¤ææ§</h2>
<p>å¨å¼æ­¥ç¼ç¨ä¸­ï¼å¯è½æ¯ä¸ªå¼æ­¥æä½é½éè¦å¤çResultï¼è¿ä¹å¤§å¤§å¢å äºä»£ç å¤æåº¦ï¼å¶å®ä¹å±äºä¸é¢è¯´çâif å°ç±âèç´ã</p>
<pre><code class="language-csharp">public async Task&lt;Result&lt;User&gt;&gt; LoginAsync(string username, string password)
{
    // æ¯ä¸ªå¼æ­¥æä½é½éè¦å¤çResult
    var userResult = await FindUserAsync(username);
    if (!userResult.Success)
        return Result&lt;User&gt;.Fail(userResult.Error);
    
    var validationResult = await ValidatePasswordAsync(userResult.Value, password);
    if (!validationResult.Success)
        return Result&lt;User&gt;.Fail(validationResult.Error);
    
    return Result&lt;User&gt;.Ok(userResult.Value);
}

// å¯¹æ¯å¼å¸¸çæ¬ï¼
public async Task&lt;User&gt; LoginAsync(string username, string password)
{
    var user = await FindUserAsync(username);  // æå¼å¸¸åç´æ¥ä¸­æ­åç»­é»è¾
    await ValidatePasswordAsync(user, password); // æå¼å¸¸åç´æ¥ä¸­æ­åç»­é»è¾
    return user;
}
</code></pre>
<h2 id="64-ç±»åç³»ç»åé¿">6.4 ç±»åç³»ç»åé¿</h2>
<p>æ¯ä¸ä¸ªæ¥å£æ¹æ³é½è¦åè£¹Result,åå ä¸å¼æ­¥çTask,åé¡µè¯·æ±ç»ææ¨¡åPagedResultï¼åå ä¸ç¹å¶ä»ä¸è¥¿ï¼å°±ä¼åºç°ä»¤äººå¤´ç®åéº»çæ³ååæ°çç¸&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;ã<br>
ä¸é¢çä»£ç ï¼æ¯é¡¹ç®éé¢ççå®ä»£ç </p>
<pre><code class="language-csharp">     /// &lt;summary&gt;
    /// åå·¥ä¸å¡æå¡æ¥å£
    /// &lt;/summary&gt;
    public interface IEmployeeService
    {
        Task&lt;Result&lt;long&gt;&gt; CreateAsync(CreateEmployeeDto dto);
        Task&lt;Result&lt;EmployeeDto&gt;&gt; GetByIdAsync(long id);
        Task&lt;Result&gt; UpdateAsync(UpdateEmployeeDto dto);
        Task&lt;Result&gt; DeleteAsync(long id);
        Task&lt;Result&lt;PagedResult&lt;EmployeeDto&gt;&gt;&gt; GetPageListAsync(EmployeePageListDto dto);
        Task&lt;Result&lt;List&lt;EmployeeDto&gt;&gt;&gt; GetListAsync(string? keyword = null);
        Task&lt;Result&lt;Dictionary&lt;string,long&gt;&gt;&gt; GetEmployeeAliases(List&lt;long&gt;? employeeIds = null, bool includeShowName = true);
    }
</code></pre>
<h2 id="65-å¶ä»é®é¢">6.5 å¶ä»é®é¢</h2>
<p>å½ç¶ï¼è¿ç§æ¨¡å¼è¿æä¸äºå¶ä»çé®é¢ï¼æ¯å¦å¢éæåçæ¥ååº¦ï¼å¢éå­¦ä¹ ææ¬ï¼ä¸ç°æä»£ç /çæçå¼å®¹æ§ï¼ä¸ç¬¬ä¸æ¹åçå¼å®¹æ§ç­ï¼è¿éå°±ä¸ä¸ä¸è¯´æäºã</p>
<h1 id="ä¸å¸¸è§é®é¢ä¸ç­ç">ä¸ãå¸¸è§é®é¢ä¸ç­ç</h1>
<p><strong>Qï¼å¼å¸¸ä¸æ¯æ´æ¹ä¾¿åï¼ä¸è¡ä»£ç å°±è½ä¸­æ­æµç¨</strong><br>
Aï¼æ¹ä¾¿ä¸ç­äºæ­£ç¡®ãgotoè¯­å¥ä¹å¾"æ¹ä¾¿"ï¼ä½ç°ä»£ç¼ç¨ä¸­æä»¬é¿åä½¿ç¨å®ãå¼å¸¸å¨ä¸å¡é»è¾ä¸­å°±æ¯"è¿ç¨goto"ï¼ç ´åäºä»£ç çå¯è¯»æ§åå¯ç»´æ¤æ§ã</p>
<p><strong>Qï¼Result<t>éè¦æ´å¤çifå¤æ­ï¼ä»£ç æ´åé¿</t></strong></p>
<pre><code class="language-csharp">// ç®æ´çå¤çæ¹å¼
var result = Login("test", "123");
if (!result.Success) return result;

// æèä½¿ç¨æ¨¡å¼å¹é
var message = result switch
{
    { Success: true, Value: var user } =&gt; $"æ¬¢è¿ {user.Name}",
    { Error: var error } =&gt; $"éè¯¯: {error}",
    _ =&gt; "æªç¥ç¶æ"
};
</code></pre>
<p><strong>Qï¼æä»¬çé¡¹ç®å¾å°ï¼æ§è½å½±åä¸å¤§</strong><br>
A:å³ä½¿ä¸èèæ§è½ï¼ä»ä»£ç è´¨éåç»´æ¤æ§è§åº¦ï¼Result<t>ä¹æ¯æ´å¥½çéæ©ãå¥½çä¹ æ¯åºè¯¥ä»é¡¹ç®åæå°±å¼å§å¹å»ã</t></p>
<h1 id="å«æ»ç»">å«ãæ»ç»</h1>
<p>Result<t> ä¸æ¯é¶å¼¹ï¼å®æå®éç¨çåºæ¯ï¼ä¹æç¸åºçä¸äºå¼ç«¯ãéæ©çå³é®ä¸å¨äºåªä¸ª"æ´å¥½"ï¼èå¨äºåªä¸ª"æ´éå"å½åçåºæ¯åçº¦æãææºçå·¥ç¨å¸ä¼æ ¹æ®å·ä½æåµååºå¹³è¡¡çéæ©ã<br>
éåä½¿ç¨ Result<t> çåºæ¯ï¼</t></t></p>
<ul>
<li>é«é¢å¤±è´¥çæ ¡éªé»è¾ï¼è¡¨åéªè¯ãä¸å¡è§åæ£æ¥ï¼</li>
<li>éè¦æç¡®éè¯¯åç±»çä¸å¡æµç¨</li>
<li>APIè¾¹çï¼éè¦ç»æåéè¯¯ååºï¼</li>
<li>ä¸å¤é¨ç³»ç»äº¤äºï¼éè¦å¤çåç§å¤±è´¥æ¨¡å¼ï¼</li>
<li>éè¦ç»åçå¤æä¸å¡é»è¾</li>
</ul>
<p>ä»ç¶éåä½¿ç¨å¼å¸¸çåºæ¯ï¼</p>
<ul>
<li>çæ­£çç³»ç»æéï¼åå­ä¸è¶³ãæ°æ®åºå´©æºï¼</li>
<li>ç¨åºç¶æå¼å¸¸ï¼ç©ºå¼ç¨ãç´¢å¼è¶çï¼</li>
<li>ä¸æ»¡è¶³åç½®æ¡ä»¶ï¼æ æåæ°ï¼</li>
<li>å¼åé¶æ®µçæ­è¨æ£æ¥</li>
<li>æä½å¤±è´¥ççæä½</li>
</ul>
<p>å³é®å»ºè®®ï¼</p>
<ul>
<li>ä¸è¦å¨çæ¿æ¢ï¼Resultåå¼å¸¸åæéç¨åºæ¯</li>
<li>åå±è®¾è®¡ï¼ä¸åæ¶æå±ä½¿ç¨ä¸åç­ç¥</li>
<li>å¢éå±è¯ï¼å»ºç«æç¡®çè§èåè¾¹ç</li>
<li>æ¸è¿éç¨ï¼ä»æ ¸å¿ä¸å¡å¼å§ï¼éæ­¥æ©å±</li>
<li>çæ§åé¦ï¼éè¿æ¥å¿åçæ§éªè¯éæ©</li>
</ul>
<p>æç»ååï¼</p>
<ul>
<li>å¼å¸¸ï¼ç¨äº"ä¸åºè¯¥åç"çäºæ</li>
<li>Resultï¼ç¨äº"å¯è½åçä½éè¦å¤ç"çäºæ</li>
</ul>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.002777777777777778" data-date-updated="2026-01-20 19:44">2026-01-20 19:40</span>&nbsp;
<a href="https://www.cnblogs.com/diamondhusky">åèåå£«å¥</a>&nbsp;
éè¯»(<span id="post_view_count">156</span>)&nbsp;
è¯è®º(<span id="post_comment_count">4</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508626);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508626', targetLink: 'https://www.cnblogs.com/diamondhusky/p/19508626', title: 'åå« throw exceptionï¼ä¸ºä»ä¹ Result&amp;lt;T&amp;gt; ææ¯ä¸å¡é»è¾çæ­£ç¡®éæ©' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ å¹²è´§æ»¡æ»¡ï¼Redis åå¸å¼éå¿é¿ç 8 å¤§é®é¢åè§£å³æ¹æ¡ ]]></title>
    <link>https://www.cnblogs.com/sun-10387834/p/19493006</link>
    <guid>436793609d4e4f231f04487dd8708f85</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sun-10387834/p/19493006" title="åå¸äº 2026-01-20 19:23">
    <span role="heading" aria-level="2">å¹²è´§æ»¡æ»¡ï¼Redis åå¸å¼éå¿é¿ç 8 å¤§é®é¢åè§£å³æ¹æ¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>å¨åå¸å¼ç³»ç»ä¸­ï¼Redis åå¸å¼éè½è½é«æè§£å³è·¨æå¡å¹¶åå²çªï¼ä½å®éè½å°æ¶ç¨ä¸æ³¨æå°±ä¼è¸©åââå°å°æ°æ®ä¸ä¸è´ï¼å¤§å°æå¡éªå´©ï¼è¿äºé®é¢å¤æºäºå¯¹ Redis ç¹æ§ãåå¸å¼åºæ¯å¤ææ§çèèä¸å¨ãä¹åå¼åçµååºå­åè®¢åç³»ç»æ¶ï¼å°±å å¿½è§äºéè¿æãèè£ç­é®é¢ï¼åååºç°è¿è¶åãéå¤±æç­æéãä»å¤©ç»åçäº§å®æç»éªï¼æ¢³ç Redis å®ç°åå¸å¼éæ¶ææéå°ç 8 å¤§é®é¢ï¼éä¸æè§£æå ãè¡¨ç°åæ ¹æ²»æ¹æ¡ï¼å¸®å¤§å®¶é¿å¼è¿äºâéå½¢ç¸å¼¹âã</p>
<p>åæç¡®åæï¼åå¸å¼éçæ ¸å¿æ¯âäºæ¥æ§âï¼ä½å¨åå¸å¼ç¯å¢ä¸ï¼ç½ç»å»¶è¿ãæå¡å®æºãRedis éç¾¤åæ­¥å»¶è¿ç­å ç´ ï¼é½ä¼ç ´åéçç¨³å®æ§ãææé®é¢çæ¬è´¨ï¼è¦ä¹æ¯âåå­æ§ç¼ºå¤±âï¼è¦ä¹æ¯âé«å¯ç¨èèä¸è¶³âï¼è¦ä¹æ¯âä¸å¡ä¸éæºå¶ä¸å¹éâã</p>
<h2 id="ä¸æ ¸å¿é®é¢åè§£å³æ¹æ¡æè¸©åé¢çæåº">ä¸ãæ ¸å¿é®é¢åè§£å³æ¹æ¡ï¼æè¸©åé¢çæåºï¼</h2>
<h3 id="é®é¢-1è¯¯å ä»äººææéæåºç¡ä¹ææç¯çæ¼æ´">é®é¢ 1ï¼è¯¯å ä»äººææéââæåºç¡ä¹ææç¯çæ¼æ´</h3>
<p><strong>æå </strong>ï¼éæ¾éæ¶æªåèº«ä»½æ ¡éªï¼ç´æ¥æ§è¡ DEL å½ä»¤å é¤é®ãå¸ååºæ¯ï¼æå¡ A ææéåï¼ä¸å¡é»è¾èæ¶è¶è¿éè¿ææ¶é´ï¼éè¢«èªå¨éæ¾ï¼æå¡ B è¶æºå éæåï¼æ­¤æ¶æå¡ A æ§è¡å®ä¸å¡ï¼ç´æ¥ DEL éå°±ä¼è¯¯å æå¡ B ææçéï¼å¯¼è´äºæ¥æ§å¤±æã</p>
<p><strong>è¡¨ç°</strong>ï¼å¤ä¸ªæå¡å®ä¾åæ¶ææåä¸æéï¼æä½åä¸èµæºï¼åºç°æ°æ®ä¸ä¸è´ï¼å¦è¶åãéå¤è®¢åï¼ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼å éæ¶å­å¥å¨å±å¯ä¸çéæºå¼ï¼å¦ UUID+çº¿ç¨ IDï¼ä½ä¸º valueï¼éæ¾éååéªè¯ value æ¯å¦ä¸èªèº«ææä¸è´ï¼ä¸è´æéæ¾ãå³é®æ¯ç¨ Lua èæ¬ä¿è¯âéªè¯+å é¤âçåå­æ§ï¼é¿åéªè¯åéè¿æè¢«ä»äººææã</p>
<pre><code class="language-lua">-- å®å¨éæ¾éç Lua èæ¬
if redis.call('get', KEYS[1]) == ARGV[1] then
    return redis.call('del', KEYS[1])
else
    return 0
end
</code></pre>
<p>æ³¨æï¼ä¸¥ç¦æåâéªè¯âåâå é¤âä¸ºä¸¤æ­¥æä½ï¼å¦åä»å­å¨å¹¶åæ¼æ´ã</p>
<h3 id="é®é¢-2éè¿ææåéæ¾ä¸å¡æªåå®éå·²å¤±æ">é®é¢ 2ï¼éè¿ææåéæ¾ââä¸å¡æªåå®éå·²å¤±æ</h3>
<p><strong>æå </strong>ï¼éçè¿ææ¶é´è®¾ç½®è¿ç­ï¼èä¸å¡é»è¾æ§è¡èæ¶è¿é¿ï¼å¯¼è´éå¨ä¸å¡å®æåå°±èªå¨è¿æéæ¾ï¼å¶ä»æå¡å¯è¶æºå éï¼å¼åå¹¶åå²çªãæ¯å¦éè®¾ä¸º 30 ç§è¿æï¼ä½æ°æ®åºå¤ææ¥è¯¢ãç¬¬ä¸æ¹æ¥å£è°ç¨èæ¶ 40 ç§ï¼å°±ä¼åºç°éæåå¤±æã</p>
<p><strong>è¡¨ç°</strong>ï¼ä¸å¡æ§è¡ä¸­éè¢«éæ¾ï¼å¤ä¸ªæå¡åæ¶æä½èµæºï¼åºç°æ°æ®éè¯¯ï¼ä¸é®é¢å·æéæºæ§ï¼åå³äºä¸å¡èæ¶æ¯å¦è¶è¿è¿ææ¶é´ï¼ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼å¼å¥âéç»­çº¦ï¼Watch Dogï¼âæºå¶ãæå¡æåå éåï¼å¯å¨åå°å®æ¤çº¿ç¨ï¼æ¯ééè¿ææ¶é´ç 1/3 ï¼å¦ 10 ç§ï¼æ£æ¥éæ¯å¦ä»è¢«èªèº«ææï¼è¥ææåå»¶é¿éçè¿ææ¶é´ï¼éç½®ä¸º 30 ç§ï¼ï¼ç´å°ä¸å¡å®æä¸»å¨éæ¾éã</p>
<p>å®éå¼åä¸­æ éæå¨å®ç°ï¼Redisson æ¡æ¶åç½® Watch Dog æºå¶ï¼å éåèªå¨ç»­çº¦ï¼å½»åºè§£å³éæåéæ¾é®é¢ã</p>
<h3 id="é®é¢-3redis-åç¹æééæå¡æ´ä½ä¸å¯ç¨">é®é¢ 3ï¼Redis åç¹æéââéæå¡æ´ä½ä¸å¯ç¨</h3>
<p><strong>æå </strong>ï¼Redis éç¨åç¹é¨ç½²ï¼å½ Redis æå¡å®æºï¼å¦è¿ç¨å´©æºãæå¡å¨æ­çµï¼ï¼ææåå¸å¼éçå éãéæ¾æä½é½ä¼å¤±è´¥ï¼å¯¼è´åå¸å¼ç³»ç»çå¹¶åæ§å¶æºå¶å´©æºï¼æ æ³æ­£å¸¸å¤çèµæºç«äºã</p>
<p><strong>è¡¨ç°</strong>ï¼ææä¾èµåå¸å¼éçä¸å¡æ¥å£æ¥éï¼æ æ³æ§è¡ï¼å¦åºå­æ£åãè®¢ååå»ºæ¥å£ï¼ï¼çè³å¼åæå¡éªå´©ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼éç¨ Redis é«å¯ç¨éç¾¤é¨ç½²ï¼ä¸¤ç§ä¸»æµæ¹æ¡æééæ©ï¼</p>
<ol>
<li>
<p><strong>ä¸»ä»å¤å¶ + å¨åµæ¨¡å¼</strong>ï¼é¨ç½² 1 ä¸»å¤ä» Redis éç¾¤ï¼å¨åµå®æ¶çæ§ä¸»èç¹ç¶æï¼ä¸»èç¹å®æºæ¶èªå¨å°ä»èç¹åæ¢ä¸ºä¸»èç¹ï¼ä¿è¯ Redis æå¡è¿ç»­æ§ãç¼ºç¹æ¯å­å¨âèè£âé£é©ï¼ä¸»ä»æ°æ®åæ­¥å»¶è¿å¯¼è´éä¸¢å¤±ï¼ï¼éåå¯¹ä¸è´æ§è¦æ±ä¸è¬çåºæ¯ã</p>
</li>
<li>
<p><strong>Redlock ç®æ³</strong>ï¼åè³å° 3 ä¸ªç¬ç«ç Redis ä¸»èç¹åèµ·å éè¯·æ±ï¼ä»å½è¶è¿åæ°èç¹å éæåï¼ä¸æ»èæ¶ä¸è¶è¿è¶æ¶æ¶é´ï¼æç®å éæåãå³ä½¿é¨åèç¹å®æºï¼åªè¦å¤æ°èç¹æ­£å¸¸ï¼éæå¡å°±å¯ç¨ï¼å½»åºé¿ååç¹æéåèè£é®é¢ï¼éåé«ä¸è´æ§åºæ¯ãRedisson å·²åç½® Redlock å®ç°ï¼å¼ç®±å³ç¨ï¼ä»¥ä¸æ¯å®æ´å®æéç½®ä¸ä»£ç ï¼</p>
</li>
</ol>
<h4 id="1-å¤ç»ç¬ç«-redis-èç¹éç½®yml">1. å¤ç»ç¬ç« Redis èç¹éç½®ï¼YMLï¼</h4>
<p>Redlock è¦æ±èç¹ç©çç¬ç«ï¼é¿ååä¸æºæ¿æéçµè¿å¤ç»èç¹ï¼ï¼æ¯ç»èç¹å¯åç¬é¨ç½²ä¸»ä»+å¨åµæåå¯ç¨æ§ï¼3 ç»èç¹å®æ´éç½®å¦ä¸ï¼</p>
<pre><code class="language-yaml">spring:
  redis:
    # Redlock ä¸ç¨å¤ç»ç¬ç«èç¹éç½®
    redlock:
      # ç¬¬ä¸ç»èç¹ï¼å¯é¨ç½²ä¸»ä»+å¨åµï¼
      node1:
        host: 192.168.1.101
        port: 6379
        password: 123456
        database: 0
        timeout: 5000  # è¿æ¥è¶æ¶æ¶é´ï¼æ¯«ç§ï¼
      # ç¬¬äºç»èç¹ï¼ç¬ç«æå¡å¨ï¼ä¸ç¬¬ä¸ç»æ å³èï¼
      node2:
        host: 192.168.1.102
        port: 6379
        password: 123456
        database: 0
        timeout: 5000
      # ç¬¬ä¸ç»èç¹ï¼ç¬ç«æå¡å¨ï¼å»ºè®®è·¨æºæ¿ï¼
      node3:
        host: 192.168.1.103
        port: 6379
        password: 123456
        database: 0
        timeout: 5000
</code></pre>
<h4 id="2-redisson-å®¢æ·ç«¯éç½®å¤èç¹å®ä¾å">2. Redisson å®¢æ·ç«¯éç½®ï¼å¤èç¹å®ä¾åï¼</h4>
<p>éè¿éç½®ç±»è¯»å YML ä¿¡æ¯ï¼åå»ºå¯¹åº RedissonClient å®ä¾ï¼ä¿è¯æ¯ç»èç¹ç¬ç«è¿æ¥ï¼</p>
<pre><code class="language-java">@Configuration
public class RedissonRedlockConfig {

    // ç¬¬ä¸ç» Redlock èç¹å®¢æ·ç«¯
    @Bean(name = "redlockClient1")
    public RedissonClient redlockClient1(
            @Value("${spring.redis.redlock.node1.host}") String host,
            @Value("${spring.redis.redlock.node1.port}") int port,
            @Value("${spring.redis.redlock.node1.password}") String password,
            @Value("${spring.redis.redlock.node1.database}") int database,
            @Value("${spring.redis.redlock.node1.timeout}") int timeout) {
        Config config = new Config();
        // åèç¹æ¨¡å¼ï¼è¥ä¸ºéç¾¤ï¼å¯æ¹ç¨ useSentinelServers éç½®å¨åµï¼
        config.useSingleServer()
                .setAddress("redis://" + host + ":" + port)
                .setPassword(password)
                .setDatabase(database)
                .setTimeout(timeout);
        return Redisson.create(config);
    }

    // ç¬¬äºç» Redlock èç¹å®¢æ·ç«¯
    @Bean(name = "redlockClient2")
    public RedissonClient redlockClient2(
            @Value("${spring.redis.redlock.node2.host}") String host,
            @Value("${spring.redis.redlock.node2.port}") int port,
            @Value("${spring.redis.redlock.node2.password}") String password,
            @Value("${spring.redis.redlock.node2.database}") int database,
            @Value("${spring.redis.redlock.node2.timeout}") int timeout) {
        Config config = new Config();
        config.useSingleServer()
                .setAddress("redis://" + host + ":" + port)
                .setPassword(password)
                .setDatabase(database)
                .setTimeout(timeout);
        return Redisson.create(config);
    }

    // ç¬¬ä¸ç» Redlock èç¹å®¢æ·ç«¯
    @Bean(name = "redlockClient3")
    public RedissonClient redlockClient3(
            @Value("${spring.redis.redlock.node3.host}") String host,
            @Value("${spring.redis.redlock.node3.port}") int port,
            @Value("${spring.redis.redlock.node3.password}") String password,
            @Value("${spring.redis.redlock.node3.database}") int database,
            @Value("${spring.redis.redlock.node3.timeout}") int timeout) {
        Config config = new Config();
        config.useSingleServer()
                .setAddress("redis://" + host + ":" + port)
                .setPassword(password)
                .setDatabase(database)
                .setTimeout(timeout);
        return Redisson.create(config);
    }
}
</code></pre>
<h4 id="3-redlock-å ééæ¾éä¸å¡ä»£ç ">3. Redlock å é/éæ¾éä¸å¡ä»£ç </h4>
<p>éè¿ RedissonRedLock ç»åå¤èç¹éï¼èªå¨è§¦åæç¥¨é»è¾ï¼å¼å®¹æ®ééç¨æ³ï¼åç½® Watch Dog ç»­çº¦ï¼</p>
<pre><code class="language-java">@Service
public class StockService {

    @Autowired
    @Qualifier("redlockClient1")
    private RedissonClient redlockClient1;

    @Autowired
    @Qualifier("redlockClient2")
    private RedissonClient redlockClient2;

    @Autowired
    @Qualifier("redlockClient3")
    private RedissonClient redlockClient3;

    @Autowired
    private StockMapper stockMapper;

    public void deductStock(Long productId) {
        // 1. çæç»ä¸éKeyï¼è·åå¤èç¹éå¯¹è±¡
        String lockKey = "lock:stock:" + productId;
        RLock lock1 = redlockClient1.getLock(lockKey);
        RLock lock2 = redlockClient2.getLock(lockKey);
        RLock lock3 = redlockClient3.getLock(lockKey);

        // 2. ç»åä¸ºRedlockéï¼è§¦åå¤èç¹æç¥¨
        RedissonRedLock redLock = new RedissonRedLock(lock1, lock2, lock3);

        try {
            // 3. å éï¼1ç§åç­å¾èç¹ååºï¼éè¿ææ¶é´30ç§ï¼åç½®ç»­çº¦ï¼
            boolean locked = redLock.tryLock(1000, 30000, TimeUnit.MILLISECONDS);
            if (locked) {
                // 4. æ ¸å¿ä¸å¡ï¼åºå­æ£åï¼ä»ä¿çéåå¿è¦æä½ï¼
                Stock stock = stockMapper.selectById(productId);
                if (stock != null &amp;&amp; stock.getCount() &gt; 0) {
                    stock.setCount(stock.getCount() - 1);
                    stockMapper.updateById(stock);
                }
            } else {
                // å éå¤±è´¥ååº
                throw new RuntimeException("ç³»ç»ç¹å¿ï¼è¯·ç¨ååè¯");
            }
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            throw new RuntimeException("æä½è¢«ä¸­æ­ï¼è¯·éè¯");
        } finally {
            // 5. å®å¨éæ¾éï¼ä»å½åçº¿ç¨ææéæ¶æ§è¡
            if (redLock.isHeldByCurrentThread()) {
                redLock.unlock();
            }
        }
    }
}
</code></pre>
<p>å³é®è¯´æï¼â  å¤ç»èç¹éç©çéç¦»ï¼è·¨æºæ¿é¨ç½²å¯æåå®¹éï¼â¡ 3 ç»èç¹æå¤åè®¸ 1 ç»æéï¼è¶è¿åæ°èç¹å éæåå³çæï¼â¢ éæ¾éæ¶èªå¨åæ­¥æ¸çææèç¹éæ°æ®ï¼æ éæå¨åè°ã</p>
<h3 id="é®é¢-4éæ æ³éå¥åµå¥ä¸å¡æ­»é">é®é¢ 4ï¼éæ æ³éå¥ââåµå¥ä¸å¡æ­»é</h3>
<p><strong>æå </strong>ï¼åºç¡å®ç°çéä¸æ¯æéå¥ï¼å³åä¸æå¡çåä¸çº¿ç¨å¨ææéçæåµä¸ï¼åæ¬¡è¯·æ±å åä¸æéä¼å¤±è´¥ãå¸ååºæ¯ï¼æå¡ A å éåï¼æ§è¡çæ¹æ³ä¸­åè°ç¨äºå¦ä¸ä¸ªéè¦å åä¸æéçæ¹æ³ï¼ç¬¬äºæ¬¡å éå¤±è´¥ï¼å¯¼è´çº¿ç¨é»å¡ï¼å¼åæ­»éã</p>
<p><strong>è¡¨ç°</strong>ï¼ä¸å¡çº¿ç¨é»å¡ï¼æ¥å£è¶æ¶æ ååºï¼ææ¥ååç°æ¯åä¸çº¿ç¨éå¤å éè¢«æã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼å®ç°å¯éå¥éæºå¶ãéç value å­å¨âå¯ä¸æ è¯ + éå¥æ¬¡æ°âï¼ç¬¬ä¸æ¬¡å éæ¶å­å¥æ è¯åæ¬¡æ° 1ï¼åä¸çº¿ç¨åæ¬¡å éæ¶ï¼éªè¯æ è¯ä¸è´ï¼å°æ¬¡æ°å  1ï¼éæ¾éæ¶ï¼æ¬¡æ°å 1ï¼ç´å°æ¬¡æ°ä¸º 0 æå é¤é®å½»åºéæ¾éã</p>
<p>æå¨å®ç°é»è¾å¤æï¼æ¨èä½¿ç¨ Redisson ç RLock æ¥å£ï¼å¤©ç¶æ¯æå¯éå¥ï¼ç¨æ³ä¸æ¬å° synchronized éä¸è´ï¼æ éé¢å¤å¼åã</p>
<h3 id="é®é¢-5ä¸»ä»åæ¢éä¸¢å¤±èè£éç¾¤ç¯å¢ä¸çéå½¢å">é®é¢ 5ï¼ä¸»ä»åæ¢éä¸¢å¤±ï¼èè£ï¼ââéç¾¤ç¯å¢ä¸çéå½¢å</h3>
<p><strong>æå </strong>ï¼Redis ä¸»ä»éç¾¤ä¸­ï¼ä¸»èç¹å­å¨éæ°æ®åï¼å°æªåæ­¥å°ä»èç¹å°±å®æºï¼å¨åµå°ä»èç¹åæ¢ä¸ºä¸»èç¹ï¼æ°ä¸»èç¹æ è¯¥éæ°æ®ï¼å¶ä»æå¡å¯éæ°å éï¼å¯¼è´åéå¤±æï¼åºç°å¤ä¸ªæå¡ææéçæåµãè¿æ¯ä¸»ä» + å¨åµæ¨¡å¼çåºæé£é©ã</p>
<p><strong>è¡¨ç°</strong>ï¼ä¸»ä»åæ¢åï¼åææéçæå¡ä»å¨æ§è¡ä¸å¡ï¼æ°æå¡å´è½å éæåï¼å¼åæ°æ®å²çªï¼ä¸é®é¢é¾ä»¥å¤ç°ï¼ä»åçå¨ä¸»ä»åæ¢ç¬é´ï¼ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ul>
<li>
<p>ä½ä¸è´æ§åºæ¯ï¼å¼å¯ Redis ä¸»ä»åæ­¥çâæä¹å + ç­å¾åæ­¥ç¡®è®¤âï¼ä¸»èç¹åå¥éæ°æ®åï¼ç­å¾è³å° 1 ä¸ªä»èç¹åæ­¥å®æåè¿åå éæåï¼éä½éä¸¢å¤±æ¦çï¼ä»æ æ³å®å¨é¿åï¼ã</p>
</li>
<li>
<p>é«ä¸è´æ§åºæ¯ï¼æ¾å¼ä¸»ä» + å¨åµæ¨¡å¼ï¼æ¹ç¨ Redlock ç®æ³ï¼éè¿å¤ä¸»èç¹æç¥¨æºå¶ï¼ä»æ ¹æºä¸è§£å³èè£å¯¼è´çéä¸¢å¤±é®é¢ã</p>
</li>
</ul>
<h3 id="é®é¢-6å éå¤±è´¥æ éè¯ç­ç¥ä¸å¡å¶åå¤±è´¥">é®é¢ 6ï¼å éå¤±è´¥æ éè¯ç­ç¥ââä¸å¡å¶åå¤±è´¥</h3>
<p><strong>æå </strong>ï¼å éæ¶ä»å°è¯ä¸æ¬¡ï¼è¥å ç½ç»æ³¢å¨ãRedis ä¸´æ¶ç¹å¿å¯¼è´å éå¤±è´¥ï¼ç´æ¥æåºå¼å¸¸ï¼å¯¼è´ä¸å¡æ§è¡å¤±è´¥ãåå¸å¼ç¯å¢ä¸­ï¼ç½ç»æå¨ãRedis ç¬æ¶ååå¤§æ¯å¸¸è§æåµï¼æ éè¯ç­ç¥ä¼æ¾å¤§è¿ç±»é®é¢çå½±åã</p>
<p><strong>è¡¨ç°</strong>ï¼é¨åç¨æ·æä½å¤±è´¥ï¼å¦æäº¤è®¢åæç¤ºâç³»ç»ç¹å¿âï¼ï¼éè¯åå¯æåï¼é®é¢å·æéæºæ§ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼å®ç°å¸¦éå¶çéè¯æºå¶ï¼å éå¤±è´¥åï¼é´éä¸å®æ¶é´ï¼å¦ 100msï¼éè¯ï¼åæ¶è®¾ç½®æå¤§éè¯æ¬¡æ°ï¼å¦ 3 æ¬¡ï¼åæ»è¶æ¶æ¶é´ï¼å¦ 1 ç§ï¼ï¼é¿åæ ééè¯å¯¼è´ Redis ååè¿å¤§ï¼ä¹è½æåå éæåçã</p>
<pre><code class="language-java">// å¸¦éè¯çå éé»è¾ï¼Spring Data Redis ç¤ºä¾ï¼
public boolean lockWithRetry(String key, String value, long expireMs, int maxRetry, long retryIntervalMs) {
    for (int i = 0; i &lt; maxRetry; i++) {
        Boolean result = redisTemplate.opsForValue().setIfAbsent(key, value, expireMs, TimeUnit.MILLISECONDS);
        if (Boolean.TRUE.equals(result)) {
            return true;
        }
        try {
            Thread.sleep(retryIntervalMs);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            return false;
        }
    }
    return false;
}
</code></pre>
<h3 id="é®é¢-7é¿æ¶é´ææéç³»ç»å¹¶åééª¤é">é®é¢ 7ï¼é¿æ¶é´ææéââç³»ç»å¹¶åééª¤é</h3>
<p><strong>æå </strong>ï¼å¨éçèå´åæ§è¡èæ¶æä½ï¼å¦å¤ææ°æ®åºæ¥è¯¢ãç¬¬ä¸æ¹æ¥å£è°ç¨ãå¤§éæ°æ®å¤çï¼ï¼å¯¼è´éæææ¶é´è¿é¿ï¼å¶ä»æå¡è¯·æ±è¯¥éæ¶è¢«é¿æ¶é´é»å¡ï¼ç³»ç»ååéå¤§å¹ä¸éã</p>
<p><strong>è¡¨ç°</strong>ï¼ä¾èµè¯¥éçæ¥å£ååºæ¶é´åé¿ï¼å¹¶åéä¸ä¸å»ï¼çæ§æ¾ç¤ºå¤§éçº¿ç¨é»å¡å¨å éç¯èã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ul>
<li>
<p>ç²¾ç®éåä¸å¡ï¼ä»å°âèµæºç«äºæ ¸å¿é»è¾âï¼å¦åºå­æ£åãè®¢åç¶æä¿®æ¹ï¼æ¾å¥éåï¼éæ ¸å¿é»è¾ï¼å¦æ¥å¿è®°å½ãæ¶æ¯æ¨éï¼ç§»è³éå¤æ§è¡ã</p>
</li>
<li>
<p>å¼æ­¥åå¤çï¼è¥éåå¿é¡»æ§è¡èæ¶æä½ï¼å°å¶å¼æ­¥åï¼å¦ç¨çº¿ç¨æ± ãæ¶æ¯éåï¼ï¼ç¼©ç­éæææ¶é´ã</p>
</li>
<li>
<p>è®¾ç½®éææè¶æ¶é¢è­¦ï¼éè¿çæ§å·¥å·ç»è®¡éæææ¶é´ï¼è¶è¿éå¼ï¼å¦ 20 ç§ï¼æ¶åè­¦ï¼åæ¶ææ¥èæ¶ä¸å¡ã</p>
</li>
</ul>
<h3 id="é®é¢-8é-key-è®¾è®¡ä¸å½éç²åº¦é®é¢å¼åå¹¶åç¶é¢">é®é¢ 8ï¼é key è®¾è®¡ä¸å½ââéç²åº¦é®é¢å¼åå¹¶åç¶é¢</h3>
<p><strong>æå </strong>ï¼é key ç²åº¦å¤ªç²ï¼å¦ç¨âlock:stockâä½ä¸ºææååçåºå­éï¼ï¼å¯¼è´ææååçåºå­æä½é½äºæ¥ï¼å³ä½¿æä½ä¸åååï¼ä¹éæéç­å¾ééæ¾ï¼å½»åºä¸§å¤±åå¸å¼ç³»ç»çå¹¶åä¼å¿ã</p>
<p><strong>è¡¨ç°</strong>ï¼ç³»ç»å¹¶åéæä½ï¼ä¸åååçåºå­æ£åè¯·æ±ä¸²è¡æ§è¡ï¼æ¥å£ååéè¿ä½äºé¢æã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼ç²¾ç»åè®¾è®¡é keyï¼æå·ä½èµæºæ è¯æåéãæ¯å¦åºå­éï¼ç¨âlock:stock:1001âï¼1001 ä¸ºåå IDï¼ä½ä¸ºé keyï¼ä»å¯¹åä¸ååçåºå­æä½äºæ¥ï¼ä¸åååå¯å¹¶è¡å¤çï¼å¤§å¹æåå¹¶åéã</p>
<p>å»¶ä¼¸ï¼é«å¹¶ååºæ¯ä¸ï¼å¯è¿ä¸æ­¥ç¨âåæ®µéâæåèµæºï¼å¦å°åå ID åå¸å° 10 ä¸ªåæ®µï¼é key ä¸ºâlock:stock:segment:1âï¼ï¼åä¸åæ®µäºæ¥ï¼ä¸ååæ®µå¹¶è¡ï¼è¿ä¸æ­¥æåå¹¶åè½åã</p>
<h3 id="é®é¢-9ç½ç»ååºå¯¼è´éç¶æä¸ä¸è´æç«¯åºæ¯ä¸çéæ£">é®é¢ 9ï¼ç½ç»ååºå¯¼è´éç¶æä¸ä¸è´ââæç«¯åºæ¯ä¸çéæ£</h3>
<p><strong>æå </strong>ï¼åå¸å¼ç¯å¢ä¸­åºç°ç½ç»ååºï¼ææéçæå¡ä¸ Redis éç¾¤éç¦»ï¼æ æ³ä¸»å¨éæ¾éï¼ä¹æ æ³æ¥æ¶éç»­çº¦ä¿¡å·ï¼éè¿æåï¼å¶ä»æå¡å éæåï¼ç½ç»æ¢å¤åï¼åææéçæå¡è¯¯ä»¥ä¸ºéä»ææï¼ç»§ç»­æä½èµæºï¼å¯¼è´æ°æ®å²çªã</p>
<p><strong>è¡¨ç°</strong>ï¼æç«¯ç½ç»å¼å¸¸åï¼åºç°æ°æ®ä¸ä¸è´ï¼ä¸é®é¢é¾ä»¥ææ¥ï¼ä¸ç½ç»ååºæ¶é´ãéè¿ææ¶é´å¼ºç¸å³ï¼ã</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<ul>
<li>
<p>å¼å¥ä¸å¡æ ¡éªæºå¶ï¼æä½èµæºåï¼åæ¬¡æ ¡éªèµæºç¶æï¼å¦æ£ååºå­åï¼æ£æ¥åºå­æ¯å¦ä¸é¢æä¸è´ï¼ï¼é¿ååºäºè¿æéçæ ææä½ã</p>
</li>
<li>
<p>ç¼©ç­éè¿ææ¶é´ï¼ç»å Watch Dog æºå¶ï¼å°åºç¡è¿ææ¶é´è®¾ç­ï¼å¦ 10 ç§ï¼ï¼åå°ç½ç»ååºå¯¼è´çéç¶æä¸ä¸è´çªå£ã</p>
</li>
<li>
<p>ä½¿ç¨ Redlock ç®æ³ï¼å¤ä¸»èç¹æç¥¨æºå¶ï¼å¯éä½ç½ç»ååºå¯¹éç¶æçå½±åï¼æåä¸è´æ§ã</p>
</li>
</ul>
<h2 id="äºçäº§é¿åæ»ç»">äºãçäº§é¿åæ»ç»</h2>
<p>Redis åå¸å¼éçé®é¢ï¼å¤§å¤ä¸æ¯ Redis æ¬èº«çç¼ºé·ï¼èæ¯å¯¹åå¸å¼åºæ¯çå¤ææ§èèä¸è¶³ãç»åå®æç»éªï¼æ»ç» 3 ä¸ªæ ¸å¿é¿åååï¼</p>
<ol>
<li>
<p>ä¼åä½¿ç¨æçæ¡æ¶ï¼æ¾å¼æå¨å®ç°åå¸å¼éï¼Redisson å·²å°è£è§£å³ä¸è¿°ææé®é¢ï¼å¼ç®±å³ç¨ï¼ç¨³å®æ§è¿é«äºèªå®ä¹å®ç°ã</p>
</li>
<li>
<p>å¹éä¸å¡åºæ¯éåï¼é«ä¸è´æ§ãé«å¯ç¨åºæ¯ç¨ Redlock ç®æ³ï¼ä¸è¬åºæ¯ç¨ä¸»ä» + å¨åµæ¨¡å¼ï¼æ ¹æ®å¹¶åéè®¾è®¡éç²åº¦ï¼ç²¾ç»å/åæ®µéï¼ã</p>
</li>
<li>
<p>å®åçæ§ä¸ååºï¼çæ§éæææ¶é´ãå éæåçãRedis éç¾¤ç¶æï¼è®¾ç½®åè­¦éå¼ï¼å éå¤±è´¥ãéè¿æç­åºæ¯ï¼éæä¸å¡ååºç­ç¥ï¼éè¯ãè¿ååå¥½æç¤ºãéåç¼å­ï¼ã</p>
</li>
</ol>
<p>æ»ä¹ï¼Redis åå¸å¼éçæ ¸å¿æ¯âå¼é¡¾äºæ¥æ§ä¸é«å¯ç¨âï¼é¿å¼ä¸è¿°é®é¢åï¼æè½çæ­£æä¸ºåå¸å¼ç³»ç»è§£å³å¹¶åå²çªçå©å¨ï¼èéç³»ç»çæ°ç¶é¢ã</p>

</div>
<div id="MySignature" role="contentinfo">
    
<p>â¤ï¸ å¦æä½ åæ¬¢è¿ç¯æç« ï¼è¯·ç¹èµæ¯æï¼ ð åæ¶æ¬¢è¿å³æ³¨æçåå®¢ï¼è·åæ´å¤ç²¾å½©åå®¹ï¼</p>

<p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/sun-10387834/" target="_blank">ä½ç¥è®©ææ¥å·¡å±±</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/sun-10387834/p/19493006" target="_blank">https://www.cnblogs.com/sun-10387834/p/19493006</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 19:24">2026-01-20 19:23</span>&nbsp;
<a href="https://www.cnblogs.com/sun-10387834">ä½ç¥è®©ææ¥å·¡å±±</a>&nbsp;
éè¯»(<span id="post_view_count">33</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19493006);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19493006', targetLink: 'https://www.cnblogs.com/sun-10387834/p/19493006', title: 'å¹²è´§æ»¡æ»¡ï¼Redis åå¸å¼éå¿é¿ç 8 å¤§é®é¢åè§£å³æ¹æ¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åä¸ºäºåå¸CodeArts Doerä»£ç æºè½ä½ä¸ªäººçï¼ä¸é®å¼å¯ä½ çç¼ç èªå¨é©¾é©¶æ¨¡å¼ ]]></title>
    <link>https://www.cnblogs.com/huaweiyun/p/19508288</link>
    <guid>6f2339ae6a62e712ab5ac97d24c28bf9</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/huaweiyun/p/19508288" title="åå¸äº 2026-01-20 18:34">
    <span role="heading" aria-level="2">åä¸ºäºåå¸CodeArts Doerä»£ç æºè½ä½ä¸ªäººçï¼ä¸é®å¼å¯ä½ çç¼ç èªå¨é©¾é©¶æ¨¡å¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<div style="text-align: left" align="center">2026å¹´1æ16æ¥ï¼åä¸ºäºæ­£å¼åå¸CodeArts Doerä»£ç æºè½ä½ãè¿æ¬¾æ·±åº¦èåAIåçè½åçæºè½ç¼ç äº§åï¼éæäºAI IDEãCode AgentãCodebaseä»£ç ä»æ·±åº¦çè§£ç­æ ¸å¿è½åï¼æ´æç åéæ±ãç²¾éç¼ç ãåç¨ç¾å¨ï¼ä¸ºå¼åèå¸¦æ¥çæ°ç åä½éªã</div>
<div style="text-align: left">&nbsp;<img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260120183417566-1436339979.png" class="lazyload"></div>
<p>æ¬æ¬¡åå¸çä¸å¤§æ°åç¹æ§ï¼ AI IDEãCode AgentãCodebase</p>
<p><strong>AI IDE</strong><strong>ï¼åçæºè½ï¼çæ°å¼åä½éª</strong></p>
<p>AI IDEä»¥AIåçä¸ºèµ·ç¹ï¼å°ç¼ç è½åä¸æºè½ä½æ·±åº¦èåï¼ä¸ºå¼åèå¸¦æ¥æ´èªç¶çå¼åå·¥ä½æµï¼ä»éæ±æè¿°å°ä»»å¡æè§£ï¼ä»æ¥å£è®¾è®¡å°ä»£ç è½å°ï¼å¨IDEåå³å¯å®æé­ç¯ãåæ¶ï¼AI IDEåç½®ä¸å®¶æè½ä¸ç²¾éå·¥å·ï¼å½¢æâäºº+AI+å·¥å·âçååå¼åå¹³å°ï¼å¼åèä¸æ³¨ä¸å¡å¤æ­ä¸å³é®å³ç­ï¼AI IDEè´è´£é«é¢ãéå¤ãæéæ¼çå·¥ç¨åå·¥ä½ï¼è®©ä½éªä»âå¤å¼çªå£æ¾å·¥å·âåçº§ä¸ºâå¨ä¸ä¸ªå·¥ä½å°éå®æäº¤ä»âã</p>
<p>&nbsp;<img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260120183416252-348731928.png" class="lazyload"></p>
<p><strong>Code Agent</strong><strong>ï¼å·¦æç¼ç èªç±ï¼å³æè§èé«æ</strong></p>
<p>CodeArts Doerä»£ç æºè½ä½æä¾ä¸¤ç§é¢åä¸åé¶æ®µä¸è¯æ±çå¼åæ¨¡å¼ï¼</p>
<p>æ¢ç´¢æ¨¡å¼ï¼æ´å¼ºè°äººæºååä¸åé åãä½ å¯ä»¥ç¨èªç¶è¯­è¨æè¿°éæ±ç®æ ï¼è®©CodeArts Doerä»£ç æºè½ä½ä¸ºä½ è§åå¹¶åè§£é¡¹ç®ä»»å¡ï¼çæé¡¹ç®çº§ä»£ç ãè¿è¡Agentç¥è¯å¢å¼ºãä»£ç ç»­åï¼å¹¶å¨å¤è½®å¯¹è¯ä¸­æç»­è¿­ä»£ï¼æâæ³æ³âå¿«éæ¨è¿å°âå¯è¿è¡âã</p>
<p>è§èæ¨¡å¼ï¼æ´å¼ºè°è´¨éãå®å¨ä¸ä¸è´æ§ãè§èé©±å¨å¼åï¼è®©ä»£ç éµä»æ åæµç¨çæãå¨çæä¸ä¿®æ¹ä»£ç è¿ç¨ä¸­å¯¹é½è§èï¼æåä»£ç çå¯è¯»æ§ãå¯ç»´æ¤æ§ï¼åæ¶å¨å³é®ç¹è¿è¡å®å¨ä¸è´¨éæ ¡éªï¼å¸®å©å¢éæâå¿«âå»ºç«å¨âç¨³âçåºç¡ä¸ã</p>
<p><img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260120183416252-348731928.png" class="lazyload"></p>
<p><strong>Codebase</strong><strong>ï¼ä»£ç ä»æ·±åº¦çè§£ï¼ææä½ çAIç¼ç ä¸å®¶</strong></p>
<p>çæ­£éç¨äºçäº§ç¯å¢çAIç¼ç ï¼å³é®å¨äºâçè§£ä½ çé¡¹ç®âãCodebaseæ¯æç¾ä¸è¡çº§ä»£ç ç´¢å¼ãç¥è¯å¾è°±æå»ºãææ¡£çæä¸æ¼ååå²ç¥è¯æ²æ·ï¼åç¡®çè§£ä»£ç ä»ç»æãä¾èµå³ç³»ä¸ä¸å¡è¾¹çï¼åèº«æä¸ä½ä¸å±çä»£ç ç¥è¯ä¸å®¶ï¼å¸®å©æ°æåå¿«éä¸æãèæåå¿«éå®ä½ãåæ¶ï¼åç¡®æ£ç´¢è½åè®©AIæ´å¿«æ¾å°ä½ çæ­£éè¦çå½æ°ãæ¥å£ä¸å®ç°ç»èï¼åå°âçä¼¼æ­£ç¡®ãå®åä¸ééâççæåå®¹ï¼è®©æ¯ä¸æ¬¡å»ºè®®é½æ´è´´è¿é¡¹ç®ç°å®ã</p>
<p>&nbsp;<img alt="" data-src="https://img2024.cnblogs.com/blog/2030258/202601/2030258-20260120183417231-1140323952.png" class="lazyload"></p>
<p><strong>å¤ç§ç¨æ·åºæ¯ï¼è®©ç åä»âäººåä¸»å¯¼âèµ°åâäººæºå±åâ</strong></p>
<p>CodeArts Doerä»£ç æºè½ä½å·²å¨é¡¹ç®çº§ä»£ç çæãAgentç¥è¯å¢å¼ºãä»£ç ç»­åãç åç¥è¯é®ç­ãååæµè¯çæç­åºæ¯å®ç°å¼åèæçæåï¼åæ¶ä¹æ¯æä¸°å¯å·¥å·çæï¼å©åé«æå¼åä¸ä¸ªæ§åå®å¶ã</p>
<p>ç®åï¼CodeArts Doerä»£ç æºè½ä½ä¸ªäººçå·²ç»æ­£å¼åå¸ï¼é¢åå¹¿å¤§å¼åèå¼æ¾åè´¹ä½éªãè®©AIçæ­£èµ°è¿å·¥ç¨ãèµ°è¿æµç¨ãèµ°è¿äº¤ä»ââä»ä»å¤©èµ·ï¼å¼å¯ä½ çç¼ç èªå¨é©¾é©¶æ¨¡å¼ã</p>
<p>ä½éªCodeArts Doerä»£ç æºè½ä½ï¼<a href="https://developer.huaweicloud.com/signup/78745481cafb4d79bf62096f6770c72e?channelCode=hcdg" target="_blank" rel="noopener nofollow">https://developer.huaweicloud.com/signup/78745481cafb4d79bf62096f6770c72e?channelCode=hcdg</a></p>
<p>&nbsp;</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 18:34">2026-01-20 18:34</span>&nbsp;
<a href="https://www.cnblogs.com/huaweiyun">åä¸ºäºå¼åèèç</a>&nbsp;
éè¯»(<span id="post_view_count">59</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508288);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508288', targetLink: 'https://www.cnblogs.com/huaweiyun/p/19508288', title: 'åä¸ºäºåå¸CodeArts Doerä»£ç æºè½ä½ä¸ªäººçï¼ä¸é®å¼å¯ä½ çç¼ç èªå¨é©¾é©¶æ¨¡å¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ è¿é¶æåï¼BrowserUse + Agentrun Sandbox æä½³å®è·µæå ]]></title>
    <link>https://www.cnblogs.com/Serverless/p/19507367</link>
    <guid>653a53287200fff87edeaef7ad5b608b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Serverless/p/19507367" title="åå¸äº 2026-01-20 16:12">
    <span role="heading" aria-level="2">è¿é¶æåï¼BrowserUse + Agentrun Sandbox æä½³å®è·µæå</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p><strong>æç¤º</strong>: æ¬ææ¯AgentRun Browser Sandbox å¿«éä¸æå®è·µæåçå§å¦¹ç¯,ä¸æ³¨äºé«çº§éææ¹æ¡ãçäº§ç¯å¢çæä½³å®è·µãæ§è½ä¼ååé¨ç½²ç­ç¥ãå¦ææ¨è¿æ²¡æå®æåºç¡å­¦ä¹ ,è¯·åéè¯»<a href="https://mp.weixin.qq.com/s/2LjN6LxymuZNlWUR-nhrEg" target="_blank" rel="noopener nofollow">ãå¿«éä¸æï¼LangChain + AgentRun æµè§å¨æ²ç®±æç®éææåã</a>ã</p>
</blockquote>
<h2 id="åè¨">åè¨</h2>
<p>å¨å®æäº Browser Sandbox çåºç¡éæä¹åï¼æ¬æå°ä»ç»é«çº§éææ¹æ¡ï¼å¦ BrowserUse æ¡æ¶ï¼ä»¥åçäº§ç¯å¢é¨ç½²éè¦èèçå ç´ ï¼å¦ä½ç®¡ç Sandbox çå½å¨æï¼å¦ä½ä¼åæ§è½åææ¬ï¼å¦ä½ä¿è¯ç³»ç»çå®å¨æ§åå¯è§æµæ§ï¼æ¬æå°ä¸ºæ¨æä¾å¨é¢çé«çº§åºç¨åçäº§ç¯å¢æä½³å®è·µæåã</p>
<h2 id="åºäº-browseruse-éæ-browser-sandbox">åºäº BrowserUse éæ Browser Sandbox</h2>
<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260120161152867-1802574501.png" class="lazyload"></p>
<p>&lt;æææªå¾&gt;</p>
<p>BrowserUse æ¯ä¸ä¸ªä¸é¨ä¸º AI Agent è®¾è®¡çæµè§å¨èªå¨åæ¡æ¶,æ¯æè§è§çè§£åæºè½å³ç­ãéè¿ AgentRun Browser Sandboxï¼æ¨å¯ä»¥è®© BrowserUse å¨äºç«¯è¿è¡,äº«å Serverless æ¶æçä¼å¿ã</p>
<h3 id="browseruse-æ¶ææ¦è§">BrowserUse æ¶ææ¦è§</h3>
<p>ä¸å¾å±ç¤ºäº BrowserUse ä¸ Browser Sandbox çéææ¶æï¼</p>
<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260120161152818-592122718.png" class="lazyload"></p>
<p><strong>æ¶æç¹ç¹ï¼</strong></p>
<ol>
<li><strong>æºè½å³ç­å¾ªç¯</strong>ï¼Agent éè¿ LLM åæé¡µé¢æªå¾,åºäºè§è§çè§£çææä½æä»¤ï¼æ§è¡æä½åç»§ç»­å¾ªç¯ï¼ç´å°ä»»å¡å®æ</li>
<li><strong>æ å¤´æµè§å¨æ§å¶</strong>ï¼éè¿ CDP åè®®è¿ç¨æ§å¶äºç«¯æµè§å¨ï¼Playwright ä½ä¸ºåºå±é©±å¨ï¼æææä½å¨äºç«¯æ§è¡</li>
<li><strong>å®æ¶å¯è§å</strong>ï¼VNC æä¾å®æ¶ç»é¢çæ§,æ¹ä¾¿è°è¯åéªè¯ Agent è¡ä¸º</li>
</ol>
<h3 id="å¿«éå¼å§">å¿«éå¼å§</h3>
<h4 id="å®è£ä¾èµ">å®è£ä¾èµ</h4>
<pre><code class="language-bash">pip install browser-use python-dotenv agentrun-sdk[playwright,server]
</code></pre>
<p>ä¸»è¦ä¾èµè¯´æï¼</p>
<ul>
<li><code>browser-use</code>: BrowserUse æ ¸å¿åº,æ¯æå¤æ¨¡æ LLM</li>
<li><code>agentrun-sdk[playwright,server]</code>: AgentRun SDKï¼ç¨äºåå»º Sandbox</li>
<li><code>python-dotenv</code>: ç¯å¢åéç®¡ç</li>
</ul>
<h4 id="éç½®ç¯å¢åé">éç½®ç¯å¢åé</h4>
<p>åå»º <code>.env</code> æä»¶ï¼</p>
<pre><code class="language-bash"># DashScope API Keyï¼ç¨äº Qwen æ¨¡åï¼
DASHSCOPE_API_KEY=sk-your-dashscope-api-key

# AgentRun è®¤è¯ä¿¡æ¯
AGENTRUN_ACCOUNT_ID=your-account-id
ALIBABA_CLOUD_ACCESS_KEY_ID=your-access-key-id
ALIBABA_CLOUD_ACCESS_KEY_SECRET=your-access-key-secret

# Browser Sandbox æ¨¡æ¿åç§°
BROWSER_TEMPLATE_NAME=sandbox-browser-demo
</code></pre>
<h4 id="åå»º-sandbox-å¹¶ä½¿ç¨-browseruse">åå»º Sandbox å¹¶ä½¿ç¨ BrowserUse</h4>
<pre><code class="language-python">import asyncio
import os
from agentrun.sandbox import Sandbox, TemplateType
from browser_use import Agent, BrowserSession, ChatOpenAI
from browser_use.browser import BrowserProfile
from dotenv import load_dotenv

load_dotenv()

async def main():
    # åå»º Browser Sandbox
    sandbox = Sandbox.create(
        template_type=TemplateType.BROWSER,
        template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
        sandbox_idle_timeout_seconds=3000
    )
    
    # éç½® Qwen å¤æ¨¡ææ¨¡å
    llm = ChatOpenAI(
        model='qwen-vl-max',
        api_key=os.getenv("DASHSCOPE_API_KEY"),
        base_url="https://dashscope.aliyuncs.com/compatible-mode/v1"
    )
    
    # åå»ºæµè§å¨ä¼è¯
    browser_session = BrowserSession(
        cdp_url=sandbox.get_cdp_url(),
        browser_profile=BrowserProfile(
            headless=False,
            timeout=3000000,
            keep_alive=True
        )
    )
    
    # åå»º Agent å¹¶æ§è¡ä»»å¡
    agent = Agent(
        task="è®¿é®é¿éäºå®ç½å¹¶æ»ç»ä¸»è¦äº§ååç±»",
        llm=llm,
        browser_session=browser_session,
        use_vision=True
    )
    
    result = await agent.run()
    
    print(f"ä»»å¡ç»æ: {result.final_result()}")
    
    # æ¸çèµæº
    await browser_session.stop()
    sandbox.delete()

if __name__ == "__main__":
    asyncio.run(main())
</code></pre>
<h3 id="browseruse-é«çº§éç½®">BrowserUse é«çº§éç½®</h3>
<h4 id="èªå®ä¹æµè§å¨è¡ä¸º">èªå®ä¹æµè§å¨è¡ä¸º</h4>
<pre><code class="language-python">browser_profile = BrowserProfile(
    timeout=3000000,             # è¶æ¶æ¶é´ï¼æ¯«ç§ï¼
    keep_alive=True,             # ä¿æä¼è¯æ´»è·
)
</code></pre>
<h4 id="å¤æ­¥éª¤ä»»å¡ç¼æ">å¤æ­¥éª¤ä»»å¡ç¼æ</h4>
<pre><code class="language-python">async def complex_task():
    """å¤æçå¤æ­¥éª¤ä»»å¡"""
    sandbox = Sandbox.create(
        template_type=TemplateType.BROWSER,
        template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
        sandbox_idle_timeout_seconds=3000
    )
    
    llm = ChatOpenAI(
        model='qwen-vl-max',
        api_key=os.getenv("DASHSCOPE_API_KEY"),
        base_url="https://dashscope.aliyuncs.com/compatible-mode/v1"
    )
    
    browser_session = BrowserSession(
        cdp_url=sandbox.cdp_url,
        browser_profile=BrowserProfile(keep_alive=True)
    )
    
    # ä»»å¡ 1ï¼ä¿¡æ¯æ¶é
    agent1 = Agent(
        task="è®¿é®é¿éäºå®ç½ï¼æ¶éäº§ååç±»ä¿¡æ¯",
        llm=llm,
        browser_session=browser_session,
        use_vision=True
    )
    result1 = await agent1.run()
    
    # ä»»å¡ 2ï¼åºäºç¬¬ä¸æ­¥ç»æç»§ç»­æä½
    agent2 = Agent(
        task=f"åºäºä»¥ä¸ä¿¡æ¯ï¼{result1.final_result()}ï¼è®¿é®æ¯ä¸ªäº§ååç±»å¹¶æåå³é®ç¹æ§",
        llm=llm,
        browser_session=browser_session,
        use_vision=True
    )
    result2 = await agent2.run()
    
    # æ¸çèµæº
    await browser_session.stop()
    sandbox.delete()
    
    return result2.final_result()
</code></pre>
<h4 id="éæ-vnc-å®æ¶çæ§">éæ VNC å®æ¶çæ§</h4>
<pre><code class="language-python">import webbrowser
import urllib.parse

async def run_with_vnc_monitoring():
    """è¿è¡ BrowserUse å¹¶å¯ç¨ VNC çæ§"""
    sandbox = Sandbox.create(
        template_type=TemplateType.BROWSER,
        template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
        sandbox_idle_timeout_seconds=3000
    )
    
    # è·å VNC URL å¹¶æå¼æ¥çå¨
    vnc_url = sandbox.get_vnc_url(),
    if vnc_url:
        # ä¿®å¤ VNC URL è·¯å¾
        if vnc_url.endswith('/vnc'):
            vnc_url = vnc_url[:-4] + '/ws/livestream'
        
        # å¨æµè§å¨ä¸­æå¼ VNC æ¥çå¨
        encoded_url = urllib.parse.quote(vnc_url, safe='')
        viewer_url = f"file://path/to/vnc-viewer.html?url={encoded_url}"
        webbrowser.open(viewer_url)
        print(f"VNC æ¥çå¨å·²æå¼ï¼å¯å®æ¶çæ§æµè§å¨æä½")
    
    # åå»ºå¹¶è¿è¡ Agent
    llm = ChatOpenAI(
        model='qwen-vl-max',
        api_key=os.getenv("DASHSCOPE_API_KEY"),
        base_url="https://dashscope.aliyuncs.com/compatible-mode/v1"
    )
    
    browser_session = BrowserSession(
        cdp_url=sandbox.get_cdp_url(),
        browser_profile=BrowserProfile(headless=False, keep_alive=True)
    )
    
    agent = Agent(
        task="è®¿é®æ·å®é¦é¡µå¹¶æç´¢åå",
        llm=llm,
        browser_session=browser_session,
        use_vision=True
    )
    
    result = await agent.run()
    
    # æ¸çèµæº
    await browser_session.stop()
    sandbox.delete()
    
    return result.final_result()
</code></pre>
<h3 id="browseruse-æä½³å®è·µ">BrowserUse æä½³å®è·µ</h3>
<ol>
<li><strong>å¯ç¨è§è§çè§£</strong>ï¼å¯¹äºå¤æé¡µé¢ï¼ä½¿ç¨ <code>use_vision=True</code> è®© LLM åæé¡µé¢æªå¾</li>
<li><strong>ä¿æä¼è¯æ´»è·</strong>ï¼ä½¿ç¨ <code>keep_alive=True</code> é¿åé¢ç¹éå»ºè¿æ¥</li>
<li><strong>åçè®¾ç½®è¶æ¶</strong>ï¼æ ¹æ®ä»»å¡å¤æåº¦è°æ´ <code>timeout</code> åæ°</li>
<li><strong>å¤ç¨ BrowserSession</strong>ï¼å¯¹äºå¤æ­¥éª¤ä»»å¡ï¼å¤ç¨åä¸ä¸ª BrowserSession æé«æç</li>
<li><strong>ç»å VNC è°è¯</strong>ï¼å¼åé¶æ®µå¯ç¨ VNC å®æ¶æ¥ç Agent è¡ä¸º</li>
</ol>
<h3 id="è·åå®æ´ç¤ºä¾ä»£ç ">è·åå®æ´ç¤ºä¾ä»£ç </h3>
<p>æ¬æä¸­çææç¤ºä¾ä»£ç é½å¯ä»¥å¨ä»¥ä¸ä»åºä¸­æ¾å°ï¼</p>
<pre><code class="language-bash"># åéç¤ºä¾ä»£ç ä»åº
git clone https://github.com/devsapp/agentrun-sandbox-demos.git

# è¿å¥é¡¹ç®ç®å½
cd agentrun-browseruse-wth-sandbox-demo

# å®è£ä¾èµï¼æ³¨æéè¦å®è£ server æ©å±ï¼
pip install -r requirements.txt
</code></pre>
<h4 id="éç½®ç¯å¢åé-1">éç½®ç¯å¢åé</h4>
<pre><code class="language-bash"># å¤å¶ç¯å¢åéæ¨¡æ¿
cp env.example .env

# ç¼è¾ .env æä»¶ï¼å¡«å¥æ¨çéç½®ä¿¡æ¯
# å¿ééç½®é¡¹ï¼
# - DASHSCOPE_API_KEY: DashScope API Keyï¼ç¨äº Qwen æ¨¡åï¼
# - AGENTRUN_ACCOUNT_ID: AgentRun è´¦å· ID
# - ALIBABA_CLOUD_ACCESS_KEY_ID: é¿éäºè®¿é®å¯é¥ ID
# - ALIBABA_CLOUD_ACCESS_KEY_SECRET: é¿éäºè®¿é®å¯é¥ Secret
# - BROWSER_TEMPLATE_NAME: Browser Sandbox æ¨¡æ¿åç§°
</code></pre>
<h4 id="è¿è¡ç¤ºä¾ä¸¤æ­¥è¿è¡è®¾è®¡">è¿è¡ç¤ºä¾ï¼ä¸¤æ­¥è¿è¡è®¾è®¡ï¼</h4>
<p>æ¬é¡¹ç®éç¨<strong>æå¡å¨-å®¢æ·ç«¯</strong>çæ¶æè®¾è®¡ï¼éè¦åä¸¤æ­¥è¿è¡ï¼</p>
<p><strong>ç¬¬ä¸æ­¥ï¼å¯å¨ VNC æ¥çå¨æå¡</strong></p>
<pre><code class="language-bash"># å¨ç»ç«¯ 1 ä¸­å¯å¨ VNC Web æå¡å¨
python main.py

# æå¡å¯å¨åä¼æ¾ç¤ºï¼
# VNC æ¥çå¨æå¡å·²å¯å¨: http://localhost:8000
# è®¿é® http://localhost:8000 å¯ä»¥å®æ¶æ¥çæµè§å¨æä½
</code></pre>
<p><code>main.py</code> çä½ç¨ï¼</p>
<ul>
<li>å¯å¨æ¬å° Web æå¡å¨ï¼æä¾ VNC å®æ¶æ¥ççé¢</li>
<li>æä¾ WebSocket ä»£çï¼è¿æ¥ AgentRun Sandbox ç VNC æå¡</li>
<li>åè®¸æ¨å¨æµè§å¨ä¸­å®æ¶çæ§ Agent çæä½è¿ç¨</li>
</ul>
<p><strong>ç¬¬äºæ­¥ï¼è¿è¡ BrowserUse ç¤ºä¾</strong></p>
<pre><code class="language-bash"># å¨ç»ç«¯ 2 ä¸­è¿è¡ç¤ºä¾ä»£ç 
python examples/01_browseruse_basic.py

# è¿è¡é«çº§ç¤ºä¾
python examples/02_browseruse_advanced.py
</code></pre>
<p><strong>ä¸ºä»ä¹éè¦ä¸¤æ­¥è¿è¡ï¼</strong></p>
<ol>
<li><strong>å®æ¶çæ§</strong>ï¼main.py æä¾ VNC æ¥çå¨ï¼å¯ä»¥å®æ¶çå° Agent å¨æµè§å¨ä¸­çæä½</li>
<li><strong>è°è¯åå¥½</strong>ï¼éè¿å¯è§åçé¢ï¼æ´å®¹æçè§£ Agent çå³ç­è¿ç¨åè¡ä¸º</li>
<li><strong>æå¡è§£è¦</strong>ï¼VNC æå¡åä¸å¡é»è¾åç¦»ï¼å¯ä»¥åæ¶è¿è¡å¤ä¸ªç¤ºä¾èå±ç¨åä¸ä¸ªæ¥çå¨</li>
</ol>
<p><strong>è¿è¡æµç¨å¾ï¼</strong></p>
<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260120161152812-1325245902.png" class="lazyload"></p>
<p><strong>ä»åºåå®¹åæ¬ï¼</strong></p>
<ul>
<li><code>main.py</code>: VNC Web æå¡å¨ï¼ç¨äºå®æ¶çæ§</li>
<li><code>examples/01_browseruse_basic.py</code>: åºç¡éæç¤ºä¾</li>
<li><code>examples/02_browseruse_advanced.py</code>: é«çº§éç½®ç¤ºä¾</li>
<li><code>examples/sandbox_manager.py</code>: Sandbox çå½å¨æç®¡ç</li>
<li><code>vncviewer/</code>: VNC æ¥çå¨åç«¯ååç«¯ä»£ç </li>
<li>å®æ´çç¯å¢éç½®åæä½³å®è·µä»£ç </li>
</ul>
<hr>
<h2 id="sandbox-çå½å¨æç®¡çæä½³å®è·µ">Sandbox çå½å¨æç®¡çæä½³å®è·µ</h2>
<h3 id="ä¸ç§ç®¡çæ¨¡å¼">ä¸ç§ç®¡çæ¨¡å¼</h3>
<p>æ ¹æ®ä¸åçåºç¨åºæ¯,æä»¬æ¨èä¸ç§ Sandbox ç®¡çæ¨¡å¼ï¼</p>
<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260120161152792-1428609621.png" class="lazyload"></p>
<p><strong>æ¹æ¡å¯¹æ¯ï¼</strong></p>
<table>
<thead>
<tr>
<th>ç®¡çæ¨¡å¼</th>
<th>ä¼ç¹</th>
<th>ç¼ºç¹</th>
<th>éç¨åºæ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åä¾æ¨¡å¼</strong></td>
<td>â¢ èµæºå¤ç¨   â¢ ååºå¿«   â¢ ç®åæç¨</td>
<td>â¢ ç¶ææ±¡æé£é©   â¢ ä¸éåå¹¶å</td>
<td>å¼åè°è¯   å¤è½®å¯¹è¯   ä¸ªäººåºç¨</td>
</tr>
<tr>
<td><strong>è¯·æ±çº§å«</strong></td>
<td>â¢ ç¯å¢éç¦»   â¢ ç¶æç¬ç«   â¢ å®å¨æ§é«</td>
<td>â¢ åå»ºå¼éå¤§   â¢ ææ¬è¾é«</td>
<td>ä¸æ¬¡æ§ä»»å¡   é«å®å¨éæ±   æ ç¶ææå¡</td>
</tr>
<tr>
<td><strong>è¿æ¥æ± </strong></td>
<td>â¢ å¹¶åè½åå¼º   â¢ èµæºå©ç¨çé«   â¢ æ§è½ç¨³å®</td>
<td>â¢ å®ç°å¤æ   â¢ éè¦çæ§</td>
<td>çäº§ç¯å¢   é«å¹¶åæå¡   ä¼ä¸åºç¨</td>
</tr>
</tbody>
</table>
<h3 id="åä¾æ¨¡å¼å®ç°">åä¾æ¨¡å¼å®ç°</h3>
<p>éåå¼åè°è¯åå¤è½®å¯¹è¯åºæ¯ï¼</p>
<pre><code class="language-python">class SandboxManager:
    """åä¾æ¨¡å¼ Sandbox ç®¡çå¨"""
    _instance = None
    _sandbox = None
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
        return cls._instance
    
    def get_or_create(self):
        """è·åæåå»º Sandbox"""
        if self._sandbox is None:
            self._sandbox = Sandbox.create(
                template_type=TemplateType.BROWSER,
                template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
                sandbox_idle_timeout_seconds=3000
            )
        return self._sandbox
    
    def destroy(self):
        """éæ¯ Sandbox"""
        if self._sandbox:
            self._sandbox.delete()
            self._sandbox = None

# ä½¿ç¨
manager = SandboxManager()
sandbox = manager.get_or_create()  # é¦æ¬¡åå»º
sandbox = manager.get_or_create()  # å¤ç¨ç°æå®ä¾
</code></pre>
<h3 id="è¿æ¥æ± æ¨¡å¼å®ç°">è¿æ¥æ± æ¨¡å¼å®ç°</h3>
<p>éåé«å¹¶åçäº§ç¯å¢ï¼</p>
<pre><code class="language-python">from queue import Queue
from threading import Lock

class SandboxPool:
    """Sandbox è¿æ¥æ± """
    
    def __init__(self, pool_size=5, max_idle_time=300):
        self.pool_size = pool_size
        self.max_idle_time = max_idle_time
        self.pool = Queue(maxsize=pool_size)
        self.lock = Lock()
        self._initialize_pool()
    
    def _initialize_pool(self):
        """åå§åè¿æ¥æ± """
        for _ in range(self.pool_size):
            sandbox = self._create_sandbox()
            self.pool.put(sandbox)
    
    def _create_sandbox(self):
        """åå»º Sandbox å®ä¾"""
        return Sandbox.create(
            template_type=TemplateType.BROWSER,
            template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
            sandbox_idle_timeout_seconds=self.max_idle_time
        )
    
    def acquire(self, timeout=30):
        """è·å Sandbox å®ä¾"""
        try:
            sandbox = self.pool.get(timeout=timeout)
            if not self._is_alive(sandbox):
                sandbox = self._create_sandbox()
            return sandbox
        except:
            raise RuntimeError("è·å Sandbox è¶æ¶")
    
    def release(self, sandbox):
        """å½è¿ Sandbox å®ä¾"""
        if self._is_alive(sandbox):
            self.pool.put(sandbox)
        else:
            new_sandbox = self._create_sandbox()
            self.pool.put(new_sandbox)
    
    def _is_alive(self, sandbox):
        """æ£æ¥ Sandbox æ¯å¦å­æ´»"""
        try:
            return hasattr(sandbox, 'sandbox_id')
        except:
            return False

# ä½¿ç¨
pool = SandboxPool(pool_size=5)

sandbox = pool.acquire()
try:
    # ä½¿ç¨ sandbox æ§è¡ä»»å¡
    pass
finally:
    pool.release(sandbox)
</code></pre>
<h3 id="ä¼è¯ç¶æç®¡ç">ä¼è¯ç¶æç®¡ç</h3>
<p>æ¯æå¤ç¨æ·å¤ä¼è¯åºæ¯ï¼</p>
<pre><code class="language-python">import time

class SessionManager:
    """ä¼è¯ç¶æç®¡ç"""
    
    def __init__(self):
        self.sessions = {}  # session_id -&gt; sandbox
    
    def create_session(self, session_id: str):
        """åå»ºä¼è¯"""
        if session_id not in self.sessions:
            sandbox = Sandbox.create(
                template_type=TemplateType.BROWSER,
                template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
                sandbox_idle_timeout_seconds=1800
            )
            self.sessions[session_id] = {
                'sandbox': sandbox,
                'created_at': time.time(),
                'last_used': time.time()
            }
        return self.sessions[session_id]['sandbox']
    
    def get_session(self, session_id: str):
        """è·åä¼è¯"""
        if session_id in self.sessions:
            session = self.sessions[session_id]
            session['last_used'] = time.time()
            return session['sandbox']
        return None
    
    def cleanup_expired_sessions(self, max_idle_time=1800):
        """æ¸çè¿æä¼è¯"""
        current_time = time.time()
        expired_sessions = []
        
        for session_id, session in self.sessions.items():
            if current_time - session['last_used'] &gt; max_idle_time:
                expired_sessions.append(session_id)
        
        for session_id in expired_sessions:
            self.destroy_session(session_id)
    
    def destroy_session(self, session_id: str):
        """éæ¯ä¼è¯"""
        if session_id in self.sessions:
            self.sessions[session_id]['sandbox'].delete()
            del self.sessions[session_id]
</code></pre>
<h2 id="æ§è½ä¼å">æ§è½ä¼å</h2>
<h3 id="è¶æ¶æ¶é´éç½®">è¶æ¶æ¶é´éç½®</h3>
<p>åçè®¾ç½®è¶æ¶æ¶é´æ¯å¹³è¡¡æ§è½åææ¬çå³é®ï¼</p>
<pre><code class="language-python"># å¼åç¯å¢ï¼è°è¯ç¨ï¼
sandbox = Sandbox.create(
    template_name="dev-template",
    sandbox_idle_timeout_seconds=7200  # 2 å°æ¶
)

# çäº§ç¯å¢ï¼åæ¬¡ä»»å¡ï¼
sandbox = Sandbox.create(
    template_name="prod-template",
    sandbox_idle_timeout_seconds=300  # 5 åé
)

# é¿æ¶é´ä»»å¡
sandbox = Sandbox.create(
    template_name="long-task-template",
    sandbox_idle_timeout_seconds=10800  # 3 å°æ¶
)
</code></pre>
<p><strong>è¶æ¶ç­ç¥æ¨èï¼</strong></p>
<table>
<thead>
<tr>
<th>åºæ¯</th>
<th>æ¨èè¶æ¶</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¼åè°è¯</td>
<td>1-2 å°æ¶</td>
<td>æ¹ä¾¿è°è¯,é¿åé¢ç¹éå»º</td>
</tr>
<tr>
<td>ç®åä»»å¡</td>
<td>5-10 åé</td>
<td>åé¡µæä½,å¿«éå®æ</td>
</tr>
<tr>
<td>å¤æä»»å¡</td>
<td>30-60 åé</td>
<td>å¤æ­¥éª¤æµç¨,éè¦æ¶é´</td>
</tr>
<tr>
<td>åå°æå¡</td>
<td>2-4 å°æ¶</td>
<td>é¿æè¿è¡,å®æå·æ°</td>
</tr>
</tbody>
</table>
<h3 id="sandbox-å¤ç¨ç­ç¥">Sandbox å¤ç¨ç­ç¥</h3>
<pre><code class="language-python">class SmartSandboxManager:
    """æºè½ Sandbox å¤ç¨ç®¡çå¨"""
    
    def __init__(self):
        self.sandboxes = {}  # key -&gt; sandbox
        self.usage_count = {}  # key -&gt; count
    
    def get_sandbox(self, user_id: str, session_id: str):
        """è·åæåå»º Sandboxï¼æ¯æå¤ç¨ï¼"""
        key = f"{user_id}:{session_id}"
        
        if key not in self.sandboxes:
            self.sandboxes[key] = Sandbox.create(
                template_type=TemplateType.BROWSER,
                template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
                sandbox_idle_timeout_seconds=1800
            )
            self.usage_count[key] = 0
        
        self.usage_count[key] += 1
        return self.sandboxes[key]
    
    def should_recreate(self, key: str, max_reuse=50):
        """å¤æ­æ¯å¦éè¦éå»ºï¼é²æ­¢ç¶æç´¯ç§¯ï¼"""
        return self.usage_count.get(key, 0) &gt;= max_reuse
    
    def recreate_if_needed(self, key: str):
        """æééå»º Sandbox"""
        if self.should_recreate(key):
            if key in self.sandboxes:
                self.sandboxes[key].delete()
                del self.sandboxes[key]
                self.usage_count[key] = 0
</code></pre>
<h3 id="éè¯¯å¤çåéè¯æºå¶">éè¯¯å¤çåéè¯æºå¶</h3>
<p>ä½¿ç¨ tenacity åºå®ç°æºè½éè¯ï¼</p>
<pre><code class="language-python">from tenacity import retry, stop_after_attempt, wait_exponential, retry_if_exception_type

class SandboxError(Exception):
    """Sandbox æä½å¼å¸¸"""
    pass

@retry(
    retry=retry_if_exception_type(SandboxError),
    stop=stop_after_attempt(3),
    wait=wait_exponential(multiplier=1, min=2, max=10)
)
def execute_with_retry(sandbox, operation):
    """å¸¦éè¯çæä½æ§è¡"""
    try:
        return operation(sandbox)
    except ConnectionError:
        raise SandboxError("è¿æ¥å¤±è´¥")
    except TimeoutError:
        raise SandboxError("æä½è¶æ¶")
    except Exception as e:
        print(f"æä½å¤±è´¥: {e}")
        raise SandboxError(f"æä½å¤±è´¥: {e}")

# ä½¿ç¨ç¤ºä¾
def navigate_page(sandbox):
    with sync_playwright() as p:
        browser = p.chromium.connect_over_cdp(sandbox.cdp_url)
        page = browser.contexts[0].pages[0]
        page.goto("https://example.com", timeout=30000)
        return page.title()

result = execute_with_retry(sandbox, navigate_page)
</code></pre>
<h2 id="å®å¨æ§æä½³å®è·µ">å®å¨æ§æä½³å®è·µ</h2>
<h3 id="ç¯å¢åéä¿æ¤">ç¯å¢åéä¿æ¤</h3>
<pre><code class="language-python">import os
from dotenv import load_dotenv

load_dotenv()

# éªè¯å¿éçç¯å¢åé
required_vars = ["DASHSCOPE_API_KEY", "AGENTRUN_ACCOUNT_ID"]
missing_vars = [var for var in required_vars if not os.getenv(var)]
if missing_vars:
    raise ValueError(f"ç¼ºå°å¿éçç¯å¢åé: {', '.join(missing_vars)}")

# ææä¿¡æ¯ä¸è¦ç¡¬ç¼ç 
API_KEY = os.getenv("DASHSCOPE_API_KEY")
ACCESS_KEY_ID = os.getenv("ALIBABA_CLOUD_ACCESS_KEY_ID")
ACCESS_KEY_SECRET = os.getenv("ALIBABA_CLOUD_ACCESS_KEY_SECRET")
</code></pre>
<h3 id="url-ç½åå">URL ç½åå</h3>
<pre><code class="language-python">ALLOWED_DOMAINS = [
    'example.com',
    'aliyun.com',
    'alibaba.com'
]

def is_url_allowed(url: str) -&gt; bool:
    """æ£æ¥ URL æ¯å¦å¨ç½ååä¸­"""
    from urllib.parse import urlparse
    domain = urlparse(url).netloc
    return any(allowed in domain for allowed in ALLOWED_DOMAINS)

def safe_navigate(page, url: str):
    """å®å¨å¯¼èª"""
    if not is_url_allowed(url):
        raise ValueError(f"URL ä¸å¨ç½ååä¸­: {url}")
    page.goto(url)
</code></pre>
<h3 id="æ¥å¿è±æ">æ¥å¿è±æ</h3>
<pre><code class="language-python">import re

def sanitize_log(log_text: str) -&gt; str:
    """æ¥å¿è±æ"""
    # è±æ API Key
    log_text = re.sub(r'sk-[a-zA-Z0-9]{20,}', 'sk-***', log_text)
    # è±æ Access Key
    log_text = re.sub(r'LTAI[a-zA-Z0-9]{12,}', 'LTAI***', log_text)
    # è±æå¯ç 
    log_text = re.sub(r'password["\s:=]+[^"\s,}]+', 'password: ***', log_text, flags=re.IGNORECASE)
    return log_text

# ä½¿ç¨
print(sanitize_log(f"ä½¿ç¨ API Key: {API_KEY}"))
</code></pre>
<h2 id="å¯è§æµæ§ä¸çæ§">å¯è§æµæ§ä¸çæ§</h2>
<h3 id="æ¥å¿è®°å½æä½³å®è·µ">æ¥å¿è®°å½æä½³å®è·µ</h3>
<pre><code class="language-python">import logging
from datetime import datetime

# éç½®æ¥å¿
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler(f'sandbox_{datetime.now().strftime("%Y%m%d")}.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)

class MonitoredSandboxManager:
    """å¸¦çæ§ç Sandbox ç®¡çå¨"""
    
    def create_sandbox(self, **kwargs):
        """åå»º Sandboxï¼å¸¦æ¥å¿ï¼"""
        start_time = time.time()
        logger.info(f"å¼å§åå»º Sandbox: {kwargs}")
        
        try:
            sandbox = Sandbox.create(**kwargs)
            duration = time.time() - start_time
            logger.info(f"Sandbox åå»ºæå: {sandbox.sandbox_id}, èæ¶: {duration:.2f}s")
            return sandbox
        except Exception as e:
            duration = time.time() - start_time
            logger.error(f"Sandbox åå»ºå¤±è´¥: {e}, èæ¶: {duration:.2f}s")
            raise
    
    def execute_task(self, sandbox, task_name: str, operation):
        """æ§è¡ä»»å¡ï¼å¸¦æ¥å¿ï¼"""
        start_time = time.time()
        logger.info(f"å¼å§æ§è¡ä»»å¡: {task_name}, Sandbox: {sandbox.sandbox_id}")
        
        try:
            result = operation(sandbox)
            duration = time.time() - start_time
            logger.info(f"ä»»å¡æ§è¡æå: {task_name}, èæ¶: {duration:.2f}s")
            return result
        except Exception as e:
            duration = time.time() - start_time
            logger.error(f"ä»»å¡æ§è¡å¤±è´¥: {task_name}, éè¯¯: {e}, èæ¶: {duration:.2f}s")
            raise
</code></pre>
<h3 id="ææ æ¶é">ææ æ¶é</h3>
<pre><code class="language-python">from dataclasses import dataclass
from typing import Dict, List
import json

@dataclass
class SandboxMetrics:
    """Sandbox ææ """
    sandbox_id: str
    create_time: float
    destroy_time: float = None
    total_requests: int = 0
    failed_requests: int = 0
    total_duration: float = 0.0

class MetricsCollector:
    """ææ æ¶éå¨"""
    
    def __init__(self):
        self.metrics: Dict[str, SandboxMetrics] = {}
    
    def record_creation(self, sandbox_id: str):
        """è®°å½åå»º"""
        self.metrics[sandbox_id] = SandboxMetrics(
            sandbox_id=sandbox_id,
            create_time=time.time()
        )
    
    def record_request(self, sandbox_id: str, duration: float, success: bool):
        """è®°å½è¯·æ±"""
        if sandbox_id in self.metrics:
            metric = self.metrics[sandbox_id]
            metric.total_requests += 1
            metric.total_duration += duration
            if not success:
                metric.failed_requests += 1
    
    def record_destruction(self, sandbox_id: str):
        """è®°å½éæ¯"""
        if sandbox_id in self.metrics:
            self.metrics[sandbox_id].destroy_time = time.time()
    
    def export_metrics(self, filepath: str):
        """å¯¼åºææ """
        metrics_data = [
            {
                'sandbox_id': m.sandbox_id,
                'create_time': m.create_time,
                'destroy_time': m.destroy_time,
                'total_requests': m.total_requests,
                'failed_requests': m.failed_requests,
                'success_rate': (m.total_requests - m.failed_requests) / m.total_requests if m.total_requests &gt; 0 else 0,
                'avg_duration': m.total_duration / m.total_requests if m.total_requests &gt; 0 else 0,
                'lifetime': m.destroy_time - m.create_time if m.destroy_time else time.time() - m.create_time
            }
            for m in self.metrics.values()
        ]
        
        with open(filepath, 'w') as f:
            json.dump(metrics_data, f, indent=2)

# ä½¿ç¨
collector = MetricsCollector()
collector.record_creation(sandbox.sandbox_id)
# ... æ§è¡ä»»å¡ ...
collector.export_metrics('metrics.json')
</code></pre>
<h2 id="ææ¬ä¼å">ææ¬ä¼å</h2>
<h3 id="æéåå»ºä¸éæ¯">æéåå»ºä¸éæ¯</h3>
<pre><code class="language-python">class CostOptimizedManager:
    """ææ¬ä¼åçç®¡çå¨"""
    
    def __init__(self, idle_threshold=300):
        self.idle_threshold = idle_threshold
        self.sandboxes = {}
        self.last_used = {}
    
    def get_sandbox(self, key: str):
        """è·å Sandboxï¼æå è½½ï¼"""
        if key not in self.sandboxes:
            self.sandboxes[key] = Sandbox.create(
                template_type=TemplateType.BROWSER,
                template_name=os.getenv("BROWSER_TEMPLATE_NAME"),
                sandbox_idle_timeout_seconds=self.idle_threshold
            )
        
        self.last_used[key] = time.time()
        return self.sandboxes[key]
    
    def cleanup_idle(self):
        """æ¸çé²ç½® Sandbox"""
        current_time = time.time()
        to_remove = []
        
        for key, last_time in self.last_used.items():
            if current_time - last_time &gt; self.idle_threshold:
                to_remove.append(key)
        
        for key in to_remove:
            if key in self.sandboxes:
                self.sandboxes[key].delete()
                del self.sandboxes[key]
                del self.last_used[key]
                logger.info(f"æ¸çé²ç½® Sandbox: {key}")
</code></pre>
<h3 id="æ¹éä»»å¡å¤ç">æ¹éä»»å¡å¤ç</h3>
<pre><code class="language-python">async def batch_process_tasks(tasks: List[str], pool_size: int = 5):
    """æ¹éå¤çä»»å¡ï¼å¤ç¨ Sandboxï¼"""
    pool = SandboxPool(pool_size=pool_size)
    results = []
    
    for task in tasks:
        sandbox = pool.acquire()
        try:
            # å¤çä»»å¡
            result = await process_task(sandbox, task)
            results.append(result)
        finally:
            pool.release(sandbox)
    
    return results
</code></pre>
<h2 id="çäº§ç¯å¢é¨ç½²">çäº§ç¯å¢é¨ç½²</h2>
<h3 id="ç¯å¢éç½®">ç¯å¢éç½®</h3>
<p><strong>å¼åç¯å¢ (.env.dev)</strong>ï¼</p>
<pre><code class="language-bash"># å¼åç¯å¢éç½®
BROWSER_TEMPLATE_NAME=dev-browser-template
SANDBOX_IDLE_TIMEOUT=7200
POOL_SIZE=2
LOG_LEVEL=DEBUG
</code></pre>
<p><strong>çäº§ç¯å¢ (.env.prod)</strong>ï¼</p>
<pre><code class="language-bash"># çäº§ç¯å¢éç½®
BROWSER_TEMPLATE_NAME=prod-browser-template
SANDBOX_IDLE_TIMEOUT=300
POOL_SIZE=10
LOG_LEVEL=INFO
ENABLE_METRICS=true
METRICS_EXPORT_INTERVAL=300
</code></pre>
<h3 id="é«å¯ç¨æ¶æ">é«å¯ç¨æ¶æ</h3>
<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260120161152830-801036086.png" class="lazyload"></p>
<h3 id="å¥åº·æ£æ¥">å¥åº·æ£æ¥</h3>
<pre><code class="language-python">from flask import Flask, jsonify

app = Flask(__name__)
manager = SandboxManager()

@app.route('/health')
def health_check():
    """å¥åº·æ£æ¥ç«¯ç¹"""
    try:
        # æ£æ¥ Sandbox æ¯å¦å¯ç¨
        sandbox = manager.get_or_create()
        
        # ç®åçå¥åº·æ£æ¥
        is_healthy = hasattr(sandbox, 'sandbox_id')
        
        if is_healthy:
            return jsonify({
                'status': 'healthy',
                'sandbox_id': sandbox.sandbox_id,
                'timestamp': time.time()
            }), 200
        else:
            return jsonify({
                'status': 'unhealthy',
                'error': 'Sandbox not available'
            }), 503
    except Exception as e:
        return jsonify({
            'status': 'unhealthy',
            'error': str(e)
        }), 503

@app.route('/metrics')
def metrics():
    """ææ ç«¯ç¹"""
    collector = MetricsCollector()
    # è¿åå½åææ 
    return jsonify({
        'total_sandboxes': len(collector.metrics),
        'timestamp': time.time()
    })
</code></pre>
<h2 id="æéææ¥ä¸å¸¸è§é®é¢">æéææ¥ä¸å¸¸è§é®é¢</h2>
<h3 id="è¿æ¥é®é¢">è¿æ¥é®é¢</h3>
<p><strong>é®é¢</strong>ï¼æ æ³è¿æ¥å° Sandbox</p>
<p><strong>ææ¥æ­¥éª¤</strong>ï¼</p>
<pre><code class="language-python">def diagnose_connection(sandbox):
    """è¯æ­è¿æ¥é®é¢"""
    print(f"1. æ£æ¥ Sandbox ID: {sandbox.sandbox_id}")
    print(f"2. æ£æ¥ CDP URL: {sandbox.cdp_url}")
    
    # æµè¯ CDP è¿æ¥
    try:
        with sync_playwright() as p:
            browser = p.chromium.connect_over_cdp(sandbox.cdp_url)
            print("â CDP è¿æ¥æå")
            browser.close()
    except Exception as e:
        print(f"â CDP è¿æ¥å¤±è´¥: {e}")
    
    # æµè¯ VNC è¿æ¥
    print(f"3. VNC URL: {sandbox.vnc_url}")
    print("æç¤º: å¯ä»¥å¨æµè§å¨ä¸­æå¼ VNC URL æµè¯è¿æ¥")
</code></pre>
<h3 id="è¶æ¶é®é¢">è¶æ¶é®é¢</h3>
<p><strong>é®é¢</strong>ï¼ä»»å¡æ§è¡è¶æ¶</p>
<p><strong>è§£å³æ¹æ¡</strong>ï¼</p>
<pre><code class="language-python">def handle_timeout(sandbox, operation, max_retries=3):
    """å¤çè¶æ¶ï¼å¸¦éè¯ï¼"""
    for attempt in range(max_retries):
        try:
            return operation(sandbox, timeout=30000)
        except TimeoutError:
            logger.warning(f"ä»»å¡è¶æ¶ï¼å°è¯ {attempt + 1}/{max_retries}ï¼")
            if attempt == max_retries - 1:
                # æåä¸æ¬¡å°è¯å¤±è´¥ï¼éå»º Sandbox
                logger.error("å¤æ¬¡è¶æ¶ï¼éå»º Sandbox")
                sandbox.delete()
                sandbox = Sandbox.create(
                    template_type=TemplateType.BROWSER,
                    template_name=os.getenv("BROWSER_TEMPLATE_NAME")
                )
                return operation(sandbox, timeout=60000)
</code></pre>
<h3 id="æ§è½é®é¢">æ§è½é®é¢</h3>
<p><strong>é®é¢</strong>ï¼ååºéåº¦æ¢</p>
<p><strong>ä¼åå»ºè®®</strong>ï¼</p>
<ol>
<li><strong>ä½¿ç¨è¿æ¥æ± </strong>ï¼é¢ååå»ºå¤ä¸ª Sandbox å®ä¾</li>
<li><strong>å¯ç¨ keep_alive</strong>ï¼ä¿ææµè§å¨ä¼è¯ï¼é¿åéå¤å»ºç«è¿æ¥</li>
<li><strong>åçè®¾ç½®è¶æ¶</strong>ï¼æ ¹æ®ä»»å¡å¤æåº¦è°æ´è¶æ¶æ¶é´</li>
<li><strong>å¹¶åæ§å¶</strong>ï¼éå¶å¹¶åè¯·æ±æ°ï¼é¿åèµæºç«äº</li>
</ol>
<pre><code class="language-python"># æ§è½ä¼åéç½®ç¤ºä¾
browser_session = BrowserSession(
    cdp_url=sandbox.cdp_url,
    browser_profile=BrowserProfile(
        timeout=30000,          # 30ç§è¶æ¶
        keep_alive=True,        # ä¿æè¿æ¥
        disable_security=False  # ä¿æå®å¨æ£æ¥
    )
)
</code></pre>
<h3 id="éè¯¯ç åè">éè¯¯ç åè</h3>
<table>
<thead>
<tr>
<th>éè¯¯ç </th>
<th>è¯´æ</th>
<th>è§£å³æ¹æ¡</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ConnectionError</code></td>
<td>è¿æ¥å¤±è´¥</td>
<td>æ£æ¥ç½ç»è¿æ¥ï¼éªè¯ CDP URL</td>
</tr>
<tr>
<td><code>TimeoutError</code></td>
<td>æä½è¶æ¶</td>
<td>å¢å è¶æ¶æ¶é´ï¼æ£æ¥ä»»å¡å¤æåº¦</td>
</tr>
<tr>
<td><code>AuthenticationError</code></td>
<td>è®¤è¯å¤±è´¥</td>
<td>éªè¯ API Key åè®¿é®å¯é¥</td>
</tr>
<tr>
<td><code>ResourceExhausted</code></td>
<td>èµæºä¸è¶³</td>
<td>åå°å¹¶åæ°ï¼å¢å èµæºéé¢</td>
</tr>
<tr>
<td><code>InvalidArgument</code></td>
<td>åæ°éè¯¯</td>
<td>æ£æ¥åæ°æ ¼å¼åæææ§</td>
</tr>
</tbody>
</table>
<h2 id="æ»ç»">æ»ç»</h2>
<p>éè¿æ¬æåï¼æ¨å·²ç»ææ¡äºï¼</p>
<ol>
<li><strong>BrowserUse éæ</strong>ï¼å¦ä½ä½¿ç¨ BrowserUse æ¡æ¶å®ç°æºè½æµè§å¨èªå¨å</li>
<li><strong>çå½å¨æç®¡ç</strong>ï¼ä¸ç§ Sandbox ç®¡çæ¨¡å¼çéæ©åå®ç°</li>
<li><strong>æ§è½ä¼å</strong>ï¼è¶æ¶éç½®ãå¤ç¨ç­ç¥ãéè¯¯éè¯æºå¶</li>
<li><strong>å®å¨å®è·µ</strong>ï¼ç¯å¢åéä¿æ¤ãURL ç½ååãæ¥å¿è±æ</li>
<li><strong>å¯è§æµæ§</strong>ï¼æ¥å¿è®°å½ãææ æ¶éãçæ§åè­¦</li>
<li><strong>ææ¬ä¼å</strong>ï¼æéåå»ºãé²ç½®æ¸çãæ¹éå¤ç</li>
<li><strong>çäº§é¨ç½²</strong>ï¼é«å¯ç¨æ¶æãå¥åº·æ£æ¥ãæéææ¥</li>
</ol>
<h2 id="ç«å³ä½éªå½æ°è®¡ç®-agentrun">ç«å³ä½éªå½æ°è®¡ç® AgentRun</h2>
<p>å½æ°è®¡ç® AgentRun çæ ä»£ç å°é«ä»£ç æ¼è¿è½åï¼ç°å·²å¼æ¾ä½éªï¼</p>
<ol>
<li><strong>å¿«éåå»º</strong>ï¼è®¿é®æ§å¶å°ï¼<a href="https://functionai.console.aliyun.com/cn-hangzhou/agent/explore" target="_blank" rel="noopener nofollow">https://functionai.console.aliyun.com/cn-hangzhou/agent/explore</a>ï¼ï¼60ç§åå»ºä½ çç¬¬ä¸ä¸ª Agent</li>
<li><strong>æ·±åº¦å®å¶</strong>ï¼å½éè¦æ´å¤æåè½æ¶ï¼ä¸é®è½¬æ¢ä¸ºé«ä»£ç </li>
<li><strong>æç»­æ¼è¿</strong>ï¼å©ç¨å½æ°è®¡ç® AgentRun çåºç¡è®¾æ½è½åï¼æç»­ä¼åä½ ç Agent</li>
</ol>
<p>ä»æ³æ³å°ä¸çº¿ï¼ä»ååå°çäº§ï¼å½æ°è®¡ç® AgentRun å§ç»æ¯ä½ æå¥½çä¼ä¼´ã<strong>æ¬¢è¿å å¥âå½æ°è®¡ç® AgentRun å®¢æ·ç¾¤âï¼ééç¾¤å·ï¼<em>134570017218</em>ã</strong></p>
<h2 id="å¿«éäºè§£å½æ°è®¡ç®-agentrun">å¿«éäºè§£å½æ°è®¡ç® AgentRun</h2>
<p><strong>ä¸å¥è¯ä»ç»ï¼</strong><a href="https://www.aliyun.com/product/fc/agentrun" target="_blank" rel="noopener nofollow">å½æ°è®¡ç® AgentRun</a> æ¯ä¸ä¸ªä»¥é«ä»£ç ä¸ºæ ¸å¿çä¸ç«å¼ Agentic AI åºç¡è®¾æ½å¹³å°ãç§æçæå¼æ¾åçµæ´»ç»è£ççå¿µï¼ä¸ºä¼ä¸çº§ Agent åºç¨æä¾ä»å¼åãé¨ç½²å°è¿ç»´çå¨çå½å¨æç®¡çã</p>

<p><img alt="" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2123714/202601/2123714-20260120161152854-681277385.png" class="lazyload"></p>
<p>å½æ°è®¡ç® AgentRun æ¶æå¾</p>
<p>AgentRun è¿è¡æ¶åºäºé¿éäºå½æ°è®¡ç® FC æå»ºï¼ç»§æ¿äº Serverless è®¡ç®æè´å¼¹æ§ãæéä»è´¹ãé¶è¿ç»´çæ ¸å¿ä¼å¿ãéè¿æ·±åº¦éæ AgentScopeãLangChainãRAGFlowãMem0 ç­ä¸»æµå¼æºçæãå½æ°è®¡ç® AgentRun å° Serverless çæè´å¼¹æ§ãé¶è¿ç»´åæéä»è´¹çç¹æ§ä¸ AI åçåºç¨åºæ¯æ·±åº¦èåï¼å©åä¼ä¸å®ç°ææ¬ä¸æççæè´ä¼åï¼<strong>å¹³å TCO éä½ 60%</strong>ã</p>
<p><strong>è®©å¼åèåªéä¸æ³¨äº Agent çä¸å¡é»è¾åæ°ï¼æ éå³å¿åºå±åºç¡è®¾æ½ï¼è®© Agentic AI çæ­£è¿å¥ä¼ä¸çäº§ç¯å¢ã</strong></p>
<p><strong>æ¨èéè¯»ï¼</strong></p>
<ul>
<li>éè¯»<a href="https://yuque.alibaba-inc.com/agentrun/dxnn5p/rcpbigg7gthpa2u4" target="_blank" rel="noopener nofollow">ãå¿«éä¸æï¼LangChain + AgentRun æµè§å¨æ²ç®±æç®éææåã</a>å¤ä¹ åºç¡éæå LangChain éæ</li>
<li>æ¥ç<a href="https://docs.agent.run" target="_blank" rel="noopener nofollow">å®æ¹ææ¡£</a>äºè§£æ´å¤ AgentRun åè½</li>
<li>è®¿é®<a href="https://github.com/devsapp/agentrun-sandbox-demos" target="_blank" rel="noopener nofollow">ç¤ºä¾ä»£ç ä»åº</a> è·ååèä»£ç </li>
</ul>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 16:12">2026-01-20 16:12</span>&nbsp;
<a href="https://www.cnblogs.com/Serverless">Serverlessç¤¾åº</a>&nbsp;
éè¯»(<span id="post_view_count">75</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19507367);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19507367', targetLink: 'https://www.cnblogs.com/Serverless/p/19507367', title: 'è¿é¶æåï¼BrowserUse + Agentrun Sandbox æä½³å®è·µæå' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ åºäºspringbootç³»ç»ï¼å¦ä½è·è¸ªä¼è¯è¿æï¼æµè§å¨ä¼è¯æ è¯æ¯å¦æ¶å°æ­£å¸¸ååºï¼å­å¨ï¼å¹¶å¨åç»­è¯·æ±ä¿ææºå¸¦ ]]></title>
    <link>https://www.cnblogs.com/liuyangjava/p/19507022</link>
    <guid>7f8c91d0c36076fedcd26591f3cdf142</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/liuyangjava/p/19507022" title="åå¸äº 2026-01-20 15:22">
    <span role="heading" aria-level="2">åºäºspringbootç³»ç»ï¼å¦ä½è·è¸ªä¼è¯è¿æï¼æµè§å¨ä¼è¯æ è¯æ¯å¦æ¶å°æ­£å¸¸ååºï¼å­å¨ï¼å¹¶å¨åç»­è¯·æ±ä¿ææºå¸¦</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>ä»å¤©æä»¬åäº«ä¸ä¸ªé¡¹ç®å¼åä¸­çåºç°æä½æä¸ªä¸å¡æ¶åï¼<span style="color: rgba(224, 62, 45, 1); font-size: 18px"><strong>åºç°éªé</strong></span>çç»å¸é®é¢ï¼éå¯¹èæ§çSpring MVCç³»ç»ï¼è¦ç³»ç»æ§å°è·è¸ªä¼è¯ï¼Sessionï¼çå½å¨æåCookieçæºå¸¦æåµï¼æä»¬éè¦ä¸å¥æ¸æ°çãä»æµè§å¨å°æå¡å¨çææ¥æ¹æ¡ãä»¥ä¸æ¯è¯¦ç»çè·è¸ªæ­¥éª¤åæ¹æ³ã</p>
<p>å½ç¶è¿ä¸ªææ¥æ­¥éª¤åæ¹æ³ï¼ä¹éååºæ¬SpringBootå¼åçç³»ç»ï¼ä½æ¯æå¡ç«¯çææ¥éè¦å¤§å®¶æ ¹æ®å®éæåµä¿®æ¹åç«¯ææ¥æ¥å¿ãæ¦æªå¨ç­æ¹æ³</p>
<h3>æ´ä½ææ¥æè·¯</h3>
<p>æä»¬çç®æ æ¯éªè¯ä»¥ä¸ä¸ä¸ªç¯èæ¯å¦æ­£å¸¸ï¼</p>
<ol class="ybc-ol-component ybc-ol-component_1">
<li class="ybc-li-component ybc-li-component_ol">
<p><strong>ç»å½æåæ¶</strong>ï¼æå¡å¨æ¯å¦æ­£ç¡®çæäºSessionå¹¶è¿åäºåå«æ­£ç¡® <code class="hyc-common-markdown__code__inline">JSESSIONID</code>çCookieç»æµè§å¨ã</p>
</li>
<li class="ybc-li-component ybc-li-component_ol">
<p><strong>æµè§å¨ç«¯</strong>ï¼æµè§å¨æ¯å¦æåæ¥æ¶å¹¶å­å¨äºè¯¥Cookieã</p>
</li>
<li class="ybc-li-component ybc-li-component_ol">
<p><strong>åç»­è¯·æ±</strong>ï¼æµè§å¨å¨æ§è¡æ¥è¯¢ç­æä½æ¶ï¼æ¯å¦å§ç»å¨è¯·æ±å¤´ä¸­æºå¸¦äºè¿ä¸ªCookieã</p>
</li>
</ol>
<h3>ç¬¬ä¸æ­¥ï¼æµè§å¨ç«¯è·è¸ªï¼å®¢æ·ç«¯éªè¯ï¼</h3>
<p>è¿æ¯æç´æ¥ãæå®¹ææä½çç¬¬ä¸æ­¥ï¼å¯ä»¥ç±å¼åæè¿ç»´äººåå¨é®é¢çµèä¸è¿è¡ã</p>
<p>ä¸ãè·è¸ªä¼è¯æ è¯ï¼Cookieï¼çæ¥æ¶ä¸å­å¨</p>
<ol class="ybc-ol-component ybc-ol-component_1">
<li class="ybc-li-component ybc-li-component_ol">
<p><strong>å¼å¯æµè§å¨å¼åèå·¥å·</strong>ï¼ä½¿ç¨åºç°é®é¢çæµè§å¨ï¼å¦å¥å®ä¿¡ãChromeï¼ï¼æ <code class="hyc-common-markdown__code__inline">F12</code>æå¼å¼åèå·¥å·ã</p>
</li>
<li class="ybc-li-component ybc-li-component_ol">
<p><strong>åæ¢å°Network/ç½ç»é¢æ¿</strong>ï¼å¾é <strong><code class="hyc-common-markdown__code__inline">Preserve log</code>(ä¿çæ¥å¿)</strong>â å¤éæ¡ï¼é²æ­¢é¡µé¢è·³è½¬æ¶æ¥å¿è¢«æ¸ç©ºã</p>
</li>
<li class="ybc-li-component ybc-li-component_ol">
<p><strong>æ¸ç©ºCookieï¼å¯éï¼ä¸ºäºçº¯åçæµè¯ï¼</strong>ï¼å¨å¼åèå·¥å·ç <code class="hyc-common-markdown__code__inline">Application</code>ï¼åºç¨ï¼æ <code class="hyc-common-markdown__code__inline">Storage</code>ï¼å­å¨ï¼æ ç­¾é¡µä¸ï¼æ¾å° <code class="hyc-common-markdown__code__inline">Cookies</code>ï¼éä¸­å½åç³»ç»å°åçCookieï¼å°å¶å é¤ãè¿å¯ä»¥æ¨¡æä¸æ¬¡å¨æ°çç»å½ã</p>
</li>
<li class="ybc-li-component ybc-li-component_ol">
<p><strong>æ§è¡ç»å½</strong>ï¼</p>
<ul class="ybc-ul-component">
<li class="ybc-li-component ybc-li-component_ul">
<p>å¨å°åæ è¾å¥ç³»ç»åèç¹å°åï¼å¦ <code class="hyc-common-markdown__code__inline">http://10.15.9.106/...</code>ï¼è¿è¡ç»å½ã</p>
</li>
<li class="ybc-li-component ybc-li-component_ul">
<p>å¨Networké¢æ¿ä¸­ï¼æ¾å°ç»å½è¯·æ±ï¼éå¸¸æ¯ <code class="hyc-common-markdown__code__inline">login</code>æ <code class="hyc-common-markdown__code__inline">j_spring_security_check</code>ä¹ç±»çPOSTè¯·æ±ï¼ã</p>
</li>
<li class="ybc-li-component ybc-li-component_ul">
<p><strong>éç¹æ¥çç»å½è¯·æ±çååº</strong>ï¼</p>
<ul class="ybc-ul-component">
<li class="ybc-li-component ybc-li-component_ul">
<p>ç¹å»è¿ä¸ªç»å½è¯·æ±ï¼æ¥ç <code class="hyc-common-markdown__code__inline">Response Headers</code>ï¼ååºå¤´ï¼ã</p>
</li>
<li class="ybc-li-component ybc-li-component_ul">
<p>ä½ åºè¯¥è½çå°ä¸ä¸ª <code class="hyc-common-markdown__code__inline">Set-Cookie</code>å¤´ï¼åå®¹ç±»ä¼¼äº <code class="hyc-common-markdown__code__inline">JSESSIONID=ABCD1234...; Path=/; HttpOnly</code>ã</p>
</li>
<li class="ybc-li-component ybc-li-component_ul">
<p><strong>è®°å½ä¸è¿ä¸ª <code class="hyc-common-markdown__code__inline">JSESSIONID</code>çå¼</strong>ã</p>
</li>
</ul>
</li>
</ul>
</li>
<li class="ybc-li-component ybc-li-component_ol">
<p><strong>éªè¯Cookieå­å¨</strong>ï¼</p>
<ul class="ybc-ul-component">
<li class="ybc-li-component ybc-li-component_ul">
<p>åæ¢å° <code class="hyc-common-markdown__code__inline">Application/åºç¨</code>æ ç­¾é¡µã</p>
</li>
<li class="ybc-li-component ybc-li-component_ul">
<p>å¨å·¦ä¾§æ¾å° <code class="hyc-common-markdown__code__inline">Cookies</code>-&gt; <code class="hyc-common-markdown__code__inline">http://10.15.9.106</code>ã</p>
</li>
<li class="ybc-li-component ybc-li-component_ul">
<p>æ£æ¥æ¯å¦å­å¨ä¸ä¸ªåä¸º <code class="hyc-common-markdown__code__inline">JSESSIONID</code>çCookieï¼å¶å¼æ¯å¦ä¸åæå¨ååºå¤´ä¸­çå°çä¸è´ã</p>
</li>
</ul>
</li>
</ol>
<p><strong>è³æ­¤ï¼æä»¬éªè¯äºç¯è1å2ã<span style="color: rgba(224, 62, 45, 1)">å¦æè¿éå°±åºé®é¢ï¼é£ä¹æ ¹æºå¨æå¡å¨ååºææµè§å¨å®å¨ç­ç¥ä¸</span>ã</strong></p>
<p>äºãè·è¸ªåç»­è¯·æ±çCookieæºå¸¦æåµ</p>
<ol class="ybc-ol-component ybc-ol-component_1">
<li class="ybc-li-component ybc-li-component_ol">
<p><strong>è¿è¡æ­£å¸¸æä½</strong>ï¼ç»å½æååï¼å¨ç³»ç»åè¿è¡ä¸äºä¸ä¼è§¦åéªéçç®åæä½ï¼æ¯å¦ç¹å»èåã</p>
</li>
<li class="ybc-li-component ybc-li-component_ol">
<p><strong>è§å¯è¯·æ±</strong>ï¼å¨Networké¢æ¿ä¸­ï¼è§å¯è¿äºæä½è§¦åçAjaxæé¡µé¢è¯·æ±ã</p>
</li>
<li class="ybc-li-component ybc-li-component_ol">
<p><strong>æ£æ¥è¯·æ±å¤´</strong>ï¼éæºç¹å»å ä¸ªåç»­è¯·æ±ï¼æ¥çå®ä»¬ç <code class="hyc-common-markdown__code__inline">Request Headers</code>ï¼è¯·æ±å¤´ï¼ã</p>
<ul class="ybc-ul-component">
<li class="ybc-li-component ybc-li-component_ul">
<p>å¿é¡»æ¾å°ä¸ä¸ª <code class="hyc-common-markdown__code__inline">Cookie:</code>å¤´ï¼å¶åå®¹åºåå« <code class="hyc-common-markdown__code__inline">JSESSIONID=ABCD1234...</code>ï¼å³ç»å½æ¶è®¾ç½®çé£ä¸ªå¼ï¼ã</p>
</li>
<li class="ybc-li-component ybc-li-component_ul">
<p><strong>ç¡®ä¿æ¯ä¸ªè¯·æ±é½æºå¸¦äºè¿ä¸ªCookie</strong>ã</p>
</li>
</ul>
</li>
<li class="ybc-li-component ybc-li-component_ol">
<p><strong>è§¦åéªéï¼å³é®æ­¥éª¤ï¼</strong>ï¼</p>
<ul class="ybc-ul-component">
<li class="ybc-li-component ybc-li-component_ul">
<p>è¿è¡é£ä¸ª<strong>å·²ç¥ä¼å¼åéªéçæ¥è¯¢æä½</strong>ã</p>
</li>
<li class="ybc-li-component ybc-li-component_ul">
<p><strong>å¯åè§å¯Networké¢æ¿</strong>ï¼å¨ç¹å»âæ¥è¯¢âæé®åï¼ç¬é´ååºçè¯·æ±ã</p>
</li>
<li class="ybc-li-component ybc-li-component_ul">
<p><strong>éç¹æ£æ¥è§¦åéªéçé£ä¸ªç¹å®æ¥è¯¢è¯·æ±</strong>ï¼</p>
<ul class="ybc-ul-component">
<li class="ybc-li-component ybc-li-component_ul">
<p><strong>æåµAï¼æ­£å¸¸ï¼</strong>ï¼è¯¥è¯·æ±ç <code class="hyc-common-markdown__code__inline">Request Headers</code>éæ­£å¸¸æºå¸¦äº <code class="hyc-common-markdown__code__inline">JSESSIONID</code>ï¼ä½æå¡å¨è¿åäºä¸ä¸ª <code class="hyc-common-markdown__code__inline">302 Found</code>ç¶æç ï¼Locationæåç»å½é¡µï¼æèç´æ¥è¿åäºç»å½é¡µçHTMLï¼ç¶æç 200ï¼ã<strong>è¿è¯´æé®é¢åºå¨æå¡å¨ç«¯ï¼æå¡å¨ä¸»å¨åºå¼äºä¼è¯ã</strong></p>
</li>
<li class="ybc-li-component ybc-li-component_ul">
<p><strong>æåµBï¼å¼å¸¸ï¼</strong>ï¼è¯¥è¯·æ±ç <code class="hyc-common-markdown__code__inline">Request Headers</code>é<strong>æ²¡æ</strong>â <code class="hyc-common-markdown__code__inline">Cookie</code>å¤´ï¼æè <code class="hyc-common-markdown__code__inline">JSESSIONID</code>çå¼åæäºç©ºãéè¯¯æä¸ä¸ªæ°çå¼ã<strong>è¿è¯´æé®é¢åºå¨æµè§å¨ç«¯ï¼Cookieå¨åéåä¸¢å¤±äºã</strong></p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><span style="font-size: 16px"><strong>ç¬¬äºæ­¥ï¼æå¡å¨ç«¯è·è¸ªï¼ä»£ç ä¸æ¥å¿å±é¢ï¼</strong></span></p>
<p>å¦ææµè§å¨ç«¯è·è¸ªæåäºâæåµAâï¼Cookieæºå¸¦æ­£å¸¸ï¼ä½æå¡å¨è¿åç»å½é¡µï¼ï¼é£ä¹é®é¢æ ¹å å¨æå¡å¨åé¨ã</p>
<p>ä¸ãå¯ç¨è¯¦ç»æ¥å¿è®°å½ï¼æææçæ¹æ³ï¼</p>
<p>å¦æè¿ä¸ªèç³»ç»å¯è½æ¥å¿ä¸å¨ï¼æä»¬éè¦ä¸´æ¶å¢å ä¼è¯è·è¸ªæ¥å¿ã</p>
<p><strong>1.å¨<code class="hyc-common-markdown__code__inline">web.xml</code>ä¸­éç½®Sessionçå¬å¨</strong>ï¼</p>
<p>åå»ºä¸ä¸ªç±»ï¼å®ç° <code class="hyc-common-markdown__code__inline">HttpSessionListener</code>å <code class="hyc-common-markdown__code__inline">HttpSessionAttributeListener</code>æ¥å£ï¼å¹¶é¨ç½²å°çäº§ç¯å¢ãè¿ä¸ªç±»å¯ä»¥è®°å½Sessionçåå»ºãéæ¯åå±æ§ååã</p>
<pre class="language-java highlighter-hljs"><code>import javax.servlet.http.HttpSessionEvent;
import javax.servlet.http.HttpSessionAttributeListener;
import javax.servlet.http.HttpSessionBindingEvent;
import java.util.logging.Logger; // æä½¿ç¨Log4jãSlf4j

public class SessionDebugListener implements HttpSessionListener, HttpSessionAttributeListener {

    private static final Logger logger = Logger.getLogger(SessionDebugListener.class.getName());

    @Override
    public void sessionCreated(HttpSessionEvent se) {
        logger.info("ï¼ï¼ï¼ Sessionè¢«åå»º: ID=" + se.getSession().getId() + "ï¼ æ¶é´=" + new java.util.Date());
    }

    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        // è¿æ¯æå³é®çä¿¡æ¯ï¼ä¼è¯ä½æ¶ãä¸ºä½è¢«éæ¯ï¼
        logger.info("ï¼ï¼ï¼ Sessionè¢«éæ¯: ID=" + se.getSession().getId() + "ï¼ æ¶é´=" + new java.util.Date() + "ã æåè®¿é®æ¶é´: " + new java.util.Date(se.getSession().getLastAccessedTime()));
        // å¯ä»¥å¨è¿éæå°å æ ä¿¡æ¯ï¼çæ¯åªä¸ªçº¿ç¨è§¦åäºéæ¯
        Thread.dumpStack();
    }

    @Override
    public void attributeAdded(HttpSessionBindingEvent event) {
        if ("user".equals(event.getName())) { // çå¬ç¨æ·ç»å½å±æ§
            logger.info("ï¼ï¼ï¼ ç¨æ·ç»å½æåï¼Userå¯¹è±¡è¢«å­å¥Sessionã SessionID=" + event.getSession().getId() + ", User=" + event.getValue());
        }
    }

    @Override
    public void attributeRemoved(HttpSessionBindingEvent event) {
        if ("user".equals(event.getName())) { // çå¬ç¨æ·ç»åºå±æ§
            logger.info("ï¼ï¼ï¼ ç¨æ·ç»åºï¼Userå¯¹è±¡ä»Sessionç§»é¤ã SessionID=" + event.getSession().getId());
        }
    }
}</code></pre>
<p>å¨ <code class="hyc-common-markdown__code__inline">web.xml</code>ä¸­æ³¨åï¼</p>
<pre class="language-xml highlighter-hljs"><code>&lt;listener&gt;
    &lt;listener-class&gt;com.yourcompany.SessionDebugListener&lt;/listener-class&gt;
&lt;/listener&gt;</code></pre>
<p><strong>2.å¨è¿æ»¤å¨ä¸­è®°å½è¯·æ±</strong>ï¼</p>
<p>å¨ä¸ä¸ªå¨å±çFilterä¸­ï¼å¦æå·²æï¼åä¿®æ¹å®ï¼ï¼è®°å½æ¯ä¸ªè¯·æ±çSessionç¶æã</p>
<pre class="language-java highlighter-hljs"><code>public class SessionTrackingFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse res = (HttpServletResponse) response;

        String sessionId = req.getRequestedSessionId();
        boolean sessionValid = req.isRequestedSessionIdValid();

        logger.info("è¯·æ±è¿å¥: URI=" + req.getRequestURI() + 
                   ", SessionID=" + sessionId + 
                   ", Sessionæ¯å¦ææ=" + sessionValid);

        chain.doFilter(request, response);

        // è¯·æ±å¤çåï¼åæ¬¡æ£æ¥Sessionç¶æ
        sessionValid = req.isRequestedSessionIdValid();
        logger.info("è¯·æ±ç¦»å¼: URI=" + req.getRequestURI() + 
                   ", Sessionæ¯å¦ææ=" + sessionValid);
    }
}</code></pre>
<p>é¨ç½²è¿äºçå¬å¨åè¿æ»¤å¨åï¼éç°éªéé®é¢ãç¶åç«å³æ¥çæå¡å¨æ¥å¿ï¼å¯»æ¾ <code class="hyc-common-markdown__code__inline">ï¼ï¼ï¼ Sessionè¢«éæ¯</code>è¿æ¡å³é®æ¥å¿ãå®ä¼åè¯ä½ Sessionè¢«éæ¯çç²¾ç¡®æ¶é´ï¼ç»åå æ ä¿¡æ¯ï¼å°±è½å®ä½å°æ¯åªä¸ªä»£ç è·¯å¾æéç½®è§¦åäºéæ¯ã</p>
<p>äºãåææå¡å¨çº¿ç¨æ </p>
<p>å¦ææçæ¯<strong>ä¼è¯éè¶æ¶</strong>ï¼éè¦å¨éªéåçæ¶ï¼ç«å»è·åæå¡å¨ççº¿ç¨å æ å¿«ç§ï¼<code class="hyc-common-markdown__code__inline">jstack &lt;pid&gt;</code>ï¼ãåæå¿«ç§ï¼çæ¯å¦æçº¿ç¨é¿æ¶é´ææSessionéï¼ç¶æä¸º <code class="hyc-common-markdown__code__inline">RUNNABLE</code>ä¸æ­£å¨æ§è¡æ¥è¯¢SQLï¼ï¼èå¶ä»çº¿ç¨å¨ç­å¾è¿ä¸ªéï¼ç¶æä¸º <code class="hyc-common-markdown__code__inline">BLOCKED</code>ï¼ã</p>
<h3>æ»ç»ï¼è·è¸ªæµç¨ä¸è§è¡¨</h3>
<div class="hyc-common-markdown__table-wrapper" data-has-scroll="true">
<table>
<thead>
<tr>
<th>
<p>æ­¥éª¤</p>
</th>
<th>
<p>è·è¸ªç¹</p>
</th>
<th>
<p>æ¹æ³</p>
</th>
<th>
<p>ææç»æ</p>
</th>
<th>
<p>å¼å¸¸ç»æä¸å«ä¹</p>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p><strong>1</strong>â</p>
</td>
<td>
<p><strong>æµè§å¨æ¥æ¶Cookie</strong>â</p>
</td>
<td>
<p>F12 -&gt; Network -&gt; æ¥çç»å½è¯·æ±ç <code class="hyc-common-markdown__code__inline">Set-Cookie</code>ååºå¤´</p>
</td>
<td>
<p>æ¶å°æ­£ç¡®ç <code class="hyc-common-markdown__code__inline">JSESSIONID</code></p>
</td>
<td>
<p>æªæ¶å°ï¼æå¡å¨ååºé®é¢</p>
</td>
</tr>
<tr>
<td>
<p><strong>2</strong>â</p>
</td>
<td>
<p><strong>æµè§å¨å­å¨Cookie</strong>â</p>
</td>
<td>
<p>F12 -&gt; Application -&gt; Cookies</p>
</td>
<td>
<p>å­å¨äºæ­£ç¡®ç <code class="hyc-common-markdown__code__inline">JSESSIONID</code></p>
</td>
<td>
<p>æªå­å¨ï¼æµè§å¨å®å¨ç­ç¥é»æ­¢</p>
</td>
</tr>
<tr>
<td>
<p><strong>3</strong>â</p>
</td>
<td>
<p><strong>åç»­è¯·æ±æºå¸¦Cookie</strong>â</p>
</td>
<td>
<p>F12 -&gt; Network -&gt; æ¥çæ¥è¯¢è¯·æ±ç <code class="hyc-common-markdown__code__inline">Cookie</code>è¯·æ±å¤´</p>
</td>
<td>
<p>æºå¸¦äºç»å½æ¶ç <code class="hyc-common-markdown__code__inline">JSESSIONID</code></p>
</td>
<td>
<p>æªæºå¸¦/å¼éè¯¯ï¼æµè§å¨ç«¯Cookieä¸¢å¤±</p>
</td>
</tr>
<tr>
<td>
<p><strong>4</strong>â</p>
</td>
<td>
<p><strong>æå¡å¨å¤çè¯·æ±</strong>â</p>
</td>
<td>
<p>æ¥çæå¡å¨æ¥å¿/çå¬å¨æ¥å¿</p>
</td>
<td>
<p>Sessionææï¼è¯·æ±æ­£å¸¸å¤ç</p>
</td>
<td>
<p>æ¥å¿æ¾ç¤ºSessionè¢«éæ¯ï¼æå¡å¨ç«¯ä¸»å¨åºå¼ä¼è¯</p>
</td>
</tr>
<tr>
<td>
<p><strong>5</strong>â</p>
</td>
<td>
<p><strong>æå¡å¨å¹¶åæåµ</strong>â</p>
</td>
<td>
<p>åæçº¿ç¨å æ å¿«ç§ (<code class="hyc-common-markdown__code__inline">jstack</code>)</p>
</td>
<td>
<p>æ é¿æ¶é´éç­å¾</p>
</td>
<td>
<p>æçº¿ç¨å ç­å¾Sessionéèé»å¡ï¼ä¼è¯éè¶æ¶é®é¢</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>è¯·æç§è¿ä¸ªæµç¨è¿è¡æä½ï¼å¾å¤§æ¦çè½ç´æ¥å®ä½å°é®é¢åççå·ä½ç¯èãåä»<strong>æµè§å¨ç«¯è·è¸ª</strong>å¼å§ï¼è¿éå¸¸è½ç»åºæç´æ¥ççº¿ç´¢ã</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 15:22">2026-01-20 15:22</span>&nbsp;
<a href="https://www.cnblogs.com/liuyangjava">å­å¢¨èå¸</a>&nbsp;
éè¯»(<span id="post_view_count">123</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19507022);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19507022', targetLink: 'https://www.cnblogs.com/liuyangjava/p/19507022', title: 'åºäºspringbootç³»ç»ï¼å¦ä½è·è¸ªä¼è¯è¿æï¼æµè§å¨ä¼è¯æ è¯æ¯å¦æ¶å°æ­£å¸¸ååºï¼å­å¨ï¼å¹¶å¨åç»­è¯·æ±ä¿ææºå¸¦' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Docker åçº§å VS Code æ¬å°è°è¯ AWS Lambda æ¥ãRunning AWS SAM projects locally requires Dockerãçé£äºåä¸ææ¥æè·¯ ]]></title>
    <link>https://www.cnblogs.com/wanghaiwei/p/19505845</link>
    <guid>38e867841b1fb5353da44bffc0034dab</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/wanghaiwei/p/19505845" title="åå¸äº 2026-01-20 11:48">
    <span role="heading" aria-level="2">Docker åçº§å VS Code æ¬å°è°è¯ AWS Lambda æ¥ãRunning AWS SAM projects locally requires Dockerãçé£äºåä¸ææ¥æè·¯</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="ä¸é®é¢åºæ¯æè¿°">ä¸ãé®é¢åºæ¯æè¿°</h2>
<ul>
<li>
<p>å¨ VS Code ä¸­ä½¿ç¨ AWS Toolkit æ¬å°è°è¯ Lambdaï¼åºäº AWS SAM é¡¹ç®ï¼æ¶ï¼ç¹å»æ¬å°è¿è¡/è°è¯ï¼åºç°æç¤ºï¼<br>
âRunning AWS SAM projects locally requires Docker. Have you got it installed and running?â</p>
</li>
<li>
<p>å®éæåµæ¯ï¼æ¬å°å·²ç»å®è£å¹¶è¿è¡ Docker Desktopï¼ä½¿ç¨å½ä»¤è¡æ§è¡&nbsp;<code>docker ps</code>ã<code>docker info</code>&nbsp;ç­é½æ­£å¸¸ï¼å®¹å¨ç¯å¢å¯ç¨ã[<a href="https://stackoverflow.com/questions/50791354/running-aws-sam-projects-locally-get-error" target="_blank" rel="noopener nofollow">stackoverflow</a>]â</p>
</li>
<li>
<p>æ¢å¥è¯è¯´ï¼<strong>Docker ææå¨è·ï¼ä½ VS Code + SAM CLI åæè¯´âæ¾ä¸å° Dockerâ</strong>ã[<a href="https://stackoverflow.com/questions/50791354/running-aws-sam-projects-locally-get-error" target="_blank" rel="noopener nofollow">stackoverflow</a>]â</p>
</li>
</ul>
<hr>
<h2 id="äºæç»ç¡®è®¤çæ ¹å ä½ è¿æ¬¡éå°ç">äºãæç»ç¡®è®¤çæ ¹å ï¼ä½ è¿æ¬¡éå°çï¼</h2>
<ul>
<li>
<p>ä½ æ¾å°çæç»åå æ¯ï¼<strong>å¨åçº§ Docker Desktop ä¹åï¼æ¬å°ç AWS SAM CLI ä»¥åå³ç³»ç´§å¯ç AWS å·¥å·é¾ï¼å¦ VS Code æä»¶ï¼çæ¬æ²¡æåæ­¥åçº§ï¼å¯¼è´ä¸æ° Docker çæ¬ç API/è¡ä¸ºä¸å¼å®¹</strong>ã[<a href="https://stackoverflow.com/questions/50791354/running-aws-sam-projects-locally-get-error" target="_blank" rel="noopener nofollow">stackoverflow</a>]â</p>
</li>
<li>
<p>åçº§ AWS SAM CLI å AWS ç¸å³æä»¶å°ææ°çæ¬åï¼éè¯¯æç¤ºæ¶å¤±ï¼æ¬å°è°è¯æ¢å¤æ­£å¸¸ã[<a href="https://stackoverflow.com/questions/50791354/running-aws-sam-projects-locally-get-error" target="_blank" rel="noopener nofollow">stackoverflow</a>]</p>
</li>
<li>
<p>åçº§æ¹æ³ï¼è·çå®æ¹ææ¡£éæ°ä¸è½½å®è£åï¼ä¼èªå¨åçº§ï¼<a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/install-sam-cli.html#install-sam-cli-instructions%E2%80%8B" target="_blank" rel="noopener nofollow">https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/install-sam-cli.html#install-sam-cli-instructionsâ</a></p>
</li>
</ul>
<p>è¿ä¸ç¹å¯ä»¥ä½ä¸ºä½ åäº«éçâä¸»çº¿æäºââââéå½¢ççæ¬å¼å®¹é®é¢âã</p>
<hr>
<h2 id="ä¸å¯è½çåå æ»è§å¯ç¨ä½åäº«ä¸­ç-checklist">ä¸ãå¯è½çåå æ»è§ï¼å¯ç¨ä½åäº«ä¸­ç checklistï¼</h2>
<p>ä½ å¯ä»¥æâä»æåºç¡å°åé«çº§âçé¡ºåºä»ç»ï¼å¸®å©å¬ä¼å½¢æææ¥æè·¯ã</p>
<h3 id="31-docker-æ¬èº«ççæ²¡è£--æ²¡å¯å¨">3.1 Docker æ¬èº«ççæ²¡è£ / æ²¡å¯å¨</h3>
<p>è½ç¶çèµ·æ¥å¾åºç¡ï¼ä½å¨å¢ééç»å¸¸æ¯æçå®çæåµï¼å¯ä»¥ç®è¦æä¸ä¸ã[<a href="https://stackoverflow.com/questions/50791354/running-aws-sam-projects-locally-get-error" target="_blank" rel="noopener nofollow">stackoverflow</a>]â</p>
<ul>
<li>
<p>æªå®è£ Docker Desktop æå¶ä» Docker å¼æã</p>
</li>
<li>
<p>Docker Desktop å·²å®è£ï¼ä½å½åæ²¡æå¯å¨ï¼æçå¾æ è¿å¨ starting / æª running ç¶æï¼ã</p>
</li>
<li>
<p>å¨ VS Code éæç»ç«¯ä¸­è¿è¡&nbsp;<code>docker ps</code>&nbsp;æ¥âCannot connect to the Docker daemonâç­éè¯¯ã</p>
</li>
</ul>
<p><strong>å®ä½æ¹å¼</strong></p>
<ul>
<li>
<p>æå¼ VS Code éæç»ç«¯ï¼æ§è¡&nbsp;<code>docker ps</code>ã<code>docker info</code>ã</p>
</li>
<li>
<p>å¦æè¿éé½å¤±è´¥ï¼åºæ¬ä¼åæ£æ¥ Docker å®è£åå¯å¨ç¶æã[<a href="https://stackoverflow.com/questions/50791354/running-aws-sam-projects-locally-get-error" target="_blank" rel="noopener nofollow">stackoverflow</a>]â</p>
</li>
</ul>
<hr>
<h3 id="32-vs-code-æå¨ç¯å¢ä¸-docker-ä¸å¨åä¸ä¸ªä¸ç">3.2 VS Code æå¨ç¯å¢ä¸ Docker ä¸å¨åä¸ä¸ªâä¸çâ</h3>
<p>è¿æ¯ç¬¬äºç±»å¾å¸¸è§çé®é¢ï¼<strong>ä½ å¨ A ç»ç«¯éè½ç¨ Dockerï¼ä½ VS Code ä½¿ç¨çæ¯ B ç¯å¢</strong>ã[<a href="https://stackoverflow.com/questions/50791354/running-aws-sam-projects-locally-get-error" target="_blank" rel="noopener nofollow">stackoverflow</a>]â</p>
<p>å¸åæå½¢ï¼</p>
<ul>
<li>
<p>å¨ Windows ä¸ç¨ WSL æå¼å·¥ç¨ï¼è Docker Desktop åªå¨ Windows ç¯å¢å¯è§ï¼VS Code çè°è¯å¨ WSL éè·ï¼WSL åæ²¡æå¯ç¨ç Docker socketã</p>
</li>
<li>
<p>ä½¿ç¨ Dev Container / Remote-SSH / Remote-WSL ç­è¿ç¨å¼åæ¨¡å¼ï¼ä½å®¹å¨/è¿ç¨ç¯å¢åé¨æ²¡æ Docker ææ²¡ææ å° Docker socketã</p>
</li>
<li>
<p>æå¨å¼ç»ç«¯æ¶ç¨çæ¯ä¸ä¸ª shell profileï¼è®¾ç½®äºä¸äºåéæ aliasï¼è VS Code éæç»ç«¯æ²¡æå è½½åæ ·çéç½®ã</p>
</li>
</ul>
<p><strong>å®ä½æ¹å¼</strong></p>
<ul>
<li>
<p>ä¸å¾å¨ VS Code éæç»ç«¯ä¸­æ§è¡ï¼<code>docker ps</code>ã<code>sam local invoke</code>ï¼çè¾åºåæ®éç»ç«¯æ¯å¦ä¸è´ã</p>
</li>
<li>
<p>å¦ææ®éç»ç«¯ OKï¼VS Code éå¤±è´¥ï¼å°±å¯ä»¥è®²ï¼<br>
âé®é¢å¨äº VS Code è¿è¡ SAM CLI çç¯å¢ï¼ä¸æå¹³æ¶ç¨çç»ç«¯ç¯å¢ä¸ä¸æ ·ãâ[<a href="https://stackoverflow.com/questions/50791354/running-aws-sam-projects-locally-get-error" target="_blank" rel="noopener nofollow">stackoverflow</a>]â</p>
</li>
</ul>
<hr>
<h3 id="33-docker_host--docker-context-éç½®æ-sam-å¸¦å">3.3 DOCKER_HOST / Docker context éç½®æ SAM âå¸¦åâ</h3>
<p>å½ä½¿ç¨è¿è¿ç¨ DockerãColimaãRancher Desktop ç­å·¥å·æ¶ï¼å¾å®¹æçä¸æ§ç&nbsp;<code>DOCKER_HOST</code>&nbsp;ç¯å¢åéæéé»è®¤ Docker contextã[<a href="https://stackoverflow.com/questions/50791354/running-aws-sam-projects-locally-get-error" target="_blank" rel="noopener nofollow">stackoverflow</a>]â</p>
<p><strong>å¸åé®é¢</strong></p>
<ul>
<li>
<p><code>DOCKER_HOST</code>&nbsp;æåä¸ä¸ªå·²ç»ä¸å­å¨æä¸å¯è¾¾çè¿ç¨ Dockerã</p>
</li>
<li>
<p>å½å Docker context æ¯æä¸ªè¿ç¨/å®éªç¯å¢ï¼èä¸æ¯æ¬å° Desktopã</p>
</li>
<li>
<p>ç¨&nbsp;<code>docker ps</code>&nbsp;å¯è½è¿æ¾ç¤ºå¾æ­£å¸¸ï¼ä½å®éè¿çæ¯æä¸ªå¥æªç hostã</p>
</li>
</ul>
<p><strong>ææ¥ä¸ä¿®å¤</strong></p>
<ul>
<li>
<p>å¨ VS Code éæç»ç«¯ä¸­æ¥çç¯å¢åéï¼</p>
<ul>
<li>
<p>Linux/macOS:&nbsp;<code>env | grep DOCKER_HOST</code></p>
</li>
<li>
<p>PowerShell:&nbsp;<code>Get-ChildItem Env:DOCKER_HOST</code></p>
</li>
</ul>
</li>
<li>
<p>å¦ææå¼ï¼å¯ä»¥å°è¯ä¸´æ¶&nbsp;<code>unset</code>&nbsp;/&nbsp;<code>Remove-Item Env:DOCKER_HOST</code>ï¼åè¯ä¸æ¬¡æ¬å°è°è¯ã</p>
</li>
<li>
<p>æ¥ç Docker contextï¼<code>docker context ls</code>ï¼ç¡®è®¤å½å active ç context æ¯å¦æ¯é¢æçæ¬å°ç¯å¢ã</p>
</li>
<li>
<p>è¥é®é¢è§£å³ï¼å¯ä»¥å¨åäº«ä¸­å¼ºè°ï¼<br>
âéå° Docker ææå¨è·å´è¢«è®¤ä¸ºâä¸å¯ç¨âæ¶ï¼è®°å¾æ£æ¥ DOCKER_HOST å docker contextãâ[<a href="https://stackoverflow.com/questions/50791354/running-aws-sam-projects-locally-get-error" target="_blank" rel="noopener nofollow">stackoverflow</a>]â</p>
</li>
</ul>
<hr>
<h3 id="34-docker-çæ¬åçº§åsam-cli--å·¥å·é¾çæ¬å¤ªæ§ä½ çå®éæ¡ä¾">3.4 Docker çæ¬åçº§åï¼SAM CLI / å·¥å·é¾çæ¬å¤ªæ§ï¼ä½ çå®éæ¡ä¾ï¼</h3>
<p>è¿æ¯ä½ è¿æ¬¡éå°çæ ¸å¿åå ï¼ä¹éå¸¸éåéç¹è®²è§£ã[<a href="https://stackoverflow.com/questions/50791354/running-aws-sam-projects-locally-get-error" target="_blank" rel="noopener nofollow">stackoverflow</a>]â</p>
<p><strong>ç°è±¡</strong></p>
<ul>
<li>
<p>Docker Desktop åçº§å°æ°çæ¬ä¹åï¼<code>docker ps</code>&nbsp;ç­å½ä»¤é½æ­£å¸¸ã</p>
</li>
<li>
<p>ä½éè¿ VS Codeï¼AWS Toolkitï¼ç¹å»æ¬å°è¿è¡ Lambdaï¼æç¤ºä»ç¶æ¯ âRunning AWS SAM projects locally requires Dockerâ¦âã</p>
</li>
<li>
<p>æå¨å¨ç»ç«¯æ§è¡&nbsp;<code>sam local invoke</code>&nbsp;æ&nbsp;<code>sam local start-api</code>&nbsp;å¯è½ä¹ä¼æ¥ç±»ä¼¼âDocker ä¸å¯è¾¾âæ API ç¸å³çéè¯¯ã</p>
</li>
</ul>
<p><strong>åå </strong></p>
<ul>
<li>
<p>èçæ¬ç AWS SAM CLI åé¨ä¾èµç Docker å®¢æ·ç«¯åºï¼å¯¹æ° Docker API ææäºè¡ä¸ºä¸å¼å®¹ã</p>
</li>
<li>
<p>VS Code ç AWS Toolkit ä¹æå¯¹ SAM CLI æ Docker ççæ¬è¦æ±ï¼å¦æå¤ªæ§ï¼æ£æµé»è¾ä¼å¤±è´¥ã</p>
</li>
<li>
<p>ç»æå°±æ¯ï¼<strong>Docker å®éå¯ç¨ï¼ä½å¥åº·æ£æ¥é¶æ®µå°±âæäºâï¼äºæ¯åç«¯ç»ä¸æåºâéè¦å®è£ Dockerâè¿ç§è¯¯å¯¼æ§çéè¯¯ä¿¡æ¯</strong>ã[<a href="https://stackoverflow.com/questions/50791354/running-aws-sam-projects-locally-get-error" target="_blank" rel="noopener nofollow">stackoverflow</a>]â</p>
</li>
</ul>
<p><strong>è§£å³æ¹å¼</strong></p>
<ul>
<li>
<p>åçº§ AWS SAM CLI å°ææ°ç¨³å®çæ¬ã</p>
</li>
<li>
<p>åçº§ VS Code ä¸­ç AWS Toolkitï¼ä»¥åå¦æéè¦ç AWS CLI ç­ä¾èµï¼ã</p>
</li>
<li>
<p>åçº§ååæ¬¡å°è¯æ¬å°è¿è¡ Lambdaï¼é®é¢æ¶å¤±ã</p>
</li>
</ul>
<p>è¿ä¸æ®µå¯ä»¥ä½ä¸ºä½ åäº«éâçæ­£è¸©åâçé¨åï¼å¼ºè°âDocker åçº§åå«å¿äºåçº§ SAM / å·¥å·é¾âã</p>
<hr>
<h2 id="åæ¨èçææ¥é¡ºåºå¯ä»¥ç´æ¥æå±çä¸å¼ -slide">åãæ¨èçææ¥é¡ºåºï¼å¯ä»¥ç´æ¥æå±çä¸å¼  slideï¼</h2>
<p>ä½ å¯ä»¥æ´çæä¸ä¸ªâæéææ¥æµç¨âï¼</p>
<ol>
<li>
<p><strong>ç¡®è®¤ Docker ççå¨ VS Code ç¯å¢éå¯ç¨</strong></p>
<ul>
<li>å¨ VS Code éæç»ç«¯æ§è¡&nbsp;<code>docker ps</code>ã<code>docker info</code>ã</li>
</ul>
</li>
<li>
<p><strong>æ£æ¥ç¯å¢æ¯å¦ä¸è´</strong></p>
<ul>
<li>
<p>æ¯å¦å¨ WSL / Dev Container / è¿ç¨ç¯å¢ä¸­ï¼</p>
</li>
<li>
<p>è¿äºç¯å¢éæ¯å¦ä¹å®è£/æ å°äº Dockerï¼</p>
</li>
</ul>
</li>
<li>
<p><strong>æ£æ¥ DOCKER_HOST å Docker context</strong></p>
<ul>
<li>ç§»é¤å¯çç&nbsp;<code>DOCKER_HOST</code>ï¼ç¡®è®¤å½å context æ­£ç¡®ã</li>
</ul>
</li>
<li>
<p><strong>æ£æ¥çæ¬å¼å®¹</strong></p>
<ul>
<li>
<p>Docker Desktop æ¯å¦ååçº§ï¼</p>
</li>
<li>
<p><code>sam --version</code>&nbsp;æ¯å¦å¾èï¼</p>
</li>
<li>
<p>åçº§ AWS SAM CLIãAWS Toolkit ç­å·¥å·å°ææ°çæ¬ã</p>
</li>
</ul>
</li>
<li>
<p><strong>åæ¬¡ä» VS Code ä¸­åèµ·æ¬å°è°è¯</strong></p>
<ul>
<li>éªè¯é®é¢æ¯å¦è§£å³ã</li>
</ul>
</li>
</ol>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 11:48">2026-01-20 11:48</span>&nbsp;
<a href="https://www.cnblogs.com/wanghaiwei">æ¸¸å­¦è</a>&nbsp;
éè¯»(<span id="post_view_count">89</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19505845);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19505845', targetLink: 'https://www.cnblogs.com/wanghaiwei/p/19505845', title: 'Docker åçº§å VS Code æ¬å°è°è¯ AWS Lambda æ¥ãRunning AWS SAM projects locally requires Dockerãçé£äºåä¸ææ¥æè·¯' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ APEXå®æç¬¬10ç¯ï¼ææææä½ ç»APEXæè¡¥ä¸ ]]></title>
    <link>https://www.cnblogs.com/jyzhao/p/19508942/apex-shi-zhan-di10pian-shou-ba-shou-jiao-ni-geiape</link>
    <guid>353027752934ae770e06a6aebb1e27fa</guid>
    <description>
    <![CDATA[ 
    <a name="top"></a>
    <h2><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jyzhao/p/19508942/apex-shi-zhan-di10pian-shou-ba-shou-jiao-ni-geiape" title="åå¸äº 2026-01-20 22:15">
    <span role="heading" aria-level="2">APEXå®æç¬¬10ç¯ï¼ææææä½ ç»APEXæè¡¥ä¸</span>
    

</a>
</h2>
    <small>
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 22:15">2026-01-20 22:15</span>&nbsp;
<a href="https://www.cnblogs.com/jyzhao">AlfredZhao</a>&nbsp;
éè¯»(<span id="post_view_count">11</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508942);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508942', targetLink: 'https://www.cnblogs.com/jyzhao/p/19508942/apex-shi-zhan-di10pian-shou-ba-shou-jiao-ni-geiape', title: 'APEXå®æç¬¬10ç¯ï¼ææææä½ ç»APEXæè¡¥ä¸' })">ä¸¾æ¥</a>
</small>
    <div class="entry">
        <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>è¿ä¸æææ¯ä¸æ²¡ä»ä¹é¾åº¦ï¼ä½å´å¾éè¦ï¼å ä¸ºä»»ä½ä¼ä¸çº§è½¯ä»¶ï¼å®æåºç¨è¡¥ä¸æ¯å¾å¿è¦çï¼å¯ä»¥ææè§é¿å¾å¤å·²ç¥bugã</p>
<p>ä¸é¢æä»¬å°±ä»¥ <code>APEX 24.2</code> çæ¬ä¸ºä¾ï¼ä½¿ç¨MOSå¯ä»¥ç´æ¥æå°ææ°çè¡¥ä¸éä¿¡æ¯ï¼è¿æ¯ä¸ä¸ªæåæåå¸çbundleåï¼å¶ä¸­å·²ç»åå«äºç®åææ°ç <code>24.2.12</code> è¡¥ä¸éï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202601/635610-20260120221500169-644256984.jpg" alt="" loading="lazy"></p>
<p>ç¹å» <code>Download</code>ï¼ä¸è½½ï¼åªæ2.6Må¤§å°ã</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202601/635610-20260120221500138-290754377.jpg" alt="" loading="lazy"></p>
<p>ç¶åä¸¥æ ¼æç§READMEè¯´æè¿è¡æä½å³å¯ãè¿éæç§ç¬èçLinuxç¯å¢ï¼å®éæ§è¡æ­¥éª¤å¦ä¸ï¼</p>
<h2 id="1ä¸è½½çè¡¥ä¸ä»è´¨ä¸ä¼ å°apexç¯å¢çä»»æç®å½ä¸">1.ä¸è½½çè¡¥ä¸ä»è´¨ä¸ä¼ å°APEXç¯å¢çä»»æç®å½ä¸</h2>
<ul>
<li>p37366599_242_GENERIC.zip</li>
</ul>
<h2 id="2è§£åè¡¥ä¸ä»è´¨">2.è§£åè¡¥ä¸ä»è´¨</h2>
<ul>
<li>unzip p37366599_242_GENERIC.zip</li>
</ul>
<h2 id="3å³é­ordsæå¡">3.å³é­ORDSæå¡</h2>
<p>å®è£æ¶è¦æ±å³é­ORDSä»¥é»æ­¢å¯¹ORDSåAPEXçè®¿é®ï¼</p>
<blockquote>
<ol start="3">
<li>
<p>Preventing Access to Oracle REST Data Services</p>
<p>It is important that no developers or end users access Oracle APEX while you are applying the patch. This section describes how to prevent access to Oracle APEX.</p>
<p>Stopping Oracle REST Data Services:</p>
<p>To learn more about stopping the Oracle REST Data Services server, see Oracle REST Data Services Installation and Configuration Guide:</p>
<p><a href="https://docs.oracle.com/en/database/oracle/oracle-rest-data-services/index.html" target="_blank" rel="noopener nofollow">https://docs.oracle.com/en/database/oracle/oracle-rest-data-services/index.html</a></p>
</li>
</ol>
</blockquote>
<h2 id="4åæ¢å°37366599ç®å½ä¸">4.åæ¢å°37366599ç®å½ä¸</h2>
<ul>
<li>cd 37366599</li>
</ul>
<h2 id="5è®¾ç½®nls_langç¯å¢åé">5.è®¾ç½®NLS_LANGç¯å¢åé</h2>
<ul>
<li>NLS_LANG=American_America.AL32UTF8</li>
<li>export NLS_LANG</li>
</ul>
<h2 id="6sysç¨æ·æ§è¡èæ¬">6.sysç¨æ·æ§è¡èæ¬</h2>
<p>å®æ¹å®è£è¯´æè¯¦ç»çç»åºäºå ç§ä¸åæåµï¼å¯¹åºç¬èå®éæåµï¼åªæ¯å¨æä¸ä¸ªPDBä¸å®è£äºAPEXï¼<br>
å æ­¤è¿éåªå¨å®è£äºAPEXçPDBä¸æ§è¡è¿ä¸ªèæ¬å³å¯ï¼</p>
<ul>
<li>@catpatch.sql</li>
</ul>
<p>æ§è¡å®æï¼ç¡®è®¤æ²¡ææ¥éï¼åæ¥è¯¢ä¸APEXç»ä»¶ç¶æOKï¼</p>
<pre><code class="language-SQL">SELECT comp_id, comp_name, version, status 
FROM dba_registry 
WHERE comp_id = 'APEX';
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/635610/202601/635610-20260120221500130-878148293.jpg" alt="" loading="lazy"></p>
<h2 id="7-éå¯¹imagesç®å½çæ´æ°">7. éå¯¹imagesç®å½çæ´æ°</h2>
<blockquote>
<p>Install the Patch Set Exception's changes in the images directory</p>
<p>cp -rf /tmp/images ORACLE_APEX_HOME/apex</p>
</blockquote>
<p>ç¬èæ³¨ï¼ç¹å«éè¦æ³¨æä¸è¿ä¸ªæ·è´ï¼æå¥½åä½¿ç¨å½ä»¤ <code>ords config list</code> æ¥è¯¢ç¡®è®¤ä¸ï¼èªå·±çéç½®æ¯å¦ç¸åï¼æ¯å¦ç¬èè¿éè·¯å¾å°±ä¸æ¯é»è®¤çimagesï¼</p>
<blockquote>
<p>standalone.static.path                   /u02/app/apex/apex_images              Global</p>
</blockquote>
<p>è¿æ¯å ä¸ºç¬èä¹åå®è£æ¯æåæ¬çimageså¤å¶äºä¸ä»½apex_imagesï¼æä»¥è¿éåºè¯¥ææ°çimagesä¸é¢çæä»¶æ·è´å°apex_imagesè¿ä¸ªç®å½ä¸æå¯¹ï¼å¦æä½ æ²¡æè¿æ ·çæåµï¼å°±ç´æ¥å¤å¶å½ä»¤å³å¯ã</p>
<h2 id="8å¯å¨ordsç»å½apexéªè¯">8.å¯å¨ORDSï¼ç»å½APEXéªè¯</h2>
<p>ä¸åæ­£å¸¸ï¼APEXä¸»é¡µè¿é <code>Available Updates</code> æ¾ç¤ºç³»ç»å·²æ¯ææ°ç¶æï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202601/635610-20260120221500019-1301140551.jpg" alt="" loading="lazy"></p>
<p>APEXçé¢çå³ä¸è§è¿å¯ä»¥çå°å·ä½çæ¬å·ï¼å°±æ¯æä»¬æ¬æ¬¡å®è£ç <code>Oracle APEX 24.2.12</code>ï¼</p>
<p><img src="https://img2024.cnblogs.com/blog/635610/202601/635610-20260120221459988-1096283148.jpg" alt="" loading="lazy"></p>
<p>è³æ­¤ï¼å·²å®æç»APEXæè¡¥ä¸çå¨é¨å·¥ä½ã</p>

</div>
<div id="MySignature" role="contentinfo">
    <a href="https://www.cnblogs.com/jyzhao/" target="_blank">AlfredZhao</a>Â©çæææãä»Oracleèµ·èªï¼é¢ç¥ç²¾å½©çITææ¯ãã<br>
è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/jyzhao/p/19508942/apex-shi-zhan-di10pian-shou-ba-shou-jiao-ni-geiape" target="_blank">https://www.cnblogs.com/jyzhao/p/19508942/apex-shi-zhan-di10pian-shou-ba-shou-jiao-ni-geiape</a>
<hr>
<div style="text-align:center; margin-top:30px;">
  <p style="font-size:14px;color:#555;">
    ð æè°¢éè¯»ï¼æ¬¢è¿å³æ³¨æçå¬ä¼å· <b>ãèµµéå®ã</b>
  </p>
  <img src="https://images.cnblogs.com/cnblogs_com/jyzhao/824234/o_250208075013_qrcode-zjy.jpg" width="160" style="border:1px solid #ddd;border-radius:8px;">
</div>
</div>
<div class="clear"></div>

        <div class="clear"></div>
        
</div>
    <ul class="postmetadata">
        <vc:categories-tags blog-app="jyzhao" blog-id="186567" post-id="19508942"></vc:categories-tags>
    </ul>
 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Flinkæºç éè¯»ï¼Kafka Connector ]]></title>
    <link>https://www.cnblogs.com/Jackeyzhe/p/19508927</link>
    <guid>52654da949fcb05e8e891777bcbca596</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/Jackeyzhe/p/19508927" title="åå¸äº 2026-01-20 22:03">
    <span role="heading" aria-level="2">Flinkæºç éè¯»ï¼Kafka Connector</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/1828322/202601/1828322-20260120220247061-350106518.png" alt="Flinkæºç éè¯»ï¼Kafka Connector" class="desc_img">
        æ¬ææä»¬æ¥æ¢³ç Kafka Connector ç¸å³çæºç ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ¬ææä»¬æ¥æ¢³ç Kafka Connector ç¸å³çæºç ã</p>
<h3 id="èªå®ä¹-source-å-sink">èªå®ä¹ Source å Sink</h3>
<p>å¨ä»ç» Kafka Connector ä¹åï¼æä»¬åæ¥çä¸ä¸å¨ Flink ä¸­æ¯å¦ä½æ¯æèªå®ä¹ Source å Sink çãæä»¬æ¥çä¸å¼  Flink å®æ¹ææ¡£æä¾çå¾ã</p>
<p><img alt="tableconnector" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1768288302/Blog/flink/22/table_connectors.png" class="lazyload"></p>
<p>è¿å¼ å¾å±ç¤ºäº Connector çåºæ¬ä½ç³»ç»æï¼ä¸å±æ¶æä¹éå¸¸æ¸æ°ã</p>
<h4 id="metadata">Metadata</h4>
<p>é¦åæ¯æä¸å±ç MetaDataï¼CREATE TABLE ä¼æ´æ° Catalogï¼ç¶åè¢«è½¬æ¢ä¸º TableAPI ç CatalogTableï¼CatalogTable å®ä¾ç¨äºè¡¨ç¤ºå¨æè¡¨ï¼Source æ Sink è¡¨ï¼çåä¿¡æ¯ã</p>
<h4 id="planning">Planning</h4>
<p>å¨è§£æåä¼åç¨åºæ¶ï¼ä¼å° CatalogTable è½¬æ¢ä¸º DynamicTableSource å DynamicTableSinkï¼åå«ç¨äºæ¥è¯¢åæå¥æ°æ®ï¼è¿ä¸¤ä¸ªå®ä¾çåå»ºé½éè¦å¯¹åºçå·¥åç±»ï¼å·¥åç±»çå®æ´è·¯å¾éè¦æ¾å°è¿ä¸ªéç½®æä»¶ä¸­ã</p>
<pre><code class="language-bash">META-INF/services/org.apache.flink.table.factories.Factory
</code></pre>
<p>å¦ææéè¦çè¯ï¼æä»¬è¿å¯ä»¥å¨è§£æè¿ç¨ä¸­éç½®ç¼ç åè§£ç æ¹æ³ã</p>
<p>å¨ Source ç«¯ï¼éè¿ä¸ä¸ªæ¥å£æ¯æä¸åçæ¥è¯¢è½åã</p>
<ul>
<li>
<p>ScanTableSourceï¼ç¨äºæ¶è´¹ changelog æµï¼æ«æçæ°æ®æ¯æ insertãupdataãdelete ä¸ç§ç±»åãScanTableSource è¿æ¯æå¾å¤å¶ä»çåè½ï¼ é½æ¯éè¿æ¥å£æä¾çãå·ä½å¯ä»¥çåèè¿ä¸ªè¿æ¥</p>
<pre><code class="language-bash">https://nightlies.apache.org/flink/flink-docs-release-2.2/docs/dev/table/sourcessinks/#source-abilities
</code></pre>
</li>
<li>
<p>LookupTableSourceï¼LookupTableSource ä¸ä¼å¨éè¯»åè¡¨çæ°æ®ï¼å®å¨éè¦æ¶ä¼åéè¯·æ±ï¼æå è½½æ°æ®ãç®ååªæ¯æ insert-only åæ´æ¨¡å¼ã</p>
</li>
<li>
<p>VectorSearchTableSourceï¼ä½¿ç¨ä¸ä¸ªè¾å¥åéæ¥æç´¢æ°æ®ï¼å¹¶è¿åæç¸ä¼¼ç Top-K è¡æ°æ®ã</p>
</li>
</ul>
<p>å¨ Sink ç«¯ï¼éè¿ DynamicTableSink æ¥å®ç°å·ä½çåå¥é»è¾ï¼è¿éä¹æä¾äºä¸äºç¨äºæ©å±è½åçæ¥å£ãå·ä½åè</p>
<pre><code class="language-bash">https://nightlies.apache.org/flink/flink-docs-release-2.2/docs/dev/table/sourcessinks/#sink-abilities
</code></pre>
<h4 id="runtime">Runtime</h4>
<p>é»è¾è§£æå®æåï¼ä¼å° Runtime å±ãè¿éå°±æ¯å®ä¹å ä¸ª Providerï¼å¨ Provider ä¸­å®ç°åè¿æ¥å¨å·ä½çäº¤äºé»è¾ã</p>
<h4 id="å°ç»">å°ç»</h4>
<p>å½æä»¬éè¦åå»ºä¸ä¸ªèªå®ä¹ç Source å Sink æ¶ï¼å°±å¯ä»¥éè¿ä»¥ä¸æ­¥éª¤å®ç°ã</p>
<ol>
<li>
<p>å®ä¹ Flink SQL ç DDLï¼éè¦å®ä¹ç¸åºç Optionsã</p>
</li>
<li>
<p>å®ç° DynamicTableSourceFactory å DynamicTableSinkFactoryï¼å¹¶æå®ç°ç±»çå·ä½è·¯å¾åå°éç½®æä»¶ä¸­ã</p>
</li>
<li>
<p>å®ç° DynamicTableSource å DynamicTableSinkï¼è¿ééè¦å¤ç SQL å±çåæ°æ®ã</p>
</li>
<li>
<p>æä¾ Providerï¼å°é»è¾å±ä¸åºå± DataStream å³èèµ·æ¥ã</p>
</li>
<li>
<p>ç¼ååºå±ç®å­ï¼å®ç° Source å Sink æ¥å£ã</p>
</li>
</ol>
<h3 id="kafka-connector-çå®ç°">Kafka Connector çå®ç°</h3>
<p>å¸¦çè¿äºç¥è¯ï¼æä»¬ä¸èµ·æ¥çä¸ä¸ Kafka Connector ç¸å³çæºç ã</p>
<p>Kafka Connector ä»£ç ç®åå·²ç»æ¯ä¸ä¸ªç¬ç«çé¡¹ç®äºãé¡¹ç®å°åæ¯</p>
<pre><code class="language-bash">https://github.com/apache/flink-connector-kafka
</code></pre>
<h4 id="factory">Factory</h4>
<p>æä»¬é¦åæ¾å°å®ä¹çå·¥åç±»</p>
<pre><code class="language-java">org.apache.flink.streaming.connectors.kafka.table.KafkaDynamicTableFactory
org.apache.flink.streaming.connectors.kafka.table.UpsertKafkaDynamicTableFactory
</code></pre>
<p>ä»¥ KafkaDynamicTableFactory ä¸ºä¾ï¼å®åæ¶å®ç°äº DynamicTableSourceFactory å DynamicTableSinkFactory ä¸¤ä¸ªæ¥å£ã</p>
<p>KafkaDynamicTableFactory åå«ä»¥ä¸å ä¸ªæ¹æ³ã</p>
<p><img alt="KafkaDynamicTableFactory" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1768294001/Blog/flink/22/KafkaDynamicTableFactory.png" class="lazyload"></p>
<ul>
<li>
<p>factoryIdentifierï¼è¿åä¸ä¸ªå¯ä¸æ è¯ç¬¦ï¼å¯¹åº Flink SQL ä¸­ connector='xxx' è¿ä¸ªéç½®ã</p>
</li>
<li>
<p>requiredOptionsï¼å¿å¡«éç½®éåã</p>
</li>
<li>
<p>optionalOptionsï¼éå¡«éç½®éåã</p>
</li>
<li>
<p>forwardOptionsï¼ç´æ¥ä¼ éå° Runtime å±çéç½®éåã</p>
</li>
<li>
<p>createDynamicTableSourceï¼åå»º DynamicTableSourceã</p>
</li>
<li>
<p>createDynamicTableSinkï¼åå»º DynamicTableSinkã</p>
</li>
</ul>
<h4 id="source-ç«¯">Source ç«¯</h4>
<p>å·¥åç±»ç createDynamicTableSource æ¹æ³åå»ºäº DynamicTableSourceï¼æä»¬æ¥çä¸ä¸åå»ºçé»è¾ã</p>
<pre><code class="language-java">public DynamicTableSource createDynamicTableSource(Context context) {
    final TableFactoryHelper helper = FactoryUtil.createTableFactoryHelper(this, context);

    final Optional&lt;DecodingFormat&lt;DeserializationSchema&lt;RowData&gt;&gt;&gt; keyDecodingFormat =
            getKeyDecodingFormat(helper);

    final DecodingFormat&lt;DeserializationSchema&lt;RowData&gt;&gt; valueDecodingFormat =
            getValueDecodingFormat(helper);

    helper.validateExcept(PROPERTIES_PREFIX);

    final ReadableConfig tableOptions = helper.getOptions();

    validateTableSourceOptions(tableOptions);

    validatePKConstraints(
            context.getObjectIdentifier(),
            context.getPrimaryKeyIndexes(),
            context.getCatalogTable().getOptions(),
            valueDecodingFormat);

    final StartupOptions startupOptions = getStartupOptions(tableOptions);

    final BoundedOptions boundedOptions = getBoundedOptions(tableOptions);

    final Properties properties = getKafkaProperties(context.getCatalogTable().getOptions());

    // add topic-partition discovery
    final Duration partitionDiscoveryInterval =
            tableOptions.get(SCAN_TOPIC_PARTITION_DISCOVERY);
    properties.setProperty(
            KafkaSourceOptions.PARTITION_DISCOVERY_INTERVAL_MS.key(),
            Long.toString(partitionDiscoveryInterval.toMillis()));

    final DataType physicalDataType = context.getPhysicalRowDataType();

    final int[] keyProjection = createKeyFormatProjection(tableOptions, physicalDataType);

    final int[] valueProjection = createValueFormatProjection(tableOptions, physicalDataType);

    final String keyPrefix = tableOptions.getOptional(KEY_FIELDS_PREFIX).orElse(null);

    final Integer parallelism = tableOptions.getOptional(SCAN_PARALLELISM).orElse(null);

    return createKafkaTableSource(
            physicalDataType,
            keyDecodingFormat.orElse(null),
            valueDecodingFormat,
            keyProjection,
            valueProjection,
            keyPrefix,
            getTopics(tableOptions),
            getTopicPattern(tableOptions),
            properties,
            startupOptions.startupMode,
            startupOptions.specificOffsets,
            startupOptions.startupTimestampMillis,
            boundedOptions.boundedMode,
            boundedOptions.specificOffsets,
            boundedOptions.boundedTimestampMillis,
            context.getObjectIdentifier().asSummaryString(),
            parallelism);
}
</code></pre>
<p>å¨è¿ä¸ªæ¹æ³ä¸­ï¼é¦åè¦è·åå° key å value çè§£ç æ ¼å¼ãæ¥çæ¯åç§åæ°æ ¡éªåè·åå¿è¦çå±æ§ãæååå»º KafkaDynamicSource å®ä¾ã</p>
<p>è·åè§£ç æ ¼å¼éè¦ç¨å° DeserializationFormatFactory å·¥åï¼DeserializationFormatFactory æå¤ä¸ªå®ç°ç±»ï¼å¯¹åºäºå¤ç§æ ¼å¼çååºååæ¹æ³ã</p>
<p><img alt="DeserializationFormatFactory" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1768297428/Blog/flink/22/DeserializationFormatFactory.png" class="lazyload"></p>
<p>æä»¬æ¥çæ¯è¾å¸¸è§ç Json æ ¼å¼çå·¥å JsonFormatFactoryã</p>
<pre><code class="language-java">public DecodingFormat&lt;DeserializationSchema&lt;RowData&gt;&gt; createDecodingFormat(
        DynamicTableFactory.Context context, ReadableConfig formatOptions) {
    FactoryUtil.validateFactoryOptions(this, formatOptions);
    JsonFormatOptionsUtil.validateDecodingFormatOptions(formatOptions);

    final boolean failOnMissingField = formatOptions.get(FAIL_ON_MISSING_FIELD);
    final boolean ignoreParseErrors = formatOptions.get(IGNORE_PARSE_ERRORS);
    final boolean jsonParserEnabled = formatOptions.get(DECODE_JSON_PARSER_ENABLED);
    TimestampFormat timestampOption = JsonFormatOptionsUtil.getTimestampFormat(formatOptions);

    return new ProjectableDecodingFormat&lt;DeserializationSchema&lt;RowData&gt;&gt;() {
        @Override
        public DeserializationSchema&lt;RowData&gt; createRuntimeDecoder(
                DynamicTableSource.Context context,
                DataType physicalDataType,
                int[][] projections) {
            final DataType producedDataType =
                    Projection.of(projections).project(physicalDataType);
            final RowType rowType = (RowType) producedDataType.getLogicalType();
            final TypeInformation&lt;RowData&gt; rowDataTypeInfo =
                    context.createTypeInformation(producedDataType);
            if (jsonParserEnabled) {
                return new JsonParserRowDataDeserializationSchema(
                        rowType,
                        rowDataTypeInfo,
                        failOnMissingField,
                        ignoreParseErrors,
                        timestampOption,
                        toProjectedNames(
                                (RowType) physicalDataType.getLogicalType(), projections));
            } else {
                return new JsonRowDataDeserializationSchema(
                        rowType,
                        rowDataTypeInfo,
                        failOnMissingField,
                        ignoreParseErrors,
                        timestampOption);
            }
        }

        @Override
        public ChangelogMode getChangelogMode() {
            return ChangelogMode.insertOnly();
        }

        @Override
        public boolean supportsNestedProjection() {
            return jsonParserEnabled;
        }
    };
}
</code></pre>
<p>å¨åå»ºè§£ç æ ¼å¼æ¶ï¼æéè¦çæ¯åå»ºè¿è¡æ¶çè§£ç å¨ï¼ä¹å°±æ¯ DeserializationSchemaï¼å¨ JsonFormatFactory ä¸­ï¼æ JsonParserRowDataDeserializationSchema å JsonRowDataDeserializationSchema ä¸¤ç§å®ç°ï¼åå«æ¯ç¨äºå° JsonParser å JsonNode è½¬æ¢æä¸º RowDataï¼å·ä½çé»è¾é½å¨ createNotNullConverter æ¹æ³ä¸­ã</p>
<p>äºè§£å®è§£ç æ ¼å¼åï¼æä»¬æè§è§æåå° KafkaDynamicSourceï¼å®å®ç°äºä¸ä¸ªæ¥å£ ScanTableSourceãSupportsReadingMetadataãSupportsWatermarkPushDownãåå«ç¨äºæ¶è´¹æ°æ®ï¼è¯»ååæ°æ®åçææ°´å°ã</p>
<pre><code class="language-java">public ScanRuntimeProvider getScanRuntimeProvider(ScanContext context) {
    final DeserializationSchema&lt;RowData&gt; keyDeserialization =
            createDeserialization(context, keyDecodingFormat, keyProjection, keyPrefix);

    final DeserializationSchema&lt;RowData&gt; valueDeserialization =
            createDeserialization(context, valueDecodingFormat, valueProjection, null);

    final TypeInformation&lt;RowData&gt; producedTypeInfo =
            context.createTypeInformation(producedDataType);

    final KafkaSource&lt;RowData&gt; kafkaSource =
            createKafkaSource(keyDeserialization, valueDeserialization, producedTypeInfo);

    return new DataStreamScanProvider() {
        @Override
        public DataStream&lt;RowData&gt; produceDataStream(
                ProviderContext providerContext, StreamExecutionEnvironment execEnv) {
            if (watermarkStrategy == null) {
                watermarkStrategy = WatermarkStrategy.noWatermarks();
            }
            DataStreamSource&lt;RowData&gt; sourceStream =
                    execEnv.fromSource(
                            kafkaSource, watermarkStrategy, "KafkaSource-" + tableIdentifier);
            providerContext.generateUid(KAFKA_TRANSFORMATION).ifPresent(sourceStream::uid);
            return sourceStream;
        }

        @Override
        public boolean isBounded() {
            return kafkaSource.getBoundedness() == Boundedness.BOUNDED;
        }

        @Override
        public Optional&lt;Integer&gt; getParallelism() {
            return Optional.ofNullable(parallelism);
        }
    };
}
</code></pre>
<p>å¨ ScanRuntimeProvider çé»è¾ä¸­ï¼åè·åå°ååºååå¨ï¼ä¹å°±æ¯ååæä»¬æå°ç DeserializationSchemaã</p>
<p><img alt="KafkaSource" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1768318497/Blog/flink/22/KafkaSource.png" class="lazyload"></p>
<p>ç¶åå¼å§åå»º KafkaSource å®ä¾ï¼å®æ¯ Source çå®ç°ç±»ï¼ä¹å°±æ¯æ§è¡å¼æå±äºï¼è¿ä¸ªè¿ç¨ä¼ä¾æ¬¡åå»ºå¾ä¸­è¿äºç±»ã</p>
<p>KafkaSource ä¸­ä¸»è¦æ¯åå»º KafkaSourceReader å KafkaSourceEnumeratorï¼KafkaSourceEnumerator æ¯è´è´£ååçç¸å³çé»è¾ï¼åæ¬åçåéååçåç°ç­ã</p>
<p>KafkaSourceReader ä¸­ä¸»è¦æ¯å State ç¸å³çé»è¾ï¼åæ¬è§¦åå¿«ç§åå®æ Checkpoint éç¥çæ¹æ³ãå½å Snapshot æ¶ï¼ä¼è®°å½æ´»è· split ç offsetï¼åæ¶å° split ä½ä¸ºç¶ææäº¤ãå½ Checkpoint å®ææ¶ï¼ä¼è°ç¨ <code>KafkaSourceFetcherManager.commitOffsets</code> æäº¤ offsetã</p>
<pre><code class="language-java">public List&lt;KafkaPartitionSplit&gt; snapshotState(long checkpointId) {
    List&lt;KafkaPartitionSplit&gt; splits = super.snapshotState(checkpointId);
    if (!commitOffsetsOnCheckpoint) {
        return splits;
    }

    if (splits.isEmpty() &amp;&amp; offsetsOfFinishedSplits.isEmpty()) {
        offsetsToCommit.put(checkpointId, Collections.emptyMap());
    } else {
        Map&lt;TopicPartition, OffsetAndMetadata&gt; offsetsMap =
                offsetsToCommit.computeIfAbsent(checkpointId, id -&gt; new HashMap&lt;&gt;());
        // Put the offsets of the active splits.
        for (KafkaPartitionSplit split : splits) {
            // If the checkpoint is triggered before the partition starting offsets
            // is retrieved, do not commit the offsets for those partitions.
            if (split.getStartingOffset() &gt;= 0) {
                offsetsMap.put(
                        split.getTopicPartition(),
                        new OffsetAndMetadata(split.getStartingOffset()));
            }
        }
        // Put offsets of all the finished splits.
        offsetsMap.putAll(offsetsOfFinishedSplits);
    }
    return splits;
}


public void notifyCheckpointComplete(long checkpointId) throws Exception {
    LOG.debug("Committing offsets for checkpoint {}", checkpointId);
    ...

    ((KafkaSourceFetcherManager) splitFetcherManager)
            .commitOffsets(
                    committedPartitions,
                    (ignored, e) -&gt; {...});
}
</code></pre>
<p>KafkaSourceFetcherManager è´è´£ç®¡ç fetcher çº¿ç¨ï¼æäº¤ Offsetã</p>
<p>KafkaPartitionSplitReader ç fetch æ¹æ³ç¨æ¥æ¶è´¹ Kafka çæ°æ®ã</p>
<pre><code class="language-java">public RecordsWithSplitIds&lt;ConsumerRecord&lt;byte[], byte[]&gt;&gt; fetch() throws IOException {
    ConsumerRecords&lt;byte[], byte[]&gt; consumerRecords;
    try {
        consumerRecords = consumer.poll(Duration.ofMillis(POLL_TIMEOUT));
    } catch (WakeupException | IllegalStateException e) {
        // IllegalStateException will be thrown if the consumer is not assigned any partitions.
        // This happens if all assigned partitions are invalid or empty (starting offset &gt;=
        // stopping offset). We just mark empty partitions as finished and return an empty
        // record container, and this consumer will be closed by SplitFetcherManager.
        KafkaPartitionSplitRecords recordsBySplits =
                new KafkaPartitionSplitRecords(
                        ConsumerRecords.empty(), kafkaSourceReaderMetrics);
        markEmptySplitsAsFinished(recordsBySplits);
        return recordsBySplits;
    }
    KafkaPartitionSplitRecords recordsBySplits =
            new KafkaPartitionSplitRecords(consumerRecords, kafkaSourceReaderMetrics);
    List&lt;TopicPartition&gt; finishedPartitions = new ArrayList&lt;&gt;();
    for (TopicPartition tp : consumer.assignment()) {
        long stoppingOffset = getStoppingOffset(tp);
        long consumerPosition = getConsumerPosition(tp, "retrieving consumer position");
        // Stop fetching when the consumer's position reaches the stoppingOffset.
        // Control messages may follow the last record; therefore, using the last record's
        // offset as a stopping condition could result in indefinite blocking.
        if (consumerPosition &gt;= stoppingOffset) {
            LOG.debug(
                    "Position of {}: {}, has reached stopping offset: {}",
                    tp,
                    consumerPosition,
                    stoppingOffset);
            recordsBySplits.setPartitionStoppingOffset(tp, stoppingOffset);
            finishSplitAtRecord(
                    tp, stoppingOffset, consumerPosition, finishedPartitions, recordsBySplits);
        }
    }

    // Only track non-empty partition's record lag if it never appears before
    consumerRecords
            .partitions()
            .forEach(
                    trackTp -&gt; {
                        kafkaSourceReaderMetrics.maybeAddRecordsLagMetric(consumer, trackTp);
                    });

    markEmptySplitsAsFinished(recordsBySplits);

    // Unassign the partitions that has finished.
    if (!finishedPartitions.isEmpty()) {
        finishedPartitions.forEach(kafkaSourceReaderMetrics::removeRecordsLagMetric);
        unassignPartitions(finishedPartitions);
    }

    // Update numBytesIn
    kafkaSourceReaderMetrics.updateNumBytesInCounter();

    return recordsBySplits;
}
</code></pre>
<p>è³æ­¤ï¼Source ç«¯ç¸å³çæºç æä»¬å°±æ¢³çå®äºãæ¥ä¸æ¥æä»¬åç Sink ç«¯çä»£ç ã</p>
<h4 id="sink-ç«¯">Sink ç«¯</h4>
<p>æä»¬ä»å·¥åç±»ä¸­ç createDynamicTableSink æ¹æ³å¼å§ã</p>
<pre><code class="language-java">public DynamicTableSink createDynamicTableSink(Context context) {
    final TableFactoryHelper helper =
            FactoryUtil.createTableFactoryHelper(
                    this, autoCompleteSchemaRegistrySubject(context));

    final Optional&lt;EncodingFormat&lt;SerializationSchema&lt;RowData&gt;&gt;&gt; keyEncodingFormat =
            getKeyEncodingFormat(helper);

    final EncodingFormat&lt;SerializationSchema&lt;RowData&gt;&gt; valueEncodingFormat =
            getValueEncodingFormat(helper);

    helper.validateExcept(PROPERTIES_PREFIX);

    final ReadableConfig tableOptions = helper.getOptions();

    final DeliveryGuarantee deliveryGuarantee = validateDeprecatedSemantic(tableOptions);
    validateTableSinkOptions(tableOptions);

    KafkaConnectorOptionsUtil.validateDeliveryGuarantee(tableOptions);

    validatePKConstraints(
            context.getObjectIdentifier(),
            context.getPrimaryKeyIndexes(),
            context.getCatalogTable().getOptions(),
            valueEncodingFormat);

    final DataType physicalDataType = context.getPhysicalRowDataType();

    final int[] keyProjection = createKeyFormatProjection(tableOptions, physicalDataType);

    final int[] valueProjection = createValueFormatProjection(tableOptions, physicalDataType);

    final String keyPrefix = tableOptions.getOptional(KEY_FIELDS_PREFIX).orElse(null);

    final Integer parallelism = tableOptions.getOptional(SINK_PARALLELISM).orElse(null);

    return createKafkaTableSink(
            physicalDataType,
            keyEncodingFormat.orElse(null),
            valueEncodingFormat,
            keyProjection,
            valueProjection,
            keyPrefix,
            getTopics(tableOptions),
            getTopicPattern(tableOptions),
            getKafkaProperties(context.getCatalogTable().getOptions()),
            getFlinkKafkaPartitioner(tableOptions, context.getClassLoader()).orElse(null),
            deliveryGuarantee,
            parallelism,
            tableOptions.get(TRANSACTIONAL_ID_PREFIX),
            tableOptions.get(TRANSACTION_NAMING_STRATEGY));
}
</code></pre>
<p>å Source çæµç¨å¾ç¸ä¼¼ï¼è¿éé¦åæ¯è·å key å value çç¼ç æ ¼å¼ï¼ç¶ååäºå¾å¤æ ¡éªï¼æåæ¯åå»º KafkaDynamicSink å®ä¾ã</p>
<p>è·åç¼ç æ ¼å¼ç¨å°çå·¥åç±»æ¯ SerializationFormatFactoryï¼æä»¬åé¢ä»ç»ç JsonFormatFactory ä¹å®ç°äº SerializationFormatFactoryï¼å æ­¤å®æ¢æä¾äºè§£ç æ ¼å¼ï¼åæä¾äºç¼ç æ ¼å¼ãç¼ç æ ¼å¼ç¨å°çç¼ç å¨æ¯ JsonRowDataSerializationSchemaï¼éè¿ RowDataToJsonConverters å° RowData è½¬æ¢æ JsonNodeã</p>
<p>å¨ KafkaDynamicSink ç getSinkRuntimeProvider æ¹æ³ä¸­ï¼ä¸»è¦å°±æ¯åå»º KafkaSink å®ä¾ã</p>
<p><img alt="KafkaSink" loading="lazy" data-src="https://res.cloudinary.com/dxydgihag/image/upload/v1768363734/Blog/flink/22/KafkaSink.png" class="lazyload"></p>
<p>KafkaSink ç±»å®ç°äº TwoPhaseCommittingStatefulSink æ¥å£ï¼å³æ¯æä¸¤é¶æ®µæäº¤ãå®åå»ºäº KafkaWrter å KafkaCommiterã</p>
<p>åå»º KafkaWriter æ¶ï¼å¦æéç½®çæ¯ ExactlyOnce æ¨¡å¼ï¼åä¼åå»ºåº ExactlyOnceKafkaWriterï¼å¦ååå»º KafkaWriterãWriter çæ­£å®ç°ä¸¤é¶æ®µæäº¤çæ¯ ExactlyOnceKafkaWriterãå®å¨å¯å¨æ¶ï¼ä¼è°ç¨ <code>producer.beginTransaction</code> å¼å¯ä¸ä¸ªäºå¡ãæ°æ®åå¥æ¶ä¼è°ç¨ <code>KafkaWriter.write</code> æ¹æ³ï¼æ­¤æä½ä¼è¢«æ è®°ä¸ºäºå¡åçæä½ãå½ Sink æ¶å° Barrier æ¶ï¼ä¼åè°ç¨ flush æ¹æ³ï¼å°ç¼å²åºçæ°æ®é½åéå° Kafka Brokerï¼ç¶åè°ç¨ prepareCommit æ¹æ³é¢æäº¤ãé¢æäº¤æ¹æ³ä¸­è®°å½ epoch å transactionalId è¿åç»æ¡æ¶å±ã</p>
<pre><code class="language-java">public Collection&lt;KafkaCommittable&gt; prepareCommit() {
    // only return a KafkaCommittable if the current transaction has been written some data
    if (currentProducer.hasRecordsInTransaction()) {
        KafkaCommittable committable = KafkaCommittable.of(currentProducer);
        LOG.debug("Prepare {}.", committable);
        currentProducer.precommitTransaction();
        return Collections.singletonList(committable);
    }

    // otherwise, we recycle the producer (the pool will reset the transaction state)
    producerPool.recycle(currentProducer);
    return Collections.emptyList();
}
</code></pre>
<p>ç¶æä¿å­æ¶ï¼ä¼å°é¢æäº¤ç transactionalId å­å°ç¶æä¸­ã</p>
<pre><code class="language-java">public List&lt;KafkaWriterState&gt; snapshotState(long checkpointId) throws IOException {
    // recycle committed producers
    TransactionFinished finishedTransaction;
    while ((finishedTransaction = backchannel.poll()) != null) {
        producerPool.recycleByTransactionId(
                finishedTransaction.getTransactionId(), finishedTransaction.isSuccess());
    }
    // persist the ongoing transactions into the state; these will not be aborted on restart
    Collection&lt;CheckpointTransaction&gt; ongoingTransactions =
            producerPool.getOngoingTransactions();
    currentProducer = startTransaction(checkpointId + 1);
    return createSnapshots(ongoingTransactions);
}

private List&lt;KafkaWriterState&gt; createSnapshots(
        Collection&lt;CheckpointTransaction&gt; ongoingTransactions) {
    List&lt;KafkaWriterState&gt; states = new ArrayList&lt;&gt;();
    int[] subtaskIds = this.ownedSubtaskIds;
    for (int index = 0; index &lt; subtaskIds.length; index++) {
        int ownedSubtask = subtaskIds[index];
        states.add(
                new KafkaWriterState(
                        transactionalIdPrefix,
                        ownedSubtask,
                        totalNumberOfOwnedSubtasks,
                        transactionNamingStrategy.getOwnership(),
                        // new transactions are only created with the first owned subtask id
                        index == 0 ? ongoingTransactions : List.of()));
    }
    LOG.debug("Snapshotting state {}", states);
    return states;
}
</code></pre>
<p>å½ Checkpoint å®ææ¶ï¼ä¼è°ç¨ <code>KafkaCommitter.commit</code> æ¹æ³ãå¨ commit æ¹æ³ä¸­ä¼è°ç¨ <code>producer.commitTransaction</code> æ­£å¼æäº¤äºå¡ã</p>
<p>FlinkKafkaInternalProducer æ¯ Flink åé¨å°è£çä¸ Kafka çäº§èçäº¤äºç±»ï¼ææä¸ Kafka çäº§èçäº¤äºé½éè¿å®æ§è¡ã</p>
<p>å³äº Kafka Connector ç Sink ç«¯çæºç æä»¬å°±æ¢³çå°è¿éã</p>
<h3 id="æ»ç»">æ»ç»</h3>
<p>æåè¿æ¯æ»ç»ä¸ä¸ãæ¬ææä»¬åäºè§£äº Flink ä¸­èªå®ä¹ Source å Sink çæµç¨ãæç§è¿ä¸ªæµç¨ï¼æä»¬æ¢³çäº Kafka Connector çæºç ãå¨ Source ç«¯ï¼Flink Kafka å°è£äºå¯¹æ¶è´¹è Offset çæäº¤é»è¾ãå¨ Sink ç«¯ç»åäº Kafka æä¾çäºå¡æ¯æå®ç°äºä¸¤é¶æ®µæäº¤çé»è¾ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-20 22:03">2026-01-20 22:03</span>&nbsp;
<a href="https://www.cnblogs.com/Jackeyzhe">Jackeyzhe</a>&nbsp;
éè¯»(<span id="post_view_count">4</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19508927);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19508927', targetLink: 'https://www.cnblogs.com/Jackeyzhe/p/19508927', title: 'Flinkæºç éè¯»ï¼Kafka Connector' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>