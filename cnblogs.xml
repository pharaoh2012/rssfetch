<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-13T04:16:42.547Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ Nano-vLLM-Ascend(æç»­æ´æ°ä¸­) ]]></title>
    <link>https://www.cnblogs.com/linzm14/p/19611415</link>
    <guid>77ceb1205f83ea4bef6298d3e832fb96</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/linzm14/p/19611415" title="åå¸äº 2026-02-13 11:38">
    <span role="heading" aria-level="2">Nano-vLLM-Ascend(æç»­æ´æ°ä¸­)</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="nano-vllm-ascend"><a href="https://github.com/linzm1007/nano-vllm-ascend" target="_blank" rel="noopener nofollow">Nano-vLLM-Ascend</a></h2>
<p>é¡¹ç®é¾æ¥ï¼<a href="https://github.com/linzm1007/nano-vllm-ascend" target="_blank" rel="noopener nofollow">https://github.com/linzm1007/nano-vllm-ascend</a><br>
nano-vllmæ¯å¤ç½å¼æºçä¸ä¸ªgpuæ¨çé¡¹ç®ï¼åºäºå¼æºçæ¬å¼çä¸ä¸ªascend npuçæ¬æ¨çå°demoï¼æ¨å¨å¸®å©åå­¦èäºè§£æ¨ççæ´ä½æµç¨ï¼åºå«äºvllmï¼nano-vllmä½éæ´å°ï¼éº»éè½å°äºèä¿±å¨ï¼æ´æå©äºåå­¦èå­¦ä¹ ï¼éå¸¸éåç¨äºç¸å³æ¦å¿µççè§£ã</p>
<h2 id="æ¡æ¶å±æµç¨å¾">æ¡æ¶å±æµç¨å¾</h2>
<p><img alt="nona-vllmæ¡æ¶" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2257481/202512/2257481-20251207210704152-770371883.png" class="lazyload"></p>
<h2 id="æ¨¡åå±æµç¨å¾">æ¨¡åå±æµç¨å¾</h2>
<p><img alt="Qwen3-0.6B" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2257481/202602/2257481-20260213113258305-186035462.png" class="lazyload"></p>
<h2 id="ç¹æ§">ç¹æ§</h2>
<ul>
<li>ð <strong>å¯è¯»ä»£ç åº</strong> - æ ¸å¿çº¦2428è¡Pythonä»£ç çæ¸æ°å®ç°</li>
<li>â¡ <strong>ä¼åå¥ä»¶</strong> - å¼ éå¹¶è¡ãtorchair Ascend IRå¾ç¼è¯åå¾ç¼å­ãèåç®å­ãåç¼ç¼å­ç­</li>
</ul>
<ul>
<li>[â] å¾å®æï¼ç®ååªæ¯æåç®å­, npuå¾æ¨¡å¼å®ç°</li>
<li>[â] æ¯æCPUç¯å¢è¿è¡ï¼<a href="https://github.com/linzm1007/nano-vllm-cpu" target="_blank" rel="noopener nofollow">nano-vllm-cpu ä»£ç ä»åº</a></li>
<li>[â] æ§è½ä¼å</li>
<li>[â³] æ¯ææ¨¡å: Qwen3-0.6BãQwen3-32BãQwen2-0.5BãQwen2.5-0.5BãQwen2.5-0.5B-InstructãLlama-3.2-1B-InstructãQwen3-30B-A3BãQwen3-VL-2B-InstructãMiniCPM4-0.5B</li>
<li>[â] æ¯æä¸ä¸ªmoeæ¨¡å:Qwen3-30B-A3B(ææ¶ä¸æ¯æå¥å¾)</li>
<li>[ð] æ¯æä¸ä¸ªomniæ¨¡å</li>
<li>[â] æ¯æä¸ä¸ªvlæ¨¡å:Qwen3-VL-2B-Instruct(ææ¶ä¸æ¯æå¥å¾)</li>
<li>[â] å®ç°page attention</li>
<li>[ð] å®ç°ä¸ä¸ªèªå®ä¹ç®å­</li>
<li>[ð] æ¯æå¨çº¿æ¨ç</li>
</ul>
<p>torchairæ¥å£åè <a href="https://www.hiascend.com/document/detail/zh/Pytorch/710/modthirdparty/torchairuseguide/torchair_00008.html" target="_blank" rel="noopener nofollow">https://www.hiascend.com/document/detail/zh/Pytorch/710/modthirdparty/torchairuseguide/torchair_00008.html</a><br>
èåç®å­æ¥å£åè <a href="https://www.hiascend.com/document/detail/zh/Pytorch/720/apiref/torchnpuCustomsapi/context/torch_npu-npu_fused_infer_attention_score_v2.md" target="_blank" rel="noopener nofollow">https://www.hiascend.com/document/detail/zh/Pytorch/720/apiref/torchnpuCustomsapi/context/torch_npu-npu_fused_infer_attention_score_v2.md</a><br>
attentionå®ç°åè <a href="https://gitee.com/omniai/omniinfer/blob/master/omni/layers/attention/backend/attention.py" target="_blank" rel="noopener nofollow">https://gitee.com/omniai/omniinfer/blob/master/omni/layers/attention/backend/attention.py</a>  forward_vanillaå½æ°</p>
<h2 id="æ¯æçæ¨¡å">æ¯æçæ¨¡å</h2>
<table>
<thead>
<tr>
<th>æ¶æ</th>
<th>æ¨¡å</th>
<th>ç¤ºä¾ HF æ¨¡å</th>
</tr>
</thead>
<tbody>
<tr>
<td>Qwen3ForCausalLM</td>
<td>Qwen3-0.6B,Qwen3-32B</td>
<td></td>
</tr>
<tr>
<td>Qwen2ForCausalLM</td>
<td>Qwen2-0.5B</td>
<td></td>
</tr>
<tr>
<td>LlamaForCausalLM</td>
<td>Llama-3.2-1B-Instruct</td>
<td></td>
</tr>
<tr>
<td>Qwen3MoeForCausalLM</td>
<td>Qwen3-30B-A3B</td>
<td></td>
</tr>
<tr>
<td>Qwen3VLForConditionalGeneration</td>
<td>Qwen2.5-VL-3B-Instruct</td>
<td></td>
</tr>
<tr>
<td>MiniCPMForCausalLM</td>
<td>MiniCPM4-0.5B</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="ä»£ç è¡æ°">ä»£ç è¡æ°</h2>
<p>ð æ»ä½æ°æ®</p>
<table>
<thead>
<tr>
<th>èå´</th>
<th>æä»¶æ°</th>
<th>æ»è¡æ°</th>
<th>å æ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>nanovllm å¨é¨</td>
<td>20 ä¸ª</td>
<td>4,652 è¡</td>
<td>100%</td>
</tr>
<tr>
<td>models ç®å½</td>
<td>5 ä¸ª</td>
<td>2,224 è¡</td>
<td>47.8%</td>
</tr>
<tr>
<td>é¤ models å¤</td>
<td>15 ä¸ª</td>
<td>2,428 è¡</td>
<td>52.2%</td>
</tr>
</tbody>
</table>
<h2 id="æ¨çä¼åææ¯å¤§çº²">æ¨çä¼åææ¯å¤§çº²</h2>
<p>ð <strong>å®æ´ææ¯ææ¡£</strong>ï¼<a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/inference_optimization_guide.md" target="_blank" rel="noopener nofollow">LLM æ¨çä¼åææ¯å¤§çº²</a></p>
<p>æ¬ææ¡£æ´çäº LLM æ¨çé¢åç <strong>20 å¤§ç±»å³é®ææ¯</strong>ï¼åä¸º 7 ä¸ªå±æ¬¡ï¼</p>
<h3 id="-æ ¸å¿ææ¯åºç¡å¿å¤">ð¥ æ ¸å¿ææ¯ï¼åºç¡å¿å¤ï¼</h3>
<ul>
<li><strong>KV Cache ç®¡ç</strong>ï¼PageAttentionãPrefix CachingãKV Cache åç¼©</li>
<li><strong>Attention ä¼å</strong>ï¼FlashAttentionãGQA/MQAãç¨çæ³¨æå</li>
<li><strong>æ¹å¤çç­ç¥</strong>ï¼Continuous BatchingãDynamic Batching</li>
</ul>
<h3 id="-æ§è½ä¼åè¿é¶">ð æ§è½ä¼åï¼è¿é¶ï¼</h3>
<ul>
<li><strong>éåææ¯</strong>ï¼INT8/INT4/FP8ãAWQãGPTQãGGUF</li>
<li><strong>ææºéæ ·</strong>ï¼Speculative DecodingãMedusaãLookahead</li>
<li><strong>è§£ç ä¼å</strong>ï¼Parallel DecodingãToken Tree Verification</li>
</ul>
<h3 id="ï¸-ç³»ç»æ¶æ">ðï¸ ç³»ç»æ¶æ</h3>
<ul>
<li><strong>è°åº¦ç­ç¥</strong>ï¼FCFSãSJFãPriority-basedãPreemption</li>
<li><strong>åå­ä¼å</strong>ï¼Memory PoolãSwappingãOffloading</li>
<li><strong>å¹¶è¡ç­ç¥</strong>ï¼Tensor/Pipeline/Expert/Sequence Parallelism</li>
</ul>
<h3 id="-ç¹æ®åºæ¯">ð§  ç¹æ®åºæ¯</h3>
<ul>
<li><strong>é¿ä¸ä¸æ</strong>ï¼RoPE ScalingãStreamingLLMãRing Attention</li>
<li><strong>å¤æ¨¡æ</strong>ï¼Vision-LanguageãAudio-LanguageãUnified Architecture</li>
<li><strong>MoE ä¼å</strong>ï¼Expert RoutingãLoad BalancingãAll-to-All éä¿¡</li>
</ul>
<h3 id="-åºå±ä¼å">â¡ åºå±ä¼å</h3>
<ul>
<li><strong>å¾ç¼è¯</strong>ï¼TorchAirãTensorRT-LLMãTorch.compile</li>
<li><strong>ç®å­èå</strong>ï¼QKV FusionãCustom CUDA/Triton Kernels</li>
<li><strong>éä¿¡ä¼å</strong>ï¼NCCL/HCCLãRDMAãGPUDirect</li>
</ul>
<h3 id="-è¯ä¼°è§æµ">ð è¯ä¼°è§æµ</h3>
<ul>
<li><strong>æ§è½åæ</strong>ï¼Memory/Compute ProfilingãRoofline Analysis</li>
<li><strong>å³é®ææ </strong>ï¼TTFTãTPOTãThroughputãGPU Utilization</li>
</ul>
<h3 id="-åæ²¿è¶å¿">ð® åæ²¿è¶å¿</h3>
<ul>
<li><strong>æ¨¡åæ¶æ</strong>ï¼Mamba/RWKVãMixture of DepthsãRetNet</li>
<li><strong>æå¡å</strong>ï¼Disaggregated ServingãElastic Scaling</li>
<li><strong>æ°å´æ¹å</strong>ï¼æ¨çè¸é¦ãEarly ExitãHardware-Aware NAS</li>
</ul>
<hr>
<h2 id="attention">Attention</h2>
<h3 id="pageattention">PageAttention</h3>
<p><strong>PageAttention</strong> æ¯ vLLM çæ ¸å¿åæ°ææ¯ï¼çµææ¥èªæä½ç³»ç»ç<strong>èæåå­åé¡µæºå¶</strong>ï¼ç¨äºé«æç®¡ç LLM æ¨çä¸­ç KV Cacheã</p>
<h4 id="æ ¸å¿æ¦å¿µ">æ ¸å¿æ¦å¿µ</h4>
<p>ä¼ ç» KV Cache åéæ¹å¼ä¼ä¸ºæ¯ä¸ªåºåé¢åéæå¤§å¯è½é¿åº¦çè¿ç»­åå­ï¼å¯¼è´ä¸¥éçåå­æµªè´¹åç¢çãPageAttention åé´æä½ç³»ç»åé¡µææ³ï¼å° KV Cache ååä¸ºåºå®å¤§å°ç blockï¼æéå¨æåéã</p>
<h4 id="å³é®ææ¯ç¹">å³é®ææ¯ç¹</h4>
<table>
<thead>
<tr>
<th>ææ¯</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Block ç®¡ç</strong></td>
<td>å° KV Cache ååä¸ºåºå®å¤§å°ç blockï¼å¦ 16/32 tokensï¼ï¼æ¯ä¸ª block ç¬ç«åé</td>
</tr>
<tr>
<td><strong>Block Table</strong></td>
<td>ç±»ä¼¼é¡µè¡¨çæ°æ®ç»æï¼è®°å½é»è¾ token ä½ç½®å°ç©ç block çæ å°å³ç³»</td>
</tr>
<tr>
<td><strong>éè¿ç»­å­å¨</strong></td>
<td>åä¸åºåç KV Cache å¯ä»¥åæ£å¨å¤ä¸ªä¸è¿ç»­ç block ä¸­</td>
</tr>
<tr>
<td><strong>åå­å±äº«</strong></td>
<td>å¹¶è¡è§£ç ï¼å¦ beam searchï¼æ¶å¯å±äº« prompt ç KV cache</td>
</tr>
<tr>
<td><strong>Copy-on-Write</strong></td>
<td>åæ¶å¤å¶æºå¶ï¼ä»å¨éè¦ä¿®æ¹æ¶æå¤å¶ block</td>
</tr>
</tbody>
</table>
<h4 id="åå­ä½¿ç¨å¯¹æ¯">åå­ä½¿ç¨å¯¹æ¯</h4>
<pre><code>ä¼ ç»æ¹å¼ï¼
- åºåé¿åº¦ 1000ï¼æå¤§æ¯æ 4096
- åå­å ç¨ï¼4096 * hidden_size
- æµªè´¹çï¼çº¦ 75%

PageAttentionï¼
- åºåé¿åº¦ 1000ï¼block_size=16
- éè¦ blockï¼1000/16 = 63 ä¸ª
- å®éåéï¼63 * 16 = 1008 tokens
- æµªè´¹çï¼ä» 0.8%
</code></pre>
<h4 id="ä»£ç å®ç°">ä»£ç å®ç°</h4>
<pre><code class="language-python"># nanovllm/layers/attention.py
# Block Table æ å°
block_table = context.block_tables  # æ å°è¡¨

# Slot Mapping - å° token æ å°å° block ä¸­çå·ä½ä½ç½®
# slot_mapping æ ¼å¼ï¼[block_idx, offset_in_block]
context.slot_mapping

# åé¡µå­å¨ KV Cache
torch_npu._npu_reshape_and_cache(
    k, v,
    k_cache.view(num_blocks, block_size, num_kv_heads, head_dim),
    v_cache.view(num_blocks, block_size, num_kv_heads, head_dim),
    slot_mapping.int()
)
</code></pre>
<h4 id="ä¼å¿">ä¼å¿</h4>
<ol>
<li><strong>åå­æç</strong>ï¼æéåéï¼æ åé¨ç¢ç</li>
<li><strong>å¨ææ©å±</strong>ï¼åºåå¢é¿æ¶åªéåéæ° block</li>
<li><strong>åå­å±äº«</strong>ï¼å¤ä¸ªåºåå¯å±äº«ç¸åç prompt KV Cache</li>
<li><strong>é«ååé</strong>ï¼æ¯ææ´å¤§ç batch size</li>
</ol>
<h4 id="è¯¦ç»å¯¹æ¯">è¯¦ç»å¯¹æ¯</h4>
<p>ð <strong>è¯¦ç»ææ¯ææ¡£</strong>ï¼<a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/pageattention_comparison.md" target="_blank" rel="noopener nofollow">HuggingFace Transformers æ©æå®ç°ä¸ PageAttention å¯¹æ¯</a></p>
<p>åå«ï¼</p>
<ul>
<li>æ©æ Transformers ä»£ç å®ç°åæ</li>
<li>åå­æµªè´¹çéåå¯¹æ¯ï¼75% vs 6.25%ï¼</li>
<li>ä¸å batch size ååºåé¿åº¦çè¯¦ç»å¯¹æ¯è¡¨</li>
<li>vLLM è®ºææ°æ®æ¥æºè¯´æ</li>
<li>å®éä»£ç ç¤ºä¾ååºæ¯åæ</li>
</ul>
<hr>
<h3 id="flashattention">FlashAttention</h3>
<p><strong>FlashAttention</strong> æ¯æ¯å¦ç¦å¤§å­¦æåºç <strong>IO æç¥</strong> æ³¨æåä¼åç®æ³ï¼éè¿ååè®¡ç®ååå° HBMï¼é«å¸¦å®½åå­ï¼è®¿é®æ¥æåæ§è½ã</p>
<h4 id="æ ¸å¿é®é¢">æ ¸å¿é®é¢</h4>
<p>æ å Attention å®ç°éè¦å­å¨ä¸­é´ç»æï¼æ³¨æåç©éµï¼å° HBMï¼å¯¼è´ï¼</p>
<ul>
<li><strong>åå­ç¶é¢</strong>ï¼HBM å¸¦å®½è¿ä½äºè®¡ç®éåº¦</li>
<li><strong>O(NÂ²) åå­</strong>ï¼åºåé¿åº¦çå¹³æ¹çº§åå­å¢é¿</li>
<li><strong>å¤æ¬¡æ°æ®æ¬è¿</strong>ï¼QãKãV éè¦å¤æ¬¡è¯»å HBM</li>
</ul>
<h4 id="æ ¸å¿åæ°">æ ¸å¿åæ°</h4>
<table>
<thead>
<tr>
<th>ææ¯</th>
<th>åç</th>
<th>ææ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Tilingï¼ååï¼</strong></td>
<td>å° QãKãV ååå è½½å°é«é SRAM</td>
<td>åå° HBM è®¿é®æ¬¡æ°</td>
</tr>
<tr>
<td><strong>Online Softmax</strong></td>
<td>æµå¼è®¡ç® softmaxï¼æ éå®æ´æ³¨æåç©éµ</td>
<td>åå­éè³ O(N)</td>
</tr>
<tr>
<td><strong>Recomputation</strong></td>
<td>ååä¼ æ­æ¶éæ°è®¡ç®ä¸­é´å¼</td>
<td>çºç²è®¡ç®æ¢åå­</td>
</tr>
<tr>
<td><strong>Kernel Fusion</strong></td>
<td>å¤ä¸ªæä½èåä¸ºåä¸ª CUDA kernel</td>
<td>åå° kernel å¯å¨å¼é</td>
</tr>
</tbody>
</table>
<h4 id="åå­å±æ¬¡ç»æå¯¹æ¯">åå­å±æ¬¡ç»æå¯¹æ¯</h4>
<pre><code>GPU åå­å±æ¬¡ï¼
âââââââââââââââââââââââââââââââââââââââ
â  HBM (High Bandwidth Memory)        â  â 1.5 TB/sï¼å®¹éå¤§ä½éåº¦æ¢
â  - å®¹éï¼40-80 GB                   â  â æ å Attention å¨æ­¤é¢ç¹è¯»å
â  - å»¶è¿ï¼é«                         â
âââââââââââââââââââââââââââââââââââââââ¤
â  SRAM (Static RAM / Shared Memory)  â  â 19 TB/sï¼å®¹éå°ä½éåº¦å¿«
â  - å®¹éï¼~100 KB per SM             â  â FlashAttention ä¸»è¦å¨æ­¤è®¡ç®
â  - å»¶è¿ï¼æä½                       â
âââââââââââââââââââââââââââââââââââââââ
</code></pre>
<h4 id="è®¡ç®æµç¨å¯¹æ¯">è®¡ç®æµç¨å¯¹æ¯</h4>
<p><strong>æ å Attentionï¼</strong></p>
<pre><code>1. ä» HBM å è½½ Q, K, V
2. è®¡ç® S = QK^T â åå¥ HBM
3. è®¡ç® P = softmax(S) â åå¥ HBM  
4. è®¡ç® O = PV â åå¥ HBM
â å¤æ¬¡ HBM è¯»åï¼åå­å ç¨ O(NÂ²)
</code></pre>
<p><strong>FlashAttentionï¼</strong></p>
<pre><code>1. ååå è½½ Qáµ¢, Kâ±¼, Vâ±¼ å° SRAM
2. å¨ SRAM ä¸­è®¡ç® softmax
3. ç´¯å ç»æå°è¾åº
4. ä¸¢å¼ä¸­é´ç»æï¼éå¤ç´å°å®æ
â ä»é O(N) åå­ï¼å¤§å¹åå° HBM è®¿é®
</code></pre>
<h4 id="ä»£ç å®ç°-1">ä»£ç å®ç°</h4>
<pre><code class="language-python"># nanovllm/layers/attention_ori.py
from flash_attn import (
    flash_attn_varlen_func,      # Prefill é¶æ®µ
    flash_attn_with_kvcache      # Decode é¶æ®µ
)

# Prefill - å¤çåé¿åºåï¼æ¯æ PageAttention
flash_attn_varlen_func(
    q, k, v,
    max_seqlen_q=max_seqlen_q,
    cu_seqlens_q=cu_seqlens_q,    # ç´¯è®¡é¿åº¦æ¯æåé¿
    causal=True,                  # å ææ©ç 
    block_table=block_table       # PageAttention block table
)

# Decode - å token æ¨çï¼å¤ç¨åé¡µ KV Cache
flash_attn_with_kvcache(
    q.unsqueeze(1),               # [batch, 1, num_heads, head_dim]
    k_cache, v_cache,             # åé¡µ KV ç¼å­
    cache_seqlens=context_lens,   # å®éåºåé¿åº¦
    block_table=block_table       # block table æ å°
)
</code></pre>
<h4 id="æ§è½æ¶ç">æ§è½æ¶ç</h4>
<ul>
<li><strong>åå­æç</strong>ï¼ä» O(NÂ²) éè³ O(N)</li>
<li><strong>è®¡ç®éåº¦</strong>ï¼A100 ä¸å¯è¾¾ <strong>2-4 å</strong>å é</li>
<li><strong>åºåé¿åº¦</strong>ï¼æ¯ææ´é¿çä¸ä¸æï¼å¦ 100K+ tokensï¼</li>
</ul>
<hr>
<h3 id="ä¸ç§-attention-å®ç°å¯¹æ¯">ä¸ç§ Attention å®ç°å¯¹æ¯</h3>
<p>æ¬é¡¹ç®åå«ä¸ç§ Attention å®ç°ï¼éç¨äºä¸ååºæ¯ï¼</p>
<table>
<thead>
<tr>
<th>ç¹æ§</th>
<th>attention_ori.py</th>
<th>attention.py</th>
<th>attention_torch_native.py</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åºå±å®ç°</strong></td>
<td>Flash Attention åº</td>
<td>NPU åçç®å­</td>
<td>PyTorch åç</td>
</tr>
<tr>
<td><strong>éç¨å¹³å°</strong></td>
<td>CUDA GPU</td>
<td>åä¸ºæè¾ NPU</td>
<td>éç¨ï¼CPU/GPUï¼</td>
</tr>
<tr>
<td><strong>æ§è½</strong></td>
<td>â­â­â­â­â­</td>
<td>â­â­â­â­â­</td>
<td>â­â­</td>
</tr>
<tr>
<td><strong>å¯è¯»æ§</strong></td>
<td>â­â­</td>
<td>â­â­</td>
<td>â­â­â­â­â­</td>
</tr>
<tr>
<td><strong>ç¨é</strong></td>
<td>çäº§ç¯å¢ï¼GPUï¼</td>
<td>çäº§ç¯å¢ï¼NPUï¼</td>
<td>å­¦ä¹ è°è¯</td>
</tr>
</tbody>
</table>
<p><strong>éæ©å»ºè®®ï¼</strong></p>
<ul>
<li><strong>çäº§ç¯å¢ï¼GPUï¼</strong>ï¼ä½¿ç¨ <code>attention_ori.py</code>ï¼Flash Attentionï¼</li>
<li><strong>çäº§ç¯å¢ï¼æè¾ NPUï¼</strong>ï¼ä½¿ç¨ <code>attention.py</code>ï¼NPU ç®å­ï¼</li>
<li><strong>å­¦ä¹ /è°è¯</strong>ï¼ä½¿ç¨ <code>attention_torch_native.py</code>ï¼æäºçè§£ï¼</li>
</ul>
<h2 id="ææ¡£ç´¢å¼">ææ¡£ç´¢å¼</h2>
<p>æ¬ç®å½åå«é¡¹ç®åæ¨¡åçè¯¦ç»æµç¨å¾ææ¡£ï¼ä½¿ç¨ Mermaid è¯­æ³ç»å¶ã</p>
<h3 id="engine-æ¨¡åæµç¨å¾">Engine æ¨¡åæµç¨å¾</h3>
<table>
<thead>
<tr>
<th>ææ¡£</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/engine/sequence_flowchart.md" target="_blank" rel="noopener nofollow">docs/engine/sequence_flowchart.md</a></td>
<td>Sequence åºåç¶æç®¡çæµç¨</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/engine/block_manager_flowchart.md" target="_blank" rel="noopener nofollow">docs/engine/block_manager_flowchart.md</a></td>
<td>BlockManager KVç¼å­åç®¡çæµç¨</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/engine/scheduler_flowchart.md" target="_blank" rel="noopener nofollow">docs/engine/scheduler_flowchart.md</a></td>
<td>Scheduler è°åº¦å¨æµç¨</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/engine/model_runner_flowchart.md" target="_blank" rel="noopener nofollow">docs/engine/model_runner_flowchart.md</a></td>
<td>ModelRunner æ¨¡åè¿è¡å¨æµç¨</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/engine/llm_engine_flowchart.md" target="_blank" rel="noopener nofollow">docs/engine/llm_engine_flowchart.md</a></td>
<td>LLMEngine ä¸»å¼ææµç¨</td>
</tr>
</tbody>
</table>
<h3 id="layers-æ¨¡åæµç¨å¾">Layers æ¨¡åæµç¨å¾</h3>
<table>
<thead>
<tr>
<th>ææ¡£</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/linear_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/linear_flowchart.md</a></td>
<td>çº¿æ§å±ä¸å¼ éå¹¶è¡ç­ç¥</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/attention_torch_native_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/attention_torch_native_flowchart.md</a></td>
<td>PyTorchåçAttentionå®ç°</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/attention_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/attention_flowchart.md</a></td>
<td>NPUä¸ç¨Attentionå®ç°</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/attention_ori_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/attention_ori_flowchart.md</a></td>
<td>Flash Attentionä¼åå®ç°</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/sampler_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/sampler_flowchart.md</a></td>
<td>éæ ·å¨ï¼æ¸©åº¦éæ ·ï¼</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/rotary_embedding_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/rotary_embedding_flowchart.md</a></td>
<td>RoPEä½ç½®ç¼ç </td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/layernorm_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/layernorm_flowchart.md</a></td>
<td>RMSNormå½ä¸åå±</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/embed_head_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/embed_head_flowchart.md</a></td>
<td>è¯åµå¥ä¸LM Head</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/layers/activation_flowchart.md" target="_blank" rel="noopener nofollow">docs/layers/activation_flowchart.md</a></td>
<td>SwiGLUæ¿æ´»å½æ°</td>
</tr>
</tbody>
</table>
<h3 id="models-æ¨¡åæµç¨å¾">Models æ¨¡åæµç¨å¾</h3>
<table>
<thead>
<tr>
<th>ææ¡£</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/models/llama_flowchart.md" target="_blank" rel="noopener nofollow">docs/models/llama_flowchart.md</a></td>
<td>Llamaæ¨¡åæ¶æ</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/models/qwen3_flowchart.md" target="_blank" rel="noopener nofollow">docs/models/qwen3_flowchart.md</a></td>
<td>Qwen3æ¨¡åæ¶æ</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/models/qwen3_vl_flowchart.md" target="_blank" rel="noopener nofollow">docs/models/qwen3_vl_flowchart.md</a></td>
<td>Qwen3-VLå¤æ¨¡ææ¨¡åæ¶æ</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/models/qwen3_moe_flowchart.md" target="_blank" rel="noopener nofollow">docs/models/qwen3_moe_flowchart.md</a></td>
<td>Qwen3-MoEç¨çä¸å®¶æ¨¡åæ¶æ</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/models/mini_cpm4_flowchart.md" target="_blank" rel="noopener nofollow">docs/models/mini_cpm4_flowchart.md</a></td>
<td>MiniCPM4æ¨¡åæ¶æ</td>
</tr>
<tr>
<td><a href="https://github.com/linzm1007/nano-vllm-ascend/blob/main/docs/models/models_map_flowchart.md" target="_blank" rel="noopener nofollow">docs/models/models_map_flowchart.md</a></td>
<td>æ¨¡åæ³¨åæ å°å³ç³»</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="benchæ°æ®">benchæ°æ®</h2>
<p>ä»ä¾åèï¼ç¡¬è½¯æ¡ä»¶ä¸åï¼è·åºçæ°æ®ä¹ä¼æå·®å¼</p>
<h4 id="ä¸åæ¨¡åå¯¹æ¯">ä¸åæ¨¡åå¯¹æ¯</h4>
<table>
<thead>
<tr>
<th>model</th>
<th>Output Tokens</th>
<th>Time (s)</th>
<th>Throughput (tokens/s)</th>
<th>TP</th>
</tr>
</thead>
<tbody>
<tr>
<td>Qwen3-0.6B</td>
<td>143,770</td>
<td>36.82</td>
<td>3904.20</td>
<td>1</td>
</tr>
<tr>
<td>Qwen2-0.5B</td>
<td>143,770</td>
<td>20.71</td>
<td>6940.84</td>
<td>1</td>
</tr>
<tr>
<td>Qwen2.5-0.5B-Instruct</td>
<td>143,770</td>
<td>19.82</td>
<td>7252.67</td>
<td>1</td>
</tr>
<tr>
<td>Llama-3.2-1B-Instruct</td>
<td>143,770</td>
<td>25.45</td>
<td>5648.50</td>
<td>1</td>
</tr>
<tr>
<td>Qwen3-32B</td>
<td>143,770</td>
<td>206.69</td>
<td>695.59</td>
<td>2</td>
</tr>
<tr>
<td>Qwen3-32B</td>
<td>143,770</td>
<td>119.86</td>
<td>1199.50</td>
<td>4</td>
</tr>
</tbody>
</table>
<h4 id="å¶ä»æ¡æ¶å¯¹æ¯2025-12-30">å¶ä»æ¡æ¶å¯¹æ¯(2025-12-30)</h4>
<p>vLLM Nano-vLLM æ°æ®æ¥æº <a href="https://github.com/GeeeekExplorer/nano-vllm" target="_blank" rel="noopener nofollow">https://github.com/GeeeekExplorer/nano-vllm</a></p>
<table>
<thead>
<tr>
<th>Inference Engine</th>
<th>Output Tokens</th>
<th>Time (s)</th>
<th>Throughput (tokens/s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>vLLM</td>
<td>133,966</td>
<td>98.37</td>
<td>1361.84</td>
</tr>
<tr>
<td>Nano-vLLM</td>
<td>133,966</td>
<td>93.41</td>
<td>1434.13</td>
</tr>
<tr>
<td>Nano-vLLM-Ascend python torchåçå®ç°</td>
<td>4805</td>
<td>257.49</td>
<td>18.66</td>
</tr>
<tr>
<td>Nano-vLLM-Ascend èåç®å­+å¾ç¼è¯bs=256</td>
<td>133,966</td>
<td>33.88</td>
<td>3954.20</td>
</tr>
</tbody>
</table>
<h4 id="å¾æ¨¡å¼ä¸åbså¯¹æ¯2025-12-30">å¾æ¨¡å¼ä¸åbså¯¹æ¯(2025-12-30)</h4>
<table>
<thead>
<tr>
<th>Batch Size</th>
<th>Output Tokens</th>
<th>Time (s)</th>
<th>Throughput (tokens/s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>bs=16</td>
<td>133,966</td>
<td>107.23</td>
<td>1249.37</td>
</tr>
<tr>
<td>bs=32</td>
<td>133,966</td>
<td>75.89</td>
<td>1765.35</td>
</tr>
<tr>
<td>bs=48</td>
<td>133,966</td>
<td>64.84</td>
<td>2066.22</td>
</tr>
<tr>
<td>bs=64</td>
<td>133,966</td>
<td>54.06</td>
<td>2478.31</td>
</tr>
<tr>
<td>bs=128</td>
<td>133,966</td>
<td>43.08</td>
<td>3109.56</td>
</tr>
<tr>
<td>bs=256</td>
<td>133,966</td>
<td>33.88</td>
<td>3954.20</td>
</tr>
</tbody>
</table>
<h4 id="åç®å­paddingånon-paddingå¯¹æ¯2025-12-30">åç®å­PaddingåNon-paddingå¯¹æ¯(2025-12-30)</h4>
<p>bs=256</p>
<table>
<thead>
<tr>
<th>Prepare Strategy</th>
<th>Output Tokens</th>
<th>Time (s)</th>
<th>Throughput (tokens/s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Padding</td>
<td>133,966</td>
<td>158.46</td>
<td>845.41</td>
</tr>
<tr>
<td>Non-padding</td>
<td>133,966</td>
<td>152.14</td>
<td>880.55</td>
</tr>
</tbody>
</table>
<h2 id="ç¯å¢æ­å»ºåèvllm-ascend">ç¯å¢æ­å»ºï¼åèvllm-ascendï¼</h2>
<p><a href="https://docs.vllm.ai/projects/vllm-ascend-cn/zh-cn/latest/quick_start.html" target="_blank" rel="noopener nofollow">https://docs.vllm.ai/projects/vllm-ascend-cn/zh-cn/latest/quick_start.html</a></p>
<p>ubuntu</p>
<pre><code># Update DEVICE according to your device (/dev/davinci[0-7])
export DEVICE=/dev/davinci0
# Update the vllm-ascend image
# Atlas A2:
# export IMAGE=quay.io/ascend/vllm-ascend:v0.14.0rc1
# Atlas A3:
# export IMAGE=quay.io/ascend/vllm-ascend:v0.14.0rc1-a3
export IMAGE=quay.io/ascend/vllm-ascend:v0.14.0rc1
docker run --rm \
--name vllm-ascend \
--shm-size=1g \
--device $DEVICE \
--device /dev/davinci_manager \
--device /dev/devmm_svm \
--device /dev/hisi_hdc \
-v /usr/local/dcmi:/usr/local/dcmi \
-v /usr/local/bin/npu-smi:/usr/local/bin/npu-smi \
-v /usr/local/Ascend/driver/lib64/:/usr/local/Ascend/driver/lib64/ \
-v /usr/local/Ascend/driver/version.info:/usr/local/Ascend/driver/version.info \
-v /etc/ascend_install.info:/etc/ascend_install.info \
-v /root/.cache:/root/.cache \
-p 8000:8000 \
-it $IMAGE bash
# Install curl
apt-get update -y &amp;&amp; apt-get install -y curl
</code></pre>
<h2 id="å®è£ä¾èµ">å®è£ä¾èµ</h2>
<pre><code class="language-bash">pip install .
</code></pre>
<h2 id="æ¨¡åä¸è½½">æ¨¡åä¸è½½</h2>
<pre><code class="language-bash">huggingface-cli download --resume-download Qwen/Qwen3-0.6B \
  --local-dir ~/huggingface/Qwen3-0.6B/ \
  --local-dir-use-symlinks False
</code></pre>
<h2 id="å¿«éå¼å§">å¿«éå¼å§</h2>
<p>è¯·åè§ example.py äºè§£ç¨æ³ãè¯¥ API ä¸ vLLM çæ¥å£åºæ¬ä¸è´ï¼ä»å¨ LLM.generate æ¹æ³ä¸å­å¨ä¸äºç»å¾®å·®å¼ï¼</p>
<pre><code class="language-python">from nanovllm import LLM, SamplingParams
llm = LLM("/YOUR/MODEL/PATH", enforce_eager=True, tensor_parallel_size=1)
sampling_params = SamplingParams(temperature=0.6, max_tokens=256)
prompts = ["Hello, Nano-vLLM."]
outputs = llm.generate(prompts, sampling_params)
outputs[0]["text"]
</code></pre>
<h2 id="exampleè¿è¡ç»æ">exampleè¿è¡ç»æ</h2>
<p><img alt="result-image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2257481/202512/2257481-20251207210731923-1974827089.png" class="lazyload"></p>
<h2 id="benchç¯å¢">benchç¯å¢</h2>
<p>ä»ä¾åè<br>
ascend-dmi -c #æ¥ç</p>
<ul>
<li>ç¡¬ä»¶ç¯å¢âï¼
<ul>
<li>1.æ¾å¡:A3 910C</li>
<li>2.é©±å¨çæ¬:24.1.rc3.10</li>
<li>3.åºä»¶çæ¬:7.5.0.109.220</li>
</ul>
</li>
<li>âè½¯ä»¶ç¯å¢âï¼
<ul>
<li>1.CANNå 8.3.RC1</li>
<li>2.PTAçæ¬ï¼torch-npu 2.5.1.post2+gitd7a85f8ï¼torch 2.5.1</li>
</ul>
</li>
</ul>
<h2 id="benchmark">Benchmark</h2>
<p>See <code>bench.py</code> for benchmark.</p>
<p><strong>Test Configuration:</strong></p>
<ul>
<li>Model: Qwen3-0.6B</li>
<li>Total Requests: 256 sequences</li>
<li>Input Length: Randomly sampled between 100â1024 tokens</li>
<li>Output Length: Randomly sampled between 100â1024 tokens</li>
</ul>
<p><strong>Performance Results:</strong><br>
Nano-vLLM-Ascend å®å¨å¤ªæ¢äºåªè·äº10æ¡seq</p>
<table>
<thead>
<tr>
<th>Inference Engine</th>
<th>Output Tokens</th>
<th>Time (s)</th>
<th>Throughput (tokens/s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>vLLM</td>
<td>133,966</td>
<td>98.37</td>
<td>1361.84</td>
</tr>
<tr>
<td>Nano-vLLM</td>
<td>133,966</td>
<td>93.41</td>
<td>1434.13</td>
</tr>
<tr>
<td>Nano-vLLM-Ascend</td>
<td>4805</td>
<td>257.49</td>
<td>18.66</td>
</tr>
</tbody>
</table>
<h2 id="qwen3-06b-layers">qwen3-0.6B layers</h2>
<pre><code class="language-angular2html">ModuleList(
  (0-27): 28 x Qwen3DecoderLayer(
    (self_attn): Qwen3Attention(
      (qkv_proj): QKVParallelLinear()
      (o_proj): RowParallelLinear()
      (rotary_emb): RotaryEmbedding()
      (attn): Attention()
      (q_norm): RMSNorm()
      (k_norm): RMSNorm()
    )
    (mlp): Qwen3MLP(
      (gate_up_proj): MergedColumnParallelLinear()
      (down_proj): RowParallelLinear()
      (act_fn): SiluAndMul()
    )
    (input_layernorm): RMSNorm()
    (post_attention_layernorm): RMSNorm()
  )
)

</code></pre>


</div>
<div id="MySignature" role="contentinfo">
    èå¤©åç½äºæ¯æ éã
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.02013888888888889" data-date-updated="2026-02-13 12:07">2026-02-13 11:38</span>&nbsp;
<a href="https://www.cnblogs.com/linzm14">linzm14</a>&nbsp;
éè¯»(<span id="post_view_count">10</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19611415);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19611415', targetLink: 'https://www.cnblogs.com/linzm14/p/19611415', title: 'Nano-vLLM-Ascend(æç»­æ´æ°ä¸­)' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ AI Ã åå®¢å­ç®è¤ ]]></title>
    <link>https://www.cnblogs.com/guangzan/p/19609096</link>
    <guid>e830f117701ded3fd34c9afd873210ae</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/guangzan/p/19609096" title="åå¸äº 2026-02-13 10:56">
    <span role="heading" aria-level="2">AI Ã åå®¢å­ç®è¤</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="1-åè¨">1. åè¨</h2>
<p>åå®¢å­èª 2004 å¹´ä¸çº¿ä»¥æ¥ï¼å­åçç®æ´ççé¢ãæµåçææ¯æ°å´æä¸ºäºå½åç¨åºåçæ ¸å¿åä½å¹³å°ä¹ä¸ï¼èç®è¤å®å¶åæ¯åå®¢å­ç¨æ·ä¸ªæ§åè¡¨è¾¾çéè¦æ¹å¼ãä»æ©æççº¯ CSS æ ·å¼ä¿®æ¹ï¼å°åæ¥ç JS èæ¬å¢å¼ºï¼åå®¢å­ç®è¤å¼åçéæ±ä¸æ­åçº§ï¼ä½å¹³å°çåçå¼åæ¨¡å¼å´å§ç»æ²¡æè·ä¸åç«¯ææ¯çåå±æ­¥ä¼ã</p>
<p>å¨åç«¯å·¥ç¨åãç°ä»£åæ¡æ¶ï¼React/Vueï¼ãå®ç¨å CSS æ¡æ¶ï¼Tailwind CSSï¼æä¸ºè¡ä¸ä¸»æµï¼ä¸ AI å¤§æ¨¡åæ·±åº¦èå¥åç«¯å¼åçä»å¤©ï¼åå®¢å­åççâæµè§å¨ç«¯ä¿®æ¹ CSS/JS çæ®µâçå¼åæ¨¡å¼æ¾å¾æ ¼æ ¼ä¸å¥ï¼ç¨æ·åªè½å¨æµè§å¨ä¸­æ£æ¥åç´ ãä¿®æ¹æ ·å¼ï¼æ²¡æç­æ¨¡åæ¿æ¢ï¼HMRï¼ãæ²¡æç±»åæ ¡éªãæ²¡ææåä¼åãæ²¡ææ¨¡ååï¼æ æ³äº«åç°ä»£åç«¯ä¾¿å©ãæ´è®© AI å¤§æ¨¡åæ æ³æææ¥å¥ââAI é¾ä»¥è¯»ååå®¢å­çåçæ¨¡æ¿ã</p>
<p>æ­£æ¯å¨è¿æ ·çèæ¯ä¸ï¼æåå»ºäº <strong>Tona</strong>ãTona æ¯åºäº Monorepo æ¶ææé çä¸å¥å®æ´çåå®¢å­ç®è¤å¼åå·¥å·é¾ãæ¬æå°ä»ææ¯åºå±å°å®æåºç¨ï¼å¨é¢ä»ç» Tona çè®¾è®¡ä¸å®ç°ï¼å¹¶ç»å AI å¤§æ¨¡åçè½åï¼æé ä¸å¥ <strong>AI Ã Tona Ã åå®¢å­ç®è¤</strong>çç°ä»£åå¼åèå¼ï¼è®©æ¯ä¸ä½å¼åèé½è½å¿«éå¼ååºé«è´¨éãå¯ç»´æ¤ãä¸ªæ§åçåå®¢å­ç®è¤ï¼åæ¶äº«å AI åä½å¼åçé«æä¸ä¾¿æ·ã</p>
<h2 id="2-åå®¢å­ç®è¤å¼åççç¹">2. åå®¢å­ç®è¤å¼åççç¹</h2>
<p>åå®¢å­ä¸ºç¨æ·æä¾äº<strong>é¡µé¢å®å¶ CSS</strong>ã<strong>åå®¢ä¾§è¾¹æ å¬å</strong>ã<strong>é¡µè HTML ä»£ç </strong>ã<strong>èªå®ä¹ JS èæ¬</strong>ç­å¥å£ï¼åè®¸ç¨æ·éè¿ç¼å CSS/JS/HTML çæ®µå®ç°ç®è¤å®å¶ï¼ä½è¿ç§å¼åæ¨¡å¼å­å¨å­å¤§æ ¸å¿çç¹ï¼ä¸¥éå¶çº¦äºå¼åæçåç®è¤è´¨éï¼</p>
<p><strong>ï¼1ï¼å¼åç¯å¢ç®éï¼æ ç°ä»£ååç«¯å·¥ç¨åè½å</strong></p>
<p>åå®¢å­çç®è¤å¼åå®å¨ä¾èµ<strong>æµè§å¨ç«¯</strong>ï¼å¼åèéè¦åå¨åå®¢å­åå°ç¼è¾ä»£ç ï¼ä¿å­åå·æ°é¡µé¢æ¥çææï¼æ²¡æ<strong>ç­æ´æ°ï¼HMRï¼</strong> è½åï¼ä¿®æ¹ä¸è¡æ ·å¼éè¦ç­å¾é¡µé¢éæ°å è½½ï¼æ²¡ææåå·¥å·ï¼æ æ³å¯¹ JS/CSS è¿è¡åç¼©ãæ æãæéå è½½ï¼æ²¡ææ¨¡åç³»ç»ï¼æ æ³ä½¿ç¨ ES6+ç<code>import/export</code>ï¼åªè½éè¿å¨å±åéå®ç°ä»£ç å¤ç¨ï¼ä»£ç åä½ä¸é¾ä»¥ç»´æ¤ã</p>
<p><strong>ï¼2ï¼è°è¯é¾åº¦å¤§ï¼æ å®æ´çè°è¯å·¥å·é¾</strong></p>
<p>åå®¢å­çåçä»£ç è¿è¡å¨å¹³å°çå¨å±ç¯å¢ä¸­ï¼å¼åèåªè½éè¿æµè§å¨çå¼åèå·¥å·è¿è¡ç®åçåç´ æ£æ¥åæ­ç¹è°è¯ï¼æ æ³ä½¿ç¨ ViteãWebpack ç­å·¥å·çè°è¯è½åï¼ä¹æ æ³å¯¹ä»£ç è¿è¡ååæµè¯ãéææµè¯ï¼åæ¶ï¼åå®¢å­çåç HTML æ¨¡æ¿ä¸å¯ä¿®æ¹ï¼å¼åèéè¦å¨å·²æ DOM ç»æä¸è¿è¡æ ·å¼è¦çå JS æä½ï¼DOM ç»æçä¸ç¡®å®æ§è¿ä¸æ­¥å¢å äºè°è¯é¾åº¦ã</p>
<p><strong>ï¼3ï¼ææ¯æ åéï¼æ æ³ä½¿ç¨ç°ä»£ååç«¯æ¡æ¶ä¸å·¥å·</strong></p>
<p>åå®¢å­åçå¼åä»æ¯æåç CSS/JS/HTMLï¼æ æ³ç´æ¥ä½¿ç¨ React/React/Vue ç­ç°ä»£ååç«¯æ¡æ¶ï¼ä¹æ æ³ä½¿ç¨ Tailwind CSSãUnoCSS ç­å®ç¨å CSS æ¡æ¶ï¼å³ä½¿å¼åèéè¿æå¨å¼å¥æ¡æ¶ CDN åå®ç°äºé¨ååè½ï¼ä¹ä¼é¢ä¸´å¨å±åéå²çªãæåä½ç§¯è¿å¤§ãæ§è½ä¸ä½³ç­é®é¢ï¼æ æ³åæ¥ç°ä»£åå·¥å·ççæ­£ä»·å¼ã</p>
<p><strong>ï¼4ï¼ä»£ç å¯ç»´æ¤æ§å·®ï¼æ æ¨¡ååä¸ç±»åå®å¨</strong></p>
<p>ç±äºæ²¡ææ¨¡åç³»ç»åç±»åæ ¡éªï¼åå®¢å­ç®è¤çä»£ç å¾å¾æ¯âé¢æ¡å¼ä»£ç âï¼CSS æ ·å¼ç¸äºè¦çï¼JS å½æ°å¨å±æè½½ï¼HTML çæ®µé¶æ£åå¸ï¼æ²¡æ TypeScript çç±»åæ ¡éªï¼å¼åèå¨ç¼åä»£ç æ¶å®¹æåºç°è¯­æ³éè¯¯ãåéåéè¯¯ç­é®é¢ï¼ä¸éè¯¯åªè½å¨è¿è¡æ¶åç°ï¼å¼åæçæä½ã</p>
<p><strong>ï¼5ï¼å¢éåä½å°é¾ï¼æ æ ååçå¼åæµç¨</strong></p>
<p>åå®¢å­ç®è¤çå¼åä»¥ä¸ªäººä¸ºä¸»ï¼æ²¡ææ ååçé¡¹ç®ç»æãä»£ç è§èãæäº¤è§èï¼ä»£ç ä¿å­å¨åå®¢å­åå°ï¼æ æ³éè¿ Git è¿è¡çæ¬ç®¡çï¼ä¹æ æ³è¿è¡å¢éåä½å¼åï¼åæ¶ï¼æ²¡æ Lint å·¥å·ãPrettier å·¥å·çä»£ç æ ¼å¼åè½åï¼ä¸åå¼åèçä»£ç é£æ ¼å·®å¼å¤§ï¼ä»£ç åå¹¶ä¸ç»´æ¤å°é¾ã</p>
<p><strong>ï¼6ï¼AI é¾ä»¥æ¥å¥ï¼æ æ³äº«å AI å¤§æ¨¡åçå¼åçº¢å©</strong></p>
<p>è¿æ¯æ°æ¶ä»£åå®¢å­ç®è¤å¼åçæ ¸å¿çç¹ä¹ä¸ãAI å¤§æ¨¡åçææå¼åéè¦<strong>æ ååçé¡¹ç®ç»æ</strong>ã<strong>å¯è®¿é®çä»£ç æä»¶</strong>ã<strong>æ¸æ°çææ¯è§è</strong>ï¼èåå®¢å­åçå¼åçä»£ç ä»å­å¨äºåå®¢å­åå°çé¶æ£çæ®µä¸­ï¼AI æ æ³è¯»ååå®¢å­çåç HTML æ¨¡æ¿ãæ æ³çè§£ä»£ç çä¸ä¸æãæ æ³çæç¬¦åè§èçæ¨¡ååä»£ç ï¼æ´æ æ³åä¸å·¥ç¨åçå¼åæµç¨ï¼è®©å¼åèéå¤± AI å¼åççº¢å©ã</p>
<h2 id="3-tonaæ¶æææ¯æ ä¸å·¥ç¨åæµæ°´çº¿">3. Tonaï¼æ¶æãææ¯æ ä¸å·¥ç¨åæµæ°´çº¿</h2>
<h3 id="31-åå®¢å­ç®è¤å¼åçç°ä»£åè§£å³æ¹æ¡">3.1 åå®¢å­ç®è¤å¼åçç°ä»£åè§£å³æ¹æ¡</h3>
<div class="mermaid">flowchart TD
    A[ä¼ ç» CNBlogs å¼å] --&gt; B[æµè§å¨æ£æ¥åç´ ]
    B --&gt; C[æå¨ä¿®æ¹ CSS/JS]
    C --&gt; D[ä¸ä¼ è®¾ç½®çé¢æµè¯]
    D --&gt; E[éå¤è°è¯ï¼æçä½]

    F[Tona å¼å] --&gt; G[pnpm create tona åå§å]
    G --&gt; H[Vite æ¬å°æå¡å¨ + æ¨¡æ¿æ³¨å¥]
    H --&gt; I[ç­æ´æ° + AI çæä»£ç ]
    I --&gt; J[æå»ºæå + é¨ç½²]

    subgraph è§£å³æ¹æ¡
    F --&gt; J
    end

    subgraph çç¹
    A --&gt; E
    end
</div><p>Tona æ ¸å¿å®ä½æ¯åå®¢å­ä¸å±çæ¨¡ååç®è¤å¼åå·¥å·é¾ï¼å¶è®¾è®¡åè¡·å°±æ¯è§£å³ä¸è¿°åå®¢å­åçå¼åçææçç¹ãTona åºäº Monorepo æ¶ææé äºä¸å¥å®æ´çç®è¤å¼åå·¥å·é¾ï¼åå«å¯å¤ç¨çæ ¸å¿åãé¢æå»ºçç®è¤ãå¯æ©å±çæä»¶ç³»ç»ï¼åæ¶æ·±åº¦æ´å Vite çæï¼å®ç°äºåå®¢å­ç®è¤çæ¬å°å¼åãå·¥ç¨åæå»ºãæ ååé¨ç½²ã</p>
<p>Tona çæ ¸å¿è§£å³æ¹æ¡å¯ä»¥æ»ç»ä¸ºä»¥ä¸äºç¹ï¼</p>
<ol>
<li><strong>æ¬å°å¼åç¯å¢æ­å»º</strong>ï¼éè¿<code>tona-vite</code>æä»¶å°åå®¢å­çåç HTML æ¨¡æ¿æ³¨å¥ Vite Dev Server ä¸­ï¼è®©å¼åèå¯ä»¥å¨æ¬å°è±ç¦»åå®¢å­ç¯å¢è¿è¡ç®è¤å¼åï¼äº«å Vite çç­æ´æ°ãè°è¯ãæåç­å·¥ç¨åè½åï¼</li>
<li><strong>ç°ä»£åææ¯æ æ¯æ</strong>ï¼åçæ¯æ TypeScriptãReactãTailwind CSS V4 ç­ç°ä»£ååç«¯ææ¯æ ï¼æä¾äºæ ååçé¡¹ç®ç»æåä»£ç è§èï¼è®©å¼åèå¯ä»¥ä½¿ç¨çæçå·¥å·å¼ååå®¢å­ç®è¤ï¼</li>
<li><strong>æ¨¡ååçæ ¸å¿åä½ç³»</strong>ï¼å°æ ¸å¿è½åæåä¸º<code>tona-core</code>ã<code>tona-hooks</code>ã<code>tona-options</code>ã<code>tona-utils</code>ç­å¤ä¸ªæ ¸å¿åï¼æ¯ä¸ªåè´è´£ç¹å®çåè½ï¼å®ç°äºåè½çè§£è¦ä¸å¤ç¨ï¼åæ¶ä¹ä¸º AI å¼åæä¾äºæ ååç APIï¼</li>
<li><strong>å·¥ç¨åçå¼åæµç¨</strong>ï¼æä¾äºå®æ´çå¼åãæå»ºãæµè¯ãåå¸ï¼éæäº VitestãBiomeãStylelint ç­å·¥å·ï¼å®ç°äºä»£ç ç Lintãæ ¼å¼åãååæµè¯ãéææµè¯ï¼åæ¶æ¯æ Git çæ¬ç®¡çåå¢éåä½å¼åï¼</li>
<li><strong>å¯æ©å±çæä»¶ç³»ç»</strong>ï¼æä¾äº<code>tona-plugins</code>æä»¶ç³»ç»ï¼å¼åèå¯ä»¥éè¿ç¼åæä»¶å®ç° DOM æä½ãåè½å¢å¼ºç­éæ±ï¼åæ¶åç½®äºå¤ä¸ªå®ç¨æä»¶ï¼æ»¡è¶³å¼åèçæ¥å¸¸å¼åéæ±ã</li>
</ol>
<p>ç®åæ¥è¯´ï¼Tona è®©åå®¢å­ç®è¤å¼åä»<strong>âæµè§å¨ç«¯çé¶æ£çæ®µå¼åâ</strong> åçº§ä¸º<strong>âæ¬å°çç°ä»£ååç«¯é¡¹ç®å¼åâ</strong>ï¼è®©å¼åèå¯ä»¥åå¼åæ®éåç«¯é¡¹ç®ä¸æ ·å¼ååå®¢å­ç®è¤ï¼åæ¶ä¸º AI æ¥å¥æ­å»ºäºæ ååçææ¯åºåº§ã</p>
<h3 id="32-monorepo-æ¶æè®¾è®¡">3.2 Monorepo æ¶æè®¾è®¡</h3>
<p>Tona éç¨<strong>åºäº pnpm workspace ç Monorepo æ¶æ</strong>ï¼è¿æ¯ç°ä»£ååç«¯çä¸»æµæ¶æéæ©ï¼å¶ä¼å¿å¨äºå¯ä»¥å°æ ¸å¿è½åæåä¸ºå¤ä¸ªç¬ç«çåï¼å®ç°åè½çè§£è¦ä¸å¤ç¨ï¼åæ¶ä¾¿äºçæ¬ç®¡çåå¢éåä½å¼åã</p>
<p>Tona ç Monorepo ç»æä¸»è¦åä¸º<strong>ä¸å¤§æ ¸å¿ç®å½</strong>ï¼</p>
<p><strong>ï¼1ï¼æ ¹ç®å½ï¼å·¥ç¨åæµæ°´çº¿éç½®</strong></p>
<p>Tona çæ ¹ç®å½åå«äºææå·¥ç¨åéç½®æä»¶ï¼å¦<code>pnpm-workspace.yaml</code>ï¼pnpm å·¥ä½åºéç½®ï¼ã<code>biome.jsonc</code>ï¼ä»£ç  Lint ä¸æ ¼å¼åï¼ã<code>vitest.config.ts</code>ï¼æµè¯éç½®ï¼ã<code>package.json</code>ï¼æ ¹ç®å½èæ¬ä¸ä¾èµï¼ç­ï¼åæ¶æä¾äº<code>scripts/</code>ç®å½ï¼åå«å¼åãæå»ºãåå¸çæ ¸å¿èæ¬ï¼å®ç°äº<strong>ä¸é®å¼åãä¸é®æå»ºãä¸é®åå¸</strong>ã</p>
<p><strong>ï¼2ï¼<code>packages/</code>ï¼æ ¸å¿åä¸å·¥å·é¾ï¼12 ä¸ªåï¼</strong></p>
<p><code>packages/</code>ç®å½æ¯ Tona çæ ¸å¿ï¼åå« 12 ä¸ªç¬ç«çåï¼æ¯ä¸ªåè´è´£ç¹å®çåè½ï¼éç¨<strong>åå±æ¶æ</strong>è®¾è®¡ï¼æå»ºå±ãæ©å±å±ãUI å±ãå·¥å·å±ãåºç¡å±ï¼ï¼åä¹é´éè¿<code>workspace:*</code>åè®®ç¸äºå¼ç¨ï¼å®ç°æ¬å°å¼åæ éåå¸ï¼åæ¶ä¾¿äºçæ¬åæ­¥ã</p>
<p>ææååä½¿ç¨ TypeScript å¼åï¼æä¾å®æ´çç±»åå®ä¹ï¼è¿ä¸ä»ä¿è¯äºç±»åå®å¨ï¼ä¹ä¸º AI å¼åæä¾äºæ¸æ°ç API æç¤ºã</p>
<p><strong>ï¼3ï¼<code>themes/</code>ï¼åç½®ç®è¤å®ç°ï¼3 ä¸ªç®è¤ï¼</strong></p>
<p><code>themes/</code>ç®å½åå« Tona åç½®ç 3 ä¸ªåå®¢å­ç®è¤ç®è¤ï¼åä¸º<strong>ç»ä»¶åæ¨¡å¼</strong>å<strong>æä»¶åæ¨¡å¼</strong>ä¸¤ç§å¼åèå¼ï¼</p>
<ul>
<li><strong>Shadcn ç®è¤</strong>ï¼åºäº React+Tailwind CSS V4 çç»ä»¶åç®è¤ï¼éç¨ Tona çå¨éæ ¸å¿åï¼éåå¼åå¤æãç¾è§ãå¯å®å¶çé«ç«¯ç®è¤ï¼</li>
<li><strong>Geek/Reacg ç®è¤</strong>ï¼åºäºåç DOM+Sass çæä»¶åç®è¤ï¼ä»ä½¿ç¨ Tona çæ ¸å¿åï¼core/options/pluginsï¼ï¼éåå¼åè½»éãé«æçæç®ç®è¤ã</li>
</ul>
<p>è¿ 3 ä¸ªç®è¤ä¸ä»æ¯å¯ç´æ¥ä½¿ç¨çåå®¢å­ç®è¤ï¼æ´æ¯ Tona ç<strong>å®æç¤ºä¾</strong>ï¼AI å¯ä»¥éè¿è¯»åè¿äºç®è¤çä»£ç ï¼å­¦ä¹  Tona çå¼åè§èåæä½³å®è·µã</p>
<p><img src="https://img2024.cnblogs.com/blog/1501373/202602/1501373-20260213101052637-421617829.png" alt="image" width="1511" height="935" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/1501373/202602/1501373-20260213100059752-592802182.png" alt="image" width="1511" height="943" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/1501373/202602/1501373-20260213100904348-378022767.png" alt="image" width="1511" height="939" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/1501373/202602/1501373-20260213101430958-1237882624.png" alt="image" width="1511" height="943" loading="lazy"></p>
<h3 id="34-æ ¸å¿ææ¯æ éå">3.4 æ ¸å¿ææ¯æ éå</h3>
<p>Tona çææ¯æ éåéµå¾ª<strong>è½»éãç°ä»£ãé«æãééåå®¢å­</strong>çååï¼ææææ¯æ åä¸ºå½ååç«¯è¡ä¸çä¸»æµéæ©ï¼åæ¶ååèèäºåå®¢å­çè¿è¡ç¯å¢ã</p>
<p>Tona çæ ¸å¿ææ¯æ å¯åä¸º<strong>æ ¸å¿å¼åå·¥å·</strong>ã<strong>åç«¯æ¡æ¶</strong>ã<strong>æ ·å¼å·¥å·</strong>ã<strong>å·¥ç¨åå·¥å·</strong>åå¤§ç±»ï¼å·ä½éååçæ¬ãç¨éå¦ä¸è¡¨æç¤ºï¼</p>
<table>
<thead>
<tr>
<th>åç±»</th>
<th>ææ¯æ </th>
<th>çæ¬</th>
<th>æ ¸å¿ç¨é</th>
</tr>
</thead>
<tbody>
<tr>
<td>æå»ºå·¥å·</td>
<td>Vite</td>
<td>^7.3.1</td>
<td>å¼åæå¡å¨ãç­æ´æ°ãæåæå»ºãæ æä¼å</td>
</tr>
<tr>
<td>åç®¡çå¨</td>
<td>pnpm</td>
<td>10.28.2</td>
<td>Monorepo å·¥ä½åºç®¡çãä¾èµå®è£ãåä¹é´çå¼ç¨</td>
</tr>
<tr>
<td>å¼åè¯­è¨</td>
<td>TypeScript</td>
<td>^5.9.3</td>
<td>å¨æ¡æ¶ç±»åå®å¨ãä»£ç æç¤ºãè¯­æ³æ ¡éª</td>
</tr>
<tr>
<td>UI æ¡æ¶</td>
<td>Preact</td>
<td>^10.28.2</td>
<td>è½»é React æ¿ä»£æ¹æ¡ï¼ä½ç§¯å°ãæ§è½é«ï¼ééåå®¢å­çå¨å±ç¯å¢</td>
</tr>
<tr>
<td>æ ·å¼æ¡æ¶</td>
<td>Tailwind CSS</td>
<td>^4.1.18</td>
<td>å·¥å·ç±»ä¼åç CSS æ¡æ¶ï¼å¿«éå®ç°æ ·å¼å¼åï¼æ¯æ@apply æä»¤</td>
</tr>
<tr>
<td>åæå»ºå·¥å·</td>
<td>tsdown</td>
<td>latest</td>
<td>TypeScript åç¼è¯ï¼å° TS ä»£ç ç¼è¯ä¸º ES æ¨¡åï¼éé Vite çæ</td>
</tr>
<tr>
<td>æµè¯å·¥å·</td>
<td>Vitest</td>
<td>^4.0.16</td>
<td>ååæµè¯ãéææµè¯ï¼æ¯æå¿«ç§æµè¯ãæ¨¡ææµè¯</td>
</tr>
<tr>
<td>ä»£ç  Lint</td>
<td>Biome</td>
<td>^2.3.11</td>
<td>ä»£ç  Lintãæ ¼å¼åãè¯­æ³æ ¡éªï¼æ¿ä»£ ESLint+Prettierï¼æ§è½æ´é«</td>
</tr>
<tr>
<td>Git Hooks</td>
<td>Lefthook</td>
<td>^2.0.13</td>
<td>æäº¤åä»£ç æ ¡éªãæµè¯ï¼ä¿è¯ä»£ç æäº¤è´¨é</td>
</tr>
<tr>
<td>CSS é¢å¤çå¨</td>
<td>Sass</td>
<td>latest</td>
<td>æä»¶åç®è¤çæ ·å¼å¼åï¼æ¯æåéãæ··åãåµå¥</td>
</tr>
<tr>
<td>å¨ç»åº</td>
<td>motion</td>
<td>^12.25.0</td>
<td>tona-theme-shadcn ç®è¤çå¨ç»ææï¼å®ç°æµççé¡µé¢è¿æ¸¡åäº¤äº</td>
</tr>
<tr>
<td>å¾æ åº</td>
<td>lucide-React</td>
<td>^0.562.0</td>
<td>tona-theme-shadcn ç®è¤çå¾æ ç³»ç»ï¼æä¾ä¸°å¯çç¢éå¾æ </td>
</tr>
<tr>
<td>ç»ä»¶åº</td>
<td>@base-ui-components</td>
<td>1.0.0-beta.4</td>
<td>tona-theme-shadcn ç®è¤çæ å¤´ UI ç»ä»¶ï¼å®ç°å¯å®å¶çåºç¡ç»ä»¶</td>
</tr>
</tbody>
</table>
<p><strong>ææ¯æ éåçæ ¸å¿èé</strong>ï¼</p>
<ol>
<li><strong>Preact</strong>ï¼React çä½ç§¯ä» 3KB å·¦å³ï¼è¿å°äº Reactï¼ä¸ API ä¸ React å®å¨å¼å®¹ï¼ä¸ä¼å¨åå®¢å­çå¨å±ç¯å¢ä¸­é æä½ç§¯è¿å¤§æåéå²çªçé®é¢ï¼</li>
<li><strong>Vite ä½ä¸ºæå»ºå·¥å·</strong>ï¼Vite çç­æ´æ°éåº¦æå¿«ï¼æåæçé«ï¼ä¸åçæ¯æ ES æ¨¡åï¼éå¸¸éååå®¢å­ç®è¤çæ¬å°å¼åï¼</li>
<li><strong>pnpm ä½ä¸ºåç®¡çå¨</strong>ï¼pnpm çåå®è£éåº¦å¿«ãç£çå ç¨ä½ï¼ä¸åçæ¯æ Monorepo æ¶æï¼æ¯ Tona çæä½³éæ©ï¼</li>
<li><strong>Tailwind CSS V4</strong>ï¼Tailwind CSS V4 ç¸æ¯æ§çæ¬æ§è½æ´é«ãåè½æ´å¨ï¼æ¯æ@apply æä»¤çé«çº§ç¨æ³ï¼éå¸¸éååå®¢å­ç®è¤çæ ·å¼å¼åï¼</li>
<li><strong>Biome æ¿ä»£ ESLint+Prettier</strong>ï¼Biome æ¯ä¸æ¬¾é«æ§è½çä¸ç«å¼ä»£ç å·¥å·ï¼éæäº Lintãæ ¼å¼åãè¯­æ³æ ¡éªç­åè½ï¼éç½®ç®åï¼æ§è½è¿é«äº ESLint+Prettierï¼éå Monorepo æ¶æçå·¥ç¨åç®¡çã</li>
</ol>
<h3 id="35-å¼åä¸æå»ºæµæ°´çº¿">3.5 å¼åä¸æå»ºæµæ°´çº¿</h3>
<p>Tona æä¾äº<strong>æ ååçå¼åä¸æå»ºæµæ°´çº¿</strong>ï¼æææä½é½éè¿æ ¹ç®å½ç<code>package.json</code>èæ¬å®ç°ï¼å¼åèæ éå³å¿åºå±çå®ç°ç»èï¼åªéæ§è¡ç®åçå½ä»¤å³å¯å®æå¼åãæå»ºãæµè¯ãåå¸ç­æä½ãåæ¶ï¼è¿ä¸æµæ°´çº¿ä¹ä¸º AI å¼åæä¾äºæ ååçæä½å¥å£ââAI å¯ä»¥éè¿æ§è¡è¿äºèæ¬ï¼åä¸å¨æµç¨çå¼åã</p>
<p>Tona çå¼åä¸æå»ºæµæ°´çº¿å¯éè¿ä»¥ä¸ Mermaid å¾ç´è§å±ç¤ºï¼</p>
<div class="mermaid">graph LR
    A[å¼åé¶æ®µ] --&gt; A1[pnpm devï¼å¯å¨å¼åæå¡å¨]
    A1 --&gt; A2[scripts/dev-theme.tsï¼ç®è¤å¼åèæ¬]
    A2 --&gt; A3[Vite Dev Server+HMRï¼ç­æ´æ°å¼å]
    B[æµè¯é¶æ®µ] --&gt; B1[pnpm testï¼æ§è¡åå/éææµè¯ï¼Vitestï¼]
    B1 --&gt; B2[pnpm typecheckï¼TypeScript ç±»åæ ¡éª]
    B2 --&gt; B3[pnpm lintï¼ä»£ç  Lint ä¸æ ¼å¼åï¼Biomeï¼]
    C[æå»ºé¶æ®µ] --&gt; C1[pnpm buildï¼æå»ºç®è¤ï¼Viteï¼]
    C1 --&gt; C2[pnpm build:pkgï¼å¹¶è¡æå»ºæææ ¸å¿å]
    C2 --&gt; C3[Vite Build+æ æï¼ç®è¤æåä¼å]
    C2 --&gt; C4[tsdownï¼TS åç¼è¯ä¸º ES æ¨¡å]
    C3 --&gt; C5[themes/*/dist/ï¼ç®è¤æå»ºäº§ç©]
    C4 --&gt; C6[packages/*/dist/ï¼åæå»ºäº§ç©]
    D[åå¸é¶æ®µ] --&gt; D1[pnpm releaseï¼çæ¬åå¸]
    D1 --&gt; D2[bumppï¼çæ¬å·èªå¢]
    D2 --&gt; D3[scripts/update-versions.mjsï¼åæ­¥ææåçæ¬]
    D3 --&gt; D4[åå¸å° npm/ç§æä»åº]
</div><p><strong>ï¼1ï¼æ ¸å¿èæ¬è¯´æ</strong></p>
<p>Tona çæ ¹ç®å½<code>package.json</code>æä¾äº 7 ä¸ªæ ¸å¿èæ¬ï¼è¦çäºå¼åãæµè¯ãæå»ºãåå¸çå¨æµç¨ï¼å·ä½å¦ä¸è¡¨æç¤ºï¼</p>
<table>
<thead>
<tr>
<th>èæ¬å</th>
<th>å·ä½å½ä»¤</th>
<th>æ ¸å¿ç¨é</th>
</tr>
</thead>
<tbody>
<tr>
<td>dev</td>
<td>node scripts/dev-theme.ts</td>
<td>å¯å¨ Vite å¼åæå¡å¨ï¼æ³¨å¥åå®¢å­æ¨¡æ¿ï¼å®ç°ç­æ´æ°å¼å</td>
</tr>
<tr>
<td>build</td>
<td>node scripts/build-theme.ts</td>
<td>æå»ºææç®è¤ï¼éè¿ Vite è¿è¡æåãåç¼©ãæ æä¼åï¼çæå¯é¨ç½²çæå»ºäº§ç©</td>
</tr>
<tr>
<td>build:pkg</td>
<td>pnpm -r --filter=./packages/** --parallel run build</td>
<td>å¹¶è¡æå»º<code>packages/</code>ç®å½ä¸çæææ ¸å¿åï¼æé«æå»ºæç</td>
</tr>
<tr>
<td>typecheck</td>
<td>tsc --noEmit</td>
<td>å¯¹ææ TypeScript ä»£ç è¿è¡ç±»åæ ¡éªï¼ä¿è¯ç±»åå®å¨</td>
</tr>
<tr>
<td>test</td>
<td>vitest test</td>
<td>æ§è¡ Vitest çååæµè¯åéææµè¯ï¼ä¿è¯ä»£ç è´¨é</td>
</tr>
<tr>
<td>lint</td>
<td>pnpm exec biome check --write</td>
<td>å¯¹ææä»£ç è¿è¡ Lint åæ ¼å¼åï¼èªå¨ä¿®å¤ä»£ç é£æ ¼é®é¢</td>
</tr>
<tr>
<td>release</td>
<td>bumpp ... -x "zx scripts/update-versions.mjs"</td>
<td>çæ¬å·èªå¢ï¼åæ­¥æææ ¸å¿ååç®è¤ççæ¬ï¼å®ç°ä¸é®åå¸</td>
</tr>
</tbody>
</table>
<p><strong>ï¼2ï¼æµæ°´çº¿çæ ¸å¿ç¹ç¹</strong></p>
<ol>
<li><strong>ä¸é®åæä½</strong>ï¼æææµç¨é½éè¿ç®åç<code>pnpm &lt;script&gt;</code>å½ä»¤å®ç°ï¼å¼åèæ éå³å¿åºå±ç»èï¼</li>
<li><strong>å¹¶è¡æå»º</strong>ï¼<code>build:pkg</code>èæ¬éè¿<code>pnpm -r --parallel</code>å®ç°æææ ¸å¿åçå¹¶è¡æå»ºï¼å¤§å¹æé«æå»ºæçï¼</li>
<li><strong>èªå¨åæ ¡éª</strong>ï¼<code>lint</code>ã<code>typecheck</code>ã<code>test</code>èæ¬å®ç°äºä»£ç çèªå¨åæ ¡éªï¼ä¿è¯ä»£ç è´¨éï¼</li>
<li><strong>çæ¬åæ­¥</strong>ï¼<code>release</code>èæ¬éè¿<code>bumpp</code>åèªå®ä¹èæ¬å®ç°äºææååç®è¤ççæ¬åæ­¥ï¼é¿åçæ¬ä¸ä¸è´çé®é¢ï¼</li>
<li><strong>äº§ç©æ åå</strong>ï¼æå»ºåçäº§ç©å­æ¾å¨<code>themes/*/dist/</code>å<code>packages/*/dist/</code>ç®å½ä¸­ï¼ç»ææ ååï¼ä¾¿äºé¨ç½²åä½¿ç¨ã</li>
</ol>
<h2 id="4-tona-æ ¸å¿åè§£æä»è®¾è®¡å°å®ç°">4. Tona æ ¸å¿åè§£æï¼ä»è®¾è®¡å°å®ç°</h2>
<p>Tona çæ ¸å¿è½åä½ç°å¨<code>packages/</code>ç®å½ç 12 ä¸ªæ ¸å¿åä¸­ï¼è¿äºåéç¨<strong>åå±æ¶æ</strong>è®¾è®¡ï¼ç¸äºè§£è¦åç¸äºåä½ï¼ææäº Tona çå®æ´è½åä½ç³»ãæ¬èå°éç¹è§£æ Tona ä¸­ææ ¸å¿çå ä¸ªåï¼åæ¬å¶è®¾è®¡æè·¯ãå³é®å®ç°ãç¤ºä¾ä»£ç ã</p>
<h3 id="41-tona-viteæ¬å°å¼åçæ ¸å¿å¼æè®©-ai-è¯»æåå®¢å­æ¨¡æ¿">4.1 tona-viteï¼æ¬å°å¼åçæ ¸å¿å¼æï¼è®© AI è¯»æåå®¢å­æ¨¡æ¿</h3>
<p><code>tona-vite</code>æ¯ Tona ç<strong>æ ¸å¿å¼æ</strong>ï¼ä¹æ¯ AI æ¥å¥åå®¢å­ç®è¤å¼åç<strong>å³é®å</strong>ãå¶æ ¸å¿åè½æ¯<strong>å°åå®¢å­çåç HTML æ¨¡æ¿æ³¨å¥ Vite Dev Server ä¸­</strong>ï¼è®©å¼åèå¯ä»¥å¨æ¬å°è±ç¦»åå®¢å­ç¯å¢è¿è¡ç®è¤å¼åï¼è®© AI å¯ä»¥ç´æ¥è¯»åè¿äºæ¨¡æ¿ï¼çè§£åå®¢å­ç DOM ç»æã</p>
<p><strong>ï¼1ï¼tona-vite çå·¥ä½åç</strong></p>
<p><code>tona-vite</code>ä½ä¸ºä¸æ¬¾ Vite æä»¶ï¼å¶å·¥ä½åçä¸»è¦åä¸º<strong>æ¨¡æ¿æ³¨å¥</strong>ã<strong>Dev Server å¯å¨</strong>ã<strong>ç­æ´æ°æ¯æ</strong>ä¸ä¸ªæ­¥éª¤ï¼å¯éè¿ä»¥ä¸ Mermaid å¾å±ç¤ºï¼</p>
<div class="mermaid">graph TD
    A[tona-vite æä»¶åå§å] --&gt; A1[è¯»åæ¬å°æ¨¡æ¿ï¼packages/tona-vite/public/templates/]
    A1 --&gt; A2[æ¨¡æ¿é¢å¤çï¼è§£æ DOM ç»æãæ³¨å¥å¨å±åé]
    B[Vite Dev Server å¯å¨] --&gt; B1[æä»¶æ³¨åï¼å°æ¨¡æ¿æ³¨å¥ Vite ç Dev Server]
    B1 --&gt; B2[è·¯ç±æ å°ï¼å°æ¨¡æ¿æ å°å° Vite çè·¯ç±ï¼/templates/*ï¼]
    C[æ¬å°å¼åé¶æ®µ] --&gt; C1[ç®è¤ä»£ç å¼åï¼React/CSS/JS]
    C1 --&gt; C2[ç­æ´æ°ï¼Vite HMR è§¦åç®è¤ä»£ç éæ°æ¸²æ]
    C2 --&gt; C3[æ¨¡æ¿æ¸²æï¼Vite Dev Server æ¸²ææ³¨å¥çåå®¢å­æ¨¡æ¿+ç®è¤ä»£ç ]
    C3 --&gt; C4[æµè§å¨è®¿é®ï¼æ¬å°æ¥çåå®¢å­ç®è¤ææ]
</div><p><strong>æ ¸å¿å³é®ç¹</strong>ï¼</p>
<ol>
<li><strong>æ¨¡æ¿æ¬å°å</strong>ï¼<code>tona-vite</code>å°åå®¢å­çææåç HTML æ¨¡æ¿ï¼é¦é¡µãæç« é¡µãç¸åé¡µãåç±»é¡µç­ï¼ä¸è½½å¹¶ä¿å­å°æ¬å°<code>packages/tona-vite/public/templates/</code>ç®å½ä¸­ï¼å°½å¯è½ä¿è¯äºä¸åå®¢å­çº¿ä¸ç¯å¢çä¸è´æ§ï¼</li>
<li><strong>è·¯ç±æ å°</strong>ï¼<code>tona-vite</code>å°æ¬å°æ¨¡æ¿æ å°å° Vite Dev Server ç<code>/templates/*</code>è·¯ç±ä¸­ï¼å¼åèå¯ä»¥éè¿<code>http://localhost:5173/templates/home.html</code>è®¿é®åå®¢å­é¦é¡µæ¨¡æ¿ï¼éè¿<code>http://localhost:5173/templates/post-markdown.html</code>è®¿é®æç« é¡µæ¨¡æ¿ï¼</li>
<li><strong>ä»£ç æ³¨å¥</strong>ï¼å¼åèç¼åçç®è¤ä»£ç ï¼React ç»ä»¶ãCSS æ ·å¼ãJS èæ¬ï¼ä¼è¢« Vite Dev Server æ³¨å¥å°æ¨¡æ¿ä¸­ï¼å®ç°ç®è¤ææçå®æ¶æ¸²æï¼</li>
<li><strong>ç­æ´æ°æ¯æ</strong>ï¼åºäº Vite ç HMR è½åï¼å¼åèä¿®æ¹ç®è¤ä»£ç åï¼é¡µé¢ä¼å®æ¶æ´æ°ï¼æ éå·æ°ï¼å¤§å¹æé«å¼åæçã</li>
</ol>
<p><strong>ï¼2ï¼tona-vite çå³é®å®ç°</strong></p>
<p>æä»¶ä½¿ç¨ Vite ç configResolved å configureServer é©å­ï¼æ³¨å¥åå®¢å­æ¨¡æ¿å° public ç®å½ã</p>
<pre><code class="language-typescript">// packages/tona-vite/index.ts ï¼ç®åçï¼
import { Plugin } from 'vite'
import fs from 'fs-extra'
import path from 'path'

export function tonaVite(): Plugin {
  return {
    name: 'tona-vite',
    configResolved(config) {
      // æ³¨å¥æ¨¡æ¿
      const templatesDir = path.resolve(__dirname, 'public/templates')
      fs.copySync(templatesDir, config.root + '/public/templates')
    },
    configureServer(server) {
      server.middlewares.use((req, res, next) =&gt; {
        if (req.url.startsWith('/templates/')) {
          // æ¨¡æ CNBlogs æ¨¡æ¿ååº
          res.end(fs.readFileSync(path.resolve(config.root, req.url)))
        } else {
          next()
        }
      })
    },
  }
}
</code></pre>
<p><strong>ï¼3ï¼AI æ¥å¥çæ ¸å¿ä¼å¿</strong></p>
<p><code>tona-vite</code>ä¸º AI å¼åæä¾äºä¸¤ä¸ªæ ¸å¿ä¼å¿ï¼</p>
<ol>
<li><strong>æ¨¡æ¿å¯è®¿é®æ§</strong>ï¼åå®¢å­çåç HTML æ¨¡æ¿è¢«ä¿å­å°æ¬å°ï¼AI å¯ä»¥ç´æ¥è¯»åè¿äºæ¨¡æ¿æä»¶ï¼çè§£åå®¢å­ç DOM ç»æãHTML å¸å±ï¼ä»èçæç¬¦åæ¨¡æ¿ç»æçç®è¤ä»£ç ï¼</li>
<li><strong>å¼åç¯å¢æ åå</strong>ï¼AI å¯ä»¥éè¿æ§è¡<code>pnpm dev</code>å½ä»¤å¯å¨ Vite Dev Serverï¼åä¸æ¬å°å¼åï¼åæ¶å¯ä»¥éè¿ Vite ç API è·åç®è¤ä»£ç çå®æ¶ç¶æï¼å®ç° AI ä¸äººç±»å¼åèçååå¼åã</li>
</ol>
<div class="mermaid">sequenceDiagram
    participant User/AI
    participant ViteServer
    participant TonaVitePlugin
    participant CNBlogsTemplate

    User/AI-&gt;&gt;ViteServer: pnpm dev
    ViteServer-&gt;&gt;TonaVitePlugin: configResolved
    TonaVitePlugin-&gt;&gt;CNBlogsTemplate: å¤å¶æ¨¡æ¿å° public/
    User/AI-&gt;&gt;ViteServer: ä¿®æ¹ä»£ç 
    ViteServer-&gt;&gt;TonaVitePlugin: HMR æ´æ°
    TonaVitePlugin-&gt;&gt;User/AI: å·æ°é¡µé¢
</div><h3 id="42-tona-coreæ ¸å¿-api">4.2 tona-coreï¼æ ¸å¿ API</h3>
<p><code>tona-core</code>æ¯ Tona ç<strong>åºç¡å</strong>ï¼æä¾<code>createTheme</code>å<code>defineOptions</code>ä¸¤ä¸ªæ ¸å¿ APIï¼è´è´£<strong>ç®è¤å®ä¾çåå»ºãæä»¶çæ³¨åä¸æ§è¡ãéç½®çåå¹¶ä¸è¯»å</strong>ãææç®è¤é½éè¿<code>createTheme().use(plugin)</code>ä¸²èæä»¶ï¼æææä»¶éè¿<code>defineOptions</code>å£°æå¯éç½®é¡¹ï¼å®ç°ç»ä¸çæ¨¡åä¸çå½å¨æç®¡çã</p>
<p><strong>ï¼1ï¼createThemeï¼ç®è¤å®ä¾ä¸æä»¶ç³»ç»</strong></p>
<p><code>createTheme()</code>è¿åä¸ä¸ªç®è¤å®ä¾ï¼å®ä¾æä¾<code>use(plugin, ...options)</code>æ¹æ³ç¨äºæ³¨åæä»¶ï¼</p>
<pre><code class="language-typescript">// packages/core/src/createThemeApi.ts ï¼ç®åçï¼
export function createTheme() {
  const context = { theme: null, config: { globalProperties: {} } }
  const installedPlugins = new Set()

  const theme = {
    version: '3.0',
    _context: context,
    get config() {
      return context.config
    },

    use(plugin, ...options) {
      if (installedPlugins.has(plugin)) return theme
      if (typeof plugin?.install === 'function') {
        installedPlugins.add(plugin)
        plugin.install(theme, ...options)
      } else if (typeof plugin === 'function') {
        installedPlugins.add(plugin)
        plugin(theme, ...options)
      }
      return theme
    },
  }

  context.theme = theme
  init()
  return theme
}
</code></pre>
<p>æä»¶å¯ä»¥æ¯<strong>å½æ°</strong>æ<strong>å¸¦<code>install</code>æ¹æ³çå¯¹è±¡</strong>ï¼è°ç¨æ¶ä¼ å¥ç®è¤å®ä¾åå¯éåæ°ï¼<code>use</code>æ¯æé¾å¼è°ç¨ï¼è¿åç®è¤å®ä¾æ¬èº«ã<code>init()</code>å¨åå»ºæ¶æ§è¡ï¼è´è´£éèåå®¢å­å è½½å¨ç»ãå¼åæ¨¡å¼ä¸åå§å<code>window.opts</code>ç­ã</p>
<p><strong>ï¼2ï¼defineOptionsï¼éç½®åå¹¶ä¸ç¨æ·è¦ç</strong></p>
<p><code>defineOptions</code>ç¨äºå£°æ<strong>æä»¶çéç½®é¡¹</strong>ï¼å°é»è®¤å¼ãç¨æ·éç½®ï¼<code>window.opts</code>ï¼ãå¼åæ¶è¦çä¸èåå¹¶ï¼ä¾æä»¶åé¨ä½¿ç¨ï¼</p>
<pre><code class="language-typescript">// packages/core/src/defineOptionsApi.ts ï¼ç®åçï¼
export function defineOptions(userOptionName, defaultOptions) {
  return (devOptions) =&gt; {
    const userConfig = window.opts || {}
    const user =
      typeof userOptionName === 'string'
        ? userConfig[userOptionName]
        : getValue(userOptionName, userConfig) // æ°ç»æ¶æé¡ºåºå¹éç¬¬ä¸ä¸ªå­å¨çé®
    return Object.assign({}, defaultOptions, user, devOptions)
  }
}

// ä½¿ç¨ç¤ºä¾
const getBackgroundOptions = defineOptions('bodyBackground', {
  enable: false,
  value: '',
  opacity: 0.85,
  repeat: false,
})

const opts = getBackgroundOptions({ enable: true }) // å¼åæ¶è¦ç
// çº¿ä¸ï¼ä» window.opts.bodyBackground è¯»åç¨æ·éç½®ï¼ä¸é»è®¤å¼åå¹¶
</code></pre>
<p><code>userOptionName</code>æ¯æå­ç¬¦ä¸²ææ°ç»ï¼å¤å«åï¼ï¼æ°ç»æ¶æé¡ºåºæ¥æ¾ç¬¬ä¸ä¸ªå­å¨äºç¨æ·éç½®ä¸­çé®ãåå®¢å­ç¨æ·éè¿ãé¡µè HTML ä»£ç ãæ³¨å¥<code>window.opts = { bodyBackground: { enable: true, ... } }</code>ï¼ç®è¤å³å¯è¯»åå°åå¹¶åçéç½®ã</p>
<h3 id="43-tona-hooks-å¸¸ç¨-hooks">4.3 tona-hooks: å¸¸ç¨ Hooks</h3>
<p><code>tona-hooks</code>æ¯ Tona ä¸º <strong>React çæ</strong>æé çèªå®ä¹ Hook åï¼å¶æ ¸å¿åè½æ¯<strong>å°è£åå®¢å­ç®è¤å¼åä¸­å¸¸ç¨ç DOM æä½ãç¶æç®¡çãä¸å¡é»è¾</strong>ï¼è®©å¼åèå¯ä»¥åä½¿ç¨ React Hook ä¸æ ·ï¼å¿«éå®ç°åå®¢å­ç®è¤çå¼åï¼åæ¶å¤§å¹åå°éå¤ä»£ç ãå¶è®¾è®¡éµå¾ª <strong>âé¢ååå®¢å­ä¸å¡åºæ¯â</strong> çååï¼ææ Hook é½éå¯¹åå®¢å­ç®è¤å¼åçå®ééæ±è¿è¡å°è£ã</p>
<p>å¶ä¸­ï¼<code>useQueryDOM</code>æ¯<code>tona-hooks</code>ä¸­çæ ¸å¿ Hookã<code>useQueryDOM</code>çæ ¸å¿åè½æ¯<strong>å°è£åå®¢å­ç DOM æ¥è¯¢æä½ï¼æ¯æ DOM èç¹çèªå¨æ´æ°åéæ¸²æ</strong>ï¼è§£å³äºåå®¢å­ DOM ç»æå¨æååå¯¼è´çæ¥è¯¢å¤±è´¥é®é¢ã</p>
<p><strong>useQueryDOM Hook çå®ç°</strong></p>
<pre><code class="language-typescript">// packages/tona-hooks/src/useQueryDOM.ts
import { useState, useEffect, useCallback } from 'React/hooks'

/**
 * åå®¢å­ DOM æ¥è¯¢ Hook
 * @param selector DOM éæ©å¨
 * @param options éç½®é¡¹ï¼æ¯å¦çå¬ DOM ååãæ¯å¦ç«å³æ¥è¯¢
 * @returns DOM èç¹ãéæ°æ¥è¯¢æ¹æ³
 */
export function useQueryDOM&lt;T extends HTMLElement&gt;(
  selector: string,
  options: { observe: boolean; immediate: boolean } = {
    observe: true,
    immediate: true,
  },
) {
  const [node, setNode] = useState&lt;T | null&gt;(null)

  // DOM æ¥è¯¢æ¹æ³
  const queryNode = useCallback(() =&gt; {
    const el = document.querySelector&lt;T&gt;(selector)
    setNode(el)
    return el
  }, [selector])

  // åå§åæ¥è¯¢
  useEffect(() =&gt; {
    if (options.immediate) {
      queryNode()
    }
  }, [options.immediate, queryNode])

  // çå¬ DOM åå
  useEffect(() =&gt; {
    if (!options.observe) return

    // åå»º MutationObserverï¼çå¬ DOM æ åå
    const observer = new MutationObserver((mutations) =&gt; {
      // å½ DOM æ åçååæ¶ï¼éæ°æ¥è¯¢
      queryNode()
    })

    // çå¬æ´ä¸ªææ¡£ç DOM åå
    observer.observe(document.documentElement, {
      childList: true,
      subtree: true,
      attributes: false,
      characterData: false,
    })

    // éæ¯æ¶åæ¶çå¬
    return () =&gt; {
      observer.disconnect()
    }
  }, [options.observe, queryNode])

  return [node, queryNode] as const
}
</code></pre>
<p><strong>useQueryDOM Hook çä½¿ç¨</strong></p>
<pre><code class="language-typescript">import { useQueryDOM } from 'tona-hooks';

export function PostTitle() {
  // æ¥è¯¢åå®¢å­æç« æ é¢èç¹
  const { data, isPending } = useQueryDOM({
    selector: '#cb_post_title_url',
    observe: true,
    queryFn: (el) =&gt; {
      return el?.querySelector('[role="heading"]')?.innerHTML ?? ''
    },
  });

  if (isPending) {
    return &lt;h1 className="text-2xl font-bold"&gt;å è½½ä¸­...&lt;/h1&gt;;
  }

  return (
    &lt;h1 className="text-3xl font-bold text-blue-600 hover:text-blue-800 transition-colors"&gt;
      {titleNode.innerText}
    &lt;/h1&gt;
  );
}
</code></pre>
<blockquote>
<p>ä½ å¯ä»¥è¯è¯éè¿æ­¤ Hook å®ç°çæç« åºé¨æ¨èæé®ãè¯è®ºåè¡¨ä»¥åä¸ªäººä¸»é¡µçå³æ³¨æé®åè½ã</p>
</blockquote>
<h3 id="44-tona-tailwind-stylelint-æä»¶">4.4 tona tailwind stylelint æä»¶</h3>
<p>å¦æå¨åå®¢å­ç®è¤å¼åä¸­ä½¿ç¨ tailwindï¼éè¦èèçé®é¢æ¯ class name è¢«æåè³ js æä»¶ä¸­ï¼js æä»¶ä½æ£å¿«éå¢é¿çé®é¢ãæä»¬å¯ä»¥å¨ CSS æä»¶åä½¿ç¨ tailwindã</p>
<p>stylelint-one-utility-class-per-line æä»¶å¼ºå¶ @apply æä»¤ä¸è¡ä¸ä¸ªç±»åï¼æ¯æèªå¨ä¿®å¤ãè§£å³å¤ç±»åä¸è¡å¯¼è´çå¯è¯»æ§å·®é®é¢ã</p>
<pre><code class="language-css">.card {
  @apply flex flex-col items-center justify-center p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300;
}
</code></pre>
<p>lint å</p>
<pre><code class="language-css">.card {
  @apply flex 
    flex-col 
    items-center 
    justify-center 
    p-6 
    bg-white 
    dark:bg-gray-800 
    rounded-lg 
    shadow-md 
    hover:shadow-lg 
    transition-shadow 
    duration-300;
}
</code></pre>
<h3 id="45-create-tonacli-å¿«éåå§åä¸é®æ­å»ºç®è¤å¼åèææ¶">4.5 create-tonaï¼CLI å¿«éåå§åï¼ä¸é®æ­å»ºç®è¤å¼åèææ¶</h3>
<p><img src="https://img2024.cnblogs.com/blog/1501373/202602/1501373-20260213102615101-1943776826.png" alt="image" width="1268" height="804" loading="lazy"></p>
<p><code>create-tona</code>æ¯ Tona ç <strong>CLI å¿«éåå§åå·¥å·</strong>ï¼å¶æ ¸å¿åè½æ¯<strong>éè¿ä¸è¡å½ä»¤åå»º Tona ç®è¤é¡¹ç®èææ¶</strong>ï¼è®©å¼åèæ éæå¨éç½® Viteãtona-vite æä»¶ãä¾èµå®è£ç­ï¼å³å¯å¨æ°ç§åè·å¾ä¸ä¸ªå¯è¿è¡çåå®¢å­ç®è¤å¼åç¯å¢ãå¶è®¾è®¡éµå¾ª<strong>âå¼ç®±å³ç¨ãæ¨¡æ¿å¯éãæµç¨æ ååâ</strong>çååï¼æ¯ Tona å¼åæµç¨ç**å¥å£åã</p>
<p><strong>ï¼1ï¼create-tona çå·¥ä½åç</strong></p>
<p><code>create-tona</code>ä½ä¸ºä¸æ¬¾ Node.js CLI å·¥å·ï¼å¶å·¥ä½åçä¸»è¦åä¸º<strong>äº¤äºå¼å¼å¯¼</strong>ã<strong>æ¨¡æ¿éæ©ä¸å¤å¶</strong>ã<strong>ä¾èµå®è£ä¸å¯å¨</strong>ä¸ä¸ªæ­¥éª¤ï¼å¯éè¿ä»¥ä¸ Mermaid å¾å±ç¤ºï¼</p>
<div class="mermaid">graph TD
    A[æ§è¡ pnpm create tona] --&gt; A1[è§£æå½ä»¤è¡åæ°ï¼-t --template, -i --immediate]
    A1 --&gt; A2[æ£æµè¿è¡ç¯å¢ï¼TTY äº¤äºæ¨¡å¼ / é TTY éé»æ¨¡å¼]
    B[äº¤äºå¼å¼å¯¼] --&gt; B1[é¡¹ç®åç§° &amp; ç®æ ç®å½]
    B1 --&gt; B2[ç®å½å²çªå¤çï¼è¦ç / å¿½ç¥ / åæ¶]
    B2 --&gt; B3[ååæ ¡éªï¼npm è§è]
    B3 --&gt; B4[æ¨¡æ¿éæ©ï¼TypeScript / JavaScript]
    B4 --&gt; B5[æ¯å¦ç«å³å®è£ä¾èµå¹¶å¯å¨ dev]
    C[é¡¹ç®æ­å»º] --&gt; C1[å¤å¶ template-ts æ template-js å°ç®æ ç®å½]
    C1 --&gt; C2[æ´æ° package.json ç name å­æ®µ]
    C2 --&gt; C3[å¯éï¼pnpm install + pnpm dev]
    C3 --&gt; C4[å®æï¼è¾åºåç»­å½ä»¤æç¤º]
</div><p><strong>æ ¸å¿å³é®ç¹</strong>ï¼</p>
<ol>
<li><strong>åæ¨¡æ¿æ¯æ</strong>ï¼<code>create-tona</code>æä¾<code>template-ts</code>ï¼TypeScriptï¼å<code>template-js</code>ï¼JavaScriptï¼ä¸¤ç§æ¨¡æ¿ï¼æ¨¡æ¿å·²é¢éç½®<code>tona-vite</code>æä»¶ã<code>tona</code>ä¾èµãVite æå»ºèæ¬ï¼å¼åèå¯æ ¹æ®ææ¯æ åå¥½éæ©ï¼</li>
<li><strong>åç®¡çå¨èªå¨è¯å«</strong>ï¼éè¿<code>npm_config_user_agent</code>ç¯å¢åéè¯å«è°ç¨æ¹ï¼pnpmãnpmãyarnãbunãdenoï¼ï¼èªå¨éç¨å¯¹åºå½ä»¤è¿è¡ä¾èµå®è£åèæ¬æ§è¡ï¼</li>
<li><strong>ç®å½å²çªå¤ç</strong>ï¼å½ç®æ ç®å½éç©ºæ¶ï¼æä¾âåæ¶ / æ¸ç©ºåç»§ç»­ / å¿½ç¥å¹¶ç»§ç»­âä¸ç§éé¡¹ï¼é¿åæå¤è¦çï¼</li>
<li><strong>å³æ¶å¯å¨</strong>ï¼æ¯æ<code>-i</code>æ<code>--immediate</code>åæ°ï¼å¨é¡¹ç®åå»ºå®æåèªå¨æ§è¡<code>pnpm install</code>å<code>pnpm dev</code>ï¼å®ç°âåå»ºå³å¼åâã</li>
</ol>
<p><strong>ï¼2ï¼create-tona çå³é®å®ç°</strong></p>
<p>CLI ä½¿ç¨<code>@clack/prompts</code>å®ç°äº¤äºå¼æé®ï¼ä½¿ç¨<code>mri</code>è§£æå½ä»¤è¡åæ°ï¼éè¿ Node.js ç<code>fs</code>æ¨¡åå¤å¶æ¨¡æ¿æä»¶ã</p>
<pre><code class="language-typescript">// packages/create-tona/src/index.ts ï¼ç®åçï¼
import fs from 'node:fs'
import path from 'node:path'
import { fileURLToPath } from 'node:url'
import * as prompts from '@clack/prompts'
import spawn from 'cross-spawn'
import mri from 'mri'

const argv = mri(process.argv.slice(2), {
  boolean: ['help', 'overwrite', 'immediate', 'interactive'],
  alias: { h: 'help', t: 'template', i: 'immediate' },
  string: ['template'],
})

async function init() {
  // 1. è·åç®æ ç®å½ï¼äº¤äºæåæ°ï¼
  const targetDir = argv._[0]
    ? formatTargetDir(String(argv._[0]))
    : await prompts.text({
        message: 'Project name:',
        defaultValue: 'tona-theme',
      })

  // 2. ç®å½å²çªå¤ç
  if (fs.existsSync(targetDir) &amp;&amp; !isEmpty(targetDir)) {
    const overwrite = await prompts.select({
      message: '...',
      options: ['no', 'yes', 'ignore'],
    })
    if (overwrite === 'yes') emptyDir(targetDir)
  }

  // 3. éæ©æ¨¡æ¿ï¼ts / js
  const template =
    argv.template ??
    (await prompts.select({
      message: 'Select a template:',
      options: [
        { label: 'TypeScript', value: 'ts' },
        { label: 'JavaScript', value: 'js' },
      ],
    }))

  // 4. å¤å¶ template-ts æ template-js å°ç®æ ç®å½
  const __dirname = path.dirname(fileURLToPath(import.meta.url))
  const templateDir = path.resolve(__dirname, '..', `template-${template}`)
  copyDir(templateDir, targetDir)

  // 5. æ´æ° package.json ç name
  const pkg = JSON.parse(
    fs.readFileSync(path.join(targetDir, 'package.json'), 'utf-8'),
  )
  pkg.name = path.basename(path.resolve(targetDir))
  fs.writeFileSync(
    path.join(targetDir, 'package.json'),
    JSON.stringify(pkg, null, 2),
  )

  // 6. å¯éï¼ç«å³å®è£å¹¶å¯å¨
  if (argv.immediate) {
    spawn.sync(pkgManager, ['install'], { cwd: targetDir })
    spawn.sync(pkgManager, ['dev'], { cwd: targetDir })
  }
}
</code></pre>
<p><strong>æ¨¡æ¿ç»æ</strong>ï¼æ¯ä¸ªæ¨¡æ¿åå«<code>package.json</code>ã<code>vite.config.mts</code>ã<code>src/main.ts</code>ã<code>src/style.css</code>ç­ï¼å¶ä¸­<code>vite.config.mts</code>å·²éç½®<code>tona-vite</code>æä»¶å<code>@</code>è·¯å¾å«åï¼<code>main.ts</code>ä¸ºæä»¶å¼å¥å£ç¤ºä¾ï¼<code>createTheme().use(myPlugin)</code>ï¼ã</p>
<h2 id="5-ç¤ºä¾ç®è¤å®ç°æè§£">5. ç¤ºä¾ç®è¤å®ç°æè§£</h2>
<p><code>tona-theme-shadcn</code>æ¯ Tona åç½®ç<strong>ç»ä»¶åæ¨¡å¼</strong>ç¤ºä¾ç®è¤ï¼è¿æå¼åå¹¶åå¸ãéç¨ Preact + Tailwind CSS V4 + shadcn/ui é£æ ¼è®¾è®¡ï¼æ¯ Tona ç®è¤å¼åçå®è·µåèãæ¬èä»é¡¹ç®ç»æãå¥å£ä¸æä»¶é¾ãé¡µé¢è·¯ç±ãæ°æ®è·åãæ ·å¼ä½ç³»ãæå»ºè¾åºå­ä¸ªç»´åº¦æè§£å¶å®ç°ï¼æä»¬ä¸èµ·ççå¦ä½åºäº Tona å¼åé«è´¨éåå®¢å­ç®è¤ã</p>
<h3 id="51-é¡¹ç®ç»æä¸ææ¯æ ">5.1 é¡¹ç®ç»æä¸ææ¯æ </h3>
<p><code>tona-theme-shadcn</code>éç¨<strong>ç»ä»¶å + æä»¶å</strong>çæ··åæ¶æï¼æ ¸å¿ UI ä»¥ Preact ç»ä»¶å®ç°ï¼å¢å¼ºåè½ä»¥æä»¶å½¢å¼æè½½ãç®å½ç»æå¦ä¸ï¼</p>
<pre><code class="language-md">themes/shadcn/
âââ src/
â âââ main.ts # å¥å£ï¼æä»¶é¾æ³¨å
â âââ styles/ # å¨å±æ ·å¼
â â âââ globals.css # Tailwind + shadcn + markdown + theme
â â âââ shadcn/ # shadcn ç®è¤åéãç»ä»¶æ ·å¼
â â âââ markdown.css # æç«  Markdown æ ·å¼
â â âââ theme.css # ç®è¤ç®è¤åé
â âââ lib/utils.ts # cn() å·¥å·å½æ°
â âââ components/ui/ # éç¨ UI ç»ä»¶ï¼ButtonãSeparatorãSonner ç­ï¼
â âââ plugins/
â âââ app/ # ä¸»åºç¨æä»¶ï¼Preact æ¸²ææ´é¡µ
â â âââ app.tsx # App æ ¹ç»ä»¶
â â âââ components/ # é¡µé¢çº§ç»ä»¶
â â â âââ page/ # è·¯ç±åå
â â â âââ home-page/ # é¦é¡µ
â â â âââ post-page/ # æç« é¡µ
â â â âââ top-nav-bar/ # é¡¶é¨å¯¼èª
â â â âââ post-comments/ # è¯è®º
â â â âââ ...
â â âââ hooks/ # ä¸å¡ hooks
â âââ code-copy-button/ # ä»£ç åå¤å¶ï¼åç DOM æä»¶ï¼
â âââ smooth-scroll/ # å¹³æ»æ»å¨ï¼åç DOM æä»¶ï¼
âââ vite.config.mts
âââ package.json
</code></pre>
<p><strong>ææ¯æ </strong>ï¼PreactãTailwind CSS V4ãclass-variance-authorityï¼cvaï¼ãclsx + tailwind-mergeï¼cnï¼ãlucide-preactï¼å¾æ ï¼ãmotionï¼å¨ç»ï¼ãtona-hooksï¼useQueryDOMï¼ãtona-utilsãtona-sonnerï¼Toastï¼ã</p>
<p>éè¿ç®å½ç»æå¯ä»¥çå°ï¼ç± preact å®ç°çé¨åï¼ç®è¤ä¸»ä½ï¼å ä¹æ¯ä¸ä¸ª SPAï¼åªæ¯ Tona çä¸ä¸ªæä»¶ãä½ å¯ä»¥ä½¿ç¨ä»»ä½åç«¯æ¡æ¶å¼ååå®¢å­ç®è¤ï¼ä½éè¦æè¡¡ä½ç§¯ãæ¯å¦ AI åå¥½ãçæç­å ç´ ãæè®¤ä¸º preact æ¯ä¸ä¸ªä¸éçéæ©ï¼æä»¥æéç¨ preact å®ç°äº tona-theme-shadcn ç®è¤ã</p>
<h3 id="52-å¥å£ä¸æä»¶é¾">5.2 å¥å£ä¸æä»¶é¾</h3>
<p>ç®è¤å¥å£éè¿<code>createTheme().use()</code>ä¸²èå¤ä¸ªæä»¶ï¼å®ç°<strong>æ¸è¿å¼å¢å¼º</strong>ï¼</p>
<pre><code class="language-typescript">// themes/shadcn/src/main.ts
import { createTheme } from 'tona'
import './styles/globals.css'
import { app } from './plugins/app'
import { codeCopyButton } from './plugins/code-copy-button'
import { smoothScroll } from './plugins/smooth-scroll'

createTheme().use(app).use(smoothScroll).use(codeCopyButton)
</code></pre>
<ul>
<li><strong>app</strong>ï¼Preact æ¸²ææ ¸å¿ï¼å°æ´é¡µ UI ä»¥<code>document.body.prepend(frag)</code>æ³¨å¥ï¼è¦çåå®¢å­åçå¸å±ï¼</li>
<li><strong>smoothScroll</strong>ï¼è®¾ç½®<code>scrollBehavior</code>ï¼</li>
<li><strong>codeCopyButton</strong>ï¼ä¸ºä»£ç åæ·»å å¤å¶æé®ï¼çº¯ DOM æä½ã</li>
</ul>
<p><code>app</code>æä»¶çå®ç°æ¹å¼ä½ç°äº<strong>ç»ä»¶å</strong>ä¸<strong>æ¨¡æ¿æ³¨å¥</strong>çç»åï¼å° Preact åºç¨æè½½å°<code>DocumentFragment</code>ï¼åæå¥å°<code>body</code>é¡¶é¨ï¼ä»èå¨åå®¢å­æ¨¡æ¿ä¹ä¸å å ç°ä»£å UIã</p>
<h3 id="53-é¡µé¢è·¯ç±ä¸ç»ä»¶å¤ç¨">5.3 é¡µé¢è·¯ç±ä¸ç»ä»¶å¤ç¨</h3>
<p>åå®¢å­ä¸åé¡µé¢ï¼é¦é¡µãæç« é¡µãåç±»é¡µç­ï¼å¯¹åºä¸åç DOM ç»æï¼shadcn éè¿<code>tona-utils</code>ç<code>getCurrentPage()</code>è¯å«å½åé¡µé¢ç±»åï¼åå¨<code>Page</code>ç»ä»¶ä¸­åè·¯ç±ååï¼</p>
<pre><code class="language-typescript">// themes/shadcn/src/plugins/app/components/page/index.tsx
import { getCurrentPage } from 'tona-utils'
import { HomePage } from '../home-page'
import { PostPage } from '../post-page'

export function Page() {
  const currentPage = getCurrentPage()

  if (currentPage === 'home') return &lt;HomePage /&gt;
  if (currentPage === 'post') return &lt;PostPage /&gt;
  return null
}
</code></pre>
<p>å¦æä½ çç®è¤æ¯è¾å¤æï¼çè³å¯ä»¥åä»£ç æåï¼å¨ä¸ååå®¢é¡µé¢æéå è½½èµæºã</p>
<h3 id="54-æ°æ®è·åä¸-dom-ééusequerydom-å®æ">5.4 æ°æ®è·åä¸ DOM ééï¼useQueryDOM å®æ</h3>
<p>åå®¢å­é¡µé¢ DOM ç±æå¡ç«¯æ¸²æï¼ç»æåºå®ä½åå®¹å¨æãshadcn ç®è¤ä½¿ç¨<code>tona-hooks</code>ç<code>useQueryDOM</code>ï¼ä» DOM ä¸­æåæ°æ®å¹¶é©±å¨ Preact ç»ä»¶æ¸²æã</p>
<p><strong>ç¤ºä¾ä¸ï¼æç« åè¡¨</strong>ãé¦é¡µç<code>.forFlow</code>ååå«ææ¥æåç»çæç« åè¡¨ï¼<code>usePostList</code>éè¿<code>queryFn</code>è§£æåºæ¯ç¯æç« çæ é¢ãé¾æ¥ãæ¶é´ãæµè§/è¯è®º/æ¨èæ°ç­ï¼</p>
<pre><code class="language-typescript">// themes/shadcn/src/plugins/app/components/home-page/post-list/hooks.ts
export function usePostList() {
  return useQueryDOM({
    selector: '.forFlow',
    observe: true,
    queryFn: (el) =&gt; {
      const items: PostItem[] = []
      const dayElements = el?.querySelectorAll('.day') ?? []
      dayElements.forEach((dayEl) =&gt; {
        // è§£æ .dayTitleã.postTitleã.postConã.postDesc ç­
        // æå titleãhrefãdateãviewCountãcommentCountãdiggCount...
        items.push({ date, title, href, description, ... })
      })
      return items
    },
  })
}
</code></pre>
<p><strong>ç¤ºä¾äºï¼æç« æ é¢ä¸åä¿¡æ¯</strong>ãæç« é¡µéè¿<code>#cb_post_title_url</code>ã<code>#cnblogs_post_body</code>ç­éæ©å¨è·åæ é¢ HTMLãåå¸æ¥æãéè¯»æ¶é´ç­ï¼</p>
<pre><code class="language-typescript">// themes/shadcn/src/plugins/app/components/post-hero/hooks.ts
export function usePostTitle() {
  return useQueryDOM({
    selector: '#cb_post_title_url',
    queryFn: (el) =&gt; el?.querySelector('[role="heading"]')?.innerHTML ?? '',
  })
}

export function usePostInfo() {
  return useQueryDOM({
    selector: '#cnblogs_post_body',
    observe: true,
    queryFn: (el) =&gt; ({
      publishTime: getCurrentPostDateAdded(),
      readingTime: calculateReadingTime(el?.textContent ?? ''),
      updateTime: null,
    }),
  })
}
</code></pre>
<p><code>observe: true</code>æ¶ï¼<code>useQueryDOM</code>åé¨ä½¿ç¨<code>MutationObserver</code>çå¬ DOM ååï¼å¨åå®¢å­ AJAX æ´æ°åå®¹åèªå¨éæ°æ¥è¯¢ï¼ä¿è¯æ°æ®ä¸è§å¾åæ­¥ã</p>
<p><strong>ç¤ºä¾ä¸ï¼æç« åå®¹âæ¬è¿â</strong>ã<code>PostDetails</code>ç»ä»¶ä¸éæ°æ¸²æåå®¢å­æç«  bodyï¼èæ¯éè¿<code>appendChild</code>å°<code>#cnblogs_post_body</code>è¿ç§»å° Preact æ¸²æçå®¹å¨åï¼å¨ä¿çåå®¢å­åç Markdown æ¸²æææçåæ¶ï¼å®ç°ä¸ç®è¤å¸å±çæ ç¼èåã</p>
<h3 id="55-æ ·å¼ä½ç³»tailwind--shadcn--ç®è¤åé">5.5 æ ·å¼ä½ç³»ï¼Tailwind + shadcn + ç®è¤åé</h3>
<p>shadcn çæ ·å¼éç¨<strong>åå±å¯¼å¥</strong>ï¼</p>
<pre><code class="language-css">/* themes/shadcn/src/styles/globals.css */
@import 'tailwindcss' source('../../src');
@import 'tw-animate-css';
@import './shadcn/index.css';
@import './markdown.css';
@import './theme.css';
@import './reset.css';
</code></pre>
<ul>
<li><strong>Tailwind</strong>ï¼å·¥å·ç±»ä¸»ä½ï¼<code>source()</code> æå <code>src</code> ä»¥æ¯æ <code>@theme</code> ç­éç½®ï¼</li>
<li><strong>tw-animate-css</strong>ï¼é¢è®¾å¨ç»ï¼</li>
<li><strong>shadcn</strong>ï¼CSS åéï¼<code>--background</code>ã<code>--foreground</code>ã<code>--primary</code> ç­ï¼ãç»ä»¶æ ·å¼ï¼</li>
<li><strong>markdown</strong>ï¼æç« åå®¹ Markdown æ¸²ææ ·å¼ï¼</li>
<li><strong>theme</strong>ï¼ç®è¤çº§ç®è¤åéï¼</li>
<li><strong>reset</strong>ï¼åºç¡éç½®ã</li>
</ul>
<p>ç»ä»¶ä½¿ç¨<code>cva</code>ç®¡çæ ·å¼åä½ï¼<code>cn()</code>åå¹¶ç±»åï¼</p>
<pre><code class="language-typescript">// themes/shadcn/src/components/ui/button.tsx
const buttonVariants = cva(
  "inline-flex items-center justify-center rounded-md font-medium ...",
  {
    variants: {
      variant: { default: '...', outline: '...', ghost: '...' },
      size: { default: '...', sm: '...', icon: '...' },
    },
    defaultVariants: { variant: 'default', size: 'default' },
  },
)

function Button({ variant, size, className, ...props }) {
  return &lt;slot className={cn(buttonVariants({ variant, size }), className)} {...props} /&gt;
}
</code></pre>
<p>æè²æ¨¡å¼éè¿<code>dark:</code>åç¼å CSS åéåæ¢å®ç°ï¼æ»¡è¶³ AGENTS.md ä¸­çç®è¤è§èã</p>
<h3 id="56-æå»ºä¸è¾åº">5.6 æå»ºä¸è¾åº</h3>
<p>Vite éç½®å°ç®è¤æåä¸º<strong>åæä»¶ IIFE</strong>ï¼ä¾¿äºåå®¢å­ãé¡µè HTML ä»£ç ããèªå®ä¹ JS èæ¬ãç­å¥å£å¼å¥ï¼</p>
<pre><code class="language-typescript">// themes/shadcn/vite.config.mtsï¼èéï¼
build: {
  lib: {
    formats: ['iife'],
    entry: resolve(__dirname, 'src/main.ts'),
    name: 'shadcn',
    fileName: () =&gt; 'shadcn.js',
  },
  cssCodeSplit: false,
  rollupOptions: {
    output: { assetFileNames: 'shadcn.[ext]' },
  },
}
</code></pre>
<p>æå»ºäº§ç©ä¸º<code>dist/shadcn.js</code>å<code>dist/shadcn.css</code>ï¼ç¨æ·å°ä¸¤èå¼å¥åå®¢å­åå°å³å¯ä½¿ç¨ã</p>
<hr>
<p>éè¿æ¬èæè§£ï¼å¯ä»¥çå° tona-theme-shadcn å¦ä½å°<strong>Tona æ ¸å¿å</strong>ï¼tona-viteãtona-hooksãtona-utilsï¼ã<strong>Preact ç»ä»¶å</strong>ã<strong>Tailwind æ ·å¼ä½ç³»</strong>ä¸<strong>åå®¢å­ DOM ç»æ</strong>ææºç»åï¼å½¢æä¸å¥å¯ç»´æ¤ãå¯æ©å±çç®è¤å®ç°èå¼ï¼ä¸º AI æä¾äºæ¸æ°çåèæ¨¡æ¿ã</p>
<p>é¡ºä¾¿ä¸æï¼è¯è®ºåè¡¨ä½ä¸ºè¿ä¸ªç®è¤çæå¤æçåè½ä¹ä¸ï¼æ ·å¼ååè½é½å®å¨ç± AI å®ç°ã</p>
<h2 id="6-æå">6. æå</h2>
<p>æ¬¢è¿ä½¿ç¨ç®è¤ï¼ä¹æ¬¢è¿å°è¯ä½¿ç¨ Tona äº²ææå»ºä¸æ¬¾ç®è¤ãä¸å¦¨ç¨<code>pnpm create tona</code>å¿«éåå§åä¸ä¸ªç®è¤é¡¹ç®ï¼æåæ¬å°ç­æ´æ°ãTypeScript ä¸ Tailwind å¸¦æ¥çå¼åæçï¼è®© AI åå¼åæ®éåç«¯é¡µé¢é£æ ·å¼ååå®¢å­ç®è¤ãä¹å¯ä»¥å° Tona ä»åºä¸­çæ¨¡æ¿ãæ ¸å¿åä¸ç¤ºä¾ç®è¤ä½ä¸ºä¸ä¸æï¼çæé«è´¨éçç®è¤ä»£ç ã</p>
<p>Tona æ¯å¼æºé¡¹ç®ï¼æç®¡äº <a href="https://github.com/guangzan/tona" target="_blank" rel="noopener nofollow">GitHub</a>ãæ¬¢è¿ ðãæäº¤ Issueãåä¸è®¨è®ºæè´¡ç®ä»£ç ï¼ä¸èµ·æ¨å¨åå®¢å­ç®è¤å¼åçç°ä»£åä¸ AI åã</p>
<h2 id="7-åèèµæ">7. åèèµæ</h2>
<ul>
<li><a href="https://github.com/guangzan/tona" target="_blank" rel="noopener nofollow">gitHub/tona</a></li>
<li><a href="https://www.yuque.com/r/awescnb/books" target="_blank" rel="noopener nofollow">ä½¿ç¨ç®è¤</a></li>
<li><a href="https://www.cnblogs.com/guangzan/p/19585389" target="_blank">shadcn ç®è¤ä¸çº¿</a></li>
</ul>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.003472222222222222" data-date-updated="2026-02-13 11:01">2026-02-13 10:56</span>&nbsp;
<a href="https://www.cnblogs.com/guangzan">guangzan</a>&nbsp;
éè¯»(<span id="post_view_count">85</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19609096);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19609096', targetLink: 'https://www.cnblogs.com/guangzan/p/19609096', title: 'AI &amp;#215; åå®¢å­ç®è¤' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ çº¿ä¸æå¡éå¯åï¼ä»nacosåä¸å°éç½®äºï¼æä¹åäº ]]></title>
    <link>https://www.cnblogs.com/grey-wolf/p/19611093</link>
    <guid>905e53fe322123f994c4bf32f6340e78</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/grey-wolf/p/19611093" title="åå¸äº 2026-02-13 10:19">
    <span role="heading" aria-level="2">çº¿ä¸æå¡éå¯åï¼ä»nacosåä¸å°éç½®äºï¼æä¹åäº</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="èæ¯">èæ¯</h1>
<p>åä¸éµï¼çº¿ä¸æä¸ªæå¡åçº§ï¼å¸åçspring bootåºç¨ï¼å¼å¥äºspring cloudï¼ä¸»è¦æ¯ä¸ºäºä½¿ç¨nacosæ¥ç»ä¸ç®¡çéç½®ã</p>
<p>å¸åçbootstrap.ymléç½®å¦ä¸ï¼åå«äºç¨æ·åå¯ç ï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213093118522.png" alt="image-20260213093118522" loading="lazy"></p>
<p>æå¡å¯å¨æ¶ï¼å°±ä¼å»nacosè¯»åéç½®ï¼è¯»åéç½®å½ç¶è¦åç»å½ï¼è¿ééç½®çç¨æ·åå¯ç å°±æ¯ç»å½ç¨çã</p>
<p>æä»¬éå°çé®é¢æ¯ï¼çº¿ä¸é£ä¸ªæå¡ï¼ä¸æ¯ç¬¬ä¸æ¬¡ä¸çº¿ï¼ä¸ç´è·å¾å¥½å¥½çï¼æ¬æ¬¡æ´æ°ä¸»è¦æ¯æ´æ°äºfat jarï¼æ¹äºç¹ä¸å¡é»è¾ï¼åbootstrap.ymlè¿äºæ²¡ä»»ä½æ¹å¨ãç»æè¿ç»´åäºæ¿æ¢äºjarååä¸éå¯ï¼è¯´å¯å¨ä¸äºï¼è¯´ä½ è¿ä¸ªåæ¯ä¸æ¯æé®é¢åã</p>
<h1 id="å®ä½è¿ç¨">å®ä½è¿ç¨</h1>
<h2 id="æå">æå</h2>
<p>è¿å»è¿ç»´é£è¾¹çäºä¸ï¼åç°æ¥éæ¯è¯´ä»ä¹æ°æ®åºè¿ä¸ä¸ï¼ipä¸çï¼æ¯å¼åç¯å¢çæ°æ®åºipï¼æå°±æè§æ¯ä¸æ¯æ²¡åå°nacoséçéç½®ï¼æä»¥ç¨äºé»è®¤çå¼åç¯å¢éç½®äºï¼fat jarä¸­æé»è®¤çå¼åç¯å¢éç½®æä»¶ï¼ã</p>
<p>æå°±è¯´è¿å¾æä¸ªåççï¼nacosççå¬ç«¯å£æ¯8848ï¼ä¸»è¦ç¨äºç»å½ï¼è·åtokenï¼è¿æ9849ï¼ç¨äºæå¡æ³¨åãéç½®æåç­ã</p>
<pre><code class="language-shell">tcpdump -i any tcp port 8848 or tcp port 9848 -w nacos.pcap
</code></pre>
<p>æåæä¸æ¥ä¸çï¼åç°ç¡®å®æ²¡æåå°éç½®ï¼ä½æ¯ï¼åå æ¯ç»å½å°±å¤±è´¥äºã</p>
<p>æ¥æå¦ä¸ï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213093813785.png" alt="image-20260213093813785" loading="lazy"></p>
<h2 id="ç½é¡µç«¯ç»å½">ç½é¡µç«¯ç»å½</h2>
<p>é¾éæ¯å¯ç éäºåï¼ç¶ååæ ·çç¨æ·å¯ç ï¼å¨nacosç®¡çç³»ç»é£éç»å½ï¼åç°æ¯æ­£å¸¸çãè¿ä¸ªç¡®å®æ¯å¾å¥æªï¼F12çäºä¸ï¼çäºæ¥å£ä¹æ¯ä¸é¢é£ä¸ªæ¥å£ã</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213094323596.png" alt="image-20260213094323596" loading="lazy"></p>
<p>å¯ä¸ä¸åçä¹å°±æ¯åæ°æºå¸¦æ¹å¼æä¸ç¹å·®å¼ï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213094353557.png" alt="image-20260213094353557" loading="lazy"></p>
<p>è¿ä¸ªç½é¡µç«¯ï¼æ¯ç¨æ·åãå¯ç é½å¨formè¡¨åçhttp bodyéãèapié£è¾¹ï¼æ¯usernameå¨urléï¼å¯ç å¨bodyéã</p>
<h2 id="æäºº">æäºº</h2>
<p>ç¶åæä»¬å°±ç¡®è®¤æ¯nacos æå¡ç«¯æè§æç¹é®é¢ãå¦å¤ï¼æä»¬ä¹æ¾äºå¶ä»ç±»ä¼¼çæå¡Aï¼æé£ä¸ªæå¡Aç¨çnacosç¨æ·åãå¯ç æ¿è¿æ¥ï¼éç½®å°æ¬æå¡éï¼éå¯ï¼åç°ç«ç¶ä¹æ¥åæ ·çéè¯¯ã</p>
<p>ç¶åå°±æè§æ¯nacosæå¡ç«¯åºäºé®é¢ï¼æ¾å°å¯¹åºè´è´£çåäºï¼ä¸èµ·æ¥çãæä»¬è¿æµäºä¸ï¼ææå¡Aèªå·±éå¯äºä¸ï¼åç°éå¯ä¹å¯å¨ä¸èµ·æ¥äºï¼åæ ·æ¯æç¤º403ï¼ç¨æ·æ¾ä¸å°ã</p>
<p>æ¥ä¸æ¥ï¼ç»§ç»­æµè¯ï¼å½æ¶æ¯æçæ¯ä¸æ¯å¯ç æç¹æ®å­ç¬¦å¯¼è´çï¼ç¶ånacosè´è´£äººï¼ææä»¬çç¨æ·çå¯ç éç½®äºä¸ï¼ç¶åæä»¬éè¯ï¼åç°å¯ä»¥äºã</p>
<p>æç»çè§£å³ï¼å°±æ¯é ï¼</p>
<p>æç¨æ·çå¯ç éç½®ä¸ä¸ï¼ä¹å°±æ¯æ¹ä¸ä¸å¯ç å°±å¥½äºï¼ä½ä¸æ¯ç¹æ®å­ç¬¦çé®é¢ï¼æä»¬è¯çæ¹æäºæç¹æ®å­ç¬¦çå¯ç ï¼åç°è¿æ¯å¯ä»¥æåå¯å¨çï¼ã</p>
<p>è¿ä¸ªäºå½æ¶ä¹å°±äºäºï¼æ²¡ç®¡äºã</p>
<h1 id="ç»§ç»­æ¢ç´¢">ç»§ç»­æ¢ç´¢</h1>
<h2 id="ç»å½æ¥å£">ç»å½æ¥å£</h2>
<p>ä»å¤©ç©ºäºåï¼æè§è¿ä¸ªäºæè¿æ¯æç¹å¤æªï¼ä¸ºä»ä¹å¯ç éç½®åå°±å¥½äºï¼å½æ¶æå°±æçï¼nacosæå¡ç«¯åé¨ä¼°è®¡æç¼å­ï¼å¯è½æ¯ç¼å­åºé®é¢äºï¼ç¶åéç½®å¯ç è¿ä¸ªå¨ä½ï¼å°±å¯¼è´ç¼å­åå¾æ­£å¸¸äºã</p>
<p>ç½ä¸æ²¡æ¾å°ç¹å«å¹éæè¿ä¸ªæ¡ä¾çï¼ç¿»äºåå¤©ï¼çå°ænacosæºç è§£æçï¼äºæ¯æå°±æ³çä»£ç æä¸æ¥çä¸ä¸ç®äºã</p>
<p>çº¿ä¸çnacosçæ¬ä¸ç¡®å®ï¼ä½åºè¯¥æ¯2.2.2ï¼å ä¸ºæçäºä¸å¼åç¯å¢å°±æ¯è¿ä¸ªçæ¬ã</p>
<p>æ¾äºå¯¹åºçæºç ï¼</p>
<p><a href="https://github.com/alibaba/nacos/tree/2.2.2" target="_blank" rel="noopener nofollow">https://github.com/alibaba/nacos/tree/2.2.2</a></p>
<p><a href="https://github.com/alibaba/nacos/releases/tag/2.2.0" target="_blank" rel="noopener nofollow">https://github.com/alibaba/nacos/releases/tag/2.2.0</a></p>
<p>ç´æ¥ä¸äºä¸ªzipåï¼ideaéæå¼ã</p>
<p>å¨å±æç´¢login"ï¼åç°å¦ä¸ä»£ç ï¼</p>
<p>com.alibaba.nacos.plugin.auth.impl.controller.UserController#login</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213095720124.png" alt="image-20260213095720124" loading="lazy"></p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213095743794.png" alt="image-20260213095743794" loading="lazy"></p>
<p>ç¶åï¼è¿éæä¸ªæ ¹æ®ç¨æ·åï¼æ¥æ¾ç¨æ·è¯¦ç»ä¿¡æ¯çï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213095803120.png" alt="image-20260213095803120" loading="lazy"></p>
<p>ä¸é¢è¿éï¼åæ¯å»ä¸ä¸ªç¼å­mapéæ¥è¯¢ï¼å¦ææ²¡å¼å¯ä¸ä¸ªcacheEnabledçå¼å³ï¼åä¼ç»§ç»­å»æ¥æ°æ®åºï¼ä»¥æ°æ®åºçä¸ºåï¼</p>
<pre><code class="language-java">private Map&lt;String, User&gt; userMap = new ConcurrentHashMap&lt;&gt;();
</code></pre>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213095851520.png" alt="image-20260213095851520" loading="lazy"></p>
<p>æçäºä¸ï¼æä»¬æ¬å°å¼åç¯å¢çå¼å³ï¼åæ­£æ¯é»è®¤æå¼çï¼æä¼°è®¡ï¼çº¿ä¸ä¹æ¯è¿æ ·ï¼ä¹å°±æ¯è¯´ï¼æ¯åè®¸ç¼å­çï¼è¿é½å¹´æ«äºï¼è¿ç»´æ¾åäºï¼ä¸ææ°äºã</p>
<p>å·ä½çç¼å­å¼å³æ¯è¿ä¸ªï¼</p>
<pre><code class="language-java">public static final String NACOS_CORE_AUTH_CACHING_ENABLED = "nacos.core.auth.caching.enabled";
</code></pre>
<p>éç½®æä»¶ä¸­æ¯å¼å¯çï¼</p>
<pre><code class="language-shell">[root@COMPASS-NACOS-1 nacos]# cat conf/application.properties |grep caching
### Turn on/off caching of auth information. By turning on this switch, the update of auth information would have a 15 seconds delay.
nacos.core.auth.caching.enabled=true
</code></pre>
<p>é£å°±æ¯äºï¼åºè¯¥å°±æ¯ç¼å­éçç¨æ·æ°æ®æé®é¢ã</p>
<p>é£ä¸ºå¥ï¼éç½®å¯ç å°±å¥½äºå¢ï¼</p>
<h2 id="ä¿®æ¹å¯ç æ¥å£">ä¿®æ¹å¯ç æ¥å£</h2>
<p>ä¿®æ¹å¯ç è¿ä¸ªï¼æä»¬å½æ¶è¿æµè¯äºï¼èªå·±æ¹å¯ç è¿ä¸è¡ï¼å¿é¡»æ¯nacosè´è´£äººé£ä¸ªç®¡çè´¦å·æ¹äºæçæçã</p>
<p>å¦å¤ï¼æçäºä¸ï¼ä¸é¢é£ä¸ªç»å½æ¥å£éï¼æ¥ç¨æ·çsqlå¦ä¸ï¼</p>
<pre><code class="language-java">    public User findUserByUsername(String username) {
        String sql = "SELECT username,password FROM users WHERE username=? ";
        return databaseOperate.queryOne(sql, new Object[] {username}, USER_ROW_MAPPER);
    }
</code></pre>
<p>é£ä¿®æ¹å¯ç ï¼å¨å±æä¸ä¸<code>update users</code>ï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213100640175.png" alt="image-20260213100640175" loading="lazy"></p>
<pre><code class="language-shell">com.alibaba.nacos.plugin.auth.impl.controller.UserController#updateUser
</code></pre>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213100822326.png" alt="image-20260213100822326" loading="lazy"></p>
<p>æä»¬åç°ï¼æ¹å¯ç çæ¥å£ï¼æ´å®æ åï¼å°±æ¯æ¹ä¸æ°æ®åºï¼æ²¡æ¶åå°æ¸ä¸ç¼å­å¥çï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213100836452.png" alt="image-20260213100836452" loading="lazy"></p>
<p>é£å°±ä»é£ä¸ªç¼å­çmapçæï¼çäºä¸ï¼</p>
<pre><code class="language-shell">com.alibaba.nacos.plugin.auth.impl.users.NacosUserDetailsServiceImpl#reload
</code></pre>
<p>ç»æåç°äºä¸ä¸ªå®æ¶ä»»å¡ï¼è¿éæ¯é15sæ§è¡ä¸æ¬¡ï¼ä»æ°æ®åºå è½½useræ°æ®å°ç¼å­ï¼</p>
<p><img src="https://dump-1252523945.cos.ap-shanghai.myqcloud.com/img/image-20260213101021274.png" alt="image-20260213101021274" loading="lazy"></p>
<p>é£å°±çè§£äºï¼æ¹å¯ç æ¯åªæä½æ°æ®åºï¼ç¶åå®æ¶ä»»å¡å»æ°æ®åºæ¥è¯¢ææ°æ°æ®ï¼æ¾å°ç¼å­éï¼è¿æ ·å¢ï¼ç¼å­æ°æ®å°±åæ°æ®åºæ°æ®ä¸è´äºã</p>
<p>å¦ä¸ä¸ªçæµï¼ç¼å­æ¯15ç§ä»æ°æ®åºåæ­¥ï¼ç¼å­æ°æ®æé®é¢ï¼æ¯ä¸æ¯è¯´ææé®é¢çå¯è½æ¯æ°æ®åºå¢ï¼ä¹å°±æ¯è¯´ï¼æ°æ®åºéçç¨æ·æ°æ®åºäºé®é¢ï¼éè¿ä¿®æ¹å¯ç çæ¹å¼ææ­£å¸¸ï¼ç¶å15ç§åï¼ç¼å­éæ°æ®åå¾æ­£å¸¸ã</p>
<p>è³äºæ°æ®åºæ°æ®ä¸ºå¥åºäºé®é¢ï¼è¿ä¸ªå°±ä¸å¥½æ¾äºï¼æ¬ç¯å°±ä¸æ¢ç©¶äºã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 10:20">2026-02-13 10:19</span>&nbsp;
<a href="https://www.cnblogs.com/grey-wolf">ä¸å½æ¢¦å</a>&nbsp;
éè¯»(<span id="post_view_count">36</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19611093);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19611093', targetLink: 'https://www.cnblogs.com/grey-wolf/p/19611093', title: 'çº¿ä¸æå¡éå¯åï¼ä»nacosåä¸å°éç½®äºï¼æä¹åäº' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ MindIE è¸©åæ¥è®°åä¸ä¸ªwebå°å·¥å· ]]></title>
    <link>https://www.cnblogs.com/chumochen/p/19610004</link>
    <guid>3d44cbb25608888c062348019a1136a6</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/chumochen/p/19610004" title="åå¸äº 2026-02-12 22:40">
    <span role="heading" aria-level="2">MindIE è¸©åæ¥è®°åä¸ä¸ªwebå°å·¥å·</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h4 id="å¼è¨">å¼è¨</h4>
<p>æè¿å¨æè¾ï¼Ascendï¼NPU ä¸é¨ç½²å¤§æ¨¡åï¼å®æ¹ä¸»æ¨çæ¨çæ¡æ¶æ¯ MindIEãåè½ç¡®å®å®æ´ï¼ææ¡£ä¹åå¾æºâè§èâï¼ä½å®éç¨èµ·æ¥å´å­å¨ä¸å°âéå½¢é¨æ§âã</p>
<h4 id="è¸©åæ»ç»">è¸©åæ»ç»</h4>
<p><strong>1.  Dockerå®¹å¨æéä¸è¿ç¨ç®¡çå</strong></p>
<ul>
<li>å¿é¡»å  --privileged åæ°ï¼å¦åå®¹å¨éæ ¹æ¬è®¿é®ä¸å°NPUè®¾å¤ï¼å¯å¨å°±æ¥éã</li>
<li>åµå°¸è¿ç¨ï¼ä¸å  --init çè¯ï¼æ¨çæå¡éåºåï¼è¿ç¨åæ¶ä¸äºï¼ç´æ¥å¯¼è´åç»­æ¨çæå¡å¯å¨å¤±è´¥ï¼åªè½æå¨æè¿ç¨æéå¯å®¹å¨æå¡ã</li>
</ul>
<p><strong>2. å¨æåºæ¾ä¸å°ï¼libcsec.so: not found</strong><br>
å®¹å¨ä¸­è¿è¡æ¨çä¼åºç°libcsec.soæ¾ä¸å°çæåµï¼éè¦æå¨è®¾ç½® LD_LIBRARY_PATH æåå¥ /etc/ld.so.conf.d/</p>
<p><strong>3. å®¹å¨ç§é</strong><br>
å®æ¹éåæ²¡æåå°è¿ç¨ï¼docker run -d å¯å¨åç«å»éåºï¼è¦ä¹ä¸´æ¶ç¨ tail -f /dev/null å ä½ï¼æèèªå·±å°è£å¯å¨èæ¬ã</p>
<p><strong>4. CANNé«çæ¬é®é¢</strong><br>
æå¡å¨çNPUé©±å¨åCANNçé«çæ¬ä¸ä¸å®å¹éï¼å¦æå®è£é«çæ¬CANNä¼å¯¼è´ç³»ç»åæ ¸çæ¬åNPUé©±å¨çæ¬ä¸å¹éï¼å¯¼è´NPUæ æ³è¯å«</p>
<p><strong>5. æ¥å£å¼å®¹é®é¢ï¼</strong><br>
vllmå¼å®¹OpenAIçæ¨çæ¥å£/v1/completionsï¼å³ä½¿åæ°éç½®æ­£ç¡®ï¼ä¹ä¼æç¤ºâMessages token length must be in (0, 1048576], but got 0âéè¯¯ãè§£å³æ¹æ¡æ¯åæ¢ä¸ºå¼å®¹TGI 0.9.4çæ¬æ¥å£ç/generateæ¥å£ã</p>
<p>è¿æä¸äºå¶ä»çé®é¢ï¼æ¯å¦<br>
1 . éç½®ä¸å¯è§ãä¸å¯æ¹ï¼ææéç½®æä»¶æ·±èå®¹å¨åï¼ä¿®æ¹ééå»ºéåæ exec è¿å¥ã<br>
2 . æå¡å¯å¨ç¹çï¼æ¯æ¬¡é½è¦æå¨æ¿æ´» CANN ç¯å¢ãè®¾ç½®åéã<br>
3 . ç¼ºä¹å¯è§åæµè¯å·¥å·ï¼åªè½é  curl è°è¯ã<br>
4 . é¨ç½²æµç¨ä¸éæï¼æ¥å¿åæ£ï¼éè¯¯ä¿¡æ¯é¾å®ä½ã</p>
<p>è¸©åè¸©å¤äºï¼äººä¹éº»äºãå ä¸åé¢è¦äº¤ç»å®¢æ·ç¨ï¼æ»ä¸è½æ¯æ¬¡é½è®©äººå®¶å¼ç»ç«¯æ²å½ä»¤ã<br>
äºæ¯åäºä¸ªçº¯ Web çé¢ç MindIE å°å©æã</p>
<p>ä»åºå°åï¼<a href="https://github.com/jclown/MyMindIEWebConsole" target="_blank" rel="noopener nofollow">https://github.com/jclown/MyMindIEWebConsole</a><br>
<img src="https://img2024.cnblogs.com/blog/1212315/202602/1212315-20260212223800963-1865678913.png" alt="image" loading="lazy"></p>
<p><strong>1 å¯è§ååæ°éç½®</strong><br>
<img src="https://img2024.cnblogs.com/blog/1212315/202602/1212315-20260212223656466-1398105072.png" alt="image" loading="lazy"></p>
<p><strong>2 æ¨¡åç®¡çåé¨ç½²</strong><br>
<img src="https://img2024.cnblogs.com/blog/1212315/202602/1212315-20260212223713695-1347474859.png" alt="image" loading="lazy"></p>
<p><strong>3 å¯¹è¯æµè¯çé¢</strong><br>
<img src="https://img2024.cnblogs.com/blog/1212315/202602/1212315-20260212223737527-1308806231.png" alt="image" loading="lazy"></p>
<p><strong>4 æ¥å¿çæµ</strong><br>
<img src="https://img2024.cnblogs.com/blog/1212315/202602/1212315-20260212223724078-1950248665.png" alt="image" loading="lazy"></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-12 22:40">2026-02-12 22:40</span>&nbsp;
<a href="https://www.cnblogs.com/chumochen">å°å¹´ç¥æ</a>&nbsp;
éè¯»(<span id="post_view_count">42</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19610004);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19610004', targetLink: 'https://www.cnblogs.com/chumochen/p/19610004', title: 'MindIE è¸©åæ¥è®°åä¸ä¸ªwebå°å·¥å·' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãEF Coreãå®ä½è¿½è¸ªââEntryä¸­è®°å½çæ°æ® ]]></title>
    <link>https://www.cnblogs.com/tcjiaan/p/19601119</link>
    <guid>3550e3b347760566aa5070288843019a</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/tcjiaan/p/19601119" title="åå¸äº 2026-02-12 22:23">
    <span role="heading" aria-level="2">ãEF Coreãå®ä½è¿½è¸ªââEntryä¸­è®°å½çæ°æ®</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>è¿åç»äºå¯ä»¥ Free äºï¼åå¥½å¿«è¿å¹´äºï¼å·¥åçæºå¨ä¹å¾äººæ§åå°åäºï¼éè¦ä¾åºåç»´ä¿®ï¼ä¸ç¨æµè¯é¡¹ç®äºãæä»¥èå¨ä¹åå®¶å¿«æ´»äºå å¤©ãå¶å®ä»ä»¬èªå·±æå¼åå¢éï¼å°æ¹å°æµçä»ä»¬å®å¨å¯ä»¥èªå·±å¼ï¼éè¦æ¾èå¨éº»ç¦ã</p>
<p>å±ä»¬æ¥çä¸æ¬¡çè¯é¢èï¼ä¸æ¬¡èå¨ç»å¤§ä¼ä¼´ä»¬è¡è¯äºä¸çªæå³å®ä½ç¶æè¿½è¸ªçåºç¡ãè¿ä¸æ¬¡å±ä»¬ææ³¨æåæ¾å°åä¸º EntityEntry çå¯¹è±¡ä¸ãå¦ï¼è¿åæä¹ççè¿ä¹å¥è©ï¼å±ä»¬ä¸ç®¡å®å¥ä¸å¥è©ï¼åªè¦ç¥éå®è´è´£ä¿å­å®ä½å¯¹è±¡çå±æ§å¼å°±è¡äºã</p>
<p>æ¯ç«å®ä½ç±»éå¸¸å°±æ¯ä¸ä¸ªæ®éç±»ï¼EF Core éè¦ç¶æè¿½è¸ªåè½ï¼æ»ä¸è½è®©å¼åèèªå·±å»è·è¸ªå§ï¼æä»¥ï¼EF åé¨ä¼ç¨å­å¸æ°æ®ç»ææ¥ä¿å­å®ä½çåä¸ªå±æ§çå¼ãå­å¸æ¯ä¸ªå¥½ä¸è¥¿ï¼å¥é½è½æ¾ãææ¶åå¨å Web API æ¶ï¼ä¸äºè¿å JSON ç»ææ¯å¨æçï¼ä¸ºå®ä»¬é½å®ä¹ä¸ä¸ªç±»æ¥åºååæ¯ä¸ææºçï¼ç´æ¥æ¼è£ JSON æç¹éº»ç¦ï¼è¿æ¶åç¨å­å¸å°±å¾ç½ã</p>
<p>å½å®ä½ä»æ°æ®åºæ¥è¯¢åºæ¥æ¶ï¼EF åä¸ºå®ä½å¯¹è±¡åå»ºä¸ä¸ªå¿«ç§ï¼è¡¨æå®çåå§æ°æ®ãç¶åï¼å½ä½ å¯¹å®ä½è¿è¡åç§ææä½ä¹åï¼è°ç¨ä¸ä¸&nbsp;DetectChanges æ¹æ³ï¼å®ä¼æ«æå®ä½å¯¹è±¡åä¸ªå±æ§çå¼ï¼å¹¶åå½ååå»ºçå¿«ç§æ¯è¾ï¼ä»¥ç¡®å®å®ä½æ¯å¦è¢«ä¿®æ¹ï¼æå é¤ï¼ã</p>
<p>ä¸ºäºè®©åå­¦çå¤§ä¼ä¼´ä»¬å¥½çè§£ï¼å±ä»¬åä¸ªå¯¹æ¯å®éªã</p>
<p>åè®¾æè¿ä¹ä¸ªå®ä½ç±»ï¼å®è¡¨ç¤ºä¸æ¬ä¹¦çä¿¡æ¯ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> Book
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> BookId { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Name { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">null</span>!<span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> ISBN { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">null</span>!<span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Author { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">null</span>!<span style="color: rgba(0, 0, 0, 1)">;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> PubYear {  <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
}</span></pre>
</div>
<p>ç¶åæ¯å®ç°æ°æ®åºä¸ä¸æã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> MyDb : DbContext
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> DbSet&lt;Book&gt; Books { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }

    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlite(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">data source=shop.db</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    }

    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> OnModelCreating(ModelBuilder modelBuilder)
    {
        </span><span style="color: rgba(0, 0, 255, 1)">var</span> bookEnt = modelBuilder.Entity&lt;Book&gt;<span style="color: rgba(0, 0, 0, 1)">();
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä¸»é®åç§°</span>
        bookEnt.HasKey(x =&gt; x.BookId).HasName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">PK_Book</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å­ç¬¦ä¸²é¿åº¦</span>
        bookEnt.Property(a =&gt; a.Name).HasMaxLength(<span style="color: rgba(128, 0, 128, 1)">65</span><span style="color: rgba(0, 0, 0, 1)">);
        bookEnt.Property(b </span>=&gt; b.Author).HasMaxLength(<span style="color: rgba(128, 0, 128, 1)">20</span><span style="color: rgba(0, 0, 0, 1)">);
        bookEnt.Property(c </span>=&gt; c.ISBN).HasMaxLength(<span style="color: rgba(128, 0, 128, 1)">15</span><span style="color: rgba(0, 0, 0, 1)">);
        bookEnt.ToTable(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">tb_Books</span><span style="color: rgba(128, 0, 0, 1)">"</span>, t =&gt;<span style="color: rgba(0, 0, 0, 1)">
        {
            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> çº¦æ</span>
            t.HasCheckConstraint(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">CK_Pubyear</span><span style="color: rgba(128, 0, 0, 1)">"</span>, <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">\"PubYear\" &gt;= 2020 AND \"PubYear\" &lt;= 2080</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        });
    }
}</span></pre>
</div>
<p>ä¸é¢é£äºé½æ¯å¸¸è§æä½äºï¼å¤§å®¶çä¸¤ç¼å°±è¡ãä¸é¢ä»£ç åå»ºæ°æ®åºå¹¶æå¥ä¸æ¡æ°æ®ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">using</span> MyDb context = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">();
context.Database.EnsureCreated();</span><span style="color: rgba(0, 0, 0, 1)">

        <span style="background-color: rgba(255, 255, 0, 1)">Book bb </span></span><span style="background-color: rgba(255, 255, 0, 1)">= <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">()
</span></span>        <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">{
</span></span>            <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">Name </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
</span></span>            <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">Author </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
</span></span>            <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">ISBN </span>= <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,
</span></span>            <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">PubYear </span>= <span style="color: rgba(128, 0, 128, 1)">2028</span></span>
        <span style="color: rgba(0, 0, 0, 1)"><span style="background-color: rgba(255, 255, 0, 1)">};</span>
context.Books.Add(bb);
context.SaveChanges();</span></pre>
</div>
<p>ä¸é¢éå¤´ææ¥äºãå±ä»¬ä»æ°æ®åºä¸­æ¥è¯¢åºè¿æ¡è®°å½ï¼ç¶åæ¹å PubYear å±æ§çå¼ã</p>
<div class="cnblogs_code">
<pre> <span style="color: rgba(0, 0, 255, 1)">var</span> theBook =<span style="color: rgba(0, 0, 0, 1)"> context.Books.FirstOrDefault();
 </span><span style="color: rgba(0, 0, 255, 1)">if</span> (theBook == <span style="color: rgba(0, 0, 255, 1)">null</span>) <span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)">;

 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°ä¸æ¬¡è¿½è¸ª</span>
<span style="color: rgba(0, 0, 0, 1)"> Console.WriteLine(context.ChangeTracker.ToDebugString());
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ´æ¹å±æ§</span>
 theBook.PubYear = <span style="color: rgba(128, 0, 128, 1)">2030</span><span style="color: rgba(0, 0, 0, 1)">;
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæå°ä¸æ¬¡</span>
 Console.WriteLine(context.ChangeTracker.ToDebugString());</pre>
</div>
<p>ChangeTracker.ToDebugString æ¹æ³æ¹ä¾¿æµè¯ï¼å¯ä»¥ç´æ¥è§å¯æ¡æ¶å¯¹å®ä½å¯¹è±¡çæ´æ¹è®°å½ãä¸¤æ¬¡è°ç¨çè¾åºå¦ä¸ï¼</p>
<div class="cnblogs_code">
<pre>Book {BookId: <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} Unchanged
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2028</span><span style="color: rgba(0, 0, 0, 1)">

Book {BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} Unchanged
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2030</span> Originally <span style="color: rgba(128, 0, 128, 1)">2028</span></pre>
</div>
<p>å¾ææ¾ï¼EF å¹¶ä¸ç¥éå±ä»¬ä¿®æ¹äºå®ä½ï¼æä»¥ï¼è°ç¨ä¸ä¸&nbsp;DetectChanges æ¹æ³ä¼è§¦åä¸æ¬¡æ«æåæ¯è¾ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°ä¸æ¬¡è¿½è¸ª</span>
<span style="color: rgba(0, 0, 0, 1)">Console.WriteLine(context.ChangeTracker.ToDebugString());
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ´æ¹å±æ§</span>
theBook.PubYear = <span style="color: rgba(128, 0, 128, 1)">2030</span><span style="color: rgba(0, 0, 0, 1)">;
<strong><span style="background-color: rgba(255, 255, 0, 1)">context.ChangeTracker.DetectChanges()</span></strong>;
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæå°ä¸æ¬¡</span>
Console.WriteLine(context.ChangeTracker.ToDebugString());</pre>
</div>
<p>è¿æ¬¡ EF å°±ç¥éå®ä½è¢«ä¿®æ¹äºã</p>
<div class="cnblogs_code">
<pre>Book {BookId: <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} Unchanged
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2028</span><span style="color: rgba(0, 0, 0, 1)">

Book {BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} <span style="background-color: rgba(255, 255, 0, 1)">Modified</span>
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span>
    <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2030</span> Modified Originally <span style="color: rgba(128, 0, 128, 1)">2028</span></span></pre>
</div>
<p>ç±äº PubYear å±æ§è¢«æ´æ°ï¼ä½¿å¾å®ä½çç¶æåæ´ä¸º Modifiedã</p>
<p>é£ï¼ä¸ºä»ä¹æè°ç¨ SaveChanges æ¹æ³æ¶ EF è½é¡ºå©çææ´æ° SQL å¢ï¼å ä¸ºè¿ä¸ªæ¹æ³ä¼å DetectChangesï¼åæ ¹æ®å®ä½çç¶ææ¥çææ´æ°è¯­å¥ã</p>
<p>ä½æ¯ï¼å¦æä½ å¨ä»£ç éé¢æ&nbsp;AutoDetectChangesEnabled å±æ§è®¾ç½®ä¸º falseï¼é£ä¹è°ç¨ SaveChanges æ¹æ³æ¯ä¸ä¼æ´æ°çã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">using</span> MyDb context = <span style="color: rgba(0, 0, 255, 1)">new</span><span style="color: rgba(0, 0, 0, 1)">();
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ³¨æè¿ä¸è¡</span>
context.<strong><span style="background-color: rgba(255, 255, 0, 1)">ChangeTracker.AutoDetectChangesEnabled = <span style="color: rgba(0, 0, 255, 1)">false</span></span></strong><span style="color: rgba(0, 0, 0, 1)">;

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¾åºç¬¬ä¸æ¡è®°å½</span>
Book onebook =<span style="color: rgba(0, 0, 0, 1)"> context.Books.First();
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°ä¸æ¬¡</span>
Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{onebook.Name}, {onebook.PubYear}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¹ä¸ä¸å¹´ä»½</span>
onebook.PubYear = <span style="color: rgba(128, 0, 128, 1)">2031</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æäº¤æ´æ¹</span>
<span style="color: rgba(0, 0, 0, 1); background-color: rgba(0, 255, 0, 1)">context.SaveChanges();
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ¥è¯¢ä¸æ¬¡</span>
Book otherOne = context.Books.First(b =&gt; b.BookId ==<span style="color: rgba(0, 0, 0, 1)"> onebook.BookId);

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ¬¡æå°</span>
Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{otherOne.Name}, {otherOne.PubYear}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ççå®ä½è¿½è¸ªä¿¡æ¯</span>
Console.WriteLine(context.Entry(otherOne).DebugView.LongView);</pre>
</div>
<p>ççè°è¯ä¿¡æ¯ã</p>
<div class="cnblogs_code">
<pre>åé­æ¯, <span style="color: rgba(128, 0, 128, 1)">2028</span><span style="color: rgba(0, 0, 0, 1)">
åé­æ¯, </span><span style="color: rgba(128, 0, 128, 1)">2031</span><span style="color: rgba(0, 0, 0, 1)">
Book {BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} <strong><span style="background-color: rgba(255, 0, 0, 1); color: rgba(255, 255, 255, 1)">Unchanged</span></strong>
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span>
    <span style="background-color: rgba(0, 255, 0, 1)"><span style="color: rgba(0, 0, 0, 1)">PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2031</span> Originally <span style="color: rgba(128, 0, 128, 1)">2028</span></span></pre>
</div>
<p>è½ç¶ EF è¿½è¸ªå° PubYear å±æ§è¢«æ¹ä¸º 2031ï¼ä½æ³¨æå®ç°å¨çç¶ææ¯ Unchangedï¼æä»¥ SaveChanges ä¸ä¼æ´æ°æ°æ®åºã</p>
<p>å¤§ä¼ä¼´ä»¬ï¼è¿éä½ åä¸å«ç¯ç³æ¶ï¼ææ¦å¿µææ··äºã<span style="background-color: rgba(255, 0, 0, 1); font-size: 15px; color: rgba(255, 255, 255, 1)"><strong>AutoDetectChangesEnabled å±æ§è®¾ç½®ä¸º false åªè¡¨æ EF å¨ SaveChanges æ¹æ³ä¸­ä¸ä¼èªå¨æ«ææ£æµå®ä½çç¶æï¼å¯äººå®¶æ²¡è¯´ä¸ä¼è¿½è¸ªå®ä½çåæ´å</strong></span>ã</p>
<p>ä½ å¦æåªæ¯æ¥è¯¢æ°æ®ï¼ä¸æ´æ¹æ°æ®ï¼ä¸éè¦è¿½è¸ªå®ä½ç¶æï¼ä»¥æåä¸å¤ªææ¾çæ§è½ï¼ï¼é£ä¹ä½ ä¸åºè¯¥å³é­&nbsp;AutoDetectChangesEnabled å±æ§ï¼èåºè¯¥è®¾ç½®&nbsp;QueryTrackingBehavior å±æ§ã</p>
<div class="cnblogs_code">
<pre>context.ChangeTracker.QueryTrackingBehavior = <strong><span style="background-color: rgba(255, 255, 0, 1)">QueryTrackingBehavior.NoTracking</span></strong>;</pre>
</div>
<p>ç¦ç¨è¿½è¸ªåï¼æ´æ°æ°æ®åºå°±è· Sugar ä¸æ ·ï¼éè¦ä½ å¼æå¨æ¡£ãä½ åªéè¦è°ç¨ä¸ä¸ Update æ¹æ³ï¼å°å®ä½ç¶æåä¸º Modified å°±è¡ï¼ç¼ºç¹æ¯çæç UPDATE è¯­å¥ä¼æææå­æ®µé½ SET ä¸éã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¾åºç¬¬ä¸æ¡è®°å½</span>
Book onebook =<span style="color: rgba(0, 0, 0, 1)"> context.Books.First();
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°ä¸æ¬¡</span>
Console.WriteLine($<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">{onebook.Name}, {onebook.PubYear}</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¹ä¸ä¸å¹´ä»½</span>
onebook.PubYear = <span style="color: rgba(128, 0, 128, 1)">2024</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¹åç¶æ</span>
<span style="color: rgba(0, 0, 0, 1)"><strong><span style="background-color: rgba(255, 255, 0, 1)">context.Update(onebook)</span></strong>;

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æäº¤æ´æ¹</span>
context.SaveChanges();</pre>
</div>
<p>é£ææ²¡ææ¹æ³è®©çæç UPDATE è¯­å¥åª SET è¢«æ¹å¨è¿çå­æ®µå¢ï¼å¤§ä¼ä¼´è¯å®çå°ï¼èå¨æ¢ç¶è¿ä¹åï¼é£è¯´æè¯å®æçãä½èå¨å¸æä½ ä¸è¦æ­»è®°æ¹æ³ï¼èæ¯æè·¯ãå±ä»¬å¥½å¥½æ³ä¸ä¸ï¼EF æ¯ä¸æ¯å¨æ¥è¯¢åºæ°æ®å°ä¸ºå®ä½å»ºç«å¿«ç§ï¼ç¶åè¿è¡æ¯è¾ï¼ä»¥ç¡®å®åªäºå±æ§ï¼å­æ®µï¼è¢«ä¿®æ¹äºãæ¢ç¶è¿æ ·ï¼å±ä»¬å¨æ¥è¯¢å®ä½åï¼æå¨ç»å®å¼ä¸ªå¿«ç§ï¼ç¶ååä¿®æ¹å±æ§å¼ï¼åæäº¤æ´æ°ä¸å°±å®äºäºåï¼å¥½ï¼æ³å¹²å°±å¹²ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¾åºç¬¬ä¸æ¡è®°å½</span>
Book onebook =<span style="color: rgba(0, 0, 0, 1)"> context.Books.First();

context.Books.Attach(onebook);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> è®°å½å¿«ç§</span>
<span style="color: rgba(0, 0, 0, 1)"><strong><span style="background-color: rgba(255, 255, 0, 1)">context.Entry(onebook).OriginalValues.SetValues(onebook)</span></strong>;

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ¹ä¸ä¸å¹´ä»½</span>
onebook.PubYear = <span style="color: rgba(128, 0, 128, 1)">2021</span><span style="color: rgba(0, 0, 0, 1)">;
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°ä¸ä¸ç¶æä¿¡æ¯</span>
<span style="color: rgba(0, 0, 0, 1)">Console.WriteLine(context.Entry(onebook).DebugView.LongView);

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ä¸¥éè­¦åï¼å¦æä½ æ AutoDetectChangesEnabled å±æ§è®¾ç½®ä¸º falseï¼é£ä¸å®è¦è°ç¨ä¸é¢è¿ä¸è¡ä»¥æ«ææ´æ¹ï¼å¦ååªè½æ´æ°ä¸ªæ¯çº¿
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¦æä½ æ²¡ææ¹å¨ AutoDetectChangesEnabled å±æ§ï¼å®é»è®¤æ¯æå¼çï¼é£ä¸é¢è¿è¡å¯ä»¥å¿½ç¥
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> context.ChangeTracker.DetectChanges();
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æäº¤æ´æ¹</span>
<span style="color: rgba(0, 0, 0, 1)">context.SaveChanges();

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ¥è¯¢ä¸æ¬¡</span>
Book otherOne = context.Books.First(b =&gt; b.BookId ==<span style="color: rgba(0, 0, 0, 1)"> onebook.BookId);

</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ¬¡æå°ç¶æä¿¡æ¯</span>
Console.WriteLine(context.Entry(otherOne).DebugView.LongView);</pre>
</div>
<p>ç»æå¦ä¸ï¼</p>
<div class="cnblogs_code">
<pre>Book {BookId: <span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} Modified
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2021</span> <strong><span style="background-color: rgba(255, 255, 0, 1)">Modified Originally <span style="color: rgba(128, 0, 128, 1)">2025</span></span></strong><span style="color: rgba(0, 0, 0, 1)">
Book {BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">} Detached
    BookId: </span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)"> PK
    Author: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">èå¨</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    ISBN: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">551269882</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">åé­æ¯</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    PubYear: </span><span style="color: rgba(128, 0, 128, 1)">2021</span></pre>
</div>
<p>çæçSQLè¯­å¥å¦ä¸ï¼</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">UPDATE</span> "tb_Books" <span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(0, 0, 255, 1)">SET</span> "PubYear" <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(0, 128, 0, 1)">@p0</span></span>
<span style="color: rgba(0, 0, 255, 1)">WHERE</span> "BookId" <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(0, 128, 0, 1)">@p1</span><span style="color: rgba(0, 0, 0, 1)">
RETURNING </span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1</span>;</pre>
</div>
<p>å ä¸ºå±ä»¬è®¾ç½®ä¸ºä¸è¿½è¸ªå®ä½ï¼QueryTrackingBehavior.NoTrackingï¼ï¼æä»¥å¨æ¥è¯¢åï¼è¦ç¨ Attach æ¹æ³æå®ä½è¿æ¥å°è¿½è¸ªå¨ï¼å¹¶è®¾å®ç¶æä¸º Unchangedãç¶åï¼context.Entry æ¹æ³è·åå° EntityEntry å¯¹è±¡ï¼æ¬æçä¸»è§åºåºäºï¼ï¼åå¾&nbsp;OriginalValues éé¢æ¾ç¹åææï¼ç®åæ¥è¯¢åºæ¥çå¼ï¼ï¼è¿æ ·å¿«ç§å°±å»ºç«äºãåç¶åï¼å¯ä»¥å¤§èå°ä¿®æ¹å®ä½äºï¼è¿æ¶å EF è½æ«æå°æ´æ¹ãç±äºå±ä»¬è®¾ç½®çä¸è¿½è¸ªï¼æä»¥æ´æ°ä¹å EF åæå®ä½ç»ç©äºï¼äºæ¯å®ä½ç¶æååå Detachedã</p>
<p>è¯´ç®åç¹ï¼å¨æå¨æ¡£è¿½è¸ªä¸ï¼å®ä½çç¶æç»åäº Detached -&gt; Unchanged -&gt; Modified -&gt; Detached ççæ­»è½®åã</p>
<p>-----------------------------------------------------------------------------------------------------------------------------------------------------------</p>
<p>Entry æ¯âè®°å½âçææï¼EntityEntry ææçä¹ä¸ä¸å°±æ¯âå®ä½è®°å½âï¼å®ç»´æ¤çå®ä½çç¶æååå±æ§çå¼ãä¸å¥è¯æ¯åºæ»ç»ï¼å®æ¯ä¸ºå®ä½è¿½è¸ªï¼è·è¸ªï¼æå¡çï¼ç®¡ççå®ä½ç¸å³çæ°æ®ã</p>
<p>å¨ 80% çä½¿ç¨åºæ¯ä¸ï¼æä»¬ä¸éè¦ç¨ Entry çï¼èµ°å¸¸è§æµç¨ï¼ä»æ°æ®åºä¸­æ¥è¯¢æ°æ®ï¼èªå¨è¿½è¸ªï¼ä¿®æ¹åæäº¤å°±å®äºäºãä¸è¿ï¼åå½±å­å±æ§è¿ç§ä¸å¨å®ä½ç±»ä¸­çæåï¼ä½ ååï¼å½±å­å±æ§çåæ°æ®å¨æ°æ®åºæ¨¡åä¸­ï¼èå¼æ¯ä¿å­å¨ EntityEntry ä¸­ãä¸é¢å±ä»¬ç¨ä¸ä¸ªå®ä¾æ¥è¯´æã</p>
<p>å±ä»¬å®ä¹ä¸ä¸ªç¨æ·å®ä½ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> User
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">int</span> Id { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> Name { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.Empty;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span> LogName { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span>; } = <span style="color: rgba(0, 0, 255, 1)">string</span><span style="color: rgba(0, 0, 0, 1)">.Empty;
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">string</span>? Password {  <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }
}</span></pre>
</div>
<p>ç¶åæ¯å®ç°èªå·±çæ°æ®åºä¸ä¸æã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">public</span> <span style="color: rgba(0, 0, 255, 1)">class</span><span style="color: rgba(0, 0, 0, 1)"> AppContext : DbContext
{
    </span><span style="color: rgba(0, 0, 255, 1)">public</span> DbSet&lt;User&gt; Users { <span style="color: rgba(0, 0, 255, 1)">get</span>; <span style="color: rgba(0, 0, 255, 1)">set</span><span style="color: rgba(0, 0, 0, 1)">; }

    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlite(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">data source=demo996.db</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)</span><span style="color: rgba(0, 0, 0, 1)">;
    }

    </span><span style="color: rgba(0, 0, 255, 1)">protected</span> <span style="color: rgba(0, 0, 255, 1)">override</span> <span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> OnModelCreating(ModelBuilder modelBuilder)
    {
        EntityTypeBuilder</span>&lt;User&gt; entUser = modelBuilder.Entity&lt;User&gt;<span style="color: rgba(0, 0, 0, 1)">();
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¸¸è§éç½®</span>
        entUser.Property(x =&gt; x.Name).HasColumnName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">u_name</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        entUser.Property(w </span>=&gt; w.LogName).HasColumnName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">log_name</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        entUser.Property(t </span>=&gt; t.Password).HasColumnName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">u_pwd</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        entUser.Property(m </span>=&gt; m.Id).HasColumnName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">u_id</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        entUser.HasKey(x </span>=&gt; x.Id).HasName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">PK_Userid</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å½±å­å±æ§</span>
        <strong><span style="background-color: rgba(255, 255, 0, 1)">entUser.Property&lt;DateTime?&gt;(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">LastLog</span><span style="color: rgba(128, 0, 0, 1)">"</span>).HasColumnName(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">_last_log</span><span style="color: rgba(128, 0, 0, 1)">"</span></span></strong><span style="color: rgba(0, 0, 0, 1)"><strong><span style="background-color: rgba(255, 255, 0, 1)">)</span></strong>;
    }
}</span></pre>
</div>
<p>User å®ä½æä¸ä¸ªå½±å­å±æ§ LastLogï¼è®°å½ç¨æ·ä¸ä¸æ¬¡ç»å½çæ¶é´ãå¨å®ä½ä¸­ä¸éè¦ä½¿ç¨ï¼æä¸å¸æè¢«è®¿é®çå±æ§ï¼å¨å»ºç«æ°æ®åºæ¨¡åæ¶å¯ä»¥ä½ä¸ºå½±å­å±æ§ã</p>
<p>å¨æ¥è¯¢è¡¨è¾¾å¼ä¸­å¯ä»¥ä½¿ç¨ EF.Property æ¹æ³æ¥è·åå½±å­å±æ§çå¼ï¼EF ç±»ä¸­çæ¹æ³æåé½ä¼æåºå¼å¸¸ï¼æ²¡æçæ­£å®ç°ï¼èæ¯éè¿è¡¨è¾¾å¼æ æ¥ç¿»è¯å¤çãå æ­¤ï¼å¨éæ¥è¯¢è¯­å¥ä¸­è®¿é®å½±å­å±æ§ï¼æè¦ä¿®æ¹å½±å­å±æ§å°±ä¸è½ä½¿ç¨ EF ç±»äºãå½±å­å±æ§çå¼ä¿å­å¨ Entry ä¸­ï¼å¯ä»¥ç¨ä»¥ä¸ä»£ç æ¥è®¾ç½® LastLog å±æ§çå¼ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ¥è¯¢åºå®ä½</span>
User? u = context.Users.FirstOrDefault(x =&gt; x.Name == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Teto</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
</span><span style="color: rgba(0, 0, 255, 1)">if</span> (u <span style="color: rgba(0, 0, 255, 1)">is</span> <span style="color: rgba(0, 0, 255, 1)">null</span><span style="color: rgba(0, 0, 0, 1)">)
{
    Console.WriteLine(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">ç¨æ·ä¸å­å¨</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)">;
}
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> éè¿ Entry ä¿®æ¹å½±å­å±æ§</span>
DateTime theTime =<span style="color: rgba(0, 0, 0, 1)"> DateTime.Now;
context.<strong><span style="background-color: rgba(255, 255, 0, 1)">Entry(u).Property(</span></strong></span><strong><span style="background-color: rgba(255, 255, 0, 1)"><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">LastLog</span><span style="color: rgba(128, 0, 0, 1)">"</span>).CurrentValue =</span></strong><span style="color: rgba(0, 0, 0, 1)"><strong><span style="background-color: rgba(255, 255, 0, 1)"> theTime</span></strong>;
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°è¿½è¸ªä¿¡æ¯</span>
<span style="color: rgba(0, 0, 0, 1)">Console.WriteLine(context.ChangeTracker.DebugView.LongView);
</span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æäº¤ä¿å­</span>
context.SaveChanges();</pre>
</div>
<p>ç´æ¥ä½¿ç¨ Entry ä¿®æ¹å±æ§å¼ä¼èªå¨åºç¨å®ä½çç¶æãUser å®ä½åä¸º Modeified ç¶æã</p>
<div class="cnblogs_code">
<pre>User {Id: <span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)">} <strong><span style="background-color: rgba(255, 255, 0, 1)">Modified</span></strong>
    Id: </span><span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)"> PK
    LastLog: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 128, 0, 1)">2026/2/12 18:25:01</span><span style="color: rgba(128, 0, 0, 1)">'</span> Modified Originally <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 128, 0, 1)">2026/2/12 17:41:20</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    LogName: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 128, 0, 1)">teto</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Name: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 128, 0, 1)">Teto</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">
    Password: </span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 128, 0, 1)">balabala</span><span style="color: rgba(128, 0, 0, 1)">'</span></pre>
</div>
<p>æ³éªè¯æ¯å¦æ´æ°æ°æ®åºï¼å¯ä»¥æ¥è¯¢ä¸éæ´ä¸ªè¡¨ã</p>
<div class="cnblogs_code">
<pre>using(var context =<span style="color: rgba(0, 0, 0, 1)"> new AppContext())
{
    Console.WriteLine(</span><span style="color: rgba(128, 128, 128, 1)">"</span><span style="color: rgba(128, 128, 128, 1)">\n------ ææç¨æ· ------");</span>
<span style="color: rgba(0, 0, 0, 1)">    foreach(User usr in context.Users)
    {
        Console.WriteLine($</span><span style="color: rgba(128, 128, 128, 1)">"</span><span style="color: rgba(128, 128, 128, 1)">""</span>
<span style="color: rgba(0, 0, 0, 1)">            ç¨æ·IDï¼{usr.Id}
            ç¨æ·åï¼{usr.Name}
            ä¸æ¬¡ç»å½æ¶é´ï¼{context.Entry(usr).Property(</span><span style="color: rgba(128, 128, 128, 1)">"</span><span style="color: rgba(128, 128, 128, 1)">LastLog").CurrentValue}</span>
            <span style="color: rgba(128, 128, 128, 1)">"</span><span style="color: rgba(128, 128, 128, 1)">"");</span>
        Console.Write(<span style="color: rgba(128, 128, 128, 1)">"</span><span style="color: rgba(128, 128, 128, 1)">\n");</span>
<span style="color: rgba(0, 0, 0, 1)">    }
}</span></pre>
</div>
<div class="cnblogs_code">
<pre>------ ææç¨æ· ------<span style="color: rgba(0, 0, 0, 1)">
ç¨æ·IDï¼</span><span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">
ç¨æ·åï¼Kaito
ä¸æ¬¡ç»å½æ¶é´ï¼</span><span style="color: rgba(128, 0, 128, 1)">2026</span>/<span style="color: rgba(128, 0, 128, 1)">2</span>/<span style="color: rgba(128, 0, 128, 1)">12</span> <span style="color: rgba(128, 0, 128, 1)">17</span>:<span style="color: rgba(128, 0, 128, 1)">40</span>:<span style="color: rgba(128, 0, 128, 1)">45</span><span style="color: rgba(0, 0, 0, 1)">

ç¨æ·IDï¼</span><span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">
ç¨æ·åï¼Gumi
ä¸æ¬¡ç»å½æ¶é´ï¼</span><span style="color: rgba(128, 0, 128, 1)">2026</span>/<span style="color: rgba(128, 0, 128, 1)">2</span>/<span style="color: rgba(128, 0, 128, 1)">12</span> <span style="color: rgba(128, 0, 128, 1)">17</span>:<span style="color: rgba(128, 0, 128, 1)">40</span>:<span style="color: rgba(128, 0, 128, 1)">13</span><span style="color: rgba(0, 0, 0, 1)">

ç¨æ·IDï¼</span><span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)">
ç¨æ·åï¼Teto
ä¸æ¬¡ç»å½æ¶é´ï¼</span><span style="color: rgba(128, 0, 128, 1)">2026</span>/<span style="color: rgba(128, 0, 128, 1)">2</span>/<span style="color: rgba(128, 0, 128, 1)">12</span> <span style="color: rgba(128, 0, 128, 1)">18</span>:<span style="color: rgba(128, 0, 128, 1)">25</span>:<span style="color: rgba(128, 0, 128, 1)">01</span></pre>
</div>
<p>ä¸é¢çåæ³è¦åæ¥è¯¢ä¸æ¬¡ï¼ç¶åæ´æ°ï¼å³æ°æ®åºå¾è¿ä¸¤åã99.99965% çæåµä¸ä¹æ²¡å¥å½±åçï¼èä¸å¾å¤æ¶åç¨æ·ç¼è¾æ°æ®æ¶ç¡®å®å¾åæ¥åæ¹çï¼æ¯ç«ç¼è¾çé¢ä½ å¾åæ¾ç¤ºç°æçæ°æ®ææ¹ä¾¿ç¨æ·å»ä¿®æ¹ãå¦æä½ ä¸æ³ SELECT åªæ³ç´æ¥ UPDATE ä¹å¯ä»¥çã</p>
<div class="cnblogs_code">
<pre> <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> ç´æ¥å®ä¾å
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> Id æ¯ä¸»é®ï¼å¿é¡»èµå¼ï¼æç¡®è¦æ´æ°çè®°å½</span>
 User data = <span style="color: rgba(0, 0, 255, 1)">new</span>() { <strong><span style="background-color: rgba(255, 255, 0, 1)">Id = <span style="color: rgba(128, 0, 128, 1)">2</span></span></strong><span style="color: rgba(0, 0, 0, 1)"> };
 </span><span style="color: rgba(0, 0, 255, 1)">var</span> entry =<span style="color: rgba(0, 0, 0, 1)"> context.Entry(data);
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æ è®°å®ä½çç¶æä¸ºå·²ä¿®æ¹</span>
 entry.State =<span style="color: rgba(0, 0, 0, 1)"><span style="background-color: rgba(0, 255, 0, 1)"> EntityState.Modified</span>;
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åæ¹åå®ä½çç¶æåå»æ¹åæä¸ªå±æ§çç¶æ
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å ä¸ºå¨è®¾ç½®å®ä½ä¸º Modified æ¶ä¼æææå±æ§é½è®¾ç½®ä¸º Modified
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åè®¾ç½®å®ä½åè®¾ç½®å±æ§æåå°±ä¸ä¼è¢«è¦ç</span>
 <span style="color: rgba(0, 0, 255, 1)">foreach</span> (<span style="color: rgba(0, 0, 255, 1)">var</span> p <span style="color: rgba(0, 0, 255, 1)">in</span><span style="color: rgba(0, 0, 0, 1)"> entry.Properties)
 {
     </span><span style="color: rgba(0, 0, 255, 1)">if</span> (p.Metadata.Name == <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">LastLog</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)
     {
         </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> åªä¿®æ¹è¿ä¸ªå±æ§</span>
         p.<span style="background-color: rgba(0, 255, 0, 1)">IsModified = <span style="color: rgba(0, 0, 255, 1)">true</span></span><span style="color: rgba(0, 0, 0, 1)">;
         p.CurrentValue </span>=<span style="color: rgba(0, 0, 0, 1)"> DateTime.Now;
     }
     </span><span style="color: rgba(0, 0, 255, 1)">else</span><span style="color: rgba(0, 0, 0, 1)">
     {
         </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> å¶ä»å±æ§ä¸æ¹ï¼æ è®°ä¸ºéä¿®æ¹ç¶æ</span>
         p.<span style="background-color: rgba(0, 255, 0, 1)">IsModified = <span style="color: rgba(0, 0, 255, 1)">false</span></span><span style="color: rgba(0, 0, 0, 1)">;
     }
 }

 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æå°è¿½è¸ªä¿¡æ¯</span>
<span style="color: rgba(0, 0, 0, 1)"> Console.WriteLine(context.ChangeTracker.DebugView.LongView);
 </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)"> æäº¤ä¿å­</span>
 context.SaveChanges();</pre>
</div>
<p>å¨æ¹åå®ä½ç¶ææ¶ï¼åè®¾ç½®æ´ä¸ªå®ä½ä¸º Modifiedï¼æ­¤æ¶ç±äºæ²¡æåå§å¿«ç§åæ¯è¾ï¼å®ä½çææå±æ§ï¼ä¸å«ä¸»é®ï¼é½è¢«æ è®°ä¸º Modifiedï¼å¦æè¿æ ·æ´æ°æ°æ®åºçè¯ï¼ä¼æ NameãLogNameãPassword ç­å±æ§é½æ´æ¹ä¸º null äºãæä»¥ï¼å±ä»¬å¨è®¾ç½®å®ä½ä¸º Modified åï¼è¿è¦å¯¹åä¸ªå±æ§ååæèãç¨ foreach æä¸¾åä¸ªå±æ§ï¼åªæ LastLog å±æ§æè®¾ç½®ä¸º Modifiedï¼å¶ä»çå±æ§è®¾ç½®ä¸ºæªæ´æ¹ï¼è¿æ ·åéå°æ°æ®åºç UPDATE è¯­å¥åªä¼ SET LastLog å±æ§ã</p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1)">UPDATE</span> "Users" <span style="color: rgba(0, 0, 255, 1)">SET</span> "_last_log" <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(0, 128, 0, 1)">@p0</span>
<span style="color: rgba(0, 0, 255, 1)">WHERE</span> "u_id" <span style="color: rgba(128, 128, 128, 1)">=</span> <span style="color: rgba(0, 128, 0, 1)">@p1</span><span style="color: rgba(0, 0, 0, 1)">
RETURNING </span><span style="color: rgba(128, 0, 0, 1); font-weight: bold">1</span>;</pre>
</div>
<p>ç±äºå±ä»¬è¦æ´æ°çæ¯å½±å­å±æ§ï¼ä¸è½ä½¿ç¨ ExecuteUpdate è¿æ ·çä¾¿æ·æ¹æ³ã</p>
<p>æ¬æå°æ­¤ç»æã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-12 22:23">2026-02-12 22:23</span>&nbsp;
<a href="https://www.cnblogs.com/tcjiaan">ä¸éªç¬å­¤</a>&nbsp;
éè¯»(<span id="post_view_count">38</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19601119);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19601119', targetLink: 'https://www.cnblogs.com/tcjiaan/p/19601119', title: 'ãEF Coreãå®ä½è¿½è¸ªââEntryä¸­è®°å½çæ°æ®' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ AiReaderï¼ä¸ä¸ªä¸èç½ç AI éè¯»å©æï¼è®©ä½ çç®åä¸ºä½ æå¡ ]]></title>
    <link>https://www.cnblogs.com/lissajous/p/19608767</link>
    <guid>def34a5dbaf8b9751b2fd62704585566</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lissajous/p/19608767" title="åå¸äº 2026-02-12 15:54">
    <span role="heading" aria-level="2">AiReaderï¼ä¸ä¸ªä¸èç½ç AI éè¯»å©æï¼è®©ä½ çç®åä¸ºä½ æå¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3618712/202602/3618712-20260212155315495-120542706.png" alt="AiReaderï¼ä¸ä¸ªä¸èç½ç AI éè¯»å©æï¼è®©ä½ çç®åä¸ºä½ æå¡" class="desc_img">
        AiReader ï¼ä¸ä¸ªåç½® AI çæ¡é¢éè¯»å¨ï¼ææ AI æ¨çé½å¨ä½ æ¬å°ç CPU/GPU ä¸è¿è¡ã
ä¸éè¦èç½ï¼ä¸éè¦æ³¨åï¼ä¸éè¦ API Keyãå®è£åé¦æ¬¡éç½®ä¸è½½ä¸ä¸ª AI æ¨¡åï¼å ç¾ MB å°å  GBï¼ï¼ä¹åææç½çº¿ä¹è½ç¨ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="ä½ çææ¡£æ­£å¨è¢«è°éè¯»">ä½ çææ¡£ï¼æ­£å¨è¢«è°éè¯»ï¼</h2>
<p>æ¯æ¬¡ä½ æä¸ç¯è®ºææè¿å¨çº¿ç¿»è¯å·¥å·ï¼æ¯æ¬¡ä½ è®© AI å¸®ä½ è§£è¯»ä¸ä»½ååââä½ çææ¡£é½è¢«ä¸ä¼ å°äºæå®¶å¬å¸çæå¡å¨ä¸ã</p>
<p>ä¹è®¸ä½ è§å¾æ æè°ãä½å¦ææä¸ç§æ¹å¼ï¼<strong>AI ä¸æ ·å¥½ç¨ï¼ä½ææ¡£æ°¸è¿ä¸ç¦»å¼ä½ ççµèå¢ï¼</strong></p>
<p>è¿å°±æ¯ AiReader å¨åçäºã</p>
<hr>
<h2 id="aireader-æ¯ä»ä¹">AiReader æ¯ä»ä¹</h2>
<p>ä¸å¥è¯ï¼<strong>ä¸ä¸ªåç½® AI çæ¡é¢éè¯»å¨ï¼ææ AI æ¨çé½å¨ä½ æ¬å°ç CPU/GPU ä¸è¿è¡ã</strong></p>
<p>ä¸éè¦èç½ï¼ä¸éè¦æ³¨åï¼ä¸éè¦ API Keyãå®è£åé¦æ¬¡éç½®ä¸è½½ä¸ä¸ª AI æ¨¡åï¼å ç¾ MB å°å  GBï¼ï¼ä¹åææç½çº¿ä¹è½ç¨ã</p>
<p>å®æ¯æéè¯» <strong>PDFãEPUBãMarkdownãTXT</strong> åç§æ ¼å¼ï¼åç½®ä»¥ä¸ AI è½åï¼</p>
<hr>
<h3 id="-éä¸­å³è¯">ð éä¸­å³è¯</h3>
<p>å¨ææ¡£ä¸­éä¸­ä»»ææå­ï¼AI ç«å³ç¿»è¯ãæ¯æä¸ç§æ¨¡å¼ï¼</p>
<ul>
<li><strong>ç´è¯</strong>ï¼ä¿çåæç»æ</li>
<li><strong>æè¯</strong>ï¼æ´èªç¶çç®æ è¯­è¨è¡¨è¾¾</li>
<li><strong>ç½è¯</strong>ï¼ç¨æç®åçè¯è§£é</li>
</ul>
<p>èªå¨è¯å«ä¸­è±ææ¹åãä¸æ¯éè¯æºç¿»ï¼æ¯çè§£ä¸ä¸æåçç¿»è¯ã</p>
<h3 id="-ææ³è§£é">ð ææ³è§£é</h3>
<p>éä¸­ä¸ä¸ªå¤æå¥å­ï¼AI æè§£å¥å­ç»æï¼ä¸»è°å®¾ãä»å¥å³ç³»ãå³é®è¯æ±ç¨æ³ã</p>
<p>æ¯èµ·ç¿»è¯ï¼è¿ææ¯çæ­£å¸®ä½ ãè¯»æãä¸é¨è¯­è¨çå·¥å·ã</p>
<h3 id="-ä¸ä¸æå¯¹è¯">ð¬ ä¸ä¸æå¯¹è¯</h3>
<p>éä¸­ä¸æ®µåå®¹ï¼ç¶ååå ChatGPT ä¸æ ·è¿½é®ãå¯ä»¥éå®ä¸ä¸æåå¤æ·±å¥ï¼å¯¹è¯åå²æææ¡£èªå¨ä¿å­ã</p>
<h3 id="-æºè½ç¬è®°">ð æºè½ç¬è®°</h3>
<p>ç¿»è¯ãè§£éãå¯¹è¯åå®¹é½å¯ä»¥ä¸é®ä¿å­ä¸ºç¬è®°ãç¬è®°å³èææ¡£ï¼æ¯æ Markdown å¯¼åºã</p>
<h3 id="-ç¦»çº¿è¯å¸">ð ç¦»çº¿è¯å¸</h3>
<p>åç½® ECDICTï¼è±æ±ï¼+ CC-CEDICTï¼æ±è±ï¼ï¼åå»ä»»æåè¯å¼¹çªæ¥è¯ï¼æ éèç½ã</p>
<p><img alt="select-translate" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3618712/202602/3618712-20260212155150719-1656383886.png" class="lazyload"></p>
<hr>
<h2 id="å®å­ä»ä¹è½å¨æ¬å°è·-ai">å®å­ä»ä¹è½å¨æ¬å°è· AIï¼</h2>
<p>åºå±ç¨çæ¯ <strong>llama.cpp</strong> ââ ç®åææççå¼æºæ¬å°å¤§æ¨¡åæ¨çå¼æï¼è¢«å¨çæ°ç¾ä¸å¼åèä½¿ç¨ãåç½®çæ¨¡åæ¯ <strong>Qwen3 ç³»å</strong>ï¼éä¹åé®ï¼ï¼ä» 0.6B å° 32B åæ°éé½æã</p>
<p>å¨ä¸åç¡¬ä»¶ä¸çè¡¨ç°ï¼</p>
<table>
<thead>
<tr>
<th style="text-align: left">ä½ çç¡¬ä»¶</th>
<th style="text-align: left">è½è·ä»ä¹</th>
<th style="text-align: left">ä½éª</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">æ¸¸æç¬è®°æ¬ï¼RTX 3060+ï¼</td>
<td style="text-align: left">8B æ¨¡å</td>
<td style="text-align: left">å ChatGPT ä¸æ ·æµç</td>
</tr>
<tr>
<td style="text-align: left">æ®éç¬è®°æ¬ï¼æ ç¬æ¾ï¼</td>
<td style="text-align: left">1.7B-4B æ¨¡å</td>
<td style="text-align: left">æµçï¼ç¿»è¯è´¨éå¤ç¨</td>
</tr>
<tr>
<td style="text-align: left">åå¬çµè</td>
<td style="text-align: left">0.6B æ¨¡å</td>
<td style="text-align: left">å¯ç¨ï¼ç®åç¿»è¯æ²¡é®é¢</td>
</tr>
<tr>
<td style="text-align: left">Mac M ç³»åè¯ç</td>
<td style="text-align: left">4B-8B æ¨¡å</td>
<td style="text-align: left">Metal å éï¼éå¸¸æµç</td>
</tr>
</tbody>
</table>
<p><strong>ä½ ä¸éè¦äºè§£è¿äºç»èã</strong> é¦æ¬¡å¯å¨æ¶ï¼åºç¨ä¼èªå¨æ£æµä½ çç¡¬ä»¶ãè·åºåæµè¯ãæ¨èæåéçæ¨¡åï¼å¨ç¨ä¸é®å®æã</p>
<hr>
<h2 id="ä¸ä¸ªå¹³å°é½è½ç¨">ä¸ä¸ªå¹³å°é½è½ç¨</h2>
<table>
<thead>
<tr>
<th style="text-align: left">å¹³å°</th>
<th style="text-align: left">GPU å é</th>
<th style="text-align: left">å®è£å</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>Windows</strong> x64</td>
<td style="text-align: left">NVIDIA (CUDA) Â· AMD/Intel (Vulkan)</td>
<td style="text-align: left"><code>.exe</code> å®è£å</td>
</tr>
<tr>
<td style="text-align: left"><strong>macOS</strong> ARM / Intel</td>
<td style="text-align: left">Metal</td>
<td style="text-align: left"><code>.dmg</code></td>
</tr>
<tr>
<td style="text-align: left"><strong>Linux</strong> x64</td>
<td style="text-align: left">Vulkan</td>
<td style="text-align: left"><code>.AppImage</code> / <code>.deb</code></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="å®å¨åè´¹å®å¨å¼æº">å®å¨åè´¹ï¼å®å¨å¼æº</h2>
<ul>
<li><strong>MIT åè®®</strong>ï¼ä½ å¯ä»¥èªç±ä½¿ç¨ãä¿®æ¹ãåå</li>
<li><strong>æ ä»è´¹ç</strong>ï¼ææåè½åè´¹</li>
<li><strong>æ å¹¿å</strong>ï¼æ²¡æä»»ä½å¹¿ååæ¨å¹¿</li>
<li><strong>æ æ°æ®æ¶é</strong>ï¼ä¸æ¶éä»»ä½ç¨æ·æ°æ®</li>
<li><strong>ä»£ç å¬å¼</strong>ï¼æ¯ä¸è¡ä»£ç é½å¨ GitHub ä¸ï¼æ¬¢è¿å®¡æ¥</li>
</ul>
<hr>
<h2 id="è°éåç¨">è°éåç¨</h2>
<ul>
<li>ð ç»å¸¸éè¯»è±æè®ºæãææ¯ææ¡£ãå¤æä¹¦ç±çäºº</li>
<li>ð å¤çæææä»¶ï¼åä¸ååãåé¨æ¥åãæªåè¡¨ç ç©¶ï¼ä¸æ³ä¸ä¼ äºç«¯çäºº</li>
<li>ð æ­£å¨å­¦å¤è¯­ï¼éè¦ææ³æè§£èä¸åªæ¯ç¿»è¯çå­¦ç</li>
<li>ð¥ï¸ æ³ä½éªæ¬å°å¤§æ¨¡åä½ä¸ç¥éä»åªéå¼å§çææ¯ç±å¥½è</li>
<li>ð¡ ä¿¡å¥"æçæ°æ®æåä¸»"çäºº</li>
</ul>
<hr>
<h2 id="æä¹è·å">æä¹è·å</h2>
<h3 id="ä¸è½½">ä¸è½½</h3>
<p>GitHub Releases é¡µé¢ä¸è½½å¯¹åºå¹³å°å®è£åï¼</p>
<p>ð <strong><a href="https://github.com/LissajousX/aireader/releases" target="_blank" rel="noopener nofollow">https://github.com/LissajousX/aireader/releases</a></strong></p>
<h3 id="å®è£">å®è£</h3>
<ul>
<li><strong>Windows</strong>ï¼åå» <code>.exe</code> å®è£åï¼ä¸è·¯ä¸ä¸æ­¥</li>
<li><strong>macOS</strong>ï¼æå¼ <code>.dmg</code>ï¼æå¥åºç¨ç¨åºæä»¶å¤¹
<blockquote>
<p>â ï¸ macOS çæ¬ææªå®æ Apple ç­¾åè®¤è¯ï¼é¦æ¬¡æå¼éè¦ï¼å³é®ç¹å» App â éæ©ãæå¼ãâ ç¡®è®¤ãæå¨ç»ç«¯æ§è¡ <code>xattr -cr /Applications/Aireader.app</code></p>
</blockquote>
</li>
<li><strong>Linux</strong>ï¼è¿è¡ <code>.AppImage</code> æå®è£ <code>.deb</code> å</li>
</ul>
<h3 id="é¦æ¬¡ä½¿ç¨">é¦æ¬¡ä½¿ç¨</h3>
<p>å¯å¨åè·éå¼å¯¼åå¯¼ï¼éæ©è¯­è¨ â è®¾ç½®å­å¨è·¯å¾ â ä¸é®éç½® AI â å¼å§éè¯»ã</p>
<p>æ´ä¸ªè¿ç¨ 3-5 åéï¼ä¸»è¦æ¯ä¸è½½æ¨¡åçæ¶é´ï¼ã</p>
<hr>
<h2 id="ä¸äºä½ å¯è½ä¼é®çé®é¢">ä¸äºä½ å¯è½ä¼é®çé®é¢</h2>
<p><strong>Q: ç¿»è¯è´¨éåå¨çº¿å·¥å·æ¯æä¹æ ·ï¼</strong><br>
A: 4B ä»¥ä¸çæ¨¡åï¼æ¥å¸¸ç¿»è¯è´¨éæ¥è¿ GPT-3.5 æ°´å¹³ã8B æ¨¡åå¨å¤§å¤æ°åºæ¯ä¸å GPT-4 å·®è·ä¸å¤§ãä¸ä¸æ¯è¯­å¯éçåºæ¯ï¼å¦å»å­¦ãæ³å¾ï¼ï¼å»ºè®®ç¨æ´å¤§çæ¨¡åææ¥å¥äºç«¯ APIã</p>
<p><strong>Q: åªè½ç¨åç½®æ¨¡ååï¼</strong><br>
A: ä¸æ¯ãä½ ä¹å¯ä»¥è¿æ¥ Ollamaï¼æ¬å°è·æ´å¤§çæ¨¡åï¼æä»»ä½ OpenAI å¼å®¹ç APIï¼å¦ DeepSeekï¼ã</p>
<p><strong>Q: çµèéç½®ä¸å¤æä¹åï¼</strong><br>
A: æä½ 4GB åå­ + ä»»æ CPU å°±è½è· 0.6B æ¨¡åãå¦æè§å¾è´¨éä¸å¤ï¼å¯ä»¥æ¥ Ollama æäºç«¯ API ä½ä¸ºè¡¥åã</p>
<p><strong>Q: æ¯æä¸­æææ¡£åï¼</strong><br>
A: æ¯æãQwen3 æ¨¡åæ¬èº«å°±æé¿ä¸­è±åè¯­ãçé¢ä¹æ¯æä¸­è±æåæ¢ã</p>
<p><strong>Q: å®å¨åï¼ä»£ç å¯ä¿¡åï¼</strong><br>
A: MIT å¼æºï¼å¨é¨ä»£ç å¬å¼ãä½ å¯ä»¥èªå·±å®¡æ¥ï¼ä¹å¯ä»¥èªå·±ç¼è¯ãæ²¡ææ··æ·ï¼æ²¡æåé¨ã</p>
<hr>
<h2 id="è®©ä½ çç®åä¸ºä½ æå¡">è®©ä½ çç®åä¸ºä½ æå¡</h2>
<p>ä½ ççµèéæä¸é¢å¼ºå¤§çå¤çå¨ï¼å¯è½è¿æä¸åä¸ä¾¿å®çæ¾å¡ãå¤§å¤æ°æ¶åï¼å®ä»¬é½å¨é²çã</p>
<p>AiReader è®©è¿äºç®ååå®ä»¬ææé¿çäºï¼<strong>å¸®ä½ éè¯»ãç¿»è¯ãçè§£ãæèã</strong></p>
<p>èä¸ï¼å®å¨å¨ä½ èªå·±ççµèä¸ã</p>
<hr>
<p><strong>ð GitHub: <a href="https://github.com/LissajousX/aireader" target="_blank" rel="noopener nofollow">https://github.com/LissajousX/aireader</a></strong></p>
<p>å¦æè§å¾æç¨ï¼ä¸ä¸ª â­ Star å°±æ¯æå¥½çæ¯æã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-12 15:55">2026-02-12 15:54</span>&nbsp;
<a href="https://www.cnblogs.com/lissajous">æè¨å¦</a>&nbsp;
éè¯»(<span id="post_view_count">245</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19608767);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19608767', targetLink: 'https://www.cnblogs.com/lissajous/p/19608767', title: 'AiReaderï¼ä¸ä¸ªä¸èç½ç AI éè¯»å©æï¼è®©ä½ çç®åä¸ºä½ æå¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ AI ç»å¾å¨å®¶æ¡¶æ¥äºï¼è¿åæ³èªå·±æç»å¾é½é¾äº ]]></title>
    <link>https://www.cnblogs.com/chengxy-nds/p/19610998</link>
    <guid>ee1c31a5d9c3d134d1c6b8d5682a0597</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/chengxy-nds/p/19610998" title="åå¸äº 2026-02-13 09:48">
    <span role="heading" aria-level="2">AI ç»å¾å¨å®¶æ¡¶æ¥äºï¼è¿åæ³èªå·±æç»å¾é½é¾äº</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p><strong>å¤§å®¶å¥½ï¼ææ¯å°å¯ï½</strong></p>
<p>åå å¤©æä¸æ¯åäº«äºå¦ä½é¶ææ¬æ­å»º <strong>next-ai-draw-io</strong>ï¼æå¤§å®¶ç¨ AI çæ draw.io é£æ ¼çæ¶æå¾ãåå°ååè¿ä¸éï¼çæ¥å¤§å®¶å¯¹æç»æ¶æå¾ççæ¯è¦ä¹ä¹ç£ã</p>
<p><img src="http://fire-blog.oss-cn-beijing.aliyuncs.com/20251229-160034.gif" alt="" loading="lazy"></p>
<p>ä½å¨æ¥å¸¸åæç« æ¶ï¼æåç°å¾å¤è¯»èæ´åç±é£ç§æç»æåè¶³ç <strong>Excalidraw</strong> é£æ ¼ï¼å°±æ¯ä¸é¢è¿ç§ï¼é¼æ ¼é«ãè§è§ç¾ï¼è½è®©æç« ç¬é´æ¾å¾é«çº§èµ·æ¥ï¼</p>
<p><img src="http://fire-blog.oss-cn-beijing.aliyuncs.com//images/20260203151400.png" alt="" loading="lazy"></p>
<p>æåæ¬å¨ç¢ç£¨ï¼è½ä¸è½ç¨ Gemini Pro ç»èªå·±æä¸ä¸ª AI ç»å¾æ´åå¹³å°ï¼æ draw.io å Excalidraw å¨æè¿å»ã</p>
<p>ç»æå» GitHub ä¸æï¼å¥½å®¶ä¼ï¼å·²ç»æå¤§ä½¬æææ³åçç»åäºï¼è¿ä¸ªå¼æºé¡¹ç®ç®ç´æ¯ä¸ºæè¿ç§æçåä¸»éèº«å®å¶çï¼<strong>Mermaidãdraw.ioãExcalidraw</strong> ä¸å¤§ççé£æ ¼å¨é¨æ¯æã</p>
<p>åå¤´åççä»¥åä¸ºäºç»ä¸ªåçå¾ç¬å¤çæ ·å­ï¼ççæè§æ¯å¨æµªè´¹çå½åï¼</p>
<h4 id="ai-draw-nexus-ai-ç»å¾å¨å®¶æ¡¶">AI Draw Nexus AI ç»å¾å¨å®¶æ¡¶</h4>
<p><strong>GitHub å°å</strong>ï¼<code>https://github.com/hkxiaoyao/ai-draw-nexus</code></p>
<p><strong>å¨çº¿ä½éª</strong>ï¼<code>https://ai-draw-nexus.aizhi.site/</code></p>
<p>ææ¨ä¸ªè¯äºä¸éï¼å¤§å®¶æåä¸è¿è¾åºè´¨éï¼</p>
<p><strong>1. Excalidraw é£æ ¼</strong></p>
<p>è¾å¥: HTTP é¿è½®è¯¢åçå¾ï¼çæçé»è¾çº¿æ¡æ¸æ°ï¼æç»è´¨æçæ£ã</p>
<p><img src="http://fire-blog.oss-cn-beijing.aliyuncs.com//images/20260203152428.png" alt="" loading="lazy"></p>
<p><strong>2. Draw.io é£æ ¼</strong></p>
<p>æä¹åå¾å¤çç³»ç»æ¶æãæµç¨å¾é½æ¯è¿ä¸ªé£æ ¼ï¼ç°å¨ AI å æççå¤ªæ¹ä¾¿äºã</p>
<p><img src="http://fire-blog.oss-cn-beijing.aliyuncs.com//images/20260203153031.png" alt="" loading="lazy"></p>
<p><strong>3. Mermaid é£æ ¼</strong></p>
<p>å Markdown å°±æ´ç®åäºä¸ç§åºå¾ã</p>
<p><img src="http://fire-blog.oss-cn-beijing.aliyuncs.com//images/20260203153451.png" alt="" loading="lazy"></p>
<p>è¿ä¸æ¯åè½éå²çï¼èæ¯å¨éçï¼å¯ä»¥å¨ AI çæçåºç¡ä¸ï¼ç´æ¥æå¨å¾®è°ã</p>
<h4 id="å¿«éä¸æ">å¿«éä¸æ</h4>
<p>å¦æä½ æ³æ¬å°è¿è¡ï¼è¿ä¸ªåºäº Next.js çåç«¯é¡¹ç®å®è£èµ·æ¥ä¹éå¸¸ç®åï¼</p>
<pre><code class="language-shell"># 1. åéé¡¹ç®
git clone https://github.com/hkxiaoyao/ai-draw-nexus
cd ai-draw-nexus

# 2. å®è£ä¾èµ (æ¨èç¨ pnpm)
pnpm install

# 3. å¼å¯çäº§åå¤§é¨
pnpm dev
</code></pre>
<p>ä¸è¿ï¼ç®åçå¨çº¿çæ¬æ¯å¤©æ 10 æ¬¡åè´¹éé¢ï¼è¿ä¹å¾æ­£å¸¸æ¯ç« API çº¿ä¸çè´¹ç¨ç¡®å®è´µï¼ä¸æ¬¡æé£ä¸ªåè´¹å·¥å·è¢«å¤§å®¶ä¸¤å¤©å°±ç¨æ¬ è´¹äºï¼åå ðï¼ã</p>
<p><img src="http://fire-blog.oss-cn-beijing.aliyuncs.com//images/20260203152800.png" alt="" loading="lazy"></p>
<p>ç°å¨ä»æ¯æ <strong>OpenAI</strong> å <strong>Anthropic</strong> ä¸¤å¤§æ¨¡åãå¦æä½ æèªå·±ç Keyï¼å»ºè®®æ¬å°æ­ä¸ä¸ªï¼é£ææ¯çæ­£çç»å¾èªç±ï¼</p>
<p>å¥½äºï¼ä¸æè§ï½</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 09:48">2026-02-13 09:48</span>&nbsp;
<a href="https://www.cnblogs.com/chengxy-nds">ç¨åºåå°å¯</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19610998);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19610998', targetLink: 'https://www.cnblogs.com/chengxy-nds/p/19610998', title: 'AI ç»å¾å¨å®¶æ¡¶æ¥äºï¼è¿åæ³èªå·±æç»å¾é½é¾äº' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸æ¬¾Goè¯­è¨Ginæ¡æ¶DDDèææ¶ï¼éåå¿«éæ­å»ºé¡¹ç® ]]></title>
    <link>https://www.cnblogs.com/letjs/p/19610915</link>
    <guid>f19137d637f8433bec18d1d3b9522b61</guid>
    <description>
    <![CDATA[ 
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/letjs/p/19610915" title="åå¸äº 2026-02-13 09:19">
    <span role="heading" aria-level="2">ä¸æ¬¾Goè¯­è¨Ginæ¡æ¶DDDèææ¶ï¼éåå¿«éæ­å»ºé¡¹ç®</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ä¸æ¬¾goè¯­è¨ginæ¡æ¶dddèææ¶éåå¿«éæ­å»ºé¡¹ç®">ä¸æ¬¾Goè¯­è¨Ginæ¡æ¶DDDèææ¶ï¼éåå¿«éæ­å»ºé¡¹ç®</h1>
<blockquote>
<p>ä¸ä¸ªå¼ç®±å³ç¨ç DDDï¼é¢åé©±å¨è®¾è®¡ï¼Go èææ¶ï¼åºäº Gin + RocketMQï¼åå«åæ°æ®åºãç»ä¸ååºãä¸­é´ä»¶ä¸äºä»¶é©±å¨ç¤ºä¾ã</p>
</blockquote>
<h2 id="è¿æ¯ä»ä¹">è¿æ¯ä»ä¹</h2>
<p>Gin-Framework-DDD æ¯ä¸ä¸ªé¢å Go è¯­è¨ç DDD å·¥ç¨èææ¶ï¼å¸®ä½ å¿«éæ­å»ºç¬¦å DDD åå±è§èç Web æå¡ãé¡¹ç®åç½®ç¨æ·ä¸è®¢åç¤ºä¾ãé¢åäºä»¶ä¸ RocketMQ çäº§/æ¶è´¹ãé®ä»¶éç¥ç¤ºä¾ãç»ä¸ååºä¸ä¸­é´ä»¶ï¼éåä½ä¸ºå¢éå·¥ç¨æ¨¡æ¿ææå­¦ç¤ºä¾ã</p>
<h2 id="ä¸ºä»ä¹è¦ç¨ddd">ä¸ºä»ä¹è¦ç¨DDDï¼</h2>
<p>å¾å¤äººè®¤ä¸º Go è¯­è¨æ²¡å¿è¦ç¨ DDDï¼æ¯ç«å®å PythonãJS ä¸æ ·è½»å·§çµæ´»ï¼ç¨ MVC å°±è¶³å¤äºãç¡®å®ï¼å¤§å¤æ°åºæ¯ä¸ MVC å®å¨å¤ç¨ãå·¥ç¨åæ éæ¯ææ¥å£å¤çãä¸å¡é»è¾ãæ°æ®å¤çåºåå¼ï¼è®©åé¨ååå¸å¶èï¼æ¹ä¾¿ç»´æ¤åæ©å±ãDDD ç¸å¯¹æ´éåä¸­å¤§åé¡¹ç®ï¼å¦æé¡¹ç®æå åä¸ªæ¨¡åãä¸ç¾ä¸ªæ¥å£ï¼ç¨ DDD è®¾è®¡ä¼æ´åéï¼æ¨¡åå°ãæ¥å£ä¸å¤çè¯ï¼ç®ååå±å°±å¤äºã</p>
<p>æ»ä¹ï¼æ¯å¦éç¨ DDD åè¯­è¨æ å³ï¼åªè·ä¸å¡è§æ¨¡æå³ãä¸ä¸ªä¸è¥¿åå¤æäºï¼å°±éè¦ç¨ä¸äºæºå¶å»è§èå®ï¼æè½æ´å¥½ææ§ã</p>
<p>æºç å°åï¼<a href="https://github.com/microwind/design-patterns/tree/main/practice-projects/gin-ddd" target="_blank" rel="noopener nofollow">https://github.com/microwind/design-patterns/tree/main/practice-projects/gin-ddd</a></p>
<p>é¡¹ç®ç®å½ï¼<code>gin-ddd/</code></p>
<h2 id="æ ¸å¿ç¹ç¹">æ ¸å¿ç¹ç¹</h2>
<ul>
<li>ä¸¥æ ¼ DDD åå±æ¶æï¼é¢åå±ãåºç¨å±ãåºç¡è®¾æ½å±ãæ¥å£å±</li>
<li>Gin Web æ¡æ¶ï¼é«æ§è½ HTTP æå¡</li>
<li>äºä»¶é©±å¨ï¼é¢åäºä»¶ + RocketMQ çäº§è/æ¶è´¹è</li>
<li>åæ°æ®åºæ¯æï¼ç¨æ·åº + è®¢ååºå¯ç¬ç«éç½®ï¼é»è®¤ MySQL + PostgreSQLï¼</li>
<li>ç»ä¸ååºæ ¼å¼ï¼Response å°è£ï¼éè¯¯ç éä¸­ç®¡ç</li>
<li>å¨å±ä¸­é´ä»¶ï¼æ¥å¿ãæ¢å¤ãè·¨å</li>
<li>å¯éé®ä»¶éç¥ï¼è®¢ååå»ºäºä»¶é©±å¨ SMTP é®ä»¶åé</li>
</ul>
<h2 id="ææ¯æ ">ææ¯æ </h2>
<table>
<thead>
<tr>
<th>ææ¯</th>
<th>çæ¬</th>
<th>è¯´æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>Go</td>
<td>1.21+</td>
<td>è¯­è¨çæ¬</td>
</tr>
<tr>
<td>Gin</td>
<td>1.9+</td>
<td>HTTP æ¡æ¶</td>
</tr>
<tr>
<td>RocketMQ</td>
<td>5.3+</td>
<td>äºä»¶æ¶æ¯éå</td>
</tr>
<tr>
<td>MySQL</td>
<td>8.0+</td>
<td>ç¨æ·åºé»è®¤</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>14+</td>
<td>è®¢ååºé»è®¤</td>
</tr>
<tr>
<td>YAML</td>
<td>-</td>
<td>éç½®æä»¶æ ¼å¼</td>
</tr>
</tbody>
</table>
<h2 id="å·¥ç¨ç»æ">å·¥ç¨ç»æ</h2>
<h3 id="å·¥ç¨ç»æå¾">å·¥ç¨ç»æå¾</h3>
<div class="mermaid">flowchart TB
    subgraph æ¥å£å±
        Handler[HTTP Handler / è·¯ç±]
    end

    subgraph åºç¨å±
        AppService[åºç¨æå¡]
    end

    subgraph é¢åå±
        DomainService[é¢åæå¡]
        Model[èåæ ¹/å®ä½]
        RepoInterface[ä»å¨æ¥å£]
        NotificationInterface[éç¥æ¥å£]
    end

    subgraph åºç¡è®¾æ½å±
        RepoImpl[ä»å¨å®ç°]
        Mail[é®ä»¶æå¡]
        MQ[æ¶æ¯éå]
        DB[(æ°æ®åº)]
    end

    Handler --&gt; AppService
    AppService --&gt; DomainService
    AppService --&gt; RepoInterface
    DomainService --&gt; Model
    DomainService --&gt; NotificationInterface
    RepoInterface -.å®ç°.-&gt; RepoImpl
    NotificationInterface -.å®ç°.-&gt; Mail
    RepoImpl --&gt; DB
    AppService -.åå¸äºä»¶.-&gt; MQ
</div><h3 id="å·¥ç¨ç»æåè¡¨">å·¥ç¨ç»æåè¡¨</h3>
<pre><code>gin-ddd/
âââ cmd/server/main.go                            # å¯å¨å¥å£ï¼è£éåå±å¹¶å¯å¨ HTTP + MQ
âââ config/config.yaml                            # åºç¨éç½®
âââ docs/init.sql                                 # MySQL åå§åèæ¬ï¼ç¤ºä¾ï¼
âââ internal/
â   âââ domain/                                   # é¢åå±
â   â   âââ model/
â   â   â   âââ order/order.go                    # è®¢åèåæ ¹
â   â   â   âââ user/user.go                      # ç¨æ·èåæ ¹
â   â   âââ repository/                           # ä»å¨æ¥å£
â   â   â   âââ order/order_repository.go
â   â   â   âââ user/user_repository.go
â   â   âââ event/                                # é¢åäºä»¶
â   â   â   âââ domain_event.go
â   â   â   âââ order_event.go
â   â   â   âââ user_event.go
â   â   â   âââ event_publisher.go
â   â   âââ notification/mail_service.go          # éç¥é¢åæ¥å£ï¼é®ä»¶ï¼
â   â   âââ service/                              # é¢åæå¡ï¼é¢çï¼
â   âââ application/                              # åºç¨å±
â   â   âââ dto/
â   â   â   âââ order/order_dto.go
â   â   â   âââ user/user_dto.go
â   â   âââ service/
â   â       âââ order/order_service.go            # è®¢ååºç¨æå¡ï¼åå¸äºä»¶ï¼
â   â       âââ user/user_service.go              # ç¨æ·åºç¨æå¡
â   âââ infrastructure/                           # åºç¡è®¾æ½å±
â   â   âââ config/                               # éç½®ä¸ DB åå§å
â   â   âââ persistence/                          # ä»å¨å®ç°
â   â   â   âââ order/order_repository_impl.go
â   â   â   âââ user/user_repository_impl.go
â   â   âââ mq/                                   # RocketMQ å®ç°
â   â   â   âââ rocketmq_producer.go
â   â   â   âââ rocketmq_consumer.go
â   â   âââ mail/                                 # SMTP é®ä»¶å®ç°
â   â   âââ middleware/                           # Gin ä¸­é´ä»¶
â   â   âââ common/response.go                    # ç»ä¸ååº
â   â   âââ constants/error_code.go               # éè¯¯ç 
â   âââ interfaces/                               # æ¥å£å±
â       âââ handler/                              # HTTP å¤çå¨
â       âââ router/                               # è·¯ç±éç½®
â       âââ vo/                                   # è¯·æ±/ååºå¯¹è±¡
âââ pkg/utils/                                    # æ¥å¿ç­å·¥å·
</code></pre>
<h2 id="åå±èè´£è¯´æ">åå±èè´£è¯´æ</h2>
<table>
<thead>
<tr>
<th>å±çº§</th>
<th>ä½ç½®</th>
<th>èè´£</th>
<th>å³é®åå</th>
</tr>
</thead>
<tbody>
<tr>
<td>é¢åå±</td>
<td><code>internal/domain/</code></td>
<td>é¢åæ¨¡åãè§åä¸äºä»¶</td>
<td>ä¸ä¾èµæ¡æ¶ãä¸å¡é»è¾åè</td>
</tr>
<tr>
<td>åºç¨å±</td>
<td><code>internal/application/</code></td>
<td>ç¼æé¢åå¯¹è±¡ãäºå¡è¾¹ç</td>
<td>èèæ¸æ°ï¼ä¸å®ç°ä¸å¡è§å</td>
</tr>
<tr>
<td>åºç¡è®¾æ½å±</td>
<td><code>internal/infrastructure/</code></td>
<td>DBãMQãé®ä»¶ç­ææ¯ç»è</td>
<td>åä¸æä¾å®ç°ï¼ç»èä¸æ²</td>
</tr>
<tr>
<td>æ¥å£å±</td>
<td><code>internal/interfaces/</code></td>
<td>HTTP è¯·æ±/ååºä¸è·¯ç±</td>
<td>å¤çå¤é¨äº¤äºï¼ä¸å«ä¸å¡è§å</td>
</tr>
</tbody>
</table>
<h2 id="å¿«éå¼å§">å¿«éå¼å§</h2>
<h3 id="1-ç¯å¢åå¤">1. ç¯å¢åå¤</h3>
<ul>
<li>Go 1.21+</li>
<li>MySQL 8.0+ ä¸ PostgreSQL 14+ï¼æèªè¡éæ©å¶ä¸ï¼</li>
<li>RocketMQ 5.3+ï¼å¯éï¼</li>
</ul>
<h3 id="2-åå§åæ°æ®åº">2. åå§åæ°æ®åº</h3>
<p>é»è®¤éç½®ä½¿ç¨åæ°æ®åºï¼</p>
<ul>
<li>ç¨æ·åºï¼MySQL</li>
<li>è®¢ååºï¼PostgreSQL</li>
</ul>
<p>MySQL ç¨æ·åºç¤ºä¾ï¼å¯ç´æ¥ç¨ <code>docs/init.sql</code> ä½ä¸ºèµ·ç¹ï¼ï¼</p>
<pre><code class="language-sql">CREATE DATABASE IF NOT EXISTS gin_ddd CHARACTER SET utf8mb4;
USE gin_ddd;

CREATE TABLE IF NOT EXISTS users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    phone VARCHAR(20),
    created_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
</code></pre>
<p>PostgreSQL è®¢ååºç¤ºä¾ï¼ä¸å½åè®¢åä»å¨å­æ®µä¸è´ï¼ï¼</p>
<pre><code class="language-sql">CREATE DATABASE seed;
\c seed;

CREATE TABLE IF NOT EXISTS orders (
    id BIGSERIAL PRIMARY KEY,
    order_no VARCHAR(50) NOT NULL UNIQUE,
    user_id BIGINT NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL DEFAULT 0.00,
    status VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
</code></pre>
<p>æ°æ®åºééæ³¨æï¼</p>
<ul>
<li>è¥è®¢ååºæ¹ä¸º MySQLï¼éè¦å° SQL å ä½ç¬¦ä» <code>$1</code> å½¢å¼æ¹ä¸º <code>?</code></li>
<li>è¥ç¨æ·åºæ¹ä¸º PostgreSQLï¼éè¦å°æå¥ ID è·åé»è¾æ¹ä¸º <code>RETURNING id</code></li>
</ul>
<h3 id="3-éç½®åºç¨">3. éç½®åºç¨</h3>
<p>ç¼è¾ <code>config/config.yaml</code>ï¼è³å°éç½®æ°æ®åºä¸ RocketMQï¼</p>
<pre><code class="language-yaml">server:
  host: "0.0.0.0"
  port: 8080
  mode: "debug"

database:
  user:
    driver: "mysql"
    host: "localhost"
    port: 3306
    username: "root"
    password: "your_password"
    database: "gin_ddd"
  order:
    driver: "postgres"
    host: "localhost"
    port: 5432
    username: "postgres"
    password: "your_password"
    database: "seed"

rocketmq:
  enabled: true
  nameserver: "localhost:9876"
  group_name: "gin-ddd-group"
  instance_name: "gin-ddd-instance"
  topics:
    order_event: "order-event-topic"
</code></pre>
<p>è¯´æï¼</p>
<ul>
<li><code>rocketmq.enabled: true</code> æä¼åå§åçäº§èä¸æ¶è´¹è</li>
<li>å½åè®¢åäºä»¶ Topic å¨ä»£ç ä¸­ä½¿ç¨åºå®å¼ <code>order-event-topic</code>ï¼éä¸éç½®ä¿æä¸è´</li>
</ul>
<h3 id="4-å¯å¨-rocketmqå¯é">4. å¯å¨ RocketMQï¼å¯éï¼</h3>
<pre><code class="language-bash">sh bin/mqnamesrv
sh bin/mqbroker -n localhost:9876
</code></pre>
<h3 id="5-å¯å¨åºç¨">5. å¯å¨åºç¨</h3>
<pre><code class="language-bash">go mod tidy
go run cmd/server/main.go
</code></pre>
<h3 id="6-éªè¯æ¥å£">6. éªè¯æ¥å£</h3>
<pre><code class="language-bash">curl http://localhost:8080/health
curl http://localhost:8080/api/users
curl http://localhost:8080/api/orders
</code></pre>
<h2 id="å¦ä½åºäºèææ¶å¼åæ°åè½">å¦ä½åºäºèææ¶å¼åæ°åè½</h2>
<p>ç¤ºä¾ï¼æ°å¢âååç®¡çâæ¨¡å</p>
<p>æ­¥éª¤ 1ï¼æ°å¢é¢åæ¨¡å <code>internal/domain/model/product/product.go</code></p>
<pre><code class="language-go">package product

import "time"

type Product struct {
	ID        int64
	Name      string
	Price     float64
	Stock     int
	CreatedAt time.Time
	UpdatedAt time.Time
}
</code></pre>
<p>æ­¥éª¤ 2ï¼æ°å¢ä»å¨æ¥å£ <code>internal/domain/repository/product/product_repository.go</code></p>
<pre><code class="language-go">package product

import (
	"context"
	"gin-ddd/internal/domain/model/product"
)

type ProductRepository interface {
	Create(ctx context.Context, p *product.Product) error
	Update(ctx context.Context, p *product.Product) error
	FindByID(ctx context.Context, id int64) (*product.Product, error)
	FindAll(ctx context.Context) ([]*product.Product, error)
}
</code></pre>
<p>æ­¥éª¤ 3ï¼æ°å¢ä»å¨å®ç° <code>internal/infrastructure/persistence/product/product_repository_impl.go</code></p>
<pre><code class="language-go">package product

import (
	"context"
	"database/sql"
	"gin-ddd/internal/domain/model/product"
)

type ProductRepositoryImpl struct {
	db *sql.DB
}

func NewProductRepository(db *sql.DB) *ProductRepositoryImpl {
	return &amp;ProductRepositoryImpl{db: db}
}

func (r *ProductRepositoryImpl) Create(ctx context.Context, p *product.Product) error {
	_, err := r.db.ExecContext(ctx,
		`INSERT INTO products (name, price, stock, created_at, updated_at) VALUES (?, ?, ?, ?, ?)`,
		p.Name, p.Price, p.Stock, p.CreatedAt, p.UpdatedAt,
	)
	return err
}
</code></pre>
<p>æ­¥éª¤ 4ï¼æ°å¢åºç¨æå¡ <code>internal/application/service/product/product_service.go</code></p>
<pre><code class="language-go">package product

import (
	"context"
	"time"
	"gin-ddd/internal/domain/model/product"
	productDomain "gin-ddd/internal/domain/repository/product"
)

type ProductService struct {
	repo productDomain.ProductRepository
}

func NewProductService(repo productDomain.ProductRepository) *ProductService {
	return &amp;ProductService{repo: repo}
}

func (s *ProductService) Create(ctx context.Context, name string, price float64, stock int) error {
	p := &amp;product.Product{
		Name:      name,
		Price:     price,
		Stock:     stock,
		CreatedAt: time.Now(),
		UpdatedAt: time.Now(),
	}
	return s.repo.Create(ctx, p)
}
</code></pre>
<p>æ­¥éª¤ 5ï¼æ°å¢ HTTP Handler åè·¯ç±</p>
<p>å°è¯·æ±/ååºå¯¹è±¡æ¾å° <code>internal/interfaces/vo/product/</code>ï¼Handler æ¾å° <code>internal/interfaces/handler/product/</code>ï¼å¹¶å¨ <code>internal/interfaces/router/router.go</code> ä¸­æ³¨åè·¯ç±ã</p>
<p>æ­¥éª¤ 6ï¼æ°å¢æ°æ®åºè¡¨</p>
<pre><code class="language-sql">CREATE TABLE IF NOT EXISTS products (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    stock INT NOT NULL DEFAULT 0,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
</code></pre>
<h2 id="äºä»¶é©±å¨ä¸-rocketmq">äºä»¶é©±å¨ä¸ RocketMQ</h2>
<h3 id="äºä»¶ç±»å">äºä»¶ç±»å</h3>
<p>è®¢åäºä»¶ï¼</p>
<ul>
<li>order.created</li>
<li>order.paid</li>
<li>order.shipped</li>
<li>order.delivered</li>
<li>order.cancelled</li>
<li>order.refunded</li>
</ul>
<p>ç¨æ·äºä»¶ï¼</p>
<ul>
<li>user.created</li>
<li>user.activated</li>
<li>user.deactivated</li>
<li>user.blocked</li>
<li>user.deleted</li>
</ul>
<h3 id="æ¶æ¯æµè½¬">æ¶æ¯æµè½¬</h3>
<pre><code>HTTP è¯·æ± -&gt; Application Service -&gt; Domain Model
            -&gt; åå¸ DomainEvent -&gt; RocketMQ Producer
            -&gt; RocketMQ Broker -&gt; Consumer
            -&gt; äºä»¶å¤ç -&gt; åéé®ä»¶/è§¦ååç»­æµç¨
</code></pre>
<h3 id="äºä»¶åå¸ä¸æ¶è´¹å³é®ç¹">äºä»¶åå¸ä¸æ¶è´¹å³é®ç¹</h3>
<ul>
<li>è®¢ååå»ºåä¼åå¸ <code>order.created</code> äºä»¶ï¼åå¸å¤±è´¥ä¸ä¼å½±åä¸»æµç¨ï¼</li>
<li>æ¶è´¹ç«¯æ Tag è§£æä¸º <code>OrderEvent</code> æ <code>UserEvent</code></li>
<li>è®¢åé®ä»¶éç¥ä»å¨ <code>order.created</code> ä¸å¯ç¨é®ä»¶æ¶è§¦å</li>
</ul>
<h2 id="é®ä»¶åééç½®qq-é®ç®±">é®ä»¶åééç½®ï¼QQ é®ç®±ï¼</h2>
<p>å¨ <code>config/config.yaml</code> ä¸­å¼å¯é®ä»¶éç½®ï¼</p>
<pre><code class="language-yaml">mail:
  enabled: true
  host: "smtp.qq.com"
  port: 465
  username: "your@qq.com"
  password: "ä½ çSMTPææç "
  from_email: "your@qq.com"
  from_name: "è®¢åç³»ç»"
</code></pre>
<p>æ³¨æäºé¡¹ï¼</p>
<ul>
<li>å¿é¡»ä½¿ç¨ SMTP ææç ï¼ä¸æ¯ QQ ç»å½å¯ç </li>
<li>ç«¯å£ 465 ä½¿ç¨ TLSï¼ç«¯å£ 587 ä½¿ç¨ STARTTLS</li>
<li>æ¶ä»¶äººåèªç¨æ·è¡¨ä¸­ç <code>email</code> å­æ®µ</li>
</ul>
<h2 id="å¸¸è§é®é¢ææ¥">å¸¸è§é®é¢ææ¥</h2>
<ul>
<li>æ¥å¿æç¤ºâäºä»¶åå¸å¨æªåå§åâï¼RocketMQ æªå¯ç¨æåå§åå¤±è´¥</li>
<li>è®¢åäºä»¶å·²åéä½é®ä»¶æªå°ï¼ç¡®è®¤ç¨æ·é®ç®±å­æ®µæ­£ç¡®ï¼ä¸ SMTP ææç å¯ç¨</li>
<li>æ¶è´¹èæ²¡ææ¶å°æ¶æ¯ï¼ç¡®è®¤ Topic ä¸ Tag æ­£ç¡®ãBroker å¯å¨æ­£å¸¸</li>
</ul>
<h2 id="å¼åè§è">å¼åè§è</h2>
<p>å½åå»ºè®®ï¼</p>
<ul>
<li>é¢åæ¨¡åï¼åè¯ï¼å¦ <code>Order</code>ã<code>User</code></li>
<li>åºç¨æå¡ï¼<code>XxxService</code></li>
<li>ä»å¨æ¥å£ï¼<code>XxxRepository</code></li>
<li>ä»å¨å®ç°ï¼<code>XxxRepositoryImpl</code></li>
<li>Handlerï¼<code>XxxHandler</code></li>
</ul>
<p>åå±ååï¼</p>
<ul>
<li>é¢åå±ä¸ä¾èµåºç¡è®¾æ½</li>
<li>åºç¨å±åªåç¼æä¸äºå¡åè°</li>
<li>åºç¡è®¾æ½æä¾ææ¯å®ç°</li>
<li>æ¥å£å±åªè´è´£ HTTP äº¤äº</li>
</ul>
<h2 id="å¸¸ç¨å½ä»¤">å¸¸ç¨å½ä»¤</h2>
<pre><code class="language-bash">go mod tidy
go test ./...
</code></pre>
<h2 id="æºç å°å">æºç å°å</h2>
<p><a href="https://github.com/microwind/design-patterns/tree/main/practice-projects/gin-ddd" target="_blank" rel="noopener nofollow">https://github.com/microwind/design-patterns/tree/main/practice-projects/gin-ddd</a></p>


</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 09:19">2026-02-13 09:19</span>&nbsp;
<a href="https://www.cnblogs.com/letjs">åæ³å¦é£</a>&nbsp;
éè¯»(<span id="post_view_count">32</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19610915);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19610915', targetLink: 'https://www.cnblogs.com/letjs/p/19610915', title: 'ä¸æ¬¾Goè¯­è¨Ginæ¡æ¶DDDèææ¶ï¼éåå¿«éæ­å»ºé¡¹ç®' })">ä¸¾æ¥</a>
</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ LockSupportæ·±åº¦è§£æï¼çº¿ç¨é»å¡ä¸å¤éçåºå±å®ç°åç ]]></title>
    <link>https://www.cnblogs.com/sevencoding/p/19588531</link>
    <guid>925ebc26a6c7946a9df5f9471bf51786</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sevencoding/p/19588531" title="åå¸äº 2026-02-13 09:00">
    <span role="heading" aria-level="2">LockSupportæ·±åº¦è§£æï¼çº¿ç¨é»å¡ä¸å¤éçåºå±å®ç°åç</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="locksupportç®ä»">LockSupportç®ä»</h2>
<p>LockSupprot ç¨æ¥é»å¡åå¤éçº¿ç¨ï¼åºå±å®ç°ä¾èµäº&nbsp;<a href="https://www.seven97.top/java/concurrent/unsafe.html" target="_blank" rel="noopener nofollow">Unsafe ç±»</a>ã</p>
<p>LockSupportç¨æ¥åå»ºéåå¶ä»åæ­¥ç±»çåºæ¬çº¿ç¨é»å¡åè¯­ãç®èè¨ä¹ï¼å½è°ç¨LockSupport.parkæ¶ï¼è¡¨ç¤ºå½åçº¿ç¨å°ä¼ç­å¾ï¼ç´è³è·å¾è®¸å¯ï¼å½è°ç¨LockSupport.unparkæ¶ï¼å¿é¡»æç­å¾è·å¾è®¸å¯ççº¿ç¨ä½ä¸ºåæ°è¿è¡ä¼ éï¼å¥½è®©æ­¤çº¿ç¨ç»§ç»­è¿è¡ãå¨AQSä¸­å¤§éä½¿ç¨ï¼AQSæç»é½æ¯ä½¿ç¨LockSupportæ¥é»å¡çº¿ç¨çã</p>
<p>è¯¥ç±»åå«ä¸ç»ç¨äºé»å¡åå¤éçº¿ç¨çéææ¹æ³ï¼è¿äºæ¹æ³ä¸»è¦æ¯å´ç» park å unpark å±å¼ï¼è¯ä¸å¤è¯´ï¼ç´æ¥æ¥çä¸ä¸ªç®åçä¾å­å§ã</p>
<pre><code class="language-java">public class LockSupportDemo1 {
    public static void main(String[] args) {
        Thread mainThread = Thread.currentThread();

        // åå»ºä¸ä¸ªçº¿ç¨ä»1æ°å°1000
        Thread counterThread = new Thread(() -&gt; {
            for (int i = 1; i &lt;= 1000; i++) {
                System.out.println(i);
                if (i == 500) {
                    // å½æ°å°500æ¶ï¼å¤éä¸»çº¿ç¨
                    LockSupport.unpark(mainThread);
                }
            }
        });

        counterThread.start();

        // ä¸»çº¿ç¨è°ç¨park
        LockSupport.park();
        System.out.println("Main thread was unparked.");
    }
}
</code></pre>
<p>ä¸é¢çä»£ç ä¸­ï¼å½ counterThread æ°å° 500 æ¶ï¼å®ä¼å¤é mainThreadãè mainThread å¨è°ç¨ park æ¹æ³æ¶ä¼è¢«é»å¡ï¼ç´å°è¢« unparkã</p>
<p>LockSupport ä¸­çæ¹æ³ä¸å¤ï¼è¿éå°è¿äºæ¹æ³åä¸ä¸ªæ»ç»ï¼</p>
<h3 id="é»å¡çº¿ç¨">é»å¡çº¿ç¨</h3>
<ol>
<li><code>void park()</code>ï¼é»å¡å½åçº¿ç¨ï¼å¦æè°ç¨ unpark æ¹æ³æçº¿ç¨è¢«ä¸­æ­ï¼åè¯¥çº¿ç¨å°åå¾å¯è¿è¡ãè¯·æ³¨æï¼park ä¸ä¼æåº InterruptedExceptionï¼å æ­¤çº¿ç¨å¿é¡»åç¬æ£æ¥å¶ä¸­æ­ç¶æã</li>
<li><code>void park(Object blocker)</code>ï¼åè½åæ¹æ³ 1ï¼å¥åå¢å ä¸ä¸ª Object å¯¹è±¡ï¼ç¨æ¥è®°å½å¯¼è´çº¿ç¨é»å¡çå¯¹è±¡ï¼æ¹ä¾¿é®é¢ææ¥ã</li>
<li><code>void parkNanos(long nanos)</code>ï¼é»å¡å½åçº¿ç¨ä¸å®ççº³ç§æ¶é´ï¼æç´å°è¢« unpark è°ç¨ï¼æçº¿ç¨è¢«ä¸­æ­ã</li>
<li><code>void parkNanos(Object blocker, long nanos)</code>ï¼åè½åæ¹æ³ 3ï¼å¥åå¢å ä¸ä¸ª Object å¯¹è±¡ï¼ç¨æ¥è®°å½å¯¼è´çº¿ç¨é»å¡çå¯¹è±¡ï¼æ¹ä¾¿é®é¢ææ¥ã</li>
<li><code>void parkUntil(long deadline)</code>ï¼é»å¡å½åçº¿ç¨ç´å°æä¸ªæå®çæªæ­¢æ¶é´ï¼ä»¥æ¯«ç§ä¸ºåä½ï¼ï¼æç´å°è¢« unpark è°ç¨ï¼æçº¿ç¨è¢«ä¸­æ­ã</li>
<li><code>void parkUntil(Object blocker, long deadline)</code>ï¼åè½åæ¹æ³ 5ï¼å¥åå¢å ä¸ä¸ª Object å¯¹è±¡ï¼ç¨æ¥è®°å½å¯¼è´çº¿ç¨é»å¡çå¯¹è±¡ï¼æ¹ä¾¿é®é¢ææ¥ã</li>
</ol>
<h3 id="å¤éçº¿ç¨">å¤éçº¿ç¨</h3>
<p><code>void unpark(Thread thread)</code>ï¼å¤éä¸ä¸ªç± park æ¹æ³é»å¡ççº¿ç¨ãå¦æè¯¥çº¿ç¨æªè¢«é»å¡ï¼é£ä¹ä¸ä¸æ¬¡è°ç¨ park æ¶å°ç«å³è¿åãè¿åè®¸âååå¶äººâå¼çå¤éæºå¶ã</p>
<p>å®éä¸ï¼LockSupport é»å¡åå¤éçº¿ç¨çåè½ä¾èµäº&nbsp;<code>sun.misc.Unsafe</code>ï¼è¿æ¯ä¸ä¸ªå¾åºå±çç±»ï¼æ¯å¦ LockSupport ç park æ¹æ³æ¯éè¿&nbsp;<code>unsafe.park()</code>&nbsp;æ¹æ³å®ç°çã</p>
<h2 id="locksupportæºç åæ">LockSupportæºç åæ</h2>
<h3 id="ç±»çå±æ§">ç±»çå±æ§</h3>
<pre><code class="language-java">public class LockSupport {
    // Hotspot implementation via intrinsics API
    private static final sun.misc.Unsafe UNSAFE;
    // è¡¨ç¤ºåå­åç§»å°å
    private static final long parkBlockerOffset;
    // è¡¨ç¤ºåå­åç§»å°å
    private static final long SEED;
    // è¡¨ç¤ºåå­åç§»å°å
    private static final long PROBE;
    // è¡¨ç¤ºåå­åç§»å°å
    private static final long SECONDARY;
    
    static {
        try {
            // è·åUnsafeå®ä¾
            UNSAFE = sun.misc.Unsafe.getUnsafe();
            // çº¿ç¨ç±»ç±»å
            Class&lt;?&gt; tk = Thread.class;
            // è·åThreadçparkBlockerå­æ®µçåå­åç§»å°å
            parkBlockerOffset = UNSAFE.objectFieldOffset
                (tk.getDeclaredField("parkBlocker"));
            // è·åThreadçthreadLocalRandomSeedå­æ®µçåå­åç§»å°å
            SEED = UNSAFE.objectFieldOffset
                (tk.getDeclaredField("threadLocalRandomSeed"));
            // è·åThreadçthreadLocalRandomProbeå­æ®µçåå­åç§»å°å
            PROBE = UNSAFE.objectFieldOffset
                (tk.getDeclaredField("threadLocalRandomProbe"));
            // è·åThreadçthreadLocalRandomSecondarySeedå­æ®µçåå­åç§»å°å
            SECONDARY = UNSAFE.objectFieldOffset
                (tk.getDeclaredField("threadLocalRandomSecondarySeed"));
        } catch (Exception ex) { throw new Error(ex); }
    }
}
</code></pre>
<p>è¯´æ: UNSAFEå­æ®µè¡¨ç¤º<a href="https://www.seven97.top/java/concurrent/unsafe.html" target="_blank" rel="noopener nofollow">sun.misc.Unsafe</a>ç±»ï¼ä¸è¬ç¨åºä¸­ä¸åè®¸ç´æ¥è°ç¨ï¼èlongåçè¡¨ç¤ºå®ä¾å¯¹è±¡ç¸åºå­æ®µå¨åå­ä¸­çåç§»å°åï¼å¯ä»¥éè¿è¯¥åç§»å°åè·åæèè®¾ç½®è¯¥å­æ®µçå¼ã</p>
<h3 id="ç±»çæé å½æ°">ç±»çæé å½æ°</h3>
<pre><code class="language-java">// ç§ææé å½æ°ï¼æ æ³è¢«å®ä¾å
private LockSupport() {}
</code></pre>
<p>è¯´æ: LockSupportåªæä¸ä¸ªç§ææé å½æ°ï¼æ æ³è¢«å®ä¾åã</p>
<h3 id="æ ¸å¿å½æ°åæ">æ ¸å¿å½æ°åæ</h3>
<p>å¨åæLockSupportå½æ°ä¹åï¼åå¼å¥sun.misc.Unsafeç±»ä¸­çparkåunparkå½æ°ï¼å ä¸ºLockSupportçæ ¸å¿å½æ°é½æ¯åºäºUnsafeç±»ä¸­å®ä¹çparkåunparkå½æ°ï¼ä¸é¢ç»åºä¸¤ä¸ªå½æ°çå®ä¹:</p>
<pre><code class="language-java">public native void park(boolean isAbsolute, long time);
public native void unpark(Thread thread);
</code></pre>
<p>è¯´æ: å¯¹ä¸¤ä¸ªå½æ°çè¯´æå¦ä¸:</p>
<ul>
<li>
<p>parkå½æ°ï¼é»å¡çº¿ç¨ï¼å¹¶ä¸è¯¥çº¿ç¨å¨ä¸åæåµåçä¹åé½ä¼è¢«é»å¡:</p>
<ul>
<li>
<p>è°ç¨unparkå½æ°ï¼éæ¾è¯¥çº¿ç¨çè®¸å¯ã</p>
</li>
<li>
<p>è¯¥çº¿ç¨è¢«ä¸­æ­ã</p>
</li>
<li>
<p>è®¾ç½®çæ¶é´å°äºãå¹¶ä¸ï¼å½timeä¸ºç»å¯¹æ¶é´æ¶ï¼isAbsoluteä¸ºtrueï¼å¦åï¼isAbsoluteä¸ºfalseãå½timeä¸º0æ¶ï¼è¡¨ç¤ºæ éç­å¾ï¼ç´å°unparkåçã</p>
</li>
</ul>
</li>
<li>
<p>unparkå½æ°ï¼éæ¾çº¿ç¨çè®¸å¯ï¼å³æ¿æ´»è°ç¨parkåé»å¡ççº¿ç¨ãè¿ä¸ªå½æ°ä¸æ¯å®å¨çï¼è°ç¨è¿ä¸ªå½æ°æ¶è¦ç¡®ä¿çº¿ç¨ä¾æ§å­æ´»ã</p>
</li>
</ul>
<h4 id="parkå½æ°">parkå½æ°</h4>
<p>parkå½æ°æä¸¤ä¸ªéè½½çæ¬ï¼æ¹æ³æè¦å¦ä¸</p>
<pre><code class="language-java">public static void park()ï¼
public static void park(Object blocker)ï¼
</code></pre>
<p>è¯´æ: ä¸¤ä¸ªå½æ°çåºå«å¨äºpark()å½æ°æ²¡ææ²¡æblockerï¼å³æ²¡æè®¾ç½®çº¿ç¨çparkBlockerå­æ®µãpark(Object)åå½æ°å¦ä¸ã</p>
<pre><code class="language-java">public static void park(Object blocker) {
    // è·åå½åçº¿ç¨
    Thread t = Thread.currentThread();
    // è®¾ç½®Blocker
    setBlocker(t, blocker);
    // è·åè®¸å¯
    UNSAFE.park(false, 0L);
    // éæ°å¯è¿è¡ååæ­¤è®¾ç½®Blocker
    setBlocker(t, null);
}
</code></pre>
<p>è¯´æ: è°ç¨parkå½æ°æ¶ï¼é¦åè·åå½åçº¿ç¨ï¼ç¶åè®¾ç½®å½åçº¿ç¨çparkBlockerå­æ®µï¼å³è°ç¨setBlockerå½æ°ï¼ä¹åè°ç¨Unsafeç±»çparkå½æ°ï¼ä¹ååè°ç¨setBlockerå½æ°ãé£ä¹é®é¢æ¥äºï¼ä¸ºä»ä¹è¦å¨æ­¤parkå½æ°ä¸­è¦è°ç¨ä¸¤æ¬¡setBlockerå½æ°å¢? åå å¶å®å¾ç®åï¼è°ç¨parkå½æ°æ¶ï¼å½åçº¿ç¨é¦åè®¾ç½®å¥½parkBlockerå­æ®µï¼ç¶ååè°ç¨Unsafeçparkå½æ°ï¼æ­¤åï¼å½åçº¿ç¨å°±å·²ç»é»å¡äºï¼ç­å¾è¯¥çº¿ç¨çunparkå½æ°è¢«è°ç¨ï¼æä»¥åé¢çä¸ä¸ªsetBlockerå½æ°æ æ³è¿è¡ï¼unparkå½æ°è¢«è°ç¨ï¼è¯¥çº¿ç¨è·å¾è®¸å¯åï¼å°±å¯ä»¥ç»§ç»­è¿è¡äºï¼ä¹å°±è¿è¡ç¬¬äºä¸ªsetBlockerï¼æè¯¥çº¿ç¨çparkBlockerå­æ®µè®¾ç½®ä¸ºnullï¼è¿æ ·å°±å®æäºæ´ä¸ªparkå½æ°çé»è¾ãå¦ææ²¡æç¬¬äºä¸ªsetBlockerï¼é£ä¹ä¹åæ²¡æè°ç¨park(Object blocker)ï¼èç´æ¥è°ç¨getBlockerå½æ°ï¼å¾å°çè¿æ¯åä¸ä¸ªpark(Object blocker)è®¾ç½®çblockerï¼æ¾ç¶æ¯ä¸ç¬¦åé»è¾çãæ»ä¹ï¼å¿é¡»è¦ä¿è¯å¨park(Object blocker)æ´ä¸ªå½æ°æ§è¡å®åï¼è¯¥çº¿ç¨çparkBlockerå­æ®µåæ¢å¤ä¸ºnullãæä»¥ï¼park(Object)åå½æ°éå¿é¡»è¦è°ç¨setBlockerå½æ°ä¸¤æ¬¡ãsetBlockeræ¹æ³å¦ä¸ã</p>
<pre><code class="language-java">private static void setBlocker(Thread t, Object arg) {
    // è®¾ç½®çº¿ç¨tçparkBlockerå­æ®µçå¼ä¸ºarg
    UNSAFE.putObject(t, parkBlockerOffset, arg);
}
</code></pre>
<p>è¯´æ: æ­¤æ¹æ³ç¨äºè®¾ç½®çº¿ç¨tçparkBlockerå­æ®µçå¼ä¸ºargã</p>
<p>å¦å¤ä¸ä¸ªæ åéè½½çæ¬ï¼park()å½æ°å¦ä¸ã</p>
<pre><code class="language-java">public static void park() {
    // è·åè®¸å¯ï¼è®¾ç½®æ¶é´ä¸ºæ éé¿ï¼ç´å°å¯ä»¥è·åè®¸å¯
    UNSAFE.park(false, 0L);
}
</code></pre>
<p>è¯´æ: è°ç¨äºparkå½æ°åï¼ä¼ç¦ç¨å½åçº¿ç¨ï¼é¤éè®¸å¯å¯ç¨ãå¨ä»¥ä¸ä¸ç§æåµä¹ä¸åçä¹åï¼å½åçº¿ç¨é½å°å¤äºä¼ç ç¶æï¼å³ä¸åæåµåçæ¶ï¼å½åçº¿ç¨ä¼è·åè®¸å¯ï¼å¯ä»¥ç»§ç»­è¿è¡ã</p>
<ul>
<li>
<p>å¶ä»æä¸ªçº¿ç¨å°å½åçº¿ç¨ä½ä¸ºç®æ è°ç¨ unparkã</p>
</li>
<li>
<p>å¶ä»æä¸ªçº¿ç¨ä¸­æ­å½åçº¿ç¨ã</p>
</li>
<li>
<p>è¯¥è°ç¨ä¸åé»è¾å°(å³æ¯«æ çç±å°)è¿åã</p>
</li>
</ul>
<h4 id="parknanoså½æ°">parkNanoså½æ°</h4>
<p>æ­¤å½æ°è¡¨ç¤ºå¨è®¸å¯å¯ç¨åç¦ç¨å½åçº¿ç¨ï¼å¹¶æå¤ç­å¾æå®çç­å¾æ¶é´ãå·ä½å½æ°å¦ä¸ã</p>
<pre><code class="language-java">public static void parkNanos(Object blocker, long nanos) {
    if (nanos &gt; 0) { // æ¶é´å¤§äº0
        // è·åå½åçº¿ç¨
        Thread t = Thread.currentThread();
        // è®¾ç½®Blocker
        setBlocker(t, blocker);
        // è·åè®¸å¯ï¼å¹¶è®¾ç½®äºæ¶é´
        UNSAFE.park(false, nanos);
        // è®¾ç½®è®¸å¯
        setBlocker(t, null);
    }
}
</code></pre>
<p>è¯´æ: è¯¥å½æ°ä¹æ¯è°ç¨äºä¸¤æ¬¡setBlockerå½æ°ï¼nanosåæ°è¡¨ç¤ºç¸å¯¹æ¶é´ï¼è¡¨ç¤ºç­å¾å¤é¿æ¶é´ã</p>
<h4 id="parkuntilå½æ°">parkUntilå½æ°</h4>
<p>æ­¤å½æ°è¡¨ç¤ºå¨æå®çæ¶éåç¦ç¨å½åçº¿ç¨ï¼é¤éè®¸å¯å¯ç¨, å·ä½å½æ°å¦ä¸:</p>
<pre><code class="language-java">public static void parkUntil(Object blocker, long deadline) {
    // è·åå½åçº¿ç¨
    Thread t = Thread.currentThread();
    // è®¾ç½®Blocker
    setBlocker(t, blocker);
    UNSAFE.park(true, deadline);
    // è®¾ç½®Blockerä¸ºnull
    setBlocker(t, null);
}
</code></pre>
<p>è¯´æ: è¯¥å½æ°ä¹è°ç¨äºä¸¤æ¬¡setBlockerå½æ°ï¼deadlineåæ°è¡¨ç¤ºç»å¯¹æ¶é´ï¼è¡¨ç¤ºæå®çæ¶é´ã</p>
<h4 id="unparkå½æ°">unparkå½æ°</h4>
<p>æ­¤å½æ°è¡¨ç¤ºå¦æç»å®çº¿ç¨çè®¸å¯å°ä¸å¯ç¨ï¼åä½¿å¶å¯ç¨ãå¦æçº¿ç¨å¨ park ä¸åé»å¡ï¼åå®å°è§£é¤å¶é»å¡ç¶æãå¦åï¼ä¿è¯ä¸ä¸æ¬¡è°ç¨ park ä¸ä¼åé»å¡ãå¦æç»å®çº¿ç¨å°æªå¯å¨ï¼åæ æ³ä¿è¯æ­¤æä½æä»»ä½ææãå·ä½å½æ°å¦ä¸:</p>
<pre><code class="language-java">public static void unpark(Thread thread) {
    if (thread != null) // çº¿ç¨ä¸ºä¸ç©º
        UNSAFE.unpark(thread); // éæ¾è¯¥çº¿ç¨è®¸å¯
}
</code></pre>
<p>è¯´æ: éæ¾è®¸å¯ï¼æå®çº¿ç¨å¯ä»¥ç»§ç»­è¿è¡ã</p>
<h2 id="æ´æ·±å¥ççè§£">æ´æ·±å¥ççè§£</h2>
<h3 id="ä¸-synchronzed-çåºå«">ä¸ synchronzed çåºå«</h3>
<p><a href="https://www.seven97.top/java/concurrent/02-keyword1-synchronized.html" target="_blank" rel="noopener nofollow">synchronzed</a>&nbsp;ä¼ä½¿çº¿ç¨é»å¡ï¼çº¿ç¨ä¼è¿å¥ BLOCKED ç¶æï¼èè°ç¨ LockSupprt æ¹æ³é»å¡çº¿ç¨ä¼ä½¿çº¿ç¨è¿å¥å° WAITING ç¶æã</p>
<h3 id="threadsleepåobjectwaitçåºå«">Thread.sleep()åObject.wait()çåºå«</h3>
<p>é¦åï¼æä»¬åæ¥ççThread.sleep()åObject.wait()çåºå«ï¼è¿æ¯ä¸ä¸ªçå¤§è¡çé¢ç®äºï¼å¤§å®¶åºè¯¥é½è½è¯´ä¸æ¥ä¸¤ç¹ã</p>
<ul>
<li>
<p>Thread.sleep()ä¸ä¼éæ¾å æçéï¼Object.wait()ä¼éæ¾å æçéï¼</p>
</li>
<li>
<p>Thread.sleep()å¿é¡»ä¼ å¥æ¶é´ï¼Object.wait()å¯ä¼ å¯ä¸ä¼ ï¼ä¸ä¼ è¡¨ç¤ºä¸ç´é»å¡ä¸å»ï¼</p>
</li>
<li>
<p>Thread.sleep()å°æ¶é´äºä¼èªå¨å¤éï¼ç¶åç»§ç»­æ§è¡ï¼</p>
</li>
<li>
<p>Object.wait()ä¸å¸¦æ¶é´çï¼éè¦å¦ä¸ä¸ªçº¿ç¨ä½¿ç¨Object.notify()å¤éï¼</p>
</li>
<li>
<p>Object.wait()å¸¦æ¶é´çï¼åå¦æ²¡æè¢«notifyï¼å°æ¶é´äºä¼èªå¨å¤éï¼è¿æ¶ååå¥½ä¸¤ç§æåµï¼ä¸æ¯ç«å³è·åå°äºéï¼çº¿ç¨èªç¶ä¼ç»§ç»­æ§è¡ï¼äºæ¯æ²¡æç«å³è·åéï¼çº¿ç¨è¿å¥åæ­¥éåç­å¾è·åéï¼</p>
</li>
</ul>
<p>å¶å®ï¼ä»ä»¬ä¿©æå¤§çåºå«å°±æ¯Thread.sleep()ä¸ä¼éæ¾éèµæºï¼Object.wait()ä¼éæ¾éèµæºã</p>
<h3 id="objectwaitåconditionawaitçåºå«">Object.wait()åCondition.await()çåºå«</h3>
<p>Object.wait()åCondition.await()çåçæ¯åºæ¬ä¸è´çï¼ä¸åçæ¯Condition.await()åºå±æ¯è°ç¨LockSupport.park()æ¥å®ç°é»å¡å½åçº¿ç¨çã</p>
<p>å®éä¸ï¼å®å¨é»å¡å½åçº¿ç¨ä¹åè¿å¹²äºä¸¤ä»¶äºï¼ä¸æ¯æå½åçº¿ç¨æ·»å å°æ¡ä»¶éåä¸­ï¼äºæ¯âå®å¨âéæ¾éï¼ä¹å°±æ¯è®©stateç¶æåéåä¸º0ï¼ç¶åææ¯è°ç¨LockSupport.park()é»å¡å½åçº¿ç¨ã</p>
<h3 id="threadsleepålocksupportparkçåºå«">Thread.sleep()åLockSupport.park()çåºå«</h3>
<p>LockSupport.park()è¿æå ä¸ªåå¼æ¹æ³ââparkNanos()ãparkUtil()ç­ï¼æä»¬è¿éè¯´çpark()æ¹æ³ç»ç§°è¿ä¸ç±»æ¹æ³ã</p>
<ul>
<li>
<p>ä»åè½ä¸æ¥è¯´ï¼Thread.sleep()åLockSupport.park()æ¹æ³ç±»ä¼¼ï¼é½æ¯é»å¡å½åçº¿ç¨çæ§è¡ï¼ä¸é½ä¸ä¼éæ¾å½åçº¿ç¨å æçéèµæºï¼</p>
</li>
<li>
<p>Thread.sleep()æ²¡æ³ä»å¤é¨å¤éï¼åªè½èªå·±éè¿æ¥ï¼</p>
</li>
<li>
<p>LockSupport.park()æ¹æ³å¯ä»¥è¢«å¦ä¸ä¸ªçº¿ç¨è°ç¨LockSupport.unpark()æ¹æ³å¤éï¼</p>
</li>
<li>
<p>Thread.sleep()æ¹æ³å£°æä¸æåºäºInterruptedExceptionä¸­æ­å¼å¸¸ï¼æä»¥è°ç¨èéè¦æè·è¿ä¸ªå¼å¸¸æèåæåºï¼</p>
</li>
<li>
<p>LockSupport.park()æ¹æ³ä¸éè¦æè·ä¸­æ­å¼å¸¸ï¼</p>
</li>
<li>
<p>Thread.sleep()æ¬èº«å°±æ¯ä¸ä¸ªnativeæ¹æ³ï¼</p>
</li>
<li>
<p>LockSupport.park()åºå±æ¯è°ç¨çUnsafeçnativeæ¹æ³ï¼</p>
</li>
</ul>
<h3 id="objectwaitålocksupportparkçåºå«">Object.wait()åLockSupport.park()çåºå«</h3>
<p>äºèé½ä¼é»å¡å½åçº¿ç¨çè¿è¡ï¼ä»ä»¬æä»ä¹åºå«å¢? ç»è¿ä¸é¢çåæç¸ä¿¡ä½ ä¸å®å¾æ¸æ¥äºï¼ççå? å¾ä¸çï¼</p>
<ul>
<li>
<p>Object.wait()æ¹æ³éè¦å¨synchronizedåä¸­æ§è¡ï¼</p>
</li>
<li>
<p>LockSupport.park()å¯ä»¥å¨ä»»æå°æ¹æ§è¡ï¼</p>
</li>
<li>
<p>Object.wait()æ¹æ³å£°ææåºäºä¸­æ­å¼å¸¸ï¼è°ç¨èéè¦æè·æèåæåºï¼</p>
</li>
<li>
<p>LockSupport.park()ä¸éè¦æè·ä¸­æ­å¼å¸¸ï¼</p>
</li>
<li>
<p>Object.wait()ä¸å¸¦è¶æ¶çï¼éè¦å¦ä¸ä¸ªçº¿ç¨æ§è¡notify()æ¥å¤éï¼ä½ä¸ä¸å®ç»§ç»­æ§è¡åç»­åå®¹ï¼</p>
</li>
<li>
<p>LockSupport.park()ä¸å¸¦è¶æ¶çï¼éè¦å¦ä¸ä¸ªçº¿ç¨æ§è¡unpark()æ¥å¤éï¼ä¸å®ä¼ç»§ç»­æ§è¡åç»­åå®¹ï¼</p>
</li>
</ul>
<p>park()/unpark()åºå±çåçæ¯âäºåä¿¡å·éâï¼ä½ å¯ä»¥æå®ç¸åæåªæä¸ä¸ªè®¸å¯è¯çSemaphoreï¼åªä¸è¿è¿ä¸ªä¿¡å·éå¨éå¤æ§è¡unpark()çæ¶åä¹ä¸ä¼åå¢å è®¸å¯è¯ï¼æå¤åªæä¸ä¸ªè®¸å¯è¯ã</p>
<h3 id="å¦æå¨waitä¹åæ§è¡äºnotifyä¼ææ ·">å¦æå¨wait()ä¹åæ§è¡äºnotify()ä¼ææ ·?</h3>
<p>å¦æå½åççº¿ç¨ä¸æ¯æ­¤å¯¹è±¡éçææèï¼å´è°ç¨è¯¥å¯¹è±¡çnotify()æwait()æ¹æ³æ¶æåºIllegalMonitorStateExceptionå¼å¸¸ï¼</p>
<p>å¦æå½åçº¿ç¨æ¯æ­¤å¯¹è±¡éçææèï¼wait()å°ä¸ç´é»å¡ï¼å ä¸ºåç»­å°æ²¡æå¶å®notify()å¤éå®ã</p>
<h3 id="å¦æå¨parkä¹åæ§è¡äºunparkä¼ææ ·">å¦æå¨park()ä¹åæ§è¡äºunpark()ä¼ææ ·?</h3>
<p>çº¿ç¨ä¸ä¼è¢«é»å¡ï¼ç´æ¥è·³è¿park()ï¼ç»§ç»­æ§è¡åç»­åå®¹</p>
<h3 id="locksupportparkä¼éæ¾éèµæºå">LockSupport.park()ä¼éæ¾éèµæºå?</h3>
<p>ä¸ä¼ï¼å®åªè´è´£é»å¡å½åçº¿ç¨ï¼éæ¾éèµæºå®éä¸æ¯å¨Conditionçawait()æ¹æ³ä¸­å®ç°çã</p>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªå¨çº¿ç½ç«ï¼sevençèé¸æé¿ä¹è·¯ï¼ä½èï¼sevenï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼www.seven97.top</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 09:00">2026-02-13 09:00</span>&nbsp;
<a href="https://www.cnblogs.com/sevencoding">ç¨åºåSeven</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19588531);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19588531', targetLink: 'https://www.cnblogs.com/sevencoding/p/19588531', title: 'LockSupportæ·±åº¦è§£æï¼çº¿ç¨é»å¡ä¸å¤éçåºå±å®ç°åç' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ AIå·¥å·å®è·µæ¥è®°ï¼äºï¼ï¼å¨ OpenClaw ä¸­è°ç¨ OpenCode è¿è¡å¼åä»»å¡ ]]></title>
    <link>https://www.cnblogs.com/rsls/p/19606311</link>
    <guid>d7d7b4a70839298c84dc23dd3838efe3</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/rsls/p/19606311" title="åå¸äº 2026-02-13 08:56">
    <span role="heading" aria-level="2">AIå·¥å·å®è·µæ¥è®°ï¼äºï¼ï¼å¨ OpenClaw ä¸­è°ç¨ OpenCode è¿è¡å¼åä»»å¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/280247/202602/280247-20260212005137002-1578926574.png" alt="AIå·¥å·å®è·µæ¥è®°ï¼äºï¼ï¼å¨ OpenClaw ä¸­è°ç¨ OpenCode è¿è¡å¼åä»»å¡" class="desc_img">
        AI å¼åéè¦"ææ¥ä¸­å¿"
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="å¼è¨ai-å¼åéè¦ææ¥ä¸­å¿">å¼è¨ï¼AI å¼åéè¦"ææ¥ä¸­å¿"</h2>
<p>ä¸ä¸ç¯æ¥è®°è®²äºå¦ä½å¨æ èæ´¾ä¸æ­å»º OpenClawãè¿ç¯æ¥è¯´è¯´<strong>çæ­£ç¨ OpenClaw å¹²æ´»</strong>çä½éªã</p>
<p>ç´æ¥ç¨ ClaudeãGPT æ OpenCode åä»£ç æä¸ªé®é¢ï¼<strong>å¯¹è¯æ£è½å¨åä¸ªçªå£ï¼è¿åº¦æ²¡æ³è¿½è¸ªï¼ç»æä¹ä¸å¥½ç®¡çã</strong></p>
<p>OpenClaw è§£å³çå°±æ¯è¿ä¸ªé®é¢ââå®åä¸ä¸ª"ææ¥ä¸­å¿"ï¼è®©ä½ è½ï¼</p>
<ul>
<li>å¯å¨ AI ç¼ç¨ä»»å¡ï¼åå°è¿è¡ï¼ä¸é»å¡ï¼</li>
<li>å®æ¶çæ§è¿åº¦ï¼éæ¶æ¥çè¾åºï¼</li>
<li>èªå¨å¤çéè¯¯ï¼å¡ä½æ¶èªå¨æ¢å¤ææ¥è­¦ï¼</li>
<li>ç»ä¸ç®¡çä¸ä¸æï¼workspaceãmemoryãæè½ï¼</li>
</ul>
<p>è¿ç¯æ¥è®°è®°å½äºæç¨ <strong>OpenClaw + OpenSpec + OpenCode</strong> ç»åå¼åä»»å¡çæ¿ççå®è¿ç¨ã</p>
<hr>
<h2 id="ä¸ºä»ä¹è¦ç¨-openspecè§èåäºä»£ç ">ä¸ºä»ä¹è¦ç¨ OpenSpecï¼è§èåäºä»£ç </h2>
<h3 id="ai-ç¼ç¨ççç¹">AI ç¼ç¨ççç¹</h3>
<p>ç¨ AI åä»£ç å¾æ¹ä¾¿ï¼ä½æä¸ªè´å½é®é¢ï¼<strong>éæ±åªå­å¨äºèå¤©è®°å½éã</strong></p>
<p>æ³è±¡è¿ä¸ªåºæ¯ï¼</p>
<ul>
<li>ä½ è· Claude è¯´ï¼"å¸®æå ä¸ªæ ç­¾åè½"</li>
<li>AI åå¥½äºä»£ç </li>
<li>ä¸å¨åä½ æ³æ¹è¿ä¸ªåè½ï¼ä½æ¾ä¸å°å½æ¶çå¯¹è¯</li>
<li>ä½ éæ°æè¿°éæ±ï¼ä½æè¿°å¾ä¸å®å¨ä¸æ ·</li>
<li>AI åçä»£ç åä¹åä¸å¼å®¹</li>
</ul>
<p><strong>ç»æï¼ä»£ç ä¸å¢ç³ï¼è¿å¾èªå·±éåã</strong></p>
<h3 id="openspec-æ¯ä»ä¹">OpenSpec æ¯ä»ä¹</h3>
<p><strong>OpenSpec æ¯ä¸ä¸ªè§èé©±å¨å¼åï¼Spec-Driven Developmentï¼æ¡æ¶ã</strong></p>
<p>å®çæ ¸å¿çå¿µï¼<strong>ååè§èï¼ååä»£ç ã</strong></p>
<p>ææéæ±ãè®¾è®¡ãä»»å¡é½åæææ¡£ï¼æ¾å¨ <code>openspec/</code> ç®å½ä¸ãAI æç§è§èææ¡£æ§è¡ï¼èä¸æ¯æ ¹æ®èå¤©åå®¹çæµã</p>
<h3 id="openspec-ç®å½ç»æ">OpenSpec ç®å½ç»æ</h3>
<pre><code>openspec/
âââ specs/                    # ç³»ç»è¡ä¸ºçæºå¤´ï¼å½åç¶æï¼
â   âââ &lt;domain&gt;/
â       âââ spec.md          # ç³»ç»è§æ ¼ææ¡£
âââ changes/                  # æè®®çåæ´ï¼æ¯ä¸ªåè½ä¸ä¸ªæä»¶å¤¹ï¼
â   âââ &lt;åè½å&gt;/
â       âââ proposal.md      # ä¸ºä»ä¹è¦åï¼æå¾åèå´ï¼
â       âââ design.md        # æä¹åï¼ææ¯æ¹æ¡ï¼
â       âââ tasks.md         # ä»»å¡æ¸å â­ æå³é®
â       âââ specs/           # åæ´çå·ä½è§æ ¼
âââ config.yaml              # é¡¹ç®éç½®
</code></pre>
<h3 id="ä½¿ç¨-openspec-çå¿è¦æ§">ä½¿ç¨ OpenSpec çå¿è¦æ§</h3>
<p><strong>1. éæ±å¯è¿½æº¯</strong></p>
<table>
<thead>
<tr>
<th>æ¹å¼</th>
<th>éæ±å¨åªé</th>
<th>ä¸ä¸ªæåè¿è½æ¾å°å</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç´æ¥èå¤©</td>
<td>èå¤©è®°å½</td>
<td>â æ¾ä¸å°äº</td>
</tr>
<tr>
<td>OpenSpec</td>
<td><code>changes/åè½å/proposal.md</code></td>
<td>â æ°¸è¿å¨æä»¶é</td>
</tr>
</tbody>
</table>
<p><strong>2. è®¾è®¡å¯å¤ç¨</strong></p>
<p>è®¾è®¡ææ¡£ <code>design.md</code> è®°å½äºææ¯æ¹æ¡ãä¸æ¬¡éå°ç±»ä¼¼åè½ï¼å¯ä»¥ç´æ¥åèã</p>
<p><strong>3. ä»»å¡å¯æå</strong></p>
<p><code>tasks.md</code> æå¤æåè½ææå¯æ§è¡çå°ä»»å¡ãAI ææ¸åéä¸ªå®æï¼ä¸ä¼éæ¼ã</p>
<p><strong>4. è¿åº¦å¯çæ§</strong></p>
<p>æ¯ä¸ªä»»å¡å®æåï¼AI è¾åº <code>[DONE] ä»»å¡X.X</code>ãä½ å¯ä»¥å®æ¶ç¥éï¼</p>
<ul>
<li>å®æäºå¤å°ä»»å¡</li>
<li>è¿å©å¤å°ä»»å¡</li>
<li>ææ²¡æå¡ä½</li>
</ul>
<p><strong>5. åæ´æåå²</strong></p>
<pre><code class="language-bash"># æ¥çææåæ´
$ ls openspec/changes/
add-archive-feature/    # å½æ¡£åè½
add-task-tags/          # æ ç­¾åè½
migrate-to-sqlite/      # æ°æ®åºè¿ç§»

# æ¯ä¸ªåæ´é½æå®æ´çææ¡ãè®¾è®¡ãä»»å¡è®°å½
</code></pre>
<h3 id="ä¸ç¨-openspec-çåæ">ä¸ç¨ OpenSpec çåæ</h3>
<p>æåè¿å¯¹æ¯å®éªï¼</p>
<table>
<thead>
<tr>
<th>é¡¹ç®</th>
<th>ä½¿ç¨ OpenSpec</th>
<th>ä¸ä½¿ç¨ OpenSpec</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ ç­¾åè½</td>
<td>6ä¸ªä»»å¡ï¼10åéï¼ä¸æ¬¡æå</td>
<td>åå¤æ²éï¼30åéï¼ä»£ç æ··ä¹±</td>
</tr>
<tr>
<td>æ°æ®åºè¿ç§»</td>
<td>24ä¸ªä»»å¡ææ2ä¸ªåæ´ï¼5åé</td>
<td>ç´æ¥è¯´"è¿ç§»å°SQLite"ï¼å¡ä½</td>
</tr>
<tr>
<td>å¯ç»´æ¤æ§</td>
<td>3ä¸ªæåä»è½çæè®¾è®¡</td>
<td>1å¨åå¿è®°å½æ¶æä¹æ³ç</td>
</tr>
</tbody>
</table>
<p><strong>ç»è®ºï¼OpenSpec æ¯ AI ç¼ç¨ç"åºç¡è®¾æ½"ï¼ä¸ç¨å®å°±æ¯å¨è£¸å¥ã</strong></p>
<h3 id="openspec-å·¥ä½æµç¨">OpenSpec å·¥ä½æµç¨</h3>
<pre><code>1. ææ°éæ±
   â
2. åå»ºåæ´
   $ openspec change new åè½å
   â
3. ç¼åè§èææ¡£
   - proposal.mdï¼ä¸ºä»ä¹è¦åï¼
   - design.mdï¼æä¹åï¼
   - tasks.mdï¼ä»»å¡æ¸åï¼
   â
4. è®© AI æ§è¡
   $ opencode run "æ tasks.md å®ç°"
   â
5. éªè¯ç»æ
   - åè½æµè¯
   - ä»£ç å®¡æ¥
   â
6. å½æ¡£åæ´
   $ openspec change archive åè½å
   â
7. æ´æ°ç³»ç»è§æ ¼
   - æåæ´åå¹¶å° specs/
</code></pre>
<hr>
<h2 id="å·¥å·é¾ä»ç»">å·¥å·é¾ä»ç»</h2>
<h3 id="openclawai-ææ¥ä¸­å¿">OpenClawï¼AI ææ¥ä¸­å¿</h3>
<p>OpenClaw æ¯ä¸ä¸ª AI å©æå¹³å°ï¼æ ¸å¿è½åï¼</p>
<table>
<thead>
<tr>
<th>åè½</th>
<th>è¯´æ</th>
<th>å½ä»¤</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¯å¨åå°ä»»å¡</td>
<td>ä¸é»å¡å½åä¼è¯</td>
<td><code>sessions_spawn task:"..."</code></td>
</tr>
<tr>
<td>å®æ¶çæ§</td>
<td>æ¥çä»»å¡è¾åºåè¿åº¦</td>
<td><code>sessions_history sessionKey:"..."</code></td>
</tr>
<tr>
<td>ä»»å¡ç®¡ç</td>
<td>ååºåéæ¶æ¯ãå¼ºå¶åæ­¢</td>
<td><code>sessions_list</code>, <code>sessions_send</code>, <code>process action:kill</code></td>
</tr>
<tr>
<td>ä¸ä¸æç®¡ç</td>
<td>èªå¨è¯»å workspaceãmemory</td>
<td>åç½®</td>
</tr>
<tr>
<td>éè¯¯å¤ç</td>
<td>èªå¨æ£æµåæ¢å¤</td>
<td>åç½®</td>
</tr>
</tbody>
</table>
<h3 id="opencodeai-ç¼ç¨ä»£ç">OpenCodeï¼AI ç¼ç¨ä»£ç</h3>
<p>OpenCode è¯»å OpenSpec è§èï¼èªå¨åä»£ç ãæ¯æå¤ç§è°ç¨æ¹å¼ï¼</p>
<ol>
<li><strong>å½ä»¤è¡</strong>ï¼<code>opencode run "å®ç°åè½"</code></li>
<li><strong>OpenClaw exec</strong>ï¼<code>exec command:"opencode run ..."</code></li>
<li><strong>OpenClaw sessions_spawn</strong>ï¼<code>sessions_spawn task:"..."</code> â­æ¨è</li>
</ol>
<hr>
<h2 id="å®æä¸æ ç­¾åè½å¼å">å®æä¸ï¼æ ç­¾åè½å¼å</h2>
<h3 id="éæ±">éæ±</h3>
<p>ç»ä»»å¡çæ¿æ·»å <strong>æ ç­¾åè½</strong>ï¼</p>
<ul>
<li>æ¯æä¸ºä»»å¡æ·»å å¤ä¸ªæ ç­¾</li>
<li>å¯ä»¥ææ ç­¾ç­éä»»å¡</li>
<li>æ ç­¾æ¾ç¤ºå¨ä»»å¡å¡çä¸</li>
</ul>
<h3 id="openclaw-æ§è¡æµç¨">OpenClaw æ§è¡æµç¨</h3>
<p><strong>ç¬¬ä¸æ­¥ï¼åå»º OpenSpec è§è</strong></p>
<pre><code class="language-bash">cd aimier-kanban
openspec change new add-task-tags
</code></pre>
<p>ç¼è¾ <code>openspec/changes/add-task-tags/tasks.md</code>ï¼</p>
<pre><code class="language-markdown"># Tasks: Add Task Tags

## 1. Backend
- [ ] 1.1 Add tags field to task data structure
- [ ] 1.2 Update create_task API to support tags
- [ ] 1.3 Create GET /api/tags endpoint

## 2. Frontend
- [ ] 2.1 Add tag input box in task modal
- [ ] 2.2 Display tags on task cards
- [ ] 2.3 Add tag filter dropdown
</code></pre>
<p><strong>ç¬¬äºæ­¥ï¼éè¿ OpenClaw å¯å¨ OpenCode</strong></p>
<pre><code class="language-bash"># å¨ OpenClaw ä¸­æ§è¡
sessions_spawn task:"æç§ openspec/changes/add-task-tags/tasks.md å®ç°ä»»å¡æ ç­¾åè½"
  label:"implement-task-tags"
  timeoutSeconds:600
</code></pre>
<p><strong>ç¬¬ä¸æ­¥ï¼å®æ¶çæ§è¿åº¦</strong></p>
<pre><code class="language-bash"># æ¥çä»»å¡åè¡¨
$ sessions_list

# æ¥çå·ä½è¾åºï¼æ¯30ç§æ£æ¥ä¸æ¬¡ï¼
$ sessions_history sessionKey:"agent:main:subagent:implement-task-tags" limit:50

# è¾åºç¤ºä¾ï¼
[DONE] ä»»å¡1.1: æ·»å  tags å­æ®µå°ä»»å¡æ°æ®ç»æ
[DONE] ä»»å¡1.2: ä¿®æ¹åå»ºä»»å¡ API
[DONE] ä»»å¡1.3: åå»ºæ ç­¾åè¡¨ API
[DONE] ä»»å¡2.1: å¨ä»»å¡æ¨¡ææ¡æ·»å æ ç­¾è¾å¥
[DONE] ä»»å¡2.2: å¨ä»»å¡å¡çæ¾ç¤ºæ ç­¾
[DONE] ä»»å¡2.3: æ·»å æ ç­¾ç­éåè½
[ALL DONE]
</code></pre>
<p><strong>ç¬¬åæ­¥ï¼éªè¯ç»æ</strong></p>
<pre><code class="language-bash"># æ£æ¥ä»£ç è¯­æ³
exec command:"cd aimier-kanban &amp;&amp; python3 -m py_compile app.py"

# æµè¯åè½
# å¯å¨æå¡ï¼å¨æµè§å¨éªè¯æ ç­¾åè½
</code></pre>
<h3 id="ç»æ">ç»æ</h3>
<ul>
<li>â 6 ä¸ªä»»å¡å¨é¨å®æ</li>
<li>â èæ¶çº¦ 10 åé</li>
<li>â ä»£ç è´¨éç¬¦åé¢æ</li>
<li>â æ éäººå·¥å¹²é¢</li>
</ul>
<hr>
<h2 id="å®æäºsqlite-æ°æ®åºè¿ç§»å¤æåè½">å®æäºï¼SQLite æ°æ®åºè¿ç§»ï¼å¤æåè½ï¼</h2>
<h3 id="éæ±-1">éæ±</h3>
<p>æä»»å¡çæ¿ä» JSON æä»¶å­å¨è¿ç§»å° SQLite æ°æ®åºã</p>
<p><strong>å¤æåº¦è¯ä¼°ï¼</strong></p>
<ul>
<li>æ°æ®åºåå§åï¼4 ä¸ªä»»å¡</li>
<li>æ°æ®è¿ç§»ï¼4 ä¸ªä»»å¡</li>
<li>API æ´æ°ï¼16 ä¸ªä»»å¡ï¼<strong>è¿å¤ï¼</strong>ï¼</li>
</ul>
<h3 id="ä»»å¡æåç­ç¥">ä»»å¡æåç­ç¥</h3>
<p>ç´æ¥è®© OpenCode å®ç° 24 ä¸ªä»»å¡ä¼å¡ä½ãæçç­ç¥ï¼<strong>æåä¸ºä¸¤ä¸ªåæ´</strong>ã</p>
<p><strong>åæ´1ï¼sqlite-databaseï¼8ä¸ªä»»å¡ï¼</strong></p>
<pre><code class="language-markdown"># Tasks: SQLite Database Layer

## 1. Database Setup
- [ ] 1.1 Import sqlite3 module
- [ ] 1.2 Create database connection helper
- [ ] 1.3 Add init_db() function
- [ ] 1.4 Create tasks table schema

## 2. Data Migration
- [ ] 2.1 Load existing tasks from JSON
- [ ] 2.2 Insert tasks into SQLite
- [ ] 2.3 Migrate archived tasks
- [ ] 2.4 Verify migration success
</code></pre>
<p><strong>åæ´2ï¼sqlite-apiï¼16ä¸ªä»»å¡ï¼</strong></p>
<pre><code class="language-markdown"># Tasks: Update API to use SQLite

## 1. Backend Refactor
- [ ] 1.1 Update load_tasks() to use SQL
- [ ] 1.2 Update save_task() to use SQL INSERT/UPDATE
- [ ] 1.3 Update delete_task() to use SQL DELETE
- [ ] 1.4 Update archive functions

## 2. API Endpoints
- [ ] 2.1 Update GET /api/tasks
- [ ] 2.2 Update POST /api/tasks
- [ ] 2.3 Update PATCH /api/tasks/&lt;id&gt;
- [ ] 2.4 Update DELETE /api/tasks/&lt;id&gt;
- [ ] 2.5 Update PATCH /api/tasks/&lt;id&gt;/status
- [ ] 2.6 Update GET /api/stats
- [ ] 2.7 Update GET /api/tags
- [ ] 2.8 Update GET /api/archives
- [ ] 2.9 Update POST /api/archives/&lt;id&gt;/restore
- [ ] 2.10 Update DELETE /api/archives/&lt;id&gt;
</code></pre>
<h3 id="openclaw-æ§è¡æµç¨-1">OpenClaw æ§è¡æµç¨</h3>
<p><strong>æ§è¡åæ´1ï¼</strong></p>
<pre><code class="language-bash">sessions_spawn task:"æç§ openspec/changes/sqlite-database/tasks.md å®ç°æ°æ®åºå±"
  label:"sqlite-database"
  timeoutSeconds:600
</code></pre>
<p><strong>çæ§è¾åºï¼</strong></p>
<pre><code>[DONE] ä»»å¡1.1-1.4: æ°æ®åºåå§åå®æ
[DONE] ä»»å¡2.1-2.2: è¿ç§»äº 12 ä¸ªä»»å¡
[DONE] ä»»å¡2.3-2.4: è¿ç§»äº 4 ä¸ªå½æ¡£ä»»å¡
[ALL DONE]

èæ¶ï¼çº¦3åé
ç¶æï¼â æå
</code></pre>
<p><strong>æ§è¡åæ´2ï¼</strong></p>
<pre><code class="language-bash">sessions_spawn task:"æç§ openspec/changes/sqlite-api/tasks.md æ´æ°APIå±"
  label:"sqlite-api"
  timeoutSeconds:900
</code></pre>
<p><strong>çæ§è¾åºï¼</strong></p>
<pre><code>[DONE] ä»»å¡1.1: Import sqlite3 module
[DONE] ä»»å¡1.2: Create get_db() helper function
[DONE] ä»»å¡1.3: Add init_db() for startup
[DONE] ä»»å¡2.1: Update load_tasks() to use SQL
...
[DONE] ä»»å¡2.10: Update DELETE /api/archives/&lt;id&gt;
[ALL DONE]

èæ¶ï¼çº¦2åé
ç¶æï¼â æå
</code></pre>
<h3 id="ææå¯¹æ¯">ææå¯¹æ¯</h3>
<table>
<thead>
<tr>
<th>æ¹æ¡</th>
<th>åæ´æ°</th>
<th>æ»ä»»å¡æ°</th>
<th>èæ¶</th>
<th>ç»æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>åå§æ¹æ¡ï¼æªæåï¼</td>
<td>1</td>
<td>24</td>
<td>å¡ä½</td>
<td>â å¤±è´¥</td>
</tr>
<tr>
<td><strong>ç»åæ¹æ¡ï¼æååï¼</strong></td>
<td><strong>2</strong></td>
<td><strong>24</strong></td>
<td><strong>5åé</strong></td>
<td><strong>â æå</strong></td>
</tr>
</tbody>
</table>
<p><strong>å³é®åç°ï¼</strong></p>
<ul>
<li>ä»»å¡æååï¼å³ä½¿æ»ä»»å¡æ°ç¸åï¼æåçåèæå</li>
<li>åä¸ªåæ´çä»»å¡æ°æ§å¶å¨ 8-16 ä¸ªæ¯ sweet spot</li>
<li><code>[DONE]</code> æ è®°è®©è¿åº¦éæï¼å¿éæ´æåº</li>
</ul>
<hr>
<h2 id="çæ§åç®¡çæå·§">çæ§åç®¡çæå·§</h2>
<h3 id="å®æ¶çæ§å½ä»¤">å®æ¶çæ§å½ä»¤</h3>
<pre><code class="language-bash"># æ¥çæææ´»è·ä»»å¡
$ sessions_list

# æ¥çæè¿10åéæ´»è·çä»»å¡
$ sessions_list activeMinutes:10

# æ¥çå·ä½ä»»å¡çè¾åº
$ sessions_history sessionKey:"..." limit:50

# æç´¢ [DONE] æ è®°
$ sessions_history sessionKey:"..." | grep "\[DONE\]"

# ç»è®¡å·²å®æä»»å¡æ°
$ sessions_history sessionKey:"..." | grep -c "\[DONE\]"
</code></pre>
<h3 id="éè¯¯å¤çåæ¢å¤">éè¯¯å¤çåæ¢å¤</h3>
<p><strong>åºæ¯1ï¼OpenCode å¡ä½ï¼5åéæ è¾åºï¼</strong></p>
<pre><code class="language-bash"># æ£æ¥æåè¾åºæ¶é´
$ sessions_history sessionKey:"..." | tail -20

# åéå¤éä¿¡å·
$ sessions_send sessionKey:"..." message:"è¯·ç»§ç»­å®ç°ï¼ä»ä»»å¡2.1å¼å§"

# å¦ææ ååºï¼å¼ºå¶åæ­¢å¹¶éæ°å¯å¨
$ process action:kill sessionId:xxx
$ sessions_spawn task:"ç»§ç»­å®ç°ï¼ä»ä»»å¡2.1å¼å§" label:"resume-task"
</code></pre>
<p><strong>åºæ¯2ï¼çæä»£ç æè¯­æ³éè¯¯</strong></p>
<pre><code class="language-bash"># èªå¨è¿è¡è¯­æ³æ£æ¥
$ exec command:"cd aimier-kanban &amp;&amp; python3 -m py_compile app.py"

# å¦ææéè¯¯ï¼OpenClaw ä¼èªå¨åæå¹¶ç»åºå»ºè®®
</code></pre>
<hr>
<h2 id="è¸©åè®°å½">è¸©åè®°å½</h2>
<h3 id="å1ç´æ¥ä½¿ç¨-opencode-cli">å1ï¼ç´æ¥ä½¿ç¨ OpenCode CLI</h3>
<p><strong>é®é¢ï¼</strong> ç´æ¥å¨ç»ç«¯è¿è¡ <code>opencode run "..."</code>ï¼å¡ä½æ¶æ æ³æç¥ã</p>
<p><strong>è§£å³ï¼</strong> æ¹ç¨ OpenClaw ç <code>sessions_spawn</code>ï¼åå°è¿è¡ + å®æ¶çæ§ã</p>
<h3 id="å2ä»»å¡å¤ªå¤§ä¸æå">å2ï¼ä»»å¡å¤ªå¤§ï¼ä¸æåï¼</h3>
<p><strong>é®é¢ï¼</strong> è®© OpenCode ä¸æ¬¡æ§å®ç° 24 ä¸ªä»»å¡ï¼å¡å¨ä¸­é´ä¸å¨ã</p>
<p><strong>è§£å³ï¼</strong> æåä¸ºå¤ä¸ªå°åæ´ï¼æ¯ä¸ªåæ´ 8-16 ä¸ªä»»å¡ã</p>
<h3 id="å3ç¼ºä¹è¿åº¦åé¦">å3ï¼ç¼ºä¹è¿åº¦åé¦</h3>
<p><strong>é®é¢ï¼</strong> OpenCode ä¸æ¥åè¿åº¦ï¼ä¸ç¥éåå°åªäºã</p>
<p><strong>è§£å³ï¼</strong> å¨ tasks.md åæç¤ºè¯ä¸­å¼ºå¶è¦æ± <code>[DONE]</code> æ è®°ã</p>
<h3 id="å4ä¸ä¸æç¼ºå¤±">å4ï¼ä¸ä¸æç¼ºå¤±</h3>
<p><strong>é®é¢ï¼</strong> OpenCode ä¸ç¥éé¡¹ç®ç»æï¼éè¦åå¤è¯´æã</p>
<p><strong>è§£å³ï¼</strong> OpenClaw èªå¨è¯»å workspaceï¼æä¾å®æ´ä¸ä¸æã</p>
<hr>
<h2 id="ç»éªæ»ç»">ç»éªæ»ç»</h2>
<h3 id="æä½³å®è·µ">æä½³å®è·µ</h3>
<ol>
<li>
<p><strong>ä»»å¡æååå</strong></p>
<ul>
<li>å¤æåè½æåä¸ºå¤ä¸ªåæ´</li>
<li>æ¯ä¸ªåæ´ 8-16 ä¸ªä»»å¡</li>
<li>ä»»å¡ä¹é´ææç¡®ä¾èµé¡ºåº</li>
</ul>
</li>
<li>
<p><strong>æç¤ºè¯æ¨¡æ¿</strong></p>
<pre><code>è¯·ä¸¥æ ¼æç§ openspec/changes/&lt;change-name&gt;/tasks.md å®ç°ã

æ§è¡è¦æ±ï¼
1. æç¼å·é¡ºåºå®ææ¯ä¸ªä»»å¡
2. æ¯å®æä¸ä¸ªï¼è¾åºï¼[DONE] ä»»å¡X.X: &lt;æè¿°&gt;
3. å¨é¨å®æåè¾åºï¼[ALL DONE]
4. éå°é®é¢è¾åºï¼[ERROR]: &lt;æè¿°&gt;
</code></pre>
</li>
<li>
<p><strong>çæ§é¢ç</strong></p>
<ul>
<li>æ¯ 30 ç§æ£æ¥ä¸æ¬¡è¿åº¦</li>
<li>5 åéæ æ° <code>[DONE]</code> æ è®°è§ä¸ºå¡ä½</li>
<li>åå¤å¥½æå¨ååºç plan B</li>
</ul>
</li>
<li>
<p><strong>å·¥å·é¾ç»å</strong></p>
<table>
<thead>
<tr>
<th>å·¥å·</th>
<th>ä½ç¨</th>
<th>ä¼å¿</th>
</tr>
</thead>
<tbody>
<tr>
<td>OpenClaw</td>
<td>ä»»å¡ç®¡ç</td>
<td>ä¼è¯ãçæ§ãéè¯¯å¤ç</td>
</tr>
<tr>
<td>OpenSpec</td>
<td>è§èå®ä¹</td>
<td>ç»æåéæ±ãæäºè¿½æº¯</td>
</tr>
<tr>
<td>OpenCode</td>
<td>ä»£ç çæ</td>
<td>æè§èèªå¨å®ç°</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h3 id="éç¨åºæ¯">éç¨åºæ¯</h3>
<p><strong>éåï¼</strong></p>
<ul>
<li>â åè½æç¡®ãè¾¹çæ¸æ°çéæ±</li>
<li>â éå¤æ§ç CRUD æä½</li>
<li>â æ°æ®åºè¿ç§»ãAPI å¼å</li>
<li>â åºäºç°ææ¨¡å¼çæ©å±</li>
</ul>
<p><strong>ä¸éåï¼</strong></p>
<ul>
<li>â éæ±æ¨¡ç³ãéè¦æ¢ç´¢</li>
<li>â å¤ææ¶æè®¾è®¡</li>
<li>â æ·±åº¦æ§è½ä¼å</li>
<li>â åæ°æ§ç®æ³</li>
</ul>
<h3 id="æ§è½åºåæ èæ´¾-4b-å®æµ">æ§è½åºåï¼æ èæ´¾ 4B å®æµï¼</h3>
<table>
<thead>
<tr>
<th>åä¸ªåæ´ä»»å¡æ°</th>
<th>æåç</th>
<th>å¹³åèæ¶</th>
<th>æ¨èåº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>3-6 ä¸ª</td>
<td>95%</td>
<td>3-5åé</td>
<td>â­â­â­â­â­</td>
</tr>
<tr>
<td>7-10 ä¸ª</td>
<td>85%</td>
<td>5-10åé</td>
<td>â­â­â­â­</td>
</tr>
<tr>
<td>11-16 ä¸ª</td>
<td>70%</td>
<td>10-15åé</td>
<td>â­â­â­</td>
</tr>
<tr>
<td>&gt;16 ä¸ª</td>
<td>&lt;30%</td>
<td>å¡ä½</td>
<td>â ä¸æ¨è</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="å®æ´å·¥ä½æµç¤ºä¾">å®æ´å·¥ä½æµç¤ºä¾</h2>
<p><strong>ä»éæ±å°é¨ç½²çæ åæµç¨ï¼</strong></p>
<pre><code>1. éæ±åæï¼ä»»çªï¼
   â
2. åå»º OpenSpec åæ´
   $ openspec change new feature-name
   â
3. ç¼åè§èææ¡£
   - proposal.mdï¼ä¸ºä»ä¹è¦åï¼
   - design.mdï¼æä¹åï¼
   - tasks.mdï¼ä»»å¡æ¸åï¼â¤16ä¸ªä»»å¡ï¼
   â
4. OpenClaw è°ç¨ OpenCode
   $ sessions_spawn task:"å®ç°åè½" label:"implement-feature"
   â
5. å®æ¶çæ§åç®¡ç
   $ sessions_list
   $ sessions_history sessionKey:"..."
   â
6. ä»£ç éªè¯
   - èªå¨è¯­æ³æ£æ¥
   - åè½æµè¯
   â
7. æäº¤åæ¨é
   $ git add .
   $ git commit -m "å®ç°åè½"
   $ git push
   â
8. å½æ¡£è§è
   $ openspec change archive feature-name
</code></pre>
<hr>
<h2 id="ç»è¯­">ç»è¯­</h2>
<p>ç¨ OpenClaw è°ç¨ OpenCode è¿è¡å¼åï¼æå¤§çä»·å¼æ¯<strong>å¯æ§æ§</strong>ã</p>
<ul>
<li>ä»»å¡å¨åå°è¿è¡ï¼ä¸é»å¡å½åä¼è¯</li>
<li>å®æ¶çæ§è¿åº¦ï¼ç¥éåå°åªäº</li>
<li>å¡ä½æ¶èªå¨å¤çææ¥è­¦</li>
<li>ææå·¥ä½å¯è¿½æº¯ãå¯ç®¡ç</li>
</ul>
<p>ä½è¿å¥å·¥å·é¾ä¹æå±éãå®éå<strong>æ§è¡æç¡®çéæ±</strong>ï¼ä¸éå<strong>æ¢ç´¢æªç¥çé®é¢</strong>ãå³é®è¿æ¯<strong>æéæ±æ³æ¸æ¥</strong>ââè¿æ¯ç¨åºåçå·¥ä½ï¼AI æ æ³æ¿ä»£ã</p>
<p>å¦æä½ ä¹å¨å°è¯ç±»ä¼¼çå·¥ä½æµï¼æ¬¢è¿äº¤æµè¸©åç»éªã</p>
<hr>
<h2 id="åèé¾æ¥">åèé¾æ¥</h2>
<ul>
<li>OpenClaw ææ¡£ï¼<a href="https://docs.openclaw.ai" target="_blank" rel="noopener nofollow">https://docs.openclaw.ai</a></li>
<li>OpenSpec ä»åºï¼<a href="https://github.com/fission-ai/openspec" target="_blank" rel="noopener nofollow">https://github.com/fission-ai/openspec</a></li>
<li>OpenCode ææ¡£ï¼<a href="https://opencode.ai" target="_blank" rel="noopener nofollow">https://opencode.ai</a></li>
<li>ç±å¼¥å¿ä»»å¡çæ¿ï¼<a href="https://github.com/ren8179/aimier-kanban" target="_blank" rel="noopener nofollow">https://github.com/ren8179/aimier-kanban</a></li>
</ul>
<hr>
<p><em>æ¬ææ¯ç±å¼¥å¿ä»»å¡çæ¿å¼åè¿ç¨ä¸­ççå®è®°å½ï¼ç± AI å©æç±å¼¥å¿æ´çæ°åã</em></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 08:56">2026-02-13 08:56</span>&nbsp;
<a href="https://www.cnblogs.com/rsls">äºè´éç©º</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19606311);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19606311', targetLink: 'https://www.cnblogs.com/rsls/p/19606311', title: 'AIå·¥å·å®è·µæ¥è®°ï¼äºï¼ï¼å¨ OpenClaw ä¸­è°ç¨ OpenCode è¿è¡å¼åä»»å¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>