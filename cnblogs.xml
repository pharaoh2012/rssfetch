<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-01-07T08:25:08.183Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ 51åçæº__LEDç¸å³ ]]></title>
    <link>https://www.cnblogs.com/WIRO/p/19452806</link>
    <guid>498bb5d1d929fab89310d7e4b1ce1ff7</guid>
    <description>
    <![CDATA[ 
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/WIRO/p/19452806" title="åå¸äº 2026-01-07 16:06">
    <span role="heading" aria-level="2">51åçæº__LEDç¸å³</span>
    

</a>

		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="51åçæº__ledç¸å³">51åçæº__LEDç¸å³</h1>
<h2 id="åçæºä»ç»">åçæºä»ç»</h2>
<p>åçæºï¼è±æMicro Controller Unitï¼ç®ç§°MCU<br>
åé¨éæäºCPUãRAMãROMãå®æ¶å¨ãä¸­æ­ç³»ç»ãéè®¯æ¥å£ç­ä¸ç³»åçµèçå¸¸ç¨ç¡¬ä»¶åè½<br>
åçæºçä»»å¡æ¯ä¿¡æ¯ééï¼ä¾é ä¼ æå¨ï¼ãå¤çï¼ä¾é CPUï¼åç¡¬ä»¶è®¾å¤ï¼ä¾å¦çµæºï¼LEDç­ï¼çæ§å¶<br>
åçæºè·è®¡ç®æºç¸æ¯ï¼åçæºç®æ¯ä¸ä¸ªè¢ççè®¡ç®æºï¼ä¸ä¸ªè¯çå°±è½ææå®æ´çè®¡ç®æºç³»ç»ãä½å¨æ§è½ä¸ï¼ä¸è®¡ç®æºç¸å·®çè¿ï¼ä½åçæºææ¬ä½ãä½ç§¯å°ãç»æç®åï¼å¨çæ´»åå·¥ä¸æ§å¶é¢åå¤§ææç¨<br>
åæ¶ï¼å­¦ä¹ ä½¿ç¨åçæºæ¯äºè§£è®¡ç®æºåçä¸ç»æçæä½³éæ©</p>
<h2 id="åçæºåºç¨">åçæºåºç¨</h2>
<p>åçæºçä½¿ç¨é¢åå·²ååå¹¿æ³ï¼å¦æºè½ä»ªè¡¨ãå®æ¶å·¥æ§ãéè®¯è®¾å¤ãå¯¼èªç³»ç»ãå®¶ç¨çµå¨ç­ãåç§äº§åä¸æ¦ç¨ä¸äºåçæºï¼å°±è½èµ·å°ä½¿äº§ååçº§æ¢ä»£çåæï¼å¸¸å¨äº§ååç§°åå ä»¥å½¢å®¹è¯âââæºè½åâï¼å¦æºè½åæ´è¡£æºç­ã</p>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519528-2082922721.png" alt="image-20260107113142288" loading="lazy"></p>
<h2 id="stc89c52åçæº">STC89C52åçæº</h2>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519123-1391531477.png" alt="image-20260107113244328" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519527-1511351430.png" alt="image-20260107113324739" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519188-402559776.png" alt="image-20260107113519962" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519297-1849899687.png" alt="image-20260107113540042" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519274-1889121421.png" alt="image-20260107113612706" loading="lazy"></p>
<h2 id="å¼åæ¿åçå¾åå¤ä½åè·¯">å¼åæ¿åçå¾åå¤ä½åè·¯</h2>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519312-2037859992.png" alt="image-20260107113715018" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519369-1523164322.png" alt="image-20260107114043371" loading="lazy"></p>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519480-912853277.png" alt="image-20260107114127756" loading="lazy"></p>
<h1 id="åå»ºå·¥ç¨å¹¶å®ç°ledæ§å¶">åå»ºå·¥ç¨å¹¶å®ç°LEDæ§å¶</h1>
<h2 id="1ç¹äº®ledç¯">1ï¼ç¹äº®LEDç¯</h2>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519089-1326428079.png" alt="image-20260107115032547" loading="lazy"></p>
<p>è§å¯åçå¾ï¼LEDç¯ä½çµå¹³ç¹äº®ï¼ä¸é¢å¼å§ç¼åä»£ç ï¼</p>
<pre><code class="language-c">#include &lt;REGX52.H&gt;

void main()
{
	P2 = 0;
}

// ç°è±¡:ææLEDç¯åè¢«ç¹äº®
</code></pre>
<h2 id="2å®ç°led_1ç¯éªç">2ï¼å®ç°LED_1ç¯éªç</h2>
<p><strong>å»¶æ¶æ¹æ³ä¸å®ç°ï¼</strong></p>
<p>éè¿åçæºé©±å¨å¤å´æ¾ç¤ºçµè·¯ï¼ä¸ºäºè½å¤è®©äººç¼è¯å«å°ææ¾ç¤ºåå®¹çååï¼éè¦ä¿è¯ææ¾ç¤ºçåå®¹ææåçãå¨åçæºä¸­ï¼å®ç°è¿ä¸æææä¸¤ç§æ¹å¼ï¼ä¸ç§æ¯éè¿Cè¯­è¨ç¼åä¸æ®µå»¶æ¶ææçç¨åºæèå­ç¨åºï¼å®ç°è¯¥ç®çãå¦ä¸ç§æ¯è°ç¨åçæºèªå¸¦çå®å¼/è®¡æ°å¨ï¼è¿éææ¶ä½¿ç¨ç¬¬ä¸ç§æ¹å¼ã</p>
<p>ä½¿ç¨åçæºç§å½è½¯ä»¶AiCube-ISP-v6.96Aï¼çæä¸æ®µ500msçå»¶æ¶å½æ°ã</p>
<pre><code class="language-c">// å»¶æ¶500ms
void Delay500ms(void)	//@11.0592MHz
{
	unsigned char data i, j, k;

	_nop_();
	i = 4;
	j = 129;
	k = 119;
	do
	{
		do
		{
			while (--k);
		} while (--j);
	} while (--i);
}
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519161-1654264043.png" alt="image-20260107120433086" loading="lazy"></p>
<pre><code class="language-c">#include &lt;REGX52.H&gt;
#include &lt;INTRINS.H&gt;  // è§£å³ _nop_ æ¥é

// å»¶æ¶500ms
void Delay500ms(void)	//@11.0592MHz
{
	unsigned char data i, j, k;

	_nop_();
	i = 4;
	j = 129;
	k = 119;
	do
	{
		do
		{
			while (--k);
		} while (--j);
	} while (--i);
}

void main()
{
	while(1)
	{	
		P2 = 0xFE;     // 1111 1110
		Delay500ms();  // å»¶æ¶0.5s
		P2 = 0xFF;     // 1111 1111
		Delay500ms();  // å»¶æ¶0.5s
	}
}

// ç°è±¡: LED_1 éªçï¼å¶ä»LEDç¯ä¸äº®
</code></pre>
<h2 id="3å®ç°ledæµæ°´ç¯">3ï¼å®ç°LEDæµæ°´ç¯</h2>
<h3 id="ç¬¬ä¸ç§æ¹å¼ä½¿ç¨æ°ç»å®ç°æµæ°´ç¯ææ"><strong>ç¬¬ä¸ç§æ¹å¼ï¼ä½¿ç¨æ°ç»å®ç°æµæ°´ç¯ææ</strong></h3>
<pre><code class="language-c">#include &lt;REGX52.H&gt;
#include &lt;INTRINS.H&gt;  // è§£å³ _nop_ æ¥é


// å»¶æ¶500ms
void Delay500ms(void)	//@11.0592MHz
{
	unsigned char data i, j, k;

	_nop_();
	i = 4;
	j = 129;
	k = 119;
	do
	{
		do
		{
			while (--k);
		} while (--j);
	} while (--i);
}

// å®ä¹æµæ°´ç¯æ°ç»
unsigned char LedCode[] = {0xFE,0xFD,0xFB,0xF7,0Xef,0xDF,0xBF,0x7F};

void main()
{
	unsigned char i;
	while(1)
	{	
		for(i = 0;i &lt; 8;i ++)
		{
			P2 = LedCode[i];
			Delay500ms();
		}
	}
}

// ç°è±¡ï¼LEDç¯ä»ä½å°é«ä¾æ¬¡ç¹äº®

//éå åå®¹ï¼
//0xFE  1111 1110
//0xFD  1111 1101
//0xFB  1111 1011
//0xF7  1111 0111
//0Xef  1110 1111
//0xDF  1101 1111
//0xBF  1011 1111
//0x7F  0111 1111
</code></pre>
<h3 id="ç¬¬äºç§æ¹å¼å·¦å³ç§»è¿ç®ç¬¦å®ç°"><strong>ç¬¬äºç§æ¹å¼ï¼å·¦å³ç§»è¿ç®ç¬¦å®ç°</strong></h3>
<pre><code class="language-c">#include &lt;REGX52.H&gt;
#include &lt;INTRINS.H&gt;  // è§£å³ _nop_ æ¥é


// å»¶æ¶500ms
void Delay500ms(void)	//@11.0592MHz
{
	unsigned char data i, j, k;

	_nop_();
	i = 4;
	j = 129;
	k = 119;
	do
	{
		do
		{
			while (--k);
		} while (--j);
	} while (--i);
}


void main() {
    unsigned char Led = 0x01; // 0000 0001
    
    while(1) {
        P2 = ~Led;      // ååï¼è¾åºå°P2ç«¯å£
        Delay500ms();   // å»¶æ¶500ms
        
        // ä½¿ç¨å·¦ç§»è¿ç®ç¬¦
        Led = Led &lt;&lt; 1;
        
        // å¦æç§»å°æå³è¾¹ï¼éæ°ä»æå·¦è¾¹å¼å§
        if(Led == 0x00) {
            Led = 0x01;
        }
    }
}

// ç°è±¡ï¼LEDç¯ä»ä½å°é«ä¾æ¬¡ç¹äº®
</code></pre>
<h3 id="ç¬¬ä¸ç§æ¹å¼å¾ªç¯å·¦å³ç§»å½æ°çè°ç¨"><strong>ç¬¬ä¸ç§æ¹å¼ï¼å¾ªç¯å·¦å³ç§»å½æ°çè°ç¨</strong></h3>
<h3 id="1-cror---å¾ªç¯å³ç§»å½æ°">1. <strong><em>cror</em>() - å¾ªç¯å³ç§»å½æ°</strong></h3>
<p><strong>å¤´æä»¶ï¼</strong> <code>#include &lt;intrins.h&gt;</code><br>
<strong>ååï¼</strong> <code>unsigned char _cror_(unsigned char val, unsigned char n);</code></p>
<p><strong>åè½ï¼</strong> å° 8 ä½æ°æ®å¾ªç¯å³ç§» n ä½ï¼ç§»åºçä½ä»å·¦è¾¹è¡¥å¥</p>
<p><strong>ç¤ºä¾ï¼</strong></p>
<pre><code class="language-c">unsigned char data = 0x81;  // äºè¿å¶ï¼10000001
data = _cror_(data, 1);     // ç»æï¼0xC0 (11000000)
// åï¼10000001 â å³ç§»1ä½ â 11000000
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519436-108965670.png" alt="image-20260107153044727" loading="lazy"></p>
<h3 id="2-crol---å¾ªç¯å·¦ç§»å½æ°">2. <strong><em>crol</em>() - å¾ªç¯å·¦ç§»å½æ°</strong></h3>
<p><strong>å¤´æä»¶ï¼</strong> <code>#include &lt;intrins.h&gt;</code><br>
<strong>ååï¼</strong> <code>unsigned char _crol_(unsigned char val, unsigned char n);</code></p>
<p><strong>åè½ï¼</strong> å° 8 ä½æ°æ®å¾ªç¯å·¦ç§» n ä½ï¼ç§»åºçä½ä»å³è¾¹è¡¥å¥</p>
<p><strong>ç¤ºä¾ï¼</strong></p>
<pre><code class="language-c">unsigned char data = 0x81;  // äºè¿å¶ï¼10000001
data = _crol_(data, 1);     // ç»æï¼0x03 (00000011)
// åï¼10000001 â å·¦ç§»1ä½ â 00000011
</code></pre>
<p><img src="https://img2024.cnblogs.com/blog/3732387/202601/3732387-20260107160519302-1190082079.png" alt="image-20260107153844168" loading="lazy"></p>
<p>æµæ°´ç¯åºç¨ç¤ºä¾ï¼</p>
<pre><code class="language-c">#include &lt;REGX52.H&gt;
#include &lt;INTRINS.H&gt;  // è§£å³ _nop_ æ¥é


// å»¶æ¶500ms
void Delay500ms(void)	//@11.0592MHz
{
	unsigned char data i, j, k;

	_nop_();
	i = 4;
	j = 129;
	k = 119;
	do
	{
		do
		{
			while (--k);
		} while (--j);
	} while (--i);
}


void main() 
	{
		unsigned char aa;
		aa = 0xFE;  // 1111 1110
		
		while(1)
		{
			P2 = aa;
			Delay500ms();
			aa = _crol_(aa,1);  // å¾ªç¯å·¦ç§»å½æ°
		}

	}

// ç°è±¡ï¼LEDç¯ä»ä½å°é«ä¾æ¬¡ç¹äº®
</code></pre>
<p><strong>æ³¨æï¼</strong> è¿ä¸¤ä¸ªå½æ°æ¯ C51 ç¼è¯å¨ç¹æï¼ä»éç¨äº 51 åçæºå¼åã</p>
<h2 id="ç»¼åç»ä¹ ååæµæ°´ç¯">ç»¼åç»ä¹ ï¼ååæµæ°´ç¯</h2>
<pre><code class="language-c">#include &lt;REGX52.H&gt;
#include &lt;INTRINS.H&gt;  // åå«ç§»ä½å½æ°å¤´æä»¶

// å»¶æ¶500ms
void Delay500ms(void)	//@11.0592MHz
{
	unsigned char data i, j, k;

	_nop_();
	i = 4;
	j = 129;
	k = 119;
	do
	{
		do
		{
			while (--k);
		} while (--j);
	} while (--i);
}

void main() 
{
    unsigned char aa;
    unsigned char direction = 0;  // 0:å·¦ç§», 1:å³ç§»
    unsigned char counter = 0;    // è®¡æ°å·¦ç§»/å³ç§»çæ¬¡æ°
    
    aa = 0xFE;  // 1111 1110ï¼ç¬¬ä¸ä¸ªç¯äº®
    
    while(1)
    {
        P2 = aa;
        Delay500ms();
        
        // å·¦ç§»8æ¬¡åæ¹ä¸ºå³ç§»
        if(direction == 0)
        {
            aa = _crol_(aa, 1);  // å¾ªç¯å·¦ç§»
            counter++;
            
            if(counter &gt;= 7)  // å·¦ç§»7æ¬¡åï¼å±8ä¸ªç¶æï¼
            {
                direction = 1;  // æ¹ä¸ºå³ç§»æ¹å
                counter = 0;    // è®¡æ°å¨æ¸é¶
            }
        }
        // å³ç§»8æ¬¡åæ¹ä¸ºå·¦ç§»
        else
        {
            aa = _cror_(aa, 1);  // å¾ªç¯å³ç§»
            counter++;
            
            if(counter &gt;= 7)  // å³ç§»7æ¬¡åï¼å±8ä¸ªç¶æï¼
            {
                direction = 0;  // æ¹ä¸ºå·¦ç§»æ¹å
                counter = 0;    // è®¡æ°å¨æ¸é¶
            }
        }
    }
}

// ç°è±¡ï¼LEDå·¦å³ä¾æ¬¡ç¹äº®
</code></pre>

</div>
<div class="clear"></div>

		</div>
		<div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-07 16:07">2026-01-07 16:06</span>&nbsp;
<a href="https://www.cnblogs.com/WIRO">Q&amp;25</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19452806);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19452806', targetLink: 'https://www.cnblogs.com/WIRO/p/19452806', title: '51åçæº__LEDç¸å³' })">ä¸¾æ¥</a>
</div>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ XAML Studio å·²æ­£å¼å¼æº ]]></title>
    <link>https://www.cnblogs.com/shanyou/p/19452660</link>
    <guid>9ae3abb7b33781bc8e23fc110503bdf7</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/shanyou/p/19452660" title="åå¸äº 2026-01-07 15:46">
    <span role="heading" aria-level="2">XAML Studio å·²æ­£å¼å¼æº</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p>å¾®è½¯å¼åèåå®¢äº 2026 å¹´ 1 æ 6 æ¥æ­£å¼å®£å¸(<a title="https://devblogs.microsoft.com/ifdef-windows/xaml-studio-is-now-open-sourced/" href="https://devblogs.microsoft.com/ifdef-windows/xaml-studio-is-now-open-sourced/" rel="noopener nofollow">https://devblogs.microsoft.com/ifdef-windows/xaml-studio-is-now-open-sourced/</a>)ï¼<b>XAML Studio å·²æ­£å¼å¼æº</b>ï¼å¹¶æä¸ºäº .NET åºéä¼ï¼.NET Foundationï¼æä¸çä¸ä¸ªç§å­é¡¹ç®ã</p><h5><font face="å¾®è½¯éé» Light" size="3">1. ä»ä¹æ¯ XAML Studioï¼</font></h5><p><font face="å¾®è½¯éé» Light" size="3">XAML Studio æ¯ä¸æ¬¾ä¸ä¸º <b>WinUI</b> å¼åèæé çè¾å©å·¥å·ï¼æåæ¯ Microsoft Garageï¼å¾®è½¯è½¦åºï¼çä¸ä¸ªé¡¹ç®ãå®åè®¸å¼åèå¨ä¸åå»ºå®æ´å·¥ç¨çæåµä¸ï¼å¿«éè¿è¡ XAML çé¢ååè®¾è®¡åäº¤äºè°è¯ã</font></p><p><font face="å¾®è½¯éé» Light" size="3">å¶æ ¸å¿åè½åæ¬ï¼</font></p><ul><li><p><font face="å¾®è½¯éé» Light"><font size="3"><b>å®æ¶ç¼è¾ä¸é¢è§</b>ï¼å³æ¶æ¥ç XAML ä»£ç çææã</font></font></p></li><li><p><font face="å¾®è½¯éé» Light"><font size="3"><b>ç»å®è°è¯å¨ (Binding Debugger)</b>ï¼ç´è§ææ¥æ°æ®ç»å®é®é¢ã</font></font></p></li><li><p><font face="å¾®è½¯éé» Light"><font size="3"><b>æ°æ®ä¸ä¸æç¼è¾å¨</b>ï¼å¿«éæ¨¡ææµè¯æ°æ®ã</font></font></p></li><li><p><font face="å¾®è½¯éé» Light"><font size="3"><b>IntelliSense ä¸ææ¡£å·¥å·ç®±</b>ï¼æä¾ä»£ç è¡¥å¨åæ§ä»¶æ¥éã</font></font></p></li></ul><h5><font face="å¾®è½¯éé» Light" size="3">2. å¼æºèæ¯ä¸ç°ç¶</font></h5><ul><li><p><font face="å¾®è½¯éé» Light"><font size="3"><b>é¡¹ç®åç¨</b>ï¼è¯¥é¡¹ç®å§äº 8 å¹´åï¼ä¸ç´è®¡åå¼æºï¼å¦ä»ç»äºå®ç°ã</font></font></p></li><li><p><font face="å¾®è½¯éé» Light"><font size="3"><b>V2 çæ¬</b>ï¼ç®åå¼æºçæ¯æ­£å¨å¼åä¸­ç <b>XAML Studio v2</b>ãç¸æ¯ååºéç 1.1 çæ¬ï¼v2 éç¨äºå¨æ°ççé¢ï¼å¹¶éå¯¹ WinUI 3 è¿è¡äºä¼åã</font></font></p></li><li><p><font face="å¾®è½¯éé» Light"><font size="3"><b>ç¤¾åºè´¡ç®</b>ï¼XAML Studio çè®¸å¤æ ¸å¿ç»ä»¶æ©å·²åé¦ç»ç¤¾åºï¼ä¾å¦ <b>Windows Community Toolkit (WCT)</b> ä¸­ç <code>SwitchPresenter</code>ã<code>Sizer</code> æ§ä»¶ï¼å¦ <code>GridSplitter</code> çæ¹è¿çï¼ä»¥åå®éªæ§ç <b>Adornersï¼è£é¥°å¨ï¼</b> åè½ï¼æåé½æºäº XAML Studioã</font></font></p></li></ul><h5><font face="å¾®è½¯éé» Light" size="3">3. æªæ¥è®¡å</font></h5><ul><li><p><font face="å¾®è½¯éé» Light"><font size="3"><b>å¼ååæ¯</b>ï¼å¼åèç®åå¯ä»¥ä» GitHub ç <code>dev</code> åæ¯è·å v2 çæ¬çæºä»£ç å¹¶èªè¡æå»ºã</font></font></p></li><li><p><font face="å¾®è½¯éé» Light"><font size="3"><b>æ­£å¼åå¸</b>ï¼å¼åå¢éè®¡åå¨ 2026 å¹´æäºæ¶åå¨ Microsoft Store åå¸ v2 çæ­£å¼ç¨³å®çã</font></font></p></li><li><p><font face="å¾®è½¯éé» Light"><font size="3"><b>åä¸æ¹å¼</b>ï¼å¾®è½¯é¼å±å¼åèéè¿ GitHub æäº¤åé¦ãå»ºè®®æç´æ¥è´¡ç®ä»£ç ã</font></font></p></li></ul><p><b><font face="å¾®è½¯éé» Light" size="3">ç¸å³èµæºï¼</font></b></p><ul><li><p><font face="å¾®è½¯éé» Light"><font size="3"><b>GitHub ä»åº</b>ï¼</font></font><a href="https://www.google.com/search?q=https://github.com/microsoft/XamlStudio" rel="noopener nofollow"><font face="å¾®è½¯éé» Light" size="3">microsoft/XamlStudio</font></a><font face="å¾®è½¯éé» Light" size="3">ï¼æéè¿ .NET Foundation æ¥æ¾ï¼ã</font></p></li><li><p><font face="å¾®è½¯éé» Light"><font size="3"><b>å®æ¹åå®¢å¨æ</b>ï¼</font></font><a href="https://devblogs.microsoft.com/ifdef-windows/xaml-studio-is-now-open-sourced/" rel="noopener nofollow"><font face="å¾®è½¯éé» Light" size="3">XAML Studio is now Open Sourced</font></a></p></li></ul><p>è¿å¯¹ WinUI å¼åèæ¥è¯´æ¯ä¸ä¸ªéè¦çéç¨ç¢ï¼ä¸ä»å·¥å·æ¬èº«åå¾éæãå¯å®å¶ï¼ä¹é¢ç¤ºç WinUI çæç³»ç»çè¿ä¸æ­¥å¼æ¾ã</p>
</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬¢è¿å¤§å®¶æ«æä¸é¢äºç»´ç æä¸ºæçå®¢æ·ï¼æ¶ä½ ä¸äº</p>
<img src="https://images.cnblogs.com/cnblogs_com/shanyou/57459/o_220125090408_%E9%82%80%E8%AF%B7%E4%BA%8C%E7%BB%B4%E7%A0%81-258px.jpeg" width="170">
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-07 15:47">2026-01-07 15:46</span>&nbsp;
<a href="https://www.cnblogs.com/shanyou">å¼ åå</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">1</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19452660);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19452660', targetLink: 'https://www.cnblogs.com/shanyou/p/19452660', title: 'XAML Studio å·²æ­£å¼å¼æº' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãç»æè¸©åæåãWindows 10ä¸MsQuicè¯ä¹¦å è½½å¤±è´¥ï¼åä¸å¨è¯ä¹¦ï¼èå¨Schannelï¼ ]]></title>
    <link>https://www.cnblogs.com/haibindev/p/19452652</link>
    <guid>83a97c02bb766798acb4bc490764356b</guid>
    <description>
    <![CDATA[ 
	<div class="postTitle">
		<h1><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/haibindev/p/19452652" title="åå¸äº 2026-01-07 15:45">
    <span role="heading" aria-level="2">ãç»æè¸©åæåãWindows 10ä¸MsQuicè¯ä¹¦å è½½å¤±è´¥ï¼åä¸å¨è¯ä¹¦ï¼èå¨Schannelï¼</span>
    

</a>
</h1>
	</div>
	    <div id="cnblogs_post_description" style="display: none">
        
        æè¦ï¼å¦æä½ å¨Windows 10ä¸è¢« ConfigurationLoadCredential failed, 0x80070490 æ E_NOINTERFACE éè¯¯æç£¨è¯ä¹ï¼è¯éææè¯ä¹¦æ¹æ¡ä»æ è§£ï¼é£ä¹æ­åï¼æ¬æå°±æ¯ä½ çç»ç¹ç«ãçæ­£åå æå¯è½æ¯ï¼æ°çMsQuicå·²é»è®¤æ¾å¼å¯¹Windows 10ä¸Schannelçæ¯æãæ éåæè¾è¯ä¹¦ï¼åæ¢è³OpenSSLåç«¯å³å¯ä¸é®è§£å³ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ç»æè¸©åæåwindows-10ä¸msquicè¯ä¹¦å è½½å¤±è´¥åä¸å¨è¯ä¹¦èå¨schannel">ãç»æè¸©åæåãWindows 10ä¸MsQuicè¯ä¹¦å è½½å¤±è´¥ï¼åä¸å¨è¯ä¹¦ï¼èå¨Schannelï¼</h1>
<blockquote>
<p><strong>æè¦</strong>ï¼å¦æä½ å¨Windows 10ä¸è¢« <code>ConfigurationLoadCredential failed, 0x80070490</code> æ <code>E_NOINTERFACE</code> éè¯¯æç£¨è¯ä¹ï¼è¯éææè¯ä¹¦æ¹æ¡ä»æ è§£ï¼é£ä¹æ­åï¼æ¬æå°±æ¯ä½ çç»ç¹ç«ãçæ­£åå æå¯è½æ¯ï¼<strong>æ°çMsQuicå·²é»è®¤æ¾å¼å¯¹Windows 10ä¸Schannelçæ¯æ</strong>ãæ éåæè¾è¯ä¹¦ï¼åæ¢è³OpenSSLåç«¯å³å¯ä¸é®è§£å³ã</p>
</blockquote>
<h3 id="ä¸é®é¢ç°è±¡ä¸ä¸ªæå·è¿·ææ§çéè¯¯"><strong>ä¸ãé®é¢ç°è±¡ï¼ä¸ä¸ªæå·è¿·ææ§çéè¯¯</strong></h3>
<p>ç¯å¢ï¼Windows 10 22H2ï¼ä½¿ç¨GitHubä¸»çº¿çæ¬MsQuicç¼è¯QUIC Serverã</p>
<p>å¨è°ç¨ <code>MsQuic-&gt;ConfigurationLoadCredential(...)</code> æ¶ï¼ç¨³å®å¤±è´¥ï¼è¿åéè¯¯ï¼</p>
<pre><code>ConfigurationLoadCredential failed, 0x80070490
</code></pre>
<p>æèï¼</p>
<pre><code>E_NOINTERFACE
</code></pre>
<p><strong>ææè¿¹è±¡é½æåè¯ä¹¦é®é¢</strong>ï¼äºæ¯å¼å§äºæ¼«é¿çâè¸©åâä¹æã</p>
<h3 id="äºææ¥å¼¯è·¯æè¢«è¯ä¹¦é®é¢å¸¦åçå¨è¿ç¨"><strong>äºãææ¥å¼¯è·¯ï¼æè¢«âè¯ä¹¦é®é¢âå¸¦åçå¨è¿ç¨</strong></h3>
<p>ä»¥ä¸æ¯æçææ¥æµæ°´è´¦ï¼å ä¹è¯éäºWindowsä¸ææè¯ä¹¦æ¹æ¡ï¼</p>
<ol>
<li>
<p><strong>è¯ä¹¦åå¸ï¼å®æ¹æ¨èï¼</strong></p>
<pre><code class="language-cpp">QUIC_CERTIFICATE_HASH CertHash{};
memcpy(CertHash.ShaHash, hashbuf_.data(), 20);
CredConfig.Type = QUIC_CREDENTIAL_TYPE_CERTIFICATE_HASH;
</code></pre>
<p><strong>ç»æ</strong>ï¼<code>HRESULT_FROM_WIN32(ERROR_NOT_FOUND)</code>ãç¡®è®¤è¯ä¹¦å¨æ¬å°è®¡ç®æºå­å¨ãæç§é¥ãéªè¯éè¿ï¼ä½å°±æ¯ä¸è¡ã</p>
</li>
<li>
<p><strong>åå¸å­å¨ï¼æ¾å¼æå®ä»åºï¼</strong></p>
<pre><code class="language-cpp">strcpy_s(CertHashStore.StoreName, "LocalMachine\\My");
CredConfig.Type = QUIC_CREDENTIAL_TYPE_CERTIFICATE_HASH_STORE;
</code></pre>
<p><strong>ç»æ</strong>ï¼<code>E_INVALIDARG</code>ã</p>
</li>
<li>
<p><strong>æçè¯ä¹¦çææ¹å¼</strong><br>
æçOpenSSLçæçè¯ä¹¦ä¸è¡ï¼æ¢ç¨PowerShellçæâçº¯æ­£âçCNGè¯ä¹¦ï¼</p>
<pre><code class="language-powershell">New-SelfSignedCertificate -Provider "Microsoft Software Key Storage Provider" ...
</code></pre>
<p><strong>ç»æ</strong>ï¼å¤±è´¥ä¾æ§ã</p>
</li>
<li>
<p><strong>ç»æå°è¯ï¼PFXæä»¶</strong></p>
<pre><code class="language-cpp">CredConfig.Type = QUIC_CREDENTIAL_TYPE_CERTIFICATE_FILE_PROTECTED;
</code></pre>
<p><strong>ç»æ</strong>ï¼çæç <code>E_NOINTERFACE</code>ã</p>
</li>
<li>
<p><strong>å³é®è½¬æç¹ï¼å®æ¹ç¤ºä¾ä¹æäº</strong><br>
å½æçäººçæ¶ï¼ç´æ¥æµè¯MsQuicèªå¸¦ç <code>quicsample.exe</code>ï¼</p>
<pre><code class="language-bash">quicsample.exe -server -cert_hash:&lt;your_thumbprint&gt;
</code></pre>
<p><strong>åæ ·å¤±è´¥ï¼</strong> è¿è¯æé®é¢ä¸æçä»£ç æ å³ï¼æ¯<strong>ç¯å¢æåºæ¬èº«çé®é¢</strong>ã</p>
</li>
</ol>
<h3 id="ä¸çç¸æ­é²ä¸æ¯è¯ä¹¦çéæ¯schannelæäºé¾å­"><strong>ä¸ãçç¸æ­é²ï¼ä¸æ¯è¯ä¹¦çéï¼æ¯Schannelæäºé¾å­</strong></h3>
<p>ææææ¥é½å¤±æåï¼æå°ç®åä»è¯ä¹¦ç§»å¼ï¼æç»éå®æ ¸å¿çç¾ï¼</p>
<blockquote>
<p><strong>å½åè¾æ°çæ¬çMsQuicï¼å¨Windows 10ç³»ç»ä¸ï¼å¶é»è®¤çSchannel TLSåç«¯å¯è½å·²æ æ³æ­£å¸¸å è½½æå¡å¨è¯ä¹¦ã</strong></p>
</blockquote>
<p>è¿æ¯ä¸ä¸ª<strong>å®æ¹ææ¡£æªæç¡®æ æ³¨ãä½å®éå­å¨çå¼å®¹æ§æ­ç¹</strong>ãéè¯¯ <code>0x80070490</code> (æ¾ä¸å°åç´ ) å <code>E_NOINTERFACE</code> æå·è¯¯å¯¼æ§ï¼è®©ä½ å¨è¯ä¹¦çè¿·å®«éæ éæè½¬ï¼èçæ­£çåºå£æ¯ï¼<strong>æ´æ¢TLSåç«¯</strong>ã</p>
<h3 id="åä¸è¡å½ä»¤è§£å³åæ¢å°opensslåç«¯"><strong>åãä¸è¡å½ä»¤è§£å³ï¼åæ¢å°OpenSSLåç«¯</strong></h3>
<p><strong>è§£å³æ¹æ¡ç®åå°ä»¤äººåæï¼</strong></p>
<ol>
<li>
<p><strong>ä½¿ç¨OpenSSLåç«¯éæ°ç¼è¯MsQuic</strong>ï¼</p>
<pre><code class="language-bash"># å¨MsQuicä»åºç®å½ä¸æ§è¡
.\scripts\build.ps1 -Config Debug -Arch x64 -Tls openssl
</code></pre>
</li>
<li>
<p><strong>ä½¿ç¨OpenSSLçæçè¯ä¹¦</strong>ï¼å¦PEMæPFXæ ¼å¼ï¼ã</p>
</li>
<li>
<p>åæ¬¡è¿è¡ä½ çç¨åºæ <code>quicsample</code>ï¼</p>
<pre><code class="language-bash">quicsample.exe -server -cert_file:server.pfx -key_file:key.pem
</code></pre>
<p><strong>â æå¡å¨é¡ºå©å¯å¨ï¼é®é¢è§£å³ã</strong></p>
</li>
</ol>
<h3 id="äºä¸ºä»ä¹ä¼æè¿ä¸ªåæ·±åº¦åæ"><strong>äºãä¸ºä»ä¹ä¼æè¿ä¸ªåï¼ï¼æ·±åº¦åæï¼</strong></h3>
<p>è¿ä¸ªé®é¢å¨ <strong>Windows 11 æ Windows Server 2022</strong> ä¸éå¸¸ä¸ä¼åºç°ï¼å ä¸ºå®ä»¬åç½®äºå®æ´çãæ¯æææ°QUICè§èçSchannelå®ç°ã</p>
<p>è <strong>Windows 10</strong>ï¼å°¤å¶æ¯æäºçæ¬ï¼çSchannelå¯¹MsQuicæ°çæ¬æéåè½çæ¯æå¯è½ä¸å®æ´æå­å¨ç¼ºé·ãMsQuicå¨æ´æ°è¿ç¨ä¸­ï¼å¯è½é»è®¤å¯ç¨äºæäºWindows 10ä¸Schannelæ æ³æ»¡è¶³çç¹æ§æAPIï¼å¯¼è´è¯ä¹¦å è½½è·¯å¾ä»æ ¹æºä¸å¤±è´¥ã</p>
<p><strong>å æ­¤ï¼è¿æ¬è´¨ä¸æ¯ä¸ä¸ªå¹³å°å¼å®¹æ§æ­æ¡£é®é¢ã</strong> å¯¹äºå¼åèèè¨ï¼è¡¨è±¡æ¯è¯ä¹¦éè¯¯ï¼æ ¹å æ¯ç³»ç»ç»ä»¶è½åäºå¼ååºçæ¼è¿ã</p>
<h3 id="å­æ»ç»ä¸å»ºè®®"><strong>å­ãæ»ç»ä¸å»ºè®®</strong></h3>
<table>
<thead>
<tr>
<th style="text-align: left">åºæ¯</th>
<th style="text-align: left">æ¨èå¨ä½</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>å¨Windows 10ä¸å¼å/é¨ç½²MsQuic</strong></td>
<td style="text-align: left"><strong>ç´æ¥ä½¿ç¨OpenSSLåç«¯</strong>ï¼ä¸å³æ°¸é¸ã</td>
</tr>
<tr>
<td style="text-align: left">éå°<code>0x80070490</code>æ<code>E_NOINTERFACE</code>éè¯¯</td>
<td style="text-align: left">é¦è¦æç<strong>TLSåç«¯å¼å®¹æ§</strong>ï¼èéè¯ä¹¦æ¬èº«ã</td>
</tr>
<tr>
<td style="text-align: left">éè¦è·¨å¹³å°ï¼Windows/Linuxï¼ä¸è´æ§</td>
<td style="text-align: left">éæ©OpenSSLåç«¯æ´è½ä¿è¯è¡ä¸ºä¸è´ã</td>
</tr>
<tr>
<td style="text-align: left"><strong>ç®æ ç¯å¢ä¸ºWindows 11/Server 2022+</strong></td>
<td style="text-align: left">å¯æ¾å¿ä½¿ç¨é»è®¤Schannelï¼æ§è½æ´ä½³ã</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>æå±æè</strong>ï¼å¯¹äºä»äº<strong>è§é¢æµä¼ è¾</strong>ï¼å¦åºäºQUICä¼åRTMPãHLSå»¶è¿ï¼çå¼åèæ¥è¯´ï¼çè§£åºå±ç½ç»åºçè¿äºå¹³å°ç»å¾®å·®å«è³å³éè¦ãä¸æ¬¡æåçåè®®åçº§ï¼å¾å¾ä»é¡ºå©ç¼è¯åé¨ç½²å¼å§ãå¸æè¿ç¯è¸©åè®°å½è½å©ä½ çéæ é»ã</p>
<p>ï¼æ¬æåºäºWindows 10 22H2å®¶åº­ä¸­æçãx64æ¶æãMsQuic GitHubä¸»çº¿çæ¬æµè¯éªè¯ï¼</p>
<p><img src="https://img2023.cnblogs.com/blog/254714/202307/254714-20230701143418754-1351786962.jpg" alt="" loading="lazy"></p>
<p><strong>åä½è¯·å WXï¼hbstream</strong><br>
<strong>åä½è¯·å ä½èhbstreamï¼<a href="http://haibindev.cnblogs.com" target="_blank">http://haibindev.cnblogs.com</a>ï¼ï¼è½¬è½½è¯·æ³¨æä½èååºå¤</strong></p>

</div>
<div class="clear"></div>

	<div class="postDesc">posted on 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-07 15:46">2026-01-07 15:45</span>&nbsp;
<a href="https://www.cnblogs.com/haibindev">haibindev</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19452652);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19452652', targetLink: 'https://www.cnblogs.com/haibindev/p/19452652', title: 'ãç»æè¸©åæåãWindows 10ä¸MsQuicè¯ä¹¦å è½½å¤±è´¥ï¼åä¸å¨è¯ä¹¦ï¼èå¨Schannelï¼' })">ä¸¾æ¥</a>
</div>
 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ NIVIDIAé«æ§è½è®¡ç®CUDAç¬è®°ï¼ä¸ï¼ cuFFTçç®ä»åå®ç°æ¡ä¾ ]]></title>
    <link>https://www.cnblogs.com/GeophysicsWorker/p/19452487</link>
    <guid>933ec07771c76b1720a8fb90d15b447b</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/GeophysicsWorker/p/19452487" title="åå¸äº 2026-01-07 15:21">
    <span role="heading" aria-level="2">NIVIDIAé«æ§è½è®¡ç®CUDAç¬è®°ï¼ä¸ï¼ cuFFTçç®ä»åå®ç°æ¡ä¾</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        cuFFTæ¯NVIDIAæä¾çGPUå éçFourieråæ¢FFTåºï¼è½æå¤§æåæ¶åFFTè®¡ç®çç§å­¦è®¡ç®ãä¿¡å·å¤çåæ·±åº¦å­¦ä¹ ç­ä»»å¡çéåº¦ãæ¬ç¬è®°å°±cufftè¿è¡ç®åä»ç»å¹¶ç»åºä¸ä¸ªä¸ç»´ä¿¡å·çfftåæ¢ç¤ºä¾
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="nividiaé«æ§è½è®¡ç®cudaç¬è®°ä¸-cufftçç®ä»åå®ç°æ¡ä¾">NIVIDIAé«æ§è½è®¡ç®CUDAç¬è®°ï¼ä¸ï¼ cuFFTçç®ä»åå®ç°æ¡ä¾</h1>
<h2 id="1-cufftåºçç®ä»introduction-of-cufft-libaray">1. cuFFTåºçç®ä»ï¼Introduction of cuFFT libarayï¼</h2>
<p>â      Fourieråæ¢æ¯æ°å­ä¿¡å·å¤çé¢åä¸ä¸ªå¾éè¦çæ°å­¦åæ¢ï¼å®ç¨æ¥å®ç°å°ä¿¡å·å®ç°å°ä¿¡å·ä»æ¶åå°é¢åçåæ¢ï¼å¨ç©çå­¦ãæ°è®ºãç»åæ°å­¦ãä¿¡å·å¤çãæ¦çãç»è®¡ãå¯ç å­¦ãå£°å­¦ãåå­¦ç­é¢åæå¹¿æ³çåºç¨ãç¦»æ£åéå¶åæ¢(Discrete Fourier Transformï¼DFT)æ¯è¿ç»­åéå¶åæ¢å¨ç¦»æ£ç³»ç»ä¸­çè¡¨ç¤ºå½¢å¼ï¼ç±äºDFTçè®¡ç®éå¾å¤§ï¼å æ­¤å¨å¾é¿ä¸æ®µæ¶é´åå¶åºç¨åå°äºå¾å¤§çéå¶ã20ä¸çºª60å¹´ä»£ï¼1965å¹´ï¼ç±CooleyåTukeyæåºäºå¿«éåéå¶åæ¢(Fast Fourier Transformï¼FFT)ç®æ³ï¼å®æ¯DFTçå¿«éç®æ³ï¼ä½¿å¾ç¦»æ£åéå¶åæ¢åå·ç§¯è¿ç±»é¾åº¦å¾å¤§çè®¡ç®å·¥ä½çå¤æåº¦ä»N2éçº§éå°äºNlog2Néçº§ï¼å¤§å¤§æé«äºDFTçè¿ç®éåº¦ï¼ä»èä½¿DFTå¨å®éåºç¨ä¸­å¾å°äºå¹¿æ³çåºç¨ã</p>
<p>â       cuFFTæ¯NVIDIAæä¾çGPUå éçFourieråæ¢FFTåºï¼è½æå¤§æåæ¶åFFTè®¡ç®çç§å­¦è®¡ç®ãä¿¡å·å¤çåæ·±åº¦å­¦ä¹ ç­ä»»å¡çéåº¦ãä¸è¡¨æ¦æ¬äºå¨ä¸»è¦ç¹å¾ååºç¨åºæ¯ï¼</p>
<table>
<thead>
<tr>
<th>cuFFTçç¹å¾</th>
<th>å·ä½æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>åºæ¬åè½</td>
<td>æä¾GPUå éç1Dã2Dã3Då¤æ°/å®æ°FFTè®¡ç®</td>
</tr>
<tr>
<td>æ ¸å¿ä¼å¿</td>
<td>ç¸æ¯CPUå®ç°ï¼å©ç¨GPUå¹¶è¡æ§å¯è·å¾æ¾èå é</td>
</tr>
<tr>
<td>ç¼ç¨æ¥å£</td>
<td>æä¾ç±»ä¼¼çFFTWçAPIï¼ä¾¿äºçæCPU FFTçç¨æ·è¿ç§»</td>
</tr>
<tr>
<td>é«çº§åè½</td>
<td>æ¯ææ¹éæ§è¡ãæµå¼æ­¥ãå/å/åç²¾åº¦ãå¤GPUè®¡ç®</td>
</tr>
<tr>
<td>ä¸»è¦åºç¨é¢å</td>
<td>æ·±åº¦å­¦ä¹ ãè®¡ç®ç©çå­¦ãå»å­¦æåãä¿¡å·å¤çç­</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="2-åºäºcufftåºçfourieråæ¢æ­¥éª¤workflow-of-fourier-transform-based-cufft">2. åºäºcuFFTåºçFourieråæ¢æ­¥éª¤ï¼workflow of Fourier Transform based cuFFTï¼</h2>
<p>å¨CUDAä¸è¿è¡åéå¶åæ¢ä¸è¬éè¦åä»¥ä¸å æ­¥å·¥ä½ï¼</p>
<ol>
<li>å¨ä¸»æºç«¯ï¼åå¤è¾å¥æ°æ®ï¼</li>
<li>å¨GPUè®¾å¤ç«¯ä¸åéåå­ï¼å¹¶å°æ°æ®ä»ä¸»æºå¤å¶å°è®¾å¤ï¼ï¼<code>cudaMalloc</code>,<code>cudaMemcpy</code>çæ¥å£ ï¼</li>
<li>åå»ºä¸ä¸ª<span class="math inline">\(plan\)</span>, è°ç¨å½æ°<span class="math inline">\(cufftPlane1D/cufftPlane2D/cufftPlan3D\)</span> å¯ä»¥åå»ºä¸ä¸ªç®åçFourieråæ¢ãè°ç¨å½æ°<span class="math inline">\(cufftPlanMany\)</span> åå¯ä»¥åå»ºæ¯ææ´å¤éç½®æä½çåæ¢è®¡åã
<ul>
<li><span class="math inline">\(cufftPlan1d()\)</span>: éå¯¹åä¸ª1ç»´ä¿¡å·</li>
<li><span class="math inline">\(cufftPlan2d()\)</span>:éå¯¹åä¸ª2ç»´ä¿¡å·</li>
<li><span class="math inline">\(cufftPlan3d()\)</span>:éå¯¹åä¸ª3ç»´ä¿¡å·</li>
</ul>
</li>
<li>æ§è¡<span class="math inline">\(plane\)</span>ãè¿ä¸æ­¥å¯ä»¥ä½¿ç¨<span class="math inline">\(cufftExecC2C()\)</span>ã<span class="math inline">\(cufftExecR2C()\)</span>æ<span class="math inline">\(cufftExecC2R()\)</span>ç­å½æ°å®æä¸ä¸æ­¥å®æ<span class="math inline">\(plane\)</span>çè®¡ç®ä»»å¡ã</li>
<li>æ§è¡å®æä»¥ä¸è¥ä¸åéè¦è¯¥<span class="math inline">\(plan\)</span>ï¼åè°ç¨<span class="math inline">\(cufftDestroy()\)</span>å½æ°éæ¯è¯¥<span class="math inline">\(plan\)</span> åä¸ºå¶åéçè®¡ç®èµæºã</li>
</ol>
<h2 id="3-cufftçåéå¶åæ¢apiæ¥å£ç±»åfourier-transform-types">3. cuFFTçåéå¶åæ¢APIæ¥å£ç±»åï¼Fourier Transform Typesï¼</h2>
<p>â        <span class="math inline">\(cuFFT\)</span> åºå®ç°äºä¸ç§ä¸åç±»åçFourieråæ¢æ¥å£åä¸ºï¼<span class="math inline">\(C2C\)</span>(å¤æ°åæ¢å°å¤æ°)ï¼<span class="math inline">\(C2R\)</span>(å¤æ°å°å®æ°),  <span class="math inline">\(R2C\)</span> (å®æ°å°å¤æ°)ãæ¬è´¨ä¸ï¼è¿ä¸ç§è½¬æ¢é½å¯ä»¥è¢«çåæ¯å¤æ°åå°å¤æ°åçåæ¢ï¼ä¹æä»¥è¿æ ·ååï¼å¶æä¸»è¦çèéæ¯æ§è½å ç´ ãä¾å¦ï¼å¨ä¸è¬çæ°å­ä¿¡å·å¤çä¸­ï¼è¾å¥æ°æ®æ¯ä¸äºç¦»æ£çå®æ°åä¸çéæ ·ç¹ï¼è¿æ¶åå¯¹å®ä»¬åFourieråæ¢å®éä¸å°±æ¯<span class="math inline">\(R2C\)</span>ï¼æ ¹æ®åå°ç±³ç¹å¯¹ç§°æ§ï¼Hermitian symmetry)ï¼åæ¢<span class="math inline">\(X_k=X_{N-k}^{*}\)</span>, <span class="math inline">\(*\)</span> ä»£è¡¨å±è½­å¤æ°ã<span class="math inline">\(cuFFT\)</span> çåéå¶åæ¢åå©ç¨äºè¿äºåä½ï¼å°è®¡ç®ééå°æä½ã</p>
<p>â       åæ¢æ§è¡å½æ°çåç²¾åº¦ååç²¾åº¦çæ¬åå«å®ä¹å¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>API</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="math inline">\(cufftExecC2C()/cufftExecZ2Z()\)</span></td>
<td>åç²¾åº¦/åç²¾åº¦æµ®ç¹æ°å¤æ°åå°å¤æ°åçåéå¶åæ¢</td>
</tr>
<tr>
<td><span class="math inline">\(cufftExecR2C()/cufftExecD2Z()\)</span></td>
<td>åç²¾åº¦/åç²¾åº¦æµ®ç¹æ°å®æ°åå°å¤æ°åçåéå¶åæ¢ï¼æ­£åæ¢ï¼</td>
</tr>
<tr>
<td><span class="math inline">\(cufftExecC2R()/cufftExecZ2D()\)</span></td>
<td>åç²¾åº¦/åç²¾åº¦æµ®ç¹æ°å¤æ°åå°å®æ°åçåéå¶åæ¢ï¼éåæ¢ï¼</td>
</tr>
</tbody>
</table>
<h2 id="4-æ°æ®å¸å±data-layout">4. æ°æ®å¸å±(Data Layout)</h2>
<p>â       <span class="math inline">\(CUFFT\)</span>åºä¿å«è¥å¹²ç§æ°æ®ç±»åï¼å¯¹äºå¤æ°æ<span class="math inline">\(cufftComplex/cufftDoubleComplex\)</span> ä¸¤ç§æ°æ®ç±»åï¼å¯¹äºå®æ°ååå«æ<span class="math inline">\(cufftReal/cufftDouble\)</span> ä¸¤ç§æ°æ®ç±»å ã</p>
<p>â         æ ¹æ®è½¬æ¢ç»æçå­å¨ä½ç½®ä¸åï¼<span class="math inline">\(FFT\)</span>åæ¢å¯åä¸ºå°±å°åæ¢(<span class="math inline">\(in-place\)</span>)åå¤é¨åæ¢ï¼<span class="math inline">\(out-place\)</span>)ï¼åèç´æ¥å¨è¾å¥æ°æ®è¿è¡åæ¢ï¼èåèåä¼å°åæ¢åç»æå­å¥æ°çå­å¨å¨å°åã</p>
<p>â         å°±å°è½¬æ¢(<span class="math inline">\(in-place\)</span>) æ¯ææ°æ®çä¸¤ç§å¸å±ï¼<span class="math inline">\(native\)</span> å <span class="math inline">\(padded\)</span>ï¼åèç¨äºè·åæä½³æ§è½ï¼èåèåç¨äºä¸FFTWå¼å®¹ã</p>
<p>â         å¨<span class="math inline">\(padded\)</span>å¸å±ä¸­è¾åºä¿¡å·çå¼å§å°åä¸è¾å¥ä¿¡å·ä¸æ ·ï¼æ¢å¥è¯è¯´ï¼å®æ°åå°å¤æ°ååæ¢çè¾å¥æ°æ®åå¤æ°åå°å®æ°åçè¾åºæ°æ®å¿é¡»è¢«å¡«åãå¨nativeå¸å±ä¸­åæ²¡æå¡«å¥è¦æ±ã</p>
<p>â         è¾å¥æ°æ®åè¾åºæ°æ®çå°ºå¯¸æ»ç»å¦ä¸ï¼</p>
<table>
<thead>
<tr>
<th>FFT type</th>
<th>input data size</th>
<th>output data size</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="math inline">\(C2C\)</span></td>
<td><span class="math inline">\(X \space cufftComplex\)</span></td>
<td><span class="math inline">\(X \space cufftComplex\)</span></td>
</tr>
<tr>
<td><span class="math inline">\(C2R\)</span></td>
<td><span class="math inline">\([\frac{X}{2}]+1 \space cufftComplex\)</span></td>
<td><span class="math inline">\(X\)</span> <span class="math inline">\(cufftReal\)</span></td>
</tr>
<tr>
<td><span class="math inline">\(R2C^{*}\)</span></td>
<td><span class="math inline">\(X\)</span> <span class="math inline">\(cufftReal\)</span></td>
<td><span class="math inline">\([\frac{X}{2}]+1 \space cufftComplex\)</span></td>
</tr>
</tbody>
</table>
<h2 id="5-åä¸ªä¸ç»´ä¿¡å·çfftåæ¢ä»£ç å®ç°one-dimension-signal-fft-transfrom">5. åä¸ªä¸ç»´ä¿¡å·çFFTåæ¢ä»£ç å®ç°ï¼One Dimension SIgnal FFT Transfromï¼</h2>
<p>å¨æ¬æ¬¡æµè¯ä»£ç ä¸­ï¼é¦åçæä¸ç»´çéæºä¿¡å·ï¼å©ç¨cufft åè¿è¡æ­£åæ¢ï¼ç¶åéåæ¢ï¼å¹¶å¤å®éåæ¢åç»æä¸åè¾å¥ä¿¡å·å¤æ­æ¯å¦ç¸ç­ã</p>
<pre><code class="language-C">#include &lt;iostream&gt;
#include &lt;time.h&gt;
#include "cuda_runtime.h"
#include "device_launch_parameters.h"
#include &lt;cufft.h&gt;

#define NX 3335 // æææ°æ®ä¸ªæ°
#define N 5335 // è¡¥0ä¹åçæ°æ®é¿åº¦
#define BATCH 1
#define BLOCK_SIZE 1024
using std::cout;
using std::endl;


/**
* åè½ï¼å¤æ­ä¸¤ä¸ª cufftComplex æ°ç»çæ¯å¦ç¸ç­
* è¾å¥ï¼idataA è¾å¥æ°ç»Açå¤´æé
* è¾å¥ï¼idataB è¾åºæ°ç»Bçå¤´æé
* è¾å¥ï¼size æ°ç»çåç´ ä¸ªæ°
* è¿åï¼true | false
*/
bool IsEqual(cufftComplex *idataA, cufftComplex *idataB, const int size)
{
    for (int i = 0; i &lt; size; i++)
    {
        if (abs(idataA[i].x - idataB[i].x) &gt; 0.000001 || abs(idataA[i].y - idataB[i].y) &gt; 0.000001)
            return false;
    }

    return true;
}



/**
* åè½ï¼å®ç° cufftComplex æ°ç»çå°ºåº¦ç¼©æ¾ï¼ä¹å°±æ¯ä¹ä»¥ä¸ä¸ªæ°
* è¾å¥ï¼idata è¾å¥æ°ç»çå¤´æé
* è¾åºï¼odata è¾åºæ°ç»çå¤´æé
* è¾å¥ï¼size æ°ç»çåç´ ä¸ªæ°
* è¾å¥ï¼scale ç¼©æ¾å°ºåº¦
*/
static __global__ void cufftComplexScale(cufftComplex *idata, cufftComplex *odata, const int size, float scale)
{
    const int threadID = blockIdx.x * blockDim.x + threadIdx.x;

    if (threadID &lt; size)
    {
        odata[threadID].x = idata[threadID].x * scale;
        odata[threadID].y = idata[threadID].y * scale;
    }
}

int main()
{
    cufftComplex *data_dev; // è®¾å¤ç«¯æ°æ®å¤´æé
    cufftComplex *data_Host = (cufftComplex*)malloc(NX*BATCH * sizeof(cufftComplex)); // ä¸»æºç«¯æ°æ®å¤´æé
    cufftComplex *resultFFT = (cufftComplex*)malloc(N*BATCH * sizeof(cufftComplex)); // æ­£åæ¢çç»æ
    cufftComplex *resultIFFT = (cufftComplex*)malloc(NX*BATCH * sizeof(cufftComplex)); // åæ­£åæ¢åéåæ¢çç»æ

    // åå§æ°æ®
    for (int i = 0; i &lt; NX; i++)
    {
        data_Host[i].x = float((rand() * rand()) % NX) / NX;
        data_Host[i].y = float((rand() * rand()) % NX) / NX;
    }


    dim3 dimBlock(BLOCK_SIZE); // çº¿ç¨å
    dim3 dimGrid((NX + BLOCK_SIZE - 1) / dimBlock.x); // çº¿ç¨æ ¼

    cufftHandle plan; // åå»ºcuFFTå¥æ
    cufftPlan1d(&amp;plan, N, CUFFT_C2C, BATCH);

    // è®¡æ¶
    clock_t start, stop;
    double duration;
    start = clock();

    cudaMalloc((void**)&amp;data_dev, sizeof(cufftComplex)*N*BATCH); // å¼è¾è®¾å¤åå­
    cudaMemset(data_dev, 0, sizeof(cufftComplex)*N*BATCH); // åå§ä¸º0
    cudaMemcpy(data_dev, data_Host, NX * sizeof(cufftComplex), cudaMemcpyHostToDevice); // ä»ä¸»æºåå­æ·è´å°è®¾å¤åå­

    cufftExecC2C(plan, data_dev, data_dev, CUFFT_FORWARD); // æ§è¡ cuFFTï¼æ­£åæ¢
    cudaMemcpy(resultFFT, data_dev, N * sizeof(cufftComplex), cudaMemcpyDeviceToHost); // ä»è®¾å¤åå­æ·è´å°ä¸»æºåå­

    cufftExecC2C(plan, data_dev, data_dev, CUFFT_INVERSE); // æ§è¡ cuFFTï¼éåæ¢
    cufftComplexScale &lt;&lt; &lt;dimGrid, dimBlock &gt;&gt; &gt; (data_dev, data_dev, N, 1.0f / N); // ä¹ä»¥ç³»æ°
    cudaMemcpy(resultIFFT, data_dev, NX * sizeof(cufftComplex), cudaMemcpyDeviceToHost); // ä»è®¾å¤åå­æ·è´å°ä¸»æºåå­

    stop = clock();
    duration = (double)(stop - start) * 1000 / CLOCKS_PER_SEC;
    cout &lt;&lt; "æ¶é´ä¸º " &lt;&lt; duration &lt;&lt; " ms" &lt;&lt; endl;

    cufftDestroy(plan); // éæ¯å¥æ
    cudaFree(data_dev); // éæ¾ç©ºé´

    cout &lt;&lt; IsEqual(data_Host, resultIFFT, NX) &lt;&lt; endl;

    return 0;
}
</code></pre>
<p>å¶ä¸­<code>cufftPlan1d()</code> :</p>
<ul>
<li>ç¬¬ä¸ä¸ªåæ°å°±æ¯è¦éç½®ç<span class="math inline">\(cuFFT\)</span>å¥æï¼</li>
<li>ç¬¬äºä¸ªåæ°å°±æ¯è¦è¿è¡fftçä¿¡å·çé¿åº¦ï¼</li>
<li>ç¬¬ä¸ä¸ª<code>CUFFT_C2C</code> ä¸ºè¦æ§è¡<span class="math inline">\(fft\)</span> çä¿¡å·è¾å¥ç±»ååè¾åºç±»åå¤æ°ï¼<code>CUFFT_C2R</code>è¡¨ç¤ºè¾å¥å¤æ°ï¼è¾åºå®æ°ï¼<code>CUFFT_R2C</code>è¡¨ç¤ºè¾å¥å®æ°ï¼è¾åºå¤æ°ï¼<code>CUFFT_R2R</code> è¡¨ç¤ºè¾å¥å®æ°ï¼è¾åºå®æ°ï¼</li>
<li>ç¬¬åä¸ªåæ°<code>BATCH</code>è¡¨ç¤ºè¦æ§è¡fftçä¿¡å·çä¸ªæ°ï¼æ°ççå·²ç»ä½¿ç¨<code>cufftPlanMany()</code>æ¥åæ¶å®æå¤ä¸ªä¿¡å·çfftï¼</li>
</ul>
<p><code>cufftExecC2C()</code>:</p>
<ul>
<li>ç¬¬ä¸ä¸ªåæ°å°±æ¯éç½®å¥½ç cuFFT å¥æï¼</li>
<li>ç¬¬äºä¸ªåæ°ä¸ºè¾å¥ä¿¡å·çé¦å°åï¼</li>
<li>ç¬¬ä¸ä¸ªåæ°ä¸ºè¾åºä¿¡å·çé¦å°åï¼</li>
<li>ç¬¬åä¸ªåæ°ä¸º<code>CUFFT_FORWARD</code>è¡¨ç¤ºæ§è¡çæ¯<span class="math inline">\(fft\)</span>æ­£åæ¢ï¼<code>CUFFT_INVERSE</code>è¡¨ç¤ºæ§è¡<span class="math inline">\(fft\)</span>éåæ¢</li>
</ul>
<p>éè¦æ³¨æçæ¯ï¼æ§è¡å®<span class="math inline">\(fft\)</span>ä¹åï¼è¦å¯¹ä¿¡å·ä¸­çæ¯ä¸ªå¼ä¹ä»¥<span class="math inline">\(1/N\)</span>;</p>
<p>è¾åºç»æï¼</p>
<p><img alt="cufft" loading="lazy" data-src="https://img2024.cnblogs.com/blog/1602810/202601/1602810-20260107151953239-450442928.png" class="lazyload"></p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-07 15:22">2026-01-07 15:21</span>&nbsp;
<a href="https://www.cnblogs.com/GeophysicsWorker">GeoFXR</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19452487);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19452487', targetLink: 'https://www.cnblogs.com/GeophysicsWorker/p/19452487', title: 'NIVIDIAé«æ§è½è®¡ç®CUDAç¬è®°ï¼ä¸ï¼ cuFFTçç®ä»åå®ç°æ¡ä¾' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ IQRååä½æ°æ³æ¯ä»ä¹ï¼ ]]></title>
    <link>https://www.cnblogs.com/sun-10387834/p/19386427</link>
    <guid>307f71b563753888a3d39dbbe35bd2ba</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sun-10387834/p/19386427" title="åå¸äº 2026-01-07 15:06">
    <span role="heading" aria-level="2">IQRååä½æ°æ³æ¯ä»ä¹ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>IQRï¼Interquartile Rangeï¼ååä½è·ï¼ååä½æ°æ³æ¯ä¸ç§ç»è®¡å­¦ä¸­ç¨äºæè¿°æ°æ®ç¦»æ£ç¨åº¦ãè¯å«å¼å¸¸å¼çéè¦å·¥å·ãå®éè¿æ°æ®çååä½æ°ï¼Quartilesï¼æ¥å»ç»æ°æ®çåå¸ç¹å¾ï¼å°¤å¶éç¨äºéæ­£æåå¸æå­å¨ç¦»ç¾¤ç¹çåºæ¯ãä»¥ä¸ä»æ ¸å¿æ¦å¿µãè®¡ç®æ¹æ³ãåºç¨åºæ¯åçè§£è¦ç¹å±å¼è¯´æï¼</p>
<h3 id="ä¸æ ¸å¿æ¦å¿µååä½æ°ä¸iqr"><strong>ä¸ãæ ¸å¿æ¦å¿µï¼ååä½æ°ä¸IQR</strong></h3>
<h4 id="1-ååä½æ°quartiles">1. ååä½æ°ï¼Quartilesï¼</h4>
<p>å°ä¸ç»æåºæ°æ®ï¼ä»å°å°å¤§æåï¼ååä¸º4ä¸ªç¸ç­é¨åçä¸ä¸ªå³é®åå²ç¹ï¼åå«è®°ä¸ºï¼</p>
<ul>
<li><strong>Q1ï¼ç¬¬ä¸ååä½æ°ï¼25%åä½æ°ï¼</strong>ï¼æ°æ®ä¸­25%çæ°å¼å°äºæç­äºå®ï¼å³ç¬¬25ç¾åä½æ°ï¼ã</li>
<li><strong>Q2ï¼ç¬¬äºååä½æ°ï¼ä¸­ä½æ°ï¼</strong>ï¼æ°æ®ä¸­50%çæ°å¼å°äºæç­äºå®ï¼å³ç¬¬50ç¾åä½æ°ï¼Medianï¼ã</li>
<li><strong>Q3ï¼ç¬¬ä¸ååä½æ°ï¼75%åä½æ°ï¼</strong>ï¼æ°æ®ä¸­75%çæ°å¼å°äºæç­äºå®ï¼å³ç¬¬75ç¾åä½æ°ï¼ã</li>
</ul>
<p>ä¾å¦ï¼æ°æ®é [1, 3, 5, 7, 9, 11, 13] çä¸­ä½æ°æ¯7ï¼Q2ï¼ï¼ååé¨å [1,3,5] çä¸­ä½æ°æ¯3ï¼Q1ï¼ï¼ååé¨å [9,11,13] çä¸­ä½æ°æ¯11ï¼Q3ï¼ã</p>
<h4 id="2-iqrååä½è·">2. IQRï¼ååä½è·ï¼</h4>
<p><strong>IQR = Q3 - Q1</strong>ï¼è¡¨ç¤ºä¸­é´50%æ°æ®çåå¸èå´ï¼å³æ°æ®å¨Q1å°Q3ä¹é´çâå®½åº¦âï¼ãå®æ¯è¡¡éæ°æ®ç¦»æ£ç¨åº¦çç¨³å¥ææ ï¼ä¸åæç«¯å¼å½±åï¼ã</p>
<h3 id="äºiqrååä½æ°æ³çæ ¸å¿ä½ç¨è¯å«å¼å¸¸å¼"><strong>äºãIQRååä½æ°æ³çæ ¸å¿ä½ç¨ï¼è¯å«å¼å¸¸å¼</strong></h3>
<p>IQRæ³æå¸¸ç¨çæ¯éè¿âç®±çº¿å¾ï¼Box Plotï¼âæâTukeyâs Fencesâè§åè¯å«å¼å¸¸å¼ï¼Outliersï¼ãå·ä½æ­¥éª¤å¦ä¸ï¼</p>
<h4 id="1-è®¡ç®ä¸ä¸è¾¹ç">1. è®¡ç®ä¸ä¸è¾¹ç</h4>
<p>ä»¥IQRä¸ºåºåï¼å®ä¹æ°æ®çâæ­£å¸¸èå´âï¼</p>
<ul>
<li><strong>ä¸è¾¹çï¼Lower Boundï¼</strong>ï¼Q1 - 1.5ÃIQR</li>
<li><strong>ä¸è¾¹çï¼Upper Boundï¼</strong>ï¼Q3 + 1.5ÃIQR</li>
</ul>
<h4 id="2-å¤å®å¼å¸¸å¼">2. å¤å®å¼å¸¸å¼</h4>
<ul>
<li><strong>æ¸©åå¼å¸¸å¼ï¼Mild Outliersï¼</strong>ï¼å°äºä¸è¾¹çæå¤§äºä¸è¾¹ççæ°æ®ç¹ï¼éå¸¸ç¨1.5ÃIQRçå®ï¼ã</li>
<li><strong>æç«¯å¼å¸¸å¼ï¼Extreme Outliersï¼</strong>ï¼å°äºQ1 - 3ÃIQR æå¤§äºQ3 + 3ÃIQR çæ°æ®ç¹ï¼æ´ä¸¥æ ¼çéå¼ï¼ã</li>
</ul>
<p><strong>é»è¾</strong>ï¼æ­£å¸¸æ°æ®åºéä¸­å¨ä¸­é´50%ï¼Q1å°Q3ï¼ï¼èè¶åº1.5åIQRçç¹è¢«è§ä¸ºâåç¦»è¾è¿çå¼å¸¸âã1.5åçéæ©æ¯ç»éªæ§çï¼åºäºæ­£æåå¸åè®¾ä¸çº¦è¦ç99.3%çæ°æ®ï¼å©ä½0.7%è§ä¸ºå¼å¸¸ï¼ã</p>
<h3 id="ä¸åºç¨åºæ¯"><strong>ä¸ãåºç¨åºæ¯</strong></h3>
<ol>
<li><strong>æ°æ®æ¸æ´</strong>ï¼è¯å«å¹¶éªè¯ç¦»ç¾¤ç¹ï¼å¦ä¼ æå¨è¯¯å·®ãè¾å¥éè¯¯ï¼ã</li>
<li><strong>å¯è§ååæ</strong>ï¼ç®±çº¿å¾çæ ¸å¿ç»ä»¶ï¼ç®±ä½è¡¨ç¤ºQ1å°Q3ï¼è§¦é¡»å»¶ä¼¸è³éå¼å¸¸å¼çæè¿ç¹ï¼å¼å¸¸å¼åç¬æ è®°ï¼ã</li>
<li><strong>ç»è®¡æè¿°</strong>ï¼æ¿ä»£æ åå·®ï¼SDï¼è¡¡éç¦»æ£ç¨åº¦ï¼å°¤å¶å½æ°æ®éæ­£ææ¶ï¼IQRæ´ç¨³å¥ï¼ã</li>
</ol>
<h3 id="åå¦ä½çè§£iqræ³çä¼å¿ä¸å±é"><strong>åãå¦ä½çè§£IQRæ³çä¼å¿ä¸å±é</strong></h3>
<h4 id="ä¼å¿">ä¼å¿ï¼</h4>
<ul>
<li><strong>ç¨³å¥æ§</strong>ï¼ä»ä¾èµä¸­é´50%çæ°æ®ï¼ä¸åæç«¯å¼å¹²æ°ï¼æ åå·®æåå¼å¸¸å¼å½±åï¼ã</li>
<li><strong>æ®éæ§</strong>ï¼éç¨äºä»»ä½åå¸ï¼æ éåè®¾æ°æ®æ­£æï¼ã</li>
<li><strong>ç´è§æ§</strong>ï¼éè¿ååä½æ°ç´æ¥åæ æ°æ®çéä¸­ä¸åæ£è¶å¿ã</li>
</ul>
<h4 id="å±é">å±éï¼</h4>
<ul>
<li><strong>ä¸»è§æ§</strong>ï¼1.5åIQRæ¯ç»éªéå¼ï¼ä¸åé¢åå¯è½è°æ´ï¼å¦éèé£æ§å¯è½ç¨3åï¼ã</li>
<li><strong>å°æ ·æ¬åå·®</strong>ï¼æ ·æ¬éè¿å°æ¶ï¼å¦n&lt;10ï¼ï¼ååä½æ°ä¼°è®¡å¯è½ä¸ç¨³å®ã</li>
<li><strong>æ æ³åæ åå¸å½¢æ</strong>ï¼ä»æè¿°ç¦»æ£ç¨åº¦ï¼ä¸ä½ç°æ°æ®çå¯¹ç§°æ§æå³°åº¦ã</li>
</ul>
<h3 id="äºç¤ºä¾è¯´æ"><strong>äºãç¤ºä¾è¯´æ</strong></h3>
<p>åè®¾æ°æ®éï¼[12, 15, 17, 19, 20, 22, 24, 28, 30, 35, 40, 100]ï¼å·²æåºï¼ã</p>
<ol>
<li>
<p>è®¡ç®ååä½æ°ï¼</p>
<ul>
<li>n=12ï¼ä¸­ä½æ°Q2æ¯ç¬¬6åç¬¬7ä¸ªæ°çå¹³åï¼(22+24)/2=23ã</li>
<li>Q1æ¯å6ä¸ªæ°çä¸­ä½æ°ï¼(17+19)/2=18ï¼å6æ°ï¼12,15,17,19,20,22ï¼ã</li>
<li>Q3æ¯å6ä¸ªæ°çä¸­ä½æ°ï¼(30+35)/2=32.5ï¼å6æ°ï¼24,28,30,35,40,100ï¼ã</li>
</ul>
</li>
<li>
<p>è®¡ç®IQRï¼IQR=Q3-Q1=32.5-18=14.5ã</p>
</li>
<li>
<p>ç¡®å®è¾¹çï¼</p>
<ul>
<li>ä¸è¾¹ç=18 - 1.5Ã14.5=18-21.75=-3.75</li>
<li>ä¸è¾¹ç=32.5 + 1.5Ã14.5=32.5+21.75=54.25</li>
</ul>
</li>
<li>
<p>è¯å«å¼å¸¸å¼ï¼æ°æ®ä¸­100&gt;54.25ï¼å æ­¤100æ¯å¼å¸¸å¼ï¼å¶ä»æ°æ®ç¹åå¨[-3.75, 54.25]èå´åã</p>
</li>
</ol>
<h3 id="æ»ç»"><strong>æ»ç»</strong></h3>
<p>IQRååä½æ°æ³éè¿âä¸­é´50%æ°æ®çèå´âï¼IQRï¼éåç¦»æ£ç¨åº¦ï¼å¹¶éè¿1.5åIQRçè¾¹çè¯å«å¼å¸¸å¼ãå®çæ ¸å¿æ¯<strong>å³æ³¨æ°æ®çä¸»ä½åå¸ï¼å¿½ç¥æç«¯å¹²æ°</strong>ï¼æ¯æ¢ç´¢æ§æ°æ®åæï¼EDAï¼ä¸­ç®åå´å¼ºå¤§çå·¥å·ãçè§£å¶é»è¾çå³é®å¨äºææ¡âååä½æ°ååæ°æ®ãIQRè¡¡éä¸»ä½æ³¢å¨ãè¾¹çå¤è§ä¸ºå¼å¸¸âè¿ä¸é¾æ¡ã</p>

</div>
<div id="MySignature" role="contentinfo">
    
<p>â¤ï¸ å¦æä½ åæ¬¢è¿ç¯æç« ï¼è¯·ç¹èµæ¯æï¼ ð åæ¶æ¬¢è¿å³æ³¨æçåå®¢ï¼è·åæ´å¤ç²¾å½©åå®¹ï¼</p>

<p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/sun-10387834/" target="_blank">ä½ç¥è®©ææ¥å·¡å±±</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/sun-10387834/p/19386427" target="_blank">https://www.cnblogs.com/sun-10387834/p/19386427</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-07 15:07">2026-01-07 15:06</span>&nbsp;
<a href="https://www.cnblogs.com/sun-10387834">ä½ç¥è®©ææ¥å·¡å±±</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19386427);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19386427', targetLink: 'https://www.cnblogs.com/sun-10387834/p/19386427', title: 'IQRååä½æ°æ³æ¯ä»ä¹ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ç¬¬ä¸ç¯ç¬è®°çªå£å½æ°ï¼Window Functionï¼ï¼è®°å½æå­¦ä¹ sqlçå½è¦ç¬è®° ]]></title>
    <link>https://www.cnblogs.com/gloria0311/p/19452264</link>
    <guid>a9bee22eb88ce48fb436607b20a707f9</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/gloria0311/p/19452264" title="åå¸äº 2026-01-07 14:49">
    <span role="heading" aria-level="2">ç¬¬ä¸ç¯ç¬è®°çªå£å½æ°ï¼Window Functionï¼ï¼è®°å½æå­¦ä¹ sqlçå½è¦ç¬è®°</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>çªå£å½æ°ï¼Window Functionï¼æ¯ï¼å¨ä¸åå°æ°æ®è¡æ°çåæä¸ï¼å¯¹æ°æ®è¿è¡æå/è®¡ç®/ç»è®¡ããã<br>
åºåä¸group byï¼<br>
SELECT category, SUM(total_sales)<br>
FROM sales<br>
GROUP BY category;<br>
å¦æcaegory 1 éé¢æå¥½å ä¸ªååï¼ç¨group by ä¸ä¼åè¯ä½ æ¯ä¸ªååçtotalââsalesæ¯å¤å°ï¼å®ä¼æcategory 1éé¢çææsalesé½å èµ·æ¥ã<br>
èçªå£ä¸åå¹¶è¡ï¼åªâç®æ°âãåæ¥å è¡ â è¿æ¯å è¡ãæ¯ä¸è¡å¤äºä¸ä¸ªâè®¡ç®ç»æâãéåï¼æåãå æ¯ãç´¯è®¡ãå¯¹æ¯</p>
<p>SELECT category, SUM(total_sales) AS cat_sales<br>
FROM sales<br>
GROUP BY category;</p>
<table>
<thead>
<tr>
<th>category</th>
<th>cat_sales</th>
</tr>
</thead>
<tbody>
<tr>
<td>C1</td>
<td>19</td>
</tr>
<tr>
<td>C2</td>
<td>36</td>
</tr>
<tr>
<td>C3</td>
<td>24</td>
</tr>
</tbody>
</table>
<p>SELECT<br>
product_id,<br>
category,<br>
total_sales,<br>
SUM(total_sales) OVER (PARTITION BY category) AS cat_sales<br>
FROM sales;</p>
<table>
<thead>
<tr>
<th>product_id</th>
<th>category</th>
<th>total_sales</th>
<th>cat_sales</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>C1</td>
<td>12</td>
<td>19</td>
</tr>
<tr>
<td>2</td>
<td>C1</td>
<td>7</td>
<td>19</td>
</tr>
<tr>
<td>3</td>
<td>C2</td>
<td>14</td>
<td>36</td>
</tr>
<tr>
<td>4</td>
<td>C2</td>
<td>22</td>
<td>36</td>
</tr>
<tr>
<td>5</td>
<td>C3</td>
<td>24</td>
<td>24</td>
</tr>
</tbody>
</table>
<p>çªå£å½æ°çæ åç»æï¼<br>
å½æ°å() OVER (<br>
PARTITION BY åç»è§å<br>
ORDER BY æåºè§å<br>
)<br>
å½æ°åï¼ä½ è¦âç®ä»ä¹âï¼</p>
<p>ROW_NUMBER()ï¼å¼ºå¶å¯ä¸åæ¬¡ï¼1,2,3â¦ï¼</p>
<p>RANK()ï¼å¹¶åä¼è·³å·ï¼1,2,2,4ï¼</p>
<p>DENSE_RANK()ï¼å¹¶åä¸è·³å·ï¼1,2,2,3ï¼</p>
<p>PARTITION BYï¼å¨åªäºâèå´âéç®ï¼<br>
PARTITION BY category ï¼æ¯ä¸ªcategoryåç¬ç®ï¼<br>
PARTITION BY â  GROUP BYï¼åå°æåé¢è¯´è¿ç</p>
<p>ç¨ GROUP BY çå¸åé®é¢</p>
<p>âæ¯ä¸ªç±»å«çæ»ééæ¯å¤å°ï¼â<br>
âæ¯ä¸ªé¨é¨çäººæ°æ¯å¤å°ï¼â<br>
âæ¯ä¸ªç¨æ·çå¹³åè¯åæ¯å¤å°ï¼â</p>
<p>ç¹ç¹ï¼æ¯ç»åªè¦ä¸è¡ç­æ¡</p>
<p>ç¨ PARTITION BY çå¸åé®é¢</p>
<p>âæ¯ä¸ªååå¨ç±»åçæåï¼â<br>
âæ¯ä¸è¡å æ¬ç»æ»éçæ¯ä¾ï¼â<br>
âæ¯ä¸è¡ä¸æ¬ç»å¹³åå¼å·®å¤å°ï¼â</p>
<p>ç¹ç¹ï¼ç­æ¡å¿é¡»ä»ç¶æè¡å­å¨ï¼å ä¸ºä½ è¦ç»æ¯ä¸ªåå/è®¢åä¸ä¸ªæåæå¯¹æ¯ï¼</p>
<p>ORDER BYï¼å³å®è®¡ç®é¡ºåº<br>
ORDER BY total_sales DESC, product_id ASC ï¼åæééé«çæåé¢ï¼ééä¸æ ·ï¼ç¨ product_id æç ´å¹³å±ï¼<br>
æ³¨æï¼è¿æ¯ç»çªå£å½æ°ç¨çæåºï¼åæ¥è¯¢æåç ORDER BY æ¯ä¸¤åäº</p>
<p>ä¾é¢ï¼çå®¢å·é¢SQL48 æ¯ä¸ªååçéå®æ»é¢</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-07 14:49">2026-01-07 14:49</span>&nbsp;
<a href="https://www.cnblogs.com/gloria0311">GloriaQi</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19452264);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19452264', targetLink: 'https://www.cnblogs.com/gloria0311/p/19452264', title: 'ç¬¬ä¸ç¯ç¬è®°çªå£å½æ°ï¼Window Functionï¼ï¼è®°å½æå­¦ä¹ sqlçå½è¦ç¬è®°' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ SQL æ§è½é¿åï¼ä¸ºä»ä¹é¿éå¼ºå¶ç¦ç¨ ORDER BY RAND()ï¼ ]]></title>
    <link>https://www.cnblogs.com/xzqcsj/p/19452232</link>
    <guid>b3b2dba199d579ce4acd7d2395ed4f98</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xzqcsj/p/19452232" title="åå¸äº 2026-01-07 14:43">
    <span role="heading" aria-level="2">SQL æ§è½é¿åï¼ä¸ºä»ä¹é¿éå¼ºå¶ç¦ç¨ ORDER BY RAND()ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2024.cnblogs.com/blog/3703499/202601/3703499-20260107144026422-1062364965.png" alt="SQL æ§è½é¿åï¼ä¸ºä»ä¹é¿éå¼ºå¶ç¦ç¨ ORDER BY RAND()ï¼" class="desc_img">
        å¦æä½ ç¿»éè¿ãé¿éå·´å·´ Java å¼åæåãï¼å¨ MySQL æ°æ®åºè§çº¦ä¸­ï¼ä¸å®è§è¿è¿æ¡éç®çâçº¢çº¿âï¼ãå¼ºå¶ãä¸å¾å¨ database ä¸­ä½¿ç¨ ORDER BY RAND() è¿è¡éæºæåºã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzYyMzM2MjA2OA==&amp;action=getalbum&amp;album_id=4252891456433995787#wechat_redirect" target="_blank" rel="noopener nofollow">MySQLä¸æ </a></p>
<p>å¦æä½ ç¿»éè¿ãé¿éå·´å·´ Java å¼åæåãï¼å¨ MySQL æ°æ®åºè§çº¦ä¸­ï¼ä¸å®è§è¿è¿æ¡éç®çâçº¢çº¿âï¼</p>
<blockquote>
<p><strong>ãå¼ºå¶ãä¸å¾å¨ database ä¸­ä½¿ç¨ ORDER BY RAND() è¿è¡éæºæåºã</strong></p>
</blockquote>
<p>å¾å¤äººç¬¬ä¸ååºæ¯ï¼âä¸å°±éæºæ¥å æ¡æ°æ®åï¼MySQL æ¢ç¶æä¾äºè¿ä¸ªåç½®å½æ°ï¼ä¸ºä»ä¹ä¸è®©ç¨ï¼â</p>
<p>äºå®ä¸ï¼è¿å¯è½æ¯ MySQL éæâåç¹âçåç½®å½æ°ä¹ä¸ãå¨æ°æ®éåªæå ç¾æ¡æ¶ï¼å®æ¯çæ¶çåçå°ççï¼ä¸æ¦æ°æ®éçªç ´åä¸çº§ï¼å®ç«é©¬åèº«å¸å¹² CPU çâçå¤«äººâï¼ååéè®©ä½ çæ°æ®åºæ¥è­¦ã</p>
<p>ä»å¤©æä»¬å°±æ¥æä¸æï¼ä¸ºä»ä¹è¿ä¸ªå½æ°æ¯æ§è½ææï¼ä»¥åå¨æµ·éæ°æ®ä¸ï¼æä»¬è¯¥å¦ä½<strong>ä¼éä¸é«æ§è½</strong>å°å®ç°â<strong>éæºæ¨è</strong>âåè½ã</p>
</blockquote>
<p><img alt="874681b40ba63432d5615fd64ad878f4" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3703499/202601/3703499-20260107143947234-969728755.png" class="lazyload"></p>
<h2 id="æ¡åç°åºä¸æ¡-sql-å¼åçè¡æ¡">æ¡åç°åºï¼ä¸æ¡ SQL å¼åçè¡æ¡</h2>
<p>é£ä¸ªè®© DBA æ´è·³å¦é·ç SQL é¿è¿æ ·ï¼</p>
<pre><code class="language-sql">-- çèµ·æ¥äººçæ å®³ï¼å®åå§æ¯æ æ¯
SELECT * FROM product ORDER BY RAND() LIMIT 3;
</code></pre>
<p>å¦æä½ çååè¡¨åªæå ç¾æ¡æ°æ®ï¼æä¹ç©é½è¡ãä½å½æ°æ®éè¾¾å° <strong>å ä¸ãå åä¸çè³ä¸ç¾ä¸</strong> æ¶ï¼è¿æ¡ SQL å°±æ¯ä¸é¢å®æ¶ç¸å¼¹ã</p>
<h3 id="ä¸ºä»ä¹å®è¿ä¹æ¢">ä¸ºä»ä¹å®è¿ä¹æ¢ï¼</h3>
<p>æå¨æµè¯ç¯å¢éç°äºä¸ä¸ï¼é¡ºææ²äºä¸ª <code>EXPLAIN</code>ãå¥½å®¶ä¼ï¼<code>Extra</code> å­æ®µéèµ«ç¶åçï¼</p>
<blockquote>
<p><strong>Using temporary; Using filesort</strong></p>
</blockquote>
<p>è¿ç®ç´æ¯ MySQL æ§è½ææççâå§é¾å¤éâï¼</p>
<p><code>ORDER BY RAND()</code> çæ§è¡æµç¨å¤§è´æ¯è¿æ ·çï¼</p>
<ol>
<li><strong>å¨è¡¨æ«æ</strong>ï¼MySQL éè¦ä¸ºæ¯ä¸è¡æ°æ®çæä¸ä¸ªéæºå¼ã</li>
<li><strong>åå»ºä¸´æ¶è¡¨</strong>ï¼æ<strong>æ¥è¯¢å</strong>å<strong>å¯¹åºçéæºå¼</strong>å¡è¿ä¸´æ¶è¡¨ï¼å¦æåå­ä¸å¤ï¼è¿ä¼ç¨å°ç£çä¸´æ¶è¡¨ï¼ã</li>
<li><strong>å¨å±æåº</strong>ï¼å¯¹ä¸´æ¶è¡¨éçéæºå¼è¿è¡æåºã</li>
<li><strong>ååºåå æ¡</strong>ï¼è¿å°±å¥½æ¯ä½ è¦ä»ä¸è¢ç±³ééæºæ 3 ç²ï¼å´åææ´è¢ç±³ååºæ¥ï¼ç»æ¯ç²ç±³ç¼ä¸ªå·ï¼æä¸ªåºï¼åæå 3 ä¸ªã</li>
</ol>
<p>è¿ä¸å´©è°å´©ï¼</p>
<hr>
<h2 id="æ·±å¥åæäºç§é«æ§è½æ¿ä»£æ¹æ¡">æ·±å¥åæï¼äºç§é«æ§è½æ¿ä»£æ¹æ¡</h2>
<p>æ¢ç¶ <code>ORDER BY RAND()</code> ä¸è½ç¨ï¼é£æä¹å®ç°âéæºæ¨èâï¼å¶å®æè·¯å¾ç®åï¼<strong>æâè®¡ç®éæºâçååä» Database è½¬ç§»å° Applicationï¼åºç¨å±ï¼</strong>ï¼æè<strong>åå°æ°æ®åºçæ«æè¡æ°</strong>ã</p>
<h3 id="æ¹æ¡ä¸åºç¨å±éæºæ³application-shuffle">æ¹æ¡ä¸ï¼åºç¨å±éæºæ³ï¼Application Shuffleï¼</h3>
<p><strong>éç¨åºæ¯</strong>ï¼æ°æ®éä¸å¤§ï¼ä¾å¦ &lt; 10ä¸ï¼ï¼åå­ä¸å¼é±ã</p>
<p><strong>æ ¸å¿ææ³</strong>ï¼æ¢ç¶æ°æ®åºéæºæåºæ¢ï¼é£ææ ID å¨æ¿åºæ¥ï¼å¨ Java ä»£ç éæ´çè¡ä¸è¡ï¼</p>
<h4 id="ä»£ç å®ç°">ä»£ç å®ç°</h4>
<pre><code class="language-java">// 1. æ¥åºææååIDï¼åªæ¥IDï¼éåº¦é£å¿«ï¼
// SQL: SELECT id FROM product;
List&lt;Integer&gt; allProductIds = productMapper.selectAllIds();

// 2. å©ç¨ Java ç Collections å·¥å·ç±»è¿è¡æ´ç
Collections.shuffle(allProductIds);

// 3. æªåå3ä¸ª
List&lt;Integer&gt; randomIds = allProductIds.subList(0, 3);

// 4. åè¡¨æ¹éæ¥è¯¢è¯¦æ
// SQL: SELECT * FROM product WHERE id IN (..., ..., ...);
List&lt;Product&gt; results = productMapper.selectByIds(randomIds);
</code></pre>
<h4 id="ä¼ç¼ºç¹ç¹è¯">ä¼ç¼ºç¹ç¹è¯</h4>
<ul>
<li><strong>ä¼ç¹</strong>ï¼çã»éæºï¼ç±äºç¨äº <code>Collections.shuffle</code>ï¼éæºåå¸éå¸¸ååï¼é»è¾ç®åç²æ´ã</li>
<li><strong>ç¼ºç¹</strong>ï¼å¤ªå åå­ãå¦æè¡¨éæ 1000 ä¸æ¡ IDï¼å¨æå°åå­éï¼JVM ç´æ¥ OOM æåäººã</li>
<li><strong>é¿å</strong>ï¼ä¸å®è¦ç» ID åè¡¨å ç¼å­ï¼Redis ææ¬å°ç¼å­ï¼ï¼å«æ¯æ¬¡è¯·æ±é½å»æ¥å¨é IDï¼é£è·ç´æ¥æ»å»æ°æ®åºæ²¡åºå«ã</li>
</ul>
<hr>
<h3 id="æ¹æ¡äºlimit-åç§»æ³limit-offset">æ¹æ¡äºï¼Limit åç§»æ³ï¼Limit Offsetï¼</h3>
<p><strong>éç¨åºæ¯</strong>ï¼æ°æ®éå¤§ï¼ç¾ä¸çº§ä»¥ä¸ï¼ï¼å¯¹éæºæ§è¦æ±æ²¡é£ä¹ä¸¥èã</p>
<p><strong>æ ¸å¿ææ³</strong>ï¼ç»æææ°æ®ç¼ä¸ªå·ï¼éæºçæä¸ä¸ªâåç§»éâï¼ç´æ¥è·³å°é£éå»æ¿ã</p>
<h4 id="ä»£ç å®ç°-1">ä»£ç å®ç°</h4>
<pre><code class="language-java">// 1. åæ¥è¯¢æ»æ°ï¼å¯ä»¥èµ°ç¼å­ï¼
// SQL: SELECT COUNT(*) FROM product;
int totalCount = productMapper.count();

// 2. éæºçæä¸ä¸ªåç§»é
// æ³¨æï¼totalCount - 3 æ¯ä¸ºäºé²æ­¢ limit è¶çï¼ç¡®ä¿è½åå¤3æ¡
int offset = new Random().nextInt(totalCount - 3);

// 3. ç´æ¥å©ç¨ LIMIT åç§»éæ¥è¯¢
// SQL: SELECT * FROM product LIMIT #{offset}, 3;
List&lt;Product&gt; results = productMapper.selectByOffset(offset, 3);
</code></pre>
<h4 id="ä¼ç¼ºç¹ç¹è¯-1">ä¼ç¼ºç¹ç¹è¯</h4>
<ul>
<li><strong>ä¼ç¹</strong>ï¼æ§è½æä½³ï¼å¤§é¨åæåµä¸åªéè¦æ«æ <code>offset + 3</code> è¡ ï¼countå¼å¯ä»¥æ¾ç¼å­ä¸­ï¼å®ææ´æ°ã</li>
<li><strong>ç¼ºç¹</strong>ï¼
<ol>
<li><strong>ä¼ªéæº</strong>ï¼ä½ ååºæ¥ç 3 æ¡æ°æ®æ¯<strong>ç©çä¸è¿ç»­</strong>çãæ¯å¦æ­£å¥½ååºäºâiPhone 13, iPhone 14, iPhone 15âï¼çèµ·æ¥ä¸å¤éæºã</li>
<li><strong>æ·±åé¡µé®é¢</strong>ï¼å¦æéæºå°ç <code>offset</code> å¾å¤§ï¼æ¯å¦ 900ä¸ï¼ï¼<code>LIMIT 9000000, 3</code> çæ§è½ä¹ä¼ä¸éï¼å ä¸º MySQL è¦åæ«è¿å 900 ä¸è¡ææã</li>
</ol>
</li>
</ul>
<hr>
<h3 id="æ¹æ¡ä¸å¤æ¬¡æ¥è¯¢æ³multiple-queries">æ¹æ¡ä¸ï¼å¤æ¬¡æ¥è¯¢æ³ï¼Multiple Queriesï¼</h3>
<p><strong>éç¨åºæ¯</strong>ï¼æ°æ®éå¤§ï¼ä¸è¦æ±é«è´¨ééæºã</p>
<p><strong>æ ¸å¿ææ³</strong>ï¼æ¢ç¶æ¹æ¡äºååºçæ°æ®æ¯è¿ç»­çï¼é£æå¤éæºå æ¬¡ï¼æ¯æ¬¡å 1 æ¡ï¼æ¼ååº 3 æ¡ä¸å°±è¡äºï¼</p>
<h4 id="ä»£ç å®ç°-2">ä»£ç å®ç°</h4>
<pre><code class="language-java">// 1. è·åæ»æ°
int total = productMapper.count();

// 2. çæ3ä¸ªä¸éå¤çéæºä¸æ ï¼Java 8 Stream åæ³ï¼
List&lt;Integer&gt; randomOffsets = new Random()
        .ints(0, total) // çææ éæµ
        .distinct()     // å»é
        .limit(3)       // æªåå3ä¸ª
        .boxed()
        .collect(Collectors.toList());

// 3. å¾ªç¯æ¥è¯¢ï¼æèæ¼æ¥ SQL ç¨ UNION ALLï¼
List&lt;Product&gt; result = new ArrayList&lt;&gt;();
for (Integer offset : randomOffsets) {
    // SQL: SELECT * FROM product LIMIT #{offset}, 1
    result.add(productMapper.selectByLimit(offset, 1));
}
</code></pre>
<p>å¶å®è¿å°±æ¯ <strong>MySQL 45è®²</strong> éæ¨èçä¼åæè·¯ãç¸æ¯äºæ¹æ¡äºï¼å®ææ£äºè¿ç»­æ§ã</p>
<h4 id="ä¼ç¼ºç¹ç¹è¯-2">ä¼ç¼ºç¹ç¹è¯</h4>
<ul>
<li><strong>ä¼ç¹</strong>ï¼æ¢é¿åäºå¨è¡¨æåºï¼åä¿è¯äºè¾å¥½çéæºæ§ã</li>
<li><strong>ç¼ºç¹</strong>ï¼è¦ä¸æ°æ®åºäº¤äºå¤æ¬¡ï¼N æ¬¡æ¥è¯¢ï¼ãä¸è¿å¯¹äºé«å¹¶ååºç¨ï¼ä¸è¬é½æ¯å¤æ¬¡æ¥è¯¢ + ç¼å­ï¼è¿ç¹å¼éå®å¨å¯ä»¥æ¥åã</li>
</ul>
<h3 id="æ¹æ¡åä¸»é®èå´æ³index-random">æ¹æ¡åï¼ä¸»é®èå´æ³ï¼Index Randomï¼</h3>
<p><strong>éç¨åºæ¯</strong>ï¼ID å¿é¡»è¿æ¯è¿ç»­çï¼æç©ºæ´å¾å°ï¼ï¼è¿½æ±æè´æ§è½ã</p>
<p><strong>æ ¸å¿ææ³</strong>ï¼æ¢ç¶ <code>LIMIT N, M</code> è¶å¾åè¶æ¢ï¼é£æç´æ¥ç®åºéæº IDï¼ç¨ä¸»é®ç´¢å¼âè·³âè¿å»ä¸å°±å®äºäºï¼</p>
<h4 id="ä»£ç å®ç°-3">ä»£ç å®ç°</h4>
<p><strong>Java é»è¾å¤çï¼</strong></p>
<pre><code class="language-java">// 1. è·å ID èå´ï¼minId å maxIdï¼
// SQL: SELECT MIN(id), MAX(id) FROM product;
long minId = productMapper.selectMinId();
long maxId = productMapper.selectMaxId();

// 2. è®¡ç®éæºèµ·ç¹
// æ³¨æï¼maxId - minId - 3 æ¯ä¸ºäºä¿è¯èµ·ç¹ç id åé¢è³å°è¿æ 3 æ¡æ°æ®ï¼åè®¾ ID è¿ç»­ï¼
// å¦æ ID æå¶ç¨çï¼è¿ä¸ªèå´å¯è½éè¦é¢çæ´å¤§
long range = maxId - minId - 3; 
long randomId = minId + (long)(Math.random() * range);

// 3. æ§è¡æ¥è¯¢
List&lt;Product&gt; products = productMapper.selectGtId(randomId, 3);
</code></pre>
<p><strong>SQL å®ç°ï¼</strong></p>
<pre><code class="language-sql">SELECT * FROM product 
WHERE id &gt;= #{randomId} 
LIMIT 3;
</code></pre>
<h4 id="ä¼ç¼ºç¹ç¹è¯-3">ä¼ç¼ºç¹ç¹è¯</h4>
<ul>
<li><strong>ä¼ç¹</strong>ï¼éåº¦å¿«å°é£èµ·ï¼å¤æåº¦ç´æ¥éä¸º $O(\log N)$ï¼ä¸»é®æ¥æ¾ï¼ï¼å®å¨æ²¡æ <code>LIMIT</code> æ·±åé¡µçæ§è½è¡°åã</li>
<li><strong>ç¼ºç¹</strong>ï¼<strong>éå¸¸æé£ï¼</strong> å®åè®¾ ID æ¯è¿ç»­çãå¦æä½ çååè¡¨éå ä¸ºå å æ¹æ¹å¯¼è´ ID ä¸­é´ç©ºæ´å¾å¤§ï¼è¿ç±» SQL ä¼å¯¼è´åå¸ä¸¥éä¸åï¼ç©ºæ´åçé£æ¡æ°æ®è¢«éä¸­çæ¦çä¼æ´å¢ï¼ï¼çè³å¯è½åä¸å°æ°æ®ã</li>
</ul>
<hr>
<h3 id="æ¹æ¡äºredis-é¢å¤çæ³redis-set">æ¹æ¡äºï¼Redis é¢å¤çæ³ï¼Redis Setï¼</h3>
<p><strong>éç¨åºæ¯</strong>ï¼é«å¹¶åãé«æ§è½ãå¤§æ°æ®éï¼æ åçäºèç½å¤§åææ³ã</p>
<p><strong>æ ¸å¿ææ³</strong>ï¼æ¢ç¶ MySQL ä¸æé¿åéæºï¼é£å°±å«é¾ä¸ºå®äºï¼äº¤ç»ææé¿ç Redisã</p>
<h4 id="ä»£ç å®ç°-4">ä»£ç å®ç°</h4>
<pre><code class="language-java">// 1. åå§åï¼åªéåä¸æ¬¡ï¼ï¼æææååIDä¸¢è¿ Redis Set
// Redis Key: "all_product_ids"

// 2. å©ç¨ Redis åçå½ä»¤éæºè·å ID
// å½ä»¤ï¼SRANDMEMBER key count
// æ¶é´å¤æåº¦ï¼O(N)ï¼Næ¯ä½ åçæ°éï¼æå¿«
List&lt;Integer&gt; randomIds = redisTemplate.opsForSet().randomMembers("all_product_ids", 3);

// 3. åè¡¨ MySQL æ¥è¯¦æï¼è¿éå¨æ¯ä¸»é®æ¥è¯¢ï¼æ§è½æ ååï¼
List&lt;Product&gt; products = productMapper.selectByIds(randomIds);
</code></pre>
<h4 id="ä¼ç¼ºç¹ç¹è¯-4">ä¼ç¼ºç¹ç¹è¯</h4>
<ul>
<li><strong>ä¼ç¹</strong>ï¼<strong>å¤©è±æ¿çº§å«çæ§è½</strong>ãæ è®ºä½ æå¤å°æ°æ®ï¼Redis é½åºæ¬è½å¨å æ¯«ç§åååºéæº IDã</li>
<li><strong>ç¼ºç¹</strong>ï¼æ¶æåå¤æäºãä½ éè¦ç»´æ¤ Redis å MySQL çæ°æ®åæ­¥ï¼ä¹å°±æ¯ç»å¸çç¼å­ä¸è´æ§é®é¢ï¼ã</li>
</ul>
<hr>
<h2 id="æç»æ»ç»éåæå">æç»æ»ç»ï¼éåæå</h2>
<p>é£è¿å ç§æ¹æ¡æä¹éï¼</p>
<table>
<thead>
<tr>
<th style="text-align: left">ä½ çåºæ¯</th>
<th style="text-align: left">æ¨èæ¹æ¡</th>
<th style="text-align: left">çç±</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>æ°æ®é &lt; 10W</strong></td>
<td style="text-align: left"><strong>æ¹æ¡ä¸ï¼åºç¨å± Shuffleï¼</strong></td>
<td style="text-align: left">å¼åæå¿«ï¼é»è¾æç®åï¼éæºæ§æå®ç¾ã</td>
</tr>
<tr>
<td style="text-align: left"><strong>æ°æ®é &gt; 10Wï¼IDè¿ç»­</strong></td>
<td style="text-align: left"><strong>æ¹æ¡åï¼ç´¢å¼è·³è·ï¼</strong></td>
<td style="text-align: left">æ¢ä¸ç¨ç»´æ¤ç¼å­ï¼åè½äº«åæè´æ§è½ã</td>
</tr>
<tr>
<td style="text-align: left"><strong>æ°æ®é &gt; 10Wï¼åè®¸è¿ç»­</strong></td>
<td style="text-align: left"><strong>æ¹æ¡äºï¼Limit Offsetï¼</strong></td>
<td style="text-align: left">æ§è½ä¸éï¼éç¨æ§å¼ºï¼æ¯ä¸ªèå®äººã</td>
</tr>
<tr>
<td style="text-align: left"><strong>æ°æ®é &gt; 10Wï¼è¦æ±ææ£</strong></td>
<td style="text-align: left"><strong>æ¹æ¡ä¸ï¼å¤æ¬¡æ¥è¯¢ï¼</strong></td>
<td style="text-align: left">å¨æ§è½åéæºæ§ä¹é´æ¾å°äºå¹³è¡¡ç¹ã</td>
</tr>
<tr>
<td style="text-align: left"><strong>é«å¹¶å / è¿½æ±æè´</strong></td>
<td style="text-align: left"><strong>æ¹æ¡äºï¼Redis Setï¼</strong></td>
<td style="text-align: left">å·¥ä¸çæ åç­æ¡ï¼è½ç¶ç¨å¾®éº»ç¦ç¹ï¼ä½çé¦ã</td>
</tr>
<tr>
<td style="text-align: left"><strong>æ³è¢«è¾é</strong></td>
<td style="text-align: left"><strong>ORDER BY RAND()</strong></td>
<td style="text-align: left">åªè¦ä½ æ¢ç¨ï¼P0 æééæ¶å¸¦åå®¶ã</td>
</tr>
</tbody>
</table>
<p><strong>æåå¤å´ä¸å¥</strong>ï¼<br>
å¦æä½ çä¸å¡å¯ä»¥æ¥åâä¼ªéæºâï¼æ¯å¦æ¯ä¸ªäººçå°çéæºåè¡¨å¨ 1 å°æ¶åæ¯ä¸æ ·çï¼ï¼<strong>å¼ºçå»ºè®®æç®å¥½çéæºç»æä¸¢è¿ Redis</strong>ãæ¯ç«ï¼<strong>æå¥½ç SQL ä¼åå°±æ¯ä¸æ§è¡ SQL</strong>ã</p>
<p>å«è®©ä½ åçä»£ç ï¼æä¸ºæ·±å¤æ¥è­¦çç½ªé­ç¥¸é¦ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-07 14:43">2026-01-07 14:43</span>&nbsp;
<a href="https://www.cnblogs.com/xzqcsj">ä¸æäºº</a>&nbsp;
éè¯»(<span id="post_view_count">0</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19452232);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19452232', targetLink: 'https://www.cnblogs.com/xzqcsj/p/19452232', title: 'SQL æ§è½é¿åï¼ä¸ºä»ä¹é¿éå¼ºå¶ç¦ç¨ ORDER BY RAND()ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸å¤§ Agent-UI åè®®æ·±åº¦åæï¼AG-UIãA2UI ä¸ MCP-UI çè®¾è®¡å²å­¦ä¸å·¥ç¨å®è·µ ]]></title>
    <link>https://www.cnblogs.com/madtom/p/19452209</link>
    <guid>b5627bae98db0a50d9b9e7536b66e3c3</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/madtom/p/19452209" title="åå¸äº 2026-01-07 14:36">
    <span role="heading" aria-level="2">ä¸å¤§ Agent-UI åè®®æ·±åº¦åæï¼AG-UIãA2UI ä¸ MCP-UI çè®¾è®¡å²å­¦ä¸å·¥ç¨å®è·µ</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        éçå¤§æ¨¡åä»"å¯¹è¯æ¡"æ¼è¿ä¸º"èªä¸»æºè½ä½"ï¼å¦ä½è®© Agent å·å¤å¯äº¤äºè½åæä¸ºå³é®ææãæ¬æåºäºé¡¹ç®å®æï¼ç»å AG-UIãA2UIãMCP-UI ä¸å¤§åè®®çæºç æ·±åº¦åæï¼ç³»ç»éè¿°å®ä»¬çè®¾è®¡å²å­¦ãæ ¸å¿æºå¶ãå®ç°æ¹æ¡åå¯¹æ¥æ¹å¼ï¼å¹¶æ¢è®¨åè®®ç»åä½¿ç¨çæä½³å®è·µã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p><strong>æè¦</strong>ï¼éçå¤§æ¨¡åä»"å¯¹è¯æ¡"æ¼è¿ä¸º"èªä¸»æºè½ä½"ï¼å¦ä½è®© Agent å·å¤å¯äº¤äºè½åæä¸ºå³é®ææãæ¬æåºäºé¡¹ç®å®æï¼ç»å AG-UIãA2UIãMCP-UI ä¸å¤§åè®®çæºç æ·±åº¦åæï¼ç³»ç»éè¿°å®ä»¬çè®¾è®¡å²å­¦ãæ ¸å¿æºå¶ãå®ç°æ¹æ¡åå¯¹æ¥æ¹å¼ï¼å¹¶æ¢è®¨åè®®ç»åä½¿ç¨çæä½³å®è·µã</p>
</blockquote>
<p><img alt="å ä½ç¬¦ï¼æç« å°é¢å¾ - ä¸å¤§åè®®çææ¯æ¶æå¨æ¯å¾" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3358435/202601/3358435-20260107143421801-2057619615.png" class="lazyload"></p>
<hr>
<h2 id="ç®å½">ç®å½</h2>
<ol>
<li><a href="#1-%E5%BC%95%E8%A8%80%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-agent-ui-%E5%8D%8F%E8%AE%AE" rel="noopener nofollow">å¼è¨ï¼ä¸ºä»ä¹éè¦ Agent-UI åè®®ï¼</a></li>
<li><a href="#2-ag-ui%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E7%9A%84%E6%99%BA%E8%83%BD%E4%BD%93%E4%BA%A4%E4%BA%92%E5%8D%8F%E8%AE%AE" rel="noopener nofollow">AG-UIï¼äºä»¶é©±å¨çæºè½ä½äº¤äºåè®®</a></li>
<li><a href="#3-a2ui%E5%A3%B0%E6%98%8E%E5%BC%8F-ui-%E7%9A%84%E9%9B%B6%E4%BF%A1%E4%BB%BB%E6%B8%B2%E6%9F%93%E5%BC%95%E6%93%8E" rel="noopener nofollow">A2UIï¼å£°æå¼ UI çé¶ä¿¡ä»»æ¸²æå¼æ</a></li>
<li><a href="#4-mcp-uimcp-%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%89%A9%E5%B1%95%E5%B1%82" rel="noopener nofollow">MCP-UIï¼MCP åè®®çå¯è§åæ©å±å±</a></li>
<li><a href="#5-%E5%8D%8F%E8%AE%AE%E7%BB%84%E5%90%88ag-ui--a2ui-%E7%9A%84%E5%8D%8F%E5%90%8C%E6%9E%B6%E6%9E%84" rel="noopener nofollow">åè®®ç»åï¼AG-UI + A2UI çååæ¶æ</a></li>
<li><a href="#6-%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B%E5%86%B3%E7%AD%96%E6%A1%86%E6%9E%B6" rel="noopener nofollow">ææ¯éåå³ç­æ¡æ¶</a></li>
<li><a href="#7-demo-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E8%A7%A3%E6%9E%90" rel="noopener nofollow">Demo é¡¹ç®å®æè§£æ</a></li>
<li><a href="#8-%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B" rel="noopener nofollow">æ»ç»ä¸å±æ</a></li>
</ol>
<hr>
<h2 id="1-å¼è¨ä¸ºä»ä¹éè¦-agent-ui-åè®®">1. å¼è¨ï¼ä¸ºä»ä¹éè¦ Agent-UI åè®®ï¼</h2>
<h3 id="11-ä¼ ç»-chatbot-çå±éæ§">1.1 ä¼ ç» Chatbot çå±éæ§</h3>
<p>ä¼ ç»ç AI èå¤©æºå¨äººéç¨ç®åç <strong>Request-Response</strong> æ¨¡å¼ï¼ç¨æ·è¾å¥ææ¬ï¼æ¨¡åè¿åææ¬ãè¿ç§æ¨¡å¼å¨é¢å¯¹å¤æä¸å¡åºæ¯æ¶æ´é²åºä¸¥éä¸è¶³ï¼</p>
<pre><code>ç¨æ· â "å¸®æè®¢ä¸å®¶åäº¬çå·èé¦"
ä¼ ç» Bot â "å¥½çï¼ææ¾å°äºä»¥ä¸é¤åï¼1. å·åé¤å... 2. çå·ä¸å¡..."
</code></pre>
<p><strong>é®é¢</strong>ï¼</p>
<ul>
<li>â æ æ³å±ç¤ºé¤åå¾çãè¯åãä»·æ ¼ç­ç»æåä¿¡æ¯</li>
<li>â ç¨æ·éè¦æå¨å¤å¶é¤ååç§°åå»æç´¢</li>
<li>â æ æ³ç´æ¥å¨å¯¹è¯ä¸­å®æé¢è®¢æä½</li>
</ul>
<h3 id="12-agent-æ¶ä»£çæ°éæ±">1.2 Agent æ¶ä»£çæ°éæ±</h3>
<p>å½ AI ä» Chatbot åçº§ä¸º Agent åï¼äº¤äºæ¨¡å¼åçäºæ¬è´¨ååï¼</p>
<table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>Chatbot</th>
<th>Agent</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>è¿è¡æ¶é´</strong></td>
<td>ç­ï¼æ¯«ç§çº§ï¼</td>
<td>é¿ï¼ç§/åéçº§ï¼</td>
</tr>
<tr>
<td><strong>è¾åºç±»å</strong></td>
<td>çº¯ææ¬</td>
<td>ææ¬ + ç»æåæ°æ® + UI æ§å¶</td>
</tr>
<tr>
<td><strong>ç¶æç®¡ç</strong></td>
<td>æ ç¶æ</td>
<td>å¤æç¶ææº</td>
</tr>
<tr>
<td><strong>äº¤äºæ¨¡å¼</strong></td>
<td>åè½® Q&amp;A</td>
<td>å¤è½®å·¥å·è°ç¨ + äººæºåä½</td>
</tr>
</tbody>
</table>
<div class="mermaid">flowchart TB
    subgraph Chatbot["ð¤ ä¼ ç» Chatbot"]
        direction TB
        U1["ð¤ ç¨æ·"] --&gt;|"ææ¬è¾å¥"| B1["ð¬ Bot"]
        B1 --&gt;|"ææ¬è¾åº"| U1
    end
    
    subgraph Agent["ð¦¾ æºè½ä½ Agent"]
        direction TB
        U2["ð¤ ç¨æ·"] --&gt;|"å¤æ¨¡æè¾å¥"| A["ð§  Agent"]
        A --&gt;|"ç¶æäºä»¶"| SM["ð ç¶ææº"]
        SM --&gt;|"UI æ´æ°"| UI["ð¥ï¸ å¯äº¤äº UI"]
        A &lt;--&gt;|"å·¥å·è°ç¨"| T["ð§ Tools"]
        UI --&gt;|"ç¨æ·æä½"| A
    end
    
    Chatbot -.-&gt;|"æ¼è¿"| Agent
</div><h3 id="13-ä¸ç§åè®®çå®ä½">1.3 ä¸ç§åè®®çå®ä½</h3>
<p>ä¸çç»åºäºä¸ç§æªç¶ä¸åçè§£å³æ¹æ¡ï¼</p>
<table>
<thead>
<tr>
<th>åè®®</th>
<th>æ¥æº</th>
<th>æ ¸å¿å®ä½</th>
<th>ä¸å¥è¯æ¦æ¬</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>AG-UI</strong></td>
<td>CopilotKit</td>
<td>äºä»¶é©±å¨çç¶æåæ­¥åè®®</td>
<td>"è®©åç«¯å®æ¶æç¥ Agent çæ¯ä¸æ­¥æè"</td>
</tr>
<tr>
<td><strong>A2UI</strong></td>
<td>Google</td>
<td>å£°æå¼ UI ç»ä»¶è§è</td>
<td>"Agent æè¿°æå¾ï¼å®¢æ·ç«¯è´è´£æ¸²æ"</td>
</tr>
<tr>
<td><strong>MCP-UI</strong></td>
<td>ç¤¾åº</td>
<td>MCP å·¥å·çå¯è§åæ©å±</td>
<td>"è®©å·¥å·è°ç¨ç»æå·å¤å¯è§åè½å"</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="2-ag-uiäºä»¶é©±å¨çæºè½ä½äº¤äºåè®®">2. AG-UIï¼äºä»¶é©±å¨çæºè½ä½äº¤äºåè®®</h2>
<h3 id="21-è®¾è®¡å²å­¦">2.1 è®¾è®¡å²å­¦</h3>
<p>AG-UIï¼Agent-User Interaction Protocolï¼çæ ¸å¿çå¿µå¯ä»¥æ¦æ¬ä¸ºï¼</p>
<blockquote>
<p><strong>"UI æ¯åç«¯çé¢åï¼Agent åªè´è´£å¹¿æ­ç¶æåå"</strong></p>
</blockquote>
<p>AG-UI è®¤ä¸ºï¼Agent ä¸åºè¯¥ç¥é"æé®æ¯åçè¿æ¯æ¹ç"ï¼ä¸åºè¯¥ç¥é"å½åæ¯ React è¿æ¯ Vue"ãAgent åªéè¦åè¯åç«¯ï¼"ææ­£å¨è°ç¨æç´¢å·¥å·"ã"æç´¢åæ°æ¯ XXX"ã"æç´¢ç»ææ¯ YYY"ãè³äºå¦ä½æ¸²æè¿äºä¿¡æ¯ï¼å®å¨ç±åç«¯å³å®ã</p>
<p>è¿ç§è®¾è®¡å¸¦æ¥äºå ä¸ªæ ¸å¿ä¼å¿ï¼</p>
<ol>
<li><strong>åç«¯èªç±åº¦æå¤§å</strong>ï¼åä¸ä¸ª Agent å¯ä»¥å¯¹æ¥ WebãMobileãCLI ç­ä¸åå®¢æ·ç«¯</li>
<li><strong>å®æ¶æ§æå¼º</strong>ï¼åºäºæµå¼äºä»¶ï¼ç¨æ·è½çå° Agent æèçæ¯ä¸æ­¥</li>
<li><strong>ä¸ç°æåºç¨æ·±åº¦éæ</strong>ï¼Agent å¯ä»¥é©±å¨ç°æ UI çç¶æåå</li>
</ol>
<div class="mermaid">flowchart LR
    subgraph Backend["ð Agent Backend"]
        LLM["ð§  LLM"] --&gt; EP["Event Producer"]
        Tools["ð§ Tools"] --&gt; EP
    end
    
    subgraph Transport["ð¡ ä¼ è¾å±"]
        EP --&gt;|"SSE Stream"| SSE["text/event-stream"]
    end
    
    subgraph Frontend["ð¥ï¸ Frontend"]
        SSE --&gt; Parser["Event Parser"]
        Parser --&gt; SM["State Machine"]
        SM --&gt; |"TEXT_MESSAGE"| Chat["ð¬ èå¤©åº"]
        SM --&gt; |"TOOL_CALL"| TC["ð§ å·¥å·å¡ç"]
        SM --&gt; |"STATE_DELTA"| App["ð åºç¨ç¶æ"]
    end
</div><h3 id="22-æ ¸å¿æºå¶äºä»¶ç±»åç³»ç»">2.2 æ ¸å¿æºå¶ï¼äºä»¶ç±»åç³»ç»</h3>
<p>AG-UI å®ä¹äºä¸å¥å®æ´çäºä»¶ç±»åä½ç³»ï¼çº¦ 20+ ç§ï¼ï¼æåè½å¯åä¸ºåå¤§ç±»ï¼</p>
<h4 id="221-çå½å¨æäºä»¶">2.2.1 çå½å¨æäºä»¶</h4>
<pre><code class="language-typescript">// æºç ä½ç½®ï¼ag-ui/sdks/typescript/packages/core/src/events.ts

enum EventType {
  // è¿è¡çå½å¨æ
  RUN_STARTED = "RUN_STARTED",      // Agent å¼å§æ§è¡
  RUN_FINISHED = "RUN_FINISHED",    // Agent æ§è¡å®æ
  RUN_ERROR = "RUN_ERROR",          // Agent æ§è¡åºé
  
  // æ­¥éª¤çå½å¨æ
  STEP_STARTED = "STEP_STARTED",    // å¼å§æ§è¡æä¸ªæ­¥éª¤
  STEP_FINISHED = "STEP_FINISHED",  // æ­¥éª¤æ§è¡å®æ
}
</code></pre>
<h4 id="222-æ¶æ¯æµäºä»¶">2.2.2 æ¶æ¯æµäºä»¶</h4>
<pre><code class="language-typescript">enum EventType {
  // ææ¬æ¶æ¯ï¼æµå¼ï¼
  TEXT_MESSAGE_START = "TEXT_MESSAGE_START",
  TEXT_MESSAGE_CONTENT = "TEXT_MESSAGE_CONTENT",  // delta: å¢éææ¬
  TEXT_MESSAGE_END = "TEXT_MESSAGE_END",
  TEXT_MESSAGE_CHUNK = "TEXT_MESSAGE_CHUNK",      // æ¹éæ¨¡å¼
  
  // æèè¿ç¨ï¼å¯éæ´é²ï¼
  THINKING_TEXT_MESSAGE_START = "THINKING_TEXT_MESSAGE_START",
  THINKING_TEXT_MESSAGE_CONTENT = "THINKING_TEXT_MESSAGE_CONTENT",
  THINKING_TEXT_MESSAGE_END = "THINKING_TEXT_MESSAGE_END",
}
</code></pre>
<h4 id="223-å·¥å·è°ç¨äºä»¶">2.2.3 å·¥å·è°ç¨äºä»¶</h4>
<pre><code class="language-typescript">enum EventType {
  // å·¥å·è°ç¨çå½å¨æ
  TOOL_CALL_START = "TOOL_CALL_START",   // åå« toolCallId, toolCallName
  TOOL_CALL_ARGS = "TOOL_CALL_ARGS",      // æµå¼åæ°ï¼delta å­æ®µ
  TOOL_CALL_END = "TOOL_CALL_END",
  TOOL_CALL_RESULT = "TOOL_CALL_RESULT",  // å·¥å·æ§è¡ç»æ
  TOOL_CALL_CHUNK = "TOOL_CALL_CHUNK",    // æ¹éæ¨¡å¼
}
</code></pre>
<h4 id="224-ç¶æåæ­¥äºä»¶">2.2.4 ç¶æåæ­¥äºä»¶</h4>
<pre><code class="language-typescript">enum EventType {
  // ç¶æç®¡ç
  STATE_SNAPSHOT = "STATE_SNAPSHOT",      // å®æ´ç¶æå¿«ç§
  STATE_DELTA = "STATE_DELTA",            // å¢éç¶æï¼JSON Patch RFC 6902ï¼
  MESSAGES_SNAPSHOT = "MESSAGES_SNAPSHOT", // å®æ´æ¶æ¯åå²
  
  // æ´»å¨ç¶æï¼ç¨äº UI å±ç¤ºï¼
  ACTIVITY_SNAPSHOT = "ACTIVITY_SNAPSHOT",
  ACTIVITY_DELTA = "ACTIVITY_DELTA",
}
</code></pre>
<h3 id="23-å®ç°æ¹æ¡ä¼ è¾å±ä¸å®¢æ·ç«¯">2.3 å®ç°æ¹æ¡ï¼ä¼ è¾å±ä¸å®¢æ·ç«¯</h3>
<h4 id="231-ä¼ è¾å±sse--http-binary">2.3.1 ä¼ è¾å±ï¼SSE + HTTP Binary</h4>
<p>AG-UI æ¯æå¤ç§ä¼ è¾æ¹å¼ï¼å¶ä¸­ SSEï¼Server-Sent Eventsï¼æ¯æå¸¸ç¨çï¼</p>
<pre><code class="language-typescript">// æºç ä½ç½®ï¼ag-ui/sdks/typescript/packages/client/src/agent/http.ts

export class HttpAgent extends AbstractAgent {
  protected requestInit(input: RunAgentInput): RequestInit {
    return {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Accept: "text/event-stream",  // å³é®ï¼è¯·æ± SSE æ ¼å¼
      },
      body: JSON.stringify(input),
    };
  }

  run(input: RunAgentInput): Observable&lt;BaseEvent&gt; {
    // 1. åèµ· HTTP è¯·æ±è·å SSE æµ
    const httpEvents = runHttpRequest(this.url, this.requestInit(input));
    // 2. è½¬æ¢ä¸º AG-UI äºä»¶æµ
    return transformHttpEventStream(httpEvents);
  }
}
</code></pre>
<p>ä¼ è¾å±æ°æ®æ ¼å¼ç¤ºä¾ï¼</p>
<pre><code>event: TEXT_MESSAGE_START
data: {"type":"TEXT_MESSAGE_START","messageId":"msg_001","role":"assistant"}

event: TEXT_MESSAGE_CONTENT
data: {"type":"TEXT_MESSAGE_CONTENT","messageId":"msg_001","delta":"ææ¥å¸®æ¨"}

event: TEXT_MESSAGE_CONTENT
data: {"type":"TEXT_MESSAGE_CONTENT","messageId":"msg_001","delta":"æç´¢é¤å..."}

event: TOOL_CALL_START
data: {"type":"TOOL_CALL_START","toolCallId":"call_001","toolCallName":"search_restaurants"}

event: TOOL_CALL_ARGS
data: {"type":"TOOL_CALL_ARGS","toolCallId":"call_001","delta":"{\"cuisine\":\"å·è\"}"}
</code></pre>
<h4 id="232-å®¢æ·ç«¯observable--ä¸­é´ä»¶æ¶æ">2.3.2 å®¢æ·ç«¯ï¼Observable + ä¸­é´ä»¶æ¶æ</h4>
<p>AG-UI å®¢æ·ç«¯éç¨ <strong>RxJS Observable</strong> æ¨¡å¼å¤çäºä»¶æµï¼å¹¶æ¯æä¸­é´ä»¶æ©å±ï¼</p>
<pre><code class="language-typescript">// æºç ä½ç½®ï¼ag-ui/sdks/typescript/packages/client/src/agent/agent.ts

export abstract class AbstractAgent {
  private middlewares: Middleware[] = [];
  
  // è®¢éèæ¨¡å¼ï¼æ¯æå¤ä¸ªæ¶è´¹è
  public subscribe(subscriber: AgentSubscriber) {
    this.subscribers.push(subscriber);
    return { unsubscribe: () =&gt; { /* ... */ } };
  }
  
  // ä¸­é´ä»¶æ³¨å
  public use(...middlewares: (Middleware | MiddlewareFunction)[]): this {
    this.middlewares.push(...normalizedMiddlewares);
    return this;
  }
  
  // æ½è±¡æ¹æ³ï¼å·ä½ Agent å®ç°äºä»¶æµ
  abstract run(input: RunAgentInput): Observable&lt;BaseEvent&gt;;
}
</code></pre>
<h3 id="24-å¯¹æ¥æ¹å¼">2.4 å¯¹æ¥æ¹å¼</h3>
<h4 id="241-æå¡ç«¯å¯¹æ¥python-ç¤ºä¾">2.4.1 æå¡ç«¯å¯¹æ¥ï¼Python ç¤ºä¾ï¼</h4>
<pre><code class="language-python"># Demo é¡¹ç®ï¼demo-agent-ui-protocols/agents/ag-ui-agent/server.py

from sse_starlette.sse import EventSourceResponse

async def generate_events() -&gt; AsyncGenerator[str, None]:
    # 1. åé RUN_STARTED
    yield create_event(EventType.RUN_STARTED, {
        "threadId": thread_id,
        "runId": run_id
    })
    
    # 2. æµå¼è°ç¨ LLM
    async for chunk in llm_stream:
        if chunk.choices[0].delta.content:
            yield create_event(EventType.TEXT_MESSAGE_CONTENT, {
                "messageId": msg_id,
                "delta": chunk.choices[0].delta.content
            })
        
        if chunk.choices[0].delta.tool_calls:
            # å¤çå·¥å·è°ç¨...
            yield create_event(EventType.TOOL_CALL_START, {...})
    
    # 3. åé RUN_FINISHED
    yield create_event(EventType.RUN_FINISHED, {
        "threadId": thread_id,
        "runId": run_id
    })

@app.post("/run")
async def run(request: RunRequest):
    return EventSourceResponse(generate_events())
</code></pre>
<h4 id="242-åç«¯å¯¹æ¥react-ç¤ºä¾">2.4.2 åç«¯å¯¹æ¥ï¼React ç¤ºä¾ï¼</h4>
<pre><code class="language-tsx">// Demo é¡¹ç®ï¼demo-agent-ui-protocols/apps/web/src/app/ag-ui-demo/page.tsx

const handleSendMessage = async (content: string) =&gt; {
  const response = await fetch('http://localhost:8001/run', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ messages: [{ role: 'user', content }] }),
  });
  
  const reader = response.body.getReader();
  const decoder = new TextDecoder();
  
  while (true) {
    const { done, value } = await reader.read();
    if (done) break;
    
    // è§£æ SSE äºä»¶
    const events = parseSSE(decoder.decode(value));
    
    for (const event of events) {
      switch (event.type) {
        case 'TEXT_MESSAGE_CONTENT':
          // æ´æ°æ¶æ¯åå®¹ï¼æµå¼ï¼
          setMessages(prev =&gt; updateMessageContent(prev, event));
          break;
        case 'TOOL_CALL_START':
          // æ¾ç¤ºå·¥å·è°ç¨ UI
          setMessages(prev =&gt; addToolCall(prev, event));
          break;
        case 'TOOL_CALL_RESULT':
          // æ¸²æå·¥å·ç»æ
          setMessages(prev =&gt; updateToolResult(prev, event));
          break;
      }
    }
  }
};
</code></pre>
<div class="mermaid">stateDiagram-v2
    [*] --&gt; Idle: åå§å
    
    Idle --&gt; Running: RUN_STARTED
    
    state Running {
        [*] --&gt; Streaming
        Streaming --&gt; ToolCalling: TOOL_CALL_START
        ToolCalling --&gt; Streaming: TOOL_CALL_RESULT
        Streaming --&gt; Streaming: TEXT_MESSAGE_CONTENT
    }
    
    Running --&gt; Idle: RUN_FINISHED
    Running --&gt; Error: RUN_ERROR
    Error --&gt; Idle: éè¯
</div><hr>
<h2 id="3-a2uiå£°æå¼-ui-çé¶ä¿¡ä»»æ¸²æå¼æ">3. A2UIï¼å£°æå¼ UI çé¶ä¿¡ä»»æ¸²æå¼æ</h2>
<h3 id="31-è®¾è®¡å²å­¦">3.1 è®¾è®¡å²å­¦</h3>
<p>A2UIï¼Agent-to-User Interfaceï¼ç± Google æ¨åºï¼å¶æ ¸å¿çå¿µæ¯ï¼</p>
<blockquote>
<p><strong>"Safe like data, expressive like code"</strong>ï¼åæ°æ®ä¸æ ·å®å¨ï¼åä»£ç ä¸æ ·æè¡¨ç°åï¼</p>
</blockquote>
<p>ä¸ AG-UI ç"åç«¯ä¸»å¯¼"ä¸åï¼A2UI éç¨"<strong>åç«¯ä¸»å¯¼</strong>"çæè·¯ï¼Agent ä¸ä»åéæ°æ®ï¼è¿åé <strong>UI ç»ææè¿°</strong>ãä½ä¸ºäºå®å¨ï¼A2UI ç»å¯¹ä¸åè®¸ Agent åéå¯æ§è¡ä»£ç ï¼HTML/JSï¼ï¼èæ¯åéä¸ç§<strong>å£°æå¼çç»ä»¶æè¿° JSON</strong>ã</p>
<h4 id="311-å®å¨æ§è®¾è®¡">3.1.1 å®å¨æ§è®¾è®¡</h4>
<p>A2UI çå®å¨æ¨¡ååºäº"ç½ååç»ä»¶åº"ï¼Catalogï¼æºå¶ï¼</p>
<pre><code>Agent åªè½è¯´ï¼"æè¦æ¸²æä¸ä¸ª Card ç»ä»¶ï¼ID æ¯ 123ï¼æ é¢æ¯ XXX"
Agent ä¸è½è¯´ï¼"&lt;script&gt;alert('XSS')&lt;/script&gt;"
</code></pre>
<p>è¿ç§è®¾è®¡å®å¨æç»äº LLM çææ¶æä»£ç çé£é©ã</p>
<h4 id="312-è·¨å¹³å°è®¾è®¡">3.1.2 è·¨å¹³å°è®¾è®¡</h4>
<p>ç±äº A2UI åéçæ¯æ½è±¡ç»ä»¶æè¿°èéå·ä½å®ç°ï¼åä¸å¥åè®®å¯ä»¥ï¼</p>
<ul>
<li>å¨ <strong>Web</strong> ç«¯æ¸²æä¸º DOM åç´ </li>
<li>å¨ <strong>iOS</strong> ç«¯æ¸²æä¸º SwiftUI View</li>
<li>å¨ <strong>Android</strong> ç«¯æ¸²æä¸º Compose ç»ä»¶</li>
<li>å¨ <strong>Flutter</strong> ä¸­æ¸²æä¸º Widget</li>
</ul>
<div class="mermaid">flowchart TB
    subgraph Agent["ð§  Agent"]
        LLM["LLM"] --&gt; Gen["A2UI Generator"]
    end
    
    subgraph Protocol["ð¦ A2UI JSON"]
        Gen --&gt; JSON["{âupdateComponentsâ: ...}"]
    end
    
    subgraph Renderers["ð åå¹³å°æ¸²æå¨"]
        JSON --&gt; Web["ð Web\nLit/React"]
        JSON --&gt; iOS["ð iOS\nSwiftUI"]
        JSON --&gt; Android["ð¤ Android\nCompose"]
        JSON --&gt; Flutter["ð¦ Flutter\nWidget"]
    end
    
    subgraph Output["ð± åç UI"]
        Web --&gt; O1["ð¥ï¸ DOM"]
        iOS --&gt; O2["ð± UIKit View"]
        Android --&gt; O3["ð± Compose UI"]
        Flutter --&gt; O4["ð± Widget Tree"]
    end
</div><h3 id="32-æ ¸å¿æºå¶é»æ¥è¡¨ç»ä»¶æ¨¡å">3.2 æ ¸å¿æºå¶ï¼é»æ¥è¡¨ç»ä»¶æ¨¡å</h3>
<h4 id="321-ä¸ºä»ä¹ä¸ç¨åµå¥-json">3.2.1 ä¸ºä»ä¹ä¸ç¨åµå¥ JSONï¼</h4>
<p>ä¼ ç»ç UI æè¿°éå¸¸éç¨åµå¥ç»æï¼</p>
<pre><code class="language-json">// â ä¼ ç»åµå¥ç»æ - å¯¹ LLM ä¸åå¥½
{
  "type": "Column",
  "children": [
    {
      "type": "Text",
      "text": "Hello"
    },
    {
      "type": "Button",
      "children": [{ "type": "Text", "text": "Click" }]
    }
  ]
}
</code></pre>
<p><strong>é®é¢</strong>ï¼</p>
<ul>
<li>LLM å¿é¡»ä¸æ¬¡æ§çæå®ç¾åµå¥ï¼å®¹æåºé</li>
<li>é¾ä»¥å¢éæ´æ°ï¼éè¦éæ°åéæ´ä¸ªæ ï¼</li>
<li>æ·±å±åµå¥é¾ä»¥æµå¼çæ</li>
</ul>
<h4 id="322-é»æ¥è¡¨æ¨¡å">3.2.2 é»æ¥è¡¨æ¨¡å</h4>
<p>A2UI éç¨<strong>é»æ¥è¡¨</strong>ï¼Adjacency Listï¼ç»æï¼å°ç»ä»¶æ "æå¹³"ä¸ºåè¡¨ï¼</p>
<pre><code class="language-json">// æºç ä½ç½®ï¼A2UI/docs/concepts/components.md

// â A2UI é»æ¥è¡¨ç»æ - LLM åå¥½
{
  "surfaceUpdate": {
    "surfaceId": "main",
    "components": [
      {"id": "root", "component": {"Column": {"children": {"explicitList": ["greeting", "buttons"]}}}},
      {"id": "greeting", "component": {"Text": {"text": {"literalString": "Hello"}}}},
      {"id": "buttons", "component": {"Row": {"children": {"explicitList": ["cancel-btn", "ok-btn"]}}}},
      {"id": "cancel-btn", "component": {"Button": {"child": "cancel-text", "action": {"name": "cancel"}}}},
      {"id": "cancel-text", "component": {"Text": {"text": {"literalString": "Cancel"}}}},
      {"id": "ok-btn", "component": {"Button": {"child": "ok-text", "action": {"name": "ok"}}}},
      {"id": "ok-text", "component": {"Text": {"text": {"literalString": "OK"}}}}
    ]
  }
}
</code></pre>
<p><strong>ä¼å¿</strong>ï¼</p>
<ul>
<li>â LLM å¯ä»¥éä¸ªçæç»ä»¶ï¼æ éèèåµå¥</li>
<li>â å¢éæ´æ°ï¼åªåéååçç»ä»¶</li>
<li>â å¤©ç¶æ¯ææµå¼ä¼ è¾ï¼JSONL æ ¼å¼ï¼</li>
</ul>
<h3 id="33-æ¶æ¯ç±»åä½ç³»">3.3 æ¶æ¯ç±»åä½ç³»</h3>
<p>A2UI å®ä¹äºåç§æ ¸å¿æ¶æ¯ç±»åï¼</p>
<pre><code class="language-json">// æºç ä½ç½®ï¼A2UI/specification/0.9/json/server_to_client.json

{
  "oneOf": [
    { "$ref": "#/$defs/CreateSurfaceMessage" },     // åå»º UI è¡¨é¢
    { "$ref": "#/$defs/UpdateComponentsMessage" },  // æ´æ°ç»ä»¶
    { "$ref": "#/$defs/UpdateDataModelMessage" },   // æ´æ°æ°æ®æ¨¡å
    { "$ref": "#/$defs/DeleteSurfaceMessage" }      // å é¤ UI è¡¨é¢
  ]
}
</code></pre>
<h4 id="331-createsurfaceåå§å-ui-è¡¨é¢">3.3.1 createSurfaceï¼åå§å UI è¡¨é¢</h4>
<pre><code class="language-json">{
  "createSurface": {
    "surfaceId": "restaurant-list",
    "catalogId": "a2ui.dev:standard"  // å£°æä½¿ç¨çç»ä»¶åº
  }
}
</code></pre>
<h4 id="332-updatecomponentsåéç»ä»¶å®ä¹">3.3.2 updateComponentsï¼åéç»ä»¶å®ä¹</h4>
<pre><code class="language-json">{
  "updateComponents": {
    "surfaceId": "restaurant-list",
    "components": [
      {
        "id": "root",
        "component": {
          "Column": {
            "children": {"explicitList": ["header", "list"]}
          }
        }
      },
      {
        "id": "header",
        "component": {
          "Text": {
            "text": {"literalString": "æ¨èé¤å"},
            "usageHint": "h1"
          }
        }
      }
      // ... æ´å¤ç»ä»¶
    ]
  }
}
</code></pre>
<h4 id="333-updatedatamodelæ°æ®ä¸-ui-åç¦»">3.3.3 updateDataModelï¼æ°æ®ä¸ UI åç¦»</h4>
<p>A2UI çä¸ä¸ªéè¦è®¾è®¡æ¯<strong>æ°æ®æ¨¡åä¸ç»ä»¶ç»æåç¦»</strong>ãç»ä»¶å¯ä»¥éè¿ <code>path</code> ç»å®æ°æ®ï¼</p>
<pre><code class="language-json">// 1. ç»ä»¶å®ä¹ï¼ç»æï¼
{
  "updateComponents": {
    "surfaceId": "restaurant-list",
    "components": [{
      "id": "restaurant-name",
      "component": {
        "Text": {
          "text": {"path": "/restaurants/0/name"}  // æ°æ®ç»å®
        }
      }
    }]
  }
}

// 2. æ°æ®æ´æ°ï¼åå®¹ï¼
{
  "updateDataModel": {
    "surfaceId": "restaurant-list",
    "path": "/restaurants/0",
    "op": "replace",
    "value": {
      "name": "å·åé¤å",
      "rating": 4.8,
      "price": "$$"
    }
  }
}
</code></pre>
<p><strong>ä¼å¿</strong>ï¼</p>
<ul>
<li>æ´æ°æ°æ®æ ééæ°åéç»ä»¶ç»æ</li>
<li>å¤ä¸ªç»ä»¶å¯ä»¥ç»å®åä¸æ°æ®è·¯å¾</li>
<li>LLM å¯ä»¥åæ­¥çæç»æåæ°æ®</li>
</ul>
<h3 id="34-æ åç»ä»¶åºcatalog">3.4 æ åç»ä»¶åºï¼Catalogï¼</h3>
<p>A2UI å®ä¹äºä¸å¥æ åç»ä»¶åºï¼æ¶µçå¸¸è§ UI éæ±ï¼</p>
<pre><code class="language-json">// æºç ä½ç½®ï¼A2UI/specification/0.9/json/standard_catalog_definition.json

{
  "$defs": {
    "anyComponent": {
      "oneOf": [
        // å±ç¤ºç±»
        { "$ref": "#/$defs/Text" },
        { "$ref": "#/$defs/Image" },
        { "$ref": "#/$defs/Icon" },
        { "$ref": "#/$defs/Video" },
        { "$ref": "#/$defs/AudioPlayer" },
        
        // å¸å±ç±»
        { "$ref": "#/$defs/Row" },
        { "$ref": "#/$defs/Column" },
        { "$ref": "#/$defs/List" },
        
        // å®¹å¨ç±»
        { "$ref": "#/$defs/Card" },
        { "$ref": "#/$defs/Tabs" },
        { "$ref": "#/$defs/Modal" },
        { "$ref": "#/$defs/Divider" },
        
        // äº¤äºç±»
        { "$ref": "#/$defs/Button" },
        { "$ref": "#/$defs/CheckBox" },
        { "$ref": "#/$defs/TextField" },
        { "$ref": "#/$defs/DateTimeInput" },
        { "$ref": "#/$defs/ChoicePicker" },
        { "$ref": "#/$defs/Slider" }
      ]
    }
  }
}
</code></pre>
<h3 id="35-å®¢æ·ç«¯æ¸²æå¨renderer">3.5 å®¢æ·ç«¯æ¸²æå¨ï¼Rendererï¼</h3>
<p>A2UI æä¾äºå¤ç§æ¸²æå¨å®ç°ï¼</p>
<pre><code class="language-typescript">// æºç ä½ç½®ï¼A2UI/renderers/lit/src/0.8/core.ts

export * as Events from "./events/events.js";
export * as Types from "./types/types.js";

import { create as createSignalA2uiMessageProcessor } from "./data/signal-model-processor.js";
import { A2uiMessageProcessor } from "./data/model-processor.js";

export const Data = {
  createSignalA2uiMessageProcessor,  // ååºå¼æ°æ®å¤ç
  A2uiMessageProcessor,               // æ¶æ¯å¤çå¨
  Guards,
};
</code></pre>
<p>æ¸²ææµç¨ï¼</p>
<ol>
<li><strong>è§£ææ¶æ¯</strong>ï¼å° JSONL è§£æä¸ºæ¶æ¯å¯¹è±¡</li>
<li><strong>æå»ºç»ä»¶æ </strong>ï¼æ ¹æ®é»æ¥è¡¨éå»ºæ ç»æ</li>
<li><strong>æ°æ®ç»å®</strong>ï¼å° dataModel æ³¨å¥ç»ä»¶</li>
<li><strong>åçæ¸²æ</strong>ï¼è°ç¨å¹³å°åçç»ä»¶åº</li>
</ol>
<div class="mermaid">flowchart LR
    subgraph Input["ð¥ è¾å¥"]
        JSONL["JSONL Stream"]
    end
    
    subgraph Process["âï¸ å¤çæµç¨"]
        JSONL --&gt; Parse["1ï¸â£ è§£ææ¶æ¯"]
        Parse --&gt; Build["2ï¸â£ æå»ºç»ä»¶æ "]
        Build --&gt; Bind["3ï¸â£ æ°æ®ç»å®"]
        Bind --&gt; Render["4ï¸â£ åçæ¸²æ"]
    end
    
    subgraph Output["ð± è¾åº"]
        Render --&gt; UI["åç UI ç»ä»¶"]
    end
    
    subgraph DataFlow["ð æ°æ®æµ"]
        DM[("DataModel")] -.-&gt;|"/path/to/data"| Bind
    end
</div><h3 id="36-ç¨æ·äº¤äºaction-åä¼ ">3.6 ç¨æ·äº¤äºï¼Action åä¼ </h3>
<p>å½ç¨æ·ç¹å»æé®ç­äº¤äºæ¶ï¼å®¢æ·ç«¯åé <code>userAction</code> æ¶æ¯ï¼</p>
<pre><code class="language-json">// æºç ä½ç½®ï¼A2UI/specification/0.9/json/client_to_server.json

{
  "userAction": {
    "name": "book_restaurant",           // action åç§°
    "surfaceId": "restaurant-list",
    "sourceComponentId": "book-btn",
    "timestamp": "2024-01-07T10:30:00Z",
    "context": {                         // ä¸ä¸ææ°æ®
      "restaurantId": "rest_001",
      "restaurantName": "å·åé¤å"
    }
  }
}
</code></pre>
<h3 id="37-å¯¹æ¥æ¹å¼">3.7 å¯¹æ¥æ¹å¼</h3>
<h4 id="371-æå¡ç«¯å¯¹æ¥python-ç¤ºä¾">3.7.1 æå¡ç«¯å¯¹æ¥ï¼Python ç¤ºä¾ï¼</h4>
<pre><code class="language-python"># Demo é¡¹ç®ï¼demo-agent-ui-protocols/agents/a2ui-agent/server.py

class A2UIGenerator:
    @staticmethod
    def surface_update(surface_id: str, components: list) -&gt; dict:
        return {"surfaceUpdate": {"surfaceId": surface_id, "components": components}}

    @staticmethod
    def data_model_update(surface_id: str, path: str, value: any) -&gt; dict:
        return {
            "updateDataModel": {
                "surfaceId": surface_id,
                "path": path,
                "op": "replace",
                "value": value
            }
        }

async def generate_ui(restaurants: list):
    # 1. åå»º Surface
    yield json.dumps({"createSurface": {"surfaceId": "main", "catalogId": "standard"}})
    
    # 2. åéç»ä»¶ç»æ
    components = create_restaurant_list_components()
    yield json.dumps(A2UIGenerator.surface_update("main", components))
    
    # 3. åéæ°æ®
    for i, restaurant in enumerate(restaurants):
        yield json.dumps(A2UIGenerator.data_model_update(
            "main", 
            f"/restaurants/{i}", 
            restaurant
        ))
</code></pre>
<h4 id="372-åç«¯å¯¹æ¥react-ç¤ºä¾">3.7.2 åç«¯å¯¹æ¥ï¼React ç¤ºä¾ï¼</h4>
<pre><code class="language-tsx">// Demo é¡¹ç®ï¼demo-agent-ui-protocols/apps/web/src/app/a2ui-demo/A2UIRenderer.tsx

const A2UIRenderer = ({ messages }: { messages: A2UIMessage[] }) =&gt; {
  const [components, setComponents] = useState&lt;Map&lt;string, ComponentDef&gt;&gt;();
  const [dataModel, setDataModel] = useState&lt;Record&lt;string, any&gt;&gt;({});
  
  useEffect(() =&gt; {
    for (const msg of messages) {
      if (msg.updateComponents) {
        // æ´æ°ç»ä»¶ Map
        msg.updateComponents.components.forEach(comp =&gt; {
          setComponents(prev =&gt; new Map(prev).set(comp.id, comp));
        });
      }
      if (msg.updateDataModel) {
        // æ´æ°æ°æ®æ¨¡å
        setDataModel(prev =&gt; ({
          ...prev,
          [msg.updateDataModel.path]: msg.updateDataModel.value
        }));
      }
    }
  }, [messages]);
  
  // éå½æ¸²æç»ä»¶æ 
  const renderComponent = (id: string) =&gt; {
    const comp = components.get(id);
    if (!comp) return null;
    
    // æ ¹æ®ç»ä»¶ç±»åæ å°å° React ç»ä»¶
    switch (Object.keys(comp.component)[0]) {
      case 'Text':
        const textValue = resolveValue(comp.component.Text.text, dataModel);
        return &lt;span key={id}&gt;{textValue}&lt;/span&gt;;
      case 'Column':
        return (
          &lt;div key={id} className="flex flex-col"&gt;
            {comp.component.Column.children.explicitList.map(renderComponent)}
          &lt;/div&gt;
        );
      // ... å¶ä»ç»ä»¶
    }
  };
  
  return renderComponent('root');
};
</code></pre>
<hr>
<h2 id="4-mcp-uimcp-åè®®çå¯è§åæ©å±å±">4. MCP-UIï¼MCP åè®®çå¯è§åæ©å±å±</h2>
<h3 id="41-è®¾è®¡å²å­¦">4.1 è®¾è®¡å²å­¦</h3>
<p>MCP-UI æ¯ç¤¾åºåºäº Anthropic ç <strong>Model Context Protocol (MCP)</strong> å¼åç UI æ©å±ãå¶æ ¸å¿çå¿µæ¯ï¼</p>
<blockquote>
<p><strong>"è®©å·¥å·è°ç¨ç»æå·å¤å¯è§åè½å"</strong></p>
</blockquote>
<p>ä¸ AG-UIãA2UI ä¸åï¼MCP-UI ä¸è¯å¾å®ä¹æ°çåè®®ï¼èæ¯<strong>å¤ç¨ç°æç MCP åè®®</strong>ï¼å¨å·¥å·è¿åå¼ä¸­æ·»å  <code>UIResource</code> å­æ®µã</p>
<h4 id="411-ä¸-mcp-çå³ç³»">4.1.1 ä¸ MCP çå³ç³»</h4>
<pre><code>MCP åè®®ï¼
  - Tool Definitionï¼å·¥å·å®ä¹ï¼
  - Tool Callï¼å·¥å·è°ç¨ï¼
  - Tool Resultï¼å·¥å·ç»æï¼ â MCP-UI å¨è¿éæ©å±
</code></pre>
<p>MCP-UI çåæ°å¨äºï¼å·¥å·ä¸ä»å¯ä»¥è¿åææ¬/JSON æ°æ®ï¼è¿å¯ä»¥è¿å<strong>å¯äº¤äºç UI çæ®µ</strong>ã</p>
<h3 id="42-æ ¸å¿æºå¶uiresource">4.2 æ ¸å¿æºå¶ï¼UIResource</h3>
<h4 id="421-uiresource-æ°æ®ç»æ">4.2.1 UIResource æ°æ®ç»æ</h4>
<pre><code class="language-typescript">// æºç ä½ç½®ï¼mcp-ui/sdks/typescript/server/src/types.ts

interface UIResource {
  type: 'resource';
  resource: {
    uri: string;       // å¯ä¸æ è¯ï¼å¦ ui://component/booking-form
    mimeType: MimeType; // åå®¹ç±»å
    text?: string;      // åèåå®¹
    blob?: string;      // Base64 ç¼ç åå®¹
    _meta?: Record&lt;string, unknown&gt;;
  };
}

type MimeType =
  | 'text/html'                           // åè HTML
  | 'text/uri-list'                       // å¤é¨ URL
  | 'application/vnd.mcp-ui.remote-dom+javascript; framework=react'
  | 'application/vnd.mcp-ui.remote-dom+javascript; framework=webcomponents';
</code></pre>
<h4 id="422-ä¸ç§æ¸²ææ¨¡å¼">4.2.2 ä¸ç§æ¸²ææ¨¡å¼</h4>
<p>MCP-UI æ¯æä¸ç§ä¸åç UI èµæºç±»åï¼</p>
<p><strong>1. Raw HTMLï¼åè HTMLï¼</strong></p>
<pre><code class="language-typescript">{
  uri: "ui://restaurant/card",
  mimeType: "text/html",
  text: `
    &lt;div class="restaurant-card"&gt;
      &lt;h2&gt;å·åé¤å&lt;/h2&gt;
      &lt;button onclick="window.parent.postMessage({type:'tool',payload:{toolName:'book'}},'*')"&gt;
        é¢è®¢
      &lt;/button&gt;
    &lt;/div&gt;
  `
}
</code></pre>
<p><strong>2. External URLï¼å¤é¨é¡µé¢ï¼</strong></p>
<pre><code class="language-typescript">{
  uri: "ui://restaurant/detail",
  mimeType: "text/uri-list",
  text: "https://restaurant.example.com/embed/123"
}
</code></pre>
<p><strong>3. Remote DOMï¼è¿ç¨ DOMï¼</strong></p>
<p>è¿æ¯ MCP-UI æå¼ºå¤§çæ¨¡å¼ï¼åºäº Shopify ç <a href="https://github.com/Shopify/remote-dom" target="_blank" rel="noopener nofollow">remote-dom</a> ææ¯ï¼</p>
<pre><code class="language-typescript">{
  uri: "ui://restaurant/form",
  mimeType: "application/vnd.mcp-ui.remote-dom+javascript; framework=react",
  text: `
    // è¿æ®µ JS å¨æ²ç®±ä¸­æ§è¡ï¼éè¿ JSON æ¶æ¯ä¸å®¿ä¸»éä¿¡
    const form = document.createElement('ui-form');
    form.addEventListener('submit', (e) =&gt; {
      window.postMessage({ type: 'tool', payload: { toolName: 'submit_booking', params: e.detail } });
    });
    document.body.appendChild(form);
  `
}
</code></pre>
<div class="mermaid">flowchart TB
    subgraph Server["ð§ MCP Server"]
        Tool["Tool Result"] --&gt; UIRes["UIResource"]
    end
    
    UIRes --&gt; Type{"mimeType?"}
    
    subgraph Mode1["ð Raw HTML"]
        Type --&gt;|"text/html"| HTML["iframe srcDoc"]
        HTML --&gt; Sandbox1["ð æ²ç®±æ¸²æ"]
    end
    
    subgraph Mode2["ð External URL"]
        Type --&gt;|"text/uri-list"| URL["iframe src"]
        URL --&gt; Sandbox2["ð å¤é¨é¡µé¢"]
    end
    
    subgraph Mode3["ð¥ï¸ Remote DOM"]
        Type --&gt;|"remote-dom"| Script["JS Script"]
        Script --&gt; Worker["ð æ²ç®±æ§è¡"]
        Worker --&gt;|"JSON Patch"| Host["ð  å®¿ä¸»æ¸²æ"]
    end
    
    Sandbox1 &amp; Sandbox2 &amp; Host --&gt; Actions["ð¤ postMessage"]
    Actions --&gt; Client["ð± å®¢æ·ç«¯å¤ç"]
</div><h3 id="43-å®¢æ·ç«¯æ¸²æå¨">4.3 å®¢æ·ç«¯æ¸²æå¨</h3>
<h4 id="431-uiresourcerenderer-ç»ä»¶">4.3.1 UIResourceRenderer ç»ä»¶</h4>
<pre><code class="language-tsx">// æºç ä½ç½®ï¼mcp-ui/sdks/typescript/client/src/components/UIResourceRenderer.tsx

export const UIResourceRenderer = (props: UIResourceRendererProps) =&gt; {
  const { resource, onUIAction, supportedContentTypes } = props;
  const contentType = getContentType(resource);

  switch (contentType) {
    case 'rawHtml':
    case 'externalUrl':
      // ä½¿ç¨ iframe æ²ç®±æ¸²æ
      return &lt;HTMLResourceRenderer resource={resource} onUIAction={onUIAction} /&gt;;
      
    case 'remoteDom':
      // ä½¿ç¨ Remote DOM æ¸²æï¼æ´å®å¨ãæ´çµæ´»ï¼
      return &lt;RemoteDOMResourceRenderer resource={resource} onUIAction={onUIAction} /&gt;;
      
    default:
      return &lt;p&gt;Unsupported resource type.&lt;/p&gt;;
  }
};
</code></pre>
<h4 id="432-remote-dom-æ¸²æå¨">4.3.2 Remote DOM æ¸²æå¨</h4>
<p>Remote DOM æ¨¡å¼ä¸ï¼UI é»è¾å¨ iframe æ²ç®±ä¸­æ§è¡ï¼ä½ DOM ååéè¿ JSON æ¶æ¯åæ­¥å°å®¿ä¸»ï¼</p>
<pre><code class="language-tsx">// æºç ä½ç½®ï¼mcp-ui/sdks/typescript/client/src/components/RemoteDOMResourceRenderer.tsx

const RemoteDOMResourceRenderer: React.FC&lt;RemoteDOMResourceProps&gt; = ({
  resource, library, onUIAction
}) =&gt; {
  const iframeRef = useRef&lt;HTMLIFrameElement&gt;(null);
  
  // 1. åå»º Remote Receiverï¼æ¥æ¶ DOM ååï¼
  const { receiver, components } = useMemo(() =&gt; {
    const reactReceiver = new RemoteReceiver();
    // å°ç»ä»¶åºæ å°ä¸º Remote Components
    // ...
    return { receiver: reactReceiver, components: componentMap };
  }, [library]);
  
  // 2. çå¬ iframe æ¶æ¯ï¼UI Actionï¼
  useEffect(() =&gt; {
    const handleMessage = (event: MessageEvent) =&gt; {
      if (event.source === iframeRef.current?.contentWindow) {
        onUIAction?.(event.data as UIActionResult);
      }
    };
    window.addEventListener('message', handleMessage);
    return () =&gt; window.removeEventListener('message', handleMessage);
  }, [onUIAction]);
  
  // 3. iframe å è½½åæ³¨å¥ä»£ç 
  const handleIframeLoad = () =&gt; {
    const thread = new ThreadIframe&lt;SandboxAPI&gt;(iframeRef.current);
    thread.imports.render({ code: resource.text, ... }, receiver.connection);
  };
  
  return (
    &lt;&gt;
      &lt;iframe ref={iframeRef} srcDoc={IFRAME_SRC_DOC} onLoad={handleIframeLoad} /&gt;
      {/* Remote DOM æ¸²æç»æ */}
      &lt;RemoteRootRenderer receiver={receiver} components={components} /&gt;
    &lt;/&gt;
  );
};
</code></pre>
<h3 id="44-ui-action-ç³»ç»">4.4 UI Action ç³»ç»</h3>
<p>MCP-UI å®ä¹äºäºç§ UI äº¤äºç±»åï¼</p>
<pre><code class="language-typescript">// æºç ä½ç½®ï¼mcp-ui/sdks/typescript/client/src/types.ts

export type UIActionResult =
  | { type: 'tool', payload: { toolName: string, params: Record&lt;string, unknown&gt; } }
  | { type: 'prompt', payload: { prompt: string } }
  | { type: 'link', payload: { url: string } }
  | { type: 'intent', payload: { intent: string, params: Record&lt;string, unknown&gt; } }
  | { type: 'notify', payload: { message: string } };
</code></pre>
<p><strong>ä½¿ç¨åºæ¯</strong>ï¼</p>
<ul>
<li><code>tool</code>ï¼è§¦åå·¥å·è°ç¨ï¼å¦"é¢è®¢"æé®ï¼</li>
<li><code>prompt</code>ï¼åéæ°çç¨æ·æ¶æ¯</li>
<li><code>link</code>ï¼æå¼å¤é¨é¾æ¥</li>
<li><code>intent</code>ï¼è§¦ååºç¨åæå¾</li>
<li><code>notify</code>ï¼æ¾ç¤ºéç¥æ¶æ¯</li>
</ul>
<h3 id="45-å¯¹æ¥æ¹å¼">4.5 å¯¹æ¥æ¹å¼</h3>
<h4 id="451-æå¡ç«¯å¯¹æ¥python-ç¤ºä¾">4.5.1 æå¡ç«¯å¯¹æ¥ï¼Python ç¤ºä¾ï¼</h4>
<pre><code class="language-python"># Demo é¡¹ç®ï¼demo-agent-ui-protocols/agents/mcp-ui-agent/server.py

def create_restaurant_card_ui(restaurants: list) -&gt; dict:
    html = f"""
    &lt;div class="restaurant-list"&gt;
        {''.join([f'''
        &lt;div class="restaurant-card" data-id="{r['id']}"&gt;
            &lt;img src="{r['image']}" /&gt;
            &lt;h3&gt;{r['name']}&lt;/h3&gt;
            &lt;p&gt;è¯å: {r['rating']} | ä»·æ ¼: {r['price']}&lt;/p&gt;
            &lt;button onclick="window.parent.postMessage({{
                type: 'tool',
                payload: {{
                    toolName: 'show_booking_form',
                    params: {{ restaurant_name: '{r['name']}' }}
                }}
            }}, '*')"&gt;é¢è®¢&lt;/button&gt;
        &lt;/div&gt;
        ''' for r in restaurants])}
    &lt;/div&gt;
    """
    
    return {
        "type": "ui_resource",
        "resource": {
            "uri": "ui://restaurant/list",
            "mimeType": "text/html",
            "text": html
        }
    }

@app.post("/run")
async def run(request: RunRequest):
    if request.tool_call:
        # ç´æ¥æ§è¡å·¥å·è°ç¨
        result = execute_tool(request.tool_call.name, request.tool_call.params)
        return result
    else:
        # è®© LLM å³å®è°ç¨åªä¸ªå·¥å·
        response = await call_llm_with_tools(request.messages)
        return response
</code></pre>
<h4 id="452-åç«¯å¯¹æ¥react-ç¤ºä¾">4.5.2 åç«¯å¯¹æ¥ï¼React ç¤ºä¾ï¼</h4>
<pre><code class="language-tsx">// Demo é¡¹ç®ï¼demo-agent-ui-protocols/apps/web/src/app/mcp-ui-demo/page.tsx

const MCPUIDemo = () =&gt; {
  const [currentUI, setCurrentUI] = useState&lt;UIResource | null&gt;(null);
  
  // å¤çæ¥èª UI ç Action
  useEffect(() =&gt; {
    const handleMessage = async (event: MessageEvent) =&gt; {
      const { type, payload } = event.data;
      
      if (type === 'tool') {
        // è°ç¨åç«¯å·¥å·
        const response = await fetch('http://localhost:8003/run', {
          method: 'POST',
          body: JSON.stringify({ tool_call: payload }),
        });
        const result = await response.json();
        
        if (result.type === 'ui_resource') {
          setCurrentUI(result.resource);
        }
      }
    };
    
    window.addEventListener('message', handleMessage);
    return () =&gt; window.removeEventListener('message', handleMessage);
  }, []);
  
  return (
    &lt;div&gt;
      {currentUI &amp;&amp; (
        &lt;UIResourceRenderer 
          resource={currentUI.resource}
          onUIAction={handleToolCallback}
        /&gt;
      )}
    &lt;/div&gt;
  );
};
</code></pre>
<hr>
<h2 id="5-åè®®ç»åag-ui--a2ui-çååæ¶æ">5. åè®®ç»åï¼AG-UI + A2UI çååæ¶æ</h2>
<h3 id="51-ä¸ºä»ä¹è¦ç»åä½¿ç¨">5.1 ä¸ºä»ä¹è¦ç»åä½¿ç¨ï¼</h3>
<p>ä¸ç§åè®®å¹¶éäºæ¥å³ç³»ï¼å®ä»¬å¯ä»¥<strong>ååå·¥ä½</strong>ï¼åæ¥åèªä¼å¿ãç¹å«æ¯ <strong>AG-UI + A2UI</strong> çç»åï¼å¨ A2UI å®æ¹ææ¡£ä¸­è¢«æç¡®æåï¼</p>
<blockquote>
<p>"AG UI translates from A2UI messages to AG UI messages, and handles transport and state sync automatically."</p>
<p>â <a href="A2UI/docs/transports.md" target="_blank" rel="noopener nofollow">A2UI Transports ææ¡£</a></p>
</blockquote>
<h3 id="52-ag-ui-ä½ä¸º-a2ui-çä¼ è¾å±">5.2 AG-UI ä½ä¸º A2UI çä¼ è¾å±</h3>
<p>å¨è¿ç§æ¶æä¸ï¼</p>
<ul>
<li><strong>A2UI</strong> è´è´£ï¼UI ç»æå®ä¹ãç»ä»¶è§èãæ°æ®æ¨¡å</li>
<li><strong>AG-UI</strong> è´è´£ï¼æ¶æ¯ä¼ è¾ãç¶æåæ­¥ãäºä»¶è·¯ç±</li>
</ul>
<div class="mermaid">flowchart TB
    subgraph Frontend["ð¥ï¸ Frontend"]
        Client["AG-UI Client\n(Events)"] --&gt; A2UIMsg["A2UI Messages\n(JSON)"]
        A2UIMsg --&gt; Renderer["A2UI Renderer\n(Components)"]
    end
    
    subgraph Transport["ð¡ Transport"]
        Client &lt;-.-&gt;|"SSE Events"| Server
    end
    
    subgraph Agent["ð¤ Agent"]
        Server["AG-UI Server\n(SSE Stream)"] --&gt; Generator["A2UI Generator\n(JSONL)"]
        Generator --&gt; LLM["LLM / Tools"]
    end
    
    style Frontend fill:#e3f2fd
    style Transport fill:#fff3e0
    style Agent fill:#f3e5f5
</div><h3 id="53-å®ç°æ¹å¼å°-a2ui-æ¶æ¯åè£ä¸º-ag-ui-äºä»¶">5.3 å®ç°æ¹å¼ï¼å° A2UI æ¶æ¯åè£ä¸º AG-UI äºä»¶</h3>
<pre><code class="language-typescript">// ä¼ªä»£ç ï¼AG-UI + A2UI éæ

// 1. Agent çæ A2UI æ¶æ¯
const a2uiMessages = generateA2UIComponents(restaurants);

// 2. åè£ä¸º AG-UI ç CUSTOM æ ACTIVITY_SNAPSHOT äºä»¶
for (const msg of a2uiMessages) {
  yield {
    type: EventType.ACTIVITY_SNAPSHOT,
    messageId: `a2ui-${Date.now()}`,
    activityType: "a2ui",  // æ è®°ä¸º A2UI æ¶æ¯
    content: msg,          // A2UI åå§æ¶æ¯
  };
}

// 3. åç«¯æ ¹æ® activityType è·¯ç±å° A2UI æ¸²æå¨
agent.subscribe({
  onActivitySnapshot: (event) =&gt; {
    if (event.activityType === "a2ui") {
      a2uiRenderer.processMessage(event.content);
    }
  }
});
</code></pre>
<h3 id="54-ag-ui--mcp-ui-çç»å">5.4 AG-UI + MCP-UI çç»å</h3>
<p>AG-UI å®æ¹æä¾äº <code>@ag-ui/mcp-apps-middleware</code>ï¼å¯ä»¥å° MCP-UI ç UI èµæºéæå° AG-UI äºä»¶æµä¸­ï¼</p>
<pre><code class="language-typescript">// æºç ä½ç½®ï¼ag-ui/middlewares/mcp-apps-middleware/README.md

import { MCPAppsMiddleware } from "@ag-ui/mcp-apps-middleware";

const agent = new YourAgent().use(
  new MCPAppsMiddleware({
    mcpServers: [
      { type: "http", url: "http://localhost:3001/mcp" }
    ],
  })
);

// ä¸­é´ä»¶èªå¨ï¼
// 1. åç° MCP Server ç UI-enabled Tools
// 2. å°å·¥å·æ³¨å¥ Agent çå·¥å·åè¡¨
// 3. æ§è¡å·¥å·è°ç¨å¹¶è·å UIResource
// 4. åå° ACTIVITY_SNAPSHOT äºä»¶ï¼activityType: "mcp-apps"ï¼
</code></pre>
<h3 id="55-ä¸åè®®èåæ¶æ">5.5 ä¸åè®®èåæ¶æ</h3>
<p>å¨å¤æåºæ¯ä¸ï¼ä¸ç§åè®®å¯ä»¥åæ¶ä½¿ç¨ï¼</p>
<div class="mermaid">flowchart TB
    subgraph Frontend["ð¥ï¸ Frontend"]
        subgraph Router["AG-UI Event Router"]
            TextR["ð Text/Tool\nRenderer"]
            A2UIR["ð± A2UI Renderer\n(a2ui type)"]
            MCPR["ð§ MCP-UI Renderer\n(mcp-apps type)"]
        end
    end
    
    Router &lt;-.-&gt;|"SSE Events"| Server
    
    subgraph Agent["ð¤ Agent"]
        subgraph ServerLayer["AG-UI Server + Middlewares"]
            LLMAdapter["LLM Adapter"]
            A2AMW["A2A Middleware"]
            MCPMW["MCP-Apps Middleware"]
        end
        
        LLMAdapter --&gt; LLM[("ð§  LLM\n(OpenAI)")]
        A2AMW --&gt; SubAgents[("ð¤ A2A Agents\n(Sub-agents)")]
        MCPMW --&gt; MCPServers[("ð MCP Servers\n(Tools+UI)")]
    end
    
    style Frontend fill:#e3f2fd
    style Agent fill:#f3e5f5
    style Router fill:#e8f5e9
    style ServerLayer fill:#fff3e0
</div><p><strong>ååè®®èè´£</strong>ï¼</p>
<ul>
<li><strong>AG-UI</strong>ï¼ä½ä¸º"æ»çº¿"ï¼è´è´£äºä»¶è·¯ç±åç¶æåæ­¥</li>
<li><strong>A2UI</strong>ï¼è´è´£å¤æçãè·¨å¹³å°çå£°æå¼ UI</li>
<li><strong>MCP-UI</strong>ï¼è´è´£å·¥å·çº§å«çå¿«é UI æ©å±</li>
</ul>
<hr>
<h2 id="6-ææ¯éåå³ç­æ¡æ¶">6. ææ¯éåå³ç­æ¡æ¶</h2>
<h3 id="61-ç»´åº¦å¯¹æ¯è¡¨">6.1 ç»´åº¦å¯¹æ¯è¡¨</h3>
<table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>AG-UI</th>
<th>A2UI</th>
<th>MCP-UI</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ ¸å¿çå¿µ</strong></td>
<td>äºä»¶é©±å¨çç¶æåæ­¥</td>
<td>å£°æå¼ UI ç»ä»¶è§è</td>
<td>MCP å·¥å·ç UI æ©å±</td>
</tr>
<tr>
<td><strong>UI æ§å¶æ</strong></td>
<td>åç«¯ä¸»å¯¼</td>
<td>åç«¯ä¸»å¯¼ï¼ç»æï¼</td>
<td>åç«¯ä¸»å¯¼ï¼åå®¹ï¼</td>
</tr>
<tr>
<td><strong>å®å¨æ¨¡å</strong></td>
<td>ä¾èµåç«¯å®ç°</td>
<td><strong>æé«</strong>ï¼ç½ååç»ä»¶ï¼</td>
<td>ä¸­ç­ï¼iframe æ²ç®±ï¼</td>
</tr>
<tr>
<td><strong>è·¨å¹³å°è½å</strong></td>
<td>å¼±ï¼éåç«¯ééï¼</td>
<td><strong>æå¼º</strong>ï¼æ½è±¡ç»ä»¶ï¼</td>
<td>ä¸­ç­ï¼Web ä¼åï¼</td>
</tr>
<tr>
<td><strong>å®æ¶æ§</strong></td>
<td><strong>æå¼º</strong>ï¼æµå¼äºä»¶ï¼</td>
<td>ä¸­ç­ï¼JSONL æµï¼</td>
<td>å¼±ï¼Request-Responseï¼</td>
</tr>
<tr>
<td><strong>å¼åå¤æåº¦</strong></td>
<td>åç«¯å¤æ</td>
<td>æ¶æå¤æ</td>
<td><strong>æç®å</strong></td>
</tr>
<tr>
<td><strong>çæå¼å®¹æ§</strong></td>
<td>CopilotKit çæ</td>
<td>Google çæ</td>
<td>MCP çæ</td>
</tr>
</tbody>
</table>
<h3 id="62-åºæ¯-åè®®å¹éæå">6.2 åºæ¯-åè®®å¹éæå</h3>
<h4 id="åºæ¯-aä¼ä¸çº§-copilot-ç³»ç»">åºæ¯ Aï¼ä¼ä¸çº§ Copilot ç³»ç»</h4>
<p><strong>éæ±ç¹å¾</strong>ï¼</p>
<ul>
<li>éè¦ä¸ç°æå¤æä¸å¡ç³»ç»æ·±åº¦éæ</li>
<li>Agent éè¦æä½ç°æ UI ç¶æï¼å¦é«äº®è¡¨æ ¼è¡ãå¡«åè¡¨åï¼</li>
<li>éè¦å®æ¶å±ç¤º Agent æèè¿ç¨</li>
</ul>
<p><strong>æ¨èæ¹æ¡</strong>ï¼<strong>AG-UI ä¸ºä¸»</strong></p>
<pre><code class="language-typescript">// AG-UI å¯ä»¥é©±å¨ç°æ UI ç¶æ
agent.subscribe({
  onStateDelta: (event) =&gt; {
    // å¢éæ´æ°åºç¨ç¶æ
    applyJsonPatch(appState, event.delta);
  },
  onToolCallStart: (event) =&gt; {
    // é«äº®ç¸å³ UI åºå
    highlightUIRegion(event.toolCallName);
  }
});
</code></pre>
<h4 id="åºæ¯-bè·¨å¹³å°æ¶è´¹çº§-app">åºæ¯ Bï¼è·¨å¹³å°æ¶è´¹çº§ App</h4>
<p><strong>éæ±ç¹å¾</strong>ï¼</p>
<ul>
<li>åæ¶æ¯æ WebãiOSãAndroid</li>
<li>å¯¹å®å¨æ§è¦æ±æé«ï¼é²æ­¢ XSSãå¹»è§è¾åºï¼</li>
<li>éè¦ç»ä¸çè®¾è®¡è¯­è¨</li>
</ul>
<p><strong>æ¨èæ¹æ¡</strong>ï¼<strong>A2UI ä¸ºä¸»</strong></p>
<pre><code class="language-json">// A2UI ä¸æ¬¡å®ä¹ï¼å¤ç«¯æ¸²æ
{
  "updateComponents": {
    "components": [
      {"id": "card", "component": {"Card": {...}}}
    ]
  }
}

// Web ç«¯ï¼æ¸²æä¸º &lt;div class="card"&gt;
// iOS ç«¯ï¼æ¸²æä¸º SwiftUI Card
// Android ç«¯ï¼æ¸²æä¸º Compose Card
</code></pre>
<h4 id="åºæ¯-cå¼åèå·¥å·--ide-æä»¶">åºæ¯ Cï¼å¼åèå·¥å· / IDE æä»¶</h4>
<p><strong>éæ±ç¹å¾</strong>ï¼</p>
<ul>
<li>éè¦å¿«éä¸ºç°æå·¥å·æ·»å  UI</li>
<li>å¸æç¬¬ä¸æ¹å¼åèè½è´¡ç® UI æä»¶</li>
<li>ä¸éè¦å¤æçè·¨å¹³å°æ¯æ</li>
</ul>
<p><strong>æ¨èæ¹æ¡</strong>ï¼<strong>MCP-UI ä¸ºä¸»</strong></p>
<pre><code class="language-typescript">// MCP Server è¿å UI
server.tool("show_code_diff", () =&gt; ({
  type: "ui_resource",
  resource: {
    uri: "ui://diff/viewer",
    mimeType: "text/html",
    text: generateDiffHTML(changes)
  }
}));
</code></pre>
<h4 id="åºæ¯-då¤æå¤-agent-ç³»ç»">åºæ¯ Dï¼å¤æå¤ Agent ç³»ç»</h4>
<p><strong>éæ±ç¹å¾</strong>ï¼</p>
<ul>
<li>å¤ä¸ª Agent åä½</li>
<li>æ¢éè¦å®æ¶ç¶æåæ­¥ï¼åéè¦ä¸°å¯ UI</li>
<li>éè¦è°ç¨å¤é¨ MCP å·¥å·</li>
</ul>
<p><strong>æ¨èæ¹æ¡</strong>ï¼<strong>AG-UI + A2UI + MCP-UI ç»å</strong></p>
<pre><code class="language-typescript">const agent = new OrchestrationAgent()
  .use(new A2AMiddleware({ agentUrls: [...] }))    // è¿æ¥å­ Agent
  .use(new MCPAppsMiddleware({ mcpServers: [...] })) // è¿æ¥ MCP å·¥å·
  .use(new A2UIMiddleware({ catalog: 'standard' })); // æ¯æ A2UI æ¸²æ
</code></pre>
<h3 id="63-å³ç­æµç¨å¾">6.3 å³ç­æµç¨å¾</h3>
<div class="mermaid">flowchart TB
    Start(["ð å¼å§éå"]) --&gt; Q1{"æ¯å¦éè¦&lt;br/&gt;è·¨å¹³å°åçæ¸²æï¼"}
    
    Q1 --&gt;|"â Yes"| A2UI["ð± A2UI ä¸ºä¸»&lt;br/&gt;&lt;i&gt;ç»ä¸å®ä¹ï¼å¤ç«¯åç&lt;/i&gt;"]
    Q1 --&gt;|"â No"| Q2{"æ¯å¦éè¦&lt;br/&gt;å®æ¶ç¶æåæ­¥ï¼"}
    
    Q2 --&gt;|"â Yes"| AGUI["â¡ AG-UI ä¸ºä¸»&lt;br/&gt;&lt;i&gt;äºä»¶é©±å¨ï¼ç¶æéæ&lt;/i&gt;"]
    Q2 --&gt;|"â No"| Q3{"æ¯å¦å¤ç¨&lt;br/&gt;MCP çæï¼"}
    
    Q3 --&gt;|"â Yes"| MCPUI["ð§ MCP-UI ä¸ºä¸»&lt;br/&gt;&lt;i&gt;å·¥å·å³ UIï¼æ¸è¿å¢å¼º&lt;/i&gt;"]
    Q3 --&gt;|"â No"| Custom["ð¨ èªå®ä¹æ¹æ¡&lt;br/&gt;&lt;i&gt;æ ¹æ®éæ±å®å¶&lt;/i&gt;"]
    
    subgraph Combinations["ð¡ ç»åæ¹æ¡"]
        AGUI --&gt; Combo1["AG-UI + A2UI&lt;br/&gt;&lt;i&gt;äºä»¶ä¼ è¾ + å£°æå¼UI&lt;/i&gt;"]
        AGUI --&gt; Combo2["AG-UI + MCP-UI&lt;br/&gt;&lt;i&gt;äºä»¶ä¼ è¾ + å·¥å·UI&lt;/i&gt;"]
        A2UI --&gt; Combo1
    end
    
    style Start fill:#e1f5fe
    style A2UI fill:#c8e6c9
    style AGUI fill:#fff3e0
    style MCPUI fill:#f3e5f5
    style Custom fill:#ffecb3
</div><hr>
<h2 id="7-demo-é¡¹ç®å®æè§£æ">7. Demo é¡¹ç®å®æè§£æ</h2>
<h3 id="71-é¡¹ç®ç»æ">7.1 é¡¹ç®ç»æ</h3>
<p><code>demo-agent-ui-protocols</code> é¡¹ç®éè¿ä¸ä¸ªç»ä¸ç"é¤åæç´¢"åºæ¯ï¼åæ¶æ¼ç¤ºä¸ç§åè®®ï¼</p>
<pre><code>demo-agent-ui-protocols/
âââ apps/web/                 # Next.js åç«¯
â   âââ src/app/
â       âââ ag-ui-demo/       # AG-UI æ¼ç¤ºé¡µé¢
â       âââ a2ui-demo/        # A2UI æ¼ç¤ºé¡µé¢
â       âââ mcp-ui-demo/      # MCP-UI æ¼ç¤ºé¡µé¢
â
âââ agents/
â   âââ ag-ui-agent/          # AG-UI Python Agent (port 8001)
â   âââ a2ui-agent/           # A2UI Python Agent (port 8002)
â   âââ mcp-ui-agent/         # MCP-UI Python Agent (port 8003)
â
âââ packages/shared/          # å±äº«ç±»åå®ä¹
</code></pre>
<h3 id="72-åä¸åºæ¯çä¸ç§å®ç°å¯¹æ¯">7.2 åä¸åºæ¯çä¸ç§å®ç°å¯¹æ¯</h3>
<h4 id="721-ç¨æ·è¾å¥">7.2.1 ç¨æ·è¾å¥</h4>
<blockquote>
<p>"å¸®ææ¾ä¸å®¶åäº¬çå·èé¦"</p>
</blockquote>
<h4 id="722-ag-ui-å®ç°">7.2.2 AG-UI å®ç°</h4>
<pre><code>[SSE Stream]
event: RUN_STARTED
data: {"runId":"run_001","threadId":"thread_001"}

event: TEXT_MESSAGE_START
data: {"messageId":"msg_001","role":"assistant"}

event: TEXT_MESSAGE_CONTENT
data: {"messageId":"msg_001","delta":"å¥½çï¼ææ¥å¸®æ¨"}

event: TEXT_MESSAGE_CONTENT
data: {"messageId":"msg_001","delta":"æç´¢åäº¬çå·èé¦..."}

event: TOOL_CALL_START
data: {"toolCallId":"call_001","toolCallName":"search_restaurants"}

event: TOOL_CALL_ARGS
data: {"toolCallId":"call_001","delta":"{\"cuisine\":\"å·è\",\"location\":\"åäº¬\"}"}

event: TOOL_CALL_RESULT
data: {"toolCallId":"call_001","result":"[{\"name\":\"å·åé¤å\",...}]"}

event: TEXT_MESSAGE_CONTENT
data: {"messageId":"msg_001","delta":"ä¸ºæ¨æ¾å°ä»¥ä¸é¤åï¼"}

event: RUN_FINISHED
data: {"runId":"run_001"}
</code></pre>
<p><strong>åç«¯ææ</strong>ï¼å®æ¶å±ç¤ºæå­ææ + å·¥å·è°ç¨å¡ç</p>
<h4 id="723-a2ui-å®ç°">7.2.3 A2UI å®ç°</h4>
<pre><code>[JSONL Stream]
{"createSurface":{"surfaceId":"results","catalogId":"standard"}}

{"updateComponents":{"surfaceId":"results","components":[
  {"id":"root","component":{"Column":{"children":{"explicitList":["header","list"]}}}},
  {"id":"header","component":{"Text":{"text":{"literalString":"æ¨èé¤å"},"usageHint":"h1"}}},
  {"id":"list","component":{"List":{"children":{"template":{"dataBinding":"/restaurants","componentId":"card-template"}}}}}
]}}

{"updateDataModel":{"surfaceId":"results","path":"/restaurants","value":[
  {"name":"å·åé¤å","rating":4.8,"price":"$$","image":"..."},
  {"name":"çå·ä¸å¡","rating":4.5,"price":"$$$","image":"..."}
]}}
</code></pre>
<p><strong>åç«¯ææ</strong>ï¼åçç»ä»¶æ¸²æçé¤åå¡çåè¡¨</p>
<h4 id="724-mcp-ui-å®ç°">7.2.4 MCP-UI å®ç°</h4>
<pre><code class="language-json">// Request
{ "messages": [{ "role": "user", "content": "å¸®ææ¾ä¸å®¶åäº¬çå·èé¦" }] }

// Response
{
  "role": "assistant",
  "content": "å¥½çï¼è¿æ¯æç´¢ç»æï¼",
  "ui_resource": {
    "type": "resource",
    "resource": {
      "uri": "ui://restaurant/list",
      "mimeType": "text/html",
      "text": "&lt;div class='restaurant-list'&gt;..."
    }
  }
}
</code></pre>
<p><strong>åç«¯ææ</strong>ï¼iframe ååµç HTML å¡ç</p>
<h3 id="73-è¿è¡-demo">7.3 è¿è¡ Demo</h3>
<pre><code class="language-bash"># 1. åéé¡¹ç®
git clone https://github.com/MadLongTom/demo-agent-ui-protocols
cd demo-agent-ui-protocols

# 2. éç½®ç¯å¢åé
cp .env.example .env
# ç¼è¾ .env å¡«å¥ OPENAI_API_KEY ç­

# 3. å®è£ä¾èµ
./install.sh

# 4. å¯å¨æææå¡
./run.sh

# 5. è®¿é® Demo
# AG-UI:  http://localhost:3000/ag-ui-demo
# A2UI:   http://localhost:3000/a2ui-demo
# MCP-UI: http://localhost:3000/mcp-ui-demo
</code></pre>
<p><img alt="AG-UI" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3358435/202601/3358435-20260107143420955-1827685412.png" class="lazyload"><br>
<img alt="A2UI" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3358435/202601/3358435-20260107143420928-681840902.png" class="lazyload"><br>
<img alt="MCP-UI" loading="lazy" data-src="https://img2024.cnblogs.com/blog/3358435/202601/3358435-20260107143420899-1686119722.png" class="lazyload"></p>
<hr>
<h2 id="8-æ»ç»ä¸å±æ">8. æ»ç»ä¸å±æ</h2>
<h3 id="81-æ ¸å¿è§ç¹åé¡¾">8.1 æ ¸å¿è§ç¹åé¡¾</h3>
<ol>
<li>
<p><strong>AG-UI</strong> æ¯"äºä»¶æ»çº¿"ï¼å®ä¸å³å¿ UI é¿ä»ä¹æ ·ï¼åªè´è´£æ Agent çç¶æååå¹¿æ­åºå»ãéåéè¦<strong>æ·±åº¦éæ</strong>å<strong>å®æ¶åé¦</strong>çåºæ¯ã</p>
</li>
<li>
<p><strong>A2UI</strong> æ¯"UI å¥çº¦"ï¼å®å®ä¹äºä¸å¥æ½è±¡çç»ä»¶è¯­è¨ï¼è®© Agent è½å¤"æè¿° UI æå¾"èä¸æ¯"çæ UI ä»£ç "ãéå<strong>è·¨å¹³å°</strong>å<strong>é«å®å¨æ§</strong>åºæ¯ã</p>
</li>
<li>
<p><strong>MCP-UI</strong> æ¯"UI æä»¶"ï¼å®è®© MCP å·¥å·è½å¤ç´æ¥è¿åå¯è§åç»æï¼æ éä¿®æ¹å®¿ä¸»åºç¨ãéå<strong>å¿«éæ©å±</strong>å<strong>æä»¶çæ</strong>åºæ¯ã</p>
</li>
<li>
<p><strong>ç»åä½¿ç¨</strong>æ¯æä½³å®è·µï¼AG-UI å¯ä»¥ä½ä¸º A2UI çä¼ è¾å±ï¼MCP-UI å¯ä»¥éè¿ä¸­é´ä»¶éæå° AG-UIã</p>
</li>
</ol>
<h3 id="82-æªæ¥å±æ">8.2 æªæ¥å±æ</h3>
<table>
<thead>
<tr>
<th>è¶å¿</th>
<th>é¢æåå±</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åè®®èå</strong></td>
<td>AG-UI å A2UI å¯è½ä¼è¿ä¸æ­¥æ´åï¼å½¢æç»ä¸ç Agent-UI æ å</td>
</tr>
<tr>
<td><strong>è¯­é³äº¤äº</strong></td>
<td>å¤æ¨¡ææ¯æï¼è¯­é³è¾å¥ãè¯­é³è¾åºï¼å°æä¸ºæ é</td>
</tr>
<tr>
<td><strong>è¾¹ç¼è®¡ç®</strong></td>
<td>è½»éçº§åè®®æ¯æè®¾å¤ç«¯ Agentï¼ææºãIoTï¼</td>
</tr>
<tr>
<td><strong>å®å¨å¢å¼º</strong></td>
<td>æ´å®åçæ²ç®±éç¦»ãæéæ§å¶æºå¶</td>
</tr>
</tbody>
</table>
<h3 id="83-åèèµæº">8.3 åèèµæº</h3>
<table>
<thead>
<tr>
<th>åè®®</th>
<th>å®æ¹ä»åº</th>
<th>ææ¡£</th>
</tr>
</thead>
<tbody>
<tr>
<td>AG-UI</td>
<td><a href="https://github.com/ag-ui-protocol/ag-ui" target="_blank" rel="noopener nofollow">github.com/ag-ui-protocol/ag-ui</a></td>
<td><a href="https://docs.ag-ui.com" target="_blank" rel="noopener nofollow">docs.ag-ui.com</a></td>
</tr>
<tr>
<td>A2UI</td>
<td><a href="https://github.com/google/A2UI" target="_blank" rel="noopener nofollow">github.com/google/A2UI</a></td>
<td><a href="https://a2ui.dev" target="_blank" rel="noopener nofollow">a2ui.org</a></td>
</tr>
<tr>
<td>MCP-UI</td>
<td><a href="https://github.com/idosal/mcp-ui" target="_blank" rel="noopener nofollow">github.com/idosal/mcp-ui</a></td>
<td>[mcpui.dev]</td>
</tr>
</tbody>
</table>
<hr>
<p><em>æ¬æåºäº <code>demo-agent-ui-protocols</code> é¡¹ç®æºç åæï¼å»ºè®®è¯»èä¸è½½è¿è¡ä½éªãå¦æé®é¢æå»ºè®®ï¼æ¬¢è¿äº¤æµè®¨è®ºã</em></p>
<p><a href="https://github.com/MadLongTom/demo-agent-ui-protocols" rel="noopener nofollow">https://github.com/MadLongTom/demo-agent-ui-protocols</a></p>

</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/madtom/" target="_blank">MadLongTom</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/madtom/p/19452209" target="_blank">https://www.cnblogs.com/madtom/p/19452209</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0.004861111111111111" data-date-updated="2026-01-07 14:43">2026-01-07 14:36</span>&nbsp;
<a href="https://www.cnblogs.com/madtom">MadLongTom</a>&nbsp;
éè¯»(<span id="post_view_count">18</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19452209);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19452209', targetLink: 'https://www.cnblogs.com/madtom/p/19452209', title: 'ä¸å¤§ Agent-UI åè®®æ·±åº¦åæï¼AG-UIãA2UI ä¸ MCP-UI çè®¾è®¡å²å­¦ä¸å·¥ç¨å®è·µ' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ FastAPI + TinyDBå¹¶åé·é±ä¸å®æï¼åå«æ°æ®éä¹±çè§£å³æ¹æ¡ ]]></title>
    <link>https://www.cnblogs.com/ymtianyu/p/19450340</link>
    <guid>8b7d4dde06107a64e84064c75fffe1b0</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/ymtianyu/p/19450340" title="åå¸äº 2026-01-07 08:54">
    <span role="heading" aria-level="2">FastAPI + TinyDBå¹¶åé·é±ä¸å®æï¼åå«æ°æ®éä¹±çè§£å³æ¹æ¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æ¬æéå¯¹å¨FastAPIæ¡æ¶ä¸ä½¿ç¨TinyDBï¼JSONæä»¶æ°æ®åºï¼æ¶ï¼å å¤äººåæ¶è¯»åå¯¼è´çå¹¶åæ°æ®å²çªé®é¢ï¼è¿è¡äºæ·±åº¦åæãæç« éè¿çå¨çæ¯å»è§£éäºé®é¢æ ¹æºï¼å¹¶è¯¦ç»æä¾äºæä»¶éãåå­æä½éåååºç¨å±ä¹è§éä¸ç§ç±æµå¥æ·±çå®æè§£å³æ¹æ¡ï¼éæå¯ç´æ¥æ´åçä»£ç ç¤ºä¾ãåæ¶ï¼æç¡®äºåæ¹æ¡çéç¨åºæ¯ä¸å±éæ§ï¼ä¸ºå¼åèå¨è½»éçº§ä¸çäº§çº§åºç¨ä¹é´æä¾å¹³æ»è¿æ¸¡çæè·¯ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><strong style="color: rgba(186, 55, 42, 1)">ä½ çFastAPIåºç¨å¨å¤äººåæ¶ä¿®æ¹æ°æ®æ¶ï¼ä¼ä¸ä¼åºç°æ°æ®éä¹±æä¸¢å¤±ï¼</strong></p>
<p>è¯åä¸ä¸ï¼å¢ééä¸ä¸ªç¨äºç®¡çåé¨èµæºçå·¥å·çªç¶âæ½é£âäºãå ä¸ªåäºåæ¶æäº¤ç³è¯·ï¼ç»æåå°æ°æ®æ¾ç¤ºï¼æçç³è¯·è®°å½ç¥ç§æ¶å¤±ï¼æçèµæºæ°éå¯¹ä¸ä¸ãä¸æ¥æ¥å¿ï¼åç°å¤§å®¶é½å¨åä¸ç§å¯¹åä¸ä¸ª<code style="color: rgba(186, 55, 42, 1)">db.json</code>æä»¶è¿è¡äºè¯»åãè¿å°±æ¯ä¸ºäºè½»éèéç¨TinyDBï¼ä¸ä¸ªçº¯Pythonçãä»¥JSONæä»¶ä¸ºå­å¨çæ°æ®åºï¼åï¼ææå¯è½çåå°æåå°âå¹¶åâå¸¦æ¥ççãð¯</p>
<p>è¿ç¯æç« ï¼æå°åä½ ä¸èµ·æè§£è¿ä¸ªé®é¢ï¼å¹¶åäº«å¦ä½ç¨å ä¸ªè½»éçº§æ¹æ¡ï¼è®©è¿ä¸ªåºäºFastAPIåTinyDBçåºç¨ç¨³å®å°æ¯æèµ·äºæ¥åæ°åæ¬¡çå¹¶åè¯·æ±ãå®ä¸æ¯ä¸å¥æ¾ä¹åæµ·èçåçæ¶æï¼ä½ç»å¯¹æ¯ä½ å¨ååå¼åãå°åå·¥å·æç¹å®è½»éåºæ¯ä¸ï¼æ§ä»·æ¯æé«çè§£å³æ¹æ¡ã</p>
<h2>ð æ ¸å¿æè¦</h2>
<p>æ¬æéå¯¹å¨FastAPIæ¡æ¶ä¸ä½¿ç¨TinyDBï¼JSONæä»¶æ°æ®åºï¼æ¶éå°çå¹¶ååå¥æ°æ®å²çªãéä¹±é®é¢ï¼æ·±å¥æµåºå°è§£éäºé®é¢æ ¹æºï¼å¹¶æä¾äºä»âæä»¶éâå°âåå­éåâåå°âä¹è§éâçä¸ç§ç±æµå¥æ·±çå®æè§£å³æ¹æ¡ï¼å¸®å©ä½ æ ¹æ®å®éåºæ¯éæ©ï¼ç¡®ä¿æ°æ®ä¸è´æ§ã</p>
<h2>ð¶ââï¸ ä¸»è¦åå®¹èç»</h2>
<div>
<p>ð ä¸ãé®é¢æ ¹æºï¼ä¸ºä»ä¹ç®åçJSONæä»¶ä¼âææ¶âï¼</p>
<p>ð ï¸ äºãè§£å³æ¹æ¡ï¼ä»âéâå°âéåâçä¸å±é²å¾¡</p>
<p>- æ¹æ¡ä¸ï¼æä»¶éï¼fcntl / portalockerï¼ââ ç»æä»¶ä¸ä¸ªâè¯·å¿ææ°âç</p>
<p>- æ¹æ¡äºï¼åå­æä½éåï¼asyncio.Queueï¼ââ è®©è¯·æ±æå¥½éï¼ä¸ä¸ªä¸ä¸ªæ¥</p>
<p>- æ¹æ¡ä¸ï¼åºç¨å±ä¹è§éï¼çæ¬å·æ ¡éªï¼ââ âææ¹çæ¶åï¼ä¸è¥¿è¿æ¯åæ¥çæ ·å­åï¼â</p>
<p>ð» ä¸ãå®æä»£ç ï¼å°æ¹æ¡èå¥FastAPIä¾èµé¡¹ä¸è·¯ç±</p>
<p>â ï¸ åãéè¦æéä¸è¾¹çæ¢è®¨ï¼è¿ä¸æ¯é¶å¼¹</p>
</div>
<h2>ð ç¬¬ä¸é¨åï¼é®é¢ä¸èæ¯</h2>
<p>æ³è±¡ä¸ä¸ï¼TinyDBç<code style="color: rgba(186, 55, 42, 1)">db.json</code>æä»¶å°±æ¯ä¸ä¸ªå±äº«çç¬è®°æ¬ãFastAPIçæ¯ä¸ªå·¥ä½è¿ç¨ï¼Workerï¼å°±åä¸ä¸ªå¿«éè®°å½åã</p>
<p>å½ç¨æ·Açè¯·æ±å°æ¥æ¶ï¼è®°å½å1æå¼ç¬è®°æ¬ï¼è¯»å°æä¸ªå¼ï¼æ¯å¦åºå­ä¸º5ï¼ï¼åå¤å°å¶æ¹ä¸º4ã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">å°±å¨è¿âè¯»å°âåâæ¹åâçæ¯«ç§ä¹é´</strong>ï¼ç¨æ·Bçè¯·æ±ä¹æ¥äºãè®°å½å2ä¹æå¼äºåä¸ä¸ªç¬è®°æ¬ï¼ä»è¯»å°çåºå­<strong>ä»ç¶æ¯5</strong>ï¼å ä¸ºè®°å½å1è¿æ²¡ååå»ï¼ï¼ç¶åä»ä¹è®¡ç®ï¼å°åºå­æ¹ä¸º3ã</p>
<p>ç»æå°±æ¯ï¼æ è®ºè°æåä¿å­ï¼å¦ä¸ä¸ªäººçä¿®æ¹é½ä¼è¢«å®å¨è¦çãè¿å°±æ¯å¸åçâå¹¶ååå²çªâãå¨é«å¹¶åçWeb APIåºæ¯ä¸ï¼è¿ä¸ªé®é¢ä¼è¢«æ¥å§æ¾å¤§ã</p>
<h2>ð ï¸ ç¬¬äºé¨åï¼æ ¸å¿åçä¸æ­¥éª¤</h2>
<h3>ð¯ æ¹æ¡ä¸ï¼æä»¶éï¼æç´æ¥çç©çéç¦»ï¼</h3>
<p>åçï¼å¨è¯»åæä»¶åï¼åç»è¿ä¸ªæä»¶å ä¸æç³»ç»çº§çéãå¶ä»è¿ç¨å°è¯å éæ¶ï¼ä¼è¢«é»å¡æå¤±è´¥ï¼ç´å°éè¢«éæ¾ãè¿å°±åç»ç¬è®°æ¬çæ¿é´é¨ä¸äºéï¼ä¸æ¬¡åªè¿ä¸ä¸ªäººã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">éç¨åºæ¯ï¼</strong> ä½å¹¶åï¼å¦åé¨å·¥å·ï¼ãè¯»åä¸é£ä¹é¢ç¹çåºæ¯ã</p>
<pre class="highlighter-hljs" style="background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px; overflow-x: auto"><code># å®è£ï¼pip install portalocker
import portalocker

def safe_update_db():
    with open('db.json', 'r+') as f:
        portalocker.lock(f, portalocker.LOCK_EX)  # è·åç¬å é
        # å¨è¿éå®å¨å°è¯»ååä¿®æ¹æ°æ®
        data = json.load(f)
        data['counter'] += 1
        f.seek(0)
        json.dump(data, f)
        f.truncate()
        # éåºwithåæ¶ï¼éä¼èªå¨éæ¾</code></pre>
<h3>ð¯ æ¹æ¡äºï¼åå­æä½éåï¼åè¿ç¨åçç§©åºç»´æ¤èï¼</h3>
<p>åçï¼å©ç¨Pythonç<code style="color: rgba(186, 55, 42, 1)">asyncio.Queue</code>ï¼å°ææå¯¹TinyDBçåæä½å°è£æä»»å¡ï¼æ¾å¥ä¸ä¸ªéåãç±ä¸ä¸ªåç¬çâæ¶è´¹èâåç¨ä»éåä¸­ä¾æ¬¡ååºä»»å¡æ§è¡ãè¿æ ·ï¼æ è®ºå¤é¨è¯·æ±å¤ä¹å¹¶åï¼å¯¹æ°æ®åºçåæä½é½æ¯<strong>ä¸²è¡å</strong>çã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">ä¼ç¹ï¼</strong> å®å¨å¨åå­ä¸­æä½ï¼éåº¦æå¿«ï¼é¿åäºæä»¶éå¯è½å¸¦æ¥çæ­»éæè·¨å¹³å°é®é¢ãéå¸¸éåFastAPIçå¼æ­¥æ¨¡å¼ã</p>
<p><strong style="color: rgba(186, 55, 42, 1)">å³é®è­¦åï¼</strong> æ­¤æ¹æ¡ä»å¨<u>åä¸ªæå¡è¿ç¨</u>åææãå¦æä½ ä½¿ç¨å¤ä¸ªå·¥ä½è¿ç¨ï¼å¦<span style="color: rgba(186, 55, 42, 1)"><code>Uvicorn with --workers 4</code></span>ï¼ï¼æ¯ä¸ªè¿ç¨æèªå·±çåå­åéåï¼å²çªä¾ç¶ä¼åçãæ­¤æ¶éæ­éæ¹æ¡ä¸ææ¹æ¡ä¸ã</p>
<h3>ð¯ æ¹æ¡ä¸ï¼åºç¨å±ä¹è§éï¼åºäºçæ¬çå²çªæ£æµï¼</h3>
<p>åçï¼ä¸é»æ­¢âè¯»âï¼åªå¨âåâçæ¶åæ£æ¥å²çªãä¸ºæ¯æ¡æ°æ®å¢å ä¸ä¸ª<code style="color: rgba(186, 55, 42, 1)">version</code>å­æ®µãæ¯æ¬¡è¯»åæ°æ®æ¶ï¼è¿å¸¦çæ¬å·ä¸èµ·è¯»åºãä¿®æ¹åååæ¶ï¼æ£æ¥å½åæä»¶ä¸­ççæ¬å·æ¯å¦åèªå·±è¯»å°ççæ¬å·ä¸è´ãå¦æä¸è´ï¼ååå¥ï¼å¹¶å°çæ¬å·+1ï¼å¦æä¸ä¸è´ï¼åè¯´æå¨æ­¤æé´æ°æ®å·²è¢«ä»äººä¿®æ¹ï¼æ¬æ¬¡æä½å¤±è´¥ï¼éè¦æç¤ºç¨æ·éè¯ã</p>
<p>è¿å°±åä¸¤ä¸ªäººç¼è¾å¨çº¿ææ¡£ï¼ç³»ç»ä¼æç¤ºä½ âå¨ä½ ç¼è¾æé´ï¼ææ¡£å·²è¢«ä»äººæ´æ°âã</p>
<h2>ð» ç¬¬ä¸é¨åï¼å®ææ¼ç¤ºï¼æ´åæ¹æ¡äºä¸ä¸ï¼</h2>
<p>ä¸é¢æ¯ä¸ä¸ªå¨FastAPIä¸­æ´å<strong>åå­éå</strong>ä¸<strong>ä¹è§é</strong>çæ ¸å¿ç¤ºä¾ï¼</p>
<pre class="highlighter-hljs" style="background-color: rgba(246, 248, 250, 1); padding: 15px; border-radius: 5px; overflow-x: auto"><code>from fastapi import FastAPI, Depends, HTTPException
from contextlib import asynccontextmanager
import asyncio
from tinydb import TinyDB, Query
import json
from pydantic import BaseModel

app = FastAPI()
write_queue = asyncio.Queue()
db_path = 'db.json'

# æ°æ®æ¨¡å
class ItemUpdate(BaseModel):
    item_id: int
    new_value: str
    read_version: int  # å®¢æ·ç«¯ä¼ æ¥çè¯»åæ¶ççæ¬å·

# å¯å¨æ¶å¯å¨åä»»å¡æ¶è´¹è
@asynccontextmanager
async def lifespan(app: FastAPI):
    # å¯å¨æ¶
    asyncio.create_task(db_write_consumer())
    yield
    # å³é­æ¶...

app = FastAPI(lifespan=lifespan)

async def db_write_consumer():
    """åæä½æ¶è´¹èï¼å¸¸é©»åå°ï¼ä¸²è¡å¤çåéå"""
    while True:
        task_data = await write_queue.get()
        await _perform_safe_write(task_data)
        write_queue.task_done()

async def _perform_safe_write(task_data: dict):
    """æ§è¡å¸¦ä¹è§éæ£æ¥çåå¥"""
    with TinyDB(db_path) as db:
        Item = Query()
        record = db.get(Item.id == task_data['item_id'])
        if not record:
            # å¤çè®°å½ä¸å­å¨çæåµ...
            return
        # ä¹è§éæ£æ¥ï¼ï¼ï¼
        if record['version'] != task_data['read_version']:
            raise ValueError(f"æ°æ®çæ¬å²çªãå½åçæ¬{record['version']}ï¼æäº¤çæ¬{task_data['read_version']}")
        # éè¿æ£æ¥ï¼æ§è¡æ´æ°
        db.update({
            'value': task_data['new_value'],
            'version': record['version'] + 1  # çæ¬å·éå¢
        }, Item.id == task_data['item_id'])

@app.put("/update_item/")
async def update_item(update: ItemUpdate):
    """æ´æ°æ¥å£"""
    try:
        # å°åæä½å°è£æä»»å¡ï¼æ¾å¥éåï¼ç­å¾æ¶è´¹èå¤ç
        await write_queue.put(update.dict())
        # è¿éå¯ä»¥è¿åä¸ä¸ªä»»å¡IDï¼è®©å®¢æ·ç«¯è½®è¯¢ç»æï¼æèä½¿ç¨WebSocketæ¨é
        return {"message": "æ´æ°è¯·æ±å·²å å¥éå"}
    except asyncio.QueueFull:
        raise HTTPException(status_code=429, detail="ç³»ç»ç¹å¿ï¼è¯·ç¨åéè¯")

@app.get("/get_item/{item_id}")
async def get_item(item_id: int):
    """è¯»åæ¥å£ï¼è¿åæ°æ®åå½åçæ¬å·"""
    with TinyDB(db_path) as db:
        Item = Query()
        record = db.get(Item.id == item_id)
        if record:
            return {"value": record['value'], "version": record['version']}
        raise HTTPException(status_code=404, detail="Item not found")</code></pre>
<h2>â ï¸ ç¬¬åé¨åï¼æ³¨æäºé¡¹ä¸è¿é¶æè</h2>
<div>
<p>ð¨ <strong style="color: rgba(186, 55, 42, 1)">éè¦æéï¼</strong></p>
<p>1. <strong>æ§è½ç¶é¢ï¼</strong> æææ¹æ¡çæ ¸å¿é½æ¯âä¸²è¡ååâãè¿æå³çä½ çæ°æ®åºåååéå­å¨ä¸éãå¯¹äºè¶é«å¹¶ååå¥åºæ¯ï¼JSONæä»¶æ¬èº«å°±ä¼æä¸ºç¶é¢ã</p>
<p>2. <strong>å¤è¿ç¨éå¶ï¼</strong> åå­éåæ¹æ¡å¨åè¿ç¨åå®ç¾ï¼å¤è¿ç¨ééååå¸å¼éï¼å¦Rediséï¼æåå½å°æ°æ®åºæ¹æ¡ã</p>
<p>3. <strong>æéæ¢å¤ï¼</strong> éåä¸­çä»»å¡å¨æå¡éå¯æ¶ä¼ä¸¢å¤±ãå¯¹æ°æ®ä¸è´æ§è¦æ±æé«çåºæ¯ï¼éè¦å¼å¥æä¹åæ¶æ¯éåï¼å¦RabbitMQï¼æç´æ¥ä½¿ç¨çæ­£çæ°æ®åºã</p>
</div>
<p><strong>ååæèï¼</strong> ææ¯éåæ°¸è¿æ¯æè¡¡çèºæ¯ãTinyDBçä¼ç¹æ¯æè´ç®åãæ éå¤é¨æå¡ãä½å½ä½ çå¹¶ååä¸è´æ§è¦æ±å¢é¿å°ä¸å®é¶æ®µæ¶ï¼å°±æ¯èèåçº§å°SQLiteï¼æ¯ææ´å®åçäºå¡åå¹¶åæ§å¶ï¼ãPostgreSQLç­æ´å¼ºå¤§æ°æ®åºçæ¶åäºãæ¬æ¬¡å®æçæ¹æ¡ï¼æ¯ä½ ä»âç©å·é¡¹ç®âå¹³ç¨³è¿æ¸¡å°âçäº§ç³»ç»âçä¸åº§å³é®æ¡¥æ¢ã</p>
<p style="text-align: center">---<strong>åå¨æå</strong>---<br>å¸æè¿ä»½æ»ç»è½å¸®ä½ é¿å¼ä¸äºåãå¦æè§å¾æç¨ï¼ä¸å¦¨ç¹ä¸ª èµð æ æ¶èâ­ æ è®°ä¸ä¸ï¼æ¹ä¾¿éæ¶åé¡¾ãä¹æ¬¢è¿å³æ³¨æï¼åç»­ä¸ºä½ å¸¦æ¥æ´å¤ç±»ä¼¼çå®æè§£æãæä»»ä½çé®ææ³æ³ï¼æä»¬è¯è®ºåºè§ï¼ä¸èµ·äº¤æµå¼åä¸­çåç§å¿å¾ä¸é®é¢ã</p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-07 08:55">2026-01-07 08:54</span>&nbsp;
<a href="https://www.cnblogs.com/ymtianyu">ä¸åç¨åºåªå</a>&nbsp;
éè¯»(<span id="post_view_count">42</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19450340);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19450340', targetLink: 'https://www.cnblogs.com/ymtianyu/p/19450340', title: 'FastAPI + TinyDBå¹¶åé·é±ä¸å®æï¼åå«æ°æ®éä¹±çè§£å³æ¹æ¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ PHP å¼æ­¥ä¸å¤çº¿ç¨ ä» TrueAsync å±ææªæ¥ ]]></title>
    <link>https://www.cnblogs.com/catchadmin/p/19450129</link>
    <guid>a515235606c58dab7f14a5194cfa7dbc</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/catchadmin/p/19450129" title="åå¸äº 2026-01-07 07:12">
    <span role="heading" aria-level="2">PHP å¼æ­¥ä¸å¤çº¿ç¨ ä» TrueAsync å±ææªæ¥</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="php-å¼æ­¥ä¸å¤çº¿ç¨-ä»-trueasync-å±ææªæ¥">PHP å¼æ­¥ä¸å¤çº¿ç¨ ä» TrueAsync å±ææªæ¥</h1>
<p>RFC TrueAsync 1.7 è®¨è®ºä¸­æä¸ªé®é¢ï¼è¿ä¸ªæè®®ä¼å¦ä½ä¸ PHP æ ¸å¿æªæ¥çååäºå¨ï¼è¦è®¾è®¡å¥½è¯­è¨çé¿ææ¼è¿ï¼è³å°å¾å¯¹ PHP çåå±æ¹åæåºæ¬å¤æ­ãæ¬æè¯å¾åç­è¿ä¸ªé®é¢ã</p>
<p>TrueAsync é¡¹ç®ä¸ä»æ¯ PHP æ ¸å¿ç async æ¹å¨ï¼è¿åæ¬åç­ä»¥ä¸é®é¢æéçå¶ä»ç ç©¶ï¼</p>
<ul>
<li>PHP è½å¨å¤å¤§ç¨åº¦ä¸åå¤çº¿ç¨æ¹ååå±ï¼</li>
<li>æ¯å¦å­å¨æ ¹æ¬æ§éå¶ï¼</li>
<li>å®ç°çæ­£çå¤çº¿ç¨å¯è½éè¦åªäºæ ¸å¿æ¹å¨ï¼</li>
<li>å¯ä»¥å®ç°åªäºè¯­è¨æ½è±¡ï¼</li>
</ul>
<p>æ¬æä¸æ¯ PHP å¤çº¿ç¨çè¯¦å°½ç»¼è¿°ï¼ä¹ä¸è¿½æ±æ¯ä¸ªç»èçææ¯ç²¾ç¡®æ§æå¤§ä¼å¯è¯»æ§ãä½å¸æå®å¯¹ PHP å¼åèæåèä»·å¼ï¼è½ä¸ºåç»­è®¨è®ºæä¾æ¹åã</p>
<p><a href="https://catchadmin.com/post/2026-01/multithreading-in-php-looking-to-the-future" target="_blank" rel="noopener nofollow">åæ PHP å¼æ­¥ä¸å¤çº¿ç¨ ä» TrueAsync å±ææªæ¥</a></p>
<h2 id="åå²">åå²</h2>
<p>å å¹´åè¦ç» PHP åºç¨å é«å®¹éé¥æµï¼æè¯´åä¸å°ãçå° Swoole æ¶æåæ³æµè¯ä¸ä¸ãè½ä¸è½åä¸ä¸ª APIï¼çæåå¤çå¤§éæ°æ®çåæ¶ä¸ææ¢å®¢æ·ç«¯ï¼</p>
<p>æä»¬ç» PHP åäºä¸ªä¼åç OpenTelemetryï¼åæ¹åæ°æ®ï¼æ¶éæå¤§åååå°ä¸­é´é¥æµæå¡å¨ãæ°æ®åç¼©ï¼JSON ç»æç¨ MessagePack åºååã</p>
<p>åè®¾æ¯ï¼ç¨åçº¿ç¨åç¨éæ­¥æå»ºé¥æµæ°æ®ï¼å®æ¶æè¾¾å°éå¼æ¶åéãæ²¡æè·¨çº¿ç¨äº¤äºï¼ä»£ç åºè¯¥å¿«ãççåï¼</p>
<p>å®éªç»æï¼é¥æµè®© API ååéååãåè®¾éäºãä¸ºä»ä¹ï¼æ¦å¿µä¸çèµ·æ¥æ²¡é®é¢ãSwoole å·²ç»è®© PHP å½æ°éé»å¡ï¼åç¨åºè¯¥é«ææå¯¹ãåªéåºéäºï¼</p>
<p>ç¬¬äºçæ¹æï¼é¥æµåªå¨ä¸ä¸ªè¯·æ±æé´æ¶éï¼ç«å³æç»ä½ä¸è¿ç¨å»èåãåç¼©ãåéãè¿çæ§è½å¥½å¤äºãä½ä¸åºè¯¥åï¼è¿ç¨é´æ°æ®èµ°ç®¡éï¼ä¸ç«¯åºååå¦ä¸ç«¯ååºååãç®¡éå¨åå­éï¼ä½ç³»ç»è°ç¨å¼éä¸å°ã</p>
<p>åæ¥æ¾å°åå ï¼é¥æµæ°æ®éå¤§ï¼åç¼©ç¸å¯¹ API è¯·æ±å¤çåæå¤ªå¤ CPUãSwoole åç¨å¯¹ I/O é«æï¼ä½å¸®ä¸äº CPU å¯éåä»»å¡ã</p>
<p>è¿ä¸ªæ¡ä¾è¯´æåçº¿ç¨åç¨è§£å³ä¸äºææé®é¢ãä¹è¯´æå¤çº¿ç¨è½è¡¥ååç¨ï¼ç»æ´å¤é®é¢æä¾å·¥å·ã</p>
<h2 id="åçº¿ç¨--offload">åçº¿ç¨ + offload</h2>
<p>æ CPU å¯éåå·¥ä½å¸è½½å°åç¬è¿ç¨ä¸æ¯ä»ä¹æ°åæãè¿ä¸ªæ¨¡å¼å¨ä¸åè¯­è¨åæ¡æ¶ä¸­ç¬ç«åºç°ï¼å« <code>Single-threaded + offload</code>ã</p>
<p>æä¸ªæ¯æ¹ï¼ä¸ä¸ªäººå¿«éåæ£ä¿¡ä»¶ï¼æ¯å°æ¶å åå°ï¼ï¼éåè£¹ç±å¶ä»åå·¥ç¨å¡è½¦è£èµ°ãåæ£åè¦æ¯èªå·±å»æ¬åè£¹ï¼ä¿¡ä»¶éåå°±å å°å¤©è±æ¿äºã</p>
<p><code>Single-threaded + offload</code> æ¨¡åæä»»å¡åä¸¤ç±»ï¼</p>
<ul>
<li><strong>I/O-bound ä»»å¡</strong> â è¯»æä»¶ãç½ç»è°ç¨ãæ°æ®åºè®¿é®ãå¤§é¨åæ¶é´å¨ç­å¤é¨ä¸çãéè¿å¹¶å asyncï¼åç¨ã<code>await</code>ï¼ï¼ä¸ä¸ªçº¿ç¨è½å®¹çº³å åä¸ªè¿ç±»æä½ã</li>
<li><strong>CPU-bound ä»»å¡</strong> â åç¼©ãå å¯ãè§£æãè®¡ç®ãCPU æ»¡è´è·è·ï¼åé å¹¶åä¸å¤ï¼å¾ä¸æ´å¤æ ¸å¿ã</li>
</ul>
<p>æ¨¡åå¨ç©çä¸åç¦»è¿ä¸¤ç±»ä»»å¡ï¼ä¸»çº¿ç¨ï¼<code>Event Loop</code>ï¼åªç®¡ I/Oï¼CPU ä»»å¡æç»åç¬ççº¿ç¨æè¿ç¨ï¼<code>Workers</code>ï¼ã</p>
<p>Node.js é åçº¿ç¨ <code>Event Loop</code> åºåï¼å¾éåç½ç»åºç¨ãä½å¼åèè¦æ¯å¨è¯·æ±å¤çå¨éç´æ¥å¤çå¾åæåç¼©è§é¢ï¼æå¡å¨å°±ååçäºãåæ¥å äº <code>Worker Threads</code>ï¼ä¸é¨è· CPU å¯éåæä½ã</p>
<p>Python èµ°äºç±»ä¼¼è·¯çº¿ã<code>asyncio</code> åºæ¥åï¼I/O-bound ä»£ç æäºå¥½å·¥å·ï¼ä½ GILï¼å¨å±è§£éå¨éï¼æ¡çï¼åè¿ç¨åæ²¡æ³çæ­£ CPU å¹¶è¡ï¼åè¿ç¯æç« æ¶é®é¢å·²è§£å³ï¼ãé»å¡æä½æ <code>loop.run_in_executor()</code> å <code>asyncio.to_thread()</code>ï¼Python 3.9+ï¼ï¼æéæ´»å¸è½½å°çº¿ç¨æ± æè¿ç¨æ± ã<code>Event Loop</code> ä¿æååºï¼è®¡ç®å¹¶è¡è·ã</p>
<p>PHP/Swoole ä¹æ¯è¿ä¸ªæ¶æï¼<code>Request Workers</code> ç¨åç¨å¤ç HTTP è¯·æ±ï¼<code>Task Workers</code> è·éè®¡ç®ãéè¿ UnixSocket æç®¡ééä¿¡ï¼åè¿ç¨è½å¤çæ¯ç§çº¦ 10 ä¸æ¬¡æä½ã</p>
<h3 id="æ¨¡åçä¼å¿">æ¨¡åçä¼å¿</h3>
<p><strong>1. èµæºæç</strong></p>
<p>åçº¿ç¨ <code>Event Loop</code> è½ä»¥æå°å¼éæå¡å åä¸ªå¹¶å I/O æä½ãåç¨ä»»å¡é´åæ¢æ¯æä½ç³»ç»çº¿ç¨ä¸ä¸æåæ¢ä¾¿å®å¾å¤ãCPU-bound ä»»å¡å¨å¤æ ¸ä¸çæ­£å¹¶è¡ââæ¯ä¸ª worker å ä¸ä¸ªæ ¸å¿ï¼äºä¸å¹²æ°ã</p>
<p><strong>2. å¼åç®å</strong></p>
<p><code>Event Loop</code> éçä»£ç ä¸ç¨äºæ¥éãä¿¡å·éè¿äºå¤çº¿ç¨ç¼ç¨çç©æå¿ãåçº¿ç¨æ¨¡åä¸æ¬¡åªè·ä¸ä¸ªä»»å¡ï¼ç«ææ¡ä»¶ä¸å¯è½åºç°ã<code>Workers</code> å¹¶è¡è·ï¼ä½åªè¦éµå¾ª <code>Shared Nothing</code>ï¼åæ­¥é®é¢å°±ä¸å­å¨ã</p>
<p>å¤çº¿ç¨ä»£ç ååçº¿ç¨ async ä»£ç çå¤æåº¦å·®è·å¾å¤§ãç°ä»£è¯­è¨åæ¡æ¶é½å¥çåçº¿ç¨ async å»ï¼ä¸èµ°ç»å¸å¤çº¿ç¨ã</p>
<p><strong>3. ç¼è¯å¨/è¿è¡æ¶æ´ç®å</strong></p>
<p>åçº¿ç¨æ¨¡åç async å½æ°å¯¹ç¼è¯å¨åè¿è¡æ¶ç®åå¾å¤ãå¥½çå¤çº¿ç¨è¯­è¨éè¦èªå·±çä»£ç çæç®¡éãPHP æä¸ªç¡¬çº¦æï¼é¨åä»£ç ç¨ C åçï¼æ²¡æ³å¯¹çº¿ç¨ãåå­ç®¡çãåæ°ä¼ éåé«æçå­èç çº§ä¼åãGo çè®¾è®¡å¤æåºåï¼ä¸ææ ãå¤æ GCï¼é½æ¯é«æ goroutines å channels å¿éçãPHP ç GC åé¢ä¼è®²ï¼åå«æ¾æ¾ã</p>
<p><strong>4. æå¨è´è½½åé</strong></p>
<p>å¼åèå¯ä»¥ä¸»å¨å¨è¯·æ±å¤çä»£ç å worker æ± ä¹é´åéè´è½½ãæå¨æ§å¶è½ä»ç¡¬ä»¶æ¦¨åºçè®ºæå¤§å¼ãä½è¿ä¹æ¯ç¼ºç¹ã</p>
<h3 id="æ¨¡åçå£å¿">æ¨¡åçå£å¿</h3>
<p><strong>1. æå¨è´è½½åé</strong></p>
<p>æå¨åéæ¯åååãå¼åèå¯ä»¥éå¯¹ç¹å®ä»»å¡ä¼åï¼ä¹å¯è½è¯¯å¤ä»ä¹è¯¥æ¾ I/O ä»£ç ãä»ä¹è¯¥æ¾ workersãI/O ä»£ç å¡äºéæ´»ä¼è¿è½½ï¼ååºåæ¢ãå»¶è¿ä¸åã</p>
<p>è¿ä¸ªæ¨¡åè¦æ± PHP å¼åèæè¶³å¤æè½ï¼æèä¾èµæ¡æ¶ä½èæä¾çç°ææ¹æ¡ã</p>
<p><strong>2. ä¸éåææä»»å¡</strong></p>
<p><code>Single-threaded + offload</code> å¾éå Web æå¡å¨ãAPIãå¾®æå¡ââä¸»è¦è´è½½æ¯æ°æ®åºãæä»¶ç³»ç»ãç½ç»è°ç¨è¿äº I/Oãä½æ¯ä¸æ­¥é½è¦å¯éè®¡ç®çåºæ¯ââç§å­¦è®¡ç®ãæ¸²æãæºå¨å­¦ä¹ ââè¿ä¸ªæ¨¡åææå°±å·®äºãé£äºåºæ¯æ´éåå®å¨å¤çº¿ç¨ã</p>
<p>ä½ å¯è½è¯´ï¼è½æ¥åï¼åå¤å¥½äºï¼ä½ PHP æ¬èº«åå¤å¥½å¤çº¿ç¨äºåï¼</p>
<h2 id="php-åå¤å¥½å¤çº¿ç¨äºå">PHP åå¤å¥½å¤çº¿ç¨äºåï¼</h2>
<p>å¼å TrueAsync æ¶ï¼æé¾çè®¨è®ºä¹ä¸æ¯"ä¸ºä»ä¹ PHP æ²¡æ async"ãè§£é PHP ä¸ºä»ä¹è¿æ²¡åå¤å¥½å¤çº¿ç¨å¯è½åæ ·é¾ãä¸è¿åèèå¤çº¿ç¨æ¬èº«ãæä»¬ä¸ºä»ä¹éè¦å®ï¼æèæ¢ä¸ªé®æ³ï¼æä»¬ä¸ºä»ä¹ä¸éè¦å®ï¼</p>
<p><strong>å¤çº¿ç¨ä¸æ¯å¹¶è¡æ§è¡ä»£ç çå¿è¦æ¡ä»¶ã</strong></p>
<p>"å¹¶è¡å¿é¡»å¤çº¿ç¨"è¿ä¸ªæ³æ³æ©å°±å»å¨ç¨åºåèå­éäºï¼å°±å"é»æ´ä¼å¸ä¸è¥¿"å»å¨æµè¡æåéä¸æ ·ã</p>
<p>å¹¶è¡æ§è¡å®å¨å¯ä»¥ç¨è¿ç¨ï¼è¿ç¨å½¼æ­¤éç¦»ï¼80386 æ¶æå°±æäºï¼ãè¿ç¨éè¿ IPC éä¿¡ï¼å®æç¶æéè¿ä¿¡å·ï¼æä½ç³»ç»äºä»¶ï¼è·è¸ªãé£ä¸ºä»ä¹è¿è¦çº¿ç¨ï¼</p>
<p>è¦èå®åç­è¿ä¸ªé®é¢ï¼å¾ç©¿è¶åå»è¯·å½å¹´åå³å®çäººè§£éï¼Edsger DijkstraãFernando CorbatÃ³ãBarbara LiskovãRichard Rashidãåä¸ªè±å£ç§æºå¥½ãä½å°±ç®ä»ä»¬é½æ¥äºï¼å¯è½ä¹è¯´ä¸åºç´æ¥ç­æ¡ã</p>
<p>ä¸é¢è¿ä¸ªè¯´æ³æ¯éçï¼</p>
<blockquote>
<p>çº¿ç¨æ¯ä¸ºäºè®©å¹¶è¡ä»£ç ä¸ç¨é¢å¤å·¥å·å°±è½å±äº«åå­ã</p>
</blockquote>
<p>è¿ç¨ä¹è½å±äº«åå­ï¼ä½å¾ææ®µæ å°å°å°åç©ºé´ï¼é¢å¤å·¥å·ï¼ãçº¿ç¨é»è®¤å±äº«ææåå­ãçº¿ç¨ A è½è®¿é®çåé <code>x</code>ï¼çº¿ç¨ B å¨åä¸å°åä¹è½è®¿é®ï¼ä¸ç¨ä»»ä½æå·§â¦â¦ä½ç­ç­ï¼å¤ä¸ªçº¿ç¨æ²¡æ³å¨ä¸å é¢å¤å·¥å·çæåµä¸å®å¨ä½¿ç¨å±äº«åéã</p>
<p>æ´åç¡®çè¯´æ³æ¯ï¼</p>
<blockquote>
<p>çº¿ç¨æ¯ä¸ºäºå¨ä»»å¡é´ä¼ éåå­æ¶æ²¡æé¢å¤å¼éã</p>
</blockquote>
<p>å¦æçº¿ç¨ç¨åå­ä¼ æ¶æ¯ï¼ä¿è¯åä¸æ¶é´åªæä¸ä¸ªçº¿ç¨è½è®¿é®æååå­åºåï¼é£å¨åå­å CPU ä¸¤æ¹é¢é½æ¯æé«æçãçº¿ç¨å»æé¿åå±äº«åå­ãè¿ä¸ªæ¨¡åå« <code>Shared Nothing</code>ã</p>
<p><strong>çº¿ç¨æ¯ä¸ºäºå¨ä»»å¡é´é«æä¼ æ°æ®ã</strong> è·"é»æ´ä¸å¸ä¸è¥¿"ä¸æ ·æ¯äºå®ã</p>
<h2 id="php-åå­æ¨¡å">PHP åå­æ¨¡å</h2>
<p>PHP æä¹å¤çåå­ï¼ç®åçæ½è±¡æ¨¡åï¼</p>
<ul>
<li>ä»£ç </li>
<li>æ°æ®</li>
<li>PHP VM ç¶æ</li>
</ul>
<p>çº¿ç¨é´å±äº« PHP ä»£ç å·²ç»è½åå°ï¼PHP JIT è§£å³äºï¼ãå¶ä»ç»ä»¶ç´§å¯è¦åï¼æä¸å¼ãæ¯å¦ PHP ç¨ä¸ä¸ªå¨å± <code>object_store</code> å­ææåå»ºå¯¹è±¡çå¼ç¨ãPHP åå­ç®¡çå¨æ¯ç»åä¸ª PHP VM çå¯¹è±¡è®¾è®¡çï¼ä¸é¢åå¤çº¿ç¨ãPHP åå¾æ¶éå¨å¤çä¸äºä¸åçº¿ç¨çæ°æ®ï¼çè³è¦å®å¨åæ VMï¼å ä¸ºå®ç´æ¥æ¹å¯¹è±¡ç <code>refcount</code>ã</p>
<p>æä»¥ <strong>PHP æ¯ä¸¥æ ¼çåçº¿ç¨æ¨¡åï¼å¸¦ stop-the-world GC</strong>ã</p>
<h2 id="å¨çº¿ç¨é´ç§»å¨-php-vm">å¨çº¿ç¨é´ç§»å¨ PHP VM</h2>
<p>PHP ç¨çº¿ç¨å±é¨å­å¨ï¼<code>Thread-Local Storage</code>ï¼TLSï¼ä¿å­æ¯ä¸ªçº¿ç¨ç VM ç¶æãè¿å¯¹ ZTSï¼Zend Thread Safetyï¼æ¨¡å¼ä¸çº¿ç¨é´éç¦»å¾å³é®ã</p>
<p>ç°ä»£ PHP æå»ºç¨ C11 æ åç <code>__thread</code>ï¼MSVC éæ¯ <code>__declspec(thread)</code>ï¼è·å VM ç¶ææéãéåº¦å¾å¿«ï¼x86_64 ä¸å°±æ¯ä» FS æ GS å¯å­å¨çåºåè¯»ä¸ä¸ªåç§»éã</p>
<pre><code class="language-asm">; offset - ç¼è¯æ¶è®¡ç®çå¸¸éåç§»é
; fs - åå­æ®µçåºå°å
mov rax, QWORD PTR fs:offset
</code></pre>
<p>FS/GS å¯¹æ¯ä¸ªçº¿ç¨å¯ä¸ï¼æä½ç³»ç»ä¿è¯ï¼ï¼è¯»åºæ¥çæ»æ¯æ­£ç¡®ç VM ç¶ææéã</p>
<p>è½å¨çº¿ç¨é´ç§»å¨ VM ç¶æï¼å°±è½å®ç°ç±»ä¼¼ Go åç¨æ actors çåè½ãç°ä»£ VM éè¿èªå®ä¹ä»£ç çæä¼ ä¸ä¸æï¼ç¨ CPU å¯å­å¨ä¼  VM ç¶æãPHP åä¸å°è¿ä¸ªï¼å ä¸ºåºå±ç¨ C å½æ°ï¼C æ²¡æ³ç»æ¯ä¸ªå½æ°ä¼ éå¼ä¸ä¸æåæ°ãå¨çº¿ç¨é´ç§»å¨ PHP VM ç¶æä¼æå¤±ä¸å®æ§è½ã</p>
<p>ä½å¦æåªç§»å¨æ§è¡ä»£ç éè¦çé£ä¸å°é¨å VM ç¶æå¢ï¼æ¯å¦ PHP Fiber åæ¢æ¶ä¼å¤å¶æåå¨å±ç»æï¼<code>zend_executor_globals</code>ï¼çé¨åæéã</p>
<p>å¦ææ PHP VM æ¦å¿µä¸åæä¸¤é¨åï¼</p>
<ul>
<li><strong>PHP VM shared</strong>ãç±»ãå½æ°ãå¸¸éãini æä»¤ãå¯æ§è¡ä»£ç ã</li>
<li><strong>PHP VM movable</strong>ãéè¦ç§»å¨ç VM é¨åã</li>
</ul>
<p><img alt="PHP Memory Model" loading="lazy" data-src="https://image.catchadmin.com/202601060808667.png" class="lazyload"></p>
<p>æäºç»æå¯ä»¥æ è®°ä¸ºå±äº«ï¼æäºæ è®°ä¸ºå¯ç§»å¨ï¼<code>Executor Globals</code> çè³å¯ä»¥ææå±äº«åå¯ç§»å¨ä¸¤é¨åï¼å®ç°çº¿ç¨é´é«æç VM ç¶æç§»å¨ãæ©å±å¨å±ç»æä¸ä¼å ä¸ºå¤ä¸å±é´æ¥èæå¤±æ§è½ï¼å ä¸ºå®ä»¬æ¬æ¥å°±å¨ç¨é´æ¥è®¿é®ã</p>
<p>é®é¢åºå¨ä»£ç ç¼è¯ç¸å³çç»æä¸ãPHP éè¿ <code>include</code>/<code>require</code>ã<code>eval</code> åèªå¨å è½½æ¯å¨æçï¼è¿è®© VM ç¶æå¾é¾ææææå±äº«åå¯ç§»å¨ä¸¤é¨åãå¦æè½è§£å³è¿ä¸ªé®é¢ï¼PHP å°±è½ä»¥å¾å°çå¼éå¨çº¿ç¨é´ç§»å¨é¨å VM ç¶æã</p>
<h2 id="å¨çº¿ç¨é´ä¼ éå¯¹è±¡">å¨çº¿ç¨é´ä¼ éå¯¹è±¡</h2>
<p>PHP è¦æ¹ä»ä¹æè½å®å¨å°å¨çº¿ç¨é´ä¼ éå¯¹è±¡ï¼æä¹åï¼</p>
<p>ä»è¯­è¨å±é¢çãåè®¾ <code>$obj</code> éæä¸ª <code>SomeObject</code> å®ä¾ï¼è¦åå°å¦ä¸ä¸ªçº¿ç¨ãè½åå°åï¼</p>
<pre><code class="language-php">$obj = new SomeObject();

$thread = new Thread(function () use ($obj) {
    echo $obj-&gt;someMethod();
});

$thread-&gt;join();
</code></pre>
<p><code>SomeObject</code> åªå±äº <code>$obj</code>ï¼å¯ä»¥å®å¨å°æå°åä»ä¸ä¸ªçº¿ç¨ç§»å°å¦ä¸ä¸ªãä¸»çº¿ç¨ç <code>$obj</code> ä¼è¢«éæ¯ï¼</p>
<pre><code class="language-php">$obj = new SomeObject();
$thread = new Thread(function () use ($obj) {
    echo $obj-&gt;someMethod();
});

// $obj å¨è¿éæªå®ä¹
$thread-&gt;join();
</code></pre>
<p>ä¸é¢çä»£ç è· C++ å Rust çç§»å¨è¯­ä¹å®å¨ä¸æ ·ãè¿ç§çº¿ç¨é´ä¼ åå­çæ¹å¼ï¼</p>
<ul>
<li><strong>å®å¨</strong>ãåªæä¸ä¸ªçº¿ç¨æ¥æå¯¹è±¡ã</li>
<li><strong>æ²¡æå¤å¶æåºååå¼é</strong>ã</li>
</ul>
<p>ä¸ºäºè®©è¡ä¸ºå¯é¢æµãéæåæå¨è½è¯»æï¼åºè¯¥å ç¹æ®çç§»å¨è¯­æ³ï¼</p>
<pre><code class="language-php">$obj = new SomeObject();

// consume $obj è¡¨ç¤ºç§»å¨å¯¹è±¡
$thread = new Thread(function () use (consume $obj) {
    echo $obj-&gt;someMethod();
});

// $obj å¨è¿éæªå®ä¹ãå¨ PHP9 ä¸­åºè¯¥å¨è¿éæ¥åéè¯¯ã
echo $obj;
</code></pre>
<p>ççä¸éï¼</p>
<p>ä½ç§»å¨ <code>refcount = 1</code> çå¯¹è±¡æé®é¢ã</p>
<p>çä¸ªåç±»æ çä¾å­ï¼</p>
<pre><code class="language-php">$electronics = new CategoryNode('Electronics');
$categoriesTree = new Tree();
$categoriesTree-&gt;addToPath('/products/electronics', $electronics);
$categoriesTree-&gt;addToPath('/popular/electronics', $electronics);  
// åä¸ä¸ªåç±»ï¼
</code></pre>
<p><code>$electronics</code> å¨æ éåºç°ä¸¤æ¬¡ï¼<code>refcount = 2</code>ï¼ãæ <code>$categoriesTree</code> ç§»å°å¦ä¸ä¸ªçº¿ç¨ä¼ææ ·ï¼</p>
<p>è¦å®å¨ç§»å¨ï¼å¿é¡»ä¿è¯å¾éææå¯¹è±¡é½æ²¡æå¤é¨å¼ç¨ï¼</p>
<pre><code class="language-php">$node = new CategoryNode('Electronics');
$categoriesTree = new Tree();
$categoriesTree-&gt;addToPath('/products/electronics', $node);

$favourites = [$node];  // å¤é¨å¼ç¨ï¼
$thread = new Thread(function () use ($categoriesTree) {
    // $categoriesTree è¢«ç§»å¨
});

// $favourites[0] ç°å¨æåå¦ä¸ä¸ªçº¿ç¨ä¸­çåå­
// æ¬ç©ºæéï¼
</code></pre>
<p>å®å¨ç§»å¨éè¦ï¼</p>
<ul>
<li><strong>å®æ´å¾éå</strong>ï¼æ£æ¥ææåµå¥å¯¹è±¡ã</li>
<li><strong>Refcount æ£æ¥</strong>ï¼å¾éæ¯ä¸ªå¯¹è±¡é½è¦æ¥ã</li>
<li><strong>èº«ä»½ä¿ç</strong>ï¼å¾åçéå¤é¡¹å¾ä¿æéå¤ã</li>
</ul>
<p>å¯ä»¥ä¸ºæ­¤è®¾è®¡ç®æ³ï¼å«æ·±æ·è´ãç®åå®ç°å¤§æ¦è¿æ ·ï¼</p>
<pre><code class="language-php">// æ·±æ·è´ä¼ªä»£ç 
// çº¿ç¨ A ä¸­çæºå¾
$node = new Node('A');        // addr: 0x1000
$tree-&gt;left = $node;          // addr: 0x1000
$tree-&gt;right = $node;         // addr: 0x1000 (ç¸åå¼ç¨)

// æ·±æ·è´å°çº¿ç¨ Bï¼å¸¦ MM çä¼ªä»£ç ï¼
$copied_map = [];  // åå¸è¡¨: addr_source -&gt; addr_target
function deepCopyToThread(object $obj, Thread $target_thread_mm) 
{
    $source_addr = get_object_address($obj);
    if (isset($copied_map[$source_addr])) {
        return $copied_map[$source_addr];  // å·²ç»å¤å¶ï¼
    }
    // å¨å¦ä¸ä¸ªçº¿ç¨ç MM ä¸­åéåå­
    $new_addr = $target_thread_mm-&gt;allocate(sizeof($obj));
    $copied_map[$source_addr] = $new_addr;
    // å¤å¶å¯¹è±¡æ°æ®
    memcpy($new_addr, $source_addr, sizeof($obj));
    // éåå±æ§
    foreach ($obj-&gt;properties as $prop) {
        if (is_object($prop)) {
            $new_prop_addr = deepCopyToThread($prop, $target_thread_mm);
            // æ´æ°æ°å¯¹è±¡ä¸­çæé
            update_property($new_addr, $prop, $new_prop_addr);
        }
    }
    return $new_addr;
}
// çº¿ç¨ B ä¸­çç»æï¼
// $newTree-&gt;left (addr: 0x2500) === $newTree-&gt;right (addr: 0x2500)
// èº«ä»½ä¿çï¼
</code></pre>
<p>æ·±æ·è´æ¶é´å¤æåº¦ O(N + E)ï¼N æ¯å¯¹è±¡æ°ï¼E æ¯å¼ç¨æ°ãç©ºé´å¤æåº¦ O(N)ââåå¸è¡¨ + æ°å¯¹è±¡ + éå½æ ã</p>
<p>æ¯åºååå¿«ï¼å ä¸ºä¸ç¨è½¬æ¢ä¼ è¾æ ¼å¼ï¼ä½æ¶çåå³äºæ°æ®å½¢ç¶åå¾å¤§å°ãä¹å¯ä»¥æ··åï¼<code>refcount = 1</code> çç§»å¨ï¼å¶ä»çæ·±æ·è´ã</p>
<p>ç»æï¼</p>
<ul>
<li>PHP å¼åèä¸ç¨ç®¡å¯¹è±¡æä¹ä¼ å°å¦ä¸ä¸ªçº¿ç¨ã</li>
<li>æå¥½æåµï¼åå­ç´æ¥ç§»å¨ï¼<code>refcount = 1</code>ï¼ã</li>
<li>æåæåµï¼æ·±æ·è´ï¼ä¿çèº«ä»½ï¼<code>refcount &gt; 1</code>ï¼ã</li>
</ul>
<p>ççè¿è¡ï¼</p>
<ul>
<li>PHP è¯­æ³æ¹å¨æå°</li>
<li>å¯ä»¥éæ­¥æ¹</li>
<li>å¤çº¿ç¨è½ç¨äº</li>
</ul>
<p>ä½æ ¸å¿å±é¢æ²¡é£ä¹ç¾å¥½ãè¦è®©å¯¹è±¡ç§»å¨æçï¼PHP éè¦è·¨çº¿ç¨çåå­ç®¡çæºå¶ãç°å¨åä¸å°ã</p>
<h2 id="å¤çº¿ç¨-php-åå­ç®¡çå¨">å¤çº¿ç¨ PHP åå­ç®¡çå¨</h2>
<p>PHP åå­ç®¡çå¨ç±»ä¼¼ jemalloc æ tcmalloc è¿äºç°ä»£åéå¨ãåºå«æ¯ï¼å®æ²¡æä»å¦ä¸ä¸ªçº¿ç¨éæ¾åå­çæ­£ç¡®ç®æ³ã</p>
<p>åºæ¯ï¼</p>
<ul>
<li>çº¿ç¨ A åå»ºå¯¹è±¡ã</li>
<li>ç§»å¨ï¼åæ ·ï¼ç»çº¿ç¨ Bã</li>
<li>B ä¸åéè¦ï¼è¦éæ¾ã</li>
</ul>
<p>æ¯ä¸ª PHP çº¿ç¨æèªå·±çåå­ç®¡çå¨ï¼<code>Memory Manager</code>ï¼MMï¼ãB æ³éæ¾ A åéçåå­å°±åºé®é¢äºãB ç MM ä¸è®¤è¯ A çåå­ï¼éæ¾ä¼åºéãB ç´æ¥è®¿é® A ç MM ç»æä¹ä¸è¡ï¼éè¦åæ­¥ãç°ä»£é«æ§è½å¤çº¿ç¨åéå¨ç¨å»¶è¿éæ¾ï¼<code>deferred free</code>ï¼è§£å³è¿ä¸ªé®é¢ã</p>
<p>å»¶è¿éæ¾çæè·¯ï¼</p>
<ul>
<li>B ç MM çå°ä¸ä¸ªä¸è®¤è¯çæéã</li>
<li>æ¾å°åªä¸ª MM æ¥æå®ï¼ç»é£ä¸ª MM çéååæ¶æ¯è¯´å¯ä»¥éæ¾äºã</li>
<li>A ç MM å¤çéåï¼å¨èªå·±çä¸ä¸æééæ¾ã</li>
</ul>
<p><img alt="Cross thread deferred free" loading="lazy" data-src="https://image.catchadmin.com/202601060809112.png" class="lazyload"></p>
<p>ç¨ç°ä»£æ éç»æï¼è¿ä¸ªç®æ³ååéé«ï¼ä¸åçº¿ç¨è½å¹¶è¡éæ¾åå­ï¼å ä¹ä¸ç¨éã</p>
<p>å¤çº¿ç¨ PHP åå­ç®¡çå¨ä¸ºä»¥åä¸å¯è½çæ¹å¨æå¼äºé¨ã</p>
<h2 id="å±äº«å¯¹è±¡">å±äº«å¯¹è±¡</h2>
<p>è½ç¨æå°æä½æåå­ä»ä¸ä¸ªçº¿ç¨ä¼ å°å¦ä¸ä¸ªå¾å¥½ï¼ä½å¦æè½åå»ºä¸å¼å§å°±è®¾è®¡æè·¨çº¿ç¨å±äº«çå¯¹è±¡å¢ï¼</p>
<p>å¾å¤æå¡å¯ä»¥æå»ºæä¸å¯åå¯¹è±¡ï¼åºè¯¥è½å¨è¿ç¨é´å±äº«ï¼çåå­ãå å¿« worker å¯å¨ã</p>
<p>ä½ <code>refcount</code> æ¡çï¼å®è®©ææ PHP å¯¹è±¡å®éä¸é½æ¯å¯åçãè½ç»è¿åï¼</p>
<h3 id="ä»£çå¯¹è±¡">ä»£çå¯¹è±¡</h3>
<p>ç¬¬ä¸ç§æ¹æ³æ¯ä»£çå¯¹è±¡ï¼å¼ç¨å­å¨ææçº¿ç¨å¯è®¿é®çå±äº«åå­æ± éççå®å¯¹è±¡ãä»£çåªå­æ è¯ç¬¦ææéï¼å ä¸è®¿é®æ°æ®çæ¹æ³ãç¼ºç¹ï¼</p>
<ul>
<li>è®¿é®æ°æ®/å±æ§åæ¢</li>
<li>Reflection API åç±»åæ£æ¥æ´å¤æ</li>
</ul>
<p>PHP å·²ç»æå¼ºå¤§çä»£çæºå¶ãä»£çå±äº«å¯¹è±¡å¨æäºåºæ¯ä¸éï¼æ¯å¦è®¡æ°å¨è¡¨æ Swoole/Table è¿æ ·çæ°æ®è¡¨ã</p>
<h3 id="å¸¦æ-gc_share-æ å¿çå±äº«å¯¹è±¡">å¸¦æ GC_SHARE æ å¿çå±äº«å¯¹è±¡</h3>
<p>PHP æä¸ªåç½®æºå¶éè¿ <code>GC_IMMUTABLE</code> æ å¿å®ç°ä¸å¯ååç´ ï¼ç¨äºï¼</p>
<ul>
<li>åé¨å­ç¬¦ä¸²ï¼<code>IS_STR_INTERNED</code>ï¼ââæ´ä¸ª PHP è¿ç¨å­å¨çå­ç¬¦ä¸²å¸¸é</li>
<li>ä¸å¯åæ°ç»ï¼<code>IS_ARRAY_IMMUTABLE</code>ï¼ââæ¯å¦ <code>zend_empty_array</code></li>
<li>opcache éçå¸¸éââå¸¦å¸¸éæ°æ®çç¼è¯ä»£ç </li>
</ul>
<p><code>GC_IMMUTABLE</code> è®©å¼æè·³è¿è¿äºç»æç <code>refcount</code> ä¿®æ¹ï¼</p>
<pre><code class="language-c">// Zend/zend_types.h
// ä¸º zend_refcounted_h å¢å  refcount çå½æ°
static zend_always_inline void zend_gc_try_addref(zend_refcounted_h *p) {
    if (!(p-&gt;u.type_info &amp; GC_IMMUTABLE)) {
        ZEND_RC_MOD_CHECK(p);
        ++p-&gt;refcount;
    }
}
</code></pre>
<p>ç±»ä¼¼æºå¶å¯ä»¥æ¯æ <code>SharedObjects</code>ï¼æ¯å¦å ä¸ª <code>GC_SHARE</code> æ å¿ã</p>
<p>æ§è½åææ¾ç¤ºï¼æ£æ¥ <code>GC_SHARE</code> ç»åç¬ç <code>refcount++</code> å äº +34% å¼éï¼å¾®åºåæµè¯ï¼ãå®éåºç¨é <code>refcount</code> æä½åªå æ»å·¥ä½ä¸å°é¨åï¼å½±åå ä¹çä¸åºæ¥ï¼</p>
<ul>
<li>çå®æä½ï¼æ°ç»/å¯¹è±¡ï¼ï¼+3â9%</li>
<li>å®éåºç¨ï¼+0.05â0.5%</li>
</ul>
<p>è¿è§£å³äºä¸åé®é¢ï¼å¦ä¸åæ¯ç»è¿äºå¯¹è±¡è®¾è®¡ GCãç¨åå­ <code>refcount</code> ä¸çæ³ï¼å¤çº¿ç¨è®¿é®åä¸å¯¹è±¡æ¶ä¼åæ¢ãå»¶è¿éæ¾ç®æ³å¯è½æ´åéã</p>
<h2 id="åºäºåºåçåå­">åºäºåºåçåå­</h2>
<p>åºäºåºåçåå­ï¼<code>Region-based memory</code>ï¼å¨é¢å Web çè¯­è¨éè¶æ¥è¶æµè¡ã</p>
<p>æè·¯ï¼ç»ç¹å®ä»»å¡æçº¿ç¨å¨åç¬åºååéåå­ï¼ä¸éè¦æ¶æ´ä½éæ¾ãé¿åäºéä¸ªå¯¹è±¡ç®¡ççå¤ææ§ï¼GC ä¹ç®åäºã</p>
<p>æ¯å¦ PHP MM å¯ä»¥ä¿è¯å¯¹è±¡å¨ç»å®å°ç¹å® PHP å¯¹è±¡çåºåéåå»ºãåºåçå½å¨æç­äºå¯¹è±¡çå½å¨æã</p>
<p>å¯¹è±¡éæ¯æ¶æ´ä¸ªåºåç´æ¥éæ¾ï¼ä¸ç¨éåå­å¯¹è±¡ãè¿ç§å¯¹è±¡è¦"ç§»å¨"å°å¦ä¸ä¸ªçº¿ç¨ï¼å¯ä»¥é¿åæ·±æ·è´ã</p>
<p>PHP VM å®ç°åºäºåºåçåå­æé®é¢ï¼æ¯å¦å¨å±å¯¹è±¡åè¡¨ãæä½ç ç¼å­ãä½é«æå®ç°çæºä¼ä¸æ¯é¶ï¼å¼å¾ç»§ç»­ç ç©¶ã</p>
<p>ææçåºäºåºåçåå­ç®æ³è½ä¸º actors æå¼é¨ââæéç¦»åå­çç¹æ®å¯¹è±¡ã</p>
<p><strong>Actors æ¯å¤çº¿ç¨ç¼ç¨éææ¹ä¾¿ãæå¼ºå¤§ãæå®å¨çå·¥å·ã</strong></p>
<h2 id="åç¨åçº¿ç¨åä½">åç¨åçº¿ç¨åä½</h2>
<p>ä»åç¨è§åº¦çï¼<code>Thread</code> æ¯ä¸ª <code>Awaitable</code> å¯¹è±¡ãåç¨å¯ä»¥ç­ <code>Thread</code> ç»æèä¸é»å¡å¶ä»åç¨ãä¸ä¸ªçº¿ç¨è½æç®¡å¾å¤ç­éä»»å¡çåç¨ãæå¡å®ä»¬ççº¿ç¨å¯¹æ°è¯·æ±ä¿æå¿«éååºï¼å ä¸ºç­ <code>Thread</code> ä¸é»å¡ <code>Event Loop</code>ã</p>
<pre><code class="language-php">use Async\await;
use Async\Thread;

$thread = new Thread(function() {
    // ç¡¬ä»¶å¯éåä»»å¡å¨è¿é
    return 42;
});

$result = await($thread); 
// åç¨å¨è¿éæåï¼ç´å° Thread å®æ
</code></pre>
<p>è¿ç§æ¹å¼è½å®ç°æ CPU å¯éåä»»å¡åç®åä¸å¡é»è¾çèå¤©åºæ¯ã<br>
<img alt="åç¨åçº¿ç¨åä½" loading="lazy" data-src="https://image.catchadmin.com/202601060809533.png" class="lazyload"></p>
<p>å¾éæ¯ä¸ªç¤ºä¾æ¶æãåºç¨æä¸¤ä¸ªçº¿ç¨æ± ï¼å¸¦å¹¶åå¤ä»»å¡çè¯·æ±å¤ççº¿ç¨ï¼åè· CPU å¯éåä»»å¡ç worker çº¿ç¨ãåç¨å¤çè¯·æ±ï¼worker è·éä»»å¡æ¶å¯ä»¥å®å¨æåï¼è·å®ç»§ç»­ã</p>
<pre><code class="language-php">use Async\await;
use Async\ThreadPool;

final readonly class ImageDto
{
    public function __construct(
    public int $width,
    public int $height,
    public string $text,
) {}
}

$pool = new ThreadPool(2);
$dto = new ImageDto(
    width: 200,
    height: 200,
    text: 'Hello TrueAsync!'
);

$image = $pool-&gt;enqueue(function (ImageDto $dto) {
    $img = imagecreatetruecolor($dto-&gt;width, $dto-&gt;height);

    $white = imagecolorallocate($img, 255, 255, 255);
    $black = imagecolorallocate($img, 0, 0, 0);

    imagefill($img, 0, 0, $white);
    imagestring($img, 5, 20, 90, $dto-&gt;text, $black);

    ob_start();
    imagepng($img);
    imagedestroy($img);
    return ob_get_clean();
}, $dto);

$response-&gt;setHeader('Content-Type', 'image/png');
$response-&gt;write($image);
$response-&gt;end();
</code></pre>
<p>åç¨ä»£ç æ¯é¡ºåºçï¼è¯»èµ·æ¥åæ®éä»£ç ï¼<code>ThreadPool::enqueue</code> åå¨åä¸çº¿ç¨è°ç¨åè°ä¸æ ·ãDTO è·¨çº¿ç¨ä¼ ï¼ç»æå­ç¬¦ä¸²ä¸ä¼å¨åå­éå¤å¶ä¸¤æ¬¡ã</p>
<h2 id="åå¾æ¶éå¨åæç¶ææ¨¡å¼">åå¾æ¶éå¨åæç¶ææ¨¡å¼</h2>
<p>ç°ä»£å PHP åå­ç®¡çå¨ä¸æ¯æ¹è¿å¤çº¿ç¨ç¯å¢å¯ä¸è¦åçäºãæ²¡æé«æ GCï¼å¤çº¿ç¨ PHP ä¼ææ§è½é®é¢åå¾ªç¯å¼ç¨å¯¼è´çåå­æ³æ¼ã</p>
<p>PHP GC ç¨ä¸¤ç§ç®æ³ï¼å¼ç¨è®¡æ°åä¸»è¦åå­ç®¡çï¼å¹¶åå¾ªç¯æ¶éï¼Concurrent Cycle Collectionï¼Bacon-Rajanï¼2001ï¼å¤çå¾ªç¯ãå¼ç¨è®¡æ°æ¯æ¬¡èµå¼é½éå¢/éåï¼æ²¡åæ­¥çè¯å¤çº¿ç¨ä¸å®å¨ãæ¯æ¬¡èµå¼ç¨åå­æä½å¼éå¤ªå¤§ï¼ä¸åæ­¥å°±æç«æåæ³æ¼ãå¾ªç¯æ¶éå¨è½ç¶å«"å¹¶å"ï¼ä½åªå¨åçº¿ç¨åå·¥ä½ï¼ç¨é¢è²æ è®°ï¼PURPLE â GREY â WHITE/BLACKï¼æ¾å¾ªç¯ï¼ä¹ä¸æ¯çº¿ç¨å®å¨çã</p>
<p>å¥½æ¶æ¯æ¯ï¼å½å GC å®ç°å¨å¤çº¿ç¨ç¯å¢è½å·¥ä½ï¼å ä¸ºå®è·åå­ç®¡çå¨åå¼ï¼ä¸ä¾èµåå­å¨åªåéã</p>
<p>ä½ PHP è¦è¿å¥æç¶æåºç¨çå¤çº¿ç¨æ¶ä»£ï¼GC å¾éåºï¼</p>
<ul>
<li>å¨åç¬çº¿ç¨å¹¶è¡è·ï¼ä¸å½±åä¸å¡ä»£ç ã</li>
<li>å°½å¿«éæ¾èµæºã</li>
<li>æä¾æ³æ¼æ£æµãæ¥å¿ãé¥æµçé¢å¤å·¥å·ï¼é¿æ¶é´è¿è¡çåºç¨ç¹å«éè¦ï¼ã</li>
</ul>
<p>å¾ªç¯æ¶éå¨å¯ä»¥æ¹æå¨å¤çº¿ç¨ç¯å¢å·¥ä½ï¼å¨åç¬çº¿ç¨å¤çå¼ç¨ï¼æé«æ´ä½ååºæ§ãè¿å¯è½å¤ç¨äºï¼</p>
<h2 id="actors">Actors</h2>
<p><code>ThreadPool</code> åçº¿ç¨é´ä¼ å¯¹è±¡æç¨ï¼ä½éè¦å¼åèçæ³¨æåãæè½åç²¾åãæä¸ªæ´å¥½çå¤çº¿ç¨ç¼ç¨æ½è±¡ï¼èä½çº¿ç¨/åå­å¤ææ§ï¼å®ç¾å¥åä¸å¡é»è¾ï¼actorsã</p>
<p><strong>Actors æ¯å¹¶åå¹¶è¡ç¼ç¨æ¨¡åï¼è®¡ç®çåºæ¬ååæ¯ actorã</strong></p>
<p>æ¯ä¸ª actorï¼</p>
<ul>
<li>æèªå·±çéç¦»ç¶æ</li>
<li>é¡ºåºå¤çæ¶æ¯</li>
<li>åªéè¿æ¶æ¯è·å¶ä» actors äº¤äº</li>
<li>å¯è½å¨åç¬çº¿ç¨è·</li>
</ul>
<p>å¯ä»¥æ actor æ³æå¯¹è±¡ï¼è¿è®©å¤çº¿ç¨ PHP è½ç¨çæç OOP æ¨¡å¼ã</p>
<p>æ³è±¡ä¸ä¸ªæå¾å¤æ¿é´çèå¤©æå¡å¨ãæ¯ä¸ªæ¿é´æ¯åç¬çå¯¹è±¡ã</p>
<pre><code class="language-php">use Async\Actor;

class ChatRoom extends Actor
{
    private array $messages = [];
    private string $name;

    public function __construct(string $name)
    {
        $this-&gt;name = $name;
    }

    public function postMessage(string $user, string $text): void
    {
        $this-&gt;messages[] = [
            'user' =&gt; $user,
            'text' =&gt; $text,
            'time' =&gt; time()
        ];
    }

    public function getMessages(): array
    {
        return $this-&gt;messages;
    }
}

spawn(function() {
   $room = new ChatRoom('general');
   $room-&gt;postMessage('Alice', 'Hello!');  // å¨å¦ä¸ä¸ªçº¿ç¨ä¸­è¿è¡ï¼æååç¨ï¼
   $messages = $room-&gt;getMessages();       // å¨å¦ä¸ä¸ªçº¿ç¨ä¸­è¿è¡ï¼æååç¨ï¼
   echo json_encode($messages);
});
</code></pre>
<p><code>ChatRoom</code> å¯¹è±¡ç¹æ®ãå®ä»¬çæ°æ®å PHP VM ç¶ææ¬å°åäºï¼æ¹ä¾¿å¨çº¿ç¨é´ç§»å¨ãæ¯ä¸ªæ¹æ³å¨èªå·±ççº¿ç¨è·ï¼ä½ä»»ä½æ¶å»åªæä¸ä¸ªçº¿ç¨è½æ§è¡ç»å® actor çæ¹æ³ã</p>
<p>è¯­ä¹ä¸ï¼åºç±» <code>Actor</code> å®ä¹äº PHP VM ååå­ç®¡çå¨çå·¥ä½æ¹å¼ï¼è®© <code>ChatRoom</code> å¯¹è±¡è½å®å¨å°å¨åç¬çº¿ç¨è·ãç±»ç±»åä¸åª"å­"æ¹æ³åå±æ§ä¿¡æ¯ï¼è¿å­ MM å GC è¯¥æä¹æä½è¿ç±»å¯¹è±¡ãRustãC++ ä¹æç±»ä¼¼åæ³ãå¥½å¤ï¼ä¸æ¹è¯­æ³ï¼ç¬¦å OOP å²å­¦ã</p>
<p>ç¤ºä¾çèµ·æ¥ååç¨éè·çæ®éé¡ºåºä»£ç ãä½ <code>postMessage</code> å <code>getMessages</code> å¨å¦ä¸ä¸ªçº¿ç¨è·ï¼ä¸ä¼ç´æ¥æ§è¡ãåç¨ç» actor éååæ¶æ¯ï¼è¿å¥ç­å¾ï¼actor å¨å¦ä¸ä¸ªçº¿ç¨è·å®æ¹æ³è¿åç»æåææ¢å¤ã</p>
<p>è¿è·çæç PHP OOP ä¸å²çªï¼<code>Actor</code> éå <code>__call</code>ï¼</p>
<pre><code class="language-php">class Actor 
{
    private $threadPool;

    public function __call(string $name, array $arguments): mixed
    {
        if(current_thread_id() === $this-&gt;threadPool-&gt;getThreadIdForActor($this)) {
            // å¦ææä»¬å¨åä¸ä¸ªçº¿ç¨ä¸­ï¼ç´æ¥è¿è¡æ¹æ³
            return $this-&gt;$name(...$arguments);
        }
    
        // å¦åå°è°ç¨æéç» actor
        return $this-&gt;threadPool-&gt;enqueueActorMethod($this, $name, $arguments);
    }
}
</code></pre>
<p><code>enqueueActorMethod</code> æ <code>postMessage</code> å å° actor éåï¼è®¢éç»æäºä»¶ï¼è°ç¨ <code>Async\suspend()</code> æååç¨ã</p>
<p>Actor ä»£ç é¡ºåºæ§è¡ï¼è§£å³ç«ææ¡ä»¶ï¼å¤çº¿ç¨å¼åå¯¹å¼åèéæã</p>
<p>å¹¶è¡æ§é æ¯ä¸ª <code>ChatRoom</code> actor è½å¨åç¬çº¿ç¨è·æ¥å®ç°ï¼</p>
<pre><code class="language-php">spawn(function() {
   $room = new ChatRoom('room1');
   $room-&gt;postMessage('Alice', 'Hello!');
   $messages = $room-&gt;getMessages();
   echo json_encode($messages);
});

spawn(function() {
   $room = new ChatRoom('room2');
   $room-&gt;postMessage('Bob', 'Hi there!');
   $messages = $room-&gt;getMessages();
   echo json_encode($messages);
});
</code></pre>
<p><code>ChatRoom</code> å®ä¾è½å¨ä¸åçº¿ç¨å¹¶è¡è·ï¼å ä¸ºæ¯ä¸ª actor æèªå·±çæ§è¡çº¿ç¨ãå¯ä¸ç PHP VM ç¶æååå­ã</p>
<p>åå»º 100 ä¸ªèå¤©å®¤ï¼</p>
<pre><code class="language-php">use Async\Actor;

$rooms = [
    'general' =&gt; new ChatRoom('general'),
    'random'  =&gt; new ChatRoom('random'),
    'tech'    =&gt; new ChatRoom('tech'),
    // ... 97 ä¸ªæ´å¤æ¿é´
];

// å¤çè¯·æ±çåç¨
HttpServer::onRequest(function(Request $request, Response $response) use ($rooms) {
   // HTTP è¯·æ±å¤ç
   $roomName = $request-&gt;getQueryParam('room');
   $room = $rooms[$roomName] ?? null;
   
   if (!$room) {
      $response-&gt;setStatus(404);
      $response-&gt;write('Room not found');
      $response-&gt;end();
      return;
   }
   
   // è°ç¨çèµ·æ¥æ¯åæ­¥çï¼ä½å¨å¦ä¸ä¸ªçº¿ç¨ä¸­è¿è¡ï¼
   $room-&gt;postMessage($request-&gt;getQueryParam('user'), $request-&gt;getQueryParam('text'));
   $messages = $room-&gt;getMessages();
   
   $response-&gt;setHeader('Content-Type',  'application/json');  
   $response-&gt;write(json_encode($messages));
   $response-&gt;end();
});
</code></pre>
<p>æ¯ä¸ªèå¤©å®¤é¡ºåºå¤çæ¶æ¯ï¼è·å¶ä»æ¿é´å¹¶è¡ã</p>
<p>Actors ä¸éè¦äºæ¥éãéãå¤æåæ­¥ææå¨çº¿ç¨æ± äº¤äºãå®ä»¬æ¯ç°æçé«çº§å¹¶è¡åæ¹æ¡ã</p>
<p>ä¸ä¸ªèå¤©å®¤è¦ç»å¦ä¸ä¸ªåæ¶æ¯ä¹è¡ï¼å ä¸º actors æ¯ <code>SharedObject</code>ï¼è½è·¨çº¿ç¨äº¤äºï¼</p>
<pre><code class="language-php">class Rooms extends Actor
{
    private array $rooms = [];
    
    public function __construct(string ...$roomNames)
    {
       foreach ($roomNames as $name) {
           $this-&gt;rooms[$name] = new ChatRoom($name);
       }
    }
    
    public function broadcastMessage(string $fromRoom, string $user, string $text): void
    {
        foreach ($this-&gt;rooms as $name =&gt; $room) {
            if ($name !== $fromRoom) {
                // éé»å¡è°ç¨
                $room-&gt;postMessageAsync($user, $text);
            }
        }
    }
}

spawn(function() {
   $rooms = new Rooms('general', 'room1', 'room2', 'room3');
   $rooms-&gt;broadcastMessage('general', 'Alice', 'Hello!');
});
</code></pre>
<h3 id="actor-åé¨">Actor åé¨</h3>
<p>PHP VM ä¿è¯ actor åææå¯¹è±¡ï¼</p>
<ul>
<li>è¦ä¹åªå±äºè¯¥ actorï¼å¨å¶å¯ä¸åºååé</li>
<li>è¦ä¹ä»å¶ä»åºåæçº¿ç¨ç§»å¨è¿æ¥</li>
<li>è¦ä¹æ¯å¦ä¸ä¸ª <code>SharedObject</code> æå¦ä¸ä¸ª actor</li>
</ul>
<p>Actor è¦ä¹æ¥æèªå·±çåºåï¼è¦ä¹åªç¨æ¾å¼å±äº«çä¸å¯åå¯¹è±¡ï¼å¦åç«æè¿æ¯ä¼æã</p>
<p>åå­ç®¡çå¨ä¿è¯ actor æ¹æ³åææåå­æä½èªå¨ç»å®å°ä¸ actor å³èçåºåã</p>
<p>æ¹æ³éè¿ <code>Scheduler</code> æå¡ç MPMC æ¶æ¯éåæ§è¡ã<code>Scheduler</code> å¨ actors é´åé CPU æ¶é´ï¼æä¾å¹¶ååå¹¶è¡æ§è¡ã</p>
<p><img alt="Actor åé¨" loading="lazy" data-src="https://image.catchadmin.com/202601060810207.png" class="lazyload"></p>
<h2 id="ç»è®º">ç»è®º</h2>
<p>è¿äºå¬çé½ä¸éï¼ä½ä»ä¹æ¶åè½çæ­£ç¨ä¸ï¼</p>
<p><code>Single-threaded + offload</code> æ¨¡åå¯è½å¾å¿«åºç°ï¼å¾å¤ç»ä»¶å·²ç»å°±ç»ªãTrueAsync åçº¿ç¨åç¨å·²å° beta çãå®éªæ§çå¤çº¿ç¨åå­ç®¡çå¨ååå»ºçº¿ç¨ç API å·²ç»å®ç°ã</p>
<p>Actors éè¦æ´å¤å¼åæ¶é´ï¼å ä¸ºæ¶å PHP æ ¸å¿å¾å¤é¨åï¼ä½ä»æ¯ PHP 9 çç°å®ç®æ ï¼ç»å¸åºæä¾ä¸ç§å®å¨çå¤çº¿ç¨ç¼ç¨è¯­è¨ã</p>

</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-01-07 07:12">2026-01-07 07:12</span>&nbsp;
<a href="https://www.cnblogs.com/catchadmin">JaguarJack</a>&nbsp;
éè¯»(<span id="post_view_count">15</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19450129);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19450129', targetLink: 'https://www.cnblogs.com/catchadmin/p/19450129', title: 'PHP å¼æ­¥ä¸å¤çº¿ç¨ ä» TrueAsync å±ææªæ¥' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>